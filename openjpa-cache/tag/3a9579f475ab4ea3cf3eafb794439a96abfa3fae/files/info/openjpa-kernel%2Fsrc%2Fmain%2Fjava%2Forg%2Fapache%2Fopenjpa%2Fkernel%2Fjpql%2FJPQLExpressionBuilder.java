{"sha":"1344e5d5f1057d586dacdd220925c337514950c2","node_id":"MDQ6QmxvYjIwNjM2NDoxMzQ0ZTVkNWYxMDU3ZDU4NmRhY2RkMjIwOTI1YzMzNzUxNDk1MGMy","size":87026,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1344e5d5f1057d586dacdd220925c337514950c2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc3FsLlRpbWU7\nCmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkRhdGU7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlu\na2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGph\ndmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmNvbmYuQ29tcGF0aWJpbGl0eTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXJGYWN0b3J5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVy\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsbFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5\nT3BlcmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUmVzdWx0U2hhcGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5BYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkNvbnRleHQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9u\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5MaXRlcmFsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLlBhcmFtZXRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5QYXRoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLlF1ZXJ5RXhwcmVzc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLmV4cHMuUmVzb2x2ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuU3VicXVlcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFsdWU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLk9yZGVyZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRp\nb247CgoKLyoqCiAqIEJ1aWxkZXIgZm9yIEpQUUwgZXhwcmVzc2lvbnMuIFRo\naXMgY2xhc3MgdGFrZXMgdGhlIHF1ZXJ5IHBhcnNlZAogKiBpbiB7QGxpbmsg\nSlBRTH0gYW5kIGNvbnZlcnRzIGl0IHRvIGFuIGV4cHJlc3Npb24gdHJlZSB1\nc2luZwogKiBhbiB7QGxpbmsgRXhwcmVzc2lvbkZhY3Rvcnl9LiBQdWJsaWMg\nZm9yIHVuaXQgdGVzdGluZyBwdXJwb3Nlcy4KICoKICogQGF1dGhvciBNYXJj\nIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICog\nQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpQUUxFeHByZXNzaW9uQnVp\nbGRlcgogICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyCiAg\nICBpbXBsZW1lbnRzIEpQUUxUcmVlQ29uc3RhbnRzIHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgVkFSX1BBVEggPSAxOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IFZBUl9FUlJPUiA9IDI7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChKUFFMRXhwcmVzc2lvbkJ1aWxkZXIuY2xhc3MpOwoK\nICAgIHByaXZhdGUgZmluYWwgU3RhY2s8Q29udGV4dD4gY29udGV4dHMgPSBu\nZXcgU3RhY2s8Q29udGV4dD4oKTsKICAgIHByaXZhdGUgT3JkZXJlZE1hcDxP\nYmplY3QsIENsYXNzPD8+PiBwYXJhbWV0ZXJUeXBlczsKICAgIHByaXZhdGUg\naW50IGFsaWFzQ291bnQgPSAwOwogICAgcHJpdmF0ZSBib29sZWFuIGluQXNz\naWduU3Vic2VsZWN0UHJvamVjdGlvbiA9IGZhbHNlOwoKICAgIC8qKgogICAg\nICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3Rvcnkg\ndGhlIGV4cHJlc3Npb24gZmFjdG9yeSB0byB1c2UKICAgICAqIEBwYXJhbSBx\ndWVyeSB1c2VkIHRvIHJlc29sdmUgdmFyaWFibGVzLCBwYXJhbWV0ZXJzLAog\nICAgICogYW5kIGNsYXNzIG5hbWVzIHVzZWQgaW4gdGhlIHF1ZXJ5CiAgICAg\nKiBAcGFyYW0gcGFyc2VkUXVlcnkgdGhlIHBhcnNlZCBxdWVyeQogICAgICov\nCiAgICBwdWJsaWMgSlBRTEV4cHJlc3Npb25CdWlsZGVyKEV4cHJlc3Npb25G\nYWN0b3J5IGZhY3RvcnksCiAgICAgICAgRXhwcmVzc2lvblN0b3JlUXVlcnkg\ncXVlcnksIE9iamVjdCBwYXJzZWRRdWVyeSkgewogICAgICAgIHN1cGVyKGZh\nY3RvcnksIHF1ZXJ5LmdldFJlc29sdmVyKCkpOwoKICAgICAgICBjb250ZXh0\ncy5wdXNoKG5ldyBDb250ZXh0KHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgUGFy\nc2VkSlBRTAogICAgICAgICAgICA/IChQYXJzZWRKUFFMKSBwYXJzZWRRdWVy\neQogICAgICAgICAgICA6IHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5n\nCiAgICAgICAgICAgID8gZ2V0UGFyc2VkUXVlcnkoKFN0cmluZykgcGFyc2Vk\nUXVlcnkpCiAgICAgICAgICAgIDogbnVsbCwgbnVsbCwgbnVsbCkpOwoKICAg\nICAgICBpZiAoY3R4KCkucGFyc2VkID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihwYXJzZWRRdWVyeSArICIiKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgTG9jYWxpemVyIGdldExvY2FsaXplcigp\nIHsKICAgICAgICByZXR1cm4gX2xvYzsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgLy8gd2Ug\nZG9uJ3QgcmVzb2x2ZSBpbiB0aGUgY29udGV4dCBvZiBhbnl0aGluZyBidXQg\nb3Vyc2VsdmVzCiAgICAgICAgcmV0dXJuIGdldENsYXNzKCkuZ2V0Q2xhc3NM\nb2FkZXIoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgUGFyc2VkSlBRTCBnZXRQ\nYXJzZWRRdWVyeSgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFyc2VkOwog\nICAgfQoKICAgIHByb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5\nKFN0cmluZyBqcHFsKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZWRKUFFM\nKGpwcWwpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRDYW5kaWRhdGUo\nQ2xhc3NNZXRhRGF0YSBjbWQsIFN0cmluZyBzY2hlbWFBbGlhcykgewogICAg\nICAgIGFkZEFjY2Vzc1BhdGgoY21kKTsKCiAgICAgICAgaWYgKGNtZCAhPSBu\ndWxsKQogICAgICAgICAgICBjdHgoKS5tZXRhID0gY21kOwoKICAgICAgICBp\nZiAoc2NoZW1hQWxpYXMgIT0gbnVsbCkKICAgICAgICAgICAgY3R4KCkuc2No\nZW1hQWxpYXMgPSBzY2hlbWFBbGlhczsKICAgIH0KCiAgICBwcml2YXRlIFN0\ncmluZyBuZXh0QWxpYXMoKSB7CiAgICAgICAgcmV0dXJuICJqcHFsYWxpYXMi\nICsgKCsrYWxpYXNDb3VudCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNz\nTWV0YURhdGEgcmVzb2x2ZUNsYXNzTWV0YURhdGEoSlBRTE5vZGUgbm9kZSkg\newogICAgICAgIC8vIGhhbmRsZSBsb29raW5nIHVwIGFsaWFzIG5hbWVzCiAg\nICAgICAgU3RyaW5nIHNjaGVtYU5hbWUgPSBhc3NlcnRTY2hlbWFOYW1lKG5v\nZGUpOwogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0Q2xhc3NNZXRh\nRGF0YShzY2hlbWFOYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGNtZCAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyB3ZSBt\naWdodCBiZSByZWZlcmVuY2luZyBhIGNvbGxlY3Rpb24gZmllbGQgb2YgYSBz\ndWJxdWVyeSdzIHBhcmVudAogICAgICAgIGlmIChpc1BhdGgobm9kZSkpIHsK\nICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChub2RlKTsKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRoLmxhc3QoKTsKICAgICAg\nICAgICAgY21kID0gZ2V0RmllbGRUeXBlKGZtZCk7CiAgICAgICAgICAgIGlm\nIChjbWQgPT0gbnVsbCAmJiBmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpKQog\nICAgICAgICAgICAgICAgY21kID0gZm1kLmdldERlZmluaW5nTWV0YURhdGEo\nKTsKICAgICAgICAgICAgcmV0dXJuIGNtZDsKICAgICAgICB9CgogICAgICAg\nIC8vIG5vdyBydW4gYWdhaW4gdG8gdGhyb3cgdGhlIGNvcnJlY3QgZXhjZXB0\naW9uCiAgICAgICAgcmV0dXJuIGdldENsYXNzTWV0YURhdGEoc2NoZW1hTmFt\nZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIGdl\ndENsYXNzTWV0YURhdGEoU3RyaW5nIGFsaWFzLCBib29sZWFuIGFzc2VydFZh\nbGlkKSB7CiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gZ2V0Q2xhc3NM\nb2FkZXIoKTsKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBy\nZXNvbHZlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CgogICAgICAgIC8vIGZpcnN0\nIGNoZWNrIGZvciB0aGUgYWxpYXMKICAgICAgICBDbGFzc01ldGFEYXRhIGNt\nZCA9IHJlcG9zLmdldE1ldGFEYXRhKGFsaWFzLCBsb2FkZXIsIGZhbHNlKTsK\nCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nY21kOwoKICAgICAgICAvLyBub3cgY2hlY2sgZm9yIHRoZSBjbGFzcyBuYW1l\nOyB0aGlzIGlzIG5vdCB0ZWNobmljYWxseSBwZXJtaXR0ZWQKICAgICAgICAv\nLyBieSB0aGUgSlBBIHNwZWMsIGJ1dCBpcyByZXF1aXJlZCBpbiBvcmRlciB0\nbyBiZSBhYmxlIHRvIGV4ZWN1dGUKICAgICAgICAvLyBKUFFMIHF1ZXJpZXMg\nZnJvbSBvdGhlciBmYWNhZGVzIChsaWtlIEpETykgdGhhdCBkbyBub3QgaGF2\nZQogICAgICAgIC8vIHRoZSBjb25jZXB0IG9mIGVudGl0eSBuYW1lcyBvciBh\nbGlhc2VzCiAgICAgICAgQ2xhc3M8Pz4gYyA9IHJlc29sdmVyLmNsYXNzRm9y\nTmFtZShhbGlhcywgbnVsbCk7CiAgICAgICAgaWYgKGMgIT0gbnVsbCkKICAg\nICAgICAgICAgY21kID0gcmVwb3MuZ2V0TWV0YURhdGEoYywgbG9hZGVyLCBh\nc3NlcnRWYWxpZCk7CiAgICAgICAgZWxzZSBpZiAoYXNzZXJ0VmFsaWQpCiAg\nICAgICAgICAgIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRhKGFsaWFzLCBsb2Fk\nZXIsIGZhbHNlKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGFzc2Vy\ndFZhbGlkKSB7CiAgICAgICAgICAgIFN0cmluZyBjbG9zZSA9IHJlcG9zLmdl\ndENsb3Nlc3RBbGlhc05hbWUoYWxpYXMpOwogICAgICAgICAgICBpZiAoY2xv\nc2UgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0\naW9uKEVYX1VTRVIsICJub3Qtc2NoZW1hLW5hbWUtaGludCIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhbGlhcywgY2xvc2UsIHJlcG9z\nLmdldEFsaWFzTmFtZXMoKSB9LCBudWxsKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwg\nIm5vdC1zY2hlbWEtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBhbGlhcywgcmVwb3MuZ2V0QWxpYXNOYW1lcygpIH0sIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNtZDsKICAgIH0KCiAgICBw\ncml2YXRlIENsYXNzPD8+IGdldENhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAg\ncmV0dXJuIGdldENhbmRpZGF0ZU1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlw\nZSgpOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRDYW5k\naWRhdGVNZXRhRGF0YSgpIHsKICAgICAgICBpZiAoY3R4KCkubWV0YSAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gY3R4KCkubWV0YTsKCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBjbHMgPSBnZXRDYW5kaWRhdGVNZXRhRGF0YShyb290\nKCkpOwogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIs\nCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxs\nKTsKCiAgICAgICAgc2V0Q2FuZGlkYXRlKGNscywgbnVsbCk7CiAgICAgICAg\ncmV0dXJuIGNsczsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0\nYSBnZXRDYW5kaWRhdGVNZXRhRGF0YShKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgLy8gZXhhbWluZyB0aGUgbm9kZSB0byBmaW5kIHRoZSBjYW5kaWRhdGUg\ncXVlcnkKICAgICAgICAvLyAjIyMgdGhpcyBzaG91bGQgYWN0dWFsbHkgYmUg\ndGhlIHByaW1hcnkgU0VMRUNUIGluc3RhbmNlCiAgICAgICAgLy8gcmVzb2x2\nZWQgYWdhaW5zdCB0aGUgZnJvbSB2YXJpYWJsZSBkZWNsYXJhdGlvbnMKICAg\nICAgICBKUFFMTm9kZSBmcm9tID0gbm9kZS5maW5kQ2hpbGRCeUlEKEpKVEZS\nT01JVEVNLCB0cnVlKTsKICAgICAgICBpZiAoZnJvbSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIE9QRU5KUEEtMTUgYWxsb3cgc3VicXVlcnkgd2l0aG91\ndCBhIEZST01JVEVNCiAgICAgICAgICAgIGlmIChub2RlLmlkID09IEpKVFNV\nQlNFTEVDVCkgeyAKICAgICAgICAgICAgICAgIGZyb20gPSBub2RlLmZpbmRD\naGlsZEJ5SUQoSkpURlJPTSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2Vw\ndGlvbihFWF9VU0VSLCAibm8tZnJvbS1jbGF1c2UiLCBudWxsLCBudWxsKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmcm9tLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIEpQUUxOb2RlIG4gPSBmcm9tLmNoaWxkcmVuW2ldOwoKICAgICAgICAg\nICAgaWYgKG4uaWQgPT0gSkpUQUJTVFJBQ1RTQ0hFTUFOQU1FKSB7CiAgICAg\nICAgICAgICAgICAvLyB3ZSBzaW1wbHkgcmV0dXJuIHRoZSBmaXJzdCBhYnN0\ncmFjdCBzY2hlbWEgY2hpbGQKICAgICAgICAgICAgICAgIC8vIGFzIHJlc29s\ndmVkIGludG8gYSBjbGFzcwogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBjbWQgPSByZXNvbHZlQ2xhc3NNZXRhRGF0YShuKTsKCiAgICAgICAgICAg\nICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGNtZDsKCiAgICAgICAgICAgICAgICAvLyBub3QgYSBzY2hlbWE6IHRy\nZWF0IGl0IGFzIGEgY2xhc3MKICAgICAgICAgICAgICAgIFN0cmluZyBjbHMg\nPSBhc3NlcnRTY2hlbWFOYW1lKG4pOwogICAgICAgICAgICAgICAgaWYgKGNs\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhj\nZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1hLW5hbWUiLAogICAgICAgICAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsK\nCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2xhc3NNZXRhRGF0YShjbHMs\nIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE9QRU5KUEEt\nMTUgc3VwcG9ydCBzdWJxdWVyeSdzIGZyb20gY2xhdXNlIGRvIG5vdCBzdGFy\ndCB3aXRoIAogICAgICAgICAgICAvLyBpZGVudGlmaWNhdGlvbl92YXJpYWJs\nZV9kZWNsYXJhdGlvbigpCiAgICAgICAgICAgIGlmIChub2RlLmlkID09IEpK\nVFNVQlNFTEVDVCkgewogICAgICAgICAgICAgICAgaWYgKG4uaWQgPT0gSkpU\nSU5ORVJKT0lOKSB7CiAgICAgICAgICAgICAgICAgICAgbiA9IG4uZ2V0Q2hp\nbGQoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAo\nbi5pZCA9PSBKSlRQQVRIKSB7CiAgICAgICAgICAgICAgICAgICAgUGF0aCBw\nYXRoID0gZ2V0UGF0aChuKTsKICAgICAgICAgICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IHBhdGgubGFzdCgpOwogICAgICAgICAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgY21kID0gZ2V0RmllbGRUeXBlKGZtZCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGZtZC5pc0VsZW1l\nbnRDb2xsZWN0aW9uKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZCA9\nIGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGNtZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBjbWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tYWxpYXMiLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG4gfSwg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9ICAgICAgICAgICAKICAgICAgICB9CgogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcgY3Vy\ncmVudFF1ZXJ5KCkgewogICAgICAgIHJldHVybiBjdHgoKS5wYXJzZWQgPT0g\nbnVsbCB8fCByb290KCkucGFyc2VyID09IG51bGwgPyBudWxsCiAgICAgICAg\nICAgIDogcm9vdCgpLnBhcnNlci5qcHFsOwogICAgfQoKICAgIFF1ZXJ5RXhw\ncmVzc2lvbnMgZ2V0UXVlcnlFeHByZXNzaW9ucygpIHsKICAgICAgICBRdWVy\neUV4cHJlc3Npb25zIGV4cHMgPSBuZXcgUXVlcnlFeHByZXNzaW9ucygpOwog\nICAgICAgIGV4cHMuc2V0Q29udGV4dHMoY29udGV4dHMpOwoKICAgICAgICBl\ndmFsUXVlcnlPcGVyYXRpb24oZXhwcyk7CgogICAgICAgIEV4cHJlc3Npb24g\nZmlsdGVyID0gbnVsbDsKICAgICAgICBFeHByZXNzaW9uIGZyb20gPSBjdHgo\nKS5mcm9tOwogICAgICAgIGlmIChmcm9tID09IG51bGwpCiAgICAgICAgICAg\nIGZyb20gPSBldmFsRnJvbUNsYXVzZShyb290KCkuaWQgPT0gSkpUU0VMRUNU\nKTsKICAgICAgICBmaWx0ZXIgPSBhbmQoZnJvbSwgZmlsdGVyKTsKICAgICAg\nICBmaWx0ZXIgPSBhbmQoZXZhbFdoZXJlQ2xhdXNlKCksIGZpbHRlcik7CiAg\nICAgICAgZmlsdGVyID0gYW5kKGV2YWxTZWxlY3RDbGF1c2UoZXhwcyksIGZp\nbHRlcik7CgogICAgICAgIGV4cHMuZmlsdGVyID0gZmlsdGVyID09IG51bGwg\nPyBmYWN0b3J5LmVtcHR5RXhwcmVzc2lvbigpIDogZmlsdGVyOwoKICAgICAg\nICBldmFsR3JvdXBpbmdDbGF1c2UoZXhwcyk7CiAgICAgICAgZXZhbEhhdmlu\nZ0NsYXVzZShleHBzKTsKICAgICAgICBldmFsRmV0Y2hKb2lucyhleHBzKTsK\nICAgICAgICBldmFsU2V0Q2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxPcmRl\ncmluZ0NsYXVzZXMoZXhwcyk7CgogICAgICAgIGlmIChwYXJhbWV0ZXJUeXBl\ncyAhPSBudWxsKQogICAgICAgICAgICBleHBzLnBhcmFtZXRlclR5cGVzID0g\ncGFyYW1ldGVyVHlwZXM7CgogICAgICAgIGV4cHMuYWNjZXNzUGF0aCA9IGdl\ndEFjY2Vzc1BhdGgoKTsKCiAgICAgICAgcmV0dXJuIGV4cHM7CiAgICB9Cgog\nICAgcHJpdmF0ZSBFeHByZXNzaW9uIGFuZChFeHByZXNzaW9uIGUxLCBFeHBy\nZXNzaW9uIGUyKSB7CiAgICAgICAgcmV0dXJuIGUxID09IG51bGwgPyBlMiA6\nIGUyID09IG51bGwgPyBlMSA6IGZhY3RvcnkuYW5kKGUxLCBlMik7CiAgICB9\nCgogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSwgIi4iLCAw\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBjaGlsZHJl\nbiBvZiB0aGUgc3BlY2lmaWMgbm9kZSBieSBhcHBlbmRpbmcgZWFjaAogICAg\nICogY2hpbGQsIHNlcGFyYXRlZCBieSB0aGUgZGVsaW1pdGVyLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUg\nbm9kZSwgU3RyaW5nIGRlbGltaXRlciwgaW50IGxhc3QpIHsKICAgICAgICBT\ndHJpbmdCdWlsZGVyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAg\nICAgICAgSlBRTE5vZGVbXSBwYXJ0cyA9IG5vZGUuY2hpbGRyZW47CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IHBhcnRzICE9IG51bGwgJiYgaSA8IHBhcnRz\nLmxlbmd0aCAtIGxhc3Q7IGkrKykKICAgICAgICAgICAgcmVzdWx0LmFwcGVu\nZChyZXN1bHQubGVuZ3RoKCkgPiAwID8gZGVsaW1pdGVyIDogIiIpLgogICAg\nICAgICAgICAgICAgYXBwZW5kKHBhcnRzW2ldLnRleHQpOwoKICAgICAgICBy\nZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHJpdmF0ZSBF\neHByZXNzaW9uIGFzc2lnblN1YnNlbGVjdFByb2plY3Rpb24oSlBRTE5vZGUg\nbm9kZSwKICAgICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAg\nICBpbkFzc2lnblN1YnNlbGVjdFByb2plY3Rpb24gPSB0cnVlOwogICAgICAg\nIGV4cHMucHJvamVjdGlvbnMgPSBuZXcgVmFsdWVbMV07CiAgICAgICAgZXhw\ncy5wcm9qZWN0aW9uQ2xhdXNlcyA9IG5ldyBTdHJpbmdbMV07CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9uQWxpYXNlcyA9IG5ldyBTdHJpbmdbMV07CgogICAg\nICAgIFZhbHVlIHZhbCA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIGV4cHMu\ncHJvamVjdGlvbnNbMF0gPSB2YWw7CiAgICAgICAgZXhwcy5wcm9qZWN0aW9u\nQ2xhdXNlc1swXSA9IAogICAgICAgICAgICBwcm9qZWN0aW9uQ2xhdXNlKG5v\nZGUuaWQgPT0gSkpUU0NBTEFSRVhQUkVTU0lPTiA/CiAgICAgICAgICAgICAg\nICBmaXJzdENoaWxkKG5vZGUpIDogbm9kZSk7CiAgICAgICAgaW5Bc3NpZ25T\ndWJzZWxlY3RQcm9qZWN0aW9uID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NpZ24gcHJvamVjdGlvbnMg\nZm9yIE5FVyBjb250cnVjdG9yIGluIHNlbGVjdGlvbiBsaXN0LgogICAgICog\nICAgIEV4YW1wbGU6ICBTRUxFQ1QgTkVXIFBlcnNvbihwLm5hbWUpIEZST00g\nUGVyc29uIHAgV0hFUkUgLi4uCiAgICAgKi8KICAgIHByaXZhdGUgRXhwcmVz\nc2lvbiBhc3NpZ25Qcm9qZWN0aW9ucyhKUFFMTm9kZSBwYXJhbWV0ZXJzTm9k\nZSwKICAgICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIExpc3Q8VmFsdWU+\nIHByb2plY3Rpb25zLAogICAgICAgIExpc3Q8U3RyaW5nPiBwcm9qZWN0aW9u\nQ2xhdXNlcywgTGlzdDxTdHJpbmc+IHByb2plY3Rpb25BbGlhc2VzKSB7CiAg\nICAgICAgaW50IGNvdW50ID0gcGFyYW1ldGVyc05vZGUuZ2V0Q2hpbGRDb3Vu\ndCgpOwoKICAgICAgICBFeHByZXNzaW9uIGV4cCA9IG51bGw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAg\nIEpQUUxOb2RlIHBhcmVudCA9IHBhcmFtZXRlcnNOb2RlLmdldENoaWxkKGkp\nOwogICAgICAgICAgICBKUFFMTm9kZSBub2RlID0gZmlyc3RDaGlsZChwYXJl\nbnQpOwogICAgICAgICAgICBKUFFMTm9kZSBhbGlhc05vZGUgPSBwYXJlbnQu\nY2hpbGRyZW4ubGVuZ3RoID4gMSA/IHJpZ2h0KHBhcmVudCkKICAgICAgICAg\nICAgICAgIDogbnVsbDsgCiAgICAgICAgICAgIFZhbHVlIHByb2ogPSBnZXRW\nYWx1ZShub2RlKTsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gYWxpYXNO\nb2RlICE9IG51bGwgPyBhbGlhc05vZGUudGV4dCA6CiAgICAgICAgICAgICAg\nICBwcm9qZWN0aW9uQ2xhdXNlKG5vZGUuaWQgPT0gSkpUU0NBTEFSRVhQUkVT\nU0lPTiA/CiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQobm9k\nZSkgOiBub2RlKTsKICAgICAgICAgICAgaWYgKGFsaWFzTm9kZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgcHJvai5zZXRBbGlhcyhhbGlhcyk7CiAgICAg\nICAgICAgIHByb2plY3Rpb25zLmFkZChwcm9qKTsKICAgICAgICAgICAgcHJv\namVjdGlvbkNsYXVzZXMuYWRkKGFsaWFzKTsKICAgICAgICAgICAgcHJvamVj\ndGlvbkFsaWFzZXMuYWRkKGFsaWFzKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGV4cDsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbFByb2plY3Rp\nb25zUmVzdWx0U2hhcGUoSlBRTE5vZGUgc2VsZWN0aW9uc05vZGUsCiAgICAg\nICAgUXVlcnlFeHByZXNzaW9ucyBleHBzLAogICAgICAgIExpc3Q8VmFsdWU+\nIHByb2plY3Rpb25zLAogICAgICAgIExpc3Q8U3RyaW5nPiBwcm9qZWN0aW9u\nQ2xhdXNlcywKICAgICAgICBMaXN0PFN0cmluZz4gcHJvamVjdGlvbkFsaWFz\nZXMpIHsKICAgICAgICBpbnQgY291bnQgPSBzZWxlY3Rpb25zTm9kZS5nZXRD\naGlsZENvdW50KCk7CiAgICAgICAgQ2xhc3M8Pz4gcmVzdWx0Q2xhc3MgPSBu\ndWxsOwogICAgICAgIFJlc3VsdFNoYXBlPD8+IHJlc3VsdFNoYXBlID0gbnVs\nbDsKICAgICAgICBpZiAoY291bnQgPiAxKSB7CiAgICAgICAgICAgIC8vIG11\ndGktc2VsZWN0aW9uCiAgICAgICAgICAgIHJlc3VsdENsYXNzID0gT2JqZWN0\nW10uY2xhc3M7CiAgICAgICAgICAgIHJlc3VsdFNoYXBlID0gbmV3IFJlc3Vs\ndFNoYXBlKHJlc3VsdENsYXNzLCBuZXcgRmlsbFN0cmF0ZWd5LkFycmF5PE9i\namVjdFtdPihPYmplY3RbXS5jbGFzcykpOwogICAgICAgIH0KCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAg\nIEpQUUxOb2RlIHBhcmVudCA9IHNlbGVjdGlvbnNOb2RlLmdldENoaWxkKGkp\nOwogICAgICAgICAgICBKUFFMTm9kZSBub2RlID0gZmlyc3RDaGlsZChwYXJl\nbnQpOwogICAgICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRDT05TVFJVQ1RP\nUikgewogICAgICAgICAgICAgICAgLy8gYnVpbGQgdXAgdGhlIGZ1bGx5LXF1\nYWxpZmllZCByZXN1bHQgY2xhc3MgbmFtZSBieQogICAgICAgICAgICAgICAg\nLy8gYXBwZW5kaW5nIHRvZ2V0aGVyIHRoZSBjb21wb25lbnRzIG9mIHRoZSBj\naGlsZHJlbgogICAgICAgICAgICAgICAgU3RyaW5nIHJlc3VsdENsYXNzTmFt\nZSA9IGFzc2VtYmxlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgQ2xh\nc3M8Pz4gY29uc3RydWN0b3IgPSByZXNvbHZlci5jbGFzc0Zvck5hbWUocmVz\ndWx0Q2xhc3NOYW1lLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChjb25z\ndHJ1Y3RvciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5\nIHJlc29sdmUgaXQgYWdhaW4gdXNpbmcgc2ltcGxlIG5hbWUKICAgICAgICAg\nICAgICAgICAgICBpbnQgbiA9IGxlZnQobm9kZSkuZ2V0Q2hpbGRDb3VudCgp\nOwogICAgICAgICAgICAgICAgICAgIFN0cmluZyBiYXNlTmFtZSA9IGxlZnQo\nbm9kZSkuZ2V0Q2hpbGQobi0xKS50ZXh0OwogICAgICAgICAgICAgICAgICAg\nIGNvbnN0cnVjdG9yID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKGJhc2VOYW1l\nLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlm\nIChjb25zdHJ1Y3RvciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1jb25zdHJ1Y3RvciIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJl\nc3VsdENsYXNzTmFtZSB9LCBudWxsKTsKCiAgICAgICAgICAgICAgICBMaXN0\nPFZhbHVlPiB0ZXJtcyA9IG5ldyBBcnJheUxpc3Q8VmFsdWU+KCk7CiAgICAg\nICAgICAgICAgICBMaXN0PFN0cmluZz4gYWxpYXNlcyA9IG5ldyBBcnJheUxp\nc3Q8U3RyaW5nPigpOwogICAgICAgICAgICAgICAgTGlzdDxTdHJpbmc+IGNs\nYXVzZXMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICAgICAg\nICAgIC8vIG5vdyBhc3NpZ24gdGhlIGFyZ3VtZW50cyB0byB0aGUgc2VsZWN0\nIGNsYXVzZSBhcyB0aGUgcHJvamVjdGlvbnMKICAgICAgICAgICAgICAgIGFz\nc2lnblByb2plY3Rpb25zKHJpZ2h0KG5vZGUpLCBleHBzLCB0ZXJtcywgYWxp\nYXNlcywgY2xhdXNlcyk7CiAgICAgICAgICAgICAgICBGaWxsU3RyYXRlZ3kg\nZmlsbCA9IG5ldyBGaWxsU3RyYXRlZ3kuTmV3SW5zdGFuY2UoY29uc3RydWN0\nb3IpOwogICAgICAgICAgICAgICAgUmVzdWx0U2hhcGU8Pz4gY29ucyA9IG5l\ndyBSZXN1bHRTaGFwZShjb25zdHJ1Y3RvciwgZmlsbCk7CiAgICAgICAgICAg\nICAgICBmb3IgKFZhbHVlIHZhbCA6IHRlcm1zKSB7CiAgICAgICAgICAgICAg\nICAgICAgQ2xhc3M8Pz4gdHlwZSA9IHZhbC5nZXRUeXBlKCk7CiAgICAgICAg\nICAgICAgICAgICAgY29ucy5uZXN0KG5ldyBSZXN1bHRTaGFwZSh0eXBlLCBu\nZXcgRmlsbFN0cmF0ZWd5LkFzc2lnbigpLCB0eXBlLmlzUHJpbWl0aXZlKCkp\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb3Vu\ndCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q2xhc3MgPSBj\nb25zdHJ1Y3RvcjsKICAgICAgICAgICAgICAgICAgICByZXN1bHRTaGFwZSA9\nIGNvbnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0U2hhcGUubmVzdChjb25zKTsK\nICAgICAgICAgICAgICAgIHByb2plY3Rpb25zLmFkZEFsbCh0ZXJtcyk7CiAg\nICAgICAgICAgICAgICBwcm9qZWN0aW9uQWxpYXNlcy5hZGRBbGwoYWxpYXNl\ncyk7CiAgICAgICAgICAgICAgICBwcm9qZWN0aW9uQ2xhdXNlcy5hZGRBbGwo\nY2xhdXNlcyk7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgSlBRTE5vZGUgYWxpYXNOb2RlID0gcGFyZW50LmNoaWxkcmVuLmxlbmd0\naCA+IDEgPyByaWdodChwYXJlbnQpCiAgICAgICAgICAgICAgICAgICAgICAg\nIDogbnVsbDsgCiAgICAgICAgICAgICAgICBWYWx1ZSBwcm9qID0gZ2V0VmFs\ndWUobm9kZSk7CiAgICAgICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSBhbGlh\nc05vZGUgIT0gbnVsbCA/IGFsaWFzTm9kZS50ZXh0IDoKICAgICAgICAgICAg\nICAgICAgICBwcm9qZWN0aW9uQ2xhdXNlKG5vZGUuaWQgPT0gSkpUU0NBTEFS\nRVhQUkVTU0lPTiA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJz\ndENoaWxkKG5vZGUpIDogbm9kZSk7CiAgICAgICAgICAgICAgICBpZiAoYWxp\nYXNOb2RlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcHJvai5zZXRB\nbGlhcyhhbGlhcyk7CiAgICAgICAgICAgICAgICBwcm9qZWN0aW9ucy5hZGQo\ncHJvaik7CiAgICAgICAgICAgICAgICBwcm9qZWN0aW9uQ2xhdXNlcy5hZGQo\nYWxpYXMpOwogICAgICAgICAgICAgICAgcHJvamVjdGlvbkFsaWFzZXMuYWRk\nKGFsaWFzKTsKICAgICAgICAgICAgICAgIENsYXNzPD8+IHR5cGUgPSBwcm9q\nLmdldFR5cGUoKTsKICAgICAgICAgICAgICAgIFJlc3VsdFNoYXBlPD8+IHBy\nb2pTaGFwZSA9IG5ldyBSZXN1bHRTaGFwZSh0eXBlLCBuZXcgRmlsbFN0cmF0\nZWd5LkFzc2lnbigpLCB0eXBlLmlzUHJpbWl0aXZlKCkpOwoKICAgICAgICAg\nICAgICAgIGlmIChjb3VudCA9PSAxKQogICAgICAgICAgICAgICAgICAgIHJl\nc3VsdFNoYXBlID0gcHJvalNoYXBlOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIHJlc3VsdFNoYXBlLm5lc3QocHJvalNoYXBl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBleHBzLnNoYXBl\nID0gcmVzdWx0U2hhcGU7CiAgICAgICAgZXhwcy5yZXN1bHRDbGFzcyA9IHJl\nc3VsdENsYXNzOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIHByb2plY3Rp\nb25DbGF1c2UoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHN3aXRjaCAobm9k\nZS5pZCkgewogICAgICAgIGNhc2UgSkpUVFlQRToKICAgICAgICAgICAgcmV0\ndXJuIHByb2plY3Rpb25DbGF1c2UoZmlyc3RDaGlsZChub2RlKSk7CiAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIGFzc2VtYmxlKG5vZGUp\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGV2YWxR\ndWVyeU9wZXJhdGlvbihRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAg\nICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSB3YW50IHRvIHNlbGVjdCwgZGVs\nZXRlLCBvciB1cGRhdGUKICAgICAgICBpZiAocm9vdCgpLmlkID09IEpKVFNF\nTEVDVCB8fCByb290KCkuaWQgPT0gSkpUU1VCU0VMRUNUKQogICAgICAgICAg\nICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1Q7\nCiAgICAgICAgZWxzZSBpZiAocm9vdCgpLmlkID09IEpKVERFTEVURSkKICAg\nICAgICAgICAgZXhwcy5vcGVyYXRpb24gPSBRdWVyeU9wZXJhdGlvbnMuT1Bf\nREVMRVRFOwogICAgICAgIGVsc2UgaWYgKHJvb3QoKS5pZCA9PSBKSlRVUERB\nVEUpCiAgICAgICAgICAgIGV4cHMub3BlcmF0aW9uID0gUXVlcnlPcGVyYXRp\nb25zLk9QX1VQREFURTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQUE9SVEVELCAidW5yZWNvZ25pemVk\nLW9wZXJhdGlvbiIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJv\nb3QoKSB9LCBudWxsKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbEdy\nb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAg\nIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1c2VzCiAgICAgICAgSlBRTE5vZGUg\nZ3JvdXBCeU5vZGUgPSByb290KCkuZmluZENoaWxkQnlJRChKSlRHUk9VUEJZ\nLCBmYWxzZSk7CgogICAgICAgIGlmIChncm91cEJ5Tm9kZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGludCBncm91cEJ5Q291bnQg\nPSBncm91cEJ5Tm9kZS5nZXRDaGlsZENvdW50KCk7CgogICAgICAgIGV4cHMu\nZ3JvdXBpbmcgPSBuZXcgVmFsdWVbZ3JvdXBCeUNvdW50XTsKCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBncm91cEJ5Q291bnQ7IGkrKykgewogICAg\nICAgICAgICBKUFFMTm9kZSBub2RlID0gZ3JvdXBCeU5vZGUuZ2V0Q2hpbGQo\naSk7CiAgICAgICAgICAgIFZhbHVlIHZhbCA9IGdldFZhbHVlKG5vZGUpOwog\nICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgUGF0aCkgewogICAgICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSAoKFBhdGgpIHZhbCkubGFz\ndCgpOwogICAgICAgICAgICAgICAgaWYgKGZtZCAhPSBudWxsICYmIGZtZC5n\nZXRWYWx1ZSgpLmdldFR5cGVNZXRhRGF0YSgpICE9IG51bGwgJiYgZm1kLmdl\ndFZhbHVlKCkuaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJjYW50LWdyb3VwYnktZW1i\nZWRkYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgbm9kZS5nZXRDaGlsZENvdW50KCkgPiAxID8gYXNzZW1ibGUobm9kZSkg\nOiBub2RlLnRleHQgfSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZXhwcy5ncm91cGluZ1tpXSA9IHZhbDsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGV2YWxIYXZpbmdDbGF1c2UoUXVlcnlFeHByZXNz\naW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFuZGxlIEhBVklORyBjbGF1c2Vz\nCiAgICAgICAgSlBRTE5vZGUgaGF2aW5nTm9kZSA9IHJvb3QoKS5maW5kQ2hp\nbGRCeUlEKEpKVEhBVklORywgZmFsc2UpOwoKICAgICAgICBpZiAoaGF2aW5n\nTm9kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGV4\ncHMuaGF2aW5nID0gZ2V0RXhwcmVzc2lvbihvbmx5Q2hpbGQoaGF2aW5nTm9k\nZSkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBldmFsT3JkZXJpbmdDbGF1\nc2VzKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRs\nZSBPUkRFUiBCWSBjbGF1c2VzCiAgICAgICAgSlBRTE5vZGUgb3JkZXJieSA9\nIHJvb3QoKS5maW5kQ2hpbGRCeUlEKEpKVE9SREVSQlksIGZhbHNlKTsKICAg\nICAgICBpZiAob3JkZXJieSAhPSBudWxsKSB7CiAgICAgICAgICAgIGludCBv\ncmRlcmNvdW50ID0gb3JkZXJieS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAg\nICAgIGV4cHMub3JkZXJpbmcgPSBuZXcgVmFsdWVbb3JkZXJjb3VudF07CiAg\nICAgICAgICAgIGV4cHMub3JkZXJpbmdDbGF1c2VzID0gbmV3IFN0cmluZ1tv\ncmRlcmNvdW50XTsKICAgICAgICAgICAgZXhwcy5vcmRlcmluZ0FsaWFzZXMg\nPSBuZXcgU3RyaW5nW29yZGVyY291bnRdOwogICAgICAgICAgICBleHBzLmFz\nY2VuZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRdOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7IGkrKykgewogICAg\nICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVyYnkuZ2V0Q2hpbGQo\naSk7CiAgICAgICAgICAgICAgICBKUFFMTm9kZSBmaXJzdENoaWxkID0gZmly\nc3RDaGlsZChub2RlKTsKICAgICAgICAgICAgICAgIGV4cHMub3JkZXJpbmdb\naV0gPSBnZXRWYWx1ZShmaXJzdENoaWxkKTsKICAgICAgICAgICAgICAgIGV4\ncHMub3JkZXJpbmdDbGF1c2VzW2ldID0gYXNzZW1ibGUoZmlyc3RDaGlsZCk7\nCiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5nQWxpYXNlc1tpXSA9IGZp\ncnN0Q2hpbGQudGV4dDsKCiAgICAgICAgICAgICAgICAvLyBvbW1pc3Npb24g\nb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBhc2NlbmRpbmcKICAgICAgICAg\nICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0gbm9kZS5nZXRDaGlsZENvdW50\nKCkgPD0gMSB8fAogICAgICAgICAgICAgICAgICAgIGxhc3RDaGlsZChub2Rl\nKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVlIDogZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gY2hlY2sgaWYgb3JkZXIgYnkgc2VsZWN0\nIGl0ZW0gcmVzdWx0IGFsaWFzCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgb3JkZXJjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZXhwcy5vcmRlcmluZ0NsYXVzZXNbaV0gIT0gbnVsbCAmJiAKICAgICAgICAg\nICAgICAgICAgICAhZXhwcy5vcmRlcmluZ0NsYXVzZXNbaV0uZXF1YWxzKCIi\nKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGogPSAwOyBqIDwgZXhwcy5wcm9qZWN0aW9ucy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmIChleHBzLnByb2pl\nY3Rpb25BbGlhc2VzW2pdLmVxdWFsc0lnbm9yZUNhc2UoCiAgICAgICAgICAg\nICAgICAgICAgICAgIGV4cHMub3JkZXJpbmdBbGlhc2VzW2ldKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5nW2ldID0gZXhwcy5w\ncm9qZWN0aW9uc1tqXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgRXhwcmVz\nc2lvbiBldmFsU2VsZWN0Q2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykg\newogICAgICAgIGlmIChleHBzLm9wZXJhdGlvbiAhPSBRdWVyeU9wZXJhdGlv\nbnMuT1BfU0VMRUNUKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgSlBRTE5vZGUgc2VsZWN0Tm9kZSA9IHJvb3QoKTsKCiAgICAgICAgSlBR\nTE5vZGUgc2VsZWN0Q2xhdXNlID0gc2VsZWN0Tm9kZS4KICAgICAgICAgICAg\nZmluZENoaWxkQnlJRChKSlRTRUxFQ1RDTEFVU0UsIGZhbHNlKTsKICAgICAg\nICBpZiAoc2VsZWN0Q2xhdXNlICE9IG51bGwgJiYgc2VsZWN0Q2xhdXNlLmhh\nc0NoaWxkSUQoSkpURElTVElOQ1QpKQogICAgICAgICAgICBleHBzLmRpc3Rp\nbmN0ID0gUXVlcnlFeHByZXNzaW9ucy5ESVNUSU5DVF9UUlVFIAogICAgICAg\nICAgICAgICAgICAgICAgICAgIHwgUXVlcnlFeHByZXNzaW9ucy5ESVNUSU5D\nVF9BVVRPOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IFF1ZXJ5RXhwcmVzc2lvbnMuRElTVElOQ1RfRkFMU0U7CgogICAgICAg\nIC8vIGhhbmRsZSBTRUxFQ1QgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIGV4\ncE5vZGUgPSBzZWxlY3ROb2RlLgogICAgICAgIGZpbmRDaGlsZEJ5SUQoSkpU\nU0VMRUNURVhQUkVTU0lPTlMsIHRydWUpOwogICAgICAgIGlmIChleHBOb2Rl\nID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICBpbnQgc2VsZWN0Q291bnQgPSBleHBOb2RlLmdldENoaWxk\nQ291bnQoKTsKICAgICAgICBKUFFMTm9kZSBzZWxlY3RDaGlsZCA9IGZpcnN0\nQ2hpbGQoZXhwTm9kZSk7CgogICAgICAgIGlmIChzZWxlY3RDbGF1c2UucGFy\nZW50LmlkID09IEpKVFNVQlNFTEVDVCkgewogICAgICAgICAgICBleHBzLmRp\nc3RpbmN0ICY9IH5RdWVyeUV4cHJlc3Npb25zLkRJU1RJTkNUX0FVVE87CiAg\nICAgICAgICAgIHJldHVybiBhc3NpZ25TdWJzZWxlY3RQcm9qZWN0aW9uKG9u\nbHlDaGlsZChzZWxlY3RDaGlsZCksIGV4cHMpOwogICAgICAgIH0KICAgICAg\nICAvLyBpZiB3ZSBhcmUgc2VsZWN0aW5nIGp1c3Qgb25lIHRoaW5nIGFuZCB0\naGF0IHRoaW5nIGlzIHRoZQogICAgICAgIC8vIHNjaGVtYSdzIGFsaWFzLCB0\naGVuIGRvIG5vdCB0cmVhdCBpdCBhcyBhIHByb2plY3Rpb24KICAgICAgICBp\nZiAoc2VsZWN0Q291bnQgPT0gMSAmJiBzZWxlY3RDaGlsZCAhPSBudWxsICYm\nCiAgICAgICAgICAgIHNlbGVjdENoaWxkLmdldENoaWxkQ291bnQoKSA9PSAx\nICYmCiAgICAgICAgICAgIG9ubHlDaGlsZChzZWxlY3RDaGlsZCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IG9ubHlDaGlsZChz\nZWxlY3RDaGlsZCk7CiAgICAgICAgICAgIGlmIChjaGlsZC5pZCA9PSBKSlRT\nQ0FMQVJFWFBSRVNTSU9OKQogICAgICAgICAgICAgICAgY2hpbGQgPSBvbmx5\nQ2hpbGQoY2hpbGQpOwogICAgICAgICAgICBpZiAoYXNzZXJ0U2NoZW1hQWxp\nYXMoKS5lcXVhbHNJZ25vcmVDYXNlKGNoaWxkLnRleHQpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0g\nCiAgICAgICAgLy8gSlBRTCBkb2VzIG5vdCBmaWx0ZXIgcmVsYXRpb25hbCBq\nb2lucyBmb3IgcHJvamVjdGlvbnMKICAgICAgICBleHBzLmRpc3RpbmN0ICY9\nIH5RdWVyeUV4cHJlc3Npb25zLkRJU1RJTkNUX0FVVE87CiAgICAgICAgZXhw\ncy5wcm9qZWN0aW9ucyA9IG5ldyBWYWx1ZVtzZWxlY3RDb3VudF07CiAgICAg\nICAgTGlzdDxWYWx1ZT4gcHJvamVjdGlvbnMgPSBuZXcgQXJyYXlMaXN0PFZh\nbHVlPigpOwogICAgICAgIExpc3Q8U3RyaW5nPiBhbGlhc2VzID0gbmV3IEFy\ncmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgTGlzdDxTdHJpbmc+IGNsYXVz\nZXMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBldmFsUHJv\namVjdGlvbnNSZXN1bHRTaGFwZShleHBOb2RlLCBleHBzLCBwcm9qZWN0aW9u\ncywgYWxpYXNlcywgY2xhdXNlcyk7CiAgICAgICAgZXhwcy5wcm9qZWN0aW9u\ncyA9IHByb2plY3Rpb25zLnRvQXJyYXkobmV3IFZhbHVlW3Byb2plY3Rpb25z\nLnNpemUoKV0pOwogICAgICAgIGV4cHMucHJvamVjdGlvbkFsaWFzZXMgPSBh\nbGlhc2VzLnRvQXJyYXkobmV3IFN0cmluZ1thbGlhc2VzLnNpemUoKV0pOwog\nICAgICAgIGV4cHMucHJvamVjdGlvbkNsYXVzZXMgPSBjbGF1c2VzLnRvQXJy\nYXkobmV3IFN0cmluZ1tjbGF1c2VzLnNpemUoKV0pOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIGFzc2VydFNjaGVt\nYUFsaWFzKCkgewogICAgICAgIFN0cmluZyBhbGlhcyA9IGN0eCgpLnNjaGVt\nYUFsaWFzOwoKICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImFsaWFzLXJlcXVp\ncmVkIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgY3R4KCkubWV0\nYSB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAg\nIHByb3RlY3RlZCBFeHByZXNzaW9uIGV2YWxGZXRjaEpvaW5zKFF1ZXJ5RXhw\ncmVzc2lvbnMgZXhwcykgewogICAgICAgIEV4cHJlc3Npb24gZmlsdGVyID0g\nbnVsbDsKCiAgICAgICAgLy8gaGFuZGxlIEpPSU4gRkVUQ0gKICAgICAgICBT\nZXQ8U3RyaW5nPiBqb2lucyA9IG51bGw7CiAgICAgICAgU2V0PFN0cmluZz4g\naW5uZXJKb2lucyA9IG51bGw7CgogICAgICAgIEpQUUxOb2RlW10gb3V0ZXJz\nID0gcm9vdCgpLmZpbmRDaGlsZHJlbkJ5SUQoSkpUT1VURVJGRVRDSEpPSU4p\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBvdXRlcnMgIT0gbnVsbCAmJiBp\nIDwgb3V0ZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAoam9pbnMgPT0g\nbnVsbCA/IGpvaW5zID0gbmV3IFRyZWVTZXQ8U3RyaW5nPigpIDogam9pbnMp\nLgogICAgICAgICAgICAgICAgYWRkKGdldFBhdGgob25seUNoaWxkKG91dGVy\nc1tpXSkpLmxhc3QoKS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICBK\nUFFMTm9kZVtdIGlubmVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpK\nVElOTkVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW5u\nZXJzICE9IG51bGwgJiYgaSA8IGlubmVycy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBTdHJpbmcgcGF0aCA9IGdldFBhdGgob25seUNoaWxkKGlubmVy\nc1tpXSkpLmxhc3QoKQogICAgICAgICAgICAgICAgLmdldEZ1bGxOYW1lKGZh\nbHNlKTsKICAgICAgICAgICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5l\ndyBUcmVlU2V0PFN0cmluZz4oKSA6IGpvaW5zKS5hZGQocGF0aCk7CiAgICAg\nICAgICAgIChpbm5lckpvaW5zID09IG51bGwgCiAgICAgICAgICAgICAgICAg\nICAgPyBpbm5lckpvaW5zID0gbmV3IFRyZWVTZXQ8U3RyaW5nPigpIAogICAg\nICAgICAgICAgICAgICAgIDogaW5uZXJKb2lucykuYWRkKHBhdGgpOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAg\nIGV4cHMuZmV0Y2hQYXRocyA9IChTdHJpbmdbXSkgam9pbnMuCiAgICAgICAg\nICAgICAgICB0b0FycmF5KG5ldyBTdHJpbmdbam9pbnMuc2l6ZSgpXSk7CiAg\nICAgICAgaWYgKGlubmVySm9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgZXhw\ncy5mZXRjaElubmVyUGF0aHMgPSAoU3RyaW5nW10pIGlubmVySm9pbnMuCiAg\nICAgICAgICAgICAgICB0b0FycmF5KG5ldyBTdHJpbmdbaW5uZXJKb2lucy5z\naXplKCldKTsKCiAgICAgICAgcmV0dXJuIGZpbHRlcjsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBldmFsU2V0Q2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMg\nZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBTRVQgZmllbGQgPSB2YWx1ZQog\nICAgICAgIEpQUUxOb2RlW10gbm9kZXMgPSByb290KCkuZmluZENoaWxkcmVu\nQnlJRChKSlRVUERBVEVJVEVNKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\nbm9kZXMgIT0gbnVsbCAmJiBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChmaXJzdENoaWxkKG5vZGVz\nW2ldKSk7CiAgICAgICAgICAgIGlmIChwYXRoLmxhc3QoKS5nZXRWYWx1ZSgp\nLmdldEVtYmVkZGVkTWV0YURhdGEoKSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImNhbnQtYnVsay11\ncGRhdGUtZW1iZWRkYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXthc3NlbWJsZShmaXJzdENoaWxkKG5vZGVzW2ldKSl9LCBu\ndWxsKTsKCiAgICAgICAgICAgIEpQUUxOb2RlIGxhc3RDaGlsZCA9IGxhc3RD\naGlsZChub2Rlc1tpXSk7CiAgICAgICAgICAgIFZhbHVlIHZhbCA9IChsYXN0\nQ2hpbGQuY2hpbGRyZW4gPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAg\nICA/IG51bGwgOiBnZXRWYWx1ZShvbmx5Q2hpbGQobGFzdENoaWxkKSk7CiAg\nICAgICAgICAgIGV4cHMucHV0VXBkYXRlKHBhdGgsIHZhbCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsV2hlcmVDbGF1\nc2UoKSB7CiAgICAgICAgLy8gZXZhbHVhdGUgdGhlIFdIRVJFIGNsYXVzZQog\nICAgICAgIEpQUUxOb2RlIHdoZXJlTm9kZSA9IHJvb3QoKS5maW5kQ2hpbGRC\neUlEKEpKVFdIRVJFLCBmYWxzZSk7CiAgICAgICAgaWYgKHdoZXJlTm9kZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gKEV4cHJlc3Npb24pIGV2YWwod2hlcmVOb2RlKTsKICAgIH0KCiAgICBw\ncml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21DbGF1c2UoYm9vbGVhbiBuZWVk\nc0FsaWFzKSB7CiAgICAgICAgLy8gYnVpbGQgdXAgdGhlIGFsaWFzIG1hcCBp\nbiB0aGUgRlJPTSBjbGF1c2UKICAgICAgICBKUFFMTm9kZSBmcm9tID0gcm9v\ndCgpLmZpbmRDaGlsZEJ5SUQoSkpURlJPTSwgZmFsc2UpOwogICAgICAgIGlm\nIChmcm9tID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0\naW9uKEVYX1VTRVIsICJuby1mcm9tLWNsYXVzZSIsIG51bGwsIG51bGwpOwog\nICAgICAgIHJldHVybiBldmFsRnJvbUNsYXVzZShmcm9tLCBuZWVkc0FsaWFz\nKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21DbGF1\nc2UoSlBRTE5vZGUgZnJvbSwgYm9vbGVhbiBuZWVkc0FsaWFzKSB7CiAgICAg\nICAgRXhwcmVzc2lvbiBleHAgPSBudWxsOwoKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZyb20uY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgSlBRTE5vZGUgbm9kZSA9IGZyb20uY2hpbGRyZW5baV07CgogICAg\nICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRGUk9NSVRFTSkKICAgICAgICAg\nICAgICAgIGV4cCA9IGV2YWxGcm9tSXRlbShleHAsIG5vZGUsIG5lZWRzQWxp\nYXMpOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVE9VVEVS\nSk9JTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpvaW4obm9kZSwgZmFs\nc2UsIGV4cCk7CiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpU\nSU5ORVJKT0lOKQogICAgICAgICAgICAgICAgZXhwID0gYWRkSm9pbihub2Rl\nLCB0cnVlLCBleHApOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09\nIEpKVElOTkVSRkVUQ0hKT0lOKQogICAgICAgICAgICAgICAgOyAvLyB3ZSBo\nYW5kbGUgaW5uZXIgZmV0Y2ggam9pbnMgaW4gdGhlIGV2YWxGZXRjaEpvaW5z\nKCkgbWV0aG9kCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpU\nT1VURVJGRVRDSEpPSU4pCiAgICAgICAgICAgICAgICA7IC8vIHdlIGhhbmRs\nZSBvdXRlciBmZXRjaCBqb2lucyBpbiB0aGUgZXZhbEZldGNoSm9pbnMoKSBt\nZXRob2QKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIsCiAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICBw\ncml2YXRlIEV4cHJlc3Npb24gZ2V0U3VicXVlcnkoU3RyaW5nIGFsaWFzLCBQ\nYXRoIHBhdGgsIEV4cHJlc3Npb24gZXhwKSB7CiAgICAgICAgVmFsdWUgdmFy\nID0gZ2V0VmFyaWFibGUoYWxpYXMsIHRydWUpOwogICAgICAgIC8vIHRoaXMg\nYmluZCBpcyBmb3IgdmFsaWRhdGVNYXBQYXRoIHRvIHJlc29sdmUgYWxpYXMK\nICAgICAgICBFeHByZXNzaW9uIGJpbmRWYXIgPSBmYWN0b3J5LmJpbmRWYXJp\nYWJsZSh2YXIsIHBhdGgpOwogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\ncGF0aC5sYXN0KCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjYW5kaWRhdGUg\nPSBnZXRGaWVsZFR5cGUoZm1kKTsKICAgICAgICBpZiAoY2FuZGlkYXRlID09\nIG51bGwgJiYgZm1kLmlzRWxlbWVudENvbGxlY3Rpb24oKSkKICAgICAgICAg\nICAgY2FuZGlkYXRlID0gZm1kLmdldERlZmluaW5nTWV0YURhdGEoKTsKCiAg\nICAgICAgc2V0Q2FuZGlkYXRlKGNhbmRpZGF0ZSwgYWxpYXMpOwoKICAgICAg\nICBDb250ZXh0IHN1YkNvbnRleHQgPSBjdHgoKTsKICAgICAgICBTdWJxdWVy\neSBzdWJxdWVyeSA9IGN0eCgpLmdldFN1YnF1ZXJ5KCk7CiAgICAgICAgaWYg\nKHN1YnF1ZXJ5ID09IG51bGwpewogICAgICAgICAgICBzdWJxdWVyeSA9IGZh\nY3RvcnkubmV3U3VicXVlcnkoY2FuZGlkYXRlLCB0cnVlLCBhbGlhcyk7CiAg\nICAgICAgICAgIHN1YkNvbnRleHQuc2V0U3VicXVlcnkoc3VicXVlcnkpOwog\nICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3VicXVlcnku\nc2V0U3VicUFsaWFzKGFsaWFzKTsKICAgICAgICB9CgogICAgICAgIFBhdGgg\nc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0aChzdWJxdWVyeSk7CiAgICAgICAg\nc3VicGF0aC5zZXRTY2hlbWFBbGlhcyhwYXRoLmdldENvcnJlbGF0aW9uVmFy\nKCkpOwogICAgICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY2FuZGlkYXRlKTsK\nICAgICAgICBzdWJxdWVyeS5zZXRNZXRhRGF0YShjYW5kaWRhdGUpOwogICAg\nICAgIGlmIChmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigpKQogICAgICAgICAg\nICBleHAgPSBhbmQoZXhwLCBiaW5kVmFyKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGV4cCA9IGFuZChleHAsIGZhY3RvcnkuZXF1YWwocGF0aCwgc3Vi\ncGF0aCkpOwoKICAgICAgICByZXR1cm4gZXhwOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyBhIGpvaW4gY29uZGl0aW9uIHRvIHRoZSBnaXZlbiBleHBy\nZXNzaW9uLgogICAgICoKICAgICAqIEBwYXJhbSBub2RlIHRoZSBub2RlIHRv\nIGNoZWNrCiAgICAgKiBAcGFyYW0gaW5uZXIgd2hldGhlciBvciBub3QgdGhl\nIGpvaW4gc2hvdWxkIGJlIGFuIGlubmVyIGpvaW4KICAgICAqIEBwYXJhbSBl\neHAgYW4gZXhpc3RpbmcgZXhwcmVzc2lvbiB0byBBTkQsIG9yIG51bGwgaWYg\nbm9uZQogICAgICogQHJldHVybiB0aGUgRXhwcmVzc2lvbiB3aXRoIHRoZSBq\nb2luIGNvbmRpdGlvbiBhZGRlZAogICAgICovCiAgICBwcml2YXRlIEV4cHJl\nc3Npb24gYWRkSm9pbihKUFFMTm9kZSBub2RlLCBib29sZWFuIGlubmVyLCBF\neHByZXNzaW9uIGV4cCkgewogICAgICAgIC8vIHRoZSB0eXBlIHdpbGwgYmUg\ndGhlIGRlY2xhcmVkIHR5cGUgZm9yIHRoZSBmaWVsZAogICAgICAgIEpQUUxO\nb2RlIGZpcnN0Q2hpbGQgPSBmaXJzdENoaWxkKG5vZGUpOwogICAgICAgIFBh\ndGggcGF0aCA9IG51bGw7CiAgICAgICAgaWYgKGZpcnN0Q2hpbGQuaWQgPT0g\nSkpUUVVBTElGSUVEUEFUSCkKICAgICAgICAgICAgcGF0aCA9IChQYXRoKSBn\nZXRRdWFsaWZpZWRQYXRoKGZpcnN0Q2hpbGQpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgcGF0aCA9IGdldFBhdGgoZmlyc3RDaGlsZCwgZmFsc2UsIGlu\nbmVyKTsKCiAgICAgICAgSlBRTE5vZGUgYWxpYXMgPSBub2RlLmdldENoaWxk\nQ291bnQoKSA+PSAyID8gcmlnaHQobm9kZSkgOiBudWxsOwogICAgICAgIC8v\nIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJxdWVyeSdzIGZyb20gY2xhdXNlIGRv\nIG5vdCBzdGFydCB3aXRoIAogICAgICAgIC8vIGlkZW50aWZpY2F0aW9uX3Zh\ncmlhYmxlX2RlY2xhcmF0aW9uKCkKICAgICAgICBpZiAoaW5uZXIgJiYgY3R4\nKCkuZ2V0UGFyZW50KCkgIT0gbnVsbCAmJiBjdHgoKS5zY2hlbWFBbGlhcyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShhbGlh\ncy50ZXh0LCBwYXRoLCBleHApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIGFkZEpvaW4ocGF0aCwgYWxpYXMsIGV4cCk7CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGFkZEpvaW4oUGF0aCBwYXRoLCBKUFFMTm9kZSBhbGlh\nc05vZGUsCiAgICAgICAgRXhwcmVzc2lvbiBleHApIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IHBhdGgubGFzdCgpOwoKICAgICAgICBpZiAoZm1k\nID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJwYXRoLW5vLW1ldGEiLAogICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBwYXRoLCBudWxsIH0sIG51bGwpOwoKICAgICAgICBTdHJpbmcg\nYWxpYXMgPSBhbGlhc05vZGUgIT0gbnVsbCA/IGFsaWFzTm9kZS50ZXh0IDog\nbmV4dEFsaWFzKCk7CgogICAgICAgIFZhbHVlIHZhciA9IGdldFZhcmlhYmxl\nKGFsaWFzLCB0cnVlKTsKICAgICAgICB2YXIuc2V0TWV0YURhdGEoZ2V0Rmll\nbGRUeXBlKGZtZCkpOwoKICAgICAgICBFeHByZXNzaW9uIGpvaW4gPSBudWxs\nOwoKICAgICAgICAvLyBpZiB0aGUgdmFyaWFibGUgaXMgYWxyZWFkeSBib3Vu\nZCwgZ2V0IHRoZSB2YXIncyB2YWx1ZSBhbmQKICAgICAgICAvLyBkbyBhIHJl\nZ3VsYXIgY29udGFpbnMgd2l0aCB0aGF0CiAgICAgICAgYm9vbGVhbiBib3Vu\nZCA9IGlzQm91bmQodmFyKTsKICAgICAgICBpZiAoYm91bmQpIHsKICAgICAg\nICAgICAgdmFyID0gZ2V0VmFsdWUoYWxpYXNOb2RlLCBWQVJfUEFUSCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYmluZCh2YXIpOwogICAgICAg\nICAgICBqb2luID0gYW5kKGpvaW4sIGZhY3RvcnkuYmluZFZhcmlhYmxlKHZh\nciwgcGF0aCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFmbWQuaXNUeXBl\nUEMoKSkgLy8gbXVsdGktdmFsdWVkIHJlbGF0aW9uCiAgICAgICAgewogICAg\nICAgICAgICBpZiAoYm91bmQpCiAgICAgICAgICAgICAgICBqb2luID0gYW5k\nKGpvaW4sIGZhY3RvcnkuY29udGFpbnMocGF0aCwgdmFyKSk7CgogICAgICAg\nICAgICBzZXRJbXBsaWNpdENvbnRhaW5zVHlwZXMocGF0aCwgdmFyLCBDT05U\nQUlOU19UWVBFX0VMRU1FTlQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIGFuZChleHAsIGpvaW4pOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lv\nbiBldmFsRnJvbUl0ZW0oRXhwcmVzc2lvbiBleHAsIEpQUUxOb2RlIG5vZGUs\nCiAgICAgICAgYm9vbGVhbiBuZWVkc0FsaWFzKSB7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjbWQgPSByZXNvbHZlQ2xhc3NNZXRhRGF0YShmaXJzdENoaWxk\nKG5vZGUpKTsKCiAgICAgICAgU3RyaW5nIGFsaWFzID0gbnVsbDsKCiAgICAg\nICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpIDwgMikgewogICAgICAgICAg\nICBpZiAobmVlZHNBbGlhcykKICAgICAgICAgICAgICAgIHRocm93IHBhcnNl\nRXhjZXB0aW9uKEVYX1VTRVIsICJhbGlhcy1yZXF1aXJlZCIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjbWQgfSwgbnVsbCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxpYXMgPSByaWdodChub2RlKS50\nZXh0OwogICAgICAgICAgICBKUFFMTm9kZSBsZWZ0ID0gbGVmdChub2RlKTsK\nICAgICAgICAgICAgYWRkU2NoZW1hVG9Db250ZXh0KGFsaWFzLCBjbWQpOwoK\nICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3ZSBhcmUgcmVm\nZXJyaW5nIHRvIGEgcGF0aCBpbiB0aGUgZnJvbQogICAgICAgICAgICAvLyBj\nbGF1c2UsIHNpbmNlIHdlIG1pZ2h0IGJlIGluIGEgc3VicXVlcnkgYWdhaW5z\ndCBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKGlzUGF0aChsZWZ0KSkg\newogICAgICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChsZWZ0KTsK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShhbGlhcywgcGF0\naCwgZXhwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIC8vIHdlIGhhdmUgYW4gYWxpYXM6IGJpbmQgaXQgYXMgYSB2YXJpYWJsZQog\nICAgICAgICAgICAgICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUoYWxpYXMs\nIHRydWUpOwogICAgICAgICAgICAgICAgdmFyLnNldE1ldGFEYXRhKGNtZCk7\nCiAgICAgICAgICAgICAgICBiaW5kKHZhcik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vICMjIyB3ZSBhc3NpZ24gdGhlIGZpcnN0IEZS\nT01JVEVNIGluc3RhbmNlIHdlIHNlZSBhcwogICAgICAgIC8vIHRoZSBnbG9i\nYWwgY2FuZGlkYXRlLCB3aGljaCBpcyBpbmNvcnJlY3Q6IHdlIHNob3VsZAog\nICAgICAgIC8vIGluc3RlYWQgYmUgbWFwcGluZyB0aGlzIHRvIHRoZSBTRUxF\nQ1RJVEVNIHRvIHNlZQogICAgICAgIC8vIHdoaWNoIGlzIHRoZSBkZXNpcmVk\nIGNhbmRpZGF0ZQogICAgICAgIGlmIChjdHgoKS5zY2hlbWFBbGlhcyA9PSBu\ndWxsKQogICAgICAgICAgICBzZXRDYW5kaWRhdGUoY21kLCBhbGlhcyk7CiAg\nICAgICAgZWxzZSAgCiAgICAgICAgICAgIGFkZEFjY2Vzc1BhdGgoY21kKTsK\nCiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBpc0RlY2xhcmVkVmFyaWFibGUoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICAvLyBKUFFMIGRvZXNuJ3Qgc3VwcG9ydCBkZWNsYXJpbmcgdmFyaWFibGVz\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2hlY2sgdG8gc2VlIGlmIHRoZSBzcGVjaWZpYyBub2RlIGlzIGEgcGF0aCAo\ndnMuIGEgc2NoZW1hIG5hbWUpCiAgICAgKi8KICAgIGJvb2xlYW4gaXNQYXRo\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENv\ndW50KCkgPCAyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nIGZpbmFsIFN0cmluZyBuYW1lID0gZmlyc3RDaGlsZChub2RlKS50ZXh0Owog\nICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBj\nbGFzcyBuYW1lIGlzIHRoZSBhbGlhcwogICAgICAgIC8vIGZvciB0aGUgY2Fu\nZGlkYXRlICh3ZSBkb24ndCB1c2UgdmFyaWFibGVzIGZvciB0aGlzKQogICAg\nICAgIGlmIChnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBpZiAoIWlzU2VlblZh\ncmlhYmxlKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIGZpbmFsIFZhbHVlIHZhciA9IGdldFZhcmlhYmxlKG5hbWUsIGZhbHNl\nKTsKCiAgICAgICAgaWYgKHZhciAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gaXNCb3VuZCh2YXIpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3NNZXRhRGF0YSBnZXRGaWVsZFR5\ncGUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoZm1kID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDbGFzc01l\ndGFEYXRhIGNtZCA9IG51bGw7CiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQ7\nCgogICAgICAgIGlmICgodm1kID0gZm1kLmdldEVsZW1lbnQoKSkgIT0gbnVs\nbCkKICAgICAgICAgICAgY21kID0gdm1kLmdldERlY2xhcmVkVHlwZU1ldGFE\nYXRhKCk7CiAgICAgICAgZWxzZSBpZiAoKHZtZCA9IGZtZC5nZXRLZXkoKSkg\nIT0gbnVsbCkKICAgICAgICAgICAgY21kID0gdm1kLmdldERlY2xhcmVkVHlw\nZU1ldGFEYXRhKCk7CiAgICAgICAgZWxzZSBpZiAoKHZtZCA9IGZtZC5nZXRW\nYWx1ZSgpKSAhPSBudWxsKQogICAgICAgICAgICBjbWQgPSB2bWQuZ2V0RGVj\nbGFyZWRUeXBlTWV0YURhdGEoKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxs\nIHx8IGNtZC5nZXREZXNjcmliZWRUeXBlKCkgPT0gT2JqZWN0LmNsYXNzKQog\nICAgICAgICAgICBjbWQgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEo\nKTsKCiAgICAgICAgcmV0dXJuIGNtZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIElkZW50aWZpY2F0aW9uIHZhcmlhYmxlcyBpbiBKUFFMIGFyZSBjYXNlIGlu\nc2Vuc2l0aXZlLCBzbyBsb3dlci1jYXNlCiAgICAgKiBhbGwgdmFyaWFibGVz\nIHdlIGFyZSBnb2luZyB0byBiaW5kLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nVmFsdWUgZ2V0VmFyaWFibGUoU3RyaW5nIGlkLCBib29sZWFuIGJpbmQpIHsK\nICAgICAgICBpZiAoaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGlmIChiaW5kICYmIGdldERlZmluZWRWYXJpYWJsZShp\nZCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVZhcmlhYmxl\nKGlkLCBiaW5kKTsKCiAgICAgICAgcmV0dXJuIHN1cGVyLmdldFZhcmlhYmxl\nKGlkLnRvTG93ZXJDYXNlKCksIGJpbmQpOwogICAgfQoKICAgIHByb3RlY3Rl\nZCBWYWx1ZSBnZXREZWZpbmVkVmFyaWFibGUoU3RyaW5nIGlkKSB7CiAgICAg\nICAgcmV0dXJuIGN0eCgpLmdldFZhcmlhYmxlKGlkKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgYm9vbGVhbiBpc1NlZW5WYXJpYWJsZShTdHJpbmcgdmFyKSB7\nCiAgICAgICAgQ29udGV4dCBjID0gY3R4KCkuZmluZENvbnRleHQodmFyKTsK\nICAgICAgICBpZiAoYyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBjbGFzcyBuYW1lIHVzaW5nIHRoZSBjaGlsZHJlbiBv\nZiB0aGUgSlBRTE5vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGFz\nc2VydFNjaGVtYU5hbWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGlmIChu\nb2RlLmlkICE9IEpKVEFCU1RSQUNUU0NIRU1BTkFNRSkKICAgICAgICAgICAg\ndGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1pZGVudGlmZXIi\nLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwp\nOwoKICAgICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGNoZWNrRW1iZWRkYWJsZShWYWx1ZSB2YWwpIHsKICAg\nICAgICBjaGVja0VtYmVkZGFibGUodmFsLCBjdXJyZW50UXVlcnkoKSk7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjaGVja0VtYmVkZGFi\nbGUoVmFsdWUgdmFsLCBTdHJpbmcgY3VycmVudFF1ZXJ5KSB7CiAgICAgICAg\nUGF0aCBwYXRoID0gdmFsIGluc3RhbmNlb2YgUGF0aCA/IChQYXRoKSB2YWwg\nOiBudWxsOwogICAgICAgIGlmIChwYXRoID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRoLmxh\nc3QoKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bSA9IGZtZC5pc0VsZW1l\nbnRDb2xsZWN0aW9uKCkgPyBmbWQuZ2V0RWxlbWVudCgpCiAgICAgICAgICAg\nIDogZm1kLmdldFZhbHVlKCk7CiAgICAgICAgaWYgKHZtLmdldEVtYmVkZGVk\nTWV0YURhdGEoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1wcmVkaWNhdGUiLAogICAgICAg\nICAgICAvLyAgICBuZXcgT2JqZWN0W117IGN1cnJlbnRRdWVyeSgpIH0sIG51\nbGwpOwogICAgICAgICAgICBTdHJpbmcgYXJnU3RyID0gX2xvYy5nZXQoImJh\nZC1wcmVkaWNhdGUiLCAKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7\nZm1kLmdldE5hbWUoKX0pLmdldE1lc3NhZ2UoKTsKICAgICAgICAgICAgTWVz\nc2FnZSBtc2cgPSBfbG9jLmdldCgicGFyc2UtZXJyb3IiLCBhcmdTdHIsIGN1\ncnJlbnRRdWVyeSk7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKG1zZywgbnVsbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVjdXJzaXZlIGhlbHBlciBtZXRob2QgdG8gZXZhbHVhdGUgdGhlIGdp\ndmVuIG5vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGV2YWwoSlBR\nTE5vZGUgbm9kZSkgewogICAgICAgIFZhbHVlIHZhbDEgPSBudWxsOwogICAg\nICAgIFZhbHVlIHZhbDIgPSBudWxsOwogICAgICAgIFZhbHVlIHZhbDMgPSBu\ndWxsOwoKICAgICAgICBib29sZWFuIG5vdCA9IG5vZGUubm90OwoKICAgICAg\nICBzd2l0Y2ggKG5vZGUuaWQpIHsKICAgICAgICAgICAgY2FzZSBKSlRTQ0FM\nQVJFWFBSRVNTSU9OOgogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25s\neUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUVFlQRToKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRUeXBlKG9ubHlDaGlsZChub2RlKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVFRZUEVMSVRFUkFMOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFR5cGVMaXRlcmFsKG5vZGUpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRDTEFTU05BTUU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UGF0aE9yQ29uc3RhbnQobm9kZSk7CgogICAgICAgICAgICBjYXNlIEpK\nVENBU0U6CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQo\nbm9kZSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTSU1QTEVDQVNFOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFNpbXBsZUNhc2VFeHByZXNzaW9uKG5v\nZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRHRU5FUkFMQ0FTRToKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRHZW5lcmFsQ2FzZUV4cHJlc3Npb24obm9k\nZSk7CgogICAgICAgICAgICBjYXNlIEpKVFdIRU46CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0V2hlbkNvbmRpdGlvbihub2RlKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUV0hFTlNDQUxBUjoKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRXaGVuU2NhbGFyKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRDT0FM\nRVNDRToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb2FsZXNjZUV4cHJl\nc3Npb24obm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVE5VTExJRjoKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXROdWxsSWZFeHByZXNzaW9uKG5vZGUp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRXSEVSRTogLy8gdG9wLWxldmVsIFdI\nRVJFIGNsYXVzZQogICAgICAgICAgICAgICAgcmV0dXJuIGdldEV4cHJlc3Np\nb24ob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQk9P\nTEVBTkxJVEVSQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5u\nZXdMaXRlcmFsKCJ0cnVlIi5lcXVhbHNJZ25vcmVDYXNlCiAgICAgICAgICAg\nICAgICAgICAgKG5vZGUudGV4dCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9CT09M\nRUFOKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSU5URUdFUkxJVEVSQUw6CiAg\nICAgICAgICAgICAgICAvLyB1c2UgQmlnRGVjaW1hbCBiZWNhdXNlIGl0IGNh\nbiBoYW5kbGUgcGFyc2luZyBleHBvbmVudHMKICAgICAgICAgICAgICAgIEJp\nZ0RlY2ltYWwgaW50bGl0ID0gbmV3IEJpZ0RlY2ltYWwKICAgICAgICAgICAg\nICAgICAgICAobm9kZS50ZXh0LmVuZHNXaXRoKCJsIikgfHwgbm9kZS50ZXh0\nLmVuZHNXaXRoKCJMIikKICAgICAgICAgICAgICAgICAgICAgICAgPyBub2Rl\nLnRleHQuc3Vic3RyaW5nKDAsIG5vZGUudGV4dC5sZW5ndGgoKSAtIDEpCiAg\nICAgICAgICAgICAgICAgICAgICAgIDogbm9kZS50ZXh0KS4KICAgICAgICAg\nICAgICAgICAgICBtdWx0aXBseShuZXcgQmlnRGVjaW1hbChuZWdhdGl2ZShu\nb2RlKSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0\nZXJhbChuZXcgTG9uZyhpbnRsaXQubG9uZ1ZhbHVlKCkpLAogICAgICAgICAg\nICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRERUNJTUFMTElURVJBTDoKICAgICAgICAgICAgICAgIEJpZ0Rl\nY2ltYWwgZGVjbGl0ID0gbmV3IEJpZ0RlY2ltYWwKICAgICAgICAgICAgICAg\nICAgICAobm9kZS50ZXh0LmVuZHNXaXRoKCJkIikgfHwgbm9kZS50ZXh0LmVu\nZHNXaXRoKCJEIikgfHwKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS50\nZXh0LmVuZHNXaXRoKCJmIikgfHwgbm9kZS50ZXh0LmVuZHNXaXRoKCJGIikK\nICAgICAgICAgICAgICAgICAgICAgICAgPyBub2RlLnRleHQuc3Vic3RyaW5n\nKDAsIG5vZGUudGV4dC5sZW5ndGgoKSAtIDEpCiAgICAgICAgICAgICAgICAg\nICAgICAgIDogbm9kZS50ZXh0KS4KICAgICAgICAgICAgICAgICAgICBtdWx0\naXBseShuZXcgQmlnRGVjaW1hbChuZWdhdGl2ZShub2RlKSkpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbChkZWNsaXQsIExp\ndGVyYWwuVFlQRV9OVU1CRVIpOwoKICAgICAgICAgICAgY2FzZSBKSlRTVFJJ\nTkdMSVRFUkFMOgogICAgICAgICAgICBjYXNlIEpKVFRSSU1DSEFSQUNURVI6\nCiAgICAgICAgICAgIGNhc2UgSkpURVNDQVBFQ0hBUkFDVEVSOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbCh0cmltUXVvdGVz\nKG5vZGUudGV4dCksCiAgICAgICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBF\nX1NRX1NUUklORyk7CgogICAgICAgICAgICBjYXNlIEpKVFBBVFRFUk5WQUxV\nRToKICAgICAgICAgICAgICAgIHJldHVybiBldmFsKGZpcnN0Q2hpbGQobm9k\nZSkpOwoKICAgICAgICAgICAgY2FzZSBKSlROQU1FRElOUFVUUEFSQU1FVEVS\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFBhcmFtZXRlcihvbmx5Q2hp\nbGQobm9kZSkudGV4dCwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUUE9TSVRJT05BTElOUFVUUEFSQU1FVEVSOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFBhcmFtZXRlcihub2RlLnRleHQsIHRydWUsIGZhbHNl\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09MTEVDVElPTlBBUkFNRVRFUjoK\nICAgICAgICAgICAgICAgIEpQUUxOb2RlIGNoaWxkID0gb25seUNoaWxkKG5v\nZGUpOwogICAgICAgICAgICAgICAgYm9vbGVhbiBwb3NpdGlvbmFsID0gY2hp\nbGQuaWQgPT0gSkpUUE9TSVRJT05BTElOUFVUUEFSQU1FVEVSOwogICAgICAg\nICAgICAgICAgaWYgKCFwb3NpdGlvbmFsKQogICAgICAgICAgICAgICAgICAg\nIGNoaWxkID0gb25seUNoaWxkKGNoaWxkKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQYXJhbWV0ZXIoY2hpbGQudGV4dCwgCiAgICAgICAgICAgICAg\nICAgICAgcG9zaXRpb25hbCwgdHJ1ZSk7CgogICAgICAgICAgICBjYXNlIEpK\nVE9SOiAvLyB4IE9SIHkKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLm9yKGdldEV4cHJlc3Npb24obGVmdChub2RlKSksCiAgICAgICAgICAgICAg\nICAgICAgZ2V0RXhwcmVzc2lvbihyaWdodChub2RlKSkpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRBTkQ6IC8vIHggQU5EIHkKICAgICAgICAgICAgICAgIHJl\ndHVybiBhbmQoZ2V0RXhwcmVzc2lvbihsZWZ0KG5vZGUpKSwKICAgICAgICAg\nICAgICAgICAgICBnZXRFeHByZXNzaW9uKHJpZ2h0KG5vZGUpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVEVRVUFMUzogLy8geCA9IHkKICAgICAgICAgICAg\nICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAg\nICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAg\nICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZXF1YWwodmFsMSwgdmFsMik7\nCgogICAgICAgICAgICBjYXNlIEpKVE5PVEVRVUFMUzogLy8geCA8PiB5CiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAg\nICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBu\ndWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5vdEVxdWFs\nKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRMRVNTVEhBTjog\nLy8geCA8IHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0\nKG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdo\ndChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZh\nbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkubGVzc1RoYW4odmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpK\nVExFU1NPUkVRVUFMOiAvLyB4IDw9IHkKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkubGVzc1RoYW5FcXVhbCh2YWwxLCB2YWwyKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUR1JFQVRFUlRIQU46IC8vIHggPiB5CiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAg\nICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBu\ndWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdyZWF0ZXJU\naGFuKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRHUkVBVEVS\nT1JFUVVBTDogLy8geCA+PSB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0\nVmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0\nVmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGlj\naXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWN0b3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFsMik7Cgog\nICAgICAgICAgICBjYXNlIEpKVEFERDogLy8geCArIHkKICAgICAgICAgICAg\nICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAg\nICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAg\nICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVS\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFkZCh2YWwxLCB2\nYWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1VCVFJBQ1Q6IC8vIHggLSB5\nCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7\nCiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5zdWJ0cmFjdCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nTVVMVElQTFk6IC8vIHggKiB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0\nVmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0\nVmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGlj\naXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5tdWx0aXBseSh2YWwxLCB2YWwyKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpURElWSURFOiAvLyB4IC8geQogICAgICAgICAg\nICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAg\nICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAg\nICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1C\nRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZGl2aWRlKHZh\nbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRCRVRXRUVOOiAvLyB4\nLmZpZWxkIFtOT1RdIEJFVFdFRU4gNSBBTkQgMTAKICAgICAgICAgICAgICAg\nIHZhbDEgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAwLCAzKSk7CiAgICAgICAg\nICAgICAgICB2YWwyID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMSwgMykpOwog\nICAgICAgICAgICAgICAgdmFsMyA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDIs\nIDMpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwg\ndmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVz\nKHZhbDEsIHZhbDMsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2\nYWxOb3Qobm90LCBhbmQoZmFjdG9yeS5ncmVhdGVyVGhhbkVxdWFsKHZhbDEs\nIHZhbDIpLAogICAgICAgICAgICAgICAgICAgIGZhY3RvcnkubGVzc1RoYW5F\ncXVhbCh2YWwxLCB2YWwzKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRJTjog\nLy8geC5maWVsZCBbTk9UXSBJTiAoJ2EnLCAnYicsICdjJykKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gVFlQRSh4Li4uKSBbTk9UXSBJTiAoZW50aXR5\nVHlwZUxpdGVyYWwxLC4uLikKICAgICAgICAgICAgICAgIEV4cHJlc3Npb24g\naW5FeHAgPSBudWxsOwogICAgICAgICAgICAgICAgSXRlcmF0b3I8SlBRTE5v\nZGU+IGluSXRlcmF0b3IgPSBub2RlLml0ZXJhdG9yKCk7CiAgICAgICAgICAg\nICAgICAvLyB0aGUgZmlyc3QgY2hpbGQgaXMgdGhlIHBhdGgKICAgICAgICAg\nICAgICAgIEpQUUxOb2RlIGZpcnN0ID0gaW5JdGVyYXRvci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUoZmlyc3QpOwoKICAgICAg\nICAgICAgICAgIHdoaWxlIChpbkl0ZXJhdG9yLmhhc05leHQoKSkgewogICAg\nICAgICAgICAgICAgICAgIEpQUUxOb2RlIG5leHQgPSBpbkl0ZXJhdG9yLm5l\neHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3QuaWQgPT0gSkpU\nVFlQRSAmJiBuZXh0LmlkID09IEpKVFRZUEVMSVRFUkFMKQogICAgICAgICAg\nICAgICAgICAgICAgICB2YWwyID0gZ2V0VHlwZUxpdGVyYWwobmV4dCk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICB2YWwyID0gZ2V0VmFsdWUobmV4dCk7CgogICAgICAgICAgICAgICAgICAg\nIC8vIHNwZWNpYWwgY2FzZSBmb3IgPHZhbHVlPiBJTiAoPHN1YnF1ZXJ5Pikg\nb3IKICAgICAgICAgICAgICAgICAgICAvLyA8dmFsdWU+IElOICg8c2luZ2xl\nIHZhbHVlPikKICAgICAgICAgICAgICAgICAgICBpZiAoISh2YWwyIGluc3Rh\nbmNlb2YgTGl0ZXJhbCkgJiYgbm9kZS5nZXRDaGlsZENvdW50KCkgPT0gMikK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2YWxOb3Qobm90LCBm\nYWN0b3J5LmNvbnRhaW5zKHZhbDIsIHZhbDEpKTsgCgogICAgICAgICAgICAg\nICAgICAgIC8vIHRoaXMgaXMgY3VycmVudGx5IGEgc2VxdWVuY2Ugb2YgT1Ig\nZXhwcmVzc2lvbnMsIHNpbmNlIHdlCiAgICAgICAgICAgICAgICAgICAgLy8g\nZG8gbm90IGhhdmUgc3VwcG9ydCBmb3IgSU4gZXhwcmVzc2lvbnMKICAgICAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbkV4cCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBpbkV4cCA9IGZhY3RvcnkuZXF1YWwo\ndmFsMSwgdmFsMik7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgICAgICBpbkV4cCA9IGZhY3Rvcnkub3IoaW5FeHAsIGZh\nY3RvcnkuZXF1YWwodmFsMSwgdmFsMikpOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIC8vIHdlIGFkZGl0aW9uYWxseSBuZWVkIHRvIGFk\nZCBpbiBhICJOT1QgTlVMTCIgY2xhdXNlLCBzaW5jZQogICAgICAgICAgICAg\nICAgLy8gdGhlIElOIGJlaGF2aW9yIHRoYXQgaXMgZXhwZWN0ZWQgYnkgdGhl\nIENUUyBhbHNvIGV4cGVjdHMKICAgICAgICAgICAgICAgIC8vIHRvIGZpbHRl\nciBvdXIgTlVMTHMKICAgICAgICAgICAgICAgIHJldHVybiBhbmQoZXZhbE5v\ndChub3QsIGluRXhwKSwKICAgICAgICAgICAgICAgICAgICBmYWN0b3J5Lm5v\ndEVxdWFsKHZhbDEsIGZhY3RvcnkuZ2V0TnVsbCgpKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVElTTlVMTDogLy8geC5maWVsZCBJUyBbTk9UXSBOVUxMCiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUob25seUNoaWxkKG5vZGUp\nKTsKICAgICAgICAgICAgICAgIGNoZWNrRW1iZWRkYWJsZSh2YWwxKTsKICAg\nICAgICAgICAgICAgIGlmIChub3QpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3Rvcnkubm90RXF1YWwKICAgICAgICAgICAgICAgICAgICAgICAg\nKHZhbDEsIGZhY3RvcnkuZ2V0TnVsbCgpKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbAog\nICAgICAgICAgICAgICAgICAgICAgICAodmFsMSwgZmFjdG9yeS5nZXROdWxs\nKCkpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRIOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFBhdGhPckNvbnN0YW50KG5vZGUpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRJREVOVElGSUVSOgogICAgICAgICAgICBjYXNlIEpKVElE\nRU5USUZJQ0FUSU9OVkFSSUFCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0SWRlbnRpZmllcihub2RlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUUVVB\nTElGSUVEUEFUSDoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRRdWFsaWZp\nZWRQYXRoKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRRVUFMSUZJRURJ\nREVOVElGSUVSOgogICAgICAgICAgICAgICAgLy8gS0VZKGUpLCBWQUxVRShl\nKSwgRU5UUlkoZSkKICAgICAgICAgICAgICAgIHJldHVybiBnZXRRdWFsaWZp\nZWRJZGVudGlmaWVyKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRHRU5F\nUkFMSURFTlRJRklFUjoKICAgICAgICAgICAgICAgIC8vIEtFWShlKSwgVkFM\nVUUoZSkKICAgICAgICAgICAgICAgIGlmIChub2RlLnBhcmVudC5wYXJlbnQu\naWQgPT0gSkpUV0hFUkUgfHwgbm9kZS5wYXJlbnQuaWQgPT0gSkpUR1JPVVBC\nWSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0R2VuZXJhbElkZW50\naWZpZXIob25seUNoaWxkKG5vZGUpLCB0cnVlKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRRdWFsaWZpZWRJZGVudGlmaWVyKG9ubHlDaGlsZChub2Rl\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVE5PVDoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm5vdChnZXRFeHByZXNzaW9uKG9ubHlDaGlsZChu\nb2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRMSUtFOiAvLyBmaWVsZCBM\nSUtFICclc29tZXZhbCUnCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFs\ndWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFs\ndWUocmlnaHQobm9kZSkpOwoKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMiwgVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAg\nICAgIC8vIGxvb2sgZm9yIGFuIGVzY2FwZSBjaGFyYWN0ZXIgYmVuZWF0aCB0\naGUgbm9kZQogICAgICAgICAgICAgICAgU3RyaW5nIGVzY2FwZSA9IG51bGw7\nCiAgICAgICAgICAgICAgICBKUFFMTm9kZSBlc2NhcGVOb2RlID0gcmlnaHQo\nbm9kZSkuCiAgICAgICAgICAgICAgICAgICAgZmluZENoaWxkQnlJRChKSlRF\nU0NBUEVDSEFSQUNURVIsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGVz\nY2FwZU5vZGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBlc2NhcGUg\nPSB0cmltUXVvdGVzKG9ubHlDaGlsZChlc2NhcGVOb2RlKS50ZXh0KTsKCiAg\nICAgICAgICAgICAgICBpZiAobm90KQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWN0b3J5Lm5vdE1hdGNoZXModmFsMSwgdmFsMiwgIl8iLCAiJSIs\nIGVzY2FwZSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkubWF0Y2hlcyh2YWwxLCB2YWwyLCAiXyIs\nICIlIiwgZXNjYXBlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSVNFTVBUWToK\nICAgICAgICAgICAgICAgIHJldHVybiBldmFsTm90KG5vdCwKICAgICAgICAg\nICAgICAgICAgICBmYWN0b3J5LmlzRW1wdHkoZ2V0VmFsdWUob25seUNoaWxk\nKG5vZGUpKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTSVpFOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc2l6ZShnZXRWYWx1ZShvbmx5Q2hp\nbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSU5ERVg6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5pbmRleChnZXRWYWx1ZShvbmx5\nQ2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUVVBQRVI6CiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUob25seUNoaWxkKG5vZGUp\nKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwxLCBUWVBF\nX1NUUklORyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50b1Vw\ncGVyQ2FzZSh2YWwxKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTE9XRVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50b0xvd2VyQ2FzZShnZXRT\ndHJpbmdWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUTEVOR1RIOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nc3RyaW5nTGVuZ3RoKGdldFN0cmluZ1ZhbHVlKG9ubHlDaGlsZChub2RlKSkp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRBQlM6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5hYnMoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5v\nZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNRUlQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5zcXJ0KGdldE51bWJlclZhbHVlKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRNT0Q6CiAgICAg\nICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAg\nICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAg\nICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBF\nX05VTUJFUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5tb2Qo\ndmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVFRSSU06IC8vIFRS\nSU0oW1t3aGVyZV0gW2NoYXJdIEZST01dIGZpZWxkKQogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGxhc3RDaGlsZChub2RlKSk7CiAgICAgICAg\nICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwoK\nICAgICAgICAgICAgICAgIEJvb2xlYW4gdHJpbVdoZXJlID0gbnVsbDsKCiAg\nICAgICAgICAgICAgICBKUFFMTm9kZSBmaXJzdFRyaW1DaGlsZCA9IGZpcnN0\nQ2hpbGQobm9kZSk7CgogICAgICAgICAgICAgICAgaWYgKG5vZGUuZ2V0Q2hp\nbGRDb3VudCgpID4gMSkgewogICAgICAgICAgICAgICAgICAgIHRyaW1XaGVy\nZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpbUNoaWxkLmlk\nID09IEpKVFRSSU1MRUFESU5HID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmaXJzdFRyaW1DaGlsZC5pZCA9PSBKSlRUUklNVFJBSUxJTkcgPyBCb29s\nZWFuLkZBTFNFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBu\ndWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFZhbHVl\nIHRyaW1DaGFyOwoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSAz\nIGNoaWxkcmVuLCB0aGVuIHdlIGtub3cgdGhlIHRyaW0KICAgICAgICAgICAg\nICAgIC8vIGNoYXIgaXMgdGhlIHNlY29uZCBub2RlCiAgICAgICAgICAgICAg\nICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPT0gMykKICAgICAgICAgICAg\nICAgICAgICB0cmltQ2hhciA9IGdldFZhbHVlKHNlY29uZENoaWxkKG5vZGUp\nKTsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgdHdvIGNo\naWxkcmVuLCB0aGVuIHdlIG5lZWQgdG8gY2hlY2sgdG8gc2VlCiAgICAgICAg\nICAgICAgICAgICAgLy8gaWYgdGhlIGZpcnN0IGNoaWxkIGlzIGEgbGVhZGlu\nZy90cmFpbGluZy9ib3RoIG5vZGUsCiAgICAgICAgICAgICAgICAgICAgLy8g\nb3IgdGhlIHRyaW0gY2hhcmFjdGVyIG5vZGUKICAgICAgICAgICAgICAgIGVs\nc2UgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDIKICAgICAgICAgICAg\nICAgICAgICAmJiBmaXJzdFRyaW1DaGlsZC5pZCAhPSBKSlRUUklNTEVBRElO\nRwogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0VHJpbUNoaWxkLmlkICE9\nIEpKVFRSSU1UUkFJTElORwogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0\nVHJpbUNoaWxkLmlkICE9IEpKVFRSSU1CT1RIKQogICAgICAgICAgICAgICAg\nICAgIHRyaW1DaGFyID0gZ2V0VmFsdWUoZmlyc3RDaGlsZChub2RlKSk7CiAg\nICAgICAgICAgICAgICAgICAgLy8gb3Rod2Vyd2lzZSwgd2UgZGVmYXVsdCB0\nbyB0cmltbWluZyB0aGUgc3BhY2UgY2hhcmFjdGVyCiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBmYWN0b3J5\nLm5ld0xpdGVyYWwoIiAiLCBMaXRlcmFsLlRZUEVfU1RSSU5HKTsKCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50cmltKHZhbDEsIHRyaW1DaGFy\nLCB0cmltV2hlcmUpOwoKICAgICAgICAgICAgY2FzZSBKSlRDT05DQVQ6CiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAg\nICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RS\nSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwyLCBU\nWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5j\nb25jYXQodmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVFNVQlNU\nUklORzoKICAgICAgICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0\naCA9PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVl\nKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAgICAgICAgICAgICAgICB2YWwy\nID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMSwgMykpOwogICAgICAgICAgICAg\nICAgICAgIHZhbDMgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAyLCAzKSk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3Ro\nID09IDIpIHsKICAgICAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nY2hpbGQobm9kZSwgMCwgMikpOwogICAgICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAyKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMSwgVFlQ\nRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZh\nbDIsIEludGVnZXIuVFlQRSk7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5j\naGlsZHJlbi5sZW5ndGggPT0gMykKICAgICAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMywgSW50ZWdlci5UWVBFKTsKCiAgICAgICAgICAg\nICAgICByZXR1cm4gY29udmVydFN1YnN0cmluZ0FyZ3VtZW50cyhmYWN0b3J5\nLCB2YWwxLCB2YWwyLCB2YWwzKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTE9D\nQVRFOgogICAgICAgICAgICAgICAgLy8gYXMgd2l0aCBTVUJTVFJJTkcgKGFi\nb3ZlKSwgdGhlIHNlbWFudGljcyBmb3IgTE9DQVRFIGRpZmZlcgogICAgICAg\nICAgICAgICAgLy8gZnJvbSBFeHByZXNzaW9uRmFjdG9yeS5pbmRleE9mIGlu\nIHRoYXQgTE9DQVRFIHVzZXMgYQogICAgICAgICAgICAgICAgLy8gMC1iYXNl\nZCBpbmRleCwgYW5kIGluZGV4T2YgdXNlcyBhIDEtYmFzZWQgaW5kZXgKICAg\nICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZVBhdGggPSBnZXRWYWx1ZShmaXJz\ndENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZVNl\nYXJjaCA9IGdldFZhbHVlKHNlY29uZENoaWxkKG5vZGUpKTsKICAgICAgICAg\nICAgICAgIFZhbHVlIGxvY2F0ZUZyb21JbmRleCA9IG51bGw7CiAgICAgICAg\nICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPiAyKSAvLyBvcHRp\nb25hbCBzdGFydCBpbmRleCBhcmcKICAgICAgICAgICAgICAgICAgICBsb2Nh\ndGVGcm9tSW5kZXggPSBnZXRWYWx1ZSh0aGlyZENoaWxkKG5vZGUpKTsKCiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlUGF0aCwgVFlQ\nRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKGxv\nY2F0ZVNlYXJjaCwgVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIGlm\nIChsb2NhdGVGcm9tSW5kZXggIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlRnJvbUluZGV4LCBUWVBFX1NUUklO\nRyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWRkKGZhY3Rv\ncnkuaW5kZXhPZihsb2NhdGVTZWFyY2gsCiAgICAgICAgICAgICAgICAgICAg\nbG9jYXRlRnJvbUluZGV4ID09IG51bGwgPyBsb2NhdGVQYXRoCiAgICAgICAg\nICAgICAgICAgICAgICAgIDogZmFjdG9yeS5uZXdBcmd1bWVudExpc3QobG9j\nYXRlUGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5zdWJ0\ncmFjdChsb2NhdGVGcm9tSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmYWN0b3J5Lm5ld0xpdGVyYWwoMSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKSkpKSwKICAgICAg\nICAgICAgICAgICAgICBmYWN0b3J5Lm5ld0xpdGVyYWwoMSwKICAgICAgICAg\nICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05VTUJFUikpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRBR0dSRUdBVEU6CiAgICAgICAgICAgICAgICAvLyBz\naW1wbHkgcGFzcy10aHJvdWdoIHdoaWxlIGFzc2VydGluZyBhIHNpbmdsZSBj\naGlsZAogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxkKG5v\nZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09VTlQ6CiAgICAgICAgICAg\nICAgICBKUFFMTm9kZSBjID0gbGFzdENoaWxkKG5vZGUpOwogICAgICAgICAg\nICAgICAgaWYgKGMuaWQgPT0gSkpUSURFTlRJRklFUikKICAgICAgICAgICAg\nICAgICAgICAvLyBjb3VudChlKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LmNvdW50KGdldFBhdGgobm9kZSwgZmFsc2UsIHRydWUpKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmNvdW50KGdldFZhbHVl\nKGMpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTUFYOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkubWF4KGdldE51bWJlclZhbHVlKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRNSU46CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5taW4oZ2V0TnVtYmVyVmFsdWUob25s\neUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNVTToKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1bShnZXROdW1iZXJWYWx1\nZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQVZF\nUkFHRToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmF2ZyhnZXRO\ndW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpURElTVElOQ1RQQVRIOgogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3RvcnkuZGlzdGluY3QoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKSk7Cgog\nICAgICAgICAgICBjYXNlIEpKVEVYSVNUUzoKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWN0b3J5LmlzTm90RW1wdHkoKFZhbHVlKSBldmFsKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBTlk6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5hbnkoKFZhbHVlKSBldmFsKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBTEw6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbGwoKFZhbHVlKSBldmFsKG9u\nbHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJTRUxF\nQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3VicXVlcnkobm9kZSk7\nCgogICAgICAgICAgICBjYXNlIEpKVE1FTUJFUk9GOgogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSksIFZBUl9QQVRIKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSwgVkFS\nX1BBVEgpOwogICAgICAgICAgICAgICAgY2hlY2tFbWJlZGRhYmxlKHZhbDIp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRDb250YWluc1R5cGVzKHZh\nbDIsIHZhbDEsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZXZhbE5vdChub3QsIGZhY3RvcnkuY29udGFpbnModmFs\nMiwgdmFsMSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRDVVJSRU5UREFURToK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1cnJlbnREYXRl\nKERhdGUuY2xhc3MpOwoKICAgICAgICAgICAgY2FzZSBKSlRDVVJSRU5UVElN\nRToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1cnJlbnRU\naW1lKFRpbWUuY2xhc3MpOwoKICAgICAgICAgICAgY2FzZSBKSlRDVVJSRU5U\nVElNRVNUQU1QOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0\nQ3VycmVudFRpbWVzdGFtcChUaW1lc3RhbXAuY2xhc3MpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRTRUxFQ1RFWFRFTlNJT046CiAgICAgICAgICAgICAgICBh\nc3NlcnRRdWVyeUV4dGVuc2lvbnMoIlNFTEVDVCIpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGV2YWwob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUR1JPVVBCWUVYVEVOU0lPTjoKICAgICAgICAgICAgICAgIGFz\nc2VydFF1ZXJ5RXh0ZW5zaW9ucygiR1JPVVAgQlkiKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBldmFsKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVE9SREVSQllFWFRFTlNJT046CiAgICAgICAgICAgICAgICBh\nc3NlcnRRdWVyeUV4dGVuc2lvbnMoIk9SREVSIEJZIik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkpOwoKICAgICAgICAg\nICAgY2FzZSBKSlREQVRFTElURVJBTDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5Lm5ld0xpdGVyYWwobm9kZS50ZXh0LCBMaXRlcmFsLlRZUEVf\nREFURSk7CgogICAgICAgICAgICBjYXNlIEpKVFRJTUVMSVRFUkFMOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbChub2RlLnRl\neHQsIExpdGVyYWwuVFlQRV9USU1FKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nVElNRVNUQU1QTElURVJBTDogICAgCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5uZXdMaXRlcmFsKG5vZGUudGV4dCwgTGl0ZXJhbC5UWVBFX1RJ\nTUVTVEFNUCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfRkFUQUwsICJiYWQtdHJlZSIs\nCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51\nbGwpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDb252\nZXJ0cyBKUFFMIHN1YnN0cmluZygpIGZ1bmN0aW9uIHRvIE9wZW5KUEEgRXhw\ncmVzc2lvbkZhY3RvcnkgCiAgICAgKiBzdWJzdHJpbmcoKSBhcmd1bWVudHMu\nCiAgICAgKiAKICAgICAqIFRoZSBzZW1hbnRpY3Mgb2YgdGhlIEpQUUwgc3Vi\nc3RyaW5nKCkgZnVuY3Rpb24gYXJlIHRoYXQgYXJnMiBpcyB0aGUgCiAgICAg\nKiAxLWJhc2VkIHN0YXJ0IGluZGV4LCBhbmQgYXJnMyBpcyB0aGUgbGVuZ3Ro\nIG9mIHRoZSBzdHJpbmcgdG8gYmUgcmV0dXJuLgogICAgICogVGhpcyBpcyBk\naWZmZXJlbnQgdGhhbiB0aGUgc2VtYW50aWNzIG9mIHRoZSBFeHByZXNzaW9u\nRmFjdG9yeSdzIAogICAgICogc3Vic3RyaW5nKCksIHdoaWNoIG1hdGNoZXMg\ndGhlIEphdmEgbGFuZ3VhZ2UgKDAtYmFzZWQgc3RhcnQgaW5kZXgsCiAgICAg\nKiBhcmcyIGlzIHRoZSBlbmQgaW5kZXgpOiB3ZSBwZXJmb3JtIHRoZSB0cmFu\nc2xhdGlvbiBieSBhZGRpbmcgb25lIHRvIHRoZSAKICAgICAqIGZpcnN0IGFy\nZ3VtZW50LCBhbmQgdGhlbiBhZGRpbmcgdGhlIGZpcnN0IGFyZ3VtZW50IHRv\nIHRoZSBzZWNvbmQgIAogICAgICogYXJndW1lbnQgdG8gZ2V0IHRoZSBlbmRJ\nbmRleC4KICAgICAqIAogICAgICogQHBhcmFtIHZhbDEgdGhlIG9yaWdpbmFs\nIFN0cmluZwogICAgICogQHBhcmFtIHZhbDIgdGhlIDEtYmFzZWQgc3RhcnQg\naW5kZXggYXMgcGVyIEpQUUwgc3Vic3RyaW5nKCkgc2VtYW50aWNzCiAgICAg\nKiBAcGFyYW0gdmFsMyB0aGUgbGVuZ3RoIG9mIHRoZSByZXR1cm5lZCBzdHJp\nbmcgYXMgcGVyIEpQUUwgc2VtYW50aWNzCiAgICAgKiAKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBWYWx1ZSBjb252ZXJ0U3Vic3RyaW5nQXJndW1lbnRz\nKEV4cHJlc3Npb25GYWN0b3J5IGZhY3RvcnksIAogICAgCQlWYWx1ZSB2YWwx\nLCBWYWx1ZSB2YWwyLCBWYWx1ZSB2YWwzKSB7CiAgICAgICAgVmFsdWUgc3Rh\ncnQgPSBudWxsOwogICAgICAgIFZhbHVlIGVuZCA9IG51bGw7CiAgICAgICAg\naWYgKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsICYmIAogICAgICAgICAgICAo\ndmFsMyA9PSBudWxsIHx8IHZhbDMgaW5zdGFuY2VvZiBMaXRlcmFsKSkgewog\nICAgICAgICAgICAvLyBvcHRpbWl6ZSBTUUwgZm9yIHRoZSBjb21tb24gY2Fz\nZSBvZiB0d28gbGl0ZXJhbHMKICAgICAgICAgICAgbG9uZyBqcHFsU3RhcnQg\nPSAoKE51bWJlcikgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgpKQogICAg\nICAgICAgICAgICAgLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICBzdGFydCA9\nIGZhY3RvcnkubmV3TGl0ZXJhbChuZXcgTG9uZyhqcHFsU3RhcnQgLSAxKSwK\nICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpOwogICAgICAg\nICAgICBpZiAodmFsMyAhPSBudWxsKSB7CiAgICAgICAgICAgIAlsb25nIGxl\nbmd0aCA9ICgoTnVtYmVyKSAoKExpdGVyYWwpIHZhbDMpLmdldFZhbHVlKCkp\nCiAgICAgICAgICAgICAgICAgICAgLmxvbmdWYWx1ZSgpOwogICAgICAgICAg\nICBsb25nIGVuZEluZGV4ID0gbGVuZ3RoICsgKGpwcWxTdGFydCAtIDEpOwog\nICAgICAgICAgICBlbmQgPSBmYWN0b3J5Lm5ld0xpdGVyYWwobmV3IExvbmco\nZW5kSW5kZXgpLAogICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05VTUJF\nUik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBzdGFydCA9IGZhY3Rvcnkuc3VidHJhY3QodmFsMiwgZmFjdG9yeS5uZXdM\naXRlcmFsCiAgICAgICAgICAgICAgICAoMSwgTGl0ZXJhbC5UWVBFX05VTUJF\nUikpOwogICAgICAgICAgICBpZiAodmFsMyAhPSBudWxsKQogICAgICAgICAg\nICBlbmQgPSBmYWN0b3J5LmFkZCh2YWwzLAogICAgICAgICAgICAgICAgKGZh\nY3Rvcnkuc3VidHJhY3QodmFsMiwgZmFjdG9yeS5uZXdMaXRlcmFsCiAgICAg\nICAgICAgICAgICAgICAgKDEsIExpdGVyYWwuVFlQRV9OVU1CRVIpKSkpOwog\nICAgICAgIH0KICAgICAgICBpZiAodmFsMyAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5zdWJzdHJpbmcodmFsMSwgZmFjdG9yeS5uZXdB\ncmd1bWVudExpc3Qoc3RhcnQsIGVuZCkpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc3Vic3RyaW5nKHZhbDEsIHN0YXJ0KTsK\nICAgIAkKICAgIH0KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRRdWVyeUV4dGVu\nc2lvbnMoU3RyaW5nIGNsYXVzZSkgewogICAgICAgIE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYgPSByZXNvbHZlci5nZXRDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgc3dpdGNoKGNvbmYuZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCku\nZ2V0SlBRTCgpKSB7CiAgICAgICAgICAgIGNhc2UgQ29tcGF0aWJpbGl0eS5K\nUFFMX1dBUk46CiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSd2ZSBh\nbHJlYWR5IHdhcm5lZCBmb3IgdGhpcyBxdWVyeS1mYWN0b3J5IGNvbWJvCiAg\nICAgICAgICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0gcmVzb2x2ZXIuZ2V0\nUXVlcnlDb250ZXh0KCkuZ2V0U3RvcmVDb250ZXh0KCk7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgcXVlcnkgPSBjdXJyZW50UXVlcnkoKTsKICAgICAgICAg\nICAgICAgIGlmIChjdHguZ2V0QnJva2VyKCkgIT0gbnVsbCAmJiBxdWVyeSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGtleSA9IGdl\ndENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgcXVlcnk7CiAgICAgICAgICAg\nICAgICAgICAgQnJva2VyRmFjdG9yeSBmYWN0b3J5ID0gY3R4LmdldEJyb2tl\ncigpLmdldEJyb2tlckZhY3RvcnkoKTsKICAgICAgICAgICAgICAgICAgICBP\nYmplY3QgaGFzV2FybmVkID0gZmFjdG9yeS5nZXRVc2VyT2JqZWN0KGtleSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1dhcm5lZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3RvcnkucHV0\nVXNlck9iamVjdChrZXksIEJvb2xlYW4uVFJVRSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1FVRVJZKTsKICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KCJxdWVyeS1leHRlbnNpb25zLXdhcm5pbmci\nLCBjbGF1c2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVy\neSgpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBDb21wYXRpYmlsaXR5LkpQUUxfU1RSSUNUOgogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFBhcnNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJxdWVyeS1leHRl\nbnNpb25zLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBjbGF1c2UsIGN1\ncnJlbnRRdWVyeSgpKS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBjYXNl\nIENvbXBhdGliaWxpdHkuSlBRTF9FWFRFTkRFRDoKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgICAgICAiQ29tcGF0aWJpbGl0eS5nZXRKUFFMKCkgPT0gIgogICAgICAg\nICAgICAgICAgICAgICAgICArIGNvbmYuZ2V0Q29tcGF0aWJpbGl0eUluc3Rh\nbmNlKCkuZ2V0SlBRTCgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0SW1wbGljaXRUeXBlcyhWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwy\nLCAKICAgICAgICBDbGFzczw/PiBleHBlY3RlZCkgewogICAgICAgIFN0cmlu\nZyBjdXJyUXVlcnkgPSBjdXJyZW50UXVlcnkoKTsKICAgICAgICBzZXRJbXBs\naWNpdFR5cGVzKHZhbDEsIHZhbDIsIGV4cGVjdGVkLCByZXNvbHZlciwgcGFy\nYW1ldGVyVHlwZXMsIAogICAgICAgICAgICBjdXJyUXVlcnkpOwogICAgfQog\nICAgCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXRJbXBsaWNpdFR5\ncGVzKFZhbHVlIHZhbDEsIFZhbHVlIHZhbDIsIAogICAgICAgIENsYXNzPD8+\nIGV4cGVjdGVkLCBSZXNvbHZlciByZXNvbHZlciwgT3JkZXJlZE1hcDxPYmpl\nY3QsQ2xhc3M8Pz4+IHBhcmFtZXRlclR5cGVzLAogICAgICAgIFN0cmluZyBj\ndXJyZW50UXVlcnkpIHsKICAgICAgICBBYnN0cmFjdEV4cHJlc3Npb25CdWls\nZGVyLnNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgZXhwZWN0ZWQsIAog\nICAgICAgICAgICByZXNvbHZlcik7CgogICAgICAgIC8vIGFzIHdlbGwgYXMg\nc2V0dGluZyB0aGUgdHlwZXMgZm9yIGNvbnZlcnNpb25zLCB3ZSBhbHNvIG5l\nZWQgdG8KICAgICAgICAvLyBlbnN1cmUgdGhhdCBhbnkgcGFyYW1ldGVycyBh\ncmUgZGVjbGFyZWQgd2l0aCB0aGUgY29ycmVjdCB0eXBlLAogICAgICAgIC8v\nIHNpbmNlIHRoZSBKUEEgc3BlYyBleHBlY3RzIHRoYXQgdGhlc2Ugd2lsbCBi\nZSB2YWxpZGF0ZWQKICAgICAgICBQYXJhbWV0ZXIgcGFyYW0gPSB2YWwxIGlu\nc3RhbmNlb2YgUGFyYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMQogICAgICAg\nICAgICA6IHZhbDIgaW5zdGFuY2VvZiBQYXJhbWV0ZXIgPyAoUGFyYW1ldGVy\nKSB2YWwyIDogbnVsbDsKICAgICAgICBQYXRoIHBhdGggPSB2YWwxIGluc3Rh\nbmNlb2YgUGF0aCA/IChQYXRoKSB2YWwxCiAgICAgICAgICAgIDogdmFsMiBp\nbnN0YW5jZW9mIFBhdGggPyAoUGF0aCkgdmFsMiA6IG51bGw7CgogICAgICAg\nIC8vIHdlIG9ubHkgY2hlY2sgZm9yIHBhcmFtZXRlci10by1wYXRoIGNvbXBh\ncmlzb25zCiAgICAgICAgaWYgKHBhcmFtID09IG51bGwgfHwgcGF0aCA9PSBu\ndWxsIHx8IHBhcmFtZXRlclR5cGVzID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRoLmxhc3Qo\nKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgaWYgKGV4cGVjdGVkID09IG51bGwpCiAgICAgICAgICAg\nIGNoZWNrRW1iZWRkYWJsZShwYXRoLCBjdXJyZW50UXVlcnkpOwoKICAgICAg\nICBDbGFzczw/PiB0eXBlID0gcGF0aC5nZXRUeXBlKCk7CiAgICAgICAgaWYg\nKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBP\nYmplY3QgcGFyYW1LZXkgPSBwYXJhbS5nZXRQYXJhbWV0ZXJLZXkoKTsKICAg\nICAgICBpZiAocGFyYW1LZXkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSBhbHJlYWR5IGRlY2xh\ncmVkIHRoZSBwYXJhbWV0ZXIKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMu\nY29udGFpbnNLZXkocGFyYW1LZXkpKQogICAgICAgICAgICBwYXJhbWV0ZXJU\neXBlcy5wdXQocGFyYW1LZXksIHR5cGUpOwogICAgfQoKICAgIHByaXZhdGUg\nVmFsdWUgZ2V0U3RyaW5nVmFsdWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIHJldHVybiBnZXRUeXBlVmFsdWUobm9kZSwgVFlQRV9TVFJJTkcpOwogICAg\nfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0TnVtYmVyVmFsdWUoSlBRTE5vZGUg\nbm9kZSkgewogICAgICAgIHJldHVybiBnZXRUeXBlVmFsdWUobm9kZSwgVFlQ\nRV9OVU1CRVIpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0VHlwZVZh\nbHVlKEpQUUxOb2RlIG5vZGUsIENsYXNzPD8+IGltcGxpY2l0VHlwZSkgewog\nICAgICAgIFZhbHVlIHZhbCA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIHNl\ndEltcGxpY2l0VHlwZSh2YWwsIGltcGxpY2l0VHlwZSk7CiAgICAgICAgcmV0\ndXJuIHZhbDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFN1YnF1ZXJ5\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBmaW5hbCBib29sZWFuIHN1YmNs\nYXNzZXMgPSB0cnVlOwoKICAgICAgICAvLyBwYXJzZSB0aGUgc3VicXVlcnkK\nICAgICAgICBQYXJzZWRKUFFMIHBhcnNlZCA9IG5ldyBQYXJzZWRKUFFMKG5v\nZGUucGFyc2VyLmpwcWwsIG5vZGUpOwogICAgICAgIENvbnRleHQgc3ViQ29u\ndGV4dCA9IG5ldyBDb250ZXh0KHBhcnNlZCwgbnVsbCwgY3R4KCkpOwogICAg\nICAgIGNvbnRleHRzLnB1c2goc3ViQ29udGV4dCk7CgogICAgICAgIENsYXNz\nTWV0YURhdGEgY2FuZGlkYXRlID0gZ2V0Q2FuZGlkYXRlTWV0YURhdGEobm9k\nZSk7CiAgICAgICAgU3VicXVlcnkgc3VicSA9IHN1YkNvbnRleHQuZ2V0U3Vi\ncXVlcnkoKTsKICAgICAgICBpZiAoc3VicSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHN1YnEgPSBmYWN0b3J5Lm5ld1N1YnF1ZXJ5KGNhbmRpZGF0ZSwgc3Vi\nY2xhc3NlcywgbmV4dEFsaWFzKCkpOwogICAgICAgICAgICBzdWJDb250ZXh0\nLnNldFN1YnF1ZXJ5KHN1YnEpOwogICAgICAgIH0KICAgICAgICBzdWJxLnNl\ndE1ldGFEYXRhKGNhbmRpZGF0ZSk7CiAgICAgICAgCiAgICAgICAgLy8gZXZh\nbHVhdGUgZnJvbSBjbGF1c2UgZm9yIHJlc29sdmluZyB2YXJpYWJsZXMgZGVm\naW5lZCBpbiBzdWJxdWVyeQogICAgICAgIEpQUUxOb2RlIGZyb20gPSBub2Rl\nLmdldENoaWxkKDEpOwogICAgICAgIHN1YkNvbnRleHQuZnJvbSA9IGV2YWxG\ncm9tQ2xhdXNlKGZyb20sIHRydWUpOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zIHN1YmV4cCA9IGdldFF1ZXJ5RXhwcmVz\nc2lvbnMoKTsKICAgICAgICAgICAgc3VicS5zZXRRdWVyeUV4cHJlc3Npb25z\nKHN1YmV4cCk7CiAgICAgICAgICAgIGlmIChzdWJleHAucHJvamVjdGlvbnMu\nbGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIGNoZWNrRW1iZWRkYWJsZShz\ndWJleHAucHJvamVjdGlvbnNbMF0pOwogICAgICAgICAgICByZXR1cm4gc3Vi\ncTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyByZW1vdmUg\ndGhlIHN1YnF1ZXJ5IHBhcnNlIGNvbnRleHQKICAgICAgICAgICAgY29udGV4\ndHMucG9wKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlcyBhbmQgcmVjb3JkcyB0aGUgbmFtZXMgYW5kIG9yZGVyIG9mIHBhcmFt\nZXRlcnMuIFRoZSBwYXJhbWV0ZXJzIGFyZQogICAgICogaWRlbnRpZmllZCBi\neSBhIGtleSB3aXRoIGl0cyB0eXBlIHByZXNlcnZlZC4gVGhlIHNlY29uZCBh\ncmd1bWVudAogICAgICogZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBmaXJzdCBh\ncmd1bWVudCBpcyB1c2VkIGFzLWlzIG9yIGNvbnZlcnRlZCB0bwogICAgICog\nYW4gSW50ZWdlciBhcyBwYXJhbWV0ZXIga2V5LiAKICAgICAqIAogICAgICog\nQHBhcmFtIHRoZSB0ZXh0IGFzIGl0IGFwcGVhcnMgaW4gdGhlIHBhcnNlZCBu\nb2RlCiAgICAgKiBAcGFyYW0gcG9zaXRpb25hbCBpZiB0cnVlIHRoZSBmaXJz\ndCBhcmd1bWVudCBpcyBjb252ZXJ0ZWQgdG8gYW4gaW50ZWdlcgogICAgICog\nQHBhcmFtIGlzQ29sbGVjdGlvblZhbHVlZCB0cnVlIGZvciBjb2xsZWN0aW9u\nLXZhbHVlZCBwYXJhbWV0ZXJzCiAgICAgKi8KICAgIHByaXZhdGUgUGFyYW1l\ndGVyIGdldFBhcmFtZXRlcihTdHJpbmcgaWQsIGJvb2xlYW4gcG9zaXRpb25h\nbCwgCiAgICAgICAgYm9vbGVhbiBpc0NvbGxlY3Rpb25WYWx1ZWQpIHsKICAg\nICAgICBpZiAocGFyYW1ldGVyVHlwZXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncGFyYW1ldGVyVHlwZXMgPSBuZXcgT3JkZXJlZE1hcDxPYmplY3QsIENsYXNz\nPD8+PigpOwogICAgICAgIE9iamVjdCBwYXJhbUtleSA9IHBvc2l0aW9uYWwg\nPyBJbnRlZ2VyLnBhcnNlSW50KGlkKSA6IGlkOwogICAgICAgIGlmICghcGFy\nYW1ldGVyVHlwZXMuY29udGFpbnNLZXkocGFyYW1LZXkpKQogICAgICAgICAg\nICBwYXJhbWV0ZXJUeXBlcy5wdXQocGFyYW1LZXksIFRZUEVfT0JKRUNUKTsK\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbnVsbDsKICAgICAgICBp\nbnQgaW5kZXg7CiAgICAgICAgaWYgKHBvc2l0aW9uYWwpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGluZGV4ZXMgaW4gSlBRTCBh\ncmUgMS1iYXNlZCwgYXMgb3Bwb3NlZCB0byAwLWJhc2VkIGluCiAgICAgICAg\nICAgICAgICAvLyB0aGUgY29yZSBFeHByZXNzaW9uRmFjdG9yeQogICAgICAg\nICAgICAgICAgaW5kZXggPSBJbnRlZ2VyLnBhcnNlSW50KGlkKSAtIDE7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAiYmFkLXBvc2l0aW9uYWwtcGFyYW1ldGVyIiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IGlkIH0sIGUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBh\ncmFtZXRlciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBp\nZCB9LCBudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbmRl\neCA9IHBhcmFtZXRlclR5cGVzLmluZGV4T2YoaWQpOwogICAgICAgIH0KICAg\nICAgICBQYXJhbWV0ZXIgcGFyYW0gPSBpc0NvbGxlY3Rpb25WYWx1ZWQgCiAg\nICAgICAgICAgID8gZmFjdG9yeS5uZXdDb2xsZWN0aW9uVmFsdWVkUGFyYW1l\ndGVyKHBhcmFtS2V5LCBUWVBFX09CSkVDVCkgCiAgICAgICAgICAgIDogZmFj\ndG9yeS5uZXdQYXJhbWV0ZXIocGFyYW1LZXksIFRZUEVfT0JKRUNUKTsKICAg\nICAgICBwYXJhbS5zZXRNZXRhRGF0YShtZXRhKTsKICAgICAgICBwYXJhbS5z\nZXRJbmRleChpbmRleCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHBhcmFt\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2tzIHRvIHNlZSBpZiB3ZSBz\naG91bGQgZXZhbHVhdGUgZm9yIGEgTk9UIGV4cHJlc3Npb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsTm90KGJvb2xlYW4gbm90LCBF\neHByZXNzaW9uIGV4cCkgewogICAgICAgIHJldHVybiBub3QgPyBmYWN0b3J5\nLm5vdChleHApIDogZXhwOwogICAgfQoKICAgIC8qKgogICAgICogVHJpbSBv\nZmYgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2luZ2xlLXF1b3RlcywgYW5kIHRo\nZW4KICAgICAqIHJlcGxhY2UgYW55IGludGVybmFsICcnIGluc3RhbmNlcyB3\naXRoICcgKHNpbmNlIHJlcGVhdGluZyB0aGUKICAgICAqIHF1b3RlIGlzIHRo\nZSBKUFFMIG1lY2hhbmlzbSBvZiBlc2NhcGluZyBhIHNpbmdsZSBxdW90ZSku\nCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIHRyaW1RdW90ZXMoU3RyaW5n\nIHN0cikgewogICAgICAgIGlmIChzdHIgPT0gbnVsbCB8fCBzdHIubGVuZ3Ro\nKCkgPD0gMSkKICAgICAgICAgICAgcmV0dXJuIHN0cjsKCiAgICAgICAgaWYg\nKHN0ci5zdGFydHNXaXRoKCInIikgJiYgc3RyLmVuZHNXaXRoKCInIikpCiAg\nICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMSwgc3RyLmxlbmd0aCgp\nIC0gMSk7CgogICAgICAgIGludCBpbmRleCA9IC0xOwoKICAgICAgICB3aGls\nZSAoKGluZGV4ID0gc3RyLmluZGV4T2YoIicnIiwgaW5kZXggKyAxKSkgIT0g\nLTEpCiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgaW5kZXgg\nKyAxKSArIHN0ci5zdWJzdHJpbmcoaW5kZXggKyAyKTsKCiAgICAgICAgcmV0\ndXJuIHN0cjsKICAgIH0KCiAgICAvKioKICAgICAqIEFuIEludGVnZXJMaXRl\ncmFsIGFuZCBEZWNpbWFsTGl0ZXJhbCBub2RlIHdpbGwKICAgICAqIGhhdmUg\nYSBjaGlsZCBub2RlIG9mIE5lZ2F0aXZlIGlmIGl0IGlzIG5lZ2F0aXZlOgog\nICAgICogaWYgc28sIHRoaXMgbWV0aG9kIHJldHVybnMgLTEsIGVsc2UgaXQg\ncmV0dXJucyAxLgogICAgICovCiAgICBwcml2YXRlIHNob3J0IG5lZ2F0aXZl\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAh\nPSBudWxsICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09IDEKICAgICAgICAg\nICAgJiYgZmlyc3RDaGlsZChub2RlKS5pZCA9PSBKSlRORUdBVElWRSkKICAg\nICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\ncmV0dXJuIDE7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRJZGVudGlm\naWVyKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBmaW5hbCBTdHJpbmcgbmFt\nZSA9IG5vZGUudGV4dDsKICAgICAgICBmaW5hbCBWYWx1ZSB2YWwgPSBnZXRW\nYXJpYWJsZShuYW1lLCBmYWxzZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEg\nY21kID0gZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1lKTsKCiAgICAgICAgaWYg\nKGNtZCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2Fz\nZSB3aGVyZSB0aGUgY2xhc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAg\nICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJs\nZXMgZm9yIHRoaXMpCiAgICAgICAgICAgIFZhbHVlIHRoaXogPSBudWxsOwog\nICAgICAgICAgICBpZiAoY3R4KCkuc3VicXVlcnkgPT0gbnVsbCB8fCAKICAg\nICAgICAgICAgICAgIGN0eCgpLmdldFNjaGVtYShuYW1lLnRvTG93ZXJDYXNl\nKCkpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChjdHgoKS5zdWJx\ndWVyeSAhPSBudWxsICYmIGluQXNzaWduU3Vic2VsZWN0UHJvamVjdGlvbikK\nICAgICAgICAgICAgICAgICAgICB0aGl6ID0gZmFjdG9yeS5uZXdQYXRoKGN0\neCgpLnN1YnF1ZXJ5KTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICB0aGl6ID0gZmFjdG9yeS5nZXRUaGlzKCk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGl6ID0gZmFjdG9yeS5u\nZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5KTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAoKFBhdGgpdGhpeikuc2V0U2NoZW1hQWxpYXMobmFtZSk7CiAgICAg\nICAgICAgIHRoaXouc2V0TWV0YURhdGEoY21kKTsKICAgICAgICAgICAgcmV0\ndXJuIHRoaXo7CiAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBQ\nYXRoKSB7CiAgICAgICAgICAgIHJldHVybiAoUGF0aCkgdmFsOwogICAgICAg\nIH0gZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgVmFsdWUpIHsKICAgICAgICAg\nICAgaWYgKHZhbC5pc1ZhcmlhYmxlKCkpIHsKICAgICAgICAgICAgICAgIC8v\nIGNhbiBiZSBhbiBlbnRpdHkgdHlwZSBsaXRlcmFsCiAgICAgICAgICAgICAg\nICBDbGFzczw/PiBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKG5hbWUsIG51\nbGwpOwogICAgICAgICAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIFZhbHVlIGxpdCA9IGZhY3RvcnkubmV3VHlwZUxpdGVy\nYWwoYywgTGl0ZXJhbC5UWVBFX0NMQVNTKTsKICAgICAgICAgICAgICAgICAg\nICBDbGFzczw/PiBjYW5kaWRhdGUgPSBnZXRDYW5kaWRhdGVUeXBlKCk7CiAg\nICAgICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBjYW4gPSBnZXRDbGFz\nc01ldGFEYXRhKGNhbmRpZGF0ZS5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gZ2V0Q2xhc3NNZXRhRGF0YShuYW1lLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZS5pc0Fzc2ln\nbmFibGVGcm9tKGMpKQogICAgICAgICAgICAgICAgICAgICAgICBsaXQuc2V0\nTWV0YURhdGEobWV0YSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgICAgICBsaXQuc2V0TWV0YURhdGEoY2FuKTsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbGl0OwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoVmFsdWUpIHZh\nbDsKICAgICAgICB9CgogICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJ1bmtub3duLWlkZW50aWZpZXIiLAogICAgICAgICAgICBuZXcg\nT2JqZWN0W117IG5hbWUgfSwgbnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSBQ\nYXRoIHZhbGlkYXRlTWFwUGF0aChKUFFMTm9kZSBub2RlLCBKUFFMTm9kZSBp\nZCkgewogICAgICAgIFBhdGggcGF0aCA9IChQYXRoKSBnZXRWYWx1ZShpZCk7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbGQgPSBwYXRoLmxhc3QoKTsKCiAg\nICAgICAgaWYgKGZsZCA9PSBudWxsICYmIGN0eCgpLnN1YnF1ZXJ5ICE9IG51\nbGwpIHsKICAgICAgICAgICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUoaWQu\ndGV4dCwgZmFsc2UpOwogICAgICAgICAgICBpZiAodmFyICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIHBhdGggPSBmYWN0b3J5Lm5ld1BhdGgodmFyKTsK\nICAgICAgICAgICAgICAgIGZsZCA9IHBhdGgubGFzdCgpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChmbGQgIT0gbnVs\nbCkgeyAgICAgICAgICAgIAogICAgICAgICAgICAvLyB2YWxpZGF0ZSB0aGUg\nZmllbGQgaXMgb2YgdHlwZSBqYXZhLnV0aWwuTWFwCiAgICAgICAgICAgIGlm\nIChmbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5NQVAp\nIHsKICAgICAgICAgICAgICAgIFN0cmluZyBvcGVyID0gIlZBTFVFIjsKICAg\nICAgICAgICAgICAgIGlmIChub2RlLmlkID09IEpKVEVOVFJZKQogICAgICAg\nICAgICAgICAgICAgIG9wZXIgPSAiRU5UUlkiOyAgICAgICAgCiAgICAgICAg\nICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVEtFWSkKICAgICAgICAg\nICAgICAgICAgICBvcGVyID0gIktFWSI7CiAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAiYmFkLXF1YWxpZmllZC1pZGVu\ndGlmaWVyIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGlk\nLnRleHQsIG9wZXJ9LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9u\nKEVYX1VTRVIsICJ1bmtub3duLXR5cGUiLAogICAgICAgICAgICAgICAgbmV3\nIE9iamVjdFtdeyBpZC50ZXh0fSwgbnVsbCk7CiAgICAgICAgICAgIAogICAg\nICAgIHJldHVybiBwYXRoOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0\nR2VuZXJhbElkZW50aWZpZXIoSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiB2ZXJp\nZnlFbWJlZGRhYmxlKSB7CiAgICAgICAgSlBRTE5vZGUgaWQgPSBvbmx5Q2hp\nbGQobm9kZSk7CiAgICAgICAgUGF0aCBwYXRoID0gdmFsaWRhdGVNYXBQYXRo\nKG5vZGUsIGlkKTsKCiAgICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUS0VZKQog\nICAgICAgICAgICBwYXRoID0gKFBhdGgpIGZhY3RvcnkuZ2V0S2V5KHBhdGgp\nOwogICAgICAgIEZpZWxkTWV0YURhdGEgZmxkID0gcGF0aC5sYXN0KCk7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZmxkLmdldEtleSgpLmdldFR5\ncGVNZXRhRGF0YSgpOwogICAgICAgIGlmICh2ZXJpZnlFbWJlZGRhYmxlICYm\nCiAgICAgICAgICAgIChub2RlLmlkID09IEpKVEtFWSAmJiBtZXRhICE9IG51\nbGwgJiYgZmxkLmdldEtleSgpLmlzRW1iZWRkZWQoKSkgfHwKICAgICAgICAg\nICAgKG5vZGUuaWQgPT0gSkpUVkFMVUUgJiYgZmxkLmlzRWxlbWVudENvbGxl\nY3Rpb24oKSAmJgogICAgICAgICAgICAgICAgIGZsZC5nZXRFbGVtZW50KCku\nZ2V0RW1iZWRkZWRNZXRhRGF0YSgpICE9IG51bGwpKSB7IAogICAgICAgICAg\nICAgICAgIC8vIGNoZWNrIGJhc2ljIHR5cGUKICAgICAgICAgICAgaWYgKG5v\nZGUucGFyZW50LnBhcmVudC5pZCA9PSBKSlRHUk9VUEJZKQogICAgICAgICAg\nICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImNhbnQtZ3Jv\ndXBieS1rZXktdmFsdWUtZW1iZWRkYWJsZSIsCiAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBub2RlLmlkID09IEpKVFZBTFVFID8gIlZBTFVF\nIiA6ICJLRVkiLCBpZC50ZXh0IH0sIG51bGwpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAiYmFkLWdlbmVyYWwtaWRlbnRpZmllciIsCiAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBub2RlLmlkID09IEpKVFZBTFVFID8gIlZBTFVF\nIiA6ICJLRVkiLCBpZC50ZXh0IH0sIG51bGwpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFF1\nYWxpZmllZElkZW50aWZpZXIoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIEpQ\nUUxOb2RlIGlkID0gb25seUNoaWxkKG5vZGUpOyAgICAgICAgICAgICAgIAog\nICAgICAgIFBhdGggcGF0aCA9IHZhbGlkYXRlTWFwUGF0aChub2RlLCBpZCk7\nCgogICAgICAgIGlmIChub2RlLmlkID09IEpKVFZBTFVFKQogICAgICAgICAg\nICByZXR1cm4gcGF0aDsKCiAgICAgICAgVmFsdWUgdmFsdWUgPSBnZXRWYWx1\nZShpZCk7CiAgICAgICAgaWYgKG5vZGUuaWQgPT0gSkpUS0VZKQogICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5tYXBLZXkocGF0aCwgdmFsdWUpOwogICAg\nICAgIGVsc2UgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkubWFwRW50cnkocGF0aCwgdmFsdWUpOwogICAgfQoKICAgIHByaXZhdGUg\nUGF0aCBnZXRRdWFsaWZpZWRQYXRoKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICByZXR1cm4gZ2V0UXVhbGlmaWVkUGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7\nCiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIGdldFF1YWxpZmllZFBhdGgoSlBR\nTE5vZGUgbm9kZSwgYm9vbGVhbiBwY09ubHksIGJvb2xlYW4gaW5uZXIpCiAg\nICB7CiAgICAgICAgaW50IG5DaGlsZCA9IG5vZGUuZ2V0Q2hpbGRDb3VudCgp\nOwogICAgICAgIEpQUUxOb2RlIGZpcnN0Q2hpbGQgPSBmaXJzdENoaWxkKG5v\nZGUpOwogICAgICAgIEpQUUxOb2RlIGlkID0gZmlyc3RDaGlsZC5pZCA9PSBK\nSlRLRVkgPyBvbmx5Q2hpbGQoZmlyc3RDaGlsZCkgOgogICAgICAgICAgICAg\nICBmaXJzdENoaWxkOyAgICAgICAgICAgICAgIAogICAgICAgIFBhdGggcGF0\naCA9IHZhbGlkYXRlTWFwUGF0aChmaXJzdENoaWxkLCBpZCk7CgogICAgICAg\nIGlmIChmaXJzdENoaWxkLmlkID09IEpKVElERU5USUZJRVIpCiAgICAgICAg\nICAgIHJldHVybiBnZXRQYXRoKG5vZGUpOwoKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZsZCA9IHBhdGgubGFzdCgpOwogICAgICAgIHBhdGggPSAoUGF0aCkg\nZmFjdG9yeS5nZXRLZXkocGF0aCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gZmxkLmdldEtleSgpLmdldFR5cGVNZXRhRGF0YSgpOwoKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4\nY2VwdGlvbihFWF9VU0VSLCAiYmFkLXF1YWxpZmllZC1wYXRoIiwKICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgaWQudGV4dCB9LCBudWxsKTsKICAg\nICAgICAKICAgICAgICBwYXRoLnNldE1ldGFEYXRhKG1ldGEpOwoKICAgICAg\nICAvLyB3YWxrIHRocm91Z2ggdGhlIGNoaWxkcmVuIGFuZCBhc3NlbWJsZSB0\naGUgcGF0aAogICAgICAgIGJvb2xlYW4gYWxsb3dOdWxsID0gIWlubmVyOwog\nICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDwgbkNoaWxkOyBpKyspIHsKICAg\nICAgICAgICAgcGF0aCA9IChQYXRoKSB0cmF2ZXJzZVBhdGgocGF0aCwgbm9k\nZS5jaGlsZHJlbltpXS50ZXh0LCBwY09ubHksCiAgICAgICAgICAgICAgICBh\nbGxvd051bGwpOwoKICAgICAgICAgICAgLy8gYWxsIHRyYXZlcnNhbHMgYnV0\nIHRoZSBmaXJzdCBvbmUgd2lsbCBhbHdheXMgYmUgaW5uZXIgam9pbnMKICAg\nICAgICAgICAgYWxsb3dOdWxsID0gZmFsc2U7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBwYXRoOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0VHlw\nZUxpdGVyYWwoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIEpQUUxOb2RlIHR5\ncGUgPSBvbmx5Q2hpbGQobm9kZSk7CiAgICAgICAgZmluYWwgU3RyaW5nIG5h\nbWUgPSB0eXBlLnRleHQ7CiAgICAgICAgZmluYWwgVmFsdWUgdmFsID0gZ2V0\nVmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBpZiAodmFsIGluc3Rh\nbmNlb2YgVmFsdWUgJiYgdmFsLmlzVmFyaWFibGUoKSkgewogICAgICAgICAg\nICBDbGFzczw/PiBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKG5hbWUsIG51\nbGwpOwogICAgICAgICAgICBpZiAoYyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBWYWx1ZSB0eXBlTGl0ID0gZmFjdG9yeS5uZXdUeXBlTGl0ZXJhbChj\nLCBMaXRlcmFsLlRZUEVfQ0xBU1MpOwogICAgICAgICAgICAgICAgdHlwZUxp\ndC5zZXRNZXRhRGF0YShnZXRDbGFzc01ldGFEYXRhKG5hbWUsIGZhbHNlKSk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZUxpdDsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVVNFUiwgIm5vdC10eXBlLWxpdGVyYWwiLAogICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IG5hbWUgfSwgbnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1\nZSBnZXRQYXRoT3JDb25zdGFudChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAg\nLy8gZmlyc3QgY2hlY2sgdG8gc2VlIGlmIHRoZSBwYXRoIGlzIGFuIGVudW0g\nb3Igc3RhdGljIGZpZWxkLCBhbmQKICAgICAgICAvLyBpZiBzbywgbG9hZCBp\ndAogICAgICAgIFN0cmluZyBjbGFzc05hbWUgPSBhc3NlbWJsZShub2RlLCAi\nLiIsIDEpOwogICAgICAgIENsYXNzPD8+IGMgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUoY2xhc3NOYW1lLCBudWxsKTsKICAgICAgICBpZiAoYyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSBsYXN0Q2hpbGQo\nbm9kZSkudGV4dDsKICAgICAgICAgICAgaW50IHR5cGUgPSAoYy5pc0VudW0o\nKSA/IExpdGVyYWwuVFlQRV9FTlVNIDogTGl0ZXJhbC5UWVBFX1VOS05PV04p\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgRmllbGQgZmll\nbGQgPSBjLmdldEZpZWxkKGZpZWxkTmFtZSk7CiAgICAgICAgICAgICAgICBP\nYmplY3QgdmFsdWUgPSBmaWVsZC5nZXQobnVsbCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKHZhbHVlLCB0eXBlKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoTm9TdWNoRmllbGRFeGNlcHRpb24gbnNmZSkg\newogICAgICAgICAgICAgICAgaWYgKG5vZGUuaW5FbnVtUGF0aCkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nbm8tZmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IGMuZ2V0TmFtZSgpLCBmaWVsZE5hbWUgfSwgbnNmZSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFBh\ndGgobm9kZSwgZmFsc2UsIHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgInVuYWNjZXNzaWJsZS1maWVsZCIsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjbGFzc05hbWUsIGZpZWxkTmFt\nZSB9LCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGUsIGZhbHNlLCB0cnVlKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNzIHR5cGVfZGlz\nY3JpbWluYXRvcgogICAgICogICAgIHR5cGVfZGlzY3JpbWluYXRvciA6Oj0K\nICAgICAqICAgICAgICAgVFlQRShnZW5lcmFsX2lkZW50aWZpY2F0aW9uX3Zh\ncmlhYmxlIHwKICAgICAqICAgICAgICAgc2luZ2xlX3ZhbHVlZF9vYmplY3Rf\ncGF0aF9leHByZXNzaW9uIHwKICAgICAqICAgICAgICAgaW5wdXRfcGFyYW1l\ndGVyICkKICAgICAqLwogICAgcHJpdmF0ZSBWYWx1ZSBnZXRUeXBlKEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICBzd2l0Y2ggKG5vZGUuaWQpIHsKICAgICAg\nICBjYXNlIEpKVElERU5USUZJRVI6CiAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5LnR5cGUoZ2V0VmFsdWUobm9kZSkpOwoKICAgICAgICBjYXNlIEpKVE5B\nTUVESU5QVVRQQVJBTUVURVI6CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLnR5cGUoZ2V0UGFyYW1ldGVyKG5vZGUudGV4dCwgZmFsc2UsIGZhbHNlKSk7\nCgogICAgICAgIGNhc2UgSkpUUE9TSVRJT05BTElOUFVUUEFSQU1FVEVSOgog\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS50eXBlKGdldFBhcmFtZXRlcihu\nb2RlLnRleHQsIHRydWUsIGZhbHNlKSk7CgogICAgICAgIGNhc2UgSkpUR0VO\nRVJBTElERU5USUZJRVI6CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnR5\ncGUoZ2V0UXVhbGlmaWVkSWRlbnRpZmllcihvbmx5Q2hpbGQobm9kZSkpKTsK\nCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgLy8gVE9ETzogZW5mb3Jj\nZSBqcGEyLjAgc3BlYyBydWxlcy4KICAgICAgICAgICAgLy8gQSBzaW5nbGVf\ndmFsdWVkX29iamVjdF9maWVsZCBpcyBkZXNpZ25hdGVkIGJ5IHRoZSBuYW1l\nIG9mCiAgICAgICAgICAgIC8vIGFuIGFzc29jaWF0aW9uIGZpZWxkIGluIGEg\nb25lLXRvLW9uZSBvciBtYW55LXRvLW9uZSByZWxhdGlvbnNoaXAKICAgICAg\nICAgICAgLy8gb3IgYSBmaWVsZCBvZiBlbWJlZGRhYmxlIGNsYXNzIHR5cGUu\nCiAgICAgICAgICAgIC8vIFRoZSB0eXBlIG9mIGEgc2luZ2xlX3ZhbHVlZF9v\nYmplY3RfZmllbGQgaXMgdGhlIGFic3RyYWN0IHNjaGVtYQogICAgICAgICAg\nICAvLyB0eXBlIG9mIHRoZSByZWxhdGVkIGVudGl0eSBvciBlbWJlZGRhYmxl\nIGNsYXNzCiAgICAgICAgICAgIFZhbHVlIHBhdGggPSBnZXRQYXRoKG5vZGUs\nIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudHlw\nZShwYXRoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIGdl\ndFBhdGgoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBnZXRQYXRo\nKG5vZGUsIGZhbHNlLCB0cnVlKTsKICAgIH0KCiAgICBwcml2YXRlIFBhdGgg\nZ2V0UGF0aChKUFFMTm9kZSBub2RlLCBib29sZWFuIHBjT25seSwgYm9vbGVh\nbiBpbm5lcikgewogICAgICAgIC8vIHJlc29sdmUgdGhlIGZpcnN0IGVsZW1l\nbnQgYWdhaW5zdCB0aGUgYWxpYXNlcyBtYXAgLi4uCiAgICAgICAgLy8gaS5l\nLiwgdGhlIHBhdGggIlNFTEVDVCB4LmlkIEZST00gU29tZUNsYXNzIHggd2hl\ncmUgeC5pZCA+IDEwIgogICAgICAgIC8vIHdpbGwgbmVlZCB0byBoYXZlICJ4\nIiBpbiB0aGUgYWxpYXMgbWFwIGluIG9yZGVyIHRvIHJlc29sdmUKICAgICAg\nICBQYXRoIHBhdGggPSBudWxsOwoKICAgICAgICBmaW5hbCBTdHJpbmcgbmFt\nZSA9IGZpcnN0Q2hpbGQobm9kZSkudGV4dDsKICAgICAgICBmaW5hbCBWYWx1\nZSB2YWwgPSBnZXRWYXJpYWJsZShuYW1lLCBmYWxzZSk7CgogICAgICAgIC8v\nIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xhc3MgbmFtZSBpcyB0aGUg\nYWxpYXMKICAgICAgICAvLyBmb3IgdGhlIGNhbmRpZGF0ZSAod2UgZG9uJ3Qg\ndXNlIHZhcmlhYmxlcyBmb3IgdGhpcykKICAgICAgICBpZiAobmFtZS5lcXVh\nbHNJZ25vcmVDYXNlKGN0eCgpLnNjaGVtYUFsaWFzKSkgewogICAgICAgICAg\nICBpZiAoY3R4KCkuc3VicXVlcnkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0aChjdHgoKS5zdWJxdWVyeSk7CiAg\nICAgICAgICAgICAgICBwYXRoLnNldE1ldGFEYXRhKGN0eCgpLnN1YnF1ZXJ5\nLmdldE1ldGFEYXRhKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0aCgpOwogICAgICAgICAg\nICAgICAgcGF0aC5zZXRNZXRhRGF0YShjdHgoKS5tZXRhKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSBpZiAoZ2V0TWV0YURhdGFGb3JBbGlhcyhu\nYW1lKSAhPSBudWxsKQogICAgICAgICAgICBwYXRoID0gbmV3UGF0aChudWxs\nLCBnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBQYXRoKQogICAgICAgICAgICBwYXRoID0gKFBh\ndGgpIHZhbDsKICAgICAgICBlbHNlIGlmICh2YWwuZ2V0TWV0YURhdGEoKSAh\nPSBudWxsKQogICAgICAgICAgICBwYXRoID0gbmV3UGF0aCh2YWwsIHZhbC5n\nZXRNZXRhRGF0YSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRoLWludmFsaWQiLAogICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhc3NlbWJsZShub2RlKSwgbmFt\nZSB9LCBudWxsKTsKCiAgICAgICAgcGF0aC5zZXRTY2hlbWFBbGlhcyhuYW1l\nKTsKCiAgICAgICAgLy8gd2FsayB0aHJvdWdoIHRoZSBjaGlsZHJlbiBhbmQg\nYXNzZW1ibGUgdGhlIHBhdGgKICAgICAgICBib29sZWFuIGFsbG93TnVsbCA9\nICFpbm5lcjsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IG5vZGUuY2hp\nbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBhdGguaXNY\nUGF0aCgpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gaTsgaiA8\nbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAgICAg\nICBwYXRoID0gKFBhdGgpIHRyYXZlcnNlWFBhdGgocGF0aCwgbm9kZS5jaGls\nZHJlbltqXS50ZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiBwYXRoOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHBhdGggPSAoUGF0aCkgdHJhdmVy\nc2VQYXRoKHBhdGgsIG5vZGUuY2hpbGRyZW5baV0udGV4dCwgcGNPbmx5LAog\nICAgICAgICAgICAgICAgYWxsb3dOdWxsKTsKICAgICAgICAgICAgaWYgKGN0\neCgpLmdldFBhcmVudCgpICE9IG51bGwgJiYgY3R4KCkuZ2V0VmFyaWFibGUo\ncGF0aC5nZXRTY2hlbWFBbGlhcygpKSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBwYXRoLnNldFN1YnF1ZXJ5Q29udGV4dChjdHgoKSwgbmFtZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgLy8gYWxsIHRyYXZl\ncnNhbHMgYnV0IHRoZSBmaXJzdCBvbmUgd2lsbCBhbHdheXMgYmUgaW5uZXIg\nam9pbnMKICAgICAgICAgICAgYWxsb3dOdWxsID0gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nQ2xhc3M8Pz4gZ2V0RGVjbGFyZWRWYXJpYWJsZVR5cGUoU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdldE1ldGFEYXRhRm9y\nQWxpYXMobmFtZSk7CiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gY21kLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAg\naWYgKG5hbWUgIT0gbnVsbCAmJiBuYW1lLmVxdWFscyhjdHgoKS5zY2hlbWFB\nbGlhcykpCiAgICAgICAgICAgIHJldHVybiBnZXRDYW5kaWRhdGVUeXBlKCk7\nCgogICAgICAgIC8vIEpQUUwgaGFzIG5vIGRlY2xhcmVkIHZhcmlhYmxlcwog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyBhbiBFeHByZXNzaW9uIGZvciB0aGUgZ2l2ZW4gbm9kZSBieSBldmFs\nJ2luZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGdldEV4\ncHJlc3Npb24oSlBRTE5vZGUgbm9kZSkgewogICAgICAgIE9iamVjdCBleHAg\nPSBldmFsKG5vZGUpOwoKICAgICAgICAvLyBjaGVjayBmb3IgYm9vbGVhbiB2\nYWx1ZXMgdXNlZCBhcyBleHByZXNzaW9ucwogICAgICAgIGlmICghKGV4cCBp\nbnN0YW5jZW9mIEV4cHJlc3Npb24pKQogICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5hc0V4cHJlc3Npb24oKFZhbHVlKSBleHApOwogICAgICAgIHJldHVy\nbiAoRXhwcmVzc2lvbikgZXhwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyBhIFNpbXBsZSBDYXNlIEV4cHJlc3Npb24gZm9yIHRoZSBnaXZlbiBu\nb2RlIGJ5IGV2YWwnaW5nIGl0LgogICAgICovCiAgICBwcml2YXRlIFZhbHVl\nIGdldFNpbXBsZUNhc2VFeHByZXNzaW9uKEpQUUxOb2RlIG5vZGUpIHsKICAg\nICAgICBPYmplY3QgY2FzZU9wZXJhbmQgPSBldmFsKG5vZGUuZ2V0Q2hpbGQo\nMCkpOwogICAgICAgIGludCBuQ2hpbGQgPSBub2RlLmdldENoaWxkQ291bnQo\nKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGV2YWwobGFzdENoaWxkKG5vZGUp\nKTsKICAgICAgICBPYmplY3QgZXhwW10gPSBuZXcgRXhwcmVzc2lvbltuQ2hp\nbGQgLSAyXTsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IG5DaGlsZCAt\nIDE7IGkrKykKICAgICAgICAgICAgZXhwW2ktMV0gPSBldmFsKG5vZGUuY2hp\nbGRyZW5baV0pOwogICAgICAgIAogICAgICAgIHJldHVybiBmYWN0b3J5LnNp\nbXBsZUNhc2VFeHByZXNzaW9uKChWYWx1ZSkgY2FzZU9wZXJhbmQsCiAgICAg\nICAgICAgIChFeHByZXNzaW9uW10pIGV4cCwgKFZhbHVlKSB2YWwpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIEdlbmVyYWwgQ2FzZSBFeHBy\nZXNzaW9uIGZvciB0aGUgZ2l2ZW4gbm9kZSBieSBldmFsJ2luZyBpdC4KICAg\nICAqLwogICAgcHJpdmF0ZSBWYWx1ZSBnZXRHZW5lcmFsQ2FzZUV4cHJlc3Np\nb24oSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGludCBuQ2hpbGQgPSBub2Rl\nLmdldENoaWxkQ291bnQoKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGV2YWwo\nbGFzdENoaWxkKG5vZGUpKTsKICAgICAgICBPYmplY3QgZXhwW10gPSBuZXcg\nRXhwcmVzc2lvbltuQ2hpbGQgLSAxXTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG5DaGlsZCAtIDE7IGkrKykKICAgICAgICAgICAgZXhwW2ldID0g\nKEV4cHJlc3Npb24pIGV2YWwobm9kZS5jaGlsZHJlbltpXSk7CiAgICAgICAg\nCiAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2VuZXJhbENhc2VFeHByZXNzaW9u\nKChFeHByZXNzaW9uW10pIGV4cCwgKFZhbHVlKSB2YWwpOwogICAgfQoKICAg\nIHByaXZhdGUgRXhwcmVzc2lvbiBnZXRXaGVuQ29uZGl0aW9uKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBPYmplY3QgZXhwID0gZXZhbChmaXJzdENoaWxk\nKG5vZGUpKTsKICAgICAgICBPYmplY3QgdmFsID0gZXZhbChzZWNvbmRDaGls\nZChub2RlKSk7CiAgICAgICAgcmV0dXJuIGZhY3Rvcnkud2hlbkNvbmRpdGlv\nbigoRXhwcmVzc2lvbikgZXhwLCAoVmFsdWUpIHZhbCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBFeHByZXNzaW9uIGdldFdoZW5TY2FsYXIoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIE9iamVjdCB2YWwxID0gZXZhbChmaXJzdENoaWxkKG5v\nZGUpKTsKICAgICAgICBPYmplY3QgdmFsMiA9IGV2YWwoc2Vjb25kQ2hpbGQo\nbm9kZSkpOwogICAgICAgIHJldHVybiBmYWN0b3J5LndoZW5TY2FsYXIoKFZh\nbHVlKSB2YWwxLCAoVmFsdWUpIHZhbDIpOwogICAgfQoKICAgIHByaXZhdGUg\nVmFsdWUgZ2V0Q29hbGVzY2VFeHByZXNzaW9uKEpQUUxOb2RlIG5vZGUpIHsK\nICAgICAgICBpbnQgbkNoaWxkID0gbm9kZS5nZXRDaGlsZENvdW50KCk7CiAg\nICAgICAgCiAgICAgICAgT2JqZWN0IHZhbHNbXSA9IG5ldyBWYWx1ZVtuQ2hp\nbGRdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbkNoaWxkOyBpKysp\nCiAgICAgICAgICAgIHZhbHNbaV0gPSBldmFsKG5vZGUuY2hpbGRyZW5baV0p\nOwogICAgICAgIAogICAgICAgIHJldHVybiBmYWN0b3J5LmNvYWxlc2NlRXhw\ncmVzc2lvbigoVmFsdWVbXSkgdmFscyk7CiAgICB9CgogICAgcHJpdmF0ZSBW\nYWx1ZSBnZXROdWxsSWZFeHByZXNzaW9uKEpQUUxOb2RlIG5vZGUpIHsKICAg\nICAgICBPYmplY3QgdmFsMSA9IGV2YWwoZmlyc3RDaGlsZChub2RlKSk7CiAg\nICAgICAgT2JqZWN0IHZhbDIgPSBldmFsKHNlY29uZENoaWxkKG5vZGUpKTsK\nICAgICAgICAKICAgICAgICByZXR1cm4gZmFjdG9yeS5udWxsSWZFeHByZXNz\naW9uKChWYWx1ZSkgdmFsMSwgKFZhbHVlKSB2YWwyKTsKICAgIH0KCiAgICBw\ncml2YXRlIFZhbHVlIGdldFZhbHVlKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICBpZiAobm9kZS5pZCA9PSBKSlRRVUFMSUZJRURJREVOVElGSUVSKQogICAg\nICAgICAgICByZXR1cm4gZ2V0UXVhbGlmaWVkSWRlbnRpZmllcihvbmx5Q2hp\nbGQobm9kZSkpOwogICAgICAgIHJldHVybiBnZXRWYWx1ZShub2RlLCBWQVJf\nUEFUSCk7CiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIG5ld1BhdGgoVmFsdWUg\ndmFsLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBQYXRoIHBhdGgg\nPSB2YWwgPT0gbnVsbCA/IGZhY3RvcnkubmV3UGF0aCgpIDogZmFjdG9yeS5u\nZXdQYXRoKHZhbCk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAg\nICAgICAgcGF0aC5zZXRNZXRhRGF0YShtZXRhKTsKICAgICAgICByZXR1cm4g\ncGF0aDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSBWYWx1ZSBm\nb3IgdGhlIGdpdmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8KICAg\nIHByaXZhdGUgVmFsdWUgZ2V0VmFsdWUoSlBRTE5vZGUgbm9kZSwgaW50IGhh\nbmRsZVZhcikgewogICAgICAgIFZhbHVlIHZhbCA9IChWYWx1ZSkgZXZhbChu\nb2RlKTsKCiAgICAgICAgLy8gZGV0ZXJtaW5lZCBob3cgdG8gZXZhbHVhdGUg\nYSB2YXJpYWJsZQogICAgICAgIGlmICghdmFsLmlzVmFyaWFibGUoKSkKICAg\nICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICBlbHNlIGlmIChoYW5kbGVW\nYXIgPT0gVkFSX1BBVEggJiYgISh2YWwgaW5zdGFuY2VvZiBQYXRoKSkKICAg\nICAgICAgICAgcmV0dXJuIG5ld1BhdGgodmFsLCB2YWwuZ2V0TWV0YURhdGEo\nKSk7CiAgICAgICAgZWxzZSBpZiAoaGFuZGxlVmFyID09IFZBUl9FUlJPUikK\nICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInVu\nZXhwZWN0ZWQtdmFyIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsg\nbm9kZS50ZXh0IH0sIG51bGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\ncmV0dXJuIHZhbDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBQYXJzZSBDb250ZXh0IE1hbmFnZW1lbnQKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwcml2YXRlIENvbnRl\neHQgY3R4KCkgewogICAgICAgIHJldHVybiAgY29udGV4dHMucGVlaygpOwog\nICAgfQoKICAgIHByaXZhdGUgSlBRTE5vZGUgcm9vdCgpIHsKICAgICAgICBy\nZXR1cm4gY3R4KCkucGFyc2VkLnJvb3Q7CiAgICB9CgogICAgcHJpdmF0ZSBD\nbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhRm9yQWxpYXMoU3RyaW5nIGFsaWFz\nKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IGNvbnRleHRzLnNpemUoKSAtIDE7\nIGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIENvbnRleHQgY29udGV4dCA9\nICBjb250ZXh0cy5nZXQoaSk7CiAgICAgICAgICAgIGlmIChhbGlhcy5lcXVh\nbHNJZ25vcmVDYXNlKGNvbnRleHQuc2NoZW1hQWxpYXMpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGNvbnRleHQubWV0YTsKICAgICAgICB9CgogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZFNj\naGVtYVRvQ29udGV4dChTdHJpbmcgaWQsIENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGN0eCgpLmFkZFNjaGVtYShpZC50b0xvd2VyQ2FzZSgpLCBt\nZXRhKTsgICAgCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkVmFyaWFi\nbGVUb0NvbnRleHQoU3RyaW5nIGlkLCBWYWx1ZSB2YXIpIHsKICAgICAgICBj\ndHgoKS5hZGRWYXJpYWJsZShpZCwgdmFyKTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgVmFsdWUgZ2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAgIENv\nbnRleHQgYyA9IGN0eCgpOwogICAgICAgIFZhbHVlIHYgPSBjLmdldFZhcmlh\nYmxlKHZhcik7CiAgICAgICAgaWYgKHYgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHY7CiAgICAgICAgaWYgKGMuZ2V0UGFyZW50KCkgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGMuZ2V0UGFyZW50KCkuZmluZFZhcmlhYmxl\nKHZhcik7CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vZGUgdHJhdmVyc2Fs\nIHV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIHByaXZhdGUgSlBRTE5vZGUgb25seUNoaWxkKEpQUUxOb2RlIG5vZGUp\nCiAgICAgICAgdGhyb3dzIFVzZXJFeGNlcHRpb24gewogICAgICAgIEpQUUxO\nb2RlIGNoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAgICAgaWYgKG5v\nZGUuY2hpbGRyZW4ubGVuZ3RoID4gMSkKICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgIm11bHRpLWNoaWxkcmVuIiwKICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSwgQXJyYXlzLmFzTGlzdChu\nb2RlLmNoaWxkcmVuKSB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIGNoaWxk\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgbGVmdCBub2Rl\nICh0aGUgZmlyc3Qgb2YgdGhlIGNoaWxkcmVuKSwgYW5kIGFzc2VydHMKICAg\nICAqIHRoYXQgdGhlcmUgYXJlIGV4YWN0bHkgdHdvIGNoaWxkcmVuLgogICAg\nICovCiAgICBwcml2YXRlIEpQUUxOb2RlIGxlZnQoSlBRTE5vZGUgbm9kZSkg\newogICAgICAgIHJldHVybiBjaGlsZChub2RlLCAwLCAyKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIHJpZ2h0IG5vZGUgKHRoZSBzZWNv\nbmQgb2YgdGhlIGNoaWxkcmVuKSwgYW5kIGFzc2VydHMKICAgICAqIHRoYXQg\ndGhlcmUgYXJlIGV4YWN0bHkgdHdvIGNoaWxkcmVuLgogICAgICovCiAgICBw\ncml2YXRlIEpQUUxOb2RlIHJpZ2h0KEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICByZXR1cm4gY2hpbGQobm9kZSwgMSwgMik7CiAgICB9CgogICAgcHJpdmF0\nZSBKUFFMTm9kZSBjaGlsZChKUFFMTm9kZSBub2RlLCBpbnQgY2hpbGROdW0s\nIGludCBhc3NlcnRDb3VudCkgewogICAgICAgIGlmIChub2RlLmNoaWxkcmVu\nLmxlbmd0aCAhPSBhc3NlcnRDb3VudCkKICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgIndyb25nLWNoaWxkLWNvdW50IiwKICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbmV3IEludGVnZXIoYXNzZXJ0\nQ291bnQpLCBub2RlLAogICAgICAgICAgICAgICAgICAgIEFycmF5cy5hc0xp\nc3Qobm9kZS5jaGlsZHJlbikgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBu\nb2RlLmNoaWxkcmVuW2NoaWxkTnVtXTsKICAgIH0KCiAgICBwcml2YXRlIEpQ\nUUxOb2RlIGZpcnN0Q2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGlm\nIChub2RlLmNoaWxkcmVuID09IG51bGwgfHwgbm9kZS5jaGlsZHJlbi5sZW5n\ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVVNFUiwgIm5vLWNoaWxkcmVuIiwKICAgICAgICAgICAgICAgIG5ldyBPYmpl\nY3RbXXsgbm9kZSB9LCBudWxsKTsKICAgICAgICByZXR1cm4gbm9kZS5jaGls\nZHJlblswXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSBz\nZWNvbmRDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIG5v\nZGUuY2hpbGRyZW5bMV07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgSlBR\nTE5vZGUgdGhpcmRDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0\ndXJuIG5vZGUuY2hpbGRyZW5bMl07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgSlBRTE5vZGUgbGFzdENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICByZXR1cm4gbGFzdENoaWxkKG5vZGUsIDApOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIE50aCBmcm9tIHRoZSBsYXN0IGNoaWxkLiBFLmcuLAogICAg\nICogbGFzdENoaWxkKDEpIHdpbGwgcmV0dXJuIHRoZSBzZWNvbmQtdG8tdGhl\nLWxhc3QgY2hpbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpQUUxO\nb2RlIGxhc3RDaGlsZChKUFFMTm9kZSBub2RlLCBpbnQgZnJvbUxhc3QpIHsK\nICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbltub2RlLmNoaWxkcmVuLmxl\nbmd0aCAtICgxICsgZnJvbUxhc3QpXTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEJhc2Ugbm9kZSB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkIGJ5IHRoZSBKUFFM\nRXhwcmVzc2lvbkJ1aWxkZXI7IGJhc2UKICAgICAqIGNsYXNzIG9mIHRoZSB7\nQGxpbmsgU2ltcGxlTm9kZX0gdGhhdCBpcyB1c2VkIGJ5IHtAbGluayBKUFFM\nfS4KICAgICAqCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAog\nICAgICogQHNlZSBOb2RlCiAgICAgKiBAc2VlIFNpbXBsZU5vZGUKICAgICAq\nLwogICAgQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCiAgICBwcm90ZWN0\nZWQgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIEpQUUxOb2RlCiAgICAgICAgaW1w\nbGVtZW50cyBOb2RlLCBTZXJpYWxpemFibGUgewoKICAgICAgICBmaW5hbCBp\nbnQgaWQ7CiAgICAgICAgZmluYWwgSlBRTCBwYXJzZXI7CiAgICAgICAgSlBR\nTE5vZGUgcGFyZW50OwogICAgICAgIEpQUUxOb2RlW10gY2hpbGRyZW47CiAg\nICAgICAgU3RyaW5nIHRleHQ7CiAgICAgICAgYm9vbGVhbiBub3QgPSBmYWxz\nZTsKICAgICAgICBib29sZWFuIGluRW51bVBhdGggPSBmYWxzZTsKCiAgICAg\nICAgcHVibGljIEpQUUxOb2RlKEpQUUwgcGFyc2VyLCBpbnQgaWQpIHsKICAg\nICAgICAgICAgdGhpcy5pZCA9IGlkOwogICAgICAgICAgICB0aGlzLnBhcnNl\nciA9IHBhcnNlcjsKICAgICAgICAgICAgdGhpcy5pbkVudW1QYXRoID0gcGFy\nc2VyLmluRW51bVBhdGg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBqanRPcGVuKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\namp0Q2xvc2UoKSB7CiAgICAgICAgfQoKICAgICAgICBKUFFMTm9kZVtdIGZp\nbmRDaGlsZHJlbkJ5SUQoaW50IGlkKSB7CiAgICAgICAgICAgIENvbGxlY3Rp\nb248SlBRTE5vZGU+IHNldCA9IG5ldyBMaW5rZWRIYXNoU2V0PEpQUUxOb2Rl\nPigpOwogICAgICAgICAgICBmaW5kQ2hpbGRyZW5CeUlEKGlkLCBzZXQpOwog\nICAgICAgICAgICByZXR1cm4gc2V0LnRvQXJyYXkobmV3IEpQUUxOb2RlW3Nl\ndC5zaXplKCldKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBm\naW5kQ2hpbGRyZW5CeUlEKGludCBpZCwgQ29sbGVjdGlvbjxKUFFMTm9kZT4g\nc2V0KSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBjaGlsZHJlbiAh\nPSBudWxsICYmIGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmlkID09IGlkKQogICAgICAgICAg\nICAgICAgICAgIHNldC5hZGQoY2hpbGRyZW5baV0pOwoKICAgICAgICAgICAg\nICAgIGNoaWxkcmVuW2ldLmZpbmRDaGlsZHJlbkJ5SUQoaWQsIHNldCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gaGFzQ2hp\nbGRJRChpbnQgaWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZpbmRDaGlsZEJ5\nSUQoaWQsIGZhbHNlKSAhPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgSlBR\nTE5vZGUgZmluZENoaWxkQnlJRChpbnQgaWQsIGJvb2xlYW4gcmVjdXJzZSkg\newogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgY2hpbGRyZW4gIT0gbnVs\nbCAmJiBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIEpQUUxOb2RlIGNoaWxkID0gY2hpbGRyZW5baV07CgogICAgICAgICAg\nICAgICAgaWYgKGNoaWxkLmlkID09IGlkKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBjaGlsZHJlbltpXTsKCiAgICAgICAgICAgICAgICBpZiAocmVj\ndXJzZSkgewogICAgICAgICAgICAgICAgICAgIEpQUUxOb2RlIGZvdW5kID0g\nY2hpbGQuZmluZENoaWxkQnlJRChpZCwgcmVjdXJzZSk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGZvdW5kICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmb3VuZDsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbm90IGZvdW5kCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\namp0U2V0UGFyZW50KE5vZGUgcGFyZW50KSB7CiAgICAgICAgICAgIHRoaXMu\ncGFyZW50ID0gKEpQUUxOb2RlKSBwYXJlbnQ7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgTm9kZSBqanRHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzLnBhcmVudDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGpqdEFkZENoaWxkKE5vZGUgbiwgaW50IGkpIHsKICAgICAgICAgICAg\naWYgKGNoaWxkcmVuID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNoaWxk\ncmVuID0gbmV3IEpQUUxOb2RlW2kgKyAxXTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChpID49IGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgICAgICAg\nSlBRTE5vZGUgY1tdID0gbmV3IEpQUUxOb2RlW2kgKyAxXTsKICAgICAgICAg\nICAgICAgIFN5c3RlbS5hcnJheWNvcHkoY2hpbGRyZW4sIDAsIGMsIDAsIGNo\naWxkcmVuLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoaWxkcmVuW2ldID0gKEpQ\nUUxOb2RlKSBuOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5vZGUgamp0\nR2V0Q2hpbGQoaW50IGkpIHsKICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVu\nW2ldOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRDaGlsZENv\ndW50KCkgewogICAgICAgICAgICByZXR1cm4gamp0R2V0TnVtQ2hpbGRyZW4o\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKUFFMTm9kZSBnZXRDaGls\nZChpbnQgaW5kZXgpIHsKICAgICAgICAgICAgcmV0dXJuIChKUFFMTm9kZSkg\namp0R2V0Q2hpbGQoaW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIEl0ZXJhdG9yPEpQUUxOb2RlPiBpdGVyYXRvcigpIHsKICAgICAgICAgICAg\ncmV0dXJuIEFycmF5cy5hc0xpc3QoY2hpbGRyZW4pLml0ZXJhdG9yKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpqdEdldE51bUNoaWxkcmVu\nKCkgewogICAgICAgICAgICByZXR1cm4gKGNoaWxkcmVuID09IG51bGwpID8g\nMCA6IGNoaWxkcmVuLmxlbmd0aDsKICAgICAgICB9CgogICAgICAgIHZvaWQg\nc2V0VGV4dChTdHJpbmcgdGV4dCkgewogICAgICAgICAgICB0aGlzLnRleHQg\nPSB0ZXh0OwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRUb2tlbihUb2tl\nbiB0KSB7CiAgICAgICAgICAgIHNldFRleHQodC5pbWFnZSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAg\nICAgICByZXR1cm4gSlBRTFRyZWVDb25zdGFudHMuamp0Tm9kZU5hbWVbdGhp\ncy5pZF07CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3Ry\naW5nKFN0cmluZyBwcmVmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIHByZWZp\neCArIHRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBEZWJ1Z2dpbmcgbWV0aG9kLgogICAgICAgICAqCiAgICAgICAgICog\nQHNlZSAjZHVtcChqYXZhLmlvLlByaW50U3RyZWFtLFN0cmluZykKICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBkdW1wKFN0cmluZyBwcmVmaXgp\nIHsKICAgICAgICAgICAgZHVtcChTeXN0ZW0ub3V0LCBwcmVmaXgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZHVtcCgpIHsKICAgICAgICAg\nICAgZHVtcCgiICIpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogRGVidWdnaW5nIG1ldGhvZCB0byBvdXRwdXQgYSBwYXJzZSB0cmVlLgog\nICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG91dCB0aGUgc3RyZWFtIHRv\nIHdoaWNoIHRvIHdyaXRlIHRoZSBkZWJ1Z2dpbmcgaW5mbwogICAgICAgICAq\nIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCB0byB3cml0ZSBvdXQgYmVmb3Jl\nIGxpbmVzCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZHVtcChQ\ncmludFN0cmVhbSBvdXQsIFN0cmluZyBwcmVmaXgpIHsKICAgICAgICAgICAg\nZHVtcChvdXQsIHByZWZpeCwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgZHVtcChQcmludFN0cmVhbSBvdXQsIFN0cmluZyBwcmVm\naXgsIGJvb2xlYW4gdGV4dCkgewogICAgICAgICAgICBvdXQucHJpbnRsbih0\nb1N0cmluZyhwcmVmaXgpCiAgICAgICAgICAgICAgICArICh0ZXh0ICYmIHRo\naXMudGV4dCAhPSBudWxsID8gIiBbIiArIHRoaXMudGV4dCArICJdIiA6ICIi\nKSk7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0\naDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgSlBRTE5vZGUgbiA9IChK\nUFFMTm9kZSkgY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBuLmR1bXAo\nb3V0LCBwcmVmaXggKyAiICIsIHRleHQpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmb3IgdW5pdCB0ZXN0aW5n\nIHB1cnBvc2VzLgogICAgICogQG5vamF2YWRvYwogICAgICovCiAgICBAU3Vw\ncHJlc3NXYXJuaW5ncygic2VyaWFsIikKICAgIHB1YmxpYyBzdGF0aWMgY2xh\nc3MgUGFyc2VkSlBRTAogICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxl\nIHsKCiAgICAgICAgLy8gVGhpcyBpcyBvbmx5IGV2ZXIgdXNlZCBkdXJpbmcg\ncGFyc2U7IHdoZW4gUGFyc2VkSlBRTCBpbnN0YW5jZXMKICAgICAgICAvLyBh\ncmUgc2VyaWFsaXplZCwgdGhleSB3aWxsIGhhdmUgYWxyZWFkeSBiZWVuIHBh\ncnNlZC4KICAgICAgICBwcml2YXRlIGZpbmFsIHRyYW5zaWVudCBKUFFMTm9k\nZSByb290OwoKICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBxdWVyeTsK\nICAgICAgICAKICAgICAgICAvLyBjYWNoZSBvZiBjYW5kaWRhdGUgdHlwZSBk\nYXRhLiBUaGlzIGlzIHN0b3JlZCBoZXJlIGluIGNhc2UgdGhpcyAgCiAgICAg\nICAgLy8gcGFyc2UgdHJlZSBpcyByZXVzZWQgaW4gYSBjb250ZXh0IHRoYXQg\nZG9lcyBub3Qga25vdyB3aGF0IHRoZSAKICAgICAgICAvLyBjYW5kaWRhdGUg\ndHlwZSBpcyBhbHJlYWR5LiAKICAgICAgICBwcml2YXRlIENsYXNzPD8+IF9j\nYW5kaWRhdGVUeXBlOwoKICAgICAgICBQYXJzZWRKUFFMKFN0cmluZyBqcHFs\nKSB7CiAgICAgICAgICAgIHRoaXMoanBxbCwgcGFyc2UoanBxbCkpOwogICAg\nICAgIH0KCiAgICAgICAgUGFyc2VkSlBRTChTdHJpbmcgcXVlcnksIEpQUUxO\nb2RlIHJvb3QpIHsKICAgICAgICAgICAgdGhpcy5yb290ID0gcm9vdDsKICAg\nICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUgcGFyc2UoU3RyaW5nIGpwcWwp\nIHsKICAgICAgICAgICAgaWYgKGpwcWwgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGpwcWwgPSAiIjsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gKEpQUUxOb2RlKSBuZXcgSlBRTChqcHFsKS5wYXJzZVF1\nZXJ5KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEVycm9yIGUpIHsKICAgICAg\nICAgICAgICAgIC8vIHNwZWNpYWwgaGFuZGxpbmcgZm9yIEVycm9yIHN1YmNs\nYXNzZXMsIHdoaWNoIHRoZQogICAgICAgICAgICAgICAgLy8gcGFyc2VyIG1h\neSBzb21ldGltZXMgKHVuZm9ydHVuYXRlbHkpIHRocm93CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicGFyc2Ut\nZXJyb3IiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZS50\nb1N0cmluZygpLCBqcHFsIH0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgdm9pZCBwb3B1bGF0ZShFeHByZXNzaW9uU3RvcmVRdWVyeSBx\ndWVyeSkgewogICAgICAgICAgICBRdWVyeUNvbnRleHQgY3R4ID0gcXVlcnku\nZ2V0Q29udGV4dCgpOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG93bmluZyBx\ndWVyeSdzIGNvbnRleHQgZG9lcyBub3QgaGF2ZQogICAgICAgICAgICAvLyBh\nbnkgY2FuZGlkYXRlIGNsYXNzLCB0aGVuIHNldCBpdCBoZXJlCiAgICAgICAg\nICAgIGlmIChjdHguZ2V0Q2FuZGlkYXRlVHlwZSgpID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGlmIChfY2FuZGlkYXRlVHlwZSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9jYW5kaWRhdGVUeXBlID0gbmV3IEpQUUxFeHBy\nZXNzaW9uQnVpbGRlcgogICAgICAgICAgICAgICAgICAgICAgICAobnVsbCwg\ncXVlcnksIHRoaXMpLmdldENhbmRpZGF0ZVR5cGUoKTsKICAgICAgICAgICAg\nICAgIGN0eC5zZXRDYW5kaWRhdGVUeXBlKF9jYW5kaWRhdGVUeXBlLCB0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAv\nKioKICAgICAgICAgKiBQdWJsaWMgZm9yIHVuaXQgdGVzdGluZyBwdXJwb3Nl\ncy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0Q2Fu\nZGlkYXRlVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGVU\neXBlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmlu\nZyAoKQoJCXsKCQkJcmV0dXJuIHRoaXMucXVlcnk7CgkJfQoJfQp9Cgo=\n","encoding":"base64"}

