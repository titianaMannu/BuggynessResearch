{"sha":"5933c4a97aab5fc6afd0179437236b8644e69fc6","node_id":"MDQ6QmxvYjIwNjM2NDo1OTMzYzRhOTdhYWI1ZmM2YWZkMDE3OTQzNzIzNmI4NjQ0ZTY5ZmM2","size":94477,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5933c4a97aab5fc6afd0179437236b8644e69fc6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neXM7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGls\nLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBv\ncnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoK\naW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRh\ndGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBD\nUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5Q\nZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5jb25mLlZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5jb25mLlZhbHVlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLm1ldGEuU291cmNlVHJhY2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnhtbC5Db21tZW50YWJsZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRv\ndWJsZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRmxvYXRJ\nZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYWxFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVs\ncGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50SWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0SWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwoKaW1wb3J0IHNlcnAu\ndXRpbC5TdHJpbmdzOwoKLyoqCiAqIENvbnRhaW5zIG1ldGFkYXRhIGFib3V0\nIGEgcGVyc2lzdGVudCB0eXBlLgogKiBUaGlzIG1ldGFkYXRhIGlzIGF2YWls\nYWJsZSBib3RoIGF0IGVuaGFuY2VtZW50IHRpbWUgYW5kIHJ1bnRpbWUuCiAq\nICBOb3RlIHRoYXQgdGhpcyBjbGFzcyBlbXBsb3lzIGFnZ3Jlc3NpdmUgY2Fj\naGluZywgYW5kIHRoZXJlZm9yZSBpdCBpcwogKiBpbXBvcnRhbnQgdG8gZmlu\nYWxpemUgdGhlIGNvbmZpZ3VyYXRpb24gb2YgZmllbGQgbWV0YWRhdGFzIGJl\nZm9yZSBpbnZva2luZwogKiBtZXRob2RzIHRoYXQgZGVwZW5kIG9uIHRoYXQg\nY29uZmlndXJhdGlvbiwgc3VjaCBhcwogKiB7QGxpbmsgI2dldFByaW1hcnlL\nZXlGaWVsZHN9LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KQFN1cHBy\nZXNzV2FybmluZ3MoInNlcmlhbCIpCnB1YmxpYyBjbGFzcyBDbGFzc01ldGFE\nYXRhCiAgICBleHRlbmRzIEV4dGVuc2lvbnMKICAgIGltcGxlbWVudHMgQ29t\ncGFyYWJsZTxDbGFzc01ldGFEYXRhPiwgU291cmNlVHJhY2tlciwgTWV0YURh\ndGFDb250ZXh0LCAKICAgIE1ldGFEYXRhTW9kZXMsIENvbW1lbnRhYmxlLCBW\nYWx1ZUxpc3RlbmVyIHsKCiAgICAvKioKICAgICAqIFVua25vd24gaWRlbnRp\ndHkgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nSURfVU5LTk9XTiA9IDA7CgogICAgLyoqCiAgICAgKiBEYXRhc3RvcmUgaWRl\nbnRpdHkgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgSURfREFUQVNUT1JFID0gMTsKCiAgICAvKioKICAgICAqIEFwcGxpY2F0\naW9uIGlkZW50aXR5IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IElEX0FQUExJQ0FUSU9OID0gMjsKCiAgICAvKioKICAgICAq\nIFVua25vd24gYWNjZXNzIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IEFDQ0VTU19VTktOT1dOID0gQWNjZXNzQ29kZS5VTktO\nT1dOOwoKICAgIC8qKgogICAgICogUGVyc2lzdGVudCBhdHRyaWJ1dGVzIGFy\nZSBhY2Nlc3NlZCB2aWEgZGlyZWN0IGZpZWxkIGFjY2Vzcy4gQml0IGZsYWcu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19G\nSUVMRCA9IEFjY2Vzc0NvZGUuRklFTEQ7CgogICAgLyoqCiAgICAgKiBQZXJz\naXN0ZW50IGF0dHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBzZXR0ZXJzIGFu\nZCBnZXR0ZXJzLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgQUNDRVNTX1BST1BFUlRZID0gQWNjZXNzQ29kZS5QUk9Q\nRVJUWTsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgY2xhc3MgaGFzIGV4\ncGxpY2l0bHkgZGVmaW5lZCBhbiBhY2Nlc3MgdHlwZS4gCiAgICAgKiBUaGlz\nIHdpbGwgYWxsb3cgdGhlIGF0dHJpYnV0ZXMgdG8gdXNlIG1peGVkIGFjY2Vz\ncyBpLmUuIHNvbWUgZmllbGQgCiAgICAgKiBtYXkgdXNlIEFDQ0VTU19GSUVM\nRCB3aGlsZSBvdGhlcnMgQUNDRVNTX1BST1BFUlRZLiAKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQUNDRVNTX0VYUExJQ0lUID0gQWNj\nZXNzQ29kZS5FWFBMSUNJVDsKICAgIAogICAgLyoqCiAgICAgKiBWYWx1ZSBm\nb3IgdXNpbmcgYSBzeW50aGV0aWMgZGV0YWNoZWQgc3RhdGUgZmllbGQsIHdo\naWNoIGlzIHRoZSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTWU5USEVUSUMgPSAiYHN5biI7CgogICAgcHJvdGVj\ndGVkIHN0YXRpYyBmaW5hbCBTdHJpbmcgREVGQVVMVF9TVFJJTkcgPSAiYCI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChDbGFzc01ldGFEYXRhLmNs\nYXNzKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBGZXRjaEdyb3VwW10g\nRU1QVFlfRkVUQ0hfR1JPVVBfQVJSQVkKICAgICAgICA9IG5ldyBGZXRjaEdy\nb3VwWzBdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nW10gRU1Q\nVFlfU1RSSU5HX0FSUkFZID0gbmV3IFN0cmluZ1swXTsKCiAgICBwcml2YXRl\nIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3M7CiAgICBwcml2YXRlIHRyYW5z\naWVudCBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsKCiAgICBwcml2YXRl\nIGZpbmFsIFZhbHVlTWV0YURhdGEgX293bmVyOwogICAgcHJpdmF0ZSBmaW5h\nbCBMaWZlY3ljbGVNZXRhRGF0YSBfbGlmZU1ldGEgPSBuZXcgTGlmZWN5Y2xl\nTWV0YURhdGEodGhpcyk7CiAgICBwcml2YXRlIEZpbGUgX3NyY0ZpbGUgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgX3NyY1R5cGUgPSBTUkNfT1RIRVI7CiAg\nICBwcml2YXRlIGludCBfbGluZU51bSA9IDA7ICAKICAgIHByaXZhdGUgaW50\nIF9jb2xOdW0gPSAwOyAgCiAgICBwcml2YXRlIFN0cmluZ1tdIF9jb21tZW50\ncyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbGlzdEluZGV4ID0gLTE7CiAg\nICBwcml2YXRlIGludCBfc3JjTW9kZSA9IE1PREVfTUVUQSB8IE1PREVfTUFQ\nUElORzsKICAgIHByaXZhdGUgaW50IF9yZXNNb2RlID0gTU9ERV9OT05FOwoK\nICAgIHByaXZhdGUgQ2xhc3M8Pz4gX3R5cGUgPSBPYmplY3QuY2xhc3M7CiAg\nICBwcml2YXRlIGludCBfaGFzaENvZGUgPSBPYmplY3QuY2xhc3MuZ2V0TmFt\nZSgpLmhhc2hDb2RlKCk7CiAgICBwcml2YXRlIGZpbmFsIE1hcDxTdHJpbmcs\nRmllbGRNZXRhRGF0YT4gX2ZpZWxkTWFwID0gbmV3IFRyZWVNYXA8U3RyaW5n\nLEZpZWxkTWV0YURhdGE+KCk7CiAgICBwcml2YXRlIE1hcDxTdHJpbmcsRmll\nbGRNZXRhRGF0YT4gX3N1cEZpZWxkTWFwID0gbnVsbDsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICBwcml2YXRlIENv\nbGxlY3Rpb248U3RyaW5nPiBfc3RhdGljRmllbGRzID0gbnVsbDsKICAgIHBy\naXZhdGUgaW50W10gX2ZpZWxkRGF0YVRhYmxlID0gbnVsbDsKICAgIHByaXZh\ndGUgTWFwPFN0cmluZyxGZXRjaEdyb3VwPiBfZmdNYXAgPSBudWxsOwoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBOb3RlOiBpZiB5b3Ug\nYWRkIGFkZGl0aW9uYWwgc3RhdGUsIG1ha2Ugc3VyZSB0byBhZGQgaXQgdG8g\nY29weSgpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHByaXZh\ndGUgQ2xhc3M8Pz4gX29iamVjdElkID0gbnVsbDsKICAgIHByaXZhdGUgQm9v\nbGVhbiBfb2JqZWN0SWRTaGFyZWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29s\nZWFuIF9vcGVuanBhSWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9l\neHRlbnQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9lbWJlZGRlZCA9\nIG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2VtYmVkZGFibGUgPSBmYWxz\nZTsKICAgIHByaXZhdGUgQm9vbGVhbiBfaW50ZXJmYWNlID0gbnVsbDsKICAg\nIHByaXZhdGUgQ2xhc3M8Pz4gX2ltcGwgPSBudWxsOwogICAgcHJpdmF0ZSBM\naXN0PENsYXNzPD8+PiBfaW50ZXJmYWNlcyA9IG51bGw7CiAgICBwcml2YXRl\nIGZpbmFsIE1hcDxDbGFzczw/PixNYXA8U3RyaW5nLFN0cmluZz4+IF9pZmFj\nZU1hcCA9IAogICAgCW5ldyBIYXNoTWFwPENsYXNzPD8+LE1hcDxTdHJpbmcs\nU3RyaW5nPj4oKTsKICAgIHByaXZhdGUgaW50IF9pZGVudGl0eSA9IElEX1VO\nS05PV047CiAgICBwcml2YXRlIGludCBfaWRTdHJhdGVneSA9IFZhbHVlU3Ry\nYXRlZ2llcy5OT05FOwogICAgcHJpdmF0ZSBpbnQgX2FjY2Vzc1R5cGUgPSBB\nY2Nlc3NDb2RlLlVOS05PV047CiAgICBwcml2YXRlIGJvb2xlYW4gX3JlcGxp\nY2F0ZWQgPSBmYWxzZTsKICAgIAogICAgcHJpdmF0ZSBTdHJpbmcgX3NlcU5h\nbWUgPSBERUZBVUxUX1NUUklORzsKICAgIHByaXZhdGUgU2VxdWVuY2VNZXRh\nRGF0YSBfc2VxTWV0YSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfY2Fj\naGVOYW1lID0gREVGQVVMVF9TVFJJTkc7IC8vIG51bGwgaW1wbGllcyBARGF0\nYUNhY2hlKGVuYWJsZWQ9ZmFsc2UpCiAgICBwcml2YXRlIGJvb2xlYW4gX2Rh\ndGFDYWNoZUVuYWJsZWQgPSBmYWxzZTsgICAgIC8vIHRydWUgaW1wbGllcyB0\naGUgY2xhc3MgaGFzIGJlZW4gYW5ub3RhdGVkIGJ5IHRoZSB1c2VyIG9yIG5h\nbWUgb2YKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gdGhlIGNhY2hlIGlzIGV4cGxpY2l0bHkgc2V0IGJ5IHRo\nZSB1c2VyIHRvIGEgbnVsbCBzdHJpbmcKCiAgICBwcml2YXRlIEJvb2xlYW4g\nX2NhY2hlRW5hYmxlZCA9IG51bGw7ICAgICAgIC8vIGRlbm90ZXMgc3RhdHVz\nIG9mIEpQQSAyIEBDYWNoZWFibGUgYW5ub3RhdGlvbgogICAgcHJpdmF0ZSBp\nbnQgX2NhY2hlVGltZW91dCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAgcHJp\ndmF0ZSBCb29sZWFuIF9kZXRhY2hhYmxlID0gbnVsbDsKICAgIHByaXZhdGUg\nU3RyaW5nIF9kZXRhY2hTdGF0ZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX2FsaWFzID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF92\nZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5fVkFMVUU7CgogICAgcHJpdmF0ZSBD\nbGFzczw/PiBfc3VwZXIgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFE\nYXRhIF9zdXBlck1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzczw/Pltd\nIF9zdWJzID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtdIF9z\ndWJNZXRhcyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGFbXSBf\nbWFwU3ViTWV0YXMgPSBudWxsOwoKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0\nYVtdIF9maWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRh\nW10gX3VubWdkRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRh\nRGF0YVtdIF9hbGxGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1l\ndGFEYXRhW10gX2FsbFBLRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmll\nbGRNZXRhRGF0YVtdIF9hbGxERkdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0\nZSBGaWVsZE1ldGFEYXRhW10gX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAg\ncHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2xpc3RpbmdGaWVsZHMgPSBudWxs\nOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbExpc3RpbmdGaWVs\nZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbFBy\nb3h5RmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtd\nIF9hbGxMcnNGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3Vw\nW10gX2ZncyA9IG51bGw7CiAgICBwcml2YXRlIEZldGNoR3JvdXBbXSBfY3Vz\ndG9tRkdzID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaW50ZXJjZXB0\naW5nID0gZmFsc2U7CiAgICBwcml2YXRlIEJvb2xlYW4gX3VzZUlkQ2xhc3NG\ncm9tUGFyZW50ID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfYWJzdHJh\nY3QgPSBmYWxzZTsKICAgIHByaXZhdGUgQm9vbGVhbiBfaGFzQWJzdHJhY3RQ\nS0ZpZWxkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfaGFzUEtGaWVs\nZHNGcm9tQWJzdHJhY3RDbGFzcyA9IG51bGw7CiAgICAKICAgIC8qKgogICAg\nICogQ29uc3RydWN0b3IuIFN1cHBseSBkZXNjcmliZWQgdHlwZSBhbmQgcmVw\nb3NpdG9yeS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEo\nQ2xhc3M8Pz4gdHlwZSwgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAg\nICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAgX293bmVyID0gbnVsbDsK\nICAgICAgICBzZXREZXNjcmliZWRUeXBlKHR5cGUpOwogICAgICAgIHJlZ2lz\ndGVyRm9yVmFsdWVVcGRhdGUoIkRhdGFDYWNoZVRpbWVvdXQiKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEVtYmVkZGVkIGNvbnN0cnVjdG9yLiBTdXBwbHkg\nZW1iZWRkaW5nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NN\nZXRhRGF0YShWYWx1ZU1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgX293bmVy\nID0gb3duZXI7CiAgICAgICAgX3JlcG9zID0gb3duZXIuZ2V0UmVwb3NpdG9y\neSgpOwogICAgICAgIHNldEVudkNsYXNzTG9hZGVyKG93bmVyLmdldEZpZWxk\nTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAgICAgICAgICAg\nIGdldEVudkNsYXNzTG9hZGVyKCkpOwogICAgICAgIHJlZ2lzdGVyRm9yVmFs\ndWVVcGRhdGUoIkRhdGFDYWNoZVRpbWVvdXQiKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgb3duaW5nIHJlcG9zaXRvcnkuCiAgICAgKi8K\nICAgIHB1YmxpYyBNZXRhRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgp\nIHsKICAgICAgICByZXR1cm4gX3JlcG9zOwogICAgfQoKICAgIC8qKgogICAg\nICogSWYgdGhpcyBtZXRhZGF0YSBpcyBmb3IgYW4gZW1iZWRkZWQgb2JqZWN0\nLCByZXR1cm5pbmcgdGhlIG93bmluZyB2YWx1ZS4KICAgICAqLwogICAgcHVi\nbGljIFZhbHVlTWV0YURhdGEgZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSB7CiAg\nICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIGNsYXNzIGRlc2NyaWJlZCBieSB0aGlz\nIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0RGVz\nY3JpYmVkVHlwZSgpIHsKICAgICAgICByZXR1cm4gX3R5cGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGNsYXNzIGRlc2NyaWJlZCBieSB0aGlz\nIG1ldGFkYXRhLiBUaGUgdHlwZSBtYXkgYmUgcmVzZXQgd2hlbgogICAgICog\nYW4gZW1iZWRkZWQgdmFsdWUgY2hhbmdlcyBpdHMgZGVjbGFyZWQgdHlwZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0RGVzY3JpYmVkVHlwZShD\nbGFzczw/PiB0eXBlKSB7CiAgICAgICAgaWYgKHR5cGUuZ2V0U3VwZXJjbGFz\ncygpICE9IG51bGwgJiYgImphdmEubGFuZy5FbnVtIi5lcXVhbHMKICAgICAg\nICAgICAgKHR5cGUuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nZW51bSIsIHR5cGUpKTsKICAgICAgICBfdHlwZSA9IHR5cGU7CiAgICAgICAg\nX2hhc2hDb2RlID0gX3R5cGUuZ2V0TmFtZSgpLmhhc2hDb2RlKCk7CiAgICAg\nICAgaWYgKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKHR5cGUpKQogICAgICAgICAgICBzZXRJbnRlcmNlcHRpbmcodHJ1ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZW52aXJvbm1lbnRhbCBsb2Fk\nZXIgdXNlZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRhZGF0YS4KICAgICAqIFRo\nZSBjbGFzcyBtZXRhZGF0YSBzaG91bGQgdXNlIHRoaXMgbG9hZGVyIHdoZW4g\nbG9hZGluZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0cyBzdXBlcmNsYXNzIGFu\nZCBmaWVsZCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIENsYXNzTG9hZGVy\nIGdldEVudkNsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfbG9hZGVy\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGNsYXNzIGVudmlyb25tZW50\nYWwgbG9hZGVyIHVzZWQgd2hlbiBsb2FkaW5nIHRoaXMgbWV0YWRhdGEuCiAg\nICAgKiBUaGUgY2xhc3MgbWV0YWRhdGEgc2hvdWxkIHVzZSB0aGlzIGxvYWRl\nciB3aGVuIGxvYWRpbmcgbWV0YWRhdGEgZm9yCiAgICAgKiBpdHMgc3VwZXJj\nbGFzcyBhbmQgZmllbGQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEVudkNsYXNzTG9hZGVyKENsYXNzTG9hZGVyIGxvYWRlcikgewogICAg\nICAgIF9sb2FkZXIgPSBsb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBzdXBlcmNsYXNzIG9mIHRoZSBkZXNj\ncmliZWQgdHlwZS4KICAgICAqLwogICAgcHVibGljIENsYXNzPD8+IGdldFBD\nU3VwZXJjbGFzcygpIHsKICAgICAgICByZXR1cm4gX3N1cGVyOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgc3VwZXJj\nbGFzcyBvZiB0aGUgZGVzY3JpYmVkIHR5cGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFBDU3VwZXJjbGFzcyhDbGFzczw/PiBwYykgewogICAgICAg\nIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgIF9zdXBlciA9IHBjOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIGZvciB0aGlzIGNs\nYXNzJyBzdXBlcmNsYXNzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpIHsKICAgICAgICBpZiAo\nX3N1cGVyTWV0YSA9PSBudWxsICYmIF9zdXBlciAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nX3N1cGVyTWV0YSA9IF9yZXBvcy5uZXdFbWJlZGRlZENsYXNzTWV0YURhdGEo\nX293bmVyKTsKICAgICAgICAgICAgICAgIF9zdXBlck1ldGEuc2V0RGVzY3Jp\nYmVkVHlwZShfc3VwZXIpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgICAgIF9zdXBlck1ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEoX3N1cGVy\nLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9z\ndXBlck1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEg\nZm9yIHRoaXMgY2xhc3MnIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFBDU3VwZXJjbGFzc01ldGFEYXRhKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAg\nIF9zdXBlck1ldGEgPSBtZXRhOwogICAgICAgIGlmIChtZXRhICE9IG51bGwp\nCiAgICAgICAgICAgIHNldFBDU3VwZXJjbGFzcyhtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMg\nY2xhc3MgaXMgbWFwcGVkIHRvIHRoZSBkYXRhc3RvcmUuIEJ5IGRlZmF1bHQs\nIG9ubHkKICAgICAqIHJldHVybnMgZmFsc2UgaWYgY2xhc3MgaXMgZW1iZWRk\nZWQtb25seSwgYnV0IHN1YmNsYXNzZXMgbWlnaHQgb3ZlcnJpZGUKICAgICAq\nIHRvIGFsbG93IHVubWFwcGVkIG90aGVyIHR5cGVzLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc01hcHBlZCgpIHsKICAgICAgICByZXR1cm4gX2Vt\nYmVkZGVkICE9IEJvb2xlYW4uVFJVRTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgY2xvc2VzdCBtYXBwZWQgc3VwZXJjbGFzcy4KICAgICAq\nLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWFwcGVkUENTdXBlcmNs\nYXNzTWV0YURhdGEoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgPT0g\nbnVsbCB8fCBzdXAuaXNNYXBwZWQoKSkKICAgICAgICAgICAgcmV0dXJuIHN1\ncDsKICAgICAgICByZXR1cm4gc3VwLmdldE1hcHBlZFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGtu\nb3duIHBlcnNpc3RlbmNlIGNhcGFibGUgc3ViY2xhc3NlcyBvZiB0aGUgZGVz\nY3JpYmVkIHR5cGUsCiAgICAgKiBvciBlbXB0eSBhcnJheSBpZiBub25lIG9y\nIGlmIHRoaXMgaXMgZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzczw/PltdIGdldFBDU3ViY2xhc3NlcygpIHsKICAgICAgICBp\nZiAoX293bmVyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNZXRhRGF0\nYVJlcG9zaXRvcnkuRU1QVFlfQ0xBU1NFUzsKCiAgICAgICAgX3JlcG9zLnBy\nb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhfbG9hZGVyKTsKICAgICAgICBpZiAo\nX3N1YnMgPT0gbnVsbCkgewogICAgICAgICAgICBDb2xsZWN0aW9uPENsYXNz\nPD8+PiBzdWJzID0gX3JlcG9zLmdldFBDU3ViY2xhc3NlcyhfdHlwZSk7CiAg\nICAgICAgICAgIF9zdWJzID0gKENsYXNzW10pIHN1YnMudG9BcnJheShuZXcg\nQ2xhc3Nbc3Vicy5zaXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9zdWJzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRh\nZGF0YSBmb3IgdGhlIGtub3duIHBlcnNpc3RlbmNlIGNhcGFibGUgc3ViY2xh\nc3NlcyBvZgogICAgICogdGhlIGRlc2NyaWJlZCB0eXBlLCBvciBlbXB0eSBh\ncnJheSBpZiBub25lIG9yIGlmIHRoaXMgaXMgZW1iZWRkZWQKICAgICAqIG1l\ndGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdl\ndFBDU3ViY2xhc3NNZXRhRGF0YXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3JlcG9zLkVNUFRZX01FVEFT\nOwoKICAgICAgICBDbGFzczw/PltdIHN1YnMgPSBnZXRQQ1N1YmNsYXNzZXMo\nKTsgLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX3N1Yk1ldGFzID09\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgICAgICBfc3ViTWV0YXMgPSBfcmVwb3MuRU1QVFlfTUVUQVM7\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YVtdIG1ldGFzID0gX3JlcG9zLm5ld0NsYXNzTWV0YURhdGFBcnJheQog\nICAgICAgICAgICAgICAgICAgIChzdWJzLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICAgICAgbWV0YXNbaV0gPSBfcmVwb3MuZ2V0TWV0YURh\ndGEoc3Vic1tpXSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBf\nc3ViTWV0YXMgPSBtZXRhczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX3N1Yk1ldGFzOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGFsbCBtYXBwZWQgc3ViY2xhc3Nlcy4KICAgICAqLwogICAgcHVi\nbGljIENsYXNzTWV0YURhdGFbXSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWV0YURh\ndGFzKCkgewogICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9yZXBvcy5FTVBUWV9NRVRBUzsKCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YVtdIHN1YnMgPSBnZXRQQ1N1YmNsYXNzTWV0YURhdGFzKCk7IC8v\nIGNoZWNrcyBmb3IgbmV3CiAgICAgICAgaWYgKF9tYXBTdWJNZXRhcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChzdWJzLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICAgICAgX21hcFN1Yk1ldGFzID0gc3ViczsKICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICBMaXN0PENsYXNzTWV0YURhdGE+IG1h\ncHBlZCA9IAogICAgICAgICAgICAgICAgCW5ldyBBcnJheUxpc3Q8Q2xhc3NN\nZXRhRGF0YT4oc3Vicy5sZW5ndGgpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdWJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgICAgIGlmIChzdWJzW2ldLmlzTWFwcGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIG1hcHBlZC5hZGQoc3Vic1tpXSk7CiAgICAgICAgICAgICAg\nICBfbWFwU3ViTWV0YXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSBtYXBwZWQudG9B\ncnJheQogICAgICAgICAgICAgICAgICAgIChfcmVwb3MubmV3Q2xhc3NNZXRh\nRGF0YUFycmF5KG1hcHBlZC5zaXplKCkpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX21hcFN1Yk1ldGFzOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHR5cGUgb2YgaWRlbnRpdHkgYmVpbmcgdXNlZC4g\nVGhpcyB3aWxsIGJlIG9uZSBvZjoKICAgICAqIDx1bD4KICAgICAqIDxsaT57\nQGxpbmsgI0lEX1VOS05PV059OiB1bmtub3duIGlkZW50aXR5IHR5cGU8L2xp\nPgogICAgICogPGxpPntAbGluayAjSURfREFUQVNUT1JFfTogaWRlbnRpdHkg\nbWFuYWdlZCBieSB0aGUgZGF0YSBzdG9yZSBhbmQKICAgICAqIGluZGVwZW5k\nZW50CW9mIHRoZSBmaWVsZHMgb2YgdGhlIGluc3RhbmNlPC9saT4KICAgICAq\nIDxsaT57QGxpbmsgI0lEX0FQUExJQ0FUSU9OfTogaWRlbnRpdHkgbWFuYWdl\nZCBieSB0aGUgYXBwbGljYXRpb24gYW5kCiAgICAgKiBkZWZpbmVkIGJ5IG9u\nZSBvciBtb3JlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICog\nPC91bD4gSWYgdW5zcGVjaWZpZWQsIGRlZmF1bHRzIHRvIHtAbGluayAjSURf\nREFUQVNUT1JFfSBpZiB0aGVyZSBhcmUgbm8KICAgICAqIHByaW1hcnkga2V5\nIGZpZWxkcywgYW5kIHtAbGluayAjSURfQVBQTElDQVRJT059IG90aGVyd2lz\nZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRJZGVudGl0eVR5cGUoKSB7\nCiAgICAgICAgaWYgKF9pZGVudGl0eSA9PSBJRF9VTktOT1dOKSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5n\nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKQogICAgICAgICAgICAg\nICAgX2lkZW50aXR5ID0gc3VwLmdldElkZW50aXR5VHlwZSgpOwogICAgICAg\nICAgICBlbHNlIGlmIChnZXRQcmltYXJ5S2V5RmllbGRzKCkubGVuZ3RoID4g\nMCkKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IElEX0FQUExJQ0FUSU9O\nOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBlZCgpKQogICAgICAgICAg\nICAgICAgX2lkZW50aXR5ID0gSURfREFUQVNUT1JFOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfaWRlbnRpdHkgPSBfcmVwb3MuZ2V0TWV0\nYURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS4KICAgICAgICAgICAgICAg\nICAgICBnZXREZWZhdWx0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfaWRlbnRpdHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2VkLiBUaGlzIHdpbGwgYmUg\nb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxpPntAbGluayAjSURfVU5L\nTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwvbGk+CiAgICAgKiA8bGk+\ne0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRo\nZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBlbmRlbnQJb2YgdGhlIGZp\nZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICogPGxpPntAbGluayAj\nSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBhcHBs\naWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkgb25lIG9yIG1vcmUgZmll\nbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8L3VsPiBJZiB1bnNw\nZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJRF9EQVRBU1RPUkV9IGlm\nIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBrZXkgZmllbGRzLCBhbmQg\ne0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3aXNlLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRJZGVudGl0eVR5cGUoaW50IHR5cGUpIHsKICAg\nICAgICBfaWRlbnRpdHkgPSB0eXBlOwogICAgICAgIGlmICh0eXBlICE9IElE\nX0FQUExJQ0FUSU9OKSB7CiAgICAgICAgICAgIF9vYmplY3RJZCA9IG51bGw7\nCiAgICAgICAgICAgIF9vcGVuanBhSWQgPSBudWxsOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YS1zcGVjaWZpZWQgY2xh\nc3MgdG8gdXNlIGZvciB0aGUgb2JqZWN0IElELgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3M8Pz4gZ2V0T2JqZWN0SWRUeXBlKCkgewogICAgICAgIC8vIGlm\nIHRoaXMgZW50aXR5IGRvZXMgbm90IHVzZSBJZENsYXNzIGZyb20gdGhlIHBh\ncmVudCBlbnRpdHksCiAgICAgICAgLy8ganVzdCByZXR1cm4gdGhlIF9vYmpl\nY3RJZCBzZXQgZHVyaW5nIGFubm90YXRpb24gcGFyc2luZyB0aW1lLgogICAg\nICAgIGlmICghdXNlSWRDbGFzc0Zyb21QYXJlbnQoKSkgewogICAgICAgICAg\nICBpZiAoX29iamVjdElkICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gX29iamVjdElkOwogICAgICAgIH0gCiAgICAgICAgCiAgICAgICAgLy8g\naWYgdGhpcyBlbnRpdHkgdXNlcyBJZENsYXNzIGZyb20gdGhlIHBhcmVudCBl\nbnRpdHksCiAgICAgICAgLy8gdGhlIF9vYmplY3RJZCBzZXQgZHVyaW5nIHRo\nZSBwYXJzaW5nIHRpbWUgc2hvdWxkIGJlCiAgICAgICAgLy8gaWdub3JlZCwg\nYW5kIGxldCB0aGUgc3lzdGVtIGRldGVybWluZSB0aGUgb2JqZWN0SWQgdHlw\nZQogICAgICAgIC8vIG9mIHRoaXMgZW50aXR5LgogICAgICAgIGlmIChnZXRJ\nZGVudGl0eVR5cGUoKSAhPSBJRF9BUFBMSUNBVElPTikKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVs\nbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9XTikgewog\nICAgICAgICAgICBfb2JqZWN0SWQgPSBzdXAuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0SWQ7CiAgICAgICAgfQoKICAg\nICAgICAvLyBmaWd1cmUgb3V0IE9wZW5KUEEgaWRlbnRpdHkgdHlwZSBiYXNl\nZCBvbiBwcmltYXJ5IGtleSBmaWVsZAogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBwa3MgPSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgaWYgKHBr\ncy5sZW5ndGggIT0gMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgc3dpdGNoIChwa3NbMF0uZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBf\nb2JqZWN0SWQgPSBCeXRlSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICBf\nb2JqZWN0SWQgPSBDaGFySWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gRG91YmxlSWQuY2xhc3M7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgIF9vYmplY3RJZCA9IEZsb2F0SWQuY2xhc3M7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAg\nICAgICAgX29iamVjdElkID0gSW50SWQuY2xhc3M7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBMb25nSWQuY2xhc3M7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAg\nICAgICAgIF9vYmplY3RJZCA9IFNob3J0SWQuY2xhc3M7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5H\nOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gU3RyaW5nSWQuY2xhc3M7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuREFURToKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IERhdGVJ\nZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9CSkVDVDoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IE9iamVjdElk\nLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICBfb2Jq\nZWN0SWQgPSBCaWdEZWNpbWFsSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoK\nICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEJpZ0ludGVnZXJJZC5jbGFz\nczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX29iamVjdElkOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1l\ndGFkYXRhLXNwZWNpZmllZCBjbGFzcyB0byB1c2UgZm9yIHRoZSBvYmplY3Qg\nSUQuCiAgICAgKiBXaGVuIHRoZXJlIGlzIElkQ2xhc3MgYW5ub3RhdGlvbiwg\nQW5ub3RhdGlvbk1ldGFEYXRhUGFyc2VyCiAgICAgKiB3aWxsIGNhbGwgdGhp\ncyBtZXRob2QgdG8gc2V0IE9iamVjdElkIHR5cGUuIEhvd2V2ZXIsIGlmIAog\nICAgICogdGhpcyBpcyBhIGRlcml2ZWQgaWRlbnRpdHkgaW4gdGhlIGNoaWxk\nIGVudGl0eSB3aGVyZSBhIAogICAgICogcmVsYXRpb24gZmllbGQgKHBhcmVu\ndCBlbnRpdHkpIGlzIHVzZWQgYXMgYW4gaWQsIGFuZCB0aGlzIAogICAgICog\ncmVsYXRpb24gZmllbGQgaGFzIGFuIElkQ2xhc3MsIHRoZSBJZENsYXNzIGFu\nbm90YXRpb24gaW4gCiAgICAgKiB0aGUgY2hpbGQgZW50aXR5IGNhbiBiZSBp\nZ25vcmVkIGFzIE9wZW5qcGEgd2lsbCBhdXRvbWF0aWNhbGx5ICAgCiAgICAg\nKiB3cmFwIHBhcmVudCdzIElkQ2xhc3MgYXMgY2hpbGQncyBJZENsYXNzLiAK\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0T2JqZWN0SWRUeXBlKENsYXNz\nPD8+IGNscywgYm9vbGVhbiBzaGFyZWQpIHsKICAgICAgICBfb2JqZWN0SWQg\nPSBudWxsOwogICAgICAgIF9vcGVuanBhSWQgPSBudWxsOwogICAgICAgIF9v\nYmplY3RJZFNoYXJlZCA9IG51bGw7CiAgICAgICAgaWYgKGNscyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIGRvbid0IGxldCBwZW9wbGUgYXNzaWduIE9w\nZW5KUEFJZCB0eXBlczsgc2FmZXIgdG8gY2FsY3VsYXRlIGl0CiAgICAgICAg\nICAgIC8vIG91cnNlbHZlcwogICAgICAgICAgICBzZXRJZGVudGl0eVR5cGUo\nSURfQVBQTElDQVRJT04pOwogICAgICAgICAgICBpZiAoIU9wZW5KUEFJZC5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykpIHsKICAgICAgICAgICAgICAg\nIF9vYmplY3RJZCA9IGNsczsKICAgICAgICAgICAgICAgIF9vYmplY3RJZFNo\nYXJlZCA9IChzaGFyZWQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdGhpcyB0eXBlIHVzZXMgYW4gYXBwbGljYXRpb24gaWRl\nbnRpdHkgY2xhc3MgdGhhdCBpcyBzaGFyZWQKICAgICAqIHdpdGggb3RoZXIg\nY2xhc3NlcywgYW5kIGlzIHRoZXJlZm9yZSB3cmFwcGVkIGluIGFuIHtAbGlu\nayBPYmplY3RJZH0uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzT2Jq\nZWN0SWRUeXBlU2hhcmVkKCkgewogICAgICAgIGlmIChfb2JqZWN0SWRTaGFy\nZWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RJZFNoYXJl\nZC5ib29sZWFuVmFsdWUoKTsKICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCk7CiAgICAgICAgcmV0dXJuIGlzT3Bl\nbkpQQUlkZW50aXR5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRoaXMgdHlwZSB1c2VzIE9wZW5KUEEgaWRlbnRpdHkuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzT3BlbkpQQUlkZW50aXR5KCkgewogICAgICAg\nIGlmIChfb3BlbmpwYUlkID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3M8\nPz4gY2xzID0gZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIGlmIChj\nbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgX29wZW5qcGFJZCA9IChPcGVuSlBBSWQuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShjbHMpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAg\nICAgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX29wZW5qcGFJZC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBzdHJhdGVneSB0byB1c2UgZm9yIGRhdGFzdG9yZSBpZGVudGl0\neSBnZW5lcmF0aW9uLgogICAgICogT25lIG9mIHRoZSBjb25zdGFudHMgZnJv\nbSB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzfS4KICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRJZGVudGl0eVN0cmF0ZWd5KCkgewogICAgICAgIGlmIChnZXRJ\nZGVudGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYg\nX2lkU3RyYXRlZ3kgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpIHsKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdl\ndElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAgICAg\nICBfaWRTdHJhdGVneSA9IHN1cC5nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9pZFN0cmF0ZWd5ID0g\nVmFsdWVTdHJhdGVnaWVzLk5BVElWRTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9pZFN0cmF0ZWd5OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0\ncmF0ZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdlbmVyYXRp\nb24uCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtAbGluayBW\nYWx1ZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJ\nZGVudGl0eVN0cmF0ZWd5KGludCBzdHJhdGVneSkgewogICAgICAgIF9pZFN0\ncmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICAgICAgaWYgKHN0cmF0ZWd5ICE9IFZh\nbHVlU3RyYXRlZ2llcy5TRVFVRU5DRSkKICAgICAgICAgICAgc2V0SWRlbnRp\ndHlTZXF1ZW5jZU5hbWUobnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNlIG5hbWUsIG9yIG51bGwg\nZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0SWRlbnRp\ndHlTZXF1ZW5jZU5hbWUoKSB7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5H\nLmVxdWFscyhfc2VxTmFtZSkpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLmdldElkZW50aXR5U2VxdWVuY2VOYW1lKCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9zZXFOYW1lID0gbnVs\nbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zZXFOYW1lOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5j\nZSBuYW1lLCBvciBudWxsIGZvciBub25lLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRJZGVudGl0eVNlcXVlbmNlTmFtZShTdHJpbmcgc2VxTmFtZSkg\newogICAgICAgIF9zZXFOYW1lID0gc2VxTmFtZTsKICAgICAgICBfc2VxTWV0\nYSA9IG51bGw7CiAgICAgICAgaWYgKHNlcU5hbWUgIT0gbnVsbCkKICAgICAg\nICAgICAgc2V0SWRlbnRpdHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuU0VR\nVUVOQ0UpOwogICAgfQoKICAgIC8qKgogICAgICogTWV0YWRhdGEgZm9yIHRo\nZSBkYXRhc3RvcmUgaWRlbnRpdHkgc2VxdWVuY2UuCiAgICAgKi8KICAgIHB1\nYmxpYyBTZXF1ZW5jZU1ldGFEYXRhIGdldElkZW50aXR5U2VxdWVuY2VNZXRh\nRGF0YSgpIHsKICAgICAgICBpZiAoX3NlcU1ldGEgPT0gbnVsbCAmJiBnZXRJ\nZGVudGl0eVNlcXVlbmNlTmFtZSgpICE9IG51bGwpCiAgICAgICAgICAgIF9z\nZXFNZXRhID0gX3JlcG9zLmdldFNlcXVlbmNlTWV0YURhdGEodGhpcywKICAg\nICAgICAgICAgICAgIGdldElkZW50aXR5U2VxdWVuY2VOYW1lKCksIHRydWUp\nOwogICAgICAgIHJldHVybiBfc2VxTWV0YTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEluZm9ybWF0aW9uIGFib3V0IGxpZmVjeWNsZSBjYWxsYmFja3MgZm9y\nIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBMaWZlY3ljbGVNZXRh\nRGF0YSBnZXRMaWZlY3ljbGVNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX2xpZmVNZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQgdHlwZSwgb3IgPGNvZGU+bnVsbDwv\nY29kZT4gaWYgbm9uZQogICAgICogaGFzIGJlZW4gc2V0LgogICAgICogCiAg\nICAgKiBAc2VlICNzZXRUeXBlQWxpYXMKICAgICAqLwogICAgcHVibGljIFN0\ncmluZyBnZXRUeXBlQWxpYXMoKSB7CiAgICAgICAgaWYgKF9hbGlhcyA9PSBu\ndWxsKQogICAgICAgICAgICBfYWxpYXMgPSBTdHJpbmdzLmdldENsYXNzTmFt\nZShfdHlwZSk7CiAgICAgICAgcmV0dXJuIF9hbGlhczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldHMgdGhlIGFsaWFzIGZvciB0aGUgZGVzY3JpYmVkIHR5\ncGUuIFRoZSBhbGlhcyBjYW4gYmUKICAgICAqIGFueSBhcmJpdHJhcnkgc3Ry\naW5nIHRoYXQgdGhlIGltcGxlbWVudGF0aW9uIGNhbiBsYXRlciB1c2UgdG8K\nICAgICAqIHJlZmVyIHRvIHRoZSBjbGFzcy4gTm90ZSB0aGF0IGF0IHJ1bnRp\nbWUsIG9ubHkgdGhlIGFsaWFzCiAgICAgKiBjb21wdXRlZCB3aGVuIHRoZSBw\nZXJzaXN0ZW50IHR5cGUgd2FzIGVuaGFuY2VkIGlzIHVzZWQuCiAgICAgKgog\nICAgICogQHBhcmFtIGFsaWFzIHRoZSBhbGlhcyBuYW1lIHRvIGFwcGx5IHRv\nIHRoZSBkZXNjcmliZWQgdHlwZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRUeXBlQWxpYXMoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgX2FsaWFzID0g\nYWxpYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYWNjZXNzIHR5cGUg\ndXNlZCBieSB0aGlzIGNsYXNzLiAKICAgICAqIAogICAgICovCiAgICBwdWJs\naWMgaW50IGdldEFjY2Vzc1R5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9hY2Nl\nc3NUeXBlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFNldHMgdGhlIGFj\nY2VzcyB0eXBlLiAKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QWNjZXNz\nVHlwZShpbnQgdHlwZSkgewogICAgCWlmICh0eXBlID09IF9hY2Nlc3NUeXBl\nIHx8IHR5cGUgPT0gQWNjZXNzQ29kZS5VTktOT1dOKQogICAgCQlyZXR1cm47\nCiAgICAJaWYgKCFBY2Nlc3NDb2RlLmlzVmFsaWRDbGFzc0NvZGUodHlwZSkp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbihfbG9jLmdldCgiYWNjZXNzLXR5cGUtaW52YWxpZCIsIAogICAgCQkg\nICAgdGhpcywgQWNjZXNzQ29kZS50b0NsYXNzU3RyaW5nKHR5cGUpKS5nZXRN\nZXNzYWdlKCkpOwogICAgCX0KICAgIAlpZiAoX2FjY2Vzc1R5cGUgIT0gQWNj\nZXNzQ29kZS5VTktOT1dOKSB7IC8vIGNoYW5naW5nIGFjY2VzcyB0eXBlCiAg\nICAJICAgIF9yZXBvcy5nZXRMb2coKS50cmFjZShfbG9jLmdldCgiYWNjZXNz\nLXR5cGUtY2hhbmdlIiwgCiAgICAJCSAgICB0aGlzLCBBY2Nlc3NDb2RlLnRv\nQ2xhc3NTdHJpbmcodHlwZSksIAogICAgCQkgICAgQWNjZXNzQ29kZS50b0Ns\nYXNzU3RyaW5nKF9hY2Nlc3NUeXBlKSkuZ2V0TWVzc2FnZSgpKTsKICAgIAl9\nCiAgICAgICAgX2FjY2Vzc1R5cGUgPSB0eXBlOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEFzc2VydHMgdGhlIHRoZSBnaXZlbiBmaWVsZCAod2hpY2gg\nbXVzdCBiZWxvbmcgdG8gdGhpcyByZWNlaXZlcikKICAgICAqIGNhbiBiZSBz\nZXQgdG8gdGhlIGdpdmVuIGFjY2VzcyBjb2RlLiBJZiB0aGUgZmllbGQgY29k\nZSBpcyBhbGxvd2VkLAogICAgICogaXQgbWF5IGhhdmUgdGhlIHNpZGUtZWZm\nZWN0IG9mIGNoYW5naW5nIHRoZSBhY2Nlc3MgY29kZSBvZiB0aGlzIHJlY2Vp\ndmVyLgogICAgICovCiAgICB2b2lkIG1lcmdlRmllbGRBY2Nlc3MoRmllbGRN\nZXRhRGF0YSBmbWQsIGludCBmQ29kZSkgewogICAgCXNldEFjY2Vzc1R5cGUo\nQWNjZXNzQ29kZS5tZXJnZUZpZWxkQ29kZSh0aGlzLCBmbWQsIGZDb2RlKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIGFjY2VzcyBzdHls\nZSBpcyBleHBsaWNpdGx5IGRlZmluZWQuCiAgICAgKi8gICAgCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0V4cGxpY2l0QWNjZXNzKCkgewogICAgICAgIHJldHVy\nbiBBY2Nlc3NDb2RlLmlzRXhwbGljaXQoX2FjY2Vzc1R5cGUpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWZmaXJtcyBpZiBhdHRyaWJ1dGVzIG9mIHRoaXMg\nY2xhc3MgdXNlIG1peGVkIGFjY2VzcyB0eXBlcy4KICAgICAqLyAgICAKICAg\nIHB1YmxpYyBib29sZWFuIGlzTWl4ZWRBY2Nlc3MoKSB7CiAgICAJcmV0dXJu\nIEFjY2Vzc0NvZGUuaXNNaXhlZChfYWNjZXNzVHlwZSk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSByZXF1aXJlcyBleHRl\nbnQgbWFuYWdlbWVudC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0\nUmVxdWlyZXNFeHRlbnQoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxs\nIHx8IGlzRW1iZWRkZWRPbmx5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgaWYgKF9leHRlbnQgPT0gbnVsbCkgewogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9leHRlbnQgPSAoc3VwLmdldFJlcXVpcmVzRXh0ZW50KCkpID8gQm9v\nbGVhbi5UUlVFCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0g\nQm9vbGVhbi5UUlVFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2V4dGVu\ndC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIHR5cGUgcmVxdWlyZXMgZXh0ZW50IG1hbmFnZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcXVpcmVzRXh0ZW50KGJvb2xlYW4g\ncmVxKSB7CiAgICAgICAgX2V4dGVudCA9IChyZXEpID8gQm9vbGVhbi5UUlVF\nIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBlbWJlZGRlZCBv\nYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkZWRP\nbmx5KCkgewogICAgICAgIGlmIChfZW1iZWRkZWQgPT0gbnVsbCkgewogICAg\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9lbWJlZGRlZCA9IChzdXAuaXNFbWJlZGRlZE9ubHkoKSkg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9lbWJl\nZGRlZCA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfZW1iZWRkZWQuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHRoZSB0eXBlIGNhbiBvbmx5IGJlIHVzZWQgYXMgYW4g\nZW1iZWRkZWQgb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRF\nbWJlZGRlZE9ubHkoYm9vbGVhbiBlbWJlZCkgewogICAgICAgIF9lbWJlZGRl\nZCA9IChlbWJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwog\nICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VtYmVkZGFibGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9lbWJlZGRhYmxlOwogICAgfQogICAgCiAgICBw\ndWJsaWMgdm9pZCBzZXRFbWJlZGRhYmxlKCkgewogICAgICAgIF9lbWJlZGRh\nYmxlID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhl\nIHR5cGUncyBmaWVsZHMgYXJlIGFjdGl2ZWx5IGludGVyY2VwdGVkLCBlaXRo\nZXIgYnkKICAgICAqIHJlZGVmaW5pdGlvbiBvciBlbmhhbmNlbWVudC4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNJbnRlcmNlcHRpbmcoKSB7CiAg\nICAgICAgcmV0dXJuIF9pbnRlcmNlcHRpbmc7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHRoZSB0eXBlJ3MgZmllbGRzIGFyZSBhY3RpdmVseSBp\nbnRlcmNlcHRlZCwgZWl0aGVyIGJ5CiAgICAgKiByZWRlZmluaXRpb24gb3Ig\nZW5oYW5jZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEludGVy\nY2VwdGluZyhib29sZWFuIGludGVyY2VwdGluZykgewogICAgICAgIF9pbnRl\ncmNlcHRpbmcgPSBpbnRlcmNlcHRpbmc7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFuYWdlZCBpbnRlcmZhY2UuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZEludGVyZmFjZSgp\nIHsKICAgICAgICBpZiAoIV90eXBlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX2ludGVyZmFjZSA9\nPSBudWxsID8gZmFsc2UgOiBfaW50ZXJmYWNlLmJvb2xlYW5WYWx1ZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSBpcyBhIG1h\nbmFnZWQgaW50ZXJmYWNlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1h\nbmFnZWRJbnRlcmZhY2UoYm9vbGVhbiBtYW5hZ2VkSW50ZXJmYWNlKSB7CiAg\nICAgICAgaWYgKCFfdHlwZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1pbnRl\ncmZhY2UiLCBfdHlwZSkpOwogICAgICAgIF9pbnRlcmZhY2UgPSBtYW5hZ2Vk\nSW50ZXJmYWNlID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKCiAg\nICAgICAgLy8gbWFuYWdlZCBpbnRlcmZhY2VzIGFsd2F5cyBkbyBwcm9wZXIg\naW50ZXJjZXB0aW9uOyBPcGVuSlBBIGdlbmVyYXRlcwogICAgICAgIC8vIHRo\nZSBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAgaWYgKGlzTWFuYWdlZEludGVy\nZmFjZSgpKQogICAgICAgICAgICBzZXRJbnRlcmNlcHRpbmcodHJ1ZSk7Cgog\nICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlcyBhbHdheXMgdXNlIHByb3Bl\ncnR5IGFjY2Vzcy4KICAgICAgICBzZXRBY2Nlc3NUeXBlKEFjY2Vzc0NvZGUu\nUFJPUEVSVFkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBt\nYW5hZ2VkIGludGVyZmFjZSBpbXBsZW1lbnRvciBpZiBhbnkuCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzczw/PiBnZXRJbnRlcmZhY2VJbXBsKCkgewogICAg\nICAgIHJldHVybiBfaW1wbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgbWFuYWdlZCBpbnRlcmZhY2UgaW1wbGVtZW50b3IgY2xhc3MuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEludGVyZmFjZUltcGwoQ2xhc3M8Pz4g\naW1wbCkgewogICAgICAgIF9pbXBsID0gaW1wbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhbGwgZXhwbGljaXRseSBkZWNsYXJlZCBpbnRlcmZh\nY2VzIHRoaXMgY2xhc3MgaW1wbGVtZW50cy4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzPD8+W10gZ2V0RGVjbGFyZWRJbnRlcmZhY2VzKCkgewogICAgICAg\nIGlmIChfaW50ZXJmYWNlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nTWV0YURhdGFSZXBvc2l0b3J5LkVNUFRZX0NMQVNTRVM7CiAgICAgICAgcmV0\ndXJuIChDbGFzc1tdKSBfaW50ZXJmYWNlcy50b0FycmF5KG5ldyBDbGFzc1tf\naW50ZXJmYWNlcy5zaXplKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4\ncGxpY2l0bHkgZGVjbGFyZSB0aGUgZ2l2ZW4gaW50ZXJmYWNlIGFtb25nIHRo\nZSBvbmVzIHRoaXMKICAgICAqIGNsYXNzIGltcGxlbWVudHMuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGFkZERlY2xhcmVkSW50ZXJmYWNlKENsYXNzPD8+\nIGlmYWNlKSB7CiAgICAgICAgaWYgKGlmYWNlID09IG51bGwgfHwgIWlmYWNl\nLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiZGVjbGFyZS1ub24taW50ZXJmYWNlIiwK\nICAgICAgICAgICAgICAgIHRoaXMsIGlmYWNlKSk7CiAgICAgICAgaWYgKF9p\nbnRlcmZhY2VzID09IG51bGwpCiAgICAgICAgICAgIF9pbnRlcmZhY2VzID0g\nbmV3IEFycmF5TGlzdDxDbGFzczw/Pj4oKTsKICAgICAgICBfaW50ZXJmYWNl\ncy5hZGQoaWZhY2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRo\nZSBnaXZlbiBpbnRlcmZhY2UgZnJvbSB0aGUgZGVjbGFyZWQgbGlzdC4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRJbnRlcmZh\nY2UoQ2xhc3M8Pz4gaWZhY2UpIHsKICAgICAgICBpZiAoX2ludGVyZmFjZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJl\ndHVybiBfaW50ZXJmYWNlcy5yZW1vdmUoaWZhY2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWxpYXMgcHJvcGVydGllcyBmcm9tIHRoZSBnaXZlbiBpbnRl\ncmZhY2UgZHVyaW5nICBxdWVyaWVzIHRvCiAgICAgKiB0aGUgbG9jYWwgZmll\nbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEludGVyZmFjZVByb3Bl\ncnR5QWxpYXMoQ2xhc3M8Pz4gaWZhY2UsIFN0cmluZyBvcmlnLCAKICAgICAg\nICBTdHJpbmcgbG9jYWwpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pZmFj\nZU1hcCkgewogICAgICAgICAgICBNYXA8U3RyaW5nLFN0cmluZz4gZmllbGRz\nID0gX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVs\nZHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEhh\nc2hNYXA8U3RyaW5nLFN0cmluZz4oKTsKICAgICAgICAgICAgICAgIF9pZmFj\nZU1hcC5wdXQoaWZhY2UsIGZpZWxkcyk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKGZpZWxkcy5jb250YWluc0tleShvcmlnKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nZHVwbGljYXRlLWlmYWNlLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAg\ndGhpcywgb3JpZywgbG9jYWwpKTsKICAgICAgICAgICAgZmllbGRzLnB1dChv\ncmlnLCBsb2NhbCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAg\nICAqIEdldCBsb2NhbCBmaWVsZCBhbGlhcyBmb3IgdGhlIGdpdmVuIGludGVy\nZmFjZSBwcm9wZXJ0eS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJ\nbnRlcmZhY2VQcm9wZXJ0eUFsaWFzKENsYXNzPD8+IGlmYWNlLCBTdHJpbmcg\nb3JpZykgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAg\nICAgICAgICAgIE1hcDxTdHJpbmcsU3RyaW5nPiBmaWVsZHMgPSBfaWZhY2VN\nYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiBmaWVsZHMuZ2V0KG9yaWcpOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGFsaWFzZXMgcHJvcGVydHkgbmFt\nZWQgZm9yIHRoZSBnaXZlbiBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXRJbnRlcmZhY2VBbGlhc2VkUHJvcGVydGllcyhDbGFz\nczw/PiBpZmFjZSkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFw\nKSB7CiAgICAgICAgICAgIE1hcDxTdHJpbmcsU3RyaW5nPiBmaWVsZHMgPSBf\naWZhY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NUUklOR19B\nUlJBWTsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5rZXlTZXQoKS50b0Fy\ncmF5KG5ldyBTdHJpbmdbZmllbGRzLnNpemUoKV0pOwogICAgICAgIH0KICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBm\naWVsZHMgdGhhdCB1c2UgaW1wbCBvciBpbnRlcm1lZGlhdGUgZGF0YSwgaW4K\nICAgICAqIG9yZGVyIHRvIGNyZWF0ZSBhIGNvbXBhY3RlZCBhcnJheSBmb3Ig\nc3RvcmFnZSBvZiBzYWlkIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgoKSB7CiAgICAgICAgaW50W10gdGFi\nbGUgPSBnZXRFeHRyYUZpZWxkRGF0YVRhYmxlKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IHRhYmxlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKQogICAgICAg\nICAgICBpZiAodGFibGVbaV0gIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdGFibGVbaV0gKyAxOwogICAgICAgIHJldHVybiAwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBpbnRlcm1lZGlhdGUgZmllbGQgZGF0\nYSBpbmRleCBvZiB0aGUgZ2l2ZW4gZmllbGQKICAgICAqIGluIHRoZSBjb21w\nYWN0ZWQgYXJyYXksIG9yIC0xIGlmIHRoZSBmaWVsZCBkb2VzIG5vdCB1c2Ug\nZXh0cmEgZGF0YS4KICAgICAqCiAgICAgKiBAc2VlICNnZXRFeHRyYUZpZWxk\nRGF0YUxlbmd0aAogICAgICovCiAgICBwdWJsaWMgaW50IGdldEV4dHJhRmll\nbGREYXRhSW5kZXgoaW50IGZpZWxkKSB7CiAgICAgICAgaW50W10gYXJyYXkg\nPSBnZXRFeHRyYUZpZWxkRGF0YVRhYmxlKCk7CiAgICAgICAgaWYgKGZpZWxk\nIDwgMCB8fCBmaWVsZCA+PSBhcnJheS5sZW5ndGgpCiAgICAgICAgICAgIHJl\ndHVybiAtMTsKICAgICAgICByZXR1cm4gYXJyYXlbZmllbGRdOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlcyBhIHRhYmxlIG1hcHBpbmcgZWFjaCBm\naWVsZCBpbmRleCB0byBpdHMgZXh0cmEgZGF0YSBpbmRleC4KICAgICAqLwog\nICAgcHJpdmF0ZSBpbnRbXSBnZXRFeHRyYUZpZWxkRGF0YVRhYmxlKCkgewog\nICAgICAgIGlmIChfZmllbGREYXRhVGFibGUgPT0gbnVsbCkgewogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldEZpZWxkcygpOwogICAg\nICAgICAgICBpbnRbXSB0YWJsZSA9IG5ldyBpbnRbZm1kcy5sZW5ndGhdOwog\nICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZm1kc1tpXS51c2VzSW50ZXJtZWRpYXRlKCkKICAgICAgICAgICAg\nICAgICAgICB8fCBmbWRzW2ldLnVzZXNJbXBsRGF0YSgpICE9IEJvb2xlYW4u\nRkFMU0UpCiAgICAgICAgICAgICAgICAgICAgdGFibGVbaV0gPSBpZHgrKzsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0YWJs\nZVtpXSA9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZERh\ndGFUYWJsZSA9IHRhYmxlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Zp\nZWxkRGF0YVRhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgdGhlIGdpdmVuIG5hbWUgcmVwcmVzZW50cyBhIG1hbmFnZWQgb3Ig\nc3RhdGljIGZpZWxkIG9mCiAgICAgKiB0aGlzIGNsYXNzLCBpbmNsdWRpbmcg\nc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzQWNjZXNzaWJsZUZpZWxkKFN0cmluZyBmaWVsZCkgewogICAgICAgIGlm\nIChnZXREZWNsYXJlZEZpZWxkKGZpZWxkKSAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoX3N0YXRpY0ZpZWxkcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gKEZpZWxkW10p\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRGaWVsZHNBY3Rpb24oX3R5\ncGUpKTsgCiAgICAgICAgICAgIFNldDxTdHJpbmc+IG5hbWVzID0gbmV3IEhh\nc2hTZXQ8U3RyaW5nPigpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChN\nb2RpZmllci5pc1N0YXRpYyhmaWVsZHNbaV0uZ2V0TW9kaWZpZXJzKCkpKQog\nICAgICAgICAgICAgICAgICAgIG5hbWVzLmFkZChmaWVsZHNbaV0uZ2V0TmFt\nZSgpKTsKICAgICAgICAgICAgX3N0YXRpY0ZpZWxkcyA9IG5hbWVzOwogICAg\nICAgIH0KICAgICAgICBpZiAoX3N0YXRpY0ZpZWxkcy5jb250YWlucyhmaWVs\nZCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChfc3Vw\nZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuaXNBY2Nlc3NpYmxlRmllbGQoZmllbGQpOwogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nbGwgZmllbGRzIHRoYXQgYXJlIHR5cGVzIHRoYXQgbmVlZCB0byBiZSB3cmFw\ncGVyZWQgYnkgYSBwcm94eS4KICAgICAqIFRoZSB0eXBlcyB0aGF0IG5lZWQg\ndG8gYmUgcHJveGllZCBhcmU6CiAgICAgKiA8cD4KICAgICAqICA8bGk+b3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzLkNBTEVOREFSCiAgICAg\nKiAgPGxpPm9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlcy5DT0xM\nRUNUSU9OCiAgICAgKiAgPGxpPm9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkph\ndmFUeXBlcy5EQVRFCiAgICAgKiAgPGxpPm9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlcy5NQVAKICAgICAqICA8bGk+b3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzLk9CSkVDVAogICAgICovCiAgICBwdWJsaWMg\nRmllbGRNZXRhRGF0YVtdIGdldFByb3h5RmllbGRzKCkgewogICAgICAgIGlm\nIChfYWxsUHJveHlGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBN\nYWtlIHN1cmUgX2FsbEZpZWxkcyBoYXMgYmVlbiBpbml0aWFsaXplZAogICAg\nICAgICAgICBpZiAoX2FsbEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBM\naXN0PEZpZWxkTWV0YURhdGE+IHJlcyA9IG5ldyBBcnJheUxpc3Q8RmllbGRN\nZXRhRGF0YT4oKTsKICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZt\nZCA6IF9hbGxGaWVsZHMpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgICAgICAgICByZXMu\nYWRkKGZtZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9hbGxQ\ncm94eUZpZWxkcyA9IHJlcy50b0FycmF5KG5ldyBGaWVsZE1ldGFEYXRhW3Jl\ncy5zaXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hbGxQcm94\neUZpZWxkczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxs\nIGxhcmdlIHJlc3VsdCBzZXQgZmllbGRzLiBXaWxsIG5ldmVyIHJldHVybiBu\ndWxsLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldExy\nc0ZpZWxkcygpIHsKICAgICAgICBpZiAoX2FsbExyc0ZpZWxkcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBfYWxsRmllbGRzIGhhcyBi\nZWVuIGluaXRpYWxpemVkCiAgICAgICAgICAgIGlmIChfYWxsRmllbGRzID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGdldEZpZWxkcygpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIExpc3Q8RmllbGRNZXRhRGF0YT4gcmVzID0g\nbmV3IEFycmF5TGlzdDxGaWVsZE1ldGFEYXRhPigpOwogICAgICAgICAgICBm\nb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogX2FsbEZpZWxkcykgewogICAgICAg\nICAgICAgICAgaWYoZm1kLmlzTFJTKCk9PXRydWUpewogICAgICAgICAgICAg\nICAgICAgIHJlcy5hZGQoZm1kKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBfYWxsTHJzRmllbGRzID0gcmVzLnRvQXJy\nYXkobmV3IEZpZWxkTWV0YURhdGFbcmVzLnNpemUoKV0pOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2FsbExyc0ZpZWxkczsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYWxsIGZpZWxkIG1ldGFkYXRhLCBpbmNsdWRp\nbmcgc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZE1ldGFEYXRhW10gZ2V0RmllbGRzKCkgewogICAgICAgIGlmIChfYWxsRmll\nbGRzID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciA9PSBudWxs\nKQogICAgICAgICAgICAgICAgX2FsbEZpZWxkcyA9IGdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gc3VwRmllbGRzID0gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRGaWVsZHMoKTsKCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nYWxsRmllbGRzID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAg\nICAgICAgICAgICAgICAgIChmaWVsZHMubGVuZ3RoICsgc3VwRmllbGRzLmxl\nbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KHN1cEZp\nZWxkcywgMCwgYWxsRmllbGRzLCAwLCBzdXBGaWVsZHMubGVuZ3RoKTsKICAg\nICAgICAgICAgICAgIHJlcGxhY2VEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcyhh\nbGxGaWVsZHMsIHN1cEZpZWxkcy5sZW5ndGgpOwoKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICAgICAgZmllbGRzW2ldLnNldEluZGV4KHN1cEZpZWxk\ncy5sZW5ndGggKyBpKTsKICAgICAgICAgICAgICAgICAgICBhbGxGaWVsZHNb\nc3VwRmllbGRzLmxlbmd0aCArIGldID0gZmllbGRzW2ldOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgX2FsbEZpZWxkcyA9IGFsbEZpZWxk\nczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Fs\nbEZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2Ugc3VwZXJj\nbGFzcyBmaWVsZHMgdGhhdCB3ZSBkZWZpbmUgd2l0aCBvdXIgdmVyc2lvbi4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VEZWZpbmVkU3VwZXJj\nbGFzc0ZpZWxkcyhGaWVsZE1ldGFEYXRhW10gZmllbGRzLAogICAgICAgIGlu\ndCBsZW4pIHsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwgfHwg\nIV9kZWZTdXBGaWVsZHMpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gZG9uJ3QgYXNzdW1lIGZpZWxkcyBhcmUgaW4gb3JkZXI7IHRoaXMgbWV0\naG9kIGlzIHVzZWQgZm9yCiAgICAgICAgLy8gbGlzdGluZyBvcmRlciBhcyB3\nZWxsCiAgICAgICAgRmllbGRNZXRhRGF0YSBzdXBGaWVsZDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHN1\ncEZpZWxkID0gKEZpZWxkTWV0YURhdGEpIF9zdXBGaWVsZE1hcC5nZXQoZmll\nbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmIChzdXBGaWVsZCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaWVsZHNbaV0gPSBzdXBGaWVs\nZDsKICAgICAgICAgICAgICAgIHN1cEZpZWxkLnNldEluZGV4KGkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBzdXBlcmNsYXNzIGNvcHkgb2YgdGhlIGdpdmVuIGZpZWxkLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRhRGF0YSBnZXRTdXBlcmNs\nYXNzRmllbGQoRmllbGRNZXRhRGF0YSBzdXBGaWVsZCkgewogICAgICAgIENs\nYXNzTWV0YURhdGEgc20gPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gc20gPT0gbnVsbCA/IG51bGwg\nOiBzbS5nZXRGaWVsZChzdXBGaWVsZC5nZXROYW1lKCkpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCAKICAgICAgICB8fCBmbWQuZ2V0TWFuYWdlbWVudCgp\nICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5t\nYW5hZ2VkLXN1cC1maWVsZCIsCiAgICAgICAgICAgICAgICBzdXBGaWVsZCwg\ndGhpcykpOwogICAgICAgIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gb25seSB0aGUgZmllbGRzIGZvciB0aGlzIGNsYXNzLCB3\naXRob3V0IHN1cGVyY2xhc3MgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMg\nRmllbGRNZXRhRGF0YVtdIGdldERlY2xhcmVkRmllbGRzKCkgewogICAgICAg\nIGlmIChfZmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgTGlzdDxGaWVs\nZE1ldGFEYXRhPiBmaWVsZHMgPSAKICAgICAgICAgICAgCW5ldyBBcnJheUxp\nc3Q8RmllbGRNZXRhRGF0YT4oX2ZpZWxkTWFwLnNpemUoKSk7CiAgICAgICAg\nICAgIDsKICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IF9m\naWVsZE1hcC52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgaWYgKGZtZC5n\nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSkg\newogICAgICAgICAgICAgICAgICAgIGZtZC5zZXREZWNsYXJlZEluZGV4KGZp\nZWxkcy5zaXplKCkpOwogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRJbmRl\neChmbWQuZ2V0RGVjbGFyZWRJbmRleCgpKTsKICAgICAgICAgICAgICAgICAg\nICBmaWVsZHMuYWRkKGZtZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgX2ZpZWxkcyA9IGZpZWxkcy50b0FycmF5CiAg\nICAgICAgICAgIAkoX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheShmaWVs\nZHMuc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZmllbGRz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHByaW1hcnkga2V5IGZp\nZWxkcywgb3IgZW1wdHkgYXJyYXkgaWYgbm9uZS4gVGhlIG9yZGVyCiAgICAg\nKiBpbiB3aGljaCB0aGUga2V5cyBhcmUgcmV0dXJuZWQgd2lsbCBiZSB0aGUg\nb3JkZXIgaW4gd2hpY2gKICAgICAqIHRoZSBmaWVsZHMgYXJlIGRlY2xhcmVk\nLCBzdGFydGluZyBhdCB0aGUgbGVhc3QtZGVyaXZlZCBzdXBlcmNsYXNzCiAg\nICAgKiBhbmQgZW5kaW5nIHdpdGggdGhlIHByaW1hcnkga2V5IGZpZWxkcyBv\nZiB0aGUgbW9zdC1kZXJpdmVkIHN1YmNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YVtdIGdldFByaW1hcnlLZXlGaWVsZHMoKSB7CiAg\nICAgICAgLy8gY2hlY2sgZm9yIHByaW1hcnkga2V5IGZpZWxkcyBldmVuIGlm\nIG5vdCBzZXQgdG8gSURfQVBQTElDQVRJT04gc28gCiAgICAgICAgLy8gdGhh\ndCBBcHBsaWNhdGlvbiBJZCB0b29sIHNlZXMgdGhlbSBldmVuIHdoZW4gdXNl\nciBkb2Vzbid0IGRlY2xhcmUgCiAgICAJLy8gQXBwbGljYXRpb24gaWRlbnRp\ndHkKICAgICAgICBpZiAoX2FsbFBLRmllbGRzID09IG51bGwpIHsKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwog\nICAgICAgICAgICBpbnQgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAg\nICAgICAgIG51bSsrOwoKICAgICAgICAgICAgaWYgKG51bSA9PSAwKQogICAg\nICAgICAgICAgICAgX2FsbFBLRmllbGRzID0gX3JlcG9zLkVNUFRZX0ZJRUxE\nUzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gcGtzID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheShu\ndW0pOwogICAgICAgICAgICAgICAgbnVtID0gMDsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXko\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0uc2V0UHJp\nbWFyeUtleUluZGV4KG51bSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBr\nc1tudW1dID0gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBu\ndW0rKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfYWxsUEtGaWVsZHMgPSBwa3M7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hbGxQS0ZpZWxkczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbGlzdCBvZiBmaWVs\nZHMgaW4gdGhlIGRlZmF1bHQgZmV0Y2ggZ3JvdXAsCiAgICAgKiBpbmNsdWRp\nbmcgc3VwZXJjbGFzcyBmaWVsZHMsIG9yIGFuIGVtcHR5IGFycmF5IGlmIG5v\nbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVm\nYXVsdEZldGNoR3JvdXBGaWVsZHMoKSB7CiAgICAgICAgaWYgKF9hbGxERkdG\naWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZmllbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludCBudW0gPSAw\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNJbkRl\nZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgICAgICAgICAgbnVtKys7\nCgogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZGZncyA9IF9yZXBvcy5u\nZXdGaWVsZE1ldGFEYXRhQXJyYXkobnVtKTsKICAgICAgICAgICAgbnVtID0g\nMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzSW5E\nZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICAgICAgICAgIGRmZ3Nb\nbnVtKytdID0gZmllbGRzW2ldOwogICAgICAgICAgICBfYWxsREZHRmllbGRz\nID0gZGZnczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hbGxERkdGaWVs\nZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNpb24g\nZmllbGQgZm9yIHRoaXMgY2xhc3MsIGlmIGFueS4KICAgICAqLwogICAgcHVi\nbGljIEZpZWxkTWV0YURhdGEgZ2V0VmVyc2lvbkZpZWxkKCkgewogICAgICAg\nIGlmIChfYWxsRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgZ2V0Rmll\nbGRzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChfdmVyc2lvbklkeCA9PSBJ\nbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAgICBpbnQgaWR4ID0gLTE7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2FsbEZpZWxkcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9hbGxGaWVsZHNb\naV0uaXNWZXJzaW9uKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaWR4\nICE9IC0xKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm11bHQtdmVycy1maWVsZHMiLCB0\naGlzLCBfYWxsRmllbGRzW2lkeF0sIF9hbGxGaWVsZHNbaV0pKTsKICAgICAg\nICAgICAgICAgICAgICBpZHggPSBpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIF92ZXJzaW9uSWR4ID0gaWR4OwogICAg\nICAgIH0KICAgICAgICBpZiAoX3ZlcnNpb25JZHggPT0gLTEpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICByZXR1cm4gX2FsbEZpZWxkc1tf\ndmVyc2lvbklkeF07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFs\nIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBhYnNvbHV0ZSBpbmRleC4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBv\nciBudWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YSBnZXRGaWVsZChpbnQgaW5kZXgpIHsKICAgICAgICBpZihfYWxs\nRmllbGRzID09IG51bGwpewogICAgICAgICAgICBnZXRGaWVsZHMoKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBfYWxs\nRmllbGRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIF9hbGxGaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQg\nb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4g\ncmVsYXRpdmUgaW5kZXguCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmll\nbGQncyBtZXRhZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwog\nICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVjbGFyZWRGaWVsZChpbnQg\naW5kZXgpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGlu\nZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3Rl\nbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2\nZW4gbmFtZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1l\ndGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YSBnZXRGaWVsZChTdHJpbmcgbmFtZSkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gZ2V0RGVjbGFyZWRGaWVsZChuYW1l\nKTsKICAgICAgICBpZiAoZm1kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmbWQ7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCAhPSBudWxsICYmIF9k\nZWZTdXBGaWVsZHMpIHsKICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0YURh\ndGEpIF9zdXBGaWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAgICAgIGlmIChm\nbWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmbWQ7CiAgICAg\nICAgfQogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGQobmFt\nZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0\ncmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBuYW1l\nLCB3aXRob3V0IGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxs\nIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYSBnZXREZWNsYXJlZEZpZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfZmllbGRNYXAu\nZ2V0KG5hbWUpOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsIHx8IGZpZWxk\nLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9OT05F\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZmll\nbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW55IGZpZWxkcyB0\naGF0IHdlcmUgYWRkZWQgYXMgbm9uLW1hbmFnZWQuCiAgICAgKiBBbGwgb3Ro\nZXIgbWV0aG9kcyB0byBnZXQgZmllbGRzIHJldHVybiBvbmx5IHRob3NlIHRo\nYXQgYXJlIG1hbmFnZWQuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFE\nYXRhW10gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKSB7CiAgICAgICAg\naWYgKF91bm1nZEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIExpc3Q8\nRmllbGRNZXRhRGF0YT4gdW5tYW5hZ2VkID0gbmV3IEFycmF5TGlzdDxGaWVs\nZE1ldGFEYXRhPigzKTsKICAgICAgICAgICAgOwogICAgICAgICAgICBmb3Ig\nKEZpZWxkTWV0YURhdGEgZmllbGQgOiBfZmllbGRNYXAudmFsdWVzKCkpIHsK\nICAgICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRNYW5hZ2VtZW50KCkgPT0g\nRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgICAgICAg\nICB1bm1hbmFnZWQuYWRkKGZpZWxkKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBfdW5tZ2RGaWVsZHMgPSB1bm1hbmFnZWQudG9BcnJheQogICAgICAg\nICAgICAgICAgKF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkodW5tYW5h\nZ2VkLnNpemUoKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3VubWdk\nRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IGZpZWxk\nIG1ldGFkYXRhIHRvIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1ldGFEYXRhIGFkZERlY2xhcmVkRmllbGQoU3RyaW5nIG5hbWUsIENs\nYXNzPD8+IHR5cGUpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9y\nZXBvcy5uZXdGaWVsZE1ldGFEYXRhKG5hbWUsIHR5cGUsIHRoaXMpOwogICAg\nICAgIGNsZWFyRmllbGRDYWNoZSgpOwogICAgICAgIF9maWVsZE1hcC5wdXQo\nbmFtZSwgZm1kKTsKCiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2Vt\nZW50LgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQg\nd2FzIHJlbW92ZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVEZWNsYXJlZEZpZWxkKEZpZWxkTWV0YURhdGEg\nZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfZmllbGRN\nYXAucmVtb3ZlKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAg\nICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZGVmaW5lZCBzdXBlcmNsYXNzIGZp\nZWxkIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbm9uZS4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZChTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfc3VwRmll\nbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIChGaWVsZE1ldGFEYXRhKSBfc3VwRmllbGRNYXAuZ2V0KG5h\nbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IGRlZmluZWQg\nc3VwZXJjbGFzcyBmaWVsZCBtZXRhZGF0YSB0byB0aGlzIGNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBhZGREZWZpbmVkU3VwZXJj\nbGFzc0ZpZWxkKFN0cmluZyBuYW1lLCBDbGFzczw/PiB0eXBlLAogICAgICAg\nIENsYXNzPD8+IHN1cCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGEobmFtZSwgdHlwZSwgdGhpcyk7CiAg\nICAgICAgZm1kLnNldERlY2xhcmluZ1R5cGUoc3VwKTsKICAgICAgICBjbGVh\nckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBfZGVmU3VwRmllbGRzID0gZmFs\nc2U7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsKQogICAgICAg\nICAgICBfc3VwRmllbGRNYXAgPSBuZXcgSGFzaE1hcDxTdHJpbmcsRmllbGRN\nZXRhRGF0YT4oKTsKICAgICAgICBfc3VwRmllbGRNYXAucHV0KG5hbWUsIGZt\nZCk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50LgogICAg\nICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2FzIHJlbW92\nZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZW1vdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEg\nZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfc3VwRmll\nbGRNYXAgIT0gbnVsbAogICAgICAgICAgICAmJiBfc3VwRmllbGRNYXAucmVt\nb3ZlKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBj\nbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgX2RlZlN1cEZpZWxk\ncyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nSW5jb3Jwb3JhdGUgc3VwZXJjbGFzcyBmaWVsZHMgcmVkZWZpbmVkIGluIHRo\naXMgc3ViY2xhc3MgaW50byB0aGlzCiAgICAgKiBtZXRhZGF0YS4gVGhpcyBt\nZXRob2QgaXMgZ2VuZXJhbGx5IGNhbGxlZCBhZnRlciBtZXRhZGF0YSBpcyBy\nZXNvbHZlZAogICAgICogYW5kIG1hcHBpbmcgaW5mb3JtYXRpb24gaXMgbG9h\nZGVkLCBidXQgYmVmb3JlIG1hcHBpbmcgcmVzb2x2ZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZm9yY2Ugd2hldGhlciB0byBmb3JjZSByZS1tYXBwaW5nIG9m\nIGV2ZW4gbWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGRlZmluZVN1cGVyY2xhc3NGaWVsZHMoYm9vbGVhbiBmb3Jj\nZSkgewogICAgICAgIGlmIChfZGVmU3VwRmllbGRzKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoaXNNYXBwZWQoKSAmJiBz\ndXAgIT0gbnVsbCkgewogICAgICAgICAgICAvLyByZWRlZmluZSBhbGwgdW5t\nYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIHN1cHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKChmb3JjZSB8fCAhc3Vwc1tpXS5nZXREZWZpbmluZ01l\ndGFEYXRhKCkuaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAmJiBn\nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZChzdXBzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgc3Vwc1tpXS5n\nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJj\nbGFzc0ZpZWxkcygpOwoKICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhhdCBh\nbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRzIGFyZSBjYWNo\nZWQuCiAgICAgICAgLy8gSSBkb24ndCBsaWtlIGRvaW5nIHRoaXMgdHdpY2Ug\nKGl0J3MgYWxzbyBkb25lIGluIHJlc29sdmVNZXRhKSwgYnV0CiAgICAgICAg\nLy8gd2UgaGF2ZSB0byByZS1jYWNoZSBpbiBjYXNlIHRoaXMgY2xhc3Mgb3Ig\nYW55IHN1cGVyY2xhc3MgcmVwbGFjZWQKICAgICAgICAvLyBzb21lIGZpZWxk\ncyB3aXRoIHJlZGVmaW5lZCB2ZXJzaW9ucywgYW5kIEkgZG9uJ3Qgd2FudCBv\ndXRzaWRlIGNvZGUKICAgICAgICAvLyB0byBoYXZlIHRvIGNhbGwgdGhpcyBt\nZXRob2QgYWZ0ZXIgcmVzb2x2ZSBqdXN0IHRvIGdldCBmaWVsZCBpbmRleGVz\nLAogICAgICAgIC8vIGV0YyBzZXQgY29ycmVjdGx5CiAgICAgICAgY2xlYXJB\nbGxGaWVsZENhY2hlKCk7CiAgICAgICAgY2FjaGVGaWVsZHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc29sdmUgc3VwZXJjbGFzcyBmaWVsZHMgd2Un\ndmUgcmVkZWZpbmVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2\nZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCkgewogICAgICAgIF9kZWZTdXBG\naWVsZHMgPSB0cnVlOwogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRh\nIHN1cDsKICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogX3N1cEZp\nZWxkTWFwLnZhbHVlcygpKSB7CiAgICAgICAgICAgIHN1cCA9IGdldFN1cGVy\nY2xhc3NGaWVsZChmbWQpOwoKICAgICAgICAgICAgLy8gSlBBIG1ldGFkYXRh\nIGRvZXNuJ3QgcXVhbGlmeSBzdXBlcmNsYXNzIGZpZWxkIG5hbWVzLCBzbyB3\nZQogICAgICAgICAgICAvLyBtaWdodCBub3Qga25vdyB0aGUgZGVjbGFyaW5n\nIHR5cGUgdW50aWwgbm93CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFy\naW5nVHlwZSgpID09IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICAgICAg\nZm1kLnNldERlY2xhcmluZ1R5cGUoc3VwLmdldERlY2xhcmluZ1R5cGUoKSk7\nCiAgICAgICAgICAgICAgICBmbWQuYmFja2luZ01lbWJlcihnZXRSZXBvc2l0\nb3J5KCkuZ2V0TWV0YURhdGFGYWN0b3J5KCkuCiAgICAgICAgICAgICAgICAg\nICAgZ2V0RGVmYXVsdHMoKS5nZXRCYWNraW5nTWVtYmVyKGZtZCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGZtZC5jb3B5KHN1cCk7CiAgICAgICAg\nICAgIGZtZC5yZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgdGhlIGZp\nZWxkcyBkZWZpbmVkIGJ5IHRoaXMgY2xhc3MuCiAgICAgKiBUaGlzIGluY2x1\nZGVzIG1hcHBlZCBkZWNsYXJlZCBmaWVsZHMgYW5kIGFueSBjb25jcmV0ZSBt\nYXBwaW5nIG9mCiAgICAgKiB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxkcyBw\nZXJmb3JtZWQgYnkgdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWV0YURhdGFbXSBnZXREZWZpbmVkRmllbGRzKCkgewogICAgICAgIGlm\nIChfZGVmaW5lZEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAg\nTGlzdDxGaWVsZE1ldGFEYXRhPiBkZWZpbmVkID0gCiAgICAgICAgICAgIAlu\nZXcgQXJyYXlMaXN0PEZpZWxkTWV0YURhdGE+KGZpZWxkcy5sZW5ndGgpOwog\nICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogZmllbGRzKSB7\nCiAgICAgICAgICAgICAgICBpZiAoZm1kLmlzTWFwcGVkKCkKICAgICAgICAg\nICAgICAgICAgICAmJiBmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09IHRo\naXMpCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZC5hZGQoZm1kKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IChGaWVs\nZE1ldGFEYXRhW10pIGRlZmluZWQudG9BcnJheQogICAgICAgICAgICAgICAg\nKF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkoZGVmaW5lZC5zaXplKCkp\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9kZWZpbmVkRmllbGRzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgZmllbGRzIGluIHRo\nZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhCiAgICAg\nKiBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNlZCBhZnRlciBsaXN0\nZWQgb25lcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBn\nZXRGaWVsZHNJbkxpc3RpbmdPcmRlcigpIHsKICAgICAgICBpZiAoX2FsbExp\nc3RpbmdGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBjb21iaW5l\nIGRlY2xhcmVkIGFuZCB1bm1hbmFnZWQgZmllbGRzIGludG8gbGlzdGluZyBv\ncmRlciBhcnJheQogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZGVjID0g\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIHVubWdkID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRlY0xpc3RpbmcgPSBfcmVwb3Mu\nbmV3RmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVjLmxl\nbmd0aCArIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkoZGVjLCAwLCBkZWNMaXN0aW5nLCAwLCBkZWMubGVuZ3RoKTsKICAg\nICAgICAgICAgU3lzdGVtLmFycmF5Y29weSh1bm1nZCwgMCwgZGVjTGlzdGlu\nZywgZGVjLmxlbmd0aCwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAgICAgQXJy\nYXlzLnNvcnQoZGVjTGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRvci5n\nZXRJbnN0YW5jZSgpKTsKCiAgICAgICAgICAgIGlmIChfc3VwZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9hbGxMaXN0aW5nRmllbGRzID0gZGVjTGlz\ndGluZzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBw\nbGFjZSBzdXBlcmNsYXNzIGZpZWxkcyBpbiBsaXN0aW5nIG9yZGVyIGJlZm9y\nZSBvdXIKICAgICAgICAgICAgICAgIC8vIGxpc3Rpbmctb3JkZXIgZGVjbGFy\nZWQgZmllbGRzCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gc3Vw\nID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAgICAgICAg\nICAgICBnZXRGaWVsZHNJbkxpc3RpbmdPcmRlcigpOwogICAgICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRN\nZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAgICAgKHN1cC5sZW5ndGgg\nKyBkZWNMaXN0aW5nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0u\nYXJyYXljb3B5KHN1cCwgMCwgbGlzdGluZywgMCwgc3VwLmxlbmd0aCk7CiAg\nICAgICAgICAgICAgICByZXBsYWNlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMo\nbGlzdGluZywgc3VwLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0u\nYXJyYXljb3B5KGRlY0xpc3RpbmcsIDAsIGxpc3RpbmcsIHN1cC5sZW5ndGgs\nCiAgICAgICAgICAgICAgICAgICAgZGVjTGlzdGluZy5sZW5ndGgpOwogICAg\nICAgICAgICAgICAgX2FsbExpc3RpbmdGaWVsZHMgPSBsaXN0aW5nOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsTGlzdGlu\nZ0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIGZp\nZWxkcyBkZWZpbmVkIGJ5IHRoaXMgY2xhc3MgaW4gdGhlIG9yZGVyIHRoZXkg\nYXJlIGxpc3RlZAogICAgICogaW4gdGhlIG1ldGFkYXRhIGZpbGUuIFVubGlz\ndGVkIGZpZWxkcyBhcmUgcGxhY2VkIGFmdGVyIGxpc3RlZCBvbmVzLgogICAg\nICogVGhpcyBhcnJheSBpbmNsdWRlcyBkZWNsYXJlZCB0cmFuc2FjdGlvbmFs\nIGFuZCB1bm1hbmFnZWQgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgRmll\nbGRNZXRhRGF0YVtdIGdldERlZmluZWRGaWVsZHNJbkxpc3RpbmdPcmRlcigp\nIHsKICAgICAgICBpZiAoX2xpc3RpbmdGaWVsZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIExpc3Q8RmllbGRNZXRhRGF0YT4gZGVmaW5lZCA9IAog\nICAgICAgICAgICAJbmV3IEFycmF5TGlzdDxGaWVsZE1ldGFEYXRhPihmaWVs\nZHMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZt\nZCA6IGZpZWxkcykKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVmaW5p\nbmdNZXRhRGF0YSgpID09IHRoaXMpCiAgICAgICAgICAgICAgICAgICAgZGVm\naW5lZC5hZGQoZm1kKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHVu\nbWdkID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRN\nZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVmaW5lZC5zaXplKCkg\nKyB1bm1nZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGRlZmluZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAgICBsaXN0\naW5nW2ldID0gKEZpZWxkTWV0YURhdGEpIGRlZmluZWQuZ2V0KGkpOwogICAg\nICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KHVubWdkLCAwLCBsaXN0aW5nLCBk\nZWZpbmVkLnNpemUoKSwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAgICAgQXJy\nYXlzLnNvcnQobGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRvci5nZXRJ\nbnN0YW5jZSgpKTsKICAgICAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBsaXN0\naW5nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2xpc3RpbmdGaWVsZHM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YSBj\nYWNoZSB0aGF0IHN0b3JlcyB0aGUgbWFuYWdlZCBpbnN0YW5jZSBvZiB0aGlz\nIGNsYXNzLCBieSBkZWZhdWx0LgogICAgICogVGhpcyBjYW4gYmUgb3Zlcndy\naXR0ZW4gYnkgcGVyLWluc3RhbmNlIGJhc2lzIHtAbGlua3BsYWluIENhY2hl\nRGlzdHJpYnV0aW9uUG9saWN5IGNhY2hlIGRpc3RyaWJ1dGlvbiBwb2xpY3l9\nLiAKICAgICAqIAogICAgICogQHJldHVybiBudWxsIGlmIHRoaXMgY2xhc3Mg\naXMgZGlzYWJsZWQgZnJvbSBjYWNoZSBieSBARGF0YUNhY2hlKGVuYWJsZWQ9\nZmFsc2UpLgogICAgICogICAgICAgICB7QGxpbmtwbGFpbiBEYXRhQ2FjaGUj\nTkFNRV9ERUZBVUxUIGRlZmF1bHR9IGlmIEBEYXRhQ2FjaGUoZW5hYmxlZD10\ncnVlKSB3aXRob3V0IGEgbmFtZS4KICAgICAqICAgICAgICAgT3RoZXJ3aXNl\nLCBkYXRhIGNhY2hlIG5hbWUgc2V0IGJ5IHRoZSB1c2VyIHZpYSBARGF0YUNh\nY2hlIG5hbWUgYXR0cmlidXRlLiAKICAgICAqIAogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldERhdGFDYWNoZU5hbWUoKSB7CiAgICAgICAgaWYgKERF\nRkFVTFRfU1RSSU5HLmVxdWFscyhfY2FjaGVOYW1lKSkgewogICAgICAgICAg\nICBpZiAoX3N1cGVyICE9IG51bGwgJiYgU3RyaW5nVXRpbHMuaXNOb3RFbXB0\neShnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldERhdGFDYWNoZU5hbWUo\nKSkpIHsKICAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBEYXRh\nQ2FjaGUuTkFNRV9ERUZBVUxUOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfY2FjaGVOYW1lOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFNldCB0aGUgY2FjaGUgbmFtZSBmb3IgdGhpcyBjbGFzcy4gCiAg\nICAgKiAKICAgICAqIEBwYXJhbSBjYW4gYmUgbnVsbCB0byBkaXNhYmxlIGNh\nY2hlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVOYW1l\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgX2NhY2hlTmFtZSA9IG5hbWU7CiAg\nICAgICAgaWYgKG5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgX2RhdGFDYWNo\nZUVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFm\nZmlybXMgdHJ1ZSBpZiB0aGlzIHJlY2VpdmVyIGlzIGFubm90YXRlZCB3aXRo\nIEBEYXRhQ2FjaGUgYW5kIGlzIG5vdCBkaXNhYmxlZC4gCiAgICAgKiBBIHNl\ncGFyYXRlIHN0YXRlIHZhcmlhYmxlIGlzIG5lY2Vzc2FyeSBiZXNpZGVzIHRo\nZSBuYW1lIG9mIHRoZSBjYWNoZSBkZWZhdWx0ZWQgdG8gYSBzcGVjaWFsIHN0\ncmluZy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0RGF0YUNhY2hl\nRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gX2RhdGFDYWNoZUVuYWJsZWQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2FjaGUgdGltZW91dCBmb3Ig\ndGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVvdXQuCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0RGF0YUNhY2hlVGltZW91dCgpIHsKICAgICAg\nICBpZiAoX2NhY2hlVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkgewog\nICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfY2FjaGVUaW1lb3V0ID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4K\nICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQg\nPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAg\nICAgIGdldERhdGFDYWNoZVRpbWVvdXQoKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9jYWNoZVRpbWVvdXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgY2FjaGUgdGltZW91dCBmb3IgdGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVz\nIG5vIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGFD\nYWNoZVRpbWVvdXQoaW50IHRpbWVvdXQpIHsKICAgICAgICBfY2FjaGVUaW1l\nb3V0ID0gdGltZW91dDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZGF0YSBjYWNoZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBpZiBpdCBp\ncyBub3QgY2FjaGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBEYXRhQ2FjaGUg\nZ2V0RGF0YUNhY2hlKCkgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RGF0\nYUNhY2hlTmFtZSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpIHsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1hbmFn\nZXJJbnN0YW5jZSgpLmdldERhdGFDYWNoZShuYW1lLCB0cnVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGFibGUo\nKSB7CiAgICAgICAgaWYgKF9kZXRhY2hhYmxlID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICAgICAgX2Rl\ndGFjaGFibGUgPSAoZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5pc0RldGFj\naGFibGUoKSkKICAgICAgICAgICAgICAgICAgICA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIF9kZXRhY2hhYmxlID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9kZXRhY2hhYmxlLmJvb2xlYW5WYWx1ZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbnN0YW5jZXMgYXJlIGRldGFj\naGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaGFibGUo\nYm9vbGVhbiBkZXRhY2hhYmxlKSB7CiAgICAgICAgX2RldGFjaGFibGUgPSAo\nZGV0YWNoYWJsZSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGRldGFjaCBz\ndGF0ZSBmaWVsZCwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldERldGFjaGVkU3RhdGUoKSB7CiAgICAgICAgaWYgKERF\nRkFVTFRfU1RSSU5HLmVxdWFscyhfZGV0YWNoU3RhdGUpKSB7CiAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5pc0Rl\ndGFjaGFibGUoKSA9PSBpc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAg\nIF9kZXRhY2hTdGF0ZSA9IHN1cC5nZXREZXRhY2hlZFN0YXRlKCk7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgQm9vbGVhbiB1c2UgPSB1\nc2VzRGV0YWNoZWRTdGF0ZShTWU5USEVUSUMsIHRydWUpOwogICAgICAgICAg\nICAgICAgX2RldGFjaFN0YXRlID0gKEJvb2xlYW4uRkFMU0UuZXF1YWxzKHVz\nZSkpID8gbnVsbCA6IFNZTlRIRVRJQzsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX2RldGFjaFN0YXRlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGRldGFjaCBzdGF0ZSBmaWVsZCwg\nb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRE\nZXRhY2hlZFN0YXRlKFN0cmluZyBmaWVsZCkgewogICAgICAgIF9kZXRhY2hT\ndGF0ZSA9IGZpZWxkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkIGdldERldGFjaGVkU3RhdGVGaWVsZCgpIHsK\nICAgICAgICAvLyBubyBjYWNoaW5nOyBvbmx5IHVzZWQgYXQgZW5oYW5jZW1l\nbnQKICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gZ2V0RGV0YWNoZWRTdGF0\nZSgpOwogICAgICAgIGlmIChmaWVsZE5hbWUgPT0gbnVsbCB8fCBTWU5USEVU\nSUMuZXF1YWxzKGZpZWxkTmFtZSkpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBGaWVsZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQoX3R5\ncGUsIGZpZWxkTmFtZSwgZmFsc2UpOwogICAgICAgIGlmIChmICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgX2xvYy5nZXQoIm5vLWRldGFjaC1zdGF0ZSIsIGZpZWxkTmFtZSwgX3R5\ncGUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgYW4gaW5zdGFu\nY2Ugb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hlZCBzdGF0ZS4KICAgICAqCiAg\nICAgKiBAcmV0dXJuIHRydWUgaWYgYSBkZXRhY2hlZCBpbnN0YW5jZSBtdXN0\nIGhhdmUgZGV0YWNoZWQgc3RhdGUsIGZhbHNlCiAgICAgKiBpZiBpdCBkb2Vz\nIG5vdCwgYW5kIG51bGwgaWYgaXQgbWF5IHVzZSBhCiAgICAgKiBtYW51YWxs\neS1jb25zdHJ1Y3RlZCBpbnN0YW5jZSB3aXRob3V0IGRldGFjaGVkIHN0YXRl\nCiAgICAgKi8KICAgIHB1YmxpYyBCb29sZWFuIHVzZXNEZXRhY2hlZFN0YXRl\nKCkgewogICAgICAgIC8vIG5vIG5lZWQgdG8gbGV0IGNvbmYgZGlzYWxsb3cg\nYmVjYXVzZSBpdCdzIHRha2VuIGludG8gYWNjb3VudCBpbgogICAgICAgIC8v\nIGdldERldGFjaGVkU3RhdGUoKSBjYWxsCiAgICAgICAgcmV0dXJuIHVzZXNE\nZXRhY2hlZFN0YXRlKGdldERldGFjaGVkU3RhdGUoKSwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciBhbiBpbnN0YW5jZSBvZiB0aGlz\nIHR5cGUgaGFzIGRldGFjaGVkIHN0YXRlLCBhc3N1bWluZyB0aGUgZ2l2ZW4K\nICAgICAqIGRldGFjaGVkIHN0YXRlIGZpZWxkLgogICAgICoKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiBhIGRldGFjaGVkIGluc3RhbmNlIG11c3QgaGF2ZSBk\nZXRhY2hlZCBzdGF0ZSwgZmFsc2UKICAgICAqIGlmIGl0IGRvZXMgbm90LCBh\nbmQgbnVsbCBpZiBpdCBtYXkgdXNlIGEKICAgICAqIG1hbnVhbGx5LWNvbnN0\ncnVjdGVkIGluc3RhbmNlIHdpdGhvdXQgZGV0YWNoZWQgc3RhdGUKICAgICAq\nLwogICAgcHJpdmF0ZSBCb29sZWFuIHVzZXNEZXRhY2hlZFN0YXRlKFN0cmlu\nZyBkZXRhY2hlZEZpZWxkLAogICAgICAgIGJvb2xlYW4gY29uZkRpc2FsbG93\ncykgewogICAgICAgIGlmICghaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAg\nIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBpZiB3ZSBkZWNs\nYXJlIGEgZGV0YWNoZWQgc3RhdGUgZmllbGQsIGhhdmUgdG8gdXNlIGl0CiAg\nICAgICAgaWYgKGRldGFjaGVkRmllbGQgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgaWYgKCFTWU5USEVUSUMu\nZXF1YWxzKGRldGFjaGVkRmllbGQpKQogICAgICAgICAgICByZXR1cm4gQm9v\nbGVhbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBjb25mIHRvIGRpc2FsbG93\nCiAgICAgICAgaWYgKGNvbmZEaXNhbGxvd3MgJiYgIV9yZXBvcy5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERldGFjaFN0YXRlSW5zdGFu\nY2UoKS5nZXREZXRhY2hlZFN0YXRlRmllbGQoKSkKICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAgIC8vIGhhdmUgdG8gdXNlIGRl\ndGFjaGVkIHN0YXRlIHRvIHN0b3JlIGRhdGFzdG9yZSBpZAogICAgICAgIGlm\nIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RPUkUpCiAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLlRSVUU7CgogICAgICAgIC8vIGFsbG93IGRl\ndGFjaGVkIHN0YXRlIHVzZSwgYnV0IGRvbid0IHJlcXVpcmUKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hl\nZCBmaWVsZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVh\nckFsbEZpZWxkQ2FjaGUoKSB7CiAgICAgICAgX2FsbEZpZWxkcyA9IG51bGw7\nCiAgICAgICAgX2FsbERGR0ZpZWxkcyA9IG51bGw7CiAgICAgICAgX2FsbFBL\nRmllbGRzID0gbnVsbDsKICAgICAgICBfYWxsUHJveHlGaWVsZHMgPSBudWxs\nOwogICAgICAgIF9hbGxMcnNGaWVsZHMgPSBudWxsOwogICAgICAgIF9kZWZp\nbmVkRmllbGRzID0gbnVsbDsKICAgICAgICBfbGlzdGluZ0ZpZWxkcyA9IG51\nbGw7CiAgICAgICAgX2FsbExpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgICAg\nIF9maWVsZERhdGFUYWJsZSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbGVhciBkZWZpbmVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGNsZWFyRGVmaW5lZEZpZWxkQ2FjaGUoKSB7CiAgICAgICAg\nX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgICAgIF9saXN0aW5nRmllbGRz\nID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlZCBm\naWVsZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckZp\nZWxkQ2FjaGUoKSB7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAg\nICAgICAgX2ZpZWxkcyA9IG51bGw7CiAgICAgICAgX3VubWdkRmllbGRzID0g\nbnVsbDsKICAgICAgICBfdmVyc2lvbklkeCA9IEludGVnZXIuTUlOX1ZBTFVF\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVkIHN1YmNsYXNz\nIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyU3ViY2xh\nc3NDYWNoZSgpIHsKICAgICAgICBfc3VicyA9IG51bGw7CiAgICAgICAgX3N1\nYk1ldGFzID0gbnVsbDsKICAgICAgICBfbWFwU3ViTWV0YXMgPSBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgaW1wbCBkYXRhIGFuZCBpbnRl\ncm1lZGlhdGUgZGF0YSB0YWJsZS4KICAgICAqLwogICAgdm9pZCBjbGVhckV4\ndHJhRmllbGREYXRhVGFibGUoKSB7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxl\nID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENhY2hlIGZpZWxkIGFy\ncmF5cy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRmllbGRzKCkg\newogICAgICAgIGdldEZpZWxkcygpOwogICAgICAgIGdldFByaW1hcnlLZXlG\naWVsZHMoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewog\nICAgICAgIHJldHVybiBfaGFzaENvZGU7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgIGlmIChvdGhl\nciA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBp\nZiAoIShvdGhlciBpbnN0YW5jZW9mIENsYXNzTWV0YURhdGEpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF90eXBlID09ICgo\nQ2xhc3NNZXRhRGF0YSkgb3RoZXIpLmdldERlc2NyaWJlZFR5cGUoKTsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IGNvbXBhcmVUbyhDbGFzc01ldGFEYXRhIG90\naGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAg\nIHJldHVybiAwOwogICAgICAgIHJldHVybiBfdHlwZS5nZXROYW1lKCkuY29t\ncGFyZVRvKCgoQ2xhc3NNZXRhRGF0YSkgb3RoZXIpLgogICAgICAgICAgICBn\nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiBnZXREZXNj\ncmliZWRUeXBlKCkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gUmVzb2x2ZSBhbmQgdmFsaWRhdGUKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogVGhl\nIHJlc29sdmUgbW9kZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHVibGljIGludCBnZXRSZXNvbHZlKCkgewogICAgICAgIHJldHVybiBfcmVz\nTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUg\nZm9yIHRoaXMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFJlc29sdmUoaW50IG1vZGUpIHsKICAgICAgICBfcmVzTW9kZSA9IG1vZGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0\naGlzIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNv\nbHZlKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUg\nPT0gTU9ERV9OT05FKQogICAgICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAg\nICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9yZXNNb2RlIHw9IG1v\nZGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfcmVzTW9kZSAmPSB+bW9k\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgYW5kIHZhbGlkYXRl\nIG1ldGFkYXRhLiBSZXR1cm4gdHJ1ZSBpZiBhbHJlYWR5IHJlc29sdmVkLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZXNvbHZlKGludCBtb2RlKSB7\nCiAgICAgICAgaWYgKChfcmVzTW9kZSAmIG1vZGUpID09IG1vZGUpCiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGludCBjdXIgPSBfcmVzTW9k\nZTsKICAgICAgICBfcmVzTW9kZSB8PSBtb2RlOwoKICAgICAgICBpbnQgdmFs\nID0gX3JlcG9zLmdldFZhbGlkYXRlKCk7CiAgICAgICAgYm9vbGVhbiBydW50\naW1lID0gKHZhbCAmIE1ldGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9SVU5U\nSU1FKSAhPSAwOwogICAgICAgIGJvb2xlYW4gdmFsaWRhdGUgPQogICAgICAg\nICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKGdldFJlcG9zaXRvcnko\nKS5nZXRDb25maWd1cmF0aW9uKCksIF90eXBlKQogICAgICAgICAgICB8fCAo\ndmFsICYgTWV0YURhdGFSZXBvc2l0b3J5LlZBTElEQVRFX1VORU5IQU5DRUQp\nID09IDA7CgogICAgICAgIC8vIHdlIG9ubHkgZG8gYW55IGFjdGlvbnMgZm9y\nIG1ldGFkYXRhIG1vZGUKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01FVEEp\nICE9IDAgJiYgKGN1ciAmIE1PREVfTUVUQSkgPT0gMCkgewogICAgICAgICAg\nICByZXNvbHZlTWV0YShydW50aW1lKTsKICAgICAgICAgICAgaWYgKHZhbGlk\nYXRlICYmICh2YWwgJiBNZXRhRGF0YVJlcG9zaXRvcnkuVkFMSURBVEVfTUVU\nQSkgIT0gMCkKICAgICAgICAgICAgICAgIHZhbGlkYXRlTWV0YShydW50aW1l\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NQVBQSU5H\nKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkcpID09IDApIHsKICAgICAg\nICAgICAgcmVzb2x2ZU1hcHBpbmcocnVudGltZSk7CiAgICAgICAgICAgIGlm\nICh2YWxpZGF0ZSAmJiAodmFsICYgTWV0YURhdGFSZXBvc2l0b3J5LlZBTElE\nQVRFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU1h\ncHBpbmcocnVudGltZSk7CiAgICAgICAgfQogICAgICAgIGlmICgobW9kZSAm\nIE1PREVfTUFQUElOR19JTklUKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJ\nTkdfSU5JVCkgPT0gMCkKICAgICAgICAgICAgaW5pdGlhbGl6ZU1hcHBpbmco\nKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXNvbHZlIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZXNvbHZlTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBib29s\nZWFuIGVtYmVkID0gX293bmVyICE9IG51bGwgJiYgX293bmVyLmdldERlY2xh\ncmVkVHlwZSgpID09IF90eXBlOwogICAgICAgIExvZyBsb2cgPSBfcmVwb3Mu\nZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoKGVtYmVkKSA/ICJyZXNv\nbHZlLWVtYmVkLW1ldGEiIDogInJlc29sdmUtbWV0YSIsCiAgICAgICAgICAg\nICAgICB0aGlzICsgIkAiICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhp\ncykpKTsKCiAgICAgICAgaWYgKHJ1bnRpbWUgJiYgIV90eXBlLmlzSW50ZXJm\nYWNlKCkgJiYKICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlw\nZShnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLF90eXBlKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtZW5oYW5jZWQiLCBfdHlwZSkpOwoKICAgICAgICAvLyBhcmUg\nd2UgdGhlIHRhcmdldCBvZiBhbiBlbWJlZGRlZCB2YWx1ZT8KICAgICAgICBp\nZiAoZW1iZWQpIHsKICAgICAgICAgICAgaWYgKHJlY3Vyc2l2ZUVtYmVkKF9v\nd25lcikpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgicmVjdXJzZS1lbWJlZCIsIF9vd25lcikpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjb3B5IGluZm8gZnJvbSB0\naGUgInJlYWwiIG1ldGFkYXRhIGZvciB0aGlzIHR5cGUKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gX3JlcG9zLmdldE1ldGFEYXRhKF90eXBl\nLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgbWV0YS5yZXNvbHZlKE1P\nREVfTUVUQSk7CiAgICAgICAgICAgIGNvcHkodGhpcywgbWV0YSk7CiAgICAg\nICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4uRkFMU0U7IC8vIGVtYmVkZGVk\nIGluc3RhbmNlIGlzbid0IGVtYmVkZGVkLW9ubHkKICAgICAgICB9CgogICAg\nICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29sdmVkCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICBz\ndXAucmVzb2x2ZShNT0RFX01FVEEpOwogICAgICAgICAgICBpZiAoZW1iZWQp\nIHsKICAgICAgICAgICAgICAgIC8vIGVtYmVkZGVkIGluc3RhbmNlIGFsd2F5\ncyByZWRlZmluZSBhbGwgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBzdXBzID0gc3VwLmdldEZpZWxkcygpOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9zdXBGaWVsZE1h\ncCA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICFfc3VwRmll\nbGRNYXAuY29udGFpbnNLZXkoc3Vwc1tpXS5nZXROYW1lKCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQo\nc3Vwc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzdXBzW2ldLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2ZSBmaWVsZHMgYW5k\nIHJlbW92ZSBpbnZhbGlkcwogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kOwog\nICAgICAgIGZvciAoSXRlcmF0b3I8RmllbGRNZXRhRGF0YT4gaXRyID0gX2Zp\nZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IAogICAgICAgIAlpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAvLyBvbmx5IHBhc3Mgb24gbWV0YWRh\ndGEgcmVzb2x2ZSBtb2RlIHNvIHRoYXQgbWV0YWRhdGEgaXMgYWx3YXlzCiAg\nICAgICAgICAgIC8vIHJlc29sdmVkIGJlZm9yZSBhbnkgb3RoZXIgcmVzb2x2\nZSBtb2RlcyBvdXIgc3ViY2xhc3NlcyBwYXNzIGFsb25nCiAgICAgICAgICAg\nIGZtZCA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGZtZC5yZXNvbHZlKE1P\nREVfTUVUQSk7CgogICAgICAgICAgICBpZiAoIWZtZC5pc0V4cGxpY2l0KCkK\nICAgICAgICAgICAgICAgICYmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5PQkpFQ1QKICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDX1VOVFlQRUQK\nICAgICAgICAgICAgICAgIHx8IChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5BUlJBWQogICAgICAgICAgICAgICAgJiYgZm1kLmdl\ndEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2RlKCkKICAgICAgICAgICAg\nICAgID09IEphdmFUeXBlcy5PQkpFQ1QpKSkgewogICAgICAgICAgICAgICAg\nX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5nZXQoInJtLWZpZWxkIiwgZm1k\nKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldExpc3RpbmdJbmRleCgp\nICE9IC0xKQogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRNYW5hZ2VtZW50\nKEZpZWxkTWV0YURhdGEuTUFOQUdFX05PTkUpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAg\nICAgICAgICAgIGNsZWFyRmllbGRDYWNoZSgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBlbWJlZGRlZCBpbnN0YW5jZXMgbXVzdCBl\nbWJlZCBhbGwgc3VwZXJjbGFzcyBmaWVsZHMgdG9vCiAgICAgICAgaWYgKGVt\nYmVkKSB7CiAgICAgICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAg\nICAgICAgICByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHRoaXMgZW5zdXJlcyB0aGF0IGFsbCBmaWVs\nZCBpbmRleGVzIGdldCBzZXQgd2hlbiBmaWVsZHMgYXJlIGNhY2hlZAogICAg\nICAgIGNhY2hlRmllbGRzKCk7CgogICAgICAgIC8vIHJlc29sdmUgbGlmZWN5\nY2xlIG1ldGFkYXRhIG5vdyB0byBwcmV2ZW50IGxhenkgdGhyZWFkaW5nIHBy\nb2JsZW1zCiAgICAgICAgX2xpZmVNZXRhLnJlc29sdmUoKTsKCiAgICAgICAg\nLy8gcmVjb3JkIGltcGxlbWVudHMgaW4gdGhlIHJlcG9zaXRvcnkKICAgICAg\nICBpZiAoX2ludGVyZmFjZXMgIT0gbnVsbCkgewogICAgICAgICAgICBmb3Ig\nKENsYXNzPD8+IGlmYWNlIDogX2ludGVyZmFjZXMpCiAgICAgICAgICAgICAg\nICBfcmVwb3MuYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsKHRoaXMsIGlmYWNl\nKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc29sdmUgZmV0Y2ggZ3JvdXBz\nCiAgICAgICAgaWYgKF9mZ01hcCAhPSBudWxsKQogICAgICAgICAgICBmb3Ig\nKEZldGNoR3JvdXAgZmcgOiBfZmdNYXAudmFsdWVzKCkpCiAgICAgICAgICAg\nICAgICBmZy5yZXNvbHZlKCk7CgogICAgICAgIGlmICghZW1iZWQgJiYgX3R5\ncGUuaXNJbnRlcmZhY2UoKSkgewogICAgICAgICAgICBpZiAoX2ludGVyZmFj\nZSAhPSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludGVyZmFjZSIsIF90eXBl\nKSk7CgogICAgICAgICAgICBpZiAocnVudGltZSkgewogICAgICAgICAgICAg\nICAgX2ltcGwgPSBfcmVwb3MuZ2V0SW1wbEdlbmVyYXRvcigpLmNyZWF0ZUlt\ncGwodGhpcyk7CiAgICAgICAgICAgICAgICBfcmVwb3Muc2V0SW50ZXJmYWNl\nSW1wbCh0aGlzLCBfaW1wbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIGlmIHRoaXMgaXMgcnVudGltZSwgY3JlYXRlIGEgcGMgaW5z\ndGFuY2UgYW5kIHNjYW4gaXQgZm9yIGNvbXBhcmF0b3JzCiAgICAgICAgaWYg\nKHJ1bnRpbWUgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3QoX3R5cGUuZ2V0TW9k\naWZpZXJzKCkpKSB7CiAgICAgICAgICAgIFByb3h5U2V0dXBTdGF0ZU1hbmFn\nZXIgc20gPSBuZXcgUHJveHlTZXR1cFN0YXRlTWFuYWdlcigpOwogICAgICAg\nICAgICBzbS5zZXRQcm94eURhdGEoUENSZWdpc3RyeS5uZXdJbnN0YW5jZShf\ndHlwZSwgc20sIGZhbHNlKSwgdGhpcyk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgYm9vbGVhbiByZWN1cnNpdmVFbWJlZChWYWx1ZU1ldGFEYXRh\nIG93bmVyKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbSA9IG93bmVyLmdl\ndEZpZWxkTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCk7IAogICAg\nICAgIGlmIChjbS5nZXREZXNjcmliZWRUeXBlKCkuaXNBc3NpZ25hYmxlRnJv\nbShfdHlwZSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIFZh\nbHVlTWV0YURhdGEgb3duZXIxID0gY20uZ2V0RW1iZWRkaW5nTWV0YURhdGEo\nKTsKICAgICAgICBpZiAob3duZXIxID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBlbHNlIAogICAgICAgICAgICByZXR1cm4g\ncmVjdXJzaXZlRW1iZWQob3duZXIxKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBWYWxpZGF0ZSByZXNvbHZlZCBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNZXRhKGJvb2xlYW4gcnVudGltZSkg\newogICAgICAgIHZhbGlkYXRlRGF0YUNhY2hlKCk7CiAgICAgICAgdmFsaWRh\ndGVEZXRhY2hhYmxlKCk7CiAgICAgICAgdmFsaWRhdGVFeHRlbnNpb25LZXlz\nKCk7CiAgICAgICAgdmFsaWRhdGVJZGVudGl0eSgpOwogICAgICAgIHZhbGlk\nYXRlQWNjZXNzVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2\nZSBtYXBwaW5nIGRhdGEuIExvZ3MgcmVzb2x2ZSBtZXNzYWdlIGFuZCByZXNv\nbHZlcyBzdXBlciBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCByZXNvbHZlTWFwcGluZyhib29sZWFuIHJ1bnRpbWUpIHsKICAgICAg\nICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJyZXNvbHZlLW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAg\nICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAg\nICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29sdmVkIGZpcnN0\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAg\nICAgc3VwLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFZhbGlkYXRlIG1hcHBpbmcgZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgdmFsaWRhdGVNYXBwaW5nKGJvb2xlYW4gcnVudGltZSkg\newogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBtYXBwaW5nLiBM\nb2dzIGluaXQgbWVzc2FnZSBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFwcGluZygpIHsKICAgICAgICBMb2cg\nbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJp\nbml0LW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAgICAgICArIFN5\nc3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBWYWxpZGF0ZSBkYXRhIGNhY2hlIHNldHRpbmdzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVEYXRhQ2FjaGUoKSB7CiAgICAg\nICAgaW50IHRpbWVvdXQgPSBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAg\nICAgaWYgKHRpbWVvdXQgPCAtMSB8fCB0aW1lb3V0ID09IDApCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2Fj\naGUtdGltZW91dC1pbnZhbGlkIiwKICAgICAgICAgICAgICAgIF90eXBlLCBT\ndHJpbmcudmFsdWVPZih0aW1lb3V0KSkpOwoKICAgICAgICBpZiAoX3N1cGVy\nID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAg\nICAgICBTdHJpbmcgY2FjaGUgPSBnZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAg\nICAgaWYgKGNhY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgU3RyaW5nIHN1cGVyQ2FjaGUgPSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAg\nICAKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoc3VwZXJDYWNo\nZSkpIHsgIAogICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhj\nYWNoZSwgc3VwZXJDYWNoZSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtbmFtZXMiLCBu\nZXcgT2JqZWN0W10geyBfdHlwZSwgY2FjaGUsIF9zdXBlciwgc3VwZXJDYWNo\nZSB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgaWRlbnRpdHkgaGFuZGxpbmcgZm9y\nIHRoaXMgY2xhc3MgaXMgdmFsaWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB2YWxpZGF0ZUlkZW50aXR5KCkgewogICAgICAgIC8vIG1ha2Ugc3VyZSBp\nZGVudGl0eSB0eXBlcyBhcmUgY29uc2lzdGVudAogICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICBpbnQgaWQgPSBnZXRJZGVudGl0eVR5cGUoKTsKICAgICAgICBpZiAoc3Vw\nICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IElEX1VOS05P\nV04KICAgICAgICAgICAgJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IGlk\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImlkLXR5cGVzIiwgX3R5cGUpKTsKCiAgICAgICAgLy8gY2hlY2sg\nZm9yIHRoaW5ncyB0aGUgZGF0YSBzdG9yZSBkb2Vzbid0IHN1cHBvcnQKICAg\nICAgICBDb2xsZWN0aW9uPFN0cmluZz4gb3B0cyA9IF9yZXBvcy5nZXRDb25m\naWd1cmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9ucygpOwogICAgICAgIGlmIChp\nZCA9PSBJRF9BUFBMSUNBVElPTgogICAgICAgICAgICAmJiAhb3B0cy5jb250\nYWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fSURfQVBQTElDQVRJ\nT04pKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgiYXBwaWQtbm90LXN1cHBvcnRlZCIsCiAgICAgICAg\nICAgICAgICBfdHlwZSkpOwogICAgICAgIH0KICAgICAgICBpZiAoaWQgPT0g\nSURfREFUQVNUT1JFCiAgICAgICAgICAgICYmICFvcHRzLmNvbnRhaW5zKE9w\nZW5KUEFDb25maWd1cmF0aW9uLk9QVElPTl9JRF9EQVRBU1RPUkUpKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9j\nLmdldAogICAgICAgICAgICAgICAgKCJkYXRhc3RvcmVpZC1ub3Qtc3VwcG9y\ndGVkIiwgX3R5cGUpKTsKICAgICAgICB9CgogICAgICAgIGlmIChpZCA9PSBJ\nRF9BUFBMSUNBVElPTikgewogICAgICAgICAgICBpZiAoX2lkU3RyYXRlZ3kg\nIT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImFwcGlkLXN0cmF0\nZWd5IiwgX3R5cGUpKTsKICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNz\nKCk7CiAgICAgICAgfSBlbHNlIGlmIChpZCAhPSBJRF9VTktOT1dOKQogICAg\nICAgICAgICB2YWxpZGF0ZU5vUEtGaWVsZHMoKTsKCiAgICAgICAgaW50IHN0\ncmF0ZWd5ID0gZ2V0SWRlbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGlmIChz\ndHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0UKICAgICAgICAg\nICAgJiYgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSA9PSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLXNlcS1uYW1lIiwgX3R5cGUpKTsKCiAgICAgICAgVmFsdWVTdHJhdGVn\naWVzLmFzc2VydFN1cHBvcnRlZChzdHJhdGVneSwgdGhpcywKICAgICAgICAg\nICAgImRhdGFzdG9yZSBpZGVudGl0eSBzdHJhdGVneSIpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBzdXJlIHRoZSBhcHBsaWNhdGlvbiBpZGVudGl0\neSBjbGFzcyBpcyB2YWxpZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZh\nbGlkYXRlQXBwSWRDbGFzcygpIHsKICAgICAgICAvLyBiYXNlIHR5cGVzIG11\nc3QgZGVjbGFyZSBhbiBvaWQgY2xhc3MgaWYgbm90IHNpbmdsZS1maWVsZCBp\nZGVudGl0eQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBnZXRQcmlt\nYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgaWYgKGdldE9iamVjdElkVHlwZSgp\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHBrcy5sZW5ndGggPT0gMSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgidW5zdXBwb3J0ZWQtaWQtdHlwZSIsCiAgICAgICAgICAgICAg\nICAgICAgX3R5cGUsIHBrc1swXS5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICAgICAgcGtzWzBdLmdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSkpOwog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWlkLWNsYXNzIiwgX3R5cGUsIAogICAgICAgICAgICAJCUFycmF5\ncy5hc0xpc3QodG9OYW1lcyhwa3MpKSkpOwogICAgICAgIH0KICAgICAgICBp\nZiAoX29iamVjdElkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgaWYgKGlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAg\naWYgKHBrc1swXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLk9JRCkgewogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9\nIHBrc1swXS5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAg\nICB2YWxpZGF0ZUFwcElkQ2xhc3NNZXRob2RzKGVtYmVkLmdldERlc2NyaWJl\nZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NQ\nS3MoZW1iZWQsIGVtYmVkLmdldEZpZWxkcygpLAogICAgICAgICAgICAgICAg\nICAgIGVtYmVkLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9z\ndXBlciAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNvbmNyZXRlIHN1cGVy\nY2xhc3Mgb2lkIG11c3QgbWF0Y2ggb3IgYmUgcGFyZW50IG9mIG91cnMKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpOwogICAgICAgICAgICBDbGFzczw/PiBvYmplY3RJZFR5cGUg\nPSBzdXAuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIGlmIChvYmpl\nY3RJZFR5cGUgIT0gbnVsbCAmJiAKICAgICAgICAgICAgICAgICFvYmplY3RJ\nZFR5cGUuaXNBc3NpZ25hYmxlRnJvbShfb2JqZWN0SWQpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nZC1jbGFzc2VzIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIF90eXBlLCBfb2JqZWN0SWQsIF9zdXBlciwKICAgICAgICAgICAgICAgICAg\nICAgICAgc3VwLmdldE9iamVjdElkVHlwZSgpIH0pKTsKCiAgICAgICAgICAg\nIC8vIHZhbGlkYXRlIHRoYXQgbm8gb3RoZXIgcGtzIGFyZSBkZWNsYXJlZCBp\nZiB3ZSBoYXZlIGEKICAgICAgICAgICAgLy8gY29uY3JldGUgUEMgc3VwZXJj\nbGFzcwogICAgICAgICAgICBpZiAoaGFzQ29uY3JldGVQQ1N1cGVyY2xhc3Mo\nKSkKICAgICAgICAgICAgICAgIHZhbGlkYXRlTm9QS0ZpZWxkcygpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBjbGFzcyBoYXMgaXRzIG93biBv\naWQgY2xhc3MsIGRvIHNvbWUgbW9yZSB2YWxpZGF0aW9uCiAgICAgICAgaWYg\nKF9zdXBlciA9PSBudWxsCiAgICAgICAgICAgIHx8IF9vYmplY3RJZCAhPSBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldE9iamVjdElkVHlwZSgpKSB7\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub24tYWJzdHJhY3Qgb2lkIGNs\nYXNzZXMgb3ZlcnJpZGUgdGhlIHByb3BlciBtZXRob2RzCiAgICAgICAgICAg\nIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChfb2JqZWN0SWQuZ2V0TW9kaWZp\nZXJzKCkpKQogICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNzTWV0\naG9kcyhfb2JqZWN0SWQpOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRo\nZSBhcHBsaWNhdGlvbiBpZCBjbGFzcyBoYXMgYWxsIHByaW1hcnkga2V5IGZp\nZWxkcwogICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NQS3ModGhpcywg\ncGtzLCBfb2JqZWN0SWQpOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhpcyBjbGFzcyB1c2VzIElkQ2xhc3MgZGVy\naXZlZCBmcm9tIGlkQ2xhc3Mgb2YgdGhlIAogICAgICogcGFyZW50IGVudGl0\neSB3aGljaCBhbm5vdGF0ZWQgYXMgaWQgaW4gdGhlIGNoaWxkIGNsYXNzLiAK\nICAgICAqIEluIHRoaXMgY2FzZSwgdGhlcmUgYXJlIG5vIGtleSBmaWVsZHMg\naW4gdGhlIGNoaWxkIGVudGl0eSBjb3JyZXNwb25kaW5nIAogICAgICogdG8g\ndGhlIGZpZWxkcyBpbiB0aGUgSWRDbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gdXNlSWRDbGFzc0Zyb21QYXJlbnQoKSB7CiAgICAgICAgaWYg\nKF91c2VJZENsYXNzRnJvbVBhcmVudCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChfb2JqZWN0SWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91c2VJ\nZENsYXNzRnJvbVBhcmVudCA9IGZhbHNlOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBnZXRQcmlt\nYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAgICAgICBpZiAocGtzLmxlbmd0\naCAhPSAxKSAKICAgICAgICAgICAgICAgICAgICBfdXNlSWRDbGFzc0Zyb21Q\nYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgcGtNZXRhID0gcGtzWzBdLmdl\ndFR5cGVNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa01l\ndGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX3VzZUlkQ2xh\nc3NGcm9tUGFyZW50ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzPD8+IHBrVHlwZSA9\nIHBrTWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHBrVHlwZSA9PSBPYmplY3RJZC5jbGFzcykgLy9wYXJlbnQg\naWQgaXMgRW1iZWRkZWRJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncGtUeXBlID0gcGtNZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXS5nZXRU\neXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwa1R5cGUgPT0g\nX29iamVjdElkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3VzZUlk\nQ2xhc3NGcm9tUGFyZW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWVsZCBm\nID0gUmVmbGVjdGlvbi5maW5kRmllbGQoX29iamVjdElkLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBwa3NbMF0uZ2V0TmFtZSgpLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiAhPSBudWxs\nKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdXNlSWRDbGFz\nc0Zyb21QYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImludmFsaWQtaWQiLCBf\ndHlwZSwgcGtzWzBdLmdldE5hbWUoKSkpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfdXNl\nSWRDbGFzc0Zyb21QYXJlbnQuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGNsYXNzIGhhcyBhIGNv\nbmNyZXRlIHBlcnNpc3RlbnQgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIGhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkgewogICAg\nICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChfc3VwZXIu\nZ2V0TW9kaWZpZXJzKCkpICYmIAogICAgICAgIAkJKCFnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpLmlzQWJzdHJhY3QoKSkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpLmhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFbnN1cmUgdGhhdCB0aGUgdXNlciBoYXMgb3ZlcnJpZGRlbiB0\naGUgZXF1YWxzIGFuZCBoYXNoQ29kZSBtZXRob2RzLAogICAgICogYW5kIGhh\ncyB0aGUgcHJvcGVyIGNvbnN0cnVjdG9ycy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHZhbGlkYXRlQXBwSWRDbGFzc01ldGhvZHMoQ2xhc3M8Pz4gb2lk\nKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lkLmdldENvbnN0cnVj\ndG9yKChDbGFzc1tdKSBudWxsKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm51bGwtY29ucyIsIG9pZCwgX3R5cGUpKS4KICAgICAg\nICAgICAgICAgIHNldENhdXNlKGUpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2hlY2sgZm9yIGVxdWFscyBhbmQgaGFzaGNvZGUgb3ZlcnJpZGVzOyBkb24n\ndCBlbmZvcmNlIGl0CiAgICAgICAgLy8gZm9yIGFic3RyYWN0IGFwcGxpY2F0\naW9uIGlkIGNsYXNzZXMsIHNpbmNlIHRoZXkgbWF5IG5vdCBuZWNlc3Nhcmls\neQogICAgICAgIC8vIGRlY2xhcmUgcHJpbWFyeSBrZXkgZmllbGRzCiAgICAg\nICAgTWV0aG9kIG1ldGhvZDsKICAgICAgICB0cnkgewogICAgICAgICAgICBt\nZXRob2QgPSBvaWQuZ2V0TWV0aG9kKCJlcXVhbHMiLCBuZXcgQ2xhc3NbXXsg\nT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUp\nLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBh\nYnMgPSBNb2RpZmllci5pc0Fic3RyYWN0KF90eXBlLmdldE1vZGlmaWVycygp\nKTsKICAgICAgICBpZiAoIWFicyAmJiBtZXRob2QuZ2V0RGVjbGFyaW5nQ2xh\nc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZXEtbWV0aG9kIiwgX3R5cGUp\nKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9kID0gb2lkLmdl\ndE1ldGhvZCgiaGFzaENvZGUiLCAoQ2xhc3NbXSkgbnVsbCk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAg\nfQogICAgICAgIGlmICghYWJzICYmIG1ldGhvZC5nZXREZWNsYXJpbmdDbGFz\ncygpID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJoYy1tZXRob2QiLCBfdHlwZSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgcHJp\nbWFyeSBrZXkgY2xhc3MgaGFzIGFsbCBwayBmaWVsZHMuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xhc3NQS3MoQ2xhc3NNZXRh\nRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzLCBDbGFz\nczw/PiBvaWQpIHsKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0gMCAmJiAh\nTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS4K\nICAgICAgICAgICAgZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXBrIiwgX3R5\ncGUpKTsKCiAgICAgICAgLy8gY2hlY2sgdGhhdCB0aGUgb2lkIHR5cGUgY29u\ndGFpbnMgYWxsIHBrIGZpZWxkcwogICAgICAgIEZpZWxkIGY7CiAgICAgICAg\nTWV0aG9kIG07CiAgICAgICAgQ2xhc3M8Pz4gYzsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAg\nICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0Q29t\ncG9uZW50VHlwZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChjID09IGJ5\ndGUuY2xhc3MgfHwgYyA9PSBCeXRlLmNsYXNzCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8IGMgPT0gY2hhci5jbGFzcyB8fCBjID09IENoYXJhY3Rlci5j\nbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOiAvLyB3\nZSdyZSB2YWxpZGF0aW5nIGVtYmVkZGVkIGZpZWxkcwogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLXBrLXR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICBmbWRzW2ld\nKSk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\nICAgIGMgPSBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChBY2Nlc3NDb2RlLmlzRmllbGQo\nZm1kc1tpXS5nZXRBY2Nlc3NUeXBlKCkpKSB7CiAgICAgICAgICAgICAgICBm\nID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkLCBmbWRzW2ldLmdldE5hbWUo\nKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKGYgPT0gbnVsbCB8fCAh\nZi5nZXRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShjKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImludmFsaWQtaWQiLAogICAgICAgICAgICAgICAgICAgICAgICBfdHlwZSwg\nZm1kc1tpXS5nZXROYW1lKCkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChB\nY2Nlc3NDb2RlLmlzUHJvcGVydHkoZm1kc1tpXS5nZXRBY2Nlc3NUeXBlKCkp\nKSB7CiAgICAgICAgICAgICAgICBtID0gUmVmbGVjdGlvbi5maW5kR2V0dGVy\nKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGlmIChtID09IG51bGwgfHwgIW0uZ2V0UmV0dXJuVHlwZSgpLmlzQXNz\naWduYWJsZUZyb20oYykpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFtZSgp\nKSk7CiAgICAgICAgICAgICAgICBtID0gUmVmbGVjdGlvbi5maW5kU2V0dGVy\nKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAg\nZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBpZiAobSA9PSBudWxsIHx8IG0uZ2V0UmV0dXJuVHlwZSgp\nICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFtZSgp\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBWYWxpZGF0ZSB0aGF0IHRoaXMgY2xhc3MgZG9lc24ndCBkZWNsYXJl\nIGFueSBwcmltYXJ5IGtleSBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB2YWxpZGF0ZU5vUEtGaWVsZHMoKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZpZWxkcyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1wayIsIGZpZWxkc1tpXSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nQXNzZXJ0IHRoYXQgdGhpcyBjbGFzcycgYWNjZXNzIHR5cGUgaXMgYWxsb3dl\nZC4KICAgICAqIElmIG5vIGFjY2VzcyBzdHlsZSBpcyBzZXQgb3IgYW4gZXhw\nbGljaXQgc3R5bGUgaXMgc2V0IHJldHVybi4KICAgICAqIE90aGVyd2lzZSwg\naWYgdGhlIHN1cGVyY2xhc3MgaGFzIHBlcnNpc3RlbnQgYXR0cmlidXRlcywg\nIGNoZWNrIHRoYXQgCiAgICAgKiB0aGUgc3VwZXJjbGFzcyBhY2Nlc3Mgc3R5\nbGUsIGlmIGRlZmF1bHRlZCwgaXMgdGhlIHNhbWUgYXMgdGhhdCBvZiB0aGlz\nIAogICAgICogcmVjZWl2ZXIuIAogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ndmFsaWRhdGVBY2Nlc3NUeXBlKCkgewogICAgICAgIGlmIChBY2Nlc3NDb2Rl\nLmlzRW1wdHkoX2FjY2Vzc1R5cGUpIAogICAgICAgICAgIHx8IEFjY2Vzc0Nv\nZGUuaXNFeHBsaWNpdChfYWNjZXNzVHlwZSkpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxsICYmIHN1\ncC5pc0V4cGxpY2l0QWNjZXNzKCkpCiAgICAgICAgCXN1cCA9IHN1cC5nZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVs\nbCAmJiBzdXAuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5ndGggPiAwKSB7CiAg\nICAgICAgCWludCBzdXBDb2RlID0gc3VwLmdldEFjY2Vzc1R5cGUoKTsKICAg\nICAgICAJaWYgKCFBY2Nlc3NDb2RlLmlzQ29tcGF0aWJsZVN1cGVyKF9hY2Nl\nc3NUeXBlLCBzdXBDb2RlKSkKICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYWNjZXNzLWluY29uc2lzdGVudC1p\nbmhlcml0IiwKICAgICAgICAgICAgIG5ldyBPYmplY3RbXXt0aGlzLCBBY2Nl\nc3NDb2RlLnRvQ2xhc3NTdHJpbmcoX2FjY2Vzc1R5cGUpLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICBzdXAsIEFjY2Vzc0NvZGUudG9DbGFzc1N0cmlu\nZyhzdXBDb2RlKX0pLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEFzc2VydCB0aGF0IGRldGFjaG1lbnQgY29uZmlndXJh\ndGlvbiBpcyB2YWxpZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlk\nYXRlRGV0YWNoYWJsZSgpIHsKICAgICAgICBib29sZWFuIGZpcnN0ID0gdHJ1\nZTsKICAgICAgICBmb3IgKENsYXNzTWV0YURhdGEgcGFyZW50ID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgZmlyc3QgJiYgcGFy\nZW50ICE9IG51bGw7IHBhcmVudCA9IHBhcmVudC5nZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHBhcmVudC5p\nc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7\nCiAgICAgICAgfQoKICAgICAgICBGaWVsZCBmaWVsZCA9IGdldERldGFjaGVk\nU3RhdGVGaWVsZCgpOwogICAgICAgIGlmIChmaWVsZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmICghZmlyc3QpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInBhcmVudC1kZXRhY2gt\nc3RhdGUiLAogICAgICAgICAgICAgICAgICAgIF90eXBlKSk7CiAgICAgICAg\nICAgIGlmIChnZXRGaWVsZChmaWVsZC5nZXROYW1lKCkpICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm1hbmFnZWQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAg\nICAgICBmaWVsZC5nZXROYW1lKCksIF90eXBlKSk7CiAgICAgICAgICAgIGlm\nIChmaWVsZC5nZXRUeXBlKCkgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZC5n\nZXROYW1lKCksIF90eXBlKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gRmV0Y2ggR3JvdXAKICAgIC8vLy8vLy8vLy8v\nLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmZXRjaCBncm91cHMg\nZGVjbGFyZWQgZXhwbGljaXRseSBpbiB0aGlzIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBGZXRjaEdyb3VwW10gZ2V0RGVjbGFyZWRGZXRjaEdyb3Vwcygp\nIHsKICAgICAgICBpZiAoX2ZncyA9PSBudWxsKQogICAgICAgICAgICBfZmdz\nID0gKF9mZ01hcCA9PSBudWxsKSA/IEVNUFRZX0ZFVENIX0dST1VQX0FSUkFZ\nIDogKEZldGNoR3JvdXBbXSkKICAgICAgICAgICAgICAgIF9mZ01hcC52YWx1\nZXMoKS50b0FycmF5KG5ldyBGZXRjaEdyb3VwW19mZ01hcC5zaXplKCldKTsg\nCiAgICAgICAgcmV0dXJuIF9mZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYWxsIGZldGNoIGdyb3VwcyBmb3IgdGhpcyB0eXBlLCBpbmNsdWRp\nbmcgc3VwZXJjbGFzcyBncm91cHMuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRj\naEdyb3VwW10gZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYg\nKF9jdXN0b21GR3MgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBtYXAgZmV0\nY2ggZ3JvdXBzIHRvIG5hbWVzLCBhbGxvd2luZyBvdXIgZ3JvdXBzIHRvIG92\nZXJyaWRlIHN1cGVyCiAgICAgICAgICAgIE1hcDxTdHJpbmcsRmV0Y2hHcm91\ncD4gZmdzID0gbmV3IEhhc2hNYXA8U3RyaW5nLEZldGNoR3JvdXA+KCk7CiAg\nICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAg\nICAgICAgICB7CiAgICAgICAgICAgICAgICBGZXRjaEdyb3VwW10gc3VwRkdz\nID0gc3VwLmdldEN1c3RvbUZldGNoR3JvdXBzKCk7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHN1cEZHcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgICAgICBmZ3MucHV0KHN1cEZHc1tpXS5nZXROYW1lKCks\nIHN1cEZHc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRmV0Y2hH\ncm91cFtdIGRlY3MgPSBnZXREZWNsYXJlZEZldGNoR3JvdXBzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVjcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIGZncy5wdXQoZGVjc1tpXS5nZXROYW1lKCksIGRl\nY3NbaV0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gcmVtb3ZlIHN0\nYW5kYXJkIGdyb3VwcwogICAgICAgICAgICBmZ3MucmVtb3ZlKEZldGNoR3Jv\ndXAuTkFNRV9ERUZBVUxUKTsKICAgICAgICAgICAgZmdzLnJlbW92ZShGZXRj\naEdyb3VwLk5BTUVfQUxMKTsKCiAgICAgICAgICAgIF9jdXN0b21GR3MgPSAo\nRmV0Y2hHcm91cFtdKSBmZ3MudmFsdWVzKCkudG9BcnJheQogICAgICAgICAg\nICAgICAgKG5ldyBGZXRjaEdyb3VwW2Zncy5zaXplKCldKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIF9jdXN0b21GR3M7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHZXRzIGEgbmFtZWQgZmV0Y2ggZ3JvdXAuIElmIG5vdCBhdmFpbGFi\nbGUgaW4gdGhpcyByZWNlaXZlciB0aGVuIGxvb2tzCiAgICAgKiB1cCB0aGUg\naW5oZXJpdGFuY2UgaGllcmFyY2h5LiAKICAgICAqCiAgICAgKiBAcGFyYW0g\nbmFtZSBuYW1lIG9mIGEgZmV0Y2ggZ3JvdXAuCiAgICAgKiBAcmV0dXJuIGFu\nIGV4aXN0aW5nIGZldGNoIGdyb3VwIG9mIHRoZSBnaXZlbiBuYW1lIGlmIGtu\nb3duIHRvIHRoaXMgCiAgICAgKiByZWNlaXZlciBvciBhbnkgb2YgaXRzIHN1\ncGVyY2xhc3Nlcy4gT3RoZXJ3aXNlIG51bGwuCiAgICAgKi8KICAgIHB1Ymxp\nYyBGZXRjaEdyb3VwIGdldEZldGNoR3JvdXAoU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBGZXRjaEdyb3VwIGZnID0gKF9mZ01hcCA9PSBudWxsKSA/IG51bGwg\nOiAoRmV0Y2hHcm91cCkgX2ZnTWFwLmdldChuYW1lKTsKICAgICAgICBpZiAo\nZmcgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZnOwogICAgICAgIENs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBz\ndXAuZ2V0RmV0Y2hHcm91cChuYW1lKTsKICAgICAgICBpZiAoRmV0Y2hHcm91\ncC5OQU1FX0RFRkFVTFQuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1\ncm4gRmV0Y2hHcm91cC5ERUZBVUxUOwogICAgICAgIGlmIChGZXRjaEdyb3Vw\nLk5BTUVfQUxMLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIEZl\ndGNoR3JvdXAuQUxMOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyBmZXRjaCBncm91cCBvZiB0aGUgZ2l2ZW4gbmFt\nZSwgb3IgcmV0dXJucyBleGlzdGluZyBpbnN0YW5jZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gbmFtZSBhIG5vbi1udWxsLCBub24tZW1wdHkgbmFtZS4gTXVz\ndCBiZSB1bmlxdWUgd2l0aGluIHRoaXMKICAgICAqIHJlY2VpdmVyJ3Mgc2Nv\ncGUuIFRoZSBzdXBlciBjbGFzcyA8ZW0+bWF5PC9lbT4gaGF2ZSBhIGdyb3Vw\nIHdpdGgKICAgICAqIHRoZSBzYW1lIG5hbWUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBGZXRjaEdyb3VwIGFkZERlY2xhcmVkRmV0Y2hHcm91cChTdHJpbmcgbmFt\nZSkgewogICAgCWlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAg\nCQl0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVtcHR5\nLWZnLW5hbWUiLCB0aGlzKSk7CiAgICAgICAgaWYgKF9mZ01hcCA9PSBudWxs\nKQogICAgICAgICAgICBfZmdNYXAgPSBuZXcgSGFzaE1hcDxTdHJpbmcsRmV0\nY2hHcm91cD4oKTsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gKEZldGNoR3Jv\ndXApIF9mZ01hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51bGwp\nIHsKICAgICAgICAJZmcgPSBuZXcgRmV0Y2hHcm91cCh0aGlzLCBuYW1lKTsK\nICAgICAgICAJX2ZnTWFwLnB1dChuYW1lLCBmZyk7CiAgICAgICAgICAgIF9m\nZ3MgPSBudWxsOwogICAgICAgICAgICBfY3VzdG9tRkdzID0gbnVsbDsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGZnOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIGEgZGVjbGFyZWQgZmV0Y2ggZ3JvdXAuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xhcmVkRmV0Y2hHcm91cChGZXRj\naEdyb3VwIGZnKSB7CiAgICAgICAgaWYgKGZnID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2ZnTWFwLnJlbW92ZShm\nZy5nZXROYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgX2ZncyA9IG51\nbGw7CiAgICAgICAgICAgIF9jdXN0b21GR3MgPSBudWxsOwogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTb3VyY2VU\ncmFja2VyCiAgICAvLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBGaWxl\nIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAgcmV0dXJuIF9zcmNGaWxlOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRT\nb3VyY2VUeXBlKCkgewogICAgICAgIHJldHVybiBfc3JjVHlwZTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2UoRmlsZSBmaWxlLCBpbnQgc3Jj\nVHlwZSkgewogICAgICAgIF9zcmNGaWxlID0gZmlsZTsKICAgICAgICBfc3Jj\nVHlwZSA9IHNyY1R5cGU7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRS\nZXNvdXJjZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUo\nKTsKICAgIH0KICAgIAogICAgcHVibGljIGludCBnZXRMaW5lTnVtYmVyKCkg\newogICAgICAgIHJldHVybiBfbGluZU51bTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRMaW5lTnVtYmVyKGludCBsaW5lTnVtKSB7CiAgICAgICAgX2xp\nbmVOdW0gPSBsaW5lTnVtOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0Q29s\nTnVtYmVyKCkgewogICAgICAgIHJldHVybiBfY29sTnVtOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldENvbE51bWJlcihpbnQgY29sTnVtKSB7CiAgICAg\nICAgX2NvbE51bSA9IGNvbE51bTsKICAgIH0KICAgIAoKICAgIC8qKgogICAg\nICogVGhlIHNvdXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9h\nZGVkIHVuZGVyLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1v\nZGUoKSB7CiAgICAgICAgcmV0dXJuIF9zcmNNb2RlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIHNvdXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEgaGFzIGJl\nZW4gbG9hZGVkIHVuZGVyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRT\nb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAgICAgX3NyY01vZGUgPSBtb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIHRoaXMg\nbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVuZGVyLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfc3JjTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAg\nICAgICAgIF9zcmNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBfc3JjTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBpbmRleCBpbiB3aGljaCB0aGlzIGNsYXNzIHdhcyBsaXN0ZWQgaW4g\ndGhlIG1ldGFkYXRhLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+LTE8L2Nv\nZGU+IGlmIHRoaXMgY2xhc3Mgd2FzIG5vdCBsaXN0ZWQgaW4gdGhlIG1ldGFk\nYXRhLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldExpc3RpbmdJbmRleCgp\nIHsKICAgICAgICByZXR1cm4gX2xpc3RJbmRleDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBpbmRleCBpbiB3aGljaCB0aGlzIGZpZWxkIHdhcyBsaXN0\nZWQgaW4gdGhlIG1ldGFkYXRhLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+\nLTE8L2NvZGU+IGlmIHRoaXMgY2xhc3Mgd2FzIG5vdCBsaXN0ZWQgaW4gdGhl\nIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMaXN0aW5n\nSW5kZXgoaW50IGluZGV4KSB7CiAgICAgICAgX2xpc3RJbmRleCA9IGluZGV4\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29tbWVudGFi\nbGUKICAgIC8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBTdHJpbmdbXSBn\nZXRDb21tZW50cygpIHsKICAgICAgICByZXR1cm4gKF9jb21tZW50cyA9PSBu\ndWxsKSA/IEVNUFRZX0NPTU1FTlRTIDogX2NvbW1lbnRzOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldENvbW1lbnRzKFN0cmluZ1tdIGNvbW1lbnRzKSB7\nCiAgICAgICAgX2NvbW1lbnRzID0gY29tbWVudHM7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRlIGNvcHkKICAgIC8vLy8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBDb3B5IHRoZSBtZXRhZGF0YSBmcm9tIHRo\nZSBnaXZlbiBpbnN0YW5jZSB0byB0aGlzIG9uZS4gRG8gbm90CiAgICAgKiBj\nb3B5IG1hcHBpbmcgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGNvcHkoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpICE9IF90eXBlKQogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICBzdXBlci5j\nb3B5KG1ldGEpOwoKICAgICAgICAvLyBjb3B5IGNsYXNzLWxldmVsIGluZm87\nIHVzZSBnZXQgbWV0aG9kcyB0byBmb3JjZSByZXNvbHV0aW9uIG9mCiAgICAg\nICAgLy8gbGF6eSBkYXRhCiAgICAgICAgX3N1cGVyID0gbWV0YS5nZXRQQ1N1\ncGVyY2xhc3MoKTsKICAgICAgICBfb2JqZWN0SWQgPSBtZXRhLmdldE9iamVj\ndElkVHlwZSgpOwogICAgICAgIF9leHRlbnQgPSAobWV0YS5nZXRSZXF1aXJl\nc0V4dGVudCgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgX2VtYmVkZGVkID0gKG1ldGEuaXNFbWJlZGRlZE9ubHkoKSkgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIF9lbWJlZGRh\nYmxlID0gbWV0YS5fZW1iZWRkYWJsZTsKICAgICAgICBfaW50ZXJmYWNlID0g\nKG1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRTsKICAgICAgICBzZXRJbnRlcmNlcHRpbmcobWV0YS5p\nc0ludGVyY2VwdGluZygpKTsKICAgICAgICBfaW1wbCA9IG1ldGEuZ2V0SW50\nZXJmYWNlSW1wbCgpOwogICAgICAgIF9pZGVudGl0eSA9IG1ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCk7CiAgICAgICAgX2lkU3RyYXRlZ3kgPSBtZXRhLmdldElk\nZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBfc2VxTmFtZSA9IG1ldGEuZ2V0\nSWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICBfc2VxTWV0YSA9IG51\nbGw7CiAgICAgICAgX2FsaWFzID0gbWV0YS5nZXRUeXBlQWxpYXMoKTsKICAg\nICAgICBfYWNjZXNzVHlwZSA9IG1ldGEuZ2V0QWNjZXNzVHlwZSgpOwoKICAg\nICAgICAvLyBvbmx5IGNvcHkgdGhpcyBpbmZvcm1hdGlvbiBpZiBpdCB3YXNu\nJ3Qgc2V0IGV4cGxpY2l0bHkgZm9yIHRoaXMKICAgICAgICAvLyBpbnN0YW5j\nZQogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2NhY2hlTmFt\nZSkpCiAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBtZXRhLmdldERhdGFDYWNo\nZU5hbWUoKTsKICAgICAgICBpZiAoX2NhY2hlVGltZW91dCA9PSBJbnRlZ2Vy\nLk1JTl9WQUxVRSkKICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IG1ldGEu\nZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgIF9jYWNoZUVuYWJsZWQg\nPSBtZXRhLmdldENhY2hlRW5hYmxlZCgpOwogICAgICAgIF9kYXRhQ2FjaGVF\nbmFibGVkID0gbWV0YS5nZXREYXRhQ2FjaGVFbmFibGVkKCk7CiAgICAgICAg\naWYgKF9kZXRhY2hhYmxlID09IG51bGwpCiAgICAgICAgICAgIF9kZXRhY2hh\nYmxlID0gbWV0YS5fZGV0YWNoYWJsZTsKICAgICAgICBpZiAoREVGQVVMVF9T\nVFJJTkcuZXF1YWxzKF9kZXRhY2hTdGF0ZSkpCiAgICAgICAgICAgIF9kZXRh\nY2hTdGF0ZSA9IG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpOwoKICAgICAgICAv\nLyBzeW5jaCBmaWVsZCBpbmZvcm1hdGlvbjsgZmlyc3QgcmVtb3ZlIGV4dHJh\nIGZpZWxkcwogICAgICAgIGNsZWFyRmllbGRDYWNoZSgpOwogICAgICAgIF9m\naWVsZE1hcC5rZXlTZXQoKS5yZXRhaW5BbGwobWV0YS5fZmllbGRNYXAua2V5\nU2V0KCkpOwoKICAgICAgICAvLyBhZGQgY29waWVzIG9mIGRlY2xhcmVkIGZp\nZWxkczsgb3RoZXIgZGVmaW5lZCBmaWVsZHMgYWxyZWFkeSBjb3BpZWQKICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gbWV0YS5nZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQ7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgZmllbGQgPSBnZXREZWNsYXJlZEZpZWxkKGZpZWxkc1tp\nXS5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGZpZWxkID0gYWRkRGVjbGFyZWRGaWVsZChmaWVs\nZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGZpZWxkc1tp\nXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGZpZWxkLnNldERl\nY2xhcmVkSW5kZXgoLTEpOwogICAgICAgICAgICBmaWVsZC5zZXRJbmRleCgt\nMSk7CiAgICAgICAgICAgIGZpZWxkLmNvcHkoZmllbGRzW2ldKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGNvcHkgZmV0Y2ggZ3JvdXBzCiAgICAgICAgRmV0\nY2hHcm91cFtdIGZncyA9IG1ldGEuZ2V0RGVjbGFyZWRGZXRjaEdyb3Vwcygp\nOwogICAgICAgIEZldGNoR3JvdXAgZmc7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmcgPSBh\nZGREZWNsYXJlZEZldGNoR3JvdXAoZmdzW2ldLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIGZnLmNvcHkoZmdzW2ldKTsgCiAgICAgICAgfQoKICAgICAgICAv\nLyBjb3B5IGludGVyZmFjZSByZS1tYXBwaW5nCiAgICAgICAgX2lmYWNlTWFw\nLmNsZWFyKCk7CiAgICAgICAgX2lmYWNlTWFwLnB1dEFsbChtZXRhLl9pZmFj\nZU1hcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVy\nIHRvIGNvcHkgZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIHZvaWQgY29weShDbGFzc01ldGFEYXRhIGVtYmVkLCBDbGFz\nc01ldGFEYXRhIGRlYykgewogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0g\nZGVjLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1\ncCAhPSBudWxsKSB7CiAgICAgICAgICAgIGVtYmVkLnNldFBDU3VwZXJjbGFz\ncyhzdXAuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29weShl\nbWJlZC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLCBzdXApOwogICAgICAg\nIH0KICAgICAgICBlbWJlZC5jb3B5KGRlYyk7CiAgICB9CgogICAgcHJvdGVj\ndGVkIHZvaWQgYWRkRXh0ZW5zaW9uS2V5cyhDb2xsZWN0aW9uIGV4dHMpIHsK\nICAgICAgICBfcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCkuYWRkQ2xhc3NF\neHRlbnNpb25LZXlzKGV4dHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ29t\ncGFyYXRvciB1c2VkIHRvIHB1dCBmaWVsZCBtZXRhZGF0YSBpbnRvIGxpc3Rp\nbmcgb3JkZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIExp\nc3RpbmdPcmRlckNvbXBhcmF0b3IKICAgICAgICBpbXBsZW1lbnRzIENvbXBh\ncmF0b3I8RmllbGRNZXRhRGF0YT4gewoKICAgICAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMaXN0aW5nT3JkZXJDb21wYXJhdG9yIF9pbnN0YW5jZQogICAg\nICAgICAgICA9IG5ldyBMaXN0aW5nT3JkZXJDb21wYXJhdG9yKCk7CgogICAg\nICAgIC8qKgogICAgICAgICAqIEFjY2VzcyBzaW5nbGV0b24gaW5zdGFuY2Uu\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0aW5nT3Jk\nZXJDb21wYXJhdG9yIGdldEluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1\ncm4gX2luc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBj\nb21wYXJlKEZpZWxkTWV0YURhdGEgZjEsIEZpZWxkTWV0YURhdGEgZjIpIHsK\nICAgICAgICAgICAgaWYgKGYxID09IGYyKQogICAgICAgICAgICAgICAgcmV0\ndXJuIDA7CiAgICAgICAgICAgIGlmIChmMSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIGlmIChmMiA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICAgICAgaWYgKGYx\nLmdldExpc3RpbmdJbmRleCgpID09IGYyLmdldExpc3RpbmdJbmRleCgpKSB7\nCiAgICAgICAgICAgICAgICBpZiAoZjEuZ2V0SW5kZXgoKSA9PSBmMi5nZXRJ\nbmRleCgpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmMS5nZXRGdWxs\nTmFtZShmYWxzZSkuY29tcGFyZVRvCiAgICAgICAgICAgICAgICAgICAgICAg\nIChmMi5nZXRGdWxsTmFtZShmYWxzZSkpOwoJCQkJaWYgKGYxLmdldEluZGV4\nICgpID09IC0xKQoJCQkJCXJldHVybiAxOwoJCQkJaWYgKGYyLmdldEluZGV4\nICgpID09IC0xKQoJCQkJCXJldHVybiAtMTsKCQkJCXJldHVybiBmMS5nZXRJ\nbmRleCAoKSAtIGYyLmdldEluZGV4ICgpOwoJCQl9CQoJCQlpZiAoZjEuZ2V0\nTGlzdGluZ0luZGV4ICgpID09IC0xKQoJCQkJcmV0dXJuIDE7CgkJCWlmIChm\nMi5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJCQlyZXR1cm4gLTE7CgkJ\nCXJldHVybiBmMS5nZXRMaXN0aW5nSW5kZXggKCkgLSBmMi5nZXRMaXN0aW5n\nSW5kZXggKCk7CgkJfQoJfQogICAgCiAgICBwdWJsaWMgdm9pZCByZWdpc3Rl\nckZvclZhbHVlVXBkYXRlKFN0cmluZy4uLnZhbHVlcykgewogICAgCWlmICh2\nYWx1ZXMgPT0gbnVsbCkKICAgIAkJcmV0dXJuOwogICAgCWZvciAoU3RyaW5n\nIGtleSA6IHZhbHVlcykgewogICAgCQlWYWx1ZSB2YWx1ZSA9IGdldFJlcG9z\naXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkKICAgIAkJCS5nZXRWYWx1ZShr\nZXkpOwogICAgCQlpZiAodmFsdWUgIT0gbnVsbCkKICAgIAkJCXZhbHVlLmFk\nZExpc3RlbmVyKHRoaXMpOwogICAgCX0KICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgdmFsdWVDaGFuZ2VkKFZhbHVlIHZhbCkgewogICAgCWlmICh2YWwg\nIT0gbnVsbCAmJiB2YWwubWF0Y2hlcygiRGF0YUNhY2hlVGltZW91dCIpKSB7\nCiAgICAJCV9jYWNoZVRpbWVvdXQgPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAg\nIAl9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVXRpbGl0eSBtZXRob2Qg\ndG8gZ2V0IG5hbWVzIG9mIGFsbCBmaWVsZHMgaW5jbHVkaW5nIHRoZSBzdXBl\ncmNsYXNzZXMnCiAgICAgKiBzb3J0ZWQgaW4gbGV4aWNhbCBvcmRlci4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEZpZWxkTmFtZXMoKSB7CiAg\nICAJcmV0dXJuIHRvTmFtZXMoZ2V0RmllbGRzKCkpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFV0aWxpdHkgbWV0aG9kIHRvIGdldCBuYW1lcyBvZiBh\nbGwgZGVjbGFyZWQgZmllbGRzIGV4Y2x1ZGluZyB0aGUgCiAgICAgKiBzdXBl\ncmNsYXNzZXMnIHNvcnRlZCBpbiBsZXhpY2FsIG9yZGVyLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nW10gZ2V0RGVjbGFyZWRGaWVsZE5hbWVzKCkgewog\nICAgCXJldHVybiB0b05hbWVzKGdldERlY2xhcmVkRmllbGRzKCkpOwogICAg\nfQogICAgCiAgICBTdHJpbmdbXSB0b05hbWVzKEZpZWxkTWV0YURhdGFbXSBm\naWVsZHMpIHsKICAgIAlMaXN0PFN0cmluZz4gcmVzdWx0ID0gbmV3IEFycmF5\nTGlzdDxTdHJpbmc+KCk7CiAgICAJZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6\nIGZpZWxkcykgewogICAgCQlyZXN1bHQuYWRkKGZtZC5nZXROYW1lKCkpOwog\nICAgCX0KICAgIAlDb2xsZWN0aW9ucy5zb3J0KHJlc3VsdCk7CiAgICAJcmV0\ndXJuIHJlc3VsdC50b0FycmF5KG5ldyBTdHJpbmdbcmVzdWx0LnNpemUoKV0p\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgdGhlIHBlcnNp\nc3RlbmNlIGluc3RhbmNlcyBvZiB0aGlzIHJlY2VpdmVyIGlzIHJlcGxpY2F0\nZWQgYWNyb3NzCiAgICAgKiBtdWx0aXBsZSBkYXRhYmFzZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzUmVwbGljYXRlZCgpIHsKICAgIAlyZXR1\ncm4gX3JlcGxpY2F0ZWQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0\ncyB0aGUgcGVyc2lzdGVuY2UgaW5zdGFuY2VzIG9mIHRoaXMgcmVjZWl2ZXIg\ndG8gYmUgcmVwbGljYXRlZCBhY3Jvc3MKICAgICAqIG11bHRpcGxlIGRhdGFi\nYXNlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVwbGljYXRlZChi\nb29sZWFuIGZsYWcpIHsKICAgIAlfcmVwbGljYXRlZCA9IGZsYWc7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNBYnN0cmFjdCgpIHsKICAgICAgICBy\nZXR1cm4gX2Fic3RyYWN0OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEFi\nc3RyYWN0KGJvb2xlYW4gZmxhZykgewogICAgICAgIF9hYnN0cmFjdCA9IGZs\nYWc7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2Qg\ndG8gZGV0ZXJtaW5lIGlmIHRoZSBwY1R5cGUgbW9kZWxlZCBieQogICAgICog\ndGhpcyBDbGFzc01ldGFEYXRhIG9iamVjdCBpcyBib3RoIGFic3RyYWN0IGFu\nZCBkZWNsYXJlcyBQS0ZpZWxkcy4gVGhpcwogICAgICogbWV0aG9kIGlzIHVz\nZWQgYnkgdGhlIFBDRW5oYW5jZXIgdG8gZGV0ZXJtaW5lIGlmIHNwZWNpYWwg\naGFuZGxpbmcgaXMKICAgICAqIHJlcXVpcmVkLgogICAgICoKICAgICAqIEBy\nZXR1cm4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaGFzQWJzdHJhY3RQ\nS0ZpZWxkKCkgewogICAgICAgIGlmIChfaGFzQWJzdHJhY3RQS0ZpZWxkICE9\nIG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIF9oYXNBYnN0cmFjdFBLRmll\nbGQuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZWZh\ndWx0IHRvIGZhbHNlLCBzZXQgdG8gdHJ1ZSBvbmx5IGlmIHRoaXMgdHlwZSBp\ncyBhYnN0cmFjdCBhbmQKICAgICAgICAvLyBkZWNsYXJlcyBhIFBLRmllbGQu\nCiAgICAgICAgX2hhc0Fic3RyYWN0UEtGaWVsZCA9IEJvb2xlYW4uRkFMU0U7\nCgogICAgICAgIGlmIChpc0Fic3RyYWN0KCkgPT0gdHJ1ZSkgewogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZGVjbGFyZWRGaWVsZHMgPSBnZXREZWNs\nYXJlZEZpZWxkcygpOwogICAgICAgICAgICBpZiAoZGVjbGFyZWRGaWVsZHMg\nIT0gbnVsbCAmJiBkZWNsYXJlZEZpZWxkcy5sZW5ndGggIT0gMCkgewogICAg\nICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IGRlY2xhcmVk\nRmllbGRzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZtZC5pc1ByaW1h\ncnlLZXkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfaGFzQWJzdHJh\nY3RQS0ZpZWxkID0gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVy\nbiBfaGFzQWJzdHJhY3RQS0ZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBkZXRl\ncm1pbmUgaWYgdGhpcyB0eXBlIGlzIGEgZGlyZWN0CiAgICAgKiBkZWNlbmRl\nbnQgb2YgYW4gYWJzdHJhY3QgdHlwZSBkZWNsYXJpbmcgUEtGaWVsZHMuIFJl\ndHVybnMgdHJ1ZSBpZiB0aGVyZQogICAgICogYXJlIG5vIHBjVHlwZXMgbWFw\ncGVkIHRvIGEgdGFibGUgYmV0d2VlbiB0aGlzIHR5cGUgYW5kIGFuIGFic3Ry\nYWN0IHBjVHlwZQogICAgICogZGVjbGFyaW5nIFBLRmllbGRzLiBSZXR1cm5z\nIGZhbHNlIGlmIHRoZXJlIG5vIHN1Y2ggYWJzdHJhY3QgcGNUeXBlcyBpbgog\nICAgICogdGhlIGluaGVyaXRhbmNlIGhpZXJhcmNoeSBvciBpZiB0aGVyZSBh\ncmUgYW55IHBjVHlwZXMgbWFwcGVkIHRvIHRhYmxlcyBpbgogICAgICogYmV0\nd2VlbiB0aGUgdHlwZSByZXByZXNlbnRlZCBieSB0aGlzIENsYXNzTWV0YURh\ndGEgb2JqZWN0IGFuZCB0aGUKICAgICAqIGFic3RyYWN0IHBjVHlwZSBkZWNs\nYXJpbmcgUEtGaWVsZHMuCiAgICAgKgogICAgICogQHJldHVybgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENs\nYXNzKCkgewogICAgICAgIGlmIChfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RD\nbGFzcyAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBfaGFzUEtGaWVs\nZHNGcm9tQWJzdHJhY3RDbGFzcy5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9\nCgogICAgICAgIC8vIERlZmF1bHQgdG8gRkFMU0UsIHVudGlsIHByb3ZlbiB0\ncnVlLgogICAgICAgIF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzID0g\nQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrRmll\nbGRzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGZvciAoRmll\nbGRNZXRhRGF0YSBmbWQgOiBwa0ZpZWxkcykgewogICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIGZtZERNREEgPSBmbWQuZ2V0RGVjbGFyaW5nTWV0YURhdGEo\nKTsKICAgICAgICAgICAgaWYgKGZtZERNREEuaXNBYnN0cmFjdCgpKSB7CiAg\nICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoY21kICE9\nIGZtZERNREEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZm1kRE1EQS5p\nc0Fic3RyYWN0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY21kID0g\nY21kLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgaWYgKGNtZCA9PSBmbWRETURBKSB7CiAgICAgICAgICAg\nICAgICAgICAgX2hhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MgPSBCb29s\nZWFuLlRSVUU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJl\ndHVybiBfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcy5ib29sZWFuVmFs\ndWUoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBlbGln\naWJpbGl0eSBzdGF0dXMgb2YgdGhpcyBjbGFzcyBmb3IgY2FjaGUuCiAgICAg\nKiAKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVFbmFibGVkKGJv\nb2xlYW4gZW5hYmxlZCkgeyAKICAgICAgICBfY2FjaGVFbmFibGVkID0gZW5h\nYmxlZDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRyaS1z\ndGF0ZSBzdGF0dXMgb24gd2hldGhlciB0aGlzIGNsYXNzIGhhcyBiZWVuIGVu\nYWJsZWQgZm9yIGNhY2hpbmcuCiAgICAgKiAKICAgICAqIEByZXR1cm4gVFJV\nRSBvciBGQUxTRSBkZW5vdGUgdGhpcyBjbGFzcyBoYXMgYmVlbiBleHBsaWNp\ndGx5IGVuYWJsZWQgb3IgZGlzYWJsZWQgZm9yIGNhY2hpbmcuCiAgICAgKiBJ\nZiBubyBzdGF0dXMgaGFzIGJlZW4gZXhwbGljaXRseSBzZXQsIHRoZW4gdGhl\nIHN0YXR1cyBvZiB0aGUgcGVyc2lzdGVudCBzdXBlciBjbGFzcywgaWYgYW55\nLCBpcyByZXR1cm5lZC4gCiAgICAgKi8KICAgIHB1YmxpYyBCb29sZWFuIGdl\ndENhY2hlRW5hYmxlZCgpIHsgCiAgICAgICAgaWYgKF9jYWNoZUVuYWJsZWQg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9jYWNoZUVuYWJsZWQ7CiAg\nICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgIT0gbnVs\nbCA/ICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldENhY2hlRW5hYmxl\nZCgpIDogbnVsbDsgCiAgICB9Cn0KCg==\n","encoding":"base64"}

