{"sha":"ba2645f447fa78081744fca71f992afcc9fb3014","node_id":"MDQ6QmxvYjIwNjM2NDpiYTI2NDVmNDQ3ZmE3ODA4MTc0NGZjYTcxZjk5MmFmY2M5ZmIzMDE0","size":12199,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ba2645f447fa78081744fca71f992afcc9fb3014","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQg\namF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwoKLyoqCiAqIENhcHR1cmVzIGZldGNoIGdyb3VwIG1ldGFkYXRhLgogKi8K\ncHVibGljIGNsYXNzIEZldGNoR3JvdXAgCiAgICBpbXBsZW1lbnRzIFNlcmlh\nbGl6YWJsZSB7CgogICAgLyoqCiAgICAgKiBOYW1lIG9mIHRoZSBkZWZhdWx0\nIGZldGNoIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIFN0cmluZyBOQU1FX0RFRkFVTFQgPSAiZGVmYXVsdCI7CgogICAgLyoqCiAg\nICAgKiBOYW1lIG9mIHRoZSAiYWxsIiBmZXRjaCBncm91cC4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgTkFNRV9BTEwgPSAiYWxs\nIjsKCiAgICAvKioKICAgICAqIERlZmF1bHQgZmllbGQgcmVjdXJzaW9uIGRl\ncHRoLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRUNV\nUlNJT05fREVQVEhfREVGQVVMVCA9IDE7CgogICAgLyoqCiAgICAgKiBJbmZp\nbml0ZSBkZXB0aC4KICAgICAqLwoJcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nREVQVEhfSU5GSU5JVEUgPSAtMTsKCiAgICAvKioKICAgICAqICBTdGFuZGFy\nZCBkZWZhdWx0IGZldGNoIGdyb3VwLgogICAgICovCiAgICBzdGF0aWMgZmlu\nYWwgRmV0Y2hHcm91cCBERUZBVUxUID0gbmV3IEZldGNoR3JvdXAoTkFNRV9E\nRUZBVUxULCB0cnVlKTsKCiAgICAvKioKICAgICAqICBTdGFuZGFyZCAiYWxs\nIiBmZXRjaCBncm91cC4KICAgICAqLwogICAgc3RhdGljIGZpbmFsIEZldGNo\nR3JvdXAgQUxMID0gbmV3IEZldGNoR3JvdXAoTkFNRV9BTEwsIGZhbHNlKTsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEZldGNoR3JvdXAuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9uYW1lOwogICAgcHJpdmF0\nZSBmaW5hbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5h\nbCBib29sZWFuIF9yZWFkT25seTsKICAgIHByaXZhdGUgTGlzdCBfaW5jbHVk\nZXM7CiAgICBwcml2YXRlIFNldCAgX2NvbnRhaW5lZEJ5OwogICAgcHJpdmF0\nZSBNYXAgX2RlcHRoczsKICAgIHByaXZhdGUgQm9vbGVhbiBfcG9zdExvYWQ7\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvcjsgc3VwcGx5IGltbXV0YWJs\nZSBuYW1lLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIG11c3Qgbm90IGJ5\nIG51bGwgb3IgZW1wdHkuCiAgICAgKi8KICAgIEZldGNoR3JvdXAoQ2xhc3NN\nZXRhRGF0YSBjbSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICBfbWV0YSA9IGNt\nOwogICAgICAgIF9uYW1lID0gbmFtZTsKICAgICAgICBfcmVhZE9ubHkgPSBm\nYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGNvbnN0cnVj\ndG9yIGZvciBidWlsdGluIGZldGNoIGdyb3Vwcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBGZXRjaEdyb3VwKFN0cmluZyBuYW1lLCBib29sZWFuIHBvc3RMb2Fk\nKSB7CiAgICAgICAgX21ldGEgPSBudWxsOwogICAgICAgIF9uYW1lID0gbmFt\nZTsKICAgICAgICBfcG9zdExvYWQgPSAocG9zdExvYWQpID8gQm9vbGVhbi5U\nUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBfcmVhZE9ubHkgPSB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBzdGF0ZSBmcm9tIHRoZSBn\naXZlbiBmZXRjaCBncm91cC4KICAgICAqLwogICAgdm9pZCBjb3B5KEZldGNo\nR3JvdXAgZmcpIHsKICAgICAgICBpZiAoZmcuX2luY2x1ZGVzICE9IG51bGwp\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmcuX2luY2x1ZGVz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAg\nYWRkRGVjbGFyZWRJbmNsdWRlKChTdHJpbmcpIGl0ci5uZXh0KCkpOwogICAg\nICAgIGlmIChmZy5fY29udGFpbmVkQnkgIT0gbnVsbCkgCiAgICAgICAgCXRo\naXMuX2NvbnRhaW5lZEJ5ID0gbmV3IEhhc2hTZXQoZmcuX2NvbnRhaW5lZEJ5\nKTsKICAgICAgICAKICAgICAgICBpZiAoZmcuX2RlcHRocyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBmZy5fZGVwdGhzLmVudHJ5U2V0KCkuaXRlcmF0\nb3IoKTsgCiAgICAgICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgc2V0UmVjdXJzaW9uRGVwdGgoKEZpZWxkTWV0YURh\ndGEpIGVudHJ5LmdldEtleSgpLCAoKE51bWJlcikgCiAgICAgICAgICAgICAg\nICAgICAgZW50cnkuZ2V0VmFsdWUoKSkuaW50VmFsdWUoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZnLl9wb3N0TG9hZCAhPSBu\ndWxsKQogICAgICAgICAgICBfcG9zdExvYWQgPSBmZy5fcG9zdExvYWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGZXRjaCBncm91cCBuYW1lLgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nIGdldE5hbWUoKSB7CiAgICAgICAgcmV0dXJu\nIF9uYW1lOwogICAgfQoKICAgIC8qKgogICAgICogSW5jbHVkZXMgZ2l2ZW4g\nZmV0Y2ggZ3JvdXAgd2l0aGluIHRoaXMgcmVjZWl2ZXIuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFkZERlY2xhcmVkSW5jbHVkZShTdHJpbmcgZmdOYW1l\nKSB7CiAgICAgICAgaWYgKF9yZWFkT25seSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZmdOYW1lKSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWlu\nY2x1ZGUtZmciLCB0aGlzKSk7CiAgICAgICAgaWYgKF9pbmNsdWRlcyA9PSBu\ndWxsKQogICAgICAgICAgICBfaW5jbHVkZXMgPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgaWYgKCFfaW5jbHVkZXMuY29udGFpbnMoZmdOYW1lKSkKICAg\nICAgICAgICAgX2luY2x1ZGVzLmFkZChmZ05hbWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWZmaXJtcyBpZiBnaXZlbiBmZXRjaCBncm91cCBpcyBpbmNs\ndWRlZCBieSB0aGlzIHJlY2VpdmVyLiAgSW5jbHVkZXMKICAgICAqIHN1cGVy\nY2xhc3MgZGVmaW5pdGlvbiBvZiBmZXRjaCBncm91cCBhbmQgb3B0aW9uYWxs\neSBvdGhlciBpbmNsdWRlZCAKICAgICAqIGdyb3Vwcy4KICAgICAqCiAgICAg\nKiBAcGFyYW0gcmVjdXJzZSBpZiB0cnVlIHRoZW4gcmVjdXJzaXZlbHkgY2hl\nY2tzIHdpdGhpbiB0aGUgaW5jbHVkZWQKICAgICAqIGZlY3RoIGdyb3Vwcwog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpbmNsdWRlcyhTdHJpbmcgZmdO\nYW1lLCBib29sZWFuIHJlY3Vyc2UpIHsKICAgICAgICAvLyBjaGVjayBvdXIg\naW5jbHVkZXMKICAgICAgICBpZiAoX2luY2x1ZGVzICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF9pbmNsdWRlcy5jb250YWlucyhmZ05hbWUpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChyZWN1\ncnNlICYmIF9tZXRhIT1udWxsKSB7CiAgICAgICAgICAgICAgICBGZXRjaEdy\nb3VwIGZnOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpID0gX2lu\nY2x1ZGVzLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgICAgIGZnID0gX21ldGEuZ2V0RmV0Y2hHcm91cCgoU3RyaW5nKSBp\nLm5leHQoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZnICE9IG51bGwg\nJiYgZmcuaW5jbHVkZXMoZmdOYW1lLCB0cnVlKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9tZXRhICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gY2hlY2sgc3VwZXJjbGFzcyBpbmNsdWRlcwog\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IF9tZXRhLmdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgRmV0Y2hHcm91cCBzdXBGRyA9IHN1cC5n\nZXRGZXRjaEdyb3VwKF9uYW1lKTsKICAgICAgICAgICAgICAgIGlmIChzdXBG\nRyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBGRy5p\nbmNsdWRlcyhmZ05hbWUsIHJlY3Vyc2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBBZGRzIHRoaXMgcmVjZWl2ZXIgYXMgb25lIG9mIHRoZSBpbmNs\ndWRlZCBmZXRjaCBncm91cHMgb2YgdGhlIGdpdmVuCiAgICAgKiBwYXJlbnQu\nIAogICAgICogVGhlIHBhcmVudCBmZWN0aCBncm91cCB3aWxsIGluY2x1ZGUg\ndGhpcyByZWNlaXZlciBhcyBhIHNpZGUtZWZmZWN0IG9mCiAgICAgKiB0aGlz\nIGNhbGwuCiAgICAgKiAKICAgICAqIEBzZWUgI2luY2x1ZGVzKFN0cmluZywg\nYm9vbGVhbikKICAgICAqIEBzZWUgI2FkZERlY2xhcmVkSW5jbHVkZShTdHJp\nbmcpIAogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgZ2l2ZW4gcGFy\nZW50IGlzIGEgbmV3IGFkZGl0aW9uLiBmYWxzZSBvdGhyd2lzZS4KICAgICAq\nIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBhZGRD\nb250YWluZWRCeShGZXRjaEdyb3VwIHBhcmVudCkgewogICAgCXBhcmVudC5h\nZGREZWNsYXJlZEluY2x1ZGUodGhpcy5nZXROYW1lKCkpOwogICAgCWlmIChf\nY29udGFpbmVkQnk9PW51bGwpCiAgICAJCV9jb250YWluZWRCeSA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAJcmV0dXJuIF9jb250YWluZWRCeS5hZGQocGFyZW50\nLmdldE5hbWUoKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0\naGUgbmFtZSBvZiB0aGUgZmV0Y2ggZ3JvdXBzIGluIHdoaWNoIHRoaXMgcmVj\nZWl2ZXIgaGFzIGJlZW4KICAgICAqIGluY2x1ZGVkLgogICAgICogCiAgICAg\nKiBAc2VlICNhZGRDb250YWluZWRCeShGZXRjaEdyb3VwKQogICAgICogQHNp\nbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBTZXQgZ2V0Q29udGFpbmVk\nQnkoKSB7CiAgICAJcmV0dXJuIChfY29udGFpbmVkQnkgPT0gbnVsbCkgPyBD\nb2xsZWN0aW9ucy5FTVBUWV9TRVQgOgogICAgICAgICAgICBDb2xsZWN0aW9u\ncy51bm1vZGlmaWFibGVTZXQoX2NvbnRhaW5lZEJ5KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZmV0Y2ggZ3JvdXAgbmFtZXMgZGVjbGFy\nZWQgaW5jbHVkZWQgYnkgdGhpcyBncm91cC4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZ1tdIGdldERlY2xhcmVkSW5jbHVkZXMoKSB7CiAgICAgICAgLy8g\nb25seSB1c2VkIGR1cmluZyBzZXJpYWxpemF0aW9uOyBubyBuZWVkIHRvIGNh\nY2hlCiAgICAgICAgcmV0dXJuIChfaW5jbHVkZXMgPT0gbnVsbCkgPyBuZXcg\nU3RyaW5nWzBdCiAgICAgICAgICAgIDogKFN0cmluZ1tdKSBfaW5jbHVkZXMu\ndG9BcnJheShuZXcgU3RyaW5nW19pbmNsdWRlcy5zaXplKCldKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlY3Vyc2lvbiBkZXB0aCBmb3IgdGhlIGdpdmVu\nIGZpZWxkLiAgVGhpcyBpcyB0aGUgZGVwdGggb2YgcmVsYXRpb25zIG9mCiAg\nICAgKiB0aGUgc2FtZSBjbGFzcyBhcyB0aGlzIG9uZSB3ZSBjYW4gZmV0Y2gg\ndGhyb3VnaCB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldFJlY3Vyc2lvbkRlcHRoKEZpZWxkTWV0YURhdGEgZm0sIGludCBk\nZXB0aCkgewogICAgICAgIGlmIChfcmVhZE9ubHkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAg\nICAgIGlmIChkZXB0aCA8IC0xKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQtZmctZGVwdGgiLCBf\nbmFtZSwgZm0sIAogICAgICAgICAgICAgICAgZGVwdGgpKTsKICAgICAgICBp\nZiAoX2RlcHRocyA9PSBudWxsKQogICAgICAgICAgICBfZGVwdGhzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfZGVwdGhzLnB1dChmbSwgZGVwdGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVjdXJzaW9uIGRlcHRoIGZvciB0aGUg\nZ2l2ZW4gZmllbGQuICBUaGlzIGlzIHRoZSBkZXB0aCBvZiByZWxhdGlvbnMg\nb2YKICAgICAqIHRoZSBzYW1lIGNsYXNzIGFzIHRoaXMgb25lIHdlIGNhbiBm\nZXRjaCB0aHJvdWdoIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHVi\nbGljIGludCBnZXRSZWN1cnNpb25EZXB0aChGaWVsZE1ldGFEYXRhIGZtKSB7\nCiAgICAgICAgTnVtYmVyIGRlcHRoID0gZmluZFJlY3Vyc2lvbkRlcHRoKGZt\nKTsKICAgICAgICByZXR1cm4gKGRlcHRoID09IG51bGwpID8gUkVDVVJTSU9O\nX0RFUFRIX0RFRkFVTFQgOiBkZXB0aC5pbnRWYWx1ZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSByZWN1cnNpb24gZGVwdGggZGVjbGFy\nZWQgZm9yIHRoZSBnaXZlbiBmaWVsZCwgb3IgCiAgICAgKiAwIGlmIG5vbmUu\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RGVjbGFyZWRSZWN1cnNpb25E\nZXB0aChGaWVsZE1ldGFEYXRhIGZtKSB7CiAgICAgICAgTnVtYmVyIGRlcHRo\nID0gKF9kZXB0aHMgPT0gbnVsbCkgPyBudWxsIDogKE51bWJlcikgX2RlcHRo\ncy5nZXQoZm0pOwogICAgICAgIHJldHVybiAoZGVwdGggPT0gbnVsbCkgPyAw\nIDogZGVwdGguaW50VmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciB0byBmaW5kIHJlY3Vyc2lvbiBkZXB0aCByZWN1cnNpdmVseSBpbiBv\ndXIgaW5jbHVkZXMuCiAgICAgKi8KICAgIHByaXZhdGUgTnVtYmVyIGZpbmRS\nZWN1cnNpb25EZXB0aChGaWVsZE1ldGFEYXRhIGZtKSB7IAogICAgICAgIE51\nbWJlciBkZXB0aCA9IChfZGVwdGhzID09IG51bGwpID8gbnVsbCA6IChOdW1i\nZXIpIF9kZXB0aHMuZ2V0KGZtKTsKICAgICAgICBpZiAoZGVwdGggIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGRlcHRoOwoKICAgICAgICAvLyBjaGVj\nayBmb3Igc3VwZXJjbGFzcyBkZWNsYXJhdGlvbiBvZiBkZXB0aAogICAgICAg\nIE51bWJlciBtYXggPSBudWxsOwogICAgICAgIGlmIChfbWV0YSAhPSBudWxs\nICYmIGZtLmdldERlY2xhcmluZ01ldGFEYXRhKCkgIT0gX21ldGEpIHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBfbWV0YS5nZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIEZldGNoR3JvdXAgc3VwRkcgPSBzdXAuZ2V0\nRmV0Y2hHcm91cChfbmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoc3VwRkcg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBtYXggPSBzdXBGRy5maW5k\nUmVjdXJzaW9uRGVwdGgoZm0pOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGlmIChfaW5jbHVkZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG1heDsKCiAgICAgICAgLy8gZmluZCBsYXJnZXN0IGluY2x1ZGVkIGRl\ncHRoCiAgICAgICAgRmV0Y2hHcm91cCBmZzsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IF9pbmNsdWRlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBmZyA9IF9tZXRhLmdldEZldGNoR3JvdXAoKFN0\ncmluZykgaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGRlcHRoID0gKGZnID09\nIG51bGwpID8gbnVsbCA6IGZnLmZpbmRSZWN1cnNpb25EZXB0aChmbSk7CiAg\nICAgICAgICAgIGlmIChkZXB0aCAhPSBudWxsICYmIChtYXggPT0gbnVsbCAK\nICAgICAgICAgICAgICAgIHx8IGRlcHRoLmludFZhbHVlKCkgPiBtYXguaW50\nVmFsdWUoKSkpCiAgICAgICAgICAgICAgICBtYXggPSBkZXB0aDsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG1heDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZmllbGRzIHdpdGggZGVjbGFyZWQgcmVjdXJzaW9uIGRl\ncHRocyBpbiB0aGlzIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YVtdIGdldERlY2xhcmVkUmVjdXJzaW9uRGVwdGhGaWVsZHMoKSB7\nCiAgICAgICAgLy8gdXNlZCBpbiBzZXJpYWxpemF0aW9uIG9ubHk7IG5vIG5l\nZWQgdG8gY2FjaGUKICAgICAgICBpZiAoX2RlcHRocyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWV0YURhdGFbMF07CiAgICAgICAg\nIHJldHVybiAoRmllbGRNZXRhRGF0YVtdKSBfZGVwdGhzLmtleVNldCgpLnRv\nQXJyYXkKICAgICAgICAgICAgKG5ldyBGaWVsZE1ldGFEYXRhW19kZXB0aHMu\nc2l6ZSgpXSk7CiAgICB9IAoKICAgIC8qKgogICAgICogV2hldGhlciBsb2Fk\naW5nIHRoaXMgZmV0Y2ggZ3JvdXAgY2F1c2VzIGEgcG9zdC1sb2FkIGNhbGxi\nYWNrIG9uIHRoZQogICAgICogbG9hZGVkIGluc3RhbmNlLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRQb3N0TG9hZCAoYm9vbGVhbiBmbGFnKSB7CiAg\nICAgICAgaWYgKF9yZWFkT25seSAmJiBmbGFnICE9IGlzUG9zdExvYWQoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhj\nZXB0aW9uKCk7CiAgICAJX3Bvc3RMb2FkID0gKGZsYWcpID8gQm9vbGVhbi5U\nUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgbG9hZGluZyB0aGlzIGZldGNoIGdyb3VwIGNhdXNlcyBhIHBvc3Qt\nbG9hZCBjYWxsYmFjayBvbiB0aGUKICAgICAqIGxvYWRlZCBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNQb3N0TG9hZCAoKSB7CiAg\nICAJaWYgKF9wb3N0TG9hZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nX3Bvc3RMb2FkLmJvb2xlYW5WYWx1ZSgpOwoKICAgICAgICBpZiAoX21ldGEg\nIT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IF9t\nZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlm\nIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgRmV0Y2hHcm91cCBz\ndXBGRyA9IHN1cC5nZXRGZXRjaEdyb3VwKF9uYW1lKTsKICAgICAgICAgICAg\nICAgIGlmIChzdXBGRyAhPSBudWxsICYmIHN1cEZHLmlzUG9zdExvYWQoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKF9pbmNsdWRlcyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgRmV0Y2hHcm91cCBm\nZzsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9pbmNsdWRlcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBmZyA9IF9t\nZXRhLmdldEZldGNoR3JvdXAoKFN0cmluZykgaXRyLm5leHQoKSk7CiAgICAg\nICAgICAgIGlmIChmZyAhPSBudWxsICYmIGZnLmlzUG9zdExvYWQoKSkKICAg\nICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\nZSBwb3N0LWxvYWQgdmFsdWUgaXMgZGVjbGFyZWQgZm9yIHRoaXMgZ3JvdXAu\nICAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNQb3N0TG9hZEV4cGxp\nY2l0KCkgewogICAgICAgIHJldHVybiBfcG9zdExvYWQgIT0gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgYW5kIHZhbGlkYXRlIGZldGNo\nIGdyb3VwIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZXNv\nbHZlKCkgewogICAgICAgIGlmIChfaW5jbHVkZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAvLyB2YWxpZGF0ZSBpbmNsdWRlcwog\nICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIEZldGNoR3JvdXAgZmc7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfaW5jbHVkZXMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgbmFtZSA9IChTdHJp\nbmcpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChuYW1lLmVxdWFscyhf\nbmFtZSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImN5Y2xpYy1mZyIsIHRoaXMsIG5hbWUpKTsKICAg\nICAgICAgICAgZmcgPSBfbWV0YS5nZXRGZXRjaEdyb3VwKG5hbWUpOwogICAg\nICAgICAgICBpZiAoZmcgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWZnLWluY2x1\nZGUiLCB0aGlzLAogICAgICAgICAgICAgICAgICAgIG5hbWUpKTsKICAgICAg\nICAgICAgaWYgKGZnLmluY2x1ZGVzKF9uYW1lLCB0cnVlKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nY3ljbGljLWZnIiwgdGhpcywgbmFtZSkpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIGVxdWFsaXR5IGlmIHRoZSBvdGhl\nciBoYXMgdGhlIHNhbWUgbmFtZSBhbmQgZGVjbGFyaW5nIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsK\nICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBGZXRjaEdy\nb3VwKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIEZldGNo\nR3JvdXAgdGhhdCA9IChGZXRjaEdyb3VwKSBvdGhlcjsKICAgICAgICByZXR1\ncm4gX25hbWUuZXF1YWxzKHRoYXQuX25hbWUpCiAgICAgICAgICAgICYmIE9i\namVjdFV0aWxzLmVxdWFscyhfbWV0YSwgdGhhdC5fbWV0YSk7CiAgICB9Cgog\nICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gX25h\nbWUuaGFzaENvZGUoKSArICgoX21ldGEgPT0gbnVsbCkgPyAwIDogX21ldGEu\naGFzaENvZGUoKSk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmlu\nZygpIHsKICAgICAgICByZXR1cm4gKChfbWV0YSA9PSBudWxsKSA/ICJCdWls\ndGluIiA6IF9tZXRhLnRvU3RyaW5nICgpKSArICIuIiArIF9uYW1lOwogICAg\nfQp9Cg==\n","encoding":"base64"}

