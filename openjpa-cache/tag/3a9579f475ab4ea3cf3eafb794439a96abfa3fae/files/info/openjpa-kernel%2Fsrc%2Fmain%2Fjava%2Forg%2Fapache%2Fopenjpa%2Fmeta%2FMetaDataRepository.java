{"sha":"9260d6ae7d5d933031e8a31132319413aee7510b","node_id":"MDQ6QmxvYjIwNjM2NDo5MjYwZDZhZTdkNWQ5MzMwMzFlOGEzMTEzMjMxOTQxM2FlZTc1MTBi","size":95815,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9260d6ae7d5d933031e8a31132319413aee7510b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlRyZWVTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3Ry\neS5SZWdpc3RlckNsYXNzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTXVsdGlDbGFz\nc0xvYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlN0\ncmluZ0Rpc3RhbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PcGVuSlBBSWQ7CgppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7\nCgovKioKICogUmVwb3NpdG9yeSBvZiBhbmQgZmFjdG9yeSBmb3IgcGVyc2lz\ndGVudCBtZXRhZGF0YS4KICogCiAqIEBzaW5jZSAwLjMuMAogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbSAocXVlcnkgbWV0YWRh\ndGEpCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNs\nYXNzIE1ldGFEYXRhUmVwb3NpdG9yeSBpbXBsZW1lbnRzIFBDUmVnaXN0cnku\nUmVnaXN0ZXJDbGFzc0xpc3RlbmVyLCBDb25maWd1cmFibGUsIENsb3NlYWJs\nZSwgTWV0YURhdGFNb2RlcywKICAgIFNlcmlhbGl6YWJsZSB7CgogICAgLyoq\nCiAgICAgKiBDb25zdGFudCB0byBub3QgdmFsaWRhdGUgYW55IG1ldGFkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFU\nRV9OT05FID0gMDsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlk\nYXRlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBWQUxJREFURV9NRVRBID0gMTsKCiAgICAvKioKICAgICAqIEJpdCBm\nbGFnIHRvIHZhbGlkYXRlIG1hcHBpbmdzLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9NQVBQSU5HID0gMjsKCiAgICAv\nKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlkYXRlIHVuZW5oYW5jZWQgbWV0\nYWRhdGEgb25seS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgVkFMSURBVEVfVU5FTkhBTkNFRCA9IDQ7CgogICAgLyoqCiAgICAgKiBC\naXQgZmxhZyBmb3IgcnVudGltZSB2YWxpZGF0aW9uLiBSZXF1aXJlcyB0aGF0\nIGFsbCBjbGFzc2VzIGFyZSBlbmhhbmNlZCwgYW5kIHBlcmZvcm1zIGV4dHJh\nCiAgICAgKiBmaWVsZCByZXNvbHV0aW9uIHN0ZXBzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9SVU5USU1FID0gODsK\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzPD8+W10gRU1QVFlf\nQ0xBU1NFUyA9IG5ldyBDbGFzc1swXTsKICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gRU1QVFlfTk9OX1BFUlNJ\nU1RFTlQgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhWzBdOwogICAgcHJv\ndGVjdGVkIGZpbmFsIENsYXNzTWV0YURhdGFbXSBFTVBUWV9NRVRBUzsKICAg\nIHByb3RlY3RlZCBmaW5hbCBGaWVsZE1ldGFEYXRhW10gRU1QVFlfRklFTERT\nOwogICAgcHJvdGVjdGVkIGZpbmFsIE9yZGVyW10gRU1QVFlfT1JERVJTOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyLmZvclBhY2thZ2UoTWV0YURhdGFSZXBvc2l0b3J5LmNsYXNzKTsK\nCiAgICAvLyBzeXN0ZW0gc2VxdWVuY2UKICAgIHByaXZhdGUgU2VxdWVuY2VN\nZXRhRGF0YSBfc3lzU2VxID0gbnVsbDsKICAgIC8vIGNhY2hlIG9mIHBhcnNl\nZCBtZXRhZGF0YSwgb2lkIGNsYXNzIHRvIGNsYXNzLCBhbmQgaW50ZXJmYWNl\nIGNsYXNzCiAgICAvLyB0byBtZXRhZGF0YXMKICAgIHByaXZhdGUgTWFwPENs\nYXNzPD8+LCBDbGFzc01ldGFEYXRhPiBfbWV0YXMgPSBuZXcgSGFzaE1hcDxD\nbGFzczw/PiwgQ2xhc3NNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPENs\nYXNzPD8+LCBDbGFzczw/Pj4gX29pZHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJv\nbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNzPD8+PigpKTsK\nICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBDb2xsZWN0aW9uPENsYXNzPD8+\nPj4gX2ltcGxzID0KICAgICAgICBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRN\nYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENvbGxlY3Rpb248Q2xhc3M8Pz4+\nPigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBDbGFzczw/Pj4gX2lm\nYWNlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+KCkpOwogICAgcHJpdmF0ZSBNYXA8T2Jq\nZWN0LCBRdWVyeU1ldGFEYXRhPiBfcXVlcmllcyA9IG5ldyBIYXNoTWFwPE9i\namVjdCwgUXVlcnlNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPFN0cmlu\nZywgU2VxdWVuY2VNZXRhRGF0YT4gX3NlcXMgPSBuZXcgSGFzaE1hcDxTdHJp\nbmcsIFNlcXVlbmNlTWV0YURhdGE+KCk7CiAgICBwcml2YXRlIE1hcDxTdHJp\nbmcsIExpc3Q8Q2xhc3M8Pz4+PiBfYWxpYXNlcyA9IENvbGxlY3Rpb25zLnN5\nbmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxTdHJpbmcsIExpc3Q8Q2xhc3M8\nPz4+PigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBOb25QZXJzaXN0\nZW50TWV0YURhdGE+IF9wYXdhcmVzID0KICAgICAgICBDb2xsZWN0aW9ucy5z\neW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YT4oKSk7CiAgICBwcml2YXRlIE1hcDxDbGFzczw/Piwg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhPiBfbm9uTWFwcGVkID0KICAgICAgICBD\nb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8\nPz4sIE5vblBlcnNpc3RlbnRNZXRhRGF0YT4oKSk7CiAgICBwcml2YXRlIE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+IF9tZXRhbW9kZWwgPSBDb2xsZWN0aW9u\ncy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNz\nPD8+PigpKTsKCiAgICAvLyBtYXAgb2YgY2xhc3NlcyB0byBsaXN0cyBvZiB0\naGVpciBzdWJjbGFzc2VzCiAgICBwcml2YXRlIE1hcDxDbGFzczw/PiwgTGlz\ndDxDbGFzczw/Pj4+IF9zdWJzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVk\nTWFwKG5ldyBIYXNoTWFwPENsYXNzPD8+LCBMaXN0PENsYXNzPD8+Pj4oKSk7\nCgogICAgLy8geG1sIG1hcHBpbmcKICAgIHByb3RlY3RlZCBmaW5hbCBYTUxN\nZXRhRGF0YVtdIEVNUFRZX1hNTE1FVEFTOwogICAgcHJpdmF0ZSBmaW5hbCBN\nYXA8Q2xhc3M8Pz4sIFhNTE1ldGFEYXRhPiBfeG1sbWV0YXMgPSBuZXcgSGFz\naE1hcDxDbGFzczw/PiwgWE1MTWV0YURhdGE+KCk7CgogICAgcHJpdmF0ZSB0\ncmFuc2llbnQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmYgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxsOwogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBfaW1wbEdl\nbiA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBNZXRhRGF0YUZhY3Rv\ncnkgX2ZhY3RvcnkgPSBudWxsOwoKICAgIHByaXZhdGUgaW50IF9yZXNNb2Rl\nID0gTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HOwogICAgcHJpdmF0ZSBpbnQg\nX3NvdXJjZU1vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RF\nX1FVRVJZOwogICAgcHJpdmF0ZSBpbnQgX3ZhbGlkYXRlID0gVkFMSURBVEVf\nTUVUQSB8IFZBTElEQVRFX1VORU5IQU5DRUQ7CgogICAgLy8gd2UgYnVmZmVy\nIHVwIGFueSBjbGFzc2VzIHRoYXQgcmVnaXN0ZXIgdGhlbXNlbHZlcyB0byBw\ncmV2ZW50CiAgICAvLyByZWVudHJhbmN5IGVycm9ycyBpZiBjbGFzc2VzIHJl\nZ2lzdGVyIGR1cmluZyBhIGN1cnJlbnQgcGFyc2UgKGNvbW1vbikKICAgIHBy\naXZhdGUgZmluYWwgQ29sbGVjdGlvbjxDbGFzczw/Pj4gX3JlZ2lzdGVyZWQg\nPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4oKTsKCiAgICAvLyBzZXQgb2YgbWV0\nYWRhdGFzIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAg\ncHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3Qg\nX3Jlc29sdmluZyA9IG5ldyBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxp\nc3QoKTsKICAgIHByaXZhdGUgZmluYWwgSW5oZXJpdGFuY2VPcmRlcmVkTWV0\nYURhdGFMaXN0IF9tYXBwaW5nID0gbmV3IEluaGVyaXRhbmNlT3JkZXJlZE1l\ndGFEYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBMaXN0PFJ1bnRpbWVF\neGNlcHRpb24+IF9lcnJzID0gbmV3IExpbmtlZExpc3Q8UnVudGltZUV4Y2Vw\ndGlvbj4oKTsKCiAgICAvLyBzeXN0ZW0gbGlzdGVuZXJzCiAgICBwcml2YXRl\nIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgX2xpc3RlbmVy\ncyA9IG5ldyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KDMp\nOwoKICAgIHByb3RlY3RlZCBib29sZWFuIF9wcmVsb2FkID0gZmFsc2U7CiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBfcHJlbG9hZENvbXBsZXRlID0gZmFsc2U7\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBfbG9ja2luZyA9IHRydWU7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUFJFTE9BRF9TVFIgPSAiUHJl\nbG9hZCI7CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVvcmRlck1ldGFE\nYXRhUmVzb2x1dGlvbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICogRGVmYXVs\ndCBjb25zdHJ1Y3Rvci4gQ29uZmlndXJlIHZpYSB7QGxpbmsgQ29uZmlndXJh\nYmxlfS4KICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSgp\nIHsKICAgICAgICBFTVBUWV9NRVRBUyA9IG5ld0NsYXNzTWV0YURhdGFBcnJh\neSgwKTsKICAgICAgICBFTVBUWV9GSUVMRFMgPSBuZXdGaWVsZE1ldGFEYXRh\nQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfT1JERVJTID0gbmV3T3JkZXJBcnJh\neSgwKTsKICAgICAgICBFTVBUWV9YTUxNRVRBUyA9IG5ld1hNTENsYXNzTWV0\nYURhdGFBcnJheSgwKTsKICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgY29uZmlndXJhdGlvbiBmb3IgdGhlIHJlcG9zaXRvcnku\nCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgbG9nLgogICAg\nICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4g\nX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBJL08gdXNlZCB0byBs\nb2FkIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFGYWN0\nb3J5IGdldE1ldGFEYXRhRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2Zh\nY3Rvcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgSS9PIHVzZWQgdG8g\nbG9hZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWV0\nYURhdGFGYWN0b3J5KE1ldGFEYXRhRmFjdG9yeSBmYWN0b3J5KSB7CiAgICAg\nICAgZmFjdG9yeS5zZXRSZXBvc2l0b3J5KHRoaXMpOwogICAgICAgIF9mYWN0\nb3J5ID0gZmFjdG9yeTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0byA8Y29kZT5WQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0VmFsaWRhdGUoKSB7CiAgICAgICAgcmV0\ndXJuIF92YWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0byA8Y29kZT5WQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRlKGludCB2YWxpZGF0ZSkg\newogICAgICAgIF92YWxpZGF0ZSA9IHZhbGlkYXRlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1\nbHRzIHRvCiAgICAgKiA8Y29kZT5WQUxJREFURV9NRVRBIHwgVkFMSURBVEVf\nTUFQUElORyB8IFZBTElEQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRWYWxpZGF0ZShpbnQgdmFsaWRhdGUsIGJv\nb2xlYW4gb24pIHsKICAgICAgICBpZiAodmFsaWRhdGUgPT0gVkFMSURBVEVf\nTk9ORSkKICAgICAgICAgICAgX3ZhbGlkYXRlID0gdmFsaWRhdGU7CiAgICAg\nICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF92YWxpZGF0ZSB8PSB2YWxp\nZGF0ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF92YWxpZGF0ZSAmPSB+\ndmFsaWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEg\ncmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0cyB0byA8Y29kZT5NT0RFX01FVEEg\nfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRpb24gbW9k\nZS4gRGVmYXVsdHMgdG8gPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5H\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShp\nbnQgbW9kZSkgewogICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERl\nZmF1bHRzIHRvIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1v\nZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05P\nTkUpCiAgICAgICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9yZXNNb2RlICY9IH5tb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdo\nYXQgbWV0YWRhdGEgdG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2Rl\nPk1PREVfTUVUQSB8IE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9zb3VyY2VNb2RlOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEg\ndG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8\nIE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAg\nICAgX3NvdXJjZU1vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEgdG8g\nbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1P\nREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfc291cmNlTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAg\nICAgICAgICAgIF9zb3VyY2VNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfc291cmNlTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldHMgd2hldGhlciB0aGlzIHJlcG9zaXRvcnkgd2lsbCBs\nb2FkIGFsbCBrbm93biBwZXJzaXN0ZW50IGNsYXNzZXMgYXQgaW5pdGlhbGl6\nYXRpb24uCiAgICAgKiBEZWZhdWx0cyB0byBmYWxzZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0UHJlbG9hZCgpIHsKICAgICAgICByZXR1cm4g\nX3ByZWxvYWQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB3aGV0\naGVyIHRoaXMgcmVwb3NpdG9yeSB3aWxsIGxvYWQgYWxsIGtub3duIHBlcnNp\nc3RlbnQgY2xhc3NlcyBhdCBpbml0aWFsaXphdGlvbi4KICAgICAqIERlZmF1\nbHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmVs\nb2FkKGJvb2xlYW4gbCkgewogICAgICAgIF9wcmVsb2FkID0gbDsKICAgIH0K\nCgogICAgIC8qKgogICAgICogSWYgdGhlIG9wZW5qcGEuTWV0YURhdGFSZXBv\nc2l0b3J5IHBsdWdpbiB2YWx1ZSBQcmVsb2FkPXRydWUgaXMgc2V0LCB0aGlz\nIG1ldGhvZCB3aWxsIGxvYWQgYWxsCiAgICAgKiBNZXRhRGF0YSBmb3IgYWxs\nIHBlcnNpc3RlbnQgY2xhc3NlcyBhbmQgd2lsbCByZW1vdmUgbG9ja2luZyBm\ncm9tIHRoaXMgY2xhc3MuIAogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIHZvaWQgcHJlbG9hZCgpIHsKICAgICAgICBpZiAoX3ByZWxvYWQgPT0g\nZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAg\nICAvLyBJZiBwb29saW5nIEVNRnMsIHRoaXMgbWV0aG9kIG1heSBiZSBpbnZv\na2VkIG1vcmUgdGhhbiBvbmNlLiBPbmx5IHBlcmZvcm0gdGhpcyB3b3JrIG9u\nY2UuCiAgICAgICAgaWYgKF9wcmVsb2FkQ29tcGxldGUgPT0gdHJ1ZSkgewog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNdWx0aUNs\nYXNzTG9hZGVyIG11bHRpID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIubmV3TXVsdGlDbGFzc0xvYWRlckFjdGlvbigp\nKTsKICAgICAgICBtdWx0aS5hZGRDbGFzc0xvYWRlcihBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xh\nc3NMb2FkZXJBY3Rpb24oKSkpOwogICAgICAgIG11bHRpLmFkZENsYXNzTG9h\nZGVyKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgIC5nZXRDbGFzc0xvYWRlckFjdGlvbihNZXRhRGF0\nYVJlcG9zaXRvcnkuY2xhc3MpKSk7CgogICAgICAgIFNldDxTdHJpbmc+IGNs\nYXNzZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBtdWx0aSk7\nCiAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCB8fCBjbGFzc2VzLnNpemUo\nKSA9PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVhZ2VyLW5vbmUiKSk7\nCiAgICAgICAgfQogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkg\nPT0gdHJ1ZSkgewogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJy\nZXBvcy1pbml0aWFsaXplRWFnZXItZm91bmQiLCBjbGFzc2VzKSk7CiAgICAg\nICAgfQoKICAgICAgICBMaXN0PENsYXNzPD8+PiBsb2FkZWQgPSBuZXcgQXJy\nYXlMaXN0PENsYXNzPD8+PigpOwogICAgICAgIGZvciAoU3RyaW5nIGMgOiBj\nbGFzc2VzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBD\nbGFzczw/PiBjbHMgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgo\nSjJEb1ByaXZIZWxwZXIuZ2V0Rm9yTmFtZUFjdGlvbihjLCB0cnVlLCBtdWx0\naSkpKTsKICAgICAgICAgICAgICAgIGxvYWRlZC5hZGQoY2xzKTsKICAgICAg\nICAgICAgICAgIC8vIFRoaXMgY2FsbCBtYXkgYmUgdW5uZWNlc3Nhcnk/CiAg\nICAgICAgICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywgTU9ERV9BTEwsIG11\nbHRpKTsKICAgICAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4\nY2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVhZ2Vy\nLWVycm9yIiksIHBhZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmVzb2x2ZUFsbChtdWx0aSk7CgogICAgICAgIC8vIEhvb2sgaW4gdGhp\ncyBjbGFzcyBhcyBhIGxpc3RlbmVyIGFuZCBwcm9jZXNzIHJlZ2lzdGVyZWQg\nY2xhc3NlcyBsaXN0IHRvIHBvcHVsYXRlIF9hbGlhc2VzCiAgICAgICAgLy8g\nbGlzdC4KICAgICAgICBQQ1JlZ2lzdHJ5LmFkZFJlZ2lzdGVyQ2xhc3NMaXN0\nZW5lcih0aGlzKTsKICAgICAgICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMo\nbXVsdGkpOwogICAgICAgIF9sb2NraW5nID0gZmFsc2U7CiAgICAgICAgX3By\nZWxvYWRDb21wbGV0ZSA9IHRydWU7CiAgICB9CgogICAgCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4K\nICAgICAqIAogICAgICogQHBhcmFtIGNscwogICAgICogICAgICAgICAgICB0\naGUgY2xhc3MgdG8gcmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFy\nYW0gZW52TG9hZGVyCiAgICAgKiAgICAgICAgICAgIHRoZSBlbnZpcm9ubWVu\ndGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVzdEV4\naXN0CiAgICAgKiAgICAgICAgICAgIGlmIHRydWUsIHRocm93cyBhIHtAbGlu\nayBNZXRhRGF0YUV4Y2VwdGlvbn0gaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4g\nbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCh0aGlzKXsKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9hZGVyLCBtdXN0RXhp\nc3QpOyAgICAKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJldHVybiBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9h\nZGVyLCBtdXN0RXhpc3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGFJbnRlcm5hbChDbGFzczw/PiBj\nbHMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3Qp\nIHsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsICYmIER5bmFtaWNQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQog\nICAgICAgICAgICAgICAgY2xzID0gY2xzLmdldFN1cGVyY2xhc3MoKTsKCiAg\nICAgICAgICAgIC8vIGlmIGNscyBpcyBhIGdlbmVyYXRlZCBpbnRlcmZhY2Us\nIHVzZSB0aGUgdXNlciBpbnRlcmZhY2UKICAgICAgICAgICAgLy8gdG8gbG9j\nYXRlIG1ldGFkYXRhCiAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBf\naW1wbEdlbiAhPSBudWxsICYmIF9pbXBsR2VuLmlzSW1wbFR5cGUoY2xzKSkK\nICAgICAgICAgICAgICAgIGNscyA9IF9pbXBsR2VuLnRvTWFuYWdlZEludGVy\nZmFjZShjbHMpOwoKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVudkxvYWRlcik7CiAgICAgICAg\nICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KSB7CiAgICAgICAg\nICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgIUltcGxIZWxwZXIuaXNNYW5h\nZ2VkVHlwZShfY29uZiwgY2xzKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEtbm90\ncGMiLCBjbHMpKS5zZXRGYXRhbChmYWxzZSk7CgogICAgICAgICAgICAgICAg\nU2V0PFN0cmluZz4gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMo\nZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgICAgICAgICBpZiAocGNOYW1l\ncyAhPSBudWxsICYmIHBjTmFtZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW1ldGEtdHlwZXMiLCBjbHMsIHBjTmFtZXMpKTsKCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLW1ldGEiLCBjbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNv\nbHZlKG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZl\nbiBhbGlhcyBuYW1lLgogICAgICogCiAgICAgKiBAcGFyYW0gYWxpYXMKICAg\nICAqICAgICAgICAgICAgdGhlIGFsaWFzIHRvIGNsYXNzIHRvIHJldHJpZXZl\nIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICog\nICAgICAgICAgICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlm\nIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAgICAgICAg\nICBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259\nIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKiBAc2VlIENsYXNzTWV0\nYURhdGEjZ2V0VHlwZUFsaWFzCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhKFN0cmluZyBhbGlhcywgQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChh\nbGlhcyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRh\nIiwgYWxpYXMsIF9hbGlhc2VzKSk7CiAgICAgICAgaWYgKGFsaWFzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVj\nayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZM\nb2FkZXIpOwogICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNzTGlzdCA9IF9h\nbGlhc2VzLmdldChhbGlhcyk7CgogICAgICAgIC8vIG11bHRpcGxlIGNsYXNz\nZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVkIHdpdGggdGhlIHNhbWUgYWxpYXM6\nIHdlCiAgICAgICAgLy8gd2lsbCBmaWx0ZXIgYnkgY2hlY2tpbmcgYWdhaW5z\ndCB0aGUgY3VycmVudCBsaXN0IG9mIHRoZQogICAgICAgIC8vIHBlcnNpc3Rl\nbnQgdHlwZXMgYW5kIGZpbHRlciBiYXNlZCBvbiB3aGljaCBjbGFzc2VzIGFy\nZSBsb2FkYWJsZQogICAgICAgIC8vIHZpYSB0aGUgY3VycmVudCBlbnZpcm9u\nbWVudCdzIENsYXNzTG9hZGVyCiAgICAgICAgU2V0PFN0cmluZz4gcGNOYW1l\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgQ2xhc3M8Pz4gY2xzID0gbnVsbDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgY2xhc3NMaXN0ICE9IG51bGwgJiYgaSA8IGNsYXNzTGlzdC5z\naXplKCk7IGkrKykgewogICAgICAgICAgICBDbGFzczw/PiBjID0gY2xhc3NM\naXN0LmdldChpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIC8vIHJlLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBjdXJyZW50IGVudmlyb25t\nZW50IGxvYWRlciBzbwogICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBjYW4g\naGFuZGxlIHJlZGVwbG95bWVudCBvZiB0aGUgc2FtZSBjbGFzcyBuYW1lCiAg\nICAgICAgICAgICAgICBDbGFzczw/PiBuYyA9IENsYXNzLmZvck5hbWUoYy5n\nZXROYW1lKCksIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAgICAgICAgICAgICAg\nIC8vIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBvZiBwZXJzaXN0ZW50\nIGNsYXNlcywKICAgICAgICAgICAgICAgIC8vIGFsc28gY2hlY2sgdG8gZW5z\ndXJlIHRoYXQgdGhlIGNsYXNzIGlzIGluIHRoYXQgbGlzdAogICAgICAgICAg\nICAgICAgaWYgKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05hbWVzLnNpemUoKSA9\nPSAwIHx8IHBjTmFtZXMuY29udGFpbnMobmMuZ2V0TmFtZSgpKSkgewogICAg\nICAgICAgICAgICAgICAgIGNscyA9IG5jOwogICAgICAgICAgICAgICAgICAg\nIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNsYXNzTGlzdC5hZGQoY2xzKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMg\naGFwcGVucyB3aGVuIHRoZSBjbGFzcyBpcyBub3QgbG9hZGFibGUgYnkKICAg\nICAgICAgICAgICAgIC8vIHRoZSBlbnZpcm9ubWVudCBjbGFzcyBsb2FkZXIs\nIHNvIGl0IHdhcyBwcm9iYWJseQogICAgICAgICAgICAgICAgLy8gbGlzdGVk\nIGVsc2V3aGVyZTsgYWxzbyBpZ25vcmUgbGlua2FnZSBmYWlsdXJlcyBhbmQK\nICAgICAgICAgICAgICAgIC8vIG90aGVyIGNsYXNzIGxvYWRpbmcgcHJvYmxl\nbXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2xzICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVu\ndkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAgICAgLy8gbWF5YmUgdGhpcyBp\ncyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQganVzdCBpc24ndCB2YWxpZAog\nICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc0tleShhbGlhcykpIHsKICAg\nICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAgICAgICAgIHRocm93\nTm9SZWdpc3RlcmVkQWxpYXMoYWxpYXMpOwogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFdlIG5lZWQgdG8gc3luY2hy\nb25pemUgb24gX2FsaWFzZXMgYmVjYXVzZSBhIENvbmN1cnJlbnRNb2RpZmlj\nYXRpb25FeGNlcHRpb24gY2FuIGlmIHRoZXJlCiAgICAgICAgLy8gaXMgYSB0\naHJlYWQgaW4gZ2V0QWxpYXNOYW1lcygpIEFORCB0aGlzIGNsYXNzIGlzbid0\nIHVzaW5nIGFueSBsb2NraW5nLgogICAgICAgIHN5bmNocm9uaXplZCAoX2Fs\naWFzZXMpIHsKICAgICAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBh\nbiBpbnZhbGlkIHR5cGUKICAgICAgICAgICAgX2FsaWFzZXMucHV0KGFsaWFz\nLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmICghbXVzdEV4aXN0KQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gdGhyb3dO\nb1JlZ2lzdGVyZWRBbGlhcyhhbGlhcyk7CiAgICB9CgogICAgcHJpdmF0ZSBD\nbGFzc01ldGFEYXRhIHRocm93Tm9SZWdpc3RlcmVkQWxpYXMoU3RyaW5nIGFs\naWFzKSB7CiAgICAgICAgU3RyaW5nIGNsb3NlID0gZ2V0Q2xvc2VzdEFsaWFz\nTmFtZShhbGlhcyk7CiAgICAgICAgaWYgKGNsb3NlICE9IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tYWxpYXMtbWV0YS1oaW50IiwgYWxpYXMsIF9hbGlhc2VzLCBjbG9zZSkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsIF9h\nbGlhc2VzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBu\nZWFyZXN0IG1hdGNoIHRvIHRoZSBzcGVjaWZpZWQgYWxpYXMgbmFtZQogICAg\nICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ2xvc2VzdEFsaWFzTmFtZShTdHJpbmcgYWxpYXMpIHsKICAgICAgICBDb2xs\nZWN0aW9uPFN0cmluZz4gYWxpYXNlcyA9IGdldEFsaWFzTmFtZXMoKTsKICAg\nICAgICByZXR1cm4gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0\nZWluRGlzdGFuY2UoYWxpYXMsIGFsaWFzZXMpOwogICAgfQoKICAgIC8qKgog\nICAgICogQHJldHVybiB0aGUgcmVnaXN0ZXJlZCBhbGlhcyBuYW1lcwogICAg\nICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9u\nPFN0cmluZz4gZ2V0QWxpYXNOYW1lcygpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfYWxpYXNlcykgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldEFsaWFzTmFtZXNJbnRlcm5hbCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldEFsaWFzTmFtZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb248U3RyaW5nPiBnZXRB\nbGlhc05hbWVzSW50ZXJuYWwoKSB7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJp\nbmc+IGFsaWFzZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8TWFwLkVudHJ5PFN0cmluZywgTGlzdDxDbGFz\nczw/Pj4+PiBpdGVyID0gX2FsaWFzZXMuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIE1hcC5FbnRy\neTxTdHJpbmcsIExpc3Q8Q2xhc3M8Pz4+PiBlID0gaXRlci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBpZiAoZS5nZXRWYWx1ZSgpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgYWxpYXNlcy5hZGQoZS5nZXRLZXkoKSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBhbGlhc2VzOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGdldCB0aGUgbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcywgd2l0aG91dCByZXNvbHZpbmcgaXQuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YUludGVy\nbmFsKENsYXNzPD8+IGNscywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAg\nICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUgZm9yIGV4aXN0aW5nIG1ldGFk\nYXRhLCBvciBnaXZlIHVwIGlmIG5vIG1ldGFkYXRhIGFuZAogICAgICAgIC8v\nIG91ciBsaXN0IG9mIGNvbmZpZ3VyZWQgcGVyc2lzdGVudCB0eXBlcyBkb2Vz\nbid0IGluY2x1ZGUgdGhlIGNsYXNzCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkg\nJiBNT0RFX01FVEEpICE9IDAgfHwgKF9zb3VyY2VNb2RlICYgTU9ERV9NRVRB\nKSA9PSAwKSkKICAgICAgICAgICAgcmV0dXJuIG1ldGE7CgogICAgICAgIC8v\nIGlmIHJ1bnRpbWUsIGN1dCBvZmYgc2VhcmNoIGlmIG5vdCBpbiBwYyBsaXN0\nLiB3ZSBkb24ndCBkbyB0aGlzIGF0CiAgICAgICAgLy8gZGV2IHRpbWUgc28g\ndGhhdCB1c2VyIGNhbiBtYW5pcHVsYXRlIHBlcnNpc3RlbnQgY2xhc3NlcyBo\nZSdzIHdyaXRpbmcKICAgICAgICAvLyBiZWZvcmUgYWRkaW5nIHRoZW0gdG8g\ndGhlIGxpc3QKICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JV\nTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgU2V0PFN0cmluZz4gcGNOYW1l\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgICAgIGlmIChwY05hbWVzICE9IG51bGwgJiYgIXBjTmFtZXMu\nY29udGFpbnMoY2xzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbWV0YTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIG1heWJlIHdlIGtu\nb3cgdGhpcyBjbGFzcyBoYXMgbm8gbWV0YWRhdGEKICAgICAgICAgICAgaWYg\nKF9tZXRhcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhpcyBpc24n\ndCBhbiBvYnZpb3VzbHkgYmFkIGNsYXNzCiAgICAgICAgICAgIGlmIChjbHMu\naXNQcmltaXRpdmUoKSB8fCBjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImph\ndmEuIikgfHwgY2xzID09IFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gZGVz\naWduZWQgdG8gZ2V0IGFyb3VuZCBqaWtlcyAxLjE3IC8gSkRLMS41IGlzc3Vl\nIHdoZXJlIHN0YXRpYwogICAgICAgICAgICAvLyBpbml0aWFsaXplcnMgYXJl\nIG5vdCBpbnZva2VkIHdoZW4gYSBjbGFzcyBpcyByZWZlcmVuY2VkLCBzbyB0\naGUKICAgICAgICAgICAgLy8gY2xhc3MgbmV2ZXIgcmVnaXN0ZXJzIGl0c2Vs\nZiB3aXRoIHRoZSBzeXN0ZW0KICAgICAgICAgICAgaWYgKChfdmFsaWRhdGUg\nJiBWQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdl\ndE5hbWUoKSwgdHJ1ZSwgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGNscykpKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG5vdCBpbiBjYWNoZTogbG9h\nZCBtZXRhZGF0YSBvciBtYXBwaW5ncyBkZXBlbmRpbmcgb24gc291cmNlIG1v\nZGUuCiAgICAgICAgLy8gbG9hZGluZyBtZXRhZGF0YSBtaWdodCBhbHNvIGxv\nYWQgbWFwcGluZ3MsIGJ1dCBkb2Vzbid0IGhhdmUgdG8KICAgICAgICBpbnQg\nbW9kZSA9IDA7CiAgICAgICAgaWYgKChfc291cmNlTW9kZSAmIE1PREVfTUVU\nQSkgIT0gMCkKICAgICAgICAgICAgbW9kZSA9IF9zb3VyY2VNb2RlICYgfk1P\nREVfTUFQUElORzsKICAgICAgICBlbHNlIGlmICgoX3NvdXJjZU1vZGUgJiBN\nT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIG1vZGUgPSBfc291cmNl\nTW9kZTsKICAgICAgICBpZiAobW9kZSAhPSBNT0RFX05PTkUpIHsKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImxvYWQtY2xzIiwgY2xzLCB0b01v\nZGVTdHJpbmcobW9kZSkpKTsKICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChj\nbHMsIG1vZGUsIGVudkxvYWRlcik7CiAgICAgICAgfQoKICAgICAgICAvLyBj\naGVjayBjYWNoZSBhZ2FpbgogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAg\nICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChj\nbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgKChtZXRhLmdldFNv\ndXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCB8fCAoX3NvdXJjZU1vZGUg\nJiBNT0RFX01FVEEpID09IDApKQogICAgICAgICAgICByZXR1cm4gbWV0YTsK\nCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBjbGFzcyBoYXMgbm8gbWV0\nYWRhdGE7IGNoZWNraW5nIGZvciB0aGlzIGxhdGVyCiAgICAgICAgLy8gc3Bl\nZWRzIHRoaW5ncyB1cCBpbiBlbnZpcm9ubWVudHMgd2l0aCBzbG93IGNsYXNz\nIGxvYWRpbmcKICAgICAgICAvLyBsaWtlIGFwcHNlcnZlcnMKICAgICAgICBp\nZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICByZW1vdmVNZXRhRGF0YSht\nZXRhKTsKICAgICAgICBfbWV0YXMucHV0KGNscywgbnVsbCk7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBz\ndHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIG1vZGUgZmxhZ3Mu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyB0b01vZGVTdHJp\nbmcoaW50IG1vZGUpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKDMxKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RF\nX01FVEEpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltNRVRBXSIp\nOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfUVVFUlkpICE9IDApCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIltRVUVSWV0iKTsKICAgICAgICBpZiAoKG1v\nZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIltNQVBQSU5HXSIpOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQ\nUElOR19JTklUKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCJbTUFQ\nUElOR19JTklUXSIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgbWV0YWRhdGEgZm9yIG1h\ncHBpbmcgcmVzb2x1dGlvbi4gVGhpcyBtZXRob2QgbWlnaHQgbWFwIHBhcnRz\nIG9mIHRoZSBtZXRhZGF0YSB0aGF0CiAgICAgKiBkb24ndCByZWx5IG9uIG90\naGVyIGNsYXNzZXMgYmVpbmcgbWFwcGVkLCBidXQgdGhhdCBvdGhlciBjbGFz\nc2VzIG1pZ2h0IHJlbHkgb24gZHVyaW5nIHRoZWlyCiAgICAgKiBvd24gbWFw\ncGluZyAoZm9yIGV4YW1wbGUsIHByaW1hcnkga2V5IGZpZWxkcykuIEJ5IGRl\nZmF1bHQsIHRoaXMgbWV0aG9kIG9ubHkgY2FsbHMKICAgICAqIHtAbGluayBD\nbGFzc01ldGFEYXRhI2RlZmluZVN1cGVyY2xhc3NGaWVsZHN9LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJlTWFwcGluZyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBtZXRhLmRlZmluZVN1cGVyY2xhc3NGaWVs\nZHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSB0aGUg\nZ2l2ZW4gbWV0YWRhdGEgaWYgbmVlZGVkLiBUaGVyZSBhcmUgdGhyZWUgZ29h\nbHM6CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+TWFrZSBzdXJlIG5vIHVucmVz\nb2x2ZWQgbWV0YWRhdGEgZ2V0cyBiYWNrIHRvIHRoZSBjbGllbnQuPC9saT4K\nICAgICAqIDxsaT5Bdm9pZCBpbmZpbml0ZSByZWVudHJhbnQgY2FsbHMgZm9y\nIG11dHVhbGx5LWRlcGVuZGVudCBtZXRhZGF0YXMgYnkgYWxsb3dpbmcgdW5y\nZXNvbHZlZAogICAgICogbWV0YWRhdGEgdG8gYmUgcmV0dXJuZWQgdG8gb3Ro\nZXIgbWV0YWRhdGFzLjwvbGk+CiAgICAgKiA8bGk+QWx3YXlzIG1ha2Ugc3Vy\nZSB0aGUgc3VwZXJjbGFzcyBtZXRhZGF0YSBpcyByZXNvbHZlZCBiZWZvcmUg\ndGhlIHN1YmNsYXNzIG1ldGFkYXRhIHNvIHRoYXQKICAgICAqIHRoZSBzdWJj\nbGFzcyBjYW4gYWNjZXNzIHRoZSBzdXBlcidzIGxpc3Qgb2YgZmllbGRzLjwv\nbGk+CiAgICAgKiA8L29sPgogICAgICogTm90ZSB0aGF0IHRoZSBjb2RlIGNh\nbGxpbmcgdGhpcyBtZXRob2QgaXMgc3luY2hyb25pemVkLCBzbyB0aGlzIG1l\ndGhvZCBkb2Vzbid0IGhhdmUgdG8gYmUuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZXNvbHZlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIC8v\nIHJldHVybiBhbnl0aGluZyB0aGF0IGhhcyBpdHMgbWV0YWRhdGEgcmVzb2x2\nZWQsIGJlY2F1c2UgdGhhdCBtZWFucwogICAgICAgIC8vIGl0IGlzIGVpdGhl\nciBmdWxseSByZXNvbHZlZCBvciBtdXN0IGF0IGxlYXN0IGJlIGluIHRoZSBw\ncm9jZXNzIG9mCiAgICAgICAgLy8gcmVzb2x2aW5nIG1hcHBpbmcsIGV0YyBz\naW5jZSB3ZSBkbyB0aGF0IHJpZ2h0IGFmdGVyIG1ldGEgcmVzb2x2ZQogICAg\nICAgIGlmIChtZXRhID09IG51bGwgfHwgX3Jlc01vZGUgPT0gTU9ERV9OT05F\nIHx8IChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUVUQSkgIT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyByZXNvbHZlIG1ldGFkYXRh\nCiAgICAgICAgTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlZCA9IHJlc29s\ndmVNZXRhKG1ldGEpOwogICAgICAgIGlmIChyZXNvbHZlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGxvYWQgbWFwcGluZyBk\nYXRhCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXpl\nKCk7IGkrKykKICAgICAgICAgICAgbG9hZE1hcHBpbmcocmVzb2x2ZWQuZ2V0\nKGkpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVkLnNp\nemUoKTsgaSsrKQogICAgICAgICAgICBwcmVNYXBwaW5nKHJlc29sdmVkLmdl\ndChpKSk7CgogICAgICAgIC8vIHJlc29sdmUgbWFwcGluZ3MKICAgICAgICBi\nb29sZWFuIGVyciA9IHRydWU7CiAgICAgICAgaWYgKChfcmVzTW9kZSAmIE1P\nREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgIGVy\nciAmPSByZXNvbHZlTWFwcGluZyhyZXNvbHZlZC5nZXQoaSkpOwoKICAgICAg\nICAvLyB0aHJvdyBlcnJvcnMgZW5jb3VudGVyZWQKICAgICAgICAvLyBPUEVO\nSlBBLTE1MzUgQWx3YXlzIHRocm93IGEgTWV0YURhdGFFeGNlcHRpb24gYmVj\nYXVzZSBjYWxsZXJzCiAgICAgICAgLy8gb2YgbG9hZFJlZ2lzdGVyZWRDbGFz\nc01ldGFEYXRhIGV4cGVjdCBvbmx5IE1ldGFEYXRhRXhjZXB0aW9uCiAgICAg\nICAgLy8gdG8gYmUgdGhyb3duLgogICAgICAgIGlmIChlcnIgJiYgIV9lcnJz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBSdW50aW1lRXhjZXB0aW9uIHJl\nOwogICAgICAgICAgICBpZiAoKF9lcnJzLnNpemUoKSA9PSAxKSAmJiAoX2Vy\ncnMuZ2V0KDApIGluc3RhbmNlb2YgTWV0YURhdGFFeGNlcHRpb24pKSB7CiAg\nICAgICAgICAgICAgICByZSA9IF9lcnJzLmdldCgwKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlID0gbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJyZXNvbHZlLWVycnMiKSkKICAgICAgICAgICAg\nICAgICAgICAuc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIF9l\ncnJzCiAgICAgICAgICAgICAgICAgICAgLnRvQXJyYXkobmV3IEV4Y2VwdGlv\nbltfZXJycy5zaXplKCldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nX2VycnMuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0YSBtb2Rl\nLCByZXR1cm5pbmcgbGlzdCBvZiBwcm9jZXNzZWQgbWV0YWRhZGF0YXMsIG9y\nIG51bGwgaWYgd2UncmUgc3RpbGwgaW4gdGhlCiAgICAgKiBwcm9jZXNzIG9m\nIHJlc29sdmluZyBvdGhlciBtZXRhZGF0YXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlTWV0YShDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRQQ1N1cGVyY2xhc3Mo\nKSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHNldCBzdXBlcmNsYXNzCiAg\nICAgICAgICAgIENsYXNzPD8+IHN1cCA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXBNZXRhOwogICAgICAgICAgICB3aGlsZSAoc3VwICE9IG51bGwgJiYg\nc3VwICE9IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICAgICAgc3VwTWV0\nYSA9IGdldE1ldGFEYXRhKHN1cCwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigp\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoc3VwTWV0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Mo\nc3VwKTsKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKHN1cE1ldGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZh\nY2UoKSkgewogICAgICAgICAgICAgICAgQ2xhc3M8Pz5bXSBzdXBzID0gbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0SW50ZXJmYWNlcygpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgc3VwTWV0YSA9IGdldE1ldGFEYXRh\nKHN1cHNbaV0sIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChzdXBNZXRhICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Moc3Vw\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJhc3NpZ25lZC1zdXAiLCBtZXRhLCBtZXRhLmdldFBDU3VwZXJjbGFzcygp\nKSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXNvbHZlIHJlbGF0aW9uIHBy\naW1hcnkga2V5IGZpZWxkcyBmb3IgbWFwcGluZyBkZXBlbmRlbmNpZXMKICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmlzUHJpbWFyeUtl\neSgpKQogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKSwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigpLCBmYWxz\nZSk7CgogICAgICAgIC8vIHJlc29sdmUgbWV0YWRhdGE7IGlmIHdlJ3JlIG5v\ndCBpbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcKICAgICAgICAvLyBvdGhl\ncnMsIHRoaXMgd2lsbCByZXR1cm4gdGhlIHNldCBvZiBpbnRlcnJlbGF0ZWQg\nbWV0YXMgdGhhdAogICAgICAgIC8vIHJlc29sdmVkCiAgICAgICAgcmV0dXJu\nIHByb2Nlc3NCdWZmZXIobWV0YSwgX3Jlc29sdmluZywgTU9ERV9NRVRBKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgbWFwcGluZyBpbmZvcm1hdGlv\nbiBmb3IgdGhlIGdpdmVuIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgbG9hZE1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgaWYgKChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUFQUElORykgIT0g\nMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBsb2FkIG1hcHBp\nbmcgaW5mb3JtYXRpb24KICAgICAgICBpZiAoKG1ldGEuZ2V0U291cmNlTW9k\nZSgpICYgTU9ERV9NQVBQSU5HKSA9PSAwICYmIChfc291cmNlTW9kZSAmIE1P\nREVfTUFQUElORykgIT0gMCkgewogICAgICAgICAgICAvLyBlbWJlZGRlZC1v\nbmx5IG1ldGFkYXRhIGRvZXNuJ3QgaGF2ZSBtYXBwaW5nLCBzbyBhbHdheXMg\nbG9hZGVkCiAgICAgICAgICAgIGlmIChtZXRhLmlzRW1iZWRkZWRPbmx5KCkp\nCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQ\nSU5HLCB0cnVlKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAvLyBsb2FkIG1hcHBpbmcgZGF0YQogICAgICAgICAgICAgICAgaW50IG1v\nZGUgPSBfc291cmNlTW9kZSAmIH5NT0RFX01FVEE7CiAgICAgICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImxvYWQtbWFwcGluZyIsIG1ldGEs\nIHRvTW9kZVN0cmluZyhtb2RlKSkpOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBfZmFjdG9yeS5sb2FkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCBtb2RlLCBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCkp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEp\nOwogICAgICAgICAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQcmUtbWFwcGluZyBwcmVwYXJhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHByZU1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgaWYgKChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUFQ\nUElORykgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBw\ncmVwYXJlIG1hcHBpbmdzIGZvciByZXNvbHZlOyBpZiBub3QgcmVzb2x2aW5n\nIG1hcHBpbmdzLCB0aGVuCiAgICAgICAgLy8gbWFrZSBzdXJlIGFueSBzdXBl\ncmNsYXNzIGZpZWxkcyBkZWZpbmVkIGluIG1ldGFkYXRhIGFyZSByZXNvbHZl\nZAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX3Jlc01vZGUgJiBN\nT0RFX01BUFBJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgicHJlcC1tYXBwaW5nIiwgbWV0YSkpOwogICAgICAg\nICAgICAgICAgcHJlcGFyZU1hcHBpbmcobWV0YSk7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgbWV0YS5kZWZpbmVTdXBlcmNsYXNzRmll\nbGRzKGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAg\nICAgICAgICBfZXJycy5hZGQocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc29sdmUgYW5kIGluaXRpYWxpemUgbWFwcGluZy4KICAg\nICAqIAogICAgICogQHJldHVybiBmYWxzZSBpZiB3ZSdyZSBzdGlsbCBpbiB0\naGUgcHJvY2VzcyBvZiByZXNvbHZpbmcgbWFwcGluZ3MKICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIHJlc29sdmVNYXBwaW5nKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gbWFwcGVkID0g\ncHJvY2Vzc0J1ZmZlcihtZXRhLCBfbWFwcGluZywgTU9ERV9NQVBQSU5HKTsK\nICAgICAgICBpZiAobWFwcGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBtYXBwaW5nIGZvciBy\ndW50aW1lIHVzZQogICAgICAgIGlmICgoX3Jlc01vZGUgJiBNT0RFX01BUFBJ\nTkdfSU5JVCkgIT0gMCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG1hcHBlZC5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgbWV0\nYSA9IChDbGFzc01ldGFEYXRhKSBtYXBwZWQuZ2V0KGkpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtZXRhLnJlc29sdmUo\nTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgICAgIHJl\nbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIF9lcnJz\nLmFkZChyZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcm9jZXNzIHRoZSBnaXZlbiBtZXRhZGF0YSBhbmQgdGhlIGFzc29j\naWF0ZWQgYnVmZmVyLgogICAgICovCiAgICBwcml2YXRlIExpc3Q8Q2xhc3NN\nZXRhRGF0YT4gcHJvY2Vzc0J1ZmZlcihDbGFzc01ldGFEYXRhIG1ldGEsIElu\naGVyaXRhbmNlT3JkZXJlZE1ldGFEYXRhTGlzdCBidWZmZXIsIGludCBtb2Rl\nKSB7CiAgICAgICAgLy8gaWYgd2UncmUgYWxyZWFkeSBwcm9jZXNzaW5nIGEg\nbWV0YWRhdGEsIGp1c3QgYnVmZmVyIHRoaXMgb25lOyB3aGVuCiAgICAgICAg\nLy8gdGhlIGluaXRpYWwgbWV0YWRhdGEgZmluaXNoZXMgcHJvY2Vzc2luZywg\nd2UgdHJhdmVyc2UgdGhlIGJ1ZmZlcgogICAgICAgIC8vIGFuZCBwcm9jZXNz\nIGFsbCB0aGUgb3RoZXJzIHRoYXQgd2VyZSBpbnRyb2R1Y2VkIGR1cmluZyBy\nZWVudHJhbnQKICAgICAgICAvLyBjYWxscwogICAgICAgIGlmICghYnVmZmVy\nLmFkZChtZXRhKSB8fCBidWZmZXIuc2l6ZSgpICE9IDEpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjb250aW51YWxseSBwb3AgYSBt\nZXRhZGF0YSBhbmQgcHJvY2VzcyBpdCB1bnRpbCB3ZSBydW4gb3V0OyBub3Rl\nCiAgICAgICAgLy8gdGhhdCBlYWNoIHByb2Nlc3NpbmcgY2FsbCBtaWdodCBw\nbGFjZSBtb3JlIG1ldGFzIGluIHRoZSBidWZmZXIgYXMKICAgICAgICAvLyBv\nbmUgY2xhc3MgdHJpZXMgdG8gYWNjZXNzIG1ldGFkYXRhIGZvciBhbm90aGVy\nOyBhbHNvIG5vdGUgdGhhdCB0aGUKICAgICAgICAvLyBidWZmZXIgb3JkZXJz\nIGl0c2VsZiBmcm9tIGxlYXN0IHRvIG1vc3QgZGVyaXZlZAogICAgICAgIENs\nYXNzTWV0YURhdGEgYnVmZmVyZWQ7CiAgICAgICAgTGlzdDxDbGFzc01ldGFE\nYXRhPiBwcm9jZXNzZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNzTWV0YURhdGE+\nKDUpOwogICAgICAgIHdoaWxlICghYnVmZmVyLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBidWZmZXJlZCA9IGJ1ZmZlci5wZWVrKCk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBidWZmZXJlZC5yZXNvbHZlKG1vZGUp\nOwogICAgICAgICAgICAgICAgcHJvY2Vzc2VkLmFkZChidWZmZXJlZCk7CiAg\nICAgICAgICAgICAgICBidWZmZXIucmVtb3ZlKGJ1ZmZlcmVkKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICAgICAgX2VycnMuYWRkKHJlKTsKCiAgICAgICAgICAgICAgICAvLyBh\nbnkgZXhjZXB0aW9uIGR1cmluZyByZXNvbHV0aW9uIG9mIG9uZSB0eXBlIG1l\nYW5zIHdlIGNhbid0CiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGFueSBv\nZiB0aGUgcmVsYXRlZCB0eXBlcywgc28gY2xlYXIgYnVmZmVyLiB0aGlzIGFs\nc28KICAgICAgICAgICAgICAgIC8vIGVuc3VyZXMgdGhhdCBpZiB0d28gdHlw\nZXMgcmVsYXRlIHRvIGVhY2ggb3RoZXIgYW5kIG9uZQogICAgICAgICAgICAg\nICAgLy8gZGllcywgd2UgZG9uJ3QgZ2V0IGludG8gaW5maW5pdGUgY3ljbGVz\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPENsYXNzTWV0YURhdGE+\nIGl0ciA9IGJ1ZmZlci5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgICAgIG1ldGEgPSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChtZXRhICE9IGJ1ZmZlcmVkKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIF9lcnJzLmFkZChuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoInByZXYtZXJycyIsIG1ldGEsIGJ1ZmZlcmVkKSkpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGJ1ZmZlci5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIC8vIENoZWNrIGlmIHByb2Nlc3MgYnVmZmVy\nIHJlb3JkZXJpbmcgZm9yIFBDVHlwZXMgdGhhdCBoYXZlIHJlbGF0aW9uc2hp\ncHMgdG8gb3RoZXIgUENUeXBlcyBpbiB0aGVpciBpZGVudGl0eSAKICAgICAg\nICAvLyBzaG91bGQgYmUgcGVyZm9ybWVkLgogICAgICAgIGlmIChfcmVvcmRl\nck1ldGFEYXRhUmVzb2x1dGlvbikgewogICAgICAgICAgICBwcm9jZXNzZWQg\nPSByZXNvbHZlRktJblBLRGVwZW5kZW5jaWVzT3JkZXJpbmcocHJvY2Vzc2Vk\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgdGhlIG1ldGFkYXRhIGluc3Rh\nbmNlcyBjdXJyZW50bHkgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0TWV0YURhdGFzKCkgewogICAg\nICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQo\ndGhpcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGFzSW50\nZXJuYWwoKTsgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGFzSW50ZXJuYWwoKTsKICAg\nICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtd\nIGdldE1ldGFEYXRhc0ludGVybmFsKCkgewogICAgICAgICAgICAvLyBwcmV2\nZW50IGNvbmN1cnJlbnQgbW9kIGVycm9ycyB3aGVuIHJlc29sdmluZyBvbmUg\nbWV0YWRhdGEKICAgICAgICAgICAgLy8gaW50cm9kdWNlcyBvdGhlcnMKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gKENsYXNzTWV0YURh\ndGFbXSkgX21ldGFzLnZhbHVlcygpLnRvQXJyYXkobmV3IENsYXNzTWV0YURh\ndGFbX21ldGFzLnNpemUoKV0pOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKG1ldGFzW2ldICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZ2V0TWV0\nYURhdGEobWV0YXNbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpLCBtZXRhc1tpXS5n\nZXRFbnZDbGFzc0xvYWRlcigpLCB0cnVlKTsKCiAgICAgICAgICAgIExpc3Q8\nQ2xhc3NNZXRhRGF0YT4gcmVzb2x2ZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNz\nTWV0YURhdGE+KF9tZXRhcy5zaXplKCkpOwogICAgICAgICAgICBmb3IgKENs\nYXNzTWV0YURhdGEgbWV0YSA6IF9tZXRhcy52YWx1ZXMoKSkgewogICAgICAg\nICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICByZXNvbHZlZC5hZGQobWV0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgbWV0YXMgPSByZXNvbHZlZC50b0FycmF5KG5ld0NsYXNzTWV0YURhdGFB\ncnJheShyZXNvbHZlZC5zaXplKCkpKTsKICAgICAgICAgICAgQXJyYXlzLnNv\ncnQobWV0YXMpOwogICAgICAgICAgICByZXR1cm4gbWV0YXM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBtZXRhZGF0YSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLCB3aXRob3V0IGFueSByZXNvbHV0aW9uLiBSZXR1\ncm4gbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YSBnZXRDYWNoZWRNZXRhRGF0YShDbGFzczw/PiBjbHMpIHsKICAgICAg\nICByZXR1cm4gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9w\ndWxhdGUgaXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8g\ndGhlIHJlcG9zaXRvcnksIGFuZAogICAgICogcmV0dXJuIGl0LiBVc2UgdGhl\nIGRlZmF1bHQgYWNjZXNzIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzPD8+IGNscykgewogICAgICAg\nIHJldHVybiBhZGRNZXRhRGF0YShjbHMsIEFjY2Vzc0NvZGUuVU5LTk9XTik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEs\nIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0\nIHRvIHRoZSByZXBvc2l0b3J5LCBhbmQKICAgICAqIHJldHVybiBpdC4KICAg\nICAqIAogICAgICogQHBhcmFtIGFjY2VzcwogICAgICogICAgICAgICAgICB0\naGUgYWNjZXNzIHR5cGUgdG8gdXNlIGluIHBvcHVsYXRpbmcgbWV0YWRhdGEK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRkTWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBpbnQgYWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGFk\nZE1ldGFEYXRhKGNscywgYWNjZXNzLCBmYWxzZSk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IG1ldGFkYXRhLCBwb3B1bGF0ZSBp\ndCB3aXRoIGRlZmF1bHQgaW5mb3JtYXRpb24sIGFkZCBpdCB0byB0aGUgcmVw\nb3NpdG9yeSwgYW5kCiAgICAgKiByZXR1cm4gaXQuCiAgICAgKiAKICAgICAq\nIEBwYXJhbSBhY2Nlc3MKICAgICAqICAgICAgICAgICAgdGhlIGFjY2VzcyB0\neXBlIHRvIHVzZSBpbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzPD8+IGNs\ncywgaW50IGFjY2VzcywgYm9vbGVhbiBpZ25vcmVUcmFuc2llbnQpIHsKICAg\nICAgICBpZiAoY2xzID09IG51bGwgfHwgY2xzLmlzUHJpbWl0aXZlKCkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDbGFzc01ldGFEYXRh\nIG1ldGEgPSBuZXdDbGFzc01ldGFEYXRhKGNscyk7CiAgICAgICAgX2ZhY3Rv\ncnkuZ2V0RGVmYXVsdHMoKS5wb3B1bGF0ZShtZXRhLCBhY2Nlc3MsIGlnbm9y\nZVRyYW5zaWVudCk7CgogICAgICAgIC8vIHN5bmNocm9uaXplIG9uIHRoaXMg\ncmF0aGVyIHRoYW4gdGhlIG1hcCwgYmVjYXVzZSBhbGwgb3RoZXIgbWV0aG9k\ncwogICAgICAgIC8vIHRoYXQgYWNjZXNzIF9tZXRhcyBhcmUgc3luY2hyb25p\nemVkIG9uIHRoaXMKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkKHRoaXMpewogICAgICAgICAgICAgICAgcmV0dXJu\nIG1ldGFzUHV0SW50ZXJuYWwoY2xzLCBtZXRhKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBtZXRhc1B1dElu\ndGVybmFsKGNscywgbWV0YSk7CiAgICAgICAgfQogICAgICAgICAgICAKICAg\nIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgbWV0YXNQdXRJbnRlcm5h\nbChDbGFzczw/PiBjbHMsIENsYXNzTWV0YURhdGEgbWV0YSl7CiAgICAgICAg\nICAgIGlmIChfcGF3YXJlcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJw\nYy1hbmQtYXdhcmUiLCBjbHMpKTsKICAgICAgICAgICAgX21ldGFzLnB1dChj\nbHMsIG1ldGEpOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IGNsYXNzIG1ldGFkYXRhIGluc3RhbmNl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSBuZXdDbGFz\nc01ldGFEYXRhKENsYXNzPD8+IHR5cGUpIHsKICAgICAgICByZXR1cm4gbmV3\nIENsYXNzTWV0YURhdGEodHlwZSwgdGhpcyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHByb3BlciBjbGFzcyBt\nZXRhZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNz\nTWV0YURhdGFbXSBuZXdDbGFzc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkg\newogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YVtsZW5ndGhdOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGZpZWxkIG1ldGFk\nYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRh\nRGF0YSBuZXdGaWVsZE1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzczw/PiB0\neXBlLCBDbGFzc01ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBGaWVsZE1ldGFEYXRhKG5hbWUsIHR5cGUsIG93bmVyKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJvcGVy\nIGZpZWxkIG1ldGFkYXRhIHN1YmNsYXNzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgRmllbGRNZXRhRGF0YVtdIG5ld0ZpZWxkTWV0YURhdGFBcnJheShpbnQg\nbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZE1ldGFEYXRhW2xl\nbmd0aF07CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgYXJy\nYXkgb2YgdGhlIHByb3BlciB4bWwgY2xhc3MgbWV0YWRhdGEgc3ViY2xhc3Mu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBYTUxNZXRhRGF0YVtdIG5ld1hNTENs\nYXNzTWV0YURhdGFBcnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBYTUxDbGFzc01ldGFEYXRhW2xlbmd0aF07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgZW1iZWRkZWQgY2xhc3MgbWV0YWRhdGEg\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRh\nIG5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShWYWx1ZU1ldGFEYXRhIG93bmVy\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01ldGFEYXRhKG93bmVyKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB2YWx1ZSBtZXRh\nZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlTWV0\nYURhdGEgbmV3VmFsdWVNZXRhRGF0YShGaWVsZE1ldGFEYXRhIG93bmVyKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1ldGFEYXRhSW1wbChvd25lcik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4ge0BsaW5rIE9yZGVy\nfSBmb3IgdGhlIGdpdmVuIGZpZWxkIGFuZCBkZWNsYXJhdGlvbi4gVGhpcyBt\nZXRob2QgZGVsZWdhdGVzIHRvCiAgICAgKiB7QGxpbmsgI25ld1JlbGF0ZWRG\naWVsZE9yZGVyfSBhbmQge0BsaW5rICNuZXdWYWx1ZUZpZWxkT3JkZXJ9IGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRlciBuZXdPcmRl\ncihGaWVsZE1ldGFEYXRhIG93bmVyLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBh\nc2MpIHsKICAgICAgICAvLyBwYXRocyBjYW4gc3RhcnQgd2l0aCAob3IgZXF1\nYWwpICcjZWxlbWVudCcKICAgICAgICBpZiAobmFtZS5zdGFydHNXaXRoKE9y\nZGVyLkVMRU1FTlQpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoT3JkZXIuRUxFTUVOVC5sZW5ndGgoKSk7CiAgICAgICAgaWYgKG5hbWUu\nbGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlT3Jk\nZXIob3duZXIsIGFzYyk7CgogICAgICAgIC8vIG5leHQgdG9rZW4gc2hvdWxk\nIGJlICcuJwogICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PSAnLicpCiAg\nICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKCiAgICAgICAg\nLy8gcmVsYXRlZCBmaWVsZAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIG93bmVyLmdldEVsZW1lbnQoKS5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vbnBjLWZpZWxkLW9yZGVyYWJs\nZSIsIG93bmVyLCBuYW1lKSk7CiAgICAgICAgRmllbGRNZXRhRGF0YSByZWwg\nPSBnZXRPcmRlckJ5RmllbGQobWV0YSwgbmFtZSk7CiAgICAgICAgaWYgKHJl\nbCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1maWVsZC1vcmRlcmFibGUiLCBvd25lciwg\nbmFtZSkpOwogICAgICAgIHJldHVybiBuZXdSZWxhdGVkRmllbGRPcmRlcihv\nd25lciwgcmVsLCBhc2MpOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1ldGFE\nYXRhIGdldE9yZGVyQnlGaWVsZChDbGFzc01ldGFEYXRhIG1ldGEsIFN0cmlu\nZyBvcmRlckJ5KSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZCA9IG1l\ndGEuZ2V0RmllbGQob3JkZXJCeSk7CiAgICAgICAgaWYgKGZpZWxkICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmaWVsZDsKICAgICAgICBpbnQgZG90\nSWR4ID0gb3JkZXJCeS5pbmRleE9mKCIuIik7CiAgICAgICAgaWYgKGRvdElk\neCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgU3Ry\naW5nIGZpZWxkTmFtZSA9IG9yZGVyQnkuc3Vic3RyaW5nKDAsIGRvdElkeCk7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZDEgPSBtZXRhLmdldEZpZWxk\nKGZpZWxkTmFtZSk7CiAgICAgICAgaWYgKGZpZWxkMSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGExID0gZmllbGQxLmdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICBp\nZiAobWV0YTEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgU3RyaW5nIG1hcHBlZEJ5MSA9IG9yZGVyQnkuc3Vic3RyaW5nKGRv\ndElkeCArIDEpOwogICAgICAgIHJldHVybiBnZXRPcmRlckJ5RmllbGQobWV0\nYTEsIG1hcHBlZEJ5MSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBi\neSB0aGUgZmllbGQgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRl\nciBuZXdWYWx1ZU9yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIGJvb2xlYW4g\nYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbk1lbW9yeVZhbHVlT3JkZXIo\nYXNjLCBnZXRDb25maWd1cmF0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogT3JkZXIgYnkgYSBmaWVsZCBvZiB0aGUgcmVsYXRlZCB0eXBlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3UmVsYXRlZEZpZWxkT3JkZXIo\nRmllbGRNZXRhRGF0YSBvd25lciwgRmllbGRNZXRhRGF0YSByZWwsIGJvb2xl\nYW4gYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbk1lbW9yeVJlbGF0ZWRG\naWVsZE9yZGVyKHJlbCwgYXNjLCBnZXRDb25maWd1cmF0aW9uKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGFycmF5IG9mIG9yZGVycyBv\nZiB0aGUgZ2l2ZW4gc2l6ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVy\nW10gbmV3T3JkZXJBcnJheShpbnQgc2l6ZSkgewogICAgICAgIHJldHVybiBu\nZXcgT3JkZXJbc2l6ZV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUg\nYSBtZXRhZGF0YSBpbnN0YW5jZSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAg\nICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYg\nbm90IGluIHRoaXMgcmVwb3NpdG9yeQogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiByZW1vdmVNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBh\nIG1ldGFkYXRhIGluc3RhbmNlIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAg\nKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBu\nb3QgaW4gdGhpcyByZXBvc2l0b3J5CiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNzPD8+IGNscykgewogICAgICAgIGlm\nKF9sb2NraW5nKXsKICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhSW50ZXJuYWwo\nY2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlewogICAgICAgICAg\nICByZXR1cm4gcmVtb3ZlTWV0YURhdGFJbnRlcm5hbChjbHMpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gcmVtb3ZlTWV0YURhdGFJ\nbnRlcm5hbChDbGFzczw/PiBjbHMpIHsKICAgICAgICAgICAgaWYgKGNscyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBpZiAoX21ldGFzLnJlbW92ZShjbHMpICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIENsYXNzPD8+IGltcGwgPSBfaWZhY2VzLnJlbW92ZShjbHMp\nOwogICAgICAgICAgICAgICAgaWYgKGltcGwgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBfbWV0YXMucmVtb3ZlKGltcGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIG1ldGFkYXRhIGFzIGRlY2xhcmVkIGludGVyZmFjZSBpbXBsZW1lbnRhdGlv\nbi4KICAgICAqLwogICAgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZUltcGwo\nQ2xhc3NNZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBpZmFjZSkgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKF9p\nbXBscykgewogICAgICAgICAgICAgICAgYWRkRGVjbGFyZWRJbnRlcmZhY2VJ\nbXBsSW50ZXJuYWwobWV0YSwgaWZhY2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkRGVjbGFyZWRJbnRlcmZhY2VJ\nbXBsSW50ZXJuYWwobWV0YSwgaWZhY2UpOwogICAgICAgIH0KICAgIH0KCiAg\nIHByaXZhdGUgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZUltcGxJbnRlcm5h\nbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzPD8+IGlmYWNlKSB7CiAgICAg\nICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHZhbHMgPSBfaW1wbHMuZ2V0\nKGlmYWNlKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUg\nc3VwZXJjbGFzcyBhbHJlYWR5IGRlY2xhcmVzIHRvIGF2b2lkIGR1cHMKICAg\nICAgICAgICAgaWYgKHZhbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgICAgICBmb3IgKDsgc3VwICE9IG51bGw7IHN1\ncCA9IHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKQogICAgICAgICAg\nICAgICAgICAgIGlmICh2YWxzLmNvbnRhaW5zKHN1cC5nZXREZXNjcmliZWRU\neXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uKF9pbXBscywg\naWZhY2UsIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBmYWxzZSk7CiAgICAg\nICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGltcGxlbWVudGF0aW9uIGZv\nciB0aGUgZ2l2ZW4gbWFuYWdlZCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHZv\naWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNz\nPD8+IGltcGwpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBzZXRJ\nbnRlcmZhY2VJbXBsSW50ZXJuYWwobWV0YSwgaW1wbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRJbnRlcmZhY2VJ\nbXBsSW50ZXJuYWwobWV0YSwgaW1wbCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBzZXRJbnRlcmZhY2VJbXBsSW50ZXJuYWwoQ2xhc3NN\nZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBpbXBsKSB7CiAgICAgICAgICAgIGlm\nICghbWV0YS5pc01hbmFnZWRJbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1h\nbmFnZWQtaW50ZXJmYWNlIiwgbWV0YSwgaW1wbCkpOwogICAgICAgICAgICBf\naWZhY2VzLnB1dChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgaW1wbCk7CiAg\nICAgICAgICAgIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1wbChtZXRhLCBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgICAgICB3aGlsZSAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIC8vIHJlY29yZCBzdXBlcmNsYXNzIGludGVyZmFjZSBpbmZvIHdoaWxlIHdl\nIGNhbiBhcyB3ZWxsIGFzIHdlCiAgICAgICAgICAgICAgICAvLyB3aWxsIG9u\nbHkgcmVnaXN0ZXIgY29uY3JldGUgc3VwZXJjbGFzcyBpbiBQQ1JlZ2lzdHJ5\nCiAgICAgICAgICAgICAgICBzdXAuY2xlYXJTdWJjbGFzc0NhY2hlKCk7CiAg\nICAgICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIHN1cC5nZXRE\nZXNjcmliZWRUeXBlKCksIGltcGwsIHRydWUpOwogICAgICAgICAgICAgICAg\nc3VwID0gKENsYXNzTWV0YURhdGEpIHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICBJbnRlcmZhY2VJbXBsR2Vu\nZXJhdG9yIGdldEltcGxHZW5lcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIF9p\nbXBsR2VuOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsZWFz\ndC1kZXJpdmVkIGNsYXNzIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gYXBwbGlj\nYXRpb24gaWRlbnRpdHkgb2JqZWN0LgogICAgICogCiAgICAgKiBAcGFyYW0g\nb2lkCiAgICAgKiAgICAgICAgICAgIHRoZSBvaWQgdG8gZ2V0IHRoZSBtZXRh\nZGF0YSBmb3IKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIKICAgICAqICAgICAg\nICAgICAgdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkK\nICAgICAqIEBwYXJhbSBtdXN0RXhpc3QKICAgICAqICAgICAgICAgICAgaWYg\ndHJ1ZSwgdGhyb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9ufSBpZiBu\nbyBtZXRhZGF0YSBpcyBmb3VuZAogICAgICovCiAgICBwdWJsaWMgQ2xhc3NN\nZXRhRGF0YSBnZXRNZXRhRGF0YShPYmplY3Qgb2lkLCBDbGFzc0xvYWRlciBl\nbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKG9p\nZCA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9p\nZCwgIj8iLCBfb2lkcy50b1N0cmluZygpKSk7CiAgICAgICAgaWYgKG9pZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYg\nKG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgewogICAgICAgICAgICBDbGFz\nczw/PiBjbHMgPSAoKE9wZW5KUEFJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAg\nICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVz\ndEV4aXN0KTsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGNhY2hlCiAg\nICAgICAgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKGVudkxvYWRlcik7CiAg\nICAgICAgQ2xhc3M8Pz4gY2xzID0gX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygp\nKTsKICAgICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKCiAg\nICAgICAgLy8gbWF5YmUgdGhpcyBpcyBzb21lIHR5cGUgd2UndmUgc2VlbiBi\ndXQganVzdCBpc24ndCB2YWxpZAogICAgICAgIGlmIChfb2lkcy5jb250YWlu\nc0tleShvaWQuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgaWYgKG11c3RF\neGlzdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tb2lkLW1ldGEiLCBvaWQsIG9pZC5nZXRDbGFz\ncygpLCBfb2lkcykpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICB9CgogICAgICAgIC8vIGlmIHN0aWxsIG5vdCBtYXRjaCwgcmVnaXN0ZXIg\nYW55IGNsYXNzZXMgdGhhdCBsb29rIHNpbWlsYXIgdG8gdGhlCiAgICAgICAg\nLy8gb2lkIGNsYXNzIGFuZCBjaGVjayBhZ2FpbgogICAgICAgIHJlc29sdmVJ\nZGVudGl0eUNsYXNzKG9pZCk7CiAgICAgICAgaWYgKHByb2Nlc3NSZWdpc3Rl\ncmVkQ2xhc3NlcyhlbnZMb2FkZXIpLmxlbmd0aCA+IDApIHsKICAgICAgICAg\nICAgY2xzID0gX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAg\nICAgaWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBhbiBpbnZhbGlk\nIHR5cGUKICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCksIG51bGwp\nOwoKICAgICAgICBpZiAoIW11c3RFeGlzdCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwgb2lkLmdldENsYXNzKCksIF9v\naWRzKSkuc2V0RmFpbGVkT2JqZWN0KG9pZCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIHNvbWUgZ3Vlc3NlcyBhYm91dCB0aGUgbmFtZSBvZiBhIHRh\ncmdldCBjbGFzcyBmb3IgYW4gdW5rbm93biBhcHBsaWNhdGlvbiBpZGVudGl0\neSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVJZGVu\ndGl0eUNsYXNzKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3M8Pz4gb2lk\nQ2xhc3MgPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJyZXNvbHZlLWlkZW50aXR5Iiwgb2lkQ2xhc3MpKTsKCiAgICAgICAgQ2xh\nc3NMb2FkZXIgY2wgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChK\nMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihvaWRDbGFzcykp\nOwogICAgICAgIFN0cmluZyBjbGFzc05hbWU7CiAgICAgICAgd2hpbGUgKG9p\nZENsYXNzICE9IG51bGwgJiYgb2lkQ2xhc3MgIT0gT2JqZWN0LmNsYXNzKSB7\nCiAgICAgICAgICAgIGNsYXNzTmFtZSA9IG9pZENsYXNzLmdldE5hbWUoKTsK\nCiAgICAgICAgICAgIC8vIHdlIHRha2UgYSBicnV0ZS1mb3JjZSBhcHByb2Fj\naDogdHJ5IHRvIGxvYWQgYWxsIHRoZSBjbGFzcycKICAgICAgICAgICAgLy8g\nc3Vic3RyaW5ncy4gdGhpcyB3aWxsIGhhbmRsZSB0aGUgZm9sbG93aW5nIGNv\nbW1vbiBuYW1pbmcgY2FzZXM6CiAgICAgICAgICAgIC8vCiAgICAgICAgICAg\nIC8vIGNvbS5jb21wYW55Lk15Q2xhc3MkSUQgLT4gY29tLmNvbXBhbnkuTXlD\nbGFzcwogICAgICAgICAgICAvLyBjb20uY29tcGFueS5NeUNsYXNzSWQgLT4g\nY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAvLyBjb20uY29tcGFu\neS5NeUNsYXNzT2lkIC0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAg\nICAgLy8gY29tLmNvbXBhbnkuTXlDbGFzc1BLIC0+IGNvbS5jb21wYW55Lk15\nQ2xhc3MKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gdGhpcyBpc24n\ndCB0aGUgZmFzdGVzdCB0aGluZyBwb3NzaWJsZSwgYnV0IHRoaXMgbWV0aG9k\nIHdpbGwKICAgICAgICAgICAgLy8gb25seSBiZSBjYWxsZWQgb25jZSBwZXIg\nSlZNIHBlciB1bmtub3duIGFwcCBpZCBjbGFzcwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gY2xhc3NOYW1lLmxlbmd0aCgpOyBpID4gMTsgaS0tKSB7CiAg\nICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lLmNoYXJBdChpIC0gMSkgPT0g\nJy4nKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShj\nbGFzc05hbWUuc3Vic3RyaW5nKDAsIGkpLCB0cnVlLCBjbCk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgfSAvLyBjb25zdW1lIGFsbCBleGNlcHRpb25zCiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG1vdmUgdXAgdGhlIE9JRCBoaWVyYXJjaHkKICAg\nICAgICAgICAgb2lkQ2xhc3MgPSBvaWRDbGFzcy5nZXRTdXBlcmNsYXNzKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBs\nZWFzdC1kZXJpdmVkIG1ldGFkYXRhcyB3aXRoIHNvbWUgbWFwcGVkIGFzc2ln\nbmFibGUgdHlwZSB0aGF0IGltcGxlbWVudCB0aGUgZ2l2ZW4KICAgICAqIGNs\nYXNzLgogICAgICogCiAgICAgKiBAcGFyYW0gY2xzCiAgICAgKiAgICAgICAg\nICAgIHRoZSBjbGFzcyBvciBpbnRlcmZhY2UgdG8gcmV0cmlldmUgaW1wbGVt\nZW50b3JzIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICogICAg\nICAgICAgICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFu\neQogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAgICAgICAgICBp\nZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259IGlm\nIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01ldGFEYXRhW10gZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXMoQ2xhc3M8Pz4g\nY2xzLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0\nKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1tZXRhIiwgY2xzKSk7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfTUVUQVM7CgogICAgICAgIC8vIGdl\ndCBpbXBscyBvZiBnaXZlbiBpbnRlcmZhY2UgLyBhYnN0cmFjdCBjbGFzcwog\nICAgICAgIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShlbnZMb2FkZXIp\nOwogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHZhbHMgPSBfaW1wbHMu\nZ2V0KGNscyk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1hcHBlZCA9IG51\nbGw7CiAgICAgICAgaWYgKHZhbHMgIT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\ndmFscykgewogICAgICAgICAgICAgICAgICAgIG1hcHBlZCA9IGdldEltcGxl\nbWVudG9yTWV0YURhdGFzSW50ZXJuYWwodmFscywgZW52TG9hZGVyLCBtdXN0\nRXhpc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgbWFwcGVkID0gZ2V0SW1wbGVtZW50b3JNZXRh\nRGF0YXNJbnRlcm5hbCh2YWxzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChtYXBwZWQgPT0g\nbnVsbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YSIsIGNscykpOwogICAg\nICAgIGlmIChtYXBwZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX01FVEFTOwogICAgICAgIHJldHVybiBtYXBwZWQ7CiAgICB9CgogICAg\ncHJpdmF0ZSBDbGFzc01ldGFEYXRhW10gZ2V0SW1wbGVtZW50b3JNZXRhRGF0\nYXNJbnRlcm5hbChDb2xsZWN0aW9uPENsYXNzPD8+PiBjbGFzc2VzLCBDbGFz\nc0xvYWRlciBlbnZMb2FkZXIsCiAgICAgICAgYm9vbGVhbiBtdXN0RXhpc3Qp\nIHsKICAgICAgICBDb2xsZWN0aW9uPENsYXNzTWV0YURhdGE+IG1hcHBlZCA9\nIG5ldyBBcnJheUxpc3Q8Q2xhc3NNZXRhRGF0YT4oY2xhc3Nlcy5zaXplKCkp\nOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG51bGw7CiAgICAgICAg\nZm9yIChDbGFzczw/PiBjIDogY2xhc3NlcykgewogICAgICAgICAgICBtZXRh\nID0gZ2V0TWV0YURhdGEoYywgZW52TG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgaWYgKG1ldGEuaXNNYXBwZWQoKSB8fCBtZXRhLmdldE1hcHBlZFBDU3Vi\nY2xhc3NNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAg\nICBtYXBwZWQuYWRkKG1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBtYXBwZWQudG9BcnJheShuZXcgQ2xhc3NNZXRhRGF0\nYVtde30pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRhZGF0\nYSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBwZXJzaXN0ZW5jZS1hd2Fy\nZSBjbGFzcy4gUmV0dXJucyBudWxsLCBpZiB0aGUKICAgICAqIGdpdmVuIGNs\nYXNzIGlzIG5vdCByZWdpc3RlcmVkIGFzIHBlcnNpc3RlbmNlLWF3YXJlLgog\nICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGdldFBl\ncnNpc3RlbmNlQXdhcmUoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgcmV0dXJu\nIChOb25QZXJzaXN0ZW50TWV0YURhdGEpIF9wYXdhcmVzLmdldChjbHMpOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0cyBhbGwgdGhlIG1ldGFkYXRhcyBm\nb3IgcGVyc2lzdGVuY2UtYXdhcmUgY2xhc3NlcwogICAgICogCiAgICAgKiBA\ncmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIGNsYXNzIGhhcyBiZWVuIHJlZ2lz\ndGVyZWQgYXMgcGVycy1hd2FyZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhW10gZ2V0UGVyc2lzdGVuY2VBd2FyZXMoKSB7CiAg\nICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAoX3Bhd2FyZXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQZXJz\naXN0ZW5jZUF3YXJlc0ludGVybmFsKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0UGVyc2lzdGVuY2VB\nd2FyZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdIGdldFBlcnNpc3RlbmNlQXdhcmVz\nSW50ZXJuYWwoKSB7CiAgICAgICAgICAgIGlmIChfcGF3YXJlcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFlfTk9OX1BFUlNJU1RF\nTlQ7CiAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRh\nW10pIF9wYXdhcmVzLnZhbHVlcygpLnRvQXJyYXkobmV3IE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YVtfcGF3YXJlcy5zaXplKCldKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCB0aGUgZ2l2ZW4gY2xhc3MgYXMgcGVyc2lzdGVuY2UtYXdh\ncmUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBjbHMKICAgICAqICAgICAgICAg\nICAgbm9uLW51bGwgYW5kIG11c3Qgbm90IGFscmVhZGR5IGJlIGFkZGVkIGFz\nIHBlcnNpdGVuY2UtY2FwYWJsZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhIGFkZFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3M8Pz4g\nY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYWRkUGVyc2lzdGVuY2VBd2FyZUludGVybmFsKGNscyk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYWRk\nUGVyc2lzdGVuY2VBd2FyZUludGVybmFsKGNscyk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFkZFBlcnNp\nc3RlbmNlQXdhcmVJbnRlcm5hbChDbGFzczw/PiBjbHMpIHsKICAgICAgICAg\nICAgaWYgKF9wYXdhcmVzLmNvbnRhaW5zS2V5KGNscykpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSkgX3Bhd2FyZXMu\nZ2V0KGNscyk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0YShj\nbHMpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1hd2FyZSIsIGNscykpOwog\nICAgICAgICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEgbWV0YSA9CiAgICAg\nICAgICAgICAgICBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhKGNscywgdGhp\ncywgTm9uUGVyc2lzdGVudE1ldGFEYXRhLlRZUEVfUEVSU0lTVEVOQ0VfQVdB\nUkUpOwogICAgICAgICAgICBfcGF3YXJlcy5wdXQoY2xzLCBtZXRhKTsKICAg\nICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYSBwZXJzaXRlbmNlLWF3YXJlIGNsYXNzIGZyb20gdGhlIHJlcG9z\naXRvcnkKICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQK\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlUGVyc2lzdGVuY2VB\nd2FyZShDbGFzczw/PiBjbHMpIHsKICAgICAgICByZXR1cm4gX3Bhd2FyZXMu\ncmVtb3ZlKGNscykgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdl\ndHMgdGhlIG1ldGFkYXRhIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIG5v\nbi1tYXBwZWQgaW50ZXJmYWNlLiBSZXR1cm5zIG51bGwsIGlmIHRoZSBnaXZl\nbgogICAgICogaW50ZXJmYWNlIGlzIG5vdCByZWdpc3RlcmVkIGFzIHBlcnNp\nc3RlbmNlLWF3YXJlLgogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVu\ndE1ldGFEYXRhIGdldE5vbk1hcHBlZEludGVyZmFjZShDbGFzczw/PiBpZmFj\nZSkgewogICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKSBf\nbm9uTWFwcGVkLmdldChpZmFjZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZXRzIHRoZSBjb3JyZXNwb25kaW5nIG1ldGFkYXRhcyBmb3IgYWxsIHJlZ2lz\ndGVyZWQsIG5vbi1tYXBwZWQgaW50ZXJmYWNlcwogICAgICogCiAgICAgKiBA\ncmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIG5vbi1tYXBwZWQgaW50ZXJmYWNl\nIGhhcyBiZWVuIHJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIHB1YmxpYyBOb25Q\nZXJzaXN0ZW50TWV0YURhdGFbXSBnZXROb25NYXBwZWRJbnRlcmZhY2VzKCkg\newogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKF9ub25NYXBwZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXROb25NYXBwZWRJbnRlcmZhY2VzSW50ZXJuYWwoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXROb25N\nYXBwZWRJbnRlcmZhY2VzSW50ZXJuYWwoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSBOb25QZXJzaXN0ZW50TWV0YURhdGFbXSBnZXROb25NYXBw\nZWRJbnRlcmZhY2VzSW50ZXJuYWwoKSB7CiAgICAgICAgICAgIGlmIChfbm9u\nTWFwcGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBU\nWV9OT05fUEVSU0lTVEVOVDsKICAgICAgICAgICAgcmV0dXJuIChOb25QZXJz\naXN0ZW50TWV0YURhdGFbXSkgX25vbk1hcHBlZC52YWx1ZXMoKS50b0FycmF5\nKG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGFbX25vbk1hcHBlZC5zaXplKCld\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gbm9uLW1h\ncHBlZCBpbnRlcmZhY2UgdG8gdGhlIHJlcG9zaXRvcnkuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBpZmFjZQogICAgICogICAgICAgICAgICB0aGUgbm9uLW1h\ncHBlZCBpbnRlcmZhY2UKICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YSBhZGROb25NYXBwZWRJbnRlcmZhY2UoQ2xhc3M8Pz4gaWZh\nY2UpIHsKICAgICAgICBpZiAoaWZhY2UgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFpZmFjZS5pc0ludGVyZmFjZSgp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vdC1ub24tbWFwcGVkIiwgaWZhY2UpKTsKICAgICAgICBpZiAo\nX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gYWRkTm9uTWFwcGVkSW50ZXJmYWNl\nSW50ZXJuYWwoaWZhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIGFkZE5vbk1hcHBlZEludGVyZmFjZUlu\ndGVybmFsKGlmYWNlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZh\ndGUgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFkZE5vbk1hcHBlZEludGVyZmFj\nZUludGVybmFsKENsYXNzPD8+IGlmYWNlKSB7CiAgICAgICAgICAgIGlmIChf\nbm9uTWFwcGVkLmNvbnRhaW5zS2V5KGlmYWNlKSkKICAgICAgICAgICAgICAg\nIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKSBfbm9uTWFwcGVkLmdl\ndChpZmFjZSk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0YShp\nZmFjZSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm9uLW1hcHBlZC1wYyIsIGlmYWNl\nKSk7CiAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBtZXRhID0K\nICAgICAgICAgICAgICAgIG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGEoaWZh\nY2UsIHRoaXMsIE5vblBlcnNpc3RlbnRNZXRhRGF0YS5UWVBFX05PTl9NQVBQ\nRURfSU5URVJGQUNFKTsKICAgICAgICAgICAgX25vbk1hcHBlZC5wdXQoaWZh\nY2UsIG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgICAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBub24tbWFwcGVkIGludGVyZmFj\nZSBmcm9tIHRoZSByZXBvc2l0b3J5CiAgICAgKiAKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiByZW1vdmVkCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZU5vbk1hcHBlZEludGVyZmFjZShDbGFzczw/PiBpZmFjZSkgewogICAg\nICAgIHJldHVybiBfbm9uTWFwcGVkLnJlbW92ZShpZmFjZSkgIT0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIHRoZSBjYWNoZSBvZiBwYXJz\nZWQgbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGFsc28gY2xlYXJzIHRoZSBpbnRl\ncm5hbAogICAgICoge0BsaW5rIE1ldGFEYXRhRmFjdG9yeSBNZXRhRGF0YUZh\nY3Rvcnl9J3MgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJjbGVhci1yZXBvcyIs\nIHRoaXMpKTsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAg\nc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBjbGVhcklu\ndGVybmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBjbGVhckludGVybmFsKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBjbGVhckludGVybmFsKCl7CiAgICAgICAgLy8gUmVj\ncmVhdGluZyB0aGVzZSBkYXRhc3RydWN0dXJlcyBpcyBwcm9iYWJseSBmYXN0\nZXIgdGhhbiBjYWxsaW5nIGNsZWFyLiBGdXR1cmUgY2hhbmdlPwogICAgICAg\nICAgICBfbWV0YXMuY2xlYXIoKTsKICAgICAgICAgICAgX29pZHMuY2xlYXIo\nKTsKICAgICAgICAgICAgX3N1YnMuY2xlYXIoKTsKICAgICAgICAgICAgX2lt\ncGxzLmNsZWFyKCk7CiAgICAgICAgICAgIF9xdWVyaWVzLmNsZWFyKCk7CiAg\nICAgICAgICAgIF9zZXFzLmNsZWFyKCk7CiAgICAgICAgICAgIF9yZWdpc3Rl\ncmVkLmNsZWFyKCk7CiAgICAgICAgICAgIF9mYWN0b3J5LmNsZWFyKCk7CiAg\nICAgICAgICAgIF9hbGlhc2VzLmNsZWFyKCk7CiAgICAgICAgICAgIF9wYXdh\ncmVzLmNsZWFyKCk7CiAgICAgICAgICAgIF9ub25NYXBwZWQuY2xlYXIoKTsK\nICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQgb2YgY29uZmln\ndXJlZCBwZXJzaXN0ZW50IGNsYXNzZXMsIG9yIG51bGwgaWYgdGhlIHVzZXIg\nZGlkIG5vdCBjb25maWd1cmUgYW55LgogICAgICogCiAgICAgKiBAcGFyYW0g\nZGV2cGF0aAogICAgICogICAgICAgICAgICBpZiB0cnVlLCBzZWFyY2ggZm9y\nIG1ldGFkYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzIGluIHRoZSBjbGFzc3Bh\ndGggaWYgbm8gY2xhc3NlcwogICAgICogICAgICAgICAgICBhcmUgY29uZmln\ndXJlZCBleHBsaWNpdGx5CiAgICAgKiBAcGFyYW0gZW52TG9hZGVyCiAgICAg\nKiAgICAgICAgICAgIHRoZSBjbGFzcyBsb2FkZXIgdG8gdXNlLCBvciBudWxs\nIGZvciBkZWZhdWx0CiAgICAgKi8KICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBn\nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFBlcnNpc3RlbnRUeXBlTmFtZXNJbnRlcm5hbChkZXZw\nYXRoLCBlbnZMb2FkZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIGdldFBlcnNpc3RlbnRUeXBlTmFtZXNJ\nbnRlcm5hbChkZXZwYXRoLCBlbnZMb2FkZXIpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIFNldDxTdHJpbmc+IGdldFBlcnNpc3RlbnRUeXBlTmFt\nZXNJbnRlcm5hbChib29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxv\nYWRlcikgewogICAgICAgIHJldHVybiBfZmFjdG9yeS5nZXRQZXJzaXN0ZW50\nVHlwZU5hbWVzKGRldnBhdGgsIGVudkxvYWRlcik7CiAgICB9CiAgICAvKioK\nICAgICAqIExvYWQgdGhlIHBlcnNpc3RlbnQgY2xhc3NlcyBuYW1lZCBpbiBj\nb25maWd1cmF0aW9uLgogICAgICogVGhpcyBlbnN1cmVzIHRoYXQgYWxsIHN1\nYmNsYXNzZXMgYW5kIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzZXMgb2YK\nICAgICAqIGVhY2ggdHlwZSBhcmUga25vd24gaW4gYWR2YW5jZSwgd2l0aG91\ndCBoYXZpbmcgdG8gcmVseSBvbiB0aGUKICAgICAqIGFwcGxpY2F0aW9uIGxv\nYWRpbmcgdGhlIGNsYXNzZXMgYmVmb3JlIHBlcmZvcm1pbmcgb3BlcmF0aW9u\ncyB0aGF0CiAgICAgKiBtaWdodCBpbnZvbHZlIHRoZW0uCiAgICAgKgogICAg\nICogQHBhcmFtIGRldnBhdGggaWYgdHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0\nYSBmaWxlcyBpbiBkaXJlY3RvcmllcwogICAgICogaW4gdGhlIGNsYXNzcGF0\naCBpZiB0aGUgbm8gY2xhc3NlcyBhcmUgY29uZmlndXJlZCBleHBsaWNpdGx5\nCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRoZSBjbGFzcyBsb2FkZXIgdG8g\ndXNlLCBvciBudWxsIGZvciBkZWZhdWx0CiAgICAgKiBAcmV0dXJuIHRoZSBs\nb2FkZWQgY2xhc3Nlcywgb3IgZW1wdHkgY29sbGVjdGlvbiBpZiBub25lCiAg\nICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9uPENsYXNzPD8+PiBsb2FkUGVy\nc2lzdGVudFR5cGVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyKSB7CiAgICAgICAgcmV0dXJuIGxvYWRQZXJzaXN0ZW50VHlwZXMo\nZGV2cGF0aCwgZW52TG9hZGVyLCBmYWxzZSk7CiAgICB9CiAgICAvKioKICAg\nICAqIExvYWQgdGhlIHBlcnNpc3RlbnQgY2xhc3NlcyBuYW1lZCBpbiBjb25m\naWd1cmF0aW9uLiBUaGlzIGVuc3VyZXMgdGhhdCBhbGwgc3ViY2xhc3NlcyBh\nbmQKICAgICAqIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzZXMgb2YgZWFj\naCB0eXBlIGFyZSBrbm93biBpbiBhZHZhbmNlLCB3aXRob3V0IGhhdmluZyB0\nbyByZWx5IG9uIHRoZQogICAgICogYXBwbGljYXRpb24gbG9hZGluZyB0aGUg\nY2xhc3NlcyBiZWZvcmUgcGVyZm9ybWluZyBvcGVyYXRpb25zIHRoYXQgbWln\naHQgaW52b2x2ZSB0aGVtLgogICAgICogCiAgICAgKiBAcGFyYW0gZGV2cGF0\naAogICAgICogICAgICAgICAgICBpZiB0cnVlLCBzZWFyY2ggZm9yIG1ldGFk\nYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzIGluIHRoZSBjbGFzc3BhdGggaWYg\ndGhlIG5vCiAgICAgKiAgICAgICAgICAgIGNsYXNzZXMgYXJlIGNvbmZpZ3Vy\nZWQgZXhwbGljaXRseQogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICog\nICAgICAgICAgICB0aGUgY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3IgbnVsbCBm\nb3IgZGVmYXVsdAogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAg\nICAgICAgICBpZiB0cnVlIHRoZW4gZW1wdHkgbGlzdCBvZiBjbGFzc2VzIG9y\nIGFueSB1bmxvYWRhYmxlIGJ1dCBzcGVjaWZpZWQgY2xhc3Mgd2lsbAogICAg\nICogICAgICAgICAgICByYWlzZSBhbiBleGNlcHRpb24uCiAgICAgKiBAcmV0\ndXJuIHRoZSBsb2FkZWQgY2xhc3Nlcywgb3IgZW1wdHkgY29sbGVjdGlvbiBp\nZiBub25lCiAgICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9uPENsYXNzPD8+\nPiBsb2FkUGVyc2lzdGVudFR5cGVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsb2FkUGVyc2lzdGVudFR5\ncGVzSW50ZXJuYWwoZGV2cGF0aCwgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0\ndXJuIGxvYWRQZXJzaXN0ZW50VHlwZXNJbnRlcm5hbChkZXZwYXRoLCBlbnZM\nb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgQ29sbGVjdGlvbjxDbGFzczw/Pj4gbG9hZFBlcnNpc3RlbnRUeXBlc0lu\ndGVybmFsKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVy\nLCAKICAgICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgICAgICBT\nZXQ8U3RyaW5nPiBuYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZGV2\ncGF0aCwgZW52TG9hZGVyKTsKICAgICAgICAgICAgaWYgKG5hbWVzID09IG51\nbGwgfHwgbmFtZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIW11c3RFeGlzdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlYWdlci1uby1jbGFzcy1mb3VuZCIpKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gYXR0ZW1wdCB0byBsb2FkIGNsYXNzZXMgc28g\ndGhhdCB0aGV5IGdldCBwcm9jZXNzZWQKICAgICAgICAgICAgQ2xhc3NMb2Fk\nZXIgY2xzTG9hZGVyID0gX2NvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNl\nKCkuZ2V0Q2xhc3NMb2FkZXIoZ2V0Q2xhc3MoKSwgZW52TG9hZGVyKTsKICAg\nICAgICAgICAgTGlzdDxDbGFzczw/Pj4gY2xhc3NlcyA9IG5ldyBBcnJheUxp\nc3Q8Q2xhc3M8Pz4+KG5hbWVzLnNpemUoKSk7CiAgICAgICAgICAgIENsYXNz\nPD8+IGNsczsKICAgICAgICAgICAgZm9yIChTdHJpbmcgY2xhc3NOYW1lIDog\nbmFtZXMpIHsKICAgICAgICAgICAgICAgIGNscyA9IGNsYXNzRm9yTmFtZShj\nbGFzc05hbWUsIGNsc0xvYWRlcik7CiAgICAgICAgICAgICAgICBpZiAoX2Zh\nY3RvcnkuaXNNZXRhQ2xhc3MoY2xzKSkgewogICAgICAgICAgICAgICAgICAg\nIHNldE1ldGFNb2RlbChjbHMpOwogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNs\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGQo\nY2xzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGNsYXNzIGlz\nIGFuIGludGVyZmFjZSwgbG9hZCBpdHMgbWV0YWRhdGEgdG8ga2ljawogICAg\nICAgICAgICAgICAgICAgIC8vIG9mZiB0aGUgaW1wbCBnZW5lcmF0b3IKICAg\nICAgICAgICAgICAgICAgICBpZiAoY2xzLmlzSW50ZXJmYWNlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgY2xzTG9hZGVy\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNscyA9PSBu\ndWxsICYmIG11c3RFeGlzdCkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZWFnZXItY2xhc3Mt\nbm90LWZvdW5kIiwgY2xhc3NOYW1lKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNsYXNzZXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsYXNzIGZvciB0aGUgZ2l2\nZW4gbmFtZSwgb3IgbnVsbCBpZiBub3QgbG9hZGFibGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgQ2xhc3M8Pz4gY2xhc3NGb3JOYW1lKFN0cmluZyBuYW1lLCBD\nbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gQ2xhc3MuZm9yTmFtZShuYW1lLCB0cnVlLCBsb2FkZXIpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlm\nICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWRpc2NvdmVy\nLWNsYXNzIiwgbmFtZSwgbG9hZGVyKSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoX2xvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9n\nLmluZm8oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5hbWUsIGxv\nYWRlcikpOwogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShlKTsKICAgICAgICB9IGNh\ndGNoIChOb1N1Y2hNZXRob2RFcnJvciBuc21lKSB7CiAgICAgICAgICAgIGlm\nIChuc21lLmdldE1lc3NhZ2UoKS5pbmRleE9mKCIucGMiKSA9PSAtMSkKICAg\nICAgICAgICAgICAgIHRocm93IG5zbWU7CgogICAgICAgICAgICAvLyBpZiB0\naGUgZXJyb3IgaXMgYWJvdXQgYSBtZXRob2QgdGhhdCB1c2VzIHRoZSBQZXJz\naXN0ZW5jZUNhcGFibGUKICAgICAgICAgICAgLy8gJ3BjJyBtZXRob2QgcHJl\nZml4LCBwZXJmb3JtIHNvbWUgbG9nZ2luZyBhbmQgY29udGludWUuIFRoaXMK\nICAgICAgICAgICAgLy8gcHJvYmFibHkganVzdCBtZWFucyB0aGF0IHRoZSBj\nbGFzcyBpcyBub3QgeWV0IGVuaGFuY2VkLgogICAgICAgICAgICBpZiAoKF92\nYWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAgICAg\nICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFz\ncyIsIG5hbWUsIGxvYWRlcikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9s\nb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZv\nKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBuYW1lLCBsb2FkZXIp\nKTsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cudHJhY2UobnNtZSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGFsbCBrbm93biBzdWJjbGFzc2VzIGZvciB0aGUgZ2l2ZW4gY2xhc3MgbWFw\ncGluZy4gTm90ZSB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgd29ya3MKICAgICAq\nIGR1cmluZyBydW50aW1lIHdoZW4gdGhlIHJlcG9zaXRvcnkgaXMgcmVnaXN0\nZXJlZCBhcyBhIHtAbGluayBSZWdpc3RlckNsYXNzTGlzdGVuZXJ9LgogICAg\nICovCiAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBnZXRQQ1N1YmNsYXNzZXMo\nQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/Pj4g\nc3VicyA9IF9zdWJzLmdldChjbHMpOwogICAgICAgIGlmIChzdWJzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0eUxpc3Qo\nKTsKICAgICAgICByZXR1cm4gc3ViczsKICAgIH0KCiAgICAvLyAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVnaXN0\nZXJDbGFzc0xpc3RlbmVyIGltcGxlbWVudGF0aW9uCiAgICAvLyAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2\nb2lkIHJlZ2lzdGVyKENsYXNzPD8+IGNscykgewogICAgICAgIC8vIGJ1ZmZl\nciByZWdpc3RlcmVkIGNsYXNzZXMgdW50aWwgYW4gb2lkIG1ldGFkYXRhIHJl\ncXVlc3QgaXMgbWFkZSwKICAgICAgICAvLyBhdCB3aGljaCBwb2ludCB3ZSds\nbCBwYXJzZSBldmVyeXRoaW5nIGluIHRoZSBidWZmZXIKICAgICAgICBpZiAo\nX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfcmVnaXN0\nZXJlZCkgewogICAgICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRkKGNscyk7\nCiAgICAgICAgICAgICAgICByZWdpc3RlckFsaWFzKGNscyk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfcmVnaXN0ZXJl\nZC5hZGQoY2xzKTsKICAgICAgICAgICAgcmVnaXN0ZXJBbGlhcyhjbHMpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlcyB0aGUgbWV0\nYWRhdGEgZm9yIGFsbCByZWdpc3RlcmVkIGNsYXNzZXMuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoQ2xh\nc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgQ2xhc3M8Pz5bXSByZWcg\nPSBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHJlZy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEocmVn\nW2ldLCBlbnZMb2FkZXIsIGZhbHNlKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nTWV0YURhdGFFeGNlcHRpb24gbWUpIHsKICAgICAgICAgICAgICAgIGlmIChf\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9n\nLndhcm4obWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogVXBkYXRlcyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0\naGUgbGF0ZXN0IHJlZ2lzdGVyZWQgY2xhc3Nlcy4KICAgICAqLwogICAgQ2xh\nc3M8Pz5bXSBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKF9yZWdpc3RlcmVkLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0NMQVNTRVM7CgogICAgICAg\nIC8vIGNvcHkgaW50byBuZXcgY29sbGVjdGlvbiB0byBhdm9pZCBjb25jdXJy\nZW50IG1vZCBlcnJvcnMgb24gcmVlbnRyYW50CiAgICAgICAgLy8gcmVnaXN0\ncmF0aW9ucwogICAgICAgIENsYXNzPD8+W10gcmVnOwogICAgICAgIGlmIChf\nbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKF9yZWdpc3Rl\ncmVkKSB7CiAgICAgICAgICAgICAgICByZWcgPSBfcmVnaXN0ZXJlZC50b0Fy\ncmF5KG5ldyBDbGFzc1tfcmVnaXN0ZXJlZC5zaXplKCldKTsKICAgICAgICAg\nICAgICAgIF9yZWdpc3RlcmVkLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICByZWcgPSBfcmVnaXN0ZXJlZC50\nb0FycmF5KG5ldyBDbGFzc1tfcmVnaXN0ZXJlZC5zaXplKCldKTsKICAgICAg\nICAgICAgX3JlZ2lzdGVyZWQuY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAg\nCgogICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiBwY05hbWVzID0gZ2V0UGVy\nc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICBD\nb2xsZWN0aW9uPENsYXNzPD8+PiBmYWlsZWQgPSBudWxsOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIC8vIGRvbid0IHByb2Nlc3MgdHlwZXMgdGhhdCBhcmVuJ3QgbGlzdGVk\nIGJ5IHRoZSB1c2VyOyBtYXkgYmVsb25nCiAgICAgICAgICAgIC8vIHRvIGEg\nZGlmZmVyZW50IHBlcnNpc3RlbmNlIHVuaXQKICAgICAgICAgICAgaWYgKHBj\nTmFtZXMgIT0gbnVsbCAmJiAhcGNOYW1lcy5pc0VtcHR5KCkgJiYgIXBjTmFt\nZXMuY29udGFpbnMocmVnW2ldLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzKHJlZ1tpXSk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICBpZiAo\nIV9jb25mLmdldFJldHJ5Q2xhc3NSZWdpc3RyYXRpb24oKSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImVycm9yLXJlZ2lzdGVyZWQiLCByZWdbaV0pLCB0KTsKCiAgICAgICAg\nICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJmYWlsZWQtcmVnaXN0ZXJl\nZCIsIHJlZ1tpXSksIHQpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZhaWxlZCA9IG5ldyBBcnJh\neUxpc3Q8Q2xhc3M8Pz4+KCk7CiAgICAgICAgICAgICAgICBmYWlsZWQuYWRk\nKHJlZ1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKGZhaWxlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfbG9ja2luZykg\newogICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChfcmVnaXN0ZXJlZCkg\newogICAgICAgICAgICAgICAgICAgIF9yZWdpc3RlcmVkLmFkZEFsbChmYWls\nZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRkQWxsKGZhaWxlZCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlZzsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgb3VyIGRhdGFzdHJ1Y3R1cmVz\nIHdpdGggdGhlIGdpdmVuIHJlZ2lzdGVyZWQgY2xhc3MuIFJlbGllcyBvbiB0\naGUgZmFjdCB0aGF0IGEgY2hpbGQKICAgICAqIGNsYXNzIGNhbm5vdCByZWdp\nc3RlciBpdHNlbGYgd2l0aG91dCBhbHNvIHJlZ2lzdGVyaW5nIGl0cyBwYXJl\nbnQgY2xhc3MgYnkgc3BlY2lmeWluZyBpdHMKICAgICAqIHBlcnNpc3RlbmNl\nIGNhcGFibGUgc3VwZXJjbGFzcyBpbiB0aGUgcmVnaXN0cmF0aW9uIGV2ZW50\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1JlZ2lzdGVyZWRD\nbGFzcyhDbGFzczw/PiBjbHMpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJw\ncm9jZXNzLXJlZ2lzdGVyZWQiLCBjbHMpKTsKCiAgICAgICAgLy8gdXBkYXRl\nIHN1YmNsYXNzIGxpc3RzOyBzeW5jaHJvbml6ZSBvbiB0aGlzIGJlY2F1c2Ug\nYWNjZXNzaW5nIF9tZXRhcwogICAgICAgIC8vIHJlcXVpcmVzIGl0CiAgICAg\nICAgQ2xhc3M8Pz4gbGVhc3REZXJpdmVkID0gY2xzOwogICAgICAgIHN5bmNo\ncm9uaXplZCAodGhpcykgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGE7CiAgICAgICAgICAgIGZvciAoQ2xhc3M8Pz4gYW5jID0gY2xzOyAoYW5j\nID0gUENSZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhhbmMpKSAh\nPSBudWxsOykgewogICAgICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uKF9z\ndWJzLCBhbmMsIGNscywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBtZXRhID0g\nKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoYW5jKTsKICAgICAgICAgICAg\nICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWV0\nYS5jbGVhclN1YmNsYXNzQ2FjaGUoKTsKICAgICAgICAgICAgICAgIGxlYXN0\nRGVyaXZlZCA9IGFuYzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICAKICAgICAgICAvLyB1cGRhdGUgb2lkIG1hcHBpbmdzIGlmIHRoaXMgaXMg\nYSBiYXNlIGNvbmNyZXRlIGNsYXNzCiAgICAgICAgT2JqZWN0IG9pZCA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lkID0gUENSZWdpc3Ry\neS5uZXdPYmplY3RJZChjbHMpOwogICAgICAgIH0gY2F0Y2ggKEludGVybmFs\nRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIC8vIHRocm93biBmb3Igc2lu\nZ2xlIGZpZWxkIGlkZW50aXR5IHdpdGggbnVsbCBwayBmaWVsZCB2YWx1ZQog\nICAgICAgIH0KICAgICAgICBpZiAob2lkICE9IG51bGwpIHsKICAgICAgICAg\nICAgQ2xhc3M8Pz4gZXhpc3RpbmcgPSBfb2lkcy5nZXQob2lkLmdldENsYXNz\nKCkpOwogICAgICAgICAgICBpZiAoZXhpc3RpbmcgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNsYXNzIGZv\nciB0aGlzIE9JRCwgdGhlbiB3ZSBrbm93CiAgICAgICAgICAgICAgICAvLyB0\naGF0IG11bHRpcGxlIGNsYXNzZXMgYXJlIHVzaW5nIHRoZSBzYW1lIE9JRDog\ndGhlcmVmb3JlLAogICAgICAgICAgICAgICAgLy8gcHV0IHRoZSBsZWFzdCBk\nZXJpdmVkIFBDIHN1cGVyY2xhc3MgaW50byB0aGUgbWFwLiBUaGlzCiAgICAg\nICAgICAgICAgICAvLyBnZXRzIGFyb3VuZCB0aGUgcHJvYmxlbSBvZiBhbiBh\nYnN0cmFjdCBQQyBzdXBlcmNsYXNzCiAgICAgICAgICAgICAgICAvLyB1c2lu\nZyBhcHBsaWNhdGlvbiBpZGVudGl0eSAoc2luY2UgbmV3T2JqZWN0SWQKICAg\nICAgICAgICAgICAgIC8vIHdpbGwgcmV0dXJuIG51bGwgZm9yIGFic3RyYWN0\nIGNsYXNzZXMpLgogICAgICAgICAgICAgICAgQ2xhc3M8Pz4gc3VwID0gY2xz\nOwogICAgICAgICAgICAgICAgd2hpbGUgKFBDUmVnaXN0cnkuZ2V0UGVyc2lz\ndGVudFN1cGVyY2xhc3Moc3VwKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHN1cCA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3Mo\nc3VwKTsKCiAgICAgICAgICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNz\nKCksIHN1cCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXhpc3RpbmcgPT0g\nbnVsbCB8fCBjbHMuaXNBc3NpZ25hYmxlRnJvbShleGlzdGluZykpCiAgICAg\nICAgICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCksIGNscyk7CiAg\nICAgICAgfQoKICAgICAgICAvLyB1cGRhdGUgbWFwcGluZ3MgZnJvbSBpbnRl\ncmZhY2VzIGFuZCBub24tcGMgc3VwZXJjbGFzc2VzIHRvCiAgICAgICAgLy8g\ncGMgaW1wbGVtZW50aW5nIHR5cGVzCiAgICAgICAgaWYgKF9sb2NraW5nKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoX2ltcGxzKSB7CiAgICAgICAg\nICAgICAgICB1cGRhdGVJbXBscyhjbHMsIGxlYXN0RGVyaXZlZCwgY2xzKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVw\nZGF0ZUltcGxzKGNscywgbGVhc3REZXJpdmVkLCBjbHMpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gc2V0IGFsaWFzIGZvciBjbGFzcwogICAgICAgIHJlZ2lz\ndGVyQWxpYXMoY2xzKTsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAq\nIFJlZ2lzdGVyIHRoZSBnaXZlbiBjbGFzcyB0byB0aGUgbGlzdCBvZiBrbm93\nbiBhbGlhc2VzLgogICAgICogVGhlIGFsaWFzIGlzIHJlZ2lzdGVyZWQgb25s\neSBpZiB0aGUgY2xhc3MgaGFzIGJlZW4gZW5oYW5jZWQuCiAgICAgKiAKICAg\nICAqLwogICAgdm9pZCByZWdpc3RlckFsaWFzKENsYXNzPD8+IGNscykgewog\nICAgICAgIHJlZ2lzdGVyQWxpYXMoUENSZWdpc3RyeS5nZXRUeXBlQWxpYXMo\nY2xzKSwgY2xzKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgcmVnaXN0\nZXJBbGlhcyhTdHJpbmcgYWxpYXMsIENsYXNzPD8+IGNscykgewogICAgICAg\nIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNzZXMgPSBfYWxpYXNl\ncy5nZXQoYWxpYXMpOwogICAgICAgICAgICAgICAgaWYgKGNsYXNzZXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBjbGFzc2VzID0gbmV3IEFycmF5\nTGlzdDxDbGFzczw/Pj4oMyk7CiAgICAgICAgICAgICAgICBpZiAoIWNsYXNz\nZXMuY29udGFpbnMoY2xzKSkgewogICAgICAgICAgICAgICAgICAgIGNsYXNz\nZXMuYWRkKGNscyk7CiAgICAgICAgICAgICAgICAgICAgX2FsaWFzZXMucHV0\nKGFsaWFzLCBjbGFzc2VzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBp\nc2UpIHsKICAgICAgICAgICAgLy8gdGhlIGNsYXNzIGhhcyBub3QgYmVlbiBy\nZWdpc3RlcmVkIHRvIFBDUmVnaXN0cnkKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVcGRhdGUgdGhlIGxpc3Qgb2YgaW1wbGVtZW50YXRpb25z\nIG9mIGJhc2UgY2xhc3NlcyBhbmQgaW50ZXJmYWNlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHVwZGF0ZUltcGxzKENsYXNzPD8+IGNscywgQ2xhc3M8\nPz4gbGVhc3REZXJpdmVkLCBDbGFzczw/PiBjaGVjaykgewogICAgICAgIC8v\nIGFsbG93IHVzZXJzIHRvIHF1ZXJ5IG9uIGNvbW1vbiBub24tcGMgc3VwZXJj\nbGFzc2VzCiAgICAgICAgQ2xhc3M8Pz4gc3VwID0gY2hlY2suZ2V0U3VwZXJj\nbGFzcygpOwogICAgICAgIGlmIChsZWFzdERlcml2ZWQgPT0gY2xzICYmIHN1\ncCAhPSBudWxsICYmIHN1cCAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAg\nICAgYWRkVG9Db2xsZWN0aW9uKF9pbXBscywgc3VwLCBjbHMsIGZhbHNlKTsK\nICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIHN1\ncCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhbGxvdyB1c2VycyB0byBxdWVy\neSBvbiBhbnkgaW1wbGVtZW50ZWQgaW50ZXJmYWNlcyB1bmxlc3MgZGVmYXVs\ndHMKICAgICAgICAvLyBzYXkgdGhlIHVzZXIgbXVzdCBpbXBsZW1lbnQgcGVy\nc2lzdGVudCBpbnRlcmZhY2VzIGV4cGxpY2l0bHkgaW4gbWV0YQogICAgICAg\nIGlmICghX2ZhY3RvcnkuZ2V0RGVmYXVsdHMoKS5pc0RlY2xhcmVkSW50ZXJm\nYWNlUGVyc2lzdGVudCgpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nQ2xhc3M8Pz5bXSBpbnRzID0gY2hlY2suZ2V0SW50ZXJmYWNlcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW50cy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAvLyBkb24ndCBtYXAgamF2YS1zdGFuZGFyZCBpbnRlcmZh\nY2VzCiAgICAgICAgICAgIGlmIChpbnRzW2ldLmdldE5hbWUoKS5zdGFydHNX\naXRoKCJqYXZhLiIpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICAvLyBvbmx5IG1hcCBsZWFzdC1kZXJpdmVkIGludGVyZmFjZSBp\nbXBsZW1lbnRvcnMKICAgICAgICAgICAgaWYgKGxlYXN0RGVyaXZlZCA9PSBj\nbHMgfHwgaXNMZWFzdERlcml2ZWRJbXBsKGludHNbaV0sIGNscykpIHsKICAg\nICAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfaW1wbHMsIGludHNbaV0s\nIGNscywgZmFsc2UpOwogICAgICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xz\nLCBsZWFzdERlcml2ZWQsIGludHNbaV0pOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhl\nIGdpdmVuIGNsYXNzIGlzIHRoZSBsZWFzdC1kZXJpdmVkIHBlcnNpc3RlbnQg\naW1wbGVtZW50b3Igb2YgdGhlIGdpdmVuCiAgICAgKiBpbnRlcmZhY2UsIGZh\nbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlz\nTGVhc3REZXJpdmVkSW1wbChDbGFzczw/PiBpbnRlciwgQ2xhc3M8Pz4gY2xz\nKSB7CiAgICAgICAgQ2xhc3M8Pz4gcGFyZW50ID0gUENSZWdpc3RyeS5nZXRQ\nZXJzaXN0ZW50U3VwZXJjbGFzcyhjbHMpOwogICAgICAgIHdoaWxlIChwYXJl\nbnQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoQXJyYXlzLmFzTGlzdChw\nYXJlbnQuZ2V0SW50ZXJmYWNlcygpKS5jb250YWlucyhpbnRlcikpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHBhcmVudCA9\nIFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3MocGFyZW50KTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBjb2xsZWN0aW9u\nIGNhY2hlZCBpbiB0aGUgZ2l2ZW4gbWFwIHVuZGVyIHRoZSBnaXZlbiBrZXku\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRUb0NvbGxlY3Rpb24oTWFw\nIG1hcCwgQ2xhc3M8Pz4ga2V5LCBDbGFzczw/PiB2YWx1ZSwgYm9vbGVhbiBp\nbmhlcml0YW5jZSkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKG1hcCkgewogICAgICAgICAgICAgICAgYWRk\nVG9Db2xsZWN0aW9uSW50ZXJuYWwobWFwLCBrZXksIHZhbHVlLCBpbmhlcml0\nYW5jZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBhZGRUb0NvbGxlY3Rpb25JbnRlcm5hbChtYXAsIGtleSwgdmFsdWUs\nIGluaGVyaXRhbmNlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIGFkZFRvQ29sbGVjdGlvbkludGVybmFsKE1hcCBtYXAsIENsYXNzPD8+\nIGtleSwgQ2xhc3M8Pz4gdmFsdWUsIGJvb2xlYW4gaW5oZXJpdGFuY2UpIHsK\nICAgICAgICBDb2xsZWN0aW9uIGNvbGwgPSAoQ29sbGVjdGlvbikgbWFwLmdl\ndChrZXkpOwogICAgICAgIGlmIChjb2xsID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKGluaGVyaXRhbmNlKSB7CiAgICAgICAgICAgICAgICBJbmhlcml0\nYW5jZUNvbXBhcmF0b3IgY29tcCA9IG5ldyBJbmhlcml0YW5jZUNvbXBhcmF0\nb3IoKTsKICAgICAgICAgICAgICAgIGNvbXAuc2V0QmFzZShrZXkpOwogICAg\nICAgICAgICAgICAgY29sbCA9IG5ldyBUcmVlU2V0PENsYXNzPD8+Pihjb21w\nKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBjb2xsID0g\nbmV3IExpbmtlZExpc3Q8Q2xhc3M8Pz4+KCk7CiAgICAgICAgICAgIG1hcC5w\ndXQoa2V5LCBjb2xsKTsKICAgICAgICB9CiAgICAgICAgY29sbC5hZGQodmFs\ndWUpOwogICAgfQoKICAgIC8qKgogICAgICogUHV0cyB0aGUgbWV0YSBjbGFz\ncyBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBlbnRpdHkgY2xhc3MuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1ldGFNb2RlbChDbGFzczw/PiBt\nMikgewogICAgICAgIENsYXNzPD8+IGNscyA9IF9mYWN0b3J5LmdldE1hbmFn\nZWRDbGFzcyhtMik7CiAgICAgICAgaWYgKGNscyAhPSBudWxsKQogICAgICAg\nICAgICBfbWV0YW1vZGVsLnB1dChjbHMsIG0yKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFB1dHMgdGhlIG1ldGEgY2xhc3MgY29ycmVzcG9uZGluZyB0byB0\naGUgZ2l2ZW4gcGVyc2lzdGVudCBjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0TWV0YU1vZGVsKENsYXNzTWV0YURhdGEgbWV0YSwgQ2xhc3M8\nPz4gbTIpIHsKICAgICAgICBfbWV0YW1vZGVsLnB1dChtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSwgbTIpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0\naGUgbWV0YSBjbGFzcyBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBwZXJz\naXN0ZW50IGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0\nTWV0YU1vZGVsKENsYXNzTWV0YURhdGEgbWV0YSwgYm9vbGVhbiBsb2FkKSB7\nCiAgICAgICAgcmV0dXJuIGdldE1ldGFNb2RlbChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwgbG9hZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRo\nZSBtZXRhIGNsYXNzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGNsYXNz\nLiBJZiBsb2FkIGlzIGZhbHNlLCByZXR1cm5zIHRoZSBtZXRhCiAgICAgKiBj\nbGFzcyBpZiBoYXMgYmVlbiBzZXQgZm9yIHRoZSBnaXZlbiBwZXJzaXN0ZW50\nIGNsYXNzIGVhcmxpZXIuIElmIHRoZSBsb2FkIGlzIHRydWUgdGhlbiBhbHNv\nCiAgICAgKiBhdHRlbXB0cyB0byBhcHBseSB0aGUgY3VycmVudCBuYW1pbmcg\ncG9saWN5IHRvIGRlcml2ZSBtZXRhIGNsYXNzIG5hbWUgYW5kIGF0dGVtcHRz\nIHRvIGxvYWQKICAgICAqIHRoZSBtZXRhIGNsYXNzLgogICAgICovCiAgICBw\ndWJsaWMgQ2xhc3M8Pz4gZ2V0TWV0YU1vZGVsKENsYXNzPD8+IGVudGl0eSwg\nYm9vbGVhbiBsb2FkKSB7CiAgICAgICAgaWYgKF9tZXRhbW9kZWwuY29udGFp\nbnNLZXkoZW50aXR5KSkKICAgICAgICAgICAgcmV0dXJuIF9tZXRhbW9kZWwu\nZ2V0KGVudGl0eSk7CiAgICAgICAgU3RyaW5nIG0yID0gX2ZhY3RvcnkuZ2V0\nTWV0YU1vZGVsQ2xhc3NOYW1lKGVudGl0eS5nZXROYW1lKCkpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGVudGl0eSkpOwogICAgICAgICAgICBDbGFzczw/\nPiBtMmNscyA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Q\ncml2SGVscGVyLmdldEZvck5hbWVBY3Rpb24obTIsIHRydWUsIGxvYWRlcikp\nOwogICAgICAgICAgICBfbWV0YW1vZGVsLnB1dChlbnRpdHksIG0yY2xzKTsK\nICAgICAgICAgICAgcmV0dXJuIG0yY2xzOwogICAgICAgIH0gY2F0Y2ggKFRo\ncm93YWJsZSB0KSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgibWV0\nYS1uby1tb2RlbCIsIG0yLCBlbnRpdHksIHQpKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8gLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbmZpZ3VyYWJsZSBpbXBsZW1lbnRh\ndGlvbgogICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24g\nY29uZikgewogICAgICAgIF9jb25mID0gKE9wZW5KUEFDb25maWd1cmF0aW9u\nKSBjb25mOwogICAgICAgIF9sb2cgPSBfY29uZi5nZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX01FVEFEQVRBKTsKICAgICAgICBfcmVvcmRlck1l\ndGFEYXRhUmVzb2x1dGlvbiA9IF9jb25mLmdldENvbXBhdGliaWxpdHlJbnN0\nYW5jZSgpLmdldFJlb3JkZXJNZXRhRGF0YVJlc29sdXRpb24oKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3VyYXRpb24oKSB7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJhdGlvbigpIHsKICAgICAg\nICBpbml0aWFsaXplTWV0YURhdGFGYWN0b3J5KCk7CiAgICAgICAgaWYgKF9p\nbXBsR2VuID09IG51bGwpCiAgICAgICAgICAgIF9pbXBsR2VuID0gbmV3IElu\ndGVyZmFjZUltcGxHZW5lcmF0b3IodGhpcyk7CiAgICAgICAgaWYgKF9wcmVs\nb2FkID09IHRydWUpIHsKICAgICAgICAgICAgX29pZHMgPSBuZXcgSGFzaE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+KCk7CiAgICAgICAgICAgIF9pbXBscyA9\nIG5ldyBIYXNoTWFwPENsYXNzPD8+LCBDb2xsZWN0aW9uPENsYXNzPD8+Pj4o\nKTsKICAgICAgICAgICAgX2lmYWNlcyA9IG5ldyBIYXNoTWFwPENsYXNzPD8+\nLCBDbGFzczw/Pj4oKTsKICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFz\naE1hcDxTdHJpbmcsIExpc3Q8Q2xhc3M8Pz4+PigpOwogICAgICAgICAgICBf\ncGF3YXJlcyA9IG5ldyBIYXNoTWFwPENsYXNzPD8+LCBOb25QZXJzaXN0ZW50\nTWV0YURhdGE+KCk7CiAgICAgICAgICAgIF9ub25NYXBwZWQgPSBuZXcgSGFz\naE1hcDxDbGFzczw/PiwgTm9uUGVyc2lzdGVudE1ldGFEYXRhPigpOwogICAg\nICAgICAgICBfc3VicyA9IG5ldyBIYXNoTWFwPENsYXNzPD8+LCBMaXN0PENs\nYXNzPD8+Pj4oKTsKICAgICAgICAgICAgLy8gV2FpdCB0aWxsIHdlJ3JlIGRv\nbmUgbG9hZGluZyBNZXRhRGF0YSB0byBmbGlwIF9sb2NrIGJvb2xlYW4uCiAg\nICAgICAgfSAgICAgICAgICAgIAogICAgfQoKICAgIHByaXZhdGUgdm9pZCBp\nbml0aWFsaXplTWV0YURhdGFGYWN0b3J5KCkgewogICAgICAgIGlmIChfZmFj\ndG9yeSA9PSBudWxsKSB7CiAgICAgICAgICAgIE1ldGFEYXRhRmFjdG9yeSBt\nZGYgPSBfY29uZi5uZXdNZXRhRGF0YUZhY3RvcnlJbnN0YW5jZSgpOwogICAg\nICAgICAgICBpZiAobWRmID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGFkYXRh\nZmFjdG9yeSIpKTsKICAgICAgICAgICAgc2V0TWV0YURhdGFGYWN0b3J5KG1k\nZik7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIFF1ZXJ5IG1ldGFkYXRhCiAgICAvLyAvLy8vLy8vLy8vLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gcXVlcnkgbWV0YWRhdGEgZm9yIHRo\nZSBnaXZlbiBjbGFzcywgbmFtZSwgYW5kIGNsYXNzbG9hZGVyLgogICAgICov\nCiAgICBwdWJsaWMgUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhKENs\nYXNzPD8+IGNscywgU3RyaW5nIG5hbWUsIENsYXNzTG9hZGVyIGVudkxvYWRl\nciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBpZiAoX2xvY2tpbmcp\nIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UXVlcnlNZXRhRGF0YUludGVybmFsKGNscywg\nbmFtZSwgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFF1ZXJ5TWV0\nYURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVudkxvYWRlciwgbXVzdEV4aXN0\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBRdWVyeU1ldGFEYXRh\nIGdldFF1ZXJ5TWV0YURhdGFJbnRlcm5hbChDbGFzczw/PiBjbHMsIFN0cmlu\nZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIAogICAgICAgIGJvb2xl\nYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0\nYSA9IGdldFF1ZXJ5TWV0YURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVudkxv\nYWRlcik7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIC8vIGxvYWQgYWxsIHRoZSBtZXRhZGF0YXMgZm9yIGFsbCB0\naGUga25vd24gY2xhc3NlcyBzbyB0aGF0CiAgICAgICAgICAgICAgICAvLyBx\ndWVyeSBuYW1lcyBhcmUgc2VlbiBhbmQgcmVnaXN0ZXJlZAogICAgICAgICAg\nICAgICAgcmVzb2x2ZUFsbChlbnZMb2FkZXIpOwogICAgICAgICAgICAgICAg\nbWV0YSA9IGdldFF1ZXJ5TWV0YURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVu\ndkxvYWRlcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtZXRh\nID09IG51bGwgJiYgbXVzdEV4aXN0KSB7CiAgICAgICAgICAgICAgICBpZiAo\nY2xzID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXF1ZXJ5LW51\nbGwtY2xhc3MiLCBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAg\nICAgICAgICAgICAgICAgICAgICBlbnZMb2FkZXIpLCBuYW1lKSk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFtZWQtcXVl\ncnkiLCBjbHMsIG5hbWUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXNvbHZlIGFsbCBrbm93biBtZXRhZGF0YSBjbGFzc2VzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZUFsbChDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiB0\neXBlcyA9IGxvYWRQZXJzaXN0ZW50VHlwZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgZm9yIChDbGFzczw/PiBjIDogdHlwZXMpIHsKICAgICAgICAg\nICAgZ2V0TWV0YURhdGEoYywgZW52TG9hZGVyLCBmYWxzZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHF1ZXJ5IG1ldGFkYXRh\nIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIG5hbWUsIGFuZCBjbGFzc2xvYWRlci4K\nICAgICAqLwogICAgcHJpdmF0ZSBRdWVyeU1ldGFEYXRhIGdldFF1ZXJ5TWV0\nYURhdGFJbnRlcm5hbChDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lLCBDbGFz\nc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBRdWVyeU1ldGFE\nYXRhIHFtID0gbnVsbDsKICAgICAgICBpZiAoY2xzID09IG51bGwpIHsKICAg\nICAgICAgICAgcW0gPSBzZWFyY2hRdWVyeU1ldGFEYXRhQnlOYW1lKG5hbWUp\nOwogICAgICAgICAgICBpZiAocW0gIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBxbTsKICAgICAgICB9CiAgICAgICAgLy8gY2hlY2sgY2FjaGUK\nICAgICAgICBPYmplY3Qga2V5ID0gZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKTsK\nICAgICAgICBxbSA9IChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoa2V5\nKTsKICAgICAgICBpZiAocW0gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHFtOwoKICAgICAgICAvLyBnZXQgbWV0YWRhdGEgZm9yIGNsYXNzLCB3aGlj\naCB3aWxsIGZpbmQgcXVlcmllcyBpbiBtZXRhZGF0YSBmaWxlCiAgICAgICAg\naWYgKGNscyAhPSBudWxsICYmIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVy\nLCBmYWxzZSkgIT0gbnVsbCkgewogICAgICAgICAgICBxbSA9IF9xdWVyaWVz\nLmdldChrZXkpOwogICAgICAgICAgICBpZiAocW0gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBxbTsKICAgICAgICB9CiAgICAgICAgaWYgKChf\nc291cmNlTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAvLyBzZWUgaWYgZmFjdG9yeSBjYW4gZmln\ndXJlIG91dCBhIHNjb3BlIGZvciB0aGlzIHF1ZXJ5CiAgICAgICAgaWYgKGNs\ncyA9PSBudWxsKQogICAgICAgICAgICBjbHMgPSBfZmFjdG9yeS5nZXRRdWVy\neVNjb3BlKG5hbWUsIGVudkxvYWRlcik7CgogICAgICAgIC8vIG5vdCBpbiBj\nYWNoZTsgbG9hZAogICAgICAgIF9mYWN0b3J5LmxvYWQoY2xzLCBNT0RFX1FV\nRVJZLCBlbnZMb2FkZXIpOwogICAgICAgIHJldHVybiBfcXVlcmllcy5nZXQo\na2V5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVk\nIHF1ZXJ5IG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgUXVlcnlNZXRh\nRGF0YVtdIGdldFF1ZXJ5TWV0YURhdGFzKCkgewogICAgICAgIGlmIChfbG9j\na2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiAoUXVlcnlNZXRhRGF0YVtdKSBfcXVlcmll\ncy52YWx1ZXMoKS50b0FycmF5KG5ldyBRdWVyeU1ldGFEYXRhW19xdWVyaWVz\nLnNpemUoKV0pOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcmV0dXJuIChRdWVyeU1ldGFEYXRhW10pIF9xdWVyaWVzLnZh\nbHVlcygpLnRvQXJyYXkobmV3IFF1ZXJ5TWV0YURhdGFbX3F1ZXJpZXMuc2l6\nZSgpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjYWNoZWQgcXVlcnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1l\nLgogICAgICovCiAgICBwdWJsaWMgUXVlcnlNZXRhRGF0YSBnZXRDYWNoZWRR\ndWVyeU1ldGFEYXRhKENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURh\ndGEpIF9xdWVyaWVzLmdldChnZXRRdWVyeUtleShjbHMsIG5hbWUpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVy\nbiAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0KGdldFF1ZXJ5S2V5KGNs\ncywgbmFtZSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCBhIG5ldyBxdWVyeSBtZXRhZGF0YSB0byB0aGUgcmVwb3NpdG9yeSBhbmQg\ncmV0dXJuIGl0LgogICAgICovCiAgICBwdWJsaWMgUXVlcnlNZXRhRGF0YSBh\nZGRRdWVyeU1ldGFEYXRhKENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUpIHsK\nICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25p\nemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBRdWVyeU1ldGFEYXRhIG1l\ndGEgPSBuZXdRdWVyeU1ldGFEYXRhKGNscywgbmFtZSk7CiAgICAgICAgICAg\nICAgICBfcXVlcmllcy5wdXQoZ2V0UXVlcnlLZXkobWV0YSksIG1ldGEpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICAgICAgICAgIH0KICAg\nICAgICB9ZWxzZXsKICAgICAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRhID0g\nbmV3UXVlcnlNZXRhRGF0YShjbHMsIG5hbWUpOwogICAgICAgICAgICBfcXVl\ncmllcy5wdXQoZ2V0UXVlcnlLZXkobWV0YSksIG1ldGEpOwogICAgICAgICAg\nICByZXR1cm4gbWV0YTsgICAKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkgbWV0YWRhdGEgaW5zdGFuY2UuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBRdWVyeU1ldGFEYXRhIG5ld1F1ZXJ5TWV0\nYURhdGEoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgbmFtZSkgewogICAgICAgIFF1\nZXJ5TWV0YURhdGEgbWV0YSA9IG5ldyBRdWVyeU1ldGFEYXRhKG5hbWUpOwog\nICAgICAgIG1ldGEuc2V0RGVmaW5pbmdUeXBlKGNscyk7CiAgICAgICAgcmV0\ndXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdp\ndmVuIHF1ZXJ5IG1ldGFkYXRhIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURhdGEoUXVl\ncnlNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfbG9ja2lu\nZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlLZXko\nbWV0YSkpICE9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXMucmVtb3ZlKGdldFF1ZXJ5\nS2V5KG1ldGEpKSAhPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNs\nYXNzIG5hbWUgaWYgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURhdGEoQ2xhc3M8Pz4gY2xz\nLCBTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAg\nIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92\nZShnZXRRdWVyeUtleShjbHMsIG5hbWUpKSAhPSBudWxsOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShjbHMsIG5h\nbWUpKSAhPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFNlYXJjaGVzIGFsbCBjYWNoZWQgcXVlcnkgbWV0YWRhdGEgYnkgbmFtZS4K\nICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgc2VhcmNoUXVlcnlN\nZXRhRGF0YUJ5TmFtZShTdHJpbmcgbmFtZSkgewogICAgICAgIGZvciAoT2Jq\nZWN0IGtleSA6IF9xdWVyaWVzLmtleVNldCgpKSB7CiAgICAgICAgICAgIGlm\nIChrZXkgaW5zdGFuY2VvZiBRdWVyeUtleSkKICAgICAgICAgICAgICAgIGlm\nIChTdHJpbmdVdGlscy5lcXVhbHMoKChRdWVyeUtleSkga2V5KS5uYW1lLCBu\nYW1lKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURh\ndGEpIF9xdWVyaWVzLmdldChrZXkpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1\nZSBrZXkgZm9yIGEgZ2l2ZW4gUXVlcnlNZXRhRGF0YS4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGdldFF1ZXJ5S2V5KFF1ZXJ5TWV0YURh\ndGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBnZXRRdWVyeUtleSht\nZXRhLmdldERlZmluaW5nVHlwZSgpLCBtZXRhLmdldE5hbWUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciBhIGdp\ndmVuIGNsYXNzIC8gbmFtZS4gVGhlIGNsYXNzIGFyZ3VtZW50IGNhbiBiZSBu\ndWxsLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIE9iamVjdCBnZXRR\ndWVyeUtleShDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAg\naWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAg\nICAgICBRdWVyeUtleSBrZXkgPSBuZXcgUXVlcnlLZXkoKTsKICAgICAgICBr\nZXkuY2xzTmFtZSA9IGNscy5nZXROYW1lKCk7CiAgICAgICAga2V5Lm5hbWUg\nPSBuYW1lOwogICAgICAgIHJldHVybiBrZXk7CiAgICB9CgogICAgLy8gLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VxdWVuY2UgbWV0YWRhdGEKICAg\nIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVy\nbiBzZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIGNs\nYXNzbG9hZGVyLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0\nYSBnZXRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzc0xvYWRl\nciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYg\nKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykg\newogICAgICAgICAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlTWV0YURhdGFJ\nbnRlcm5hbChuYW1lLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0\nU2VxdWVuY2VNZXRhRGF0YUludGVybmFsKG5hbWUsIGVudkxvYWRlciwgbXVz\ndEV4aXN0KTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBTZXF1ZW5j\nZU1ldGFEYXRhIGdldFNlcXVlbmNlTWV0YURhdGFJbnRlcm5hbChTdHJpbmcg\nbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSBnZXRT\nZXF1ZW5jZU1ldGFEYXRhSW50ZXJuYWwobmFtZSwgZW52TG9hZGVyKTsKICAg\nICAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBTZXF1ZW5jZU1ldGFEYXRh\nLk5BTUVfU1lTVEVNLmVxdWFscyhuYW1lKSkgewogICAgICAgICAgICAgICAg\naWYgKF9zeXNTZXEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfc3lz\nU2VxID0gbmV3U2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBfc3lzU2VxOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1u\nYW1lZC1zZXF1ZW5jZSIsIG5hbWUpKTsKICAgICAgICAgICAgcmV0dXJuIG1l\ndGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2VkIGludGVybmFsbHkgYnkg\nbWV0YWRhdGEgdG8gcmV0cmlldmUgc2VxdWVuY2UgbWV0YWRhdGFzIGJhc2Vk\nIG9uIHBvc3NpYmx5LXVucXVhbGlmaWVkCiAgICAgKiBzZXF1ZW5jZSBuYW1l\nLgogICAgICovCiAgICBTZXF1ZW5jZU1ldGFEYXRhIGdldFNlcXVlbmNlTWV0\nYURhdGEoQ2xhc3NNZXRhRGF0YSBjb250ZXh0LCBTdHJpbmcgbmFtZSwgYm9v\nbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICAvLyB0cnkgd2l0aCBnaXZlbiBu\nYW1lCiAgICAgICAgTWV0YURhdGFFeGNlcHRpb24gZSA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBzZXEgPSBn\nZXRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUsIGNvbnRleHQuZ2V0RW52Q2xhc3NM\nb2FkZXIoKSwgbXVzdEV4aXN0KTsKICAgICAgICAgICAgaWYgKHNlcSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlcTsKICAgICAgICB9IGNh\ndGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBtZGUpIHsKICAgICAgICAgICAgZSA9\nIG1kZTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIGdpdmVuIG5hbWUgYWxy\nZWFkeSBmdWxseSBxdWFsaWZpZWQsIGdpdmUgdXAKICAgICAgICBpZiAobmFt\nZS5pbmRleE9mKCcuJykgIT0gLTEpIHsKICAgICAgICAgICAgaWYgKGUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gdHJ5IHdpdGggcXVh\nbGlmaWVkIG5hbWUKICAgICAgICBuYW1lID0gU3RyaW5ncy5nZXRQYWNrYWdl\nTmFtZShjb250ZXh0LmdldERlc2NyaWJlZFR5cGUoKSkgKyAiLiIgKyBuYW1l\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBnZXRTZXF1ZW5j\nZU1ldGFEYXRhKG5hbWUsIGNvbnRleHQuZ2V0RW52Q2xhc3NMb2FkZXIoKSwg\nbXVzdEV4aXN0KTsKICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4Y2VwdGlv\nbiBtZGUpIHsKICAgICAgICAgICAgLy8gdGhyb3cgb3JpZ2luYWwgZXhjZXB0\naW9uCiAgICAgICAgICAgIGlmIChlICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBlOwogICAgICAgICAgICB0aHJvdyBtZGU7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHNlcXVlbmNlIG1ldGFkYXRh\nIGZvciB0aGUgZ2l2ZW4gbmFtZSBhbmQgY2xhc3Nsb2FkZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1ZW5jZU1ldGFE\nYXRhSW50ZXJuYWwoU3RyaW5nIG5hbWUsIENsYXNzTG9hZGVyIGVudkxvYWRl\ncikgewogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAgICAgIFNl\ncXVlbmNlTWV0YURhdGEgbWV0YSA9IF9zZXFzLmdldChuYW1lKTsKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGxvYWQgbWV0\nYWRhdGEgZm9yIHJlZ2lzdGVyZWQgY2xhc3NlcyB0byBob3BlZnVsbHkgZmlu\nZCBzZXF1ZW5jZQogICAgICAgICAgICAvLyBkZWZpbml0aW9uCiAgICAgICAg\nICAgIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShlbnZMb2FkZXIpOwog\nICAgICAgICAgICBtZXRhID0gX3NlcXMuZ2V0KG5hbWUpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgY2FjaGVkIHNlcXVlbmNlIG1ldGFkYXRhLgogICAgICovCiAg\nICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YVtdIGdldFNlcXVlbmNlTWV0YURh\ndGFzKCkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAo\nU2VxdWVuY2VNZXRhRGF0YVtdKSBfc2Vxcy52YWx1ZXMoKS50b0FycmF5KG5l\ndyBTZXF1ZW5jZU1ldGFEYXRhW19zZXFzLnNpemUoKV0pOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIChTZXF1\nZW5jZU1ldGFEYXRhW10pIF9zZXFzLnZhbHVlcygpLnRvQXJyYXkobmV3IFNl\ncXVlbmNlTWV0YURhdGFbX3NlcXMuc2l6ZSgpXSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQgYSBzZXF1ZW5j\nZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUuCiAgICAgKi8KICAgIHB1\nYmxpYyBTZXF1ZW5jZU1ldGFEYXRhIGdldENhY2hlZFNlcXVlbmNlTWV0YURh\ndGEoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gKFNlcXVlbmNlTWV0YURhdGEpIF9zZXFzLmdldChuYW1lKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJl\ndHVybiAoU2VxdWVuY2VNZXRhRGF0YSkgX3NlcXMuZ2V0KG5hbWUpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG5ldyBzZXF1ZW5j\nZSBtZXRhZGF0YSB0byB0aGUgcmVwb3NpdG9yeSBhbmQgcmV0dXJuIGl0Lgog\nICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBhZGRTZXF1ZW5j\nZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2NraW5n\nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gbmV3U2VxdWVuY2VN\nZXRhRGF0YShuYW1lKTsKICAgICAgICAgICAgICAgIF9zZXFzLnB1dChuYW1l\nLCBtZXRhKTsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU2VxdWVuY2VN\nZXRhRGF0YSBtZXRhID0gbmV3U2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAg\nICAgICAgICAgX3NlcXMucHV0KG5hbWUsIG1ldGEpOwogICAgICAgICAgICBy\nZXR1cm4gbWV0YTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgYSBuZXcgc2VxdWVuY2UgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTZXF1ZW5jZU1ldGFEYXRhIG5ld1NlcXVlbmNl\nTWV0YURhdGEoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFNl\ncXVlbmNlTWV0YURhdGEobmFtZSwgdGhpcyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZW1vdmUgdGhlIGdpdmVuIHNlcXVlbmNlIG1ldGFkYXRhIGZyb20g\ndGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZVNlcXVlbmNlTWV0YURhdGEoU2VxdWVuY2VNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBf\nc2Vxcy5yZW1vdmUobWV0YS5nZXROYW1lKCkpICE9IG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gX3Nl\ncXMucmVtb3ZlKG1ldGEuZ2V0TmFtZSgpKSAhPSBudWxsOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBzZXF1ZW5jZSBtZXRhZGF0\nYSBmb3IgdGhlIG5hbWUgaWYgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVNlcXVlbmNlTWV0YURhdGEoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAg\nICAgcmV0dXJuIF9zZXFzLnJlbW92ZShuYW1lKSAhPSBudWxsOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIF9z\nZXFzLnJlbW92ZShuYW1lKSAhPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gc3lzdGVtIGxpZmVjeWNsZSBs\naXN0ZW5lci4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkU3lzdGVtTGlz\ndGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKF9sb2NraW5n\nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICAgICAgLy8gY29weSB0byBhdm9pZCBpc3N1ZXMgd2l0aCBMaXN0ZW5l\nckxpc3QgYW5kIGF2b2lkIHVubmNlc3NhcnkKICAgICAgICAgICAgICAgIC8v\nIGxvY2tpbmcgb24gdGhlIGxpc3QgZHVyaW5nIHJ1bnRpbWUKICAgICAgICAg\nICAgICAgIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgbGlz\ndGVuZXJzID0gbmV3IExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxp\nc3QoX2xpc3RlbmVycyk7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcnMuYWRk\nKGxpc3RlbmVyKTsKICAgICAgICAgICAgICAgIF9saXN0ZW5lcnMgPSBsaXN0\nZW5lcnM7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGxpc3Rl\nbmVycyA9IG5ldyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0\nKF9saXN0ZW5lcnMpOwogICAgICAgICAgICBsaXN0ZW5lcnMuYWRkKGxpc3Rl\nbmVyKTsKICAgICAgICAgICAgX2xpc3RlbmVycyA9IGxpc3RlbmVyczsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVu\nIHN5c3RlbSBsaWZlY3ljbGUgbGlzdGVuZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIHJlbW92ZVN5c3RlbUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5l\ncikgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5j\naHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZW1v\ndmVTeXN0ZW1MaXN0ZW5lckludGVybmFsKGxpc3RlbmVyKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiByZW1v\ndmVTeXN0ZW1MaXN0ZW5lckludGVybmFsKGxpc3RlbmVyKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIHJlbW92ZVN5c3RlbUxpc3Rl\nbmVySW50ZXJuYWwoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgICAgIGlm\nICghX2xpc3RlbmVycy5jb250YWlucyhsaXN0ZW5lcikpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyBjb3B5IHRvIGF2\nb2lkIGlzc3VlcyB3aXRoIExpc3RlbmVyTGlzdCBhbmQgYXZvaWQgdW5uY2Vz\nc2FyeQogICAgICAgICAgICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1cmlu\nZyBydW50aW1lCiAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50TWFuYWdlci5M\naXN0ZW5lckxpc3QgbGlzdGVuZXJzID0gbmV3IExpZmVjeWNsZUV2ZW50TWFu\nYWdlci5MaXN0ZW5lckxpc3QoX2xpc3RlbmVycyk7CiAgICAgICAgICAgIGxp\nc3RlbmVycy5yZW1vdmUobGlzdGVuZXIpOwogICAgICAgICAgICBfbGlzdGVu\nZXJzID0gbGlzdGVuZXJzOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3lzdGVtIGxpZmVjeWNs\nZSBsaXN0ZW5lcnMKICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZUV2ZW50\nTWFuYWdlci5MaXN0ZW5lckxpc3QgZ2V0U3lzdGVtTGlzdGVuZXJzKCkgewog\nICAgICAgIHJldHVybiBfbGlzdGVuZXJzOwogICAgfQoKICAgIC8qKgogICAg\nICogRnJlZSB0aGUgcmVzb3VyY2VzIHVzZWQgYnkgdGhpcyByZXBvc2l0b3J5\nLiBDbG9zZXMgYWxsIHVzZXIgc2VxdWVuY2VzLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICBjbG9zZUludGVybmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBjbG9zZUludGVybmFsKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBjbG9zZUludGVybmFsKCkgewogICAg\nICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhW10gc21kcyA9IGdldFNlcXVlbmNl\nTWV0YURhdGFzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc21kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHNtZHNbaV0uY2xv\nc2UoKTsKICAgICAgICAgICAgY2xlYXIoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFF1ZXJ5IGtleSBzdHJ1Y3QuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIFF1ZXJ5S2V5IGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsK\nCiAgICAgICAgcHVibGljIFN0cmluZyBjbHNOYW1lOwogICAgICAgIHB1Ymxp\nYyBTdHJpbmcgbmFtZTsKCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgp\nIHsKICAgICAgICAgICAgaW50IGNsc0hhc2ggPSAoY2xzTmFtZSA9PSBudWxs\nKSA/IDAgOiBjbHNOYW1lLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIGludCBu\nYW1lSGFzaCA9IChuYW1lID09IG51bGwpID8gMCA6IG5hbWUuaGFzaENvZGUo\nKTsKICAgICAgICAgICAgcmV0dXJuIGNsc0hhc2ggKyBuYW1lSGFzaDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nb2JqKSB7CiAgICAgICAgICAgIGlmIChvYmogPT0gdGhpcykKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIShvYmogaW5z\ndGFuY2VvZiBRdWVyeUtleSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgICAgICBRdWVyeUtleSBxayA9IChRdWVyeUtleSkgb2Jq\nOwogICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuZXF1YWxzKGNsc05h\nbWUsIHFrLmNsc05hbWUpICYmIFN0cmluZ1V0aWxzLmVxdWFscyhuYW1lLCBx\nay5uYW1lKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gWE1MIG1ldGFkYXRhIGZvciBhIGdpdmVuIGZpZWxkIG1ldGFkYXRhCiAg\nICAgKiAKICAgICAqIEBwYXJhbSBmbWQKICAgICAqIEByZXR1cm4gWE1MIG1l\ndGFkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBYTUxNZXRhRGF0YSBnZXRYTUxN\nZXRhRGF0YShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChfbG9j\na2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRYTUxNZXRhRGF0YUludGVybmFsKGZt\nZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICByZXR1cm4gZ2V0WE1MTWV0YURhdGFJbnRlcm5hbChmbWQpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSBYTUxNZXRhRGF0YSBnZXRYTUxN\nZXRhRGF0YUludGVybmFsKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nQ2xhc3M8Pz4gY2xzID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAg\nIC8vIGNoZWNrIGlmIGNhY2hlZCBiZWZvcmUKICAgICAgICBYTUxNZXRhRGF0\nYSB4bWxtZXRhID0gX3htbG1ldGFzLmdldChjbHMpOwogICAgICAgIGlmICh4\nbWxtZXRhICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB4bWxtZXRhOwoK\nICAgICAgICAvLyBsb2FkIEpBWEIgWE1MIG1ldGFkYXRhCiAgICAgICAgX2Zh\nY3RvcnkubG9hZFhNTE1ldGFEYXRhKGZtZCk7CgogICAgICAgIHhtbG1ldGEg\nPSAoWE1MQ2xhc3NNZXRhRGF0YSkgX3htbG1ldGFzLmdldChjbHMpOwoKICAg\nICAgICByZXR1cm4geG1sbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9wdWxhdGUgaXQgd2l0aCBkZWZhdWx0\nIGluZm9ybWF0aW9uLCBhZGQgaXQgdG8gdGhlIHJlcG9zaXRvcnksIGFuZAog\nICAgICogcmV0dXJuIGl0LgogICAgICogCiAgICAgKiBAcGFyYW0gYWNjZXNz\nCiAgICAgKiAgICAgICAgICAgIHRoZSBhY2Nlc3MgdHlwZSB0byB1c2UgaW4g\ncG9wdWxhdGluZyBtZXRhZGF0YQogICAgICovCiAgICBwdWJsaWMgWE1MQ2xh\nc3NNZXRhRGF0YSBhZGRYTUxNZXRhRGF0YShDbGFzczw/PiB0eXBlLCBTdHJp\nbmcgbmFtZSkgewogICAgICAgIFhNTENsYXNzTWV0YURhdGEgbWV0YSA9IG5l\nd1hNTENsYXNzTWV0YURhdGEodHlwZSwgbmFtZSk7CiAgICAgICAgaWYoX2xv\nY2tpbmcpewogICAgICAgICAgICBzeW5jaHJvbml6ZWQodGhpcyl7CiAgICAg\nICAgICAgICAgICBfeG1sbWV0YXMucHV0KHR5cGUsIG1ldGEpOyAgICAgICAg\nICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlewogICAgICAg\nICAgICBfeG1sbWV0YXMucHV0KHR5cGUsIG1ldGEpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY2FjaGVkIFhNTENsYXNzTWV0YURhdGEgZm9yIHRoZSBnaXZlbiBj\nbGFzcyBSZXR1cm4gbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMg\nWE1MTWV0YURhdGEgZ2V0Q2FjaGVkWE1MTWV0YURhdGEoQ2xhc3M8Pz4gY2xz\nKSB7CiAgICAgICAgcmV0dXJuIF94bWxtZXRhcy5nZXQoY2xzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB4bWwgY2xhc3MgbWV0YWRh\ndGEKICAgICAqIAogICAgICogQHBhcmFtIHR5cGUKICAgICAqIEBwYXJhbSBu\nYW1lCiAgICAgKiBAcmV0dXJuIGEgWE1MQ2xhc3NNZXRhRGF0YQogICAgICov\nCiAgICBwcm90ZWN0ZWQgWE1MQ2xhc3NNZXRhRGF0YSBuZXdYTUxDbGFzc01l\ndGFEYXRhKENsYXNzPD8+IHR5cGUsIFN0cmluZyBuYW1lKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBYTUxDbGFzc01ldGFEYXRhKHR5cGUsIG5hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHhtbCBmaWVsZCBtZXRh\nLCBhZGQgaXQgdG8gdGhlIGZpZWxkTWFwIGluIHRoZSBnaXZlbiB4bWwgY2xh\nc3MgbWV0YWRhdGEKICAgICAqIAogICAgICogQHBhcmFtIHR5cGUKICAgICAq\nIEBwYXJhbSBuYW1lCiAgICAgKiBAcGFyYW0gbWV0YQogICAgICogQHJldHVy\nbiBhIFhNTEZpZWxkTWV0YURhdGEKICAgICAqLwogICAgcHVibGljIFhNTEZp\nZWxkTWV0YURhdGEgbmV3WE1MRmllbGRNZXRhRGF0YShDbGFzczw/PiB0eXBl\nLCBTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiBuZXcgWE1MRmllbGRN\nZXRhRGF0YSh0eXBlLCBuYW1lKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBBbmFseXplcyB0aGUgbGlzdCBvZiBDbGFzc01ldGFEYXRhIGluIHRoZSBz\ndXBwbGllZCBsaXN0IGZvciBhbnkgd2hpY2ggaGFzIGZvcmVpZ24ga2V5cyB0\nbyBvdGhlciBDbGFzc01ldGFEYXRhIAogICAgICogaW5zdGFuY2VzIGluIGl0\ncyBpZGVudGl0eSAoaW4gb3RoZXIgd29yZHMsIFBDVHlwZXMgd2hpY2ggaGF2\nZSBwcmltYXJ5IGtleXMgdGhhdCBhcmUgZm9yZWlnbiBrZXlzIHRvIG90aGVy\nCiAgICAgKiB0YWJsZXMpLCBhbmQgcmV0dXJucyBhIGxpc3QgYXJyYW5nZWQg\nc28gdGhhdCBhIENsYXNzTWV0YURhdGEgdGhhdCBkZXBlbmRzIG9uIGFub3Ro\nZXIgQ2xhc3NNZXRhRGF0YSBhcHBlYXJzCiAgICAgKiBhZnRlciBpdCBpbiB0\naGUgbGlzdC4KICAgICAqCiAgICAgKiBAcGFyYW0gY21kTGlzdCAtIExpc3Qg\nb2YgQ2xhc3NNZXRhRGF0YSB0byBleGFtaW5lCiAgICAgKiBAcmV0dXJuIC0g\nTGlzdCBvZiBDbGFzc01ldGFEYXRhLCB3aXRoIENsYXNzTWV0YURhdGEgZGVw\nZW5kZWVzIG1vdmVkIGFmdGVyIHRoZSBsYXN0IGlkZW50aWZpZWQgZGVwZW5k\nZW50IAogICAgICogICAgICAgICAgIENsYXNzTWV0YURhdGEsIGlmIGFueSBt\nb3ZlIGlzIG5lY2Vzc2FyeS4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PENs\nYXNzTWV0YURhdGE+IHJlc29sdmVGS0luUEtEZXBlbmRlbmNpZXNPcmRlcmlu\nZyhMaXN0PENsYXNzTWV0YURhdGE+IGNtZExpc3QpIHsKICAgICAgICBIYXNo\nTWFwPENsYXNzTWV0YURhdGEsIENNRERlcGVuZGVuY3lOb2RlPiBub2RlTWFw\nID0gbmV3IEhhc2hNYXA8Q2xhc3NNZXRhRGF0YSwgQ01ERGVwZW5kZW5jeU5v\nZGU+KCk7CiAgICAgICAgSGFzaFNldDxDTUREZXBlbmRlbmN5Tm9kZT4gbm9k\nZXNXaXRoRGVwZW5kZW5jaWVzU2V0ID0gbmV3IEhhc2hTZXQ8Q01ERGVwZW5k\nZW5jeU5vZGU+KCk7CiAgICAgICAgQXJyYXlMaXN0PENNRERlcGVuZGVuY3lO\nb2RlPiBub2RlTGlzdCA9IG5ldyBBcnJheUxpc3Q8Q01ERGVwZW5kZW5jeU5v\nZGU+KGNtZExpc3Quc2l6ZSgpKTsKICAgICAgICAKICAgICAgICAvLyBJbml0\naWFsIGFuYWx5c2lzIG9mIENsYXNzTWV0YURhdGEgb2JqZWN0cyAtLSBQb3B1\nbGF0ZSB0aGUgbGlua2VkIGxpc3Qgd2l0aCBvYmplY3RzIGluIHRoZSBzYW1l\nIG9yZGVyIG9mIAogICAgICAgIC8vIGFwcGVhcmFuY2UgaW4gdGhlIG9yaWdp\nbmFsIGxpc3QuIElkZW50aWZ5IENNRHMgd2hvc2UgaWRlbnRpdGllcyBoYXZl\nIGEgRksgdG8gYW5vdGhlciBDTUQsIGFuZCBjYXRhbG9nIHRoYXQgCiAgICAg\nICAgLy8gZGVwZW5kZW5jeS4KICAgICAgICBmb3IgKENsYXNzTWV0YURhdGEg\nY21kIDogY21kTGlzdCkgewogICAgICAgICAgICAvLyBBZGQgdGhpcyBub2Rl\nIHRvIHRoZSBsaXN0CiAgICAgICAgICAgIENNRERlcGVuZGVuY3lOb2RlIG5v\nZGUgPSBub2RlTWFwLmdldChjbWQpOwogICAgICAgICAgICBpZiAobm9kZSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBub2RlID0gbmV3IENNRERlcGVu\nZGVuY3lOb2RlKGNtZCk7CiAgICAgICAgICAgICAgICBub2RlTWFwLnB1dChj\nbWQsIG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5vZGVMaXN0\nLmFkZChub2RlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEV4YW1p\nbmUgaXRzIHByaW1hcnkga2V5IGZpZWxkcywgZmxhZyBhbnkgcmVmZXJlbmNl\ncyB0byBhbm90aGVyIFBDVHlwZSB0aGF0IGlzIGRlZmluZWQgaW4gY21kTGlz\ndCBhcyBhIAogICAgICAgICAgICAvLyBkZXBlbmRlbmN5CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRBcnIgPSBjbWQuZ2V0UHJpbWFyeUtleUZp\nZWxkcygpOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDog\nZm1kQXJyKSB7CiAgICAgICAgICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCA9\nIGZtZC5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgaWYgKHZtZC5pc1R5\ncGVQQygpKSB7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSB0\nYXJnZXRDTUQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKCiAg\nICAgICAgICAgICAgICAgICAgLy8gT25seSBwcm9jZXNzIGVudHJpZXMgd2hp\nY2ggYXJlIGluIHRoZSBjbWRMaXN0LCBhcyB3ZSBkb24ndCB3YW50IHRvIGJl\nIGFkZGluZyBhbnl0aGluZyBuZXcuCiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFjbWRMaXN0LmNvbnRhaW5zKHRhcmdldENNRCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICAvLyBSZWdpc3RlciB0aGUgZGVwZW5kZW5j\neQogICAgICAgICAgICAgICAgICAgIENNRERlcGVuZGVuY3lOb2RlIHRhcmdl\ndE5vZGUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmICgodGFyZ2V0\nTm9kZSA9IG5vZGVNYXAuZ2V0KHRhcmdldENNRCkpID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Tm9kZSA9IG5ldyBDTUREZXBl\nbmRlbmN5Tm9kZSh0YXJnZXRDTUQpOwogICAgICAgICAgICAgICAgICAgICAg\nICBub2RlTWFwLnB1dCh0YXJnZXRDTUQsIHRhcmdldE5vZGUpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBub2RlLnJlZ2lz\ndGVyRGVwZW5kZW50Tm9kZSh0YXJnZXROb2RlKTsKICAgICAgICAgICAgICAg\nICAgICBub2Rlc1dpdGhEZXBlbmRlbmNpZXNTZXQuYWRkKG5vZGUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIC8vIEFuYWx5c2lzIGlzIGNvbXBsZXRlLiBGb3IgZWFjaCBD\nTUQgdGhhdCBoYXMgYW4gaWRlbnRpdHkgZm9yZWlnbiBrZXkgZGVwZW5kZW5j\neSBvbiBhbm90aGVyIENNRCwgZW5zdXJlIHRoYXQgaXQKICAgICAgICAvLyBh\ncHBlYXJzIGxhdGVyIGluIHRoZSBsaXN0IHRoZW4gdGhlIENNRCBpdCBpcyBk\nZXBlbmRlbnQgb24uIElmIGl0IGFwcGVhcnMgZWFybGllciwgbW92ZSBpdCBp\nbW1lZGlhdGVseSBhZnRlciAKICAgICAgICAvLyB0aGUgQ01ELiBJZiB0aGVy\nZSBhcmUgbXVsdGlwbGUgQ01EcyB0aGUgaWRlbnRpdHkgaXMgZGVwZW5kZW50\nIG9uLCBtb3ZlIGl0IGFmdGVyIHRoZSBsYXN0IGRlcGVuZGVuY3kgaW4KICAg\nICAgICAvLyB0aGUgbGlua2VkIGxpc3QuCiAgICAgICAgZm9yIChDTUREZXBl\nbmRlbmN5Tm9kZSBub2RlIDogbm9kZXNXaXRoRGVwZW5kZW5jaWVzU2V0KSB7\nCiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGEgY3ljbGUgKGRl\ncGVuZGVuY2llcyBvciBzdWJkZXBlbmRlbmNpZXMgdGhhdCBjcmVhdGUgYSBj\neWNsZSBpbiB0aGUgZ3JhcGguIElmIG9uZSBpcyAKICAgICAgICAgICAgLy8g\nZGV0ZWN0ZWQsIHRoZW4gdGhpcyBhbGdvcml0aG0gY2Fubm90IGJlIHVzZWQg\ndG8gcmVvcmRlciB0aGUgQ01EIGxpc3QuICBFbWl0IGEgd2FybmluZywgYW5k\nIHJldHVybiB0aGUgCiAgICAgICAgICAgIC8vIG9yaWdpbmFsIGxpc3QuCiAg\nICAgICAgICAgIGlmIChub2RlLmNoZWNrRm9yQ3ljbGUoKSkgewogICAgICAg\nICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJjbWQtZGlzY292ZXIt\nY3ljbGUiLCBub2RlLmdldENtZCgpLmdldFJlc291cmNlTmFtZSgpKSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY21kTGlz\ndDsKICAgICAgICAgICAgfQogCiAgICAgICAgICAgIGludCBub2RlSW5kZXgg\nPSBub2RlTGlzdC5pbmRleE9mKG5vZGUpOwogICAgICAgICAgICBTZXQ8Q01E\nRGVwZW5kZW5jeU5vZGU+IGRlcGVuZGVuY2llcyA9IG5vZGUuZ2V0RGVwZW5k\nc09uU2V0KCk7ICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgLy8g\nSWYgdGhlIGN1cnJlbnQgbm9kZSBoYXMgYSBkZXBlbmRlbmN5IHRoYXQgYXBw\nZWFycyBsYXRlciBpbiB0aGUgbGlzdCwgdGhlbiB0aGlzIG5vZGUgbmVlZHMK\nICAgICAgICAgICAgLy8gdG8gYmUgbW92ZWQgdG8gdGhlIHBvaW50IGltbWVk\naWF0ZWx5IGFmdGVyIHRoYXQgZGVwZW5kZW5jeS4KICAgICAgICAgICAgQ01E\nRGVwZW5kZW5jeU5vZGUgbW92ZUFmdGVyID0gbnVsbDsKICAgICAgICAgICAg\naW50IG1vdmVBZnRlckluZGV4ID0gLTE7CiAgICAgICAgICAgIGZvciAoQ01E\nRGVwZW5kZW5jeU5vZGUgZGVwTm9kZSA6IGRlcGVuZGVuY2llcykgeyAgICAg\nICAgICAgICAgIAogICAgICAgICAgICAgICAgaW50IGRlcGVuZGVuY3lJbmRl\neCA9IG5vZGVMaXN0LmluZGV4T2YoZGVwTm9kZSk7CiAgICAgICAgICAgICAg\nICBpZiAoKG5vZGVJbmRleCA8IGRlcGVuZGVuY3lJbmRleCkgJiYgKG1vdmVB\nZnRlckluZGV4IDwgZGVwZW5kZW5jeUluZGV4KSkgewogICAgICAgICAgICAg\nICAgICAgIG1vdmVBZnRlciA9IGRlcE5vZGU7CiAgICAgICAgICAgICAgICAg\nICAgbW92ZUFmdGVySW5kZXggPSBkZXBlbmRlbmN5SW5kZXg7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1vdmVB\nZnRlciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBub2RlTGlzdC5yZW1v\ndmUobm9kZUluZGV4KTsKICAgICAgICAgICAgICAgIG5vZGVMaXN0LmFkZChu\nb2RlTGlzdC5pbmRleE9mKG1vdmVBZnRlcikgKyAxLCBub2RlKTsKICAgICAg\nICAgICAgfSAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBT\nb3J0aW5nIGlzIGNvbXBsZXRlLCBidWlsZCB0aGUgcmV0dXJuIGxpc3QuICBD\nbGVhciB0aGUgZGVwZW5kc09uU2V0IGZvciB0aGUgR0MuCiAgICAgICAgQXJy\nYXlMaXN0PENsYXNzTWV0YURhdGE+IHJldHVybkxpc3QgPSBuZXcgQXJyYXlM\naXN0PENsYXNzTWV0YURhdGE+KCk7CiAgICAgICAgZm9yIChDTUREZXBlbmRl\nbmN5Tm9kZSBjdXJyZW50IDogbm9kZUxpc3QpIHsKICAgICAgICAgICAgcmV0\ndXJuTGlzdC5hZGQoY3VycmVudC5nZXRDbWQoKSk7CiAgICAgICAgICAgIGN1\ncnJlbnQuZ2V0RGVwZW5kc09uU2V0KCkuY2xlYXIoKTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcmV0dXJuIHJldHVybkxpc3Q7CiAgICB9CgoKICAg\nIC8qKgogICAgICogTGlua2VkIGxpc3Qgbm9kZSBjbGFzcyBmb3IgbWFuYWdp\nbmcgYW55IGZvcmVpZ24ga2V5cyBpbiB0aGUgaWRlbnRpdHkgb2YgYSBDbGFz\nc01ldGFEYXRhIGluc3RhbmNlLgogICAgICogCiAgICAgKi8KICAgIHByaXZh\ndGUgY2xhc3MgQ01ERGVwZW5kZW5jeU5vZGUgewogICAgICAgIHByaXZhdGUg\nQ2xhc3NNZXRhRGF0YSBjbWQ7CgogICAgICAgIC8vIE1hcmtlciBmb3IgcXVp\nY2sgZGV0ZXJtaW5hdGlvbiBpZiB0aGlzIG5vZGUgaGFzIGRlcGVuZGVuY2ll\ncwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBoYXNEZXBlbmRlbmNpZXMgPSBm\nYWxzZTsKCiAgICAgICAgLy8gTGlzdCBvZiBDbGFzc01ldGFEYXRhIG9iamVj\ndHMgdGhpcyBDbGFzc01ldGFEYXRhIGRlcGVuZHMgb24KICAgICAgICBwcml2\nYXRlIEhhc2hTZXQ8Q01ERGVwZW5kZW5jeU5vZGU+IGRlcGVuZHNPblNldCA9\nIG5ldyBIYXNoU2V0PENNRERlcGVuZGVuY3lOb2RlPigpOwoKICAgICAgICAv\nKioKICAgICAgICAgKiBJbm5lciBjbGFzcyBjb25zdHJ1Y3RvcgogICAgICAg\nICAqLwogICAgICAgIENNRERlcGVuZGVuY3lOb2RlKENsYXNzTWV0YURhdGEg\nY21kKSB7CiAgICAgICAgICAgIHRoaXMuY21kID0gY21kOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgQ2xhc3NNZXRh\nRGF0YSBpbnN0YW5jZSByZWZlcmVuY2VkIGJ5IHRoaXMgbm9kZS4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRDbWQoKSB7\nCiAgICAgICAgICAgIHJldHVybiBjbWQ7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiAKICAgICAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhp\ncyBub2RlJ3MgQ2xhc3NNZXRhRGF0YSBoYXMgYSBGSyBpbiBpdHMgaWRlbnRp\ndHkgdGhhdCByZWZlcnMgdG8gYW5vdGhlciBDbGFzc01ldGFEYXRhOyAKICAg\nICAgICAgKiAgICAgICAgIGZhbHNlIGlmIGl0IGRvZXMgbm90LgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIGdldEhhc0RlcGVuZGVuY2ll\ncygpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc0RlcGVuZGVuY2llczsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlZ2lzdGVycyBhIENs\nYXNzTWV0YURhdGEgbW9kZWxsZWQgYnkgYSBDTUREZXBlbmRlbmN5Tm9kZSBh\ncyBhIGRlcGVuZGVuY3kgb2YgdGhpcyBDbGFzc01ldGFEYXRhLgogICAgICAg\nICAqIAogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVy\nRGVwZW5kZW50Tm9kZShDTUREZXBlbmRlbmN5Tm9kZSBub2RlKSB7CiAgICAg\nICAgICAgIGdldERlcGVuZHNPblNldCgpLmFkZChub2RlKTsKICAgICAgICAg\nICAgaGFzRGVwZW5kZW5jaWVzID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFJldHVybnMgYSBTZXQgY29udGFpbmluZyBhbGwg\nb2YgdGhlIENNRERlcGVuZGVuY3lOb2RlIGluc3RhbmNlcyB0aGF0IHRoaXMg\nbm9kZSBoYXMgYSBGSyBpbiBpZGVudGl0eSAKICAgICAgICAgKiBkZXBlbmRl\nbmN5IG9uLgogICAgICAgICAqIAogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyBTZXQ8Q01ERGVwZW5kZW5jeU5vZGU+IGdldERlcGVuZHNPblNldCgpIHsK\nICAgICAgICAgICAgcmV0dXJuIGRlcGVuZHNPblNldDsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBhbGwgZGVwZW5kZW5jaWVz\nLCBhbmQgc3ViLWRlcGVuZGVuY2llcywgZm9yIGFueSBjeWNsZXMgaW4gdGhl\nIGRlcGVuZGVuY3kgZ3JhcGguCiAgICAgICAgICogCiAgICAgICAgICogQHJl\ndHVybiB0cnVlIGlmIGEgY3ljbGUgd2FzIGRpc2NvdmVyZWQsIGZhbHNlIGlm\nIG5vdC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgYm9vbGVhbiBjaGVj\na0ZvckN5Y2xlKCkgewogICAgICAgICAgICBqYXZhLnV0aWwuU3RhY2s8Q01E\nRGVwZW5kZW5jeU5vZGU+IHZpc2l0U3RhY2sgPSBuZXcgamF2YS51dGlsLlN0\nYWNrPENNRERlcGVuZGVuY3lOb2RlPigpOwogICAgICAgICAgICByZXR1cm4g\naW50ZXJuYWxDaGVja0ZvckN5Y2xlKHZpc2l0U3RhY2spOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogSW50ZXJuYWwgaW1wbGVtZW50YXRp\nb24gb2YgdGhlIGN5Y2xlIGRldGVjdGlvbi4KICAgICAgICAgKiAKICAgICAg\nICAgKiBAcGFyYW0gdmlzaXRTdGFjawogICAgICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiBhIGN5Y2xlIGlzIGRldGVjdGVkLCBmYWxzZSBpZiBubyBjeWNsZSB3\nYXMgZGV0ZWN0ZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBib29s\nZWFuIGludGVybmFsQ2hlY2tGb3JDeWNsZShqYXZhLnV0aWwuU3RhY2s8Q01E\nRGVwZW5kZW5jeU5vZGU+IHZpc2l0U3RhY2spIHsKICAgICAgICAgICAgaWYg\nKHZpc2l0U3RhY2suY29udGFpbnModGhpcykpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZpc2l0\nU3RhY2sucHVzaCh0aGlzKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBmb3IgKENNRERlcGVuZGVuY3lOb2RlIG5vZGUgOiBkZXBlbmRz\nT25TZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5nZXRIYXNE\nZXBlbmRlbmNpZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbm9kZS5pbnRlcm5hbENoZWNrRm9yQ3ljbGUodmlzaXRTdGFjaykgPT0gdHJ1\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICB2aXNpdFN0YWNrLnBvcCgpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBuZWVk\nc1ByZWxvYWQoT3B0aW9ucyBvKSB7CiAgICAgICAgaWYgKG8uZ2V0Qm9vbGVh\nblByb3BlcnR5KFBSRUxPQURfU1RSKSA9PSB0cnVlKSB7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9Cgp9Cg==\n","encoding":"base64"}

