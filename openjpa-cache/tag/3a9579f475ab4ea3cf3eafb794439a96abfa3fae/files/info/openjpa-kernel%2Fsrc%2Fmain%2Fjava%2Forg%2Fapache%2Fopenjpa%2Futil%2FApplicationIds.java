{"sha":"f0b2df39cd5ab660e7da784873ffab4b6ba59d22","node_id":"MDQ6QmxvYjIwNjM2NDpmMGIyZGYzOWNkNWFiNjYwZTdkYTc4NDg3M2ZmYWI0YjZiYTU5ZDIy","size":27046,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f0b2df39cd5ab660e7da784873ffab4b6ba59d22","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1vZGlmaWVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9y\ndCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmls\nZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5PYmplY3RJZFN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuU3RhdGVNYW5hZ2VySW1wbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vzc0NvZGU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2ll\nczsKCi8qKgogKiBVdGlsaXR5IGNsYXNzIGZvciBtYW5pcHVsYXRpbmcgYXBw\nbGljYXRpb24gb2JqZWN0IGlkcy4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEFwcGxpY2F0aW9uSWRz\nIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nIExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEFwcGxpY2F0aW9uSWRz\nLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jMiA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFN0YXRlTWFu\nYWdlckltcGwuY2xhc3MpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBw\ncmltYXJ5IGtleSB2YWx1ZXMgZm9yIHRoZSBnaXZlbiBvYmplY3QgaWQuIFRo\nZSB2YWx1ZXMKICAgICAqIHdpbGwgYmUgcmV0dXJuZWQgaW4gdGhlIHNhbWUg\nb3JkZXIgYXMgdGhlIG1ldGFkYXRhIHByaW1hcnkga2V5IGZpZWxkcy4KICAg\nICAqIFZhbHVlcyBmb3IgUEMgcHJpbWFyeSBrZXkgZmllbGRzIHdpbGwgYmUg\ndGhlIHByaW1hcnkga2V5IHZhbHVlIG9yCiAgICAgKiBvaWQgdmFsdWUgb2Yg\ndGhlIHJlbGF0ZWQgaW5zdGFuY2UgKGRlcGVuZGluZyBvbiAKICAgICAqIHtA\nbGluayBGaWVsZE1ldGFEYXRhI2lzT2JqZWN0SWRGaWVsZElkT2ZQQ30pLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdFtdIHRvUEtWYWx1ZXMo\nT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYg\nKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIE9iamVjdFtdIHBrczsKICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJ\nZGVudGl0eSgpKSB7CiAgICAgICAgICAgIHBrcyA9IG5ldyBPYmplY3RbMV07\nCiAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHBrc1swXSA9ICgoT3BlbkpQQUlkKSBvaWQpLmdldElkT2JqZWN0KCk7CiAg\nICAgICAgICAgIHJldHVybiBwa3M7CiAgICAgICAgfQoKICAgICAgICAvLyBy\nZXNldCBvd25pbmcgJ21ldGEnIHRvIHRoZSBvd25lciBvZiB0aGUgcHJpbWFy\neSBrZXkgZmllbGRzLCBiZWNhdXNlCiAgICAgICAgLy8gdGhlIG9uZSBwYXNz\nZWQgaW4gbWlnaHQgYmUgYSBwcm94eSwgbGlrZSBmb3IgZW1iZWRkZWQgbWFw\ncGluZ3M7CiAgICAgICAgLy8gc2luY2UgZ2V0UHJpbWFyeUtleUZpZWxkcyBp\ncyBndWFyYW50ZWVkIHRvIHJldHVybiB0aGUgcHJpbWFyeQogICAgICAgIC8v\nIGtleXMgaW4gdGhlIG9yZGVyIG9mIGluaGVyaXRhbmNlLCB3ZSBhcmUgZ3Vh\ncmFudGVlZCB0aGF0CiAgICAgICAgLy8gdGhlIGxhc3QgZWxlbWVudCB3aWxs\nIGJlIHRoZSBtb3N0LWRlcml2ZWQgY2xhc3MuCiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAg\nICAgICBtZXRhID0gZm1kc1tmbWRzLmxlbmd0aCAtIDFdLmdldERlY2xhcmlu\nZ01ldGFEYXRhKCk7CiAgICAgICAgcGtzID0gbmV3IE9iamVjdFtmbWRzLmxl\nbmd0aF07CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gcGtzOwoKICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3Qo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpKSB7CiAg\nICAgICAgICAgIC8vIGNvcHkgZmllbGRzIGZyb20gdGhlIG9pZAogICAgICAg\nICAgICBQcmltYXJ5S2V5RmllbGRNYW5hZ2VyIGNvbnN1bWVyID0gbmV3IFBy\naW1hcnlLZXlGaWVsZE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3VtZXIu\nc2V0U3RvcmUocGtzKTsKICAgICAgICAgICAgb2lkID0gd3JhcChtZXRhLCBv\naWQpOwogICAgICAgICAgICBQQ1JlZ2lzdHJ5LmNvcHlLZXlGaWVsZHNGcm9t\nT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAg\nICAgICBjb25zdW1lciwgb2lkKTsKICAgICAgICAgICAgcmV0dXJuIGNvbnN1\nbWVyLmdldFN0b3JlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0\nIHRvIHJlZmxlY3Rpb24KICAgICAgICBpZiAobWV0YS5pc09iamVjdElkVHlw\nZVNoYXJlZCgpKQogICAgICAgICAgICBvaWQgPSAoKE9iamVjdElkKSBvaWQp\nLmdldElkKCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFz\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoQWNjZXNzQ29kZS5pc0ZpZWxkKG1l\ndGEuZ2V0QWNjZXNzVHlwZSgpKSkKICAgICAgICAgICAgICAgIHBrc1tpXSA9\nIFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lk\nVHlwZSwgCiAgICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCks\nIHRydWUpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGtz\nW2ldID0gUmVmbGVjdGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRHZXR0\nZXIob2lkVHlwZSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE5h\nbWUoKSwgdHJ1ZSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGtzOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFdyYXBzIHRoZSBnaXZlbiBvYmpl\nY3QgZm9yIHRoZSBnaXZlbiB0eXBlIGludG8gYSBPcGVuSlBBIHNwZWNpZmlj\nIAogICAgICogYXBwbGljYXRpb24gaWRlbnRpdHkgb2JqZWN0IHdyYXBwZXIg\naW5zdGFuY2UgKGkuZS4gT2JqZWN0SWQpIGlmIGFsbCBvZiAKICAgICAqIHRo\nZSBmb2xsb3dpbmcgaXMgdHJ1ZToKICAgICAqIHRoZSBnaXZlbiB0eXBlIGlz\nIG5vdCB1c2luZyBidWlsdC1pbiBPcGVuSlBBIGlkZW50aXR5IHR5cGVzCiAg\nICAgKiB0aGUgZ2l2ZW4gdHlwZSBpcyB1c2luZyBhIHNoYXJlZCBPcGVuSlBB\nIGlkZW50aXR5IHR5cGUKICAgICAqIHRoZSBnaXZlbiBvYmplY3QgaXMgbm90\nIGFscmVhZHkgYSB3cmFwcGVyIGlkZW50aXR5IHR5cGUKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBPYmplY3Qgd3JhcChDbGFzc01ldGFEYXRhIG1ldGEs\nIE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAoIW1ldGEuaXNPcGVuSlBBSWRl\nbnRpdHkoKSAKICAgICAgICAgJiYgbWV0YS5pc09iamVjdElkVHlwZVNoYXJl\nZCgpIAogICAgICAgICAmJiAhKG9pZCBpbnN0YW5jZW9mIE9iamVjdElkKSkg\newogICAgICAgIAlyZXR1cm4gbmV3IE9iamVjdElkKG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLCBvaWQpOwogICAgICAgIH0gCiAgICAgICAgcmV0dXJuIG9p\nZDsKICAgIH0KICAgIAoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IG9i\namVjdCBpZCBjb25zdHJ1Y3RlZCBmcm9tIHRoZSBnaXZlbiBwcmltYXJ5IGtl\neSB2YWx1ZXMuCiAgICAgKiBWYWx1ZXMgZm9yIFBDIHByaW1hcnkga2V5IGZp\nZWxkcyBzaG91bGQgYmUgdGhlIHByaW1hcnkga2V5IHZhbHVlIG9yCiAgICAg\nKiBvaWQgdmFsdWUgb2YgdGhlIHJlbGF0ZWQgaW5zdGFuY2UgKGRlcGVuZGlu\nZyBvbiAKICAgICAqIHtAbGluayBGaWVsZE1ldGFEYXRhI2lzT2JqZWN0SWRG\naWVsZElkT2ZQQ30pLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVj\ndCBmcm9tUEtWYWx1ZXMoT2JqZWN0W10gcGtzLCBDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsIHx8IHBrcyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYm9vbGVhbiBj\nb252ZXJ0ID0gIW1ldGEuZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3VyYXRp\nb24oKS4KICAgICAgICAgICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCku\nZ2V0U3RyaWN0SWRlbnRpdHlWYWx1ZXMoKTsKICAgICAgICBpZiAobWV0YS5p\nc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIGludCB0eXBlID0g\nbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClbMF0uZ2V0T2JqZWN0SWRGaWVs\nZFR5cGVDb2RlKCk7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSAoY29udmVy\ndCkgPyBKYXZhVHlwZXMuY29udmVydChwa3NbMF0sIHR5cGUpIDogcGtzWzBd\nOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgICAgICBpZiAoIWNv\nbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBCeXRlKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4\nIGluc3RhbmNlb2YgQnl0ZSkiKTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEJ5dGVJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIp\nIHZhbCkuYnl0ZVZhbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklk\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAg\nICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKENoYXJhY3RlcikgdmFsKS5jaGFy\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VC\nTEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JK\nOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBp\nbnN0YW5jZW9mIERvdWJsZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIERv\ndWJsZSkiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvdWJs\nZUlkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5kb3Vi\nbGVWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JK\nOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBp\nbnN0YW5jZW9mIEZsb2F0KSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgRmxv\nYXQpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdElk\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAg\nICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5mbG9hdFZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAg\nICAgICAgICAgICAgICBpZiAoIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2Vv\nZiBJbnRlZ2VyKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgSW50ZWdlciki\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludElkKG1ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB2\nYWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpKTsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAg\nICAgICAgICBpZiAoIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBMb25n\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNzQ2Fz\ndEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgTG9uZykiKTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IExvbmdJZChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwg\nPyAwIDogKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICAgICAg\naWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNlb2YgU2hvcnQpKQogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0\naW9uKCIhKHggaW5zdGFuY2VvZiBTaG9ydCkiKTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IFNob3J0SWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6\nICgoTnVtYmVyKSB2YWwpLnNob3J0VmFsdWUoKSk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwg\nKFN0cmluZykgdmFsKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlSWQo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIChEYXRlKSB2YWwpOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIHZh\nbCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFM\nOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBp\nbnN0YW5jZW9mIEJpZ0RlY2ltYWwpKQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIiEoeCBpbnN0YW5jZW9mIEJpZ0RlY2ltYWwpIik7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCaWdEZWNpbWFsSWQo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIAogICAgICAgICAgICAgICAgICAg\nICAgICAoQmlnRGVjaW1hbCl2YWwpOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgICAgICBpZiAo\nIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBCaWdJbnRlZ2VyKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNzQ2FzdEV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIhKHggaW5zdGFu\nY2VvZiBCaWdJbnRlZ2VyKSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgQmlnSW50ZWdlcklkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgKEJpZ0ludGVnZXIpdmFsKTsKICAg\nICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGNvcHkgcGtzIHRvIG9pZAogICAgICAgIGlm\nICghTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKS5nZXRNb2RpZmllcnMoKSkpIHsKICAgICAgICAgICAgT2JqZWN0IG9pZCA9\nIFBDUmVnaXN0cnkubmV3T2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpOwogICAgICAgICAgICBQcmltYXJ5S2V5RmllbGRNYW5hZ2VyIHByb2R1\nY2VyID0gbmV3IFByaW1hcnlLZXlGaWVsZE1hbmFnZXIoKTsKICAgICAgICAg\nICAgcHJvZHVjZXIuc2V0U3RvcmUocGtzKTsKICAgICAgICAgICAgaWYgKGNv\nbnZlcnQpCiAgICAgICAgICAgICAgICBwcm9kdWNlci5zZXRNZXRhRGF0YSht\nZXRhKTsKICAgICAgICAgICAgUENSZWdpc3RyeS5jb3B5S2V5RmllbGRzVG9P\nYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAg\nICAgIHByb2R1Y2VyLCBvaWQpOwogICAgICAgICAgICByZXR1cm4gQXBwbGlj\nYXRpb25JZHMud3JhcChtZXRhLCBvaWQpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gZGVmYXVsdCB0byByZWZsZWN0aW9uCiAgICAgICAgQ2xhc3Mgb2lkVHlw\nZSA9IG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgaWYgKE1vZGlm\naWVyLmlzQWJzdHJhY3Qob2lkVHlwZS5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJvYmpl\nY3RpZC1hYnN0cmFjdCIsIG1ldGEpKTsKICAgICAgICBPYmplY3QgY29weSA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29weSA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24ob2lkVHlwZSkpOwogICAg\nICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIGlmICh0\nIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAgICAg\nICAgICAgICAgIHQgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIHQp\nLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbih0KTsKICAgICAgICB9CgogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAg\nICAgT2JqZWN0IHZhbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFsID0gKGNvbnZlcnQp\nID8gSmF2YVR5cGVzLmNvbnZlcnQocGtzW2ldLAogICAgICAgICAgICAgICAg\nZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkgOiBwa3NbaV07\nCiAgICAgICAgICAgIGlmIChBY2Nlc3NDb2RlLmlzRmllbGQobWV0YS5nZXRB\nY2Nlc3NUeXBlKCkpKQogICAgICAgICAgICAgICAgUmVmbGVjdGlvbi5zZXQo\nY29weSwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAgICAgICAg\nICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHRydWUpLCB2YWwpOyAK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUmVmbGVjdGlvbi5z\nZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5cGUsIAogICAg\nICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpLCB0cnVlKSwgdmFsKTsKICAgICAgICB9CgogICAg\nICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAg\nICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIGNvcHkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoKICAgIC8q\nKgogICAgICogQ29weSB0aGUgZ2l2ZW4gb2lkIHZhbHVlLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIE9iamVjdCBjb3B5KE9iamVjdCBvaWQsIENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwgfHwg\nb2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAg\nIC8vIHVzZSBtZXRhIHR5cGUgaW5zdGVhZCBvZiBvaWQgdHlwZSBpbiBjYXNl\nIGl0J3MgYSBzdWJjbGFzcwogICAgICAgICAgICBDbGFzcyBjbHMgPSBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgT3BlbkpQQUlkIGtv\naWQgPSAoT3BlbkpQQUlkKSBvaWQ7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGEgcGsgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXTsKICAgICAg\nICAgICAgc3dpdGNoIChway5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgQnl0ZUlkKGNscywgKChCeXRlSWQpIG9p\nZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNT\ndWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JK\nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklkKGNscywg\nKChDaGFySWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IERvdWJsZUlkKGNscywgKChEb3VibGVJZCkgb2lkKS5nZXRJZCgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQoY2xzLCAoKEZsb2F0SWQp\nIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5o\nYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09C\nSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludElkKGNscywg\nKChJbnRJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAg\nICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBM\nb25nSWQoY2xzLCAoKExvbmdJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IFNob3J0SWQoY2xzLCAoKFNob3J0SWQpIG9pZCkuZ2V0\nSWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNTdWJjbGFz\nc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5H\nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nSWQoY2xz\nLCBvaWQudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29p\nZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAg\nICAgICAgICAgT2JqZWN0IGlubmVyID0ga29pZC5nZXRJZE9iamVjdCgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBpbm5lciA9IGNvcHkoaW5uZXIsIGVtYmVkLCBl\nbWJlZC5nZXRGaWVsZHMoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBPYmplY3RJZChjbHMsIGlubmVyLCBrb2lkLmhhc1N1YmNsYXNzZXMo\nKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIGtv\naWQuZ2V0SWRPYmplY3QoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIGtv\naWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBE\nYXRlSWQoY2xzLCAoKERhdGVJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgQmlnRGVjaW1hbElkKGNscywgKChCaWdE\nZWNpbWFsSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEJpZ0ludGVnZXJJZChjbHMsICgoQmlnSW50ZWdlcklkKSBv\naWQpLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGtvaWQuaGFz\nU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBh\nIG5ldyBwYyBpbnN0YW5jZSBvZiB0aGUgcmlnaHQgdHlwZSwgc2V0IGl0cyBr\nZXkgZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIG9yaWdpbmFsIG9pZCB2YWx1\nZXMsIHRoZW4gY29weSBpdHMga2V5IGZpZWxkcyB0byBhIG5ldwogICAgICAg\nIC8vIG9pZCBpbnN0YW5jZQogICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0\ncmFjdChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkK\nICAgICAgICAgICAgJiYgIWhhc1BDUHJpbWFyeUtleUZpZWxkcyhtZXRhKSkg\newogICAgICAgICAgICBDbGFzcyB0eXBlID0gbWV0YS5nZXREZXNjcmliZWRU\neXBlKCk7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IFBD\nUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwgbnVsbCwgb2lkLCAKICAgICAg\nICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgIE9iamVjdCBjb3B5ID0g\ncGMucGNOZXdPYmplY3RJZEluc3RhbmNlKCk7CiAgICAgICAgICAgIHBjLnBj\nQ29weUtleUZpZWxkc1RvT2JqZWN0SWQoY29weSk7CiAgICAgICAgICAgIHJl\ndHVybiBjb3B5OwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGNvcHkgPSAo\nIW1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgPyBvaWQKICAgICAgICAg\nICAgOiAoKE9iamVjdElkKSBvaWQpLmdldElkKCk7CiAgICAgICAgY29weSA9\nIGNvcHkoY29weSwgbWV0YSwgbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCkp\nOwogICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAg\nICAgICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmli\nZWRUeXBlKCksIGNvcHksCiAgICAgICAgICAgICAgICAoKE9wZW5KUEFJZCkg\nb2lkKS5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgIHJldHVybiBjb3B5Owog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgYW55IG9mIHRo\nZSBnaXZlbiB0eXBlJ3MgcHJpbWFyeSBrZXkgZmllbGRzIGFyZSAKICAgICAq\nIHBlcnNpc3RlbnQgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgYm9vbGVhbiBoYXNQQ1ByaW1hcnlLZXlGaWVsZHMoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRh\nLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb3B5IHRoZSBnaXZlbiBpZGVu\ndGl0eSBvYmplY3QgdXNpbmcgcmVmbGVjdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgT2JqZWN0IGNvcHkoT2JqZWN0IG9pZCwgQ2xhc3NNZXRh\nRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzKSB7CiAg\nICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFzcygpOwog\nICAgICAgIE9iamVjdCBjb3B5ID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBjb3B5ID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFj\ndGlvbihvaWRUeXBlKSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQp\nIHsKICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0\naW9uRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdCA9ICgoUHJpdmlsZWdl\nZEFjdGlvbkV4Y2VwdGlvbikgdCkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAgICAgIH0K\nCiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgT2JqZWN0IHZhbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZp\nZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChBY2Nlc3NDb2RlLmlzRmll\nbGQobWV0YS5nZXRBY2Nlc3NUeXBlKCkpKSB7CiAgICAgICAgICAgICAgICAg\nICAgZmllbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBmbWRz\nW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgUmVmbGVjdGlvbi5zZXQoY29weSwgZmll\nbGQsIFJlZmxlY3Rpb24uZ2V0KG9pZCwgZmllbGQpKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7IC8vIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAg\ndmFsID0gUmVmbGVjdGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRHZXR0\nZXIob2lkVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZm1kc1tpXS5n\nZXROYW1lKCksIHRydWUpKTsKICAgICAgICAgICAgICAgICAgICBSZWZsZWN0\naW9uLnNldChjb3B5LCBSZWZsZWN0aW9uLmZpbmRTZXR0ZXIob2lkVHlwZSwg\nZm1kc1tpXS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZSgpLCBm\nbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCksIHRydWUpLCB2YWwpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBn\naXZlbiBwcmltYXJ5IGtleSBmaWVsZCB2YWx1ZSBmcm9tIHRoZSBnaXZlbiBv\naWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGdldChPYmpl\nY3Qgb2lkLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChvaWQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAgICAgICAgcmV0dXJu\nICgoT3BlbkpQQUlkKSBvaWQpLmdldElkT2JqZWN0KCk7CgogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCk7\nCiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFzcygpOwogICAg\nICAgIGlmIChBY2Nlc3NDb2RlLmlzRmllbGQobWV0YS5nZXRBY2Nlc3NUeXBl\nKCkpKQogICAgICAgICAgICByZXR1cm4gUmVmbGVjdGlvbi5nZXQob2lkLCBS\nZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCAKICAgICAgICAgICAgICAg\nIGZtZC5nZXROYW1lKCksIHRydWUpKTsKICAgICAgICByZXR1cm4gUmVmbGVj\ndGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlwZSwg\nZm1kLmdldE5hbWUoKSwKICAgICAgICAgICAgdHJ1ZSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogR2VuZXJhdGUgYW4gYXBwbGljYXRpb24gaWQgYmFzZWQg\nb24gdGhlIGN1cnJlbnQgcHJpbWFyeSBrZXkgZmllbGQgc3RhdGUKICAgICAq\nIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgY3JlYXRlKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKHBjID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBPYmplY3Qgb2lkID0g\ncGMucGNOZXdPYmplY3RJZEluc3RhbmNlKCk7CiAgICAgICAgaWYgKG9pZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYg\nKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgcGMu\ncGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZChvaWQpOwogICAgICAgICAgICBy\nZXR1cm4gb2lkOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YSBw\nayA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpWzBdOwogICAgICAgIGlm\nIChway5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLk9JRCkK\nICAgICAgICAgICAgcmV0dXJuIG9pZDsKCiAgICAgICAgLy8gYWx3YXlzIGNv\ncHkgb2lkIG9iamVjdCBpbiBjYXNlIGZpZWxkIHZhbHVlIG11dGF0ZXMgb3Ig\nYmVjb21lcwogICAgICAgIC8vIG1hbmFnZWQKICAgICAgICBPYmplY3RJZCBv\nYmppZCA9IChPYmplY3RJZCkgb2lkOwogICAgICAgIENsYXNzTWV0YURhdGEg\nZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgb2Jq\naWQuc2V0SWQoY29weShvYmppZC5nZXRJZCgpLCBlbWJlZCwgZW1iZWQuZ2V0\nRmllbGRzKCkpKTsKICAgICAgICByZXR1cm4gb2JqaWQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBc3NpZ24gYW4gYXBwbGljYXRpb24gaWRlbnRpdHkgb2Jq\nZWN0IHRvIHRoZSBnaXZlbiBzdGF0ZSwgb3IgcmV0dXJuCiAgICAgKiBmYWxz\nZSBpZiBkZXRlcm1pbmluZyB0aGUgYXBwbGljYXRpb24gaWRlbnRpdHkgcmVx\ndWlyZXMgYSBmbHVzaC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29s\nZWFuIGFzc2lnbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBTdG9yZU1hbmFn\nZXIgc3RvcmUsCiAgICAgICAgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAg\nICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0\nYS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKCk7CgogICAgICAgIGJvb2xlYW4gcmV0OwogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVs\nZHMoKTsKICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpCiAg\nICAgICAgICAgICYmIHBrc1swXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIG9pZHNtID0gbmV3IE9iamVjdElkU3RhdGVNYW5hZ2VyCiAgICAgICAg\nICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVsZChwa3NbMF0uZ2V0SW5kZXgo\nKSksIHNtLCBwa3NbMF0pOwogICAgICAgICAgICByZXQgPSBhc3NpZ24ob2lk\nc20sIHN0b3JlLCBwa3NbMF0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLgogICAg\nICAgICAgICAgICAgZ2V0RmllbGRzKCksIHByZUZsdXNoKTsKICAgICAgICAg\nICAgc20uc3RvcmVPYmplY3RGaWVsZChwa3NbMF0uZ2V0SW5kZXgoKSwKICAg\nICAgICAgICAgICAgIG9pZHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsKICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0ID0gYXNzaWduKHNtLCBzdG9y\nZSwgbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCksIHByZUZsdXNoKTsKICAg\nICAgICBpZiAoIXJldCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAg\nICAgICAvLyBiYXNlIG9pZCBvbiBmaWVsZCB2YWx1ZXMKICAgICAgICBzbS5z\nZXRPYmplY3RJZChjcmVhdGUoc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCks\nIG1ldGEpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFzc2lnbiBnZW5lcmF0ZWQgdmFsdWVzIHRvIGdpdmVuIHByaW1h\ncnkga2V5IGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiBhc3NpZ24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgU3RvcmVNYW5h\nZ2VyIHN0b3JlLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MsIGJvb2xl\nYW4gcHJlRmx1c2gpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBr\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgLy8gSWYgd2UgYXJlIGdlbmVy\nYXRpbmcgdmFsdWVzLi4uCiAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFs\ndWVTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5OT05FKSB7CiAgICAg\nICAgICAgICAgICAvLyBJZiBhIHZhbHVlIGFscmVhZHkgZXhpc3RzIG9uIHRo\naXMgZmllbGQsIHRocm93IGV4Y2VwdGlvbi4KICAgICAgICAgICAgICAgIC8v\nIFRoaXMgaXMgY29uc2lkZXJlZCBhbiBhcHBsaWNhdGlvbiBjb2RpbmcgZXJy\nb3IuCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzRGVmYXVsdFZhbHVlKHBr\nc1tpXS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MyLmdldCgKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICJleGlzdGluZy12YWx1ZS1vdmVycmlkZS1l\neGNlcCIsIHBrc1tpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAuZ2V0RnVsbE5hbWUoZmFsc2UpKSk7CiAgICAgICAgICAgICAgICAv\nLyBBc3NpZ24gdGhlIGdlbmVyYXRlZCB2YWx1ZQogICAgICAgICAgICAgICAg\naWYgKHN0b3JlLmFzc2lnbkZpZWxkKHNtLCBwa3NbaV0uZ2V0SW5kZXgoKSwg\ncHJlRmx1c2gpKQogICAgICAgICAgICAgICAgICAgIHBrc1tpXS5zZXRWYWx1\nZUdlbmVyYXRlZCh0cnVlKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNr\nIGlmIG9iamVjdCBpZCBpcyBzZXQgb3Igbm90LiAKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBib29sZWFuIGlzSWRTZXQoT2JqZWN0IGlkLCBDbGFzc01l\ndGFEYXRhIG1ldGEsIAogICAgICAgIFN0cmluZyBtYXBwZWRCeUlkRmllbGRO\nYW1lKSB7CiAgICAgICAgT2JqZWN0IGtleSA9IG51bGw7CiAgICAgICAgaWYg\nKG1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAgICAgICAgICAga2V5ID0g\nQXBwbGljYXRpb25JZHMuZ2V0S2V5KGlkLCBtZXRhKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGtleSA9ICgoT2JqZWN0SWQpaWQpLmdldElkKCk7CiAg\nICAgICAgT2JqZWN0IHZhbCA9IG51bGw7CiAgICAgICAgaWYgKG1hcHBlZEJ5\nSWRGaWVsZE5hbWUubGVuZ3RoKCkgIT0gMCkgewogICAgICAgICAgICBpZiAo\nKChPYmplY3RJZClpZCkuZ2V0SWQoKSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOyAgICAgICAgCQogICAgICAgICAgICBDbGFzcyBp\nZENsYXNzID0gKChPYmplY3RJZClpZCkuZ2V0SWQoKS5nZXRDbGFzcygpOwog\nICAgICAgICAgICB2YWwgPSBSZWZsZWN0aW9uLmdldChrZXksIAogICAgICAg\nICAgICAgICAgICAgIFJlZmxlY3Rpb24uZmluZEZpZWxkKGlkQ2xhc3MsIG1h\ncHBlZEJ5SWRGaWVsZE5hbWUsIHRydWUpKTsgCiAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgIHZhbCA9IGtleTsKICAgICAgICAKICAgICAgICBib29sZWFu\nIG5vdFNldCA9ICh2YWwgPT0gbnVsbCAgCiAgICAgICAgICAgICAgICB8fCAo\ndmFsIGluc3RhbmNlb2YgU3RyaW5nICYmICgoU3RyaW5nKXZhbCkubGVuZ3Ro\nKCkgPT0gMCkKICAgICAgICAgICAgICAgIHx8ICh2YWwgaW5zdGFuY2VvZiBO\ndW1iZXIgJiYgKChOdW1iZXIpdmFsKS5sb25nVmFsdWUoKSA9PSAwKSk7CiAg\nICAgICAgcmV0dXJuICFub3RTZXQ7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBrZXkgZnJvbSB0aGUgZ2l2ZW4gaWQuIAogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZXRLZXkoT2JqZWN0IGlkLCBD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxs\nIHx8IGlkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAg\nICAgIGludCB0eXBlID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClbMF0u\nZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCk7CiAgICAgICAgICAgIHN3aXRj\naCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgog\nICAgICAgICAgICAgICAgICAgIHJldHVybiAoKEJ5dGVJZClpZCkuZ2V0SWQo\nKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gKChDaGFySWQpaWQpLmdldElkKCk7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAg\nICAgICAgIHJldHVybiAoKERvdWJsZUlkKWlkKS5nZXRJZCgpOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuICgoRmxvYXRJZClpZCkuZ2V0SWQoKTsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nICgoSW50SWQpaWQpLmdldElkKCk7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoTG9uZ0lk\nKWlkKS5nZXRJZCgpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlQ6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9P\nQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoU2hvcnRJZClpZCku\nZ2V0SWQoKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklO\nRzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChTdHJpbmdJZClpZCku\nZ2V0SWQoKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoRGF0ZUlkKWlkKS5nZXRJ\nZCgpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiAoKE9iamVjdElkKWlkKS5nZXRJZCgpOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gKChCaWdEZWNpbWFsSWQpaWQpLmdldElk\nKCk7IAogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdF\nUjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChCaWdJbnRlZ2VySWQp\naWQpLmdldElkKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsgLy8gSWRDbGFzcwogICAg\nICAgICAgICByZXR1cm4gKChPYmplY3RJZClpZCkuZ2V0SWQoKTsKICAgICAg\nICB9CgogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHVzZWQg\ndG8gdHJhbnNmZXIgcGsgdmFsdWVzIHRvL2Zyb20gYXBwbGljYXRpb24gb2lk\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJpbWFyeUtl\neUZpZWxkTWFuYWdlcgogICAgICAgIGltcGxlbWVudHMgRmllbGRNYW5hZ2Vy\nIHsKCiAgICAgICAgcHJpdmF0ZSBPYmplY3RbXSBfc3RvcmUgPSBudWxsOwog\nICAgICAgIHByaXZhdGUgaW50IF9pbmRleCA9IDA7CiAgICAgICAgcHJpdmF0\nZSBDbGFzc01ldGFEYXRhIF9tZXRhID0gbnVsbDsKCiAgICAgICAgcHVibGlj\nIHZvaWQgc2V0TWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgICAgIF9tZXRhID0gbWV0YTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBPYmplY3RbXSBnZXRTdG9yZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9z\ndG9yZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0b3Jl\nKE9iamVjdFtdIHN0b3JlKSB7CiAgICAgICAgICAgIF9zdG9yZSA9IHN0b3Jl\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCb29sZWFu\nRmllbGQoaW50IGZpZWxkLCBib29sZWFuIHZhbCkgewogICAgICAgICAgICBz\ndG9yZSgodmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCeXRlRmllbGQo\naW50IGZpZWxkLCBieXRlIHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcg\nQnl0ZSh2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlQ2hhckZpZWxkKGludCBmaWVsZCwgY2hhciB2YWwpIHsKICAgICAgICAg\nICAgc3RvcmUobmV3IENoYXJhY3Rlcih2YWwpKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNo\nb3J0IHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgU2hvcnQodmFsKSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxk\nKGludCBmaWVsZCwgaW50IHZhbCkgewogICAgICAgICAgICBzdG9yZSh2YWwp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVMb25nRmll\nbGQoaW50IGZpZWxkLCBsb25nIHZhbCkgewogICAgICAgICAgICBzdG9yZSh2\nYWwpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVGbG9h\ndEZpZWxkKGludCBmaWVsZCwgZmxvYXQgdmFsKSB7CiAgICAgICAgICAgIHN0\nb3JlKG5ldyBGbG9hdCh2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlRG91YmxlRmllbGQoaW50IGZpZWxkLCBkb3VibGUgdmFs\nKSB7CiAgICAgICAgICAgIHN0b3JlKG5ldyBEb3VibGUodmFsKSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGlu\ndCBmaWVsZCwgU3RyaW5nIHZhbCkgewogICAgICAgICAgICBzdG9yZSh2YWwp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVPYmplY3RG\naWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICAgICAgc3Rv\ncmUodmFsKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGZl\ndGNoQm9vbGVhbkZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1\ncm4gKHJldHJpZXZlKGZpZWxkKSA9PSBCb29sZWFuLlRSVUUpID8gdHJ1ZSA6\nIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGNoYXIgZmV0Y2hD\naGFyRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiAoKENo\nYXJhY3RlcikgcmV0cmlldmUoZmllbGQpKS5jaGFyVmFsdWUoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBm\naWVsZCkgewogICAgICAgICAgICByZXR1cm4gKChOdW1iZXIpIHJldHJpZXZl\nKGZpZWxkKSkuYnl0ZVZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgc2hvcnQgZmV0Y2hTaG9ydEZpZWxkKGludCBmaWVsZCkgewogICAgICAg\nICAgICByZXR1cm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxkKSkuc2hvcnRW\nYWx1ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBmZXRjaElu\ndEZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gKChOdW1i\nZXIpIHJldHJpZXZlKGZpZWxkKSkuaW50VmFsdWUoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBsb25nIGZldGNoTG9uZ0ZpZWxkKGludCBmaWVsZCkg\newogICAgICAgICAgICByZXR1cm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxk\nKSkubG9uZ1ZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmxv\nYXQgZmV0Y2hGbG9hdEZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICBy\nZXR1cm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxkKSkuZmxvYXRWYWx1ZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGRvdWJsZSBmZXRjaERvdWJs\nZUZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gKChOdW1i\nZXIpIHJldHJpZXZlKGZpZWxkKSkuZG91YmxlVmFsdWUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmcgZmV0Y2hTdHJpbmdGaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIChTdHJpbmcpIHJldHJpZXZl\nKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZmV0\nY2hPYmplY3RGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJu\nIHJldHJpZXZlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\ndm9pZCBzdG9yZShPYmplY3QgdmFsKSB7CiAgICAgICAgICAgIF9zdG9yZVtf\naW5kZXgrK10gPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIE9i\namVjdCByZXRyaWV2ZShpbnQgZmllbGQpIHsKICAgICAgICAgICAgT2JqZWN0\nIHZhbCA9IF9zdG9yZVtfaW5kZXgrK107CiAgICAgICAgICAgIGlmIChfbWV0\nYSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgICAgIGlm\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5QQykK\nICAgICAgICAgICAgICAgICAgICB2YWwgPSBKYXZhVHlwZXMuY29udmVydCh2\nYWwsIGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHZhbCA9IEphdmFUeXBlcy5j\nb252ZXJ0KHZhbCwgSmF2YVR5cGVzLmdldFR5cGVDb2RlKGZtZC4KICAgICAg\nICAgICAgICAgICAgICAgICAgZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSkpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2YWw7CgkJfQoJfQp9\nCg==\n","encoding":"base64"}

