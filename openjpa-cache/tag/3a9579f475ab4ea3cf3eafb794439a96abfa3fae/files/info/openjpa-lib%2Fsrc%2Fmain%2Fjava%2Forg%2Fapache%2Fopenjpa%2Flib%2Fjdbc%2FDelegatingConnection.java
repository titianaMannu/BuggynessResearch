{"sha":"6a9516449d1e3d7e347aba5867da89dd6ffd16e8","node_id":"MDQ6QmxvYjIwNjM2NDo2YTk1MTY0NDlkMWUzZDdlMzQ3YWJhNTg2N2RhODlkZDZmZmQxNmU4","size":21615,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6a9516449d1e3d7e347aba5867da89dd6ffd16e8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmM7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJsZVN0\nYXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBq\nYXZhLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuUHJl\ncGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7Cmlt\ncG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5T\nUUxXYXJuaW5nOwppbXBvcnQgamF2YS5zcWwuU2F2ZXBvaW50OwppbXBvcnQg\namF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJsZVJ1bnRpbWVFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xvc2VhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNvbmNyZXRl\nQ2xhc3NHZW5lcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwoKCi8qKgogKiBXcmFwcGVyIGFyb3VuZCBhbiBl\neGlzdGluZyBjb25uZWN0aW9uLiBTdWJjbGFzc2VzIGNhbiBvdmVycmlkZSB0\naGUKICogbWV0aG9kcyB3aG9zZSBiZWhhdmlvciB0aGV5IG1lYW4gdG8gY2hh\nbmdlLiBUaGUgPGNvZGU+ZXF1YWxzPC9jb2RlPiBhbmQKICogPGNvZGU+aGFz\naENvZGU8L2NvZGU+IG1ldGhvZHMgcGFzcyB0aHJvdWdoIHRvIHRoZSBiYXNl\nIHVuZGVybHlpbmcgZGF0YQogKiBzdG9yZSBjb25uZWN0aW9uLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIERl\nbGVnYXRpbmdDb25uZWN0aW9uIGltcGxlbWVudHMgQ29ubmVjdGlvbiwgQ2xv\nc2VhYmxlIHsKCiAgICBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8RGVsZWdh\ndGluZ0Nvbm5lY3Rpb24+IGNvbmNyZXRlSW1wbDsKICAgIHN0YXRpYyB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uY3JldGVJbXBsID0gQ29uY3Jl\ndGVDbGFzc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKERlbGVn\nYXRpbmdDb25uZWN0aW9uLmNsYXNzLCBDb25uZWN0aW9uLmNsYXNzKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgRXhjZXB0aW9uSW5Jbml0aWFsaXplckVycm9yKGUpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLyBqZGJjIDMgbWV0aG9kIGtleXMKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIE9iamVjdCBTRVRfSE9MREFCSUxJVFkgPSBuZXcg\nT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgR0VU\nX0hPTERBQklMSVRZID0gbmV3IE9iamVjdCgpOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgT2JqZWN0IFNFVF9TQVZFUE9JTlRfTk9OQU1FID0gbmV3IE9i\namVjdCgpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IFNFVF9T\nQVZFUE9JTlQgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBPYmplY3QgUk9MTEJBQ0tfU0FWRVBPSU5UID0gbmV3IE9iamVjdCgp\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IFJFTEVBU0VfU0FW\nRVBPSU5UID0gbmV3IE9iamVjdCgpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgT2JqZWN0IENSRUFURV9TVEFURU1FTlQgPSBuZXcgT2JqZWN0KCk7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgUFJFUEFSRV9TVEFURU1F\nTlQgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBP\nYmplY3QgUFJFUEFSRV9DQUxMID0gbmV3IE9iamVjdCgpOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgT2JqZWN0IFBSRVBBUkVfV0lUSF9LRVlTID0gbmV3\nIE9iamVjdCgpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IFBS\nRVBBUkVfV0lUSF9JTkRFWCA9IG5ldyBPYmplY3QoKTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE9iamVjdCBQUkVQQVJFX1dJVEhfTkFNRVMgPSBuZXcg\nT2JqZWN0KCk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVy\nIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChEZWxlZ2F0\naW5nQ29ubmVjdGlvbi5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTWFwPE9iamVjdCwgTWV0aG9kPiBfamRiYzM7CgogICAgc3RhdGljIHsK\nICAgICAgICBib29sZWFuIGpkYmMzID0gZmFsc2U7CiAgICAgICAgTWV0aG9k\nIG0gPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG0gPSBDb25u\nZWN0aW9uLmNsYXNzLmdldE1ldGhvZCgic2V0U2F2ZXBvaW50IiwgbmV3IENs\nYXNzW117IFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgamRiYzMgPSB0\ncnVlOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAg\nfQoKICAgICAgICBpZiAoamRiYzMpIHsKICAgICAgICAgICAgX2pkYmMzID0g\nbmV3IEhhc2hNYXA8T2JqZWN0LE1ldGhvZD4oKTsKICAgICAgICAgICAgX2pk\nYmMzLnB1dChTRVRfU0FWRVBPSU5ULCBtKTsKICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgX2pkYmMzID0gbnVsbDsKICAgIH0KCiAgICBwcml2YXRlIGZp\nbmFsIENvbm5lY3Rpb24gX2Nvbm47CiAgICBwcml2YXRlIGZpbmFsIERlbGVn\nYXRpbmdDb25uZWN0aW9uIF9kZWw7CgogICAgcHVibGljIERlbGVnYXRpbmdD\nb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikgewogICAgICAgIF9jb25uID0g\nY29ubjsKICAgICAgICBpZiAoY29ubiBpbnN0YW5jZW9mIERlbGVnYXRpbmdD\nb25uZWN0aW9uKQogICAgICAgICAgICBfZGVsID0gKERlbGVnYXRpbmdDb25u\nZWN0aW9uKSBfY29ubjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9kZWwg\nPSBudWxsOwogICAgfQoKICAgIC8qKiAKICAgICAqICBDb25zdHJ1Y3RvciBm\nb3IgdGhlIGNvbmNyZXRlIGltcGxlbWVudGF0aW9uIG9mIHRoaXMgYWJzdHJh\nY3QgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgRGVsZWdhdGlu\nZ0Nvbm5lY3Rpb24gbmV3SW5zdGFuY2UoQ29ubmVjdGlvbiBjb25uKSB7CiAg\nICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFu\nY2UoY29uY3JldGVJbXBsLCBjb25uKTsKICAgIH0KCiAgICAvKiogCiAgICAg\nKiAgTWFya2VyIHRvIGVuZm9yY2UgdGhhdCBzdWJjbGFzc2VzIG9mIHRoaXMg\nY2xhc3MgYXJlIGFic3RyYWN0LgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3Qgdm9pZCBlbmZvcmNlQWJzdHJhY3QoKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgd3JhcHBlZCBjb25uZWN0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgQ29ubmVjdGlvbiBnZXREZWxlZ2F0ZSgpIHsKICAgICAgICByZXR1\ncm4gX2Nvbm47CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJh\nc2UgdW5kZXJseWluZyBkYXRhIHN0b3JlIGNvbm5lY3Rpb24uCiAgICAgKi8K\nICAgIHB1YmxpYyBDb25uZWN0aW9uIGdldElubmVybW9zdERlbGVnYXRlKCkg\newogICAgICAgIHJldHVybiAoX2RlbCA9PSBudWxsKSA/IF9jb25uIDogX2Rl\nbC5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgaGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIGdldElubmVybW9zdERl\nbGVnYXRlKCkuaGFzaENvZGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09\nIHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChv\ndGhlciBpbnN0YW5jZW9mIERlbGVnYXRpbmdDb25uZWN0aW9uKQogICAgICAg\nICAgICBvdGhlciA9ICgoRGVsZWdhdGluZ0Nvbm5lY3Rpb24pIG90aGVyKS5n\nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgIHJldHVybiBnZXRJbm5l\ncm1vc3REZWxlZ2F0ZSgpLmVxdWFscyhvdGhlcik7CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWZmZXIg\nYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigiY29ubiAiKS5hcHBlbmQoaGFzaENv\nZGUoKSk7CiAgICAgICAgYXBwZW5kSW5mbyhidWYpOwogICAgICAgIHJldHVy\nbiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBh\ncHBlbmRJbmZvKFN0cmluZ0J1ZmZlciBidWYpIHsKICAgICAgICBpZiAoX2Rl\nbCAhPSBudWxsKQogICAgICAgICAgICBfZGVsLmFwcGVuZEluZm8oYnVmKTsK\nICAgIH0KCiAgICBwdWJsaWMgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudCgp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBjcmVhdGVT\ndGF0ZW1lbnQodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBzdGF0ZW1lbnQsIHdpdGggdGhlIG9wdGlvbiBvZiBub3Qgd3JhcHBpbmcg\naXQgaW4gYQogICAgICoge0BsaW5rIERlbGVnYXRpbmdTdGF0ZW1lbnR9LCB3\naGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\nYXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFwKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdGF0ZW1lbnQgc3RtbnQ7CiAgICAg\nICAgaWYgKF9kZWwgIT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVs\nLmNyZWF0ZVN0YXRlbWVudChmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG1udCA9IF9jb25uLmNyZWF0ZVN0YXRlbWVudCgpOwogICAgICAg\nIGlmICh3cmFwKQogICAgICAgICAgICBzdG1udCA9IERlbGVnYXRpbmdTdGF0\nZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRoaXMpOwogICAgICAgIHJldHVy\nbiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQg\ncHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3RyKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzdHIsIHRy\ndWUpOwogICAgfQoKICAgIC8qKgogICAgICogUHJlcGFyZSBhIHN0YXRlbWVu\ndCwgd2l0aCB0aGUgb3B0aW9uIG9mIG5vdCB3cmFwcGluZyBpdCBpbiBhCiAg\nICAgKiB7QGxpbmsgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50fSwgd2hp\nY2ggaXMgdGhlIGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmVw\nYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzdHIsIGJv\nb2xlYW4gd3JhcCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2Rl\nbCAhPSBudWxsKQogICAgICAgICAgICBzdG1udCA9IF9kZWwucHJlcGFyZVN0\nYXRlbWVudChzdHIsIGZhbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHN0bW50ID0gX2Nvbm4ucHJlcGFyZVN0YXRlbWVudChzdHIsIFJlc3VsdFNl\ndC5UWVBFX0ZPUldBUkRfT05MWSwgCiAgICAgICAgICAgICAgICBSZXN1bHRT\nZXQuQ09OQ1VSX1JFQURfT05MWSk7CiAgICAgICAgaWYgKHdyYXApCiAgICAg\nICAgICAgIHN0bW50ID0gRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50Lm5l\nd0luc3RhbmNlKHN0bW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7\nCiAgICB9CgogICAgcHVibGljIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVD\nYWxsKFN0cmluZyBzdHIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBwcmVwYXJlQ2FsbChzdHIsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogUHJlcGFyZSBhIGNhbGwsIHdpdGggdGhlIG9wdGlvbiBvZiBu\nb3Qgd3JhcHBpbmcgaXQgaW4gYQogICAgICoge0BsaW5rIERlbGVnYXRpbmdD\nYWxsYWJsZVN0YXRlbWVudH0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNh\nbGwoU3RyaW5nIHN0ciwgYm9vbGVhbiB3cmFwKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIENhbGxhYmxlU3RhdGVtZW50IHN0bW50\nOwogICAgICAgIGlmIChfZGVsICE9IG51bGwpCiAgICAgICAgICAgIHN0bW50\nID0gX2RlbC5wcmVwYXJlQ2FsbChzdHIsIGZhbHNlKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHN0bW50ID0gX2Nvbm4ucHJlcGFyZUNhbGwoc3RyKTsK\nICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBEZWxlZ2F0\naW5nQ2FsbGFibGVTdGF0ZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRoaXMp\nOwogICAgICAgIHJldHVybiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIG5hdGl2ZVNRTChTdHJpbmcgc3RyKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gX2Nvbm4ubmF0aXZlU1FMKHN0cik7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0QXV0b0NvbW1pdChib29sZWFuIGJvb2wp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIF9jb25uLnNldEF1dG9D\nb21taXQoYm9vbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0QXV0\nb0NvbW1pdCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBfY29ubi5nZXRBdXRvQ29tbWl0KCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgY29tbWl0KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX2Nv\nbm4uY29tbWl0KCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2so\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBfY29ubi5yb2xsYmFj\naygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgX2Nvbm4uY2xvc2UoKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBfY29ubi5pc0Nsb3NlZCgpOwogICAgfQoK\nICAgIHB1YmxpYyBEYXRhYmFzZU1ldGFEYXRhIGdldE1ldGFEYXRhKCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGFEYXRh\nKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRh\nZGF0YSwgd2l0aCB0aGUgb3B0aW9uIG9mIG5vdCB3cmFwcGluZyBpdCBpbiBh\nCiAgICAgKiB7QGxpbmsgRGVsZWdhdGluZ0RhdGFiYXNlTWV0YURhdGF9LCB3\naGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIERh\ndGFiYXNlTWV0YURhdGEgZ2V0TWV0YURhdGEoYm9vbGVhbiB3cmFwKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBEYXRhYmFzZU1ldGFEYXRhIG1l\ndGE7CiAgICAgICAgaWYgKF9kZWwgIT0gbnVsbCkKICAgICAgICAgICAgbWV0\nYSA9IF9kZWwuZ2V0TWV0YURhdGEoZmFsc2UpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgbWV0YSA9IF9jb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAg\naWYgKHdyYXApCiAgICAgICAgICAgIG1ldGEgPSBEZWxlZ2F0aW5nRGF0YWJh\nc2VNZXRhRGF0YS5uZXdJbnN0YW5jZShtZXRhLCB0aGlzKTsKICAgICAgICBy\nZXR1cm4gbWV0YTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZWFkT25s\neShib29sZWFuIGJvb2wpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIF9jb25uLnNldFJlYWRPbmx5KGJvb2wpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzUmVhZE9ubHkoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gX2Nvbm4uaXNSZWFkT25seSgpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldENhdGFsb2coU3RyaW5nIHN0cikgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgX2Nvbm4uc2V0Q2F0YWxvZyhzdHIpOwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2F0YWxvZygpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBfY29ubi5nZXRDYXRhbG9nKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJhbnNhY3Rpb25Jc29sYXRp\nb24oaW50IGkpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIF9jb25u\nLnNldFRyYW5zYWN0aW9uSXNvbGF0aW9uKGkpOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgZ2V0VHJhbnNhY3Rpb25Jc29sYXRpb24oKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gX2Nvbm4uZ2V0VHJhbnNhY3Rpb25J\nc29sYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgU1FMV2FybmluZyBnZXRX\nYXJuaW5ncygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBfY29ubi5nZXRXYXJuaW5ncygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGNsZWFyV2FybmluZ3MoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBfY29ubi5jbGVhcldhcm5pbmdzKCk7CiAgICB9CgogICAgcHVibGljIFN0\nYXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoaW50IHR5cGUsIGludCBjb25jdXIp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBjcmVhdGVT\ndGF0ZW1lbnQodHlwZSwgY29uY3VyLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIHN0YXRlbWVudCwgd2l0aCB0aGUgb3B0aW9uIG9m\nIG5vdCB3cmFwcGluZyBpdCBpbiBhCiAgICAgKiB7QGxpbmsgRGVsZWdhdGlu\nZ1N0YXRlbWVudH0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChpbnQgdHlw\nZSwgaW50IGNvbmN1ciwgYm9vbGVhbiB3cmFwKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIFN0YXRlbWVudCBzdG1udDsKICAgICAg\nICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAgICAgICBzdG1udCA9IF9kZWwu\nY3JlYXRlU3RhdGVtZW50KHR5cGUsIGNvbmN1ciwgZmFsc2UpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RtbnQgPSBfY29ubi5jcmVhdGVTdGF0ZW1l\nbnQodHlwZSwgY29uY3VyKTsKICAgICAgICBpZiAod3JhcCkKICAgICAgICAg\nICAgc3RtbnQgPSBEZWxlZ2F0aW5nU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0\nbW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAg\ncHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3Ry\naW5nIHN0ciwgaW50IHR5cGUsIGludCBjb25jdXIpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVTdGF0ZW1l\nbnQoc3RyLCB0eXBlLCBjb25jdXIsIHRydWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogUHJlcGFyZSBhIHN0YXRlbWVudCwgd2l0aCB0aGUgb3B0aW9uIG9m\nIG5vdCB3cmFwcGluZyBpdCBpbiBhCiAgICAgKiB7QGxpbmsgRGVsZWdhdGlu\nZ1ByZXBhcmVkU3RhdGVtZW50fSwgd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJl\nU3RhdGVtZW50KFN0cmluZyBzdHIsIGludCB0eXBlLAogICAgICAgIGludCBj\nb25jdXIsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9k\nZWwgIT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVT\ndGF0ZW1lbnQoc3RyLCB0eXBlLCBjb25jdXIsIGZhbHNlKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHN0bW50ID0gX2Nvbm4ucHJlcGFyZVN0YXRlbWVu\ndChzdHIsIHR5cGUsIGNvbmN1cik7CiAgICAgICAgaWYgKHdyYXApCiAgICAg\nICAgICAgIHN0bW50ID0gRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50Lm5l\nd0luc3RhbmNlKHN0bW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7\nCiAgICB9CgogICAgcHVibGljIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVD\nYWxsKFN0cmluZyBzdHIsIGludCB0eXBlLCBpbnQgY29uY3VyKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBwcmVwYXJl\nQ2FsbChzdHIsIHR5cGUsIGNvbmN1ciwgdHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQcmVwYXJlIGEgY2FsbCwgd2l0aCB0aGUgb3B0aW9uIG9mIG5v\ndCB3cmFwcGluZyBpdCBpbiBhCiAgICAgKiB7QGxpbmsgRGVsZWdhdGluZ0Nh\nbGxhYmxlU3RhdGVtZW50fSwgd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDYWxsYWJsZVN0YXRlbWVudCBwcmVwYXJlQ2Fs\nbChTdHJpbmcgc3RyLCBpbnQgdHlwZSwgaW50IGNvbmN1ciwKICAgICAgICBi\nb29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENh\nbGxhYmxlU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9IG51\nbGwpCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5wcmVwYXJlQ2FsbChzdHIs\nIHR5cGUsIGNvbmN1ciwgZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc3RtbnQgPSBfY29ubi5wcmVwYXJlQ2FsbChzdHIsIHR5cGUsIGNvbmN1\ncik7CiAgICAgICAgaWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0gRGVs\nZWdhdGluZ0NhbGxhYmxlU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0bW50LCB0\naGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGlj\nIE1hcDxTdHJpbmcsIENsYXNzPD8+PiBnZXRUeXBlTWFwKCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIF9jb25uLmdldFR5cGVNYXAo\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlTWFwKE1hcDxTdHJp\nbmcsIENsYXNzPD8+PiBtYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIF9jb25uLnNldFR5cGVNYXAobWFwKTsKICAgIH0KCiAgICAvLyBKREJD\nIDMuMCBtZXRob2RzIGZvbGxvdzsgdGhlc2UgYXJlIHJlcXVpcmVkIHRvIGJl\nIGFibGUgdG8KICAgIC8vIGNvbXBpbGUgYWdhaW5zdCBKREsgMS40OyB0aGVz\nZSBtZXRob2RzIHdpbGwgbm90IHdvcmsgb24KICAgIC8vIHByZXZpb3VzIEpW\nTXMKCiAgICBwdWJsaWMgdm9pZCBzZXRIb2xkYWJpbGl0eShpbnQgaG9sZGFi\naWxpdHkpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpE\nQkMzKCk7CiAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBfamRiYzMuZ2V0\nKFNFVF9IT0xEQUJJTElUWSk7CiAgICAgICAgaWYgKG0gPT0gbnVsbCkKICAg\nICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFNFVF9IT0xEQUJJTElU\nWSwgInNldEhvbGRhYmlsaXR5IiwKICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgaW52b2tlSkRCQzMobSwgbmV3\nIE9iamVjdFtdeyBob2xkYWJpbGl0eSB9KTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldEhvbGRhYmlsaXR5KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgYXNzZXJ0SkRCQzMoKTsKICAgICAgICBNZXRob2QgbSA9IChNZXRo\nb2QpIF9qZGJjMy5nZXQoR0VUX0hPTERBQklMSVRZKTsKICAgICAgICBpZiAo\nbSA9PSBudWxsKQogICAgICAgICAgICBtID0gY3JlYXRlSkRCQzNNZXRob2Qo\nR0VUX0hPTERBQklMSVRZLCAiZ2V0SG9sZGFiaWxpdHkiLCBudWxsKTsKICAg\nICAgICByZXR1cm4gKChOdW1iZXIpIGludm9rZUpEQkMzKG0sIG51bGwpKS5p\nbnRWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBTYXZlcG9pbnQgc2V0U2F2\nZXBvaW50KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0\nSkRCQzMoKTsKICAgICAgICBNZXRob2QgbSA9IChNZXRob2QpIF9qZGJjMy5n\nZXQoU0VUX1NBVkVQT0lOVF9OT05BTUUpOwogICAgICAgIGlmIChtID09IG51\nbGwpCiAgICAgICAgICAgIG0gPSBjcmVhdGVKREJDM01ldGhvZChTRVRfU0FW\nRVBPSU5UX05PTkFNRSwgInNldFNhdmVwb2ludCIsIG51bGwpOwogICAgICAg\nIHJldHVybiAoU2F2ZXBvaW50KSBpbnZva2VKREJDMyhtLCBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgU2F2ZXBvaW50IHNldFNhdmVwb2ludChTdHJpbmcg\nc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRKREJDMygpOwogICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMz\nLmdldChTRVRfU0FWRVBPSU5UKTsKICAgICAgICBpZiAobSA9PSBudWxsKQog\nICAgICAgICAgICBtID0gY3JlYXRlSkRCQzNNZXRob2QoU0VUX1NBVkVQT0lO\nVCwgInNldFNhdmVwb2ludCIsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgIHJldHVybiAoU2F2ZXBvaW50\nKSBpbnZva2VKREJDMyhtLCBuZXcgT2JqZWN0W117IHNhdmVwb2ludCB9KTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjayhTYXZlcG9pbnQgc2F2\nZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRK\nREJDMygpOwogICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdl\ndChST0xMQkFDS19TQVZFUE9JTlQpOwogICAgICAgIGlmIChtID09IG51bGwp\nCiAgICAgICAgICAgIG0gPSBjcmVhdGVKREJDM01ldGhvZChST0xMQkFDS19T\nQVZFUE9JTlQsICJyb2xsYmFjayIsCiAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgU2F2ZXBvaW50LmNsYXNzIH0pOwogICAgICAgIGludm9rZUpEQkMz\nKG0sIG5ldyBPYmplY3RbXXsgc2F2ZXBvaW50IH0pOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9pbnQoU2F2ZXBvaW50IHNhdmVwb2lu\ndCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMo\nKTsKICAgICAgICBNZXRob2QgbSA9IChNZXRob2QpIF9qZGJjMy5nZXQoUkVM\nRUFTRV9TQVZFUE9JTlQpOwogICAgICAgIGlmIChtID09IG51bGwpCiAgICAg\nICAgICAgIG0gPSBjcmVhdGVKREJDM01ldGhvZChSRUxFQVNFX1NBVkVQT0lO\nVCwgInJlbGVhc2VTYXZlcG9pbnQiLAogICAgICAgICAgICAgICAgbmV3IENs\nYXNzW117IFNhdmVwb2ludC5jbGFzcyB9KTsKICAgICAgICBpbnZva2VKREJD\nMyhtLCBuZXcgT2JqZWN0W117IHNhdmVwb2ludCB9KTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChpbnQgcmVzdWx0U2V0\nVHlwZSwKICAgICAgICBpbnQgcmVzdWx0U2V0Q29uY3VycmVuY3ksIGludCBy\nZXN1bHRTZXRIb2xkYWJpbGl0eSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBhc3NlcnRKREJDMygpOwogICAgICAgIHJldHVybiBj\ncmVhdGVTdGF0ZW1lbnQocmVzdWx0U2V0VHlwZSwgcmVzdWx0U2V0Q29uY3Vy\ncmVuY3ksCiAgICAgICAgICAgIHJlc3VsdFNldEhvbGRhYmlsaXR5LCB0cnVl\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRl\nbWVudChpbnQgcmVzdWx0U2V0VHlwZSwKICAgICAgICBpbnQgcmVzdWx0U2V0\nQ29uY3VycmVuY3ksIGludCByZXN1bHRTZXRIb2xkYWJpbGl0eSwgYm9vbGVh\nbiB3cmFwKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIFN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQog\nICAgICAgICAgICBzdG1udCA9IF9kZWwuY3JlYXRlU3RhdGVtZW50KHJlc3Vs\ndFNldFR5cGUsIHJlc3VsdFNldENvbmN1cnJlbmN5LAogICAgICAgICAgICAg\nICAgcmVzdWx0U2V0SG9sZGFiaWxpdHksIGZhbHNlKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBfamRiYzMuZ2V0\nKENSRUFURV9TVEFURU1FTlQpOwogICAgICAgICAgICBpZiAobSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKENSRUFU\nRV9TVEFURU1FTlQsICJjcmVhdGVTdGF0ZW1lbnQiLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MsIGludC5jbGFzcywgaW50\nLmNsYXNzIH0pOwogICAgICAgICAgICBzdG1udCA9IChTdGF0ZW1lbnQpIGlu\ndm9rZUpEQkMzKG0sIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgIHJl\nc3VsdFNldFR5cGUsCiAgICAgICAgICAgICAgICByZXN1bHRTZXRDb25jdXJy\nZW5jeSwKICAgICAgICAgICAgICAgIHJlc3VsdFNldEhvbGRhYmlsaXR5IH0p\nOwogICAgICAgIH0KICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgc3Rt\nbnQgPSBEZWxlZ2F0aW5nU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0bW50LCB0\naGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGlj\nIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNx\nbCwKICAgICAgICBpbnQgcmVzdWx0U2V0VHlwZSwgaW50IHJlc3VsdFNldENv\nbmN1cnJlbmN5LCBpbnQgcmVzdWx0U2V0SG9sZGFiaWxpdHkpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMoKTsK\nICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWwsIHJlc3VsdFNl\ndFR5cGUsIHJlc3VsdFNldENvbmN1cnJlbmN5LAogICAgICAgICAgICByZXN1\nbHRTZXRIb2xkYWJpbGl0eSwgdHJ1ZSk7CiAgICB9CgogICAgcHJvdGVjdGVk\nIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNx\nbCwKICAgICAgICBpbnQgcmVzdWx0U2V0VHlwZSwgaW50IHJlc3VsdFNldENv\nbmN1cnJlbmN5LCBpbnQgcmVzdWx0U2V0SG9sZGFiaWxpdHksCiAgICAgICAg\nYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBu\ndWxsKQogICAgICAgICAgICBzdG1udCA9IF9kZWwucHJlcGFyZVN0YXRlbWVu\ndChzcWwsIHJlc3VsdFNldFR5cGUsCiAgICAgICAgICAgICAgICByZXN1bHRT\nZXRDb25jdXJyZW5jeSwgcmVzdWx0U2V0SG9sZGFiaWxpdHksIGZhbHNlKTsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9k\nKSBfamRiYzMuZ2V0KFBSRVBBUkVfU1RBVEVNRU5UKTsKICAgICAgICAgICAg\naWYgKG0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIG0gPSBjcmVhdGVKREJD\nM01ldGhvZChQUkVQQVJFX1NUQVRFTUVOVCwgInByZXBhcmVTdGF0ZW1lbnQi\nLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xh\nc3MsIGludC5jbGFzcywgaW50LmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nICAgICBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgIHN0bW50ID0gKFByZXBh\ncmVkU3RhdGVtZW50KSBpbnZva2VKREJDMyhtLCBuZXcgT2JqZWN0W117IHNx\nbCwKICAgICAgICAgICAgICAgIHJlc3VsdFNldFR5cGUsCiAgICAgICAgICAg\nICAgICByZXN1bHRTZXRDb25jdXJyZW5jeSwKICAgICAgICAgICAgICAgIHJl\nc3VsdFNldEhvbGRhYmlsaXR5IH0pOwogICAgICAgIH0KICAgICAgICBpZiAo\nd3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBEZWxlZ2F0aW5nUHJlcGFyZWRT\ndGF0ZW1lbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRoaXMpOwogICAgICAgIHJl\ndHVybiBzdG1udDsKICAgIH0KCiAgICBwdWJsaWMgQ2FsbGFibGVTdGF0ZW1l\nbnQgcHJlcGFyZUNhbGwoU3RyaW5nIHNxbCwKICAgICAgICBpbnQgcmVzdWx0\nU2V0VHlwZSwgaW50IHJlc3VsdFNldENvbmN1cnJlbmN5LCBpbnQgcmVzdWx0\nU2V0SG9sZGFiaWxpdHkpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgYXNzZXJ0SkRCQzMoKTsKICAgICAgICByZXR1cm4gcHJlcGFy\nZUNhbGwoc3FsLCByZXN1bHRTZXRUeXBlLCByZXN1bHRTZXRDb25jdXJyZW5j\neSwKICAgICAgICAgICAgcmVzdWx0U2V0SG9sZGFiaWxpdHksIHRydWUpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBDYWxsYWJsZVN0YXRlbWVudCBwcmVwYXJl\nQ2FsbChTdHJpbmcgc3FsLCBpbnQgcmVzdWx0U2V0VHlwZSwKICAgICAgICBp\nbnQgcmVzdWx0U2V0Q29uY3VycmVuY3ksIGludCByZXN1bHRTZXRIb2xkYWJp\nbGl0eSwgYm9vbGVhbiB3cmFwKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIENhbGxhYmxlU3RhdGVtZW50IHN0bW50OwogICAgICAg\nIGlmIChfZGVsICE9IG51bGwpCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5w\ncmVwYXJlQ2FsbChzcWwsIHJlc3VsdFNldFR5cGUsCiAgICAgICAgICAgICAg\nICByZXN1bHRTZXRDb25jdXJyZW5jeSwgcmVzdWx0U2V0SG9sZGFiaWxpdHks\nIGZhbHNlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgTWV0aG9kIG0g\nPSAoTWV0aG9kKSBfamRiYzMuZ2V0KFBSRVBBUkVfQ0FMTCk7CiAgICAgICAg\nICAgIGlmIChtID09IG51bGwpCiAgICAgICAgICAgICAgICBtID0gY3JlYXRl\nSkRCQzNNZXRob2QoUFJFUEFSRV9DQUxMLCAicHJlcGFyZUNhbGwiLAogICAg\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MsIGlu\ndC5jbGFzcywgaW50LmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBp\nbnQuY2xhc3MgfSk7CiAgICAgICAgICAgIHN0bW50ID0gKENhbGxhYmxlU3Rh\ndGVtZW50KSBpbnZva2VKREJDMyhtLCBuZXcgT2JqZWN0W117IHNxbCwKICAg\nICAgICAgICAgICAgIHJlc3VsdFNldFR5cGUsCiAgICAgICAgICAgICAgICBy\nZXN1bHRTZXRDb25jdXJyZW5jeSwKICAgICAgICAgICAgICAgIHJlc3VsdFNl\ndEhvbGRhYmlsaXR5IH0pOwogICAgICAgIH0KICAgICAgICBpZiAod3JhcCkK\nICAgICAgICAgICAgc3RtbnQgPSBEZWxlZ2F0aW5nQ2FsbGFibGVTdGF0ZW1l\nbnQubmV3SW5zdGFuY2Uoc3RtbnQsIHRoaXMpOwogICAgICAgIHJldHVybiBz\ndG1udDsKICAgIH0KCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQgcHJl\ncGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBpbnQgYXV0b0dlbmVyYXRlZEtl\neXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNz\nZXJ0SkRCQzMoKTsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChz\ncWwsIGF1dG9HZW5lcmF0ZWRLZXlzLCB0cnVlKTsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJp\nbmcgc3FsLAogICAgICAgIGludCBhdXRvR2VuZXJhdGVkS2V5cywgYm9vbGVh\nbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQog\nICAgICAgICAgICBzdG1udCA9IF9kZWwucHJlcGFyZVN0YXRlbWVudChzcWws\nIGF1dG9HZW5lcmF0ZWRLZXlzKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBfamRiYzMuZ2V0KFBSRVBBUkVfV0lU\nSF9LRVlTKTsKICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIG0gPSBjcmVhdGVKREJDM01ldGhvZChQUkVQQVJFX1dJVEhfS0VZ\nUywgInByZXBhcmVTdGF0ZW1lbnQiLAogICAgICAgICAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgICAg\nICAgICAgc3RtbnQgPSAoUHJlcGFyZWRTdGF0ZW1lbnQpIGludm9rZUpEQkMz\nKG0sIG5ldyBPYmplY3RbXXsgc3FsLAogICAgICAgICAgICAgICAgYXV0b0dl\nbmVyYXRlZEtleXMgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh3cmFwKQog\nICAgICAgICAgICBzdG1udCA9IERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVu\ndC5uZXdJbnN0YW5jZShzdG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0\nbW50OwogICAgfQoKICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVw\nYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsIGludFtdIGNvbHVtbkluZGV4ZXMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0\nSkRCQzMoKTsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWws\nIGNvbHVtbkluZGV4ZXMsIHRydWUpOwogICAgfQoKICAgIHByb3RlY3RlZCBQ\ncmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWws\nCiAgICAgICAgaW50W10gY29sdW1uSW5kZXhlcywgYm9vbGVhbiB3cmFwKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAgICAg\nICBzdG1udCA9IF9kZWwucHJlcGFyZVN0YXRlbWVudChzcWwsIGNvbHVtbklu\nZGV4ZXMsIHdyYXApOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBNZXRo\nb2QgbSA9IChNZXRob2QpIF9qZGJjMy5nZXQoUFJFUEFSRV9XSVRIX0lOREVY\nKTsKICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIG0gPSBjcmVhdGVKREJDM01ldGhvZChQUkVQQVJFX1dJVEhfSU5ERVgsICJw\ncmVwYXJlU3RhdGVtZW50IiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgU3RyaW5nLmNsYXNzLCBpbnRbXS5jbGFzcyB9KTsKICAgICAgICAg\nICAgc3RtbnQgPSAoUHJlcGFyZWRTdGF0ZW1lbnQpIGludm9rZUpEQkMzKG0s\nIG5ldyBPYmplY3RbXXsgc3FsLAogICAgICAgICAgICAgICAgY29sdW1uSW5k\nZXhlcyB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHdyYXApCiAgICAgICAg\nICAgIHN0bW50ID0gRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50Lm5ld0lu\nc3RhbmNlKHN0bW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7CiAg\nICB9CgogICAgcHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0\nZW1lbnQoU3RyaW5nIHNxbCwgU3RyaW5nW10gY29sdW1uTmFtZXMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRCQzMo\nKTsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWwsIGNvbHVt\nbk5hbWVzLCB0cnVlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRT\ndGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLAogICAgICAg\nIFN0cmluZ1tdIGNvbHVtbk5hbWVzLCBib29sZWFuIHdyYXApIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAg\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwgIT0g\nbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVTdGF0ZW1l\nbnQoc3FsLCBjb2x1bW5OYW1lcywgd3JhcCk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChQUkVQ\nQVJFX1dJVEhfTkFNRVMpOwogICAgICAgICAgICBpZiAobSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFBSRVBBUkVf\nV0lUSF9OQU1FUywgInByZXBhcmVTdGF0ZW1lbnQiLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MsIFN0cmluZ1tdLmNs\nYXNzIH0pOwogICAgICAgICAgICBzdG1udCA9IChQcmVwYXJlZFN0YXRlbWVu\ndCkgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtdeyBzcWwsCiAgICAgICAg\nICAgICAgICBjb2x1bW5OYW1lcyB9KTsKICAgICAgICB9CiAgICAgICAgaWYg\nKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0gRGVsZWdhdGluZ1ByZXBhcmVk\nU3RhdGVtZW50Lm5ld0luc3RhbmNlKHN0bW50LCB0aGlzKTsKICAgICAgICBy\nZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBh\nc3NlcnRKREJDMygpIHsKICAgICAgICBpZiAoX2pkYmMzID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2Vw\ndGlvbihfbG9jLmdldCgibm90LWpkYmMzIikKICAgICAgICAgICAgICAgIC5n\nZXRNZXNzYWdlKCkpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGludm9r\nZUpEQkMzKE1ldGhvZCBtLCBPYmplY3RbXSBhcmdzKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbS5p\nbnZva2UoX2Nvbm4sIGFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0\naW9uKQogICAgICAgICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0Owog\nICAgICAgICAgICB0aHJvdyBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJpbnZva2UtamRiYzMiKQogICAgICAgICAgICAgICAgLmdl\ndE1lc3NhZ2UoKSwgdCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIE1ldGhvZCBjcmVhdGVKREJDM01ldGhvZChPYmplY3Qga2V5LCBT\ndHJpbmcgbmFtZSwKICAgICAgICBDbGFzczw/PltdIGFyZ3MpIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBNZXRob2QgbSA9IENvbm5lY3Rpb24uY2xh\nc3MuZ2V0TWV0aG9kKG5hbWUsIGFyZ3MpOwogICAgICAgICAgICBfamRiYzMu\ncHV0KGtleSwgbSk7CiAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBO\nZXN0YWJsZVJ1bnRpbWVFeGNlcHRpb24oX2xvYy5nZXQoImVycm9yLWpkYmMz\nIikKICAgICAgICAgICAgICAgIC5nZXRNZXNzYWdlKCksIHQpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLyBqYXZhLnNxbC5XcmFwcGVyIGltcGxlbWVudGF0\naW9uIChKREJDIDQpCiAgICBwdWJsaWMgYm9vbGVhbiBpc1dyYXBwZXJGb3Io\nQ2xhc3MgaWZhY2UpIHsKICAgICAgICByZXR1cm4gaWZhY2UuaXNBc3NpZ25h\nYmxlRnJvbShnZXREZWxlZ2F0ZSgpLmdldENsYXNzKCkpOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgdW53cmFwKENsYXNzIGlmYWNlKSB7CiAgICAgICAg\naWYgKGlzV3JhcHBlckZvcihpZmFjZSkpCiAgICAgICAgICAgIHJldHVybiBn\nZXREZWxlZ2F0ZSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9Cn0K\n","encoding":"base64"}

