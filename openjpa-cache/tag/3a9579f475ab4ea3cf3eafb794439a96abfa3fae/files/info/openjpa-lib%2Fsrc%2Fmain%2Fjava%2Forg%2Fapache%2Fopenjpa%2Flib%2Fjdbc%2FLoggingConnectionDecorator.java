{"sha":"a6985e6e7bf8733888033fd3491647dc3d4c10e5","node_id":"MDQ6QmxvYjIwNjM2NDphNjk4NWU2ZTdiZjg3MzM4ODgwMzNmZDM0OTE2NDdkYzNkNGMxMGU1","size":79763,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a6985e6e7bf8733888033fd3491647dc3d4c10e5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmM7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBq\nYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc3FsLkFycmF5Owpp\nbXBvcnQgamF2YS5zcWwuQmF0Y2hVcGRhdGVFeGNlcHRpb247CmltcG9ydCBq\nYXZhLnNxbC5CbG9iOwppbXBvcnQgamF2YS5zcWwuQ2FsbGFibGVTdGF0ZW1l\nbnQ7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5EYXRlOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRT\ndGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZWY7CmltcG9ydCBqYXZhLnNx\nbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXRNZXRhRGF0\nYTsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEu\nc3FsLlNRTFdhcm5pbmc7CmltcG9ydCBqYXZhLnNxbC5TYXZlcG9pbnQ7Cmlt\ncG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5UaW1l\nOwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBq\nYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7\nCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmpkYmMuTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuTG9n\nZ2luZ0Nvbm5lY3Rpb24uCiAgICAgICAgTG9nZ2luZ0NhbGxhYmxlU3RhdGVt\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dp\nbmdDb25uZWN0aW9uRGVjb3JhdG9yLkxvZ2dpbmdDb25uZWN0aW9uLgogICAg\nICAgIExvZ2dpbmdEYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9y\nLkxvZ2dpbmdDb25uZWN0aW9uLgogICAgICAgIExvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5M\nb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvci5Mb2dnaW5nQ29ubmVjdGlvbi4K\nICAgICAgICBMb2dnaW5nUmVzdWx0U2V0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLkxv\nZ2dpbmdDb25uZWN0aW9uLgogICAgICAgIExvZ2dpbmdTdGF0ZW1lbnQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVy\nYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRv\nUHJpdkhlbHBlcjsKCi8qKgogKiBBIHtAbGluayBDb25uZWN0aW9uRGVjb3Jh\ndG9yfSB0aGF0IGNyZWF0ZXMgbG9nZ2luZyBjb25uZWN0aW9ucyBhbmQKICog\ne0BsaW5rIFJlcG9ydGluZ1NRTEV4Y2VwdGlvbn1zLgogKgogKiBAYXV0aG9y\nIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMg\nY2xhc3MgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVtZW50cyBD\nb25uZWN0aW9uRGVjb3JhdG9yIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgU0VQID0gSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRv\ncigpOwogICAgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPExvZ2dpbmdDb25u\nZWN0aW9uPiBsb2dnaW5nQ29ubmVjdGlvbkltcGw7CiAgICBzdGF0aWMgZmlu\nYWwgQ29uc3RydWN0b3I8TG9nZ2luZ1Jlc3VsdFNldD4gbG9nZ2luZ1Jlc3Vs\ndFNldEltcGw7CiAgICBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8TG9nZ2lu\nZ1N0YXRlbWVudD4gbG9nZ2luZ1N0YXRlbWVudEltcGw7CiAgICBzdGF0aWMg\nZmluYWwgQ29uc3RydWN0b3I8TG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50PiBs\nb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnRJbXBsOwogICAgc3RhdGljIGZpbmFs\nIENvbnN0cnVjdG9yPExvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudD4gbG9nZ2lu\nZ0NhbGxhYmxlU3RhdGVtZW50SW1wbDsKICAgIHN0YXRpYyBmaW5hbCBDb25z\ndHJ1Y3RvcjxMb2dnaW5nRGF0YWJhc2VNZXRhRGF0YT4gbG9nZ2luZ0RhdGFi\nYXNlTWV0YURhdGFJbXBsOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBXQVJOX0lHTk9SRSA9IDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgV0FSTl9MT0dfVFJBQ0UgPSAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IFdBUk5fTE9HX0lORk8gPSAyOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IFdBUk5fTE9HX1dBUk4gPSAzOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFdBUk5fTE9HX0VSUk9SID0gNDsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBXQVJOX1RIUk9XID0gNTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBXQVJOX0hBTkRMRSA9IDY7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBXQVJOSU5HX0FDVElPTlMgPSBuZXcg\nU3RyaW5nWzddOwogICAgCiAgICBzdGF0aWMgewogICAgICAgIFdBUk5JTkdf\nQUNUSU9OU1tXQVJOX0lHTk9SRV0gPSAiaWdub3JlIjsKICAgICAgICBXQVJO\nSU5HX0FDVElPTlNbV0FSTl9MT0dfVFJBQ0VdID0gInRyYWNlIjsKICAgICAg\nICBXQVJOSU5HX0FDVElPTlNbV0FSTl9MT0dfSU5GT10gPSAiaW5mbyI7CiAg\nICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5fTE9HX1dBUk5dID0gIndhcm4i\nOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX0xPR19FUlJPUl0gPSAi\nZXJyb3IiOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX1RIUk9XXSA9\nICJ0aHJvdyI7CiAgICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5fSEFORExF\nXSA9ICJoYW5kbGUiOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2dn\naW5nQ29ubmVjdGlvbkltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdl\ndENvbmNyZXRlQ29uc3RydWN0b3IoTG9nZ2luZ0Nvbm5lY3Rpb24uY2xhc3Ms\nCiAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvci5j\nbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGxvZ2dpbmdS\nZXN1bHRTZXRJbXBsID0gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5nZXRDb25j\ncmV0ZUNvbnN0cnVjdG9yKAogICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5l\nY3Rpb24uTG9nZ2luZ1Jlc3VsdFNldC5jbGFzcywgCiAgICAgICAgICAgICAg\nICBMb2dnaW5nQ29ubmVjdGlvbi5jbGFzcywgUmVzdWx0U2V0LmNsYXNzLCBT\ndGF0ZW1lbnQuY2xhc3MpOwogICAgICAgICAgICBsb2dnaW5nU3RhdGVtZW50\nSW1wbCA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0Q29uY3JldGVDb25z\ndHJ1Y3RvcigKICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLkxv\nZ2dpbmdTdGF0ZW1lbnQuY2xhc3MsCiAgICAgICAgICAgICAgICBMb2dnaW5n\nQ29ubmVjdGlvbi5jbGFzcywgU3RhdGVtZW50LmNsYXNzKTsKICAgICAgICAg\nICAgbG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50SW1wbCA9IENvbmNyZXRlQ2xh\nc3NHZW5lcmF0b3IuZ2V0Q29uY3JldGVDb25zdHJ1Y3RvcigKICAgICAgICAg\nICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLkxvZ2dpbmdQcmVwYXJlZFN0YXRl\nbWVudC5jbGFzcywgCiAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlv\nbi5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIFN0cmluZy5jbGFz\ncyk7CiAgICAgICAgICAgIGxvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudEltcGwg\nPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0\nb3IoCiAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi5Mb2dnaW5n\nQ2FsbGFibGVTdGF0ZW1lbnQuY2xhc3MsCiAgICAgICAgICAgICAgICBMb2dn\naW5nQ29ubmVjdGlvbi5jbGFzcywgQ2FsbGFibGVTdGF0ZW1lbnQuY2xhc3Ms\nIFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAgIGxvZ2dpbmdEYXRhYmFzZU1l\ndGFEYXRhSW1wbCA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0Q29uY3Jl\ndGVDb25zdHJ1Y3RvcigKICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0\naW9uLkxvZ2dpbmdEYXRhYmFzZU1ldGFEYXRhLmNsYXNzLAogICAgICAgICAg\nICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24uY2xhc3MsIERhdGFiYXNlTWV0YURh\ndGEuY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVyRXJy\nb3IoZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgZmluYWwgRGF0\nYVNvdXJjZUxvZ3MgX2xvZ3MgPSBuZXcgRGF0YVNvdXJjZUxvZ3MoKTsKICAg\nIHByaXZhdGUgU1FMRm9ybWF0dGVyIF9mb3JtYXR0ZXI7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX3ByZXR0eVByaW50OwogICAgcHJpdmF0ZSBpbnQgX3ByZXR0\neVByaW50TGluZUxlbmd0aCA9IDYwOwogICAgcHJpdmF0ZSBpbnQgX3dhcm5p\nbmdBY3Rpb24gPSBXQVJOX0lHTk9SRTsKICAgIHByaXZhdGUgU1FMV2Fybmlu\nZ0hhbmRsZXIgX3dhcm5pbmdIYW5kbGVyOwogICAgcHJpdmF0ZSBib29sZWFu\nIF90cmFja1BhcmFtZXRlcnMgPSB0cnVlOwoKICAgIC8qKgogICAgICogSWYg\nc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+LCBwcmV0dHktcHJpbnQgU1FMIGJ5\nIHJ1bm5pbmcgaXQKICAgICAqIHRocm91Z2gge0BsaW5rIFNRTEZvcm1hdHRl\nciNwcmV0dHlQcmludH0uIElmCiAgICAgKiA8Y29kZT5mYWxzZTwvY29kZT4s\nIGRvbid0IHByZXR0eS1wcmludCwgYW5kIG91dHB1dCBTUUwgbG9ncyBpbgog\nICAgICogYSBzaW5nbGUgbGluZS4gUHJldHR5LXByaW50ZWQgU1FMIGNhbiBi\nZSBlYXNpZXIgZm9yIGEgaHVtYW4gdG8KICAgICAqIHJlYWQsIGJ1dCBpcyBo\nYXJkZXIgdG8gcGFyc2Ugd2l0aCB0b29scyBsaWtlIGdyZXAuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFByZXR0eVByaW50KGJvb2xlYW4gcHJldHR5\nUHJpbnQpIHsKICAgICAgICBfcHJldHR5UHJpbnQgPSBwcmV0dHlQcmludDsK\nICAgICAgICBpZiAoX2Zvcm1hdHRlciA9PSBudWxsICYmIF9wcmV0dHlQcmlu\ndCkgewogICAgICAgICAgICBfZm9ybWF0dGVyID0gbmV3IFNRTEZvcm1hdHRl\ncigpOwogICAgICAgICAgICBfZm9ybWF0dGVyLnNldExpbmVMZW5ndGgoX3By\nZXR0eVByaW50TGluZUxlbmd0aCk7CiAgICAgICAgfSBlbHNlIGlmICghX3By\nZXR0eVByaW50KQogICAgICAgICAgICBfZm9ybWF0dGVyID0gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEBzZWUgI3NldFByZXR0eVByaW50CiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFByZXR0eVByaW50KCkgewogICAg\nICAgIHJldHVybiBfcHJldHR5UHJpbnQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgdG8gcHJpbnQgcGVyIGxpbmUg\nd2hlbgogICAgICogcHJldHR5LXByaW50aW5nIG9mIFNRTCBpcyBlbmFibGVk\nLiBEZWZhdWx0cyB0byA2MCB0byBwcm92aWRlCiAgICAgKiBzb21lIHNwYWNl\nIGZvciBhbnkgYW50LXJlbGF0ZWQgY2hhcmFjdGVycyBvbiB0aGUgbGVmdCBv\nZiBhCiAgICAgKiBzdGFuZGFyZCA4MC1jaGFyYWN0ZXIgZGlzcGxheS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJldHR5UHJpbnRMaW5lTGVuZ3Ro\nKGludCBsZW5ndGgpIHsKICAgICAgICBfcHJldHR5UHJpbnRMaW5lTGVuZ3Ro\nID0gbGVuZ3RoOwogICAgICAgIGlmIChfZm9ybWF0dGVyICE9IG51bGwpCiAg\nICAgICAgICAgIF9mb3JtYXR0ZXIuc2V0TGluZUxlbmd0aChsZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjc2V0UHJldHR5UHJpbnRMaW5l\nTGVuZ3RoCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UHJldHR5UHJpbnRM\naW5lTGVuZ3RoKCkgewogICAgICAgIHJldHVybiBfcHJldHR5UHJpbnRMaW5l\nTGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB0cmFj\nayBwYXJhbWV0ZXJzIGZvciB0aGUgcHVycG9zZXMgb2YgcmVwb3J0aW5nIGV4\nY2VwdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRyYWNrUGFy\nYW1ldGVycyhib29sZWFuIHRyYWNrUGFyYW1ldGVycykgewogICAgICAgIF90\ncmFja1BhcmFtZXRlcnMgPSB0cmFja1BhcmFtZXRlcnM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIHRyYWNrIHBhcmFtZXRlcnMgZm9yIHRo\nZSBwdXJwb3NlcyBvZiByZXBvcnRpbmcgZXhjZXB0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gZ2V0VHJhY2tQYXJhbWV0ZXJzKCkgewogICAg\nICAgIHJldHVybiBfdHJhY2tQYXJhbWV0ZXJzOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hhdCB0byBkbyB3aXRoIFNRTCB3YXJuaW5ncy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0V2FybmluZ0FjdGlvbihTdHJpbmcgd2Fybmlu\nZ0FjdGlvbikgewogICAgICAgIGludCBpbmRleCA9IEFycmF5cy5hc0xpc3Qo\nV0FSTklOR19BQ1RJT05TKS5pbmRleE9mKHdhcm5pbmdBY3Rpb24pOwogICAg\nICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgIGluZGV4ID0gV0FSTl9J\nR05PUkU7CiAgICAgICAgX3dhcm5pbmdBY3Rpb24gPSBpbmRleDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoYXQgdG8gZG8gd2l0aCBTUUwgd2FybmluZ3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0V2FybmluZ0FjdGlvbigp\nIHsKICAgICAgICByZXR1cm4gV0FSTklOR19BQ1RJT05TW193YXJuaW5nQWN0\naW9uXTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoYXQgdG8gZG8gd2l0aCBT\nUUwgd2FybmluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFdhcm5p\nbmdIYW5kbGVyKFNRTFdhcm5pbmdIYW5kbGVyIHdhcm5pbmdIYW5kbGVyKSB7\nCiAgICAgICAgX3dhcm5pbmdIYW5kbGVyID0gd2FybmluZ0hhbmRsZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGF0IHRvIGRvIHdpdGggU1FMIHdhcm5p\nbmdzLgogICAgICovCiAgICBwdWJsaWMgU1FMV2FybmluZ0hhbmRsZXIgZ2V0\nV2FybmluZ0hhbmRsZXIoKSB7CiAgICAgICAgcmV0dXJuIF93YXJuaW5nSGFu\nZGxlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBsb2cgdG8gd3JpdGUg\ndG8uCiAgICAgKi8KICAgIHB1YmxpYyBEYXRhU291cmNlTG9ncyBnZXRMb2dz\nKCkgewogICAgICAgIHJldHVybiBfbG9nczsKICAgIH0KCiAgICBwdWJsaWMg\nQ29ubmVjdGlvbiBkZWNvcmF0ZShDb25uZWN0aW9uIGNvbm4pIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBuZXdMb2dnaW5nQ29ubmVj\ndGlvbihjb25uKTsKICAgIH0KICAgICAgICAgCiAgICBwcml2YXRlIExvZ2dp\nbmdDb25uZWN0aW9uIG5ld0xvZ2dpbmdDb25uZWN0aW9uKENvbm5lY3Rpb24g\nY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShsb2dn\naW5nQ29ubmVjdGlvbkltcGwsIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9y\nLnRoaXMsIGNvbm4pOwogICAgfQoKICAgIHByaXZhdGUgU1FMRXhjZXB0aW9u\nIHdyYXAoU1FMRXhjZXB0aW9uIHNxbGUsIFN0YXRlbWVudCBzdG1udCkgewog\nICAgICAgIHJldHVybiB3cmFwKHNxbGUsIHN0bW50LCBudWxsLCAtMSk7CiAg\nICB9CgogICAgcHJpdmF0ZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRp\nb24gc3FsZSwgU3RyaW5nIHNxbCkgewogICAgICAgIHJldHVybiB3cmFwKHNx\nbGUsIG51bGwsIHNxbCwgLTEpOwogICAgfQogICAgCiAgICBwcml2YXRlIFNR\nTEV4Y2VwdGlvbiB3cmFwKFNRTEV4Y2VwdGlvbiBzcWxlLCBTdGF0ZW1lbnQg\nc3RtbnQsIFN0cmluZyBzcWwpIHsKICAgICAgICByZXR1cm4gd3JhcChzcWxl\nLCBzdG1udCwgc3FsLCAtMSk7CiAgICB9CgogICAgcHJpdmF0ZSBTUUxFeGNl\ncHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3FsZSwgU3RhdGVtZW50IHN0bW50\nLCBpbnQgaW5kZXhPZkZhaWxlZEJhdGNoT2JqZWN0KSB7CiAgICAgICAgcmV0\ndXJuIHdyYXAoc3FsZSwgc3RtbnQsIG51bGwsIC0xKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEluY2x1ZGUgU1FMIGluIGV4Y2VwdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3Fs\nZSwgU3RhdGVtZW50IHN0bW50LCBTdHJpbmcgc3FsLCBpbnQgaW5kZXhPZkZh\naWxlZEJhdGNoT2JqZWN0KSB7CiAgICAgICAgUmVwb3J0aW5nU1FMRXhjZXB0\naW9uIHRvUmV0dXJuID0gbnVsbDsKCiAgICAgICAgaWYgKHNxbGUgaW5zdGFu\nY2VvZiBSZXBvcnRpbmdTUUxFeGNlcHRpb24pIHsKICAgICAgICAgICAgdG9S\nZXR1cm4gPSAoUmVwb3J0aW5nU1FMRXhjZXB0aW9uKSBzcWxlOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHRvUmV0dXJuID0gbmV3IFJlcG9ydGlu\nZ1NRTEV4Y2VwdGlvbihzcWxlLCBzdG1udCwgc3FsKTsKICAgICAgICB9Cgog\nICAgICAgIHRvUmV0dXJuLnNldEluZGV4T2ZGaXJzdEZhaWxlZE9iamVjdChp\nbmRleE9mRmFpbGVkQmF0Y2hPYmplY3QpOwogICAgICAgIHJldHVybiB0b1Jl\ndHVybjsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVyZmFjZSB0aGF0IGFs\nbG93cyBjdXN0b21pemF0aW9uIG9mIHdoYXQgdG8gZG8gd2hlbgogICAgICog\ne0BsaW5rIFNRTFdhcm5pbmd9cyBvY2N1ci4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBpbnRlcmZhY2UgU1FMV2FybmluZ0hhbmRsZXIgewoKICAgICAg\nICBwdWJsaWMgdm9pZCBoYW5kbGVXYXJuaW5nKFNRTFdhcm5pbmcgd2Fybmlu\nZykgdGhyb3dzIFNRTEV4Y2VwdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAq\nIExvZ2dpbmcgY29ubmVjdGlvbi4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IGNsYXNzIExvZ2dpbmdDb25uZWN0aW9uIGV4dGVuZHMgRGVsZWdh\ndGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBwdWJsaWMgTG9nZ2luZ0Nvbm5l\nY3Rpb24oQ29ubmVjdGlvbiBjb25uKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChT\ndHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0g\nbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50ID0gc3VwZXIucHJlcGFyZVN0YXRlbWVudChz\ncWwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXdMb2dnaW5n\nUHJlcGFyZWRTdGF0ZW1lbnQoc3RtbnQsIHNxbCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgZXJy\nID0gd3JhcChzZSwgc3FsKTsKICAgICAgICAgICAgICAgIHRocm93IGVycjsK\nICAgICAgICAgICAgfSAgZmluYWxseSB7CiAgICAgICAgICAgICAgICBoYW5k\nbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0\nZW1lbnQoU3RyaW5nIHNxbCwgaW50IHJzVHlwZSwKICAgICAgICAgICAgaW50\nIHJzQ29uY3VyLCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50ID0gc3VwZXIucHJlcGFyZVN0YXRlbWVudAogICAgICAgICAgICAg\nICAgICAgIChzcWwsIHJzVHlwZSwgcnNDb25jdXIsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXdMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQo\nc3RtbnQsIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICAgICAgZXJyID0gIHdyYXAoc2UsIHNxbCk7\nCiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0\nYXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFwKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9\nIG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBTdGF0\nZW1lbnQgc3RtbnQgPSBzdXBlci5jcmVhdGVTdGF0ZW1lbnQoZmFsc2UpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdTdGF0ZW1lbnQoc3Rt\nbnQpOwogICAgICAgICAgICB9Y2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAgICAgICB0aHJv\ndyBzZTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIGhhbmRsZVNRTEVycm9ycyhlcnIpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVu\ndChpbnQgdHlwZSwgaW50IGNvbmN1cnJlbmN5LAogICAgICAgICAgICBib29s\nZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBT\nUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIFN0YXRlbWVudCBzdG1udCA9IHN1cGVyLmNyZWF0ZVN0\nYXRlbWVudCh0eXBlLCBjb25jdXJyZW5jeSwgCiAgICAgICAgICAgICAgICAg\nICAgZmFsc2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdT\ndGF0ZW1lbnQoc3RtbnQpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGVyciA9IHNlOwogICAgICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBwcm90ZWN0ZWQgQ2Fs\nbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoU3RyaW5nIHNxbCwgYm9vbGVh\nbiB3cmFwKSAKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgQ2FsbGFibGVTdGF0ZW1lbnQgc3Rt\ndCA9IHN1cGVyLnByZXBhcmVDYWxsKHNxbCwgd3JhcCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3TG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50KHN0bXQs\nIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwgc3FsKTsKICAgICAg\nICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhlcnIpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIExvZ2dpbmdQcmVw\nYXJlZFN0YXRlbWVudCBuZXdMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQKICAg\nICAgICAgICAgKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBTdHJpbmcgc3Fs\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIENv\nbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UobG9nZ2luZ1ByZXBh\ncmVkU3RhdGVtZW50SW1wbCwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcywgc3Rt\nbnQsIHNxbCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHByaXZhdGUg\nQ2FsbGFibGVTdGF0ZW1lbnQgbmV3TG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50\nKENhbGxhYmxlU3RhdGVtZW50IHN0bW50LCBTdHJpbmcgc3FsKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xh\nc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UobG9nZ2luZ0NhbGxhYmxlU3RhdGVt\nZW50SW1wbCwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcywgc3RtbnQsIHNxbCk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHByaXZhdGUgTG9nZ2luZ1N0\nYXRlbWVudCBuZXdMb2dnaW5nU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkK\nICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGxv\nZ2dpbmdTdGF0ZW1lbnRJbXBsLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzLCBz\ndG1udCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHByaXZhdGUgTG9n\nZ2luZ0RhdGFiYXNlTWV0YURhdGEgbmV3TG9nZ2luZ0RhdGFiYXNlTWV0YURh\ndGEKICAgICAgICAgICAgKERhdGFiYXNlTWV0YURhdGEgbWV0YSkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNs\nYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGxvZ2dpbmdEYXRhYmFzZU1ldGFE\nYXRhSW1wbCwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcywgbWV0YSk7CiAgICAg\nICAgfQoKCgogICAgICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgIFNRTEV4Y2VwdGlv\nbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgc3VwZXIuY29tbWl0KCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgZXJy\nID0gc2U7CiAgICAgICAgICAgICAgICB0aHJvdyBzZTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygi\nY29tbWl0Iiwgc3RhcnQsIHRoaXMpOwogICAgICAgICAgICAgICAgaGFuZGxl\nU1FMRXJyb3JzKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRp\nbWVNaWxsaXMoKTsKICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51\nbGw7ICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBzdXBlci5yb2xsYmFjaygpOwogICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGVyciA9IHNlOwog\nICAgICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoInJvbGxiYWNr\nIiwgc3RhcnQsIHRoaXMpOwogICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJy\nb3JzKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMo\nKTsgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBz\ndXBlci5jbG9zZSgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJjbG9zZSIsIHN0YXJ0LCB0aGlz\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNh\ndmVwb2ludCBzZXRTYXZlcG9pbnQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpOwogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsg\nICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBlci5zZXRTYXZlcG9pbnQoKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICBlcnIg\nPSBzZTsKICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJz\nYXZlcG9pbnQiLCBzdGFydCwgdGhpcyk7CiAgICAgICAgICAgICAgICBoYW5k\nbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIFNhdmVwb2ludCBzZXRTYXZlcG9pbnQoU3RyaW5nIG5h\nbWUpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIHN0\nYXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAg\nIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnNldFNh\ndmVwb2ludChuYW1lKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSBzZTsKICAgICAgICAg\nICAgICAgIHRocm93IHNlOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJzYXZlcG9pbnQ6ICIgKyBu\nYW1lLCBzdGFydCwgdGhpcyk7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxF\ncnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgcm9sbGJhY2soU2F2ZXBvaW50IHNhdmVwb2ludCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgU1FMRXhj\nZXB0aW9uIGVyciA9IG51bGw7ICAgICAgICAgICAgCiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBzdXBlci5yb2xsYmFjayhzYXZlcG9pbnQp\nOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgICAgIGVyciA9IHNlOwogICAgICAgICAgICAgICAgdGhyb3cg\nc2U7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBp\nZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgU3RyaW5nIG5hbWUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBzYXZlcG9pbnQu\nZ2V0U2F2ZXBvaW50TmFtZSgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzcWUpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgbmFtZSA9IFN0cmluZy52YWx1ZU9mKHNhdmVwb2ludC5nZXRTYXZlcG9p\nbnRJZCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgX2xvZ3MubG9nSkRCQygicm9sbGJhY2s6ICIgKyBuYW1lLCBzdGFy\ndCwgdGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBo\nYW5kbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgcmVsZWFzZVNhdmVwb2ludChTYXZlcG9p\nbnQgc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAg\nICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN1cGVyLnJl\nbGVhc2VTYXZlcG9pbnQoc2F2ZXBvaW50KTsKICAgICAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSBz\nZTsKICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBuYW1lID0gbnVs\nbDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICBuYW1lID0gc2F2ZXBvaW50LmdldFNhdmVwb2ludE5hbWUoKTsK\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3Fl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBTdHJpbmcudmFs\ndWVPZihzYXZlcG9pbnQuZ2V0U2F2ZXBvaW50SWQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMo\nInJlbGVhc2U6ICIgKyBuYW1lLCBzdGFydCwgdGhpcyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0\nYXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoaW50IHJlc3VsdFNldFR5cGUsCiAg\nICAgICAgICAgIGludCByZXN1bHRTZXRDb25jdXJyZW5jeSwgaW50IHJlc3Vs\ndFNldEhvbGRhYmlsaXR5LCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBTUUxFeGNlcHRpb24g\nZXJyID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIFN0YXRlbWVudCBzdG1udCA9IHN1cGVyLmNyZWF0ZVN0YXRlbWVudChyZXN1\nbHRTZXRUeXBlLAogICAgICAgICAgICAgICAgICAgIHJlc3VsdFNldENvbmN1\ncnJlbmN5LCByZXN1bHRTZXRIb2xkYWJpbGl0eSwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdTdGF0ZW1lbnQoc3RtbnQpOwog\nICAgICAgICAgICB9Y2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAgICAgICB0aHJvdyBzZTsK\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGhhbmRs\nZVNRTEVycm9ycyhlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRl\nbWVudChTdHJpbmcgc3FsLAogICAgICAgICAgICBpbnQgcmVzdWx0U2V0VHlw\nZSwgaW50IHJlc3VsdFNldENvbmN1cnJlbmN5LAogICAgICAgICAgICBpbnQg\ncmVzdWx0U2V0SG9sZGFiaWxpdHksIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBu\ndWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAg\nICAgICAgICAgICAgICAgICAgKHNxbCwgcmVzdWx0U2V0VHlwZSwgcmVzdWx0\nU2V0Q29uY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Vs\ndFNldEhvbGRhYmlsaXR5LCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3TG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwog\nICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgICAgIGVyciA9IHdyYXAoc2UsIHNxbCk7CiAgICAgICAgICAgICAg\nICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50\nIHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwKICAgICAgICAgICAgaW50\nIGF1dG9HZW5lcmF0ZWRLZXlzLCBib29sZWFuIHdyYXApIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVs\nbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50ID0gc3VwZXIucHJlcGFyZVN0YXRlbWVudAogICAg\nICAgICAgICAgICAgICAgIChzcWwsIGF1dG9HZW5lcmF0ZWRLZXlzLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3TG9nZ2luZ1ByZXBhcmVk\nU3RhdGVtZW50KHN0bW50LCBzcWwpOwogICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGVyciA9IHdyYXAo\nc2UsIHNxbCk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJv\ncnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3Ry\naW5nIHNxbCwKICAgICAgICAgICAgaW50W10gY29sdW1uSW5kZXhlcywgYm9v\nbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHN1cGVy\nLnByZXBhcmVTdGF0ZW1lbnQKICAgICAgICAgICAgICAgICAgICAoc3FsLCBj\nb2x1bW5JbmRleGVzLCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3TG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwogICAg\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgICAgIGVyciA9IHdyYXAoc2UsIHNxbCk7CiAgICAgICAgICAgICAgICB0\naHJvdyBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHBy\nZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwKICAgICAgICAgICAgU3RyaW5n\nW10gY29sdW1uTmFtZXMsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAg\nICAgICAgICAgICAgKHNxbCwgY29sdW1uTmFtZXMsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXdMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQo\nc3RtbnQsIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwgc3FsKTsK\nICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhlcnIpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgRGF0\nYWJhc2VNZXRhRGF0YSBnZXRNZXRhRGF0YShib29sZWFuIHdyYXApCiAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1\ncm4gbmV3TG9nZ2luZ0RhdGFiYXNlTWV0YURhdGEoc3VwZXIuZ2V0TWV0YURh\ndGEoZmFsc2UpKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIExvZyB0aW1lIGVsYXBzZWQgc2luY2UgZ2l2ZW4gc3RhcnQuCiAgICAgICAg\nICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGxvZ1RpbWUobG9uZyBzdGFydFRp\nbWUpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoX2xv\nZ3MuaXNTUUxFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9ncy5sb2dT\nUUwoInNwZW50Iiwgc3RhcnRUaW1lLCB0aGlzKTsgCiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBMb2cgdGltZSBlbGFwc2VkIHNpbmNlIGdp\ndmVuIHN0YXJ0LgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBs\nb2dTUUwoU3RhdGVtZW50IHN0bW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgaWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZ3MubG9nU1FMKCJleGVjdXRpbmcgIiArIHN0bW50LCB0\naGlzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIExvZyB0\naW1lIGVsYXBzZWQgc2luY2UgZ2l2ZW4gc3RhcnQuCiAgICAgICAgICovCiAg\nICAgICAgcHJpdmF0ZSB2b2lkIGxvZ0JhdGNoU1FMKFN0YXRlbWVudCBzdG1u\ndCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfbG9n\ncy5pc1NRTEVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2dzLmxvZ1NR\nTCgiZXhlY3V0aW5nIGJhdGNoICIgKyBzdG1udCwgdGhpcyk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIEhhbmRsZSBhbnkg\ne0BsaW5rIFNRTFdhcm5pbmd9cyBvbiB0aGUgY3VycmVudCB7QGxpbmsgQ29u\nbmVjdGlvbn0uCiAgICAgICAgICogQ2hhaW4gdGhyb3dlZCBTUUxXYXJuaW5n\ncyB0byBTUUxFeGNlcHRpb24uCiAgICAgICAgICogQHNlZSAjaGFuZGxlU1FM\nV2FybmluZyhTUUxXYXJuaW5nKQogICAgICAgICAqLwogICAgICAgIHByaXZh\ndGUgdm9pZCBoYW5kbGVTUUxFcnJvcnMoU1FMRXhjZXB0aW9uIGVycikgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfd2FybmluZ0Fj\ndGlvbiA9PSBXQVJOX0lHTk9SRSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxX\nYXJuaW5nKGdldFdhcm5pbmdzKCkpOwogICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gd2FybmluZykgewogICAgICAgICAgICAgICAgaWYgKGVy\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGVyci5zZXROZXh0RXhj\nZXB0aW9uKHdhcm5pbmcpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHRocm93IHdhcm5pbmc7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBjbGVhcldhcm5pbmdzKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEhh\nbmRsZSBhbnkge0BsaW5rIFNRTFdhcm5pbmd9cyBvbiB0aGUgc3BlY2lmaWVk\nIHtAbGluayBTdGF0ZW1lbnR9LgogICAgICAgICAqIENoYWluIHRocm93ZWQg\nU1FMV2FybmluZ3MgdG8gU1FMRXhjZXB0aW9uLgogICAgICAgICAqCiAgICAg\nICAgICogQHNlZSAjaGFuZGxlU1FMV2FybmluZyhTUUxXYXJuaW5nKQogICAg\nICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBoYW5kbGVTUUxFcnJvcnMo\nU3RhdGVtZW50IHN0bW50LCBTUUxFeGNlcHRpb24gZXJyKSAKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfd2Fy\nbmluZ0FjdGlvbiA9PSBXQVJOX0lHTk9SRSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsgCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhzdG1udC5nZXRXYXJuaW5ncygp\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHdhcm5pbmcp\nIHsKICAgICAgICAgICAgICAgIGlmIChlcnIgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBlcnIuc2V0TmV4dEV4Y2VwdGlvbih3YXJuaW5nKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0aHJvdyB3\nYXJuaW5nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgc3RtbnQuY2xlYXJXYXJuaW5ncygpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSAgICAgICAgCiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICog\nSGFuZGxlIGFueSB7QGxpbmsgU1FMV2FybmluZ31zIG9uIHRoZSBzcGVjaWZp\nZWQge0BsaW5rIFJlc3VsdFNldH0uCiAgICAgICAgICogQ2hhaW4gdGhyb3dl\nZCBTUUxXYXJuaW5ncyB0byBTUUxFeGNlcHRpb24uCiAgICAgICAgICogCiAg\nICAgICAgICogQHNlZSAjaGFuZGxlU1FMV2FybmluZyhTUUxXYXJuaW5nKQog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBoYW5kbGVTUUxFcnJv\ncnMoUmVzdWx0U2V0IHJzLCBTUUxFeGNlcHRpb24gZXJyKSAKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfd2Fy\nbmluZ0FjdGlvbiA9PSBXQVJOX0lHTk9SRSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKHJzLmdldFdhcm5pbmdzKCkpOwog\nICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gd2FybmluZyl7CiAg\nICAgICAgICAgICAgICBpZiAoZXJyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgZXJyLnNldE5leHRFeGNlcHRpb24od2FybmluZyk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgd2Fybmlu\nZzsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHJz\nLmNsZWFyV2FybmluZ3MoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBIYW5kbGUgdGhlIHNwZWNp\nZmllZCB7QGxpbmsgU1FMV2FybmluZ30gZGVwZW5kaW5nIG9uIHRoZQogICAg\nICAgICAqIHNldHRpbmcgb2YgdGhlIHtAbGluayAjc2V0V2FybmluZ0FjdGlv\nbn0gYXR0cmlidXRlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHdh\ncm5pbmcgdGhlIHdhcm5pbmcgdG8gaGFuZGxlCiAgICAgICAgICovCiAgICAg\nICAgcHJpdmF0ZSB2b2lkIGhhbmRsZVNRTFdhcm5pbmcoU1FMV2FybmluZyB3\nYXJuaW5nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYg\nKHdhcm5pbmcgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgaWYgKF93YXJuaW5nQWN0aW9uID09IFdBUk5fSUdOT1JFKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgTG9nIGxvZyA9\nIF9sb2dzLmdldEpEQkNMb2coKTsKICAgICAgICAgICAgZm9yICg7IHdhcm5p\nbmcgIT0gbnVsbDsgd2FybmluZyA9IHdhcm5pbmcuZ2V0TmV4dFdhcm5pbmco\nKSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfd2FybmluZ0FjdGlvbikg\newogICAgICAgICAgICAgICAgICAgIGNhc2UgV0FSTl9MT0dfVFJBQ0U6CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSh3YXJu\naW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgY2FzZSBXQVJOX0xPR19JTkZPOgogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKHdhcm5pbmcpOwogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBj\nYXNlIFdBUk5fTE9HX1dBUk46CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLndhcm4od2FybmluZyk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgV0FSTl9MT0df\nRVJST1I6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNFcnJv\nckVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5l\ncnJvcih3YXJuaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBXQVJOX1RIUk9XOgogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBqdXN0IHRocm93IGl0IGFzIGlmIGl0IHdl\ncmUgYSBTUUxFeGNlcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgd2FybmluZzsKICAgICAgICAgICAgICAgICAgICBjYXNlIFdBUk5fSEFO\nRExFOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3dhcm5pbmdIYW5k\nbGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfd2Fy\nbmluZ0hhbmRsZXIuaGFuZGxlV2FybmluZyh3YXJuaW5nKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlCiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBNZXRhZGF0YSB3cmFwcGVyIHRoYXQgbG9ncyBhY3Rpb25zLgogICAgICAg\nICAqLwogICAgICAgIHByb3RlY3RlZCBhYnN0cmFjdCBjbGFzcyBMb2dnaW5n\nRGF0YWJhc2VNZXRhRGF0YQogICAgICAgICAgICBleHRlbmRzIERlbGVnYXRp\nbmdEYXRhYmFzZU1ldGFEYXRhIHsKCiAgICAgICAgICAgIHB1YmxpYyBMb2dn\naW5nRGF0YWJhc2VNZXRhRGF0YShEYXRhYmFzZU1ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICAgICAgICAgIHN1cGVyKG1ldGEsIExvZ2dpbmdDb25uZWN0aW9u\nLnRoaXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVz\ndWx0U2V0IGdldEJlc3RSb3dJZGVudGlmaWVyKFN0cmluZyBjYXRhbG9nLAog\nICAgICAgICAgICAgICAgU3RyaW5nIHNjaGVtYSwgU3RyaW5nIHRhYmxlLCBp\nbnQgc2NvcGUsIGJvb2xlYW4gbnVsbGFibGUpCiAgICAgICAgICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9n\ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3Mu\nbG9nSkRCQygiZ2V0QmVzdFJvd0lkZW50aWZpZXI6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYSArICIsICIg\nKyB0YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5l\nY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0\nQmVzdFJvd0lkZW50aWZpZXIoY2F0YWxvZywgc2NoZW1hLAogICAgICAgICAg\nICAgICAgICAgIHRhYmxlLCBzY29wZSwgbnVsbGFibGUpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldENhdGFsb2dz\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2dzLmxvZ0pEQkMoImdldENhdGFsb2dzIiwgTG9nZ2luZ0Nvbm5lY3Rpb24u\ndGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q2F0YWxv\nZ3MoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3Vs\ndFNldCBnZXRDb2x1bW5Qcml2aWxlZ2VzKFN0cmluZyBjYXRhbG9nLCBTdHJp\nbmcgc2NoZW1hLAogICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxlLCBTdHJp\nbmcgY29sdW1uTmFtZVBhdHRlcm4pIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRDb2x1bW5Qcml2\naWxlZ2VzOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyAr\nICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAg\nICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmdldENvbHVtblByaXZpbGVnZXMoY2F0YWxv\nZywgc2NoZW1hLAogICAgICAgICAgICAgICAgICAgIHRhYmxlLCBjb2x1bW5O\nYW1lUGF0dGVybik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBSZXN1bHRTZXQgZ2V0Q29sdW1ucyhTdHJpbmcgY2F0YWxvZywgU3RyaW5n\nIHNjaGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGVO\nYW1lUGF0dGVybiwgU3RyaW5nIGNvbHVtbk5hbWVQYXR0ZXJuKQogICAgICAg\nICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIF9sb2dzLmxvZ0pEQkMoImdldENvbHVtbnM6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYVBhdHRlcm4g\nKyAiLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgdGFibGVOYW1lUGF0\ndGVybiArICIsICIgKyBjb2x1bW5OYW1lUGF0dGVybiwKICAgICAgICAgICAg\nICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q29sdW1ucyhjYXRhbG9nLCBzY2hl\nbWFQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAgIHRhYmxlTmFtZVBhdHRl\ncm4sIGNvbHVtbk5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRDcm9zc1JlZmVyZW5jZShTdHJp\nbmcgcHJpbWFyeUNhdGFsb2csCiAgICAgICAgICAgICAgICBTdHJpbmcgcHJp\nbWFyeVNjaGVtYSwgU3RyaW5nIHByaW1hcnlUYWJsZSwKICAgICAgICAgICAg\nICAgIFN0cmluZyBmb3JlaWduQ2F0YWxvZywgU3RyaW5nIGZvcmVpZ25TY2hl\nbWEsCiAgICAgICAgICAgICAgICBTdHJpbmcgZm9yZWlnblRhYmxlKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5p\nc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9n\nSkRCQygiZ2V0Q3Jvc3NSZWZlcmVuY2U6ICIKICAgICAgICAgICAgICAgICAg\nICAgICAgKyBwcmltYXJ5Q2F0YWxvZyArICIsICIgKyBwcmltYXJ5U2NoZW1h\nICsgIiwgIgogICAgICAgICAgICAgICAgICAgICAgICArIHByaW1hcnlUYWJs\nZSArICIsICIgKyBmb3JlaWduQ2F0YWxvZyArICIsICIKICAgICAgICAgICAg\nICAgICAgICAgICAgKyBmb3JlaWduU2NoZW1hICsgIiwgIiArIGZvcmVpZ25T\nY2hlbWEsCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0\naW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENy\nb3NzUmVmZXJlbmNlKHByaW1hcnlDYXRhbG9nLCBwcmltYXJ5U2NoZW1hLAog\nICAgICAgICAgICAgICAgICAgIHByaW1hcnlUYWJsZSwgZm9yZWlnbkNhdGFs\nb2csIGZvcmVpZ25TY2hlbWEsIGZvcmVpZ25UYWJsZSk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0RXhwb3J0ZWRL\nZXlzKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hLAogICAgICAgICAg\nICAgICAgU3RyaW5nIHRhYmxlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0RXhwb3J0ZWRLZXlz\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIg\nKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAg\nICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldEV4cG9ydGVkS2V5cyhjYXRhbG9nLCBzY2hlbWEs\nIHRhYmxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJl\nc3VsdFNldCBnZXRJbXBvcnRlZEtleXMoU3RyaW5nIGNhdGFsb2csIFN0cmlu\nZyBzY2hlbWEsCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGUpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlz\nSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dK\nREJDKCJnZXRJbXBvcnRlZEtleXM6ICIKICAgICAgICAgICAgICAgICAgICAg\nICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYSArICIsICIgKyB0YWJsZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhp\ncyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0SW1wb3J0ZWRL\nZXlzKGNhdGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldEluZGV4SW5mbyhTdHJp\nbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYSwKICAgICAgICAgICAgICAgIFN0\ncmluZyB0YWJsZSwgYm9vbGVhbiB1bmlxdWUsIGJvb2xlYW4gYXBwcm94aW1h\ndGUpCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0SW5kZXhJbmZvOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBz\nY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAg\nIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmdldEluZGV4SW5mbyhjYXRhbG9nLCBzY2hlbWEsIHRhYmxl\nLCB1bmlxdWUsCiAgICAgICAgICAgICAgICAgICAgYXBwcm94aW1hdGUpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdl\ndFByaW1hcnlLZXlzKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hLAog\nICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxlKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0UHJp\nbWFyeUtleXM6ICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBjYXRhbG9n\nICsgIiwgIiArIHNjaGVtYSArICIsICIgKyB0YWJsZSwKICAgICAgICAgICAg\nICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJpbWFyeUtleXMoY2F0YWxvZywg\nc2NoZW1hLCB0YWJsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBSZXN1bHRTZXQgZ2V0UHJvY2VkdXJlQ29sdW1ucyhTdHJpbmcgY2F0\nYWxvZywKICAgICAgICAgICAgICAgIFN0cmluZyBzY2hlbWFQYXR0ZXJuLCBT\ndHJpbmcgcHJvY2VkdXJlTmFtZVBhdHRlcm4sCiAgICAgICAgICAgICAgICBT\ndHJpbmcgY29sdW1uTmFtZVBhdHRlcm4pIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRQcm9jZWR1\ncmVDb2x1bW5zOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxv\nZyArICIsICIgKyBzY2hlbWFQYXR0ZXJuICsgIiwgIgogICAgICAgICAgICAg\nICAgICAgICAgICArIHByb2NlZHVyZU5hbWVQYXR0ZXJuICsgIiwgIiArIGNv\nbHVtbk5hbWVQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAgICAgICBMb2dn\naW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5nZXRQcm9jZWR1cmVDb2x1bW5zKGNhdGFsb2csIHNjaGVtYVBhdHRl\ncm4sCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFtZVBhdHRlcm4s\nIGNvbHVtbk5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIFJlc3VsdFNldCBnZXRQcm9jZWR1cmVzKFN0cmluZyBjYXRh\nbG9nLAogICAgICAgICAgICAgICAgU3RyaW5nIHNjaGVtYVBhdHRlcm4sIFN0\ncmluZyBwcm9jZWR1cmVOYW1lUGF0dGVybikKICAgICAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dz\nLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5s\nb2dKREJDKCJnZXRQcm9jZWR1cmVzOiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWFQYXR0ZXJuICsgIiwgIgog\nICAgICAgICAgICAgICAgICAgICAgICArIHByb2NlZHVyZU5hbWVQYXR0ZXJu\nLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5nZXRQcm9jZWR1cmVzKGNhdGFsb2csIHNjaGVtYVBhdHRl\ncm4sCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFtZVBhdHRlcm4p\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0\nIGdldFNjaGVtYXMoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0U2NoZW1hcyIsIExvZ2dpbmdD\nb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLmdldFNjaGVtYXMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIFJlc3VsdFNldCBnZXRUYWJsZVByaXZpbGVnZXMoU3RyaW5nIGNhdGFs\nb2csCiAgICAgICAgICAgICAgICBTdHJpbmcgc2NoZW1hUGF0dGVybiwgU3Ry\naW5nIHRhYmxlTmFtZVBhdHRlcm4pCiAgICAgICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pE\nQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRC\nQygiZ2V0VGFibGVQcml2aWxlZ2VzIiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhp\ncyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGFibGVQcml2\naWxlZ2VzKGNhdGFsb2csIHNjaGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAg\nICAgICAgdGFibGVOYW1lUGF0dGVybik7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VGFibGVzKFN0cmluZyBjYXRh\nbG9nLCBTdHJpbmcgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAgICAgIFN0\ncmluZyB0YWJsZU5hbWVQYXR0ZXJuLCBTdHJpbmdbXSB0eXBlcykgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNK\nREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pE\nQkMoImdldFRhYmxlczogIgogICAgICAgICAgICAgICAgICAgICAgICArIGNh\ndGFsb2cgKyAiLCAiICsgc2NoZW1hUGF0dGVybiArICIsICIKICAgICAgICAg\nICAgICAgICAgICAgICAgKyB0YWJsZU5hbWVQYXR0ZXJuLCBMb2dnaW5nQ29u\nbmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5n\nZXRUYWJsZXMoY2F0YWxvZywgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAg\nICAgICAgICB0YWJsZU5hbWVQYXR0ZXJuLCB0eXBlcyk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VGFibGVUeXBl\ncygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYg\nKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBf\nbG9ncy5sb2dKREJDKCJnZXRUYWJsZVR5cGVzIiwgTG9nZ2luZ0Nvbm5lY3Rp\nb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGFi\nbGVUeXBlcygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nUmVzdWx0U2V0IGdldFR5cGVJbmZvKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldFR5cGVJbmZv\nIiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gc3VwZXIuZ2V0VHlwZUluZm8oKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRVRFRzKFN0cmluZyBjYXRh\nbG9nLCBTdHJpbmcgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAgICAgIFN0\ncmluZyB0eXBlTmFtZVBhdHRlcm4sIGludFtdIHR5cGVzKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygi\nZ2V0VURUcyIsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmdldFVEVHMoY2F0YWxvZywgc2NoZW1hUGF0\ndGVybiwKICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZVBhdHRlcm4sIHR5\ncGVzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3Vs\ndFNldCBnZXRWZXJzaW9uQ29sdW1ucyhTdHJpbmcgY2F0YWxvZywKICAgICAg\nICAgICAgICAgIFN0cmluZyBzY2hlbWEsIFN0cmluZyB0YWJsZSkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNK\nREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pE\nQkMoImdldFZlcnNpb25Db2x1bW5zOiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUs\nCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRo\naXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFZlcnNpb25D\nb2x1bW5zKGNhdGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTdGF0ZW1lbnQg\nd3JhcHBlciB0aGF0IGxvZ3MgU1FMIHRvIHRoZSBwYXJlbnQgZGF0YSBzb3Vy\nY2UgYW5kCiAgICAgICAgICogcmVtZW1iZXJzIHRoZSBsYXN0IHBpZWNlIG9m\nIFNRTCB0byBiZSBleGVjdXRlZCBvbiBpdC4KICAgICAgICAgKi8KICAgICAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3QgY2xhc3MgTG9nZ2luZ1N0YXRlbWVudCBl\neHRlbmRzIERlbGVnYXRpbmdTdGF0ZW1lbnQgewoKICAgICAgICAgICAgcHJp\ndmF0ZSBTdHJpbmcgX3NxbCA9IG51bGw7CgogICAgICAgICAgICBwdWJsaWMg\nTG9nZ2luZ1N0YXRlbWVudChTdGF0ZW1lbnQgc3RtbnQpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgc3VwZXIoc3RtbnQsIExvZ2dp\nbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwcml2YXRlIExvZ2dpbmdSZXN1bHRTZXQgbmV3TG9nZ2luZ1Jlc3VsdFNl\ndChSZXN1bHRTZXQgcnMsIFN0YXRlbWVudCBzdG1udCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFu\nY2UobG9nZ2luZ1Jlc3VsdFNldEltcGwsIExvZ2dpbmdDb25uZWN0aW9uLnRo\naXMsIHJzLCBzdG1udCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIGFwcGVuZEluZm8oU3RyaW5nQnVmZmVyIGJ1ZikgewogICAg\nICAgICAgICAgICAgaWYgKF9zcWwgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiAiKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoX2Zvcm1hdHRlciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoU0VQKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZChfZm9ybWF0dGVyLnByZXR0eVByaW50KF9zcWwpKTsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKF9zcWwpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHJvdGVjdGVkIFJlc3VsdFNldCB3cmFwUmVzdWx0KFJlc3VsdFNldCBycywg\nYm9vbGVhbiB3cmFwKSB7CiAgICAgICAgICAgICAgICBpZiAoIXdyYXAgfHwg\ncnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nd3JhcFJlc3VsdChycywgd3JhcCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3TG9nZ2luZ1Jlc3VsdFNldChycywgdGhpcyk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNhbmNlbCgpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJj\nYW5jZWwgIiArIHRoaXMsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAg\nICAgICAgICAgICAgc3VwZXIuY2FuY2VsKCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KFN0\ncmluZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgX3NxbCA9IHNxbDsK\nICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAg\nICAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuZXhlY3V0ZVF1ZXJ5KHNxbCwgd3JhcCk7CiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsgICAgICAgICAgICAgICAJCiAg\nICAgICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwgTG9nZ2luZ1N0YXRl\nbWVudC50aGlzLCBzcWwpOwogICAgICAgICAgICAgICAgICAgIHRocm93IGVy\ncjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAgaGFu\nZGxlU1FMRXJyb3JzKExvZ2dpbmdTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgX3NxbCA9IHNxbDsKICAgICAg\nICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcg\nc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAg\nICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhl\nY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7ICAgICAgICAgICAgICAgIAkKICAgICAgICAgICAg\nICAgICAgICBlcnIgPSB3cmFwKHNlLCBMb2dnaW5nU3RhdGVtZW50LnRoaXMs\nIHNxbCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dU\naW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJv\ncnMoTG9nZ2luZ1N0YXRlbWVudC50aGlzLCBlcnIpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBleGVjdXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgX3NxbCA9IHNxbDsKICAgICAgICAgICAgICAgIGxv\nZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIFNRTEV4\nY2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZShzcWwpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwgTG9nZ2luZ1N0YXRl\nbWVudC50aGlzLCBzcWwpOwogICAgICAgICAgICAgICAgICAgIHRocm93IGVy\ncjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAgaGFu\nZGxlU1FMRXJyb3JzKExvZ2dpbmdTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIGFic3RyYWN0IGNsYXNzIExvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudAogICAgICAgICAgICBleHRlbmRzIERlbGVnYXRpbmdQcmVwYXJl\nZFN0YXRlbWVudCB7CgogICAgICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmlu\nZyBfc3FsOwogICAgICAgICAgICBwcml2YXRlIExpc3Q8U3RyaW5nPiBfcGFy\nYW1zID0gbnVsbDsKICAgICAgICAgICAgcHJpdmF0ZSBMaXN0PExpc3Q8U3Ry\naW5nPj4gX3BhcmFtQmF0Y2ggPSBudWxsOwogICAgICAgICAgICAvLyBXaGVu\nIGJhdGNoaW5nIGlzIHVzZWQsIHRoaXMgdmFyaWFibGUgY29udGFpbnMgdGhl\nIGluZGV4IGludG8gdGhlCiAgICAgICAgICAgIC8vIGxhc3Qgc3VjY2Vzc2Z1\nbGx5IGV4ZWN1dGVkIGJhdGNoZWQgc3RhdGVtZW50LgogICAgICAgICAgICBp\nbnQgYmF0Y2hlZFJvd3NCYXNlSW5kZXggPSAwOwoKICAgICAgICAgICAgcHVi\nbGljIExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudChQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgU3RyaW5nIHNxbCkKICAgICAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc3VwZXIoc3RtbnQsIExv\nZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgX3NxbCA9\nIHNxbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBMb2dn\naW5nUmVzdWx0U2V0IG5ld0xvZ2dpbmdSZXN1bHRTZXQoUmVzdWx0U2V0IHJz\nLAogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9y\nLgogICAgICAgICAgICAgICAgICAgIG5ld0luc3RhbmNlKGxvZ2dpbmdSZXN1\nbHRTZXRJbXBsLAogICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0\naW9uLmNsYXNzLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzLAogICAgICAgICAg\nICAgICAgICAgIFJlc3VsdFNldC5jbGFzcywgcnMsCiAgICAgICAgICAgICAg\nICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIHN0bW50KTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHJvdGVjdGVkIFJlc3VsdFNldCB3cmFw\nUmVzdWx0KFJlc3VsdFNldCBycywgYm9vbGVhbiB3cmFwKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIXdyYXAgfHwgcnMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIud3JhcFJlc3VsdChycywgd3JhcCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3TG9nZ2luZ1Jlc3VsdFNldChycywg\ndGhpcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBS\nZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gd3Jh\ncCkKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAgICAgICAgICAgbG9u\nZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAg\nICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5l\neGVjdXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIGVy\nciA9IHdyYXAoc2UsIExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzLCBz\ncWwpOwogICAgICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGlt\nZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0\nZXJzKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9y\ncyhMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAg\nICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5leGVjdXRlVXBkYXRlKHNxbCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nICAgICBlcnIgPSAgd3JhcChzZSwgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50\nLnRoaXMsIHNxbCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwog\nICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAg\nICBsb2dUaW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBjbGVhckxv\nZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxl\nU1FMRXJyb3JzKExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzLCBlcnIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBleGVjdXRlKFN0cmluZyBzcWwpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwog\nICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9\nIG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5leGVjdXRlKHNxbCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nICAgICBlcnIgPSB3cmFwKHNlLCBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQu\ndGhpcywgc3FsKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAg\nICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAg\nIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9n\nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVT\nUUxFcnJvcnMoTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMsIGVycik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KGJvb2xlYW4gd3Jh\ncCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dT\nUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNl\ncHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeSh3cmFw\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdQ\ncmVwYXJlZFN0YXRlbWVudC50aGlzLCBfc3FsKTsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAg\nICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1ByZXBhcmVkU3Rh\ndGVtZW50LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FM\nKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0\naW9uIGVyciA9IG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlVXBkYXRlKCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgICAgICAgICBlcnIgPSB3cmFwKHNlLCBMb2dnaW5nUHJlcGFy\nZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nZXJyOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBj\nbGVhckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\naGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlz\nLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgaW50W10gZXhlY3V0ZUJhdGNoKCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpbnQgaW5kZXhPZkZpcnN0\nRmFpbGVkT2JqZWN0ID0gLTE7CgogICAgICAgICAgICAgICAgbG9nQmF0Y2hT\nUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNl\ncHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgaW50W10gdG9SZXR1cm4gPSBzdXBlci5leGVjdXRl\nQmF0Y2goKTsKICAgICAgICAgICAgICAgICAgICAvL2V4ZWN1dGVCYXRjaCBp\ncyBjYWxsZWQgYW55IHRpbWUgdGhlIG51bWJlciBvZiBiYXRjaGVkIHN0YXRl\nbWVudHMKICAgICAgICAgICAgICAgICAgICAvL2lzIGVxdWFsIHRvLCBvciBs\nZXNzIHRoYW4sIGJhdGNoTGltaXQuICBJbiB0aGUgJ2NhdGNoJyBibG9jayBi\nZWxvdywKICAgICAgICAgICAgICAgICAgICAvL3RoZSBsb2dpYyBzZWVrcyB0\nbyBmaW5kIGFuIGluZGV4IGJhc2VkIG9uIHRoZSBjdXJyZW50IGV4ZWN1dGVC\nYXRjaAogICAgICAgICAgICAgICAgICAgIC8vcmVzdWx0cy4gIFRoaXMgaXMg\nZmluZSB3aGVuIGV4ZWN1dGVCYXRjaCBpcyBvbmx5IGNhbGxlZCBvbmNlLCBi\ndXQKICAgICAgICAgICAgICAgICAgICAvL2lmIGV4ZWN1dGVCYXRjaCBpcyBj\nYWxsZWQgbWFueSB0aW1lcywgdGhlIF9wYXJhbXNCYXRjaCB3aWxsIGNvbnRp\nbnVlCiAgICAgICAgICAgICAgICAgICAgLy90byBncm93LCBhcyBzdWNoLCB0\nbyBpbmRleCBpbnRvIF9wYXJhbXNCYXRjaCwgd2UgbmVlZCB0byB0YWtlIGlu\ndG8KICAgICAgICAgICAgICAgICAgICAvL2FjY291bnQgdGhlIG51bWJlciBv\nZiB0aW1lcyBleGVjdXRlQmF0Y2ggaXMgY2FsbGVkIGluIG9yIGRlciB0bwog\nICAgICAgICAgICAgICAgICAgIC8vY29ycmVjdGx5IGluZGV4IGludG8gX3Bh\ncmFtc0JhdGNoLiAgVG8gdGhhdCBlbmQsIGVhY2ggdGltZSBleGVjdXRlQmF0\nY2gKICAgICAgICAgICAgICAgICAgICAvL2lzIGNhbGxlZCwgbGV0cyBnZXQg\ndGhlIHNpemUgb2YgX3BhcmFtQmF0Y2guICBUaGlzIHdpbGwgZWZmZWN0aXZl\nbHkKICAgICAgICAgICAgICAgICAgICAvL3RlbGwgdXMgdGhlIGluZGV4IG9m\nIHRoZSBsYXN0IHN1Y2Nlc3NmdWxseSBleGVjdXRlZCBiYXRjaCBzdGF0ZW1l\nbnQuCiAgICAgICAgICAgICAgICAgICAgLy9JZiBhbiBleGNlcHRpb24gaXMg\nY2F1c2VkLCB0aGVuIHdlIGtub3cgdGhhdCBfcGFyYW1CYXRjaC5zaXplIHdh\ncwogICAgICAgICAgICAgICAgICAgIC8vdGhlIGluZGV4IG9mIHRoZSBMQVNU\nIHJvdyB0byBzdWNjZXNzZnVsbHkgZXhlY3V0ZS4KICAgICAgICAgICAgICAg\nICAgICBpZiAoX3BhcmFtQmF0Y2ggIT0gbnVsbCl7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJhdGNoZWRSb3dzQmFzZUluZGV4ID0gX3BhcmFtQmF0Y2gu\nc2l6ZSgpOyAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gdG9SZXR1cm47CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBpZiB0aGUgZXhjZXB0aW9uIGlzIGEgQmF0Y2hVcGRhdGVF\neGNlcHRpb24sIGFuZAogICAgICAgICAgICAgICAgICAgIC8vIHdlIGFyZSB0\ncmFja2luZyBwYXJhbWV0ZXJzLCB0aGVuIHNldCB0aGUgY3VycmVudAogICAg\nICAgICAgICAgICAgICAgIC8vIHBhcmFtZXRlciBzZXQgdG8gYmUgdGhlIGlu\nZGV4IG9mIHRoZSBmYWlsZWQKICAgICAgICAgICAgICAgICAgICAvLyBzdGF0\nZW1lbnQgc28gdGhhdCB0aGUgUmVwb3J0aW5nU1FMRXhjZXB0aW9uIHdpbGwK\nICAgICAgICAgICAgICAgICAgICAvLyBzaG93IHRoZSBjb3JyZWN0IHBhcmFt\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlIGluc3RhbmNlb2YgQmF0Y2hV\ncGRhdGVFeGNlcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgJiYgX3Bh\ncmFtQmF0Y2ggIT0gbnVsbCAmJiBzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBpbnRbXSBjb3VudCA9ICgoQmF0\nY2hVcGRhdGVFeGNlcHRpb24pIHNlKS4KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGdldFVwZGF0ZUNvdW50cygpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoY291bnQgIT0gbnVsbCAmJiBjb3VudC5sZW5ndGggPD0gX3Bh\ncmFtQmF0Y2guc2l6ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvdW50Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gLTMgaXMgU3RhdGVtZW50LlNUQVRFTUVOVF9GQUlMRUQs\nIGJ1dCBpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9u\nbHkgYXZhaWxhYmxlIGluIEpESyAxLjQrCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGNvdW50W2ldID09IFN0YXRlbWVudC5FWEVDVVRF\nX0ZBSUxFRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpbmRleE9mRmlyc3RGYWlsZWRPYmplY3QgPSBpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gLTMgZWxl\nbWVudDogaXQgbWF5IGJlIHRoYXQgdGhlIHNlcnZlciBzdG9wcGVkCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBwcm9jZXNzaW5nLCBzbyB0aGUg\nc2l6ZSBvZiB0aGUgY291bnQgd2lsbCBiZQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gdGhlIGluZGV4CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvL1NlZSB0aGUgSmF2YWRvYyBmb3IgJ2dldFVwZGF0ZUNvdW50cyc7\nIGEgcHJvdmlkZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWF5\nIHN0b3AgcHJvY2Vzc2luZyB3aGVuIHRoZSBmaXJzdCBmYWlsdXJlIG9jY3Vy\ncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYXMgc3VjaCwgaXQg\nbWF5IG9ubHkgcmV0dXJuICdVcGRhdGVDb3VudHMnIGZvciB0aGUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vZmlyc3QgZmV3IHdoaWNoIHBhc3Mu\nICBBcyBzdWNoLCB0aGUgZmFpbGVkCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvL2luZGV4IGlzICdjb3VudC5sZW5ndGgnLCBOT1QgY291bnQubGVu\nZ3RoKzEuICBUaGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lz\nLCBpZiB0aGUgcHJvdmlkZXIgT05MWSByZXR1cm5zIHRoZSBmaXJzdCBmZXcg\ndGhhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9wYXNzZXMgKGku\nZS4gc2F5IGFuIGFycmF5IG9mIFsxLDFdIGlzIHJldHVybmVkKSB0aGVuCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvL2xlbmd0aCBpcyAyLCBhbmQg\nc2luY2UgX3BhcmFtQmF0Y2ggc3RhcnRzIGF0IDAsIHdlCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvL2Rvbid0IHdhbnQgdG8gdXNlIGxlbmd0aCsx\nIGFzIHRoYXQgd2lsbCBnaXZlIHVzIHRoZQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy93cm9uZyBpbmRleC4KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChpbmRleE9mRmlyc3RGYWlsZWRPYmplY3QgPT0gLTEpewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4T2ZGaXJzdEZh\naWxlZE9iamVjdCA9IGNvdW50Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0Zp\nbmFsbHksIHdoYXRldmVyIHRoZSBpbmRleCBpcyBhdCB0aGlzIHBvaW50LCBh\nZGQgYmF0Y2hlZFJvd3NCYXNlSW5kZXgKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vdG8gaXQgdG8gZ2V0IHRoZSBmaW5hbCBpbmRleC4gIFJlY2Fs\nbCwgd2UgbmVlZCB0byBzdGFydCBvdXIgaW5kZXggZnJvbSB0aGUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vbGFzdCBiYXRjaCB3aGljaCBzdWNj\nZXNzZnVsbHkgZXhlY3V0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpbmRleE9mRmlyc3RGYWlsZWRPYmplY3QgKz0gYmF0Y2hlZFJvd3NCYXNl\nSW5kZXg7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRo\nZSBjdXJyZW50IHBhcmFtcyB0byB0aGUgc2F2ZWQgdmFsdWVzCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhPZkZpcnN0RmFpbGVkT2Jq\nZWN0IDwgX3BhcmFtQmF0Y2guc2l6ZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9wYXJhbXMgPSAoTGlzdCkgX3BhcmFtQmF0Y2guZ2V0\nKGluZGV4T2ZGaXJzdEZhaWxlZE9iamVjdCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgZXJyID0gd3JhcChzZSwgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50\nLnRoaXMsIGluZGV4T2ZGaXJzdEZhaWxlZE9iamVjdCk7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAg\nICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdQcmVwYXJl\nZFN0YXRlbWVudC50aGlzLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBleGVjdXRl\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dT\nUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNl\ncHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGUoKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICAgICAgICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7\nCiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\nICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFy\nTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5k\nbGVTUUxFcnJvcnMoTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMsIGVy\ncik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIGNhbmNlbCgpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJjYW5jZWwgIiAr\nIHRoaXMgKyAiOiAiICsgX3NxbCwKICAgICAgICAgICAgICAgICAgICAgICAg\nTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CgogICAgICAgICAgICAgICAgc3Vw\nZXIuY2FuY2VsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNldE51bGwoaW50IGkxLCBpbnQgaTIpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAi\nbnVsbCIsIG51bGwpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChp\nMSwgaTIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzZXRCb29sZWFuKGludCBpLCBib29sZWFuIGIpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIGIp\nOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0Qm9vbGVhbihpLCBiKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Qnl0ZShp\nbnQgaSwgYnl0ZSBiKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBiKTsKICAgICAgICAgICAgICAg\nIHN1cGVyLnNldEJ5dGUoaSwgYik7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHNldFNob3J0KGludCBpLCBzaG9ydCBzKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpLCBzKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFNob3J0KGks\nIHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBz\nZXRJbnQoaW50IGkxLCBpbnQgaTIpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCBpMik7CiAgICAg\nICAgICAgICAgICBzdXBlci5zZXRJbnQoaTEsIGkyKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0TG9uZyhpbnQgaSwgbG9u\nZyBsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpLCBsKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNl\ndExvbmcoaSwgbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNldEZsb2F0KGludCBpLCBmbG9hdCBmKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBm\nKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldEZsb2F0KGksIGYpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXREb3VibGUo\naW50IGksIGRvdWJsZSBkKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBkKTsKICAgICAgICAgICAg\nICAgIHN1cGVyLnNldERvdWJsZShpLCBkKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChpbnQgaSwgQmln\nRGVjaW1hbCBiZCkKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJCaWdE\nZWNpbWFsIiwgYmQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0QmlnRGVj\naW1hbChpLCBiZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNldFN0cmluZyhpbnQgaSwgU3RyaW5nIHMpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGks\nICJTdHJpbmciLCBzKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFN0cmlu\nZyhpLCBzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZv\naWQgc2V0Qnl0ZXMoaW50IGksIGJ5dGVbXSBiKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiYnl0\nZVtdIiwgYik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRCeXRlcyhpLCBi\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0\nRGF0ZShpbnQgaSwgRGF0ZSBkKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiRGF0ZSIsIGQpOwog\nICAgICAgICAgICAgICAgc3VwZXIuc2V0RGF0ZShpLCBkKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZShpbnQgaSwg\nVGltZSB0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZSIsIHQpOwogICAgICAgICAgICAg\nICAgc3VwZXIuc2V0VGltZShpLCB0KTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1wKGludCBpLCBUaW1lc3Rh\nbXAgdCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBz\nZXRMb2dQYXJhbWV0ZXIoaSwgIlRpbWVzdGFtcCIsIHQpOwogICAgICAgICAg\nICAgICAgc3VwZXIuc2V0VGltZXN0YW1wKGksIHQpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRBc2NpaVN0cmVhbShpbnQg\naTEsIElucHV0U3RyZWFtIGlzLCBpbnQgaTIpCiAgICAgICAgICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1Bh\ncmFtZXRlcihpMSwgIklucHV0U3RyZWFtIiwgaXMpOwogICAgICAgICAgICAg\nICAgc3VwZXIuc2V0QXNjaWlTdHJlYW0oaTEsIGlzLCBpMik7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIEBEZXByZWNhdGVkCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNldFVuaWNvZGVTdHJlYW0oaW50IGkxLCBJbnB1dFN0cmVh\nbSBpcywgaW50IGkyKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJJ\nbnB1dFN0cmVhbSIsIGlzKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFVu\naWNvZGVTdHJlYW0oaTIsIGlzLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHNldEJpbmFyeVN0cmVhbShpbnQgaTEsIElu\ncHV0U3RyZWFtIGlzLCBpbnQgaTIpCiAgICAgICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRl\ncihpMSwgIklucHV0U3RyZWFtIiwgaXMpOwogICAgICAgICAgICAgICAgc3Vw\nZXIuc2V0QmluYXJ5U3RyZWFtKGkxLCBpcywgaTIpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBjbGVhclBhcmFtZXRlcnMoKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNsZWFyTG9n\nUGFyYW1ldGVycyhmYWxzZSk7CiAgICAgICAgICAgICAgICBzdXBlci5jbGVh\nclBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0T2JqZWN0KGludCBpMSwgT2JqZWN0IG8sIGludCBpMiwg\naW50IGkzKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJPYmplY3Qi\nLCBvKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldE9iamVjdChpMSwgbywg\naTIsIGkzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZv\naWQgc2V0T2JqZWN0KGludCBpMSwgT2JqZWN0IG8sIGludCBpMikKICAgICAg\nICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAiT2JqZWN0Iiwgbyk7CiAgICAgICAg\nICAgICAgICBzdXBlci5zZXRPYmplY3QoaTEsIG8sIGkyKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0T2JqZWN0KGludCBp\nLCBPYmplY3QgbykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIk9iamVjdCIsIG8pOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0T2JqZWN0KGksIG8pOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBhZGRCYXRjaCgpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzU1FM\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ1NRTCgi\nYmF0Y2hpbmcgIiArIHRoaXMsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwog\nICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBzdXBlci5hZGRCYXRjaCgpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgb3VyIGxpc3QgaXMgaW5pdGlhbGl6\nZWQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbUJhdGNoID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyYW1CYXRj\naCA9IG5ldyBBcnJheUxpc3Q8TGlzdDxTdHJpbmc+PigpOwogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBjb3B5IHBhcmFtZXRlcnMgc2luY2UgdGhleSB3\naWxsIGJlIHJlLXVzZWQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9w\nYXJhbXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nTGlzdDxTdHJpbmc+IGNvcHlQYXJtcyA9CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG5ldyBBcnJheUxpc3Q8U3RyaW5nPihfcGFyYW1z\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmFk\nZChjb3B5UGFybXMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIF9wYXJhbUJhdGNoLmFkZChudWxsKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKGludCBpMSwgUmVhZGVyIHIs\nIGludCBpMikKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAiUmVhZGVy\nIiwgcik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRDaGFyYWN0ZXJTdHJl\nYW0oaTEsIHIsIGkyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0UmVmKGludCBpLCBSZWYgcikgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIlJl\nZiIsIHIpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0UmVmKGksIHIpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRCbG9i\nKGludCBpLCBCbG9iIGIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJCbG9iIiwgYik7CiAgICAg\nICAgICAgICAgICBzdXBlci5zZXRCbG9iKGksIGIpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRDbG9iKGludCBpLCBDbG9i\nIGMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGksICJDbG9iIiwgYyk7CiAgICAgICAgICAgICAgICBz\ndXBlci5zZXRDbG9iKGksIGMpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXRBcnJheShpbnQgaSwgQXJyYXkgYSkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0\nZXIoaSwgIkFycmF5IiwgYSk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRB\ncnJheShpLCBhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIFJlc3VsdFNldE1ldGFEYXRhIGdldE1ldGFEYXRhKCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0TWV0\nYURhdGEoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZv\naWQgc2V0RGF0ZShpbnQgaSwgRGF0ZSBkLCBDYWxlbmRhciBjKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRl\ncihpLCAiRGF0ZSIsIGQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0RGF0\nZShpLCBkLCBjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgc2V0VGltZShpbnQgaSwgVGltZSB0LCBDYWxlbmRhciBjKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpLCAiVGltZSIsIHQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0\nVGltZShpLCB0LCBjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0VGltZXN0YW1wKGludCBpLCBUaW1lc3RhbXAgdCwgQ2Fs\nZW5kYXIgYykKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJUaW1lc3Rh\nbXAiLCB0KTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFRpbWVzdGFtcChp\nLCB0LCBjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZv\naWQgc2V0TnVsbChpbnQgaTEsIGludCBpMiwgU3RyaW5nIHMpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGkxLCAibnVsbCIsIG51bGwpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0\nTnVsbChpMSwgaTIsIHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ncm90ZWN0ZWQgdm9pZCBhcHBlbmRJbmZvKFN0cmluZ0J1ZmZlciBidWYpIHsK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKTsKICAgICAgICAgICAg\nICAgIGlmIChfZm9ybWF0dGVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKFNFUCk7CiAgICAgICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChfZm9ybWF0dGVyLnByZXR0eVByaW50KF9zcWwpKTsKICAgICAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKFNFUCk7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX3Nx\nbCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgU3RyaW5n\nQnVpbGRlciBwYXJhbUJ1ZiA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAo\nX3BhcmFtcyAhPSBudWxsICYmICFfcGFyYW1zLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgICAgIHBhcmFtQnVmID0gbmV3IFN0cmluZ0J1aWxkZXIo\nKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPFN0cmluZz4g\naXRyID0gX3BhcmFtcy5pdGVyYXRvcigpOyBpdHIKICAgICAgICAgICAgICAg\nICAgICAgICAgLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgcGFyYW1CdWYuYXBwZW5kKGl0ci5uZXh0KCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHBhcmFtQnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgaWYgKHBhcmFtQnVmICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoIV9wcmV0dHlQcmludCkKICAgICAgICAgICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiICIpOwogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIltwYXJhbXM9IikuCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVu\nZChwYXJhbUJ1Zi50b1N0cmluZygpKS5hcHBlbmQoIl0iKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHN1cGVyLmFwcGVuZEluZm8oYnVm\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIGNs\nZWFyTG9nUGFyYW1ldGVycyhib29sZWFuIGJhdGNoKSB7CiAgICAgICAgICAg\nICAgICAvL01hZGUgIWJhdGNoLi4ud2Ugb25seSB3YW50IHRvIGNsZWFyIGlm\nCiAgICAgICAgICAgICAgICAvL3dlIGFyZSBOT1QgdXNpbmcgYmF0Y2hpbmcu\nICBJZiB3ZSBjbGVhciBub3csCiAgICAgICAgICAgICAgICAvL3RoZSBfcGFy\nYW1zIHdpbGwgbm90IGJlIGRpc3BsYXllZCBpbiB0aGUgcmVzdWx0YW50CiAg\nICAgICAgICAgICAgICAvL2V4Y2VwdGlvbiBtZXNzYWdlLiAgQnV0IHdoZW4g\nc2hvdWxkIHdlICdjbGVhcicgdGhlbT8/PwogICAgICAgICAgICAgICAgaWYg\nKCFiYXRjaCl7ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAg\nICAgICBpZiAoX3BhcmFtcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBfcGFyYW1zLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgCiAg\nICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbUJhdGNoICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmNsZWFyKCk7ICAg\nICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwcml2YXRlIGJvb2xlYW4gc2hvdWxkVHJhY2tQYXJh\nbWV0ZXJzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90cmFja1BhcmFt\nZXRlcnMgfHwgX2xvZ3MuaXNTUUxFbmFibGVkKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50\nIGluZGV4LCBib29sZWFuIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNo\nb3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpbmRleCwgIihib29sZWFuKSAiICsgdmFsKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1Bh\ncmFtZXRlcihpbnQgaW5kZXgsIGJ5dGUgdmFsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAiKGJ5dGUpICIgKyB2YWwp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0\nTG9nUGFyYW1ldGVyKGludCBpbmRleCwgZG91YmxlIHZhbCkgewogICAgICAg\nICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIihkb3VibGUp\nICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRl\nIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwgZmxvYXQgdmFsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkp\nCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAi\nKGZsb2F0KSAiICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGludCB2\nYWwpIHsKICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRl\ncnMoKSkKICAgICAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5k\nZXgsICIoaW50KSAiICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGxv\nbmcgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJh\nbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGluZGV4LCAiKGxvbmcpICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRl\neCwgc2hvcnQgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJh\nY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFy\nYW1ldGVyKGluZGV4LCAiKHNob3J0KSAiICsgdmFsKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihp\nbnQgaW5kZXgsIFN0cmluZyB0eXBlLCBPYmplY3QgdmFsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAg\nICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAiKCIgKyB0eXBl\nICsgIikgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBy\naXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBTdHJpbmcg\ndmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoX3BhcmFtcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9wYXJhbXMgPSBuZXcgQXJyYXlMaXN0PFN0\ncmluZz4oKTsKICAgICAgICAgICAgICAgIHdoaWxlIChfcGFyYW1zLnNpemUo\nKSA8IGluZGV4KQogICAgICAgICAgICAgICAgICAgIF9wYXJhbXMuYWRkKG51\nbGwpOwogICAgICAgICAgICAgICAgaWYgKHZhbC5sZW5ndGgoKSA+IDgwKQog\nICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5zdWJzdHJpbmcoMCwgNzcp\nICsgIi4uLiI7CiAgICAgICAgICAgICAgICBfcGFyYW1zLnNldChpbmRleCAt\nIDEsIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIFdhcm5pbmctaGFuZGxpbmcgcmVzdWx0IHNldC4KICAg\nICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgY2xhc3MgTG9n\nZ2luZ1Jlc3VsdFNldCBleHRlbmRzIERlbGVnYXRpbmdSZXN1bHRTZXQgewoK\nICAgICAgICAgICAgcHVibGljIExvZ2dpbmdSZXN1bHRTZXQoUmVzdWx0U2V0\nIHJzLCBTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICAgICAgICAgIHN1cGVy\nKHJzLCBzdG1udCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBib29sZWFuIG5leHQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dn\naW5nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBTUUxFeGNl\ncHRpb24gZXJyID0gbnVsbDsgICAgICAgICAgICAJCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgICAgICAgICBlcnIgPSBzZTsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBzZTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdSZXN1bHRT\nZXQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgYmVmb3JlRmlyc3QoKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIFNRTEV4Y2VwdGlv\nbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAkKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgc3VwZXIuYmVmb3JlRmlyc3QoKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgICAgIGVyciA9IHNlOwogICAgICAgICAgICAgICAg\nICAgIHRocm93IHNlOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1Jlc3Vs\ndFNldC50aGlzLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBhZnRlckxhc3QoKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIFNRTEV4Y2VwdGlv\nbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAkKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgc3VwZXIuYWZ0ZXJMYXN0KCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgICAgICAgICBlcnIgPSBzZTsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBzZTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdSZXN1bHRT\nZXQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gZmlyc3QoKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBl\ncnIgPSBudWxsOyAgICAgICAgICAgIAkKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmZpcnN0KCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgICAgICAgICBlcnIgPSBzZTsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBzZTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdSZXN1bHRT\nZXQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gbGFzdCgpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVy\nciA9IG51bGw7ICAgICAgICAgICAgCQogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIubGFzdCgpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgc2U7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nUmVzdWx0U2V0\nLnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFic29sdXRlKGludCBhKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIFNRTEV4Y2Vw\ndGlvbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAkKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmFic29s\ndXRlKGEpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dn\naW5nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIHJlbGF0\naXZlKGludCBhKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAkKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLnJlbGF0aXZlKGEpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0g\nc2U7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNR\nTEVycm9ycyhMb2dnaW5nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIHByZXZpb3VzKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAg\nICAJCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBlci5wcmV2aW91cygpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAg\nZXJyID0gc2U7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAg\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGhh\nbmRsZVNRTEVycm9ycyhMb2dnaW5nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsbGFibGVTdGF0ZW1lbnQg\nZGVjb3JhdGVkIHdpdGggbG9nZ2luZy4KICAgICAgICAgKiBTaW1pbGFyIHRv\nIHtAbGluayBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnR9IGJ1dCBjYW4gbm90\nIGJlIGV4dGVuZGVkCiAgICAgICAgICogZHVlIHRvIHRoZSBleGlzdGluZyBk\nZWxlZ2F0aW9uIGhpZXJhcmNoeS4KICAgICAgICAgKi8KICAgICAgICBwcm90\nZWN0ZWQgYWJzdHJhY3QgY2xhc3MgTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50\nIGV4dGVuZHMgCiAgICAgICAgICAgIERlbGVnYXRpbmdDYWxsYWJsZVN0YXRl\nbWVudCB7CiAgICAgICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9zcWw7\nCiAgICAgICAgICAgIHByaXZhdGUgTGlzdDxTdHJpbmc+IF9wYXJhbXMgPSBu\ndWxsOwogICAgICAgICAgICBwcml2YXRlIExpc3Q8TGlzdDxTdHJpbmc+PiBf\ncGFyYW1CYXRjaCA9IG51bGw7CgogICAgICAgICAgICBwdWJsaWMgTG9nZ2lu\nZ0NhbGxhYmxlU3RhdGVtZW50KENhbGxhYmxlU3RhdGVtZW50IHN0bXQsIFN0\ncmluZyBzcWwpIAogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgCQlzdXBlcihzdG10LCBMb2dnaW5nQ29ubmVjdGlvbi50\naGlzKTsKICAgICAgICAJCV9zcWwgPSBzcWw7CiAgICAgICAgCX0KICAgICAg\nICAJCiAgICAgICAgICAgIHByaXZhdGUgTG9nZ2luZ1Jlc3VsdFNldCBuZXdM\nb2dnaW5nUmVzdWx0U2V0KFJlc3VsdFNldCBycywKICAgICAgICAgICAgICAg\nIENhbGxhYmxlU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci4KICAgICAgICAgICAgICAg\nICAgICBuZXdJbnN0YW5jZShsb2dnaW5nUmVzdWx0U2V0SW1wbCwKICAgICAg\nICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi5jbGFzcywgTG9nZ2lu\nZ0Nvbm5lY3Rpb24udGhpcywKICAgICAgICAgICAgICAgICAgICBSZXN1bHRT\nZXQuY2xhc3MsIHJzLAogICAgICAgICAgICAgICAgICAgIENhbGxhYmxlU3Rh\ndGVtZW50LmNsYXNzLCBzdG1udCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgCiAgICAgICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgd3JhcFJlc3Vs\ndChSZXN1bHRTZXQgcnMsIGJvb2xlYW4gd3JhcCkgewogICAgICAgICAgICAg\nICAgaWYgKCF3cmFwIHx8IHJzID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLndyYXBSZXN1bHQod3JhcCwgcnMpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdSZXN1bHRTZXQocnMsIHRoaXMp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0\nU2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAg\nICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3Rh\ncnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAg\nICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0\nZVF1ZXJ5KHNxbCwgd3JhcCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICBlcnIgPSB3\ncmFwKHNlLCBMb2dnaW5nQ2FsbGFibGVTdGF0ZW1lbnQudGhpcywgc3FsKTsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3Rh\ncnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9n\nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMsIGVycik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBpbnQg\nZXhlY3V0ZVVwZGF0ZShTdHJpbmcgc3FsKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAg\nICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsK\nICAgICAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAg\nZXJyID0gd3JhcChzZSwgTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMs\nIHNxbCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dU\naW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFt\nZXRlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJy\nb3JzKExvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudC50aGlzLCBlcnIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgYm9vbGVhbiBleGVjdXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAg\nICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5leGVjdXRlKHNxbCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICBl\ncnIgPSB3cmFwKHNlLCBMb2dnaW5nQ2FsbGFibGVTdGF0ZW1lbnQudGhpcywg\nc3FsKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1Rp\nbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1l\ndGVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJv\ncnMoTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMsIGVycik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3Rl\nY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KGJvb2xlYW4gd3JhcCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhp\ncyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJl\nbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24g\nZXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeSh3cmFwKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICAgICAgICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdDYWxsYWJs\nZVN0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBl\ncnI7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNs\nZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBo\nYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMs\nIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAg\nICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51\nbGw7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZSgp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwgTG9nZ2luZ0Nh\nbGxhYmxlU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgICAgIHRo\ncm93IGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAg\nICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwogICAgICAgICAgICAgICAg\nICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nQ2FsbGFibGVTdGF0ZW1lbnQu\ndGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIGludFtdIGV4ZWN1dGVCYXRjaCgpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nQmF0Y2hTUUwo\ndGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNlcHRp\nb24gZXJyID0gbnVsbDsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVj\ndXRlQmF0Y2goKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBleGNl\ncHRpb24gaXMgYSBCYXRjaFVwZGF0ZUV4Y2VwdGlvbiwgYW5kCiAgICAgICAg\nICAgICAgICAgICAgLy8gd2UgYXJlIHRyYWNraW5nIHBhcmFtZXRlcnMsIHRo\nZW4gc2V0IHRoZSBjdXJyZW50CiAgICAgICAgICAgICAgICAgICAgLy8gcGFy\nYW1ldGVyIHNldCB0byBiZSB0aGUgaW5kZXggb2YgdGhlIGZhaWxlZAogICAg\nICAgICAgICAgICAgICAgIC8vIHN0YXRlbWVudCBzbyB0aGF0IHRoZSBSZXBv\ncnRpbmdTUUxFeGNlcHRpb24gd2lsbAogICAgICAgICAgICAgICAgICAgIC8v\nIHNob3cgdGhlIGNvcnJlY3QgcGFyYW0KICAgICAgICAgICAgICAgICAgICBp\nZiAoc2UgaW5zdGFuY2VvZiBCYXRjaFVwZGF0ZUV4Y2VwdGlvbgogICAgICAg\nICAgICAgICAgICAgICAgICAmJiBfcGFyYW1CYXRjaCAhPSBudWxsICYmIHNo\nb3VsZFRyYWNrUGFyYW1ldGVycygpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGludFtdIGNvdW50ID0gKChCYXRjaFVwZGF0ZUV4Y2VwdGlvbikgc2Up\nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0VXBkYXRlQ291bnRz\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCAhPSBudWxs\nICYmIGNvdW50Lmxlbmd0aCA8PSBfcGFyYW1CYXRjaC5zaXplKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGludCBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudC5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0zIGlzIFN0YXRl\nbWVudC5TVEFURU1FTlRfRkFJTEVELCBidXQgaXMKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBvbmx5IGF2YWlsYWJsZSBpbiBKREsgMS40\nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudFtp\nXSA9PSBTdGF0ZW1lbnQuRVhFQ1VURV9GQUlMRUQpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gLTMg\nZWxlbWVudDogaXQgbWF5IGJlIHRoYXQgdGhlIHNlcnZlciBzdG9wcGVkCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwcm9jZXNzaW5nLCBzbyB0\naGUgc2l6ZSBvZiB0aGUgY291bnQgd2lsbCBiZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gdGhlIGluZGV4CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoaW5kZXggPT0gLTEpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaW5kZXggPSBjb3VudC5sZW5ndGggKyAxOwoKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgY3VycmVudCBwYXJh\nbXMgdG8gdGhlIHNhdmVkIHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGluZGV4IDwgX3BhcmFtQmF0Y2guc2l6ZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbXMgPSAoTGlzdDxTdHJp\nbmc+KSBfcGFyYW1CYXRjaC5nZXQoaW5kZXgpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdDYWxsYWJsZVN0YXRlbWVu\ndC50aGlzKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAg\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxv\nZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFy\nYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxF\ncnJvcnMoTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMsIGVycik7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGV4ZWN1dGUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAg\nICAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOyAgICAgICAg\nICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGUoKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAg\nICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudC50\naGlzKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1Rp\nbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1l\ndGVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJv\ncnMoTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMsIGVycik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGNhbmNlbCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJjYW5jZWwgIiArIHRoaXMgKyAi\nOiAiICsgX3NxbCwKICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nv\nbm5lY3Rpb24udGhpcyk7CgogICAgICAgICAgICAgICAgc3VwZXIuY2FuY2Vs\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndE51bGwoaW50IGkxLCBpbnQgaTIpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAibnVsbCIsIG51\nbGwpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChpMSwgaTIpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRCb29s\nZWFuKGludCBpLCBib29sZWFuIGIpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIGIpOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0Qm9vbGVhbihpLCBiKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Qnl0ZShpbnQgaSwgYnl0\nZSBiKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpLCBiKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNl\ndEJ5dGUoaSwgYik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNldFNob3J0KGludCBpLCBzaG9ydCBzKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBz\nKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFNob3J0KGksIHMpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRJbnQoaW50\nIGkxLCBpbnQgaTIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCBpMik7CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXRJbnQoaTEsIGkyKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2V0TG9uZyhpbnQgaSwgbG9uZyBsKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpLCBsKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldExvbmcoaSwg\nbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndEZsb2F0KGludCBpLCBmbG9hdCBmKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBmKTsKICAgICAg\nICAgICAgICAgIHN1cGVyLnNldEZsb2F0KGksIGYpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXREb3VibGUoaW50IGksIGRv\ndWJsZSBkKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIHNldExvZ1BhcmFtZXRlcihpLCBkKTsKICAgICAgICAgICAgICAgIHN1cGVy\nLnNldERvdWJsZShpLCBkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChpbnQgaSwgQmlnRGVjaW1hbCBi\nZCkKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJCaWdEZWNpbWFsIiwg\nYmQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0QmlnRGVjaW1hbChpLCBi\nZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndFN0cmluZyhpbnQgaSwgU3RyaW5nIHMpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJTdHJpbmci\nLCBzKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFN0cmluZyhpLCBzKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Qnl0\nZXMoaW50IGksIGJ5dGVbXSBiKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiYnl0ZVtdIiwgYik7\nCiAgICAgICAgICAgICAgICBzdXBlci5zZXRCeXRlcyhpLCBiKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0RGF0ZShpbnQg\naSwgRGF0ZSBkKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpLCAiRGF0ZSIsIGQpOwogICAgICAgICAg\nICAgICAgc3VwZXIuc2V0RGF0ZShpLCBkKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZShpbnQgaSwgVGltZSB0KSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1Bh\ncmFtZXRlcihpLCAiVGltZSIsIHQpOwogICAgICAgICAgICAgICAgc3VwZXIu\nc2V0VGltZShpLCB0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0VGltZXN0YW1wKGludCBpLCBUaW1lc3RhbXAgdCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJh\nbWV0ZXIoaSwgIlRpbWVzdGFtcCIsIHQpOwogICAgICAgICAgICAgICAgc3Vw\nZXIuc2V0VGltZXN0YW1wKGksIHQpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzZXRBc2NpaVN0cmVhbShpbnQgaTEsIElucHV0\nU3RyZWFtIGlzLCBpbnQgaTIpCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihp\nMSwgIklucHV0U3RyZWFtIiwgaXMpOwogICAgICAgICAgICAgICAgc3VwZXIu\nc2V0QXNjaWlTdHJlYW0oaTEsIGlzLCBpMik7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIEBEZXByZWNhdGVkCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHNldFVuaWNvZGVTdHJlYW0oaW50IGkxLCBJbnB1dFN0cmVhbSBpcywgaW50\nIGkyKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJJbnB1dFN0cmVh\nbSIsIGlzKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFVuaWNvZGVTdHJl\nYW0oaTIsIGlzLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNldEJpbmFyeVN0cmVhbShpbnQgaTEsIElucHV0U3RyZWFt\nIGlzLCBpbnQgaTIpCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIklu\ncHV0U3RyZWFtIiwgaXMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0Qmlu\nYXJ5U3RyZWFtKGkxLCBpcywgaTIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBjbGVhclBhcmFtZXRlcnMoKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVy\ncyhmYWxzZSk7CiAgICAgICAgICAgICAgICBzdXBlci5jbGVhclBhcmFtZXRl\ncnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2V0T2JqZWN0KGludCBpMSwgT2JqZWN0IG8sIGludCBpMiwgaW50IGkzKQog\nICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJPYmplY3QiLCBvKTsKICAg\nICAgICAgICAgICAgIHN1cGVyLnNldE9iamVjdChpMSwgbywgaTIsIGkzKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0T2Jq\nZWN0KGludCBpMSwgT2JqZWN0IG8sIGludCBpMikKICAgICAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGkxLCAiT2JqZWN0Iiwgbyk7CiAgICAgICAgICAgICAgICBz\ndXBlci5zZXRPYmplY3QoaTEsIG8sIGkyKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0T2JqZWN0KGludCBpLCBPYmplY3Qg\nbykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRM\nb2dQYXJhbWV0ZXIoaSwgIk9iamVjdCIsIG8pOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0T2JqZWN0KGksIG8pOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBhZGRCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ1NRTCgiYmF0Y2hpbmcg\nIiArIHRoaXMsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAg\nICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBz\ndXBlci5hZGRCYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChzaG91\nbGRUcmFja1BhcmFtZXRlcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgb3VyIGxpc3QgaXMgaW5pdGlhbGl6ZWQKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbUJhdGNoID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyYW1CYXRjaCA9IG5ldyBB\ncnJheUxpc3Q8TGlzdDxTdHJpbmc+PigpOwogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBjb3B5IHBhcmFtZXRlcnMgc2luY2UgdGhleSB3aWxsIGJlIHJl\nLXVzZWQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbXMgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxTdHJp\nbmc+IGNvcHlQYXJhbXMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBBcnJheUxpc3Q8U3RyaW5nPihfcGFyYW1zKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmFkZChjb3B5UGFyYW1z\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFy\nYW1CYXRjaC5hZGQobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndENoYXJhY3RlclN0cmVhbShpbnQgaTEsIFJlYWRlciByLCBpbnQgaTIpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIlJlYWRlciIsIHIpOwogICAg\nICAgICAgICAgICAgc3VwZXIuc2V0Q2hhcmFjdGVyU3RyZWFtKGkxLCByLCBp\nMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndFJlZihpbnQgaSwgUmVmIHIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJSZWYiLCByKTsKICAg\nICAgICAgICAgICAgIHN1cGVyLnNldFJlZihpLCByKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0QmxvYihpbnQgaSwgQmxv\nYiBiKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpLCAiQmxvYiIsIGIpOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0QmxvYihpLCBiKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIHZvaWQgc2V0Q2xvYihpbnQgaSwgQ2xvYiBjKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRl\ncihpLCAiQ2xvYiIsIGMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0Q2xv\nYihpLCBjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZv\naWQgc2V0QXJyYXkoaW50IGksIEFycmF5IGEpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJBcnJh\neSIsIGEpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0QXJyYXkoaSwgYSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXRN\nZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldE1ldGFEYXRhKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldERhdGUo\naW50IGksIERhdGUgZCwgQ2FsZW5kYXIgYykgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIkRhdGUi\nLCBkKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldERhdGUoaSwgZCwgYyk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldFRp\nbWUoaW50IGksIFRpbWUgdCwgQ2FsZW5kYXIgYykgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIlRp\nbWUiLCB0KTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFRpbWUoaSwgdCwg\nYyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndFRpbWVzdGFtcChpbnQgaSwgVGltZXN0YW1wIHQsIENhbGVuZGFyIGMpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZXN0YW1wIiwgdCk7CiAg\nICAgICAgICAgICAgICBzdXBlci5zZXRUaW1lc3RhbXAoaSwgdCwgYyk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldE51bGwo\naW50IGkxLCBpbnQgaTIsIFN0cmluZyBzKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIm51bGwi\nLCBudWxsKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldE51bGwoaTEsIGky\nLCBzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJvdGVjdGVkIHZv\naWQgYXBwZW5kSW5mbyhTdHJpbmdCdWZmZXIgYnVmKSB7CiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAgICBpZiAoX2Zv\ncm1hdHRlciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZChTRVApOwogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2Zv\ncm1hdHRlci5wcmV0dHlQcmludChfc3FsKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChTRVApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9zcWwpOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgcGFy\nYW1CdWYgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKF9wYXJhbXMgIT0g\nbnVsbCAmJiAhX3BhcmFtcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBwYXJhbUJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxTdHJpbmc+IGl0ciA9IF9wYXJh\nbXMuaXRlcmF0b3IoKTsgaXRyCiAgICAgICAgICAgICAgICAgICAgICAgIC5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtQnVm\nLmFwcGVuZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBwYXJhbUJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChwYXJh\nbUJ1ZiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfcHJl\ndHR5UHJpbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiAiKTsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCJbcGFyYW1z\nPSIpLgogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQocGFyYW1CdWYu\ndG9TdHJpbmcoKSkuYXBwZW5kKCJdIik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBzdXBlci5hcHBlbmRJbmZvKGJ1Zik7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyTG9nUGFy\nYW1ldGVycyhib29sZWFuIGJhdGNoKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX3BhcmFtcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9wYXJhbXMu\nY2xlYXIoKTsKICAgICAgICAgICAgICAgIGlmIChiYXRjaCAmJiBfcGFyYW1C\nYXRjaCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNo\nLmNsZWFyKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBzaG91bGRUcmFja1BhcmFtZXRlcnMoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gX3RyYWNrUGFyYW1ldGVycyB8fCBfbG9ncy5pc1NRTEVu\nYWJsZWQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2\nb2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGJvb2xlYW4gdmFsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkp\nCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAi\nKGJvb2xlYW4pICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwgYnl0\nZSB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFt\nZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naW5kZXgsICIoYnl0ZSkgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4\nLCBkb3VibGUgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJh\nY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFy\nYW1ldGVyKGluZGV4LCAiKGRvdWJsZSkgIiArIHZhbCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIo\naW50IGluZGV4LCBmbG9hdCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChz\naG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBz\nZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoZmxvYXQpICIgKyB2YWwpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFy\nYW1ldGVyKGludCBpbmRleCwgaW50IHZhbCkgewogICAgICAgICAgICAgICAg\naWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIihpbnQpICIgKyB2YWwpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9n\nUGFyYW1ldGVyKGludCBpbmRleCwgbG9uZyB2YWwpIHsKICAgICAgICAgICAg\nICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAg\nICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIobG9uZykgIiArIHZh\nbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBz\nZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBzaG9ydCB2YWwpIHsKICAgICAg\nICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAg\nICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoc2hvcnQp\nICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRl\nIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwgU3RyaW5nIHR5cGUs\nIE9iamVjdCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFj\na1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBzZXRMb2dQYXJh\nbWV0ZXIoaW5kZXgsICIoIiArIHR5cGUgKyAiKSAiICsgdmFsKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFt\nZXRlcihpbnQgaW5kZXgsIFN0cmluZyB2YWwpIHsKICAgICAgICAgICAgICAg\nIGlmIChfcGFyYW1zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3Bh\ncmFtcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgICAgICAg\nICAgd2hpbGUgKF9wYXJhbXMuc2l6ZSgpIDwgaW5kZXgpCiAgICAgICAgICAg\nICAgICAgICAgX3BhcmFtcy5hZGQobnVsbCk7CiAgICAgICAgICAgICAgICBp\nZiAodmFsLmxlbmd0aCgpID4gODApCiAgICAgICAgICAgICAgICAgICAgdmFs\nID0gdmFsLnN1YnN0cmluZygwLCA3NykgKyAiLi4uIjsKICAgICAgICAgICAg\nICAgIF9wYXJhbXMuc2V0KGluZGV4IC0gMSwgdmFsKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0gICAKfQo=\n","encoding":"base64"}

