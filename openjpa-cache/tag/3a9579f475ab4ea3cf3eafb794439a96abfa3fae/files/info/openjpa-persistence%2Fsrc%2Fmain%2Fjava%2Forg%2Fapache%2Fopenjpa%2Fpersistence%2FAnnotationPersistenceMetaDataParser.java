{"sha":"ab776e4e40fbdbeb8ca07db6ca09f62af60f92cf","node_id":"MDQ6QmxvYjIwNjM2NDphYjc3NmU0ZTQwZmJkYmViOGNhMDdkYjZjYTA5ZjYyYWY2MGY5MmNm","size":71898,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ab776e4e40fbdbeb8ca07db6ca09f62af60f92cf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBz\ndGF0aWMgamF2YXgucGVyc2lzdGVuY2UuR2VuZXJhdGlvblR5cGUuQVVUTzsK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2Uu\nTWV0YURhdGFUYWcuKjsKCmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBq\nYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0\naW9uLkFubm90YXRpb247CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Bbm5v\ndGF0ZWRFbGVtZW50OwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVj\ndC5Nb2RpZmllcjsKaW1wb3J0IGphdmEubmV0LlVSSVN5bnRheEV4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVl\nU2V0OwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkFjY2VzczsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkFjY2Vzc1R5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5CYXNpYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkNh\nY2hlYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkNhc2NhZGVUeXBl\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRWxlbWVudENvbGxlY3Rpb247\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5FbWJlZGRlZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nRW50aXR5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVu\nZXJzOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRM\naXN0ZW5lcnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3Vw\nZXJjbGFzc0xpc3RlbmVyczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZl\ndGNoVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5\ncGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwoKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLklkOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuSWRDbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkxvYjsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hbnlUb01hbnk7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9PbmU7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5NYXBLZXk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBL\nZXlDbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHNJZDsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xhc3M7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJpZXM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyaWVzOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLk9uZVRvTWFueTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk9uZVRv\nT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT3JkZXJCeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlBvc3RMb2FkOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuUG9zdFBlcnNpc3Q7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5Qb3N0UmVtb3ZlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFVw\nZGF0ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVBlcnNpc3Q7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmVSZW1vdmU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5QcmVVcGRhdGU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5RdWVyeUhpbnQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZXF1\nZW5jZUdlbmVyYXRvcjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlZlcnNp\nb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRp\nbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5C\nZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkxpZmVjeWNsZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5NZXRob2RMaWZlY3ljbGVDYWxsYmFja3M7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3Vh\nZ2VzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5qcHFsLkpQ\nUUxQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYu\nQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEu\nU291cmNlVHJhY2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5BY2Nlc3NDb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rvcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuT3JkZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0ZWdp\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJh\ndGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhl\nbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0\nYURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgppbXBvcnQgc2VycC51dGlsLlN0\ncmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlvbiBtZXRhZGF0\nYSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQogKiBkZXBsb3lt\nZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBA\nYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xh\nc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIKICAgIGlt\ncGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlci5j\nbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENsYXNzPD8+\nLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNoTWFwPENs\nYXNzPD8+LCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAgICAg\nIF90YWdzLnB1dChBY2Nlc3MuY2xhc3MsIEFDQ0VTUyk7CiAgICAgICAgX3Rh\nZ3MucHV0KENhY2hlYWJsZS5jbGFzcywgQ0FDSEVBQkxFKTsKICAgICAgICBf\ndGFncy5wdXQoRW1iZWRkZWRJZC5jbGFzcywgRU1CRURERURfSUQpOwogICAg\nICAgIF90YWdzLnB1dChFbnRpdHlMaXN0ZW5lcnMuY2xhc3MsIEVOVElUWV9M\nSVNURU5FUlMpOwogICAgICAgIF90YWdzLnB1dChFeGNsdWRlRGVmYXVsdExp\nc3RlbmVycy5jbGFzcywgRVhDTFVERV9ERUZBVUxUX0xJU1RFTkVSUyk7CiAg\nICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVTdXBlcmNsYXNzTGlzdGVuZXJzLmNs\nYXNzLAogICAgICAgICAgICBFWENMVURFX1NVUEVSQ0xBU1NfTElTVEVORVJT\nKTsKICAgICAgICBfdGFncy5wdXQoRmx1c2hNb2RlVHlwZS5jbGFzcywgRkxV\nU0hfTU9ERSk7CiAgICAgICAgX3RhZ3MucHV0KEdlbmVyYXRlZFZhbHVlLmNs\nYXNzLCBHRU5FUkFURURfVkFMVUUpOwogICAgICAgIF90YWdzLnB1dChJZC5j\nbGFzcywgSUQpOwogICAgICAgIF90YWdzLnB1dChJZENsYXNzLmNsYXNzLCBJ\nRF9DTEFTUyk7CiAgICAgICAgX3RhZ3MucHV0KE1hcEtleS5jbGFzcywgTUFQ\nX0tFWSk7CiAgICAgICAgX3RhZ3MucHV0KE1hcEtleUNsYXNzLmNsYXNzLCBN\nQVBfS0VZX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwc0lkLmNsYXNz\nLCBNQVBQRURfQllfSUQpOwogICAgICAgIF90YWdzLnB1dChOYW1lZE5hdGl2\nZVF1ZXJpZXMuY2xhc3MsIE5BVElWRV9RVUVSSUVTKTsKICAgICAgICBfdGFn\ncy5wdXQoTmFtZWROYXRpdmVRdWVyeS5jbGFzcywgTkFUSVZFX1FVRVJZKTsK\nICAgICAgICBfdGFncy5wdXQoTmFtZWRRdWVyaWVzLmNsYXNzLCBRVUVSSUVT\nKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWRRdWVyeS5jbGFzcywgUVVFUlkp\nOwogICAgICAgIF90YWdzLnB1dChPcmRlckJ5LmNsYXNzLCBPUkRFUl9CWSk7\nCiAgICAgICAgX3RhZ3MucHV0KFBvc3RMb2FkLmNsYXNzLCBQT1NUX0xPQUQp\nOwogICAgICAgIF90YWdzLnB1dChQb3N0UGVyc2lzdC5jbGFzcywgUE9TVF9Q\nRVJTSVNUKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFJlbW92ZS5jbGFzcywg\nUE9TVF9SRU1PVkUpOwogICAgICAgIF90YWdzLnB1dChQb3N0VXBkYXRlLmNs\nYXNzLCBQT1NUX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVBlcnNp\nc3QuY2xhc3MsIFBSRV9QRVJTSVNUKTsKICAgICAgICBfdGFncy5wdXQoUHJl\nUmVtb3ZlLmNsYXNzLCBQUkVfUkVNT1ZFKTsKICAgICAgICBfdGFncy5wdXQo\nUHJlVXBkYXRlLmNsYXNzLCBQUkVfVVBEQVRFKTsKICAgICAgICBfdGFncy5w\ndXQoU2VxdWVuY2VHZW5lcmF0b3IuY2xhc3MsIFNFUV9HRU5FUkFUT1IpOwog\nICAgICAgIF90YWdzLnB1dChWZXJzaW9uLmNsYXNzLCBWRVJTSU9OKTsKICAg\nICAgICBfdGFncy5wdXQoRGF0YUNhY2hlLmNsYXNzLCBEQVRBX0NBQ0hFKTsK\nICAgICAgICBfdGFncy5wdXQoRGF0YVN0b3JlSWQuY2xhc3MsIERBVEFTVE9S\nRV9JRCk7CiAgICAgICAgX3RhZ3MucHV0KERlcGVuZGVudC5jbGFzcywgREVQ\nRU5ERU5UKTsKICAgICAgICBfdGFncy5wdXQoRGV0YWNoZWRTdGF0ZS5jbGFz\ncywgREVUQUNIRURfU1RBVEUpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50\nRGVwZW5kZW50LmNsYXNzLCBFTEVNX0RFUEVOREVOVCk7CiAgICAgICAgX3Rh\nZ3MucHV0KEVsZW1lbnRUeXBlLmNsYXNzLCBFTEVNX1RZUEUpOwogICAgICAg\nIF90YWdzLnB1dChFeHRlcm5hbFZhbHVlcy5jbGFzcywgRVhURVJOQUxfVkFM\nUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4dGVybmFsaXplci5jbGFzcywgRVhU\nRVJOQUxJWkVSKTsKICAgICAgICBfdGFncy5wdXQoRmFjdG9yeS5jbGFzcywg\nRkFDVE9SWSk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXAuY2xhc3Ms\nIEZFVENIX0dST1VQKTsKICAgICAgICBfdGFncy5wdXQoRmV0Y2hHcm91cHMu\nY2xhc3MsIEZFVENIX0dST1VQUyk7CiAgICAgICAgX3RhZ3MucHV0KEludmVy\nc2VMb2dpY2FsLmNsYXNzLCBJTlZFUlNFX0xPR0lDQUwpOwogICAgICAgIF90\nYWdzLnB1dChLZXlEZXBlbmRlbnQuY2xhc3MsIEtFWV9ERVBFTkRFTlQpOwog\nICAgICAgIF90YWdzLnB1dChLZXlUeXBlLmNsYXNzLCBLRVlfVFlQRSk7CiAg\nICAgICAgX3RhZ3MucHV0KExvYWRGZXRjaEdyb3VwLmNsYXNzLCBMT0FEX0ZF\nVENIX0dST1VQKTsKICAgICAgICBfdGFncy5wdXQoTFJTLmNsYXNzLCBMUlMp\nOwogICAgICAgIF90YWdzLnB1dChNYW5hZ2VkSW50ZXJmYWNlLmNsYXNzLCBN\nQU5BR0VEX0lOVEVSRkFDRSk7CiAgICAgICAgX3RhZ3MucHV0KFJlYWRPbmx5\nLmNsYXNzLCBSRUFEX09OTFkpOwogICAgICAgIF90YWdzLnB1dChUeXBlLmNs\nYXNzLCBUWVBFKTsKICAgICAgICBfdGFncy5wdXQoUmVwbGljYXRlZC5jbGFz\ncywgUkVQTElDQVRFRCk7CiAgICB9CgogICAgcHJpdmF0ZSBmaW5hbCBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBfY29uZjsKICAgIHByaXZhdGUgZmluYWwgTG9n\nIF9sb2c7CiAgICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3Mg\nPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc0xvYWRlciBfZW52TG9hZGVyID0g\nbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3ZlcnJpZGUgPSBmYWxzZTsK\nICAgIHByaXZhdGUgaW50IF9tb2RlID0gTU9ERV9OT05FOwoKICAgIC8vIHBh\nY2thZ2VzIGFuZCB0aGVpciBwYXJzZSBtb2RlcwogICAgcHJpdmF0ZSBmaW5h\nbCBNYXA8UGFja2FnZSwgSW50ZWdlcj4gX3BrZ3MgPSBuZXcgSGFzaE1hcDxQ\nYWNrYWdlLCBJbnRlZ2VyPigpOwoKICAgIC8vIHRoZSBjbGFzcyB3ZSB3ZXJl\nIGludm9rZWQgdG8gcGFyc2UKICAgIHByb3RlY3RlZCBDbGFzczw/PiBfY2xz\nID0gbnVsbDsKICAgIHByb3RlY3RlZCBTdGFjazxDbGFzczw/Pj4gX3N0YWNr\nID0gbmV3IFN0YWNrPENsYXNzPD8+PigpOwogICAgcHJpdmF0ZSBGaWxlIF9m\naWxlID0gbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBw\nbHkgY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRp\nb25QZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2VyKE9wZW5KUEFDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2xv\nZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRB\nREFUQSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uIHN1\ncHBsaWVkIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIE9w\nZW5KUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAg\nICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogTWV0YWRh\ndGEgbG9nLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAg\nICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgdGhlIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLiBJZiBub25lIGhh\ncyBiZWVuIHNldCwKICAgICAqIGNyZWF0ZSBhIG5ldyByZXBvc2l0b3J5IGFu\nZCBzZXRzIGl0LgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0\nb3J5IGdldFJlcG9zaXRvcnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9\nIF9jb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAg\nICAgICAgIE1ldGFEYXRhRmFjdG9yeSBtZGYgPSByZXBvcy5nZXRNZXRhRGF0\nYUZhY3RvcnkoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIERl\nbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpCiAgICAgICAgICAgICAgICBtZGYg\nPSAoKERlbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpIG1kZikuZ2V0SW5uZXJt\nb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9m\nIFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5KQogICAgICAgICAgICAgICAg\nKChQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeSkgbWRmKS5zZXRBbm5vdGF0\naW9uUGFyc2VyKHRoaXMpOwogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgbWV0YWRhdGEgcmVwb3NpdG9yeSBmb3IgdGhp\ncyBwYXJzZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcG9zaXRv\ncnkoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9z\nID0gcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVu\ndmlyb25tZW50YWwgY2xhc3MgbG9hZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2Vk\nCiAgICAgKiBtZXRhZGF0YSBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsKICAgICAgICBy\nZXR1cm4gX2VudkxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFzcyBvbiB0byBw\nYXJzZWQKICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgX2VudkxvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9m\nIG1hcHBpbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxp\nZXIgaW5mb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0\nbyBmYWxzZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5n\nIGEgY2xhc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcK\nICAgICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBw\naW5ncyBhcmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNYXBwaW5nT3ZlcnJpZGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9vdmVycmlkZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBp\nbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5m\nb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxz\nZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xh\nc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAq\nIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBh\ncmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBwaW5nT3ZlcnJpZGUoYm9vbGVhbiBv\ndmVycmlkZSkgewogICAgICAgIF9vdmVycmlkZSA9IG92ZXJyaWRlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBpbnQgZ2V0TW9kZSgpIHsKICAgICAgICByZXR1cm4gX21vZGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9kZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSwgYm9vbGVhbiBv\nbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAg\nICAgX21vZGUgPSBNT0RFX05PTkU7CiAgICAgICAgZWxzZSBpZiAob24pCiAg\nICAgICAgICAgIF9tb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBfbW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBwYXJzZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2Rl\nKGludCBtb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRp\nbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaXNNZXRhRGF0YU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9k\nZSAmIE1PREVfTUVUQSkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0\nTW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzUXVlcnlN\nb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX1FVRVJZKSAh\nPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9k\nIGZvciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgpIHsKICAgICAg\nICByZXR1cm4gKF9tb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHdlJ3JlIGluIG1hcHBp\nbmcgbW9kZSBvciBpbiBtZXRhZGF0YSBtb2RlIHdpdGgKICAgICAqIG1hcHBp\nbmcgb3ZlcmlkZSBlbmFibGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBpc01hcHBpbmdPdmVycmlkZU1vZGUoKSB7CiAgICAgICAgcmV0dXJu\nIGlzTWFwcGluZ01vZGUoKSB8fCAoX292ZXJyaWRlICYmIGlzTWV0YURhdGFN\nb2RlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVzLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgIAlfc3RhY2su\nY2xlYXIoKTsKICAgICAgICBfY2xzID0gbnVsbDsKICAgICAgICBfZmlsZSA9\nIG51bGw7CiAgICAgICAgX3BrZ3MuY2xlYXIoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIHBlcnNpc3RlbmNlIG1ldGFkYXRhIGZvciB0aGUgZ2l2\nZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBhcnNlKENsYXNz\nPD8+IGNscykgewogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBhcnNlLWNsYXNz\nIiwgY2xzLmdldE5hbWUoKSkpOwoKICAgICAgICBfY2xzID0gY2xzOwogICAg\nICAgIF9zdGFjay5wdXNoKGNscyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcGFyc2VQYWNrYWdlQW5ub3RhdGlvbnMoKTsKICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gcGFyc2VDbGFzc0Fubm90YXRpb25zKCk7CiAg\nICAgICAgICAgIHVwZGF0ZVNvdXJjZU1vZGUobWV0YSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAJX3N0YWNrLnBvcCgpOwogICAgICAgICAgICBf\nY2xzID0gX3N0YWNrLmlzRW1wdHkoKSA/IG51bGwgOiBfc3RhY2sucGVlaygp\nOwogICAgICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBzb3VyY2UgbW9kZSB0byB0aGUg\nY2xhc3MgcGFja2FnZSBhbmQgY2xhc3MgdG8gaW5kaWNhdGUgdGhhdAogICAg\nICogd2UndmUgZnVsbHkgcGFyc2VkIHRoZW0uCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB1cGRhdGVTb3VyY2VNb2RlKENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChfY2xzLmdldFBhY2thZ2UoKSAhPSBudWxsKQogICAg\nICAgICAgICBhZGRTb3VyY2VNb2RlKF9jbHMuZ2V0UGFja2FnZSgpLCBfbW9k\nZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKF9tb2RlLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIGluZm9ybWF0aW9uIGluIHBhY2thZ2UtbGV2ZWwgY2xh\nc3MgYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZVBhY2thZ2VBbm5vdGF0aW9ucygpIHsKICAgICAgICBQYWNrYWdlIHBrZyA9\nIF9jbHMuZ2V0UGFja2FnZSgpOwogICAgICAgIGlmIChwa2cgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpbnQgcGtnTW9kZSA9IGdl\ndFNvdXJjZU1vZGUocGtnKTsKICAgICAgICBpZiAocGtnTW9kZSA9PSAwICYm\nIF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgicGFyc2UtcGFja2FnZSIsIF9jbHMuZ2V0TmFtZSgpKSk7\nCiAgICAgICAgaWYgKChwa2dNb2RlICYgX21vZGUpID09IF9tb2RlKSAvLyBh\nbHJlYWR5IHZpc2l0ZWQKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBN\nZXRhRGF0YVRhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8g\nOiBwa2cuZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAg\nIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAg\nICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGhh\nbmRsZVVua25vd25QYWNrYWdlQW5ub3RhdGlvbihwa2csIGFubm8pOwogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBjYXNlIE5BVElW\nRV9RVUVSSUVTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9k\nZSgpICYmIChwa2dNb2RlICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMocGtnLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKChOYW1lZE5hdGl2ZVF1ZXJp\nZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVfUVVFUlk6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKHBrZ01vZGUgJiBN\nT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJz\nZU5hbWVkTmF0aXZlUXVlcmllcyhwa2csIChOYW1lZE5hdGl2ZVF1ZXJ5KSBh\nbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNR\ndWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywg\nKChOYW1lZFF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBRVUVSWToKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9k\nZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywgKE5hbWVkUXVlcnkpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01h\ncHBpbmdPdmVycmlkZU1vZGUoKSAmJgogICAgICAgICAgICAgICAgICAgICAg\nICAocGtnTW9kZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihwa2csIChTZXF1\nZW5jZUdlbmVyYXRvcikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgi\ndW5zdXBwb3J0ZWQiLCBwa2csCiAgICAgICAgICAgICAgICAgICAgICAgIGFu\nbm8udG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyBhbHdheXMgcGFyc2UgbWFwcGluZyBzdHVmZiBhZnRlciBtZXRh\nZGF0YSBzdHVmZiwgaW4gY2FzZSB0aGVyZSBhcmUKICAgICAgICAvLyBkZXBl\nbmRlbmNpZXMgb24gbWV0YWRhdGEKICAgICAgICBpZiAoaXNNYXBwaW5nT3Zl\ncnJpZGVNb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX01BUFBJTkcpID09IDAp\nCiAgICAgICAgICAgIHBhcnNlUGFja2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhw\na2cpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgcGFja2FnZSBtYXBw\naW5nIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBw\nYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbnMoUGFja2FnZSBwa2cpIHsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFu\nZGxlIHVua25vd24gYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGhhbmRsZVVua25vd25QYWNrYWdlQW5ub3RhdGlvbihQYWNr\nYWdlIHBrZywKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNl\nIG1vZGUgZm9yIHRoZSBnaXZlbiBwYWNrYWdlLgogICAgICovCiAgICBwcml2\nYXRlIGludCBnZXRTb3VyY2VNb2RlKFBhY2thZ2UgcGtnKSB7CiAgICAgICAg\nTnVtYmVyIG51bSA9IF9wa2dzLmdldChwa2cpOwogICAgICAgIHJldHVybiAo\nbnVtID09IG51bGwpID8gMCA6IG51bS5pbnRWYWx1ZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIHRvIHRoZSBzb3VyY2UgbW9kZSBmb3IgdGhlIGdp\ndmVuIHBhY2thZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTb3Vy\nY2VNb2RlKFBhY2thZ2UgcGtnLCBpbnQgbW9kZSkgewogICAgICAgIEludGVn\nZXIgbnVtID0gX3BrZ3MuZ2V0KHBrZyk7CiAgICAgICAgaWYgKG51bSA9PSBu\ndWxsKQogICAgICAgICAgICBudW0gPSBtb2RlOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgbnVtID0gbnVtLmludFZhbHVlKCkgfCBtb2RlOwogICAgICAg\nIF9wa2dzLnB1dChwa2csIG51bSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWFkIGFubm90YXRpb25zIGZvciB0aGUgY3VycmVudCB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgcGFyc2VDbGFzc0Fubm90YXRp\nb25zKCkgewogICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBpcyBj\nYWNoZWQgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyB0aGF0IHdlIGFyZSBjdXJy\nZW50bHkgcGFyc2luZy4gSXQKICAgICAgICAvLyBpcyBwb3NzaWJsZSB0aGF0\nIG9uZSBvZiB0aGUgYW5ub3RhdGlvbnMgKEVudGl0eSwgRW1iZWRkYWJsZSwg\nTWFwcGVkU3VwZXJjbGFzcykgaXMgaW4gdGhlCiAgICAgICAgLy8gb3JtLnht\nbC4gV2Ugc3RpbGwgbmVlZCB0byBsb29rIGF0IHRoZXNlIGZpbGVzIGZvciBv\ndGhlciBhbm5vdGF0aW9ucyBhbmQgbW9yZSBpbXBvcnRhbnRseQogICAgICAg\nIC8vIHNldHVwIGRlZmF1bHRzIChpZTogQmFzaWMgZmllbGRzKS4KICAgICAg\nICBDbGFzc01ldGFEYXRhIG0gPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2FjaGVk\nTWV0YURhdGEoX2Nscyk7CiAgICAgICAgaWYgKG0gPT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoIShBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChK\nMkRvUHJpdkhlbHBlci5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKF9jbHMs\nIEVudGl0eS5jbGFzcykpKQogICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1\nZSgpCiAgICAgICAgICAgICAgICAmJiAhKEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyLmlzQW5ub3RhdGlvblByZXNlbnRB\nY3Rpb24oX2NscywgRW1iZWRkYWJsZS5jbGFzcykpKQogICAgICAgICAgICAg\nICAgICAgIC5ib29sZWFuVmFsdWUoKQogICAgICAgICAgICAgICAgJiYgIShB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5p\nc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKF9jbHMsCiAgICAgICAgICAgICAg\nICAgICAgTWFwcGVkU3VwZXJjbGFzcy5jbGFzcykpKS5ib29sZWFuVmFsdWUo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAg\nICAgICAvLyBmaW5kIC8gY3JlYXRlIG1ldGFkYXRhCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gKG0gPT0gbnVsbCkgPyBnZXRNZXRhRGF0YSgpIDog\nbTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgRW50aXR5IGVudGl0eSA9IF9jbHMuZ2V0QW5u\nb3RhdGlvbihFbnRpdHkuY2xhc3MpOwogICAgICAgIE1hcHBlZFN1cGVyY2xh\nc3MgbWFwcGVkID0gX2Nscy5nZXRBbm5vdGF0aW9uKE1hcHBlZFN1cGVyY2xh\nc3MuY2xhc3MpOwogICAgICAgIEVtYmVkZGFibGUgZW1iZWRkYWJsZSA9IF9j\nbHMuZ2V0QW5ub3RhdGlvbihFbWJlZGRhYmxlLmNsYXNzKTsKICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAgICAgICAgICBtZXRhLnNldEFi\nc3RyYWN0KG1hcHBlZCAhPSBudWxsKTsKICAgICAgICAgICAgaWYgKGVtYmVk\nZGFibGUgIT0gbnVsbCkgbWV0YS5zZXRFbWJlZGRhYmxlKCk7CiAgICAgICAg\nICAgIC8vIHdoaWxlIHRoZSBzcGVjIG9ubHkgcHJvdmlkZXMgZm9yIGVtYmVk\nZGVkIGV4Y2x1c2l2ZSwgaXQgZG9lc24ndAogICAgICAgICAgICAvLyBzZWVt\nIGhhcmQgdG8gc3VwcG9ydCBvdGhlcndpc2UKICAgICAgICAgICAgaWYgKGVu\ndGl0eSA9PSBudWxsKQogICAgICAgICAgICAgICAgbWV0YS5zZXRFbWJlZGRl\nZE9ubHkodHJ1ZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgbWV0YS5zZXRFbWJlZGRlZE9ubHkoZmFsc2UpOwogICAgICAgICAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGVudGl0eS5uYW1lKCkpKQog\nICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0VHlwZUFsaWFzKGVudGl0eS5u\nYW1lKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0\ncmFjayBmZXRjaCBncm91cHMgdG8gcGFyc2UgdGhlbSBhZnRlciBmaWVsZHMs\nIHNpbmNlIHRoZXkKICAgICAgICAvLyByZWx5IG9uIGZpZWxkIG1ldGFkYXRh\nCiAgICAgICAgRmV0Y2hHcm91cFtdIGZncyA9IG51bGw7CiAgICAgICAgRGV0\nYWNoZWRTdGF0ZSBkZXRhY2hlZCA9IG51bGw7CgogICAgICAgIC8vIHRyYWNr\nIGxpc3RlbmVycyBzaW5jZSB3ZSBuZWVkIHRvIG1lcmdlIHRoZW0gd2l0aCBl\nbnRpdHkgY2FsbGJhY2tzCiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVD\nYWxsYmFja3M+W10gbGlzdGVuZXJzID0gbnVsbDsKICAgICAgICBNZXRhRGF0\nYVRhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBfY2xz\nLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcg\nPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAg\nICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVV\nbmtub3duQ2xhc3NBbm5vdGF0aW9uKG1ldGEsIGFubm8pOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3\naXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBjYXNlIEVOVElUWV9MSVNU\nRU5FUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycyA9IHBhcnNl\nRW50aXR5TGlzdGVuZXJzKG1ldGEsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAoRW50aXR5TGlzdGVuZXJzKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhDTFVERV9ERUZB\nVUxUX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRM\naWZlY3ljbGVNZXRhRGF0YSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAuc2V0SWdub3JlU3lzdGVtTGlzdGVuZXJzKHRydWUpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWENMVURF\nX1NVUEVSQ0xBU1NfTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRhLmdldExpZmVjeWNsZU1ldGFEYXRhKCkuc2V0SWdub3JlU3VwZXJjbGFz\nc0NhbGxiYWNrcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKExpZmVj\neWNsZU1ldGFEYXRhLklHTk9SRV9ISUdIKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkxVU0hfTU9ERToKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgd2FybkZsdXNoTW9kZShtZXRhKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSURf\nQ0xBU1M6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0T2JqZWN0SWRU\neXBlKCgoSWRDbGFzcykgYW5ubykudmFsdWUoKSwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE5BVElW\nRV9RVUVSSUVTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9k\nZSgpICYmIChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfUVVFUlkpPT0w\nKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVl\ncmllcyhfY2xzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKChOYW1l\nZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVfUVVF\nUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYg\nKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9RVUVSWSk9PTApCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKF9j\nbHMsIChOYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAobWV0YS5n\nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKT09MCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKChOYW1lZFF1\nZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VN\nb2RlKCkgJiBNT0RFX1FVRVJZKT09MCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKE5hbWVkUXVlcnkpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgcGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihfY2xzLCAoU2VxdWVuY2VHZW5l\ncmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBEQVRBX0NBQ0hFOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBwYXJzZURhdGFDYWNoZShtZXRhLCAoRGF0YUNhY2hlKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgREFUQVNUT1JFX0lEOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01l\ndGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZURh\ndGFTdG9yZUlkKG1ldGEsIChEYXRhU3RvcmVJZCkgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERFVEFD\nSEVEX1NUQVRFOgogICAgICAgICAgICAgICAgICAgIGRldGFjaGVkID0gKERl\ndGFjaGVkU3RhdGUpIGFubm87CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEZFVENIX0dST1VQOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBmZ3MgPSBuZXcgRmV0Y2hHcm91cFtdeyAoRmV0Y2hHcm91\ncCkgYW5ubyB9OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBGRVRDSF9HUk9VUFM6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZncyA9ICgoRmV0Y2hHcm91cHMpIGFubm8pLnZhbHVlKCk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE1B\nTkFHRURfSU5URVJGQUNFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01l\ndGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU1h\nbmFnZWRJbnRlcmZhY2UobWV0YSwgKE1hbmFnZWRJbnRlcmZhY2UpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBSRVBMSUNBVEVEOgogICAgICAgICAgICAgICAgCW1ldGEuc2V0UmVw\nbGljYXRlZCh0cnVlKTsKICAgICAgICAgICAgICAgIAlicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgQUNDRVNTOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBw\nYXJzZUFjY2VzcyhtZXRhLCAoQWNjZXNzKWFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDQUNIRUFCTEU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VDYWNoZShtZXRhLCAoQ2Fj\naGVhYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBfY2xzLAogICAgICAgICAg\nICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpIHsK\nICAgICAgICAgICAgcGFyc2VEZXRhY2hlZFN0YXRlKG1ldGEsIGRldGFjaGVk\nKTsKCiAgICAgICAgICAgIC8vIG1lcmdlIGNhbGxiYWNrIG1ldGhvZHMgd2l0\naCBkZWNsYXJlZCBsaXN0ZW5lcnMKICAgICAgICAgICAgaW50W10gaGlnaHMg\nPSBudWxsOwogICAgICAgICAgICBpZiAobGlzdGVuZXJzICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGhpZ2hzID0gbmV3IGludFtsaXN0ZW5lcnMubGVu\nZ3RoXTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlz\ndGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChs\naXN0ZW5lcnNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\naGlnaHNbaV0gPSBsaXN0ZW5lcnNbaV0uc2l6ZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJlY29yZENhbGxiYWNrcyhtZXRhLCBwYXJzZUNhbGxi\nYWNrTWV0aG9kcyhfY2xzLCBsaXN0ZW5lcnMsIGZhbHNlLAogICAgICAgICAg\nICAgICAgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIGhpZ2hzLCBmYWxzZSk7\nCgogICAgICAgICAgICAvLyBzY2FuIHBvc3NpYmx5IG5vbi1QQyBoaWVyYXJj\naHkgZm9yIGNhbGxiYWNrcy4KICAgICAgICAgICAgLy8gcmVkdW5kYW50IGZv\nciBQQyBzdXBlcmNsYXNzIGJ1dCB3ZSBkb24ndCBrbm93IHRoYXQgeWV0CiAg\nICAgICAgICAgIC8vIHNvIGxldCBMaWZlY3ljbGVNZXRhRGF0YSBkZXRlcm1p\nbmUgdGhhdAogICAgICAgICAgICBpZiAoX2Nscy5nZXRTdXBlcmNsYXNzKCkg\nIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgIU9iamVjdC5jbGFzcy5lcXVh\nbHMoX2Nscy5nZXRTdXBlcmNsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICBy\nZWNvcmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2Ns\ncy5nZXRTdXBlcmNsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgbnVsbCwg\ndHJ1ZSwgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIG51bGwsIHRydWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKEZpZWxkTWV0\nYURhdGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKQogICAgICAg\nICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRh\nLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgcGFyc2VNZW1i\nZXJBbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIC8vIHBhcnNlIGZldGNoIGdy\nb3VwcyBhZnRlciBmaWVsZHMKICAgICAgICBpZiAoZmdzICE9IG51bGwpCiAg\nICAgICAgICAgIHBhcnNlRmV0Y2hHcm91cHMobWV0YSwgZmdzKTsKCiAgICAg\nICAgLy8gYWx3YXlzIHBhcnNlIG1hcHBpbmcgYWZ0ZXIgbWV0YWRhdGEgaW4g\nY2FzZSB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYgKGlzTWFw\ncGluZ092ZXJyaWRlTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNlQ2xhc3NN\nYXBwaW5nQW5ub3RhdGlvbnMobWV0YSk7CiAgICAgICAgICAgIGZvciAoRmll\nbGRNZXRhRGF0YSBmbWQgOiBtZXRhLmdldERlY2xhcmVkRmllbGRzKCkpCiAg\nICAgICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVs\nZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAg\nICAgIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRpb25zKGZtZCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBleHBsaWNpdCBhY2Nlc3MgdHlwZSwgaWYgc3BlY2lmaWVk\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBY2Nlc3MoQ2xhc3NN\nZXRhRGF0YSBtZXRhLCBBY2Nlc3MgYWNjZXNzKSB7CiAgICAJaWYgKGFjY2Vz\ncyAhPSBudWxsKSB7CiAgICAJCW1ldGEuc2V0QWNjZXNzVHlwZShBY2Nlc3ND\nb2RlLkVYUExJQ0lUCiAgICAgICAgICAgIHwgKGFjY2Vzcy52YWx1ZSgpID09\nIEFjY2Vzc1R5cGUuRklFTEQgPwogICAgICAgICAgICAJQWNjZXNzQ29kZS5G\nSUVMRCA6IEFjY2Vzc0NvZGUuUFJPUEVSVFkpKTsKICAgIAl9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBjbGFzcyBtYXBwaW5nIGFubm90YXRpb25z\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUNsYXNzTWFwcGlu\nZ0Fubm90YXRpb25zKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgfQoKICAg\nIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93\nbiBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\naGFuZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihDbGFzc01ldGFEYXRhIG1l\ndGEsCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCBvciBjcmVhdGUg\nbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiB0eXBlLiBNYXkgcmV0dXJuIG51bGwg\naWYKICAgICAqIHRoaXMgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBwYXJzZWQg\nZnVsbHkuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YSgpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBnZXRS\nZXBvc2l0b3J5KCkuZ2V0Q2FjaGVkTWV0YURhdGEoX2Nscyk7CiAgICAgICAg\naWYgKG1ldGEgIT0gbnVsbCAmJgogICAgICAgICAgICAoKGlzTWV0YURhdGFN\nb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAh\nPSAwKSB8fAogICAgICAgICAgICAgICAgKGlzTWFwcGluZ01vZGUoKSAmJgog\nICAgICAgICAgICAgICAgICAgIChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1P\nREVfTUFQUElORykgIT0gMCkpKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiZHVwLW1ldGFkYXRhIiwgX2Nscy5nZXROYW1lKCkpKTsKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAobWV0\nYSA9PSBudWxsKSB7CiAgICAgICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5\nKCkuYWRkTWV0YURhdGEoX2NscywgZ2V0QWNjZXNzQ29kZShfY2xzKSk7CiAg\nICAgICAgICAgIG1ldGEuc2V0RW52Q2xhc3NMb2FkZXIoX2VudkxvYWRlcik7\nCiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX05PTkUpOwog\nICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIFNv\ndXJjZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRo\nZSBleHBsaWNpdCBhY2Nlc3MgZm9yIHRoZSBjbGFzcywgaWYgYW55LgogICAg\nICogRXhwbGljaXQgYWNjZXNzIHR5cGUgc3BlY2lmaWNhdGlvbiBkb2VzIG5v\ndCBhZmZlY3QgdGhlIGFjY2VzcyB0eXBlIG9mCiAgICAgKiBvdGhlciBlbnRp\ndHkgY2xhc3NlcyBvciBtYXBwZWQgc3VwZXIgY2xhc3NlcyBpbiB0aGUgZW50\naXR5IGhpZXJhcmNoeS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0QWNj\nZXNzQ29kZShDbGFzczw/PiBjbHMpIHsKICAgICAgICBpbnQgYWNjZXNzQ29k\nZSA9IEFjY2Vzc0NvZGUuVU5LTk9XTjsKICAgICAgICBBY2Nlc3MgYWNjZXNz\nID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nIEoyRG9Qcml2SGVscGVyLmdldEFubm90YXRpb25BY3Rpb24oY2xzLCBBY2Nl\nc3MuY2xhc3MpKTsKICAgICAgICBpZiAoYWNjZXNzICE9IG51bGwpIHsKICAg\nICAgICAgICAgYWNjZXNzQ29kZSB8PSAgQWNjZXNzQ29kZS5FWFBMSUNJVCB8\nCiAgICAgICAgICAgICAgICAoYWNjZXNzLnZhbHVlKCkgPT0gQWNjZXNzVHlw\nZS5GSUVMRCA/CiAgICAgICAgICAgICAgICBBY2Nlc3NDb2RlLkZJRUxEIDog\nQWNjZXNzQ29kZS5QUk9QRVJUWSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBhY2Nlc3NDb2RlOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5l\nIHRoZSBzb3VyY2UgZmlsZSB3ZSdyZSBwYXJzaW5nLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAgIGlmIChf\nZmlsZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2ZpbGU7CgogICAg\nICAgIENsYXNzPD8+IGNscyA9IF9jbHM7CiAgICAgICAgd2hpbGUgKGNscy5n\nZXRFbmNsb3NpbmdDbGFzcygpICE9IG51bGwpCiAgICAgICAgICAgIGNscyA9\nIGNscy5nZXRFbmNsb3NpbmdDbGFzcygpOwoKICAgICAgICBTdHJpbmcgcnNy\nYyA9IFN0cmluZ1V0aWxzLnJlcGxhY2UoY2xzLmdldE5hbWUoKSwgIi4iLCAi\nLyIpOwogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXRDbGFzc0xvYWRlckFjdGlvbihjbHMpKTsKICAgICAgICBpZiAobG9h\nZGVyID09IG51bGwpCiAgICAgICAgICAgIGxvYWRlciA9IEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0U3lzdGVtQ2xhc3NMb2FkZXJBY3Rpb24oKSk7CiAgICAgICAg\naWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBVUkwgdXJsID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldFJlc291cmNlQWN0\naW9uKGxvYWRlciwgcnNyYyArICIuamF2YSIpKTsKICAgICAgICBpZiAodXJs\nID09IG51bGwpIHsKICAgICAgICAgICAgdXJsID0gQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXRSZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJzcmMgKyAiLmNsYXNzIikp\nOwogICAgICAgICAgICBpZiAodXJsID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgX2ZpbGUgPSBuZXcgRmlsZSh1cmwudG9VUkkoKSk7CiAgICAgICAg\nfSBjYXRjaCAoVVJJU3ludGF4RXhjZXB0aW9uIGUpIHsKICAgICAgICB9IGNh\ndGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWFlKSB7CiAgICAgICAg\nICAgIC8vIHRoaXMgaXMgdGhyb3duIHdoZW4gdGhlIFVSSSBpcyBub24taGll\ncmFyY2hpY2FsIChha2EgSkJvc3MpCiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfZmlsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBEYXRhU3Rv\ncmVJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGF0YVN0b3Jl\nSWQoQ2xhc3NNZXRhRGF0YSBtZXRhLCBEYXRhU3RvcmVJZCBpZCkgewogICAg\nICAgIG1ldGEuc2V0SWRlbnRpdHlUeXBlKENsYXNzTWV0YURhdGEuSURfREFU\nQVNUT1JFKTsKCiAgICAgICAgaW50IHN0cmF0ID0gZ2V0R2VuZXJhdGVkVmFs\ndWVTdHJhdGVneShtZXRhLCBpZC5zdHJhdGVneSgpLAogICAgICAgICAgICBp\nZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgaWYgKHN0cmF0ICE9IC0xKQogICAg\nICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3koc3RyYXQpOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKGlkLnN0cmF0ZWd5KCkp\nIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAgICAg\nICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAgICAgICAgICAgIC8vIHRlY2hu\naWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFyYXRlIHN5c3RlbSB0YWJsZSBh\nbmQKICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBnZW5lcmF0b3Jz\nLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCByZWx5IG9uCiAgICAgICAgICAg\nICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcuYXBhY2hlLm9wZW5qcGEuU2Vx\ndWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAgICAgICAgICAgICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KGlkLmdlbmVyYXRvcigpKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVNlcXVlbmNlTmFt\nZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcXVlbmNlTWV0YURh\ndGEuTkFNRV9TWVNURU0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVNlcXVlbmNl\nTmFtZShpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFVVE86CiAgICAgICAgICAgICAg\nICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2ll\ncy5OQVRJVkUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBJREVOVElUWToKICAgICAgICAgICAgICAgICAgICBt\nZXRhLnNldElkZW50aXR5U3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVzLkFVVE9B\nU1NJR04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oaWQuc3RyYXRlZ3koKS50b1N0cmluZygp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFdhcm4gdGhhdCBARmx1c2hNb2RlIGlzIG5vdCBzdXBwb3J0ZWQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB3YXJuRmx1c2hNb2RlKE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoInVuc3VwcG9ydGVkIiwg\nIkZsdXNoTW9kZSIsIGNvbnRleHQpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIEBEYXRhQ2FjaGUuCiAgICAgKiAKICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBhcnNlRGF0YUNhY2hlKENsYXNzTWV0YURhdGEgbWV0YSwgRGF0\nYUNhY2hlIGNhY2hlKSB7CiAgICAgICAgaWYgKGNhY2hlLnRpbWVvdXQoKSAh\nPSBJbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAgICBtZXRhLnNldERh\ndGFDYWNoZVRpbWVvdXQoY2FjaGUudGltZW91dCgpKTsKICAgICAgICB9CiAg\nICAgICAgU3RyaW5nIGNhY2hlTmFtZSA9IGNhY2hlLm5hbWUoKTsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjYWNoZU5hbWUpKSB7CiAgICAg\nICAgICAgIGNhY2hlTmFtZSA9IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2Fj\naGUuRGF0YUNhY2hlLk5BTUVfREVGQVVMVDsKICAgICAgICB9CiAgICAgICAg\nbWV0YS5zZXREYXRhQ2FjaGVOYW1lKGNhY2hlLmVuYWJsZWQoKSA/IGNhY2hl\nTmFtZSA6IG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBwYXJzZU1h\nbmFnZWRJbnRlcmZhY2UoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIE1h\nbmFnZWRJbnRlcmZhY2UgaWZhY2UpIHsKICAgICAgICBtZXRhLnNldE1hbmFn\nZWRJbnRlcmZhY2UodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBARGV0YWNoZWRTdGF0ZS4gVGhlIGFubm90YXRpb24gbWF5IGJlIG51bGwu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZURldGFjaGVkU3RhdGUo\nQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIERldGFjaGVkU3RhdGUgZGV0\nYWNoZWQpIHsKICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoIWRldGFjaGVkLmVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShudWxsKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShkZXRhY2hlZC5maWVsZE5h\nbWUoKSkpCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3RhdGUo\nQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3RhdGUoZGV0YWNoZWQu\nZmllbGROYW1lKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEZp\nZWxkW10gZmllbGRzID0gKEZpZWxkW10pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nRGVjbGFyZWRGaWVsZHNBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBpZiAoKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2\nSGVscGVyCiAgICAgICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNl\nbnRBY3Rpb24oZmllbGRzW2ldLCBEZXRhY2hlZFN0YXRlLmNsYXNzKSkpCiAg\nICAgICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAg\nICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShmaWVsZHNbaV0uZ2V0\nTmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBARW50aXR5TGlzdGVuZXJzCiAgICAgKi8KICAgIHByaXZhdGUgQ29sbGVj\ndGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VFbnRpdHlMaXN0ZW5l\ncnMKICAgICAgICAoQ2xhc3NNZXRhRGF0YSBtZXRhLCBFbnRpdHlMaXN0ZW5l\ncnMgbGlzdGVuZXJzKSB7CiAgICAgICAgQ2xhc3M8Pz5bXSBjbGFzc2VzID0g\nbGlzdGVuZXJzLnZhbHVlKCk7CiAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/\nPj4gbGlzdGVuZXJDb2xsID0gbnVsbDsKICAgICAgICBDb2xsZWN0aW9uPExp\nZmVjeWNsZUNhbGxiYWNrcz5bXSBwYXJzZWQgPSBudWxsOwogICAgICAgIGZv\nciAoQ2xhc3M8Pz4gY2xzIDogY2xhc3NlcykgewogICAgICAgICAgICBpZiAo\nIV9jb25mLmdldENhbGxiYWNrT3B0aW9uc0luc3RhbmNlKCkuZ2V0QWxsb3dz\nRHVwbGljYXRlTGlzdGVuZXIoKSkgewogICAgICAgICAgICAgICAgaWYgKGxp\nc3RlbmVyQ29sbCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGxpc3Rl\nbmVyQ29sbCA9IG5ldyBBcnJheUxpc3Q8Q2xhc3M8Pz4+KCk7CiAgICAgICAg\nICAgICAgICBpZiAobGlzdGVuZXJDb2xsLmNvbnRhaW5zKGNscykpIAogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgbGlz\ndGVuZXJDb2xsLmFkZChjbHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIAogICAgICAgICAgICBwYXJzZWQgPSBwYXJzZUNhbGxiYWNrTWV0aG9kcyhj\nbHMsIHBhcnNlZCwgdHJ1ZSwgdHJ1ZSwKICAgICAgICAgICAgICAgIGdldFJl\ncG9zaXRvcnkoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZWQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBjYWxsYmFjayBtZXRob2Rz\nIGludG8gdGhlIGdpdmVuIGFycmF5LCBhbmQgcmV0dXJuIHRoYXQgYXJyYXks\nCiAgICAgKiBjcmVhdGluZyBvbmUgaWYgbnVsbC4gRWFjaCBpbmRleCBpbnRv\nIHRoZSBhcnJheSBpcyBhIGNvbGxlY3Rpb24gb2YKICAgICAqIGNhbGxiYWNr\nIGFkYXB0ZXJzIGZvciB0aGF0IG51bWVyaWMgZXZlbnQgdHlwZS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gc3VwcyB3aGV0aGVyIHRvIHNjYW4gc3VwZXJjbGFz\nc2VzCiAgICAgKiBAcGFyYW0gbGlzdGVuZXIgd2hldGhlciB0aGlzIGlzIGEg\nbGlzdGVuZXIgb3Igbm90CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ29s\nbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VDYWxsYmFja01l\ndGhvZHMKICAgICAgICAoQ2xhc3M8Pz4gY2xzLCBDb2xsZWN0aW9uPExpZmVj\neWNsZUNhbGxiYWNrcz5bXSBjYWxsYmFja3MsIGJvb2xlYW4gc3VwcywKICAg\nICAgICBib29sZWFuIGxpc3RlbmVyLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nb3MpIHsKCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICB0\naHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJjbHMgY2Fubm90\nIGJlIG51bGwiKTsKCiAgICAgICAgLy8gZmlyc3Qgc29ydCAvIGZpbHRlciBi\nYXNlZCBvbiBpbmhlcml0YW5jZQogICAgICAgIFNldDxNZXRob2Q+IG1ldGhv\nZHMgPSBuZXcgVHJlZVNldDxNZXRob2Q+KE1ldGhvZENvbXBhcmF0b3IuCiAg\nICAgICAgICAgIGdldEluc3RhbmNlKCkpOwoKICAgICAgICBpbnQgbW9kczsK\nICAgICAgICBDbGFzczw/PiBzdXAgPSBjbHM7CiAgICAgICAgTWV0aG9kS2V5\nIGtleTsKICAgICAgICBTZXQ8TWV0aG9kS2V5PiBzZWVuID0gbmV3IEhhc2hT\nZXQ8TWV0aG9kS2V5PigpOwogICAgICAgIGRvIHsKICAgICAgICAgICAgZm9y\nIChNZXRob2QgbSA6IChNZXRob2RbXSkgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRE\nZWNsYXJlZE1ldGhvZHNBY3Rpb24oc3VwKSkpIHsKICAgICAgICAgICAgICAg\nIG1vZHMgPSBtLmdldE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgaWYg\nKE1vZGlmaWVyLmlzU3RhdGljKG1vZHMpIHx8IE1vZGlmaWVyLmlzRmluYWwo\nbW9kcykgfHwKICAgICAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MuZXF1\nYWxzKG0uZ2V0RGVjbGFyaW5nQ2xhc3MoKSkpCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICAgICAga2V5ID0gbmV3IE1ldGhv\nZEtleShtKTsKICAgICAgICAgICAgICAgIGlmICghc2Vlbi5jb250YWlucyhr\nZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kcy5hZGQobSk7CiAg\nICAgICAgICAgICAgICAgICAgc2Vlbi5hZGQoa2V5KTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzdXAgPSBzdXAuZ2V0\nU3VwZXJjbGFzcygpOwogICAgICAgIH0gd2hpbGUgKHN1cHMgJiYgIU9iamVj\ndC5jbGFzcy5lcXVhbHMoc3VwKSk7CgogICAgICAgIE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYgPSByZXBvcy5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAg\nICAgZm9yIChNZXRob2QgbSA6IG1ldGhvZHMpIHsKICAgICAgICAgICAgZm9y\nIChBbm5vdGF0aW9uIGFubm8gOiAoQW5ub3RhdGlvbltdKSBBY2Nlc3NDb250\ncm9sbGVyCiAgICAgICAgICAgICAgICAuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2\nSGVscGVyCiAgICAgICAgICAgICAgICAgICAgLmdldERlY2xhcmVkQW5ub3Rh\ndGlvbnNBY3Rpb24obSkpKSB7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVRh\nZyB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAg\nICAgICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGludFtdIGV2ZW50cyA9\nIE1ldGFEYXRhUGFyc2Vycy5nZXRFdmVudFR5cGVzKHRhZywgY29uZik7CiAg\nICAgICAgICAgICAgICBpZiAoZXZlbnRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgaWYgKGNhbGxi\nYWNrcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcyA9\nIChDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSkKICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3IENvbGxlY3Rpb25bTGlmZWN5Y2xlRXZlbnQu\nQUxMX0VWRU5UUy5sZW5ndGhdOwoKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgaW50IGUgPSBldmVudHNbaV07CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGNhbGxiYWNrc1tlXSA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICBjYWxsYmFja3NbZV0gPSBuZXcgQXJyYXlMaXN0PExpZmVjeWNs\nZUNhbGxiYWNrcz4oMyk7CiAgICAgICAgICAgICAgICAgICAgTWV0YURhdGFQ\nYXJzZXJzLnZhbGlkYXRlTWV0aG9kc0ZvclNhbWVDYWxsYmFjayhjbHMsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tlXSwgbSwgdGFnLCBj\nb25mLCByZXBvcy5nZXRMb2coKSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNr\nc1tlXS5hZGQobmV3IEJlYW5MaWZlY3ljbGVDYWxsYmFja3MoY2xzLCBtLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpKTsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBj\nYWxsYmFja3NbZV0uYWRkKG5ldyBNZXRob2RMaWZlY3ljbGVDYWxsYmFja3Mo\nbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjYWxsYmFja3M7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTdG9yZSBsaWZlY3ljbGUgbWV0YWRhdGEuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWNvcmRDYWxsYmFja3MoQ2xhc3NN\nZXRhRGF0YSBjbHMsCiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxs\nYmFja3M+W10gY2FsbGJhY2tzLCBpbnRbXSBoaWdocywKICAgICAgICBib29s\nZWFuIHN1cGVyQ2xhc3MpIHsKICAgICAgICBpZiAoY2FsbGJhY2tzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBMaWZlY3ljbGVNZXRh\nRGF0YSBtZXRhID0gY2xzLmdldExpZmVjeWNsZU1ldGFEYXRhKCk7CiAgICAg\nICAgTGlmZWN5Y2xlQ2FsbGJhY2tzW10gYXJyYXk7CiAgICAgICAgZm9yIChp\nbnQgZXZlbnQgOiBMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRTKSB7CiAgICAg\nICAgICAgIGlmIChjYWxsYmFja3NbZXZlbnRdID09IG51bGwpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgYXJyYXkgPSBjYWxsYmFj\na3NbZXZlbnRdLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgTGlmZWN5\nY2xlQ2FsbGJhY2tzW2NhbGxiYWNrc1tldmVudF0uc2l6ZSgpXSk7CgogICAg\nICAgICAgICBpZiAoc3VwZXJDbGFzcykgewogICAgICAgICAgICAgICAgbWV0\nYS5zZXROb25QQ1N1cGVyY2xhc3NDYWxsYmFja3MoZXZlbnQsIGFycmF5LAog\nICAgICAgICAgICAgICAgICAgIChoaWdocyA9PSBudWxsKSA/IDAgOiBoaWdo\nc1tldmVudF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgbWV0YS5zZXREZWNsYXJlZENhbGxiYWNrcyhldmVudCwgYXJyYXksCiAg\nICAgICAgICAgICAgICAgICAgKGhpZ2hzID09IG51bGwpID8gMCA6IGhpZ2hz\nW2V2ZW50XSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgZmV0Y2ggZ3JvdXBzLgogICAgICogSWYgRmV0\nY2hHcm91cCBBIGluY2x1ZGVzIEZldGNoR3JvdXAgQiwgdGhlbiBhIGJpLWxp\nbmsgaXMgc2V0IGJldHdlZW4KICAgICAqIEEgYW5kIEIuIEJvdGggQSBhbmQg\nQiBtdXN0IGJlIGRlY2xhcmVkIGluIHRoZSBzYW1lIENsYXNzLgogICAgICog\nPGJyPgogICAgICogQ2FsbCB7QGxpbmsgI3BhcnNlRmV0Y2hBdHRyaWJ1dGUo\nQ2xhc3NNZXRhRGF0YSwKICAgICAqIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkZldGNoR3JvdXAsIEZldGNoQXR0cmlidXRlKSBvbmx5IGFmdGVyIHRoZQog\nICAgICogYmktbGlua3MgaGF2ZSBiZWVuIGVzdGFibGlzaGVkLCBiZWNhdXNl\nIGEgZmllbGQgZiB3aWxsIG5vdCBvbmx5IGFkZCB0aGUKICAgICAqIGZldGNo\nIGdyb3VwIEEgd2hpY2ggZXhwbGljdGx5IGluY2x1ZGVzIGYgdG8gaXRzIGN1\nc3RvbSBmZXRjaCBncm91cHMgYnV0CiAgICAgKiBhbHNvIHdpbGwgYWxzbyBh\nZGQgYW55IGZldGNoIGdyb3VwIEIgdGhhdCBpbmNsdWRlcyBBLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VGZXRjaEdyb3VwcyhDbGFzc01ldGFE\nYXRhIG1ldGEsIEZldGNoR3JvdXAuLi4gZ3JvdXBzKSB7CiAgICAgICAgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hHcm91cCBmZzsKICAgICAgICBm\nb3IgKEZldGNoR3JvdXAgZ3JvdXAgOiBncm91cHMpIHsKICAgICAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZ3JvdXAubmFtZSgpKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgidW5uYW1lZC1mZyIsIG1ldGEpKTsKCiAgICAgICAgICAgIGZnID0gbWV0\nYS5hZGREZWNsYXJlZEZldGNoR3JvdXAoZ3JvdXAubmFtZSgpKTsKICAgICAg\nICAgICAgaWYgKGdyb3VwLnBvc3RMb2FkKCkpCiAgICAgICAgICAgICAgICBm\nZy5zZXRQb3N0TG9hZCh0cnVlKTsKICAgICAgICAgICAgZm9yIChTdHJpbmcg\ncyA6IGdyb3VwLmZldGNoR3JvdXBzKCkpIHsKICAgICAgICAgICAgICAgIGZn\nLmFkZERlY2xhcmVkSW5jbHVkZShzKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICAvLyBBZGQgdGhlIHBhcmVudC1jaGlsZCBzdHlsZSBiaS1s\naW5rcyBiZXR3ZWVuIGZldGNoIGdyb3VwcyBpbiBhCiAgICAgICAgLy8gc2Vw\nYXJhdGUgcGFzcy4KICAgICAgICBmb3IgKEZldGNoR3JvdXAgZ3JvdXA6Z3Jv\ndXBzKSB7CiAgICAgICAgCWZnID0gbWV0YS5nZXRGZXRjaEdyb3VwKGdyb3Vw\nLm5hbWUoKSk7CiAgICAgICAgCVN0cmluZ1tdIGluY2x1ZGVkRmV0Y2hHcm9w\nTmFtZXMgPSBmZy5nZXREZWNsYXJlZEluY2x1ZGVzKCk7CiAgICAgICAgCWZv\nciAoU3RyaW5nIGluY2x1ZGVkRmVjdGNoR3JvdXBOYW1lOmluY2x1ZGVkRmV0\nY2hHcm9wTmFtZXMpIHsKICAgICAgICAJCW9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkZldGNoR3JvdXAgY2hpbGQgPQogICAgICAgIAkgICAgbWV0YS5nZXRG\nZXRjaEdyb3VwKGluY2x1ZGVkRmVjdGNoR3JvdXBOYW1lKTsKICAgICAgICAJ\nCWlmIChjaGlsZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtaXNzaW5nLWluY2x1ZGVk\nLWZnIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLmdldE5hbWUoKSwgZmcuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZWRGZWN0Y2hHcm91cE5hbWUp\nKTsKICAgICAgICAJCWNoaWxkLmFkZENvbnRhaW5lZEJ5KGZnKTsKICAgICAg\nICAJfQogICAgICAgIH0KCiAgICAgICAgZm9yIChGZXRjaEdyb3VwIGdyb3Vw\nIDogZ3JvdXBzKSB7CiAgICAgICAgICAgIGZnID0gbWV0YS5nZXRGZXRjaEdy\nb3VwKGdyb3VwLm5hbWUoKSk7CiAgICAgICAgICAgIGZvciAoRmV0Y2hBdHRy\naWJ1dGUgYXR0ciA6IGdyb3VwLmF0dHJpYnV0ZXMoKSkKICAgICAgICAgICAg\nICAgIHBhcnNlRmV0Y2hBdHRyaWJ1dGUobWV0YSwgZmcsIGF0dHIpOwogICAg\nICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBTZXQgYSBmaWVsZCdzIGZl\ndGNoIGdyb3VwLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VGZXRj\naEF0dHJpYnV0ZShDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hHcm91cCBmZywgRmV0Y2hBdHRyaWJ1\ndGUgYXR0cikgewogICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQgPSBtZXRh\nLmdldERlY2xhcmVkRmllbGQoYXR0ci5uYW1lKCkpOwogICAgICAgIGlmIChm\naWVsZCA9PSBudWxsCiAgICAgICAgICAgIHx8IGZpZWxkLmdldE1hbmFnZW1l\nbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1mZy1maWVsZCIsIGZnLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nIG1ldGEsIGF0dHIubmFtZSgpKSk7CgogICAgICAgIGZpZWxkLnNldEluRmV0\nY2hHcm91cChmZy5nZXROYW1lKCksIHRydWUpOwogICAgICAgIFNldDxTdHJp\nbmc+IHBhcmVudEZldGNoR3JvdXBzID0gZmcuZ2V0Q29udGFpbmVkQnkoKTsK\nICAgICAgICBmb3IgKE9iamVjdCBwYXJlbnRGZXRjaEdyb3VwIDogcGFyZW50\nRmV0Y2hHcm91cHMpCiAgICAgICAgCWZpZWxkLnNldEluRmV0Y2hHcm91cChw\nYXJlbnRGZXRjaEdyb3VwLnRvU3RyaW5nKCksIHRydWUpOwogICAgICAgIGlm\nIChhdHRyLnJlY3Vyc2lvbkRlcHRoKCkgIT0gSW50ZWdlci5NSU5fVkFMVUUp\nCiAgICAgICAgICAgIGZnLnNldFJlY3Vyc2lvbkRlcHRoKGZpZWxkLCBhdHRy\nLnJlY3Vyc2lvbkRlcHRoKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVh\nZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGdpdmVuIG1lbWJlci4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBsb29rIGZvciBwZXJzaXN0ZW5j\nZSBzdHJhdGVneSBpbiBhbm5vdGF0aW9uIHRhYmxlCiAgICAgICAgTWVtYmVy\nIG1lbWJlciA9IGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3Rvcnko\nKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICBnZXRCYWNraW5nTWVtYmVy\nKGZtZCk7CiAgICAgICAgUGVyc2lzdGVuY2VTdHJhdGVneSBwc3RyYXQgPSBQ\nZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuCiAgICAgICAgICAgIGdldFBl\ncnNpc3RlbmNlU3RyYXRlZ3koZm1kLCBtZW1iZXIpOwogICAgICAgIGlmIChw\nc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZt\nZC5zZXRFeHBsaWNpdCh0cnVlKTsKCiAgICAgICAgQW5ub3RhdGVkRWxlbWVu\ndCBlbCA9IChBbm5vdGF0ZWRFbGVtZW50KSBtZW1iZXI7CiAgICAgICAgYm9v\nbGVhbiBsb2IgPSAoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXIKICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRB\nY3Rpb24oZWwsIExvYi5jbGFzcykpKS5ib29sZWFuVmFsdWUoKTsKICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAgICAgICAgICBzd2l0Y2gg\nKHBzdHJhdCkgewogICAgICAgICAgICAgICAgY2FzZSBCQVNJQzoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZUJhc2ljKGZtZCwgKEJhc2ljKSBlbC5nZXRB\nbm5vdGF0aW9uKEJhc2ljLmNsYXNzKSwgbG9iKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFOWV9PTkU6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VNYW55VG9PbmUoZm1kLCAoTWFueVRv\nT25lKSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAg\nIChNYW55VG9PbmUuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX09ORToKICAgICAgICAgICAg\nICAgICAgICBwYXJzZU9uZVRvT25lKGZtZCwgKE9uZVRvT25lKSBlbC5nZXRB\nbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChPbmVUb09uZS5j\nbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBFTUJFRERFRDoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZUVtYmVkZGVkKGZtZCwgKEVtYmVkZGVkKSBlbC5nZXRBbm5vdGF0aW9uCiAg\nICAgICAgICAgICAgICAgICAgICAgIChFbWJlZGRlZC5jbGFzcykpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBP\nTkVfTUFOWToKICAgICAgICAgICAgICAgICAgICBwYXJzZU9uZVRvTWFueShm\nbWQsIChPbmVUb01hbnkpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAg\nICAgICAgICAgICAgKE9uZVRvTWFueS5jbGFzcykpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQU5ZX01BTlk6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYW55VG9NYW55KGZtZCwgKE1h\nbnlUb01hbnkpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAgICAg\nICAgICAgKE1hbnlUb01hbnkuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZVBlcnNpc3RlbnQoZm1kLCAoUGVyc2lzdGVudCkg\nZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoUGVy\nc2lzdGVudC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBQRVJTX0NPTEw6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VQZXJzaXN0ZW50Q29sbGVjdGlvbihmbWQsIChQZXJzaXN0\nZW50Q29sbGVjdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgZWwuZ2V0\nQW5ub3RhdGlvbihQZXJzaXN0ZW50Q29sbGVjdGlvbi5jbGFzcykpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBF\nTEVNX0NPTEw6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbGVtZW50Q29s\nbGVjdGlvbihmbWQsIChFbGVtZW50Q29sbGVjdGlvbikKICAgICAgICAgICAg\nICAgICAgICAgICAgZWwuZ2V0QW5ub3RhdGlvbihFbGVtZW50Q29sbGVjdGlv\nbi5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBQRVJTX01BUDoKICAgICAgICAgICAgICAgICAgICBw\nYXJzZVBlcnNpc3RlbnRNYXAoZm1kLCAoUGVyc2lzdGVudE1hcCkKICAgICAg\nICAgICAgICAgICAgICAgICAgZWwuZ2V0QW5ub3RhdGlvbihQZXJzaXN0ZW50\nTWFwLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFRSQU5TSUVOVDoKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpc01hcHBpbmdPdmVy\ncmlkZU1vZGUoKSAmJiBsb2IpCiAgICAgICAgICAgIHBhcnNlTG9iTWFwcGlu\nZyhmbWQpOwoKICAgICAgICAvLyBleHRlbnNpb25zCiAgICAgICAgTWV0YURh\ndGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogZWwu\nZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9\nIF90YWdzLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAg\nICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVu\na25vd25NZW1iZXJBbm5vdGF0aW9uKGZtZCwgYW5ubyk7CiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dp\ndGNoICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgQUNDRVNTOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlQWNjZXNzKGZtZCwgKEFjY2Vzcylhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRkxVU0hfTU9ERToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgd2FybkZs\ndXNoTW9kZShmbWQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBHRU5FUkFURURfVkFMVUU6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBwYXJzZUdlbmVyYXRlZFZhbHVlKGZtZCwgKEdl\nbmVyYXRlZFZhbHVlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSUQ6CiAgICAgICAgICAgICAgICBj\nYXNlIEVNQkVEREVEX0lEOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRQ\ncmltYXJ5S2V5KHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBNQVBQRURfQllfSUQ6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VNYXBzSWQoZm1kLCAoTWFwc0lkKWFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBN\nQVBfS0VZOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVy\ncmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBL\nZXkoZm1kLCAoTWFwS2V5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9DTEFTUzoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5Q2xhc3MoZm1k\nLCAoTWFwS2V5Q2xhc3MpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPUkRFUl9CWToKICAgICAgICAg\nICAgICAgICAgICBwYXJzZU9yZGVyQnkoZm1kLAogICAgICAgICAgICAgICAg\nICAgICAgICAoT3JkZXJCeSkgZWwuZ2V0QW5ub3RhdGlvbihPcmRlckJ5LmNs\nYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFNFUV9HRU5FUkFUT1I6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKGVsLCAoU2VxdWVuY2VH\nZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBWRVJTSU9OOgogICAgICAgICAgICAgICAg\nICAgIGZtZC5zZXRWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBERVBFTkRFTlQ6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkgJiYgKChEZXBl\nbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9B\nVVRPKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgRUxFTV9ERVBFTkRFTlQ6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkgJiYgKChFbGVtZW50RGVwZW5kZW50KSBh\nbm5vKS52YWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0\nRWxlbWVudCgpLnNldENhc2NhZGVEZWxldGUKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVM\nRU1fVFlQRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXRUeXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICgoKEVsZW1lbnRUeXBlKSBhbm5vKS52YWx1ZSgp\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEVYVEVSTkFMX1ZBTFM6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZt\nZC5zZXRFeHRlcm5hbFZhbHVlcyhTdHJpbmdzLmpvaW4oKChFeHRlcm5hbFZh\nbHVlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFubm8pLnZhbHVl\nKCksICIsIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFWFRFUk5BTElaRVI6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZC5zZXRFeHRlcm5hbGl6ZXIoKChFeHRlcm5hbGl6ZXIpIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBGQUNUT1JZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBm\nbWQuc2V0RmFjdG9yeSgoKEZhY3RvcnkpIGFubm8pLnZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJ\nTlZFUlNFX0xPR0lDQUw6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRJ\nbnZlcnNlKCgoSW52ZXJzZUxvZ2ljYWwpIGFubm8pLnZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBL\nRVlfREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpICYmICgoS2V5RGVwZW5kZW50KSBhbm5vKS52YWx1ZSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX1RZUEU6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRUeXBlT3ZlcnJpZGUodG9PdmVy\ncmlkZVR5cGUoKChLZXlUeXBlKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBMT0FEX0ZFVENIX0dST1VQOgogICAg\nICAgICAgICAgICAgCWlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuc2V0TG9hZEZldGNoR3JvdXAoKChMb2FkRmV0\nY2hHcm91cCkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAJYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIExSUzoKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZm1kLnNldExSUygoKExSUykgYW5ubykudmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFJF\nQURfT05MWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VSZWFkT25seShm\nbWQsIChSZWFkT25seSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEU6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZtZC5zZXRUeXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUoKChU\neXBlKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl\nKCkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGZt\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBtZW1iZXIgbWFwcGluZyBjb21wb25lbnRzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU1lbWJlck1hcHBpbmdBbm5vdGF0aW9u\ncyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgQENhY2hlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VD\nYWNoZShDbGFzc01ldGFEYXRhIG1ldGEsIENhY2hlYWJsZSBjYWNoZWFibGUp\nIHsKICAgICAgICBtZXRhLnNldENhY2hlRW5hYmxlZChjYWNoZWFibGUudmFs\ndWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2Vz\nIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duTWVtYmVyQW5ub3RhdGlv\nbihGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uIGFubm8p\nIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZXJ0IHRoZSBnaXZlbiBjbGFzcyB0byBpdHMgT3BlbkpQQSB0eXBl\nIG92ZXJyaWRlIGVxdWl2YWxlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIENsYXNzPD8+IHRvT3ZlcnJpZGVUeXBlKENsYXNzPD8+IGNscykgewog\nICAgICAgIHJldHVybiAoY2xzID09IEVudGl0eS5jbGFzcykKICAgICAgICAg\nICAgPyBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNh\ncGFibGUuY2xhc3MgOiBjbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBAUmVhZE9ubHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVJl\nYWRPbmx5KEZpZWxkTWV0YURhdGEgZm1kLCBSZWFkT25seSBybykgewogICAg\nICAgIGlmIChyby52YWx1ZSgpID09IFVwZGF0ZUFjdGlvbi5SRVNUUklDVCkK\nICAgICAgICAgICAgZm1kLnNldFVwZGF0ZVN0cmF0ZWd5KFVwZGF0ZVN0cmF0\nZWdpZXMuUkVTVFJJQ1QpOwogICAgICAgIGVsc2UgaWYgKHJvLnZhbHVlKCkg\nPT0gVXBkYXRlQWN0aW9uLklHTk9SRSkKICAgICAgICAgICAgZm1kLnNldFVw\nZGF0ZVN0cmF0ZWd5KFVwZGF0ZVN0cmF0ZWdpZXMuSUdOT1JFKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbigpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB2YWx1ZSBnZW5lcmF0\naW9uIGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZUdlbmVyYXRlZFZhbHVlKEZpZWxkTWV0\nYURhdGEgZm1kLCBHZW5lcmF0ZWRWYWx1ZSBnZW4pIHsKICAgICAgICBHZW5l\ncmF0aW9uVHlwZSBzdHJhdGVneSA9IGdlbi5zdHJhdGVneSgpOwogICAgICAg\nIFN0cmluZyBnZW5lcmF0b3IgPSBnZW4uZ2VuZXJhdG9yKCk7CiAgICAgICAg\ncGFyc2VHZW5lcmF0ZWRWYWx1ZShmbWQsIHN0cmF0ZWd5LCBnZW5lcmF0b3Ip\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB2YWx1ZSBnZW5lcmF0aW9u\nIGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAg\nIHN0YXRpYyB2b2lkIHBhcnNlR2VuZXJhdGVkVmFsdWUoRmllbGRNZXRhRGF0\nYSBmbWQsIEdlbmVyYXRpb25UeXBlIHN0cmF0ZWd5LAogICAgICAgIFN0cmlu\nZyBnZW5lcmF0b3IpIHsKICAgICAgICBpbnQgc3RyYXQgPSBnZXRHZW5lcmF0\nZWRWYWx1ZVN0cmF0ZWd5KGZtZCwgc3RyYXRlZ3ksIGdlbmVyYXRvcik7CiAg\nICAgICAgaWYgKHN0cmF0ICE9IC0xKQogICAgICAgICAgICBmbWQuc2V0VmFs\ndWVTdHJhdGVneShzdHJhdCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIHN3aXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFC\nTEU6CiAgICAgICAgICAgICAgICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAg\nICAgICAgICAgIC8vIHRlY2huaWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFy\nYXRlIHN5c3RlbSB0YWJsZSBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBz\nZXF1ZW5jZSBnZW5lcmF0b3JzLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCBy\nZWx5IG9uCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcu\nYXBhY2hlLm9wZW5qcGEuU2VxdWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAg\nICAgICAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGdlbmVy\nYXRvcikpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVNl\ncXVlbmNlTmFtZShTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNKTsKICAg\nICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRWYWx1ZVNlcXVlbmNlTmFtZShnZW5lcmF0b3IpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBVVRP\nOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVNlcXVlbmNlTmFt\nZShTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSURFTlRJVFk6\nCiAgICAgICAgICAgICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koVmFs\ndWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oc3RyYXRl\nZ3kudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIHN0cmF0ZWd5IGZv\nciB0aGUgZ2l2ZW4gZ2VuZXJhdG9yLCBvciAtMSBpZiB0aGUKICAgICAqIHN0\ncmF0ZWd5IGRlcGVuZHMgb24gdGhlIDxjb2RlPkdlbmVyYXRpb25UeXBlPC9j\nb2RlPiByYXRoZXIgdGhhbiB0aGUKICAgICAqIGdlbmVyYXRvciBuYW1lLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBpbnQgZ2V0R2VuZXJhdGVkVmFs\ndWVTdHJhdGVneShPYmplY3QgY29udGV4dCwKICAgICAgICBHZW5lcmF0aW9u\nVHlwZSBzdHJhdGVneSwgU3RyaW5nIGdlbmVyYXRvcikgewogICAgICAgIGlm\nIChzdHJhdGVneSAhPSBBVVRPIHx8IFN0cmluZ1V0aWxzLmlzRW1wdHkoZ2Vu\nZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBpZiAo\nR2VuZXJhdG9yLlVVSURfSEVYLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAg\nICAgICByZXR1cm4gVmFsdWVTdHJhdGVnaWVzLlVVSURfSEVYOwogICAgICAg\nIGlmIChHZW5lcmF0b3IuVVVJRF9TVFJJTkcuZXF1YWxzKGdlbmVyYXRvcikp\nCiAgICAgICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9TVFJJ\nTkc7CiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX1RZUEU0X0hFWC5lcXVh\nbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3RyYXRl\nZ2llcy5VVUlEX1RZUEU0X0hFWDsKICAgICAgICBpZiAoR2VuZXJhdG9yLlVV\nSURfVFlQRTRfU1RSSU5HLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAg\nICByZXR1cm4gVmFsdWVTdHJhdGVnaWVzLlVVSURfVFlQRTRfU1RSSU5HOwog\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nZ2VuZXJhdG9yLWJhZC1zdHJhdGVneSIsCiAgICAgICAgICAgIGNvbnRleHQs\nIGdlbmVyYXRvcikpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEJh\nc2ljLiBHaXZlbiBhbm5vdGF0aW9uIG1heSBiZSBudWxsLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VCYXNpYyhGaWVsZE1ldGFEYXRhIGZtZCwg\nQmFzaWMgYW5ubywgYm9vbGVhbiBsb2IpIHsKICAgICAgICBDbGFzczw/PiB0\neXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIGlmIChsb2Ig\nJiYgdHlwZSAhPSBTdHJpbmcuY2xhc3MKICAgICAgICAgICAgJiYgdHlwZSAh\nPSBjaGFyW10uY2xhc3MgJiYgdHlwZSAhPSBDaGFyYWN0ZXJbXS5jbGFzcwog\nICAgICAgICAgICAmJiB0eXBlICE9IGJ5dGVbXS5jbGFzcyAmJiB0eXBlICE9\nIEJ5dGVbXS5jbGFzcykKICAgICAgICAgICAgZm1kLnNldFNlcmlhbGl6ZWQo\ndHJ1ZSk7CiAgICAgICAgZWxzZSBpZiAoIWxvYikgewogICAgICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAg\nICAgICBpZiAoRW51bS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICAvLyBlbHNlIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgog\nICAgICAgICAgICAgICAgICAgIGlmIChTZXJpYWxpemFibGUuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nZm1kLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZm1kLCAiQmFzaWMiKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5BUlJBWToKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSBj\naGFyW10uY2xhc3MgfHwgdHlwZSA9PSBDaGFyYWN0ZXJbXS5jbGFzcwogICAg\nICAgICAgICAgICAgICAgICAgICB8fCB0eXBlID09IGJ5dGVbXS5jbGFzcyB8\nfCB0eXBlID09IEJ5dGVbXS5jbGFzcykKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgaWYgKFNlcmlhbGl6YWJs\nZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tCiAgICAgICAgICAgICAgICAgICAg\nICAgICh0eXBlLmdldENvbXBvbmVudFR5cGUoKSkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5v\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZCwgIkJhc2ljIikp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBpZiAoYW5ubyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAo\nYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYg\nKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5zZXROdWxsVmFs\ndWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBATWFueVRvT25lLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VNYW55VG9PbmUoRmllbGRNZXRhRGF0YSBmbWQsIE1h\nbnlUb09uZSBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwK\nICAgICAgICAgICAgICAgICJNYW55VG9PbmUiKSk7CgogICAgICAgIC8vIGRv\nbid0IHNwZWNpZmljYWxseSBleGNsdWRlIHJlbGF0aW9uIGZyb20gREZHIGIv\nYyB0aGF0IHdpbGwgcHJldmVudAogICAgICAgIC8vIHVzIGZyb20gZXZlbiBy\nZWFkaW5nIHRoZSBmayB3aGVuIHJlYWRpbmcgZnJvbSB0aGUgcHJpbWFyeSB0\nYWJsZSwKICAgICAgICAvLyB3aGljaCBpcyBub3Qgd2hhdCBtb3N0IHVzZXJz\nIHdpbGwgd2FudAogICAgICAgIGlmIChhbm5vLmZldGNoKCkgPT0gRmV0Y2hU\neXBlLkVBR0VSKQogICAgICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hH\ncm91cCh0cnVlKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAg\nICAgICAgICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExf\nRVhDRVBUSU9OKTsKICAgICAgICBpZiAoYW5uby50YXJnZXRFbnRpdHkoKSAh\nPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuc2V0VHlwZU92ZXJyaWRl\nKGFubm8udGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVzKGZt\nZCwgYW5uby5jYXNjYWRlKCkpOwogICAgICAgIGZtZC5zZXRBc3NvY2lhdGlv\nblR5cGUoRmllbGRNZXRhRGF0YS5NQU5ZX1RPX09ORSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAT25lVG9PbmUuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZU9uZVRvT25lKEZpZWxkTWV0YURhdGEgZm1kLCBPbmVU\nb09uZSBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhm\nbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAg\nICAgICAgICAgICAgICJPbmVUb09uZSIpKTsKCiAgICAgICAgLy8gZG9uJ3Qg\nc3BlY2lmaWNhbGx5IGV4Y2x1ZGUgcmVsYXRpb24gZnJvbSBERkcgYi9jIHRo\nYXQgd2lsbCBwcmV2ZW50CiAgICAgICAgLy8gdXMgZnJvbSBldmVuIHJlYWRp\nbmcgdGhlIGZrIHdoZW4gcmVhZGluZyBmcm9tIHRoZSBwcmltYXJ5IHRhYmxl\nLAogICAgICAgIC8vIHdoaWNoIGlzIG5vdCB3aGF0IG1vc3QgdXNlcnMgd2ls\nbCB3YW50CiAgICAgICAgaWYgKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUu\nRUFHRVIpCiAgICAgICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3Vw\nKHRydWUpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQogICAgICAg\nICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9FWENF\nUFRJT04pOwoKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkg\nJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAg\nICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAg\nICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykK\nICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdldEVu\ndGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2Fk\nZSgpKTsKICAgICAgICBzZXRPcnBoYW5SZW1vdmFsKGZtZCwgYW5uby5vcnBo\nYW5SZW1vdmFsKCkpOwogICAgICAgIGZtZC5zZXRBc3NvY2lhdGlvblR5cGUo\nRmllbGRNZXRhRGF0YS5PTkVfVE9fT05FKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBFbWJlZGRlZC4gR2l2ZW4gYW5ub3RhdGlvbiBtYXkgYmUg\nbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRkZWQo\nRmllbGRNZXRhRGF0YSBmbWQsIEVtYmVkZGVkIGFubm8pIHsKICAgICAgICBp\nZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIkVtYmVkZGVk\nIikpOwoKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVl\nKTsKICAgICAgICBmbWQuc2V0RW1iZWRkZWQodHJ1ZSk7CgogICAgICAgIGlm\nIChmbWQuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAg\nICAgIGZtZC5hZGRFbWJlZGRlZE1ldGFEYXRhKGdldEFjY2Vzc0NvZGUoZm1k\nLmdldERlY2xhcmVkVHlwZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBAT25lVG9NYW55LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VPbmVUb01hbnkoRmllbGRNZXRhRGF0YSBmbWQsIE9uZVRvTWFueSBhbm5v\nKSB7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoSmF2YVR5\ncGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1k\nLAogICAgICAgICAgICAgICAgICAgICJPbmVUb01hbnkiKSk7CiAgICAgICAg\nfQoKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZl\ndGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5u\nby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFu\nbm8ubWFwcGVkQnkoKSk7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5\nKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXREZWNsYXJlZFR5cGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5jYXNjYWRl\nKCkpOwogICAgICAgIHNldE9ycGhhblJlbW92YWwoZm1kLmdldEVsZW1lbnQo\nKSwgYW5uby5vcnBoYW5SZW1vdmFsKCkpOwogICAgICAgIGZtZC5zZXRBc3Nv\nY2lhdGlvblR5cGUoRmllbGRNZXRhRGF0YS5PTkVfVE9fTUFOWSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBATWFueVRvTWFueS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRvTWFueShGaWVsZE1ldGFEYXRh\nIGZtZCwgTWFueVRvTWFueSBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1l\nbnQoKSkpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJP\nbmVUb01hbnkiKSk7CiAgICAgICAgfQoKICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VS\nKTsKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAg\nICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAg\naWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5uby50\nYXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVs\nZW1lbnQoKSwgYW5uby5jYXNjYWRlKCkpOwogICAgICAgIGZtZC5zZXRBc3Nv\nY2lhdGlvblR5cGUoRmllbGRNZXRhRGF0YS5NQU5ZX1RPX01BTlkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hcEtleS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlTWFwS2V5KEZpZWxkTWV0YURhdGEgZm1kLCBN\nYXBLZXkgYW5ubykgewogICAgICAgIFN0cmluZyBuYW1lID0gYW5uby5uYW1l\nKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAg\nICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KFZhbHVl\nTWV0YURhdGEuTUFQUEVEX0JZX1BLKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGZtZC5nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KG5hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hcEtleUNsYXNzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYXBLZXlDbGFzcyhGaWVsZE1ldGFE\nYXRhIGZtZCwgTWFwS2V5Q2xhc3MgYW5ubykgewogICAgICAgIGlmIChhbm5v\nLnZhbHVlKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEtl\neSgpLnNldERlY2xhcmVkVHlwZShhbm5vLnZhbHVlKCkpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAiVGhlIHZhbHVlIG9mIHRoZSBNYXBD\nbGFzc0NsYXNzIGNhbm5vdCBiZSBudWxsIik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZSBATWFwc0lkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VNYXBzSWQoRmllbGRNZXRhRGF0YSBmbWQsIE1hcHNJZCBhbm5vKSB7\nCiAgICAgICAgU3RyaW5nIHZhbHVlID0gYW5uby52YWx1ZSgpOwogICAgICAg\nIGlmICh2YWx1ZSAhPSBudWxsKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVk\nQnlJZFZhbHVlKHZhbHVlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZt\nZC5zZXRNYXBwZWRCeUlkVmFsdWUoIiIpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0dXAgdGhlIGZpZWxkIGFzIGEgTE9CIG1hcHBpbmcuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTG9iTWFwcGluZyhGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9yZGVy\nQnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU9yZGVyQnkoRmll\nbGRNZXRhRGF0YSBmbWQsIE9yZGVyQnkgYW5ubykgewogICAgICAgIFN0cmlu\nZyBkZWMgPSBhbm5vLnZhbHVlKCk7CiAgICAgICAgaWYgKGZtZC5pc0VsZW1l\nbnRDb2xsZWN0aW9uKCkgJiYKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgaWYgKGRlYy5sZW5ndGgoKSA9PSAwIHx8IGRlYy5lcXVhbHMoIkFT\nQyIpIHx8CiAgICAgICAgICAgICAgICAgICAgZGVjLmVxdWFscygiREVTQyIp\nKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgImludmFs\naWQtb3JkZXJCeSIsIGZtZCkpOwogICAgICAgIH0KICAgICAgICBpZiAoZGVj\nLmxlbmd0aCgpID09IDAgfHwgZGVjLmVxdWFscygiQVNDIikpCiAgICAgICAg\nICAgIGRlYyA9IE9yZGVyLkVMRU1FTlQgKyAiIGFzYyI7CiAgICAgICAgZWxz\nZSBpZiAoZGVjLmVxdWFscygiREVTQyIpKQogICAgICAgICAgICBkZWMgPSBP\ncmRlci5FTEVNRU5UICsgIiBkZXNjIjsKCiAgICAgICAgZm1kLnNldE9yZGVy\nRGVjbGFyYXRpb24oZGVjKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBQZXJzaXN0ZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQ\nZXJzaXN0ZW50KEZpZWxkTWV0YURhdGEgZm1kLCBQZXJzaXN0ZW50IGFubm8p\nIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGJ5dGVbXS5j\nbGFzcwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSA9PSBCeXRlW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICB8fCBm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAg\nICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgpID09IENoYXJh\nY3RlcltdLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAg\nICAgICAgICAgICJQZXJzaXN0ZW50IikpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAg\nICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwog\nICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2go\nKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmICghYW5uby5vcHRp\nb25hbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0\nYURhdGEuTlVMTF9FWENFUFRJT04pOwogICAgICAgIHNldENhc2NhZGVzKGZt\nZCwgYW5uby5jYXNjYWRlKCkpOwogICAgICAgIGlmIChhbm5vLmVtYmVkZGVk\nKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQu\nZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAg\nICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnQoZW1iZWRkZWQ9dHJ1ZSki\nKSk7CiAgICAgICAgICAgIGZtZC5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAg\nICAgICAgaWYgKGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgZm1kLmFkZEVtYmVkZGVkTWV0YURhdGEoZ2V0\nQWNjZXNzQ29kZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBQ\nZXJzaXN0ZW50Q29sbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlUGVyc2lzdGVudENvbGxlY3Rpb24oRmllbGRNZXRhRGF0YSBmbWQs\nCiAgICAgICAgUGVyc2lzdGVudENvbGxlY3Rpb24gYW5ubykgewogICAgICAg\nIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5B\nUlJBWQogICAgICAgICAgICAmJiBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nICE9IEphdmFUeXBlcy5DT0xMRUNUSU9OKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8i\nLCBmbWQsCiAgICAgICAgICAgICAgICAiUGVyc2lzdGVudENvbGxlY3Rpb24i\nKSk7CgogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1h\ncHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5t\nYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91\ncChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBp\nZiAoYW5uby5lbGVtZW50VHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAg\nICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8uZWxl\nbWVudFR5cGUoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1l\nbnQoKSwgYW5uby5lbGVtZW50Q2FzY2FkZSgpKTsKICAgICAgICBpZiAoYW5u\nby5lbGVtZW50RW1iZWRkZWQoKSkgewogICAgICAgICAgICBpZiAoIUphdmFU\neXBlcy5tYXliZVBDKGZtZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQt\nbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJQZXJzaXN0\nZW50Q29sbGVjdGlvbihlbWJlZGRlZEVsZW1lbnQ9dHJ1ZSkiKSk7CiAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RW1iZWRkZWQodHJ1ZSk7CiAg\nICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmdldEVtYmVkZGVkTWV0\nYURhdGEoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBmbWQuZ2V0RWxl\nbWVudCgpLmFkZEVtYmVkZGVkTWV0YURhdGEoCiAgICAgICAgICAgICAgICAg\nICAgZ2V0QWNjZXNzQ29kZShmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVk\nVHlwZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBARWxlbWVudENvbGxlY3Rpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZUVsZW1lbnRDb2xsZWN0aW9uKEZpZWxk\nTWV0YURhdGEgZm1kLAogICAgICAgIEVsZW1lbnRDb2xsZWN0aW9uIGFubm8p\nIHsKICAgICAgICAvLyBUT0RPOiB0aHJvdyBleGNlcHRpb24gaWYgdGhlIHJ1\nbnRpbWUgZW52IGlzIE9wZW5KcGEgMS54CgogICAgICAgIGlmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5DT0xMRUNUSU9OICYm\nCiAgICAgICAgICAgIGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2\nYVR5cGVzLk1BUCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAg\nICAgICAgICAgIkVsZW1lbnRDb2xsZWN0aW9uIikpOwoKICAgICAgICBpZiAo\nYW5uby50YXJnZXRDbGFzcygpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAg\nIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8udGFyZ2V0\nQ2xhc3MoKSk7CiAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAo\nYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgZm1k\nLnNldEVsZW1lbnRDb2xsZWN0aW9uKHRydWUpOwogICAgICAgIFZhbHVlTWV0\nYURhdGEgZWxlbSA9IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgYm9vbGVh\nbiBpc0VudW0gPSBlbGVtLmdldERlY2xhcmVkVHlwZSgpLmlzRW51bSgpOwog\nICAgICAgIGlmICghaXNFbnVtICYmIEphdmFUeXBlcy5tYXliZVBDKGVsZW0p\nKSB7CiAgICAgICAgICAgIGVsZW0uc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAg\nICAgICAgIGlmIChlbGVtLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgZWxlbS5hZGRFbWJlZGRlZE1ldGFEYXRhKGdl\ndEFjY2Vzc0NvZGUoZWxlbS5nZXREZWNsYXJlZFR5cGUoKSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50TWFw\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQZXJzaXN0ZW50TWFw\nKEZpZWxkTWV0YURhdGEgZm1kLCBQZXJzaXN0ZW50TWFwIGFubm8pIHsKICAg\nICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlw\nZXMuTUFQKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAg\nICAgICAiUGVyc2lzdGVudE1hcCIpKTsKCiAgICAgICAgZm1kLnNldEluRGVm\nYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdF\nUik7CiAgICAgICAgaWYgKGFubm8ua2V5VHlwZSgpICE9IHZvaWQuY2xhc3Mp\nCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXREZWNsYXJlZFR5cGUoYW5u\nby5rZXlUeXBlKCkpOwogICAgICAgIGlmIChhbm5vLmVsZW1lbnRUeXBlKCkg\nIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5z\nZXREZWNsYXJlZFR5cGUoYW5uby5lbGVtZW50VHlwZSgpKTsKICAgICAgICBz\nZXRDYXNjYWRlcyhmbWQuZ2V0S2V5KCksIGFubm8ua2V5Q2FzY2FkZSgpKTsK\nICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmVs\nZW1lbnRDYXNjYWRlKCkpOwogICAgICAgIGlmIChhbm5vLmtleUVtYmVkZGVk\nKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQu\nZ2V0S2V5KCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAg\nICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50TWFwKGVtYmVkZGVkS2V5PXRy\ndWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0RW1iZWRkZWQo\ndHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0S2V5KCkuZ2V0RW1iZWRk\nZWRNZXRhRGF0YSgpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGZtZC5n\nZXRLZXkoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKAogICAgICAgICAgICAgICAg\nICAgIGdldEFjY2Vzc0NvZGUoZm1kLmdldEtleSgpLmdldERlY2xhcmVkVHlw\nZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFu\nbm8uZWxlbWVudEVtYmVkZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZh\nVHlwZXMubWF5YmVQQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lz\ndGVudE1hcChlbWJlZGRlZFZhbHVlPXRydWUpIikpOwogICAgICAgICAgICBm\nbWQuZ2V0RWxlbWVudCgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAg\nICBpZiAoZm1kLmdldEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuYWRk\nRW1iZWRkZWRNZXRhRGF0YSgKICAgICAgICAgICAgICAgICAgICBnZXRBY2Nl\nc3NDb2RlKGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgY2FzY2FkZXMg\nb24gcmVsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRDYXNj\nYWRlcyhWYWx1ZU1ldGFEYXRhIHZtZCwgQ2FzY2FkZVR5cGVbXSBjYXNjYWRl\ncykgewogICAgICAgIGZvciAoQ2FzY2FkZVR5cGUgY2FzY2FkZSA6IGNhc2Nh\nZGVzKSB7CiAgICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBl\nLkFMTCB8fCBjYXNjYWRlID09IENhc2NhZGVUeXBlLlJFTU9WRSkKICAgICAg\nICAgICAgICAgIHZtZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2FzY2FkZSA9\nPSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5Q\nRVJTSVNUKQogICAgICAgICAgICAgICAgdm1kLnNldENhc2NhZGVQZXJzaXN0\nKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAg\nICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9\nPSBDYXNjYWRlVHlwZS5NRVJHRSkKICAgICAgICAgICAgICAgIHZtZC5zZXRD\nYXNjYWRlQXR0YWNoKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUp\nOwogICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwg\nfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5ERVRBQ0gpCiAgICAgICAgICAg\nICAgICB2bWQuc2V0Q2FzY2FkZURldGFjaChWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2Fz\nY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUkVGUkVT\nSCkKICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlUmVmcmVzaChWYWx1\nZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIHNldE9ycGhhblJlbW92YWwoVmFsdWVNZXRh\nRGF0YSB2bWQsIGJvb2xlYW4gb3JwaGFuUmVtb3ZhbCkgewogICAgICAgIGlm\nIChvcnBoYW5SZW1vdmFsKQogICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZURl\nbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAU2VxdWVuY2VHZW5lcmF0b3IuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKEFubm90\nYXRlZEVsZW1lbnQgZWwsCiAgICAgICAgU2VxdWVuY2VHZW5lcmF0b3IgZ2Vu\nKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBnZW4ubmFtZSgpOwogICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNlcS1u\nYW1lIiwgZWwpKTsKCiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2Utc2Vx\ndWVuY2UiLCBuYW1lKSk7CgogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0\nYSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRTZXF1ZW5jZU1ldGFEYXRh\nCiAgICAgICAgICAgIChuYW1lKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHVwLXNlcXVlbmNl\nIiwgbmFtZSwgZWwpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgLy8gY3JlYXRlIG5ldyBzZXF1ZW5jZQogICAgICAgIG1ldGEg\nPSBnZXRSZXBvc2l0b3J5KCkuYWRkU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsK\nICAgICAgICBTdHJpbmcgc2VxID0gZ2VuLnNlcXVlbmNlTmFtZSgpOwogICAg\nICAgIC8vIERvIG5vdCBub3JtYWxpemUgdGhlIHNlcXVlbmNlIG5hbWUgaWYg\naXQgYXBwZWFycyB0byBiZSBhIHBsdWdpbiAKICAgICAgICBpZiAoc2VxLmlu\nZGV4T2YoJygnKSA9PSAtMSl7CiAgICAgICAgICAgIHNlcSA9IG5vcm1hbGl6\nZVNlcXVlbmNlTmFtZShzZXEpOwogICAgICAgIH0KICAgICAgICBpbnQgaW5p\ndGlhbCA9IGdlbi5pbml0aWFsVmFsdWUoKTsKICAgICAgICBpbnQgYWxsb2Nh\ndGUgPSBnZW4uYWxsb2NhdGlvblNpemUoKTsKICAgICAgICBTdHJpbmcgc2No\nZW1hID0gbm9ybWFsaXplU2NoZW1hTmFtZShnZW4uc2NoZW1hKCkpOwogICAg\nICAgIFN0cmluZyBjYXRhbG9nID0gbm9ybWFsaXplQ2F0YWxvZ05hbWUoZ2Vu\nLmNhdGFsb2coKSk7CiAgICAgICAgLy8gZG9uJ3QgYWxsb3cgaW5pdGlhbCBv\nZiAwIGIvYyBsb29rcyBsaWtlIGRlZiB2YWx1ZQogICAgICAgIGlmIChpbml0\naWFsID09IDApCiAgICAgICAgICAgIGluaXRpYWwgPSAxOwoKICAgICAgICAv\nLyBjcmVhdGUgcGx1Z2luIHN0cmluZyBmcm9tIGluZm8KICAgICAgICBTdHJp\nbmcgY2xzTmFtZSwgcHJvcHM7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkoc2VxKSkgewogICAgICAgICAgICBjbHNOYW1lID0gU2VxdWVuY2VN\nZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJvcHMgPSBudWxs\nOwogICAgICAgIH0gZWxzZSBpZiAoc2VxLmluZGV4T2YoJygnKSAhPSAtMSkg\nLy8gcGx1Z2luCiAgICAgICAgewogICAgICAgICAgICBjbHNOYW1lID0gQ29u\nZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKHNlcSk7CiAgICAgICAgICAgIHBy\nb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhzZXEpOwogICAg\nICAgICAgICBzZXEgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIGNsc05hbWUgPSBTZXF1ZW5jZU1ldGFEYXRhLklNUExfTkFUSVZFOwog\nICAgICAgICAgICBwcm9wcyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBt\nZXRhLnNldFNlcXVlbmNlUGx1Z2luKENvbmZpZ3VyYXRpb25zLmdldFBsdWdp\nbihjbHNOYW1lLCBwcm9wcykpOwogICAgICAgIG1ldGEuc2V0U2VxdWVuY2Uo\nc2VxKTsKICAgICAgICBtZXRhLnNldEluaXRpYWxWYWx1ZShpbml0aWFsKTsK\nICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGFsbG9jYXRlKTsKICAgICAgICBt\nZXRhLnNldFNjaGVtYShzY2hlbWEpOwogICAgICAgIG1ldGEuc2V0Q2F0YWxv\nZyhjYXRhbG9nKTsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VG\naWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAg\nICAgICAgICAgU291cmNlVHJhY2tlci5TUkNfQU5OT1RBVElPTlMpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQE5hbWVkUXVlcnkuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZU5hbWVkUXVlcmllcyhBbm5vdGF0ZWRF\nbGVtZW50IGVsLCBOYW1lZFF1ZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBR\ndWVyeU1ldGFEYXRhIG1ldGE7CiAgICAgICAgZm9yIChOYW1lZFF1ZXJ5IHF1\nZXJ5IDogcXVlcmllcykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShxdWVyeS5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1xdWVyeS1uYW1l\nIiwgZWwpKTsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\ncXVlcnkucXVlcnkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXF1ZXJ5LXN0cmluZyIsCiAg\nICAgICAgICAgICAgICAgICAgcXVlcnkubmFtZSgpLCBlbCkpOwoKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBhcnNlLXF1ZXJ5IiwgcXVlcnku\nbmFtZSgpKSk7CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgp\nLnNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5hbWUocXVlcnkubmFtZSgpKTsKICAg\nICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAJQ2xh\nc3M8Pz4gZGVmaW5pbmdUeXBlID0gbWV0YS5nZXREZWZpbmluZ1R5cGUoKTsK\nICAgICAgICAgICAgICAgIGlmICgoZGVmaW5pbmdUeXBlID09IG51bGwgfHwg\nZGVmaW5pbmdUeXBlICE9IF9jbHMpCiAgICAgICAgICAgICAgICAgICYmIF9s\nb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkdXAtcXVlcnkiLCBxdWVyeS5uYW1lKCksIGVs\nLAogICAgICAgICAgICAgICAgICAgIAkJZGVmaW5pbmdUeXBlKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFk\nZFF1ZXJ5TWV0YURhdGEoX2NscywgcXVlcnkubmFtZSgpKTsKICAgICAgICAg\nICAgbWV0YS5zZXRRdWVyeVN0cmluZyhxdWVyeS5xdWVyeSgpKTsKICAgICAg\nICAgICAgbWV0YS5zZXRMYW5ndWFnZShKUFFMUGFyc2VyLkxBTkdfSlBRTCk7\nCiAgICAgICAgICAgIGZvciAoUXVlcnlIaW50IGhpbnQgOiBxdWVyeS5oaW50\ncygpKQogICAgICAgICAgICAgICAgbWV0YS5hZGRIaW50KGhpbnQubmFtZSgp\nLCBoaW50LnZhbHVlKCkpOwogICAgICAgICAgICBpZiAocXVlcnkubG9ja01v\nZGUoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBtZXRhLmFkZEhpbnQo\nIm9wZW5qcGEuRmV0Y2hQbGFuLlJlYWRMb2NrTW9kZSIsIHF1ZXJ5LmxvY2tN\nb2RlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1ldGEuc2V0U291\ncmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGluc3RhbmNlb2YgQ2xhc3MpID8g\nZWwgOiBudWxsLAogICAgICAgICAgICAgICAgU291cmNlVHJhY2tlci5TUkNf\nQU5OT1RBVElPTlMpOwogICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01F\nVEEpOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdNb2RlKCkpCiAg\nICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5H\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0YS5zZXRT\nb3VyY2VNb2RlKE1PREVfUVVFUlkpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBOYW1lZE5hdGl2ZVF1ZXJ5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMoQW5ub3Rh\ndGVkRWxlbWVudCBlbCwKICAgICAgICBOYW1lZE5hdGl2ZVF1ZXJ5Li4uIHF1\nZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7CiAgICAgICAg\nZm9yIChOYW1lZE5hdGl2ZVF1ZXJ5IHF1ZXJ5IDogcXVlcmllcykgewogICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVyeS5uYW1lKCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnktbmFtZSIsCiAgICAgICAgICAg\nICAgICAgICAgZWwpKTsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hdGl2ZS1xdWVy\neS1zdHJpbmciLAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5Lm5hbWUoKSwg\nZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1u\nYXRpdmUtcXVlcnkiLCBxdWVyeS5uYW1lKCkpKTsKCiAgICAgICAgICAgIG1l\ndGEgPSBnZXRSZXBvc2l0b3J5KCkuc2VhcmNoUXVlcnlNZXRhRGF0YUJ5TmFt\nZShxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBpZiAobWV0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIAlDbGFzczw/PiBkZWZUeXBlID0gbWV0YS5nZXRE\nZWZpbmluZ1R5cGUoKTsKICAgICAgICAgICAgICAgIGlmICgoZGVmVHlwZSAh\nPSBfY2xzKSAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHVwLXF1ZXJ5IiwgcXVl\ncnkubmFtZSgpLCBlbCwgZGVmVHlwZSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRhRGF0\nYShudWxsLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNldFF1\nZXJ5U3RyaW5nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRhLnNl\ndExhbmd1YWdlKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMKTsKICAgICAgICAg\nICAgQ2xhc3M8Pz4gcmVzID0gcXVlcnkucmVzdWx0Q2xhc3MoKTsKICAgICAg\nICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRDb25maWd1\ncmF0aW9uKCksIHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldENhbmRp\nZGF0ZVR5cGUocmVzKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXZvaWQuY2xh\nc3MuZXF1YWxzKHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldFJlc3Vs\ndFR5cGUocmVzKTsKCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShxdWVyeS5yZXN1bHRTZXRNYXBwaW5nKCkpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRSZXN1bHRTZXRNYXBwaW5nTmFtZShxdWVyeS5yZXN1bHRT\nZXRNYXBwaW5nKCkpOwogICAgICAgICAgICBmb3IgKFF1ZXJ5SGludCBoaW50\nIDogcXVlcnkuaGludHMoKSkKICAgICAgICAgICAgICAgIG1ldGEuYWRkSGlu\ndChoaW50Lm5hbWUoKSwgaGludC52YWx1ZSgpKTsKCiAgICAgICAgICAgIG1l\ndGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGluc3RhbmNlb2Yg\nQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICAgICAgU291cmNlVHJh\nY2tlci5TUkNfQU5OT1RBVElPTlMpOwogICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9k\nZShNT0RFX01FVEEpOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdN\nb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9E\nRV9NQVBQSU5HKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfUVVFUlkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZXhwbGljaXQgYWNjZXNzIHR5\ncGUsIGlmIHNwZWNpZmllZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlQWNjZXNzKEZpZWxkTWV0YURhdGEgbWV0YSwgQWNjZXNzIGFjY2Vzcykg\newogICAgCWlmIChhY2Nlc3MgIT0gbnVsbCkgewogICAgCQltZXRhLnNldEFj\nY2Vzc1R5cGUoQWNjZXNzQ29kZS5FWFBMSUNJVAogICAgICAgICAgICB8IChh\nY2Nlc3MudmFsdWUoKSA9PSBBY2Nlc3NUeXBlLkZJRUxEID8KICAgICAgICAg\nICAgCQlBY2Nlc3NDb2RlLkZJRUxEIDogQWNjZXNzQ29kZS5QUk9QRVJUWSkp\nOwogICAgCX0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNZXRo\nb2RLZXkgewoKICAgICAgICBwcml2YXRlIGZpbmFsIE1ldGhvZCBfbWV0aG9k\nOwoKICAgICAgICBwdWJsaWMgTWV0aG9kS2V5KE1ldGhvZCBtKSB7CiAgICAg\nICAgICAgIF9tZXRob2QgPSBtOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgaW50IGNvZGUgPSA0NiAq\nIDEyICsgX21ldGhvZC5nZXROYW1lKCkuaGFzaENvZGUoKTsKICAgICAgICAg\nICAgZm9yIChDbGFzczw/PiBwYXJhbSA6IF9tZXRob2QuZ2V0UGFyYW1ldGVy\nVHlwZXMoKSkKICAgICAgICAgICAgICAgIGNvZGUgPSA0NiAqIGNvZGUgKyBw\nYXJhbS5oYXNoQ29kZSgpOwogICAgICAgICAgICByZXR1cm4gY29kZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nbykgewogICAgICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgTWV0aG9kS2V5\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nTWV0aG9kIG90aGVyID0gKChNZXRob2RLZXkpIG8pLl9tZXRob2Q7CiAgICAg\nICAgICAgIGlmICghX21ldGhvZC5nZXROYW1lKCkuZXF1YWxzKG90aGVyLmdl\ndE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIHJldHVybiBBcnJheXMuZXF1YWxzKF9tZXRob2QuZ2V0UGFyYW1l\ndGVyVHlwZXMoKSwKICAgICAgICAgICAgICAgIG90aGVyLmdldFBhcmFtZXRl\nclR5cGVzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBjbGFzcyBNZXRob2RDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRv\ncjxNZXRob2Q+IHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgTWV0aG9kQ29t\ncGFyYXRvciBJTlNUQU5DRSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBzdGF0\naWMgTWV0aG9kQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsKICAgICAgICAg\nICAgaWYgKElOU1RBTkNFID09IG51bGwpCiAgICAgICAgICAgICAgICBJTlNU\nQU5DRSA9IG5ldyBNZXRob2RDb21wYXJhdG9yKCk7CiAgICAgICAgICAgIHJl\ndHVybiBJTlNUQU5DRTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQg\nY29tcGFyZShNZXRob2QgbTEsIE1ldGhvZCBtMikgewogICAgICAgICAgICBD\nbGFzczw/PiBjMSA9IG0xLmdldERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAg\nICAgIENsYXNzPD8+IGMyID0gbTIuZ2V0RGVjbGFyaW5nQ2xhc3MoKTsKICAg\nICAgICAgICAgaWYgKCFjMS5lcXVhbHMoYzIpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoYzEuaXNBc3NpZ25hYmxlRnJvbShjMikpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgZWxzZQoJCQkJCXJl\ndHVybiAxOwoJCQl9CgkJCWludCBjb21wYXJlID0gbTEuZ2V0TmFtZSAoKS5j\nb21wYXJlVG8gKG0yLmdldE5hbWUgKCkpOwoJCQlpZiAoY29tcGFyZSA9PSAw\nKQoJCQkJcmV0dXJuIG0xLmhhc2hDb2RlICgpIC0gbTIuaGFzaENvZGUgKCk7\nCgkJCXJldHVybiBjb21wYXJlOwoJCX0KCX0KCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIG5vcm1hbGl6ZVNlcXVlbmNlTmFtZShTdHJpbmcgc2VxTmFtZSkgewog\nICAgICAgIHJldHVybiBzZXFOYW1lOwogICAgfQoKICAgIHByb3RlY3RlZCBT\ndHJpbmcgbm9ybWFsaXplU2NoZW1hTmFtZShTdHJpbmcgc2NoTmFtZSkgewog\nICAgICAgIHJldHVybiBzY2hOYW1lOwogICAgfQoKICAgIHByb3RlY3RlZCBT\ndHJpbmcgbm9ybWFsaXplQ2F0YWxvZ05hbWUoU3RyaW5nIGNhdE5hbWUpIHsK\nICAgICAgICByZXR1cm4gY2F0TmFtZTsKICAgIH0KfQoK\n","encoding":"base64"}

