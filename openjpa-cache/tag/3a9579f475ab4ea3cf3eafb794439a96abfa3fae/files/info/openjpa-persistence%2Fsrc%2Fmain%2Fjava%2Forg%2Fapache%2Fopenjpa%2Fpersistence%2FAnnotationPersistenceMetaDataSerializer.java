{"sha":"d27742eac8e726b7bc03fd09c5613f95c52343d1","node_id":"MDQ6QmxvYjIwNjM2NDpkMjc3NDJlYWM4ZTcyNmI3YmMwM2ZkMDljNTYxM2Y5NWM1MjM0M2Qx","size":51006,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d27742eac8e726b7bc03fd09c5613f95c52343d1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSmF2YVZl\ncnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQ\nQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS4qOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxh\nbmd1YWdlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVy\nbmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CgppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLio7CmltcG9ydCBqYXZhLmlv\nLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5pby5Xcml0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGVXcml0ZXI7CmltcG9y\ndCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBqYXZhLmxhbmcu\ncmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhv\nZDsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkFubm90YXRpb247Cgpp\nbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRW50aXR5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRk\nYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xh\nc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5JZENsYXNz\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRkZWRJZDsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlZlcnNpb247CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5UcmFuc2llbnQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5C\nYXNpYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGVkOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5PbmVUb01hbnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9N\nYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT3JkZXJCeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkF0dHJpYnV0ZU92ZXJyaWRlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5G\nZXRjaFR5cGU7CgovL0B0b2RvOiBqYXZhZG9jcwoKLyoqCiAqIFNlcmlhbGl6\nZXMgcGVyc2lzdGVuY2UgbWV0YWRhdGEgYXMgYW5ub3RhdGlvbnMuCiAqIFRo\naXMgY2xhc3MgcHJvY2Vzc2VzIGFsbCBvYmplY3QgbGV2ZWwgdGFncyB0aGF0\nIGFyZSBzdG9yZS1hZ25vc3RpYy4KICogSG93ZXZlciwgaXQgcHJvdmlkZXMg\naG9va3MgZm9yIHRoZSBzdWJjbGFzc2VzIHRvIGluY2x1ZGUgc3RvcmUtc3Bl\nY2lmaWMKICogdGFncyB0byBiZSBzZXJpYWxpemVkIGJvdGggYXQgJmx0O2Vu\ndGl0eS1tYXBwaW5ncyZndDsgYW5kCiAqICZsdDtlbnRpdHkmZ3Q7IGxldmVs\nLgogKgogKiBAc2luY2UgMS4wLjAKICogQGF1dGhvciBTdGV2ZSBLaW0KICog\nQGF1dGhvciBHb2toYW4gRXJndWwKICogQG5vamF2YWRvYwogKi8KcHVibGlj\nIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXpl\ncgogICAgaW1wbGVtZW50cyBQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeS5T\nZXJpYWxpemVyIHsKCiAgICAvLyBOT1RFOiBvcmRlciBpcyBpbXBvcnRhbnQh\nIHRoZXNlIGNvbnN0YW50cyBtdXN0IGJlIG1haW50YWluZWQgaW4KICAgIC8v\nIHNlcmlhbGl6YXRpb24gb3JkZXIuIGNvbnN0YW50cyBhcmUgc3BhY2VkIHNv\nIHRoYXQgc3ViY2xhc3NlcyBjYW4KICAgIC8vIHNsaXAgdGFncyBpbi1iZXR3\nZWVuCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBFX1NFUSA9\nIDEwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9RVUVS\nWSA9IDIwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9N\nRVRBID0gMzA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBF\nX0NMQVNTX1NFUVMgPSA0MDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFRZUEVfQ0xBU1NfUVVFUklFUyA9IDUwOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFTZXJp\nYWxpemVyLmNsYXNzKTsKCiAgICBwcml2YXRlIExvZyBfbG9nID0gbnVsbDsK\nICAgIAogICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmlndXJhdGlvbiBf\nY29uZjsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgQ2xhc3NNZXRhRGF0YT4g\nX21ldGFzID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgTGlzdD4g\nX3F1ZXJpZXMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBMaXN0\nPiBfc2VxcyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1ldGFE\nYXRhTW9kZXMuTU9ERV9OT05FOwogICAgcHJpdmF0ZSBTZXJpYWxpemF0aW9u\nQ29tcGFyYXRvciBfY29tcCA9IG51bGw7CgogICAgcHJpdmF0ZSBNYXA8Q2xh\nc3NNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+IF9jbHNBbm5v\ncyA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxGaWVsZE1ldGFEYXRhLCBMaXN0\nPEFubm90YXRpb25CdWlsZGVyPj4gX2ZsZEFubm9zID0gbnVsbDsKICAgIHBy\naXZhdGUgTWFwPFNlcXVlbmNlTWV0YURhdGEsIExpc3Q8QW5ub3RhdGlvbkJ1\naWxkZXI+PiBfc2VxQW5ub3MgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8UXVl\ncnlNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+IF9xcnlBbm5v\ncyA9IG51bGw7IAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgQW5ub3RhdGlv\nblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyKE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAg\nc2V0TG9nKGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19N\nRVRBREFUQSkpOwogICAgICAgIHNldE1vZGUoTWV0YURhdGFNb2Rlcy5NT0RF\nX01FVEEgfCBNZXRhRGF0YU1vZGVzLk1PREVfTUFQUElORyB8CiAgICAgICAg\nICAgIE1ldGFEYXRhTW9kZXMuTU9ERV9RVUVSWSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbG9n\nIHRvIHdyaXRlIHRvLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygp\nIHsKICAgICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBsb2cgdG8gd3JpdGUgdG8uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldExvZyhMb2cgbG9nKSB7CiAgICAgICAgX2xvZyA9IGxvZzsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBUaGUgc2VyaWFsaXphdGlvbiBtb2RlIGFj\nY29yZGluZyB0byB0aGUgZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4gVGhlCiAg\nICAgKiBtb2RlIGNvbnN0YW50cyBhY3QgYXMgYml0IGZsYWdzLCBhbmQgdGhl\ncmVmb3JlIGNhbiBiZSBjb21iaW5lZC4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRNb2RlKCkgewogICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBzZXJpYWxpemF0aW9uIG1vZGUgYWNjb3JkaW5n\nIHRvIHRoZSBleHBlY3RlZCBkb2N1bWVudCB0eXBlLiBUaGUKICAgICAqIG1v\nZGUgY29uc3RhbnRzIGFjdCBhcyBiaXQgZmxhZ3MsIGFuZCB0aGVyZWZvcmUg\nY2FuIGJlIGNvbWJpbmVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRN\nb2RlKGludCBtb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNlcmlhbGl6YXRpb24gbW9kZSBhY2NvcmRp\nbmcgdG8gdGhlIGV4cGVjdGVkIGRvY3VtZW50IHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldE1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsK\nICAgICAgICBpZiAobW9kZSA9PSBNZXRhRGF0YU1vZGVzLk1PREVfTk9ORSkK\nICAgICAgICAgICAgc2V0TW9kZShNZXRhRGF0YU1vZGVzLk1PREVfTk9ORSk7\nCiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIHNldE1vZGUoX21v\nZGUgfCBtb2RlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldE1vZGUo\nX21vZGUgJiB+bW9kZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5N\nT0RFX01FVEEpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1ZXJ5TW9kZSgp\nIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5NT0RF\nX1FVRVJZKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVu\nY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgp\nIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5NT0RF\nX01BUFBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLiBUYWtlcyBpbnRvCiAgICAgKiBhY2NvdW50IHdoZXRoZXIgbWFwcGluZyBp\nbmZvcm1hdGlvbiBpcyBsb2FkZWQgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqIE9QRU5KUEEtMTM2MCAtIEFsbG93IEBDb2x1bW4gYXR0cmlidXRl\ncyB3aGVuIG1ldGEuaXNFbWJlZGRlZE9ubHkoKQogICAgICovCiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdNb2RlKENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIHJldHVybiBpc01hcHBpbmdNb2RlKCkgJiYgKG1ldGEu\nZ2V0U291cmNlTW9kZSgpCiAgICAgICAgICAgICYgTWV0YURhdGFNb2Rlcy5N\nT0RFX01BUFBJTkcpICE9IDAKICAgICAgICAgICAgJiYgKG1ldGEuZ2V0RW1i\nZWRkaW5nTWV0YURhdGEoKSA9PSBudWxsCiAgICAgICAgICAgIHx8IGlzTWFw\ncGluZ01vZGUobWV0YS5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIGludGVy\ncHJldGluZyB7QGxpbmsgI2dldE1vZGV9LiBUYWtlcyBpbnRvCiAgICAgKiBh\nY2NvdW50IHdoZXRoZXIgbWFwcGluZyBpbmZvcm1hdGlvbiBpcyBsb2FkZWQg\nZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGJvb2xlYW4gaXNNYXBwaW5nTW9kZShWYWx1ZU1ldGFEYXRhIHZtZCkgewog\nICAgICAgIHJldHVybiBpc01hcHBpbmdNb2RlKHZtZC5nZXRGaWVsZE1ldGFE\nYXRhKCkuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCBhIGNsYXNzIG1ldGEgZGF0YSB0byB0aGUgc2V0IHRvIGJl\nIHNlcmlhbGl6ZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZE1ldGFE\nYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9tZXRh\ncyA9PSBudWxsKQogICAgICAgICAgICBfbWV0YXMgPSBuZXcgSGFzaE1hcDxT\ndHJpbmcsIENsYXNzTWV0YURhdGE+KCk7CiAgICAgICAgX21ldGFzLnB1dCht\nZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCksIG1ldGEpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkIGEgc2VxdWVuY2UgbWV0YSBkYXRhIHRv\nIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgYWRkU2VxdWVuY2VNZXRhRGF0YShTZXF1ZW5jZU1ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIExpc3Qgc2VxcyA9IG51bGw7CiAgICAgICAgU3Ry\naW5nIGRlZk5hbWUgPSBudWxsOwogICAgICAgIGlmIChtZXRhLmdldFNvdXJj\nZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykKICAgICAgICAgICAgZGVmTmFt\nZSA9ICgoQ2xhc3MpIG1ldGEuZ2V0U291cmNlU2NvcGUoKSkuZ2V0TmFtZSgp\nOwogICAgICAgIGlmIChfc2VxcyA9PSBudWxsKQogICAgICAgICAgICBfc2Vx\ncyA9IG5ldyBIYXNoTWFwPFN0cmluZywgTGlzdD4oKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHNlcXMgPSBfc2Vxcy5nZXQoZGVmTmFtZSk7CgogICAg\nICAgIGlmIChzZXFzID09IG51bGwpIHsKICAgICAgICAgICAgc2VxcyA9IG5l\ndyBBcnJheUxpc3QoMyk7IC8vIGRvbid0IGV4cGVjdCBtYW55IHNlcXMgLyBj\nbGFzcwogICAgICAgICAgICBzZXFzLmFkZChtZXRhKTsKICAgICAgICAgICAg\nX3NlcXMucHV0KGRlZk5hbWUsIHNlcXMpOwogICAgICAgIH0gZWxzZSBpZiAo\nIXNlcXMuY29udGFpbnMobWV0YSkpCiAgICAgICAgICAgIHNlcXMuYWRkKG1l\ndGEpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgcXVlcnkgbWV0YSBk\nYXRhIHRvIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgYWRkUXVlcnlNZXRhRGF0YShRdWVyeU1ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIExpc3QgcXVlcmllcyA9IG51bGw7CiAgICAgICAg\nU3RyaW5nIGRlZk5hbWUgPSBudWxsOwogICAgICAgIGlmIChtZXRhLmdldFNv\ndXJjZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykKICAgICAgICAgICAgZGVm\nTmFtZSA9ICgoQ2xhc3MpIG1ldGEuZ2V0U291cmNlU2NvcGUoKSkuZ2V0TmFt\nZSgpOwogICAgICAgIGlmIChfcXVlcmllcyA9PSBudWxsKQogICAgICAgICAg\nICBfcXVlcmllcyA9IG5ldyBIYXNoTWFwPFN0cmluZywgTGlzdD4oKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHF1ZXJpZXMgPSBfcXVlcmllcy5nZXQo\nZGVmTmFtZSk7CgogICAgICAgIGlmIChxdWVyaWVzID09IG51bGwpIHsKICAg\nICAgICAgICAgcXVlcmllcyA9IG5ldyBBcnJheUxpc3QoMyk7IC8vIGRvbid0\nIGV4cGVjdCBtYW55IHF1ZXJpZXMgLyBjbGFzcwogICAgICAgICAgICBxdWVy\naWVzLmFkZChtZXRhKTsKICAgICAgICAgICAgX3F1ZXJpZXMucHV0KGRlZk5h\nbWUsIHF1ZXJpZXMpOwogICAgICAgIH0gZWxzZSBpZiAoIXF1ZXJpZXMuY29u\ndGFpbnMobWV0YSkpCiAgICAgICAgICAgIHF1ZXJpZXMuYWRkKG1ldGEpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGFsbCBjb21wb25lbnRzIGluIHRo\nZSBnaXZlbiByZXBvc2l0b3J5IHRvIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXpl\nZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkQWxsKE1ldGFEYXRhUmVw\nb3NpdG9yeSByZXBvcykgewogICAgICAgIGlmIChyZXBvcyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGZvciAoQ2xhc3NNZXRhRGF0\nYSBtZXRhIDogcmVwb3MuZ2V0TWV0YURhdGFzKCkpCiAgICAgICAgICAgIGFk\nZE1ldGFEYXRhKG1ldGEpOwogICAgICAgIGZvciAoU2VxdWVuY2VNZXRhRGF0\nYSBzZXEgOiByZXBvcy5nZXRTZXF1ZW5jZU1ldGFEYXRhcygpKQogICAgICAg\nICAgICBhZGRTZXF1ZW5jZU1ldGFEYXRhKHNlcSk7CiAgICAgICAgZm9yIChR\ndWVyeU1ldGFEYXRhIHF1ZXJ5IDogcmVwb3MuZ2V0UXVlcnlNZXRhRGF0YXMo\nKSkKICAgICAgICAgICAgYWRkUXVlcnlNZXRhRGF0YShxdWVyeSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBtZXRhZGF0YSBmcm9tIHRoZSBz\nZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHNldAogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiByZW1vdmVNZXRhRGF0YShDbGFzc01ldGFEYXRh\nIG1ldGEpIHsKICAgICAgICByZXR1cm4gX21ldGFzICE9IG51bGwgJiYgbWV0\nYSAhPSBudWxsCiAgICAgICAgICAgICYmIF9tZXRhcy5yZW1vdmUobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSAhPSBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVtb3ZlIGEgc2VxdWVuY2UgbWV0YWRhdGEgZnJv\nbSB0aGUgc2V0IHRvIGJlIHNlcmlhbGl6ZWQuCiAgICAgKgogICAgICogQHJl\ndHVybiB0cnVlIGlmIHJlbW92ZWQsIGZhbHNlIGlmIG5vdCBpbiBzZXQKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlU2VxdWVuY2VNZXRhRGF0\nYShTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoX3NlcXMg\nPT0gbnVsbCB8fCBtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAg\naWYgKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQog\nICAgICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VT\nY29wZSgpKS5nZXROYW1lKCk7CiAgICAgICAgTGlzdCBzZXFzID0gX3NlcXMu\nZ2V0KGRlZk5hbWUpOwogICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXNlcXMucmVtb3Zl\nKG1ldGEpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYg\nKHNlcXMuaXNFbXB0eSgpKQogICAgICAgICAgICBfc2Vxcy5yZW1vdmUoZGVm\nTmFtZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZW1vdmUgYSBxdWVyeSBtZXRhZGF0YSBmcm9tIHRoZSBzZXQgdG8g\nYmUgc2VyaWFsaXplZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\ncmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHNldAogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVRdWVyeU1ldGFEYXRhKFF1ZXJ5TWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmIChfcXVlcmllcyA9PSBudWxsIHx8IG1ldGEg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIFN0\ncmluZyBkZWZOYW1lID0gbnVsbDsKICAgICAgICBpZiAobWV0YS5nZXRTb3Vy\nY2VTY29wZSgpIGluc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAgIGRlZk5h\nbWUgPSAoKENsYXNzKSBtZXRhLmdldFNvdXJjZVNjb3BlKCkpLmdldE5hbWUo\nKTsKICAgICAgICBMaXN0IHF1ZXJpZXMgPSBfcXVlcmllcy5nZXQoZGVmTmFt\nZSk7CiAgICAgICAgaWYgKHF1ZXJpZXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghcXVlcmllcy5yZW1vdmUobWV0\nYSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAocXVl\ncmllcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIF9xdWVyaWVzLnJlbW92ZShk\nZWZOYW1lKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSBhbGwgdGhlIGNvbXBvbmVudHMgaW4gdGhlIGdpdmVu\nIHJlcG9zaXRvcnkgZnJvbSB0aGUgc2V0IHRvIGJlCiAgICAgKiBzZXJpYWxp\nemVkLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhbnkgY29tcG9u\nZW50cyByZW1vdmVkLCBmYWxzZSBpZiBub25lIGluIHNldAogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiByZW1vdmVBbGwoTWV0YURhdGFSZXBvc2l0b3J5\nIHJlcG9zKSB7CiAgICAgICAgaWYgKHJlcG9zID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgYm9vbGVhbiByZW1vdmVkID0g\nZmFsc2U7CiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gcmVwb3Mu\nZ2V0TWV0YURhdGFzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBt\nZXRhcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgcmVtb3ZlZCB8PSByZW1v\ndmVNZXRhRGF0YShtZXRhc1tpXSk7CiAgICAgICAgU2VxdWVuY2VNZXRhRGF0\nYVtdIHNlcXMgPSByZXBvcy5nZXRTZXF1ZW5jZU1ldGFEYXRhcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2Vxcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgcmVtb3ZlZCB8PSByZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKHNl\ncXNbaV0pOwogICAgICAgIFF1ZXJ5TWV0YURhdGFbXSBxdWVyaWVzID0gcmVw\nb3MuZ2V0UXVlcnlNZXRhRGF0YXMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHF1ZXJpZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHJlbW92\nZWQgfD0gcmVtb3ZlUXVlcnlNZXRhRGF0YShxdWVyaWVzW2ldKTsKICAgICAg\nICByZXR1cm4gcmVtb3ZlZDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFy\nIHRoZSBzZXQgb2YgbWV0YWRhdGFzIHRvIGJlIHNlcmlhbGl6ZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgIGlmIChfbWV0\nYXMgIT0gbnVsbCkKICAgICAgICAgICAgX21ldGFzLmNsZWFyKCk7CiAgICAg\nICAgaWYgKF9zZXFzICE9IG51bGwpCiAgICAgICAgICAgIF9zZXFzLmNsZWFy\nKCk7CiAgICAgICAgaWYgKF9xdWVyaWVzICE9IG51bGwpCiAgICAgICAgICAg\nIF9xdWVyaWVzLmNsZWFyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\nc3lzdGVtLWxldmVsIG1hcHBpbmcgZWxlbWVudHMgdG8gYmUgc2VyaWFsaXpl\nZC4gRG9lcyBub3RoaW5nCiAgICAgKiBieSBkZWZhdWx0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBhZGRTeXN0ZW1NYXBwaW5nRWxlbWVudHMoQ29s\nbGVjdGlvbiB0b1NlcmlhbGl6ZSkgewogICAgfQoKICAgIC8qKgogICAgICog\nU29ydCB0aGUgZ2l2ZW4gY29sbGVjdGlvbiBvZiBvYmplY3RzIHRvIGJlIHNl\ncmlhbGl6ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxpemF0\naW9uU29ydChMaXN0IG9ianMpIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxs\nIHx8IG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgaWYgKF9jb21wID09IG51bGwpCiAgICAgICAgICAgIF9jb21wID0gbmV3\nU2VyaWFsaXphdGlvbkNvbXBhcmF0b3IoKTsKICAgICAgICBDb2xsZWN0aW9u\ncy5zb3J0KG9ianMsIF9jb21wKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBjb21wYXJhdG9yIGZvciBvcmRlcmluZyBvYmplY3RzIHRo\nYXQgYXJlIHRvIGJlIHNlcmlhbGl6ZWQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBTZXJpYWxpemF0aW9uQ29tcGFyYXRvciBuZXdTZXJpYWxpemF0aW9uQ29t\ncGFyYXRvcigpIHsKICAgICAgICByZXR1cm4gX2NvbXA7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgc2VxdWVuY2UgbWV0YWRhdGEgdG8gdGhlIGdpdmVu\nIG1ldGFkYXRhcyBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkU2VxdWVuY2VNZXRhRGF0YXMoQ29sbGVjdGlvbiBhbGwpIHsKICAg\nICAgICBpZiAoX3NlcXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBmb3IgKE1hcC5FbnRyeSBlbnRyeSA6IF9zZXFzLmVudHJ5U2V0\nKCkpIHsKICAgICAgICAgICAgaWYgKGVudHJ5LmdldEtleSgpID09IG51bGwp\nCiAgICAgICAgICAgICAgICBhbGwuYWRkQWxsKChMaXN0KSBlbnRyeS5nZXRW\nYWx1ZSgpKTsKICAgICAgICAgICAgZWxzZSBpZiAoX21ldGFzID09IG51bGwg\nfHwgIV9tZXRhcy5jb250YWluc0tleShlbnRyeS5nZXRLZXkoKSkpCiAgICAg\nICAgICAgICAgICBhbGwuYWRkKG5ldyBDbGFzc1NlcXMoKExpc3Q8U2VxdWVu\nY2VNZXRhRGF0YT4pCiAgICAgICAgICAgICAgICAgICAgZW50cnkuZ2V0VmFs\ndWUoKSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBx\ndWVyeSBtZXRhZGF0YSB0byB0aGUgZ2l2ZW4gbWV0YWRhdGFzIGNvbGxlY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRRdWVyeU1ldGFEYXRh\ncyhDb2xsZWN0aW9uIGFsbCkgewogICAgICAgIGlmIChfcXVlcmllcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGZvciAoTWFwLkVu\ndHJ5IGVudHJ5IDogX3F1ZXJpZXMuZW50cnlTZXQoKSkgewogICAgICAgICAg\nICBpZiAoZW50cnkuZ2V0S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGFsbC5hZGRBbGwoKExpc3QpIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAg\nICAgICBlbHNlIGlmIChfbW9kZSA9PSBNZXRhRGF0YU1vZGVzLk1PREVfUVVF\nUlkgfHwgX21ldGFzID09IG51bGwKICAgICAgICAgICAgICAgIHx8ICFfbWV0\nYXMuY29udGFpbnNLZXkoZW50cnkuZ2V0S2V5KCkpKQogICAgICAgICAgICAg\nICAgYWxsLmFkZChuZXcgQ2xhc3NRdWVyaWVzKChMaXN0PFF1ZXJ5TWV0YURh\ndGE+KQogICAgICAgICAgICAgICAgICAgIGVudHJ5LmdldFZhbHVlKCkpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgbmV3\nIGFubm90YXRpb24gYnVpbGRlciBmb3IgdGhlIHNwZWNpZmllZCBhbm5vdGF0\naW9uIHR5cGUuCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBBbm5vdGF0aW9uQnVpbGRlciBuZXdBbm5vdGF0aW9uQnVpbGRlcigKICAg\nICAgICBDbGFzczw/IGV4dGVuZHMgQW5ub3RhdGlvbj4gYW5uVHlwZSkgewog\nICAgICAgIHJldHVybiBuZXcgQW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlwZSk7\nICAgICAgICAKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRBbm5vdGF0\naW9uKEFubm90YXRpb25CdWlsZGVyIGFiLCBPYmplY3QgbWV0YSkgewogICAg\nICAgIGlmIChtZXRhIGluc3RhbmNlb2YgQ2xhc3NNZXRhRGF0YSkKICAgICAg\nICAgICAgYWRkQW5ub3RhdGlvbihhYiwgKENsYXNzTWV0YURhdGEpIG1ldGEp\nOwogICAgICAgIGVsc2UgaWYgKG1ldGEgaW5zdGFuY2VvZiBGaWVsZE1ldGFE\nYXRhKQogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCAoRmllbGRNZXRh\nRGF0YSkgbWV0YSk7CiAgICAgICAgZWxzZSBpZiAobWV0YSBpbnN0YW5jZW9m\nIFNlcXVlbmNlTWV0YURhdGEpCiAgICAgICAgICAgIGFkZEFubm90YXRpb24o\nYWIsIChTZXF1ZW5jZU1ldGFEYXRhKSBtZXRhKTsKICAgICAgICBlbHNlIGlm\nIChtZXRhIGluc3RhbmNlb2YgUXVlcnlNZXRhRGF0YSkKICAgICAgICAgICAg\nYWRkQW5ub3RhdGlvbihhYiwgKFF1ZXJ5TWV0YURhdGEpIG1ldGEpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFubm90YXRpb24gYnVpbGRlciB0\nbyBsaXN0IG9mIGJ1aWxkZXJzIGZvciB0aGUgc3BlY2lmaWVkCiAgICAgKiBj\nbGFzcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYWRk\nQW5ub3RhdGlvbihBbm5vdGF0aW9uQnVpbGRlciBhYiwgQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgaWYgKF9jbHNBbm5vcyA9PSBudWxsKQogICAg\nICAgICAgICBfY2xzQW5ub3MgPSBuZXcgSGFzaE1hcDxDbGFzc01ldGFEYXRh\nLCBMaXN0PEFubm90YXRpb25CdWlsZGVyPj4oKTsKICAgICAgICBMaXN0PEFu\nbm90YXRpb25CdWlsZGVyPiBsaXN0ID0gX2Nsc0Fubm9zLmdldChtZXRhKTsK\nICAgICAgICBpZiAobGlzdCA9PSBudWxsKSB7CiAgICAgICAgICAgIGxpc3Qg\nPSBuZXcgQXJyYXlMaXN0PEFubm90YXRpb25CdWlsZGVyPigpOwogICAgICAg\nICAgICBfY2xzQW5ub3MucHV0KG1ldGEsIGxpc3QpOwogICAgICAgIH0KICAg\nICAgICBsaXN0LmFkZChhYik7ICAgICAgICAKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIgdG8gbGlzdCBvZiBidWls\nZGVycyBmb3IgdGhlIHNwZWNpZmllZAogICAgICogZmllbGQgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZEFubm90YXRpb24oQW5u\nb3RhdGlvbkJ1aWxkZXIgYWIsIEZpZWxkTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIGlmIChfZmxkQW5ub3MgPT0gbnVsbCkKICAgICAgICAgICAgX2ZsZEFu\nbm9zID0gbmV3IEhhc2hNYXA8RmllbGRNZXRhRGF0YSwgTGlzdDxBbm5vdGF0\naW9uQnVpbGRlcj4+KCk7CiAgICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRl\ncj4gbGlzdCA9IF9mbGRBbm5vcy5nZXQobWV0YSk7CiAgICAgICAgaWYgKGxp\nc3QgPT0gbnVsbCkgewogICAgICAgICAgICBsaXN0ID0gbmV3IEFycmF5TGlz\ndDxBbm5vdGF0aW9uQnVpbGRlcj4oKTsKICAgICAgICAgICAgX2ZsZEFubm9z\nLnB1dChtZXRhLCBsaXN0KTsKICAgICAgICB9CiAgICAgICAgbGlzdC5hZGQo\nYWIpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFubm90YXRpb24g\nYnVpbGRlciB0byBsaXN0IG9mIGJ1aWxkZXJzIGZvciB0aGUgc3BlY2lmaWVk\nCiAgICAgKiBzZXF1ZW5jZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgYWRkQW5ub3RhdGlvbihBbm5vdGF0aW9uQnVpbGRlciBhYiwg\nU2VxdWVuY2VNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9zZXFBbm5v\ncyA9PSBudWxsKQogICAgICAgICAgICBfc2VxQW5ub3MgPSBuZXcgSGFzaE1h\ncDxTZXF1ZW5jZU1ldGFEYXRhLAogICAgICAgICAgICAgICAgICAgIExpc3Q8\nQW5ub3RhdGlvbkJ1aWxkZXI+PigpOwogICAgICAgIExpc3Q8QW5ub3RhdGlv\nbkJ1aWxkZXI+IGxpc3QgPSBfc2VxQW5ub3MuZ2V0KG1ldGEpOwogICAgICAg\nIGlmIChsaXN0ID09IG51bGwpIHsKICAgICAgICAgICAgbGlzdCA9IG5ldyBB\ncnJheUxpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+KCk7CiAgICAgICAgICAgIF9z\nZXFBbm5vcy5wdXQobWV0YSwgbGlzdCk7CiAgICAgICAgfQogICAgICAgIGxp\nc3QuYWRkKGFiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhbm5v\ndGF0aW9uIGJ1aWxkZXIgdG8gbGlzdCBvZiBidWlsZGVycyBmb3IgdGhlIHNw\nZWNpZmllZAogICAgICogcXVlcnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGFkZEFubm90YXRpb24oQW5ub3RhdGlvbkJ1aWxkZXIg\nYWIsIFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfcXJ5QW5u\nb3MgPT0gbnVsbCkKICAgICAgICAgICAgX3FyeUFubm9zID0gbmV3IEhhc2hN\nYXA8UXVlcnlNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+KCk7\nCiAgICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4gbGlzdCA9IF9xcnlB\nbm5vcy5nZXQobWV0YSk7CiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCkgewog\nICAgICAgICAgICBsaXN0ID0gbmV3IEFycmF5TGlzdDxBbm5vdGF0aW9uQnVp\nbGRlcj4oKTsKICAgICAgICAgICAgX3FyeUFubm9zLnB1dChtZXRhLCBsaXN0\nKTsKICAgICAgICB9CiAgICAgICAgbGlzdC5hZGQoYWIpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlcyBhbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIg\nZm9yIHRoZSBzcGVjaWZpZWQgY2xhc3MgbWV0YWRhdGEKICAgICAqIGFuZCBh\nZGRzIGl0IHRvIGxpc3Qgb2YgYnVpbGRlcnMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBBbm5vdGF0aW9uQnVpbGRlciBhZGRBbm5vdGF0aW9uKAogICAgICAg\nIENsYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm5UeXBlLCBDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9\nIG5ld0Fubm90YXRpb25CdWlsZGVyKGFublR5cGUpOwogICAgICAgIGlmICht\nZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBhYjsKICAgICAgICBh\nZGRBbm5vdGF0aW9uKGFiLCBtZXRhKTsKICAgICAgICByZXR1cm4gYWI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGFuIGFuIGFubm90YXRpb24g\nYnVpbGRlciBmb3IgdGhlIHNwZWNpZmllZCBjbGFzcyBtZXRhZGF0YQogICAg\nICogYW5kIGFkZHMgaXQgdG8gbGlzdCBvZiBidWlsZGVycy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIEFubm90YXRpb25CdWlsZGVyIGFkZEFubm90YXRpb24o\nCiAgICAgICAgQ2xhc3M8PyBleHRlbmRzIEFubm90YXRpb24+IGFublR5cGUs\nIEZpZWxkTWV0YURhdGEgbWV0YSkgewogICAgICAgIEFubm90YXRpb25CdWls\nZGVyIGFiID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlwZSk7CiAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFiOwog\nICAgICAgIGFkZEFubm90YXRpb24oYWIsIG1ldGEpOwogICAgICAgIHJldHVy\nbiBhYjsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW4gYW4gYW5u\nb3RhdGlvbiBidWlsZGVyIGZvciB0aGUgc3BlY2lmaWVkIGNsYXNzIG1ldGFk\nYXRhCiAgICAgKiBhbmQgYWRkcyBpdCB0byBsaXN0IG9mIGJ1aWxkZXJzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQW5ub3RhdGlvbkJ1aWxkZXIgYWRkQW5u\nb3RhdGlvbigKICAgICAgICBDbGFzczw/IGV4dGVuZHMgQW5ub3RhdGlvbj4g\nYW5uVHlwZSwgU2VxdWVuY2VNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgQW5u\nb3RhdGlvbkJ1aWxkZXIgYWIgPSBuZXdBbm5vdGF0aW9uQnVpbGRlcihhbm5U\neXBlKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gYWI7CiAgICAgICAgYWRkQW5ub3RhdGlvbihhYiwgbWV0YSk7CiAg\nICAgICAgcmV0dXJuIGFiOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\ncyBhbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIgZm9yIHRoZSBzcGVjaWZpZWQg\nY2xhc3MgbWV0YWRhdGEKICAgICAqIGFuZCBhZGRzIGl0IHRvIGxpc3Qgb2Yg\nYnVpbGRlcnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBBbm5vdGF0aW9uQnVp\nbGRlciBhZGRBbm5vdGF0aW9uKAogICAgICAgIENsYXNzPD8gZXh0ZW5kcyBB\nbm5vdGF0aW9uPiBhbm5UeXBlLCBRdWVyeU1ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9IG5ld0Fubm90YXRpb25CdWls\nZGVyKGFublR5cGUpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBhYjsKICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCBt\nZXRhKTsKICAgICAgICByZXR1cm4gYWI7CiAgICB9CiAgICAKICAgIHByb3Rl\nY3RlZCB2b2lkIHNlcmlhbGl6ZShDb2xsZWN0aW9uIG9iamVjdHMpIHsKICAg\nICAgICBmb3IgKE9iamVjdCBvYmogOiBvYmplY3RzKSB7CiAgICAgICAgICAg\nIGludCB0eXBlID0gdHlwZShvYmopOwogICAgICAgICAgICBzd2l0Y2ggKHR5\ncGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9NRVRBOgogICAgICAg\nICAgICAgICAgICAgIHNlcmlhbGl6ZUNsYXNzKChDbGFzc01ldGFEYXRhKSBv\nYmopOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBUWVBFX1NFUToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxp\nemVTZXF1ZW5jZSgoU2VxdWVuY2VNZXRhRGF0YSkgb2JqKTsKICAgICAgICAg\nICAgICAgIGNhc2UgVFlQRV9RVUVSWToKICAgICAgICAgICAgICAgICAgICBz\nZXJpYWxpemVRdWVyeSgoUXVlcnlNZXRhRGF0YSkgb2JqKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9D\nTEFTU19RVUVSSUVTOgogICAgICAgICAgICAgICAgICAgIGZvciAoUXVlcnlN\nZXRhRGF0YSBxdWVyeSA6ICgoQ2xhc3NRdWVyaWVzKSBvYmopCiAgICAgICAg\nICAgICAgICAgICAgICAgIC5nZXRRdWVyaWVzKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNlcmlhbGl6ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9DTEFT\nU19TRVFTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdNb2Rl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoU2VxdWVuY2VNZXRh\nRGF0YSBzZXEgOiAoKENsYXNzU2Vxcykgb2JqKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLmdldFNlcXVlbmNlcygpKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc2VyaWFsaXplU2VxdWVuY2Uoc2VxKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgc2VyaWFsaXplU3lzdGVtTWFwcGluZ0VsZW1l\nbnQob2JqKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgdHlwZSBjb25zdGFudCBmb3IgdGhlIGdpdmVuIG9iamVjdCBiYXNlZCBv\nbiBpdHMgcnVudGltZQogICAgICogY2xhc3MuIElmIHRoZSBydW50aW1lIGNs\nYXNzIGRvZXMgbm90IGNvcnJlc3BvbmQgdG8gYW55IG9mIHRoZSBrbm93bgog\nICAgICogdHlwZXMgdGhlbiByZXR1cm5zIC0xLiBUaGlzIGNhbiBoYXBwZW4g\nZm9yIHRhZ3MKICAgICAqIHRoYXQgYXJlIG5vdCBoYW5kbGVkIGF0IHRoaXMg\nc3RvcmUtYWdub3N0aWMgbGV2ZWwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBp\nbnQgdHlwZShPYmplY3QgbykgewogICAgICAgIGlmIChvIGluc3RhbmNlb2Yg\nQ2xhc3NNZXRhRGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRZUEVfTUVUQTsK\nICAgICAgICBpZiAobyBpbnN0YW5jZW9mIFF1ZXJ5TWV0YURhdGEpCiAgICAg\nICAgICAgIHJldHVybiBUWVBFX1FVRVJZOwogICAgICAgIGlmIChvIGluc3Rh\nbmNlb2YgU2VxdWVuY2VNZXRhRGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRZ\nUEVfU0VROwogICAgICAgIGlmIChvIGluc3RhbmNlb2YgQ2xhc3NRdWVyaWVz\nKQogICAgICAgICAgICByZXR1cm4gVFlQRV9DTEFTU19RVUVSSUVTOwogICAg\nICAgIGlmIChvIGluc3RhbmNlb2YgQ2xhc3NTZXFzKQogICAgICAgICAgICBy\nZXR1cm4gVFlQRV9DTEFTU19TRVFTOwogICAgICAgIHJldHVybiAtMTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSB1bmtub3duIG1hcHBpbmcg\nZWxlbWVudCBhdCBzeXN0ZW0gbGV2ZWwuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHNlcmlhbGl6ZVN5c3RlbU1hcHBpbmdFbGVtZW50KE9iamVjdCBv\nYmopIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBxdWVyeSBt\nZXRhZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1\nZXJ5KFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIExvZyBsb2cgPSBn\nZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkgewog\nICAgICAgICAgICBpZiAobWV0YS5nZXRTb3VyY2VTY29wZSgpIGluc3RhbmNl\nb2YgQ2xhc3MpCiAgICAgICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgi\nc2VyLWNscy1xdWVyeSIsCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRT\nb3VyY2VTY29wZSgpLCBtZXRhLmdldE5hbWUoKSkpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgic2VyLXF1\nZXJ5IiwgbWV0YS5nZXROYW1lKCkpKTsKICAgICAgICB9CgogICAgICAgIENs\nYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm4gPQogICAgICAgICAgICBR\ndWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMobWV0YS5nZXRMYW5ndWFn\nZSgpKSA/CiAgICAgICAgICAgIE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MgOiBO\nYW1lZFF1ZXJ5LmNsYXNzOwogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFi\nUXJ5ID0gYWRkQW5ub3RhdGlvbihhbm4sIG1ldGEpOwogICAgICAgIGFiUXJ5\nLmFkZCgibmFtZSIsIG1ldGEuZ2V0TmFtZSgpKTsKICAgICAgICBhYlFyeS5h\nZGQoInF1ZXJ5IiwgbWV0YS5nZXRRdWVyeVN0cmluZygpKTsKICAgICAgICBp\nZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKG1ldGEuZ2V0TGFu\nZ3VhZ2UoKSkpIHsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0UmVzdWx0VHlw\nZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBhYlFyeS5hZGQoInJlc3Vs\ndENsYXNzIiwgbWV0YS5nZXRSZXN1bHRUeXBlKCkpOwogICAgICAgIH0KICAg\nICAgICBzZXJpYWxpemVRdWVyeUhpbnRzKG1ldGEsIGFiUXJ5KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBxdWVyeSBoaW50cy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5SGludHMoUXVlcnlN\nZXRhRGF0YSBtZXRhLCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAg\nIFN0cmluZ1tdIGhpbnRzID0gbWV0YS5nZXRIaW50S2V5cygpOwogICAgICAg\nIE9iamVjdFtdIHZhbHVlcyA9IG1ldGEuZ2V0SGludFZhbHVlcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaGludHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJIaW50ID0gbmV3QW5u\nb3RhdGlvbkJ1aWxkZXIoUXVlcnlIaW50LmNsYXNzKTsKICAgICAgICAgICAg\nYWJIaW50LmFkZCgibmFtZSIsIGhpbnRzW2ldKTsKICAgICAgICAgICAgYWJI\naW50LmFkZCgidmFsdWUiLCBTdHJpbmcudmFsdWVPZih2YWx1ZXNbaV0pKTsK\nICAgICAgICAgICAgYWIuYWRkKCJoaW50cyIsIGFiSGludCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHNlcXVlbmNlIG1l\ndGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVT\nZXF1ZW5jZShTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBMb2cg\nbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVk\nKCkpCiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJzZXItc2VxdWVu\nY2UiLCBtZXRhLmdldE5hbWUoKSkpOwoKICAgICAgICBBbm5vdGF0aW9uQnVp\nbGRlciBhYiA9IGFkZEFubm90YXRpb24oU2VxdWVuY2VHZW5lcmF0b3IuY2xh\nc3MsIG1ldGEpOwogICAgICAgIGFiLmFkZCgibmFtZSIsIG1ldGEuZ2V0TmFt\nZSgpKTsKCiAgICAgICAgLy8gcGFyc2Ugb3V0IHRoZSBkYXRhc3RvcmUgc2Vx\ndWVuY2UgbmFtZSwgaWYgYW55CiAgICAgICAgU3RyaW5nIHBsdWdpbiA9IG1l\ndGEuZ2V0U2VxdWVuY2VQbHVnaW4oKTsKICAgICAgICBTdHJpbmcgY2xzTmFt\nZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShwbHVnaW4pOwogICAg\nICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRp\nZXMocGx1Z2luKTsKICAgICAgICBTdHJpbmcgZHMgPSBudWxsOwogICAgICAg\nIGlmIChwcm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgIFByb3BlcnRpZXMg\nbWFwID0gQ29uZmlndXJhdGlvbnMucGFyc2VQcm9wZXJ0aWVzKHByb3BzKTsK\nICAgICAgICAgICAgZHMgPSAoU3RyaW5nKSBtYXAucmVtb3ZlKCJTZXF1ZW5j\nZSIpOwogICAgICAgICAgICBpZiAoZHMgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5zZXJpYWxpemVQcm9wZXJ0\naWVzKG1hcCk7CiAgICAgICAgICAgICAgICBwbHVnaW4gPSBDb25maWd1cmF0\naW9ucy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJvcHMpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoZHMgIT0gbnVsbCkKICAgICAgICAg\nICAgYWIuYWRkKCJzZXF1ZW5jZU5hbWUiLCBkcyk7CiAgICAgICAgZWxzZSBp\nZiAocGx1Z2luICE9IG51bGwgJiYgIVNlcXVlbmNlTWV0YURhdGEuSU1QTF9O\nQVRJVkUuZXF1YWxzCiAgICAgICAgICAgIChwbHVnaW4pKQogICAgICAgICAg\nICBhYi5hZGQoInNlcXVlbmNlTmFtZSIsIHBsdWdpbik7CiAgICAgICAgaWYg\nKG1ldGEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gMCAmJiBtZXRhLmdldEluaXRp\nYWxWYWx1ZSgpICE9IC0xKQogICAgICAgICAgICBhYi5hZGQoImluaXRpYWxW\nYWx1ZSIsIG1ldGEuZ2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgIGlmICht\nZXRhLmdldEFsbG9jYXRlKCkgIT0gNTAgJiYgbWV0YS5nZXRBbGxvY2F0ZSgp\nICE9IC0xKQogICAgICAgICAgICBhYi5hZGQoImFsbG9jYXRpb25TaXplIiwg\nbWV0YS5nZXRBbGxvY2F0ZSgpKTsKICAgICAgICBpZiAobWV0YS5nZXRTY2hl\nbWEoKSAhPSBudWxsKQogICAgICAgICAgICBhYi5hZGQoInNjaGVtYSIsIG1l\ndGEuZ2V0U2NoZW1hKCkpOwogICAgICAgIGlmIChtZXRhLmdldENhdGFsb2co\nKSAhPSBudWxsKQogICAgICAgICAgICBhYi5hZGQoImNhdGFsb2ciLCBtZXRh\nLmdldENhdGFsb2coKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxp\nemUgY2xhc3MgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHNlcmlhbGl6ZUNsYXNzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIExvZyBsb2cgPSBnZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzSW5mb0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInNlci1j\nbGFzcyIsIG1ldGEpKTsKCiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJF\nbnRpdHkgPSBhZGRBbm5vdGF0aW9uKAogICAgICAgICAgICBnZXRFbnRpdHlB\nbm5vdGF0aW9uVHlwZShtZXRhKSwgbWV0YSk7CiAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkKICAgICAgICAgICAgJiYgIW1ldGEuZ2V0VHlwZUFsaWFz\nKCkuZXF1YWxzKFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKG1ldGEuCiAgICAgICAg\nICAgIGdldERlc2NyaWJlZFR5cGUoKSkpKQogICAgICAgICAgICBhYkVudGl0\neS5hZGQoIm5hbWUiLCBtZXRhLmdldFR5cGVBbGlhcygpKTsKICAgICAgICAK\nICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBhZGRD\nbGFzc01hcHBpbmdBbm5vdGF0aW9ucyhtZXRhKTsKCiAgICAgICAgaWYgKGlz\nTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgc2VyaWFsaXplQ2xhc3NNYXBw\naW5nQ29udGVudChtZXRhKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgc2VyaWFsaXplSWRDbGFzcyhtZXRhKTsKICAgICAg\nICBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBzZXJpYWxpemVJ\nbmhlcml0YW5jZUNvbnRlbnQobWV0YSk7CgogICAgICAgIGlmIChpc01hcHBp\nbmdNb2RlKCkpIHsKICAgICAgICAgICAgTGlzdCBzZXFzID0gKF9zZXFzID09\nIG51bGwpID8gbnVsbCA6IF9zZXFzLmdldAogICAgICAgICAgICAgICAgKG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSk7CiAgICAgICAgICAg\nIGlmIChzZXFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6\nYXRpb25Tb3J0KHNlcXMpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzZXFzLnNpemUoKTsgaSsrKQogICAgICAgICAgICAgICAgICAg\nIHNlcmlhbGl6ZVNlcXVlbmNlKChTZXF1ZW5jZU1ldGFEYXRhKSBzZXFzLmdl\ndChpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChp\nc1F1ZXJ5TW9kZSgpKSB7CiAgICAgICAgICAgIExpc3QgcXVlcmllcyA9IChf\ncXVlcmllcyA9PSBudWxsKSA/IG51bGwgOiBfcXVlcmllcy5nZXQKICAgICAg\nICAgICAgICAgIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkp\nOwogICAgICAgICAgICBpZiAocXVlcmllcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBzZXJpYWxpemF0aW9uU29ydChxdWVyaWVzKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcXVlcmllcy5zaXplKCk7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVRdWVyeSgoUXVlcnlN\nZXRhRGF0YSkgcXVlcmllcy5nZXQoaSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAgICBz\nZXJpYWxpemVRdWVyeU1hcHBpbmdzKG1ldGEpOwogICAgICAgIH0KCiAgICAg\nICAgTGlzdDxGaWVsZE1ldGFEYXRhPiBmaWVsZHMgPSBuZXcgQXJyYXlMaXN0\nKEFycmF5cy5hc0xpc3QKICAgICAgICAgICAgKG1ldGEuZ2V0RGVmaW5lZEZp\nZWxkc0luTGlzdGluZ09yZGVyKCkpKTsKICAgICAgICBDb2xsZWN0aW9ucy5z\nb3J0KGZpZWxkcywgbmV3IEZpZWxkQ29tcGFyYXRvcigpKTsKCiAgICAgICAg\nLy8gc2VyaWFsaXplIGF0dHItb3ZlcnJpZGUKICAgICAgICBpZiAoaXNNYXBw\naW5nTW9kZSgpKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kOwog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhIG9yaWc7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3I8RmllbGRNZXRhRGF0YT4gaXQgPSBmaWVsZHMuaXRlcmF0\nb3IoKTsgaXQuaGFzTmV4dCgpOykKICAgICAgICAgICAgewogICAgICAgICAg\nICAgICAgZm1kID0gaXQubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG1l\ndGEuZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChmbWQuZ2V0TmFtZSgpKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgb3JpZyA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKS5nZXRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIGlm\nIChzZXJpYWxpemVBdHRyaWJ1dGVPdmVycmlkZShmbWQsIG9yaWcpKQogICAg\nICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUF0dHJpYnV0ZU92ZXJyaWRlQ29u\ndGVudChmbWQsIG9yaWcpOwogICAgICAgICAgICAgICAgaXQucmVtb3ZlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChmaWVsZHMu\nc2l6ZSgpID4gMCAmJiAoaXNNZXRhRGF0YU1vZGUoKSB8fCBpc01hcHBpbmdN\nb2RlKCkpKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZzsKICAg\nICAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IGZpZWxkcykgewog\nICAgICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJpbmdUeXBlKCkgIT0g\nZm1kLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAg\nICBnZXREZXNjcmliZWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgICAgICBv\ncmlnID0gZm1kLmdldERlY2xhcmluZ01ldGFEYXRhKCkuZ2V0RGVjbGFyZWRG\naWVsZAogICAgICAgICAgICAgICAgICAgICAgICAoZm1kLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBv\ncmlnID0gbnVsbDsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUZpZWxkKGZt\nZCwgb3JpZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gZW50aXR5IGFubm90YXRpb24gdHlwZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3M8PyBleHRlbmRzIEFubm90\nYXRpb24+IGdldEVudGl0eUFubm90YXRpb25UeXBlKAogICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIHN3aXRjaCAoZ2V0RW50aXR5VGFn\nKG1ldGEpKSB7CiAgICAgICAgICAgIGNhc2UgRU5USVRZOgogICAgICAgICAg\nICAgICAgcmV0dXJuIEVudGl0eS5jbGFzczsKICAgICAgICAgICAgY2FzZSBF\nTUJFRERBQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIEVtYmVkZGFibGUu\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgTUFQUEVEX1NVUEVSQ0xBU1M6CiAg\nICAgICAgICAgICAgICByZXR1cm4gTWFwcGVkU3VwZXJjbGFzcy5jbGFzczsK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gZmllbGQgYW5ub3RhdGlvbiB0eXBlLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzczw/IGV4dGVuZHMgQW5u\nb3RhdGlvbj4gZ2V0RmllbGRBbm5vdGF0aW9uVHlwZSAoCiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQsIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXQpIHsK\nICAgICAgICBDbGFzczw/IGV4dGVuZHMgQW5ub3RhdGlvbj4gYW5uID0gbnVs\nbDsKICAgICAgICBpZiAoZm1kLmlzUHJpbWFyeUtleSgpICYmIHN0cmF0ID09\nIFBlcnNpc3RlbmNlU3RyYXRlZ3kuRU1CRURERUQpCiAgICAgICAgICAgIGFu\nbiA9IEVtYmVkZGVkSWQuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoZm1kLmlz\nUHJpbWFyeUtleSgpKQogICAgICAgICAgICBhbm4gPSBJZC5jbGFzczsKICAg\nICAgICBlbHNlIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgIGFu\nbiA9IFZlcnNpb24uY2xhc3M7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIHN3aXRjaCAoc3RyYXQpIHsKICAgICAgICAgICAgICAgIGNhc2UgVFJBTlNJ\nRU5UOgogICAgICAgICAgICAgICAgICAgIGFubiA9IFRyYW5zaWVudC5jbGFz\nczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgQkFTSUM6CiAgICAgICAgICAgICAgICAgICAgYW5uID0gQmFzaWMu\nY2xhc3M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEVNQkVEREVEOgogICAgICAgICAgICAgICAgICAgIGFubiA9\nIEVtYmVkZGVkLmNsYXNzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBNQU5ZX09ORToKICAgICAgICAgICAgICAg\nICAgICBhbm4gPSBNYW55VG9PbmUuY2xhc3M7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9ORV9PTkU6CiAgICAg\nICAgICAgICAgICAgICAgYW5uID0gT25lVG9PbmUuY2xhc3M7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9ORV9N\nQU5ZOgogICAgICAgICAgICAgICAgICAgIGFubiA9IE9uZVRvTWFueS5jbGFz\nczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgICAgIGFubiA9IE1h\nbnlUb01hbnkuY2xhc3M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFubjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgTWV0YURhdGFUYWcgZm9y\nIHRoZSBnaXZlbiBjbGFzcyBtZXRhIGRhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIE1ldGFEYXRhVGFnIGdldEVudGl0eVRhZyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5pc0Fic3RyYWN0KCkpCiAg\nICAgICAgICAgIHJldHVybiBNZXRhRGF0YVRhZy5NQVBQRURfU1VQRVJDTEFT\nUzsKICAgICAgICAvLyBARW1iZWRkYWJsZSBjbGFzc2VzIGNhbid0IGRlY2xh\ncmUgSWQgZmllbGRzCiAgICAgICAgaWYgKG1ldGEuaXNFbWJlZGRlZE9ubHko\nKSAmJiBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRhVGFnLkVNQkVEREFCTEU7CiAg\nICAgICAgaWYgKG1ldGEuaXNNYXBwZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIE1ldGFEYXRhVGFnLkVOVElUWTsKICAgICAgICByZXR1cm4gTWV0YURhdGFU\nYWcuTUFQUEVEX1NVUEVSQ0xBU1M7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgbWFwcGluZyBhdHRyaWJ1dGVzIGZvciB0aGUgZ2l2ZW4gY2xhc3MuIERv\nZXMgbm90aGluZyBieSBkZWZhdWx0CiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGFkZENsYXNzTWFwcGluZ0Fubm90YXRpb25zKENsYXNzTWV0YURhdGEg\nbWFwcGluZykgewogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGlk\nLWNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplSWRD\nbGFzcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5n\nZXRJZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FU\nSU9OCiAgICAgICAgICAgIHx8IG1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFzc01ldGFEYXRhIHN1\ncCA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBD\nbGFzcyBvaWQgPSBtZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIGlm\nIChvaWQgIT0gbnVsbCAmJiAoc3VwID09IG51bGwgfHwgb2lkICE9IHN1cC5n\nZXRPYmplY3RJZFR5cGUoKSkpIHsKICAgICAgICAgICAgQW5ub3RhdGlvbkJ1\naWxkZXIgYWIgPSBhZGRBbm5vdGF0aW9uKElkQ2xhc3MuY2xhc3MsIG1ldGEp\nOwogICAgICAgICAgICBhYi5hZGQobnVsbCwgb2lkKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUgY2xhc3MgbWFwcGluZyBj\nb250ZW50LiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplQ2xhc3NNYXBwaW5nQ29udGVudChD\nbGFzc01ldGFEYXRhIG1hcHBpbmcpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlcmlhbGl6ZSBpbmhlcml0YW5jZSBjb250ZW50LiBEb2VzIG5vdGhpbmcg\nYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFs\naXplSW5oZXJpdGFuY2VDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykg\newogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHF1ZXJ5IG1hcHBp\nbmdzLiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgc2VyaWFsaXplUXVlcnlNYXBwaW5ncyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSB0\naGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJp\nYWxpemVGaWVsZChGaWVsZE1ldGFEYXRhIGZtZCwgRmllbGRNZXRhRGF0YSBv\ncmlnKSB7CiAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmll\nbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVAogICAgICAgICAgICAmJiAh\nZm1kLmlzRXhwbGljaXQoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0ID0gZ2V0U3RyYXRlZ3koZm1k\nKTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIGNhc2NhZGVzID0gbnVsbDsKICAg\nICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9IGFkZEFubm90YXRpb24oCiAg\nICAgICAgICAgIGdldEZpZWxkQW5ub3RhdGlvblR5cGUgKGZtZCwgc3RyYXQp\nLCBmbWQpOyAgICAgICAgCiAgICAgICAgaWYgKGZtZC5pc1ByaW1hcnlLZXko\nKSAmJiBzdHJhdCA9PSBQZXJzaXN0ZW5jZVN0cmF0ZWd5LkVNQkVEREVEKQog\nICAgICAgICAgICA7IC8vIG5vb3AKICAgICAgICBlbHNlIGlmIChmbWQuaXNQ\ncmltYXJ5S2V5KCkpCiAgICAgICAgICAgIDsgLy8gbm9vcAogICAgICAgIGVs\nc2UgaWYgKGZtZC5pc1ZlcnNpb24oKSkKICAgICAgICAgICAgOyAvLyBub29w\nCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHN3aXRjaCAoc3RyYXQpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgQkFTSUM6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGFkZEJhc2ljQXR0cmlidXRlcyhmbWQsIGFiKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFOWV9PTkU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGFkZE1hbnlUb09uZUF0dHJpYnV0ZXMo\nZm1kLCBhYik7CiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZXMgPSBmbWQ7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE9ORV9PTkU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURh\ndGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZE9uZVRvT25l\nQXR0cmlidXRlcyhmbWQsIGFiKTsKICAgICAgICAgICAgICAgICAgICBjYXNj\nYWRlcyA9IGZtZDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGFkZE9uZVRvTWFueUF0dHJpYnV0ZXMoZm1kLCBhYik7CiAgICAgICAgICAg\nICAgICAgICAgY2FzY2FkZXMgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQU5Z\nX01BTlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZE1hbnlUb01hbnlBdHRy\naWJ1dGVzKGZtZCwgYWIpOwogICAgICAgICAgICAgICAgICAgIGNhc2NhZGVz\nID0gZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNNYXBwaW5nTW9k\nZSgpKQogICAgICAgICAgICAgICAgYWRkU3RyYXRlZ3lNYXBwaW5nQXR0cmli\ndXRlcyhmbWQsIGFiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzTWFwcGlu\nZ01vZGUoZm1kKSkKICAgICAgICAgICAgYWRkRmllbGRNYXBwaW5nQXR0cmli\ndXRlcyhmbWQsIG9yaWcsIGFiKTsKCiAgICAgICAgaWYgKGZtZC5nZXRPcmRl\nckRlY2xhcmF0aW9uKCkgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIShP\ncmRlci5FTEVNRU5UICsgIiBhc2MiKS5lcXVhbHMoZm1kLmdldE9yZGVyRGVj\nbGFyYXRpb24oKSkpCiAgICAgICAgICAgICAgICBhZGRBbm5vdGF0aW9uKE9y\nZGVyQnkuY2xhc3MsIGZtZCkuCiAgICAgICAgICAgICAgICAgICAgYWRkIChu\ndWxsLCBmbWQuZ2V0T3JkZXJEZWNsYXJhdGlvbigpKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSAmJiBmbWQuZ2V0S2V5KCkuZ2V0\nVmFsdWVNYXBwZWRCeSgpICE9IG51bGwpIHsKICAgICAgICAgICAgQW5ub3Rh\ndGlvbkJ1aWxkZXIgYWJNYXBLZXkgPSBhZGRBbm5vdGF0aW9uKE1hcEtleS5j\nbGFzcywgZm1kKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBtYXBCeSA9\nIGZtZC5nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5TWV0YURhdGEoKTsKICAg\nICAgICAgICAgaWYgKCFtYXBCeS5pc1ByaW1hcnlLZXkoKSB8fAogICAgICAg\nICAgICAgICAgbWFwQnkuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmdldFByaW1h\ncnlLZXlGaWVsZHMoKS5sZW5ndGggIT0gMSkgewogICAgICAgICAgICAgICAg\nYWJNYXBLZXkuYWRkKCJuYW1lIiwgZm1kLmdldEtleSgpLmdldFZhbHVlTWFw\ncGVkQnkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKGlzTWFwcGluZ01vZGUoZm1kKSkKICAgICAgICAgICAgc2VyaWFsaXplRmll\nbGRNYXBwaW5nQ29udGVudChmbWQsIHN0cmF0LCBhYik7CiAgICAgICAgaWYg\nKGNhc2NhZGVzICE9IG51bGwgJiYgaXNNZXRhRGF0YU1vZGUoKSkKICAgICAg\nICAgICAgc2VyaWFsaXplQ2FzY2FkZXMoY2FzY2FkZXMsIGFiKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBtYXBwaW5nIGF0dHJpYnV0ZXMgZm9yIHRo\nZSBnaXZlbiBmaWVsZC4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZEZpZWxkTWFwcGluZ0F0dHJpYnV0\nZXMoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgRmllbGRNZXRhRGF0YSBv\ncmlnLCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEFsd2F5cyByZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHNlcmlhbGl6ZUF0dHJpYnV0\nZU92ZXJyaWRlKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIEZpZWxkTWV0\nYURhdGEgb3JpZykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNlcmlhbGl6ZSBhdHRyaWJ1dGUgb3ZlcnJpZGUgY29u\ndGVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZUF0dHJp\nYnV0ZU92ZXJyaWRlQ29udGVudChGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAg\nICBGaWVsZE1ldGFEYXRhIG9yaWcpIHsKICAgICAgICBBbm5vdGF0aW9uQnVp\nbGRlciBhYiA9IGFkZEFubm90YXRpb24oQXR0cmlidXRlT3ZlcnJpZGUuY2xh\nc3MsIGZtZCk7CiAgICAgICAgYWIuYWRkKCJuYW1lIiwgZm1kLmdldE5hbWUo\nKSk7CiAgICAgICAgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVNYXBwaW5n\nQ29udGVudChmbWQsIG9yaWcsIGFiKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlcmlhbGl6ZSBhdHRyaWJ1dGUgb3ZlcnJpZGUgbWFwcGluZyBjb250ZW50\nLiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdCwKICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVNYXBwaW5nQ29u\ndGVudAogICAgICAgIChGaWVsZE1ldGFEYXRhIGZtZCwgRmllbGRNZXRhRGF0\nYSBvcmlnLCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgfQoKCiAgICAv\nKioKICAgICAqIFNlcmlhbGl6ZSBjYXNjYWRlcy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHNlcmlhbGl6ZUNhc2NhZGVzKFZhbHVlTWV0YURhdGEgdm1k\nLCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIEVudW1TZXQ8Q2Fz\nY2FkZVR5cGU+IGNhc2NhZGVzID0gRW51bVNldC5ub25lT2YoQ2FzY2FkZVR5\ncGUuY2xhc3MpOwogICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZVBlcnNpc3Qo\nKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAg\nICAgICAgIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5QRVJTSVNUKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKHZtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAg\nICBjYXNjYWRlcy5hZGQoQ2FzY2FkZVR5cGUuTUVSR0UpOwogICAgICAgIH0K\nICAgICAgICBpZiAodm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgIGNhc2Nh\nZGVzLmFkZChDYXNjYWRlVHlwZS5SRU1PVkUpOwogICAgICAgIH0KICAgICAg\nICBpZiAodm1kLmdldENhc2NhZGVSZWZyZXNoKCkgPT0gVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAgICBjYXNjYWRlcy5h\nZGQoQ2FzY2FkZVR5cGUuUkVGUkVTSCk7CiAgICAgICAgfQogICAgICAgIGlm\nICh2bWQuZ2V0Q2FzY2FkZURldGFjaCgpID09IFZhbHVlTWV0YURhdGEuQ0FT\nQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAgICAgY2FzY2FkZXMuYWRkKENh\nc2NhZGVUeXBlLkRFVEFDSCk7CiAgICAgICAgfQogICAgICAgIGlmIChjYXNj\nYWRlcy5zaXplKCkgPT0gNSkgLy8gQUxMCiAgICAgICAgewogICAgICAgICAg\nICBjYXNjYWRlcy5jbGVhcigpOwogICAgICAgICAgICBjYXNjYWRlcy5hZGQo\nQ2FzY2FkZVR5cGUuQUxMKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYXNj\nYWRlcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYWIuYWRkKCJjYXNjYWRl\nIiwgY2FzY2FkZXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgc2VyaWFsaXplZCBzdHJhdGVneSBuYW1lLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VTdHJhdGVneSBnZXRTdHJhdGVn\neShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQuZ2V0TWFu\nYWdlbWVudCgpID09IGZtZC5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuVFJBTlNJRU5UOwoKICAgICAgICBp\nZiAoZm1kLmlzU2VyaWFsaXplZCgpCiAgICAgICAgICAgIHx8IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAgICAgfHwg\nZm1kLmdldERlY2xhcmVkVHlwZSgpID09IEJ5dGVbXS5jbGFzcwogICAgICAg\nICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNsYXNz\nCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFy\nYWN0ZXJbXS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNl\nU3RyYXRlZ3kuQkFTSUM7CgogICAgICAgIEZpZWxkTWV0YURhdGEgbWFwcGVk\nQnk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAg\nICAgICAgaWYgKGZtZC5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuRU1CRURERUQ7CiAgICAg\nICAgICAgICAgICBpZiAoZm1kLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5P\nTkVfT05FOwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGludmVy\nc2VzID0gZm1kLmdldEludmVyc2VNZXRhRGF0YXMoKTsKICAgICAgICAgICAg\nICAgIGlmIChpbnZlcnNlcy5sZW5ndGggPT0gMSAmJgogICAgICAgICAgICAg\nICAgICAgIGludmVyc2VzWzBdLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDICYmCiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZXNbMF0uZ2V0TWFw\ncGVkQnlNZXRhRGF0YSgpID09IGZtZCkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk9ORV9PTkU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VT\ndHJhdGVneS5NQU5ZX09ORTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIG1hcHBlZEJ5ID0gZm1kLmdldE1hcHBlZEJ5TWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgIGlmIChtYXBwZWRCeSA9PSBudWxsIHx8IG1hcHBlZEJ5\nLmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk1BTllfTUFOWTsK\nICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk9O\nRV9NQU5ZOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5FTUJFRERF\nRDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBQZXJzaXN0ZW5jZVN0cmF0ZWd5LkJBU0lDOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBiYXNpYyBhdHRyaWJ1dGVzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkQmFzaWNBdHRyaWJ1dGVzKEZpZWxkTWV0\nYURhdGEgZm1kLCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIGlm\nICghZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBh\nYi5hZGQoImZldGNoIiwgRmV0Y2hUeXBlLkxBWlkpOwogICAgICAgIGlmIChm\nbWQuZ2V0TnVsbFZhbHVlKCkgPT0gRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQ\nVElPTikKICAgICAgICAgICAgYWIuYWRkKCJvcHRpb25hbCIsIGZhbHNlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBtYW55LXRvLW9uZSBhdHRyaWJ1\ndGVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFueVRvT25lQXR0\ncmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9u\nQnVpbGRlciBhYikgewogICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0\nY2hHcm91cCgpKQogICAgICAgICAgICBhYi5hZGQoImZldGNoIiwgRmV0Y2hU\neXBlLkxBWlkpOwogICAgICAgIGlmIChmbWQuZ2V0TnVsbFZhbHVlKCkgPT0g\nRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTikKICAgICAgICAgICAgYWIu\nYWRkKCJvcHRpb25hbCIsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCBvbmUtdG8tb25lIGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRPbmVUb09uZUF0dHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBm\nbWQsCiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWIpIHsKICAgICAgICBp\nZiAoIWZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAg\nYWIuYWRkKCJmZXRjaCIsIEZldGNoVHlwZS5MQVpZKTsKICAgICAgICBpZiAo\nZm1kLmdldE51bGxWYWx1ZSgpID09IEZpZWxkTWV0YURhdGEuTlVMTF9FWENF\nUFRJT04pCiAgICAgICAgICAgIGFiLmFkZCgib3B0aW9uYWwiLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgb25lLXRvLW1hbnkgYXR0cmli\ndXRlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE9uZVRvTWFueUF0\ndHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgQW5ub3RhdGlv\nbkJ1aWxkZXIgYWIpIHsKICAgICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0\nY2hHcm91cCgpKQogICAgICAgICAgICBhYi5hZGQoImZldGNoIiwgRmV0Y2hU\neXBlLkVBR0VSKTsKICAgICAgICBhZGRUYXJnZXRFbnRpdHlBdHRyaWJ1dGUo\nZm1kLCBhYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgbWFueS10by1t\nYW55IGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRN\nYW55VG9NYW55QXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAg\nICBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIGlmIChmbWQuaXNJ\nbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGFiLmFkZCgiZmV0\nY2giLCBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGFkZFRhcmdldEVudGl0\neUF0dHJpYnV0ZShmbWQsIGFiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCBhIHRhcmdldC1lbnRpdHkgYXR0cmlidXRlIHRvIGNvbGxlY3Rpb24gYW5k\nIG1hcCBmaWVsZHMgdGhhdCBkbwogICAgICogbm90IHVzZSBnZW5lcmljcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFRhcmdldEVudGl0eUF0dHJp\nYnV0ZShGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uQnVp\nbGRlciBhYikgewogICAgICAgIE1lbWJlciBtZW1iZXIgPSBmbWQuZ2V0QmFj\na2luZ01lbWJlcigpOwogICAgICAgIENsYXNzW10gdHlwZXM7CiAgICAgICAg\naWYgKG1lbWJlciBpbnN0YW5jZW9mIEZpZWxkKQogICAgICAgICAgICB0eXBl\ncyA9IEphdmFWZXJzaW9ucy5nZXRQYXJhbWV0ZXJpemVkVHlwZXMoKEZpZWxk\nKSBtZW1iZXIpOwogICAgICAgIGVsc2UgaWYgKG1lbWJlciBpbnN0YW5jZW9m\nIE1ldGhvZCkKICAgICAgICAgICAgdHlwZXMgPSBKYXZhVmVyc2lvbnMuZ2V0\nUGFyYW1ldGVyaXplZFR5cGVzKChNZXRob2QpIG1lbWJlcik7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICB0eXBlcyA9IG5ldyBDbGFzc1swXTsKCiAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICBpZiAodHlwZXMubGVuZ3RoICE9IDEpCiAgICAgICAgICAgICAgICAg\nICAgYWIuYWRkKCJ0YXJnZXRFbnRpdHkiLCBmbWQuZ2V0RWxlbWVudCgpLmdl\ndERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBp\nZiAodHlwZXMubGVuZ3RoICE9IDIpCiAgICAgICAgICAgICAgICAgICAgYWIu\nYWRkKCJ0YXJnZXRFbnRpdHkiLCBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xh\ncmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBmaWVsZCBtYXBwaW5n\nIGNvbnRlbnQ7IHRoaXMgd2lsbCBiZSBjYWxsZWQgYmVmb3JlCiAgICAgKiB7\nQGxpbmsgI3NlcmlhbGl6ZVZhbHVlTWFwcGluZ0NvbnRlbnR9LiBEb2VzIG5v\ndGhpbmcgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nc2VyaWFsaXplRmllbGRNYXBwaW5nQ29udGVudChGaWVsZE1ldGFEYXRhIGZt\nZCwKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0ZWd5LCBBbm5v\ndGF0aW9uQnVpbGRlciBhYikgewogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIG1hcHBpbmcgYXR0cmlidXRlcyBmb3Igc3RyYXRlZ3kuIFNldHMgbWFwcGVk\nLWJ5IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFk\nZFN0cmF0ZWd5TWFwcGluZ0F0dHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQs\nCiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWIpIHsKICAgICAgICBpZiAo\nZm1kLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAgYWIuYWRk\nKCJtYXBwZWRCeSIsIGZtZC5nZXRNYXBwZWRCeSgpKTsKICAgIH0KICAgIAog\nICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0T2JqZWN0cygpIHsKICAgICAg\nICBMaXN0IGFsbCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBpZiAoaXNR\ndWVyeU1vZGUoKSkKICAgICAgICAgICAgYWRkUXVlcnlNZXRhRGF0YXMoYWxs\nKTsKICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBh\nZGRTZXF1ZW5jZU1ldGFEYXRhcyhhbGwpOwogICAgICAgIGlmICgoaXNNZXRh\nRGF0YU1vZGUoKSB8fCBpc01hcHBpbmdNb2RlKCkpICYmIF9tZXRhcyAhPSBu\ndWxsKQogICAgICAgICAgICBhbGwuYWRkQWxsKF9tZXRhcy52YWx1ZXMoKSk7\nCiAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgYWRk\nU3lzdGVtTWFwcGluZ0VsZW1lbnRzKGFsbCk7CiAgICAgICAgc2VyaWFsaXph\ndGlvblNvcnQoYWxsKTsKICAgICAgICByZXR1cm4gYWxsOwogICAgfQoKICAg\nIHByb3RlY3RlZCB2b2lkIHdyaXRlQW5ub3RhdGlvbnMoT2JqZWN0IG1ldGEs\nCiAgICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4gYnVpbGRlcnMsIE1h\ncCBvdXRwdXQpIHsKICAgICAgICBMaXN0PFN0cmluZz4gYW5ub3MgPSBuZXcg\nQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBmb3IoQW5ub3RhdGlvbkJ1\naWxkZXIgYWI6IGJ1aWxkZXJzKQogICAgICAgICAgICBhbm5vcy5hZGQoYWIu\ndG9TdHJpbmcoKSk7CiAgICAgICAgb3V0cHV0LnB1dChtZXRhLCBhbm5vcyk7\nICAgICAgICAKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXJpYWxpemUoTWFw\nIG91dHB1dCwgaW50IGZsYWdzKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIENvbGxlY3Rpb24gYWxsID0gZ2V0T2JqZWN0cygpOwogICAgICAgIHNl\ncmlhbGl6ZShhbGwpOwoKICAgICAgICBpZiAoX2Nsc0Fubm9zICE9IG51bGwp\nCiAgICAgICAgICAgIGZvciAoQ2xhc3NNZXRhRGF0YSBtZXRhIDogX2Nsc0Fu\nbm9zLmtleVNldCgpKQogICAgICAgICAgICAgICAgd3JpdGVBbm5vdGF0aW9u\ncyhtZXRhLCBfY2xzQW5ub3MuZ2V0KG1ldGEpLCBvdXRwdXQpOwogICAgICAg\nIGlmIChfZmxkQW5ub3MgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChGaWVs\nZE1ldGFEYXRhIG1ldGEgOiBfZmxkQW5ub3Mua2V5U2V0KCkpCiAgICAgICAg\nICAgICAgICB3cml0ZUFubm90YXRpb25zKG1ldGEsIF9mbGRBbm5vcy5nZXQo\nbWV0YSksIG91dHB1dCk7CiAgICAgICAgaWYgKF9zZXFBbm5vcyAhPSBudWxs\nKQogICAgICAgICAgICBmb3IgKFNlcXVlbmNlTWV0YURhdGEgbWV0YSA6IF9z\nZXFBbm5vcy5rZXlTZXQoKSkKICAgICAgICAgICAgICAgIHdyaXRlQW5ub3Rh\ndGlvbnMobWV0YSwgX3NlcUFubm9zLmdldChtZXRhKSwgb3V0cHV0KTsKICAg\nICAgICBpZiAoX3FyeUFubm9zICE9IG51bGwpCiAgICAgICAgICAgIGZvciAo\nUXVlcnlNZXRhRGF0YSBtZXRhIDogX3FyeUFubm9zLmtleVNldCgpKQogICAg\nICAgICAgICAgICAgd3JpdGVBbm5vdGF0aW9ucyhtZXRhLCBfcXJ5QW5ub3Mu\nZ2V0KG1ldGEpLCBvdXRwdXQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ncmlhbGl6ZShGaWxlIGZpbGUsIGludCBmbGFncykgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBGaWxlV3JpdGVyIG91\ndCA9IG5ldyBGaWxlV3JpdGVyKEFjY2Vzc0NvbnRyb2xsZXIKICAgICAgICAg\nICAgICAgIC5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIuZ2V0Q2Fub25p\nY2FsUGF0aEFjdGlvbihmaWxlKSksCiAgICAgICAgICAgICAgICAoZmxhZ3Mg\nJiBBUFBFTkQpID4gMCk7CiAgICAgICAgICAgIHNlcmlhbGl6ZShvdXQsIGZs\nYWdzKTsKICAgICAgICAgICAgb3V0LmNsb3NlKCk7CiAgICAgICAgfSBjYXRj\naCAoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAg\nICAgdGhyb3cgKElPRXhjZXB0aW9uKSBwYWUuZ2V0RXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlcmlhbGl6ZShXcml0\nZXIgb3V0LCBpbnQgZmxhZ3MpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgTWFwIG91dHB1dCA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgc2VyaWFs\naXplKG91dHB1dCwgZmxhZ3MpOwoKICAgICAgICBmb3IoT2JqZWN0IG1ldGE6\nIG91dHB1dC5rZXlTZXQoKSkgewogICAgICAgICAgICBvdXQud3JpdGUoIi0t\nIittZXRhLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBvdXQud3JpdGUoIlxu\nIik7CiAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBhbm5vcyA9IChMaXN0PFN0\ncmluZz4pIG91dHB1dC5nZXQobWV0YSk7CiAgICAgICAgICAgIGZvcihTdHJp\nbmcgYW5uOiBhbm5vcykgewogICAgICAgICAgICAgICAgb3V0LndyaXRlKCJc\ndCIpOwogICAgICAgICAgICAgICAgb3V0LndyaXRlKGFubik7CiAgICAgICAg\nICAgICAgICBvdXQud3JpdGUoIlxuIik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VyaWFsaXplKGludCBmbGFn\ncykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlcHJlc2VudHMgb3JkZXJlZCBzZXQgb2YgCiAgICAgKiB7QGxp\nbmsgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRhRGF0YX1z\nIHdpdGggYSBjb21tb24gY2xhc3MKICAgICAqIHNjb3BlLgogICAgICoKICAg\nICAqIEBhdXRob3IgU3RlcGhlbiBLaW0KICAgICAqIEBhdXRob3IgUGluYWtp\nIFBvZGRhcgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBDbGFz\nc1NlcXMKICAgICAgICBpbXBsZW1lbnRzIFNvdXJjZVRyYWNrZXIsIENvbXBh\ncmFibGU8Q2xhc3NTZXFzPiwKICAgICAgICBDb21wYXJhdG9yPFNlcXVlbmNl\nTWV0YURhdGE+IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTZXF1ZW5jZU1l\ndGFEYXRhW10gX3NlcXM7CgogICAgICAgIHB1YmxpYyBDbGFzc1NlcXMoTGlz\ndDxTZXF1ZW5jZU1ldGFEYXRhPiBzZXFzKSB7CiAgICAgICAgICAgIGlmIChz\nZXFzID09IG51bGwgfHwgc2Vxcy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAgICAgICAg\nIF9zZXFzID0gKFNlcXVlbmNlTWV0YURhdGFbXSkgc2Vxcy50b0FycmF5CiAg\nICAgICAgICAgICAgICAobmV3IFNlcXVlbmNlTWV0YURhdGFbc2Vxcy5zaXpl\nKCldKTsKICAgICAgICAgICAgQXJyYXlzLnNvcnQoX3NlcXMsIHRoaXMpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGFbXSBn\nZXRTZXF1ZW5jZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2VxczsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENvbXBhcmUgc2VxdWVu\nY2UgbWV0YWRhdGEgb24gbmFtZS4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgaW50IGNvbXBhcmUoU2VxdWVuY2VNZXRhRGF0YSBvMSwgU2VxdWVuY2VN\nZXRhRGF0YSBvMikgewogICAgICAgICAgICByZXR1cm4gbzEuZ2V0TmFtZSgp\nLmNvbXBhcmVUbyhvMi5nZXROYW1lKCkpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIEZpbGUgZ2V0U291cmNlRmlsZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9zZXFzWzBdLmdldFNvdXJjZUZpbGUoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7CiAgICAgICAg\nICAgIHJldHVybiBfc2Vxc1swXS5nZXRTb3VyY2VTY29wZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBnZXRTb3VyY2VUeXBlKCkgewogICAg\nICAgICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0U291cmNlVHlwZSgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRSZXNvdXJjZU5hbWUo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfc2Vxc1swXS5nZXRSZXNvdXJjZU5h\nbWUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0TGluZU51\nbWJlcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZXFzWzBdLmdldExpbmVO\ndW1iZXIoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0Q29s\nTnVtYmVyKCkgewogICAgICAgICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0Q29s\nTnVtYmVyKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBp\nbnQgY29tcGFyZVRvKENsYXNzU2VxcyBvdGhlcikgewogICAgICAgICAgICBp\nZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiAwOwog\nICAgICAgICAgICBpZiAob3RoZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiAtMTsKICAgICAgICAgICAgQ2xhc3Mgc2NvcGUgPSAoQ2xhc3Mp\nIGdldFNvdXJjZVNjb3BlKCk7CiAgICAgICAgICAgIENsYXNzIG9zY29wZSA9\nIChDbGFzcykgb3RoZXIuZ2V0U291cmNlU2NvcGUoKTsKICAgICAgICAgICAg\ncmV0dXJuIHNjb3BlLmdldE5hbWUoKS5jb21wYXJlVG8ob3Njb3BlLmdldE5h\nbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVz\nZW50cyBvcmRlcmVkIHNldCBvZiB7QGxpbmsgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuUXVlcnlNZXRhRGF0YX1zCiAgICAgKiB3aXRoIGEgY29tbW9uIGNs\nYXNzIHNjb3BlLgogICAgICoKICAgICAqIEBhdXRob3IgU3RlcGhlbiBLaW0K\nICAgICAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBDbGFzc1F1ZXJpZXMKICAgICAgICBpbXBsZW1l\nbnRzIFNvdXJjZVRyYWNrZXIsIENvbXBhcmFibGU8Q2xhc3NRdWVyaWVzPiwK\nICAgICAgICBDb21wYXJhdG9yPFF1ZXJ5TWV0YURhdGE+IHsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBRdWVyeU1ldGFEYXRhW10gX3F1ZXJpZXM7CgogICAg\nICAgIHB1YmxpYyBDbGFzc1F1ZXJpZXMoTGlzdDxRdWVyeU1ldGFEYXRhPiBx\ndWVyaWVzKSB7CiAgICAgICAgICAgIGlmIChxdWVyaWVzID09IG51bGwgfHwg\ncXVlcmllcy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAgICAgICAgIF9xdWVyaWVzID0g\nKFF1ZXJ5TWV0YURhdGFbXSkgcXVlcmllcy50b0FycmF5CiAgICAgICAgICAg\nICAgICAobmV3IFF1ZXJ5TWV0YURhdGFbcXVlcmllcy5zaXplKCldKTsKICAg\nICAgICAgICAgQXJyYXlzLnNvcnQoX3F1ZXJpZXMsIHRoaXMpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFF1ZXJ5TWV0YURhdGFbXSBnZXRRdWVyaWVz\nKCkgewogICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXM7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBDb21wYXJlIHF1ZXJ5IG1ldGFkYXRh\nLiBOb3JtYWwgcXVlcmllcyBhcHBlYXIgYmVmb3JlIG5hdGl2ZSBxdWVyaWVz\nLgogICAgICAgICAqIElmIHRoZSBnaXZlbiBxdWVyaWVzIHVzZSBzYW1lIGxh\nbmd1YWdlLCB0aGVuIHRoZWlyIG5hbWVzIGFyZQogICAgICAgICAqIGNvbXBh\ncmVkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShR\ndWVyeU1ldGFEYXRhIG8xLCBRdWVyeU1ldGFEYXRhIG8yKSB7CiAgICAgICAg\nICAgIC8vIG5vcm1hbCBxdWVyaWVzIGJlZm9yZSBuYXRpdmUKICAgICAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHMobzEuZ2V0TGFuZ3VhZ2UoKSwg\nbzIuZ2V0TGFuZ3VhZ2UoKSkpIHsKICAgICAgICAgICAgICAgIGlmIChRdWVy\neUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMobzEuZ2V0TGFuZ3VhZ2UoKSkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBvMS5nZXROYW1lKCkuY29tcGFy\nZVRvKG8yLmdldE5hbWUoKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAgICAgICByZXR1cm4gX3F1\nZXJpZXNbMF0uZ2V0U291cmNlRmlsZSgpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE9iamVjdCBnZXRTb3VyY2VTY29wZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9xdWVyaWVzWzBdLmdldFNvdXJjZVNjb3BlKCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgaW50IGdldFNvdXJjZVR5cGUoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcXVlcmllc1swXS5nZXRTb3VyY2VUeXBlKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFJlc291cmNlTmFt\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVzWzBdLmdldFJlc291\ncmNlTmFtZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRM\naW5lTnVtYmVyKCkgewogICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXNbMF0u\nZ2V0TGluZU51bWJlcigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGlu\ndCBnZXRDb2xOdW1iZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmll\nc1swXS5nZXRDb2xOdW1iZXIoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgcHVibGljIGludCBjb21wYXJlVG8oQ2xhc3NRdWVyaWVzIG90aGVyKSB7\nCiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICAg\nICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBDbGFzcyBz\nY29wZSA9IChDbGFzcykgZ2V0U291cmNlU2NvcGUoKTsKICAgICAgICAgICAg\nQ2xhc3Mgb3Njb3BlID0gKENsYXNzKSBvdGhlci5nZXRTb3VyY2VTY29wZSgp\nOwogICAgICAgICAgICByZXR1cm4gc2NvcGUuZ2V0TmFtZSgpLmNvbXBhcmVU\nbyhvc2NvcGUuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21wYXJlcyBjbGFzZXMsIHNlcXVlbmNlcywgYW5kIHF1ZXJp\nZXMgdG8gb3JkZXIgdGhlbSBmb3Igc2VyaWFsaXphdGlvbi4KICAgICAqIFBs\nYWNlcyBzZXF1ZW5jZXMgZmlyc3QsIHRoZW4gY2xhc3NlcywgdGhlbiBxdWVy\naWVzLiBTZXF1ZW5jZXMgYW5kCiAgICAgKiBxdWVyaWVzIGFyZSBvcmRlcmVk\nIGFscGhhYmV0aWNhbGx5IGJ5IG5hbWUuIENsYXNzZXMgYXJlIHBsYWNlZCBp\nbgogICAgICogbGlzdGluZyBvcmRlciwgaW4gaW5oZXJpdGFuY2Ugb3JkZXIg\nd2l0aGluIHRoYXQsIGFuZCBpbiBhbHBoYWJldGljYWwKICAgICAqIG9yZGVy\nIHdpdGhpbiB0aGF0LgogICAgICoKICAgICAqIEBhdXRob3IgU3RlcGhlbiBL\naW0KICAgICAqLwogICAgcHJvdGVjdGVkIGNsYXNzIFNlcmlhbGl6YXRpb25D\nb21wYXJhdG9yCiAgICAgICAgZXh0ZW5kcyBNZXRhRGF0YUluaGVyaXRhbmNl\nQ29tcGFyYXRvciB7CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmpl\nY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBpZiAobzEgPT0gbzIp\nCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKG8x\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAg\nICAgaWYgKG8yID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7\nCgogICAgICAgICAgICBpbnQgdDEgPSB0eXBlKG8xKTsKICAgICAgICAgICAg\naW50IHQyID0gdHlwZShvMik7CiAgICAgICAgICAgIGlmICh0MSAhPSB0MikK\nICAgICAgICAgICAgICAgIHJldHVybiB0MSAtIHQyOwoKICAgICAgICAgICAg\nc3dpdGNoICh0MSkgewogICAgICAgICAgICAgICAgY2FzZSBUWVBFX01FVEE6\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoKENsYXNzTWV0\nYURhdGEpIG8xLCAoQ2xhc3NNZXRhRGF0YSkgbzIpOwogICAgICAgICAgICAg\nICAgY2FzZSBUWVBFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBjb21wYXJlKChRdWVyeU1ldGFEYXRhKSBvMSwgKFF1ZXJ5TWV0YURhdGEp\nIG8yKTsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9TRVE6CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUoKFNlcXVlbmNlTWV0YURhdGEp\nIG8xLAogICAgICAgICAgICAgICAgICAgICAgICAoU2VxdWVuY2VNZXRhRGF0\nYSkgbzIpOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFX0NMQVNTX1FVRVJJ\nRVM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoQ29tcGFyYWJsZSkg\nbzEpLmNvbXBhcmVUbyhvMik7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVf\nQ0xBU1NfU0VRUzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChDb21w\nYXJhYmxlKSBvMSkuY29tcGFyZVRvKG8yKTsKICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmVVbmtu\nb3duKG8xLCBvMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIENvbXBhcmUgdHdvIHVucmVjb2duaXplZCBlbGVt\nZW50cyBvZiB0aGUgc2FtZSB0eXBlLiBUaHJvd3MKICAgICAgICAgKiBleGNl\ncHRpb24gYnkgZGVmYXVsdC4KICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0\nZWQgaW50IGNvbXBhcmVVbmtub3duKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcGFyZSBiZXR3\nZWVuIHR3byBjbGFzcyBtZXRhZGF0YS4KICAgICAgICAgKi8KICAgICAgICBw\ncml2YXRlIGludCBjb21wYXJlKENsYXNzTWV0YURhdGEgbzEsIENsYXNzTWV0\nYURhdGEgbzIpIHsKICAgICAgICAgICAgaW50IGxpMSA9IG8xLmdldExpc3Rp\nbmdJbmRleCgpOwogICAgICAgICAgICBpbnQgbGkyID0gbzIuZ2V0TGlzdGlu\nZ0luZGV4KCk7CiAgICAgICAgICAgIGlmIChsaTEgPT0gLTEgJiYgbGkyID09\nIC0xKSB7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVRhZyB0MSA9IGdldEVu\ndGl0eVRhZyhvMSk7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVRhZyB0MiA9\nIGdldEVudGl0eVRhZyhvMik7CiAgICAgICAgICAgICAgICBpZiAodDEuY29t\ncGFyZVRvKHQyKSAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0\nMS5jb21wYXJlVG8odDIpOwogICAgICAgICAgICAgICAgaW50IGluaGVyID0g\nc3VwZXIuY29tcGFyZShvMSwgbzIpOwogICAgICAgICAgICAgICAgaWYgKGlu\naGVyICE9IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaGVyOwog\nICAgICAgICAgICAgICAgcmV0dXJuIG8xLmdldERlc2NyaWJlZFR5cGUoKS5n\nZXROYW1lKCkuY29tcGFyZVRvCiAgICAgICAgICAgICAgICAgICAgKG8yLmdl\ndERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAobGkxID09IC0xKQogICAgICAgICAgICAgICAgcmV0\ndXJuIDE7CiAgICAgICAgICAgIGlmIChsaTIgPT0gLTEpCiAgICAgICAgICAg\nICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIHJldHVybiBsaTEgLSBsaTI7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDb21wYXJlIHF1\nZXJ5IG1ldGFkYXRhLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgaW50\nIGNvbXBhcmUoUXVlcnlNZXRhRGF0YSBvMSwgUXVlcnlNZXRhRGF0YSBvMikg\newogICAgICAgICAgICAvLyBub3JtYWwgcXVlcmllcyBiZWZvcmUgbmF0aXZl\nCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuZXF1YWxzKG8xLmdldExh\nbmd1YWdlKCksIG8yLmdldExhbmd1YWdlKCkpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKG8xLmdldExh\nbmd1YWdlKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiAt\nMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbzEuZ2V0TmFt\nZSgpLmNvbXBhcmVUbyhvMi5nZXROYW1lKCkpOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogQ29tcGFyZSBzZXF1ZW5jZSBtZXRhZGF0YS4K\nICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIGludCBjb21wYXJlKFNlcXVl\nbmNlTWV0YURhdGEgbzEsIFNlcXVlbmNlTWV0YURhdGEgbzIpIHsKICAgICAg\nICAgICAgcmV0dXJuIG8xLmdldE5hbWUoKS5jb21wYXJlVG8obzIuZ2V0TmFt\nZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTb3J0cyBm\naWVsZHMgYWNjb3JkaW5nIHRvIGxpc3Rpbmcgb3JkZXIsIHRoZW4gWFNEIHN0\ncmF0ZWd5IG9yZGVyLAogICAgICogdGhlbiBuYW1lIG9yZGVyLgogICAgICov\nCiAgICBwcml2YXRlIGNsYXNzIEZpZWxkQ29tcGFyYXRvcgogICAgICAgIGlt\ncGxlbWVudHMgQ29tcGFyYXRvciB7CgogICAgICAgIHB1YmxpYyBpbnQgY29t\ncGFyZShPYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZDEgPSAoRmllbGRNZXRhRGF0YSkgbzE7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kMiA9IChGaWVsZE1ldGFEYXRhKSBvMjsK\nICAgICAgICAgICAgaWYgKGZtZDEuaXNQcmltYXJ5S2V5KCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChmbWQyLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmbWQxLmNvbXBhcmVUbyhmbWQyKTsKICAgICAg\nICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAoZm1kMi5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiAxOwoKICAgICAgICAgICAgaWYgKGZtZDEuaXNWZXJzaW9uKCkpIHsK\nICAgICAgICAgICAgICAgIGlmIChmbWQyLmlzVmVyc2lvbigpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBjb21wYXJlTGlzdGluZ09yZGVyKGZtZDEs\nIGZtZDIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFN0cmF0ZWd5KGZt\nZDIpID09IFBlcnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUMgPyAxIDogLTE7CgkJ\nCX0KCQkJaWYgKGZtZDIuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0U3RyYXRlZ3koZm1kMSkgPT0gUGVyc2lzdGVuY2VTdHJhdGVn\neS5CQVNJQyA/IC0xIDogMTsKCiAgICAgICAgICAgIGludCBzdGNtcCA9IGdl\ndFN0cmF0ZWd5KGZtZDEpLmNvbXBhcmVUbyhnZXRTdHJhdGVneShmbWQyKSk7\nCiAgICAgICAgICAgIGlmIChzdGNtcCAhPSAwKQogICAgICAgICAgICAgICAg\ncmV0dXJuIHN0Y21wOwogICAgICAgICAgICByZXR1cm4gY29tcGFyZUxpc3Rp\nbmdPcmRlcihmbWQxLCBmbWQyKTsKICAgICAgICB9CgogICAgICAgIHByaXZh\ndGUgaW50IGNvbXBhcmVMaXN0aW5nT3JkZXIoRmllbGRNZXRhRGF0YSBmbWQx\nLCBGaWVsZE1ldGFEYXRhIGZtZDIpewogICAgICAgICAgICBpbnQgbGNtcCA9\nIGZtZDEuZ2V0TGlzdGluZ0luZGV4KCkgLSBmbWQyLmdldExpc3RpbmdJbmRl\neCgpOwogICAgICAgICAgICBpZiAobGNtcCAhPSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGxjbXA7CiAgICAgICAgICAgIHJldHVybiBmbWQxLmNvbXBh\ncmVUbyhmbWQyKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

