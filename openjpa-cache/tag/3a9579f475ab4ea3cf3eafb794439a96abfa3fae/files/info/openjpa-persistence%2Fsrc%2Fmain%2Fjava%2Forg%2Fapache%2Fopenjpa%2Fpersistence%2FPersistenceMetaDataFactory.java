{"sha":"9c7bed23294a35e0db7e54348e595e1cc1800453","node_id":"MDQ6QmxvYjIwNjM2NDo5YzdiZWQyMzI5NGEzNWUwZGI3ZTU0MzQ4ZTU5NWUxY2MxODAwNDUz","size":20804,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9c7bed23294a35e0db7e54348e595e1cc1800453","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNj\nZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuU3RhY2s7CgppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudGl0\neTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xhc3M7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJpZXM7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5Owpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyaWVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlNxbFJlc3VsdFNldE1hcHBpbmc7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5TcWxSZXN1bHRTZXRNYXBwaW5nczsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLm1ldGFtb2RlbC5TdGF0aWNNZXRhbW9kZWw7CgppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkdlbmVy\naWNDb25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLm1ldGEuQ2xhc3NBbm5vdGF0aW9uTWV0YURhdGFGaWx0ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuTWV0YURhdGFGaWx0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuTWV0YURh\ndGFQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLk11bHRpQ2xhc3NMb2FkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkFic3RyYWN0Q0ZNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhRGVmYXVsdHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYWxF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRh\nRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiB7QGxpbmsgTWV0YURhdGFGYWN0b3J5\nfSBmb3IgSlBBIG1ldGFkYXRhLgogKgogKiBAYXV0aG9yIFN0ZXZlIEtpbQog\nKiBAc2luY2UgMC40LjAKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNz\nIFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5CiAgICBleHRlbmRzIEFic3Ry\nYWN0Q0ZNZXRhRGF0YUZhY3RvcnkKICAgIGltcGxlbWVudHMgQ29uZmlndXJh\nYmxlLCBHZW5lcmljQ29uZmlndXJhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nCiAgICAgICAgKFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5LmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFBlcnNpc3RlbmNlTWV0YURhdGFEZWZhdWx0\ncyBfZGVmID0gCiAgICAgICAgbmV3IFBlcnNpc3RlbmNlTWV0YURhdGFEZWZh\ndWx0cygpOwogICAgcHJpdmF0ZSBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRh\nRGF0YVBhcnNlciBfYW5ub1BhcnNlciA9IG51bGw7CiAgICBwcml2YXRlIEFu\nbm90YXRpb25QZXJzaXN0ZW5jZVhNTE1ldGFEYXRhUGFyc2VyIF9hbm5vWE1M\nUGFyc2VyID0gbnVsbDsKICAgIHByaXZhdGUgWE1MUGVyc2lzdGVuY2VNZXRh\nRGF0YVBhcnNlciBfeG1sUGFyc2VyID0gbnVsbDsKICAgIHByaXZhdGUgTWFw\nPFVSTCwgU2V0PFN0cmluZz4+IF94bWwgPSBudWxsOyAvLyB4bWwgcnNyYyAt\nPiBjbGFzcyBuYW1lcwogICAgcHJpdmF0ZSBTZXQ8VVJMPiBfdW5wYXJzZWQg\nPSBudWxsOyAvLyB4bWwgcnNyYwogICAgcHJpdmF0ZSBib29sZWFuIF9maWVs\nZE92ZXJyaWRlID0gdHJ1ZTsKCiAgICBwcm90ZWN0ZWQgU3RhY2s8WE1MUGVy\nc2lzdGVuY2VNZXRhRGF0YVBhcnNlcj4gX3N0YWNrID0gCiAgICAgICAgbmV3\nIFN0YWNrPFhNTFBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXI+KCk7CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBmaWVsZC1sZXZlbCBvdmVycmlk\nZSBvciBjbGFzcy1sZXZlbCBvdmVycmlkZS4KICAgICAqIERlZmF1bHRzIHRv\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZpZWxkT3ZlcnJp\nZGUoYm9vbGVhbiBmaWVsZCkgewogICAgICAgIF9maWVsZE92ZXJyaWRlID0g\nZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBm\naWVsZC1sZXZlbCBvdmVycmlkZSBvciBjbGFzcy1sZXZlbCBvdmVycmlkZS4K\nICAgICAqIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGdldEZpZWxkT3ZlcnJpZGUoKSB7CiAgICAgICAgcmV0dXJuIF9m\naWVsZE92ZXJyaWRlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIG1l\ndGFkYXRhIHBhcnNlciwgY3JlYXRpbmcgaXQgaWYgaXQgZG9lcyBub3QgYWxy\nZWFkeSBleGlzdC4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25QZXJz\naXN0ZW5jZU1ldGFEYXRhUGFyc2VyIGdldEFubm90YXRpb25QYXJzZXIoKSB7\nCiAgICAgICAgaWYgKF9hbm5vUGFyc2VyID09IG51bGwpIHsKICAgICAgICAg\nICAgX2Fubm9QYXJzZXIgPSBuZXdBbm5vdGF0aW9uUGFyc2VyKCk7CiAgICAg\nICAgICAgIF9hbm5vUGFyc2VyLnNldFJlcG9zaXRvcnkocmVwb3MpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2Fubm9QYXJzZXI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIG1ldGFkYXRhIHBhcnNlci4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QW5ub3RhdGlvblBhcnNlcigKICAgICAgICBB\nbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBwYXJzZXIpIHsK\nICAgICAgICBpZiAoX2Fubm9QYXJzZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nX2Fubm9QYXJzZXIuc2V0UmVwb3NpdG9yeShudWxsKTsKICAgICAgICBpZiAo\ncGFyc2VyICE9IG51bGwpCiAgICAgICAgICAgIHBhcnNlci5zZXRSZXBvc2l0\nb3J5KHJlcG9zKTsKICAgICAgICBfYW5ub1BhcnNlciA9IHBhcnNlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSBwYXJz\nZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBBbm5vdGF0aW9uUGVyc2lzdGVu\nY2VNZXRhRGF0YVBhcnNlciBuZXdBbm5vdGF0aW9uUGFyc2VyKCkgewogICAg\nICAgIHJldHVybiBuZXcgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQ\nYXJzZXIKICAgICAgICAgICAgKHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgYW5ub3RhdGlv\nbiBzZXJpYWxpemVyLgogICAgICovCiAgICBwcm90ZWN0ZWQgQW5ub3RhdGlv\nblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyCiAgICAgICAgbmV3QW5u\nb3RhdGlvblNlcmlhbGl6ZXIoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbm5v\ndGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVNlcmlhbGl6ZXIKICAgICAgICAg\nICAgKHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gWE1MIG1ldGFkYXRhIHBhcnNlciwgY3JlYXRpbmcg\naXQgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdCBvcgogICAgICogaWYg\ndGhlIGV4aXN0aW5nIHBhcnNlciBpcyBwYXJzaW5nLgogICAgICovCiAgICBw\ndWJsaWMgWE1MUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBnZXRYTUxQYXJz\nZXIoKSB7CiAgICAgICAgaWYgKF94bWxQYXJzZXIgPT0gbnVsbCB8fCBfeG1s\nUGFyc2VyLmlzUGFyc2luZygpKSB7CiAgICAgICAgICAgIENsYXNzPD8+IHBh\ncnNlQ2xzID0gbnVsbDsKICAgICAgICAgICAgQXJyYXlMaXN0PENsYXNzPD8+\nPiBwYXJzZUxpc3QgPSBudWxsOwogICAgICAgICAgICAvLyBJZiB0aGVyZSBp\ncyBhbiBleGlzdGluZyBwYXJzZXIgYW5kIGl0IGlzIHBhcnNpbmcsIHB1c2gg\naXQgb24KICAgICAgICAgICAgLy8gdGhlIHN0YWNrIGFuZCByZXR1cm4gYSBu\nZXcgb25lLgogICAgICAgICAgICBpZiAoX3htbFBhcnNlciAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBfc3RhY2sucHVzaChfeG1sUGFyc2VyKTsKICAg\nICAgICAgICAgICAgIHBhcnNlQ2xzID0gX3htbFBhcnNlci5nZXRQYXJzZUNs\nYXNzKCk7CiAgICAgICAgICAgICAgICBwYXJzZUxpc3QgPSBfeG1sUGFyc2Vy\nLmdldFBhcnNlTGlzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF94\nbWxQYXJzZXIgPSBuZXdYTUxQYXJzZXIodHJ1ZSk7CiAgICAgICAgICAgIF94\nbWxQYXJzZXIuYWRkVG9QYXJzZUxpc3QocGFyc2VMaXN0KTsKICAgICAgICAg\nICAgX3htbFBhcnNlci5hZGRUb1BhcnNlTGlzdChwYXJzZUNscyk7CiAgICAg\nICAgICAgIF94bWxQYXJzZXIuc2V0UmVwb3NpdG9yeShyZXBvcyk7CiAgICAg\nICAgICAgIGlmIChfZmllbGRPdmVycmlkZSkKICAgICAgICAgICAgICAgIF94\nbWxQYXJzZXIuc2V0QW5ub3RhdGlvblBhcnNlcihnZXRBbm5vdGF0aW9uUGFy\nc2VyKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3htbFBhcnNlcjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXNldFhNTFBhcnNlcigpIHsKICAg\nICAgICAvLyBJZiBhIHBhcnNlciB3YXMgcHVzaGVkIG9uIHRoZSBzdGFjayBk\ndWUgdG8gbXVsdGktbGV2ZWwgcGFyc2luZywgCiAgICAgICAgLy8gY2xlYXIg\ndGhlIGN1cnJlbnQgcGFyc2VyIGFuZCBwb3AgdGhlIGlubmVyIHBhcnNlciBv\nZmYgdGhlIHN0YWNrLgogICAgICAgIGlmICghX3N0YWNrLmlzRW1wdHkoKSkg\newogICAgICAgICAgICBfeG1sUGFyc2VyLmNsZWFyKCk7CiAgICAgICAgICAg\nIF94bWxQYXJzZXIgPSBfc3RhY2sucG9wKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBtZXRhZGF0YSBwYXJzZXIuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFhNTFBhcnNlcihYTUxQZXJzaXN0ZW5j\nZU1ldGFEYXRhUGFyc2VyIHBhcnNlcikgewogICAgICAgIGlmIChfeG1sUGFy\nc2VyICE9IG51bGwpCiAgICAgICAgICAgIF94bWxQYXJzZXIuc2V0UmVwb3Np\ndG9yeShudWxsKTsKICAgICAgICBpZiAocGFyc2VyICE9IG51bGwpCiAgICAg\nICAgICAgIHBhcnNlci5zZXRSZXBvc2l0b3J5KHJlcG9zKTsKICAgICAgICBf\neG1sUGFyc2VyID0gcGFyc2VyOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgbmV3IG1ldGFkYXRhIHBhcnNlci4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFhNTFBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIgbmV3WE1MUGFyc2Vy\nKGJvb2xlYW4gbG9hZGluZykgewogICAgICAgIHJldHVybiBuZXcgWE1MUGVy\nc2lzdGVuY2VNZXRhRGF0YVBhcnNlcihyZXBvcy5nZXRDb25maWd1cmF0aW9u\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNlcmlh\nbGl6ZXIKICAgICAqLwogICAgcHJvdGVjdGVkIFhNTFBlcnNpc3RlbmNlTWV0\nYURhdGFTZXJpYWxpemVyIG5ld1hNTFNlcmlhbGl6ZXIoKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBYTUxQZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplcihy\nZXBvcy5nZXRDb25maWd1cmF0aW9uKCkpOwogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCBsb2FkKENsYXNzPD8+IGNscywgaW50IG1vZGUsIENsYXNzTG9h\nZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9O\nRSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICghc3RyaWN0ICYm\nIChtb2RlICYgTU9ERV9NRVRBKSAhPSAwKQogICAgICAgICAgICBtb2RlIHw9\nIE1PREVfTUFQUElORzsKCiAgICAgICAgLy8gZ2V0dGluZyB0aGUgbGlzdCBv\nZiBwZXJzaXN0ZW50IHR5cGVzIHJ1bnMgY2FsbGJhY2tzIHRvCiAgICAgICAg\nLy8gbWFwUGVyc2lzdGVudFR5cGVOYW1lcyBpZiBpdCBoYXNuJ3QgYmVlbiBj\nYWxsZWQgYWxyZWFkeSwgd2hpY2gKICAgICAgICAvLyBjYWNoZXMgWE1MIHJl\nc291cmNlcwogICAgICAgIGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2Us\nIGVudkxvYWRlcik7CiAgICAgICAgVVJMIHhtbCA9IGZpbmRYTUwoY2xzKTsK\nCiAgICAgICAgLy8gd2UgaGF2ZSB0byBwYXJzZSBtZXRhZGF0YSB1cC1mcm9u\ndCB0byByZWdpc3RlciBwZXJzaXN0ZW5jZSB1bml0CiAgICAgICAgLy8gZGVm\nYXVsdHMgYW5kIHN5c3RlbSBjYWxsYmFja3MKICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGE7CiAgICAgICAgYm9vbGVhbiBwYXJzZWRYTUwgPSBmYWxzZTsK\nICAgICAgICBpZiAoX3VucGFyc2VkICE9IG51bGwgJiYgIV91bnBhcnNlZC5p\nc0VtcHR5KCkKICAgICAgICAgICAgJiYgKG1vZGUgJiBNT0RFX01FVEEpICE9\nIDApIHsKICAgICAgICAgICAgU2V0PFVSTD4gdW5wYXJzZWQgPSBuZXcgSGFz\naFNldDxVUkw+KF91bnBhcnNlZCk7CiAgICAgICAgICAgIGZvciAoVVJMIHVy\nbCA6IHVucGFyc2VkKSB7CiAgICAgICAgICAgICAgICBwYXJzZVhNTCh1cmws\nIGNscywgbW9kZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwYXJzZWRYTUwgPSB1bnBhcnNlZC5jb250YWlucyh4bWwpOwogICAg\nICAgICAgICAgX3VucGFyc2VkLmNsZWFyKCk7CgogICAgICAgICAgICAvLyBY\nTUwgcHJvY2VzcyBjaGVjawogICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0\nQ2FjaGVkTWV0YURhdGEoY2xzKTsKICAgICAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBtb2RlKSA9PSBtb2Rl\nKSB7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0cmF0ZWdpZXMobWV0YSk7\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIG1pZ2h0IGhhdmUgYmVlbiBsb29raW5nIGZvciBz\neXN0ZW0tbGV2ZWwgcXVlcnkKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gd2UgbWF5IHN0aWxsIG5l\nZWQgdG8gcGFyc2UgWE1MIGlmIHRoaXMgaXMgYSByZWRlcGxveSBvZiBhIGNs\nYXNzLCBvcgogICAgICAgIC8vIGlmIHdlJ3JlIGluIHN0cmljdCBxdWVyeS1v\nbmx5IG1vZGUKICAgICAgICBpZiAoIXBhcnNlZFhNTCAmJiB4bWwgIT0gbnVs\nbCkgewogICAgICAgICAgICBwYXJzZVhNTCh4bWwsIGNscywgbW9kZSwgZW52\nTG9hZGVyKTsKICAgICAgICAgICAgLy8gWE1MIHByb2Nlc3MgY2hlY2sKICAg\nICAgICAgICAgbWV0YSA9IHJlcG9zLmdldENhY2hlZE1ldGFEYXRhKGNscyk7\nCiAgICAgICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgKG1ldGEuZ2V0U291\ncmNlTW9kZSgpICYgbW9kZSkgPT0gbW9kZSkgewogICAgICAgICAgICAgICAg\ndmFsaWRhdGVTdHJhdGVnaWVzKG1ldGEpOwogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBBbm5vdGF0\naW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBwYXJzZXIgPSBnZXRBbm5v\ndGF0aW9uUGFyc2VyKCk7CiAgICAgICAgcGFyc2VyLnNldEVudkNsYXNzTG9h\nZGVyKGVudkxvYWRlcik7CiAgICAgICAgcGFyc2VyLnNldE1vZGUobW9kZSk7\nCiAgICAgICAgcGFyc2VyLnBhcnNlKGNscyk7CgogICAgICAgIG1ldGEgPSBy\nZXBvcy5nZXRDYWNoZWRNZXRhRGF0YShjbHMpOwogICAgICAgIGlmIChtZXRh\nICE9IG51bGwgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgbW9kZSkgPT0g\nbW9kZSkKICAgICAgICAgICAgdmFsaWRhdGVTdHJhdGVnaWVzKG1ldGEpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgdGhlIGdpdmVuIFhNTCByZXNv\ndXJjZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlWE1MKFVSTCB4\nbWwsIENsYXNzPD8+IGNscywgaW50IG1vZGUsIAogICAgCUNsYXNzTG9hZGVy\nIGVudkxvYWRlcikgewogICAgICAgIC8vIHNwcmluZyBuZWVkcyB0byB1c2Ug\ndGhlIGVudkxvYWRlciBmaXJzdCBmb3IgYWxsIGNsYXNzIHJlc29sdXRpb24s\nCiAgICAgICAgLy8gYnV0IHdlIG11c3Qgc3RpbGwgZmFsbCBiYWNrIG9uIGFw\ncGxpY2F0aW9uIGxvYWRlcgogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9\nIHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0Q2xh\nc3NSZXNvbHZlckluc3RhbmNlKCkuZ2V0Q2xhc3NMb2FkZXIoY2xzLCBudWxs\nKTsKICAgICAgICBpZiAoZW52TG9hZGVyICE9IG51bGwgJiYgZW52TG9hZGVy\nICE9IGxvYWRlcikgewogICAgICAgICAgTXVsdGlDbGFzc0xvYWRlciBtdWx0\nID0gbmV3IE11bHRpQ2xhc3NMb2FkZXIoKTsKICAgICAgICAgIG11bHQuYWRk\nQ2xhc3NMb2FkZXIoZW52TG9hZGVyKTsKCiAgICAgICAgICAvLyBsb2FkZXIg\nZnJvbSByZXNvbHZlciBpcyB1c3VhbGx5IGEgbXVsdGkgbG9hZGVyIGl0c2Vs\nZgogICAgICAgICAgaWYgKGxvYWRlciBpbnN0YW5jZW9mIE11bHRpQ2xhc3NM\nb2FkZXIpCiAgICAgICAgICAgIG11bHQuYWRkQ2xhc3NMb2FkZXJzKChNdWx0\naUNsYXNzTG9hZGVyKWxvYWRlcik7CiAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgIG11bHQuYWRkQ2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAgIGxv\nYWRlciA9IG11bHQ7CiAgICAgICAgfQogICAgCiAgICAgICAgWE1MUGVyc2lz\ndGVuY2VNZXRhRGF0YVBhcnNlciB4bWxQYXJzZXIgPSBnZXRYTUxQYXJzZXIo\nKTsKICAgICAgICB4bWxQYXJzZXIuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsK\nICAgICAgICB4bWxQYXJzZXIuc2V0RW52Q2xhc3NMb2FkZXIoZW52TG9hZGVy\nKTsKICAgICAgICB4bWxQYXJzZXIuc2V0TW9kZShtb2RlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICB4bWxQYXJzZXIucGFyc2UoeG1sKTsKICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oaW9lKTsKICAgICAgICB9CiAgICAg\nICAgZmluYWxseSB7CiAgICAgICAgICAgIHJlc2V0WE1MUGFyc2VyKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9jYXRlIHRoZSBYTUwg\ncmVzb3VyY2UgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBVUkwgZmluZFhNTChDbGFzczw/PiBjbHMpIHsKICAgICAgICBpZiAo\nX3htbCAhPSBudWxsICYmIGNscyAhPSBudWxsKQogICAgICAgICAgICBmb3Ig\nKE1hcC5FbnRyeTxVUkwsIFNldDxTdHJpbmc+PiBlbnRyeSA6IF94bWwuZW50\ncnlTZXQoKSkKICAgICAgICAgICAgICAgIGlmIChlbnRyeS5nZXRWYWx1ZSgp\nLmNvbnRhaW5zKGNscy5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBlbnRyeS5nZXRLZXkoKTsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG1hcFBl\ncnNpc3RlbnRUeXBlTmFtZXMoT2JqZWN0IHJzcmMsIFN0cmluZ1tdIG5hbWVz\nKSB7CiAgICAgICAgaWYgKHJzcmMudG9TdHJpbmcoKS5lbmRzV2l0aCgiLmNs\nYXNzIikpIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKAogICAgICAgICAgICAgICAg\nICAgIF9sb2MuZ2V0KCJtYXAtcGVyc2lzdGVudC10eXBlcy1za2lwcGluZy1j\nbGFzcyIsIHJzcmMpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0g\nZWxzZSBpZiAoIShyc3JjIGluc3RhbmNlb2YgVVJMKSkgewogICAgICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoCiAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoIm1hcC1w\nZXJzaXN0ZW50LXR5cGVzLXNraXBwaW5nLW5vbi11cmwiLCByc3JjKSk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKHJzcmMudG9T\ndHJpbmcoKS5lbmRzV2l0aCgiLyIpKSB7CiAgICAgICAgICAgIC8vIE9QRU5K\nUEEtMTU0NiBJZiB0aGUgcnNyYyBVUkwgaXMgYSBkaXJlY3RvcnkgaXQgc2hv\ndWxkIG5vdCBiZQogICAgICAgICAgICAvLyBhZGRlZCB0byB0aGUgbGlzdCBv\nZiB0aGUgdW5wYXJzZWQgWE1MIGZpbGVzCiAgICAgICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShf\nbG9jLmdldCgibWFwLXBlcnNpc3RlbnQtdHlwZXMtc2tpcHBpbmctZGlyIiwg\ncnNyYykpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50\ncmFjZShfbG9jLmdldCgKICAgICAgICAgICAgICAgICJtYXAtcGVyc2lzdGVu\ndC10eXBlLW5hbWVzIiwgcnNyYywgQXJyYXlzLmFzTGlzdChuYW1lcykpKTsK\nICAgICAgICAKICAgICAgICBpZiAoX3htbCA9PSBudWxsKQogICAgICAgICAg\nICBfeG1sID0gbmV3IEhhc2hNYXA8VVJMLCBTZXQ8U3RyaW5nPj4oKTsKICAg\nICAgICBfeG1sLnB1dCgoVVJMKSByc3JjLCBuZXcgSGFzaFNldDxTdHJpbmc+\nKEFycmF5cy5hc0xpc3QobmFtZXMpKSk7CgogICAgICAgIGlmIChfdW5wYXJz\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgX3VucGFyc2VkID0gbmV3IEhhc2hT\nZXQ8VVJMPigpOwogICAgICAgIF91bnBhcnNlZC5hZGQoKFVSTCkgcnNyYyk7\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0\nUXVlcnlTY29wZShTdHJpbmcgcXVlcnlOYW1lLCBDbGFzc0xvYWRlciBsb2Fk\nZXIpIHsKICAgICAgICBpZiAocXVlcnlOYW1lID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+\nIGNsYXNzZXMgPSByZXBvcy5sb2FkUGVyc2lzdGVudFR5cGVzKGZhbHNlLCBs\nb2FkZXIpOwogICAgICAgIGZvciAoQ2xhc3M8Pz4gY2xzIDogIGNsYXNzZXMp\nIHsKICAgICAgICAgICAgaWYgKChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3Rh\ndGlvblByZXNlbnRBY3Rpb24oY2xzLCBOYW1lZFF1ZXJ5LmNsYXNzKSkpCiAg\nICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkgJiYgaGFzTmFtZWRRdWVy\neQogICAgICAgICAgICAgICAgKHF1ZXJ5TmFtZSwgKE5hbWVkUXVlcnkpIGNs\ncy5nZXRBbm5vdGF0aW9uKE5hbWVkUXVlcnkuY2xhc3MpKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBjbHM7CiAgICAgICAgICAgIGlmICgoQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGNscywgTmFtZWRR\ndWVyaWVzLmNsYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVl\nKCkgJiYKICAgICAgICAgICAgICAgIGhhc05hbWVkUXVlcnkocXVlcnlOYW1l\nLCAoKE5hbWVkUXVlcmllcykgY2xzLgogICAgICAgICAgICAgICAgICAgIGdl\ndEFubm90YXRpb24oTmFtZWRRdWVyaWVzLmNsYXNzKSkudmFsdWUoKSkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gY2xzOwogICAgICAgICAgICBpZiAoKEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAg\nICAgICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihjbHMs\nIE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MpKSkKICAgICAgICAgICAgICAgIC5i\nb29sZWFuVmFsdWUoKSAmJgogICAgICAgICAgICAgICAgaGFzTmFtZWROYXRp\ndmVRdWVyeShxdWVyeU5hbWUsIChOYW1lZE5hdGl2ZVF1ZXJ5KSBjbHMuCiAg\nICAgICAgICAgICAgICAgICAgZ2V0QW5ub3RhdGlvbihOYW1lZE5hdGl2ZVF1\nZXJ5LmNsYXNzKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gY2xzOwogICAg\nICAgICAgICBpZiAoKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJl\nc2VudEFjdGlvbihjbHMsIE5hbWVkTmF0aXZlUXVlcmllcy5jbGFzcykpKQog\nICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1ZSgpICYmCiAgICAgICAgICAg\nICAgICBoYXNOYW1lZE5hdGl2ZVF1ZXJ5KHF1ZXJ5TmFtZSwgKChOYW1lZE5h\ndGl2ZVF1ZXJpZXMpIGNscy4KICAgICAgICAgICAgICAgICAgICBnZXRBbm5v\ndGF0aW9uKE5hbWVkTmF0aXZlUXVlcmllcy5jbGFzcykpLnZhbHVlKCkpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGNsczsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\nQ2xhc3M8Pz4gZ2V0UmVzdWx0U2V0TWFwcGluZ1Njb3BlKFN0cmluZyByc01h\ncHBpbmdOYW1lLAogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAg\nICAgIGlmIChyc01hcHBpbmdOYW1lID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIAogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8\nPz4+IGNsYXNzZXMgPSByZXBvcy5sb2FkUGVyc2lzdGVudFR5cGVzKGZhbHNl\nLCBsb2FkZXIpOwogICAgICAgIGZvciAoQ2xhc3M8Pz4gY2xzIDogY2xhc3Nl\ncykgewoKICAgICAgICAgICAgaWYgKChBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgLmlzQW5u\nb3RhdGlvblByZXNlbnRBY3Rpb24oY2xzLCBTcWxSZXN1bHRTZXRNYXBwaW5n\nLmNsYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkgJiYK\nICAgICAgICAgICAgICAgIGhhc1JTTWFwcGluZyhyc01hcHBpbmdOYW1lLCAo\nU3FsUmVzdWx0U2V0TWFwcGluZykgY2xzLgogICAgICAgICAgICAgICAgZ2V0\nQW5ub3RhdGlvbihTcWxSZXN1bHRTZXRNYXBwaW5nLmNsYXNzKSkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gY2xzOwoKICAgICAgICAgICAgaWYgKChBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAg\nICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oY2xzLCBT\ncWxSZXN1bHRTZXRNYXBwaW5ncy5jbGFzcykpKQogICAgICAgICAgICAgICAg\nLmJvb2xlYW5WYWx1ZSgpICYmCiAgICAgICAgICAgICAgICBoYXNSU01hcHBp\nbmcocnNNYXBwaW5nTmFtZSwgKChTcWxSZXN1bHRTZXRNYXBwaW5ncykgY2xz\nLgogICAgICAgICAgICAgICAgZ2V0QW5ub3RhdGlvbihTcWxSZXN1bHRTZXRN\nYXBwaW5ncy5jbGFzcykpLnZhbHVlKCkpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGNsczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgcHJpdmF0ZSBib29sZWFuIGhhc05hbWVkUXVlcnkoU3RyaW5nIHF1\nZXJ5LCBOYW1lZFF1ZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBmb3IgKE5h\nbWVkUXVlcnkgcSA6IHF1ZXJpZXMpIHsKICAgICAgICAgICAgaWYgKHF1ZXJ5\nLmVxdWFscyhxLm5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHByaXZhdGUgYm9vbGVhbiBoYXNSU01hcHBpbmcoU3RyaW5nIHJzTWFwcGlu\nZywKICAgICAgICBTcWxSZXN1bHRTZXRNYXBwaW5nLi4uIG1hcHBpbmdzKSB7\nCiAgICAgICAgZm9yIChTcWxSZXN1bHRTZXRNYXBwaW5nIG0gOiBtYXBwaW5n\ncykgewogICAgICAgICAgICBpZiAocnNNYXBwaW5nLmVxdWFscyhtLm5hbWUo\nKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVh\nbiBoYXNOYW1lZE5hdGl2ZVF1ZXJ5KFN0cmluZyBxdWVyeSwKICAgICAgICBO\nYW1lZE5hdGl2ZVF1ZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBmb3IgKE5h\nbWVkTmF0aXZlUXVlcnkgcSA6IHF1ZXJpZXMpIHsKICAgICAgICAgICAgaWYg\nKHF1ZXJ5LmVxdWFscyhxLm5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIE1ldGFEYXRhRmlsdGVy\nIG5ld01ldGFEYXRhRmlsdGVyKCkgewogICAgICAgIENsYXNzQW5ub3RhdGlv\nbk1ldGFEYXRhRmlsdGVyIGNhbWRmID0gbmV3IENsYXNzQW5ub3RhdGlvbk1l\ndGFEYXRhRmlsdGVyKAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBF\nbnRpdHkuY2xhc3MsIEVtYmVkZGFibGUuY2xhc3MsCiAgICAgICAgICAgICAg\nICAgICAgICAgIE1hcHBlZFN1cGVyY2xhc3MuY2xhc3MgfSk7CiAgICAgICAg\nY2FtZGYuc2V0TG9nKGxvZyk7CiAgICAgICAgcmV0dXJuIGNhbWRmOwogICAg\nfQoKICAgIC8qKgogICAgICogRW5zdXJlIGFsbCBmaWVsZHMgaGF2ZSBkZWNs\nYXJlZCBhIHN0cmF0ZWd5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFs\naWRhdGVTdHJhdGVnaWVzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIFN0cmluZ0J1aWxkZXIgYnVmID0gbnVsbDsKICAgICAgICBmb3IgKEZpZWxk\nTWV0YURhdGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKSB7CiAg\nICAgICAgICAgIGlmICghZm1kLmlzRXhwbGljaXQoKSkgewogICAgICAgICAg\nICAgICAgaWYgKGJ1ZiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGJ1\nZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoZm1kKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpZiAoYnVmICE9IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcGVycy1z\ndHJhdCIsIGJ1ZikpOwogICAgfQoKICAgIHB1YmxpYyBNZXRhRGF0YURlZmF1\nbHRzIGdldERlZmF1bHRzKCkgewogICAgICAgIHJldHVybiBfZGVmOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENsYXNzQXJnUGFyc2VyIG5l\nd0NsYXNzQXJnUGFyc2VyKCkgewogICAgICAgIENsYXNzQXJnUGFyc2VyIHBh\ncnNlciA9IG5ldyBDbGFzc0FyZ1BhcnNlcigpOwogICAgICAgIHBhcnNlci5z\nZXRNZXRhRGF0YVN0cnVjdHVyZSgicGFja2FnZSIsIG51bGwsIG5ldyBTdHJp\nbmdbXXsKICAgICAgICAgICAgImVudGl0eSIsICJlbWJlZGRhYmxlIiwgIm1h\ncHBlZC1zdXBlcmNsYXNzIiB9LCAiY2xhc3MiKTsKICAgICAgICByZXR1cm4g\ncGFyc2VyOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICBpZiAo\nX2Fubm9QYXJzZXIgIT0gbnVsbCkKICAgICAgICAgICAgX2Fubm9QYXJzZXIu\nY2xlYXIoKTsKICAgICAgICBpZiAoX3htbFBhcnNlciAhPSBudWxsKQogICAg\nICAgICAgICBfeG1sUGFyc2VyLmNsZWFyKCk7CiAgICAgICAgaWYgKF94bWwg\nIT0gbnVsbCkKICAgICAgICAgICAgX3htbC5jbGVhcigpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBQYXJzZXIgbmV3UGFyc2VyKGJvb2xlYW4gbG9hZGluZykg\newogICAgICAgIHJldHVybiBuZXdYTUxQYXJzZXIobG9hZGluZyk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIFNlcmlhbGl6ZXIgbmV3U2VyaWFsaXplcigpIHsK\nICAgICAgICByZXR1cm4gbmV3WE1MU2VyaWFsaXplcigpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2UoTWV0YURhdGFQ\nYXJzZXIgcGFyc2VyLCBDbGFzc1tdIGNscykgewogICAgICAgIHBhcnNlKHBh\ncnNlciwgQ29sbGVjdGlvbnMuc2luZ2xldG9uKGRlZmF1bHRYTUxGaWxlKCkp\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmlsZSBkZWZhdWx0U291cmNlRmls\nZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gZGVmYXVs\ndFhNTEZpbGUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmlsZSBkZWZhdWx0\nU291cmNlRmlsZShRdWVyeU1ldGFEYXRhIHF1ZXJ5LCBNYXAgY2xzTmFtZXMp\nIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBnZXREZWZpbmluZ01l\ndGFEYXRhKHF1ZXJ5LCBjbHNOYW1lcyk7CiAgICAgICAgRmlsZSBmaWxlID0g\nKG1ldGEgPT0gbnVsbCkgPyBudWxsIDogbWV0YS5nZXRTb3VyY2VGaWxlKCk7\nCiAgICAgICAgaWYgKGZpbGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZpbGU7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRYTUxGaWxlKCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIEZpbGUgZGVmYXVsdFNvdXJjZUZpbGUoU2VxdWVu\nY2VNZXRhRGF0YSBzZXEsIE1hcCBjbHNOYW1lcykgewogICAgICAgIHJldHVy\nbiBkZWZhdWx0WE1MRmlsZSgpOwogICAgfQoKICAgIC8qKgogICAgICogTG9v\nayBmb3IgTUVUQS1JTkYvb3JtLnhtbCwgYW5kIGlmIGl0IGRvZXNuJ3QgZXhp\nc3QsIGNob29zZSBhIGRlZmF1bHQuCiAgICAgKi8KICAgIHByaXZhdGUgRmls\nZSBkZWZhdWx0WE1MRmlsZSgpIHsKICAgICAgICBDbGFzc0xvYWRlciBsb2Fk\nZXIgPSByZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdl\ndENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLmdldENsYXNzTG9hZGVyKGdldENs\nYXNzKCksIG51bGwpOwogICAgICAgIFVSTCByc3JjID0gQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLmdldFJlc291cmNlQWN0aW9uKGxvYWRlciwgIk1FVEEtSU5GL29ybS54bWwi\nKSk7CiAgICAgICAgaWYgKHJzcmMgIT0gbnVsbCkgewogICAgICAgICAgICBG\naWxlIGZpbGUgPSBuZXcgRmlsZShyc3JjLmdldEZpbGUoKSk7CiAgICAgICAg\nICAgIGlmICgoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5leGlzdHNBY3Rpb24oZmlsZSkp\nKS5ib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgIHJldHVybiBmaWxl\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEZpbGUoIm9ybS54bWwi\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1cmF0aW9uKENv\nbmZpZ3VyYXRpb24gY29uZikgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nYXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBl\nbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIGlmIChyc3JjcyA9PSBudWxs\nKQogICAgICAgICAgICByc3JjcyA9IENvbGxlY3Rpb25zLnNpbmdsZXRvbigi\nTUVUQS1JTkYvb3JtLnhtbCIpOwogICAgICAgIGVsc2UKCQkJcnNyY3MuYWRk\nKCJNRVRBLUlORi9vcm0ueG1sIik7Cgl9CgogICAgcHVibGljIHZvaWQgc2V0\nSW50byhPcHRpb25zIG9wdHMpIHsKICAgICAgICBvcHRzLmtleVNldCgpLnJl\ndGFpbkFsbChvcHRzLnNldEludG8oX2RlZikua2V5U2V0KCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIEpBWEIgWE1MIGFubm90YXRpb24gcGFy\nc2VyLCAKICAgICAqIGNyZWF0aW5nIGl0IGlmIGl0IGRvZXMgbm90IGFscmVh\nZHkgZXhpc3QuCiAgICAgKi8KICAgIHB1YmxpYyBBbm5vdGF0aW9uUGVyc2lz\ndGVuY2VYTUxNZXRhRGF0YVBhcnNlciBnZXRYTUxBbm5vdGF0aW9uUGFyc2Vy\nKCkgewogICAgICAgIGlmIChfYW5ub1hNTFBhcnNlciA9PSBudWxsKSB7CiAg\nICAgICAgICAgIF9hbm5vWE1MUGFyc2VyID0gbmV3WE1MQW5ub3RhdGlvblBh\ncnNlcigpOwogICAgICAgICAgICBfYW5ub1hNTFBhcnNlci5zZXRSZXBvc2l0\nb3J5KHJlcG9zKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hbm5vWE1M\nUGFyc2VyOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBKQVhCIFhN\nTCBhbm5vdGF0aW9uIHBhcnNlci4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0WE1MQW5ub3RhdGlvblBhcnNlcigKICAgICAgICBBbm5vdGF0aW9uUGVy\nc2lzdGVuY2VYTUxNZXRhRGF0YVBhcnNlciBwYXJzZXIpIHsKICAgICAgICBp\nZiAoX2Fubm9YTUxQYXJzZXIgIT0gbnVsbCkKICAgICAgICAgICAgX2Fubm9Y\nTUxQYXJzZXIuc2V0UmVwb3NpdG9yeShudWxsKTsKICAgICAgICBpZiAocGFy\nc2VyICE9IG51bGwpCiAgICAgICAgICAgIHBhcnNlci5zZXRSZXBvc2l0b3J5\nKHJlcG9zKTsKICAgICAgICBfYW5ub1hNTFBhcnNlciA9IHBhcnNlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBKQVhCIFhNTCBhbm5v\ndGF0aW9uIHBhcnNlci4KICAgICAqLwogICAgcHJvdGVjdGVkIEFubm90YXRp\nb25QZXJzaXN0ZW5jZVhNTE1ldGFEYXRhUGFyc2VyIG5ld1hNTEFubm90YXRp\nb25QYXJzZXIoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbm5vdGF0aW9uUGVy\nc2lzdGVuY2VYTUxNZXRhRGF0YVBhcnNlcgogICAgICAgICAgICAocmVwb3Mu\nZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBs\nb2FkWE1MTWV0YURhdGEoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBB\nbm5vdGF0aW9uUGVyc2lzdGVuY2VYTUxNZXRhRGF0YVBhcnNlciBwYXJzZXIK\nICAgICAgICAgICAgPSBnZXRYTUxBbm5vdGF0aW9uUGFyc2VyKCk7CiAgICAg\nICAgcGFyc2VyLnBhcnNlKGZtZCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIFN0cmluZyBVTkRFUlNDT1JFID0gIl8iOwogICAgCiAgICBwdWJs\naWMgU3RyaW5nIGdldE1hbmFnZWRDbGFzc05hbWUoU3RyaW5nIG1tQ2xhc3NO\nYW1lKSB7CiAgICAgICAgaWYgKG1tQ2xhc3NOYW1lID09IG51bGwgfHwgbW1D\nbGFzc05hbWUubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgaWYgKG1tQ2xhc3NOYW1lLmVuZHNXaXRoKFVOREVSU0NP\nUkUpKQogICAgICAgICAgICByZXR1cm4gbW1DbGFzc05hbWUuc3Vic3RyaW5n\nKDAsIG1tQ2xhc3NOYW1lLmxlbmd0aCgpLTEpOwogICAgICAgIHJldHVybiBt\nbUNsYXNzTmFtZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldE1ldGFN\nb2RlbENsYXNzTmFtZShTdHJpbmcgbWFuYWdlZENsYXNzTmFtZSkgewogICAg\nICAgIGlmIChtYW5hZ2VkQ2xhc3NOYW1lID09IG51bGwgfHwgbWFuYWdlZENs\nYXNzTmFtZS5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICByZXR1cm4gbWFuYWdlZENsYXNzTmFtZSArIFVOREVSU0NP\nUkU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNNZXRhQ2xhc3MoQ2xh\nc3M8Pz4gYykgewogICAgICAgIHJldHVybiBjICE9IG51bGwgJiYgYy5nZXRB\nbm5vdGF0aW9uKFN0YXRpY01ldGFtb2RlbC5jbGFzcykgIT0gbnVsbDsKICAg\nIH0KICAgIAogICAgcHVibGljIENsYXNzPD8+IGdldE1hbmFnZWRDbGFzcyhD\nbGFzczw/PiBjKSB7CiAgICAgICAgaWYgKGlzTWV0YUNsYXNzKGMpKSB7CiAg\nICAgICAgICAgIHJldHVybiBjLmdldEFubm90YXRpb24oU3RhdGljTWV0YW1v\nZGVsLmNsYXNzKS52YWx1ZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KfQo=\n","encoding":"base64"}

