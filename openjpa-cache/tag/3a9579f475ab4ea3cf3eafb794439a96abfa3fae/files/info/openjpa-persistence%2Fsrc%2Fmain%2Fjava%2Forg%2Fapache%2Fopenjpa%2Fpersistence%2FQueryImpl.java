{"sha":"245b28163615f9807d0343438a32ffea7cf5c684","node_id":"MDQ6QmxvYjIwNjM2NDoyNDViMjgxNjM2MTVmOTgwN2QwMzQzNDM4YTMyZmZlYTdjZjVjNjg0","size":37711,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/245b28163615f9807d0343438a32ffea7cf5c684","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5n\ndWFnZXMuTEFOR19QUkVQQVJFRF9TUUw7CgppbXBvcnQgamF2YS5pby5TZXJp\nYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5z\ncWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nbG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5GbHVzaE1vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTG9j\na01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTm9SZXN1bHRF\neGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Ob25VbmlxdWVS\nZXN1bHRFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QYXJh\nbWV0ZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlRlbXBvcmFsVHlwZTsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlR5cGVkUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5jcml0ZXJpYS5QYXJhbWV0ZXJFeHByZXNzaW9uOwoKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdRdWVyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGluZ1Jl\nc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZl\ndGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuUHJlcGFyZWRRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUHJlcGFyZWRRdWVyeUNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlPcGVyYXRpb25zOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeVN0YXRpc3RpY3M7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRpc3RpbmN0UmVzdWx0TGlz\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BZ2dy\nZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuanBxbC5KUFFMUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuT3JkZXJlZE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5jcml0ZXJpYS5Dcml0ZXJpYUJ1aWxkZXJJ\nbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlJ1bnRpbWVFeGNl\ncHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVXNlckV4Y2VwdGlvbjsKCgovKioKICogSW1wbGVtZW50YXRpb24gb2Yg\ne0BsaW5rIFF1ZXJ5fSBpbnRlcmZhY2UuCiAqIAogKiBAYXV0aG9yIE1hcmMg\nUHJ1ZCdob21tZWF1eAogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZh\nZG9jCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNs\nYXNzIFF1ZXJ5SW1wbDxYPiBpbXBsZW1lbnRzIE9wZW5KUEFRdWVyeVNQSTxY\nPiwgU2VyaWFsaXphYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKFF1ZXJ5SW1w\nbC5jbGFzcyk7CgoJcHJpdmF0ZSBEZWxlZ2F0aW5nUXVlcnkgX3F1ZXJ5OwoJ\ncHJpdmF0ZSB0cmFuc2llbnQgRW50aXR5TWFuYWdlckltcGwgX2VtOwoJcHJp\ndmF0ZSB0cmFuc2llbnQgRmV0Y2hQbGFuIF9mZXRjaDsKCiAgICBwcml2YXRl\nIE1hcDxQYXJhbWV0ZXI8Pz4sIE9iamVjdD4gX2JvdW5kUGFyYW1zOwogICAg\ncHJpdmF0ZSBNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IF9kZWNsYXJlZFBh\ncmFtczsKCXByaXZhdGUgU3RyaW5nIF9pZDsKICAgIHByaXZhdGUgdHJhbnNp\nZW50IFJlZW50cmFudExvY2sgX2xvY2sgPSBudWxsOwoJcHJpdmF0ZSBIaW50\nSGFuZGxlciBfaGludEhhbmRsZXI7CgoJLyoqCgkgKiBDb25zdHJ1Y3Rvcjsg\nc3VwcGx5IGZhY3RvcnkgZXhjZXB0aW9uIHRyYW5zbGF0b3IgYW5kIGRlbGVn\nYXRlLgoJICogCgkgKiBAcGFyYW0gZW0gIFRoZSBFbnRpdHlNYW5hZ2VyIHdo\naWNoIGNyZWF0ZWQgdGhpcyBxdWVyeQoJICogQHBhcmFtIHJldCBFeGNlcHRp\nb24gdHJhbnNsYXRvciBmb3IgdGhpcyBxdWVyeQoJICogQHBhcmFtIHF1ZXJ5\nIFRoZSB1bmRlcmx5aW5nICJrZXJuZWwiIHF1ZXJ5LgoJICovCglwdWJsaWMg\nUXVlcnlJbXBsKEVudGl0eU1hbmFnZXJJbXBsIGVtLCBSdW50aW1lRXhjZXB0\naW9uVHJhbnNsYXRvciByZXQsIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnkgcXVlcnkpIHsKCQlfZW0gPSBlbTsKCQlfcXVlcnkgPSBuZXcgRGVs\nZWdhdGluZ1F1ZXJ5KHF1ZXJ5LCByZXQpOwoJCV9sb2NrID0gbmV3IFJlZW50\ncmFudExvY2soKTsKCX0KCgkvKioKCSAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nZmFjdG9yeSBhbmQgZGVsZWdhdGUuCgkgKiAKCSAqIEBkZXByZWNhdGVkCgkg\nKi8KCXB1YmxpYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sIG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcXVlcnkpIHsKCQl0aGlz\nKGVtLCBudWxsLCBxdWVyeSk7Cgl9CgoJLyoqCgkgKiBEZWxlZ2F0ZS4KCSAq\nLwoJcHVibGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgZ2V0\nRGVsZWdhdGUoKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXREZWxlZ2F0ZSgpOwoJ\nfQoKCXB1YmxpYyBPcGVuSlBBRW50aXR5TWFuYWdlciBnZXRFbnRpdHlNYW5h\nZ2VyKCkgewoJCXJldHVybiBfZW07Cgl9CgoJcHVibGljIFN0cmluZyBnZXRM\nYW5ndWFnZSgpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldExhbmd1YWdlKCk7Cgl9\nCgoJcHVibGljIFF1ZXJ5T3BlcmF0aW9uVHlwZSBnZXRPcGVyYXRpb24oKSB7\nCiAgICAgICAgcmV0dXJuIFF1ZXJ5T3BlcmF0aW9uVHlwZS5mcm9tS2VybmVs\nQ29uc3RhbnQoX3F1ZXJ5LmdldE9wZXJhdGlvbigpKTsKCX0KCglwdWJsaWMg\nRmV0Y2hQbGFuIGdldEZldGNoUGxhbigpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xv\nc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LmFzc2VydE5vdFNlcmlhbGl6ZWQoKTsK\nCQlfcXVlcnkubG9jaygpOwoJCXRyeSB7CgkJCWlmIChfZmV0Y2ggPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9mZXRjaCA9ICgoRW50aXR5TWFuYWdlckZh\nY3RvcnlJbXBsKSBfZW0KICAgICAgICAgICAgICAgICAgICAgICAgLmdldEVu\ndGl0eU1hbmFnZXJGYWN0b3J5KCkpLnRvRmV0Y2hQbGFuKF9xdWVyeQogICAg\nICAgICAgICAgICAgICAgICAgICAuZ2V0QnJva2VyKCksIF9xdWVyeS5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKSk7CgkJCXJldHVybiBfZmV0Y2g7CgkJfSBm\naW5hbGx5IHsKCQkJX3F1ZXJ5LnVubG9jaygpOwoJCX0KCX0KCglwdWJsaWMg\nU3RyaW5nIGdldFF1ZXJ5U3RyaW5nKCkgewoJCVN0cmluZyByZXN1bHQgPSBf\ncXVlcnkuZ2V0UXVlcnlTdHJpbmcoKTsKCQlyZXR1cm4gcmVzdWx0ICE9IG51\nbGwgPyByZXN1bHQgOiBfaWQ7Cgl9CgoJcHVibGljIGJvb2xlYW4gZ2V0SWdu\nb3JlQ2hhbmdlcygpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldElnbm9yZUNoYW5n\nZXMoKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldElnbm9yZUNo\nYW5nZXMoYm9vbGVhbiBpZ25vcmUpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJ\nbnZva2VkKCk7CgkJX3F1ZXJ5LnNldElnbm9yZUNoYW5nZXMoaWdub3JlKTsK\nCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IGFk\nZEZpbHRlckxpc3RlbmVyKEZpbHRlckxpc3RlbmVyIGxpc3RlbmVyKSB7CgkJ\nX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5hZGRGaWx0\nZXJMaXN0ZW5lcihsaXN0ZW5lcik7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJcHVi\nbGljIE9wZW5KUEFRdWVyeTxYPiByZW1vdmVGaWx0ZXJMaXN0ZW5lcihGaWx0\nZXJMaXN0ZW5lciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUlu\ndm9rZWQoKTsKCQlfcXVlcnkucmVtb3ZlRmlsdGVyTGlzdGVuZXIobGlzdGVu\nZXIpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8\nWD4gYWRkQWdncmVnYXRlTGlzdGVuZXIoQWdncmVnYXRlTGlzdGVuZXIgbGlz\ndGVuZXIpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1\nZXJ5LmFkZEFnZ3JlZ2F0ZUxpc3RlbmVyKGxpc3RlbmVyKTsKCQlyZXR1cm4g\ndGhpczsKCX0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHJlbW92ZUFn\nZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7\nCgkJX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5yZW1v\ndmVBZ2dyZWdhdGVMaXN0ZW5lcihsaXN0ZW5lcik7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIENvbGxlY3Rpb248Pz4gZ2V0Q2FuZGlkYXRlQ29sbGVj\ndGlvbigpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldENhbmRpZGF0ZUNvbGxlY3Rp\nb24oKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldENhbmRpZGF0\nZUNvbGxlY3Rpb24oQ29sbGVjdGlvbiBjb2xsKSB7CgkJX2VtLmFzc2VydE5v\ndENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5zZXRDYW5kaWRhdGVDb2xsZWN0\naW9uKGNvbGwpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBDbGFzcyBn\nZXRSZXN1bHRDbGFzcygpIHsKCQlDbGFzcyByZXMgPSBfcXVlcnkuZ2V0UmVz\ndWx0VHlwZSgpOwoJCWlmIChyZXMgIT0gbnVsbCkKCQkJcmV0dXJuIHJlczsK\nCQlyZXR1cm4gX3F1ZXJ5LmdldENhbmRpZGF0ZVR5cGUoKTsKCX0KCglwdWJs\naWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFJlc3VsdENsYXNzKENsYXNzIGNscykg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlpZiAoSW1wbEhl\nbHBlci5pc01hbmFnZWRUeXBlKF9lbS5nZXRDb25maWd1cmF0aW9uKCksIGNs\ncykpCgkJCV9xdWVyeS5zZXRDYW5kaWRhdGVUeXBlKGNscywgdHJ1ZSk7CgkJ\nZWxzZQoJCQlfcXVlcnkuc2V0UmVzdWx0VHlwZShjbHMpOwoJCXJldHVybiB0\naGlzOwoJfQoKCXB1YmxpYyBib29sZWFuIGhhc1N1YmNsYXNzZXMoKSB7CgkJ\ncmV0dXJuIF9xdWVyeS5oYXNTdWJjbGFzc2VzKCk7Cgl9CgoJcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBzZXRTdWJjbGFzc2VzKGJvb2xlYW4gc3VicykgewoJ\nCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlDbGFzczw/PiBjbHMg\nPSBfcXVlcnkuZ2V0Q2FuZGlkYXRlVHlwZSgpOwogICAgICAgIF9xdWVyeS5z\nZXRDYW5kaWRhdGVFeHRlbnQoX3F1ZXJ5LmdldEJyb2tlcigpLm5ld0V4dGVu\ndChjbHMsIHN1YnMpKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgaW50\nIGdldEZpcnN0UmVzdWx0KCkgewoJCXJldHVybiBhc0ludChfcXVlcnkuZ2V0\nU3RhcnRSYW5nZSgpKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNl\ndEZpcnN0UmVzdWx0KGludCBzdGFydFBvc2l0aW9uKSB7CgkJX2VtLmFzc2Vy\ndE5vdENsb3NlSW52b2tlZCgpOwoJCWxvbmcgZW5kOwoJCWlmIChfcXVlcnku\nZ2V0RW5kUmFuZ2UoKSA9PSBMb25nLk1BWF9WQUxVRSkKCQkJZW5kID0gTG9u\nZy5NQVhfVkFMVUU7CgkJZWxzZQoJCQllbmQgPSBzdGFydFBvc2l0aW9uCiAg\nICAgICAgICAgICAgICAgICAgKyAoX3F1ZXJ5LmdldEVuZFJhbmdlKCkgLSBf\ncXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKCQlfcXVlcnkuc2V0UmFuZ2Uoc3Rh\ncnRQb3NpdGlvbiwgZW5kKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMg\naW50IGdldE1heFJlc3VsdHMoKSB7CgkJcmV0dXJuIGFzSW50KF9xdWVyeS5n\nZXRFbmRSYW5nZSgpIC0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7Cgl9CgoJ\ncHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRNYXhSZXN1bHRzKGludCBtYXgp\nIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJbG9uZyBzdGFy\ndCA9IF9xdWVyeS5nZXRTdGFydFJhbmdlKCk7CgkJaWYgKG1heCA9PSBJbnRl\nZ2VyLk1BWF9WQUxVRSkKCQkJX3F1ZXJ5LnNldFJhbmdlKHN0YXJ0LCBMb25n\nLk1BWF9WQUxVRSk7CgkJZWxzZQoJCQlfcXVlcnkuc2V0UmFuZ2Uoc3RhcnQs\nIHN0YXJ0ICsgbWF4KTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgT3Bl\nbkpQQVF1ZXJ5PFg+IGNvbXBpbGUoKSB7CgkJX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwoJCV9xdWVyeS5jb21waWxlKCk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgkKCS8qKgoJICogR2V0cyBhIG1hcCBvZiB2YWx1ZXMgb2YgZWFjaCBw\nYXJhbWV0ZXIgaW5kZXhlZCBieSB0aGVpciA8ZW0+b3JpZ2luYWw8L2VtPiBr\nZXkuCgkgKiAKCSAqIEByZXR1cm4gYW4gZW1wdHkgbWFwIGlmIG5vIHBhcmFt\nZXRlciBpcyBkZWNsYXJlZCBmb3IgdGhpcyBxdWVyeS4KICAgICAqIFRoZSB1\nbmJvdW5kIHBhcmFtZXRlcnMgaGFzIGEgdmFsdWUgb2YgbnVsbCB3aGljaCBp\ncyBpbmRpc3Rpbmd1aXNoYWJsZQogICAgICogZnJvbSB0aGUgdmFsdWUgYmVp\nbmcgYm91bmQgdG8gbnVsbC4KCSAqLwoJTWFwPE9iamVjdCxPYmplY3Q+IGdl\ndFBhcmFtZXRlclZhbHVlcygpIHsKCSAgICBNYXA8T2JqZWN0LE9iamVjdD4g\ncmVzdWx0ID0gbmV3IEhhc2hNYXA8T2JqZWN0LE9iamVjdD4oKTsKCSAgICBp\nZiAoX2JvdW5kUGFyYW1zID09IG51bGwpCgkgICAgICAgIHJldHVybiByZXN1\nbHQ7CgkgICAgZm9yIChNYXAuRW50cnk8T2JqZWN0LFBhcmFtZXRlcjw/Pj4g\nZW50cnkgOiBnZXREZWNsYXJlZFBhcmFtZXRlcnMoKS5lbnRyeVNldCgpKSB7\nCgkgICAgICAgIE9iamVjdCBwYXJhbUtleSA9IGVudHJ5LmdldEtleSgpOwoJ\nICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBlbnRyeS5nZXRWYWx1ZSgp\nOwoJICAgICAgICByZXN1bHQucHV0KHBhcmFtS2V5LCBfYm91bmRQYXJhbXMu\nZ2V0KHBhcmFtKSk7CgkgICAgfQoJICAgIHJldHVybiByZXN1bHQ7Cgl9CgkK\nCXByaXZhdGUgT2JqZWN0IGV4ZWN1dGUoKSB7CiAgICAgICAgaWYgKCFpc05h\ndGl2ZSgpICYmIF9xdWVyeS5nZXRPcGVyYXRpb24oKSAhPSBRdWVyeU9wZXJh\ndGlvbnMuT1BfU0VMRUNUKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qtc2VsZWN0LXF1ZXJ5Iiwg\nZ2V0UXVlcnlTdHJpbmcoKSksIG51bGwsIG51bGwsIGZhbHNlKTsKCQl0cnkg\newoJCSAgICBsb2NrKCk7CiAgICAgICAgICAgIE1hcCBwYXJhbXMgPSBnZXRQ\nYXJhbWV0ZXJWYWx1ZXMoKTsKICAgICAgICAgICAgYm9vbGVhbiByZWdpc3Rl\ncmVkID0gcHJlRXhlY3V0ZShwYXJhbXMpOwogICAgICAgICAgICBPYmplY3Qg\ncmVzdWx0ID0gX3F1ZXJ5LmV4ZWN1dGUocGFyYW1zKTsKICAgICAgICAgICAg\naWYgKHJlZ2lzdGVyZWQpIHsKICAgICAgICAgICAgICAgIHBvc3RFeGVjdXRl\nKHJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKCQl9IGNhdGNoIChMb2NrVGltZW91dEV4Y2VwdGlvbiBlKSB7CgkJ\nICAgIHRocm93IG5ldyBRdWVyeVRpbWVvdXRFeGNlcHRpb24oZS5nZXRNZXNz\nYWdlKCksIG5ldyBUaHJvd2FibGVbXXtlfSwgdGhpcyk7CgkJfSBmaW5hbGx5\nIHsKCQkgICAgdW5sb2NrKCk7CgkJfQoJfQoJCglwdWJsaWMgTGlzdCBnZXRS\nZXN1bHRMaXN0KCkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nCQlPYmplY3Qgb2IgPSBleGVjdXRlKCk7CgkJaWYgKG9iIGluc3RhbmNlb2Yg\nTGlzdCkgewoJCQlMaXN0IHJldCA9IChMaXN0KSBvYjsKCQkJaWYgKHJldCBp\nbnN0YW5jZW9mIFJlc3VsdExpc3QpIHsKCQkJICAgIFJ1bnRpbWVFeGNlcHRp\nb25UcmFuc2xhdG9yIHRyYW5zID0gUGVyc2lzdGVuY2VFeGNlcHRpb25zLmdl\ndFJvbGxiYWNrVHJhbnNsYXRvcihfZW0pOwoJCQkgICAgaWYgKF9xdWVyeS5p\nc0Rpc3RpbmN0KCkpIHsKCQkJICAgICAgICByZXR1cm4gbmV3IERpc3RpbmN0\nUmVzdWx0TGlzdCgoUmVzdWx0TGlzdCkgcmV0LCB0cmFucyk7CgkJCSAgICB9\nIGVsc2UgewoJCQkgICAgICAgIHJldHVybiBuZXcgRGVsZWdhdGluZ1Jlc3Vs\ndExpc3QoKFJlc3VsdExpc3QpIHJldCwgdHJhbnMpOwoJCQkgICAgfQoJCQl9\nIGVsc2UgewoJCQkJcmV0dXJuIHJldDsKCQkJfQoJCX0KCgkJcmV0dXJuIENv\nbGxlY3Rpb25zLnNpbmdsZXRvbkxpc3Qob2IpOwoJfQoKCS8qKgoJICogRXhl\nY3V0ZSBhIHF1ZXJ5IHRoYXQgcmV0dXJucyBhIHNpbmdsZSByZXN1bHQuCgkg\nKi8KCXB1YmxpYyBYIGdldFNpbmdsZVJlc3VsdCgpIHsKCQlfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgc2V0SGludCgib3BlbmpwYS5o\naW50Lk9wdGltaXplUmVzdWx0Q291bnQiLCAxKTsgLy8gZm9yIERCMiBvcHRp\nbWl6YXRpb24KCQlMaXN0IHJlc3VsdCA9IGdldFJlc3VsdExpc3QoKTsKCQlp\nZiAocmVzdWx0ID09IG51bGwgfHwgcmVzdWx0LmlzRW1wdHkoKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1yZXN1bHQiLCBnZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAg\nICAgIC5nZXRNZXNzYWdlKCkpOwoJCWlmIChyZXN1bHQuc2l6ZSgpID4gMSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlv\nbihfbG9jLmdldCgibm9uLXVuaXF1ZS1yZXN1bHQiLAogICAgICAgICAgICAg\nICAgICAgIGdldFF1ZXJ5U3RyaW5nKCksIHJlc3VsdC5zaXplKCkpLmdldE1l\nc3NhZ2UoKSk7CgkJdHJ5IHsKCQkgICAgcmV0dXJuIChYKXJlc3VsdC5nZXQo\nMCk7CgkJfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQi\nLCBnZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAgLmdldE1lc3Nh\nZ2UoKSk7CgkJfQoJfQoKCXB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHsK\nCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgTWFwPD8s\nPz4gcGFyYW1WYWx1ZXMgPSBnZXRQYXJhbWV0ZXJWYWx1ZXMoKTsKCQlpZiAo\nX3F1ZXJ5LmdldE9wZXJhdGlvbigpID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9E\nRUxFVEUpIHsKCQkgICByZXR1cm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0\neSgpID8gX3F1ZXJ5LmRlbGV0ZUFsbCgpIDogX3F1ZXJ5LmRlbGV0ZUFsbChw\nYXJhbVZhbHVlcykpOwoJCX0KCQlpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigp\nID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9VUERBVEUpIHsKCSAgICAgICByZXR1\ncm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5LnVwZGF0\nZUFsbCgpIDogX3F1ZXJ5LnVwZGF0ZUFsbChwYXJhbVZhbHVlcykpOwoJCX0K\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtdXBkYXRlLWRlbGV0ZS1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5n\nKCkpLCBudWxsLCBudWxsLCBmYWxzZSk7Cgl9CgoJLyoqCgkgKiBDYXN0IHRo\nZSBzcGVjaWZpZWQgbG9uZyBkb3duIHRvIGFuIGludCwgZmlyc3QgY2hlY2tp\nbmcgZm9yIG92ZXJmbG93LgoJICovCglwcml2YXRlIHN0YXRpYyBpbnQgYXNJ\nbnQobG9uZyBsKSB7CgkJaWYgKGwgPiBJbnRlZ2VyLk1BWF9WQUxVRSkKCQkJ\ncmV0dXJuIEludGVnZXIuTUFYX1ZBTFVFOwogICAgICAgIGlmIChsIDwgSW50\nZWdlci5NSU5fVkFMVUUpIC8vIHVubGlrZWx5LCBidXQgd2UgbWlnaHQgYXMg\nd2VsbCBjaGVjawoJCQlyZXR1cm4gSW50ZWdlci5NSU5fVkFMVUU7CgkJcmV0\ndXJuIChpbnQpIGw7Cgl9CgoJcHVibGljIEZsdXNoTW9kZVR5cGUgZ2V0Rmx1\nc2hNb2RlKCkgewoJCXJldHVybiBFbnRpdHlNYW5hZ2VySW1wbC5mcm9tRmx1\nc2hCZWZvcmVRdWVyaWVzKF9xdWVyeQogICAgICAgICAgICAgICAgLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpLmdldEZsdXNoQmVmb3JlUXVlcmllcygpKTsK\nCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldEZsdXNoTW9kZShGbHVz\naE1vZGVUeXBlIGZsdXNoTW9kZSkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUlu\ndm9rZWQoKTsKCQlfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0\nRmx1c2hCZWZvcmVRdWVyaWVzKAogICAgICAgICAgICAgICAgRW50aXR5TWFu\nYWdlckltcGwudG9GbHVzaEJlZm9yZVF1ZXJpZXMoZmx1c2hNb2RlKSk7CgkJ\ncmV0dXJuIHRoaXM7Cgl9CgoJcHVibGljIGJvb2xlYW4gaXNOYXRpdmUoKSB7\nCgkJcmV0dXJuIFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhnZXRM\nYW5ndWFnZSgpKTsKCX0KCgkvKioKCSAqIEFzc2VydHMgdGhhdCB0aGlzIHF1\nZXJ5IGlzIGEgSlBRTCBvciBDcml0ZXJpYSBRdWVyeS4KCSAqLwoJdm9pZCBh\nc3NlcnRKUFFMT3JDcml0ZXJpYVF1ZXJ5KCkgewogICAgICAgIFN0cmluZyBs\nYW5ndWFnZSA9IGdldExhbmd1YWdlKCk7CiAgICAgICAgaWYgKEpQUUxQYXJz\nZXIuTEFOR19KUFFMLmVxdWFscyhsYW5ndWFnZSkgCiAgICAgICAgIHx8IFF1\nZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhsYW5ndWFn\nZSkKICAgICAgICAgfHwgQ3JpdGVyaWFCdWlsZGVySW1wbC5MQU5HX0NSSVRF\nUklBLmVxdWFscyhsYW5ndWFnZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1qcHFsLW9yLWNyaXRlcmlh\nLXF1ZXJ5IikuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9Cgl9CgoJcHVibGlj\nIE9wZW5KUEFRdWVyeTxYPiBjbG9zZUFsbCgpIHsKCQlfcXVlcnkuY2xvc2VB\nbGwoKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgU3RyaW5nW10gZ2V0\nRGF0YVN0b3JlQWN0aW9ucyhNYXAgcGFyYW1zKSB7CgkJcmV0dXJuIF9xdWVy\neS5nZXREYXRhU3RvcmVBY3Rpb25zKHBhcmFtcyk7Cgl9CgogICAgcHVibGlj\nIExvY2tNb2RlVHlwZSBnZXRMb2NrTW9kZSgpIHsKICAgICAgICBhc3NlcnRK\nUFFMT3JDcml0ZXJpYVF1ZXJ5KCk7CiAgICAgICAgcmV0dXJuIGdldEZldGNo\nUGxhbigpLmdldFJlYWRMb2NrTW9kZSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0cyBsb2NrIG1vZGUgb24gdGhlIGdpdmVuIHF1ZXJ5LgogICAgICog\nSWYgdGhlIHRhcmdldCBxdWVyeSBoYXMgYmVlbiBwcmVwYXJlZCBhbmQgY2Fj\naGVkLCB0aGVuIGlnbm9yZXMgdGhlIGNhY2hlZCB2ZXJzaW9uLgogICAgICog\nQHNlZSAjaWdub3JlUHJlcGFyZWRRdWVyeSgpCiAgICAgKi8KICAgIHB1Ymxp\nYyBUeXBlZFF1ZXJ5PFg+IHNldExvY2tNb2RlKExvY2tNb2RlVHlwZSBsb2Nr\nTW9kZSkgewogICAgICAgIFN0cmluZyBsYW5ndWFnZSA9IGdldExhbmd1YWdl\nKCk7CiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURf\nU1FMLmVxdWFscyhsYW5ndWFnZSkpIHsKICAgICAgICAgICAgaWdub3JlUHJl\ncGFyZWRRdWVyeSgpOwogICAgICAgIH0KICAgICAgICBhc3NlcnRKUFFMT3JD\ncml0ZXJpYVF1ZXJ5KCk7CiAgICAgICBnZXRGZXRjaFBsYW4oKS5zZXRSZWFk\nTG9ja01vZGUobG9ja01vZGUpOwogICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgoJcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gKF9x\ndWVyeSA9PSBudWxsKSA/IDAgOiBfcXVlcnkuaGFzaENvZGUoKTsKCX0KCglw\ndWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CgkJaWYgKG90\naGVyID09IHRoaXMpCgkJCXJldHVybiB0cnVlOwogICAgICAgIGlmICgob3Ro\nZXIgPT0gbnVsbCkgfHwgKG90aGVyLmdldENsYXNzKCkgIT0gdGhpcy5nZXRD\nbGFzcygpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChfcXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJ\nCXJldHVybiBfcXVlcnkuZXF1YWxzKCgoUXVlcnlJbXBsKSBvdGhlcikuX3F1\nZXJ5KTsKCX0KCgkvKioKCSAqIEdldCBhbGwgdGhlIGFjdGl2ZSBoaW50cyBh\nbmQgdGhlaXIgdmFsdWVzLgoJICogCgkgKi8KICAgIC8vVE9ETzogSlBBIDIu\nMCBIaW50cyB0aGF0IGFyZSBub3Qgc2V0IHRvIEZldGNoQ29uZmlndXJhdGlv\nbiAKICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldEhpbnRzKCkg\newogICAgICAgIGlmIChfaGludEhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TWFwKCk7CiAgICAgICAgcmV0\ndXJuIF9oaW50SGFuZGxlci5nZXRIaW50cygpOwogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBUXVlcnk8WD4gc2V0SGludChTdHJpbmcga2V5LCBPYmplY3Qg\ndmFsdWUpIHsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7\nCiAgICAgICAgaWYgKF9oaW50SGFuZGxlciA9PSBudWxsKSB7CiAgICAgICAg\nICAgIF9oaW50SGFuZGxlciA9IG5ldyBIaW50SGFuZGxlcih0aGlzKTsKICAg\nICAgICB9CiAgICAgICAgX2hpbnRIYW5kbGVyLnNldEhpbnQoa2V5LCB2YWx1\nZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNl\ndDxTdHJpbmc+IGdldFN1cHBvcnRlZEhpbnRzKCkgewogICAgICAgIGlmIChf\naGludEhhbmRsZXIgPT0gbnVsbCkgewogICAgICAgICAgICBfaGludEhhbmRs\nZXIgPSBuZXcgSGludEhhbmRsZXIodGhpcyk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBfaGludEhhbmRsZXIuZ2V0U3VwcG9ydGVkSGludHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVud3JhcHMgdGhpcyByZWNlaXZlciB0byBh\nbiBpbnN0YW5jZSBvZiB0aGUgZ2l2ZW4gY2xhc3MsIGlmIHBvc3NpYmxlLgog\nICAgICogCiAgICAgKiBAZXhjZXB0aW9uIGlmIHRoZSBnaXZlbiBjbGFzcyBp\ncyBudWxsLCBnZW5lcmljIDxjb2RlPk9iamVjdC5jbGFzczwvY29kZT4gb3Ig\nYSBjbGFzcwogICAgICogdGhhdCBpcyBub3Qgd3JhcHBlZCBieSB0aGlzIHJl\nY2VpdmVyLiAgCiAgICAgKiAKICAgICAqIEBzaW5jZSAyLjAuMAogICAgICov\nCiAgICBwdWJsaWMgPFQ+IFQgdW53cmFwKENsYXNzPFQ+IGNscykgewogICAg\nICAgIE9iamVjdFtdIGRlbGVnYXRlcyA9IG5ldyBPYmplY3RbXXtfcXVlcnku\nZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKSwgX3F1ZXJ5LmdldERlbGVnYXRlKCks\nIF9xdWVyeSwgdGhpc307CiAgICAgICAgZm9yIChPYmplY3QgbyA6IGRlbGVn\nYXRlcykgewogICAgICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgY2xzICE9\nIE9iamVjdC5jbGFzcyAmJiBjbHMuaXNJbnN0YW5jZShvKSkKICAgICAgICAg\nICAgICAgIHJldHVybiAoVClvOwogICAgICAgIH0KICAgICAgICAvLyBTZXQg\ndGhpcyB0cmFuc2FjdGlvbiB0byByb2xsYmFjayBvbmx5IChhcyBwZXIgc3Bl\nYykgaGVyZSBiZWNhdXNlIHRoZSByYWlzZWQgZXhjZXB0aW9uIAogICAgICAg\nIC8vIGRvZXMgbm90IGdvIHRocm91Z2ggbm9ybWFsIGV4Y2VwdGlvbiB0cmFu\nc2xhdGlvbiBwYXRod2F5cwogICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gZXgg\nPSBuZXcgUGVyc2lzdGVuY2VFeGNlcHRpb24oX2xvYy5nZXQoInVud3JhcC1x\ndWVyeS1pbnZhbGlkIiwgY2xzKS50b1N0cmluZygpLCBudWxsLCAKICAgICAg\nICAgICAgICAgIHRoaXMsIGZhbHNlKTsKICAgICAgICBpZiAoX2VtLmlzQWN0\naXZlKCkpCiAgICAgICAgICAgIF9lbS5zZXRSb2xsYmFja09ubHkoZXgpOwog\nICAgICAgIHRocm93IGV4OwogICAgfQoKICAgIAogICAgLy8gPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT0KICAgIC8vIFByZXBhcmVkIFF1ZXJ5IENhY2hl\nIHJlbGF0ZWQgbWV0aG9kcwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT0KICAgIAogICAgLyoqCiAgICAgKiBJbnZva2VkIGJlZm9yZSBhIHF1\nZXJ5IGlzIGV4ZWN1dGVkLgogICAgICogSWYgdGhpcyByZWNlaXZlciBpcyBj\nYWNoZWQgYXMgYSB7QGxpbmtwbGFpbiBQcmVwYXJlZFF1ZXJ5IHByZXBhcmVk\nIHF1ZXJ5fQogICAgICogdGhlbiByZS1wYXJhbWV0ZXJpemVzIHRoZSBnaXZl\nbiB1c2VyIHBhcmFtZXRlcnMuIFRoZSBnaXZlbiBtYXAgaXMgY2xlYXJlZAog\nICAgICogYW5kIHJlLXBhcmFtZXRlcml6ZWQgdmFsdWVzIGFyZSBmaWxsZWQg\naW4uIAogICAgICogCiAgICAgKiBAcGFyYW0gcGFyYW1zIHVzZXIgc3VwcGxp\nZWQgcGFyYW1ldGVyIGtleS12YWx1ZXMuIEFsd2F5cyBzdXBwbHkgYSAKICAg\nICAqIG5vbi1udWxsIG1hcCBldmVuIGlmIHRoZSB1c2VyIGhhcyBub3Qgc3Bl\nY2lmaWVkIGFueSBwYXJhbWV0ZXIsIGJlY2F1c2UgCiAgICAgKiB0aGUgc2Ft\nZSBtYXAgd2lsbCB0byBiZSBwb3B1bGF0ZWQgYnkgcmUtcGFyYW1ldGVyaXph\ndGlvbi4KICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHRoaXMgaW52\nb2NhdGlvbiBjYXVzZWQgdGhlIHF1ZXJ5IGJlaW5nIHJlZ2lzdGVyZWQgaW4g\ndGhlCiAgICAgKiBjYWNoZS4gCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBwcmVFeGVjdXRlKE1hcCBwYXJhbXMpIHsKICAgICAgICBQcmVwYXJlZFF1\nZXJ5Q2FjaGUgY2FjaGUgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeUNhY2hlKCk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2ggPSBfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgQm9vbGVhbiByZWdpc3RlcmVkID0gY2FjaGUucmVnaXN0ZXIoX2lk\nLCBfcXVlcnksIGZldGNoKTsKICAgICAgICBib29sZWFuIGFscmVhZHlDYWNo\nZWQgPSAocmVnaXN0ZXJlZCA9PSBudWxsKTsKICAgICAgICBTdHJpbmcgbGFu\nZyA9IF9xdWVyeS5nZXRMYW5ndWFnZSgpOwogICAgICAgIFF1ZXJ5U3RhdGlz\ndGljczxTdHJpbmc+IHN0YXRzID0gY2FjaGUuZ2V0U3RhdGlzdGljcygpOwog\nICAgICAgIGlmIChhbHJlYWR5Q2FjaGVkICYmIExBTkdfUFJFUEFSRURfU1FM\nLmVxdWFscyhsYW5nKSkgewogICAgICAgICAgICBQcmVwYXJlZFF1ZXJ5IHBx\nID0gX2VtLmdldFByZXBhcmVkUXVlcnkoX2lkKTsKICAgICAgICAgICAgaWYg\nKHBxLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBNYXAgcmVwID0gcHEucmVwYXJhbWV0cml6\nZShwYXJhbXMsIF9lbS5nZXRCcm9rZXIoKSk7CiAgICAgICAgICAgICAgICAg\nICAgcGFyYW1zLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1z\nLnB1dEFsbChyZXApOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4\nY2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGVQ\ncmVwYXJlZFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICAgICAgTG9nIGxvZyA9\nIF9lbS5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19SVU5USU1FKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nLndhcm4odWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgc3RhdHMucmVjb3JkRXhlY3V0aW9uKHBxLmdldE9y\naWdpbmFsUXVlcnkoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nc3RhdHMucmVjb3JkRXhlY3V0aW9uKGdldFF1ZXJ5U3RyaW5nKCkpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcmVnaXN0ZXJlZCA9PSBCb29sZWFuLlRS\nVUU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSB0aGUg\ncmVnaXN0ZXJlZCBQcmVwYXJlZCBRdWVyeSBmcm9tIHRoZSBnaXZlbiBvcGFx\ndWUgb2JqZWN0LgogICAgICogCiAgICAgKiBAcGFyYW0gcmVzdWx0IGFuIG9w\nYXF1ZSBvYmplY3QgcmVwcmVzZW50aW5nIGV4ZWN1dGlvbiByZXN1bHQgb2Yg\nYSBxdWVyeQogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIHBy\nZXBhcmVkIHF1ZXJ5IGNhbiBiZSBpbml0aWFsaXplZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIHBvc3RFeGVjdXRlKE9iamVjdCByZXN1bHQpIHsK\nICAgICAgICBQcmVwYXJlZFF1ZXJ5Q2FjaGUgY2FjaGUgPSBfZW0uZ2V0UHJl\ncGFyZWRRdWVyeUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwp\nIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gY2FjaGUuaW5pdGlhbGl6ZShfaWQsIHJlc3VsdCkgIT0gbnVs\nbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhpcyBxdWVy\neSBmcm9tIFByZXBhcmVkUXVlcnlDYWNoZS4gCiAgICAgKi8KICAgIGJvb2xl\nYW4gaW52YWxpZGF0ZVByZXBhcmVkUXVlcnkoKSB7CiAgICAgICAgUHJlcGFy\nZWRRdWVyeUNhY2hlIGNhY2hlID0gX2VtLmdldFByZXBhcmVkUXVlcnlDYWNo\nZSgpOwogICAgICAgIGlmIChjYWNoZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaWdub3JlUHJlcGFyZWRRdWVyeSgpOwog\nICAgICAgIHJldHVybiBjYWNoZS5pbnZhbGlkYXRlKF9pZCk7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogSWdub3JlcyB0aGlzIHF1ZXJ5IGZyb20gUHJl\ncGFyZWRRdWVyeUNhY2hlIGJ5IHJlY3JlYXRpbmcgdGhlIG9yaWdpbmFsCiAg\nICAgKiBxdWVyeSBpZiBpdCBoYXMgYmVlbiBjYWNoZWQuIAogICAgICovCiAg\nICB2b2lkIGlnbm9yZVByZXBhcmVkUXVlcnkoKSB7CiAgICAgICAgUHJlcGFy\nZWRRdWVyeSBjYWNoZWQgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeShfaWQpOwog\nICAgICAgIGlmIChjYWNoZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIEJyb2tlciBicm9rZXIgPSBfZW0uZ2V0QnJva2VyKCk7CiAg\nICAgICAgLy8gQ3JpdGljYWwgYXNzdW1wdGlvbjogT25seSBKUFFMIHF1ZXJp\nZXMgYXJlIGNhY2hlZCBhbmQgbW9yZSAKICAgICAgICAvLyBpbXBvcnRhbnRs\neSwgdGhlIGlkZW50aWZpZXIgb2YgdGhlIHByZXBhcmVkIHF1ZXJ5IGlzIHRo\nZSBvcmlnaW5hbAogICAgICAgIC8vIEpQUUwgU3RyaW5nCiAgICAgICAgU3Ry\naW5nIEpQUUwgPSBKUFFMUGFyc2VyLkxBTkdfSlBRTDsKICAgICAgICBTdHJp\nbmcganBxbCA9IF9pZDsKICAgICAgICAKICAgICAgICBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLlF1ZXJ5IG5ld1F1ZXJ5ID0gYnJva2VyLm5ld1F1ZXJ5\nKEpQUUwsIGpwcWwpOwogICAgICAgIG5ld1F1ZXJ5LmdldEZldGNoQ29uZmln\ndXJhdGlvbigpLmNvcHkoX3F1ZXJ5LmdldEZldGNoQ29uZmlndXJhdGlvbigp\nKTsKICAgICAgICBuZXdRdWVyeS5jb21waWxlKCk7CiAgICAgICAgX3F1ZXJ5\nID0gbmV3IERlbGVnYXRpbmdRdWVyeShuZXdRdWVyeSwgX2VtLmdldEV4Y2Vw\ndGlvblRyYW5zbGF0b3IoKSk7CiAgICB9CiAgICAKICAgIC8vIHBhY2thZ2Ug\ncHJvdGVjdGVkCiAgICBRdWVyeUltcGwgc2V0SWQoU3RyaW5nIGlkKSB7CiAg\nICAgICAgX2lkID0gaWQ7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAg\nICAvLyA9PT09PT09PT09PT09PT09IEVuZCBvZiBQcmVwYXJlZCBRdWVyeSBy\nZWxhdGVkIG1ldGhvZHMgPT09PT09PT09PT09PT09PT09PT09CiAgICAKICAg\nIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkgCiAg\nICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgIH0KCiAgICB2b2lkIHVubG9j\naygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAg\nX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgCiAgICAvLyA9PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgUGFyYW1ldGVy\nIHByb2Nlc3Npbmcgcm91dGluZXMKICAgIC8vID09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PQoKICAgIC8qKgogICAgICogQmluZHMgdGhl\nIHBhcmFtZXRlciBpZGVudGlmaWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiB0\nbyB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAgKiBUaGUgcGFyYW1ldGVyIGFyZSBi\nb3VuZCB0byBhIHZhbHVlIGluIHRoZSBjb250ZXh0IG9mIHRoaXMgcXVlcnku\nIAogICAgICogVGhlIHNhbWUgcGFyYW1ldGVyIG1heSBiZSBib3VuZCB0byBh\nIGRpZmZlcmVudCB2YWx1ZSBpbiB0aGUgY29udGV4dCBvZiAKICAgICAqIGFu\nb3RoZXIgcXVlcnkuCiAgICAgKiA8YnI+CiAgICAgKiBGb3Igbm9uLW5hdGl2\nZSBxdWVyaWVzLCB0aGUgZ2l2ZW4gcG9zaXRpb24gbXVzdCBiZSBhIHZhbGlk\nIHBvc2l0aW9uIGluCiAgICAgKiB0aGUgZGVjbGFyZWQgcGFyYW1ldGVycy4K\nICAgICAqIDxicj4KICAgICAqIEFzIG5hdGl2ZSBxdWVyaWVzIG1heSBub3Qg\nYmUgcGFyc2VkIGFuZCBoZW5jZSB0aGVpciBkZWNsYXJlZCBwYXJhbWV0ZXJz\nCiAgICAgKiBtYXkgbm90IGJlIGtub3duLCBzZXR0aW5nIGFuIHBvc2l0aW9u\nYWwgcGFyYW1ldGVyIGhhcyB0aGUgc2lkZS1lZmZlY3QKICAgICAqIG9mIGEg\ncG9zaXRpb25hbCBwYXJhbWV0ZXIgYmVpbmcgZGVjbGFyZWQuCiAgICAgKiAg\nIAogICAgICogQHBhcmFtIHBvc2l0aW9uIHBvc2l0aXZlLCBpbnRlZ2VyIHBv\nc2l0aW9uIG9mIHRoZSBwYXJhbWV0ZXIKICAgICAqIEBwYXJhbSB2YWx1ZSBh\nbiBhc3NpZ25tZW50IGNvbXBhdGlibGUgdmFsdWUKICAgICAqIEByZXR1cm4g\ndGhlIHNhbWUgcXVlcnkgaW5zdGFuY2UKICAgICAqIEB0aHJvd3MgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHBvc2l0aW9uIGRvZXMgbm90IGNvcnJl\nc3BvbmQgdG8gYSBwb3NpdGlvbmFsIAogICAgICogcGFyYW1ldGVyIG9mIHRo\nZSBxdWVyeSBvciBpZiB0aGUgYXJndW1lbnQgaXMgb2YgaW5jb3JyZWN0IHR5\ncGUKICAgICAqLyAgICAKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0\nUGFyYW1ldGVyKGludCBwb3MsIE9iamVjdCB2YWx1ZSkgewogICAgICAgIF9x\ndWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKHBvcyA8IDEpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQo\nImlsbGVnYWwtaW5kZXgiLCBwb3MpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0gbnVsbDsK\nICAgICAgICAgICAgaWYgKGlzTmF0aXZlKCkpIHsKICAgICAgICAgICAgICAg\nIHBhcmFtID0gbmV3IFBhcmFtZXRlckltcGw8T2JqZWN0Pihwb3MsIE9iamVj\ndC5jbGFzcyk7CiAgICAgICAgICAgICAgICBkZWNsYXJlUGFyYW1ldGVyKHBv\ncywgcGFyYW0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9zKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBiaW5kVmFsdWUocGFyYW0sIHZhbHVlKTsKCiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIHBvc2l0\naW9uYWwgcGFyYW1ldGVyIGFmdGVyIGNvbnZlcnNpb24gb2YgdGhlCiAgICAg\nKiBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gVGVtcG9yYWwgVHlwZS4KICAg\nICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXIo\naW50IHBvc2l0aW9uLCBDYWxlbmRhciB2YWx1ZSwgVGVtcG9yYWxUeXBlIHQp\nIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKHBvc2l0aW9uLCBjb252\nZXJ0VGVtcG9yYWxUeXBlKHZhbHVlLCB0KSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gbmFtZWQgcGFyYW1l\ndGVyIGFmdGVyIGNvbnZlcnNpb24gb2YgdGhlCiAgICAgKiBnaXZlbiB2YWx1\nZSB0byB0aGUgZ2l2ZW4gVGVtcG9yYWwgVHlwZS4KICAgICAqLwogICAgcHVi\nbGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXIoaW50IHBvc2l0aW9u\nLCBEYXRlIHZhbHVlLCBUZW1wb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJl\ndHVybiBzZXRQYXJhbWV0ZXIocG9zaXRpb24sIGNvbnZlcnRUZW1wb3JhbFR5\ncGUodmFsdWUsIHR5cGUpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBD\nb252ZXJ0cyB0aGUgZ2l2ZW4gRGF0ZSB0byBhIHZhbHVlIGNvcnJlc3BvbmRp\nbmcgdG8gZ2l2ZW4gdGVtcG9yYWwgdHlwZS4KICAgICAqLwogICAgT2JqZWN0\nIGNvbnZlcnRUZW1wb3JhbFR5cGUoRGF0ZSB2YWx1ZSwgVGVtcG9yYWxUeXBl\nIHR5cGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNl\nIERBVEU6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICBjYXNl\nIFRJTUU6CiAgICAgICAgICAgIHJldHVybiBuZXcgVGltZSh2YWx1ZS5nZXRU\naW1lKCkpOwogICAgICAgIGNhc2UgVElNRVNUQU1QOgogICAgICAgICAgICBy\nZXR1cm4gbmV3IFRpbWVzdGFtcCh2YWx1ZS5nZXRUaW1lKCkpOwogICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nICAgIH0KCiAgICBPYmplY3QgY29udmVydFRlbXBvcmFsVHlwZShDYWxlbmRh\nciB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICByZXR1cm4g\nY29udmVydFRlbXBvcmFsVHlwZSh2YWx1ZS5nZXRUaW1lKCksIHR5cGUpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiBkZWNsYXJlZCBwYXJh\nbWV0ZXJzIHVzZSBwb3NpdGlvbiBpZGVudGlmaWVyLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNQb3NpdGlvbmFsUGFyYW1ldGVycygpIHsKICAg\nICAgICByZXR1cm4gIWdldERlY2xhcmVkUGFyYW1ldGVyS2V5cyhJbnRlZ2Vy\nLmNsYXNzKS5pc0VtcHR5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRz\nIHRoZSBhcnJheSBvZiBwb3NpdGlvbmFsIHBhcmFtZXRlciB2YWx1ZXMuCiAg\nICAgKiBUaGUgbi10aCBhcnJheSBlbGVtZW50IHJlcHJlc2VudHMgKG4rMSkt\ndGggcG9zaXRpb25hbCBwYXJhbWV0ZXIuICAKICAgICAqIElmIGEgcGFyYW1l\ndGVyIGhhcyBiZWVuIGRlY2xhcmVkIGJ1dCBub3QgYm91bmQgdG8gYSB2YWx1\nZSB0aGVuCiAgICAgKiB0aGUgdmFsdWUgaXMgbnVsbCBhbmQgaGVuY2UgaXMg\naW5kaXN0aW5ndWlzaGFibGUgZnJvbSB0aGUgdmFsdWUKICAgICAqIGJlaW5n\nIGFjdHVhbGx5IG51bGwuCiAgICAgKiBJZiB0aGUgcGFyYW1ldGVyIGluZGV4\naW5nIGlzIG5vdCBjb250aWd1b3VzIHRoZW4gdGhlIHVuc3BlY2lmaWVkCiAg\nICAgKiBwYXJhbWV0ZXJzIGFyZSBjb25zaWRlcmVkIGFzIG51bGwuCiAgICAg\nKi8KICAgIHB1YmxpYyBPYmplY3RbXSBnZXRQb3NpdGlvbmFsUGFyYW1ldGVy\ncygpIHsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIFNldDxJbnRlZ2VyPiBwb3NpdGlvbmFsS2V5cyA9IGdldERl\nY2xhcmVkUGFyYW1ldGVyS2V5cyhJbnRlZ2VyLmNsYXNzKTsKICAgICAgICAg\nICAgT2JqZWN0W10gcmVzdWx0ID0gbmV3IE9iamVjdFtjYWxjdWxhdGVNYXhL\nZXkocG9zaXRpb25hbEtleXMpXTsKICAgICAgICAgICAgZm9yIChJbnRlZ2Vy\nIHBvcyA6IHBvc2l0aW9uYWxLZXlzKSB7CiAgICAgICAgICAgICAgICBQYXJh\nbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9zKTsKICAgICAgICAg\nICAgICAgIHJlc3VsdFtwb3MuaW50VmFsdWUoKS0xXSA9IGlzQm91bmQocGFy\nYW0pID8gZ2V0UGFyYW1ldGVyVmFsdWUocG9zKSA6IG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgbWF4\naW11bSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gc2V0LgogICAgICovCiAgICBpbnQg\nY2FsY3VsYXRlTWF4S2V5KFNldDxJbnRlZ2VyPiBwKSB7CiAgICAgICAgaWYg\nKHAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaW50\nIG1heCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAgICAgIGZvciAoSW50ZWdl\nciBpIDogcCkKICAgICAgICAgICAgbWF4ID0gTWF0aC5tYXgobWF4LCBpKTsK\nICAgICAgICByZXR1cm4gbWF4OwogICAgfQoKICAgIC8qKgogICAgICogQmlu\nZHMgdGhlIGdpdmVuIHZhbHVlcyBhcyBwb3NpdGlvbmFsIHBhcmFtZXRlcnMu\nIAogICAgICogVGhlIG4tdGggYXJyYXkgZWxlbWVudCB2YWx1ZSBpcyBzZXQg\ndG8gYSBQYXJhbWV0ZXIgd2l0aCAobisxKS10aCBwb3NpdGlvbmFsIGlkZW50\naWZpZXIuICAKICAgICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBz\nZXRQYXJhbWV0ZXJzKE9iamVjdC4uLiBwYXJhbXMpIHsKICAgICAgICBfcXVl\ncnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUlu\ndm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGNsZWFyQmluZGluZygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgcGFyYW1zICE9IG51bGwgJiYgaSA8IHBhcmFtcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc2V0UGFyYW1ldGVyKGkgKyAx\nLCBwYXJhbXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVy\neS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHZvaWQgY2xl\nYXJCaW5kaW5nKCkgewogICAgICAgIGlmIChfYm91bmRQYXJhbXMgIT0gbnVs\nbCkKICAgICAgICAgICAgX2JvdW5kUGFyYW1zLmNsZWFyKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZXRzIHRoZSB2YWx1ZSBvZiBhbGwgdGhlIG5hbWVk\nIHBhcmFtZXRlcnMuICAKICAgICAqIAogICAgICogSWYgYSBwYXJhbWV0ZXIg\naGFzIGJlZW4gZGVjbGFyZWQgYnV0IG5vdCBib3VuZCB0byBhIHZhbHVlIHRo\nZW4KICAgICAqIHRoZSB2YWx1ZSBpcyBudWxsIGFuZCBoZW5jZSBpcyBpbmRp\nc3Rpbmd1aXNoYWJsZSBmcm9tIHRoZSB2YWx1ZQogICAgICogYmVpbmcgYWN0\ndWFsbHkgbnVsbC4KICAgICAqLwogICAgcHVibGljIE1hcDxTdHJpbmcsIE9i\namVjdD4gZ2V0TmFtZWRQYXJhbWV0ZXJzKCkgewogICAgICAgIF9xdWVyeS5s\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTWFwPFN0cmluZywg\nT2JqZWN0PiByZXN1bHQgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIE9iamVjdD4o\nKTsKICAgICAgICAgICAgU2V0PFN0cmluZz4gbmFtZWRLZXlzID0gZ2V0RGVj\nbGFyZWRQYXJhbWV0ZXJLZXlzKFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAg\nIGZvciAoU3RyaW5nIG5hbWUgOiBuYW1lZEtleXMpIHsKICAgICAgICAgICAg\nICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBhcmFtZXRlcihuYW1lKTsK\nICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQobmFtZSwgaXNCb3VuZChwYXJh\nbSkgPyBnZXRQYXJhbWV0ZXJWYWx1ZShuYW1lKSA6IG51bGwpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdGhlIHZhbHVlcyBvZiB0\naGUgcGFyYW1ldGVycyBmcm9tIHRoZSBnaXZlbiBNYXAuCiAgICAgKiBUaGUg\na2V5cyBvZiB0aGUgZ2l2ZW4gbWFwIGRlc2lnbmF0ZSB0aGUgbmFtZSBvZiB0\naGUgZGVjbGFyZWQgcGFyYW1ldGVyLgogICAgICAKICAgICAqLwogICAgcHVi\nbGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXJzKE1hcCBwYXJhbXMp\nIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5h\nc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNsZWFyQmluZGluZygpOwog\nICAgICAgICAgICBpZiAocGFyYW1zICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBmb3IgKE1hcC5FbnRyeSBlIDogKFNldDxNYXAuRW50cnk+KSBwYXJhbXMu\nZW50cnlTZXQoKSkKICAgICAgICAgICAgICAgICAgICBzZXRQYXJhbWV0ZXIo\nKFN0cmluZykgZS5nZXRLZXkoKSwgZS5nZXRWYWx1ZSgpKTsKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEdldCB0aGUgcGFyYW1ldGVyIG9mIHRoZSBnaXZlbiBuYW1lIGFu\nZCB0eXBlLgogICAgICogCiAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1ldGVyIG9mIHRoZQogICAgICogICAg\nICAgICBzcGVjaWZpZWQgbmFtZSBkb2VzIG5vdCBleGlzdCBvciBpcyBub3Qg\nYXNzaWduYWJsZQogICAgICogICAgICAgICB0byB0aGUgdHlwZQogICAgICog\nQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgaW52b2tlZCBvbiBh\nIG5hdGl2ZSBxdWVyeSAKICAgICAqLwogICAgcHVibGljIDxUPiBQYXJhbWV0\nZXI8VD4gZ2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lLCBDbGFzczxUPiB0eXBl\nKSB7CiAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0gZ2V0UGFyYW1ldGVy\nKG5hbWUpOwogICAgICAgIGlmIChwYXJhbS5nZXRQYXJhbWV0ZXJUeXBlKCku\naXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihwYXJhbSArICIgZG9lcyBub3Qg\nbWF0Y2ggdGhlIHJlcXVlc3RlZCB0eXBlICIgKyB0eXBlKTsKICAgICAgICBy\nZXR1cm4gKFBhcmFtZXRlcjxUPilwYXJhbTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgcG9zaXRpb25hbCBwYXJhbWV0ZXIgd2l0aCB0aGUgZ2l2\nZW4gcG9zaXRpb24gYW5kIHR5cGUuCiAgICAgKiBAdGhyb3dzIElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1ldGVyIHdpdGggdGhlCiAg\nICAgKiAgICAgICAgIHNwZWNpZmllZCBwb3NpdGlvbiBkb2VzIG5vdCBleGlz\ndCBvciBpcyBub3QgYXNzaWduYWJsZQogICAgICogICAgICAgICB0byB0aGUg\ndHlwZQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYg\naW52b2tlZCBvbiBhIG5hdGl2ZSBxdWVyeSB1bmxlc3MKICAgICAqIHRoZSBz\nYW1lIHBhcmFtZXRlciBwb3NpdGlvbiBpcyBib3VuZCBhbHJlYWR5LgogICAg\nICovCiAgICBwdWJsaWMgPFQ+IFBhcmFtZXRlcjxUPiBnZXRQYXJhbWV0ZXIo\naW50IHBvcywgQ2xhc3M8VD4gdHlwZSkgewogICAgICAgIFBhcmFtZXRlcjw/\nPiBwYXJhbSA9IGdldFBhcmFtZXRlcihwb3MpOwogICAgICAgIGlmIChwYXJh\nbS5nZXRQYXJhbWV0ZXJUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbihwYXJhbSArICIgZG9lcyBub3QgbWF0Y2ggdGhlIHJlcXVlc3RlZCB0eXBl\nICIgKyB0eXBlKTsKICAgICAgICByZXR1cm4gKFBhcmFtZXRlcjxUPilwYXJh\nbTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUgYm91\nbmQgdG8gdGhlIHBhcmFtZXRlci4KICAgICAqIEBwYXJhbSBwYXJhbSBwYXJh\nbWV0ZXIgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHBhcmFtZXRlciB2YWx1ZQog\nICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhlIHBh\ncmFtZXRlciBoYXMgbm90IGJlZW4gYmVlbiBib3VuZAogICAgICogQHRocm93\ncyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgdGhlIHBhcmFtZXRlciBk\nb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBxdWVyeQogICAgICovCiAgICBwdWJs\naWMgPFQ+IFQgZ2V0UGFyYW1ldGVyVmFsdWUoUGFyYW1ldGVyPFQ+IHApIHsK\nICAgICAgICBpZiAoIWlzQm91bmQocCkpIHsKICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1t\naXNzaW5nIiwgcCwgZ2V0UXVlcnlTdHJpbmcoKSwgCiAgICAgICAgICAgICAg\nIGdldEJvdW5kUGFyYW1ldGVyS2V5cygpKS5nZXRNZXNzYWdlKCkpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gKFQpX2JvdW5kUGFyYW1zLmdldChwKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIHBhcmFtZXRlcnMgZGVj\nbGFyZWQgaW4gdGhpcyBxdWVyeS4KICAgICAqLwogICAgcHVibGljIFNldDxQ\nYXJhbWV0ZXI8Pz4+IGdldFBhcmFtZXRlcnMoKSB7CiAgICAgICAgU2V0PFBh\ncmFtZXRlcjw/Pj4gcmVzdWx0ID0gbmV3IEhhc2hTZXQ8UGFyYW1ldGVyPD8+\nPigpOwogICAgICAgIHJlc3VsdC5hZGRBbGwoZ2V0RGVjbGFyZWRQYXJhbWV0\nZXJzKCkudmFsdWVzKCkpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9\nCgogICAgcHVibGljIDxUPiBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVy\nKFBhcmFtZXRlcjxUPiBwLCBUIGFyZzEpIHsKICAgICAgICBiaW5kVmFsdWUo\nKFBhcmFtZXRlcjxUPilwLCBhcmcxKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRl\ncihQYXJhbWV0ZXI8RGF0ZT4gcCwgRGF0ZSBkYXRlLCBUZW1wb3JhbFR5cGUg\ndHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIocCwgKERhdGUp\nY29udmVydFRlbXBvcmFsVHlwZShkYXRlLCB0eXBlKSk7CiAgICB9CgogICAg\ncHVibGljIFR5cGVkUXVlcnk8WD4gc2V0UGFyYW1ldGVyKFBhcmFtZXRlcjxD\nYWxlbmRhcj4gcCwgQ2FsZW5kYXIgY2FsLCBUZW1wb3JhbFR5cGUgdHlwZSkg\newogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIocCwgKENhbGVuZGFyKWNv\nbnZlcnRUZW1wb3JhbFR5cGUoY2FsLCB0eXBlKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBHZXQgdGhlIHBhcmFtZXRlciBvYmplY3QgY29ycmVzcG9uZGlu\nZyB0byB0aGUgZGVjbGFyZWQgcGFyYW1ldGVyIG9mIHRoZSBnaXZlbiBuYW1l\nLgogICAgICogVGhpcyBtZXRob2QgaXMgbm90IHJlcXVpcmVkIHRvIGJlIHN1\ncHBvcnRlZCBmb3IgbmF0aXZlIHF1ZXJpZXMuCiAgICAgKiAKICAgICAqIEB0\naHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHRoZSBwYXJhbWV0\nZXIgb2YgdGhlIHNwZWNpZmllZCBuYW1lIGRvZXMgbm90IGV4aXN0CiAgICAg\nKiBAdGhyb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpZiBpbnZva2VkIG9u\nIGEgbmF0aXZlIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBQYXJhbWV0ZXI8\nPz4gZ2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKGlz\nTmF0aXZlKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0tbmFtZWQtbm9uLW5hdGl2ZSIs\nIG5hbWUpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgICAgIFBhcmFt\nZXRlcjw/PiBwYXJhbSA9IGdldERlY2xhcmVkUGFyYW1ldGVycygpLmdldChu\nYW1lKTsKICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCkgewogICAgICAgICAg\nICBTZXQ8UGFyYW1ldGVyRXhwcmVzc2lvbj4gZXhwcyA9IGdldERlY2xhcmVk\nUGFyYW1ldGVyS2V5cyhQYXJhbWV0ZXJFeHByZXNzaW9uLmNsYXNzKTsKICAg\nICAgICAgICAgZm9yIChQYXJhbWV0ZXJFeHByZXNzaW9uPD8+IGUgOiBleHBz\nKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZS5lcXVhbHMoZS5nZXROYW1l\nKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oX2xvYy5nZXQoInBhcmFtLW1pc3NpbmctbmFtZSIsIAogICAgICAg\nICAgICAgICAgbmFtZSwgZ2V0UXVlcnlTdHJpbmcoKSwgZ2V0RGVjbGFyZWRQ\nYXJhbWV0ZXJLZXlzKCkpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBwYXJhbTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0\naGUgcG9zaXRpb25hbCBwYXJhbWV0ZXIgd2l0aCB0aGUgZ2l2ZW4gcG9zaXRp\nb24uCiAgICAgKiBUaGUgcGFyYW1ldGVyIG1heSBqdXN0IGhhdmUgYmVlbiBk\nZWNsYXJlZCBhbmQgbm90IGJvdW5kIHRvIGEgdmFsdWUuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBwb3NpdGlvbiBzcGVjaWZpZWQgaW4gdGhlIHVzZXIgcXVl\ncnkuCiAgICAgKiBAcmV0dXJuIHBhcmFtZXRlciBvYmplY3QKICAgICAqIEB0\naHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHRoZSBwYXJhbWV0\nZXIgd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24gZG9lcyBub3QgZXhpc3QKICAg\nICAqLwogICAgcHVibGljIFBhcmFtZXRlcjw/PiBnZXRQYXJhbWV0ZXIoaW50\nIHBvcykgewogICAgICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldERlY2xh\ncmVkUGFyYW1ldGVycygpLmdldChwb3MpOwogICAgICAgIGlmIChwYXJhbSA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1taXNzaW5nLXBvcyIsIAogICAg\nICAgICAgICAgICAgcG9zLCBnZXRRdWVyeVN0cmluZygpLCBnZXREZWNsYXJl\nZFBhcmFtZXRlcktleXMoKSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICByZXR1\ncm4gcGFyYW07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZh\nbHVlIGJvdW5kIHRvIHRoZSBwYXJhbWV0ZXIuCiAgICAgKiAKICAgICAqIEBw\nYXJhbSBuYW1lIG5hbWUgb2YgdGhlIHBhcmFtZXRlcgogICAgICogQHJldHVy\nbiBwYXJhbWV0ZXIgdmFsdWUKICAgICAqIAogICAgICogQHRocm93cyBJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhpcyBwYXJhbWV0ZXIgaGFzIG5vdCBi\nZWVuIGJvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0UGFyYW1l\ndGVyVmFsdWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gX2JvdW5k\nUGFyYW1zLmdldChnZXRQYXJhbWV0ZXIobmFtZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBib3VuZCB0byB0aGUgcGFyYW1l\ndGVyLgogICAgICogCiAgICAgKiBAcGFyYW0gcG9zIHBvc2l0aW9uIG9mIHRo\nZSBwYXJhbWV0ZXIKICAgICAqIEByZXR1cm4gcGFyYW1ldGVyIHZhbHVlCiAg\nICAgKiAKICAgICAqIEB0aHJvd3MgSWxsZWdhbFN0YXRlRXhjZXB0aW9uIGlm\nIHRoaXMgcGFyYW1ldGVyIGhhcyBub3QgYmVlbiBib3VuZAogICAgICovCiAg\nICBwdWJsaWMgT2JqZWN0IGdldFBhcmFtZXRlclZhbHVlKGludCBwb3MpIHsK\nICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIocG9z\nKTsKICAgICAgICBhc3NlcnRCb3VuZChwYXJhbSk7CiAgICAgICAgcmV0dXJu\nIF9ib3VuZFBhcmFtcy5nZXQocGFyYW0pOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEdldHMgdGhlIHBhcmFtZXRlciBrZXlzIGJvdW5kIHdpdGggdGhp\ncyBxdWVyeS4KICAgICAqIFBhcmFtZXRlciBrZXkgY2FuIGJlIEludGVnZXIs\nIFN0cmluZyBvciBhIFBhcmFtZXRlckV4cHJlc3Npb24gaXRzZWxmCiAgICAg\nKiBidXQgYWxsIHBhcmFtZXRlcnMga2V5cyBvZiBhIHBhcnRpY3VsYXIgcXVl\ncnkgYXJlIG9mIHRoZSBzYW1lIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBT\nZXQ8Pz4gZ2V0Qm91bmRQYXJhbWV0ZXJLZXlzKCkgewogICAgICAgIGlmIChf\nYm91bmRQYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENvbGxl\nY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICBnZXREZWNsYXJlZFBhcmFtZXRl\ncnMoKTsKICAgICAgICBTZXQ8T2JqZWN0PiByZXN1bHQgPSBuZXcgSGFzaFNl\ndDxPYmplY3Q+KCk7CiAgICAgICAgZm9yIChNYXAuRW50cnk8T2JqZWN0LCBQ\nYXJhbWV0ZXI8Pz4+IGVudHJ5IDogX2RlY2xhcmVkUGFyYW1zLmVudHJ5U2V0\nKCkpIHsKICAgICAgICAgICAgaWYgKGlzQm91bmQoZW50cnkuZ2V0VmFsdWUo\nKSkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQoZW50cnkuZ2V0S2V5\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUgZGVj\nbGFyZWQgcGFyYW1ldGVyIGtleXMgaW4gdGhlIGdpdmVuIHF1ZXJ5LgogICAg\nICogVGhpcyBpbmZvcm1hdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSBhZnRlciB0\naGUgcXVlcnkgaGFzIGJlZW4gcGFyc2VkLgogICAgICogQXMgbmF0aXZlIGxh\nbmd1YWdlIHF1ZXJpZXMgYXJlIG5vdCBwYXJzZWQsIHRoaXMgaW5mb3JtYXRp\nb24gaXMgbm90IGF2YWlsYWJsZSBmb3IgdGhlbS4KICAgICAqICAgCiAgICAg\nKiBAcmV0dXJuIHNldCBvZiBwYXJhbWV0ZXIgaWRlbnRpZmllcnMgaW4gYSBw\nYXJzZWQgcXVlcnkKICAgICAqLwogICAgcHVibGljIFNldDw/PiBnZXREZWNs\nYXJlZFBhcmFtZXRlcktleXMoKSB7CiAgICAgICAgcmV0dXJuIGdldERlY2xh\ncmVkUGFyYW1ldGVycygpLmtleVNldCgpOwogICAgfQogICAgCiAgICBwdWJs\naWMgPFQ+IFNldDxUPiBnZXREZWNsYXJlZFBhcmFtZXRlcktleXMoQ2xhc3M8\nVD4ga2V5VHlwZSkgewogICAgICAgIFNldDxUPiByZXN1bHQgPSBuZXcgSGFz\naFNldDxUPigpOwogICAgICAgIGZvciAoT2JqZWN0IGtleSA6IGdldERlY2xh\ncmVkUGFyYW1ldGVyS2V5cygpKSB7CiAgICAgICAgICAgIGlmIChrZXlUeXBl\nLmlzSW5zdGFuY2Uoa2V5KSkKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQo\nKFQpa2V5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBwYXJhbWV0ZXIgaW5z\ndGFuY2VzIGRlY2xhcmVkIGluIHRoaXMgcXVlcnkuCiAgICAgKiBBbGwgcGFy\nYW1ldGVyIGtleXMgYXJlIG9mIHRoZSBzYW1lIHR5cGUuIEl0IGlzIG5vdCBh\nbGxvd2VkIHRvIG1peCBrZXlzIG9mIGRpZmZlcmVudCB0eXBlCiAgICAgKiBz\ndWNoIGFzIG5hbWVkIGFuZCBwb3NpdGlvbmFsIGtleXMuIAogICAgICogCiAg\nICAgKiBGb3Igc3RyaW5nLWJhc2VkIHF1ZXJpZXMsIHRoZSBwYXJzZXIgc3Vw\ncGxpZXMgdGhlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBkZWNsYXJlZCBwYXJh\nbWV0ZXJzCiAgICAgKiBhcyBhIExpbmtlZE1hcCBvZiBleHBlY3RlZCBwYXJh\nbWV0ZXIgdmFsdWUgdHlwZSBpbmRleGVkIGJ5IHBhcmFtZXRlciBpZGVudGlm\naWVyLgogICAgICogRm9yIG5vbiBzdHJpbmctYmFzZWQgcXVlcmllcyB0aGF0\nIGEgZmFjYWRlIGl0c2VsZiBtYXkgY29uc3RydWN0IChlLmcuIENyaXRlcmlh\nUXVlcnkpLAogICAgICogdGhlIHBhcmFtZXRlcnMgbXVzdCBiZSBkZWNsYXJl\nZCBieSB0aGUgY2FsbGVyLgogICAgICogVGhpcyByZWNlaXZlciBjb25zdHJ1\nY3RzIGNvbmNyZXRlIFBhcmFtZXRlciBpbnN0YW5jZXMgZnJvbSB0aGUgZ2l2\nZW4gcGFyYW1ldGVyIGlkZW50aWZpZXJzLgogICAgICogCiAgICAgKiBAcmV0\ndXJuIGEgTWFwIHdoZXJlIHRoZSBrZXkgcmVwcmVzZW50cyB0aGUgb3JpZ2lu\nYWwgaWRlbnRpZmllciBvZiB0aGUgcGFyYW1ldGVyIChjYW4gYmUgYSBTdHJp\nbmcsCiAgICAgKiBJbnRlZ2VyIG9yIGEgUGFyYW1ldGVyRXhwcmVzc2lvbiBp\ndHNlbGYpIGFuZCB0aGUgdmFsdWUgaXMgdGhlIGNvbmNyZXRlIFBhcmFtZXRl\nciBpbnN0YW5jZQogICAgICogZWl0aGVyIGNvbnN0cnVjdGVkIGFzIGEgcmVz\ndWx0IG9mIHRoaXMgY2FsbCBvciBzdXBwbGllZCBieSBkZWNsYXJpbmcgdGhl\nIHBhcmFtZXRlciBleHBsaWNpdGx5CiAgICAgKiB2aWEge0BsaW5rcGxhaW4g\nI2RlY2xhcmVQYXJhbWV0ZXIoUGFyYW1ldGVyKX0uCiAgICAgKi8KICAgIHB1\nYmxpYyBNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IGdldERlY2xhcmVkUGFy\nYW1ldGVycygpIHsKICAgICAgICBpZiAoX2RlY2xhcmVkUGFyYW1zID09IG51\nbGwpIHsKICAgICAgICAgICAgX2RlY2xhcmVkUGFyYW1zID0gbmV3IEhhc2hN\nYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+KCk7CiAgICAgICAgICAgIE9yZGVy\nZWRNYXA8T2JqZWN0LENsYXNzPD8+PiBwYXJhbVR5cGVzID0gX3F1ZXJ5Lmdl\ndE9yZGVyZWRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAgICBmb3IgKE9i\namVjdCBrZXkgOiBwYXJhbVR5cGVzLmtleVNldCgpKSB7CiAgICAgICAgICAg\nICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBudWxsOwogICAgICAgICAgICAg\nICAgQ2xhc3M8Pz4gZXhwZWN0ZWRWYWx1ZVR5cGUgPSBwYXJhbVR5cGVzLmdl\ndChrZXkpOwogICAgICAgICAgICAgICAgaWYgKGtleSBpbnN0YW5jZW9mIElu\ndGVnZXIpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IG5ldyBQYXJh\nbWV0ZXJJbXBsKChJbnRlZ2VyKWtleSwgZXhwZWN0ZWRWYWx1ZVR5cGUpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgaW5zdGFuY2VvZiBTdHJp\nbmcpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IG5ldyBQYXJhbWV0\nZXJJbXBsKChTdHJpbmcpa2V5LCBleHBlY3RlZFZhbHVlVHlwZSk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKGtleSBpbnN0YW5jZW9mIFBhcmFtZXRl\ncikgewogICAgICAgICAgICAgICAgICAgIHBhcmFtID0gKFBhcmFtZXRlcjw/\nPilrZXk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oInBh\ncmFtZXRlciBpZGVudGlmaWVyICIgKyBrZXkgKyAiIHVucmVjb2duaXplZCIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVjbGFyZVBh\ncmFtZXRlcihrZXksIHBhcmFtKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2RlY2xhcmVkUGFyYW1zOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIERlY2xhcmVzIHRoZSBnaXZlbiBwYXJhbWV0ZXIgZm9y\nIHRoaXMgcXVlcnkuIAogICAgICogVXNlZCBieSBub24tc3RyaW5nIGJhc2Vk\nIHF1ZXJpZXMgdGhhdCBhcmUgY29uc3RydWN0ZWQgYnkgdGhlIGZhY2FkZSBp\ndHNlbGYgcmF0aGVyIHRoYW4KICAgICAqIE9wZW5KUEEgcGFyc2luZyB0aGUg\ncXVlcnkgdG8gZGV0ZWN0IHRoZSBkZWNsYXJlZCBwYXJhbWV0ZXJzLgogICAg\nICogCiAgICAgKiBAcGFyYW0ga2V5IHRoaXMgaXMgdGhlIGtleSB0byBpZGVu\ndGlmeSB0aGUgcGFyYW1ldGVyIGxhdGVyIGluIHRoZSBjb250ZXh0IG9mIHRo\naXMgcXVlcnkuCiAgICAgKiBWYWxpZCBrZXkgdHlwZXMgYXJlIEludGVnZXIs\nIFN0cmluZyBvciBQYXJhbWV0ZXJFeHByZXNzaW9uIGl0c2VsZi4KICAgICAq\nIEBwYXJhbSB0aGUgcGFyYW1ldGVyIGluc3RhbmNlIHRvIGJlIGRlY2xhcmVk\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGRlY2xhcmVQYXJhbWV0ZXIoT2Jq\nZWN0IGtleSwgUGFyYW1ldGVyPD8+IHBhcmFtKSB7CiAgICAgICAgaWYgKF9k\nZWNsYXJlZFBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgICAgIF9kZWNsYXJl\nZFBhcmFtcyA9IG5ldyBIYXNoTWFwPE9iamVjdCwgUGFyYW1ldGVyPD8+Pigp\nOwogICAgICAgIH0KICAgICAgICBfZGVjbGFyZWRQYXJhbXMucHV0KGtleSwg\ncGFyYW0pOwogICAgfQoKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUg\nZ2l2ZW4gcGFyYW1ldGVyIGlzIGJvdW5kIHRvIGEgdmFsdWUgZm9yIHRoaXMg\ncXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQm91bmQoUGFy\nYW1ldGVyPD8+IHBhcmFtKSB7CiAgICAgICAgcmV0dXJuIF9ib3VuZFBhcmFt\ncyAhPSBudWxsICYmIF9ib3VuZFBhcmFtcy5jb250YWluc0tleShwYXJhbSk7\nCiAgICB9CiAgICAKICAgIHZvaWQgYXNzZXJ0Qm91bmQoUGFyYW1ldGVyPD8+\nIHBhcmFtKSB7CiAgICAgICAgaWYgKCFpc0JvdW5kKHBhcmFtKSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJwYXJhbS1ub3QtYm91bmQiLCBwYXJhbSwgZ2V0UXVlcnlTdHJpbmco\nKSwgCiAgICAgICAgICAgICAgICAgICAgZ2V0Qm91bmRQYXJhbWV0ZXJLZXlz\nKCkpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAg\nICAgKiBCaW5kcyB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhlIGdpdmVuIHBhcmFt\nZXRlci4KICAgICAqIFZhbGlkYXRlcyBpZiB0aGUgcGFyYW1ldGVyIGNhbiBh\nY2NlcHQgdGhlIHZhbHVlIGJ5IGl0cyB0eXBlLgogICAgICovCiAgICB2b2lk\nIGJpbmRWYWx1ZShQYXJhbWV0ZXI8Pz4gcGFyYW0sIE9iamVjdCB2YWx1ZSkg\newogICAgICAgIGFzc2VydFZhbHVlQXNzaWduYWJsZShwYXJhbSwgdmFsdWUp\nOwogICAgICAgIGlmIChfYm91bmRQYXJhbXMgPT0gbnVsbCkKICAgICAgICAg\nICAgX2JvdW5kUGFyYW1zID0gbmV3IEhhc2hNYXA8UGFyYW1ldGVyPD8+LCBP\nYmplY3Q+KCk7CiAgICAgICAgX2JvdW5kUGFyYW1zLnB1dChwYXJhbSwgdmFs\ndWUpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFy\nYW1ldGVyKFN0cmluZyBuYW1lLCBDYWxlbmRhciB2YWx1ZSwgVGVtcG9yYWxU\neXBlIHR5cGUpIHsKICAgICAgICByZXR1cm4gc2V0UGFyYW1ldGVyKG5hbWUs\nIGNvbnZlcnRUZW1wb3JhbFR5cGUodmFsdWUsIHR5cGUpKTsKICAgIH0KCiAg\nICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRlcihTdHJpbmcg\nbmFtZSwgRGF0ZSB2YWx1ZSwgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAg\nICByZXR1cm4gc2V0UGFyYW1ldGVyKG5hbWUsIGNvbnZlcnRUZW1wb3JhbFR5\ncGUodmFsdWUsIHR5cGUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMg\ndGhlIHBhcmFtZXRlciBvZiB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4g\ndmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0\nUGFyYW1ldGVyKFN0cmluZyBuYW1lLCBPYmplY3QgdmFsdWUpIHsKICAgICAg\nICBfcXVlcnkuYXNzZXJ0T3BlbigpOwogICAgICAgIF9lbS5hc3NlcnROb3RD\nbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIG5hdGl2ZSBxdWVyaWVzIGNhbiBub3Qg\naGF2ZSBuYW1lZCBwYXJhbWV0ZXJzCiAgICAgICAgICAgIGlmIChpc05hdGl2\nZSgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1wYXJhbXMiLAogICAg\nICAgICAgICAgICAgICAgICAgICBuYW1lLCBnZXRRdWVyeVN0cmluZygpKS50\nb1N0cmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIGJpbmRWYWx1ZShnZXRQYXJhbWV0ZXIobmFtZSksIHZhbHVlKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIGFzc2VydFZhbHVl\nQXNzaWduYWJsZShQYXJhbWV0ZXI8Pz4gcGFyYW0sIE9iamVjdCB2KSB7CiAg\nICAgICAgaWYgKHYgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAocGFyYW0u\nZ2V0UGFyYW1ldGVyVHlwZSgpLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJwYXJhbS1udWxsLXByaW1pdGl2ZSIsIHBhcmFtKS5nZXRNZXNzYWdl\nKCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlm\nICghRmlsdGVycy5jYW5Db252ZXJ0KHYuZ2V0Q2xhc3MoKSwgcGFyYW0uZ2V0\nUGFyYW1ldGVyVHlwZSgpLCB0cnVlKSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS10\neXBlLW1pc21hdGNoIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAg\ncGFyYW0sIGdldFF1ZXJ5U3RyaW5nKCksIHYsIHYuZ2V0Q2xhc3MoKS5nZXRO\nYW1lKCksIHBhcmFtLmdldFBhcmFtZXRlclR5cGUoKS5nZXROYW1lKCl9KS5n\nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gPT09\nPT09PT09PT09PT09PT09IEVuZCBvZiBQYXJhbWV0ZXIgUHJvY2Vzc2luZyBy\nb3V0aW5lcyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAg\nCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIFN0cmlu\nZyByZXN1bHQgPSBfcXVlcnkuZ2V0UXVlcnlTdHJpbmcoKTsgCiAgICAgICAg\ncmV0dXJuIHJlc3VsdCAhPSBudWxsID8gcmVzdWx0IDogX2lkOwogICAgfQp9\nCg==\n","encoding":"base64"}

