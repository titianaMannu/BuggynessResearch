{"sha":"4cc09b1ec20490df2381f6a3c04bc3ef542b3593","node_id":"MDQ6QmxvYjIwNjM2NDo0Y2MwOWIxZWMyMDQ5MGRmMjM4MWY2YTNjMDRiYzNlZjU0MmIzNTkz","size":51194,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4cc09b1ec20490df2381f6a3c04bc3ef542b3593","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0IGph\ndmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuRW51bVNl\ndDsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGls\nLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLlNldDsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5EaXNjcmltaW5hdG9y\nVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudW1UeXBlOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuSW5oZXJpdGFuY2VUeXBlOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWxUeXBlOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZpZXIuREJJZGVu\ndGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRp\nZmllci5RdWFsaWZpZWREQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nSW5mbzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRv\nck1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkZpZWxkTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuUXVlcnlSZXN1bHRN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5T\nZXF1ZW5jZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLlF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3VsdDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVudW1WYWx1ZUhh\nbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5GbGF0Q2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZ1bGxDbGFzc1N0cmF0ZWd5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNs\nYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5BY2Nlc3NDb2RlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuWE1MUGVyc2lzdGVuY2VN\nZXRhRGF0YVBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLnhtbC5zYXgu\nQXR0cmlidXRlczsKaW1wb3J0IG9yZy54bWwuc2F4LkxvY2F0b3I7CmltcG9y\ndCBvcmcueG1sLnNheC5TQVhFeGNlcHRpb247CgppbXBvcnQgc3RhdGljIG9y\nZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjLk1hcHBpbmdUYWcu\nKjsKLyoqCiAqIEN1c3RvbSBTQVggcGFyc2VyIHVzZWQgYnkgdGhlIHN5c3Rl\nbSB0byBwYXJzZSBwZXJzaXN0ZW5jZSBtYXBwaW5nIGZpbGVzLgogKgogKiBA\nYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xh\nc3MgWE1MUGVyc2lzdGVuY2VNYXBwaW5nUGFyc2VyCiAgICBleHRlbmRzIFhN\nTFBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIgewoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIE1hcDxTdHJpbmcsIE1hcHBpbmdUYWc+IF9lbGVtcyA9CiAg\nICAgICAgbmV3IEhhc2hNYXA8U3RyaW5nLCBNYXBwaW5nVGFnPigpOwoKICAg\nIHN0YXRpYyB7CiAgICAgICAgX2VsZW1zLnB1dCgiYXNzb2NpYXRpb24tb3Zl\ncnJpZGUiLCBBU1NPQ19PVkVSUklERSk7CiAgICAgICAgX2VsZW1zLnB1dCgi\nYXR0cmlidXRlLW92ZXJyaWRlIiwgQVRUUl9PVkVSUklERSk7CiAgICAgICAg\nX2VsZW1zLnB1dCgiY29sbGVjdGlvbi10YWJsZSIsIENPTExFQ1RJT05fVEFC\nTEUpOwogICAgICAgIF9lbGVtcy5wdXQoImNvbHVtbiIsIENPTCk7CiAgICAg\nICAgX2VsZW1zLnB1dCgiY29sdW1uLW5hbWUiLCBDT0xVTU5fTkFNRSk7CiAg\nICAgICAgX2VsZW1zLnB1dCgiY29sdW1uLXJlc3VsdCIsIENPTFVNTl9SRVNV\nTFQpOwogICAgICAgIF9lbGVtcy5wdXQoImRlbGltaXRlZC1pZGVudGlmaWVy\ncyIsIERFTElNSVRFRF9JRFMpOwogICAgICAgIF9lbGVtcy5wdXQoImRpc2Ny\naW1pbmF0b3ItY29sdW1uIiwgRElTQ1JJTV9DT0wpOwogICAgICAgIF9lbGVt\ncy5wdXQoImRpc2NyaW1pbmF0b3ItdmFsdWUiLCBESVNDUklNX1ZBTCk7CiAg\nICAgICAgX2VsZW1zLnB1dCgiZW50aXR5LXJlc3VsdCIsIEVOVElUWV9SRVNV\nTFQpOwogICAgICAgIF9lbGVtcy5wdXQoImVudW1lcmF0ZWQiLCBFTlVNRVJB\nVEVEKTsKICAgICAgICBfZWxlbXMucHV0KCJmaWVsZC1yZXN1bHQiLCBGSUVM\nRF9SRVNVTFQpOwogICAgICAgIF9lbGVtcy5wdXQoImluaGVyaXRhbmNlIiwg\nSU5IRVJJVEFOQ0UpOwogICAgICAgIF9lbGVtcy5wdXQoImpvaW4tY29sdW1u\nIiwgSk9JTl9DT0wpOwogICAgICAgIF9lbGVtcy5wdXQoImludmVyc2Utam9p\nbi1jb2x1bW4iLCBDT0wpOwogICAgICAgIF9lbGVtcy5wdXQoImpvaW4tdGFi\nbGUiLCBKT0lOX1RBQkxFKTsKICAgICAgICBfZWxlbXMucHV0KCJtYXAta2V5\nLWVudW1lcmF0ZWQiLCBNQVBfS0VZX0VOVU1FUkFURUQpOwogICAgICAgIF9l\nbGVtcy5wdXQoIm1hcC1rZXktY29sdW1uIiwgTUFQX0tFWV9DT0wpOwogICAg\nICAgIF9lbGVtcy5wdXQoIm1hcC1rZXktam9pbi1jb2x1bW4iLCBNQVBfS0VZ\nX0pPSU5fQ09MKTsKICAgICAgICBfZWxlbXMucHV0KCJtYXAta2V5LXRlbXBv\ncmFsIiwgTUFQX0tFWV9URU1QT1JBTCk7CiAgICAgICAgX2VsZW1zLnB1dCgi\nbmFtZSIsIE5BTUUpOwogICAgICAgIF9lbGVtcy5wdXQoIm9yZGVyLWNvbHVt\nbiIsIE9SREVSX0NPTFVNTik7CiAgICAgICAgX2VsZW1zLnB1dCgicHJpbWFy\neS1rZXktam9pbi1jb2x1bW4iLCBQS19KT0lOX0NPTCk7CiAgICAgICAgX2Vs\nZW1zLnB1dCgic2Vjb25kYXJ5LXRhYmxlIiwgU0VDT05EQVJZX1RBQkxFKTsK\nICAgICAgICBfZWxlbXMucHV0KCJzcWwtcmVzdWx0LXNldC1tYXBwaW5nIiwg\nU1FMX1JFU1VMVF9TRVRfTUFQUElORyk7CiAgICAgICAgX2VsZW1zLnB1dCgi\ndGFibGUiLCBUQUJMRSk7CiAgICAgICAgX2VsZW1zLnB1dCgidGFibGUtZ2Vu\nZXJhdG9yIiwgVEFCTEVfR0VOKTsKICAgICAgICBfZWxlbXMucHV0KCJ0ZW1w\nb3JhbCIsIFRFTVBPUkFMKTsKICAgICAgICBfZWxlbXMucHV0KCJ1bmlxdWUt\nY29uc3RyYWludCIsIFVOSVFVRSk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChYTUxQZXJzaXN0ZW5jZU1hcHBpbmdQYXJzZXIuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgU3RyaW5nIF9vdmVycmlkZSA9IG51bGw7CiAgICBw\ncml2YXRlIFN0cmluZyBfc2NoZW1hID0gbnVsbDsKICAgIHByaXZhdGUgU3Ry\naW5nIF9jb2xUYWJsZSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfc2Vj\nb25kYXJ5VGFibGUgPSBudWxsOwogICAgcHJpdmF0ZSBMaXN0PENvbHVtbj4g\nX2NvbHMgPSBudWxsOwogICAgcHJpdmF0ZSBMaXN0PENvbHVtbj4gX2pvaW5D\nb2xzID0gbnVsbDsKICAgIHByaXZhdGUgTGlzdDxDb2x1bW4+IF9zdXBKb2lu\nQ29scyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2xvYiA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBUZW1wb3JhbFR5cGUgX3RlbXBvcmFsID0gbnVsbDsK\nICAgIHByaXZhdGUgRW51bVNldDxVbmlxdWVGbGFnPiBfdW5pcXVlID0gRW51\nbVNldC5ub25lT2YoVW5pcXVlRmxhZy5jbGFzcyk7CiAgICBwcml2YXRlIERp\nc2NyaW1pbmF0b3JUeXBlIF9kaXNjVHlwZTsKICAgIHByaXZhdGUgQ29sdW1u\nIF9kaXNjQ29sOwogICAgcHJpdmF0ZSBpbnQgX3Jlc3VsdElkeCA9IDA7CiAg\nICBwcml2YXRlIGZpbmFsIERCRGljdGlvbmFyeSBfZGljdDsKCiAgICBwcml2\nYXRlIGZpbmFsIE1hcDxDbGFzczw/PiwgQXJyYXlMaXN0PERlZmVycmVkRW1i\nZWRkYWJsZU92ZXJyaWRlcz4+IAogICAgICAgIF9kZWZlcnJlZE1hcHBpbmdz\nID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIAogICAgICAgICAgICAgQXJyYXlM\naXN0PERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcz4+KCk7CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvcjsgc3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAg\nICAgKi8KICAgIHB1YmxpYyBYTUxQZXJzaXN0ZW5jZU1hcHBpbmdQYXJzZXIo\nSkRCQ0NvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIHN1cGVyKGNvbmYp\nOwogICAgICAgIF9kaWN0ID0gY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5j\nZSgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQg\ncmVzZXQoKSB7CiAgICAgICAgc3VwZXIucmVzZXQoKTsKICAgICAgICBjbGVh\nckNvbHVtbkluZm8oKTsKICAgICAgICBjbGVhckNsYXNzSW5mbygpOwogICAg\nICAgIGNsZWFyU2Vjb25kYXJ5VGFibGVJbmZvKCk7CiAgICAgICAgX292ZXJy\naWRlID0gbnVsbDsKICAgICAgICBfc2NoZW1hID0gbnVsbDsKICAgICAgICBf\ncmVzdWx0SWR4ID0gMDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCBPYmplY3Qgc3RhcnRTeXN0ZW1NYXBwaW5nRWxlbWVudChTdHJpbmcg\nbmFtZSwgQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBNYXBwaW5nVGFnIHRhZyA9IF9lbGVtcy5nZXQo\nbmFtZSk7CiAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGlmICgic2NoZW1hIi5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmFtZTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICBib29sZWFuIHJldDsKICAgICAgICBzd2l0Y2ggKHRhZykg\newogICAgICAgICAgICBjYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAg\nIHJldCA9IHN0YXJ0VGFibGVHZW5lcmF0b3IoYXR0cnMpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU1FMX1JFU1VMVF9TRVRf\nTUFQUElORzoKICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0U1FMUmVzdWx0\nU2V0TWFwcGluZyhhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBFTlRJVFlfUkVTVUxUOgogICAgICAgICAgICAgICAg\ncmV0ID0gc3RhcnRFbnRpdHlSZXN1bHQoYXR0cnMpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgRklFTERfUkVTVUxUOgogICAg\nICAgICAgICAgICAgcmV0ID0gc3RhcnRGaWVsZFJlc3VsdChhdHRycyk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDT0xVTU5f\nUkVTVUxUOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRDb2x1bW5SZXN1\nbHQoYXR0cnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXQgPSBmYWxzZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIChyZXQpID8gdGFnIDogbnVsbDsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGVuZFN5c3RlbU1h\ncHBpbmdFbGVtZW50KFN0cmluZyBuYW1lKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgICAgIE1hcHBpbmdUYWcgdGFnID0gX2VsZW1zLmdl\ndChuYW1lKTsKICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKCJzY2hlbWEiLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgICAg\nIF9zY2hlbWEgPSBjdXJyZW50VGV4dCgpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAg\nICBjYXNlIFNRTF9SRVNVTFRfU0VUX01BUFBJTkc6CiAgICAgICAgICAgICAg\nICBlbmRTUUxSZXN1bHRTZXRNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBFTlRJVFlfUkVTVUxUOgogICAgICAg\nICAgICAgICAgZW5kRW50aXR5UmVzdWx0KCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90\nZWN0ZWQgT2JqZWN0IHN0YXJ0Q2xhc3NNYXBwaW5nRWxlbWVudChTdHJpbmcg\nbmFtZSwgQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBNYXBwaW5nVGFnIHRhZyA9IF9lbGVtcy5nZXQo\nbmFtZSk7CiAgICAgICAgaWYgKHRhZyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYm9vbGVhbiByZXQ7CiAgICAgICAgc3dp\ndGNoICh0YWcpIHsKICAgICAgICAgICAgY2FzZSBUQUJMRToKICAgICAgICAg\nICAgICAgIHJldCA9IHN0YXJ0VGFibGUoYXR0cnMpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU0VDT05EQVJZX1RBQkxFOgog\nICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRTZWNvbmRhcnlUYWJsZShhdHRy\ncyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBE\nSVNDUklNX0NPTDoKICAgICAgICAgICAgICAgIHBhcnNlRGlzY3JpbWluYXRv\nckNvbHVtbihhdHRycyk7CiAgICAgICAgICAgICAgICBfZGlzY0NvbCA9IHBh\ncnNlQ29sdW1uKGF0dHJzKTsKICAgICAgICAgICAgICAgIHJldCA9IHRydWU7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBESVND\nUklNX1ZBTDoKICAgICAgICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBJTkhFUklUQU5DRToK\nICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0SW5oZXJpdGFuY2UoYXR0cnMp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQVNT\nT0NfT1ZFUlJJREU6CiAgICAgICAgICAgIGNhc2UgQVRUUl9PVkVSUklERToK\nICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0QXR0cmlidXRlT3ZlcnJpZGUo\nYXR0cnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgUEtfSk9JTl9DT0w6CiAgICAgICAgICAgICAgICByZXQgPSBzdGFydFBy\naW1hcnlLZXlKb2luQ29sdW1uKGF0dHJzKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIENPTDoKICAgICAgICAgICAgICAgIHJl\ndCA9IHN0YXJ0Q29sdW1uKGF0dHJzKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEpPSU5fQ09MOgogICAgICAgICAgICAgICAg\ncmV0ID0gc3RhcnRKb2luQ29sdW1uKGF0dHJzKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEpPSU5fVEFCTEU6CiAgICAgICAg\nICAgICAgICByZXQgPSBzdGFydEpvaW5UYWJsZShhdHRycyk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUQUJMRV9HRU46CiAg\nICAgICAgICAgICAgICByZXQgPSBzdGFydFRhYmxlR2VuZXJhdG9yKGF0dHJz\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFVO\nSVFVRToKICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0VW5pcXVlQ29uc3Ry\nYWludChhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBOQU1FOgogICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFRFTVBPUkFM\nOgogICAgICAgICAgICBjYXNlIEVOVU1FUkFURUQ6CiAgICAgICAgICAgIGNh\nc2UgTUFQX0tFWV9FTlVNRVJBVEVEOgogICAgICAgICAgICBjYXNlIE1BUF9L\nRVlfVEVNUE9SQUw6CiAgICAgICAgICAgICAgICByZXQgPSB0cnVlOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU1FMX1JFU1VM\nVF9TRVRfTUFQUElORzoKICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0U1FM\nUmVzdWx0U2V0TWFwcGluZyhhdHRycyk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBFTlRJVFlfUkVTVUxUOgogICAgICAgICAg\nICAgICAgcmV0ID0gc3RhcnRFbnRpdHlSZXN1bHQoYXR0cnMpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgRklFTERfUkVTVUxU\nOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRGaWVsZFJlc3VsdChhdHRy\ncyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBD\nT0xVTU5fUkVTVUxUOgogICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRDb2x1\nbW5SZXN1bHQoYXR0cnMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgQ09MVU1OX05BTUU6CiAgICAgICAgICAgICAgICByZXQg\nPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgQ09MTEVDVElPTl9UQUJMRToKICAgICAgICAgICAgICAgIHJldCA9IHN0\nYXJ0Q29sbGVjdGlvblRhYmxlKGF0dHJzKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIE1BUF9LRVlfQ09MOgogICAgICAgICAg\nICAgICAgcmV0ID0gc3RhcnRNYXBLZXlDb2x1bW4oYXR0cnMpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgTUFQX0tFWV9KT0lO\nX0NPTDoKICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0TWFwS2V5Sm9pbkNv\nbHVtbihhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldCA9IGZhbHNlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gKHJldCkgPyB0YWcgOiBudWxsOwogICAg\nfQoKICAgIHByaXZhdGUgYm9vbGVhbiBlbmROYW1lKCkgewogICAgICAgIFN0\ncmluZyBuYW1lID0gdGhpcy5jdXJyZW50VGV4dCgpOwogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc05vdEVtcHR5KG5hbWUpKSB7CiAgICAgICAgICAgIE9i\namVjdCBjdXJyZW50ID0gY3VycmVudEVsZW1lbnQoKTsKICAgICAgICAgICAg\naWYgKGN1cnJlbnQgaW5zdGFuY2VvZiBVbmlxdWUpIHsKICAgICAgICAgICAg\nICAgIFVuaXF1ZSB1bnEgPSAoVW5pcXVlKWN1cnJlbnQ7CiAgICAgICAgICAg\nICAgICB1bnEuc2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3Q29uc3Ry\nYWludChuYW1lLCBkZWxpbWl0KCkpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmRDbGFzc01hcHBp\nbmdFbGVtZW50KFN0cmluZyBuYW1lKQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIE1hcHBpbmdUYWcgdGFnID0gX2VsZW1zLmdldChu\nYW1lKTsKICAgICAgICBpZiAodGFnID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgY2Fz\nZSBTRUNPTkRBUllfVEFCTEU6CiAgICAgICAgICAgICAgICBlbmRTZWNvbmRh\ncnlUYWJsZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgRElTQ1JJTV9WQUw6CiAgICAgICAgICAgICAgICBlbmREaXNjcmlt\naW5hdG9yVmFsdWUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEFTU09DX09WRVJSSURFOiAgICAgICAgICAgICAgICAKICAg\nICAgICAgICAgY2FzZSBBVFRSX09WRVJSSURFOgogICAgICAgICAgICAgICAg\nZW5kQXR0cmlidXRlT3ZlcnJpZGUoKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEpPSU5fVEFCTEU6CiAgICAgICAgICAgICAg\nICBlbmRKb2luVGFibGUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIFRFTVBPUkFMOgogICAgICAgICAgICAgICAgZW5kVGVt\ncG9yYWwoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIE1BUF9LRVlfVEVNUE9SQUw6CiAgICAgICAgICAgICAgICBlbmRNYXBL\nZXlUZW1wb3JhbCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgRU5VTUVSQVRFRDoKICAgICAgICAgICAgICAgIGVuZEVudW1l\ncmF0ZWQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIE1BUF9LRVlfRU5VTUVSQVRFRDoKICAgICAgICAgICAgICAgIGVuZE1h\ncEtleUVudW1lcmF0ZWQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIFNRTF9SRVNVTFRfU0VUX01BUFBJTkc6CiAgICAgICAg\nICAgICAgICBlbmRTUUxSZXN1bHRTZXRNYXBwaW5nKCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBFTlRJVFlfUkVTVUxUOgog\nICAgICAgICAgICAgICAgZW5kRW50aXR5UmVzdWx0KCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBVTklRVUU6CiAgICAgICAg\nICAgICAgICBlbmRVbmlxdWVDb25zdHJhaW50KCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBDT0xVTU5fTkFNRToKICAgICAg\nICAgICAgICAgIGVuZENvbHVtbk5hbWUoKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAg\nCWVuZFRhYmxlR2VuZXJhdG9yKCk7CiAgICAgICAgICAgIAlicmVhazsKICAg\nICAgICAgICAgY2FzZSBOQU1FOgogICAgICAgICAgICAgICAgZW5kTmFtZSgp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgc3RhcnRDbGFzc01hcHBp\nbmcoQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIG1hcHBlZFN1cGVyLAog\nICAgICAgIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKG1hcHBlZFN1cGVyKQogICAgICAgICAg\nICAoKENsYXNzTWFwcGluZykgbWV0YSkuZ2V0TWFwcGluZ0luZm8oKS5zZXRT\ndHJhdGVneQogICAgICAgICAgICAgICAgKE5vbmVDbGFzc1N0cmF0ZWd5LkFM\nSUFTKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lk\nIGVuZENsYXNzTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpCiAgICAgICAg\ndGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGNt\nID0gKENsYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBpZiAoX3NjaGVtYSAh\nPSBudWxsKQogICAgICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldFNj\naGVtYUlkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld1NjaGVtYShfc2NoZW1h\nLCBkZWxpbWl0KCkpKTsKCiAgICAgICAgaWYgKF9zdXBKb2luQ29scyAhPSBu\ndWxsKQogICAgICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVt\nbnMoX3N1cEpvaW5Db2xzKTsKCiAgICAgICAgaWYgKF9kaXNjQ29sICE9IG51\nbGwpIHsKICAgICAgICAgICAgRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvIGRp\nbmZvID0gY20uZ2V0RGlzY3JpbWluYXRvcigpCiAgICAgICAgICAgICAgICAg\nICAgLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgICAgIHN3aXRjaCAoX2Rp\nc2NUeXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIENIQVI6CiAgICAgICAg\nICAgICAgICAgICAgX2Rpc2NDb2wuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLkNI\nQVIpOwogICAgICAgICAgICAgICAgICAgIGNtLmdldERpc2NyaW1pbmF0b3Io\nKS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuQ0hBUik7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOVEVHRVI6CiAg\nICAgICAgICAgICAgICAgICAgX2Rpc2NDb2wuc2V0SmF2YVR5cGUoSmF2YVR5\ncGVzLklOVCk7CiAgICAgICAgICAgICAgICAgICAgY20uZ2V0RGlzY3JpbWlu\nYXRvcigpLnNldEphdmFUeXBlKEphdmFUeXBlcy5JTlQpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgICAgICBfZGlzY0NvbC5zZXRKYXZhVHlwZShKYXZhVHlw\nZXMuU1RSSU5HKTsKICAgICAgICAgICAgICAgICAgICBjbS5nZXREaXNjcmlt\naW5hdG9yKCkuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLlNUUklORyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZGluZm8uc2V0Q29sdW1ucyhBcnJheXMuYXNMaXN0KG5ldyBDb2x1bW5b\nXXsgX2Rpc2NDb2wgfSkpOwogICAgICAgIH0KICAgICAgICBjbGVhckNsYXNz\nSW5mbygpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVkIGNs\nYXNzIG1hcHBpbmcgaW5mby4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNs\nZWFyQ2xhc3NJbmZvKCkgewogICAgICAgIF9zdXBKb2luQ29scyA9IG51bGw7\nCiAgICAgICAgX2Rpc2NDb2wgPSBudWxsOwogICAgICAgIF9kaXNjVHlwZSA9\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdGFydCB0cmFja2luZyBz\nZWNvbmRhcnkgdGFibGUgaW5mb3JtYXRpb24gYW5kIGNvbHVtbnMKICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIHN0YXJ0U2Vjb25kYXJ5VGFibGUoQXR0\ncmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsK\nICAgICAgICBfc2Vjb25kYXJ5VGFibGUgPSB0b1RhYmxlSWRlbnRpZmllcihh\ndHRycy5nZXRWYWx1ZSgic2NoZW1hIiksCiAgICAgICAgICAgIGF0dHJzLmdl\ndFZhbHVlKCJuYW1lIikpLmdldE5hbWUoKTsKICAgICAgICAoKENsYXNzTWFw\ncGluZyljdXJyZW50RWxlbWVudCgpKS5nZXRNYXBwaW5nSW5mbygpCiAgICAg\nICAgCS5hZGRTZWNvbmRhcnlUYWJsZShEQklkZW50aWZpZXIubmV3VGFibGUo\nX3NlY29uZGFyeVRhYmxlKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHNlY29uZGFyeSB0YWJsZSBpbmZv\ncm1hdGlvbiBiYWNrIHRvIHRoZSBvd25pbmcgY2xhc3MgbWFwcGluZy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZFNlY29uZGFyeVRhYmxlKCkgewog\nICAgICAgIENsYXNzTWFwcGluZyBjbSA9IChDbGFzc01hcHBpbmcpIGN1cnJl\nbnRFbGVtZW50KCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0g\nY20uZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBpbmZvLnNldFNlY29uZGFy\neVRhYmxlSm9pbkNvbHVtbnMoREJJZGVudGlmaWVyLm5ld1RhYmxlKF9zZWNv\nbmRhcnlUYWJsZSwgZGVsaW1pdCgpKSwgX2pvaW5Db2xzKTsKICAgICAgICBj\nbGVhclNlY29uZGFyeVRhYmxlSW5mbygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xlYXIgY2FjaGVkIHNlY29uZGFyeSB0YWJsZSBpbmZvLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgY2xlYXJTZWNvbmRhcnlUYWJsZUluZm8oKSB7\nCiAgICAgICAgX2pvaW5Db2xzID0gbnVsbDsKICAgICAgICBfc2Vjb25kYXJ5\nVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgdGFi\nbGUtZ2VuZXJhdG9yLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3Rh\ncnRUYWJsZUdlbmVyYXRvcihBdHRyaWJ1dGVzIGF0dHJzKSB7CiAgICAgICAg\nU3RyaW5nIG5hbWUgPSBhdHRycy5nZXRWYWx1ZSgibmFtZSIpOwogICAgICAg\nIExvZyBsb2cgPSBnZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicGFy\nc2UtZ2VuIiwgbmFtZSkpOwogICAgICAgIGlmIChnZXRSZXBvc2l0b3J5KCku\nZ2V0Q2FjaGVkU2VxdWVuY2VNZXRhRGF0YShuYW1lKSAhPSBudWxsCiAgICAg\nICAgICAgICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIGxv\nZy53YXJuKF9sb2MuZ2V0KCJvdmVycmlkZS1nZW4iLCBuYW1lKSk7CgogICAg\nICAgIFNlcXVlbmNlTWFwcGluZyBzZXEgPSAoU2VxdWVuY2VNYXBwaW5nKSBn\nZXRSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgIGFkZFNlcXVlbmNlTWV0YURh\ndGEobmFtZSk7CiAgICAgICAgc2VxLnNldFNlcXVlbmNlUGx1Z2luKFNlcXVl\nbmNlTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxFKTsKICAgICAgICBzZXEuc2V0\nVGFibGVJZGVudGlmaWVyKHRvVGFibGVJZGVudGlmaWVyKGF0dHJzLmdldFZh\nbHVlKCJzY2hlbWEiKSwKICAgICAgICAgICAgYXR0cnMuZ2V0VmFsdWUoInRh\nYmxlIikpKTsKICAgICAgICBzZXEuc2V0UHJpbWFyeUtleUNvbHVtbklkZW50\naWZpZXIoREJJZGVudGlmaWVyLm5ld0NvbHVtbihhdHRycy5nZXRWYWx1ZSgi\ncGstY29sdW1uLW5hbWUiKSwgZGVsaW1pdCgpKSk7IAogICAgICAgIHNlcS5z\nZXRTZXF1ZW5jZUNvbHVtbklkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld0Nv\nbHVtbihhdHRycy5nZXRWYWx1ZSgidmFsdWUtY29sdW1uLW5hbWUiKSwgZGVs\naW1pdCgpKSk7IAogICAgICAgIHNlcS5zZXRQcmltYXJ5S2V5VmFsdWUoYXR0\ncnMuZ2V0VmFsdWUoInBrLWNvbHVtbi12YWx1ZSIpKTsKICAgICAgICBTdHJp\nbmcgdmFsID0gYXR0cnMuZ2V0VmFsdWUoImluaXRpYWwtdmFsdWUiKTsKICAg\nICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIHNlcS5zZXRJbml0\naWFsVmFsdWUoSW50ZWdlci5wYXJzZUludCh2YWwpKTsKICAgICAgICB2YWwg\nPSBhdHRycy5nZXRWYWx1ZSgiYWxsb2NhdGlvbi1zaXplIik7CiAgICAgICAg\naWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBzZXEuc2V0QWxsb2NhdGUo\nSW50ZWdlci5wYXJzZUludCh2YWwpKTsKCiAgICAgICAgT2JqZWN0IGN1ciA9\nIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgT2JqZWN0IHNjb3BlID0gKGN1\nciBpbnN0YW5jZW9mIENsYXNzTWV0YURhdGEpCiAgICAgICAgICAgID8gKChD\nbGFzc01ldGFEYXRhKSBjdXIpLmdldERlc2NyaWJlZFR5cGUoKSA6IG51bGw7\nCiAgICAgICAgc2VxLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIHNjb3Bl\nLCBTb3VyY2VUcmFja2VyLlNSQ19YTUwpOwogICAgICAgIExvY2F0b3IgbG9j\nYXRvciA9IGdldExvY2F0aW9uKCkuZ2V0TG9jYXRvcigpOwogICAgICAgIGlm\nIChsb2NhdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgc2VxLnNldExpbmVO\ndW1iZXIobG9jYXRvci5nZXRMaW5lTnVtYmVyKCkpOwogICAgICAgICAgICBz\nZXEuc2V0Q29sTnVtYmVyKGxvY2F0b3IuZ2V0Q29sdW1uTnVtYmVyKCkpOwog\nICAgICAgIH0KICAgICAgICBwdXNoRWxlbWVudChzZXEpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgZW5kVGFi\nbGVHZW5lcmF0b3IoKSB7CiAgICAJcG9wRWxlbWVudCgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgaW5oZXJpdGFuY2UuCiAgICAgKi8KICAgIHBy\naXZhdGUgYm9vbGVhbiBzdGFydEluaGVyaXRhbmNlKEF0dHJpYnV0ZXMgYXR0\ncnMpIHsKICAgICAgICBTdHJpbmcgdmFsID0gYXR0cnMuZ2V0VmFsdWUoInN0\ncmF0ZWd5Iik7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNtID0gKENs\nYXNzTWFwcGluZykgY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBDbGFzc01h\ncHBpbmdJbmZvIGluZm8gPSBjbS5nZXRNYXBwaW5nSW5mbygpOwogICAgICAg\nIHN3aXRjaCAoRW51bS52YWx1ZU9mKEluaGVyaXRhbmNlVHlwZS5jbGFzcywg\ndmFsKSkgewogICAgICAgICAgICBjYXNlIFNJTkdMRV9UQUJMRToKICAgICAg\nICAgICAgICAgIGluZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koRmxhdENsYXNz\nU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSk9JTkVEOgogICAgICAgICAgICAgICAgaW5mby5zZXRI\naWVyYXJjaHlTdHJhdGVneShWZXJ0aWNhbENsYXNzU3RyYXRlZ3kuQUxJQVMp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVEFC\nTEVfUEVSX0NMQVNTOgogICAgICAgICAgICAgICAgaW5mby5zZXRIaWVyYXJj\naHlTdHJhdGVneShGdWxsQ2xhc3NTdHJhdGVneS5BTElBUyk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBkaXNjcmltaW5hdG9yLXZh\nbHVlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5kRGlzY3JpbWluYXRv\nclZhbHVlKCkgewogICAgICAgIFN0cmluZyB2YWwgPSBjdXJyZW50VGV4dCgp\nOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHZhbCkpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNtID0gKENs\nYXNzTWFwcGluZykgY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBjbS5nZXRE\naXNjcmltaW5hdG9yKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRWYWx1ZSh2YWwp\nOwoKICAgICAgICBpZiAoTW9kaWZpZXIuaXNBYnN0cmFjdChjbS5nZXREZXNj\ncmliZWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpCiAgICAgICAgICAgICAgICAm\nJiBnZXRMb2coKS5pc0luZm9FbmFibGVkKCkpIHsKICAgICAgICAgICAgZ2V0\nTG9nKCkuaW5mbygKICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZGlz\nY3JpbWluYXRvci1vbi1hYnN0cmFjdC1jbGFzcyIsIGNtCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHRl\nbXBvcmFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5kVGVtcG9yYWwo\nKSB7CiAgICAgICAgU3RyaW5nIHRlbXAgPSBjdXJyZW50VGV4dCgpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eSh0ZW1wKSkKICAgICAgICAg\nICAgX3RlbXBvcmFsID0gRW51bS52YWx1ZU9mKFRlbXBvcmFsVHlwZS5jbGFz\ncywgdGVtcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSB0ZW1wb3Jh\nbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZE1hcEtleVRlbXBvcmFs\nKCkgewogICAgICAgIFN0cmluZyB0ZW1wID0gY3VycmVudFRleHQoKTsKICAg\nICAgICBUZW1wb3JhbFR5cGUgX21hcEtleVRlbXBvcmFsID0gbnVsbDsKICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkodGVtcCkpCiAgICAgICAg\nICAgIF9tYXBLZXlUZW1wb3JhbCA9IEVudW0udmFsdWVPZihUZW1wb3JhbFR5\ncGUuY2xhc3MsIHRlbXApOwogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChG\naWVsZE1hcHBpbmcpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgTGlzdDxD\nb2x1bW4+IGNvbHMgPSBmbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZv\nKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkg\newogICAgICAgICAgICBjb2xzID0gQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1u\nW117IG5ldyBDb2x1bW4oKSB9KTsKICAgICAgICAgICAgZm0uZ2V0S2V5TWFw\ncGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoY29scyk7CiAgICAg\nICAgfQoKICAgICAgICBDb2x1bW4gY29sID0gKENvbHVtbikgY29scy5nZXQo\nMCk7CiAgICAgICAgc3dpdGNoIChfbWFwS2V5VGVtcG9yYWwpIHsKICAgICAg\nICAgICAgY2FzZSBEQVRFOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUo\nVHlwZXMuREFURSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBUSU1FOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlw\nZXMuVElNRSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBUSU1FU1RBTVA6CiAgICAgICAgICAgICAgICBjb2wuc2V0VHlwZShU\neXBlcy5USU1FU1RBTVApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZW51bWVyYXRlZC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVuZEVudW1lcmF0ZWQoKSB7CiAg\nICAgICAgU3RyaW5nIHRleHQgPSBjdXJyZW50VGV4dCgpOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KHRleHQpKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgRW51bVR5cGUgdHlwZSA9IEVudW0udmFsdWVPZihFbnVt\nVHlwZS5jbGFzcywgdGV4dCk7CgogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9\nIChGaWVsZE1hcHBpbmcpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgU3Ry\naW5nIHN0cmF0ID0gRW51bVZhbHVlSGFuZGxlci5jbGFzcy5nZXROYW1lKCkg\nKyAiKFN0b3JlT3JkaW5hbD0iCiAgICAgICAgICAgICsgU3RyaW5nLnZhbHVl\nT2YodHlwZSA9PSBFbnVtVHlwZS5PUkRJTkFMKSArICIpIjsKICAgICAgICBp\nZiAoZm0uaXNFbGVtZW50Q29sbGVjdGlvbigpKQogICAgICAgICAgICBmbS5n\nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldFN0cmF0ZWd5\nKHN0cmF0KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZtLmdldFZhbHVl\nSW5mbygpLnNldFN0cmF0ZWd5KHN0cmF0KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIG1hcC1rZXktZW51bWVyYXRlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGVuZE1hcEtleUVudW1lcmF0ZWQoKSB7CiAgICAgICAgU3Ry\naW5nIHRleHQgPSBjdXJyZW50VGV4dCgpOwogICAgICAgIGlmIChTdHJpbmdV\ndGlscy5pc0VtcHR5KHRleHQpKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgRW51bVR5cGUgdHlwZSA9IEVudW0udmFsdWVPZihFbnVtVHlwZS5jbGFz\ncywgdGV4dCk7CgogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1h\ncHBpbmcpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgU3RyaW5nIHN0cmF0\nID0gRW51bVZhbHVlSGFuZGxlci5jbGFzcy5nZXROYW1lKCkgKyAiKFN0b3Jl\nT3JkaW5hbD0iCiAgICAgICAgICAgICsgU3RyaW5nLnZhbHVlT2YodHlwZSA9\nPSBFbnVtVHlwZS5PUkRJTkFMKSArICIpIjsKICAgICAgICBmbS5nZXRLZXlN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0U3RyYXRlZ3koc3RyYXQpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3Rh\ncnRMb2IoQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoc3VwZXIuc3RhcnRMb2IoYXR0cnMpKSB7\nCiAgICAgICAgICAgIF9sb2IgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIC8qKgogICAgICogRXh0ZW5kIHRvIGNsZWFyIGFubm90YXRpb24gbWFw\ncGluZyBpbmZvLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCB2b2lkIHN0YXJ0RmllbGRNYXBwaW5nKEZpZWxkTWV0YURhdGEgZmllbGQs\nIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3VwZXIuc3RhcnRGaWVsZE1hcHBpbmcoZmllbGQsIGF0\ndHJzKTsKICAgICAgICBpZiAoZ2V0QW5ub3RhdGlvblBhcnNlcigpICE9IG51\nbGwpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFw\ncGluZykgZmllbGQ7CiAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCku\nY2xlYXIoKTsKICAgICAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuY2xlYXIo\nKTsKICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1\nZUluZm8oKS5jbGVhcigpOwogICAgICAgICAgICBmbS5nZXRLZXlNYXBwaW5n\nKCkuZ2V0VmFsdWVJbmZvKCkuY2xlYXIoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBFeHRlbmQgdG8gc2V0IHRoZSBjb2x1bW5zLgogICAg\nICovCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGVuZEZpZWxk\nTWFwcGluZyhGaWVsZE1ldGFEYXRhIGZpZWxkKQogICAgICAgIHRocm93cyBT\nQVhFeGNlcHRpb24gewogICAgICAgIC8vIHNldHVwIGNvbHVtbnMgd2l0aCBj\nYWNoZWQgbG9iIGFuZCB0ZW1wb3JhbCBpbmZvCiAgICAgICAgRmllbGRNYXBw\naW5nIGZtID0gKEZpZWxkTWFwcGluZykgZmllbGQ7CiAgICAgICAgaWYgKF9s\nb2IgfHwgX3RlbXBvcmFsICE9IG51bGwpIHsKICAgICAgICAgICAgaW50IHR5\ncGVDb2RlID0gZm0uaXNFbGVtZW50Q29sbGVjdGlvbigpID8gZm0uZ2V0RWxl\nbWVudCgpLmdldERlY2xhcmVkVHlwZUNvZGUoKSA6IAogICAgICAgICAgICAg\nICAgZm0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpOwogICAgICAgICAgICBDbGFz\nczw/PiB0eXBlID0gZm0uaXNFbGVtZW50Q29sbGVjdGlvbigpID8gZm0uZ2V0\nRWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpIDogZm0uZ2V0RGVjbGFyZWRU\neXBlKCk7ICAKICAgICAgICAgICAgaWYgKF9jb2xzID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIF9jb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KDEp\nOwogICAgICAgICAgICAgICAgX2NvbHMuYWRkKG5ldyBDb2x1bW4oKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChDb2x1bW4gY29sIDogX2Nv\nbHMpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9iICYmICh0eXBlQ29kZSA9\nPSBKYXZhVHlwZXMuU1RSSU5HCiAgICAgICAgICAgICAgICAgICAgfHwgdHlw\nZSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICB8fCB0eXBl\nID09IENoYXJhY3RlcltdLmNsYXNzKSkgewogICAgICAgICAgICAgICAgICAg\nIGNvbC5zZXRTaXplKC0xKTsKICAgICAgICAgICAgICAgICAgICBjb2wuc2V0\nVHlwZShUeXBlcy5DTE9CKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo\nX2xvYikKICAgICAgICAgICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5C\nTE9CKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIHN3aXRjaCAoX3RlbXBvcmFsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNhc2UgREFURToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbC5zZXRUeXBlKFR5cGVzLkRBVEUpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVElN\nRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5\ncGVzLlRJTUUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVElNRVNUQU1QOgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMuVElN\nRVNUQU1QKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKF9jb2xzICE9IG51bGwp\nIHsKICAgICAgICAgICAgc3dpdGNoIChmbS5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgICAgIENsYXNzPD8+IHR5cGUgPSBmbS5nZXREZWNs\nYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSBi\neXRlW10uY2xhc3MgfHwgdHlwZSA9PSBCeXRlW10uY2xhc3MKICAgICAgICAg\nICAgICAgICAgICAgICAgfHwgdHlwZSA9PSBjaGFyW10uY2xhc3MgfHwgdHlw\nZSA9PSBDaGFyYWN0ZXJbXS5jbGFzcyApIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0Q29sdW1ucyhfY29scyk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAg\nICAgICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCku\nc2V0Q29sdW1ucyhfY29scyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIGZtLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoX2NvbHMpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChfY29sVGFibGUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVJZGVu\ndGlmaWVyKERCSWRlbnRpZmllci5uZXdUYWJsZShfY29sVGFibGUsIGRlbGlt\naXQoKSkpOwogICAgICAgICAgICBzZXRVbmlxdWUoZm0pOwogICAgICAgIH0K\nICAgICAgICBjbGVhckNvbHVtbkluZm8oKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB1bmlxdWUgZm9yIGZpZWxkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgc2V0VW5pcXVlKEZpZWxkTWFwcGluZyBmbSkgewogICAgICAgIHNl\ndFVuaXF1ZShmbSwgX3VuaXF1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHNldFVuaXF1ZShGaWVsZE1hcHBpbmcgZm0sIEVudW1TZXQ8VW5pcXVlRmxh\nZz4gdW5pcXVlKSB7CiAgICAgICAgaWYgKHVuaXF1ZS5zaXplKCkgPT0gMikg\nLy8gaS5lLiBUUlVFICYgRkFMU0UKICAgICAgICAgICAgZ2V0TG9nKCkud2Fy\nbihfbG9jLmdldCgiaW5jb25zaXN0LWNvbC1hdHRycyIsIGZtKSk7CiAgICAg\nICAgZWxzZSBpZiAodW5pcXVlLmNvbnRhaW5zKFVuaXF1ZUZsYWcuVFJVRSkp\nCiAgICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldFVuaXF1ZShuZXcg\nVW5pcXVlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgZmllbGQg\nbGV2ZWwgY29sdW1uIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgY2xlYXJDb2x1bW5JbmZvKCkgewogICAgICAgIF9jb2xzID0gbnVs\nbDsKICAgICAgICBfam9pbkNvbHMgPSBudWxsOwogICAgICAgIF9jb2xUYWJs\nZSA9IG51bGw7CiAgICAgICAgX2xvYiA9IGZhbHNlOwogICAgICAgIF90ZW1w\nb3JhbCA9IG51bGw7CiAgICAgICAgX3VuaXF1ZS5jbGVhcigpOwogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgYXR0cmlidXRlLW92ZXJyaWRlLgogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3RhcnRBdHRyaWJ1dGVPdmVycmlk\nZShBdHRyaWJ1dGVzIGF0dHIpIHsKICAgICAgICBfb3ZlcnJpZGUgPSBhdHRy\nLmdldFZhbHVlKCJuYW1lIik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgYXR0cmlidXRlIG92ZXJyaWRlIGludG8g\ncHJvcGVyIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBlbmRB\ndHRyaWJ1dGVPdmVycmlkZSgpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgT2JqZWN0IGVsZW0gPSBjdXJyZW50RWxlbWVudCgpOwog\nICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IG51bGw7CiAgICAgICAgaWYgKGVs\nZW0gaW5zdGFuY2VvZiBDbGFzc01hcHBpbmcpCiAgICAgICAgICAgIGZtID0g\nZ2V0QXR0cmlidXRlT3ZlcnJpZGUoKENsYXNzTWFwcGluZykgZWxlbSk7CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBiYXNlZm0g\nPSAoRmllbGRNYXBwaW5nKSBlbGVtOwogICAgICAgICAgICAKICAgICAgICAg\nICAgZm0gPSBnZXRBdHRyaWJ1dGVPdmVycmlkZUZvckVtYmVkZGFibGUoYmFz\nZWZtLCBfb3ZlcnJpZGUsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKGZtID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIERlZmVycmVkRW1iZWRkYWJsZU92\nZXJyaWRlcyBkZm0gPSAKICAgICAgICAgICAgICAgICAgICBnZXREZWZlcnJl\nZEZpZWxkTWFwcGluZ0luZm8oCiAgICAgICAgICAgICAgICAgICAgICAgIEFu\nbm90YXRpb25QZXJzaXN0ZW5jZU1hcHBpbmdQYXJzZXIuCiAgICAgICAgICAg\nICAgICAgICAgICAgIGdldEVtYmVkZGVkQ2xhc3NUeXBlKGJhc2VmbSwgX292\nZXJyaWRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgYmFzZWZtLCBfb3Zl\ncnJpZGUsIHRydWUpOwogICAgICAgICAgICAgICAgZGZtLl9kZWZDb2xzID0g\nX2NvbHM7CiAgICAgICAgICAgICAgICBkZm0uX2RlZlRhYmxlID0gREJJZGVu\ndGlmaWVyLm5ld1RhYmxlKF9jb2xUYWJsZSwgZGVsaW1pdCgpKTsKICAgICAg\nICAgICAgICAgIGRmbS5fYXR0ck5hbWUgPSBfb3ZlcnJpZGU7CiAgICAgICAg\nICAgICAgICBkZm0uX3VuaXF1ZSA9IF91bmlxdWU7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgaWYgKGZtICE9IG51bGwgJiYgX2NvbHMgIT0g\nbnVsbCkgewogICAgICAgICAgICBmbS5nZXRWYWx1ZUluZm8oKS5zZXRDb2x1\nbW5zKF9jb2xzKTsKICAgICAgICAgICAgaWYgKF9jb2xUYWJsZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJs\nZUlkZW50aWZpZXIoREJJZGVudGlmaWVyLm5ld1RhYmxlKF9jb2xUYWJsZSwg\nZGVsaW1pdCgpKSk7CiAgICAgICAgICAgIHNldFVuaXF1ZShmbSk7CiAgICAg\nICAgfQogICAgICAgIGNsZWFyQ29sdW1uSW5mbygpOwogICAgICAgIF9vdmVy\ncmlkZSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHByb3BlciBvdmVycmlkZS4KICAgICAqLwogICAgcHJpdmF0ZSBGaWVsZE1h\ncHBpbmcgZ2V0QXR0cmlidXRlT3ZlcnJpZGUoQ2xhc3NNYXBwaW5nIGNtKSB7\nCiAgICAgICAgRmllbGRNYXBwaW5nIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNt\nLmdldERlZmluZWRTdXBlcmNsYXNzRmllbGQKICAgICAgICAgICAgKF9vdmVy\ncmlkZSk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAgICAgICBz\ndXAgPSAoRmllbGRNYXBwaW5nKSBjbS5hZGREZWZpbmVkU3VwZXJjbGFzc0Zp\nZWxkKF9vdmVycmlkZSwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywg\nT2JqZWN0LmNsYXNzKTsKICAgICAgICByZXR1cm4gc3VwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIgb3ZlcnJpZGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgRmllbGRNYXBwaW5nIGdldEF0dHJpYnV0ZU92ZXJy\naWRlRm9yRW1iZWRkYWJsZShGaWVsZE1hcHBpbmcgZm0sIAogICAgICAgIFN0\ncmluZyBhdHRyTmFtZSwgYm9vbGVhbiBtdXN0RXhpc3QpIAogICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIEFubm90YXRpb25QZXJz\naXN0ZW5jZU1hcHBpbmdQYXJzZXIuZ2V0RW1iZWRkZWRGaWVsZE1hcHBpbmco\nZm0sIAogICAgICAgICAgICBhdHRyTmFtZSwgbXVzdEV4aXN0KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIHRhYmxlLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gc3RhcnRUYWJsZShBdHRyaWJ1dGVzIGF0dHJzKQogICAg\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIENsYXNzTWFwcGlu\nZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgY3VycmVudEVsZW1lbnQoKTsK\nICAgICAgICBpZiAobWFwcGluZy5pc0Fic3RyYWN0KCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ0YWJsZS1ub3Qt\nYWxsb3dlZCIsIG1hcHBpbmcpKTsKICAgICAgICBEQklkZW50aWZpZXIgdGFi\nbGUgPSB0b1RhYmxlSWRlbnRpZmllcihhdHRycy5nZXRWYWx1ZSgic2NoZW1h\nIiksCiAgICAgICAgICAgIGF0dHJzLmdldFZhbHVlKCJuYW1lIikpOwogICAg\nICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbCh0YWJsZSkpCiAgICAgICAg\nICAgIG1hcHBpbmcuZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZUlkZW50aWZp\nZXIodGFibGUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2Ugam9pbi10YWJsZS4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHN0YXJ0Sm9pblRhYmxlKEF0dHJpYnV0ZXMgYXR0cnMpCiAg\nICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgREJJZGVudGlm\naWVyIHNUYWJsZSA9IHRvVGFibGVJZGVudGlmaWVyKGF0dHJzLmdldFZhbHVl\nKCJzY2hlbWEiKSwKICAgICAgICAgICAgYXR0cnMuZ2V0VmFsdWUoIm5hbWUi\nKSk7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHNUYWJsZSkp\nIHsKICAgICAgICAgICAgT2JqZWN0IGVsZW0gPSBjdXJyZW50RWxlbWVudCgp\nOwogICAgICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSBudWxsOwogICAgICAg\nICAgICBpZiAoZWxlbSBpbnN0YW5jZW9mIEZpZWxkTWFwcGluZykgewogICAg\nICAgICAgICAgICAgZm0gPSAoRmllbGRNYXBwaW5nKSBlbGVtOyAKICAgICAg\nICAgICAgICAgIGlmIChfb3ZlcnJpZGUgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIEZpZWxkTWFwcGluZyBiYXNlZm0gPSAoRmllbGRNYXBwaW5n\nKSBlbGVtOwogICAgICAgICAgICAgICAgICAgIGZtID0gZ2V0QXR0cmlidXRl\nT3ZlcnJpZGVGb3JFbWJlZGRhYmxlKGJhc2VmbSwgCiAgICAgICAgICAgICAg\nICAgICAgICAgIF9vdmVycmlkZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChmbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBkZm0gPSAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldERlZmVycmVkRmllbGRNYXBwaW5nSW5m\nbygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbm5vdGF0aW9u\nUGVyc2lzdGVuY2VNYXBwaW5nUGFyc2VyLgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGdldEVtYmVkZGVkQ2xhc3NUeXBlKGJhc2VmbSwgX292\nZXJyaWRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNl\nZm0sIF9vdmVycmlkZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGRmbS5fZGVmVGFibGUgPSBzVGFibGUuY2xvbmUoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZGZtLl9hdHRyTmFtZSA9IF9vdmVycmlkZTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoZWxlbSBpbnN0YW5jZW9mIENsYXNzTWFwcGluZykgewog\nICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNtID0gKENsYXNzTWFwcGlu\nZykgZWxlbTsKICAgICAgICAgICAgICAgIGZtID0gZ2V0QXR0cmlidXRlT3Zl\ncnJpZGUoY20pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmbSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5z\nZXRUYWJsZUlkZW50aWZpZXIoc1RhYmxlKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGpv\naW4gdGFibGUgaW5mb3JtYXRpb24gYmFjay4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGVuZEpvaW5UYWJsZSgpIHRocm93cyBTQVhFeGNlcHRpb24gewog\nICAgICAgIE9iamVjdCBlbGVtID0gY3VycmVudEVsZW1lbnQoKTsKICAgICAg\nICBGaWVsZE1hcHBpbmcgZm0gPSBudWxsOwogICAgICAgIGlmIChlbGVtIGlu\nc3RhbmNlb2YgRmllbGRNYXBwaW5nKSB7CiAgICAgICAgICAgIGZtID0gKEZp\nZWxkTWFwcGluZykgZWxlbTsKICAgICAgICAgICAgaWYgKF9vdmVycmlkZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcgYmFzZWZt\nID0gKEZpZWxkTWFwcGluZykgZWxlbTsKICAgICAgICAgICAgICAgIGZtID0g\nZ2V0QXR0cmlidXRlT3ZlcnJpZGVGb3JFbWJlZGRhYmxlKGJhc2VmbSwgX292\nZXJyaWRlLCAKICAgICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAg\nICAgICAgICBpZiAoZm0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBkZm0gPSAKICAgICAgICAg\nICAgICAgICAgICAgICAgZ2V0RGVmZXJyZWRGaWVsZE1hcHBpbmdJbmZvKAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5ub3RhdGlvblBlcnNpc3Rl\nbmNlTWFwcGluZ1BhcnNlci4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGdldEVtYmVkZGVkQ2xhc3NUeXBlKGJhc2VmbSwgX292ZXJyaWRlKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VmbSwgX292ZXJyaWRlLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBkZm0uX2RlZkNvbHMgPSBfY29s\nczsKICAgICAgICAgICAgICAgICAgICBkZm0uX2RlZkVsZW1Kb2luQ29scyA9\nIF9qb2luQ29sczsKICAgICAgICAgICAgICAgICAgICBkZm0uX2F0dHJOYW1l\nID0gX292ZXJyaWRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSBlbHNlIGlmIChlbGVtIGluc3RhbmNlb2YgQ2xhc3NNYXBw\naW5nKXsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNtID0gKENsYXNzTWFw\ncGluZykgZWxlbTsKICAgICAgICAgICAgZm0gPSBnZXRBdHRyaWJ1dGVPdmVy\ncmlkZShjbSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZm0gIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoX2pvaW5Db2xzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVtbnMoX2pvaW5D\nb2xzKTsKICAgICAgICAgICAgaWYgKF9jb2xzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygp\nLnNldENvbHVtbnMoX2NvbHMpOwogICAgICAgIH0KICAgICAgICBjbGVhckNv\nbHVtbkluZm8oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHByaW1h\ncnkta2V5LWpvaW4tY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gc3RhcnRQcmltYXJ5S2V5Sm9pbkNvbHVtbihBdHRyaWJ1dGVzIGF0dHJz\nKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIENvbHVt\nbiBjb2wgPSBwYXJzZUNvbHVtbihhdHRycyk7CiAgICAgICAgY29sLnNldEZs\nYWcoQ29sdW1uLkZMQUdfUEtfSk9JTiwgdHJ1ZSk7CiAgICAgICAgLy8gcGsg\nam9pbiBjb2x1bW5zIG9uIGZpZWxkcyBhY3QgYXMgZmllbGQgY29scwogICAg\nICAgIGlmIChjdXJyZW50RWxlbWVudCgpIGluc3RhbmNlb2YgRmllbGRNYXBw\naW5nKSB7CiAgICAgICAgICAgIGlmIChfY29scyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oMyk7CiAg\nICAgICAgICAgIF9jb2xzLmFkZChjb2wpOwogICAgICAgIH0gZWxzZSBpZiAo\nY3VycmVudFBhcmVudCgpID09IFNFQ09OREFSWV9UQUJMRSkgewogICAgICAg\nICAgICAvLyBwayBqb2luIGNvbHVtbnMgaW4gc2Vjb25kYXJ5IHRhYmxlIGFj\ndHMgYXMgam9pbiBjb2xzCiAgICAgICAgICAgIGlmIChfam9pbkNvbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9qb2luQ29scyA9IG5ldyBBcnJheUxp\nc3Q8Q29sdW1uPigzKTsKICAgICAgICAgICAgX2pvaW5Db2xzLmFkZChjb2wp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG11c3QgYmUgcGsg\nam9pbiBjb2xzIGZyb20gdGhpcyBjbGFzcyB0byBzdXBlcmNsYXNzCiAgICAg\nICAgICAgIGlmIChfc3VwSm9pbkNvbHMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9zdXBKb2luQ29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPigzKTsK\nICAgICAgICAgICAgX3N1cEpvaW5Db2xzLmFkZChjb2wpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIGpvaW4tY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\nc3RhcnRKb2luQ29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhy\nb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gb25seSBqb2luIGNvbHMg\naW4gYSBqb2luIHRhYmxlIGpvaW4gZmllbGQgdGFibGUgdG8gY2xhc3MgdGFi\nbGU7CiAgICAgICAgLy8gb3RoZXJzIGFjdCBhcyBkYXRhIGZrIGNvbHMKICAg\nICAgICBPYmplY3QgY3VycmVudFBhcmVudCA9IGN1cnJlbnRQYXJlbnQoKTsK\nICAgICAgICBpZiAoY3VycmVudFBhcmVudCA9PSBDT0xMRUNUSU9OX1RBQkxF\nKSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBp\nbmcpIHBlZWtFbGVtZW50KCk7CiAgICAgICAgICAgIENvbHVtbiBjb2wgPSBw\nYXJzZUNvbHVtbihhdHRycyk7CiAgICAgICAgICAgIExpc3Q8Q29sdW1uPiBj\nb2xMaXN0ID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KCk7CiAgICAgICAgICAg\nIGNvbExpc3QuYWRkKGNvbCk7CiAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJ\nbmZvKCkuc2V0Q29sdW1ucyhjb2xMaXN0KTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChjdXJyZW50\nUGFyZW50ICE9IEpPSU5fVEFCTEUpCiAgICAgICAgICAgIHJldHVybiBzdGFy\ndENvbHVtbihhdHRycyk7CgogICAgICAgIGlmIChfam9pbkNvbHMgPT0gbnVs\nbCkKICAgICAgICAgICAgX2pvaW5Db2xzID0gbmV3IEFycmF5TGlzdDxDb2x1\nbW4+KDMpOwogICAgICAgIF9qb2luQ29scy5hZGQocGFyc2VDb2x1bW4oYXR0\ncnMpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHN0YXJ0Q29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbCA9IHBhcnNlQ29s\ndW1uKGF0dHJzKTsKICAgICAgICBPYmplY3Qgb2JqID0gcGVla0VsZW1lbnQo\nKTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRmllbGRNYXBwaW5nKSB7\nCiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcp\nb2JqOwogICAgICAgICAgICAvLyBhIGNvbGxlY3Rpb24gb2YgYmFzaWMgdHlw\nZXMKICAgICAgICAgICAgLy8gdGhlIGNvbHVtbiBpcyBpbiBhIHNlcGFyYXRl\nIHRhYmxlCiAgICAgICAgICAgIGlmIChmbS5pc0VsZW1lbnRDb2xsZWN0aW9u\nKCkgJiYKICAgICAgICAgICAgICAgICFmbS5nZXRFbGVtZW50TWFwcGluZygp\nLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgTGlzdDxDb2x1bW4+\nIGxpc3QgPSBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygp\nLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAgIGlmIChsaXN0LnNpemUo\nKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IG5ldyBBcnJh\neUxpc3Q8Q29sdW1uPigpOwogICAgICAgICAgICAgICAgICAgIGZtLmdldEVs\nZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0Q29sdW1ucyhsaXN0\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxpc3QuYWRk\nKGNvbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX2NvbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oMyk7CiAg\nICAgICAgX2NvbHMuYWRkKGNvbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBtYXAta2V5LWNvbHVtbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHN0YXJ0TWFwS2V5Q29sdW1uKEF0\ndHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7\nCiAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykgcGVl\na0VsZW1lbnQoKTsKICAgICAgICBDb2x1bW4gY29sID0gcGFyc2VDb2x1bW4o\nYXR0cnMpOwogICAgICAgIE1hcHBpbmdJbmZvIGluZm8gPSBmbS5nZXRLZXlN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgTGlzdDxDb2x1bW4+\nIGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oKTsKICAgICAgICBjb2xz\nLmFkZChjb2wpOwogICAgICAgIGluZm8uc2V0Q29sdW1ucyhjb2xzKTsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIG1hcC1rZXktam9pbi1jb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBzdGFydE1hcEtleUpvaW5Db2x1bW4oQXR0cmlidXRlcyBhdHRycykK\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGJvb2xlYW4gcmV0\nVmFsID0gc3RhcnRNYXBLZXlDb2x1bW4oYXR0cnMpOwogICAgICAgIC8vIGNo\nZWNrIGlmIG5hbWUgaXMgbm90IHNldCwgc2V0IGl0IHRvIGRlZmF1bHQ6IHRo\nZQogICAgICAgIC8vIGNvbmNhdGVuYXRpb24gb2YgdGhlIG5hbWUgb2YgdGhl\nIHJlZmVyZW5jaW5nIHByb3BlcnR5CiAgICAgICAgLy8gb3IgZmllbGQgbmFt\nZSwgIi0iLCAiS0VZIgogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVs\nZE1hcHBpbmcpIHBlZWtFbGVtZW50KCk7CiAgICAgICAgTWFwcGluZ0luZm8g\naW5mbyA9IGZtLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKTsKICAg\nICAgICBMaXN0PENvbHVtbj4gY29scyA9IGluZm8uZ2V0Q29sdW1ucygpOwog\nICAgICAgIENvbHVtbiBjb2wgPSBjb2xzLmdldCgwKTsKICAgICAgICBpZiAo\nREJJZGVudGlmaWVyLmlzTnVsbChjb2wuZ2V0SWRlbnRpZmllcigpKSkgewog\nICAgICAgICAgICBjb2wuc2V0SWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3\nQ29sdW1uKGZtLmdldE5hbWUoKSArICJfIiArICJLRVkiLCBkZWxpbWl0KCkp\nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXRWYWw7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogQ3JlYXRlIGEgY29sdW1uIHdpdGggdGhlIGdp\ndmVuIGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgQ29sdW1uIHBh\ncnNlQ29sdW1uKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNB\nWEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4o\nKTsKICAgICAgICBTdHJpbmcgdmFsID0gYXR0cnMuZ2V0VmFsdWUoIm5hbWUi\nKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5z\nZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW4odmFsLCBkZWxp\nbWl0KCkpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgicmVmZXJl\nbmNlZC1jb2x1bW4tbmFtZSIpOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkK\nICAgICAgICAgICAgY29sLnNldFRhcmdldElkZW50aWZpZXIoREJJZGVudGlm\naWVyLm5ld0NvbHVtbih2YWwsIGRlbGltaXQoKSkpOwogICAgICAgIHZhbCA9\nIGF0dHJzLmdldFZhbHVlKCJjb2x1bW4tZGVmaW5pdGlvbiIpOwogICAgICAg\nIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNldFR5cGVJZGVu\ndGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW5EZWZpbml0aW9uKHZhbCkp\nOwogICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJwcmVjaXNpb24iKTsK\nICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5zZXRT\naXplKEludGVnZXIucGFyc2VJbnQodmFsKSk7CiAgICAgICAgdmFsID0gYXR0\ncnMuZ2V0VmFsdWUoImxlbmd0aCIpOwogICAgICAgIGlmICh2YWwgIT0gbnVs\nbCkKICAgICAgICAgICAgY29sLnNldFNpemUoSW50ZWdlci5wYXJzZUludCh2\nYWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgic2NhbGUiKTsK\nICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5zZXRE\nZWNpbWFsRGlnaXRzKEludGVnZXIucGFyc2VJbnQodmFsKSk7CiAgICAgICAg\ndmFsID0gYXR0cnMuZ2V0VmFsdWUoIm51bGxhYmxlIik7CiAgICAgICAgaWYg\nKHZhbCAhPSBudWxsKQogICAgICAgICAgICBjb2wuc2V0Tm90TnVsbCgiZmFs\nc2UiLmVxdWFscyh2YWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1\nZSgiaW5zZXJ0YWJsZSIpOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAg\nICAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxF\nLCAiZmFsc2UiLmVxdWFscyh2YWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5n\nZXRWYWx1ZSgidXBkYXRhYmxlIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxs\nKQogICAgICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFU\nQUJMRSwgImZhbHNlIi5lcXVhbHModmFsKSk7CgogICAgICAgIHZhbCA9IGF0\ndHJzLmdldFZhbHVlKCJ1bmlxdWUiKTsKICAgICAgICBpZiAodmFsICE9IG51\nbGwpCiAgICAgICAgICAgIF91bmlxdWUuYWRkKEVudW0udmFsdWVPZihVbmlx\ndWVGbGFnLmNsYXNzLCB2YWwudG9VcHBlckNhc2UoKSkpOwogICAgICAgIHZh\nbCA9IGF0dHJzLmdldFZhbHVlKCJ0YWJsZSIpOwogICAgICAgIGlmICh2YWwg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2NvbFRhYmxlICE9IG51bGwg\nJiYgIV9jb2xUYWJsZS5lcXVhbHModmFsKSkKICAgICAgICAgICAgICAgIHRo\ncm93IGdldEV4Y2VwdGlvbihfbG9jLmdldCgic2Vjb25kLWluY29uc2lzdCIs\nCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEVsZW1lbnQoKSkpOwogICAg\nICAgICAgICBfY29sVGFibGUgPSB2YWw7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBjb2xsZWN0\naW9uVGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydENv\nbGxlY3Rpb25UYWJsZShBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChG\naWVsZE1hcHBpbmcpIHBlZWtFbGVtZW50KCk7CgogICAgICAgIEZpZWxkTWFw\ncGluZ0luZm8gaW5mbyA9IGZtLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAg\nREJJZGVudGlmaWVyIGN0YmwgPSBwYXJzZUNvbGxlY3Rpb25UYWJsZShhdHRy\ncyk7CiAgICAgICAgaW5mby5zZXRUYWJsZUlkZW50aWZpZXIoY3RibCk7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJpdmF0ZSBEQklkZW50\naWZpZXIgcGFyc2VDb2xsZWN0aW9uVGFibGUoQXR0cmlidXRlcyBhdHRycykg\newogICAgICAgIFN0cmluZyB0VmFsID0gYXR0cnMuZ2V0VmFsdWUoIm5hbWUi\nKTsKICAgICAgICBTdHJpbmcgc1ZhbCA9IGF0dHJzLmdldFZhbHVlKCJzY2hl\nbWEiKTsKICAgICAgICByZXR1cm4gdG9UYWJsZUlkZW50aWZpZXIoc1ZhbCwg\ndFZhbCk7IAogICAgfQoKICAgIC8qKgogICAgICogRm9ybSBhIHF1YWxpZmll\nZCB0YWJsZSBuYW1lIGZyb20gYSBzY2hlbWEgYW5kIHRhYmxlIG5hbWUuCiAg\nICAgKi8KICAgIHByaXZhdGUgREJJZGVudGlmaWVyIHRvVGFibGVJZGVudGlm\naWVyKFN0cmluZyBzY2hlbWEsIFN0cmluZyB0YWJsZSkgewogICAgICAgIERC\nSWRlbnRpZmllciBzTmFtZSA9IERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2No\nZW1hLCBkZWxpbWl0KCkpOwogICAgICAgIERCSWRlbnRpZmllciB0TmFtZSA9\nIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZSwgZGVsaW1pdCgpKTsKICAg\nICAgICBpZiAoREJJZGVudGlmaWVyLmlzRW1wdHkodE5hbWUpIHx8IERCSWRl\nbnRpZmllci5pc0VtcHR5KHNOYW1lKSkgewogICAgICAgICAgICByZXR1cm4g\ndE5hbWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBRdWFsaWZpZWREQklk\nZW50aWZpZXIubmV3UGF0aChzTmFtZSwgdE5hbWUpOwogICAgfQoKCiAgICAv\nKioKICAgICAqIFN0YXJ0IHByb2Nlc3NpbmcgPGNvZGU+c3FsLXJlc3VsdC1z\nZXQtbWFwcGluZzwvY29kZT4gbm9kZS4KICAgICAqIFB1c2hlcyB0aGUge0Bs\naW5rIFF1ZXJ5UmVzdWx0TWFwcGluZ30gb250byB0aGUgc3RhY2sgYXMgY3Vy\ncmVudCBlbGVtZW50LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3Rh\ncnRTUUxSZXN1bHRTZXRNYXBwaW5nKEF0dHJpYnV0ZXMgYXR0cnMpIHsKICAg\nICAgICBTdHJpbmcgbmFtZSA9IGF0dHJzLmdldFZhbHVlKCJuYW1lIik7CiAg\nICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJwYXJzZS1zcWxyc21hcHBpbmciLCBuYW1lKSk7CgogICAgICAgIE1hcHBp\nbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBnZXRS\nZXBvc2l0b3J5KCk7CiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlc3Vs\ndCA9IHJlcG9zLmdldENhY2hlZFF1ZXJ5UmVzdWx0TWFwcGluZwogICAgICAg\nICAgICAobnVsbCwgbmFtZSk7CiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxs\nICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy53YXJu\nKF9sb2MuZ2V0KCJvdmVycmlkZS1zcWxyc21hcHBpbmciLCBuYW1lLAogICAg\nICAgICAgICAgICAgY3VycmVudExvY2F0aW9uKCkpKTsKCiAgICAgICAgcmVz\ndWx0ID0gcmVwb3MuYWRkUXVlcnlSZXN1bHRNYXBwaW5nKG51bGwsIG5hbWUp\nOwogICAgICAgIHJlc3VsdC5zZXRMaXN0aW5nSW5kZXgoX3Jlc3VsdElkeCsr\nKTsKICAgICAgICBhZGRDb21tZW50cyhyZXN1bHQpOwoKICAgICAgICBPYmpl\nY3QgY3VyID0gY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBPYmplY3Qgc2Nv\ncGUgPSAoY3VyIGluc3RhbmNlb2YgQ2xhc3NNZXRhRGF0YSkKICAgICAgICAg\nICAgPyAoKENsYXNzTWV0YURhdGEpIGN1cikuZ2V0RGVzY3JpYmVkVHlwZSgp\nIDogbnVsbDsKICAgICAgICByZXN1bHQuc2V0U291cmNlKGdldFNvdXJjZUZp\nbGUoKSwgc2NvcGUsIFNvdXJjZVRyYWNrZXIuU1JDX1hNTCk7CiAgICAgICAg\nTG9jYXRvciBsb2NhdG9yID0gZ2V0TG9jYXRpb24oKS5nZXRMb2NhdG9yKCk7\nCiAgICAgICAgaWYgKGxvY2F0b3IgIT0gbnVsbCkgewogICAgICAgICAgICBy\nZXN1bHQuc2V0TGluZU51bWJlcihsb2NhdG9yLmdldExpbmVOdW1iZXIoKSk7\nCiAgICAgICAgICAgIHJlc3VsdC5zZXRDb2xOdW1iZXIobG9jYXRvci5nZXRD\nb2x1bW5OdW1iZXIoKSk7CiAgICAgICAgfQogICAgICAgIHB1c2hFbGVtZW50\nKHJlc3VsdCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGVuZFNRTFJlc3VsdFNldE1hcHBpbmcoKQogICAgICAgIHRo\ncm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIHBvcEVsZW1lbnQoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFN0YXJ0IHByb2Nlc3NpbmcgPGNvZGU+ZW50\naXR5LXJlc3VsdDwvY29kZT4gbm9kZS4KICAgICAqIFB1c2hlcyB0aGUge0Bs\naW5rIFF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3VsdH0KICAgICAqIG9udG8g\ndGhlIHN0YWNrIGFzIGN1cnJlbnQgZWxlbWVudC4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIHN0YXJ0RW50aXR5UmVzdWx0KEF0dHJpYnV0ZXMgYXR0\ncnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xh\nc3M8Pz4gZW50aXR5Q2xhc3MgPSBjbGFzc0Zvck5hbWUoYXR0cnMuZ2V0VmFs\ndWUoImVudGl0eS1jbGFzcyIpKTsKICAgICAgICBTdHJpbmcgZGlzY3JpbWlu\nYXRvciA9IERCSWRlbnRpZmllci5uZXdDb2x1bW4oYXR0cnMuZ2V0VmFsdWUo\nImRpc2NyaW1pbmF0b3ItY29sdW1uIiksIGRlbGltaXQoKSkuZ2V0TmFtZSgp\nOyAKCiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHBhcmVudCA9IChRdWVy\neVJlc3VsdE1hcHBpbmcpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgUXVl\ncnlSZXN1bHRNYXBwaW5nLlBDUmVzdWx0IHJlc3VsdCA9IHBhcmVudC5hZGRQ\nQ1Jlc3VsdChlbnRpdHlDbGFzcyk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGRpc2NyaW1pbmF0b3IpKQogICAgICAgICAgICByZXN1bHQu\nYWRkTWFwcGluZyhQQ1Jlc3VsdC5ESVNDUklNSU5BVE9SLCBkaXNjcmltaW5h\ndG9yKTsKICAgICAgICBwdXNoRWxlbWVudChyZXN1bHQpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBlbmRFbnRpdHlS\nZXN1bHQoKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAg\nIHBvcEVsZW1lbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3Mg\nYSA8Y29kZT5maWVsZC1yZXN1bHQ8L2NvZGU+IG5vZGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBzdGFydEZpZWxkUmVzdWx0KEF0dHJpYnV0ZXMg\nYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAg\nU3RyaW5nIGZpZWxkTmFtZSA9IGF0dHJzLmdldFZhbHVlKCJuYW1lIik7CiAg\nICAgICAgU3RyaW5nIGNvbHVtbk5hbWUgPSBEQklkZW50aWZpZXIubmV3Q29s\ndW1uKGF0dHJzLmdldFZhbHVlKCJjb2x1bW4iKSwgZGVsaW1pdCgpKS5nZXRO\nYW1lKCk7CgogICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3VsdCBw\nYXJlbnQgPSAoUXVlcnlSZXN1bHRNYXBwaW5nLlBDUmVzdWx0KQogICAgICAg\nICAgICBjdXJyZW50RWxlbWVudCgpOwogICAgICAgIHBhcmVudC5hZGRNYXBw\naW5nKGZpZWxkTmFtZSwgY29sdW1uTmFtZSk7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNzIGEgPGNvZGU+Y29s\ndW1uLXJlc3VsdDwvY29kZT4gbm9kZS4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIHN0YXJ0Q29sdW1uUmVzdWx0KEF0dHJpYnV0ZXMgYXR0cnMpCiAg\nICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgUXVlcnlSZXN1\nbHRNYXBwaW5nIHBhcmVudCA9IChRdWVyeVJlc3VsdE1hcHBpbmcpIGN1cnJl\nbnRFbGVtZW50KCk7CiAgICAgICAgcGFyZW50LmFkZENvbHVtblJlc3VsdChh\ndHRycy5nZXRWYWx1ZSgibmFtZSIpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKiogCiAgICAgKiBTdGFydHMgcHJvY2Vzc2luZyAmbHQ7\ndW5pcXVlLWNvbnN0cmFpbnQmZ3Q7IHByb3ZpZGVkIHRoZSB0YWcgb2NjdXJz\nCiAgICAgKiB3aXRoaW4gYSBDbGFzc01hcHBpbmcgZWxlbWVudCBhbmQgPGVt\nPm5vdDwvZW0+IHdpdGhpbiBhIHNlY29uZGFyeQogICAgICogdGFibGUuIAog\nICAgICogUHVzaGVzIHRoZSBVbmlxdWUgZWxlbWVudCBpbiB0aGUgc3RhY2su\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydFVuaXF1ZUNvbnN0\ncmFpbnQoQXR0cmlidXRlcyBhdHRycykgCiAgICAgICAgdGhyb3dzIFNBWEV4\nY2VwdGlvbiB7CiAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IG5ldyBVbmlxdWUo\nKTsKCiAgICAgICAgREJJZGVudGlmaWVyIG5hbWUgPSBEQklkZW50aWZpZXIu\nbmV3Q29uc3RyYWludChhdHRycy5nZXRWYWx1ZSgibmFtZSIpLCBkZWxpbWl0\nKCkpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzRW1wdHkobmFtZSkp\nIHsKICAgICAgICAgICAgdW5pcXVlLnNldElkZW50aWZpZXIobmFtZSk7CiAg\nICAgICAgfQoKICAgICAgICBwdXNoRWxlbWVudCh1bmlxdWUpOwogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEVuZHMg\ncHJvY2Vzc2luZyAmbHQ7dW5pcXVlLWNvbnN0cmFpbnQmZ3Q7IHByb3ZpZGVk\nIHRoZSB0YWcgb2NjdXJzCiAgICAgKiB3aXRoaW4gYSBDbGFzc01hcHBpbmcg\nZWxlbWVudCBhbmQgPGVtPm5vdDwvZW0+IHdpdGhpbiBhIHNlY29uZGFyeQog\nICAgICogdGFibGUuIFRoZSBzdGFjayBpcyBwb3BwZWQgYW5kIHRoZSBVbmlx\ndWUgZWxlbWVudCBpcyBhZGRlZCB0byB0aGUKICAgICAqIENsYXNzTWFwcGlu\nZ0luZm8uIAogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5kVW5pcXVlQ29u\nc3RyYWludCgpIHsKICAgICAgICBVbmlxdWUgdW5pcXVlID0gKFVuaXF1ZSkg\ncG9wRWxlbWVudCgpOwogICAgICAgIE9iamVjdCBjdHggPSBjdXJyZW50RWxl\nbWVudCgpOwogICAgICAgIERCSWRlbnRpZmllciB0YWJsZU5hbWUgPSBEQklk\nZW50aWZpZXIubmV3VGFibGUoIj8iKTsKICAgICAgICBpZiAoY3R4IGluc3Rh\nbmNlb2YgQ2xhc3NNYXBwaW5nKSB7CiAgICAgICAgCUNsYXNzTWFwcGluZ0lu\nZm8gaW5mbyA9ICgoQ2xhc3NNYXBwaW5nKSBjdHgpLmdldE1hcHBpbmdJbmZv\nKCk7CiAgICAgICAgCXRhYmxlTmFtZSA9IChfc2Vjb25kYXJ5VGFibGUgPT0g\nbnVsbCkgCiAgICAgICAgCQk/IGluZm8uZ2V0VGFibGVJZGVudGlmaWVyKCkg\nOiBEQklkZW50aWZpZXIubmV3VGFibGUoX3NlY29uZGFyeVRhYmxlLCBkZWxp\nbWl0KCkpOwogICAgICAgIAlpbmZvLmFkZFVuaXF1ZSh0YWJsZU5hbWUsIHVu\naXF1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChjdHggaW5zdGFuY2VvZiBGaWVs\nZE1hcHBpbmcpIHsvLyBKb2luVGFibGUKICAgICAgICAJRmllbGRNYXBwaW5n\nSW5mbyBpbmZvID0gKChGaWVsZE1hcHBpbmcpY3R4KS5nZXRNYXBwaW5nSW5m\nbygpOwogICAgICAgIAlpbmZvLmFkZEpvaW5UYWJsZVVuaXF1ZSh1bmlxdWUp\nOwogICAgICAgIH0gZWxzZSBpZiAoY3R4IGluc3RhbmNlb2YgU2VxdWVuY2VN\nYXBwaW5nKSB7CiAgICAgICAgCVNlcXVlbmNlTWFwcGluZyBzZXEgPSAoU2Vx\ndWVuY2VNYXBwaW5nKWN0eDsKICAgICAgICAJdW5pcXVlLnNldFRhYmxlSWRl\nbnRpZmllcihzZXEuZ2V0VGFibGVJZGVudGlmaWVyKCkpOwogICAgICAgIAlD\nb2x1bW5bXSB1bmlxdWVDb2x1bW5zID0gdW5pcXVlLmdldENvbHVtbnMoKTsK\nICAgICAgICAJREJJZGVudGlmaWVyW10gY29sdW1uTmFtZXMgPSBuZXcgREJJ\nZGVudGlmaWVyW3VuaXF1ZUNvbHVtbnMubGVuZ3RoXTsKICAgICAgICAJaW50\nIGkgPSAwOwogICAgICAgIAlmb3IgKENvbHVtbiB1bmlxdWVDb2x1bW4gOiB1\nbmlxdWVDb2x1bW5zKQogICAgICAgIAkJY29sdW1uTmFtZXNbaSsrXSA9IHVu\naXF1ZUNvbHVtbi5nZXRJZGVudGlmaWVyKCkuY2xvbmUoKTsKICAgICAgICAJ\nc2VxLnNldFVuaXF1ZUNvbHVtbnNJZGVudGlmaWVyKGNvbHVtbk5hbWVzKTsK\nICAgICAgICAJaWYgKCFEQklkZW50aWZpZXIuaXNFbXB0eSh1bmlxdWUuZ2V0\nSWRlbnRpZmllcigpKSkgewogICAgICAgIAkgICAgc2VxLnNldFVuaXF1ZUNv\nbnN0cmFpbnRJZGVudGlmaWVyKHVuaXF1ZS5nZXRJZGVudGlmaWVyKCkpOwog\nICAgICAgIAl9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAJdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICAvKioKICAgICAqIEVuZHMgcHJvY2Vzc2luZyAmbHQ7Y29sdW1uLW5hbWUm\nZ3Q7IHRhZyBieSBhZGRpbmcgdGhlIGNvbHVtbiBuYW1lIGluCiAgICAgKiB0\naGUgY3VycmVudCBVbmlxdWUgZWxlbWVudCB0aGF0IHJlc2lkZXMgaW4gdGhl\nIHRvcCBvZiB0aGUgc3RhY2suCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBlbmRDb2x1bW5OYW1lKCkgewogICAgICAgIE9iamVjdCBjdXJyZW50ID0g\nY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBpZiAoY3VycmVudCBpbnN0YW5j\nZW9mIFVuaXF1ZSkgewogICAgICAgICAgICBVbmlxdWUgdW5pcXVlID0gKFVu\naXF1ZSkgY3VycmVudDsKICAgICAgICAgICAgQ29sdW1uIGNvbHVtbiA9IG5l\ndyBDb2x1bW4oKTsKICAgICAgICAgICAgY29sdW1uLnNldElkZW50aWZpZXIo\nREJJZGVudGlmaWVyLm5ld0NvbHVtbih0aGlzLmN1cnJlbnRUZXh0KCksIGRl\nbGltaXQoKSkpOwogICAgICAgICAgICB1bmlxdWUuYWRkQ29sdW1uKGNvbHVt\nbik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVHJh\nY2sgdW5pcXVlIGNvbHVtbiBzZXR0aW5ncy4KCSAqLwoJcHJpdmF0ZSBzdGF0\naWMgZW51bSBVbmlxdWVGbGFnCgl7CgkJVFJVRSwKCQlGQUxTRQoJfQoJCglw\ncml2YXRlIHZvaWQgcGFyc2VEaXNjcmltaW5hdG9yQ29sdW1uKEF0dHJpYnV0\nZXMgYXR0cnMpIHsgCgkgICAgU3RyaW5nIHZhbCA9IGF0dHJzLmdldFZhbHVl\nKCJkaXNjcmltaW5hdG9yLXR5cGUiKTsKICAgICAgICBpZiAodmFsICE9IG51\nbGwpIHsKICAgICAgICAgICAgX2Rpc2NUeXBlID0gRW51bS52YWx1ZU9mKERp\nc2NyaW1pbmF0b3JUeXBlLmNsYXNzLCB2YWwpOwogICAgICAgIH0KICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgX2Rpc2NUeXBlID0gRGlzY3JpbWluYXRv\nclR5cGUuU1RSSU5HOwogICAgICAgIH0KICAgICAgICAgICAgCgl9ICAKICAg\nIAogICAgLyoqCiAgICAgKiBQcm9jZXNzIE9yZGVyQ29sdW1uLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdGFydE9yZGVyQ29sdW1uKEF0dHJp\nYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ29sdW1uIGNvbCA9IHBhcnNlT3JkZXJDb2x1bW4oYXR0cnMpOwog\nICAgICAgIE9iamVjdCBvYmogPSBwZWVrRWxlbWVudCgpOwogICAgICAgIGlm\nIChvYmogaW5zdGFuY2VvZiBGaWVsZE1hcHBpbmcpIHsKICAgICAgICAgICAg\nRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZylvYmo7CiAgICAgICAg\nICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0T3JkZXJDb2x1bW4oY29sKTsK\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYW4gb3JkZXIgY29sdW1uIHdpdGggdGhlIGdpdmVu\nIGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgQ29sdW1uIHBhcnNl\nT3JkZXJDb2x1bW4oQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKCiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1\nbW4oKTsKICAgICAgICBTdHJpbmcgdmFsID0gYXR0cnMuZ2V0VmFsdWUoIm5h\nbWUiKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIGNv\nbC5zZXRJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdDb2x1bW4odmFsLCBk\nZWxpbWl0KCkpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgiY29s\ndW1uLWRlZmluaXRpb24iKTsgCiAgICAgICAgaWYgKHZhbCAhPSBudWxsKQog\nICAgICAgICAgICBjb2wuc2V0VHlwZUlkZW50aWZpZXIoREJJZGVudGlmaWVy\nLm5ld0NvbHVtbkRlZmluaXRpb24odmFsKSk7CiAgICAgICAgdmFsID0gYXR0\ncnMuZ2V0VmFsdWUoInByZWNpc2lvbiIpOwogICAgICAgIGlmICh2YWwgIT0g\nbnVsbCkKICAgICAgICAgICAgY29sLnNldFNpemUoSW50ZWdlci5wYXJzZUlu\ndCh2YWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1ZSgibGVuZ3Ro\nIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBjb2wu\nc2V0U2l6ZShJbnRlZ2VyLnBhcnNlSW50KHZhbCkpOwogICAgICAgIHZhbCA9\nIGF0dHJzLmdldFZhbHVlKCJzY2FsZSIpOwogICAgICAgIGlmICh2YWwgIT0g\nbnVsbCkKICAgICAgICAgICAgY29sLnNldERlY2ltYWxEaWdpdHMoSW50ZWdl\nci5wYXJzZUludCh2YWwpKTsKICAgICAgICB2YWwgPSBhdHRycy5nZXRWYWx1\nZSgibnVsbGFibGUiKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAg\nICAgICAgIGNvbC5zZXROb3ROdWxsKCJmYWxzZSIuZXF1YWxzKHZhbCkpOwog\nICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJpbnNlcnRhYmxlIik7CiAg\nICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICBjb2wuc2V0Rmxh\nZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICJmYWxzZSIuZXF1YWxzKHZh\nbCkpOwogICAgICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJ1cGRhdGFibGUi\nKTsKICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAiZmFsc2UiLmVxdWFs\ncyh2YWwpKTsKICAgICAgICAKICAgICAgICByZXR1cm4gY29sOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIFByb2Nlc3MgYWxsIGRlZmVycmVkIGVtYmVk\nZGFibGUgb3ZlcnJpZGVzIGZvciBhIGdpdmVuIGNsYXNzLiAgCiAgICAgKiBU\naGlzIHNob3VsZCBvbmx5IG9jY3VyIGFmdGVyIHRoZSBlbWJlZGRhYmxlIGlz\nIG1hcHBlZC4KICAgICAqIAogICAgICogQHBhcmFtIGVtYmVkVHlwZSAgZW1i\nZWRkYWJsZSBjbGFzcyAKICAgICAqIEBwYXJhbSBhY2Nlc3MgY2xhc3MgbGV2\nZWwgYWNjZXNzIGZvciBlbWJlZGRhYmxlCiAgICAgKiBAdGhyb3dzIFNBWEV4\nY2VwdGlvbiAKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQg\ndm9pZCBhcHBseURlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyhDbGFzczw/\nPiBjbHMpIAogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAg\nIEFycmF5TGlzdDxEZWZlcnJlZEVtYmVkZGFibGVPdmVycmlkZXM+IGRlZk1h\ncHBpbmdzID0gCiAgICAgICAgICAgIF9kZWZlcnJlZE1hcHBpbmdzLmdldChj\nbHMpOwogICAgICAgIGlmIChkZWZNYXBwaW5ncyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgCiAgICAgICAgZm9yIChEZWZlcnJlZEVt\nYmVkZGFibGVPdmVycmlkZXMgZGVmTWFwIDogZGVmTWFwcGluZ3MpIHsKICAg\nICAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZylkZWZN\nYXAuX2ZtOwogICAgICAgICAgICBpZiAoZGVmTWFwID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGZtID0gZ2V0QXR0cmli\ndXRlT3ZlcnJpZGVGb3JFbWJlZGRhYmxlKGZtLCBkZWZNYXAuX2F0dHJOYW1l\nLCB0cnVlKTsKICAgICAgICAgICAgLy8gQXBwbHkgY29sdW1uLCB0YWJsZSwg\nYW5kIHVuaXF1ZSBvdmVycmlkZXMKICAgICAgICAgICAgaWYgKGRlZk1hcC5f\nZGVmQ29scyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmbS5nZXRWYWx1\nZUluZm8oKS5zZXRDb2x1bW5zKGRlZk1hcC5fZGVmQ29scyk7CiAgICAgICAg\nICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwoZGVmTWFwLl9kZWZU\nYWJsZSkpCiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8o\nKS5zZXRUYWJsZUlkZW50aWZpZXIoZGVmTWFwLl9kZWZUYWJsZSk7CiAgICAg\nICAgICAgICAgICBzZXRVbmlxdWUoZm0sIGRlZk1hcC5fdW5pcXVlKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICAvLyBBcHBseSBKb2luIGNvbHVtbiBh\nbmQgZWxlbWVudCBqb2luIGNvbHVtbnMgb3ZlcnJpZGVzIG92ZXJyaWRlcwog\nICAgICAgICAgICBpZiAoZGVmTWFwLl9kZWZKb2luQ29scyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5z\nKGRlZk1hcC5fZGVmSm9pbkNvbHMpOwogICAgICAgICAgICBpZiAoZGVmTWFw\nLl9kZWZFbGVtSm9pbkNvbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZt\nLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0Q29sdW1u\ncygKICAgICAgICAgICAgICAgICAgICBkZWZNYXAuX2RlZkVsZW1Kb2luQ29s\ncyk7CiAgICAgICAgfQogICAgICAgIC8vIENsZWFuIHVwIGFmdGVyIGFwcGx5\naW5nIG1hcHBpbmdzCiAgICAgICAgZGVmTWFwcGluZ3MuY2xlYXIoKTsKICAg\nICAgICBfZGVmZXJyZWRNYXBwaW5ncy5yZW1vdmUoY2xzKTsKICAgIH0KCiAg\nICAvKgogICAgICogRGVmZXIgb3ZlcnJpZGVzIGZvciB0aGUgc3BlY2lmaWVk\nIGZpZWxkIG1hcHBpbmcKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRlZmVy\nRW1iZWRkYWJsZU92ZXJyaWRlcygKICAgICAgICBDbGFzczw/PiBjbHMsIERl\nZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyBkZWZNYXApIHsKICAgICAgICBB\ncnJheUxpc3Q8RGVmZXJyZWRFbWJlZGRhYmxlT3ZlcnJpZGVzPiBkZWZNYXBw\naW5ncyA9IAogICAgICAgICAgICBfZGVmZXJyZWRNYXBwaW5ncy5nZXQoY2xz\nKTsKICAgICAgICBpZiAoZGVmTWFwcGluZ3MgPT0gbnVsbCkgewogICAgICAg\nICAgICBkZWZNYXBwaW5ncyA9IG5ldyBBcnJheUxpc3Q8RGVmZXJyZWRFbWJl\nZGRhYmxlT3ZlcnJpZGVzPigpOwogICAgICAgICAgICBfZGVmZXJyZWRNYXBw\naW5ncy5wdXQoY2xzLCBkZWZNYXBwaW5ncyk7CiAgICAgICAgfQogICAgICAg\nIGRlZk1hcHBpbmdzLmFkZChkZWZNYXApOwogICAgfQogICAgCiAgICAvKgog\nICAgICogQ2xlYW4gdXAgYW55IGRlZmVycmVkIG1hcHBpbmdzCiAgICAgKi8K\nICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZlcnJl\nZE1ldGFEYXRhKCkgewogICAgICAgIHN1cGVyLmNsZWFyRGVmZXJyZWRNZXRh\nRGF0YSgpOwogICAgICAgIF9kZWZlcnJlZE1hcHBpbmdzLmNsZWFyKCk7CiAg\nICB9CiAgICAKICAgIC8qCiAgICAgKiBHZXQgZW1iZWRkYWJsZSBvdmVycmlk\nZXMgZm9yIHRoZSBzcGVjaWZpZWQgZmllbGQgbWFwcGluZy4gIElmIGNyZWF0\nZQogICAgICogaXMgdHJ1ZSwgY3JlYXRlIGEgbmV3IG92ZXJyaWRlIGlmIG9u\nZSBkb2VzIG5vdCBleGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBEZWZlcnJl\nZEVtYmVkZGFibGVPdmVycmlkZXMgCiAgICAgICAgZ2V0RGVmZXJyZWRGaWVs\nZE1hcHBpbmdJbmZvKENsYXNzPD8+IGNscywgRmllbGRNYXBwaW5nIGZtLCAK\nICAgICAgICAgICAgU3RyaW5nIGF0dHJOYW1lLCBib29sZWFuIGNyZWF0ZSkg\newoKICAgICAgICBBcnJheUxpc3Q8RGVmZXJyZWRFbWJlZGRhYmxlT3ZlcnJp\nZGVzPiBkZWZNYXBwaW5ncyA9IAogICAgICAgICAgICBfZGVmZXJyZWRNYXBw\naW5ncy5nZXQoY2xzKTsKICAgICAgICAKICAgICAgICBpZiAoZGVmTWFwcGlu\nZ3MgPT0gbnVsbCAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgZGVmTWFwcGlu\nZ3MgPSBuZXcgQXJyYXlMaXN0PERlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRl\ncz4oKTsKICAgICAgICAgICAgX2RlZmVycmVkTWFwcGluZ3MucHV0KGNscywg\nZGVmTWFwcGluZ3MpOwogICAgICAgIH0KICAgICAgICBEZWZlcnJlZEVtYmVk\nZGFibGVPdmVycmlkZXMgZGZtID0gCiAgICAgICAgICAgIGZpbmREZWZlcnJl\nZE1hcHBpbmcoY2xzLCBmbSwgYXR0ck5hbWUpOwoKICAgICAgICBpZiAoZGZt\nID09IG51bGwgJiBjcmVhdGUpIHsKICAgICAgICAgICAgZGZtID0gbmV3IERl\nZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyhmbSwgYXR0ck5hbWUpOwogICAg\nICAgICAgICBkZWZlckVtYmVkZGFibGVPdmVycmlkZXMoY2xzLCBkZm0pOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZGZtOyAgICAgICAgICAgIAogICAg\nfQoKICAgIC8qCiAgICAgKiBGaW5kIGRlZmVycmVkIG1hcHBpbmdzIGZvciB0\naGUgZ2l2ZW4gY2xhc3MsIGZtLCBhbmQgYXR0ciBuYW1lCiAgICAgKi8KICAg\nIHByaXZhdGUgRGVmZXJyZWRFbWJlZGRhYmxlT3ZlcnJpZGVzIGZpbmREZWZl\ncnJlZE1hcHBpbmcoQ2xhc3M8Pz4gY2xzLCAKICAgICAgICBGaWVsZE1hcHBp\nbmcgZm0sIFN0cmluZyBhdHRyTmFtZSkgewogICAgICAgIEFycmF5TGlzdDxE\nZWZlcnJlZEVtYmVkZGFibGVPdmVycmlkZXM+IGRlZk1hcHBpbmdzID0gCiAg\nICAgICAgICAgIF9kZWZlcnJlZE1hcHBpbmdzLmdldChjbHMpOwogICAgICAg\nIGlmIChkZWZNYXBwaW5ncyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAKICAgICAgICBmb3IgKERlZmVycmVkRW1iZWRkYWJs\nZU92ZXJyaWRlcyBkZm0gOiBkZWZNYXBwaW5ncykgewogICAgICAgICAgICBp\nZiAoZGZtICE9IG51bGwgJiYgZGZtLl9mbSA9PSBmbSAmJiAKICAgICAgICAg\nICAgICAgIGF0dHJOYW1lLmVxdWFscyhkZm0uX2F0dHJOYW1lKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBkZm07CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyBhbGwgZGVm\nZXJyZWQgZW1iZWRkYWJsZXMgdXNpbmcgYW4gdW5rbm93biBhY2Nlc3MgdHlw\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYWRkRGVmZXJyZWRFbWJl\nZGRhYmxlTWV0YURhdGEoKSB7CiAgICAgICAgc3VwZXIuYWRkRGVmZXJyZWRF\nbWJlZGRhYmxlTWV0YURhdGEoKTsKICAgICAgICBpZiAoX2RlZmVycmVkTWFw\ncGluZ3Muc2l6ZSgpID4gMCkgewogICAgICAgICAgICBTZXQ8Q2xhc3M8Pz4+\nIGtleXMgPSBfZGVmZXJyZWRNYXBwaW5ncy5rZXlTZXQoKTsKICAgICAgICAg\nICAgQ2xhc3NbXSBjbGFzc2VzID0ga2V5cy50b0FycmF5KG5ldyBDbGFzc1sw\nXSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2xhc3Nlcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBhcHBseURlZmVycmVkRW1iZWRkYWJsZU92ZXJyaWRlcyhj\nbGFzc2VzW2ldKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvYy5n\nZXQoIm5vLWVtYmVkZGFibGUtbWV0YWRhdGEiLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNsYXNzZXNbaV0uZ2V0TmFtZSgpKSwgZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgCiAgICB9ICAgIAogICAgCiAgICAvLyBJbm5lciBjbGFzcyBmb3Igc3Rv\ncmluZyBvdmVycmlkZSBpbmZvcm1hdGlvbgogICAgY2xhc3MgRGVmZXJyZWRF\nbWJlZGRhYmxlT3ZlcnJpZGVzIHsKICAgICAgICBEZWZlcnJlZEVtYmVkZGFi\nbGVPdmVycmlkZXMoRmllbGRNYXBwaW5nIGZtLCBTdHJpbmcgYXR0ck5hbWUp\nIHsKICAgICAgICAgICAgX2ZtID0gZm07CiAgICAgICAgICAgIF9hdHRyTmFt\nZSA9IGF0dHJOYW1lOwogICAgICAgICAgICBfZGVmVGFibGUgPSBEQklkZW50\naWZpZXIuTlVMTDsKICAgICAgICB9CiAgICAgICAgcHJpdmF0ZSBGaWVsZE1h\ncHBpbmcgX2ZtOwogICAgICAgIHByaXZhdGUgTGlzdDxDb2x1bW4+IF9kZWZD\nb2xzOwogICAgICAgIHByaXZhdGUgTGlzdDxDb2x1bW4+IF9kZWZFbGVtSm9p\nbkNvbHM7CiAgICAgICAgcHJpdmF0ZSBMaXN0PENvbHVtbj4gX2RlZkpvaW5D\nb2xzOwogICAgICAgIHByaXZhdGUgREJJZGVudGlmaWVyIF9kZWZUYWJsZTsK\nICAgICAgICBwcml2YXRlIFN0cmluZyBfYXR0ck5hbWU7CiAgICAgICAgcHJp\ndmF0ZSBFbnVtU2V0PFVuaXF1ZUZsYWc+IF91bmlxdWU7CiAgICB9ICAKICAg\nIAogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdGFydERl\nbGltaXRlZElkZW50aWZpZXJzKCkgewogICAgICAgIEpEQkNDb25maWd1cmF0\naW9uIGNvbmYgPSAoSkRCQ0NvbmZpZ3VyYXRpb24pIGdldENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IGNvbmYuZ2V0REJE\naWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBkaWN0LnNldERlbGltaXRJ\nZGVudGlmaWVycyh0cnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nICAgIAogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG5vcm1h\nbGl6ZVNlcXVlbmNlTmFtZShTdHJpbmcgc2VxTmFtZSkgewogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KHNlcU5hbWUpKSB7CiAgICAgICAgICAg\nIHJldHVybiBzZXFOYW1lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gREJJ\nZGVudGlmaWVyLm5ld1NlcXVlbmNlKHNlcU5hbWUsIGRlbGltaXQoKSkuZ2V0\nTmFtZSgpOwogICAgfQogICAgCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCBTdHJpbmcgbm9ybWFsaXplU2NoZW1hTmFtZShTdHJpbmcgc2NoTmFtZSkg\newogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNjaE5hbWUpKSB7\nCiAgICAgICAgICAgIHJldHVybiBzY2hOYW1lOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hOYW1lLCBkZWxp\nbWl0KCkpLmdldE5hbWUoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCBTdHJpbmcgbm9ybWFsaXplQ2F0YWxvZ05hbWUoU3RyaW5nIGNh\ndE5hbWUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjYXRO\nYW1lKSkgewogICAgICAgICAgICByZXR1cm4gY2F0TmFtZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdE5h\nbWUsIGRlbGltaXQoKSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIHByaXZhdGUg\nYm9vbGVhbiBkZWxpbWl0KCkgewogICAgICAgIHJldHVybiBfZGljdC5nZXRE\nZWxpbWl0SWRlbnRpZmllcnMoKTsKICAgIH0KfQo=\n","encoding":"base64"}

