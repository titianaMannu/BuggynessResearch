{"sha":"79762db9ca721772d343577ee87517ca3eb85874","node_id":"MDQ6QmxvYjIwNjM2NDo3OTc2MmRiOWNhNzIxNzcyZDM0MzU3N2VlODc1MTdjYTNlYjg1ODc0","size":6693,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/79762db9ca721772d343577ee87517ca3eb85874","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZSBvciBtb3JlCiAqIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UgZmlsZSBkaXN0cmli\ndXRlZCB3aXRoIHRoaXMKICogd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1h\ndGlvbiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gVGhlIEFTRgog\nKiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdp\ndGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0\naGUgTGljZW5zZSBhdAogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5z\nZXMvTElDRU5TRS0yLjAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUg\nbGF3CiAqIG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0\ncmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcwogKiBkaXN0cmlidXRlZCBv\nbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09O\nRElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1w\nbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3Vh\nZ2UKICogZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1\nbmRlciB0aGUgTGljZW5zZS4KICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLnF1ZXJ5OwoKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5FbnRpdHlNYW5hZ2VyOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuTG9ja01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTG9j\na1RpbWVvdXRFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Q\nZXNzaW1pc3RpY0xvY2tFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5RdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5VGlt\nZW91dEV4Y2VwdGlvbjsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNzZXJ0\naW9uRmFpbGVkRXJyb3I7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLkRCMkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuT3JhY2xlRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5leGNlcHRpb24uUE9iamVjdDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS50ZXN0LlNpbmds\nZUVNRlRlc3RDYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nT3BlbkpQQUV4Y2VwdGlvbjsKCi8qKgogKiBUZXN0cyB0aGF0IGNvcnJlY3Qg\ndGltZW91dCBleGNlcHRpb25zIGFyZSBiZWluZyB0aHJvd24gZGVwZW5kaW5n\nIG9uIHdoZXRoZXIgaXQgaXMgYSBxdWVyeSBvciBhIGxvY2sgb3BlcmF0aW9u\nLgogKiAKICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAqCiAqLwpwdWJsaWMg\nY2xhc3MgVGVzdFRpbWVvdXRFeGNlcHRpb24gZXh0ZW5kcyBTaW5nbGVFTUZU\nZXN0Q2FzZSB7CiAgICBwcml2YXRlIGZpbmFsIENsYXNzPD8+IGVudGl0eUNs\nYXNzID0gUE9iamVjdC5jbGFzczsKCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgp\nIHsKICAgICAgICBzZXRVbnN1cHBvcnRlZERhdGFiYXNlcyhPcmFjbGVEaWN0\naW9uYXJ5LmNsYXNzLCBEQjJEaWN0aW9uYXJ5LmNsYXNzKTsKICAgICAgICBp\nZiAoaXNUZXN0c0Rpc2FibGVkKCkpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBzdXBlci5zZXRVcChlbnRpdHlDbGFzcyk7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyB2b2lkIHRlc3RRdWVyeVRpbWVPdXRFeGNlcHRpb25XaGlsZVF1\nZXJ5aW5nV2l0aExvY2tzT25BbHJlYWR5TG9ja2VkRW50aXRpZXMoKSB7CiAg\nICAgICAgRW50aXR5TWFuYWdlciBlbTEgPSBlbWYuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW0yID0gZW1mLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBhc3NlcnROb3RTYW1lKGVtMSwg\nZW0yKTsKICAgICAgICBPYmplY3Qgb2lkID0gY3JlYXRlRW50aXR5KGVtMSk7\nCiAgICAgICAgCiAgICAgICAgZW0xLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4o\nKTsKICAgICAgICBPYmplY3QgZW50aXR5ID0gZW0xLmZpbmQoZW50aXR5Q2xh\nc3MsIG9pZCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbnRpdHkpOwogICAg\nICAgIGVtMS5sb2NrKGVudGl0eSwgTG9ja01vZGVUeXBlLlBFU1NJTUlTVElD\nX1dSSVRFKTsKICAgICAgICAKICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rpb24o\nKS5iZWdpbigpOwogICAgICAgIGZpbmFsIFF1ZXJ5IHF1ZXJ5ID0gZW0yLmNy\nZWF0ZVF1ZXJ5KCJzZWxlY3QgcCBmcm9tIFBPYmplY3QgcCIpOwogICAgICAg\nIHF1ZXJ5LnNldExvY2tNb2RlKExvY2tNb2RlVHlwZS5QRVNTSU1JU1RJQ19X\nUklURSk7CiAgICAgICAgbG9uZyB0aW1lb3V0ID0gMTAwMDsKICAgICAgICBx\ndWVyeS5zZXRIaW50KCJqYXZheC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0\nIiwgdGltZW91dCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcXVlcnku\nZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCAi\nICsgUXVlcnlUaW1lb3V0RXhjZXB0aW9uLmNsYXNzLmdldE5hbWUoKSk7CiAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgYXNz\nZXJ0RXJyb3IodCwgUXVlcnlUaW1lb3V0RXhjZXB0aW9uLmNsYXNzKTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgYXNzZXJ0VHJ1ZShlbTIuZ2V0VHJh\nbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKTsKICAgICAgICBlbTIuZ2V0VHJhbnNh\nY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgIGVtMS5nZXRUcmFuc2FjdGlv\nbigpLnJvbGxiYWNrKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHRl\nc3RMb2NrVGltZU91dEV4Y2VwdGlvbldoaWxlTG9ja2luZ0FscmVhZHlMb2Nr\nZWRFbnRpdGllcygpIHsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtMSA9IGVt\nZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgZmluYWwgRW50aXR5\nTWFuYWdlciBlbTIgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAg\nICAgIGFzc2VydE5vdFNhbWUoZW0xLCBlbTIpOwogICAgICAgIGZpbmFsIE9i\namVjdCBvaWQgPSBjcmVhdGVFbnRpdHkoZW0xKTsKICAgICAgICAKICAgICAg\nICBlbTEuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgIGZpbmFs\nIE9iamVjdCBlbnRpdHkxID0gZW0xLmZpbmQoZW50aXR5Q2xhc3MsIG9pZCk7\nCiAgICAgICAgYXNzZXJ0Tm90TnVsbChlbnRpdHkxKTsKICAgICAgICBlbTEu\nbG9jayhlbnRpdHkxLCBMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNfV1JJVEUp\nOwogICAgICAgIAogICAgICAgIGVtMi5nZXRUcmFuc2FjdGlvbigpLmJlZ2lu\nKCk7CiAgICAgICAgZmluYWwgT2JqZWN0IGVudGl0eTIgPSBlbTIuZmluZChl\nbnRpdHlDbGFzcywgb2lkKTsKICAgICAgICBmaW5hbCBsb25nIHRpbWVvdXQg\nPSAxMDAwOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE1hcDxTdHJpbmcs\nT2JqZWN0PiBoaW50ID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBPYmplY3Q+KCk7\nCiAgICAgICAgICAgIGhpbnQucHV0KCJqYXZheC5wZXJzaXN0ZW5jZS5sb2Nr\nLnRpbWVvdXQiLCB0aW1lb3V0KTsKICAgICAgICAgICAgZW0yLmxvY2soZW50\naXR5MiwgTG9ja01vZGVUeXBlLlBFU1NJTUlTVElDX1dSSVRFLCBoaW50KTsK\nICAgICAgICAgICAgZmFpbCgiRXhwZWN0ZWQgIiArIFBlc3NpbWlzdGljTG9j\na0V4Y2VwdGlvbi5jbGFzcy5nZXROYW1lKCkpOwogICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgYXNzZXJ0RXJyb3IodCwgUGVz\nc2ltaXN0aWNMb2NrRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICB9CiAgICAg\nICAgYXNzZXJ0VHJ1ZShlbTIuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgp\nKTsKICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwog\nICAgICAgIAogICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNr\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFF1ZXJ5VGltZU91dEV4\nY2VwdGlvbldoaWxlRmluZFdpdGhMb2Nrc09uQWxyZWFkeUxvY2tlZEVudGl0\naWVzKCkgewogICAgICAgIEVudGl0eU1hbmFnZXIgZW0xID0gZW1mLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtMiA9\nIGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgYXNzZXJ0Tm90\nU2FtZShlbTEsIGVtMik7CiAgICAgICAgT2JqZWN0IG9pZCA9IGNyZWF0ZUVu\ndGl0eShlbTEpOwogICAgICAgIAogICAgICAgIGVtMS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgT2JqZWN0IGVudGl0eSA9IGVtMS5maW5k\nKGVudGl0eUNsYXNzLCBvaWQpOwogICAgICAgIGFzc2VydE5vdE51bGwoZW50\naXR5KTsKICAgICAgICBlbTEubG9jayhlbnRpdHksIExvY2tNb2RlVHlwZS5Q\nRVNTSU1JU1RJQ19XUklURSk7CiAgICAgICAgCiAgICAgICAgZW0yLmdldFRy\nYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBlbTIuZmluZChlbnRpdHlDbGFzcywgb2lkLCBMb2NrTW9kZVR5cGUuUEVT\nU0lNSVNUSUNfV1JJVEUpOwogICAgICAgICAgICBmYWlsKCJFeHBlY3RlZCAi\nICsgTG9ja1RpbWVvdXRFeGNlcHRpb24uY2xhc3MuZ2V0TmFtZSgpKTsKICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICBhc3Nl\ncnRFcnJvcih0LCBMb2NrVGltZW91dEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIGFzc2VydFRydWUoZW0yLmdldFRyYW5z\nYWN0aW9uKCkuaXNBY3RpdmUoKSk7CiAgICAgICAgZW0yLmdldFRyYW5zYWN0\naW9uKCkucm9sbGJhY2soKTsKICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rpb24o\nKS5yb2xsYmFjaygpOwogICAgfQogICAgCiAgICBwdWJsaWMgT2JqZWN0IGNy\nZWF0ZUVudGl0eShFbnRpdHlNYW5hZ2VyIGVtKSB7CiAgICAgICAgbG9uZyBp\nZCA9IFN5c3RlbS5uYW5vVGltZSgpOwogICAgICAgIGVtLmdldFRyYW5zYWN0\naW9uKCkuYmVnaW4oKTsKICAgICAgICBQT2JqZWN0IHBjID0gbmV3IFBPYmpl\nY3QoKTsKICAgICAgICBwYy5zZXRJZChpZCk7CiAgICAgICAgZW0ucGVyc2lz\ndChwYyk7CiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsK\nICAgICAgICByZXR1cm4gaWQ7CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAg\nICAgKiBBc3NlcnQgdGhhdCBhbiBleGNlcHRpb24gb2YgcHJvcGVyIHR5cGUg\naGFzIGJlZW4gdGhyb3duLgogICAgICogQWxzbyBjaGVja3MgdGhhdCB0aGF0\nIHRoZSBleGNlcHRpb24gaGFzIHBvcHVsYXRlZCB0aGUgZmFpbGVkIG9iamVj\ndC4KICAgICAqIEBwYXJhbSBhY3R1YWwgZXhjZXB0aW9uIGJlaW5nIHRocm93\nbgogICAgICogQHBhcmFtIGV4cGVjZXRlZCB0eXBlIG9mIHRoZSBleGNlcHRp\nb24KICAgICAqLwogICAgdm9pZCBhc3NlcnRFcnJvcihUaHJvd2FibGUgYWN0\ndWFsLCBDbGFzczw/IGV4dGVuZHMgVGhyb3dhYmxlPiBleHBlY3RlZCkgewog\nICAgICAgIGlmICghZXhwZWN0ZWQuaXNBc3NpZ25hYmxlRnJvbShhY3R1YWwu\nZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgICAgIGFjdHVhbC5wcmludFN0\nYWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBBc3NlcnRp\nb25GYWlsZWRFcnJvcihhY3R1YWwuZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAi\nIHdhcyByYWlzZWQgYnV0IGV4cGVjdGVkICIgKyAKICAgICAgICAgICAgICAg\nICAgICAgICAgZXhwZWN0ZWQuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICAg\nICAgT2JqZWN0IGZhaWxlZCA9IGdldEZhaWxlZE9iamVjdChhY3R1YWwpOwog\nICAgICAgIGFzc2VydE5vdE51bGwoIkZhaWxlZCBvYmplY3QgaXMgbnVsbCIs\nIGZhaWxlZCk7CiAgICAgICAgYXNzZXJ0Tm90RXF1YWxzKCJudWxsIiwgZmFp\nbGVkKTsKICAgIH0gCiAgICAKICAgIE9iamVjdCBnZXRGYWlsZWRPYmplY3Qo\nVGhyb3dhYmxlIGUpIHsKICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIExvY2tU\naW1lb3V0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiAoKExvY2tU\naW1lb3V0RXhjZXB0aW9uKSBlKS5nZXRPYmplY3QoKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQZXNzaW1pc3RpY0xvY2tFeGNlcHRp\nb24pIHsKICAgICAgICAgICAgcmV0dXJuICgoUGVzc2ltaXN0aWNMb2NrRXhj\nZXB0aW9uKSBlKS5nZXRFbnRpdHkoKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKGUgaW5zdGFuY2VvZiBRdWVyeVRpbWVvdXRFeGNlcHRpb24pIHsKICAgICAg\nICAgICAgcmV0dXJuICgoUXVlcnlUaW1lb3V0RXhjZXB0aW9uKSBlKS5nZXRR\ndWVyeSgpOwogICAgICAgIH0KICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE9w\nZW5KUEFFeGNlcHRpb24pIHsKICAgICAgICAgICAgcmV0dXJuICgoT3BlbkpQ\nQUV4Y2VwdGlvbikgZSkuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgCn0K\n","encoding":"base64"}

