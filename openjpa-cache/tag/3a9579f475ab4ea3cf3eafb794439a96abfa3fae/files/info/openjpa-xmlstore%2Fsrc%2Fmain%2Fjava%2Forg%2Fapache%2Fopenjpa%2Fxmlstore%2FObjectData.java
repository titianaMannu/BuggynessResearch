{"sha":"e5b8c7e8fe1f2557cd079ad8d61f0c7a1318686b","node_id":"MDQ6QmxvYjIwNjM2NDplNWI4YzdlOGZlMWYyNTU3Y2QwNzlhZDhkNjFmMGM3YTEzMTg2ODZi","size":13923,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e5b8c7e8fe1f2557cd079ad8d61f0c7a1318686b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS54bWxzdG9yZTsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlv\nbjsKCi8qKgogKiBJbi1tZW1vcnkgZm9ybSBvZiBkYXRhIGluIGRhdGFzdG9y\nZSBiYWNraW5nIGEgc2luZ2xlIHBlcnNpc3RlbnQgb2JqZWN0LgogKi8KcHVi\nbGljIGZpbmFsIGNsYXNzIE9iamVjdERhdGEKICAgIGltcGxlbWVudHMgQ2xv\nbmVhYmxlIHsKCiAgICBwcml2YXRlIE9iamVjdCBfb2lkOwogICAgcHJpdmF0\nZSBPYmplY3RbXSBfZGF0YTsKICAgIHByaXZhdGUgTG9uZyBfdmVyc2lvbjsK\nICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBfbWV0YTsKCiAgICAvKioKICAg\nICAqIENyZWF0ZSB0aGUgb2JqZWN0IHdpdGhvdXQgdW5kZXJseWluZyBkYXRh\nLiBKdXN0IHBhc3MgaW4gdHlwZSBzcGVjaWZpYwogICAgICogbWV0YWRhdGEg\nYW5kIHRoZSBvaWQuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3REYXRhKE9i\namVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9vaWQg\nPSBvaWQ7CiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgICAgIF9kYXRhID0g\nbmV3IE9iamVjdFttZXRhLmdldEZpZWxkcygpLmxlbmd0aF07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZXR0ZXIgZm9yIG9pZC4KICAgICAqLwogICAgcHVi\nbGljIE9iamVjdCBnZXRJZCgpIHsKICAgICAgICByZXR1cm4gX29pZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgZGF0YSBmb3IgdGhlIGZpZWxk\nIHdpdGggdGhlIGdpdmVuIGluZGV4LgogICAgICovCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldEZpZWxkKGludCBudW0pIHsKICAgICAgICByZXR1cm4gX2RhdGFb\nbnVtXTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZGF0YSBmb3Ig\ndGhlIGZpZWxkIHdpdGggdGhlIGdpdmVuIGluZGV4LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRGaWVsZChpbnQgbnVtLCBPYmplY3QgdmFsKSB7CiAg\nICAgICAgX2RhdGFbbnVtXSA9IHZhbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgdmVyc2lvbiBudW1iZXIgb2YgdGhlIG9iamVjdC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0VmVyc2lvbihMb25nIHZlcnNpb24pIHsK\nICAgICAgICBfdmVyc2lvbiA9IHZlcnNpb247CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHZXQgdGhlIHZlcnNpb24gbnVtYmVyIG9mIHRoZSBvYmplY3QuCiAg\nICAgKi8KICAgIHB1YmxpYyBMb25nIGdldFZlcnNpb24oKSB7CiAgICAgICAg\ncmV0dXJuIF92ZXJzaW9uOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRo\nZSBtZXRhZGF0YSBhc3NvY2lhdGVkIHdpdGggdGhlIHR5cGUgb2YgcGVyc2lz\ndGVudCBvYmplY3QgZm9yCiAgICAgKiB3aGljaCB0aGlzIGRhdGEgYXBwbGll\ncy4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURh\ndGEoKSB7CiAgICAgICAgcmV0dXJuIF9tZXRhOwogICAgfQoKICAgIC8qKgog\nICAgICogTG9hZCB0aGUgZGF0YSBhbmQgdmVyc2lvbiBpbmZvcm1hdGlvbiBm\nb3IgdGhpcyBvYmplY3QgaW50byB0aGUKICAgICAqIGdpdmVuIHN0YXRlIG1h\nbmFnZXIuIE9ubHkgZmllbGRzIGluIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1\ncmF0aW9uIGFyZQogICAgICogbG9hZGVkLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChzbS5nZXRWZXJzaW9uKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgc20uc2V0VmVyc2lvbihfdmVyc2lvbik7\nCgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoIXNtLmdldExvYWRlZCgpLmdldChp\nKSAmJiBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAg\nICAgICAgIT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX05PTkUpCiAgICAg\nICAgICAgICAgICBzbS5zdG9yZShpLCB0b0xvYWRhYmxlKHNtLCBmbWRzW2ld\nLCBfZGF0YVtpXSwgZmV0Y2gpKTsKICAgIH0KCiAgICAvKioKICAgICAqIExv\nYWQgdGhlIGRhdGEgYW5kIHZlcnNpb24gaW5mb3JtYXRpb24gZm9yIHRoaXMg\nb2JqZWN0IGludG8gdGhlCiAgICAgKiBnaXZlbiBzdGF0ZSBtYW5hZ2VyLiBP\nbmx5IGZpZWxkcyBpbiB0aGUgZ2l2ZW4gYml0IHNldCB3aWxsIGJlIGxvYWRl\nZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChzbS5nZXRWZXJzaW9uKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgc20uc2V0VmVyc2lvbihfdmVyc2lvbik7\nCgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSkKICAgICAg\nICAgICAgICAgIHNtLnN0b3JlKGksIHRvTG9hZGFibGUoc20sIGZtZHNbaV0s\nIF9kYXRhW2ldLCBmZXRjaCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3RvcmVkIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4gaW50byBh\nIHZhbHVlIGZvciBsb2FkaW5nCiAgICAgKiBpbnRvIGEgc3RhdGUgbWFuYWdl\nci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRvTG9hZGFi\nbGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCwgT2JqZWN0IHZhbCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nKSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgQ29sbGVjdGlvbiBjOwogICAgICAgIHN3aXRj\naCAoZm1kLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIC8vIHRoZSBzdG9y\nZWQgdmFsdWUgbXVzdCBiZSBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgICAg\nIGMgPSAoQ29sbGVjdGlvbikgdmFsOwoKICAgICAgICAgICAgICAgIC8vIHRo\nZSBzdGF0ZSBtYW5hZ2VyIHdpbGwgY3JlYXRlIGEgcHJveHkgY29sbGVjdGlv\nbiBvZiB0aGUKICAgICAgICAgICAgICAgIC8vIG5lZWRlZCB0eXBlIGRlcGVu\nZGluZyBvbiB0aGUgZGVjbGFyZWQgdHlwZSBvZiB0aGUgdXNlcidzCiAgICAg\nICAgICAgICAgICAvLyBmaWVsZDsgdGhlIHByb3h5IHdpbGwgcGVyZm9ybSBk\naXJ0eSB0cmFja2luZywgZXRjCiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdldElu\nZGV4KCkpOwoKICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBwcm94\neSBjb2xsZWN0aW9uIHdpdGggb3VyIHN0b3JlZCBkYXRhLAogICAgICAgICAg\nICAgICAgLy8gY29udmVydGluZyBpdCB0byB0aGUgcmlnaHQgdHlwZSBmcm9t\nIGl0cyBzdG9yZWQgZm9ybQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAg\nICAgICAgICAgICAgIGMyLmFkZCh0b05lc3RlZExvYWRhYmxlKHNtLCBmbWQu\nZ2V0RWxlbWVudCgpLCBpdHIubmV4dCgpLAogICAgICAgICAgICAgICAgICAg\nICAgICBmZXRjaCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGMyOwoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAg\nICAvLyB0aGUgc3RvcmVkIHZhbHVlIG11c3QgYmUgYSBjb2xsZWN0aW9uOyB3\nZSBwdXQgYXJyYXlzIGludG8KICAgICAgICAgICAgICAgIC8vIGNvbGxlY3Rp\nb25zIGZvciBzdG9yYWdlCiAgICAgICAgICAgICAgICBjID0gKENvbGxlY3Rp\nb24pIHZhbDsKCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBuZXcgYXJy\nYXkgb2YgdGhlIHJpZ2h0IHR5cGU7IHVubGlrZSBjb2xsZWN0aW9ucyBpbgog\nICAgICAgICAgICAgICAgLy8gdGhlIGNhc2UgYWJvdmUsIGFycmF5cyBjYW5u\nb3QgYmUgcHJveGllZAogICAgICAgICAgICAgICAgT2JqZWN0IGEgPSBBcnJh\neS5uZXdJbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgpLmdldFR5cGUoKSwKICAg\nICAgICAgICAgICAgICAgICBjLnNpemUoKSk7CgogICAgICAgICAgICAgICAg\nLy8gcG9wdWxhdGUgdGhlIGFycmF5IHdpdGggb3VyIHN0b3JlZCBkYXRhLCBj\nb252ZXJ0aW5nIGl0IHRvIHRoZQogICAgICAgICAgICAgICAgLy8gcmlnaHQg\ndHlwZSBmcm9tIGl0cyBzdG9yZWQgZm9ybQogICAgICAgICAgICAgICAgaW50\nIGlkeCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAg\nICAgICAgICAgICAgQXJyYXkuc2V0KGEsIGlkeCwgdG9OZXN0ZWRMb2FkYWJs\nZShzbSwgZm1kLmdldEVsZW1lbnQoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgaXRyLm5leHQoKSwgZmV0Y2gpKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBhOwoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAg\nICAgICAgICAgLy8gdGhlIHN0b3JlZCB2YWx1ZSBtdXN0IGJlIGEgbWFwCiAg\nICAgICAgICAgICAgICBNYXAgbSA9IChNYXApIHZhbDsKCiAgICAgICAgICAg\nICAgICAvLyB0aGUgc3RhdGUgbWFuYWdlciB3aWxsIGNyZWF0ZSBhIHByb3h5\nIG1hcCBvZiB0aGUgbmVlZGVkCiAgICAgICAgICAgICAgICAvLyB0eXBlIGRl\ncGVuZGluZyBvbiB0aGUgZGVjbGFyZWQgdHlwZSBvZiB0aGUgdXNlcidzIGZp\nZWxkOyB0aGUKICAgICAgICAgICAgICAgIC8vIHByb3h5IHdpbGwgcGVyZm9y\nbSBkaXJ0eSB0cmFja2luZywgZXRjCiAgICAgICAgICAgICAgICBNYXAgbTIg\nPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJbmRleCgpKTsKCiAg\nICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSB0aGUgcHJveHkgbWFwIHdpdGgg\nb3VyIHN0b3JlZCBkYXRhLCBjb252ZXJ0aW5nCiAgICAgICAgICAgICAgICAv\nLyBpdCB0byB0aGUgcmlnaHQgdHlwZSBmcm9tIGl0cyBzdG9yZWQgZm9ybQog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtLmVudHJ5U2V0\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgICAgICBNYXAuRW50cnkgZSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICAgICAgbTIucHV0KHRvTmVzdGVkTG9hZGFibGUo\nc20sIGZtZC5nZXRLZXkoKSwgZS5nZXRLZXkoKSxmZXRjaCksCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRvTmVzdGVkTG9hZGFibGUoc20sIGZtZC5nZXRF\nbGVtZW50KCksIGUuZ2V0VmFsdWUoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZldGNoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXR1cm4gbTI7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgLy8ganVzdCBjb252ZXJ0IHRoZSBzdG9yZWQgdmFsdWUgaW50\nbyBpdHMgbG9hZGFibGUgZXF1aXZhbGVudC4KICAgICAgICAgICAgICAgIHJl\ndHVybiB0b05lc3RlZExvYWRhYmxlKHNtLCBmbWQsIHZhbCwgZmV0Y2gpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdp\ndmVuIHN0b3JlZCB2YWx1ZSA8Y29kZT52YWw8L2NvZGU+IHRvIGEgdmFsdWUg\nZm9yIGxvYWRpbmcKICAgICAqIGludG8gYSBzdGF0ZSBtYW5hZ2VyLiBUaGUg\ndmFsdWUgPGNvZGU+dmFsPC9jb2RlPiBtdXN0IGJlIGEgc2luZ3VsYXIKICAg\nICAqIHZhbHVlOyBpdCBjYW5ub3QgYmUgYSBjb250YWluZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0b05lc3RlZExvYWRhYmxlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2\nbWQsIE9iamVjdCB2YWwsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewog\nICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIHN3aXRjaCAodm1kLmdldFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgLy8gY2xvbmUgdGhlIGRhdGUgdG8gcHJldmVudCBkaXJlY3Qg\nbW9kaWZpY2F0aW9uIG9mIG91ciBzdG9yZWQgdmFsdWUKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiAo\nKERhdGUpIHZhbCkuY2xvbmUoKTsKCiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlBDOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVE\nOgogICAgICAgICAgICAgICAgLy8gZm9yIHJlbGF0aW9ucyB0byBvdGhlciBw\nZXJzaXN0ZW50IG9iamVjdHMsIHdlIHN0b3JlIHRoZQogICAgICAgICAgICAg\nICAgLy8gcmVsYXRlZCBvYmplY3QncyBvaWQgLS0gY29udmVydCBpdCBiYWNr\nIGludG8gYSBwZXJzaXN0ZW50CiAgICAgICAgICAgICAgICAvLyBpbnN0YW5j\nZQogICAgICAgICAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHNtLmdldENv\nbnRleHQoKTsKICAgICAgICAgICAgICAgIE9iamVjdCBwYyA9IGN0eC5maW5k\nKHZhbCwgZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgICAgICAgICAgICAg\naWYgKHBjICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBj\nOwogICAgICAgICAgICAgICAgT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9uID0g\nY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRPcnBoYW5lZEtleUFjdGlvbkluc3RhbmNlKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gYWN0aW9uLm9ycGhhbih2YWwsIHNtLCB2bWQpOwogICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSB0aGUgZGF0YSBh\nbmQgdmVyc2lvbiBpbmZvcm1hdGlvbiBmb3IgdGhpcyBvYmplY3QgZnJvbSB0\naGUKICAgICAqIGdpdmVuIHN0YXRlIG1hbmFnZXIuIE9ubHkgZGlydHkgZmll\nbGRzIHdpbGwgYmUgc3RvcmVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgX3ZlcnNp\nb24gPSAoTG9uZykgc20uZ2V0VmVyc2lvbigpOwoKICAgICAgICAvLyBpZiB0\naGUgdmVyc2lvbiBoYXMgbm90IGJlZW4gc2V0IGluIHRoZSBzdGF0ZSBtYW5h\nZ2VyIChvbmx5IHRydWUKICAgICAgICAvLyB3aGVuIHRoZSBvYmplY3QgaXMg\nbmV3KSwgc2V0IHRoZSB2ZXJzaW9uIG51bWJlciB0byAwCiAgICAgICAgaWYg\nKF92ZXJzaW9uID09IG51bGwpCiAgICAgICAgICAgIF92ZXJzaW9uID0gMEw7\nCgogICAgICAgIC8vIHJ1biB0aHJvdWdoIGVhY2ggcGVyc2lzdGVudCBmaWVs\nZCBpbiB0aGUgc3RhdGUgbWFuYWdlciBhbmQgc3RvcmUgaXQKICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAoc20uZ2V0RGlydHkoKS5nZXQoaSkKICAgICAgICAg\nICAgICAgICYmIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpID09IGZtZHNbaV0u\nTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBfZGF0YVtpXSA9\nIHRvU3RvcmFibGUoZm1kc1tpXSwgc20uZmV0Y2goaSksIHNtLmdldENvbnRl\neHQoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29udmVy\ndCB0aGUgZ2l2ZW4gZmllbGQgdmFsdWUgPGNvZGU+dmFsPC9jb2RlPiB0byBh\nIGZvcm0gd2UgY2FuIHN0b3JlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBPYmplY3QgdG9TdG9yYWJsZShGaWVsZE1ldGFEYXRhIGZtZCwgT2JqZWN0\nIHZhbCwKICAgICAgICBTdG9yZUNvbnRleHQgY3R4KSB7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgQ29sbGVjdGlvbiBjOwogICAgICAgIHN3aXRjaCAoZm1kLmdldFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIGMgPSAoQ29sbGVjdGlvbikgdmFsOwoKICAg\nICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIGNvbGxlY3Rpb24gdG8gY29weSB0\naGUgZWxlbWVudHMgaW50byBmb3Igc3RvcmFnZSwKICAgICAgICAgICAgICAg\nIC8vIGFuZCBwb3B1bGF0ZSBpdCB3aXRoIGNvbnZlcnRlZCBlbGVtZW50IHZh\nbHVlcwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBjMiA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nYy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nICAgICBjMi5hZGQodG9OZXN0ZWRTdG9yYWJsZShmbWQuZ2V0RWxlbWVudCgp\nLCBpdHIubmV4dCgpLCBjdHgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBj\nMjsKCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAg\nICAgICAgICAgLy8gY3JlYXRlIGEgY29sbGVjdGlvbiB0byBjb3B5IHRoZSBl\nbGVtZW50cyBpbnRvIGZvciBzdG9yYWdlLAogICAgICAgICAgICAgICAgLy8g\nYW5kIHBvcHVsYXRlIGl0IHdpdGggY29udmVydGVkIGVsZW1lbnQgdmFsdWVz\nCiAgICAgICAgICAgICAgICBjID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IEFycmF5LmdldExlbmd0\naCh2YWwpOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgICAgICAgICAgYy5h\nZGQodG9OZXN0ZWRTdG9yYWJsZShmbWQuZ2V0RWxlbWVudCgpLCBBcnJheS5n\nZXQodmFsLCBpKSwKICAgICAgICAgICAgICAgICAgICAgICAgY3R4KSk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gYzsKCiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIE1hcCBtID0gKE1hcCkgdmFs\nOwoKICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG1hcCB0byBjb3B5IHRo\nZSBlbnRyaWVzIGludG8gZm9yIHN0b3JhZ2UsIGFuZAogICAgICAgICAgICAg\nICAgLy8gcG9wdWxhdGUgaXQgd2l0aCBjb252ZXJ0ZWQgZW50cnkgdmFsdWVz\nCiAgICAgICAgICAgICAgICBNYXAgbTIgPSBuZXcgSGFzaE1hcCgpOwogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nICAgICBNYXAuRW50cnkgZSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgbTIucHV0KHRvTmVzdGVkU3RvcmFibGUoZm1k\nLmdldEtleSgpLCBlLmdldEtleSgpLCBjdHgpLAogICAgICAgICAgICAgICAg\nICAgICAgICB0b05lc3RlZFN0b3JhYmxlKGZtZC5nZXRFbGVtZW50KCksIGUu\nZ2V0VmFsdWUoKSwgY3R4KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICByZXR1cm4gbTI7CgogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgLy8ganVzdCBjb252ZXJ0IHRoZSBsb2FkZWQgdmFsdWUg\naW50byBpdHMgc3RvcmFibGUgZXF1aXZhbGVudAogICAgICAgICAgICAgICAg\ncmV0dXJuIHRvTmVzdGVkU3RvcmFibGUoZm1kLCB2YWwsIGN0eCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgZ2l2ZW4g\nbG9hZGVkIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4gdG8gYSB2YWx1ZSBmb3Ig\nc3RvcmluZy4KICAgICAqIFRoZSB2YWx1ZSA8Y29kZT52YWw8L2NvZGU+IG11\nc3QgYmUgYSBzaW5ndWxhciB2YWx1ZTsgaXQgY2Fubm90IGJlIGEKICAgICAq\nIGNvbnRhaW5lci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0\nIHRvTmVzdGVkU3RvcmFibGUoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCB2\nYWwsCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIHN3aXRjaCAodm1kLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBk\nYXRlIGlzIGEgcHJveHkgKHNpbmNlIERhdGVzIGFyZSBzZWNvbmQgY2xhc3MK\nICAgICAgICAgICAgICAgIC8vIG9iamVjdHMgKFNDT3MpIHRoZXkgY2FuIGJl\nIHByb3hpZWQgZm9yIGRpcnR5IHRyYWNraW5nLAogICAgICAgICAgICAgICAg\nLy8gZXRjKSB0aGVuIGNvcHkgdGhlIHZhbHVlIG91dCBvZiBpdCBmb3Igc3Rv\ncmFnZQogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFByb3h5\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKFByb3h5KSB2YWwpLmNv\ncHkodmFsKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIHZhbCku\nY2xvbmUoKTsKCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGN0eC5nZXRPYmplY3RJZCh2YWwpOwoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk1BUDoKICAgICAgICAgICAgICAgIC8vIG5lc3RlZCByZWxhdGlvbiB0eXBl\ncyAoZS5nLiBjb2xsZWN0aW9ucyBvZiBjb2xsZWN0aW9ucykKICAgICAgICAg\nICAgICAgIC8vIGFyZSBub3QgY3VycmVudGx5IHN1cHBvcnRlZAogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCJUaGlz\nIHN0b3JlIGRvZXMgbm90IHN1cHBvcnQgIgogICAgICAgICAgICAgICAgICAg\nICsgIm5lc3RlZCBjb250YWluZXJzIChlLmcuIGNvbGxlY3Rpb25zIG9mIGNv\nbGxlY3Rpb25zKS4iKTsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENsb25lIHRoaXMgZGF0YS4KICAgICAqLwogICAgcHVibGljIE9i\namVjdCBjbG9uZSgpIHsKICAgICAgICBPYmplY3REYXRhIGRhdGEgPSBuZXcg\nT2JqZWN0RGF0YShfb2lkLCBfbWV0YSk7CiAgICAgICAgZGF0YS5zZXRWZXJz\naW9uKF92ZXJzaW9uKTsKCiAgICAgICAgLy8gY29weSBlYWNoIGZpZWxkCiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IF9kYXRhW2ldOwogICAg\nICAgICAgICBpZiAodmFsID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGRh\ndGEuc2V0RmllbGQoaSwgbnVsbCk7CiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ld\nLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgICAgICBkYXRhLnNldEZpZWxkKGks\nIG5ldyBBcnJheUxpc3QoKENvbGxlY3Rpb24pIHZhbCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGRhdGEuc2V0RmllbGQoaSwg\nbmV3IEhhc2hNYXAoKE1hcCkgdmFsKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIGRhdGEuc2V0RmllbGQoaSwgdmFsKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZGF0YTsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIFN0cmluZ0J1aWxkZXIg\nYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBidWYuYXBwZW5k\nKCJDbGFzczogKCIgKyBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFt\nZSgpICsgIilcbiIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIk9iamVjdCBJZDog\nKCIgKyBfb2lkICsgIilcbiIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlZlcnNp\nb246ICgiICsgX3ZlcnNpb24gKyAiKVxuIik7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiICBGaWVsZDogKCIgKyBpICsgIilcbiIpOwogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgIE5hbWU6ICgiICsgZm1kc1tpXS5nZXRO\nYW1lKCkgKyAiKVxuIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAgVmFs\ndWU6ICgiICsgX2RhdGFbaV0gKyAiKVxuIik7CgkJfQoJCXJldHVybiBidWYu\ndG9TdHJpbmcgKCk7Cgl9Cn0K\n","encoding":"base64"}

