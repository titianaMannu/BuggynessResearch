{"sha":"1ae57aee0dcba2f69f51a1fc49e90256bc439628","node_id":"MDQ6QmxvYjIwNjM2NDoxYWU1N2FlZTBkY2JhMmY2OWY1MWExZmM0OWU5MDI1NmJjNDM5NjI4","size":14407,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1ae57aee0dcba2f69f51a1fc49e90256bc439628","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlJvd0ltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5SZXBvcnRpbmdTUUxFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4\nY2VwdGlvbjsKCi8qKgogKiBCYXRjaCBwcmVwYXJlZCBzdGF0ZW1lbnQgbWFu\nYWdlciBpbXBsZW1lbnRhdGlvbi4gVGhpcyBwcmVwYXJlZCBzdGF0ZW1lbnQK\nICogbWFuYWdlciB3aWxsIHV0aWxpemUgdGhlIEpEQkMgYWRkQmF0Y2goKSBh\nbmQgZXhjZXV0ZUJhdGNoKCkgdG8gYmF0Y2ggdGhlIFNRTAogKiBzdGF0ZW1l\nbnRzIHRvZ2V0aGVyIHRvIGltcHJvdmUgdGhlIGV4ZWN1dGlvbiBwZXJmb3Jt\nYW5jZS4KICogCiAqIEBhdXRob3IgVGVyZXNhIEthbgogKi8KCnB1YmxpYyBj\nbGFzcyBCYXRjaGluZ1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlckltcGwgZXh0\nZW5kcwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50TWFuYWdlckltcGwgewoK\nICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyCiAgICAgICAgICAgIC5mb3JQYWNrYWdlKEJhdGNoaW5nUHJlcGFy\nZWRTdGF0ZW1lbnRNYW5hZ2VySW1wbC5jbGFzcyk7CgogICAgcHJpdmF0ZSBT\ndHJpbmcgX2JhdGNoZWRTcWwgPSBudWxsOwogICAgcHJpdmF0ZSBMaXN0IF9i\nYXRjaGVkUm93cyA9IG5ldyBBcnJheUxpc3QoKTsKICAgIHByaXZhdGUgaW50\nIF9iYXRjaExpbWl0OwogICAgcHJpdmF0ZSBib29sZWFuIF9kaXNhYmxlQmF0\nY2ggPSBmYWxzZTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBw\nbHkgY29ubmVjdGlvbi4KICAgICAqLwogICAgcHVibGljIEJhdGNoaW5nUHJl\ncGFyZWRTdGF0ZW1lbnRNYW5hZ2VySW1wbChKREJDU3RvcmUgc3RvcmUsCiAg\nICAgICAgQ29ubmVjdGlvbiBjb25uLCBpbnQgYmF0Y2hMaW1pdCkgewogICAg\nICAgIHN1cGVyKHN0b3JlLCBjb25uKTsKICAgICAgICBfYmF0Y2hMaW1pdCA9\nIGJhdGNoTGltaXQ7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiYmF0Y2hfbGlt\naXQiLCBTdHJpbmcudmFsdWVPZihfYmF0Y2hMaW1pdCkpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEZsdXNoIHRoZSBnaXZlbiByb3cgaW1tZWRpYXRlbHkg\nb3IgZGVmZXJyZWQgdGhlIGZsdXNoIGluIGJhdGNoLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBmbHVzaEFuZFVwZGF0ZShSb3dJbXBsIHJvdykgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGlzQmF0Y2hEaXNhYmxl\nZChyb3cpKSB7CiAgICAgICAgICAgIC8vIGlmIHRoZXJlIHdlcmUgc29tZSBz\ndGF0ZW1lbnRzIGJhdGNoZWQgYmVmb3JlLCB0aGVuCiAgICAgICAgICAgIC8v\nIHdlIG5lZWQgdG8gZmx1c2ggdGhlbSBvdXQgZmlyc3QgYmVmb3JlIHByb2Nl\nc3NpbmcgdGhlCiAgICAgICAgICAgIC8vIGN1cnJlbnQgbm9uIGJhdGNoIHBy\nb2Nlc3MuCiAgICAgICAgICAgIGZsdXNoQmF0Y2goKTsKCiAgICAgICAgICAg\nIHN1cGVyLmZsdXNoQW5kVXBkYXRlKHJvdyk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgLy8gcHJvY2VzcyB0aGUgU1FMIHN0YXRlbWVudCwgZWl0\naGVyIGV4ZWN1dGUgaXQgaW1tZWRpYXRlbHkgb3IKICAgICAgICAgICAgLy8g\nYmF0Y2ggaXQgZm9yIGxhdGVyIGV4ZWN1dGlvbi4KICAgICAgICAgICAgYmF0\nY2hPckV4ZWN1dGVSb3cocm93KTsKICAgICAgICB9CiAgICB9CgogICAgcHJv\ndGVjdGVkIHZvaWQgYmF0Y2hPckV4ZWN1dGVSb3coUm93SW1wbCByb3cpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBzcWwgPSByb3cu\nZ2V0U1FMKF9kaWN0KTsKICAgICAgICBpZiAoX2JhdGNoZWRTcWwgPT0gbnVs\nbCkgewogICAgICAgICAgICAvLyBicmFuZCBuZXcgU1FMCiAgICAgICAgICAg\nIF9iYXRjaGVkU3FsID0gc3FsOwogICAgICAgIH0gZWxzZSBpZiAoIXNxbC5l\ncXVhbHMoX2JhdGNoZWRTcWwpKSB7CiAgICAgICAgICAgIC8vIFNRTCBzdGF0\nZW1lbnRzIGNoYW5nZWQuCiAgICAgICAgICAgIHN3aXRjaCAoX2JhdGNoZWRS\nb3dzLnNpemUoKSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAg\nICAgLy8gc2luZ2xlIGVudHJ5IGluIGNhY2hlLCBkaXJlY3QgU1FMIGV4ZWN1\ndGlvbi4gCiAgICAgICAgICAgICAgICBzdXBlci5mbHVzaEFuZFVwZGF0ZSgo\nUm93SW1wbCkgX2JhdGNoZWRSb3dzLmdldCgwKSk7CiAgICAgICAgICAgICAg\nICBfYmF0Y2hlZFJvd3MuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gZmx1\nc2ggYWxsIGVudHJpZXMgaW4gY2FjaGUgaW4gYmF0Y2guCiAgICAgICAgICAg\nICAgICBmbHVzaEJhdGNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nX2JhdGNoZWRTcWwgPSBzcWw7CiAgICAgICAgfQogICAgICAgIF9iYXRjaGVk\nUm93cy5hZGQocm93KTsKICAgIH0KCiAgICAvKgogICAgICogQ29tcHV0ZSBp\nZiBiYXRjaGluZyBpcyBkaXNhYmxlZCwgYmFzZWQgb24gdmFsdWVzIG9mIGJh\ndGNoIGxpbWl0CiAgICAgKiBhbmQgZGF0YWJhc2UgY2hhcmFjdGVyaXN0aWNz\nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNCYXRjaERpc2FibGVk\nKFJvd0ltcGwgcm93KSB7CiAgICAgICAgYm9vbGVhbiBydG5WYWwgPSB0cnVl\nOwogICAgICAgIGludCBsaW1pdCA9IGdldEJhdGNoTGltaXQoKTsKICAgICAg\nICBpZiAoKGxpbWl0IDwgMCB8fCBsaW1pdCA+IDEpICYmICFpc0JhdGNoRGlz\nYWJsZWQoKSkgewogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nID0gcm93LmdldFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgQ2xhc3NNYXBw\naW5nIGNtZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgY21kID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICAgICAgQ29sdW1uW10gYXV0b0Fzc2lnbiA9IG51\nbGw7CiAgICAgICAgICAgIGlmIChyb3cuZ2V0QWN0aW9uKCkgPT0gUm93LkFD\nVElPTl9JTlNFUlQpCiAgICAgICAgICAgICAgICBhdXRvQXNzaWduID0gcm93\nLmdldFRhYmxlKCkuZ2V0QXV0b0Fzc2lnbmVkQ29sdW1ucygpOwogICAgICAg\nICAgICAvLyB2YWxpZGF0ZSBiYXRjaCBjYXBhYmlsaXR5CiAgICAgICAgICAg\nIHJ0blZhbCA9IF9kaWN0CiAgICAgICAgICAgICAgICAudmFsaWRhdGVCYXRj\naFByb2Nlc3Mocm93LCBhdXRvQXNzaWduLCBzbSwgY21kKTsKICAgICAgICAg\nICAgc2V0QmF0Y2hEaXNhYmxlZChydG5WYWwpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gcnRuVmFsOwogICAgfQogICAgCiAgICAvKioKICAgICAqIGZs\ndXNoIGFsbCBjYWNoZWQgdXAgc3RhdGVtZW50cyB0byBiZSBleGVjdXRlZCBh\ncyBhIHNpbmdsZSBvciBiYXRjaGVkCiAgICAgKiBwcmVwYXJlZCBzdGF0ZW1l\nbnRzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBmbHVzaEJhdGNoKCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdCBiYXRjaGVkUm93\ncyA9IGdldEJhdGNoZWRSb3dzKCk7CiAgICAgICAgU3RyaW5nIGJhdGNoZWRT\ncWwgPSBnZXRCYXRjaGVkU3FsKCk7CiAgICAgICAgaWYgKGJhdGNoZWRSb3dz\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaW50IGJh\ndGNoU2l6ZSA9IGJhdGNoZWRSb3dzLnNpemUoKTsKICAgICAgICBpZiAoYmF0\nY2hlZFNxbCAhPSBudWxsICYmICBiYXRjaFNpemUgPiAwKSB7CiAgICAgICAg\nICAgIFByZXBhcmVkU3RhdGVtZW50IHBzID0gbnVsbDsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIFJvd0ltcGwgb25lcm93ID0gbnVsbDsK\nICAgICAgICAgICAgICAgIHBzID0gcHJlcGFyZVN0YXRlbWVudChiYXRjaGVk\nU3FsKTsKICAgICAgICAgICAgICAgIGlmIChiYXRjaFNpemUgPT0gMSkgewog\nICAgICAgICAgICAgICAgICAgIC8vIGV4ZWN1dGUgYSBzaW5nbGUgcm93Lgog\nICAgICAgICAgICAgICAgICAgIG9uZXJvdyA9IChSb3dJbXBsKSBiYXRjaGVk\nUm93cy5nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgZmx1c2hTaW5nbGVS\nb3cob25lcm93LCBwcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIC8vIGNhY2hlIGhhcyBtb3JlIHRoYW4gb25lIHJv\nd3MsIGV4ZWN1dGUgYXMgYmF0Y2guCiAgICAgICAgICAgICAgICAgICAgaW50\nIGNvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICBpbnQgYmF0Y2hlZFJv\nd3NCYXNlSW5kZXggPSAwOwogICAgICAgICAgICAgICAgICAgIEl0ZXJhdG9y\nIGl0ciA9IGJhdGNoZWRSb3dzLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAg\nICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgb25lcm93ID0gKFJvd0ltcGwpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChfYmF0Y2hMaW1pdCA9PSAxKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaFNpbmdsZVJvdyhvbmVy\nb3csIHBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA8IF9iYXRjaExp\nbWl0IHx8IF9iYXRjaExpbWl0ID09IC0xKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHBzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG9uZXJvdy5mbHVzaChwcywgX2RpY3Qs\nIF9zdG9yZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRk\nQmF0Y2gocHMsIG9uZXJvdywgY291bnQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIHJlYWNoIHRoZSBiYXRjaExpbWl0LCBleGVjdXRlIHRoZSBiYXRjaAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludFtdIHJ0biA9IGV4\nZWN1dGVCYXRjaChwcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2hlY2tVcGRhdGVDb3VudChydG4sIGJhdGNoZWRSb3dzQmFzZUluZGV4\nLCBwcyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNo\nZWRSb3dzQmFzZUluZGV4ICs9IF9iYXRjaExpbWl0OwoKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAocHMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lcm93LmZsdXNoKHBzLCBf\nZGljdCwgX3N0b3JlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBhZGRCYXRjaChwcywgb25lcm93LCBjb3VudCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgdGhlIGNvdW50IHRvIDEgZm9y\nIG5ldyBiYXRjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv\ndW50ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAvLyBlbmQgb2YgdGhlIGxvb3AsIGV4ZWN1dGUg\ndGhlIGJhdGNoCiAgICAgICAgICAgICAgICAgICAgaW50W10gcnRuID0gZXhl\nY3V0ZUJhdGNoKHBzKTsKICAgICAgICAgICAgICAgICAgICBjaGVja1VwZGF0\nZUNvdW50KHJ0biwgYmF0Y2hlZFJvd3NCYXNlSW5kZXgsIHBzKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAvL0lmIHdlIGxvb2sgYXQgUHJlcGFy\nZWRTdGF0ZW1lbnRNYW5hZ2VySW1wbC5mbHVzaEFuZFVwZGF0ZSAod2hpY2gg\naXMgdGhlICdub24tYmF0Y2gnIGNvZGUgcGF0aAogICAgICAgICAgICAgICAg\nLy9zaW1pbGFyIHRvIHRoaXMgcGF0aCwgb3IgSSBzaG91bGQgc2F5LCB0aGUg\ncGF0aCB3aGljaCBpcyB0YWtlbiBpbnN0ZWFkIG9mIHRoaXMgcGF0aCB3aGVu\nCiAgICAgICAgICAgICAgICAvL3dlIGFyZW4ndCB1c2luZyBiYXRjaGluZyks\nIHdlIHNlZSB0aGF0IHRoZSBjYXRjaCBibG9jayBkb2Vzbid0IGRvIGEgJ3Nl\nLmdldE5leHRFeGNlcHRpb24nLgogICAgICAgICAgICAgICAgLy9XaGVuIHdl\nIGRvIGEgJ2dldE5leHRFeGNlcHRpb24nLCB0aGUgJ25leHQgZXhjZXB0aW9u\nJyBkb2Vzbid0IGNvbnRhaW4gdGhlIHNhbWUgbWVzc2FnZSBhcyBzZS4KICAg\nICAgICAgICAgICAgIC8vVGhhdCBpcywgJ25leHQgZXhjZXB0aW9uJyBjb250\nYWlucyBhIHN1YnNldCBtc2cgd2hpY2ggaXMgY29udGFpbmVkIGluIHNlLgog\nICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIHNxZXggPSBzZS5nZXROZXh0\nRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoc3FleCA9PSBudWxs\nKXsKICAgICAgICAgICAgICAgICAgICBzcWV4ID0gc2U7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChz\nZSBpbnN0YW5jZW9mIFJlcG9ydGluZ1NRTEV4Y2VwdGlvbil7CiAgICAgICAg\nICAgICAgICAgIGludCBpbmRleCA9ICgoUmVwb3J0aW5nU1FMRXhjZXB0aW9u\nKSBzZSkuZ2V0SW5kZXhPZkZpcnN0RmFpbGVkT2JqZWN0KCk7CgogICAgICAg\nICAgICAgICAgICAvL2lmIHdlIGhhdmUgb25seSBiYXRjaGVkIG9uZSBzdGF0\nZW1lbnQsIHRoZSBpbmRleCBzaG91bGQgYmUgMC4gIEFzIGNhbiBiZSBzZWVu\nIGFib3ZlLAogICAgICAgICAgICAgICAgICAvL2lmICdiYXRjaFNpemUgPT0g\nMScgYSBkaWZmZXJlbnQgcGF0aCBpcyB0YWtlbiAodGhlICdzaW5nbGUgcm93\nJyBwYXRoKSwgYW5kIGlmIHRoYXQgcm93CiAgICAgICAgICAgICAgICAgIC8v\nZmFpbHMsIHdlIGtub3cgdGhhdCB0aGUgaW5kZXggaXMgMCBzaW5jZSB0aGVy\nZSBpcyBvbmx5IG9uZSByb3cuCiAgICAgICAgICAgICAgICAgIGlmIChiYXRj\naFNpemUgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDA7\nCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgCiAgICAg\nICAgICAgICAgICAgIC8vaW5kZXggc2hvdWxkIG5vdCBiZSBsZXNzIHRoYW4g\nMCBpbiB0aGlzIHBhdGgsIGJ1dCBpZiBmb3Igc29tZSByZWFzb24gaXQgaXMs\nIGxldHMKICAgICAgICAgICAgICAgICAgLy9yZXNvcnQgdG8gdGhlICdvbGQg\nd2F5JyBhbmQgc2ltcGx5IHBhc3MgdGhlICdwcycgYXMgdGhlIGZhaWxlZCBv\nYmplY3QuCiAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDApeyAKICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3Rv\ncmUoc2UsIHBzLCBfZGljdCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsICgoUm93SW1wbCkoX2JhdGNo\nZWRSb3dzLmdldChpbmRleCkpKS5nZXRGYWlsZWRPYmplY3QoKSwgX2RpY3Qp\nOwogICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAg\nICAgICAgICAJLy9wZXIgY29tbWVudHMgYWJvdmUsIHVzZSAnc3FleCcgcmF0\naGVyIHRoYW4gJ3NlJy4gCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzcWV4LCBwcywgX2RpY3QpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgX2JhdGNoZWRTcWwgPSBudWxsOwogICAgICAgICAgICAgICAgYmF0\nY2hlZFJvd3MuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGlmIChwcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcHMuY2xlYXJQYXJhbWV0ZXJz\nKCk7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgcHMuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc3FleCkgewogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNxZXgsIHBzLCBf\nZGljdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAg\nKiBFeGVjdXRlIGFuIHVwZGF0ZSBvZiBhIHNpbmdsZSByb3cuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBmbHVzaFNpbmdsZVJvdyhSb3dJbXBsIHJvdywg\nUHJlcGFyZWRTdGF0ZW1lbnQgcHMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHBzICE9IG51bGwpCiAgICAgICAgICAgIHJv\ndy5mbHVzaChwcywgX2RpY3QsIF9zdG9yZSk7CiAgICAgICAgaW50IGNvdW50\nID0gZXhlY3V0ZVVwZGF0ZShwcywgcm93LmdldFNRTChfZGljdCksIHJvdyk7\nCiAgICAgICAgaWYgKGNvdW50ICE9IDEpIHsKICAgICAgICAgICAgbG9nU1FM\nV2FybmluZ3MocHMpOwogICAgICAgICAgICBPYmplY3QgZmFpbGVkID0gcm93\nLmdldEZhaWxlZE9iamVjdCgpOwogICAgICAgICAgICBpZiAoZmFpbGVkICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZXhjZXB0aW9ucy5hZGQobmV3IE9w\ndGltaXN0aWNFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cuQUNUSU9OX0lOU0VSVCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24oX2xvYy5nZXQo\nInVwZGF0ZS1mYWlsZWQtbm8tZmFpbGVkLW9iaiIsCiAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nLnZhbHVlT2YoY291bnQpLCByb3cuZ2V0U1FMKF9kaWN0\nKSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAg\nICAqIFByb2Nlc3MgZXhlY3V0ZUJhdGNoIGZ1bmN0aW9uIGFycmF5IG9mIHJl\ndHVybiBjb3VudHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjaGVja1Vw\nZGF0ZUNvdW50KGludFtdIGNvdW50LCBpbnQgYmF0Y2hlZFJvd3NCYXNlSW5k\nZXgsCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgcHMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gdmFsdWUgaW4gaW50W10g\nY291bnQgIHJldHVybmVkIGZyb20gZXhlY3V0ZUJhdGNoOiAKICAgICAgICAv\nLyAgICAgICAgICAgICAgIFVwZGF0ZSAgICAgICAgICBEZWxldGUgICAgICAg\nIEluc2VydAogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAg\nIC8vICAgICAgICAgICAgICAgT0sgLyBFcnJvciAgICAgIE9LIC8gRXJyb3Ig\nICAgT0sgLyBFcnJvcgogICAgICAgIC8vIERCMkxVVyAgICAgICAgIDEgLyAw\nICAgICAgICAgICAxIC8gMCAgICAgICAgIDEgLyBTUUxFeGNlcHRpb24KICAg\nICAgICAvLyBEQjIvWk9TICAgICAgICAxIC8gMCAgICAgICAgICAgMSAvIDAg\nICAgICAgIC0yIC8gU1FMRXhjZXB0aW9uCiAgICAgICAgLy8gT3JhY2xlICAg\nICAgICAtMiAvIC0yICAgICAgICAgLTIgLyAtMiAgICAgICAtMiAvIFNRTEV4\nY2VwdGlvbgogICAgICAgIGludCBjbnQgPSAwOwogICAgICAgIGludCB1cGRh\ndGVTdWNjZXNzQ250ID0gX2RpY3QuZ2V0QmF0Y2hVcGRhdGVDb3VudChwcyk7\nCiAgICAgICAgT2JqZWN0IGZhaWxlZCA9IG51bGw7CiAgICAgICAgTGlzdCBi\nYXRjaGVkUm93cyA9IGdldEJhdGNoZWRSb3dzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjb3VudC5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjbnQgPSBjb3VudFtpXTsKICAgICAgICAgICAgUm93SW1wbCByb3cgPSAo\nUm93SW1wbCkgYmF0Y2hlZFJvd3MuZ2V0KGJhdGNoZWRSb3dzQmFzZUluZGV4\nICsgaSk7CiAgICAgICAgICAgIGZhaWxlZCA9IHJvdy5nZXRGYWlsZWRPYmpl\nY3QoKTsKICAgICAgICAgICAgc3dpdGNoIChjbnQpIHsKICAgICAgICAgICAg\nY2FzZSBTdGF0ZW1lbnQuRVhFQ1VURV9GQUlMRUQ6IC8vIC0zCiAgICAgICAg\nICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgfHwgcm93LmdldEFjdGlvbigp\nID09IFJvdy5BQ1RJT05fVVBEQVRFKQogICAgICAgICAgICAgICAgICAgIF9l\neGNlcHRpb25zLmFkZChuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQp\nKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJvdy5nZXRBY3Rpb24oKSA9\nPSBSb3cuQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgU1FMRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAg\nICAgICAgICAidXBkYXRlLWZhaWxlZC1uby1mYWlsZWQtb2JqIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY291bnRbaV0pLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgcm93LmdldFNRTChfZGljdCkpLmdl\ndE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBTdGF0ZW1lbnQuU1VDQ0VTU19OT19JTkZPOiAvLyAtMgogICAg\nICAgICAgICAgICAgaWYgKF9kaWN0LnJlcG9ydHNTdWNjZXNzTm9JbmZvT25C\nYXRjaFVwZGF0ZXMgJiYKICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdWNj\nZXNzQ250ICE9IGNvdW50Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAg\nIC8vIE9yYWNsZSBiYXRjaGluZyBzcGVjaWZpY3M6CiAgICAgICAgICAgICAg\nICAgICAgLy8gdHJlYXQgdXBkYXRlL2RlbGV0ZSBvZiBTVUNDRVNTX05PX0lO\nRk8gYXMgZmFpbGVkIGNhc2UKICAgICAgICAgICAgICAgICAgICAvLyBiZWNh\ndXNlOgogICAgICAgICAgICAgICAgICAgIC8vIDEuIHRyYW5zYWN0aW9uIHNo\nb3VsZCBiZSByb2xsZWQgYmFjay4KICAgICAgICAgICAgICAgICAgICAvLyAy\nLiBpZiBEYXRhQ2FjaGUgaXMgZW5hYmxlZCwgb2JqZWN0cyBpbgogICAgICAg\nICAgICAgICAgICAgIC8vICAgIGNhY2hlIHNob3VsZCBiZSByZW1vdmVkLgog\nICAgICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgX2V4Y2VwdGlvbnMuYWRkKG5ldyBPcHRpbWlz\ndGljRXhjZXB0aW9uKGZhaWxlZCkpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UgaWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cuQUNUSU9OX0lOU0VSVCkK\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlv\nbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1cGRh\ndGUtZmFpbGVkLW5vLWZhaWxlZC1vYmoiLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY291bnRbaV0pLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJvdy5nZXRTUUwoX2RpY3QpKS5nZXRNZXNz\nYWdlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJiYXRjaF91cGRhdGVfaW5mbyIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKGNudCksIAogICAg\nICAgICAgICAgICAgICAgICAgICByb3cuZ2V0U1FMKF9kaWN0KSkuZ2V0TWVz\nc2FnZSgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIDA6IC8vIG5vIHJvdyBpcyBpbnNlcnRlZCwgdHJlYXRzIGl0IGFzIGZh\naWxlZAogICAgICAgICAgICAgICAgLy8gY2FzZQogICAgICAgICAgICAgICAg\nbG9nU1FMV2FybmluZ3MocHMpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxl\nZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9leGNlcHRpb25zLmFk\nZChuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQpKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cuQUNUSU9O\nX0lOU0VSVCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhj\nZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICAidXBk\nYXRlLWZhaWxlZC1uby1mYWlsZWQtb2JqIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nLnZhbHVlT2YoY291bnRbaV0pLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgcm93LmdldFNRTChfZGljdCkpLmdldE1lc3NhZ2UoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNCYXRjaERpc2FibGVkKCkgewogICAgICAgIHJldHVybiBfZGlz\nYWJsZUJhdGNoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEJhdGNoRGlz\nYWJsZWQoYm9vbGVhbiBkaXNhYmxlQmF0Y2gpIHsKICAgICAgICBfZGlzYWJs\nZUJhdGNoID0gZGlzYWJsZUJhdGNoOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0QmF0Y2hMaW1pdCgpIHsKICAgICAgICByZXR1cm4gX2JhdGNoTGltaXQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QmF0Y2hMaW1pdChpbnQgYmF0\nY2hMaW1pdCkgewogICAgICAgIF9iYXRjaExpbWl0ID0gYmF0Y2hMaW1pdDsK\nICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRCYXRjaGVkUm93cygpIHsKICAg\nICAgICByZXR1cm4gX2JhdGNoZWRSb3dzOwogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0QmF0Y2hlZFNxbCgpIHsKICAgICAgICByZXR1cm4gX2JhdGNo\nZWRTcWw7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkQmF0Y2goUHJl\ncGFyZWRTdGF0ZW1lbnQgcHMsIFJvd0ltcGwgcm93LCAKICAgICAgICAgICAg\naW50IGNvdW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBwcy5h\nZGRCYXRjaCgpOwogICAgfQoKICAgIHByb3RlY3RlZCBpbnRbXSBleGVjdXRl\nQmF0Y2goUHJlcGFyZWRTdGF0ZW1lbnQgcHMpIAogICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHBzLmV4ZWN1dGVCYXRjaCgpOwog\nICAgfQp9Cg==\n","encoding":"base64"}

