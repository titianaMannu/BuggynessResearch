{"sha":"6dff913423796ee0f75704e0e15efdfe658a91ae","node_id":"MDQ6QmxvYjIwNjM2NDo2ZGZmOTEzNDIzNzk2ZWUwZjc1NzA0ZTBlMTVlZmRmZTY1OGE5MWFl","size":67770,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6dff913423796ee0f75704e0e15efdfe658a91ae","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0\naWwuU2V0OwoKaW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5RdWVyeUNhY2hlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5RdWVyeUNhY2hlU3Rv\ncmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBl\ncnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\ndmVudC5PcnBoYW5lZEtleUFjdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1\nZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5TdXBlcmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFTb3VyY2VG\nYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRC\nRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuU1FMRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLkJyb2tlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuRmluZGVyQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLkxvY2tNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uUGFyc2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRp\nbmdDb25uZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5q\nZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nU3RhdGVtZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nRmFjdG9yeUltcGwuTG9n\nSW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdl\nZFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVyYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRl\nZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0\naW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBTdG9yZU1hbmFnZXIgcGx1Z2luIHRoYXQgdXNlcyBKREJD\nIHRvIHN0b3JlIHBlcnNpc3RlbnQgZGF0YSBpbiBhCiAqIHJlbGF0aW9uYWwg\nZGF0YSBzdG9yZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2\nYWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZU1hbmFnZXIgCiAgICBp\nbXBsZW1lbnRzIFN0b3JlTWFuYWdlciwgSkRCQ1N0b3JlIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKEpEQkNTdG9yZU1hbmFnZXIuY2xhc3MpOwoK\nICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9jdHggPSBudWxsOwogICAgcHJp\ndmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CiAgICBwcml2\nYXRlIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CiAgICBwcml2YXRlIFNR\nTEZhY3RvcnkgX3NxbCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkNMb2NrTWFu\nYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhU291cmNlIF9kcyA9\nIG51bGw7CiAgICBwcml2YXRlIFJlZkNvdW50Q29ubmVjdGlvbiBfY29ubiA9\nIG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2FjdGl2ZSA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CgogICAgLy8gdHJhY2sgdGhl\nIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRoZW0KICAg\nIHByaXZhdGUgU2V0PFN0YXRlbWVudD4gX3N0bW50cyA9IENvbGxlY3Rpb25z\nLnN5bmNocm9uaXplZFNldChuZXcgSGFzaFNldDxTdGF0ZW1lbnQ+KCkpOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPENsaWVudENv\nbm5lY3Rpb24+IGNsaWVudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ29uc3RydWN0b3I8UmVmQ291bnRDb25uZWN0aW9uPiBy\nZWZDb3VudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgQ29uc3RydWN0b3I8Q2FuY2VsU3RhdGVtZW50PiBjYW5jZWxTdGF0ZW1l\nbnRJbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8\nQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQ+IGNhbmNlbFByZXBhcmVkU3RhdGVt\nZW50SW1wbDsKCiAgICBzdGF0aWMgewogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGNsaWVudENvbm5lY3Rpb25JbXBsID0gQ29uY3JldGVDbGFzc0dlbmVy\nYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENsaWVudENvbm5lY3Rpb24u\nY2xhc3MsIAogICAgICAgICAgICAgICAgQ29ubmVjdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIHJlZkNvdW50Q29ubmVjdGlvbkltcGwgPSBDb25jcmV0ZUNs\nYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoUmVmQ291bnRD\nb25uZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFu\nYWdlci5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGNh\nbmNlbFN0YXRlbWVudEltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdl\ndENvbmNyZXRlQ29uc3RydWN0b3IoQ2FuY2VsU3RhdGVtZW50LmNsYXNzLAog\nICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci5jbGFzcywgU3RhdGVt\nZW50LmNsYXNzLCBDb25uZWN0aW9uLmNsYXNzKTsKICAgICAgICAgICAgY2Fu\nY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsID0gQ29uY3JldGVDbGFzc0dlbmVy\nYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENhbmNlbFByZXBhcmVkU3Rh\ndGVtZW50LmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdl\nci5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIENvbm5lY3Rpb24u\nY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVyRXJyb3Io\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQg\nZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2N0eDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsK\nICAgICAgICBzZXRDb250ZXh0KGN0eCwgKEpEQkNDb25maWd1cmF0aW9uKSBj\ndHguZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4LCBKREJDQ29uZmln\ndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAgICAgICBf\nY29uZiA9IGNvbmY7CiAgICAgICAgX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rp\nb25hcnlJbnN0YW5jZSgpOwogICAgICAgIF9zcWwgPSBfY29uZi5nZXRTUUxG\nYWN0b3J5SW5zdGFuY2UoKTsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9n\nKEpEQkNDb25maWd1cmF0aW9uLkxPR19ESUFHKTsKCiAgICAgICAgTG9ja01h\nbmFnZXIgbG0gPSBjdHguZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICBpZiAo\nbG0gaW5zdGFuY2VvZiBKREJDTG9ja01hbmFnZXIpCiAgICAgICAgICAgIF9s\nbSA9IChKREJDTG9ja01hbmFnZXIpIGxtOwoKICAgICAgICBfZHMgPSBnZXRE\nYXRhU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRVcGRhdGVN\nYW5hZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAgICAgIGN0\neC5zZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgIH0KICAgICAgICAK\nICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiB1c2VDb25uZWN0aW9uRmFjdG9y\neTIoU3RvcmVDb250ZXh0IGN0eCkgeyAKICAgICAgICByZXR1cm4gKCFjdHgu\naXNNYW5hZ2VkKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVN\nYW5hZ2VkKCkpOyAgCiAgICB9CiAgICAgICAgCiAgICBwcml2YXRlIGZpbmFs\nIERhdGFTb3VyY2UgZ2V0RGF0YVNvdXJjZShTdG9yZUNvbnRleHQgY3R4KSB7\nCiAgICAgICAgRGF0YVNvdXJjZSBkczsKCiAgICAgICAgaWYgKHVzZUNvbm5l\nY3Rpb25GYWN0b3J5MihjdHgpKSB7CiAgICAgICAgICAgIGRzID0gKERhdGFT\nb3VyY2UpIGN0eC5nZXRDb25uZWN0aW9uRmFjdG9yeTIoKTsKICAgICAgICAg\nICAgaWYgKGRzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGRzID0gRGF0\nYVNvdXJjZUZhY3RvcnkuZGVjb3JhdGVEYXRhU291cmNlKGRzLCBfY29uZiwg\nZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgZHMgPSBfY29uZi5nZXREYXRhU291cmNlMihjdHgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZHMg\nPSAoRGF0YVNvdXJjZSkgY3R4LmdldENvbm5lY3Rpb25GYWN0b3J5KCk7CiAg\nICAgICAgICAgIGlmIChkcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBk\ncyA9IERhdGFTb3VyY2VGYWN0b3J5LmRlY29yYXRlRGF0YVNvdXJjZShkcywg\nX2NvbmYsIGZhbHNlKTsgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIGRzID0gX2NvbmYuZ2V0RGF0YVNvdXJj\nZShjdHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBkczsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFuIHVzZUNvbnRl\neHRUb0dldERhdGFTb3VyY2UoU3RvcmVDb250ZXh0IGN0eCkgeyAKICAgICAg\nICAvLyBjb25maWd1cmF0aW9uIGNoZWNrIHRvIGVuYWJsZSBnb2VzIGhlcmUu\nIAogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0JsYW5rKGN0eC5nZXRDb25u\nZWN0aW9uRmFjdG9yeU5hbWUoKSkgCiAgICAgICAgICAgICAgICAmJiBTdHJp\nbmdVdGlscy5pc0JsYW5rKGN0eC5nZXRDb25uZWN0aW9uRmFjdG9yeTJOYW1l\nKCkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIEpEQkNDb25m\naWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJu\nIF9jb25mOwogICAgfQoKICAgIHB1YmxpYyBEQkRpY3Rpb25hcnkgZ2V0REJE\naWN0aW9uYXJ5KCkgewogICAgICAgIHJldHVybiBfZGljdDsKICAgIH0KCiAg\nICBwdWJsaWMgU1FMRmFjdG9yeSBnZXRTUUxGYWN0b3J5KCkgewogICAgICAg\nIHJldHVybiBfc3FsOwogICAgfQoKICAgIHB1YmxpYyBKREJDTG9ja01hbmFn\nZXIgZ2V0TG9ja01hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sbTsKICAg\nIH0KCiAgICBwdWJsaWMgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBnZXRGZXRj\naENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIChKREJDRmV0Y2hD\nb25maWd1cmF0aW9uKSBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2luT3B0aW1pc3RpYygpIHsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja09wdGltaXN0aWMoKSB7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYmVnaW4oKSB7CiAgICAgICAgX2FjdGl2\nZSA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCghX2N0\neC5pc01hbmFnZWQoKSB8fCAhX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1v\nZGVNYW5hZ2VkKCkpCiAgICAgICAgICAgICAgICAmJiBfY29ubi5nZXRBdXRv\nQ29tbWl0KCkpCiAgICAgICAgICAgICAgICBfY29ubi5zZXRBdXRvQ29tbWl0\nKGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB0aHJv\ndyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9j\nb25mLmlzQ29ubmVjdGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQogICAgICAg\nICAgICAgICAgX2Nvbm4uY29tbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBfY29ubi5yb2xsYmFjaygpOwogICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UyKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ndGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB7\nCiAgICAgICAgLy8gYWxyZWFkeSByb2xsZWQgYmFjayBvdXJzZWx2ZXM/CiAg\nICAgICAgaWYgKCFfYWN0aXZlKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfY29ubiAhPSBudWxsCiAgICAg\nICAgICAgICAgICAmJiAoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9jb25mCiAg\nICAgICAgICAgICAgICAgICAgLmlzQ29ubmVjdGlvbkZhY3RvcnlNb2RlTWFu\nYWdlZCgpKSkKICAgICAgICAgICAgICAgIF9jb25uLnJvbGxiYWNrKCk7CiAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJldGFpbkNvbm5l\nY3Rpb24oKSB7CiAgICAgICAgY29ubmVjdChmYWxzZSk7CiAgICAgICAgX2Nv\nbm4uc2V0UmV0YWluKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJl\nbGVhc2VDb25uZWN0aW9uKCkgewogICAgICAgIGlmIChfY29ubiAhPSBudWxs\nKQogICAgICAgICAgICBfY29ubi5zZXRSZXRhaW4oZmFsc2UpOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0Q2xpZW50Q29ubmVjdGlvbigpIHsKICAg\nICAgICByZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5j\nZShjbGllbnRDb25uZWN0aW9uSW1wbCwgZ2V0Q29ubmVjdGlvbigpKTsKICAg\nIH0KCiAgICBwdWJsaWMgQ29ubmVjdGlvbiBnZXRDb25uZWN0aW9uKCkgewog\nICAgICAgIGNvbm5lY3QodHJ1ZSk7CiAgICAgICAgcmV0dXJuIF9jb25uOwog\nICAgfQogICAgCiAgICBwcm90ZWN0ZWQgRGF0YVNvdXJjZSBnZXREYXRhU291\ncmNlKCkgewogICAgCXJldHVybiBfZHM7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gZXhpc3RzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgLy8gYWRkIHdoZXJlIGNvbmRpdGlvbnMgb24g\nYmFzZSBjbGFzcyB0byBhdm9pZCBqb2lucyBpZiBzdWJjbGFzcwogICAgICAg\nIC8vIGRvZXNuJ3QgdXNlIG9pZCBhcyBpZGVudGlmaWVyCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRh\nRGF0YSgpOwogICAgICAgIHJldHVybiBleGlzdHMobWFwcGluZywgc20uZ2V0\nT2JqZWN0SWQoKSwgY29udGV4dCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNDYWNoZWQoTGlzdDxPYmplY3Q+IG9pZHMsIEJpdFNldCBlZGF0YSkg\newogICAgICAgIC8vIEpEQkNTdG9yZU1hbmFnZXIgZG9lc24ndCBzdG9yZSBv\naWRzIGluIG1lbW9yeS4KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgYm9vbGVhbiBleGlzdHMoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIE9iamVjdCBvaWQsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAg\nLy8gYWRkIHdoZXJlIGNvbmRpdGlvbnMgb24gYmFzZSBjbGFzcyB0byBhdm9p\nZCBqb2lucyBpZiBzdWJjbGFzcwogICAgICAgIC8vIGRvZXNuJ3QgdXNlIG9p\nZCBhcyBpZGVudGlmaWVyCiAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3\nU2VsZWN0KCk7CiAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2V0Sm9pbmFibGVQ\nQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgbWFw\ncGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCk7CgogICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkob2lkLCBtYXBwaW5n\nLCB0aGlzKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7\nCiAgICAgICAgICAgIF9sb2cudHJhY2UoImV4aXN0czogb2lkPSIrb2lkKyIg\nIittYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgfQogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBzZWwuZ2V0Q291bnQodGhp\ncykgIT0gMDsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwg\nX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\neW5jVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29u\ndGV4dCkgewogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNz\nTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gbWFwcGluZy5nZXRWZXJzaW9uKCkuY2hlY2tWZXJz\naW9uKHNtLCB0aGlzLCB0cnVlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgaW50IGNvbXBhcmVWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc3Rh\ndGUsIE9iamVjdCB2MSwgT2JqZWN0IHYyKSB7CiAgICAgICAgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzdGF0ZS5nZXRNZXRhRGF0\nYSgpOwogICAgICAgIHJldHVybiBtYXBwaW5nLmdldFZlcnNpb24oKS5jb21w\nYXJlVmVyc2lvbih2MSwgdjIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGluaXRpYWxpemUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBz\ndGF0ZSwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVj\ndCBjb250ZXh0KSB7CiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IChD\nb25uZWN0aW9uSW5mbykgY29udGV4dDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gaW5pdGlhbGl6ZVN0YXRlKHNtLCBzdGF0ZSwgKEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24pIGZldGNoLCAKICAgICAgICAgICAgICAgIGlu\nZm8pOwogICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24g\nY25mZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihj\nbmZlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgRXhj\nZXB0aW9ucy50b1N0cmluZyhzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSks\nIAogICAgICAgICAgICAgICAgICAgIF9kaWN0LCBmZXRjaC5nZXRSZWFkTG9j\na0xldmVsKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElu\naXRpYWxpemUgYSBuZXdseS1sb2FkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBib29sZWFuIGluaXRpYWxpemVTdGF0ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIENvbm5lY3Rpb25JbmZvIGluZm8pCiAg\nICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdldE9iamVjdElkKCk7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5n\nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIFJlc3VsdCByZXMgPSBudWxs\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChpbmZvICE9IG51bGwg\nJiYgaW5mby5yZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVz\nID0gaW5mby5yZXN1bHQ7CiAgICAgICAgICAgICAgICBpbmZvLnNtID0gc207\nCiAgICAgICAgICAgICAgICBpZiAoaW5mby5tYXBwaW5nID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgaW5mby5tYXBwaW5nID0gbWFwcGluZzsKICAg\nICAgICAgICAgICAgIG1hcHBpbmcgPSBpbmZvLm1hcHBpbmc7CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAob2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkCiAgICAg\nICAgICAgICAgICAmJiAhKChPcGVuSlBBSWQpIG9pZCkuaGFzU3ViY2xhc3Nl\ncygpKSB7CiAgICAgICAgICAgICAgICBCb29sZWFuIGN1c3RvbSA9IGN1c3Rv\nbUxvYWQoc20sIG1hcHBpbmcsIHN0YXRlLCBmZXRjaCk7CiAgICAgICAgICAg\nICAgICBpZiAoY3VzdG9tICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGN1c3RvbS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgICAg\nIHJlcyA9IGdldEluaXRpYWxpemVTdGF0ZVJlc3VsdChzbSwgbWFwcGluZywg\nZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0LlNVQlNfRVhBQ1Qp\nOwogICAgICAgICAgICAgICAgaWYgKHJlcyA9PSBudWxsICYmICFzZWxlY3RQ\ncmltYXJ5S2V5KHNtLCBtYXBwaW5nLCBmZXRjaCkpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGlzRW1w\ndHlSZXN1bHQocmVzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFz\nc01hcHBpbmdbXSBtYXBwaW5ncyA9IG1hcHBpbmcuCiAgICAgICAgICAgICAg\nICAgICAgZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAg\nICAgICAgICAgICAgIGlmIChtYXBwaW5ncy5sZW5ndGggPT0gMSkgewogICAg\nICAgICAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBwaW5nc1swXTsKICAgICAg\nICAgICAgICAgICAgICBCb29sZWFuIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20s\nIG1hcHBpbmcsIHN0YXRlLCBmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGN1c3RvbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gY3VzdG9tLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAg\nICAgIHJlcyA9IGdldEluaXRpYWxpemVTdGF0ZVJlc3VsdChzbSwgbWFwcGlu\nZywgZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdC5TVUJT\nX0FOWV9KT0lOQUJMRSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyA9\nPSBudWxsICYmICFzZWxlY3RQcmltYXJ5S2V5KHNtLCBtYXBwaW5nLCBmZXRj\naCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHJlcyA9\nIGdldEluaXRpYWxpemVTdGF0ZVVuaW9uUmVzdWx0KHNtLCBtYXBwaW5nLCBt\nYXBwaW5ncywKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2gpOwogICAg\nICAgICAgICAgICAgaWYgKGlzRW1wdHlSZXN1bHQocmVzKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGZpZ3VyZSBvdXQgd2hhdCB0eXBlIG9mIG9iamVjdCB0aGlz\nIGlzOyB0aGUgc3RhdGUgbWFuYWdlcgogICAgICAgICAgICAvLyBvbmx5IGd1\nYXJhbnRlZXMgdG8gcHJvdmlkZSBhIGJhc2UgY2xhc3MKICAgICAgICAgICAg\nQ2xhc3M8Pz4gdHlwZTsKICAgICAgICAgICAgaWYgKCh0eXBlID0gZ2V0VHlw\nZShyZXMsIG1hcHBpbmcpKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAocmVzLmdldEJhc2VNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBtYXBwaW5nID0gcmVzLmdldEJhc2VNYXBwaW5nKCk7CiAgICAg\nICAgICAgICAgICByZXMuc3RhcnREYXRhUmVxdWVzdChtYXBwaW5nLmdldERp\nc2NyaW1pbmF0b3IoKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHR5cGUgPSBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3Io\nKS5nZXRDbGFzcyh0aGlzLCBtYXBwaW5nLAogICAgICAgICAgICAgICAgICAg\nICAgICByZXMpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgICAgICByZXMuZW5kRGF0YVJlcXVlc3QoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaW5pdGlh\nbGl6ZSB0aGUgc3RhdGUgbWFuYWdlcjsgdGhpcyBtYXkgY2hhbmdlIHRoZSBt\nYXBwaW5nCiAgICAgICAgICAgIC8vIGFuZCB0aGUgb2JqZWN0IGlkIGluc3Rh\nbmNlIGlmIHRoZSB0eXBlIGFzIGRldGVybWluZWQKICAgICAgICAgICAgLy8g\nZnJvbSB0aGUgaW5kaWNhdG9yIGlzIGEgc3ViY2xhc3Mgb2YgZXhwZWN0ZWQg\ndHlwZQogICAgICAgICAgICBzbS5pbml0aWFsaXplKHR5cGUsIHN0YXRlKTsK\nCiAgICAgICAgICAgIGlmIChpbmZvICE9IG51bGwgJiYgaW5mby5yZXN1bHQg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBl\nZEJ5RmllbGRNYXBwaW5nID0gaW5mby5yZXN1bHQuCiAgICAgICAgICAgICAg\nICAgICAgZ2V0TWFwcGVkQnlGaWVsZE1hcHBpbmcoKTsKICAgICAgICAgICAg\nICAgIE9iamVjdCBtYXBwZWRCeU9iamVjdCA9IGluZm8ucmVzdWx0LmdldE1h\ncHBlZEJ5VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChtYXBwZWRCeUZp\nZWxkTWFwcGluZyAhPSBudWxsICYmIG1hcHBlZEJ5T2JqZWN0ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5T2JqZWN0IGluc3Rh\nbmNlb2YgT3BlbkpQQUlkICYmCiAgICAgICAgICAgICAgICAgICAgICAgIG1h\ncHBpbmcuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChtYXBwZWRCeUZpZWxkTWFw\ncGluZy5nZXRJbmRleCgpKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBUaGUgaW52ZXJzZSByZWxhdGlvbiBjYW4gbm90IGJlIHNldCBz\naW5jZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBhcmUgZWFnZXJs\neSBsb2FkaW5nIHRoaXMgc20gZm9yCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGEgc20gb3duZXIgdGhhdCBpcyBzdGlsbCBpbiB0aGUgcHJvY2VzcyBv\nZiAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6aW5nIGl0\nc2VsZi4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgb3du\nZXIgb2lkIGJ5IHNldEludGVybWVkaWF0ZSgpLgogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBUaGUgaW52ZXJzZSByZWxhdGlvbiBpcyBzZXQgbGF0ZXIg\nYnkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0SW52ZXJzZVJlbGF0\naW9uKCkgd2hlbiB0aGUgc20gb3duZXIgaXMgZnVsbHkKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZWQuCiAgICAgICAgICAgICAgICAg\nICAgICAgIGludCBpbmRleCA9IG1hcHBlZEJ5RmllbGRNYXBwaW5nLmdldElu\nZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5nZXRMb2Fk\nZWQoKS5nZXQoaW5kZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzbS5zZXRJbXBsRGF0YShpbmRleCwgbWFwcGVkQnlPYmplY3QpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc20uc2V0SW50ZXJtZWRpYXRlKGluZGV4LCBtYXBwZWRC\neU9iamVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBz\nZXRNYXBwZWRCeShzbSwgbWFwcGVkQnlGaWVsZE1hcHBpbmcsIG1hcHBlZEJ5\nT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gbG9hZCB0aGUgc2VsZWN0ZWQgbWFwcGluZ3MgaW50\nbyB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlcgogICAgICAgICAgICBpZiAocmVz\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHJlLWdldCB0aGUgbWFw\ncGluZyBpbiBjYXNlIHRoZSBpbnN0YW5jZSB3YXMgYSBzdWJjbGFzcwogICAg\nICAgICAgICAgICAgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1l\ndGFEYXRhKCk7CiAgICAgICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBm\nZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIGdldFZlcnNpb24obWFwcGlu\nZywgc20sIHJlcyk7CiAgICAgICAgICAgICAgICBzZXRJbnZlcnNlUmVsYXRp\nb24oc20sIG1hcHBpbmcsIHJlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgaWYgKHJlcyAhPSBudWxsICYmIChpbmZvID09IG51bGwgfHwgcmVzICE9\nIGluZm8ucmVzdWx0KSkKICAgICAgICAgICAgICAgIHJlcy5jbG9zZSgpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc2V0SW52ZXJzZVJl\nbGF0aW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIsCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIFJlc3VsdCByZXMpIHsKICAgICAgICBGaWVs\nZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldEZpZWxkTWFwcGluZ3MoKTsK\nCiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCwgdGhlIG93bmVyIGlzIGZ1bGx5\nIGluaXRpYWxpemVkLgogICAgICAgIC8vIENoZWNrIGlmIHRoZSBvd25lciBo\nYXMgZWFnZXJseSBsb2FkZWQgVG9NYW55IHJlbGF0aW9ucy4KICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAocmVzLmdldEVhZ2VyKGZtc1tpXSkgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaWYgKCFmbXNbaV0uZ2V0RWxlbWVudCgpLmlzVHlwZVBD\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIE9iamVjdCBjb2xsID0gIG93bmVy\nLmZldGNoT2JqZWN0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAgICAgICAg\nICAgIGlmIChjb2xsIGluc3RhbmNlb2YgTWFwKQogICAgICAgICAgICAgICAg\nICAgIGNvbGwgPSAoKE1hcCljb2xsKS52YWx1ZXMoKTsKICAgICAgICAgICAg\nICAgIGlmIChjb2xsIGluc3RhbmNlb2YgQ29sbGVjdGlvbjw/PiAmJiAKICAg\nICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb248Pz4pIGNvbGwpLnNpemUo\nKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBGb3VuZCBlYWdlcmx5\nIGxvYWRlZCBjb2xsZWN0aW9uLgogICAgICAgICAgICAgICAgICAgIC8vIFB1\nYmxpc2hlciAoMSkgPD09PiAgKE0pIE1hZ2F6aW5lCiAgICAgICAgICAgICAg\nICAgICAgLy8gICAgcHVibGlzaGVyIGhhcyBhIEVBR0VSIE9uZVRvTWFueSBy\nZWxhdGlvbgogICAgICAgICAgICAgICAgICAgIC8vICAgIG1hZ2F6aW5lIGhh\ncyBhIEVBR0VSIG9yIExBWlkgTWFueVRvT25lIHB1Ymxpc2hlcgogICAgICAg\nICAgICAgICAgICAgIC8vIEZvciBlYWNoIG1lbWJlciAoTWFnYXppbmUpIGlu\nIHRoZSBjb2xsZWN0aW9uLCAKICAgICAgICAgICAgICAgICAgICAvLyBzZXQg\naXRzIGludmVyc2UgcmVsYXRpb24gKFB1Ymxpc2hlcikuCiAgICAgICAgICAg\nICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSAoKENvbGxlY3Rpb248\nPz4pIGNvbGwpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIGl0\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIpIHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIENsYXNzTWFwcGluZyBjbSA9CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAoQ2xhc3NNYXBwaW5nKSBfY29uZi5nZXRNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpLmdldENhY2hlZE1ldGFEYXRhKHBjLmdldENs\nYXNzKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdb\nXSBmbWQgPSBjbS5nZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZm1kLmxlbmd0aDsgaisr\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBjaGVj\nayB0aGUgb2lkcyBmb3IgYmFzaWMgZmllbGRzLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGZtZFtqXS5pc1R5cGVQQygpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdldElu\ndGVybWVkaWF0ZShmbWRbal0uZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gaWYgb2lkIHdhcyBzZXRJbnRlcm1lZGlh\ndGUoKSBwcmV2aW91c2x5IGFuZCBpdCBpcyB0aGUgc2FtZSBhcyB0aGUgb3du\nZXIsZ2VuZXJhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyB0aGVuIHNldCB0aGUgaW52ZXJzZSByZWxhdGlvbgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCAmJiBvaWQuZXF1\nYWxzKG93bmVyLmdldE9iamVjdElkKCkpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZtZFtqXS5nZXRJ\nbmRleCgpLCBvd25lci5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRNYXBw\nZWRCeShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEZpZWxkTWFw\ncGluZyBtYXBwZWRCeUZpZWxkTWFwcGluZywgT2JqZWN0IG1hcHBlZEJ5T2Jq\nZWN0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NN\nYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIEZpZWxkTWFwcGlu\nZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmbXNbaV0gPT0gbWFwcGVkQnlGaWVsZE1hcHBpbmcpIHsK\nICAgICAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZtc1tpXS5nZXRJbmRl\neCgpLCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24t\nSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBn\nZXR0aW5nIHZlcnNpb24gZnJvbSB0aGUgcmVzdWx0IHNldC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgZ2V0VmVyc2lvbihDbGFzc01hcHBpbmcgbWFw\ncGluZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBSZXN1bHQg\ncmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBtYXBwaW5nLmdl\ndFZlcnNpb24oKS5hZnRlckxvYWQoc20sIHRoaXMpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGNoZWNraW5nIHdoZXRoZXIgdGhlIHJlc3VsdCBzZXQgaXMg\nZW1wdHkgb3Igbm90LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBp\nc0VtcHR5UmVzdWx0KFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAhcmVzLm5leHQoKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHBy\nb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAg\nICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcgdHlwZSBmcm9tIHRoZSBy\nZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3M8Pz4gZ2V0\nVHlwZShSZXN1bHQgcmVzLCBDbGFzc01hcHBpbmcgbWFwcGluZyl7CiAgICAg\nICAgaWYgKHJlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWFwcGlu\nZy5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB0aGUgbWFwcGluZyB0byBjdXN0\nb20gbG9hZCBkYXRhLiBSZXR1cm4gbnVsbCBpZiB0aGUgbWFwcGluZwogICAg\nICogZG9lcyBub3QgdXNlIGN1c3RvbSBsb2FkaW5nLgogICAgICovCiAgICBw\ncml2YXRlIEJvb2xlYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBQQ1N0YXRlIHN0\nYXRlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRo\ncm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgbWFwcGluZyB0YWtlcyBj\nYXJlIG9mIGluaXRpYWxpemF0aW9uCiAgICAgICAgaWYgKCFtYXBwaW5nLmN1\nc3RvbUxvYWQoc20sIHRoaXMsIHN0YXRlLCBmZXRjaCkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lv\nbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybiBC\nb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBkYXRh\nIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UgYW5kIHJldHVybiB0aGUgcmVzdWx0\nLiBSZXR1cm4KICAgICAqIG51bGwgaWYgdGhlcmUgaXMgbm8gZGF0YSBpbiB0\naGUgY3VycmVudCBmZXRjaCBncm91cHMgdG8gc2VsZWN0LgogICAgICovCiAg\nICBwcml2YXRlIFJlc3VsdCBnZXRJbml0aWFsaXplU3RhdGVSZXN1bHQoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHN1YnMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRmluZGVy\nUXVlcnlJbXBsIGZxID0gZ2V0RmluZGVyKG1hcHBpbmcsIGZldGNoKTsKICAg\nICAgICBpZiAoZnEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZxLmV4\nZWN1dGUoc20sIHRoaXMsIGZldGNoKTsKICAgICAgICBTZWxlY3Qgc2VsID0g\nX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBpZiAoIXNlbGVjdChzZWwsIG1h\ncHBpbmcsIHN1YnMsIHNtLCBudWxsLCBmZXRjaCwKICAgICAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOLCB0cnVlLCBmYWxzZSkp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywgdGhpcyk7CiAg\nICAgICAgc2VsLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwog\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgX2xvZy50cmFjZSgiZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0OiBvaWQ9\nIitzbS5nZXRPYmplY3RJZCgpKyIgIittYXBwaW5nLmdldERlc2NyaWJlZFR5\ncGUoKSk7CiAgICAgICAgfQogICAgICAgIFJlc3VsdCByZXN1bHQgPSBzZWwu\nZXhlY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICAgICAgY2FjaGVGaW5kZXIobWFw\ncGluZywgc2VsLCBmZXRjaCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBhIHVuaW9uIG9mIHRoZSBkYXRh\nIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSBwb3NzaWJsZSBjb25jcmV0\nZQogICAgICogbWFwcGluZ3MgYW5kIHJldHVybiB0aGUgcmVzdWx0LgogICAg\nICovCiAgICBwcml2YXRlIFJlc3VsdCBnZXRJbml0aWFsaXplU3RhdGVVbmlv\nblJlc3VsdChmaW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIENsYXNzTWFwcGluZyBtYXBwaW5nLCBmaW5hbCBDbGFzc01hcHBpbmdbXSBt\nYXBwaW5ncywKICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBGaW5kZXJR\ndWVyeUltcGwgZnEgPSBnZXRGaW5kZXIobWFwcGluZywgZmV0Y2gpOwogICAg\nICAgIGlmIChmcSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZnEuZXhl\nY3V0ZShzbSwgdGhpcywgZmV0Y2gpOwogICAgICAgIGZpbmFsIEpEQkNTdG9y\nZU1hbmFnZXIgc3RvcmUgPSB0aGlzOwogICAgICAgIGZpbmFsIGludCBlYWdl\nciA9IE1hdGgubWluKGZldGNoLmdldEVhZ2VyRmV0Y2hNb2RlKCksCiAgICAg\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7Cgog\nICAgICAgIFVuaW9uIHVuaW9uID0gX3NxbC5uZXdVbmlvbihtYXBwaW5ncy5s\nZW5ndGgpOwogICAgICAgIHVuaW9uLnNldEV4cGVjdGVkUmVzdWx0Q291bnQo\nMSwgZmFsc2UpOwogICAgICAgIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNo\nTW9kZShtYXBwaW5nKSAhPSBmZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAg\nICB1bmlvbi5hYm9ydFVuaW9uKCk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5l\ndyBVbmlvbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpKSB7CiAgICAgICAgICAgICAgICBz\nZWwuc2VsZWN0KG1hcHBpbmdzW2ldLCBTZWxlY3QuU1VCU19BTllfSk9JTkFC\nTEUsIHN0b3JlLCBmZXRjaCwKICAgICAgICAgICAgICAgICAgICBlYWdlcik7\nCiAgICAgICAgICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9i\namVjdElkKCksIG1hcHBpbmdzW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9KTsKICAgICAgICBSZXN1bHQgcmVzdWx0ID0gdW5pb24uZXhl\nY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICAgICAgY2FjaGVGaW5kZXIobWFwcGlu\nZywgdW5pb24sIGZldGNoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nfQoKICAgIC8qKgogICAgICogU2VsZWN0IHByaW1hcnkga2V5IGRhdGEgdG8g\nbWFrZSBzdXJlIHRoZSBnaXZlbiBpbnN0YW5jZSBleGlzdHMsIGxvY2tpbmcK\nICAgICAqIGlmIG5lZWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHNlbGVjdFByaW1hcnlLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBzZWxlY3QgcGtzIGZyb20gYmFzZSBjbGFzcyByZWNvcmQgdG8g\nZW5zdXJlIGl0IGV4aXN0cyBhbmQgbG9jawogICAgICAgIC8vIGl0IGlmIG5l\nZWRlZAogICAgICAgIENsYXNzTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAg\nICAgICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKSAhPSBudWxsKQogICAgICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKCiAgICAgICAgU2VsZWN0IHNl\nbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgc2VsLnNlbGVjdChiYXNl\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpOwogICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgYmFzZSwgdGhpcyk7CiAgICAg\nICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBf\nbG9nLnRyYWNlKCJzZWxlY3RQcmltYXJ5S2V5OiBvaWQ9IitzbS5nZXRPYmpl\nY3RJZCgpKyIgIittYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAg\nICAgfQogICAgICAgIFJlc3VsdCBleGlzdHMgPSBzZWwuZXhlY3V0ZSh0aGlz\nLCBmZXRjaCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzRW1w\ndHlSZXN1bHQoZXhpc3RzKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgICAgIC8vIHJlY29yZCBsb2NrZWQ/CiAgICAgICAgICAg\nIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIGV4aXN0cy5pc0xvY2tp\nbmcoKSkKICAgICAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20p\nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBleGlzdHMuY2xvc2UoKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2JqZWN0IGNvbnRleHQpIHsKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9IChKREJDRmV0\nY2hDb25maWd1cmF0aW9uKSBmZXRjaDsKCiAgICAgICAgLy8gZ2V0IGEgY29u\nbmVjdGlvbiwgb3IgcmV1c2UgY3VycmVudCBvbmUKICAgICAgICBDb25uZWN0\naW9uSW5mbyBpbmZvID0gKENvbm5lY3Rpb25JbmZvKSBjb250ZXh0OwogICAg\nICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAgIGlmIChpbmZvICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gaWYgaW5pdGlhbGl6ZSgpIGZhaWxzIHRv\nIGxvYWQgcmVxdWlyZWQgZmllbGRzLCB0aGVuIHRoaXMgbWV0aG9kCiAgICAg\nICAgICAgIC8vIGlzIGNhbGxlZDsgbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8g\ndXNlIHRoZSBnaXZlbiByZXN1bHQgaWYgaXQncwogICAgICAgICAgICAvLyB0\naGUgc2FtZSBvbmUgd2UganVzdCBmYWlsZWQgdG8gY29tcGxldGVseSBpbml0\naWFsaXplKCkgd2l0aAogICAgICAgICAgICBpZiAoaW5mby5zbSAhPSBzbSkK\nICAgICAgICAgICAgICAgIHJlcyA9IGluZm8ucmVzdWx0OwogICAgICAgICAg\nICBpbmZvLnNtID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBleGlzdGluZyByZXN1bHQsIGxv\nYWQgYWxsIHdlIGNhbiBmcm9tIGl0CiAgICAgICAgICAgIENsYXNzTWFwcGlu\nZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsK\nICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7CiAgICAgICAgICAg\nICAgICByZW1vdmVMb2FkZWRGaWVsZHMoc20sIGZpZWxkcyk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5jZSBpcyBob2xs\nb3cgYW5kIHRoZXJlJ3MgYSBjdXN0b21pemVkCiAgICAgICAgICAgIC8vIGdl\ndCBieSBpZCBtZXRob2QsIHVzZSBpdAogICAgICAgICAgICBpZiAoc20uZ2V0\nTG9hZGVkKCkubGVuZ3RoKCkgPT0gMCAKICAgICAgICAgICAgICAgICYmIG1h\ncHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgbnVsbCwgamZldGNoKSkKICAg\nICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwgZmllbGRzKTsK\nCiAgICAgICAgICAgIC8vIyMjIHNlbGVjdCBpcyBraW5kIG9mIGEgYmlnIG9i\namVjdCwgYW5kIGluIHNvbWUgY2FzZXMgd2UgZG9uJ3QKICAgICAgICAgICAg\nLy8jIyMgdXNlIGl0Li4uIHdvdWxkIGl0IGJlIHdvcnRoIGl0IHRvIGhhdmUg\nYSBzbWFsbCBzaGVsbCBzZWxlY3QKICAgICAgICAgICAgLy8jIyMgb2JqZWN0\nIHRoYXQgb25seSBjcmVhdGVzIGEgcmVhbCBzZWxlY3Qgd2hlbiBhY3R1YWxs\neSB1c2VkPwoKICAgICAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2Vs\nZWN0KCk7CiAgICAgICAgICAgIGlmIChzZWxlY3Qoc2VsLCBtYXBwaW5nLCBT\nZWxlY3QuU1VCU19FWEFDVCwgc20sIGZpZWxkcywgamZldGNoLAogICAgICAg\nICAgICAgICAgRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU4sIHRydWUsIGZh\nbHNlKSkgewogICAgICAgICAgICAgICAgc2VsLndoZXJlUHJpbWFyeUtleShz\nbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0aGlzKTsKICAgICAgICAgICAg\nICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBfbG9nLnRyYWNlKCJsb2FkOiAiK21hcHBpbmcuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKyIgb2lkOiAiK3NtLmdldE9iamVjdElkKCkpOyAKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlcyA9IHNlbC5leGVjdXRl\nKHRoaXMsIGpmZXRjaCwgbG9ja0xldmVsKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgCWlmIChpc0VtcHR5UmVzdWx0KHJlcykp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7\nCiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\nICAgIHJlcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBub3cgYWxsb3cgdGhlIGZpZWxkcyB0byBs\nb2FkIHRoZW1zZWx2ZXMgaW5kaXZpZHVhbGx5IHRvbwogICAgICAgICAgICBG\naWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldEZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAmJiAh\nc20uZ2V0TG9hZGVkKCkuZ2V0KGkpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBfbG9nLnRyYWNlKCJsb2FkIGZpZWxkOiAnIisgZm1zW2ldLmdl\ndE5hbWUoKSArICInIGZvciBvaWQ9IitzbS5nZXRPYmplY3RJZCgpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIiAiK21hcHBpbmcuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgZm1zW2ldLmxvYWQoc20sIHRoaXMsIGpmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2ldKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKENsYXNz\nTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0LCBsb2NrTGV2ZWwpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGxpc3QgZm9ybWVkIGJ5\nIHJlbW92aW5nIGFsbCBsb2FkZWQgZmllbGRzIGZyb20gdGhlIGdpdmVuIG9u\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUxvYWRlZEZpZWxk\ncyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzKSB7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IGZpZWxkcy5sZW5ndGgoKTsg\naSA8IGxlbjsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAm\nJiBzbS5nZXRMb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAgICAgICBmaWVs\nZHMuY2xlYXIoaSk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gbG9h\nZEFsbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwgaW50IGxvYWQs\nCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29u\ndGV4dCkgewogICAgICAgIHJldHVybiBJbXBsSGVscGVyLmxvYWRBbGwoc21z\nLCB0aGlzLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGNvbnRleHQpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGJlZm9yZVN0YXRlQ2hhbmdlKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIFBDU3RhdGUgZnJvbVN0YXRlLAogICAgICAgIFBDU3Rh\ndGUgdG9TdGF0ZSkgewogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGZs\ndXNoKENvbGxlY3Rpb24gc21zKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKF9jb25uICE9IG51bGwgJiYgX2Nvbm4uZ2V0SW5uZXJtb3N0RGVs\nZWdhdGUoKS5pc1JlYWRPbmx5KCkpCiAgICAgICAgICAgICAgICBfY29ubi5z\nZXRSZWFkT25seShmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIGUpIHsKICAgICAgICB9CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkgewogICAgICAgICAgICBmb3IgKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc206IChDb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+KXNtcykg\newogICAgICAgICAgICAgICAgX2xvZy50cmFjZSgiZmx1c2g6ICIrc20uZ2V0\nUENTdGF0ZSgpLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIiBmb3Igb2lkPSIr\nc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9jb25mLmdldFVwZGF0ZU1hbmFnZXJJbnN0YW5jZSgp\nLmZsdXNoKHNtcywgdGhpcyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nY2FuY2VsQWxsKCkgewogICAgICAgIC8vIG5vdGUgdGhhdCB0aGlzIG1ldGhv\nZCBkb2VzIG5vdCBsb2NrIHRoZSBjb250ZXh0LCBzaW5jZQogICAgICAgIC8v\nIHdlIHdhbnQgdG8gYWxsb3cgYSBkaWZmZXJlbnQgdGhyZWFkIHRvIGJlIGFi\nbGUgdG8gY2FuY2VsIHRoZQogICAgICAgIC8vIG91dHN0YW5kaW5nIHN0YXRl\nbWVudCBvbiBhIGRpZmZlcmVudCBjb250ZXh0CgogICAgICAgIENvbGxlY3Rp\nb248U3RhdGVtZW50PiBzdG1udHM7CiAgICAgICAgc3luY2hyb25pemVkIChf\nc3RtbnRzKSB7CiAgICAgICAgICAgIGlmIChfc3RtbnRzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3Rt\nbnRzID0gbmV3IEFycmF5TGlzdDxTdGF0ZW1lbnQ+KF9zdG1udHMpOwogICAg\nICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\ncjxTdGF0ZW1lbnQ+IGl0ciA9IHN0bW50cy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVtZW50KSBpdHIubmV4\ndCgpKS5jYW5jZWwoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRo\ncm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXNzaWduT2JqZWN0SWQo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgYm9vbGVhbiBwcmVGbHVzaCkgewog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7\nCiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEFw\ncGxpY2F0aW9uSWRzLmFzc2lnbihzbSwgdGhpcywgcHJlRmx1c2gpOwoKICAg\nICAgICAvLyBkYXRhc3RvcmUgaWRlbnRpdHkKICAgICAgICBPYmplY3QgdmFs\nID0gSW1wbEhlbHBlci5nZW5lcmF0ZUlkZW50aXR5VmFsdWUoX2N0eCwgbWV0\nYSwKICAgICAgICAgICAgSmF2YVR5cGVzLkxPTkcpOwogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCAmJiBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSAhPSBW\nYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICB2YWwg\nPSBnZXREYXRhU3RvcmVJZFNlcXVlbmNlKG1ldGEpLm5leHQoX2N0eCwgbWV0\nYSk7CiAgICAgICAgc20uc2V0T2JqZWN0SWQobmV3RGF0YVN0b3JlSWQodmFs\nLCBtZXRhKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gYXNzaWduRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgaW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gcHJlRmx1c2gpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVscGVy\nLmdlbmVyYXRlRmllbGRWYWx1ZShfY3R4LCBmbWQpOwogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIHNtLnN0b3JlKGZpZWxkLCB2YWwpOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyBDbGFzczw/PiBnZXRNYW5hZ2VkVHlwZShPYmpl\nY3Qgb2lkKSB7CiAgICAgICAgaWYgKG9pZCBpbnN0YW5jZW9mIElkKQogICAg\nICAgICAgICByZXR1cm4gKChJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIENsYXNzPD8+IGdldERh\ndGFTdG9yZUlkVHlwZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBy\nZXR1cm4gSWQuY2xhc3M7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBjb3B5\nRGF0YVN0b3JlSWQoT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgSWQgaWQgPSAoSWQpIG9pZDsKICAgICAgICByZXR1cm4gbmV3\nIElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBpZC5nZXRJZCgpLCBpZC5o\nYXNTdWJjbGFzc2VzKCkpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3\nRGF0YVN0b3JlSWQoT2JqZWN0IHZhbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgcmV0dXJuIElkLm5ld0luc3RhbmNlKG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLCB2YWwpOwogICAgfQoKICAgIHB1YmxpYyBJZCBuZXdEYXRh\nU3RvcmVJZChsb25nIGlkLCBDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVh\nbiBzdWJzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJZChtYXBwaW5nLmdldERl\nc2NyaWJlZFR5cGUoKSwgaWQsIHN1YnMpOwogICAgfQoKICAgIHB1YmxpYyBS\nZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRlRXh0ZW50KENsYXNzTWV0YURh\ndGEgbWV0YSwKICAgICAgICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMsIEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIENsYXNzTWFwcGlu\nZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBmaW5h\nbCBDbGFzc01hcHBpbmdbXSBtYXBwaW5nczsKICAgICAgICBpZiAoc3ViY2xh\nc3NlcykKICAgICAgICAgICAgbWFwcGluZ3MgPSBtYXBwaW5nLmdldEluZGVw\nZW5kZW50QXNzaWduYWJsZU1hcHBpbmdzKCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBtYXBwaW5ncyA9IG5ldyBDbGFzc01hcHBpbmdbXSB7IG1hcHBp\nbmcgfTsKCiAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0g\nbnVsbDsKICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpm\nZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaDsKICAgICAg\nICBpZiAoamZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9\nIGpmZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAgICByb3BzID0gbmV3IFJl\nc3VsdE9iamVjdFByb3ZpZGVyW21hcHBpbmdzLmxlbmd0aF07CgogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBjdXN0b20gbG9hZHMK\nICAgICAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICByb3AgPSBtYXBwaW5nc1tpXS5jdXN0b21M\nb2FkKHRoaXMsIHN1YmNsYXNzZXMsIGpmZXRjaCwgMCwKICAgICAgICAgICAg\nICAgICAgICBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgICAgICBpZiAo\ncm9wICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocm9wcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICByb3BzID0gbmV3IFJl\nc3VsdE9iamVjdFByb3ZpZGVyW21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAg\nICAgICAgICAgICAgcm9wc1tpXSA9IHJvcDsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgd2UncmUgc2VsZWN0\naW5nIGluZGVwZW5kZW50IG1hcHBpbmdzIHNlcGFyYXRlbHkgb3IgaGF2ZQog\nICAgICAgICAgICAvLyBjdXN0b20gbG9hZHMsIGRvIGluZGl2aWR1YWwgc2Vs\nZWN0cyBmb3IgZWFjaCBjbGFzcwogICAgICAgICAgICByb3AgPSBudWxsOwog\nICAgICAgICAgICBpZiAocm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvcHNbaV0gIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAg\nICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAg\nICAgICAgICAgICAgIHNlbC5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKCJleGVjdXRlRXh0ZW50OiAiK21h\ncHBpbmdzW2ldLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHNlbC5sb2dFYWdlclJlbGF0aW9ucygpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBCaXRTZXQgcGFnZWQg\nPSBzZWxlY3RFeHRlbnQoc2VsLCBtYXBwaW5nc1tpXSwgamZldGNoLAogICAg\nICAgICAgICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgcm9wc1tpXSA9IG5ldyBJbnN0YW5jZVJlc3VsdE9iamVjdFByb3Zp\nZGVyKHNlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdz\nW2ldLCB0aGlzLCBqZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9IG5ldyBQYWdpbmdS\nZXN1bHRPYmplY3RQcm92aWRlcihzZWwsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBtYXBwaW5nc1tpXSwgdGhpcywgamZldGNoLCBwYWdlZCwgTG9u\nZy5NQVhfVkFMVUUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaWYgKHJvcHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHJvcHNbMF07CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1l\ncmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBwZXJmb3JtIGEgdW5pb24gb24gYWxsIGluZGVw\nZW5kZW50IGNsYXNzZXMKICAgICAgICAgICAgVW5pb24gdW5pb24gPSBfc3Fs\nLm5ld1VuaW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgICAgIHVuaW9u\nLnNldExSUyh0cnVlKTsKICAgICAgICAgICAgZmluYWwgQml0U2V0W10gcGFn\nZWQgPSBuZXcgQml0U2V0W21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAgICAg\nIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGlk\neCkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VkW2lkeF0gPSBzZWxlY3RF\neHRlbnQoc2VsLCBtYXBwaW5nc1tpZHhdLCBqZmV0Y2gsCiAgICAgICAgICAg\nICAgICAgICAgICAgIHN1YmNsYXNzZXMpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIHVzaW5nIHBhZ2luZyBy\nb3AgaWYgYW55IHVuaW9uIGVsZW1lbnQgaGFzIHBhZ2VkIGZpZWxkcwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBhZ2VkLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAocGFnZWRbaV0gIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jlc3VsdE9iamVj\ndFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5ncywKICAgICAgICAgICAgICAgICAg\nICAgICAgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBqZmV0Y2gsIHBhZ2VkLCBM\nb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIG5ldyBJbnN0YW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9uLCBt\nYXBwaW5nc1swXSwgdGhpcywKICAgICAgICAgICAgICAgIGpmZXRjaCk7CiAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVu\nIG1hcHBpbmcgZm9yIHVzZSBpbiBhbiBleHRlbnQsIHJldHVybmluZyBwYWdl\nZCBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IHNlbGVjdEV4\ndGVudChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFuIHN1YmNs\nYXNzZXMpIHsKICAgICAgICBpbnQgc3VicyA9IChzdWJjbGFzc2VzKSA/IFNl\nbGVjdC5TVUJTX0pPSU5BQkxFIDogU2VsZWN0LlNVQlNfTk9ORTsKICAgICAg\nICAvLyBkZWNpZGUgYmV0d2VlbiBwYWdpbmcgYW5kIHN0YW5kYXJkIGl0ZXJh\ndGlvbgogICAgICAgIEJpdFNldCBwYWdlZCA9IFBhZ2luZ1Jlc3VsdE9iamVj\ndFByb3ZpZGVyLmdldFBhZ2VkRmllbGRzKHNlbCwgbWFwcGluZywKICAgICAg\nICAgICAgdGhpcywgZmV0Y2gsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFH\nRVJfUEFSQUxMRUwsCiAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVFKTsKICAg\nICAgICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgc2VsLnNlbGVj\ndElkZW50aWZpZXIobWFwcGluZywgc3VicywgdGhpcywgZmV0Y2gsCiAgICAg\nICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFM\nTEVMKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNlbC5zZWxlY3RJZGVu\ndGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAogICAgICAgICAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKTsKICAg\nICAgICByZXR1cm4gcGFnZWQ7CiAgICB9CgogICAgcHJpdmF0ZSBTdG9yZVF1\nZXJ5IG5ld1N0b3JlUXVlcnkoU3RyaW5nIGxhbmd1YWdlKSB7CiAgICAgICAg\nRXhwcmVzc2lvblBhcnNlciBlcCA9IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZv\nckxhbmd1YWdlKGxhbmd1YWdlKTsKICAgICAgICBpZiAoZXAgIT0gbnVsbCkg\neyAKICAgICAgICAgICAgcmV0dXJuIG5ldyBKREJDU3RvcmVRdWVyeSh0aGlz\nLCBlcCk7CiAgICAgICAgfQogICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5M\nQU5HX1NRTC5lcXVhbHMobGFuZ3VhZ2UpKSB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgU1FMU3RvcmVRdWVyeSh0aGlzKTsKICAgICAgICB9CiAgICAgICAg\naWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhs\nYW5ndWFnZSkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcmVwYXJlZFNR\nTFN0b3JlUXVlcnkodGhpcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBuZXdRdWVy\neShTdHJpbmcgbGFuZ3VhZ2UpIHsKICAgICAgICBTdG9yZVF1ZXJ5IHNxID0g\nbmV3U3RvcmVRdWVyeShsYW5ndWFnZSk7IAogICAgICAgIGlmIChzcSA9PSBu\ndWxsIHx8IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZvckxhbmd1YWdlKGxhbmd1\nYWdlKSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBzcTsKICAgICAg\nICB9CgogICAgICAgIFF1ZXJ5Q2FjaGUgcXVlcnlDYWNoZSA9IF9jdHguZ2V0\nQ29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgp\nLmdldFN5c3RlbVF1ZXJ5Q2FjaGUoKTsKICAgICAgICBpZiAocXVlcnlDYWNo\nZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBzcTsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUNhY2hlU3RvcmVR\ndWVyeShzcSwgcXVlcnlDYWNoZSk7CiAgICB9CgogICAgcHVibGljIEZldGNo\nQ29uZmlndXJhdGlvbiBuZXdGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBKREJDRmV0Y2hDb25maWd1cmF0aW9uSW1wbCgpOwog\nICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0RGF0YVN0b3JlSWRTZXF1ZW5jZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRJZGVu\ndGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5BVElWRQogICAg\nICAgICAgICB8fCBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSA9PSBWYWx1\nZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgcmV0dXJuIF9jb25mLmdl\ndFNlcXVlbmNlSW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwdWJsaWMgU2VxIGdldFZhbHVlU2VxdWVuY2UoRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBpZiAoX2Nvbm4gIT0gbnVs\nbCkKICAgICAgICAgICAgX2Nvbm4uZnJlZSgpOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8KICAgIC8vIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoK\nICAgIC8qKgogICAgICogQ29ubmVjdCB0byB0aGUgZGIuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBjb25uZWN0KGJvb2xlYW4gcmVmKSB7CiAgICAgICAg\nX2N0eC5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29u\nbmVjdCBpZiB0aGUgY29ubmVjdGlvbiBpcyBjdXJyZW50bHkgbnVsbCwgb3Ig\naWYKICAgICAgICAgICAgLy8gdGhlIGNvbm5lY3Rpb24gaGFzIGJlZW4gY2xv\nc2VkIG91dCBmcm9tIHVuZGVyIHVzCiAgICAgICAgICAgIGlmIChfY29ubiA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2Nvbm4gPSBjb25uZWN0SW50ZXJu\nYWwoKTsKICAgICAgICAgICAgaWYgKHJlZikKICAgICAgICAgICAgICAgIF9j\nb25uLnJlZigpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNl\nLCBfZGljdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2N0\neC51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb25uZWN0IHRvIHRoZSBkYXRhYmFzZS4gVGhpcyBtZXRob2QgaXMgc2VwYXJh\ndGVkIG91dCBzbyB0aGF0IGl0CiAgICAgKiBjYW4gYmUgb3ZlcnJpZGRlbi4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFJlZkNvdW50Q29ubmVjdGlvbiBjb25u\nZWN0SW50ZXJuYWwoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShyZWZD\nb3VudENvbm5lY3Rpb25JbXBsLCBKREJDU3RvcmVNYW5hZ2VyLnRoaXMsIF9k\ncy5nZXRDb25uZWN0aW9uKCkpOwogICAgfQogICAgCiAgICBwdWJsaWMgQ29u\nbmVjdGlvbiBnZXROZXdDb25uZWN0aW9uKCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJldHVybiBfZHMuZ2V0Q29ubmVjdGlvbigpOwogICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93\nIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoZSwgX2RpY3QpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIG9iamVjdCB3aXRoIHRo\nZSBnaXZlbiBvaWQuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZmluZChP\nYmplY3Qgb2lkLCBWYWx1ZU1hcHBpbmcgdm0sIAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgX2xvZy50cmFjZSgi\nZmluZDogb2lkPSIrb2lkKyIgIit2bS5nZXREZWNsYXJlZFR5cGVNYXBwaW5n\nKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgT2Jq\nZWN0IHBjID0gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIG51bGwsIG51bGwsIDAp\nOwogICAgICAgIGlmIChwYyA9PSBudWxsICYmIHZtICE9IG51bGwpIHsKICAg\nICAgICAgICAgT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9uID0gX2NvbmYuZ2V0\nT3JwaGFuZWRLZXlBY3Rpb25JbnN0YW5jZSgpOwogICAgICAgICAgICBwYyA9\nIGFjdGlvbi5vcnBoYW4ob2lkLCBudWxsLCB2bSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBwYzsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhl\nIG9iamVjdCBpbiB0aGUgY3VycmVudCByb3cgb2YgdGhlIGdpdmVuIHJlc3Vs\ndC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBsb2FkKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIEJpdFNldCBleGNsdWRlLCBSZXN1bHQgcmVzdWx0KSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNNYXBwZWQoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgCiAgICAgICAgICAgICAgICBt\nYXBwaW5nKSk7CgogICAgICAgIC8vIGdldCB0aGUgb2JqZWN0IGlkIGZvciB0\naGUgcm93OyBiYXNlIGNsYXNzIHNlbGVjdHMgcGsgY29sdW1ucwogICAgICAg\nIENsYXNzTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAo\nYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxs\nKQogICAgICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKTsKICAgICAgICBPYmplY3Qgb2lkID0gYmFzZS5nZXRP\nYmplY3RJZCh0aGlzLCByZXN1bHQsIG51bGwsIHRydWUsIG51bGwpOwogICAg\nICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSBuZXcgQ29ubmVjdGlv\nbkluZm8oKTsKICAgICAgICBpbmZvLnJlc3VsdCA9IHJlc3VsdDsKICAgICAg\nICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwoKICAgICAgICAvLyBpZiBpbnZl\ncnNlIHJlbGF0aW9uIGlzIGtub3duLCBleGNsdWRlIGxvYWRpbmcgZHVyaW5n\nIGZpbmQKICAgICAgICBleGNsdWRlID0gZXhjbHVkZUludmVyc2VSZWxhdGlv\nbihtYXBwaW5nLCBpbmZvLCBleGNsdWRlKTsKICAgICAgICByZXR1cm4gX2N0\neC5maW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGluZm8sIDApOwogICAgfQoK\nICAgIHByaXZhdGUgQml0U2V0IGV4Y2x1ZGVJbnZlcnNlUmVsYXRpb24oQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5m\nbywgQml0U2V0IGV4Y2x1ZGUpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgaW52\nZXJzZSA9IGluZm8ucmVzdWx0LmdldE1hcHBlZEJ5RmllbGRNYXBwaW5nKCk7\nCiAgICAgICAgaWYgKGludmVyc2UgIT0gbnVsbCkgewogICAgICAgICAgICBG\naWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1h\ncHBpbmdzKCk7CiAgICAgICAgICAgIGlmIChleGNsdWRlID09IG51bGwpCiAg\nICAgICAgICAgICAgICBleGNsdWRlID0gbmV3IEJpdFNldChmbXMubGVuZ3Ro\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gaW52ZXJz\nZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGUuc2V0KGZtc1tpXS5n\nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZXhjbHVkZTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhl\nIGdpdmVuIHN0YXRlIG1hbmFnZXIgd2l0aCBkYXRhIGZyb20gdGhlIHJlc3Vs\ndCBzZXQuIE9ubHkKICAgICAqIG1hcHBpbmdzIG9yaWdpbmFsbHkgc2VsZWN0\nZWQgd2lsbCBiZSBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBs\nb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJl\nc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEZpZWxk\nTWFwcGluZyBlYWdlclRvTWFueSA9IGxvYWQobWFwcGluZywgc20sIGZldGNo\nLCByZXMsIG51bGwpOwogICAgICAgIGlmIChlYWdlclRvTWFueSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoIkxvYWRpbmcgZWFnZXIgdG9N\nYW55OiAiK2VhZ2VyVG9NYW55LmdldE5hbWUoKSsiIGZvciAiK21hcHBpbmcp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVhZ2VyVG9NYW55LmxvYWRF\nYWdlckpvaW4oc20sIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhlYWdlclRv\nTWFueSksCiAgICAgICAgICAgICAgICByZXMpOwogICAgICAgIH0KICAgICAg\nICBpZiAoX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2NraW5n\nKCkpCiAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAg\nfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBnaXZl\nbiBtYXBwaW5nLiBSZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQKICAg\nICAqIHdpdGhvdXQgbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBG\naWVsZE1hcHBpbmcgbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBSZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01h\nbnkpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykpCiAg\nICAgICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8gbG9h\nZCBzdXBlcmNsYXNzIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lvbgog\nICAgICAgIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJlbnQg\nIT0gbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBhcmVu\ndCwgc20sIGZldGNoLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBlbHNl\nIGlmIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgbWFw\ncGluZy5nZXRWZXJzaW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAgICAg\nICAgLy8gbG9hZCB1bmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgT2JqZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoZm1zW2ldLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRlZCgp\nLmdldChmbXNbaV0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBl\nYWdlciByZXN1bHQsIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFyZCBs\nb2FkCiAgICAgICAgICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ldKTsK\nICAgICAgICAgICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0gcmVz\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09IG51\nbGwgJiYgZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmbXNb\naV0ubG9hZEVhZ2VySm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAg\nICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdlclBh\ncmFsbGVsKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gu\ndHJhdmVyc2VKREJDKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChwcm9jZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAgICAg\nICAgICAgcmVzLnB1dEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVh\nbiBsYXp5RW1iZWRkYWJsZSA9IGZtc1tpXS5nZXRWYWx1ZU1hcHBpbmcoKS5p\nc0VtYmVkZGVkKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgZm1zW2ld\nLmdldEVtYmVkZGVkTWV0YURhdGEoKSAhPSBudWxsICYmIAogICAgICAgICAg\nICAgICAgICAgICAgICBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tpXSkgPT0g\nRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX05PTkU7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKCFsYXp5RW1iZWRkYWJsZSkgICAgCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtc1tpXS5sb2FkKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHJlcy5lbmREYXRh\nUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvciBp\nbXBsZW1lbnRhdGlvbiB1c2Ugb25seS4KICAgICAqIFJldHVybiBhIHNlbGVj\ndCBmb3IgdGhlIHByb3BlciBtYXBwaW5ncy4gUmV0dXJuIG51bGwgaWYgbm8g\nc2VsZWN0IGlzCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRob2QgaXMgZGVzaWdu\nZWQgdG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGUgbG9hZCBtZXRob2RzLgog\nICAgICoKICAgICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRvIGJ1aWxkIG9uCiAg\nICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBmb3IgdGhlIGJhc2Ug\ndHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gc3VicyB3aGV0aGVy\nIHRoZSBzZWxlY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFzc2VzIG9mIHRoZQog\nICAgICogZ2l2ZW4gbWFwcGluZwogICAgICogQHBhcmFtIHNtIHN0YXRlIG1h\nbmFnZXIgaWYgYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9hZGVkIG9yCiAgICAg\nKiBpbml0aWFsaXplZCwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmllbGRz\nIGlmIGEgc3RhdGUgbWFuYWdlciBpcyBiZWluZyBsb2FkZWQsIHRoZSBzZXQg\nb2YKICAgICAqIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9hZGVkIGluIG9yZGVy\nLCBlbHNlIG51bGwKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2ggY29u\nZmlndXJhdGlvbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBmaWVsZHMKICAgICAq\nIG11c3QgYmUgbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNlbGVjdGluZyByZWxh\ndGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciBlYWdlciBmZXRjaCBtb2RlIHRv\nIHVzZQogICAgICogQHBhcmFtIGlkZW50IHdoZXRoZXIgdG8gc2VsZWN0IHBy\naW1hcnkga2V5IGNvbHVtbnMgYXMgZGlzdGluY3QKICAgICAqIGlkZW50aWZp\nZXJzCiAgICAgKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3ZSdyZSBvdXRlci1q\nb2luaW5nIHRvIHRoaXMgdHlwZQogICAgICogQHJldHVybiB0cnVlIGlmIHRo\nZSBzZWxlY3QgaXMgcmVxdWlyZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0IHNlbCwgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyLCBib29sZWFuIGlkZW50\nLCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gYWRkIGNsYXNzIGNvbmRp\ndGlvbnMgc28gdGhhdCB0aGV5J3JlIGNsb25lZCBmb3IgYW55IGJhdGNoZWQg\nc2VsZWN0cwogICAgICAgIGJvb2xlYW4gam9pbmVkU3VwZXJzID0gZmFsc2U7\nICAgIAogICAgICAgIGlmKG5lZWRDbGFzc0NvbmRpdGlvbihtYXBwaW5nLCBz\ndWJzLCBzbSkpIHsKICAgICAgICAgICAgam9pbmVkU3VwZXJzID0gZ2V0Sm9p\nbmVkU3VwZXJzKHNlbCwgbWFwcGluZywgc3Vicywgb3V0ZXIpOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICAvLyBjcmVhdGUgYWxsIG91ciBlYWdlciBz\nZWxlY3RzIHNvIHRoYXQgdGhvc2UgZmllbGRzIGFyZSByZXNlcnZlZAogICAg\nICAgIC8vIGFuZCBjYW5ub3QgYmUgcmV1c2VkIGR1cmluZyB0aGUgYWN0dWFs\nIGVhZ2VyIHNlbGVjdCBwcm9jZXNzLAogICAgICAgIC8vIHByZXZlbnRpbmcg\naW5maW5pdGUgcmVjdXJzaW9uCiAgICAgICAgZWFnZXIgPSBNYXRoLm1pbihl\nYWdlciwgZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUoKSk7CiAgICAgICAgRmll\nbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNl\nbCwgbWFwcGluZywgc20sIGZpZWxkcywKICAgICAgICAgICAgZmV0Y2gsIGVh\nZ2VyKTsKCiAgICAgICAgLy8gc2VsZWN0IGFsbCBiYXNlIGNsYXNzIG1hcHBp\nbmdzOyBkbyB0aGlzIGFmdGVyIGJhdGNoaW5nIHNvIHRoYXQKICAgICAgICAv\nLyB0aGUgam9pbnMgbmVlZGVkIGJ5IHRoZXNlIHNlbGVjdHMgZG9uJ3QgZ2V0\nIGluIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICAvLyBvZiB0aGUgYmF0Y2hl\nZCBzZWxlY3RzCiAgICAgICAgaW50IHNlbGQgPSBzZWxlY3RCYXNlTWFwcGlu\nZ3Moc2VsLCBtYXBwaW5nLCBtYXBwaW5nLCBzbSwgZmllbGRzLAogICAgICAg\nICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVk\nU3VwZXJzKTsKCiAgICAgICAgLy8gc2VsZWN0IGVhZ2VyIHRvLW1hbnkgcmVs\nYXRpb25zIGxhc3QgYmVjYXVzZSBkdXJpbmcgbG9hZCB0aGV5CiAgICAgICAg\nLy8gYWR2YW5jZSB0aGUgcmVzdWx0IHNldCBhbmQgY291bGQgZXhoYXVzdCBp\ndCwgc28gbm8gb3RoZXIgbWFwcGluZ3MKICAgICAgICAvLyBjYW4gbG9hZCBh\nZnRlcndvcmRzCiAgICAgICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51bGwpCiAg\nICAgICAgICAgIGVhZ2VyVG9NYW55LnNlbGVjdEVhZ2VySm9pbihzZWwsIHNt\nLCB0aGlzLCAKICAgICAgICAgICAgICAgIGZldGNoLnRyYXZlcnNlSkRCQyhl\nYWdlclRvTWFueSksIGVhZ2VyKTsKCiAgICAgICAgLy8gb3B0aW9uYWxseSBz\nZWxlY3Qgc3ViY2xhc3MgbWFwcGluZ3MKICAgICAgICBpZiAoc3VicyA9PSBT\nZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5TVUJTX0FO\nWV9KT0lOQUJMRSkKICAgICAgICAgICAgc2VsZWN0U3ViY2xhc3NNYXBwaW5n\ncyhzZWwsIG1hcHBpbmcsIHNtLCBmZXRjaCk7CiAgICAgICAgaWYgKHNtICE9\nIG51bGwpCiAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7CiAg\nICAgICAgcmV0dXJuIHNlbGQgPiAwOwogICAgfQoKICAgIHByaXZhdGUgYm9v\nbGVhbiBnZXRKb2luZWRTdXBlcnMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGludCBzdWJzLCBib29sZWFuIG91dGVyKSB7CiAgICAgICAg\nbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7IAogICAgICAgIEpvaW5zIGpvaW5z\nID0gKG91dGVyKSA/IHNlbC5uZXdPdXRlckpvaW5zKCkgOiBudWxsOwogICAg\nICAgIHJldHVybiBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRDbGFz\nc0NvbmRpdGlvbnMoc2VsLCBzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxF\nLCBqb2lucyk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBuZWVk\nQ2xhc3NDb25kaXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJz\nLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBi\nb29sZWFuIHJldFZhbCA9IGZhbHNlOwogICAgICAgIGlmKHNtID09IG51bGwg\nfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKSB7CiAg\nICAgICAgICAgIGlmKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgfHwg\nc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSB7CiAgICAgICAgICAgICAgICBy\nZXRWYWwgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRv\ncigpICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAmJiBTdXBlcmNsYXNz\nRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzLmlzSW5zdGFuY2UobWFwcGlu\nZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0U3RyYXRlZ3koKSkKICAgICAgICAg\nICAgICAgICAgICAmJiBtYXBwaW5nLmdldE1hcHBpbmdSZXBvc2l0b3J5KCku\nZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTdXBlcmNsYXNzRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5QnlEZWZhdWx0KCkpIHsKICAgICAgICAgICAgICAg\nICAgICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXRWYWw7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogTWFyayB0aGUgZmllbGRzIG9mIHRoaXMg\nbWFwcGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2VyIGZldGNoZXMgY2Fu\nJ3QKICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vyc2l2ZSBzaXR1YXRp\nb25zLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBjcmVhdGVF\nYWdlclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxk\ncywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQg\nZWFnZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8IGVhZ2Vy\nID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxkTWFwcGluZyBlYWdl\nclRvTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIAogICAgICAgICAg\nICBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpLCBz\nbSwgZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNlbC5oYXNFYWdlckpv\naW4oZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAgICAgIGludCBqdHlw\nZTsKICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtb2RlID0gZm1z\nW2ldLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGlmIChtb2Rl\nID09IGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVjdChmbXNbaV0sIHNt\nLCBmaWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRoIGpvaW4gZmlyc3QK\nICAgICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51bGxWYWx1ZSgpID09\nIGZtc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAgICAgICAgICA/IHNl\nbC5FQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsKICAgICAgICAgICAg\naWYgKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwgJiYgIWZtc1tpXS5p\nc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYmIGZtc1tp\nXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gp\nID4gMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2VyQ2xvbmUoZm1zW2ld\nLCBqdHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbiA9IGZldGNo\nLmhhc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAgICAg\nICAgICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBwcmVmZXJyZWQgc2Vs\nZWN0IG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAgICAgICAgICAvLyBo\nYXZlIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRvaW5nIGEgYnktaWQg\nbG9va3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNlIGEgdG8tbWFueSBq\nb2luIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFnZXIKICAgICAgICAg\nICAgLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9uLXJhbmdlZCBzZWxl\nY3RzIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAgICAvLyBoYXZlIGFu\nIGVhZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBpZiAoKGhhc0pvaW4g\nfHwgbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAgICAgICAgICAgICAg\nfHwgKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAhPSBudWxsKSkKICAg\nICAgICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkK\nICAgICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgogICAgICAgICAgICAg\nICAgJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAgICAgICAgICAgICAg\nICYmICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICghc2VsLmlzTFJTKCkK\nICAgICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydEluZGV4KCkgPT0gMCAK\nICAgICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09IExvbmcu\nTUFYX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5zdXBwb3J0\nc1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4gMCkgewog\nICAgICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25lKGZtc1tpXSwganR5\ncGUsIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZWFn\nZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAogICAgICAgICAgICBp\nZiAoZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwKICAgICAgICAgICAg\nICAgICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwgc2Vs\nLkVBR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAgICAgIHRoaXMsIGZl\ndGNoKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5lYWdlckNsb25lKGZt\nc1tpXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAgICAgICAgICAgICAg\nICAgICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpLCBzZWxzKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAg\nIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBmaWVsZCBuZWVk\ncyB0byBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBpbmcgZm0sCiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmaWVs\nZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5nZXQoZm0u\nZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0\nUENTdGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAgICAgICAgICAgICYm\nIHNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmZXRjaC5yZXF1aXJl\nc0ZldGNoKGZtKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9BRDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZmllbGQgbWFwcGlu\nZ3Mgb2YgdGhlIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRzIHN1cGVyY2xhc3Nl\ncy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3QgdG8gdXNl\nCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbW9zdC1kZXJpdmVkIHR5cGUg\ndG8gc2VsZWN0IGZvcgogICAgICogQHBhcmFtIG9yaWcgdGhlIG9yaWdpbmFs\nIG1hcHBpbmcgdHlwZSBzZWxlY3RlZAogICAgICogQHBhcmFtIHNtIHRoZSBp\nbnN0YW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9uZQog\nICAgICogQHBhcmFtIGZpZWxkcyB0aGUgZmllbGRzIHRvIGxvYWQKICAgICAq\nIEBwYXJhbSBmZXRjaCBmZXRjaCBjb25maWd1cmF0aW9uIHRvIHVzZSBmb3Ig\nbG9hZGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciB0aGUgZWFn\nZXIgZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBqb2luZWQgd2hl\ndGhlciB0aGUgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBqb2luZWQgZG93biB0\nbwogICAgICogaXRzIGJhc2UgY2xhc3MKICAgICAqIEByZXR1cm4gJmd0OyAw\nIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYgZGF0YSB3YXMKICAg\nICAqIHNlbGVjdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQsIGFuZCAmbHQ7IDAg\naWYgbm90aGluZyB3YXMgc2VsZWN0ZWQKICAgICAqLwogICAgcHJpdmF0ZSBp\nbnQgc2VsZWN0QmFzZU1hcHBpbmdzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGlu\nZyBtYXBwaW5nLAogICAgICAgIENsYXNzTWFwcGluZyBvcmlnLCBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwgRmllbGRNYXBw\naW5nIGVhZ2VyVG9NYW55LAogICAgICAgIGJvb2xlYW4gaWRlbnQsIGJvb2xl\nYW4gam9pbmVkKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1h\ncHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAg\nICAgaWYgKHBhcmVudCA9PSBudWxsICYmICFtYXBwaW5nLmlzTWFwcGVkKCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoInZpcnR1YWwtbWFwcGluZyIsIG1hcHBpbmcuCiAgICAgICAg\nICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkpKTsKCiAgICAgICAgaW50IHNl\nbGQgPSAtMTsKICAgICAgICBpbnQgcHNlbGQgPSAtMTsKCiAgICAgICAgLy8g\nYmFzZSBjbGFzcyBzZWxlY3RzIHBrcywgZXRjCiAgICAgICAgaWYgKHBhcmVu\ndCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlLCBz\nZWxlY3QgcGtzCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBpZiAoaWRlbnQpCiAgICAgICAgICAgICAgICAgICAgc2Vs\nLnNlbGVjdElkZW50aWZpZXIobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1u\ncygpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICBzZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7\nCiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90IGluaXRpYWxpemVk\nIGFuZCBub3QgZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQogICAgICAgICAgICBp\nZiAoKHNtID09IG51bGwgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRl\nLlRSQU5TSUVOVCAKICAgICAgICAgICAgICAgICYmICghKHNtLmdldE9iamVj\ndElkKCkgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIAogICAgICAgICAgICAgICAg\nfHwgKChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkpLmhhc1N1YmNsYXNz\nZXMoKSkpKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXREaXNjcmlt\naW5hdG9yKCkuc2VsZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAgICAgICBz\nZWxkID0gMTsKCiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlIG9yIG5v\nIHZlcnNpb24sIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAgICAgIGlmICgoc20g\nPT0gbnVsbCB8fCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICYmIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNlbGVjdChzZWwsIG9y\naWcpKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgLy8gcmVjdXJzZSBvbiBwYXJlbnQKICAgICAgICAg\nICAgcHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBwYXJlbnQsIG9y\naWcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBmZXRjaCwgZWFnZXIs\nIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhlIGdpdmVuIGZpZWxk\ncyBzZXQsIG9yIGJhc2VkIG9uIGZldGNoCiAgICAgICAgLy8gY29uZmlndXJh\ndGlvbiBpZiBubyBmaWVsZHMgZ2l2ZW4KICAgICAgICBGaWVsZE1hcHBpbmdb\nXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQgZnNlbGQ7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgLy8gc2tpcCBlYWdlciB0by1tYW55IHNlbGVjdDsg\nd2UgZG8gdGhhdCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcKICAgICAgICAgICAg\nLy8gbWV0aG9kCiAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gZWFnZXJUb01h\nbnkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8v\nIGNoZWNrIGZvciBlYWdlciBzZWxlY3QKICAgICAgICAgICAgZXNlbCA9IHNl\nbC5nZXRFYWdlcihmbXNbaV0pOwogICAgICAgICAgICBpZiAoZXNlbCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZXNlbCA9PSBzZWwpCiAgICAg\nICAgICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VySm9pbihzZWwsIHNt\nLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VK\nREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJhbGxlbChl\nc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZldGNoLnRy\nYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAgICBz\nZWxkID0gTWF0aC5tYXgoMCwgc2VsZCk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAocmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRzLCBmZXRjaCkp\nIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWws\nIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpE\nQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2VsZCA9IE1h\ndGgubWF4KGZzZWxkLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChv\ncHRTZWxlY3QoZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkpIHsKICAgICAgICAg\nICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0aGlzLCAK\nICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwg\nZmV0Y2guRUFHRVJfTk9ORSk7CgogICAgICAgICAgICAgICAgLy8gZG9uJ3Qg\ndXBncmFkZSBzZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVzZSBmaWVsZHMsIHNp\nbmNlCiAgICAgICAgICAgICAgICAvLyB0aGV5J3JlIG5vdCBpbiB0aGUgY2Fs\nY3VsYXRlZCBmaWVsZCBzZXQKICAgICAgICAgICAgICAgIGlmIChmc2VsZCA+\nPSAwICYmIHNlbGQgPCAwKQogICAgICAgICAgICAgICAgICAgIHNlbGQgPSAw\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpbiBjZXJ0\nYWluIGNpcmN1bXN0YW5jZXMgZm9yY2Ugam9pbiB0byBzdXBlcmNsYXNzIHRh\nYmxlIHRvIGF2b2lkCiAgICAgICAgLy8gU1FMIGdlbmVyYXRpb24gZXJyb3Iu\nCiAgICAgICAgaWYgKCBlYWdlclRvTWFueSAhPSBudWxsICYmIHBzZWxkIDwg\nMCAmJiBzZWxkID4gMCAmJiAham9pbmVkCiAgICAgICAgICAgICAgICAmJiBw\nYXJlbnQgIT0gbnVsbCApIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10g\ncGZtcyA9IHBhcmVudC5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBmbXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChwZm1zW2ldID09IGVhZ2VyVG9NYW55\nICkgewogICAgICAgICAgICAgICAgICAgIHBzZWxkID0gMDsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBqb2luIHRvIHBh\ncmVudCB0YWJsZSBpZiB0aGUgcGFyZW50IC8gYW55IGFuY2VzdG9ycyBoYXZl\nIHNlbGVjdGVkCiAgICAgICAgLy8gYW55dGhpbmcKICAgICAgICBpZiAoIWpv\naW5lZCAmJiBwc2VsZCA+PSAwICYmIHBhcmVudC5nZXRUYWJsZSgpICE9IG1h\ncHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgc2VsLndoZXJlKG1hcHBp\nbmcuam9pblN1cGVyY2xhc3Moc2VsLm5ld0pvaW5zKCksIGZhbHNlKSk7Cgog\nICAgICAgIC8vIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1ZQogICAgICAgIHJl\ndHVybiBNYXRoLm1heChwc2VsZCwgc2VsZCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGVuIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNwZWNpYWwgY2FzZSBp\ncyBtYWRlIGZvciBtYXBwaW5ncyB0aGF0IHVzZQogICAgICogMi1wYXJ0IHNl\nbGVjdHMgdGhhdCBhcmVuJ3QgZXhwbGljaXRseSAqbm90KiBpbiB0aGUgZGZn\nIHNvIHRoYXQgdGhleQogICAgICogY2FuIGdldCB0aGVpciBwcmltYXJ5IHRh\nYmxlIGRhdGEuIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0aGF0IHNwZWNpYWwK\nICAgICAqIGNhc2UgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFwcGluZyBmbSwgU2Vs\nZWN0IHNlbCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuICFm\nbS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgJiYgIWZt\nLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpCiAgICAgICAgICAgICYm\nIChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRS\nQU5TSUVOVCAKICAgICAgICAgICAgfHwgIXNtLmdldExvYWRlZCgpLmdldChm\nbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgJiYgZm0uc3VwcG9ydHNTZWxl\nY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIGZldGNoKSA+\nIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZmllbGQgbWFwcGlu\nZ3MgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbiBm\nb3IKICAgICAqIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAg\nKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQogICAgICog\nQHBhcmFtIG1hcHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3ViY2xhc3NlcyB0byBz\nZWxlY3QKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2UgYmVpbmcgc2Vs\nZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJhbSBmZXRj\naCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxlY3Qgc2VsLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAg\nbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFz\nc01hcHBpbmdzKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBpbmdzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHNlbGVjdCBh\nbGwgc3ViY2xhc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZmV0Y2ggY29u\nZmlndXJhdGlvbgogICAgICAgIC8vIGFuZCB3aG9zZSB0YWJsZSBpcyBpbiB0\naGUgbGlzdCBvZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7IHRoaXMKICAgICAg\nICAvLyB3YXkgd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2libGUgd2l0aG91dCBz\nZWxlY3RpbmcgYW55IHRhYmxlcyB0aGF0CiAgICAgICAgLy8gYXJlbid0IHBy\nZXNlbnQgaW4gYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNoZXM7IGEgc3BlY2lh\nbCBjYXNlCiAgICAgICAgLy8gaXMgbWFkZSBmb3IgbWFwcGluZ3MgdGhhdCB1\nc2UgMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAgICAgICAvLyBleHBs\naWNpdGx5ICpub3QqIGluIHRoZSBkZWZhdWx0IHNvIHRoYXQgdGhleSBjYW4g\nZ2V0IHRoZWlyCiAgICAgICAgLy8gcHJpbWFyeSB0YWJsZSBkYXRhCiAgICAg\nICAgRmllbGRNYXBwaW5nW10gZm1zOwogICAgICAgIGJvb2xlYW4gam9pbmVk\nOwogICAgICAgIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0LmpvaW5TeW50YXgg\nIT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTAogICAgICAgICAg\nICAmJiBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBm\nZXRjaC5FQUdFUl9OT05FOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFz\ndWJNYXBwaW5nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHRo\naXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICBmZXRjaCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUg\nc28gdGhhdCBpZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0ZW5kIHdlIGFscmVh\nZHkgaGF2ZQogICAgICAgICAgICBqb2luZWQgPSAhY2FuSm9pbjsKICAgICAg\nICAgICAgZm1zID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVmaW5lZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbXMu\nbGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBp\nbiBvbmUgb2YgY29uZmlndXJlZCBmZXRjaCBncm91cHMKICAgICAgICAgICAg\nCWlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkgIT0gRmV0Y2hDb25m\naWd1cmF0aW9uLkZFVENIX0xPQUQKICAgICAgICAgICAgICAgICAgICAmJiAo\nKCFmbXNbal0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAg\nICAgICAgICAgJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNp\ndCgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZtc1tqXS5zdXBwb3J0c1Nl\nbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhpcywgCiAgICAg\nICAgICAgICAgICAgICAgZmV0Y2gpIDw9IDApKSAKICAgICAgICAgICAgCQlj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBjYW4gam9pbiB0\nbyB0aGUgc3ViY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRlciBjaGFuY2UKICAg\nICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdpbGwgYmUgYWJsZSB0\nbyBzZWxlY3QgaXRzZWxmIHdpdGhvdXQgam9pbnMKICAgICAgICAgICAgICAg\nIGlmICgham9pbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFyayBq\nb2luZWQgd2hldGhlciBvciBub3Qgd2Ugam9pbiwgc28gd2UgZG9uJ3QgaGF2\nZSB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgY29uZGl0aW9ucyBh\nZ2FpbiBmb3IgdGhpcyBzdWJjbGFzcwogICAgICAgICAgICAgICAgICAgIGpv\naW5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsLndoZXJlKGpv\naW5TdWJjbGFzcyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBpbmdzW2ldLCBudWxs\nKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaWYg\nY2FuIHNlbGVjdCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNlbGVjdGVkLCBkbyBp\ndAogICAgICAgICAgICAgICAgaWYgKGZtc1tqXS5zdXBwb3J0c1NlbGVjdChz\nZWwsIHNlbC5UWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywKICAgICAgICAgICAg\nICAgICAgICBmZXRjaCkgPiAwKQogICAgICAgICAgICAgICAgICAgIGZtc1tq\nXS5zZWxlY3Qoc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMo\nZm1zW2pdKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2guRUFHRVJf\nTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJvbSBjbGFzcyB0byBp\ndHMgc3ViY2xhc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwogICAgICogZm9yIG11\nbHRpcGxlIGhvcHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJhc2UgY2xhc3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpvaW5zIGpvaW5TdWJjbGFzcyhT\nZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgYmFzZSwKICAgICAgICBDbGFzc01h\ncHBpbmcgc3ViLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChzdWIgPT0g\nYmFzZSB8fCBzdWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdldFRhYmxlKCkKICAg\nICAgICAgICAgfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdldFRhYmxlKCkpKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gcmVjdXJzZSBm\naXJzdCBzbyB3ZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVkCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKTsKICAgICAgICBqb2lucyA9IGpvaW5TdWJjbGFzcyhzZWwsIGJh\nc2UsIHN1cCwgam9pbnMpOwogICAgICAgIGlmIChqb2lucyA9PSBudWxsKQog\nICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpOwogICAgICAgIHJl\ndHVybiBzdWIuam9pblN1cGVyY2xhc3Moam9pbnMsIHRydWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWFrZXMgc3VyZSBhbGwgc3ViY2xhc3NlcyBvZiB0\naGUgZ2l2ZW4gdHlwZSBhcmUgbG9hZGVkIGluIHRoZSBKVk0uCiAgICAgKiBU\naGlzIGlzIHVzdWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcgbWFw\ncGluZykgewogICAgICAgIERpc2NyaW1pbmF0b3IgZHNjID0gbWFwcGluZy5n\nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGRzYy5nZXRTdWJjbGFz\nc2VzTG9hZGVkKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\naWYgdGhlIHN1YmNsYXNzIGxpc3QgaXMgc2V0LCBubyBuZWVkIHRvIGxvYWQg\nc3VicwogICAgICAgIGlmIChtYXBwaW5nLmdldFJlcG9zaXRvcnkoKS5nZXRQ\nZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAgICAgICAgICBfY3R4Lmdl\ndENsYXNzTG9hZGVyKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgZHNjLnNl\ndFN1YmNsYXNzZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRzYy5sb2Fk\nU3ViY2xhc3Nlcyh0aGlzKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdl\ndFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogTWFrZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlkYXRlIGZvciBjYW5j\nZWxsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZvcmVFeGVj\ndXRlU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9zdG1u\ndHMuYWRkKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0\naGUgc3RhdGVtZW50IGZyb20gdGhlIGNhbmNlbGxhYmxlIHNldC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0YXRlbWVudChTdGF0\nZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLnJlbW92ZShzdG1udCk7\nCiAgICB9CiAgICAKICAgIEZpbmRlclF1ZXJ5SW1wbCBnZXRGaW5kZXIoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIEZpbmRlckNhY2hlIGNhY2hlID0gZ2V0RmluZGVyQ2FjaGUo\nKTsKICAgICAgICByZXR1cm4gY2FjaGUgPT0gbnVsbCAKICAgICAgICAgICAg\nID8gbnVsbCA6IChGaW5kZXJRdWVyeUltcGwpY2FjaGUuZ2V0KG1hcHBpbmcs\nIGZldGNoKTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBjYWNoZUZpbmRlcihD\nbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0RXhlY3V0b3Igc2VsZWN0LCAK\nICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBG\naW5kZXJDYWNoZSBjYWNoZSA9IGdldEZpbmRlckNhY2hlKCk7CiAgICAgICAg\ncmV0dXJuIGNhY2hlICE9IG51bGwgJiYgY2FjaGUuY2FjaGUobWFwcGluZywg\nc2VsZWN0LCBmZXRjaCkgIT0gbnVsbDsKICAgIH0KICAgIAogICAgRmluZGVy\nQ2FjaGUgZ2V0RmluZGVyQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuICgoKEJy\nb2tlckltcGwpZ2V0Q29udGV4dCgpKS5nZXRDYWNoZUZpbmRlclF1ZXJ5KCkp\nCiAgICAgICAgICAgICA/IGdldENvbmZpZ3VyYXRpb24oKS5nZXRGaW5kZXJD\nYWNoZUluc3RhbmNlKCkgOiBudWxsOwogICAgfQoKCiAgICAvKioKICAgICAq\nIENvbm5lY3Rpb24gcmV0dXJuZWQgdG8gY2xpZW50IGNvZGUuIE1ha2VzIHN1\ncmUgaXRzIHdyYXBwZWQgY29ubmVjdGlvbgogICAgICogcmVmIGNvdW50IGlz\nIGRlY3JlbWVudGVkIG9uIGZpbmFsaXplLgogICAgICovCiAgICBwdWJsaWMg\nYWJzdHJhY3Qgc3RhdGljIGNsYXNzIENsaWVudENvbm5lY3Rpb24gZXh0ZW5k\ncwogICAgICAgICAgICBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAg\nIHByaXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CgogICAgICAgIHB1\nYmxpYyBDbGllbnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikgewogICAg\nICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBzdXBlci5jbG9zZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZmluYWxpemUo\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKCFfY2xv\nc2VkKQogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHdyYXBwZXIgdGhhdCBrZWVw\ncyBhbiBpbnRlcm5hbCByZWYgY291bnQgc28gdGhhdCBpdCBrbm93cwogICAg\nICogd2hlbiB0byByZWFsbHkgY2xvc2UuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBhYnN0cmFjdCBjbGFzcyBSZWZDb3VudENvbm5lY3Rpb24gZXh0ZW5kcyBE\nZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUgYm9vbGVh\nbiBfcmV0YWluID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX3JlZnMg\nPSAwOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfZnJlZWQgPSBmYWxzZTsK\nCiAgICAgICAgcHVibGljIFJlZkNvdW50Q29ubmVjdGlvbihDb25uZWN0aW9u\nIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW4oKSB7CiAgICAgICAg\nICAgIHJldHVybiBfcmV0YWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgc2V0UmV0YWluKGJvb2xlYW4gcmV0YWluKSB7CiAgICAgICAgICAg\nIGlmIChfcmV0YWluICYmICFyZXRhaW4gJiYgX3JlZnMgPD0gMCkKICAgICAg\nICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgX3JldGFpbiA9IHJldGFp\nbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlZigpIHsKICAg\nICAgICAgICAgLy8gZG9uJ3QgaGF2ZSB0byBsb2NrOyBjYWxsZWQgZnJvbSBj\nb25uZWN0KCksIHdoaWNoIGlzIGxvY2tlZAogICAgICAgICAgICBfcmVmcysr\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gbG9jayBhdCBicm9r\nZXIgbGV2ZWwgdG8gYXZvaWQgZGVhZGxvY2tzCiAgICAgICAgICAgIF9jdHgu\nbG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3Jl\nZnMtLTsKICAgICAgICAgICAgICAgIGlmIChfcmVmcyA8PSAwICYmICFfcmV0\nYWluKQogICAgICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgICog\nTm9uLXRocmVhZC1zYWZlIG1ldGhvZC4gIEVuc3VyZSBwcm90ZWN0aW9uIGlu\nIHRoZSBjYWxsIHBhdGguLi4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBmcmVlKCkgewogICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBk\nbyBub3QgY2xvc2UgdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbgogICAgICAg\nICAgICAvLyBtdWx0aXBsZSB0aW1lczsgdGhpcyBjb3VsZCBoYXBwZW4gaWYg\nc29tZW9uZSAoZS5nLiwgYW4KICAgICAgICAgICAgLy8gRXh0ZW50KSBob2xk\ncyBhIFJlZkNvbm5lY3Rpb24sIGFuZCB0aGVuIGNsb3NlcyBpdCAoZS5nLiwg\naW4KICAgICAgICAgICAgLy8gdGhlIGZpbmFsaXplcikgYWZ0ZXIgdGhlIFN0\nb3JlTWFuYWdlciBoYXMgYWxyZWFkeSBiZWVuIGNsb3NlZC4KICAgICAgICAg\nICAgaWYgKF9mcmVlZCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZXREZWxlZ2F0ZSgpLmNs\nb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB9CiAgICAgICAgICAgIF9mcmVlZCA9IHRydWU7CiAg\nICAgICAgICAgIF9jb25uID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGJvb2xlYW4gd3Jh\ncCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBD\nb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFN0YXRl\nbWVudEltcGwsIEpEQkNTdG9yZU1hbmFnZXIudGhpcywKICAgICAgICAgICAg\nICAgICAgICBzdXBlci5jcmVhdGVTdGF0ZW1lbnQoZmFsc2UpLCBSZWZDb3Vu\ndENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0\nZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChpbnQgcnNUeXBlLCBpbnQg\ncnNDb25jdXIsCiAgICAgICAgICAgIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNz\nR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFN0YXRlbWVudEltcGwsIEpE\nQkNTdG9yZU1hbmFnZXIudGhpcywKICAgICAgICAgICAgICAgICAgICBzdXBl\nci5jcmVhdGVTdGF0ZW1lbnQocnNUeXBlLCByc0NvbmN1ciwgZmFsc2UpLCBS\nZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChT\ndHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5uZXdJbnN0YW5jZShjYW5jZWxQcmVwYXJlZFN0YXRlbWVu\ndEltcGwsCiAgICAgICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci50\naGlzLCBzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgZmFsc2UpLCBSZWZD\nb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90\nZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJp\nbmcgc3FsLCBpbnQgcnNUeXBlLAogICAgICAgICAgICBpbnQgcnNDb25jdXIs\nIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNl\nCiAgICAgICAgICAgICAgICAoY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBs\nLAogICAgICAgICAgICAgICAgICAgIEpEQkNTdG9yZU1hbmFnZXIudGhpcywg\nc3VwZXIucHJlcGFyZVN0YXRlbWVudChzcWwsIHJzVHlwZSwgcnNDb25jdXIs\nIGZhbHNlKSwKICAgICAgICAgICAgICAgICAgICBSZWZDb3VudENvbm5lY3Rp\nb24udGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3Rh\ndGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVzIGl0c2VsZiBmcm9t\nIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1lbnRzIHNvIHRoYXQg\naXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3QgY2xhc3MgQ2FuY2VsU3RhdGVtZW50IGV4dGVuZHMgRGVsZWdhdGlu\nZ1N0YXRlbWVudCB7CgogICAgICAgIHB1YmxpYyBDYW5jZWxTdGF0ZW1lbnQo\nU3RhdGVtZW50IHN0bW50LCBDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICAg\nICAgc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50\nKHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVu\ndCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoU3RyaW5nIHNxbCwgYm9v\nbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5l\neGVjdXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlz\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3ZlcyBpdHNl\nbGYgZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVtZW50cyBz\nbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIGFic3RyYWN0IGNsYXNzIENhbmNlbFByZXBhcmVkU3RhdGVtZW50IGV4\ndGVuZHMKICAgICAgICAgICAgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50\nIHsKCiAgICAgICAgcHVibGljIENhbmNlbFByZXBhcmVkU3RhdGVtZW50KFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50LCAKICAgICAgICAgICAgQ29ubmVjdGlv\nbiBjb25uKSB7CiAgICAgICAgICAgIHN1cGVyKHN0bW50LCBjb25uKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRl\nU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0\nYXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoYm9vbGVhbiB3\ncmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3Jl\nRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnkod3JhcCk7\nCiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBhZnRl\nckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBpbnRbXSBleGVjdXRlQmF0Y2goKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0\nYXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5leGVjdXRlQmF0Y2goKTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRl\nbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoK\n","encoding":"base64"}

