{"sha":"a741595919941bb9a2530bf357426255058104eb","node_id":"MDQ6QmxvYjIwNjM2NDphNzQxNTk1OTE5OTQxYmI5YTI1MzBiZjM1NzQyNjI1NTA1ODEwNGVi","size":40223,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a741595919941bb9a2530bf357426255058104eb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFi\nYXNlTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRXZlbnRPYmplY3Q7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YXguc3FsLkRhdGFTb3VyY2U7\nCgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlk\nZW50aWZpZXIuTm9ybWFsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5RdWFsaWZpZWREQklkZW50\naWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlm\naWVyLkRCSWRlbnRpZmllci5EQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CgovKioKICogVGhl\nIFNjaGVtYUdlbmVyYXRvciBjcmVhdGVzIHtAbGluayBTY2hlbWF9cyBtYXRj\naGluZyB0aGUgY3VycmVudAogKiBkYXRhYmFzZS4gQWxsIHNjaGVtYXMgYXJl\nIGFkZGVkIHRvIHRoZSBjdXJyZW50IHtAbGluayBTY2hlbWFHcm91cH0uCiAq\nICBOb3RlIHRoYXQgdGFibGVzIHdob3NlIG5hbWUgc3RhcnRzIHdpdGggIk9Q\nRU5KUEFfIiB3aWxsIGJlIG5vdCBiZSBhZGRlZAogKiB0byB0aGUgZGF0YWJh\nc2Ugc2NoZW1hLiBUaGlzIGVuYWJsZXMgdGhlIGNyZWF0aW9uIG9mIHNwZWNp\nYWwgdGFibGVzCiAqIHRoYXQgd2lsbCBuZXZlciBiZSBkcm9wcGVkIGJ5IHRo\nZSB7QGxpbmsgU2NoZW1hVG9vbH0uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hR2VuZXJhdG9yIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYUdlbmVyYXRvci5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBmaW5hbCBEYXRhU291cmNlIF9kczsKICAgIHByaXZhdGUg\nZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwogICAgcHJpdmF0ZSBmaW5hbCBM\nb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgT2JqZWN0W11bXSBfYWxsb3dl\nZDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaW5kZXhlcyA9IHRydWU7CiAgICBw\ncml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX3BrcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3NlcXMgPSB0\ncnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcGVuanBhVGFibGVzID0gdHJ1\nZTsKICAgIHByaXZhdGUgU2NoZW1hR3JvdXAgX2dyb3VwID0gbnVsbDsKCiAg\nICBwcml2YXRlIExpc3Q8TGlzdGVuZXI+IF9saXN0ZW5lcnMgPSBudWxsOwog\nICAgcHJpdmF0ZSBpbnQgX3NjaGVtYU9iamVjdHMgPSAwOwoKICAgIC8qKgog\nICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGNvbmYg\nY29uZmlndXJhdGlvbiBmb3IgY29ubmVjdGluZyB0byB0aGUgZGF0YSBzdG9y\nZQogICAgICovCiAgICBwdWJsaWMgU2NoZW1hR2VuZXJhdG9yKEpEQkNDb25m\naWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICAvLyBub3RlOiB3ZSBjYW5ub3Qg\nYXNzZXJ0IGRldmVsb3BlciBjYXBhYmlsaXRpZXMgaW4gdGhpcyB0b29sIGxp\na2UKICAgICAgICAvLyB3ZSBub3JtYWxseSBkbyBiZWNhdXNlIHRoaXMgY2xh\nc3MgaXMgYWxzbyB1c2VkIGF0IHJ1bnRpbWUKCiAgICAgICAgX2RzID0gY29u\nZi5nZXREYXRhU291cmNlMihudWxsKTsKICAgICAgICBfbG9nID0gY29uZi5n\nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX1NDSEVNQSk7CgogICAgICAg\nIC8vIGNhY2hlIHRoaXMgbm93IHNvIHRoYXQgaWYgdGhlIGNvbm4gcG9vbCBv\nbmx5IGhhcyAxIGNvbm5lY3Rpb24gd2UKICAgICAgICAvLyBkb24ndCBjb25m\nbGljdCBsYXRlciB3aXRoIHRoZSBvcGVuIGRhdGFiYXNlbWV0YWRhdGEgY29u\nbmVjdGlvbgogICAgICAgIF9kaWN0ID0gY29uZi5nZXREQkRpY3Rpb25hcnlJ\nbnN0YW5jZSgpOwoKICAgICAgICAvLyBjcmVhdGUgYSB0YWJsZSBvZiBhbGxv\nd2VkIHNjaGVtYSBhbmQgdGFibGVzIHRvIHJlZmxlY3Qgb24KICAgICAgICBT\ndHJpbmdbXSBzY2hlbWFBcnJheSA9IGNvbmYuZ2V0U2NoZW1hc0xpc3QoKTsK\nICAgICAgICBEQklkZW50aWZpZXJbXSBuYW1lcyA9IG5ldyBEQklkZW50aWZp\nZXJbc2NoZW1hQXJyYXkgPT0gbnVsbCA/IDAgOiBzY2hlbWFBcnJheS5sZW5n\ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbmFtZXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgU3RyaW5nW10gc3BsaXROYW1lID0gTm9y\nbWFsaXplci5zcGxpdE5hbWUoc2NoZW1hQXJyYXlbaV0pOwogICAgICAgICAg\nICBpZiAoc3BsaXROYW1lID09IG51bGwgfHwgc3BsaXROYW1lLmxlbmd0aCA9\nPSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoc3BsaXROYW1lLmxlbmd0aCA9PSAxKSB7CiAg\nICAgICAgICAgICAgICBuYW1lc1tpXSA9IERCSWRlbnRpZmllci5uZXdTY2hl\nbWEoc2NoZW1hQXJyYXlbaV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgbmFtZXNbaV0gPSBRdWFsaWZpZWREQklkZW50aWZpZXIu\nbmV3VGFibGUoc2NoZW1hQXJyYXlbaV0pOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIF9hbGxvd2VkID0gcGFyc2VTY2hlbWFzTGlzdChuYW1l\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHaXZlbiBhIGxpc3Qgb2Ygc2No\nZW1hIG5hbWVzIGFuZCB0YWJsZSBuYW1lcyAod2hlcmUgdGFibGUgbmFtZXMK\nICAgICAqIGFyZSBhbHdheXMgb2YgdGhlIGZvcm0gc2NoZW1hLnRhYmxlLCBv\nciBqdXN0IC50YWJsZSBpZiB0aGUgc2NoZW1hIGlzCiAgICAgKiB1bmtub3du\nKSwgY3JlYXRlcyBhIHRhYmxlIG1hcHBpbmcgc2NoZW1hIG5hbWUgdG8gdGFi\nbGUgbGlzdC4gUmV0dXJucwogICAgICogbnVsbCBpZiBubyBhcmdzIGFyZSBn\naXZlbi4gSWYgbm8gdGFibGVzIGFyZSBnaXZlbiBmb3IgYSBwYXJ0aWN1bGFy\nCiAgICAgKiBzY2hlbWEsIG1hcHMgdGhlIHNjaGVtYSBuYW1lIHRvIG51bGwu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdFtdW10gcGFyc2VT\nY2hlbWFzTGlzdChEQklkZW50aWZpZXJbXSBhcmdzKSB7CiAgICAgICAgaWYg\nKGFyZ3MgPT0gbnVsbCB8fCBhcmdzLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgTWFwPERCSWRlbnRpZmllciwgQ29s\nbGVjdGlvbjxEQklkZW50aWZpZXI+PiBzY2hlbWFzID0gbmV3IEhhc2hNYXA8\nREJJZGVudGlmaWVyLCBDb2xsZWN0aW9uPERCSWRlbnRpZmllcj4+KCk7CiAg\nICAgICAgREJJZGVudGlmaWVyIHNjaGVtYSA9IERCSWRlbnRpZmllci5OVUxM\nLCB0YWJsZSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIENvbGxlY3Rp\nb248REJJZGVudGlmaWVyPiB0YWJsZXMgPSBudWxsOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBRdWFsaWZpZWREQklkZW50aWZpZXIgcGF0aCA9IFF1YWxpZmllZERCSWRl\nbnRpZmllci5nZXRQYXRoKGFyZ3NbaV0pOwogICAgICAgICAgICBzY2hlbWEg\nPSBwYXRoLmdldFNjaGVtYU5hbWUoKTsKICAgICAgICAgICAgdGFibGUgPSBw\nYXRoLmdldElkZW50aWZpZXIoKTsKCiAgICAgICAgICAgIC8vIGlmIGp1c3Qg\nYSBzY2hlbWEgbmFtZSwgbWFwIHNjaGVtYSB0byBudWxsCiAgICAgICAgICAg\nIGlmIChEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlKSAmJiAhc2NoZW1hcy5j\nb250YWluc0tleShzY2hlbWEpKQogICAgICAgICAgICAgICAgc2NoZW1hcy5w\ndXQoc2NoZW1hLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwodGFibGUpKSB7CiAgICAgICAgICAgICAgICB0YWJs\nZXMgPSBzY2hlbWFzLmdldChzY2hlbWEpOwogICAgICAgICAgICAgICAgaWYg\nKHRhYmxlcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGFibGVz\nID0gbmV3IExpbmtlZExpc3Q8REJJZGVudGlmaWVyPigpOwogICAgICAgICAg\nICAgICAgICAgIHNjaGVtYXMucHV0KHNjaGVtYSwgdGFibGVzKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRhYmxlcy5hZGQodGFibGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBPYmplY3RbXVtd\nIHBhcnNlZCA9IG5ldyBPYmplY3Rbc2NoZW1hcy5zaXplKCldWzJdOwogICAg\nICAgIE1hcC5FbnRyeTxEQklkZW50aWZpZXIsIENvbGxlY3Rpb248REJJZGVu\ndGlmaWVyPj4gZW50cnk7CiAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAg\nZm9yIChJdGVyYXRvcjxNYXAuRW50cnk8REJJZGVudGlmaWVyLCBDb2xsZWN0\naW9uPERCSWRlbnRpZmllcj4+PiBpdHIgPSBzY2hlbWFzLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsgCiAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgIGVudHJ5ID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgdGFi\nbGVzID0gZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIHBhcnNlZFtp\nZHhdWzBdID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgIGlmICh0YWJs\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBhcnNlZFtpZHhdWzFdID0g\ndGFibGVzLnRvQXJyYXkobmV3IERCSWRlbnRpZmllclt0YWJsZXMuc2l6ZSgp\nXSk7CiAgICAgICAgICAgIGlkeCsrOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcGFyc2VkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgaW5kZXhlcyBzaG91bGQgYmUgZ2VuZXJhdGVkLiBEZWZhdWx0cyB0byB0\ncnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJbmRleGVzKCkg\newogICAgICAgIHJldHVybiBfaW5kZXhlczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB3aGV0aGVyIGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVyYXRlZC4g\nRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nSW5kZXhlcyhib29sZWFuIGluZGV4ZXMpIHsKICAgICAgICBfaW5kZXhlcyA9\nIGluZGV4ZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhl\nciBmb3JlaWduIGtleXMgc2hvdWxkIGJlIGdlbmVyYXRlZC4gRGVmYXVsdHMg\ndG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Rm9yZWln\nbktleXMoKSB7CiAgICAgICAgcmV0dXJuIF9ma3M7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgd2hldGhlciBmb3JlaWduIGtleXMgc2hvdWxkIGJlIGdl\nbmVyYXRlZC4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Rm9yZWlnbktleXMoYm9vbGVhbiBma3MpIHsKICAgICAgICBf\nZmtzID0gZmtzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgcHJpbWFyeSBrZXlzIHNob3VsZCBiZSBnZW5lcmF0ZWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFByaW1h\ncnlLZXlzKCkgewogICAgICAgIHJldHVybiBfcGtzOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHdoZXRoZXIgcHJpbWFyeSBrZXlzIHNob3VsZCBiZSBn\nZW5lcmF0ZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFByaW1hcnlLZXlzKGJvb2xlYW4gcGtzKSB7CiAgICAgICAg\nX3BrcyA9IHBrczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgZ2VuZXJhdGVkLiBEZWZhdWx0cyB0\nbyB0cnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTZXF1ZW5j\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zZXFzOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHdoZXRoZXIgc2VxdWVuY2VzIHNob3VsZCBiZSBnZW5lcmF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9\nIHNlcXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVy\nYXRlIGluZm8gb24gc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNv\nbXBvbmVudHMKICAgICAqIGZvciBib29ra2VlcGluZy4gRGVmYXVsdHMgdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0T3BlbkpQQVRh\nYmxlcygpIHsKICAgICAgICByZXR1cm4gX29wZW5qcGFUYWJsZXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIGluZm8gb24g\nc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNvbXBvbmVudHMKICAg\nICAqIGZvciBib29ra2VlcGluZy4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0T3BlbkpQQVRhYmxlcyhib29sZWFuIG9w\nZW5qcGFUYWJsZXMpIHsKICAgICAgICBfb3BlbmpwYVRhYmxlcyA9IG9wZW5q\ncGFUYWJsZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGN1\ncnJlbnQgc2NoZW1hIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgU2NoZW1h\nR3JvdXAgZ2V0U2NoZW1hR3JvdXAoKSB7CiAgICAgICAgaWYgKF9ncm91cCA9\nPSBudWxsKQogICAgICAgICAgICBfZ3JvdXAgPSBuZXcgU2NoZW1hR3JvdXAo\nKTsKICAgICAgICByZXR1cm4gX2dyb3VwOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBzY2hlbWEgZ3JvdXAgdG8gYWRkIGdlbmVyYXRlZCBzY2hl\nbWFzIHRvLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTY2hlbWFHcm91\ncChTY2hlbWFHcm91cCBncm91cCkgewogICAgICAgIF9ncm91cCA9IGdyb3Vw\nOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYWxsIHNjaGVtYXMg\nc2V0IGluIHRoZSBjb25maWd1cmF0aW9uLiBUaGlzIG1ldGhvZCBhbHNvCiAg\nICAgKiBjYWxscyB7QGxpbmsgI2dlbmVyYXRlSW5kZXhlc30sIHtAbGluayAj\nZ2VuZXJhdGVQcmltYXJ5S2V5c30sIGFuZAogICAgICoge0BsaW5rICNnZW5l\ncmF0ZUZvcmVpZ25LZXlzfSBhdXRvbWF0aWNhbGx5LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBnZW5lcmF0ZVNjaGVtYXMoKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xv\nYy5nZXQoImdlbmVyYXRpbmctc2NoZW1hcyIpKTsKICAgICAgICBnZW5lcmF0\nZVNjaGVtYXMoKERCSWRlbnRpZmllcltdKW51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZvaWQg\nZ2VuZXJhdGVTY2hlbWFzKFN0cmluZ1tdIHNjaGVtYXNBbmRUYWJsZXMpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7ICAgICAgICAKICAgICAgICBn\nZW5lcmF0ZVNjaGVtYXMoREJJZGVudGlmaWVyLnRvQXJyYXkoc2NoZW1hc0Fu\nZFRhYmxlcywgREJJZGVudGlmaWVyVHlwZS5UQUJMRSkpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBzY2hlbWFzIGFuZC9vciB0\nYWJsZXMgbmFtZWQgaW4gdGhlIGdpdmVuIHN0cmluZ3MuCiAgICAgKiBUaGlz\nIG1ldGhvZCBjYWxscyB7QGxpbmsgI2dlbmVyYXRlSW5kZXhlc30sCiAgICAg\nKiB7QGxpbmsgI2dlbmVyYXRlUHJpbWFyeUtleXN9LCBhbmQge0BsaW5rICNn\nZW5lcmF0ZUZvcmVpZ25LZXlzfQogICAgICogYXV0b21hdGljYWxseS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgZ2VuZXJhdGVTY2hlbWFzKERCSWRlbnRp\nZmllcltdIHNjaGVtYXNBbmRUYWJsZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdl\ndCgiZ2VuZXJhdGluZy1zY2hlbWFzIikpOwoKICAgICAgICBPYmplY3RbXVtd\nIHNjaGVtYU1hcDsKICAgICAgICBpZiAoc2NoZW1hc0FuZFRhYmxlcyA9PSBu\ndWxsIHx8IHNjaGVtYXNBbmRUYWJsZXMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHNjaGVtYU1hcCA9IF9hbGxvd2VkOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc2NoZW1hTWFwID0gcGFyc2VTY2hlbWFzTGlzdChzY2hlbWFzQW5k\nVGFibGVzKTsKCiAgICAgICAgaWYgKHNjaGVtYU1hcCA9PSBudWxsKSB7CiAg\nICAgICAgICAgIGdlbmVyYXRlU2NoZW1hKERCSWRlbnRpZmllci5OVUxMLCAo\nREJJZGVudGlmaWVyW10pbnVsbCk7CgogICAgICAgICAgICAvLyBlc3RpbWF0\nZSB0aGUgbnVtYmVyIG9mIHNjaGVtYSBvYmplY3RzIHdlIHdpbGwgbmVlZCB0\nbyB2aXNpdAogICAgICAgICAgICAvLyBpbiBvcmRlciB0byBlc3RpbWF0ZSBw\ncm9ncmVzcyB0b3RhbCBmb3IgYW55IGxpc3RlbmVycwogICAgICAgICAgICBp\nbnQgbnVtVGFibGVzID0gZ2V0VGFibGVzKG51bGwpLnNpemUoKTsKICAgICAg\nICAgICAgX3NjaGVtYU9iamVjdHMgKz0gbnVtVGFibGVzCiAgICAgICAgICAg\nICAgICArIChfcGtzID8gbnVtVGFibGVzIDogMCkKICAgICAgICAgICAgICAg\nICsgKF9pbmRleGVzID8gbnVtVGFibGVzIDogMCkKICAgICAgICAgICAgICAg\nICsgKF9ma3MgPyBudW1UYWJsZXMgOiAwKTsKCiAgICAgICAgICAgIGlmIChf\ncGtzKQogICAgICAgICAgICAgICAgZ2VuZXJhdGVQcmltYXJ5S2V5cyhEQklk\nZW50aWZpZXIuTlVMTCwgbnVsbCk7CiAgICAgICAgICAgIGlmIChfaW5kZXhl\ncykKICAgICAgICAgICAgICAgIGdlbmVyYXRlSW5kZXhlcyhEQklkZW50aWZp\nZXIuTlVMTCwgbnVsbCk7CiAgICAgICAgICAgIGlmIChfZmtzKQogICAgICAg\nICAgICAgICAgZ2VuZXJhdGVGb3JlaWduS2V5cyhEQklkZW50aWZpZXIuTlVM\nTCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIC8vIGdlbmVyYXRlIGFsbCBzY2hlbWFzIGFuZCB0YWJsZXMKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYU1hcC5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgZ2VuZXJhdGVTY2hlbWEoKERCSWRlbnRpZmllcikgc2No\nZW1hTWFwW2ldWzBdLAogICAgICAgICAgICAgICAgKERCSWRlbnRpZmllcltd\nKSBzY2hlbWFNYXBbaV1bMV0pOwoKICAgICAgICAvLyBnZW5lcmF0ZSBwa3Ms\nIGluZGV4ZXMsIGZrcwogICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFOYW1l\nID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgREJJZGVudGlmaWVyW10g\ndGFibGVOYW1lczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVt\nYU1hcC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzY2hlbWFOYW1lID0g\nKERCSWRlbnRpZmllcikgc2NoZW1hTWFwW2ldWzBdOwogICAgICAgICAgICB0\nYWJsZU5hbWVzID0gKERCSWRlbnRpZmllcltdKSBzY2hlbWFNYXBbaV1bMV07\nCgogICAgICAgICAgICAvLyBlc3RpbWF0ZSB0aGUgbnVtYmVyIG9mIHNjaGVt\nYSBvYmplY3RzIHdlIHdpbGwgbmVlZCB0byB2aXNpdAogICAgICAgICAgICAv\nLyBpbiBvcmRlciB0byBlc3RpbWF0ZSBwcm9ncmVzcyB0b3RhbCBmb3IgYW55\nIGxpc3RlbmVycwogICAgICAgICAgICBpbnQgbnVtVGFibGVzID0gKHRhYmxl\nTmFtZXMgIT0gbnVsbCkgPyB0YWJsZU5hbWVzLmxlbmd0aAogICAgICAgICAg\nICAgICAgOiBnZXRUYWJsZXMoc2NoZW1hTmFtZSkuc2l6ZSgpOwogICAgICAg\nICAgICBfc2NoZW1hT2JqZWN0cyArPSBudW1UYWJsZXMKICAgICAgICAgICAg\nICAgICsgKF9wa3MgPyBudW1UYWJsZXMgOiAwKQogICAgICAgICAgICAgICAg\nKyAoX2luZGV4ZXMgPyBudW1UYWJsZXMgOiAwKQogICAgICAgICAgICAgICAg\nKyAoX2ZrcyA/IG51bVRhYmxlcyA6IDApOwoKICAgICAgICAgICAgaWYgKF9w\na3MpCiAgICAgICAgICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKHNjaGVt\nYU5hbWUsIHRhYmxlTmFtZXMpOwogICAgICAgICAgICBpZiAoX2luZGV4ZXMp\nCiAgICAgICAgICAgICAgICBnZW5lcmF0ZUluZGV4ZXMoc2NoZW1hTmFtZSwg\ndGFibGVOYW1lcyk7CiAgICAgICAgICAgIGlmIChfZmtzKQogICAgICAgICAg\nICAgICAgZ2VuZXJhdGVGb3JlaWduS2V5cyhzY2hlbWFOYW1lLCB0YWJsZU5h\nbWVzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0g\nbmFtZQogICAgICogQHBhcmFtIHRhYmxlTmFtZXMKICAgICAqIEBkZXByZWNh\ndGVkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlU2NoZW1hKFN0\ncmluZyBuYW1lLCBTdHJpbmdbXSB0YWJsZU5hbWVzKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlU2NoZW1hKERCSWRl\nbnRpZmllci5uZXdTY2hlbWEobmFtZSksCiAgICAgICAgICAgIERCSWRlbnRp\nZmllci50b0FycmF5KHRhYmxlTmFtZXMsIERCSWRlbnRpZmllclR5cGUuVEFC\nTEUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIGZ1bGx5LWNvbnN0\ncnVjdGVkIHtAbGluayBTY2hlbWF9IG1hdGNoaW5nIHRoZSBnaXZlbiBkYXRh\nYmFzZQogICAgICogc2NoZW1hIHRvIHRoZSBjdXJyZW50IGdyb3VwLiBObyBm\nb3JlaWduIGtleXMgYXJlIGdlbmVyYXRlZCBiZWNhdXNlCiAgICAgKiBzb21l\nIGtleXMgbWlnaHQgc3BhbiBzY2hlbWFzLiBZb3UgbXVzdCBjYWxsCiAgICAg\nKiB7QGxpbmsgI2dlbmVyYXRlUHJpbWFyeUtleXN9LCB7QGxpbmsgI2dlbmVy\nYXRlSW5kZXhlc30sIGFuZAogICAgICoge0BsaW5rICNnZW5lcmF0ZUZvcmVp\nZ25LZXlzfSBzZXBhcmF0ZWx5LgogICAgICoKICAgICAqIEBwYXJhbSBuYW1l\nIHRoZSBkYXRhYmFzZSBuYW1lIG9mIHRoZSBzY2hlbWEsIG9yIG51bGwgZm9y\nIGFsbCBzY2hlbWFzCiAgICAgKiBAcGFyYW0gdGFibGVOYW1lcyBhIGxpc3Qg\nb2YgdGFibGVzIHRvIGdlbmVyYXRlIGluIHRoZSBzY2hlbWEsIG9yIG51bGwK\nICAgICAqIHRvIGdlbmVyYXRlIGFsbCB0YWJsZXMKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgZ2VuZXJhdGVTY2hlbWEoREJJZGVudGlmaWVyIG5hbWUsIERC\nSWRlbnRpZmllcltdIHRhYmxlTmFtZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdl\ndCgiZ2VuZXJhdGluZy1zY2hlbWEiLCBuYW1lKSk7CgogICAgICAgIC8vIGdl\nbmVyYXRlIHRhYmxlcywgaW5jbHVkaW5nIGNvbHVtbnMgYW5kIHByaW1hcnkg\na2V5cwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9IF9kcy5nZXRDb25uZWN0\naW9uKCk7CiAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRhID0gY29ubi5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0\nYWJsZU5hbWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBnZW5lcmF0ZVRh\nYmxlcyhuYW1lLCBEQklkZW50aWZpZXIuTlVMTCwgY29ubiwgbWV0YSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgdGFibGVOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nICAgICBnZW5lcmF0ZVRhYmxlcyhuYW1lLCB0YWJsZU5hbWVzW2ldLCBjb25u\nLCBtZXRhKTsKCiAgICAgICAgICAgIGlmIChfc2VxcykKICAgICAgICAgICAg\nICAgIGdlbmVyYXRlU2VxdWVuY2VzKG5hbWUsIERCSWRlbnRpZmllci5OVUxM\nLCBjb25uLCBtZXRhKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAvLyBzb21lIGRhdGFiYXNlcyByZXF1aXJlIGEgY29tbWl0IGFmdGVyIG1l\ndGFkYXRhIHRvIHJlbGVhc2UgbG9ja3MKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGNvbm4uY29tbWl0KCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUg\ncHJpbWFyeSBrZXkgaW5mb3JtYXRpb24gZm9yIHRoZSBnaXZlbiBzY2hlbWEu\nIFRoaXMgbWV0aG9kCiAgICAgKiBtdXN0IGJlIGNhbGxlZCBpbiBhZGRpdGlv\nbiB0byB7QGxpbmsgI2dlbmVyYXRlU2NoZW1hfS4gSXQgc2hvdWxkCiAgICAg\nKiBvbmx5IGJlIGNhbGxlZCBhZnRlciBhbGwgc2NoZW1hcyBhcmUgZ2VuZXJh\ndGVkLiBUaGUgc2NoZW1hIG5hbWUgYW5kCiAgICAgKiB0YWJsZXMgYXJyYXkg\nY2FuIGJlIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBpbmRleGVzIHNob3VsZCBi\nZSBnZW5lcmF0ZWQKICAgICAqIGZvciBhbGwgc2NoZW1hcyBhbmQvb3IgdGFi\nbGVzLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZv\naWQgZ2VuZXJhdGVQcmltYXJ5S2V5cyhTdHJpbmcgc2NoZW1hTmFtZSwgU3Ry\naW5nW10gdGFibGVOYW1lcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKERCSWRlbnRpZmllci5u\nZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmll\nci50b0FycmF5KHRhYmxlTmFtZXMsIERCSWRlbnRpZmllclR5cGUuVEFCTEUp\nKTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogR2VuZXJhdGUgcHJpbWFy\neSBrZXkgaW5mb3JtYXRpb24gZm9yIHRoZSBnaXZlbiBzY2hlbWEuIFRoaXMg\nbWV0aG9kCiAgICAgKiBtdXN0IGJlIGNhbGxlZCBpbiBhZGRpdGlvbiB0byB7\nQGxpbmsgI2dlbmVyYXRlU2NoZW1hfS4gSXQgc2hvdWxkCiAgICAgKiBvbmx5\nIGJlIGNhbGxlZCBhZnRlciBhbGwgc2NoZW1hcyBhcmUgZ2VuZXJhdGVkLiBU\naGUgc2NoZW1hIG5hbWUgYW5kCiAgICAgKiB0YWJsZXMgYXJyYXkgY2FuIGJl\nIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBpbmRleGVzIHNob3VsZCBiZSBnZW5l\ncmF0ZWQKICAgICAqIGZvciBhbGwgc2NoZW1hcyBhbmQvb3IgdGFibGVzLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZVByaW1hcnlLZXlzKERC\nSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXJbXSB0YWJsZU5h\nbWVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGZp\ncmVHZW5lcmF0aW9uRXZlbnQoX2xvYy5nZXQoImdlbmVyYXRpbmctYWxsLXBy\naW1hcmllcyIsIHNjaGVtYU5hbWUpKTsKCiAgICAgICAgQ29ubmVjdGlvbiBj\nb25uID0gX2RzLmdldENvbm5lY3Rpb24oKTsKICAgICAgICBEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEgPSBjb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKHRhYmxlTmFtZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGdlbmVyYXRlUHJpbWFyeUtleXMoc2NoZW1hTmFtZSwgbnVs\nbCwgY29ubiwgbWV0YSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGFibGVOYW1lcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKHNj\naGVtYU5hbWUsIHRhYmxlTmFtZXNbaV0sIGNvbm4sIG1ldGEpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIC8vIHNvbWUgZGF0YWJhc2VzIHJl\ncXVpcmUgYSBjb21taXQgYWZ0ZXIgbWV0YWRhdGEgdG8gcmVsZWFzZSBsb2Nr\ncwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29ubi5jb21t\naXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBpbmRleCBpbmZvcm1hdGlvbiBmb3Ig\ndGhlIGdpdmVuIHNjaGVtYS4gVGhpcyBtZXRob2QKICAgICAqIG11c3QgYmUg\nY2FsbGVkIGluIGFkZGl0aW9uIHRvIHtAbGluayAjZ2VuZXJhdGVTY2hlbWF9\nLiBJdCBzaG91bGQKICAgICAqIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFsbCBz\nY2hlbWFzIGFyZSBnZW5lcmF0ZWQuIFRoZSBzY2hlbWEgbmFtZSBhbmQKICAg\nICAqIHRhYmxlcyBhcnJheSBjYW4gYmUgbnVsbCB0byBpbmRpY2F0ZSB0aGF0\nIGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVyYXRlZAogICAgICogZm9yIGFsbCBz\nY2hlbWFzIGFuZC9vciB0YWJsZXMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZUluZGV4ZXMoU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZ1tdIHRhYmxlTmFtZXMpIAogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlSW5kZXhlcyhEQklk\nZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLAogICAgICAgICAgICBE\nQklkZW50aWZpZXIudG9BcnJheSh0YWJsZU5hbWVzLCBEQklkZW50aWZpZXJU\neXBlLlRBQkxFKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBp\nbmRleCBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIHNjaGVtYS4gVGhpcyBt\nZXRob2QKICAgICAqIG11c3QgYmUgY2FsbGVkIGluIGFkZGl0aW9uIHRvIHtA\nbGluayAjZ2VuZXJhdGVTY2hlbWF9LiBJdCBzaG91bGQKICAgICAqIG9ubHkg\nYmUgY2FsbGVkIGFmdGVyIGFsbCBzY2hlbWFzIGFyZSBnZW5lcmF0ZWQuIFRo\nZSBzY2hlbWEgbmFtZSBhbmQKICAgICAqIHRhYmxlcyBhcnJheSBjYW4gYmUg\nbnVsbCB0byBpbmRpY2F0ZSB0aGF0IGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVy\nYXRlZAogICAgICogZm9yIGFsbCBzY2hlbWFzIGFuZC9vciB0YWJsZXMuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlSW5kZXhlcyhEQklkZW50\naWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyW10gdGFibGVOYW1lcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmaXJlR2Vu\nZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5lcmF0aW5nLWFsbC1pbmRleGVz\nIiwgc2NoZW1hTmFtZSkpOwoKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBf\nZHMuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIERhdGFiYXNlTWV0YURhdGEg\nbWV0YSA9IGNvbm4uZ2V0TWV0YURhdGEoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAodGFibGVOYW1lcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgZ2VuZXJhdGVJbmRleGVzKHNjaGVtYU5hbWUsIG51bGwsIGNvbm4sIG1l\ndGEpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHRhYmxlTmFtZXMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICAgICAgZ2VuZXJhdGVJbmRleGVzKHNjaGVtYU5hbWUsIHRhYmxl\nTmFtZXNbaV0sIGNvbm4sIG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIC8vIHNvbWUgZGF0YWJhc2VzIHJlcXVpcmUgYSBjb21taXQg\nYWZ0ZXIgbWV0YWRhdGEgdG8gcmVsZWFzZSBsb2NrcwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgY29ubi5jb21taXQoKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2Uo\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZW5lcmF0ZSBmb3JlaWduIGtleSBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVu\nIHNjaGVtYS4gVGhpcyBtZXRob2QKICAgICAqIG11c3QgYmUgY2FsbGVkIGlu\nIGFkZGl0aW9uIHRvIHtAbGluayAjZ2VuZXJhdGVTY2hlbWF9LiBJdCBzaG91\nbGQKICAgICAqIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFsbCBzY2hlbWFzIGFy\nZSBnZW5lcmF0ZWQuIFRoZSBzY2hlbWEgbmFtZSBhbmQKICAgICAqIHRhYmxl\ncyBhcnJheSBjYW4gYmUgbnVsbCB0byBpbmRpY2F0ZSB0aGF0IGluZGV4ZXMg\nc2hvdWxkIGJlIGdlbmVyYXRlZAogICAgICogZm9yIGFsbCBzY2hlbWFzIGFu\nZC9vciB0YWJsZXMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBnZW5lcmF0ZUZvcmVpZ25LZXlzKFN0cmluZyBzY2hlbWFO\nYW1lLCBTdHJpbmdbXSB0YWJsZU5hbWVzKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlRm9yZWlnbktleXMoREJJZGVu\ndGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgREJJ\nZGVudGlmaWVyLnRvQXJyYXkodGFibGVOYW1lcywgREJJZGVudGlmaWVyVHlw\nZS5UQUJMRSkpOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSBmb3JlaWduIGtleSBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIHNjaGVt\nYS4gVGhpcyBtZXRob2QKICAgICAqIG11c3QgYmUgY2FsbGVkIGluIGFkZGl0\naW9uIHRvIHtAbGluayAjZ2VuZXJhdGVTY2hlbWF9LiBJdCBzaG91bGQKICAg\nICAqIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFsbCBzY2hlbWFzIGFyZSBnZW5l\ncmF0ZWQuIFRoZSBzY2hlbWEgbmFtZSBhbmQKICAgICAqIHRhYmxlcyBhcnJh\neSBjYW4gYmUgbnVsbCB0byBpbmRpY2F0ZSB0aGF0IGluZGV4ZXMgc2hvdWxk\nIGJlIGdlbmVyYXRlZAogICAgICogZm9yIGFsbCBzY2hlbWFzIGFuZC9vciB0\nYWJsZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlRm9yZWln\nbktleXMoREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmllcltd\nIHRhYmxlTmFtZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdldCgiZ2VuZXJhdGlu\nZy1hbGwtZm9yZWlnbnMiLCBzY2hlbWFOYW1lKSk7CgogICAgICAgIENvbm5l\nY3Rpb24gY29ubiA9IF9kcy5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgRGF0\nYWJhc2VNZXRhRGF0YSBtZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0YWJsZU5hbWVzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBnZW5lcmF0ZUZvcmVpZ25LZXlzKHNjaGVtYU5h\nbWUsIG51bGwsIGNvbm4sIG1ldGEpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRhYmxlTmFtZXMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVGb3JlaWdu\nS2V5cyhzY2hlbWFOYW1lLCB0YWJsZU5hbWVzW2ldLCBjb25uLCBtZXRhKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyBzb21lIGRhdGFi\nYXNlcyByZXF1aXJlIGEgY29tbWl0IGFmdGVyIG1ldGFkYXRhIHRvIHJlbGVh\nc2UgbG9ja3MKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNv\nbm4uY29tbWl0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBjb25uLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAg\ncHVibGljIHZvaWQgZ2VuZXJhdGVUYWJsZXMoU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyB0YWJsZU5hbWUsCiAgICAgICAgQ29ubmVjdGlvbiBjb25uLCBE\nYXRhYmFzZU1ldGFEYXRhIG1ldGEpIAogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGdlbmVyYXRlVGFibGVzKERCSWRlbnRpZmllci5u\nZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmll\nci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25uLCBtZXRhKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgYWxsIHRhYmxlcyBtYXRjaGluZyB0aGUgZ2l2\nZW4gbmFtZSBwYXR0ZXJuIHRvIHRoZSBzY2hlbWEuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGdlbmVyYXRlVGFibGVzKERCSWRlbnRpZmllciBzY2hlbWFO\nYW1lLCBEQklkZW50aWZpZXIgdGFibGVOYW1lLAogICAgICAgIENvbm5lY3Rp\nb24gY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQo\nX2xvYy5nZXQoImdlbmVyYXRpbmctY29sdW1ucyIsIHNjaGVtYU5hbWUsCiAg\nICAgICAgICAgIHRhYmxlTmFtZSkpOwogICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nImdlbi10YWJsZXMiLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUpKTsKCiAgICAg\nICAgQ29sdW1uW10gY29scyA9IF9kaWN0LmdldENvbHVtbnMobWV0YSwgCiAg\nICAgICAgICAgIERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNvbm4uZ2V0Q2F0\nYWxvZygpKSwgc2NoZW1hTmFtZSwKICAgICAgICAgICAgdGFibGVOYW1lLCBu\ndWxsLCBjb25uKTsKCiAgICAgICAgLy8gd2hlbiB3ZSB3YW50IHRvIGdldCBh\nbGwgdGhlIGNvbHVtbnMgZm9yIGFsbCB0YWJsZXMsIHdlIG5lZWQgdG8gYnVp\nbGQKICAgICAgICAvLyBhIGxpc3Qgb2YgdGFibGVzIHRvIHZlcmlmeSBiZWNh\ndXNlIHNvbWUgZGF0YWJhc2VzIChlLmcuLCBQb3N0Z3JlcykKICAgICAgICAv\nLyB3aWxsIGluY2x1ZGUgaW5kZXhlcyBpbiB0aGUgbGlzdCBvZiBjb2x1bW5z\nLCBhbmQgdGhlcmUgaXMgbm8gd2F5IHRvCiAgICAgICAgLy8gZGlzdGluZ3Vp\nc2ggdGhlIGluZGV4ZXMgZnJvbSBwcm9wZXIgY29sdW1ucwogICAgICAgIFNl\ndDxEQklkZW50aWZpZXI+IHRhYmxlTmFtZXMgPSBudWxsOwogICAgICAgIGlm\nIChEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkgfHwgIiUiLmVxdWFs\ncyh0YWJsZU5hbWUuZ2V0TmFtZSgpKSkgewogICAgICAgICAgICBUYWJsZVtd\nIHRhYmxlcyA9IF9kaWN0LmdldFRhYmxlcyhtZXRhLCBEQklkZW50aWZpZXIu\nbmV3Q2F0YWxvZyhjb25uLmdldENhdGFsb2coKSksCiAgICAgICAgICAgICAg\nICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgICAgICAgICB0\nYWJsZU5hbWVzID0gbmV3IEhhc2hTZXQ8REJJZGVudGlmaWVyPigpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgdGFibGVzICE9IG51bGwgJiYgaSA8\nIHRhYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGNv\nbHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRhYmxlTmFtZXMu\nYWRkKHRhYmxlc1tpXS5nZXRJZGVudGlmaWVyKCkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgREJJZGVudGlmaWVyIHNOYW1lID0gREJJZGVudGlmaWVyLnRvVXBwZXIo\ndGFibGVzW2ldLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgICAgICAgICAg\nICAgdGFibGVOYW1lcy5hZGQoc05hbWUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBkYXRhYmFz\nZSBjYW4ndCBoYW5kbGUgbnVsbCB0YWJsZSBuYW1lLCByZWN1cnNlIG9uIGVh\nY2gga25vd24gbmFtZQogICAgICAgIGlmIChjb2xzID09IG51bGwgJiYgREJJ\nZGVudGlmaWVyLmlzTnVsbCh0YWJsZU5hbWUpKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3I8REJJZGVudGlmaWVyPiBpdHIgPSB0YWJsZU5hbWVzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgZ2Vu\nZXJhdGVUYWJsZXMoc2NoZW1hTmFtZSwgaXRyLm5leHQoKSwgY29ubiwgbWV0\nYSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNj\naGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBT\nY2hlbWEgc2NoZW1hOwogICAgICAgIFRhYmxlIHRhYmxlOwogICAgICAgIERC\nSWRlbnRpZmllciB0YWJsZVNjaGVtYSA9IERCSWRlbnRpZmllci5OVUxMOwog\nICAgICAgIERCSWRlbnRpZmllciBiYXNlVGFibGVOYW1lID0gKHRhYmxlTmFt\nZSA9PSBudWxsKSA/IERCSWRlbnRpZmllci5OVUxMIDogdGFibGVOYW1lLmNs\nb25lKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbHMgIT0gbnVsbCAm\nJiBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoREJJ\nZGVudGlmaWVyLmlzTnVsbChiYXNlVGFibGVOYW1lKSB8fCBiYXNlVGFibGVO\nYW1lLmVxdWFscygiJSIpKSB7CiAgICAgICAgICAgICAgICB0YWJsZU5hbWUg\nPSBjb2xzW2ldLmdldFRhYmxlSWRlbnRpZmllcigpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAJdGFibGVOYW1lID0gYmFzZVRhYmxlTmFt\nZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoREJJZGVudGlmaWVy\nLmlzTnVsbChzY2hlbWFOYW1lKSkgewogICAgICAgICAgICAgICAgdGFibGVT\nY2hlbWEgPSBEQklkZW50aWZpZXIudHJpbVRvTnVsbChjb2xzW2ldLmdldFNj\naGVtYUlkZW50aWZpZXIoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICB0YWJsZVNjaGVtYSA9IHNjaGVtYU5h\nbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8v\nIGlnbm9yZSBzcGVjaWFsIHRhYmxlcwogICAgICAgICAgICBpZiAoIV9vcGVu\nanBhVGFibGVzICYmCiAgICAgICAgICAgICAgICAodGFibGVOYW1lLmdldE5h\nbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIk9QRU5KUEFfIikKICAg\nICAgICAgICAgICAgICAgICB8fCB0YWJsZU5hbWUuZ2V0TmFtZSgpLnRvVXBw\nZXJDYXNlKCkuc3RhcnRzV2l0aCgiSkRPXyIpKSkgLy8gbGVnYWN5CiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKF9kaWN0Lmlz\nU3lzdGVtVGFibGUodGFibGVOYW1lLCB0YWJsZVNjaGVtYSwgIURCSWRlbnRp\nZmllci5pc051bGwoc2NoZW1hTmFtZSkpKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAvLyBpZ25vcmUgdGFibGVzIG5vdCBpbiBs\naXN0LCBvciBub3QgYWxsb3dlZCBieSBzY2hlbWFzIHByb3BlcnR5CiAgICAg\nICAgICAgIAogICAgICAgICAgICBpZiAodGFibGVOYW1lcyAhPSBudWxsCiAg\nICAgICAgICAgICAgICAmJiAhdGFibGVOYW1lcy5jb250YWlucyhEQklkZW50\naWZpZXIudG9VcHBlcih0YWJsZU5hbWUpKSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICBpZiAoIWlzQWxsb3dlZFRhYmxlKHRhYmxl\nU2NoZW1hLCB0YWJsZU5hbWUpKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEodGFibGVT\nY2hlbWEpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAg\nICAgICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRTY2hlbWEodGFibGVTY2hl\nbWEpOwoKICAgICAgICAgICAgdGFibGUgPSBzY2hlbWEuZ2V0VGFibGUodGFi\nbGVOYW1lKTsKICAgICAgICAgICAgaWYgKHRhYmxlID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIHRhYmxlID0gc2NoZW1hLmFkZFRhYmxlKHRhYmxlTmFt\nZSk7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImNv\nbC10YWJsZSIsIHRhYmxlKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tY29sdW1uIiwgY29sc1tpXS5nZXRJ\nZGVudGlmaWVyKCksIHRhYmxlKSk7CgogICAgICAgICAgICBpZiAodGFibGUu\nZ2V0Q29sdW1uKGNvbHNbaV0uZ2V0SWRlbnRpZmllcigpKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICB0YWJsZS5pbXBvcnRDb2x1bW4oY29sc1tpXSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gdGFibGUgaXMgYWxsb3dlZCBi\neSB0aGUgdXNlcidzIHNjaGVtYSBsaXN0LgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gaXNBbGxvd2VkVGFibGUoREJJZGVudGlmaWVyIHNjaGVtYSwg\nREJJZGVudGlmaWVyIHRhYmxlKSB7CiAgICAgICAgaWYgKF9hbGxvd2VkID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBk\nbyBjYXNlLWluc2Vuc2l0aXZlIGNvbXBhcmlzb24gb24gYWxsb3dlZCB0YWJs\nZSBhbmQgc2NoZW1hIG5hbWVzCiAgICAgICAgREJJZGVudGlmaWVyW10gdGFi\nbGVzOwogICAgICAgIERCSWRlbnRpZmllcltdIGFueVNjaGVtYVRhYmxlcyA9\nIG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfYWxsb3dlZC5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoX2FsbG93ZWRbaV1bMF0g\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgYW55U2NoZW1hVGFibGVzID0g\nKERCSWRlbnRpZmllcltdKSBfYWxsb3dlZFtpXVsxXTsKICAgICAgICAgICAg\nICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmICghc2NoZW1hLmVxdWFscygoREJJZGVudGlmaWVy\nKSBfYWxsb3dlZFtpXVswXSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIGlmICh0YWJsZSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHRhYmxlcyA9IChEQklkZW50\naWZpZXJbXSkgX2FsbG93ZWRbaV1bMV07CiAgICAgICAgICAgIGlmICh0YWJs\nZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYmxlcy5sZW5ndGg7IGor\nKykKICAgICAgICAgICAgICAgIGlmICh0YWJsZS5lcXVhbHModGFibGVzW2pd\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCgogICAgICAgIGlmIChhbnlTY2hlbWFUYWJsZXMgIT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAodGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFu\neVNjaGVtYVRhYmxlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlm\nICh0YWJsZS5lcXVhbHMoYW55U2NoZW1hVGFibGVzW2ldKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGVzIHRh\nYmxlIHByaW1hcnkga2V5cy4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlUHJpbWFyeUtleXMoU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsCiAgICAgICAgQ29ubmVjdGlv\nbiBjb25uLCBEYXRhYmFzZU1ldGFEYXRhIG1ldGEpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZ2VuZXJhdGVQcmltYXJ5S2V5cyhE\nQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLCBEQklkZW50aWZp\nZXIubmV3VGFibGUodGFibGVOYW1lKSwKICAgICAgICAgICAgY29ubiwgbWV0\nYSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ2VuZXJhdGVQcmltYXJ5S2V5\ncyhEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxl\nTmFtZSwKICAgICAgICBDb25uZWN0aW9uIGNvbm4sIERhdGFiYXNlTWV0YURh\ndGEgbWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBmaXJlR2VuZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5lcmF0aW5nLXBy\naW1hcnkiLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUpKTsK\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tcGtzIiwgc2NoZW1hTmFtZSwg\ndGFibGVOYW1lKSk7CgogICAgICAgIC8vIGlmIGxvb2tpbmcgZm9yIGEgbm9u\nLWV4aXN0YW50IHRhYmxlLCBqdXN0IHJldHVybgogICAgICAgIFNjaGVtYUdy\nb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBpZiAodGFi\nbGVOYW1lICE9IG51bGwgJiYgIXRhYmxlTmFtZS5pc051bGwoKSAmJiAKICAg\nICAgICAgICAgICAgIGdyb3VwLmZpbmRUYWJsZShRdWFsaWZpZWREQklkZW50\naWZpZXIuZ2V0UGF0aCh0YWJsZU5hbWUpKSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIC8vIGlmIHRoZSBkYXRhYmFzZSBjYW4ndCB1\nc2UgYSB0YWJsZSBuYW1lIHdpbGRjYXJkLCByZWN1cnNlIG9uIGVhY2gKICAg\nICAgICAvLyBjb25jcmV0ZSB0YWJsZSBpbiB0aGUgcmVxdWVzdGVkIHNjaGVt\nYShzKQogICAgICAgIFByaW1hcnlLZXlbXSBwa3MgPSBfZGljdC5nZXRQcmlt\nYXJ5S2V5cyhtZXRhLCAKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld0Nh\ndGFsb2coY29ubi5nZXRDYXRhbG9nKCkpLAogICAgICAgICAgICBzY2hlbWFO\nYW1lLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgICAgIFRhYmxlIHRhYmxlOwog\nICAgICAgIGlmIChwa3MgPT0gbnVsbCAmJiB0YWJsZU5hbWUgPT0gbnVsbCkg\newogICAgICAgICAgICBDb2xsZWN0aW9uPFRhYmxlPiB0YWJsZXMgPSBnZXRU\nYWJsZXMoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8\nVGFibGU+IGl0ciA9IHRhYmxlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgdGFibGUgPSAoVGFibGUpIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKHRhYmxl\nLmdldFNjaGVtYUlkZW50aWZpZXIoKSwKICAgICAgICAgICAgICAgICAgICB0\nYWJsZS5nZXRJZGVudGlmaWVyKCksIGNvbm4sIG1ldGEpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNj\naGVtYSBzY2hlbWE7CiAgICAgICAgUHJpbWFyeUtleSBwazsKICAgICAgICBE\nQklkZW50aWZpZXIgbmFtZSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAg\nIERCSWRlbnRpZmllciBjb2xOYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IHBrcyAhPSBudWxsICYmIGkgPCBwa3Mu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IERCSWRl\nbnRpZmllci50cmltVG9OdWxsKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBz\nY2hlbWEgPSBncm91cC5nZXRTY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAgICAg\nICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICB0YWJsZSA9IHNjaGVtYS5nZXRUYWJsZShwa3Nb\naV0uZ2V0VGFibGVJZGVudGlmaWVyKCkpOwogICAgICAgICAgICBpZiAodGFi\nbGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAg\nICAgICAgY29sTmFtZSA9IHBrc1tpXS5nZXRDb2x1bW5JZGVudGlmaWVyKCk7\nCiAgICAgICAgICAgIG5hbWUgPSBwa3NbaV0uZ2V0SWRlbnRpZmllcigpOwog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2VuLXBrIiwgbmFtZSwg\ndGFibGUsIGNvbE5hbWUpKTsKCiAgICAgICAgICAgIHBrID0gdGFibGUuZ2V0\nUHJpbWFyeUtleSgpOwogICAgICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHBrID0gdGFibGUuYWRkUHJpbWFyeUtleShuYW1lKTsK\nICAgICAgICAgICAgcGsuYWRkQ29sdW1uKHRhYmxlLmdldENvbHVtbihjb2xO\nYW1lKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJh\ndGVzIHRhYmxlIGluZGV4ZXMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZUluZGV4ZXMoU3RyaW5nIHNjaGVt\nYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsCiAgICAgICAgQ29ubmVjdGlvbiBj\nb25uLCBEYXRhYmFzZU1ldGFEYXRhIG1ldGEpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgZ2VuZXJhdGVJbmRleGVzKERCSWRlbnRp\nZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksIERCSWRlbnRpZmllci5uZXdU\nYWJsZSh0YWJsZU5hbWUpLAogICAgICAgICAgICBjb25uLCBtZXRhKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZUluZGV4ZXMoREJJZGVudGlm\naWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmllciB0YWJsZU5hbWUsCiAgICAg\nICAgQ29ubmVjdGlvbiBjb25uLCBEYXRhYmFzZU1ldGFEYXRhIG1ldGEpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmlyZUdlbmVy\nYXRpb25FdmVudChfbG9jLmdldCgiZ2VuZXJhdGluZy1pbmRleGVzIiwKICAg\nICAgICAgICAgc2NoZW1hTmFtZSwgdGFibGVOYW1lKSk7CiAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgiZ2VuLWluZGV4ZXMiLCBzY2hlbWFOYW1lLCB0YWJsZU5h\nbWUpKTsKCiAgICAgICAgLy8gaWYgbG9va2luZyBmb3IgYSBub24tZXhpc3Rh\nbnQgdGFibGUsIGp1c3QgcmV0dXJuCiAgICAgICAgU2NoZW1hR3JvdXAgZ3Jv\ndXAgPSBnZXRTY2hlbWFHcm91cCgpOwogICAgICAgIGlmICh0YWJsZU5hbWUg\nIT0gbnVsbCAmJiBncm91cC5maW5kVGFibGUoUXVhbGlmaWVkREJJZGVudGlm\naWVyLmdldFBhdGgodGFibGVOYW1lKSkgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICAvLyBpZiB0aGUgZGF0YWJhc2UgY2FuJ3QgdXNl\nIGEgdGFibGUgbmFtZSB3aWxkY2FyZCwgcmVjdXJzZSBvbiBlYWNoCiAgICAg\nICAgLy8gY29uY3JldGUgdGFibGUgaW4gdGhlIHJlcXVlc3RlZCBzY2hlbWEo\ncykKICAgICAgICBJbmRleFtdIGlkeHMgPSBfZGljdC5nZXRJbmRleEluZm8o\nbWV0YSwgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY29ubi5nZXRDYXRhbG9n\nKCkpLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGZhbHNl\nLCB0cnVlLCBjb25uKTsKICAgICAgICBUYWJsZSB0YWJsZTsKICAgICAgICBp\nZiAoaWR4cyA9PSBudWxsICYmIHRhYmxlTmFtZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIENvbGxlY3Rpb248VGFibGU+IHRhYmxlcyA9IGdldFRhYmxlcyhz\nY2hlbWFOYW1lKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxUYWJsZT4g\naXRyID0gdGFibGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICB0YWJsZSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBnZW5lcmF0ZUluZGV4ZXModGFibGUuZ2V0U2NoZW1hSWRlbnRpZmll\ncigpLAogICAgICAgICAgICAgICAgICAgIHRhYmxlLmdldElkZW50aWZpZXIo\nKSwgY29ubiwgbWV0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAg\nICBJbmRleCBpZHg7CiAgICAgICAgREJJZGVudGlmaWVyIG5hbWUgPSBEQklk\nZW50aWZpZXIuTlVMTDsKICAgICAgICBEQklkZW50aWZpZXIgY29sTmFtZSA9\nIERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIERCSWRlbnRpZmllciBwa05h\nbWUgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaWR4cyAhPSBudWxsICYmIGkgPCBpZHhzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIHNjaGVtYU5hbWUgPSBEQklkZW50aWZpZXIudHJpbVRvTnVs\nbChpZHhzW2ldLmdldFNjaGVtYUlkZW50aWZpZXIoKSk7CiAgICAgICAgICAg\nIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1lKTsKICAgICAg\nICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIHRhYmxlID0gc2NoZW1hLmdldFRhYmxlKGlk\neHNbaV0uZ2V0VGFibGVJZGVudGlmaWVyKCkpOwogICAgICAgICAgICBpZiAo\ndGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgaWYgKHRhYmxlLmdldFByaW1hcnlLZXkoKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcGtOYW1lID0gdGFibGUuZ2V0UHJpbWFyeUtleSgp\nLmdldElkZW50aWZpZXIoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgcGtOYW1lID0gbnVsbDsKCiAgICAgICAgICAgIC8vIHN0YXRpc3Rp\nY3MgZG9uJ3QgaGF2ZSBuYW1lczsgc2tpcCB0aGVtCiAgICAgICAgICAgIG5h\nbWUgPSBpZHhzW2ldLmdldElkZW50aWZpZXIoKTsKICAgICAgICAgICAgaWYg\nKERCSWRlbnRpZmllci5pc0VtcHR5KG5hbWUpCiAgICAgICAgICAgICAgICB8\nfCAocGtOYW1lICE9IG51bGwgJiYgbmFtZS5lcXVhbHMocGtOYW1lKSkKICAg\nICAgICAgICAgICAgIHx8IF9kaWN0LmlzU3lzdGVtSW5kZXgobmFtZSwgdGFi\nbGUpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBj\nb2xOYW1lID0gaWR4c1tpXS5nZXRDb2x1bW5JZGVudGlmaWVyKCk7CiAgICAg\nICAgICAgIGlmICh0YWJsZS5nZXRDb2x1bW4oY29sTmFtZSkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImdlbi1pbmRleCIsIG5hbWUsIHRhYmxlLCBjb2xOYW1l\nKSk7CgogICAgICAgICAgICAvLyBzYW1lIGluZGV4IG1heSBoYXZlIG11bHRp\ncGxlIHJvd3MgZm9yIG11bHRpcGxlIGNvbHMKICAgICAgICAgICAgaWR4ID0g\ndGFibGUuZ2V0SW5kZXgobmFtZSk7CiAgICAgICAgICAgIGlmIChpZHggPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWR4ID0gdGFibGUuYWRkSW5kZXgo\nbmFtZSk7CiAgICAgICAgICAgICAgICBpZHguc2V0VW5pcXVlKGlkeHNbaV0u\naXNVbmlxdWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWR4LmFk\nZENvbHVtbih0YWJsZS5nZXRDb2x1bW4oY29sTmFtZSkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlcyB0YWJsZSBmb3JlaWdu\nIGtleXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlRm9yZWln\nbktleXMoU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsCiAg\nICAgICAgQ29ubmVjdGlvbiBjb25uLCBEYXRhYmFzZU1ldGFEYXRhIG1ldGEp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZ2VuZXJh\ndGVGb3JlaWduS2V5cyhEQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5h\nbWUpLCBEQklkZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSwKICAgICAg\nICAgICAgY29ubiwgbWV0YSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ2Vu\nZXJhdGVGb3JlaWduS2V5cyhEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJ\nZGVudGlmaWVyIHRhYmxlTmFtZSwKICAgICAgICBDb25uZWN0aW9uIGNvbm4s\nIERhdGFiYXNlTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBmaXJlR2VuZXJhdGlvbkV2ZW50KF9sb2MuZ2V0\nKCJnZW5lcmF0aW5nLWZvcmVpZ24iLAogICAgICAgICAgICBzY2hlbWFOYW1l\nLCB0YWJsZU5hbWUpKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tZmtz\nIiwgc2NoZW1hTmFtZSwgdGFibGVOYW1lKSk7CgogICAgICAgIC8vIGlmIGxv\nb2tpbmcgZm9yIGEgbm9uLWV4aXN0YW50IHRhYmxlLCBqdXN0IHJldHVybgog\nICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsK\nICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwodGFibGVOYW1lKSAm\nJiBncm91cC5maW5kVGFibGUoUXVhbGlmaWVkREJJZGVudGlmaWVyLmdldFBh\ndGgodGFibGVOYW1lKSkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAvLyBpZiB0aGUgZGF0YWJhc2UgY2FuJ3QgdXNlIGEgdGFibGUg\nbmFtZSB3aWxkY2FyZCwgcmVjdXJzZSBvbiBlYWNoCiAgICAgICAgLy8gY29u\nY3JldGUgdGFibGUgaW4gdGhlIHJlcXVlc3RlZCBzY2hlbWEocykKICAgICAg\nICBGb3JlaWduS2V5W10gZmtzID0gX2RpY3QuZ2V0SW1wb3J0ZWRLZXlzKG1l\ndGEsIERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNvbm4uZ2V0Q2F0YWxvZygp\nKSwKICAgICAgICAgICAgc2NoZW1hTmFtZSwgdGFibGVOYW1lLCBjb25uKTsK\nICAgICAgICBUYWJsZSB0YWJsZTsKICAgICAgICBpZiAoZmtzID09IG51bGwg\nJiYgREJJZGVudGlmaWVyLmlzTnVsbCh0YWJsZU5hbWUpKSB7CiAgICAgICAg\nICAgIENvbGxlY3Rpb248VGFibGU+IHRhYmxlcyA9IGdldFRhYmxlcyhzY2hl\nbWFOYW1lKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxUYWJsZT4gaXRy\nID0gdGFibGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICB0YWJsZSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICBnZW5lcmF0ZUZvcmVpZ25LZXlzKHRhYmxlLmdldFNjaGVtYUlkZW50aWZp\nZXIoKSwKICAgICAgICAgICAgICAgICAgICB0YWJsZS5nZXRJZGVudGlmaWVy\nKCksIGNvbm4sIG1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIFNjaGVtYSBzY2hlbWE7CiAgICAg\nICAgVGFibGUgcGtUYWJsZTsKICAgICAgICBGb3JlaWduS2V5IGZrOwogICAg\nICAgIERCSWRlbnRpZmllciBuYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAg\nICAgICAgREJJZGVudGlmaWVyIHBrU2NoZW1hTmFtZSA9IERCSWRlbnRpZmll\nci5OVUxMOwogICAgICAgIERCSWRlbnRpZmllciBwa1RhYmxlTmFtZSA9IERC\nSWRlbnRpZmllci5OVUxMOwogICAgICAgIERCSWRlbnRpZmllciBwa0NvbE5h\nbWUgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBEQklkZW50aWZpZXIg\nZmtDb2xOYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgaW50IHNl\ncTsKICAgICAgICBib29sZWFuIHNlcVdhczAgPSBmYWxzZTsgLy8gc29tZSBk\ncml2ZXJzIGluY29ycmVjdGx5IHN0YXJ0IGF0IDAKICAgICAgICBDb2xsZWN0\naW9uPEZvcmVpZ25LZXk+IGludmFsaWRzID0gbnVsbDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgZmtzICE9IG51bGwgJiYgaSA8IGZrcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBzY2hlbWFOYW1lID0gREJJZGVudGlmaWVyLnRy\naW1Ub051bGwoZmtzW2ldLmdldFNjaGVtYUlkZW50aWZpZXIoKSk7CiAgICAg\nICAgICAgIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1lKTsK\nICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIHRhYmxlID0gc2NoZW1hLmdldFRh\nYmxlKGZrc1tpXS5nZXRUYWJsZUlkZW50aWZpZXIoKSk7CiAgICAgICAgICAg\nIGlmICh0YWJsZSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICBuYW1lID0gZmtzW2ldLmdldElkZW50aWZpZXIoKTsK\nICAgICAgICAgICAgZmtDb2xOYW1lID0gZmtzW2ldLmdldENvbHVtbklkZW50\naWZpZXIoKTsKICAgICAgICAgICAgcGtDb2xOYW1lID0gZmtzW2ldLmdldFBy\naW1hcnlLZXlDb2x1bW5JZGVudGlmaWVyKCk7CiAgICAgICAgICAgIHNlcSA9\nIGZrc1tpXS5nZXRLZXlTZXF1ZW5jZSgpOwogICAgICAgICAgICBpZiAoc2Vx\nID09IDApCiAgICAgICAgICAgICAgICBzZXFXYXMwID0gdHJ1ZTsKICAgICAg\nICAgICAgaWYgKHNlcVdhczApCiAgICAgICAgICAgICAgICBzZXErKzsKCiAg\nICAgICAgICAgIC8vIGZpbmQgcGsgdGFibGUKICAgICAgICAgICAgcGtTY2hl\nbWFOYW1lID0gZmtzW2ldLmdldFByaW1hcnlLZXlTY2hlbWFJZGVudGlmaWVy\nKCk7CiAgICAgICAgICAgIGlmKF9kaWN0LmdldFRyaW1TY2hlbWFOYW1lKCkp\nIHsKICAgICAgICAgICAgICAgIHBrU2NoZW1hTmFtZT0gREJJZGVudGlmaWVy\nLnRyaW1Ub051bGwocGtTY2hlbWFOYW1lKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBwa1RhYmxlTmFtZSA9IGZrc1tpXS5nZXRQcmltYXJ5S2V5VGFi\nbGVJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJnZW4tZmsiLCBuZXcgT2JqZWN0W117IG5hbWUsIHRhYmxlLAogICAgICAg\nICAgICAgICAgICAgIGZrQ29sTmFtZSwgcGtUYWJsZU5hbWUsIHBrQ29sTmFt\nZSwgc2VxICsgIiIgfSkpOwoKICAgICAgICAgICAgcGtUYWJsZSA9IGdyb3Vw\nLmZpbmRUYWJsZShRdWFsaWZpZWREQklkZW50aWZpZXIubmV3UGF0aChwa1Nj\naGVtYU5hbWUsIHBrVGFibGVOYW1lKSk7CiAgICAgICAgICAgIGlmIChwa1Rh\nYmxlID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJnZW4tbm9ma3RhYmxlIiwKICAgICAgICAgICAg\nICAgICAgICB0YWJsZSwgcGtUYWJsZU5hbWUpLmdldE1lc3NhZ2UoKSk7Cgog\nICAgICAgICAgICAvLyB0aGlzIHN1Y2tzLCBiZWNhdXNlIGl0IGlzICpub3Qq\nIGd1YXJhbnRlZWQgdG8gd29yazsKICAgICAgICAgICAgLy8gdGhlIGZrIHJl\nc3VsdHNldCBpcyBvcmRlcmVkIGJ5IHByaW1hcnkga2V5IHRhYmxlLCB0aGVu\nCiAgICAgICAgICAgIC8vIHNlcXVlbmNlIG51bWJlciB3aXRoaW4gdGhlIGZv\ncmVpZ24ga2V5IChzb21lIGRyaXZlcnMgZG9uJ3QKICAgICAgICAgICAgLy8g\ndXNlIHNlcXVlbmNlIG51bWJlcnMgY29ycmVjdGx5IGVpdGhlcik7IHNpbmNl\nIGZrIG5hbWVzCiAgICAgICAgICAgIC8vIGFyZSBhbGxvd2VkIHRvIGJlIG51\nbGwsIGFsbCB0aGlzIGFkZHMgdXAgdG8gdGhlIGZhY3QKICAgICAgICAgICAg\nLy8gdGhhdCB0aGVyZSBpcyBhYnNvbHV0ZWx5IG5vIHdheSB0byBkaXN0aW5n\ndWlzaCBiZXR3ZWVuCiAgICAgICAgICAgIC8vIG11bHRpcGxlIG11bHRpLWNv\nbHVtbiBma3MgdG8gdGhlIHNhbWUgdGFibGU7IHdlJ3JlIGdvaW5nCiAgICAg\nICAgICAgIC8vIHRvIHJlbHkgb24gZmsgbmFtZSBoZXJlIGFuZCBob3BlIGl0\nIHdvcmtzCiAgICAgICAgICAgIGZrID0gdGFibGUuZ2V0Rm9yZWlnbktleShu\nYW1lKTsKCiAgICAgICAgICAgIC8vIHN0YXJ0IGEgbmV3IGZrPwogICAgICAg\nICAgICBpZiAoc2VxID09IDEgfHwgZmsgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgZmsgPSB0YWJsZS5hZGRGb3JlaWduS2V5KG5hbWUpOwogICAgICAg\nICAgICAgICAgZmsuc2V0RGVmZXJyZWQoZmtzW2ldLmlzRGVmZXJyZWQoKSk7\nCiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oZmtzW2ldLmdl\ndERlbGV0ZUFjdGlvbigpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGludmFsaWRzID09IG51bGwgfHwgIWludmFsaWRzLmNvbnRhaW5zKGZr\nKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBDb2x1bW4gZmtDb2wgPSB0YWJsZS5nZXRDb2x1bW4oZmtDb2xOYW1lKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZmtDb2wgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIm5vLWNvbHVtbiIsIGZrQ29sTmFtZSwgdGFibGUuZ2V0SWRlbnRpZmll\ncigpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIGZrLmpvaW4oZmtDb2wsIHBrVGFibGUuZ2V0Q29sdW1uKHBrQ29sTmFtZSkp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uIGlhZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfbG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJiYWQtam9pbiIsIGlhZS50b1N0cmluZygpKSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGludmFsaWRzID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGludmFsaWRzID0gbmV3IEhhc2hTZXQ8Rm9y\nZWlnbktleT4oKTsKICAgICAgICAgICAgICAgICAgICBpbnZhbGlkcy5hZGQo\nZmspOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvLyByZW1vdmUgaW52YWxpZCBma3MKICAgICAgICBpZiAo\naW52YWxpZHMgIT0gbnVsbCkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nPEZvcmVpZ25LZXk+IGl0ciA9IGludmFsaWRzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBmayA9IGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBmay5nZXRUYWJsZSgpLnJlbW92ZUZvcmVpZ25L\nZXkoZmspOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQWRkcyBhbGwgc2VxdWVuY2VzIG1hdGNoaW5nIHRoZSBnaXZl\nbiBuYW1lIHBhdHRlcm4gdG8gdGhlIHNjaGVtYS4KICAgICAqIEBkZXByZWNh\ndGVkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlU2VxdWVuY2Vz\nKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lLAogICAg\nICAgIENvbm5lY3Rpb24gY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRl\nU2VxdWVuY2VzKERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSks\nIAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3U2VxdWVuY2Uoc2VxdWVu\nY2VOYW1lKSwgY29ubiwgbWV0YSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2\nb2lkIGdlbmVyYXRlU2VxdWVuY2VzKERCSWRlbnRpZmllciBzY2hlbWFOYW1l\nLCBEQklkZW50aWZpZXIgc2VxdWVuY2VOYW1lLAogICAgICAgIENvbm5lY3Rp\nb24gY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQo\nX2xvYy5nZXQoImdlbmVyYXRpbmctc2VxdWVuY2VzIiwgc2NoZW1hTmFtZSkp\nOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImdlbi1zZXFzIiwgc2NoZW1hTmFt\nZSwgc2VxdWVuY2VOYW1lKSk7CgogICAgICAgIC8vIHNpbmNlIGFsbCB0aGUg\nc2VxdWVuY2VzIGFyZSBnZW5lcmF0ZWQgdW5kZXIgdGhlIGRlZmF1bHQgc2No\nZW1hCiAgICAgICAgLy8gdGhlcmVmb3JlLCB3ZSBjYW4gdXNlIHRoZSBudWxs\nIHNjaGVtYW5hbWUgdG8gc2VhcmNoCiAgICAgICAgU2VxdWVuY2VbXSBzZXFz\nID0gX2RpY3QuZ2V0U2VxdWVuY2VzKG1ldGEsIERCSWRlbnRpZmllci5uZXdD\nYXRhbG9nKGNvbm4uZ2V0Q2F0YWxvZygpKSwKICAgICAgICAgICAgREJJZGVu\ndGlmaWVyLk5VTEwsIHNlcXVlbmNlTmFtZSwgY29ubik7CgogICAgICAgIFNj\naGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBT\nY2hlbWEgc2NoZW1hOwogICAgICAgIERCSWRlbnRpZmllciBzZXF1ZW5jZVNj\naGVtYSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBzZXFzICE9IG51bGwgJiYgaSA8IHNlcXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgc2VxdWVuY2VOYW1lID0gc2Vxc1tpXS5nZXRJZGVudGlm\naWVyKCk7CiAgICAgICAgICAgIHNlcXVlbmNlU2NoZW1hID0gREJJZGVudGlm\naWVyLnRyaW1Ub051bGwoc2Vxc1tpXS5nZXRTY2hlbWFJZGVudGlmaWVyKCkp\nOwoKICAgICAgICAgICAgLy8gaWdub3JlIHNwZWNpYWwgdGFibGVzCiAgICAg\nICAgICAgIFN0cmluZyBzZXFVcHBlciA9IERCSWRlbnRpZmllci50b1VwcGVy\nKHNlcXVlbmNlTmFtZSkuZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAoIV9v\ncGVuanBhVGFibGVzICYmCiAgICAgICAgICAgICAgICAoc2VxVXBwZXIuc3Rh\ncnRzV2l0aCgiT1BFTkpQQV8iKQogICAgICAgICAgICAgICAgICAgIHx8IHNl\ncVVwcGVyLnN0YXJ0c1dpdGgoIkpET18iKSkpIC8vIGxlZ2FjeQogICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmIChfZGljdC5pc1N5\nc3RlbVNlcXVlbmNlKHNlcXVlbmNlTmFtZSwgc2VxdWVuY2VTY2hlbWEsCiAg\nICAgICAgICAgICAgICBzY2hlbWFOYW1lICE9IG51bGwpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmICghaXNBbGxvd2VkVGFi\nbGUoc2VxdWVuY2VTY2hlbWEsIG51bGwpKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEo\nc2VxdWVuY2VTY2hlbWEpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmFkZFNjaGVt\nYShzZXF1ZW5jZVNjaGVtYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKHNjaGVtYS5nZXRTZXF1ZW5jZShzZXF1ZW5jZU5hbWUpID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIHNjaGVtYS5hZGRTZXF1ZW5jZShzZXF1ZW5j\nZU5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTm90aWZ5IGFueSBsaXN0ZW5lcnMgdGhhdCBhIHNjaGVtYSBv\nYmplY3Qgd2FzIGdlbmVyYXRlZC4gUmV0dXJucwogICAgICogdHJ1ZSBpZiBn\nZW5lcmF0aW9uIHNob3VsZCBjb250aW51ZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGZpcmVHZW5lcmF0aW9uRXZlbnQoT2JqZWN0IHNjaGVtYU9iamVj\ndCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nc2NoZW1hT2JqZWN0ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBpZiAoX2xpc3RlbmVycyA9PSBudWxsIHx8IF9saXN0ZW5lcnMuc2l6\nZSgpID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRXZlbnQg\nZSA9IG5ldyBFdmVudChzY2hlbWFPYmplY3QsIF9zY2hlbWFPYmplY3RzKTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yPExpc3RlbmVyPiBpID0gX2xpc3RlbmVy\ncy5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgTGlz\ndGVuZXIgbCA9IGkubmV4dCgpOwogICAgICAgICAgICBpZiAoIWwuc2NoZW1h\nT2JqZWN0R2VuZXJhdGVkKGUpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFNRTEV4Y2VwdGlvbihfbG9jLmdldCgicmVmcmVzaC1jYW5jZWxsZWQiKQog\nICAgICAgICAgICAgICAgICAgIC5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBsaXN0ZW5lciBmb3Igc2No\nZW1hIGdlbmVyYXRpb24gZXZlbnRzLgogICAgICoKICAgICAqIEBwYXJhbSBs\nIHRoZSBsaXN0ZW5lciB0byBhZGQKICAgICAqLwogICAgcHVibGljIHZvaWQg\nYWRkTGlzdGVuZXIoTGlzdGVuZXIgbCkgewogICAgICAgIGlmIChfbGlzdGVu\nZXJzID09IG51bGwpCiAgICAgICAgICAgIF9saXN0ZW5lcnMgPSBuZXcgTGlu\na2VkTGlzdDxMaXN0ZW5lcj4oKTsKICAgICAgICBfbGlzdGVuZXJzLmFkZChs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBzY2hlbWEgZ2Vu\nZXJhdGlvbiBsaXN0ZW5lciBmb3Igc2NoZW1hIGV2ZW50cy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gbCB0aGUgbGlzdGVuZXIgdG8gcmVtb3ZlCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgaXQgd2FzIHN1Y2Nlc3NmdWxseSByZW1vdmVkCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUxpc3RlbmVyKExpc3Rl\nbmVyIGwpIHsKICAgICAgICByZXR1cm4gX2xpc3RlbmVycyAhPSBudWxsICYm\nIF9saXN0ZW5lcnMucmVtb3ZlKGwpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGFsbCB0YWJsZXMgZm9yIHRoZSBnaXZlbiBzY2hlbWEgbmFtZSwg\nb3IgYWxsIHRhYmxlcyBpbgogICAgICogdGhlIHNjaGVtYSBncm91cCBpZiBu\ndWxsIGlzIGdpdmVuLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb248\nVGFibGU+IGdldFRhYmxlcyhEQklkZW50aWZpZXIgc2NoZW1hTmFtZSkgewog\nICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsK\nICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkp\nIHsKICAgICAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVt\nYShzY2hlbWFOYW1lKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TGlz\ndCgpOwogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdChzY2hlbWEu\nZ2V0VGFibGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgU2NoZW1hW10gc2No\nZW1hcyA9IGdyb3VwLmdldFNjaGVtYXMoKTsKICAgICAgICBDb2xsZWN0aW9u\nPFRhYmxlPiB0YWJsZXMgPSBuZXcgTGlua2VkTGlzdDxUYWJsZT4oKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIHRhYmxlcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChzY2hl\nbWFzW2ldLmdldFRhYmxlcygpKSk7CiAgICAgICAgcmV0dXJuIHRhYmxlczsK\nICAgIH0KCiAgICAvKioKICAgICAqIEEgbGlzdGVuZXIgZm9yIGEgcG90ZW50\naWFsbHkgbGVuZ3RoeSBzY2hlbWEgZ2VuZXJhdGlvbiBwcm9jZXNzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFjZSBMaXN0ZW5lciB7Cgog\nICAgICAgIGJvb2xlYW4gc2NoZW1hT2JqZWN0R2VuZXJhdGVkKEV2ZW50IGUp\nOwogICAgfQoKICAgIC8qKgogICAgICogQW4gZXZlbnQgY29ycmVzcG9uZGlu\nZyB0byB0aGUgZ2VuZXJhdGlvbiBvZiBhIHNjaGVtYSBvYmplY3QuCiAgICAg\nKi8KICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQogICAgcHVibGlj\nIGNsYXNzIEV2ZW50CiAgICAgICAgZXh0ZW5kcyBFdmVudE9iamVjdCB7Cgog\nICAgICAgIHByaXZhdGUgZmluYWwgaW50IF90b3RhbDsKCiAgICAgICAgcHVi\nbGljIEV2ZW50KE9iamVjdCBvYiwgaW50IHRvdGFsKSB7CiAgICAgICAgICAg\nIHN1cGVyKG9iKTsKICAgICAgICAgICAgX3RvdGFsID0gdG90YWw7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldFRvdGFsKCkgewogICAgICAg\nICAgICByZXR1cm4gX3RvdGFsOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

