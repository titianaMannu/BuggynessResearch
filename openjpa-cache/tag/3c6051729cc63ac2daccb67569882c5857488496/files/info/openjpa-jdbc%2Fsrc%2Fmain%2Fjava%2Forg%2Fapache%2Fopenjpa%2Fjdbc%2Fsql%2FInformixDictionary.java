{"sha":"c7028113c1e51b995c19dde5e05317e77bd38506","node_id":"MDQ6QmxvYjIwNjM2NDpjNzAyODExM2MxZTUxYjk5NWMxOWRkZTVlMDUzMTdlNzdiZDM4NTA2","size":14689,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c7028113c1e51b995c19dde5e05317e77bd38506","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNl\nTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsK\naW1wb3J0IGphdmEuc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0\nIGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZp\nZXIuREJJZGVudGlmaWVyVHlwZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkluZGV4OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhh\nc2hTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3Vw\ncG9ydGVkRXhjZXB0aW9uOwoKLyoqCiAqIERpY3Rpb25hcnkgZm9yIEluZm9y\nbWl4IGRhdGFiYXNlLiBOb3RhYmxlIGZlYXR1cmVzOgogKiA8dWw+CiAqIDxs\naT5JbmZvcm1peCBkb2VzIG5vdCBhbGxvdyBwZXNzaW1pc3RpYyBsb2NraW5n\nIG9uIHNjcm9sbGFibGUgcmVzdWx0CiAqIHNldHMuPC9saT4KICogPGxpPlNF\nVCBMT0NLIE1PREUgVE8gV0FJVCBOIHN0YXRlbWVudHMgYXJlIGlzc3VlZCB0\nbyB3YWl0IG9uIGxvY2tzLiBTZWUKICoge0BsaW5rICNsb2NrV2FpdFNlY29u\nZHN9IGFuZCB7QGxpbmsgI2xvY2tNb2RlRW5hYmxlZH0uPC9saT4KICogPGxp\nPkxPQ0sgTU9ERSBST1cgaXMgdXNlZCBieSBkZWZhdWx0IGZvciB0YWJsZSBj\ncmVhdGlvbiB0byBhbGxvdyB0aGUKICogbWF4aW11bSBjb25jdXJyZW5jeS48\nL2xpPgogKiA8L3VsPgogKi8KcHVibGljIGNsYXNzIEluZm9ybWl4RGljdGlv\nbmFyeQogICAgZXh0ZW5kcyBEQkRpY3Rpb25hcnkgewoKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIFZFTkRPUl9JQk0gPSAiaWJtIjsKCiAgICAv\nKioKICAgICAqIElmIHRydWUsIHRoZW4gd2Ugd2lsbCBpc3N1ZSBhICJTRVQg\nTE9DSyBNT0RFIFRPIFdBSVQgTiIKICAgICAqIHN0YXRlbWVudCB3aGVuZXZl\nciB3ZSBjcmVhdGUgYSB7QGxpbmsgQ29ubmVjdGlvbn0sIGluIG9yZGVyCiAg\nICAgKiBhbGxvdyB3YWl0aW5nIG9uIGxvY2tzLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBsb2NrTW9kZUVuYWJsZWQgPSBmYWxzZTsKCiAgICAvKioK\nICAgICAqIElmIHtAbGluayAjbG9ja01vZGVFbmFibGVkfSBpcyA8Y29kZT50\ncnVlPC9jb2RlPiwgdGhlbiB0aGlzCiAgICAgKiBwYXJhbWV0ZXIgc3BlY2lm\naWVzIHRoZSBudW1iZXIgb2Ygc2Vjb25kcyB3ZSB3aWxsIHdhaXQgdG8KICAg\nICAqIG9idGFpbiBhIGxvY2sgZm9yIGluc2VydHMgYW5kIHBlc3NpbWlzdGlj\nIGxvY2tpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgbG9ja1dhaXRTZWNv\nbmRzID0gMzA7CgogICAgLyoqCiAgICAgKiBJbmZvcm1peCBKREJDIG1ldGFk\nYXRhIGZvciBhbGwga25vd24gZHJpdmVycyByZXR1cm5zIHdpdGggdGhlCiAg\nICAgKiB0YWJsZSBjYXRhbG9nIGFuZCB0aGUgdGFibGUgc2NoZW1hIG5hbWUg\nc3dhcHBlZC4gQSA8Y29kZT50cnVlPC9jb2RlPgogICAgICogdmFsdWUgZm9y\nIHRoaXMgcHJvcGVydHkgaW5kaWNhdGVzIHRoYXQgdGhleSBzaG91bGQgYmUg\ncmV2ZXJzZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHN3YXBTY2hl\nbWFBbmRDYXRhbG9nID0gdHJ1ZTsKCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiB1\nc2VKQ0MgPSBmYWxzZTsKICAgIC8vIHdlYWsgc2V0IG9mIGNvbm5lY3Rpb25z\nIHdlJ3ZlIGFscmVhZHkgZXhlY3V0ZWQgbG9jayBtb2RlIHNxbCBvbgogICAg\ncHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIF9zZWVuQ29ubmVjdGlvbnMgPSBu\nZXcgUmVmZXJlbmNlSGFzaFNldAogICAgICAgIChSZWZlcmVuY2VIYXNoU2V0\nLldFQUspOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoSW5mb3JtaXhE\naWN0aW9uYXJ5LmNsYXNzKTsKCiAgICBwdWJsaWMgSW5mb3JtaXhEaWN0aW9u\nYXJ5KCkgewogICAgICAgIHBsYXRmb3JtID0gIkluZm9ybWl4IjsKICAgICAg\nICB2YWxpZGF0aW9uU1FMID0gIlNFTEVDVCBGSVJTVCAxIENVUlJFTlQgVElN\nRVNUQU1QICIKICAgICAgICAgICAgKyAiRlJPTSBpbmZvcm1peC5zeXN0YWJs\nZXMiOwoKICAgICAgICBzdXBwb3J0c0F1dG9Bc3NpZ24gPSB0cnVlOwogICAg\nICAgIGF1dG9Bc3NpZ25UeXBlTmFtZSA9ICJzZXJpYWwiOwogICAgICAgIGxh\nc3RHZW5lcmF0ZWRLZXlRdWVyeSA9ICJTRUxFQ1QgRklSU1QgMSBEQklORk8o\nJ3NxbGNhLnNxbGVycmQxJykgIgogICAgICAgICAgICArICJGUk9NIGluZm9y\nbWl4LnN5c3RhYmxlcyI7CgogICAgICAgIC8vIGluZm9ybWl4IGFjdHVhbGx5\nIGRvZXMgc3VwcG9ydCBkZWZlcnJlZCBjb25zdHJhaW50cywgYnV0IG5vdAog\nICAgICAgIC8vIGluIHRoZSB0YWJsZSBkZWZpbml0aW9uOyBkZWZlcnJlZCBj\nb25zdHJhaW50cyBjYW4gYmUgYWN0aXZhdGVkIGJ5CiAgICAgICAgLy8gaW52\nb2tpbmcgInNldCBjb25zdHJhaW50cyBhbGwgZGVmZXJyZWQiIG9uIHRoZSBj\nb25uZWN0aW9uLCB3aGljaAogICAgICAgIC8vIHdlIGRvbid0IGRvIHlldAog\nICAgICAgIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IGZhbHNlOwog\nICAgICAgIGNvbnN0cmFpbnROYW1lTW9kZSA9IENPTlNfTkFNRV9BRlRFUjsK\nCiAgICAgICAgLy8gaW5mb3JtaXggc3VwcG9ydHMgIkNMT0IiIHR5cGUsIGJ1\ndCBhbnkgYXR0ZW1wdCB0byBpbnNlcnQKICAgICAgICAvLyBpbnRvIHRoZW0g\ncmFpc2VzOiAiamF2YS5zcWwuU1FMRXhjZXB0aW9uOiBDYW4ndCBjb252ZXJ0\nIGZyb21udWxsIgogICAgICAgIHVzZUdldFN0cmluZ0ZvckNsb2JzID0gdHJ1\nZTsKICAgICAgICBsb25nVmFyY2hhclR5cGVOYW1lID0gIlRFWFQiOwogICAg\nICAgIGNsb2JUeXBlTmFtZSA9ICJURVhUIjsKICAgICAgICBzbWFsbGludFR5\ncGVOYW1lID0gIklOVDgiOwogICAgICAgIHRpbnlpbnRUeXBlTmFtZSA9ICJJ\nTlQ4IjsKICAgICAgICBmbG9hdFR5cGVOYW1lID0gIkZMT0FUIjsKICAgICAg\nICBiaXRUeXBlTmFtZSA9ICJCT09MRUFOIjsKICAgICAgICBibG9iVHlwZU5h\nbWUgPSAiQllURSI7CiAgICAgICAgZG91YmxlVHlwZU5hbWUgPSAiTlVNRVJJ\nQygzMiwyMCkiOwogICAgICAgIGRhdGVUeXBlTmFtZSA9ICJEQVRFIjsKICAg\nICAgICB0aW1lVHlwZU5hbWUgPSAiREFURVRJTUUgSE9VUiBUTyBTRUNPTkQi\nOwogICAgICAgIHRpbWVzdGFtcFR5cGVOYW1lID0gIkRBVEVUSU1FIFlFQVIg\nVE8gRlJBQ1RJT04oMykiOwogICAgICAgIGRvdWJsZVR5cGVOYW1lID0gIk5V\nTUVSSUMoMzIsMjApIjsKICAgICAgICBmbG9hdFR5cGVOYW1lID0gIlJFQUwi\nOwogICAgICAgIGJpZ2ludFR5cGVOYW1lID0gIk5VTUVSSUMoMzIsMCkiOwog\nICAgICAgIGRvdWJsZVR5cGVOYW1lID0gIkRPVUJMRSBQUkVDSVNJT04iOwog\nICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFsbChBcnJheXMuYXNM\naXN0KG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkJZVEUiLCAiRE9VQkxF\nIFBSRUNJU0lPTiIsICJJTlRFUlZBTCIsICJTTUFMTEZMT0FUIiwgIlRFWFQi\nLAogICAgICAgICAgICAiSU5UOCIsCiAgICAgICAgfSkpOwoKICAgICAgICBz\ndXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgPSBmYWxzZTsKICAg\nICAgICBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMgPSBmYWxz\nZTsKICAgICAgICBzdXBwb3J0c0xvY2tpbmdXaXRoT3JkZXJDbGF1c2UgPSBm\nYWxzZTsKCiAgICAgICAgLy8gdGhlIGluZm9ybWl4IEpEQkMgZHJpdmVycyBo\nYXZlIHByb2JsZW1zIHdpdGggdXNpbmcgdGhlCiAgICAgICAgLy8gc2NoZW1h\nIG5hbWUgaW4gcmVmbGVjdGlvbiBvbiBjb2x1bW5zIGFuZCB0YWJsZXMKICAg\nICAgICBzdXBwb3J0c1NjaGVtYUZvckdldENvbHVtbnMgPSBmYWxzZTsKICAg\nICAgICBzdXBwb3J0c1NjaGVtYUZvckdldFRhYmxlcyA9IGZhbHNlOwoKICAg\nICAgICAvLyBJbmZvcm1peCBkb2Vzbid0IHN1cHBvcnQgYWxpYXNlcyBpbiBk\nZWxldGVzIGlmIHRoZSB0YWJsZSBoYXMgYW4gaW5kZXgKICAgICAgICBhbGxv\nd3NBbGlhc0luQnVsa0NsYXVzZSA9IGZhbHNlOwogICAgICAgIAogICAgICAg\nIC8vIEluZm9ybWl4IGRvZXNuJ3QgdW5kZXJzdGFuZCAiWCBDUk9TUyBKT0lO\nIFkiLCBidXQgaXQgZG9lcyB1bmRlcnN0YW5kCiAgICAgICAgLy8gdGhlIGVx\ndWl2YWxlbnQgIlggSk9JTiBZIE9OIDEgPSAxIgogICAgICAgIGNyb3NzSm9p\nbkNsYXVzZSA9ICJKT0lOIjsKICAgICAgICByZXF1aXJlc0NvbmRpdGlvbkZv\nckNyb3NzSm9pbiA9IHRydWU7CgogICAgICAgIGNvbmNhdGVuYXRlRnVuY3Rp\nb24gPSAiQ09OQ0FUKHswfSx7MX0pIjsKICAgICAgICBuZXh0U2VxdWVuY2VR\ndWVyeSA9ICJTRUxFQ1QgezB9Lk5FWFRWQUwgRlJPTSBTWVNUQUJMRVMgV0hF\nUkUgVEFCSUQ9MSI7CiAgICAgICAgc3VwcG9ydHNDb3JyZWxhdGVkU3Vic2Vs\nZWN0ID0gZmFsc2U7CiAgICAgICAgc3dhcFNjaGVtYUFuZENhdGFsb2cgPSBm\nYWxzZTsKICAgICAgICAKICAgICAgICAvLyBJbmZvcm1peCBkb2VzIG5vdCBz\ndXBwb3J0IGZvcmVpZ24ga2V5IGRlbGV0ZSBhY3Rpb24gTlVMTCBvciBERUZB\nVUxUCiAgICAgICAgc3VwcG9ydHNOdWxsRGVsZXRlQWN0aW9uID0gZmFsc2U7\nCiAgICAgICAgc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0gZmFsc2U7\nCiAgICAgICAgCiAgICAgICAgdHJpbVNjaGVtYU5hbWUgPSB0cnVlOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY29ubmVjdGVkQ29u\nZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuY29ubmVjdGVkQ29uZmlndXJh\ndGlvbihjb25uKTsKCiAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRhID0g\nY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgIFN0cmluZyBkcml2ZXJOYW1l\nID0gbWV0YS5nZXREcml2ZXJOYW1lKCk7CiAgICAgICAgaWYgKGRyaXZlck5h\nbWUgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoZHJpdmVyTmFtZS5lcXVh\nbHMoIklCTSBEQjIgSkRCQyBVbml2ZXJzYWwgRHJpdmVyIEFyY2hpdGVjdHVy\nZSIpKQogICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgZHJpdmVyVmVu\nZG9yID0gVkVORE9SX0lCTTsKICAgICAgICAgICAgICAgIHVzZUpDQyA9IHRy\ndWU7CiAgICAgICAgICAgICAgICBzZXRJZGVudGlmaWVyQ2FzZShtZXRhKTsK\nICAgICAgICAgICAgfSAKICAgICAgICAgICAgZWxzZSBpZiAoZHJpdmVyTmFt\nZS5lcXVhbHMoIklCTSBJbmZvcm1peCBKREJDIERyaXZlciBmb3IgSUJNIElu\nZm9ybWl4IER5bmFtaWMgU2VydmVyIikpIHsKICAgICAgICAgICAgICAgIHNl\ndElkZW50aWZpZXJDYXNlKG1ldGEpOwogICAgICAgICAgICAgICAgZHJpdmVy\nVmVuZG9yID0gVkVORE9SX0lCTTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBlbHNlIGlmICgiSW5mb3JtaXgiLmVxdWFsc0lnbm9yZUNhc2UoZHJpdmVy\nTmFtZSkpCiAgICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1Jf\nREFUQURJUkVDVDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nZHJpdmVyVmVuZG9yID0gVkVORE9SX09USEVSOwogICAgICAgIH0gZWxzZQog\nICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfT1RIRVI7CgogICAg\nICAgIGlmIChpc0pEQkMzKSB7CiAgICAgICAgICAgIGNvbm4uc2V0SG9sZGFi\naWxpdHkoUmVzdWx0U2V0LkhPTERfQ1VSU09SU19PVkVSX0NPTU1JVCk7CiAg\nICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiY29ubmVjdGlvbi1kZWZhdWx0\ncyIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgICAgICBjb25uLmdl\ndEF1dG9Db21taXQoKSwgY29ubi5nZXRIb2xkYWJpbGl0eSgpLAogICAgICAg\nICAgICAgICAgICAgIGNvbm4uZ2V0VHJhbnNhY3Rpb25Jc29sYXRpb24oKX0p\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBzZXRJ\nZGVudGlmaWVyQ2FzZShEYXRhYmFzZU1ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBsb3dlciBjYXNlIGlkZW50aWZpZXJz\nIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgSkNDIGFuZCBuZXdlcgogICAgICAg\nICAgICAvLyBJbmZvcm1peCBKREJDIGRyaXZlcnMKICAgICAgICAgICAgaWYg\nKG1ldGEuc3RvcmVzTG93ZXJDYXNlSWRlbnRpZmllcnMoKSkgeyAKICAgICAg\nICAgICAgICAgIHNjaGVtYUNhc2UgPSBTQ0hFTUFfQ0FTRV9MT1dFUjsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChtZXRhLnN0b3Jlc01p\neGVkQ2FzZUlkZW50aWZpZXJzKCkpIHsKICAgICAgICAgICAgICAgIHNjaGVt\nYUNhc2UgPSBTQ0hFTUFfQ0FTRV9QUkVTRVJWRTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAvLyBvdGhlcndpc2UsIHVzZSB0aGUgZGVmYXVsdCAodXBw\nZXIpCiAgICAgICAgfQogICAgICAgIGNhdGNoIChTUUxFeGNlcHRpb24gZSkg\newogICAgICAgICAgICBnZXRMb2coKS53YXJuKCJjYW5ub3QtZGV0ZXJtaW5l\nLWlkZW50aWZpZXItYmFzZS1jYXNlIik7CiAgICAgICAgICAgIGlmIChnZXRM\nb2coKS5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBnZXRM\nb2coKS50cmFjZShlLnRvU3RyaW5nKCksIGUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENvbHVt\nbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcg\nY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRh\nYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUsIENvbm5lY3Rpb24gY29ubikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\nZ2V0Q29sdW1ucyhtZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRh\nbG9nKSwgCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2No\nZW1hTmFtZSksREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlTmFtZSksCiAg\nICAgICAgICAgIERCSWRlbnRpZmllci5uZXdDb2x1bW4oY29sdW1uTmFtZSks\nIGNvbm4pOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENvbHVt\nbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBEQklkZW50\naWZpZXIgY2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIgc2NoZW1hTmFt\nZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgREJJZGVudGlmaWVyIGNvbHVt\nbk5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gc3VwZXIuZ2V0Q29s\ndW1ucyhtZXRhLCBjYXRhbG9nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsCiAg\nICAgICAgICAgIGNvbHVtbk5hbWUsIGNvbm4pOwoKICAgICAgICAvLyB0cmVh\ndCBsb2d2YXJjaGFyIGFzIGNsb2IKICAgICAgICBmb3IgKGludCBpID0gMDsg\nY29scyAhPSBudWxsICYmIGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoY29sc1tpXS5nZXRUeXBlKCkgPT0gVHlwZXMuTE9OR1ZBUkNI\nQVIpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQ0xP\nQik7CiAgICAgICAgcmV0dXJuIGNvbHM7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgQ29sdW1uIG5ld0NvbHVtbihSZXN1bHRTZXQgY29sTWV0\nYSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDb2x1\nbW4gY29sID0gc3VwZXIubmV3Q29sdW1uKGNvbE1ldGEpOwogICAgICAgIGlm\nIChzd2FwU2NoZW1hQW5kQ2F0YWxvZykKICAgICAgICAgICAgY29sLnNldFNj\naGVtYUlkZW50aWZpZXIoZnJvbURCTmFtZShjb2xNZXRhLmdldFN0cmluZygi\nVEFCTEVfQ0FUIiksIERCSWRlbnRpZmllclR5cGUuQ0FUQUxPRykpOwogICAg\nICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgUHJpbWFyeUtleSBuZXdQcmltYXJ5S2V5KFJlc3VsdFNldCBwa01ldGEp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUHJpbWFy\neUtleSBwayA9IHN1cGVyLm5ld1ByaW1hcnlLZXkocGtNZXRhKTsKICAgICAg\nICBpZiAoc3dhcFNjaGVtYUFuZENhdGFsb2cpCiAgICAgICAgICAgIHBrLnNl\ndFNjaGVtYUlkZW50aWZpZXIoZnJvbURCTmFtZShwa01ldGEuZ2V0U3RyaW5n\nKCJUQUJMRV9DQVQiKSwgREJJZGVudGlmaWVyVHlwZS5DQVRBTE9HKSk7CiAg\nICAgICAgcmV0dXJuIHBrOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIEluZGV4IG5ld0luZGV4KFJlc3VsdFNldCBpZHhNZXRhKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEluZGV4IGlkeCA9IHN1\ncGVyLm5ld0luZGV4KGlkeE1ldGEpOwogICAgICAgIGlmIChzd2FwU2NoZW1h\nQW5kQ2F0YWxvZykKICAgICAgICAgICAgaWR4LnNldFNjaGVtYUlkZW50aWZp\nZXIoZnJvbURCTmFtZShpZHhNZXRhLmdldFN0cmluZygiVEFCTEVfQ0FUIiks\nIERCSWRlbnRpZmllclR5cGUuQ0FUQUxPRykpOwogICAgICAgIHJldHVybiBp\nZHg7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXRC\nb29sZWFuKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBib29s\nZWFuIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIC8vIGluZm9ybWl4IGFjdHVhbGx5IHJl\ncXVpcmVzIHRoYXQgYSBib29sZWFuIGJlIHNldDogaXQgY2Fubm90CiAgICAg\nICAgLy8gaGFuZGxlIGEgbnVtZXJpYyBhcmd1bWVudAogICAgICAgIHN0bW50\nLnNldFN0cmluZyhpZHgsIHZhbCA/ICJ0IiA6ICJmIik7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVT\nUUwoVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJpbmdbXSBjcmVhdGUgPSBz\ndXBlci5nZXRDcmVhdGVUYWJsZVNRTCh0YWJsZSk7CiAgICAgICAgY3JlYXRl\nWzBdID0gY3JlYXRlWzBdICsgIiBMT0NLIE1PREUgUk9XIjsKICAgICAgICBy\nZXR1cm4gY3JlYXRlOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIFN0cmluZ1tdIGdldEFkZFByaW1hcnlLZXlTUUwoUHJpbWFyeUtleSBwaykg\newogICAgICAgIFN0cmluZyBwa3NxbCA9IGdldFByaW1hcnlLZXlDb25zdHJh\naW50U1FMKHBrKTsKICAgICAgICBpZiAocGtzcWwgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5l\ndyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRG\ndWxsTmFtZShway5nZXRUYWJsZSgpLCBmYWxzZSkgKyAiIEFERCBDT05TVFJB\nSU5UICIgKyBwa3NxbCB9OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIFN0cmluZ1tdIGdldEFkZEZvcmVpZ25LZXlTUUwoRm9yZWlnbktleSBm\naykgewogICAgICAgIFN0cmluZyBma3NxbCA9IGdldEZvcmVpZ25LZXlDb25z\ndHJhaW50U1FMKGZrKTsKICAgICAgICBpZiAoZmtzcWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBn\nZXRGdWxsTmFtZShmay5nZXRUYWJsZSgpLCBmYWxzZSkgKyAiIEFERCBDT05T\nVFJBSU5UICIgKyBma3NxbCB9OwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQo\nU2VsZWN0IHNlbCwKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSkgewogICAg\nICAgIHJldHVybiAhZm9yVXBkYXRlICYmICFzZWwuaXNMb2IoKQogICAgICAg\nICAgICAmJiBzdXBlci5zdXBwb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNldChz\nZWwsIGZvclVwZGF0ZSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgQ29ubmVjdGlvbiBkZWNvcmF0ZShDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgY29ubiA9IHN1cGVy\nLmRlY29yYXRlKGNvbm4pOwogICAgICAgIGlmIChpc0pEQkMzICYmIGNvbm4u\nZ2V0SG9sZGFiaWxpdHkoKSAhPSAKICAgICAgICAgICAgUmVzdWx0U2V0LkhP\nTERfQ1VSU09SU19PVkVSX0NPTU1JVCkgewogICAgICAgICAgICBjb25uLnNl\ndEhvbGRhYmlsaXR5KFJlc3VsdFNldC5IT0xEX0NVUlNPUlNfT1ZFUl9DT01N\nSVQpOwogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsg\nICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJjb25uZWN0aW9uLWRlZmF1bHRzIiwgbmV3IE9iamVjdFtd\newogICAgICAgICAgICAgICAgICAgIGNvbm4uZ2V0QXV0b0NvbW1pdCgpLCBj\nb25uLmdldEhvbGRhYmlsaXR5KCksCiAgICAgICAgICAgICAgICAgICAgY29u\nbi5nZXRUcmFuc2FjdGlvbklzb2xhdGlvbigpfSkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBpZiB3ZSBoYXZlbid0IGFscmVhZHkg\nZG9uZSBzbywgaW5pdGlhbGl6ZSB0aGUgbG9jayBtb2RlIG9mIHRoZQogICAg\nICAgIC8vIGNvbm5lY3Rpb24KICAgICAgICBpZiAoX3NlZW5Db25uZWN0aW9u\ncy5hZGQoY29ubikpIHsKICAgICAgICAgICAgaWYgKGxvY2tNb2RlRW5hYmxl\nZCkgewogICAgICAgICAgICAgICAgU3RyaW5nIHNxbCA9ICJTRVQgTE9DSyBN\nT0RFIFRPIFdBSVQiOwogICAgICAgICAgICAgICAgaWYgKGxvY2tXYWl0U2Vj\nb25kcyA+IDApCiAgICAgICAgICAgICAgICAgICAgc3FsID0gc3FsICsgIiAi\nICsgbG9ja1dhaXRTZWNvbmRzOwogICAgICAgICAgICAgICAgZXhlY3V0ZShz\ncWwsIGNvbm4sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFN0\ncmluZyBzcWwgPSAiU0VUIEVOVklST05NRU5UIFJFVEFJTlVQREFURUxPQ0tT\nICdBTEwnIjsKICAgICAgICAgICAgZXhlY3V0ZShzcWwsIGNvbm4sIGZhbHNl\nKTsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBkYXRhZGlyZWN0IGRyaXZl\nciByZXF1aXJlcyB0aGF0IHdlIGlzc3VlIGEgcm9sbGJhY2sgYmVmb3JlIHVz\naW5nCiAgICAgICAgLy8gZWFjaCBjb25uZWN0aW9uCiAgICAgICAgaWYgKFZF\nTkRPUl9EQVRBRElSRUNULmVxdWFsc0lnbm9yZUNhc2UoZHJpdmVyVmVuZG9y\nKSkKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbm4ucm9s\nbGJhY2soKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gY29ubjsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSB2b2lkIGV4ZWN1dGUoU3RyaW5nIHNxbCwgQ29u\nbmVjdGlvbiBjb25uLCBib29sZWFuIHRocm93RXhjKSB7CiAgICAgICAgU3Rh\ndGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBzdG1udCA9IGNvbm4uY3JlYXRlU3RhdGVtZW50KCk7CiAgICAgICAgICAg\nIHN0bW50LmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgaWYgKHRocm93RXhjKQog\nICAgICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShz\nZSwgdGhpcyk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nIGxvZy50cmFjZShfbG9jLmdldCgiY2FuLW5vdC1leGVjdXRlIiwgc3FsKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIGluZGV4T2YoU1FMQnVmZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgc3Ry\nLCBGaWx0ZXJWYWx1ZSBmaW5kLAogICAgICAgIEZpbHRlclZhbHVlIHN0YXJ0\nKSB7CiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJmdW5jdGlvbi1ub3Qtc3VwcG9ydGVkIiwKICAgICAgICAgICAg\nICAgIGdldENsYXNzKCksICJMT0NBVEUiKSk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgYm9vbGVhbiBuZWVkc1RvQ3JlYXRlSW5kZXgoSW5k\nZXggaWR4LCBUYWJsZSB0YWJsZSkgewogICAgICAgLy8gSW5mb3JtaXggd2ls\nbCBhdXRvbWF0aWNhbGx5IGNyZWF0ZSBhIHVuaXF1ZSBpbmRleCBmb3IgdGhl\nIAogICAgICAgLy8gcHJpbWFyeSBrZXksIHNvIGRvbid0IGNyZWF0ZSBhbm90\naGVyIGluZGV4IGFnYWluCiAgICAgICBQcmltYXJ5S2V5IHBrID0gdGFibGUu\nZ2V0UHJpbWFyeUtleSgpOwogICAgICAgaWYgKHBrICE9IG51bGwgJiYgaWR4\nLmNvbHVtbnNNYXRjaChway5nZXRDb2x1bW5zKCkpKQogICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAg\nICBwdWJsaWMgYm9vbGVhbiB1c2VKQ0MoKSB7CiAgICAgICAgcmV0dXJuIHVz\nZUpDQzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gREIgc3Bl\nY2lmaWMgc2NoZW1hQ2FzZSAKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgU3RyaW5nIGdldFNjaGVtYUNhc2UoKXsKICAgICAgICByZXR1cm4g\nc2NoZW1hQ2FzZTsKICAgIH0KICAgICAgICAKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIGJvb2xlYW4gaXNGYXRhbEV4Y2VwdGlvbihpbnQgc3VidHlwZSwg\nU1FMRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgCiAgICAgICAgLy8gU1FMIFN0\nYXRlIG9mIElYMDAwIGlzIGEgZ2VuZXJhbCBwdXJwb3NlIEluZm9ybWl4IGVy\ncm9yIGNvZGUKICAgICAgICAvLyBjYXRlZ29yeSwgc28gb25seSByZXR1cm4g\nQm9vbGVhbi5UUlVFIGlmIHdlIG1hdGNoIFNRTCBDb2RlcwogICAgICAgIC8v\nIHJlY292ZXJhYmxlID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICBpZiAoKHN1\nYnR5cGUgPT0gU3RvcmVFeGNlcHRpb24uTE9DSyAmJiBleC5nZXRFcnJvckNv\nZGUoKSA9PSAtMTU0KSAKICAgICAgICAgIHx8KHN1YnR5cGUgPT0gU3RvcmVF\neGNlcHRpb24uUVVFUlkgJiYgZXguZ2V0RXJyb3JDb2RlKCkgPT0gLTIxMykp\nIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICByZXR1cm4gc3VwZXIuaXNGYXRhbEV4Y2VwdGlvbihzdWJ0\neXBlLCBleCk7CiAgICB9Cn0KCg==\n","encoding":"base64"}

