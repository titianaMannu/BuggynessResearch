{"sha":"15c58491d1c551fdb3d9ae566a5844b5b98675d4","node_id":"MDQ6QmxvYjIwNjM2NDoxNWM1ODQ5MWQxYzU1MWZkYjNkOWFlNTY2YTU4NDRiNWI5ODY3NWQ0","size":27807,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/15c58491d1c551fdb3d9ae566a5844b5b98675d4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRhdGFDYWNoZVJldHJpZXZl\nTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGF0YUNh\nY2hlU3RvcmVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5EZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tMZXZlbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3Np\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJ\nZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNF\neGNlcHRpb247CgovKioKICogU3RvcmVNYW5hZ2VyIHByb3h5IHRoYXQgZGVs\nZWdhdGVzIHRvIGEgZGF0YSBjYWNoZSB3aGVuIHBvc3NpYmxlLgogKgogKiBA\nYXV0aG9yIFBhdHJpY2sgTGluc2tleQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgRGF0YUNhY2hlU3RvcmVNYW5hZ2VyCiAgICBleHRlbmRzIERl\nbGVnYXRpbmdTdG9yZU1hbmFnZXIgewoKICAgIC8vIGFsbCB0aGUgc3RhdGUg\nbWFuYWdlcnMgY2hhbmdlZCBpbiB0aGlzIHRyYW5zYWN0aW9uCiAgICBwcml2\nYXRlIENvbGxlY3Rpb248T3BlbkpQQVN0YXRlTWFuYWdlcj4gX2luc2VydHMg\nPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwg\nQml0U2V0PiBfdXBkYXRlcyA9IG51bGw7CiAgICBwcml2YXRlIENvbGxlY3Rp\nb248T3BlbkpQQVN0YXRlTWFuYWdlcj4gX2RlbGV0ZXMgPSBudWxsOwoKICAg\nIC8vIHRoZSBvd25pbmcgY29udGV4dAogICAgcHJpdmF0ZSBTdG9yZUNvbnRl\neHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIERhdGFDYWNoZU1hbmFnZXIg\nX21nciA9IG51bGw7CiAgICAvLyBwYyBkYXRhIGdlbmVyYXRvcgogICAgcHJp\ndmF0ZSBQQ0RhdGFHZW5lcmF0b3IgX2dlbiA9IG51bGw7CgogICAgLyoqCiAg\nICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFyYW0gc20gdGhl\nIHN0b3JlIG1hbmFnZXIgdG8gZGVsZWdhdGUgdG8KICAgICAqLwogICAgcHVi\nbGljIERhdGFDYWNoZVN0b3JlTWFuYWdlcihTdG9yZU1hbmFnZXIgc20pIHsK\nICAgICAgICBzdXBlcihzbSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nQ29udGV4dChTdG9yZUNvbnRleHQgY3R4KSB7CiAgICAgICAgX2N0eCA9IGN0\neDsKICAgICAgICBfbWdyID0gY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRE\nYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfZ2VuID0gX21n\nci5nZXRQQ0RhdGFHZW5lcmF0b3IoKTsKICAgICAgICBzdXBlci5zZXRDb250\nZXh0KGN0eCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW4oKSB7CiAg\nICAgICAgc3VwZXIuYmVnaW4oKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nb21taXQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3VwZXIuY29t\nbWl0KCk7CiAgICAgICAgICAgIHVwZGF0ZUNhY2hlcygpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIF9pbnNlcnRzID0gbnVsbDsKICAgICAg\nICAgICAgX3VwZGF0ZXMgPSBudWxsOwogICAgICAgICAgICBfZGVsZXRlcyA9\nIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxi\nYWNrKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN1cGVyLnJvbGxi\nYWNrKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2luc2Vy\ndHMgPSBudWxsOwogICAgICAgICAgICBfdXBkYXRlcyA9IG51bGw7CiAgICAg\nICAgICAgIF9kZWxldGVzID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBFdmljdCBhbGwgbWVtYmVycyBvZiB0aGUgZ2l2ZW4gY2xh\nc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGV2aWN0VHlwZXMoQ29s\nbGVjdGlvbjxDbGFzczw/Pj4gY2xhc3NlcykgewogICAgICAgIGlmIChjbGFz\nc2VzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBN\nZXRhRGF0YVJlcG9zaXRvcnkgbWRyID0gX2N0eC5nZXRDb25maWd1cmF0aW9u\nKCkuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIgPSBfY3R4LmdldENsYXNzTG9hZGVyKCk7Cgog\nICAgICAgIERhdGFDYWNoZSBjYWNoZTsKICAgICAgICBmb3IgKENsYXNzPD8+\nIGNscyA6IGNsYXNzZXMpIHsKICAgICAgICAgICAgY2FjaGUgPSBtZHIuZ2V0\nTWV0YURhdGEoY2xzLCBsb2FkZXIsIGZhbHNlKS5nZXREYXRhQ2FjaGUoKTsK\nICAgICAgICAgICAgaWYgKGNhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBjYWNoZS5yZW1vdmVBbGwoY2xzLCBmYWxzZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVXBkYXRlIGFsbCBjYWNoZXMgd2l0aCB0aGUg\nY29tbWl0dGVkIGluc2VydHMsIHVwZGF0ZXMsIGFuZCBkZWxldGVzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdXBkYXRlQ2FjaGVzKCkgewogICAgICAg\nIGlmKF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuZ2V0Q2FjaGVTdG9y\nZU1vZGUoKSAhPSBEYXRhQ2FjaGVTdG9yZU1vZGUuQllQQVNTICkgeyAKICAg\nICAgICAgICAgLy8gbWFwIGVhY2ggZGF0YSBjYWNoZSB0byB0aGUgbW9kaWZp\nY2F0aW9ucyB3ZSBuZWVkIHRvIHBlcmZvcm0KICAgICAgICAgICAgTWFwPERh\ndGFDYWNoZSxNb2RpZmljYXRpb25zPiBtb2RNYXAgPSBudWxsOwogICAgICAg\nICAgICBpZiAoKF9jdHguZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSAmJiBfaW5z\nZXJ0cyAhPSBudWxsKSB8fCBfdXBkYXRlcyAhPSBudWxsIHx8IF9kZWxldGVz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBtb2RNYXAgPSBuZXcgSGFzaE1h\ncDxEYXRhQ2FjaGUsTW9kaWZpY2F0aW9ucz4oKTsKICAgICAgICAgICAgTW9k\naWZpY2F0aW9ucyBtb2RzOwogICAgICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEg\nZGF0YTsKICAgICAgICAgICAgRGF0YUNhY2hlIGNhY2hlOwoKICAgICAgICAg\nICAgLy8gY3JlYXRlIHBjIGRhdGFzIGZvciBpbnNlcnRzCiAgICAgICAgICAg\nIGlmIChfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCkgJiYgX2luc2VydHMg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm9yIChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtIDogX2luc2VydHMpIHsKICAgICAgICAgICAgICAgICAgICBj\nYWNoZSA9IF9tZ3Iuc2VsZWN0Q2FjaGUoc20pOwogICAgICAgICAgICAgICAg\nICAgIGlmIChjYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgbW9kcyA9IGdldE1v\nZGlmaWNhdGlvbnMobW9kTWFwLCBjYWNoZSk7CiAgICAgICAgICAgICAgICAg\nICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgICAgICAgICAg\nZGF0YS5zdG9yZShzbSk7CiAgICAgICAgICAgICAgICAgICAgbW9kcy5hZGRp\ndGlvbnMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20pKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdXBk\nYXRlIHBjZGF0YXMgZm9yIHVwZGF0ZXMKICAgICAgICAgICAgaWYgKF91cGRh\ndGVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEJpdFNldCBmaWVsZHM7\nCiAgICAgICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtOwogICAg\nICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8T3BlbkpQQVN0YXRlTWFuYWdl\nciwgQml0U2V0PiBlbnRyeSA6IF91cGRhdGVzLmVudHJ5U2V0KCkpIHsgCiAg\nICAgICAgICAgICAgICAgICAgc20gPSBlbnRyeS5nZXRLZXkoKTsKICAgICAg\nICAgICAgICAgICAgICBmaWVsZHMgPSBlbnRyeS5nZXRWYWx1ZSgpOwoKICAg\nICAgICAgICAgICAgICAgICBjYWNoZSA9IF9tZ3Iuc2VsZWN0Q2FjaGUoc20p\nOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gaXQncyBvayBub3Qg\ndG8gY2xvbmUgdGhlIG9iamVjdCB0aGF0IHdlIGdldCBmcm9tIHRoZSBjYWNo\nZSwKICAgICAgICAgICAgICAgICAgICAvLyBzaW5jZSB3ZSdyZSBpbnNpZGUg\ndGhlIGNvbW1pdCgpIG1ldGhvZCwgc28gYW55IG1vZGlmaWNhdGlvbnMKICAg\nICAgICAgICAgICAgICAgICAvLyB0byB0aGUgdW5kZXJseWluZyBjYWNoZSBh\ncmUgdmFsaWQuIElmIHRoZSBjb21taXQgaGFkIG5vdAogICAgICAgICAgICAg\nICAgICAgIC8vIGFscmVhZHkgc3VjY2VlZGVkLCB0aGVuIHdlJ2Qgd2FudCB0\nbyBjbG9uZSB0aGUgcmV0cmlldmVkCiAgICAgICAgICAgICAgICAgICAgLy8g\nb2JqZWN0LgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjYWNoZS5nZXQo\nc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgICAgICAgICAgICAgbW9kcyA9\nIGdldE1vZGlmaWNhdGlvbnMobW9kTWFwLCBjYWNoZSk7CgogICAgICAgICAg\nICAgICAgICAgIC8vIGRhdGEgc2hvdWxkIGFsd2F5cyBiZSBub24tbnVsbCwg\nc2luY2UgdGhlIG9iamVjdCBpcwogICAgICAgICAgICAgICAgICAgIC8vIGRp\ncnR5LCBidXQgbWF5YmUgaXQgZ290IGRyb3BwZWQgZnJvbSB0aGUgY2FjaGUg\naW4gdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gaW50ZXJpbQogICAgICAg\nICAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGRhdGEuc3RvcmUoc20pOwogICAgICAgICAgICAgICAg\nICAgICAgICBtb2RzLm5ld1VwZGF0ZXMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIo\nZGF0YSwgc20pKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICBkYXRhLnN0b3JlKHNtLCBmaWVsZHMpOwog\nICAgICAgICAgICAgICAgICAgICAgICBtb2RzLmV4aXN0aW5nVXBkYXRlcy5h\nZGQobmV3IFBDRGF0YUhvbGRlcihkYXRhLCBzbSkpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gcmVtb3ZlIHBjZGF0YXMgZm9yIGRlbGV0ZXMKICAgICAg\nICAgICAgaWYgKF9kZWxldGVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGZvciAoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA6IF9kZWxldGVzKSB7IAog\nICAgICAgICAgICAgICAgICAgIGNhY2hlID0gX21nci5zZWxlY3RDYWNoZShz\nbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgICAgICBtb2RzID0gZ2V0TW9kaWZpY2F0aW9ucyhtb2RNYXAsIGNhY2hl\nKTsKICAgICAgICAgICAgICAgICAgICBtb2RzLmRlbGV0ZXMuYWRkKHNtLmdl\ndE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBub3RpZnkgdGhlIGNhY2hlcyBvZiB0aGUgY2hh\nbmdlcwogICAgICAgICAgICBpZiAobW9kTWFwICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGZvciAoTWFwLkVudHJ5PERhdGFDYWNoZSxNb2RpZmljYXRp\nb25zPiBlbnRyeSA6IG1vZE1hcC5lbnRyeVNldCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgY2FjaGUgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAg\nICAgICAgICBtb2RzID0gZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHdlJ3JlIG5vdCBjYWNoaW5nIG9sZCB2\nZXJzaW9ucwogICAgICAgICAgICAgICAgICAgIGNhY2hlLndyaXRlTG9jaygp\nOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNhY2hlLmNvbW1pdCgKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRhcyhjYWNoZSwg\nbW9kcy5hZGRpdGlvbnMpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRhcyhjYWNoZSwgbW9k\ncy5uZXdVcGRhdGVzKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2FjaGUsIG1vZHMu\nZXhpc3RpbmdVcGRhdGVzKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbW9kcy5kZWxldGVzKTsKICAgICAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZS53cml0ZVVu\nbG9jaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgd2Ugd2VyZSBp\nbiBsYXJnZVRyYW5zYWN0aW9uIG1vZGUsIHRoZW4gd2UgaGF2ZSByZWNvcmRl\nZAogICAgICAgICAgICAvLyB0aGUgY2xhc3NlcyBvZiB1cGRhdGVkL2RlbGV0\nZWQgb2JqZWN0cyBhbmQgdGhlc2Ugbm93IG5lZWQgdG8gYmUKICAgICAgICAg\nICAgLy8gZXZpY3RlZAogICAgICAgICAgICBpZiAoX2N0eC5pc1RyYWNrQ2hh\nbmdlc0J5VHlwZSgpKSB7CiAgICAgICAgICAgICAgICBldmljdFR5cGVzKF9j\ndHguZ2V0RGVsZXRlZFR5cGVzKCkpOwogICAgICAgICAgICAgICAgZXZpY3RU\neXBlcyhfY3R4LmdldFVwZGF0ZWRUeXBlcygpKTsKICAgICAgICAgICAgfQoK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm1zIGEg\nY29sbGVjdGlvbiBvZiB7QGxpbmsgUENEYXRhSG9sZGVyfXMgdGhhdCBtaWdo\ndCBjb250YWluCiAgICAgKiBzdGFsZSBpbnN0YW5jZXMgaW50byBhIGNvbGxl\nY3Rpb24gb2YgdXAtdG8tZGF0ZSB7QGxpbmsgRGF0YUNhY2hlUENEYXRhfXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxEYXRhQ2FjaGVQQ0RhdGE+IHRy\nYW5zZm9ybVRvVmVyc2lvblNhZmVQQ0RhdGFzKERhdGFDYWNoZSBjYWNoZSwg\nTGlzdDxQQ0RhdGFIb2xkZXI+IGhvbGRlcnMpIHsKICAgICAgICBMaXN0PERh\ndGFDYWNoZVBDRGF0YT4gdHJhbnNmb3JtZWQgPSBuZXcgQXJyYXlMaXN0PERh\ndGFDYWNoZVBDRGF0YT4oaG9sZGVycy5zaXplKCkpOwogICAgICAgIE1hcDxP\nYmplY3QsSW50ZWdlcj4gaWRzID0gbmV3IEhhc2hNYXA8T2JqZWN0LEludGVn\nZXI+KGhvbGRlcnMuc2l6ZSgpKTsKICAgICAgICAvLyB0aGlzIGxpc3QgY291\nbGQgYmUgcmVtb3ZlZCBpZiBEYXRhQ2FjaGUuZ2V0QWxsKCkgdG9vayBhIENv\nbGxlY3Rpb24KICAgICAgICBMaXN0PE9iamVjdD4gaWRMaXN0ID0gbmV3IEFy\ncmF5TGlzdDxPYmplY3Q+KGhvbGRlcnMuc2l6ZSgpKTsKICAgICAgICBpbnQg\naSA9IDA7CiAgICAgICAgZm9yIChQQ0RhdGFIb2xkZXIgaG9sZGVyIDogaG9s\nZGVycykgewogICAgICAgICAgICBpZHMucHV0KGhvbGRlci5zbS5nZXRPYmpl\nY3RJZCgpLCBpKyspOwogICAgICAgICAgICBpZExpc3QuYWRkKGhvbGRlci5z\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICB9CgogICAgICAgIE1hcDxPYmpl\nY3QsRGF0YUNhY2hlUENEYXRhPiBwY2RhdGFzID0gY2FjaGUuZ2V0QWxsKGlk\nTGlzdCk7CiAgICAgICAgZm9yIChFbnRyeTxPYmplY3QsRGF0YUNhY2hlUENE\nYXRhPiBlbnRyeSA6IHBjZGF0YXMuZW50cnlTZXQoKSkgewogICAgICAgICAg\nICBJbnRlZ2VyIGluZGV4ID0gaWRzLmdldChlbnRyeS5nZXRLZXkoKSk7CiAg\nICAgICAgICAgIERhdGFDYWNoZVBDRGF0YSBvbGRwYyA9IGVudHJ5LmdldFZh\nbHVlKCk7CiAgICAgICAgICAgIFBDRGF0YUhvbGRlciBob2xkZXIgPSBob2xk\nZXJzLmdldChpbmRleCk7CiAgICAgICAgICAgIGlmIChvbGRwYyAhPSBudWxs\nICYmIGNvbXBhcmVWZXJzaW9uKGhvbGRlci5zbSwKICAgICAgICAgICAgICAg\nIGhvbGRlci5zbS5nZXRWZXJzaW9uKCksIG9sZHBjLmdldFZlcnNpb24oKSkg\nPT0gVkVSU0lPTl9FQVJMSUVSKQogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVk\nLmFkZChob2xkZXIucGNkYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRyYW5zZm9ybWVkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\ne0BsaW5rIE1vZGlmaWNhdGlvbnN9IGluc3RhbmNlIHRvIHRyYWNrIG1vZGlm\naWNhdGlvbnMKICAgICAqIHRvIHRoZSBnaXZlbiBjYWNoZSwgY3JlYXRpbmcg\nYW5kIGNhY2hpbmcgdGhlIGluc3RhbmNlIGlmIGl0IGRvZXMKICAgICAqIG5v\ndCBhbHJlYWR5IGV4aXN0IGluIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIE1vZGlmaWNhdGlvbnMgZ2V0TW9kaWZpY2F0aW9u\ncyhNYXA8RGF0YUNhY2hlLE1vZGlmaWNhdGlvbnM+IG1vZE1hcCwgRGF0YUNh\nY2hlIGNhY2hlKSB7CiAgICAgICAgTW9kaWZpY2F0aW9ucyBtb2RzID0gKE1v\nZGlmaWNhdGlvbnMpIG1vZE1hcC5nZXQoY2FjaGUpOwogICAgICAgIGlmICht\nb2RzID09IG51bGwpIHsKICAgICAgICAgICAgbW9kcyA9IG5ldyBNb2RpZmlj\nYXRpb25zKCk7CiAgICAgICAgICAgIG1vZE1hcC5wdXQoY2FjaGUsIG1vZHMp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kczsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgRGF0YUNhY2hlIGNhY2hlID0gX21n\nci5zZWxlY3RDYWNoZShzbSk7IAogICAgICAgIGlmIChjYWNoZSAhPSBudWxs\nICYmICFpc0xvY2tpbmcobnVsbCkgJiYgY2FjaGUuY29udGFpbnMoc20uZ2V0\nT2JqZWN0SWQoKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIHJldHVybiBzdXBlci5leGlzdHMoc20sIGVkYXRhKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0NhY2hlZChMaXN0PE9iamVjdD4gb2lkcywgQml0\nU2V0IGVkYXRhKSB7CiAgICAgICAgLy8gSWYgdXNpbmcgcGFydGl0aW9uZWQg\nY2FjaGUsIHdlIHdlcmUgYW5kIHN0aWxsIGFyZSBicm9rZS4KICAgICAgICBE\nYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLmdldFN5c3RlbURhdGFDYWNoZSgpOwog\nICAgICAgIGlmIChjYWNoZSAhPSBudWxsICYmICFpc0xvY2tpbmcobnVsbCkp\nIHsKICAgICAgICAgICAgLy8gQml0U2V0IHNpemUgaXMgbm90IGNvbnNpc3Rl\nbnQuCiAgICAgICAgICAgIGZvcihpbnQgaSA9IDA7IGkgPCBvaWRzLnNpemUo\nKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBPYmplY3Qgb2lkID0gb2lkcy5n\nZXQoaSk7CiAgICAgICAgICAgICAgICAvLyBPbmx5IGNoZWNrIHRoZSBjYWNo\nZSBpZiB3ZSBoYXZlbid0IGZvdW5kIHRoZSBjdXJyZW50IG9pZC4KICAgICAg\nICAgICAgICAgIGlmIChlZGF0YS5nZXQoaSkgPT0gZmFsc2UgJiYgY2FjaGUu\nY29udGFpbnMob2lkKSkgewogICAgICAgICAgICAgICAgICAgIGVkYXRhLnNl\ndChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZihlZGF0YS5jYXJkaW5hbGl0eSgpPT1vaWRzLnNpemUoKSl7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcmV0dXJuIHN1cGVyLmlzQ2FjaGVkKG9pZHMsIGVk\nYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lvbihP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAgICAg\nICBEYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLnNlbGVjdENhY2hlKHNtKTsKICAg\nICAgICBpZiAoY2FjaGUgPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkpCiAg\nICAgICAgICAgIHJldHVybiBzdXBlci5zeW5jVmVyc2lvbihzbSwgZWRhdGEp\nOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YTsKICAgICAgICBPYmpl\nY3QgdmVyc2lvbiA9IG51bGw7CiAgICAgICAgZGF0YSA9IGNhY2hlLmdldChz\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAoIWlzTG9ja2luZyhudWxs\nKSAmJiBkYXRhICE9IG51bGwpCiAgICAgICAgICAgIHZlcnNpb24gPSBkYXRh\nLmdldFZlcnNpb24oKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIGNhY2hl\nZCB2ZXJzaW9uIHVwZGF0ZSBmcm9tIHRoZXJlCiAgICAgICAgaWYgKHZlcnNp\nb24gIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIXZlcnNpb24uZXF1YWxz\nKHNtLmdldFZlcnNpb24oKSkpIHsKICAgICAgICAgICAgICAgIHNtLnNldFZl\ncnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQoKICAgICAgICAvLyB1c2UgZGF0YSBzdG9yZSB2ZXJzaW9uCiAgICAg\nICAgcmV0dXJuIHN1cGVyLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLCBGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgICAgIGJvb2xlYW4gZnJvbURh\ndGFiYXNlOyAKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLnNlbGVj\ndENhY2hlKHNtKTsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9IG51\nbGw7CiAgICAgICAgYm9vbGVhbiB1cGRhdGVDYWNoZSA9IF9jdHguZ2V0RmV0\nY2hDb25maWd1cmF0aW9uKCkuZ2V0Q2FjaGVSZXRyaWV2ZU1vZGUoKSAhPSBE\nYXRhQ2FjaGVSZXRyaWV2ZU1vZGUuQllQQVNTCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAmJiBfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCk7CiAg\nICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgpIAog\nICAgICAgICAgICB8fCBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpLmdl\ndENhY2hlUmV0cmlldmVNb2RlKCkgPT0gRGF0YUNhY2hlUmV0cmlldmVNb2Rl\nLkJZUEFTUwogICAgICAgICAgICB8fCBfY3R4LmdldEZldGNoQ29uZmlndXJh\ndGlvbigpLmdldENhY2hlU3RvcmVNb2RlKCkgPT0gRGF0YUNhY2hlU3RvcmVN\nb2RlLlJFRlJFU0gpIHsKICAgICAgICAgICAgZnJvbURhdGFiYXNlID0gc3Vw\nZXIuaW5pdGlhbGl6ZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5n\nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCAm\nJiAhaXNMb2NraW5nKGZldGNoKSkgeyAgICAgICAgICAgICAgICAKICAgICAg\nICAgICAgICAgIC8vIyMjIHRoZSAnZGF0YS50eXBlJyBhY2Nlc3MgaGVyZSBw\ncm9iYWJseSBuZWVkcyB0byBiZQogICAgICAgICAgICAgICAgLy8jIyMgYWRk\ncmVzc2VkIGZvciBidWcgNTExCiAgICAgICAgICAgICAgICBzbS5pbml0aWFs\naXplKGRhdGEuZ2V0VHlwZSgpLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICBk\nYXRhLmxvYWQoc20sIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAv\nLyBubyBuZWVkIHRvIHVwZGF0ZSB0aGUgY2FjaGUuIAogICAgICAgICAgICAg\nICAgdXBkYXRlQ2FjaGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGZyb21E\nYXRhYmFzZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAvLyBpbml0aWFsaXplIGZyb20gc3RvcmUgbWFuYWdlcgogICAg\nICAgICAgICAgICAgZnJvbURhdGFiYXNlID0gc3VwZXIuaW5pdGlhbGl6ZShz\nbSwgc3RhdGUsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIGlmIChjYWNoZSAhPSBudWxsICYmIChmcm9tRGF0YWJh\nc2UgJiYgdXBkYXRlQ2FjaGUpKSB7CiAgICAgICAgICAgIC8vIHVwZGF0ZSBj\nYWNoZSBpZiB0aGUgcmVzdWx0IGNhbWUgZnJvbSB0aGUgZGF0YWJhc2UgYW5k\nIGNvbmZpZ3VyZWQgdG8gc3RvcmUgb3IgcmVmcmVzaCB0aGUgY2FjaGUuCiAg\nICAgICAgICAgIGNhY2hlU3RhdGVNYW5hZ2VyKGNhY2hlLCBzbSwgZGF0YSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmcm9tRGF0YWJhc2U7CiAgICB9\nCiAgICAKICAgIHByaXZhdGUgdm9pZCBjYWNoZVN0YXRlTWFuYWdlcihEYXRh\nQ2FjaGUgY2FjaGUsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIERhdGFDYWNo\nZVBDRGF0YSBkYXRhKSB7CiAgICAgICAgaWYgKHNtLmlzRmx1c2hlZCgpKSB7\nIAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIG1h\na2Ugc3VyZSB0aGF0IHdlJ3JlIG5vdCB0cnlpbmcgdG8gY2FjaGUgYW4gb2xk\nIHZlcnNpb24KICAgICAgICBjYWNoZS53cml0ZUxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGNvbXBhcmVW\nZXJzaW9uKHNtLCBzbS5nZXRWZXJzaW9uKCksIGRhdGEuZ2V0VmVyc2lvbigp\nKSA9PSBWRVJTSU9OX0VBUkxJRVIpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2FjaGUgbmV3bHkg\nbG9hZGVkIGluZm8uIEl0IGlzIHNhZmUgdG8gY2FjaGUgZGF0YSBmcm9ybQog\nICAgICAgICAgICAvLyBpbml0aWFsaXplKCkgYmVjYXVzZSB0aGlzIG1ldGhv\nZCBpcyBvbmx5IGNhbGxlZCB1cG9uCiAgICAgICAgICAgIC8vIGluaXRpYWwg\nbG9hZCBvZiB0aGUgZGF0YS4KICAgICAgICAgICAgYm9vbGVhbiBpc05ldyA9\nIGRhdGEgPT0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzTmV3KSB7CiAgICAg\nICAgICAgICAgICBkYXRhID0gbmV3UENEYXRhKHNtKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgaWYg\nKGlzTmV3KSB7IAogICAgICAgICAgICAgICAgY2FjaGUucHV0KGRhdGEpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FjaGUudXBk\nYXRlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9hZChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2JqZWN0IGVkYXRhKSB7CiAg\nICAgICAgRGF0YUNhY2hlIGNhY2hlID0gX21nci5zZWxlY3RDYWNoZShzbSk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgp\nIHx8IGJ5cGFzcyhfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpLCBTdG9y\nZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FKSkKICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmxvYWQoc20sIGZpZWxkcywgZmV0Y2gsIGxvY2tMZXZlbCwgZWRh\ndGEpOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9IGNhY2hlLmdl\ndChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAobG9ja0xldmVsID09\nIExvY2tMZXZlbHMuTE9DS19OT05FICYmICFpc0xvY2tpbmcoZmV0Y2gpICYm\nIGRhdGEgIT0gbnVsbCkKICAgICAgICAgICAgZGF0YS5sb2FkKHNtLCBmaWVs\nZHMsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGgo\nKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgLy8g\nbG9hZCBmcm9tIHN0b3JlIG1hbmFnZXI7IGNsb25lIHRoZSBzZXQgb2Ygc3Rp\nbGwtdW5sb2FkZWQgZmllbGRzCiAgICAgICAgLy8gc28gdGhhdCBpZiB0aGUg\nc3RvcmUgbWFuYWdlciBkZWNpZGVzIHRvIG1vZGlmeSBpdCBpdCB3b24ndCBh\nZmZlY3QgdXMKICAgICAgICBpZiAoIXN1cGVyLmxvYWQoc20sIChCaXRTZXQp\nIGZpZWxkcy5jbG9uZSgpLCBmZXRjaCwgbG9ja0xldmVsLCBlZGF0YSkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2N0eC5nZXRQ\nb3B1bGF0ZURhdGFDYWNoZSgpKSB7CiAgICAgICAgICAgIGNhY2hlU3RhdGVN\nYW5hZ2VyKGNhY2hlLCBzbSwgZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0cnVlOwoKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxPYmpl\nY3Q+IGxvYWRBbGwoQ29sbGVjdGlvbjxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBz\nbXMsIFBDU3RhdGUgc3RhdGUsIGludCBsb2FkLAogICAgCQlGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgCWlmIChieXBh\nc3MoZmV0Y2gsIGxvYWQpKSB7CiAgICAJICAgIHJldHVybiBzdXBlci5sb2Fk\nQWxsKHNtcywgc3RhdGUsIGxvYWQsIGZldGNoLCBlZGF0YSk7CiAgICAJfQoK\nICAgICAgICBNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0PiB1bmxv\nYWRlZCA9IG51bGw7CiAgICAgICAgTGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2Vy\nPiBzbUxpc3QgPSBudWxsOwogICAgICAgIE1hcDxEYXRhQ2FjaGUsTGlzdDxP\ncGVuSlBBU3RhdGVNYW5hZ2VyPj4gY2FjaGVzID0gbmV3IEhhc2hNYXA8RGF0\nYUNhY2hlLExpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4+KCk7CiAgICAgICAg\nRGF0YUNhY2hlIGNhY2hlOwogICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRh\nOwogICAgICAgIEJpdFNldCBmaWVsZHM7CgogICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSA6IHNtcykgewogICAgICAgICAgICBjYWNoZSA9\nIF9tZ3Iuc2VsZWN0Q2FjaGUoc20pOwogICAgICAgICAgICBpZiAoY2FjaGUg\nPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAg\nIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51bGwsIHVubG9hZGVkKTsK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgPT0gbnVsbAog\nICAgICAgICAgICAgICAgfHwgbG9hZCAhPSBGT1JDRV9MT0FEX05PTkUKICAg\nICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhP\nTExPVykgewogICAgICAgICAgICAgICAgc21MaXN0ID0gY2FjaGVzLmdldChj\nYWNoZSk7CiAgICAgICAgICAgICAgICBpZiAoc21MaXN0ID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBzbUxpc3QgPSBuZXcgQXJyYXlMaXN0PE9w\nZW5KUEFTdGF0ZU1hbmFnZXI+KCk7CiAgICAgICAgICAgICAgICAgICAgY2Fj\naGVzLnB1dChjYWNoZSwgc21MaXN0KTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHNtTGlzdC5hZGQoc20pOwogICAgICAgICAgICB9IGVs\nc2UgaWYgKCFjYWNoZS5jb250YWlucyhzbS5nZXRPYmplY3RJZCgpKSkKICAg\nICAgICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51bGws\nIHVubG9hZGVkKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChJ\ndGVyYXRvcjxEYXRhQ2FjaGU+IGl0ciA9IGNhY2hlcy5rZXlTZXQoKS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBjYWNoZSA9\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHNtTGlzdCA9IGNhY2hlcy5nZXQo\nY2FjaGUpOwogICAgICAgICAgICBMaXN0PE9iamVjdD4gb2lkTGlzdCA9IG5l\ndyBBcnJheUxpc3Q8T2JqZWN0PihzbUxpc3Quc2l6ZSgpKTsKCiAgICAgICAg\nICAgIGZvciAoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA6IHNtTGlzdCkgewog\nICAgICAgICAgICAgICAgb2lkTGlzdC5hZGQoKE9wZW5KUEFJZCkgc20uZ2V0\nT2JqZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAg\nICAgICAgIE1hcDxPYmplY3QsRGF0YUNhY2hlUENEYXRhPiBkYXRhTWFwID0g\nY2FjaGUuZ2V0QWxsKG9pZExpc3QpOwoKICAgICAgICAgICAgZm9yIChPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtIDogc21MaXN0KSB7CiAgICAgICAgICAgICAg\nICBkYXRhID0gZGF0YU1hcC5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CgogICAg\nICAgICAgICAgICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIyMjIHRoZSAnZGF0YS50eXBl\nJyBhY2Nlc3MgaGVyZSBwcm9iYWJseSBuZWVkcwogICAgICAgICAgICAgICAg\nICAgICAgICAvLyMjIyB0byBiZSBhZGRyZXNzZWQgZm9yIGJ1ZyA1MTEKICAg\nICAgICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShkYXRhLmdldFR5\ncGUoKSwgc3RhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmxv\nYWQoc20sIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2FkZWQgPSBhZGRV\nbmxvYWRlZChzbSwgbnVsbCwgdW5sb2FkZWQpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9hZCAhPSBGT1JD\nRV9MT0FEX05PTkUKICAgICAgICAgICAgICAgICAgICAgICAgfHwgc20uZ2V0\nUENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7CiAgICAgICAgICAgICAg\nICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGxvYWQgdW5sb2FkZWQgZmllbGRzCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IHNtLmdldFVubG9hZGVkKGZl\ndGNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5sb2FkKHNtLCBm\naWVsZHMsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChmaWVsZHMubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdW5sb2FkZWQgPSBhZGRVbmxvYWRlZChzbSwgZmllbGRzLCB1\nbmxvYWRlZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51\nbGwsIHVubG9hZGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKHVubG9hZGVkID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsKCiAg\nICAgICAgLy8gbG9hZCB3aXRoIGRlbGVnYXRlCiAgICAgICAgQ29sbGVjdGlv\nbjxPYmplY3Q+IGZhaWxlZCA9IHN1cGVyLmxvYWRBbGwodW5sb2FkZWQua2V5\nU2V0KCksIHN0YXRlLCBsb2FkLCBmZXRjaCwgZWRhdGEpOwogICAgICAgIGlm\nICghX2N0eC5nZXRQb3B1bGF0ZURhdGFDYWNoZSgpKQogICAgICAgICAgICBy\nZXR1cm4gZmFpbGVkOwoKICAgICAgICAvLyBmb3IgZWFjaCBsb2FkZWQgaW5z\ndGFuY2UsIG1lcmdlIGxvYWRlZCBzdGF0ZSBpbnRvIGNhY2hlZCBkYXRhCgog\nICAgICAgIGJvb2xlYW4gaXNOZXc7CgogICAgICAgIGZvcihNYXAuRW50cnk8\nT3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0PiBlbnRyeSA6IHVubG9hZGVk\nLmVudHJ5U2V0KCkpIHsgCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20gPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgZmllbGRzID0g\nZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIGNhY2hlID0gX21nci5z\nZWxlY3RDYWNoZShzbSk7CiAgICAgICAgICAgIGlmIChjYWNoZSA9PSBudWxs\nIHx8IHNtLmlzRW1iZWRkZWQoKSB8fCAoZmFpbGVkICE9IG51bGwKICAgICAg\nICAgICAgICAgICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSB0aGF0IHdlJ3JlIG5vdCB0cnlpbmcgdG8gY2FjaGUgYW4gb2xkIHZl\ncnNpb24KICAgICAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNt\nLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0g\nbnVsbCAmJiBjb21wYXJlVmVyc2lvbihzbSwgc20uZ2V0VmVyc2lvbigpLAog\nICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0VmVyc2lvbigpKSA9PSBWRVJT\nSU9OX0VBUkxJRVIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAgICAgaXNOZXcgPSBkYXRhID09IG51bGw7CiAgICAgICAg\nICAgICAgICBpZiAoaXNOZXcpCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9\nIG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRzID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdG9yZShzbSk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZGF0YS5z\ndG9yZShzbSwgZmllbGRzKTsKICAgICAgICAgICAgICAgIGlmIChpc05ldykK\nICAgICAgICAgICAgICAgICAgICBjYWNoZS5wdXQoZGF0YSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2FjaGUudXBkYXRl\nKGRhdGEpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZmFpbGVkOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIGFuIHVubG9hZGVkIGluc3Rh\nbmNlIHRvIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIE1hcDxPcGVuSlBBU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+IGFkZFVubG9h\nZGVkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAg\nICAgICAgTWFwPE9wZW5KUEFTdGF0ZU1hbmFnZXIsIEJpdFNldD4gdW5sb2Fk\nZWQpIHsKICAgICAgICBpZiAodW5sb2FkZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgdW5sb2FkZWQgPSBuZXcgSGFzaE1hcDxPcGVuSlBBU3RhdGVNYW5hZ2Vy\nLCBCaXRTZXQ+KCk7CiAgICAgICAgdW5sb2FkZWQucHV0KHNtLCBmaWVsZHMp\nOwogICAgICAgIHJldHVybiB1bmxvYWRlZDsKICAgIH0KCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbjxFeGNlcHRpb24+IGZsdXNoKENvbGxlY3Rpb248T3BlbkpQ\nQVN0YXRlTWFuYWdlcj4gc3RhdGVzKSB7CiAgICAgICAgQ29sbGVjdGlvbjxF\neGNlcHRpb24+IGV4Y2VwcyA9IHN1cGVyLmZsdXNoKHN0YXRlcyk7CgogICAg\nICAgIC8vIGlmIHRoZXJlIHdlcmUgZXJyb3JzIGV2aWN0IGJhZCBpbnN0YW5j\nZXMgYW5kIGRvbid0IHJlY29yZCBjaGFuZ2VzCiAgICAgICAgaWYgKCFleGNl\ncHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAoRXhjZXB0aW9uIGUg\nOiBleGNlcHMpIHsKICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2Yg\nT3B0aW1pc3RpY0V4Y2VwdGlvbikKICAgICAgICAgICAgICAgICAgICBub3Rp\nZnlPcHRpbWlzdGljTG9ja0ZhaWx1cmUoKE9wdGltaXN0aWNFeGNlcHRpb24p\nIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBleGNlcHM7\nCiAgICAgICAgfQoKICAgICAgICAvLyBpZiBsYXJnZSB0cmFuc2FjdGlvbiBt\nb2RlIGRvbid0IHJlY29yZCBpbmRpdmlkdWFsIGNoYW5nZXMKICAgICAgICBp\nZiAoX2N0eC5pc1RyYWNrQ2hhbmdlc0J5VHlwZSgpKQogICAgICAgICAgICBy\nZXR1cm4gZXhjZXBzOwoKICAgICAgICBmb3IgKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20gOiBzdGF0ZXMpIHsKICAgICAgICAgICAgaWYgKHNtLmdldFBDU3Rh\ndGUoKSA9PSBQQ1N0YXRlLlBORVcgJiYgIXNtLmlzRmx1c2hlZCgpKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX2luc2VydHMgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIF9pbnNlcnRzID0gbmV3IEFycmF5TGlzdDxPcGVuSlBB\nU3RhdGVNYW5hZ2VyPigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgX2luc2VydHMuYWRkKHNtKTsKCiAgICAgICAgICAgICAgICAvLyBt\nYXkgaGF2ZSBiZWVuIHJlLXBlcnNpc3RlZAogICAgICAgICAgICAgICAgaWYg\nKF9kZWxldGVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBfZGVs\nZXRlcy5yZW1vdmUoc20pOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBlbHNlIGlmIChfaW5zZXJ0cyAhPSBudWxsIAogICAgICAgICAgICAg\nICAgJiYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVdERUxFVEVE\nIAogICAgICAgICAgICAgICAgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3Rh\ndGUuUE5FV0ZMVVNIRURERUxFVEVEKSkgewogICAgICAgICAgICAgICAgX2lu\nc2VydHMucmVtb3ZlKHNtKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBl\nbHNlIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QRElSVFkpIHsK\nICAgICAgICAgICAgICAgIGlmIChfdXBkYXRlcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgX3VwZGF0ZXMgPSBuZXcgSGFzaE1hcDxPcGVuSlBB\nU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+KCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBfdXBkYXRlcy5wdXQoc20sIHNtLmdldERpcnR5KCkp\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLlBERUxFVEVEKSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlbGV0\nZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIF9kZWxldGVzID0g\nbmV3IEhhc2hTZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4oKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIF9kZWxldGVzLmFkZChzbSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLmVtcHR5TGlzdCgpOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBs\nb2NhbCBzdGFsZW5lc3MgZGV0ZWN0aW9uIGV2ZW50cyBmcm9tIHRoZSBjYWNo\nZSB0aGUgT0lEIChpZgogICAgICogYXZhaWxhYmxlKSB0aGF0IHJlc3VsdGVk\nIGluIGFuIG9wdGltaXN0aWMgbG9jayBleGNlcHRpb24gaWZmIHRoZQogICAg\nICogdmVyc2lvbiBpbmZvcm1hdGlvbiBpbiB0aGUgY2FjaGUgbWF0Y2hlcyB0\naGUgdmVyc2lvbiBpbmZvcm1hdGlvbgogICAgICogaW4gdGhlIHN0YXRlIG1h\nbmFnZXIgZm9yIHRoZSBmYWlsZWQgaW5zdGFuY2UuIFRoaXMgbWVhbnMgdGhh\ndCB3ZQogICAgICogd2lsbCBldmljdCBkYXRhIGZyb20gdGhlIGNhY2hlIGZv\nciByZWNvcmRzIHRoYXQgc2hvdWxkIGhhdmUKICAgICAqIHN1Y2Nlc3NmdWxs\neSBjb21taXR0ZWQgYWNjb3JkaW5nIHRvIHRoZSBkYXRhIGNhY2hlIGJ1dAog\nICAgICogZGlkIG5vdC4gVGhlIG9ubHkgcHJlZGljdGFibGUgcmVhc29uIHRo\nYXQgY291bGQgY2F1c2UgdGhpcyBiZWhhdmlvcgogICAgICogaXMgYSBjb25j\ndXJyZW50IG91dC1vZi1iYW5kIG1vZGlmaWNhdGlvbiB0byB0aGUgZGF0YWJh\nc2UgdGhhdCB3YXMgbm90IAogICAgICogY29tbXVuaWNhdGVkIHRvIHRoZSBj\nYWNoZS4gVGhpcyBsb2dpYyBtYWtlcyBPcGVuSlBBJ3MgZGF0YSBjYWNoZSAK\nICAgICAqIHNvbWV3aGF0IHRvbGVyYW50IG9mIHN1Y2ggYmVoYXZpb3IsIGlu\nIHRoYXQgdGhlIGNhY2hlIHdpbGwgYmUgY2xlYW5lZCAKICAgICAqIHVwIGFz\nIGZhaWx1cmVzIG9jY3VyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbm90\naWZ5T3B0aW1pc3RpY0xvY2tGYWlsdXJlKE9wdGltaXN0aWNFeGNlcHRpb24g\nZSkgewogICAgICAgIE9iamVjdCBvID0gZS5nZXRGYWlsZWRPYmplY3QoKTsK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gX2N0eC5nZXRTdGF0\nZU1hbmFnZXIobyk7CiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0SWQoKTsK\nICAgICAgICBib29sZWFuIHJlbW92ZTsKCiAgICAgICAgLy8gdGhpcyBsb2dp\nYyBjb3VsZCBiZSBtb3JlIGVmZmljaWVudCAtLSB3ZSBjb3VsZCBhZ2dyZWdh\ndGUKICAgICAgICAvLyBhbGwgdGhlIGNhY2hlLT5vaWQgY2hhbmdlcywgYW5k\nIHRoZW4gdXNlIERhdGFDYWNoZS5yZW1vdmVBbGwoKSAKICAgICAgICAvLyBh\nbmQgbGVzcyB3cml0ZSBsb2NrcyB0byBkbyB0aGUgbXV0YXRpb24uCiAgICAg\nICAgRGF0YUNhY2hlIGNhY2hlID0gX21nci5zZWxlY3RDYWNoZShzbSk7CiAg\nICAgICAgaWYgKGNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRhdGEgPSBjYWNoZS5nZXQob2lk\nKTsKICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIHN3aXRjaCAoY29tcGFyZVZlcnNp\nb24oc20sIHNtLmdldFZlcnNpb24oKSwgZGF0YS5nZXRWZXJzaW9uKCkpKSB7\nCiAgICAgICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0xB\nVEVSOgogICAgICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVSU0lP\nTl9TQU1FOgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgdHgncyBjdXJy\nZW50IHZlcnNpb24gaXMgbGF0ZXIgdGhhbiBvciB0aGUgc2FtZSBhcyAKICAg\nICAgICAgICAgICAgICAgICAvLyB0aGUgZGF0YSBjYWNoZSB2ZXJzaW9uLiBJ\nbiB0aGlzIGNhc2UsIHRoZSBjb21taXQgc2hvdWxkIAogICAgICAgICAgICAg\nICAgICAgIC8vIGhhdmUgc3VjY2VlZGVkIGZyb20gdGhlIHN0YW5kcG9pbnQg\nb2YgdGhlIGNhY2hlLiBSZW1vdmUgCiAgICAgICAgICAgICAgICAgICAgLy8g\ndGhlIGluc3RhbmNlIGZyb20gY2FjaGUgaW4gdGhlIGhvcGVzIHRoYXQgdGhl\nIGNhY2hlIGlzIAogICAgICAgICAgICAgICAgICAgIC8vIG91dCBvZiBzeW5j\nLgogICAgICAgICAgICAgICAgICAgIHJlbW92ZSA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFN0b3Jl\nTWFuYWdlci5WRVJTSU9OX0VBUkxJRVI6CiAgICAgICAgICAgICAgICAgICAg\nLy8gVGhpcyB0eCdzIGN1cnJlbnQgdmVyc2lvbiBpcyBlYXJsaWVyIHRoYW4g\ndGhlIGRhdGEgCiAgICAgICAgICAgICAgICAgICAgLy8gY2FjaGUgdmVyc2lv\nbi4gVGhpcyBpcyBhIG5vcm1hbCBvcHRpbWlzdGljIGxvY2sgZmFpbHVyZS4g\nCiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGNsZWFuIHVwIHRoZSBj\nYWNoZTsgaXQgcHJvYmFibHkgYWxyZWFkeSBoYXMgdGhlIAogICAgICAgICAg\nICAgICAgICAgIC8vIHJpZ2h0IHZhbHVlcywgYW5kIGlmIG5vdCwgaXQnbGwg\nZ2V0IGNsZWFuZWQgdXAgYnkgYSB0eAogICAgICAgICAgICAgICAgICAgIC8v\nIHRoYXQgZmFpbHMgaW4gb25lIG9mIHRoZSBvdGhlciBjYXNlIHN0YXRlbWVu\ndHMuCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFN0\nb3JlTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVOVDoKICAgICAgICAgICAgICAg\nICAgICAvLyBUaGUgdmVyc2lvbiBzdHJhdGVneSBmb3IgdGhlIGZhaWxlZCBv\nYmplY3QgZG9lcyBub3QKICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBl\nbm91Z2ggaW5mb3JtYXRpb24gdG8gb3B0aW1pemUgZm9yIGV4cGVjdGVkCiAg\nICAgICAgICAgICAgICAgICAgLy8gZmFpbHVyZXMuIENsZWFuIHVwIHRoZSBj\nYWNoZS4KICAgICAgICAgICAgICAgICAgICByZW1vdmUgPSB0cnVlOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgICAgICAvLyBVbmV4cGVjdGVkIHJldHVybiB2\nYWx1ZS4gUmVtb3ZlIHRvIGJlIGZ1dHVyZS1wcm9vZi4KICAgICAgICAgICAg\nICAgICAgICByZW1vdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZW1vdmUpCiAg\nICAgICAgICAgICAgICAvLyByZW1vdmUgZGlyZWN0bHkgaW5zdGVhZCBvZiB2\naWEgdGhlIFJlbW90ZUNvbW1pdExpc3RlbmVyCiAgICAgICAgICAgICAgICAv\nLyBzaW5jZSB3ZSBoYXZlIGEgd3JpdGUgbG9jayBoZXJlIGFscmVhZHksIHNv\nIHRoaXMgaXMgbW9yZQogICAgICAgICAgICAgICAgLy8gZWZmaWNpZW50IHRo\nYW4gcmVhZC1sb2NraW5nIGFuZCB0aGVuIHdyaXRlLWxvY2tpbmcgbGF0ZXIu\nCiAgICAgICAgICAgICAgICBjYWNoZS5yZW1vdmUoc20uZ2V0SWQoKSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxv\nY2soKTsKICAgICAgICB9CgogICAgICAgIC8vIGZpcmUgb2ZmIGEgcmVtb3Rl\nIGNvbW1pdCBzdGFsZW5lc3NzIGRldGVjdGlvbiBldmVudC4KICAgICAgICBf\nY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRSZW1vdGVDb21taXRFdmVudE1h\nbmFnZXIoKQogICAgICAgICAgICAuZmlyZUxvY2FsU3RhbGVOb3RpZmljYXRp\nb24ob2lkKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBj\nYWNoZWFibGUgaW5zdGFuY2UgZm9yIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2Vy\nLgogICAgICovCiAgICBwcml2YXRlIERhdGFDYWNoZVBDRGF0YSBuZXdQQ0Rh\ndGEoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKF9n\nZW4gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChEYXRhQ2FjaGVQQ0Rh\ndGEpIF9nZW4uZ2VuZXJhdGVQQ0RhdGEoc20uZ2V0T2JqZWN0SWQoKSwgbWV0\nYSk7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQ2FjaGVQQ0RhdGFJbXBsKHNt\nLmZldGNoT2JqZWN0SWQoKSwgbWV0YSwgX21nci5zZWxlY3RDYWNoZShzbSku\nZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYg\nYSBsb2FkIG9wZXJhdGlvbiBtdXN0IGJ5cGFzcyB0aGUgTDIgY2FjaGUuCiAg\nICAgKiBJZiBsb2NrIGlzIGFjdGl2ZSwgYWx3YXlzIGJ5cGFzcy4KICAgICAq\nIAogICAgICovCiAgICBib29sZWFuIGJ5cGFzcyhGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIGludCBsb2FkKSB7CiAgICAgICAgLy8gT3JkZXIgb2YgY2hl\nY2tzIGFyZSBpbXBvcnRhbnQKICAgICAgICBpZiAoaXNMb2NraW5nKGZldGNo\nKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9jdHgu\nZ2V0Q29uZmlndXJhdGlvbigpLmdldFJlZnJlc2hGcm9tRGF0YUNhY2hlKCkp\nIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGZldGNo\nLmdldENhY2hlUmV0cmlldmVNb2RlKCkgPT0gRGF0YUNhY2hlUmV0cmlldmVN\nb2RlLkJZUEFTUykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\naWYgKGxvYWQgPT0gU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfUkVGUkVTSCkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGNv\nbnRleHQgaXMgbG9ja2luZyBsb2FkZWQgZGF0YS4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIGlzTG9ja2luZyhGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAg\nZmV0Y2ggPSBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAg\nIHJldHVybiBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkgPiBMb2NrTGV2ZWxz\nLkxPQ0tfTk9ORTsKICAgIH0gIAogICAgCiAgICAvKioKICAgICAqIFN0cnVj\ndHVyZSB1c2VkIGR1cmluZyB0aGUgY29tbWl0IHByb2Nlc3MgdG8gdHJhY2sg\nY2FjaGUgbW9kaWZpY2F0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTW9kaWZpY2F0aW9ucyB7CgogICAgICAgIHB1YmxpYyBmaW5h\nbCBMaXN0PFBDRGF0YUhvbGRlcj4gYWRkaXRpb25zID0gbmV3IEFycmF5TGlz\ndDxQQ0RhdGFIb2xkZXI+KCk7CiAgICAgICAgcHVibGljIGZpbmFsIExpc3Q8\nUENEYXRhSG9sZGVyPiBuZXdVcGRhdGVzID0gbmV3IEFycmF5TGlzdDxQQ0Rh\ndGFIb2xkZXI+KCk7CiAgICAgICAgcHVibGljIGZpbmFsIExpc3Q8UENEYXRh\nSG9sZGVyPiBleGlzdGluZ1VwZGF0ZXMgPSBuZXcgQXJyYXlMaXN0PFBDRGF0\nYUhvbGRlcj4oKTsKICAgICAgICBwdWJsaWMgZmluYWwgTGlzdDxPYmplY3Q+\nIGRlbGV0ZXMgPSBuZXcgQXJyYXlMaXN0PE9iamVjdD4oKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFV0aWxpdHkgc3RydWN0dXJlIGhvbGRzIHRoZSB0dXBs\nZSBvZiBjYWNoZWFibGUgaW5zdGFuY2UgYW5kIGl0cyBjb3JyZXNwb25kaW5n\nIHN0YXRlIG1hbmFnZXIuIAogICAgICoKICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgUENEYXRhSG9sZGVyIHsKCiAgICAgICAgcHVibGljIGZp\nbmFsIERhdGFDYWNoZVBDRGF0YSBwY2RhdGE7CiAgICAgICAgcHVibGljIGZp\nbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207CgogICAgICAgIHB1YmxpYyBQ\nQ0RhdGFIb2xkZXIoRGF0YUNhY2hlUENEYXRhIHBjZGF0YSwgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSkgewogICAgICAgICAgICB0aGlzLnBjZGF0YSA9IHBj\nZGF0YTsKICAgICAgICAgICAgdGhpcy5zbSA9IHNtOwoJCX0KCX0KfQoK\n","encoding":"base64"}

