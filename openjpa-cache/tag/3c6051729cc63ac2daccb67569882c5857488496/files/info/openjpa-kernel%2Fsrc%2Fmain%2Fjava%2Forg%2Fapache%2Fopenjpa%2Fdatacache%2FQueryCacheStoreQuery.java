{"sha":"4457c1ec7b736a5fac8a428d1cb7ea2a9a70110d","node_id":"MDQ6QmxvYjIwNjM2NDo0NDU3YzFlYzdiNzM2YTVmYWM4YTQyOGQxY2I3ZWEyYTlhNzAxMTBk","size":23686,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4457c1ec7b736a5fac8a428d1cb7ea2a9a70110d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5M\naW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkFic3RyYWN0UXVlcnlDYWNoZS5FdmljdFBvbGljeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGluZ1N0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2Nr\nTGV2ZWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVu\nSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5RdWVyeUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLlJlc3VsdFNoYXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHBy\nZXNzaW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLkxp\nc3RSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9yZGVyZWRNYXA7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb247CgoKLyoqCiAqIEEge0BsaW5rIFN0b3JlUXVlcnl9IGltcGxlbWVu\ndGF0aW9uIHRoYXQgY2FjaGVzIHRoZSBPSURzIGludm9sdmVkIGluCiAqIHRo\nZSBxdWVyeSwgYW5kIGNhbiBkZXRlcm1pbmUgd2hldGhlciBvciBub3QgdGhl\nIHF1ZXJ5IGhhcyBiZWVuIGRpcnRpZWQuCiAqCiAqIEBhdXRob3IgUGF0cmlj\nayBMaW5za2V5CiAqIEBzaW5jZSAwLjIuNS4wCiAqLwpwdWJsaWMgY2xhc3Mg\nUXVlcnlDYWNoZVN0b3JlUXVlcnkKICAgIGltcGxlbWVudHMgU3RvcmVRdWVy\neSB7CgogICAgcHJpdmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5IF9xdWVyeTsKICAg\nIHByaXZhdGUgZmluYWwgUXVlcnlDYWNoZSBfY2FjaGU7CiAgICBwcml2YXRl\nIFN0b3JlQ29udGV4dCBfc2N0eDsKICAgIHByaXZhdGUgTWV0YURhdGFSZXBv\nc2l0b3J5IF9yZXBvczsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBp\nbnN0YW5jZSB0aGF0IGRlbGVnYXRlcyB0byA8Y29kZT5xdWVyeTwvY29kZT4g\naWYgbm8KICAgICAqIGNhY2hlZCByZXN1bHRzIGFyZSBhdmFpbGFibGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBRdWVyeUNhY2hlU3RvcmVRdWVyeShTdG9yZVF1\nZXJ5IHF1ZXJ5LCBRdWVyeUNhY2hlIGNhY2hlKSB7CiAgICAgICAgX3F1ZXJ5\nID0gcXVlcnk7CiAgICAgICAgX2NhY2hlID0gY2FjaGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBRdWVyeUNhY2hlfSB0aGF0\nIHRoaXMgb2JqZWN0IGlzIGFzc29jaWF0ZWQgd2l0aC4KICAgICAqLwogICAg\ncHVibGljIFF1ZXJ5Q2FjaGUgZ2V0Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9jYWNoZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlLgogICAg\nICovCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBnZXREZWxlZ2F0ZSgpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5OwogICAgfQoKICAgIC8qKgogICAgICogTG9v\nayBpbiB0aGUgcXVlcnkgY2FjaGUgZm9yIGEgcmVzdWx0IGZvciB0aGUgZ2l2\nZW4gcXVlcnkKICAgICAqIGtleS4gT25seSBsb29rIGlmIHRoaXMgcXVlcnkg\naXMgYmVpbmcgZXhlY3V0ZWQgb3V0c2lkZSBhCiAgICAgKiB0cmFuc2FjdGlv\nbiBvciBpbiBhIHRyYW5zYWN0aW9uIHdpdGggSWdub3JlQ2hhbmdlcyBzZXQg\ndG8gdHJ1ZQogICAgICogb3IgaW4gYSB0cmFuc2FjdGlvbiB3aXRoIElnbm9y\nZUNoYW5nZXMgc2V0IHRvIGZhbHNlIGJ1dCBpbiB3aGljaAogICAgICogbm9u\nZSBvZiB0aGUgY2xhc3NlcyBpbnZvbHZlZCBpbiB0aGlzIHF1ZXJ5IGhhdmUg\nYmVlbiB0b3VjaGVkLgogICAgICogIENhY2hpbmcgaXMgbm90IHVzZWQgd2hl\nbiB1c2luZyBvYmplY3QgbG9ja2luZy4KICAgICAqIFRoaXMgaXMgYmVjYXVz\nZSB3ZSBtdXN0IG9idGFpbiBsb2NrcyBvbiB0aGUKICAgICAqIGRhdGEsIGFu\nZCBpdCBpcyBsaWtlbHkgdGhhdCBtYWtpbmcgbiB0cmlwcyB0byB0aGUgZGF0\nYWJhc2UgdG8KICAgICAqIG1ha2UgdGhlIGxvY2tzIHdpbGwgYmUgc2xvd2Vy\nIHRoYW4gcnVubmluZyB0aGUgcXVlcnkgYWdhaW5zdAogICAgICogdGhlIGRh\ndGFiYXNlLgogICAgICogIElmIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uIGhh\ncyBxdWVyeSBjYWNoaW5nIGRpc2FibGVkLAogICAgICogdGhlbiB0aGlzIG1l\ndGhvZCByZXR1cm5zIDxjb2RlPm51bGw8L2NvZGU+LgogICAgICogIFJldHVy\nbiB0aGUgbGlzdCBpZiB3ZSBtZWV0IHRoZSBhYm92ZSBjcml0ZXJpYSBhbmQg\naWYgYSBsaXN0CiAgICAgKiBpcyBmb3VuZCBmb3IgPGNvZGU+cWs8L2NvZGU+\nLiBFbHNlLCByZXR1cm4KICAgICAqIDxjb2RlPm51bGw8L2NvZGU+LgogICAg\nICogIFRoaXMgaW1wbGVtZW50YXRpb24gbWVhbnMgdGhhdCBxdWVyaWVzIGFn\nYWluc3QgdGhlIGNhY2hlCiAgICAgKiBhcmUgb2YgUkVBRF9DT01NSVRURUQg\naXNvbGF0aW9uIGxldmVsLiBJdCdkIGJlIG5pY2UgdG8gc3VwcG9ydAogICAg\nICogUkVBRF9TRVJJQUxJWkFCTEUgLS0gdG8gZG8gc28sIHdlJ2QganVzdCBy\nZXR1cm4gZmFsc2Ugd2hlbiBpbgogICAgICogYSB0cmFuc2FjdGlvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBMaXN0PE9iamVjdD4gY2hlY2tDYWNoZShRdWVy\neUtleSBxaykgewogICAgICAgIGlmIChxayA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2ggPSBnZXRDb250ZXh0KCkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgaWYgKCFmZXRjaC5nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoZmV0Y2guZ2V0UmVh\nZExvY2tMZXZlbCgpID4gTG9ja0xldmVscy5MT0NLX05PTkUpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBnZXQgdGhlIGNhY2hlZCBk\nYXRhCiAgICAgICAgUXVlcnlSZXN1bHQgcmVzID0gX2NhY2hlLmdldChxayk7\nCgogICAgICAgIGlmIChyZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7ICAgICAgICAKICAgICAgICBpZiAocmVzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwoKICAg\nICAgICAvLyB0aGlzIGlmIGJsb2NrIGlzIGludm9rZWQgaWYgdGhlIGV2aWN0\nT25UaW1lc3RhbXAgaXMgc2V0IHRvIHRydWUKICAgICAgICBpZiAoX2NhY2hl\nIGluc3RhbmNlb2YgQWJzdHJhY3RRdWVyeUNhY2hlKSB7CiAgICAgICAgICAg\nIEFic3RyYWN0UXVlcnlDYWNoZSBxY2FjaGUgPSAoQWJzdHJhY3RRdWVyeUNh\nY2hlKSBfY2FjaGU7CiAgICAgICAgICAgIGlmIChxY2FjaGUuZ2V0RXZpY3RQ\nb2xpY3koKSA9PSBFdmljdFBvbGljeS5USU1FU1RBTVApIHsKICAgICAgICAg\nICAgICAgIFNldDxTdHJpbmc+IGNsYXNzTmFtZXMgPSBxay5nZXRBY2Vzc1Bh\ndGhDbGFzc05hbWVzKCk7CiAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4g\na2V5TGlzdCA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOyAgICAgIAogICAg\nICAgICAgICAgICAga2V5TGlzdC5hZGRBbGwoY2xhc3NOYW1lcyk7CgogICAg\nICAgICAgICAgICAgTGlzdDxMb25nPiB0aW1lc3RhbXBzID0gCiAgICAgICAg\nICAgICAgICAgICAgcWNhY2hlLmdldEFsbEVudGl0eVRpbWVzdGFtcChrZXlM\naXN0KTsKICAgICAgICAgICAgICAgIGxvbmcgcXVlcnlUUyA9IHJlcy5nZXRU\naW1lc3RhbXAoKTsKICAgICAgICAgICAgICAgIGlmICh0aW1lc3RhbXBzICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKExvbmcgdHM6IHRp\nbWVzdGFtcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhp\ncyBpcyB0cnVlIHdlIGhhdmUgdG8gZXZpY3QgdGhlIHF1ZXJ5IAogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBmcm9tIGNhY2hlCiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChxdWVyeVRTIDwgdHMpIHsgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBxY2FjaGUucmVtb3ZlKHFrKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpbnQgcHJv\nanMgPSBnZXRDb250ZXh0KCkuZ2V0UHJvamVjdGlvbkFsaWFzZXMoKS5sZW5n\ndGg7CiAgICAgICAgaWYgKHByb2pzID09IDApIHsKICAgICAgICAgICAgLy8g\nV2UncmUgb25seSBnb2luZyB0byByZXR1cm4gdGhlIGNhY2hlZCByZXN1bHRz\nIGlmIHdlIGhhdmUgQUxMIHJlc3VsdHMgY2FjaGVkLiBUaGlzIGNvdWxkIGJl\nIGltcHJvdmVkCiAgICAgICAgICAgIC8vIGluIHRoZSBmdXR1cmUgdG8gYmUg\nYSBsaXR0bGUgbW9yZSBpbnRlbGxpZ2VudC4KICAgICAgICAgICAgaWYgKGdl\ndENvbnRleHQoKS5nZXRTdG9yZUNvbnRleHQoKS5pc0NhY2hlZChyZXMpID09\nIGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IENhY2hlZExp\nc3QocmVzLCBwcm9qcyAhPSAwLCBfc2N0eCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXcmFwIHRoZSByZXN1bHQgb2JqZWN0IHByb3ZpZGVyIHJldHVybmVk\nIGJ5IG91ciBkZWxlZ2F0ZSBpbiBhCiAgICAgKiBjYWNoaW5nIHByb3ZpZGVy\nLgogICAgICovCiAgICBwcml2YXRlIFJlc3VsdE9iamVjdFByb3ZpZGVyIHdy\nYXBSZXN1bHQoUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wLAogICAgICAgIFF1\nZXJ5S2V5IGtleSkgewogICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIHJvcDsKICAgICAgICByZXR1cm4gbmV3IENhY2hpbmdS\nZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIGdldENvbnRleHQoKS4KICAgICAg\nICAgICAgZ2V0UHJvamVjdGlvbkFsaWFzZXMoKS5sZW5ndGggPiAwLCBrZXkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBhIHByb2plY3Rpb24gZWxl\nbWVudCBmb3IgY2FjaGluZyAvIHJldHVybmluZy4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgT2JqZWN0IGNvcHlQcm9qZWN0aW9uKE9iamVjdCBvYmos\nIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAob2JqID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHN3aXRjaCAoSmF2\nYVR5cGVzLmdldFR5cGVDb2RlKG9iai5nZXRDbGFzcygpKSkgewogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hB\nUl9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklH\nREVDSU1BTDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdF\nUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAg\nICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nREFURToKICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIG9iaikuY2xv\nbmUoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAg\nICAgICAgICAgICAgcmV0dXJuICgoTG9jYWxlKSBvYmopLmNsb25lKCk7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAob2JqIGlu\nc3RhbmNlb2YgQ2FjaGVkT2JqZWN0SWQpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZyb21PYmplY3RJZCgoKENhY2hlZE9iamVjdElkKSBvYmopLm9p\nZCwgY3R4KTsKICAgICAgICAgICAgICAgIE9iamVjdCBvaWQgPSBjdHguZ2V0\nT2JqZWN0SWQob2JqKTsKICAgICAgICAgICAgICAgIGlmIChvaWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENhY2hlZE9iamVj\ndElkKG9pZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9i\namVjdCBiYXNlZCBvbiBpdHMgY2FjaGVkIG9pZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgT2JqZWN0IGZyb21PYmplY3RJZChPYmplY3Qgb2lkLCBT\ndG9yZUNvbnRleHQgc2N0eCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE9iamVjdCBvYmog\nPSBzY3R4LmZpbmQob2lkLCBudWxsLCBudWxsLCBudWxsLCAwKTsKICAgICAg\nICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBPYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbihvaWQpOwogICAgICAgIHJldHVybiBvYmo7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAg\nICAgIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBfcXVlcnk7CiAgICB9CgogICAgcHVibGljIFF1ZXJ5Q29udGV4dCBn\nZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBfcXVlcnkuZ2V0Q29udGV4\ndCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbnRleHQoUXVlcnlD\nb250ZXh0IHFjdHgpIHsKICAgICAgICBfcXVlcnkuc2V0Q29udGV4dChxY3R4\nKTsKICAgICAgICBfc2N0eCA9IHFjdHguZ2V0U3RvcmVDb250ZXh0KCk7CiAg\nICAgICAgX3JlcG9zID0gX3NjdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldE1l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gc2V0UXVlcnkoT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgcmV0\ndXJuIF9xdWVyeS5zZXRRdWVyeShxdWVyeSk7CiAgICB9CgogICAgcHVibGlj\nIEZpbHRlckxpc3RlbmVyIGdldEZpbHRlckxpc3RlbmVyKFN0cmluZyB0YWcp\nIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldEZpbHRlckxpc3RlbmVyKHRh\nZyk7CiAgICB9CgogICAgcHVibGljIEFnZ3JlZ2F0ZUxpc3RlbmVyIGdldEFn\nZ3JlZ2F0ZUxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICByZXR1cm4g\nX3F1ZXJ5LmdldEFnZ3JlZ2F0ZUxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBuZXdDb21waWxhdGlvbktleSgpIHsKICAgICAgICBy\nZXR1cm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uS2V5KCk7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBuZXdDb21waWxhdGlvbigpIHsKICAgICAgICByZXR1\ncm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcG9wdWxhdGVGcm9tQ29tcGlsYXRpb24oT2JqZWN0IGNvbXApIHsK\nICAgICAgICBfcXVlcnkucG9wdWxhdGVGcm9tQ29tcGlsYXRpb24oY29tcCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgaW52YWxpZGF0ZUNvbXBpbGF0aW9u\nKCkgewogICAgICAgIF9xdWVyeS5pbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RhdGFTdG9yZUV4\nZWN1dGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzRGF0\nYVN0b3JlRXhlY3V0aW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpIHsKICAgICAgICByZXR1cm4g\nX3F1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKTsKICAgIH0KCiAg\nICBwdWJsaWMgRXhlY3V0b3IgbmV3SW5NZW1vcnlFeGVjdXRvcihDbGFzc01l\ndGFEYXRhIG1ldGEsIGJvb2xlYW4gc3VicykgewogICAgICAgIHJldHVybiBf\ncXVlcnkubmV3SW5NZW1vcnlFeGVjdXRvcihtZXRhLCBzdWJzKTsKICAgIH0K\nCiAgICBwdWJsaWMgRXhlY3V0b3IgbmV3RGF0YVN0b3JlRXhlY3V0b3IoQ2xh\nc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBFeGVj\ndXRvciBleCA9IF9xdWVyeS5uZXdEYXRhU3RvcmVFeGVjdXRvcihtZXRhLCBz\ndWJzKTsKICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5Q2FjaGVFeGVjdXRvcihl\neCwgbWV0YSwgc3VicywKICAgICAgICAgICAgICAgICAgICAgIGdldENvbnRl\neHQoKS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNBYnN0cmFjdEV4ZWN1dG9ycygpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzQWJzdHJhY3RFeGVjdXRvcnMo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0NhbmRpZGF0\nZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5yZXF1aXJlc0NhbmRp\nZGF0ZVR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJl\nc1BhcmFtZXRlckRlY2xhcmF0aW9ucygpIHsKICAgICAgICByZXR1cm4gX3F1\nZXJ5LnJlcXVpcmVzUGFyYW1ldGVyRGVjbGFyYXRpb25zKCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNQYXJhbWV0ZXJEZWNsYXJhdGlv\nbnMoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zdXBwb3J0c1BhcmFtZXRl\nckRlY2xhcmF0aW9ucygpOwogICAgfQogCiAgICBwdWJsaWMgT2JqZWN0IGV2\nYWx1YXRlKE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJh\nbXMsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAg\nIHJldHVybiBfcXVlcnkuZXZhbHVhdGUodmFsdWUsIG9iLCBwYXJhbXMsIHNt\nKTsgICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAqIENhY2hpbmcgZXhl\nY3V0b3IuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFF1ZXJ5\nQ2FjaGVFeGVjdXRvcgogICAgICAgIGltcGxlbWVudHMgRXhlY3V0b3IgewoK\nICAgICAgICBwcml2YXRlIGZpbmFsIEV4ZWN1dG9yIF9leDsKICAgICAgICBw\ncml2YXRlIGZpbmFsIENsYXNzPD8+IF9jYW5kaWRhdGU7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBib29sZWFuIF9zdWJzOwogICAgICAgIHByaXZhdGUgZmlu\nYWwgRmV0Y2hDb25maWd1cmF0aW9uIF9mYzsKCiAgICAgICAgcHVibGljIFF1\nZXJ5Q2FjaGVFeGVjdXRvcihFeGVjdXRvciBleCwgQ2xhc3NNZXRhRGF0YSBt\nZXRhLAogICAgICAgICAgICBib29sZWFuIHN1YnMsIEZldGNoQ29uZmlndXJh\ndGlvbiBmYykgewogICAgICAgICAgICBfZXggPSBleDsKICAgICAgICAgICAg\nX2NhbmRpZGF0ZSA9IChtZXRhID09IG51bGwpID8gbnVsbCA6IG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBfc3VicyA9IHN1YnM7CiAg\nICAgICAgICAgIF9mYyA9IGZjOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVRdWVyeShTdG9yZVF1ZXJ5\nIHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgUmFuZ2UgcmFuZ2Up\nIHsKICAgICAgICAgICAgUXVlcnlDYWNoZVN0b3JlUXVlcnkgY3EgPSAoUXVl\ncnlDYWNoZVN0b3JlUXVlcnkpIHE7CiAgICAgICAgICAgIFF1ZXJ5S2V5IGtl\neSA9IFF1ZXJ5S2V5Lm5ld0luc3RhbmNlKGNxLmdldENvbnRleHQoKSwKICAg\nICAgICAgICAgICAgIF9leC5pc1BhY2tpbmcocSksIHBhcmFtcywgX2NhbmRp\nZGF0ZSwgX3N1YnMsIHJhbmdlLnN0YXJ0LCAKICAgICAgICAgICAgICAgIHJh\nbmdlLmVuZCk7CiAgICAgICAgICAgIExpc3Q8T2JqZWN0PiBjYWNoZWQgPSBj\ncS5jaGVja0NhY2hlKGtleSk7CiAgICAgICAgICAgIGlmIChjYWNoZWQgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdFJlc3VsdE9i\namVjdFByb3ZpZGVyKGNhY2hlZCk7CgogICAgICAgICAgICBSZXN1bHRPYmpl\nY3RQcm92aWRlciByb3AgPSBfZXguZXhlY3V0ZVF1ZXJ5KGNxLmdldERlbGVn\nYXRlKCksCiAgICAgICAgICAgICAgICBwYXJhbXMsIHJhbmdlKTsKICAgICAg\nICAgICAgaWYgKF9mYy5nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGNxLndyYXBSZXN1bHQocm9wLCBrZXkpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gcm9wOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgUXVlcnlFeHByZXNzaW9u\nc1tdIGdldFF1ZXJ5RXhwcmVzc2lvbnMoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfZXguZ2V0UXVlcnlFeHByZXNzaW9ucygpOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogQ2xlYXIgdGhlIGNhY2hlZCBxdWVyaWVzIGFz\nc29jaWF0ZWQgd2l0aCB0aGUgYWNjZXNzIHBhdGgKICAgICAgICAgKiBjbGFz\nc2VzIGluIHRoZSBxdWVyeS4gVGhpcyBpcyBkb25lIHdoZW4gYnVsayBvcGVy\nYXRpb25zCiAgICAgICAgICogKHN1Y2ggYXMgZGVsZXRlcyBvciB1cGRhdGVz\nKSBhcmUgcGVyZm9ybWVkIHNvIHRoYXQgdGhlCiAgICAgICAgICogY2FjaGUg\ncmVtYWlucyB1cC10by1kYXRlLgogICAgICAgICAqLwogICAgICAgIHByaXZh\ndGUgdm9pZCBjbGVhckFjY2Vzc1BhdGgoU3RvcmVRdWVyeSBxKSB7CiAgICAg\nICAgICAgIGlmIChxID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47\nCgogICAgICAgICAgICBDbGFzc01ldGFEYXRhW10gY21kID0gZ2V0QWNjZXNz\nUGF0aE1ldGFEYXRhcyhxKTsKICAgICAgICAgICAgaWYgKGNtZCA9PSBudWxs\nIHx8IGNtZC5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNzZXMgPSBuZXcgQXJy\nYXlMaXN0PENsYXNzPD8+PihjbWQubGVuZ3RoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBjbWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICBjbGFzc2VzLmFkZChjbWRbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nCiAgICAgICAgICAgIC8vIGV2aWN0IGZyb20gdGhlIHF1ZXJ5IGNhY2hlCiAg\nICAgICAgICAgIFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5IGNxID0gKFF1ZXJ5Q2Fj\naGVTdG9yZVF1ZXJ5KSBxOwogICAgICAgICAgICBjcS5nZXRDYWNoZSgpLm9u\nVHlwZXNDaGFuZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVudAogICAgICAgICAg\nICAgICAgKHEuZ2V0Q29udGV4dCgpLCBjbGFzc2VzKSk7CgogICAgICAgICAg\nICAvLyBldmljdCBmcm9tIHRoZSBkYXRhIGNhY2hlCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY21kLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBpZiAoY21kW2ldLmdldERhdGFDYWNoZSgpICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgY21kW2ldLmdldERhdGFDYWNoZSgpLnJlbW92\nZUFsbCgKICAgICAgICAgICAgICAgICAgICAgICAgY21kW2ldLmdldERlc2Ny\naWJlZFR5cGUoKSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBOdW1iZXIgZXhlY3V0ZURlbGV0ZShTdG9yZVF1ZXJ5\nIHEsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIF9leC5leGVjdXRlRGVsZXRlKHVud3JhcChx\nKSwgcGFyYW1zKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIGNsZWFyQWNjZXNzUGF0aChxKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE51bWJlciBleGVjdXRlVXBkYXRlKFN0\nb3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2V4LmV4ZWN1dGVVcGRhdGUo\ndW53cmFwKHEpLCBwYXJhbXMpOwogICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgY2xlYXJBY2Nlc3NQYXRoKHEpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0\nYVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywK\nICAgICAgICAgICAgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJu\nIEVNUFRZX1NUUklOR1M7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCB2YWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgX2V4LnZh\nbGlkYXRlKHVud3JhcChxKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAg\nIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10g\ncGFyYW1zLCBSYW5nZSByYW5nZSkgewogICAgICAgICAgICBfZXguZ2V0UmFu\nZ2UocSwgcGFyYW1zLCByYW5nZSk7IAogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVlKFN0b3JlUXVlcnkgcSwgT2Jq\nZWN0W10gcGFyYW1zLAogICAgICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0\nLCBpbnQgb3JkZXJJbmRleCkgewogICAgICAgICAgICByZXR1cm4gX2V4Lmdl\ndE9yZGVyaW5nVmFsdWUodW53cmFwKHEpLCBwYXJhbXMsIHJlc3VsdE9iamVj\ndCwKICAgICAgICAgICAgICAgIG9yZGVySW5kZXgpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0QXNjZW5kaW5nKHVu\nd3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nc1BhY2tpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguaXNQYWNraW5nKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgU3RyaW5nIGdldEFsaWFzKFN0b3JlUXVlcnkgcSkgewogICAgICAg\nICAgICByZXR1cm4gX2V4LmdldEFsaWFzKHVud3JhcChxKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0UmVzdWx0Q2xhc3MoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0UmVzdWx0\nQ2xhc3ModW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBS\nZXN1bHRTaGFwZTw/PiBnZXRSZXN1bHRTaGFwZShTdG9yZVF1ZXJ5IHEpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9leC5nZXRSZXN1bHRTaGFwZShxKTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIFN0cmluZ1tdIGdldFBy\nb2plY3Rpb25BbGlhc2VzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBy\nZXR1cm4gX2V4LmdldFByb2plY3Rpb25BbGlhc2VzKHVud3JhcChxKSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3M8Pz5bXSBnZXRQcm9qZWN0\naW9uVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0UHJvamVjdGlvblR5cGVzKHVud3JhcChxKSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1BhdGhN\nZXRhRGF0YXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyh1bndyYXAocSkpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBnZXRPcGVyYXRpb24oU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0T3BlcmF0aW9uKHVu\nd3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nc0FnZ3JlZ2F0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leC5pc0FnZ3JlZ2F0ZSh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNEaXN0aW5jdChTdG9yZVF1ZXJ5IHEpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9leC5pc0Rpc3RpbmN0KHVud3JhcChxKSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNHcm91cGlu\nZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5oYXNH\ncm91cGluZyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIE9yZGVyZWRNYXA8T2JqZWN0LCBDbGFzczw/Pj4gZ2V0T3JkZXJlZFBhcmFt\nZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4g\nX2V4LmdldE9yZGVyZWRQYXJhbWV0ZXJUeXBlcyh1bndyYXAocSkpOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgTGlua2VkTWFwIGdldFBh\ncmFtZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1\ncm4gX2V4LmdldFBhcmFtZXRlclR5cGVzKHVud3JhcChxKSk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b1BhcmFtZXRl\nckFycmF5KFN0b3JlUXVlcnkgcSwgTWFwIHVzZXJQYXJhbXMpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9leC50b1BhcmFtZXRlckFycmF5KHEsIHVzZXJQYXJh\nbXMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE1hcCBnZXRVcGRhdGVz\nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldFVw\nZGF0ZXModW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nc3RhdGljIFN0b3JlUXVlcnkgdW53cmFwKFN0b3JlUXVlcnkgcSkgewogICAg\nICAgICAgICByZXR1cm4gKChRdWVyeUNhY2hlU3RvcmVRdWVyeSkgcSkuZ2V0\nRGVsZWdhdGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXN1bHQgbGlzdCBpbXBsZW1lbnRhdGlvbiBmb3IgYSBjYWNoZWQgcXVlcnkg\ncmVzdWx0LiBQYWNrYWdlLXByb3RlY3RlZAogICAgICogZm9yIHRlc3Rpbmcu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgQ2FjaGVkTGlzdCBl\neHRlbmRzIEFic3RyYWN0TGlzdDxPYmplY3Q+CiAgICAgICAgaW1wbGVtZW50\ncyBTZXJpYWxpemFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFF1ZXJ5\nUmVzdWx0IF9yZXM7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9w\ncm9qOwogICAgICAgIHByaXZhdGUgZmluYWwgU3RvcmVDb250ZXh0IF9zY3R4\nOwoKICAgICAgICBwdWJsaWMgQ2FjaGVkTGlzdChRdWVyeVJlc3VsdCByZXMs\nIGJvb2xlYW4gcHJvaiwgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgICAg\nICBfcmVzID0gcmVzOwogICAgICAgICAgICBfcHJvaiA9IHByb2o7CiAgICAg\nICAgICAgIF9zY3R4ID0gY3R4OwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIE9iamVjdCBnZXQoaW50IGlkeCkgewogICAgICAgICAgICBpZiAoIV9wcm9q\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZyb21PYmplY3RJZChfcmVzLmdl\ndChpZHgpLCBfc2N0eCk7CgogICAgICAgICAgICBPYmplY3RbXSBjYWNoZWQg\nPSAoT2JqZWN0W10pIF9yZXMuZ2V0KGlkeCk7CiAgICAgICAgICAgIGlmIChj\nYWNoZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICBPYmplY3RbXSB1bmNhY2hlZCA9IG5ldyBPYmplY3RbY2Fj\naGVkLmxlbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY2FjaGVkLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgdW5jYWNoZWRb\naV0gPSBjb3B5UHJvamVjdGlvbihjYWNoZWRbaV0sIF9zY3R4KTsKICAgICAg\nICAgICAgcmV0dXJuIHVuY2FjaGVkOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBzaXplKCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5zaXpl\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHdyaXRlUmVw\nbGFjZSgpCiAgICAgICAgICAgIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRp\nb24gewogICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdDxPYmplY3Q+\nKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEgd3Jh\ncHBlciBhcm91bmQgYSB7QGxpbmsgUmVzdWx0T2JqZWN0UHJvdmlkZXJ9IHRo\nYXQgYnVpbGRzIHVwIGEgbGlzdCBvZgogICAgICogYWxsIHRoZSBPSURzIGlu\nIHRoaXMgbGlzdCBhbmQgcmVnaXN0ZXJzIHRoYXQgbGlzdCB3aXRoIHRoZQog\nICAgICogcXVlcnkgY2FjaGUuIEFiYW5kb25zIG1vbml0b3JpbmcgYW5kIHJl\nZ2lzdGVyaW5nIGlmIG9uZSBvZiB0aGUgY2xhc3NlcwogICAgICogaW4gdGhl\nIGFjY2VzcyBwYXRoIGlzIG1vZGlmaWVkIHdoaWxlIHRoZSBxdWVyeSByZXN1\nbHRzIGFyZSBiZWluZyBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUgY2xh\nc3MgQ2FjaGluZ1Jlc3VsdE9iamVjdFByb3ZpZGVyCiAgICAgICAgaW1wbGVt\nZW50cyBSZXN1bHRPYmplY3RQcm92aWRlciwgVHlwZXNDaGFuZ2VkTGlzdGVu\nZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdE9iamVjdFByb3Zp\nZGVyIF9yb3A7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9wcm9q\nOwogICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlLZXkgX3FrOwogICAgICAg\nIHByaXZhdGUgZmluYWwgVHJlZU1hcDxJbnRlZ2VyLE9iamVjdD4gX2RhdGEg\nPSBuZXcgVHJlZU1hcDxJbnRlZ2VyLE9iamVjdD4oKTsKICAgICAgICBwcml2\nYXRlIGJvb2xlYW4gX21haW50YWluQ2FjaGUgPSB0cnVlOwogICAgICAgIHBy\naXZhdGUgaW50IF9wb3MgPSAtMTsKCiAgICAgICAgLy8gdXNlZCB0byBkZXRl\ncm1pbmUgbGlzdCBzaXplIHdpdGhvdXQgbmVjZXNzYXJpbHkgY2FsbGluZyBz\naXplKCksCiAgICAgICAgLy8gd2hpY2ggbWF5IHJlcXVpcmUgYSBEQiB0cmlw\nIG9yIHJldHVybiBJbnRlZ2VyLk1BWF9WQUxVRQogICAgICAgIHByaXZhdGUg\naW50IF9tYXggPSAtMTsKICAgICAgICBwcml2YXRlIGludCBfc2l6ZSA9IElu\ndGVnZXIuTUFYX1ZBTFVFOwoKICAgICAgICAvKioKICAgICAgICAgKiBDb25z\ndHJ1Y3Rvci4gU3VwcGx5IGRlbGVnYXRlIHJlc3VsdCBwcm92aWRlciBhbmQg\nb3VyIHF1ZXJ5IGtleS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ2Fj\naGluZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKFJlc3VsdE9iamVjdFByb3ZpZGVy\nIHJvcCwKICAgICAgICAgICAgYm9vbGVhbiBwcm9qLCBRdWVyeUtleSBrZXkp\nIHsKICAgICAgICAgICAgX3JvcCA9IHJvcDsKICAgICAgICAgICAgX3Byb2og\nPSBwcm9qOwogICAgICAgICAgICBfcWsgPSBrZXk7CiAgICAgICAgICAgIF9j\nYWNoZS5hZGRUeXBlc0NoYW5nZWRMaXN0ZW5lcih0aGlzKTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIFN0b3AgY2FjaGluZy4KICAgICAg\nICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgYWJvcnRDYWNoaW5nKCkgewog\nICAgICAgICAgICBpZiAoIV9tYWludGFpbkNhY2hlKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gdGhpcyBjYW4gYmUgY2FsbGVk\nIHZpYSBhbiBldmVudCBmcm9tIGFub3RoZXIgdGhyZWFkCiAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgLy8gaXQn\ncyBpbXBvcnRhbnQgdGhhdCB3ZSBzZXQgdGhpcyBmbGFnIGZpcnN0IHNvIHRo\nYXQgYW55CiAgICAgICAgICAgICAgICAvLyBzdWJzZXF1ZW50IGNhbGxzIHRv\nIHRoaXMgb2JqZWN0IGFyZSBieXBhc3NlZC4KICAgICAgICAgICAgICAgIF9t\nYWludGFpbkNhY2hlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBfY2FjaGUu\ncmVtb3ZlVHlwZXNDaGFuZ2VkTGlzdGVuZXIodGhpcyk7CiAgICAgICAgICAg\nICAgICBfZGF0YS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayB3aGV0aGVyIHdlJ3ZlIGJ1\nZmZlcmVkIGFsbCByZXN1bHRzLCB3aGlsZSBvcHRpb25hbGx5IGFkZGluZwog\nICAgICAgICAqIHRoZSBnaXZlbiByZXN1bHQuCiAgICAgICAgICovCiAgICAg\nICAgcHJpdmF0ZSB2b2lkIGNoZWNrRmluaXNoZWQoT2JqZWN0IG9iaiwgYm9v\nbGVhbiByZXN1bHQpIHsKICAgICAgICAgICAgLy8gdGhpcyBjYW4gYmUgY2Fs\nbGVkIGF0IHRoZSBzYW1lIHRpbWUgYXMgYWJvcnRDYWNoaW5nIHZpYQogICAg\nICAgICAgICAvLyBhIHR5cGVzIGNoYW5nZWQgZXZlbnQKICAgICAgICAgICAg\nYm9vbGVhbiBmaW5pc2hlZCA9IGZhbHNlOwogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmIChfbWFpbnRhaW5D\nYWNoZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgSW50ZWdlciBpbmRleCA9IF9wb3M7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICghX2RhdGEuY29udGFpbnNLZXko\naW5kZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qg\nY2FjaGVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hl\nZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlm\nICghX3Byb2opCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Fj\naGVkID0gX3NjdHguZ2V0T2JqZWN0SWQob2JqKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIE9iamVjdFtdIGFyciA9IChPYmplY3RbXSkgb2JqOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFtdIGNwID0gbmV3IE9i\namVjdFthcnIubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BbaV0gPSBjb3B5\nUHJvamVjdGlvbihhcnJbaV0sIF9zY3R4KTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjYWNoZWQgPSBjcDsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChj\nYWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBfZGF0YS5wdXQoaW5kZXgsIGNhY2hlZCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgZmluaXNoZWQgPSBfc2l6ZSA9PSBfZGF0YS5zaXplKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChm\naW5pc2hlZCkgewogICAgICAgICAgICAgICAgLy8gYW4gYWJvcnRDYWNoaW5n\nIGNhbGwgY2FuIHNuZWFrIGluIGhlcmUgdmlhIG9uRXhwaXJlOyB0aGUKICAg\nICAgICAgICAgICAgIC8vIGNhY2hlIGlzIGxvY2tlZCBkdXJpbmcgZXZlbnQg\nZmlyaW5ncywgc28gdGhlIGxvY2sgaGVyZSB3aWxsCiAgICAgICAgICAgICAg\nICAvLyB3YWl0IGZvciBpdCAob3Igd2lsbCBmb3JjZSB0aGUgbmV4dCBmaXJp\nbmcgdG8gd2FpdCkKICAgICAgICAgICAgICAgIF9jYWNoZS53cml0ZUxvY2so\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIHdlIGRpZG4ndCBhYm9ydAogICAgICAgICAgICAgICAg\nICAgIGlmIChfbWFpbnRhaW5DYWNoZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBRdWVyeVJlc3VsdCByZXMgPSBudWxsOwogICAgICAgICAgICAgICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJlcyA9IG5ldyBRdWVyeVJlc3VsdChfcWssIF9kYXRh\nLnZhbHVlcygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5z\nZXRUaW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIF9jYWNoZS5wdXQoX3FrLCByZXMpOwogICAgICAgICAgICAgICAgICAgICAg\nICBhYm9ydENhY2hpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgICAgICBfY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21BY2Nlc3MoKSB7CiAgICAgICAg\nICAgIHJldHVybiBfcm9wLnN1cHBvcnRzUmFuZG9tQWNjZXNzKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBvcGVuKCkKICAgICAgICAgICAg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9yb3Aub3BlbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRSZXN1bHRPYmpl\nY3QoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgT2JqZWN0IG9iaiA9IF9yb3AuZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAg\nICAgICAgIGNoZWNrRmluaXNoZWQob2JqLCB0cnVlKTsKICAgICAgICAgICAg\ncmV0dXJuIG9iajsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIG5leHQoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgX3BvcysrOwogICAgICAgICAgICBib29sZWFuIG5leHQgPSBfcm9w\nLm5leHQoKTsKICAgICAgICAgICAgaWYgKCFuZXh0ICYmIF9wb3MgPT0gX21h\neCArIDEpIHsKICAgICAgICAgICAgICAgIF9zaXplID0gX3BvczsKICAgICAg\nICAgICAgICAgIGNoZWNrRmluaXNoZWQobnVsbCwgZmFsc2UpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKG5leHQgJiYgX3BvcyA+IF9tYXgpCiAgICAgICAg\nICAgICAgICBfbWF4ID0gX3BvczsKICAgICAgICAgICAgcmV0dXJuIG5leHQ7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShp\nbnQgcG9zKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgX3BvcyA9IHBvczsKICAgICAgICAgICAgYm9vbGVhbiB2YWxpZCA9\nIF9yb3AuYWJzb2x1dGUocG9zKTsKICAgICAgICAgICAgaWYgKCF2YWxpZCAm\nJiBfcG9zID09IF9tYXggKyAxKSB7CiAgICAgICAgICAgICAgICBfc2l6ZSA9\nIF9wb3M7CiAgICAgICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG51bGwsIGZh\nbHNlKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWxpZCAmJiBfcG9zID4g\nX21heCkKICAgICAgICAgICAgICAgIF9tYXggPSBfcG9zOwogICAgICAgICAg\nICByZXR1cm4gdmFsaWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIHNpemUoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgaWYgKF9zaXplICE9IEludGVnZXIuTUFYX1ZBTFVFKQogICAgICAg\nICAgICAgICAgcmV0dXJuIF9zaXplOwogICAgICAgICAgICBpbnQgc2l6ZSA9\nIF9yb3Auc2l6ZSgpOwogICAgICAgICAgICBfc2l6ZSA9IHNpemU7CiAgICAg\nICAgICAgIGNoZWNrRmluaXNoZWQobnVsbCwgZmFsc2UpOwogICAgICAgICAg\nICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHJlc2V0KCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIF9yb3AucmVzZXQoKTsKICAgICAgICAgICAgX3BvcyA9IC0xOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgYWJvcnRDYWNo\naW5nKCk7CiAgICAgICAgICAgIF9yb3AuY2xvc2UoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIGhhbmRsZUNoZWNrZWRFeGNlcHRpb24oRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgX3JvcC5oYW5kbGVDaGVja2VkRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb25U\neXBlc0NoYW5nZWQoVHlwZXNDaGFuZ2VkRXZlbnQgZXYpIHsKICAgICAgICAg\nICAgaWYgKF9xay5jaGFuZ2VJbnZhbGlkYXRlc1F1ZXJ5KGV2LmdldFR5cGVz\nKCkpKQogICAgICAgICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU3RydWN0IHRvIHJlY29nbml6ZSBj\nYWNoZWQgb2lkcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nQ2FjaGVkT2JqZWN0SWQgewoKICAgICAgICBwdWJsaWMgZmluYWwgT2JqZWN0\nIG9pZDsKCiAgICAgICAgcHVibGljIENhY2hlZE9iamVjdElkIChPYmplY3Qg\nb2lkKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5vaWQgPSBvaWQ7CiAg\nICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

