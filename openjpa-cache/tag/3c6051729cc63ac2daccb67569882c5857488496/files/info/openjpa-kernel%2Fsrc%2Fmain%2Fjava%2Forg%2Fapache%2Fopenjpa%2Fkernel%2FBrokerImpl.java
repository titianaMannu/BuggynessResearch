{"sha":"185a73b3f497c76e9d345efb0a90130056fb7de2","node_id":"MDQ6QmxvYjIwNjM2NDoxODVhNzNiM2Y0OTdjNzZlOWQzNDVlZmIwYTkwMTMwMDU2ZmI3ZGUy","size":173868,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/185a73b3f497c76e9d345efb0a90130056fb7de2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBq\nYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7CmltcG9ydCBqYXZheC50cmFuc2Fj\ndGlvbi5TeW5jaHJvbml6YXRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9ycy5JdGVyYXRvckNoYWluOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5JZGVudGl0\neU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5t\nYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxl\nY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5RdWVyeUNhY2hlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5UeXBlc0NoYW5nZWRFdmVu\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5hZ2VkUnVudGlt\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50\nLkxpZmVjeWNsZUV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2\nZW50LkxpZmVjeWNsZUV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5ldmVudC5SZW1vdGVDb21taXRFdmVudE1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuVHJhbnNhY3Rpb25FdmVudDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlvbkV2\nZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nZXhwcy5FeHByZXNzaW9uUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VIYXNoTWFwOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hTZXQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNl\nTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0\nYVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5T\nZXF1ZW5jZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vVHJhbnNhY3Rpb25FeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RF\neGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0\nZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nV3JhcHBlZEV4Y2VwdGlvbjsKCi8qKgogKiBDb25jcmV0ZSB7QGxpbmsgQnJv\na2VyfS4gVGhlIGJyb2tlciBoYW5kbGVzIG9iamVjdC1sZXZlbCBiZWhhdmlv\nciwKICogYnV0IGxlYXZlcyBhbGwgaW50ZXJhY3Rpb24gd2l0aCB0aGUgZGF0\nYSBzdG9yZSB0byBhIHtAbGluayBTdG9yZU1hbmFnZXJ9CiAqIHRoYXQgbXVz\ndCBiZSBzdXBwbGllZCBhdCBpbml0aWFsaXphdGlvbi4KICoKICogQGF1dGhv\nciBBYmUgV2hpdGUKICovCkBTdXBwcmVzc1dhcm5pbmdzKCJzZXJpYWwiKQpw\ndWJsaWMgY2xhc3MgQnJva2VySW1wbAogICAgaW1wbGVtZW50cyBCcm9rZXIs\nIEZpbmRDYWxsYmFja3MsIENsb25lYWJsZSwgU2VyaWFsaXphYmxlIHsKCiAg\nICAvKioKICAgICAqIEluY3JlbWVudGFsIGZsdXNoLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9JTkMgPSAwOwoKICAg\nIC8qKgogICAgICogRmx1c2ggaW4gcHJlcGFyYXRpb24gb2YgY29tbWl0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9D\nT01NSVQgPSAxOwoKICAgIC8qKgogICAgICogRmx1c2ggdG8gY2hlY2sgY29u\nc2lzdGVuY3kgb2YgY2FjaGUsIHRoZW4gaW1tZWRpYXRlbHkgcm9sbGJhY2sg\nY2hhbmdlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBp\nbnQgRkxVU0hfUk9MTEJBQ0sgPSAyOwoKICAgIC8qKgogICAgICogUnVuIHBl\ncnNpc3RlbmNlLWJ5LXJlYWNoYWJpbGl0eSBhbmQgb3RoZXIgZmx1c2gtdGlt\nZSBvcGVyYXRpb25zIHdpdGhvdXQKICAgICAqIGFjY2Vzc2luZyB0aGUgZGF0\nYWJhc2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50\nIEZMVVNIX0xPR0lDQUwgPSAzOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RB\nVFVTX0lOSVQgPSAwOwogICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfVFJB\nTlNJRU5UID0gMTsKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTX09JRF9B\nU1NJR04gPSAyOwogICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfQ09NTUlU\nX05FVyA9IDM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nQUNUSVZFID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIEZMQUdfU1RPUkVfQUNUSVZFID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfQ0xPU0VfSU5WT0tFRCA9IDIgPDwgMjsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1BSRVNUT1JJTkcgPSAy\nIDw8IDM7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19ERVJF\nRkRFTEVUSU5HID0gMiA8PCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfRkxVU0hJTkcgPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9GTFVTSElORyA9IDIgPDwgNjsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNIRUQgPSAyIDw8\nIDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSF9S\nRVFVSVJFRCA9IDIgPDwgODsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBGTEFHX1JFTU9URV9MSVNURU5FUiA9IDIgPDwgOTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX1JFVEFJTkVEX0NPTk4gPSAyIDw8IDEw\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfVFJBTlNfRU5E\nSU5HID0gMiA8PCAxMTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmpl\nY3RbXSBFTVBUWV9PQkpFQ1RTID0gbmV3IE9iamVjdFswXTsKICAgIAogICAg\ncHJpdmF0ZSBTdHJpbmcgX2Nvbm5lY3Rpb25GYWN0b3J5TmFtZSA9ICIiOwog\nICAgcHJpdmF0ZSBTdHJpbmcgX2Nvbm5lY3Rpb25GYWN0b3J5Mk5hbWUgPSAi\nIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nCiAgICAgICAgTG9jYWxpemVyLmZvclBhY2thZ2UoQnJva2VySW1wbC5jbGFz\ncyk7CgogICAgLy8JdGhlIHN0b3JlIG1hbmFnZXIgaW4gdXNlOyB0aGlzIG1h\neSBiZSBhIGRlY29yYXRvciBzdWNoIGFzIGEKICAgIC8vCWRhdGEgY2FjaGUg\nc3RvcmUgbWFuYWdlciBhcm91bmQgdGhlIG5hdGl2ZSBzdG9yZSBtYW5hZ2Vy\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2Vy\nIF9zdG9yZSA9IG51bGw7CgogICAgcHJpdmF0ZSBGZXRjaENvbmZpZ3VyYXRp\nb24gX2ZjID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF91c2VyID0gbnVs\nbDsKICAgIHByaXZhdGUgU3RyaW5nIF9wYXNzID0gbnVsbDsKCiAgICAvLyB0\naGVzZSBtdXN0IGJlIHJlYnVpbHQgYnkgdGhlIGZhY2FkZSBsYXllciBkdXJp\nbmcgaXRzIGRlc2VyaWFsaXphdGlvbgogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nTG9nIF9sb2cgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29tcGF0\naWJpbGl0eSBfY29tcGF0ID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50\nIE1hbmFnZWRSdW50aW1lIF9ydW50aW1lID0gbnVsbDsKICAgIHByaXZhdGUg\ndHJhbnNpZW50IExvY2tNYW5hZ2VyIF9sbSA9IG51bGw7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBJbnZlcnNlTWFuYWdlciBfaW0gPSBudWxsOwogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7CiAg\nICBwcml2YXRlIHRyYW5zaWVudCBPcENhbGxiYWNrcyBfY2FsbCA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBSdW50aW1lRXhjZXB0aW9uVHJhbnNs\nYXRvciBfZXh0cmFucyA9IG51bGw7CgogICAgLy8gcmVmIHRvIHByb2R1Y2lu\nZyBmYWN0b3J5IGFuZCBjb25maWd1cmF0aW9uCiAgICBwcml2YXRlIHRyYW5z\naWVudCBBYnN0cmFjdEJyb2tlckZhY3RvcnkgX2ZhY3RvcnkgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2Nv\nbmYgPSBudWxsOwoKICAgIC8vIGNhY2hlIGNsYXNzIGxvYWRlciBhc3NvY2lh\ndGVkIHdpdGggdGhlIGJyb2tlcgogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xh\nc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAgLy8gdXNlciBzdGF0ZQog\nICAgcHJpdmF0ZSBTeW5jaHJvbml6YXRpb24gX3N5bmMgPSBudWxsOwogICAg\ncHJpdmF0ZSBNYXA8T2JqZWN0LCBPYmplY3Q+IF91c2VyT2JqZWN0cyA9IG51\nbGw7CgogICAgLy8gbWFuYWdlZCBvYmplY3QgY2FjaGVzCiAgICBwcml2YXRl\nIE1hbmFnZWRDYWNoZSBfY2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBUcmFu\nc2FjdGlvbmFsQ2FjaGUgX3RyYW5zQ2FjaGUgPSBudWxsOwogICAgcHJpdmF0\nZSBTZXQ8U3RhdGVNYW5hZ2VySW1wbD4gX3RyYW5zQWRkaXRpb25zID0gbnVs\nbDsKICAgIHByaXZhdGUgU2V0PFN0YXRlTWFuYWdlckltcGw+IF9kZXJlZkNh\nY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0PFN0YXRlTWFuYWdlckltcGw+\nIF9kZXJlZkFkZGl0aW9ucyA9IG51bGw7CgogICAgLy8gdGhlc2UgYXJlIHVz\nZWQgZm9yIG1ldGhvZC1pbnRlcm5hbCBzdGF0ZSBvbmx5CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBNYXA8T2JqZWN0LCBTdGF0ZU1hbmFnZXJJbXBsPiBfbG9h\nZGluZyA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBTZXQ8T2JqZWN0\nPiBfb3BlcmF0aW5nID0gbnVsbDsKCiAgICBwcml2YXRlIFNldDxDbGFzczw/\nPj4gX3BlcnNpc3RlZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQ8Q2xh\nc3M8Pz4+IF91cGRhdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldDxD\nbGFzczw/Pj4gX2RlbGV0ZWRDbHNzID0gbnVsbDsKICAgIHByaXZhdGUgU2V0\nPFN0YXRlTWFuYWdlckltcGw+IF9wZW5kaW5nID0gbnVsbDsKICAgIHByaXZh\ndGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAgLy8gdHJhY2sgaW5zdGFu\nY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwgYWZ0ZXIgdGhlIGZpcnN0\nIHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRoZSB0cmFuc2Fj\ndGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQ8U3RhdGVNYW5hZ2VySW1w\nbD4gX3NhdmVwb2ludENhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2Vk\nTWFwIF9zYXZlcG9pbnRzID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50\nIFNhdmVwb2ludE1hbmFnZXIgX3NwbSA9IG51bGw7CgogICAgLy8gdHJhY2sg\nb3BlbiBxdWVyaWVzIGFuZCBleHRlbnRzIHNvIHdlIGNhbiBmcmVlIHRoZWly\nIHJlc291cmNlcyBvbiBjbG9zZQogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVm\nZXJlbmNlSGFzaFNldCBfcXVlcmllcyA9IG51bGw7CiAgICBwcml2YXRlIHRy\nYW5zaWVudCBSZWZlcmVuY2VIYXNoU2V0IF9leHRlbnRzID0gbnVsbDsKCiAg\nICAvLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVwdGguIFRyYW5zaWVudCBi\nZWNhdXNlIG9wZXJhdGlvbnMgY2Fubm90CiAgICAvLyBzcGFuIHNlcmlhbGl6\nYXRpb24uCiAgICBwcml2YXRlIHRyYW5zaWVudCBpbnQgX29wZXJhdGlvbkNv\ndW50ID0gMDsKCiAgICAvLyBvcHRpb25zCiAgICBwcml2YXRlIGJvb2xlYW4g\nX25vbnRyYW5zUmVhZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9u\nb250cmFuc1dyaXRlID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Jl\ndGFpblN0YXRlID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfYXV0b0NsZWFy\nID0gQ0xFQVJfREFUQVNUT1JFOwogICAgcHJpdmF0ZSBpbnQgX3Jlc3RvcmVT\ndGF0ZSA9IFJFU1RPUkVfSU1NVVRBQkxFOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9vcHRpbWlzdGljID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ln\nbm9yZUNoYW5nZXMgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbXVs\ndGl0aHJlYWRlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9tYW5h\nZ2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N5bmNNYW5hZ2Vk\nID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfY29ublJldGFpbk1vZGUgPSBD\nT05OX1JFVEFJTl9ERU1BTkQ7CiAgICBwcml2YXRlIGJvb2xlYW4gX2V2aWN0\nRGF0YUNhY2hlID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3BvcHVs\nYXRlRGF0YUNhY2hlID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbGFy\nZ2VUcmFuc2FjdGlvbiA9IGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX2F1dG9E\nZXRhY2ggPSAwOwogICAgcHJpdmF0ZSBpbnQgX2RldGFjaFN0YXRlID0gREVU\nQUNIX0xPQURFRDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZGV0YWNoZWROZXcg\nPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcmRlckRpcnR5ID0gZmFs\nc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NhY2hlUHJlcGFyZWRRdWVyeSA9\nIHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NhY2hlRmluZGVyUXVlcnkg\nPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9zdXBwcmVzc0JhdGNoT0xF\nTG9nZ2luZyA9IGZhbHNlOwoKICAgIC8vIHN0YXR1cwogICAgcHJpdmF0ZSBp\nbnQgX2ZsYWdzID0gMDsKCiAgICAvLyB0aGlzIGlzIG5vdCBpbiBzdGF0dXMg\nYmVjYXVzZSBpdCBzaG91bGQgbm90IGJlIHNlcmlhbGl6ZWQKICAgIHByaXZh\ndGUgdHJhbnNpZW50IGJvb2xlYW4gX2lzU2VyaWFsaXppbmcgPSBmYWxzZTsK\nCiAgICAvLyB0cmFuc2llbnQgYmVjYXVzZSBjbG9zZWQgYnJva2VycyBjYW4n\ndCBiZSBzZXJpYWxpemVkCiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFu\nIF9jbG9zZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgdHJhbnNpZW50IFJ1bnRp\nbWVFeGNlcHRpb24gX2Nsb3NlZEV4Y2VwdGlvbiA9IG51bGw7CgogICAgLy8g\nZXZlbnQgbWFuYWdlcnMKICAgIHByaXZhdGUgVHJhbnNhY3Rpb25FdmVudE1h\nbmFnZXIgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgIHByaXZhdGUg\naW50IF90cmFuc0NhbGxiYWNrTW9kZSA9IDA7CiAgICBwcml2YXRlIExpZmVj\neWNsZUV2ZW50TWFuYWdlciBfbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CiAg\nICBwcml2YXRlIGludCBfbGlmZUNhbGxiYWNrTW9kZSA9IDA7CgogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgRGV0YWNoTWFuYWdlckxpdGUgX2RtTGl0ZSA9IG5l\ndyBEZXRhY2hNYW5hZ2VyTGl0ZSgpOwogICAgCiAgICBwcml2YXRlIHRyYW5z\naWVudCBib29sZWFuIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IGZhbHNlOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9vbGVhbiBfZnJvbVdyaXRlQmVoaW5k\nQ2FsbGJhY2sgPSBmYWxzZTsKICAgIHByaXZhdGUgTGlua2VkTGlzdDxGZXRj\naENvbmZpZ3VyYXRpb24+IF9mY3M7CiAgICAKICAgIC8vIFNldCBvZiBzdXBw\nb3J0ZWQgcHJvcGVydHkga2V5cy4gVGhlIGtleXMgaW4gdGhpcyBzZXQgY29y\ncmVzcG9uZCB0byBiZWFuLXN0eWxlIHNldHRlciBtZXRob2RzCiAgICAvLyB0\naGF0IGNhbiBiZSBzZXQgYnkgcmVmbGVjdGlvbi4gVGhlIGtleXMgYXJlIG5v\ndCBxdWFsaWZpZWQgYnkgYW55IHByZWZpeC4KICAgIHByaXZhdGUgc3RhdGlj\nIFNldDxTdHJpbmc+IF9zdXBwb3J0ZWRQcm9wZXJ0eU5hbWVzOwogICAgc3Rh\ndGljIHsKICAgICAgICBfc3VwcG9ydGVkUHJvcGVydHlOYW1lcyA9IG5ldyBI\nYXNoU2V0PFN0cmluZz4oKTsKICAgICAgICBfc3VwcG9ydGVkUHJvcGVydHlO\nYW1lcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW10gewogICAg\nICAgICAgICAgICAgIkF1dG9DbGVhciIsIAogICAgICAgICAgICAgICAgIkF1\ndG9EZXRhY2giLCAKICAgICAgICAgICAgICAgICJDYWNoZUZpbmRlclF1ZXJ5\nIiwgCiAgICAgICAgICAgICAgICAiQ2FjaGVQcmVwYXJlZFF1ZXJ5IiwgCiAg\nICAgICAgICAgICAgICAiRGV0YWNoZWROZXciLCAKICAgICAgICAgICAgICAg\nICJEZXRhY2hTdGF0ZSIsIAogICAgICAgICAgICAgICAgIkV2aWN0RnJvbURh\ndGFDYWNoZSIsIAogICAgICAgICAgICAgICAgIklnbm9yZUNoYW5nZXMiLCAK\nICAgICAgICAgICAgICAgICJMaWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9k\nZSIsIAogICAgICAgICAgICAgICAgIk11bHRpdGhyZWFkZWQiLCAKICAgICAg\nICAgICAgICAgICJOb250cmFuc2FjdGlvbmFsUmVhZCIsIAogICAgICAgICAg\nICAgICAgIk5vbnRyYW5zYWN0aW9uYWxXcml0ZSIsIAogICAgICAgICAgICAg\nICAgIk9wdGltaXN0aWMiLCAKICAgICAgICAgICAgICAgICJQb3B1bGF0ZURh\ndGFDYWNoZSIsCiAgICAgICAgICAgICAgICAiUmVzdG9yZVN0YXRlIiwgCiAg\nICAgICAgICAgICAgICAiUmV0YWluU3RhdGUiLAogICAgICAgICAgICAgICAg\nfSkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBwZXJzaXN0ZW5j\nZSBtYW5hZ2VyJ3MgYXV0aGVudGljYXRpb24uIFRoaXMgaXMgdGhlIGZpcnN0\nCiAgICAgKiBtZXRob2QgY2FsbGVkIGFmdGVyIGNvbnN0cnVjdGlvbi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gdXNlciB0aGUgdXNlcm5hbWUgdGhpcyBicm9r\nZXIgcmVwcmVzZW50czsgdXNlZCB3aGVuIHBvb2xpbmcKICAgICAqIGJyb2tl\ncnMgdG8gbWFrZSBzdXJlIHRoYXQgYSByZXF1ZXN0IHRvIHRoZSBmYWN0b3J5\nIGZvcgogICAgICogYSBjb25uZWN0aW9uIHdpdGggYW4gZXhwbGljaXQgdXNl\nciBpcyBkZWxlZ2F0ZWQgdG8gYSBzdWl0YWJsZSBicm9rZXIKICAgICAqIEBw\nYXJhbSBwYXNzIHRoZSBwYXNzd29yZCBmb3IgdGhlIGFib3ZlIHVzZXIKICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0QXV0aGVudGljYXRpb24oU3RyaW5n\nIHVzZXIsIFN0cmluZyBwYXNzKSB7CiAgICAgICAgX3VzZXIgPSB1c2VyOwog\nICAgICAgIF9wYXNzID0gcGFzczsKICAgIH0KCiAgICAvKioKICAgICAqIElu\naXRpYWxpemUgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIuIFRoaXMgbWV0aG9k\nIGlzIGNhbGxlZAogICAgICogYXV0b21hdGljYWxseSBieSB0aGUgZmFjdG9y\neSBiZWZvcmUgdXNlLgogICAgICoKICAgICAqIEBwYXJhbSBmYWN0b3J5IHRo\nZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIHRoaXMgYnJva2VyCiAgICAgKiBA\ncGFyYW0gc20gYSBjb25jcmV0ZSBTdG9yZU1hbmFnZXIgaW1wbGVtZW50YXRp\nb24gdG8KICAgICAqIGhhbmRsZSBpbnRlcmFjdGlvbiB3aXRoIHRoZSBkYXRh\nIHN0b3JlCiAgICAgKiBAcGFyYW0gbWFuYWdlZCB0aGUgdHJhbnNhY3Rpb24g\nbW9kZQogICAgICogQHBhcmFtIGNvbm5Nb2RlIHRoZSBjb25uZWN0aW9uIHJl\ndGFpbiBtb2RlCiAgICAgKiBAcGFyYW0gZnJvbURlc2VyaWFsaXphdGlvbiB3\naGV0aGVyIHRoaXMgY2FsbCBoYXBwZW5lZCBiZWNhdXNlIG9mIGEKICAgICAq\nIGRlc2VyaWFsaXphdGlvbiBvciBjcmVhdGlvbiBvZiBhIG5ldyBCcm9rZXJJ\nbXBsLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXplKEFic3Ry\nYWN0QnJva2VyRmFjdG9yeSBmYWN0b3J5LAogICAgICAgIERlbGVnYXRpbmdT\ndG9yZU1hbmFnZXIgc20sIGJvb2xlYW4gbWFuYWdlZCwgaW50IGNvbm5Nb2Rl\nLAogICAgICAgIGJvb2xlYW4gZnJvbURlc2VyaWFsaXphdGlvbikgewogICAg\nICAgIGluaXRpYWxpemUoZmFjdG9yeSwgc20sIG1hbmFnZWQsIGNvbm5Nb2Rl\nLCBmcm9tRGVzZXJpYWxpemF0aW9uLCBmYWxzZSk7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoQWJzdHJhY3RCcm9rZXJGYWN0b3J5\nIGZhY3RvcnksCiAgICAgICAgRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBzbSwg\nYm9vbGVhbiBtYW5hZ2VkLCBpbnQgY29ubk1vZGUsCiAgICAgICAgYm9vbGVh\nbiBmcm9tRGVzZXJpYWxpemF0aW9uLCBib29sZWFuIGZyb21Xcml0ZUJlaGlu\nZENhbGxiYWNrKSB7CiAgICAgICAgX2Zyb21Xcml0ZUJlaGluZENhbGxiYWNr\nID0gZnJvbVdyaXRlQmVoaW5kQ2FsbGJhY2s7CiAgICAgICAgX2luaXRpYWxp\nemVXYXNJbnZva2VkID0gdHJ1ZTsKICAgICAgICBfbG9hZGVyID0gQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKTsKICAgICAg\nICBpZiAoIWZyb21EZXNlcmlhbGl6YXRpb24pCiAgICAgICAgICAgIF9jb25m\nID0gZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgX2NvbXBh\ndCA9IF9jb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpOwogICAgICAg\nIF9mYWN0b3J5ID0gZmFjdG9yeTsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0\nTG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19SVU5USU1FKTsKICAgICAg\nICBpZiAoIWZyb21EZXNlcmlhbGl6YXRpb24pCiAgICAgICAgICAgIF9jYWNo\nZSA9IG5ldyBNYW5hZ2VkQ2FjaGUodGhpcyk7CiAgICAgICAgaW5pdGlhbGl6\nZU9wZXJhdGluZ1NldCgpOwogICAgICAgIF9jb25uUmV0YWluTW9kZSA9IGNv\nbm5Nb2RlOwogICAgICAgIF9tYW5hZ2VkID0gbWFuYWdlZDsKICAgICAgICBp\nZiAobWFuYWdlZCkKICAgICAgICAgICAgX3J1bnRpbWUgPSBfY29uZi5nZXRN\nYW5hZ2VkUnVudGltZUluc3RhbmNlKCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBfcnVudGltZSA9IG5ldyBMb2NhbE1hbmFnZWRSdW50aW1lKHRoaXMp\nOwoKICAgICAgICBpZiAoIWZyb21EZXNlcmlhbGl6YXRpb24pIHsKICAgICAg\nICAgICAgX2xpZmVFdmVudE1hbmFnZXIgPSBfY29uZi5nZXRMaWZlY3ljbGVF\ndmVudE1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgICAgICBfdHJhbnNFdmVu\ndE1hbmFnZXIgPSBuZXcgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIoKTsKICAg\nICAgICAgICAgaW50IGNtb2RlID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFj\ndG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAgICAg\nICAgICAgIHNldExpZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2Rl\nKTsKICAgICAgICAgICAgc2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNr\nTW9kZShjbW9kZSk7CgogICAgICAgICAgICAvLyBzZXR1cCBkZWZhdWx0IG9w\ndGlvbnMKICAgICAgICAgICAgX2ZhY3RvcnkuY29uZmlndXJlQnJva2VyKHRo\naXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSBzdXJlIHRvIGRvIHRo\naXMgYWZ0ZXIgY29uZmlndXJpbmcgYnJva2VyIHNvIHRoYXQgc3RvcmUgbWFu\nYWdlcgogICAgICAgIC8vIGNhbiBsb29rIHRvIGJyb2tlciBjb25maWd1cmF0\naW9uOyB3ZSBzZXQgYm90aCBzdG9yZSBhbmQgbG9jayBtYW5hZ2VycwogICAg\nICAgIC8vIGJlZm9yZSBpbml0aWFsaXppbmcgdGhlbSBiZWNhdXNlIHRoZXkg\nbWF5IGVhY2ggdHJ5IHRvIGFjY2VzcyB0aGUKICAgICAgICAvLyBvdGhlciBp\nbiB0aGVpciBpbml0aWFsaXphdGlvbgogICAgICAgIF9zdG9yZSA9IHNtOwog\nICAgICAgIF9sbSA9IF9jb25mLm5ld0xvY2tNYW5hZ2VySW5zdGFuY2UoKTsK\nICAgICAgICBfaW0gPSBfY29uZi5uZXdJbnZlcnNlTWFuYWdlckluc3RhbmNl\nKCk7CiAgICAgICAgX3NwbSA9IF9jb25mLmdldFNhdmVwb2ludE1hbmFnZXJJ\nbnN0YW5jZSgpOwogICAgICAgIF9zdG9yZS5zZXRDb250ZXh0KHRoaXMpOwog\nICAgICAgIF9sbS5zZXRDb250ZXh0KHRoaXMpOwoKICAgICAgICBpZiAoX2Nv\nbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX0FMV0FZUykKICAgICAgICAg\nICAgcmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgIGlmICghZnJvbURlc2Vy\naWFsaXphdGlvbikgewogICAgICAgICAgICBfZmMgPSBfc3RvcmUubmV3RmV0\nY2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIF9mYy5zZXRDb250ZXh0\nKHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gc3luY2ggd2l0aCB0aGUg\nZ2xvYmFsIHRyYW5zYWN0aW9uIGluIHByb2dyZXNzLCBpZiBhbnkKICAgICAg\nICBpZiAoX2ZhY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24odGhp\ncywgZmFsc2UpKQogICAgICAgICAgICBiZWdpbkludGVybmFsKCk7CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVPcGVyYXRpbmdTZXQoKSB7\nCiAgICAgICAgX29wZXJhdGluZyA9IE1hcEJhY2tlZFNldC5kZWNvcmF0ZShu\nZXcgSWRlbnRpdHlNYXAoKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nR2V0cyB0aGUgdW5tb2RpZmlhYmxlIHNldCBvZiBpbnN0YW5jZXMgYmVpbmcg\nb3BlcmF0ZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXQ8T2JqZWN0PiBn\nZXRPcGVyYXRpbmdTZXQoKSB7CiAgICAJcmV0dXJuIENvbGxlY3Rpb25zLnVu\nbW9kaWZpYWJsZVNldChfb3BlcmF0aW5nKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGNsb25lKCkKICAgICAgICB0aHJvd3MgQ2xvbmVOb3RTdXBwb3J0\nZWRFeGNlcHRpb24gewogICAgICAgIGlmIChfaW5pdGlhbGl6ZVdhc0ludm9r\nZWQpCiAgICAgICAgICAgIHRocm93IG5ldyBDbG9uZU5vdFN1cHBvcnRlZEV4\nY2VwdGlvbigpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4g\nc3VwZXIuY2xvbmUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSB7QGxpbmsgTWFwfSB0byBiZSB1c2VkIGZvciB0aGUgcHJp\nbWFyeSBtYW5hZ2VkIG9iamVjdCBjYWNoZS4KICAgICAqIE1hcHMgb2lkcyB0\nbyBzdGF0ZSBtYW5hZ2Vycy4gQnkgZGVmYXVsdCwgdGhpcyBjcmVhdGVzIGEK\nICAgICAqIHtAbGluayBSZWZlcmVuY2VNYXB9IHdpdGggc29mdCB2YWx1ZXMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBNYXA8Pyw/PiBuZXdNYW5hZ2VkT2Jq\nZWN0Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZWZlcmVuY2VIYXNo\nTWFwKFJlZmVyZW5jZU1hcC5IQVJELCBSZWZlcmVuY2VNYXAuU09GVCk7CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3RvcmVDb250ZXh0CiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEJy\nb2tlciBnZXRCcm9rZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByb3BlcnRpZXMKICAgIC8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0SW1wbGljaXRCZWhh\ndmlvcihPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFJ1bnRpbWVFeGNlcHRp\nb25UcmFuc2xhdG9yIGV4KSB7CiAgICAgICAgaWYgKF9jYWxsID09IG51bGwp\nCiAgICAgICAgICAgIF9jYWxsID0gY2FsbDsKICAgICAgICBpZiAoX2V4dHJh\nbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2V4dHJhbnMgPSBleDsKICAgIH0K\nCiAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBnZXRJbnN0YW5jZUV4\nY2VwdGlvblRyYW5zbGF0b3IoKSB7CiAgICAgICAgcmV0dXJuIChfb3BlcmF0\naW9uQ291bnQgPT0gMCkgPyBfZXh0cmFucyA6IG51bGw7CiAgICB9CgogICAg\ncHVibGljIEJyb2tlckZhY3RvcnkgZ2V0QnJva2VyRmFjdG9yeSgpIHsKICAg\nICAgICByZXR1cm4gX2ZhY3Rvcnk7CiAgICB9CgogICAgcHVibGljIE9wZW5K\nUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAg\ncmV0dXJuIF9jb25mOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVy\nbiBfZmM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBw\ndXNoRmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIGlmIChfZmNzID09\nIG51bGwpCiAgICAgICAgICAgIF9mY3MgPSBuZXcgTGlua2VkTGlzdDxGZXRj\naENvbmZpZ3VyYXRpb24+KCk7CiAgICAgICAgX2Zjcy5hZGQoX2ZjKTsKICAg\nICAgICBfZmMgPSAoRmV0Y2hDb25maWd1cmF0aW9uKSBfZmMuY2xvbmUoKTsK\nICAgICAgICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBv\ncEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAgICBpZiAoX2ZjcyA9PSBu\ndWxsIHx8IF9mY3MuaXNFbXB0eSgpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgi\nZmV0Y2gtY29uZmlndXJhdGlvbi1zdGFjay1lbXB0eSIpKTsKICAgICAgICBf\nZmMgPSBfZmNzLnJlbW92ZUxhc3QoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIGdldENvbm5lY3Rpb25SZXRhaW5Nb2RlKCkgewogICAgICAgIHJldHVybiBf\nY29ublJldGFpbk1vZGU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNN\nYW5hZ2VkKCkgewogICAgICAgIHJldHVybiBfbWFuYWdlZDsKICAgIH0KCiAg\nICBwdWJsaWMgTWFuYWdlZFJ1bnRpbWUgZ2V0TWFuYWdlZFJ1bnRpbWUoKSB7\nCiAgICAgICAgcmV0dXJuIF9ydW50aW1lOwogICAgfQoKICAgIHB1YmxpYyBD\nbGFzc0xvYWRlciBnZXRDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1cm4g\nX2xvYWRlcjsKICAgIH0KCiAgICBwdWJsaWMgRGVsZWdhdGluZ1N0b3JlTWFu\nYWdlciBnZXRTdG9yZU1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9zdG9y\nZTsKICAgIH0KCiAgICBwdWJsaWMgTG9ja01hbmFnZXIgZ2V0TG9ja01hbmFn\nZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sbTsKICAgIH0KCiAgICBwdWJsaWMg\nSW52ZXJzZU1hbmFnZXIgZ2V0SW52ZXJzZU1hbmFnZXIoKSB7CiAgICAgICAg\ncmV0dXJuIF9pbTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbm5l\nY3Rpb25Vc2VyTmFtZSgpIHsKICAgICAgICByZXR1cm4gX3VzZXI7CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uUGFzc3dvcmQoKSB7\nCiAgICAgICAgcmV0dXJuIF9wYXNzOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGdldE11bHRpdGhyZWFkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9tdWx0\naXRocmVhZGVkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE11bHRpdGhy\nZWFkZWQoYm9vbGVhbiBtdWx0aXRocmVhZGVkKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIF9tdWx0aXRocmVhZGVkID0gbXVsdGl0aHJlYWRl\nZDsKICAgICAgICBpZiAobXVsdGl0aHJlYWRlZCAmJiBfbG9jayA9PSBudWxs\nKQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVudHJhbnRMb2NrKCk7CiAg\nICAgICAgZWxzZSBpZiAoIW11bHRpdGhyZWFkZWQpCiAgICAgICAgICAgIF9s\nb2NrID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJZ25v\ncmVDaGFuZ2VzKCkgewogICAgICAgIHJldHVybiBfaWdub3JlQ2hhbmdlczsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25vcmVDaGFuZ2VzKGJvb2xl\nYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9pZ25v\ncmVDaGFuZ2VzID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdl\ndE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkgewogICAgICAgIHJldHVybiBfbm9u\ndHJhbnNSZWFkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE5vbnRyYW5z\nYWN0aW9uYWxSZWFkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAh\nPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsKCiAgICAgICAgLy8g\nbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAgICAgICAgaWYg\nKHZhbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zCiAg\nICAgICAgICAgIChPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fTk9OVFJB\nTlNfUkVBRCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJub250cmFucy1y\nZWFkLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIF9ub250cmFuc1JlYWQg\nPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNh\nY3Rpb25hbFdyaXRlKCkgewogICAgICAgIHJldHVybiBfbm9udHJhbnNXcml0\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFs\nV3JpdGUoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nbGxlZ2FsLW9wLWluLXByZXN0b3JlIikpOwoKICAgICAgICBfbm9udHJhbnNX\ncml0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcHRp\nbWlzdGljKCkgewogICAgICAgIHJldHVybiBfb3B0aW1pc3RpYzsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRPcHRpbWlzdGljKGJvb2xlYW4gdmFsKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIsCiAg\nICAgICAgICAgICAgICAiT3B0aW1pc3RpYyIpKTsKCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAgICAgICAgaWYgKHZh\nbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKE9wZW5K\nUEFDb25maWd1cmF0aW9uLk9QVElPTl9PUFRJTUlTVElDKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAg\nICAgICAgICAgICAgICAoIm9wdGltaXN0aWMtbm90LXN1cHBvcnRlZCIpKTsK\nCiAgICAgICAgX29wdGltaXN0aWMgPSB2YWw7CiAgICB9CgogICAgcHVibGlj\nIGludCBnZXRSZXN0b3JlU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXN0\nb3JlU3RhdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVzdG9yZVN0\nYXRlKGludCB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidHJh\nbnMtYWN0aXZlIiwKICAgICAgICAgICAgICAgICJSZXN0b3JlIikpOwoKICAg\nICAgICBfcmVzdG9yZVN0YXRlID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldFJldGFpblN0YXRlKCkgewogICAgICAgIHJldHVybiBfcmV0\nYWluU3RhdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmV0YWluU3Rh\ndGUoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxl\nZ2FsLW9wLWluLXByZXN0b3JlIikpOwogICAgICAgIF9yZXRhaW5TdGF0ZSA9\nIHZhbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEF1dG9DbGVhcigpIHsK\nICAgICAgICByZXR1cm4gX2F1dG9DbGVhcjsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRBdXRvQ2xlYXIoaW50IHZhbCkgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBfYXV0b0NsZWFyID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0QXV0b0RldGFjaCgpIHsKICAgICAgICByZXR1cm4gX2F1\ndG9EZXRhY2g7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFj\naChpbnQgZGV0YWNoRmxhZ3MpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgX2F1dG9EZXRhY2ggPSBkZXRhY2hGbGFnczsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRBdXRvRGV0YWNoKGludCBkZXRhY2hGbGFnLCBib29s\nZWFuIG9uKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChv\nbikKICAgICAgICAgICAgX2F1dG9EZXRhY2ggfD0gZGV0YWNoRmxhZzsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIF9hdXRvRGV0YWNoICY9IH5kZXRhY2hG\nbGFnOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RGV0YWNoU3RhdGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXREZXRhY2hTdGF0ZShpbnQgbW9kZSkgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICBfZGV0YWNoU3RhdGUgPSBtb2RlOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGV0YWNoZWROZXcoKSB7CiAgICAg\nICAgcmV0dXJuIF9kZXRhY2hlZE5ldzsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXREZXRhY2hlZE5ldyhib29sZWFuIGlzTmV3KSB7CiAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgIF9kZXRhY2hlZE5ldyA9IGlzTmV3OwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFN5bmNXaXRoTWFuYWdlZFRyYW5z\nYWN0aW9ucygpIHsKICAgICAgICByZXR1cm4gX3N5bmNNYW5hZ2VkOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0\naW9ucyhib29sZWFuIHN5bmMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgX3N5bmNNYW5hZ2VkID0gc3luYzsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRFdmljdEZyb21EYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9ldmljdERhdGFDYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRFdmljdEZyb21EYXRhQ2FjaGUoYm9vbGVhbiBldmljdCkgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBfZXZpY3REYXRhQ2FjaGUgPSBldmlj\ndDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRQb3B1bGF0ZURhdGFD\nYWNoZSgpIHsKICAgICAgICByZXR1cm4gX3BvcHVsYXRlRGF0YUNhY2hlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFBvcHVsYXRlRGF0YUNhY2hlKGJv\nb2xlYW4gY2FjaGUpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nX3BvcHVsYXRlRGF0YUNhY2hlID0gY2FjaGU7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNUcmFja0NoYW5nZXNCeVR5cGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9sYXJnZVRyYW5zYWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFRyYWNrQ2hhbmdlc0J5VHlwZShib29sZWFuIGxhcmdlVHJhbnNhY3Rp\nb24pIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2xhcmdlVHJh\nbnNhY3Rpb24gPSBsYXJnZVRyYW5zYWN0aW9uOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0VXNlck9iamVjdChPYmplY3Qga2V5KSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiAoX3VzZXJPYmplY3RzID09IG51bGwpID8gbnVsbCA6IF91\nc2VyT2JqZWN0cy5nZXQoa2V5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBwdXRVc2VyT2JqZWN0KE9iamVjdCBrZXksIE9iamVj\ndCB2YWwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIChfdXNlck9iamVjdHMgPT0gbnVsbCkgPyBudWxs\nIDogX3VzZXJPYmplY3RzLnJlbW92ZShrZXkpOwoKICAgICAgICAgICAgaWYg\nKF91c2VyT2JqZWN0cyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3VzZXJP\nYmplY3RzID0gbmV3IEhhc2hNYXA8T2JqZWN0LCBPYmplY3Q+KCk7CiAgICAg\nICAgICAgIHJldHVybiBfdXNlck9iamVjdHMucHV0KGtleSwgdmFsKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY3VycmVudCBj\nb25maWd1cmF0aW9uIHByb3BlcnR5IHZhbHVlcyB1c2VkIGJ5IHRoaXMgaW5z\ndGFuY2UuCiAgICAgKiBUaGlzIHZhbHVlcyBhcmUgY29tYmluYXRpb24gb2Yg\ndGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiB2YWx1ZXMgCiAgICAgKiBvdmVy\nd3JpdHRlbiBieSB2YWx1ZXMgbWFpbnRhaW5lZCBieSB0aGlzIGluc3RhbmNl\nIHN1Y2ggYXMKICAgICAqIE9wdGltaXN0aWMgZmxhZy4gCiAgICAgKi8KICAg\nIHB1YmxpYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldFByb3BlcnRpZXMoKSB7\nCiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBwcm9wcyA9IF9jb25mLnRv\nUHJvcGVydGllcyh0cnVlKTsKICAgICAgICBmb3IgKFN0cmluZyBzIDogX3N1\ncHBvcnRlZFByb3BlcnR5TmFtZXMpIHsKICAgICAgICAgICAgcHJvcHMucHV0\nKCJvcGVuanBhLiIgKyBzLCBSZWZsZWN0aW9uLmdldFZhbHVlKHRoaXMsIHMs\nIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb3BzOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHByb3BlcnR5IG5hbWVz\nIHRoYXQgY2FuIGJlIHVzZWQgdG8gY29ycmVzcG9uZGluZyBzZXR0ZXIgbWV0\naG9kcyBvZiB0aGlzIHJlY2VpdmVyCiAgICAgKiB0byBzZXQgaXRzIHZhbHVl\nLgogICAgICovICAgIAogICAgcHVibGljIFNldDxTdHJpbmc+IGdldFN1cHBv\ncnRlZFByb3BlcnRpZXMoKSB7CiAgICAgICAgU2V0PFN0cmluZz4ga2V5cyA9\nIF9jb25mLmdldFByb3BlcnR5S2V5cygpOwogICAgICAgIGZvciAoU3RyaW5n\nIHMgOiBfc3VwcG9ydGVkUHJvcGVydHlOYW1lcykKICAgICAgICAgICAga2V5\ncy5hZGQoIm9wZW5qcGEuIiArIHMpOwogICAgICAgIHJldHVybiBrZXlzOwog\nICAgfQoKICAgIC8vIC8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vIC8v\nLy8vLy8vCgogICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIo\nT2JqZWN0IGxpc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsKICAgICAgICBi\nZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgX2xpZmVFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNs\nYXNzZXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBy\nZW1vdmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIobGlz\ndGVuZXIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndExpZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJl\ndHVybiBfbGlmZUNhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRMaWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkg\newogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBfbGlmZUNhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAg\nICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYg\nQ0FMTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHaXZlIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0\nbyB0aGUgbGlmZWN5Y2xlIGV2ZW50IG1hbmFnZXIuCiAgICAgKi8KICAgIHB1\nYmxpYyBMaWZlY3ljbGVFdmVudE1hbmFnZXIgZ2V0TGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsK\nICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gbGlmZWN5Y2xlIGV2\nZW50LCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0ZWx5Lgog\nICAgICoKICAgICAqIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5n\nIHByb2Nlc3NlZCBhdCB0aGlzIHRpbWUKICAgICAqLwogICAgYm9vbGVhbiBm\naXJlTGlmZWN5Y2xlRXZlbnQoT2JqZWN0IHNyYywgT2JqZWN0IHJlbGF0ZWQs\nIENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBpbnQgZXZlbnRUeXBlKSB7\nCiAgICAgICAgaWYgKF9saWZlRXZlbnRNYW5hZ2VyID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgbG9jaygpOwogICAgICAg\nIEV4Y2VwdGlvbltdIGV4czsKICAgICAgICB0cnkgewogICAgICAgICAgICBl\neHMgPSBfbGlmZUV2ZW50TWFuYWdlci5maXJlRXZlbnQoc3JjLCByZWxhdGVk\nLCBtZXRhLCBldmVudFR5cGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0gCiAgICAgICAgaGFuZGxlQ2Fs\nbGJhY2tFeGNlcHRpb25zKGV4cywgX2xpZmVDYWxsYmFja01vZGUpOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVGFrZSBh\nY3Rpb25zIG9uIGNhbGxiYWNrIGV4Y2VwdGlvbnMgZGVwZW5kaW5nIG9uIGNh\nbGxiYWNrIG1vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYW5kbGVD\nYWxsYmFja0V4Y2VwdGlvbnMoRXhjZXB0aW9uW10gZXhjZXBzLCBpbnQgbW9k\nZSkgewogICAgICAgIGlmIChleGNlcHMubGVuZ3RoID09IDAgfHwgKG1vZGUg\nJiBDQUxMQkFDS19JR05PUkUpICE9IDApCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBjZTsKICAgICAgICBpZiAoZXhj\nZXBzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBleGNl\ncHRpb24gaXMgYWxyZWFkeSBhIHdyYXBwZWQgZXhjZXB0aW9uIHRocm93IHRo\nZSAKICAgICAgICAgICAgLy8gZXhjZXB0aW9uIGluc3RlYWQgb2Ygd3JhcHBp\nbmcgaXQgd2l0aCBhIGNhbGxiYWNrIGV4Y2VwdGlvbgogICAgICAgICAgICBp\nZiAoZXhjZXBzWzBdIGluc3RhbmNlb2YgV3JhcHBlZEV4Y2VwdGlvbikKICAg\nICAgICAgICAgICAgIHRocm93IChXcmFwcGVkRXhjZXB0aW9uKWV4Y2Vwc1sw\nXTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY2UgPSBuZXcg\nQ2FsbGJhY2tFeGNlcHRpb24oZXhjZXBzWzBdKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihfbG9j\nLmdldCgiY2FsbGJhY2stZXJyIikpLgogICAgICAgICAgICAgICAgc2V0TmVz\ndGVkVGhyb3dhYmxlcyhleGNlcHMpOwogICAgICAgIH0KICAgICAgICBpZiAo\nKG1vZGUgJiBDQUxMQkFDS19ST0xMQkFDSykgIT0gMCAmJiAoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgY2Uuc2V0RmF0YWwo\ndHJ1ZSk7CiAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGNl\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfTE9H\nKSAhPSAwICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBf\nbG9nLndhcm4oY2UpOwogICAgICAgIGlmICgobW9kZSAmIENBTExCQUNLX1JF\nVEhST1cpICE9IDApCiAgICAgICAgICAgIHRocm93IGNlOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGFkZFRyYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IHRs\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF90cmFuc0V2ZW50TWFuYWdlci5hZGRMaXN0ZW5l\ncih0bCk7CiAgICAgICAgICAgIGlmICh0bCBpbnN0YW5jZW9mIFJlbW90ZUNv\nbW1pdEV2ZW50TWFuYWdlcikKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX1JFTU9URV9MSVNURU5FUjsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcmVtb3ZlVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3Qg\ndGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5yZW1v\ndmVMaXN0ZW5lcih0bCkKICAgICAgICAgICAgICAgICYmICh0bCBpbnN0YW5j\nZW9mIFJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcikpCiAgICAgICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfUkVNT1RFX0xJU1RFTkVSOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHVibGljIENvbGxlY3Rpb248T2JqZWN0PiBn\nZXRUcmFuc2FjdGlvbkxpc3RlbmVycygpIHsKICAgICAgICByZXR1cm4gX3Ry\nYW5zRXZlbnRNYW5hZ2VyLmdldExpc3RlbmVycygpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZSgp\nIHsKICAgICAgICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tNb2RlOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFj\na01vZGUoaW50IG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxz\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3RyYW5zQ2FsbGJhY2tN\nb2RlID0gbW9kZTsKICAgICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyLnNl\ndEZhaWxGYXN0KChtb2RlICYgQ0FMTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXJlIGdpdmVu\nIHRyYW5zYWN0aW9uIGV2ZW50LCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBh\ncHByb3ByaWF0ZWx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmlyZVRy\nYW5zYWN0aW9uRXZlbnQoVHJhbnNhY3Rpb25FdmVudCB0cmFucykgewogICAg\nICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKF90cmFuc0V2ZW50TWFuYWdl\nci5maXJlRXZlbnQodHJhbnMpLAogICAgICAgICAgICAgICAgX3RyYW5zQ2Fs\nbGJhY2tNb2RlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB3aGV0aGVy\nIHRoaXMgQnJva2VyIHdpbGwgZ2VuZXJhdGUgdmVyYm9zZSBvcHRpbWlzdGlj\nIGxvY2sgZXhjZXB0aW9ucyB3aGVuIGJhdGNoaW5nCiAgICAgKiBvcGVyYXRp\nb25zLiBEZWZhdWx0cyB0byB0cnVlLgogICAgICogCiAgICAgKiBAcGFyYW0g\nYgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdXBwcmVzc0JhdGNoT0xF\nTG9nZ2luZyhib29sZWFuIGIpIHsKICAgICAgICBfc3VwcHJlc3NCYXRjaE9M\nRUxvZ2dpbmcgPSBiOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVy\nbiB3aGV0aGVyIHRoaXMgQnJva2VyIHdpbGwgZ2VuZXJhdGUgdmVyYm9zZSBv\ncHRpbWlzdGljIGxvY2sgZXhjZXB0aW9ucyB3aGVuIGJhdGNoaW5nCiAgICAg\nKiBvcGVyYXRpb25zLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRT\ndXBwcmVzc0JhdGNoT0xFTG9nZ2luZygpIHsKICAgICAgICByZXR1cm4gX3N1\ncHByZXNzQmF0Y2hPTEVMb2dnaW5nOwogICAgfQogICAgLy8vLy8vLy8vLy8K\nICAgIC8vIExvb2t1cHMKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGljIE9i\namVjdCBmaW5kKE9iamVjdCBvaWQsIGJvb2xlYW4gdmFsaWRhdGUsIEZpbmRD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGludCBmbGFncyA9IE9JRF9DT1BZ\nIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAgICAgaWYg\nKCF2YWxpZGF0ZSkKICAgICAgICAgICAgZmxhZ3MgfD0gT0lEX05PVkFMSURB\nVEU7CiAgICAgICAgcmV0dXJuIGZpbmQob2lkLCBfZmMsIG51bGwsIG51bGws\nIGZsYWdzLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQo\nT2JqZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRTZXQg\nZXhjbHVkZSwKICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewog\nICAgICAgIHJldHVybiBmaW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRh\nLCBmbGFncywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5h\nbCBmaW5kZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgZmluZChP\nYmplY3Qgb2lkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBl\neGNsdWRlLAogICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzLCBGaW5k\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQog\nICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxsLnBy\nb2Nlc3NBcmd1bWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09\nIDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24oX2xvYy5nZXQoIm51bGwtb2lkIikpOwogICAgICAgICAgICBy\nZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRj\naCA9IF9mYzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJl\nYWQoKTsKCiAgICAgICAgICAgIC8vIGNhY2hlZCBpbnN0YW5jZT8KICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGxCeUlkKG9pZCwKICAgICAgICAgICAgICAgIChmbGFncyAmIE9JRF9BTExP\nV19ORVcpICE9IDAgfHwgaGFzRmx1c2hlZCgpKTsKICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICghcmVxdWlyZXNM\nb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20p\nOwoKICAgICAgICAgICAgICAgIGlmICghc20uaXNMb2FkaW5nKCkpIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgYWxsIHRoZSBjb25maWd1\ncmVkIGZpZWxkcyBhcmUgbG9hZGVkOyBkbyB0aGlzCiAgICAgICAgICAgICAg\nICAgICAgLy8gYWZ0ZXIgbWFraW5nIGluc3RhbmNlIHRyYW5zYWN0aW9uYWwg\nZm9yIGxvY2tpbmcKICAgICAgICAgICAgICAgICAgICBpZiAoIXNtLmlzVHJh\nbnNhY3Rpb25hbCgpICYmIHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsK\nICAgICAgICAgICAgICAgICAgICBib29sZWFuIGxvYWRlZDsKICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2Fk\nZWQgPSBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdT\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGUsIGVkYXRh\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoT2JqZWN0\nTm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURB\nVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBv\nbmZlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9j\nZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICAvLyBpZiBubyBkYXRhIG5lZWRlZCB0byBi\nZSBsb2FkZWQgYW5kIHRoZSB1c2VyIHdhbnRzIHRvCiAgICAgICAgICAgICAg\nICAgICAgLy8gdmFsaWRhdGUsIGp1c3QgbWFrZSBzdXJlIHRoZSBvYmplY3Qg\nZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFsb2FkZWQgJiYgKGZs\nYWdzICYgT0lEX05PVkFMSURBVEUpID09IDAKICAgICAgICAgICAgICAgICAg\nICAgICAgJiYgX2NvbXBhdC5nZXRWYWxpZGF0ZVRydWVDaGVja3NTdG9yZSgp\nCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFzbS5pc1RyYW5zYWN0aW9u\nYWwoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhX3N0b3JlLmV4aXN0\ncyhzbSwgZWRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgo\nZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSA9PSAwKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0\nTm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICgiZGVsLWluc3RhbmNlIiwgc20uZ2V0TWFuYWdlZEluc3Rh\nbmNlKCksIG9pZCkpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0\nRmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgLy8gc2luY2UgdGhlIG9iamVjdCB3YXMgY2FjaGVkLCB3ZSBtYXkg\nbmVlZCB0byB1cGdyYWRlIGxvY2sKICAgICAgICAgICAgICAgIC8vIGlmIGN1\ncnJlbnQgbGV2ZWwgaXMgaGlnaGVyIHRoYW4gbGV2ZWwgb2YgaW5pdGlhbCBs\nb2FkCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZF\nKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IGxldmVsID0gZmV0\nY2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAgICAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRh\ndGEpOwogICAgICAgICAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWws\nIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihv\naWQsIHNtKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhl\ncmUncyBubyBjYWNoZWQgc20gZm9yIGEgbmV3L3RyYW5zaWVudCBpZCB0eXBl\nLCB3ZQogICAgICAgICAgICAvLyBpdCBkZWZpbml0ZWx5IGRvZXNuJ3QgZXhp\nc3QKICAgICAgICAgICAgaWYgKG9pZCBpbnN0YW5jZW9mIFN0YXRlTWFuYWdl\ncklkKQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVy\nbihvaWQsIG51bGwpOwoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBhIG5l\ndyBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZGF0YXN0b3JlIGluc3RhbmNlCiAg\nICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIChmbGFn\ncyAmIE9JRF9DT1BZKSAhPSAwKTsKICAgICAgICAgICAgYm9vbGVhbiBsb2Fk\nID0gcmVxdWlyZXNMb2FkKHNtLCBmYWxzZSwgZmV0Y2gsIGVkYXRhLCBmbGFn\ncyk7CiAgICAgICAgICAgIHNtID0gaW5pdGlhbGl6ZShzbSwgbG9hZCwgZmV0\nY2gsIGVkYXRhKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0g\nMCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91\nbmRFeGNlcHRpb24ob2lkKTsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjb25maWd1cmVkIGZpZWxkcyB3\nZXJlIGxvYWRlZAogICAgICAgICAgICBpZiAobG9hZCkgewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKGZldGNo\nLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBleGNsdWRlLAogICAgICAg\nICAgICAgICAgICAgICAgICBlZGF0YSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewog\nICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVE\nKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAmIE9J\nRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAgICB0\naHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnBy\nb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0\ndXJuKG9pZCwgc20pOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5ld2x5LWNvbnN0cnVjdGVk\nIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1h\nbmFnZXJJbXBsIGluaXRpYWxpemUoU3RhdGVNYW5hZ2VySW1wbCBzbSwgYm9v\nbGVhbiBsb2FkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\nT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgaWYgKCFsb2FkKSB7CiAgICAgICAg\nICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmli\nZWRUeXBlKCksCiAgICAgICAgICAgICAgICBQQ1N0YXRlLkhPTExPVyk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZSA9ICh1\nc2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQogICAgICAgICAgICAgICAg\nPyBQQ1N0YXRlLlBDTEVBTiA6IFBDU3RhdGUuUE5PTlRSQU5TOwogICAgICAg\nICAgICBzbS5zZXRMb2FkaW5nKHRydWUpOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaWYgKCFfc3RvcmUuaW5pdGlhbGl6ZShzbSwgc3Rh\ndGUsIGZldGNoLCBlZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICBzbS5zZXRMb2FkaW5nKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gc207CiAgICB9CgogICAgcHVibGljIE9iamVj\ndFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBib29sZWFuIHZhbGlkYXRl\nLAogICAgICAgIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGludCBm\nbGFncyA9IE9JRF9DT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVU\nRUQ7CiAgICAgICAgaWYgKCF2YWxpZGF0ZSkKICAgICAgICAgICAgZmxhZ3Mg\nfD0gT0lEX05PVkFMSURBVEU7CiAgICAgICAgcmV0dXJuIGZpbmRBbGwob2lk\ncywgX2ZjLCBudWxsLCBudWxsLCBmbGFncywgY2FsbCk7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUs\nIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAgICAgICAgcmV0dXJuIGZp\nbmRBbGwob2lkcywgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRhLCBmbGFncywgbnVs\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rp\nb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJp\ndFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncywgRmluZENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZmluZEFsbERlcHRoICsrOwoKICAg\nICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyBmb3IgbnVsbCBvaWRzIHVw\nIGltbWVkaWF0ZWx5CiAgICAgICAgaWYgKG9pZHMgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCJvaWRzID09\nIG51bGwiKTsKICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUp\nICE9IDAgJiYgb2lkcy5jb250YWlucyhudWxsKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtb2lkcyIpKTsK\nCiAgICAgICAgLy8gd2UgaGF2ZSB0byB1c2UgYSBtYXAgb2Ygb2lkLT5zbSBy\nYXRoZXIgdGhhbiBhIHNpbXBsZQogICAgICAgIC8vIGFycmF5LCBzbyB0aGF0\nIHdlIG1ha2Ugc3VyZSBub3QgdG8gY3JlYXRlIG11bHRpcGxlIHNtcyBmb3Ig\nZXF1aXZhbGVudAogICAgICAgIC8vIG9pZHMgaWYgdGhlIHVzZXIgaGFzIGR1\ncGxpY2F0ZXMgaW4gdGhlIGdpdmVuIGFycmF5CiAgICAgICAgaWYgKF9sb2Fk\naW5nID09IG51bGwpCiAgICAgICAgICAgIF9sb2FkaW5nID0gbmV3IEhhc2hN\nYXA8T2JqZWN0LCBTdGF0ZU1hbmFnZXJJbXBsPigoaW50KSAob2lkcy5zaXpl\nKCkgKiAxLjMzICsgMSkpOwoKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQog\nICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBpZiAoZmV0Y2ggPT0g\nbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAvLyBj\nb2xsZWN0aW9uIG9mIHN0YXRlIG1hbmFnZXJzIHRvIHBhc3MgdG8gc3RvcmUg\nbWFuYWdlcgogICAgICAgICAgICBMaXN0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+\nIGxvYWQgPSBudWxsOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nOwogICAgICAgICAgICBib29sZWFuIGluaXRpYWxpemVkOwogICAgICAgICAg\nICBib29sZWFuIHRyYW5zU3RhdGUgPSB1c2VUcmFuc2FjdGlvbmFsU3RhdGUo\nZmV0Y2gpOwogICAgICAgICAgICBPYmplY3Qgb2JqLCBvaWQ7CiAgICAgICAg\nICAgIGludCBpZHggPSAwOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+\nIGl0ciA9IG9pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4Kysp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgc2VlbiB0\naGlzIG9pZCwgc2tpcCByZXBlYXRzCiAgICAgICAgICAgICAgICBvYmogPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNz\nQXJndW1lbnQob2JqKTsKICAgICAgICAgICAgICAgIGlmIChvaWQgPT0gbnVs\nbCB8fCBfbG9hZGluZy5jb250YWluc0tleShvYmopKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRv\nbid0IGhhdmUgYSBjYWNoZWQgaW5zdGFuY2Ugb3IgaXQgaXMgbm90IHRyYW5z\nYWN0aW9uYWwKICAgICAgICAgICAgICAgIC8vIGFuZCBpcyBob2xsb3cgb3Ig\nd2UgbmVlZCB0byB2YWxpZGF0ZSwgbG9hZCBpdAogICAgICAgICAgICAgICAg\nc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsIChmbGFncyAmIE9J\nRF9BTExPV19ORVcpICE9IDAKICAgICAgICAgICAgICAgICAgICB8fCBoYXNG\nbHVzaGVkKCkpOwogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZWQgPSBzbSAh\nPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKCFpbml0aWFsaXplZCkKICAg\nICAgICAgICAgICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lk\nLCAoZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7CgogICAgICAgICAgICAgICAg\nX2xvYWRpbmcucHV0KG9iaiwgc20pOwogICAgICAgICAgICAgICAgaWYgKHJl\ncXVpcmVzTG9hZChzbSwgaW5pdGlhbGl6ZWQsIGZldGNoLCBlZGF0YSwgZmxh\nZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNTdGF0ZSA9IHRyYW5z\nU3RhdGUgfHwgdXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoaW5pdGlhbGl6ZWQgJiYgIXNtLmlzVHJhbnNh\nY3Rpb25hbCgpICYmIHRyYW5zU3RhdGUpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAobG9hZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBsb2Fk\nID0gbmV3IEFycmF5TGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2VyPihvaWRzLnNp\nemUoKSAtIGlkeCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20p\nOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaW5pdGlhbGl6ZWQpCiAg\nICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShzbS5nZXRNZXRhRGF0\nYSgpLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgUENTdGF0ZS5IT0xMT1cpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBwYXNzIGFsbCBzdGF0ZSBtYW5hZ2VycyBpbiBuZWVkIG9mIGxvYWRp\nbmcgb3IgdmFsaWRhdGlvbiB0byB0aGUKICAgICAgICAgICAgLy8gc3RvcmUg\nbWFuYWdlcgogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBQQ1N0YXRlIHN0YXRlID0gKHRyYW5zU3RhdGUpID8gUENT\ndGF0ZS5QQ0xFQU4KICAgICAgICAgICAgICAgICAgICA6IFBDU3RhdGUuUE5P\nTlRSQU5TOwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IGZh\naWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIHN0YXRlLAogICAgICAgICAg\nICAgICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX05PTkUsIGZldGNo\nLCBlZGF0YSk7CgogICAgICAgICAgICAgICAgLy8gc2V0IGZhaWxlZCBpbnN0\nYW5jZXMgdG8gbnVsbAogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBu\ndWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXdPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbihmYWlsZWQpOwogICAgICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3I8T2JqZWN0PiBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChp\ndHIubmV4dCgpLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gY3JlYXRlIHJlc3VsdHMgYXJyYXk7IG1h\na2Ugc3VyZSBhbGwgY29uZmlndXJlZCBmaWVsZHMgYXJlCiAgICAgICAgICAg\nIC8vIGxvYWRlZCBpbiBlYWNoIGluc3RhbmNlCiAgICAgICAgICAgIE9iamVj\ndFtdIHJlc3VsdHMgPSBuZXcgT2JqZWN0W29pZHMuc2l6ZSgpXTsKICAgICAg\nICAgICAgYm9vbGVhbiBhY3RpdmUgPSAoX2ZsYWdzICYgRkxBR19BQ1RJVkUp\nICE9IDA7CiAgICAgICAgICAgIGludCBsZXZlbCA9IGZldGNoLmdldFJlYWRM\nb2NrTGV2ZWwoKTsKICAgICAgICAgICAgaWR4ID0gMDsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICBvaWQgPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgc20gPSBfbG9hZGluZy5nZXQob2lk\nKTsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHJlcXVpcmVz\nTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRhLCBmbGFncykpIHsKICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBz\nbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLAogICAg\nICAgICAgICAgICAgICAgICAgICAJZXhjbHVkZSwgZWRhdGEsIGZhbHNlKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCBmZXRj\naC5nZXRMb2NrVGltZW91dCgpLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBmZXRjaC5nZXRXcml0\nZUxvY2tMZXZlbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAo\nT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05P\nVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0\naHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgICAgICBzbSA9IG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgcmVzdWx0c1tpZHhdID0gY2FsbC5wcm9jZXNzUmV0dXJu\nKG9pZCwgc20pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBy\nZXN1bHRzOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZmluZEFsbERlcHRoLS07CiAgICAgICAgICAgIGlmIChmaW5kQWxs\nRGVwdGggPT0gMCkKICAgICAgICAgICAgICAgIF9sb2FkaW5nID0gbnVsbDsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgYm9vbGVhbiBoYXNGbHVzaGVkKCkgewogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAhPSAwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIGluc3RhbmNl\nIG5lZWRzIGxvYWRpbmcgYmVmb3JlIGJlaW5nIHJldHVybmVkCiAgICAgKiB0\nbyB0aGUgdXNlci4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHJlcXVp\ncmVzTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29sZWFuIGluaXRp\nYWxpemVkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2Jq\nZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICBpZiAoIWZldGNoLnJl\ncXVpcmVzTG9hZCgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAwKQogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZWRhdGEgIT0gbnVsbCkg\nLy8gdGFrZSBhZHZhbnRhZ2Ugb2YgZXhpc3RpbmcgcmVzdWx0CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChpbml0aWFsaXplZCAmJiBz\nbS5nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5IT0xMT1cpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIWluaXRpYWxpemVkICYmIHNt\nLmdldE1ldGFEYXRhKCkuZ2V0UENTdWJjbGFzc2VzKCkubGVuZ3RoID4gMCkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuICFfY29t\ncGF0LmdldFZhbGlkYXRlRmFsc2VSZXR1cm5zSG9sbG93KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0byB1c2UgYSB0cmFuc2Fj\ndGlvbmFsIHN0YXRlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gdXNl\nVHJhbnNhY3Rpb25hbFN0YXRlKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDAg\nJiYgKCFfb3B0aW1pc3RpYwogICAgICAgICAgICB8fCBfYXV0b0NsZWFyID09\nIENMRUFSX0FMTAogICAgICAgICAgICB8fCBmZXRjaC5nZXRSZWFkTG9ja0xl\ndmVsKCkgIT0gTE9DS19OT05FKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGZpbmRDYWNoZWQoT2JqZWN0IG9pZCwgRmluZENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9\nIHRoaXM7CiAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2lk\nKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlk\nKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzczw/PiBnZXRPYmplY3RJZFR5cGUoQ2xhc3M8Pz4gY2xzKSB7CiAg\nICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAg\nICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIGZhbHNlKTsKICAgICAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbAogICAgICAgICAgICAgICAgfHwgbWV0YS5n\nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04p\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYg\nKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9B\nUFBMSUNBVElPTikKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhLmdldE9i\namVjdElkVHlwZSgpOwoKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5nZXRE\nYXRhU3RvcmVJZFR5cGUobWV0YSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdPYmplY3RJZChDbGFzczw/\nPiBjbHMsIE9iamVjdCB2YWwpIHsKICAgICAgICBpZiAodmFsID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgX2xv\nYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIHN3aXRjaCAobWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSkgewogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEu\nSURfREFUQVNUT1JFOgogICAgICAgICAgICAgICAgLy8gZGVsZWdhdGUgdG8g\nc3RvcmUgbWFuYWdlciBmb3IgZGF0YXN0b3JlIGlkcwogICAgICAgICAgICAg\nICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZwogICAgICAgICAgICAgICAg\nICAgICYmICgoU3RyaW5nKSB2YWwpLnN0YXJ0c1dpdGgoU3RhdGVNYW5hZ2Vy\nSWQuU1RSSU5HX1BSRUZJWCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdGF0ZU1hbmFnZXJJZCgoU3RyaW5nKSB2YWwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIF9zdG9yZS5uZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEp\nOwogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJ\nT046CiAgICAgICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc0Fzc2lnbmFi\nbGUobWV0YS5nZXRPYmplY3RJZFR5cGUoKSwgCiAgICAgICAgICAgICAgICAg\nICAgdmFsLmdldENsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgCiAgICAgICAgICAgICAgICAg\nICAgICAgICYmIG1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIHZh\nbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBzdHJpbmdpZmllZCBhcHAg\naWQ/CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5n\nIAogICAgICAgICAgICAgICAgICAgICYmICFfY29uZi5nZXRDb21wYXRpYmls\naXR5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0U3Ry\naWN0SWRlbnRpdHlWYWx1ZXMoKQogICAgICAgICAgICAgICAgICAgICYmICFN\nb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIFBDUmVnaXN0cnkubmV3T2JqZWN0SWQo\nY2xzLCAoU3RyaW5nKSB2YWwpOwoKICAgICAgICAgICAgICAgIE9iamVjdFtd\nIGFyciA9ICh2YWwgaW5zdGFuY2VvZiBPYmplY3RbXSkgPyAoT2JqZWN0W10p\nIHZhbAogICAgICAgICAgICAgICAgICAgIDogbmV3IE9iamVjdFtdeyB2YWwg\nfTsKICAgICAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5mcm9t\nUEtWYWx1ZXMoYXJyLCBtZXRhKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJtZXRhLXVua25vd25pZCIsIGNscykpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlhZSkgewog\nICAgICAgIAkvLyBPUEVOSlBBLTM2NQogICAgICAgIAl0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWlkLXZhbHVlIiwgdmFsLAogICAg\nICAgICAgICAgICAgdmFsLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBjbHMpKS5z\nZXRDYXVzZShpYWUpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoQ2xhc3NDYXN0RXhjZXB0aW9uIGNjZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWlkLXZhbHVlIiwg\ndmFsLAogICAgICAgICAgICAgICAgdmFsLmdldENsYXNzKCkuZ2V0TmFtZSgp\nLCBjbHMpKS5zZXRDYXVzZShjY2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIG5ldyBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2\nZW4gb2lkLgogICAgICovCiAgICBwcml2YXRlIFN0YXRlTWFuYWdlckltcGwg\nbmV3U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2lkLCBib29sZWFuIGNvcHkp\nIHsKICAgICAgICAvLyBzZWUgaWYgd2UncmUgaW4gdGhlIHByb2Nlc3Mgb2Yg\nbG9hZGluZyB0aGlzIG9pZCBpbiBhIGxvYWRBbGwgY2FsbAogICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc207CiAgICAgICAgaWYgKF9sb2FkaW5nICE9IG51\nbGwpIHsKICAgICAgICAgICAgc20gPSBfbG9hZGluZy5nZXQob2lkKTsKICAg\nICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0UGVyc2lzdGVuY2VD\nYXBhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsK\nICAgICAgICB9CgogICAgICAgIC8vIGZpbmQgbWV0YWRhdGEgZm9yIHRoZSBv\naWQKICAgICAgICBDbGFzczw/PiBwY1R5cGUgPSBfc3RvcmUuZ2V0TWFuYWdl\nZFR5cGUob2lkKTsKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3Mg\nPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBpZiAocGNUeXBlICE9\nIG51bGwpCiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShw\nY1R5cGUsIF9sb2FkZXIsIHRydWUpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKG9pZCwgX2xvYWRlciwgdHJ1\nZSk7CgogICAgICAgIC8vIGNvcHkgdGhlIG9pZCBpZiBuZWVkZWQKICAgICAg\nICBpZiAoY29weSAmJiBfY29tcGF0LmdldENvcHlPYmplY3RJZHMoKSkgewog\nICAgICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgb2lk\nID0gQXBwbGljYXRpb25JZHMuY29weShvaWQsIG1ldGEpOwogICAgICAgICAg\nICBlbHNlIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIG1ldGEp\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb2lkID0gX3N0\nb3JlLmNvcHlEYXRhU3RvcmVJZChvaWQsIG1ldGEpOwogICAgICAgIH0KCiAg\nICAgICAgc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSk7CiAg\nICAgICAgc20uc2V0T2JqZWN0SWQob2lkKTsKICAgICAgICByZXR1cm4gc207\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBzdGF0ZSBtYW5hZ2Vy\nIGZvciB0aGUgZ2l2ZW4gb2lkIGFuZCBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgbmV3U3RhdGVNYW5hZ2VySW1w\nbChPYmplY3Qgb2lkLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySW1wbChvaWQsIG1ldGEs\nIHRoaXMpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gVHJh\nbnNhY3Rpb24KICAgIC8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lk\nIGJlZ2luKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJhY3RpdmUiKSk7CiAgICAgICAgICAg\nIF9mYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIHRy\ndWUpOwogICAgICAgICAgICBiZWdpbkludGVybmFsKCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBzdG9yZSBtYW5h\nZ2VyIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBiZWdpbkludGVybmFsKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oX29wdGltaXN0aWMpOwog\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19BQ1RJVkU7CgogICAgICAgICAg\nICAvLyBzdGFydCBsb2NraW5nCiAgICAgICAgICAgIGlmICghX29wdGltaXN0\naWMpIHsKICAgICAgICAgICAgICAgIF9mYy5zZXRSZWFkTG9ja0xldmVsKF9j\nb25mLmdldFJlYWRMb2NrTGV2ZWxDb25zdGFudCgpKTsKICAgICAgICAgICAg\nICAgIF9mYy5zZXRXcml0ZUxvY2tMZXZlbChfY29uZi5nZXRXcml0ZUxvY2tM\nZXZlbENvbnN0YW50KCkpOwogICAgICAgICAgICAgICAgX2ZjLnNldExvY2tU\naW1lb3V0KF9jb25mLmdldExvY2tUaW1lb3V0KCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIF9sbS5iZWdpblRyYW5zYWN0aW9uKCk7CgogICAgICAg\nICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0JlZ2luTGlzdGVuZXJz\nKCkpCiAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcg\nVHJhbnNhY3Rpb25FdmVudCh0aGlzLAogICAgICAgICAgICAgICAgICAgIFRy\nYW5zYWN0aW9uRXZlbnQuQUZURVJfQkVHSU4sIG51bGwsIG51bGwsIG51bGws\nIG51bGwpKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIC8vIGlmIHdlIGFscmVhZHkgc3RhcnRlZCB0aGUg\ndHJhbnNhY3Rpb24sIGRvbid0IGxldCBpdCBjb21taXQKICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAg\nICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGtlKTsKICAgICAgICAgICAg\ndGhyb3cga2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBhbHJl\nYWR5IHN0YXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBkb24ndCBsZXQgaXQgY29t\nbWl0CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9\nIDApCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChy\nZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSku\nc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3BlbmRp\nbmcgIT0gbnVsbCkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPFN0YXRlTWFuYWdlckltcGw+\nIGl0ID0gX3BlbmRpbmcuaXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXQubmV4\ndCgpOwogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgpOwogICAg\nICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAgICAgICAg\nICAgICBzZXREaXJ0eShzbSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgX3BlbmRpbmcgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBiZWdpblN0b3JlKCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFRy\nYW5zYWN0aW9uT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19TVE9SRV9BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBi\nZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGZhbHNlKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBCZWdpbiBhIHN0\nb3JlIG1hbmFnZXIgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGJvb2xlYW4gb3B0\naW1pc3RpYykgewogICAgICAgIGlmICghb3B0aW1pc3RpYykgewogICAgICAg\nICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9zdG9yZS5i\nZWdpbigpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19TVE9SRV9BQ1RJ\nVkU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKF9jb25uUmV0\nYWluTW9kZSA9PSBDT05OX1JFVEFJTl9UUkFOUykKICAgICAgICAgICAgICAg\nIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgX3N0b3JlLmJlZ2lu\nT3B0aW1pc3RpYygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEVuZCB0aGUgY3VycmVudCBzdG9yZSBtYW5hZ2VyIHRyYW5zYWN0aW9uLiBU\naHJvd3MgYW4KICAgICAqIGV4Y2VwdGlvbiB0byBzaWduYWwgYSBmb3JjZWQg\ncm9sbGJhY2sgYWZ0ZXIgZmFpbGVkIGNvbW1pdCwgb3RoZXJ3aXNlCiAgICAg\nKiByZXR1cm5zIGFueSBleGNlcHRpb24gZW5jb3VudGVyZWQgZHVyaW5nIHRo\nZSBlbmQgcHJvY2Vzcy4KICAgICAqLwogICAgcHJpdmF0ZSBSdW50aW1lRXhj\nZXB0aW9uIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGJvb2xlYW4gcm9s\nbGJhY2spIHsKICAgICAgICBib29sZWFuIGZvcmNlZFJvbGxiYWNrID0gZmFs\nc2U7CiAgICAgICAgYm9vbGVhbiByZWxlYXNlQ29ubiA9IGZhbHNlOwogICAg\nICAgIFJ1bnRpbWVFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZF\nKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZWxlYXNlQ29ubiA9IF9jb25u\nUmV0YWluTW9kZSAhPSBDT05OX1JFVEFJTl9BTFdBWVM7CiAgICAgICAgICAg\nICAgICBpZiAocm9sbGJhY2spCiAgICAgICAgICAgICAgICAgICAgX3N0b3Jl\nLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBhbmQgbm90aWZ5IHRoZSBxdWVyeSBjYWNoZS4gIG5v\ndGlmeSBpbiBvbmUgYmF0Y2ggdG8gcmVkdWNlIHN5bmNoCiAgICAgICAgICAg\nICAgICAgICAgUXVlcnlDYWNoZSBxdWVyeUNhY2hlID0gZ2V0Q29uZmlndXJh\ndGlvbigpLgogICAgICAgICAgICAgICAgICAgIGdldERhdGFDYWNoZU1hbmFn\nZXJJbnN0YW5jZSgpLmdldFN5c3RlbVF1ZXJ5Q2FjaGUoKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocXVlcnlDYWNoZSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHBlcnMgPSBn\nZXRQZXJzaXN0ZWRUeXBlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBD\nb2xsZWN0aW9uPENsYXNzPD8+PiBkZWwgPSBnZXREZWxldGVkVHlwZXMoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/Pj4g\ndXAgPSBnZXRVcGRhdGVkVHlwZXMoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IHNpemUgPSBwZXJzLnNpemUoKSArIGRlbC5zaXplKCkgKyB1cC5z\naXplKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaXplID4gMCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sbGVjdGlvbjxDbGFz\nczw/Pj4gdHlwZXMgPSBuZXcgQXJyYXlMaXN0PENsYXNzPD8+PihzaXplKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzLmFkZEFsbChwZXJz\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzLmFkZEFsbChk\nZWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXMuYWRkQWxs\nKHVwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5Q2FjaGUu\nb25UeXBlc0NoYW5nZWQobmV3IFR5cGVzQ2hhbmdlZEV2ZW50KHRoaXMsIHR5\ncGVzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIF9zdG9yZS5jb21taXQo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHJlbGVhc2VDb25uID0gX2Nvbm5SZXRhaW5Nb2RlID09\nIENPTk5fUkVUQUlOX1RSQU5TOwogICAgICAgICAgICAgICAgX3N0b3JlLnJv\nbGxiYWNrT3B0aW1pc3RpYygpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIGlmICghcm9sbGJhY2spIHsKICAgICAgICAgICAgICAgIGZvcmNlZFJv\nbGxiYWNrID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRyeSB7IF9zdG9yZS5y\nb2xsYmFjaygpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlMikge30K\nICAgICAgICAgICAgfQogICAgICAgICAgICBlcnIgPSByZTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVf\nQUNUSVZFOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlbGVhc2VDb25uKSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZWxlYXNlQ29u\nbmVjdGlvbigpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChmb3JjZWRSb2xsYmFjaykKICAgICAgICAg\nICAgdGhyb3cgZXJyOwogICAgICAgIHJldHVybiBlcnI7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFu\nc2FjdGlvbk9wZXJhdGlvbigpOwoKICAgICAgICAgICAgamF2YXgudHJhbnNh\nY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1\nbnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24o\nKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJudWxsLXRyYW5zIikpOwoKICAgICAgICAgICAgLy8gdGhpcyBjb21taXQg\nb24gdGhlIHRyYW5zYWN0aW9uIHdpbGwgY2F1c2Ugb3VyCiAgICAgICAgICAg\nIC8vIGJlZm9yZUNvbXBsZXRpb24gbWV0aG9kIHRvIGJlIGludm9rZWQKICAg\nICAgICAgICAgdHJhbnMuY29tbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBl\nKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygp\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsK\nCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRy\nYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9u\nTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0\ncmFucyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJhbnMucm9sbGJhY2so\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3Ii\nKSwga2UpOwogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdl\ndCgiZW5kLXRyYW5zLWVycm9yIiksIGUpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIHN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKCkg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElW\nRSkgIT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBpZiAoIV9tYW5hZ2VkKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidHJhbnMtbm90LW1h\nbmFnZWQiKSk7CiAgICAgICAgICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1h\nbmFnZWRUcmFuc2FjdGlvbih0aGlzLCBmYWxzZSkpIHsKICAgICAgICAgICAg\nICAgIGJlZ2luSW50ZXJuYWwoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0QW5kUmVzdW1l\nKCkgewogICAgICAgIGVuZEFuZFJlc3VtZSh0cnVlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByb2xsYmFja0FuZFJlc3VtZSgpIHsKICAgICAgICBlbmRB\nbmRSZXN1bWUoZmFsc2UpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBlbmRB\nbmRSZXN1bWUoYm9vbGVhbiBjb21taXQpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNv\nbW1pdCkKICAgICAgICAgICAgICAgIGNvbW1pdCgpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICByb2xsYmFjaygpOwogICAgICAgICAgICBi\nZWdpbigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRSb2xsYmFja09ubHkoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0\naW9uIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5z\nYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAg\nIGlmICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICByZXR1cm4gdHJhbnMuZ2V0U3RhdHVzKCkgPT0g\nU3RhdHVzLlNUQVRVU19NQVJLRURfUk9MTEJBQ0s7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIFRocm93YWJsZSBnZXRSb2xsYmFja0NhdXNl\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAg\nIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAg\nICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdl\ndFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlm\nICh0cmFucy5nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9S\nT0xMQkFDSykKICAgICAgICAgICAgICAgIHJldHVybiBfcnVudGltZS5nZXRS\nb2xsYmFja0NhdXNlKCk7CgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFj\na09ubHkoKSB7CiAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG5ldyBVc2VyRXhj\nZXB0aW9uKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNr\nT25seShUaHJvd2FibGUgY2F1c2UpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFu\nc2FjdGlvbk9wZXJhdGlvbigpOwogICAgICAgICAgICBzZXRSb2xsYmFja09u\nbHlJbnRlcm5hbChjYXVzZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTWFyayB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyByb2xs\nYmFjay1vbmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Um9sbGJh\nY2tPbmx5SW50ZXJuYWwoVGhyb3dhYmxlIGNhdXNlKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24g\ndHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rp\nb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYg\nKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOwog\nICAgICAgICAgICAvLyBlbnN1cmUgdHJhbiBpcyBpbiBhIHZhbGlkIHN0YXRl\nIHRvIGFjY2VwdCB0aGUgc2V0Um9sbGJhY2tPbmx5CiAgICAgICAgICAgIGlu\ndCB0cmFuU3RhdHVzID0gdHJhbnMuZ2V0U3RhdHVzKCk7CiAgICAgICAgICAg\nIGlmICgodHJhblN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX05PX1RSQU5TQUNU\nSU9OKQogICAgICAgICAgICAgICAgICAgICYmICh0cmFuU3RhdHVzICE9IFN0\nYXR1cy5TVEFUVVNfUk9MTEVEQkFDSykKICAgICAgICAgICAgICAgICAgICAm\nJiAodHJhblN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRCkpCiAg\nICAgICAgICAgICAgICBfcnVudGltZS5zZXRSb2xsYmFja09ubHkoY2F1c2Up\nOwogICAgICAgICAgICBlbHNlIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbnZhbGlk\nLXRyYW4tc3RhdHVzIiwgbmV3IEludGVnZXIoCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRyYW5TdGF0dXMpLCAic2V0Um9sbGJhY2tPbmx5IikpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNhdmVwb2ludChT\ndHJpbmcgbmFtZSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0\naW9uKCk7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYm\nIF9zYXZlcG9pbnRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInNhdmVwb2lu\ndC1leGlzdHMiLCBuYW1lKSk7CgogICAgICAgICAgICBpZiAoaGFzRmx1c2hl\nZCgpICYmICFfc3BtLnN1cHBvcnRzSW5jcmVtZW50YWxGbHVzaCgpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJzYXZlcG9pbnQtZmx1c2gt\nbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9p\nbnQgc2F2ZSA9IF9zcG0ubmV3U2F2ZXBvaW50KG5hbWUsIHRoaXMpOwogICAg\nICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVsbCB8fCBfc2F2ZXBvaW50\ncy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShnZXRU\ncmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAgICAgICAgICAgX3NhdmVw\nb2ludHMgPSBuZXcgTGlua2VkTWFwKCk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBpZiAoX3NhdmVwb2ludENhY2hlID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgc2F2ZS5zYXZlKENvbGxlY3Rpb25zLkVN\nUFRZX1NFVCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBzYXZlLnNhdmUoX3NhdmVwb2ludENhY2hlKTsKICAgICAgICAg\nICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfc2F2ZXBvaW50\ncy5wdXQobmFtZSwgc2F2ZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcmVsZWFzZVNhdmVwb2ludCgpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKF9zYXZlcG9pbnRzID09IG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLWxhc3RzYXZlcG9pbnQiKSk7CiAgICAgICAgICAgIHJl\nbGVhc2VTYXZlcG9pbnQoKFN0cmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAg\nICAgICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50\nKFN0cmluZyBzYXZlcG9pbnQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2\nZXBvaW50cyA9PSBudWxsKSA/IC0xCiAgICAgICAgICAgICAgICA6IF9zYXZl\ncG9pbnRzLmluZGV4T2Yoc2F2ZXBvaW50KTsKICAgICAgICAgICAgaWYgKGlu\nZGV4IDwgMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAg\nICAgICAgICAgIC8vIGNsZWFyIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAg\nIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9z\nYXZlcG9pbnRzLnNpemUoKSA+IGluZGV4ICsgMSkgewogICAgICAgICAgICAg\nICAgc2F2ZSA9IChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1v\ndmUKICAgICAgICAgICAgICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0g\nMSk7CiAgICAgICAgICAgICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9p\nbnQpIF9zYXZlcG9pbnRzLnJlbW92ZShpbmRleCk7CiAgICAgICAgICAgIHNh\ndmUucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRD\nYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hl\nLmNsZWFyKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgcm9sbGJhY2tUb1NhdmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9z\nYXZlcG9pbnRzID09IG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWxhc3RzYXZlcG9pbnQiKSk7CiAgICAgICAgICAgIHJvbGxiYWNr\nVG9TYXZlcG9pbnQoKFN0cmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAg\nICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50\nKFN0cmluZyBzYXZlcG9pbnQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2\nZXBvaW50cyA9PSBudWxsKSA/IC0xCiAgICAgICAgICAgICAgICA6IF9zYXZl\ncG9pbnRzLmluZGV4T2Yoc2F2ZXBvaW50KTsKICAgICAgICAgICAgaWYgKGlu\nZGV4IDwgMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAg\nICAgICAgICAgIC8vIGNsZWFyIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAg\nIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9z\nYXZlcG9pbnRzLnNpemUoKSA+IGluZGV4ICsgMSkgewogICAgICAgICAgICAg\nICAgc2F2ZSA9IChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1v\ndmUKICAgICAgICAgICAgICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0g\nMSk7CiAgICAgICAgICAgICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9p\nbnQpIF9zYXZlcG9pbnRzLnJlbW92ZShpbmRleCk7CiAgICAgICAgICAgIENv\nbGxlY3Rpb24gc2F2ZWQgPSBzYXZlLnJvbGxiYWNrKF9zYXZlcG9pbnRzLnZh\nbHVlcygpKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7\nCiAgICAgICAgICAgIGlmIChoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKSB7\nCiAgICAgICAgICAgICAgICAvLyBidWlsZCB1cCBhIG5ldyBjb2xsZWN0aW9u\nIG9mIHN0YXRlcwogICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hl\nIG9sZFRyYW5zQ2FjaGUgPSBfdHJhbnNDYWNoZTsKICAgICAgICAgICAgICAg\nIFRyYW5zYWN0aW9uYWxDYWNoZSBuZXdUcmFuc0NhY2hlID0gbmV3IFRyYW5z\nYWN0aW9uYWxDYWNoZQogICAgICAgICAgICAgICAgICAgIChfb3JkZXJEaXJ0\neSk7CiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG51bGw7CgogICAg\nICAgICAgICAgICAgLy8gY3VycmVudGx5IHRoZXJlIGlzIHRoZSBhc3N1bXB0\naW9uIHRoYXQgaW5jcmVtZW50YWwKICAgICAgICAgICAgICAgIC8vIGZsdXNo\nIGlzIGVpdGhlciBhKSBub3QgYWxsb3dlZCwgb3IgYikgcmVxdWlyZWQKICAg\nICAgICAgICAgICAgIC8vIHByZS1zYXZlcG9pbnQuICB0aGlzIHNvbHZlcyBh\nIG51bWJlciBvZiBpc3N1ZXMgaW5jbHVkaW5nCiAgICAgICAgICAgICAgICAv\nLyBzdG9yaW5nIGZsdXNoZWQgc3RhdGVzIGFzIHdlbGwgYXMgT0lEIGhhbmRs\naW5nLgogICAgICAgICAgICAgICAgLy8gaWYgZnV0dXJlIHBsdWdpbnMgZG8g\nbm90IGZvbGxvdyB0aGlzLCB3ZSBuZWVkIHRvIGNhY2hlCiAgICAgICAgICAg\nICAgICAvLyBtb3JlIGluZm8gcGVyIHN0YXRlCiAgICAgICAgICAgICAgICBT\nYXZlcG9pbnRGaWVsZE1hbmFnZXIgZm07CiAgICAgICAgICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRv\ncjw/PiBpdHIgPSBzYXZlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgICAgIGZtID0gKFNhdmVwb2ludEZpZWxkTWFu\nYWdlcikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBzbSA9IGZt\nLmdldFN0YXRlTWFuYWdlcigpOwogICAgICAgICAgICAgICAgICAgIHNtLnJv\nbGxiYWNrVG9TYXZlcG9pbnQoZm0pOwogICAgICAgICAgICAgICAgICAgIG9s\nZFRyYW5zQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoc20uaXNEaXJ0eSgpKQogICAgICAgICAgICAgICAgICAgICAgICBuZXdU\ncmFuc0NhY2hlLmFkZERpcnR5KHNtKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RyYW5zQ2FjaGUuYWRk\nQ2xlYW4oc20pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBvbGRUcmFuc0NhY2hlLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgc20g\nPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgICAgICBzbS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIHJl\nbW92ZUZyb21UcmFuc2FjdGlvbihzbSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5ld1RyYW5zQ2FjaGU7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGZsdXNoKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHJldHVybiBz\naWxlbnRseSBpZiBubyB0cmFucyBpcyBhY3RpdmUsIG9yIGlmIHRoaXMgaXMg\nYSByZWVudHJhbnQKICAgICAgICAgICAgLy8gY2FsbCwgd2hpY2ggY2FuIGhh\ncHBlbiBpZiB0aGUgc3RvcmUgbWFuYWdlciB0cmllcyB0byBnZXQgYW4KICAg\nICAgICAgICAgLy8gYXV0by1pbmMgb2lkIGR1cmluZyBmbHVzaAogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwCiAgICAgICAg\nICAgICAgICB8fCAoX2ZsYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0g\nMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0cyBpdAogICAgICAgICAgICBp\nZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucyhPcGVuSlBB\nQ29uZmlndXJhdGlvbi5PUFRJT05fSU5DX0ZMVVNIKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICgiaW5jcmVtZW50YWwtZmx1c2gtbm90LXN1\ncHBvcnRlZCIpKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51\nbGwgJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKQogICAgICAgICAgICAgICAg\nJiYgIV9zcG0uc3VwcG9ydHNJbmNyZW1lbnRhbEZsdXNoKCkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICAgICAoInNhdmVwb2ludC1mbHVzaC1ub3Qt\nc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGZsdXNoU2FmZShGTFVTSF9JTkMpOwogICAgICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgLy8gcm9sbGJh\nY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5IGJlIGluIGluY29uc2lz\ndGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KGtl\nKTsKICAgICAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUpOwog\nICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgICAgICAvLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsgb2Jq\nZWN0cyBtYXkgYmUgaW4gaW5jb25zaXN0ZW50IHN0YXRlCiAgICAgICAgICAg\nICAgICBzZXRSb2xsYmFja09ubHkocmUpOwogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHByZUZsdXNoKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBmbHVzaFNh\nZmUoRkxVU0hfTE9HSUNBTCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHZhbGlkYXRlQ2hhbmdlcygpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBp\nZiBubyB0cmFucywganVzdCByZXR1cm47IGlmIGFjdGl2ZSBkYXRhc3RvcmUg\ndHJhbnMsIGZsdXNoCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDApIHsK\nICAgICAgICAgICAgICAgIGZsdXNoKCk7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0\naGUgcnVudGltZSBzdXBwb3J0cyBpbmMgZmx1c2gKICAgICAgICAgICAgaWYg\nKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uT1BUSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAg\nICAgICAgICAgICAgICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBw\nb3J0ZWQiKSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nZmx1c2hTYWZlKEZMVVNIX1JPTExCQUNLKTsKICAgICAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FjdGl2ZSgpIHsKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N0b3JlQWN0aXZl\nKCkgewogICAgICAgIC8vIHdlIG5lZWQgdG8gbG9jayBoZXJlLCBiZWNhdXNl\nIHdlIG1pZ2h0IGJlIGluIHRoZSBtaWRkbGUgb2YgYW4KICAgICAgICAvLyBh\ndG9taWMgdHJhbnNhY3Rpb24gcHJvY2VzcyAoZS5nLiwgY29tbWl0QW5kUmVz\ndW1lKQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19TVE9SRV9B\nQ1RJVkUpICE9IDA7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHdoZXRoZXIgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gaXMg\nZW5kaW5nLCBpLmUuIGluIHRoZSAybmQgcGhhc2UKICAgICAqIG9mIGEgY29t\nbWl0IG9yIHJvbGxiYWNrCiAgICAgKi8KICAgIGJvb2xlYW4gaXNUcmFuc2Fj\ndGlvbkVuZGluZygpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdf\nVFJBTlNfRU5ESU5HKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGJlZ2luT3BlcmF0aW9uKGJvb2xlYW4gc3luY1RyYW5zKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4o\nKTsKCiAgICAgICAgICAgIGlmIChzeW5jVHJhbnMgJiYgX29wZXJhdGlvbkNv\ndW50ID09IDAgJiYgX3N5bmNNYW5hZ2VkCiAgICAgICAgICAgICAgICAmJiAo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBz\neW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICByZXR1\ncm4gX29wZXJhdGlvbkNvdW50KysgPT0gMTsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgb3BlcmF0aW9uIG92\nZXIuIElmIG91dGVybW9zdCBjYWxsZXIgb2Ygc3RhY2ssIHJldHVybnMgdHJ1\nZQogICAgICogYW5kIHdpbGwgZGV0YWNoIG1hbmFnZWQgaW5zdGFuY2VzIGlm\nIG5lY2Vzc2FyeS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZW5kT3Bl\ncmF0aW9uKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfb3Bl\ncmF0aW9uQ291bnQgPT0gMSAmJiAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9O\nVFhSRUFEKSAhPSAwCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpID09IDApIHsKICAgICAgICAgICAgICAgIGRldGFjaEFsbElu\ndGVybmFsKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChf\nb3BlcmF0aW9uQ291bnQgPCAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJtdWx0aS10aHJlYWRlZC1h\nY2Nlc3MiKSk7CiAgICAgICAgICAgIHJldHVybiBfb3BlcmF0aW9uQ291bnQg\nPT0gMTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIF9vcGVyYXRpb25Db3VudC0tOwogICAgICAgICAgICBpZiAoX29wZXJh\ndGlvbkNvdW50ID09IDApCiAgICAgICAgICAgICAgICBpbml0aWFsaXplT3Bl\ncmF0aW5nU2V0KCk7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgU3luY2hyb25pemF0aW9uIGdldFN5bmNocm9u\naXphdGlvbigpIHsKICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0U3luY2hyb25pemF0aW9uKFN5bmNocm9uaXphdGlv\nbiBzeW5jKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5j\nID0gc3luYzsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24g\nb2YgU3luY2hyb25pemF0aW9uIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgdm9pZCBiZWZvcmVDb21wbGV0aW9uKCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB1\nc2VyLXN1cHBsaWVkIHN5bmNocm9uaXphdGlvbgogICAgICAgICAgICBpZiAo\nX3N5bmMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zeW5jLmJlZm9yZUNv\nbXBsZXRpb24oKTsKCiAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9DT01N\nSVQpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJv\nciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRD\nb21wbGV0aW9uRXhjZXB0aW9uKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJv\ndyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3Rv\ncmVFeGNlcHRpb24ocmUpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYWZ0ZXJDb21wbGV0aW9uKGludCBzdGF0dXMpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX1RSQU5TX0VORElORzsKICAgICAgICAgICAgZW5k\nVHJhbnNhY3Rpb24oc3RhdHVzKTsKICAgICAgICAgICAgaWYgKF9zeW5jICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24o\nc3RhdHVzKTsKCiAgICAgICAgICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRB\nQ0hfQ09NTUlUKSAhPSAwKQogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50\nZXJuYWwobnVsbCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBT\ndGF0dXMuU1RBVFVTX1JPTExFREJBQ0sKICAgICAgICAgICAgICAgICYmIChf\nYXV0b0RldGFjaCAmIERFVEFDSF9ST0xMQkFDSykgIT0gMCkgewogICAgICAg\nICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGluIGFuIGVlIGNvbnRleHQsIGl0J3MgcG9z\nc2libGUgdGhhdCB0aGUgdXNlciB0cmllZCB0byBjbG9zZQogICAgICAgICAg\nICAvLyB1cyBidXQgd2UgZGlkbid0IGFjdHVhbGx5IGNsb3NlIGJlY2F1c2Ug\nd2Ugd2VyZSB3YWl0aW5nIG9uIHRoaXMKICAgICAgICAgICAgLy8gdHJhbnNh\nY3Rpb247IGlmIHRoYXQncyB0cnVlLCB0aGVuIGNsb3NlIG5vdwogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMAog\nICAgICAgICAgICAgICAgJiYgX2NvbXBhdC5nZXRDbG9zZU9uTWFuYWdlZENv\nbW1pdCgpKQogICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAg\nICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9u\nKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJy\nb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2Vk\nQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfQUNUSVZFOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hF\nRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1RSQU5TX0VORElORzsK\nCiAgICAgICAgICAgIC8vIGV2ZW50IG1hbmFnZXIgbnVsbGVkIGlmIGZyZWVk\nIGJyb2tlcgogICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyICE9\nIG51bGwgCiAgICAgICAgICAgICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIu\naGFzRW5kTGlzdGVuZXJzKCkpIHsKICAgICAgICAgICAgICAgIGZpcmVUcmFu\nc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAg\nICAgICAgICAgICAgICAgc3RhdHVzID09IFN0YXR1cy5TVEFUVVNfQ09NTUlU\nVEVECiAgICAgICAgICAgICAgICAgICAgICAgID8gVHJhbnNhY3Rpb25FdmVu\ndC5BRlRFUl9DT01NSVRfQ09NUExFVEUKICAgICAgICAgICAgICAgICAgICAg\nICAgOiBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX1JPTExCQUNLX0NPTVBMRVRF\nLAogICAgICAgICAgICAgICAgICAgIG51bGwsIG51bGwsIG51bGwsIG51bGwp\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgd2UncmUgaW4g\nYSBtYW5hZ2VkIHRyYW5zYWN0aW9uLCB1c2Ugb3VyIGltcGxpY2l0IGJlaGF2\naW9yIGV4Y2VwdGlvbgogICAgICogdHJhbnNsYXRvciB0byB0cmFuc2xhdGUg\nYmVmb3JlL2FmdGVyQ29tcGxldGlvbiBjYWxsYmFjayBlcnJvcnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiB0cmFuc2xhdGVNYW5h\nZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbgogICAgICAgIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgcmV0dXJuICghX21hbmFnZWQgfHwgX2V4dHJh\nbnMgPT0gbnVsbCkgPyByZSA6IF9leHRyYW5zLnRyYW5zbGF0ZShyZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBzYWZlbHksIGNhdGNoaW5nIHJl\nZW50cmFudCBjYWxscy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNo\nU2FmZShpbnQgcmVhc29uKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0ZMVVNISU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWVudHJhbnQtZmx1c2giKSk7\nCgogICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNISU5HOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGZsdXNoKHJlYXNvbik7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNISU5HOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSB0cmFu\nc2FjdGlvbmFsIHN0YXRlIHRvIHRoZSBkYXRhIHN0b3JlLiBTdWJjbGFzc2Vz\nIHRoYXQKICAgICAqIGN1c3RvbWl6ZSBjb21taXQgYmVoYXZpb3Igc2hvdWxk\nIG92ZXJyaWRlIHRoaXMgbWV0aG9kLiBUaGUgbWV0aG9kCiAgICAgKiBhc3N1\nbWVzIHRoYXQgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgaXMgbG9ja2VkLCBp\ncyBub3QgY2xvc2VkLAogICAgICogYW5kIGhhcyBhbiBhY3RpdmUgdHJhbnNh\nY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHJlYXNvbiBvbmUgb2Yge0Bs\naW5rICNGTFVTSF9JTkN9LCB7QGxpbmsgI0ZMVVNIX0NPTU1JVH0sCiAgICAg\nKiB7QGxpbmsgI0ZMVVNIX1JPTExCQUNLfSwgb3Ige0BsaW5rICNGTFVTSF9M\nT0dJQ0FMfQogICAgICogQHNpbmNlIDAuMi41CiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGZsdXNoKGludCByZWFzb24pIHsKICAgICAgICAvLyB0aGlz\nIHdpbGwgZW5saXN0IHByb3hpZWQgc3RhdGVzIGFzIG5lY2Vzc2FyeSBzbyB3\nZSBrbm93IHdoZXRoZXIgd2UKICAgICAgICAvLyBoYXZlIGFueXRoaW5nIHRv\nIGZsdXNoCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsID0gZ2V0\nVHJhbnNhY3Rpb25hbFN0YXRlcygpOwoKICAgICAgICAvLyBkbyB3ZSBhY3R1\nYWxseSBoYXZlIHRvIGZsdXNoPyAgb25seSBpZiBvdXIgZmxhZ3Mgc2F5IHNv\nLCBvciBpZgogICAgICAgIC8vIHdlIGhhdmUgdHJhbnNhY3Rpb24gbGlzdGVu\nZXJzIHRoYXQgbmVlZCB0byBiZSBpbnZva2VkIGZvciBjb21taXQKICAgICAg\nICAvLyAobm8gbmVlZCB0byBpbnZva2UgdGhlbSBvbiBpbmMgZmx1c2ggaWYg\nbm90aGluZyBpcyBkaXJ0eSkuICB3ZQogICAgICAgIC8vIHNwZWNpYWwgY2Fz\nZSB0aGUgcmVtb3RlIGNvbW1pdCBsaXN0ZW5lciB1c2VkIGJ5IHRoZSBkYXRh\nY2FjaGUgY2F1c2UKICAgICAgICAvLyB3ZSBrbm93IGl0IGRvZXNuJ3QgcmVx\ndWlyZSB0aGUgY29tbWl0IGV2ZW50IHdoZW4gbm90aGluZyBjaGFuZ2VzCiAg\nICAgICAgYm9vbGVhbiBmbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JF\nUVVJUkVEKSAhPSAwOwogICAgICAgIGJvb2xlYW4gbGlzdGVuZXJzID0gKF90\ncmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpCiAgICAgICAg\nICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkK\nICAgICAgICAgICAgJiYgKChfZmxhZ3MgJiBGTEFHX1JFTU9URV9MSVNURU5F\nUikgPT0gMAogICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuZ2V0\nTGlzdGVuZXJzKCkuc2l6ZSgpID4gMSk7CiAgICAgICAgaWYgKCFmbHVzaCAm\nJiAocmVhc29uICE9IEZMVVNIX0NPTU1JVCB8fCAhbGlzdGVuZXJzKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0g\nbnVsbDsKICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVTVE9SSU5HOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChmbHVzaCkgewogICAgICAgICAg\nICAgICAgLy8gY2FsbCBwcmUgc3RvcmUgb24gYWxsIGN1cnJlbnRseSB0cmFu\nc2FjdGlvbmFsIG9ianMKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gdHJhbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0\nci5uZXh0KCkpLmJlZm9yZUZsdXNoKHJlYXNvbiwgX2NhbGwpOwogICAgICAg\nICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29u\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaG9wZWZ1bGx5IG5v\ndyBhbGwgZGVwZW5kZW50IGluc3RhbmNlcyB0aGF0IGFyZSBnb2luZyB0byBl\nbmQKICAgICAgICAgICAgLy8gdXAgcmVmZXJlbmNlZCBoYXZlIGJlZW4gbWFy\na2VkIGFzIHN1Y2g7IGRlbGV0ZSB1bnJlZmVkCiAgICAgICAgICAgIC8vIGRl\ncGVuZGVudHMKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVSRUZERUxF\nVElORzsKICAgICAgICAgICAgaWYgKGZsdXNoICYmIF9kZXJlZkNhY2hlICE9\nIG51bGwgJiYgIV9kZXJlZkNhY2hlLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBf\nZGVyZWZDYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICAgICBkZWxldGVEZXJlZihpdHIubmV4dCgpKTsKICAgICAg\nICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNv\nbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZWFzb24gIT0g\nRkxVU0hfTE9HSUNBTCkgewogICAgICAgICAgICAgICAgLy8gaWYgbm8gZGF0\nYXN0b3JlIHRyYW5zYWN0aW9uLCBzdGFydCBvbmU7IGV2ZW4gaWYgd2UgZG9u\nJ3QKICAgICAgICAgICAgICAgIC8vIHRoaW5rIHdlJ2xsIG5lZWQgdG8gZmx1\nc2ggYXQgdGhpcyBwb2ludCwgb3VyIHRyYW5zYWN0aW9uCiAgICAgICAgICAg\nICAgICAvLyBsaXN0ZW5lcnMgbWlnaHQgaW50cm9kdWNlIHNvbWUgZGlydHkg\nb2JqZWN0cyBvciBpbnRlcmFjdAogICAgICAgICAgICAgICAgLy8gZGlyZWN0\nbHkgd2l0aCB0aGUgZGF0YWJhc2UKICAgICAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAg\nICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihmYWxzZSk7Cgog\nICAgICAgICAgICAgICAgaWYgKChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1\nc2hMaXN0ZW5lcnMoKQogICAgICAgICAgICAgICAgICAgIHx8IF90cmFuc0V2\nZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgICAg\nICAgICAmJiAoZmx1c2ggfHwgcmVhc29uID09IEZMVVNIX0NPTU1JVCkpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBmaXJlIGV2ZW50cwogICAgICAgICAg\nICAgICAgICAgIG1vYmpzID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9u\nKHRyYW5zYWN0aW9uYWwpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWFz\nb24gPT0gRkxVU0hfQ09NTUlUCiAgICAgICAgICAgICAgICAgICAgICAgICYm\nIF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcg\nVHJhbnNhY3Rpb25FdmVudCh0aGlzLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIFRyYW5zYWN0aW9uRXZlbnQuQkVGT1JFX0NPTU1JVCwgbW9ianMs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywg\nX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsKCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNv\nbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoID0gKF9mbGFncyAm\nIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7CiAgICAgICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoZmx1c2ggJiYgX3RyYW5z\nRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJzKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5z\nYWN0aW9uRXZlbnQodGhpcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBUcmFuc2FjdGlvbkV2ZW50LkJFRk9SRV9GTFVTSCwgbW9ianMsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0\nZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19QUkVTVE9SSU5HOwogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfREVSRUZERUxFVElORzsKICAgICAgICAgICAgX3RyYW5z\nQWRkaXRpb25zID0gbnVsbDsKICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25z\nID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGFsc28gY2xlYXIgZGVyZWZlZCBz\nZXQ7IHRoZSBkZWxldGVzIGhhdmUgYmVlbiByZWNvcmRlZAogICAgICAgICAg\nICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9k\nZXJlZkNhY2hlID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGZsdXNo\nIHRvIHN0b3JlIG1hbmFnZXIKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhj\nZXBzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoZmx1\nc2ggJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwpIHsKICAgICAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX1NUT1JFX0ZMVVNISU5HOwogICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywKICAgICAgICAgICAgICAgICAg\nICBuZXdGbHVzaEV4Y2VwdGlvbihfc3RvcmUuZmx1c2godHJhbnNhY3Rpb25h\nbCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19TVE9SRV9GTFVTSElORzsKCiAgICAg\nICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfUk9MTEJBQ0spCiAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJU\ncmFuc2FjdGlvbih0cnVlKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNv\nbiAhPSBGTFVTSF9MT0dJQ0FMKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX0ZMVVNIX1JFUVVJUkVEOwoKICAgICAgICAgICAgLy8gbWFyayBz\ndGF0ZXMgYXMgZmx1c2hlZAogICAgICAgICAgICBpZiAoZmx1c2gpIHsKICAg\nICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBz\nbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRo\nZSBzdGF0ZSBtYXkgaGF2ZSBiZWNvbWUgdHJhbnNpZW50LCBzdWNoIGFzIGlm\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0IGlzIGVtYmVkZGVkIGFu\nZCB0aGUgb3duZXIgaGFzIGJlZW4gZGVsZXRlZCBkdXJpbmcKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gdGhpcyBmbHVzaCBwcm9jZXNzOyBidWcgIzEx\nMDAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUo\nKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgc20u\nYWZ0ZXJGbHVzaChyZWFzb24pOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAocmVhc29uID09IEZMVVNIX0lOQykgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gaWYgbm90IGFib3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hl\nIGZvciBjb21taXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBh\nbnl3YXksIHJlLWNhY2hlIGRpcnR5IG9iamVjdHMgd2l0aCBkZWZhdWx0IHNv\nZnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnM7IHdlIGRv\nbid0IG5lZWQgaGFyZCByZWZzIG5vdyB0aGF0IHRoZSAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnByb3h5RmllbGRzKHRy\ndWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90cmFu\nc0NhY2hlLmZsdXNoZWQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywg\nZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0aHJvdyBhbnkg\nZXhjZXB0aW9ucyB0byBzaG9ydGN1dCBsaXN0ZW5lcnMgb24gZmFpbAogICAg\nICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwoKICAg\nICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9IEZMVVNIX1JPTExCQUNLICYm\nIHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMCiAgICAgICAgICAgICYmIF90cmFu\nc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAg\nICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50\nKHRoaXMsCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVS\nX0ZMVVNILCBtb2JqcywgX3BlcnNpc3RlZENsc3MsCiAgICAgICAgICAgICAg\nICBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEZsdXNoIG5ld2x5LXRyYW5zYWN0aW9uYWwg\nb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoQWRkaXRp\nb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikgewog\nICAgICAgIGJvb2xlYW4gbG9vcDsKICAgICAgICBkbyB7CiAgICAgICAgICAg\nIC8vIGZsdXNoIG5ldyB0cmFuc2FjdGlvbmFsIGluc3RhbmNlczsgbm90ZSBs\nb2dpY2FsIG9yCiAgICAgICAgICAgIGxvb3AgPSBmbHVzaFRyYW5zQWRkaXRp\nb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbikKICAgICAgICAgICAgICAgIHwg\nZGVsZXRlRGVyZWZBZGRpdGlvbnMoX2RlcmVmQ2FjaGUpOwogICAgICAgIH0g\nd2hpbGUgKGxvb3ApOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggdHJh\nbnNhY3Rpb25hbCBhZGRpdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBmbHVzaFRyYW5zQWRkaXRpb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rp\nb25hbCwgaW50IHJlYXNvbikgewogICAgICAgIGlmIChfdHJhbnNBZGRpdGlv\nbnMgPT0gbnVsbCB8fCBfdHJhbnNBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGtlZXAgbG9jYWwg\ndHJhbnNhY3Rpb25hbCBsaXN0IGNvcHkgdXAgdG8gZGF0ZQogICAgICAgIHRy\nYW5zYWN0aW9uYWwuYWRkQWxsKF90cmFuc0FkZGl0aW9ucyk7CgogICAgICAg\nIC8vIGNvcHkgdGhlIGNoYW5nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRo\nZSBuZXh0IGl0ZXJhdGlvbgogICAgICAgIFN0YXRlTWFuYWdlckltcGxbXSBz\ndGF0ZXMgPSAoU3RhdGVNYW5hZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMu\nCiAgICAgICAgICAgIHRvQXJyYXkobmV3IFN0YXRlTWFuYWdlckltcGxbX3Ry\nYW5zQWRkaXRpb25zLnNpemUoKV0pOwogICAgICAgIF90cmFuc0FkZGl0aW9u\ncyA9IG51bGw7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGVz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBzdGF0ZXNbaV0uYmVmb3JlRmx1\nc2gocmVhc29uLCBfY2FsbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZWxldGUgbmV3IGRlcmVmZXJlbmNlZCBvYmpl\nY3RzLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZGVsZXRlRGVyZWZB\nZGRpdGlvbnMoQ29sbGVjdGlvbiBkZXJlZnMpIHsKICAgICAgICBpZiAoX2Rl\ncmVmQWRkaXRpb25zID09IG51bGwgfHwgX2RlcmVmQWRkaXRpb25zLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBy\nZW1lbWJlciB0aGVzZSBhZGRpdGlvbnMgaW4gY2FzZSBvbmUgYmVjb21lcyBk\nZXJlZmVkIGFnYWluIGxhdGVyCiAgICAgICAgZGVyZWZzLmFkZEFsbChfZGVy\nZWZBZGRpdGlvbnMpOwoKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsW10gc3Rh\ndGVzID0gKFN0YXRlTWFuYWdlckltcGxbXSkgX2RlcmVmQWRkaXRpb25zLgog\nICAgICAgICAgICB0b0FycmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBsW19kZXJl\nZkFkZGl0aW9ucy5zaXplKCldKTsKICAgICAgICBfZGVyZWZBZGRpdGlvbnMg\nPSBudWxsOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgZGVsZXRlRGVyZWYoc3RhdGVzW2ld\nKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERlbGV0ZSBhIGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBkZWxldGVEZXJlZihTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENh\nbGxiYWNrcy5PUF9ERUxFVEUsCiAgICAgICAgICAgIHNtLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpLCBzbSwgbnVsbCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBP\ncENhbGxiYWNrcy5BQ1RfUlVOKSAhPSAwKQogICAgICAgICAgICBzbS5kZWxl\ndGUoKTsKICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9D\nQVNDQURFKSAhPSAwKQogICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKF9j\nYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgYWN0\naW9uIHRvIHRha2UgYmFzZWQgb24gdGhlIHVzZXIncyBnaXZlbiBjYWxsYmFj\na3MgYW5kCiAgICAgKiBvdXIgaW1wbGljaXQgYmVoYXZpb3IuCiAgICAgKi8K\nICAgIHByaXZhdGUgaW50IHByb2Nlc3NBcmd1bWVudChpbnQgb3AsIE9iamVj\ndCBvYmosIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBz\nbSk7CiAgICAgICAgaWYgKF9jYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfY2FsbC5wcm9jZXNzQXJndW1lbnQob3AsIG9iaiwgc20pOwogICAg\nICAgIHJldHVybiBPcENhbGxiYWNrcy5BQ1RfUlVOIHwgT3BDYWxsYmFja3Mu\nQUNUX0NBU0NBREU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyB0aGUg\ncHJvcGVyIGV4Y2VwdGlvbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gc2V0IG9mIGZs\ndXNoIGVycm9ycywgb3IKICAgICAqIGRvIG5vdGhpbmcgaWYgbm8gZXJyb3Jz\nIG9jY3VycmVkLgogICAgICovCiAgICBwcml2YXRlIE9wZW5KUEFFeGNlcHRp\nb24gbmV3Rmx1c2hFeGNlcHRpb24oQ29sbGVjdGlvbjxFeGNlcHRpb24+IGV4\nY2VwcykgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMu\naXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nVGhyb3dhYmxlW10gdCA9IGV4Y2Vwcy50b0FycmF5KG5ldyBUaHJvd2FibGVb\nZXhjZXBzLnNpemUoKV0pOwogICAgICAgIExpc3Q8T2JqZWN0PiBmYWlsZWQg\nPSBuZXcgQXJyYXlMaXN0PE9iamVjdD4odC5sZW5ndGgpOwoKICAgICAgICAv\nLyBjcmVhdGUgZmF0YWwgZXhjZXB0aW9uIHdpdGggbmVzdGVkIGV4Y2VwdGlv\nbnMgZm9yIGFsbCB0aGUgZmFpbGVkCiAgICAgICAgLy8gb2JqZWN0czsgaWYg\nYWxsIE9MIGV4Y2VwdGlvbnMsIHRocm93IGEgdG9wLWxldmVsIE9MIGV4Y2Vw\ndGlvbgogICAgICAgIGJvb2xlYW4gb3B0ID0gdHJ1ZTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgb3B0ICYmIGkgPCB0Lmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIG9wdCA9IHRbaV0gaW5zdGFuY2VvZiBPcHRpbWlzdGljRXhjZXB0\naW9uOwogICAgICAgICAgICBpZiAob3B0KSB7CiAgICAgICAgICAgICAgICBP\nYmplY3QgZiA9ICgoT3B0aW1pc3RpY0V4Y2VwdGlvbikgdFtpXSkuZ2V0RmFp\nbGVkT2JqZWN0KCk7CiAgICAgICAgICAgICAgICBpZiAoZiAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGZhaWxlZC5hZGQoZik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaWYgKG9wdCAmJiAhZmFpbGVkLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICBpZihfc3VwcHJlc3NCYXRjaE9MRUxvZ2dp\nbmcgPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9wdGlt\naXN0aWNFeGNlcHRpb24oX2xvYy5nZXQoImJyb2tlci1zdXBwcmVzc2luZy1l\neGNlcHRpb25zIix0Lmxlbmd0aCkpOwogICAgICAgICAgICB9ZWxzZXsKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihm\nYWlsZWQsIHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlm\nIChvcHQpCiAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2Vw\ndGlvbih0KTsKICAgICAgICAKICAgICAgICBPYmplY3QgZmFpbGVkT2JqZWN0\nID0gbnVsbDsKICAgICAgICBpZiAodFswXSBpbnN0YW5jZW9mIE9wZW5KUEFF\neGNlcHRpb24pewogICAgICAgIAlmYWlsZWRPYmplY3QgPSAoKE9wZW5KUEFF\neGNlcHRpb24pdFswXSkuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIHJldHVybiBuZXcgU3RvcmVFeGNlcHRpb24oX2xv\nYy5nZXQoInJvbGxlZC1iYWNrIikpLgogICAgICAgICAgICBzZXROZXN0ZWRU\naHJvd2FibGVzKHQpLnNldEZhdGFsKHRydWUpLnNldEZhaWxlZE9iamVjdChm\nYWlsZWRPYmplY3QpOwogICAgfQoKICAgIC8qKgogICAgICogRW5kIHRoZSBj\ndXJyZW50IHRyYW5zYWN0aW9uLCBtYWtpbmcgYXBwcm9wcmlhdGUgc3RhdGUg\ndHJhbnNpdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGVuZFRy\nYW5zYWN0aW9uKGludCBzdGF0dXMpIHsKICAgICAgICAvLyBpZiBhIGRhdGEg\nc3RvcmUgdHJhbnNhY3Rpb24gd2FzIGluIHByb2dyZXNzLCBkbyB0aGUKICAg\nICAgICAvLyBhcHByb3ByaWF0ZSB0cmFuc2FjdGlvbiBjaGFuZ2UKICAgICAg\nICBib29sZWFuIHJvbGxiYWNrID0gc3RhdHVzICE9IFN0YXR1cy5TVEFUVVNf\nQ09NTUlUVEVEOwogICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMgPSBu\ndWxsOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihyb2xsYmFjaykp\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgcm9sbGJhY2sgPSB0cnVlOwogICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCByZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBnbyBi\nYWNrIHRvIGRlZmF1bHQgbm9uZSBsb2NrIGxldmVsCiAgICAgICAgX2ZjLnNl\ndFJlYWRMb2NrTGV2ZWwoTE9DS19OT05FKTsKICAgICAgICBfZmMuc2V0V3Jp\ndGVMb2NrTGV2ZWwoTE9DS19OT05FKTsKICAgICAgICBfZmMuc2V0TG9ja1Rp\nbWVvdXQoLTEpOwoKICAgICAgICBDb2xsZWN0aW9uIHRyYW5zU3RhdGVzOwog\nICAgICAgIGlmIChoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAg\nICAgICB0cmFuc1N0YXRlcyA9IF90cmFuc0NhY2hlOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgdHJhbnNTdGF0ZXMgPSBDb2xsZWN0aW9ucy5FTVBUWV9T\nRVQ7CgogICAgICAgIC8vIGZpcmUgYWZ0ZXIgcm9sbGJhY2svY29tbWl0IGV2\nZW50CiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7CiAgICAgICAg\naWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewog\nICAgICAgICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlv\nbih0cmFuc1N0YXRlcyk7CiAgICAgICAgICAgIGludCBldmVudFR5cGUgPSAo\ncm9sbGJhY2spID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9ST0xMQkFDSwog\nICAgICAgICAgICAgICAgOiBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NPTU1J\nVDsKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5z\nYWN0aW9uRXZlbnQodGhpcywgZXZlbnRUeXBlLCBtb2JqcywgCiAgICAgICAg\nICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRl\nZENsc3MpKTsKICAgICAgICB9CgogICAgICAgIC8vIG51bGwgdHJhbnNhY3Rp\nb25hbCBjYWNoZXMgbm93IHNvIHRoYXQgYWxsIHRoZSByZW1vdmVGcm9tVHJh\nbnNhY3Rpb24KICAgICAgICAvLyBjYWxscyBhcyB3ZSB0cmFuc2l0aW9uIGVh\nY2ggb2JqZWN0IGRvbid0IGhhdmUgdG8gZG8gYW55IHdvcms7IGRvbid0CiAg\nICAgICAgLy8gY2xlYXIgdHJhbnMgY2FjaGUgb2JqZWN0IGJlY2F1c2Ugd2Ug\nc3RpbGwgbmVlZCB0aGUgdHJhbnNTdGF0ZXMKICAgICAgICAvLyByZWZlcmVu\nY2UgdG8gaXQgYmVsb3cKICAgICAgICBfdHJhbnNDYWNoZSA9IG51bGw7CiAg\nICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAg\nIF9wZXJzaXN0ZWRDbHNzID0gbnVsbDsKICAgICAgICBpZiAoX3VwZGF0ZWRD\nbHNzICE9IG51bGwpCiAgICAgICAgICAgIF91cGRhdGVkQ2xzcyA9IG51bGw7\nCiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyAhPSBudWxsKQogICAgICAgICAg\nICBfZGVsZXRlZENsc3MgPSBudWxsOwoKICAgICAgICAvLyBuZXcgY2FjaGUg\nd291bGQgZ2V0IGNsZWFyZWQgYW55d2F5IGR1cmluZyB0cmFuc2l0aW9ucywg\nYnV0IGRvaW5nIHNvCiAgICAgICAgLy8gaW1tZWRpYXRlbHkgc2F2ZXMgdXMg\nc29tZSBsb29rdXBzCiAgICAgICAgX2NhY2hlLmNsZWFyTmV3KCk7CgogICAg\nICAgIC8vIHRlbGwgYWxsIGRlcmVmZWQgaW5zdGFuY2VzIHRoZXkncmUgbm8g\nbG9uZ2VyIGRlcmVmZWQ7IHdlIGNhbid0CiAgICAgICAgLy8gcmVseSBvbiBy\nb2xsYmFjayBhbmQgY29tbWl0IGNhbGxzIGJlbG93IGNhdXNlIHNvbWUgaW5z\ndGFuY2VzIG1pZ2h0CiAgICAgICAgLy8gbm90IGJlIHRyYW5zYWN0aW9uYWwK\nICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhX2RlcmVmQ2Fj\naGUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8U3Rh\ndGVNYW5hZ2VySW1wbD4gaXRyID0gX2RlcmVmQ2FjaGUuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBpdHIubmV4dCgpLnNl\ndERlcmVmZXJlbmNlZERlcGVuZGVudChmYWxzZSwgZmFsc2UpOwogICAgICAg\nICAgICBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAv\nLyBwZXJmb3JtIGNvbW1pdCBvciByb2xsYmFjayBzdGF0ZSB0cmFuc2l0aW9u\ncyBvbiBlYWNoIGluc3RhbmNlCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zU3RhdGVzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0g\nKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBpZiAocm9sbGJhY2spIHsKICAgICAgICAg\nICAgICAgICAgICAvLyB0ZWxsIG9iamVjdHMgdGhhdCBtYXkgaGF2ZSBiZWVu\nIGRlcmVmZWQgdGhlbiBmbHVzaGVkCiAgICAgICAgICAgICAgICAgICAgLy8g\nKGFuZCB0aGVyZWZvcmUgZGVsZXRlZCkgdG8gdW4tZGVyZWYKICAgICAgICAg\nICAgICAgICAgICBzbS5zZXREZXJlZmVyZW5jZWREZXBlbmRlbnQoZmFsc2Us\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzbS5yb2xsYmFjaygpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUE5FV0RFTEVURUQgfHwg\nc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUERFTEVURUQpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNtLmdldFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpLCBudWxsLCBzbS5nZXRNZXRhRGF0YSgpLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50LkFG\nVEVSX0RFTEVURV9QRVJGT1JNRUQpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBzbS5jb21taXQoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3RpZnkg\ndGhlIGxvY2sgbWFuYWdlciB0byBjbGVhbiB1cCBhbmQgcmVsZWFzZSByZW1h\naW5pbmcgbG9ja3MKICAgICAgICBfbG0uZW5kVHJhbnNhY3Rpb24oKTsKCiAg\nICAgICAgLy8gY2xlYXIgb2xkIHNhdmVwb2ludHMgaW4gcmV2ZXJzZQogICAg\nICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsKICAgICAgICB3aGlsZSAoX3Nh\ndmVwb2ludHMgIT0gbnVsbCAmJiBfc2F2ZXBvaW50cy5zaXplKCkgPiAwKSB7\nCiAgICAgICAgICAgIHNhdmUgPQogICAgICAgICAgICAgICAgKE9wZW5KUEFT\nYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXpl\nKCkgLSAxKTsKICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAg\nICAgICB9CiAgICAgICAgX3NhdmVwb2ludHMgPSBudWxsOwogICAgICAgIF9z\nYXZlcG9pbnRDYWNoZSA9IG51bGw7CgogICAgICAgIC8vIGZpcmUgYWZ0ZXIg\nc3RhdGUgY2hhbmdlIGV2ZW50CiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFu\nYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgZmlyZVRyYW5z\nYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywgVHJhbnNh\nY3Rpb25FdmVudC4KICAgICAgICAgICAgICAgIEFGVEVSX1NUQVRFX1RSQU5T\nSVRJT05TLCBtb2JqcywgbnVsbCwgbnVsbCwgbnVsbCkpOwoKICAgICAgICAv\nLyBub3cgY2xlYXIgdHJhbnMgY2FjaGU7IGtlZXAgY2xlYXJlZCB2ZXJzaW9u\nIHJhdGhlciB0aGFuCiAgICAgICAgLy8gbnVsbCB0byBhdm9pZCBoYXZpbmcg\ndG8gcmUtY3JlYXRlIHRoZSBzZXQgbGF0ZXI7IG1vcmUgZWZmaWNpZW50CiAg\nICAgICAgaWYgKHRyYW5zU3RhdGVzICE9IENvbGxlY3Rpb25zLkVNUFRZX1NF\nVCkgewogICAgICAgICAgICBfdHJhbnNDYWNoZSA9IChUcmFuc2FjdGlvbmFs\nQ2FjaGUpIHRyYW5zU3RhdGVzOwogICAgICAgICAgICBfdHJhbnNDYWNoZS5j\nbGVhcigpOwogICAgICAgIH0KCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRp\nb25zKGV4Y2VwcywgdHJ1ZSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIE9iamVjdCBsaWZlY3ljbGUKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgcGVyc2lzdChPYmplY3Qgb2Jq\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcGVyc2lzdChvYmosIG51\nbGwsIHRydWUsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHBlcnNpc3QoT2JqZWN0IG9iaiwgT2JqZWN0IGlkLAogICAg\nICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICByZXR1cm4gcGVyc2lz\ndChvYmosIGlkLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwZXJzaXN0QWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIHBlcnNpc3RBbGwob2JqcywgdHJ1ZSwgY2FsbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3Rz\nLiAgSW5kaWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJz\naXN0CiAgICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBO\nRVdQUk9WSVNJT05BTCkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNp\nc3RBbGwoQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIGV4cGxpY2l0LCAKICAg\nICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKHRydWUpOwogICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRl\nT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0\nciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGVyc2lzdChp\ndHIubmV4dCgpLCBleHBsaWNpdCwgY2FsbCk7CiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVz\ndGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIElmIHRoZSBnaXZlbiBlbGVtZW50IGlzIG5vdCBudWxsLCBhZGQg\naXQgdG8gdGhlIGdpdmVuIGxpc3QsCiAgICAgKiBjcmVhdGluZyB0aGUgbGlz\ndCBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxFeGNl\ncHRpb24+IGFkZChMaXN0PEV4Y2VwdGlvbj4gbCwgRXhjZXB0aW9uIG8pIHsK\nICAgICAgICBpZiAobyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbDsK\nICAgICAgICBpZiAobCA9PSBudWxsKQogICAgICAgICAgICBsID0gbmV3IExp\nbmtlZExpc3Q8RXhjZXB0aW9uPigpOwogICAgICAgIGwuYWRkKG8pOwogICAg\nICAgIHJldHVybiBsOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYW4g\nZXhjZXB0aW9uIHdyYXBwaW5nIHRoZSBnaXZlbiBuZXN0ZWQgZXhjZXB0aW9u\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93TmVzdGVkRXhjZXB0\naW9ucyhMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzLCBib29sZWFuIGRhdGFzdG9y\nZSkgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKGRhdGFz\ndG9yZSAmJiBleGNlcHMuc2l6ZSgpID09IDEpCiAgICAgICAgICAgIHRocm93\nIChSdW50aW1lRXhjZXB0aW9uKSBleGNlcHMuZ2V0KDApOwoKICAgICAgICBi\nb29sZWFuIGZhdGFsID0gZmFsc2U7CiAgICAgICAgVGhyb3dhYmxlW10gdCA9\nIGV4Y2Vwcy50b0FycmF5KG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0p\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdC5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAodFtpXSBpbnN0YW5jZW9mIE9wZW5KUEFFeGNl\ncHRpb24KICAgICAgICAgICAgICAgICYmICgoT3BlbkpQQUV4Y2VwdGlvbikg\ndFtpXSkuaXNGYXRhbCgpKQogICAgICAgICAgICAgICAgZmF0YWwgPSB0cnVl\nOwogICAgICAgIH0KICAgICAgICBPcGVuSlBBRXhjZXB0aW9uIGVycjsKICAg\nICAgICBpZiAoZGF0YXN0b3JlKQogICAgICAgICAgICBlcnIgPSBuZXcgU3Rv\ncmVFeGNlcHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBlcnIgPSBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKTsKICAgICAgICB0aHJvdyBlcnIu\nc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRhbChmYXRhbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3QuICBJ\nbmRpY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNpc3QK\nICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BS\nT1ZJU0lPTkFMKQogICAgICovCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0KE9i\namVjdCBvYmosIGJvb2xlYW4gZXhwbGljaXQsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBwZXJzaXN0KG9iaiwgbnVsbCwgZXhwbGljaXQsIGNhbGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2Jq\nZWN0LiAgSW5kaWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBw\nZXJzaXN0CiAgICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3Qg\nKFBORVdQUk9WSVNJT05BTCkuCiAgICAgKiBTZWUge0BsaW5rIEJyb2tlcn0g\nZm9yIGRldGFpbHMgb24gdGhpcyBtZXRob2QuCiAgICAgKi8KICAgIHB1Ymxp\nYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHBlcnNpc3QoT2JqZWN0IG9iaiwgT2Jq\nZWN0IGlkLCBib29sZWFuIGV4cGxpY2l0LAogICAgICAgIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlv\nbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0\nYXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKCFf\nb3BlcmF0aW5nLmFkZChvYmopKQogICAgICAgICAgICAgICAgcmV0dXJuIHNt\nOwoKICAgICAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChP\ncENhbGxiYWNrcy5PUF9QRVJTSVNULCBvYmosIHNtLCBjYWxsKTsKICAgICAg\nICAgICAgaWYgKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkKICAg\nICAgICAgICAgICAgIHJldHVybiBzbTsKCiAgICAgICAgICAgIC8vIEFDVF9D\nQVNDQURFCiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkgewogICAgICAgICAgICAgICAgaWYgKHNtICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2Fs\nbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5PUF9QRVJTSVNULCBvYmos\nIGNhbGwsCiAgICAgICAgICAgICAgICAgICAgICAgICJwZXJzaXN0Iik7CiAg\nICAgICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIEFDVF9SVU4KICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjOwogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAgICAgICAgICgicGVyc2lzdC1kZXRhY2hlZCIs\nIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLgogICAgICAgICAgICAgICAg\nICAgICAgICBzZXRGYWlsZWRPYmplY3Qob2JqKTsKCiAgICAgICAgICAgICAg\nICBpZiAoIXNtLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nIHNtLnBlcnNpc3QoKTsKICAgICAgICAgICAgICAgICAgICBfY2FjaGUucGVy\nc2lzdChzbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBP\ncENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0gMCkKICAgICAgICAgICAgICAg\nICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIC8vIGFuIGVtYmVkZGVkIGZpZWxkOyBub3RpZnkgdGhlIG93\nbmVyIHRoYXQgdGhlIHZhbHVlIGhhcwogICAgICAgICAgICAgICAgLy8gY2hh\nbmdlZCBieSBiZWNvbWluZyBpbmRlcGVuZGVudGx5IHBlcnNpc3RlbnQKICAg\nICAgICAgICAgICAgIHNtLmdldE93bmVyKCkuZGlydHkoc20uZ2V0T3duZXJJ\nbmRleCgpKTsKICAgICAgICAgICAgICAgIF9jYWNoZS5wZXJzaXN0KHNtKTsK\nICAgICAgICAgICAgICAgIHBjID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxl\nKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYyA9\nIGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopOwogICAgICAgICAgICAg\nICAgaWYgKHBjLnBjSXNEZXRhY2hlZCgpID09IEJvb2xlYW4uVFJVRSkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0\naW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgicGVyc2lz\ndC1kZXRhY2hlZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLgogICAg\nICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qob2JqKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAg\nICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVy\nLCB0cnVlKTsKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KG9iaiwg\nbnVsbCwgbWV0YSwgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1BFUlNJU1QpOwoK\nICAgICAgICAgICAgLy8gY3JlYXRlIGlkIGZvciBpbnN0YW5jZQogICAgICAg\nICAgICBpZiAoaWQgPT0gbnVsbCkgewogICAgICAgICAgICAJaW50IGlkVHlw\nZSA9IG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgICAgICAgICBp\nZiAoaWRUeXBlID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAg\nICAgICAgICAgICAgICAgICAgaWQgPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUo\ncGMsIG1ldGEpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoaWRUeXBlID09\nIENsYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtu\nb3duaWQiLCBtZXRhKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0\naGlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIHdlIGRvbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5zdGFuY2UgY2FjaGVkCiAg\nICAgICAgICAgIGNoZWNrRm9yRHVwbGljYXRlSWQoaWQsIG9iaik7CgogICAg\nICAgICAgICAvLyBpZiBoYWQgZW1iZWRkZWQgc20sIG51bGwgaXQKICAgICAg\nICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICBwYy5wY1Jl\ncGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7CgogICAgICAgICAgICAvLyBjcmVh\ndGUgbmV3IHNtCiAgICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1w\nbChpZCwgbWV0YSk7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChleHBsaWNpdCkK\nICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRl\nLlBORVcpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNtLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5FV1BST1ZJU0lPTkFM\nKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBzbS5pbml0\naWFsaXplKHBjLCBQQ1N0YXRlLlBOT05UUkFOU05FVyk7CiAgICAgICAgICAg\nIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDAp\nCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAg\nICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVGVtcG9yYXJpbHkgbWFuYWdlIHRoZSBn\naXZlbiBpbnN0YW5jZSBpbiBvcmRlciB0byBjYXNjYWRlIHRoZSBnaXZlbgog\nICAgICogb3BlcmF0aW9uIHRocm91Z2ggaXQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBjYXNjYWRlVHJhbnNpZW50KGludCBvcCwgT2JqZWN0IG9iaiwg\nT3BDYWxsYmFja3MgY2FsbCwKICAgICAgICBTdHJpbmcgZXJyT3ApIHsKICAg\nICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBhc3NlcnRQZXJzaXN0ZW5j\nZUNhcGFibGUob2JqKTsKCiAgICAgICAgLy8gaWYgdXNpbmcgZGV0YWNoZWQg\nc3RhdGUgbWFuYWdlciwgZG9uJ3QgcmVwbGFjZQogICAgICAgIGlmIChwYy5w\nY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgZXJyT3ApOwoKICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0\nQ2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwoU3RhdGVNYW5hZ2VySWQu\nCiAgICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBtZXRhKTsKICAgICAg\nICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlRMT0FERUQpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAg\nICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVSU0lTVDoKICAgICAgICAgICAg\nICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFj\na3MuT1BfREVMRVRFOgogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVE\nZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0g6CiAgICAg\nICAgICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihvcCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBzbS5y\nZWxlYXNlKHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBkZWxldGVBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKCiAgICAg\nICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMgPSBudWxsOwogICAgICAg\nICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+\nIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgb2JqID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2JqICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZShvYmosIGdldFN0\nYXRlTWFuYWdlckltcGwob2JqLCB0cnVlKSwgY2FsbCk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24o\nKTsKICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGRlbGV0ZS4KICAgICAq\nLwogICAgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgU3RhdGVNYW5hZ2VySW1w\nbCBzbSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmICghX29wZXJh\ndGluZy5hZGQob2JqKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBp\nbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0RF\nTEVURSwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgaWYgKGFjdGlvbiA9PSBP\ncENhbGxiYWNrcy5BQ1RfTk9ORSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBBQ1RfQ0FTQ0FERQogICAgICAgIGlmICgoYWN0aW9uICYgT3BD\nYWxsYmFja3MuQUNUX1JVTikgPT0gMCkgewogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVk\nKCkgfHwgIXNtLmdldERlcmVmZXJlbmNlZEVtYmVkRGVwZW5kZW50KCkpIHsK\nICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFj\na3MuT1BfREVMRVRFLCBvYmosIGNhbGwsICJkZWxldGUiKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gQUNUX1JVTgogICAg\nICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChzbS5pc0Rl\ndGFjaGVkKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4\nY2VwdGlvbihvYmosICJkZWxldGUiKTsKICAgICAgICAgICAgaWYgKChhY3Rp\nb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0gMCkgewogICAgICAg\nICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkgfHwgIXNtLmdldERlcmVm\nZXJlbmNlZEVtYmVkRGVwZW5kZW50KCkpIHsKICAgICAgICAgICAgICAgICAg\nICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHNtLmRlbGV0ZSgpOwogICAgICAg\nIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJ\nc0RldGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICB0aHJv\ndyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxldGUiKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlvbiBpbmRpY2F0aW5n\nIHRoYXQgdGhlIGN1cnJlbnQgYWN0aW9uIGNhbid0IGJlCiAgICAgKiBwZXJm\nb3JtZWQgb24gYSBkZXRhY2hlZCBvYmplY3QuCiAgICAgKi8KICAgIHByaXZh\ndGUgT3BlbkpQQUV4Y2VwdGlvbiBuZXdEZXRhY2hlZEV4Y2VwdGlvbihPYmpl\nY3Qgb2JqLAogICAgICAgIFN0cmluZyBvcGVyYXRpb24pIHsKICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaGVk\nLW9wIiwgb3BlcmF0aW9uLAogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3Ry\naW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByZWxlYXNlQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhj\nZXBzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIg\nPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJlbGVhc2UoaXRy\nLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2Vy\nRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMs\nIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncmVsZWFzZShPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpbnQgYWN0aW9uID0gcHJv\nY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFTEVBU0UsIG9iaiwgc20s\nIGNhbGwpOwoKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BD\nYWxsYmFja3MuQUNUX1JVTikgIT0gMCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkg\newogICAgICAgICAgICAgICAgYm9vbGVhbiBwZW5kaW5nID0gc20uaXNQZW5k\naW5nVHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAgc20ucmVsZWFz\nZSh0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nKQogICAgICAg\nICAgICAgICAgICAgIHJlbW92ZUZyb21QZW5kaW5nVHJhbnNhY3Rpb24oc20p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBlbWJl\nZChPYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBvd25lciwgVmFsdWVNZXRhRGF0YSBvd25lck1ldGEpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcgPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChvcmlnICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGFscmVhZHkgZW1iZWRkZWQs\nIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgICAgIGlmIChvcmlnLmdldE93\nbmVyKCkgPT0gb3duZXIgJiYgb3JpZy5nZXRNZXRhRGF0YSgpLgogICAgICAg\nICAgICAgICAgICAgIGdldEVtYmVkZGluZ01ldGFEYXRhKCkgPT0gb3duZXJN\nZXRhKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnOwoKICAgICAg\nICAgICAgICAgIC8vIG90aGVyd2lzZSBtYWtlIHN1cmUgcGMgaXMgZnVsbHkg\nbG9hZGVkIGZvciB3aGVuIHdlIGNvcHkgaXRzCiAgICAgICAgICAgICAgICAv\nLyBkYXRhIGJlbG93CiAgICAgICAgICAgICAgICBvcmlnLmxvYWQoX2ZjLCBT\ndGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxMLCBudWxsLCBudWxsLCBmYWxzZSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3Rh\ndGUgbWFuYWdlciB3aXRoIGVtYmVkZGVkIG1ldGFkYXRhCiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IG93bmVyTWV0YS5nZXRFbWJlZGRlZE1l\ndGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1lbWJlZCIsIG93bmVyTWV0YSkpOwoKICAgICAgICAgICAgaWYg\nKGlkID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IFN0YXRlTWFuYWdl\ncklkLm5ld0luc3RhbmNlKHRoaXMpOwoKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwoaWQsIG1ldGEpOwog\nICAgICAgICAgICBzbS5zZXRPd25lcigoU3RhdGVNYW5hZ2VySW1wbCkgb3du\nZXIsIG93bmVyTWV0YSk7CgogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgY29weTsKICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZTsKICAgICAgICAg\nICAgQ2xhc3M8Pz4gdHlwZSA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwog\nICAgICAgICAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIC8vIGdpdmUgY29weSBhbmQgdGhlIG9yaWdpbmFsIGluc3RhbmNlIHRoZSBz\nYW1lIHN0YXRlIG1hbmFnZXIKICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQg\nd2UgY2FuIGNvcHkgZmllbGRzIGZyb20gb25lIHRvIHRoZSBvdGhlcgogICAg\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBjb3B5U007CiAgICAgICAg\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGM7CiAgICAgICAgICAgICAg\nICBpZiAob3JpZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29w\neVNNID0gc207CiAgICAgICAgICAgICAgICAgICAgcGMgPSBhc3NlcnRQZXJz\naXN0ZW5jZUNhcGFibGUob2JqKTsKICAgICAgICAgICAgICAgICAgICBwYy5w\nY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb3B5U00gPSBvcmlnOwogICAg\nICAgICAgICAgICAgICAgIHBjID0gb3JpZy5nZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIC8vIGNvcHkgdGhlIGluc3RhbmNlLiAg\nd2UgZG8gdGhpcyBldmVuIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeQogICAgICAg\nICAgICAgICAgICAgIC8vIGhhdmUgYSBzdGF0ZSBtYW5hZ2VyIGluIGNhc2Ug\naXQgaXMgbGF0ZXIgYXNzaWduZWQgdG8gYQogICAgICAgICAgICAgICAgICAg\nIC8vIFBDIGZpZWxkOyBhdCB0aGF0IHBvaW50IGl0J3MgdG9vIGxhdGUgdG8g\nY29weQogICAgICAgICAgICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5l\nd0luc3RhbmNlKHR5cGUsIGNvcHlTTSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgICAgIGludFtdIGZpZWxkcyA9IG5ldyBpbnRbbWV0YS5nZXRGaWVsZHMo\nKS5sZW5ndGhdOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAg\nICAgICBmaWVsZHNbaV0gPSBpOwogICAgICAgICAgICAgICAgICAgIGNvcHku\ncGNDb3B5RmllbGRzKHBjLCBmaWVsZHMpOwogICAgICAgICAgICAgICAgICAg\nIHN0YXRlID0gUENTdGF0ZS5FQ09QWTsKICAgICAgICAgICAgICAgICAgICBj\nb3B5LnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsKICAgICAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhl\nIGluc3RhbmNlIGRpZG4ndCBoYXZlIGEgc3RhdGUgbWFuYWdlciB0byBzdGFy\ndCwKICAgICAgICAgICAgICAgICAgICAvLyByZXZlcnQgaXQgdG8gYmVpbmcg\ndHJhbnNpZW50CiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyKG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3\nSW5zdGFuY2UodHlwZSwgc20sIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDAgJiYgIV9vcHRpbWlzdGlj\nKQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FQ0xFQU47\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc3Rh\ndGUgPSBQQ1N0YXRlLkVOT05UUkFOUzsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgc20uaW5pdGlhbGl6ZShjb3B5LCBzdGF0ZSk7CiAgICAgICAgICAg\nIHJldHVybiBzbTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIElmIG5vdCBhbHJlYWR5IGNhY2hlZCwgY3JlYXRlIGFu\nIGVtcHR5IGNvcHkgb2YgdGhlIGdpdmVuIHN0YXRlCiAgICAgKiBtYW5hZ2Vy\nIGluIHRoZSBnaXZlbiBzdGF0ZS4KICAgICAqLwogICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBjb3B5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weSwgUENTdGF0\nZSBzdGF0ZSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAg\nICAgT2JqZWN0IG9pZCA9IGNvcHkuZmV0Y2hPYmplY3RJZCgpOwogICAgICAg\nICAgICBDbGFzczw/PiB0eXBlID0gY29weS5nZXRNYW5hZ2VkSW5zdGFuY2Uo\nKS5nZXRDbGFzcygpOwogICAgICAgICAgICBpZiAob2lkID09IG51bGwpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsK\nICAgICAgICAgICAgLy8gY2FjaGVkIGluc3RhbmNlPwogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gbnVsbDsKICAgICAgICAgICAgaWYgKCFj\nb3B5LmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbEJ5SWQob2lkLCB0cnVlKTsKICAgICAgICAgICAgaWYg\nKHNtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIE1ldGFEYXRhUmVwb3Np\ndG9yeSByZXBvcyA9IF9jb25mLgogICAgICAgICAgICAgICAgICAgIGdldE1l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YSh0eXBlLCBf\nbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIC8vIGNvbnN0cnVjdCBh\nIG5ldyBzdGF0ZSBtYW5hZ2VyIHdpdGggYWxsIGluZm8ga25vd24KICAgICAg\nICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIG1ldGEp\nOwogICAgICAgICAgICAgICAgc20uc2V0T2JqZWN0SWQob2lkKTsKICAgICAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXRE\nZXNjcmliZWRUeXBlKCksIHN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gc207CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBw\ndWJsaWMgdm9pZCByZWZyZXNoQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzID09IG51bGwgfHwgb2Jq\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgCiAgICAgICAgICAgICAgICBnYXRoZXJDYXNjYWRlUmVmcmVz\naChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgaWYgKF9vcGVyYXRp\nbmcuaXNFbXB0eSgpKQogICAgICAgICAgICAJcmV0dXJuOwogICAgICAgICAg\nICBpZiAoX29wZXJhdGluZy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgCXJl\nZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLml0ZXJhdG9yKCkubmV4dCgpLCBj\nYWxsKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAJcmVmcmVzaElu\ndGVybmFsKF9vcGVyYXRpbmcsIGNhbGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCByZWZyZXNoKE9iamVjdCBvYmosIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoKTsKCiAgICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKG9i\naiwgY2FsbCk7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLmlzRW1wdHko\nKSkKICAgICAgICAgICAgCXJldHVybjsKICAgICAgICAgICAgaWYgKF9vcGVy\nYXRpbmcuc2l6ZSgpID09IDEpCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJu\nYWwoX29wZXJhdGluZy5pdGVyYXRvcigpLm5leHQoKSwgY2FsbCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgCXJlZnJlc2hJbnRlcm5hbChfb3Bl\ncmF0aW5nLCBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHYXRoZXJzIGFsbCBvYmplY3RzIHJlYWNoYWJsZSB0aHJvdWdoIGNh\nc2NhZGUtcmVmcmVzaCByZWxhdGlvbnMKICAgICAqIGludG8gdGhlIG9wZXJh\ndGluZyBzZXQuCiAgICAgKi8KICAgIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJl\nc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlm\nICghX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbChvYmosIGZhbHNlKTsKICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vz\nc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgc20sIGNh\nbGwpOwogICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NB\nU0NBREUpID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYg\nKHNtICE9IG51bGwpCiAgICAgICAgICAgIHNtLmdhdGhlckNhc2NhZGVSZWZy\nZXNoKGNhbGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY2FzY2FkZVRy\nYW5zaWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIGNhbGwsICJy\nZWZyZXNoIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBp\ncyBjYWxsZWQgd2l0aCB0aGUgZnVsbCBzZXQgb2Ygb2JqZWN0cyByZWFjaGFi\nbGUgdmlhCiAgICAgKiBjYXNjYWRlLXJlZnJlc2ggcmVsYXRpb25zIGZyb20g\ndGhlIHVzZXItZ2l2ZW4gaW5zdGFuY2VzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCByZWZyZXNoSW50ZXJuYWwoQ29sbGVjdGlvbiBvYmpzLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAJaWYgKG9ianMgPT0gbnVsbCB8fCBvYmpz\nLmlzRW1wdHkoKSkKICAgIAkJcmV0dXJuOwogICAgICAgIExpc3Q8RXhjZXB0\naW9uPiBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIGNvbGxlY3QgaW5zdGFuY2VzIHRoYXQgbmVlZCBhIHJlZnJlc2gKICAg\nICAgICAgICAgQ29sbGVjdGlvbjxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBsb2Fk\nID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAg\nICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\ncjw/PiBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxs\nYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZy\nZXNoIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNtLmJl\nZm9yZVJlZnJlc2godHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nCWlmIChsb2FkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIAkJ\nbG9hZCA9IG5ldyBBcnJheUxpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4ob2Jq\ncy5zaXplKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZC5h\nZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIGludCBsZXZlbCA9IF9mYy5nZXRSZWFkTG9ja0xldmVs\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCB0aW1lb3V0ID0gX2Zj\nLmdldExvY2tUaW1lb3V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgdGltZW91dCwgbnVsbCwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBsZXZl\nbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJz\naXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQogICAgICAgICAg\nICAgICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJl\nZnJlc2giKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCBrZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIHJlZnJlc2ggYWxsCiAgICAgICAgICAgIGlmIChs\nb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb248T2Jq\nZWN0PiBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLAogICAg\nICAgICAgICAgICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX1JFRlJF\nU0gsIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9\nIG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb24oZmFpbGVkKSk7CgogICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBw\nb3N0LXJlZnJlc2ggdHJhbnNpdGlvbnMgYW5kIG1ha2Ugc3VyZSBhbGwgZmV0\nY2gKICAgICAgICAgICAgICAgIC8vIGdyb3VwIGZpZWxkcyBhcmUgbG9hZGVk\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPE9wZW5KUEFTdGF0ZU1h\nbmFnZXI+IGl0ciA9IGxvYWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBs\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChmYWlsZWQg\nIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBzbS5hZnRlclJl\nZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgc20ubG9hZChfZmMs\nIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbm93IGludm9rZSBwb3N0UmVmcmVz\naCBvbiBhbGwgdGhlIGluc3RhbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yPD8+IGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKGl0ci5uZXh0KCksIHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmICFzbS5pc0Rl\ndGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVMaWZlY3lj\nbGVFdmVudChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVsbCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE1ldGFEYXRhKCksIExpZmVj\neWNsZUV2ZW50LkFGVEVSX1JFRlJFU0gpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAg\nICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgICAg\nIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE9wdGltaXphdGlvbiBmb3Igc2luZ2xlLW9iamVj\ndCByZWZyZXNoLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZWZyZXNo\nSW50ZXJuYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlm\nICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9i\naiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAg\nICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNt\nLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdE\nZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAgICAgICAgICAg\nICAgICBlbHNlIGlmIChzbS5iZWZvcmVSZWZyZXNoKGZhbHNlKSkgewogICAg\nICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBs\nLkxPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICAgICAgc20uYWZ0ZXJSZWZyZXNoKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBpbnQgbGV2ZWwgPSBfZmMuZ2V0UmVhZExvY2tMZXZl\nbCgpOwogICAgICAgICAgICAgICAgaW50IHRpbWVvdXQgPSBfZmMuZ2V0TG9j\na1RpbWVvdXQoKTsKICAgICAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZl\nbCwgdGltZW91dCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgc20u\ncmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOwogICAgICAgICAgICAgICAgZmly\nZUxpZmVjeWNsZUV2ZW50KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxs\nLAogICAgICAgICAgICAgICAgICAgIHNtLmdldE1ldGFEYXRhKCksIExpZmVj\neWNsZUV2ZW50LkFGVEVSX1JFRlJFU0gpOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hl\nZCgpCiAgICAgICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZy\nZXNoIik7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIAog\nICAgcHVibGljIHZvaWQgcmV0cmlldmVBbGwoQ29sbGVjdGlvbiBvYmpzLCBi\nb29sZWFuIGRmZ09ubHksCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0g\nMSkgewogICAgICAgICAgICByZXRyaWV2ZShvYmpzLml0ZXJhdG9yKCkubmV4\ndCgpLCBkZmdPbmx5LCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgTGlzdDxFeGNlcHRpb24+IGV4Y2VwcyA9IG51bGw7\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnRO\nb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVj\ndCBhbGwgaG9sbG93IGluc3RhbmNlcyBmb3IgbG9hZAogICAgICAgICAgICBP\nYmplY3Qgb2JqOwogICAgICAgICAgICBDb2xsZWN0aW9uPE9wZW5KUEFTdGF0\nZU1hbmFnZXI+IGxvYWQgPSBudWxsOwogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIHNtOwogICAgICAgICAgICBDb2xsZWN0aW9uPFN0YXRlTWFuYWdl\nckltcGw+IHNtcyA9IG5ldyBBcnJheUxpc3Q8U3RhdGVNYW5hZ2VySW1wbD4o\nb2Jqcy5zaXplKCkpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0\nciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBz\nbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5P\nUF9SRVRSSUVWRSwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJldHJpZXZlIik7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc1BlcnNpc3RlbnQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc21zLmFkZChzbSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uZ2V0UENTdGF0\nZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3Q8T3Bl\nbkpQQVN0YXRlTWFuYWdlcj4oKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShv\nYmopLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgID09\nIEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAg\nICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGxv\nYWQgYWxsIGhvbGxvdyBpbnN0YW5jZXMKICAgICAgICAgICAgQ29sbGVjdGlv\nbjxPYmplY3Q+IGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChsb2Fk\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09u\nbHkpID8gU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfREZHCiAgICAgICAgICAg\nICAgICAgICAgOiBTdG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9BTEw7CiAgICAg\nICAgICAgICAgICBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxs\nLCBtb2RlLCBfZmMsIG51bGwpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxl\nZCAhPSBudWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIG5ld09iamVjdE5vdEZvdW5k\nRXhjZXB0aW9uKGZhaWxlZCkpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyByZXRyaWV2ZSBhbGwgbm9uLWZhaWxlZCBpbnN0YW5jZXMKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBz\nbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIHNtID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChmYWls\nZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAg\naW50IG1vZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1hbmFnZXJJbXBsLkxPQURf\nRkdTCiAgICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJbXBsLkxP\nQURfQUxMOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAgICAgICAgICAgICAgICAgICBz\nbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMs\nIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXRyaWV2ZShPYmpl\nY3Qgb2JqLCBib29sZWFuIGRmZ09ubHksIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnRO\nb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAm\nIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2\nZSIpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBT\ndGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTCiAgICAgICAgICAgICAgICAgICAg\nICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICAgICAg\nICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAgICAgICAgICAgICAgICAg\nICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBl\ncnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAgICAgICAg\nICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2\naWN0QWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gZXZp\nY3QgYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9iamVjdHMKICAgICAgICAg\nICAgQ29sbGVjdGlvbjxTdGF0ZU1hbmFnZXJJbXBsPiBjID0gZ2V0TWFuYWdl\nZFN0YXRlcygpOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPFN0YXRlTWFuYWdlckltcGw+IGl0\nciA9IGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHNtID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChz\nbS5pc1BlcnNpc3RlbnQoKSAmJiAhc20uaXNEaXJ0eSgpKQogICAgICAgICAg\nICAgICAgICAgIGV2aWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBjYWxs\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKENvbGxlY3Rpb24gb2JqcywgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNl\ncHMgPSBudWxsOwogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9\nIG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZXZpY3QoaXRyLm5l\neHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhj\nZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhl\neGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdEFs\nbChFeHRlbnQgZXh0ZW50LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKGV4dGVudCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQTm9uVHJhbnMgb2Jq\nZWN0cyBpbiBleHRlbnQKICAgICAgICAgICAgQ29sbGVjdGlvbjxTdGF0ZU1h\nbmFnZXJJbXBsPiBjID0gZ2V0TWFuYWdlZFN0YXRlcygpOwogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBDbGFzczw/PiBj\nbHM7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8U3RhdGVNYW5hZ2VySW1w\nbD4gaXRyID0gYy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgc20gPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkpIHsKICAg\nICAgICAgICAgICAgICAgICBjbHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2xzID09\nIGV4dGVudC5nZXRFbGVtZW50VHlwZSgpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHx8IChleHRlbnQuaGFzU3ViY2xhc3NlcygpCiAgICAgICAgICAgICAg\nICAgICAgICAgICYmIGV4dGVudC5nZXRFbGVtZW50VHlwZSgpLmlzQXNzaWdu\nYWJsZUZyb20oY2xzKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGV2aWN0\nKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBjYWxsKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBldmljdChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHBy\nb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9FVklDVCwgb2JqLCBzbSwg\nY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikg\nPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYg\nKHNtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAg\nICAgICBzbS5ldmljdCgpOwogICAgICAgICAgICBpZiAoX2V2aWN0RGF0YUNh\nY2hlICYmIHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgRGF0YUNhY2hlIGNhY2hlID0gX2NvbmYuZ2V0RGF0YUNhY2hlTWFu\nYWdlckluc3RhbmNlKCkuc2VsZWN0Q2FjaGUoc20pOwogICAgICAgICAgICAg\nICAgaWYgKGNhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY2Fj\naGUucmVtb3ZlKHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGRldGFjaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAg\nICBjYWxsID0gX2NhbGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNo\nTWFuYWdlcih0aGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoKG9iaik7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdFtd\nIGRldGFjaEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybiBFTVBUWV9PQkpFQ1RTOwogICAgICAgIGlmIChjYWxsID09\nIG51bGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNlLCBjYWxsKS5k\nZXRhY2hBbGwob2Jqcyk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBkZXRhY2hBbGwoY2FsbCwgdHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwsIGJvb2xl\nYW4gZmx1c2gpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBJZiBhIGZsdXNoIGlzIGRlc2ly\nZWQgKGJhc2VkIG9uIGlucHV0IHBhcm0pLCB0aGVuIGNoZWNrIGlmIHRoZQog\nICAgICAgICAgICAvLyAiZGlydHkiIGZsYWcgaXMgc2V0IGJlZm9yZSBjYWxs\naW5nIGZsdXNoKCkuCiAgICAgICAgICAgIGlmIChmbHVzaCAmJiAoX2ZsYWdz\nICYgRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0gMCkKICAgICAgICAgICAgICAg\nIGZsdXNoKCk7CiAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKGNhbGwp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBkZXRhY2hBbGxJbnRlcm5hbChPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYoX2NvbmYuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLmdldExp\ndGVBdXRvRGV0YWNoKCkgPT0gdHJ1ZSl7CiAgICAgICAgICAgIGRldGFjaEFs\nbEludGVybmFsTGl0ZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIENvbGxlY3Rpb248U3RhdGVNYW5hZ2VySW1wbD4gc3RhdGVz\nID0gZ2V0TWFuYWdlZFN0YXRlcygpOwogICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc207CiAgICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBs\nPiBpdHIgPSBzdGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgc20gPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAgaXRyLnJlbW92\nZSgpOwogICAgICAgICAgICBlbHNlIGlmICghc20uZ2V0TWV0YURhdGEoKS5p\nc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICAgICAgc20ucmVsZWFzZSh0\ncnVlKTsgCiAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGNhbGwgPT0gbnVs\nbCkKICAgICAgICAgICAgY2FsbCA9IF9jYWxsOwogICAgICAgIC8vIE1ha2Ug\nc3VyZSBBTEwgZW50aXRpZXMgYXJlIGRldGFjaGVkLCBldmVuIG5ldyBvbmVz\nIHRoYXQgYXJlIGxvYWRlZAogICAgICAgIC8vIGR1cmluZyB0aGUgZGV0YWNo\nIHByb2Nlc3NpbmcKICAgICAgICBib29sZWFuIG9yaWdDYXNjYWRlID0gX2Nv\nbXBhdC5nZXRDYXNjYWRlV2l0aERldGFjaCgpOwogICAgICAgIF9jb21wYXQu\nc2V0Q2FzY2FkZVdpdGhEZXRhY2godHJ1ZSk7ICAgICAgICAKICAgICAgICB0\ncnkgewogICAgICAgICAgICBuZXcgRGV0YWNoTWFuYWdlcih0aGlzLCB0cnVl\nLCBjYWxsKQogICAgICAgICAgICAgICAgLmRldGFjaEFsbChuZXcgTWFuYWdl\nZE9iamVjdENvbGxlY3Rpb24oc3RhdGVzKSk7CiAgICAgICAgfSAKICAgICAg\nICBmaW5hbGx5IHsKICAgICAgICAgICAgX2NvbXBhdC5zZXRDYXNjYWRlV2l0\naERldGFjaChvcmlnQ2FzY2FkZSk7CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBkZXRhY2hBbGxJbnRlcm5hbExpdGUoKSB7CiAgICAgICAg\nTWFuYWdlZENhY2hlIG9sZCA9IF9jYWNoZTsKICAgICAgICBfY2FjaGUgPSBu\nZXcgTWFuYWdlZENhY2hlKHRoaXMpOwogICAgICAgIC8vIFRPRE8gOiBzaG91\nbGQgSSBjYWxsIGNsZWFyIG9uIG9sZCBjYWNoZSBmaXJzdD8gcGVyaGFwcyBh\nIG1lbW9yeSBsZWFrPwogICAgICAgIENvbGxlY3Rpb248U3RhdGVNYW5hZ2Vy\nSW1wbD4gc3RhdGVzID0gb2xkLmNvcHkoKTsKICAgICAgICAKICAgICAgICAv\nLyBDbGVhciBvdXQgYWxsIHBlcnNpc3RlbmNlIGNvbnRleHQgY2FjaGVzLiAg\nICAgICAgCiAgICAgICAgaWYgKF90cmFuc0NhY2hlICE9IG51bGwpIHsKICAg\nICAgICAgICAgX3RyYW5zQ2FjaGUuY2xlYXIoKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKF90cmFuc0FkZGl0aW9ucyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIF90cmFuc0FkZGl0aW9ucy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBp\nZiAoX2RtTGl0ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIF9kbUxpdGUgPSBu\nZXcgRGV0YWNoTWFuYWdlckxpdGUoKTsKICAgICAgICB9CiAgICAgICAgX2Rt\nTGl0ZS5kZXRhY2hBbGwoc3RhdGVzKTsKICAgIH0KICAgIHB1YmxpYyBPYmpl\nY3QgYXR0YWNoKE9iamVjdCBvYmosIGJvb2xlYW4gY29weU5ldywgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRy\ndWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBu\nb3QgdG8gdHJ5IHRvIHNldCByb2xsYmFjayBvbmx5IGlmIHRoaXMgZmFpbHMK\nICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNoTWFu\nYWdlcih0aGlzLCBjb3B5TmV3LCBjYWxsKS5hdHRhY2gob2JqKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkgewogICAg\nICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG9lKTsKICAgICAgICAgICAg\nICAgIHRocm93IG9lLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIE9iamVjdFtdIGF0dGFjaEFsbChDb2xsZWN0\naW9uIG9ianMsIGJvb2xlYW4gY29weU5ldywKICAgICAgICBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfT0JKRUNUUzsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8gc2V0IHJvbGxiYWNrIG9ubHkg\naWYgdGhpcyBmYWlscwogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlv\nbigpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBBdHRhY2hNYW5hZ2VyKHRoaXMsIGNvcHlOZXcsIGNhbGwpLmF0dGFj\naEFsbChvYmpzKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3B0aW1pc3RpY0V4\nY2VwdGlvbiBvZSkgewogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5\nKG9lKTsKICAgICAgICAgICAgICAgIHRocm93IG9lLnNldEZhdGFsKHRydWUp\nOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9u\ndHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0g\nbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBvYmpz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIG5vbnRyYW5zYWN0aW9uYWwo\naXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChV\nc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNl\ncHMsIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgbm9udHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRT\ndGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgo\ncHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX05PTlRSQU5TQUNUSU9O\nQUwsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJh\nY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgc20u\nbm9udHJhbnNhY3Rpb25hbCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2Vz\nIHRyYW5zYWN0aW9uYWwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRyYW5z\nYWN0aW9uYWxBbGwoQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIHVwZGF0ZVZl\ncnNpb24sCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgIHRyYW5zYWN0\naW9uYWwob2Jqcy5pdGVyYXRvcigpLm5leHQoKSwgdXBkYXRlVmVyc2lvbiwg\nY2FsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGNvbGxlY3QgYWxsIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQs\nIGFuZCBtYWtlIHVubWFuYW5nZWQKICAgICAgICAgICAgLy8gaW5zdGFuY2Vz\nIHRyYW5zaWVudC10cmFuc2FjdGlvbmFsCiAgICAgICAgICAgIENvbGxlY3Rp\nb248T3BlbkpQQVN0YXRlTWFuYWdlcj4gbG9hZCA9IG51bGw7CiAgICAgICAg\nICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICAg\nICAgQ29sbGVjdGlvbjxTdGF0ZU1hbmFnZXJJbXBsPiBzbXMgPSBuZXcgTGlu\na2VkSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPihvYmpzLnNpemUoKSk7CiAg\nICAgICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMgPSBudWxsOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKHBy\nb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9UUkFOU0FDVElPTkFMLCBv\nYmosIHNtLAogICAgICAgICAgICAgICAgICAgICAgICBjYWxsKSAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNp\nZW50IGluc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEgPSBf\nY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEob2JqLmdldENsYXNz\nKCksIF9sb2FkZXIsIHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAg\nc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAoU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhpcyksIG1l\ndGEpOwogICAgICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFz\nc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgUENTdGF0ZS5UQ0xFQU4pOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgc21zLmFkZChzbSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5I\nT0xMT1cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2Fk\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9h\nZCA9IG5ldyBBcnJheUxpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4oKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uc2V0Q2hlY2tWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnNldFVwZGF0ZVZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNIX1JFUVVJUkVEOyAv\nLyB2ZXJzaW9uIGNoZWNrL3VwCiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKFVzZXJFeGNl\ncHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGxvYWQgYWxsIGhvbGxvdyBpbnN0YW5jZXMKICAg\nICAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IGZhaWxlZCA9IG51bGw7CiAg\nICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIFN0b3JlTWFu\nYWdlci5GT1JDRV9MT0FEX05PTkUsCiAgICAgICAgICAgICAgICAgICAgX2Zj\nLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAm\nJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAgICAgICAgICAgICAgICBuZXdP\nYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbFN0YXRlc0FsbChzbXMsIGZh\naWxlZCwgZXhjZXBzKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVuIGluc3RhbmNlcyB0cmFu\nc2FjdGlvbmFsLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlv\nbmFsKE9iamVjdCBvYmosIGJvb2xlYW4gdXBkYXRlVmVyc2lvbiwKICAgICAg\nICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAg\nICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAg\nICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAg\nICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5p\nc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9u\nYWwoKTsKICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFn\nZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICBzbS5zZXRDaGVja1ZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAg\nICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAgICAgICAgICAgICAgICAgICBz\nbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hlY2sv\ndXAKICAgICAgICAgICAgfSBlbHNlIGlmIChzbSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNpZW50IGluc3RhbmNlCiAgICAg\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRh\nRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAg\nIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsK\nICAgICAgICAgICAgICAgIE9iamVjdCBpZCA9IFN0YXRlTWFuYWdlcklkLm5l\nd0luc3RhbmNlKHRoaXMpOwogICAgICAgICAgICAgICAgc20gPSBuZXdTdGF0\nZU1hbmFnZXJJbXBsKGlkLCBtZXRhKTsKICAgICAgICAgICAgICAgIHNtLmlu\naXRpYWxpemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAgICAg\nICAgICAgICAgICAgICAgUENTdGF0ZS5UQ0xFQU4pOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRyYW5zaXRpb24gdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXJz\nIHRvIHRyYW5zYWN0aW9uYWwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0\ncmFuc2FjdGlvbmFsU3RhdGVzQWxsKENvbGxlY3Rpb24gc21zLCBDb2xsZWN0\naW9uIGZhaWxlZCwKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzKSB7\nCiAgICAgICAgLy8gbWFrZSBpbnN0YW5jZXMgdHJhbnNhY3Rpb25hbCBhbmQg\nbWFrZSBzdXJlIHRoZXkgYXJlIGxvYWRlZAogICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc207CiAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBzbXMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgc20g\nPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\naWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJ\nZCgpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAg\nICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxP\nQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIGV4\nY2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxz\nZSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEV4dGVu\ndCwgUXVlcnkKICAgIC8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEV4\ndGVudCBuZXdFeHRlbnQoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2Vz\nKSB7CiAgICAgICAgcmV0dXJuIG5ld0V4dGVudCh0eXBlLCBzdWJjbGFzc2Vz\nLCBudWxsKTsKICAgIH0KCiAgICBwcml2YXRlIEV4dGVudCBuZXdFeHRlbnQo\nQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2VzLAogICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEV4dGVudEltcGwg\nZXh0ZW50ID0gbmV3IEV4dGVudEltcGwodGhpcywgdHlwZSwgc3ViY2xhc3Nl\ncywgZmV0Y2gpOwogICAgICAgICAgICBpZiAoX2V4dGVudHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9leHRlbnRzID0gbmV3IFJlZmVyZW5jZUhhc2hT\nZXQoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsKICAgICAgICAgICAgX2V4dGVu\ndHMuYWRkKGV4dGVudCk7CgogICAgICAgICAgICByZXR1cm4gZXh0ZW50Owog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBJdGVy\nYXRvciBleHRlbnRJdGVyYXRvcihDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNs\nYXNzZXMsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29s\nZWFuIGlnbm9yZUNoYW5nZXMpIHsKICAgICAgICBFeHRlbnQgZXh0ZW50ID0g\nbmV3RXh0ZW50KHR5cGUsIHN1YmNsYXNzZXMsIGZldGNoKTsKICAgICAgICBl\neHRlbnQuc2V0SWdub3JlQ2hhbmdlcyhpZ25vcmVDaGFuZ2VzKTsKICAgICAg\nICByZXR1cm4gZXh0ZW50Lml0ZXJhdG9yKCk7CiAgICB9CgogICAgcHVibGlj\nIFF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5nLCBDbGFzcyBjbHMsIE9iamVj\ndCBxdWVyeSkgewogICAgICAgIFF1ZXJ5IHEgPSBuZXdRdWVyeShsYW5nLCBx\ndWVyeSk7CiAgICAgICAgcS5zZXRDYW5kaWRhdGVUeXBlKGNscywgdHJ1ZSk7\nCiAgICAgICAgcmV0dXJuIHE7CiAgICB9CgogICAgcHVibGljIFF1ZXJ5IG5l\nd1F1ZXJ5KFN0cmluZyBsYW5nLCBPYmplY3QgcXVlcnkpIHsKICAgICAgICAv\nLyBjb21tb24gbWlzdGFrZXMKICAgICAgICBpZiAocXVlcnkgaW5zdGFuY2Vv\nZiBFeHRlbnQgfHwgcXVlcnkgaW5zdGFuY2VvZiBDbGFzcykKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1uZXct\ncXVlcnkiKSk7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBTdG9yZVF1ZXJ5IHNxID0gX3N0b3Jl\nLm5ld1F1ZXJ5KGxhbmcpOwogICAgICAgICAgICBpZiAoc3EgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgRXhwcmVzc2lvblBhcnNlciBlcCA9IFF1ZXJ5\nTGFuZ3VhZ2VzLnBhcnNlckZvckxhbmd1YWdlKGxhbmcpOwogICAgICAgICAg\nICAgICAgaWYgKGVwICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc3Eg\nPSBuZXcgRXhwcmVzc2lvblN0b3JlUXVlcnkoZXApOwogICAgICAgICAgICAg\nICAgZWxzZSBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19NRVRIT0RRTC5lcXVh\nbHMobGFuZykpCiAgICAgICAgICAgICAgICAgICAgc3EgPSBuZXcgTWV0aG9k\nU3RvcmVRdWVyeSgpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihsYW5n\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgUXVlcnkgcSA9IG5ld1F1\nZXJ5SW1wbChsYW5nLCBzcSk7CiAgICAgICAgICAgIHEuc2V0SWdub3JlQ2hh\nbmdlcyhfaWdub3JlQ2hhbmdlcyk7CiAgICAgICAgICAgIGlmIChxdWVyeSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcS5zZXRRdWVyeShxdWVyeSk7Cgog\nICAgICAgICAgICAvLyB0cmFjayBxdWVyaWVzCiAgICAgICAgICAgIGlmIChf\ncXVlcmllcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3F1ZXJpZXMgPSBu\nZXcgUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwog\nICAgICAgICAgICBfcXVlcmllcy5hZGQocSk7CiAgICAgICAgICAgIHJldHVy\nbiBxOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHF1ZXJ5LgogICAgICovCiAgICBwcm90ZWN0\nZWQgUXVlcnlJbXBsIG5ld1F1ZXJ5SW1wbChTdHJpbmcgbGFuZywgU3RvcmVR\ndWVyeSBzcSkgewogICAgICAgIHJldHVybiBuZXcgUXVlcnlJbXBsKHRoaXMs\nIGxhbmcsIHNxKTsKICAgIH0KCiAgICBwdWJsaWMgU2VxIGdldElkZW50aXR5\nU2VxdWVuY2UoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1l\ndGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\ncmV0dXJuIGdldFNlcXVlbmNlKG1ldGEsIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5jZShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlKGZtZC5nZXREZWZp\nbmluZ01ldGFEYXRhKCksIGZtZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBzZXF1ZW5jZSBmb3IgdGhlIGdpdmVuIGNsYXNzIGFuZCBvcHRp\nb25hbCBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBTZXEgZ2V0U2VxdWVu\nY2UoQ2xhc3NNZXRhRGF0YSBtZXRhLCBGaWVsZE1ldGFEYXRhIGZtZCkgewog\nICAgICAgIC8vIGdldCBzZXF1ZW5jZSBzdHJhdGVneSBmcm9tIG1ldGFkYXRh\nCiAgICAgICAgaW50IHN0cmF0ZWd5OwogICAgICAgIGlmIChmbWQgPT0gbnVs\nbCkKICAgICAgICAgICAgc3RyYXRlZ3kgPSBtZXRhLmdldElkZW50aXR5U3Ry\nYXRlZ3koKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0cmF0ZWd5ID0g\nZm1kLmdldFZhbHVlU3RyYXRlZ3koKTsKCiAgICAgICAgLy8gd2UgY2FuIGhh\nbmRsZSBub24tbmF0aXZlIHN0cmF0ZWdpZXMgd2l0aG91dCB0aGUgc3RvcmUg\nbWFuYWdlcgogICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgICAg\nICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9IRVg6CiAgICAgICAgICAg\nICAgICByZXR1cm4gVVVJREhleFNlcS5nZXRJbnN0YW5jZSgpOwogICAgICAg\nICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX1NUUklORzoKICAgICAg\nICAgICAgICAgIHJldHVybiBVVUlEU3RyaW5nU2VxLmdldEluc3RhbmNlKCk7\nCiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfVFlQRTRf\nSEVYOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURUeXBlNEhleFNlcS5n\nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2ll\ncy5VVUlEX1RZUEU0X1NUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBV\nVUlEVHlwZTRTdHJpbmdTZXEuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAg\nY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0U6CiAgICAgICAgICAgICAg\nICBTZXF1ZW5jZU1ldGFEYXRhIHNtZCA9IChmbWQgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICA/IG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFE\nYXRhKCkKICAgICAgICAgICAgICAgICAgICA6IGZtZC5nZXRWYWx1ZVNlcXVl\nbmNlTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHJldHVybiBzbWQuZ2V0\nSW5zdGFuY2UoX2xvYWRlcik7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAvLyB1c2Ugc3RvcmUgbWFuYWdlciBmb3IgbmF0aXZlIHNl\ncXVlbmNlCiAgICAgICAgICAgICAgICBpZiAoZm1kID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIGEgc2VxdWVu\nY2UgZXZlbiBmb3IgYXBwIGlkIGNsYXNzZXMsCiAgICAgICAgICAgICAgICAg\nICAgLy8gd2hpY2ggaXMgd2hhdCB3ZSB3YW50IGZvciBiYWNrd2FyZHMtY29t\ncGF0aWJpbGl0eS4KICAgICAgICAgICAgICAgICAgICAvLyBFdmVuIGlmIHVz\nZXIgdXNlcyBBcHBsaWNhdGlvbiBJZGVudGl0eSwKICAgICAgICAgICAgICAg\nICAgICAvLyB1c2VyIG1pZ2h0IHVzZSBjdXN0b20gc2VxdWVuY2UgaW5mb3Jt\nYXRpb24uCiAgICAgICAgICAgICAgICAgICAgLy8gU28sIGZpcnN0LCB0aGUg\nc2VxdWVuY2Ugc2hvdWxkIGJlIGNoZWNrZWQuCiAgICAgICAgICAgICAgICAg\nICAgLy8gVHJ5aW5nIHRvIGdldCBwcmltYXJ5IGtleSBmaWVsZCBpZiBpdCBo\nYXMKICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBtZXRhIGRhdGEu\nCiAgICAgICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IG1l\ndGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChwa3MgIT0gbnVsbCAmJiBwa3MubGVuZ3RoID09IDEpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgc21kID0gcGtzWzBdLmdldFZhbHVlU2VxdWVu\nY2VNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHNtZCA9IG1ldGEuZ2V0SWRlbnRpdHlT\nZXF1ZW5jZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgICAgICBpZiAoc21kICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHNtZC5nZXRJbnN0YW5jZShfbG9hZGVy\nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdldERhdGFTdG9yZUlkU2VxdWVu\nY2UobWV0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5nZXRWYWx1ZVNl\ncXVlbmNlKGZtZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8v\nCiAgICAvLyBMb2NraW5nCiAgICAvLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2\nb2lkIGxvY2soT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsgLy8gaGF2ZSB0byBzeW5jIG9y\nIGxvY2sgbGV2ZWwgYWx3YXlzIE5PTkUKICAgICAgICB0cnkgewogICAgICAg\nICAgICBsb2NrKG9iaiwgX2ZjLmdldFdyaXRlTG9ja0xldmVsKCksIF9mYy5n\nZXRMb2NrVGltZW91dCgpLCBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgbG9jayhPYmplY3Qgb2JqLCBpbnQgbGV2ZWwsIGlu\ndCB0aW1lb3V0LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9i\naiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUp\nOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNr\ncy5PUF9MT0NLLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBP\ncENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCAhc20uaXNQZXJz\naXN0ZW50KCkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAg\nICBfbG0ubG9jayhzbSwgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwogICAgICAg\nICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBsZXZlbCk7IC8vIHVzZSBzYW1l\nIGxldmVsIGZvciBmdXR1cmUgd3JpdGUKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrQWxsKENvbGxlY3Rpb24g\nb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsgLy8gaGF2ZSB0byBzeW5jIG9yIGxvY2sgbGV2ZWwg\nYWx3YXlzIE5PTkUKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2NrQWxs\nKG9ianMsIF9mYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9ja1Rp\nbWVvdXQoKSwKICAgICAgICAgICAgICAgIGNhbGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrQWxsKENvbGxlY3Rpb24gb2Jq\ncywgaW50IGxldmVsLCBpbnQgdGltZW91dCwKICAgICAgICBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgaWYgKG9ianMuc2l6ZSgpID09IDEpIHsK\nICAgICAgICAgICAgbG9jayhvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCBsZXZl\nbCwgdGltZW91dCwgY2FsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7Cgog\nICAgICAgICAgICBDb2xsZWN0aW9uPFN0YXRlTWFuYWdlckltcGw+IHNtcyA9\nIG5ldyBMaW5rZWRIYXNoU2V0PFN0YXRlTWFuYWdlckltcGw+KG9ianMuc2l6\nZSgpKTsKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/\nPiBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJn\ndW1lbnQoT3BDYWxsYmFja3MuT1BfTE9DSywgb2JqLCBzbSwgY2FsbCkKICAg\nICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAg\nICBpZiAoc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAg\nICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgX2xtLmxvY2tBbGwoc21zLCBsZXZlbCwgdGltZW91dCwgbnVs\nbCk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8U3RhdGVNYW5hZ2VySW1w\nbD4gaXRyID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgaXRyLm5leHQoKS5yZWFkTG9ja2VkKGxldmVsLCBsZXZl\nbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIENvbm5lY3Rpb24KICAgIC8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxsKCkgewogICAgICAgIC8v\nIHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2ssIHNpbmNlIHdlIHdhbnQgdG8g\nYWxsb3cgYSBkaWZmZXJlbnQKICAgICAgICAvLyB0aHJlYWQgdG8gYmUgYWJs\nZSB0byBjYW5jZWwgb24gYSBsb2NrZWQtdXAgcGVyc2lzdGVuY2UgbWFuYWdl\ncgoKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gaWYgd2UncmUgZmx1c2hpbmcsIGhhdmUgdG8gc2V0IHJvbGxi\nYWNrIG9ubHkgLS0gZG8gdGhpcyBiZWZvcmUgd2UKICAgICAgICAgICAgLy8g\nYXR0ZW1wdCB0byBjYW5jZWwsIGJlY2F1c2Ugb3RoZXJ3aXNlIHRoZSBjYW5j\nZWwgbWlnaHQgY2FzZSB0aGUKICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb24g\ndG8gY29tcGxldGUgYmVmb3JlIHdlIGhhdmUgYSBjaGFuY2UgdG8gc2V0IHRo\nZQogICAgICAgICAgICAvLyByb2xsYmFjayBvbmx5IGZsYWcKICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0ZMVVNISU5HKSAhPSAwKQog\nICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwobmV3IFVz\nZXJFeGNlcHRpb24oKSk7CiAgICAgICAgICAgIHJldHVybiBfc3RvcmUuY2Fu\nY2VsQWxsKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29u\ndGFpbnMKICAgICAgICAgICAgKE9wZW5KUEFDb25maWd1cmF0aW9uLk9QVElP\nTl9EQVRBU1RPUkVfQ09OTkVDVElPTikpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiY29ubi1ub3Qtc3Vw\ncG9ydGVkIikpOwoKICAgICAgICByZXR1cm4gX3N0b3JlLmdldENsaWVudENv\nbm5lY3Rpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNDb25u\nZWN0aW9uKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1\ncm4gKF9mbGFncyAmIEZMQUdfUkVUQUlORURfQ09OTikgIT0gMDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmV0YWluIGNvbm5lY3Rp\nb24gaWYgd2UgaGF2ZW4ndCBhbHJlYWR5LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmV0YWluQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfUkVUQUlORURfQ09OTikgPT0gMCkgewogICAgICAgICAgICBf\nc3RvcmUucmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmVsZWFzZSBjb25uZWN0aW9uIGlm\nIHdlIGhhdmUgcmV0YWluZWQgb25lLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVsZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1JFVEFJTkVEX0NPTk4pICE9IDApIHsKICAgICAgICAgICAgX3N0\nb3JlLnJlbGVhc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAv\nLy8vLy8vLy8KICAgIC8vIENhY2hlCiAgICAvLy8vLy8vLy8KCiAgICBwdWJs\naWMgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkT2JqZWN0cygpIHsKICAgICAgICBi\nZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRNYW5h\nZ2VkU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbiBnZXRUcmFuc2FjdGlvbmFsT2JqZWN0cygpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRU\ncmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbE9i\namVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVj\ndENvbGxlY3Rpb24KICAgICAgICAgICAgICAgIChnZXRQZW5kaW5nVHJhbnNh\nY3Rpb25hbFN0YXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENvbGxlY3Rpb24gZ2V0RGlydHlPYmplY3RzKCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdldERpcnR5\nU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBnZXRPcmRlckRpcnR5T2JqZWN0cygpIHsKICAgICAgICByZXR1cm4g\nX29yZGVyRGlydHk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T3JkZXJE\naXJ0eU9iamVjdHMoYm9vbGVhbiBvcmRlcikgewogICAgICAgIF9vcmRlckRp\ncnR5ID0gb3JkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBj\nb3B5IG9mIGFsbCBtYW5hZ2VkIHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkU3RhdGVzKCkgewog\nICAgICAgIHJldHVybiBfY2FjaGUuY29weSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0\nZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb248\nU3RhdGVNYW5hZ2VySW1wbD4gZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpIHsK\nICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAg\ncmV0dXJuIF90cmFuc0NhY2hlLmNvcHkoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgb3Igbm90IHRoZXJlIGFyZSBhbnkgdHJhbnNhY3Rpb25h\nbCBvYmplY3RzIGluIHRoZSBjdXJyZW50CiAgICAgKiBwZXJzaXN0ZW5jZSBj\nb250ZXh0LiBJZiB0aGVyZSBhcmUgYW55IGluc3RhbmNlcyB3aXRoIHVudHJh\nY2tlZCBzdGF0ZSwKICAgICAqIHRoaXMgbWV0aG9kIHdpbGwgY2F1c2UgdGhv\nc2UgaW5zdGFuY2VzIHRvIGJlIHNjYW5uZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpIHsKICAgICAg\nICBfY2FjaGUuZGlydHlDaGVjaygpOwogICAgICAgIHJldHVybiBfdHJhbnND\nYWNoZSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nY29weSBvZiBhbGwgZGlydHkgc3RhdGUgbWFuYWdlcnMuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldERpcnR5U3RhdGVzKCkgewogICAg\nICAgIGlmICghaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkKICAgICAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKCiAgICAgICAgcmV0\ndXJuIF90cmFuc0NhY2hlLmNvcHlEaXJ0eSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgc3RhdGUgbWFuYWdlcnMgd2hp\nY2ggd2lsbCBiZWNvbWUKICAgICAqIHRyYW5zYWN0aW9uYWwgdXBvbiB0aGUg\nbmV4dCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxl\nY3Rpb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxTdGF0ZXMoKSB7CiAgICAg\nICAgaWYgKF9wZW5kaW5nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgcmV0dXJuIG5ldyBMaW5r\nZWRIYXNoU2V0PFN0YXRlTWFuYWdlckltcGw+KF9wZW5kaW5nKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGVkIFN0YXRlTWFuYWdlciBm\nb3IgdGhlIGluc3RhbmNlIHRoYXQgaGFkIHRoZSBnaXZlbiBvaWQuCiAgICAg\nKiBUaGlzIG1ldGhvZCBtdXN0IG5vdCBiZSBjYWxsZWQgbXVsdGlwbGUgdGlt\nZXMgZm9yIG5ldyBpbnN0YW5jZXMuCiAgICAgKgogICAgICogQHBhcmFtIGlk\nIHRoZSBpZCBwcmV2aW91c2x5IHVzZWQgYnkgdGhlIGluc3RhbmNlCiAgICAg\nKiBAcGFyYW0gc20gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBpbnN0YW5j\nZTsgaWYgdGhlIHN0YXRlCiAgICAgKiBtYW5hZ2VyIGlzIHRyYW5zaWVudCwg\nd2UnbGwgc3RvcCBtYW5hZ2luZyB0aGUgaW5zdGFuY2U7CiAgICAgKiBpZiBp\ndCBoYXMgdXBkYXRlZCBpdHMgb2lkLCB3ZSdsbCByZS1jYWNoZSB1bmRlciB0\naGUgbmV3IG9pZAogICAgICogQHBhcmFtIHN0YXR1cyBvbmUgb2Ygb3VyIFNU\nQVRVUyBjb25zdGFudHMgZGVzY3JpYmluZyB3aHkgd2UncmUKICAgICAqIHNl\ndHRpbmcgdGhlIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgdm9pZCBzZXRT\ndGF0ZU1hbmFnZXIoT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBp\nbnQgc3RhdHVzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIFNUQVRVU19JTklUOgogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5h\nZGQoc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBTVEFUVVNfVFJBTlNJRU5UOgogICAgICAgICAgICAgICAg\nICAgIF9jYWNoZS5yZW1vdmUoaWQsIHNtKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX09JRF9BU1NJ\nR046CiAgICAgICAgICAgICAgICAgICAgYXNzaWduT2JqZWN0SWQoX2NhY2hl\nLCBpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBTVEFUVVNfQ09NTUlUX05FVzoKICAgICAgICAgICAg\nICAgICAgICBfY2FjaGUuY29tbWl0TmV3KGlkLCBzbSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBOb3RpZnkgdGhlIGJyb2tlciB0aGF0IHRoZSBnaXZlbiBzdGF0\nZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBv\nZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rp\nb24uCiAgICAgKi8KICAgIHZvaWQgYWRkVG9UcmFuc2FjdGlvbihTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgLy8gd2Ugb25seSBhZGQgY2xlYW4g\naW5zdGFuY2VzIG5vdzsgZGlydHkgaW5zdGFuY2VzIGFyZSBhZGRlZCBpbgog\nICAgICAgIC8vIHRoZSBzZXREaXJ0eSBjYWxsYmFjawogICAgICAgIGlmIChz\nbS5pc0RpcnR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghaGFzVHJhbnNh\nY3Rpb25hbE9iamVjdHMoKSkKICAgICAgICAgICAgICAgIF90cmFuc0NhY2hl\nID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZShfb3JkZXJEaXJ0eSk7CiAgICAg\nICAgICAgIF90cmFuc0NhY2hlLmFkZENsZWFuKHNtKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIHBlcnNpc3RlbmNlIG1hbmFn\nZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAq\nIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZl\nZCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgdm9p\nZCByZW1vdmVGcm9tVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoX3RyYW5zQ2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIC8vIGlu\ndGVudGlvbmFsIGRpcmVjdCBhY2Nlc3M7IHdlIGRvbid0IHdhbnQgdG8gcmVj\nb21wdXRlCiAgICAgICAgICAgICAgICAvLyBkaXJ0aW5lc3Mgd2hpbGUgcmVt\nb3ZpbmcgaW5zdGFuY2VzIGZyb20gdGhlIHRyYW5zYWN0aW9uCiAgICAgICAg\nICAgICAgICBfdHJhbnNDYWNoZS5yZW1vdmUoc20pOwogICAgICAgICAgICBp\nZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkp\nCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5yZW1vdmUoc20pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHRo\nZSBnaXZlbiBpbnN0YW5jZSBoYXMgYmVlbiBkaXJ0aWVkLiBUaGlzCiAgICAg\nKiBub3RpZmljYXRpb24gaXMgZ2l2ZW4gd2hlbiBhbiBvYmplY3QgZmlyc3Qg\ndHJhbnNpdGlvbnMgdG8gYSBkaXJ0eSBzdGF0ZSwKICAgICAqIGFuZCBldmVy\neSB0aW1lIHRoZSBvYmplY3QgaXMgbW9kaWZpZWQgYnkgdGhlIHVzZXIgdGhl\ncmVhZnRlci4KICAgICAqLwogICAgdm9pZCBzZXREaXJ0eShTdGF0ZU1hbmFn\nZXJJbXBsIHNtLCBib29sZWFuIGZpcnN0RGlydHkpIHsKICAgICAgICBpZiAo\nc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFH\nX0ZMVVNIX1JFUVVJUkVEOwoKICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0g\nbnVsbCAmJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nIGlmIChfc2F2ZXBvaW50Q2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9zYXZlcG9pbnRDYWNoZSA9IG5ldyBIYXNoU2V0PFN0YXRlTWFuYWdlcklt\ncGw+KCk7CiAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZS5hZGQoc20pOwog\nICAgICAgIH0KCiAgICAgICAgaWYgKGZpcnN0RGlydHkgJiYgc20uaXNUcmFu\nc2FjdGlvbmFsKCkpIHsKICAgICAgICAgICAgbG9jaygpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgLy8gY2FjaGUgZGlydHkgaW5zdGFu\nY2UKICAgICAgICAgICAgICAgIGlmICghaGFzVHJhbnNhY3Rpb25hbE9iamVj\ndHMoKSkKICAgICAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5ldyBU\ncmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOwogICAgICAgICAgICAg\nICAgX3RyYW5zQ2FjaGUuYWRkRGlydHkoc20pOwoKICAgICAgICAgICAgICAg\nIC8vIGFsc28gcmVjb3JkIHRoYXQgdGhlIGNsYXNzIGlzIGRpcnR5CiAgICAg\nICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG5ldyBIYXNoU2V0PENsYXNz\nPD8+PigpOwogICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLmFk\nZChzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKHNtLmlzRGVsZXRlZCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MgPSBuZXcgSGFzaFNl\ndDxDbGFzczw/Pj4oKTsKICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENs\nc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKF91cGRhdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBfdXBkYXRlZENsc3MgPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4oKTsK\nICAgICAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3MuYWRkKHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0cmFja2luZyBjaGFuZ2VzIGFu\nZCB0aGlzIGluc3RhbmNlIHdhc24ndCBhbHJlYWR5IGRpcnR5LAogICAgICAg\nICAgICAgICAgLy8gYWRkIHRvIGNoYW5nZWQgc2V0OyB3ZSB1c2UgdGhpcyBm\nb3IgZGV0ZWN0aW5nIGluc3RhbmNlcyB0aGF0CiAgICAgICAgICAgICAgICAv\nLyBlbnRlciB0aGUgdHJhbnNhY3Rpb24gZHVyaW5nIHByZSBzdG9yZQogICAg\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9\nIDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3RyYW5zQWRkaXRpb25z\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIF90cmFuc0FkZGl0\naW9ucyA9IG5ldyBIYXNoU2V0PFN0YXRlTWFuYWdlckltcGw+KCk7CiAgICAg\nICAgICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zLmFkZChzbSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgYnJva2VyIHRoYXQgdGhl\nIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSBhZGRlZCB0\nbyB0aGUgc2V0IG9mIGluc3RhbmNlcyB0aGF0IHdpbGwgYmVjb21lIHRyYW5z\nYWN0aW9uYWwKICAgICAqIG9uIHRoZSBuZXh0IHRyYW5zYWN0aW9uCiAgICAg\nKi8KICAgIHZvaWQgYWRkVG9QZW5kaW5nVHJhbnNhY3Rpb24oU3RhdGVNYW5h\nZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9wZW5kaW5nID0gbmV3IEhhc2hTZXQ8U3RhdGVNYW5hZ2VySW1wbD4o\nKTsKICAgICAgICAgICAgX3BlbmRpbmcuYWRkKHNtKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIHBlcnNpc3RlbmNlIG1hbmFn\nZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAq\nIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZl\nZCBpbiB0aGUgbmV4dCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgdm9pZCBy\nZW1vdmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwg\nc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKF9wZW5kaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfcGVu\nZGluZy5yZW1vdmUoc20pOwogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUg\nIT0gbnVsbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAg\nICBfZGVyZWZDYWNoZS5yZW1vdmUoc20pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBhIGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0\nIHRvIHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyJ3MgY2FjaGUuCiAgICAgKiBP\nbiBmbHVzaCwgdGhlc2Ugb2JqZWN0cyB3aWxsIGJlIGRlbGV0ZWQuCiAgICAg\nKi8KICAgIHZvaWQgYWRkRGVyZWZlcmVuY2VkRGVwZW5kZW50KFN0YXRlTWFu\nYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBmbHVz\naCBhbmQgaW50cm9kdWNpbmcgbW9yZSBkZXJlZnMKICAgICAgICAgICAgLy8g\ndmlhIGluc3RhbmNlIGNhbGxiYWNrcywgYWRkIHRoZW0gdG8gdGhlIHNwZWNp\nYWwgYWRkaXRpb25zIHNldAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfREVSRUZERUxFVElORykgIT0gMCkgewogICAgICAgICAgICAgICAgaWYg\nKF9kZXJlZkFkZGl0aW9ucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9kZXJlZkFkZGl0aW9ucyA9IG5ldyBIYXNoU2V0PFN0YXRlTWFuYWdlcklt\ncGw+KCk7CiAgICAgICAgICAgICAgICBfZGVyZWZBZGRpdGlvbnMuYWRkKHNt\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChf\nZGVyZWZDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9kZXJl\nZkNhY2hlID0gbmV3IEhhc2hTZXQ8U3RhdGVNYW5hZ2VySW1wbD4oKTsKICAg\nICAgICAgICAgICAgIF9kZXJlZkNhY2hlLmFkZChzbSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSB0aGUgZ2l2ZW4gcHJldmlvdXNseSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50\nIG9iamVjdCBmcm9tIHRoZQogICAgICogY2FjaGUuIEl0IGlzIG5vdyByZWZl\ncmVuY2VkLgogICAgICovCiAgICB2b2lkIHJlbW92ZURlcmVmZXJlbmNlZERl\ncGVuZGVudChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9\nIGZhbHNlOwogICAgICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZW1vdmVkID0gX2RlcmVmQWRkaXRpb25z\nLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmICghcmVtb3ZlZCAmJiAoX2Rl\ncmVmQ2FjaGUgPT0gbnVsbCB8fCAhX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKSkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3QtZGVyZWZlZCIsCiAgICAgICAgICAgICAgICAg\nICAgRXhjZXB0aW9ucy50b1N0cmluZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSkpKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpLgogICAgICAgICAgICAgICAgICAgIHNl\ndEZhdGFsKHRydWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBk\naXJ0eVR5cGUoQ2xhc3MgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3VwZGF0\nZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3Mg\nPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4oKTsKICAgICAgICAgICAgX3VwZGF0\nZWRDbHNzLmFkZChjbHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgQ29sbGVjdGlvbiBnZXRQZXJzaXN0ZWRUeXBlcygpIHsKICAgICAgICBp\nZiAoX3BlcnNpc3RlZENsc3MgPT0gbnVsbCB8fCBfcGVyc2lzdGVkQ2xzcy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBU\nWV9TRVQ7CiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJs\nZUNvbGxlY3Rpb24oX3BlcnNpc3RlZENsc3MpOwogICAgfQoKICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uIGdldFVwZGF0ZWRUeXBlcygpIHsKICAgICAgICBpZiAo\nX3VwZGF0ZWRDbHNzID09IG51bGwgfHwgX3VwZGF0ZWRDbHNzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsK\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVj\ndGlvbihfdXBkYXRlZENsc3MpOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0\naW9uIGdldERlbGV0ZWRUeXBlcygpIHsKICAgICAgICBpZiAoX2RlbGV0ZWRD\nbHNzID09IG51bGwgfHwgX2RlbGV0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICBy\nZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfZGVs\nZXRlZENsc3MpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBDbG9z\naW5nCiAgICAvLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFuIGlzQ2xv\nc2VkKCkgewogICAgICAgIHJldHVybiBfY2xvc2VkOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzQ2xvc2VJbnZva2VkKCkgewogICAgICAgIHJldHVy\nbiBfY2xvc2VkIHx8IChfZmxhZ3MgJiBGTEFHX0NMT1NFX0lOVk9LRUQpICE9\nIDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBjbG9zaW5nIGluIGFuIGFj\ndGl2ZSBsb2NhbCB0cmFucwogICAgICAgICAgICBpZiAoIV9tYW5hZ2VkICYm\nIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImFj\ndGl2ZSIpKTsKCiAgICAgICAgICAgIC8vIG9ubHkgY2xvc2UgaWYgbm90IGFj\ndGl2ZTsgaWYgYWN0aXZlIG1hbmFnZWQgdHJhbnMgd2FpdAogICAgICAgICAg\nICAvLyBmb3IgY29tcGxldGlvbgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19DTE9TRV9JTlZPS0VEOwoKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIGZyZWUoKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGcmVlIHRoZSByZXNv\ndXJjZXMgdXNlZCBieSB0aGlzIHBlcnNpc3RlbmNlIG1hbmFnZXIuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGZyZWUoKSB7CiAgICAgICAgUnVudGlt\nZUV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgIGlmICgoX2F1dG9EZXRh\nY2ggJiBERVRBQ0hfQ0xPU0UpICE9IDApIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKF9jYWxsKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIF9zeW5jID0gbnVsbDsKICAgICAgICBfdXNlck9iamVjdHMg\nPSBudWxsOwogICAgICAgIF9jYWNoZS5jbGVhcigpOwogICAgICAgIF90cmFu\nc0NhY2hlID0gbnVsbDsKICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7\nCiAgICAgICAgX3VwZGF0ZWRDbHNzID0gbnVsbDsKICAgICAgICBfZGVsZXRl\nZENsc3MgPSBudWxsOwogICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsKICAg\nICAgICBfcGVuZGluZyA9IG51bGw7CiAgICAgICAgX2xvYWRlciA9IG51bGw7\nCiAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgICAgICBf\nbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CgogICAgICAgIE9wZW5KUEFTYXZl\ncG9pbnQgc2F2ZTsKICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMgIT0gbnVs\nbCAmJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHNh\ndmUgPQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZl\ncG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAg\nICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAg\nX3NhdmVwb2ludHMgPSBudWxsOwogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9\nIG51bGw7CgogICAgICAgIGlmIChfcXVlcmllcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gX3F1ZXJpZXMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgKChRdWVyeSkgaXRyLm5leHQoKSkuY2xv\nc2VSZXNvdXJjZXMoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBfcXVlcmllcyA9IG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBpZiAoX2V4dGVudHMgIT0gbnVsbCkgewogICAgICAgICAgICBF\neHRlbnQgZTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBf\nZXh0ZW50cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgZSA9IChFeHRlbnQpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGUuY2xvc2VBbGwoKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAg\nICBfZXh0ZW50cyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB0cnkgeyBy\nZWxlYXNlQ29ubmVjdGlvbigpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7fQoKICAgICAgICBfbG0uY2xvc2UoKTsKICAgICAgICBfc3RvcmUu\nY2xvc2UoKTsKICAgICAgICBfZmxhZ3MgPSAwOwogICAgICAgIF9jbG9zZWQg\nPSB0cnVlOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIF9jbG9zZWRFeGNlcHRpb24gPSBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKCk7CgogICAgICAgIF9mYWN0b3J5LnJlbGVhc2VCcm9rZXIo\ndGhpcyk7CgogICAgICAgIGlmIChlcnIgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgZXJyOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIFN5bmNocm9uaXphdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9\nIG51bGwpIAogICAgICAgICAgICBfbG9jay5sb2NrKCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgdW5sb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBu\ndWxsKQogICAgICAgICAgICBfbG9jay51bmxvY2soKTsKICAgIH0KICAgIAog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRlIG1hbmFnZW1l\nbnQKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVj\ndCBuZXdJbnN0YW5jZShDbGFzcyBjbHMpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CgogICAgICAgIGlmICghY2xzLmlzSW50ZXJmYWNlKCkgJiYgTW9kaWZp\nZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICgibmV3LWFic3RyYWN0IiwgY2xzKS5n\nZXRNZXNzYWdlKCkpOwoKICAgICAgICAvLyAxLjUgZG9lc24ndCBpbml0aWFs\naXplIGNsYXNzZXMgd2l0aG91dCBhIHRydWUgQ2xhc3MuZm9yTmFtZQogICAg\nICAgIGlmICghUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQoY2xzKSkgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShj\nbHMuZ2V0TmFtZSgpLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY2xz\nKSkpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoX2NvbmYuZ2V0TWV0\nYURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS5nZXRNZXRhRGF0YShjbHMsCiAg\nICAgICAgICAgIGdldENsYXNzTG9hZGVyKCksIGZhbHNlKSA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgX2xvYy5nZXQoIm5vLWludGVyZmFjZS1tZXRh\nZGF0YSIsIGNscy5nZXROYW1lKCkpLmdldE1lc3NhZ2UoKSk7CgogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBQQ1JlZ2lzdHJ5Lm5ld0luc3Rh\nbmNlKGNscywgbnVsbCwgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKElsbGVn\nYWxTdGF0ZUV4Y2VwdGlvbiBpc2UpIHsKICAgICAgICAgICAgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uIGlhZSA9CiAgICAgICAgICAgICAgICBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGlzZS5nZXRNZXNzYWdlKCkpOwogICAg\nICAgICAgICBpYWUuc2V0U3RhY2tUcmFjZShpc2UuZ2V0U3RhY2tUcmFjZSgp\nKTsKICAgICAgICAgICAgdGhyb3cgaWFlOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGdldE9iamVjdElkKE9iamVjdCBvYmopIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNN\nYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkKICAgICAgICAg\nICAgICAgIC5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldExvY2tMZXZlbChPYmplY3Qg\nbykgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAobyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gTG9ja0xldmVscy5MT0NLX05PTkU7\nCgogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBnZXRTdGF0ZU1h\nbmFnZXIobyk7CiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKICAgICAgICByZXR1cm4g\nZ2V0TG9ja01hbmFnZXIoKS5nZXRMb2NrTGV2ZWwoc20pOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZ2V0VmVyc2lvbihPYmplY3Qgb2JqKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFu\nYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIu\ndG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjR2V0VmVyc2lv\nbigpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRGlydHkoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2Jq\nKSkgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBs\nSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwogICAg\nICAgICAgICByZXR1cm4gcGMucGNJc0RpcnR5KCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc1RyYW5zYWN0aW9uYWwoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2Jq\nKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVu\nY2VDYXBhYmxlKG9iaiwgX2NvbmYpKQogICAgICAgICAgICAgICAgLnBjSXNU\ncmFuc2FjdGlvbmFsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzUGVyc2lzdGVudChPYmplY3Qgb2JqKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxI\nZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLgogICAg\nICAgICAgICAgICAgICAgIHBjSXNQZXJzaXN0ZW50KCk7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTmV3KE9i\namVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYg\nKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJl\ndHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9j\nb25mKSkucGNJc05ldygpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlbGV0ZWQoT2JqZWN0IG9iaikgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5p\nc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVs\ncGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0lzRGVs\nZXRlZCgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0RldGFjaGVkKE9iamVjdCBvYmopIHsKICAgICAgICBp\nZiAoIShJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMgPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2Nv\nbmYpOwogICAgICAgIEJvb2xlYW4gZGV0YWNoZWQgPSBwYy5wY0lzRGV0YWNo\nZWQoKTsKICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGRldGFjaGVkLmJvb2xlYW5WYWx1ZSgpOwoKICAgICAgICAv\nLyBsYXN0IHJlc29ydDogaW5zdGFuY2UgaXMgZGV0YWNoZWQgaWYgaXQgaGFz\nIGEgc3RvcmUgcmVjb3JkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAg\nICAgICAgZ2V0TWV0YURhdGEoSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFu\nY2UocGMpLmdldENsYXNzKCksCiAgICAgICAgICAgICAgICBfbG9hZGVyLCB0\ncnVlKTsKICAgICAgICBPYmplY3Qgb2lkID0gQXBwbGljYXRpb25JZHMuY3Jl\nYXRlKHBjLCBtZXRhKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gZmluZChvaWQs\nIG51bGwsIEVYQ0xVREVfQUxMLCBudWxsLCAwKSAhPSBudWxsOwogICAgfQoK\nICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGdldFN0YXRlTWFuYWdl\ncihPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nIHJldHVybiBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZv\nciB0aGUgZ2l2ZW4gaW5zdGFuY2UsIG9yIG51bGwuCiAgICAgKgogICAgICog\nQHBhcmFtIGFzc2VydFRoaXNDb250ZXh0IGlmIHRydWUsIHRob3cgYW4gZXhj\nZXB0aW9uIGlmIHRoZSBnaXZlbgogICAgICogb2JqZWN0IGlzIG1hbmFnZWQg\nYnkgYW5vdGhlciBicm9rZXIKICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRl\nTWFuYWdlckltcGwgZ2V0U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2JqLAog\nICAgICAgIGJvb2xlYW4gYXNzZXJ0VGhpc0NvbnRleHQpIHsKICAgICAgICBp\nZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkgewogICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVscGVyLnRvUGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwogICAgICAgICAgICBCcm9rZXJJ\nbXBsIHBjQnJva2VyID0gKEJyb2tlckltcGwpcGMucGNHZXRHZW5lcmljQ29u\ndGV4dCgpOwogICAgICAgICAgICBpZiAocGNCcm9rZXIgPT0gdGhpcyB8fCBp\nc0Zyb21Xcml0ZUJlaGluZENhbGxiYWNrKCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gKFN0YXRlTWFuYWdlckltcGwpIHBjLnBjR2V0U3RhdGVNYW5hZ2Vy\nKCk7CiAgICAgICAgICAgIGlmIChhc3NlcnRUaGlzQ29udGV4dCAmJiBwY0Jy\nb2tlciAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2VkIiwKICAgICAgICAgICAg\nICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRP\nYmplY3Qob2JqKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIg\nZm9yIHRoZSBnaXZlbiBvaWQuCiAgICAgKgogICAgICogQHBhcmFtIGFsbG93\nTmV3IGlmIHRydWUsIG9iamVjdHMgbWFkZSBwZXJzaXN0ZW50IGluIHRoZSBj\ndXJyZW50CiAgICAgKiB0cmFuc2FjdGlvbiB3aWxsIGJlIGluY2x1ZGVkIGlu\nIHRoZSBzZWFyY2g7IGlmCiAgICAgKiBtdWx0aXBsZSBuZXcgb2JqZWN0cyBt\nYXRjaCB0aGUgZ2l2ZW4gb2lkLCBpdCBpcwogICAgICogdW5kZWZpbmVkIHdo\naWNoIHdpbGwgYmUgcmV0dXJuZWQKICAgICAqLwogICAgcHJvdGVjdGVkIFN0\nYXRlTWFuYWdlckltcGwgZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQoT2JqZWN0\nIG9pZCwKICAgICAgICBib29sZWFuIGFsbG93TmV3KSB7CiAgICAgICAgcmV0\ndXJuIF9jYWNoZS5nZXRCeUlkKG9pZCwgYWxsb3dOZXcpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBnaXZlbiBpbnN0YW5jZSBhcyBhIHtA\nbGluayBQZXJzaXN0ZW5jZUNhcGFibGV9LgogICAgICogSWYgdGhlIGluc3Rh\nbmNlIGlzIG5vdCBtYW5hZ2VhYmxlIHRocm93IHRoZSBwcm9wZXIgZXhjZXB0\naW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VDYXBhYmxl\nIGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShPYmplY3Qgb2JqKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAg\nICAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqLCBfY29uZik7CgogICAgICAgIC8vIGNoZWNrIGZvciBkaWZmZXJl\nbnQgaW5zdGFuY2VzIG9mIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW50ZXJm\nYWNlCiAgICAgICAgLy8gYW5kIHRocm93IGEgYmV0dGVyIGVycm9yIHRoYXQg\nbWVudGlvbnMgdGhlIGNsYXNzIGxvYWRlcnMKICAgICAgICBDbGFzczw/Pltd\nIGludGZzID0gb2JqLmdldENsYXNzKCkuZ2V0SW50ZXJmYWNlcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpbnRmcyAhPSBudWxsICYmIGkgPCBpbnRm\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaW50ZnNbaV0uZ2V0\nTmFtZSgpLmVxdWFscyhQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuZ2V0TmFt\nZSgpKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoInBjLWxvYWRlci1kaWZmZXJlbnQiLAogICAgICAgICAg\nICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSwKICAgICAgICAg\nICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NM\nb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MpKSwKICAgICAgICAgICAgICAgICAgICBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24o\naW50ZnNbaV0pKSkpCiAgICAgICAgICAgICAgICAgICAgLnNldEZhaWxlZE9i\namVjdChvYmopOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nLyBub3QgZW5oYW5jZWQKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgicGMtY2FzdCIsCiAgICAgICAgICAgIEV4Y2VwdGlvbnMu\ndG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQoK\nICAgIC8vLy8vLy8vLwogICAgLy8gVXRpbHMKICAgIC8vLy8vLy8vLwogICAg\nLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gaWYgdGhlIGNvbnRleHQg\naXMgY2xvc2VkLiAgVGhlIGV4YWN0IG1lc3NhZ2UgYW5kCiAgICAgKiBjb250\nZW50IG9mIHRoZSBleGNlcHRpb24gdmFyaWVzIHdoZXRoZXIgVFJBQ0UgaXMg\nZW5hYmxlZCBvciBub3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzc2Vy\ndE9wZW4oKSB7CiAgICAgICAgaWYgKF9jbG9zZWQpIHsKICAgICAgICAgICAg\naWYgKF9jbG9zZWRFeGNlcHRpb24gPT0gbnVsbCkgIC8vIFRSQUNFIG5vdCBl\nbmFibGVkCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJjbG9zZWQtbm90cmFjZSIpKQogICAgICAg\nICAgICAgICAgICAgICAgICAuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBlID0g\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAg\nICBfbG9jLmdldCgiY2xvc2VkIiksIF9jbG9zZWRFeGNlcHRpb24pLnNldEZh\ndGFsKHRydWUpOwogICAgICAgICAgICAgICAgZS5zZXRDYXVzZShfY2xvc2Vk\nRXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IE5vVHJh\nbnNhY3Rpb25FeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1hY3RpdmUiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBleGNlcHRpb24gaWYgYSB0cmFu\nc2FjdGlvbi1yZWxhdGVkIG9wZXJhdGlvbiBpcyBhdHRlbXB0ZWQgYW5kCiAg\nICAgKiBubyB0cmFuc2FjdGlvbiBpcyBhY3RpdmUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpIHsKICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtYWN0aXZlIikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2Vy\ndE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkgewogICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpID09IDAgJiYgIV9ub250cmFuc1JlYWQpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vbi10cmFucy1yZWFkIikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzc2VydFdyaXRlT3BlcmF0aW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpID09IDAgJiYgKCFfbm9udHJhbnNXcml0ZQogICAg\nICAgICAgICB8fCAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAh\nPSAwKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rpb25FeGNl\ncHRpb24oX2xvYy5nZXQoIndyaXRlLW9wZXJhdGlvbiIpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhbiBvYmplY3Qgbm90IGZvdW5kIGV4Y2Vw\ndGlvbiBjb250YWluaW5nIG5lc3RlZCBleGNlcHRpb25zCiAgICAgKiBmb3Ig\nYWxsIG9mIHRoZSBnaXZlbiBmYWlsZWQgb2JqZWN0cy4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gbmV3T2Jq\nZWN0Tm90Rm91bmRFeGNlcHRpb24KICAgICAgICAoQ29sbGVjdGlvbiBmYWls\nZWQpIHsKICAgICAgICBUaHJvd2FibGVbXSB0ID0gbmV3IFRocm93YWJsZVtm\nYWlsZWQuc2l6ZSgpXTsKICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IGZhaWxlZC5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOyBpZHgrKykKICAgICAgICAgICAgdFtpZHhdID0gbmV3IE9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uKGl0ci5uZXh0KCkpOwogICAgICAgIHJl\ndHVybiBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkLCB0KTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gRmluZENhbGxiYWNrcyBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2JqZWN0\nIHByb2Nlc3NBcmd1bWVudChPYmplY3Qgb2lkKSB7CiAgICAgICAgcmV0dXJu\nIG9pZDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NSZXR1cm4o\nT2JqZWN0IG9pZCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAg\nIHJldHVybiAoc20gPT0gbnVsbCkgPyBudWxsIDogc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0\nKE9iamVjdE91dHB1dFN0cmVhbSBvdXQpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoaXNBY3RpdmUoKSkgewogICAgICAg\nICAgICAgICAgaWYgKCFnZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoImNhbnQtc2VyaWFsaXplLXBl\nc3NpbWlzdGljLWJyb2tlciIpKTsKICAgICAgICAgICAgICAgIGlmIChoYXNG\nbHVzaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgX2xv\nYy5nZXQoImNhbnQtc2VyaWFsaXplLWZsdXNoZWQtYnJva2VyIikpOwogICAg\nICAgICAgICAgICAgaWYgKGhhc0Nvbm5lY3Rpb24oKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiY2FudC1zZXJpYWxpemUt\nY29ubmVjdGVkLWJyb2tlciIpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9pc1NlcmlhbGl6aW5nID0gdHJ1\nZTsKICAgICAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChfZmFjdG9yeS5n\nZXRQb29sS2V5KCkpOwogICAgICAgICAgICAgICAgb3V0LmRlZmF1bHRXcml0\nZU9iamVjdCgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgX2lzU2VyaWFsaXppbmcgPSBmYWxzZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVhZE9iamVjdChPYmpl\nY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3Vu\nZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIE9iamVjdCBmYWN0\nb3J5S2V5ID0gaW4ucmVhZE9iamVjdCgpOwogICAgICAgIEFic3RyYWN0QnJv\na2VyRmFjdG9yeSBmYWN0b3J5ID0KICAgICAgICAgICAgQWJzdHJhY3RCcm9r\nZXJGYWN0b3J5LmdldFBvb2xlZEZhY3RvcnlGb3JLZXkoZmFjdG9yeUtleSk7\nCgogICAgICAgIC8vIHRoaXMgbmVlZHMgdG8gaGFwcGVuIGJlZm9yZSBkZWZh\ndWx0UmVhZE9iamVjdCBzbyB0aGF0IGl0J3MKICAgICAgICAvLyBhdmFpbGFi\nbGUgZm9yIGNhbGxzIHRvIGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkgZHVy\naW5nCiAgICAgICAgLy8gU3RhdGVNYW5hZ2VyIGRlc2VyaWFsaXphdGlvbgog\nICAgICAgIF9jb25mID0gZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgCiAgICAgICAgaW4uZGVmYXVsdFJlYWRPYmplY3QoKTsKICAgICAg\nICBmYWN0b3J5LmluaXRpYWxpemVCcm9rZXIoX21hbmFnZWQsIF9jb25uUmV0\nYWluTW9kZSwgdGhpcywgdHJ1ZSk7CgogICAgICAgIC8vIHJlLWluaXRpYWxp\nemUgdGhlIGxvY2sgaWYgbmVlZGVkLgogICAgICAgIHNldE11bHRpdGhyZWFk\nZWQoX211bHRpdGhyZWFkZWQpOwoKICAgICAgICBpZiAoaXNBY3RpdmUoKSAm\nJiBfcnVudGltZSBpbnN0YW5jZW9mIExvY2FsTWFuYWdlZFJ1bnRpbWUpCiAg\nICAgICAgICAgICgoTG9jYWxNYW5hZ2VkUnVudGltZSkgX3J1bnRpbWUpLmJl\nZ2luKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0\naGlzIGJyb2tlciBpcyBpbiB0aGUgbWlkc3Qgb2YgYmVpbmcgc2VyaWFsaXpl\nZC4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAgCiAgICAgKi8KICAgIGJv\nb2xlYW4gaXNTZXJpYWxpemluZygpIHsKICAgICAgICByZXR1cm4gX2lzU2Vy\naWFsaXppbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2FjdGlvbmFs\nIGNhY2hlIHRoYXQgaG9sZHMgc29mdCByZWZzIHRvIGNsZWFuIGluc3RhbmNl\ncy4KICAgICAqLwogICAgc3RhdGljIGNsYXNzIFRyYW5zYWN0aW9uYWxDYWNo\nZQogICAgICAgIGltcGxlbWVudHMgU2V0LCBTZXJpYWxpemFibGUgewoKICAg\nICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX29yZGVyRGlydHk7CiAgICAg\nICAgcHJpdmF0ZSBTZXQ8U3RhdGVNYW5hZ2VySW1wbD4gX2RpcnR5ID0gbnVs\nbDsKICAgICAgICBwcml2YXRlIFNldDxTdGF0ZU1hbmFnZXJJbXBsPiBfY2xl\nYW4gPSBudWxsOwoKICAgICAgICBwdWJsaWMgVHJhbnNhY3Rpb25hbENhY2hl\nKGJvb2xlYW4gb3JkZXJEaXJ0eSkgewogICAgICAgICAgICBfb3JkZXJEaXJ0\neSA9IG9yZGVyRGlydHk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCB0cmFuc2FjdGlvbmFsIHN0YXRl\nIG1hbmFnZXJzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDb2xsZWN0\naW9uIGNvcHkoKSB7CiAgICAgICAgICAgIGlmIChpc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwoKICAg\nICAgICAgICAgLy8gc2l6ZSBtYXkgbm90IGJlIGVudGlyZWx5IGFjY3VyYXRl\nIGR1ZSB0byByZWZzIGV4cGlyaW5nLCBzbwogICAgICAgICAgICAvLyBtYW51\nYWxseSBjb3B5IGVhY2ggb2JqZWN0OyBkb2Vzbid0IG1hdHRlciB0aGlzIHdh\neSBpZiBzaXplIHRvbwogICAgICAgICAgICAvLyBiaWcgYnkgc29tZQogICAg\nICAgICAgICBTZXQgY29weSA9IG5ldyBMaW5rZWRIYXNoU2V0KHNpemUoKSk7\nCiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8U3RhdGVNYW5hZ2VySW1wbD4gaXRyID0gX2Rp\ncnR5Lml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAo\nX2NsZWFuICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nPFN0YXRlTWFuYWdlckltcGw+IGl0ciA9IF9jbGVhbi5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBjb3B5LmFkZChp\ndHIubmV4dCgpKTsKICAgICAgICAgICAgcmV0dXJuIGNvcHk7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFs\nbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgQ29sbGVjdGlvbiBjb3B5RGlydHkoKSB7CiAgICAgICAgICAgIGlm\nIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBMaW5rZWRIYXNoU2V0PFN0YXRlTWFuYWdlcklt\ncGw+KF9kaXJ0eSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBUcmFuc2ZlciB0aGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSB0aGUgZGlydHkg\nY2FjaGUgdG8gdGhlIGNsZWFuIGNhY2hlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyB2b2lkIGZsdXNoZWQoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewog\nICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpICYmIF9kaXJ0eSAhPSBudWxs\nICYmIF9kaXJ0eS5yZW1vdmUoc20pKQogICAgICAgICAgICAgICAgYWRkQ2xl\nYW5JbnRlcm5hbChzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBBZGQgdGhlIGdpdmVuIGluc3RhbmNlIHRvIHRoZSBjbGVhbiBjYWNo\nZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGRDbGVhbihT\ndGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChhZGRDbGVh\nbkludGVybmFsKHNtKSAmJiBfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9kaXJ0eS5yZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAgICAgcHJp\ndmF0ZSBib29sZWFuIGFkZENsZWFuSW50ZXJuYWwoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgICAgICBpZiAoX2NsZWFuID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfY2xlYW4gPSBuZXcgUmVmZXJlbmNlSGFzaFNldChSZWZl\ncmVuY2VIYXNoU2V0LlNPRlQpOwogICAgICAgICAgICByZXR1cm4gX2NsZWFu\nLmFkZChzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBB\nZGQgdGhlIGdpdmVuIGluc3RhbmNlIHRvIHRoZSBkaXJ0eSBjYWNoZS4KICAg\nICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGREaXJ0eShTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChfZGlydHkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgaWYgKF9vcmRlckRpcnR5KQogICAgICAg\nICAgICAgICAgICAgIF9kaXJ0eSA9IE1hcEJhY2tlZFNldC5kZWNvcmF0ZShu\nZXcgTGlua2VkTWFwKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIF9kaXJ0eSA9IG5ldyBIYXNoU2V0PFN0YXRlTWFuYWdl\nckltcGw+KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9kaXJ0\neS5hZGQoc20pKQogICAgICAgICAgICAgICAgcmVtb3ZlQ2xlYW5JbnRlcm5h\nbChzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZW1v\ndmUgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gdGhlIGNhY2hlLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShTdGF0ZU1hbmFn\nZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHJldHVybiByZW1vdmVDbGVhbklu\ndGVybmFsKHNtKQogICAgICAgICAgICAgICAgfHwgKF9kaXJ0eSAhPSBudWxs\nICYmIF9kaXJ0eS5yZW1vdmUoc20pKTsKICAgICAgICB9CgogICAgICAgIHBy\naXZhdGUgYm9vbGVhbiByZW1vdmVDbGVhbkludGVybmFsKFN0YXRlTWFuYWdl\nckltcGwgc20pIHsKICAgICAgICAgICAgcmV0dXJuIF9jbGVhbiAhPSBudWxs\nICYmIF9jbGVhbi5yZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEl0ZXJhdG9yIGl0ZXJhdG9yKCkgewogICAgICAgICAgICBJdGVyYXRv\nckNoYWluIGNoYWluID0gbmV3IEl0ZXJhdG9yQ2hhaW4oKTsKICAgICAgICAg\nICAgaWYgKF9kaXJ0eSAhPSBudWxsICYmICFfZGlydHkuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgY2hhaW4uYWRkSXRlcmF0b3IoX2RpcnR5Lml0ZXJh\ndG9yKCkpOwogICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwgJiYgIV9j\nbGVhbi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBjaGFpbi5hZGRJdGVy\nYXRvcihfY2xlYW4uaXRlcmF0b3IoKSk7CiAgICAgICAgICAgIHJldHVybiBj\naGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRh\naW5zKE9iamVjdCBvYmopIHsKICAgICAgICAgICAgcmV0dXJuIChfZGlydHkg\nIT0gbnVsbCAmJiBfZGlydHkuY29udGFpbnMob2JqKSkKICAgICAgICAgICAg\nICAgIHx8IChfY2xlYW4gIT0gbnVsbCAmJiBfY2xlYW4uY29udGFpbnMob2Jq\nKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlu\nc0FsbChDb2xsZWN0aW9uIGNvbGwpIHsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvcjw/PiBpdHIgPSBjb2xsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgaWYgKCFjb250YWlucyhpdHIubmV4dCgpKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9kaXJ0eSA9IG51bGw7CiAgICAgICAgICAgIGlmIChf\nY2xlYW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jbGVhbiA9IG51bGw7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkg\newogICAgICAgICAgICByZXR1cm4gKF9kaXJ0eSA9PSBudWxsIHx8IF9kaXJ0\neS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAmJiAoX2NsZWFuID09IG51\nbGwgfHwgX2NsZWFuLmlzRW1wdHkoKSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIGludCBzaXplID0gMDsK\nICAgICAgICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgc2l6ZSArPSBfZGlydHkuc2l6ZSgpOwogICAgICAgICAgICBpZiAoX2Ns\nZWFuICE9IG51bGwpCiAgICAgICAgICAgICAgICBzaXplICs9IF9jbGVhbi5z\naXplKCk7CiAgICAgICAgICAgIHJldHVybiBzaXplOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gYWRkKE9iamVjdCBvYmopIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwo\nQ29sbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvYmopIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVB\nbGwoQ29sbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gcmV0YWluQWxsKENvbGxlY3Rpb24gYykg\newogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25F\neGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Rb\nXSB0b0FycmF5KCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBPYmplY3RbXSB0b0FycmF5KE9iamVjdFtdIGFycikgewogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVbmlxdWUgaWQg\nZm9yIHN0YXRlIG1hbmFnZXJzIG9mIG5ldyBkYXRhc3RvcmUgaW5zdGFuY2Vz\nIHdpdGhvdXQgYXNzaWduZWQKICAgICAqIG9iamVjdCBpZHMuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFN0YXRlTWFuYWdlcklkCiAgICAg\nICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIFN0cmluZyBTVFJJTkdfUFJFRklYID0gIm9wZW5qcGFz\nbToiOwoKICAgICAgICBwcml2YXRlIHN0YXRpYyBsb25nIF9nZW5lcmF0b3Ig\nPSAwOwoKICAgICAgICBwcml2YXRlIGZpbmFsIGludCBfYmhhc2g7CiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBsb25nIF9pZDsKCiAgICAgICAgcHVibGljIHN0\nYXRpYyBTdGF0ZU1hbmFnZXJJZCBuZXdJbnN0YW5jZShCcm9rZXIgYikgewog\nICAgICAgICAgICByZXR1cm4gbmV3IFN0YXRlTWFuYWdlcklkKFN5c3RlbS5p\nZGVudGl0eUhhc2hDb2RlKGIpLCBfZ2VuZXJhdG9yKyspOwogICAgICAgIH0K\nCiAgICAgICAgcHJpdmF0ZSBTdGF0ZU1hbmFnZXJJZChpbnQgYmhhc2gsIGxv\nbmcgaWQpIHsKICAgICAgICAgICAgX2JoYXNoID0gYmhhc2g7CiAgICAgICAg\nICAgIF9pZCA9IGlkOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0YXRl\nTWFuYWdlcklkKFN0cmluZyBzdHIpIHsKICAgICAgICAgICAgc3RyID0gc3Ry\nLnN1YnN0cmluZyhTVFJJTkdfUFJFRklYLmxlbmd0aCgpKTsKICAgICAgICAg\nICAgaW50IGlkeCA9IHN0ci5pbmRleE9mKCc6Jyk7CiAgICAgICAgICAgIF9i\naGFzaCA9IEludGVnZXIucGFyc2VJbnQoc3RyLnN1YnN0cmluZygwLCBpZHgp\nKTsKICAgICAgICAgICAgX2lkID0gTG9uZy5wYXJzZUxvbmcoc3RyLnN1YnN0\ncmluZyhpZHggKyAxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmIChv\ndGhlciA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgU3RhdGVNYW5hZ2Vy\nSWQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJZCBzaWQgPSAoU3RhdGVNYW5hZ2VySWQpIG90aGVy\nOwogICAgICAgICAgICByZXR1cm4gX2JoYXNoID09IHNpZC5fYmhhc2ggJiYg\nX2lkID09IHNpZC5faWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIGhhc2hDb2RlKCkgewogICAgICAgICAgICByZXR1cm4gKGludCkgKF9pZCBe\nIChfaWQgPj4+IDMyKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gU1RSSU5HX1BS\nRUZJWCArIF9iaGFzaCArICI6IiArIF9pZDsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb2xsZWN0aW9uIHR5cGUgdGhhdCBob2xkcyBzdGF0\nZSBtYW5hZ2VycyBidXQgd2hvc2UgaW50ZXJmYWNlIGRlYWxzCiAgICAgKiB3\naXRoIHRoZSBjb3JyZXNwb25kaW5nIG1hbmFnZWQgb2JqZWN0cy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWFuYWdlZE9iamVjdENvbGxl\nY3Rpb24KICAgICAgICBleHRlbmRzIEFic3RyYWN0Q29sbGVjdGlvbiB7Cgog\nICAgICAgIHByaXZhdGUgZmluYWwgQ29sbGVjdGlvbiBfc3RhdGVzOwoKICAg\nICAgICBwdWJsaWMgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oQ29sbGVjdGlv\nbiBzdGF0ZXMpIHsKICAgICAgICAgICAgX3N0YXRlcyA9IHN0YXRlczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFN0YXRlTWFu\nYWdlcnMoKSB7CiAgICAgICAgICAgIHJldHVybiBfc3RhdGVzOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3N0YXRlcy5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgSXRlcmF0b3IoKSB7CiAgICAgICAgICAgICAgICBwcml2YXRlIGZpbmFs\nIEl0ZXJhdG9yIF9pdHIgPSBfc3RhdGVzLml0ZXJhdG9yKCk7CgogICAgICAg\nICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzTmV4dCgpIHsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gX2l0ci5oYXNOZXh0KCk7CiAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgcHVibGljIE9iamVjdCBuZXh0KCkg\newogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIpIF9pdHIubmV4dCgpKS4KICAgICAgICAgICAgICAgICAgICAgICAg\nZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiB0aGUgb2JqZWN0IGlkIHRvIHRo\nZSBjYWNoZS4gRXhjZXB0aW9uIHdpbGwgYmUKICAgICAqIHRocm93biBpZiB0\naGUgaWQgYWxyZWFkeSBleGlzdHMgaW4gdGhlIGNhY2hlLiAKICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgYXNzaWduT2JqZWN0SWQoT2JqZWN0IGNhY2hl\nLCBPYmplY3QgaWQsIAogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20pIHsK\nICAgICAgICAoKE1hbmFnZWRDYWNoZSkgY2FjaGUpLmFzc2lnbk9iamVjdElk\nKGlkLCBzbSk7IAogICAgfQoKICAgIC8qKiAKICAgICAqIFRoaXMgbWV0aG9k\nIG1ha2VzIHN1cmUgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIHRoZSBpbnN0YW5j\nZSBjYWNoZWQKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2hlY2tGb3JE\ndXBsaWNhdGVJZChPYmplY3QgaWQsIE9iamVjdCBvYmopIHsKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIG90aGVyID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5\nSWQoaWQsIGZhbHNlKTsKICAgICAgICBpZiAob3RoZXIgIT0gbnVsbCAmJiAh\nb3RoZXIuaXNEZWxldGVkKCkgJiYgIW90aGVyLmlzTmV3KCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24oX2xvYy5nZXQo\nImNhY2hlLWV4aXN0cyIsCiAgICAgICAgICAgICAgICBvYmouZ2V0Q2xhc3Mo\nKS5nZXROYW1lKCksIGlkKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBib29sZWFuIGdldENhY2hlUHJlcGFyZWRRdWVy\neSgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcmV0dXJuIF9jYWNoZVByZXBhcmVkUXVlcnkgCiAgICAgICAgICAgICAg\nICYmIF9jb25mLmdldFF1ZXJ5U1FMQ2FjaGVJbnN0YW5jZSgpICE9IG51bGw7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRDYWNoZVBy\nZXBhcmVkUXVlcnkoYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9jYWNoZVByZXBhcmVkUXVlcnkg\nPSBmbGFnOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4g\nZ2V0Q2FjaGVGaW5kZXJRdWVyeSgpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIF9jYWNoZUZpbmRlclF1ZXJ5\nIAogICAgICAgICAgICAgICAmJiBfY29uZi5nZXRGaW5kZXJDYWNoZUluc3Rh\nbmNlKCkgIT0gbnVsbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2\nb2lkIHNldENhY2hlRmluZGVyUXVlcnkoYm9vbGVhbiBmbGFnKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9jYWNoZVBy\nZXBhcmVkUXVlcnkgPSBmbGFnOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVi\nbGljIGJvb2xlYW4gaXNGcm9tV3JpdGVCZWhpbmRDYWxsYmFjaygpIHsKICAg\nICAgICByZXR1cm4gX2Zyb21Xcml0ZUJlaGluZENhbGxiYWNrOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSAnSlRBJyBjb25uZWN0aW9uRmFj\ndG9yeU5hbWUKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0\naW9uRmFjdG9yeU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF9jb25uZWN0aW9u\nRmFjdG9yeU5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlICdK\nVEEnIENvbm5lY3Rpb25GYWN0b3J5TmFtZS4gSW5wdXQgd2lsbCBiZSB0cmlt\nbWVkIHRvIG51bGwgYmVmb3JlIGJlaW5nIHN0b3JlZC4gCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldENvbm5lY3Rpb25GYWN0b3J5TmFtZShTdHJpbmcg\nY29ubmVjdGlvbkZhY3RvcnlOYW1lKSB7CiAgICAgICAgdGhpcy5fY29ubmVj\ndGlvbkZhY3RvcnlOYW1lID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChjb25u\nZWN0aW9uRmFjdG9yeU5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSAnTm9uSlRBJyBDb25uZWN0aW9uRmFjdG9yeU5hbWUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ubmVjdGlvbkZhY3RvcnkyTmFt\nZSgpIHsKICAgICAgICByZXR1cm4gX2Nvbm5lY3Rpb25GYWN0b3J5Mk5hbWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlICdOb25KVEEnIENvbm5l\nY3Rpb25GYWN0b3J5TmFtZS4gSW5wdXQgd2lsbCBiZSB0cmltbWVkIHRvIG51\nbGwgYmVmb3JlIGJlaW5nIHN0b3JlZC4gCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldENvbm5lY3Rpb25GYWN0b3J5Mk5hbWUoU3RyaW5nIGNvbm5lY3Rp\nb25GYWN0b3J5Mk5hbWUpIHsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uRmFj\ndG9yeTJOYW1lID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChjb25uZWN0aW9u\nRmFjdG9yeTJOYW1lKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlICdKVEEnIENvbm5lY3Rpb25GYWN0b3J5LCBsb29raW5nIGl0IHVw\nIGZyb20gSk5ESSBpZiBuZWVkZWQuCiAgICAgKiAKICAgICAqIEByZXR1cm4g\ndGhlIEpUQSBjb25uZWN0aW9uIGZhY3Rvcnkgb3IgbnVsbCBpZiBjb25uZWN0\naW9uRmFjdG9yeU5hbWUgaXMgYmxhbmsuCiAgICAgKi8KICAgIHB1YmxpYyBP\nYmplY3QgZ2V0Q29ubmVjdGlvbkZhY3RvcnkoKSB7CiAgICAgICAgaWYoU3Ry\naW5nVXRpbHMuaXNOb3RCbGFuayhfY29ubmVjdGlvbkZhY3RvcnlOYW1lKSkg\neyAKICAgICAgICAgICAgcmV0dXJuIENvbmZpZ3VyYXRpb25zLmxvb2t1cChf\nY29ubmVjdGlvbkZhY3RvcnlOYW1lLCAib3BlbmpwYS5Db25uZWN0aW9uRmFj\ndG9yeSIsIF9sb2cgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlICdOb25KVEEnIENvbm5lY3Rpb25GYWN0\nb3J5LCBsb29raW5nIGl0IHVwIGZyb20gSk5ESSBpZiBuZWVkZWQuCiAgICAg\nKiAKICAgICAqIEByZXR1cm4gdGhlIE5vbkpUQSBjb25uZWN0aW9uIGZhY3Rv\ncnkgb3IgbnVsbCBpZiBjb25uZWN0aW9uRmFjdG9yeU5hbWUgaXMgYmxhbmsu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0Q29ubmVjdGlvbkZhY3Rv\ncnkyKCkgeyAKICAgICAgICBpZihTdHJpbmdVdGlscy5pc05vdEJsYW5rKF9j\nb25uZWN0aW9uRmFjdG9yeTJOYW1lKSkgeyAKICAgICAgICAgICAgcmV0dXJu\nICBDb25maWd1cmF0aW9ucy5sb29rdXAoX2Nvbm5lY3Rpb25GYWN0b3J5Mk5h\nbWUsICJvcGVuanBhLkNvbm5lY3Rpb25GYWN0b3J5MiIsIF9sb2cpOwogICAg\nICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Nh\nY2hlZChMaXN0PE9iamVjdD4gb2lkcykgewogICAgICAgIEJpdFNldCBsb2Fk\nZWQgPSBuZXcgQml0U2V0KG9pZHMuc2l6ZSgpKTsKICAgICAgICAvL2NoZWNr\nIEwxIGNhY2hlIGZpcnN0CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBv\naWRzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBv\naWRzLmdldChpKTsKICAgICAgICAgICAgaWYgKF9jYWNoZS5nZXRCeUlkKG9p\nZCwgZmFsc2UpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvYWRlZC5z\nZXQoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYobG9h\nZGVkLmNhcmRpbmFsaXR5KCk9PW9pZHMuc2l6ZSgpKXsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfc3RvcmUu\naXNDYWNoZWQob2lkcywgbG9hZGVkKTsKICAgIH07Cn0K\n","encoding":"base64"}

