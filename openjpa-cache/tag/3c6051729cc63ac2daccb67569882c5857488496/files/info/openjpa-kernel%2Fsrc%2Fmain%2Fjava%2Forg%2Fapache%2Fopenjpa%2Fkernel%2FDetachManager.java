{"sha":"33c6761e309b7432a691b9e082cf96c3784a49f2","node_id":"MDQ6QmxvYjIwNjM2NDozM2M2NzYxZTMwOWI3NDMyYTY5MWI5ZTA4MmNmOTZjMzc4NGE0OWYy","size":31758,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/33c6761e309b7432a691b9e082cf96c3784a49f2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuQ29tcGF0aWJpbGl0eTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLkRldGFjaE9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuQ2FsbGJhY2tNb2RlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DYWxsYmFja0V4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5k\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJv\neHk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwoKLyoqCiAqIEhhbmRsZXMgZGV0YWNoaW5nIGluc3RhbmNlcy4KICoK\nICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQG5vamF2YWRvYwog\nKi8KcHVibGljIGNsYXNzIERldGFjaE1hbmFnZXIKICAgIGltcGxlbWVudHMg\nRGV0YWNoU3RhdGUgewoKICAgIHByaXZhdGUgc3RhdGljIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoRGV0YWNoTWFuYWdlci5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBmaW5hbCBCcm9rZXJJbXBsIF9icm9rZXI7CiAg\nICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX2NvcHk7CiAgICBwcml2YXRlIGZp\nbmFsIGJvb2xlYW4gX2Z1bGw7CiAgICBwcml2YXRlIGZpbmFsIFByb3h5TWFu\nYWdlciBfcHJveHk7CiAgICBwcml2YXRlIGZpbmFsIERldGFjaE9wdGlvbnMg\nX29wdHM7CiAgICBwcml2YXRlIGZpbmFsIE9wQ2FsbGJhY2tzIF9jYWxsOwog\nICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9mYWlsRmFzdDsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfZmx1c2hlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9mbHVzaEJlZm9yZURldGFjaDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nY2FzY2FkZVdpdGhEZXRhY2g7IAogICAgcHJpdmF0ZSBib29sZWFuIF9yZWxv\nYWRPbkRldGFjaDsKCiAgICAvLyBpZiB3ZSdyZSBub3QgZGV0YWNoaW5nIGZ1\nbGwsIHdlIG5lZWQgdG8gdHJhY2sgYWxsIGRldGFjaGVkIG9iamVjdHM7CiAg\nICAvLyBpZiB3ZSBhcmUsIHRoZW4gd2UgdXNlIGEgc3BlY2lhbCBmaWVsZCBt\nYW5hZ2VyIGZvciBtb3JlIGVmZmljaWVudAogICAgLy8gZGV0YWNobWVudCB0\naGFuIHRoZSBzdGFuZGFyZCBvbmUKICAgIHByaXZhdGUgZmluYWwgSWRlbnRp\ndHlNYXAgX2RldGFjaGVkOwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hGaWVs\nZE1hbmFnZXIgX2Z1bGxGTTsKCiAgICAvKioKICAgICAqIFVzZWQgdG8gcHJl\ncGFyZSBhIGRldGFjaGFibGUgaW5zdGFuY2UgdGhhdCBkb2VzIG5vdCBleHRl\ncm5hbGl6ZQogICAgICogZGV0YWNoZWQgc3RhdGUuCiAgICAgKi8KICAgIHN0\nYXRpYyBib29sZWFuIHByZVNlcmlhbGl6ZShTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoc20uZ2V0QnJva2VyKCku\nZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nCiAgICAgICAgICAgICAgICAuZ2V0Rmx1c2hCZWZvcmVEZXRhY2goKSkgewog\nICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAgICB9CgogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAg\nICAgYm9vbGVhbiBzZXRTdGF0ZSA9IG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgp\nICE9IG51bGwKICAgICAgICAgICAgJiYgIUNsYXNzTWV0YURhdGEuU1lOVEhF\nVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUoKSk7CiAgICAgICAg\nQml0U2V0IGlkeHMgPSAoc2V0U3RhdGUpID8gbmV3IEJpdFNldChtZXRhLmdl\ndEZpZWxkcygpLmxlbmd0aCkgOiBudWxsOwogICAgICAgIHByZURldGFjaChz\nbS5nZXRCcm9rZXIoKSwgc20sIGlkeHMsIGZhbHNlLCB0cnVlKTsKCiAgICAg\nICAgaWYgKHNldFN0YXRlKSB7CiAgICAgICAgICAgIHNtLmdldFBlcnNpc3Rl\nbmNlQ2FwYWJsZSgpLnBjU2V0RGV0YWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0\nYXRlCiAgICAgICAgICAgICAgICAoc20sIGlkeHMpKTsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOyAvLyBkb24ndCBudWxsIHN0YXRlCiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVXNl\nZCBieSBjbGFzc2VzIHRoYXQgZXh0ZXJuYWxpemUgZGV0YWNoZWQgc3RhdGUu\nCiAgICAgKgogICAgICogQHJldHVybiB3aGV0aGVyIHRvIHVzZSBhIGRldGFj\naGVkIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgc3RhdGljIGJvb2xlYW4g\nd3JpdGVEZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20sIE9iamVj\ndE91dHB1dCBvdXQsCiAgICAgICAgQml0U2V0IGlkeHMpCiAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVu\ndCgpKSB7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsgLy8g\nc3RhdGUKICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0KG51bGwpOyAvLyBz\nbQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICAvLyBkaXJ0eSBzdGF0ZSBjYXVzZXMgZmx1c2gKICAgICAgICBmbHVzaERp\ncnR5KHNtKTsKCiAgICAgICAgQnJva2VyIGJyb2tlciA9IHNtLmdldEJyb2tl\ncigpOwogICAgICAgIHByZURldGFjaChicm9rZXIsIHNtLCBpZHhzLCBmYWxz\nZSwgdHJ1ZSk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVkIHN0YXRlIG9i\namVjdCBhbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFjaE9wdGlvbnMg\nb3B0cyA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAg\nIGdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoIW9wdHMu\nZ2V0RGV0YWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICB8fCAhdXNl\nRGV0YWNoZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAgICAgICAgICAg\nIG91dC53cml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNtLCBpZHhzKSk7\nCiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBvdXQud3JpdGVP\nYmplY3QobnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG5ldyBEZXRh\nY2hlZFN0YXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwK\nICAgICAgICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNzVW5sb2FkZWQo\nKSwgYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkgdGhlIG9iamVj\ndCBmb3IgZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcgdGhlIGZpZWxk\ncyB0byBiZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5nIHZlcnNpb24g\naW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlkeHMgdGhlIGlu\nZGV4ZXMgb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNldCBhcyBhIHNp\nZGUKICAgICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIgYnJva2VyLCBT\ndGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBpZHhzLCBib29s\nZWFuIGZ1bGwsCiAgICAgICAgYm9vbGVhbiByZWxvYWRPbkRldGFjaCkgewog\nICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZXhpc3Rpbmcgb2JqZWN0IGhhcyB0\naGUgcmlnaHQgZmllbGRzIGZldGNoZWQ7IGNhbGwKICAgICAgICAvLyBldmVu\nIGlmIHVzaW5nIGN1cnJlbnRseS1sb2FkZWQgZmllbGRzIGZvciBkZXRhY2gg\ndG8gbWFrZSBzdXJlCiAgICAgICAgLy8gdmVyc2lvbiBpcyBzZXQKICAgICAg\nICBpbnQgZGV0YWNoTW9kZSA9IGJyb2tlci5nZXREZXRhY2hTdGF0ZSgpOwog\nICAgICAgIGludCBsb2FkTW9kZSA9IFN0YXRlTWFuYWdlckltcGwuTE9BRF9G\nR1M7CiAgICAgICAgQml0U2V0IGV4Y2x1ZGUgPSBudWxsOwogICAgICAgIGlm\nIChkZXRhY2hNb2RlID09IERFVEFDSF9MT0FERUQpCiAgICAgICAgICAgIGV4\nY2x1ZGUgPSBTdG9yZUNvbnRleHQuRVhDTFVERV9BTEw7CiAgICAgICAgZWxz\nZSBpZiAoZGV0YWNoTW9kZSA9PSBERVRBQ0hfQUxMKQogICAgICAgICAgICBs\nb2FkTW9kZSA9IFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKGRldGFjaE1vZGUgIT0gREVUQUNIX0xP\nQURFRCB8fCAKICAgICAgICAgICAgICAgICAgICByZWxvYWRPbkRldGFjaCB8\nfAogICAgICAgICAgICAgICAgICAgICghcmVsb2FkT25EZXRhY2ggJiYgIWZ1\nbGwpKSB7CiAgICAgICAgICAgICAgICBzbS5sb2FkKGJyb2tlci5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKSwgbG9hZE1vZGUsIGV4Y2x1ZGUsCiAgICAgICAg\nICAgICAgICAgICAgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewog\nICAgICAgICAgICAvLyBjb25zdW1lIHRoZSBleGNlcHRpb24KICAgICAgICB9\nCgogICAgICAgIC8vIGNyZWF0ZSBiaXRzZXQgb2YgZmllbGRzIHRvIGRldGFj\naDsgaWYgbW9kZSBpcyBhbGwgd2UgY2FuIHVzZQogICAgICAgIC8vIGN1cnJl\nbnRseSBsb2FkZWQgYml0c2V0IGNsb25lLCBzaW5jZSB3ZSBrbm93IGFsbCBm\naWVsZHMgYXJlIGxvYWRlZAogICAgICAgIGlmIChpZHhzICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKGRldGFjaE1vZGUgPT0gREVUQUNIX0ZFVENIX0dS\nT1VQUykKICAgICAgICAgICAgICAgIHNldEZldGNoR3JvdXBGaWVsZHMoYnJv\na2VyLCBzbSwgaWR4cyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGlkeHMub3Ioc20uZ2V0TG9hZGVkKCkpOwoKICAgICAgICAgICAgLy8g\nY2xlYXIgbHJzIGZpZWxkcwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgCiAg\nICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKQogICAgICAgICAg\nICAgICAgICAgIGlkeHMuY2xlYXIoaSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogR2VuZXJhdGUgdGhlIGRldGFjaGVkIHN0YXRlIGZvciB0\naGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIE9iamVjdCBnZXREZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20s\nIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICAvLyBpZiBkYXRhc3RvcmUsIHN0\nb3JlIGlkIGluIGZpcnN0IGVsZW1lbnQKICAgICAgICBpbnQgb2Zmc2V0ID0g\nKHNtLmdldE1ldGFEYXRhKCkuZ2V0SWRlbnRpdHlUeXBlKCkgPT0KICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpID8gMSA6IDA7Cgog\nICAgICAgIC8vIG1ha2UgdmVyc2lvbiBzdGF0ZSBhcnJheSBvbmUgbGFyZ2Vy\nIGZvciBuZXcgaW5zdGFuY2VzOyBtYXJrcyBuZXcKICAgICAgICAvLyBpbnN0\nYW5jZXMgd2l0aG91dCBhZmZlY3Rpbmcgc2VyaWFsaXphdGlvbiBzaXplIG11\nY2gKICAgICAgICBPYmplY3RbXSBzdGF0ZTsKICAgICAgICBpZiAoc20uaXNO\nZXcoKSkKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2JqZWN0WzMgKyBvZmZz\nZXRdOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2Jq\nZWN0WzIgKyBvZmZzZXRdOwoKICAgICAgICBpZiAob2Zmc2V0ID4gMCkgewog\nICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGlmIChzbS5pc0Vt\nYmVkZGVkKCkgfHwgc20uZ2V0T2JqZWN0SWQoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgaWQgPSBzbS5nZXRJZCgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBpZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAg\nICAgIHN0YXRlWzBdID0gaWQudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAg\nICAgc3RhdGVbb2Zmc2V0XSA9IHNtLmdldFZlcnNpb24oKTsKICAgICAgICBz\ndGF0ZVtvZmZzZXQgKyAxXSA9IGZpZWxkczsKICAgICAgICByZXR1cm4gc3Rh\ndGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBvciBpbnZva2UgcHJl\nLXN0b3JlIGNhbGxiYWNrcyBvbiB0aGUgZ2l2ZW4gYnJva2VyIGlmCiAgICAg\nKiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIGZsdXNoZWQvc3RvcmVkLCBmYWxz\nZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xl\nYW4gZmx1c2hEaXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAg\naWYgKCFzbS5pc0RpcnR5KCkgfHwgIXNtLmdldEJyb2tlcigpLmlzQWN0aXZl\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gb25s\neSBmbHVzaCBpZiB0aGVyZSBhcmUgYWN0dWFsbHkgYW55IGRpcnR5IG5vbi1m\nbHVzaGVkIGZpZWxkcwogICAgICAgIEJpdFNldCBkaXJ0eUZpZWxkcyA9IHNt\nLmdldERpcnR5KCk7CiAgICAgICAgQml0U2V0IGZsdXNoZWRGaWVsZHMgPSBz\nbS5nZXRGbHVzaGVkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBk\naXJ0eUZpZWxkcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBpZiAoZGly\ndHlGaWVsZHMuZ2V0KGkpICYmICFmbHVzaGVkRmllbGRzLmdldChpKSkgewog\nICAgICAgICAgICAgICAgaWYgKHNtLmdldEJyb2tlcigpLmdldFJvbGxiYWNr\nT25seSgpKQogICAgICAgICAgICAgICAgICAgIHNtLmdldEJyb2tlcigpLnBy\nZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0QnJva2VyKCkuZmx1c2goKTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nIGJpdCBzZXQgZm9yIHRoZSBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgZmV0Y2gg\nZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldEZl\ndGNoR3JvdXBGaWVsZHMoQnJva2VyIGJyb2tlciwKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtLCBCaXRTZXQgaWR4cykgewogICAgICAgIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmbWRz\nW2ldLmlzUHJpbWFyeUtleSgpIHx8IGZldGNoLnJlcXVpcmVzRmV0Y2goZm1k\nc1tpXSkKICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlvbi5G\nRVRDSF9OT05FKQogICAgICAgICAgICAgICAgaWR4cy5zZXQoaSk7CiAgICAg\nICAgfQogICAgfQogICAgCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4K\nICAgICAqCiAgICAgKiBAcGFyYW0gYnJva2VyIG93bmluZyBicm9rZXIKICAg\nICAqIEBwYXJhbSBmdWxsIHdoZXRoZXIgdGhlIGVudGlyZSBicm9rZXIgY2Fj\naGUgaXMgYmVpbmcgZGV0YWNoZWQ7IGlmCiAgICAgKiB0aGlzIGlzIHRoZSBj\nYXNlLCB3ZSBhc3N1bWUgdGhlIGJyb2tlciBoYXMgYWxyZWFkeQogICAgICog\nZmx1c2hlZCBpZiBuZWVkZWQsIGFuZCB0aGF0IHdlJ3JlIGRldGFjaGluZyBp\nbi1wbGFjZQogICAgICovCiAgICBwdWJsaWMgRGV0YWNoTWFuYWdlcihCcm9r\nZXJJbXBsIGJyb2tlciwgYm9vbGVhbiBmdWxsLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBfcHJveHkg\nPSBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldFByb3h5TWFuYWdlcklu\nc3RhbmNlKCk7CiAgICAgICAgX29wdHMgPSBicm9rZXIuZ2V0Q29uZmlndXJh\ndGlvbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBfZmx1\nc2hlZCA9IGZ1bGw7CiAgICAgICAgX2NhbGwgPSBjYWxsOwogICAgICAgIF9m\nYWlsRmFzdCA9IChicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCkK\nICAgICAgICAgICAgJiBDYWxsYmFja01vZGVzLkNBTExCQUNLX0ZBSUxfRkFT\nVCkgIT0gMDsKCiAgICAgICAgLy8gd2UgY2FuIG9ubHkgcmVseSBvbiBvdXIg\nImZ1bGwiIHNob3J0Y3V0cyBpZiB3ZSBrbm93IHdlIHdvbid0IGJlCiAgICAg\nICAgLy8gbG9hZGluZyBhbnkgbW9yZSBkYXRhCiAgICAgICAgX2Z1bGwgPSBm\ndWxsICYmIGJyb2tlci5nZXREZXRhY2hTdGF0ZSgpID09IERldGFjaFN0YXRl\nLkRFVEFDSF9MT0FERUQ7CiAgICAgICAgaWYgKF9mdWxsKSB7CiAgICAgICAg\nICAgIF9kZXRhY2hlZCA9IG51bGw7CiAgICAgICAgICAgIF9mdWxsRk0gPSBu\nZXcgRGV0YWNoRmllbGRNYW5hZ2VyKCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgX2RldGFjaGVkID0gbmV3IElkZW50aXR5TWFwKCk7CiAgICAg\nICAgICAgIF9mdWxsRk0gPSBudWxsOwogICAgICAgIH0KICAgICAgICBDb21w\nYXRpYmlsaXR5IGNvbXBhdGliaWxpdHkgPSAKICAgICAgICAgICAgYnJva2Vy\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2Uo\nKTsKICAgICAgICBfZmx1c2hCZWZvcmVEZXRhY2ggPSBjb21wYXRpYmlsaXR5\nLmdldEZsdXNoQmVmb3JlRGV0YWNoKCk7CiAgICAgICAgX3JlbG9hZE9uRGV0\nYWNoID0gY29tcGF0aWJpbGl0eS5nZXRSZWxvYWRPbkRldGFjaCgpOwogICAg\nICAgIF9jYXNjYWRlV2l0aERldGFjaCA9IGNvbXBhdGliaWxpdHkuZ2V0Q2Fz\nY2FkZVdpdGhEZXRhY2goKTsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAg\nICAgICBfY29weSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgX2NvcHkgPSBjb21wYXRpYmlsaXR5LmdldENvcHlPbkRl\ndGFjaCgpOzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBkZXRhY2hlZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2JqZWN0IHRvRGV0\nYWNoKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBkZXRhY2hJbnRlcm5hbCh0b0RldGFj\naCk7CiAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2UpIHsK\nICAgICAgICAgICAgZXhjZXBzID0gbmV3IEFycmF5TGlzdCgxKTsKICAgICAg\nICAgICAgZXhjZXBzLmFkZChjZSk7CiAgICAgICAgICAgIHJldHVybiBudWxs\nOyAvLyB3b24ndCBiZSByZWFjaGVkIGFzIGV4Y2VwdGlvbiB3aWxsIGJlIHJl\ndGhyb3duCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGV4\nY2VwcyA9PSBudWxsIHx8ICFfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICBl\neGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9ucy5zaW5nbGV0\nb24odG9EZXRhY2gpLAogICAgICAgICAgICAgICAgICAgIGV4Y2Vwcyk7CiAg\nICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbnMoZXhjZXBzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gZGV0YWNoZWQgdmVyc2lvbnMgb2YgYWxsIHRoZSBnaXZlbiBp\nbnN0YW5jZXMuIElmIG5vdCBjb3B5aW5nLAogICAgICogbnVsbCB3aWxsIGJl\nIHJldHVybmVkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNo\nQWxsKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgTGlzdCBleGNl\ncHMgPSBudWxsOwogICAgICAgIExpc3QgZGV0YWNoZWQgPSBudWxsOwogICAg\nICAgIGlmIChfY29weSkKICAgICAgICAgICAgZGV0YWNoZWQgPSBuZXcgQXJy\nYXlMaXN0KGluc3RhbmNlcy5zaXplKCkpOwoKICAgICAgICBib29sZWFuIGZh\naWxGYXN0ID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgT2Jq\nZWN0IGRldGFjaDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBp\nbnN0YW5jZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIGRldGFjaCA9IGRldGFjaEludGVybmFsKGl0ci5uZXh0KCkp\nOwogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAg\nICAgIGRldGFjaGVkLmFkZChkZXRhY2gpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIGlmIChyZSBpbnN0YW5jZW9mIENhbGxiYWNrRXhjZXB0aW9u\nICYmIF9mYWlsRmFzdCkKICAgICAgICAgICAgICAgIGZhaWxGYXN0ID0gdHJ1\nZTsKICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghZmFpbEZhc3QpCiAg\nICAgICAgICAgICAgICBleGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChpbnN0\nYW5jZXMsIGV4Y2Vwcyk7CiAgICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAg\nICAgIH0KICAgICAgICB0aHJvd0V4Y2VwdGlvbnMoZXhjZXBzKTsKCiAgICAg\nICAgaWYgKF9jb3B5KQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQudG9B\ncnJheSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogSW52b2tlIHBvc3REZXRhY2goKSBvbiBhbnkgZGV0YWNoZWQgaW5z\ndGFuY2VzIHRoYXQgaW1wbGVtZW50CiAgICAgKiBQb3N0RGV0YWNoQ2FsbGJh\nY2suIFRoaXMgd2lsbCBiZSBkb25lIGFmdGVyIHRoZSBlbnRpcmUgZ3JhcGgg\naGFzCiAgICAgKiBiZWVuIGRldGFjaGVkLiBUaGlzIG1ldGhvZCBoYXMgdGhl\nIHNpZGUtZWZmZWN0IG9mIGFsc28gY2xlYXJpbmcKICAgICAqIG91dCB0aGUg\nbWFwIG9mIGFsbCBkZXRhY2hlZCBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHBy\naXZhdGUgTGlzdCBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9uIG9ianMs\nIExpc3QgZXhjZXBzKSB7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gKF9mdWxs\nKSA/IG9ianMuaXRlcmF0b3IoKQogICAgICAgICAgICA6IF9kZXRhY2hlZC5l\nbnRyeVNldCgpLml0ZXJhdG9yKCk7CgogICAgICAgIE9iamVjdCBvcmlnLCBk\nZXRhY2hlZDsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgd2hp\nbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgaWYgKF9mdWxsKSB7\nCiAgICAgICAgICAgICAgICBvcmlnID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGRldGFjaGVkID0gb3JpZzsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIG9yaWcgPSBlbnRyeS5nZXRLZXkoKTsKICAg\nICAgICAgICAgICAgIGRldGFjaGVkID0gZW50cnkuZ2V0VmFsdWUoKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvcmlnLCB0cnVlKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2\nZW50KGRldGFjaGVkLCBvcmlnLAogICAgICAgICAgICAgICAgICAgICAgICBz\nbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ERVRBQ0gp\nOwogICAgICAgICAgICB9IGNhdGNoIChDYWxsYmFja0V4Y2VwdGlvbiBjZSkg\newogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgY2UpOwog\nICAgICAgICAgICAgICAgaWYgKF9mYWlsRmFzdCkKICAgICAgICAgICAgICAg\nICAgICBicmVhazsgLy8gZG9uJ3QgY29udGludWUgcHJvY2Vzc2luZwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNlcHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXhjZXB0aW9uIHRvIHRoZSBs\naXN0LgogICAgICovCiAgICBwcml2YXRlIExpc3QgYWRkKExpc3QgZXhjZXBz\nLCBSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9\nPSBudWxsKQogICAgICAgICAgICBleGNlcHMgPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgIGV4Y2Vwcy5hZGQocmUpOwogICAgICAgIHJldHVybiBleGNl\ncHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBhbGwgZ2F0aGVyZWQg\nZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93RXhj\nZXB0aW9ucyhMaXN0IGV4Y2VwcykgewogICAgICAgIGlmIChleGNlcHMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZXhjZXBz\nLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2Vw\ndGlvbikgZXhjZXBzLmdldCgwKTsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKS4KICAgICAgICAg\nICAgc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIGV4Y2Vwcy50\nb0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMu\nc2l6ZSgpXSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0YWNoLgogICAg\nICovCiAgICBwcml2YXRlIE9iamVjdCBkZXRhY2hJbnRlcm5hbChPYmplY3Qg\ndG9EZXRhY2gpIHsKICAgICAgICBpZiAodG9EZXRhY2ggPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGFscmVhZHkgZGV0\nYWNoZWQ/CiAgICAgICAgaWYgKF9kZXRhY2hlZCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIE9iamVjdCBkZXRhY2hlZCA9IF9kZXRhY2hlZC5nZXQodG9EZXRh\nY2gpOwogICAgICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBkZXRhY2hlZDsKICAgICAgICB9CgogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdl\nckltcGwodG9EZXRhY2gsIHRydWUpOwogICAgICAgIGlmIChfY2FsbCAhPSBu\ndWxsICYmIChfY2FsbC5wcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1Bf\nREVUQUNILAogICAgICAgICAgICB0b0RldGFjaCwgc20pICYgT3BDYWxsYmFj\na3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRvRGV0YWNo\nOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndG9EZXRhY2g7CgogICAgICAgIC8vIENhbGwgUHJlRGV0YWNoIGZpcnN0IGFz\nIHdlIGNhbid0IHRlbGwgaWYgdGhlIG5ldyBzeXN0ZW0KICAgICAgICAvLyBm\naXJlZCBhbiBldmVudCBvciBqdXN0IGRpZCBub3QgZmFpbC4KICAgICAgICBf\nYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudCh0b0RldGFjaCwgbnVsbCwgc20u\nZ2V0TWV0YURhdGEoKSwKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQuQkVG\nT1JFX0RFVEFDSCk7CgogICAgICAgIGlmKCEgX2ZsdXNoZWQpICB7CiAgICAg\nICAgICAgIGlmKF9mbHVzaEJlZm9yZURldGFjaCkgewogICAgICAgICAgICAg\nICAgLy8gYW55IGRpcnR5IGluc3RhbmNlcyBjYXVzZSBhIGZsdXNoIHRvIG9j\nY3VyCiAgICAgICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBfZmx1c2hlZCA9IHRydWU7CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIEJpdFNldCBmaWVsZHMgPSBuZXcgQml0U2V0KCk7\nCiAgICAgICAgcHJlRGV0YWNoKF9icm9rZXIsIHNtLCBmaWVsZHMsIF9mdWxs\nLAogICAgICAgICAgICBfcmVsb2FkT25EZXRhY2gpOwoKICAgICAgICAvLyBj\ncmVhdGUgYW5kIHN0b3JlIG5ldyBvYmplY3QgYmVmb3JlIGNvcHkgdG8gYXZv\naWQgZW5kbGVzcyByZWN1cnNpb24KICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgZGV0YWNoZWRQQzsKICAgICAgICBpZiAoX2Nv\ncHkpCiAgICAgICAgICAgIGRldGFjaGVkUEMgPSBwYy5wY05ld0luc3RhbmNl\nKG51bGwsIHRydWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZGV0YWNo\nZWRQQyA9IHBjOwogICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAg\nICAgICAgICAgX2RldGFjaGVkLnB1dCh0b0RldGFjaCwgZGV0YWNoZWRQQyk7\nCgogICAgICAgIC8vIGRldGFjaCBmaWVsZHMgYW5kIHNldCBkZXRhY2hlZCB2\nYXJpYWJsZXMKICAgICAgICBEZXRhY2hlZFN0YXRlTWFuYWdlciBkZXRTTSA9\nIG51bGw7CiAgICAgICAgaWYgKF9vcHRzLmdldERldGFjaGVkU3RhdGVNYW5h\nZ2VyKCkKICAgICAgICAgICAgJiYgdXNlRGV0YWNoZWRTdGF0ZU1hbmFnZXIo\nc20sIF9vcHRzKQogICAgICAgICAgICAmJiAhKHNtLmlzTmV3KCkgJiYgIXNt\nLmlzRGVsZXRlZCgpICYmICFzbS5pc0ZsdXNoZWQoKSkpCiAgICAgICAgICAg\nIGRldFNNID0gbmV3IERldGFjaGVkU3RhdGVNYW5hZ2VyKGRldGFjaGVkUEMs\nIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBfb3B0cy5nZXRBY2Nlc3NV\nbmxvYWRlZCgpLCBfYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSk7CiAgICAg\nICAgaWYgKF9mdWxsKSB7CiAgICAgICAgICAgIF9mdWxsRk0uc2V0U3RhdGVN\nYW5hZ2VyKHNtKTsKICAgICAgICAgICAgaWYgKF9jb3B5IHx8IF9yZWxvYWRP\nbkRldGFjaCkgewogICAgICAgICAgICAgICAgX2Z1bGxGTS5kZXRhY2hWZXJz\naW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Z1bGxGTS5yZXBy\nb3h5KGRldFNNKTsKICAgICAgICAgICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFn\nZXIobnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSW5zdGFu\nY2VEZXRhY2hGaWVsZE1hbmFnZXIgZm0gPSBuZXcgSW5zdGFuY2VEZXRhY2hG\naWVsZE1hbmFnZXIoZGV0YWNoZWRQQywgZGV0U00pOwogICAgICAgICAgICBm\nbS5zZXRTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICBmbS5kZXRhY2hG\naWVsZHMoZmllbGRzKTsKICAgICAgICB9CgogICAgICAgIGlmICghQm9vbGVh\nbi5GQUxTRS5lcXVhbHMoc20uZ2V0TWV0YURhdGEoKS51c2VzRGV0YWNoZWRT\ndGF0ZSgpKSkKICAgICAgICAgICAgZGV0YWNoZWRQQy5wY1NldERldGFjaGVk\nU3RhdGUoZ2V0RGV0YWNoZWRTdGF0ZShzbSwgZmllbGRzKSk7CiAgICAgICAg\naWYgKCFfY29weSkKICAgICAgICAgICAgc20ucmVsZWFzZShmYWxzZSwgdHJ1\nZSk7CiAgICAgICAgaWYgKGRldFNNICE9IG51bGwpCiAgICAgICAgICAgIGRl\ndGFjaGVkUEMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKGRldFNNKTsKICAgICAg\nICByZXR1cm4gZGV0YWNoZWRQQzsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBib29sZWFuIHVzZURldGFjaGVkU3RhdGVNYW5hZ2VyKFN0YXRlTWFuYWdl\nckltcGwgc20sCiAgICAgICAgRGV0YWNoT3B0aW9ucyBvcHRzKSB7CiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAg\nICAgICByZXR1cm4gIUJvb2xlYW4uRkFMU0UuZXF1YWxzKG1ldGEudXNlc0Rl\ndGFjaGVkU3RhdGUoKSkgJiYKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YS5T\nWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKSAmJgog\nICAgICAgICAgICBvcHRzLmdldERldGFjaGVkU3RhdGVNYW5hZ2VyKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBCYXNlIGRldGFjaCBmaWVsZCBtYW5hZ2Vy\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBEZXRhY2hGaWVs\nZE1hbmFnZXIKICAgICAgICBleHRlbmRzIFRyYW5zZmVyRmllbGRNYW5hZ2Vy\nIHsKCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgc207Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgc291cmNlIHN0YXRlIG1h\nbmFnZXIuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0U3Rh\ndGVNYW5hZ2VyKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAg\ndGhpcy5zbSA9IHNtOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogVHJhbnNmZXIgdGhlIGN1cnJlbnQgdmVyc2lvbiBvYmplY3QgZnJvbSB0\naGUgc3RhdGUgbWFuYWdlciB0byB0aGUKICAgICAgICAgKiBkZXRhY2hlZCBp\nbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBkZXRh\nY2hWZXJzaW9uKCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAg\nICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBKYXZhVHlwZXMuY29udmVydChz\nbS5nZXRWZXJzaW9uKCksCiAgICAgICAgICAgICAgICBmbWQuZ2V0VHlwZUNv\nZGUoKSk7CiAgICAgICAgICAgIHZhbCA9IGZtZC5nZXRGaWVsZFZhbHVlKHZh\nbCwgc20uZ2V0QnJva2VyKCkpOwogICAgICAgICAgICBzd2l0Y2ggKGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGxvbmd2YWwg\nPSAodmFsID09IG51bGwpID8gMEwgOiAoKE51bWJlcikgdmFsKS5sb25nVmFs\ndWUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgZGJsdmFsID0gKHZhbCA9PSBudWxs\nKSA/IDBEIDogKChOdW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgb2JqdmFsID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2Fw\nYWJsZSgpLCB0aGlzLAogICAgICAgICAgICAgICAgZm1kLmdldEluZGV4KCkp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVW5wcm94aWVz\nIHNlY29uZCBjbGFzcyBvYmplY3QgZmllbGRzLgogICAgICAgICAqLwogICAg\nICAgIHB1YmxpYyB2b2lkIHJlcHJveHkoRGV0YWNoZWRTdGF0ZU1hbmFnZXIg\nZHNtKSB7CiAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBz\nbS5nZXRNZXRhRGF0YSgpLmdldFByb3h5RmllbGRzKCkpIHsKICAgICAgICAg\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgICAgICAvLyBscnMgcHJveGllcyBub3QgZGV0YWNoZWQKICAgICAgICAg\nICAgICAgICAgICBpZiAoZm1kLmlzTFJTKCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgb2JqdmFsID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAg\nICAgc20ucmVwbGFjZUZpZWxkKGdldERldGFjaGVkUGVyc2lzdGVuY2VDYXBh\nYmxlKCksIHRoaXMsIGZtZC5nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGdl\ndERldGFjaGVkUGVyc2lzdGVuY2VDYXBhYmxlKCksIHRoaXMsIGZtZC5nZXRJ\nbmRleCgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2JqdmFsIGluc3Rh\nbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUHJveHkg\ncHJveHkgPSAoUHJveHkpIG9ianZhbDsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHByb3h5LmdldENoYW5nZVRyYWNrZXIoKSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkuZ2V0Q2hhbmdlVHJhY2tl\ncigpLnN0b3BUcmFja2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICBw\ncm94eS5zZXRPd25lcihkc20sIChkc20gPT0gbnVsbCkgPyAtMSA6IGZtZC5n\nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXIoKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5z\ndGFuY2UgYmVpbmcgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJv\ndGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXREZXRhY2hlZFBlcnNpc3Rl\nbmNlQ2FwYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHNtLmdldFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEZpZWxkTWFuYWdlciB0aGF0IGNhbiBjb3B5IGFsbCB0aGUgZmllbGRz\nIGZyb20gb25lCiAgICAgKiBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2Ug\ndG8gYW5vdGhlci4gT25lIG9mIHRoZQogICAgICogaW5zdGFuY2VzIG11c3Qg\nYmUgbWFuYWdlZCBieSBhIFN0YXRlTWFuYWdlciwgYW5kIHRoZQogICAgICog\nb3RoZXIgbXVzdCBiZSB1bm1hbmFnZWQuCiAgICAgKgogICAgICogQGF1dGhv\nciBNYXJjIFBydWQnaG9tbWVhdXgKICAgICAqLwogICAgcHJpdmF0ZSBjbGFz\ncyBJbnN0YW5jZURldGFjaEZpZWxkTWFuYWdlcgogICAgICAgIGV4dGVuZHMg\nRGV0YWNoRmllbGRNYW5hZ2VyIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBQ\nZXJzaXN0ZW5jZUNhcGFibGUgX3RvOwogICAgICAgIHByaXZhdGUgZmluYWwg\nRGV0YWNoZWRTdGF0ZU1hbmFnZXIgX2RldFNNOwoKICAgICAgICAvKioKICAg\nICAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGluc3RhbmNlIHRvIHRvIGNv\ncHkgdG8uCiAgICAgICAgICovCiAgICAgICAgcHVibGljIEluc3RhbmNlRGV0\nYWNoRmllbGRNYW5hZ2VyKFBlcnNpc3RlbmNlQ2FwYWJsZSB0bywKICAgICAg\nICAgICAgRGV0YWNoZWRTdGF0ZU1hbmFnZXIgZGV0U00pIHsKICAgICAgICAg\nICAgX3RvID0gdG87CiAgICAgICAgICAgIF9kZXRTTSA9IGRldFNNOwogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBn\nZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2FwYWJsZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIF90bzsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIERldGFjaCB0aGUgZmllbGRzIG9mIHRoZSBzdGF0ZSBtYW5hZ2VyIGdpdmVu\nIG9uIGNvbnN0cnVjdGlvbiB0bwogICAgICAgICAqIHRoZSBwZXJzaXN0ZW5j\nZSBjYXBhYmxlIGdpdmVuIG9uIGNvbnN0cnVjdGlvbi4KICAgICAgICAgKiBP\nbmx5IHRoZSBmaWVsZHMgaW4gdGhlIGdpdmVuIGJpdCBzZXQgd2lsbCBiZSBj\nb3BpZWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0YWNo\nRmllbGRzKEJpdFNldCBmZ2ZpZWxkcykgewogICAgICAgICAgICBQZXJzaXN0\nZW5jZUNhcGFibGUgZnJvbSA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gc20uZ2V0TWV0\nYURhdGEoKS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVs\nZHMoKTsKCiAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAg\nIF90by5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgLy8gd2Ugc3RhcnQgd2l0aCBwayBmaWVs\nZHM6IG9iamVjdHMgbWlnaHQgcmVseSBvbiBwayBmaWVsZHMgZm9yCiAgICAg\nICAgICAgICAgICAvLyBlcXVhbHMgYW5kIGhhc2hDb2RlIG1ldGhvZHMsIGFu\nZCB0aGlzIGVuc3VyZXMgdGhhdCBwayBmaWVsZHMKICAgICAgICAgICAgICAg\nIC8vIGFyZSBzZXQgcHJvcGVybHkgaWYgd2UgcmV0dXJuIGFueSBwYXJ0aWFs\nbHktZGV0YWNoZWQgb2JqZWN0cwogICAgICAgICAgICAgICAgLy8gZHVlIHRv\nIHJlZW50cmFudCBjYWxscyB3aGVuIHRyYXZlcnNpbmcgcmVsYXRpb25zCiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgICAgICBkZXRhY2hGaWVsZChmcm9tLCBw\na3NbaV0uZ2V0SW5kZXgoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBkZXRh\nY2hWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lv\nbigpKSAKICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWNoRmllbGQoZnJv\nbSwgaSwgZmdmaWVsZHMuZ2V0KGkpKTsKICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIC8vIGNsZWFyIHRoZSBTdGF0ZU1hbmFnZXIg\nZnJvbSB0aGUgdGFyZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgaWYgKF9j\nb3B5KQogICAgICAgICAgICAgICAgICAgIF90by5wY1JlcGxhY2VTdGF0ZU1h\nbmFnZXIobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIERldGFjaCAob3IgY2xlYXIpIHRoZSBnaXZlbiBm\naWVsZCBpbmRleC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQg\nZGV0YWNoRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIGZyb20sIGludCBpLCBi\nb29sZWFuIGZnKSB7CiAgICAgICAgICAgIC8vIHRlbGwgdGhlIHN0YXRlIG1h\nbmFnZXIgdG8gcHJvdmlkZSB0aGUgZmllbGRzIGZyb20gdGhlIHNvdXJjZSB0\nbwogICAgICAgICAgICAvLyB0aGlzIGZpZWxkIG1hbmFnZXIsIHdoaWNoIHdp\nbGwgdGhlbiByZXBsYWNlIHRoZSBmaWVsZCB3aXRoIGEKICAgICAgICAgICAg\nLy8gZGV0YWNoZWQgdmVyc2lvbgogICAgICAgICAgICBpZiAoZmcpCiAgICAg\nICAgICAgICAgICBzbS5wcm92aWRlRmllbGQoZnJvbSwgdGhpcywgaSk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKCFfY29weSkgewogICAgICAgICAgICAgICAg\nLy8gaWYgbm90IGNvcHlpbmcgYW5kIGZpZWxkIHNob3VsZCBub3QgYmUgZGV0\nYWNoZWQsIGNsZWFyIGl0CiAgICAgICAgICAgICAgICBjbGVhcigpOwogICAg\nICAgICAgICAgICAgc20ucmVwbGFjZUZpZWxkKF90bywgdGhpcywgaSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlQm9vbGVhbkZpZWxkKGludCBmaWVsZCwgYm9vbGVhbiBjdXJWYWwpIHsK\nICAgICAgICAgICAgc3VwZXIuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1\nclZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMs\nIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3Jl\nQnl0ZUZpZWxkKGludCBmaWVsZCwgYnl0ZSBjdXJWYWwpIHsKICAgICAgICAg\nICAgc3VwZXIuc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAg\nICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGlu\ndCBmaWVsZCwgY2hhciBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3Rv\ncmVDaGFyRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJl\ncGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHN0b3JlRG91YmxlRmllbGQoaW50IGZpZWxkLCBk\nb3VibGUgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlRG91Ymxl\nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VG\naWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IGN1\nclZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZUZsb2F0RmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8s\nIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHN0b3JlSW50RmllbGQoaW50IGZpZWxkLCBpbnQgY3VyVmFsKSB7CiAgICAg\nICAgICAgIHN1cGVyLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZ0ZpZWxk\nKGludCBmaWVsZCwgbG9uZyBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIu\nc3RvcmVMb25nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNt\nLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQs\nIHNob3J0IGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVNob3J0\nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VG\naWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIHN0b3JlU3RyaW5nRmllbGQoaW50IGZpZWxkLCBTdHJpbmcg\nY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlU3RyaW5nRmllbGQo\nZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChf\ndG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3VyVmFs\nKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlT2JqZWN0RmllbGQoZmllbGQs\nIGRldGFjaEZpZWxkKGN1clZhbCwgZmllbGQpKTsKICAgICAgICAgICAgc20u\ncmVwbGFjZUZpZWxkKF90bywgdGhpcywgZmllbGQpOwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoZSBvd25lciBvZiB0aGUgZmll\nbGQncyBwcm94eSB0byB0aGUgZGV0YWNoZWQgc3RhdGUgbWFuYWdlci4KICAg\nICAgICAgKi8KICAgICAgICBwcml2YXRlIE9iamVjdCByZXByb3h5KE9iamVj\ndCBvYmosIGludCBmaWVsZCkgewogICAgICAgICAgICBpZiAob2JqICE9IG51\nbGwgJiYgX2RldFNNICE9IG51bGwgJiYgb2JqIGluc3RhbmNlb2YgUHJveHkp\nCiAgICAgICAgICAgICAgICAoKFByb3h5KSBvYmopLnNldE93bmVyKF9kZXRT\nTSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogRGV0YWNoIHRoZSBnaXZlbiB2YWx1\nZSBpZiBuZWVkZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmpl\nY3QgZGV0YWNoRmllbGQoT2JqZWN0IGN1clZhbCwgaW50IGZpZWxkKSB7CiAg\nICAgICAgICAgIGlmIChjdXJWYWwgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAg\nICAgCiAgICAgICAgICAgIGJvb2xlYW4gY2FzY2FkZSA9IGZhbHNlOwogICAg\nICAgICAgICBpZihfY2FzY2FkZVdpdGhEZXRhY2gKICAgICAgICAgICAgICAg\nIHx8IGZtZC5nZXRDYXNjYWRlRGV0YWNoKCkgPT0gCiAgICAgICAgICAgICAg\nICAgICAgVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAg\nICAgICAgICAgfHwgZm1kLmdldEtleSgpLmdldENhc2NhZGVEZXRhY2goKSA9\nPSAKICAgICAgICAgICAgICAgICAgICBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFIAogICAgICAgICAgICAgICAgfHwgZm1kLmdldEVsZW1lbnQo\nKS5nZXRDYXNjYWRlRGV0YWNoKCkgPT0gCiAgICAgICAgICAgICAgICAgICAg\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAg\nICAgICAgY2FzY2FkZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgCiAgICAgICAgICAgIE9iamVjdCBuZXdWYWwgPSBudWxsOwogICAgICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAg\nICBpZiAoX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3By\nb3h5LmNvcHlBcnJheShjdXJWYWwpOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAg\nICAgICAgIGlmIChjYXNjYWRlKSB7CiAgICAgICAgICAgICAgICAgICAgZGV0\nYWNoQXJyYXkobmV3VmFsLCBmbWQpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbDsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIGlmIChfY29w\neSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfZGV0U00gIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkubmV3\nQ29sbGVjdGlvblByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFy\nZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0\nSW5pdGlhbGl6ZXIoKSBpbnN0YW5jZW9mIENvbXBhcmF0b3IgPwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKENvbXBhcmF0b3IpIGZtZC5nZXRJbml0\naWFsaXplcigpIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLmdldEJyb2tlcigpLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nLmdldEF1dG9PZmYoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICgoQ29s\nbGVjdGlvbikgbmV3VmFsKS5hZGRBbGwoKENvbGxlY3Rpb24pIGN1clZhbCk7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgICAgIG5ld1ZhbCA9IF9wcm94eS5jb3B5Q29sbGVjdGlvbigoQ29sbGVj\ndGlvbikgY3VyVmFsKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAgICAgICAg\nIGlmIChjYXNjYWRlKSB7CiAgICAgICAgICAgICAgICAgICAgZGV0YWNoQ29s\nbGVjdGlvbigoQ29sbGVjdGlvbikgbmV3VmFsLCAoQ29sbGVjdGlvbikgY3Vy\nVmFsLAogICAgICAgICAgICAgICAgICAgICAgICBmbWQpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFs\nLCBmaWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgIGlmIChfY29weSkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChfZGV0U00gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBuZXdWYWwgPSBfcHJveHkubmV3TWFwUHJveHkoZm1kLmdldFByb3h5VHlw\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEtleSgp\nLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRJbml0aWFsaXplcigpIGlu\nc3RhbmNlb2YgQ29tcGFyYXRvciA/CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKENvbXBhcmF0b3IpIGZtZC5nZXRJbml0aWFsaXplcigpIDog\nbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5nZXRC\ncm9rZXIoKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuZ2V0\nQXV0b09mZigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgKChNYXApIG5l\nd1ZhbCkucHV0QWxsKChNYXApIGN1clZhbCk7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IF9w\ncm94eS5jb3B5TWFwKChNYXApIGN1clZhbCk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBjdXJWYWw7CiAg\nICAgICAgICAgICAgICBpZiAoY2FzY2FkZSkgewogICAgICAgICAgICAgICAg\nICAgIGRldGFjaE1hcCgoTWFwKSBuZXdWYWwsIChNYXApIGN1clZhbCwgZm1k\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBy\nZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIG5ld1ZhbCA9IChfY29w\neSkgPyBfcHJveHkuY29weUNhbGVuZGFyKChDYWxlbmRhcikgY3VyVmFsKSA6\nCiAgICAgICAgICAgICAgICAgICAgY3VyVmFsOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHJlcHJveHkobmV3VmFsLCBmaWVsZCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBuZXdWYWwgPSAo\nX2NvcHkpID8gX3Byb3h5LmNvcHlEYXRlKChEYXRlKSBjdXJWYWwpIDogY3Vy\nVmFsOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFsLCBm\naWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAg\nICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICBu\nZXdWYWwgPSBfcHJveHkuY29weUN1c3RvbShjdXJWYWwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHJlcHJveHkoKG5ld1ZhbCA9PSBudWxsKSA/IGN1clZh\nbCA6IG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5QQzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoK\nICAgICAgICAgICAgICAgIGlmIChjYXNjYWRlKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGRldGFjaEludGVybmFsKGN1clZhbCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY3VyVmFsOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGN1clZh\nbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogTWFrZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBh\ncnJheSBhcmUgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSB2b2lkIGRldGFjaEFycmF5KE9iamVjdCBhcnJheSwgRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICAgICAgaWYgKCFmbWQuZ2V0RWxlbWVudCgpLmlz\nRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgICAgIGludCBsZW4gPSBBcnJheS5nZXRMZW5ndGgoYXJyYXkpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKQogICAg\nICAgICAgICAgICAgQXJyYXkuc2V0KGFycmF5LCBpLCBkZXRhY2hJbnRlcm5h\nbChBcnJheS5nZXQoYXJyYXksIGkpKSk7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhl\nIGdpdmVuIGNvbGxlY3Rpb24gYXJlIGRldGFjaGVkLgogICAgICAgICAqLwog\nICAgICAgIHByaXZhdGUgdm9pZCBkZXRhY2hDb2xsZWN0aW9uKENvbGxlY3Rp\nb24gY29sbCwgQ29sbGVjdGlvbiBvcmlnLAogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgICAgICAvLyBjb2xsIGNhbiBiZSBudWxs\nIGlmIG5vdCBjb3B5YWJsZQogICAgICAgICAgICBpZiAoX2NvcHkgJiYgY29s\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1jb3B5YWJsZSIsIGZtZCkpOwogICAgICAg\nICAgICBpZiAoIWZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygp\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gdW5m\nb3J0dW5hdGVseSB3ZSBoYXZlIHRvIGNsZWFyIHRoZSBvcmlnaW5hbCBhbmQg\ncmUtYWRkIHRvIGNvcHkKICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAg\nICAgICAgICAgY29sbC5jbGVhcigpOwogICAgICAgICAgICBPYmplY3QgZGV0\nYWNoZWQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb3JpZy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nZGV0YWNoZWQgPSBkZXRhY2hJbnRlcm5hbChpdHIubmV4dCgpKTsKICAgICAg\nICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICBjb2xs\nLmFkZChkZXRhY2hlZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIE1ha2Ugc3VyZSBhbGwgdGhlIHZhbHVlcyBp\nbiB0aGUgZ2l2ZW4gbWFwIGFyZSBkZXRhY2hlZC4KICAgICAgICAgKi8KICAg\nICAgICBwcml2YXRlIHZvaWQgZGV0YWNoTWFwKE1hcCBtYXAsIE1hcCBvcmln\nLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgICAgICAvLyBtYXAgY2Fu\nIGJlIG51bGwgaWYgbm90IGNvcHlhYmxlCiAgICAgICAgICAgIGlmIChfY29w\neSAmJiBtYXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtY29weWFibGUiLCBmbWQpKTsK\nICAgICAgICAgICAgYm9vbGVhbiBrZXlQQyA9IGZtZC5nZXRLZXkoKS5pc0Rl\nY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgICAgIGJvb2xlYW4gdmFsUEMgPSBm\nbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAgICAg\nICAgaWYgKCFrZXlQQyAmJiAhdmFsUEMpCiAgICAgICAgICAgICAgICByZXR1\ncm47CgogICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHRvIGNvcHkga2V5cywg\nanVzdCBjbGVhciBhbmQgcmUtYWRkOyBvdGhlcndpc2UKICAgICAgICAgICAg\nLy8gd2UgY2FuIHVzZSB0aGUgZW50cnkgc2V0IHRvIHJlc2V0IHRoZSB2YWx1\nZXMgb25seQogICAgICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAg\nICAgIGlmICghX2NvcHkgfHwga2V5UEMpIHsKICAgICAgICAgICAgICAgIGlm\nIChfY29weSkKICAgICAgICAgICAgICAgICAgICBtYXAuY2xlYXIoKTsKICAg\nICAgICAgICAgICAgIE9iamVjdCBrZXksIHZhbDsKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gb3JpZy5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KXsKICAgICAgICAgICAgICAgICAgICBlbnRy\neSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAg\nICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGtleVBDKQogICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSBkZXRh\nY2hJbnRlcm5hbChrZXkpOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IGVu\ndHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbFBD\nKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBkZXRhY2hJbnRlcm5h\nbCh2YWwpOwogICAgICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAg\nICAgICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIHZhbCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgZW50\ncnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCAoKTsKICAgICAgICAgICAgICAg\nICAgICBlbnRyeS5zZXRWYWx1ZSAoZGV0YWNoSW50ZXJuYWwgKGVudHJ5Lmdl\ndFZhbHVlICgpKSk7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0K\n","encoding":"base64"}

