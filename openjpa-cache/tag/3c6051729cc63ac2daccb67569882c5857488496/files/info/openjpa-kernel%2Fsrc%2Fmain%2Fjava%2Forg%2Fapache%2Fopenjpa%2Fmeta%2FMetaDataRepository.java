{"sha":"dae47dfedf9875e5e41e91d27912668f15625efb","node_id":"MDQ6QmxvYjIwNjM2NDpkYWU0N2RmZWRmOTg3NWU1ZTQxZTkxZDI3OTEyNjY4ZjE1NjI1ZWZi","size":95378,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/dae47dfedf9875e5e41e91d27912668f15625efb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0Owpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlRyZWVTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3Ry\neS5SZWdpc3RlckNsYXNzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTXVsdGlDbGFz\nc0xvYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlN0\ncmluZ0Rpc3RhbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PcGVuSlBBSWQ7CgppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7\nCgovKioKICogUmVwb3NpdG9yeSBvZiBhbmQgZmFjdG9yeSBmb3IgcGVyc2lz\ndGVudCBtZXRhZGF0YS4KICogCiAqIEBzaW5jZSAwLjMuMAogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbSAocXVlcnkgbWV0YWRh\ndGEpCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNs\nYXNzIE1ldGFEYXRhUmVwb3NpdG9yeSBpbXBsZW1lbnRzIFBDUmVnaXN0cnku\nUmVnaXN0ZXJDbGFzc0xpc3RlbmVyLCBDb25maWd1cmFibGUsIENsb3NlYWJs\nZSwgTWV0YURhdGFNb2RlcywKICAgIFNlcmlhbGl6YWJsZSB7CgogICAgLyoq\nCiAgICAgKiBDb25zdGFudCB0byBub3QgdmFsaWRhdGUgYW55IG1ldGFkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFU\nRV9OT05FID0gMDsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlk\nYXRlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBWQUxJREFURV9NRVRBID0gMTsKCiAgICAvKioKICAgICAqIEJpdCBm\nbGFnIHRvIHZhbGlkYXRlIG1hcHBpbmdzLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9NQVBQSU5HID0gMjsKCiAgICAv\nKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlkYXRlIHVuZW5oYW5jZWQgbWV0\nYWRhdGEgb25seS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgVkFMSURBVEVfVU5FTkhBTkNFRCA9IDQ7CgogICAgLyoqCiAgICAgKiBC\naXQgZmxhZyBmb3IgcnVudGltZSB2YWxpZGF0aW9uLiBSZXF1aXJlcyB0aGF0\nIGFsbCBjbGFzc2VzIGFyZSBlbmhhbmNlZCwgYW5kIHBlcmZvcm1zIGV4dHJh\nCiAgICAgKiBmaWVsZCByZXNvbHV0aW9uIHN0ZXBzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9SVU5USU1FID0gODsK\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzPD8+W10gRU1QVFlf\nQ0xBU1NFUyA9IG5ldyBDbGFzc1swXTsKICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gRU1QVFlfTk9OX1BFUlNJ\nU1RFTlQgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhWzBdOwogICAgcHJv\ndGVjdGVkIGZpbmFsIENsYXNzTWV0YURhdGFbXSBFTVBUWV9NRVRBUzsKICAg\nIHByb3RlY3RlZCBmaW5hbCBGaWVsZE1ldGFEYXRhW10gRU1QVFlfRklFTERT\nOwogICAgcHJvdGVjdGVkIGZpbmFsIE9yZGVyW10gRU1QVFlfT1JERVJTOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyLmZvclBhY2thZ2UoTWV0YURhdGFSZXBvc2l0b3J5LmNsYXNzKTsK\nCiAgICAvLyBzeXN0ZW0gc2VxdWVuY2UKICAgIHByaXZhdGUgU2VxdWVuY2VN\nZXRhRGF0YSBfc3lzU2VxID0gbnVsbDsKICAgIC8vIGNhY2hlIG9mIHBhcnNl\nZCBtZXRhZGF0YSwgb2lkIGNsYXNzIHRvIGNsYXNzLCBhbmQgaW50ZXJmYWNl\nIGNsYXNzCiAgICAvLyB0byBtZXRhZGF0YXMKICAgIHByaXZhdGUgTWFwPENs\nYXNzPD8+LCBDbGFzc01ldGFEYXRhPiBfbWV0YXMgPSBuZXcgSGFzaE1hcDxD\nbGFzczw/PiwgQ2xhc3NNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPENs\nYXNzPD8+LCBDbGFzczw/Pj4gX29pZHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJv\nbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNzPD8+PigpKTsK\nICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBDb2xsZWN0aW9uPENsYXNzPD8+\nPj4gX2ltcGxzID0KICAgICAgICBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRN\nYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENvbGxlY3Rpb248Q2xhc3M8Pz4+\nPigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBDbGFzczw/Pj4gX2lm\nYWNlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+KCkpOwogICAgcHJpdmF0ZSBNYXA8T2Jq\nZWN0LCBRdWVyeU1ldGFEYXRhPiBfcXVlcmllcyA9IG5ldyBIYXNoTWFwPE9i\namVjdCwgUXVlcnlNZXRhRGF0YT4oKTsKICAgIHByaXZhdGUgTWFwPFN0cmlu\nZywgU2VxdWVuY2VNZXRhRGF0YT4gX3NlcXMgPSBuZXcgSGFzaE1hcDxTdHJp\nbmcsIFNlcXVlbmNlTWV0YURhdGE+KCk7CiAgICBwcml2YXRlIE1hcDxTdHJp\nbmcsIExpc3Q8Q2xhc3M8Pz4+PiBfYWxpYXNlcyA9IENvbGxlY3Rpb25zLnN5\nbmNocm9uaXplZE1hcChuZXcgSGFzaE1hcDxTdHJpbmcsIExpc3Q8Q2xhc3M8\nPz4+PigpKTsKICAgIHByaXZhdGUgTWFwPENsYXNzPD8+LCBOb25QZXJzaXN0\nZW50TWV0YURhdGE+IF9wYXdhcmVzID0KICAgICAgICBDb2xsZWN0aW9ucy5z\neW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YT4oKSk7CiAgICBwcml2YXRlIE1hcDxDbGFzczw/Piwg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhPiBfbm9uTWFwcGVkID0KICAgICAgICBD\nb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8\nPz4sIE5vblBlcnNpc3RlbnRNZXRhRGF0YT4oKSk7CiAgICBwcml2YXRlIE1h\ncDxDbGFzczw/PiwgQ2xhc3M8Pz4+IF9tZXRhbW9kZWwgPSBDb2xsZWN0aW9u\ncy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNz\nPD8+PigpKTsKCiAgICAvLyBtYXAgb2YgY2xhc3NlcyB0byBsaXN0cyBvZiB0\naGVpciBzdWJjbGFzc2VzCiAgICBwcml2YXRlIE1hcDxDbGFzczw/PiwgTGlz\ndDxDbGFzczw/Pj4+IF9zdWJzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVk\nTWFwKG5ldyBIYXNoTWFwPENsYXNzPD8+LCBMaXN0PENsYXNzPD8+Pj4oKSk7\nCgogICAgLy8geG1sIG1hcHBpbmcKICAgIHByb3RlY3RlZCBmaW5hbCBYTUxN\nZXRhRGF0YVtdIEVNUFRZX1hNTE1FVEFTOwogICAgcHJpdmF0ZSBmaW5hbCBN\nYXA8Q2xhc3M8Pz4sIFhNTE1ldGFEYXRhPiBfeG1sbWV0YXMgPSBuZXcgSGFz\naE1hcDxDbGFzczw/PiwgWE1MTWV0YURhdGE+KCk7CgogICAgcHJpdmF0ZSB0\ncmFuc2llbnQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmYgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxsOwogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBfaW1wbEdl\nbiA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBNZXRhRGF0YUZhY3Rv\ncnkgX2ZhY3RvcnkgPSBudWxsOwoKICAgIHByaXZhdGUgaW50IF9yZXNNb2Rl\nID0gTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HOwogICAgcHJpdmF0ZSBpbnQg\nX3NvdXJjZU1vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RF\nX1FVRVJZOwogICAgcHJpdmF0ZSBpbnQgX3ZhbGlkYXRlID0gVkFMSURBVEVf\nTUVUQSB8IFZBTElEQVRFX1VORU5IQU5DRUQ7CgogICAgLy8gd2UgYnVmZmVy\nIHVwIGFueSBjbGFzc2VzIHRoYXQgcmVnaXN0ZXIgdGhlbXNlbHZlcyB0byBw\ncmV2ZW50CiAgICAvLyByZWVudHJhbmN5IGVycm9ycyBpZiBjbGFzc2VzIHJl\nZ2lzdGVyIGR1cmluZyBhIGN1cnJlbnQgcGFyc2UgKGNvbW1vbikKICAgIHBy\naXZhdGUgZmluYWwgQ29sbGVjdGlvbjxDbGFzczw/Pj4gX3JlZ2lzdGVyZWQg\nPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4oKTsKCiAgICAvLyBzZXQgb2YgbWV0\nYWRhdGFzIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAg\ncHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3Qg\nX3Jlc29sdmluZyA9IG5ldyBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxp\nc3QoKTsKICAgIHByaXZhdGUgZmluYWwgSW5oZXJpdGFuY2VPcmRlcmVkTWV0\nYURhdGFMaXN0IF9tYXBwaW5nID0gbmV3IEluaGVyaXRhbmNlT3JkZXJlZE1l\ndGFEYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBMaXN0PFJ1bnRpbWVF\neGNlcHRpb24+IF9lcnJzID0gbmV3IExpbmtlZExpc3Q8UnVudGltZUV4Y2Vw\ndGlvbj4oKTsKCiAgICAvLyBzeXN0ZW0gbGlzdGVuZXJzCiAgICBwcml2YXRl\nIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgX2xpc3RlbmVy\ncyA9IG5ldyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KDMp\nOwoKICAgIHByb3RlY3RlZCBib29sZWFuIF9wcmVsb2FkID0gZmFsc2U7CiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBfcHJlbG9hZENvbXBsZXRlID0gZmFsc2U7\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBfbG9ja2luZyA9IHRydWU7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUFJFTE9BRF9TVFIgPSAiUHJl\nbG9hZCI7CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVvcmRlck1ldGFE\nYXRhUmVzb2x1dGlvbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICogRGVmYXVs\ndCBjb25zdHJ1Y3Rvci4gQ29uZmlndXJlIHZpYSB7QGxpbmsgQ29uZmlndXJh\nYmxlfS4KICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSgp\nIHsKICAgICAgICBFTVBUWV9NRVRBUyA9IG5ld0NsYXNzTWV0YURhdGFBcnJh\neSgwKTsKICAgICAgICBFTVBUWV9GSUVMRFMgPSBuZXdGaWVsZE1ldGFEYXRh\nQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfT1JERVJTID0gbmV3T3JkZXJBcnJh\neSgwKTsKICAgICAgICBFTVBUWV9YTUxNRVRBUyA9IG5ld1hNTENsYXNzTWV0\nYURhdGFBcnJheSgwKTsKICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgY29uZmlndXJhdGlvbiBmb3IgdGhlIHJlcG9zaXRvcnku\nCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgbG9nLgogICAg\nICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4g\nX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBJL08gdXNlZCB0byBs\nb2FkIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFGYWN0\nb3J5IGdldE1ldGFEYXRhRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2Zh\nY3Rvcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgSS9PIHVzZWQgdG8g\nbG9hZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWV0\nYURhdGFGYWN0b3J5KE1ldGFEYXRhRmFjdG9yeSBmYWN0b3J5KSB7CiAgICAg\nICAgZmFjdG9yeS5zZXRSZXBvc2l0b3J5KHRoaXMpOwogICAgICAgIF9mYWN0\nb3J5ID0gZmFjdG9yeTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0byA8Y29kZT5WQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0VmFsaWRhdGUoKSB7CiAgICAgICAgcmV0\ndXJuIF92YWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0byA8Y29kZT5WQUxJ\nREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRlKGludCB2YWxpZGF0ZSkg\newogICAgICAgIF92YWxpZGF0ZSA9IHZhbGlkYXRlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1\nbHRzIHRvCiAgICAgKiA8Y29kZT5WQUxJREFURV9NRVRBIHwgVkFMSURBVEVf\nTUFQUElORyB8IFZBTElEQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRWYWxpZGF0ZShpbnQgdmFsaWRhdGUsIGJv\nb2xlYW4gb24pIHsKICAgICAgICBpZiAodmFsaWRhdGUgPT0gVkFMSURBVEVf\nTk9ORSkKICAgICAgICAgICAgX3ZhbGlkYXRlID0gdmFsaWRhdGU7CiAgICAg\nICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF92YWxpZGF0ZSB8PSB2YWxp\nZGF0ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF92YWxpZGF0ZSAmPSB+\ndmFsaWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEg\ncmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0cyB0byA8Y29kZT5NT0RFX01FVEEg\nfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRpb24gbW9k\nZS4gRGVmYXVsdHMgdG8gPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5H\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShp\nbnQgbW9kZSkgewogICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERl\nZmF1bHRzIHRvIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1v\nZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05P\nTkUpCiAgICAgICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9yZXNNb2RlICY9IH5tb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdo\nYXQgbWV0YWRhdGEgdG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2Rl\nPk1PREVfTUVUQSB8IE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9zb3VyY2VNb2RlOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEg\ndG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8\nIE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAg\nICAgX3NvdXJjZU1vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEgdG8g\nbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1P\nREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfc291cmNlTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAg\nICAgICAgICAgIF9zb3VyY2VNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfc291cmNlTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldHMgd2hldGhlciB0aGlzIHJlcG9zaXRvcnkgd2lsbCBs\nb2FkIGFsbCBrbm93biBwZXJzaXN0ZW50IGNsYXNzZXMgYXQgaW5pdGlhbGl6\nYXRpb24uCiAgICAgKiBEZWZhdWx0cyB0byBmYWxzZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0UHJlbG9hZCgpIHsKICAgICAgICByZXR1cm4g\nX3ByZWxvYWQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0cyB3aGV0\naGVyIHRoaXMgcmVwb3NpdG9yeSB3aWxsIGxvYWQgYWxsIGtub3duIHBlcnNp\nc3RlbnQgY2xhc3NlcyBhdCBpbml0aWFsaXphdGlvbi4KICAgICAqIERlZmF1\nbHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmVs\nb2FkKGJvb2xlYW4gbCkgewogICAgICAgIF9wcmVsb2FkID0gbDsKICAgIH0K\nCgogICAgIC8qKgogICAgICogSWYgdGhlIG9wZW5qcGEuTWV0YURhdGFSZXBv\nc2l0b3J5IHBsdWdpbiB2YWx1ZSBQcmVsb2FkPXRydWUgaXMgc2V0LCB0aGlz\nIG1ldGhvZCB3aWxsIGxvYWQgYWxsCiAgICAgKiBNZXRhRGF0YSBmb3IgYWxs\nIHBlcnNpc3RlbnQgY2xhc3NlcyBhbmQgd2lsbCByZW1vdmUgbG9ja2luZyBm\ncm9tIHRoaXMgY2xhc3MuIAogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIHZvaWQgcHJlbG9hZCgpIHsKICAgICAgICBpZiAoX3ByZWxvYWQgPT0g\nZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAg\nICAvLyBJZiBwb29saW5nIEVNRnMsIHRoaXMgbWV0aG9kIG1heSBiZSBpbnZv\na2VkIG1vcmUgdGhhbiBvbmNlLiBPbmx5IHBlcmZvcm0gdGhpcyB3b3JrIG9u\nY2UuCiAgICAgICAgaWYgKF9wcmVsb2FkQ29tcGxldGUgPT0gdHJ1ZSkgewog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNdWx0aUNs\nYXNzTG9hZGVyIG11bHRpID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIubmV3TXVsdGlDbGFzc0xvYWRlckFjdGlvbigp\nKTsKICAgICAgICBtdWx0aS5hZGRDbGFzc0xvYWRlcihBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xh\nc3NMb2FkZXJBY3Rpb24oKSkpOwogICAgICAgIG11bHRpLmFkZENsYXNzTG9h\nZGVyKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgIC5nZXRDbGFzc0xvYWRlckFjdGlvbihNZXRhRGF0\nYVJlcG9zaXRvcnkuY2xhc3MpKSk7CgogICAgICAgIFNldDxTdHJpbmc+IGNs\nYXNzZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBtdWx0aSk7\nCiAgICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCB8fCBjbGFzc2VzLnNpemUo\nKSA9PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVhZ2VyLW5vbmUiKSk7\nCiAgICAgICAgfQogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkg\nPT0gdHJ1ZSkgewogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJy\nZXBvcy1pbml0aWFsaXplRWFnZXItZm91bmQiLCBjbGFzc2VzKSk7CiAgICAg\nICAgfQoKICAgICAgICBMaXN0PENsYXNzPD8+PiBsb2FkZWQgPSBuZXcgQXJy\nYXlMaXN0PENsYXNzPD8+PigpOwogICAgICAgIGZvciAoU3RyaW5nIGMgOiBj\nbGFzc2VzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBD\nbGFzczw/PiBjbHMgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgo\nSjJEb1ByaXZIZWxwZXIuZ2V0Rm9yTmFtZUFjdGlvbihjLCB0cnVlLCBtdWx0\naSkpKTsKICAgICAgICAgICAgICAgIGxvYWRlZC5hZGQoY2xzKTsKICAgICAg\nICAgICAgICAgIC8vIFRoaXMgY2FsbCBtYXkgYmUgdW5uZWNlc3Nhcnk/CiAg\nICAgICAgICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywgTU9ERV9BTEwsIG11\nbHRpKTsKICAgICAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4\nY2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVwb3MtaW5pdGlhbGl6ZUVhZ2Vy\nLWVycm9yIiksIHBhZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmVzb2x2ZUFsbChtdWx0aSk7CgogICAgICAgIC8vIEhvb2sgaW4gdGhp\ncyBjbGFzcyBhcyBhIGxpc3RlbmVyIGFuZCBwcm9jZXNzIHJlZ2lzdGVyZWQg\nY2xhc3NlcyBsaXN0IHRvIHBvcHVsYXRlIF9hbGlhc2VzCiAgICAgICAgLy8g\nbGlzdC4KICAgICAgICBQQ1JlZ2lzdHJ5LmFkZFJlZ2lzdGVyQ2xhc3NMaXN0\nZW5lcih0aGlzKTsKICAgICAgICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMo\nbXVsdGkpOwogICAgICAgIF9sb2NraW5nID0gZmFsc2U7CiAgICAgICAgX3By\nZWxvYWRDb21wbGV0ZSA9IHRydWU7CiAgICB9CgogICAgCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4K\nICAgICAqIAogICAgICogQHBhcmFtIGNscwogICAgICogICAgICAgICAgICB0\naGUgY2xhc3MgdG8gcmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFy\nYW0gZW52TG9hZGVyCiAgICAgKiAgICAgICAgICAgIHRoZSBlbnZpcm9ubWVu\ndGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVzdEV4\naXN0CiAgICAgKiAgICAgICAgICAgIGlmIHRydWUsIHRocm93cyBhIHtAbGlu\nayBNZXRhRGF0YUV4Y2VwdGlvbn0gaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4g\nbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCh0aGlzKXsKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9hZGVyLCBtdXN0RXhp\nc3QpOyAgICAKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJldHVybiBnZXRNZXRhRGF0YUludGVybmFsKGNscywgZW52TG9h\nZGVyLCBtdXN0RXhpc3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGFJbnRlcm5hbChDbGFzczw/PiBj\nbHMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3Qp\nIHsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsICYmIER5bmFtaWNQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQog\nICAgICAgICAgICAgICAgY2xzID0gY2xzLmdldFN1cGVyY2xhc3MoKTsKCiAg\nICAgICAgICAgIC8vIGlmIGNscyBpcyBhIGdlbmVyYXRlZCBpbnRlcmZhY2Us\nIHVzZSB0aGUgdXNlciBpbnRlcmZhY2UKICAgICAgICAgICAgLy8gdG8gbG9j\nYXRlIG1ldGFkYXRhCiAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBf\naW1wbEdlbiAhPSBudWxsICYmIF9pbXBsR2VuLmlzSW1wbFR5cGUoY2xzKSkK\nICAgICAgICAgICAgICAgIGNscyA9IF9pbXBsR2VuLnRvTWFuYWdlZEludGVy\nZmFjZShjbHMpOwoKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVudkxvYWRlcik7CiAgICAgICAg\nICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KSB7CiAgICAgICAg\nICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgIUltcGxIZWxwZXIuaXNNYW5h\nZ2VkVHlwZShfY29uZiwgY2xzKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEtbm90\ncGMiLCBjbHMpKS5zZXRGYXRhbChmYWxzZSk7CgogICAgICAgICAgICAgICAg\nU2V0PFN0cmluZz4gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMo\nZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgICAgICAgICBpZiAocGNOYW1l\ncyAhPSBudWxsICYmIHBjTmFtZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW1ldGEtdHlwZXMiLCBjbHMsIHBjTmFtZXMpKTsKCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLW1ldGEiLCBjbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNv\nbHZlKG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZl\nbiBhbGlhcyBuYW1lLgogICAgICogCiAgICAgKiBAcGFyYW0gYWxpYXMKICAg\nICAqICAgICAgICAgICAgdGhlIGFsaWFzIHRvIGNsYXNzIHRvIHJldHJpZXZl\nIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICog\nICAgICAgICAgICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlm\nIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAgICAgICAg\nICBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259\nIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKiBAc2VlIENsYXNzTWV0\nYURhdGEjZ2V0VHlwZUFsaWFzCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhKFN0cmluZyBhbGlhcywgQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChh\nbGlhcyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRh\nIiwgYWxpYXMsIF9hbGlhc2VzKSk7CiAgICAgICAgaWYgKGFsaWFzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVj\nayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZM\nb2FkZXIpOwogICAgICAgIExpc3Q8Q2xhc3M8Pz4+IGNsYXNzTGlzdCA9IF9h\nbGlhc2VzLmdldChhbGlhcyk7CgogICAgICAgIC8vIG11bHRpcGxlIGNsYXNz\nZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVkIHdpdGggdGhlIHNhbWUgYWxpYXM6\nIHdlCiAgICAgICAgLy8gd2lsbCBmaWx0ZXIgYnkgY2hlY2tpbmcgYWdhaW5z\ndCB0aGUgY3VycmVudCBsaXN0IG9mIHRoZQogICAgICAgIC8vIHBlcnNpc3Rl\nbnQgdHlwZXMgYW5kIGZpbHRlciBiYXNlZCBvbiB3aGljaCBjbGFzc2VzIGFy\nZSBsb2FkYWJsZQogICAgICAgIC8vIHZpYSB0aGUgY3VycmVudCBlbnZpcm9u\nbWVudCdzIENsYXNzTG9hZGVyCiAgICAgICAgU2V0PFN0cmluZz4gcGNOYW1l\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgQ2xhc3M8Pz4gY2xzID0gbnVsbDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgY2xhc3NMaXN0ICE9IG51bGwgJiYgaSA8IGNsYXNzTGlzdC5z\naXplKCk7IGkrKykgewogICAgICAgICAgICBDbGFzczw/PiBjID0gY2xhc3NM\naXN0LmdldChpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIC8vIHJlLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBjdXJyZW50IGVudmlyb25t\nZW50IGxvYWRlciBzbwogICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBjYW4g\naGFuZGxlIHJlZGVwbG95bWVudCBvZiB0aGUgc2FtZSBjbGFzcyBuYW1lCiAg\nICAgICAgICAgICAgICBDbGFzczw/PiBuYyA9IENsYXNzLmZvck5hbWUoYy5n\nZXROYW1lKCksIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAgICAgICAgICAgICAg\nIC8vIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBvZiBwZXJzaXN0ZW50\nIGNsYXNlcywKICAgICAgICAgICAgICAgIC8vIGFsc28gY2hlY2sgdG8gZW5z\ndXJlIHRoYXQgdGhlIGNsYXNzIGlzIGluIHRoYXQgbGlzdAogICAgICAgICAg\nICAgICAgaWYgKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05hbWVzLnNpemUoKSA9\nPSAwIHx8IHBjTmFtZXMuY29udGFpbnMobmMuZ2V0TmFtZSgpKSkgewogICAg\nICAgICAgICAgICAgICAgIGNscyA9IG5jOwogICAgICAgICAgICAgICAgICAg\nIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNsYXNzTGlzdC5hZGQoY2xzKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMg\naGFwcGVucyB3aGVuIHRoZSBjbGFzcyBpcyBub3QgbG9hZGFibGUgYnkKICAg\nICAgICAgICAgICAgIC8vIHRoZSBlbnZpcm9ubWVudCBjbGFzcyBsb2FkZXIs\nIHNvIGl0IHdhcyBwcm9iYWJseQogICAgICAgICAgICAgICAgLy8gbGlzdGVk\nIGVsc2V3aGVyZTsgYWxzbyBpZ25vcmUgbGlua2FnZSBmYWlsdXJlcyBhbmQK\nICAgICAgICAgICAgICAgIC8vIG90aGVyIGNsYXNzIGxvYWRpbmcgcHJvYmxl\nbXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2xzICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVu\ndkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAgICAgLy8gbWF5YmUgdGhpcyBp\ncyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQganVzdCBpc24ndCB2YWxpZAog\nICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc0tleShhbGlhcykpIHsKICAg\nICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAgICAgICAgIHRocm93\nTm9SZWdpc3RlcmVkQWxpYXMoYWxpYXMpOwogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFdlIG5lZWQgdG8gc3luY2hy\nb25pemUgb24gX2FsaWFzZXMgYmVjYXVzZSBhIENvbmN1cnJlbnRNb2RpZmlj\nYXRpb25FeGNlcHRpb24gY2FuIGlmIHRoZXJlCiAgICAgICAgLy8gaXMgYSB0\naHJlYWQgaW4gZ2V0QWxpYXNOYW1lcygpIEFORCB0aGlzIGNsYXNzIGlzbid0\nIHVzaW5nIGFueSBsb2NraW5nLgogICAgICAgIHN5bmNocm9uaXplZCAoX2Fs\naWFzZXMpIHsKICAgICAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBh\nbiBpbnZhbGlkIHR5cGUKICAgICAgICAgICAgX2FsaWFzZXMucHV0KGFsaWFz\nLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmICghbXVzdEV4aXN0KQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gdGhyb3dO\nb1JlZ2lzdGVyZWRBbGlhcyhhbGlhcyk7CiAgICB9CgogICAgcHJpdmF0ZSBD\nbGFzc01ldGFEYXRhIHRocm93Tm9SZWdpc3RlcmVkQWxpYXMoU3RyaW5nIGFs\naWFzKSB7CiAgICAgICAgU3RyaW5nIGNsb3NlID0gZ2V0Q2xvc2VzdEFsaWFz\nTmFtZShhbGlhcyk7CiAgICAgICAgaWYgKGNsb3NlICE9IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tYWxpYXMtbWV0YS1oaW50IiwgYWxpYXMsIF9hbGlhc2VzLCBjbG9zZSkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsIF9h\nbGlhc2VzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBu\nZWFyZXN0IG1hdGNoIHRvIHRoZSBzcGVjaWZpZWQgYWxpYXMgbmFtZQogICAg\nICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ2xvc2VzdEFsaWFzTmFtZShTdHJpbmcgYWxpYXMpIHsKICAgICAgICBDb2xs\nZWN0aW9uPFN0cmluZz4gYWxpYXNlcyA9IGdldEFsaWFzTmFtZXMoKTsKICAg\nICAgICByZXR1cm4gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0\nZWluRGlzdGFuY2UoYWxpYXMsIGFsaWFzZXMpOwogICAgfQoKICAgIC8qKgog\nICAgICogQHJldHVybiB0aGUgcmVnaXN0ZXJlZCBhbGlhcyBuYW1lcwogICAg\nICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9u\nPFN0cmluZz4gZ2V0QWxpYXNOYW1lcygpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfYWxpYXNlcykgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldEFsaWFzTmFtZXNJbnRlcm5hbCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldEFsaWFzTmFtZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb248U3RyaW5nPiBnZXRB\nbGlhc05hbWVzSW50ZXJuYWwoKSB7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJp\nbmc+IGFsaWFzZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8TWFwLkVudHJ5PFN0cmluZywgTGlzdDxDbGFz\nczw/Pj4+PiBpdGVyID0gX2FsaWFzZXMuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIE1hcC5FbnRy\neTxTdHJpbmcsIExpc3Q8Q2xhc3M8Pz4+PiBlID0gaXRlci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBpZiAoZS5nZXRWYWx1ZSgpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgYWxpYXNlcy5hZGQoZS5nZXRLZXkoKSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBhbGlhc2VzOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGdldCB0aGUgbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcywgd2l0aG91dCByZXNvbHZpbmcgaXQuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YUludGVy\nbmFsKENsYXNzPD8+IGNscywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAg\nICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUgZm9yIGV4aXN0aW5nIG1ldGFk\nYXRhLCBvciBnaXZlIHVwIGlmIG5vIG1ldGFkYXRhIGFuZAogICAgICAgIC8v\nIG91ciBsaXN0IG9mIGNvbmZpZ3VyZWQgcGVyc2lzdGVudCB0eXBlcyBkb2Vz\nbid0IGluY2x1ZGUgdGhlIGNsYXNzCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkg\nJiBNT0RFX01FVEEpICE9IDAgfHwgKF9zb3VyY2VNb2RlICYgTU9ERV9NRVRB\nKSA9PSAwKSkKICAgICAgICAgICAgcmV0dXJuIG1ldGE7CgogICAgICAgIC8v\nIGlmIHJ1bnRpbWUsIGN1dCBvZmYgc2VhcmNoIGlmIG5vdCBpbiBwYyBsaXN0\nLiB3ZSBkb24ndCBkbyB0aGlzIGF0CiAgICAgICAgLy8gZGV2IHRpbWUgc28g\ndGhhdCB1c2VyIGNhbiBtYW5pcHVsYXRlIHBlcnNpc3RlbnQgY2xhc3NlcyBo\nZSdzIHdyaXRpbmcKICAgICAgICAvLyBiZWZvcmUgYWRkaW5nIHRoZW0gdG8g\ndGhlIGxpc3QKICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JV\nTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgU2V0PFN0cmluZz4gcGNOYW1l\ncyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7\nCiAgICAgICAgICAgIGlmIChwY05hbWVzICE9IG51bGwgJiYgIXBjTmFtZXMu\nY29udGFpbnMoY2xzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbWV0YTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIG1heWJlIHdlIGtu\nb3cgdGhpcyBjbGFzcyBoYXMgbm8gbWV0YWRhdGEKICAgICAgICAgICAgaWYg\nKF9tZXRhcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhpcyBpc24n\ndCBhbiBvYnZpb3VzbHkgYmFkIGNsYXNzCiAgICAgICAgICAgIGlmIChjbHMu\naXNQcmltaXRpdmUoKSB8fCBjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImph\ndmEuIikgfHwgY2xzID09IFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gZGVz\naWduZWQgdG8gZ2V0IGFyb3VuZCBqaWtlcyAxLjE3IC8gSkRLMS41IGlzc3Vl\nIHdoZXJlIHN0YXRpYwogICAgICAgICAgICAvLyBpbml0aWFsaXplcnMgYXJl\nIG5vdCBpbnZva2VkIHdoZW4gYSBjbGFzcyBpcyByZWZlcmVuY2VkLCBzbyB0\naGUKICAgICAgICAgICAgLy8gY2xhc3MgbmV2ZXIgcmVnaXN0ZXJzIGl0c2Vs\nZiB3aXRoIHRoZSBzeXN0ZW0KICAgICAgICAgICAgaWYgKChfdmFsaWRhdGUg\nJiBWQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdl\ndE5hbWUoKSwgdHJ1ZSwgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAgICAgLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGNscykpKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG5vdCBpbiBjYWNoZTogbG9h\nZCBtZXRhZGF0YSBvciBtYXBwaW5ncyBkZXBlbmRpbmcgb24gc291cmNlIG1v\nZGUuCiAgICAgICAgLy8gbG9hZGluZyBtZXRhZGF0YSBtaWdodCBhbHNvIGxv\nYWQgbWFwcGluZ3MsIGJ1dCBkb2Vzbid0IGhhdmUgdG8KICAgICAgICBpbnQg\nbW9kZSA9IDA7CiAgICAgICAgaWYgKChfc291cmNlTW9kZSAmIE1PREVfTUVU\nQSkgIT0gMCkKICAgICAgICAgICAgbW9kZSA9IF9zb3VyY2VNb2RlICYgfk1P\nREVfTUFQUElORzsKICAgICAgICBlbHNlIGlmICgoX3NvdXJjZU1vZGUgJiBN\nT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIG1vZGUgPSBfc291cmNl\nTW9kZTsKICAgICAgICBpZiAobW9kZSAhPSBNT0RFX05PTkUpIHsKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImxvYWQtY2xzIiwgY2xzLCB0b01v\nZGVTdHJpbmcobW9kZSkpKTsKICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChj\nbHMsIG1vZGUsIGVudkxvYWRlcik7CiAgICAgICAgfQoKICAgICAgICAvLyBj\naGVjayBjYWNoZSBhZ2FpbgogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAg\nICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChj\nbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgKChtZXRhLmdldFNv\ndXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCB8fCAoX3NvdXJjZU1vZGUg\nJiBNT0RFX01FVEEpID09IDApKQogICAgICAgICAgICByZXR1cm4gbWV0YTsK\nCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBjbGFzcyBoYXMgbm8gbWV0\nYWRhdGE7IGNoZWNraW5nIGZvciB0aGlzIGxhdGVyCiAgICAgICAgLy8gc3Bl\nZWRzIHRoaW5ncyB1cCBpbiBlbnZpcm9ubWVudHMgd2l0aCBzbG93IGNsYXNz\nIGxvYWRpbmcKICAgICAgICAvLyBsaWtlIGFwcHNlcnZlcnMKICAgICAgICBp\nZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICByZW1vdmVNZXRhRGF0YSht\nZXRhKTsKICAgICAgICBfbWV0YXMucHV0KGNscywgbnVsbCk7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBz\ndHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIG1vZGUgZmxhZ3Mu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyB0b01vZGVTdHJp\nbmcoaW50IG1vZGUpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKDMxKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RF\nX01FVEEpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltNRVRBXSIp\nOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfUVVFUlkpICE9IDApCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIltRVUVSWV0iKTsKICAgICAgICBpZiAoKG1v\nZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIltNQVBQSU5HXSIpOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQ\nUElOR19JTklUKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCJbTUFQ\nUElOR19JTklUXSIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgbWV0YWRhdGEgZm9yIG1h\ncHBpbmcgcmVzb2x1dGlvbi4gVGhpcyBtZXRob2QgbWlnaHQgbWFwIHBhcnRz\nIG9mIHRoZSBtZXRhZGF0YSB0aGF0CiAgICAgKiBkb24ndCByZWx5IG9uIG90\naGVyIGNsYXNzZXMgYmVpbmcgbWFwcGVkLCBidXQgdGhhdCBvdGhlciBjbGFz\nc2VzIG1pZ2h0IHJlbHkgb24gZHVyaW5nIHRoZWlyCiAgICAgKiBvd24gbWFw\ncGluZyAoZm9yIGV4YW1wbGUsIHByaW1hcnkga2V5IGZpZWxkcykuIEJ5IGRl\nZmF1bHQsIHRoaXMgbWV0aG9kIG9ubHkgY2FsbHMKICAgICAqIHtAbGluayBD\nbGFzc01ldGFEYXRhI2RlZmluZVN1cGVyY2xhc3NGaWVsZHN9LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJlTWFwcGluZyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBtZXRhLmRlZmluZVN1cGVyY2xhc3NGaWVs\nZHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSB0aGUg\nZ2l2ZW4gbWV0YWRhdGEgaWYgbmVlZGVkLiBUaGVyZSBhcmUgdGhyZWUgZ29h\nbHM6CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+TWFrZSBzdXJlIG5vIHVucmVz\nb2x2ZWQgbWV0YWRhdGEgZ2V0cyBiYWNrIHRvIHRoZSBjbGllbnQuPC9saT4K\nICAgICAqIDxsaT5Bdm9pZCBpbmZpbml0ZSByZWVudHJhbnQgY2FsbHMgZm9y\nIG11dHVhbGx5LWRlcGVuZGVudCBtZXRhZGF0YXMgYnkgYWxsb3dpbmcgdW5y\nZXNvbHZlZAogICAgICogbWV0YWRhdGEgdG8gYmUgcmV0dXJuZWQgdG8gb3Ro\nZXIgbWV0YWRhdGFzLjwvbGk+CiAgICAgKiA8bGk+QWx3YXlzIG1ha2Ugc3Vy\nZSB0aGUgc3VwZXJjbGFzcyBtZXRhZGF0YSBpcyByZXNvbHZlZCBiZWZvcmUg\ndGhlIHN1YmNsYXNzIG1ldGFkYXRhIHNvIHRoYXQKICAgICAqIHRoZSBzdWJj\nbGFzcyBjYW4gYWNjZXNzIHRoZSBzdXBlcidzIGxpc3Qgb2YgZmllbGRzLjwv\nbGk+CiAgICAgKiA8L29sPgogICAgICogTm90ZSB0aGF0IHRoZSBjb2RlIGNh\nbGxpbmcgdGhpcyBtZXRob2QgaXMgc3luY2hyb25pemVkLCBzbyB0aGlzIG1l\ndGhvZCBkb2Vzbid0IGhhdmUgdG8gYmUuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZXNvbHZlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIC8v\nIHJldHVybiBhbnl0aGluZyB0aGF0IGhhcyBpdHMgbWV0YWRhdGEgcmVzb2x2\nZWQsIGJlY2F1c2UgdGhhdCBtZWFucwogICAgICAgIC8vIGl0IGlzIGVpdGhl\nciBmdWxseSByZXNvbHZlZCBvciBtdXN0IGF0IGxlYXN0IGJlIGluIHRoZSBw\ncm9jZXNzIG9mCiAgICAgICAgLy8gcmVzb2x2aW5nIG1hcHBpbmcsIGV0YyBz\naW5jZSB3ZSBkbyB0aGF0IHJpZ2h0IGFmdGVyIG1ldGEgcmVzb2x2ZQogICAg\nICAgIGlmIChtZXRhID09IG51bGwgfHwgX3Jlc01vZGUgPT0gTU9ERV9OT05F\nIHx8IChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUVUQSkgIT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyByZXNvbHZlIG1ldGFkYXRh\nCiAgICAgICAgTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlZCA9IHJlc29s\ndmVNZXRhKG1ldGEpOwogICAgICAgIGlmIChyZXNvbHZlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGxvYWQgbWFwcGluZyBk\nYXRhCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXpl\nKCk7IGkrKykKICAgICAgICAgICAgbG9hZE1hcHBpbmcocmVzb2x2ZWQuZ2V0\nKGkpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVkLnNp\nemUoKTsgaSsrKQogICAgICAgICAgICBwcmVNYXBwaW5nKHJlc29sdmVkLmdl\ndChpKSk7CgogICAgICAgIC8vIHJlc29sdmUgbWFwcGluZ3MKICAgICAgICBi\nb29sZWFuIGVyciA9IHRydWU7CiAgICAgICAgaWYgKChfcmVzTW9kZSAmIE1P\nREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgIGVy\nciAmPSByZXNvbHZlTWFwcGluZyhyZXNvbHZlZC5nZXQoaSkpOwoKICAgICAg\nICAvLyB0aHJvdyBlcnJvcnMgZW5jb3VudGVyZWQKICAgICAgICAvLyBPUEVO\nSlBBLTE1MzUgQWx3YXlzIHRocm93IGEgTWV0YURhdGFFeGNlcHRpb24gYmVj\nYXVzZSBjYWxsZXJzCiAgICAgICAgLy8gb2YgbG9hZFJlZ2lzdGVyZWRDbGFz\nc01ldGFEYXRhIGV4cGVjdCBvbmx5IE1ldGFEYXRhRXhjZXB0aW9uCiAgICAg\nICAgLy8gdG8gYmUgdGhyb3duLgogICAgICAgIGlmIChlcnIgJiYgIV9lcnJz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBSdW50aW1lRXhjZXB0aW9uIHJl\nOwogICAgICAgICAgICBpZiAoKF9lcnJzLnNpemUoKSA9PSAxKSAmJiAoX2Vy\ncnMuZ2V0KDApIGluc3RhbmNlb2YgTWV0YURhdGFFeGNlcHRpb24pKSB7CiAg\nICAgICAgICAgICAgICByZSA9IF9lcnJzLmdldCgwKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlID0gbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJyZXNvbHZlLWVycnMiKSkKICAgICAgICAgICAg\nICAgICAgICAuc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIF9l\ncnJzCiAgICAgICAgICAgICAgICAgICAgLnRvQXJyYXkobmV3IEV4Y2VwdGlv\nbltfZXJycy5zaXplKCldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nX2VycnMuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0YSBtb2Rl\nLCByZXR1cm5pbmcgbGlzdCBvZiBwcm9jZXNzZWQgbWV0YWRhZGF0YXMsIG9y\nIG51bGwgaWYgd2UncmUgc3RpbGwgaW4gdGhlCiAgICAgKiBwcm9jZXNzIG9m\nIHJlc29sdmluZyBvdGhlciBtZXRhZGF0YXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlTWV0YShDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRQQ1N1cGVyY2xhc3Mo\nKSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHNldCBzdXBlcmNsYXNzCiAg\nICAgICAgICAgIENsYXNzPD8+IHN1cCA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXBNZXRhOwogICAgICAgICAgICB3aGlsZSAoc3VwICE9IG51bGwgJiYg\nc3VwICE9IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICAgICAgc3VwTWV0\nYSA9IGdldE1ldGFEYXRhKHN1cCwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigp\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoc3VwTWV0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Mo\nc3VwKTsKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKHN1cE1ldGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZh\nY2UoKSkgewogICAgICAgICAgICAgICAgQ2xhc3M8Pz5bXSBzdXBzID0gbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0SW50ZXJmYWNlcygpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgc3VwTWV0YSA9IGdldE1ldGFEYXRh\nKHN1cHNbaV0sIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChzdXBNZXRhICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Moc3Vw\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJhc3NpZ25lZC1zdXAiLCBtZXRhLCBtZXRhLmdldFBDU3VwZXJjbGFzcygp\nKSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXNvbHZlIHJlbGF0aW9uIHBy\naW1hcnkga2V5IGZpZWxkcyBmb3IgbWFwcGluZyBkZXBlbmRlbmNpZXMKICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmlzUHJpbWFyeUtl\neSgpKQogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKSwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigpLCBmYWxz\nZSk7CgogICAgICAgIC8vIHJlc29sdmUgbWV0YWRhdGE7IGlmIHdlJ3JlIG5v\ndCBpbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcKICAgICAgICAvLyBvdGhl\ncnMsIHRoaXMgd2lsbCByZXR1cm4gdGhlIHNldCBvZiBpbnRlcnJlbGF0ZWQg\nbWV0YXMgdGhhdAogICAgICAgIC8vIHJlc29sdmVkCiAgICAgICAgcmV0dXJu\nIHByb2Nlc3NCdWZmZXIobWV0YSwgX3Jlc29sdmluZywgTU9ERV9NRVRBKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgbWFwcGluZyBpbmZvcm1hdGlv\nbiBmb3IgdGhlIGdpdmVuIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgbG9hZE1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgaWYgKChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUFQUElORykgIT0g\nMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBsb2FkIG1hcHBp\nbmcgaW5mb3JtYXRpb24KICAgICAgICBpZiAoKG1ldGEuZ2V0U291cmNlTW9k\nZSgpICYgTU9ERV9NQVBQSU5HKSA9PSAwICYmIChfc291cmNlTW9kZSAmIE1P\nREVfTUFQUElORykgIT0gMCkgewogICAgICAgICAgICAvLyBlbWJlZGRlZC1v\nbmx5IG1ldGFkYXRhIGRvZXNuJ3QgaGF2ZSBtYXBwaW5nLCBzbyBhbHdheXMg\nbG9hZGVkCiAgICAgICAgICAgIGlmIChtZXRhLmlzRW1iZWRkZWRPbmx5KCkp\nCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQ\nSU5HLCB0cnVlKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAvLyBsb2FkIG1hcHBpbmcgZGF0YQogICAgICAgICAgICAgICAgaW50IG1v\nZGUgPSBfc291cmNlTW9kZSAmIH5NT0RFX01FVEE7CiAgICAgICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImxvYWQtbWFwcGluZyIsIG1ldGEs\nIHRvTW9kZVN0cmluZyhtb2RlKSkpOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBfZmFjdG9yeS5sb2FkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCBtb2RlLCBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCkp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEp\nOwogICAgICAgICAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQcmUtbWFwcGluZyBwcmVwYXJhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHByZU1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgaWYgKChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUFQ\nUElORykgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBw\ncmVwYXJlIG1hcHBpbmdzIGZvciByZXNvbHZlOyBpZiBub3QgcmVzb2x2aW5n\nIG1hcHBpbmdzLCB0aGVuCiAgICAgICAgLy8gbWFrZSBzdXJlIGFueSBzdXBl\ncmNsYXNzIGZpZWxkcyBkZWZpbmVkIGluIG1ldGFkYXRhIGFyZSByZXNvbHZl\nZAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX3Jlc01vZGUgJiBN\nT0RFX01BUFBJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgicHJlcC1tYXBwaW5nIiwgbWV0YSkpOwogICAgICAg\nICAgICAgICAgcHJlcGFyZU1hcHBpbmcobWV0YSk7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgbWV0YS5kZWZpbmVTdXBlcmNsYXNzRmll\nbGRzKGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAg\nICAgICAgICBfZXJycy5hZGQocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc29sdmUgYW5kIGluaXRpYWxpemUgbWFwcGluZy4KICAg\nICAqIAogICAgICogQHJldHVybiBmYWxzZSBpZiB3ZSdyZSBzdGlsbCBpbiB0\naGUgcHJvY2VzcyBvZiByZXNvbHZpbmcgbWFwcGluZ3MKICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIHJlc29sdmVNYXBwaW5nKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gbWFwcGVkID0g\ncHJvY2Vzc0J1ZmZlcihtZXRhLCBfbWFwcGluZywgTU9ERV9NQVBQSU5HKTsK\nICAgICAgICBpZiAobWFwcGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBtYXBwaW5nIGZvciBy\ndW50aW1lIHVzZQogICAgICAgIGlmICgoX3Jlc01vZGUgJiBNT0RFX01BUFBJ\nTkdfSU5JVCkgIT0gMCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG1hcHBlZC5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgbWV0\nYSA9IChDbGFzc01ldGFEYXRhKSBtYXBwZWQuZ2V0KGkpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtZXRhLnJlc29sdmUo\nTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgICAgIHJl\nbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIF9lcnJz\nLmFkZChyZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcm9jZXNzIHRoZSBnaXZlbiBtZXRhZGF0YSBhbmQgdGhlIGFzc29j\naWF0ZWQgYnVmZmVyLgogICAgICovCiAgICBwcml2YXRlIExpc3Q8Q2xhc3NN\nZXRhRGF0YT4gcHJvY2Vzc0J1ZmZlcihDbGFzc01ldGFEYXRhIG1ldGEsIElu\naGVyaXRhbmNlT3JkZXJlZE1ldGFEYXRhTGlzdCBidWZmZXIsIGludCBtb2Rl\nKSB7CiAgICAgICAgLy8gaWYgd2UncmUgYWxyZWFkeSBwcm9jZXNzaW5nIGEg\nbWV0YWRhdGEsIGp1c3QgYnVmZmVyIHRoaXMgb25lOyB3aGVuCiAgICAgICAg\nLy8gdGhlIGluaXRpYWwgbWV0YWRhdGEgZmluaXNoZXMgcHJvY2Vzc2luZywg\nd2UgdHJhdmVyc2UgdGhlIGJ1ZmZlcgogICAgICAgIC8vIGFuZCBwcm9jZXNz\nIGFsbCB0aGUgb3RoZXJzIHRoYXQgd2VyZSBpbnRyb2R1Y2VkIGR1cmluZyBy\nZWVudHJhbnQKICAgICAgICAvLyBjYWxscwogICAgICAgIGlmICghYnVmZmVy\nLmFkZChtZXRhKSB8fCBidWZmZXIuc2l6ZSgpICE9IDEpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjb250aW51YWxseSBwb3AgYSBt\nZXRhZGF0YSBhbmQgcHJvY2VzcyBpdCB1bnRpbCB3ZSBydW4gb3V0OyBub3Rl\nCiAgICAgICAgLy8gdGhhdCBlYWNoIHByb2Nlc3NpbmcgY2FsbCBtaWdodCBw\nbGFjZSBtb3JlIG1ldGFzIGluIHRoZSBidWZmZXIgYXMKICAgICAgICAvLyBv\nbmUgY2xhc3MgdHJpZXMgdG8gYWNjZXNzIG1ldGFkYXRhIGZvciBhbm90aGVy\nOyBhbHNvIG5vdGUgdGhhdCB0aGUKICAgICAgICAvLyBidWZmZXIgb3JkZXJz\nIGl0c2VsZiBmcm9tIGxlYXN0IHRvIG1vc3QgZGVyaXZlZAogICAgICAgIENs\nYXNzTWV0YURhdGEgYnVmZmVyZWQ7CiAgICAgICAgTGlzdDxDbGFzc01ldGFE\nYXRhPiBwcm9jZXNzZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNzTWV0YURhdGE+\nKDUpOwogICAgICAgIHdoaWxlICghYnVmZmVyLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBidWZmZXJlZCA9IGJ1ZmZlci5wZWVrKCk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBidWZmZXJlZC5yZXNvbHZlKG1vZGUp\nOwogICAgICAgICAgICAgICAgcHJvY2Vzc2VkLmFkZChidWZmZXJlZCk7CiAg\nICAgICAgICAgICAgICBidWZmZXIucmVtb3ZlKGJ1ZmZlcmVkKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICAgICAgX2VycnMuYWRkKHJlKTsKCiAgICAgICAgICAgICAgICAvLyBh\nbnkgZXhjZXB0aW9uIGR1cmluZyByZXNvbHV0aW9uIG9mIG9uZSB0eXBlIG1l\nYW5zIHdlIGNhbid0CiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGFueSBv\nZiB0aGUgcmVsYXRlZCB0eXBlcywgc28gY2xlYXIgYnVmZmVyLiB0aGlzIGFs\nc28KICAgICAgICAgICAgICAgIC8vIGVuc3VyZXMgdGhhdCBpZiB0d28gdHlw\nZXMgcmVsYXRlIHRvIGVhY2ggb3RoZXIgYW5kIG9uZQogICAgICAgICAgICAg\nICAgLy8gZGllcywgd2UgZG9uJ3QgZ2V0IGludG8gaW5maW5pdGUgY3ljbGVz\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPENsYXNzTWV0YURhdGE+\nIGl0ciA9IGJ1ZmZlci5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgICAgIG1ldGEgPSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChtZXRhICE9IGJ1ZmZlcmVkKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIF9lcnJzLmFkZChuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoInByZXYtZXJycyIsIG1ldGEsIGJ1ZmZlcmVkKSkpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGJ1ZmZlci5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIC8vIENoZWNrIGlmIHByb2Nlc3MgYnVmZmVy\nIHJlb3JkZXJpbmcgZm9yIFBDVHlwZXMgdGhhdCBoYXZlIHJlbGF0aW9uc2hp\ncHMgdG8gb3RoZXIgUENUeXBlcyBpbiB0aGVpciBpZGVudGl0eSAKICAgICAg\nICAvLyBzaG91bGQgYmUgcGVyZm9ybWVkLgogICAgICAgIGlmIChfcmVvcmRl\nck1ldGFEYXRhUmVzb2x1dGlvbikgewogICAgICAgICAgICBwcm9jZXNzZWQg\nPSByZXNvbHZlRktJblBLRGVwZW5kZW5jaWVzT3JkZXJpbmcocHJvY2Vzc2Vk\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgdGhlIG1ldGFkYXRhIGluc3Rh\nbmNlcyBjdXJyZW50bHkgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0TWV0YURhdGFzKCkgewogICAg\nICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQo\ndGhpcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGFzSW50\nZXJuYWwoKTsgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGFzSW50ZXJuYWwoKTsKICAg\nICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtd\nIGdldE1ldGFEYXRhc0ludGVybmFsKCkgewogICAgICAgICAgICAvLyBwcmV2\nZW50IGNvbmN1cnJlbnQgbW9kIGVycm9ycyB3aGVuIHJlc29sdmluZyBvbmUg\nbWV0YWRhdGEKICAgICAgICAgICAgLy8gaW50cm9kdWNlcyBvdGhlcnMKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gKENsYXNzTWV0YURh\ndGFbXSkgX21ldGFzLnZhbHVlcygpLnRvQXJyYXkobmV3IENsYXNzTWV0YURh\ndGFbX21ldGFzLnNpemUoKV0pOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKG1ldGFzW2ldICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZ2V0TWV0\nYURhdGEobWV0YXNbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpLCBtZXRhc1tpXS5n\nZXRFbnZDbGFzc0xvYWRlcigpLCB0cnVlKTsKCiAgICAgICAgICAgIExpc3Q8\nQ2xhc3NNZXRhRGF0YT4gcmVzb2x2ZWQgPSBuZXcgQXJyYXlMaXN0PENsYXNz\nTWV0YURhdGE+KF9tZXRhcy5zaXplKCkpOwogICAgICAgICAgICBmb3IgKENs\nYXNzTWV0YURhdGEgbWV0YSA6IF9tZXRhcy52YWx1ZXMoKSkgewogICAgICAg\nICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICByZXNvbHZlZC5hZGQobWV0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgbWV0YXMgPSByZXNvbHZlZC50b0FycmF5KG5ld0NsYXNzTWV0YURhdGFB\ncnJheShyZXNvbHZlZC5zaXplKCkpKTsKICAgICAgICAgICAgQXJyYXlzLnNv\ncnQobWV0YXMpOwogICAgICAgICAgICByZXR1cm4gbWV0YXM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBtZXRhZGF0YSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLCB3aXRob3V0IGFueSByZXNvbHV0aW9uLiBSZXR1\ncm4gbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YSBnZXRDYWNoZWRNZXRhRGF0YShDbGFzczw/PiBjbHMpIHsKICAgICAg\nICByZXR1cm4gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9w\ndWxhdGUgaXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8g\ndGhlIHJlcG9zaXRvcnksIGFuZAogICAgICogcmV0dXJuIGl0LiBVc2UgdGhl\nIGRlZmF1bHQgYWNjZXNzIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzPD8+IGNscykgewogICAgICAg\nIHJldHVybiBhZGRNZXRhRGF0YShjbHMsIEFjY2Vzc0NvZGUuVU5LTk9XTik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEs\nIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0\nIHRvIHRoZSByZXBvc2l0b3J5LCBhbmQKICAgICAqIHJldHVybiBpdC4KICAg\nICAqIAogICAgICogQHBhcmFtIGFjY2VzcwogICAgICogICAgICAgICAgICB0\naGUgYWNjZXNzIHR5cGUgdG8gdXNlIGluIHBvcHVsYXRpbmcgbWV0YWRhdGEK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRkTWV0YURhdGEo\nQ2xhc3M8Pz4gY2xzLCBpbnQgYWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGFk\nZE1ldGFEYXRhKGNscywgYWNjZXNzLCBmYWxzZSk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IG1ldGFkYXRhLCBwb3B1bGF0ZSBp\ndCB3aXRoIGRlZmF1bHQgaW5mb3JtYXRpb24sIGFkZCBpdCB0byB0aGUgcmVw\nb3NpdG9yeSwgYW5kCiAgICAgKiByZXR1cm4gaXQuCiAgICAgKiAKICAgICAq\nIEBwYXJhbSBhY2Nlc3MKICAgICAqICAgICAgICAgICAgdGhlIGFjY2VzcyB0\neXBlIHRvIHVzZSBpbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzPD8+IGNs\ncywgaW50IGFjY2VzcywgYm9vbGVhbiBpZ25vcmVUcmFuc2llbnQpIHsKICAg\nICAgICBpZiAoY2xzID09IG51bGwgfHwgY2xzLmlzUHJpbWl0aXZlKCkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDbGFzc01ldGFEYXRh\nIG1ldGEgPSBuZXdDbGFzc01ldGFEYXRhKGNscyk7CiAgICAgICAgX2ZhY3Rv\ncnkuZ2V0RGVmYXVsdHMoKS5wb3B1bGF0ZShtZXRhLCBhY2Nlc3MsIGlnbm9y\nZVRyYW5zaWVudCk7CgogICAgICAgIC8vIHN5bmNocm9uaXplIG9uIHRoaXMg\ncmF0aGVyIHRoYW4gdGhlIG1hcCwgYmVjYXVzZSBhbGwgb3RoZXIgbWV0aG9k\ncwogICAgICAgIC8vIHRoYXQgYWNjZXNzIF9tZXRhcyBhcmUgc3luY2hyb25p\nemVkIG9uIHRoaXMKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkKHRoaXMpewogICAgICAgICAgICAgICAgcmV0dXJu\nIG1ldGFzUHV0SW50ZXJuYWwoY2xzLCBtZXRhKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBtZXRhc1B1dElu\ndGVybmFsKGNscywgbWV0YSk7CiAgICAgICAgfQogICAgICAgICAgICAKICAg\nIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgbWV0YXNQdXRJbnRlcm5h\nbChDbGFzczw/PiBjbHMsIENsYXNzTWV0YURhdGEgbWV0YSl7CiAgICAgICAg\nICAgIGlmIChfcGF3YXJlcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJw\nYy1hbmQtYXdhcmUiLCBjbHMpKTsKICAgICAgICAgICAgX21ldGFzLnB1dChj\nbHMsIG1ldGEpOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IGNsYXNzIG1ldGFkYXRhIGluc3RhbmNl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSBuZXdDbGFz\nc01ldGFEYXRhKENsYXNzPD8+IHR5cGUpIHsKICAgICAgICByZXR1cm4gbmV3\nIENsYXNzTWV0YURhdGEodHlwZSwgdGhpcyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHByb3BlciBjbGFzcyBt\nZXRhZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNz\nTWV0YURhdGFbXSBuZXdDbGFzc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkg\newogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YVtsZW5ndGhdOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGZpZWxkIG1ldGFk\nYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRh\nRGF0YSBuZXdGaWVsZE1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzczw/PiB0\neXBlLCBDbGFzc01ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBGaWVsZE1ldGFEYXRhKG5hbWUsIHR5cGUsIG93bmVyKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJvcGVy\nIGZpZWxkIG1ldGFkYXRhIHN1YmNsYXNzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgRmllbGRNZXRhRGF0YVtdIG5ld0ZpZWxkTWV0YURhdGFBcnJheShpbnQg\nbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZE1ldGFEYXRhW2xl\nbmd0aF07CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgYXJy\nYXkgb2YgdGhlIHByb3BlciB4bWwgY2xhc3MgbWV0YWRhdGEgc3ViY2xhc3Mu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBYTUxNZXRhRGF0YVtdIG5ld1hNTENs\nYXNzTWV0YURhdGFBcnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBYTUxDbGFzc01ldGFEYXRhW2xlbmd0aF07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgZW1iZWRkZWQgY2xhc3MgbWV0YWRhdGEg\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRh\nIG5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShWYWx1ZU1ldGFEYXRhIG93bmVy\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01ldGFEYXRhKG93bmVyKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB2YWx1ZSBtZXRh\nZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlTWV0\nYURhdGEgbmV3VmFsdWVNZXRhRGF0YShGaWVsZE1ldGFEYXRhIG93bmVyKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1ldGFEYXRhSW1wbChvd25lcik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4ge0BsaW5rIE9yZGVy\nfSBmb3IgdGhlIGdpdmVuIGZpZWxkIGFuZCBkZWNsYXJhdGlvbi4gVGhpcyBt\nZXRob2QgZGVsZWdhdGVzIHRvCiAgICAgKiB7QGxpbmsgI25ld1JlbGF0ZWRG\naWVsZE9yZGVyfSBhbmQge0BsaW5rICNuZXdWYWx1ZUZpZWxkT3JkZXJ9IGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRlciBuZXdPcmRl\ncihGaWVsZE1ldGFEYXRhIG93bmVyLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBh\nc2MpIHsKICAgICAgICAvLyBwYXRocyBjYW4gc3RhcnQgd2l0aCAob3IgZXF1\nYWwpICcjZWxlbWVudCcKICAgICAgICBpZiAobmFtZS5zdGFydHNXaXRoKE9y\nZGVyLkVMRU1FTlQpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoT3JkZXIuRUxFTUVOVC5sZW5ndGgoKSk7CiAgICAgICAgaWYgKG5hbWUu\nbGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlT3Jk\nZXIob3duZXIsIGFzYyk7CgogICAgICAgIC8vIG5leHQgdG9rZW4gc2hvdWxk\nIGJlICcuJwogICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PSAnLicpCiAg\nICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKCiAgICAgICAg\nLy8gcmVsYXRlZCBmaWVsZAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIG93bmVyLmdldEVsZW1lbnQoKS5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vbnBjLWZpZWxkLW9yZGVyYWJs\nZSIsIG93bmVyLCBuYW1lKSk7CiAgICAgICAgRmllbGRNZXRhRGF0YSByZWwg\nPSBnZXRPcmRlckJ5RmllbGQobWV0YSwgbmFtZSk7CiAgICAgICAgaWYgKHJl\nbCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1maWVsZC1vcmRlcmFibGUiLCBvd25lciwg\nbmFtZSkpOwogICAgICAgIHJldHVybiBuZXdSZWxhdGVkRmllbGRPcmRlcihv\nd25lciwgcmVsLCBhc2MpOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1ldGFE\nYXRhIGdldE9yZGVyQnlGaWVsZChDbGFzc01ldGFEYXRhIG1ldGEsIFN0cmlu\nZyBvcmRlckJ5KSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZCA9IG1l\ndGEuZ2V0RmllbGQob3JkZXJCeSk7CiAgICAgICAgaWYgKGZpZWxkICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmaWVsZDsKICAgICAgICBpbnQgZG90\nSWR4ID0gb3JkZXJCeS5pbmRleE9mKCIuIik7CiAgICAgICAgaWYgKGRvdElk\neCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgU3Ry\naW5nIGZpZWxkTmFtZSA9IG9yZGVyQnkuc3Vic3RyaW5nKDAsIGRvdElkeCk7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZDEgPSBtZXRhLmdldEZpZWxk\nKGZpZWxkTmFtZSk7CiAgICAgICAgaWYgKGZpZWxkMSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGExID0gZmllbGQxLmdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICBp\nZiAobWV0YTEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgU3RyaW5nIG1hcHBlZEJ5MSA9IG9yZGVyQnkuc3Vic3RyaW5nKGRv\ndElkeCArIDEpOwogICAgICAgIHJldHVybiBnZXRPcmRlckJ5RmllbGQobWV0\nYTEsIG1hcHBlZEJ5MSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBi\neSB0aGUgZmllbGQgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRl\nciBuZXdWYWx1ZU9yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIGJvb2xlYW4g\nYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbk1lbW9yeVZhbHVlT3JkZXIo\nYXNjLCBnZXRDb25maWd1cmF0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogT3JkZXIgYnkgYSBmaWVsZCBvZiB0aGUgcmVsYXRlZCB0eXBlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3UmVsYXRlZEZpZWxkT3JkZXIo\nRmllbGRNZXRhRGF0YSBvd25lciwgRmllbGRNZXRhRGF0YSByZWwsIGJvb2xl\nYW4gYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbk1lbW9yeVJlbGF0ZWRG\naWVsZE9yZGVyKHJlbCwgYXNjLCBnZXRDb25maWd1cmF0aW9uKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGFycmF5IG9mIG9yZGVycyBv\nZiB0aGUgZ2l2ZW4gc2l6ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVy\nW10gbmV3T3JkZXJBcnJheShpbnQgc2l6ZSkgewogICAgICAgIHJldHVybiBu\nZXcgT3JkZXJbc2l6ZV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUg\nYSBtZXRhZGF0YSBpbnN0YW5jZSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAg\nICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYg\nbm90IGluIHRoaXMgcmVwb3NpdG9yeQogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiByZW1vdmVNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBh\nIG1ldGFkYXRhIGluc3RhbmNlIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAg\nKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBu\nb3QgaW4gdGhpcyByZXBvc2l0b3J5CiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNzPD8+IGNscykgewogICAgICAgIGlm\nKF9sb2NraW5nKXsKICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhSW50ZXJuYWwo\nY2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlewogICAgICAgICAg\nICByZXR1cm4gcmVtb3ZlTWV0YURhdGFJbnRlcm5hbChjbHMpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gcmVtb3ZlTWV0YURhdGFJ\nbnRlcm5hbChDbGFzczw/PiBjbHMpIHsKICAgICAgICAgICAgaWYgKGNscyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBpZiAoX21ldGFzLnJlbW92ZShjbHMpICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIENsYXNzPD8+IGltcGwgPSBfaWZhY2VzLnJlbW92ZShjbHMp\nOwogICAgICAgICAgICAgICAgaWYgKGltcGwgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBfbWV0YXMucmVtb3ZlKGltcGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIG1ldGFkYXRhIGFzIGRlY2xhcmVkIGludGVyZmFjZSBpbXBsZW1lbnRhdGlv\nbi4KICAgICAqLwogICAgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZUltcGwo\nQ2xhc3NNZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBpZmFjZSkgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKF9p\nbXBscykgewogICAgICAgICAgICAgICAgYWRkRGVjbGFyZWRJbnRlcmZhY2VJ\nbXBsSW50ZXJuYWwobWV0YSwgaWZhY2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkRGVjbGFyZWRJbnRlcmZhY2VJ\nbXBsSW50ZXJuYWwobWV0YSwgaWZhY2UpOwogICAgICAgIH0KICAgIH0KCiAg\nIHByaXZhdGUgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZUltcGxJbnRlcm5h\nbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzPD8+IGlmYWNlKSB7CiAgICAg\nICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHZhbHMgPSBfaW1wbHMuZ2V0\nKGlmYWNlKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUg\nc3VwZXJjbGFzcyBhbHJlYWR5IGRlY2xhcmVzIHRvIGF2b2lkIGR1cHMKICAg\nICAgICAgICAgaWYgKHZhbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgICAgICBmb3IgKDsgc3VwICE9IG51bGw7IHN1\ncCA9IHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKQogICAgICAgICAg\nICAgICAgICAgIGlmICh2YWxzLmNvbnRhaW5zKHN1cC5nZXREZXNjcmliZWRU\neXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uKF9pbXBscywg\naWZhY2UsIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBmYWxzZSk7CiAgICAg\nICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGltcGxlbWVudGF0aW9uIGZv\nciB0aGUgZ2l2ZW4gbWFuYWdlZCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHZv\naWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNz\nPD8+IGltcGwpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBzZXRJ\nbnRlcmZhY2VJbXBsSW50ZXJuYWwobWV0YSwgaW1wbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRJbnRlcmZhY2VJ\nbXBsSW50ZXJuYWwobWV0YSwgaW1wbCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBzZXRJbnRlcmZhY2VJbXBsSW50ZXJuYWwoQ2xhc3NN\nZXRhRGF0YSBtZXRhLCBDbGFzczw/PiBpbXBsKSB7CiAgICAgICAgICAgIGlm\nICghbWV0YS5pc01hbmFnZWRJbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1h\nbmFnZWQtaW50ZXJmYWNlIiwgbWV0YSwgaW1wbCkpOwogICAgICAgICAgICBf\naWZhY2VzLnB1dChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgaW1wbCk7CiAg\nICAgICAgICAgIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1wbChtZXRhLCBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgICAgICB3aGlsZSAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIC8vIHJlY29yZCBzdXBlcmNsYXNzIGludGVyZmFjZSBpbmZvIHdoaWxlIHdl\nIGNhbiBhcyB3ZWxsIGFzIHdlCiAgICAgICAgICAgICAgICAvLyB3aWxsIG9u\nbHkgcmVnaXN0ZXIgY29uY3JldGUgc3VwZXJjbGFzcyBpbiBQQ1JlZ2lzdHJ5\nCiAgICAgICAgICAgICAgICBzdXAuY2xlYXJTdWJjbGFzc0NhY2hlKCk7CiAg\nICAgICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIHN1cC5nZXRE\nZXNjcmliZWRUeXBlKCksIGltcGwsIHRydWUpOwogICAgICAgICAgICAgICAg\nc3VwID0gKENsYXNzTWV0YURhdGEpIHN1cC5nZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICBJbnRlcmZhY2VJbXBsR2Vu\nZXJhdG9yIGdldEltcGxHZW5lcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIF9p\nbXBsR2VuOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsZWFz\ndC1kZXJpdmVkIGNsYXNzIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gYXBwbGlj\nYXRpb24gaWRlbnRpdHkgb2JqZWN0LgogICAgICogCiAgICAgKiBAcGFyYW0g\nb2lkCiAgICAgKiAgICAgICAgICAgIHRoZSBvaWQgdG8gZ2V0IHRoZSBtZXRh\nZGF0YSBmb3IKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIKICAgICAqICAgICAg\nICAgICAgdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkK\nICAgICAqIEBwYXJhbSBtdXN0RXhpc3QKICAgICAqICAgICAgICAgICAgaWYg\ndHJ1ZSwgdGhyb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9ufSBpZiBu\nbyBtZXRhZGF0YSBpcyBmb3VuZAogICAgICovCiAgICBwdWJsaWMgQ2xhc3NN\nZXRhRGF0YSBnZXRNZXRhRGF0YShPYmplY3Qgb2lkLCBDbGFzc0xvYWRlciBl\nbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKG9p\nZCA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9p\nZCwgIj8iLCBfb2lkcy50b1N0cmluZygpKSk7CiAgICAgICAgaWYgKG9pZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYg\nKG9pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgewogICAgICAgICAgICBDbGFz\nczw/PiBjbHMgPSAoKE9wZW5KUEFJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAg\nICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVz\ndEV4aXN0KTsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGNhY2hlCiAg\nICAgICAgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKGVudkxvYWRlcik7CiAg\nICAgICAgQ2xhc3M8Pz4gY2xzID0gX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygp\nKTsKICAgICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKCiAg\nICAgICAgLy8gbWF5YmUgdGhpcyBpcyBzb21lIHR5cGUgd2UndmUgc2VlbiBi\ndXQganVzdCBpc24ndCB2YWxpZAogICAgICAgIGlmIChfb2lkcy5jb250YWlu\nc0tleShvaWQuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgaWYgKG11c3RF\neGlzdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tb2lkLW1ldGEiLCBvaWQsIG9pZC5nZXRDbGFz\ncygpLCBfb2lkcykpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICB9CgogICAgICAgIC8vIGlmIHN0aWxsIG5vdCBtYXRjaCwgcmVnaXN0ZXIg\nYW55IGNsYXNzZXMgdGhhdCBsb29rIHNpbWlsYXIgdG8gdGhlCiAgICAgICAg\nLy8gb2lkIGNsYXNzIGFuZCBjaGVjayBhZ2FpbgogICAgICAgIHJlc29sdmVJ\nZGVudGl0eUNsYXNzKG9pZCk7CiAgICAgICAgaWYgKHByb2Nlc3NSZWdpc3Rl\ncmVkQ2xhc3NlcyhlbnZMb2FkZXIpLmxlbmd0aCA+IDApIHsKICAgICAgICAg\nICAgY2xzID0gX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAg\nICAgaWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBhbiBpbnZhbGlk\nIHR5cGUKICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCksIG51bGwp\nOwoKICAgICAgICBpZiAoIW11c3RFeGlzdCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwgb2lkLmdldENsYXNzKCksIF9v\naWRzKSkuc2V0RmFpbGVkT2JqZWN0KG9pZCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIHNvbWUgZ3Vlc3NlcyBhYm91dCB0aGUgbmFtZSBvZiBhIHRh\ncmdldCBjbGFzcyBmb3IgYW4gdW5rbm93biBhcHBsaWNhdGlvbiBpZGVudGl0\neSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVJZGVu\ndGl0eUNsYXNzKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3M8Pz4gb2lk\nQ2xhc3MgPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJyZXNvbHZlLWlkZW50aXR5Iiwgb2lkQ2xhc3MpKTsKCiAgICAgICAgQ2xh\nc3NMb2FkZXIgY2wgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChK\nMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihvaWRDbGFzcykp\nOwogICAgICAgIFN0cmluZyBjbGFzc05hbWU7CiAgICAgICAgd2hpbGUgKG9p\nZENsYXNzICE9IG51bGwgJiYgb2lkQ2xhc3MgIT0gT2JqZWN0LmNsYXNzKSB7\nCiAgICAgICAgICAgIGNsYXNzTmFtZSA9IG9pZENsYXNzLmdldE5hbWUoKTsK\nCiAgICAgICAgICAgIC8vIHdlIHRha2UgYSBicnV0ZS1mb3JjZSBhcHByb2Fj\naDogdHJ5IHRvIGxvYWQgYWxsIHRoZSBjbGFzcycKICAgICAgICAgICAgLy8g\nc3Vic3RyaW5ncy4gdGhpcyB3aWxsIGhhbmRsZSB0aGUgZm9sbG93aW5nIGNv\nbW1vbiBuYW1pbmcgY2FzZXM6CiAgICAgICAgICAgIC8vCiAgICAgICAgICAg\nIC8vIGNvbS5jb21wYW55Lk15Q2xhc3MkSUQgLT4gY29tLmNvbXBhbnkuTXlD\nbGFzcwogICAgICAgICAgICAvLyBjb20uY29tcGFueS5NeUNsYXNzSWQgLT4g\nY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAvLyBjb20uY29tcGFu\neS5NeUNsYXNzT2lkIC0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAg\nICAgLy8gY29tLmNvbXBhbnkuTXlDbGFzc1BLIC0+IGNvbS5jb21wYW55Lk15\nQ2xhc3MKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gdGhpcyBpc24n\ndCB0aGUgZmFzdGVzdCB0aGluZyBwb3NzaWJsZSwgYnV0IHRoaXMgbWV0aG9k\nIHdpbGwKICAgICAgICAgICAgLy8gb25seSBiZSBjYWxsZWQgb25jZSBwZXIg\nSlZNIHBlciB1bmtub3duIGFwcCBpZCBjbGFzcwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gY2xhc3NOYW1lLmxlbmd0aCgpOyBpID4gMTsgaS0tKSB7CiAg\nICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lLmNoYXJBdChpIC0gMSkgPT0g\nJy4nKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShj\nbGFzc05hbWUuc3Vic3RyaW5nKDAsIGkpLCB0cnVlLCBjbCk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgfSAvLyBjb25zdW1lIGFsbCBleGNlcHRpb25zCiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG1vdmUgdXAgdGhlIE9JRCBoaWVyYXJjaHkKICAg\nICAgICAgICAgb2lkQ2xhc3MgPSBvaWRDbGFzcy5nZXRTdXBlcmNsYXNzKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBs\nZWFzdC1kZXJpdmVkIG1ldGFkYXRhcyB3aXRoIHNvbWUgbWFwcGVkIGFzc2ln\nbmFibGUgdHlwZSB0aGF0IGltcGxlbWVudCB0aGUgZ2l2ZW4KICAgICAqIGNs\nYXNzLgogICAgICogCiAgICAgKiBAcGFyYW0gY2xzCiAgICAgKiAgICAgICAg\nICAgIHRoZSBjbGFzcyBvciBpbnRlcmZhY2UgdG8gcmV0cmlldmUgaW1wbGVt\nZW50b3JzIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICogICAg\nICAgICAgICB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFu\neQogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAgICAgICAgICBp\nZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259IGlm\nIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01ldGFEYXRhW10gZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXMoQ2xhc3M8Pz4g\nY2xzLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0\nKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1tZXRhIiwgY2xzKSk7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfTUVUQVM7CgogICAgICAgIC8vIGdl\ndCBpbXBscyBvZiBnaXZlbiBpbnRlcmZhY2UgLyBhYnN0cmFjdCBjbGFzcwog\nICAgICAgIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShlbnZMb2FkZXIp\nOwogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IHZhbHMgPSBfaW1wbHMu\nZ2V0KGNscyk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1hcHBlZCA9IG51\nbGw7CiAgICAgICAgaWYgKHZhbHMgIT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\ndmFscykgewogICAgICAgICAgICAgICAgICAgIG1hcHBlZCA9IGdldEltcGxl\nbWVudG9yTWV0YURhdGFzSW50ZXJuYWwodmFscywgZW52TG9hZGVyLCBtdXN0\nRXhpc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgbWFwcGVkID0gZ2V0SW1wbGVtZW50b3JNZXRh\nRGF0YXNJbnRlcm5hbCh2YWxzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChtYXBwZWQgPT0g\nbnVsbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YSIsIGNscykpOwogICAg\nICAgIGlmIChtYXBwZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX01FVEFTOwogICAgICAgIHJldHVybiBtYXBwZWQ7CiAgICB9CgogICAg\ncHJpdmF0ZSBDbGFzc01ldGFEYXRhW10gZ2V0SW1wbGVtZW50b3JNZXRhRGF0\nYXNJbnRlcm5hbChDb2xsZWN0aW9uPENsYXNzPD8+PiBjbGFzc2VzLCBDbGFz\nc0xvYWRlciBlbnZMb2FkZXIsCiAgICAgICAgYm9vbGVhbiBtdXN0RXhpc3Qp\nIHsKICAgICAgICBDb2xsZWN0aW9uPENsYXNzTWV0YURhdGE+IG1hcHBlZCA9\nIG5ldyBBcnJheUxpc3Q8Q2xhc3NNZXRhRGF0YT4oY2xhc3Nlcy5zaXplKCkp\nOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG51bGw7CiAgICAgICAg\nZm9yIChDbGFzczw/PiBjIDogY2xhc3NlcykgewogICAgICAgICAgICBtZXRh\nID0gZ2V0TWV0YURhdGEoYywgZW52TG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgaWYgKG1ldGEuaXNNYXBwZWQoKSB8fCBtZXRhLmdldE1hcHBlZFBDU3Vi\nY2xhc3NNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAg\nICBtYXBwZWQuYWRkKG1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBtYXBwZWQudG9BcnJheShuZXcgQ2xhc3NNZXRhRGF0\nYVtde30pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRhZGF0\nYSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBwZXJzaXN0ZW5jZS1hd2Fy\nZSBjbGFzcy4gUmV0dXJucyBudWxsLCBpZiB0aGUKICAgICAqIGdpdmVuIGNs\nYXNzIGlzIG5vdCByZWdpc3RlcmVkIGFzIHBlcnNpc3RlbmNlLWF3YXJlLgog\nICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGdldFBl\ncnNpc3RlbmNlQXdhcmUoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgcmV0dXJu\nIChOb25QZXJzaXN0ZW50TWV0YURhdGEpIF9wYXdhcmVzLmdldChjbHMpOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0cyBhbGwgdGhlIG1ldGFkYXRhcyBm\nb3IgcGVyc2lzdGVuY2UtYXdhcmUgY2xhc3NlcwogICAgICogCiAgICAgKiBA\ncmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIGNsYXNzIGhhcyBiZWVuIHJlZ2lz\ndGVyZWQgYXMgcGVycy1hd2FyZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhW10gZ2V0UGVyc2lzdGVuY2VBd2FyZXMoKSB7CiAg\nICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAoX3Bhd2FyZXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQZXJz\naXN0ZW5jZUF3YXJlc0ludGVybmFsKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0UGVyc2lzdGVuY2VB\nd2FyZXNJbnRlcm5hbCgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdIGdldFBlcnNpc3RlbmNlQXdhcmVz\nSW50ZXJuYWwoKSB7CiAgICAgICAgICAgIGlmIChfcGF3YXJlcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFlfTk9OX1BFUlNJU1RF\nTlQ7CiAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRh\nW10pIF9wYXdhcmVzLnZhbHVlcygpLnRvQXJyYXkobmV3IE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YVtfcGF3YXJlcy5zaXplKCldKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCB0aGUgZ2l2ZW4gY2xhc3MgYXMgcGVyc2lzdGVuY2UtYXdh\ncmUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBjbHMKICAgICAqICAgICAgICAg\nICAgbm9uLW51bGwgYW5kIG11c3Qgbm90IGFscmVhZGR5IGJlIGFkZGVkIGFz\nIHBlcnNpdGVuY2UtY2FwYWJsZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhIGFkZFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3M8Pz4g\nY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYWRkUGVyc2lzdGVuY2VBd2FyZUludGVybmFsKGNscyk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYWRk\nUGVyc2lzdGVuY2VBd2FyZUludGVybmFsKGNscyk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFkZFBlcnNp\nc3RlbmNlQXdhcmVJbnRlcm5hbChDbGFzczw/PiBjbHMpIHsKICAgICAgICAg\nICAgaWYgKF9wYXdhcmVzLmNvbnRhaW5zS2V5KGNscykpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSkgX3Bhd2FyZXMu\nZ2V0KGNscyk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0YShj\nbHMpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1hd2FyZSIsIGNscykpOwog\nICAgICAgICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEgbWV0YSA9CiAgICAg\nICAgICAgICAgICBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhKGNscywgdGhp\ncywgTm9uUGVyc2lzdGVudE1ldGFEYXRhLlRZUEVfUEVSU0lTVEVOQ0VfQVdB\nUkUpOwogICAgICAgICAgICBfcGF3YXJlcy5wdXQoY2xzLCBtZXRhKTsKICAg\nICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYSBwZXJzaXRlbmNlLWF3YXJlIGNsYXNzIGZyb20gdGhlIHJlcG9z\naXRvcnkKICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQK\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlUGVyc2lzdGVuY2VB\nd2FyZShDbGFzczw/PiBjbHMpIHsKICAgICAgICByZXR1cm4gX3Bhd2FyZXMu\ncmVtb3ZlKGNscykgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdl\ndHMgdGhlIG1ldGFkYXRhIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIG5v\nbi1tYXBwZWQgaW50ZXJmYWNlLiBSZXR1cm5zIG51bGwsIGlmIHRoZSBnaXZl\nbgogICAgICogaW50ZXJmYWNlIGlzIG5vdCByZWdpc3RlcmVkIGFzIHBlcnNp\nc3RlbmNlLWF3YXJlLgogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVu\ndE1ldGFEYXRhIGdldE5vbk1hcHBlZEludGVyZmFjZShDbGFzczw/PiBpZmFj\nZSkgewogICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKSBf\nbm9uTWFwcGVkLmdldChpZmFjZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZXRzIHRoZSBjb3JyZXNwb25kaW5nIG1ldGFkYXRhcyBmb3IgYWxsIHJlZ2lz\ndGVyZWQsIG5vbi1tYXBwZWQgaW50ZXJmYWNlcwogICAgICogCiAgICAgKiBA\ncmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIG5vbi1tYXBwZWQgaW50ZXJmYWNl\nIGhhcyBiZWVuIHJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIHB1YmxpYyBOb25Q\nZXJzaXN0ZW50TWV0YURhdGFbXSBnZXROb25NYXBwZWRJbnRlcmZhY2VzKCkg\newogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKF9ub25NYXBwZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXROb25NYXBwZWRJbnRlcmZhY2VzSW50ZXJuYWwoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXROb25N\nYXBwZWRJbnRlcmZhY2VzSW50ZXJuYWwoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSBOb25QZXJzaXN0ZW50TWV0YURhdGFbXSBnZXROb25NYXBw\nZWRJbnRlcmZhY2VzSW50ZXJuYWwoKSB7CiAgICAgICAgICAgIGlmIChfbm9u\nTWFwcGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBU\nWV9OT05fUEVSU0lTVEVOVDsKICAgICAgICAgICAgcmV0dXJuIChOb25QZXJz\naXN0ZW50TWV0YURhdGFbXSkgX25vbk1hcHBlZC52YWx1ZXMoKS50b0FycmF5\nKG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGFbX25vbk1hcHBlZC5zaXplKCld\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gbm9uLW1h\ncHBlZCBpbnRlcmZhY2UgdG8gdGhlIHJlcG9zaXRvcnkuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBpZmFjZQogICAgICogICAgICAgICAgICB0aGUgbm9uLW1h\ncHBlZCBpbnRlcmZhY2UKICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YSBhZGROb25NYXBwZWRJbnRlcmZhY2UoQ2xhc3M8Pz4gaWZh\nY2UpIHsKICAgICAgICBpZiAoaWZhY2UgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFpZmFjZS5pc0ludGVyZmFjZSgp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vdC1ub24tbWFwcGVkIiwgaWZhY2UpKTsKICAgICAgICBpZiAo\nX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gYWRkTm9uTWFwcGVkSW50ZXJmYWNl\nSW50ZXJuYWwoaWZhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIGFkZE5vbk1hcHBlZEludGVyZmFjZUlu\ndGVybmFsKGlmYWNlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZh\ndGUgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFkZE5vbk1hcHBlZEludGVyZmFj\nZUludGVybmFsKENsYXNzPD8+IGlmYWNlKSB7CiAgICAgICAgICAgIGlmIChf\nbm9uTWFwcGVkLmNvbnRhaW5zS2V5KGlmYWNlKSkKICAgICAgICAgICAgICAg\nIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKSBfbm9uTWFwcGVkLmdl\ndChpZmFjZSk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0YShp\nZmFjZSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm9uLW1hcHBlZC1wYyIsIGlmYWNl\nKSk7CiAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBtZXRhID0K\nICAgICAgICAgICAgICAgIG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGEoaWZh\nY2UsIHRoaXMsIE5vblBlcnNpc3RlbnRNZXRhRGF0YS5UWVBFX05PTl9NQVBQ\nRURfSU5URVJGQUNFKTsKICAgICAgICAgICAgX25vbk1hcHBlZC5wdXQoaWZh\nY2UsIG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgICAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBub24tbWFwcGVkIGludGVyZmFj\nZSBmcm9tIHRoZSByZXBvc2l0b3J5CiAgICAgKiAKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiByZW1vdmVkCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZU5vbk1hcHBlZEludGVyZmFjZShDbGFzczw/PiBpZmFjZSkgewogICAg\nICAgIHJldHVybiBfbm9uTWFwcGVkLnJlbW92ZShpZmFjZSkgIT0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIHRoZSBjYWNoZSBvZiBwYXJz\nZWQgbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGFsc28gY2xlYXJzIHRoZSBpbnRl\ncm5hbAogICAgICoge0BsaW5rIE1ldGFEYXRhRmFjdG9yeSBNZXRhRGF0YUZh\nY3Rvcnl9J3MgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJjbGVhci1yZXBvcyIs\nIHRoaXMpKTsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAg\nc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBjbGVhcklu\ndGVybmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBjbGVhckludGVybmFsKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBjbGVhckludGVybmFsKCl7CiAgICAgICAgLy8gUmVj\ncmVhdGluZyB0aGVzZSBkYXRhc3RydWN0dXJlcyBpcyBwcm9iYWJseSBmYXN0\nZXIgdGhhbiBjYWxsaW5nIGNsZWFyLiBGdXR1cmUgY2hhbmdlPwogICAgICAg\nICAgICBfbWV0YXMuY2xlYXIoKTsKICAgICAgICAgICAgX29pZHMuY2xlYXIo\nKTsKICAgICAgICAgICAgX3N1YnMuY2xlYXIoKTsKICAgICAgICAgICAgX2lt\ncGxzLmNsZWFyKCk7CiAgICAgICAgICAgIF9xdWVyaWVzLmNsZWFyKCk7CiAg\nICAgICAgICAgIF9zZXFzLmNsZWFyKCk7CiAgICAgICAgICAgIF9yZWdpc3Rl\ncmVkLmNsZWFyKCk7CiAgICAgICAgICAgIF9mYWN0b3J5LmNsZWFyKCk7CiAg\nICAgICAgICAgIF9hbGlhc2VzLmNsZWFyKCk7CiAgICAgICAgICAgIF9wYXdh\ncmVzLmNsZWFyKCk7CiAgICAgICAgICAgIF9ub25NYXBwZWQuY2xlYXIoKTsK\nICAgIH0KICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQgb2YgY29uZmln\ndXJlZCBwZXJzaXN0ZW50IGNsYXNzZXMsIG9yIG51bGwgaWYgdGhlIHVzZXIg\nZGlkIG5vdCBjb25maWd1cmUgYW55LgogICAgICogCiAgICAgKiBAcGFyYW0g\nZGV2cGF0aAogICAgICogICAgICAgICAgICBpZiB0cnVlLCBzZWFyY2ggZm9y\nIG1ldGFkYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzIGluIHRoZSBjbGFzc3Bh\ndGggaWYgbm8gY2xhc3NlcwogICAgICogICAgICAgICAgICBhcmUgY29uZmln\ndXJlZCBleHBsaWNpdGx5CiAgICAgKiBAcGFyYW0gZW52TG9hZGVyCiAgICAg\nKiAgICAgICAgICAgIHRoZSBjbGFzcyBsb2FkZXIgdG8gdXNlLCBvciBudWxs\nIGZvciBkZWZhdWx0CiAgICAgKi8KICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBn\nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFBlcnNpc3RlbnRUeXBlTmFtZXNJbnRlcm5hbChkZXZw\nYXRoLCBlbnZMb2FkZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIGdldFBlcnNpc3RlbnRUeXBlTmFtZXNJ\nbnRlcm5hbChkZXZwYXRoLCBlbnZMb2FkZXIpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIFNldDxTdHJpbmc+IGdldFBlcnNpc3RlbnRUeXBlTmFt\nZXNJbnRlcm5hbChib29sZWFuIGRldnBhdGgsIENsYXNzTG9hZGVyIGVudkxv\nYWRlcikgewogICAgICAgIHJldHVybiBfZmFjdG9yeS5nZXRQZXJzaXN0ZW50\nVHlwZU5hbWVzKGRldnBhdGgsIGVudkxvYWRlcik7CiAgICB9CiAgICAvKioK\nICAgICAqIExvYWQgdGhlIHBlcnNpc3RlbnQgY2xhc3NlcyBuYW1lZCBpbiBj\nb25maWd1cmF0aW9uLgogICAgICogVGhpcyBlbnN1cmVzIHRoYXQgYWxsIHN1\nYmNsYXNzZXMgYW5kIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzZXMgb2YK\nICAgICAqIGVhY2ggdHlwZSBhcmUga25vd24gaW4gYWR2YW5jZSwgd2l0aG91\ndCBoYXZpbmcgdG8gcmVseSBvbiB0aGUKICAgICAqIGFwcGxpY2F0aW9uIGxv\nYWRpbmcgdGhlIGNsYXNzZXMgYmVmb3JlIHBlcmZvcm1pbmcgb3BlcmF0aW9u\ncyB0aGF0CiAgICAgKiBtaWdodCBpbnZvbHZlIHRoZW0uCiAgICAgKgogICAg\nICogQHBhcmFtIGRldnBhdGggaWYgdHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0\nYSBmaWxlcyBpbiBkaXJlY3RvcmllcwogICAgICogaW4gdGhlIGNsYXNzcGF0\naCBpZiB0aGUgbm8gY2xhc3NlcyBhcmUgY29uZmlndXJlZCBleHBsaWNpdGx5\nCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRoZSBjbGFzcyBsb2FkZXIgdG8g\ndXNlLCBvciBudWxsIGZvciBkZWZhdWx0CiAgICAgKiBAcmV0dXJuIHRoZSBs\nb2FkZWQgY2xhc3Nlcywgb3IgZW1wdHkgY29sbGVjdGlvbiBpZiBub25lCiAg\nICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9uPENsYXNzPD8+PiBsb2FkUGVy\nc2lzdGVudFR5cGVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyKSB7CiAgICAgICAgcmV0dXJuIGxvYWRQZXJzaXN0ZW50VHlwZXMo\nZGV2cGF0aCwgZW52TG9hZGVyLCBmYWxzZSk7CiAgICB9CiAgICAvKioKICAg\nICAqIExvYWQgdGhlIHBlcnNpc3RlbnQgY2xhc3NlcyBuYW1lZCBpbiBjb25m\naWd1cmF0aW9uLiBUaGlzIGVuc3VyZXMgdGhhdCBhbGwgc3ViY2xhc3NlcyBh\nbmQKICAgICAqIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzZXMgb2YgZWFj\naCB0eXBlIGFyZSBrbm93biBpbiBhZHZhbmNlLCB3aXRob3V0IGhhdmluZyB0\nbyByZWx5IG9uIHRoZQogICAgICogYXBwbGljYXRpb24gbG9hZGluZyB0aGUg\nY2xhc3NlcyBiZWZvcmUgcGVyZm9ybWluZyBvcGVyYXRpb25zIHRoYXQgbWln\naHQgaW52b2x2ZSB0aGVtLgogICAgICogCiAgICAgKiBAcGFyYW0gZGV2cGF0\naAogICAgICogICAgICAgICAgICBpZiB0cnVlLCBzZWFyY2ggZm9yIG1ldGFk\nYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzIGluIHRoZSBjbGFzc3BhdGggaWYg\ndGhlIG5vCiAgICAgKiAgICAgICAgICAgIGNsYXNzZXMgYXJlIGNvbmZpZ3Vy\nZWQgZXhwbGljaXRseQogICAgICogQHBhcmFtIGVudkxvYWRlcgogICAgICog\nICAgICAgICAgICB0aGUgY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3IgbnVsbCBm\nb3IgZGVmYXVsdAogICAgICogQHBhcmFtIG11c3RFeGlzdAogICAgICogICAg\nICAgICAgICBpZiB0cnVlIHRoZW4gZW1wdHkgbGlzdCBvZiBjbGFzc2VzIG9y\nIGFueSB1bmxvYWRhYmxlIGJ1dCBzcGVjaWZpZWQgY2xhc3Mgd2lsbAogICAg\nICogICAgICAgICAgICByYWlzZSBhbiBleGNlcHRpb24uCiAgICAgKiBAcmV0\ndXJuIHRoZSBsb2FkZWQgY2xhc3Nlcywgb3IgZW1wdHkgY29sbGVjdGlvbiBp\nZiBub25lCiAgICAgKi8KICAgIHB1YmxpYyBDb2xsZWN0aW9uPENsYXNzPD8+\nPiBsb2FkUGVyc2lzdGVudFR5cGVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsb2FkUGVyc2lzdGVudFR5\ncGVzSW50ZXJuYWwoZGV2cGF0aCwgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0\ndXJuIGxvYWRQZXJzaXN0ZW50VHlwZXNJbnRlcm5hbChkZXZwYXRoLCBlbnZM\nb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgQ29sbGVjdGlvbjxDbGFzczw/Pj4gbG9hZFBlcnNpc3RlbnRUeXBlc0lu\ndGVybmFsKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVy\nLCAKICAgICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgICAgICBT\nZXQ8U3RyaW5nPiBuYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZGV2\ncGF0aCwgZW52TG9hZGVyKTsKICAgICAgICAgICAgaWYgKG5hbWVzID09IG51\nbGwgfHwgbmFtZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIW11c3RFeGlzdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlYWdlci1uby1jbGFzcy1mb3VuZCIpKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gYXR0ZW1wdCB0byBsb2FkIGNsYXNzZXMgc28g\ndGhhdCB0aGV5IGdldCBwcm9jZXNzZWQKICAgICAgICAgICAgQ2xhc3NMb2Fk\nZXIgY2xzTG9hZGVyID0gX2NvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNl\nKCkuZ2V0Q2xhc3NMb2FkZXIoZ2V0Q2xhc3MoKSwgZW52TG9hZGVyKTsKICAg\nICAgICAgICAgTGlzdDxDbGFzczw/Pj4gY2xhc3NlcyA9IG5ldyBBcnJheUxp\nc3Q8Q2xhc3M8Pz4+KG5hbWVzLnNpemUoKSk7CiAgICAgICAgICAgIENsYXNz\nPD8+IGNsczsKICAgICAgICAgICAgZm9yIChTdHJpbmcgY2xhc3NOYW1lIDog\nbmFtZXMpIHsKICAgICAgICAgICAgICAgIGNscyA9IGNsYXNzRm9yTmFtZShj\nbGFzc05hbWUsIGNsc0xvYWRlcik7CiAgICAgICAgICAgICAgICBpZiAoX2Zh\nY3RvcnkuaXNNZXRhQ2xhc3MoY2xzKSkgewogICAgICAgICAgICAgICAgICAg\nIHNldE1ldGFNb2RlbChjbHMpOwogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNs\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGQo\nY2xzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGNsYXNzIGlz\nIGFuIGludGVyZmFjZSwgbG9hZCBpdHMgbWV0YWRhdGEgdG8ga2ljawogICAg\nICAgICAgICAgICAgICAgIC8vIG9mZiB0aGUgaW1wbCBnZW5lcmF0b3IKICAg\nICAgICAgICAgICAgICAgICBpZiAoY2xzLmlzSW50ZXJmYWNlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgY2xzTG9hZGVy\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNscyA9PSBu\ndWxsICYmIG11c3RFeGlzdCkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZWFnZXItY2xhc3Mt\nbm90LWZvdW5kIiwgY2xhc3NOYW1lKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNsYXNzZXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsYXNzIGZvciB0aGUgZ2l2\nZW4gbmFtZSwgb3IgbnVsbCBpZiBub3QgbG9hZGFibGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgQ2xhc3M8Pz4gY2xhc3NGb3JOYW1lKFN0cmluZyBuYW1lLCBD\nbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gQ2xhc3MuZm9yTmFtZShuYW1lLCB0cnVlLCBsb2FkZXIpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlm\nICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWRpc2NvdmVy\nLWNsYXNzIiwgbmFtZSwgbG9hZGVyKSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoX2xvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9n\nLmluZm8oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5hbWUsIGxv\nYWRlcikpOwogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShlKTsKICAgICAgICB9IGNh\ndGNoIChOb1N1Y2hNZXRob2RFcnJvciBuc21lKSB7CiAgICAgICAgICAgIGlm\nIChuc21lLmdldE1lc3NhZ2UoKS5pbmRleE9mKCIucGMiKSA9PSAtMSkKICAg\nICAgICAgICAgICAgIHRocm93IG5zbWU7CgogICAgICAgICAgICAvLyBpZiB0\naGUgZXJyb3IgaXMgYWJvdXQgYSBtZXRob2QgdGhhdCB1c2VzIHRoZSBQZXJz\naXN0ZW5jZUNhcGFibGUKICAgICAgICAgICAgLy8gJ3BjJyBtZXRob2QgcHJl\nZml4LCBwZXJmb3JtIHNvbWUgbG9nZ2luZyBhbmQgY29udGludWUuIFRoaXMK\nICAgICAgICAgICAgLy8gcHJvYmFibHkganVzdCBtZWFucyB0aGF0IHRoZSBj\nbGFzcyBpcyBub3QgeWV0IGVuaGFuY2VkLgogICAgICAgICAgICBpZiAoKF92\nYWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAgICAg\nICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFz\ncyIsIG5hbWUsIGxvYWRlcikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9s\nb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZv\nKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBuYW1lLCBsb2FkZXIp\nKTsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cudHJhY2UobnNtZSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGFsbCBrbm93biBzdWJjbGFzc2VzIGZvciB0aGUgZ2l2ZW4gY2xhc3MgbWFw\ncGluZy4gTm90ZSB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgd29ya3MKICAgICAq\nIGR1cmluZyBydW50aW1lIHdoZW4gdGhlIHJlcG9zaXRvcnkgaXMgcmVnaXN0\nZXJlZCBhcyBhIHtAbGluayBSZWdpc3RlckNsYXNzTGlzdGVuZXJ9LgogICAg\nICovCiAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBnZXRQQ1N1YmNsYXNzZXMo\nQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgQ29sbGVjdGlvbjxDbGFzczw/Pj4g\nc3VicyA9IF9zdWJzLmdldChjbHMpOwogICAgICAgIGlmIChzdWJzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0eUxpc3Qo\nKTsKICAgICAgICByZXR1cm4gc3ViczsKICAgIH0KCiAgICAvLyAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVnaXN0\nZXJDbGFzc0xpc3RlbmVyIGltcGxlbWVudGF0aW9uCiAgICAvLyAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2\nb2lkIHJlZ2lzdGVyKENsYXNzPD8+IGNscykgewogICAgICAgIC8vIGJ1ZmZl\nciByZWdpc3RlcmVkIGNsYXNzZXMgdW50aWwgYW4gb2lkIG1ldGFkYXRhIHJl\ncXVlc3QgaXMgbWFkZSwKICAgICAgICAvLyBhdCB3aGljaCBwb2ludCB3ZSds\nbCBwYXJzZSBldmVyeXRoaW5nIGluIHRoZSBidWZmZXIKICAgICAgICBzeW5j\naHJvbml6ZWQgKF9yZWdpc3RlcmVkKSB7CiAgICAgICAgICAgIF9yZWdpc3Rl\ncmVkLmFkZChjbHMpOwogICAgICAgICAgICByZWdpc3RlckFsaWFzKGNscyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2VzIHRoZSBt\nZXRhZGF0YSBmb3IgYWxsIHJlZ2lzdGVyZWQgY2xhc3Nlcy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShD\nbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBDbGFzczw/PltdIHJl\nZyA9IHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShy\nZWdbaV0sIGVudkxvYWRlciwgZmFsc2UpOwogICAgICAgICAgICB9IGNhdGNo\nIChNZXRhRGF0YUV4Y2VwdGlvbiBtZSkgewogICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2cud2FybihtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBVcGRhdGVzIG91ciBkYXRhc3RydWN0dXJlcyB3aXRo\nIHRoZSBsYXRlc3QgcmVnaXN0ZXJlZCBjbGFzc2VzLgogICAgICovCiAgICBD\nbGFzczw/PltdIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAoX3JlZ2lzdGVyZWQuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfQ0xBU1NFUzsKCiAgICAg\nICAgLy8gY29weSBpbnRvIG5ldyBjb2xsZWN0aW9uIHRvIGF2b2lkIGNvbmN1\ncnJlbnQgbW9kIGVycm9ycyBvbiByZWVudHJhbnQKICAgICAgICAvLyByZWdp\nc3RyYXRpb25zCiAgICAgICAgQ2xhc3M8Pz5bXSByZWc7CgkJc3luY2hyb25p\nemVkIChfcmVnaXN0ZXJlZCkgewogICAgICAgICAgICByZWcgPSBfcmVnaXN0\nZXJlZC50b0FycmF5KG5ldyBDbGFzc1tfcmVnaXN0ZXJlZC5zaXplKCldKTsK\nICAgICAgICAgICAgX3JlZ2lzdGVyZWQuY2xlYXIoKTsKICAgICAgICB9Cgog\nICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiBwY05hbWVzID0gZ2V0UGVyc2lz\ndGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICBDb2xs\nZWN0aW9uPENsYXNzPD8+PiBmYWlsZWQgPSBudWxsOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIC8vIGRvbid0IHByb2Nlc3MgdHlwZXMgdGhhdCBhcmVuJ3QgbGlzdGVkIGJ5\nIHRoZSB1c2VyOyBtYXkgYmVsb25nCiAgICAgICAgICAgIC8vIHRvIGEgZGlm\nZmVyZW50IHBlcnNpc3RlbmNlIHVuaXQKICAgICAgICAgICAgaWYgKHBjTmFt\nZXMgIT0gbnVsbCAmJiAhcGNOYW1lcy5pc0VtcHR5KCkgJiYgIXBjTmFtZXMu\nY29udGFpbnMocmVnW2ldLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBw\ncm9jZXNzUmVnaXN0ZXJlZENsYXNzKHJlZ1tpXSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICBpZiAoIV9j\nb25mLmdldFJldHJ5Q2xhc3NSZWdpc3RyYXRpb24oKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImVycm9yLXJlZ2lzdGVyZWQiLCByZWdbaV0pLCB0KTsKCiAgICAgICAgICAg\nICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJmYWlsZWQtcmVnaXN0ZXJlZCIs\nIHJlZ1tpXSksIHQpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGZhaWxlZCA9IG5ldyBBcnJheUxp\nc3Q8Q2xhc3M8Pz4+KCk7CiAgICAgICAgICAgICAgICBmYWlsZWQuYWRkKHJl\nZ1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZh\naWxlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoX3Jl\nZ2lzdGVyZWQpIHsKICAgICAgICAgICAgICAgIF9yZWdpc3RlcmVkLmFkZEFs\nbChmYWlsZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiByZWc7CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGVzIG91ciBk\nYXRhc3RydWN0dXJlcyB3aXRoIHRoZSBnaXZlbiByZWdpc3RlcmVkIGNsYXNz\nLiBSZWxpZXMgb24gdGhlIGZhY3QgdGhhdCBhIGNoaWxkCiAgICAgKiBjbGFz\ncyBjYW5ub3QgcmVnaXN0ZXIgaXRzZWxmIHdpdGhvdXQgYWxzbyByZWdpc3Rl\ncmluZyBpdHMgcGFyZW50IGNsYXNzIGJ5IHNwZWNpZnlpbmcgaXRzCiAgICAg\nKiBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3MgaW4gdGhlIHJlZ2lz\ndHJhdGlvbiBldmVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb2Nl\nc3NSZWdpc3RlcmVkQ2xhc3MoQ2xhc3M8Pz4gY2xzKSB7CiAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgicHJvY2Vzcy1yZWdpc3RlcmVkIiwgY2xzKSk7CgogICAg\nICAgIC8vIHVwZGF0ZSBzdWJjbGFzcyBsaXN0czsgc3luY2hyb25pemUgb24g\ndGhpcyBiZWNhdXNlIGFjY2Vzc2luZyBfbWV0YXMKICAgICAgICAvLyByZXF1\naXJlcyBpdAogICAgICAgIENsYXNzPD8+IGxlYXN0RGVyaXZlZCA9IGNsczsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAgICBmb3IgKENsYXNzPD8+IGFu\nYyA9IGNsczsgKGFuYyA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVy\nY2xhc3MoYW5jKSkgIT0gbnVsbDspIHsKICAgICAgICAgICAgICAgIGFkZFRv\nQ29sbGVjdGlvbihfc3VicywgYW5jLCBjbHMsIHRydWUpOwogICAgICAgICAg\nICAgICAgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBfbWV0YXMuZ2V0KGFuYyk7\nCiAgICAgICAgICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIG1ldGEuY2xlYXJTdWJjbGFzc0NhY2hlKCk7CiAgICAgICAg\nICAgICAgICBsZWFzdERlcml2ZWQgPSBhbmM7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gdXBkYXRlIG9pZCBtYXBwaW5n\ncyBpZiB0aGlzIGlzIGEgYmFzZSBjb25jcmV0ZSBjbGFzcwogICAgICAgIE9i\namVjdCBvaWQgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9p\nZCA9IFBDUmVnaXN0cnkubmV3T2JqZWN0SWQoY2xzKTsKICAgICAgICB9IGNh\ndGNoIChJbnRlcm5hbEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAvLyB0\naHJvd24gZm9yIHNpbmdsZSBmaWVsZCBpZGVudGl0eSB3aXRoIG51bGwgcGsg\nZmllbGQgdmFsdWUKICAgICAgICB9CiAgICAgICAgaWYgKG9pZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIENsYXNzPD8+IGV4aXN0aW5nID0gX29pZHMuZ2V0\nKG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAgICAgaWYgKGV4aXN0aW5nICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGFscmVh\nZHkgYSBjbGFzcyBmb3IgdGhpcyBPSUQsIHRoZW4gd2Uga25vdwogICAgICAg\nICAgICAgICAgLy8gdGhhdCBtdWx0aXBsZSBjbGFzc2VzIGFyZSB1c2luZyB0\naGUgc2FtZSBPSUQ6IHRoZXJlZm9yZSwKICAgICAgICAgICAgICAgIC8vIHB1\ndCB0aGUgbGVhc3QgZGVyaXZlZCBQQyBzdXBlcmNsYXNzIGludG8gdGhlIG1h\ncC4gVGhpcwogICAgICAgICAgICAgICAgLy8gZ2V0cyBhcm91bmQgdGhlIHBy\nb2JsZW0gb2YgYW4gYWJzdHJhY3QgUEMgc3VwZXJjbGFzcwogICAgICAgICAg\nICAgICAgLy8gdXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkgKHNpbmNlIG5l\nd09iamVjdElkCiAgICAgICAgICAgICAgICAvLyB3aWxsIHJldHVybiBudWxs\nIGZvciBhYnN0cmFjdCBjbGFzc2VzKS4KICAgICAgICAgICAgICAgIENsYXNz\nPD8+IHN1cCA9IGNsczsKICAgICAgICAgICAgICAgIHdoaWxlIChQQ1JlZ2lz\ndHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHN1cCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBzdXAgPSBQQ1JlZ2lzdHJ5LmdldFBlcnNpc3Rl\nbnRTdXBlcmNsYXNzKHN1cCk7CgogICAgICAgICAgICAgICAgX29pZHMucHV0\nKG9pZC5nZXRDbGFzcygpLCBzdXApOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKGV4aXN0aW5nID09IG51bGwgfHwgY2xzLmlzQXNzaWduYWJsZUZyb20oZXhp\nc3RpbmcpKQogICAgICAgICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFz\ncygpLCBjbHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gdXBkYXRlIG1hcHBp\nbmdzIGZyb20gaW50ZXJmYWNlcyBhbmQgbm9uLXBjIHN1cGVyY2xhc3NlcyB0\nbwogICAgICAgIC8vIHBjIGltcGxlbWVudGluZyB0eXBlcwogICAgICAgIGlm\nIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKF9pbXBs\ncykgewogICAgICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFzdERl\ncml2ZWQsIGNscyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICB1cGRhdGVJbXBscyhjbHMsIGxlYXN0RGVyaXZlZCwgY2xz\nKTsKICAgICAgICB9CgogICAgICAgIC8vIHNldCBhbGlhcyBmb3IgY2xhc3MK\nICAgICAgICByZWdpc3RlckFsaWFzKGNscyk7CiAgICB9CiAgICAKICAgIAog\nICAgLyoqCiAgICAgKiBSZWdpc3RlciB0aGUgZ2l2ZW4gY2xhc3MgdG8gdGhl\nIGxpc3Qgb2Yga25vd24gYWxpYXNlcy4KICAgICAqIFRoZSBhbGlhcyBpcyBy\nZWdpc3RlcmVkIG9ubHkgaWYgdGhlIGNsYXNzIGhhcyBiZWVuIGVuaGFuY2Vk\nLgogICAgICogCiAgICAgKi8KICAgIHZvaWQgcmVnaXN0ZXJBbGlhcyhDbGFz\nczw/PiBjbHMpIHsKICAgICAgICByZWdpc3RlckFsaWFzKFBDUmVnaXN0cnku\nZ2V0VHlwZUFsaWFzKGNscyksIGNscyk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIHJlZ2lzdGVyQWxpYXMoU3RyaW5nIGFsaWFzLCBDbGFzczw/PiBj\nbHMpIHsKICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChhbGlhcyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBMaXN0PENsYXNzPD8+PiBjbGFz\nc2VzID0gX2FsaWFzZXMuZ2V0KGFsaWFzKTsKICAgICAgICAgICAgICAgIGlm\nIChjbGFzc2VzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY2xhc3Nl\ncyA9IG5ldyBBcnJheUxpc3Q8Q2xhc3M8Pz4+KDMpOwogICAgICAgICAgICAg\nICAgaWYgKCFjbGFzc2VzLmNvbnRhaW5zKGNscykpIHsKICAgICAgICAgICAg\nICAgICAgICBjbGFzc2VzLmFkZChjbHMpOwogICAgICAgICAgICAgICAgICAg\nIF9hbGlhc2VzLnB1dChhbGlhcywgY2xhc3Nlcyk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24gaXNlKSB7CiAgICAgICAgICAgIC8vIHRoZSBjbGFzcyBo\nYXMgbm90IGJlZW4gcmVnaXN0ZXJlZCB0byBQQ1JlZ2lzdHJ5CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBsaXN0IG9mIGlt\ncGxlbWVudGF0aW9ucyBvZiBiYXNlIGNsYXNzZXMgYW5kIGludGVyZmFjZXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVJbXBscyhDbGFzczw/\nPiBjbHMsIENsYXNzPD8+IGxlYXN0RGVyaXZlZCwgQ2xhc3M8Pz4gY2hlY2sp\nIHsKICAgICAgICAvLyBhbGxvdyB1c2VycyB0byBxdWVyeSBvbiBjb21tb24g\nbm9uLXBjIHN1cGVyY2xhc3NlcwogICAgICAgIENsYXNzPD8+IHN1cCA9IGNo\nZWNrLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBpZiAobGVhc3REZXJpdmVk\nID09IGNscyAmJiBzdXAgIT0gbnVsbCAmJiBzdXAgIT0gT2JqZWN0LmNsYXNz\nKSB7CiAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfaW1wbHMsIHN1cCwg\nY2xzLCBmYWxzZSk7CiAgICAgICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVh\nc3REZXJpdmVkLCBzdXApOwogICAgICAgIH0KCiAgICAgICAgLy8gYWxsb3cg\ndXNlcnMgdG8gcXVlcnkgb24gYW55IGltcGxlbWVudGVkIGludGVyZmFjZXMg\ndW5sZXNzIGRlZmF1bHRzCiAgICAgICAgLy8gc2F5IHRoZSB1c2VyIG11c3Qg\naW1wbGVtZW50IHBlcnNpc3RlbnQgaW50ZXJmYWNlcyBleHBsaWNpdGx5IGlu\nIG1ldGEKICAgICAgICBpZiAoIV9mYWN0b3J5LmdldERlZmF1bHRzKCkuaXNE\nZWNsYXJlZEludGVyZmFjZVBlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIENsYXNzPD8+W10gaW50cyA9IGNoZWNrLmdldEludGVy\nZmFjZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGludHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbWFwIGphdmEtc3Rh\nbmRhcmQgaW50ZXJmYWNlcwogICAgICAgICAgICBpZiAoaW50c1tpXS5nZXRO\nYW1lKCkuc3RhcnRzV2l0aCgiamF2YS4iKSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgLy8gb25seSBtYXAgbGVhc3QtZGVyaXZl\nZCBpbnRlcmZhY2UgaW1wbGVtZW50b3JzCiAgICAgICAgICAgIGlmIChsZWFz\ndERlcml2ZWQgPT0gY2xzIHx8IGlzTGVhc3REZXJpdmVkSW1wbChpbnRzW2ld\nLCBjbHMpKSB7CiAgICAgICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2lt\ncGxzLCBpbnRzW2ldLCBjbHMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHVw\nZGF0ZUltcGxzKGNscywgbGVhc3REZXJpdmVkLCBpbnRzW2ldKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0cnVlIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyB0aGUgbGVhc3QtZGVyaXZl\nZCBwZXJzaXN0ZW50IGltcGxlbWVudG9yIG9mIHRoZSBnaXZlbgogICAgICog\naW50ZXJmYWNlLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBpc0xlYXN0RGVyaXZlZEltcGwoQ2xhc3M8Pz4gaW50ZXIs\nIENsYXNzPD8+IGNscykgewogICAgICAgIENsYXNzPD8+IHBhcmVudCA9IFBD\nUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3MoY2xzKTsKICAgICAg\nICB3aGlsZSAocGFyZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKEFy\ncmF5cy5hc0xpc3QocGFyZW50LmdldEludGVyZmFjZXMoKSkuY29udGFpbnMo\naW50ZXIpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBwYXJlbnQgPSBQQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNs\nYXNzKHBhcmVudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiB2YWx1ZSB0byB0\naGUgY29sbGVjdGlvbiBjYWNoZWQgaW4gdGhlIGdpdmVuIG1hcCB1bmRlciB0\naGUgZ2l2ZW4ga2V5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkVG9D\nb2xsZWN0aW9uKE1hcCBtYXAsIENsYXNzPD8+IGtleSwgQ2xhc3M8Pz4gdmFs\ndWUsIGJvb2xlYW4gaW5oZXJpdGFuY2UpIHsKICAgICAgICBpZiAoX2xvY2tp\nbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChtYXApIHsKICAgICAg\nICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbkludGVybmFsKG1hcCwga2V5LCB2\nYWx1ZSwgaW5oZXJpdGFuY2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uSW50ZXJuYWwobWFw\nLCBrZXksIHZhbHVlLCBpbmhlcml0YW5jZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCBhZGRUb0NvbGxlY3Rpb25JbnRlcm5hbChNYXAg\nbWFwLCBDbGFzczw/PiBrZXksIENsYXNzPD8+IHZhbHVlLCBib29sZWFuIGlu\naGVyaXRhbmNlKSB7CiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gKENvbGxl\nY3Rpb24pIG1hcC5nZXQoa2V5KTsKICAgICAgICBpZiAoY29sbCA9PSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChpbmhlcml0YW5jZSkgewogICAgICAgICAg\nICAgICAgSW5oZXJpdGFuY2VDb21wYXJhdG9yIGNvbXAgPSBuZXcgSW5oZXJp\ndGFuY2VDb21wYXJhdG9yKCk7CiAgICAgICAgICAgICAgICBjb21wLnNldEJh\nc2Uoa2V5KTsKICAgICAgICAgICAgICAgIGNvbGwgPSBuZXcgVHJlZVNldDxD\nbGFzczw/Pj4oY29tcCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgY29sbCA9IG5ldyBMaW5rZWRMaXN0PENsYXNzPD8+PigpOwogICAg\nICAgICAgICBtYXAucHV0KGtleSwgY29sbCk7CiAgICAgICAgfQogICAgICAg\nIGNvbGwuYWRkKHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFB1dHMg\ndGhlIG1ldGEgY2xhc3MgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gZW50\naXR5IGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNZXRhTW9k\nZWwoQ2xhc3M8Pz4gbTIpIHsKICAgICAgICBDbGFzczw/PiBjbHMgPSBfZmFj\ndG9yeS5nZXRNYW5hZ2VkQ2xhc3MobTIpOwogICAgICAgIGlmIChjbHMgIT0g\nbnVsbCkKICAgICAgICAgICAgX21ldGFtb2RlbC5wdXQoY2xzLCBtMik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQdXRzIHRoZSBtZXRhIGNsYXNzIGNvcnJl\nc3BvbmRpbmcgdG8gdGhlIGdpdmVuIHBlcnNpc3RlbnQgY2xhc3MuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldE1ldGFNb2RlbChDbGFzc01ldGFEYXRh\nIG1ldGEsIENsYXNzPD8+IG0yKSB7CiAgICAgICAgX21ldGFtb2RlbC5wdXQo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIG0yKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEdldHMgdGhlIG1ldGEgY2xhc3MgY29ycmVzcG9uZGluZyB0byB0\naGUgZ2l2ZW4gcGVyc2lzdGVudCBjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzPD8+IGdldE1ldGFNb2RlbChDbGFzc01ldGFEYXRhIG1ldGEsIGJv\nb2xlYW4gbG9hZCkgewogICAgICAgIHJldHVybiBnZXRNZXRhTW9kZWwobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksIGxvYWQpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2V0cyB0aGUgbWV0YSBjbGFzcyBjb3JyZXNwb25kaW5nIHRvIHRo\nZSBnaXZlbiBjbGFzcy4gSWYgbG9hZCBpcyBmYWxzZSwgcmV0dXJucyB0aGUg\nbWV0YQogICAgICogY2xhc3MgaWYgaGFzIGJlZW4gc2V0IGZvciB0aGUgZ2l2\nZW4gcGVyc2lzdGVudCBjbGFzcyBlYXJsaWVyLiBJZiB0aGUgbG9hZCBpcyB0\ncnVlIHRoZW4gYWxzbwogICAgICogYXR0ZW1wdHMgdG8gYXBwbHkgdGhlIGN1\ncnJlbnQgbmFtaW5nIHBvbGljeSB0byBkZXJpdmUgbWV0YSBjbGFzcyBuYW1l\nIGFuZCBhdHRlbXB0cyB0byBsb2FkCiAgICAgKiB0aGUgbWV0YSBjbGFzcy4K\nICAgICAqLwogICAgcHVibGljIENsYXNzPD8+IGdldE1ldGFNb2RlbChDbGFz\nczw/PiBlbnRpdHksIGJvb2xlYW4gbG9hZCkgewogICAgICAgIGlmIChfbWV0\nYW1vZGVsLmNvbnRhaW5zS2V5KGVudGl0eSkpCiAgICAgICAgICAgIHJldHVy\nbiBfbWV0YW1vZGVsLmdldChlbnRpdHkpOwogICAgICAgIFN0cmluZyBtMiA9\nIF9mYWN0b3J5LmdldE1ldGFNb2RlbENsYXNzTmFtZShlbnRpdHkuZ2V0TmFt\nZSgpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc0xvYWRlciBs\nb2FkZXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJp\ndkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihlbnRpdHkpKTsKICAgICAg\nICAgICAgQ2xhc3M8Pz4gbTJjbHMgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRGb3JOYW1lQWN0aW9uKG0yLCB0\ncnVlLCBsb2FkZXIpKTsKICAgICAgICAgICAgX21ldGFtb2RlbC5wdXQoZW50\naXR5LCBtMmNscyk7CiAgICAgICAgICAgIHJldHVybiBtMmNsczsKICAgICAg\nICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICBpZiAoX2xv\nZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndhcm4o\nX2xvYy5nZXQoIm1ldGEtbm8tbW9kZWwiLCBtMiwgZW50aXR5LCB0KSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8vIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25maWd1cmFi\nbGUgaW1wbGVtZW50YXRpb24KICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihD\nb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IChPcGVuSlBB\nQ29uZmlndXJhdGlvbikgY29uZjsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0\nTG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRBREFUQSk7CiAgICAg\nICAgX3Jlb3JkZXJNZXRhRGF0YVJlc29sdXRpb24gPSBfY29uZi5nZXRDb21w\nYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRSZW9yZGVyTWV0YURhdGFSZXNvbHV0\naW9uKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RhcnRDb25maWd1cmF0\naW9uKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIGVuZENvbmZpZ3VyYXRp\nb24oKSB7CiAgICAgICAgaW5pdGlhbGl6ZU1ldGFEYXRhRmFjdG9yeSgpOwog\nICAgICAgIGlmIChfaW1wbEdlbiA9PSBudWxsKQogICAgICAgICAgICBfaW1w\nbEdlbiA9IG5ldyBJbnRlcmZhY2VJbXBsR2VuZXJhdG9yKHRoaXMpOwogICAg\nICAgIGlmIChfcHJlbG9hZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIF9vaWRz\nID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIENsYXNzPD8+PigpOwogICAgICAg\nICAgICBfaW1wbHMgPSBuZXcgSGFzaE1hcDxDbGFzczw/PiwgQ29sbGVjdGlv\nbjxDbGFzczw/Pj4+KCk7CiAgICAgICAgICAgIF9pZmFjZXMgPSBuZXcgSGFz\naE1hcDxDbGFzczw/PiwgQ2xhc3M8Pz4+KCk7CiAgICAgICAgICAgIF9hbGlh\nc2VzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBMaXN0PENsYXNzPD8+Pj4oKTsK\nICAgICAgICAgICAgX3Bhd2FyZXMgPSBuZXcgSGFzaE1hcDxDbGFzczw/Piwg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhPigpOwogICAgICAgICAgICBfbm9uTWFw\ncGVkID0gbmV3IEhhc2hNYXA8Q2xhc3M8Pz4sIE5vblBlcnNpc3RlbnRNZXRh\nRGF0YT4oKTsKICAgICAgICAgICAgX3N1YnMgPSBuZXcgSGFzaE1hcDxDbGFz\nczw/PiwgTGlzdDxDbGFzczw/Pj4+KCk7CiAgICAgICAgICAgIC8vIFdhaXQg\ndGlsbCB3ZSdyZSBkb25lIGxvYWRpbmcgTWV0YURhdGEgdG8gZmxpcCBfbG9j\nayBib29sZWFuLgogICAgICAgIH0gICAgICAgICAgICAKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgaW5pdGlhbGl6ZU1ldGFEYXRhRmFjdG9yeSgpIHsKICAg\nICAgICBpZiAoX2ZhY3RvcnkgPT0gbnVsbCkgewogICAgICAgICAgICBNZXRh\nRGF0YUZhY3RvcnkgbWRmID0gX2NvbmYubmV3TWV0YURhdGFGYWN0b3J5SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgaWYgKG1kZiA9PSBudWxsKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1tZXRhZGF0YWZhY3RvcnkiKSk7CiAgICAgICAgICAgIHNldE1ldGFE\nYXRhRmFjdG9yeShtZGYpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyAvLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBtZXRhZGF0YQogICAgLy8gLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHF1ZXJ5IG1l\ndGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIG5hbWUsIGFuZCBjbGFzc2xv\nYWRlci4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURhdGEgZ2V0UXVl\ncnlNZXRhRGF0YShDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lLCBDbGFzc0xv\nYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAg\naWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhp\ncykgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldFF1ZXJ5TWV0YURhdGFJ\nbnRlcm5hbChjbHMsIG5hbWUsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVy\nbiBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2Fk\nZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoQ2xhc3M8\nPz4gY2xzLCBTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCAK\nICAgICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgICAgICBRdWVy\neU1ldGFEYXRhIG1ldGEgPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xz\nLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgICAgICBpZiAobWV0YSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAvLyBsb2FkIGFsbCB0aGUgbWV0YWRh\ndGFzIGZvciBhbGwgdGhlIGtub3duIGNsYXNzZXMgc28gdGhhdAogICAgICAg\nICAgICAgICAgLy8gcXVlcnkgbmFtZXMgYXJlIHNlZW4gYW5kIHJlZ2lzdGVy\nZWQKICAgICAgICAgICAgICAgIHJlc29sdmVBbGwoZW52TG9hZGVyKTsKICAg\nICAgICAgICAgICAgIG1ldGEgPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwo\nY2xzLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAobWV0YSA9PSBudWxsICYmIG11c3RFeGlzdCkgewogICAgICAg\nICAgICAgICAgaWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1u\nYW1lZC1xdWVyeS1udWxsLWNsYXNzIiwgZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyhmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW52TG9hZGVyKSwg\nbmFtZSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW5hbWVkLXF1ZXJ5IiwgY2xzLCBuYW1lKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBtZXRhOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBhbGwga25vd24gbWV0YWRh\ndGEgY2xhc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVB\nbGwoQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgQ29sbGVjdGlv\nbjxDbGFzczw/Pj4gdHlwZXMgPSBsb2FkUGVyc2lzdGVudFR5cGVzKGZhbHNl\nLCBlbnZMb2FkZXIpOwogICAgICAgIGZvciAoQ2xhc3M8Pz4gYyA6IHR5cGVz\nKSB7CiAgICAgICAgICAgIGdldE1ldGFEYXRhKGMsIGVudkxvYWRlciwgZmFs\nc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBx\ndWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLCBuYW1lLCBhbmQg\nY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAgIHByaXZhdGUgUXVlcnlNZXRhRGF0\nYSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoQ2xhc3M8Pz4gY2xzLCBTdHJp\nbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgUXVlcnlNZXRhRGF0YSBxbSA9IG51bGw7CiAgICAgICAgaWYgKGNscyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIHFtID0gc2VhcmNoUXVlcnlNZXRhRGF0\nYUJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgaWYgKHFtICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gcW07CiAgICAgICAgfQogICAgICAgIC8v\nIGNoZWNrIGNhY2hlCiAgICAgICAgT2JqZWN0IGtleSA9IGdldFF1ZXJ5S2V5\nKGNscywgbmFtZSk7CiAgICAgICAgcW0gPSAoUXVlcnlNZXRhRGF0YSkgX3F1\nZXJpZXMuZ2V0KGtleSk7CiAgICAgICAgaWYgKHFtICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBxbTsKCiAgICAgICAgLy8gZ2V0IG1ldGFkYXRhIGZv\nciBjbGFzcywgd2hpY2ggd2lsbCBmaW5kIHF1ZXJpZXMgaW4gbWV0YWRhdGEg\nZmlsZQogICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBnZXRNZXRhRGF0YShj\nbHMsIGVudkxvYWRlciwgZmFsc2UpICE9IG51bGwpIHsKICAgICAgICAgICAg\ncW0gPSBfcXVlcmllcy5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKHFtICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcW07CiAgICAgICAgfQog\nICAgICAgIGlmICgoX3NvdXJjZU1vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gc2VlIGlmIGZh\nY3RvcnkgY2FuIGZpZ3VyZSBvdXQgYSBzY29wZSBmb3IgdGhpcyBxdWVyeQog\nICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gX2Zh\nY3RvcnkuZ2V0UXVlcnlTY29wZShuYW1lLCBlbnZMb2FkZXIpOwoKICAgICAg\nICAvLyBub3QgaW4gY2FjaGU7IGxvYWQKICAgICAgICBfZmFjdG9yeS5sb2Fk\nKGNscywgTU9ERV9RVUVSWSwgZW52TG9hZGVyKTsKICAgICAgICByZXR1cm4g\nX3F1ZXJpZXMuZ2V0KGtleSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGNhY2hlZCBxdWVyeSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVi\nbGljIFF1ZXJ5TWV0YURhdGFbXSBnZXRRdWVyeU1ldGFEYXRhcygpIHsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURh\ndGFbXSkgX3F1ZXJpZXMudmFsdWVzKCkudG9BcnJheShuZXcgUXVlcnlNZXRh\nRGF0YVtfcXVlcmllcy5zaXplKCldKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAoUXVlcnlNZXRhRGF0YVtd\nKSBfcXVlcmllcy52YWx1ZXMoKS50b0FycmF5KG5ldyBRdWVyeU1ldGFEYXRh\nW19xdWVyaWVzLnNpemUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhIGZvciB0\naGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5TWV0YURh\ndGEgZ2V0Q2FjaGVkUXVlcnlNZXRhRGF0YShDbGFzczw/PiBjbHMsIFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgcmV0dXJu\nIChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoZ2V0UXVlcnlLZXkoY2xz\nLCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURhdGEpIF9xdWVyaWVzLmdldChn\nZXRRdWVyeUtleShjbHMsIG5hbWUpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgYSBuZXcgcXVlcnkgbWV0YWRhdGEgdG8gdGhlIHJl\ncG9zaXRvcnkgYW5kIHJldHVybiBpdC4KICAgICAqLwogICAgcHVibGljIFF1\nZXJ5TWV0YURhdGEgYWRkUXVlcnlNZXRhRGF0YShDbGFzczw/PiBjbHMsIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2NraW5nKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgUXVl\ncnlNZXRhRGF0YSBtZXRhID0gbmV3UXVlcnlNZXRhRGF0YShjbHMsIG5hbWUp\nOwogICAgICAgICAgICAgICAgX3F1ZXJpZXMucHV0KGdldFF1ZXJ5S2V5KG1l\ndGEpLCBtZXRhKTsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAg\nICAgICAgICB9CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIFF1ZXJ5TWV0\nYURhdGEgbWV0YSA9IG5ld1F1ZXJ5TWV0YURhdGEoY2xzLCBuYW1lKTsKICAg\nICAgICAgICAgX3F1ZXJpZXMucHV0KGdldFF1ZXJ5S2V5KG1ldGEpLCBtZXRh\nKTsKICAgICAgICAgICAgcmV0dXJuIG1ldGE7ICAgCiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHF1ZXJ5IG1ldGFkYXRh\nIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgUXVlcnlNZXRhRGF0\nYSBuZXdRdWVyeU1ldGFEYXRhKENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEgPSBuZXcgUXVlcnlNZXRh\nRGF0YShuYW1lKTsKICAgICAgICBtZXRhLnNldERlZmluaW5nVHlwZShjbHMp\nOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVtb3ZlIHRoZSBnaXZlbiBxdWVyeSBtZXRhZGF0YSBmcm9tIHRoZSByZXBv\nc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVRdWVy\neU1ldGFEYXRhKFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICht\nZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0\naGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXMucmVtb3Zl\nKGdldFF1ZXJ5S2V5KG1ldGEpKSAhPSBudWxsOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVzLnJl\nbW92ZShnZXRRdWVyeUtleShtZXRhKSkgIT0gbnVsbDsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgcXVlcnkgbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGlmIGluIHRoZSByZXBvc2l0b3J5Lgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVRdWVyeU1ldGFEYXRh\nKENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX2xv\nY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAg\nICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBf\ncXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSkgIT0gbnVs\nbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVl\ncnlLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZWFyY2hlcyBhbGwgY2FjaGVkIHF1ZXJ5IG1ldGFk\nYXRhIGJ5IG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeU1ldGFEYXRh\nIHNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5hbWUoU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBmb3IgKE9iamVjdCBrZXkgOiBfcXVlcmllcy5rZXlTZXQoKSkgewog\nICAgICAgICAgICBpZiAoa2V5IGluc3RhbmNlb2YgUXVlcnlLZXkpCiAgICAg\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKCgoUXVlcnlLZXkp\nIGtleSkubmFtZSwgbmFtZSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoa2V5KTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSB1bmlxdWUga2V5IGZvciBhIGdpdmVuIFF1ZXJ5TWV0YURhdGEu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZXRRdWVyeUtl\neShRdWVyeU1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4g\nZ2V0UXVlcnlLZXkobWV0YS5nZXREZWZpbmluZ1R5cGUoKSwgbWV0YS5nZXRO\nYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgdW5pcXVl\nIGtleSBmb3IgYSBnaXZlbiBjbGFzcyAvIG5hbWUuIFRoZSBjbGFzcyBhcmd1\nbWVudCBjYW4gYmUgbnVsbC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBPYmplY3QgZ2V0UXVlcnlLZXkoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgbmFt\nZSkgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG5hbWU7CiAgICAgICAgUXVlcnlLZXkga2V5ID0gbmV3IFF1ZXJ5S2V5\nKCk7CiAgICAgICAga2V5LmNsc05hbWUgPSBjbHMuZ2V0TmFtZSgpOwogICAg\nICAgIGtleS5uYW1lID0gbmFtZTsKICAgICAgICByZXR1cm4ga2V5OwogICAg\nfQoKICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFNlcXVlbmNl\nIG1ldGFkYXRhCiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZl\nbiBuYW1lIGFuZCBjbGFzc2xvYWRlci4KICAgICAqLwogICAgcHVibGljIFNl\ncXVlbmNlTWV0YURhdGEgZ2V0U2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFt\nZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkg\newogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRTZXF1\nZW5jZU1ldGFEYXRhSW50ZXJuYWwobmFtZSwgZW52TG9hZGVyLCBtdXN0RXhp\nc3QpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgcmV0dXJuIGdldFNlcXVlbmNlTWV0YURhdGFJbnRlcm5hbChuYW1lLCBl\nbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1ZW5jZU1ldGFEYXRhSW50\nZXJuYWwoU3RyaW5nIG5hbWUsIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9v\nbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0\nYSBtZXRhID0gZ2V0U2VxdWVuY2VNZXRhRGF0YUludGVybmFsKG5hbWUsIGVu\ndkxvYWRlcik7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwgJiYgU2Vx\ndWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTS5lcXVhbHMobmFtZSkpIHsKICAg\nICAgICAgICAgICAgIGlmIChfc3lzU2VxID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgX3N5c1NlcSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFtZSk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gX3N5c1NlcTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsICYmIG11c3RFeGlzdCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbmFtZWQtc2VxdWVuY2UiLCBuYW1lKSk7CiAgICAgICAg\nICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBp\nbnRlcm5hbGx5IGJ5IG1ldGFkYXRhIHRvIHJldHJpZXZlIHNlcXVlbmNlIG1l\ndGFkYXRhcyBiYXNlZCBvbiBwb3NzaWJseS11bnF1YWxpZmllZAogICAgICog\nc2VxdWVuY2UgbmFtZS4KICAgICAqLwogICAgU2VxdWVuY2VNZXRhRGF0YSBn\nZXRTZXF1ZW5jZU1ldGFEYXRhKENsYXNzTWV0YURhdGEgY29udGV4dCwgU3Ry\naW5nIG5hbWUsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgLy8gdHJ5\nIHdpdGggZ2l2ZW4gbmFtZQogICAgICAgIE1ldGFEYXRhRXhjZXB0aW9uIGUg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNlcXVlbmNlTWV0\nYURhdGEgc2VxID0gZ2V0U2VxdWVuY2VNZXRhRGF0YShuYW1lLCBjb250ZXh0\nLmdldEVudkNsYXNzTG9hZGVyKCksIG11c3RFeGlzdCk7CiAgICAgICAgICAg\nIGlmIChzZXEgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBzZXE7\nCiAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFFeGNlcHRpb24gbWRlKSB7CiAg\nICAgICAgICAgIGUgPSBtZGU7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBn\naXZlbiBuYW1lIGFscmVhZHkgZnVsbHkgcXVhbGlmaWVkLCBnaXZlIHVwCiAg\nICAgICAgaWYgKG5hbWUuaW5kZXhPZignLicpICE9IC0xKSB7CiAgICAgICAg\nICAgIGlmIChlICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBlOwog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8v\nIHRyeSB3aXRoIHF1YWxpZmllZCBuYW1lCiAgICAgICAgbmFtZSA9IFN0cmlu\nZ3MuZ2V0UGFja2FnZU5hbWUoY29udGV4dC5nZXREZXNjcmliZWRUeXBlKCkp\nICsgIi4iICsgbmFtZTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gZ2V0U2VxdWVuY2VNZXRhRGF0YShuYW1lLCBjb250ZXh0LmdldEVudkNs\nYXNzTG9hZGVyKCksIG11c3RFeGlzdCk7CiAgICAgICAgfSBjYXRjaCAoTWV0\nYURhdGFFeGNlcHRpb24gbWRlKSB7CiAgICAgICAgICAgIC8vIHRocm93IG9y\naWdpbmFsIGV4Y2VwdGlvbgogICAgICAgICAgICBpZiAoZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgdGhyb3cgbWRl\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBzZXF1\nZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIGNsYXNzbG9h\nZGVyLgogICAgICovCiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgZ2V0\nU2VxdWVuY2VNZXRhRGF0YUludGVybmFsKFN0cmluZyBuYW1lLCBDbGFzc0xv\nYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgY2Fj\naGUKICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSBfc2Vxcy5nZXQo\nbmFtZSk7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAg\nICAvLyBsb2FkIG1ldGFkYXRhIGZvciByZWdpc3RlcmVkIGNsYXNzZXMgdG8g\naG9wZWZ1bGx5IGZpbmQgc2VxdWVuY2UKICAgICAgICAgICAgLy8gZGVmaW5p\ndGlvbgogICAgICAgICAgICBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEo\nZW52TG9hZGVyKTsKICAgICAgICAgICAgbWV0YSA9IF9zZXFzLmdldChuYW1l\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBzZXF1ZW5jZSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGFbXSBnZXRT\nZXF1ZW5jZU1ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsK\nICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gKFNlcXVlbmNlTWV0YURhdGFbXSkgX3NlcXMudmFsdWVz\nKCkudG9BcnJheShuZXcgU2VxdWVuY2VNZXRhRGF0YVtfc2Vxcy5zaXplKCld\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIHJldHVybiAoU2VxdWVuY2VNZXRhRGF0YVtdKSBfc2Vxcy52YWx1ZXMoKS50\nb0FycmF5KG5ldyBTZXF1ZW5jZU1ldGFEYXRhW19zZXFzLnNpemUoKV0pOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2Fj\naGVkIGEgc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lLgog\nICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBnZXRDYWNoZWRT\nZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9s\nb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewog\nICAgICAgICAgICAgICAgcmV0dXJuIChTZXF1ZW5jZU1ldGFEYXRhKSBfc2Vx\ncy5nZXQobmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICByZXR1cm4gKFNlcXVlbmNlTWV0YURhdGEpIF9zZXFzLmdl\ndChuYW1lKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\nYSBuZXcgc2VxdWVuY2UgbWV0YWRhdGEgdG8gdGhlIHJlcG9zaXRvcnkgYW5k\nIHJldHVybiBpdC4KICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURh\ndGEgYWRkU2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9\nIG5ld1NlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgICAgICAgICBf\nc2Vxcy5wdXQobmFtZSwgbWV0YSk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nbWV0YTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IG5ld1NlcXVlbmNlTWV0YURh\ndGEobmFtZSk7CiAgICAgICAgICAgIF9zZXFzLnB1dChuYW1lLCBtZXRhKTsK\nICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNlcXVlbmNlIG1ldGFkYXRhIGlu\nc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2VNZXRhRGF0\nYSBuZXdTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBTZXF1ZW5jZU1ldGFEYXRhKG5hbWUsIHRoaXMpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzZXF1ZW5jZSBt\nZXRhZGF0YSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsK\nICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gX3NlcXMucmVtb3ZlKG1ldGEuZ2V0TmFtZSgpKSAhPSBu\ndWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgcmV0dXJuIF9zZXFzLnJlbW92ZShtZXRhLmdldE5hbWUoKSkgIT0gbnVs\nbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgc2Vx\ndWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBuYW1lIGlmIGluIHRoZSByZXBvc2l0\nb3J5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTZXF1ZW5j\nZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChf\nbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBfc2Vxcy5yZW1vdmUobmFtZSkgIT0g\nbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHJldHVybiBfc2Vxcy5yZW1vdmUobmFtZSkgIT0gbnVsbDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHN5c3Rl\nbSBsaWZlY3ljbGUgbGlzdGVuZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFkZFN5c3RlbUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lcikgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgICAgIC8vIGNvcHkgdG8gYXZvaWQgaXNzdWVz\nIHdpdGggTGlzdGVuZXJMaXN0IGFuZCBhdm9pZCB1bm5jZXNzYXJ5CiAgICAg\nICAgICAgICAgICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1cmluZyBydW50\naW1lCiAgICAgICAgICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlz\ndGVuZXJMaXN0IGxpc3RlbmVycyA9IG5ldyBMaWZlY3ljbGVFdmVudE1hbmFn\nZXIuTGlzdGVuZXJMaXN0KF9saXN0ZW5lcnMpOwogICAgICAgICAgICAgICAg\nbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICAgICAgICAgICAgICBfbGlz\ndGVuZXJzID0gbGlzdGVuZXJzOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3Rl\nbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcgTGlmZWN5Y2xlRXZlbnRNYW5hZ2Vy\nLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICAgICAgbGlzdGVu\nZXJzLmFkZChsaXN0ZW5lcik7CiAgICAgICAgICAgIF9saXN0ZW5lcnMgPSBs\naXN0ZW5lcnM7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBnaXZlbiBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVyLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTeXN0ZW1MaXN0ZW5lcihP\nYmplY3QgbGlzdGVuZXIpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gcmVtb3ZlU3lzdGVtTGlzdGVuZXJJbnRlcm5hbChsaXN0ZW5l\ncik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICByZXR1cm4gcmVtb3ZlU3lzdGVtTGlzdGVuZXJJbnRlcm5hbChsaXN0ZW5l\ncik7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiByZW1v\ndmVTeXN0ZW1MaXN0ZW5lckludGVybmFsKE9iamVjdCBsaXN0ZW5lcikgewog\nICAgICAgICAgICBpZiAoIV9saXN0ZW5lcnMuY29udGFpbnMobGlzdGVuZXIp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAg\nLy8gY29weSB0byBhdm9pZCBpc3N1ZXMgd2l0aCBMaXN0ZW5lckxpc3QgYW5k\nIGF2b2lkIHVubmNlc3NhcnkKICAgICAgICAgICAgLy8gbG9ja2luZyBvbiB0\naGUgbGlzdCBkdXJpbmcgcnVudGltZQogICAgICAgICAgICBMaWZlY3ljbGVF\ndmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGxpc3RlbmVycyA9IG5ldyBMaWZl\nY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KF9saXN0ZW5lcnMpOwog\nICAgICAgICAgICBsaXN0ZW5lcnMucmVtb3ZlKGxpc3RlbmVyKTsKICAgICAg\nICAgICAgX2xpc3RlbmVycyA9IGxpc3RlbmVyczsKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN5\nc3RlbSBsaWZlY3ljbGUgbGlzdGVuZXJzCiAgICAgKi8KICAgIHB1YmxpYyBM\naWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGdldFN5c3RlbUxp\nc3RlbmVycygpIHsKICAgICAgICByZXR1cm4gX2xpc3RlbmVyczsKICAgIH0K\nCiAgICAvKioKICAgICAqIEZyZWUgdGhlIHJlc291cmNlcyB1c2VkIGJ5IHRo\naXMgcmVwb3NpdG9yeS4gQ2xvc2VzIGFsbCB1c2VyIHNlcXVlbmNlcy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgaWYgKF9s\nb2NraW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewog\nICAgICAgICAgICAgICAgY2xvc2VJbnRlcm5hbCgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2xvc2VJbnRlcm5hbCgp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY2xvc2VJbnRl\ncm5hbCgpIHsKICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YVtdIHNtZHMg\nPSBnZXRTZXF1ZW5jZU1ldGFEYXRhcygpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHNtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBzbWRzW2ldLmNsb3NlKCk7CiAgICAgICAgICAgIGNsZWFyKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBRdWVyeSBrZXkgc3RydWN0LgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBRdWVyeUtleSBpbXBsZW1lbnRzIFNl\ncmlhbGl6YWJsZSB7CgogICAgICAgIHB1YmxpYyBTdHJpbmcgY2xzTmFtZTsK\nICAgICAgICBwdWJsaWMgU3RyaW5nIG5hbWU7CgogICAgICAgIHB1YmxpYyBp\nbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIGludCBjbHNIYXNoID0gKGNs\nc05hbWUgPT0gbnVsbCkgPyAwIDogY2xzTmFtZS5oYXNoQ29kZSgpOwogICAg\nICAgICAgICBpbnQgbmFtZUhhc2ggPSAobmFtZSA9PSBudWxsKSA/IDAgOiBu\nYW1lLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBjbHNIYXNoICsg\nbmFtZUhhc2g7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG9iaikgewogICAgICAgICAgICBpZiAob2JqID09IHRo\naXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\naWYgKCEob2JqIGluc3RhbmNlb2YgUXVlcnlLZXkpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgUXVlcnlLZXkgcWsgPSAo\nUXVlcnlLZXkpIG9iajsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxz\nLmVxdWFscyhjbHNOYW1lLCBxay5jbHNOYW1lKSAmJiBTdHJpbmdVdGlscy5l\ncXVhbHMobmFtZSwgcWsubmFtZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIFhNTCBtZXRhZGF0YSBmb3IgYSBnaXZlbiBmaWVs\nZCBtZXRhZGF0YQogICAgICogCiAgICAgKiBAcGFyYW0gZm1kCiAgICAgKiBA\ncmV0dXJuIFhNTCBtZXRhZGF0YQogICAgICovCiAgICBwdWJsaWMgWE1MTWV0\nYURhdGEgZ2V0WE1MTWV0YURhdGEoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0WE1MTWV0YURh\ndGFJbnRlcm5hbChmbWQpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIGdldFhNTE1ldGFEYXRhSW50ZXJuYWwo\nZm1kKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgWE1MTWV0\nYURhdGEgZ2V0WE1MTWV0YURhdGFJbnRlcm5hbChGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIENsYXNzPD8+IGNscyA9IGZtZC5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgICAgICAvLyBjaGVjayBpZiBjYWNoZWQgYmVmb3JlCiAgICAg\nICAgWE1MTWV0YURhdGEgeG1sbWV0YSA9IF94bWxtZXRhcy5nZXQoY2xzKTsK\nICAgICAgICBpZiAoeG1sbWV0YSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4geG1sbWV0YTsKCiAgICAgICAgLy8gbG9hZCBKQVhCIFhNTCBtZXRhZGF0\nYQogICAgICAgIF9mYWN0b3J5LmxvYWRYTUxNZXRhRGF0YShmbWQpOwoKICAg\nICAgICB4bWxtZXRhID0gKFhNTENsYXNzTWV0YURhdGEpIF94bWxtZXRhcy5n\nZXQoY2xzKTsKCiAgICAgICAgcmV0dXJuIHhtbG1ldGE7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0\nIHdpdGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvIHRoZSByZXBv\nc2l0b3J5LCBhbmQKICAgICAqIHJldHVybiBpdC4KICAgICAqIAogICAgICog\nQHBhcmFtIGFjY2VzcwogICAgICogICAgICAgICAgICB0aGUgYWNjZXNzIHR5\ncGUgdG8gdXNlIGluIHBvcHVsYXRpbmcgbWV0YWRhdGEKICAgICAqLwogICAg\ncHVibGljIFhNTENsYXNzTWV0YURhdGEgYWRkWE1MTWV0YURhdGEoQ2xhc3M8\nPz4gdHlwZSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICBYTUxDbGFzc01ldGFE\nYXRhIG1ldGEgPSBuZXdYTUxDbGFzc01ldGFEYXRhKHR5cGUsIG5hbWUpOwog\nICAgICAgIGlmKF9sb2NraW5nKXsKICAgICAgICAgICAgc3luY2hyb25pemVk\nKHRoaXMpewogICAgICAgICAgICAgICAgX3htbG1ldGFzLnB1dCh0eXBlLCBt\nZXRhKTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9\nZWxzZXsKICAgICAgICAgICAgX3htbG1ldGFzLnB1dCh0eXBlLCBtZXRhKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBYTUxDbGFzc01ldGFEYXRhIGZv\nciB0aGUgZ2l2ZW4gY2xhc3MgUmV0dXJuIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIFhNTE1ldGFEYXRhIGdldENhY2hlZFhNTE1ldGFEYXRh\nKENsYXNzPD8+IGNscykgewogICAgICAgIHJldHVybiBfeG1sbWV0YXMuZ2V0\nKGNscyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgeG1s\nIGNsYXNzIG1ldGFkYXRhCiAgICAgKiAKICAgICAqIEBwYXJhbSB0eXBlCiAg\nICAgKiBAcGFyYW0gbmFtZQogICAgICogQHJldHVybiBhIFhNTENsYXNzTWV0\nYURhdGEKICAgICAqLwogICAgcHJvdGVjdGVkIFhNTENsYXNzTWV0YURhdGEg\nbmV3WE1MQ2xhc3NNZXRhRGF0YShDbGFzczw/PiB0eXBlLCBTdHJpbmcgbmFt\nZSkgewogICAgICAgIHJldHVybiBuZXcgWE1MQ2xhc3NNZXRhRGF0YSh0eXBl\nLCBuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB4\nbWwgZmllbGQgbWV0YSwgYWRkIGl0IHRvIHRoZSBmaWVsZE1hcCBpbiB0aGUg\nZ2l2ZW4geG1sIGNsYXNzIG1ldGFkYXRhCiAgICAgKiAKICAgICAqIEBwYXJh\nbSB0eXBlCiAgICAgKiBAcGFyYW0gbmFtZQogICAgICogQHBhcmFtIG1ldGEK\nICAgICAqIEByZXR1cm4gYSBYTUxGaWVsZE1ldGFEYXRhCiAgICAgKi8KICAg\nIHB1YmxpYyBYTUxGaWVsZE1ldGFEYXRhIG5ld1hNTEZpZWxkTWV0YURhdGEo\nQ2xhc3M8Pz4gdHlwZSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4g\nbmV3IFhNTEZpZWxkTWV0YURhdGEodHlwZSwgbmFtZSk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogQW5hbHl6ZXMgdGhlIGxpc3Qgb2YgQ2xhc3NNZXRh\nRGF0YSBpbiB0aGUgc3VwcGxpZWQgbGlzdCBmb3IgYW55IHdoaWNoIGhhcyBm\nb3JlaWduIGtleXMgdG8gb3RoZXIgQ2xhc3NNZXRhRGF0YSAKICAgICAqIGlu\nc3RhbmNlcyBpbiBpdHMgaWRlbnRpdHkgKGluIG90aGVyIHdvcmRzLCBQQ1R5\ncGVzIHdoaWNoIGhhdmUgcHJpbWFyeSBrZXlzIHRoYXQgYXJlIGZvcmVpZ24g\na2V5cyB0byBvdGhlcgogICAgICogdGFibGVzKSwgYW5kIHJldHVybnMgYSBs\naXN0IGFycmFuZ2VkIHNvIHRoYXQgYSBDbGFzc01ldGFEYXRhIHRoYXQgZGVw\nZW5kcyBvbiBhbm90aGVyIENsYXNzTWV0YURhdGEgYXBwZWFycwogICAgICog\nYWZ0ZXIgaXQgaW4gdGhlIGxpc3QuCiAgICAgKgogICAgICogQHBhcmFtIGNt\nZExpc3QgLSBMaXN0IG9mIENsYXNzTWV0YURhdGEgdG8gZXhhbWluZQogICAg\nICogQHJldHVybiAtIExpc3Qgb2YgQ2xhc3NNZXRhRGF0YSwgd2l0aCBDbGFz\nc01ldGFEYXRhIGRlcGVuZGVlcyBtb3ZlZCBhZnRlciB0aGUgbGFzdCBpZGVu\ndGlmaWVkIGRlcGVuZGVudCAKICAgICAqICAgICAgICAgICBDbGFzc01ldGFE\nYXRhLCBpZiBhbnkgbW92ZSBpcyBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHBy\naXZhdGUgTGlzdDxDbGFzc01ldGFEYXRhPiByZXNvbHZlRktJblBLRGVwZW5k\nZW5jaWVzT3JkZXJpbmcoTGlzdDxDbGFzc01ldGFEYXRhPiBjbWRMaXN0KSB7\nCiAgICAgICAgSGFzaE1hcDxDbGFzc01ldGFEYXRhLCBDTUREZXBlbmRlbmN5\nTm9kZT4gbm9kZU1hcCA9IG5ldyBIYXNoTWFwPENsYXNzTWV0YURhdGEsIENN\nRERlcGVuZGVuY3lOb2RlPigpOwogICAgICAgIEhhc2hTZXQ8Q01ERGVwZW5k\nZW5jeU5vZGU+IG5vZGVzV2l0aERlcGVuZGVuY2llc1NldCA9IG5ldyBIYXNo\nU2V0PENNRERlcGVuZGVuY3lOb2RlPigpOwogICAgICAgIEFycmF5TGlzdDxD\nTUREZXBlbmRlbmN5Tm9kZT4gbm9kZUxpc3QgPSBuZXcgQXJyYXlMaXN0PENN\nRERlcGVuZGVuY3lOb2RlPihjbWRMaXN0LnNpemUoKSk7CiAgICAgICAgCiAg\nICAgICAgLy8gSW5pdGlhbCBhbmFseXNpcyBvZiBDbGFzc01ldGFEYXRhIG9i\namVjdHMgLS0gUG9wdWxhdGUgdGhlIGxpbmtlZCBsaXN0IHdpdGggb2JqZWN0\ncyBpbiB0aGUgc2FtZSBvcmRlciBvZiAKICAgICAgICAvLyBhcHBlYXJhbmNl\nIGluIHRoZSBvcmlnaW5hbCBsaXN0LiBJZGVudGlmeSBDTURzIHdob3NlIGlk\nZW50aXRpZXMgaGF2ZSBhIEZLIHRvIGFub3RoZXIgQ01ELCBhbmQgY2F0YWxv\nZyB0aGF0IAogICAgICAgIC8vIGRlcGVuZGVuY3kuCiAgICAgICAgZm9yIChD\nbGFzc01ldGFEYXRhIGNtZCA6IGNtZExpc3QpIHsKICAgICAgICAgICAgLy8g\nQWRkIHRoaXMgbm9kZSB0byB0aGUgbGlzdAogICAgICAgICAgICBDTUREZXBl\nbmRlbmN5Tm9kZSBub2RlID0gbm9kZU1hcC5nZXQoY21kKTsKICAgICAgICAg\nICAgaWYgKG5vZGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbm9kZSA9\nIG5ldyBDTUREZXBlbmRlbmN5Tm9kZShjbWQpOwogICAgICAgICAgICAgICAg\nbm9kZU1hcC5wdXQoY21kLCBub2RlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBub2RlTGlzdC5hZGQobm9kZSk7CiAgICAgICAgICAgIAogICAgICAg\nICAgICAvLyBFeGFtaW5lIGl0cyBwcmltYXJ5IGtleSBmaWVsZHMsIGZsYWcg\nYW55IHJlZmVyZW5jZXMgdG8gYW5vdGhlciBQQ1R5cGUgdGhhdCBpcyBkZWZp\nbmVkIGluIGNtZExpc3QgYXMgYSAKICAgICAgICAgICAgLy8gZGVwZW5kZW5j\neQogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kQXJyID0gY21kLmdl\ndFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChGaWVsZE1l\ndGFEYXRhIGZtZCA6IGZtZEFycikgewogICAgICAgICAgICAgICAgVmFsdWVN\nZXRhRGF0YSB2bWQgPSBmbWQuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAg\nIGlmICh2bWQuaXNUeXBlUEMoKSkgewogICAgICAgICAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgdGFyZ2V0Q01EID0gdm1kLmdldERlY2xhcmVkVHlwZU1l\ndGFEYXRhKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgcHJvY2Vz\ncyBlbnRyaWVzIHdoaWNoIGFyZSBpbiB0aGUgY21kTGlzdCwgYXMgd2UgZG9u\nJ3Qgd2FudCB0byBiZSBhZGRpbmcgYW55dGhpbmcgbmV3LgogICAgICAgICAg\nICAgICAgICAgIGlmICghY21kTGlzdC5jb250YWlucyh0YXJnZXRDTUQpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIg\ndGhlIGRlcGVuZGVuY3kKICAgICAgICAgICAgICAgICAgICBDTUREZXBlbmRl\nbmN5Tm9kZSB0YXJnZXROb2RlID0gbnVsbDsKICAgICAgICAgICAgICAgICAg\nICBpZiAoKHRhcmdldE5vZGUgPSBub2RlTWFwLmdldCh0YXJnZXRDTUQpKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE5vZGUg\nPSBuZXcgQ01ERGVwZW5kZW5jeU5vZGUodGFyZ2V0Q01EKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbm9kZU1hcC5wdXQodGFyZ2V0Q01ELCB0YXJnZXRO\nb2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgbm9kZS5yZWdpc3RlckRlcGVuZGVudE5vZGUodGFyZ2V0Tm9kZSk7CiAg\nICAgICAgICAgICAgICAgICAgbm9kZXNXaXRoRGVwZW5kZW5jaWVzU2V0LmFk\nZChub2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICAKICAgICAgICAvLyBBbmFseXNpcyBpcyBjb21wbGV0\nZS4gRm9yIGVhY2ggQ01EIHRoYXQgaGFzIGFuIGlkZW50aXR5IGZvcmVpZ24g\na2V5IGRlcGVuZGVuY3kgb24gYW5vdGhlciBDTUQsIGVuc3VyZSB0aGF0IGl0\nCiAgICAgICAgLy8gYXBwZWFycyBsYXRlciBpbiB0aGUgbGlzdCB0aGVuIHRo\nZSBDTUQgaXQgaXMgZGVwZW5kZW50IG9uLiBJZiBpdCBhcHBlYXJzIGVhcmxp\nZXIsIG1vdmUgaXQgaW1tZWRpYXRlbHkgYWZ0ZXIgCiAgICAgICAgLy8gdGhl\nIENNRC4gSWYgdGhlcmUgYXJlIG11bHRpcGxlIENNRHMgdGhlIGlkZW50aXR5\nIGlzIGRlcGVuZGVudCBvbiwgbW92ZSBpdCBhZnRlciB0aGUgbGFzdCBkZXBl\nbmRlbmN5IGluCiAgICAgICAgLy8gdGhlIGxpbmtlZCBsaXN0LgogICAgICAg\nIGZvciAoQ01ERGVwZW5kZW5jeU5vZGUgbm9kZSA6IG5vZGVzV2l0aERlcGVu\nZGVuY2llc1NldCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBp\ncyBhIGN5Y2xlIChkZXBlbmRlbmNpZXMgb3Igc3ViZGVwZW5kZW5jaWVzIHRo\nYXQgY3JlYXRlIGEgY3ljbGUgaW4gdGhlIGdyYXBoLiBJZiBvbmUgaXMgCiAg\nICAgICAgICAgIC8vIGRldGVjdGVkLCB0aGVuIHRoaXMgYWxnb3JpdGhtIGNh\nbm5vdCBiZSB1c2VkIHRvIHJlb3JkZXIgdGhlIENNRCBsaXN0LiAgRW1pdCBh\nIHdhcm5pbmcsIGFuZCByZXR1cm4gdGhlIAogICAgICAgICAgICAvLyBvcmln\naW5hbCBsaXN0LgogICAgICAgICAgICBpZiAobm9kZS5jaGVja0ZvckN5Y2xl\nKCkpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgi\nY21kLWRpc2NvdmVyLWN5Y2xlIiwgbm9kZS5nZXRDbWQoKS5nZXRSZXNvdXJj\nZU5hbWUoKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\ncmV0dXJuIGNtZExpc3Q7CiAgICAgICAgICAgIH0KIAogICAgICAgICAgICBp\nbnQgbm9kZUluZGV4ID0gbm9kZUxpc3QuaW5kZXhPZihub2RlKTsKICAgICAg\nICAgICAgU2V0PENNRERlcGVuZGVuY3lOb2RlPiBkZXBlbmRlbmNpZXMgPSBu\nb2RlLmdldERlcGVuZHNPblNldCgpOyAgICAgICAKICAgICAgICAgICAgCiAg\nICAgICAgICAgIC8vIElmIHRoZSBjdXJyZW50IG5vZGUgaGFzIGEgZGVwZW5k\nZW5jeSB0aGF0IGFwcGVhcnMgbGF0ZXIgaW4gdGhlIGxpc3QsIHRoZW4gdGhp\ncyBub2RlIG5lZWRzCiAgICAgICAgICAgIC8vIHRvIGJlIG1vdmVkIHRvIHRo\nZSBwb2ludCBpbW1lZGlhdGVseSBhZnRlciB0aGF0IGRlcGVuZGVuY3kuCiAg\nICAgICAgICAgIENNRERlcGVuZGVuY3lOb2RlIG1vdmVBZnRlciA9IG51bGw7\nCiAgICAgICAgICAgIGludCBtb3ZlQWZ0ZXJJbmRleCA9IC0xOwogICAgICAg\nICAgICBmb3IgKENNRERlcGVuZGVuY3lOb2RlIGRlcE5vZGUgOiBkZXBlbmRl\nbmNpZXMpIHsgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGludCBk\nZXBlbmRlbmN5SW5kZXggPSBub2RlTGlzdC5pbmRleE9mKGRlcE5vZGUpOwog\nICAgICAgICAgICAgICAgaWYgKChub2RlSW5kZXggPCBkZXBlbmRlbmN5SW5k\nZXgpICYmIChtb3ZlQWZ0ZXJJbmRleCA8IGRlcGVuZGVuY3lJbmRleCkpIHsK\nICAgICAgICAgICAgICAgICAgICBtb3ZlQWZ0ZXIgPSBkZXBOb2RlOwogICAg\nICAgICAgICAgICAgICAgIG1vdmVBZnRlckluZGV4ID0gZGVwZW5kZW5jeUlu\nZGV4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChtb3ZlQWZ0ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nbm9kZUxpc3QucmVtb3ZlKG5vZGVJbmRleCk7CiAgICAgICAgICAgICAgICBu\nb2RlTGlzdC5hZGQobm9kZUxpc3QuaW5kZXhPZihtb3ZlQWZ0ZXIpICsgMSwg\nbm9kZSk7CiAgICAgICAgICAgIH0gICAgICAKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgLy8gU29ydGluZyBpcyBjb21wbGV0ZSwgYnVpbGQgdGhlIHJl\ndHVybiBsaXN0LiAgQ2xlYXIgdGhlIGRlcGVuZHNPblNldCBmb3IgdGhlIEdD\nLgogICAgICAgIEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPiByZXR1cm5MaXN0\nID0gbmV3IEFycmF5TGlzdDxDbGFzc01ldGFEYXRhPigpOwogICAgICAgIGZv\nciAoQ01ERGVwZW5kZW5jeU5vZGUgY3VycmVudCA6IG5vZGVMaXN0KSB7CiAg\nICAgICAgICAgIHJldHVybkxpc3QuYWRkKGN1cnJlbnQuZ2V0Q21kKCkpOwog\nICAgICAgICAgICBjdXJyZW50LmdldERlcGVuZHNPblNldCgpLmNsZWFyKCk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByZXR1cm5MaXN0\nOwogICAgfQoKCiAgICAvKioKICAgICAqIExpbmtlZCBsaXN0IG5vZGUgY2xh\nc3MgZm9yIG1hbmFnaW5nIGFueSBmb3JlaWduIGtleXMgaW4gdGhlIGlkZW50\naXR5IG9mIGEgQ2xhc3NNZXRhRGF0YSBpbnN0YW5jZS4KICAgICAqIAogICAg\nICovCiAgICBwcml2YXRlIGNsYXNzIENNRERlcGVuZGVuY3lOb2RlIHsKICAg\nICAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgY21kOwoKICAgICAgICAvLyBN\nYXJrZXIgZm9yIHF1aWNrIGRldGVybWluYXRpb24gaWYgdGhpcyBub2RlIGhh\ncyBkZXBlbmRlbmNpZXMKICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzRGVw\nZW5kZW5jaWVzID0gZmFsc2U7CgogICAgICAgIC8vIExpc3Qgb2YgQ2xhc3NN\nZXRhRGF0YSBvYmplY3RzIHRoaXMgQ2xhc3NNZXRhRGF0YSBkZXBlbmRzIG9u\nCiAgICAgICAgcHJpdmF0ZSBIYXNoU2V0PENNRERlcGVuZGVuY3lOb2RlPiBk\nZXBlbmRzT25TZXQgPSBuZXcgSGFzaFNldDxDTUREZXBlbmRlbmN5Tm9kZT4o\nKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5uZXIgY2xhc3MgY29uc3Ry\ndWN0b3IKICAgICAgICAgKi8KICAgICAgICBDTUREZXBlbmRlbmN5Tm9kZShD\nbGFzc01ldGFEYXRhIGNtZCkgewogICAgICAgICAgICB0aGlzLmNtZCA9IGNt\nZDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMg\ndGhlIENsYXNzTWV0YURhdGEgaW5zdGFuY2UgcmVmZXJlbmNlZCBieSB0aGlz\nIG5vZGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENsYXNzTWV0YURh\ndGEgZ2V0Q21kKCkgewogICAgICAgICAgICByZXR1cm4gY21kOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogCiAgICAgICAgICogQHJldHVy\nbiB0cnVlIGlmIHRoaXMgbm9kZSdzIENsYXNzTWV0YURhdGEgaGFzIGEgRksg\naW4gaXRzIGlkZW50aXR5IHRoYXQgcmVmZXJzIHRvIGFub3RoZXIgQ2xhc3NN\nZXRhRGF0YTsgCiAgICAgICAgICogICAgICAgICBmYWxzZSBpZiBpdCBkb2Vz\nIG5vdC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgYm9vbGVhbiBnZXRI\nYXNEZXBlbmRlbmNpZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNEZXBl\nbmRlbmNpZXM7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBS\nZWdpc3RlcnMgYSBDbGFzc01ldGFEYXRhIG1vZGVsbGVkIGJ5IGEgQ01ERGVw\nZW5kZW5jeU5vZGUgYXMgYSBkZXBlbmRlbmN5IG9mIHRoaXMgQ2xhc3NNZXRh\nRGF0YS4KICAgICAgICAgKiAKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCByZWdpc3RlckRlcGVuZGVudE5vZGUoQ01ERGVwZW5kZW5jeU5vZGUg\nbm9kZSkgewogICAgICAgICAgICBnZXREZXBlbmRzT25TZXQoKS5hZGQobm9k\nZSk7CiAgICAgICAgICAgIGhhc0RlcGVuZGVuY2llcyA9IHRydWU7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGEgU2V0IGNv\nbnRhaW5pbmcgYWxsIG9mIHRoZSBDTUREZXBlbmRlbmN5Tm9kZSBpbnN0YW5j\nZXMgdGhhdCB0aGlzIG5vZGUgaGFzIGEgRksgaW4gaWRlbnRpdHkgCiAgICAg\nICAgICogZGVwZW5kZW5jeSBvbi4KICAgICAgICAgKiAKICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgU2V0PENNRERlcGVuZGVuY3lOb2RlPiBnZXREZXBl\nbmRzT25TZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBkZXBlbmRzT25TZXQ7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVja3MgYWxs\nIGRlcGVuZGVuY2llcywgYW5kIHN1Yi1kZXBlbmRlbmNpZXMsIGZvciBhbnkg\nY3ljbGVzIGluIHRoZSBkZXBlbmRlbmN5IGdyYXBoLgogICAgICAgICAqIAog\nICAgICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhIGN5Y2xlIHdhcyBkaXNjb3Zl\ncmVkLCBmYWxzZSBpZiBub3QuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gY2hlY2tGb3JDeWNsZSgpIHsKICAgICAgICAgICAgamF2YS51\ndGlsLlN0YWNrPENNRERlcGVuZGVuY3lOb2RlPiB2aXNpdFN0YWNrID0gbmV3\nIGphdmEudXRpbC5TdGFjazxDTUREZXBlbmRlbmN5Tm9kZT4oKTsKICAgICAg\nICAgICAgcmV0dXJuIGludGVybmFsQ2hlY2tGb3JDeWNsZSh2aXNpdFN0YWNr\nKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEludGVybmFs\nIGltcGxlbWVudGF0aW9uIG9mIHRoZSBjeWNsZSBkZXRlY3Rpb24uCiAgICAg\nICAgICogCiAgICAgICAgICogQHBhcmFtIHZpc2l0U3RhY2sKICAgICAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgYSBjeWNsZSBpcyBkZXRlY3RlZCwgZmFsc2Ug\naWYgbm8gY3ljbGUgd2FzIGRldGVjdGVkLgogICAgICAgICAqLwogICAgICAg\nIHByaXZhdGUgYm9vbGVhbiBpbnRlcm5hbENoZWNrRm9yQ3ljbGUoamF2YS51\ndGlsLlN0YWNrPENNRERlcGVuZGVuY3lOb2RlPiB2aXNpdFN0YWNrKSB7CiAg\nICAgICAgICAgIGlmICh2aXNpdFN0YWNrLmNvbnRhaW5zKHRoaXMpKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICB2aXNpdFN0YWNrLnB1c2godGhpcyk7CgogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgZm9yIChDTUREZXBlbmRlbmN5Tm9kZSBu\nb2RlIDogZGVwZW5kc09uU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG5vZGUuZ2V0SGFzRGVwZW5kZW5jaWVzKCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKG5vZGUuaW50ZXJuYWxDaGVja0ZvckN5Y2xlKHZpc2l0\nU3RhY2spID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdmlzaXRTdGFjay5wb3Ao\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGlj\nIGJvb2xlYW4gbmVlZHNQcmVsb2FkKE9wdGlvbnMgbykgewogICAgICAgIGlm\nIChvLmdldEJvb2xlYW5Qcm9wZXJ0eShQUkVMT0FEX1NUUikgPT0gdHJ1ZSkg\newogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKfQo=\n","encoding":"base64"}

