{"sha":"78f179a37f475cf5c5e425b35bb99be7cb4cd080","node_id":"MDQ6QmxvYjIwNjM2NDo3OGYxNzlhMzdmNDc1Y2Y1YzVlNDI1YjM1YmI5OWJlN2NiNGNkMDgw","size":82174,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/78f179a37f475cf5c5e425b35bb99be7cb4cd080","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmM7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBq\nYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc3FsLkFycmF5Owpp\nbXBvcnQgamF2YS5zcWwuQmF0Y2hVcGRhdGVFeGNlcHRpb247CmltcG9ydCBq\nYXZhLnNxbC5CbG9iOwppbXBvcnQgamF2YS5zcWwuQ2FsbGFibGVTdGF0ZW1l\nbnQ7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5EYXRlOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRT\ndGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZWY7CmltcG9ydCBqYXZhLnNx\nbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXRNZXRhRGF0\nYTsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEu\nc3FsLlNRTFdhcm5pbmc7CmltcG9ydCBqYXZhLnNxbC5TYXZlcG9pbnQ7Cmlt\ncG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5UaW1l\nOwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBq\nYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7\nCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmpkYmMuTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuTG9n\nZ2luZ0Nvbm5lY3Rpb24uCiAgICAgICAgTG9nZ2luZ0NhbGxhYmxlU3RhdGVt\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dp\nbmdDb25uZWN0aW9uRGVjb3JhdG9yLkxvZ2dpbmdDb25uZWN0aW9uLgogICAg\nICAgIExvZ2dpbmdEYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9y\nLkxvZ2dpbmdDb25uZWN0aW9uLgogICAgICAgIExvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5M\nb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvci5Mb2dnaW5nQ29ubmVjdGlvbi4K\nICAgICAgICBMb2dnaW5nUmVzdWx0U2V0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLkxv\nZ2dpbmdDb25uZWN0aW9uLgogICAgICAgIExvZ2dpbmdTdGF0ZW1lbnQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVy\nYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRv\nUHJpdkhlbHBlcjsKCi8qKgogKiBBIHtAbGluayBDb25uZWN0aW9uRGVjb3Jh\ndG9yfSB0aGF0IGNyZWF0ZXMgbG9nZ2luZyBjb25uZWN0aW9ucyBhbmQKICog\ne0BsaW5rIFJlcG9ydGluZ1NRTEV4Y2VwdGlvbn1zLgogKgogKiBAYXV0aG9y\nIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMg\nY2xhc3MgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVtZW50cyBD\nb25uZWN0aW9uRGVjb3JhdG9yIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgU0VQID0gSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRv\ncigpOwogICAgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPExvZ2dpbmdDb25u\nZWN0aW9uPiBsb2dnaW5nQ29ubmVjdGlvbkltcGw7CiAgICBzdGF0aWMgZmlu\nYWwgQ29uc3RydWN0b3I8TG9nZ2luZ1Jlc3VsdFNldD4gbG9nZ2luZ1Jlc3Vs\ndFNldEltcGw7CiAgICBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8TG9nZ2lu\nZ1N0YXRlbWVudD4gbG9nZ2luZ1N0YXRlbWVudEltcGw7CiAgICBzdGF0aWMg\nZmluYWwgQ29uc3RydWN0b3I8TG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50PiBs\nb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnRJbXBsOwogICAgc3RhdGljIGZpbmFs\nIENvbnN0cnVjdG9yPExvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudD4gbG9nZ2lu\nZ0NhbGxhYmxlU3RhdGVtZW50SW1wbDsKICAgIHN0YXRpYyBmaW5hbCBDb25z\ndHJ1Y3RvcjxMb2dnaW5nRGF0YWJhc2VNZXRhRGF0YT4gbG9nZ2luZ0RhdGFi\nYXNlTWV0YURhdGFJbXBsOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBXQVJOX0lHTk9SRSA9IDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgV0FSTl9MT0dfVFJBQ0UgPSAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IFdBUk5fTE9HX0lORk8gPSAyOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IFdBUk5fTE9HX1dBUk4gPSAzOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFdBUk5fTE9HX0VSUk9SID0gNDsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBXQVJOX1RIUk9XID0gNTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBXQVJOX0hBTkRMRSA9IDY7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBXQVJOSU5HX0FDVElPTlMgPSBuZXcg\nU3RyaW5nWzddOwogICAgCiAgICBzdGF0aWMgewogICAgICAgIFdBUk5JTkdf\nQUNUSU9OU1tXQVJOX0lHTk9SRV0gPSAiaWdub3JlIjsKICAgICAgICBXQVJO\nSU5HX0FDVElPTlNbV0FSTl9MT0dfVFJBQ0VdID0gInRyYWNlIjsKICAgICAg\nICBXQVJOSU5HX0FDVElPTlNbV0FSTl9MT0dfSU5GT10gPSAiaW5mbyI7CiAg\nICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5fTE9HX1dBUk5dID0gIndhcm4i\nOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX0xPR19FUlJPUl0gPSAi\nZXJyb3IiOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX1RIUk9XXSA9\nICJ0aHJvdyI7CiAgICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5fSEFORExF\nXSA9ICJoYW5kbGUiOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2dn\naW5nQ29ubmVjdGlvbkltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdl\ndENvbmNyZXRlQ29uc3RydWN0b3IoTG9nZ2luZ0Nvbm5lY3Rpb24uY2xhc3Ms\nCiAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvci5j\nbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGxvZ2dpbmdS\nZXN1bHRTZXRJbXBsID0gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5nZXRDb25j\ncmV0ZUNvbnN0cnVjdG9yKAogICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5l\nY3Rpb24uTG9nZ2luZ1Jlc3VsdFNldC5jbGFzcywgCiAgICAgICAgICAgICAg\nICBMb2dnaW5nQ29ubmVjdGlvbi5jbGFzcywgUmVzdWx0U2V0LmNsYXNzLCBT\ndGF0ZW1lbnQuY2xhc3MpOwogICAgICAgICAgICBsb2dnaW5nU3RhdGVtZW50\nSW1wbCA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0Q29uY3JldGVDb25z\ndHJ1Y3RvcigKICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLkxv\nZ2dpbmdTdGF0ZW1lbnQuY2xhc3MsCiAgICAgICAgICAgICAgICBMb2dnaW5n\nQ29ubmVjdGlvbi5jbGFzcywgU3RhdGVtZW50LmNsYXNzKTsKICAgICAgICAg\nICAgbG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50SW1wbCA9IENvbmNyZXRlQ2xh\nc3NHZW5lcmF0b3IuZ2V0Q29uY3JldGVDb25zdHJ1Y3RvcigKICAgICAgICAg\nICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLkxvZ2dpbmdQcmVwYXJlZFN0YXRl\nbWVudC5jbGFzcywgCiAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlv\nbi5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIFN0cmluZy5jbGFz\ncyk7CiAgICAgICAgICAgIGxvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudEltcGwg\nPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0\nb3IoCiAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi5Mb2dnaW5n\nQ2FsbGFibGVTdGF0ZW1lbnQuY2xhc3MsCiAgICAgICAgICAgICAgICBMb2dn\naW5nQ29ubmVjdGlvbi5jbGFzcywgQ2FsbGFibGVTdGF0ZW1lbnQuY2xhc3Ms\nIFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAgIGxvZ2dpbmdEYXRhYmFzZU1l\ndGFEYXRhSW1wbCA9IENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IuZ2V0Q29uY3Jl\ndGVDb25zdHJ1Y3RvcigKICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0\naW9uLkxvZ2dpbmdEYXRhYmFzZU1ldGFEYXRhLmNsYXNzLAogICAgICAgICAg\nICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24uY2xhc3MsIERhdGFiYXNlTWV0YURh\ndGEuY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVyRXJy\nb3IoZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgZmluYWwgRGF0\nYVNvdXJjZUxvZ3MgX2xvZ3MgPSBuZXcgRGF0YVNvdXJjZUxvZ3MoKTsKICAg\nIHByaXZhdGUgU1FMRm9ybWF0dGVyIF9mb3JtYXR0ZXI7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX3ByZXR0eVByaW50OwogICAgcHJpdmF0ZSBpbnQgX3ByZXR0\neVByaW50TGluZUxlbmd0aCA9IDYwOwogICAgcHJpdmF0ZSBpbnQgX3dhcm5p\nbmdBY3Rpb24gPSBXQVJOX0lHTk9SRTsKICAgIHByaXZhdGUgU1FMV2Fybmlu\nZ0hhbmRsZXIgX3dhcm5pbmdIYW5kbGVyOwogICAgcHJpdmF0ZSBib29sZWFu\nIF90cmFja1BhcmFtZXRlcnMgPSB0cnVlOwoKICAgIC8qKgogICAgICogSWYg\nc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+LCBwcmV0dHktcHJpbnQgU1FMIGJ5\nIHJ1bm5pbmcgaXQKICAgICAqIHRocm91Z2gge0BsaW5rIFNRTEZvcm1hdHRl\nciNwcmV0dHlQcmludH0uIElmCiAgICAgKiA8Y29kZT5mYWxzZTwvY29kZT4s\nIGRvbid0IHByZXR0eS1wcmludCwgYW5kIG91dHB1dCBTUUwgbG9ncyBpbgog\nICAgICogYSBzaW5nbGUgbGluZS4gUHJldHR5LXByaW50ZWQgU1FMIGNhbiBi\nZSBlYXNpZXIgZm9yIGEgaHVtYW4gdG8KICAgICAqIHJlYWQsIGJ1dCBpcyBo\nYXJkZXIgdG8gcGFyc2Ugd2l0aCB0b29scyBsaWtlIGdyZXAuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFByZXR0eVByaW50KGJvb2xlYW4gcHJldHR5\nUHJpbnQpIHsKICAgICAgICBfcHJldHR5UHJpbnQgPSBwcmV0dHlQcmludDsK\nICAgICAgICBpZiAoX2Zvcm1hdHRlciA9PSBudWxsICYmIF9wcmV0dHlQcmlu\ndCkgewogICAgICAgICAgICBfZm9ybWF0dGVyID0gbmV3IFNRTEZvcm1hdHRl\ncigpOwogICAgICAgICAgICBfZm9ybWF0dGVyLnNldExpbmVMZW5ndGgoX3By\nZXR0eVByaW50TGluZUxlbmd0aCk7CiAgICAgICAgfSBlbHNlIGlmICghX3By\nZXR0eVByaW50KQogICAgICAgICAgICBfZm9ybWF0dGVyID0gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEBzZWUgI3NldFByZXR0eVByaW50CiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFByZXR0eVByaW50KCkgewogICAg\nICAgIHJldHVybiBfcHJldHR5UHJpbnQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgdG8gcHJpbnQgcGVyIGxpbmUg\nd2hlbgogICAgICogcHJldHR5LXByaW50aW5nIG9mIFNRTCBpcyBlbmFibGVk\nLiBEZWZhdWx0cyB0byA2MCB0byBwcm92aWRlCiAgICAgKiBzb21lIHNwYWNl\nIGZvciBhbnkgYW50LXJlbGF0ZWQgY2hhcmFjdGVycyBvbiB0aGUgbGVmdCBv\nZiBhCiAgICAgKiBzdGFuZGFyZCA4MC1jaGFyYWN0ZXIgZGlzcGxheS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJldHR5UHJpbnRMaW5lTGVuZ3Ro\nKGludCBsZW5ndGgpIHsKICAgICAgICBfcHJldHR5UHJpbnRMaW5lTGVuZ3Ro\nID0gbGVuZ3RoOwogICAgICAgIGlmIChfZm9ybWF0dGVyICE9IG51bGwpCiAg\nICAgICAgICAgIF9mb3JtYXR0ZXIuc2V0TGluZUxlbmd0aChsZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjc2V0UHJldHR5UHJpbnRMaW5l\nTGVuZ3RoCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UHJldHR5UHJpbnRM\naW5lTGVuZ3RoKCkgewogICAgICAgIHJldHVybiBfcHJldHR5UHJpbnRMaW5l\nTGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB0cmFj\nayBwYXJhbWV0ZXJzIGZvciB0aGUgcHVycG9zZXMgb2YgcmVwb3J0aW5nIGV4\nY2VwdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRyYWNrUGFy\nYW1ldGVycyhib29sZWFuIHRyYWNrUGFyYW1ldGVycykgewogICAgICAgIF90\ncmFja1BhcmFtZXRlcnMgPSB0cmFja1BhcmFtZXRlcnM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIHRyYWNrIHBhcmFtZXRlcnMgZm9yIHRo\nZSBwdXJwb3NlcyBvZiByZXBvcnRpbmcgZXhjZXB0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gZ2V0VHJhY2tQYXJhbWV0ZXJzKCkgewogICAg\nICAgIHJldHVybiBfdHJhY2tQYXJhbWV0ZXJzOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hhdCB0byBkbyB3aXRoIFNRTCB3YXJuaW5ncy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0V2FybmluZ0FjdGlvbihTdHJpbmcgd2Fybmlu\nZ0FjdGlvbikgewogICAgICAgIGludCBpbmRleCA9IEFycmF5cy5hc0xpc3Qo\nV0FSTklOR19BQ1RJT05TKS5pbmRleE9mKHdhcm5pbmdBY3Rpb24pOwogICAg\nICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgIGluZGV4ID0gV0FSTl9J\nR05PUkU7CiAgICAgICAgX3dhcm5pbmdBY3Rpb24gPSBpbmRleDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoYXQgdG8gZG8gd2l0aCBTUUwgd2FybmluZ3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0V2FybmluZ0FjdGlvbigp\nIHsKICAgICAgICByZXR1cm4gV0FSTklOR19BQ1RJT05TW193YXJuaW5nQWN0\naW9uXTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoYXQgdG8gZG8gd2l0aCBT\nUUwgd2FybmluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFdhcm5p\nbmdIYW5kbGVyKFNRTFdhcm5pbmdIYW5kbGVyIHdhcm5pbmdIYW5kbGVyKSB7\nCiAgICAgICAgX3dhcm5pbmdIYW5kbGVyID0gd2FybmluZ0hhbmRsZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGF0IHRvIGRvIHdpdGggU1FMIHdhcm5p\nbmdzLgogICAgICovCiAgICBwdWJsaWMgU1FMV2FybmluZ0hhbmRsZXIgZ2V0\nV2FybmluZ0hhbmRsZXIoKSB7CiAgICAgICAgcmV0dXJuIF93YXJuaW5nSGFu\nZGxlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBsb2cgdG8gd3JpdGUg\ndG8uCiAgICAgKi8KICAgIHB1YmxpYyBEYXRhU291cmNlTG9ncyBnZXRMb2dz\nKCkgewogICAgICAgIHJldHVybiBfbG9nczsKICAgIH0KCiAgICBwdWJsaWMg\nQ29ubmVjdGlvbiBkZWNvcmF0ZShDb25uZWN0aW9uIGNvbm4pIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBuZXdMb2dnaW5nQ29ubmVj\ndGlvbihjb25uKTsKICAgIH0KICAgICAgICAgCiAgICBwcml2YXRlIExvZ2dp\nbmdDb25uZWN0aW9uIG5ld0xvZ2dpbmdDb25uZWN0aW9uKENvbm5lY3Rpb24g\nY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5jZShsb2dn\naW5nQ29ubmVjdGlvbkltcGwsIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9y\nLnRoaXMsIGNvbm4pOwogICAgfQoKICAgIHByaXZhdGUgU1FMRXhjZXB0aW9u\nIHdyYXAoU1FMRXhjZXB0aW9uIHNxbGUsIFN0YXRlbWVudCBzdG1udCkgewog\nICAgICAgIHJldHVybiB3cmFwKHNxbGUsIHN0bW50LCBudWxsLCAtMSk7CiAg\nICB9CgogICAgcHJpdmF0ZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRp\nb24gc3FsZSwgU3RyaW5nIHNxbCkgewogICAgICAgIHJldHVybiB3cmFwKHNx\nbGUsIG51bGwsIHNxbCwgLTEpOwogICAgfQogICAgCiAgICBwcml2YXRlIFNR\nTEV4Y2VwdGlvbiB3cmFwKFNRTEV4Y2VwdGlvbiBzcWxlLCBTdGF0ZW1lbnQg\nc3RtbnQsIFN0cmluZyBzcWwpIHsKICAgICAgICByZXR1cm4gd3JhcChzcWxl\nLCBzdG1udCwgc3FsLCAtMSk7CiAgICB9CgogICAgcHJpdmF0ZSBTUUxFeGNl\ncHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3FsZSwgU3RhdGVtZW50IHN0bW50\nLCBpbnQgaW5kZXhPZkZhaWxlZEJhdGNoT2JqZWN0KSB7CiAgICAgICAgcmV0\ndXJuIHdyYXAoc3FsZSwgc3RtbnQsIG51bGwsIGluZGV4T2ZGYWlsZWRCYXRj\naE9iamVjdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbmNsdWRlIFNRTCBp\nbiBleGNlcHRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgU1FMRXhjZXB0aW9u\nIHdyYXAoU1FMRXhjZXB0aW9uIHNxbGUsIFN0YXRlbWVudCBzdG1udCwgU3Ry\naW5nIHNxbCwgaW50IGluZGV4T2ZGYWlsZWRCYXRjaE9iamVjdCkgewogICAg\nICAgIFJlcG9ydGluZ1NRTEV4Y2VwdGlvbiB0b1JldHVybiA9IG51bGw7Cgog\nICAgICAgIGlmIChzcWxlIGluc3RhbmNlb2YgUmVwb3J0aW5nU1FMRXhjZXB0\naW9uKSB7CiAgICAgICAgICAgIHRvUmV0dXJuID0gKFJlcG9ydGluZ1NRTEV4\nY2VwdGlvbikgc3FsZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0\nb1JldHVybiA9IG5ldyBSZXBvcnRpbmdTUUxFeGNlcHRpb24oc3FsZSwgc3Rt\nbnQsIHNxbCk7CiAgICAgICAgfQoKICAgICAgICB0b1JldHVybi5zZXRJbmRl\neE9mRmlyc3RGYWlsZWRPYmplY3QoaW5kZXhPZkZhaWxlZEJhdGNoT2JqZWN0\nKTsKICAgICAgICByZXR1cm4gdG9SZXR1cm47CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbnRlcmZhY2UgdGhhdCBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB3\naGF0IHRvIGRvIHdoZW4KICAgICAqIHtAbGluayBTUUxXYXJuaW5nfXMgb2Nj\ndXIuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIFNRTFdh\ncm5pbmdIYW5kbGVyIHsKCiAgICAgICAgcHVibGljIHZvaWQgaGFuZGxlV2Fy\nbmluZyhTUUxXYXJuaW5nIHdhcm5pbmcpIHRocm93cyBTUUxFeGNlcHRpb247\nCiAgICB9CgogICAgLyoqCiAgICAgKiBMb2dnaW5nIGNvbm5lY3Rpb24uCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBjbGFzcyBMb2dnaW5nQ29u\nbmVjdGlvbiBleHRlbmRzIERlbGVnYXRpbmdDb25uZWN0aW9uIHsKCiAgICAg\nICAgcHVibGljIExvZ2dpbmdDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4p\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVt\nZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwgYm9vbGVhbiB3cmFw\nKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHN1\ncGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3TG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50\nLCBzcWwpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHsKICAgICAgICAgICAgICAgIGVyciA9IHdyYXAoc2UsIHNxbCk7CiAgICAg\nICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0gIGZpbmFsbHkg\newogICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKGVycik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBQcmVwYXJl\nZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsIGludCBy\nc1R5cGUsCiAgICAgICAgICAgIGludCByc0NvbmN1ciwgYm9vbGVhbiB3cmFw\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgU1FMRXhjZXB0\naW9uIGVyciA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHN1cGVyLnByZXBhcmVT\ndGF0ZW1lbnQKICAgICAgICAgICAgICAgICAgICAoc3FsLCByc1R5cGUsIHJz\nQ29uY3VyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3TG9n\nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwogICAgICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nIGVyciA9ICB3cmFwKHNlLCBzcWwpOwogICAgICAgICAgICAgICAgdGhyb3cg\nZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\naGFuZGxlU1FMRXJyb3JzKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50\nKGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgU3RhdGVtZW50IHN0bW50ID0gc3VwZXIuY3Jl\nYXRlU3RhdGVtZW50KGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXdMb2dnaW5nU3RhdGVtZW50KHN0bW50KTsKICAgICAgICAgICAgfWNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGVyciA9IHNl\nOwogICAgICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0\nYXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoaW50IHR5cGUsIGludCBjb25jdXJy\nZW5jeSwKICAgICAgICAgICAgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBTdGF0ZW1lbnQg\nc3RtbnQgPSBzdXBlci5jcmVhdGVTdGF0ZW1lbnQodHlwZSwgY29uY3VycmVu\nY3ksIAogICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXdMb2dnaW5nU3RhdGVtZW50KHN0bW50KTsKICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nICAgICBlcnIgPSBzZTsKICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaGFuZGxlU1FM\nRXJyb3JzKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcHJvdGVjdGVkIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVD\nYWxsKFN0cmluZyBzcWwsIGJvb2xlYW4gd3JhcCkgCiAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBTUUxFeGNlcHRpb24g\nZXJyID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIENhbGxhYmxlU3RhdGVtZW50IHN0bXQgPSBzdXBlci5wcmVwYXJlQ2FsbChz\ncWwsIHdyYXApOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdD\nYWxsYWJsZVN0YXRlbWVudChzdG10LCBzcWwpOwogICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGVyciA9\nIHdyYXAoc2UsIHNxbCk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBoYW5kbGVT\nUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQgbmV3TG9nZ2lu\nZ1ByZXBhcmVkU3RhdGVtZW50CiAgICAgICAgICAgIChQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgU3RyaW5nIHNxbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5l\nd0luc3RhbmNlKGxvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudEltcGwsIExvZ2dp\nbmdDb25uZWN0aW9uLnRoaXMsIHN0bW50LCBzcWwpOwogICAgICAgIH0KICAg\nICAgICAKICAgICAgICBwcml2YXRlIENhbGxhYmxlU3RhdGVtZW50IG5ld0xv\nZ2dpbmdDYWxsYWJsZVN0YXRlbWVudChDYWxsYWJsZVN0YXRlbWVudCBzdG1u\ndCwgU3RyaW5nIHNxbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNl\nKGxvZ2dpbmdDYWxsYWJsZVN0YXRlbWVudEltcGwsIExvZ2dpbmdDb25uZWN0\naW9uLnRoaXMsIHN0bW50LCBzcWwpOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBwcml2YXRlIExvZ2dpbmdTdGF0ZW1lbnQgbmV3TG9nZ2luZ1N0YXRl\nbWVudChTdGF0ZW1lbnQgc3RtbnQpCiAgICAgICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gQ29uY3JldGVDbGFzc0dl\nbmVyYXRvci5uZXdJbnN0YW5jZShsb2dnaW5nU3RhdGVtZW50SW1wbCwgTG9n\nZ2luZ0Nvbm5lY3Rpb24udGhpcywgc3RtbnQpOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBwcml2YXRlIExvZ2dpbmdEYXRhYmFzZU1ldGFEYXRhIG5l\nd0xvZ2dpbmdEYXRhYmFzZU1ldGFEYXRhCiAgICAgICAgICAgIChEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICByZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJbnN0YW5j\nZShsb2dnaW5nRGF0YWJhc2VNZXRhRGF0YUltcGwsIExvZ2dpbmdDb25uZWN0\naW9uLnRoaXMsIG1ldGEpOwogICAgICAgIH0KCgoKICAgICAgICBwdWJsaWMg\ndm9pZCBjb21taXQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAg\nICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN1cGVyLmNv\nbW1pdCgpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHsKICAgICAgICAgICAgICAgIGVyciA9IHNlOwogICAgICAgICAgICAgICAg\ndGhyb3cgc2U7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgIF9sb2dzLmxvZ0pEQkMoImNvbW1pdCIsIHN0YXJ0LCB0aGlzKTsK\nICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhlcnIpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByb2xsYmFj\naygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIHN0\nYXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAg\nIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgc3VwZXIucm9sbGJhY2soKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgICAgICBlcnIgPSBzZTsKICAgICAgICAgICAgICAgIHRocm93IHNl\nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYg\nKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBf\nbG9ncy5sb2dKREJDKCJyb2xsYmFjayIsIHN0YXJ0LCB0aGlzKTsKICAgICAg\nICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhlcnIpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7ICAgICAgIAogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgc3VwZXIuY2xvc2UoKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pE\nQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRC\nQygiY2xvc2UiLCBzdGFydCwgdGhpcyk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBTYXZlcG9pbnQgc2V0U2F2ZXBvaW50KCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgU1FM\nRXhjZXB0aW9uIGVyciA9IG51bGw7ICAgICAgICAgICAgCiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuc2V0U2F2ZXBv\naW50KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAgICAgICB0\naHJvdyBzZTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgX2xvZ3MubG9nSkRCQygic2F2ZXBvaW50Iiwgc3RhcnQsIHRoaXMp\nOwogICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKGVycik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTYXZlcG9pbnQg\nc2V0U2F2ZXBvaW50KFN0cmluZyBuYW1lKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVs\nbDsgICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5zZXRTYXZlcG9pbnQobmFtZSk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAg\nICAgZXJyID0gc2U7CiAgICAgICAgICAgICAgICB0aHJvdyBzZTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5p\nc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9n\nSkRCQygic2F2ZXBvaW50OiAiICsgbmFtZSwgc3RhcnQsIHRoaXMpOwogICAg\nICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKGVycik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKFNh\ndmVwb2ludCBzYXZlcG9pbnQpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCk7CiAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOyAgICAg\nICAgICAgIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3Vw\nZXIucm9sbGJhY2soc2F2ZXBvaW50KTsKICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSBzZTsK\nICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBuYW1lID0gbnVsbDsK\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICBuYW1lID0gc2F2ZXBvaW50LmdldFNhdmVwb2ludE5hbWUoKTsKICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FlKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBTdHJpbmcudmFsdWVP\nZihzYXZlcG9pbnQuZ2V0U2F2ZXBvaW50SWQoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoInJv\nbGxiYWNrOiAiICsgbmFtZSwgc3RhcnQsIHRoaXMpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKGVycik7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJl\nbGVhc2VTYXZlcG9pbnQoU2F2ZXBvaW50IHNhdmVwb2ludCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0u\nY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgU1FMRXhjZXB0aW9u\nIGVyciA9IG51bGw7ICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBzdXBlci5yZWxlYXNlU2F2ZXBvaW50KHNhdmVwb2lu\ndCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAgICAgICB0aHJv\ndyBzZTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHNhdmVwb2lu\ndC5nZXRTYXZlcG9pbnROYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNxZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBuYW1lID0gU3RyaW5nLnZhbHVlT2Yoc2F2ZXBvaW50LmdldFNhdmVw\nb2ludElkKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBfbG9ncy5sb2dKREJDKCJyZWxlYXNlOiAiICsgbmFtZSwgc3Rh\ncnQsIHRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\naGFuZGxlU1FMRXJyb3JzKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50\nKGludCByZXN1bHRTZXRUeXBlLAogICAgICAgICAgICBpbnQgcmVzdWx0U2V0\nQ29uY3VycmVuY3ksIGludCByZXN1bHRTZXRIb2xkYWJpbGl0eSwgYm9vbGVh\nbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBTdGF0ZW1lbnQgc3RtbnQgPSBzdXBl\nci5jcmVhdGVTdGF0ZW1lbnQocmVzdWx0U2V0VHlwZSwKICAgICAgICAgICAg\nICAgICAgICByZXN1bHRTZXRDb25jdXJyZW5jeSwgcmVzdWx0U2V0SG9sZGFi\naWxpdHksIGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXdMb2dn\naW5nU3RhdGVtZW50KHN0bW50KTsKICAgICAgICAgICAgfWNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGVyciA9IHNlOwogICAg\nICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoZXJyKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVk\nU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwKICAgICAg\nICAgICAgaW50IHJlc3VsdFNldFR5cGUsIGludCByZXN1bHRTZXRDb25jdXJy\nZW5jeSwKICAgICAgICAgICAgaW50IHJlc3VsdFNldEhvbGRhYmlsaXR5LCBi\nb29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gc3Vw\nZXIucHJlcGFyZVN0YXRlbWVudAogICAgICAgICAgICAgICAgICAgIChzcWws\nIHJlc3VsdFNldFR5cGUsIHJlc3VsdFNldENvbmN1cnJlbmN5LAogICAgICAg\nICAgICAgICAgICAgICAgICByZXN1bHRTZXRIb2xkYWJpbGl0eSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudChzdG1udCwgc3FsKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSB3cmFwKHNl\nLCBzcWwpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3Jz\nKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmlu\nZyBzcWwsCiAgICAgICAgICAgIGludCBhdXRvR2VuZXJhdGVkS2V5cywgYm9v\nbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHN1cGVy\nLnByZXBhcmVTdGF0ZW1lbnQKICAgICAgICAgICAgICAgICAgICAoc3FsLCBh\ndXRvR2VuZXJhdGVkS2V5cywgZmFsc2UpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ld0xvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudChzdG1udCwgc3FsKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgICAgICBlcnIgPSB3cmFwKHNlLCBzcWwpOwogICAgICAgICAgICAg\nICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKGVycik7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVu\ndCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsCiAgICAgICAgICAgIGlu\ndFtdIGNvbHVtbkluZGV4ZXMsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxs\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAg\nICAgICAgICAgICAgICAgKHNxbCwgY29sdW1uSW5kZXhlcywgZmFsc2UpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdQcmVwYXJlZFN0YXRl\nbWVudChzdG1udCwgc3FsKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSB3cmFwKHNlLCBz\ncWwpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKGVy\ncik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBz\ncWwsCiAgICAgICAgICAgIFN0cmluZ1tdIGNvbHVtbk5hbWVzLCBib29sZWFu\nIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBTUUxF\neGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gc3VwZXIucHJl\ncGFyZVN0YXRlbWVudAogICAgICAgICAgICAgICAgICAgIChzcWwsIGNvbHVt\nbk5hbWVzLCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3TG9n\nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwogICAgICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nIGVyciA9IHdyYXAoc2UsIHNxbCk7CiAgICAgICAgICAgICAgICB0aHJvdyBl\ncnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBo\nYW5kbGVTUUxFcnJvcnMoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgcHJvdGVjdGVkIERhdGFiYXNlTWV0YURhdGEgZ2V0TWV0YURh\ndGEoYm9vbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdEYXRhYmFzZU1l\ndGFEYXRhKHN1cGVyLmdldE1ldGFEYXRhKGZhbHNlKSk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBMb2cgdGltZSBlbGFwc2VkIHNpbmNl\nIGdpdmVuIHN0YXJ0LgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9p\nZCBsb2dUaW1lKGxvbmcgc3RhcnRUaW1lKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgaWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZ3MubG9nU1FMKCJzcGVudCIsIHN0YXJ0VGltZSwg\ndGhpcyk7IAogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTG9n\nIHRpbWUgZWxhcHNlZCBzaW5jZSBnaXZlbiBzdGFydC4KICAgICAgICAgKi8K\nICAgICAgICBwcml2YXRlIHZvaWQgbG9nU1FMKFN0YXRlbWVudCBzdG1udCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfbG9ncy5p\nc1NRTEVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2dzLmxvZ1NRTCgi\nZXhlY3V0aW5nICIgKyBzdG1udCwgdGhpcyk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBMb2cgdGltZSBlbGFwc2VkIHNpbmNlIGdpdmVu\nIHN0YXJ0LgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBsb2dC\nYXRjaFNRTChTdGF0ZW1lbnQgc3RtbnQpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICBpZiAoX2xvZ3MuaXNTUUxFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9ncy5sb2dTUUwoImV4ZWN1dGluZyBiYXRjaCAiICsg\nc3RtbnQsIHRoaXMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKioK\nICAgICAgICAgKiBIYW5kbGUgYW55IHtAbGluayBTUUxXYXJuaW5nfXMgb24g\ndGhlIGN1cnJlbnQge0BsaW5rIENvbm5lY3Rpb259LgogICAgICAgICAqIENo\nYWluIHRocm93ZWQgU1FMV2FybmluZ3MgdG8gU1FMRXhjZXB0aW9uLgogICAg\nICAgICAqIEBzZWUgI2hhbmRsZVNRTFdhcm5pbmcoU1FMV2FybmluZykKICAg\nICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgaGFuZGxlU1FMRXJyb3Jz\nKFNRTEV4Y2VwdGlvbiBlcnIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICBpZiAoX3dhcm5pbmdBY3Rpb24gPT0gV0FSTl9JR05PUkUpCiAg\nICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhnZXRXYXJuaW5ncygpKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHdhcm5pbmcpIHsK\nICAgICAgICAgICAgICAgIGlmIChlcnIgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBlcnIuc2V0TmV4dEV4Y2VwdGlvbih3YXJuaW5nKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0aHJvdyB3YXJu\naW5nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\nY2xlYXJXYXJuaW5ncygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBIYW5kbGUgYW55IHtAbGluayBTUUxXYXJu\naW5nfXMgb24gdGhlIHNwZWNpZmllZCB7QGxpbmsgU3RhdGVtZW50fS4KICAg\nICAgICAgKiBDaGFpbiB0aHJvd2VkIFNRTFdhcm5pbmdzIHRvIFNRTEV4Y2Vw\ndGlvbi4KICAgICAgICAgKgogICAgICAgICAqIEBzZWUgI2hhbmRsZVNRTFdh\ncm5pbmcoU1FMV2FybmluZykKICAgICAgICAgKi8KICAgICAgICBwcml2YXRl\nIHZvaWQgaGFuZGxlU1FMRXJyb3JzKFN0YXRlbWVudCBzdG1udCwgU1FMRXhj\nZXB0aW9uIGVycikgCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICBpZiAoX3dhcm5pbmdBY3Rpb24gPT0gV0FSTl9JR05P\nUkUpCiAgICAgICAgICAgICAgICByZXR1cm47IAogICAgICAgICAgICAKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5p\nbmcoc3RtbnQuZ2V0V2FybmluZ3MoKSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiB3YXJuaW5nKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZXJyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZXJyLnNldE5leHRF\neGNlcHRpb24od2FybmluZyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgd2FybmluZzsKICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIHN0bW50LmNsZWFyV2FybmluZ3Mo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gICAgICAgIAogICAgICAgIAog\nICAgICAgIC8qKgogICAgICAgICAqIEhhbmRsZSBhbnkge0BsaW5rIFNRTFdh\ncm5pbmd9cyBvbiB0aGUgc3BlY2lmaWVkIHtAbGluayBSZXN1bHRTZXR9Lgog\nICAgICAgICAqIENoYWluIHRocm93ZWQgU1FMV2FybmluZ3MgdG8gU1FMRXhj\nZXB0aW9uLgogICAgICAgICAqIAogICAgICAgICAqIEBzZWUgI2hhbmRsZVNR\nTFdhcm5pbmcoU1FMV2FybmluZykKICAgICAgICAgKi8KICAgICAgICBwcml2\nYXRlIHZvaWQgaGFuZGxlU1FMRXJyb3JzKFJlc3VsdFNldCBycywgU1FMRXhj\nZXB0aW9uIGVycikgCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICBpZiAoX3dhcm5pbmdBY3Rpb24gPT0gV0FSTl9JR05P\nUkUpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIAogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaGFuZGxlU1FMV2Fybmlu\nZyhycy5nZXRXYXJuaW5ncygpKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHdhcm5pbmcpewogICAgICAgICAgICAgICAgaWYgKGVyciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGVyci5zZXROZXh0RXhjZXB0\naW9uKHdhcm5pbmcpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHRocm93IHdhcm5pbmc7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBycy5jbGVhcldhcm5pbmdzKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAg\nICAgICogSGFuZGxlIHRoZSBzcGVjaWZpZWQge0BsaW5rIFNRTFdhcm5pbmd9\nIGRlcGVuZGluZyBvbiB0aGUKICAgICAgICAgKiBzZXR0aW5nIG9mIHRoZSB7\nQGxpbmsgI3NldFdhcm5pbmdBY3Rpb259IGF0dHJpYnV0ZS4KICAgICAgICAg\nKgogICAgICAgICAqIEBwYXJhbSB3YXJuaW5nIHRoZSB3YXJuaW5nIHRvIGhh\nbmRsZQogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBoYW5kbGVT\nUUxXYXJuaW5nKFNRTFdhcm5pbmcgd2FybmluZykgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGlmICh3YXJuaW5nID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChfd2FybmluZ0Fj\ndGlvbiA9PSBXQVJOX0lHTk9SRSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIExvZyBsb2cgPSBfbG9ncy5nZXRKREJDTG9nKCk7CiAg\nICAgICAgICAgIGZvciAoOyB3YXJuaW5nICE9IG51bGw7IHdhcm5pbmcgPSB3\nYXJuaW5nLmdldE5leHRXYXJuaW5nKCkpIHsKICAgICAgICAgICAgICAgIHN3\naXRjaCAoX3dhcm5pbmdBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBj\nYXNlIFdBUk5fTE9HX1RSQUNFOgogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsb2cudHJhY2Uod2FybmluZyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgV0FSTl9M\nT0dfSU5GTzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc0lu\nZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cu\naW5mbyh3YXJuaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBXQVJOX0xPR19XQVJOOgogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKHdhcm5pbmcp\nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgICAgICBjYXNlIFdBUk5fTE9HX0VSUk9SOgogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAobG9nLmlzRXJyb3JFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsb2cuZXJyb3Iod2FybmluZyk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNh\nc2UgV0FSTl9USFJPVzoKICAgICAgICAgICAgICAgICAgICAgICAgLy8ganVz\ndCB0aHJvdyBpdCBhcyBpZiBpdCB3ZXJlIGEgU1FMRXhjZXB0aW9uCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IHdhcm5pbmc7CiAgICAgICAgICAg\nICAgICAgICAgY2FzZSBXQVJOX0hBTkRMRToKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKF93YXJuaW5nSGFuZGxlciAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX3dhcm5pbmdIYW5kbGVyLmhhbmRsZVdhcm5p\nbmcod2FybmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIGlnbm9yZQogICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogTWV0YWRhdGEgd3JhcHBlciB0aGF0\nIGxvZ3MgYWN0aW9ucy4KICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQg\nYWJzdHJhY3QgY2xhc3MgTG9nZ2luZ0RhdGFiYXNlTWV0YURhdGEKICAgICAg\nICAgICAgZXh0ZW5kcyBEZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSB7Cgog\nICAgICAgICAgICBwdWJsaWMgTG9nZ2luZ0RhdGFiYXNlTWV0YURhdGEoRGF0\nYWJhc2VNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgICAgICAgICBzdXBlciht\nZXRhLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRCZXN0Um93SWRlbnRp\nZmllcihTdHJpbmcgY2F0YWxvZywKICAgICAgICAgICAgICAgIFN0cmluZyBz\nY2hlbWEsIFN0cmluZyB0YWJsZSwgaW50IHNjb3BlLCBib29sZWFuIG51bGxh\nYmxlKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldEJlc3RSb3dJZGVu\ndGlmaWVyOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyAr\nICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAg\nICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmdldEJlc3RSb3dJZGVudGlmaWVyKGNhdGFs\nb2csIHNjaGVtYSwKICAgICAgICAgICAgICAgICAgICB0YWJsZSwgc2NvcGUs\nIG51bGxhYmxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIFJlc3VsdFNldCBnZXRDYXRhbG9ncygpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRDYXRhbG9n\ncyIsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldENhdGFsb2dzKCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0Q29sdW1uUHJpdmlsZWdl\ncyhTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYSwKICAgICAgICAgICAg\nICAgIFN0cmluZyB0YWJsZSwgU3RyaW5nIGNvbHVtbk5hbWVQYXR0ZXJuKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9n\ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3Mu\nbG9nSkRCQygiZ2V0Q29sdW1uUHJpdmlsZWdlczogIgogICAgICAgICAgICAg\nICAgICAgICAgICArIGNhdGFsb2cgKyAiLCAiICsgc2NoZW1hICsgIiwgIiAr\nIHRhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVj\ndGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRD\nb2x1bW5Qcml2aWxlZ2VzKGNhdGFsb2csIHNjaGVtYSwKICAgICAgICAgICAg\nICAgICAgICB0YWJsZSwgY29sdW1uTmFtZVBhdHRlcm4pOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldENvbHVtbnMo\nU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFQYXR0ZXJuLAogICAgICAg\nICAgICAgICAgU3RyaW5nIHRhYmxlTmFtZVBhdHRlcm4sIFN0cmluZyBjb2x1\nbW5OYW1lUGF0dGVybikKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRD\nb2x1bW5zOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyAr\nICIsICIgKyBzY2hlbWFQYXR0ZXJuICsgIiwgIgogICAgICAgICAgICAgICAg\nICAgICAgICArIHRhYmxlTmFtZVBhdHRlcm4gKyAiLCAiICsgY29sdW1uTmFt\nZVBhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25u\nZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdl\ndENvbHVtbnMoY2F0YWxvZywgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAg\nICAgICAgICB0YWJsZU5hbWVQYXR0ZXJuLCBjb2x1bW5OYW1lUGF0dGVybik7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQg\nZ2V0Q3Jvc3NSZWZlcmVuY2UoU3RyaW5nIHByaW1hcnlDYXRhbG9nLAogICAg\nICAgICAgICAgICAgU3RyaW5nIHByaW1hcnlTY2hlbWEsIFN0cmluZyBwcmlt\nYXJ5VGFibGUsCiAgICAgICAgICAgICAgICBTdHJpbmcgZm9yZWlnbkNhdGFs\nb2csIFN0cmluZyBmb3JlaWduU2NoZW1hLAogICAgICAgICAgICAgICAgU3Ry\naW5nIGZvcmVpZ25UYWJsZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldENyb3NzUmVmZXJlbmNl\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgcHJpbWFyeUNhdGFsb2cg\nKyAiLCAiICsgcHJpbWFyeVNjaGVtYSArICIsICIKICAgICAgICAgICAgICAg\nICAgICAgICAgKyBwcmltYXJ5VGFibGUgKyAiLCAiICsgZm9yZWlnbkNhdGFs\nb2cgKyAiLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgZm9yZWlnblNj\naGVtYSArICIsICIgKyBmb3JlaWduU2NoZW1hLAogICAgICAgICAgICAgICAg\nICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5nZXRDcm9zc1JlZmVyZW5jZShwcmltYXJ5Q2F0\nYWxvZywgcHJpbWFyeVNjaGVtYSwKICAgICAgICAgICAgICAgICAgICBwcmlt\nYXJ5VGFibGUsIGZvcmVpZ25DYXRhbG9nLCBmb3JlaWduU2NoZW1hLCBmb3Jl\naWduVGFibGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nUmVzdWx0U2V0IGdldEV4cG9ydGVkS2V5cyhTdHJpbmcgY2F0YWxvZywgU3Ry\naW5nIHNjaGVtYSwKICAgICAgICAgICAgICAgIFN0cmluZyB0YWJsZSkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3Mu\naXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxv\nZ0pEQkMoImdldEV4cG9ydGVkS2V5czogIgogICAgICAgICAgICAgICAgICAg\nICAgICArIGNhdGFsb2cgKyAiLCAiICsgc2NoZW1hICsgIiwgIiArIHRhYmxl\nLAogICAgICAgICAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi50\naGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRFeHBvcnRl\nZEtleXMoY2F0YWxvZywgc2NoZW1hLCB0YWJsZSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0SW1wb3J0ZWRLZXlz\nKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hLAogICAgICAgICAgICAg\nICAgU3RyaW5nIHRhYmxlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0SW1wb3J0ZWRLZXlzOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBz\nY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAg\nIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmdldEltcG9ydGVkS2V5cyhjYXRhbG9nLCBzY2hlbWEsIHRh\nYmxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3Vs\ndFNldCBnZXRJbmRleEluZm8oU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hl\nbWEsCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGUsIGJvb2xlYW4gdW5p\ncXVlLCBib29sZWFuIGFwcHJveGltYXRlKQogICAgICAgICAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3Mu\naXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxv\nZ0pEQkMoImdldEluZGV4SW5mbzogIgogICAgICAgICAgICAgICAgICAgICAg\nICArIGNhdGFsb2cgKyAiLCAiICsgc2NoZW1hICsgIiwgIiArIHRhYmxlLAog\nICAgICAgICAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi50aGlz\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRJbmRleEluZm8o\nY2F0YWxvZywgc2NoZW1hLCB0YWJsZSwgdW5pcXVlLAogICAgICAgICAgICAg\nICAgICAgIGFwcHJveGltYXRlKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIFJlc3VsdFNldCBnZXRQcmltYXJ5S2V5cyhTdHJpbmcgY2F0\nYWxvZywgU3RyaW5nIHNjaGVtYSwKICAgICAgICAgICAgICAgIFN0cmluZyB0\nYWJsZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBp\nZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nIF9sb2dzLmxvZ0pEQkMoImdldFByaW1hcnlLZXlzOiAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWEgKyAiLCAi\nICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25u\nZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdl\ndFByaW1hcnlLZXlzKGNhdGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldFByb2Nl\nZHVyZUNvbHVtbnMoU3RyaW5nIGNhdGFsb2csCiAgICAgICAgICAgICAgICBT\ndHJpbmcgc2NoZW1hUGF0dGVybiwgU3RyaW5nIHByb2NlZHVyZU5hbWVQYXR0\nZXJuLAogICAgICAgICAgICAgICAgU3RyaW5nIGNvbHVtbk5hbWVQYXR0ZXJu\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChf\nbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xv\nZ3MubG9nSkRCQygiZ2V0UHJvY2VkdXJlQ29sdW1uczogIgogICAgICAgICAg\nICAgICAgICAgICAgICArIGNhdGFsb2cgKyAiLCAiICsgc2NoZW1hUGF0dGVy\nbiArICIsICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBwcm9jZWR1cmVO\nYW1lUGF0dGVybiArICIsICIgKyBjb2x1bW5OYW1lUGF0dGVybiwKICAgICAg\nICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJvY2VkdXJlQ29sdW1u\ncyhjYXRhbG9nLCBzY2hlbWFQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAg\nIHByb2NlZHVyZU5hbWVQYXR0ZXJuLCBjb2x1bW5OYW1lUGF0dGVybik7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0\nUHJvY2VkdXJlcyhTdHJpbmcgY2F0YWxvZywKICAgICAgICAgICAgICAgIFN0\ncmluZyBzY2hlbWFQYXR0ZXJuLCBTdHJpbmcgcHJvY2VkdXJlTmFtZVBhdHRl\ncm4pCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0UHJvY2VkdXJlczog\nIgogICAgICAgICAgICAgICAgICAgICAgICArIGNhdGFsb2cgKyAiLCAiICsg\nc2NoZW1hUGF0dGVybiArICIsICIKICAgICAgICAgICAgICAgICAgICAgICAg\nKyBwcm9jZWR1cmVOYW1lUGF0dGVybiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhp\ncyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJvY2VkdXJl\ncyhjYXRhbG9nLCBzY2hlbWFQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAg\nIHByb2NlZHVyZU5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRTY2hlbWFzKCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJD\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMo\nImdldFNjaGVtYXMiLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBzdXBlci5nZXRTY2hlbWFzKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VGFibGVQ\ncml2aWxlZ2VzKFN0cmluZyBjYXRhbG9nLAogICAgICAgICAgICAgICAgU3Ry\naW5nIHNjaGVtYVBhdHRlcm4sIFN0cmluZyB0YWJsZU5hbWVQYXR0ZXJuKQog\nICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldFRhYmxlUHJpdmlsZWdlcyIs\nIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmdldFRhYmxlUHJpdmlsZWdlcyhjYXRhbG9nLCBzY2hlbWFQ\nYXR0ZXJuLAogICAgICAgICAgICAgICAgICAgIHRhYmxlTmFtZVBhdHRlcm4p\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0\nIGdldFRhYmxlcyhTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYVBhdHRl\ncm4sCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lUGF0dGVybiwg\nU3RyaW5nW10gdHlwZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRUYWJsZXM6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYVBh\ndHRlcm4gKyAiLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgdGFibGVO\nYW1lUGF0dGVybiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGFibGVzKGNhdGFsb2csIHNjaGVt\nYVBhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgdGFibGVOYW1lUGF0dGVy\nbiwgdHlwZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nUmVzdWx0U2V0IGdldFRhYmxlVHlwZXMoKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0VGFibGVU\neXBlcyIsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmdldFRhYmxlVHlwZXMoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRUeXBlSW5mbygp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9s\nb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9n\ncy5sb2dKREJDKCJnZXRUeXBlSW5mbyIsIExvZ2dpbmdDb25uZWN0aW9uLnRo\naXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFR5cGVJbmZv\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRT\nZXQgZ2V0VURUcyhTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYVBhdHRl\ncm4sCiAgICAgICAgICAgICAgICBTdHJpbmcgdHlwZU5hbWVQYXR0ZXJuLCBp\nbnRbXSB0eXBlcykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldFVEVHMiLCBMb2dnaW5nQ29ubmVj\ndGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRV\nRFRzKGNhdGFsb2csIHNjaGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAgICAg\nICAgdHlwZU5hbWVQYXR0ZXJuLCB0eXBlcyk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VmVyc2lvbkNvbHVtbnMo\nU3RyaW5nIGNhdGFsb2csCiAgICAgICAgICAgICAgICBTdHJpbmcgc2NoZW1h\nLCBTdHJpbmcgdGFibGUpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRWZXJzaW9uQ29sdW1uczog\nIgogICAgICAgICAgICAgICAgICAgICAgICArIGNhdGFsb2cgKyAiLCAiICsg\nc2NoZW1hICsgIiwgIiArIHRhYmxlLAogICAgICAgICAgICAgICAgICAgICAg\nICBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5nZXRWZXJzaW9uQ29sdW1ucyhjYXRhbG9nLCBzY2hlbWEs\nIHRhYmxlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogU3RhdGVtZW50IHdyYXBwZXIgdGhhdCBsb2dzIFNRTCB0\nbyB0aGUgcGFyZW50IGRhdGEgc291cmNlIGFuZAogICAgICAgICAqIHJlbWVt\nYmVycyB0aGUgbGFzdCBwaWVjZSBvZiBTUUwgdG8gYmUgZXhlY3V0ZWQgb24g\naXQuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVkIGFic3RyYWN0IGNs\nYXNzIExvZ2dpbmdTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxlZ2F0aW5nU3RhdGVt\nZW50IHsKCiAgICAgICAgICAgIHByaXZhdGUgU3RyaW5nIF9zcWwgPSBudWxs\nOwoKICAgICAgICAgICAgcHVibGljIExvZ2dpbmdTdGF0ZW1lbnQoU3RhdGVt\nZW50IHN0bW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHN1cGVyKHN0bW50LCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBMb2dnaW5nUmVzdWx0\nU2V0IG5ld0xvZ2dpbmdSZXN1bHRTZXQoUmVzdWx0U2V0IHJzLCBTdGF0ZW1l\nbnQgc3RtbnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNs\nYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGxvZ2dpbmdSZXN1bHRTZXRJbXBs\nLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzLCBycywgc3RtbnQpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBhcHBlbmRJbmZvKFN0\ncmluZ0J1ZmZlciBidWYpIHsKICAgICAgICAgICAgICAgIGlmIChfc3FsICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgIik7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKF9mb3JtYXR0ZXIgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKFNFUCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2Zvcm1hdHRlci5w\ncmV0dHlQcmludChfc3FsKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfc3FsKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgd3Jh\ncFJlc3VsdChSZXN1bHRTZXQgcnMsIGJvb2xlYW4gd3JhcCkgewogICAgICAg\nICAgICAgICAgaWYgKCF3cmFwIHx8IHJzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLndyYXBSZXN1bHQocnMsIHdyYXApOwog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ld0xvZ2dpbmdSZXN1bHRTZXQocnMs\nIHRoaXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBjYW5jZWwoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgX2xvZ3MubG9nSkRCQygiY2FuY2VsICIgKyB0aGlzLCBMb2dnaW5n\nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHN1cGVyLmNhbmNl\nbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgUmVz\ndWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3FsLCBib29sZWFuIHdyYXAp\nCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIF9zcWwgPSBzcWw7CiAgICAgICAgICAgICAgICBsb2dTUUwo\ndGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNlcHRp\nb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeShzcWwsIHdy\nYXApOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7ICAgICAgICAgICAgICAgCQogICAgICAgICAgICAgICAgICAgIGVyciA9\nIHdyYXAoc2UsIExvZ2dpbmdTdGF0ZW1lbnQudGhpcywgc3FsKTsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwog\nICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nU3Rh\ndGVtZW50LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZShT\ndHJpbmcgc3FsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIF9zcWwgPSBzcWw7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhpcyk7\nCiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJy\nID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgeyAgICAgICAg\nICAgICAgICAJCiAgICAgICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwg\nTG9nZ2luZ1N0YXRlbWVudC50aGlzLCBzcWwpOwogICAgICAgICAgICAgICAg\nICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAg\nICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdTdGF0ZW1lbnQudGhp\ncywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIGJvb2xlYW4gZXhlY3V0ZShTdHJpbmcgc3FsKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIF9zcWwgPSBz\ncWw7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhpcyk7CiAgICAgICAgICAg\nICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmV4ZWN1dGUoc3FsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIGVyciA9\nIHdyYXAoc2UsIExvZ2dpbmdTdGF0ZW1lbnQudGhpcywgc3FsKTsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwog\nICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nU3Rh\ndGVtZW50LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBhYnN0cmFjdCBj\nbGFzcyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQKICAgICAgICAgICAgZXh0\nZW5kcyBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQgewoKICAgICAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX3NxbDsKICAgICAgICAgICAgcHJp\ndmF0ZSBMaXN0PFN0cmluZz4gX3BhcmFtcyA9IG51bGw7CiAgICAgICAgICAg\nIHByaXZhdGUgTGlzdDxMaXN0PFN0cmluZz4+IF9wYXJhbUJhdGNoID0gbnVs\nbDsKICAgICAgICAgICAgLy8gV2hlbiBiYXRjaGluZyBpcyB1c2VkLCB0aGlz\nIHZhcmlhYmxlIGNvbnRhaW5zIHRoZSBpbmRleCBpbnRvIHRoZQogICAgICAg\nICAgICAvLyBsYXN0IHN1Y2Nlc3NmdWxseSBleGVjdXRlZCBiYXRjaGVkIHN0\nYXRlbWVudC4KICAgICAgICAgICAgaW50IGJhdGNoZWRSb3dzQmFzZUluZGV4\nID0gMDsKCiAgICAgICAgICAgIHB1YmxpYyBMb2dnaW5nUHJlcGFyZWRTdGF0\nZW1lbnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIFN0cmluZyBzcWwpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHN1cGVyKHN0bW50LCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsK\nICAgICAgICAgICAgICAgIF9zcWwgPSBzcWw7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHByaXZhdGUgTG9nZ2luZ1Jlc3VsdFNldCBuZXdMb2dnaW5n\nUmVzdWx0U2V0KFJlc3VsdFNldCBycywKICAgICAgICAgICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nQ29uY3JldGVDbGFzc0dlbmVyYXRvci4KICAgICAgICAgICAgICAgICAgICBu\nZXdJbnN0YW5jZShsb2dnaW5nUmVzdWx0U2V0SW1wbCwKICAgICAgICAgICAg\nICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi5jbGFzcywgTG9nZ2luZ0Nvbm5l\nY3Rpb24udGhpcywKICAgICAgICAgICAgICAgICAgICBSZXN1bHRTZXQuY2xh\nc3MsIHJzLAogICAgICAgICAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nLmNsYXNzLCBzdG1udCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBy\nb3RlY3RlZCBSZXN1bHRTZXQgd3JhcFJlc3VsdChSZXN1bHRTZXQgcnMsIGJv\nb2xlYW4gd3JhcCkgewogICAgICAgICAgICAgICAgaWYgKCF3cmFwIHx8IHJz\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLndy\nYXBSZXN1bHQocnMsIHdyYXApOwogICAgICAgICAgICAgICAgcmV0dXJuIG5l\nd0xvZ2dpbmdSZXN1bHRTZXQocnMsIHRoaXMpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShT\ndHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlz\nKTsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVu\ndFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBl\ncnIgPSBudWxsOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVF1ZXJ5KHNxbCwgd3JhcCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgICAgICAgICBlcnIgPSB3cmFwKHNlLCBMb2dnaW5nUHJl\ncGFyZWRTdGF0ZW1lbnQudGhpcywgc3FsKTsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAg\nICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1ByZXBhcmVkU3RhdGVt\nZW50LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZShTdHJp\nbmcgc3FsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIFNR\nTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0\nZShzcWwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gIHdyYXAoc2UsIExv\nZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzLCBzcWwpOwogICAgICAgICAg\nICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAg\nICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nUHJlcGFy\nZWRTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gZXhlY3V0\nZShTdHJpbmcgc3FsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3Rh\ncnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAg\nICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0\nZShzcWwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwgTG9n\nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMsIHNxbCk7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAg\nICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dpbmdQcmVwYXJl\nZFN0YXRlbWVudC50aGlzLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4\nZWN1dGVRdWVyeShib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAgICAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5leGVjdXRlUXVlcnkod3JhcCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICBl\ncnIgPSB3cmFwKHNlLCBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcywg\nX3NxbCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dU\naW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFt\nZXRlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJy\nb3JzKExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzLCBlcnIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgaW50IGV4ZWN1dGVVcGRhdGUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAg\nICAgICAgICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0g\nd3JhcChzZSwgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMpOwogICAg\nICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7\nCiAgICAgICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUp\nOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5n\nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGludFtdIGV4\nZWN1dGVCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgaW50IGluZGV4T2ZGaXJzdEZhaWxlZE9iamVjdCA9IC0xOwoKICAg\nICAgICAgICAgICAgIGxvZ0JhdGNoU1FMKHRoaXMpOwogICAgICAgICAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGludFtdIHRv\nUmV0dXJuID0gc3VwZXIuZXhlY3V0ZUJhdGNoKCk7CiAgICAgICAgICAgICAg\nICAgICAgLy9leGVjdXRlQmF0Y2ggaXMgY2FsbGVkIGFueSB0aW1lIHRoZSBu\ndW1iZXIgb2YgYmF0Y2hlZCBzdGF0ZW1lbnRzCiAgICAgICAgICAgICAgICAg\nICAgLy9pcyBlcXVhbCB0bywgb3IgbGVzcyB0aGFuLCBiYXRjaExpbWl0LiAg\nSW4gdGhlICdjYXRjaCcgYmxvY2sgYmVsb3csCiAgICAgICAgICAgICAgICAg\nICAgLy90aGUgbG9naWMgc2Vla3MgdG8gZmluZCBhbiBpbmRleCBiYXNlZCBv\nbiB0aGUgY3VycmVudCBleGVjdXRlQmF0Y2gKICAgICAgICAgICAgICAgICAg\nICAvL3Jlc3VsdHMuICBUaGlzIGlzIGZpbmUgd2hlbiBleGVjdXRlQmF0Y2gg\naXMgb25seSBjYWxsZWQgb25jZSwgYnV0CiAgICAgICAgICAgICAgICAgICAg\nLy9pZiBleGVjdXRlQmF0Y2ggaXMgY2FsbGVkIG1hbnkgdGltZXMsIHRoZSBf\ncGFyYW1zQmF0Y2ggd2lsbCBjb250aW51ZQogICAgICAgICAgICAgICAgICAg\nIC8vdG8gZ3JvdywgYXMgc3VjaCwgdG8gaW5kZXggaW50byBfcGFyYW1zQmF0\nY2gsIHdlIG5lZWQgdG8gdGFrZSBpbnRvCiAgICAgICAgICAgICAgICAgICAg\nLy9hY2NvdW50IHRoZSBudW1iZXIgb2YgdGltZXMgZXhlY3V0ZUJhdGNoIGlz\nIGNhbGxlZCBpbiBvciBkZXIgdG8KICAgICAgICAgICAgICAgICAgICAvL2Nv\ncnJlY3RseSBpbmRleCBpbnRvIF9wYXJhbXNCYXRjaC4gIFRvIHRoYXQgZW5k\nLCBlYWNoIHRpbWUgZXhlY3V0ZUJhdGNoCiAgICAgICAgICAgICAgICAgICAg\nLy9pcyBjYWxsZWQsIGxldHMgZ2V0IHRoZSBzaXplIG9mIF9wYXJhbUJhdGNo\nLiAgVGhpcyB3aWxsIGVmZmVjdGl2ZWx5CiAgICAgICAgICAgICAgICAgICAg\nLy90ZWxsIHVzIHRoZSBpbmRleCBvZiB0aGUgbGFzdCBzdWNjZXNzZnVsbHkg\nZXhlY3V0ZWQgYmF0Y2ggc3RhdGVtZW50LgogICAgICAgICAgICAgICAgICAg\nIC8vSWYgYW4gZXhjZXB0aW9uIGlzIGNhdXNlZCwgdGhlbiB3ZSBrbm93IHRo\nYXQgX3BhcmFtQmF0Y2guc2l6ZSB3YXMKICAgICAgICAgICAgICAgICAgICAv\nL3RoZSBpbmRleCBvZiB0aGUgTEFTVCByb3cgdG8gc3VjY2Vzc2Z1bGx5IGV4\nZWN1dGUuCiAgICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbUJhdGNoICE9\nIG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICBiYXRjaGVkUm93c0Jh\nc2VJbmRleCA9IF9wYXJhbUJhdGNoLnNpemUoKTsgICAgICAgICAgICAKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHRvUmV0dXJuOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGV4Y2Vw\ndGlvbiBpcyBhIEJhdGNoVXBkYXRlRXhjZXB0aW9uLCBhbmQKICAgICAgICAg\nICAgICAgICAgICAvLyB3ZSBhcmUgdHJhY2tpbmcgcGFyYW1ldGVycywgdGhl\nbiBzZXQgdGhlIGN1cnJlbnQKICAgICAgICAgICAgICAgICAgICAvLyBwYXJh\nbWV0ZXIgc2V0IHRvIGJlIHRoZSBpbmRleCBvZiB0aGUgZmFpbGVkCiAgICAg\nICAgICAgICAgICAgICAgLy8gc3RhdGVtZW50IHNvIHRoYXQgdGhlIFJlcG9y\ndGluZ1NRTEV4Y2VwdGlvbiB3aWxsCiAgICAgICAgICAgICAgICAgICAgLy8g\nc2hvdyB0aGUgY29ycmVjdCBwYXJhbShzKQogICAgICAgICAgICAgICAgICAg\nIGlmIChzZSBpbnN0YW5jZW9mIEJhdGNoVXBkYXRlRXhjZXB0aW9uCiAgICAg\nICAgICAgICAgICAgICAgICAgICYmIF9wYXJhbUJhdGNoICE9IG51bGwgJiYg\nc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaW50W10gY291bnQgPSAoKEJhdGNoVXBkYXRlRXhjZXB0aW9uKSBz\nZSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRVcGRhdGVDb3Vu\ndHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ICE9IG51\nbGwgJiYgY291bnQubGVuZ3RoIDw9IF9wYXJhbUJhdGNoLnNpemUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudC5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0zIGlzIFN0\nYXRlbWVudC5TVEFURU1FTlRfRkFJTEVELCBidXQgaXMKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGF2YWlsYWJsZSBpbiBKREsg\nMS40KwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3Vu\ndFtpXSA9PSBTdGF0ZW1lbnQuRVhFQ1VURV9GQUlMRUQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhPZkZpcnN0RmFpbGVk\nT2JqZWN0ID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIG5vIC0zIGVsZW1lbnQ6IGl0IG1heSBiZSB0aGF0\nIHRoZSBzZXJ2ZXIgc3RvcHBlZAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gcHJvY2Vzc2luZywgc28gdGhlIHNpemUgb2YgdGhlIGNvdW50IHdp\nbGwgYmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpbmRl\neAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TZWUgdGhlIEphdmFk\nb2MgZm9yICdnZXRVcGRhdGVDb3VudHMnOyBhIHByb3ZpZGVyCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvL21heSBzdG9wIHByb2Nlc3Npbmcgd2hl\nbiB0aGUgZmlyc3QgZmFpbHVyZSBvY2N1cnMsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvL2FzIHN1Y2gsIGl0IG1heSBvbmx5IHJldHVybiAnVXBk\nYXRlQ291bnRzJyBmb3IgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvL2ZpcnN0IGZldyB3aGljaCBwYXNzLiAgQXMgc3VjaCwgdGhlIGZhaWxl\nZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pbmRleCBpcyAnY291\nbnQubGVuZ3RoJywgTk9UIGNvdW50Lmxlbmd0aCsxLiAgVGhhdAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy9pcywgaWYgdGhlIHByb3ZpZGVyIE9O\nTFkgcmV0dXJucyB0aGUgZmlyc3QgZmV3IHRoYXQKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vcGFzc2VzIChpLmUuIHNheSBhbiBhcnJheSBvZiBb\nMSwxXSBpcyByZXR1cm5lZCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy9sZW5ndGggaXMgMiwgYW5kIHNpbmNlIF9wYXJhbUJhdGNoIHN0\nYXJ0cyBhdCAwLCB3ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9k\nb24ndCB3YW50IHRvIHVzZSBsZW5ndGgrMSBhcyB0aGF0IHdpbGwgZ2l2ZSB1\ncyB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vd3JvbmcgaW5k\nZXguCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhPZkZp\ncnN0RmFpbGVkT2JqZWN0ID09IC0xKXsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBpbmRleE9mRmlyc3RGYWlsZWRPYmplY3QgPSBjb3VudC5s\nZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy9GaW5hbGx5LCB3aGF0ZXZlciB0aGUg\naW5kZXggaXMgYXQgdGhpcyBwb2ludCwgYWRkIGJhdGNoZWRSb3dzQmFzZUlu\nZGV4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvIGl0IHRvIGdl\ndCB0aGUgZmluYWwgaW5kZXguICBSZWNhbGwsIHdlIG5lZWQgdG8gc3RhcnQg\nb3VyIGluZGV4IGZyb20gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvL2xhc3QgYmF0Y2ggd2hpY2ggc3VjY2Vzc2Z1bGx5IGV4ZWN1dGVkLgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhPZkZpcnN0RmFpbGVk\nT2JqZWN0ICs9IGJhdGNoZWRSb3dzQmFzZUluZGV4OwoKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgY3VycmVudCBwYXJhbXMgdG8g\ndGhlIHNhdmVkIHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGluZGV4T2ZGaXJzdEZhaWxlZE9iamVjdCA8IF9wYXJhbUJhdGNoLnNp\nemUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyYW1z\nID0gKExpc3QpIF9wYXJhbUJhdGNoLmdldChpbmRleE9mRmlyc3RGYWlsZWRP\nYmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVyciA9IHdyYXAoc2Us\nIExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzLCBpbmRleE9mRmlyc3RG\nYWlsZWRPYmplY3QpOwogICAgICAgICAgICAgICAgICAgIHRocm93IGVycjsK\nICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAg\nICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxl\nU1FMRXJyb3JzKExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzLCBlcnIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBleGVjdXRlKCkgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhpcyk7CiAgICAgICAgICAg\nICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmV4ZWN1dGUoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIGVyciA9IHdy\nYXAoc2UsIExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzKTsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwog\nICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1By\nZXBhcmVkU3RhdGVtZW50LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNhbmNl\nbCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYg\nKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBf\nbG9ncy5sb2dKREJDKCJjYW5jZWwgIiArIHRoaXMgKyAiOiAiICsgX3NxbCwK\nICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhp\ncyk7CgogICAgICAgICAgICAgICAgc3VwZXIuY2FuY2VsKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldE51bGwoaW50IGkx\nLCBpbnQgaTIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAibnVsbCIsIG51bGwpOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0TnVsbChpMSwgaTIpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRCb29sZWFuKGludCBpLCBi\nb29sZWFuIGIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgc2V0TG9nUGFyYW1ldGVyKGksIGIpOwogICAgICAgICAgICAgICAgc3Vw\nZXIuc2V0Qm9vbGVhbihpLCBiKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIHZvaWQgc2V0Qnl0ZShpbnQgaSwgYnl0ZSBiKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRl\ncihpLCBiKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldEJ5dGUoaSwgYik7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldFNo\nb3J0KGludCBpLCBzaG9ydCBzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBzKTsKICAgICAgICAg\nICAgICAgIHN1cGVyLnNldFNob3J0KGksIHMpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRJbnQoaW50IGkxLCBpbnQgaTIp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGkxLCBpMik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRJ\nbnQoaTEsIGkyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgc2V0TG9uZyhpbnQgaSwgbG9uZyBsKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBsKTsK\nICAgICAgICAgICAgICAgIHN1cGVyLnNldExvbmcoaSwgbCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldEZsb2F0KGludCBp\nLCBmbG9hdCBmKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpLCBmKTsKICAgICAgICAgICAgICAgIHN1\ncGVyLnNldEZsb2F0KGksIGYpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXREb3VibGUoaW50IGksIGRvdWJsZSBkKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpLCBkKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldERvdWJsZShp\nLCBkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2V0QmlnRGVjaW1hbChpbnQgaSwgQmlnRGVjaW1hbCBiZCkKICAgICAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nc2V0TG9nUGFyYW1ldGVyKGksICJCaWdEZWNpbWFsIiwgYmQpOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0QmlnRGVjaW1hbChpLCBiZCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldFN0cmluZyhpbnQg\naSwgU3RyaW5nIHMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJTdHJpbmciLCBzKTsKICAgICAg\nICAgICAgICAgIHN1cGVyLnNldFN0cmluZyhpLCBzKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Qnl0ZXMoaW50IGksIGJ5\ndGVbXSBiKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIHNldExvZ1BhcmFtZXRlcihpLCAiYnl0ZVtdIiwgYik7CiAgICAgICAgICAg\nICAgICBzdXBlci5zZXRCeXRlcyhpLCBiKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0RGF0ZShpbnQgaSwgRGF0ZSBkKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1Bh\ncmFtZXRlcihpLCAiRGF0ZSIsIGQpOwogICAgICAgICAgICAgICAgc3VwZXIu\nc2V0RGF0ZShpLCBkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0VGltZShpbnQgaSwgVGltZSB0KSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAi\nVGltZSIsIHQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0VGltZShpLCB0\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0\nVGltZXN0YW1wKGludCBpLCBUaW1lc3RhbXAgdCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIlRp\nbWVzdGFtcCIsIHQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0VGltZXN0\nYW1wKGksIHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzZXRBc2NpaVN0cmVhbShpbnQgaTEsIElucHV0U3RyZWFtIGlzLCBp\nbnQgaTIpCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIklucHV0U3Ry\nZWFtIiwgaXMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0QXNjaWlTdHJl\nYW0oaTEsIGlzLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBE\nZXByZWNhdGVkCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldFVuaWNvZGVT\ndHJlYW0oaW50IGkxLCBJbnB1dFN0cmVhbSBpcywgaW50IGkyKQogICAgICAg\nICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJJbnB1dFN0cmVhbSIsIGlzKTsKICAg\nICAgICAgICAgICAgIHN1cGVyLnNldFVuaWNvZGVTdHJlYW0oaTIsIGlzLCBp\nMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndEJpbmFyeVN0cmVhbShpbnQgaTEsIElucHV0U3RyZWFtIGlzLCBpbnQgaTIp\nCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIklucHV0U3RyZWFtIiwg\naXMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0QmluYXJ5U3RyZWFtKGkx\nLCBpcywgaTIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBjbGVhclBhcmFtZXRlcnMoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyhmYWxzZSk7CiAg\nICAgICAgICAgICAgICBzdXBlci5jbGVhclBhcmFtZXRlcnMoKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0T2JqZWN0KGlu\ndCBpMSwgT2JqZWN0IG8sIGludCBpMiwgaW50IGkzKQogICAgICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRM\nb2dQYXJhbWV0ZXIoaTEsICJPYmplY3QiLCBvKTsKICAgICAgICAgICAgICAg\nIHN1cGVyLnNldE9iamVjdChpMSwgbywgaTIsIGkzKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0T2JqZWN0KGludCBpMSwg\nT2JqZWN0IG8sIGludCBpMikKICAgICAgICAgICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkx\nLCAiT2JqZWN0Iiwgbyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRPYmpl\nY3QoaTEsIG8sIGkyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2V0T2JqZWN0KGludCBpLCBPYmplY3QgbykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naSwgIk9iamVjdCIsIG8pOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0T2Jq\nZWN0KGksIG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBhZGRCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgaWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIF9sb2dzLmxvZ1NRTCgiYmF0Y2hpbmcgIiArIHRoaXMsIExv\nZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBz\ndGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdXBlci5hZGRCYXRj\naCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFt\nZXRlcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgb3VyIGxpc3QgaXMgaW5pdGlhbGl6ZWQKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKF9wYXJhbUJhdGNoID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfcGFyYW1CYXRjaCA9IG5ldyBBcnJheUxpc3Q8TGlz\ndDxTdHJpbmc+PigpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb3B5\nIHBhcmFtZXRlcnMgc2luY2UgdGhleSB3aWxsIGJlIHJlLXVzZWQKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbXMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxTdHJpbmc+IGNvcHlQYXJt\ncyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBB\ncnJheUxpc3Q8U3RyaW5nPihfcGFyYW1zKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIF9wYXJhbUJhdGNoLmFkZChjb3B5UGFybXMpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmFk\nZChudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Q2hhcmFjdGVy\nU3RyZWFtKGludCBpMSwgUmVhZGVyIHIsIGludCBpMikKICAgICAgICAgICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGkxLCAiUmVhZGVyIiwgcik7CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXRDaGFyYWN0ZXJTdHJlYW0oaTEsIHIsIGkyKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0UmVmKGludCBp\nLCBSZWYgcikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBzZXRMb2dQYXJhbWV0ZXIoaSwgIlJlZiIsIHIpOwogICAgICAgICAgICAg\nICAgc3VwZXIuc2V0UmVmKGksIHIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzZXRCbG9iKGludCBpLCBCbG9iIGIpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1l\ndGVyKGksICJCbG9iIiwgYik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRC\nbG9iKGksIGIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzZXRDbG9iKGludCBpLCBDbG9iIGMpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJDbG9i\nIiwgYyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRDbG9iKGksIGMpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRBcnJh\neShpbnQgaSwgQXJyYXkgYSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIkFycmF5IiwgYSk7CiAg\nICAgICAgICAgICAgICBzdXBlci5zZXRBcnJheShpLCBhKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldE1ldGFEYXRhIGdl\ndE1ldGFEYXRhKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwZXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0RGF0ZShpbnQgaSwgRGF0\nZSBkLCBDYWxlbmRhciBjKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiRGF0ZSIsIGQpOwogICAg\nICAgICAgICAgICAgc3VwZXIuc2V0RGF0ZShpLCBkLCBjKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZShpbnQgaSwg\nVGltZSB0LCBDYWxlbmRhciBjKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZSIsIHQpOwog\nICAgICAgICAgICAgICAgc3VwZXIuc2V0VGltZShpLCB0LCBjKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1w\nKGludCBpLCBUaW1lc3RhbXAgdCwgQ2FsZW5kYXIgYykKICAgICAgICAgICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGksICJUaW1lc3RhbXAiLCB0KTsKICAgICAgICAgICAg\nICAgIHN1cGVyLnNldFRpbWVzdGFtcChpLCB0LCBjKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0TnVsbChpbnQgaTEsIGlu\ndCBpMiwgU3RyaW5nIHMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAibnVsbCIsIG51bGwpOwog\nICAgICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChpMSwgaTIsIHMpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRJ\nbmZvKFN0cmluZ0J1ZmZlciBidWYpIHsKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiAiKTsKICAgICAgICAgICAgICAgIGlmIChfZm9ybWF0dGVyICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKFNFUCk7\nCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfZm9ybWF0dGVyLnBy\nZXR0eVByaW50KF9zcWwpKTsKICAgICAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKFNFUCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoX3NxbCk7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBwYXJhbUJ1ZiA9IG51\nbGw7CiAgICAgICAgICAgICAgICBpZiAoX3BhcmFtcyAhPSBudWxsICYmICFf\ncGFyYW1zLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIHBhcmFt\nQnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yPFN0cmluZz4gaXRyID0gX3BhcmFtcy5pdGVyYXRv\ncigpOyBpdHIKICAgICAgICAgICAgICAgICAgICAgICAgLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1CdWYuYXBwZW5kKGl0\nci5uZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRyLmhh\nc05leHQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtQnVm\nLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHBhcmFtQnVmICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIV9wcmV0dHlQcmludCkK\nICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAg\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltwYXJhbXM9IikuCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFwcGVuZChwYXJhbUJ1Zi50b1N0cmluZygp\nKS5hcHBlbmQoIl0iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHN1cGVyLmFwcGVuZEluZm8oYnVmKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHJpdmF0ZSB2b2lkIGNsZWFyTG9nUGFyYW1ldGVycyhib29s\nZWFuIGJhdGNoKSB7CiAgICAgICAgICAgICAgICBpZiAoX3BhcmFtcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgX3BhcmFtcy5jbGVhcigpOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChiYXRjaCAm\nJiBfcGFyYW1CYXRjaCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nX3BhcmFtQmF0Y2guY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBib29sZWFuIHNob3VsZFRy\nYWNrUGFyYW1ldGVycygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdHJh\nY2tQYXJhbWV0ZXJzIHx8IF9sb2dzLmlzU1FMRW5hYmxlZCgpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1l\ndGVyKGludCBpbmRleCwgYm9vbGVhbiB2YWwpIHsKICAgICAgICAgICAgICAg\nIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAg\nICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoYm9vbGVhbikgIiArIHZh\nbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBz\nZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBieXRlIHZhbCkgewogICAgICAg\nICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIihieXRlKSAi\nICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2\nb2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGRvdWJsZSB2YWwpIHsK\nICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkK\nICAgICAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIo\nZG91YmxlKSAiICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGZsb2F0\nIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1l\ndGVycygpKQogICAgICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihp\nbmRleCwgIihmbG9hdCkgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4\nLCBpbnQgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQ\nYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1l\ndGVyKGluZGV4LCAiKGludCkgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGlu\nZGV4LCBsb25nIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3VsZFRy\nYWNrUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNldExvZ1Bh\ncmFtZXRlcihpbmRleCwgIihsb25nKSAiICsgdmFsKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihp\nbnQgaW5kZXgsIHNob3J0IHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNo\nb3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpbmRleCwgIihzaG9ydCkgIiArIHZhbCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJh\nbWV0ZXIoaW50IGluZGV4LCBTdHJpbmcgdHlwZSwgT2JqZWN0IHZhbCkgewog\nICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQog\nICAgICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIigi\nICsgdHlwZSArICIpICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwg\nU3RyaW5nIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKF9wYXJhbXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcGFyYW1zID0gbmV3IEFycmF5\nTGlzdDxTdHJpbmc+KCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoX3BhcmFt\ncy5zaXplKCkgPCBpbmRleCkKICAgICAgICAgICAgICAgICAgICBfcGFyYW1z\nLmFkZChudWxsKTsKICAgICAgICAgICAgICAgIGlmICh2YWwubGVuZ3RoKCkg\nPiA4MCkKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3RyaW5n\nKDAsIDc3KSArICIuLi4iOwogICAgICAgICAgICAgICAgX3BhcmFtcy5zZXQo\naW5kZXggLSAxLCB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBXYXJuaW5nLWhhbmRsaW5nIHJlc3VsdCBz\nZXQuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVkIGFic3RyYWN0IGNs\nYXNzIExvZ2dpbmdSZXN1bHRTZXQgZXh0ZW5kcyBEZWxlZ2F0aW5nUmVzdWx0\nU2V0IHsKCiAgICAgICAgICAgIHB1YmxpYyBMb2dnaW5nUmVzdWx0U2V0KFJl\nc3VsdFNldCBycywgU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAgICAgICAg\nICBzdXBlcihycywgc3RtbnQpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBuZXh0KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLm5leHQoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIGVyciA9IHNlOwog\nICAgICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJv\ncnMoTG9nZ2luZ1Jlc3VsdFNldC50aGlzLCBlcnIpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBj\nbG9zZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7ICAgICAgICAgICAgCQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdXBlci5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5n\nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGJlZm9yZUZpcnN0\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBTUUxF\neGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAgICAJCiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLmJlZm9yZUZp\ncnN0KCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgICAgICAgICBlcnIgPSBzZTsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBzZTsKICAgICAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dp\nbmdSZXN1bHRTZXQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgYWZ0ZXJMYXN0\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBTUUxF\neGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAgICAJCiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLmFmdGVyTGFz\ndCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5n\nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGZpcnN0KCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBTUUxFeGNl\ncHRpb24gZXJyID0gbnVsbDsgICAgICAgICAgICAJCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5maXJz\ndCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5n\nUmVzdWx0U2V0LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGxhc3QoKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIFNRTEV4Y2Vw\ndGlvbiBlcnIgPSBudWxsOyAgICAgICAgICAgIAkKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmxhc3Qo\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgICAgIGVyciA9IHNlOwogICAgICAgICAgICAg\nICAgICAgIHRocm93IHNlOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1Jl\nc3VsdFNldC50aGlzLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShp\nbnQgYSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBT\nUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAgICAJCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBl\nci5hYnNvbHV0ZShhKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIGVyciA9IHNlOwog\nICAgICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxFcnJv\ncnMoTG9nZ2luZ1Jlc3VsdFNldC50aGlzLCBlcnIpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVh\nbiByZWxhdGl2ZShpbnQgYSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAg\nICAJCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBlci5yZWxhdGl2ZShhKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAg\nIGVyciA9IHNlOwogICAgICAgICAgICAgICAgICAgIHRocm93IHNlOwogICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBo\nYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1Jlc3VsdFNldC50aGlzLCBlcnIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBwcmV2aW91cygpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51bGw7ICAg\nICAgICAgICAgCQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIucHJldmlvdXMoKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAg\nICAgICAgIGVyciA9IHNlOwogICAgICAgICAgICAgICAgICAgIHRocm93IHNl\nOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ1Jlc3VsdFNldC50aGlzLCBl\ncnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIENhbGxhYmxlU3Rh\ndGVtZW50IGRlY29yYXRlZCB3aXRoIGxvZ2dpbmcuCiAgICAgICAgICogU2lt\naWxhciB0byB7QGxpbmsgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50fSBidXQg\nY2FuIG5vdCBiZSBleHRlbmRlZAogICAgICAgICAqIGR1ZSB0byB0aGUgZXhp\nc3RpbmcgZGVsZWdhdGlvbiBoaWVyYXJjaHkuCiAgICAgICAgICovCiAgICAg\nICAgcHJvdGVjdGVkIGFic3RyYWN0IGNsYXNzIExvZ2dpbmdDYWxsYWJsZVN0\nYXRlbWVudCBleHRlbmRzIAogICAgICAgICAgICBEZWxlZ2F0aW5nQ2FsbGFi\nbGVTdGF0ZW1lbnQgewogICAgICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmlu\nZyBfc3FsOwogICAgICAgICAgICBwcml2YXRlIExpc3Q8U3RyaW5nPiBfcGFy\nYW1zID0gbnVsbDsKICAgICAgICAgICAgcHJpdmF0ZSBMaXN0PExpc3Q8U3Ry\naW5nPj4gX3BhcmFtQmF0Y2ggPSBudWxsOwogICAgICAgICAgICAvL1doZW4g\nYmF0Y2hpbmcgaXMgdXNlZCwgdGhpcyB2YXJpYWJsZSBjb250YWlucyB0aGUg\naW5kZXggaW50byB0aGUgbGFzdAogICAgICAgICAgICAvL3N1Y2Nlc3NmdWxs\neSBleGVjdXRlZCBiYXRjaGVkIHN0YXRlbWVudC4KICAgICAgICAgICAgaW50\nIGJhdGNoZWRSb3dzQmFzZUluZGV4ID0gMDsgICAgICAgICAgICAKCiAgICAg\nICAgICAgIHB1YmxpYyBMb2dnaW5nQ2FsbGFibGVTdGF0ZW1lbnQoQ2FsbGFi\nbGVTdGF0ZW1lbnQgc3RtdCwgU3RyaW5nIHNxbCkgCiAgICAgICAgICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAJCXN1cGVyKHN0bXQs\nIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgIAkJX3NxbCA9IHNx\nbDsKICAgICAgICAJfQogICAgICAgIAkKICAgICAgICAgICAgcHJpdmF0ZSBM\nb2dnaW5nUmVzdWx0U2V0IG5ld0xvZ2dpbmdSZXN1bHRTZXQoUmVzdWx0U2V0\nIHJzLAogICAgICAgICAgICAgICAgQ2FsbGFibGVTdGF0ZW1lbnQgc3RtbnQp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJh\ndG9yLgogICAgICAgICAgICAgICAgICAgIG5ld0luc3RhbmNlKGxvZ2dpbmdS\nZXN1bHRTZXRJbXBsLAogICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25u\nZWN0aW9uLmNsYXNzLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzLAogICAgICAg\nICAgICAgICAgICAgIFJlc3VsdFNldC5jbGFzcywgcnMsCiAgICAgICAgICAg\nICAgICAgICAgQ2FsbGFibGVTdGF0ZW1lbnQuY2xhc3MsIHN0bW50KTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcHJvdGVjdGVk\nIFJlc3VsdFNldCB3cmFwUmVzdWx0KFJlc3VsdFNldCBycywgYm9vbGVhbiB3\ncmFwKSB7CiAgICAgICAgICAgICAgICBpZiAoIXdyYXAgfHwgcnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIud3JhcFJlc3Vs\ndCh3cmFwLCBycyk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3TG9nZ2lu\nZ1Jlc3VsdFNldChycywgdGhpcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KFN0cmluZyBz\ncWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAg\nICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51\nbGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICAgICAgICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdDYWxsYWJsZVN0\nYXRlbWVudC50aGlzLCBzcWwpOwogICAgICAgICAgICAgICAgICAgIHRocm93\nIGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAg\nY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwogICAgICAgICAgICAgICAgICAg\nIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nQ2FsbGFibGVTdGF0ZW1lbnQudGhp\ncywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nU1FM\nKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgU1FMRXhjZXB0\naW9uIGVyciA9IG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlVXBkYXRlKHNxbCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgICAgICAgICBlcnIgPSB3cmFwKHNlLCBMb2dnaW5nQ2Fs\nbGFibGVTdGF0ZW1lbnQudGhpcywgc3FsKTsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAg\nICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBoYW5kbGVTUUxFcnJvcnMoTG9nZ2luZ0NhbGxhYmxlU3RhdGVt\nZW50LnRoaXMsIGVycik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGV4ZWN1dGUoU3RyaW5n\nIHNxbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBs\nb2dTUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBTUUxF\neGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGUoc3FsKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgICAgIGVyciA9IHdyYXAoc2UsIExvZ2dpbmdDYWxs\nYWJsZVN0YXRlbWVudC50aGlzLCBzcWwpOwogICAgICAgICAgICAgICAgICAg\nIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAg\nICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nQ2FsbGFibGVTdGF0ZW1l\nbnQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVl\ncnkoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcg\nc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAg\nICAgICAgIFNRTEV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhl\nY3V0ZVF1ZXJ5KHdyYXApOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gd3Jh\ncChzZSwgTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMpOwogICAgICAg\nICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAg\nICAgICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nQ2Fs\nbGFibGVTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGludCBleGVjdXRl\nVXBkYXRlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBsb2dTUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBT\nUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAgICAgICAgICAgICAgCiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5leGVjdXRlVXBkYXRlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICBlcnIg\nPSB3cmFwKHNlLCBMb2dnaW5nQ2FsbGFibGVTdGF0ZW1lbnQudGhpcyk7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0YXJ0\nKTsKICAgICAgICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFtZXRlcnModHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMRXJyb3JzKExvZ2dp\nbmdDYWxsYWJsZVN0YXRlbWVudC50aGlzLCBlcnIpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgaW50W10g\nZXhlY3V0ZUJhdGNoKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBpbnQgaW5kZXhPZkZpcnN0RmFpbGVkT2JqZWN0ID0gLTE7Cgog\nICAgICAgICAgICAgICAgbG9nQmF0Y2hTUUwodGhpcyk7CiAgICAgICAgICAg\nICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsgICAg\nICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIGludFtdIHRvUmV0dXJuID0gc3VwZXIuZXhlY3V0ZUJhdGNo\nKCk7CiAgICAgICAgICAgICAgICAgICAgLy9leGVjdXRlQmF0Y2ggaXMgY2Fs\nbGVkIGFueSB0aW1lIHRoZSBudW1iZXIgb2YgYmF0Y2hlZCBzdGF0ZW1lbnRz\nCiAgICAgICAgICAgICAgICAgICAgLy9pcyBlcXVhbCB0bywgb3IgbGVzcyB0\naGFuLCBiYXRjaExpbWl0LiAgSW4gdGhlICdjYXRjaCcgYmxvY2sgYmVsb3cs\nIAogICAgICAgICAgICAgICAgICAgIC8vdGhlIGxvZ2ljIHNlZWtzIHRvIGZp\nbmQgYW4gaW5kZXggYmFzZWQgb24gdGhlIGN1cnJlbnQgZXhlY3V0ZUJhdGNo\nIAogICAgICAgICAgICAgICAgICAgIC8vcmVzdWx0cy4gIFRoaXMgaXMgZmlu\nZSB3aGVuIGV4ZWN1dGVCYXRjaCBpcyBvbmx5IGNhbGxlZCBvbmNlLCBidXQg\nCiAgICAgICAgICAgICAgICAgICAgLy9pZiBleGVjdXRlQmF0Y2ggaXMgY2Fs\nbGVkIG1hbnkgdGltZXMsIHRoZSBfcGFyYW1zQmF0Y2ggd2lsbCBjb250aW51\nZSAKICAgICAgICAgICAgICAgICAgICAvL3RvIGdyb3csIGFzIHN1Y2gsIHRv\nIGluZGV4IGludG8gX3BhcmFtc0JhdGNoLCB3ZSBuZWVkIHRvIHRha2UgaW50\nbyAKICAgICAgICAgICAgICAgICAgICAvL2FjY291bnQgdGhlIG51bWJlciBv\nZiB0aW1lcyBleGVjdXRlQmF0Y2ggaXMgY2FsbGVkIGluIG9yZGVyIHRvIAog\nICAgICAgICAgICAgICAgICAgIC8vY29ycmVjdGx5IGluZGV4IGludG8gX3Bh\ncmFtc0JhdGNoLiAgVG8gdGhhdCBlbmQsIGVhY2ggdGltZSBleGVjdXRlQmF0\nY2ggCiAgICAgICAgICAgICAgICAgICAgLy9pcyBjYWxsZWQsIGxldHMgZ2V0\nIHRoZSBzaXplIG9mIF9wYXJhbUJhdGNoLiAgVGhpcyB3aWxsIGVmZmVjdGl2\nZWx5IAogICAgICAgICAgICAgICAgICAgIC8vdGVsbCB1cyB0aGUgaW5kZXgg\nb2YgdGhlIGxhc3Qgc3VjY2Vzc2Z1bGx5IGV4ZWN1dGVkIGJhdGNoIHN0YXRl\nbWVudC4gIAogICAgICAgICAgICAgICAgICAgIC8vSWYgYW4gZXhjZXB0aW9u\nIGlzIGNhdXNlZCwgdGhlbiB3ZSBrbm93IHRoYXQgX3BhcmFtQmF0Y2guc2l6\nZSB3YXMgCiAgICAgICAgICAgICAgICAgICAgLy90aGUgaW5kZXggb2YgdGhl\nIExBU1Qgcm93IHRvIHN1Y2Nlc3NmdWxseSBleGVjdXRlLgogICAgICAgICAg\nICAgICAgICAgIGlmIChfcGFyYW1CYXRjaCAhPSBudWxsKXsKICAgICAgICAg\nICAgICAgICAgICAgICAgYmF0Y2hlZFJvd3NCYXNlSW5kZXggPSBfcGFyYW1C\nYXRjaC5zaXplKCk7ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0b1Jl\ndHVybjsgCiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZXhjZXB0aW9u\nIGlzIGEgQmF0Y2hVcGRhdGVFeGNlcHRpb24sIGFuZAogICAgICAgICAgICAg\nICAgICAgIC8vIHdlIGFyZSB0cmFja2luZyBwYXJhbWV0ZXJzLCB0aGVuIHNl\ndCB0aGUgY3VycmVudAogICAgICAgICAgICAgICAgICAgIC8vIHBhcmFtZXRl\nciBzZXQgdG8gYmUgdGhlIGluZGV4IG9mIHRoZSBmYWlsZWQKICAgICAgICAg\nICAgICAgICAgICAvLyBzdGF0ZW1lbnQgc28gdGhhdCB0aGUgUmVwb3J0aW5n\nU1FMRXhjZXB0aW9uIHdpbGwKICAgICAgICAgICAgICAgICAgICAvLyBzaG93\nIHRoZSBjb3JyZWN0IHBhcmFtCiAgICAgICAgICAgICAgICAgICAgaWYgKHNl\nIGluc3RhbmNlb2YgQmF0Y2hVcGRhdGVFeGNlcHRpb24KICAgICAgICAgICAg\nICAgICAgICAgICAgJiYgX3BhcmFtQmF0Y2ggIT0gbnVsbCAmJiBzaG91bGRU\ncmFja1BhcmFtZXRlcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nbnRbXSBjb3VudCA9ICgoQmF0Y2hVcGRhdGVFeGNlcHRpb24pIHNlKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGdldFVwZGF0ZUNvdW50cygpOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgIT0gbnVsbCAmJiBj\nb3VudC5sZW5ndGggPD0gX3BhcmFtQmF0Y2guc2l6ZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvdW50Lmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLTMgaXMgU3RhdGVtZW50\nLlNUQVRFTUVOVF9GQUlMRUQsIGJ1dCBpcwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIG9ubHkgYXZhaWxhYmxlIGluIEpESyAxLjQrCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50W2ldID09\nIFN0YXRlbWVudC5FWEVDVVRFX0ZBSUxFRCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpbmRleE9mRmlyc3RGYWlsZWRPYmplY3Qg\nPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gbm8gLTMgZWxlbWVudDogaXQgbWF5IGJlIHRoYXQgdGhlIHNl\ncnZlciBzdG9wcGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBw\ncm9jZXNzaW5nLCBzbyB0aGUgc2l6ZSBvZiB0aGUgY291bnQgd2lsbCBiZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGluZGV4CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvL1NlZSB0aGUgSmF2YWRvYyBmb3Ig\nJ2dldFVwZGF0ZUNvdW50cyc7IGEgcHJvdmlkZXIgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAvL21heSBzdG9wIHByb2Nlc3Npbmcgd2hlbiB0aGUg\nZmlyc3QgZmFpbHVyZSBvY2N1cnMsIAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy9hcyBzdWNoLCBpdCBtYXkgb25seSByZXR1cm4gJ1VwZGF0ZUNv\ndW50cycgZm9yIHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v\nZmlyc3QgZmV3IHdoaWNoIHBhc3MuICBBcyBzdWNoLCB0aGUgZmFpbGVkIAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pbmRleCBpcyAnY291bnQu\nbGVuZ3RoJywgTk9UIGNvdW50Lmxlbmd0aCsxLiAgVGhhdAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLy9pcywgaWYgdGhlIHByb3ZpZGVyIE9OTFkg\ncmV0dXJucyB0aGUgZmlyc3QgZmV3IHRoYXQgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvL3Bhc3NlcyAoaS5lLiBzYXkgYW4gYXJyYXkgb2YgWzEs\nMV0gaXMgcmV0dXJuZWQpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vbGVuZ3RoIGlzIDIsIGFuZCBzaW5jZSBfcGFyYW1CYXRjaCBzdGFy\ndHMgYXQgMCwgd2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2Rv\nbid0IHdhbnQgdG8gdXNlIGxlbmd0aCsxIGFzIHRoYXQgd2lsbCBnaXZlIHVz\nIHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vd3JvbmcgaW5k\nZXguCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhPZkZp\ncnN0RmFpbGVkT2JqZWN0ID09IC0xKXsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBpbmRleE9mRmlyc3RGYWlsZWRPYmplY3QgPSBjb3VudC5s\nZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vRmluYWxseSwgd2hhdGV2ZXIgdGhlIGluZGV4IGlzIGF0IHRoaXMg\ncG9pbnQsIGFkZCBiYXRjaGVkUm93c0Jhc2VJbmRleAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy90byBpdCB0byBnZXQgdGhlIGZpbmFsIGluZGV4\nLiAgUmVjYWxsLCB3ZSBuZWVkIHRvIHN0YXJ0IG91ciBpbmRleCBmcm9tIHRo\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sYXN0IGJhdGNoIHdo\naWNoIHN1Y2Nlc3NmdWxseSBleGVjdXRlZC4KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGluZGV4T2ZGaXJzdEZhaWxlZE9iamVjdCArPSBiYXRjaGVk\nUm93c0Jhc2VJbmRleDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyBzZXQgdGhlIGN1cnJlbnQgcGFyYW1zIHRvIHRoZSBzYXZlZCB2YWx1ZXMK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleE9mRmlyc3RG\nYWlsZWRPYmplY3QgPCBfcGFyYW1CYXRjaC5zaXplKCkpewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbXMgPSAoTGlzdDxTdHJpbmc+\nKSBfcGFyYW1CYXRjaC5nZXQoaW5kZXhPZkZpcnN0RmFpbGVkT2JqZWN0KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBlcnIgPSB3cmFwKHNlLCBMb2dnaW5nQ2FsbGFibGVTdGF0ZW1l\nbnQudGhpcywgaW5kZXhPZkZpcnN0RmFpbGVkT2JqZWN0KTsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAg\nICAgICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nQ2FsbGFi\nbGVTdGF0ZW1lbnQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gZXhlY3V0\nZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9n\nU1FMKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3Rl\nbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgU1FMRXhj\nZXB0aW9uIGVyciA9IG51bGw7ICAgICAgICAgICAgICAgIAogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nZXhlY3V0ZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gd3JhcChzZSwg\nTG9nZ2luZ0NhbGxhYmxlU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAg\nICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAg\nICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIGhhbmRsZVNRTEVycm9ycyhMb2dnaW5nQ2FsbGFibGVT\ndGF0ZW1lbnQudGhpcywgZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgY2FuY2VsKCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3Mu\naXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxv\nZ0pEQkMoImNhbmNlbCAiICsgdGhpcyArICI6ICIgKyBfc3FsLAogICAgICAg\nICAgICAgICAgICAgICAgICBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKCiAg\nICAgICAgICAgICAgICBzdXBlci5jYW5jZWwoKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0TnVsbChpbnQgaTEsIGludCBp\nMikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRM\nb2dQYXJhbWV0ZXIoaTEsICJudWxsIiwgbnVsbCk7CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXROdWxsKGkxLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHNldEJvb2xlYW4oaW50IGksIGJvb2xlYW4g\nYikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRM\nb2dQYXJhbWV0ZXIoaSwgYik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRC\nb29sZWFuKGksIGIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgdm9pZCBzZXRCeXRlKGludCBpLCBieXRlIGIpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIGIp\nOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0Qnl0ZShpLCBiKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0U2hvcnQoaW50\nIGksIHNob3J0IHMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIHMpOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0U2hvcnQoaSwgcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHNldEludChpbnQgaTEsIGludCBpMikgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0\nZXIoaTEsIGkyKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldEludChpMSwg\naTIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBz\nZXRMb25nKGludCBpLCBsb25nIGwpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIGwpOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0TG9uZyhpLCBsKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0RmxvYXQoaW50IGksIGZsb2F0\nIGYpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGksIGYpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0\nRmxvYXQoaSwgZik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNldERvdWJsZShpbnQgaSwgZG91YmxlIGQpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGks\nIGQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0RG91YmxlKGksIGQpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRCaWdE\nZWNpbWFsKGludCBpLCBCaWdEZWNpbWFsIGJkKQogICAgICAgICAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQ\nYXJhbWV0ZXIoaSwgIkJpZ0RlY2ltYWwiLCBiZCk7CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXRCaWdEZWNpbWFsKGksIGJkKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0U3RyaW5nKGludCBpLCBTdHJp\nbmcgcykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBz\nZXRMb2dQYXJhbWV0ZXIoaSwgIlN0cmluZyIsIHMpOwogICAgICAgICAgICAg\nICAgc3VwZXIuc2V0U3RyaW5nKGksIHMpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRCeXRlcyhpbnQgaSwgYnl0ZVtdIGIp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGksICJieXRlW10iLCBiKTsKICAgICAgICAgICAgICAgIHN1\ncGVyLnNldEJ5dGVzKGksIGIpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXREYXRlKGludCBpLCBEYXRlIGQpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGksICJEYXRlIiwgZCk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXREYXRl\nKGksIGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzZXRUaW1lKGludCBpLCBUaW1lIHQpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJUaW1lIiwg\ndCk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRUaW1lKGksIHQpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRUaW1lc3Rh\nbXAoaW50IGksIFRpbWVzdGFtcCB0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZXN0YW1w\nIiwgdCk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRUaW1lc3RhbXAoaSwg\ndCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\ndEFzY2lpU3RyZWFtKGludCBpMSwgSW5wdXRTdHJlYW0gaXMsIGludCBpMikK\nICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAiSW5wdXRTdHJlYW0iLCBp\ncyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRBc2NpaVN0cmVhbShpMSwg\naXMsIGkyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQERlcHJlY2F0\nZWQKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VW5pY29kZVN0cmVhbShp\nbnQgaTEsIElucHV0U3RyZWFtIGlzLCBpbnQgaTIpCiAgICAgICAgICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExv\nZ1BhcmFtZXRlcihpMSwgIklucHV0U3RyZWFtIiwgaXMpOwogICAgICAgICAg\nICAgICAgc3VwZXIuc2V0VW5pY29kZVN0cmVhbShpMiwgaXMsIGkyKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0QmluYXJ5\nU3RyZWFtKGludCBpMSwgSW5wdXRTdHJlYW0gaXMsIGludCBpMikKICAgICAg\nICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAiSW5wdXRTdHJlYW0iLCBpcyk7CiAg\nICAgICAgICAgICAgICBzdXBlci5zZXRCaW5hcnlTdHJlYW0oaTEsIGlzLCBp\nMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNs\nZWFyUGFyYW1ldGVycygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKGZhbHNlKTsKICAgICAgICAg\nICAgICAgIHN1cGVyLmNsZWFyUGFyYW1ldGVycygpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3QoaW50IGkxLCBP\nYmplY3QgbywgaW50IGkyLCBpbnQgaTMpCiAgICAgICAgICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpMSwgIk9iamVjdCIsIG8pOwogICAgICAgICAgICAgICAgc3VwZXIu\nc2V0T2JqZWN0KGkxLCBvLCBpMiwgaTMpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3QoaW50IGkxLCBPYmplY3Qg\nbywgaW50IGkyKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJPYmpl\nY3QiLCBvKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldE9iamVjdChpMSwg\nbywgaTIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzZXRPYmplY3QoaW50IGksIE9iamVjdCBvKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiT2Jq\nZWN0Iiwgbyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRPYmplY3QoaSwg\nbyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFk\nZEJhdGNoKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBpZiAoX2xvZ3MuaXNTUUxFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgX2xvZ3MubG9nU1FMKCJiYXRjaGluZyAiICsgdGhpcywgTG9nZ2luZ0Nv\nbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLmFkZEJhdGNoKCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBvdXIg\nbGlzdCBpcyBpbml0aWFsaXplZAogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoX3BhcmFtQmF0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIF9wYXJhbUJhdGNoID0gbmV3IEFycmF5TGlzdDxMaXN0PFN0cmlu\nZz4+KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvcHkgcGFyYW1l\ndGVycyBzaW5jZSB0aGV5IHdpbGwgYmUgcmUtdXNlZAogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoX3BhcmFtcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4gY29weVBhcmFtcyA9CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KF9wYXJhbXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nX3BhcmFtQmF0Y2guYWRkKGNvcHlQYXJhbXMpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmFkZChudWxsKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dU\naW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKGlu\ndCBpMSwgUmVhZGVyIHIsIGludCBpMikKICAgICAgICAgICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1l\ndGVyKGkxLCAiUmVhZGVyIiwgcik7CiAgICAgICAgICAgICAgICBzdXBlci5z\nZXRDaGFyYWN0ZXJTdHJlYW0oaTEsIHIsIGkyKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0UmVmKGludCBpLCBSZWYgcikg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQ\nYXJhbWV0ZXIoaSwgIlJlZiIsIHIpOwogICAgICAgICAgICAgICAgc3VwZXIu\nc2V0UmVmKGksIHIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgdm9pZCBzZXRCbG9iKGludCBpLCBCbG9iIGIpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJC\nbG9iIiwgYik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRCbG9iKGksIGIp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRD\nbG9iKGludCBpLCBDbG9iIGMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJDbG9iIiwgYyk7CiAg\nICAgICAgICAgICAgICBzdXBlci5zZXRDbG9iKGksIGMpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRBcnJheShpbnQgaSwg\nQXJyYXkgYSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBzZXRMb2dQYXJhbWV0ZXIoaSwgIkFycmF5IiwgYSk7CiAgICAgICAgICAg\nICAgICBzdXBlci5zZXRBcnJheShpLCBhKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIFJlc3VsdFNldE1ldGFEYXRhIGdldE1ldGFEYXRh\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2V0RGF0ZShpbnQgaSwgRGF0ZSBkLCBDYWxl\nbmRhciBjKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIHNldExvZ1BhcmFtZXRlcihpLCAiRGF0ZSIsIGQpOwogICAgICAgICAgICAg\nICAgc3VwZXIuc2V0RGF0ZShpLCBkLCBjKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZShpbnQgaSwgVGltZSB0LCBD\nYWxlbmRhciBjKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZSIsIHQpOwogICAgICAgICAg\nICAgICAgc3VwZXIuc2V0VGltZShpLCB0LCBjKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1wKGludCBpLCBU\naW1lc3RhbXAgdCwgQ2FsZW5kYXIgYykKICAgICAgICAgICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1l\ndGVyKGksICJUaW1lc3RhbXAiLCB0KTsKICAgICAgICAgICAgICAgIHN1cGVy\nLnNldFRpbWVzdGFtcChpLCB0LCBjKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2V0TnVsbChpbnQgaTEsIGludCBpMiwgU3Ry\naW5nIHMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nc2V0TG9nUGFyYW1ldGVyKGkxLCAibnVsbCIsIG51bGwpOwogICAgICAgICAg\nICAgICAgc3VwZXIuc2V0TnVsbChpMSwgaTIsIHMpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRJbmZvKFN0cmlu\nZ0J1ZmZlciBidWYpIHsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAi\nKTsKICAgICAgICAgICAgICAgIGlmIChfZm9ybWF0dGVyICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKFNFUCk7CiAgICAgICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChfZm9ybWF0dGVyLnByZXR0eVByaW50\nKF9zcWwpKTsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKFNFUCk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoX3NxbCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgU3RyaW5nQnVpbGRlciBwYXJhbUJ1ZiA9IG51bGw7CiAgICAg\nICAgICAgICAgICBpZiAoX3BhcmFtcyAhPSBudWxsICYmICFfcGFyYW1zLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIHBhcmFtQnVmID0gbmV3\nIFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yPFN0cmluZz4gaXRyID0gX3BhcmFtcy5pdGVyYXRvcigpOyBpdHIK\nICAgICAgICAgICAgICAgICAgICAgICAgLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcGFyYW1CdWYuYXBwZW5kKGl0ci5uZXh0KCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtQnVmLmFwcGVuZCgi\nLCAiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgaWYgKHBhcmFtQnVmICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoIV9wcmV0dHlQcmludCkKICAgICAgICAg\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIltwYXJhbXM9IikuCiAgICAgICAgICAgICAg\nICAgICAgICAgIGFwcGVuZChwYXJhbUJ1Zi50b1N0cmluZygpKS5hcHBlbmQo\nIl0iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN1cGVy\nLmFwcGVuZEluZm8oYnVmKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHJvdGVjdGVkIHZvaWQgY2xlYXJMb2dQYXJhbWV0ZXJzKGJvb2xlYW4gYmF0\nY2gpIHsKICAgICAgICAgICAgICAgIGlmIChfcGFyYW1zICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgX3BhcmFtcy5jbGVhcigpOwogICAgICAgICAg\nICAgICAgaWYgKGJhdGNoICYmIF9wYXJhbUJhdGNoICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgX3BhcmFtQmF0Y2guY2xlYXIoKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBib29sZWFuIHNob3VsZFRyYWNr\nUGFyYW1ldGVycygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdHJhY2tQ\nYXJhbWV0ZXJzIHx8IF9sb2dzLmlzU1FMRW5hYmxlZCgpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVy\nKGludCBpbmRleCwgYm9vbGVhbiB2YWwpIHsKICAgICAgICAgICAgICAgIGlm\nIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAgICAg\nICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoYm9vbGVhbikgIiArIHZhbCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRM\nb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBieXRlIHZhbCkgewogICAgICAgICAg\nICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAgICAg\nICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIihieXRlKSAiICsg\ndmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lk\nIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGRvdWJsZSB2YWwpIHsKICAg\nICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAg\nICAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoZG91\nYmxlKSAiICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJp\ndmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGZsb2F0IHZh\nbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVy\ncygpKQogICAgICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRl\neCwgIihmbG9hdCkgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBp\nbnQgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJh\nbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGluZGV4LCAiKGludCkgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4\nLCBsb25nIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNr\nUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpbmRleCwgIihsb25nKSAiICsgdmFsKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQg\naW5kZXgsIHNob3J0IHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3Vs\nZFRyYWNrUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNldExv\nZ1BhcmFtZXRlcihpbmRleCwgIihzaG9ydCkgIiArIHZhbCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0\nZXIoaW50IGluZGV4LCBTdHJpbmcgdHlwZSwgT2JqZWN0IHZhbCkgewogICAg\nICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAg\nICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIigiICsg\ndHlwZSArICIpICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwgU3Ry\naW5nIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKF9wYXJhbXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBfcGFyYW1zID0gbmV3IEFycmF5TGlz\ndDxTdHJpbmc+KCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoX3BhcmFtcy5z\naXplKCkgPCBpbmRleCkKICAgICAgICAgICAgICAgICAgICBfcGFyYW1zLmFk\nZChudWxsKTsKICAgICAgICAgICAgICAgIGlmICh2YWwubGVuZ3RoKCkgPiA4\nMCkKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3RyaW5nKDAs\nIDc3KSArICIuLi4iOwogICAgICAgICAgICAgICAgX3BhcmFtcy5zZXQoaW5k\nZXggLSAxLCB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSAg\nIAp9Cg==\n","encoding":"base64"}

