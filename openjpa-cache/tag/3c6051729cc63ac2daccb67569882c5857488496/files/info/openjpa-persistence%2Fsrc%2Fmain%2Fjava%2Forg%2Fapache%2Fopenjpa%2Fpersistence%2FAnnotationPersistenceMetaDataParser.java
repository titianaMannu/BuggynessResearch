{"sha":"8ffc4024c213e038cd634ded2cd33596b5610a15","node_id":"MDQ6QmxvYjIwNjM2NDo4ZmZjNDAyNGMyMTNlMDM4Y2Q2MzRkZWQyY2QzMzU5NmI1NjEwYTE1","size":76333,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8ffc4024c213e038cd634ded2cd33596b5610a15","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBz\ndGF0aWMgamF2YXgucGVyc2lzdGVuY2UuR2VuZXJhdGlvblR5cGUuQVVUTzsK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2Uu\nTWV0YURhdGFUYWcuQUNDRVNTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5DQUNIRUFCTEU7Cmlt\ncG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1l\ndGFEYXRhVGFnLkRBVEFTVE9SRV9JRDsKaW1wb3J0IHN0YXRpYyBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuREFUQV9DQUNI\nRTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVu\nY2UuTWV0YURhdGFUYWcuREVQRU5ERU5UOwppbXBvcnQgc3RhdGljIG9yZy5h\ncGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5ERVRBQ0hF\nRF9TVEFURTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVy\nc2lzdGVuY2UuTWV0YURhdGFUYWcuRUxFTV9ERVBFTkRFTlQ7CmltcG9ydCBz\ndGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRh\nVGFnLkVMRU1fVFlQRTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5q\ncGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuRU1CRURERURfSUQ7CmltcG9y\ndCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFE\nYXRhVGFnLkVOVElUWV9MSVNURU5FUlM7CmltcG9ydCBzdGF0aWMgb3JnLmFw\nYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRhVGFnLkVYQ0xVREVf\nREVGQVVMVF9MSVNURU5FUlM7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5v\ncGVuanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRhVGFnLkVYQ0xVREVfU1VQRVJD\nTEFTU19MSVNURU5FUlM7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRhVGFnLkVYVEVSTkFMSVpFUjsKaW1w\nb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0\nYURhdGFUYWcuRVhURVJOQUxfVkFMUzsKaW1wb3J0IHN0YXRpYyBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuRkFDVE9SWTsK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2Uu\nTWV0YURhdGFUYWcuRkVUQ0hfR1JPVVA7CmltcG9ydCBzdGF0aWMgb3JnLmFw\nYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRhVGFnLkZFVENIX0dS\nT1VQUzsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lz\ndGVuY2UuTWV0YURhdGFUYWcuRkxVU0hfTU9ERTsKaW1wb3J0IHN0YXRpYyBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuR0VO\nRVJBVEVEX1ZBTFVFOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5JRDsKaW1wb3J0IHN0YXRpYyBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuSURf\nQ0xBU1M7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLk1ldGFEYXRhVGFnLklOVkVSU0VfTE9HSUNBTDsKaW1wb3J0IHN0\nYXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFU\nYWcuS0VZX0RFUEVOREVOVDsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9w\nZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuS0VZX1RZUEU7CmltcG9y\ndCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFE\nYXRhVGFnLkxPQURfRkVUQ0hfR1JPVVA7CmltcG9ydCBzdGF0aWMgb3JnLmFw\nYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRhVGFnLkxSUzsKaW1w\nb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0\nYURhdGFUYWcuTUFOQUdFRF9JTlRFUkZBQ0U7CmltcG9ydCBzdGF0aWMgb3Jn\nLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFEYXRhVGFnLk1BUFBF\nRF9CWV9JRDsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVy\nc2lzdGVuY2UuTWV0YURhdGFUYWcuTUFQX0tFWTsKaW1wb3J0IHN0YXRpYyBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuTUFQ\nX0tFWV9DTEFTUzsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEu\ncGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuTkFUSVZFX1FVRVJJRVM7CmltcG9y\ndCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1ldGFE\nYXRhVGFnLk5BVElWRV9RVUVSWTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuT1JERVJfQlk7Cmlt\ncG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk1l\ndGFEYXRhVGFnLlBPU1RfTE9BRDsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuUE9TVF9QRVJTSVNU\nOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5NZXRhRGF0YVRhZy5QT1NUX1JFTU9WRTsKaW1wb3J0IHN0YXRpYyBvcmcu\nYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuUE9TVF9V\nUERBVEU7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLk1ldGFEYXRhVGFnLlBSRV9QRVJTSVNUOwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5Q\nUkVfUkVNT1ZFOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5w\nZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5QUkVfVVBEQVRFOwppbXBvcnQgc3Rh\ndGljIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRh\nZy5RVUVSSUVTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5w\nZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5RVUVSWTsKaW1wb3J0IHN0YXRpYyBv\ncmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuUkVB\nRF9PTkxZOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJz\naXN0ZW5jZS5NZXRhRGF0YVRhZy5SRVBMSUNBVEVEOwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5T\nRVFfR0VORVJBVE9SOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5UWVBFOwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy5W\nRVJTSU9OOwoKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8u\nU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24uQW5u\nb3RhdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFubm90YXRlZEVs\nZW1lbnQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1lbWJlcjsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlm\naWVyOwppbXBvcnQgamF2YS5uZXQuVVJJU3ludGF4RXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uZXQuVVJMOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQg\namF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7Cgpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQWNjZXNzOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuQWNjZXNzVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLkJhc2ljOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQ2FjaGVhYmxl\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FbGVtZW50Q29sbGVjdGlvbjsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGFibGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5FbWJlZGRlZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLkVtYmVkZGVkSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnRpdHk7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnRpdHlMaXN0ZW5lcnM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlRGVmYXVsdExpc3RlbmVy\nczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkV4Y2x1ZGVTdXBlcmNsYXNz\nTGlzdGVuZXJzOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmV0Y2hUeXBl\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmx1c2hNb2RlVHlwZTsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLkdlbmVyYXRlZFZhbHVlOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuR2VuZXJhdGlvblR5cGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLklk\nQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Mb2NrTW9kZVR5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwS2V5\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwS2V5Q2xhc3M7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBwZWRTdXBlcmNsYXNzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTWFwc0lkOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuTmFtZWROYXRpdmVRdWVyaWVzOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuTmFtZWROYXRpdmVRdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLk5hbWVkUXVlcmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5h\nbWVkUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PbmVUb01hbnk7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PbmVUb09uZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLk9yZGVyQnk7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5Qb3N0TG9hZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBvc3RQ\nZXJzaXN0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFJlbW92ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBvc3RVcGRhdGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5QcmVQZXJzaXN0OwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuUHJlUmVtb3ZlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nUHJlVXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUXVlcnlIaW50\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU2VxdWVuY2VHZW5lcmF0b3I7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5WZXJzaW9uOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuQmVhbkxpZmVjeWNsZUNh\nbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZl\nY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZl\nbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZXZlbnQuTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuanBxbC5KUFFMUGFyc2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25z\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRyYWNrZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQWNjZXNz\nQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5EZWxlZ2F0\naW5nTWV0YURhdGFGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkxpZmVjeWNsZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuTWV0YURhdGFNb2RlczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLk9yZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuUXVlcnlNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5VcGRhdGVTdHJhdGVnaWVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2Vy\nRXhjZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAq\nIFBlcnNpc3RlbmNlIGFubm90YXRpb24gbWV0YWRhdGEgcGFyc2VyLiBDdXJy\nZW50bHkgZG9lcyBub3QgcGFyc2UKICogZGVwbG95bWVudCBkZXNjcmlwdG9y\ncy4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQGF1dGhvciBTdGV2ZSBL\naW0KICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEFubm90YXRpb25Q\nZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2VyCiAgICBpbXBsZW1lbnRzIE1ldGFE\nYXRhTW9kZXMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQW5ub3Rh\ndGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIuY2xhc3MpOwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIE1hcDxDbGFzczw/PiwgTWV0YURhdGFUYWc+\nIF90YWdzID0KICAgICAgICBuZXcgSGFzaE1hcDxDbGFzczw/PiwgTWV0YURh\ndGFUYWc+KCk7CgogICAgc3RhdGljIHsKICAgICAgICBfdGFncy5wdXQoQWNj\nZXNzLmNsYXNzLCBBQ0NFU1MpOwogICAgICAgIF90YWdzLnB1dChDYWNoZWFi\nbGUuY2xhc3MsIENBQ0hFQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KEVtYmVk\nZGVkSWQuY2xhc3MsIEVNQkVEREVEX0lEKTsKICAgICAgICBfdGFncy5wdXQo\nRW50aXR5TGlzdGVuZXJzLmNsYXNzLCBFTlRJVFlfTElTVEVORVJTKTsKICAg\nICAgICBfdGFncy5wdXQoRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnMuY2xhc3Ms\nIEVYQ0xVREVfREVGQVVMVF9MSVNURU5FUlMpOwogICAgICAgIF90YWdzLnB1\ndChFeGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVycy5jbGFzcywKICAgICAgICAg\nICAgRVhDTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUyk7CiAgICAgICAgX3Rh\nZ3MucHV0KEZsdXNoTW9kZVR5cGUuY2xhc3MsIEZMVVNIX01PREUpOwogICAg\nICAgIF90YWdzLnB1dChHZW5lcmF0ZWRWYWx1ZS5jbGFzcywgR0VORVJBVEVE\nX1ZBTFVFKTsKICAgICAgICBfdGFncy5wdXQoSWQuY2xhc3MsIElEKTsKICAg\nICAgICBfdGFncy5wdXQoSWRDbGFzcy5jbGFzcywgSURfQ0xBU1MpOwogICAg\nICAgIF90YWdzLnB1dChNYXBLZXkuY2xhc3MsIE1BUF9LRVkpOwogICAgICAg\nIF90YWdzLnB1dChNYXBLZXlDbGFzcy5jbGFzcywgTUFQX0tFWV9DTEFTUyk7\nCiAgICAgICAgX3RhZ3MucHV0KE1hcHNJZC5jbGFzcywgTUFQUEVEX0JZX0lE\nKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVyaWVzLmNsYXNz\nLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0KE5hbWVkTmF0\naXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAgICAgX3RhZ3Mu\ncHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAgICAgICAgX3Rh\nZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAgICAgICBfdGFn\ncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAgICAgIF90YWdz\nLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAgICAgICBfdGFn\ncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lTVCk7CiAgICAg\nICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1RfUkVNT1ZFKTsK\nICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywgUE9TVF9VUERB\nVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNsYXNzLCBQUkVf\nUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92ZS5jbGFzcywg\nUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVwZGF0ZS5jbGFz\ncywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNlcXVlbmNlR2Vu\nZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAgICBfdGFncy5w\ndXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAgX3RhZ3MucHV0\nKERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAgICAgX3RhZ3Mu\ncHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQpOwogICAgICAg\nIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVOVCk7CiAgICAg\nICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERFVEFDSEVEX1NU\nQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVuZGVudC5jbGFz\ncywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50\nVHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFncy5wdXQoRXh0\nZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwogICAgICAgIF90\nYWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFMSVpFUik7CiAg\nICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RPUlkpOwogICAg\nICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRDSF9HUk9VUCk7\nCiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNzLCBGRVRDSF9H\nUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9naWNhbC5jbGFz\ncywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5wdXQoS2V5RGVw\nZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAgIF90YWdzLnB1\ndChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9HUk9VUCk7CiAg\nICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAgICAgICBfdGFn\ncy5wdXQoTWFuYWdlZEludGVyZmFjZS5jbGFzcywgTUFOQUdFRF9JTlRFUkZB\nQ0UpOwogICAgICAgIF90YWdzLnB1dChSZWFkT25seS5jbGFzcywgUkVBRF9P\nTkxZKTsKICAgICAgICBfdGFncy5wdXQoVHlwZS5jbGFzcywgVFlQRSk7CiAg\nICAgICAgX3RhZ3MucHV0KFJlcGxpY2F0ZWQuY2xhc3MsIFJFUExJQ0FURUQp\nOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gX2NvbmY7CiAgICBwcml2YXRlIGZpbmFsIExvZyBfbG9nOwogICAgcHJp\ndmF0ZSBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zID0gbnVsbDsKICAgIHBy\naXZhdGUgQ2xhc3NMb2FkZXIgX2VudkxvYWRlciA9IG51bGw7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX292ZXJyaWRlID0gZmFsc2U7CiAgICBwcml2YXRlIGlu\ndCBfbW9kZSA9IE1PREVfTk9ORTsKCiAgICAvLyBwYWNrYWdlcyBhbmQgdGhl\naXIgcGFyc2UgbW9kZXMKICAgIHByaXZhdGUgZmluYWwgTWFwPFBhY2thZ2Us\nIEludGVnZXI+IF9wa2dzID0gbmV3IEhhc2hNYXA8UGFja2FnZSwgSW50ZWdl\ncj4oKTsKCiAgICAvLyB0aGUgY2xhc3Mgd2Ugd2VyZSBpbnZva2VkIHRvIHBh\ncnNlCiAgICBwcm90ZWN0ZWQgQ2xhc3M8Pz4gX2NscyA9IG51bGw7CiAgICBw\ncm90ZWN0ZWQgU3RhY2s8Q2xhc3M8Pz4+IF9zdGFjayA9IG5ldyBTdGFjazxD\nbGFzczw/Pj4oKTsKICAgIHByaXZhdGUgRmlsZSBfZmlsZSA9IG51bGw7Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvcjsgc3VwcGx5IGNvbmZpZ3VyYXRp\nb24uCiAgICAgKi8KICAgIHB1YmxpYyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VN\nZXRhRGF0YVBhcnNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mKSB7CiAg\nICAgICAgX2NvbmYgPSBjb25mOwogICAgICAgIF9sb2cgPSBjb25mLmdldExv\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfTUVUQURBVEEpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29uZmlndXJhdGlvbiBzdXBwbGllZCBvbiBjb25z\ndHJ1Y3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJh\ndGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29u\nZjsKICAgIH0KCiAgICAvKioKICAgICAqIE1ldGFkYXRhIGxvZy4KICAgICAq\nLwogICAgcHVibGljIExvZyBnZXRMb2coKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2c7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSByZXBvc2l0\nb3J5IGZvciB0aGlzIHBhcnNlci4gSWYgbm9uZSBoYXMgYmVlbiBzZXQsCiAg\nICAgKiBjcmVhdGUgYSBuZXcgcmVwb3NpdG9yeSBhbmQgc2V0cyBpdC4KICAg\nICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0\nb3J5KCkgewogICAgICAgIGlmIChfcmVwb3MgPT0gbnVsbCkgewogICAgICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi5uZXdNZXRh\nRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICBNZXRhRGF0\nYUZhY3RvcnkgbWRmID0gcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCk7CiAg\nICAgICAgICAgIGlmIChtZGYgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nTWV0YURh\ndGFGYWN0b3J5KQogICAgICAgICAgICAgICAgbWRmID0gKChEZWxlZ2F0aW5n\nTWV0YURhdGFGYWN0b3J5KSBtZGYpLmdldElubmVybW9zdERlbGVnYXRlKCk7\nCiAgICAgICAgICAgIGlmIChtZGYgaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZU1l\ndGFEYXRhRmFjdG9yeSkKICAgICAgICAgICAgICAgICgoUGVyc2lzdGVuY2VN\nZXRhRGF0YUZhY3RvcnkpIG1kZikuc2V0QW5ub3RhdGlvblBhcnNlcih0aGlz\nKTsKICAgICAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIG1ldGFkYXRhIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXBvc2l0b3J5KE1ldGFEYXRhUmVw\nb3NpdG9yeSByZXBvcykgewogICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBlbnZpcm9ubWVudGFsIGNs\nYXNzIGxvYWRlciB0byBwYXNzIG9uIHRvIHBhcnNlZAogICAgICogbWV0YWRh\ndGEgaW5zdGFuY2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIg\nZ2V0RW52Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9lbnZMb2Fk\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGVudmlyb25tZW50\nYWwgY2xhc3MgbG9hZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2VkCiAgICAgKiBt\nZXRhZGF0YSBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEVudkNsYXNzTG9hZGVyKENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAg\nIF9lbnZMb2FkZXIgPSBsb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRvIGFsbG93IGxhdGVyIHBhcnNlcyBvZiBtYXBwaW5nIGluZm9y\nbWF0aW9uIHRvIG92ZXJyaWRlCiAgICAgKiBlYXJsaWVyIGluZm9ybWF0aW9u\nIGZvciB0aGUgc2FtZSBjbGFzcy4gRGVmYXVsdHMgdG8gZmFsc2UuIFVzZWZ1\nbAogICAgICogd2hlbiBhIHRvb2wgaXMgbWFwcGluZyBhIGNsYXNzLCBzbyB0\naGF0IGFubm90YXRpb24gcGFydGlhbCBtYXBwaW5nCiAgICAgKiBpbmZvcm1h\ndGlvbiBjYW4gYmUgdXNlZCBldmVuIHdoZW4gbWFwcGluZ3MgYXJlIHN0b3Jl\nZCBpbiBhbm90aGVyCiAgICAgKiBsb2NhdGlvbi4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0TWFwcGluZ092ZXJyaWRlKCkgewogICAgICAgIHJl\ndHVybiBfb3ZlcnJpZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRvIGFsbG93IGxhdGVyIHBhcnNlcyBvZiBtYXBwaW5nIGluZm9ybWF0aW9u\nIHRvIG92ZXJyaWRlCiAgICAgKiBlYXJsaWVyIGluZm9ybWF0aW9uIGZvciB0\naGUgc2FtZSBjbGFzcy4gRGVmYXVsdHMgdG8gZmFsc2UuIFVzZWZ1bAogICAg\nICogd2hlbiBhIHRvb2wgaXMgbWFwcGluZyBhIGNsYXNzLCBzbyB0aGF0IGFu\nbm90YXRpb24gcGFydGlhbCBtYXBwaW5nCiAgICAgKiBpbmZvcm1hdGlvbiBj\nYW4gYmUgdXNlZCBldmVuIHdoZW4gbWFwcGluZ3MgYXJlIHN0b3JlZCBpbiBh\nbm90aGVyCiAgICAgKiBsb2NhdGlvbi4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0TWFwcGluZ092ZXJyaWRlKGJvb2xlYW4gb3ZlcnJpZGUpIHsKICAg\nICAgICBfb3ZlcnJpZGUgPSBvdmVycmlkZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBwYXJzZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9tb2RlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldE1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBp\nZiAobW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIF9tb2RlID0gTU9E\nRV9OT05FOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfbW9k\nZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX21vZGUgJj0g\nfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9kZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSkgewog\nICAgICAgIF9tb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0\nTW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWV0YURh\ndGFNb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX01FVEEp\nICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRo\nb2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1ZXJ5TW9kZSgpIHsKICAgICAg\nICByZXR1cm4gKF9tb2RlICYgTU9ERV9RVUVSWSkgIT0gMDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0\naW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIGlzTWFwcGluZ01vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9k\nZSAmIE1PREVfTUFQUElORykgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgdHJ1ZSBpZiB3ZSdyZSBpbiBtYXBwaW5nIG1vZGUgb3IgaW4g\nbWV0YWRhdGEgbW9kZSB3aXRoCiAgICAgKiBtYXBwaW5nIG92ZXJpZGUgZW5h\nYmxlZC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5n\nT3ZlcnJpZGVNb2RlKCkgewogICAgICAgIHJldHVybiBpc01hcHBpbmdNb2Rl\nKCkgfHwgKF9vdmVycmlkZSAmJiBpc01ldGFEYXRhTW9kZSgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgY2xlYXIoKSB7CiAgICAJX3N0YWNrLmNsZWFyKCk7CiAgICAg\nICAgX2NscyA9IG51bGw7CiAgICAgICAgX2ZpbGUgPSBudWxsOwogICAgICAg\nIF9wa2dzLmNsZWFyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBw\nZXJzaXN0ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBwYXJzZShDbGFzczw/PiBjbHMpIHsKICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1jbGFzcyIsIGNscy5nZXROYW1l\nKCkpKTsKCiAgICAgICAgX2NscyA9IGNsczsKICAgICAgICBfc3RhY2sucHVz\naChjbHMpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcnNlUGFja2Fn\nZUFubm90YXRpb25zKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYSA9IHBhcnNlQ2xhc3NBbm5vdGF0aW9ucygpOwogICAgICAgICAgICB1cGRh\ndGVTb3VyY2VNb2RlKG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgCV9zdGFjay5wb3AoKTsKICAgICAgICAgICAgX2NscyA9IF9zdGFjay5p\nc0VtcHR5KCkgPyBudWxsIDogX3N0YWNrLnBlZWsoKTsKICAgICAgICAgICAg\nX2ZpbGUgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFVwZGF0ZSB0aGUgc291cmNlIG1vZGUgdG8gdGhlIGNsYXNzIHBhY2thZ2Ug\nYW5kIGNsYXNzIHRvIGluZGljYXRlIHRoYXQKICAgICAqIHdlJ3ZlIGZ1bGx5\nIHBhcnNlZCB0aGVtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdXBkYXRl\nU291cmNlTW9kZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAo\nX2Nscy5nZXRQYWNrYWdlKCkgIT0gbnVsbCkKICAgICAgICAgICAgYWRkU291\ncmNlTW9kZShfY2xzLmdldFBhY2thZ2UoKSwgX21vZGUpOwogICAgICAgIGlm\nIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9k\nZShfbW9kZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBp\nbmZvcm1hdGlvbiBpbiBwYWNrYWdlLWxldmVsIGNsYXNzIGFubm90YXRpb25z\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQYWNrYWdlQW5ub3Rh\ndGlvbnMoKSB7CiAgICAgICAgUGFja2FnZSBwa2cgPSBfY2xzLmdldFBhY2th\nZ2UoKTsKICAgICAgICBpZiAocGtnID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgaW50IHBrZ01vZGUgPSBnZXRTb3VyY2VNb2RlKHBr\nZyk7CiAgICAgICAgaWYgKHBrZ01vZGUgPT0gMCAmJiBfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBh\ncnNlLXBhY2thZ2UiLCBfY2xzLmdldE5hbWUoKSkpOwogICAgICAgIGlmICgo\ncGtnTW9kZSAmIF9tb2RlKSA9PSBfbW9kZSkgLy8gYWxyZWFkeSB2aXNpdGVk\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWV0YURhdGFUYWcgdGFn\nOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogcGtnLmdldERlY2xh\ncmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5n\nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRh\nZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duUGFj\na2FnZUFubm90YXRpb24ocGtnLCBhbm5vKTsKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRh\nZykgewogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVfUVVFUklFUzoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9k\nZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKHBrZywKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICgoTmFtZWROYXRpdmVRdWVyaWVzKSBhbm5vKS52YWx1\nZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgTkFUSVZFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9RVUVSWSkgPT0g\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5hdGl2ZVF1\nZXJpZXMocGtnLCAoTmFtZWROYXRpdmVRdWVyeSkgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJJ\nRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYg\nKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYXJzZU5hbWVkUXVlcmllcyhwa2csICgoTmFtZWRRdWVyaWVz\nKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgUVVFUlk6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZ\nKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkUXVl\ncmllcyhwa2csIChOYW1lZFF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVSQVRP\nUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVN\nb2RlKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgKHBrZ01vZGUgJiBN\nT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlU2VxdWVuY2VHZW5lcmF0b3IocGtnLCAoU2VxdWVuY2VHZW5lcmF0b3Ip\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVkIiwg\ncGtnLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYWx3YXlz\nIHBhcnNlIG1hcHBpbmcgc3R1ZmYgYWZ0ZXIgbWV0YWRhdGEgc3R1ZmYsIGlu\nIGNhc2UgdGhlcmUgYXJlCiAgICAgICAgLy8gZGVwZW5kZW5jaWVzIG9uIG1l\ndGFkYXRhCiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYm\nIChwa2dNb2RlICYgTU9ERV9NQVBQSU5HKSA9PSAwKQogICAgICAgICAgICBw\nYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbnMocGtnKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIHBhY2thZ2UgbWFwcGluZyBhbm5vdGF0aW9u\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VQYWNrYWdlTWFw\ncGluZ0Fubm90YXRpb25zKFBhY2thZ2UgcGtnKSB7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFu\nbm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5k\nbGVVbmtub3duUGFja2FnZUFubm90YXRpb24oUGFja2FnZSBwa2csCiAgICAg\nICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIGZvciB0aGUg\nZ2l2ZW4gcGFja2FnZS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0U291\ncmNlTW9kZShQYWNrYWdlIHBrZykgewogICAgICAgIE51bWJlciBudW0gPSBf\ncGtncy5nZXQocGtnKTsKICAgICAgICByZXR1cm4gKG51bSA9PSBudWxsKSA/\nIDAgOiBudW0uaW50VmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0byB0aGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZlbiBwYWNrYWdlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU291cmNlTW9kZShQYWNrYWdl\nIHBrZywgaW50IG1vZGUpIHsKICAgICAgICBJbnRlZ2VyIG51bSA9IF9wa2dz\nLmdldChwa2cpOwogICAgICAgIGlmIChudW0gPT0gbnVsbCkKICAgICAgICAg\nICAgbnVtID0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG51bSA9\nIG51bS5pbnRWYWx1ZSgpIHwgbW9kZTsKICAgICAgICBfcGtncy5wdXQocGtn\nLCBudW0pOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCBhbm5vdGF0aW9u\ncyBmb3IgdGhlIGN1cnJlbnQgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBD\nbGFzc01ldGFEYXRhIHBhcnNlQ2xhc3NBbm5vdGF0aW9ucygpIHsKICAgICAg\nICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUgaXMgY2FjaGVkIG1ldGFkYXRh\nIGZvciB0aGUgY2xhc3MgdGhhdCB3ZSBhcmUgY3VycmVudGx5IHBhcnNpbmcu\nIEl0CiAgICAgICAgLy8gaXMgcG9zc2libGUgdGhhdCBvbmUgb2YgdGhlIGFu\nbm90YXRpb25zIChFbnRpdHksIEVtYmVkZGFibGUsIE1hcHBlZFN1cGVyY2xh\nc3MpIGlzIGluIHRoZQogICAgICAgIC8vIG9ybS54bWwuIFdlIHN0aWxsIG5l\nZWQgdG8gbG9vayBhdCB0aGVzZSBmaWxlcyBmb3Igb3RoZXIgYW5ub3RhdGlv\nbnMgYW5kIG1vcmUgaW1wb3J0YW50bHkKICAgICAgICAvLyBzZXR1cCBkZWZh\ndWx0cyAoaWU6IEJhc2ljIGZpZWxkcykuCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZE1ldGFEYXRhKF9jbHMp\nOwogICAgICAgIGlmIChtID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKCEo\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIu\naXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihfY2xzLCBFbnRpdHkuY2xhc3Mp\nKSkKICAgICAgICAgICAgICAgIC5ib29sZWFuVmFsdWUoKQogICAgICAgICAg\nICAgICAgJiYgIShBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRv\nUHJpdkhlbHBlci5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKF9jbHMsIEVt\nYmVkZGFibGUuY2xhc3MpKSkKICAgICAgICAgICAgICAgICAgICAuYm9vbGVh\nblZhbHVlKCkKICAgICAgICAgICAgICAgICYmICEoQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIuaXNBbm5vdGF0aW9uUHJl\nc2VudEFjdGlvbihfY2xzLAogICAgICAgICAgICAgICAgICAgIE1hcHBlZFN1\ncGVyY2xhc3MuY2xhc3MpKSkuYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgLy8gZmluZCAv\nIGNyZWF0ZSBtZXRhZGF0YQogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIChtID09IG51bGwpID8gZ2V0TWV0YURhdGEoKSA6IG07CiAgICAgICAgaWYg\nKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIEVudGl0eSBlbnRpdHkgPSBfY2xzLmdldEFubm90YXRpb24oRW50aXR5\nLmNsYXNzKTsKICAgICAgICBNYXBwZWRTdXBlcmNsYXNzIG1hcHBlZCA9IF9j\nbHMuZ2V0QW5ub3RhdGlvbihNYXBwZWRTdXBlcmNsYXNzLmNsYXNzKTsKICAg\nICAgICBFbWJlZGRhYmxlIGVtYmVkZGFibGUgPSBfY2xzLmdldEFubm90YXRp\nb24oRW1iZWRkYWJsZS5jbGFzcyk7CiAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpIHsKICAgICAgICAgICAgbWV0YS5zZXRBYnN0cmFjdChtYXBwZWQg\nIT0gbnVsbCk7CiAgICAgICAgICAgIGlmIChlbWJlZGRhYmxlICE9IG51bGwp\nIG1ldGEuc2V0RW1iZWRkYWJsZSgpOwogICAgICAgICAgICAvLyB3aGlsZSB0\naGUgc3BlYyBvbmx5IHByb3ZpZGVzIGZvciBlbWJlZGRlZCBleGNsdXNpdmUs\nIGl0IGRvZXNuJ3QKICAgICAgICAgICAgLy8gc2VlbSBoYXJkIHRvIHN1cHBv\ncnQgb3RoZXJ3aXNlCiAgICAgICAgICAgIGlmIChlbnRpdHkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1iZWRkZWRPbmx5KHRydWUpOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1i\nZWRkZWRPbmx5KGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShlbnRpdHkubmFtZSgpKSkKICAgICAgICAgICAgICAg\nICAgICBtZXRhLnNldFR5cGVBbGlhcyhlbnRpdHkubmFtZSgpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gdHJhY2sgZmV0Y2ggZ3Jv\ndXBzIHRvIHBhcnNlIHRoZW0gYWZ0ZXIgZmllbGRzLCBzaW5jZSB0aGV5CiAg\nICAgICAgLy8gcmVseSBvbiBmaWVsZCBtZXRhZGF0YQogICAgICAgIEZldGNo\nR3JvdXBbXSBmZ3MgPSBudWxsOwogICAgICAgIERldGFjaGVkU3RhdGUgZGV0\nYWNoZWQgPSBudWxsOwoKICAgICAgICAvLyB0cmFjayBsaXN0ZW5lcnMgc2lu\nY2Ugd2UgbmVlZCB0byBtZXJnZSB0aGVtIHdpdGggZW50aXR5IGNhbGxiYWNr\ncwogICAgICAgIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGxp\nc3RlbmVycyA9IG51bGw7CiAgICAgICAgTWV0YURhdGFUYWcgdGFnOwogICAg\nICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogX2Nscy5nZXREZWNsYXJlZEFu\nbm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFu\nbm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93bkNsYXNzQW5u\nb3RhdGlvbihtZXRhLCBhbm5vKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRhZykgewog\nICAgICAgICAgICAgICAgY2FzZSBFTlRJVFlfTElTVEVORVJTOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBsaXN0ZW5lcnMgPSBwYXJzZUVudGl0eUxpc3RlbmVy\ncyhtZXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKEVudGl0eUxp\nc3RlbmVycykgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEVYQ0xVREVfREVGQVVMVF9MSVNURU5FUlM6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0TGlmZWN5Y2xlTWV0YURh\ndGEoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldElnbm9yZVN5\nc3RlbUxpc3RlbmVycyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRVhDTFVERV9TVVBFUkNMQVNTX0xJ\nU1RFTkVSUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRMaWZlY3lj\nbGVNZXRhRGF0YSgpLnNldElnbm9yZVN1cGVyY2xhc3NDYWxsYmFja3MKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIChMaWZlY3ljbGVNZXRhRGF0YS5J\nR05PUkVfSElHSCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHdhcm5GbHVzaE1vZGUobWV0YSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElEX0NMQVNTOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhLnNldE9iamVjdElkVHlwZSgoKElkQ2xhc3Mp\nIGFubm8pLnZhbHVlKCksIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVfUVVFUklFUzoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAobWV0YS5n\nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKT09MCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMoX2NscywKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICgoTmFtZWROYXRpdmVRdWVyaWVz\nKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FVRVJZOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChtZXRhLmdldFNvdXJj\nZU1vZGUoKSAmIE1PREVfUVVFUlkpPT0wKQogICAgICAgICAgICAgICAgICAg\nICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhfY2xzLCAoTmFtZWROYXRp\ndmVRdWVyeSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFFVRVJJRVM6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgp\nICYgTU9ERV9RVUVSWSk9PTApCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlTmFtZWRRdWVyaWVzKF9jbHMsICgoTmFtZWRRdWVyaWVzKSBhbm5vKS52\nYWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nUXVlcnlNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9R\nVUVSWSk9PTApCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRR\ndWVyaWVzKF9jbHMsIChOYW1lZFF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVS\nQVRPUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJp\nZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlU2VxdWVu\nY2VHZW5lcmF0b3IoX2NscywgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgREFUQV9DQUNIRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRh\nQ2FjaGUobWV0YSwgKERhdGFDYWNoZSkgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERBVEFTVE9SRV9J\nRDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhU3RvcmVJZChtZXRh\nLCAoRGF0YVN0b3JlSWQpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBERVRBQ0hFRF9TVEFURToKICAg\nICAgICAgICAgICAgICAgICBkZXRhY2hlZCA9IChEZXRhY2hlZFN0YXRlKSBh\nbm5vOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBGRVRDSF9HUk9VUDoKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZmdz\nID0gbmV3IEZldGNoR3JvdXBbXXsgKEZldGNoR3JvdXApIGFubm8gfTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRkVUQ0hfR1JPVVBTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmZ3MgPSAoKEZl\ndGNoR3JvdXBzKSBhbm5vKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQU5BR0VEX0lOVEVSRkFD\nRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VNYW5hZ2VkSW50ZXJmYWNl\nKG1ldGEsIChNYW5hZ2VkSW50ZXJmYWNlKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUkVQTElDQVRF\nRDoKICAgICAgICAgICAgICAgIAltZXRhLnNldFJlcGxpY2F0ZWQodHJ1ZSk7\nCiAgICAgICAgICAgICAgICAJYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEFDQ0VTUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VBY2Nlc3MobWV0\nYSwgKEFjY2Vzcylhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQ0FDSEVBQkxFOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHBhcnNlQ2FjaGUobWV0YSwgKENhY2hlYWJsZSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQo\nInVuc3VwcG9ydGVkIiwgX2NscywKICAgICAgICAgICAgICAgICAgICAgICAg\nYW5uby50b1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIHBh\ncnNlRGV0YWNoZWRTdGF0ZShtZXRhLCBkZXRhY2hlZCk7CgogICAgICAgICAg\nICAvLyBtZXJnZSBjYWxsYmFjayBtZXRob2RzIHdpdGggZGVjbGFyZWQgbGlz\ndGVuZXJzCiAgICAgICAgICAgIGludFtdIGhpZ2hzID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKGxpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBoaWdocyA9IG5ldyBpbnRbbGlzdGVuZXJzLmxlbmd0aF07CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzW2ldID0gbGlz\ndGVuZXJzW2ldLnNpemUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZWNvcmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2Ns\ncywgbGlzdGVuZXJzLCBmYWxzZSwKICAgICAgICAgICAgICAgIGZhbHNlLCBn\nZXRSZXBvc2l0b3J5KCkpLCBoaWdocywgZmFsc2UpOwoKICAgICAgICAgICAg\nLy8gc2NhbiBwb3NzaWJseSBub24tUEMgaGllcmFyY2h5IGZvciBjYWxsYmFj\na3MuCiAgICAgICAgICAgIC8vIHJlZHVuZGFudCBmb3IgUEMgc3VwZXJjbGFz\ncyBidXQgd2UgZG9uJ3Qga25vdyB0aGF0IHlldAogICAgICAgICAgICAvLyBz\nbyBsZXQgTGlmZWN5Y2xlTWV0YURhdGEgZGV0ZXJtaW5lIHRoYXQKICAgICAg\nICAgICAgaWYgKF9jbHMuZ2V0U3VwZXJjbGFzcygpICE9IG51bGwgJiYKICAg\nICAgICAgICAgICAgICFPYmplY3QuY2xhc3MuZXF1YWxzKF9jbHMuZ2V0U3Vw\nZXJjbGFzcygpKSkgewogICAgICAgICAgICAgICAgcmVjb3JkQ2FsbGJhY2tz\nKG1ldGEsIHBhcnNlQ2FsbGJhY2tNZXRob2RzKF9jbHMuZ2V0U3VwZXJjbGFz\ncygpLAogICAgICAgICAgICAgICAgICAgIG51bGwsIHRydWUsIGZhbHNlLCBn\nZXRSZXBvc2l0b3J5KCkpLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1l\ndGEuZ2V0RGVjbGFyZWRGaWVsZHMoKSkKICAgICAgICAgICAgaWYgKGZtZC5n\nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgICAgIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMo\nZm1kKTsKICAgICAgICAvLyBwYXJzZSBmZXRjaCBncm91cHMgYWZ0ZXIgZmll\nbGRzCiAgICAgICAgaWYgKGZncyAhPSBudWxsKQogICAgICAgICAgICBwYXJz\nZUZldGNoR3JvdXBzKG1ldGEsIGZncyk7CgogICAgICAgIC8vIGFsd2F5cyBw\nYXJzZSBtYXBwaW5nIGFmdGVyIG1ldGFkYXRhIGluIGNhc2UgdGhlcmUgYXJl\nIGRlcGVuZGVuY2llcwogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1v\nZGUoKSkgewogICAgICAgICAgICBwYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRp\nb25zKG1ldGEpOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1k\nIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKQogICAgICAgICAgICAgICAg\naWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5B\nR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBwYXJzZU1lbWJl\nck1hcHBpbmdBbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZXhw\nbGljaXQgYWNjZXNzIHR5cGUsIGlmIHNwZWNpZmllZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlQWNjZXNzKENsYXNzTWV0YURhdGEgbWV0YSwg\nQWNjZXNzIGFjY2VzcykgewogICAgCWlmIChhY2Nlc3MgIT0gbnVsbCkgewog\nICAgCQltZXRhLnNldEFjY2Vzc1R5cGUoQWNjZXNzQ29kZS5FWFBMSUNJVAog\nICAgICAgICAgICB8IChhY2Nlc3MudmFsdWUoKSA9PSBBY2Nlc3NUeXBlLkZJ\nRUxEID8KICAgICAgICAgICAgCUFjY2Vzc0NvZGUuRklFTEQgOiBBY2Nlc3ND\nb2RlLlBST1BFUlRZKSk7CiAgICAJfQogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgY2xhc3MgbWFwcGluZyBhbm5vdGF0aW9ucy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgcGFyc2VDbGFzc01hcHBpbmdBbm5vdGF0aW9ucyhD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEFs\nbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25D\nbGFzc0Fubm90YXRpb24oQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEFu\nbm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEZpbmQgb3IgY3JlYXRlIG1ldGFkYXRhIGZvciB0\naGUgZ2l2ZW4gdHlwZS4gTWF5IHJldHVybiBudWxsIGlmCiAgICAgKiB0aGlz\nIGNsYXNzIGhhcyBhbHJlYWR5IGJlZW4gcGFyc2VkIGZ1bGx5LgogICAgICov\nCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdl\ndENhY2hlZE1ldGFEYXRhKF9jbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51\nbGwgJiYKICAgICAgICAgICAgKChpc01ldGFEYXRhTW9kZSgpICYmIChtZXRh\nLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCkgfHwKICAgICAg\nICAgICAgICAgIChpc01hcHBpbmdNb2RlKCkgJiYKICAgICAgICAgICAgICAg\nICAgICAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01BUFBJTkcpICE9\nIDApKSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImR1cC1tZXRh\nZGF0YSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewog\nICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZE1ldGFEYXRh\nKF9jbHMsIGdldEFjY2Vzc0NvZGUoX2NscykpOwogICAgICAgICAgICBtZXRh\nLnNldEVudkNsYXNzTG9hZGVyKF9lbnZMb2FkZXIpOwogICAgICAgICAgICBt\nZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9OT05FKTsKICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2UoZ2V0U291cmNlRmlsZSgpLCBTb3VyY2VUcmFja2VyLlNS\nQ19BTk5PVEFUSU9OUyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtZXRh\nOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgZXhwbGljaXQgYWNj\nZXNzIGZvciB0aGUgY2xhc3MsIGlmIGFueS4KICAgICAqIEV4cGxpY2l0IGFj\nY2VzcyB0eXBlIHNwZWNpZmljYXRpb24gZG9lcyBub3QgYWZmZWN0IHRoZSBh\nY2Nlc3MgdHlwZSBvZgogICAgICogb3RoZXIgZW50aXR5IGNsYXNzZXMgb3Ig\nbWFwcGVkIHN1cGVyIGNsYXNzZXMgaW4gdGhlIGVudGl0eSBoaWVyYXJjaHku\nCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldEFjY2Vzc0NvZGUoQ2xhc3M8\nPz4gY2xzKSB7CiAgICAgICAgaW50IGFjY2Vzc0NvZGUgPSBBY2Nlc3NDb2Rl\nLlVOS05PV047CiAgICAgICAgQWNjZXNzIGFjY2VzcyA9IEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXRBbm5vdGF0aW9uQWN0aW9uKGNscywgQWNjZXNzLmNsYXNzKSk7CiAg\nICAgICAgaWYgKGFjY2VzcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGFjY2Vz\nc0NvZGUgfD0gIEFjY2Vzc0NvZGUuRVhQTElDSVQgfAogICAgICAgICAgICAg\nICAgKGFjY2Vzcy52YWx1ZSgpID09IEFjY2Vzc1R5cGUuRklFTEQgPwogICAg\nICAgICAgICAgICAgQWNjZXNzQ29kZS5GSUVMRCA6IEFjY2Vzc0NvZGUuUFJP\nUEVSVFkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWNjZXNzQ29kZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgc291cmNlIGZp\nbGUgd2UncmUgcGFyc2luZy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpbGUg\nZ2V0U291cmNlRmlsZSgpIHsKICAgICAgICBpZiAoX2ZpbGUgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIF9maWxlOwoKICAgICAgICBDbGFzczw/PiBj\nbHMgPSBfY2xzOwogICAgICAgIHdoaWxlIChjbHMuZ2V0RW5jbG9zaW5nQ2xh\nc3MoKSAhPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0RW5jbG9z\naW5nQ2xhc3MoKTsKCiAgICAgICAgU3RyaW5nIHJzcmMgPSBTdHJpbmdVdGls\ncy5yZXBsYWNlKGNscy5nZXROYW1lKCksICIuIiwgIi8iKTsKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2Fk\nZXJBY3Rpb24oY2xzKSk7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQog\nICAgICAgICAgICBsb2FkZXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldFN5c3Rl\nbUNsYXNzTG9hZGVyQWN0aW9uKCkpOwogICAgICAgIGlmIChsb2FkZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgVVJMIHVy\nbCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXRSZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJz\ncmMgKyAiLmphdmEiKSk7CiAgICAgICAgaWYgKHVybCA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHVybCA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0UmVzb3VyY2VB\nY3Rpb24obG9hZGVyLCByc3JjICsgIi5jbGFzcyIpKTsKICAgICAgICAgICAg\naWYgKHVybCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9maWxlID0g\nbmV3IEZpbGUodXJsLnRvVVJJKCkpOwogICAgICAgIH0gY2F0Y2ggKFVSSVN5\nbnRheEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgfSBjYXRjaCAoSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uIGlhZSkgewogICAgICAgICAgICAvLyB0aGlzIGlz\nIHRocm93biB3aGVuIHRoZSBVUkkgaXMgbm9uLWhpZXJhcmNoaWNhbCAoYWth\nIEpCb3NzKQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpbGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YVN0b3JlSWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZURhdGFTdG9yZUlkKENsYXNzTWV0YURh\ndGEgbWV0YSwgRGF0YVN0b3JlSWQgaWQpIHsKICAgICAgICBtZXRhLnNldElk\nZW50aXR5VHlwZShDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSk7CgogICAg\nICAgIGludCBzdHJhdCA9IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3kobWV0\nYSwgaWQuc3RyYXRlZ3koKSwKICAgICAgICAgICAgaWQuZ2VuZXJhdG9yKCkp\nOwogICAgICAgIGlmIChzdHJhdCAhPSAtMSkKICAgICAgICAgICAgbWV0YS5z\nZXRJZGVudGl0eVN0cmF0ZWd5KHN0cmF0KTsKICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgc3dpdGNoIChpZC5zdHJhdGVneSgpKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgY2FzZSBTRVFVRU5D\nRToKICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmljYWxseSB3ZSBzaG91\nbGQgaGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5kCiAgICAgICAgICAg\nICAgICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywgYnV0IGl0J3MgZWFz\naWVyIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAgICAgICAgIC8vIHRo\nZSBzeXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVlbmNlIHNldHRpbmcg\nZm9yIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShpZC5nZW5lcmF0b3IoKSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVN\nKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgICAgIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoaWQuZ2VuZXJh\ndG9yKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBBVVRPOgogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0\nSWRlbnRpdHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSURFTlRJVFk6CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0\neVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKGlkLnN0cmF0ZWd5KCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJuIHRoYXQg\nQEZsdXNoTW9kZSBpcyBub3Qgc3VwcG9ydGVkLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgd2FybkZsdXNoTW9kZShPYmplY3QgY29udGV4dCkgewogICAg\nICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsICJGbHVzaE1vZGUiLCBj\nb250ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YUNh\nY2hlLgogICAgICogCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZURh\ndGFDYWNoZShDbGFzc01ldGFEYXRhIG1ldGEsIERhdGFDYWNoZSBjYWNoZSkg\newogICAgICAgIGlmIChjYWNoZS50aW1lb3V0KCkgIT0gSW50ZWdlci5NSU5f\nVkFMVUUpIHsKICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVUaW1lb3V0\nKGNhY2hlLnRpbWVvdXQoKSk7CiAgICAgICAgfQogICAgICAgIFN0cmluZyBj\nYWNoZU5hbWUgPSBjYWNoZS5uYW1lKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkoY2FjaGVOYW1lKSkgewogICAgICAgICAgICBjYWNoZU5h\nbWUgPSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNoZS5O\nQU1FX0RFRkFVTFQ7CiAgICAgICAgfQogICAgICAgIG1ldGEuc2V0RGF0YUNh\nY2hlTmFtZShjYWNoZS5lbmFibGVkKCkgPyBjYWNoZU5hbWUgOiBudWxsKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYW5hZ2VkSW50ZXJmYWNl\nKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBNYW5hZ2VkSW50ZXJmYWNl\nIGlmYWNlKSB7CiAgICAgICAgbWV0YS5zZXRNYW5hZ2VkSW50ZXJmYWNlKHRy\ndWUpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQERldGFjaGVkU3Rh\ndGUuIFRoZSBhbm5vdGF0aW9uIG1heSBiZSBudWxsLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VEZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEg\nbWV0YSwKICAgICAgICBEZXRhY2hlZFN0YXRlIGRldGFjaGVkKSB7CiAgICAg\nICAgaWYgKGRldGFjaGVkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCFk\nZXRhY2hlZC5lbmFibGVkKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldERl\ndGFjaGVkU3RhdGUobnVsbCk7CiAgICAgICAgICAgIGVsc2UgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoZGV0YWNoZWQuZmllbGROYW1lKCkpKQogICAgICAg\nICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEu\nU1lOVEhFVElDKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nbWV0YS5zZXREZXRhY2hlZFN0YXRlKGRldGFjaGVkLmZpZWxkTmFtZSgpKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBGaWVsZFtdIGZpZWxkcyA9\nIChGaWVsZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkRmllbGRz\nQWN0aW9uKAogICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKChBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAg\nICAgICAgICAgICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGZpZWxk\nc1tpXSwgRGV0YWNoZWRTdGF0ZS5jbGFzcykpKQogICAgICAgICAgICAgICAg\nICAgIC5ib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICBtZXRh\nLnNldERldGFjaGVkU3RhdGUoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEVudGl0eUxpc3Rl\nbmVycwogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb248TGlmZWN5Y2xl\nQ2FsbGJhY2tzPltdIHBhcnNlRW50aXR5TGlzdGVuZXJzCiAgICAgICAgKENs\nYXNzTWV0YURhdGEgbWV0YSwgRW50aXR5TGlzdGVuZXJzIGxpc3RlbmVycykg\newogICAgICAgIENsYXNzPD8+W10gY2xhc3NlcyA9IGxpc3RlbmVycy52YWx1\nZSgpOwogICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IGxpc3RlbmVyQ29s\nbCA9IG51bGw7CiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFj\na3M+W10gcGFyc2VkID0gbnVsbDsKICAgICAgICBmb3IgKENsYXNzPD8+IGNs\ncyA6IGNsYXNzZXMpIHsKICAgICAgICAgICAgaWYgKCFfY29uZi5nZXRDYWxs\nYmFja09wdGlvbnNJbnN0YW5jZSgpLmdldEFsbG93c0R1cGxpY2F0ZUxpc3Rl\nbmVyKCkpIHsKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lckNvbGwgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lckNvbGwgPSBuZXcg\nQXJyYXlMaXN0PENsYXNzPD8+PigpOwogICAgICAgICAgICAgICAgaWYgKGxp\nc3RlbmVyQ29sbC5jb250YWlucyhjbHMpKSAKICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyQ29sbC5hZGQo\nY2xzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAg\ncGFyc2VkID0gcGFyc2VDYWxsYmFja01ldGhvZHMoY2xzLCBwYXJzZWQsIHRy\ndWUsIHRydWUsCiAgICAgICAgICAgICAgICBnZXRSZXBvc2l0b3J5KCkpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gcGFyc2VkOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgY2FsbGJhY2sgbWV0aG9kcyBpbnRvIHRoZSBnaXZl\nbiBhcnJheSwgYW5kIHJldHVybiB0aGF0IGFycmF5LAogICAgICogY3JlYXRp\nbmcgb25lIGlmIG51bGwuIEVhY2ggaW5kZXggaW50byB0aGUgYXJyYXkgaXMg\nYSBjb2xsZWN0aW9uIG9mCiAgICAgKiBjYWxsYmFjayBhZGFwdGVycyBmb3Ig\ndGhhdCBudW1lcmljIGV2ZW50IHR5cGUuCiAgICAgKgogICAgICogQHBhcmFt\nIHN1cHMgd2hldGhlciB0byBzY2FuIHN1cGVyY2xhc3NlcwogICAgICogQHBh\ncmFtIGxpc3RlbmVyIHdoZXRoZXIgdGhpcyBpcyBhIGxpc3RlbmVyIG9yIG5v\ndAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIENvbGxlY3Rpb248TGlmZWN5\nY2xlQ2FsbGJhY2tzPltdIHBhcnNlQ2FsbGJhY2tNZXRob2RzCiAgICAgICAg\nKENsYXNzPD8+IGNscywgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+\nW10gY2FsbGJhY2tzLCBib29sZWFuIHN1cHMsCiAgICAgICAgYm9vbGVhbiBs\naXN0ZW5lciwgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CgogICAgICAg\nIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbigiY2xzIGNhbm5vdCBiZSBudWxsIik7Cgog\nICAgICAgIC8vIGZpcnN0IHNvcnQgLyBmaWx0ZXIgYmFzZWQgb24gaW5oZXJp\ndGFuY2UKICAgICAgICBTZXQ8TWV0aG9kPiBtZXRob2RzID0gbmV3IFRyZWVT\nZXQ8TWV0aG9kPihNZXRob2RDb21wYXJhdG9yLgogICAgICAgICAgICBnZXRJ\nbnN0YW5jZSgpKTsKCiAgICAgICAgaW50IG1vZHM7CiAgICAgICAgQ2xhc3M8\nPz4gc3VwID0gY2xzOwogICAgICAgIE1ldGhvZEtleSBrZXk7CiAgICAgICAg\nU2V0PE1ldGhvZEtleT4gc2VlbiA9IG5ldyBIYXNoU2V0PE1ldGhvZEtleT4o\nKTsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGZvciAoTWV0aG9kIG0gOiAo\nTWV0aG9kW10pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2Rz\nQWN0aW9uKHN1cCkpKSB7CiAgICAgICAgICAgICAgICBtb2RzID0gbS5nZXRN\nb2RpZmllcnMoKTsKICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1N0\nYXRpYyhtb2RzKSB8fCBNb2RpZmllci5pc0ZpbmFsKG1vZHMpIHx8CiAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLmVxdWFscyhtLmdldERlY2xh\ncmluZ0NsYXNzKCkpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgIGtleSA9IG5ldyBNZXRob2RLZXkobSk7CiAgICAg\nICAgICAgICAgICBpZiAoIXNlZW4uY29udGFpbnMoa2V5KSkgewogICAgICAg\nICAgICAgICAgICAgIG1ldGhvZHMuYWRkKG0pOwogICAgICAgICAgICAgICAg\nICAgIHNlZW4uYWRkKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsK\nICAgICAgICB9IHdoaWxlIChzdXBzICYmICFPYmplY3QuY2xhc3MuZXF1YWxz\nKHN1cCkpOwoKICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0g\ncmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIGZvciAoTWV0aG9k\nIG0gOiBtZXRob2RzKSB7CiAgICAgICAgICAgIGZvciAoQW5ub3RhdGlvbiBh\nbm5vIDogKEFubm90YXRpb25bXSkgQWNjZXNzQ29udHJvbGxlcgogICAgICAg\nICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAg\nICAgICAgICAgICAgIC5nZXREZWNsYXJlZEFubm90YXRpb25zQWN0aW9uKG0p\nKSkgewogICAgICAgICAgICAgICAgTWV0YURhdGFUYWcgdGFnID0gX3RhZ3Mu\nZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgICAgICBp\nZiAodGFnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgICAgICBpbnRbXSBldmVudHMgPSBNZXRhRGF0YVBhcnNl\ncnMuZ2V0RXZlbnRUeXBlcyh0YWcsIGNvbmYpOwogICAgICAgICAgICAgICAg\naWYgKGV2ZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3MgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MgPSAoQ29sbGVjdGlvbjxM\naWZlY3ljbGVDYWxsYmFja3M+W10pCiAgICAgICAgICAgICAgICAgICAgICAg\nIG5ldyBDb2xsZWN0aW9uW0xpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMubGVu\nZ3RoXTsKCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV2\nZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGludCBl\nID0gZXZlbnRzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFj\na3NbZV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJh\nY2tzW2VdID0gbmV3IEFycmF5TGlzdDxMaWZlY3ljbGVDYWxsYmFja3M+KDMp\nOwogICAgICAgICAgICAgICAgICAgIE1ldGFEYXRhUGFyc2Vycy52YWxpZGF0\nZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2soY2xzLAogICAgICAgICAgICAgICAg\nICAgICAgICBjYWxsYmFja3NbZV0sIG0sIHRhZywgY29uZiwgcmVwb3MuZ2V0\nTG9nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewog\nICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0uYWRkKG5ldyBC\nZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzKGNscywgbSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLmFk\nZChuZXcgTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tzKG0sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmYWxzZSkpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gY2FsbGJhY2tzOwogICAgfQoKICAgIC8qKgogICAg\nICogU3RvcmUgbGlmZWN5Y2xlIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVjb3JkQ2FsbGJhY2tzKENsYXNzTWV0YURhdGEgY2xzLAog\nICAgICAgIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGNhbGxi\nYWNrcywgaW50W10gaGlnaHMsCiAgICAgICAgYm9vbGVhbiBzdXBlckNsYXNz\nKSB7CiAgICAgICAgaWYgKGNhbGxiYWNrcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgTGlmZWN5Y2xlTWV0YURhdGEgbWV0YSA9IGNs\ncy5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpOwogICAgICAgIExpZmVjeWNsZUNh\nbGxiYWNrc1tdIGFycmF5OwogICAgICAgIGZvciAoaW50IGV2ZW50IDogTGlm\nZWN5Y2xlRXZlbnQuQUxMX0VWRU5UUykgewogICAgICAgICAgICBpZiAoY2Fs\nbGJhY2tzW2V2ZW50XSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIGFycmF5ID0gY2FsbGJhY2tzW2V2ZW50XS50b0Fy\ncmF5CiAgICAgICAgICAgICAgICAobmV3IExpZmVjeWNsZUNhbGxiYWNrc1tj\nYWxsYmFja3NbZXZlbnRdLnNpemUoKV0pOwoKICAgICAgICAgICAgaWYgKHN1\ncGVyQ2xhc3MpIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0Tm9uUENTdXBl\ncmNsYXNzQ2FsbGJhY2tzKGV2ZW50LCBhcnJheSwKICAgICAgICAgICAgICAg\nICAgICAoaGlnaHMgPT0gbnVsbCkgPyAwIDogaGlnaHNbZXZlbnRdKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGVj\nbGFyZWRDYWxsYmFja3MoZXZlbnQsIGFycmF5LAogICAgICAgICAgICAgICAg\nICAgIChoaWdocyA9PSBudWxsKSA/IDAgOiBoaWdoc1tldmVudF0pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGZldGNoIGdyb3Vwcy4KICAgICAqIElmIEZldGNoR3JvdXAgQSBpbmNs\ndWRlcyBGZXRjaEdyb3VwIEIsIHRoZW4gYSBiaS1saW5rIGlzIHNldCBiZXR3\nZWVuCiAgICAgKiBBIGFuZCBCLiBCb3RoIEEgYW5kIEIgbXVzdCBiZSBkZWNs\nYXJlZCBpbiB0aGUgc2FtZSBDbGFzcy4KICAgICAqIDxicj4KICAgICAqIENh\nbGwge0BsaW5rICNwYXJzZUZldGNoQXR0cmlidXRlKENsYXNzTWV0YURhdGEs\nCiAgICAgKiBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwLCBG\nZXRjaEF0dHJpYnV0ZSkgb25seSBhZnRlciB0aGUKICAgICAqIGJpLWxpbmtz\nIGhhdmUgYmVlbiBlc3RhYmxpc2hlZCwgYmVjYXVzZSBhIGZpZWxkIGYgd2ls\nbCBub3Qgb25seSBhZGQgdGhlCiAgICAgKiBmZXRjaCBncm91cCBBIHdoaWNo\nIGV4cGxpY3RseSBpbmNsdWRlcyBmIHRvIGl0cyBjdXN0b20gZmV0Y2ggZ3Jv\ndXBzIGJ1dAogICAgICogYWxzbyB3aWxsIGFsc28gYWRkIGFueSBmZXRjaCBn\ncm91cCBCIHRoYXQgaW5jbHVkZXMgQS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBhcnNlRmV0Y2hHcm91cHMoQ2xhc3NNZXRhRGF0YSBtZXRhLCBGZXRj\naEdyb3VwLi4uIGdyb3VwcykgewogICAgICAgIG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkZldGNoR3JvdXAgZmc7CiAgICAgICAgZm9yIChGZXRjaEdyb3Vw\nIGdyb3VwIDogZ3JvdXBzKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KGdyb3VwLm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVubmFtZWQtZmci\nLCBtZXRhKSk7CgogICAgICAgICAgICBmZyA9IG1ldGEuYWRkRGVjbGFyZWRG\nZXRjaEdyb3VwKGdyb3VwLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChncm91\ncC5wb3N0TG9hZCgpKQogICAgICAgICAgICAgICAgZmcuc2V0UG9zdExvYWQo\ndHJ1ZSk7CiAgICAgICAgICAgIGZvciAoU3RyaW5nIHMgOiBncm91cC5mZXRj\naEdyb3VwcygpKSB7CiAgICAgICAgICAgICAgICBmZy5hZGREZWNsYXJlZElu\nY2x1ZGUocyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8g\nQWRkIHRoZSBwYXJlbnQtY2hpbGQgc3R5bGUgYmktbGlua3MgYmV0d2VlbiBm\nZXRjaCBncm91cHMgaW4gYQogICAgICAgIC8vIHNlcGFyYXRlIHBhc3MuCiAg\nICAgICAgZm9yIChGZXRjaEdyb3VwIGdyb3VwOmdyb3VwcykgewogICAgICAg\nIAlmZyA9IG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5uYW1lKCkpOwogICAg\nICAgIAlTdHJpbmdbXSBpbmNsdWRlZEZldGNoR3JvcE5hbWVzID0gZmcuZ2V0\nRGVjbGFyZWRJbmNsdWRlcygpOwogICAgICAgIAlmb3IgKFN0cmluZyBpbmNs\ndWRlZEZlY3RjaEdyb3VwTmFtZTppbmNsdWRlZEZldGNoR3JvcE5hbWVzKSB7\nCiAgICAgICAgCQlvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3Vw\nIGNoaWxkID0KICAgICAgICAJICAgIG1ldGEuZ2V0RmV0Y2hHcm91cChpbmNs\ndWRlZEZlY3RjaEdyb3VwTmFtZSk7CiAgICAgICAgCQlpZiAoY2hpbGQgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibWlzc2luZy1pbmNsdWRlZC1mZyIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5n\nZXROYW1lKCksIGZnLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGluY2x1ZGVkRmVjdGNoR3JvdXBOYW1lKSk7CiAgICAgICAgCQlj\naGlsZC5hZGRDb250YWluZWRCeShmZyk7CiAgICAgICAgCX0KICAgICAgICB9\nCgogICAgICAgIGZvciAoRmV0Y2hHcm91cCBncm91cCA6IGdyb3Vwcykgewog\nICAgICAgICAgICBmZyA9IG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5uYW1l\nKCkpOwogICAgICAgICAgICBmb3IgKEZldGNoQXR0cmlidXRlIGF0dHIgOiBn\ncm91cC5hdHRyaWJ1dGVzKCkpCiAgICAgICAgICAgICAgICBwYXJzZUZldGNo\nQXR0cmlidXRlKG1ldGEsIGZnLCBhdHRyKTsKICAgICAgICB9CiAgICB9CgoK\nICAgIC8qKgogICAgICogU2V0IGEgZmllbGQncyBmZXRjaCBncm91cC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRmV0Y2hBdHRyaWJ1dGUoQ2xh\nc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkZldGNoR3JvdXAgZmcsIEZldGNoQXR0cmlidXRlIGF0dHIpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gbWV0YS5nZXREZWNsYXJlZEZp\nZWxkKGF0dHIubmFtZSgpKTsKICAgICAgICBpZiAoZmllbGQgPT0gbnVsbAog\nICAgICAgICAgICB8fCBmaWVsZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRN\nZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmctZmllbGQi\nLCBmZy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBtZXRhLCBhdHRyLm5h\nbWUoKSkpOwoKICAgICAgICBmaWVsZC5zZXRJbkZldGNoR3JvdXAoZmcuZ2V0\nTmFtZSgpLCB0cnVlKTsKICAgICAgICBTZXQ8U3RyaW5nPiBwYXJlbnRGZXRj\naEdyb3VwcyA9IGZnLmdldENvbnRhaW5lZEJ5KCk7CiAgICAgICAgZm9yIChP\nYmplY3QgcGFyZW50RmV0Y2hHcm91cCA6IHBhcmVudEZldGNoR3JvdXBzKQog\nICAgICAgIAlmaWVsZC5zZXRJbkZldGNoR3JvdXAocGFyZW50RmV0Y2hHcm91\ncC50b1N0cmluZygpLCB0cnVlKTsKICAgICAgICBpZiAoYXR0ci5yZWN1cnNp\nb25EZXB0aCgpICE9IEludGVnZXIuTUlOX1ZBTFVFKQogICAgICAgICAgICBm\nZy5zZXRSZWN1cnNpb25EZXB0aChmaWVsZCwgYXR0ci5yZWN1cnNpb25EZXB0\naCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgYW5ub3RhdGlvbnMg\nZm9yIHRoZSBnaXZlbiBtZW1iZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZU1lbWJlckFubm90YXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgLy8gbG9vayBmb3IgcGVyc2lzdGVuY2Ugc3RyYXRlZ3kgaW4g\nYW5ub3RhdGlvbiB0YWJsZQogICAgICAgIE1lbWJlciBtZW1iZXIgPSBnZXRS\nZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMo\nKS4KICAgICAgICAgICAgZ2V0QmFja2luZ01lbWJlcihmbWQpOwogICAgICAg\nIFBlcnNpc3RlbmNlU3RyYXRlZ3kgcHN0cmF0ID0gUGVyc2lzdGVuY2VNZXRh\nRGF0YURlZmF1bHRzLgogICAgICAgICAgICBnZXRQZXJzaXN0ZW5jZVN0cmF0\nZWd5KGZtZCwgbWVtYmVyKTsKICAgICAgICBpZiAocHN0cmF0ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBmbWQuc2V0RXhwbGljaXQo\ndHJ1ZSk7CgogICAgICAgIEFubm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3Rh\ndGVkRWxlbWVudCkgbWVtYmVyOwogICAgICAgIGJvb2xlYW4gbG9iID0gKEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAg\nICAgICAgICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGVsLCBMb2Iu\nY2xhc3MpKSkuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgaWYgKGlzTWV0YURh\ndGFNb2RlKCkpIHsKICAgICAgICAgICAgc3dpdGNoIChwc3RyYXQpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgQkFTSUM6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VCYXNpYyhmbWQsIChCYXNpYykgZWwuZ2V0QW5ub3RhdGlvbihCYXNp\nYy5jbGFzcyksIGxvYik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlTWFueVRvT25lKGZtZCwgKE1hbnlUb09uZSkgZWwuZ2V0QW5u\nb3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoTWFueVRvT25lLmNs\nYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIE9ORV9PTkU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VP\nbmVUb09uZShmbWQsIChPbmVUb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgogICAg\nICAgICAgICAgICAgICAgICAgICAoT25lVG9PbmUuY2xhc3MpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU1C\nRURERUQ6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbWJlZGRlZChmbWQs\nIChFbWJlZGRlZCkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAg\nICAgICAgICAoRW1iZWRkZWQuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAg\nICAgICAgICAgICAgICAgcGFyc2VPbmVUb01hbnkoZm1kLCAoT25lVG9NYW55\nKSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChP\nbmVUb01hbnkuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlTWFueVRvTWFueShmbWQsIChNYW55VG9NYW55KSBlbC5n\nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChNYW55VG9N\nYW55LmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFBFUlM6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VQZXJzaXN0ZW50KGZtZCwgKFBlcnNpc3RlbnQpIGVsLmdldEFubm90YXRp\nb24KICAgICAgICAgICAgICAgICAgICAgICAgKFBlcnNpc3RlbnQuY2xhc3Mp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgUEVSU19DT0xMOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUGVy\nc2lzdGVudENvbGxlY3Rpb24oZm1kLCAoUGVyc2lzdGVudENvbGxlY3Rpb24p\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRpb24oUGVy\nc2lzdGVudENvbGxlY3Rpb24uY2xhc3MpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9DT0xMOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlRWxlbWVudENvbGxlY3Rpb24oZm1kLCAo\nRWxlbWVudENvbGxlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVs\nLmdldEFubm90YXRpb24oRWxlbWVudENvbGxlY3Rpb24uY2xhc3MpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nUEVSU19NQVA6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0ZW50\nTWFwKGZtZCwgKFBlcnNpc3RlbnRNYXApCiAgICAgICAgICAgICAgICAgICAg\nICAgIGVsLmdldEFubm90YXRpb24oUGVyc2lzdGVudE1hcC5jbGFzcykpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBUUkFOU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYg\nbG9iKQogICAgICAgICAgICBwYXJzZUxvYk1hcHBpbmcoZm1kKTsKCiAgICAg\nICAgLy8gZXh0ZW5zaW9ucwogICAgICAgIE1ldGFEYXRhVGFnIHRhZzsKICAg\nICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6IGVsLmdldERlY2xhcmVkQW5u\nb3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5u\nby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duTWVtYmVyQW5u\nb3RhdGlvbihmbWQsIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIEFDQ0VTUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUFjY2VzcyhmbWQsIChBY2Nlc3MpYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01P\nREU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUoZm1kKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgR0VORVJBVEVEX1ZBTFVFOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgcGFyc2VHZW5lcmF0ZWRWYWx1ZShmbWQsIChHZW5lcmF0ZWRWYWx1ZSkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIElEOgogICAgICAgICAgICAgICAgY2FzZSBFTUJFRERFRF9J\nRDoKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0UHJpbWFyeUtleSh0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgTUFQUEVEX0JZX0lEOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nTWFwc0lkKGZtZCwgKE1hcHNJZClhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWToKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5KGZtZCwgKE1hcEtl\neSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIE1BUF9LRVlfQ0xBU1M6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZU1hcEtleUNsYXNzKGZtZCwgKE1hcEtleUNsYXNz\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgT1JERVJfQlk6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VPcmRlckJ5KGZtZCwKICAgICAgICAgICAgICAgICAgICAgICAgKE9yZGVy\nQnkpIGVsLmdldEFubm90YXRpb24oT3JkZXJCeS5jbGFzcykpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRVFf\nR0VORVJBVE9SOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdP\ndmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VT\nZXF1ZW5jZUdlbmVyYXRvcihlbCwgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgVkVSU0lPTjoKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmVy\nc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAg\nIGlmIChpc01ldGFEYXRhTW9kZSgpICYmICgoRGVwZW5kZW50KSBhbm5vKS52\nYWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0Q2FzY2Fk\nZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1f\nREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpICYmICgoRWxlbWVudERlcGVuZGVudCkgYW5ubykudmFsdWUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRD\nYXNjYWRlRGVsZXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX1RZUEU6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0VHlwZU92ZXJy\naWRlKHRvT3ZlcnJpZGVUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAoKChFbGVtZW50VHlwZSkgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWFRFUk5B\nTF9WQUxTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RXh0ZXJuYWxW\nYWx1ZXMoU3RyaW5ncy5qb2luKCgoRXh0ZXJuYWxWYWx1ZXMpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBhbm5vKS52YWx1ZSgpLCAiLCIpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRVhURVJOQUxJWkVSOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RXh0\nZXJuYWxpemVyKCgoRXh0ZXJuYWxpemVyKSBhbm5vKS52YWx1ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRkFDVE9SWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEZhY3Rvcnko\nKChGYWN0b3J5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSU5WRVJTRV9MT0dJQ0FM\nOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0SW52ZXJzZSgoKEludmVy\nc2VMb2dpY2FsKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0RFUEVOREVOVDoK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSAmJiAo\nKEtleURlcGVuZGVudCkgYW5ubykudmFsdWUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgZm1kLmdldEtleSgpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAuc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nQVVUTyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEtFWV9UWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nZ2V0S2V5KCkuc2V0VHlwZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBlKCgoS2V5\nVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFubm8pLnZhbHVl\nKCkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgTE9BRF9GRVRDSF9HUk9VUDoKICAgICAgICAgICAgICAgIAlp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nZm1kLnNldExvYWRGZXRjaEdyb3VwKCgoTG9hZEZldGNoR3JvdXApIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgCWJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBMUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRM\nUlMoKChMUlMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBSRUFEX09OTFk6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcnNlUmVhZE9ubHkoZm1kLCAoUmVhZE9ubHkp\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBUWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01l\ndGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0\nVHlwZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBlKCgoVHlwZSkgYW5ubykuCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBmbWQsCiAgICAgICAgICAg\nICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgbWVtYmVy\nIG1hcHBpbmcgY29tcG9uZW50cy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgcGFyc2VNZW1iZXJNYXBwaW5nQW5ub3RhdGlvbnMoRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBDYWNoZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQ2FjaGUoQ2xhc3NNZXRh\nRGF0YSBtZXRhLCBDYWNoZWFibGUgY2FjaGVhYmxlKSB7CiAgICAgICAgbWV0\nYS5zZXRDYWNoZUVuYWJsZWQoY2FjaGVhYmxlLnZhbHVlKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5r\nbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaGFuZGxlVW5rbm93bk1lbWJlckFubm90YXRpb24oRmllbGRNZXRhRGF0\nYSBmbWQsCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nZ2l2ZW4gY2xhc3MgdG8gaXRzIE9wZW5KUEEgdHlwZSBvdmVycmlkZSBlcXVp\ndmFsZW50LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzczw/PiB0\nb092ZXJyaWRlVHlwZShDbGFzczw/PiBjbHMpIHsKICAgICAgICByZXR1cm4g\nKGNscyA9PSBFbnRpdHkuY2xhc3MpCiAgICAgICAgICAgID8gb3JnLmFwYWNo\nZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzIDog\nY2xzOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFJlYWRPbmx5Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VSZWFkT25seShGaWVsZE1l\ndGFEYXRhIGZtZCwgUmVhZE9ubHkgcm8pIHsKICAgICAgICBpZiAocm8udmFs\ndWUoKSA9PSBVcGRhdGVBY3Rpb24uUkVTVFJJQ1QpCiAgICAgICAgICAgIGZt\nZC5zZXRVcGRhdGVTdHJhdGVneShVcGRhdGVTdHJhdGVnaWVzLlJFU1RSSUNU\nKTsKICAgICAgICBlbHNlIGlmIChyby52YWx1ZSgpID09IFVwZGF0ZUFjdGlv\nbi5JR05PUkUpCiAgICAgICAgICAgIGZtZC5zZXRVcGRhdGVTdHJhdGVneShV\ncGRhdGVTdHJhdGVnaWVzLklHTk9SRSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlv\nbiBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VHZW5lcmF0ZWRWYWx1ZShGaWVsZE1ldGFEYXRhIGZtZCwgR2Vu\nZXJhdGVkVmFsdWUgZ2VuKSB7CiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3Ry\nYXRlZ3kgPSBnZW4uc3RyYXRlZ3koKTsKICAgICAgICBTdHJpbmcgZ2VuZXJh\ndG9yID0gZ2VuLmdlbmVyYXRvcigpOwogICAgICAgIHBhcnNlR2VuZXJhdGVk\nVmFsdWUoZm1kLCBzdHJhdGVneSwgZ2VuZXJhdG9yKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBm\nb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBzdGF0aWMgdm9pZCBw\nYXJzZUdlbmVyYXRlZFZhbHVlKEZpZWxkTWV0YURhdGEgZm1kLCBHZW5lcmF0\naW9uVHlwZSBzdHJhdGVneSwKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yKSB7\nCiAgICAgICAgaW50IHN0cmF0ID0gZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVn\neShmbWQsIHN0cmF0ZWd5LCBnZW5lcmF0b3IpOwogICAgICAgIGlmIChzdHJh\ndCAhPSAtMSkKICAgICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koc3Ry\nYXQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKHN0cmF0\nZWd5KSB7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAg\nICAgICAgY2FzZSBTRVFVRU5DRToKICAgICAgICAgICAgICAgICAgICAvLyB0\nZWNobmljYWxseSB3ZSBzaG91bGQgaGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFi\nbGUgYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJh\ndG9ycywgYnV0IGl0J3MgZWFzaWVyIHRvIGp1c3QgcmVseSBvbgogICAgICAg\nICAgICAgICAgICAgIC8vIHRoZSBzeXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBh\nLlNlcXVlbmNlIHNldHRpbmcgZm9yIGJvdGgKICAgICAgICAgICAgICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2Vx\ndWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVT\nZXF1ZW5jZU5hbWUoZ2VuZXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQVVUTzoKICAgICAgICAgICAg\nICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRh\nRGF0YS5OQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIElERU5USVRZOgogICAgICAgICAgICAg\nICAgICAgIGZtZC5zZXRWYWx1ZVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5B\nVVRPQVNTSUdOKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKHN0cmF0ZWd5LnRvU3RyaW5nKCkp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSB2YWx1ZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGdl\nbmVyYXRvciwgb3IgLTEgaWYgdGhlCiAgICAgKiBzdHJhdGVneSBkZXBlbmRz\nIG9uIHRoZSA8Y29kZT5HZW5lcmF0aW9uVHlwZTwvY29kZT4gcmF0aGVyIHRo\nYW4gdGhlCiAgICAgKiBnZW5lcmF0b3IgbmFtZS4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgaW50IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koT2Jq\nZWN0IGNvbnRleHQsCiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3ks\nIFN0cmluZyBnZW5lcmF0b3IpIHsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0g\nQVVUTyB8fCBTdHJpbmdVdGlscy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAg\nICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlE\nX0hFWC5lcXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZh\nbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDsKICAgICAgICBpZiAoR2VuZXJhdG9y\nLlVVSURfU1RSSU5HLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAgICBy\nZXR1cm4gVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5HOwogICAgICAgIGlm\nIChHZW5lcmF0b3IuVVVJRF9UWVBFNF9IRVguZXF1YWxzKGdlbmVyYXRvcikp\nCiAgICAgICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9UWVBF\nNF9IRVg7CiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX1RZUEU0X1NUUklO\nRy5lcXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVl\nU3RyYXRlZ2llcy5VVUlEX1RZUEU0X1NUUklORzsKICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImdlbmVyYXRvci1iYWQt\nc3RyYXRlZ3kiLAogICAgICAgICAgICBjb250ZXh0LCBnZW5lcmF0b3IpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBCYXNpYy4gR2l2ZW4gYW5u\nb3RhdGlvbiBtYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlQmFzaWMoRmllbGRNZXRhRGF0YSBmbWQsIEJhc2ljIGFubm8sIGJv\nb2xlYW4gbG9iKSB7CiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAobG9iICYmIHR5cGUgIT0gU3Ry\naW5nLmNsYXNzCiAgICAgICAgICAgICYmIHR5cGUgIT0gY2hhcltdLmNsYXNz\nICYmIHR5cGUgIT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgJiYg\ndHlwZSAhPSBieXRlW10uY2xhc3MgJiYgdHlwZSAhPSBCeXRlW10uY2xhc3Mp\nCiAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAg\nIGVsc2UgaWYgKCFsb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgaWYgKEVudW0u\nY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBu\nbyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAg\nICAgICBpZiAoU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\ndHlwZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxp\nemVkKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZtZCwgIkJhc2ljIikpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gY2hhcltdLmNsYXNzIHx8\nIHR5cGUgPT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgICAgICAg\nICAgICAgfHwgdHlwZSA9PSBieXRlW10uY2xhc3MgfHwgdHlwZSA9PSBCeXRl\nW10uY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgIGlmIChTZXJpYWxpemFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbQogICAgICAgICAgICAgICAgICAgICAgICAodHlwZS5nZXRD\nb21wb25lbnRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0U2VyaWFsaXplZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmbWQsICJCYXNpYyIpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYgKGFubm8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9\nPSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmICghYW5uby5vcHRpb25h\nbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURh\ndGEuTlVMTF9FWENFUFRJT04pOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQE1hbnlUb09uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nTWFueVRvT25lKEZpZWxkTWV0YURhdGEgZm1kLCBNYW55VG9PbmUgYW5ubykg\newogICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVl\nKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAg\nICAiTWFueVRvT25lIikpOwoKICAgICAgICAvLyBkb24ndCBzcGVjaWZpY2Fs\nbHkgZXhjbHVkZSByZWxhdGlvbiBmcm9tIERGRyBiL2MgdGhhdCB3aWxsIHBy\nZXZlbnQKICAgICAgICAvLyB1cyBmcm9tIGV2ZW4gcmVhZGluZyB0aGUgZmsg\nd2hlbiByZWFkaW5nIGZyb20gdGhlIHByaW1hcnkgdGFibGUsCiAgICAgICAg\nLy8gd2hpY2ggaXMgbm90IHdoYXQgbW9zdCB1c2VycyB3aWxsIHdhbnQKICAg\nICAgICBpZiAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUikKICAg\nICAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAg\nICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5z\nZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAg\nICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykK\nICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdldEVu\ndGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2Fk\nZSgpKTsKICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0\nYURhdGEuTUFOWV9UT19PTkUpOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQE9uZVRvT25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VP\nbmVUb09uZShGaWVsZE1ldGFEYXRhIGZtZCwgT25lVG9PbmUgYW5ubykgewog\nICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAi\nT25lVG9PbmUiKSk7CgogICAgICAgIC8vIGRvbid0IHNwZWNpZmljYWxseSBl\neGNsdWRlIHJlbGF0aW9uIGZyb20gREZHIGIvYyB0aGF0IHdpbGwgcHJldmVu\ndAogICAgICAgIC8vIHVzIGZyb20gZXZlbiByZWFkaW5nIHRoZSBmayB3aGVu\nIHJlYWRpbmcgZnJvbSB0aGUgcHJpbWFyeSB0YWJsZSwKICAgICAgICAvLyB3\naGljaCBpcyBub3Qgd2hhdCBtb3N0IHVzZXJzIHdpbGwgd2FudAogICAgICAg\nIGlmIChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKQogICAgICAg\nICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAg\nICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51\nbGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9OKTsKCiAgICAg\nICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGls\ncy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5z\nZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5v\nLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZt\nZC5zZXRUeXBlT3ZlcnJpZGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7CiAgICAgICAg\nc2V0T3JwaGFuUmVtb3ZhbChmbWQsIGFubm8ub3JwaGFuUmVtb3ZhbCgpKTsK\nICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZpZWxkTWV0YURhdGEu\nT05FX1RPX09ORSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARW1i\nZWRkZWQuIEdpdmVuIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVkKEZpZWxkTWV0YURhdGEg\nZm1kLCBFbWJlZGRlZCBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMu\nbWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIs\nIGZtZCwKICAgICAgICAgICAgICAgICJFbWJlZGRlZCIpKTsKCiAgICAgICAg\nZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgZm1k\nLnNldEVtYmVkZGVkKHRydWUpOwoKICAgICAgICBpZiAoZm1kLmdldEVtYmVk\nZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICBmbWQuYWRkRW1i\nZWRkZWRNZXRhRGF0YShnZXRBY2Nlc3NDb2RlKGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9uZVRvTWFu\neS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlT25lVG9NYW55KEZp\nZWxkTWV0YURhdGEgZm1kLCBPbmVUb01hbnkgYW5ubykgewogICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKGZt\nZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAg\nICAgICAgICAiT25lVG9NYW55IikpOwogICAgICAgIH0KCiAgICAgICAgZm1k\nLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNo\nVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9k\nZSgpICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkp\nCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkp\nOwogICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xh\nc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRU\neXBlKGFubm8udGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVz\nKGZtZC5nZXRFbGVtZW50KCksIGFubm8uY2FzY2FkZSgpKTsKICAgICAgICBz\nZXRPcnBoYW5SZW1vdmFsKGZtZC5nZXRFbGVtZW50KCksIGFubm8ub3JwaGFu\nUmVtb3ZhbCgpKTsKICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZp\nZWxkTWV0YURhdGEuT05FX1RPX01BTlkpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQE1hbnlUb01hbnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZU1hbnlUb01hbnkoRmllbGRNZXRhRGF0YSBmbWQsIE1hbnlUb01h\nbnkgYW5ubykgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgaWYg\nKEphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRFbGVtZW50KCkpKQogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gbm8gYnJl\nYWsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5u\nbyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiT25lVG9NYW55IikpOwog\nICAgICAgIH0KCiAgICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAo\nYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYg\nKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBw\nZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5vLnRhcmdl\ndEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRF\nbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8udGFyZ2V0RW50aXR5KCkp\nOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8u\nY2FzY2FkZSgpKTsKICAgICAgICBmbWQuc2V0QXNzb2NpYXRpb25UeXBlKEZp\nZWxkTWV0YURhdGEuTUFOWV9UT19NQU5ZKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBNYXBLZXkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZU1hcEtleShGaWVsZE1ldGFEYXRhIGZtZCwgTWFwS2V5IGFubm8pIHsK\nICAgICAgICBTdHJpbmcgbmFtZSA9IGFubm8ubmFtZSgpOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBmbWQu\nZ2V0S2V5KCkuc2V0VmFsdWVNYXBwZWRCeShWYWx1ZU1ldGFEYXRhLk1BUFBF\nRF9CWV9QSyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmbWQuZ2V0S2V5\nKCkuc2V0VmFsdWVNYXBwZWRCeShuYW1lKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBNYXBLZXlDbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBhcnNlTWFwS2V5Q2xhc3MoRmllbGRNZXRhRGF0YSBmbWQsIE1hcEtl\neUNsYXNzIGFubm8pIHsKICAgICAgICBpZiAoYW5uby52YWx1ZSgpICE9IHZv\naWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXREZWNsYXJl\nZFR5cGUoYW5uby52YWx1ZSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgIlRoZSB2YWx1ZSBvZiB0aGUgTWFwQ2xhc3NDbGFzcyBjYW5u\nb3QgYmUgbnVsbCIpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1h\ncHNJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFwc0lkKEZp\nZWxkTWV0YURhdGEgZm1kLCBNYXBzSWQgYW5ubykgewogICAgICAgIFN0cmlu\nZyB2YWx1ZSA9IGFubm8udmFsdWUoKTsKICAgICAgICBpZiAodmFsdWUgIT0g\nbnVsbCkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5SWRWYWx1ZSh2YWx1\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnlJ\nZFZhbHVlKCIiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHVwIHRoZSBm\naWVsZCBhcyBhIExPQiBtYXBwaW5nLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBwYXJzZUxvYk1hcHBpbmcoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBPcmRlckJ5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VPcmRlckJ5KEZpZWxkTWV0YURhdGEgZm1k\nLCBPcmRlckJ5IGFubm8pIHsKICAgICAgICBTdHJpbmcgZGVjID0gYW5uby52\nYWx1ZSgpOwogICAgICAgIGlmIChmbWQuaXNFbGVtZW50Q29sbGVjdGlvbigp\nICYmCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RW1iZWRkZWRN\nZXRhRGF0YSgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChkZWMu\nbGVuZ3RoKCkgPT0gMCB8fCBkZWMuZXF1YWxzKCJBU0MiKSB8fAogICAgICAg\nICAgICAgICAgICAgIGRlYy5lcXVhbHMoIkRFU0MiKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nCiAgICAgICAgICAgICAgICAgICAgICAgICJpbnZhbGlkLW9yZGVyQnkiLCBm\nbWQpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlYy5sZW5ndGgoKSA9PSAw\nIHx8IGRlYy5lcXVhbHMoIkFTQyIpKQogICAgICAgICAgICBkZWMgPSBPcmRl\nci5FTEVNRU5UICsgIiBhc2MiOwogICAgICAgIGVsc2UgaWYgKGRlYy5lcXVh\nbHMoIkRFU0MiKSkKICAgICAgICAgICAgZGVjID0gT3JkZXIuRUxFTUVOVCAr\nICIgZGVzYyI7CgogICAgICAgIGZtZC5zZXRPcmRlckRlY2xhcmF0aW9uKGRl\nYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudChGaWVs\nZE1ldGFEYXRhIGZtZCwgUGVyc2lzdGVudCBhbm5vKSB7CiAgICAgICAgc3dp\ndGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgaWYgKGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAg\nICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0ZVtd\nLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVk\nVHlwZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgIHx8\nIGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8v\nIG5vIGJyZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJ\nT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVy\nc2lzdGVudCIpKTsKICAgICAgICB9CgogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQu\nc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0\nSW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBl\nLkVBR0VSKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAg\nICAgICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhD\nRVBUSU9OKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2Fk\nZSgpKTsKICAgICAgICBpZiAoYW5uby5lbWJlZGRlZCgpKSB7CiAgICAgICAg\nICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAg\nICAgICJQZXJzaXN0ZW50KGVtYmVkZGVkPXRydWUpIikpOwogICAgICAgICAg\nICBmbWQuc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQu\nZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGZtZC5hZGRFbWJlZGRlZE1ldGFEYXRhKGdldEFjY2Vzc0NvZGUoZm1k\nLmdldERlY2xhcmVkVHlwZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudENvbGxl\nY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNpc3Rl\nbnRDb2xsZWN0aW9uKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIFBlcnNp\nc3RlbnRDb2xsZWN0aW9uIGFubm8pIHsKICAgICAgICBpZiAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQVJSQVkKICAgICAgICAg\nICAgJiYgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMu\nQ09MTEVDVElPTikKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAg\nICAgICAgICAgIlBlcnNpc3RlbnRDb2xsZWN0aW9uIikpOwoKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAg\nICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAg\nICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgp\nID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGFubm8uZWxlbWVu\ndFR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxl\nbWVudCgpLnNldERlY2xhcmVkVHlwZShhbm5vLmVsZW1lbnRUeXBlKCkpOwog\nICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8uZWxl\nbWVudENhc2NhZGUoKSk7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudEVtYmVk\nZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhm\nbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZt\nZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVudENvbGxlY3Rpb24o\nZW1iZWRkZWRFbGVtZW50PXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0\nRWxlbWVudCgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAo\nZm1kLmdldEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5hZGRFbWJl\nZGRlZE1ldGFEYXRhKAogICAgICAgICAgICAgICAgICAgIGdldEFjY2Vzc0Nv\nZGUoZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQEVsZW1lbnRDb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VFbGVtZW50Q29sbGVjdGlvbihGaWVsZE1ldGFEYXRhIGZtZCwK\nICAgICAgICBFbGVtZW50Q29sbGVjdGlvbiBhbm5vKSB7CiAgICAgICAgLy8g\nVE9ETzogdGhyb3cgZXhjZXB0aW9uIGlmIHRoZSBydW50aW1lIGVudiBpcyBP\ncGVuSnBhIDEueAoKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSAhPSBKYXZhVHlwZXMuQ09MTEVDVElPTiAmJgogICAgICAgICAgICBm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5NQVApCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJFbGVt\nZW50Q29sbGVjdGlvbiIpKTsKCiAgICAgICAgaWYgKGFubm8udGFyZ2V0Q2xh\nc3MoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVu\ndCgpLnNldERlY2xhcmVkVHlwZShhbm5vLnRhcmdldENsYXNzKCkpOwogICAg\nICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9\nPSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGZtZC5zZXRFbGVtZW50Q29s\nbGVjdGlvbih0cnVlKTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIGVsZW0gPSBm\nbWQuZ2V0RWxlbWVudCgpOwogICAgICAgIGJvb2xlYW4gaXNFbnVtID0gZWxl\nbS5nZXREZWNsYXJlZFR5cGUoKS5pc0VudW0oKTsKICAgICAgICBpZiAoIWlz\nRW51bSAmJiBKYXZhVHlwZXMubWF5YmVQQyhlbGVtKSkgewogICAgICAgICAg\nICBlbGVtLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZWxl\nbS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGVsZW0uYWRkRW1iZWRkZWRNZXRhRGF0YShnZXRBY2Nlc3NDb2RlKGVs\nZW0uZ2V0RGVjbGFyZWRUeXBlKCkpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudE1hcC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudE1hcChGaWVsZE1ldGFEYXRh\nIGZtZCwgUGVyc2lzdGVudE1hcCBhbm5vKSB7CiAgICAgICAgaWYgKGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLk1BUCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIlBlcnNpc3Rl\nbnRNYXAiKSk7CgogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3Vw\nKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlm\nIChhbm5vLmtleVR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBm\nbWQuZ2V0S2V5KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8ua2V5VHlwZSgpKTsK\nICAgICAgICBpZiAoYW5uby5lbGVtZW50VHlwZSgpICE9IHZvaWQuY2xhc3Mp\nCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBl\nKGFubm8uZWxlbWVudFR5cGUoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1k\nLmdldEtleSgpLCBhbm5vLmtleUNhc2NhZGUoKSk7CiAgICAgICAgc2V0Q2Fz\nY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5lbGVtZW50Q2FzY2FkZSgp\nKTsKICAgICAgICBpZiAoYW5uby5rZXlFbWJlZGRlZCgpKSB7CiAgICAgICAg\nICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEtleSgpKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAg\nICAiUGVyc2lzdGVudE1hcChlbWJlZGRlZEtleT10cnVlKSIpKTsKICAgICAg\nICAgICAgZm1kLmdldEtleSgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAg\nICAgICBpZiAoZm1kLmdldEtleSgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkuYWRkRW1i\nZWRkZWRNZXRhRGF0YSgKICAgICAgICAgICAgICAgICAgICBnZXRBY2Nlc3ND\nb2RlKGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKSkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJl\nZGRlZCgpKSB7CiAgICAgICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMo\nZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBm\nbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRk\nZWRWYWx1ZT10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURh\ndGEoCiAgICAgICAgICAgICAgICAgICAgZ2V0QWNjZXNzQ29kZShmbWQuZ2V0\nRWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IGNhc2NhZGVzIG9uIHJlbGF0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Q2FzY2FkZXMoVmFsdWVNZXRh\nRGF0YSB2bWQsIENhc2NhZGVUeXBlW10gY2FzY2FkZXMpIHsKICAgICAgICBm\nb3IgKENhc2NhZGVUeXBlIGNhc2NhZGUgOiBjYXNjYWRlcykgewogICAgICAg\nICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2Fk\nZSA9PSBDYXNjYWRlVHlwZS5SRU1PVkUpCiAgICAgICAgICAgICAgICB2bWQu\nc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJ\nQVRFKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUu\nQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUEVSU0lTVCkKICAgICAg\nICAgICAgICAgIHZtZC5zZXRDYXNjYWRlUGVyc2lzdChWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUg\nPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUu\nTUVSR0UpCiAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZUF0dGFjaChW\nYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICAgICAg\naWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0g\nQ2FzY2FkZVR5cGUuREVUQUNIKQogICAgICAgICAgICAgICAgdm1kLnNldENh\nc2NhZGVEZXRhY2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7\nCiAgICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8\nfCBjYXNjYWRlID09IENhc2NhZGVUeXBlLlJFRlJFU0gpCiAgICAgICAgICAg\nICAgICB2bWQuc2V0Q2FzY2FkZVJlZnJlc2goVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0lNTUVESUFURSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBzZXRPcnBoYW5SZW1vdmFsKFZhbHVlTWV0YURhdGEgdm1kLCBib29s\nZWFuIG9ycGhhblJlbW92YWwpIHsKICAgICAgICBpZiAob3JwaGFuUmVtb3Zh\nbCkKICAgICAgICAgICAgdm1kLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0FVVE8pOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQFNlcXVlbmNlR2VuZXJhdG9yLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihBbm5vdGF0ZWRFbGVtZW50IGVs\nLAogICAgICAgIFNlcXVlbmNlR2VuZXJhdG9yIGdlbikgewogICAgICAgIFN0\ncmluZyBuYW1lID0gZ2VuLm5hbWUoKTsKICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zZXEtbmFtZSIsIGVsKSk7Cgog\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nIF9sb2cudHJhY2UoX2xvYy5nZXQoInBhcnNlLXNlcXVlbmNlIiwgbmFtZSkp\nOwoKICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSBnZXRSZXBvc2l0\nb3J5KCkuZ2V0Q2FjaGVkU2VxdWVuY2VNZXRhRGF0YQogICAgICAgICAgICAo\nbmFtZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBf\nbG9nLndhcm4oX2xvYy5nZXQoImR1cC1zZXF1ZW5jZSIsIG5hbWUsIGVsKSk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNy\nZWF0ZSBuZXcgc2VxdWVuY2UKICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9y\neSgpLmFkZFNlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAgICAgU3RyaW5n\nIHNlcSA9IGdlbi5zZXF1ZW5jZU5hbWUoKTsKICAgICAgICAvLyBEbyBub3Qg\nbm9ybWFsaXplIHRoZSBzZXF1ZW5jZSBuYW1lIGlmIGl0IGFwcGVhcnMgdG8g\nYmUgYSBwbHVnaW4gCiAgICAgICAgaWYgKHNlcS5pbmRleE9mKCcoJykgPT0g\nLTEpewogICAgICAgICAgICBzZXEgPSBub3JtYWxpemVTZXF1ZW5jZU5hbWUo\nc2VxKTsKICAgICAgICB9CiAgICAgICAgaW50IGluaXRpYWwgPSBnZW4uaW5p\ndGlhbFZhbHVlKCk7CiAgICAgICAgaW50IGFsbG9jYXRlID0gZ2VuLmFsbG9j\nYXRpb25TaXplKCk7CiAgICAgICAgU3RyaW5nIHNjaGVtYSA9IG5vcm1hbGl6\nZVNjaGVtYU5hbWUoZ2VuLnNjaGVtYSgpKTsKICAgICAgICBTdHJpbmcgY2F0\nYWxvZyA9IG5vcm1hbGl6ZUNhdGFsb2dOYW1lKGdlbi5jYXRhbG9nKCkpOwog\nICAgICAgIC8vIGRvbid0IGFsbG93IGluaXRpYWwgb2YgMCBiL2MgbG9va3Mg\nbGlrZSBkZWYgdmFsdWUKICAgICAgICBpZiAoaW5pdGlhbCA9PSAwKQogICAg\nICAgICAgICBpbml0aWFsID0gMTsKCiAgICAgICAgLy8gY3JlYXRlIHBsdWdp\nbiBzdHJpbmcgZnJvbSBpbmZvCiAgICAgICAgU3RyaW5nIGNsc05hbWUsIHBy\nb3BzOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNlcSkpIHsK\nICAgICAgICAgICAgY2xzTmFtZSA9IFNlcXVlbmNlTWV0YURhdGEuSU1QTF9O\nQVRJVkU7CiAgICAgICAgICAgIHByb3BzID0gbnVsbDsKICAgICAgICB9IGVs\nc2UgaWYgKHNlcS5pbmRleE9mKCcoJykgIT0gLTEpIC8vIHBsdWdpbgogICAg\nICAgIHsKICAgICAgICAgICAgY2xzTmFtZSA9IENvbmZpZ3VyYXRpb25zLmdl\ndENsYXNzTmFtZShzZXEpOwogICAgICAgICAgICBwcm9wcyA9IENvbmZpZ3Vy\nYXRpb25zLmdldFByb3BlcnRpZXMoc2VxKTsKICAgICAgICAgICAgc2VxID0g\nbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjbHNOYW1lID0g\nU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJv\ncHMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgbWV0YS5zZXRTZXF1ZW5j\nZVBsdWdpbihDb25maWd1cmF0aW9ucy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJv\ncHMpKTsKICAgICAgICBtZXRhLnNldFNlcXVlbmNlKHNlcSk7CiAgICAgICAg\nbWV0YS5zZXRJbml0aWFsVmFsdWUoaW5pdGlhbCk7CiAgICAgICAgbWV0YS5z\nZXRBbGxvY2F0ZShhbGxvY2F0ZSk7CiAgICAgICAgbWV0YS5zZXRTY2hlbWEo\nc2NoZW1hKTsKICAgICAgICBtZXRhLnNldENhdGFsb2coY2F0YWxvZyk7CiAg\nICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNlRmlsZSgpLCAoZWwgaW5z\ndGFuY2VvZiBDbGFzcykgPyBlbCA6IG51bGwsCiAgICAgICAgICAgIFNvdXJj\nZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05TKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBOYW1lZFF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VOYW1lZFF1ZXJpZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwgTmFt\nZWRRdWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBt\nZXRhOwogICAgICAgIGZvciAoTmFtZWRRdWVyeSBxdWVyeSA6IHF1ZXJpZXMp\nIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnku\nbmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm8tcXVlcnktbmFtZSIsIGVsKSk7CiAgICAg\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAgICAg\nICAgIHF1ZXJ5Lm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJwYXJzZS1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSkpOwoKICAg\nICAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5zZWFyY2hRdWVyeU1l\ndGFEYXRhQnlOYW1lKHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIGlmICht\nZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgCUNsYXNzPD8+IGRlZmluaW5n\nVHlwZSA9IG1ldGEuZ2V0RGVmaW5pbmdUeXBlKCk7CiAgICAgICAgICAgICAg\nICBpZiAoKGRlZmluaW5nVHlwZSA9PSBudWxsIHx8IGRlZmluaW5nVHlwZSAh\nPSBfY2xzKQogICAgICAgICAgICAgICAgICAmJiBfbG9nLmlzV2FybkVuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCwKICAgICAgICAgICAg\nICAgICAgICAJCWRlZmluaW5nVHlwZSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRh\nKF9jbHMsIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0UXVl\ncnlTdHJpbmcocXVlcnkucXVlcnkoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0\nTGFuZ3VhZ2UoSlBRTFBhcnNlci5MQU5HX0pQUUwpOwogICAgICAgICAgICBm\nb3IgKFF1ZXJ5SGludCBoaW50IDogcXVlcnkuaGludHMoKSkKICAgICAgICAg\nICAgICAgIG1ldGEuYWRkSGludChoaW50Lm5hbWUoKSwgaGludC52YWx1ZSgp\nKTsKICAgICAgICAgICAgTG9ja01vZGVUeXBlIGxtdCA9IHByb2Nlc3NOYW1l\nZFF1ZXJ5TG9ja01vZGVUeXBlKHF1ZXJ5KTsKICAgICAgICAgICAgaWYgKGxt\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBtZXRhLmFkZEhpbnQoIm9w\nZW5qcGEuRmV0Y2hQbGFuLlJlYWRMb2NrTW9kZSIsIGxtdCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZp\nbGUoKSwgKGVsIGluc3RhbmNlb2YgQ2xhc3MpID8gZWwgOiBudWxsLAogICAg\nICAgICAgICAgICAgU291cmNlVHJhY2tlci5TUkNfQU5OT1RBVElPTlMpOwog\nICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAg\nICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01FVEEpOwogICAgICAgICAg\nICBlbHNlIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAgICBt\nZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5HKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVf\nUVVFUlkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEgcHJp\ndmF0ZSB3b3JrZXIgbWV0aG9kIHRoYXQgY2FsY3VsYXRlcyB0aGUgbG9jayBt\nb2RlIGZvciBhbiBpbmRpdmlkdWFsIE5hbWVkUXVlcnkuIElmIHRoZSBOYW1l\nZFF1ZXJ5IGlzIAogICAgICogY29uZmlndXJlZCB0byB1c2UgdGhlIE5PTkUg\nbG9jayBtb2RlKGV4cGxpY2l0IG9yIGltcGxpY2l0KSwgdGhpcyBtZXRob2Qg\nd2lsbCBwcm9tb3RlIHRoZSBsb2NrIHRvIGEgUkVBRAogICAgICogbGV2ZWwg\nbG9jay4gVGhpcyB3YXMgZG9uZSB0byBhbGxvdyBmb3IgSlBBMSBhcHBzIHRv\nIGZ1bmN0aW9uIHByb3Blcmx5IHVuZGVyIGEgMi4wIHJ1bnRpbWUuIAogICAg\nICovCiAgICBwcml2YXRlIExvY2tNb2RlVHlwZSBwcm9jZXNzTmFtZWRRdWVy\neUxvY2tNb2RlVHlwZShOYW1lZFF1ZXJ5IHF1ZXJ5KSB7CiAgICAgICAgTG9j\na01vZGVUeXBlIGxtdCA9IHF1ZXJ5LmxvY2tNb2RlKCk7CiAgICAgICAgaWYg\nKHF1ZXJ5LmxvY2tNb2RlKCkgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJp\nbmcgbG0gPSBfY29uZi5nZXRMb2NrTWFuYWdlcigpOwogICAgICAgICAgICBp\nZiAobG0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgbG0gPSBsbS50b0xv\nd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYgKGxtLmNvbnRhaW5zKCJw\nZXNzaW1pc3RpYyIpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxtdCA9\nPSBMb2NrTW9kZVR5cGUuTk9ORSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkgPT0gdHJ1ZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJvdmVy\ncmlkZS1uYW1lZC1xdWVyeS1sb2NrLW1vZGUiLCBuZXcgU3RyaW5nW10geyAi\nYW5ub3RhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncXVlcnkubmFtZSgpLCBfY2xzLmdldE5hbWUoKSB9KSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbG10ID0g\nTG9ja01vZGVUeXBlLlJFQUQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBsbXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATmFt\nZWROYXRpdmVRdWVyeS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nTmFtZWROYXRpdmVRdWVyaWVzKEFubm90YXRlZEVsZW1lbnQgZWwsCiAgICAg\nICAgTmFtZWROYXRpdmVRdWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVl\ncnlNZXRhRGF0YSBtZXRhOwogICAgICAgIGZvciAoTmFtZWROYXRpdmVRdWVy\neSBxdWVyeSA6IHF1ZXJpZXMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkocXVlcnkubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmF0aXZl\nLXF1ZXJ5LW5hbWUiLAogICAgICAgICAgICAgICAgICAgIGVsKSk7CiAgICAg\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnktc3RyaW5nIiwKICAgICAgICAg\nICAgICAgICAgICBxdWVyeS5uYW1lKCksIGVsKSk7CgogICAgICAgICAgICBp\nZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgicGFyc2UtbmF0aXZlLXF1ZXJ5IiwgcXVlcnku\nbmFtZSgpKSk7CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgp\nLnNlYXJjaFF1ZXJ5TWV0YURhdGFCeU5hbWUocXVlcnkubmFtZSgpKTsKICAg\nICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAJQ2xh\nc3M8Pz4gZGVmVHlwZSA9IG1ldGEuZ2V0RGVmaW5pbmdUeXBlKCk7CiAgICAg\nICAgICAgICAgICBpZiAoKGRlZlR5cGUgIT0gX2NscykgJiYgX2xvZy5pc1dh\ncm5FbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4o\nX2xvYy5nZXQoImR1cC1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSwgZWwsIGRlZlR5\ncGUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVw\nb3NpdG9yeSgpLmFkZFF1ZXJ5TWV0YURhdGEobnVsbCwgcXVlcnkubmFtZSgp\nKTsKICAgICAgICAgICAgbWV0YS5zZXRRdWVyeVN0cmluZyhxdWVyeS5xdWVy\neSgpKTsKICAgICAgICAgICAgbWV0YS5zZXRMYW5ndWFnZShRdWVyeUxhbmd1\nYWdlcy5MQU5HX1NRTCk7CiAgICAgICAgICAgIENsYXNzPD8+IHJlcyA9IHF1\nZXJ5LnJlc3VsdENsYXNzKCk7CiAgICAgICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlZFR5cGUoZ2V0Q29uZmlndXJhdGlvbigpLCByZXMpKQogICAg\nICAgICAgICAgICAgbWV0YS5zZXRDYW5kaWRhdGVUeXBlKHJlcyk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKCF2b2lkLmNsYXNzLmVxdWFscyhyZXMpKQogICAg\nICAgICAgICAgICAgbWV0YS5zZXRSZXN1bHRUeXBlKHJlcyk7CgogICAgICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucmVzdWx0U2V0\nTWFwcGluZygpKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0UmVzdWx0U2V0\nTWFwcGluZ05hbWUocXVlcnkucmVzdWx0U2V0TWFwcGluZygpKTsKICAgICAg\nICAgICAgZm9yIChRdWVyeUhpbnQgaGludCA6IHF1ZXJ5LmhpbnRzKCkpCiAg\nICAgICAgICAgICAgICBtZXRhLmFkZEhpbnQoaGludC5uYW1lKCksIGhpbnQu\ndmFsdWUoKSk7CgogICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3Vy\nY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwK\nICAgICAgICAgICAgICAgIFNvdXJjZVRyYWNrZXIuU1JDX0FOTk9UQVRJT05T\nKTsKICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NRVRBKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUFQUElORyk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShN\nT0RFX1FVRVJZKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGV4cGxpY2l0IGFjY2VzcyB0eXBlLCBpZiBzcGVjaWZpZWQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUFjY2VzcyhGaWVsZE1ldGFE\nYXRhIG1ldGEsIEFjY2VzcyBhY2Nlc3MpIHsKICAgIAlpZiAoYWNjZXNzICE9\nIG51bGwpIHsKICAgIAkJbWV0YS5zZXRBY2Nlc3NUeXBlKEFjY2Vzc0NvZGUu\nRVhQTElDSVQKICAgICAgICAgICAgfCAoYWNjZXNzLnZhbHVlKCkgPT0gQWNj\nZXNzVHlwZS5GSUVMRCA/CiAgICAgICAgICAgIAkJQWNjZXNzQ29kZS5GSUVM\nRCA6IEFjY2Vzc0NvZGUuUFJPUEVSVFkpKTsKICAgIAl9CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9kS2V5IHsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBNZXRob2QgX21ldGhvZDsKCiAgICAgICAgcHVibGljIE1l\ndGhvZEtleShNZXRob2QgbSkgewogICAgICAgICAgICBfbWV0aG9kID0gbTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAg\nICAgICAgICAgIGludCBjb2RlID0gNDYgKiAxMiArIF9tZXRob2QuZ2V0TmFt\nZSgpLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIGZvciAoQ2xhc3M8Pz4gcGFy\nYW0gOiBfbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCkpCiAgICAgICAgICAg\nICAgICBjb2RlID0gNDYgKiBjb2RlICsgcGFyYW0uaGFzaENvZGUoKTsKICAg\nICAgICAgICAgcmV0dXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAgaWYg\nKCEobyBpbnN0YW5jZW9mIE1ldGhvZEtleSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIE1ldGhvZCBvdGhlciA9ICgoTWV0\naG9kS2V5KSBvKS5fbWV0aG9kOwogICAgICAgICAgICBpZiAoIV9tZXRob2Qu\nZ2V0TmFtZSgpLmVxdWFscyhvdGhlci5nZXROYW1lKCkpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gQXJyYXlz\nLmVxdWFscyhfbWV0aG9kLmdldFBhcmFtZXRlclR5cGVzKCksCiAgICAgICAg\nICAgICAgICBvdGhlci5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9kQ29tcGFy\nYXRvciBpbXBsZW1lbnRzIENvbXBhcmF0b3I8TWV0aG9kPiB7CgogICAgICAg\nIHByaXZhdGUgc3RhdGljIE1ldGhvZENvbXBhcmF0b3IgSU5TVEFOQ0UgPSBu\ndWxsOwoKICAgICAgICBwdWJsaWMgc3RhdGljIE1ldGhvZENvbXBhcmF0b3Ig\nZ2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIGlmIChJTlNUQU5DRSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgSU5TVEFOQ0UgPSBuZXcgTWV0aG9kQ29t\ncGFyYXRvcigpOwogICAgICAgICAgICByZXR1cm4gSU5TVEFOQ0U7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoTWV0aG9kIG0xLCBN\nZXRob2QgbTIpIHsKICAgICAgICAgICAgQ2xhc3M8Pz4gYzEgPSBtMS5nZXRE\nZWNsYXJpbmdDbGFzcygpOwogICAgICAgICAgICBDbGFzczw/PiBjMiA9IG0y\nLmdldERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgICAgIGlmICghYzEuZXF1\nYWxzKGMyKSkgewogICAgICAgICAgICAgICAgaWYgKGMxLmlzQXNzaWduYWJs\nZUZyb20oYzIpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAg\nICAgICAgICAgICAgIGVsc2UKCQkJCQlyZXR1cm4gMTsKCQkJfQoJCQlpbnQg\nY29tcGFyZSA9IG0xLmdldE5hbWUgKCkuY29tcGFyZVRvIChtMi5nZXROYW1l\nICgpKTsKCQkJaWYgKGNvbXBhcmUgPT0gMCkKCQkJCXJldHVybiBtMS5oYXNo\nQ29kZSAoKSAtIG0yLmhhc2hDb2RlICgpOwoJCQlyZXR1cm4gY29tcGFyZTsK\nCQl9Cgl9CgogICAgcHJvdGVjdGVkIFN0cmluZyBub3JtYWxpemVTZXF1ZW5j\nZU5hbWUoU3RyaW5nIHNlcU5hbWUpIHsKICAgICAgICByZXR1cm4gc2VxTmFt\nZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG5vcm1hbGl6ZVNjaGVt\nYU5hbWUoU3RyaW5nIHNjaE5hbWUpIHsKICAgICAgICByZXR1cm4gc2NoTmFt\nZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG5vcm1hbGl6ZUNhdGFs\nb2dOYW1lKFN0cmluZyBjYXROYW1lKSB7CiAgICAgICAgcmV0dXJuIGNhdE5h\nbWU7CiAgICB9Cn0KCg==\n","encoding":"base64"}

