{"sha":"b054a1c1139ff486d0d72162cd9e386ccd1bfef0","node_id":"MDQ6QmxvYjIwNjM2NDpiMDU0YTFjMTEzOWZmNDg2ZDBkNzIxNjJjZDllMzg2Y2NkMWJmZWYw","size":14180,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b054a1c1139ff486d0d72162cd9e386ccd1bfef0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UucmVsYXRp\nb25zOwoKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsK\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnRpdHlNYW5hZ2VyOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuUXVlcnk7CgppbXBvcnQganVuaXQudGV4\ndHVpLlRlc3RSdW5uZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBBRW50aXR5TWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBBUXVl\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UucXVl\ncnkuTWFnYXppbmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lz\ndGVuY2UucXVlcnkuUHVibGlzaGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLnRlc3QuU1FMTGlzdGVuZXJUZXN0Q2FzZTsKCgpw\ndWJsaWMgY2xhc3MgVGVzdEludmVyc2VFYWdlclNRTAogICAgZXh0ZW5kcyBT\nUUxMaXN0ZW5lclRlc3RDYXNlIHsKCiAgICBwdWJsaWMgaW50IG51bUN1c3Rv\nbWVycyA9IDE7CiAgICBwdWJsaWMgaW50IG51bU9yZGVyc1BlckN1c3RvbWVy\nID0gNDsKICAgIAogICAgcHVibGljIGludCBfblBlb3BsZSA9IDM7IAogICAg\ncHVibGljIGludCBfblBob25lcyA9IDM7CgogICAgcHVibGljIHZvaWQgc2V0\nVXAoKSB7CiAgICAgICAgc2V0VXAoQ3VzdG9tZXIuY2xhc3MsIEN1c3RvbWVy\nLkN1c3RvbWVyS2V5LmNsYXNzLCBPcmRlci5jbGFzcywgCiAgICAgICAgICAg\nIEVudGl0eUFJbnZlcnNlRWFnZXIuY2xhc3MsIEVudGl0eUExSW52ZXJzZUVh\nZ2VyLmNsYXNzLAogICAgICAgICAgICBFbnRpdHlBMkludmVyc2VFYWdlci5j\nbGFzcywgRW50aXR5QkludmVyc2VFYWdlci5jbGFzcywKICAgICAgICAgICAg\nRW50aXR5Q0ludmVyc2VFYWdlci5jbGFzcywgRW50aXR5REludmVyc2VFYWdl\nci5jbGFzcywKICAgICAgICAgICAgUHVibGlzaGVyLmNsYXNzLCBNYWdhemlu\nZS5jbGFzcywgCiAgICAgICAgICAgIFBQZXJzb24uY2xhc3MsIFBQaG9uZS5j\nbGFzcywgCiAgICAgICAgICAgIERST1BfVEFCTEVTKTsKCiAgICAgICAgLy8g\nTm90IGFsbCBkYXRhYmFzZXMgc3VwcG9ydCBHZW5lcmF0aW9uVHlwZS5JREVO\nVElUWSBjb2x1bW4ocykKICAgICAgICBpZiAoISgoSkRCQ0NvbmZpZ3VyYXRp\nb24pIGVtZi5nZXRDb25maWd1cmF0aW9uKCkpLgogICAgICAgICAgICBnZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpLnN1cHBvcnRzQXV0b0Fzc2lnbikgewog\nICAgICAgIAlyZXR1cm47CiAgICAgIAl9CiAgICAgICAgRW50aXR5TWFuYWdl\nciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwoKICAgICAgICBDdXN0b21lci5D\ndXN0b21lcktleSBjayA9IG5ldyBDdXN0b21lci5DdXN0b21lcktleSgiVVNB\nIiwgMSk7CiAgICAgICAgQ3VzdG9tZXIgYyA9IG5ldyBDdXN0b21lcigpOwog\nICAgICAgIGMuc2V0Q2lkKGNrKTsKICAgICAgICBjLnNldE5hbWUoImN1c3Rv\nbWVyMSIpOwogICAgICAgIGVtLnBlcnNpc3QoYyk7CgogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgbnVtT3JkZXJzUGVyQ3VzdG9tZXI7IGkrKykgewog\nICAgICAgICAgICBPcmRlciBvcmRlciA9IG5ldyBPcmRlcigpOwogICAgICAg\nICAgICBvcmRlci5zZXRDdXN0b21lcihjKTsKICAgICAgICAgICAgZW0ucGVy\nc2lzdChvcmRlcik7CiAgICAgICAgfQoKICAgICAgICBFbnRpdHlBSW52ZXJz\nZUVhZ2VyIGEgPSBuZXcgRW50aXR5QUludmVyc2VFYWdlcigiYSIpOwogICAg\nICAgIGVtLnBlcnNpc3QoYSk7CiAgICAgICAgCiAgICAgICAgRW50aXR5QTFJ\nbnZlcnNlRWFnZXIgYTEgPSBuZXcgRW50aXR5QTFJbnZlcnNlRWFnZXIoImEx\nIik7CiAgICAgICAgZW0ucGVyc2lzdChhMSk7CgogICAgICAgIEVudGl0eUEy\nSW52ZXJzZUVhZ2VyIGEyID0gbmV3IEVudGl0eUEySW52ZXJzZUVhZ2VyKCJh\nMiIpOwogICAgICAgIGVtLnBlcnNpc3QoYTIpOwoKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICBFbnRpdHlCSW52\nZXJzZUVhZ2VyIGIgPSBuZXcgRW50aXR5QkludmVyc2VFYWdlcigiYiIgKyBp\nKTsKICAgICAgICAgICAgYS5hZGRCKGIpOwogICAgICAgICAgICBiLnNldEEo\nYSk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYik7CiAgICAgICAgfQoKICAg\nICAgICBmb3IgKGludCBpID0gNDsgaSA8IDg7IGkrKykgewogICAgICAgICAg\nICBFbnRpdHlCSW52ZXJzZUVhZ2VyIGIgPSBuZXcgRW50aXR5QkludmVyc2VF\nYWdlcigiYiIgKyBpKTsKICAgICAgICAgICAgYTEuYWRkQihiKTsKICAgICAg\nICAgICAgYi5zZXRBKGExKTsKICAgICAgICAgICAgZW0ucGVyc2lzdChiKTsK\nICAgICAgICB9CgogICAgICAgIGZvciAoaW50IGkgPSA4OyBpIDwgMTI7IGkr\nKykgewogICAgICAgICAgICBFbnRpdHlCSW52ZXJzZUVhZ2VyIGIgPSBuZXcg\nRW50aXR5QkludmVyc2VFYWdlcigiYiIgKyBpKTsKICAgICAgICAgICAgYTIu\nYWRkQihiKTsKICAgICAgICAgICAgYi5zZXRBKGEyKTsKICAgICAgICAgICAg\nZW0ucGVyc2lzdChiKTsKICAgICAgICB9CgogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIEVudGl0eUNJbnZlcnNl\nRWFnZXIgYzEgPSBuZXcgRW50aXR5Q0ludmVyc2VFYWdlcigiYyIraSwgaSwg\naSk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoYzEpOwoKICAgICAgICAgICAg\nRW50aXR5REludmVyc2VFYWdlciBkMSA9IG5ldyBFbnRpdHlESW52ZXJzZUVh\nZ2VyKCJkIiArIGksICJkIiArIGksCiAgICAgICAgICAgICAgICAgICAgaSwg\naSk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoZDEpOwoKICAgICAgICAgICAg\nYzEuc2V0RChkMSk7CiAgICAgICAgICAgIGQxLnNldEMoYzEpOwogICAgICAg\nIH0KCiAgICAgICAgUHVibGlzaGVyIHAxID0gbmV3IFB1Ymxpc2hlcigpOwog\nICAgICAgIHAxLnNldE5hbWUoInB1Ymxpc2hlcjEiKTsKICAgICAgICBlbS5w\nZXJzaXN0KHAxKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA0OyBp\nKyspIHsKICAgICAgICAgICAgTWFnYXppbmUgbWFnYXppbmUgPSBuZXcgTWFn\nYXppbmUoKTsKICAgICAgICAgICAgbWFnYXppbmUuc2V0SWRQdWJsaXNoZXIo\ncDEpOwogICAgICAgICAgICBtYWdhemluZS5zZXROYW1lKCJtYWdhZ2luZSIr\naSsiXyIrcDEuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZW0ucGVyc2lzdCht\nYWdhemluZSk7CiAgICAgICAgfQoKICAgICAgICBQdWJsaXNoZXIgcDIgPSBu\nZXcgUHVibGlzaGVyKCk7CiAgICAgICAgcDIuc2V0TmFtZSgicHVibGlzaGVy\nMiIpOwogICAgICAgIGVtLnBlcnNpc3QocDIpOwoKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICBNYWdhemluZSBt\nYWdhemluZSA9IG5ldyBNYWdhemluZSgpOwogICAgICAgICAgICBtYWdhemlu\nZS5zZXRJZFB1Ymxpc2hlcihwMik7CiAgICAgICAgICAgIG1hZ2F6aW5lLnNl\ndE5hbWUoIm1hZ2FnaW5lIitpKyJfIitwMi5nZXROYW1lKCkpOwogICAgICAg\nICAgICBlbS5wZXJzaXN0KG1hZ2F6aW5lKTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgUFBlcnNvbiBwZXJzb247CiAgICAgICAgUFBob25lIHBob25l\nOwogICAgICAgIGZvcihpbnQgaSA9MDsgaSA8IF9uUGVvcGxlOyBpKyspIHsg\nCiAgICAgICAgICAgIHBlcnNvbiA9IG5ldyBQUGVyc29uKCk7CiAgICAgICAg\nICAgIHBlcnNvbi5zZXRQaG9uZXMobmV3IEFycmF5TGlzdDxQUGhvbmU+KCkp\nOwogICAgICAgICAgICBlbS5wZXJzaXN0KHBlcnNvbik7CiAgICAgICAgICAg\nIGZvcihpbnQgaiA9IDA7IGogPCBfblBob25lczsgaisrKSB7IAogICAgICAg\nICAgICAgICAgcGhvbmUgPSBuZXcgUFBob25lKCk7IAogICAgICAgICAgICAg\nICAgcGhvbmUuc2V0UGVvcGxlKG5ldyBBcnJheUxpc3Q8UFBlcnNvbj4oKSk7\nCiAgICAgICAgICAgICAgICBwaG9uZS5nZXRQZW9wbGUoKS5hZGQocGVyc29u\nKTsKICAgICAgICAgICAgICAgIHBlcnNvbi5nZXRQaG9uZXMoKS5hZGQocGhv\nbmUpOwogICAgICAgICAgICAgICAgZW0ucGVyc2lzdChwaG9uZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGVtLmZsdXNoKCk7CiAgICAg\nICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICBlbS5j\nbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RPbmVUb01hbnlJ\nbnZlcnNlRWFnZXJRdWVyeSgpIHsKICAgICAgICAvLyBOb3QgYWxsIGRhdGFi\nYXNlcyBzdXBwb3J0IEdlbmVyYXRpb25UeXBlLklERU5USVRZIGNvbHVtbihz\nKQogICAgICAgIGlmICghKChKREJDQ29uZmlndXJhdGlvbikgZW1mLmdldENv\nbmZpZ3VyYXRpb24oKSkuCiAgICAgICAgICAgIGdldERCRGljdGlvbmFyeUlu\nc3RhbmNlKCkuc3VwcG9ydHNBdXRvQXNzaWduKSB7CiAgICAgICAgCXJldHVy\nbjsKICAgICAgCX0KICAgICAgICBzcWwuY2xlYXIoKTsKCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdl\ncigpOwogICAgICAgIE9wZW5KUEFRdWVyeSBxID0gZW0uY3JlYXRlUXVlcnko\nIlNFTEVDVCBjIEZST00gQ3VzdG9tZXIgYyAiKTsKICAgICAgICBMaXN0PEN1\nc3RvbWVyPiByZXMgPSBxLmdldFJlc3VsdExpc3QoKTsgCgogICAgICAgIGFz\nc2VydEVxdWFscygxLCByZXMuc2l6ZSgpKTsKCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCByZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgQ3Vz\ndG9tZXIgYyA9IChDdXN0b21lcilyZXMuZ2V0KGkpOwogICAgICAgICAgICBD\nb2xsZWN0aW9uPE9yZGVyPiBvcmRlcnMgPSBjLmdldE9yZGVycygpOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yPE9yZGVyPiBpdGVyPW9yZGVycy5pdGVy\nYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIE9y\nZGVyIG9yZGVyID0gKE9yZGVyKWl0ZXIubmV4dCgpOwogICAgICAgICAgICAg\nICAgYXNzZXJ0RXF1YWxzKG9yZGVyLmdldEN1c3RvbWVyKCksIGMpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRFcXVhbHMoMiwg\nc3FsLnNpemUoKSk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0T25lVG9PbmVJbnZlcnNlRWFnZXJRdWVyeSgpIHsK\nICAgICAgICAvLyBOb3QgYWxsIGRhdGFiYXNlcyBzdXBwb3J0IEdlbmVyYXRp\nb25UeXBlLklERU5USVRZIGNvbHVtbihzKQogICAgICAgIGlmICghKChKREJD\nQ29uZmlndXJhdGlvbikgZW1mLmdldENvbmZpZ3VyYXRpb24oKSkuCiAgICAg\nICAgICAgIGdldERCRGljdGlvbmFyeUluc3RhbmNlKCkuc3VwcG9ydHNBdXRv\nQXNzaWduKSB7CgkJCXJldHVybjsKCQl9CiAgICAgICAgc3FsLmNsZWFyKCk7\nCgogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBTdHJpbmcgcXVlcnkgPSAic2Vs\nZWN0IGMgRlJPTSBFbnRpdHlDSW52ZXJzZUVhZ2VyIGMiOwogICAgICAgIFF1\nZXJ5IHEgPSBlbS5jcmVhdGVRdWVyeShxdWVyeSk7CiAgICAgICAgTGlzdDxF\nbnRpdHlDSW52ZXJzZUVhZ2VyPiByZXMgPSBxLmdldFJlc3VsdExpc3QoKTsK\nICAgICAgICBhc3NlcnRFcXVhbHMoNCwgcmVzLnNpemUoKSk7CgogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgIEVudGl0eUNJbnZlcnNlRWFnZXIgYyA9IChFbnRpdHlDSW52ZXJz\nZUVhZ2VyKXJlcy5nZXQoaSk7CiAgICAgICAgICAgIEVudGl0eURJbnZlcnNl\nRWFnZXIgZCA9IGMuZ2V0RCgpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nYywgZC5nZXRDKCkpOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0RXF1YWxz\nKDEsIHNxbC5zaXplKCkpOwogICAgICAgIGVtLmNsb3NlKCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgdGVzdE9uZVRvTWFueUluaGVyaXRhbmNlUXVlcnko\nKSB7CiAgICAgICAgLy8gTm90IGFsbCBkYXRhYmFzZXMgc3VwcG9ydCBHZW5l\ncmF0aW9uVHlwZS5JREVOVElUWSBjb2x1bW4ocykKICAgICAgICBpZiAoISgo\nSkRCQ0NvbmZpZ3VyYXRpb24pIGVtZi5nZXRDb25maWd1cmF0aW9uKCkpLgog\nICAgICAgICAgICBnZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpLnN1cHBvcnRz\nQXV0b0Fzc2lnbikgewoJCQlyZXR1cm47CgkJfQogICAgICAgIHNxbC5jbGVh\ncigpOwoKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5j\ncmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgU3RyaW5nIHF1ZXJ5ID0g\nInNlbGVjdCBhIEZST00gRW50aXR5QTFJbnZlcnNlRWFnZXIgYSI7CiAgICAg\nICAgUXVlcnkgcSA9IGVtLmNyZWF0ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICBM\naXN0IGxpc3QgPSBxLmdldFJlc3VsdExpc3QoKTsKICAgICAgICBhc3NlcnRF\ncXVhbHMoMSwgbGlzdC5zaXplKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgewogICAgICAgICAgICBFbnRpdHlB\nMUludmVyc2VFYWdlciBhMSA9IChFbnRpdHlBMUludmVyc2VFYWdlcilsaXN0\nLmdldChpKTsKICAgICAgICAgICAgQ29sbGVjdGlvbjxFbnRpdHlCSW52ZXJz\nZUVhZ2VyPiBsaXN0QiA9IGExLmdldExpc3RCKCk7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscyg0LCBsaXN0Qi5zaXplKCkpOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ZXI9bGlzdEIuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICBFbnRpdHlCSW52ZXJzZUVhZ2VyIGIg\nPSAoRW50aXR5QkludmVyc2VFYWdlcilpdGVyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIEVudGl0eUFJbnZlcnNlRWFnZXIgYSA9IGIuZ2V0QSgpOwogICAg\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGExLCBhKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMoMywgc3FsLnNpemUo\nKSk7CiAgICAgICAgc3FsLmNsZWFyKCk7CgogICAgICAgIHF1ZXJ5ID0gInNl\nbGVjdCBhIEZST00gRW50aXR5QTJJbnZlcnNlRWFnZXIgYSI7CiAgICAgICAg\ncSA9IGVtLmNyZWF0ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICBsaXN0ID0gcS5n\nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEsIGxpc3Qu\nc2l6ZSgpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxpc3Quc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgRW50aXR5QTJJbnZlcnNlRWFnZXIg\nYTIgPSAoRW50aXR5QTJJbnZlcnNlRWFnZXIpbGlzdC5nZXQoaSk7CiAgICAg\nICAgICAgIENvbGxlY3Rpb24gbGlzdEIgPSBhMi5nZXRMaXN0QigpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoNCwgbGlzdEIuc2l6ZSgpKTsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdGVyPWxpc3RCLml0ZXJhdG9yKCk7IGl0\nZXIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgRW50aXR5QkludmVy\nc2VFYWdlciBiID0gKEVudGl0eUJJbnZlcnNlRWFnZXIpaXRlci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBFbnRpdHlBSW52ZXJzZUVhZ2VyIGEgPSBiLmdl\ndEEoKTsKICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhhMiwgYSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKDMs\nIHNxbC5zaXplKCkpOwogICAgICAgIHNxbC5jbGVhcigpOwoKICAgICAgICBx\ndWVyeSA9ICJzZWxlY3QgYSBGUk9NIEVudGl0eUFJbnZlcnNlRWFnZXIgYSI7\nCiAgICAgICAgcSA9IGVtLmNyZWF0ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICBs\naXN0ID0gcS5nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKDMsIGxpc3Quc2l6ZSgpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGxpc3Quc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgRW50aXR5QUludmVy\nc2VFYWdlciBhMCA9IChFbnRpdHlBSW52ZXJzZUVhZ2VyKWxpc3QuZ2V0KGkp\nOwogICAgICAgICAgICBDb2xsZWN0aW9uIGxpc3RCID0gYTAuZ2V0TGlzdEIo\nKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDQsIGxpc3RCLnNpemUoKSk7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRlcj1saXN0Qi5pdGVyYXRv\ncigpOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIEVudGl0\neUJJbnZlcnNlRWFnZXIgYiA9IChFbnRpdHlCSW52ZXJzZUVhZ2VyKWl0ZXIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgRW50aXR5QUludmVyc2VFYWdlciBh\nID0gYi5nZXRBKCk7CiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoYTAs\nIGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRF\ncXVhbHMoMiwgc3FsLnNpemUoKSk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0T25lVG9NYW55RWFnZXJJbnZlcnNl\nTGF6eVF1ZXJ5KCkgewogICAgICAgIC8vIE5vdCBhbGwgZGF0YWJhc2VzIHN1\ncHBvcnQgR2VuZXJhdGlvblR5cGUuSURFTlRJVFkgY29sdW1uKHMpCiAgICAg\nICAgaWYgKCEoKEpEQkNDb25maWd1cmF0aW9uKSBlbWYuZ2V0Q29uZmlndXJh\ndGlvbigpKS4KICAgICAgICAgICAgZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2Uo\nKS5zdXBwb3J0c0F1dG9Bc3NpZ24pIHsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICBzcWwuY2xlYXIoKTsKCiAgICAgICAgT3BlbkpQ\nQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOwogICAgICAgIFN0cmluZyBxdWVyeSA9ICJzZWxlY3QgcCBGUk9NIFB1Ymxp\nc2hlciBwIjsKICAgICAgICBRdWVyeSBxID0gZW0uY3JlYXRlUXVlcnkocXVl\ncnkpOwogICAgICAgIExpc3QgbGlzdCA9IHEuZ2V0UmVzdWx0TGlzdCgpOwog\nICAgICAgIGFzc2VydEVxdWFscygyLCBsaXN0LnNpemUoKSk7CiAgICAgICAg\nYXNzZXJ0RXF1YWxzKDIsIHNxbC5zaXplKCkpOwoKICAgICAgICBzcWwuY2xl\nYXIoKTsKICAgICAgICBlbS5jbGVhcigpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgewogICAgICAgICAgICBQdWJs\naXNoZXIgcCA9IChQdWJsaXNoZXIpIGxpc3QuZ2V0KGkpOwogICAgICAgICAg\nICBTZXQ8TWFnYXppbmU+IG1hZ2F6aW5lcyA9IHAuZ2V0TWFnYXppbmVDb2xs\nZWN0aW9uKCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyg0LCBtYWdhemlu\nZXMuc2l6ZSgpKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0g\nbWFnYXppbmVzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgTWFnYXppbmUgbSA9IChNYWdhemluZSkgaXRlci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBQdWJsaXNoZXIgbXAgPSBtLmdldElkUHVi\nbGlzaGVyKCk7CiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMocCwgbXAp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRFcXVh\nbHMoMCwgc3FsLnNpemUoKSk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0K\nICAgIAogICAgcHVibGljIHZvaWQgdGVzdE1hbnlUb01hbnlFYWdlckVhZ2Vy\nSW52ZXJzZUxhenlRdWVyeSgpIHsKICAgICAgICAvLyBOb3QgYWxsIGRhdGFi\nYXNlcyBzdXBwb3J0IEdlbmVyYXRpb25UeXBlLklERU5USVRZIGNvbHVtbihz\nKQogICAgICAgIGlmICghKChKREJDQ29uZmlndXJhdGlvbikgZW1mLmdldENv\nbmZpZ3VyYXRpb24oKSkuCiAgICAgICAgICAgIGdldERCRGljdGlvbmFyeUlu\nc3RhbmNlKCkuc3VwcG9ydHNBdXRvQXNzaWduKSB7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgc3FsLmNsZWFyKCk7CgogICAgICAg\nIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKICAgICAgICBTdHJpbmcgcXVlcnkgPSAic2VsZWN0IHAgRlJP\nTSBQUGVyc29uIHAiOwogICAgICAgIFF1ZXJ5IHEgPSBlbS5jcmVhdGVRdWVy\neShxdWVyeSk7CiAgICAgICAgTGlzdCBsaXN0ID0gcS5nZXRSZXN1bHRMaXN0\nKCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKF9uUGVvcGxlLCBsaXN0LnNpemUo\nKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDcsIHNxbC5zaXplKCkpOwoKICAg\nICAgICBzcWwuY2xlYXIoKTsKICAgICAgICBlbS5jbGVhcigpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgewogICAg\nICAgICAgICBQUGVyc29uIHAgPSAoUFBlcnNvbikgbGlzdC5nZXQoaSk7CiAg\nICAgICAgICAgIENvbGxlY3Rpb248UFBob25lPiBwaG9uZXMgPSBwLmdldFBo\nb25lcygpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoX25QaG9uZXMsIHBo\nb25lcy5zaXplKCkpOwogICAgICAgICAgICBmb3IoUFBob25lIHBob25lIDog\ncC5nZXRQaG9uZXMoKSkgewogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TnVs\nbChwaG9uZS5nZXRQZW9wbGUoKSk7CiAgICAgICAgICAgICAgICBhc3NlcnRU\ncnVlKHBob25lLmdldFBlb3BsZSgpLmNvbnRhaW5zKHApKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMoMCwgc3FsLnNp\nemUoKSk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0VGFyZ2V0T3JwaGFuUmVtb3ZhbCgpIHsKICAgICAgICAvLyBO\nb3QgYWxsIGRhdGFiYXNlcyBzdXBwb3J0IEdlbmVyYXRpb25UeXBlLklERU5U\nSVRZIGNvbHVtbihzKQogICAgICAgIGlmICghKChKREJDQ29uZmlndXJhdGlv\nbikgZW1mLmdldENvbmZpZ3VyYXRpb24oKSkuCiAgICAgICAgICAgIGdldERC\nRGljdGlvbmFyeUluc3RhbmNlKCkuc3VwcG9ydHNBdXRvQXNzaWduKSB7CgkJ\nCXJldHVybjsKCQl9CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0g\nPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGludCBjb3Vu\ndCA9IGNvdW50KE9yZGVyLmNsYXNzKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nbnVtT3JkZXJzUGVyQ3VzdG9tZXIgKiBudW1DdXN0b21lcnMsIGNvdW50KTsK\nCiAgICAgICAgQ3VzdG9tZXIuQ3VzdG9tZXJLZXkgY2sgPSBuZXcgQ3VzdG9t\nZXIuQ3VzdG9tZXJLZXkoIlVTQSIsIDEpOwogICAgICAgIEN1c3RvbWVyIGMg\nPSBlbS5maW5kKEN1c3RvbWVyLmNsYXNzLCBjayk7CiAgICAgICAgQ29sbGVj\ndGlvbjxPcmRlcj4gb3JkZXJzID0gYy5nZXRPcmRlcnMoKTsKICAgICAgICBh\nc3NlcnRFcXVhbHMobnVtT3JkZXJzUGVyQ3VzdG9tZXIsIG9yZGVycy5zaXpl\nKCkpOwoKICAgICAgICAvLyBPcnBoYW5SZW1vdmFsOiByZW1vdmUgdGFyZ2V0\nOiB0aGUgb3JkZXIgd2lsbCBiZSBkZWxldGVkIGZyb20gZGIKICAgICAgICBm\nb3IgKE9yZGVyIG9yZGVyIDogb3JkZXJzKSB7CiAgICAgICAgICAgIG9yZGVy\ncy5yZW1vdmUob3JkZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9\nCiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAg\nIGVtLnBlcnNpc3QoYyk7CiAgICAgICAgZW0uZmx1c2goKTsKICAgICAgICBl\nbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgIGVtLmNsZWFy\nKCk7CgogICAgICAgIGMgPSBlbS5maW5kKEN1c3RvbWVyLmNsYXNzLCBjayk7\nCiAgICAgICAgb3JkZXJzID0gYy5nZXRPcmRlcnMoKTsKICAgICAgICBhc3Nl\ncnRFcXVhbHMobnVtT3JkZXJzUGVyQ3VzdG9tZXIgLSAxLCBvcmRlcnMuc2l6\nZSgpKTsKICAgICAgICBjb3VudCA9IGNvdW50KE9yZGVyLmNsYXNzKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMobnVtT3JkZXJzUGVyQ3VzdG9tZXIgKiBudW1D\ndXN0b21lcnMgLSAxLCBjb3VudCk7CiAgICAgICAgZW0uY2xlYXIoKTsKCiAg\nICAgICAgLy8gT3JwaGFuUmVtb3ZhbDogcmVtb3ZlIHRhcmdldDogc2V0T3Jk\nZXJzIHRvIG51bGwKICAgICAgICBjID0gZW0uZmluZChDdXN0b21lci5jbGFz\ncywgY2spOwogICAgICAgIGMuc2V0T3JkZXJzKG51bGwpOwogICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBlbS5wZXJzaXN0\nKGMpOwogICAgICAgIGVtLmZsdXNoKCk7CiAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5jb21taXQoKTsKICAgICAgICBlbS5jbGVhcigpOwoKICAgICAg\nICBjb3VudCA9IGNvdW50KE9yZGVyLmNsYXNzKTsKICAgICAgICBhc3NlcnRF\ncXVhbHMobnVtT3JkZXJzUGVyQ3VzdG9tZXIgKiAobnVtQ3VzdG9tZXJzIC0g\nMSksIGNvdW50KTsKICAgICAgICBjID0gZW0uZmluZChDdXN0b21lci5jbGFz\ncywgY2spOwogICAgICAgIG9yZGVycyA9IGMuZ2V0T3JkZXJzKCk7CiAgICAg\nICAgaWYgKG9yZGVycyAhPSBudWxsKQogICAgICAgICAgICBhc3NlcnRFcXVh\nbHMoMCwgb3JkZXJzLnNpemUoKSk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0U291cmNlT3JwaGFuUmVtb3ZhbCgp\nIHsKICAgICAgICAvLyBOb3QgYWxsIGRhdGFiYXNlcyBzdXBwb3J0IEdlbmVy\nYXRpb25UeXBlLklERU5USVRZIGNvbHVtbihzKQogICAgICAgIGlmICghKChK\nREJDQ29uZmlndXJhdGlvbikgZW1mLmdldENvbmZpZ3VyYXRpb24oKSkuCiAg\nICAgICAgICAgIGdldERCRGljdGlvbmFyeUluc3RhbmNlKCkuc3VwcG9ydHNB\ndXRvQXNzaWduKSB7CgkJCXJldHVybjsKCQl9CiAgICAgICAgT3BlbkpQQUVu\ndGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwog\nICAgICAgIC8vIE9ycGhhblJlbW92YWw6IHJlbW92ZSBzb3VyY2UKICAgICAg\nICBDdXN0b21lci5DdXN0b21lcktleSBjayA9IG5ldyBDdXN0b21lci5DdXN0\nb21lcktleSgiVVNBIiwgMSk7CiAgICAgICAgQ3VzdG9tZXIgYyA9IGVtLmZp\nbmQoQ3VzdG9tZXIuY2xhc3MsIGNrKTsKICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLmJlZ2luKCk7CiAgICAgICAgZW0ucmVtb3ZlKGMpOwogICAgICAg\nIGVtLmZsdXNoKCk7CiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21t\naXQoKTsKICAgICAgICBlbS5jbGVhcigpOwoKICAgICAgICBpbnQgY291bnQg\nPSBjb3VudChPcmRlci5jbGFzcyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKG51\nbU9yZGVyc1BlckN1c3RvbWVyICogKG51bUN1c3RvbWVycyAtIDEpLCBjb3Vu\ndCk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAgICAgIFRl\nc3RSdW5uZXIucnVuKFRlc3RJbnZlcnNlRWFnZXJTUUwuY2xhc3MpOwogICAg\nfQp9Cgo=\n","encoding":"base64"}

