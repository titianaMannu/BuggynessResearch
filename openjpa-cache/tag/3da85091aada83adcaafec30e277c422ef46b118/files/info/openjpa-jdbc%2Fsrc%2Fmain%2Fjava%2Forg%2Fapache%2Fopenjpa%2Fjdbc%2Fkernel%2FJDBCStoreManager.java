{"sha":"7ff7a25ae3f7292c91dbcdf8a2595809f41a4e07","node_id":"MDQ6QmxvYjIwNjM2NDo3ZmY3YTI1YWUzZjcyOTJjOTFkYmNkZjhhMjU5NTgwOWY0MWE0ZTA3","size":52177,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7ff7a25ae3f7292c91dbcdf8a2595809f41a4e07","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3Rh\ndGVtZW50OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLlNldDsKaW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5PcnBoYW5lZEtleUFj\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRC\nQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5TeW50YXhlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVj\ndXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Vbmlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5M\nb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29ubmVjdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nUHJl\ncGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmpkYmMuRGVsZWdhdGluZ1N0YXRlbWVudDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0\nUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xh\nc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZp\nZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5K\nYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5B\ncHBsaWNhdGlvbklkczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3Jl\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNl\nckV4Y2VwdGlvbjsKCi8qKgogKiBTdG9yZU1hbmFnZXIgcGx1Z2luIHRoYXQg\ndXNlcyBKREJDIHRvIHN0b3JlIHBlcnNpc3RlbnQgZGF0YSBpbiBhCiAqIHJl\nbGF0aW9uYWwgZGF0YSBzdG9yZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZU1hbmFn\nZXIgCiAgICBpbXBsZW1lbnRzIFN0b3JlTWFuYWdlciwgSkRCQ1N0b3JlIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEpEQkNTdG9yZU1hbmFnZXIu\nY2xhc3MpOwoKICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9jdHggPSBudWxs\nOwogICAgcHJpdmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7\nCiAgICBwcml2YXRlIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CiAgICBw\ncml2YXRlIFNRTEZhY3RvcnkgX3NxbCA9IG51bGw7CiAgICBwcml2YXRlIEpE\nQkNMb2NrTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhU291\ncmNlIF9kcyA9IG51bGw7CiAgICBwcml2YXRlIFJlZkNvdW50Q29ubmVjdGlv\nbiBfY29ubiA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2FjdGl2ZSA9\nIGZhbHNlOwoKICAgIC8vIHRyYWNrIHRoZSBwZW5kaW5nIHN0YXRlbWVudHMg\nc28gd2UgY2FuIGNhbmNlbCB0aGVtCiAgICBwcml2YXRlIFNldCBfc3RtbnRz\nID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkU2V0KG5ldyBIYXNoU2V0KCkp\nOwoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAg\nICAgICByZXR1cm4gX2N0eDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRD\nb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBfY3R4ID0gY3R4\nOwogICAgICAgIF9jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBjdHguZ2V0\nQ29uZmlndXJhdGlvbigpOwogICAgICAgIF9kaWN0ID0gX2NvbmYuZ2V0REJE\naWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBfc3FsID0gX2NvbmYuZ2V0\nU1FMRmFjdG9yeUluc3RhbmNlKCk7CgogICAgICAgIExvY2tNYW5hZ2VyIGxt\nID0gY3R4LmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAgaWYgKGxtIGluc3Rh\nbmNlb2YgSkRCQ0xvY2tNYW5hZ2VyKQogICAgICAgICAgICBfbG0gPSAoSkRC\nQ0xvY2tNYW5hZ2VyKSBsbTsKCiAgICAgICAgaWYgKCFjdHguaXNNYW5hZ2Vk\nKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkp\nCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3VyY2UyKGN0eCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHMgPSBfY29uZi5nZXREYXRh\nU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRVcGRhdGVNYW5h\nZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAgICAgIGN0eC5z\nZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMg\nSkRCQ0NvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVibGljIERCRGljdGlvbmFy\neSBnZXREQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0Owog\nICAgfQoKICAgIHB1YmxpYyBTUUxGYWN0b3J5IGdldFNRTEZhY3RvcnkoKSB7\nCiAgICAgICAgcmV0dXJuIF9zcWw7CiAgICB9CgogICAgcHVibGljIEpEQkNM\nb2NrTWFuYWdlciBnZXRMb2NrTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4g\nX2xtOwogICAgfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gKEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24pIF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5PcHRpbWlzdGlj\nKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrT3B0aW1pc3Rp\nYygpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAg\nICBfYWN0aXZlID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25G\nYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgICYmIF9jb25u\nLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgIF9jb25uLnNldEF1\ndG9Db21taXQoZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAg\nICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0KCkgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2N0eC5pc01hbmFnZWQo\nKSB8fCAhX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkp\nCiAgICAgICAgICAgICAgICBfY29ubi5jb21taXQoKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHsKICAgICAgICAgICAgfQogICAg\nICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGlj\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2ZSA9\nIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xs\nYmFjaygpIHsKICAgICAgICAvLyBhbHJlYWR5IHJvbGxlZCBiYWNrIG91cnNl\nbHZlcz8KICAgICAgICBpZiAoIV9hY3RpdmUpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9jb25uICE9IG51\nbGwKICAgICAgICAgICAgICAgICYmICghX2N0eC5pc01hbmFnZWQoKSB8fCAh\nX2NvbmYKICAgICAgICAgICAgICAgICAgICAuaXNDb25uZWN0aW9uRmFjdG9y\neU1vZGVNYW5hZ2VkKCkpKQogICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJh\nY2soKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUg\nPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0\nYWluQ29ubmVjdGlvbigpIHsKICAgICAgICBjb25uZWN0KGZhbHNlKTsKICAg\nICAgICBfY29ubi5zZXRSZXRhaW4odHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVsZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKF9jb25u\nICE9IG51bGwpCiAgICAgICAgICAgIF9jb25uLnNldFJldGFpbihmYWxzZSk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRDbGllbnRDb25uZWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29ubmVjdGlvbihnZXRD\nb25uZWN0aW9uKCkpOwogICAgfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGdl\ndENvbm5lY3Rpb24oKSB7CiAgICAgICAgY29ubmVjdCh0cnVlKTsKICAgICAg\nICByZXR1cm4gX2Nvbm47CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZXhp\nc3RzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBjb250ZXh0KSB7\nCiAgICAgICAgLy8gYWRkIHdoZXJlIGNvbmRpdGlvbnMgb24gYmFzZSBjbGFz\ncyB0byBhdm9pZCBqb2lucyBpZiBzdWJjbGFzcwogICAgICAgIC8vIGRvZXNu\nJ3QgdXNlIG9pZCBhcyBpZGVudGlmaWVyCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwog\nICAgICAgIHJldHVybiBleGlzdHMobWFwcGluZywgc20uZ2V0T2JqZWN0SWQo\nKSwgY29udGV4dCk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGV4aXN0\ncyhDbGFzc01hcHBpbmcgbWFwcGluZywgT2JqZWN0IG9pZCwgT2JqZWN0IGNv\nbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0aW9ucyBvbiBi\nYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNzCiAgICAgICAg\nLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAgICAgICBTZWxl\nY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICB3aGlsZSAobWFw\ncGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxs\nKQogICAgICAgICAgICBtYXBwaW5nID0gbWFwcGluZy5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKCiAgICAgICAgc2VsLndoZXJlUHJpbWFy\neUtleShvaWQsIG1hcHBpbmcsIHRoaXMpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBzZWwuZ2V0Q291bnQodGhpcykgIT0gMDsKICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhy\nb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lvbihPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29udGV4dCkgewogICAgICAg\nIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0\nTWV0YURhdGEoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nbWFwcGluZy5nZXRWZXJzaW9uKCkuY2hlY2tWZXJzaW9uKHNtLCB0aGlzLCB0\ncnVlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGNvbXBhcmVW\nZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc3RhdGUsIE9iamVjdCB2MSwg\nT2JqZWN0IHYyKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAo\nQ2xhc3NNYXBwaW5nKSBzdGF0ZS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHJl\ndHVybiBtYXBwaW5nLmdldFZlcnNpb24oKS5jb21wYXJlVmVyc2lvbih2MSwg\ndjIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGluaXRpYWxpemUoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBzdGF0ZSwKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IChDb25uZWN0aW9uSW5mbykg\nY29udGV4dDsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gaW5p\ndGlhbGl6ZVN0YXRlKHNtLCBzdGF0ZSwgKEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24pZmV0Y2gsIAogICAgICAgICAgICAgICAgaW5mbyk7CiAgICAgICAgfSBj\nYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBT\nUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5ld2x5LWxvYWRl\nZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGluaXRp\nYWxpemVTdGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0\nYXRlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIENv\nbm5lY3Rpb25JbmZvIGluZm8pCiAgICAgICAgdGhyb3dzIENsYXNzTm90Rm91\nbmRFeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG9p\nZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChpbmZvICE9IG51bGwgJiYgaW5mby5yZXN1bHQgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgcmVzID0gaW5mby5yZXN1bHQ7CiAgICAgICAg\nICAgICAgICBpbmZvLnNtID0gc207CiAgICAgICAgICAgICAgICBpZiAoaW5m\nby5tYXBwaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaW5mby5t\nYXBwaW5nID0gbWFwcGluZzsKICAgICAgICAgICAgICAgIG1hcHBpbmcgPSBp\nbmZvLm1hcHBpbmc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob2lkIGluc3Rh\nbmNlb2YgT3BlbkpQQUlkCiAgICAgICAgICAgICAgICAmJiAhKChPcGVuSlBB\nSWQpIG9pZCkuaGFzU3ViY2xhc3NlcygpKSB7CiAgICAgICAgICAgICAgICBC\nb29sZWFuIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20sIG1hcHBpbmcsIHN0YXRl\nLCBmZXRjaCk7CiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1c3RvbS5ib29sZWFuVmFs\ndWUoKTsKICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxpemVTdGF0\nZVJlc3VsdChzbSwgbWFwcGluZywgZmV0Y2gsCiAgICAgICAgICAgICAgICAg\nICAgU2VsZWN0LlNVQlNfRVhBQ1QpOwogICAgICAgICAgICAgICAgaWYgKHJl\ncyA9PSBudWxsICYmICFzZWxlY3RQcmltYXJ5S2V5KHNtLCBtYXBwaW5nLCBm\nZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmICFyZXMubmV4dCgpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBp\nbmdzID0gbWFwcGluZy4KICAgICAgICAgICAgICAgICAgICBnZXRJbmRlcGVu\nZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgICAgICAgICAgICAgaWYg\nKG1hcHBpbmdzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAg\nbWFwcGluZyA9IG1hcHBpbmdzWzBdOwogICAgICAgICAgICAgICAgICAgIEJv\nb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFwcGluZywgc3RhdGUs\nIGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VzdG9tICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b20uYm9v\nbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5p\ndGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRjaCwKICAgICAg\nICAgICAgICAgICAgICAgICAgU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxFKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVj\ndFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5pdGlhbGl6ZVN0\nYXRlVW5pb25SZXN1bHQoc20sIG1hcHBpbmcsIG1hcHBpbmdzLAogICAgICAg\nICAgICAgICAgICAgICAgICBmZXRjaCk7CiAgICAgICAgICAgICAgICBpZiAo\ncmVzICE9IG51bGwgJiYgIXJlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBmaWd1cmUgb3V0IHdoYXQgdHlwZSBvZiBvYmplY3QgdGhpcyBpczsgdGhl\nIHN0YXRlIG1hbmFnZXIKICAgICAgICAgICAgLy8gb25seSBndWFyYW50ZWVz\nIHRvIHByb3ZpZGUgYSBiYXNlIGNsYXNzCiAgICAgICAgICAgIENsYXNzIHR5\ncGU7CiAgICAgICAgICAgIGlmIChyZXMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHR5cGUgPSBtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAocmVzLmdldEJhc2VN\nYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBtYXBwaW5n\nID0gcmVzLmdldEJhc2VNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICByZXMu\nc3RhcnREYXRhUmVxdWVzdChtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKSk7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHR5\ncGUgPSBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5nZXRDbGFzcyh0aGlz\nLCBtYXBwaW5nLAogICAgICAgICAgICAgICAgICAgICAgICByZXMpOwogICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBy\nZXMuZW5kRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc3RhdGUg\nbWFuYWdlcjsgdGhpcyBtYXkgY2hhbmdlIHRoZSBtYXBwaW5nCiAgICAgICAg\nICAgIC8vIGFuZCB0aGUgb2JqZWN0IGlkIGluc3RhbmNlIGlmIHRoZSB0eXBl\nIGFzIGRldGVybWluZWQKICAgICAgICAgICAgLy8gZnJvbSB0aGUgaW5kaWNh\ndG9yIGlzIGEgc3ViY2xhc3Mgb2YgZXhwZWN0ZWQgdHlwZQogICAgICAgICAg\nICBzbS5pbml0aWFsaXplKHR5cGUsIHN0YXRlKTsKCiAgICAgICAgICAgIC8v\nIGxvYWQgdGhlIHNlbGVjdGVkIG1hcHBpbmdzIGludG8gdGhlIGdpdmVuIHN0\nYXRlIG1hbmFnZXIKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAvLyByZS1nZXQgdGhlIG1hcHBpbmcgaW4gY2FzZSB0\naGUgaW5zdGFuY2Ugd2FzIGEgc3ViY2xhc3MKICAgICAgICAgICAgICAgIG1h\ncHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAg\nICAgICAgICAgICAgbG9hZChtYXBwaW5nLCBzbSwgZmV0Y2gsIHJlcyk7CiAg\nICAgICAgICAgICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxvYWQo\nc20sIHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChyZXMg\nIT0gbnVsbCAmJiAoaW5mbyA9PSBudWxsIHx8IHJlcyAhPSBpbmZvLnJlc3Vs\ndCkpCiAgICAgICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB0aGUgbWFwcGluZyB0byBjdXN0\nb20gbG9hZCBkYXRhLiBSZXR1cm4gbnVsbCBpZiB0aGUgbWFwcGluZwogICAg\nICogZG9lcyBub3QgdXNlIGN1c3RvbSBsb2FkaW5nLgogICAgICovCiAgICBw\ncml2YXRlIEJvb2xlYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBQQ1N0YXRlIHN0\nYXRlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRo\ncm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgbWFwcGluZyB0YWtlcyBj\nYXJlIG9mIGluaXRpYWxpemF0aW9uCiAgICAgICAgaWYgKCFtYXBwaW5nLmN1\nc3RvbUxvYWQoc20sIHRoaXMsIHN0YXRlLCBmZXRjaCkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lv\nbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybiBC\nb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBkYXRh\nIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UgYW5kIHJldHVybiB0aGUgcmVzdWx0\nLiBSZXR1cm4KICAgICAqIG51bGwgaWYgdGhlcmUgaXMgbm8gZGF0YSBpbiB0\naGUgY3VycmVudCBmZXRjaCBncm91cHMgdG8gc2VsZWN0LgogICAgICovCiAg\nICBwcml2YXRlIFJlc3VsdCBnZXRJbml0aWFsaXplU3RhdGVSZXN1bHQoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHN1YnMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2VsZWN0\nIHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgaWYgKCFzZWxlY3Qo\nc2VsLCBtYXBwaW5nLCBzdWJzLCBzbSwgbnVsbCwgZmV0Y2gsCiAgICAgICAg\nICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTiwgdHJ1ZSwg\nZmFsc2UpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBzZWwu\nd2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmcsIHRo\naXMpOwogICAgICAgIHNlbC5zZXRFeHBlY3RlZFJlc3VsdENvdW50KDEsIGZh\nbHNlKTsKICAgICAgICByZXR1cm4gc2VsLmV4ZWN1dGUodGhpcywgZmV0Y2gp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGEgdW5pb24gb2YgdGhl\nIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHBvc3NpYmxlIGNv\nbmNyZXRlCiAgICAgKiBtYXBwaW5ncyBhbmQgcmV0dXJuIHRoZSByZXN1bHQu\nCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxpemVTdGF0\nZVVuaW9uUmVzdWx0KGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGZpbmFsIENsYXNzTWFwcGlu\nZ1tdIG1hcHBpbmdzLAogICAgICAgIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGZp\nbmFsIEpEQkNTdG9yZU1hbmFnZXIgc3RvcmUgPSB0aGlzOwogICAgICAgIGZp\nbmFsIGludCBlYWdlciA9IE1hdGgubWluKGZldGNoLmdldEVhZ2VyRmV0Y2hN\nb2RlKCksCiAgICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFH\nRVJfSk9JTik7CgogICAgICAgIFVuaW9uIHVuaW9uID0gX3NxbC5uZXdVbmlv\nbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgIHVuaW9uLnNldEV4cGVjdGVk\nUmVzdWx0Q291bnQoMSwgZmFsc2UpOwogICAgICAgIGlmIChmZXRjaC5nZXRT\ndWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBmZXRjaC5FQUdFUl9KT0lO\nKQogICAgICAgICAgICB1bmlvbi5hYm9ydFVuaW9uKCk7CiAgICAgICAgdW5p\nb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpKSB7CiAgICAg\nICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmdzW2ldLCBTZWxlY3QuU1VC\nU19BTllfSk9JTkFCTEUsIHN0b3JlLCBmZXRjaCwKICAgICAgICAgICAgICAg\nICAgICBlYWdlcik7CiAgICAgICAgICAgICAgICBzZWwud2hlcmVQcmltYXJ5\nS2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmdzW2ldLCBzdG9yZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdW5pb24u\nZXhlY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZWxlY3QgcHJpbWFyeSBrZXkgZGF0YSB0byBtYWtlIHN1cmUgdGhlIGdpdmVu\nIGluc3RhbmNlIGV4aXN0cywgbG9ja2luZwogICAgICogaWYgbmVlZGVkLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc2VsZWN0UHJpbWFyeUtleShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHNlbGVjdCBwa3Mg\nZnJvbSBiYXNlIGNsYXNzIHJlY29yZCB0byBlbnN1cmUgaXQgZXhpc3RzIGFu\nZCBsb2NrCiAgICAgICAgLy8gaXQgaWYgbmVlZGVkCiAgICAgICAgQ2xhc3NN\nYXBwaW5nIGJhc2UgPSBtYXBwaW5nOwogICAgICAgIHdoaWxlIChiYXNlLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAg\nICAgICAgIGJhc2UgPSBiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpOwoKICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3Qo\nKTsKICAgICAgICBzZWwuc2VsZWN0KGJhc2UuZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKSk7CiAgICAgICAgc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmpl\nY3RJZCgpLCBiYXNlLCB0aGlzKTsKICAgICAgICBSZXN1bHQgZXhpc3RzID0g\nc2VsLmV4ZWN1dGUodGhpcywgZmV0Y2gpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmICghZXhpc3RzLm5leHQoKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHJlY29yZCBsb2NrZWQ/CiAg\nICAgICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIGV4aXN0\ncy5pc0xvY2tpbmcoKSkKICAgICAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JV\ncGRhdGUoc20pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBleGlzdHMuY2xvc2UoKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9hZChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2JqZWN0IGNvbnRl\neHQpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9\nIChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaDsKCiAgICAgICAgLy8g\nZ2V0IGEgY29ubmVjdGlvbiwgb3IgcmV1c2UgY3VycmVudCBvbmUKICAgICAg\nICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5lY3Rpb25JbmZvKSBjb250\nZXh0OwogICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAgIGlmIChp\nbmZvICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgaW5pdGlhbGl6ZSgp\nIGZhaWxzIHRvIGxvYWQgcmVxdWlyZWQgZmllbGRzLCB0aGVuIHRoaXMgbWV0\naG9kCiAgICAgICAgICAgIC8vIGlzIGNhbGxlZDsgbWFrZSBzdXJlIG5vdCB0\nbyB0cnkgdG8gdXNlIHRoZSBnaXZlbiByZXN1bHQgaWYgaXQncwogICAgICAg\nICAgICAvLyB0aGUgc2FtZSBvbmUgd2UganVzdCBmYWlsZWQgdG8gY29tcGxl\ndGVseSBpbml0aWFsaXplKCkgd2l0aAogICAgICAgICAgICBpZiAoaW5mby5z\nbSAhPSBzbSkKICAgICAgICAgICAgICAgIHJlcyA9IGluZm8ucmVzdWx0Owog\nICAgICAgICAgICBpbmZvLnNtID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBleGlzdGluZyBy\nZXN1bHQsIGxvYWQgYWxsIHdlIGNhbiBmcm9tIGl0CiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7CiAg\nICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVsZHMoc20sIGZpZWxkcyk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5j\nZSBpcyBob2xsb3cgYW5kIHRoZXJlJ3MgYSBjdXN0b21pemVkCiAgICAgICAg\nICAgIC8vIGdldCBieSBpZCBtZXRob2QsIHVzZSBpdAogICAgICAgICAgICBp\nZiAoc20uZ2V0TG9hZGVkKCkubGVuZ3RoKCkgPT0gMCAKICAgICAgICAgICAg\nICAgICYmIG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgbnVsbCwgamZl\ndGNoKSkKICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwg\nZmllbGRzKTsKCiAgICAgICAgICAgIC8vIyMjIHNlbGVjdCBpcyBraW5kIG9m\nIGEgYmlnIG9iamVjdCwgYW5kIGluIHNvbWUgY2FzZXMgd2UgZG9uJ3QKICAg\nICAgICAgICAgLy8jIyMgdXNlIGl0Li4uIHdvdWxkIGl0IGJlIHdvcnRoIGl0\nIHRvIGhhdmUgYSBzbWFsbCBzaGVsbCBzZWxlY3QKICAgICAgICAgICAgLy8j\nIyMgb2JqZWN0IHRoYXQgb25seSBjcmVhdGVzIGEgcmVhbCBzZWxlY3Qgd2hl\nbiBhY3R1YWxseSB1c2VkPwoKICAgICAgICAgICAgU2VsZWN0IHNlbCA9IF9z\ncWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIGlmIChzZWxlY3Qoc2VsLCBt\nYXBwaW5nLCBTZWxlY3QuU1VCU19FWEFDVCwgc20sIGZpZWxkcywgamZldGNo\nLAogICAgICAgICAgICAgICAgRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU4s\nIHRydWUsIGZhbHNlKSkgewogICAgICAgICAgICAgICAgc2VsLndoZXJlUHJp\nbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0aGlzKTsKICAg\nICAgICAgICAgICAgIHJlcyA9IHNlbC5leGVjdXRlKHRoaXMsIGpmZXRjaCwg\nbG9ja0xldmVsKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKCFyZXMubmV4dCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgbG9hZCht\nYXBwaW5nLCBzbSwgamZldGNoLCByZXMpOwogICAgICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICByZXMuY2xvc2UoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbm93IGFsbG93IHRoZSBmaWVsZHMgdG8gbG9hZCB0aGVtc2VsdmVzIGluZGl2\naWR1YWxseSB0b28KICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0g\nbWFwcGluZy5nZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgaWYgKGZpZWxkcy5nZXQoaSkgJiYgIXNtLmdldExvYWRlZCgpLmdldChp\nKSkKICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9hZChzbSwgdGhpcywg\namZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pKTsKICAgICAgICAgICAgbWFw\ncGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RG\nb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIGxpc3QgZm9ybWVkIGJ5IHJlbW92aW5nIGFsbCBs\nb2FkZWQgZmllbGRzIGZyb20gdGhlIGdpdmVuIG9uZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHJlbW92ZUxvYWRlZEZpZWxkcyhPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzKSB7CiAgICAgICAgZm9yIChpbnQg\naSA9IDAsIGxlbiA9IGZpZWxkcy5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQog\nICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAmJiBzbS5nZXRMb2FkZWQo\nKS5nZXQoaSkpCiAgICAgICAgICAgICAgICBmaWVsZHMuY2xlYXIoaSk7CiAg\nICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gbG9hZEFsbChDb2xsZWN0aW9u\nIHNtcywgUENTdGF0ZSBzdGF0ZSwgaW50IGxvYWQsCiAgICAgICAgRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4dCkgewogICAgICAg\nIHJldHVybiBJbXBsSGVscGVyLmxvYWRBbGwoc21zLCB0aGlzLCBzdGF0ZSwg\nbG9hZCwgZmV0Y2gsIGNvbnRleHQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGJlZm9yZVN0YXRlQ2hhbmdlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBD\nU3RhdGUgZnJvbVN0YXRlLAogICAgICAgIFBDU3RhdGUgdG9TdGF0ZSkgewog\nICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGZsdXNoKENvbGxlY3Rpb24g\nc21zKSB7CiAgICAgICAgcmV0dXJuIF9jb25mLmdldFVwZGF0ZU1hbmFnZXJJ\nbnN0YW5jZSgpLmZsdXNoKHNtcywgdGhpcyk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gY2FuY2VsQWxsKCkgewogICAgICAgIC8vIG5vdGUgdGhhdCB0\naGlzIG1ldGhvZCBkb2VzIG5vdCBsb2NrIHRoZSBjb250ZXh0LCBzaW5jZQog\nICAgICAgIC8vIHdlIHdhbnQgdG8gYWxsb3cgYSBkaWZmZXJlbnQgdGhyZWFk\nIHRvIGJlIGFibGUgdG8gY2FuY2VsIHRoZQogICAgICAgIC8vIG91dHN0YW5k\naW5nIHN0YXRlbWVudCBvbiBhIGRpZmZlcmVudCBjb250ZXh0CgogICAgICAg\nIENvbGxlY3Rpb24gc3RtbnRzOwogICAgICAgIHN5bmNocm9uaXplZCAoX3N0\nbW50cykgewogICAgICAgICAgICBpZiAoX3N0bW50cy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHN0bW50\ncyA9IG5ldyBBcnJheUxpc3QoX3N0bW50cyk7CiAgICAgICAgfQoKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHN0bW50\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nICgoU3RhdGVtZW50KSBpdHIubmV4dCgpKS5jYW5jZWwoKTsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3Rv\ncmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gYXNzaWduT2JqZWN0SWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikK\nICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmFzc2lnbihzbSwg\ndGhpcywgcHJlRmx1c2gpOwoKICAgICAgICAvLyBkYXRhc3RvcmUgaWRlbnRp\ndHkKICAgICAgICBPYmplY3QgdmFsID0gSW1wbEhlbHBlci5nZW5lcmF0ZUlk\nZW50aXR5VmFsdWUoX2N0eCwgbWV0YSwKICAgICAgICAgICAgSmF2YVR5cGVz\nLkxPTkcpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiBtZXRhLmdldElk\nZW50aXR5U3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICB2YWwgPSBnZXREYXRhU3RvcmVJZFNlcXVlbmNl\nKG1ldGEpLm5leHQoX2N0eCwgbWV0YSk7CiAgICAgICAgc20uc2V0T2JqZWN0\nSWQobmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKSk7CiAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXNzaWduRmllbGQo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGZpZWxkLAogICAgICAgIGJv\nb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIE9i\namVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRlRmllbGRWYWx1ZShfY3R4\nLCBmbWQpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHNtLnN0b3JlKGZpZWxkLCB2YWwpOwog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBn\nZXRNYW5hZ2VkVHlwZShPYmplY3Qgb2lkKSB7CiAgICAgICAgaWYgKG9pZCBp\nbnN0YW5jZW9mIElkKQogICAgICAgICAgICByZXR1cm4gKChJZCkgb2lkKS5n\nZXRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVi\nbGljIENsYXNzIGdldERhdGFTdG9yZUlkVHlwZShDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICByZXR1cm4gSWQuY2xhc3M7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBjb3B5RGF0YVN0b3JlSWQoT2JqZWN0IG9pZCwgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgSWQgaWQgPSAoSWQpIG9pZDsKICAg\nICAgICByZXR1cm4gbmV3IElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBp\nZC5nZXRJZCgpLCBpZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgbmV3RGF0YVN0b3JlSWQoT2JqZWN0IHZhbCwgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIElkLm5ld0luc3RhbmNl\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB2YWwpOwogICAgfQoKICAgIHB1\nYmxpYyBJZCBuZXdEYXRhU3RvcmVJZChsb25nIGlkLCBDbGFzc01hcHBpbmcg\nbWFwcGluZywgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJ\nZChtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSwgaWQsIHN1YnMpOwogICAg\nfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRlRXh0\nZW50KENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBmaW5hbCBib29sZWFu\nIHN1YmNsYXNzZXMsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAg\nICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgbWV0\nYTsKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSBtYXBwaW5nczsKICAg\nICAgICBpZiAoc3ViY2xhc3NlcykKICAgICAgICAgICAgbWFwcGluZ3MgPSBt\nYXBwaW5nLmdldEluZGVwZW5kZW50QXNzaWduYWJsZU1hcHBpbmdzKCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBtYXBwaW5ncyA9IG5ldyBDbGFzc01h\ncHBpbmdbXSB7IG1hcHBpbmcgfTsKCiAgICAgICAgUmVzdWx0T2JqZWN0UHJv\ndmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAgICBmaW5hbCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGpmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9u\nKSBmZXRjaDsKICAgICAgICBpZiAoamZldGNoLmdldFN1YmNsYXNzRmV0Y2hN\nb2RlKG1hcHBpbmcpICE9IGpmZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAg\nICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW21hcHBpbmdzLmxl\nbmd0aF07CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGZv\nciBjdXN0b20gbG9hZHMKICAgICAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlk\nZXIgcm9wOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBp\nbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICByb3AgPSBtYXBw\naW5nc1tpXS5jdXN0b21Mb2FkKHRoaXMsIHN1YmNsYXNzZXMsIGpmZXRjaCwg\nMCwKICAgICAgICAgICAgICAgICAgICBMb25nLk1BWF9WQUxVRSk7CiAgICAg\nICAgICAgICAgICBpZiAocm9wICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAocm9wcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW21hcHBpbmdzLmxl\nbmd0aF07CiAgICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9IHJvcDsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\naWYgd2UncmUgc2VsZWN0aW5nIGluZGVwZW5kZW50IG1hcHBpbmdzIHNlcGFy\nYXRlbHkgb3IgaGF2ZQogICAgICAgICAgICAvLyBjdXN0b20gbG9hZHMsIGRv\nIGluZGl2aWR1YWwgc2VsZWN0cyBmb3IgZWFjaCBjbGFzcwogICAgICAgICAg\nICByb3AgPSBudWxsOwogICAgICAgICAgICBpZiAocm9wcyAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvcHNb\naV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAgICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1Nl\nbGVjdCgpOwogICAgICAgICAgICAgICAgICAgIHNlbC5zZXRMUlModHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgQml0U2V0IHBhZ2VkID0gc2VsZWN0RXh0\nZW50KHNlbCwgbWFwcGluZ3NbaV0sIGpmZXRjaCwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJvcHNb\naV0gPSBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcihzZWwsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nc1tpXSwgdGhpcywg\namZldGNoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJvcHNbaV0gPSBuZXcgUGFnaW5nUmVzdWx0T2JqZWN0\nUHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFw\ncGluZ3NbaV0sIHRoaXMsIGpmZXRjaCwgcGFnZWQsIExvbmcuTUFYX1ZBTFVF\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyb3Bz\nLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByb3Bz\nWzBdOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXJnZWRSZXN1bHRP\nYmplY3RQcm92aWRlcihyb3BzKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gcGVyZm9ybSBhIHVuaW9uIG9uIGFsbCBpbmRlcGVuZGVudCBjbGFz\nc2VzCiAgICAgICAgICAgIFVuaW9uIHVuaW9uID0gX3NxbC5uZXdVbmlvbiht\nYXBwaW5ncy5sZW5ndGgpOwogICAgICAgICAgICB1bmlvbi5zZXRMUlModHJ1\nZSk7CiAgICAgICAgICAgIGZpbmFsIEJpdFNldFtdIHBhZ2VkID0gbmV3IEJp\ndFNldFttYXBwaW5ncy5sZW5ndGhdOwogICAgICAgICAgICB1bmlvbi5zZWxl\nY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAg\nICAgICAgICAgICAgICBwYWdlZFtpZHhdID0gc2VsZWN0RXh0ZW50KHNlbCwg\nbWFwcGluZ3NbaWR4XSwgamZldGNoLAogICAgICAgICAgICAgICAgICAgICAg\nICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSk7CgogICAgICAgICAgICAvLyB1c2luZyBwYWdpbmcgcm9wIGlmIGFueSB1\nbmlvbiBlbGVtZW50IGhhcyBwYWdlZCBmaWVsZHMKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBwYWdlZC5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKHBhZ2VkW2ldICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcih1\nbmlvbiwgbWFwcGluZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgIEpEQkNT\ndG9yZU1hbmFnZXIudGhpcywgamZldGNoLCBwYWdlZCwgTG9uZy5NQVhfVkFM\nVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgSW5z\ndGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcih1bmlvbiwgbWFwcGluZ3NbMF0s\nIHRoaXMsCiAgICAgICAgICAgICAgICBqZmV0Y2gpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBnaXZlbiBtYXBwaW5nIGZv\nciB1c2UgaW4gYW4gZXh0ZW50LCByZXR1cm5pbmcgcGFnZWQgZmllbGRzLgog\nICAgICovCiAgICBwcml2YXRlIEJpdFNldCBzZWxlY3RFeHRlbnQoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBzdWJjbGFzc2VzKSB7CiAg\nICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3NlcykgPyBTZWxlY3QuU1VCU19K\nT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7CiAgICAgICAgLy8gZGVjaWRl\nIGJldHdlZW4gcGFnaW5nIGFuZCBzdGFuZGFyZCBpdGVyYXRpb24KICAgICAg\nICBCaXRTZXQgcGFnZWQgPSBQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlci5n\nZXRQYWdlZEZpZWxkcyhzZWwsIG1hcHBpbmcsCiAgICAgICAgICAgIHRoaXMs\nIGZldGNoLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVM\nLAogICAgICAgICAgICBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgaWYgKHBh\nZ2VkID09IG51bGwpCiAgICAgICAgICAgIHNlbC5zZWxlY3RJZGVudGlmaWVy\nKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAogICAgICAgICAgICAgICAg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9QQVJBTExFTCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzZWwuc2VsZWN0SWRlbnRpZmllcihtYXBw\naW5nLCBzdWJzLCB0aGlzLCBmZXRjaCwKICAgICAgICAgICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7CiAgICAgICAgcmV0dXJu\nIHBhZ2VkOwogICAgfQoKICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IG5ld1F1ZXJ5\nKFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIEV4cHJlc3Npb25QYXJzZXIg\nZXAgPSBRdWVyeUxhbmd1YWdlcy5wYXJzZXJGb3JMYW5ndWFnZShsYW5ndWFn\nZSk7CiAgICAgICAgaWYgKGVwICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgSkRCQ1N0b3JlUXVlcnkodGhpcywgZXApOwogICAgICAgIGlmIChR\ndWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMobGFuZ3VhZ2UpKQogICAg\nICAgICAgICByZXR1cm4gbmV3IFNRTFN0b3JlUXVlcnkodGhpcyk7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmln\ndXJhdGlvbiBuZXdGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBKREJDRmV0Y2hDb25maWd1cmF0aW9uSW1wbCgpOwogICAgfQoK\nICAgIHB1YmxpYyBTZXEgZ2V0RGF0YVN0b3JlSWRTZXF1ZW5jZShDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVN0\ncmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5BVElWRQogICAgICAgICAg\nICB8fCBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0\nZWdpZXMuTk9ORSkKICAgICAgICAgICAgcmV0dXJuIF9jb25mLmdldFNlcXVl\nbmNlSW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgU2VxIGdldFZhbHVlU2VxdWVuY2UoRmllbGRNZXRhRGF0YSBm\nbWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjbG9zZSgpIHsKICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbCkKICAg\nICAgICAgICAgX2Nvbm4uZnJlZSgpOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8KICAgIC8vIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogQ29ubmVjdCB0byB0aGUgZGIuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBjb25uZWN0KGJvb2xlYW4gcmVmKSB7CiAgICAgICAgX2N0eC5s\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29ubmVjdCBp\nZiB0aGUgY29ubmVjdGlvbiBpcyBjdXJyZW50bHkgbnVsbCwgb3IgaWYKICAg\nICAgICAgICAgLy8gdGhlIGNvbm5lY3Rpb24gaGFzIGJlZW4gY2xvc2VkIG91\ndCBmcm9tIHVuZGVyIHVzCiAgICAgICAgICAgIGlmIChfY29ubiA9PSBudWxs\nKQogICAgICAgICAgICAgICAgX2Nvbm4gPSBjb25uZWN0SW50ZXJuYWwoKTsK\nICAgICAgICAgICAgaWYgKHJlZikKICAgICAgICAgICAgICAgIF9jb25uLnJl\nZigpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGlj\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2N0eC51bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0\nIHRvIHRoZSBkYXRhYmFzZS4gVGhpcyBtZXRob2QgaXMgc2VwYXJhdGVkIG91\ndCBzbyB0aGF0IGl0CiAgICAgKiBjYW4gYmUgb3ZlcnJpZGRlbi4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFJlZkNvdW50Q29ubmVjdGlvbiBjb25uZWN0SW50\nZXJuYWwoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\nbmV3IFJlZkNvdW50Q29ubmVjdGlvbihfZHMuZ2V0Q29ubmVjdGlvbigpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIG9iamVjdCB3aXRoIHRo\nZSBnaXZlbiBvaWQuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZmluZChP\nYmplY3Qgb2lkLCBWYWx1ZU1hcHBpbmcgdm0sIAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIE9iamVjdCBw\nYyA9IF9jdHguZmluZChvaWQsIGZldGNoLCBudWxsLCBudWxsLCAwKTsKICAg\nICAgICBpZiAocGMgPT0gbnVsbCAmJiB2bSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIE9ycGhhbmVkS2V5QWN0aW9uIGFjdGlvbiA9IF9jb25mLmdldE9ycGhh\nbmVkS2V5QWN0aW9uSW5zdGFuY2UoKTsKICAgICAgICAgICAgcGMgPSBhY3Rp\nb24ub3JwaGFuKG9pZCwgbnVsbCwgdm0pOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBvYmpl\nY3QgaW4gdGhlIGN1cnJlbnQgcm93IG9mIHRoZSBnaXZlbiByZXN1bHQuCiAg\nICAgKi8KICAgIHB1YmxpYyBPYmplY3QgbG9hZChDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBC\naXRTZXQgZXhjbHVkZSwgUmVzdWx0IHJlc3VsdCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKCFtYXBwaW5nLmlzTWFwcGVkKCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoInZpcnR1YWwtbWFwcGluZyIsIAogICAgICAgICAgICAgICAgbWFwcGlu\nZykpOwoKICAgICAgICAvLyBnZXQgdGhlIG9iamVjdCBpZCBmb3IgdGhlIHJv\ndzsgYmFzZSBjbGFzcyBzZWxlY3RzIHBrIGNvbHVtbnMKICAgICAgICBDbGFz\nc01hcHBpbmcgYmFzZSA9IG1hcHBpbmc7CiAgICAgICAgd2hpbGUgKGJhc2Uu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgYmFzZSA9IGJhc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCk7CiAgICAgICAgT2JqZWN0IG9pZCA9IGJhc2UuZ2V0T2JqZWN0\nSWQodGhpcywgcmVzdWx0LCBudWxsLCB0cnVlLCBudWxsKTsKICAgICAgICBp\nZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gbmV3IENvbm5lY3Rpb25JbmZv\nKCk7CiAgICAgICAgaW5mby5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgaW5m\nby5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgICByZXR1cm4gX2N0eC5maW5k\nKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGluZm8sIDApOwogICAgfQoKICAgIC8q\nKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciB3aXRoIGRh\ndGEgZnJvbSB0aGUgcmVzdWx0IHNldC4gT25seQogICAgICogbWFwcGluZ3Mg\nb3JpZ2luYWxseSBzZWxlY3RlZCB3aWxsIGJlIGxvYWRlZC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gbG9hZCht\nYXBwaW5nLCBzbSwgZmV0Y2gsIHJlcywgbnVsbCk7CiAgICAgICAgaWYgKGVh\nZ2VyVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAgIGVhZ2VyVG9NYW55Lmxv\nYWRFYWdlckpvaW4oc20sIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhlYWdl\nclRvTWFueSksCiAgICAgICAgICAgICAgICByZXMpOwogICAgICAgIGlmIChf\nYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIHJlcy5pc0xvY2tpbmcoKSkKICAg\nICAgICAgICAgX2xtLmxvYWRlZEZvclVwZGF0ZShzbSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBMb2FkIHRoZSBmaWVsZHMgb2YgdGhlIGdpdmVuIG1hcHBp\nbmcuIFJldHVybiBhbnkgdG8tbWFueSBlYWdlciBmaWVsZAogICAgICogd2l0\naG91dCBsb2FkaW5nIGl0LgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFw\ncGluZyBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIFJlc3VsdCByZXMsIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAobWFwcGlu\nZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBmZXRjaCwgcmVzKSkKICAgICAgICAg\nICAgcmV0dXJuIGVhZ2VyVG9NYW55OwoKICAgICAgICAvLyBsb2FkIHN1cGVy\nY2xhc3MgZGF0YTsgYmFzZSBjbGFzcyBsb2FkcyB2ZXJzaW9uCiAgICAgICAg\nQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHBhcmVudCAhPSBudWxs\nKQogICAgICAgICAgICBlYWdlclRvTWFueSA9IGxvYWQocGFyZW50LCBzbSwg\nZmV0Y2gsIHJlcywgZWFnZXJUb01hbnkpOwogICAgICAgIGVsc2UgaWYgKHNt\nLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAgICAgICBtYXBwaW5nLmdl\ndFZlcnNpb24oKS5sb2FkKHNtLCB0aGlzLCByZXMpOwoKICAgICAgICAvLyBs\nb2FkIHVubG9hZGVkIGZpZWxkcwogICAgICAgIEZpZWxkTWFwcGluZ1tdIGZt\ncyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAg\nICBPYmplY3QgZXJlcywgcHJvY2Vzc2VkOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChm\nbXNbaV0uaXNQcmltYXJ5S2V5KCkgfHwgc20uZ2V0TG9hZGVkKCkuZ2V0KGZt\nc1tpXS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGVhZ2VyIHJl\nc3VsdCwgYW5kIGlmIG5vdCBwcmVzZW50IGRvIHN0YW5kYXJkIGxvYWQKICAg\nICAgICAgICAgZXJlcyA9IHJlcy5nZXRFYWdlcihmbXNbaV0pOwogICAgICAg\nICAgICByZXMuc3RhcnREYXRhUmVxdWVzdChmbXNbaV0pOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICBpZiAoZXJlcyA9PSByZXMpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoZWFnZXJUb01hbnkgPT0gbnVsbCAmJiBm\nbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBlYWdlclRvTWFueSA9IGZtc1tpXTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZtc1tpXS5sb2Fk\nRWFnZXJKb2luKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAgICAg\nCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCByZXMpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIGlmIChlcmVzICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBwcm9jZXNzZWQgPSBmbXNbaV0ubG9hZEVhZ2VyUGFyYWxsZWwo\nc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2ldKSwgZXJlcyk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHByb2Nlc3NlZCAhPSBlcmVzKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXMucHV0RWFnZXIoZm1zW2ldLCBwcm9jZXNzZWQpOwogICAgICAgICAgICAg\nICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmxvYWQoc20s\nIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCByZXMpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgcmVzLmVuZERh\ndGFSZXF1ZXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAgIC8qKgogICAgICogRm9y\nIGltcGxlbWVudGF0aW9uIHVzZSBvbmx5LgogICAgICogUmV0dXJuIGEgc2Vs\nZWN0IGZvciB0aGUgcHJvcGVyIG1hcHBpbmdzLiBSZXR1cm4gbnVsbCBpZiBu\nbyBzZWxlY3QgaXMKICAgICAqIG5lZWRlZC4gVGhlIG1ldGhvZCBpcyBkZXNp\nZ25lZCB0byBiZSBjb21wbGVtZW50YXJ5IHRvIHRoZSBsb2FkIG1ldGhvZHMu\nCiAgICAgKgogICAgICogQHBhcmFtIHNlbCBzZWxlY3QgdG8gYnVpbGQgb24K\nICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtYXBwaW5nIGZvciB0aGUgYmFz\nZSB0eXBlIHRvIHNlbGVjdCBmb3IKICAgICAqIEBwYXJhbSBzdWJzIHdoZXRo\nZXIgdGhlIHNlbGVjdCBtaWdodCBpbmNsdWRlIHN1YmNsYXNzZXMgb2YgdGhl\nCiAgICAgKiBnaXZlbiBtYXBwaW5nCiAgICAgKiBAcGFyYW0gc20gc3RhdGUg\nbWFuYWdlciBpZiBhbiBpbnN0YW5jZSBpcyBiZWluZyBsb2FkZWQgb3IKICAg\nICAqIGluaXRpYWxpemVkLCBlbHNlIG51bGwKICAgICAqIEBwYXJhbSBmaWVs\nZHMgaWYgYSBzdGF0ZSBtYW5hZ2VyIGlzIGJlaW5nIGxvYWRlZCwgdGhlIHNl\ndCBvZgogICAgICogZmllbGRzIHRoYXQgbXVzdCBiZSBsb2FkZWQgaW4gb3Jk\nZXIsIGVsc2UgbnVsbAogICAgICogQHBhcmFtIGZldGNoIHRoZSBmZXRjaCBj\nb25maWd1cmF0aW9uOyB1c2VkIGlmIG5vIHNwZWNpZmljIGZpZWxkcwogICAg\nICogbXVzdCBiZSBsb2FkZWQsIGFuZCB1c2VkIHdoZW4gc2VsZWN0aW5nIHJl\nbGF0aW9ucwogICAgICogQHBhcmFtIGVhZ2VyIGVhZ2VyIGZldGNoIG1vZGUg\ndG8gdXNlCiAgICAgKiBAcGFyYW0gaWRlbnQgd2hldGhlciB0byBzZWxlY3Qg\ncHJpbWFyeSBrZXkgY29sdW1ucyBhcyBkaXN0aW5jdAogICAgICogaWRlbnRp\nZmllcnMKICAgICAqIEBwYXJhbSBvdXRlciB3aGV0aGVyIHdlJ3JlIG91dGVy\nLWpvaW5pbmcgdG8gdGhpcyB0eXBlCiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\ndGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTZWxlY3Qgc2VsLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywgaW50IHN1YnMsCiAgICAgICAgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgZWFnZXIsIGJvb2xlYW4gaWRl\nbnQsIGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAvLyBhZGQgY2xhc3MgY29u\nZGl0aW9ucyBzbyB0aGF0IHRoZXkncmUgY2xvbmVkIGZvciBhbnkgYmF0Y2hl\nZCBzZWxlY3RzCiAgICAgICAgYm9vbGVhbiBqb2luZWRTdXBlcnMgPSBmYWxz\nZTsKICAgICAgICBpZiAoKHNtID09IG51bGwgfHwgc20uZ2V0UENTdGF0ZSgp\nID09IFBDU3RhdGUuVFJBTlNJRU5UKQogICAgICAgICAgICAmJiAoc3VicyA9\nPSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5TVUJT\nX05PTkUpKSB7CiAgICAgICAgICAgIGxvYWRTdWJjbGFzc2VzKG1hcHBpbmcp\nOyAKICAgICAgICAgICAgSm9pbnMgam9pbnMgPSAob3V0ZXIpID8gc2VsLm5l\nd091dGVySm9pbnMoKSA6IG51bGw7CiAgICAgICAgICAgIGpvaW5lZFN1cGVy\ncyA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmFkZENsYXNzQ29uZGl0\naW9ucyhzZWwsCiAgICAgICAgICAgICAgICBzdWJzID09IFNlbGVjdC5TVUJT\nX0pPSU5BQkxFLCBqb2lucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgYWxsIG91ciBlYWdlciBzZWxlY3RzIHNvIHRoYXQgdGhvc2UgZmllbGRz\nIGFyZSByZXNlcnZlZAogICAgICAgIC8vIGFuZCBjYW5ub3QgYmUgcmV1c2Vk\nIGR1cmluZyB0aGUgYWN0dWFsIGVhZ2VyIHNlbGVjdCBwcm9jZXNzLAogICAg\nICAgIC8vIHByZXZlbnRpbmcgaW5maW5pdGUgcmVjdXJzaW9uCiAgICAgICAg\nZWFnZXIgPSBNYXRoLm1pbihlYWdlciwgZmV0Y2guZ2V0RWFnZXJGZXRjaE1v\nZGUoKSk7CiAgICAgICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3Jl\nYXRlRWFnZXJTZWxlY3RzKHNlbCwgbWFwcGluZywgc20sIGZpZWxkcywKICAg\nICAgICAgICAgZmV0Y2gsIGVhZ2VyKTsKCiAgICAgICAgLy8gc2VsZWN0IGFs\nbCBiYXNlIGNsYXNzIG1hcHBpbmdzOyBkbyB0aGlzIGFmdGVyIGJhdGNoaW5n\nIHNvIHRoYXQKICAgICAgICAvLyB0aGUgam9pbnMgbmVlZGVkIGJ5IHRoZXNl\nIHNlbGVjdHMgZG9uJ3QgZ2V0IGluIHRoZSBXSEVSRSBjbGF1c2UKICAgICAg\nICAvLyBvZiB0aGUgYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAgaW50IHNlbGQg\nPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBtYXBwaW5nLCBtYXBwaW5nLCBz\nbSwgZmllbGRzLAogICAgICAgICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9N\nYW55LCBpZGVudCwgam9pbmVkU3VwZXJzKTsKCiAgICAgICAgLy8gc2VsZWN0\nIGVhZ2VyIHRvLW1hbnkgcmVsYXRpb25zIGxhc3QgYmVjYXVzZSBkdXJpbmcg\nbG9hZCB0aGV5CiAgICAgICAgLy8gYWR2YW5jZSB0aGUgcmVzdWx0IHNldCBh\nbmQgY291bGQgZXhoYXVzdCBpdCwgc28gbm8gb3RoZXIgbWFwcGluZ3MKICAg\nICAgICAvLyBjYW4gbG9hZCBhZnRlcndvcmRzCiAgICAgICAgaWYgKGVhZ2Vy\nVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAgIGVhZ2VyVG9NYW55LnNlbGVj\ndEVhZ2VySm9pbihzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIGZl\ndGNoLnRyYXZlcnNlSkRCQyhlYWdlclRvTWFueSksIGVhZ2VyKTsKCiAgICAg\nICAgLy8gb3B0aW9uYWxseSBzZWxlY3Qgc3ViY2xhc3MgbWFwcGluZ3MKICAg\nICAgICBpZiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJz\nID09IFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSkKICAgICAgICAgICAgc2Vs\nZWN0U3ViY2xhc3NNYXBwaW5ncyhzZWwsIG1hcHBpbmcsIHNtLCBmZXRjaCk7\nCiAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5zZXRE\naXN0aW5jdChmYWxzZSk7CiAgICAgICAgcmV0dXJuIHNlbGQgPiAwOwogICAg\nfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgZmllbGRzIG9mIHRoaXMgbWFw\ncGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2VyIGZldGNoZXMgY2FuJ3QK\nICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vyc2l2ZSBzaXR1YXRpb25z\nLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBjcmVhdGVFYWdl\nclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgZWFn\nZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8IGVhZ2VyID09\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRv\nTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIAogICAgICAgICAgICBt\nYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpLCBzbSwg\nZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAgICBGaWVsZE1hcHBpbmdb\nXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNlbC5oYXNFYWdlckpvaW4o\nZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAgICAgIGludCBqdHlwZTsK\nICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtb2RlID0gZm1zW2ld\nLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGlmIChtb2RlID09\nIGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVjdChmbXNbaV0sIHNtLCBm\naWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRoIGpvaW4gZmlyc3QKICAg\nICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51bGxWYWx1ZSgpID09IGZt\nc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAgICAgICAgICA/IHNlbC5F\nQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsKICAgICAgICAgICAgaWYg\nKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwgJiYgIWZtc1tpXS5pc0Vh\nZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5z\ndXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4g\nMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2VyQ2xvbmUoZm1zW2ldLCBq\ndHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbiA9IGZldGNoLmhh\nc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAgICAgICAg\nICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBwcmVmZXJyZWQgc2VsZWN0\nIG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAgICAgICAgICAvLyBoYXZl\nIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRvaW5nIGEgYnktaWQgbG9v\na3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNlIGEgdG8tbWFueSBqb2lu\nIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFnZXIKICAgICAgICAgICAg\nLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9uLXJhbmdlZCBzZWxlY3Rz\nIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAgICAvLyBoYXZlIGFuIGVh\nZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBpZiAoKGhhc0pvaW4gfHwg\nbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAgICAgICAgICAgICAgfHwg\nKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAhPSBudWxsKSkKICAgICAg\nICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAg\nICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgogICAgICAgICAgICAgICAg\nJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAgICAgICAgICAgICAgICYm\nICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICghc2VsLmlzTFJTKCkKICAg\nICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydEluZGV4KCkgPT0gMCAKICAg\nICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09IExvbmcuTUFY\nX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5zdXBwb3J0c1Nl\nbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4gMCkgewogICAg\nICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25lKGZtc1tpXSwganR5cGUs\nIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZWFnZXJU\nb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAogICAgICAgICAgICBpZiAo\nZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwKICAgICAgICAgICAgICAg\nICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwgc2VsLkVB\nR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAgICAgIHRoaXMsIGZldGNo\nKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5lYWdlckNsb25lKGZtc1tp\nXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAgICAgICAgICAgICAgICAg\nICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpLCBzZWxzKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAgIC8q\nKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBmaWVsZCBuZWVkcyB0\nbyBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmaWVsZHMg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5nZXQoZm0uZ2V0\nSW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0UENT\ndGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAgICAgICAgICAgICYmIHNt\nLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBmZXRjaC5yZXF1aXJlc0Zl\ndGNoKGZtKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9BRDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZmllbGQgbWFwcGluZ3Mg\nb2YgdGhlIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRzIHN1cGVyY2xhc3Nlcy4K\nICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3QgdG8gdXNlCiAg\nICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbW9zdC1kZXJpdmVkIHR5cGUgdG8g\nc2VsZWN0IGZvcgogICAgICogQHBhcmFtIG9yaWcgdGhlIG9yaWdpbmFsIG1h\ncHBpbmcgdHlwZSBzZWxlY3RlZAogICAgICogQHBhcmFtIHNtIHRoZSBpbnN0\nYW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9uZQogICAg\nICogQHBhcmFtIGZpZWxkcyB0aGUgZmllbGRzIHRvIGxvYWQKICAgICAqIEBw\nYXJhbSBmZXRjaCBmZXRjaCBjb25maWd1cmF0aW9uIHRvIHVzZSBmb3IgbG9h\nZGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciB0aGUgZWFnZXIg\nZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBqb2luZWQgd2hldGhl\nciB0aGUgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBqb2luZWQgZG93biB0bwog\nICAgICogaXRzIGJhc2UgY2xhc3MKICAgICAqIEByZXR1cm4gJmd0OyAwIGlm\nIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYgZGF0YSB3YXMKICAgICAq\nIHNlbGVjdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQsIGFuZCAmbHQ7IDAgaWYg\nbm90aGluZyB3YXMgc2VsZWN0ZWQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQg\nc2VsZWN0QmFzZU1hcHBpbmdzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBt\nYXBwaW5nLAogICAgICAgIENsYXNzTWFwcGluZyBvcmlnLCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwgRmllbGRNYXBwaW5n\nIGVhZ2VyVG9NYW55LAogICAgICAgIGJvb2xlYW4gaWRlbnQsIGJvb2xlYW4g\nam9pbmVkKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\naWYgKHBhcmVudCA9PSBudWxsICYmICFtYXBwaW5nLmlzTWFwcGVkKCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQoInZpcnR1YWwtbWFwcGluZyIsIG1hcHBpbmcuCiAgICAgICAgICAg\nICAgICBnZXREZXNjcmliZWRUeXBlKCkpKTsKCiAgICAgICAgaW50IHNlbGQg\nPSAtMTsKICAgICAgICBpbnQgcHNlbGQgPSAtMTsKCiAgICAgICAgLy8gYmFz\nZSBjbGFzcyBzZWxlY3RzIHBrcywgZXRjCiAgICAgICAgaWYgKHBhcmVudCA9\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlLCBzZWxl\nY3QgcGtzCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoaWRlbnQpCiAgICAgICAgICAgICAgICAgICAgc2VsLnNl\nbGVjdElkZW50aWZpZXIobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBz\nZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAg\nICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90IGluaXRpYWxpemVkIGFu\nZCBub3QgZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQogICAgICAgICAgICBpZiAo\nKHNtID09IG51bGwgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRS\nQU5TSUVOVCAKICAgICAgICAgICAgICAgICYmICghKHNtLmdldE9iamVjdElk\nKCkgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIAogICAgICAgICAgICAgICAgfHwg\nKChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkpLmhhc1N1YmNsYXNzZXMo\nKSkpKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXREaXNjcmltaW5h\ndG9yKCkuc2VsZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAgICAgICBzZWxk\nID0gMTsKCiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlIG9yIG5vIHZl\ncnNpb24sIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAgICAgIGlmICgoc20gPT0g\nbnVsbCB8fCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICYmIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNlbGVjdChzZWwsIG9yaWcp\nKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgLy8gcmVjdXJzZSBvbiBwYXJlbnQKICAgICAgICAgICAg\ncHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBwYXJlbnQsIG9yaWcs\nIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBmZXRjaCwgZWFnZXIsIGVh\nZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHNlbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhlIGdpdmVuIGZpZWxkcyBz\nZXQsIG9yIGJhc2VkIG9uIGZldGNoCiAgICAgICAgLy8gY29uZmlndXJhdGlv\nbiBpZiBubyBmaWVsZHMgZ2l2ZW4KICAgICAgICBGaWVsZE1hcHBpbmdbXSBm\nbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAg\nICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQgZnNlbGQ7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgLy8gc2tpcCBlYWdlciB0by1tYW55IHNlbGVjdDsgd2Ug\nZG8gdGhhdCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcKICAgICAgICAgICAgLy8g\nbWV0aG9kCiAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gZWFnZXJUb01hbnkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGNo\nZWNrIGZvciBlYWdlciBzZWxlY3QKICAgICAgICAgICAgZXNlbCA9IHNlbC5n\nZXRFYWdlcihmbXNbaV0pOwogICAgICAgICAgICBpZiAoZXNlbCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZXNlbCA9PSBzZWwpCiAgICAgICAg\nICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCB0\naGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJD\nKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJhbGxlbChlc2Vs\nLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZldGNoLnRyYXZl\ncnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAgICBzZWxk\nID0gTWF0aC5tYXgoMCwgc2VsZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\ncmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRzLCBmZXRjaCkpIHsK\nICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNt\nLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMo\nZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2VsZCA9IE1hdGgu\nbWF4KGZzZWxkLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRT\nZWxlY3QoZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkpIHsKICAgICAgICAgICAg\nICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0aGlzLCAKICAg\nICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZmV0\nY2guRUFHRVJfTk9ORSk7CgogICAgICAgICAgICAgICAgLy8gZG9uJ3QgdXBn\ncmFkZSBzZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVzZSBmaWVsZHMsIHNpbmNl\nCiAgICAgICAgICAgICAgICAvLyB0aGV5J3JlIG5vdCBpbiB0aGUgY2FsY3Vs\nYXRlZCBmaWVsZCBzZXQKICAgICAgICAgICAgICAgIGlmIChmc2VsZCA+PSAw\nICYmIHNlbGQgPCAwKQogICAgICAgICAgICAgICAgICAgIHNlbGQgPSAwOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBqb2luIHRvIHBh\ncmVudCB0YWJsZSBpZiB0aGUgcGFyZW50IC8gYW55IGFuY2VzdG9ycyBoYXZl\nIHNlbGVjdGVkCiAgICAgICAgLy8gYW55dGhpbmcKICAgICAgICBpZiAoIWpv\naW5lZCAmJiBwc2VsZCA+PSAwICYmIHBhcmVudC5nZXRUYWJsZSgpICE9IG1h\ncHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgc2VsLndoZXJlKG1hcHBp\nbmcuam9pblN1cGVyY2xhc3Moc2VsLm5ld0pvaW5zKCksIGZhbHNlKSk7Cgog\nICAgICAgIC8vIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1ZQogICAgICAgIHJl\ndHVybiBNYXRoLm1heChwc2VsZCwgc2VsZCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGVuIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNwZWNpYWwgY2FzZSBp\ncyBtYWRlIGZvciBtYXBwaW5ncyB0aGF0IHVzZQogICAgICogMi1wYXJ0IHNl\nbGVjdHMgdGhhdCBhcmVuJ3QgZXhwbGljaXRseSAqbm90KiBpbiB0aGUgZGZn\nIHNvIHRoYXQgdGhleQogICAgICogY2FuIGdldCB0aGVpciBwcmltYXJ5IHRh\nYmxlIGRhdGEuIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0aGF0IHNwZWNpYWwK\nICAgICAqIGNhc2UgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFwcGluZyBmbSwgU2Vs\nZWN0IHNlbCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuICFm\nbS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgJiYgIWZt\nLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpCiAgICAgICAgICAgICYm\nIChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRS\nQU5TSUVOVCAKICAgICAgICAgICAgfHwgIXNtLmdldExvYWRlZCgpLmdldChm\nbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgJiYgZm0uc3VwcG9ydHNTZWxl\nY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIGZldGNoKSA+\nIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZmllbGQgbWFwcGlu\nZ3MgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbiBm\nb3IKICAgICAqIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAg\nKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQogICAgICog\nQHBhcmFtIG1hcHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3ViY2xhc3NlcyB0byBz\nZWxlY3QKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2UgYmVpbmcgc2Vs\nZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJhbSBmZXRj\naCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxlY3Qgc2VsLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAg\nbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFz\nc01hcHBpbmdzKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBpbmdzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHNlbGVjdCBh\nbGwgc3ViY2xhc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZmV0Y2ggY29u\nZmlndXJhdGlvbgogICAgICAgIC8vIGFuZCB3aG9zZSB0YWJsZSBpcyBpbiB0\naGUgbGlzdCBvZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7IHRoaXMKICAgICAg\nICAvLyB3YXkgd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2libGUgd2l0aG91dCBz\nZWxlY3RpbmcgYW55IHRhYmxlcyB0aGF0CiAgICAgICAgLy8gYXJlbid0IHBy\nZXNlbnQgaW4gYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNoZXM7IGEgc3BlY2lh\nbCBjYXNlCiAgICAgICAgLy8gaXMgbWFkZSBmb3IgbWFwcGluZ3MgdGhhdCB1\nc2UgMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAgICAgICAvLyBleHBs\naWNpdGx5ICpub3QqIGluIHRoZSBkZWZhdWx0IHNvIHRoYXQgdGhleSBjYW4g\nZ2V0IHRoZWlyCiAgICAgICAgLy8gcHJpbWFyeSB0YWJsZSBkYXRhCiAgICAg\nICAgRmllbGRNYXBwaW5nW10gZm1zOwogICAgICAgIGJvb2xlYW4gam9pbmVk\nOwogICAgICAgIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0LmpvaW5TeW50YXgg\nIT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTAogICAgICAgICAg\nICAmJiBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBm\nZXRjaC5FQUdFUl9OT05FOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFz\ndWJNYXBwaW5nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHRo\naXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICBmZXRjaCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUg\nc28gdGhhdCBpZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0ZW5kIHdlIGFscmVh\nZHkgaGF2ZQogICAgICAgICAgICBqb2luZWQgPSAhY2FuSm9pbjsKICAgICAg\nICAgICAgZm1zID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVmaW5lZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbXMu\nbGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBp\nbiBvbmUgb2YgY29uZmlndXJlZCBmZXRjaCBncm91cHMKICAgICAgICAgICAg\nCWlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkgIT0gRmV0Y2hDb25m\naWd1cmF0aW9uLkZFVENIX0xPQUQKICAgICAgICAgICAgICAgICAgICAmJiAo\nKCFmbXNbal0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAg\nICAgICAgICAgJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNp\ndCgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZtc1tqXS5zdXBwb3J0c1Nl\nbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhpcywgCiAgICAg\nICAgICAgICAgICAgICAgZmV0Y2gpIDw9IDApKSAKICAgICAgICAgICAgCQlj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBjYW4gam9pbiB0\nbyB0aGUgc3ViY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRlciBjaGFuY2UKICAg\nICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdpbGwgYmUgYWJsZSB0\nbyBzZWxlY3QgaXRzZWxmIHdpdGhvdXQgam9pbnMKICAgICAgICAgICAgICAg\nIGlmICgham9pbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFyayBq\nb2luZWQgd2hldGhlciBvciBub3Qgd2Ugam9pbiwgc28gd2UgZG9uJ3QgaGF2\nZSB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgY29uZGl0aW9ucyBh\nZ2FpbiBmb3IgdGhpcyBzdWJjbGFzcwogICAgICAgICAgICAgICAgICAgIGpv\naW5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsLndoZXJlKGpv\naW5TdWJjbGFzcyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBpbmdzW2ldLCBudWxs\nKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaWYg\nY2FuIHNlbGVjdCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNlbGVjdGVkLCBkbyBp\ndAogICAgICAgICAgICAgICAgaWYgKGZtc1tqXS5zdXBwb3J0c1NlbGVjdChz\nZWwsIHNlbC5UWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywKICAgICAgICAgICAg\nICAgICAgICBmZXRjaCkgPiAwKQogICAgICAgICAgICAgICAgICAgIGZtc1tq\nXS5zZWxlY3Qoc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMo\nZm1zW2pdKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2guRUFHRVJf\nTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJvbSBjbGFzcyB0byBp\ndHMgc3ViY2xhc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwogICAgICogZm9yIG11\nbHRpcGxlIGhvcHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJhc2UgY2xhc3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpvaW5zIGpvaW5TdWJjbGFzcyhT\nZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgYmFzZSwKICAgICAgICBDbGFzc01h\ncHBpbmcgc3ViLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChzdWIgPT0g\nYmFzZSB8fCBzdWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdldFRhYmxlKCkKICAg\nICAgICAgICAgfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdldFRhYmxlKCkpKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gcmVjdXJzZSBm\naXJzdCBzbyB3ZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVkCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKTsKICAgICAgICBqb2lucyA9IGpvaW5TdWJjbGFzcyhzZWwsIGJh\nc2UsIHN1cCwgam9pbnMpOwogICAgICAgIGlmIChqb2lucyA9PSBudWxsKQog\nICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpOwogICAgICAgIHJl\ndHVybiBzdWIuam9pblN1cGVyY2xhc3Moam9pbnMsIHRydWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWFrZXMgc3VyZSBhbGwgc3ViY2xhc3NlcyBvZiB0\naGUgZ2l2ZW4gdHlwZSBhcmUgbG9hZGVkIGluIHRoZSBKVk0uCiAgICAgKiBU\naGlzIGlzIHVzdWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcgbWFw\ncGluZykgewogICAgICAgIERpc2NyaW1pbmF0b3IgZHNjID0gbWFwcGluZy5n\nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGRzYy5nZXRTdWJjbGFz\nc2VzTG9hZGVkKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\naWYgdGhlIHN1YmNsYXNzIGxpc3QgaXMgc2V0LCBubyBuZWVkIHRvIGxvYWQg\nc3VicwogICAgICAgIGlmIChtYXBwaW5nLmdldFJlcG9zaXRvcnkoKS5nZXRQ\nZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAgICAgICAgICBfY3R4Lmdl\ndENsYXNzTG9hZGVyKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgZHNjLnNl\ndFN1YmNsYXNzZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRzYy5sb2Fk\nU3ViY2xhc3Nlcyh0aGlzKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdl\ndFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogTWFrZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlkYXRlIGZvciBjYW5j\nZWxsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZvcmVFeGVj\ndXRlU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9zdG1u\ndHMuYWRkKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0\naGUgc3RhdGVtZW50IGZyb20gdGhlIGNhbmNlbGxhYmxlIHNldC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0YXRlbWVudChTdGF0\nZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLnJlbW92ZShzdG1udCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHJldHVybmVkIHRv\nIGNsaWVudCBjb2RlLiBNYWtlcyBzdXJlIGl0cyB3cmFwcGVkIGNvbm5lY3Rp\nb24KICAgICAqIHJlZiBjb3VudCBpcyBkZWNyZW1lbnRlZCBvbiBmaW5hbGl6\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ2xpZW50Q29u\nbmVjdGlvbiBleHRlbmRzIERlbGVnYXRpbmdDb25uZWN0aW9uIHsKCiAgICAg\nICAgcHJpdmF0ZSBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsKCiAgICAgICAg\ncHVibGljIENsaWVudENvbm5lY3Rpb24oQ29ubmVjdGlvbiBjb25uKSB7CiAg\nICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgICAgIHN1cGVyLmNsb3Nl\nKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBmaW5hbGl6\nZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoIV9j\nbG9zZWQpCiAgICAgICAgICAgICAgICBjbG9zZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gd3JhcHBlciB0aGF0IGtl\nZXBzIGFuIGludGVybmFsIHJlZiBjb3VudCBzbyB0aGF0IGl0IGtub3dzCiAg\nICAgKiB3aGVuIHRvIHJlYWxseSBjbG9zZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIGNsYXNzIFJlZkNvdW50Q29ubmVjdGlvbiBleHRlbmRzIERlbGVnYXRp\nbmdDb25uZWN0aW9uIHsKCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9yZXRh\naW4gPSBmYWxzZTsKICAgICAgICBwcml2YXRlIGludCBfcmVmcyA9IDA7CiAg\nICAgICAgcHJpdmF0ZSBib29sZWFuIF9mcmVlZCA9IGZhbHNlOwoKICAgICAg\nICBwdWJsaWMgUmVmQ291bnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikg\newogICAgICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIGdldFJldGFpbigpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9yZXRhaW47CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBz\nZXRSZXRhaW4oYm9vbGVhbiByZXRhaW4pIHsKICAgICAgICAgICAgaWYgKF9y\nZXRhaW4gJiYgIXJldGFpbiAmJiBfcmVmcyA8PSAwKQogICAgICAgICAgICAg\nICAgZnJlZSgpOwogICAgICAgICAgICBfcmV0YWluID0gcmV0YWluOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVmKCkgewogICAgICAgICAg\nICAvLyBkb24ndCBoYXZlIHRvIGxvY2s7IGNhbGxlZCBmcm9tIGNvbm5lY3Qo\nKSwgd2hpY2ggaXMgbG9ja2VkCiAgICAgICAgICAgIF9yZWZzKys7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAvLyBsb2NrIGF0IGJyb2tlciBsZXZl\nbCB0byBhdm9pZCBkZWFkbG9ja3MKICAgICAgICAgICAgX2N0eC5sb2NrKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcmVmcy0tOwog\nICAgICAgICAgICAgICAgaWYgKF9yZWZzIDw9IDAgJiYgIV9yZXRhaW4pCiAg\nICAgICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgX2N0eC51bmxvY2soKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZnJlZSgpIHsK\nICAgICAgICAgICAgLy8gZW5zdXJlIHRoYXQgd2UgZG8gbm90IGNsb3NlIHRo\nZSB1bmRlcmx5aW5nIGNvbm5lY3Rpb24KICAgICAgICAgICAgLy8gbXVsdGlw\nbGUgdGltZXM7IHRoaXMgY291bGQgaGFwcGVuIGlmIHNvbWVvbmUgKGUuZy4s\nIGFuCiAgICAgICAgICAgIC8vIEV4dGVudCkgaG9sZHMgYSBSZWZDb25uZWN0\naW9uLCBhbmQgdGhlbiBjbG9zZXMgaXQgKGUuZy4sIGluCiAgICAgICAgICAg\nIC8vIHRoZSBmaW5hbGl6ZXIpIGFmdGVyIHRoZSBTdG9yZU1hbmFnZXIgaGFz\nIGFscmVhZHkgYmVlbiBjbG9zZWQuCiAgICAgICAgICAgIGlmIChfZnJlZWQp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgZ2V0RGVsZWdhdGUoKS5jbG9zZSgpOwogICAgICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBfZnJlZWQgPSB0cnVlOwogICAgICAgICAgICBfY29u\nbiA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgU3RhdGVt\nZW50IGNyZWF0ZVN0YXRlbWVudChib29sZWFuIHdyYXApIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3IENhbmNlbFN0YXRl\nbWVudChzdXBlci5jcmVhdGVTdGF0ZW1lbnQoZmFsc2UpLAogICAgICAgICAg\nICAgICAgUmVmQ291bnRDb25uZWN0aW9uLnRoaXMpOwogICAgICAgIH0KCiAg\nICAgICAgcHJvdGVjdGVkIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoaW50\nIHJzVHlwZSwgaW50IHJzQ29uY3VyLAogICAgICAgICAgICBib29sZWFuIHdy\nYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4g\nbmV3IENhbmNlbFN0YXRlbWVudChzdXBlci5jcmVhdGVTdGF0ZW1lbnQocnNU\neXBlLCByc0NvbmN1ciwKICAgICAgICAgICAgICAgIGZhbHNlKSwgUmVmQ291\nbnRDb25uZWN0aW9uLnRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5n\nIHNxbCwgYm9vbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxQcmVwYXJl\nZFN0YXRlbWVudChzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwKICAgICAg\nICAgICAgICAgIGZhbHNlKSwgUmVmQ291bnRDb25uZWN0aW9uLnRoaXMpOwog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50\nIHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwgaW50IHJzVHlwZSwKICAg\nICAgICAgICAgaW50IHJzQ29uY3VyLCBib29sZWFuIHdyYXApIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3IENhbmNlbFBy\nZXBhcmVkU3RhdGVtZW50KHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLAog\nICAgICAgICAgICAgICAgcnNUeXBlLCByc0NvbmN1ciwgZmFsc2UpLCBSZWZD\nb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVz\nIGl0c2VsZiBmcm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1l\nbnRzIHNvIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBw\ncml2YXRlIGNsYXNzIENhbmNlbFN0YXRlbWVudCBleHRlbmRzIERlbGVnYXRp\nbmdTdGF0ZW1lbnQgewoKICAgICAgICBwdWJsaWMgQ2FuY2VsU3RhdGVtZW50\nKFN0YXRlbWVudCBzdG1udCwgQ29ubmVjdGlvbiBjb25uKSB7CiAgICAgICAg\nICAgIHN1cGVyKHN0bW50LCBjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZShTdHJpbmcgc3FsKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVu\ndCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5leGVjdXRlVXBkYXRlKHNxbCk7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1l\nbnQodGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KFN0cmluZyBzcWwsIGJv\nb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nZXhlY3V0ZVF1ZXJ5KHNxbCwgd3JhcCk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhp\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJlbW92ZXMgaXRz\nZWxmIGZyb20gdGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0YXRlbWVudHMg\nc28gdGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgY2xhc3MgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxl\nZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQgewoKICAgICAgICBwdWJsaWMgQ2Fu\nY2VsUHJlcGFyZWRTdGF0ZW1lbnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIAogICAgICAgICAgICBDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAg\nc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBleGVjdXRlVXBkYXRlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhl\nY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0\nIGV4ZWN1dGVRdWVyeShib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmV4ZWN1dGVRdWVyeSh3cmFwKTsKICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlz\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIGlu\ndFtdIGV4ZWN1dGVCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1\ndGVCYXRjaCgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

