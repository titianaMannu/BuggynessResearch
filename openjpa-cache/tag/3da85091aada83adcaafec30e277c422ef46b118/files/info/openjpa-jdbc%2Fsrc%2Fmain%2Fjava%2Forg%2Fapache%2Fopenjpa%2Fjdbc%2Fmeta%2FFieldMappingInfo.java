{"sha":"a5cd65b2980cbbb655e66d033c8e015613016a53","node_id":"MDQ6QmxvYjIwNjM2NDphNWNkNjViMjk4MGNiYmI2NTVlNjZkMDMzYzhlMDE1NjEzMDE2YTUz","size":11239,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a5cd65b2980cbbb655e66d033c8e015613016a53","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIueG1sLkNvbW1lbnRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgovKioK\nICogSW5mb3JtYXRpb24gYWJvdXQgdGhlIG1hcHBpbmcgZnJvbSBhIGZpZWxk\nIHRvIHRoZSBzY2hlbWEsIGluIHJhdyBmb3JtLgogKiBUaGUgY29sdW1ucyBh\nbmQgdGFibGVzIHVzZWQgaW4gbWFwcGluZyBpbmZvIHdpbGwgbm90IGJlIHBh\ncnQgb2YgdGhlCiAqIHtAbGluayBTY2hlbWFHcm91cH0gdXNlZCBhdCBydW50\naW1lLiBSYXRoZXIsIHRoZXkgd2lsbCBiZSBzdHJ1Y3RzCiAqIHdpdGggdGhl\nIHJlbGV2YW50IHBpZWNlcyBvZiBpbmZvcm1hdGlvbiBmaWxsZWQgaW4uCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgRmllbGRN\nYXBwaW5nSW5mbwogICAgZXh0ZW5kcyBNYXBwaW5nSW5mbwogICAgaW1wbGVt\nZW50cyBDb21tZW50YWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAg\nIChGaWVsZE1hcHBpbmdJbmZvLmNsYXNzKTsKCiAgICBwcml2YXRlIFN0cmlu\nZyBfdGFibGVOYW1lID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3V0\nZXIgPSBmYWxzZTsKICAgIHByaXZhdGUgQ29sdW1uIF9vcmRlckNvbCA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Nhbk9yZGVyQ29sID0gdHJ1ZTsK\nICAgIHByaXZhdGUgU3RyaW5nW10gX2NvbW1lbnRzID0gbnVsbDsKCiAgICAv\nKioKICAgICAqIFRoZSB1c2VyLXN1cHBsaWVkIG5hbWUgb2YgdGhlIHRhYmxl\nIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFRhYmxlTmFtZSgpIHsKICAgICAgICByZXR1cm4gX3RhYmxlTmFtZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyLXN1cHBsaWVkIG5hbWUgb2Yg\ndGhlIHRhYmxlIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRUYWJsZU5hbWUoU3RyaW5nIHRhYmxlTmFtZSkgewogICAgICAg\nIF90YWJsZU5hbWUgPSB0YWJsZU5hbWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRoZSBmaWVsZCdzIHRhYmxlIGlzIGpvaW5lZCB0byB0aGUg\nY2xhc3MgdGFibGUgdGhyb3VnaCBhbgogICAgICogb3V0ZXIgam9pbi4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNKb2luT3V0ZXIoKSB7CiAgICAg\nICAgcmV0dXJuIF9vdXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIGZpZWxkJ3MgdGFibGUgaXMgam9pbmVkIHRvIHRoZSBjbGFzcyB0\nYWJsZSB0aHJvdWdoIGFuCiAgICAgKiBvdXRlciBqb2luLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRKb2luT3V0ZXIoYm9vbGVhbiBvdXRlcikgewog\nICAgICAgIF9vdXRlciA9IG91dGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nUmF3IHN5bnRoZXRpYyBvcmRlcmluZyBjb2x1bW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2x1bW4gZ2V0T3JkZXJDb2x1bW4oKSB7CiAgICAgICAgcmV0dXJu\nIF9vcmRlckNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBzeW50aGV0\naWMgb3JkZXJpbmcgY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRPcmRlckNvbHVtbihDb2x1bW4gb3JkZXIpIHsKICAgICAgICBfb3JkZXJD\nb2wgPSBvcmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgd2Ug\nY2FuIGhhdmUgYW4gb3JkZXJpbmcgY29sdW1uLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBjYW5PcmRlckNvbHVtbigpIHsKICAgICAgICByZXR1cm4g\nX2Nhbk9yZGVyQ29sOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB3\nZSBjYW4gaGF2ZSBhbiBvcmRlcmluZyBjb2x1bW4uCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldENhbk9yZGVyQ29sdW1uKGJvb2xlYW4gY2FuT3JkZXIp\nIHsKICAgICAgICBfY2FuT3JkZXJDb2wgPSBjYW5PcmRlcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgdGFibGUgZm9yIHRoZSBnaXZlbiBm\naWVsZCwgb3IgbnVsbCBpZiBubyB0YWJsZSBnaXZlbi4KICAgICAqLwogICAg\ncHVibGljIFRhYmxlIGdldFRhYmxlKGZpbmFsIEZpZWxkTWFwcGluZyBmaWVs\nZCwgYm9vbGVhbiBjcmVhdGUsCiAgICAgICAgYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIGlmIChfdGFibGVOYW1lID09IG51bGwgJiYgIWNyZWF0ZSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFRhYmxlIHRhYmxlID0g\nZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAg\nICBTdHJpbmcgc2NoZW1hTmFtZSA9ICh0YWJsZSA9PSBudWxsKSA/IG51bGwg\nCiAgICAgICAgICAgIDogdGFibGUuZ2V0U2NoZW1hKCkuZ2V0TmFtZSgpOwoK\nICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vIGpvaW4gY29sdW1ucyBkZWZpbmVk\nLCB0aGVyZSBtYXkgYmUgY2xhc3MtbGV2ZWwgam9pbgogICAgICAgIC8vIGlu\nZm9ybWF0aW9uIHdpdGggYSBtb3JlIGZ1bGx5LXF1YWxpZmllZCBuYW1lIGZv\nciBvdXIgdGFibGUKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gX3RhYmxl\nTmFtZTsKICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwgJiYgZ2V0Q29s\ndW1ucygpLmlzRW1wdHkoKSkKICAgICAgICAgICAgdGFibGVOYW1lID0gZmll\nbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0TWFwcGluZ0luZm8oKS4KICAg\nICAgICAgICAgICAgIGdldFNlY29uZGFyeVRhYmxlTmFtZSh0YWJsZU5hbWUp\nOwoKICAgICAgICByZXR1cm4gY3JlYXRlVGFibGUoZmllbGQsIG5ldyBUYWJs\nZURlZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMgU3RyaW5nIGdldChT\nY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgICAgICAgICAvLyBkZWxheSB0aGlz\nIHNvIHRoYXQgd2UgZG9uJ3QgZG8gc2NoZW1hIHJlZmxlY3Rpb24gZm9yIHVu\naXF1ZQogICAgICAgICAgICAgICAgLy8gdGFibGUgbmFtZSB1bmxlc3MgbmVj\nZXNzYXJ5CiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuZ2V0TWFwcGlu\nZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAg\nICAgICAgICAgICBnZXRUYWJsZU5hbWUoZmllbGQsIHNjaGVtYSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9LCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGFk\nYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgam9pbiBm\ncm9tIHRoZSBmaWVsZCB0YWJsZSB0byB0aGUgb3duaW5nIGNsYXNzIHRhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRKb2luKGZpbmFs\nIEZpZWxkTWFwcGluZyBmaWVsZCwgVGFibGUgdGFibGUsCiAgICAgICAgYm9v\nbGVhbiBhZGFwdCkgewogICAgICAgIC8vIGlmIHdlIGhhdmUgbm8gam9pbiBj\nb2x1bW5zIGRlZmluZWQsIGNoZWNrIGNsYXNzLWxldmVsIGpvaW4KICAgICAg\nICBMaXN0IGNvbHMgPSBnZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNvbHMu\naXNFbXB0eSgpKQogICAgICAgICAgICBjb2xzID0gZmllbGQuZ2V0RGVmaW5p\nbmdNYXBwaW5nKCkuZ2V0TWFwcGluZ0luZm8oKS4KICAgICAgICAgICAgICAg\nIGdldFNlY29uZGFyeVRhYmxlSm9pbkNvbHVtbnMoX3RhYmxlTmFtZSk7Cgog\nICAgICAgIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYgPSBuZXcgRm9yZWlnbktl\neURlZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMgRm9yZWlnbktleSBn\nZXQoVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIGJvb2xlYW4gaW52ZXJz\nZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmdldE1hcHBpbmdS\nZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAgICAgICAgICAg\nICAgICAgICAgZ2V0Sm9pbkZvcmVpZ25LZXkoZmllbGQsIGxvY2FsLCBmb3Jl\naWduKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQg\ncG9wdWxhdGUoVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIENvbHVtbiBj\nb2wsCiAgICAgICAgICAgICAgICBPYmplY3QgdGFyZ2V0LCBib29sZWFuIGlu\ndmVyc2UsIGludCBwb3MsIGludCBjb2xzKSB7CiAgICAgICAgICAgICAgICBm\naWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0\ncygpLgogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlSm9pbkNvbHVtbihm\naWVsZCwgbG9jYWwsIGZvcmVpZ24sIGNvbCwgdGFyZ2V0LAogICAgICAgICAg\nICAgICAgICAgICAgICBwb3MsIGNvbHMpOwogICAgICAgICAgICB9CiAgICAg\nICAgfTsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gZmllbGQuZ2V0RGVm\naW5pbmdNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUZvcmVpZ25L\nZXkoZmllbGQsICJqb2luIiwgY29scywgZGVmLCB0YWJsZSwgY2xzLCBjbHMs\nCiAgICAgICAgICAgIGZhbHNlLCBhZGFwdCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBVbmlxdWUgY29uc3RyYWludCBvbiB0aGUgZmllbGQgam9pbi4KICAg\nICAqLwogICAgcHVibGljIFVuaXF1ZSBnZXRKb2luVW5pcXVlKEZpZWxkTWFw\ncGluZyBmaWVsZCwgYm9vbGVhbiBkZWYsCiAgICAgICAgYm9vbGVhbiBhZGFw\ndCkgewogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5nZXRKb2luRm9y\nZWlnbktleSgpOwogICAgICAgIGlmIChmayA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgVW5pcXVlIHVucSA9IG51bGw7CiAg\nICAgICAgaWYgKGZrLmdldENvbHVtbnMoKS5sZW5ndGggPiAwKQogICAgICAg\nICAgICB1bnEgPSBmaWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1h\ncHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgZ2V0Sm9pblVuaXF1\nZShmaWVsZCwgZmsuZ2V0VGFibGUoKSwgZmsuZ2V0Q29sdW1ucygpKTsKICAg\nICAgICByZXR1cm4gY3JlYXRlVW5pcXVlKGZpZWxkLCAiam9pbiIsIHVucSwg\nZmsuZ2V0Q29sdW1ucygpLCBhZGFwdCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbmRleCBvbiB0aGUgZmllbGQgam9pbi4KICAgICAqLwogICAgcHVibGlj\nIEluZGV4IGdldEpvaW5JbmRleChGaWVsZE1hcHBpbmcgZmllbGQsIGJvb2xl\nYW4gYWRhcHQpIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0\nSm9pbkZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEluZGV4IGlkeCA9IG51\nbGw7CiAgICAgICAgaWYgKGZrLmdldENvbHVtbnMoKS5sZW5ndGggPiAwKQog\nICAgICAgICAgICBpZHggPSBmaWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgp\nLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgZ2V0Sm9p\nbkluZGV4KGZpZWxkLCBmay5nZXRUYWJsZSgpLCBmay5nZXRDb2x1bW5zKCkp\nOwogICAgICAgIHJldHVybiBjcmVhdGVJbmRleChmaWVsZCwgImpvaW4iLCBp\nZHgsIGZrLmdldENvbHVtbnMoKSwgYWRhcHQpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBvcmRlcmluZyBjb2x1bW4gZm9yIHRoaXMgZmll\nbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIENvbHVt\nbiBnZXRPcmRlckNvbHVtbihGaWVsZE1hcHBpbmcgZmllbGQsIFRhYmxlIHRh\nYmxlLAogICAgICAgIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAoX29y\nZGVyQ29sICE9IG51bGwgJiYgZmllbGQuZ2V0T3JkZXJEZWNsYXJhdGlvbigp\nICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgib3JkZXItY29uZmxpY3QiLCBmaWVsZCkpOwoKICAg\nICAgICAvLyByZXNldCBJTwogICAgICAgIHNldENvbHVtbklPKG51bGwpOwoK\nICAgICAgICAvLyBoYXMgdXNlciBoYXMgZXhwbGljaXRseSB0dXJuZWQgb3Jk\nZXJpbmcgb2ZmPwogICAgICAgIGlmICghX2Nhbk9yZGVyQ29sIHx8IGZpZWxk\nLmdldE9yZGVyRGVjbGFyYXRpb24oKSAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gaWYgbm8gZGVmYXVsdHMgcmV0dXJu\nIG51bGwKICAgICAgICBNYXBwaW5nRGVmYXVsdHMgZGVmID0gZmllbGQuZ2V0\nTWFwcGluZ1JlcG9zaXRvcnkoKS4KICAgICAgICAgICAgZ2V0TWFwcGluZ0Rl\nZmF1bHRzKCk7CiAgICAgICAgaWYgKF9vcmRlckNvbCA9PSBudWxsICYmICgh\nYWRhcHQgJiYgIWRlZi5kZWZhdWx0TWlzc2luZ0luZm8oKSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1bW4gdG1wbGF0ZSA9IG5l\ndyBDb2x1bW4oKTsKICAgICAgICB0bXBsYXRlLnNldE5hbWUoIm9yZHIiKTsK\nICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKEphdmFUeXBlcy5JTlQpOwog\nICAgICAgIGlmICghZGVmLnBvcHVsYXRlT3JkZXJDb2x1bW5zKGZpZWxkLCB0\nYWJsZSwgbmV3IENvbHVtbltdeyB0bXBsYXRlIH0pCiAgICAgICAgICAgICYm\nIF9vcmRlckNvbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgaWYgKF9vcmRlckNvbCAhPSBudWxsICYmIChfb3JkZXJDb2wu\nZ2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUpCiAgICAgICAgICAg\nIHx8IF9vcmRlckNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxF\nKSkpIHsKICAgICAgICAgICAgQ29sdW1uSU8gaW8gPSBuZXcgQ29sdW1uSU8o\nKTsKICAgICAgICAgICAgaW8uc2V0SW5zZXJ0YWJsZSgwLCAhX29yZGVyQ29s\nLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKSk7CiAgICAgICAg\nICAgIGlvLnNldFVwZGF0YWJsZSgwLCAhX29yZGVyQ29sLmdldEZsYWcoQ29s\ndW1uLkZMQUdfVU5VUERBVEFCTEUpKTsKICAgICAgICAgICAgc2V0Q29sdW1u\nSU8oaW8pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1lcmdlQ29sdW1u\nKGZpZWxkLCAib3JkZXIiLCB0bXBsYXRlLCB0cnVlLCBfb3JkZXJDb2wsIHRh\nYmxlLAogICAgICAgICAgICBhZGFwdCwgZGVmLmRlZmF1bHRNaXNzaW5nSW5m\nbygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIGludGVy\nbmFsIGluZm9ybWF0aW9uIHdpdGggdGhlIG1hcHBpbmcgZGF0YSBmb3IgdGhl\nIGdpdmVuCiAgICAgKiBmaWVsZC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc3luY1dpdGgoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgY2xlYXIo\nZmFsc2UpOwoKICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXko\nKSAhPSBudWxsKQogICAgICAgICAgICBfdGFibGVOYW1lID0gZmllbGQuZ2V0\nTWFwcGluZ1JlcG9zaXRvcnkoKS5nZXREQkRpY3Rpb25hcnkoKS4KICAgICAg\nICAgICAgICAgIGdldEZ1bGxOYW1lKGZpZWxkLmdldFRhYmxlKCksIHRydWUp\nOwoKICAgICAgICBDbGFzc01hcHBpbmcgZGVmID0gZmllbGQuZ2V0RGVmaW5p\nbmdNYXBwaW5nKCk7CiAgICAgICAgc2V0Q29sdW1uSU8oZmllbGQuZ2V0Sm9p\nbkNvbHVtbklPKCkpOwogICAgICAgIGlmIChmaWVsZC5nZXRKb2luRm9yZWln\nbktleSgpICE9IG51bGwgJiYgZGVmLmdldFRhYmxlKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgc3luY0ZvcmVpZ25LZXkoZmllbGQsIGZpZWxkLmdldEpvaW5G\nb3JlaWduS2V5KCksCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUYWJsZSgp\nLCBkZWYuZ2V0VGFibGUoKSk7CiAgICAgICAgX291dGVyID0gZmllbGQuaXNK\nb2luT3V0ZXIoKTsKCiAgICAgICAgc3luY0luZGV4KGZpZWxkLCBmaWVsZC5n\nZXRKb2luSW5kZXgoKSk7CiAgICAgICAgc3luY1VuaXF1ZShmaWVsZCwgZmll\nbGQuZ2V0Sm9pblVuaXF1ZSgpKTsKICAgICAgICBzeW5jT3JkZXJDb2x1bW4o\nZmllbGQpOwogICAgICAgIHN5bmNTdHJhdGVneShmaWVsZCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTeW5jaHJvbml6ZSBpbnRlcm5hbCBtYXBwaW5nIHN0\ncmF0ZWd5IGluZm9ybWF0aW9uIHdpdGggdGhlIGdpdmVuIGZpZWxkLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzeW5jU3RyYXRlZ3koRmllbGRNYXBwaW5n\nIGZpZWxkKSB7CiAgICAgICAgc2V0U3RyYXRlZ3kobnVsbCk7CiAgICAgICAg\naWYgKGZpZWxkLmdldEhhbmRsZXIoKSAhPSBudWxsIHx8IGZpZWxkLmdldFN0\ncmF0ZWd5KCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAvLyBleHBsaWNpdCBzdHJhdGVneSBpZiB0aGUgc3RyYXRlZ3kgaXNuJ3Qg\ndGhlIGV4cGVjdGVkIGRlZmF1bHQKICAgICAgICBTdHJhdGVneSBzdHJhdCA9\nIGZpZWxkLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZGVmYXVsdFN0cmF0ZWd5\nCiAgICAgICAgICAgIChmaWVsZCwgZmFsc2UpOwogICAgICAgIGlmIChzdHJh\ndCA9PSBudWxsIHx8ICFzdHJhdC5nZXRBbGlhcygpLmVxdWFscyhmaWVsZC5n\nZXRBbGlhcygpKSkKICAgICAgICAgICAgc2V0U3RyYXRlZ3koZmllbGQuZ2V0\nQWxpYXMoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jaHJvbml6ZSBp\nbnRlcm5hbCBvcmRlciBjb2x1bW4gaW5mb3JtYXRpb24gd2l0aCB0aGUgZ2l2\nZW4gZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN5bmNPcmRlckNv\nbHVtbihGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQu\nZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICBfb3JkZXJD\nb2wgPSBzeW5jQ29sdW1uKGZpZWxkLCBmaWVsZC5nZXRPcmRlckNvbHVtbigp\nLCAxLCBmYWxzZSwKICAgICAgICAgICAgICAgIGZpZWxkLmdldFRhYmxlKCks\nIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9vcmRlckNvbCA9IG51bGw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naGFzU2NoZW1hQ29tcG9uZW50cygpIHsKICAgICAgICByZXR1cm4gc3VwZXIu\naGFzU2NoZW1hQ29tcG9uZW50cygpIHx8IF90YWJsZU5hbWUgIT0gbnVsbAog\nICAgICAgICAgICB8fCBfb3JkZXJDb2wgIT0gbnVsbDsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBjbGVhcihib29sZWFuIGNhbkZsYWdzKSB7CiAgICAg\nICAgc3VwZXIuY2xlYXIoY2FuRmxhZ3MpOwogICAgICAgIF90YWJsZU5hbWUg\nPSBudWxsOwogICAgICAgIF9vcmRlckNvbCA9IG51bGw7CiAgICAgICAgaWYg\nKGNhbkZsYWdzKQogICAgICAgICAgICBfY2FuT3JkZXJDb2wgPSB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvcHkoTWFwcGluZ0luZm8gaW5mbykg\newogICAgICAgIHN1cGVyLmNvcHkoaW5mbyk7CiAgICAgICAgaWYgKCEoaW5m\nbyBpbnN0YW5jZW9mIEZpZWxkTWFwcGluZ0luZm8pKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIEZpZWxkTWFwcGluZ0luZm8gZmluZm8gPSAoRmll\nbGRNYXBwaW5nSW5mbykgaW5mbzsKICAgICAgICBpZiAoX3RhYmxlTmFtZSA9\nPSBudWxsKQogICAgICAgICAgICBfdGFibGVOYW1lID0gZmluZm8uZ2V0VGFi\nbGVOYW1lKCk7CiAgICAgICAgaWYgKCFfb3V0ZXIpCiAgICAgICAgICAgIF9v\ndXRlciA9IGZpbmZvLmlzSm9pbk91dGVyKCk7CiAgICAgICAgaWYgKF9jYW5P\ncmRlckNvbCAmJiBfb3JkZXJDb2wgPT0gbnVsbCkKICAgICAgICAgICAgX2Nh\nbk9yZGVyQ29sID0gZmluZm8uY2FuT3JkZXJDb2x1bW4oKTsKICAgICAgICBp\nZiAoX2Nhbk9yZGVyQ29sICYmIGZpbmZvLmdldE9yZGVyQ29sdW1uKCkgIT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX29yZGVyQ29sID09IG51bGwpCiAg\nICAgICAgICAgICAgICBfb3JkZXJDb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAg\nICAgICAgIF9vcmRlckNvbC5jb3B5KGZpbmZvLmdldE9yZGVyQ29sdW1uKCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q29t\nbWVudHMoKSB7CiAgICAgICAgcmV0dXJuIChfY29tbWVudHMgPT0gbnVsbCkg\nPyBFTVBUWV9DT01NRU5UUyA6IF9jb21tZW50czsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRDb21tZW50cyhTdHJpbmdbXSBjb21tZW50cykgewogICAg\nICAgIF9jb21tZW50cyA9IGNvbW1lbnRzOwogICAgfQp9Cg==\n","encoding":"base64"}

