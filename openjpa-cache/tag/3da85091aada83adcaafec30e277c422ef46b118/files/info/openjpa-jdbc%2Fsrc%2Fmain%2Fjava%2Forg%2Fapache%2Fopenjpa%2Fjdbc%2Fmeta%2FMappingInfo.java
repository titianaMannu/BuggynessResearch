{"sha":"c4468ff9f14a1eef461a4e9b0d32553dabcb4aa0","node_id":"MDQ6QmxvYjIwNjM2NDpjNDQ2OGZmOWYxNGExZWVmNDYxYTRlOWIwZDMyNTUzZGFiY2I0YWEw","size":65918,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c4468ff9f14a1eef461a4e9b0d32553dabcb4aa0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVt\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5G\nb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEJhc2UgY2xhc3Mgc3Rvcmlu\nZyByYXcgbWFwcGluZyBpbmZvcm1hdGlvbjsgZGVmaW5lcyB1dGlsaXR5IG1l\ndGhvZHMgZm9yCiAqIGNvbnZlcnRpbmcgcmF3IG1hcHBpbmcgaW5mb3JtYXRp\nb24gdG8gZnVsbCBtYXBwaW5nIHRvIHRoZSBzY2hlbWEuCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgTWFwcGlu\nZ0luZm8KICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBKT0lOX05PTkUgPSAwOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgSk9JTl9GT1JXQVJEID0gMTsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEpPSU5fSU5WRVJTRSA9IDI7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChNYXBwaW5nSW5mby5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3N0cmF0ZWd5ID0gbnVsbDsKICAg\nIHByaXZhdGUgTGlzdCBfY29scyA9IG51bGw7CiAgICBwcml2YXRlIEluZGV4\nIF9pZHggPSBudWxsOwogICAgcHJpdmF0ZSBVbmlxdWUgX3VucSA9IG51bGw7\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgX2ZrID0gbnVsbDsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfY2FuSWR4ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfY2FuVW5xID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2FuRksg\nPSB0cnVlOwogICAgcHJpdmF0ZSBpbnQgX2pvaW4gPSBKT0lOX05PTkU7CiAg\nICBwcml2YXRlIENvbHVtbklPIF9pbyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBNYXBwaW5nIHN0cmF0ZWd5IG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0U3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVn\neTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcHBpbmcgc3RyYXRlZ3kgbmFt\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3RyYXRlZ3koU3RyaW5n\nIHN0cmF0ZWd5KSB7CiAgICAgICAgX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSYXcgY29sdW1uIGRhdGEuCiAgICAgKi8K\nICAgIHB1YmxpYyBMaXN0IGdldENvbHVtbnMoKSB7CiAgICAgICAgcmV0dXJu\nIChfY29scyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QgOiBf\nY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBjb2x1bW4gZGF0YS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q29sdW1ucyhMaXN0IGNvbHMp\nIHsKICAgICAgICBfY29scyA9IGNvbHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgaW5kZXguCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBnZXRJbmRl\neCgpIHsKICAgICAgICByZXR1cm4gX2lkeDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJhdyBpbmRleC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW5k\nZXgoSW5kZXggaWR4KSB7CiAgICAgICAgX2lkeCA9IGlkeDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhw\nbGljaXRseSBub24taW5kZXhhYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjYW5JbmRleCgpIHsKICAgICAgICByZXR1cm4gX2NhbklkeDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMg\nYXMgZXhwbGljaXRseSBub24taW5kZXhhYmxlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRDYW5JbmRleChib29sZWFuIGluZGV4YWJsZSkgewogICAg\nICAgIF9jYW5JZHggPSBpbmRleGFibGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1\nYmxpYyBGb3JlaWduS2V5IGdldEZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0\ndXJuIF9mazsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBmb3JlaWduIGtl\neSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Rm9y\nZWlnbktleShGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgX2ZrID0gZms7CiAg\nICAgICAgaWYgKGZrICE9IG51bGwgJiYgX2pvaW4gPT0gSk9JTl9OT05FKQog\nICAgICAgICAgICBfam9pbiA9IEpPSU5fRk9SV0FSRDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhwbGlj\naXRseSBub3QgaGF2aW5nIGEgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGNhbkZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJu\nIF9jYW5GSzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBt\nYXJrIGNvbHVtbnMgYXMgZXhwbGljaXRseSBub3QgaGF2aW5nIGEgZm9yZWln\nbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENhbkZvcmVpZ25L\nZXkoYm9vbGVhbiBma2FibGUpIHsKICAgICAgICBfY2FuRksgPSBma2FibGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSYXcgdW5pcXVlIGNvbnN0cmFpbnQg\naW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBVbmlxdWUgZ2V0VW5p\ncXVlKCkgewogICAgICAgIHJldHVybiBfdW5xOwogICAgfQoKICAgIC8qKgog\nICAgICogUmF3IHVuaXF1ZSBjb25zdHJhaW50IGluZm9ybWF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRVbmlxdWUoVW5pcXVlIHVucSkgewog\nICAgICAgIF91bnEgPSB1bnE7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\ndXNlciBjYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm90IGhhdmlu\nZyBhIHVuaXF1ZSBjb25zdHJhaW50LgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjYW5VbmlxdWUoKSB7CiAgICAgICAgcmV0dXJuIF9jYW5VbnE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFyayBjb2x1bW5z\nIGFzIGV4cGxpY2l0bHkgbm90IGhhdmluZyBhIHVuaXF1ZSBjb25zdHJhaW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDYW5VbmlxdWUoYm9vbGVh\nbiB1bmlxdWFibGUpIHsKICAgICAgICBfY2FuVW5xID0gdW5pcXVhYmxlOwog\nICAgfQoKICAgIC8qKgogICAgICogSS9PIGZvciB0aGUgY29sdW1ucyBjcmVh\ndGVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8ge0BsaW5rICNjcmVhdGVDb2x1bW5z\nfSwKICAgICAqIG9yIGZvciB0aGUgZm9yZWlnbiBrZXkgY3JlYXRlZCBieSB0\naGUgbGFzdCBjYWxsIHRvCiAgICAgKiB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25L\nZXl9LiBUaGlzIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJlY3Rs\neQogICAgICogcHJpb3IgdG8gY2FsbHMgdG8ge0BsaW5rICNzeW5jQ29sdW1u\nc30gYW5kIHtAbGluayAjc3luY0ZvcmVpZ25LZXl9LgogICAgICovCiAgICBw\ndWJsaWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAgcmV0dXJu\nIF9pbzsKICAgIH0KCiAgICAvKioKICAgICAqIEkvTyBmb3IgdGhlIGNvbHVt\nbnMgY3JlYXRlZCBieSB0aGUgbGFzdCBjYWxsIHRvIHtAbGluayAjY3JlYXRl\nQ29sdW1uc30sCiAgICAgKiBvciBmb3IgdGhlIGZvcmVpZ24ga2V5IGNyZWF0\nZWQgYnkgdGhlIGxhc3QgY2FsbCB0bwogICAgICoge0BsaW5rICNjcmVhdGVG\nb3JlaWduS2V5fS4gVGhpcyBpcyBhbHNvIGV4cGVjdGVkIHRvIGJlIHNldCBj\nb3JyZWN0bHkKICAgICAqIHByaW9yIHRvIGNhbGxzIHRvIHtAbGluayAjc3lu\nY0NvbHVtbnN9IGFuZCB7QGxpbmsgI3N5bmNGb3JlaWduS2V5fS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0Q29sdW1uSU8oQ29sdW1uSU8gaW8pIHsK\nICAgICAgICBfaW8gPSBpbzsKICAgIH0KCiAgICAvKioKICAgICAqIERpcmVj\ndGlvbiBvZiB0aGUgam9pbiB0aGF0IHRoZSBjb2x1bW5zIG9mIHRoaXMgbWFw\ncGluZyBpbmZvIGZvcm0uIFRoaXMKICAgICAqIGlzIHVzdWFsbHkgYXV0b21h\ndGljYWxseSBzZXQgYnkge0BsaW5rICNjcmVhdGVGb3JlaWduS2V5fS4gVGhp\ncyBmbGFnCiAgICAgKiBpcyBhbHNvIGV4cGVjdGVkIHRvIGJlIHNldCBjb3Jy\nZWN0bHkgcHJpb3IgdG8gY2FsbHMgdG8KICAgICAqIHtAbGluayAjc3luY0Zv\ncmVpZ25LZXl9IGlmIHRoZSBqb2luIGlzIGludmVyc2VkLgogICAgICovCiAg\nICBwdWJsaWMgaW50IGdldEpvaW5EaXJlY3Rpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF9qb2luOwogICAgfQoKICAgIC8qKgogICAgICogRGlyZWN0aW9uIG9m\nIHRoZSBqb2luIHRoYXQgdGhlIGNvbHVtbnMgb2YgdGhpcyBtYXBwaW5nIGlu\nZm8gZm9ybS4gVGhpcwogICAgICogaXMgdXN1YWxseSBhdXRvbWF0aWNhbGx5\nIHNldCBieSB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25LZXl9LiBUaGlzIGZsYWcK\nICAgICAqIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJlY3RseSBw\ncmlvciB0byBjYWxscyB0bwogICAgICoge0BsaW5rICNzeW5jRm9yZWlnbktl\neX0gaWYgdGhlIGpvaW4gaXMgaW52ZXJzZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEpvaW5EaXJlY3Rpb24oaW50IGpvaW4pIHsKICAgICAgICBf\nam9pbiA9IGpvaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwg\nbWFwcGluZyBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgY2xlYXIodHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDbGVhciBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSBjYW5GbGFncyB3aGV0aGVyIHRvIGNsZWFyIGluZm9ybWF0\naW9uIGFib3V0IHdoZXRoZXIgd2UKICAgICAqIGNhbiBwbGFjZSBpbmRleGVk\nLCBmb3JlaWduIGtleXMsIGV0YyBvbiB0aGlzIG1hcHBpbmcKICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXIoYm9vbGVhbiBjYW5GbGFncykgewog\nICAgICAgIF9zdHJhdGVneSA9IG51bGw7CiAgICAgICAgX2NvbHMgPSBudWxs\nOwogICAgICAgIF9pbyA9IG51bGw7CiAgICAgICAgX2lkeCA9IG51bGw7CiAg\nICAgICAgX3VucSA9IG51bGw7CiAgICAgICAgX2ZrID0gbnVsbDsKICAgICAg\nICBfam9pbiA9IEpPSU5fTk9ORTsKICAgICAgICBpZiAoY2FuRmxhZ3MpIHsK\nICAgICAgICAgICAgX2NhbklkeCA9IHRydWU7CiAgICAgICAgICAgIF9jYW5G\nSyA9IHRydWU7CiAgICAgICAgICAgIF9jYW5VbnEgPSB0cnVlOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgbWlzc2luZyBpbmZvIGZy\nb20gdGhlIGluc3RhbmNlIHRvIHRoaXMgb25lLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjb3B5KE1hcHBpbmdJbmZvIGluZm8pIHsKICAgICAgICBpZiAo\nX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIF9zdHJhdGVneSA9IGlu\nZm8uZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAoX2NhbklkeCAmJiBfaWR4\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluZm8uZ2V0SW5kZXgoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2lkeCA9IGluZm8uZ2V0SW5kZXgo\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2NhbklkeCA9\nIGluZm8uY2FuSW5kZXgoKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9jYW5V\nbnEgJiYgX3VucSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbmZvLmdl\ndFVuaXF1ZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBfdW5xID0gaW5m\nby5nZXRVbmlxdWUoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgX2NhblVucSA9IGluZm8uY2FuVW5pcXVlKCk7CiAgICAgICAgfQogICAg\nICAgIGlmIChfY2FuRksgJiYgX2ZrID09IG51bGwpIHsKICAgICAgICAgICAg\naWYgKGluZm8uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZmsgPSBpbmZvLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX2NhbkZLID0gaW5mby5jYW5Gb3JlaWdu\nS2V5KCk7CiAgICAgICAgfQoKICAgICAgICBMaXN0IGNvbHMgPSBnZXRDb2x1\nbW5zKCk7CiAgICAgICAgTGlzdCBpY29scyA9IGluZm8uZ2V0Q29sdW1ucygp\nOwogICAgICAgIGlmICghaWNvbHMuaXNFbXB0eSgpICYmIChjb2xzLmlzRW1w\ndHkoKQogICAgICAgICAgICB8fCBjb2xzLnNpemUoKSA9PSBpY29scy5zaXpl\nKCkpKSB7CiAgICAgICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIGNvbHMgPSBuZXcgQXJyYXlMaXN0KGljb2xzLnNpemUoKSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWNvbHMuc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChjb2xzLnNpemUoKSA9PSBp\nKQogICAgICAgICAgICAgICAgICAgIGNvbHMuYWRkKG5ldyBDb2x1bW4oKSk7\nCiAgICAgICAgICAgICAgICAoKENvbHVtbikgY29scy5nZXQoaSkpLmNvcHko\nKENvbHVtbikgaWNvbHMuZ2V0KGkpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRDb2x1bW5zKGNvbHMpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMgaW5mbyBoYXMgY29sdW1u\ncywgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24sIGluZGV4CiAgICAgKiBpbmZv\ncm1hdGlvbiwgZXRjLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNT\nY2hlbWFDb21wb25lbnRzKCkgewogICAgICAgIHJldHVybiAoX2NvbHMgIT0g\nbnVsbCAmJiAhX2NvbHMuaXNFbXB0eSgpKQogICAgICAgICAgICB8fCBfaWR4\nICE9IG51bGwKICAgICAgICAgICAgfHwgX3VucSAhPSBudWxsCiAgICAgICAg\nICAgIHx8IF9mayAhPSBudWxsCiAgICAgICAgICAgIHx8ICFfY2FuSWR4CiAg\nICAgICAgICAgIHx8ICFfY2FuRksKICAgICAgICAgICAgfHwgIV9jYW5VbnE7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgdXNlciBk\naWQgbm90IHN1cHBseSBhbnkgY29sdW1ucywgaW5kZXgsIHVuaXF1ZQogICAg\nICogY29uc3RyYWludCwgb3IgZm9yZWlnbiBrZXkgZm9yIHRoaXMgbWFwcGlu\nZy4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9TY2hlbWFDb21w\nb25lbnRzKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBib29sZWFuIGRpZSkg\newogICAgICAgIGlmIChfY29scyA9PSBudWxsIHx8IF9jb2xzLmlzRW1wdHko\nKSkgewogICAgICAgICAgICBhc3NlcnROb0luZGV4KGNvbnRleHQsIGRpZSk7\nCiAgICAgICAgICAgIGFzc2VydE5vVW5pcXVlKGNvbnRleHQsIGRpZSk7CiAg\nICAgICAgICAgIGFzc2VydE5vRm9yZWlnbktleShjb250ZXh0LCBkaWUpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNZXNzYWdl\nIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLWNvbHMiLCBjb250ZXh0KTsK\nICAgICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRv\ncnkoKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGlzIGluZm8gaGFzIHRoZSBnaXZlbiBzdHJhdGVn\neSBvciBubyBzdHJhdGVneS4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNz\nZXJ0U3RyYXRlZ3koTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIE9iamVjdCBj\nb250ZXh0U3RyYXQsCiAgICAgICAgT2JqZWN0IGV4cGVjdGVkLCBib29sZWFu\nIGRpZSkgewogICAgICAgIGlmIChjb250ZXh0U3RyYXQgPT0gZXhwZWN0ZWQp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHN0cmF0Owog\nICAgICAgIGlmIChjb250ZXh0U3RyYXQgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGlmIChfc3RyYXRlZ3kuZXF1YWxzKGV4cGVjdGVk\nLmdldENsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgaWYgKGV4cGVjdGVkIGluc3RhbmNlb2YgU3RyYXRl\nZ3kKICAgICAgICAgICAgICAgICYmIF9zdHJhdGVneS5lcXVhbHMoKChTdHJh\ndGVneSkgZXhwZWN0ZWQpLmdldEFsaWFzKCkpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICBzdHJhdCA9IF9zdHJhdGVneTsKICAgICAg\nICB9IGVsc2UgaWYgKGNvbnRleHRTdHJhdCBpbnN0YW5jZW9mIFN0cmF0ZWd5\nKQogICAgICAgICAgICBzdHJhdCA9ICgoU3RyYXRlZ3kpIGNvbnRleHRTdHJh\ndCkuZ2V0QWxpYXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0cmF0\nID0gY29udGV4dFN0cmF0LmdldENsYXNzKCkuZ2V0TmFtZSgpOwoKICAgICAg\nICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLXN0cmF0ZWd5\nIiwgY29udGV4dCwgZXhwZWN0ZWQsCiAgICAgICAgICAgIHN0cmF0KTsKICAg\nICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRvcnko\nKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NlcnQgdGhhdCB0aGUgdXNlciBkaWQgbm90IHRyeSB0byBwbGFjZSBhbiBp\nbmRleCBvbiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE5vSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIGJvb2xl\nYW4gZGllKSB7CiAgICAgICAgaWYgKF9pZHggPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1\nbmV4cGVjdGVkLWluZGV4IiwgY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7\nCiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fy\nbihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhl\nIHVzZXIgZGlkIG5vdCB0cnkgdG8gcGxhY2UgYSB1bmlxdWUgY29uc3RyYWlu\ndCBvbiB0aGlzCiAgICAgKiBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnROb1VuaXF1ZShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwg\nYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX3VucSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5n\nZXQoInVuZXhwZWN0ZWQtdW5pcXVlIiwgY29udGV4dCk7CiAgICAgICAgaWYg\nKGRpZSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKG1zZyk7CiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9n\nKCkud2Fybihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRo\nYXQgdGhlIHVzZXIgZGlkIG5vdCB0cnkgdG8gcGxhY2UgYSBmb3JlaWduIGtl\neSBvbiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE5vRm9yZWlnbktleShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgYm9v\nbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX2ZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgi\ndW5leHBlY3RlZC1mayIsIGNvbnRleHQpOwogICAgICAgIGlmIChkaWUpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwog\nICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpLndhcm4o\nbXNnKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSB1\nc2VyIGRpZCBub3QgdHJ5IHRvIGpvaW4uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFzc2VydE5vSm9pbihNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgYm9v\nbGVhbiBkaWUpIHsKICAgICAgICBib29sZWFuIGpvaW4gPSBmYWxzZTsKICAg\nICAgICBpZiAoX2NvbHMgIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1bW4g\nY29sOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgIWpvaW4gJiYgaSA8\nIF9jb2xzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb2wgPSAo\nQ29sdW1uKSBfY29scy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoY29s\nLmdldFRhcmdldCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgam9p\nbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKCFqb2luKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0ZWQtam9pbiIsIGNvbnRleHQpOwog\nICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZpbmQgb3IgZ2VuZXJhdGUgYSB0YWJsZSBmb3IgYSBtYXBwaW5nLgogICAg\nICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHRoYXQgdXNl\ncyB0aGUgdGFibGUKICAgICAqIEBwYXJhbSBkZWYgZGVmYXVsdCB0YWJsZSBu\nYW1lIHByb3ZpZGVyCiAgICAgKiBAcGFyYW0gc2NoZW1hTmFtZSBkZWZhdWx0\nIHNjaGVtYSBpZiBrbm93biwgb3IgbnVsbAogICAgICogQHBhcmFtIGdpdmVu\nIGdpdmVuIHRhYmxlIG5hbWUKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVy\nIHdlIGNhbiBhbHRlciB0aGUgc2NoZW1hIG9yIG1hcHBpbmdzCiAgICAgKi8K\nICAgIHB1YmxpYyBUYWJsZSBjcmVhdGVUYWJsZShNZXRhRGF0YUNvbnRleHQg\nY29udGV4dCwgVGFibGVEZWZhdWx0cyBkZWYsCiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyBnaXZlbiwgYm9vbGVhbiBhZGFwdCkgewogICAg\nICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0\nb3J5KSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBpZiAoZ2l2\nZW4gPT0gbnVsbCAmJiAoZGVmID09IG51bGwgfHwgKCFhZGFwdAogICAgICAg\nICAgICAmJiAhcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1p\nc3NpbmdJbmZvKCkpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby10YWJsZSIsIGNvbnRleHQpKTsKCiAg\nICAgICAgaWYgKHNjaGVtYU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgc2No\nZW1hTmFtZSA9IFNjaGVtYXMuZ2V0TmV3VGFibGVTY2hlbWEoKEpEQkNDb25m\naWd1cmF0aW9uKQogICAgICAgICAgICAgICAgcmVwb3MuZ2V0Q29uZmlndXJh\ndGlvbigpKTsKCiAgICAgICAgLy8gaWYgbm8gZ2l2ZW4gYW5kIGFkYXB0aW5n\nIG9yIGRlZmF1bHRpbmcgbWlzc2luZyBpbmZvLCB1c2UgdGVtcGxhdGUKICAg\nICAgICBTY2hlbWFHcm91cCBncm91cCA9IHJlcG9zLmdldFNjaGVtYUdyb3Vw\nKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IG51bGw7CiAgICAgICAgaWYg\nKGdpdmVuID09IG51bGwpIHsKICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAu\nZ2V0U2NoZW1hKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1h\nID09IG51bGwpCiAgICAgICAgICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRT\nY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGdpdmVuID0gZGVmLmdl\ndChzY2hlbWEpOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGZ1bGxOYW1l\nOwogICAgICAgIGludCBkb3RJZHggPSBnaXZlbi5sYXN0SW5kZXhPZignLicp\nOwogICAgICAgIGlmIChkb3RJZHggPT0gLTEpCiAgICAgICAgICAgIGZ1bGxO\nYW1lID0gKHNjaGVtYU5hbWUgPT0gbnVsbCkgPyBnaXZlbiA6IHNjaGVtYU5h\nbWUgKyAiLiIgKyBnaXZlbjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nZnVsbE5hbWUgPSBnaXZlbjsKICAgICAgICAgICAgc2NoZW1hID0gbnVsbDsK\nICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGdpdmVuLnN1YnN0cmluZygwLCBk\nb3RJZHgpOwogICAgICAgICAgICBnaXZlbiA9IGdpdmVuLnN1YnN0cmluZyhk\nb3RJZHggKyAxKTsKICAgICAgICB9CgogICAgICAgIC8vIGxvb2sgZm9yIG5h\nbWVkIHRhYmxlIHVzaW5nIGZ1bGwgbmFtZSBhbmQgZmluZFRhYmxlLCB3aGlj\naCBhbGxvd3MKICAgICAgICAvLyB0aGUgZHluYW1pYyBzY2hlbWEgZmFjdG9y\neSB0byBjcmVhdGUgdGhlIHRhYmxlIGlmIG5lZWRlZAogICAgICAgIFRhYmxl\nIHRhYmxlID0gZ3JvdXAuZmluZFRhYmxlKGZ1bGxOYW1lKTsKICAgICAgICBp\nZiAodGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRhYmxlOwog\nICAgICAgIGlmICghYWRhcHQpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXRhYmxlIiwgZ2l2ZW4sIGNv\nbnRleHQpKTsKCiAgICAgICAgLy8gbmFtZWQgdGFibGUgZG9lc24ndCBleGlz\ndDsgY3JlYXRlIGl0CiAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1l\nKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgc2NoZW1hID0gZ3JvdXAuYWRkU2NoZW1hKHNjaGVtYU5hbWUpOwog\nICAgICAgIH0KICAgICAgICB0YWJsZSA9IHNjaGVtYS5nZXRUYWJsZShnaXZl\nbik7CiAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgIHRh\nYmxlID0gc2NoZW1hLmFkZFRhYmxlKGdpdmVuKTsKICAgICAgICByZXR1cm4g\ndGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZS9jcmVhdGUg\nY29sdW1ucyBvbiB0aGUgZ2l2ZW4gdGFibGUgYnkgbWVyZ2luZyB0aGUgZ2l2\nZW4KICAgICAqIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXIt\ncHJvdmlkZWQgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNv\nbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBjb2x1bW5zIGZv\ncgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVzc2Fn\nZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gdG1wbGF0ZXMgdGVtcGxhdGUg\nY29sdW1ucwogICAgICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhl\nIGNvbHVtbnMKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBt\nb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBDb2x1bW5bXSBjcmVhdGVDb2x1bW5zKE1ldGFEYXRh\nQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgcHJlZml4LAogICAgICAgIENvbHVt\nbltdIHRtcGxhdGVzLCBUYWJsZSB0YWJsZSwgYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIGFzc2VydFRhYmxlKGNvbnRleHQsIHRhYmxlKTsKICAgICAgICBp\nZiAocHJlZml4ID09IG51bGwpCiAgICAgICAgICAgIHByZWZpeCA9ICJnZW5l\ncmljIjsKCiAgICAgICAgLy8gdGhlIHVzZXIgaGFzIHRvIGdpdmUgdGhlIHJp\nZ2h0IG51bWJlciBvZiBleHBlY3RlZCBjb2x1bW5zIGZvciB0aGlzCiAgICAg\nICAgLy8gbWFwcGluZywgb3Igbm9uZSBhdCBhbGwgaWYgd2UncmUgYWRhcHRp\nbmcuICBjYW4ndCBqdXN0IGdpdmVuIG9uZSBvZgogICAgICAgIC8vIG4gY29s\ndW1ucyBiZWNhdXNlIHdlIGRvbid0IGtub3cgd2hpY2ggb2YgdGhlIG4gY29s\ndW1ucyB0aGUgaW5mbwogICAgICAgIC8vIGFwcGxpZXMgdG8KICAgICAgICBM\naXN0IGdpdmVuID0gZ2V0Q29sdW1ucygpOwogICAgICAgIGJvb2xlYW4gZmls\nbCA9ICgoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpKS4KICAgICAgICAgICAgZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVs\ndE1pc3NpbmdJbmZvKCk7CiAgICAgICAgaWYgKCghZ2l2ZW4uaXNFbXB0eSgp\nIHx8ICghYWRhcHQgJiYgIWZpbGwpKQogICAgICAgICAgICAmJiBnaXZlbi5z\naXplKCkgIT0gdG1wbGF0ZXMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1udW0t\nY29scyIsCiAgICAgICAgICAgICAgICBjb250ZXh0LCBTdHJpbmcudmFsdWVP\nZih0bXBsYXRlcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgU3RyaW5nLnZh\nbHVlT2YoZ2l2ZW4uc2l6ZSgpKSkpOwoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gbmV3IENvbHVtblt0bXBsYXRlcy5sZW5ndGhdOwogICAgICAgIF9pbyA9\nIG51bGw7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGNvbCA9IChnaXZlbi5pc0VtcHR5KCkpID8gbnVsbCA6IChDb2x1bW4pIGdp\ndmVuLmdldChpKTsKICAgICAgICAgICAgY29sc1tpXSA9IG1lcmdlQ29sdW1u\nKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZXNbaV0sIHRydWUsIGNvbCwKICAg\nICAgICAgICAgICAgIHRhYmxlLCBhZGFwdCwgZmlsbCk7CiAgICAgICAgICAg\nIHNldElPRnJvbUNvbHVtbkZsYWdzKGNvbCwgaSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjb2xzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBwcm9wZXIgaW50ZXJuYWwgY29sdW1uIEkvTyBtZXRhZGF0YSBmb3IgdGhl\nIGdpdmVuIGNvbHVtbidzIGZsYWdzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgc2V0SU9Gcm9tQ29sdW1uRmxhZ3MoQ29sdW1uIGNvbCwgaW50IGkpIHsK\nICAgICAgICBpZiAoY29sID09IG51bGwgfHwgKCFjb2wuZ2V0RmxhZyhDb2x1\nbW4uRkxBR19VTklOU0VSVEFCTEUpCiAgICAgICAgICAgICYmICFjb2wuZ2V0\nRmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGlmIChfaW8gPT0gbnVsbCkKICAgICAgICAgICAg\nX2lvID0gbmV3IENvbHVtbklPKCk7CiAgICAgICAgX2lvLnNldEluc2VydGFi\nbGUoaSwgIWNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkp\nOwogICAgICAgIF9pby5zZXRVcGRhdGFibGUoaSwgIWNvbC5nZXRGbGFnKENv\nbHVtbi5GTEFHX1VOVVBEQVRBQkxFKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGUgZ2l2ZW4gdGFibGUgaXMgbm9uLW51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYXNzZXJ0VGFibGUoTWV0\nYURhdGFDb250ZXh0IGNvbnRleHQsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\naWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5tYXBwZWQiLCBjb250ZXh0KSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNZXJnZSB0aGUgZ2l2ZW4gY29sdW1u\ncyBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0\naGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGNvbHVtbnMgZm9yCiAgICAg\nKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBw\ncmVmaXgKICAgICAqIEBwYXJhbSB0bXBsYXRlIHRlbXBsYXRlIGZvciBleHBl\nY3RlZCBjb2x1bW4gaW5mb3JtYXRpb24KICAgICAqIEBwYXJhbSBjb21wYXQg\nd2hldGhlciB0aGUgZXhpc3RpbmcgY29sdW1uIHR5cGUgbXVzdCBiZSBjb21w\nYXRpYmxlCiAgICAgKiB3aXRoIHRoZSB0eXBlIG9mIHRoZSB0ZW1wbGF0ZSBj\nb2x1bW4KICAgICAqIEBwYXJhbSBnaXZlbiB0aGUgZ2l2ZW4gY29sdW1uIGlu\nZm9ybWF0aW9uIGZyb20gbWFwcGluZyBpbmZvCiAgICAgKiBAcGFyYW0gdGFi\nbGUgdGhlIHRhYmxlIGZvciB0aGUgY29sdW1ucwogICAgICogQHBhcmFtIGFk\nYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGlu\nZyBvciBzY2hlbWEKICAgICAqIEBwYXJhbSBmaWxsIHdoZXRoZXIgdG8gZGVm\nYXVsdCBtaXNzaW5nIGNvbHVtbiBpbmZvcm1hdGlvbgogICAgICovCiAgICBw\ncm90ZWN0ZWQgc3RhdGljIENvbHVtbiBtZXJnZUNvbHVtbihNZXRhRGF0YUNv\nbnRleHQgY29udGV4dCwgU3RyaW5nIHByZWZpeCwKICAgICAgICBDb2x1bW4g\ndG1wbGF0ZSwgYm9vbGVhbiBjb21wYXQsIENvbHVtbiBnaXZlbiwgVGFibGUg\ndGFibGUsCiAgICAgICAgYm9vbGVhbiBhZGFwdCwgYm9vbGVhbiBmaWxsKSB7\nCiAgICAgICAgYXNzZXJ0VGFibGUoY29udGV4dCwgdGFibGUpOwoKICAgICAg\nICAvLyBpZiBub3QgYWRhcHRpbmcgbXVzdCBwcm92aWRlIGNvbHVtbiBuYW1l\nIGF0IGEgbWluaW11bQogICAgICAgIFN0cmluZyBjb2xOYW1lID0gKGdpdmVu\nID09IG51bGwpID8gbnVsbCA6IGdpdmVuLmdldE5hbWUoKTsKICAgICAgICBp\nZiAoY29sTmFtZSA9PSBudWxsICYmICFhZGFwdCAmJiAhZmlsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHBy\nZWZpeCArICItbm8tY29sLW5hbWUiLAogICAgICAgICAgICAgICAgY29udGV4\ndCkpOwoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGNvbHVtbiBuYW1lIGJh\nc2VkIG9uIGdpdmVuIGluZm8sIG9yIHRlbXBsYXRlIGlmIG5vbmU7CiAgICAg\nICAgLy8gYWxzbyBtYWtlIHN1cmUgdGhhdCBpZiB0aGUgdXNlciBnYXZlIGEg\nY29sdW1uIG5hbWUsIGhlIGRpZG4ndCB0cnkKICAgICAgICAvLyB0byBwdXQg\ndGhlIGNvbHVtbiBpbiBhbiB1bmV4cGVjdGVkIHRhYmxlCiAgICAgICAgaWYg\nKGNvbE5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgY29sTmFtZSA9IHRtcGxh\ndGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBkb3RJZHggPSBjb2xOYW1lLmxh\nc3RJbmRleE9mKCcuJyk7CiAgICAgICAgaWYgKGRvdElkeCA9PSAwKQogICAg\nICAgICAgICBjb2xOYW1lID0gY29sTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgZWxzZSBpZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgIGZpbmRU\nYWJsZShjb250ZXh0LCBjb2xOYW1lLnN1YnN0cmluZygwLCBkb3RJZHgpLCB0\nYWJsZSwKICAgICAgICAgICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAg\nICBjb2xOYW1lID0gY29sTmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBmaW5kIGV4aXN0aW5nIGNvbHVtbgogICAg\nICAgIENvbHVtbiBjb2wgPSB0YWJsZS5nZXRDb2x1bW4oY29sTmFtZSk7CiAg\nICAgICAgaWYgKGNvbCA9PSBudWxsICYmICFhZGFwdCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCAr\nICItYmFkLWNvbC1uYW1lIiwKICAgICAgICAgICAgICAgIGNvbnRleHQsIGNv\nbE5hbWUsIHRhYmxlKSk7CgogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJl\ncG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBjb250ZXh0LmdldFJlcG9zaXRv\ncnkoKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IHJlcG9zLmdldERC\nRGljdGlvbmFyeSgpOwoKICAgICAgICAvLyB1c2UgaW5mb3JtYXRpb24gZnJv\nbSB0ZW1wbGF0ZSBjb2x1bW4gYnkgZGVmYXVsdCwgYWxsb3dpbmcgYW55CiAg\nICAgICAgLy8gdXNlci1naXZlbiBzcGVjaWZpY3MgdG8gb3ZlcnJpZGUgaXQK\nICAgICAgICBpbnQgdHlwZSA9IHRtcGxhdGUuZ2V0VHlwZSgpOwogICAgICAg\nIGludCBzaXplID0gdG1wbGF0ZS5nZXRTaXplKCk7CiAgICAgICAgaWYgKHR5\ncGUgPT0gVHlwZXMuT1RIRVIpCiAgICAgICAgICAgIHR5cGUgPSBkaWN0Lmdl\ndEpEQkNUeXBlKHRtcGxhdGUuZ2V0SmF2YVR5cGUoKSwgc2l6ZSA9PSAtMSk7\nCiAgICAgICAgYm9vbGVhbiB0dHlwZSA9IHRydWU7CiAgICAgICAgaW50IG90\neXBlID0gdHlwZTsKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0bXBsYXRl\nLmdldFR5cGVOYW1lKCk7CiAgICAgICAgQm9vbGVhbiBub3ROdWxsID0gbnVs\nbDsKICAgICAgICBpZiAodG1wbGF0ZS5pc05vdE51bGxFeHBsaWNpdCgpKQog\nICAgICAgICAgICBub3ROdWxsID0gKHRtcGxhdGUuaXNOb3ROdWxsKCkpID8g\nQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBpbnQgZGVj\naW1hbHMgPSB0bXBsYXRlLmdldERlY2ltYWxEaWdpdHMoKTsKICAgICAgICBT\ndHJpbmcgZGVmU3RyID0gdG1wbGF0ZS5nZXREZWZhdWx0U3RyaW5nKCk7CiAg\nICAgICAgYm9vbGVhbiBhdXRvQXNzaWduID0gdG1wbGF0ZS5pc0F1dG9Bc3Np\nZ25lZCgpOwogICAgICAgIGJvb2xlYW4gcmVsYXRpb25JZCA9IHRtcGxhdGUu\naXNSZWxhdGlvbklkKCk7CiAgICAgICAgU3RyaW5nIHRhcmdldEZpZWxkID0g\ndG1wbGF0ZS5nZXRUYXJnZXRGaWVsZCgpOwogICAgICAgIGlmIChnaXZlbiAh\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHVzZSBnaXZlbiB0eXBlIGlmIHBy\nb3ZpZGVkLCBidXQgd2FybiBpZiBpdCBpc24ndCBjb21wYXRpYmxlIHdpdGgK\nICAgICAgICAgICAgLy8gdGhlIGV4cGVjdGVkIGNvbHVtbiB0eXBlCiAgICAg\nICAgICAgIGlmIChnaXZlbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsK\nICAgICAgICAgICAgICAgIHR0eXBlID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICBpZiAoY29tcGF0ICYmICFnaXZlbi5pc0NvbXBhdGlibGUodHlwZSwgdHlw\nZU5hbWUsIHNpemUsIAogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzKSkg\newogICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2co\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQo\ncHJlZml4ICsgIi1pbmNvbXBhdC1jb2wiLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGV4dCwgY29sTmFtZSwgU2NoZW1hcy5nZXRKREJDTmFt\nZSh0eXBlKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nb3R5cGUgPSBnaXZlbi5nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICB0eXBl\nID0gZGljdC5nZXRQcmVmZXJyZWRUeXBlKG90eXBlKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB0eXBlTmFtZSA9IGdpdmVuLmdldFR5cGVOYW1lKCk7\nCiAgICAgICAgICAgIHNpemUgPSBnaXZlbi5nZXRTaXplKCk7CiAgICAgICAg\nICAgIGRlY2ltYWxzID0gZ2l2ZW4uZ2V0RGVjaW1hbERpZ2l0cygpOwoKICAg\nICAgICAgICAgLy8gbGVhdmUgdGhpcyBpbmZvIGFzIHRoZSB0ZW1wbGF0ZSBk\nZWZhdWx0cyB1bmxlc3MgdGhlIHVzZXIKICAgICAgICAgICAgLy8gZXhwbGlj\naXRseSB0dXJucyBpdCBvbiBpbiB0aGUgZ2l2ZW4gY29sdW1uCiAgICAgICAg\nICAgIGlmIChnaXZlbi5pc05vdE51bGxFeHBsaWNpdCgpKQogICAgICAgICAg\nICAgICAgbm90TnVsbCA9IChnaXZlbi5pc05vdE51bGwoKSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBpZiAoZ2l2ZW4u\nZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICBk\nZWZTdHIgPSBnaXZlbi5nZXREZWZhdWx0U3RyaW5nKCk7CiAgICAgICAgICAg\nIGlmIChnaXZlbi5pc0F1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAg\nYXV0b0Fzc2lnbiA9IHRydWU7CiAgICAgICAgICAgIGlmIChnaXZlbi5pc1Jl\nbGF0aW9uSWQoKSkKICAgICAgICAgICAgICAgIHJlbGF0aW9uSWQgPSB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdCBjaGFyIGNvbHVtbiBz\naXplIGlmIG9yaWdpbmFsIHR5cGUgaXMgY2hhciAodGVzdCBvcmlnaW5hbAog\nICAgICAgIC8vIHR5cGUgcmF0aGVyIHRoYW4gZmluYWwgdHlwZSBiZWNhdXNl\nIG9yaWcgbWlnaHQgYmUgY2xvYiwgdHJhbnNsYXRlZAogICAgICAgIC8vIHRv\nIGFuIHVuc2l6ZWQgdmFyY2hhciwgd2hpY2ggaXMgc3VwcG9ydGVkIGJ5IHNv\nbWUgZGJzKQogICAgICAgIGlmIChzaXplID09IDAgJiYgKG90eXBlID09IFR5\ncGVzLlZBUkNIQVIgfHwgb3R5cGUgPT0gVHlwZXMuQ0hBUikpCiAgICAgICAg\nICAgIHNpemUgPSBkaWN0LmNoYXJhY3RlckNvbHVtblNpemU7CgogICAgICAg\nIC8vIGNyZWF0ZSBjb2x1bW4sIG9yIG1ha2Ugc3VyZSBleGlzdGluZyBjb2x1\nbW4gbWF0Y2hlcyBleHBlY3RlZCB0eXBlCiAgICAgICAgaWYgKGNvbCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGNvbCA9IHRhYmxlLmFkZENvbHVtbihjb2xO\nYW1lKTsKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7CiAgICAgICAg\nfSBlbHNlIGlmICgoY29tcGF0IHx8ICF0dHlwZSkgJiYgIWNvbC5pc0NvbXBh\ndGlibGUodHlwZSwgdHlwZU5hbWUsIAogICAgICAgICAgICBzaXplLCBkZWNp\nbWFscykpIHsKICAgICAgICAgICAgLy8gaWYgZXhpc3RpbmcgY29sdW1uIGlz\nbid0IGNvbXBhdGlibGUgd2l0aCBkZXNpcmVkIHR5cGUsIGRpZSBpZgogICAg\nICAgICAgICAvLyBjYW4ndCBhZGFwdCwgZWxzZSB3YXJuIGFuZCBjaGFuZ2Ug\ndGhlIGV4aXN0aW5nIGNvbHVtbiB0eXBlCiAgICAgICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQocHJlZml4ICsgIi1iYWQtY29sIiwgY29udGV4dCwK\nICAgICAgICAgICAgICAgIFNjaGVtYXMuZ2V0SkRCQ05hbWUodHlwZSksIGNv\nbC5nZXREZXNjcmlwdGlvbigpKTsKICAgICAgICAgICAgaWYgKCFhZGFwdCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbiht\nc2cpOwogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAg\nICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgbG9nLndhcm4obXNnKTsKCiAgICAgICAgICAgIGNvbC5zZXRUeXBl\nKHR5cGUpOwogICAgICAgIH0gZWxzZSBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiBn\naXZlbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsKICAgICAgICAgICAg\nLy8gYXMgbG9uZyBhcyB0eXBlcyBhcmUgY29tcGF0aWJsZSwgc2V0IGNvbHVt\nbiB0byBleHBlY3RlZCB0eXBlCiAgICAgICAgICAgIGNvbC5zZXRUeXBlKHR5\ncGUpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWx3YXlzIHNldCB0aGUgamF2\nYSB0eXBlIGFuZCBhdXRvYXNzaWduIHRvIGV4cGVjdGVkIHZhbHVlcywgZXZl\nbiBvbgogICAgICAgIC8vIGFuIGV4aXN0aW5nIGNvbHVtbiwgc2luY2Ugd2Ug\nZG9uJ3QgZ2V0IHRoaXMgZnJvbSB0aGUgREIKICAgICAgICBpZiAoY29tcGF0\nKQogICAgICAgICAgICBjb2wuc2V0SmF2YVR5cGUodG1wbGF0ZS5nZXRKYXZh\nVHlwZSgpKTsKICAgICAgICBlbHNlIGlmIChjb2wuZ2V0SmF2YVR5cGUoKSA9\nPSBKYXZhVHlwZXMuT0JKRUNUKSB7CiAgICAgICAgICAgIGlmIChnaXZlbiAh\nPSBudWxsICYmIGdpdmVuLmdldEphdmFUeXBlKCkgIT0gSmF2YVR5cGVzLk9C\nSkVDVCkKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShnaXZlbi5n\nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgY29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZQogICAg\nICAgICAgICAgICAgICAgIChTY2hlbWFzLmdldEphdmFUeXBlKGNvbC5nZXRU\neXBlKCksIGNvbC5nZXRTaXplKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpKSk7CiAgICAgICAgfQogICAgICAg\nIGNvbC5zZXRBdXRvQXNzaWduZWQoYXV0b0Fzc2lnbik7CiAgICAgICAgY29s\nLnNldFJlbGF0aW9uSWQocmVsYXRpb25JZCk7CiAgICAgICAgY29sLnNldFRh\ncmdldEZpZWxkKHRhcmdldEZpZWxkKTsKCiAgICAgICAgLy8gd2UgbmVlZCB0\naGlzIGZvciBydW50aW1lLCBhbmQgdGhlIGR5bmFtaWMgc2NoZW1hIGZhY3Rv\ncnkgbWlnaHQKICAgICAgICAvLyBub3Qga25vdyBpdCwgc28gc2V0IGl0IGV2\nZW4gaWYgbm90IGFkYXB0aW5nCiAgICAgICAgaWYgKGRlZlN0ciAhPSBudWxs\nKQogICAgICAgICAgICBjb2wuc2V0RGVmYXVsdFN0cmluZyhkZWZTdHIpOwog\nICAgICAgIGlmIChub3ROdWxsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5z\nZXROb3ROdWxsKG5vdE51bGwuYm9vbGVhblZhbHVlKCkpOwoKICAgICAgICAv\nLyBhZGQgb3RoZXIgZGV0YWlscyBpZiBhZGFwdGluZwogICAgICAgIGlmIChh\nZGFwdCkgewogICAgICAgICAgICBpZiAodHlwZU5hbWUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZSh0eXBlTmFtZSk7CiAgICAg\nICAgICAgIGlmIChzaXplICE9IDApCiAgICAgICAgICAgICAgICBjb2wuc2V0\nU2l6ZShzaXplKTsKICAgICAgICAgICAgaWYgKGRlY2ltYWxzICE9IDApCiAg\nICAgICAgICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0cyhkZWNpbWFscyk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGaW5kIHRoZSB0YWJsZSBuYW1lZCBieSBhIGNvbHVtbiBvciB0\nYXJnZXQuCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgY29udGV4dCBm\nb3IgZXJyb3IgbWVzc2FnZXMsIGV0Yy4KICAgICAqIEBwYXJhbSBuYW1lIHRo\nZSB0YWJsZSBuYW1lLCBwb3NzaWJseSBpbmNsdWRpbmcgc2NoZW1hCiAgICAg\nKiBAcGFyYW0gZXhwZWN0ZWQgdGhlIGV4cGVjdGVkIHRhYmxlOyBtYXkgYmUg\nbnVsbAogICAgICogQHBhcmFtIGludmVyc2UgdGhlIHBvc3NpYmxlIGludmVy\nc2UgdGFibGU7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0gcmVsIGlmIHdl\nJ3JlIGZpbmRpbmcgdGhlIHRhcmdldCB0YWJsZSBvZiBhIGpvaW4sIHRoZQog\nICAgICogam9pbmVkLXRvIHR5cGU7IGFsbG93cyB1cyB0byBhbHNvIGxvb2sg\naW4gaXRzIHN1cGVyY2xhc3MgdGFibGVzCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIFRhYmxlIGZpbmRUYWJsZShNZXRhRGF0YUNvbnRleHQgY29udGV4\ndCwgU3RyaW5nIG5hbWUsCiAgICAgICAgVGFibGUgZXhwZWN0ZWQsIFRhYmxl\nIGludmVyc2UsIENsYXNzTWFwcGluZyByZWwpIHsKICAgICAgICAvLyBpcyB0\naGlzIHRoZSBleHBlY3RlZCB0YWJsZT8KICAgICAgICBpZiAoZXhwZWN0ZWQg\nPT0gbnVsbCAmJiByZWwgIT0gbnVsbCkKICAgICAgICAgICAgZXhwZWN0ZWQg\nPSByZWwuZ2V0VGFibGUoKTsKICAgICAgICBpZiAoZXhwZWN0ZWQgIT0gbnVs\nbCAmJiBpc1RhYmxlTmFtZShuYW1lLCBleHBlY3RlZCkpCiAgICAgICAgICAg\nIHJldHVybiBleHBlY3RlZDsKCiAgICAgICAgLy8gY2hlY2sgZm9yIGludmVy\nc2UKICAgICAgICBpZiAoaW52ZXJzZSAhPSBudWxsICYmIGlzVGFibGVOYW1l\nKG5hbWUsIGludmVyc2UpKQogICAgICAgICAgICByZXR1cm4gaW52ZXJzZTsK\nCiAgICAgICAgLy8gc3VwZXJjbGFzcyB0YWJsZT8KICAgICAgICBpZiAocmVs\nICE9IG51bGwpCiAgICAgICAgICAgIHJlbCA9IHJlbC5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICB3aGlsZSAocmVsICE9IG51\nbGwpIHsKICAgICAgICAgICAgaWYgKGlzVGFibGVOYW1lKG5hbWUsIHJlbC5n\nZXRUYWJsZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiByZWwuZ2V0VGFi\nbGUoKTsKICAgICAgICAgICAgcmVsID0gcmVsLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpOwogICAgICAgIH0KCiAgICAgICAgLy8gbm9uZSBv\nZiB0aGUgcG9zc2libGUgdGFibGVzCiAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJjb2wtd3JvbmctdGFibGUiLCBjb250\nZXh0LAogICAgICAgICAgICBleHBlY3RlZCwgbmFtZSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIG5hbWUgbWF0\nY2hlcyB0aGUgZ2l2ZW4gdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGJvb2xlYW4gaXNUYWJsZU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgcmV0dXJuIG5hbWUuZXF1YWxzSWdub3JlQ2FzZSh0\nYWJsZS5nZXROYW1lKCkpCiAgICAgICAgICAgIHx8IG5hbWUuZXF1YWxzSWdu\nb3JlQ2FzZSh0YWJsZS5nZXRGdWxsTmFtZSgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHJpZXZlL2NyZWF0ZSBhbiBpbmRleCBvbiB0aGUgZ2l2ZW4g\nY29sdW1ucyBieSBtZXJnaW5nIHRoZSBnaXZlbgogICAgICogdGVtcGxhdGUg\naW5mb3JtYXRpb24gd2l0aCBhbnkgdXNlci1wcm92aWRlZCBpbmZvcm1hdGlv\nbi4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0aGUgbWFwcGluZyB3\nZSdyZSByZXRyaWV2aW5nIGFuIGluZGV4IGZvcgogICAgICogQHBhcmFtIHBy\nZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVzc2FnZSBrZXkgcHJlZml4CiAgICAg\nKiBAcGFyYW0gdG1wbGF0ZSB0ZW1wbGF0ZSBmb3IgZXhwZWN0ZWQgaW5kZXgg\naW5mb3JtYXRpb24KICAgICAqIEBwYXJhbSBjb2xzIHRoZSBpbmRleGVkIGNv\nbHVtbnMKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2Rp\nZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBJbmRleCBjcmVhdGVJbmRleChNZXRhRGF0YUNvbnRleHQg\nY29udGV4dCwgU3RyaW5nIHByZWZpeCwKICAgICAgICBJbmRleCB0bXBsYXRl\nLCBDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYg\nKHByZWZpeCA9PSBudWxsKQogICAgICAgICAgICBwcmVmaXggPSAiZ2VuZXJp\nYyI7CgogICAgICAgIC8vIGNhbid0IGNyZWF0ZSBhbiBpbmRleCBpZiB0aGVy\nZSBhcmUgbm8gY29scwogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29s\ncy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBpZiAoX2lkeCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1uby1p\nbmRleC1jb2xzIiwgY29udGV4dCkpOwogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIC8vIGxvb2sgZm9yIGFuIGV4aXN0aW5n\nIGluZGV4IG9uIHRoZXNlIGNvbHVtbnMKICAgICAgICBUYWJsZSB0YWJsZSA9\nIGNvbHNbMF0uZ2V0VGFibGUoKTsKICAgICAgICBJbmRleFtdIGlkeHMgPSB0\nYWJsZS5nZXRJbmRleGVzKCk7CiAgICAgICAgSW5kZXggZXhpc3QgPSBudWxs\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWR4cy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoaWR4c1tpXS5jb2x1bW5zTWF0Y2goY29s\ncykpIHsKICAgICAgICAgICAgICAgIGV4aXN0ID0gaWR4c1tpXTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyByZW1vdmUgZXhpc3RpbmcgaW5kZXg/CiAgICAgICAgaWYgKCFf\nY2FuSWR4KSB7CiAgICAgICAgICAgIGlmIChleGlzdCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmICghYWRh\ncHQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQocHJlZml4ICsgIi1pbmRleC1leGlzdHMiLAogICAgICAg\nICAgICAgICAgICAgIGNvbnRleHQpKTsKICAgICAgICAgICAgdGFibGUucmVt\nb3ZlSW5kZXgoZXhpc3QpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHdlIGhhdmUgYW4gZXhpc3RpbmcgaW5k\nZXgsIG1lcmdlIGdpdmVuIGluZm8gaW50byBpdAogICAgICAgIGlmIChleGlz\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfaWR4ICE9IG51bGwgJiYg\nX2lkeC5pc1VuaXF1ZSgpICYmICFleGlzdC5pc1VuaXF1ZSgpKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIWFkYXB0KQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiLWluZGV4LW5vdC11bmlxdWUiLCBj\nb250ZXh0KSk7CiAgICAgICAgICAgICAgICBleGlzdC5zZXRVbmlxdWUodHJ1\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGV4aXN0Owog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm8gZGVmYXVsdHMgcmV0dXJuIG51\nbGwKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5n\nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAg\nYm9vbGVhbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVm\nYXVsdE1pc3NpbmdJbmZvKCk7CiAgICAgICAgaWYgKF9pZHggPT0gbnVsbCAm\nJiAodG1wbGF0ZSA9PSBudWxsIHx8ICghYWRhcHQgJiYgIWZpbGwpKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFN0cmluZyBuYW1lID0g\nbnVsbDsKICAgICAgICBib29sZWFuIHVucTsKICAgICAgICBpZiAoX2lkeCAh\nPSBudWxsKSB7CiAgICAgICAgICAgIG5hbWUgPSBfaWR4LmdldE5hbWUoKTsK\nICAgICAgICAgICAgdW5xID0gX2lkeC5pc1VuaXF1ZSgpOwogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICB1bnEgPSB0bXBsYXRlLmlzVW5pcXVlKCk7Cgog\nICAgICAgIC8vIGlmIG5vIG5hbWUgcHJvdmlkZWQgYnkgdXNlciBpbmZvLCBt\nYWtlIG9uZQogICAgICAgIGlmIChuYW1lID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKHRtcGxhdGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG5hbWUg\nPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBuYW1lID0gY29sc1swXS5nZXROYW1lKCk7CiAgICAgICAg\nICAgICAgICBuYW1lID0gcmVwb3MuZ2V0REJEaWN0aW9uYXJ5KCkuZ2V0VmFs\naWRJbmRleE5hbWUobmFtZSwgdGFibGUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBJbmRleCBpZHggPSB0YWJsZS5hZGRJbmRleChuYW1l\nKTsKICAgICAgICBpZHguc2V0VW5pcXVlKHVucSk7CiAgICAgICAgaWR4LnNl\ndENvbHVtbnMoY29scyk7CiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHJpZXZlL2NyZWF0ZSBhIHVuaXF1ZSBjb25zdHJh\naW50IG9uIHRoZSBnaXZlbiBjb2x1bW5zIGJ5IG1lcmdpbmcgdGhlCiAgICAg\nKiBnaXZlbiB0ZW1wbGF0ZSBpbmZvcm1hdGlvbiB3aXRoIGFueSB1c2VyLXBy\nb3ZpZGVkIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBjb250\nZXh0IHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZpbmcgYSBjb25zdHJhaW50\nIGZvcgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVz\nc2FnZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gdG1wbGF0ZSB0ZW1wbGF0\nZSBmb3IgZXhwZWN0ZWQgdW5pcXVlIGluZm9ybWF0aW9uCiAgICAgKiBAcGFy\nYW0gY29scyB0aGUgY29uc3RyYWludCBjb2x1bW5zCiAgICAgKiBAcGFyYW0g\nYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBw\naW5nIG9yIHNjaGVtYQogICAgICovCiAgICBwcm90ZWN0ZWQgVW5pcXVlIGNy\nZWF0ZVVuaXF1ZShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgU3RyaW5nIHBy\nZWZpeCwKICAgICAgICBVbmlxdWUgdG1wbGF0ZSwgQ29sdW1uW10gY29scywg\nYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChwcmVmaXggPT0gbnVsbCkK\nICAgICAgICAgICAgcHJlZml4ID0gImdlbmVyaWMiOwoKICAgICAgICAvLyBj\nYW4ndCBjcmVhdGUgYSBjb25zdHJhaW50IGlmIHRoZXJlIGFyZSBubyBjb2xz\nCiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAw\nKSB7CiAgICAgICAgICAgIGlmIChfdW5xICE9IG51bGwgfHwgdG1wbGF0ZSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsg\nIi1uby11bmlxdWUtY29scyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBsb29rIGZvciBhbiBl\neGlzdGluZyBjb25zdHJhaW50IG9uIHRoZXNlIGNvbHVtbnMKICAgICAgICBU\nYWJsZSB0YWJsZSA9IGNvbHNbMF0uZ2V0VGFibGUoKTsKICAgICAgICBVbmlx\ndWVbXSB1bnFzID0gdGFibGUuZ2V0VW5pcXVlcygpOwogICAgICAgIFVuaXF1\nZSBleGlzdCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1\nbnFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh1bnFzW2ldLmNv\nbHVtbnNNYXRjaChjb2xzKSkgewogICAgICAgICAgICAgICAgZXhpc3QgPSB1\nbnFzW2ldOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSBleGlzdGluZyB1bmlxdWU/\nCiAgICAgICAgaWYgKCFfY2FuVW5xKSB7CiAgICAgICAgICAgIGlmIChleGlz\ndCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgICAgIGlmICghYWRhcHQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAg\nICAgICAgICAgKyAiLXVuaXF1ZS1leGlzdHMiLCBjb250ZXh0KSk7CiAgICAg\nICAgICAgIHRhYmxlLnJlbW92ZVVuaXF1ZShleGlzdCk7CiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGVmYXVs\ndHM7IHJldHVybiBleGlzdGluZyBjb25zdHJhaW50IChpZiBhbnkpCiAgICAg\nICAgaWYgKHRtcGxhdGUgPT0gbnVsbCAmJiBfdW5xID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBleGlzdDsKCiAgICAgICAgTWFwcGluZ1JlcG9zaXRv\ncnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVw\nb3NpdG9yeSgpOwogICAgICAgIGlmIChleGlzdCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChfdW5xICE9IG51bGwgJiYgX3VucS5pc0RlZmVycmVkKCkg\nJiYgIWV4aXN0LmlzRGVmZXJyZWQoKSkgewogICAgICAgICAgICAgICAgTG9n\nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAgICAgICAgaWYgKGxv\nZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLndh\ncm4oX2xvYy5nZXQocHJlZml4ICsgIi1kZWZlci11bmlxdWUiLCBjb250ZXh0\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGV4aXN0Owog\nICAgICAgIH0KCiAgICAgICAgLy8gZGljdCBjYW4ndCBoYW5kbGUgdW5pcXVl\nIGNvbnN0cmFpbnRzPwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gcmVw\nb3MuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAgaWYgKF91bnEgIT0gbnVs\nbCAmJiAhZGljdC5zdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzKSB7CiAgICAg\nICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAg\naWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cu\nd2FybihfbG9jLmdldChwcmVmaXggKyAiLXVuaXF1ZS1zdXBwb3J0IiwgY29u\ndGV4dCkpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIGJvb2xlYW4gZmlsbCA9IHJlcG9zLmdldE1hcHBpbmdEZWZhdWx0\ncygpLmRlZmF1bHRNaXNzaW5nSW5mbygpOwogICAgICAgIGlmICghYWRhcHQg\nJiYgIWZpbGwgJiYgX3VucSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgYm9vbGVhbiBk\nZWZlcnJlZDsKICAgICAgICBpZiAoX3VucSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIG5hbWUgPSBfdW5xLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVmZXJy\nZWQgPSBfdW5xLmlzRGVmZXJyZWQoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBuYW1lID0gdG1wbGF0ZS5nZXROYW1lKCk7CiAgICAgICAgICAg\nIGRlZmVycmVkID0gdG1wbGF0ZS5pc0RlZmVycmVkKCk7CiAgICAgICAgfQoK\nICAgICAgICBpZiAoZGVmZXJyZWQgJiYgIWRpY3Quc3VwcG9ydHNEZWZlcnJl\nZENvbnN0cmFpbnRzKSB7CiAgICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5n\nZXRMb2coKTsKICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldChwcmVmaXggKyAi\nLWNyZWF0ZS1kZWZlci11bmlxdWUiLAogICAgICAgICAgICAgICAgICAgIGNv\nbnRleHQsIGRpY3QucGxhdGZvcm0pKTsKICAgICAgICAgICAgZGVmZXJyZWQg\nPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIFVuaXF1ZSB1bnEgPSB0YWJs\nZS5hZGRVbmlxdWUobmFtZSk7CiAgICAgICAgdW5xLnNldERlZmVycmVkKGRl\nZmVycmVkKTsKICAgICAgICB1bnEuc2V0Q29sdW1ucyhjb2xzKTsKICAgICAg\nICByZXR1cm4gdW5xOwogICAgfQoKICAgIC8qKgogICAgICogUmV0cmlldmUv\nY3JlYXRlIGEgZm9yZWlnbiBrZXkgKHBvc3NpYmx5IGxvZ2ljYWwpIG9uIHRo\nZSBnaXZlbiBjb2x1bW5zCiAgICAgKiBieSBtZXJnaW5nIHRoZSBnaXZlbiB0\nZW1wbGF0ZSBpbmZvcm1hdGlvbiB3aXRoIGFueSB1c2VyLXByb3ZpZGVkCiAg\nICAgKiBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4\ndCB0aGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGEga2V5IGZvcgogICAg\nICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVzc2FnZSBrZXkg\ncHJlZml4CiAgICAgKiBAcGFyYW0gZ2l2ZW4gdGhlIGNvbHVtbnMgZ2l2ZW4g\nYnkgdGhlIHVzZXIKICAgICAqIEBwYXJhbSBkZWYgZGVmYXVsdHMgcHJvdmlk\nZXIKICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUgZm9yIHRoZSBrZXkK\nICAgICAqIEBwYXJhbSBjbHMgdHlwZSB3ZSdyZSBqb2luaW5nIGZyb20KICAg\nICAqIEBwYXJhbSByZWwgdGFyZ2V0IHR5cGUgd2UncmUgam9pbmluZyB0bwog\nICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciB0aGUgZm9yZWlnbiBr\nZXkgY2FuIGJlIGludmVyc2VkCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhl\nciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVt\nYQogICAgICovCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktleSBjcmVhdGVGb3Jl\naWduS2V5KE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LAogICAgICAgIFN0cmlu\nZyBwcmVmaXgsIExpc3QgZ2l2ZW4sIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYs\nIFRhYmxlIHRhYmxlLAogICAgICAgIENsYXNzTWFwcGluZyBjbHMsIENsYXNz\nTWFwcGluZyByZWwsIGJvb2xlYW4gaW52ZXJzYWJsZSwgYm9vbGVhbiBhZGFw\ndCkgewogICAgICAgIGFzc2VydFRhYmxlKGNvbnRleHQsIHRhYmxlKTsKICAg\nICAgICBpZiAocHJlZml4ID09IG51bGwpCiAgICAgICAgICAgIHByZWZpeCA9\nICJnZW5lcmljIjsKCiAgICAgICAgLy8gY29sbGVjdCB0aGUgZm9yZWlnbiBr\nZXkgY29sdW1ucyBhbmQgdGhlaXIgdGFyZ2V0cwogICAgICAgIE9iamVjdFtd\nW10gam9pbnMgPSBjcmVhdGVKb2lucyhjb250ZXh0LCBwcmVmaXgsIHRhYmxl\nLCBjbHMsIHJlbCwKICAgICAgICAgICAgZ2l2ZW4sIGRlZiwgaW52ZXJzYWJs\nZSwgYWRhcHQpOwogICAgICAgIF9qb2luID0gSk9JTl9GT1JXQVJEOwoKICAg\nICAgICAvLyBlc3RhYmxpc2ggbG9jYWwgdGFibGUgdXNpbmcgYW55IGpvaW4g\nYmV0d2VlbiB0d28gY29sdW1uczsgaWYgd2Ugb25seQogICAgICAgIC8vIGZp\nbmQgY29uc3RhbnQgam9pbnMsIHRoZW4ga2VlcCBkZWZhdWx0IGxvY2FsIHRh\nYmxlIChkaXJlY3Rpb25sZXNzKQogICAgICAgIFRhYmxlIGxvY2FsID0gdGFi\nbGU7CiAgICAgICAgVGFibGUgZm9yZWlnbiA9IHJlbC5nZXRUYWJsZSgpOwog\nICAgICAgIFRhYmxlIHRtcDsKICAgICAgICBib29sZWFuIGNvbnN0YW50ID0g\nZmFsc2U7CiAgICAgICAgYm9vbGVhbiBsb2NhbFNldCA9IGZhbHNlOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGpvaW5zW2ldWzFdaW5zdGFuY2VvZiBDb2x1bW4p\nIHsKICAgICAgICAgICAgICAgIHRtcCA9ICgoQ29sdW1uKSBqb2luc1tpXVsw\nXSkuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIGlmICghbG9jYWxTZXQp\nIHsKICAgICAgICAgICAgICAgICAgICBsb2NhbCA9IHRtcDsKICAgICAgICAg\nICAgICAgICAgICBsb2NhbFNldCA9IHRydWU7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgaWYgKHRtcCAhPSBsb2NhbCkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAg\nICAgICAgICAgICAgICAgICAgICAgICsgIi1tdWx0LWZrLXRhYmxlcyIsIGNv\nbnRleHQsIGxvY2FsLCB0bXApKTsKICAgICAgICAgICAgICAgIGZvcmVpZ24g\nPSAoKENvbHVtbikgam9pbnNbaV1bMV0pLmdldFRhYmxlKCk7CgogICAgICAg\nICAgICAgICAgaWYgKGpvaW5zW2ldWzJdID09IEJvb2xlYW4uVFJVRSkKICAg\nICAgICAgICAgICAgICAgICBfam9pbiA9IEpPSU5fSU5WRVJTRTsKICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBjb25zdGFudCA9IHRydWU7\nCiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlzIGlzIG5vdCBhIGNvbnN0\nYW50IGpvaW4sIGxvb2sgZm9yIGV4aXN0aW5nIGZvcmVpZ24ga2V5CiAgICAg\nICAgLy8gb24gbG9jYWwgY29sdW1ucwogICAgICAgIEZvcmVpZ25LZXkgZXhp\nc3QgPSBudWxsOwogICAgICAgIGlmICghY29uc3RhbnQgJiYgbG9jYWwuZ2V0\nRm9yZWlnbktleXMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIENvbHVt\nbltdIGNvbHMgPSBuZXcgQ29sdW1uW2pvaW5zLmxlbmd0aF07CiAgICAgICAg\nICAgIENvbHVtbltdIHBrcyA9IG5ldyBDb2x1bW5bam9pbnMubGVuZ3RoXTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgY29sc1tpXSA9IChDb2x1bW4pIGpv\naW5zW2ldWzBdOwogICAgICAgICAgICAgICAgcGtzW2ldID0gKENvbHVtbikg\nam9pbnNbaV1bMV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZvcmVp\nZ25LZXlbXSBma3MgPSBsb2NhbC5nZXRGb3JlaWduS2V5cygpOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKGZrc1tpXS5nZXRDb25zdGFudENvbHVtbnMo\nKS5sZW5ndGggPT0gMAogICAgICAgICAgICAgICAgICAgICYmIGZrc1tpXS5n\nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID09IDAKICAg\nICAgICAgICAgICAgICAgICAmJiBma3NbaV0uY29sdW1uc01hdGNoKGNvbHMs\nIHBrcykpIHsKICAgICAgICAgICAgICAgICAgICBleGlzdCA9IGZrc1tpXTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTWFwcGluZ1JlcG9z\naXRvcnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0\nUmVwb3NpdG9yeSgpOwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gcmVw\nb3MuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAgaWYgKGV4aXN0ICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gbWFrZSBleGlzdGluZyBrZXkgbG9naWNh\nbD8KICAgICAgICAgICAgaWYgKCFfY2FuRkspIHsKICAgICAgICAgICAgICAg\nIGlmIChleGlzdC5nZXREZWxldGVBY3Rpb24oKSAhPSBleGlzdC5BQ1RJT05f\nTk9ORSAmJiAhYWRhcHQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAg\nICAgICAgICAgICAgICArICItZmstZXhpc3RzIiwgY29udGV4dCkpOwogICAg\nICAgICAgICAgICAgZXhpc3Quc2V0RGVsZXRlQWN0aW9uKGV4aXN0LkFDVElP\nTl9OT05FKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF9mayAh\nPSBudWxsICYmIF9may5pc0RlZmVycmVkKCkgJiYgIWV4aXN0LmlzRGVmZXJy\nZWQoKSkgewogICAgICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExv\nZygpOwogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4\nICsgIi1kZWZlci1mayIsIGNvbnRleHQpKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gYWxsb3cgdXNlci1naXZlbiBpbmZvIHRvIG92ZXJyaWRl\nIGV4aXN0aW5nIGtleSBpZiB3ZSdyZSBhZGFwdGluZzsKICAgICAgICAgICAg\nLy8gdGVtcGxhdGUgaW5mbyBjYW5ub3Qgb3ZlcnJpZGUgZXhpc3Rpbmcga2V5\nCiAgICAgICAgICAgIGlmIChhZGFwdCAmJiBfZmsgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaWYgKF9may5nZXRVcGRhdGVBY3Rpb24oKSAhPSBGb3Jl\naWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICAgICAgICAgIGV4aXN0\nLnNldFVwZGF0ZUFjdGlvbihfZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwogICAg\nICAgICAgICAgICAgaWYgKF9may5nZXREZWxldGVBY3Rpb24oKSAhPSBGb3Jl\naWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICAgICAgICAgIGV4aXN0\nLnNldERlbGV0ZUFjdGlvbihfZmsuZ2V0RGVsZXRlQWN0aW9uKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHNldElPRnJvbUpvaW5zKGV4aXN0LCBq\nb2lucyk7CiAgICAgICAgICAgIHJldHVybiBleGlzdDsKICAgICAgICB9Cgog\nICAgICAgIFN0cmluZyBuYW1lID0gbnVsbDsKICAgICAgICBpbnQgZGVsQWN0\naW9uID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAgICBpbnQgdXBB\nY3Rpb24gPSBGb3JlaWduS2V5LkFDVElPTl9OT05FOwogICAgICAgIGJvb2xl\nYW4gZGVmZXJyZWQgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGZpbGwgPSBy\nZXBvcy5nZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZhdWx0TWlzc2luZ0luZm8o\nKTsKICAgICAgICBGb3JlaWduS2V5IHRtcGxhdGUgPSAoZGVmID09IG51bGwp\nID8gbnVsbAogICAgICAgICAgICA6IGRlZi5nZXQobG9jYWwsIGZvcmVpZ24s\nIF9qb2luID09IEpPSU5fSU5WRVJTRSk7CiAgICAgICAgaWYgKF9mayAhPSBu\ndWxsICYmICh0bXBsYXRlID09IG51bGwgfHwgKCFhZGFwdCAmJiAhZmlsbCkp\nKSB7CiAgICAgICAgICAgIC8vIGlmIG5vdCBhZGFwdGluZyBvciBubyB0ZW1w\nbGF0ZSBpbmZvIHVzZSBnaXZlbiBkYXRhCiAgICAgICAgICAgIG5hbWUgPSBf\nZmsuZ2V0TmFtZSgpOwogICAgICAgICAgICBkZWxBY3Rpb24gPSBfZmsuZ2V0\nRGVsZXRlQWN0aW9uKCk7CiAgICAgICAgICAgIHVwQWN0aW9uID0gX2ZrLmdl\ndFVwZGF0ZUFjdGlvbigpOwogICAgICAgICAgICBkZWZlcnJlZCA9IF9may5p\nc0RlZmVycmVkKCk7CiAgICAgICAgfSBlbHNlIGlmIChfY2FuRksgJiYgKGFk\nYXB0IHx8IGZpbGwpKSB7CiAgICAgICAgICAgIGlmIChfZmsgPT0gbnVsbCAm\nJiB0bXBsYXRlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIG5vIHVz\nZXIgZ2l2ZW4gaW5mbzsgdXNlIHRlbXBsYXRlIGRhdGEKICAgICAgICAgICAg\nICAgIG5hbWUgPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICAgICAgICAg\nIGRlbEFjdGlvbiA9IHRtcGxhdGUuZ2V0RGVsZXRlQWN0aW9uKCk7CiAgICAg\nICAgICAgICAgICB1cEFjdGlvbiA9IHRtcGxhdGUuZ2V0VXBkYXRlQWN0aW9u\nKCk7CiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IHRtcGxhdGUuaXNEZWZl\ncnJlZCgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9mayAhPSBudWxsICYm\nIHRtcGxhdGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gbWVyZ2Ug\ndXNlciBhbmQgdGVtcGxhdGUgZGF0YSwgYWx3YXlzIGxldHRpbmcgdXNlciBp\nbmZvIHdpbgogICAgICAgICAgICAgICAgbmFtZSA9IF9may5nZXROYW1lKCk7\nCiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsICYmIHRtcGxhdGUu\nZ2V0TmFtZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9\nIHRtcGxhdGUuZ2V0TmFtZSgpOwogICAgICAgICAgICAgICAgZGVsQWN0aW9u\nID0gX2ZrLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgICAgICAgICAgaWYg\nKGRlbEFjdGlvbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAg\nICAgICAgICAgICAgIGRlbEFjdGlvbiA9IHRtcGxhdGUuZ2V0RGVsZXRlQWN0\naW9uKCk7CiAgICAgICAgICAgICAgICB1cEFjdGlvbiA9IF9may5nZXRVcGRh\ndGVBY3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmICh1cEFjdGlvbiA9PSBG\nb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICAgICAgICAgIHVw\nQWN0aW9uID0gdG1wbGF0ZS5nZXRVcGRhdGVBY3Rpb24oKTsKICAgICAgICAg\nICAgICAgIGRlZmVycmVkID0gX2ZrLmlzRGVmZXJyZWQoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFkaWN0LnN1cHBvcnRzRGVs\nZXRlQWN0aW9uKGRlbEFjdGlvbikKICAgICAgICAgICAgfHwgIWRpY3Quc3Vw\ncG9ydHNVcGRhdGVBY3Rpb24odXBBY3Rpb24pKSB7CiAgICAgICAgICAgIExv\nZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAgaWYgKGxvZy5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldChwcmVmaXggKyAiLXVuc3VwcG9ydGVkLWZrLWFjdGlvbiIsIGNvbnRl\neHQpKTsKICAgICAgICAgICAgZGVsQWN0aW9uID0gRm9yZWlnbktleS5BQ1RJ\nT05fTk9ORTsKICAgICAgICAgICAgdXBBY3Rpb24gPSBGb3JlaWduS2V5LkFD\nVElPTl9OT05FOwogICAgICAgIH0KICAgICAgICBpZiAoZGVmZXJyZWQgJiYg\nIWRpY3Quc3VwcG9ydHNEZWZlcnJlZENvbnN0cmFpbnRzKSB7CiAgICAgICAg\nICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihfbG9jLmdldChwcmVmaXggKyAiLWNyZWF0ZS1kZWZlci1mayIsCiAgICAg\nICAgICAgICAgICAgICAgY29udGV4dCwgZGljdC5wbGF0Zm9ybSkpOwogICAg\nICAgICAgICBkZWZlcnJlZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAg\nLy8gY3JlYXRlIGZvcmVpZ24ga2V5IHdpdGggbWVyZ2VkIGluZm8KICAgICAg\nICBGb3JlaWduS2V5IGZrID0gbG9jYWwuYWRkRm9yZWlnbktleShuYW1lKTsK\nICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oZGVsQWN0aW9uKTsKICAgICAg\nICBmay5zZXRVcGRhdGVBY3Rpb24odXBBY3Rpb24pOwogICAgICAgIGZrLnNl\ndERlZmVycmVkKGRlZmVycmVkKTsKCiAgICAgICAgLy8gYWRkIGpvaW5zIHRv\nIGtleQogICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2wg\nPSAoQ29sdW1uKSBqb2luc1tpXVswXTsKICAgICAgICAgICAgaWYgKGpvaW5z\nW2ldWzFdaW5zdGFuY2VvZiBDb2x1bW4pCiAgICAgICAgICAgICAgICBmay5q\nb2luKGNvbCwgKENvbHVtbikgam9pbnNbaV1bMV0pOwogICAgICAgICAgICBl\nbHNlIGlmICgoam9pbnNbaV1bMl0gPT0gQm9vbGVhbi5UUlVFKSAhPSAoX2pv\naW4gPT0gSk9JTl9JTlZFUlNFKSkKICAgICAgICAgICAgICAgIGZrLmpvaW5D\nb25zdGFudChqb2luc1tpXVsxXSwgY29sKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgZmsuam9pbkNvbnN0YW50KGNvbCwgam9pbnNbaV1b\nMV0pOwogICAgICAgIH0KICAgICAgICBzZXRJT0Zyb21Kb2lucyhmaywgam9p\nbnMpOwogICAgICAgIHJldHVybiBmazsKICAgIH0KCiAgICAvKioKICAgICAq\nIFVzZSB0aGUgam9pbiBpbmZvcm1hdGlvbiB0byBwb3B1bGF0ZSBvdXIgaW50\nZXJuYWwgY29sdW1uIEkvTyBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgc2V0SU9Gcm9tSm9pbnMoRm9yZWlnbktleSBmaywgT2JqZWN0W11bXSBq\nb2lucykgewogICAgICAgIExpc3QgY29scyA9IGdldENvbHVtbnMoKTsKICAg\nICAgICBfaW8gPSBudWxsOwogICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpbnQgY29uc3RJZHggPSAw\nOwogICAgICAgIGludCBpZHg7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBjb25zdCBj\nb2x1bW5zIGFyZSBpbmRleGVkIGFmdGVyIHN0ZCBqb2luIGNvbHVtbnMgaW4g\nZmsgSU8KICAgICAgICAgICAgaWYgKGpvaW5zW2ldWzFdaW5zdGFuY2VvZiBD\nb2x1bW4pCiAgICAgICAgICAgICAgICBpZHggPSBpIC0gY29uc3RJZHg7CiAg\nICAgICAgICAgIGVsc2UgaWYgKChqb2luc1tpXVsyXSA9PSBCb29sZWFuLlRS\nVUUpID09IChfam9pbiA9PSBKT0lOX0lOVkVSU0UpKQogICAgICAgICAgICAg\nICAgaWR4ID0gZmsuZ2V0Q29sdW1ucygpLmxlbmd0aCArIGNvbnN0SWR4Kys7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICBzZXRJT0Zyb21Db2x1bW5GbGFncygoQ29sdW1uKSBjb2xz\nLmdldChpKSwgaWR4KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgb3IgcmV0cmlldmUgdGhlIGZvcmVpZ24ga2V5IGpvaW5zLgog\nICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3Jl\nIHJldHJpZXZpbmcgYSBrZXkgZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxv\nY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJh\nbSB0YWJsZSB0aGUgdGFibGUgZm9yIHRoZSBrZXkKICAgICAqIEBwYXJhbSBj\nbHMgdHlwZSB3ZSdyZSBqb2luaW5nIGZyb20sIGlmIGFwcGxpY2FibGUKICAg\nICAqIEBwYXJhbSByZWwgdGFyZ2V0IHR5cGUgd2UncmUgam9pbmluZyB0bwog\nICAgICogQHBhcmFtIGdpdmVuIHRoZSBjb2x1bW5zIGdpdmVuIGJ5IHRoZSB1\nc2VyCiAgICAgKiBAcGFyYW0gZGVmIGZvcmVpZ24ga2V5IGRlZmF1bHRzIHBy\nb3ZpZGVyCiAgICAgKiBAcGFyYW0gaW52ZXJzYWJsZSB3aGV0aGVyIHRoZSBm\nb3JlaWduIGtleSBjYW4gYmUgaW52ZXJzZWQKICAgICAqIEBwYXJhbSBhZGFw\ndCB3aGV0aGVyIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcg\nb3Igc2NoZW1hCiAgICAgKiBAcmV0dXJuIGFycmF5IG9mIHR1cGxlcyB3aGVy\nZSB0aGUgZmlyc3QgZWxlbWVudCBpcyB0aGUKICAgICAqIGxvY2FsIGNvbHVt\nbiAob3IgaW4gdGhlIGNhc2Ugb2YgYSBjb25zdGFudCBqb2luIHRoZQogICAg\nICogc29sZSBjb2x1bW4pLCB0aGUgc2Vjb25kIGlzIHRoZSB0YXJnZXQgY29s\ndW1uIChvcgogICAgICogY29uc3RhbnQpLCBhbmQgdGhlIHRoaXJkIGlzIHtA\nbGluayBCb29sZWFuI1RSVUV9IGlmCiAgICAgKiB0aGlzIGlzIGFuIGludmVy\nc2Ugam9pbgogICAgICovCiAgICBwcml2YXRlIE9iamVjdFtdW10gY3JlYXRl\nSm9pbnMoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsCiAgICAgICAgU3RyaW5n\nIHByZWZpeCwgVGFibGUgdGFibGUsIENsYXNzTWFwcGluZyBjbHMsIENsYXNz\nTWFwcGluZyByZWwsCiAgICAgICAgTGlzdCBnaXZlbiwgRm9yZWlnbktleURl\nZmF1bHRzIGRlZiwgYm9vbGVhbiBpbnZlcnNhYmxlLCBib29sZWFuIGFkYXB0\nKSB7CiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGlu\nZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAg\nIGJvb2xlYW4gZmlsbCA9IHJlcG9zLmdldE1hcHBpbmdEZWZhdWx0cygpLmRl\nZmF1bHRNaXNzaW5nSW5mbygpOwogICAgICAgIE9iamVjdFtdW10gam9pbnM7\nCgogICAgICAgIC8vIGlmIG5vIGNvbHVtbnMgZ2l2ZW4sIGp1c3QgY3JlYXRl\nIG1pcnJvcnMgb2YgdGFyZ2V0IGNvbHVtbnMKICAgICAgICBpZiAoZ2l2ZW4u\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlmICghYWRhcHQgJiYgIWZpbGwp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQocHJlZml4ICsgIi1uby1may1jb2xzIiwKICAgICAgICAgICAg\nICAgICAgICBjb250ZXh0KSk7CgogICAgICAgICAgICBDb2x1bW5bXSB0YXJn\nZXRzID0gcmVsLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgICAg\nIGpvaW5zID0gbmV3IE9iamVjdFt0YXJnZXRzLmxlbmd0aF1bM107CiAgICAg\nICAgICAgIENvbHVtbiB0bXBsYXRlOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHRhcmdldHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIHRtcGxhdGUgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgICAgICAgICB0\nbXBsYXRlLnNldE5hbWUodGFyZ2V0c1tpXS5nZXROYW1lKCkpOwogICAgICAg\nICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZSh0YXJnZXRzW2ldLmdldEph\ndmFUeXBlKCkpOwogICAgICAgICAgICAgICAgdG1wbGF0ZS5zZXRUeXBlKHRh\ncmdldHNbaV0uZ2V0VHlwZSgpKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUu\nc2V0VHlwZU5hbWUodGFyZ2V0c1tpXS5nZXRUeXBlTmFtZSgpKTsKICAgICAg\nICAgICAgICAgIHRtcGxhdGUuc2V0U2l6ZSh0YXJnZXRzW2ldLmdldFNpemUo\nKSk7CiAgICAgICAgICAgICAgICB0bXBsYXRlLnNldERlY2ltYWxEaWdpdHMo\ndGFyZ2V0c1tpXS5nZXREZWNpbWFsRGlnaXRzKCkpOwoKICAgICAgICAgICAg\nICAgIGlmIChkZWYgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBkZWYu\ncG9wdWxhdGUodGFibGUsIHJlbC5nZXRUYWJsZSgpLCB0bXBsYXRlLCB0YXJn\nZXRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgaSwgdGFy\nZ2V0cy5sZW5ndGgpOwogICAgICAgICAgICAgICAgam9pbnNbaV1bMF0gPSBt\nZXJnZUNvbHVtbihjb250ZXh0LCBwcmVmaXgsIHRtcGxhdGUsIHRydWUsCiAg\nICAgICAgICAgICAgICAgICAgbnVsbCwgdGFibGUsIGFkYXB0LCBmaWxsKTsK\nICAgICAgICAgICAgICAgIGpvaW5zW2ldWzFdID0gdGFyZ2V0c1tpXTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gam9pbnM7CiAgICAgICAg\nfQoKICAgICAgICAvLyB1c2UgZ2l2ZW4gY29sdW1ucyB0byBjcmVhdGUgam9p\nbi4gIHdlIGRvbid0IHRyeSB0byB1c2UgYW55IG9mIHRoZQogICAgICAgIC8v\nIHRlbXBsYXRlIGNvbHVtbnMsIGV2ZW4gaWYgdGhlIHVzZXIgZG9lc24ndCBn\naXZlIGEgY29sdW1uIGxpbmtpbmcgdG8KICAgICAgICAvLyBldmVyeSBwcmlt\nYXJ5IGtleSBvZiB0aGUgdGFyZ2V0IHR5cGUgLS0gdXNlcnMgYXJlIGFsbG93\nZWQgdG8gY3JlYXRlCiAgICAgICAgLy8gcGFydGlhbCBqb2lucy4gIHRoaXMg\nbWVhbnMsIHRob3VnaCwgdGhhdCBpZiBhIHVzZXIgd2FudHMgdG8gc3BlY2lm\neQogICAgICAgIC8vIGluZm8gZm9yIG9uZSBqb2luIGNvbHVtbiwgaGUgaGFz\nIHRvIGF0IGxlYXN0IGNyZWF0ZSBlbGVtZW50cyBmb3IKICAgICAgICAvLyBh\nbGwgb2YgdGhlbQoKICAgICAgICBqb2lucyA9IG5ldyBPYmplY3RbZ2l2ZW4u\nc2l6ZSgpXVszXTsKICAgICAgICBDb2x1bW4gY29sOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgY29sID0gKENvbHVtbikgZ2l2ZW4uZ2V0KGkpOwogICAgICAgICAgICBt\nZXJnZUpvaW5Db2x1bW4oY29udGV4dCwgcHJlZml4LCBjb2wsIGpvaW5zLCBp\nLCB0YWJsZSwgY2xzLCByZWwsCiAgICAgICAgICAgICAgICBkZWYsIGludmVy\nc2FibGUgJiYgIWNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1BLX0pPSU4pLCBh\nZGFwdCwKICAgICAgICAgICAgICAgIGZpbGwpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gam9pbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nb3IgcmV0cmlldmUgYSBmb3JlaWduIGtleSBjb2x1bW4gZm9yIGEgam9pbi4K\nICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0aGUgbWFwcGluZyB3ZSdy\nZSByZXRyaWV2aW5nIGEga2V5IGZvcgogICAgICogQHBhcmFtIHByZWZpeCBs\nb2NhbGl6ZWQgZXJyb3IgbWVzc2FnZSBrZXkgcHJlZml4CiAgICAgKiBAcGFy\nYW0gZ2l2ZW4gdGhlIGdpdmVuIGxvY2FsIGZvcmVpZ24ga2V5IGNvbHVtbgog\nICAgICogQHBhcmFtIGpvaW5zIGFycmF5IG9mIGpvaW5zCiAgICAgKiBAcGFy\nYW0gaWR4IGluZGV4IG9mIHRoZSBqb2luIGFycmF5IHRvIHBvcHVsYXRlCiAg\nICAgKiBAcGFyYW0gdGFibGUgdGhlIHRhYmxlIGZvciB0aGUga2V5CiAgICAg\nKiBAcGFyYW0gY2xzIHRoZSB0eXBlIHdlJ3JlIGpvaW5pbmcgZnJvbQogICAg\nICogQHBhcmFtIHJlbCB0YXJnZXQgdHlwZSB3ZSdyZSBqb2luaW5nIHRvCiAg\nICAgKiBAcGFyYW0gZGVmIGZvcmVpZ24ga2V5IGRlZmF1bHRzIHByb3ZpZGVy\nOwogICAgICogdXNlIG51bGwgdG8gbWlycm9yIHRhcmdldCBjb2x1bW4gbmFt\nZXMKICAgICAqIEBwYXJhbSBpbnZlcnNhYmxlIHdoZXRoZXIgdGhlIGZvcmVp\nZ24ga2V5IGNhbiBiZSBpbnZlcnNlZAogICAgICogQHBhcmFtIGFkYXB0IHdo\nZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGluZyBvciBz\nY2hlbWEKICAgICAqIEBwYXJhbSBmaWxsIHdoZXRoZXIgdG8gZGVmYXVsdCBt\naXNzaW5nIGNvbHVtbiBpbmZvcm1hdGlvbgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgbWVyZ2VKb2luQ29sdW1uKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0\nLCBTdHJpbmcgcHJlZml4LAogICAgICAgIENvbHVtbiBnaXZlbiwgT2JqZWN0\nW11bXSBqb2lucywgaW50IGlkeCwgVGFibGUgdGFibGUsIENsYXNzTWFwcGlu\nZyBjbHMsCiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbCwgRm9yZWlnbktleURl\nZmF1bHRzIGRlZiwgYm9vbGVhbiBpbnZlcnNhYmxlLAogICAgICAgIGJvb2xl\nYW4gYWRhcHQsIGJvb2xlYW4gZmlsbCkgewogICAgICAgIC8vIGRlZmF1bHQg\ndG8gdGhlIHByaW1hcnkga2V5IGNvbHVtbiBuYW1lIGlmIHRoaXMgaXMgYSBw\nayBqb2luCiAgICAgICAgU3RyaW5nIG5hbWUgPSBnaXZlbi5nZXROYW1lKCk7\nCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCAmJiBnaXZlbiAhPSBudWxsCiAg\nICAgICAgICAgICYmIGdpdmVuLmdldEZsYWcoQ29sdW1uLkZMQUdfUEtfSk9J\nTikgJiYgY2xzICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1uW10gcGtz\nID0gY2xzLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgICAgIGlm\nIChwa3MubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICBuYW1lID0gcGtz\nWzBdLmdldE5hbWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHdlIGNh\nbid0IGFkYXB0LCB0aGVuIHRoZSB1c2VyIG11c3QgYXQgbGVhc3QgZ2l2ZSBh\nIGNvbHVtbiBuYW1lCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCAmJiAhYWRh\ncHQgJiYgIWZpbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldChwcmVmaXggKyAiLW5vLWZrY29sLW5hbWUiLAog\nICAgICAgICAgICAgICAgY29udGV4dCkpOwoKICAgICAgICAvLyBjaGVjayB0\nbyBzZWUgaWYgdGhlIGNvbHVtbiBpc24ndCBpbiB0aGUgZXhwZWN0ZWQgdGFi\nbGU7IGl0IG1pZ2h0CiAgICAgICAgLy8gYmUgYW4gaW52ZXJzZSBqb2luIG9y\nIGEgam9pbiB0byBhIGJhc2UgY2xhc3Mgb2YgdGhlIHRhcmdldCB0eXBlCiAg\nICAgICAgVGFibGUgbG9jYWwgPSB0YWJsZTsKICAgICAgICBUYWJsZSBmb3Jl\naWduID0gcmVsLmdldFRhYmxlKCk7CiAgICAgICAgYm9vbGVhbiBmdWxsTmFt\nZSA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gaW52ZXJzZSA9IGZhbHNlOwog\nICAgICAgIGlmIChuYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgaW50IGRv\ndElkeCA9IG5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgICAgICAgaWYg\nKGRvdElkeCAhPSAtMSkgewogICAgICAgICAgICAgICAgLy8gYWxsb3cgdXNl\nIG9mICcuJyB3aXRob3V0IHByZWZpeCB0byBtZWFuICJ1c2UgZXhwZWN0ZWQK\nICAgICAgICAgICAgICAgIC8vIGZvcmVpZ24gdGFibGUiCiAgICAgICAgICAg\nICAgICBpZiAoZG90SWR4ID09IDApCiAgICAgICAgICAgICAgICAgICAgbG9j\nYWwgPSBmb3JlaWduOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIGxvY2FsID0gZmluZFRhYmxlKGNvbnRleHQsIG5hbWUuc3Vi\nc3RyaW5nKDAsIGRvdElkeCksCiAgICAgICAgICAgICAgICAgICAgICAgIGxv\nY2FsLCBmb3JlaWduLCBudWxsKTsKICAgICAgICAgICAgICAgIGZ1bGxOYW1l\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmlu\nZyhkb3RJZHggKyAxKTsKCiAgICAgICAgICAgICAgICAvLyBpZiBpbnZlcnNl\nIGpvaW4sIHRoZW4gc3dhcCBsb2NhbCBhbmQgZm9yZWlnbiB0YWJsZXMKICAg\nICAgICAgICAgICAgIGlmIChsb2NhbCAhPSB0YWJsZSkgewogICAgICAgICAg\nICAgICAgICAgIGZvcmVpZ24gPSB0YWJsZTsKICAgICAgICAgICAgICAgICAg\nICBpbnZlcnNlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBib29sZWFuIGZvcmNlSW52ZXJzZSA9\nICFmdWxsTmFtZSAmJiBfam9pbiA9PSBKT0lOX0lOVkVSU0U7CiAgICAgICAg\naWYgKGZvcmNlSW52ZXJzZSkgewogICAgICAgICAgICBsb2NhbCA9IGZvcmVp\nZ247CiAgICAgICAgICAgIGZvcmVpZ24gPSB0YWJsZTsKICAgICAgICAgICAg\naW52ZXJzZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBkZXRlcm1p\nbmUgdGFyZ2V0CiAgICAgICAgU3RyaW5nIHRhcmdldE5hbWUgPSBnaXZlbi5n\nZXRUYXJnZXQoKTsKICAgICAgICBPYmplY3QgdGFyZ2V0ID0gbnVsbDsKICAg\nICAgICBUYWJsZSB0dGFibGUgPSBudWxsOwogICAgICAgIGJvb2xlYW4gY29u\nc3RhbnQgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGZ1bGxUYXJnZXQgPSBm\nYWxzZTsKICAgICAgICBpZiAodGFyZ2V0TmFtZSA9PSBudWxsICYmIGdpdmVu\nLmdldFRhcmdldEZpZWxkKCkgIT0gbnVsbCkgewogICAgICAgICAgICBDbGFz\nc01hcHBpbmcgdGNscyA9IChpbnZlcnNlKSA/IGNscyA6IHJlbDsKICAgICAg\nICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IGdpdmVuLmdldFRhcmdldEZpZWxk\nKCk7CiAgICAgICAgICAgIGludCBkb3RJZHggPSBmaWVsZE5hbWUubGFzdElu\nZGV4T2YoJy4nKTsKICAgICAgICAgICAgZnVsbFRhcmdldCA9IGRvdElkeCAh\nPSAtMTsKCiAgICAgICAgICAgIGlmIChkb3RJZHggPT0gMCkgewogICAgICAg\nICAgICAgICAgLy8gYWxsb3cgdXNlIG9mICcuJyB3aXRob3V0IHByZWZpeCB0\nbyBtZWFuICJ1c2UgZXhwZWN0ZWQgbG9jYWwKICAgICAgICAgICAgICAgIC8v\nIGNscyI7IGJ1dCBpZiB3ZSBhbHJlYWR5IGludmVyc2VkIG5vIG5lZWQgdG8g\nc3dpdGNoIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoIWludmVyc2UpCiAg\nICAgICAgICAgICAgICAgICAgdGNscyA9IGNsczsKICAgICAgICAgICAgICAg\nIGZpZWxkTmFtZSA9IGZpZWxkTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAoZG90SWR4ID4gMCkgewogICAgICAgICAgICAgICAg\nLy8gbXVzdCBiZSBjbGFzcyArIGZpZWxkIG5hbWUKICAgICAgICAgICAgICAg\nIHRjbHMgPSBmaW5kQ2xhc3NNYXBwaW5nKGNvbnRleHQsIGZpZWxkTmFtZS5z\ndWJzdHJpbmcKICAgICAgICAgICAgICAgICAgICAoMCwgZG90SWR4KSwgY2xz\nLCByZWwpOwogICAgICAgICAgICAgICAgZmllbGROYW1lID0gZmllbGROYW1l\nLnN1YnN0cmluZyhkb3RJZHggKyAxKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZiAodGNscyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAg\nICAgICAgICAgICAgICsgIi1iYWQtZmt0YXJnZXRjbHMiLCBjb250ZXh0LCBm\naWVsZE5hbWUsIG5hbWUpKTsKCiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBm\naWVsZCA9IHRjbHMuZ2V0RmllbGRNYXBwaW5nKGZpZWxkTmFtZSk7CiAgICAg\nICAgICAgIGlmIChmaWVsZCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAg\nICAgICAgICAgICAgICAgICsgIi1iYWQtZmt0YXJnZXRmaWVsZCIsIG5ldyBP\nYmplY3RbXXsgY29udGV4dCwgZmllbGROYW1lLAogICAgICAgICAgICAgICAg\nICAgIG5hbWUsIHRjbHMgfSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0\nQ29sdW1ucygpLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAg\nICAgICAgICAgICAgICsgIi1ma3RhcmdldGZpZWxkLWNvbHMiLCBjb250ZXh0\nLCBmaWVsZE5hbWUsIG5hbWUpKTsKICAgICAgICAgICAgdHRhYmxlID0gKGZp\nZWxkLmdldEpvaW5Gb3JlaWduS2V5KCkgIT0gbnVsbCkgPyBmaWVsZC5nZXRU\nYWJsZSgpCiAgICAgICAgICAgICAgICA6IGZpZWxkLmdldERlZmluaW5nTWFw\ncGluZygpLmdldFRhYmxlKCk7CiAgICAgICAgICAgIHRhcmdldE5hbWUgPSBm\naWVsZC5nZXRDb2x1bW5zKClbMF0uZ2V0TmFtZSgpOwogICAgICAgIH0gZWxz\nZSBpZiAodGFyZ2V0TmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmICh0\nYXJnZXROYW1lLmNoYXJBdCgwKSA9PSAnXCcnKSB7CiAgICAgICAgICAgICAg\nICBjb25zdGFudCA9IHRydWU7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0\nYXJnZXROYW1lLnN1YnN0cmluZygxLCB0YXJnZXROYW1lLmxlbmd0aCgpIC0g\nMSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0TmFtZS5jaGFyQXQo\nMCkgPT0gJy0nCiAgICAgICAgICAgICAgICB8fCB0YXJnZXROYW1lLmNoYXJB\ndCgwKSA9PSAnLicKICAgICAgICAgICAgICAgIHx8IENoYXJhY3Rlci5pc0Rp\nZ2l0KHRhcmdldE5hbWUuY2hhckF0KDApKSkgewogICAgICAgICAgICAgICAg\nY29uc3RhbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBpZiAodGFyZ2V0TmFtZS5pbmRleE9mKCcuJykgPT0g\nLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IG5ldyBJbnRl\nZ2VyKHRhcmdldE5hbWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gbmV3IERvdWJsZSh0YXJn\nZXROYW1lKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAg\nICAgICAgICAgICsgIi1iYWQtZmtjb25zdCIsIGNvbnRleHQsIHRhcmdldE5h\nbWUsIG5hbWUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBl\nbHNlIGlmICgibnVsbCIuZXF1YWxzSWdub3JlQ2FzZSh0YXJnZXROYW1lKSkK\nICAgICAgICAgICAgICAgIGNvbnN0YW50ID0gdHJ1ZTsKICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICBpbnQgZG90SWR4ID0gdGFyZ2V0TmFt\nZS5sYXN0SW5kZXhPZignLicpOwogICAgICAgICAgICAgICAgZnVsbFRhcmdl\ndCA9IGRvdElkeCAhPSAtMTsKICAgICAgICAgICAgICAgIGlmIChkb3RJZHgg\nPT0gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIGFsbG93IHVzZSBvZiAn\nLicgd2l0aG91dCBwcmVmaXggdG8gbWVhbiAidXNlIGV4cGVjdGVkCiAgICAg\nICAgICAgICAgICAgICAgLy8gbG9jYWwgdGFibGUiLCBidXQgaWdub3JlIGlm\nIHdlJ3JlIGFscmVhZHkgaW52ZXJzZWQKICAgICAgICAgICAgICAgICAgICBp\nZiAoIWludmVyc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHR0YWJsZSA9\nIGxvY2FsOwogICAgICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSB0YXJn\nZXROYW1lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgdHRhYmxl\nID0gZmluZFRhYmxlKGNvbnRleHQsIHRhcmdldE5hbWUuc3Vic3RyaW5nKDAs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGRvdElkeCksIGZvcmVpZ24sIGxv\nY2FsLCAoaW52ZXJzZSkgPyBjbHMgOiByZWwpOwogICAgICAgICAgICAgICAg\nICAgIHRhcmdldE5hbWUgPSB0YXJnZXROYW1lLnN1YnN0cmluZyhkb3RJZHgg\nKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gdXNlIGV4cGxpY2l0IHRhcmdldCB0YWJsZSBpZiBh\ndmFpbGFibGUKICAgICAgICBpZiAodHRhYmxlID09IGxvY2FsICYmIGxvY2Fs\nICE9IGZvcmVpZ24pIHsKICAgICAgICAgICAgLy8gc3dhcCwgdW5sZXNzIHVz\nZXIgZ2F2ZSBpbmNvbXBhdGlibGUgdGFibGUgaW4gY29sdW1uIG5hbWUKICAg\nICAgICAgICAgaWYgKGZ1bGxOYW1lKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAg\nICAgICAgICAgICAgICsgIi1iYWQtZmt0YXJnZXQtaW52ZXJzZSIsIG5ldyBP\nYmplY3RbXXsgY29udGV4dCwgbmFtZSwKICAgICAgICAgICAgICAgICAgICBm\nb3JlaWduLCB0dGFibGUgfSkpOwogICAgICAgICAgICBsb2NhbCA9IGZvcmVp\nZ247CiAgICAgICAgICAgIGZvcmVpZ24gPSB0dGFibGU7CiAgICAgICAgfSBl\nbHNlIGlmICh0dGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICAvLyB0dGFi\nbGUgbWlnaHQgYmUgYSB0YWJsZSBvZiBhIGJhc2UgY2xhc3Mgb2YgdGhlIHRh\ncmdldAogICAgICAgICAgICBmb3JlaWduID0gdHRhYmxlOwogICAgICAgIH0K\nCiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHdlIGludmVyc2VkOyBpZiB0\naGlzIGlzIGEgc2FtZS10YWJsZSBqb2luLCB0aGVuCiAgICAgICAgLy8gY29u\nc2lkZXIgaXQgYW4gaW1wbGljaXQgaW52ZXJzZSBpZiB0aGUgdXNlciBpbmNs\ndWRlcyB0aGUgdGFibGUgbmFtZQogICAgICAgIC8vIGluIHRoZSBjb2x1bW4g\nbmFtZSwgYnV0IG5vdCBpbiB0aGUgY29sdW1uIHRhcmdldCwgb3IgaWYgdGhl\nIHVzZXIKICAgICAgICAvLyBnaXZlcyBubyBjb2x1bW4gbmFtZSBidXQgYSBm\ndWxsIHRhcmdldCBuYW1lCiAgICAgICAgaW52ZXJzZSA9IGludmVyc2UgfHwg\nbG9jYWwgIT0gdGFibGUgfHwgKGxvY2FsID09IGZvcmVpZ24KICAgICAgICAg\nICAgJiYgKChmdWxsTmFtZSAmJiAhZnVsbFRhcmdldCkgfHwgKG5hbWUgPT0g\nbnVsbCAmJiBmdWxsVGFyZ2V0KSkpOwogICAgICAgIGlmICghaW52ZXJzYWJs\nZSAmJiAhY29uc3RhbnQgJiYgaW52ZXJzZSkgewogICAgICAgICAgICBpZiAo\nbG9jYWwgPT0gZm9yZWlnbikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAg\nICAgICAgICArICItYmFkLWZrLXNlbGYtaW52ZXJzZSIsIGNvbnRleHQsIGxv\nY2FsKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldChwcmVmaXggKyAiLWJhZC1may1pbnZlcnNlIiwKICAgICAg\nICAgICAgICAgIGNvbnRleHQsIGxvY2FsLCB0YWJsZSkpOwogICAgICAgIH0K\nICAgICAgICBpZiAobmFtZSA9PSBudWxsICYmIGNvbnN0YW50KQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJl\nZml4CiAgICAgICAgICAgICAgICArICItbm8tZmtjb2wtbmFtZS1hZGFwdCIs\nIGNvbnRleHQpKTsKCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCAmJiB0YXJn\nZXROYW1lID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgbm8gbmFtZSBv\nciB0YXJnZXQgaXMgcHJvdmlkZWQgYW5kIHRoZXJlJ3MgbW9yZSB0aGFuIG9u\nZSBsaWtlbHkKICAgICAgICAgICAgLy8gam9pbiBwb3NzaWJpbGl0eSwgdG9v\nIGFtYmlndW91cwogICAgICAgICAgICBQcmltYXJ5S2V5IHBrID0gZm9yZWln\nbi5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgICAgIGlmIChqb2lucy5sZW5n\ndGggIT0gMSB8fCBwayA9PSBudWxsIHx8IHBrLmdldENvbHVtbnMoKS5sZW5n\ndGggIT0gMSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAr\nICItbm8tZmtjb2wtbmFtZS1hZGFwdCIsIGNvbnRleHQpKTsKCiAgICAgICAg\nICAgIC8vIGFzc3VtZSB0YXJnZXQgaXMgcGsgY29sdW1uCiAgICAgICAgICAg\nIHRhcmdldE5hbWUgPSBway5nZXRDb2x1bW5zKClbMF0uZ2V0TmFtZSgpOwog\nICAgICAgIH0gZWxzZSBpZiAobmFtZSAhPSBudWxsICYmIHRhcmdldE5hbWUg\nPT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBvbmUgcHJpbWFyeSBrZXkg\nY29sdW1uIHVzZSBpdCBmb3IgdGFyZ2V0OyBpZiBtdWx0aXBsZSBqb2lucwog\nICAgICAgICAgICAvLyBsb29rIGZvciBhIGZvcmVpZ24gY29sdW1uIHdpdGgg\nc2FtZSBuYW1lIGFzIGxvY2FsIGNvbHVtbgogICAgICAgICAgICBQcmltYXJ5\nS2V5IHBrID0gZm9yZWlnbi5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgICAg\nIGlmIChqb2lucy5sZW5ndGggPT0gMSAmJiBwayAhPSBudWxsICYmIHBrLmdl\ndENvbHVtbnMoKS5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgIHRhcmdl\ndE5hbWUgPSBway5nZXRDb2x1bW5zKClbMF0uZ2V0TmFtZSgpOwogICAgICAg\nICAgICBlbHNlIGlmIChmb3JlaWduLmdldENvbHVtbihuYW1lKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IG5hbWU7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAr\nICItbm8tZmtjb2wtdGFyZ2V0LWFkYXB0IiwgY29udGV4dCwgbmFtZSkpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZmluZCB0aGUgdGFyZ2V0IGNvbHVtbiwg\nYW5kIGNyZWF0ZSB0ZW1wbGF0ZSBmb3IgbG9jYWwgY29sdW1uIGJhc2VkCiAg\nICAgICAgLy8gb24gaXQKICAgICAgICBDb2x1bW4gdG1wbGF0ZSA9IG5ldyBD\nb2x1bW4oKTsKICAgICAgICB0bXBsYXRlLnNldE5hbWUobmFtZSk7CiAgICAg\nICAgaWYgKCFjb25zdGFudCkgewogICAgICAgICAgICBDb2x1bW4gdGNvbCA9\nIGZvcmVpZ24uZ2V0Q29sdW1uKHRhcmdldE5hbWUpOwogICAgICAgICAgICBp\nZiAodGNvbCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCArICItYmFkLWZrdGFy\nZ2V0IiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGNvbnRl\neHQsIHRhcmdldE5hbWUsIG5hbWUsIGZvcmVpZ24gfSkpOwoKICAgICAgICAg\nICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRtcGxhdGUu\nc2V0TmFtZSh0Y29sLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHRtcGxhdGUu\nc2V0SmF2YVR5cGUodGNvbC5nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAg\ndG1wbGF0ZS5zZXRUeXBlKHRjb2wuZ2V0VHlwZSgpKTsKICAgICAgICAgICAg\ndG1wbGF0ZS5zZXRUeXBlTmFtZSh0Y29sLmdldFR5cGVOYW1lKCkpOwogICAg\nICAgICAgICB0bXBsYXRlLnNldFNpemUodGNvbC5nZXRTaXplKCkpOwogICAg\nICAgICAgICB0bXBsYXRlLnNldERlY2ltYWxEaWdpdHModGNvbC5nZXREZWNp\nbWFsRGlnaXRzKCkpOwogICAgICAgICAgICB0YXJnZXQgPSB0Y29sOwogICAg\nICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgU3RyaW5nKQogICAg\nICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKEphdmFUeXBlcy5TVFJJTkcp\nOwogICAgICAgIGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEludGVnZXIp\nCiAgICAgICAgICAgIHRtcGxhdGUuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLklO\nVCk7CiAgICAgICAgZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgRG91Ymxl\nKQogICAgICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKEphdmFUeXBlcy5E\nT1VCTEUpOwoKICAgICAgICAvLyBwb3B1bGF0ZSB0ZW1wbGF0ZSwgYnV0IGxl\ndCB1c2VyLWdpdmVuIG5hbWUgb3ZlcnJpZGUgZGVmYXVsdCBuYW1lCiAgICAg\nICAgaWYgKGRlZiAhPSBudWxsKQogICAgICAgICAgICBkZWYucG9wdWxhdGUo\nbG9jYWwsIGZvcmVpZ24sIHRtcGxhdGUsIHRhcmdldCwgaW52ZXJzZSwgaWR4\nLAogICAgICAgICAgICAgICAgam9pbnMubGVuZ3RoKTsKICAgICAgICBpZiAo\nbmFtZSAhPSBudWxsKQogICAgICAgICAgICB0bXBsYXRlLnNldE5hbWUobmFt\nZSk7CgogICAgICAgIC8vIGNyZWF0ZSBvciBtZXJnZSBsb2NhbCBjb2x1bW4K\nICAgICAgICBDb2x1bW4gY29sID0gbWVyZ2VDb2x1bW4oY29udGV4dCwgcHJl\nZml4LCB0bXBsYXRlLCB0cnVlLCBnaXZlbiwgbG9jYWwsCiAgICAgICAgICAg\nIGFkYXB0LCBmaWxsKTsKCiAgICAgICAgam9pbnNbaWR4XVswXSA9IGNvbDsK\nICAgICAgICBqb2luc1tpZHhdWzFdID0gdGFyZ2V0OwogICAgICAgIGlmIChp\nbnZlcnNlKQogICAgICAgICAgICBqb2luc1tpZHhdWzJdID0gQm9vbGVhbi5U\nUlVFOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgdGFyZ2V0IGNs\nYXNzIG1hcHBpbmcgZ2l2ZW4gdGhlIHVzZXIncyBjbGFzcyBuYW1lLgogICAg\nICoKICAgICAqIEBwYXJhbSBjb250ZXh0IGZvciBlcnJvciBtZXNzYWdlcwog\nICAgICogQHBhcmFtIGNsc05hbWUgY2xhc3MgbmFtZSBnaXZlbiBieSB1c2Vy\nCiAgICAgKiBAcGFyYW0gY2xzIG9yaWdpbmFsIHNvdXJjZSBtYXBwaW5nCiAg\nICAgKiBAcGFyYW0gcmVsIG9yaWdpbmFsIHRhcmdldCBtYXBwaW5nCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNzTWFwcGluZyBmaW5kQ2xhc3NN\nYXBwaW5nKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LAogICAgICAgIFN0cmlu\nZyBjbHNOYW1lLCBDbGFzc01hcHBpbmcgY2xzLCBDbGFzc01hcHBpbmcgcmVs\nKSB7CiAgICAgICAgaWYgKGlzQ2xhc3NNYXBwaW5nTmFtZShjbHNOYW1lLCBj\nbHMpKQogICAgICAgICAgICByZXR1cm4gY2xzOwogICAgICAgIGlmIChpc0Ns\nYXNzTWFwcGluZ05hbWUoY2xzTmFtZSwgcmVsKSkKICAgICAgICAgICAgcmV0\ndXJuIHJlbDsKICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoInRhcmdldC13cm9uZy1jbHMiLCBuZXcgT2JqZWN0W10KICAg\nICAgICAgICAgeyBjb250ZXh0LCBjbHNOYW1lLCBjbHMsIHJlbCB9KSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4g\nbmFtZSBtYXRjaGVzIHRoZSBnaXZlbiBtYXBwaW5nLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBib29sZWFuIGlzQ2xhc3NNYXBwaW5nTmFtZShTdHJp\nbmcgbmFtZSwgQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIGlmIChjbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChuYW1lLmVxdWFscyhjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSkKICAgICAgICAgICAgfHwgbmFtZS5lcXVhbHMoU3RyaW5ncy5nZXRDbGFz\nc05hbWUoY2xzLmdldERlc2NyaWJlZFR5cGUoKSkpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gaXNDbGFzc01hcHBpbmdOYW1l\nKG5hbWUsIGNscy5nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0cyBpbnRlcm5hbCBjb2x1bW4gaW5mb3JtYXRp\nb24gdG8gbWF0Y2ggdGhlIGdpdmVuIG1hcHBlZCBjb2x1bW5zLgogICAgICoK\nICAgICAqIEBwYXJhbSBmb3JjZUpEQkNUeXBlIHdoZXRoZXIgdG8gZm9yY2Ug\ndGhlIGpkYmMtdHlwZSBvZiB0aGUgY29sdW1ucwogICAgICogdG8gYmUgc2V0\nLCBldmVuIHdoZW4gaXQgbWF0Y2hlcyB0aGUgZGVmYXVsdCBmb3IgdGhlIGNv\nbHVtbnMnIGphdmEgdHlwZQogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBz\neW5jQ29sdW1ucyhNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgQ29sdW1uW10g\nY29scywKICAgICAgICBib29sZWFuIGZvcmNlSkRCQ1R5cGUpIHsKICAgICAg\nICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgIF9jb2xzID0gbnVsbDsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0KGNvbHMubGVuZ3RoKTsKICAgICAg\nICAgICAgQ29sdW1uIGNvbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb2wg\nPSBzeW5jQ29sdW1uKGNvbnRleHQsIGNvbHNbaV0sIGNvbHMubGVuZ3RoLAog\nICAgICAgICAgICAgICAgICAgIGZvcmNlSkRCQ1R5cGUsIGNvbHNbaV0uZ2V0\nVGFibGUoKSwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nc2V0Q29sdW1uRmxhZ3NGcm9tSU8oY29sLCBpKTsKICAgICAgICAgICAgICAg\nIF9jb2xzLmFkZChjb2wpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IEkvTyBmbGFncyBvbiB0aGUgY29sdW1u\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Q29sdW1uRmxhZ3NGcm9t\nSU8oQ29sdW1uIGNvbCwgaW50IGkpIHsKICAgICAgICBpZiAoX2lvID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb2wuc2V0RmxhZyhD\nb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIV9pby5pc1VwZGF0YWJsZShpLCBm\nYWxzZSkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5T\nRVJUQUJMRSwgIV9pby5pc0luc2VydGFibGUoaSwgZmFsc2UpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldHMgaW50ZXJuYWwgaW5kZXggaW5mb3JtYXRp\nb24gdG8gbWF0Y2ggZ2l2ZW4gbWFwcGVkIGluZGV4LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBzeW5jSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRl\neHQsIEluZGV4IGlkeCkgewogICAgICAgIGlmIChpZHggPT0gbnVsbCkgewog\nICAgICAgICAgICBfaWR4ID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgX2NhbklkeCA9IHRydWU7CiAgICAgICAgX2lk\neCA9IG5ldyBJbmRleCgpOwogICAgICAgIF9pZHguc2V0TmFtZShpZHguZ2V0\nTmFtZSgpKTsKICAgICAgICBfaWR4LnNldFVuaXF1ZShpZHguaXNVbmlxdWUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIGludGVybmFsIGNvbnN0\ncmFpbnQgaW5mb3JtYXRpb24gdG8gbWF0Y2ggZ2l2ZW4gbWFwcGVkIGNvbnN0\ncmFpbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHN5bmNVbmlxdWUo\nTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFVuaXF1ZSB1bnEpIHsKICAgICAg\nICBpZiAodW5xID09IG51bGwpIHsKICAgICAgICAgICAgX3VucSA9IG51bGw7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9jYW5V\nbnEgPSB0cnVlOwogICAgICAgIF91bnEgPSBuZXcgVW5pcXVlKCk7CiAgICAg\nICAgX3VucS5zZXROYW1lKHVucS5nZXROYW1lKCkpOwogICAgICAgIF91bnEu\nc2V0RGVmZXJyZWQodW5xLmlzRGVmZXJyZWQoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXRzIGludGVybmFsIGNvbnN0cmFpbnQgYW5kIGNvbHVtbiBp\nbmZvcm1hdGlvbiB0byBtYXRjaCBnaXZlbiBtYXBwZWQKICAgICAqIGNvbnN0\ncmFpbnQuCiAgICAgKgogICAgICogQHBhcmFtIGxvY2FsIGRlZmF1bHQgbG9j\nYWwgdGFibGUKICAgICAqIEBwYXJhbSB0YXJnZXQgZGVmYXVsdCB0YXJnZXQg\ndGFibGUKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3luY0ZvcmVpZ25L\nZXkoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIEZvcmVpZ25LZXkgZmssCiAg\nICAgICAgVGFibGUgbG9jYWwsIFRhYmxlIHRhcmdldCkgewogICAgICAgIGlm\nIChmayA9PSBudWxsKSB7CiAgICAgICAgICAgIF9mayA9IG51bGw7CiAgICAg\nICAgICAgIF9jb2xzID0gbnVsbDsKICAgICAgICAgICAgX2pvaW4gPSBKT0lO\nX05PTkU7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAg\naWYgKF9qb2luID09IEpPSU5fTk9ORSkKICAgICAgICAgICAgX2pvaW4gPSBK\nT0lOX0ZPUldBUkQ7CgogICAgICAgIGlmIChmay5pc0xvZ2ljYWwoKSkKICAg\nICAgICAgICAgX2ZrID0gbnVsbDsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgX2NhbkZLID0gdHJ1ZTsKICAgICAgICAgICAgX2ZrID0gbmV3IEZvcmVp\nZ25LZXkoKTsKICAgICAgICAgICAgX2ZrLnNldE5hbWUoZmsuZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgX2ZrLnNldERlbGV0ZUFjdGlvbihmay5nZXREZWxl\ndGVBY3Rpb24oKSk7CiAgICAgICAgICAgIF9may5zZXRVcGRhdGVBY3Rpb24o\nZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwogICAgICAgICAgICBfZmsuc2V0RGVm\nZXJyZWQoZmsuaXNEZWZlcnJlZCgpKTsKICAgICAgICB9CgogICAgICAgIENv\nbHVtbltdIGNvbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1u\nW10gcGtDb2xzID0gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAg\nICBDb2x1bW5bXSBjY29scyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwog\nICAgICAgIE9iamVjdFtdIGNzID0gZmsuZ2V0Q29uc3RhbnRzKCk7CiAgICAg\nICAgQ29sdW1uW10gY3BrQ29scyA9IGZrLmdldENvbnN0YW50UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICBPYmplY3RbXSBjcGtzID0gZmsuZ2V0UHJp\nbWFyeUtleUNvbnN0YW50cygpOwoKICAgICAgICBpbnQgc2l6ZSA9IGNvbHMu\nbGVuZ3RoICsgY2NvbHMubGVuZ3RoICsgY3BrQ29scy5sZW5ndGg7CiAgICAg\nICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0KHNpemUpOwogICAgICAgIENvbHVt\nbiBjb2w7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGNvbCA9IHN5bmNDb2x1bW4oY29udGV4\ndCwgY29sc1tpXSwgc2l6ZSwgZmFsc2UsIGxvY2FsLAogICAgICAgICAgICAg\nICAgdGFyZ2V0LCBwa0NvbHNbaV0sIF9qb2luID09IEpPSU5fSU5WRVJTRSk7\nCiAgICAgICAgICAgIHNldENvbHVtbkZsYWdzRnJvbUlPKGNvbCwgaSk7CiAg\nICAgICAgICAgIF9jb2xzLmFkZChjb2wpOwogICAgICAgIH0KICAgICAgICBP\nYmplY3QgY29uc3RhbnQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdGFudCA9IChj\nc1tpXSA9PSBudWxsKSA/IE5VTEwgOiBjc1tpXTsKICAgICAgICAgICAgY29s\nID0gc3luY0NvbHVtbihjb250ZXh0LCBjY29sc1tpXSwgc2l6ZSwgZmFsc2Us\nIGxvY2FsLAogICAgICAgICAgICAgICAgdGFyZ2V0LCBjb25zdGFudCwgX2pv\naW4gPT0gSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAgc2V0Q29sdW1uRmxh\nZ3NGcm9tSU8oY29sLCBjb2xzLmxlbmd0aCArIGkpOwogICAgICAgICAgICBf\nY29scy5hZGQoY29sKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjcGtDb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNv\nbnN0YW50ID0gKGNwa3NbaV0gPT0gbnVsbCkgPyBOVUxMIDogY3Brc1tpXTsK\nICAgICAgICAgICAgX2NvbHMuYWRkKHN5bmNDb2x1bW4oY29udGV4dCwgY3Br\nQ29sc1tpXSwgc2l6ZSwgZmFsc2UsIHRhcmdldCwKICAgICAgICAgICAgICAg\nIGxvY2FsLCBjb25zdGFudCwgX2pvaW4gIT0gSk9JTl9JTlZFUlNFKSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgY29weSBv\nZiB0aGUgZ2l2ZW4gY29sdW1uIHdpdGggdGhlIHJhdyBtYXBwaW5nIGluZm9y\nbWF0aW9uCiAgICAgKiBzZXQgY29ycmVjdGx5LCBhbmQgd2l0aG91dCBzZXR0\naW5ncyB0aGF0IG1hdGNoIGRlZmF1bHRzLgogICAgICoKICAgICAqIEBwYXJh\nbSBudW0gdGhlIG51bWJlciBvZiBjb2x1bW5zIGZvciB0aGlzIG1hcHBpbmcK\nICAgICAqIEBwYXJhbSBmb3JjZUpEQkNUeXBlIHdoZXRoZXIgdGhlIGpkYmMt\ndHlwZSBvZiB0aGUgY3JlYXRlZCBjb2x1bW4KICAgICAqIHNob3VsZCBiZSBz\nZXQsIGV2ZW4gaWYgaXQgbWF0Y2hlcyB0aGUgZGVmYXVsdAogICAgICogZm9y\nIHRoZSBnaXZlbiBjb2x1bW4ncyBqYXZhIHR5cGUKICAgICAqIEBwYXJhbSBj\nb2xUYWJsZSBleHBlY3RlZCB0YWJsZSBmb3IgdGhlIGNvbHVtbgogICAgICog\nQHBhcmFtIHRhcmdldFRhYmxlIGV4cGVjdGVkIHRhcmdldCB0YWJsZSBmb3Ig\nam9pbiBjb2x1bW4KICAgICAqIEBwYXJhbSB0YXJnZXQgdGFyZ2V0IGNvbHVt\nbiBvciBvYmplY3QgZm9yIGpvaW4gY29sdW1uOyBmb3IgYQogICAgICogY29u\nc3RhbnQgbnVsbCB0YXJnZXQsIHVzZSB7QGxpbmsgI05VTEx9CiAgICAgKiBA\ncGFyYW0gaW52ZXJzZSB3aGV0aGVyIGpvaW4gY29sdW1uIGlzIGZvciBpbnZl\ncnNlIGpvaW4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBDb2x1bW4g\nc3luY0NvbHVtbihNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgQ29sdW1uIGNv\nbCwKICAgICAgICBpbnQgbnVtLCBib29sZWFuIGZvcmNlSkRCQ1R5cGUsIFRh\nYmxlIGNvbFRhYmxlLCBUYWJsZSB0YXJnZXRUYWJsZSwKICAgICAgICBPYmpl\nY3QgdGFyZ2V0LCBib29sZWFuIGludmVyc2UpIHsKICAgICAgICAvLyB1c2Ug\nZnVsbCBuYW1lIGZvciBjb2xzIHRoYXQgYXJlbid0IGluIHRoZSBleHBlY3Rl\nZCB0YWJsZSwgb3IgdGhhdAogICAgICAgIC8vIGFyZSBpbnZlcnNlIGpvaW5z\nCiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSAoKE1hcHBpbmdSZXBvc2l0\nb3J5KSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKSkuCiAgICAgICAgICAgIGdl\ndERCRGljdGlvbmFyeSgpOwogICAgICAgIENvbHVtbiBjb3B5ID0gbmV3IENv\nbHVtbigpOwogICAgICAgIGlmIChjb2wuZ2V0VGFibGUoKSAhPSBjb2xUYWJs\nZSB8fCBpbnZlcnNlKQogICAgICAgICAgICBjb3B5LnNldE5hbWUoZGljdC5n\nZXRGdWxsTmFtZShjb2wuZ2V0VGFibGUoKSwgdHJ1ZSkKICAgICAgICAgICAg\nICAgICsgIi4iICsgY29sLmdldE5hbWUoKSk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBjb3B5LnNldE5hbWUoY29sLmdldE5hbWUoKSk7CgogICAgICAg\nIC8vIHNldCB0YXJnZXQgaWYgbm90IGRlZmF1bHQKICAgICAgICBpZiAodGFy\nZ2V0ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHRhcmdldCA9PSBOVUxM\nKQogICAgICAgICAgICAgICAgY29weS5zZXRUYXJnZXQoIm51bGwiKTsKICAg\nICAgICAgICAgZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQ29sdW1uKSB7\nCiAgICAgICAgICAgICAgICBDb2x1bW4gdGNvbCA9IChDb2x1bW4pIHRhcmdl\ndDsKICAgICAgICAgICAgICAgIGlmICgoIWludmVyc2UgJiYgdGNvbC5nZXRU\nYWJsZSgpICE9IHRhcmdldFRhYmxlKQogICAgICAgICAgICAgICAgICAgIHx8\nIChpbnZlcnNlICYmIHRjb2wuZ2V0VGFibGUoKSAhPSBjb2xUYWJsZSkpCiAg\nICAgICAgICAgICAgICAgICAgY29weS5zZXRUYXJnZXQoZGljdC5nZXRGdWxs\nTmFtZSh0Y29sLmdldFRhYmxlKCksIHRydWUpCiAgICAgICAgICAgICAgICAg\nICAgICAgICsgIi4iICsgdGNvbC5nZXROYW1lKCkpOwogICAgICAgICAgICAg\nICAgZWxzZSBpZiAoIWRlZmF1bHRUYXJnZXQoY29sLCB0Y29sLCBudW0pKQog\nICAgICAgICAgICAgICAgICAgIGNvcHkuc2V0VGFyZ2V0KHRjb2wuZ2V0TmFt\nZSgpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2Vv\nZiBOdW1iZXIpCiAgICAgICAgICAgICAgICBjb3B5LnNldFRhcmdldCh0YXJn\nZXQudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGNvcHkuc2V0VGFyZ2V0KCInIiArIHRhcmdldCArICInIik7CiAgICAg\nICAgfSBlbHNlIGlmIChudW0gPiAxKQogICAgICAgICAgICBjb3B5LnNldFRh\ncmdldEZpZWxkKGNvbC5nZXRUYXJnZXRGaWVsZCgpKTsKCiAgICAgICAgaWYg\nKGNvbC5nZXRTaXplKCkgIT0gMCAmJiBjb2wuZ2V0U2l6ZSgpICE9IGRpY3Qu\nY2hhcmFjdGVyQ29sdW1uU2l6ZQogICAgICAgICAgICAmJiAoY29sLmdldFNp\nemUoKSAhPSAtMSB8fCAhY29sLmlzTG9iKCkpKQogICAgICAgICAgICBjb3B5\nLnNldFNpemUoY29sLmdldFNpemUoKSk7CiAgICAgICAgaWYgKGNvbC5nZXRE\nZWNpbWFsRGlnaXRzKCkgIT0gMCkKICAgICAgICAgICAgY29weS5zZXREZWNp\nbWFsRGlnaXRzKGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpOwogICAgICAgIGlm\nIChjb2wuZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwpCiAgICAgICAgICAg\nIGNvcHkuc2V0RGVmYXVsdFN0cmluZyhjb2wuZ2V0RGVmYXVsdFN0cmluZygp\nKTsKICAgICAgICBpZiAoY29sLmlzTm90TnVsbCgpICYmICFjb2wuaXNQcmlt\nYXJ5S2V5KCkKICAgICAgICAgICAgJiYgKCFpc1ByaW1pdGl2ZShjb2wuZ2V0\nSmF2YVR5cGUoKSkgfHwgaXNGb3JlaWduS2V5KGNvbCkpKQogICAgICAgICAg\nICBjb3B5LnNldE5vdE51bGwodHJ1ZSk7CgogICAgICAgIC8vIHNldCB0eXBl\nIG5hbWUgaWYgbm90IGRlZmF1bHQKICAgICAgICBTdHJpbmcgdHlwZU5hbWUg\nPSBjb2wuZ2V0VHlwZU5hbWUoKTsKICAgICAgICBpZiAodHlwZU5hbWUgIT0g\nbnVsbCB8fCBjb3B5LmdldFNpemUoKSAhPSAwCiAgICAgICAgICAgIHx8IGNv\ncHkuZ2V0RGVjaW1hbERpZ2l0cygpICE9IDApIHsKICAgICAgICAgICAgLy8g\naXMgdGhpcyB0aGUgZGljdCBkZWZhdWx0IHR5cGU/IGhhdmUgdG8gZW5zdXJl\nIGpkYmMtdHlwZSBzZXQKICAgICAgICAgICAgLy8gcHJpb3IgdG8gZmluZGlu\nZyBkaWN0IGRlZmF1bHQKICAgICAgICAgICAgY29weS5zZXRUeXBlKGNvbC5n\nZXRUeXBlKCkpOwogICAgICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IGRpY3Qu\nZ2V0VHlwZU5hbWUoY29weSk7CiAgICAgICAgICAgIGNvcHkuc2V0VHlwZShU\neXBlcy5PVEhFUik7CgogICAgICAgICAgICAvLyBjb3B5IHNob3VsZCBub3Qg\naGF2ZSBzaXplIGluZm8gc2V0IGlmIGl0IGlzbid0IHVzZWQgaW4gdHlwZSBu\nYW1lCiAgICAgICAgICAgIGJvb2xlYW4gZGVmU2l6ZWQgPSBkZWZOYW1lLmlu\nZGV4T2YoJygnKSAhPSAtMTsKICAgICAgICAgICAgaWYgKCFkZWZTaXplZCkg\newogICAgICAgICAgICAgICAgaWYgKGNvcHkuZ2V0U2l6ZSgpID4gMCkKICAg\nICAgICAgICAgICAgICAgICBjb3B5LnNldFNpemUoMCk7CiAgICAgICAgICAg\nICAgICBjb3B5LnNldERlY2ltYWxEaWdpdHMoMCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmICh0eXBlTmFtZSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAvLyBtYWtlIHN1cmUgdG8gc3RyaXAgc2l6ZSBmb3IgY29tcGFy\naXNvbgogICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1lLmluZGV4T2YoJygn\nKSA9PSAtMSAmJiBkZWZTaXplZCkKICAgICAgICAgICAgICAgICAgICBkZWZO\nYW1lID0gZGVmTmFtZS5zdWJzdHJpbmcoMCwgZGVmTmFtZS5pbmRleE9mKCco\nJykpOwogICAgICAgICAgICAgICAgaWYgKCF0eXBlTmFtZS5lcXVhbHNJZ25v\ncmVDYXNlKGRlZk5hbWUpKQogICAgICAgICAgICAgICAgICAgIGNvcHkuc2V0\nVHlwZU5hbWUodHlwZU5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBzZXQgamRiYy10eXBlIGlmIG5vdCBkZWZhdWx0IG9yIGlm\nIGZvcmNlZAogICAgICAgIGlmIChmb3JjZUpEQkNUeXBlCiAgICAgICAgICAg\nIHx8ICh0YXJnZXQgIT0gbnVsbCAmJiAhKHRhcmdldCBpbnN0YW5jZW9mIENv\nbHVtbikKICAgICAgICAgICAgJiYgY29sLmdldFR5cGUoKSAhPSBUeXBlcy5W\nQVJDSEFSKQogICAgICAgICAgICB8fCBkaWN0LmdldEpEQkNUeXBlKGNvbC5n\nZXRKYXZhVHlwZSgpLCBmYWxzZSkgIT0gY29sLmdldFR5cGUoKSkKICAgICAg\nICAgICAgY29weS5zZXRUeXBlKGNvbC5nZXRUeXBlKCkpOwoKICAgICAgICBy\nZXR1cm4gY29weTsKICAgIH0KCiAgICAvKiogCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGUgZ2l2ZW4gY29sdW1uIGJlbG9uZ3MgdG8gYSBmb3JlaWduIGtl\neS4KICAgICAqLyAKICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNGb3Jl\naWduS2V5KENvbHVtbiBjb2wpIAogICAgeyAgICAgICAKICAgICAgICBpZiAo\nY29sLmdldFRhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSBjb2wuZ2V0VGFibGUo\nKS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmtzLmxlbmd0aDsgaSsrKSAKICAgICAgICAgICAgaWYgKGZrc1tpXS5j\nb250YWluc0NvbHVtbihjb2wpIAogICAgICAgICAgICAgICAgfHwgZmtzW2ld\nLmNvbnRhaW5zQ29uc3RhbnRDb2x1bW4oY29sKSkKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiB0eXBlIGNv\nZGUgcmVwcmVzZW50cyBhIHByaW1pdGl2ZS4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgYm9vbGVhbiBpc1ByaW1pdGl2ZShpbnQgdHlwZSkgewogICAg\nICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRydWUgaWYgdGhlIGdpdmVuIHRhcmdldCBjb2x1bW4gbWF0Y2hlcyB0\naGUgZGVmYXVsdC4KICAgICAqIElmIHRoZXJlIGlzIG9ubHkgb25lIGNvbHVt\nbiBpbnZvbHZlZCBpbiB0aGUgam9pbiBhbmQgaXQgbGlua3MgdG8gdGhlCiAg\nICAgKiBzaW5nbGUgdGFyZ2V0IHRhYmxlIHBrIGNvbHVtbiwgb3IgaWYgdGhl\nIGNvbHVtbiBuYW1lIGlzIHRoZSBzYW1lIGFzCiAgICAgKiB0aGUgdGFyZ2V0\nIGNvbHVtbiBuYW1lLCB0aGVuIHRoZSB0YXJnZXQgaXMgdGhlIGRlZmF1bHQu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gZGVmYXVsdFRh\ncmdldChDb2x1bW4gY29sLCBDb2x1bW4gdGFyZ2V0Q29sLAogICAgICAgIGlu\ndCBudW0pIHsKICAgICAgICBpZiAoY29sLmdldE5hbWUoKS5lcXVhbHModGFy\nZ2V0Q29sLmdldE5hbWUoKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIGlmIChudW0gPiAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIFByaW1hcnlLZXkgcGsgPSB0YXJnZXRDb2wuZ2V0VGFibGUo\nKS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgaWYgKHBrID09IG51bGwgfHwg\ncGsuZ2V0Q29sdW1ucygpLmxlbmd0aCAhPSAxKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRhcmdldENvbCA9PSBway5nZXRD\nb2x1bW5zKClbMF07CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwbGllcyBk\nZWZhdWx0IHRhYmxlIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGludGVyZmFjZSBUYWJsZURlZmF1bHRzIHsKCiAgICAgICAgLyoq\nCiAgICAgICAgICogUmV0dXJuIHRoZSBkZWZhdWx0IHRhYmxlIG5hbWUuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIFN0cmluZyBnZXQoU2NoZW1hIHNj\naGVtYSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwbGllcyBkZWZhdWx0\nIGZvcmVpZ24ga2V5IGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGludGVyZmFjZSBGb3JlaWduS2V5RGVmYXVsdHMgewoKICAgICAg\nICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBkZWZhdWx0IGZvcmVpZ24ga2V5\nIGZvciB0aGUgZ2l2ZW4gdGFibGVzLCBvciBudWxsIHRvCiAgICAgICAgICog\nY3JlYXRlIGEgbG9naWNhbCBmb3JlaWduIGtleSBvbmx5LiBEbyBub3QgZmls\nbCBpbiB0aGUgY29sdW1ucyBvZgogICAgICAgICAqIHRoZSBmb3JlaWduIGtl\neSwgb25seSBhdHRyaWJ1dGVzIGxpa2UgaXRzIG5hbWUsIGRlbGV0ZSBhY3Rp\nb24sIGV0Yy4KICAgICAgICAgKiBEbyBub3QgYWRkIHRoZSBmb3JlaWduIGtl\neSB0byB0aGUgdGFibGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIEZv\ncmVpZ25LZXkgZ2V0KFRhYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWduLCBib29s\nZWFuIGludmVyc2UpOwoKICAgICAgICAvKioKICAgICAgICAgKiBQb3B1bGF0\nZSB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgY29sdW1uIHdpdGggZGVmYXVsdHMu\nCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0IHRoZSB0YXJn\nZXQgY29sdW1uIG9yIGNvbnN0YW50IHZhbHVlCiAgICAgICAgICogQHBhcmFt\nIHBvcyB0aGUgaW5kZXggb2YgdGhpcyBjb2x1bW4gaW4gdGhlIGZvcmVpZ24g\na2V5CiAgICAgICAgICogQHBhcmFtIGNvbHMgdGhlIG51bWJlciBvZiBjb2x1\nbW5zIGluIHRoZSBmb3JlaWduIGtleQogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyB2b2lkIHBvcHVsYXRlKFRhYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWdu\nLCBDb2x1bW4gY29sLAogICAgICAgICAgICBPYmplY3QgdGFyZ2V0LCBib29s\nZWFuIGludmVyc2UsIGludCBwb3MsIGludCBjb2xzKTsKCX0KfQo=\n","encoding":"base64"}

