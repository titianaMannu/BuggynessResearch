{"sha":"123a81f3578760c4b078e6f9f964ee170464483c","node_id":"MDQ6QmxvYjIwNjM2NDoxMjNhODFmMzU3ODc2MGM0YjA3OGU2ZjlmOTY0ZWUxNzA0NjQ0ODNj","size":45226,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/123a81f3578760c4b078e6f9f964ee170464483c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zcWwu\nVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5CbG9iVmFsdWVIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQnl0\nZUFycmF5VmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuQ2hhckFycmF5U3RyZWFtVmFsdWVIYW5kbGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nQ2hhckFycmF5VmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuQ2xvYlZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVtYmVkRmllbGRTdHJhdGVneTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVtYmVk\nZGVkQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNzU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5IYW5kbGVyRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkltbXV0YWJsZVZhbHVlSGFuZGxl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRz\nLk1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5NYXhFbWJlZGRlZEJ5dGVB\ncnJheUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLnN0cmF0cy5NYXhFbWJlZGRlZENoYXJBcnJheUZpZWxkU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5NYXhFbWJlZGRlZENsb2JGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNsYXNzU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5Ob25lRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUZpZWxkU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5Ob25lVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuTnVtYmVyVmVyc2lvblN0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuT2Jq\nZWN0SWRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuT2JqZWN0SWRWYWx1ZUhhbmRsZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5QcmltaXRp\ndmVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuUmVsYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZp\nZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5SZWxhdGlvbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5SZWxhdGlvbkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlvbk1hcEludmVyc2VLZXlG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdGF0\nZUNvbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdHJpbmdGaWVsZFN0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nU3ViY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3VwZXJjbGFzc0Rp\nc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLlN1cGVyY2xhc3NWZXJzaW9uU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5U\naW1lc3RhbXBWZXJzaW9uU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5VbnR5cGVkUENWYWx1ZUhhbmRsZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5W\nYWx1ZU1hcERpc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZlcnRpY2FsQ2xhc3NTdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5D\nb2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLkpvaW5TeW50YXhlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5PcmRlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgovKioK\nICogUmVwb3NpdG9yeSBvZiBvYmplY3QvcmVsYXRpb25hbCBtYXBwaW5nIGlu\nZm9ybWF0aW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGlj\nIGNsYXNzIE1hcHBpbmdSZXBvc2l0b3J5CiAgICBleHRlbmRzIE1ldGFEYXRh\nUmVwb3NpdG9yeSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChNYXBw\naW5nUmVwb3NpdG9yeS5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBNYXAgX2hhbmRsZXJzID0gbmV3IEhhc2hNYXAoKTsKCiAgICBzdGF0aWMg\newogICAgICAgIC8vIHJlZ2lzdGVyIGRlZmF1bHQgdmFsdWUgaGFuZGxlcnMK\nICAgICAgICBfaGFuZGxlcnMucHV0KCJqYXZhLmxhbmcuRW51bSIsCiAgICAg\nICAgICAgICJvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5F\nbnVtVmFsdWVIYW5kbGVyIik7CiAgICB9CgogICAgcHJpdmF0ZSB0cmFuc2ll\nbnQgREJEaWN0aW9uYXJ5IF9kaWN0ID0gbnVsbDsKICAgIHByaXZhdGUgdHJh\nbnNpZW50IE1hcHBpbmdEZWZhdWx0cyBfZGVmYXVsdHMgPSBudWxsOwogICAg\nCiAgICBwcml2YXRlIE1hcCBfcmVzdWx0cyA9IG5ldyBIYXNoTWFwKCk7IC8v\nIG9iamVjdC0+cXVlcnlyZXN1bHRtYXBwaW5nCiAgICBwcml2YXRlIFNjaGVt\nYUdyb3VwIF9zY2hlbWEgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJhdGVneUlu\nc3RhbGxlciBfaW5zdGFsbGVyID0gbnVsbDsKCiAgICAvKioKICAgICAqIERl\nZmF1bHQgY29uc3RydWN0b3IuICBDb25maWd1cmUgdmlhIAogICAgICoge0Bs\naW5rIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmFibGV9\nLgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ1JlcG9zaXRvcnkoKSB7CiAg\nICAgICAgc2V0VmFsaWRhdGUoVkFMSURBVEVfTUFQUElORywgdHJ1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW50IGFjY2VzcyB0byBkaWN0\naW9uYXJ5IGZvciBtYXBwaW5ncy4KICAgICAqLwogICAgcHVibGljIERCRGlj\ndGlvbmFyeSBnZXREQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJuIF9k\naWN0OwogICAgfQoKICAgIC8qKgogICAgICogTWFwcGluZyBkZWZhdWx0cy4K\nICAgICAqLwogICAgcHVibGljIE1hcHBpbmdEZWZhdWx0cyBnZXRNYXBwaW5n\nRGVmYXVsdHMoKSB7CiAgICAgICAgcmV0dXJuIF9kZWZhdWx0czsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1hcHBpbmcgZGVmYXVsdC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0TWFwcGluZ0RlZmF1bHRzKE1hcHBpbmdEZWZhdWx0\ncyBkZWZhdWx0cykgewogICAgICAgIF9kZWZhdWx0cyA9IGRlZmF1bHRzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50YXRpb24gb2YgdGhlIGRh\ndGFiYXNlIHNjaGVtYS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXpl\nZCBTY2hlbWFHcm91cCBnZXRTY2hlbWFHcm91cCgpIHsKICAgICAgICBpZiAo\nX3NjaGVtYSA9PSBudWxsKQogICAgICAgICAgICBfc2NoZW1hID0gKChKREJD\nQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJhdGlvbigpKS4KICAgICAgICAg\nICAgICAgIGdldFNjaGVtYUZhY3RvcnlJbnN0YW5jZSgpLnJlYWRTY2hlbWEo\nKTsKICAgICAgICByZXR1cm4gX3NjaGVtYTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAg\nICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBzZXRTY2hlbWFH\ncm91cChTY2hlbWFHcm91cCBzY2hlbWEpIHsKICAgICAgICBfc2NoZW1hID0g\nc2NoZW1hOwogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFsbHMgbWFwcGlu\nZyBzdHJhdGVnaWVzIG9uIGNvbXBvbmVudHMuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgU3RyYXRlZ3lJbnN0YWxsZXIgZ2V0U3RyYXRlZ3lJ\nbnN0YWxsZXIoKSB7CiAgICAgICAgaWYgKF9pbnN0YWxsZXIgPT0gbnVsbCkK\nICAgICAgICAgICAgX2luc3RhbGxlciA9IG5ldyBSdW50aW1lU3RyYXRlZ3lJ\nbnN0YWxsZXIodGhpcyk7CiAgICAgICAgcmV0dXJuIF9pbnN0YWxsZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnN0YWxscyBtYXBwaW5nIHN0cmF0ZWdp\nZXMgb24gY29tcG9uZW50cy4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCB2b2lkIHNldFN0cmF0ZWd5SW5zdGFsbGVyKFN0cmF0ZWd5SW5zdGFs\nbGVyIGluc3RhbGxlcikgewogICAgICAgIF9pbnN0YWxsZXIgPSBpbnN0YWxs\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHF1ZXJ5IHJl\nc3VsdCBtYXBwaW5nIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAg\ncHVibGljIHN5bmNocm9uaXplZCBRdWVyeVJlc3VsdE1hcHBpbmcgZ2V0UXVl\ncnlSZXN1bHRNYXBwaW5nKENsYXNzIGNscywKICAgICAgICBTdHJpbmcgbmFt\nZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkg\newogICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgPSBnZXRRdWVyeVJl\nc3VsdE1hcHBpbmdJbnRlcm5hbChjbHMsIG5hbWUsCiAgICAgICAgICAgIGVu\ndkxvYWRlcik7CiAgICAgICAgaWYgKHJlcyA9PSBudWxsICYmIG11c3RFeGlz\ndCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1xdWVyeS1yZXMiLCBjbHMsIG5hbWUpKTsKICAgICAgICBy\nZXR1cm4gcmVzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuZWQgdGhl\nIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nIHdpdGggdGhlIGdpdmVuIG5hbWUuCiAg\nICAgKi8KICAgIHByaXZhdGUgUXVlcnlSZXN1bHRNYXBwaW5nIGdldFF1ZXJ5\nUmVzdWx0TWFwcGluZ0ludGVybmFsKENsYXNzIGNscywKICAgICAgICBTdHJp\nbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIC8vIGNoZWNrIGNhY2hlCiAgICAgICAgT2JqZWN0IGtleSA9IGdldFF1\nZXJ5UmVzdWx0S2V5KGNscywgbmFtZSk7CiAgICAgICAgUXVlcnlSZXN1bHRN\nYXBwaW5nIHJlcyA9IChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRzLmdl\ndChrZXkpOwogICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHJlczsKCiAgICAgICAgLy8gZ2V0IG1ldGFkYXRhIGZvciBjbGFz\ncywgd2hpY2ggd2lsbCBmaW5kIHJlc3VsdHMgaW4gbWV0YWRhdGEgZmlsZQog\nICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBnZXRNZXRhRGF0YShjbHMsIGVu\ndkxvYWRlciwgZmFsc2UpICE9IG51bGwpIHsKICAgICAgICAgICAgcmVzID0g\nKFF1ZXJ5UmVzdWx0TWFwcGluZykgX3Jlc3VsdHMuZ2V0KGtleSk7CiAgICAg\nICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiByZXM7CiAgICAgICAgfQogICAgICAgIGlmICgoZ2V0U291cmNlTW9kZSgp\nICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgY2xzID0g\nZ2V0TWV0YURhdGFGYWN0b3J5KCkKICAgICAgICAgICAgICAgICAgICAuZ2V0\nUmVzdWx0U2V0TWFwcGluZ1Njb3BlKG5hbWUsIGVudkxvYWRlcik7CiAgICAg\nICAgLy8gbm90IGluIGNhY2hlOyBsb2FkCiAgICAgICAgZ2V0TWV0YURhdGFG\nYWN0b3J5KCkubG9hZChjbHMsIE1PREVfTUVUQSB8IE1PREVfTUFQUElORywg\nZW52TG9hZGVyKTsKICAgICAgICByZXR1cm4gKFF1ZXJ5UmVzdWx0TWFwcGlu\nZykgX3Jlc3VsdHMuZ2V0KGtleSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYWxsIGNhY2hlZCBxdWVyeSByZXN1bHQgbWFwcGluZ3MuCiAgICAg\nKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlSZXN1bHRNYXBwaW5n\nW10gZ2V0UXVlcnlSZXN1bHRNYXBwaW5ncygpIHsKICAgICAgICBDb2xsZWN0\naW9uIHZhbHVlcyA9IF9yZXN1bHRzLnZhbHVlcygpOwogICAgICAgIHJldHVy\nbiAoUXVlcnlSZXN1bHRNYXBwaW5nW10pIHZhbHVlcy50b0FycmF5CiAgICAg\nICAgICAgIChuZXcgUXVlcnlSZXN1bHRNYXBwaW5nW3ZhbHVlcy5zaXplKCld\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1\nZXJ5IHJlc3VsdCBtYXBwaW5nIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9yIG51\nbGwgaWYKICAgICAqIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJv\nbml6ZWQgUXVlcnlSZXN1bHRNYXBwaW5nIGdldENhY2hlZFF1ZXJ5UmVzdWx0\nTWFwcGluZwogICAgICAgIChDbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgcmV0dXJuIChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRzLmdl\ndChnZXRRdWVyeVJlc3VsdEtleShjbHMsIG5hbWUpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBhIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nLgogICAgICov\nCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFF1ZXJ5UmVzdWx0TWFwcGluZyBh\nZGRRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAogICAgICAgIFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlcyA9IG5l\ndyBRdWVyeVJlc3VsdE1hcHBpbmcobmFtZSwgdGhpcyk7CiAgICAgICAgcmVz\nLnNldERlZmluaW5nVHlwZShjbHMpOwogICAgICAgIF9yZXN1bHRzLnB1dChn\nZXRRdWVyeVJlc3VsdEtleShyZXMpLCByZXMpOwogICAgICAgIHJldHVybiBy\nZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBxdWVyeSByZXN1\nbHQgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBi\nb29sZWFuIHJlbW92ZVF1ZXJ5UmVzdWx0TWFwcGluZwogICAgICAgIChRdWVy\neVJlc3VsdE1hcHBpbmcgcmVzKSB7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRz\nLnJlbW92ZShnZXRRdWVyeVJlc3VsdEtleShyZXMpKSAhPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgcXVlcnkgcmVzdWx0IG1hcHBp\nbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiBy\nZW1vdmVRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAogICAgICAgIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfcmVzdWx0cy5y\nZW1vdmUoZ2V0UXVlcnlSZXN1bHRLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBrZXkgZm9y\nIHRoZSBnaXZlbiBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBPYmplY3QgZ2V0UXVlcnlSZXN1bHRLZXkoUXVlcnlSZXN1bHRNYXBwaW5n\nIHJlcykgewogICAgICAgIGlmIChyZXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5UmVzdWx0S2V5\nKHJlcy5nZXREZWZpbmluZ1R5cGUoKSwgcmVzLmdldE5hbWUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciB0aGUg\nZ2l2ZW4gY2xhc3MgLyBuYW1lLiBUaGUgY2xhc3MgYXJndW1lbnQKICAgICAq\nIGNhbiBiZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmpl\nY3QgZ2V0UXVlcnlSZXN1bHRLZXkoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSkg\newogICAgICAgIHJldHVybiBnZXRRdWVyeUtleShjbHMsIG5hbWUpOwogICAg\nfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0TWFwcGluZyhDbGFzcyBj\nbHMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29sZWFuIG11\nc3RFeGlzdCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBzdXBl\nci5nZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAg\nIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0TWFwcGluZ3MoKSB7\nCiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkgc3VwZXIuZ2V0TWV0\nYURhdGFzKCk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZyBnZXRN\nYXBwaW5nKE9iamVjdCBvaWQsIENsYXNzTG9hZGVyIGVudkxvYWRlciwKICAg\nICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIHJldHVybiAoQ2xh\nc3NNYXBwaW5nKSBzdXBlci5nZXRNZXRhRGF0YShvaWQsIGVudkxvYWRlciwg\nbXVzdEV4aXN0KTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10g\nZ2V0SW1wbGVtZW50b3JNYXBwaW5ncyhDbGFzcyBjbHMsCiAgICAgICAgQ2xh\nc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAg\nICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1cGVyLmdldEltcGxlbWVu\ndG9yTWV0YURhdGFzKGNscywgZW52TG9hZGVyLAogICAgICAgICAgICBtdXN0\nRXhpc3QpOwogICAgfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBj\nbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIF9zY2hl\nbWEgPSBudWxsOwogICAgICAgIF9yZXN1bHRzLmNsZWFyKCk7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIHZvaWQgcHJlcGFyZU1hcHBpbmcoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgLy8gbWFrZSBzdXJlIHN1cGVyY2xhc3MgcmVz\nb2x2ZWQgZmlyc3Q7IHJlc29sdmluZyBzdXBlcmNsYXNzIG1heSBoYXZlCiAg\nICAgICAgLy8gcmVzb2x2ZWQgdGhpcyBtYXBwaW5nCiAgICAgICAgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgICAg\nIENsYXNzTWFwcGluZyBzdXAgPSBtYXBwaW5nLmdldFBDU3VwZXJjbGFzc01h\ncHBpbmcoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgKG1hcHBpbmcu\nZ2V0UmVzb2x2ZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIC8vIGRlZmluZSBzdXBlcmNsYXNzIGZpZWxk\ncyBhZnRlciBtYXBwaW5nIGNsYXNzLCBzbyB3ZSBjYW4gdGVsbCB3aGV0aGVy\nCiAgICAgICAgLy8gdGhlIGNsYXNzIGlzIG1hcHBlZCBhbmQgbmVlZHMgdG8g\ncmVkZWZpbmUgYWJzdHJhY3Qgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAgICBn\nZXRTdHJhdGVneUluc3RhbGxlcigpLmluc3RhbGxTdHJhdGVneShtYXBwaW5n\nKTsKICAgICAgICBtYXBwaW5nLmRlZmluZVN1cGVyY2xhc3NGaWVsZHMobWFw\ncGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKQogICAgICAg\nICAgICA9PSBudWxsKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBldmVyeXRoaW5n\nIHRoYXQgZG9lc24ndCBpbnZvbHZlIHJlbGF0aW9ucyB0byBhbGxvdyByZWxh\ndGlvbgogICAgICAgIC8vIG1hcHBpbmdzIHRvIHVzZSB0aGUgb3RoZXJzIGFz\nIGpvaW5hYmxlcwogICAgICAgIG1hcHBpbmcucmVzb2x2ZU5vblJlbGF0aW9u\nTWFwcGluZ3MoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0\nYSBuZXdDbGFzc01ldGFEYXRhKENsYXNzIHR5cGUpIHsKICAgICAgICByZXR1\ncm4gbmV3IENsYXNzTWFwcGluZyh0eXBlLCB0aGlzKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YVtdIG5ld0NsYXNzTWV0YURhdGFBcnJh\neShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBp\nbmdbbGVuZ3RoXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRhRGF0\nYSBuZXdGaWVsZE1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBlLAog\nICAgICAgIENsYXNzTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4g\nbmV3IEZpZWxkTWFwcGluZyhuYW1lLCB0eXBlLCAoQ2xhc3NNYXBwaW5nKSBv\nd25lcik7CiAgICB9CgogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURhdGFbXSBu\nZXdGaWVsZE1ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewogICAgICAgIHJl\ndHVybiBuZXcgRmllbGRNYXBwaW5nW2xlbmd0aF07CiAgICB9CgogICAgcHJv\ndGVjdGVkIENsYXNzTWV0YURhdGEgbmV3RW1iZWRkZWRDbGFzc01ldGFEYXRh\nKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3IENs\nYXNzTWFwcGluZyhvd25lcik7CiAgICB9CgogICAgcHJvdGVjdGVkIFZhbHVl\nTWV0YURhdGEgbmV3VmFsdWVNZXRhRGF0YShGaWVsZE1ldGFEYXRhIG93bmVy\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1hcHBpbmdJbXBsKChGaWVs\nZE1hcHBpbmcpIG93bmVyKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU2VxdWVu\nY2VNZXRhRGF0YSBuZXdTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBTZXF1ZW5jZU1hcHBpbmcobmFtZSwgdGhp\ncyk7CiAgICB9CgogICAgcHJvdGVjdGVkIE9yZGVyIG5ld1ZhbHVlT3JkZXIo\nRmllbGRNZXRhRGF0YSBvd25lciwgYm9vbGVhbiBhc2MpIHsKICAgICAgICBy\nZXR1cm4gbmV3IEpEQkNWYWx1ZU9yZGVyKChGaWVsZE1hcHBpbmcpIG93bmVy\nLCBhc2MpOwogICAgfQoKICAgIHByb3RlY3RlZCBPcmRlciBuZXdSZWxhdGVk\nRmllbGRPcmRlcihGaWVsZE1ldGFEYXRhIG93bmVyLAogICAgICAgIEZpZWxk\nTWV0YURhdGEgcmVsLCBib29sZWFuIGFzYykgewogICAgICAgIHJldHVybiBu\nZXcgSkRCQ1JlbGF0ZWRGaWVsZE9yZGVyKChGaWVsZE1hcHBpbmcpIG93bmVy\nLAogICAgICAgICAgICAoRmllbGRNYXBwaW5nKSByZWwsIGFzYyk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIE9yZGVyW10gbmV3T3JkZXJBcnJheShpbnQgc2l6\nZSkgewogICAgICAgIHJldHVybiBuZXcgSkRCQ09yZGVyW3NpemVdOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHZlcnNpb24gbWV0YWRhdGEgZm9y\nIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNp\nb24gbmV3VmVyc2lvbihDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBWZXJzaW9uKGNscyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgZGlzY3JpbWluYXRvciBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNs\nYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgRGlzY3JpbWluYXRvciBuZXdE\naXNjcmltaW5hdG9yKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICByZXR1\ncm4gbmV3IERpc2NyaW1pbmF0b3IoY2xzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0aGUgZ2l2ZW4gaW5z\ndGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmdJbmZv\nIG5ld01hcHBpbmdJbmZvKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBD\nbGFzc01hcHBpbmdJbmZvIGluZm8gPSBuZXcgQ2xhc3NNYXBwaW5nSW5mbygp\nOwogICAgICAgIGluZm8uc2V0Q2xhc3NOYW1lKGNscy5nZXREZXNjcmliZWRU\neXBlKCkuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4gaW5mbzsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0\naGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVs\nZE1hcHBpbmdJbmZvIG5ld01hcHBpbmdJbmZvKEZpZWxkTWFwcGluZyBmbSkg\newogICAgICAgIHJldHVybiBuZXcgRmllbGRNYXBwaW5nSW5mbygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8gZm9y\nIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZh\nbHVlTWFwcGluZ0luZm8gbmV3TWFwcGluZ0luZm8oVmFsdWVNYXBwaW5nIHZt\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1hcHBpbmdJbmZvKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcgaW5mbyBm\nb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nVmVyc2lvbk1hcHBpbmdJbmZvIG5ld01hcHBpbmdJbmZvKFZlcnNpb24gdmVy\nc2lvbikgewogICAgICAgIHJldHVybiBuZXcgVmVyc2lvbk1hcHBpbmdJbmZv\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcg\naW5mbyBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvIG5ld01hcHBpbmdJbmZv\nKERpc2NyaW1pbmF0b3IgZGlzYykgewogICAgICAgIHJldHVybiBuZXcgRGlz\nY3JpbWluYXRvck1hcHBpbmdJbmZvKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gY2xhc3MnIG5hbWVkIHN0cmF0ZWd5\nLCBvciByZXR1cm4gbnVsbCBpZiBubwogICAgICogbmFtZWQgc3RyYXRlZ3ku\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc1N0cmF0ZWd5IG5hbWVkU3Ry\nYXRlZ3koQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIFN0cmluZyBuYW1l\nID0gY2xzLmdldE1hcHBpbmdJbmZvKCkuZ2V0U3RyYXRlZ3koKTsKICAgICAg\nICByZXR1cm4gaW5zdGFudGlhdGVDbGFzc1N0cmF0ZWd5KG5hbWUsIGNscyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0cmF0ZWd5IGZv\nciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNz\nU3RyYXRlZ3kgaW5zdGFudGlhdGVDbGFzc1N0cmF0ZWd5KFN0cmluZyBuYW1l\nLAogICAgICAgIENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBpZiAobmFt\nZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoTm9uZUNsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAg\nICAgICAgICByZXR1cm4gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2Uo\nKTsKCiAgICAgICAgU3RyaW5nIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0\nUHJvcGVydGllcyhuYW1lKTsKICAgICAgICBuYW1lID0gQ29uZmlndXJhdGlv\nbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwogICAgICAgIENsYXNzIHN0cmF0ID0g\nbnVsbDsKCiAgICAgICAgLy8gYmFzZSBhbmQgdmVydGljYWwgc3RyYXRlZ2ll\ncyB1c2Ugc2FtZSBhbGlhczsgZGlmZmVyZW50aWF0ZSBvbiBqb2luCiAgICAg\nICAgaWYgKEZ1bGxDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkK\nICAgICAgICAgICAgc3RyYXQgPSBGdWxsQ2xhc3NTdHJhdGVneS5jbGFzczsK\nICAgICAgICBlbHNlIGlmIChGbGF0Q2xhc3NTdHJhdGVneS5BTElBUy5lcXVh\nbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gRmxhdENsYXNzU3RyYXRl\nZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoVmVydGljYWxDbGFzc1N0cmF0\nZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBW\nZXJ0aWNhbENsYXNzU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgICAgICBz\ndHJhdCA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwgY2xzLAogICAg\nICAgICAgICAgICAgICAgIENsYXNzU3RyYXRlZ3kuY2xhc3MuZ2V0Q2xhc3NM\nb2FkZXIoKSk7CiAgICAgICAgICAgIENsYXNzU3RyYXRlZ3kgc3RyYXRlZ3kg\nPSAoQ2xhc3NTdHJhdGVneSkgc3RyYXQubmV3SW5zdGFuY2UoKTsKICAgICAg\nICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXRl\nZ3ksIGdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIHByb3Bz\nKTsKICAgICAgICAgICAgcmV0dXJuIHN0cmF0ZWd5OwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWNscy1zdHJhdGVneSIsCiAg\nICAgICAgICAgICAgICBjbHMsIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gZmllbGQn\ncyBuYW1lZCBzdHJhdGVneSwgb3IgcmV0dXJuIG51bGwgaWYgbm8KICAgICAq\nIG5hbWVkIHN0cmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRT\ndHJhdGVneSBuYW1lZFN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwKICAg\nICAgICBib29sZWFuIGluc3RhbGxIYW5kbGVycykgewogICAgICAgIFN0cmlu\nZyBuYW1lID0gZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRTdHJhdGVneSgp\nOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBpZiAoTm9uZUZpZWxkU3RyYXRlZ3kuQUxJQVMu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gTm9uZUZpZWxkU3Ry\nYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgU3RyaW5nIHByb3BzID0g\nQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhuYW1lKTsKICAgICAgICBu\nYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBKYXZhVHlwZXMuY2xh\nc3NGb3JOYW1lKG5hbWUsIGZpZWxkLAogICAgICAgICAgICAgICAgRmllbGRT\ndHJhdGVneS5jbGFzcy5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAg\naWYgKEZpZWxkU3RyYXRlZ3kuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjKSkg\newogICAgICAgICAgICAgICAgRmllbGRTdHJhdGVneSBzdHJhdCA9IChGaWVs\nZFN0cmF0ZWd5KSBjLm5ld0luc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBD\nb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShzdHJhdCwgZ2V0Q29u\nZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgICAgIHByb3BzKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBzdHJhdDsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gbXVzdCBiZSBuYW1lZCBoYW5kbGVyCiAgICAgICAgICAg\nIGlmIChpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICAgICAgICAgIFZhbHVl\nSGFuZGxlciB2aCA9IChWYWx1ZUhhbmRsZXIpIGMubmV3SW5zdGFuY2UoKTsK\nICAgICAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3Rh\nbmNlKHZoLCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICAg\nICAgcHJvcHMpOwogICAgICAgICAgICAgICAgZmllbGQuc2V0SGFuZGxlcih2\naCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5k\nbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLWZpZWxkLXN0cmF0ZWd5IiwKICAgICAgICAgICAg\nICAgIGZpZWxkLCBuYW1lKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIGRpc2NyaW1pbmF0b3In\ncyBuYW1lZCBzdHJhdGVneSwgb3IgcmV0dXJuIG51bGwKICAgICAqIGlmIG5v\nIG5hbWVkIHN0cmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQgRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5IG5hbWVkU3RyYXRlZ3koRGlzY3JpbWluYXRvciBk\naXNjcmltKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBkaXNjcmltLmdldE1h\ncHBpbmdJbmZvKCkuZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAobmFtZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8g\naWYgdGhlcmUgaXMgYSBuYW1lZCBzdHJhdGVneSBwcmVzZW50LCBkaXNjYXJk\nIGl0IGlmIGl0IG1hdGNoZXMKICAgICAgICAvLyB0aGUgYmFzZSBzdHJhdGVn\neSwgc28gdGhhdCB3ZSB3b24ndCBjcmVhdGUgYW4gaW5kZXBlbmRlbnQgaW5z\ndGFuY2UKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gZGlzY3JpbS5nZXRD\nbGFzc01hcHBpbmcoKTsKICAgICAgICB3aGlsZSAoY2xzLmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIGNs\ncyA9IGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAg\nICAgICBEaXNjcmltaW5hdG9yIGJhc2UgPSBjbHMuZ2V0RGlzY3JpbWluYXRv\ncigpOwogICAgICAgIGlmIChiYXNlICE9IGRpc2NyaW0gJiYgYmFzZS5nZXRT\ndHJhdGVneSgpICE9IG51bGwKICAgICAgICAgICAgJiYgbmFtZS5lcXVhbHMo\nYmFzZS5nZXRTdHJhdGVneSgpLmdldEFsaWFzKCkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlRGlzY3Jp\nbWluYXRvclN0cmF0ZWd5KG5hbWUsIGRpc2NyaW0pOwogICAgfQoKICAgIC8q\nKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIGRpc2NyaW1pbmF0b3Ig\nc3RyYXRlZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBEaXNjcmltaW5hdG9y\nU3RyYXRlZ3kgaW5zdGFudGlhdGVEaXNjcmltaW5hdG9yU3RyYXRlZ3kKICAg\nICAgICAoU3RyaW5nIG5hbWUsIERpc2NyaW1pbmF0b3IgZGlzY3JpbSkgewog\nICAgICAgIGlmIChOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LkFMSUFTLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVEaXNjcmltaW5h\ndG9yU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgU3RyaW5nIHBy\nb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhuYW1lKTsKICAg\nICAgICBuYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUp\nOwogICAgICAgIENsYXNzIHN0cmF0ID0gbnVsbDsKCiAgICAgICAgaWYgKENs\nYXNzTmFtZURpc2NyaW1pbmF0b3JTdHJhdGVneS5BTElBUy5lcXVhbHMobmFt\nZSkpCiAgICAgICAgICAgIHN0cmF0ID0gQ2xhc3NOYW1lRGlzY3JpbWluYXRv\nclN0cmF0ZWd5LmNsYXNzOwogICAgICAgIGVsc2UgaWYgKFZhbHVlTWFwRGlz\nY3JpbWluYXRvclN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAg\nICAgICAgc3RyYXQgPSBWYWx1ZU1hcERpc2NyaW1pbmF0b3JTdHJhdGVneS5j\nbGFzczsKICAgICAgICBlbHNlIGlmIChTdWJjbGFzc0pvaW5EaXNjcmltaW5h\ndG9yU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBz\ndHJhdCA9IFN1YmNsYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFz\nczsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHN0cmF0ID09IG51\nbGwpCiAgICAgICAgICAgICAgICBzdHJhdCA9IEphdmFUeXBlcy5jbGFzc0Zv\nck5hbWUobmFtZSwKICAgICAgICAgICAgICAgICAgICBkaXNjcmltLmdldENs\nYXNzTWFwcGluZygpLAogICAgICAgICAgICAgICAgICAgIERpc2NyaW1pbmF0\nb3JTdHJhdGVneS5jbGFzcy5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAg\nICAgRGlzY3JpbWluYXRvclN0cmF0ZWd5IHN0cmF0ZWd5ID0gKERpc2NyaW1p\nbmF0b3JTdHJhdGVneSkKICAgICAgICAgICAgICAgIHN0cmF0Lm5ld0luc3Rh\nbmNlKCk7CiAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUlu\nc3RhbmNlKHN0cmF0ZWd5LCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAg\nICAgICAgICBwcm9wcyk7CiAgICAgICAgICAgIHJldHVybiBzdHJhdGVneTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kaXNj\ncmltLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIGRpc2NyaW0uZ2V0Q2xh\nc3NNYXBwaW5nKCksIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVyc2lvbidzIG5h\nbWVkIHN0cmF0ZWd5LCBvciByZXR1cm4gbnVsbAogICAgICogaWYgbm8gbmFt\nZWQgc3RyYXRlZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3Ry\nYXRlZ3kgbmFtZWRTdHJhdGVneShWZXJzaW9uIHZlcnNpb24pIHsKICAgICAg\nICBTdHJpbmcgbmFtZSA9IHZlcnNpb24uZ2V0TWFwcGluZ0luZm8oKS5nZXRT\ndHJhdGVneSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIG5h\nbWVkIHN0cmF0ZWd5IHByZXNlbnQsIGRpc2NhcmQgaXQgaWYgaXQgbWF0Y2hl\ncwogICAgICAgIC8vIHRoZSBiYXNlIHN0cmF0ZWd5LCBzbyB0aGF0IHdlIHdv\nbid0IGNyZWF0ZSBhbiBpbmRlcGVuZGVudCBpbnN0YW5jZQogICAgICAgIENs\nYXNzTWFwcGluZyBjbHMgPSB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpOwog\nICAgICAgIHdoaWxlIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xzLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIFZlcnNpb24gYmFz\nZSA9IGNscy5nZXRWZXJzaW9uKCk7CiAgICAgICAgaWYgKGJhc2UgIT0gdmVy\nc2lvbiAmJiBiYXNlLmdldFN0cmF0ZWd5KCkgIT0gbnVsbAogICAgICAgICAg\nICAmJiBuYW1lLmVxdWFscyhiYXNlLmdldFN0cmF0ZWd5KCkuZ2V0QWxpYXMo\nKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICByZXR1cm4g\naW5zdGFudGlhdGVWZXJzaW9uU3RyYXRlZ3kobmFtZSwgdmVyc2lvbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVy\nc2lvbiBzdHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25T\ndHJhdGVneSBpbnN0YW50aWF0ZVZlcnNpb25TdHJhdGVneShTdHJpbmcgbmFt\nZSwKICAgICAgICBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICBpZiAoTm9u\nZVZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAg\nICAgIHJldHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldEluc3RhbmNlKCk7\nCgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFBy\nb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRpb25z\nLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICBDbGFzcyBzdHJhdCA9IG51\nbGw7CgogICAgICAgIGlmIChOdW1iZXJWZXJzaW9uU3RyYXRlZ3kuQUxJQVMu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IE51bWJlclZlcnNp\nb25TdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlmIChUaW1lc3RhbXBW\nZXJzaW9uU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAg\nICBzdHJhdCA9IFRpbWVzdGFtcFZlcnNpb25TdHJhdGVneS5jbGFzczsKICAg\nICAgICBlbHNlIGlmIChTdGF0ZUNvbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3ku\nQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IFN0YXRl\nQ29tcGFyaXNvblZlcnNpb25TdHJhdGVneS5jbGFzczsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAg\nICAgICBzdHJhdCA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwKICAg\nICAgICAgICAgICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpLAog\nICAgICAgICAgICAgICAgICAgIFZlcnNpb25TdHJhdGVneS5jbGFzcy5nZXRD\nbGFzc0xvYWRlcigpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC12ZXJzaW9uLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAg\nIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCksIG5hbWUpLCBlKTsKICAgICAg\nICB9CgogICAgICAgIHJldHVybiBpbnN0YW50aWF0ZVZlcnNpb25TdHJhdGVn\neShzdHJhdCwgdmVyc2lvbiwgcHJvcHMpOwogICAgfQoKICAgIC8qKgogICAg\nICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIHZlcnNpb24gc3RyYXRlZ3kuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kgaW5zdGFudGlh\ndGVWZXJzaW9uU3RyYXRlZ3koQ2xhc3Mgc3RyYXQsCiAgICAgICAgVmVyc2lv\nbiB2ZXJzaW9uLCBTdHJpbmcgcHJvcHMpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBWZXJzaW9uU3RyYXRlZ3kgc3RyYXRlZ3kgPSAoVmVyc2lvblN0\ncmF0ZWd5KSBzdHJhdC5uZXdJbnN0YW5jZSgpOwogICAgICAgICAgICBDb25m\naWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShzdHJhdGVneSwgZ2V0Q29u\nZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgcHJvcHMpOwogICAgICAg\nICAgICByZXR1cm4gc3RyYXRlZ3k7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtdmVyc2lvbi1zdHJhdGVneSIsCiAgICAgICAg\nICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpLCBzdHJhdCArICIi\nKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJt\naW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVu\nIGNsYXNzLiBEb2VzCiAgICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhl\nIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIENsYXNzU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KENsYXNzTWFwcGlu\nZyBjbHMpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGNscywg\nZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5\nIHRvIHVzZSBmb3IgdGhlIGdpdmVuIGNsYXNzLiBEb2VzCiAgICAgKiBub3Qg\ndGFrZSBpbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFu\neS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzU3RyYXRlZ3kgZGVmYXVs\ndFN0cmF0ZWd5KENsYXNzTWFwcGluZyBjbHMsCiAgICAgICAgYm9vbGVhbiBh\nZGFwdGluZykgewogICAgICAgIFZhbHVlTWFwcGluZyBlbWJlZCA9IGNscy5n\nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVtYmVkICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gc3VwZXJjbGFzcyBvZiBlbWJlZGRlZCBj\nbGFzcyBpc24ndCBtYXBwZWQKICAgICAgICAgICAgaWYgKGVtYmVkLmdldFR5\ncGUoKSAhPSBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpCiAgICAgICAgICAgICAg\nICB8fCBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRTdHJhdGVneSgpCiAg\nICAgICAgICAgICAgICA9PSBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5j\nZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVDbGFzc1N0cmF0ZWd5\nLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmIChlbWJlZC5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IE9iamVjdElkQ2xhc3NTdHJhdGVneSgpOwogICAgICAgICAgICBy\nZXR1cm4gbmV3IEVtYmVkZGVkQ2xhc3NTdHJhdGVneSgpOwogICAgICAgIH0K\nICAgICAgICBpZiAoY2xzLmlzRW1iZWRkZWRPbmx5KCkpCiAgICAgICAgICAg\nIHJldHVybiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAg\nICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVsdHMuZ2V0U3RyYXRlZ3koY2xz\nLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKHN0cmF0IGluc3RhbmNlb2YgU3Ry\naW5nKQogICAgICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVDbGFzc1N0cmF0\nZWd5KChTdHJpbmcpIHN0cmF0LCBjbHMpOwogICAgICAgIGlmIChzdHJhdCAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKENsYXNzU3RyYXRlZ3kpIHN0\ncmF0OwogICAgICAgIAogICAgICAgIC8vIHNlZSBpZiB0aGVyZSBpcyBhIGRl\nY2xhcmVkIGhpZXJhcmNoeSBzdHJhdGVneQogICAgICAgIENsYXNzU3RyYXRl\nZ3kgaHN0cmF0ID0gbnVsbDsKICAgICAgICBmb3IgKENsYXNzTWFwcGluZyBi\nYXNlID0gY2xzOyBiYXNlICE9IG51bGwgJiYgaHN0cmF0ID09IG51bGw7KSB7\nCiAgICAgICAgICAgIGhzdHJhdCA9IGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVn\neShiYXNlLmdldE1hcHBpbmdJbmZvKCkuCiAgICAgICAgICAgICAgICBnZXRI\naWVyYXJjaHlTdHJhdGVneSgpLCBjbHMpOwogICAgICAgICAgICBiYXNlID0g\nYmFzZS5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\nfQoKICAgICAgICAvLyB0aGUgZnVsbCBzdHJhdGVneSBhcyBhcHBsaWVkIHRv\nIGEgaGllcmFyY2h5IGlzIGEKICAgICAgICAvLyB0YWJsZS1wZXItY29uY3Jl\ndGUtY2xhc3Mgc3RyYXRlZ3ksIHNvIGRvbid0IG1hcCBhYnN0cmFjdCB0eXBl\ncwogICAgICAgIGlmIChoc3RyYXQgaW5zdGFuY2VvZiBGdWxsQ2xhc3NTdHJh\ndGVneQogICAgICAgICAgICAmJiAhY2xzLmlzTWFuYWdlZEludGVyZmFjZSgp\nCiAgICAgICAgICAgICYmIE1vZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldERl\nc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHJl\ndHVybiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAg\nIAogICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBjbHMuZ2V0TWFwcGVkUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBGdWxsQ2xhc3NTdHJhdGVneSgpOwog\nICAgICAgIGlmIChoc3RyYXQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGhzdHJhdDsKICAgICAgICByZXR1cm4gbmV3IEZsYXRDbGFzc1N0cmF0ZWd5\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1\nbHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZmllbGQuIERvZXMK\nICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFtZWQgb3IgY3Vy\ncmVudCBzdHJhdGVneSwgaWYgYW55LiBJZiBhCiAgICAgKiBub24tbnVsbCBz\ndHJhdGVneSBpcyByZXR1cm5lZCwgdGhpcyBtZXRob2QgbWF5IGFzIGEgc2lk\nZSBlZmZlY3QgaW5zdGFsbAogICAgICogdmFsdWUgaGFuZGxlcnMgb24gdGhl\nIGZpZWxkJ3MgdmFsdWUgbWFwcGluZ3MuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBGaWVsZFN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShGaWVsZE1hcHBpbmcg\nZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAg\nICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGZpZWxkLCBpbnN0YWxsSGFu\nZGxlcnMsCiAgICAgICAgICAgIGdldFN0cmF0ZWd5SW5zdGFsbGVyKCkuaXNB\nZGFwdGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0\naGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiBmaWVs\nZC4gRG9lcwogICAgICogbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBuYW1l\nZCBvciBjdXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuIElmIGEKICAgICAqIG5v\nbi1udWxsIHN0cmF0ZWd5IGlzIHJldHVybmVkLCB0aGlzIG1ldGhvZCBtYXkg\nYXMgYSBzaWRlIGVmZmVjdCBpbnN0YWxsCiAgICAgKiB2YWx1ZSBoYW5kbGVy\ncyBvbiB0aGUgZmllbGQncyB2YWx1ZSBtYXBwaW5ncy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KEZpZWxk\nTWFwcGluZyBmaWVsZCwKICAgICAgICBib29sZWFuIGluc3RhbGxIYW5kbGVy\ncywgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIC8vIG5vdCBwZXJzaXN0\nZW50PwogICAgICAgIGlmIChmaWVsZC5nZXRNYW5hZ2VtZW50KCkgIT0gZmll\nbGQuTUFOQUdFX1BFUlNJU1RFTlQKICAgICAgICAgICAgfHwgZmllbGQuaXNW\nZXJzaW9uKCkpCiAgICAgICAgICAgIHJldHVybiBOb25lRmllbGRTdHJhdGVn\neS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChmaWVsZC5nZXREZWZpbmlu\nZ01hcHBpbmcoKS5nZXRTdHJhdGVneSgpID09CiAgICAgICAgICAgIE5vbmVD\nbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICAv\nLyBjaGVjayBmb3IgbmFtZWQgaGFuZGxlciBmaXJzdAogICAgICAgIFZhbHVl\nSGFuZGxlciBoYW5kbGVyID0gbmFtZWRIYW5kbGVyKGZpZWxkKTsKICAgICAg\nICBpZiAoaGFuZGxlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbnN0\nYWxsSGFuZGxlcnMpCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVy\nKGhhbmRsZXIpOwogICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJGaWVs\nZFN0cmF0ZWd5KCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmllbGQuaXNT\nZXJpYWxpemVkKCkpIHsKICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVk\nZGVkQmxvYlNpemUgIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAvLyBjaGVjayBmb3IgbWFwcGVkIHN0cmF0ZWd5\nCiAgICAgICAgICAgIE9iamVjdCBzdHJhdCA9IG1hcHBlZFN0cmF0ZWd5KGZp\nZWxkLCBmaWVsZC5nZXRUeXBlKCksIGFkYXB0aW5nKTsKICAgICAgICAgICAg\naWYgKHN0cmF0IGluc3RhbmNlb2YgRmllbGRTdHJhdGVneSkKICAgICAgICAg\nICAgICAgIHJldHVybiAoRmllbGRTdHJhdGVneSkgc3RyYXQ7CiAgICAgICAg\nICAgIGlmIChzdHJhdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\naW5zdGFsbEhhbmRsZXJzKQogICAgICAgICAgICAgICAgICAgIGZpZWxkLnNl\ndEhhbmRsZXIoKFZhbHVlSGFuZGxlcikgc3RyYXQpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBmb3Iga25vd24g\nZmllbGQgc3RyYXRlZ2llcwogICAgICAgIGlmICghZmllbGQuaXNTZXJpYWxp\nemVkKCkgJiYgKGZpZWxkLmdldFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAg\nICAgICAgICAgfHwgZmllbGQuZ2V0VHlwZSgpID09IEJ5dGVbXS5jbGFzcykp\nIHsKICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNpemUg\nIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1heEVtYmVkZGVk\nQnl0ZUFycmF5RmllbGRTdHJhdGVneSgpOwogICAgICAgIH0gZWxzZSBpZiAo\nIWZpZWxkLmlzU2VyaWFsaXplZCgpCiAgICAgICAgICAgICYmIChmaWVsZC5n\nZXRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgIHx8IGZpZWxk\nLmdldFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykpIHsKICAgICAgICAg\nICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0gLTEgJiYgaXND\nbG9iKGZpZWxkLCBmYWxzZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE1heEVtYmVkZGVkQ2hhckFycmF5RmllbGRTdHJhdGVneSgpOwogICAgICAg\nIH0gZWxzZSBpZiAoIWZpZWxkLmlzU2VyaWFsaXplZCgpKSB7CiAgICAgICAg\nICAgIEZpZWxkU3RyYXRlZ3kgc3RyYXQgPSBkZWZhdWx0VHlwZVN0cmF0ZWd5\nKGZpZWxkLCBpbnN0YWxsSGFuZGxlcnMsCiAgICAgICAgICAgICAgICBhZGFw\ndGluZyk7CiAgICAgICAgICAgIGlmIChzdHJhdCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHN0cmF0OwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2hlY2sgZm9yIGRlZmF1bHQgaGFuZGxlcgogICAgICAgIGhhbmRsZXIgPSBk\nZWZhdWx0SGFuZGxlcihmaWVsZCwgYWRhcHRpbmcpOwogICAgICAgIGlmICho\nYW5kbGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluc3RhbGxIYW5k\nbGVycykKICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIoaGFuZGxl\ncik7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRl\nZ3koKTsKICAgICAgICB9CgogICAgICAgIC8vIGRlZmF1bHQgdG8gYmxvYgog\nICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICAgICAgaWYg\nKGdldExvZygpLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGdl\ndExvZygpLndhcm4oX2xvYy5nZXQoIm5vLWZpZWxkLXN0cmF0ZWd5IiwgZmll\nbGQpKTsKICAgICAgICAgICAgZmllbGQuc2V0U2VyaWFsaXplZCh0cnVlKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNp\nemUgPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGluc3RhbGxIYW5kbGVycykK\nICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIoQmxvYlZhbHVlSGFu\nZGxlci5nZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBI\nYW5kbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbmV3IE1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3koKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnVpbHQtaW4gc3RyYXRlZ3kg\nZm9yIHRoZSBmaWVsZCdzIHR5cGUsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgZGVmYXVsdFR5cGVTdHJh\ndGVneShGaWVsZE1hcHBpbmcgZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0\nYWxsSGFuZGxlcnMsIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBzd2l0\nY2ggKGZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgUHJpbWl0aXZlRmllbGRTdHJhdGVneSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAo\nIWlzQ2xvYihmaWVsZCwgZmFsc2UpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nRmllbGRTdHJhdGVneSgpOwogICAgICAgICAgICAg\nICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0gLTEpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhFbWJlZGRlZENsb2JGaWVs\nZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoZmll\nbGQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBFbWJlZEZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAgIGlm\nIChmaWVsZC5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkKICAgICAgICAg\nICAgICAgICAgICB8fCAhdXNlVW50eXBlZFBDSGFuZGxlcihmaWVsZCkpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvbkZpZWxkU3Ry\nYXRlZ3koKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIFZhbHVlTWFwcGluZyBl\nbGVtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAg\nICAgIFZhbHVlSGFuZGxlciBlaGFuZGxlciA9IG5hbWVkSGFuZGxlcihlbGVt\nKTsKICAgICAgICAgICAgICAgIGlmIChlaGFuZGxlciA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGVoYW5kbGVyID0gZGVmYXVsdEhhbmRsZXIoZWxl\nbSk7CiAgICAgICAgICAgICAgICBpZiAoZWhhbmRsZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlckNvbGxlY3Rpb25TdHJh\ndGVneShmaWVsZCwgZWhhbmRsZXIsIAogICAgICAgICAgICAgICAgICAgICAg\nICBpbnN0YWxsSGFuZGxlcnMpOwogICAgICAgICAgICAgICAgaWYgKGVsZW0u\nZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAgICAgICAgICAgICAg\nICAgICAmJiAhZWxlbS5pc1NlcmlhbGl6ZWQoKSAmJiAhZWxlbS5pc0VtYmVk\nZGVkUEMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh1c2VJbnZlcnNl\nS2V5TWFwcGluZyhmaWVsZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgUmVsYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZpZWxkU3Ry\nYXRlZ3koKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlbGF0\naW9uQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIFZhbHVlTWFwcGlu\nZyBrZXkgPSBmaWVsZC5nZXRLZXlNYXBwaW5nKCk7CiAgICAgICAgICAgICAg\nICBWYWx1ZUhhbmRsZXIga2hhbmRsZXIgPSBuYW1lZEhhbmRsZXIoa2V5KTsK\nICAgICAgICAgICAgICAgIGlmIChraGFuZGxlciA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIGtoYW5kbGVyID0gZGVmYXVsdEhhbmRsZXIoa2V5KTsK\nICAgICAgICAgICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpOwogICAgICAgICAgICAgICAgVmFsdWVIYW5kbGVy\nIHZoYW5kbGVyID0gbmFtZWRIYW5kbGVyKHZhbCk7CiAgICAgICAgICAgICAg\nICBpZiAodmhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB2\naGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKHZhbCk7CiAgICAgICAgICAgICAg\nICBib29sZWFuIGtyZWwgPSBraGFuZGxlciA9PSBudWxsIAogICAgICAgICAg\nICAgICAgICAgICYmIGtleS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5Q\nQwogICAgICAgICAgICAgICAgICAgICYmICFrZXkuaXNTZXJpYWxpemVkKCkg\nJiYgIWtleS5pc0VtYmVkZGVkUEMoKTsKICAgICAgICAgICAgICAgIGJvb2xl\nYW4gdnJlbCA9IHZoYW5kbGVyID09IG51bGwgCiAgICAgICAgICAgICAgICAg\nICAgJiYgdmFsLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDCiAgICAg\nICAgICAgICAgICAgICAgJiYgIXZhbC5pc1NlcmlhbGl6ZWQoKSAmJiAhdmFs\nLmlzRW1iZWRkZWRQQygpOwogICAgICAgICAgICAgICAgaWYgKCFrcmVsICYm\nIHZyZWwgJiYga2V5LmdldFZhbHVlTWFwcGVkQnkoKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHVzZUludmVyc2VLZXlNYXBwaW5nKGZp\nZWxkKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxh\ndGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJh\ndGVneSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYg\nKCFrcmVsICYmIGtoYW5kbGVyID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBpZiAoIXZyZWwgJiYgdmhhbmRs\nZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIHJldHVybiBoYW5kbGVyTWFwU3RyYXRlZ3koZmllbGQsIGto\nYW5kbGVyLCB2aGFuZGxlciwga3JlbCwKICAgICAgICAgICAgICAgICAgICB2\ncmVsLCBpbnN0YWxsSGFuZGxlcnMpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29s\nbGVjdGlvbiBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgaGFuZGxl\nciwgb3IgbnVsbAogICAgICogaWYgbm9uZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIEZpZWxkU3RyYXRlZ3kgaGFuZGxlckNvbGxlY3Rpb25TdHJhdGVneShG\naWVsZE1hcHBpbmcgZmllbGQsIAogICAgICAgIFZhbHVlSGFuZGxlciBlaGFu\nZGxlciwgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWFw\nIHN0cmF0ZWd5IGZvciB0aGUgZ2l2ZW4ga2V5IGFuZCB2YWx1ZSBoYW5kbGVy\ncyAvIHJlbGF0aW9ucywKICAgICAqIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgaGFuZGxlck1hcFN0cmF0\nZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwgCiAgICAgICAgVmFsdWVIYW5kbGVy\nIGtoYW5kbGVyLCBWYWx1ZUhhbmRsZXIgdmhhbmRsZXIsIGJvb2xlYW4ga3Jl\nbCwgCiAgICAgICAgYm9vbGVhbiB2cmVsLCAgYm9vbGVhbiBpbnN0YWxsSGFu\nZGxlcnMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFVzZSBoaW50cyBpbiBtYXBwaW5nIGRhdGEgdG8gZmlndXJlIG91\ndCB3aGV0aGVyIHRoZSBnaXZlbiByZWxhdGlvbgogICAgICogZmllbGQgc2hv\ndWxkIHVzZSBhbiBpbnZlcnNlIGZvcmVpZ24ga2V5IG9yIGFuIGFzc29jaWF0\naW9uIHRhYmxlIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiB1c2VJbnZlcnNlS2V5TWFwcGluZyhGaWVsZE1hcHBpbmcgZmllbGQpIHsK\nICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVk\nQnlNYXBwaW5nKCk7CiAgICAgICAgaWYgKG1hcHBlZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChtYXBwZWQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgaWYgKG1hcHBlZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNvZGUoKSA9PSBK\nYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW1hcHBlZC1ieSIsIGZpZWxkLAogICAgICAgICAgICAgICAgbWFw\ncGVkKSk7CiAgICAgICAgfQoKICAgICAgICAvLyB3aXRob3V0IGEgbWFwcGVk\nLWJ5LCB3ZSBoYXZlIHRvIGxvb2sgZm9yIGNsdWVzIGFzIHRvIHRoZSBtYXBw\naW5nLgogICAgICAgIC8vIHdlIGFzc3VtZSB0aGF0IGFueXRoaW5nIHdpdGgg\nZWxlbWVudCBmb3JlaWduIGtleSBjb2x1bW5zIGJ1dCBubyBqb2luCiAgICAg\nICAgLy8gY29sdW1ucyBvciB0YWJsZSB1c2VzIGFuIGludmVyc2UgZm9yZWln\nbiBrZXksIGFuZCBhbnl0aGluZyBlbHNlIHVzZXMKICAgICAgICAvLyBhbiBh\nc3NvY2lhdGlvbiB0YWJsZQogICAgICAgIEZpZWxkTWFwcGluZ0luZm8gaW5m\nbyA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgVmFsdWVNYXBw\naW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAg\nIHJldHVybiBpbmZvLmdldFRhYmxlTmFtZSgpID09IG51bGwgJiYgaW5mby5n\nZXRDb2x1bW5zKCkuaXNFbXB0eSgpCiAgICAgICAgICAgICYmICFlbGVtLmdl\ndFZhbHVlSW5mbygpLmdldENvbHVtbnMoKS5pc0VtcHR5KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDaGVjayB0aGUgZ2l2ZW4gdmFsdWUgYWdhaW5zdCBt\nYXBwZWQgc3RyYXRlZ2llcy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3Qg\nbWFwcGVkU3RyYXRlZ3koVmFsdWVNYXBwaW5nIHZhbCwgQ2xhc3MgdHlwZSwK\nICAgICAgICBib29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgaWYgKHR5cGUg\nPT0gbnVsbCB8fCB0eXBlID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIE9iamVjdCBzdHJhdCA9IF9kZWZhdWx0\ncy5nZXRTdHJhdGVneSh2YWwsIHR5cGUsIGFkYXB0aW5nKTsKICAgICAgICBp\nZiAoc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgc3RyYXQgPSBfaGFuZGxl\ncnMuZ2V0KHR5cGUuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8gcmVjdXJzZSBv\nbiBzdXBlcmNsYXNzIHNvIHRoYXQsIGZvciBleGFtcGxlLCBhIHJlZ2lzdGVy\nZWQgaGFuZGxlcgogICAgICAgIC8vIGZvciBqYXZhLmxhbmcuRW51bSB3aWxs\nIHdvcmsgb24gYWxsIGVudW1zCiAgICAgICAgaWYgKHN0cmF0ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBtYXBwZWRTdHJhdGVneSh2YWwsIHR5cGUu\nZ2V0U3VwZXJjbGFzcygpLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKCEoc3Ry\nYXQgaW5zdGFuY2VvZiBTdHJpbmcpKQogICAgICAgICAgICByZXR1cm4gc3Ry\nYXQ7CgogICAgICAgIFN0cmluZyBuYW1lID0gKFN0cmluZykgc3RyYXQ7CiAg\nICAgICAgaWYgKE5vbmVGaWVsZFN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1l\nKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVGaWVsZFN0cmF0ZWd5LmdldElu\nc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRp\nb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZp\nZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBPYmplY3QgbyA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUo\nbmFtZSwgdmFsLAogICAgICAgICAgICAgICAgRmllbGRTdHJhdGVneS5jbGFz\ncy5nZXRDbGFzc0xvYWRlcigpKS5uZXdJbnN0YW5jZSgpOwogICAgICAgICAg\nICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShvLCBnZXRDb25m\naWd1cmF0aW9uKCksIHByb3BzKTsKICAgICAgICAgICAgcmV0dXJuIG87CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWFwcGVk\nLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIHZhbCwgbmFtZSksIGUpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRo\nZSBnaXZlbiB2YWx1ZSdzIG5hbWVkIGhhbmRsZXIsIG9yIHJldHVybiBudWxs\nIGlmIG5vCiAgICAgKiBuYW1lZCBoYW5kbGVyLgogICAgICovCiAgICBwcm90\nZWN0ZWQgVmFsdWVIYW5kbGVyIG5hbWVkSGFuZGxlcihWYWx1ZU1hcHBpbmcg\ndmFsKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSB2YWwuZ2V0VmFsdWVJbmZv\nKCkuZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIHByb3Bz\nID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhuYW1lKTsKICAgICAg\nICBuYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBKYXZhVHlwZXMu\nY2xhc3NGb3JOYW1lKG5hbWUsIHZhbCwKICAgICAgICAgICAgICAgIFZhbHVl\nSGFuZGxlci5jbGFzcy5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAg\naWYgKFZhbHVlSGFuZGxlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGMpKSB7\nCiAgICAgICAgICAgICAgICBWYWx1ZUhhbmRsZXIgdmggPSAoVmFsdWVIYW5k\nbGVyKSBjLm5ld0luc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBDb25maWd1\ncmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZSh2aCwgZ2V0Q29uZmlndXJhdGlv\nbigpLAogICAgICAgICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB2aDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsgLy8gbmFtZWQgZmllbGQgc3RyYXRlZ3kKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC12YWx1ZS1oYW5kbGVyIiwK\nICAgICAgICAgICAgICAgIHZhbCwgbmFtZSksIGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBoYW5k\nbGVyIHRvIHVzZSBmb3IgdGhlIGdpdmVuIHZhbHVlLiBEb2VzCiAgICAgKiBu\nb3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIG5hbWVkIGhhbmRsZXIsIGlmIGFu\neS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlSGFuZGxlciBkZWZhdWx0\nSGFuZGxlcihWYWx1ZU1hcHBpbmcgdmFsKSB7CiAgICAgICAgcmV0dXJuIGRl\nZmF1bHRIYW5kbGVyKHZhbCwgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0Fk\nYXB0aW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRo\nZSBkZWZhdWx0IGhhbmRsZXIgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmFsdWUu\nIERvZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFtZWQg\naGFuZGxlciwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgVmFsdWVI\nYW5kbGVyIGRlZmF1bHRIYW5kbGVyKFZhbHVlTWFwcGluZyB2YWwsIGJvb2xl\nYW4gYWRhcHRpbmcpIHsKICAgICAgICBpZiAodmFsLmlzU2VyaWFsaXplZCgp\nKSB7CiAgICAgICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXpl\nICE9IC0xKQogICAgICAgICAgICAgICAgd2Fybk1heEVtYmVkZGVkKHZhbCwg\nX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6ZSk7CiAgICAgICAgICAgIHJldHVy\nbiBCbG9iVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgfQoK\nICAgICAgICBPYmplY3QgaGFuZGxlciA9IG1hcHBlZFN0cmF0ZWd5KHZhbCwg\ndmFsLmdldFR5cGUoKSwgYWRhcHRpbmcpOwogICAgICAgIGlmIChoYW5kbGVy\nIGluc3RhbmNlb2YgVmFsdWVIYW5kbGVyKQogICAgICAgICAgICByZXR1cm4g\nKFZhbHVlSGFuZGxlcikgaGFuZGxlcjsKCiAgICAgICAgaWYgKHZhbC5nZXRU\neXBlKCkgPT0gYnl0ZVtdLmNsYXNzKSB7CiAgICAgICAgICAgIGlmIChfZGlj\ndC5tYXhFbWJlZGRlZEJsb2JTaXplICE9IC0xKQogICAgICAgICAgICAgICAg\nd2Fybk1heEVtYmVkZGVkKHZhbCwgX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6\nZSk7CiAgICAgICAgICAgIHJldHVybiBCeXRlQXJyYXlWYWx1ZUhhbmRsZXIu\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbC5nZXRU\neXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgIHx8IHZhbC5nZXRU\neXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpIHsKICAgICAgICAgICAgaWYg\nKGlzQ2xvYih2YWwsIHRydWUpKQogICAgICAgICAgICAgICAgcmV0dXJuIENo\nYXJBcnJheVN0cmVhbVZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAg\nICAgICAgICByZXR1cm4gQ2hhckFycmF5VmFsdWVIYW5kbGVyLmdldEluc3Rh\nbmNlKCk7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKHZhbC5nZXRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5f\nT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19P\nQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIEltbXV0YWJsZVZhbHVlSGFuZGxlci5nZXRJbnN0YW5j\nZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAg\nICAgICAgICAgICBpZiAoaXNDbG9iKHZhbCwgdHJ1ZSkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIENsb2JWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBJbW11dGFibGVWYWx1ZUhhbmRs\nZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nUEM6CiAgICAgICAgICAgICAgICBpZiAoIXZhbC5nZXRUeXBlTWFwcGluZygp\nLmlzTWFwcGVkKCkKICAgICAgICAgICAgICAgICAgICAmJiB1c2VVbnR5cGVk\nUENIYW5kbGVyKHZhbCkpIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBV\nbnR5cGVkUENWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19V\nTlRZUEVEOgogICAgICAgICAgICAgICAgcmV0dXJuIFVudHlwZWRQQ1ZhbHVl\nSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5PSUQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElk\nVmFsdWVIYW5kbGVyKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgd2Ugc2hv\ndWxkIHVzZSB0aGUgZ2VuZXJpYyB1bnR5cGVkIFBDIGhhbmRsZXIgZm9yIHRo\nZQogICAgICogZ2l2ZW4gdW5tYXBwZWQgcmVsYXRpb24uCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiB1c2VVbnR5cGVkUENIYW5kbGVyKFZhbHVlTWFw\ncGluZyB2YWwpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gdmFsLmdl\ndFR5cGVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIHJlbC5nZXRJZGVudGl0\neVR5cGUoKSA9PSBDbGFzc01hcHBpbmcuSURfVU5LTk9XTgogICAgICAgICAg\nICB8fCAocmVsLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5J\nRF9BUFBMSUNBVElPTgogICAgICAgICAgICAmJiAocmVsLmdldFByaW1hcnlL\nZXlGaWVsZHMoKS5sZW5ndGggPT0gMAogICAgICAgICAgICB8fCAoIXJlbC5p\nc09wZW5KUEFJZGVudGl0eSgpICYmIE1vZGlmaWVyLmlzQWJzdHJhY3QKICAg\nICAgICAgICAgKHJlbC5nZXRPYmplY3RJZFR5cGUoKS5nZXRNb2RpZmllcnMo\nKSkpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgZm9yIGhpbnRz\nIGFzIHRvIHdoZXRoZXIgdGhlIGdpdmVuIGNvbHVtbiBpcyBhIENMT0IuCiAg\nICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0Nsb2IoVmFsdWVNYXBwaW5n\nIHZhbCwgYm9vbGVhbiB3YXJuKSB7CiAgICAgICAgTGlzdCBjb2xzID0gdmFs\nLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29s\ncy5zaXplKCkgIT0gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAg\nICAgICBDb2x1bW4gY29sID0gKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAg\nICAgaWYgKGNvbC5nZXRTaXplKCkgIT0gLTEgJiYgY29sLmdldFR5cGUoKSAh\nPSBUeXBlcy5DTE9CKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIGlmIChfZGljdC5nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpICE9\nIFR5cGVzLkNMT0IpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgaWYgKHdhcm4gJiYgX2RpY3QubWF4RW1iZWRkZWRDbG9iU2l6ZSAhPSAt\nMSkKICAgICAgICAgICAgd2Fybk1heEVtYmVkZGVkKHZhbCwgX2RpY3QubWF4\nRW1iZWRkZWRDbG9iU2l6ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgdGhlIGdpdmVuIHZhbHVlIGlz\nIGJlaW5nIG1hcHBlZCB0byBhIGhhbmRsZXIgdGhhdCB3aWxsIG5vdAogICAg\nICogYmUgYWJsZSB0byBzdG9yZSBsYXJnZSBsb2JzLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2Fybk1heEVtYmVkZGVkKFZhbHVlTWFwcGluZyB2YWws\nIGludCBzaXplKSB7CiAgICAgICAgaWYgKGdldExvZygpLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgZ2V0TG9nKCkud2FybihfbG9jLmdldCgibWF4\nLWVtYmVkLWxvYiIsIHZhbCwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1\nZU9mKHNpemUpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZGlz\nY3JpbWluYXRvci4KICAgICAqIERvZXMgbm90IHRha2UgaW50byBhY2NvdW50\nIHRoZSBjdXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBEaXNjcmltaW5hdG9yU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5\nKERpc2NyaW1pbmF0b3IgZGlzY3JpbSkgewogICAgICAgIHJldHVybiBkZWZh\ndWx0U3RyYXRlZ3koZGlzY3JpbSwgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5p\nc0FkYXB0aW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5l\nIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGRp\nc2NyaW1pbmF0b3IuCiAgICAgKiBEb2VzIG5vdCB0YWtlIGludG8gYWNjb3Vu\ndCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRGlzY3JpbWluYXRvclN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVn\neShEaXNjcmltaW5hdG9yIGRpc2NyaW0sCiAgICAgICAgYm9vbGVhbiBhZGFw\ndGluZykgewogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSBkaXNjcmltLmdl\ndENsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChjbHMuZ2V0RW1iZWRkaW5n\nTWV0YURhdGEoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gTm9uZURp\nc2NyaW1pbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlm\nIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0gbnVs\nbAogICAgICAgICAgICAmJiAoY2xzLmdldFN0cmF0ZWd5KCkgPT0gTm9uZUNs\nYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKQogICAgICAgICAgICB8fCBNb2Rp\nZmllci5pc0ZpbmFsKGRpc2NyaW0uZ2V0Q2xhc3NNYXBwaW5nKCkuZ2V0RGVz\nY3JpYmVkVHlwZSgpLgogICAgICAgICAgICBnZXRNb2RpZmllcnMoKSkpKQog\nICAgICAgICAgICByZXR1cm4gTm9uZURpc2NyaW1pbmF0b3JTdHJhdGVneS5n\nZXRJbnN0YW5jZSgpOwoKICAgICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVs\ndHMuZ2V0U3RyYXRlZ3koZGlzY3JpbSwgYWRhcHRpbmcpOwogICAgICAgIGlm\nIChzdHJhdCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAgcmV0dXJu\nIGluc3RhbnRpYXRlRGlzY3JpbWluYXRvclN0cmF0ZWd5KChTdHJpbmcpIHN0\ncmF0LCBkaXNjcmltKTsKICAgICAgICBpZiAoc3RyYXQgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIChEaXNjcmltaW5hdG9yU3RyYXRlZ3kpIHN0cmF0\nOwoKICAgICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3VwZXJj\nbGFzc0Rpc2NyaW1pbmF0b3JTdHJhdGVneSgpOwogICAgICAgIGlmIChkaXNj\ncmltLmdldE1hcHBpbmdJbmZvKCkuZ2V0VmFsdWUoKSAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbmV3IFZhbHVlTWFwRGlzY3JpbWluYXRvclN0cmF0\nZWd5KCk7CiAgICAgICAgaWYgKGNscy5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE5vbmVEaXNj\ncmltaW5hdG9yU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAo\nYWRhcHRpbmcgfHwgX2RlZmF1bHRzLmRlZmF1bHRNaXNzaW5nSW5mbygpKQog\nICAgICAgICAgICByZXR1cm4gbmV3IENsYXNzTmFtZURpc2NyaW1pbmF0b3JT\ndHJhdGVneSgpOwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gKChKREJD\nQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJhdGlvbigpKS4KICAgICAgICAg\nICAgZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBpZiAoZGlj\ndC5qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9O\nQUwpCiAgICAgICAgICAgIHJldHVybiBOb25lRGlzY3JpbWluYXRvclN0cmF0\nZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIG5ldyBTdWJjbGFz\nc0pvaW5EaXNjcmltaW5hdG9yU3RyYXRlZ3koKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2Ug\nZm9yIHRoZSBnaXZlbiB2ZXJzaW9uLgogICAgICogRG9lcyBub3QgdGFrZSBp\nbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25TdHJhdGVneSBkZWZhdWx0U3Ry\nYXRlZ3koVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1\nbHRTdHJhdGVneSh2ZXJzaW9uLCBnZXRTdHJhdGVneUluc3RhbGxlcigpLmlz\nQWRhcHRpbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmVy\nc2lvbi4KICAgICAqIERvZXMgbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBj\ndXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBWZXJzaW9uU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVy\nc2lvbiwKICAgICAgICBib29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nIGNscyA9IHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKGNscy5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldElu\nc3RhbmNlKCk7CiAgICAgICAgaWYgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKSA9PSBudWxsCiAgICAgICAgICAgICYmIGNscy5nZXRT\ndHJhdGVneSgpID09IE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkp\nCiAgICAgICAgICAgIHJldHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldElu\nc3RhbmNlKCk7CgogICAgICAgIE9iamVjdCBzdHJhdCA9IF9kZWZhdWx0cy5n\nZXRTdHJhdGVneSh2ZXJzaW9uLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKHN0\ncmF0IGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICByZXR1cm4gaW5z\ndGFudGlhdGVWZXJzaW9uU3RyYXRlZ3koKFN0cmluZykgc3RyYXQsIHZlcnNp\nb24pOwogICAgICAgIGlmIChzdHJhdCAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gKFZlcnNpb25TdHJhdGVneSkgc3RyYXQ7CgogICAgICAgIGlmIChj\nbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBTdXBlcmNsYXNzVmVyc2lvblN0cmF0\nZWd5KCk7CgogICAgICAgIEZpZWxkTWFwcGluZyB2ZmllbGQgPSB2ZXJzaW9u\nLmdldENsYXNzTWFwcGluZygpLgogICAgICAgICAgICBnZXRWZXJzaW9uRmll\nbGRNYXBwaW5nKCk7CiAgICAgICAgaWYgKHZmaWVsZCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KHZlcnNpb24sIHZmaWVs\nZCk7CiAgICAgICAgaWYgKGFkYXB0aW5nIHx8IF9kZWZhdWx0cy5kZWZhdWx0\nTWlzc2luZ0luZm8oKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBOdW1iZXJW\nZXJzaW9uU3RyYXRlZ3koKTsKICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25T\ndHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBkZWZhdWx0IHZlcnNpb24gc3RyYXRlZ3ksIGdpdmVuIGEg\ndmVyc2lvbiBmaWVsZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25T\ndHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koVmVyc2lvbiB2ZXJzLAogICAgICAg\nIEZpZWxkTWFwcGluZyB2ZmllbGQpIHsKICAgICAgICBzd2l0Y2ggKHZmaWVs\nZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRBVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lc3RhbXBWZXJzaW9uU3Ry\nYXRlZ3koKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk5VTUJFUjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTnVtYmVyVmVy\nc2lvblN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJhdGVneS5nZXRJbnN0YW5j\nZSgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgZW5k\nQ29uZmlndXJhdGlvbigpCiAgICB7CiAgICAgICAgc3VwZXIuZW5kQ29uZmln\ndXJhdGlvbigpOwoKICAgICAgICBKREJDQ29uZmlndXJhdGlvbiBjb25mID0g\nKEpEQkNDb25maWd1cmF0aW9uKSBnZXRDb25maWd1cmF0aW9uKCk7CiAgICAg\nICAgX2RpY3QgPSBjb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAg\nICAgICAgaWYgKF9kZWZhdWx0cyA9PSBudWxsKQogICAgICAgICAgICBfZGVm\nYXVsdHMgPSBjb25mLmdldE1hcHBpbmdEZWZhdWx0c0luc3RhbmNlKCk7CiAg\nICAgICAgaWYgKF9zY2hlbWEgIT0gbnVsbCAmJiBfc2NoZW1hIGluc3RhbmNl\nb2YgQ29uZmlndXJhYmxlKSB7CiAgICAgICAgICAgICgoQ29uZmlndXJhYmxl\nKSBfc2NoZW1hKS5zZXRDb25maWd1cmF0aW9uKGNvbmYpOwogICAgICAgICAg\nICAoKENvbmZpZ3VyYWJsZSkgX3NjaGVtYSkuc3RhcnRDb25maWd1cmF0aW9u\nKCk7CiAgICAgICAgICAgICgoQ29uZmlndXJhYmxlKSBfc2NoZW1hKS5lbmRD\nb25maWd1cmF0aW9uKCk7CiAgICAgICAgfSAgICAgICAgICAgIAogICAgfQp9\nCg==\n","encoding":"base64"}

