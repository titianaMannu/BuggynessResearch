{"sha":"de3663b7865a5584523744cf17a359748dd46073","node_id":"MDQ6QmxvYjIwNjM2NDpkZTM2NjNiNzg2NWE1NTg0NTIzNzQ0Y2YxN2EzNTk3NDhkZDQ2MDcz","size":34672,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/de3663b7865a5584523744cf17a359748dd46073","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkVtYmVkZGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuSm9pbmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklP\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVp\nZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJvdzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNR\nTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5T\nZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2Vs\nZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9w\nZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBw\nbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGlsLk51\nbWJlcnM7CgovKioKICogTWFwcGluZyBmb3IgYSBzaW5nbGUtdmFsdWVkIHJl\nbGF0aW9uIHRvIGFub3RoZXIgZW50aXR5LgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAc2luY2UgMC40LjAKICovCnB1YmxpYyBjbGFzcyBSZWxhdGlv\nbkZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgQWJzdHJhY3RGaWVsZFN0cmF0\nZWd5CiAgICBpbXBsZW1lbnRzIEpvaW5hYmxlLCBFbWJlZGRhYmxlIHsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKFJlbGF0aW9uRmllbGRTdHJhdGVn\neS5jbGFzcyk7CgogICAgcHJpdmF0ZSBCb29sZWFuIF9ma09pZCA9IG51bGw7\nCgogICAgcHVibGljIHZvaWQgbWFwKGJvb2xlYW4gYWRhcHQpIHsKICAgICAg\nICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuUEMgfHwg\nZmllbGQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LXJlbGF0aW9uIiwgZmll\nbGQpKTsKCiAgICAgICAgZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFZhbHVl\nSW5mbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cwogICAgICAgICAgICAo\nZmllbGQuZ2V0S2V5KCksICFhZGFwdCk7CiAgICAgICAgZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVtYUNv\nbXBvbmVudHMKICAgICAgICAgICAgKGZpZWxkLmdldEVsZW1lbnQoKSwgIWFk\nYXB0KTsKICAgICAgICBib29sZWFuIGNyaXRlcmlhID0gZmllbGQuZ2V0VmFs\ndWVJbmZvKCkuZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpOwoKICAgICAgICAvLyBj\naGVjayBmb3IgbmFtZWQgaW52ZXJzZQogICAgICAgIEZpZWxkTWFwcGluZyBt\nYXBwZWQgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICBp\nZiAobWFwcGVkICE9IG51bGwpIHsKICAgICAgICAgICAgZmllbGQuZ2V0TWFw\ncGluZ0luZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMoZmllbGQsICFh\nZGFwdCk7CiAgICAgICAgICAgIGZpZWxkLmdldFZhbHVlSW5mbygpLmFzc2Vy\ndE5vU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsKICAgICAgICAg\nICAgbWFwcGVkLnJlc29sdmUobWFwcGVkLk1PREVfTUVUQSB8IG1hcHBlZC5N\nT0RFX01BUFBJTkcpOwoKICAgICAgICAgICAgaWYgKCFtYXBwZWQuaXNNYXBw\nZWQoKSB8fCBtYXBwZWQuaXNTZXJpYWxpemVkKCkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm1hcHBl\nZC1ieS11bm1hcHBlZCIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQsIG1h\ncHBlZCkpOwoKICAgICAgICAgICAgaWYgKG1hcHBlZC5nZXRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAgaWYgKG1hcHBl\nZC5nZXRKb2luRGlyZWN0aW9uKCkgPT0gbWFwcGVkLkpPSU5fRk9SV0FSRCkg\newogICAgICAgICAgICAgICAgICAgIGZpZWxkLnNldEpvaW5EaXJlY3Rpb24o\nZmllbGQuSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAgICAgICAgICBmaWVs\nZC5zZXRDb2x1bW5zKG1hcHBlZC5nZXREZWZpbmluZ01hcHBpbmcoKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVHlwZVVuam9pbmVkU3Vi\nY2xhc3MobWFwcGVkKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgKCJtYXBwZWQtaW52ZXJzZS11bmpvaW5lZCIsIGZpZWxkLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldERl\nZmluaW5nTWFwcGluZygpLCBtYXBwZWQpKTsKCiAgICAgICAgICAgICAgICBm\naWVsZC5zZXRGb3JlaWduS2V5KG1hcHBlZC5nZXRGb3JlaWduS2V5CiAgICAg\nICAgICAgICAgICAgICAgKGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpKSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAobWFwcGVkLmdldEVsZW1lbnQoKS5n\nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAg\nICAgaWYgKGlzVHlwZVVuam9pbmVkU3ViY2xhc3MobWFwcGVkLmdldEVsZW1l\nbnRNYXBwaW5nKCkpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICAgICAoIm1hcHBlZC1pbnZlcnNlLXVuam9pbmVkIiwgZmllbGQuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0RGVm\naW5pbmdNYXBwaW5nKCksIG1hcHBlZCkpOwoKICAgICAgICAgICAgICAgIC8v\nIHdhcm4gdGhlIHVzZXIgYWJvdXQgbWFraW5nIHRoZSBjb2xsZWN0aW9uIHNp\nZGUgdGhlIG93bmVyCiAgICAgICAgICAgICAgICBMb2cgbG9nID0gZmllbGQu\nZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpOwogICAgICAgICAgICAgICAgaWYg\nKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9n\nLmluZm8oX2xvYy5nZXQoImNvbGwtb3duZXIiLCBmaWVsZCwgbWFwcGVkKSk7\nCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRGb3JlaWduS2V5KG1hcHBlZC5n\nZXRFbGVtZW50TWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdldEZv\ncmVpZ25LZXkoKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qt\naW52LXJlbGF0aW9uIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZCwgbWFw\ncGVkKSk7CgogICAgICAgICAgICBmaWVsZC5zZXRVc2VDbGFzc0NyaXRlcmlh\nKGNyaXRlcmlhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdGhpcyBpcyBuZWNlc3NhcnkgdG8gc3VwcG9ydCBvcGVuanBh\nIDMgbWFwcGluZ3MsIHdoaWNoIGRpZG4ndAogICAgICAgIC8vIGRpZmZlcmVu\ndGlhdGUgYmV0d2VlbiBzZWNvbmRhcnkgdGFibGUgam9pbnMgYW5kIHJlbGF0\naW9ucyBidWlsdAogICAgICAgIC8vIGFyb3VuZCBhbiBpbnZlcnNlIGtleTog\nY2hlY2sgdG8gc2VlIGlmIHdlJ3JlIG1hcHBlZCBhcyBhIHNlY29uZGFyeQog\nICAgICAgIC8vIHRhYmxlIGpvaW4gYnV0IHdlJ3JlIGluIHRoZSB0YWJsZSBv\nZiB0aGUgcmVsYXRlZCB0eXBlLCBhbmQgaWYgc28KICAgICAgICAvLyBzd2l0\nY2ggb3VyIGpvaW4gbWFwcGluZyBpbmZvIHRvIG91ciB2YWx1ZSBtYXBwaW5n\nIGluZm8KICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gZmllbGQuZ2V0TWFw\ncGluZ0luZm8oKS5nZXRUYWJsZU5hbWUoKTsKICAgICAgICBUYWJsZSB0YWJs\nZSA9IGZpZWxkLmdldFR5cGVNYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAg\nICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0gZmllbGQuZ2V0VmFsdWVJbmZv\nKCk7CiAgICAgICAgaWYgKHRhYmxlTmFtZSAhPSBudWxsICYmIHRhYmxlICE9\nIG51bGwKICAgICAgICAgICAgJiYgKHRhYmxlTmFtZS5lcXVhbHNJZ25vcmVD\nYXNlKHRhYmxlLmdldE5hbWUoKSkKICAgICAgICAgICAgfHwgdGFibGVOYW1l\nLmVxdWFsc0lnbm9yZUNhc2UodGFibGUuZ2V0RnVsbE5hbWUoKSkpKSB7CiAg\nICAgICAgICAgIHZpbmZvLnNldEpvaW5EaXJlY3Rpb24oTWFwcGluZ0luZm8u\nSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAgdmluZm8uc2V0Q29sdW1ucyhm\naWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldENvbHVtbnMoKSk7CiAgICAgICAg\nICAgIGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKG51bGwp\nOwogICAgICAgICAgICBmaWVsZC5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVt\nbnMobnVsbCk7CiAgICAgICAgfQoKICAgICAgICBmaWVsZC5tYXBKb2luKGFk\nYXB0LCBmYWxzZSk7CiAgICAgICAgaWYgKGZpZWxkLmdldFR5cGVNYXBwaW5n\nKCkuaXNNYXBwZWQoKSkgewogICAgICAgICAgICBGb3JlaWduS2V5IGZrID0g\ndmluZm8uZ2V0VHlwZUpvaW4oZmllbGQsIGZpZWxkLmdldE5hbWUoKSwgdHJ1\nZSwKICAgICAgICAgICAgICAgIGFkYXB0KTsKICAgICAgICAgICAgZmllbGQu\nc2V0Rm9yZWlnbktleShmayk7CiAgICAgICAgICAgIGZpZWxkLnNldENvbHVt\nbklPKHZpbmZvLmdldENvbHVtbklPKCkpOwogICAgICAgICAgICBpZiAodmlu\nZm8uZ2V0Sm9pbkRpcmVjdGlvbigpID09IHZpbmZvLkpPSU5fSU5WRVJTRSkK\nICAgICAgICAgICAgICAgIGZpZWxkLnNldEpvaW5EaXJlY3Rpb24oZmllbGQu\nSk9JTl9JTlZFUlNFKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgUmVs\nYXRpb25TdHJhdGVnaWVzLm1hcFJlbGF0aW9uVG9Vbm1hcHBlZFBDKGZpZWxk\nLCBmaWVsZC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBhZGFwdCk7Cgog\nICAgICAgIGZpZWxkLnNldFVzZUNsYXNzQ3JpdGVyaWEoY3JpdGVyaWEpOwog\nICAgICAgIGZpZWxkLm1hcFByaW1hcnlLZXkoYWRhcHQpOwogICAgICAgIFBy\naW1hcnlLZXkgcGsgPSBmaWVsZC5nZXRUYWJsZSgpLmdldFByaW1hcnlLZXko\nKTsKICAgICAgICBpZiAoZmllbGQuaXNQcmltYXJ5S2V5KCkpIHsKICAgICAg\nICAgICAgQ29sdW1uW10gY29scyA9IGZpZWxkLmdldENvbHVtbnMoKTsKICAg\nICAgICAgICAgaWYgKHBrICE9IG51bGwgJiYgKGFkYXB0IHx8IHBrLmlzTG9n\naWNhbCgpKSkKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBway5hZGRD\nb2x1bW4oY29sc1tpXSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZpZWxkLmdl\ndERlZmluaW5nTWFwcGluZygpLnNldEpvaW5hYmxlKGNvbHNbaV0sIHRoaXMp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFwIGNvbnN0cmFpbnRzIGFmdGVy\nIHBrIHNvIHdlIGRvbid0IHJlLWluZGV4IC8gcmUtdW5pcXVlIHBrIGNvbAog\nICAgICAgIGZpZWxkLm1hcENvbnN0cmFpbnRzKGZpZWxkLmdldE5hbWUoKSwg\nYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIg\nb3VyIGRlZmluaW5nIG1hcHBpbmcgaXMgYW4gdW5qb2luZWQgc3ViY2xhc3Mg\nb2YKICAgICAqIHRoZSB0eXBlIG9mIHRoZSBnaXZlbiB2YWx1ZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGlzVHlwZVVuam9pbmVkU3ViY2xhc3Mo\nVmFsdWVNYXBwaW5nIG1hcHBlZCkgewogICAgICAgIENsYXNzTWFwcGluZyBk\nZWYgPSBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKTsKICAgICAgICBmb3Ig\nKDsgZGVmICE9IG51bGw7IGRlZiA9IGRlZi5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKSkKICAgICAgICAgICAgaWYgKGRlZiA9PSBtYXBwZWQu\nZ2V0VHlwZU1hcHBpbmcoKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBpbml0aWFsaXplKCkgewogICAgICAgIGZpZWxkLnNldFVzZXNJbnRlcm1l\nZGlhdGUodHJ1ZSk7CgogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5n\nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAg\nICAgICAgIF9ma09pZCA9IEJvb2xlYW4uVFJVRTsKICAgICAgICBlbHNlIGlm\nIChmaWVsZC5nZXRKb2luRGlyZWN0aW9uKCkgIT0gRmllbGRNYXBwaW5nLkpP\nSU5fSU5WRVJTRSkKICAgICAgICAgICAgX2ZrT2lkID0gZmllbGQuZ2V0VHlw\nZU1hcHBpbmcoKS5pc0ZvcmVpZ25LZXlPYmplY3RJZChmayk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgcmVsID0gUmVsYXRpb25TdHJhdGVnaWVzLmdl\ndFN0YXRlTWFuYWdlcgogICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVs\nZChmaWVsZC5nZXRJbmRleCgpKSwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAg\nICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpP\nSU5fSU5WRVJTRSkKICAgICAgICAgICAgdXBkYXRlSW52ZXJzZShzbSwgcmVs\nLCBzdG9yZSwgcm0pOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBSb3cg\ncm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5BQ1RJT05f\nSU5TRVJUKTsKICAgICAgICAgICAgaWYgKHJvdyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgZmllbGQuc2V0Rm9yZWlnbktleShyb3csIHJlbCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZp\nZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9IFJlbGF0aW9u\nU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgKHNtLmZl\ndGNoT2JqZWN0RmllbGQoZmllbGQuZ2V0SW5kZXgoKSksIHN0b3JlLmdldENv\nbnRleHQoKSk7CgogICAgICAgIGlmIChmaWVsZC5nZXRKb2luRGlyZWN0aW9u\nKCkgPT0gZmllbGQuSk9JTl9JTlZFUlNFKSB7CiAgICAgICAgICAgIG51bGxJ\nbnZlcnNlKHNtLCBybSk7CiAgICAgICAgICAgIHVwZGF0ZUludmVyc2Uoc20s\nIHJlbCwgc3RvcmUsIHJtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBSb3cgcm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5B\nQ1RJT05fVVBEQVRFKTsKICAgICAgICAgICAgaWYgKHJvdyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgZmllbGQuc2V0Rm9yZWlnbktleShyb3csIHJlbCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFn\nZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigp\nID09IGZpZWxkLkpPSU5fSU5WRVJTRSkgewogICAgICAgICAgICBpZiAoc20u\nZ2V0TG9hZGVkKCkuZ2V0KGZpZWxkLmdldEluZGV4KCkpKSB7CiAgICAgICAg\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9IFJlbGF0aW9uU3Ry\nYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIoc20uCiAgICAgICAgICAgICAgICAg\nICAgZmV0Y2hPYmplY3RGaWVsZChmaWVsZC5nZXRJbmRleCgpKSwgc3RvcmUu\nZ2V0Q29udGV4dCgpKTsKICAgICAgICAgICAgICAgIHVwZGF0ZUludmVyc2Uo\nc20sIHJlbCwgc3RvcmUsIHJtKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICBudWxsSW52ZXJzZShzbSwgcm0pOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGZpZWxkLmRlbGV0ZVJvdyhzbSwgc3RvcmUsIHJt\nKTsKCiAgICAgICAgICAgIC8vIGlmIG91ciBmb3JlaWduIGtleSBoYXMgYSBk\nZWxldGUgYWN0aW9uLCB3ZSBuZWVkIHRvIHNldCB0aGUKICAgICAgICAgICAg\nLy8gcmVsYXRlZCBvYmplY3Qgc28gY29uc3RyYWludHMgY2FuIGJlIGV2YWx1\nYXRlZAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9IFJl\nbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAg\nICAgIChzbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkLmdldEluZGV4KCkpLCBz\ndG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAgICAgICBpZiAocmVsICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5n\nZXRGb3JlaWduS2V5KChDbGFzc01hcHBpbmcpCiAgICAgICAgICAgICAgICAg\nICAgcmVsLmdldE1ldGFEYXRhKCkpOwogICAgICAgICAgICAgICAgaWYgKGZr\nLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RS\nSUNUKSB7CiAgICAgICAgICAgICAgICAgICAgUm93IHJvdyA9IGZpZWxkLmdl\ndFJvdyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNUSU9OX0RFTEVURSk7CiAgICAg\nICAgICAgICAgICAgICAgcm93LnNldEZvcmVpZ25LZXkoZmssIG51bGwsIHJl\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBOdWxsIGludmVyc2UgcmVsYXRpb25z\nIHRoYXQgcmVmZXJlbmNlIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBudWxsSW52ZXJzZShPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChmaWVsZC5nZXRVc2VDbGFzc0NyaXRlcmlhKCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRm9yZWlnbktleSBmayA9\nIGZpZWxkLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBDb2x1bW5JTyBpbyA9\nIGZpZWxkLmdldENvbHVtbklPKCk7CiAgICAgICAgaWYgKCFpby5pc0FueVVw\nZGF0YWJsZShmaywgdHJ1ZSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gbnVsbCBpbnZlcnNlIGlmIG5vdCBhbHJlYWR5IGVuZm9yY2VkIGJ5\nIGZrCiAgICAgICAgaWYgKGZpZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBp\nbmdzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9u\nU3RyYXRlZ2llcy51bmludmVyc2FibGUoZmllbGQpOwogICAgICAgIFJvdyBy\nb3cgPSBybS5nZXRBbGxSb3dzKGZrLmdldFRhYmxlKCksIFJvdy5BQ1RJT05f\nVVBEQVRFKTsKICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaywgaW8sIG51\nbGwpOwogICAgICAgIHJvdy53aGVyZUZvcmVpZ25LZXkoZmssIHNtKTsKICAg\nICAgICBybS5mbHVzaEFsbFJvd3Mocm93KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIHVwZGF0ZXMgdGhlIGludmVyc2UgY29sdW1ucyBv\nZiBvdXIgcmVsYXRpb24KICAgICAqIHdpdGggdGhlIGdpdmVuIG9iamVjdC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUludmVyc2UoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgT3BlbkpQQVN0YXRlTWFuYWdlciByZWwsCiAg\nICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChyZWwgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGb3JlaWduS2V5IGZr\nID0gZmllbGQuZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIENvbHVtbklPIGlv\nID0gZmllbGQuZ2V0Q29sdW1uSU8oKTsKCiAgICAgICAgaW50IGFjdGlvbjsK\nICAgICAgICBpZiAocmVsLmlzTmV3KCkgJiYgIXJlbC5pc0ZsdXNoZWQoKSkg\newogICAgICAgICAgICBpZiAoc20uaXNEZWxldGVkKCkgfHwgIWlvLmlzQW55\nSW5zZXJ0YWJsZShmaywgZmFsc2UpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBhY3Rpb24gPSBSb3cuQUNUSU9OX0lOU0VSVDsKICAg\nICAgICB9IGVsc2UgaWYgKHJlbC5pc0RlbGV0ZWQoKSkgewogICAgICAgICAg\nICBpZiAocmVsLmlzRmx1c2hlZCgpIHx8ICFzbS5pc0RlbGV0ZWQoKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYWN0aW9uID0gUm93\nLkFDVElPTl9ERUxFVEU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\naWYgKHNtLmlzRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgc20gPSBudWxs\nOwogICAgICAgICAgICBpZiAoIWlvLmlzQW55VXBkYXRhYmxlKGZrLCBzbSA9\nPSBudWxsKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nYWN0aW9uID0gUm93LkFDVElPTl9VUERBVEU7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZmllbGQuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKS5sZW5n\ndGggIT0gMSkKICAgICAgICAgICAgdGhyb3cgUmVsYXRpb25TdHJhdGVnaWVz\nLnVuaW52ZXJzYWJsZShmaWVsZCk7CgogICAgICAgIC8vIGdldCB0aGUgcm93\nIGZvciB0aGUgaW52ZXJzZSBvYmplY3Q7IHRoZSByb3cgbWlnaHQgYmUgaW4g\nYSBzZWNvbmRhcnkKICAgICAgICAvLyB0YWJsZSBpZiB0aGVyZSBpcyBhIGZp\nZWxkIGNvbnRyb2xsaW5nIHRoZSBmb3JlaWduIGtleQogICAgICAgIFJvdyBy\nb3cgPSBudWxsOwogICAgICAgIEZpZWxkTWFwcGluZ1tdIGludnMgPSBmaWVs\nZC5nZXRJbnZlcnNlTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGludnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGlu\ndnNbaV0uZ2V0TWFwcGVkQnlNZXRhRGF0YSgpID09IGZpZWxkCiAgICAgICAg\nICAgICAgICAmJiBpbnZzW2ldLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDKSB7CiAgICAgICAgICAgICAgICByb3cgPSBpbnZzW2ldLmdldFJvdyhy\nZWwsIHN0b3JlLCBybSwgYWN0aW9uKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENsYXNzTWFwcGlu\nZyByZWxNYXBwaW5nID0gZmllbGQuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAg\nICBpZiAocm93ID09IG51bGwpCiAgICAgICAgICAgIHJvdyA9IHJtLmdldFJv\ndyhyZWxNYXBwaW5nLmdldFRhYmxlKCksIGFjdGlvbiwgcmVsLCB0cnVlKTsK\nCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhbiB1cGRhdGUsIHRoaXMgbWlnaHQg\nYmUgdGhlIG9ubHkgbW9kIHRvIHRoZSByb3csIHNvCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHRoZSB3aGVyZSBjb25kaXRpb24gaXMgc2V0CiAgICAgICAgaWYg\nKGFjdGlvbiA9PSBSb3cuQUNUSU9OX1VQREFURQogICAgICAgICAgICAmJiBy\nb3cuZ2V0VGFibGUoKSA9PSByZWxNYXBwaW5nLmdldFRhYmxlKCkpCiAgICAg\nICAgICAgIHJvdy53aGVyZVByaW1hcnlLZXkocmVsKTsKCiAgICAgICAgLy8g\ndXBkYXRlIHRoZSBpbnZlcnNlIHBvaW50ZXIgd2l0aCBvdXIgb2lkIHZhbHVl\nCiAgICAgICAgcm93LnNldEZvcmVpZ25LZXkoZmssIGlvLCBzbSk7CiAgICB9\nCgogICAgcHVibGljIGludCBzdXBwb3J0c1NlbGVjdChTZWxlY3Qgc2VsLCBp\nbnQgdHlwZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsK\nICAgICAgICBpZiAodHlwZSA9PSBTZWxlY3QuVFlQRV9KT0lOTEVTUykKICAg\nICAgICAgICAgcmV0dXJuIChmaWVsZC5nZXRKb2luRGlyZWN0aW9uKCkgIT0g\nZmllbGQuSk9JTl9JTlZFUlNFCiAgICAgICAgICAgICAgICAmJiBzZWwuaXNT\nZWxlY3RlZChmaWVsZC5nZXRUYWJsZSgpKSkgPyAxIDogMDsKICAgICAgICBp\nZiAodHlwZSA9PSBTZWxlY3QuVFlQRV9UV09fUEFSVCkKICAgICAgICAgICAg\ncmV0dXJuIDE7CgogICAgICAgIC8vIGFscmVhZHkgY2FjaGVkPwogICAgICAg\nIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBz\nbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgIGlmIChzdG9yZS5nZXRDb250ZXh0KCkuZmluZENhY2hlZChvaWQsIG51\nbGwpICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAg\nICB9CgogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBmaWVsZC5nZXRJ\nbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwogICAgICAgIHN3aXRjaCAodHlw\nZSkgewogICAgICAgICAgICBjYXNlIFNlbGVjdC5FQUdFUl9QQVJBTExFTDoK\nICAgICAgICAgICAgICAgIHJldHVybiBjbHNzLmxlbmd0aDsKICAgICAgICAg\nICAgY2FzZSBTZWxlY3QuRUFHRVJfT1VURVI6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gKGNsc3MubGVuZ3RoID09IDEgJiYgc3RvcmUuZ2V0REJEaWN0aW9u\nYXJ5KCkuY2FuT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAgICAgKHNlbC5n\nZXRKb2luU3ludGF4KCksIGZpZWxkLmdldEZvcmVpZ25LZXkoY2xzc1swXSkp\nKSA/IDEgOgogICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgIGNh\nc2UgU2VsZWN0LkVBR0VSX0lOTkVSOgogICAgICAgICAgICAgICAgcmV0dXJu\nIChjbHNzLmxlbmd0aCA9PSAxKSA/IDEgOiAwOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdEVhZ2VyUGFyYWxsZWwoU2VsZWN0\nRXhlY3V0b3Igc2VsLAogICAgICAgIGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBmaW5hbCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBmaW5hbCBpbnQgZWFnZXJN\nb2RlKSB7CiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5nW10gY2xzcyA9IGZp\nZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAgICAgaWYg\nKCEoc2VsIGluc3RhbmNlb2YgVW5pb24pKQogICAgICAgICAgICBzZWxlY3RF\nYWdlclBhcmFsbGVsKChTZWxlY3QpIHNlbCwgY2xzc1swXSwgc3RvcmUsIGZl\ndGNoLCBlYWdlck1vZGUpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBV\nbmlvbiB1bmlvbiA9IChVbmlvbikgc2VsOwogICAgICAgICAgICBpZiAoZmV0\nY2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUgKGZpZWxkLmdldFR5cGVNYXBwaW5n\nKCkpIAogICAgICAgICAgICAgICAgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbi5FQUdFUl9KT0lOKQogICAgICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlv\nbigpOwogICAgICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVj\ndG9yKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNl\nbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxl\nY3RFYWdlclBhcmFsbGVsKHNlbCwgY2xzc1tpZHhdLCBzdG9yZSwgZmV0Y2gs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVhZ2VyTW9kZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBlcmZvcm0gYW4gZWFnZXIgcGFyYWxsZWwgc2VsZWN0\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0RWFnZXJQYXJhbGxl\nbChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgY2xzLAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50\nIGVhZ2VyTW9kZSkgewogICAgICAgIHNlbC5zZWxlY3RQcmltYXJ5S2V5KGZp\nZWxkLmdldERlZmluaW5nTWFwcGluZygpKTsKICAgICAgICAvLyBzZXQgYSB2\nYXJpYWJsZSBuYW1lIHRoYXQgZG9lcyBub3QgY29uZmxpY3Qgd2l0aCBhbnkg\naW4gdGhlIHF1ZXJ5OwogICAgICAgIC8vIHVzaW5nIGEgdmFyaWFibGUgZ3Vh\ncmFudGVlcyB0aGF0IHRoZSBzZWxlY3RlZCBkYXRhIHdpbGwgdXNlIGRpZmZl\ncmVudAogICAgICAgIC8vIGFsaWFzZXMgYW5kIGpvaW5zIHRoYW4gYW55IGV4\naXN0aW5nIFdIRVJFIGNvbmRpdGlvbnMgb24gdGhpcyBmaWVsZAogICAgICAg\nIC8vIHRoYXQgbWlnaHQgb3RoZXJ3aXNlIGxpbWl0IHRoZSByZWxhdGlvbnMg\ndGhhdCBtYXRjaAogICAgICAgIEpvaW5zIGpvaW5zID0gc2VsLm5ld0pvaW5z\nKCkuc2V0VmFyaWFibGUoIioiKTsKICAgICAgICBlYWdlckpvaW4oam9pbnMs\nIGNscywgdHJ1ZSk7CiAgICAgICAgc2VsLnNlbGVjdChjbHMsIGZpZWxkLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUs\nIAogICAgICAgICAgICBqb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2VsZWN0RWFnZXJKb2luKFNlbGVjdCBzZWwsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgLy8g\nbGltaXQgdGhlIGVhZ2VyIG1vZGUgdG8gc2luZ2xlIG9uIHJlY3Vyc2l2ZSBl\nYWdlciBmZXRjaGluZyBiL2MKICAgICAgICAvLyBhdCB0aGlzIHBvaW50IHRo\nZSBzZWxlY3QgaGFzIGJlZW4gbW9kaWZpZWQgYW5kIGFuIGF0dGVtcHQgdG8K\nICAgICAgICAvLyBjbG9uZSBpdCBmb3IgYSB0by1tYW55IGVhZ2VyIHNlbGVj\ndCBjYW4gcmVzdWx0IGluIGEgY2xvbmUgdGhhdAogICAgICAgIC8vIHByb2R1\nY2VzIGludmFsaWQgU1FMCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IGZp\nZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKClbMF07CiAgICAgICAg\nc2VsLnNlbGVjdChjbHMsIGZpZWxkLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwg\nc3RvcmUsIGZldGNoLAogICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uLkVBR0VSX0pPSU4sCiAgICAgICAgICAgIGVhZ2VySm9pbihzZWwubmV3\nSm9pbnMoKSwgY2xzLCBmYWxzZSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIHRoZSBqb2lucyBuZWVkZWQgdG8gc2VsZWN0L2xvYWQgZWFnZXIgZGF0\nYS4KICAgICAqLwogICAgcHJpdmF0ZSBKb2lucyBlYWdlckpvaW4oSm9pbnMg\nam9pbnMsIENsYXNzTWFwcGluZyBjbHMsIGJvb2xlYW4gZm9yY2VJbm5lcikg\newogICAgICAgIGJvb2xlYW4gaW52ZXJzZSA9IGZpZWxkLmdldEpvaW5EaXJl\nY3Rpb24oKSA9PSBmaWVsZC5KT0lOX0lOVkVSU0U7CiAgICAgICAgaWYgKCFp\nbnZlcnNlKSB7CiAgICAgICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZmFs\nc2UpOwogICAgICAgICAgICBqb2lucyA9IHNldEVtYmVkZGVkVmFyaWFibGUo\nam9pbnMpOwogICAgICAgIH0KCiAgICAgICAgLy8gYW5kIGpvaW4gaW50byBy\nZWxhdGlvbgogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5nZXRGb3Jl\naWduS2V5KGNscyk7CiAgICAgICAgaWYgKCFmb3JjZUlubmVyICYmIGZpZWxk\nLmdldE51bGxWYWx1ZSgpICE9IEZpZWxkTWFwcGluZy5OVUxMX0VYQ0VQVElP\nTikKICAgICAgICAgICAgcmV0dXJuIGpvaW5zLm91dGVySm9pblJlbGF0aW9u\nKGZpZWxkLmdldE5hbWUoKSwgZmssIGZpZWxkLgogICAgICAgICAgICAgICAg\nZ2V0VHlwZU1hcHBpbmcoKSwgZmllbGQuZ2V0U2VsZWN0U3ViY2xhc3Nlcygp\nLCBpbnZlcnNlLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5S\nZWxhdGlvbihmaWVsZC5nZXROYW1lKCksIGZrLCBmaWVsZC5nZXRUeXBlTWFw\ncGluZygpLCAKICAgICAgICAgICAgZmllbGQuZ2V0U2VsZWN0U3ViY2xhc3Nl\ncygpLCBpbnZlcnNlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nZiBqb2luaW5nIGZyb20gYW4gZW1iZWRkZWQgb3duZXIsIHVzZSB2YXJpYWJs\nZSB0byBjcmVhdGUgYSB1bmlxdWUKICAgICAqIGFsaWFzIGluIGNhc2Ugb3du\nZXIgY29udGFpbnMgb3RoZXIgc2FtZS10eXBlZCBlbWJlZGRlZCByZWxhdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgSm9pbnMgc2V0RW1iZWRkZWRWYXJp\nYWJsZShKb2lucyBqb2lucykgewogICAgICAgIGlmIChmaWVsZC5nZXREZWZp\nbmluZ01ldGFEYXRhKCkuZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gam9pbnM7CiAgICAgICAgcmV0dXJuIGpv\naW5zLnNldFZhcmlhYmxlKGZpZWxkLmdldERlZmluaW5nTWV0YURhdGEoKS4K\nICAgICAgICAgICAgZ2V0RW1iZWRkaW5nTWV0YURhdGEoKS5nZXRGaWVsZE1l\ndGFEYXRhKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNl\nbGVjdChTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIGlmIChmaWVsZC5nZXRK\nb2luRGlyZWN0aW9uKCkgPT0gZmllbGQuSk9JTl9JTlZFUlNFKQogICAgICAg\nICAgICByZXR1cm4gLTE7CiAgICAgICAgLy8gYWxyZWFkeSBjYWNoZWQgb2lk\nPwogICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmdldEludGVybWVkaWF0\nZShmaWVsZC5nZXRJbmRleCgpKSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gLTE7CiAgICAgICAgaWYgKCFCb29sZWFuLlRSVUUuZXF1YWxzKF9ma09p\nZCkpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBzZWwuc2VsZWN0\nKGZpZWxkLmdldENvbHVtbnMoKSwgZmllbGQuam9pbihzZWwpKTsKICAgICAg\nICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRFYWdl\nclBhcmFsbGVsKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBz\ndG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3QgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIC8vIHByb2Nlc3MgYmF0Y2hlZCByZXN1bHRzIGlmIHdlIGhhdmVuJ3Qg\nYWxyZWFkeQogICAgICAgIE1hcCByZWxzOwogICAgICAgIGlmIChyZXMgaW5z\ndGFuY2VvZiBSZXN1bHQpCiAgICAgICAgICAgIHJlbHMgPSBwcm9jZXNzRWFn\nZXJQYXJhbGxlbFJlc3VsdChzbSwgc3RvcmUsIGZldGNoLCAoUmVzdWx0KSBy\nZXMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVscyA9IChNYXApIHJl\nczsKCiAgICAgICAgLy8gc3RvcmUgb2JqZWN0IGZvciB0aGlzIG9pZCBpbiBp\nbnN0YW5jZQogICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4\nKCksIHJlbHMucmVtb3ZlKHNtLmdldE9iamVjdElkKCkpKTsKICAgICAgICBy\nZXR1cm4gcmVsczsKICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3MgdGhl\nIGdpdmVuIGJhdGNoZWQgcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIE1h\ncCBwcm9jZXNzRWFnZXJQYXJhbGxlbFJlc3VsdChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcykKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBkbyBzYW1lIGpvaW5zIGFzIGZv\nciBsb2FkCiAgICAgICAgLy8jIyMgY2hlYXQ6IHdlIGtub3cgdHlwaWNhbCBy\nZXN1bHQgam9pbnMgb25seSBjYXJlIGFib3V0IHRoZSByZWxhdGlvbgogICAg\nICAgIC8vIyMjIHBhdGg7IHRodXMgd2UgY2FuIGlnbm9yZSBkaWZmZXJlbnQg\nbWFwcGluZ3MKICAgICAgICBDbGFzc01hcHBpbmdbXSBjbHNzID0gZmllbGQu\nZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAgICAgICBKb2lucyBq\nb2lucyA9IHJlcy5uZXdKb2lucygpLnNldFZhcmlhYmxlKCIqIik7CiAgICAg\nICAgZWFnZXJKb2luKGpvaW5zLCBjbHNzWzBdLCB0cnVlKTsKCiAgICAgICAg\nTWFwIHJlbHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIENsYXNzTWFwcGlu\nZyBvd25lciA9IGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpOwogICAgICAg\nIENsYXNzTWFwcGluZyBjbHM7CiAgICAgICAgT2JqZWN0IG9pZDsKICAgICAg\nICB3aGlsZSAocmVzLm5leHQoKSkgewogICAgICAgICAgICBjbHMgPSByZXMu\nZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICAgICAgaWYgKGNscyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgY2xzID0gY2xzc1swXTsKICAgICAgICAgICAg\nb2lkID0gb3duZXIuZ2V0T2JqZWN0SWQoc3RvcmUsIHJlcywgbnVsbCwgdHJ1\nZSwgbnVsbCk7CiAgICAgICAgICAgIHJlbHMucHV0KG9pZCwgcmVzLmxvYWQo\nY2xzLCBzdG9yZSwgZmV0Y2gsIGpvaW5zKSk7CiAgICAgICAgfQogICAgICAg\nIHJlcy5jbG9zZSgpOwoKICAgICAgICByZXR1cm4gcmVsczsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBsb2FkRWFnZXJKb2luKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSBmaWVs\nZC5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpWzBdOwogICAgICAgIHNt\nLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIHJlcy5sb2FkKGNscywg\nc3RvcmUsIGZldGNoLAogICAgICAgICAgICBlYWdlckpvaW4ocmVzLm5ld0pv\naW5zKCksIGNscywgZmFsc2UpKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0\nIHJlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpPSU5fSU5W\nRVJTRSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vIGNhY2hlZCBv\naWQ/CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0SW50ZXJtZWRp\nYXRlKGZpZWxkLmdldEluZGV4KCkpICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBpZiAoIUJvb2xlYW4uVFJVRS5lcXVhbHMoX2ZrT2lk\nKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICghcmVzLmNvbnRh\naW5zQWxsKGZpZWxkLmdldENvbHVtbnMoKSkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gZ2V0IHRoZSByZWxhdGVkIG9iamVjdCdzIG9pZAog\nICAgICAgIENsYXNzTWFwcGluZyByZWxNYXBwaW5nID0gZmllbGQuZ2V0VHlw\nZU1hcHBpbmcoKTsKICAgICAgICBPYmplY3Qgb2lkID0gbnVsbDsKICAgICAg\nICBpZiAocmVsTWFwcGluZy5pc01hcHBlZCgpKSB7CiAgICAgICAgICAgIG9p\nZCA9IHJlbE1hcHBpbmcuZ2V0T2JqZWN0SWQoc3RvcmUsIHJlcywgZmllbGQu\nZ2V0Rm9yZWlnbktleSgpLAogICAgICAgICAgICAgICAgZmllbGQuZ2V0UG9s\neW1vcnBoaWMoKSAhPSBWYWx1ZU1hcHBpbmcuUE9MWV9GQUxTRSwgbnVsbCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgQ29sdW1uW10gY29scyA9\nIGZpZWxkLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgaWYgKHJlbE1hcHBp\nbmcuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0RBVEFT\nVE9SRSkgewogICAgICAgICAgICAgICAgbG9uZyBpZCA9IHJlcy5nZXRMb25n\nKGNvbHNbMF0pOwogICAgICAgICAgICAgICAgaWYgKCFyZXMud2FzTnVsbCgp\nKQogICAgICAgICAgICAgICAgICAgIG9pZCA9IHN0b3JlLm5ld0RhdGFTdG9y\nZUlkKGlkLCByZWxNYXBwaW5nLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNl\nIHsgCiAgICAgICAgICAgICAgICAvLyBhcHBsaWNhdGlvbiBpZAogICAgICAg\nICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgdmFsID0gcmVzLmdldE9iamVjdChjb2xzWzBdLCBu\ndWxsLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIG9pZCA9IEFwcGxpY2F0aW9u\nSWRzLmZyb21QS1ZhbHVlcyhuZXcgT2JqZWN0W117IHZhbCB9LAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcmVsTWFwcGluZyk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIE9iamVjdFtdIHZh\nbHMgPSBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsc1tpXSA9IHJlcy5nZXRPYmpl\nY3QoY29sc1tpXSwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICh2YWxzW2ldID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkg\nPT0gY29scy5sZW5ndGggLSAxKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgb2lkID0gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKHZhbHMsIHJl\nbE1hcHBpbmcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG9p\nZCA9PSBudWxsKQogICAgICAgICAgICBzbS5zdG9yZU9iamVjdChmaWVsZC5n\nZXRJbmRleCgpLCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNt\nLnNldEludGVybWVkaWF0ZShmaWVsZC5nZXRJbmRleCgpLCBvaWQpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoZmluYWwgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgZmluYWwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIGZpbmFs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gY2hlY2sgZm9yIGNhY2hlZCBv\naWQgdmFsdWUsIG9yIGxvYWQgb2lkIGlmIG5vIHdheSB0byBqb2luCiAgICAg\nICAgaWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMoX2ZrT2lkKSkgewogICAgICAg\nICAgICBPYmplY3Qgb2lkID0gc20uZ2V0SW50ZXJtZWRpYXRlKGZpZWxkLmdl\ndEluZGV4KCkpOwogICAgICAgICAgICBpZiAob2lkICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIE9iamVjdCB2YWwgPSBzdG9yZS5maW5kKG9pZCwgZmll\nbGQsIGZldGNoKTsKICAgICAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZp\nZWxkLmdldEluZGV4KCksIHZhbCk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpbmFsIENsYXNz\nTWFwcGluZ1tdIHJlbHMgPSBmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVNYXBw\naW5ncygpOwogICAgICAgIGZpbmFsIGludCBzdWJzID0gZmllbGQuZ2V0U2Vs\nZWN0U3ViY2xhc3NlcygpOwogICAgICAgIGZpbmFsIEpvaW5zW10gcmVzSm9p\nbnMgPSBuZXcgSm9pbnNbcmVscy5sZW5ndGhdOwoKICAgICAgICAvLyBzZWxl\nY3QgcmVsYXRlZCBtYXBwaW5nIGNvbHVtbnM7IGpvaW5pbmcgZnJvbSB0aGUg\ncmVsYXRlZCB0eXBlCiAgICAgICAgLy8gYmFjayB0byBvdXIgZmsgdGFibGUg\naWYgbm90IGFuIGludmVyc2UgbWFwcGluZyAoaW4gd2hpY2ggY2FzZSB3ZQog\nICAgICAgIC8vIGNhbiBqdXN0IG1ha2Ugc3VyZSB0aGUgaW52ZXJzZSBjb2xz\nID09IG91ciBwayB2YWx1ZXMpCiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9y\nZS5nZXRTUUxGYWN0b3J5KCkubmV3VW5pb24ocmVscy5sZW5ndGgpOwogICAg\nICAgIHVuaW9uLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwog\nICAgICAgIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShmaWVsZC5n\nZXRUeXBlTWFwcGluZygpKQogICAgICAgICAgICAhPSBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uLkVBR0VSX0pPSU4pCiAgICAgICAgICAgIHVuaW9uLmFib3J0\nVW5pb24oKTsKICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVj\ndG9yKCkgewogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0\nIHNlbCwgaW50IGlkeCkgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdl\ndEpvaW5EaXJlY3Rpb24oKSA9PSBmaWVsZC5KT0lOX0lOVkVSU0UpCiAgICAg\nICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRG\nb3JlaWduS2V5KHJlbHNbaWR4XSksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLmdldE9iamVjdElkKCksIGZpZWxkLmdldERlZmluaW5nTWFwcGluZygp\nLCBzdG9yZSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICByZXNKb2luc1tpZHhdID0gc2VsLm5ld0pvaW5zKCkuam9pblJl\nbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgZmllbGQuZ2V0Rm9yZWlnbktleShyZWxzW2lkeF0pLCByZWxzW2lkeF0s\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldFNlbGVjdFN1YmNs\nYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBm\naWVsZC53aGVyZVByaW1hcnlLZXkoc2VsLCBzbSwgc3RvcmUpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VsLnNlbGVjdChyZWxzW2lk\neF0sIHN1YnMsIHN0b3JlLCBmZXRjaCwgZmV0Y2guRUFHRVJfSk9JTiwgCiAg\nICAgICAgICAgICAgICAgICAgcmVzSm9pbnNbaWR4XSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9KTsKCiAgICAgICAgUmVzdWx0IHJlcyA9IHVuaW9uLmV4\nZWN1dGUoc3RvcmUsIGZldGNoKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBPYmplY3QgdmFsID0gbnVsbDsKICAgICAgICAgICAgaWYgKHJlcy5uZXh0\nKCkpCiAgICAgICAgICAgICAgICB2YWwgPSByZXMubG9hZChyZWxzW3Jlcy5p\nbmRleE9mKCldLCBzdG9yZSwgZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAg\ncmVzSm9pbnNbcmVzLmluZGV4T2YoKV0pOwogICAgICAgICAgICBzbS5zdG9y\nZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0b3JlVmFsdWUoT2JqZWN0\nIHZhbCwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIFJlbGF0\naW9uU3RyYXRlZ2llcy50b0RhdGFTdG9yZVZhbHVlKGZpZWxkLCB2YWwsIHN0\nb3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc051bGwoU1FM\nQnVmZmVyIHNxbCwgU2VsZWN0IHNlbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICAvLyBpZiBubyBpbnZlcnNlLCBqdXN0IGpvaW4gdG8gbWFwcGluZydzIHRh\nYmxlICh1c3VhbGx5IGEgbm8tb3AKICAgICAgICAvLyBiZWNhdXNlIGl0J2xs\nIGJlIGluIHRoZSBwcmltYXJ5IHRhYmxlKSBhbmQgc2VlIGlmIGZrIGNvbHMg\nYXJlIG51bGw7CiAgICAgICAgLy8gaWYgaW52ZXJzZSwgdGhlbiB3ZSBoYXZl\nIHRvIGRvIGEgc3ViLXNlbGVjdCB0byBzZWUgaWYgYW55IGludmVyc2UKICAg\nICAgICAvLyBvYmplY3RzIHBvaW50IGJhY2sgdG8gdGhpcyBmaWVsZCdzIG93\nbmVyCiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5EaXJlY3Rpb24oKSAhPSBm\naWVsZC5KT0lOX0lOVkVSU0UpIHsKICAgICAgICAgICAgLy8jIyMgcHJvYmFi\nbHkgbmVlZCBzb21lIHNvcnQgb2Ygc3Vic2VsZWN0IGhlcmUgb24gZmsgY29u\nc3RhbnRzCiAgICAgICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZmFsc2Up\nOwogICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gZmllbGQuZ2V0Q29sdW1u\ncygpOwogICAgICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIjEgPD4gMSIpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5B\nbGlhcyhjb2xzWzBdLCBqb2lucykpLgogICAgICAgICAgICAgICAgICAgIGFw\ncGVuZCgiIElTICIpLmFwcGVuZFZhbHVlKG51bGwsIGNvbHNbMF0pOwogICAg\nICAgIH0gZWxzZQogICAgICAgICAgICB0ZXN0SW52ZXJzZU51bGwoc3FsLCBz\nZWwsIGpvaW5zLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBl\nbmRJc05vdE51bGwoU1FMQnVmZmVyIHNxbCwgU2VsZWN0IHNlbCwgSm9pbnMg\nam9pbnMpIHsKICAgICAgICAvLyBpZiBubyBpbnZlcnNlLCBqdXN0IGpvaW4g\ndG8gbWFwcGluZydzIHRhYmxlICh1c3VhbGx5IGEgbm8tb3AKICAgICAgICAv\nLyBiZWNhdXNlIGl0J2xsIGJlIGluIHRoZSBwcmltYXJ5IHRhYmxlKSBhbmQg\nc2VlIGlmIGZrIGNvbHMgYXJlbid0CiAgICAgICAgLy8gbnVsbDsgaWYgaW52\nZXJzZSwgdGhlbiB3ZSBoYXZlIHRvIGRvIGEgc3ViLXNlbGVjdCB0byBzZWUg\naWYgYW55CiAgICAgICAgLy8gaW52ZXJzZSBvYmplY3RzIHBvaW50IGJhY2sg\ndG8gdGhpcyBmaWVsZCdzIG93bmVyCiAgICAgICAgaWYgKGZpZWxkLmdldEpv\naW5EaXJlY3Rpb24oKSAhPSBmaWVsZC5KT0lOX0lOVkVSU0UpIHsKICAgICAg\nICAgICAgLy8jIyMgcHJvYmFibHkgbmVlZCBzb21lIHNvcnQgb2Ygc3Vic2Vs\nZWN0IGhlcmUgb24gZmsgY29uc3RhbnRzCiAgICAgICAgICAgIGpvaW5zID0g\nam9pbihqb2lucywgZmFsc2UpOwogICAgICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gZmllbGQuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICBpZiAoY29scy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIjEgPSAx\nIik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNxbC5hcHBl\nbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbMF0sIGpvaW5zKSkuCiAgICAg\nICAgICAgICAgICAgICAgYXBwZW5kKCIgSVMgTk9UICIpLmFwcGVuZFZhbHVl\nKG51bGwsIGNvbHNbMF0pOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICB0\nZXN0SW52ZXJzZU51bGwoc3FsLCBzZWwsIGpvaW5zLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBcHBlbmQgU1FMIGZvciBhIHN1Yi1zZWxlY3Qg\ndGVzdGluZyB3aGV0aGVyIGFuIGludmVyc2Ugb2JqZWN0IGV4aXN0cwogICAg\nICogZm9yIHRoaXMgcmVsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB0ZXN0SW52ZXJzZU51bGwoU1FMQnVmZmVyIHNxbCwgU2VsZWN0IHNlbCwg\nSm9pbnMgam9pbnMsCiAgICAgICAgYm9vbGVhbiBlbXB0eSkgewogICAgICAg\nIERCRGljdGlvbmFyeSBkaWN0ID0gZmllbGQuZ2V0TWFwcGluZ1JlcG9zaXRv\ncnkoKS5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBkaWN0LmFzc2VydFN1\ncHBvcnQoZGljdC5zdXBwb3J0c1N1YnNlbGVjdCwgIlN1cHBvcnRzU3Vic2Vs\nZWN0Iik7CgogICAgICAgIGlmIChmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVN\nYXBwaW5ncygpLmxlbmd0aCAhPSAxKQogICAgICAgICAgICB0aHJvdyBSZWxh\ndGlvblN0cmF0ZWdpZXMudW5pbnZlcnNhYmxlKGZpZWxkKTsKCiAgICAgICAg\naWYgKGVtcHR5KQogICAgICAgICAgICBzcWwuYXBwZW5kKCIwID0gIik7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzcWwuYXBwZW5kKCIwIDwgIik7Cgog\nICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5nZXRGb3JlaWduS2V5KCk7\nCiAgICAgICAgQ29udGFpbmVyRmllbGRTdHJhdGVneS5hcHBlbmRKb2luQ291\nbnQoc3FsLCBzZWwsIGpvaW5zLCBkaWN0LCBmaWVsZCwKICAgICAgICAgICAg\nZmspOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEpvaW5zIGpvaW5z\nLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsKICAgICAgICAvLyBpZiB3ZSdyZSBu\nb3QgaW4gYW4gaW52ZXJzZSBvYmplY3QgdGFibGUgam9pbiBub3JtYWxseSwg\nb3RoZXJ3aXNlCiAgICAgICAgLy8gYWxyZWFkeSB0cmF2ZXJzZWQgdGhlIHJl\nbGF0aW9uOyBqdXN0IGpvaW4gYmFjayB0byBvd25lciB0YWJsZQogICAgICAg\nIGlmIChmaWVsZC5nZXRKb2luRGlyZWN0aW9uKCkgIT0gZmllbGQuSk9JTl9J\nTlZFUlNFKQogICAgICAgICAgICByZXR1cm4gZmllbGQuam9pbihqb2lucywg\nZm9yY2VPdXRlciwgZmFsc2UpOwogICAgICAgIENsYXNzTWFwcGluZ1tdIGNs\nc3MgPSBmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwogICAg\nICAgIGlmIChjbHNzLmxlbmd0aCAhPSAxKQogICAgICAgICAgICB0aHJvdyBS\nZWxhdGlvblN0cmF0ZWdpZXMudW5pbnZlcnNhYmxlKGZpZWxkKTsKICAgICAg\nICBpZiAoZm9yY2VPdXRlcikKICAgICAgICAgICAgcmV0dXJuIGpvaW5zLm91\ndGVySm9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIGZpZWxkLmdldEZvcmVpZ25LZXkoKSwgY2xzc1swXSwgZmllbGQuZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpLCAKICAgICAgICAgICAgICAgIHRydWUsIGZh\nbHNlKTsKICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxk\nLmdldE5hbWUoKSwgZmllbGQuZ2V0Rm9yZWlnbktleSgpLAogICAgICAgICAg\nICBjbHNzWzBdLCBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIHRydWUs\nIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9u\nKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsCiAgICAgICAgYm9v\nbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIC8vIGlmIHRoaXMgaXMgYW4gaW52\nZXJzZSBtYXBwaW5nIGl0J3MgYWxyZWFkeSBqb2luZWQgdG8gdGhlIHJlbGF0\naW9uCiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5EaXJlY3Rpb24oKSA9PSBm\naWVsZC5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAgIHJldHVybiBqb2luczsK\nICAgICAgICBDbGFzc01hcHBpbmdbXSBjbHNzID0gZmllbGQuZ2V0SW5kZXBl\nbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAgICAgICBpZiAoY2xzcy5sZW5ndGgg\nIT0gMSkgewogICAgICAgICAgICBpZiAodHJhdmVyc2UpCiAgICAgICAgICAg\nICAgICB0aHJvdyBSZWxhdGlvblN0cmF0ZWdpZXMudW5qb2luYWJsZShmaWVs\nZCk7CiAgICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICB9CgogICAg\nICAgIGpvaW5zID0gc2V0RW1iZWRkZWRWYXJpYWJsZShqb2lucyk7CiAgICAg\nICAgaWYgKGZvcmNlT3V0ZXIpCiAgICAgICAgICAgIHJldHVybiBqb2lucy5v\ndXRlckpvaW5SZWxhdGlvbihmaWVsZC5nZXROYW1lKCksIAogICAgICAgICAg\nICAgICAgZmllbGQuZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwgY2xzc1swXSwg\nCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCks\nIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5SZWxh\ndGlvbihmaWVsZC5nZXROYW1lKCksIGZpZWxkLmdldEZvcmVpZ25LZXkoY2xz\nc1swXSksCiAgICAgICAgICAgIGNsc3NbMF0sIGZpZWxkLmdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEpvaW5hYmxlIGltcGxlbWVu\ndGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgaW50IGdldEZpZWxkSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIGZp\nZWxkLmdldEluZGV4KCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRQ\ncmltYXJ5S2V5VmFsdWUoUmVzdWx0IHJlcywgQ29sdW1uW10gY29scywgRm9y\nZWlnbktleSBmaywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpvaW5zIGpv\naW5zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENs\nYXNzTWFwcGluZyByZWxtYXBwaW5nID0gZmllbGQuZ2V0VHlwZU1hcHBpbmco\nKTsKICAgICAgICBpZiAocmVsbWFwcGluZy5nZXRJZGVudGl0eVR5cGUoKSA9\nPSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAgIENv\nbHVtbiBjb2wgPSBjb2xzWzBdOwogICAgICAgICAgICBpZiAoZmsgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGNvbCA9IGZrLmdldENvbHVtbihjb2wpOyAg\nIAogICAgICAgICAgICBsb25nIGlkID0gcmVzLmdldExvbmcoY29sLCBqb2lu\ncyk7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRPYmplY3RJZEZpZWxkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuTE9ORykKICAgICAgICAgICAgICAgIHJl\ndHVybiBOdW1iZXJzLnZhbHVlT2YoaWQpOwogICAgICAgICAgICByZXR1cm4g\nc3RvcmUubmV3RGF0YVN0b3JlSWQoaWQsIHJlbG1hcHBpbmcsIGZpZWxkLmdl\ndFBvbHltb3JwaGljKCkgCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1hcHBp\nbmcuUE9MWV9GQUxTRSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVsbWFw\ncGluZy5pc09wZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICByZXR1cm4g\nKChKb2luYWJsZSkgcmVsbWFwcGluZy5nZXRQcmltYXJ5S2V5RmllbGRNYXBw\naW5ncygpWzBdLgogICAgICAgICAgICAgICAgZ2V0U3RyYXRlZ3koKSkuZ2V0\nUHJpbWFyeUtleVZhbHVlKHJlcywgY29scywgZmssIHN0b3JlLCBqb2lucyk7\nCgogICAgICAgIGlmIChjb2xzID09IGdldENvbHVtbnMoKSAmJiBmayA9PSBu\ndWxsKQogICAgICAgICAgICBmayA9IGZpZWxkLmdldEZvcmVpZ25LZXkoKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGZrID0gY3JlYXRlVHJhbnNsYXRp\nbmdGb3JlaWduS2V5KHJlbG1hcHBpbmcsIGNvbHMsIGZrKTsgCiAgICAgICAg\ncmV0dXJuIHJlbG1hcHBpbmcuZ2V0T2JqZWN0SWQoc3RvcmUsIHJlcywgZmss\nCiAgICAgICAgICAgIGZpZWxkLmdldFBvbHltb3JwaGljKCkgIT0gVmFsdWVN\nYXBwaW5nLlBPTFlfRkFMU0UsIGpvaW5zKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhIGZhdXggZm9yZWlnbiBrZXkgdGhhdCB0cmFuc2xhdGVz\nIGJldHdlZW4gdGhlIGNvbHVtbnMgdG8gcHVsbAogICAgICogdGhlIGRhdGEg\nZnJvbSBhbmQgb3VyIHJlbGF0ZWQgdHlwZSdzIHByaW1hcnkga2V5IGNvbHVt\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgRm9yZWlnbktleSBjcmVhdGVUcmFu\nc2xhdGluZ0ZvcmVpZ25LZXkoQ2xhc3NNYXBwaW5nIHJlbG1hcHBpbmcsCiAg\nICAgICAgQ29sdW1uW10gZ2NvbHMsIEZvcmVpZ25LZXkgZ2ZrKSB7CiAgICAg\nICAgRm9yZWlnbktleSBmayA9IGZpZWxkLmdldEZvcmVpZ25LZXkoKTsgCiAg\nICAgICAgQ29sdW1uW10gY29scyA9IGZrLmdldENvbHVtbnMoKTsKCiAgICAg\nICAgRm9yZWlnbktleSB0ZmsgPSBudWxsOwogICAgICAgIENvbHVtbiB0Y29s\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZ2NvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgdGNvbCA9IGdjb2xzW2ldOwogICAgICAgICAg\nICBpZiAoZ2ZrICE9IG51bGwpCiAgICAgICAgICAgICAgICB0Y29sID0gZ2Zr\nLmdldENvbHVtbih0Y29sKTsKICAgICAgICAgICAgaWYgKHRmayA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGZrID0gbmV3IEZvcmVpZ25LZXkobnVsbCwg\ndGNvbC5nZXRUYWJsZSgpKTsKICAgICAgICAgICAgdGZrLmpvaW4odGNvbCwg\nZmsuZ2V0UHJpbWFyeUtleUNvbHVtbihjb2xzW2ldKSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0Zms7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBn\nZXRKb2luVmFsdWUoT2JqZWN0IGZpZWxkVmFsLCBDb2x1bW4gY29sLCBKREJD\nU3RvcmUgc3RvcmUpIHsKICAgICAgICBPYmplY3QgbyA9IGZpZWxkLmdldEZv\ncmVpZ25LZXkoKS5nZXRDb25zdGFudChjb2wpOwogICAgICAgIGlmIChvICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBvOwogICAgICAgIGNvbCA9IGZp\nZWxkLmdldEZvcmVpZ25LZXkoKS5nZXRQcmltYXJ5S2V5Q29sdW1uKGNvbCk7\nCiAgICAgICAgaWYgKGNvbCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHJlbG1hcHBpbmcgPSBmaWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAg\nIEpvaW5hYmxlIGogPSBmaWVsZC5nZXRUeXBlTWFwcGluZygpLmFzc2VydEpv\naW5hYmxlKGNvbCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2Vh\nYmxlKGZpZWxkVmFsKSkKICAgICAgICAgICAgZmllbGRWYWwgPSBzdG9yZS5n\nZXRDb250ZXh0KCkuZ2V0T2JqZWN0SWQoZmllbGRWYWwpOwogICAgICAgIGlm\nIChmaWVsZFZhbCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAgICAgICAg\nZmllbGRWYWwgPSAoKE9wZW5KUEFJZCkgZmllbGRWYWwpLmdldElkT2JqZWN0\nKCk7CiAgICAgICAgZWxzZSBpZiAocmVsbWFwcGluZy5nZXRPYmplY3RJZFR5\ncGUoKSAhPSBudWxsCiAgICAgICAgICAgICYmIHJlbG1hcHBpbmcuZ2V0T2Jq\nZWN0SWRUeXBlKCkuaXNJbnN0YW5jZShmaWVsZFZhbCkpIHsKICAgICAgICAg\nICAgT2JqZWN0W10gcGtzID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhm\naWVsZFZhbCwgcmVsbWFwcGluZyk7CiAgICAgICAgICAgIGZpZWxkVmFsID0g\ncGtzW3JlbG1hcHBpbmcuZ2V0RmllbGQoai5nZXRGaWVsZEluZGV4KCkpLgog\nICAgICAgICAgICAgICAgZ2V0UHJpbWFyeUtleUluZGV4KCldOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gai5nZXRKb2luVmFsdWUoZmllbGRWYWwsIGNv\nbCwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Sm9pblZh\nbHVlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIENvbHVtbiBjb2wsCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIGdldEpvaW5W\nYWx1ZShzbS5mZXRjaChmaWVsZC5nZXRJbmRleCgpKSwgY29sLCBzdG9yZSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0Fzc2lnbmVkVmFsdWUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAg\nICAgIENvbHVtbiBjb2wsIE9iamVjdCBhdXRvSW5jKSB7CiAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEVtYmVkZGFibGUg\naW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoKSB7CiAgICAg\nICAgcmV0dXJuIGZpZWxkLmdldENvbHVtbnMoKTsKICAgIH0KCiAgICBwdWJs\naWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAgcmV0dXJuIGZp\nZWxkLmdldENvbHVtbklPKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdFtd\nIGdldFJlc3VsdEFyZ3VtZW50cygpIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvRW1iZWRkZWREYXRhU3RvcmVW\nYWx1ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBy\nZXR1cm4gdG9EYXRhU3RvcmVWYWx1ZSh2YWwsIHN0b3JlKTsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IHRvRW1iZWRkZWRPYmplY3RWYWx1ZShPYmplY3Qg\ndmFsKSB7CiAgICAgICAgcmV0dXJuIFVOU1VQUE9SVEVEOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGxvYWRFbWJlZGRlZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgT2JqZWN0IHZhbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsTWFwcGluZyA9\nIGZpZWxkLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgT2JqZWN0IG9pZDsK\nICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIG9pZCA9IG51\nbGw7CiAgICAgICAgZWxzZSBpZiAocmVsTWFwcGluZy5nZXRJZGVudGl0eVR5\ncGUoKSA9PSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFKQogICAgICAgICAg\nICBvaWQgPSBzdG9yZS5uZXdEYXRhU3RvcmVJZCgoKE51bWJlcikgdmFsKS5s\nb25nVmFsdWUoKSwgcmVsTWFwcGluZywKICAgICAgICAgICAgICAgIGZpZWxk\nLmdldFBvbHltb3JwaGljKCkgIT0gVmFsdWVNYXBwaW5nLlBPTFlfRkFMU0Up\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBPYmplY3RbXSBwa3MgPSAo\nZ2V0Q29sdW1ucygpLmxlbmd0aCA9PSAxKSA/IG5ldyBPYmplY3RbXXsgdmFs\nIH0KICAgICAgICAgICAgICAgIDogKE9iamVjdFtdKSB2YWw7CiAgICAgICAg\nICAgIGJvb2xlYW4gbnVsbHMgPSB0cnVlOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgbnVsbHMgJiYgaSA8IHBrcy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIG51bGxzID0gcGtzW2ldID09IG51bGw7CiAgICAgICAgICAg\nIGlmIChudWxscykKICAgICAgICAgICAgICAgIG9pZCA9IG51bGw7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgb2lkID0gQXBwbGljYXRp\nb25JZHMuZnJvbVBLVmFsdWVzKHBrcywgcmVsTWFwcGluZyk7CiAgICAgICAg\nICAgICAgICBpZiAoZmllbGQuZ2V0UG9seW1vcnBoaWMoKSA9PSBWYWx1ZU1h\ncHBpbmcuUE9MWV9GQUxTRQogICAgICAgICAgICAgICAgICAgICYmIG9pZCBp\nbnN0YW5jZW9mIE9wZW5KUEFJZCkgewogICAgICAgICAgICAgICAgICAgICgo\nT3BlbkpQQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUocmVsTWFw\ncGluZy4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlw\nZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICBzbS5z\ndG9yZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCBudWxsKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHNtLnNldEludGVybWVkaWF0ZShmaWVsZC5nZXRJ\nbmRleCgpLCBvaWQpOwogICAgfQp9Cg==\n","encoding":"base64"}

