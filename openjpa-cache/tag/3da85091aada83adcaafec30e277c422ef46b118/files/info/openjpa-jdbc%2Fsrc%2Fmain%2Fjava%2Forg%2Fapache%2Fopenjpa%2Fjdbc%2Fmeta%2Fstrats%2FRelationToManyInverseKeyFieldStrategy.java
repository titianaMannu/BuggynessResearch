{"sha":"eb907e201dd8182c4512a86e32f75ff065a48604","node_id":"MDQ6QmxvYjIwNjM2NDplYjkwN2UyMDFkZDgxODJjNDUxMmE4NmUzMmY3NWZmMDY1YTQ4NjA0","size":13784,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/eb907e201dd8182c4512a86e32f75ff065a48604","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmdJbmZvOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGlu\nZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJvdzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNl\nbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQ\nQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkph\ndmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5n\nZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRl\ncm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuUHJveGllczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlByb3h5OwoKLyoqCiAqIE1hcHMgYSByZWxhdGlvbiB0byBhIHNldCBvZiBv\ndGhlciBvYmplY3RzIHVzaW5nIGFuIGludmVyc2UKICogZm9yZWlnbiBrZXkg\naW4gdGhlIHJlbGF0ZWQgb2JqZWN0IHRhYmxlLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIFJlbGF0aW9uVG9N\nYW55SW52ZXJzZUtleUZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgU3RvcmVD\nb2xsZWN0aW9uRmllbGRTdHJhdGVneSB7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChSZWxhdGlvblRvTWFueUludmVyc2VLZXlGaWVsZFN0cmF0ZWd5\nLmNsYXNzKTsKCiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVySW5zZXJ0ID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVyVXBkYXRlID0gZmFs\nc2U7CgogICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZ1tdIGdldEluZGVwZW5k\nZW50RWxlbWVudE1hcHBpbmdzKGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAg\nICByZXR1cm4gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRJbmRlcGVu\nZGVudFR5cGVNYXBwaW5ncygpOwogICAgfQoKICAgIHByb3RlY3RlZCBGb3Jl\naWduS2V5IGdldEpvaW5Gb3JlaWduS2V5KENsYXNzTWFwcGluZyBlbGVtKSB7\nCiAgICAgICAgcmV0dXJuIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0\nRm9yZWlnbktleShlbGVtKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBz\nZWxlY3RFbGVtZW50KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBlbGVtLAog\nICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgaW50IGVhZ2VyTW9kZSwKICAgICAgICBKb2lucyBqb2lucykg\newogICAgICAgIHNlbC5zZWxlY3QoZWxlbSwgZmllbGQuZ2V0RWxlbWVudE1h\ncHBpbmcoKS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAgICAgIHN0\nb3JlLCBmZXRjaCwgZWFnZXJNb2RlLCBqb2lucyk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIE9iamVjdCBsb2FkRWxlbWVudChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIGVsZW0gPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICBpZiAoZWxl\nbSA9PSBudWxsKQogICAgICAgICAgICBlbGVtID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpWzBdOwog\nICAgICAgIHJldHVybiByZXMubG9hZChlbGVtLCBzdG9yZSwgZmV0Y2gsIGpv\naW5zKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgSm9pbnMgam9pbihKb2lucyBq\nb2lucywgQ2xhc3NNYXBwaW5nIGVsZW0pIHsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgdm0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIEZv\ncmVpZ25LZXkgZmsgPSB2bS5nZXRGb3JlaWduS2V5KGVsZW0pOwogICAgICAg\nIENsYXNzTWFwcGluZyBvd25lciA9IGZpZWxkLmdldERlZmluaW5nTWFwcGlu\nZygpOwogICAgICAgIHdoaWxlIChmay5nZXRQcmltYXJ5S2V5VGFibGUoKSAh\nPSBvd25lci5nZXRUYWJsZSgpKSB7CiAgICAgICAgICAgIGpvaW5zID0gb3du\nZXIuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAg\nb3duZXIgPSBvd25lci5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKTsgCiAgICAgICAgICAgIGlmIChvd25lciA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0\nTmFtZSgpLCBmaywgZWxlbSwgCiAgICAgICAgICAgIHZtLmdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJvdGVjdGVk\nIEpvaW5zIGpvaW5FbGVtZW50UmVsYXRpb24oSm9pbnMgam9pbnMsIENsYXNz\nTWFwcGluZyBlbGVtKSB7CiAgICAgICAgcmV0dXJuIGpvaW5SZWxhdGlvbihq\nb2lucywgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBt\nYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGZpZWxkLmdldFZhbHVlSW5m\nbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsK\nICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCku\nYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAgIChmaWVsZC5n\nZXRLZXkoKSwgIWFkYXB0KTsKCiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0g\nPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGlmIChlbGVt\nLmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBDIHx8IGVsZW0uaXNFbWJl\nZGRlZFBDKCkKICAgICAgICAgICAgfHwgIWVsZW0uZ2V0VHlwZU1hcHBpbmco\nKS5pc01hcHBlZCgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbGVtLXJlbGF0aW9uIiwgZmllbGQp\nKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIG5hbWVkIGludmVyc2UKICAgICAg\nICBGaWVsZE1hcHBpbmcgbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBw\naW5nKCk7CiAgICAgICAgRmllbGRNYXBwaW5nSW5mbyBmaW5mbyA9IGZpZWxk\nLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyB2\naW5mbyA9IGVsZW0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgYm9vbGVhbiBj\ncml0ZXJpYSA9IHZpbmZvLmdldFVzZUNsYXNzQ3JpdGVyaWEoKTsKICAgICAg\nICBpZiAobWFwcGVkICE9IG51bGwpIHsKICAgICAgICAgICAgbWFwcGVkLnJl\nc29sdmUobWFwcGVkLk1PREVfTUVUQSB8IG1hcHBlZC5NT0RFX01BUFBJTkcp\nOwogICAgICAgICAgICBpZiAoIShtYXBwZWQuZ2V0U3RyYXRlZ3koKSBpbnN0\nYW5jZW9mIFJlbGF0aW9uRmllbGRTdHJhdGVneSkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1p\nbnYtcmVsYXRpb24iLAogICAgICAgICAgICAgICAgICAgIGZpZWxkLCBtYXBw\nZWQpKTsKICAgICAgICAgICAgdmluZm8uYXNzZXJ0Tm9TY2hlbWFDb21wb25l\nbnRzKGVsZW0sICFhZGFwdCk7CiAgICAgICAgICAgIGVsZW0uc2V0Rm9yZWln\nbktleShtYXBwZWQuZ2V0Rm9yZWlnbktleQogICAgICAgICAgICAgICAgKGZp\nZWxkLmdldERlZmluaW5nTWFwcGluZygpKSk7CiAgICAgICAgICAgIGVsZW0u\nc2V0Q29sdW1ucyhtYXBwZWQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuCiAgICAg\nICAgICAgICAgICBnZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICAg\nICAgZWxlbS5zZXRKb2luRGlyZWN0aW9uKFZhbHVlTWFwcGluZy5KT0lOX0VY\nUEVDVEVEX0lOVkVSU0UpOwogICAgICAgICAgICBlbGVtLnNldFVzZUNsYXNz\nQ3JpdGVyaWEoY3JpdGVyaWEpOwoKICAgICAgICAgICAgZmllbGQuc2V0T3Jk\nZXJDb2x1bW4oZmluZm8uZ2V0T3JkZXJDb2x1bW4oZmllbGQsCiAgICAgICAg\nICAgICAgICBtYXBwZWQuZ2V0Rm9yZWlnbktleSgpLmdldFRhYmxlKCksIGFk\nYXB0KSk7CiAgICAgICAgICAgIGZpZWxkLnNldE9yZGVyQ29sdW1uSU8oZmlu\nZm8uZ2V0Q29sdW1uSU8oKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIC8vIG1hcCBpbnZlcnNlIGZvcmVpZ24ga2V5IGluIHJl\nbGF0ZWQgdGFibGUKICAgICAgICBGb3JlaWduS2V5IGZrID0gdmluZm8uZ2V0\nSW52ZXJzZVR5cGVKb2luKGVsZW0sIGZpZWxkLmdldE5hbWUoKSwgYWRhcHQp\nOwogICAgICAgIGVsZW0uc2V0Rm9yZWlnbktleShmayk7CiAgICAgICAgZWxl\nbS5zZXRDb2x1bW5JTyh2aW5mby5nZXRDb2x1bW5JTygpKTsKICAgICAgICBl\nbGVtLnNldENvbHVtbnMoZWxlbS5nZXRUeXBlTWFwcGluZygpLmdldFByaW1h\ncnlLZXlDb2x1bW5zKCkpOwogICAgICAgIGVsZW0uc2V0Sm9pbkRpcmVjdGlv\nbihWYWx1ZU1hcHBpbmcuSk9JTl9FWFBFQ1RFRF9JTlZFUlNFKTsKICAgICAg\nICBlbGVtLnNldFVzZUNsYXNzQ3JpdGVyaWEoY3JpdGVyaWEpOwogICAgICAg\nIGVsZW0ubWFwQ29uc3RyYWludHMoZmllbGQuZ2V0TmFtZSgpLCBhZGFwdCk7\nCgogICAgICAgIGZpZWxkLnNldE9yZGVyQ29sdW1uKGZpbmZvLmdldE9yZGVy\nQ29sdW1uKGZpZWxkLCBmay5nZXRUYWJsZSgpLAogICAgICAgICAgICBhZGFw\ndCkpOwogICAgICAgIGZpZWxkLnNldE9yZGVyQ29sdW1uSU8oZmluZm8uZ2V0\nQ29sdW1uSU8oKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6\nZSgpIHsKICAgICAgICBDb2x1bW4gb3JkZXIgPSBmaWVsZC5nZXRPcmRlckNv\nbHVtbigpOwogICAgICAgIF9vcmRlckluc2VydCA9IGZpZWxkLmdldE9yZGVy\nQ29sdW1uSU8oKS5pc0luc2VydGFibGUob3JkZXIsIGZhbHNlKTsKICAgICAg\nICBfb3JkZXJVcGRhdGUgPSBmaWVsZC5nZXRPcmRlckNvbHVtbklPKCkuaXNV\ncGRhdGFibGUob3JkZXIsIGZhbHNlKTsKCiAgICAgICAgVmFsdWVNYXBwaW5n\nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIExv\nZyBsb2cgPSBmaWVsZC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCk7CiAgICAg\nICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgPT0gbnVsbAogICAgICAgICAg\nICAmJiBlbGVtLmdldFVzZUNsYXNzQ3JpdGVyaWEoKSAmJiBsb2cuaXNXYXJu\nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIEZvcmVpZ25LZXkgZmsgPSBlbGVt\nLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICAgICAgaWYgKGVsZW0uZ2V0Q29s\ndW1uSU8oKS5pc0FueVVwZGF0YWJsZShmaywgZmFsc2UpKQogICAgICAgICAg\nICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImNsYXNzLWNyaXQtb3duZXIiLCBm\naWVsZCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbnNl\ncnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBS\nb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpID09IG51bGwgfHwgX29y\nZGVySW5zZXJ0IHx8IF9vcmRlclVwZGF0ZSkKICAgICAgICAgICAgaW5zZXJ0\nKHNtLCBybSwgc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSkpOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgUm93TWFuYWdlciBybSwgT2JqZWN0IHZhbHMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmdldE1h\ncHBlZEJ5KCkgIT0gbnVsbCAmJiAhX29yZGVySW5zZXJ0ICYmICFfb3JkZXJV\ncGRhdGUpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBDb2xsZWN0aW9u\nIGNvbGwgPSB0b0NvbGxlY3Rpb24odmFscyk7CiAgICAgICAgaWYgKGNvbGwg\nPT0gbnVsbCB8fCBjb2xsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIGludCBpZHgg\nPSAwOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykKICAgICAgICAgICAgdXBkYXRl\nSW52ZXJzZShzbS5nZXRDb250ZXh0KCksIGl0ci5uZXh0KCksIHJlbCwgcm0s\nIHNtLCBpZHgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFn\nZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCAmJiAhX29yZGVySW5z\nZXJ0ICYmICFfb3JkZXJVcGRhdGUpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgT2JqZWN0IG9iaiA9IHNtLmZldGNoT2JqZWN0KGZpZWxkLmdldElu\nZGV4KCkpOwogICAgICAgIENoYW5nZVRyYWNrZXIgY3QgPSBudWxsOwogICAg\nICAgIGlmIChvYmogaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgICAgICBQ\ncm94eSBwcm94eSA9IChQcm94eSkgb2JqOwogICAgICAgICAgICBpZiAoUHJv\neGllcy5pc093bmVyKHByb3h5LCBzbSwgZmllbGQuZ2V0SW5kZXgoKSkpCiAg\nICAgICAgICAgICAgICBjdCA9IHByb3h5LmdldENoYW5nZVRyYWNrZXIoKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGlmIG5vIGZpbmUtZ3JhaW5lZCBjaGFu\nZ2UgdHJhY2tpbmcgdGhlbiBqdXN0IGRlbGV0ZSBhbmQgcmVpbnNlcnQKICAg\nICAgICBpZiAoY3QgPT0gbnVsbCB8fCAhY3QuaXNUcmFja2luZygpKSB7CiAg\nICAgICAgICAgIGRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgICAgICAgICAg\naW5zZXJ0KHNtLCBybSwgb2JqKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgLy8gbnVsbCBpbnZlcnNlIGNvbHVtbnMgZm9yIGRl\nbGV0ZXMgYW5kIHVwZGF0ZSB0aGVtIHdpdGggb3VyIG9pZCBmb3IKICAgICAg\nICAvLyBpbnNlcnRzCiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbCA9IGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAg\nICBTdG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgpOwogICAg\nICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpID09IG51bGwpIHsKICAgICAg\nICAgICAgQ29sbGVjdGlvbiByZW0gPSBjdC5nZXRSZW1vdmVkKCk7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcmVtLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgdXBkYXRlSW52ZXJzZShj\ndHgsIGl0ci5uZXh0KCksIHJlbCwgcm0sIG51bGwsIDApOwogICAgICAgIH0K\nCiAgICAgICAgQ29sbGVjdGlvbiBhZGQgPSBjdC5nZXRBZGRlZCgpOwogICAg\nICAgIGludCBzZXEgPSBjdC5nZXROZXh0U2VxdWVuY2UoKTsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGFkZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOyBzZXErKykKICAgICAgICAgICAgdXBkYXRlSW52ZXJzZShjdHgsIGl0\nci5uZXh0KCksIHJlbCwgcm0sIHNtLCBzZXEpOwogICAgICAgIGlmIChmaWVs\nZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgIGN0LnNl\ndE5leHRTZXF1ZW5jZShzZXEpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRl\nbGV0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiBudWxsYWJsZSwgbnVs\nbCBhbnkgZXhpc3RpbmcgaW52ZXJzZSBjb2x1bW5zIHRoYXQgcmVmZXIgdG8g\ndGhpcyBvYmoKICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgQ29sdW1uSU8gaW8gPSBlbGVt\nLmdldENvbHVtbklPKCk7CiAgICAgICAgRm9yZWlnbktleSBmayA9IGVsZW0u\nZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIGlmICghZWxlbS5nZXRVc2VDbGFz\nc0NyaXRlcmlhKCkgJiYgaW8uaXNBbnlVcGRhdGFibGUoZmssIHRydWUpKSB7\nIAogICAgICAgICAgICBhc3NlcnRJbnZlcnNhYmxlKCk7CiAgICAgICAgICAg\nIFJvdyByb3cgPSBybS5nZXRBbGxSb3dzKGZrLmdldFRhYmxlKCksIFJvdy5B\nQ1RJT05fVVBEQVRFKTsKICAgICAgICAgICAgcm93LnNldEZvcmVpZ25LZXko\nZmssIGlvLCBudWxsKTsKICAgICAgICAgICAgcm93LndoZXJlRm9yZWlnbktl\neShmaywgc20pOwogICAgICAgICAgICBybS5mbHVzaEFsbFJvd3Mocm93KTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFz\nbS5nZXRMb2FkZWQoKS5nZXQoZmllbGQuZ2V0SW5kZXgoKSkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gdXBkYXRlIGZrIG9uIGVhY2ggZmll\nbGQgdmFsdWUgcm93CiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbCA9IGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAg\nICBTdG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgpOwogICAg\nICAgIENvbGxlY3Rpb24gb2JqcyA9IHRvQ29sbGVjdGlvbihzbS5mZXRjaE9i\namVjdChmaWVsZC5nZXRJbmRleCgpKSk7CiAgICAgICAgaWYgKG9ianMgIT0g\nbnVsbCAmJiAhb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykK\nICAgICAgICAgICAgICAgIHVwZGF0ZUludmVyc2UgKGN0eCwgaXRyLm5leHQo\nKSwgcmVsLCBybSwgc20sIDApOwogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2QgdXBkYXRlcyB0aGUgaW52ZXJzZSBjb2x1bW5zIG9mIGEgMS1N\nIHJlbGF0ZWQgb2JqZWN0CiAgICAgKiB3aXRoIHRoZSBnaXZlbiBvaWQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVJbnZlcnNlKFN0b3JlQ29u\ndGV4dCBjdHgsIE9iamVjdCBpbnZlcnNlLAogICAgICAgIENsYXNzTWFwcGlu\nZyByZWwsIFJvd01hbmFnZXIgcm0sIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIGludCBpZHgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBpbnZzbSA9IFJlbGF0aW9uU3RyYXRl\nZ2llcy5nZXRTdGF0ZU1hbmFnZXIoaW52ZXJzZSwKICAgICAgICAgICAgY3R4\nKTsKICAgICAgICBpZiAoaW52c20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgRm9yZWlnbktleSBmayA9IGVsZW0u\nZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIENvbHVtbklPIGlvID0gZWxlbS5n\nZXRDb2x1bW5JTygpOwogICAgICAgIENvbHVtbiBvcmRlciA9IGZpZWxkLmdl\ndE9yZGVyQ29sdW1uKCk7CgogICAgICAgIGludCBhY3Rpb247CiAgICAgICAg\nYm9vbGVhbiB3cml0ZWFibGU7CiAgICAgICAgYm9vbGVhbiBvcmRlcldyaXRl\nYWJsZTsKICAgICAgICBpZiAoaW52c20uaXNOZXcoKSAmJiAhaW52c20uaXNG\nbHVzaGVkKCkpIHsKICAgICAgICAgICAgLy8gbm8gbmVlZCB0byBudWxsIGlu\ndmVyc2UgY29sdW1ucyBvZiBuZXcgaW5zdGFuY2UKICAgICAgICAgICAgaWYg\nKHNtID09IG51bGwgfHwgc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIHdyaXRlYWJsZSA9IGlvLmlzQW55SW5z\nZXJ0YWJsZShmaywgZmFsc2UpOwogICAgICAgICAgICBvcmRlcldyaXRlYWJs\nZSA9IF9vcmRlckluc2VydDsKICAgICAgICAgICAgYWN0aW9uID0gUm93LkFD\nVElPTl9JTlNFUlQ7CiAgICAgICAgfSBlbHNlIGlmIChpbnZzbS5pc0RlbGV0\nZWQoKSkgewogICAgICAgICAgICAvLyBubyBuZWVkIHRvIG51bGwgaW52ZXJz\nZSBjb2x1bW5zIG9mIGRlbGV0ZWQgaW5zdGFuY2UKICAgICAgICAgICAgaWYg\nKGludnNtLmlzRmx1c2hlZCgpIHx8IHNtID09IG51bGwgfHwgIXNtLmlzRGVs\nZXRlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB3\ncml0ZWFibGUgPSB0cnVlOwogICAgICAgICAgICBvcmRlcldyaXRlYWJsZSA9\nIGZhbHNlOwogICAgICAgICAgICBhY3Rpb24gPSBSb3cuQUNUSU9OX0RFTEVU\nRTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoc20gIT0gbnVs\nbCAmJiBzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgICAgIHNtID0gbnVs\nbDsKICAgICAgICAgICAgd3JpdGVhYmxlID0gaW8uaXNBbnlVcGRhdGFibGUo\nZmssIHNtID09IG51bGwpOwogICAgICAgICAgICBvcmRlcldyaXRlYWJsZSA9\nIGZpZWxkLmdldE9yZGVyQ29sdW1uSU8oKS5pc1VwZGF0YWJsZQogICAgICAg\nICAgICAgICAgKG9yZGVyLCBzbSA9PSBudWxsKTsKICAgICAgICAgICAgYWN0\naW9uID0gUm93LkFDVElPTl9VUERBVEU7CiAgICAgICAgfQogICAgICAgIGlm\nICghd3JpdGVhYmxlICYmICFvcmRlcldyaXRlYWJsZSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBhc3NlcnRJbnZlcnNhYmxlKCk7CgogICAgICAg\nIC8vIGlmIHRoaXMgaXMgYW4gdXBkYXRlLCB0aGlzIG1pZ2h0IGJlIHRoZSBv\nbmx5IG1vZCB0byB0aGUgcm93LCBzbwogICAgICAgIC8vIG1ha2Ugc3VyZSB0\naGUgd2hlcmUgY29uZGl0aW9uIGlzIHNldAogICAgICAgIFJvdyByb3cgPSBy\nbS5nZXRSb3coZmsuZ2V0VGFibGUoKSwgYWN0aW9uLCBpbnZzbSwgdHJ1ZSk7\nCiAgICAgICAgaWYgKGFjdGlvbiA9PSBSb3cuQUNUSU9OX1VQREFURSkKICAg\nICAgICAgICAgcm93LndoZXJlUHJpbWFyeUtleShpbnZzbSk7CgogICAgICAg\nIC8vIHVwZGF0ZSB0aGUgaW52ZXJzZSBwb2ludGVyIHdpdGggb3VyIG9pZCB2\nYWx1ZQogICAgICAgIGlmICh3cml0ZWFibGUpCiAgICAgICAgICAgIHJvdy5z\nZXRGb3JlaWduS2V5KGZrLCBpbywgc20pOwogICAgICAgIGlmIChvcmRlcldy\naXRlYWJsZSkKICAgICAgICAgICAgcm93LnNldEludChvcmRlciwgaWR4KTsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0b3JlVmFsdWUoT2Jq\nZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgQ2xhc3NNYXBw\naW5nIGNtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRUeXBlTWFw\ncGluZygpOwogICAgICAgIHJldHVybiBjbS50b0RhdGFTdG9yZVZhbHVlKHZh\nbCwgY20uZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwgc3RvcmUpOwogICAgfQoK\nICAgIHB1YmxpYyBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBib29sZWFuIGZv\ncmNlT3V0ZXIpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10g\nY2xzcyA9IGVsZW0uZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAg\nICAgICBpZiAoY2xzcy5sZW5ndGggIT0gMSkKICAgICAgICAgICAgdGhyb3cg\nUmVsYXRpb25TdHJhdGVnaWVzLnVuam9pbmFibGUoZWxlbSk7CiAgICAgICAg\naWYgKGZvcmNlT3V0ZXIpCiAgICAgICAgICAgIHJldHVybiBqb2lucy5vdXRl\nckpvaW5SZWxhdGlvbihmaWVsZC5nZXROYW1lKCksIAogICAgICAgICAgICAg\nICAgZWxlbS5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLCBjbHNzWzBdLAogICAg\nICAgICAgICAgICAgZWxlbS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIHRydWUs\nIHRydWUpOwogICAgICAgIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24oZmll\nbGQuZ2V0TmFtZSgpLCBlbGVtLmdldEZvcmVpZ25LZXkoY2xzc1swXSksCiAg\nICAgICAgICAgIGNsc3NbMF0sIGVsZW0uZ2V0U2VsZWN0U3ViY2xhc3Nlcygp\nLCB0cnVlLCB0cnVlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0\nSW52ZXJzYWJsZSgpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZp\nZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVsZW0uZ2V0\nSW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKS5sZW5ndGggIT0gMSkKICAgICAg\nICAgICAgdGhyb3cgUmVsYXRpb25TdHJhdGVnaWVzLnVuaW52ZXJzYWJsZShl\nbGVtKTsKICAgIH0KfQo=\n","encoding":"base64"}

