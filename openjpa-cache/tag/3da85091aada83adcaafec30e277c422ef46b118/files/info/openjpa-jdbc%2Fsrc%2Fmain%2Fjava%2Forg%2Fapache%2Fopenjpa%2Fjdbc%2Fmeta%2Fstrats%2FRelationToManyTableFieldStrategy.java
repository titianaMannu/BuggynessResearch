{"sha":"4cf621b5107c7613b91ee3466f45e84dc650c2aa","node_id":"MDQ6QmxvYjIwNjM2NDo0Y2Y2MjFiNTEwN2M3NjEzYjkxZWUzNDY2ZjQ1ZTg0ZGM2NTBjMmFh","size":10644,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4cf621b5107c7613b91ee3466f45e84dc650c2aa","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmdJbmZvOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGlu\nZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJv\ndzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVj\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0\nYXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNo\nYW5nZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5N\nZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlByb3hpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Q\ncm94eTsKCi8qKgogKiBNYXBzIGEgc2V0IG9mIHJlbGF0ZWQgb2JqZWN0cyB0\naHJvdWdoIGFuIGFzc29jaWF0aW9uIHRhYmxlLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIFJlbGF0aW9uVG9N\nYW55VGFibGVGaWVsZFN0cmF0ZWd5CiAgICBleHRlbmRzIFN0b3JlQ29sbGVj\ndGlvbkZpZWxkU3RyYXRlZ3kgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAg\nICAoUmVsYXRpb25Ub01hbnlUYWJsZUZpZWxkU3RyYXRlZ3kuY2xhc3MpOwoK\nICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmdbXSBnZXRJbmRlcGVuZGVudEVs\nZW1lbnRNYXBwaW5ncyhib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgcmV0\ndXJuICh0cmF2ZXJzZSkKICAgICAgICAgICAgPyBmaWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCkKICAgICAg\nICAgICAgOiBDbGFzc01hcHBpbmcuRU1QVFlfTUFQUElOR1M7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgZ2V0Sm9pbkZvcmVpZ25LZXkoQ2xh\nc3NNYXBwaW5nIGVsZW0pIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0Sm9p\nbkZvcmVpZ25LZXkoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZWxl\nY3RFbGVtZW50KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBlbGVtLAogICAg\nICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGVhZ2VyTW9kZSwKICAgICAgICBKb2lucyBqb2lucykgewog\nICAgICAgIHNlbC5zZWxlY3QoZWxlbSwgZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAgICAgIHN0b3Jl\nLCBmZXRjaCwgZWFnZXJNb2RlLCBqb2lucyk7CiAgICB9CgogICAgcHJvdGVj\ndGVkIE9iamVjdCBsb2FkRWxlbWVudChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGVs\nZW0gPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICBpZiAoZWxlbSA9\nPSBudWxsKQogICAgICAgICAgICBlbGVtID0gZmllbGQuZ2V0RWxlbWVudE1h\ncHBpbmcoKS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpWzBdOwogICAg\nICAgIHJldHVybiByZXMubG9hZChlbGVtLCBzdG9yZSwgZmV0Y2gsIGpvaW5z\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgSm9pbnMgam9pbihKb2lucyBqb2lu\ncywgQ2xhc3NNYXBwaW5nIGVsZW0pIHsKICAgICAgICByZXR1cm4gam9pbihq\nb2lucywgZmFsc2UpOwogICAgfQoKICAgIHByb3RlY3RlZCBKb2lucyBqb2lu\nRWxlbWVudFJlbGF0aW9uKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgZWxl\nbSkgewogICAgICAgIFZhbHVlTWFwcGluZyB2bSA9IGZpZWxkLmdldEVsZW1l\nbnRNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5SZWxhdGlv\nbihmaWVsZC5nZXROYW1lKCksIHZtLmdldEZvcmVpZ25LZXkoZWxlbSksIAog\nICAgICAgICAgICBlbGVtLCB2bS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIGZh\nbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwKGJvb2xl\nYW4gYWRhcHQpIHsKICAgICAgICBmaWVsZC5nZXRWYWx1ZUluZm8oKS5hc3Nl\ncnROb1NjaGVtYUNvbXBvbmVudHMoZmllbGQsICFhZGFwdCk7CiAgICAgICAg\nZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFZhbHVlSW5mbygpLmFzc2VydE5v\nU2NoZW1hQ29tcG9uZW50cwogICAgICAgICAgICAoZmllbGQuZ2V0S2V5KCks\nICFhZGFwdCk7CgogICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBpZiAoZWxlbS5nZXRUeXBl\nQ29kZSgpICE9IEphdmFUeXBlcy5QQyB8fCBlbGVtLmlzRW1iZWRkZWRQQygp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vdC1lbGVtLXJlbGF0aW9uIiwgZmllbGQpKTsKCiAgICAgICAg\nLy8gY2hlY2sgZm9yIG5hbWVkIGludmVyc2UKICAgICAgICBGaWVsZE1hcHBp\nbmcgbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBwaW5nKCk7CiAgICAg\nICAgVmFsdWVNYXBwaW5nSW5mbyB2aW5mbyA9IGVsZW0uZ2V0VmFsdWVJbmZv\nKCk7CiAgICAgICAgYm9vbGVhbiBjcml0ZXJpYSA9IHZpbmZvLmdldFVzZUNs\nYXNzQ3JpdGVyaWEoKTsKICAgICAgICBpZiAobWFwcGVkICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKG1hcHBlZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNv\nZGUoKSAhPSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1pbnYtcmVsYXRp\nb24tY29sbCIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQsIG1hcHBlZCkp\nOwogICAgICAgICAgICBmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmFzc2VydE5v\nU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsKICAgICAgICAgICAg\ndmluZm8uYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzKGVsZW0sICFhZGFwdCk7\nCiAgICAgICAgICAgIG1hcHBlZC5yZXNvbHZlKG1hcHBlZC5NT0RFX01FVEEg\nfCBtYXBwZWQuTU9ERV9NQVBQSU5HKTsKCiAgICAgICAgICAgIGlmICghbWFw\ncGVkLmlzTWFwcGVkKCkgfHwgbWFwcGVkLmlzU2VyaWFsaXplZCgpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJtYXBwZWQtYnktdW5tYXBwZWQiLAogICAgICAgICAgICAgICAgICAg\nIGZpZWxkLCBtYXBwZWQpKTsKCiAgICAgICAgICAgIGZpZWxkLnNldEpvaW5G\nb3JlaWduS2V5KG1hcHBlZC5nZXRFbGVtZW50TWFwcGluZygpLgogICAgICAg\nICAgICAgICAgZ2V0Rm9yZWlnbktleShmaWVsZC5nZXREZWZpbmluZ01hcHBp\nbmcoKSkpOwogICAgICAgICAgICBlbGVtLnNldEZvcmVpZ25LZXkobWFwcGVk\nLmdldEpvaW5Gb3JlaWduS2V5KCkpOwogICAgICAgICAgICBlbGVtLnNldFVz\nZUNsYXNzQ3JpdGVyaWEoY3JpdGVyaWEpOwogICAgICAgICAgICBmaWVsZC5z\nZXRPcmRlckNvbHVtbihtYXBwZWQuZ2V0T3JkZXJDb2x1bW4oKSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZpZWxkLm1hcEpv\naW4oYWRhcHQsIHRydWUpOwogICAgICAgIGlmIChlbGVtLmdldFR5cGVNYXBw\naW5nKCkuaXNNYXBwZWQoKSkgewogICAgICAgICAgICBGb3JlaWduS2V5IGZr\nID0gdmluZm8uZ2V0VHlwZUpvaW4oZWxlbSwgImVsZW1lbnQiLCBmYWxzZSwg\nYWRhcHQpOwogICAgICAgICAgICBlbGVtLnNldEZvcmVpZ25LZXkoZmspOwog\nICAgICAgICAgICBlbGVtLnNldENvbHVtbklPKHZpbmZvLmdldENvbHVtbklP\nKCkpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBSZWxhdGlvblN0cmF0\nZWdpZXMubWFwUmVsYXRpb25Ub1VubWFwcGVkUEMoZWxlbSwgImVsZW1lbnQi\nLCBhZGFwdCk7CiAgICAgICAgZWxlbS5zZXRVc2VDbGFzc0NyaXRlcmlhKGNy\naXRlcmlhKTsKICAgICAgICBlbGVtLm1hcENvbnN0cmFpbnRzKCJlbGVtZW50\nIiwgYWRhcHQpOwoKICAgICAgICBGaWVsZE1hcHBpbmdJbmZvIGZpbmZvID0g\nZmllbGQuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBDb2x1bW4gb3JkZXJD\nb2wgPSBmaW5mby5nZXRPcmRlckNvbHVtbihmaWVsZCwgZmllbGQuZ2V0VGFi\nbGUoKSwgYWRhcHQpOwogICAgICAgIGZpZWxkLnNldE9yZGVyQ29sdW1uKG9y\nZGVyQ29sKTsKICAgICAgICBmaWVsZC5zZXRPcmRlckNvbHVtbklPKGZpbmZv\nLmdldENvbHVtbklPKCkpOwogICAgICAgIGZpZWxkLm1hcFByaW1hcnlLZXko\nYWRhcHQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluc2VydChPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIg\ncm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGZpZWxkLmdldE1hcHBlZEJ5KCkgPT0gbnVsbCkKICAgICAgICAgICAgaW5z\nZXJ0KHNtLCBybSwgc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSkp\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgUm93TWFuYWdlciBybSwgT2JqZWN0IHZhbHMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sbGVjdGlvbiBj\nb2xsID0gdG9Db2xsZWN0aW9uKHZhbHMpOwogICAgICAgIGlmIChjb2xsID09\nIG51bGwgfHwgY29sbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgUm93IHJvdyA9IHJtLmdldFNlY29uZGFyeVJvdyhmaWVsZC5n\nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX0lOU0VSVCk7CiAgICAgICAgcm93LnNl\ndEZvcmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwgZmllbGQu\nZ2V0Sm9pbkNvbHVtbklPKCksCiAgICAgICAgICAgIHNtKTsKCiAgICAgICAg\nVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIFN0b3JlQ29udGV4dCBjdHggPSBzbS5nZXRDb250ZXh0KCk7\nCiAgICAgICAgQ29sdW1uIG9yZGVyID0gZmllbGQuZ2V0T3JkZXJDb2x1bW4o\nKTsKICAgICAgICBib29sZWFuIHNldE9yZGVyID0gZmllbGQuZ2V0T3JkZXJD\nb2x1bW5JTygpLmlzSW5zZXJ0YWJsZShvcmRlciwgZmFsc2UpOwogICAgICAg\nIGludCBpZHggPSAwOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZXNt\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykgewogICAgICAgICAgICBlc20gPSBS\nZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGl0ci5uZXh0KCks\nIGN0eCk7CiAgICAgICAgICAgIGVsZW0uc2V0Rm9yZWlnbktleShyb3csIGVz\nbSk7CiAgICAgICAgICAgIGlmIChzZXRPcmRlcikKICAgICAgICAgICAgICAg\nIHJvdy5zZXRJbnQob3JkZXIsIGlkeCk7CiAgICAgICAgICAgIHJtLmZsdXNo\nU2Vjb25kYXJ5Um93KHJvdyk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBPYmplY3Qgb2Jq\nID0gc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nQ2hhbmdlVHJhY2tlciBjdCA9IG51bGw7CiAgICAgICAgaWYgKG9iaiBpbnN0\nYW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgIFByb3h5IHByb3h5ID0gKFBy\nb3h5KSBvYmo7CiAgICAgICAgICAgIGlmIChQcm94aWVzLmlzT3duZXIocHJv\neHksIHNtLCBmaWVsZC5nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgIGN0\nID0gcHJveHkuZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgbm8gZmluZS1ncmFpbmVkIGNoYW5nZSB0cmFja2luZyB0aGVu\nIGp1c3QgZGVsZXRlIGFuZCByZWluc2VydAogICAgICAgIGlmIChjdCA9PSBu\ndWxsIHx8ICFjdC5pc1RyYWNraW5nKCkpIHsKICAgICAgICAgICAgZGVsZXRl\nKHNtLCBzdG9yZSwgcm0pOwogICAgICAgICAgICBpbnNlcnQoc20sIHJtLCBv\nYmopOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBT\ndG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgpOwogICAgICAg\nIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmco\nKTsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVzbTsKCiAgICAgICAg\nLy8gZGVsZXRlIHRoZSByZW1vdmVzCiAgICAgICAgQ29sbGVjdGlvbiByZW0g\nPSBjdC5nZXRSZW1vdmVkKCk7CiAgICAgICAgaWYgKCFyZW0uaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIFJvdyBkZWxSb3cgPSBybS5nZXRTZWNvbmRhcnlS\nb3coZmllbGQuZ2V0VGFibGUoKSwKICAgICAgICAgICAgICAgIFJvdy5BQ1RJ\nT05fREVMRVRFKTsKICAgICAgICAgICAgZGVsUm93LndoZXJlRm9yZWlnbktl\neShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLCBzbSk7CgogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHJlbS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgZXNtID0gUmVsYXRpb25TdHJh\ndGVnaWVzLmdldFN0YXRlTWFuYWdlcihpdHIubmV4dCgpLCBjdHgpOwogICAg\nICAgICAgICAgICAgZWxlbS53aGVyZUZvcmVpZ25LZXkoZGVsUm93LCBlc20p\nOwogICAgICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coZGVsUm93\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaW5zZXJ0\nIHRoZSBhZGRzCiAgICAgICAgQ29sbGVjdGlvbiBhZGQgPSBjdC5nZXRBZGRl\nZCgpOwogICAgICAgIGlmICghYWRkLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICBSb3cgYWRkUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRh\nYmxlKCksCiAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0lOU0VSVCk7CiAg\nICAgICAgICAgIGFkZFJvdy5zZXRGb3JlaWduS2V5KGZpZWxkLmdldEpvaW5G\nb3JlaWduS2V5KCksCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRKb2luQ29s\ndW1uSU8oKSwgc20pOwoKICAgICAgICAgICAgaW50IHNlcSA9IGN0LmdldE5l\neHRTZXF1ZW5jZSgpOwogICAgICAgICAgICBDb2x1bW4gb3JkZXIgPSBmaWVs\nZC5nZXRPcmRlckNvbHVtbigpOwogICAgICAgICAgICBib29sZWFuIHNldE9y\nZGVyID0gZmllbGQuZ2V0T3JkZXJDb2x1bW5JTygpLmlzSW5zZXJ0YWJsZShv\ncmRlciwKICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBhZGQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTsgc2VxKyspIHsKICAgICAgICAgICAgICAgIGVzbSA9IFJlbGF0aW9uU3Ry\nYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIoaXRyLm5leHQoKSwgY3R4KTsKICAg\nICAgICAgICAgICAgIGVsZW0uc2V0Rm9yZWlnbktleShhZGRSb3csIGVzbSk7\nCiAgICAgICAgICAgICAgICBpZiAoc2V0T3JkZXIpCiAgICAgICAgICAgICAg\nICAgICAgYWRkUm93LnNldEludChvcmRlciwgc2VxKTsKICAgICAgICAgICAg\nICAgIHJtLmZsdXNoU2Vjb25kYXJ5Um93KGFkZFJvdyk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKG9yZGVyICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBjdC5zZXROZXh0U2VxdWVuY2Uoc2VxKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBSb3cgcm93ID0gcm0uZ2V0\nQWxsUm93cyhmaWVsZC5nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX0RFTEVURSk7\nCiAgICAgICAgcm93LndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9y\nZWlnbktleSgpLCBzbSk7CiAgICAgICAgcm0uZmx1c2hBbGxSb3dzKHJvdyk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCB0b0RhdGFTdG9yZVZhbHVlKE9i\namVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBS\nZWxhdGlvblN0cmF0ZWdpZXMudG9EYXRhU3RvcmVWYWx1ZShmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpLAogICAgICAgICAgICB2YWwsIHN0b3JlKTsKICAg\nIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbihKb2lucyBqb2lucywgYm9vbGVh\nbiBmb3JjZU91dGVyKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkLmpvaW4oam9p\nbnMsIGZvcmNlT3V0ZXIsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBKb2lu\ncyBqb2luUmVsYXRpb24oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRl\nciwKICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgVmFsdWVN\nYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAg\nICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBlbGVtLmdldEluZGVwZW5kZW50\nVHlwZU1hcHBpbmdzKCk7CiAgICAgICAgaWYgKGNsc3MubGVuZ3RoICE9IDEp\nIHsKICAgICAgICAgICAgaWYgKHRyYXZlcnNlKQogICAgICAgICAgICAgICAg\ndGhyb3cgUmVsYXRpb25TdHJhdGVnaWVzLnVuam9pbmFibGUoZWxlbSk7CiAg\nICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICB9CiAgICAgICAgaWYg\nKGZvcmNlT3V0ZXIpCiAgICAgICAgICAgIHJldHVybiBqb2lucy5vdXRlckpv\naW5SZWxhdGlvbihmaWVsZC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBl\nbGVtLmdldEZvcmVpZ25LZXkoY2xzc1swXSksIGNsc3NbMF0sIAogICAgICAg\nICAgICAgICAgZWxlbS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIGZhbHNlLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW5SZWxhdGlvbihmaWVs\nZC5nZXROYW1lKCksIGVsZW0uZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwKICAg\nICAgICAgICAgY2xzc1swXSwgZWxlbS5nZXRTZWxlY3RTdWJjbGFzc2VzKCks\nIGZhbHNlLCBmYWxzZSk7CiAgICB9Cn0K\n","encoding":"base64"}

