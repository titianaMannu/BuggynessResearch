{"sha":"131186fae4dd9815ba41fe7aa67443a90c52b8ec","node_id":"MDQ6QmxvYjIwNjM2NDoxMzExODZmYWU0ZGQ5ODE1YmE0MWZlN2FhNjc0NDNhOTBjNTJiOGVj","size":54049,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/131186fae4dd9815ba41fe7aa67443a90c52b8ec","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLldy\naXRlcjsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZh\nLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuU1FMRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29u\nZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogVGhlIFNj\naGVtYVRvb2wgaXMgdXNlZCB0byBtYW5hZ2UgdGhlIGRhdGFiYXNlIHNjaGVt\nYS4gTm90ZSB0aGF0IHRoZQogKiB0b29sIG5ldmVyIGFkZHMgb3IgZHJvcHMg\ndW5pcXVlIGNvbnN0cmFpbnRzIGZyb20gZXhpc3RpbmcgdGFibGVzLCBiZWNh\ndXNlCiAqIEpEQkMge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9IGRvZXMgbm90\nIGluY2x1ZGUgaW5mb3JtYXRpb24gb24gdGhlc2UKICogY29uc3RyYWludHMu\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGF0cmljayBM\naW5za2V5CiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hVG9vbCB7CgogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0FERCA9ICJhZGQiOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0RST1AgPSAi\nZHJvcCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nUkVUQUlOID0gInJldGFpbiI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fUkVGUkVTSCA9ICJyZWZyZXNoIjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9CVUlMRCA9ICJidWlsZCI7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fUkVGTEVDVCA9\nICJyZWZsZWN0IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFD\nVElPTl9DUkVBVEVEQiA9ICJjcmVhdGVEQiI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBBQ1RJT05fRFJPUERCID0gImRyb3BEQiI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fSU1QT1JUID0gImlt\ncG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nRVhQT1JUID0gImV4cG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTID0gCiAgICAgICAg\nImRlbGV0ZVRhYmxlQ29udGVudHMiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgU3RyaW5nW10gQUNUSU9OUyA9IG5ldyBTdHJpbmdbXXsKICAgICAgICBB\nQ1RJT05fQURELAogICAgICAgIEFDVElPTl9EUk9QLAogICAgICAgIEFDVElP\nTl9SRVRBSU4sCiAgICAgICAgQUNUSU9OX1JFRlJFU0gsCiAgICAgICAgQUNU\nSU9OX0JVSUxELAogICAgICAgIEFDVElPTl9SRUZMRUNULAogICAgICAgIEFD\nVElPTl9DUkVBVEVEQiwKICAgICAgICBBQ1RJT05fRFJPUERCLAogICAgICAg\nIEFDVElPTl9JTVBPUlQsCiAgICAgICAgQUNUSU9OX0VYUE9SVCwKICAgICAg\nICBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTLAogICAgfTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYVRvb2wuY2xhc3MpOwoKICAg\nIHByaXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBw\ncml2YXRlIGZpbmFsIERhdGFTb3VyY2UgX2RzOwogICAgcHJpdmF0ZSBmaW5h\nbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9k\naWN0OwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX2FjdGlvbjsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaWdub3JlRXJycyA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9vcGVuanBhVGFibGVzID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2Ryb3BUYWJsZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9kcm9wU2VxcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Br\ncyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2luZGV4ZXMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zZXFzID0gdHJ1ZTsKICAgIHByaXZhdGUgUHJpbnRXcml0\nZXIgX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9n\ncm91cCA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9kYiA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Z1bGxEQiA9IGZhbHNlOwoKICAg\nIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gVG9vbHMgY29uc3Ry\ndWN0ZWQgdGhpcyB3YXkgd2lsbCBub3QgaGF2ZSBhbgogICAgICogYWN0aW9u\nLCBzbyB0aGUge0BsaW5rICNydW4oKX0gbWV0aG9kIHdpbGwgYmUgYSBuby1v\ncC4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRvb2woSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIHRoaXMoY29uZiwgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB0b29sIHRvIHBlcmZvcm0g\ndGhlIGdpdmVuIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRv\nb2woSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nIGFjdGlvbikgewog\nICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiAhQXJyYXlzLmFzTGlzdChB\nQ1RJT05TKS5jb250YWlucyhhY3Rpb24pKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJhY3Rpb24gPT0gIiArIGFj\ndGlvbik7CgogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBfYWN0aW9u\nID0gYWN0aW9uOwogICAgICAgIF9kcyA9IGNvbmYuZ2V0RGF0YVNvdXJjZTIo\nbnVsbCk7CiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1\ncmF0aW9uLkxPR19TQ0hFTUEpOwoKICAgICAgICAvLyBpbml0aWFsaXplIHRo\naXMgdXAtZnJvbnQ7IG90aGVyd2lzZSB0aGUgZGJkaWN0aW9uYXJ5ZmFjdG9y\neSBtaWdodAogICAgICAgIC8vIHRyeSB0byB0YWtlIGEgY29ubmVjdGlvbiB0\nbyBpbml0aWFsaXplIHdoZW4gd2UndmUgYWxyZWFkeSBnb3Qgb25lOgogICAg\nICAgIC8vIGJhZCBuZXdzIGlmIHRoZSBtYXggcG9vbCBpcyAxCiAgICAgICAg\nX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGFjdGlvbiBzdXBwbGllZCBvbiBjb25z\ndHJ1Y3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0QWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAgfQoKICAgIC8qKgog\nICAgICogSWYgdHJ1ZSwgU1FMRXhjZXB0aW9ucyB0aHJvd24gZHVyaW5nIHNj\naGVtYSBtYW5pcHVsYXRpb24gd2lsbCBiZQogICAgICogcHJpbnRlZCBidXQg\naWdub3JlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3Jl\nRXJyb3JzKCkgewogICAgICAgIHJldHVybiBfaWdub3JlRXJyczsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHRydWUsIFNRTEV4Y2VwdGlvbnMgdGhyb3du\nIGR1cmluZyBzY2hlbWEgbWFuaXB1bGF0aW9uIHdpbGwgYmUKICAgICAqIHBy\naW50ZWQgYnV0IGlnbm9yZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndElnbm9yZUVycm9ycyhib29sZWFuIGlnbm9yZUVycnMpIHsKICAgICAgICBf\naWdub3JlRXJycyA9IGlnbm9yZUVycnM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRvIGFjdCBvbiBzcGVjaWFsIHRhYmxlcyB1c2VkIGJ5IE9w\nZW5KUEEgY29tcG9uZW50cwogICAgICogZm9yIGJvb2trZWVwaW5nLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcGVuSlBBVGFibGVzKCkgewog\nICAgICAgIHJldHVybiBfb3BlbmpwYVRhYmxlczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYWN0IG9uIHNwZWNpYWwgdGFibGVzIHVzZWQg\nYnkgT3BlbkpQQSBjb21wb25lbnRzCiAgICAgKiBmb3IgYm9va2tlZXBpbmcu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9wZW5KUEFUYWJsZXMoYm9v\nbGVhbiBvcGVuanBhVGFibGVzKSB7CiAgICAgICAgX29wZW5qcGFUYWJsZXMg\nPSBvcGVuanBhVGFibGVzOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdHJ1\nZSwgdGFibGVzIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNlZCB3aWxsIGJlIGRy\nb3BwZWQuIERlZmF1bHRzIHRvCiAgICAgKiB0cnVlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXREcm9wVGFibGVzKCkgewogICAgICAgIHJldHVy\nbiBfZHJvcFRhYmxlczsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRydWUs\nIHRhYmxlcyB0aGF0IGFwcGVhciB0byBiZSB1bnVzZWQgd2lsbCBiZSBkcm9w\ncGVkLiBEZWZhdWx0cyB0bwogICAgICogdHJ1ZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RHJvcFRhYmxlcyhib29sZWFuIGRyb3BUYWJsZXMpIHsK\nICAgICAgICBfZHJvcFRhYmxlcyA9IGRyb3BUYWJsZXM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJZiB0cnVlLCBzZXF1ZW5jZXMgdGhhdCBhcHBlYXIgdG8g\nYmUgdW51c2VkIHdpbGwgYmUgZHJvcHBlZC4gRGVmYXVsdHMKICAgICAqIHRv\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldERyb3BTZXF1\nZW5jZXMoKSB7CiAgICAgICAgcmV0dXJuIF9kcm9wU2VxczsKICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHRydWUsIHNlcXVlbmNlcyB0aGF0IGFwcGVhciB0\nbyBiZSB1bnVzZWQgd2lsbCBiZSBkcm9wcGVkLiBEZWZhdWx0cwogICAgICog\ndG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJvcFNlcXVl\nbmNlcyhib29sZWFuIGRyb3BTZXFzKSB7CiAgICAgICAgX2Ryb3BTZXFzID0g\nZHJvcFNlcXM7CiAgICAgICAgaWYgKGRyb3BTZXFzKQogICAgICAgICAgICBz\nZXRTZXF1ZW5jZXModHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFNlcXVl\nbmNlcygpIHsKICAgICAgICByZXR1cm4gX3NlcXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9\nIHNlcXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGluZGV4ZXMg\nb24gZXhpc3RpbmcgdGFibGVzIHNob3VsZCBiZSBtYW5pcHVsYXRlZC4KICAg\nICAqIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGdldEluZGV4ZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pbmRleGVzOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbmRleGVzIG9uIGV4aXN0\naW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAgICAgKiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRl\neGVzKGJvb2xlYW4gaW5kZXhlcykgewogICAgICAgIF9pbmRleGVzID0gaW5k\nZXhlczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBr\nZXlzIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQu\nCiAgICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRGb3JlaWduS2V5cygpIHsKICAgICAgICByZXR1cm4gX2Zr\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBrZXlz\nIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAg\nICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRGb3JlaWduS2V5cyhib29sZWFuIGZrcykgewogICAgICAgIF9ma3Mg\nPSBma3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkg\na2V5cyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVk\nLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gZ2V0UHJpbWFyeUtleXMoKSB7CiAgICAgICAgcmV0dXJuIF9w\na3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkga2V5\ncyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgog\nICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UHJpbWFyeUtleXMoYm9vbGVhbiBwa3MpIHsKICAgICAgICBfcGtz\nID0gcGtzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmVhbSB0byB3\ncml0ZSB0byBmb3IgdGhlIGNyZWF0aW9uIG9mIFNRTCBzY3JpcHRzLiBJZiB0\naGUKICAgICAqIHN0cmVhbSBpcyBub24tbnVsbCwgYWxsIFNRTCB3aWxsIGJl\nIHdyaXR0ZW4gdG8gdGhpcyBzdHJlYW0gcmF0aGVyIHRoYW4KICAgICAqIGV4\nZWN1dGVkIGFnYWluc3QgdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBwdWJs\naWMgV3JpdGVyIGdldFdyaXRlcigpIHsKICAgICAgICByZXR1cm4gX3dyaXRl\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJlYW0gdG8gd3JpdGUg\ndG8gZm9yIHRoZSBjcmVhdGlvbiBvZiBTUUwgc2NyaXB0cy4gSWYgdGhlCiAg\nICAgKiBzdHJlYW0gaXMgbm9uLW51bGwsIGFsbCBTUUwgd2lsbCBiZSB3cml0\ndGVuIHRvIHRoaXMgc3RyZWFtIHJhdGhlciB0aGFuCiAgICAgKiBleGVjdXRl\nZCBhZ2FpbnN0IHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0V3JpdGVyKFdyaXRlciB3cml0ZXIpIHsKICAgICAgICBpZiAod3Jp\ndGVyID09IG51bGwpCiAgICAgICAgICAgIF93cml0ZXIgPSBudWxsOwogICAg\nICAgIGVsc2UgaWYgKHdyaXRlciBpbnN0YW5jZW9mIFByaW50V3JpdGVyKQog\nICAgICAgICAgICBfd3JpdGVyID0gKFByaW50V3JpdGVyKSB3cml0ZXI7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfd3JpdGVyID0gbmV3IFByaW50V3Jp\ndGVyKHdyaXRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAqLwog\nICAgcHVibGljIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3VwKCkgewogICAg\nICAgIHJldHVybiBfZ3JvdXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U2NoZW1hR3JvdXAoU2NoZW1hR3JvdXAg\nZ3JvdXApIHsKICAgICAgICBfZ3JvdXAgPSBncm91cDsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLwogICAgLy8gQWN0aW9ucwogICAgLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIFJ1biB0aGUgdG9vbCBhY3Rpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHJ1bigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF9hY3Rpb24gPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoQUNUSU9OX0FERC5lcXVhbHMoX2FjdGlv\nbikpCiAgICAgICAgICAgIGFkZCgpOwogICAgICAgIGVsc2UgaWYgKEFDVElP\nTl9EUk9QLmVxdWFscyhfYWN0aW9uKSkKICAgICAgICAgICAgZHJvcCgpOwog\nICAgICAgIGVsc2UgaWYgKEFDVElPTl9SRVRBSU4uZXF1YWxzKF9hY3Rpb24p\nKQogICAgICAgICAgICByZXRhaW4oKTsKICAgICAgICBlbHNlIGlmIChBQ1RJ\nT05fUkVGUkVTSC5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIHJlZnJl\nc2goKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fQlVJTEQuZXF1YWxzKF9h\nY3Rpb24pKQogICAgICAgICAgICBidWlsZCgpOwogICAgICAgIGVsc2UgaWYg\nKEFDVElPTl9DUkVBVEVEQi5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAg\nIGNyZWF0ZURCKCk7CiAgICAgICAgZWxzZSBpZiAoQUNUSU9OX0RST1BEQi5l\ncXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIGRyb3BEQigpOwogICAgICAg\nIGVsc2UgaWYgKEFDVElPTl9ERUxFVEVfVEFCTEVfQ09OVEVOVFMuZXF1YWxz\nKF9hY3Rpb24pKQogICAgICAgICAgICBkZWxldGVUYWJsZUNvbnRlbnRzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFueSBjb21wb25lbnRzIHBy\nZXNlbnQgaW4gdGhlIHNjaGVtYSByZXBvc2l0b3J5IGJ1dCBhYnNlbnQgZnJv\nbQogICAgICogdGhlIGRhdGFiYXNlLiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgYWRkKCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBhZGQoZ2V0REJTY2hlbWFHcm91cChm\nYWxzZSksIGFzc2VydFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogRHJvcHMgYWxsIHNjaGVtYSBjb21wb25lbnRzIGluIHRoZSBzY2hl\nbWEgcmVwb3NpdG9yeSB0aGF0IGFsc28gZXhpc3QKICAgICAqIGluIHRoZSBk\nYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAgICov\nCiAgICB2b2lkIGRyb3AoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGRyb3AoZ2V0REJTY2hlbWFHcm91cChmYWxzZSksIGFzc2Vy\ndFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcHMg\nZGF0YWJhc2UgY29tcG9uZW50cyB0aGF0IGFyZSBub3QgbWVudGlvbmVkIGlu\nIHRoZSBzY2hlbWEKICAgICAqIHJlcG9zaXRvcnkuIFBhY2thZ2UtcHJpdmF0\nZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAgdm9pZCByZXRhaW4oKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldGFpbihnZXRE\nQlNjaGVtYUdyb3VwKHRydWUpLCBhc3NlcnRTY2hlbWFHcm91cCgpLAogICAg\nICAgICAgICBnZXREcm9wVGFibGVzKCksIGdldERyb3BTZXF1ZW5jZXMoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFueSBjb21wb25lbnRzIHBy\nZXNlbnQgaW4gdGhlIHNjaGVtYSByZXBvc2l0b3J5IGJ1dCBhYnNlbnQgZnJv\nbQogICAgICogdGhlIGRhdGFiYXNlLCBhbmQgZHJvcHMgdW51c2VkIGRhdGFi\nYXNlIGNvbXBvbmVudHMuCiAgICAgKiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgcmVmcmVzaCgpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2NoZW1hR3JvdXAgbG9jYWwg\nPSBhc3NlcnRTY2hlbWFHcm91cCgpOwogICAgICAgIFNjaGVtYUdyb3VwIGRi\nID0gZ2V0REJTY2hlbWFHcm91cCh0cnVlKTsKICAgICAgICByZXRhaW4oZGIs\nIGxvY2FsLCBnZXREcm9wVGFibGVzKCksIGdldERyb3BTZXF1ZW5jZXMoKSk7\nCiAgICAgICAgYWRkKGRiLCBsb2NhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZS1leGVjdXRlIGFsbCBTUUwgdXNlZCBmb3IgdGhlIGNyZWF0aW9uIG9m\nIHRoZSBjdXJyZW50IGRhdGFiYXNlOwogICAgICogdGhpcyBhY3Rpb24gaXMg\ndXN1YWxseSB1c2VkIHdoZW4gY3JlYXRpbmcgU1FMIHNjcmlwdHMuCiAgICAg\nKiBQYWNrYWdlLXByaXZhdGUgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHZv\naWQgY3JlYXRlREIoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gbmV3IFNjaGVtYUdyb3VwKCk7\nCiAgICAgICAgZ3JvdXAuYWRkU2NoZW1hKCk7CiAgICAgICAgYWRkKGdyb3Vw\nLCBnZXREQlNjaGVtYUdyb3VwKHRydWUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlLWV4ZWN1dGUgYWxsIFNRTCB1c2VkIGZvciB0aGUgY3JlYXRpb24g\nb2YgdGhlIGN1cnJlbnQgZGF0YWJhc2U7CiAgICAgKiB0aGlzIGFjdGlvbiBp\ncyB1c3VhbGx5IHVzZWQgd2hlbiBjcmVhdGluZyBTUUwgc2NyaXB0cy4KICAg\nICAqIFBhY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\ndm9pZCBidWlsZCgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU2NoZW1hR3JvdXAgZ3JvdXAgPSBuZXcgU2NoZW1hR3JvdXAoKTsK\nICAgICAgICBncm91cC5hZGRTY2hlbWEoKTsKICAgICAgICBhZGQoZ3JvdXAs\nIGFzc2VydFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRHJvcCB0aGUgY3VycmVudCBkYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZv\nciB0ZXN0aW5nLgogICAgICovCiAgICB2b2lkIGRyb3BEQigpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0YWluKGdldERCU2No\nZW1hR3JvdXAodHJ1ZSksIG5ldyBTY2hlbWFHcm91cCgpLCB0cnVlLCB0cnVl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIElzc3VlIERFTEVURSBzdGF0ZW1l\nbnQgYWdhaW5zdCBhbGwga25vd24gdGFibGVzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZGVsZXRlVGFibGVDb250ZW50cygpIAogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0g\nZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0g\nZ3JvdXAuZ2V0U2NoZW1hcygpOwogICAgICAgIENvbGxlY3Rpb24gdGFibGVz\nID0gbmV3IExpbmtlZEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgVGFi\nbGVbXSB0cyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgdHMubGVuZ3RoOyBqKyspCiAgICAgICAg\nICAgICAgICB0YWJsZXMuYWRkKHRzW2pdKTsKICAgICAgICB9CiAgICAgICAg\nVGFibGVbXSB0YWJsZUFycmF5ID0gKFRhYmxlW10pIHRhYmxlcy50b0FycmF5\nKG5ldyBUYWJsZVt0YWJsZXMuc2l6ZSgpXSk7CiAgICAgICAgU3RyaW5nW10g\nc3FsID0gX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKQogICAgICAg\nICAgICAuZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTCh0YWJsZUFycmF5KTsK\nICAgICAgICBpZiAoIWV4ZWN1dGVTUUwoc3FsKSkKICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkZWxldGUtdGFibGUtY29udGVudHMiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIGNoYW5nZXMgbWFkZSB0\nbyB0aGUgREIgaW4gdGhlIGN1cnJlbnQge0BsaW5rIFNjaGVtYUZhY3Rvcnl9\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKSB7CiAgICAgICAg\naWYgKF9kYiAhPSBudWxsICYmIF93cml0ZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgX2NvbmYuZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCkuc3RvcmVTY2hl\nbWEoX2RiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxsIGRhdGFi\nYXNlIGNvbXBvbmVudHMgaW4gdGhlIHJlcG9zaXRvcnkgc2NoZW1hIHRoYXQg\nYXJlIG5vdAogICAgICogcHJlc2VudCBpbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ug\nc2NoZW1hIHRvIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZChTY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3MpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWRkIHNl\ncXVlbmNlcwogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSByZXBvcy5nZXRT\nY2hlbWFzKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBpZiAo\nX3NlcXMpIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBzZXFzOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHNlcXMgPSBzY2hlbWFzW2ldLmdldFNlcXVl\nbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBz\nZXFzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRi\nLmZpbmRTZXF1ZW5jZShzZXFzW2pdKSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYg\nKGNyZWF0ZVNlcXVlbmNlKHNlcXNbal0pKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNjaGVtYSA9IGRiLmdldFNjaGVtYShzZXFzW2pdLmdldFNjaGVt\nYU5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWEg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYSA9\nIGRiLmFkZFNjaGVtYShzZXFzW2pdLmdldFNjaGVtYU5hbWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHNjaGVtYS5pbXBvcnRTZXF1ZW5jZShzZXFz\nW2pdKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJhZGQtc2VxIiwgc2Vx\nc1tqXSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRhbnQgaW4gdGhpcyBt\nZXRob2Q7IHN0YXJ0IHdpdGggY29sdW1ucwogICAgICAgIFRhYmxlW10gdGFi\nczsKICAgICAgICBUYWJsZSBkYlRhYmxlOwogICAgICAgIENvbHVtbltdIGNv\nbHM7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFi\ncyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAo\naW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAg\nICAgICAgY29scyA9IHRhYnNbal0uZ2V0Q29sdW1ucygpOwogICAgICAgICAg\nICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgY29scy5sZW5ndGg7IGsr\nKykgewogICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gZGJUYWJsZS5nZXRD\nb2x1bW4oY29sc1trXS5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoY29sID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChhZGRDb2x1bW4oY29sc1trXSkpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRDb2x1bW4oY29sc1tr\nXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJh\nZGQtY29sIiwgY29sc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgaWYgKCFjb2xzW2tdLmVxdWFsc0NvbHVtbihjb2wpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImJh\nZC1jb2wiLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29sLCBkYlRhYmxlLCBjb2wuZ2V0RGVzY3JpcHRpb24oKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzW2tdLmdldERl\nc2NyaXB0aW9uKCkgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBwcmltYXJ5IGtleXMKICAg\nICAgICBpZiAoX3BrcykgewogICAgICAgICAgICBQcmltYXJ5S2V5IHBrOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdl\ndFRhYmxlcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgcGsg\nPSB0YWJzW2pdLmdldFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgICAgICAg\nICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwayAhPSBudWxsICYmICFway5pc0xvZ2ljYWwoKSAm\nJiBkYlRhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGRiVGFibGUuZ2V0UHJpbWFyeUtleSgpID09IG51bGwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICYmIGFkZFByaW1hcnlLZXkocGspKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRQcmltYXJ5\nS2V5KHBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZGJU\nYWJsZS5nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYWRkLXBrIiwgcGss\nIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAo\nIXBrLmVxdWFsc1ByaW1hcnlLZXkoZGJUYWJsZS5nZXRQcmltYXJ5S2V5KCkp\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJiYWQtcGsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGRiVGFibGUuZ2V0UHJpbWFyeUtleSgpLCBkYlRhYmxlKSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyB0YWJsZXMKICAgICAgICBTZXQgbmV3\nVGFibGVzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFi\ncyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAo\naW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAg\nICAgICAgaWYgKGRiLmZpbmRUYWJsZSh0YWJzW2pdKSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlm\nIChjcmVhdGVUYWJsZSh0YWJzW2pdKSkgewogICAgICAgICAgICAgICAgICAg\nIG5ld1RhYmxlcy5hZGQodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAg\nc2NoZW1hID0gZGIuZ2V0U2NoZW1hKHRhYnNbal0uZ2V0U2NoZW1hTmFtZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYSA9IGRiLmFkZFNjaGVtYSh0\nYWJzW2pdLmdldFNjaGVtYU5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAg\nc2NoZW1hLmltcG9ydFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJhZGQtdGFibGUiLCB0YWJzW2pdKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIGluZGV4ZXMKICAgICAgICBJbmRleFtdIGlkeHM7\nCiAgICAgICAgSW5kZXggaWR4OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0g\nc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAg\nICAvLyBjcmVhdGUgaW5kZXhlcyBvbiBuZXcgdGFibGVzIGV2ZW4gaWYgaW5k\nZXhlcwogICAgICAgICAgICAgICAgLy8gaGF2ZSBiZWVuIHR1cm5lZCBvZmYK\nICAgICAgICAgICAgICAgIGlmICghX2luZGV4ZXMgJiYgIW5ld1RhYmxlcy5j\nb250YWlucyh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgICAgICBpZHhzID0gdGFic1tqXS5nZXRJbmRleGVz\nKCk7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHRh\nYnNbal0pOwogICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCBp\nZHhzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRi\nVGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZHgg\nPSBmaW5kSW5kZXgoZGJUYWJsZSwgaWR4c1trXSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChpZHggPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGNyZWF0ZUluZGV4KGlkeHNba10sIGRiVGFibGUp\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuaW1w\nb3J0SW5kZXgoaWR4c1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJhZGQtaW5kZXgiLCBpZHhzW2tdLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2pdKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlkeHNba10uZXF1YWxzSW5k\nZXgoaWR4KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2Fy\nbihfbG9jLmdldCgiYmFkLWluZGV4IiwgaWR4LCBkYlRhYmxlKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBVbmlxdWUgQ29uc3RyYWludHMg\nb24gZ3JvdXAgb2YgY29sdW1ucwogICAgICAgIFVuaXF1ZVtdIHVuaXF1ZXM7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxl\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVu\nZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB1bmlxdWUg\nY29uc3RyYWludHMgb25seSBvbiBuZXcgdGFibGVzIAogICAgICAgICAgICAg\nICAgaWYgKCFuZXdUYWJsZXMuY29udGFpbnModGFic1tqXSkpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdW5pcXVl\ncyA9IHRhYnNbal0uZ2V0VW5pcXVlcygpOwogICAgICAgICAgICAgICAgaWYg\nKHVuaXF1ZXMgPT0gbnVsbCB8fCB1bmlxdWVzLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgZGJU\nYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAgICAgICAgICAgICAg\nIGlmIChkYlRhYmxlID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IHVu\naXF1ZXMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICBkYlRh\nYmxlLmltcG9ydFVuaXF1ZSh1bmlxdWVzW2tdKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAv\nLyBmb3JlaWduIGtleXMKICAgICAgICBGb3JlaWduS2V5W10gZmtzOwogICAg\nICAgIEZvcmVpZ25LZXkgZms7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRhYnMgPSBz\nY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAgICAgICBmb3IgKGludCBq\nID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAg\nIC8vIGNyZWF0ZSBmb3JlaWduIGtleXMgb24gbmV3IHRhYmxlcyBldmVuIGlm\nIGZrcwogICAgICAgICAgICAgICAgLy8gaGF2ZSBiZWVuIHR1cm5lZCBvZmYK\nICAgICAgICAgICAgICAgIGlmICghX2ZrcyAmJiAhbmV3VGFibGVzLmNvbnRh\naW5zKHRhYnNbal0pKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgIGZrcyA9IHRhYnNbal0uZ2V0Rm9yZWlnbktleXMo\nKTsKICAgICAgICAgICAgICAgIGRiVGFibGUgPSBkYi5maW5kVGFibGUodGFi\nc1tqXSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGZr\ncy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgIGlmICghZmtz\nW2tdLmlzTG9naWNhbCgpICYmIGRiVGFibGUgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBmayA9IGZpbmRGb3JlaWduS2V5KGRiVGFibGUs\nIGZrc1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmayA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRkRm9y\nZWlnbktleShma3Nba10pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGRiVGFibGUuaW1wb3J0Rm9yZWlnbktleShma3Nba10pOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYWRkLWZrIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmtzW2tdLCB0YWJz\nW2pdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZr\nc1trXS5lcXVhbHNGb3JlaWduS2V5KGZrKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWZrIiwgZmssIGRi\nVGFibGUpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEcm9wcyBhbGwgZGF0YWJhc2UgY29tcG9uZW50cyB0aGF0IGFyZSBp\nbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ugc2NoZW1hCiAgICAgKiBidXQgbm90IGlu\nIHRoZSByZXBvc2l0b3J5IHNjaGVtYS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHJldGFpbihTY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3Ms\nIGJvb2xlYW4gdGFibGVzLAogICAgICAgIGJvb2xlYW4gc2VxdWVuY2VzKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNjaGVtYVtd\nIHNjaGVtYXMgPSBkYi5nZXRTY2hlbWFzKCk7CiAgICAgICAgaWYgKF9zZXFz\nICYmIHNlcXVlbmNlcykgewogICAgICAgICAgICBTZXF1ZW5jZVtdIHNlcXM7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc2VxcyA9IHNjaGVtYXNbaV0u\nZ2V0U2VxdWVuY2VzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0g\nMDsgaiA8IHNlcXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoIWlzRHJvcHBhYmxlKHNlcXNbal0pKQogICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVw\nb3MuZmluZFNlcXVlbmNlKHNlcXNbal0pID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGRyb3BTZXF1ZW5jZShzZXFzW2pdKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYXNbaV0ucmVtb3ZlU2Vx\ndWVuY2Uoc2Vxc1tqXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiZHJvcC1zZXEiLCBzZXFzW2pdKSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRhbnQgaW4gdGhpcyBtZXRob2Q7\nIHN0YXJ0IHdpdGggZm9yZWlnbiBrZXlzCiAgICAgICAgVGFibGVbXSB0YWJz\nOwogICAgICAgIFRhYmxlIHJlcG9zVGFibGU7CiAgICAgICAgaWYgKF9ma3Mp\nIHsKICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrczsKICAgICAgICAgICAg\nRm9yZWlnbktleSBmazsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJz\nID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAg\nICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUodGFic1tqXSkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\nICAgIGZrcyA9IHRhYnNbal0uZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICAg\nICAgICAgICAgICByZXBvc1RhYmxlID0gcmVwb3MuZmluZFRhYmxlKHRhYnNb\nal0pOwogICAgICAgICAgICAgICAgICAgIGlmICghdGFibGVzICYmIHJlcG9z\nVGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwg\nZmtzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChma3Nba10uaXNMb2dpY2FsKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZrID0g\nbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcG9zVGFibGUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZrID0gZmlu\nZEZvcmVpZ25LZXkocmVwb3NUYWJsZSwgZmtzW2tdKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHJlcG9zVGFibGUgPT0gbnVsbCB8fCBmayA9PSBu\ndWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAhZmtzW2tdLmVx\ndWFsc0ZvcmVpZ25LZXkoZmspKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoZHJvcEZvcmVpZ25LZXkoZmtzW2tdKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0YWJzW2pdLnJlbW92ZUZvcmVpZ25LZXko\nZmtzW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoImRyb3AtZmsiLCBma3Nba10sCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcHJpbWFyeSBr\nZXlzCiAgICAgICAgaWYgKF9wa3MpIHsKICAgICAgICAgICAgUHJpbWFyeUtl\neSBwazsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJzID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAg\nICAgIGlmICghaXNEcm9wcGFibGUodGFic1tqXSkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIHBrID0g\ndGFic1tqXS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBrICE9IG51bGwgJiYgcGsuaXNMb2dpY2FsKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBy\nZXBvc1RhYmxlID0gcmVwb3MuZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAg\nICAgICAgICAgICAgIGlmIChwayAhPSBudWxsICYmIHJlcG9zVGFibGUgIT0g\nbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAmJiAocmVwb3NUYWJsZS5n\nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAg\nICB8fCAhcGsuZXF1YWxzUHJpbWFyeUtleShyZXBvc1RhYmxlLmdldFByaW1h\ncnlLZXkoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9w\nUHJpbWFyeUtleShwaykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0\nYWJzW2pdLnJlbW92ZVByaW1hcnlLZXkoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJkcm9wLXBrIiwgcGssIHRhYnNbal0pKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIGNvbHVtbnMKICAgICAgICBDb2x1\nbW5bXSBjb2xzOwogICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgQ29sbGVj\ndGlvbiBkcm9wcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAgICAg\nICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAg\nICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUodGFic1tqXSkpCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjb2xz\nID0gdGFic1tqXS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICByZXBv\nc1RhYmxlID0gcmVwb3MuZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAg\nICAgICAgaWYgKHJlcG9zVGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgY29scy5sZW5ndGg7IGsrKykg\newogICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSByZXBvc1RhYmxlLmdl\ndENvbHVtbihjb2xzW2tdLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChjb2wgPT0gbnVsbCB8fCAhY29sc1trXS5lcXVhbHNDb2x1\nbW4oY29sKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRh\nYnNbal0uZ2V0Q29sdW1ucygpLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGRyb3BzLmFkZCh0YWJzW2pdKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRyb3BDb2x1bW4oY29s\nc1trXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFic1tq\nXS5yZW1vdmVDb2x1bW4oY29sc1trXSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLWNvbCIsIGNvbHNba10sCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbal0pKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gbm93IHRhYmxlcwogICAgICAgIGlmICh0YWJsZXMpIHsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRU\nYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwg\ndGFicy5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAgICAgICBpZiAoISFp\nc0Ryb3BwYWJsZSh0YWJzW2pdKQogICAgICAgICAgICAgICAgICAgICAgICAm\nJiByZXBvcy5maW5kVGFibGUodGFic1tqXSkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgZHJvcHMuYWRkKHRhYnNbal0pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGRyb3BUYWJsZXMoZHJvcHMsIGRiKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERyb3BzIGFsbCBkYXRhYmFzZSBjb21w\nb25lbnRzIGluIHRoZSBnaXZlbiByZXBvc2l0b3J5IHNjaGVtYS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGRyb3AoU2NoZW1hR3JvdXAgZGIsIFNjaGVt\nYUdyb3VwIHJlcG9zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGRyb3Agc2VxdWVuY2VzCiAgICAgICAgU2NoZW1hW10gc2No\nZW1hcyA9IHJlcG9zLmdldFNjaGVtYXMoKTsKICAgICAgICBpZiAoX3NlcXMp\nIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBzZXFzOwogICAgICAgICAgICBT\nZXF1ZW5jZSBkYlNlcTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzZXFz\nID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMoKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgc2Vxcy5sZW5ndGg7IGorKykgewogICAg\nICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUoc2Vxc1tqXSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgIGRiU2VxID0gZGIuZmluZFNlcXVlbmNlKHNlcXNbal0pOwogICAg\nICAgICAgICAgICAgICAgIGlmIChkYlNlcSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChkcm9wU2VxdWVuY2Uoc2Vxc1tqXSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBkYlNlcS5nZXRTY2hlbWEoKS5y\nZW1vdmVTZXF1ZW5jZShkYlNlcSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiZHJvcC1zZXEiLCBzZXFzW2pdKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBjYWxjdWxhdGUgdGFibGVzIHRvIGRyb3A7IHdl\nIGNhbiBvbmx5IGRyb3AgdGFibGVzIGlmIHdlJ3JlIHN1cmUKICAgICAgICAv\nLyB0aGUgdXNlciBsaXN0ZWQgdGhlIGVudGlyZSB0YWJsZSBkZWZpbml0aW9u\nIGluIHRoZSBzdHVmZiB0aGV5IHdhbnQKICAgICAgICAvLyBkcm9wcGVkOyBl\nbHNlIHRoZXkgbWlnaHQganVzdCB3YW50IHRvIGRyb3AgYSBmZXcgY29sdW1u\ncwogICAgICAgIENvbGxlY3Rpb24gZHJvcHMgPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgIFRhYmxlW10gdGFiczsKICAgICAgICBUYWJsZSBkYlRhYmxl\nOwogICAgICAgIENvbHVtbltdIGRiQ29sczsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\ndGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIHRh\nYmxlczoKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxl\nbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxl\nKHRhYnNbal0pKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsK\nICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgZGJDb2xz\nID0gZGJUYWJsZS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBrID0gMDsgayA8IGRiQ29scy5sZW5ndGg7IGsrKykKICAgICAgICAg\nICAgICAgICAgICBpZiAodGFic1tqXS5nZXRDb2x1bW4oZGJDb2xzW2tdLmdl\ndE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWUgdGFibGVzOwoKICAgICAgICAgICAgICAgIGRyb3BzLmFkZCh0YWJz\nW2pdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gb3Jk\nZXIgaXMgaW1wb3J0YW50IGluIHRoaXMgbWV0aG9kOyBzdGFydCB3aXRoIGZv\ncmVpZ24ga2V5cyBtZW50aW9uZWQKICAgICAgICAvLyBpbiB0aGUgZHJvcCBz\nY2hlbWEKICAgICAgICBpZiAoX2ZrcykgewogICAgICAgICAgICBGb3JlaWdu\nS2V5W10gZmtzOwogICAgICAgICAgICBGb3JlaWduS2V5IGZrOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxl\ncygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJz\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ry\nb3BwYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgZmtzID0gdGFic1tqXS5nZXRG\nb3JlaWduS2V5cygpOwogICAgICAgICAgICAgICAgICAgIGRiVGFibGUgPSBk\nYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAgZm9y\nIChpbnQgayA9IDA7IGsgPCBma3MubGVuZ3RoOyBrKyspIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGZrc1trXS5pc0xvZ2ljYWwoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgICAgICAgICAgZmsgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoZGJUYWJsZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmsgPSBmaW5kRm9yZWlnbktleShkYlRhYmxlLCBma3Nba10pOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSA9PSBudWxsIHx8\nIGZrID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wRm9yZWln\nbktleShma3Nba10pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGRiVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBkYlRhYmxlLnJlbW92ZUZvcmVpZ25LZXkoZmspOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1mayIsIGZrc1tr\nXSwgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYWxzbyBk\ncm9wIGltcG9ydGVkIGZvcmVpZ24ga2V5cyBmb3IgdGFibGVzIHRoYXQgd2ls\nbCBiZSBkcm9wcGVkCiAgICAgICAgICAgIFRhYmxlIHRhYjsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBkcm9wcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdGFiID0gKFRhYmxlKSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRU\nYWJsZSh0YWIpOwogICAgICAgICAgICAgICAgaWYgKGRiVGFibGUgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICBma3MgPSBkYi5maW5kRXhwb3J0ZWRGb3JlaWduS2V5cyhkYlRhYmxl\nLmdldFByaW1hcnlLZXkoKSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nICAgIGlmIChkcm9wRm9yZWlnbktleShma3NbaV0pKQogICAgICAgICAgICAg\nICAgICAgICAgICBkYlRhYmxlLnJlbW92ZUZvcmVpZ25LZXkoZmtzW2ldKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1mayIsIGZrc1tpXSwgZGJU\nYWJsZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBkcm9wIHRoZSB0YWJsZXMgd2UgY2FsY3VsYXRl\nZCBhYm92ZQogICAgICAgIGRyb3BUYWJsZXMoZHJvcHMsIGRiKTsKCiAgICAg\nICAgLy8gY29sdW1ucwogICAgICAgIENvbHVtbltdIGNvbHM7CiAgICAgICAg\nQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVt\nYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNb\naV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBq\nIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFp\nc0Ryb3BwYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgICAgIGNvbHMgPSB0YWJzW2pdLmdldENvbHVt\nbnMoKTsKICAgICAgICAgICAgICAgIGRiVGFibGUgPSBkYi5maW5kVGFibGUo\ndGFic1tqXSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8\nIGNvbHMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICBjb2wg\nPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IGRiVGFibGUuZ2V0\nQ29sdW1uKGNvbHNba10uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoZGJUYWJsZSA9PSBudWxsIHx8IGNvbCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAg\nICAgaWYgKGRyb3BDb2x1bW4oY29sc1trXSkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGRiVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGRiVGFibGUucmVtb3ZlQ29sdW1uKGNvbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1jb2wiLCBjb2xzW2td\nLCB0YWJzW2pdKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHRhYmxlIGlzIGRyb3BwYWJs\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzRHJvcHBhYmxlKFRh\nYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIF9vcGVuanBhVGFibGVzCiAg\nICAgICAgICAgIHx8ICghdGFibGUuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCku\nc3RhcnRzV2l0aCgiT1BFTkpQQV8iKQogICAgICAgICAgICAmJiAhdGFibGUu\nZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgiSkRPXyIpKTsg\nLy8gbGVnYWN5CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgc2VxdWVuY2UgaXMgZHJvcHBhYmxlLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gaXNEcm9wcGFibGUoU2VxdWVuY2Ugc2VxKSB7CiAgICAg\nICAgcmV0dXJuIF9vcGVuanBhVGFibGVzCiAgICAgICAgICAgIHx8ICghc2Vx\nLmdldE5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIk9QRU5KUEFf\nIikKICAgICAgICAgICAgJiYgIXNlcS5nZXROYW1lKCkudG9VcHBlckNhc2Uo\nKS5zdGFydHNXaXRoKCJKRE9fIikpOyAvLyBsZWdhY3kKICAgIH0KCiAgICAv\nKioKICAgICAqIEZpbmQgYW4gaW5kZXggaW4gdGhlIGdpdmVuIHRhYmxlIHRo\nYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gb25lLgogICAgICovCiAgICBwcml2YXRl\nIEluZGV4IGZpbmRJbmRleChUYWJsZSBkYlRhYmxlLCBJbmRleCBpZHgpIHsK\nICAgICAgICBJbmRleFtdIGlkeHMgPSBkYlRhYmxlLmdldEluZGV4ZXMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlkeHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmIChpZHguY29sdW1uc01hdGNoKGlkeHNbaV0uZ2V0\nQ29sdW1ucygpKSkKICAgICAgICAgICAgICAgIHJldHVybiBpZHhzW2ldOwog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogRmlu\nZCBhIGZvcmVpZ24ga2V5IGluIHRoZSBnaXZlbiB0YWJsZSB0aGF0IG1hdGNo\nZXMgdGhlIGdpdmVuIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSBGb3JlaWdu\nS2V5IGZpbmRGb3JlaWduS2V5KFRhYmxlIGRiVGFibGUsIEZvcmVpZ25LZXkg\nZmspIHsKICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCkubGVu\nZ3RoID4gMAogICAgICAgICAgICB8fCBmay5nZXRDb25zdGFudFByaW1hcnlL\nZXlDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IGRiVGFibGUuZ2V0Rm9y\nZWlnbktleXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZrcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZrLmNvbHVtbnNNYXRjaChm\na3NbaV0uZ2V0Q29sdW1ucygpLAogICAgICAgICAgICAgICAgZmtzW2ldLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCkpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGZrc1tpXTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gY29sbGVjdGlvbiBvZiB0YWJsZXMg\nZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLiBPcmRlcnMKICAgICAqIHRoZSBy\nZW1vdmFscyBhY2NvcmRpbmcgdG8gZm9yZWlnbiBrZXkgY29uc3RyYWludHMg\nb24gdGhlIHRhYmxlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRyb3BU\nYWJsZXMoQ29sbGVjdGlvbiB0YWJsZXMsIFNjaGVtYUdyb3VwIGNoYW5nZSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFi\nbGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBU\nYWJsZSB0YWJsZTsKICAgICAgICBUYWJsZSBjaGFuZ2VUYWJsZTsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRhYmxlcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICB0YWJsZSA9IChUYWJsZSkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgaWYgKGRyb3BUYWJsZSh0YWJsZSkpIHsK\nICAgICAgICAgICAgICAgIGNoYW5nZVRhYmxlID0gY2hhbmdlLmZpbmRUYWJs\nZSh0YWJsZSk7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlVGFibGUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VUYWJsZS5nZXRTY2hl\nbWEoKS5yZW1vdmVUYWJsZShjaGFuZ2VUYWJsZSk7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9w\nLXRhYmxlIiwgdGFibGUpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGdpdmVuIHRhYmxlIHRvIHRoZSBkYXRhYmFzZSBzY2hl\nbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRp\nb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVUYWJsZShUYWJsZSB0YWJsZSkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhl\nY3V0ZVNRTChfZGljdC5nZXRDcmVhdGVUYWJsZVNRTCh0YWJsZSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4gdGFibGUgZnJvbSB0\naGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhl\ncndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZHJvcFRhYmxlKFRh\nYmxlIHRhYmxlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldERyb3BUYWJsZVNRTCh0\nYWJsZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBz\nZXF1ZW5jZSB0byB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVs\nLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nY3JlYXRlU2VxdWVuY2UoU2VxdWVuY2Ugc2VxKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0\nLmdldENyZWF0ZVNlcXVlbmNlU1FMKHNlcSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogRHJvcCB0aGUgZ2l2ZW4gc2VxdWVuY2UgZnJvbSB0aGUgZGF0YWJh\nc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUg\nb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gZHJvcFNlcXVlbmNlKFNlcXVlbmNl\nIHNlcSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXREcm9wU2VxdWVuY2VTUUwoc2Vx\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGluZGV4\nIHRvIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVy\nbiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNl\nIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVJ\nbmRleChJbmRleCBpZHgsIFRhYmxlIHRhYmxlKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGludCBtYXggPSBfZGljdC5tYXhJbmRl\neGVzUGVyVGFibGU7CgogICAgICAgIGludCBsZW4gPSB0YWJsZS5nZXRJbmRl\neGVzKCkubGVuZ3RoOwogICAgICAgIGlmICh0YWJsZS5nZXRQcmltYXJ5S2V5\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgbGVuICs9IHRhYmxlLmdldFByaW1h\ncnlLZXkoKS5nZXRDb2x1bW5zKCkubGVuZ3RoOwoKICAgICAgICBpZiAobGVu\nID49IG1heCkgewogICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoInRv\nby1tYW55LWluZGV4ZXMiLCBpZHgsIHRhYmxlLCBtYXggKyAiIikpOwogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gZXhlY3V0ZVNRTChfZGljdC5nZXRDcmVhdGVJbmRleFNRTChpZHgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERyb3AgdGhlIGdpdmVuIGluZGV4IGZy\nb20gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ug\nb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGRyb3BJbmRl\neChJbmRleCBpZHgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0RHJvcEluZGV4U1FM\nKGlkeCkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBj\nb2x1bW4gdG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwg\nZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGFk\nZENvbHVtbihDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldEFkZENv\nbHVtblNRTChjb2wpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3AgdGhl\nIGdpdmVuIGNvbHVtbiBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAg\nKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1\nY2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBkcm9wQ29sdW1uKENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2Rp\nY3QuZ2V0RHJvcENvbHVtblNRTChjb2wpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgdG8gdGhlIGRhdGFiYXNl\nIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9w\nZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGFkZFByaW1hcnlLZXkoUHJpbWFyeUtl\neSBwaykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRBZGRQcmltYXJ5S2V5U1FMKHBr\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRoZSBnaXZlbiBwcmlt\nYXJ5IGtleSBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAg\nICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3Nm\ndWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBkcm9wUHJpbWFyeUtleShQcmltYXJ5S2V5IHBrKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9k\naWN0LmdldERyb3BQcmltYXJ5S2V5U1FMKHBrKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IHRvIHRoZSBkYXRh\nYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRo\nZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBhZGRGb3JlaWduS2V5KEZvcmVp\nZ25LZXkgZmspCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0QWRkRm9yZWlnbktleVNR\nTChmaykpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4g\nZm9yZWlnbiBrZXkgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoK\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNj\nZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZHJvcEZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNR\nTChfZGljdC5nZXREcm9wRm9yZWlnbktleVNRTChmaykpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAg\nKi8KICAgIHB1YmxpYyBTY2hlbWFHcm91cCBnZXREQlNjaGVtYUdyb3VwKCkg\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBnZXREQlNjaGVt\nYUdyb3VwKHRydWUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3Jl\nKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERCU2NoZW1hR3JvdXAoU2NoZW1hR3JvdXAgZGIpIHsKICAgICAg\nICBfZGIgPSBkYjsKICAgICAgICBpZiAoZGIgIT0gbnVsbCkKICAgICAgICAg\nICAgX2Z1bGxEQiA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZnVsbCBpZiBmYWxzZSwgb25seSB0aGUgdGFibGVzIG5hbWVkIGluIHRoZSBz\nZXQgc2NoZW1hCiAgICAgKiByZXBvc2l0b3J5IHdpbGwgYmUgZ2VuZXJhdGVk\nCiAgICAgKi8KICAgIHByaXZhdGUgU2NoZW1hR3JvdXAgZ2V0REJTY2hlbWFH\ncm91cChib29sZWFuIGZ1bGwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF9kYiA9PSBudWxsIHx8IChmdWxsICYmICFfZnVs\nbERCKSkgewogICAgICAgICAgICBTY2hlbWFHZW5lcmF0b3IgZ2VuID0gbmV3\nIFNjaGVtYUdlbmVyYXRvcihfY29uZik7CiAgICAgICAgICAgIGdlbi5zZXRQ\ncmltYXJ5S2V5cyhfcGtzKTsKICAgICAgICAgICAgZ2VuLnNldEZvcmVpZ25L\nZXlzKF9ma3MpOwogICAgICAgICAgICBnZW4uc2V0SW5kZXhlcyhfaW5kZXhl\ncyk7CiAgICAgICAgICAgIGlmIChmdWxsKQogICAgICAgICAgICAgICAgZ2Vu\nLmdlbmVyYXRlU2NoZW1hcygpOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIC8vIGdlbmVyYXRlIG9ubHkgdGhlIHRhYmxlcyBpbiB0aGUg\nZ2l2ZW4gcmVwb3NpdG9yeQogICAgICAgICAgICAgICAgLy8gZ3JvdXA7IHNv\nbWUgbWF5IG5vdCBleGlzdCB5ZXQsIHdoaWNoIGlzIE9LOyB3ZSBqdXN0IG5l\nZWQKICAgICAgICAgICAgICAgIC8vIHRvIG1ha2Ugc3VyZSB3ZSBjYW4gZGV0\nZWN0IHRoZSBjaGFuZ2VzIHRvIHRoZSBvbmVzIHRoYXQKICAgICAgICAgICAg\nICAgIC8vIGRvIGV4aXN0CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIHRh\nYmxlcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgICAgICAgICBTY2hl\nbWFHcm91cCBncm91cCA9IGFzc2VydFNjaGVtYUdyb3VwKCk7CiAgICAgICAg\nICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0gZ3JvdXAuZ2V0U2NoZW1hcygp\nOwogICAgICAgICAgICAgICAgVGFibGVbXSB0YWJzOwogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFi\nbGVzKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmICh0YWJzW2pdLmdldFNjaGVtYU5hbWUoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdGFibGVzLmFkZCgiLiIgKyB0YWJzW2pd\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlcy5hZGQodGFic1tqXS5n\nZXRGdWxsTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRhYmxlcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICAgICAgZ2VuLmdlbmVyYXRlU2NoZW1hcygo\nU3RyaW5nW10pIHRhYmxlcy50b0FycmF5CiAgICAgICAgICAgICAgICAgICAg\nICAgIChuZXcgU3RyaW5nW3RhYmxlcy5zaXplKCldKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgX2RiID0gZ2VuLmdldFNjaGVtYUdyb3VwKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfZGI7CiAgICB9CgogICAgcHJpdmF0\nZSBTY2hlbWFHcm91cCBhc3NlcnRTY2hlbWFHcm91cCgpIHsKICAgICAgICBT\nY2hlbWFHcm91cCBsb2NhbCA9IGdldFNjaGVtYUdyb3VwKCk7CiAgICAgICAg\naWYgKGxvY2FsID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRvb2wtbm9yZXBvcyIpKTsK\nICAgICAgICByZXR1cm4gbG9jYWw7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBFeGVjdXRlcyB0aGUgZ2l2ZW4gYXJyYXkgb2Ygbm9uLXNlbGVj\ndGluZyBTUUwgc3RhdGVtZW50cywgY29ycmVjdGx5CiAgICAgKiBsb2dnaW5n\nIHRoZSBTUUwgY2FsbHMgYW5kIG9wdGlvbmFsbHkgaWdub3JpbmcgZXJyb3Jz\nLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGVyZSB3YXMgU1FM\nIHRvIGV4ZWN1dGUgYW5kIHRoZSBjYWxscyB3ZXJlCiAgICAgKiBzdWNjZXNz\nZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIGV4ZWN1dGVTUUwoU3RyaW5nW10gc3FsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIC8vIGlmIG5vIHNxbCwgcHJvYmFibHkg\nYi9jIGRpY3Rpb25hcnkgZG9lc24ndCBzdXBwb3J0IG9wZXJhdGlvbgogICAg\nICAgIGlmIChzcWwubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgYm9vbGVhbiBlcnIgPSBmYWxzZTsKICAgICAgICBp\nZiAoX3dyaXRlciA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRoaXMgaXMg\nb3V0c2lkZSB0aGUgdHJ5LWNhdGNoIGJlY2F1c2UgYSBmYWlsdXJlIGhlcmUg\naXMKICAgICAgICAgICAgLy8gcmVhbGx5IGJhZCwgYW5kIHNob3VsZCBub3Qg\nYmUgaWdub3JlZC4KICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gX2Rz\nLmdldENvbm5lY3Rpb24oKTsKICAgICAgICAgICAgU3RhdGVtZW50IHN0YXRl\nbWVudCA9IG51bGw7CiAgICAgICAgICAgIGJvb2xlYW4gd2FzQXV0byA9IHRy\ndWU7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB3YXNBdXRv\nID0gY29ubi5nZXRBdXRvQ29tbWl0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nIXdhc0F1dG8pCiAgICAgICAgICAgICAgICAgICAgY29ubi5zZXRBdXRvQ29t\nbWl0KHRydWUpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzcWwubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICAvLyBzb21lIGNvbm5lY3Rpb25z\nIHJlcXVpcmUgdGhhdCByb2xsYmFjayBiZQogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBjYWxsZWQgb24gdGhlIGNvbm5lY3Rpb24gYmVmb3JlIGFueSBE\nREwgc3RhdGVtZW50cwogICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4g\nYmUgcnVuIG9uIGl0LCBldmVuIHdoZW4gYXV0b2NvbW1pdCBpcyBvbi4KICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBzb21ldGltZXMgYmVj\nYXVzZSB0aGUgY29ubmVjdGlvbiBkb2VzIG5vdAogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBhbGxvdyBEREwgc3RhdGVtZW50cyB3aGVuIHRoZXJlIGFy\nZSBtdWx0aXBsZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb21tYW5k\ncyBpc3N1ZWQgb24gdGhlIGNvbm5lY3Rpb24sIGFuZCB0aGUKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gY29ubmVjdGlvbiBwb29sIG1heSBoYXZlIGlz\nc3VlZCBzb21lIHZhbGlkYXRpb24gU1FMLgogICAgICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5y\nb2xsYmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgICAgICAgICBzdGF0ZW1lbnQgPSBjb25uLmNyZWF0ZVN0\nYXRlbWVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZW1lbnQu\nZXhlY3V0ZVVwZGF0ZShzcWxbaV0pOwoKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gc29tZSBjb25uZWN0aW9ucyBzZWVtIHRvIHJlcXVpcmUgYW4gZXhw\nbGljaXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tbWl0IGZvciBE\nREwgc3RhdGVtZW50cywgZXZlbiB3aGVuIGF1dG9jb21taXQKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gaXMgb24uIFRoZSBEYXRhRGlyZWN0IGRyaXZl\ncnMgc2VlbSB0byBzdWZmZXIgZnJvbQogICAgICAgICAgICAgICAgICAgICAg\nICAvLyB0aGlzIGxpbWl0YXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uLmNvbW1p\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXJyID0gdHJ1\nZTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlRXhjZXB0aW9uKHNl\nKTsKICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoc3RhdGVtZW50ICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHN0YXRlbWVudC5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKCF3YXNBdXRvKQog\nICAgICAgICAgICAgICAgICAgIGNvbm4uc2V0QXV0b0NvbW1pdChmYWxzZSk7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNv\nbm4uY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzcWwubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBfd3JpdGVyLnBy\naW50bG4oc3FsW2ldICsgIjsiKTsKICAgICAgICAgICAgX3dyaXRlci5mbHVz\naCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICFlcnI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIYW5kbGUgdGhlIGdpdmVuIGV4Y2VwdGlvbiwgbG9n\nZ2luZyBpdCBhbmQgb3B0aW9uYWxseSBpZ25vcmluZyBpdCwKICAgICAqIGRl\ncGVuZGluZyBvbiB0aGUgZmxhZ3MgdGhpcyBTY2hlbWFUb29sIHdhcyBjcmVh\ndGVkIHdpdGguCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYW5kbGVFeGNl\ncHRpb24oU1FMRXhjZXB0aW9uIHNxbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoIV9pZ25vcmVFcnJzKQogICAgICAgICAg\nICB0aHJvdyBzcWw7CiAgICAgICAgX2xvZy53YXJuKHNxbC5nZXRNZXNzYWdl\nKCksIHNxbCk7CiAgICB9CgogICAgLy8vLy8vLy8KICAgIC8vIE1haW4KICAg\nIC8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hVG9vbCBbb3B0aW9uXSoK\nICAgICAqIFstYWN0aW9uLy1hICZsdDthZGQgfCByZXRhaW4gfCBkcm9wIHwg\ncmVmcmVzaCB8IGNyZWF0ZURCIHwgZHJvcERCCiAgICAgKiB8IGJ1aWxkIHwg\ncmVmbGVjdCB8IGltcG9ydCB8IGV4cG9ydCZndDtdCiAgICAgKiAmbHQ7LnNj\naGVtYSBmaWxlIG9yIHJlc291cmNlJmd0OyoKICAgICAqICBXaGVyZSB0aGUg\nZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJlY29nbml6ZWQuCiAgICAgKiA8dWw+\nCiAgICAgKiA8bGk+PGk+LXByb3BlcnRpZXMvLXAgJmx0O3Byb3BlcnRpZXMg\nZmlsZSBvciByZXNvdXJjZSZndDs8L2k+OiBUaGUKICAgICAqIHBhdGggb3Ig\ncmVzb3VyY2UgbmFtZSBvZiBhIE9wZW5KUEEgcHJvcGVydGllcyBmaWxlIGNv\nbnRhaW5pbmcKICAgICAqIGluZm9ybWF0aW9uIHN1Y2ggYXMgdGhlIGxpY2Vu\nc2Uga2V5CWFuZCBjb25uZWN0aW9uIGRhdGEgYXMKICAgICAqIG91dGxpbmVk\nIGluIHtAbGluayBKREJDQ29uZmlndXJhdGlvbn0uIE9wdGlvbmFsLjwvbGk+\nCiAgICAgKiA8bGk+PGk+LSZsdDtwcm9wZXJ0eSBuYW1lJmd0OyAmbHQ7cHJv\ncGVydHkgdmFsdWUmZ3Q7PC9pPjogQWxsIGJlYW4KICAgICAqIHByb3BlcnRp\nZXMgb2YgdGhlIE9wZW5KUEEge0BsaW5rIEpEQkNDb25maWd1cmF0aW9ufSBj\nYW4gYmUgc2V0IGJ5CiAgICAgKiB1c2luZyB0aGVpcgluYW1lcyBhbmQgc3Vw\ncGx5aW5nIGEgdmFsdWUuIEZvciBleGFtcGxlOgogICAgICogPGNvZGU+LWxp\nY2Vuc2VLZXkgYWRzbGZqYTgzcjNsa2FkZjwvY29kZT48L2xpPgogICAgICog\nPGxpPjxpPi1pZ25vcmVFcnJvcnMvLWkgJmx0O3RydWUvdCB8IGZhbHNlL2Ym\nZ3Q7PC9pPjogSWYgZmFsc2UsIGFuCiAgICAgKiBleGNlcHRpb24gd2lsbCB3\naWxsIGJlIHRocm93biBpZiB0aGUgdG9vbCBlbmNvdW50ZXJzIGFueSBkYXRh\nYmFzZQogICAgICogZXhjZXB0aW9uczsgZGVmYXVsdHMgdG8gPGNvZGU+ZmFs\nc2U8L2NvZGU+LjwvbGk+CiAgICAgKiA8bGk+PGk+LWZpbGUvLWYgJmx0O3N0\nZG91dCB8IG91dHB1dCBmaWxlIG9yIHJlc291cmNlJmd0OzwvaT46IFVzZSB0\naGlzCiAgICAgKiBvcHRpb24gdG8gd3JpdGUgYSBTUUwgc2NyaXB0IGZvciB0\naGUgcGxhbm5lZCBzY2hlbWEgbW9kaWZpY2F0aW9ucywKICAgICAqIHJhdGhl\nciB0aGFuIGNvbW1pdHRpbmcgdGhlbSB0byB0aGUgZGF0YWJhc2UuIFRoaXMg\nb3B0aW9uIGFsc28KICAgICAqIGFwcGxpZXMgdG8gdGhlIDxjb2RlPmV4cG9y\ndDwvY29kZT4gYW5kIDxjb2RlPnJlZmxlY3Q8L2NvZGU+IGFjdGlvbnMuPC9s\naT4KICAgICAqIDxsaT48aT4tb3BlbmpwYVRhYmxlcy8ta3QgJmx0O3RydWUv\ndCB8IGZhbHNlL2YmZ3Q7PC9pPjogVW5kZXIgdGhlCiAgICAgKiA8Y29kZT5y\nZWZsZWN0PC9jb2RlPiBhY3Rpb24sIHdoZXRoZXIgdG8gcmVmbGVjdCBvbiB0\nYWJsZXMgd2l0aAogICAgICogdGhlIG5hbWUgPGNvZGU+T1BFTkpQQV8qPC9j\nb2RlPi4gVW5kZXIgb3RoZXIgYWN0aW9ucywgd2hldGhlciB0bwogICAgICog\nZHJvcCBzdWNoIHRhYmxlcy4gRGVmYXVsdHMgdG8gPGNvZGU+ZmFsc2U8L2Nv\nZGU+LjwvbGk+CiAgICAgKiA8bGk+PGk+LWRyb3BUYWJsZXMvLWR0ICZsdDt0\ncnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0aGlzIG9wdGlvbiB0bwog\nICAgICogdHJ1ZSB0byBkcm9wIHRhYmxlcyB0aGF0IGFwcGVhciB0byBiZSB1\nbnVzZWQgZHVyaW5nCiAgICAgKiA8Y29kZT5yZXRhaW48L2NvZGU+CWFuZCA8\nY29kZT5yZWZyZXNoPC9jb2RlPiBhY3Rpb25zLiBEZWZhdWx0cyB0bwogICAg\nICogPGNvZGU+dHJ1ZTwvY29kZT4uPC9saT4KICAgICAqIDxsaT48aT4tZHJv\ncFNlcXVlbmNlcy8tZHNxICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46\nIFNldCB0aGlzIG9wdGlvbgogICAgICogdG8gdHJ1ZSB0byBkcm9wIHNlcXVl\nbmNlcyB0aGF0IGFwcGVhciB0byBiZSB1bnVzZWQgZHVyaW5nCiAgICAgKiA8\nY29kZT5yZXRhaW48L2NvZGU+CWFuZCA8Y29kZT5yZWZyZXNoPC9jb2RlPiBh\nY3Rpb25zLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+dHJ1ZTwvY29kZT4u\nPC9saT4KICAgICAqIDxsaT48aT4tcHJpbWFyeUtleXMvLXBrICZsdDt0cnVl\nL3QgfCBmYWxzZS9mJmd0OzwvaT46IFdoZXRoZXIgcHJpbWFyeQogICAgICog\na2V5cyBvbiBleGlzdGluZyB0YWJsZXMgYXJlIG1hbmlwdWxhdGVkLiBEZWZh\ndWx0cyB0byB0cnVlLjwvbGk+CiAgICAgKiA8bGk+PGk+LWZvcmVpZ25LZXlz\nLy1mayAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBXaGV0aGVyIGZv\ncmVpZ24KICAgICAqIGtleXMgb24gZXhpc3RpbmcgdGFibGVzIGFyZSBtYW5p\ncHVsYXRlZC4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgogICAgICogPGxpPjxp\nPi1pbmRleGVzLy1peCAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBX\naGV0aGVyIGluZGV4ZXMKICAgICAqIG9uIGV4aXN0aW5nIHRhYmxlcyBhcmUg\nbWFuaXB1bGF0ZWQuIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxs\naT48aT4tc2VxdWVuY2VzLy1zcSAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8\nL2k+OiBXaGV0aGVyIHRvCiAgICAgKiBtYW5pcHVsYXRlIHNlcXVlbmNlcy4g\nRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgogICAgICogPGxpPjxpPi1yZWNvcmQv\nLXIgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0IHRoaXMgb3B0\naW9uIHRvCiAgICAgKiA8Y29kZT5mYWxzZTwvY29kZT4gdG8gcHJldmVudCB3\ncml0aW5nIHRoZSBzY2hlbWEgY2hhbmdlcyB0byB0aGUKICAgICAqIGN1cnJl\nbnQge0BsaW5rIFNjaGVtYUZhY3Rvcnl9LjwvbGk+CiAgICAgKiA8L3VsPgog\nICAgICogIEFjdGlvbnMgY2FuIGJlIGNvbXBvc2VkIGluIGEgY29tbWEtc2Vw\nYXJhdGVkIGxpc3QuIFRoZSB2YXJpb3VzIGFjdGlvbnMgCiAgICAgKiAgYXJl\nIGFzIGZvbGxvd3MuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+YWRkPC9p\nPjogQnJpbmcgdGhlIHNjaGVtYSB1cC10by1kYXRlIHdpdGggdGhlIGxhdGVz\ndAogICAgICogY2hhbmdlcyB0byB0aGUgc2NoZW1hIFhNTCBkYXRhIGJ5IGFk\nZGluZyB0YWJsZXMsIGNvbHVtbnMsCiAgICAgKiBpbmRleGVzLCBldGMuIFRo\naXMgYWN0aW9uIG5ldmVyIGRyb3BzIGFueSBkYXRhLiBUaGlzIGlzIHRoZQog\nICAgICogZGVmYXVsdCBhY3Rpb24uPC9saT4KICAgICAqIDxsaT48aT5yZXRh\naW48L2k+OiBLZWVwIGFsbCBzY2hlbWEgY29tcG9uZW50cyBpbiB0aGUgc2No\nZW1hIFhNTCwgYnV0CiAgICAgKiBkcm9wIHRoZSByZXN0IGZyb20gdGhlIGRh\ndGFiYXNlLiBUaGlzIGFjdGlvbiBuZXZlciBhZGRzIGFueSBkYXRhLjwvbGk+\nCiAgICAgKiA8bGk+PGk+ZHJvcDwvaT46IERyb3AgYWxsIHRoZSBzY2hlbWEg\nY29tcG9uZW50cyBpbiB0aGUgc2NoZW1hIFhNTC48L2xpPgogICAgICogPGxp\nPjxpPnJlZnJlc2g8L2k+OiBFcXVpdmFsZW50IHRvIHJldGFpbiwgdGhlbiBh\nZGQuPC9saT4KICAgICAqIDxsaT48aT5jcmVhdGVEQjwvaT46IEV4ZWN1dGUg\nU1FMIHRvIHJlLWNyZWF0ZSB0aGUgY3VycmVudCBkYXRhYmFzZS4KICAgICAq\nIFRoaXMgYWN0aW9uIGlzIHR5cGljYWxseSB1c2VkIGluIGNvbmp1Y3Rpb24g\nd2l0aCB0aGUKICAgICAqIDxjb2RlPmZpbGU8L2NvZGU+IG9wdGlvbi48L2xp\nPgogICAgICogPGxpPjxpPmJ1aWxkPC9pPjogRXhlY3V0ZSBTUUwgdG8gYnVp\nbGQgdGhlIHNjaGVtYSBkZWZpbmVkIGluIHRoZSBYTUwuCiAgICAgKiBCZWNh\ndXNlIGl0IGRvZXNuJ3QgdGFrZSB0aGUgY3VycmVudCBkYXRhYmFzZSBzY2hl\nbWEgaW50byBhY2NvdW50LAogICAgICogdGhpcyBhY3Rpb24gaXMgdHlwaWNh\nbGx5IHVzZWQgaW4gY29uanVjdGlvbiB3aXRoIHRoZQogICAgICogPGNvZGU+\nZmlsZTwvY29kZT4gb3B0aW9uLjwvbGk+CiAgICAgKiA8bGk+PGk+cmVmbGVj\ndDwvaT46IFJlZmxlY3Qgb24gdGhlIGN1cnJlbnQgZGF0YWJhc2Ugc2NoZW1h\nLiBXcml0ZSB0aGUKICAgICAqIHNjaGVtYSdzIFhNTCByZXByZXNlbnRhdGlv\nbiB0byB0aGUgZmlsZSBzcGVjaWZpZWQgd2l0aCB0aGUKICAgICAqIDxjb2Rl\nPmZpbGU8L2NvZGU+IG9wdGlvbiwgb3IgdG8gc3Rkb3V0IGlmIG5vIGZpbGUg\naXMgZ2l2ZW4uPC9saT4KICAgICAqIDxsaT48aT5kcm9wREI8L2k+OiBFeGVj\ndXRlIFNRTCB0byBkcm9wIHRoZSBjdXJyZW50IGRhdGFiYXNlLiBUaGlzCiAg\nICAgKiBhY3Rpb24gaW1wbGllcyA8Y29kZT5kcm9wVGFibGVzPC9jb2RlPi48\nL2xpPgogICAgICogPGxpPjxpPmRlbGV0ZVRhYmxlQ29udGVudHM8L2k+OiBF\neGVjdXRlIFNRTCB0byBkZWxldGUgYWxsIHJvd3MgZnJvbSAKICAgICAqIGFs\nbCB0YWJsZXMgdGhhdCBPcGVuSlBBIGtub3dzIGFib3V0LjwvbGk+CiAgICAg\nKiA8bGk+PGk+aW1wb3J0PC9pPjogSW1wb3J0IHRoZSBnaXZlbiBYTUwgc2No\nZW1hIGRlZmluaXRpb24gaW50byB0aGUKICAgICAqIGN1cnJlbnQge0BsaW5r\nIFNjaGVtYUZhY3Rvcnl9LjwvbGk+CiAgICAgKiA8bGk+PGk+ZXhwb3J0PC9p\nPjogRXhwb3J0IHRoZSBjdXJyZW50IHtAbGluayBTY2hlbWFGYWN0b3J5fSdz\nIHJlY29yZGVkCiAgICAgKiBzY2hlbWEgdG8gYW4gWE1MIHNjaGVtYSBkZWZp\nbml0aW9uIGZpbGUuPC9saT4KICAgICAqIDwvdWw+CiAgICAgKiAgRXhhbXBs\nZXM6CiAgICAgKiA8dWw+CiAgICAgKiA8bGk+V3JpdGUgYSBzY3JpcHQgdG8g\nc3Rkb3V0IHRvIHJlLWNyZWF0ZSB0aGUgY3VycmVudCBkYXRhYmFzZQogICAg\nICogc2NoZW1hOjxiciAvPgogICAgICogPGNvZGU+amF2YSBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hVG9vbCAtZiBzdGRvdXQgCiAg\nICAgKiAtYSBjcmVhdGVEQjwvY29kZT48L2xpPgogICAgICogPGxpPkRyb3Ag\ndGhlIGN1cnJlbnQgZGF0YWJhc2Ugc2NoZW1hOjxiciAvPgogICAgICogPGNv\nZGU+amF2YSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1h\nVG9vbCAKICAgICAqIC1hIGRyb3BEQjwvY29kZT48L2xpPgogICAgICogPGxp\nPlJlZnJlc2ggdGhlIHNjaGVtYSBhbmQgZGVsZXRlIGFsbCByZWNvcmRzIGlu\nIGFsbCB0YWJsZXM6PGJyIC8+CiAgICAgKiA8Y29kZT5qYXZhIG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFUb29sIAogICAgICogLWEg\ncmVmcmVzaCxkZWxldGVUYWJsZUNvbnRlbnRzPC9jb2RlPjwvbGk+CiAgICAg\nKiA8bGk+Q3JlYXRlIGEgc2NoZW1hIGJhc2VkIG9uIGFuIFhNTCBzY2hlbWEg\nZGVmaW5pdGlvbiBmaWxlOjxiciAvPgogICAgICogPGNvZGU+amF2YSBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hVG9vbCAKICAgICAq\nIG15c2NoZW1hLnhtbDwvY29kZT48L2xpPgogICAgICogPC91bD4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykK\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBh\ncmdzID0gb3B0cy5zZXRGcm9tQ21kTGluZShhcmdzKTsKICAgICAgICBKREJD\nQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IEpEQkNDb25maWd1cmF0aW9uSW1w\nbCgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghcnVuKGNvbmYs\nIGFyZ3MsIG9wdHMpKQogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmlu\ndGxuKF9sb2MuZ2V0KCJ0b29sLXVzYWdlIikpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFsc2Ug\naWYgYW55IGludmFsaWQgb3B0aW9ucyB3ZXJlIGdpdmVuLgogICAgICoKICAg\nICAqIEBzZWUgI21haW4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29s\nZWFuIHJ1bihKREJDQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdz\nLAogICAgICAgIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9wdHMuY29udGFp\nbnNLZXkoImhlbHAiKSB8fCBvcHRzLmNvbnRhaW5zS2V5KCItaGVscCIpKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEZsYWdzIGZsYWdz\nID0gbmV3IEZsYWdzKCk7CiAgICAgICAgZmxhZ3MuZHJvcFRhYmxlcyA9IG9w\ndHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiZHJvcFRh\nYmxlcyIsICJkdCIsIGZsYWdzLmRyb3BUYWJsZXMpOwogICAgICAgIGZsYWdz\nLmRyb3BTZXF1ZW5jZXMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQog\nICAgICAgICAgICAoImRyb3BTZXF1ZW5jZXMiLCAiZHNxIiwgZmxhZ3MuZHJv\ncFNlcXVlbmNlcyk7CiAgICAgICAgZmxhZ3MuaWdub3JlRXJyb3JzID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJpZ25vcmVF\ncnJvcnMiLCAiaSIsIGZsYWdzLmlnbm9yZUVycm9ycyk7CiAgICAgICAgZmxh\nZ3Mub3BlbmpwYVRhYmxlcyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5\nCiAgICAgICAgICAgICgib3BlbmpwYVRhYmxlcyIsICJvdCIsIGZsYWdzLm9w\nZW5qcGFUYWJsZXMpOwogICAgICAgIGZsYWdzLnByaW1hcnlLZXlzID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJwcmltYXJ5\nS2V5cyIsICJwayIsIGZsYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICBmbGFn\ncy5mb3JlaWduS2V5cyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgiZm9yZWlnbktleXMiLCAiZmtzIiwgZmxhZ3MuZm9yZWln\nbktleXMpOwogICAgICAgIGZsYWdzLmluZGV4ZXMgPSBvcHRzLnJlbW92ZUJv\nb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImluZGV4ZXMiLCAiaXgiLCBm\nbGFncy5pbmRleGVzKTsKICAgICAgICBmbGFncy5zZXF1ZW5jZXMgPSBvcHRz\nLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInNlcXVlbmNl\ncyIsICJzcSIsIGZsYWdzLnNlcXVlbmNlcyk7CiAgICAgICAgZmxhZ3MucmVj\nb3JkID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkoInJlY29yZCIsICJy\nIiwgZmxhZ3MucmVjb3JkKTsKICAgICAgICBTdHJpbmcgZmlsZU5hbWUgPSBv\ncHRzLnJlbW92ZVByb3BlcnR5KCJmaWxlIiwgImYiLCBudWxsKTsKICAgICAg\nICBTdHJpbmcgc2NoZW1hcyA9IG9wdHMucmVtb3ZlUHJvcGVydHkoInMiKTsK\nICAgICAgICBpZiAoc2NoZW1hcyAhPSBudWxsKQogICAgICAgICAgICBvcHRz\nLnNldFByb3BlcnR5KCJzY2hlbWFzIiwgc2NoZW1hcyk7CgogICAgICAgIFN0\ncmluZ1tdIGFjdGlvbnMgPSBvcHRzLnJlbW92ZVByb3BlcnR5KCJhY3Rpb24i\nLCAiYSIsIGZsYWdzLmFjdGlvbikKICAgICAgICAgICAgLnNwbGl0KCIsIik7\nCiAgICAgICAgCiAgICAgICAgLy8gc2V0dXAgYSBjb25maWd1cmF0aW9uIGlu\nc3RhbmNlIHdpdGggY21kLWxpbmUgaW5mbwogICAgICAgIENvbmZpZ3VyYXRp\nb25zLnBvcHVsYXRlQ29uZmlndXJhdGlvbihjb25mLCBvcHRzKTsKCiAgICAg\nICAgLy8gY3JlYXRlIHNjcmlwdCB3cml0ZXIKICAgICAgICBDbGFzc0xvYWRl\nciBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgog\nICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihTY2hlbWFUb29sLmNsYXNzLCBu\ndWxsKTsKICAgICAgICBmbGFncy53cml0ZXIgPSBGaWxlcy5nZXRXcml0ZXIo\nZmlsZU5hbWUsIGxvYWRlcik7CgogICAgICAgIGJvb2xlYW4gcmV0dXJuVmFs\ndWUgPSB0cnVlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYWN0aW9u\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBmbGFncy5hY3Rpb24gPSBh\nY3Rpb25zW2ldOwogICAgICAgICAgICByZXR1cm5WYWx1ZSAmPSBydW4oY29u\nZiwgYXJncywgZmxhZ3MsIGxvYWRlcik7CiAgICAgICAgfQogICAgICAgIAog\nICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJuIGZhbHNlIGlmIGludmFsaWQgb3B0\naW9ucyB3ZXJlIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJv\nb2xlYW4gcnVuKEpEQkNDb25maWd1cmF0aW9uIGNvbmYsIFN0cmluZ1tdIGFy\nZ3MsCiAgICAgICAgRmxhZ3MgZmxhZ3MsIENsYXNzTG9hZGVyIGxvYWRlcikK\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0\naW9uLkxPR19UT09MKTsKICAgICAgICBpZiAoQUNUSU9OX1JFRkxFQ1QuZXF1\nYWxzKGZsYWdzLmFjdGlvbikpIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgaWYgKGZsYWdzLndyaXRlciA9PSBudWxsKQogICAgICAgICAgICAg\nICAgZmxhZ3Mud3JpdGVyID0gbmV3IFByaW50V3JpdGVyKFN5c3RlbS5vdXQp\nOwoKICAgICAgICAgICAgU2NoZW1hR2VuZXJhdG9yIGdlbiA9IG5ldyBTY2hl\nbWFHZW5lcmF0b3IoY29uZik7CiAgICAgICAgICAgIGdlbi5zZXRQcmltYXJ5\nS2V5cyhmbGFncy5wcmltYXJ5S2V5cyk7CiAgICAgICAgICAgIGdlbi5zZXRJ\nbmRleGVzKGZsYWdzLmluZGV4ZXMpOwogICAgICAgICAgICBnZW4uc2V0Rm9y\nZWlnbktleXMoZmxhZ3MuZm9yZWlnbktleXMpOwogICAgICAgICAgICBnZW4u\nc2V0U2VxdWVuY2VzKGZsYWdzLnNlcXVlbmNlcyk7CiAgICAgICAgICAgIGdl\nbi5zZXRPcGVuSlBBVGFibGVzKGZsYWdzLm9wZW5qcGFUYWJsZXMpOwoKICAg\nICAgICAgICAgU3RyaW5nIHNjaGVtYXMgPSBjb25mLmdldFNjaGVtYXMoKTsK\nICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc2NoZW1hcykp\nCiAgICAgICAgICAgICAgICBzY2hlbWFzID0gImFsbCI7CiAgICAgICAgICAg\nIGxvZy5pbmZvKF9sb2MuZ2V0KCJzY2gtcmVmbGVjdCIsIHNjaGVtYXMpKTsK\nICAgICAgICAgICAgZ2VuLmdlbmVyYXRlU2NoZW1hcygpOwoKICAgICAgICAg\nICAgLy8gcmVjb3JkIHRoZSBzY2hlbWEKICAgICAgICAgICAgbG9nLmluZm8o\nX2xvYy5nZXQoInNjaC1yZWZsZWN0LXdyaXRlIikpOwogICAgICAgICAgICBT\nY2hlbWFTZXJpYWxpemVyIHNlciA9IG5ldyBYTUxTY2hlbWFTZXJpYWxpemVy\nKGNvbmYpOwogICAgICAgICAgICBzZXIuYWRkQWxsKGdlbi5nZXRTY2hlbWFH\ncm91cCgpKTsKICAgICAgICAgICAgc2VyLnNlcmlhbGl6ZShmbGFncy53cml0\nZXIsIHNlci5QUkVUVFkpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICB9CgogICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAwCiAgICAgICAg\nICAgICYmICFBQ1RJT05fQ1JFQVRFREIuZXF1YWxzKGZsYWdzLmFjdGlvbikK\nICAgICAgICAgICAgJiYgIUFDVElPTl9EUk9QREIuZXF1YWxzKGZsYWdzLmFj\ndGlvbikKICAgICAgICAgICAgJiYgIUFDVElPTl9FWFBPUlQuZXF1YWxzKGZs\nYWdzLmFjdGlvbikKICAgICAgICAgICAgJiYgIUFDVElPTl9ERUxFVEVfVEFC\nTEVfQ09OVEVOVFMuZXF1YWxzKGZsYWdzLmFjdGlvbikpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gcGFyc2UgaW4gdGhlIGFyZ3Vt\nZW50cwogICAgICAgIFNjaGVtYVBhcnNlciBwYXJzZXIgPSBuZXcgWE1MU2No\nZW1hUGFyc2VyKGNvbmYpOwogICAgICAgIHBhcnNlci5zZXREZWxheUNvbnN0\ncmFpbnRSZXNvbHZlKHRydWUpOwogICAgICAgIEZpbGUgZmlsZTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgZmlsZSA9IEZpbGVzLmdldEZpbGUoYXJnc1tpXSwgbG9hZGVy\nKTsKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtcnVubmlu\nZyIsIGZpbGUpKTsKICAgICAgICAgICAgcGFyc2VyLnBhcnNlKGZpbGUpOwog\nICAgICAgIH0KICAgICAgICBwYXJzZXIucmVzb2x2ZUNvbnN0cmFpbnRzKCk7\nCgogICAgICAgIGlmIChBQ1RJT05fSU1QT1JULmVxdWFscyhmbGFncy5hY3Rp\nb24pKSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJ0b29sLWlt\ncG9ydC1zdG9yZSIpKTsKICAgICAgICAgICAgU2NoZW1hR3JvdXAgc2NoZW1h\nID0gcGFyc2VyLmdldFNjaGVtYUdyb3VwKCk7CiAgICAgICAgICAgIGNvbmYu\nZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCkuc3RvcmVTY2hlbWEoc2NoZW1h\nKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIGlmIChBQ1RJT05fRVhQT1JULmVxdWFscyhmbGFncy5hY3Rpb24pKSB7CiAg\nICAgICAgICAgIGlmIChmbGFncy53cml0ZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGZsYWdzLndyaXRlciA9IG5ldyBQcmludFdyaXRlcihTeXN0ZW0u\nb3V0KTsKCiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJ0b29sLWV4\ncG9ydC1nZW4iKSk7CiAgICAgICAgICAgIFNjaGVtYUdyb3VwIHNjaGVtYSA9\nIGNvbmYuZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCkucmVhZFNjaGVtYSgp\nOwoKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtZXhwb3J0\nLXdyaXRlIikpOwogICAgICAgICAgICBTY2hlbWFTZXJpYWxpemVyIHNlciA9\nIG5ldyBYTUxTY2hlbWFTZXJpYWxpemVyKGNvbmYpOwogICAgICAgICAgICBz\nZXIuYWRkQWxsKHNjaGVtYSk7CiAgICAgICAgICAgIHNlci5zZXJpYWxpemUo\nZmxhZ3Mud3JpdGVyLCBzZXIuUFJFVFRZKTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQoKICAgICAgICBTY2hlbWFUb29sIHRvb2wgPSBu\nZXcgU2NoZW1hVG9vbChjb25mLCBmbGFncy5hY3Rpb24pOwogICAgICAgIHRv\nb2wuc2V0SWdub3JlRXJyb3JzKGZsYWdzLmlnbm9yZUVycm9ycyk7CiAgICAg\nICAgdG9vbC5zZXREcm9wVGFibGVzKGZsYWdzLmRyb3BUYWJsZXMpOwogICAg\nICAgIHRvb2wuc2V0U2VxdWVuY2VzKGZsYWdzLnNlcXVlbmNlcyk7IC8vIHNl\ndCBiZWZvcmUgZHJvcHNlcXMKICAgICAgICB0b29sLnNldERyb3BTZXF1ZW5j\nZXMoZmxhZ3MuZHJvcFNlcXVlbmNlcyk7CiAgICAgICAgdG9vbC5zZXRQcmlt\nYXJ5S2V5cyhmbGFncy5wcmltYXJ5S2V5cyk7CiAgICAgICAgdG9vbC5zZXRG\nb3JlaWduS2V5cyhmbGFncy5mb3JlaWduS2V5cyk7CiAgICAgICAgdG9vbC5z\nZXRJbmRleGVzKGZsYWdzLmluZGV4ZXMpOwogICAgICAgIHRvb2wuc2V0T3Bl\nbkpQQVRhYmxlcyhmbGFncy5vcGVuanBhVGFibGVzKTsKICAgICAgICBpZiAo\nYXJncy5sZW5ndGggPiAwKQogICAgICAgICAgICB0b29sLnNldFNjaGVtYUdy\nb3VwKHBhcnNlci5nZXRTY2hlbWFHcm91cCgpKTsKICAgICAgICBpZiAoZmxh\nZ3Mud3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgIHRvb2wuc2V0V3JpdGVy\nKGZsYWdzLndyaXRlcik7CgogICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJ0\nb29sLWFjdGlvbiIsIGZsYWdzLmFjdGlvbikpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHRvb2wucnVuKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKGZsYWdzLnJlY29yZCkgewogICAgICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtcmVjb3JkIikpOwogICAgICAgICAg\nICAgICAgdG9vbC5yZWNvcmQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAoZmxhZ3Mud3JpdGVyICE9IG51bGwpCiAgICAgICAgICAg\nIGZsYWdzLndyaXRlci5mbHVzaCgpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJ1biBmbGFncy4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBjbGFzcyBGbGFncyB7CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgYWN0aW9uID0gQUNUSU9OX0FERDsKICAgICAgICBwdWJsaWMgV3Jp\ndGVyIHdyaXRlciA9IG51bGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4gZHJv\ncFRhYmxlcyA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gZHJvcFNl\ncXVlbmNlcyA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gaWdub3Jl\nRXJyb3JzID0gZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gb3Blbmpw\nYVRhYmxlcyA9IGZhbHNlOwogICAgICAgIHB1YmxpYyBib29sZWFuIHByaW1h\ncnlLZXlzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBmb3JlaWdu\nS2V5cyA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gaW5kZXhlcyA9\nIHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gc2VxdWVuY2VzID0gdHJ1\nZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZWNvcmQgPSB0cnVlOwogICAg\nfQp9Cg==\n","encoding":"base64"}

