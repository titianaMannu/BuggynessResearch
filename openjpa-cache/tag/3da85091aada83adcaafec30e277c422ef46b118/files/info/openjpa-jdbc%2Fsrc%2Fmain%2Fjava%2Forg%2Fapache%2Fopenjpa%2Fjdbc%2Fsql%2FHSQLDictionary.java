{"sha":"8f4f7d6d0a48f7db393a4f66a71a6a91adf64023","node_id":"MDQ6QmxvYjIwNjM2NDo4ZjRmN2Q2ZDBhNDhmN2RiMzkzYTRmNjZhNzFhNmE5MWFkZjY0MDIz","size":11140,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8f4f7d6d0a48f7db393a4f66a71a6a91adf64023","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0\nIGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwu\nU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlzOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmhzcWxkYi5UcmFjZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkZpbHRl\nclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5SZWZlcmVudGlhbEludGVncml0eUV4Y2VwdGlvbjsKCi8qKgogKiBEaWN0\naW9uYXJ5IGZvciBIeXBlcnNvbmljIFNRTCBkYXRhYmFzZS4KICovCnB1Ymxp\nYyBjbGFzcyBIU1FMRGljdGlvbmFyeQogICAgZXh0ZW5kcyBEQkRpY3Rpb25h\ncnkgewoKICAgIC8qKgogICAgICogU2V0cyB3aGV0aGVyIEhTUUwgc2hvdWxk\nIHVzZSAiQ1JFQVRFRCBDQUNIRUQgVEFCTEUiIHJhdGhlciB0aGFuCiAgICAg\nKiAiQ1JFQVRFIFRBQkxFIiwgd2hpY2ggYWxsb3dzIGRpc2stYmFzZWQgZGF0\nYWJhc2Ugb3BlcmF0aW9ucy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nY2FjaGVUYWJsZXMgPSBmYWxzZTsKCiAgICBwcml2YXRlIFNRTEJ1ZmZlciBf\nb25lQnVmZmVyID0gbmV3IFNRTEJ1ZmZlcih0aGlzKS5hcHBlbmQoIjEiKTsK\nCiAgICBwdWJsaWMgSFNRTERpY3Rpb25hcnkoKSB7CiAgICAgICAgcGxhdGZv\ncm0gPSAiSFNRTCI7CiAgICAgICAgdmFsaWRhdGlvblNRTCA9ICJDQUxMIDEi\nOwogICAgICAgIGNsb3NlUG9vbFNRTCA9ICJTSFVURE9XTiI7CgogICAgICAg\nIHN1cHBvcnRzQXV0b0Fzc2lnbiA9IHRydWU7CiAgICAgICAgbGFzdEdlbmVy\nYXRlZEtleVF1ZXJ5ID0gIkNBTEwgSURFTlRJVFkoKSI7CiAgICAgICAgYXV0\nb0Fzc2lnbkNsYXVzZSA9ICJJREVOVElUWSI7CiAgICAgICAgYXV0b0Fzc2ln\nblR5cGVOYW1lID0gIklOVEVHRVIiOwogICAgICAgIG5leHRTZXF1ZW5jZVF1\nZXJ5ID0gIlNFTEVDVCBORVhUIFZBTFVFIEZPUiB7MH0gRlJPTSIKICAgICAg\nICAgICAgKyAiIElORk9STUFUSU9OX1NDSEVNQS5TWVNURU1fU0VRVUVOQ0VT\nIjsKICAgICAgICBjcm9zc0pvaW5DbGF1c2UgPSAiSk9JTiI7CiAgICAgICAg\ncmVxdWlyZXNDb25kaXRpb25Gb3JDcm9zc0pvaW4gPSB0cnVlOwogICAgICAg\nIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkxFTkdUSCh7MH0pIjsKICAgICAg\nICB0cmltTGVhZGluZ0Z1bmN0aW9uID0gIkxUUklNKHswfSkiOwogICAgICAg\nIHRyaW1UcmFpbGluZ0Z1bmN0aW9uID0gIlJUUklNKHswfSkiOwogICAgICAg\nIHRyaW1Cb3RoRnVuY3Rpb24gPSAiTFRSSU0oUlRSSU0oezB9KSkiOwoKICAg\nICAgICAvLyBIU1FMIDEuOC4wIGRvZXMgc3VwcG9ydCBzY2hlbWEgbmFtZXMg\naW4gdGhlIHRhYmxlICgic2NoZW1hLnRhYmxlIiksCiAgICAgICAgLy8gYnV0\nIGRvZXNuJ3Qgc3VwcG9ydCBpdCBmb3IgY29sdW1ucyByZWZlcmVuY2VzICgi\nc2NoZW1hLnRhYmxlLmNvbHVtbiIpCiAgICAgICAgdXNlU2NoZW1hTmFtZSA9\nIGZhbHNlOwogICAgICAgIHN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlID0gZmFs\nc2U7CiAgICAgICAgc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0gdHJ1ZTsK\nICAgICAgICBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gdHJ1ZTsKICAgICAg\nICByYW5nZVBvc2l0aW9uID0gUkFOR0VfUFJFX0RJU1RJTkNUOwogICAgICAg\nIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IGZhbHNlOwoKICAgICAg\nICB1c2VHZXRPYmplY3RGb3JCbG9icyA9IHRydWU7CiAgICAgICAgYmxvYlR5\ncGVOYW1lID0gIlZBUkJJTkFSWSI7CiAgICAgICAgZG91YmxlVHlwZU5hbWUg\nPSAiTlVNRVJJQyI7CgogICAgICAgIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0\nUHJpbWFyeUtleXMgPSB0cnVlOwogICAgICAgIHN1cHBvcnRzTnVsbFRhYmxl\nRm9yR2V0SW5kZXhJbmZvID0gdHJ1ZTsKCiAgICAgICAgcmVxdWlyZXNDYXN0\nRm9yTWF0aEZ1bmN0aW9ucyA9IHRydWU7CiAgICAgICAgcmVxdWlyZXNDYXN0\nRm9yQ29tcGFyaXNvbnMgPSB0cnVlOwoKICAgICAgICByZXNlcnZlZFdvcmRT\nZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAg\nICAgICAiQkVGT1JFIiwgIkJJR0lOVCIsICJCSU5BUlkiLCAiQ0FDSEVEIiwg\nIkRBVEVUSU1FIiwgIkxJTUlUIiwKICAgICAgICAgICAgIkxPTkdWQVJCSU5B\nUlkiLCAiTE9OR1ZBUkNIQVIiLCAiT0JKRUNUIiwgIk9USEVSIiwKICAgICAg\nICAgICAgIlNBVkVQT0lOVCIsICJURU1QIiwgIlRFWFQiLCAiVFJJR0dFUiIs\nICJUSU5ZSU5UIiwKICAgICAgICAgICAgIlZBUkJJTkFSWSIsICJWQVJDSEFS\nX0lHTk9SRUNBU0UiLAogICAgICAgIH0pKTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4gbG9i\nKSB7CiAgICAgICAgaW50IHR5cGUgPSBzdXBlci5nZXRKREJDVHlwZShtZXRh\nVHlwZUNvZGUsIGxvYik7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuQklHSU5UOgogICAgICAgICAgICAgICAgaWYg\nKG1ldGFUeXBlQ29kZSA9PSBKYXZhVHlwZXMuQklHSU5URUdFUikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gVHlwZXMuTlVNRVJJQzsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHlwZTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFByZWZlcnJlZFR5cGUoaW50IHR5\ncGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIFR5cGVzLlZB\nUkNIQVI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQkxPQjoKICAgICAgICAg\nICAgICAgIHJldHVybiBUeXBlcy5WQVJCSU5BUlk7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJlZmVy\ncmVkVHlwZSh0eXBlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0\ncmluZ1tdIGdldEFkZFByaW1hcnlLZXlTUUwoUHJpbWFyeUtleSBwaykgewog\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXREcm9wUHJpbWFyeUtleVNRTChQcmltYXJ5S2V5IHBr\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICB9CgogICAg\ncHVibGljIFN0cmluZ1tdIGdldEFkZENvbHVtblNRTChDb2x1bW4gY29sdW1u\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxF\nICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFibGUo\nKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBBREQgQ09MVU1OICIgKyBnZXRE\nZWNsYXJlQ29sdW1uU1FMKGNvbHVtbiwgdHJ1ZSkgfTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUgdGFibGUp\nIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZl\ncigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSAiKTsKICAgICAgICBp\nZiAoY2FjaGVUYWJsZXMpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNBQ0hF\nRCAiKTsKICAgICAgICBidWYuYXBwZW5kKCJUQUJMRSAiKS5hcHBlbmQoZ2V0\nRnVsbE5hbWUodGFibGUsIGZhbHNlKSkuYXBwZW5kKCIgKCIpOwoKICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIsICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGdldERlY2xhcmVDb2x1\nbW5TUUwoY29sc1tpXSwgZmFsc2UpKTsKICAgICAgICB9CgogICAgICAgIFBy\naW1hcnlLZXkgcGsgPSB0YWJsZS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAg\nU3RyaW5nIHBrU3RyOwogICAgICAgIGlmIChwayAhPSBudWxsKSB7CiAgICAg\nICAgICAgIHBrU3RyID0gZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRTUUwocGsp\nOwogICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocGtTdHIp\nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKS5hcHBlbmQocGtT\ndHIpOwogICAgICAgIH0KCiAgICAgICAgVW5pcXVlW10gdW5xcyA9IHRhYmxl\nLmdldFVuaXF1ZXMoKTsKICAgICAgICBTdHJpbmcgdW5xU3RyOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgdW5xcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICB1bnFTdHIgPSBnZXRVbmlxdWVDb25zdHJhaW50U1FMKHVucXNb\naV0pOwogICAgICAgICAgICBpZiAodW5xU3RyICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZCh1bnFTdHIpOwogICAg\nICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9CgogICAg\ncHJvdGVjdGVkIFN0cmluZyBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChQ\ncmltYXJ5S2V5IHBrKSB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHBrLmdl\ndENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMSAmJiBj\nb2xzWzBdLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIHJldHVybiBzdXBlci5nZXRQcmltYXJ5S2V5Q29uc3Ry\nYWludFNRTChwayk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0\nZW1JbmRleChTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICBy\nZXR1cm4gbmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIlNZU18iKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNlcXVlbmNlc1NRTChT\ndHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSkgewogICAg\nICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIFNFUVVFTkNFX1NDSEVNQSwgU0VR\nVUVOQ0VfTkFNRSBGUk9NICIpLgogICAgICAgICAgICBhcHBlbmQoIklORk9S\nTUFUSU9OX1NDSEVNQS5TWVNURU1fU0VRVUVOQ0VTIik7CiAgICAgICAgaWYg\nKHNjaGVtYU5hbWUgIT0gbnVsbCB8fCBzZXF1ZW5jZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIFdIRVJFICIpOwogICAgICAgIGlm\nIChzY2hlbWFOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiU0VRVUVOQ0VfU0NIRU1BID0gPyIpOwogICAgICAgICAgICBpZiAoc2Vx\ndWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VxdWVuY2VOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX05B\nTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5n\nIG9wLCBTUUxCdWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJv\nbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZl\nciBoYXZpbmcsCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRp\nc3RpbmN0LCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcg\nZm9yVXBkYXRlQ2xhdXNlKSB7CiAgICAgICAgLy8gaHNxbCByZXF1aXJlcyBv\ncmRlcmluZyB3aGVuIGxpbWl0IGlzIHVzZWQKICAgICAgICBpZiAoKHN0YXJ0\nICE9IDAgfHwgZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICAm\nJiAob3JkZXIgPT0gbnVsbCB8fCBvcmRlci5pc0VtcHR5KCkpKQogICAgICAg\nICAgICBvcmRlciA9IF9vbmVCdWZmZXI7CiAgICAgICAgcmV0dXJuIHN1cGVy\nLnRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwgZ3JvdXAs\nIGhhdmluZywKICAgICAgICAgICAgb3JkZXIsIGRpc3RpbmN0LCBzdGFydCwg\nZW5kLCBmb3JVcGRhdGVDbGF1c2UpOwogICAgfQoKICAgIHB1YmxpYyBDb2x1\nbW5bXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5n\nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0\nYWJsZU5hbWUsIFN0cmluZyBjb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1u\nW10gY29scyA9IHN1cGVyLmdldENvbHVtbnMobWV0YSwgY2F0YWxvZywgc2No\nZW1hTmFtZSwgdGFibGVOYW1lLAogICAgICAgICAgICBjb2x1bW5OYW1lLCBj\nb25uKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbHMgIT0gbnVsbCAm\nJiBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCJCT09M\nRUFOIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkp\nCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQklUKTsK\nICAgICAgICByZXR1cm4gY29sczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXREb3VibGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGRv\ndWJsZSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBIU1FMIGhhcyBhIGJ1ZyB3aGVy\nZSBpdCBjYW5ub3Qgc3RvcmUgYSBkb3VibGUgaWYgaXQgaXMKICAgICAgICAv\nLyBleGFjdGx5IHRoZSBzYW1lIGFzIExvbmcuTUFYX1ZBTFVFIG9yIE1JTl9W\nQUxVRQogICAgICAgIGlmICh2YWwgPT0gTG9uZy5NQVhfVkFMVUUgfHwgdmFs\nID09IExvbmcuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIHN0bW50LnNldExv\nbmcoaWR4LCAobG9uZyl2YWwpOwogICAgICAgIH0gZWxzZSAgewogICAgICAg\nICAgICBzdXBlci5zZXREb3VibGUoc3RtbnQsIGlkeCwgdmFsLCBjb2wpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdEZWNpbWFs\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCaWdEZWNpbWFs\nIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIC8vIGhzcWwgY2FuJ3QgY29tcGFyZSBhIEJp\nZ0RlY2ltYWwgZXF1YWwgdG8gYW55IG90aGVyIHR5cGUsIHNvIHRyeQogICAg\nICAgIC8vIHRvIHNldCB0eXBlIGJhc2VkIG9uIGNvbHVtbgogICAgICAgIGlu\ndCB0eXBlID0gKHZhbCA9PSBudWxsIHx8IGNvbCA9PSBudWxsKSA/IEphdmFU\neXBlcy5CSUdERUNJTUFMCiAgICAgICAgICAgIDogY29sLmdldEphdmFUeXBl\nKCk7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgIHNldERvdWJsZShzdG1udCwg\naWR4LCB2YWwuZG91YmxlVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAg\nICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsIHZhbC5mbG9hdFZhbHVlKCks\nIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHN1cGVyLnNldEJpZ0RlY2ltYWwoc3Rt\nbnQsIGlkeCwgdmFsLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90\nZWN0ZWQgdm9pZCBhcHBlbmRTZWxlY3RSYW5nZShTUUxCdWZmZXIgYnVmLCBs\nb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgICAgIC8vIEhTUUwgZG9lc24n\ndCBwYXJhbWV0ZXJzIGluIHJhbmdlCiAgICAgICAgYnVmLmFwcGVuZCgiIExJ\nTUlUICIpLmFwcGVuZChTdHJpbmcudmFsdWVPZihzdGFydCkpLmFwcGVuZCgi\nICIpOwogICAgICAgIGlmIChlbmQgPT0gTG9uZy5NQVhfVkFMVUUpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoU3RyaW5nLnZhbHVlT2YoMCkpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVuZChTdHJpbmcudmFsdWVPZihl\nbmQgLSBzdGFydCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN1YnN0cmlu\nZyhTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVl\nIHN0YXJ0LAogICAgICAgIEZpbHRlclZhbHVlIGVuZCkgewogICAgICAgIGJ1\nZi5hcHBlbmQoc3Vic3RyaW5nRnVuY3Rpb25OYW1lKS5hcHBlbmQoIigoIik7\nCiAgICAgICAgc3RyLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiKSwgKCIpOwogICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAg\nICAgYnVmLmFwcGVuZCgiICsgMSkiKTsKICAgICAgICBpZiAoZW5kICE9IG51\nbGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAoIik7CiAgICAgICAg\nICAgIGFwcGVuZE51bWVyaWNDYXN0KGJ1ZiwgZW5kKTsKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIC0gKCIpOwogICAgICAgICAgICBhcHBlbmROdW1lcmlj\nQ2FzdChidWYsIHN0YXJ0KTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSki\nKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGluZGV4T2YoU1FMQnVmZmVyIGJ1ZiwgRmlsdGVy\nVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBmaW5kLAogICAgICAgIEZpbHRlclZh\nbHVlIHN0YXJ0KSB7CiAgICAgICAgYnVmLmFwcGVuZCgiKExPQ0FURSgiKTsK\nICAgICAgICBmaW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiLCAiKTsKICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBp\nZiAoc3RhcnQgIT0gbnVsbCkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIs\nICgiKTsKICAgICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiICsgMSkiKTsKICAgICAgICB9CiAgICAgICAg\nYnVmLmFwcGVuZCgiKSAtIDEpIik7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBnZXRQbGFjZWhvbGRlclZhbHVlU3RyaW5nKENvbHVtbiBjb2wpIHsKICAg\nICAgICBTdHJpbmcgdHlwZSA9IGdldFR5cGVOYW1lKGNvbC5nZXRUeXBlKCkp\nOwogICAgICAgIGludCBpZHggPSB0eXBlLmluZGV4T2YoInswfSIpOwogICAg\nICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAgICAgU3RyaW5nIHByZSA9\nIHR5cGUuc3Vic3RyaW5nKDAsIGlkeCk7CiAgICAgICAgICAgIGlmICh0eXBl\nLmxlbmd0aCgpID4gaWR4ICsgMykKICAgICAgICAgICAgICAgIHR5cGUgPSBw\ncmUgKyB0eXBlLnN1YnN0cmluZyhpZHggKyAzKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgdHlwZSA9IHByZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuICJOVUxMIEFTICIgKyB0eXBlOwogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBRXhjZXB0aW9uIG5ld1N0b3JlRXhjZXB0aW9uKFN0cmluZyBt\nc2csIFNRTEV4Y2VwdGlvbltdIGNhdXNlcywKICAgICAgICBPYmplY3QgZmFp\nbGVkKSB7CiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBrZSA9IHN1cGVyLm5l\nd1N0b3JlRXhjZXB0aW9uKG1zZywgY2F1c2VzLCBmYWlsZWQpOwogICAgICAg\nIGlmIChrZSBpbnN0YW5jZW9mIFJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0\naW9uCiAgICAgICAgICAgICYmIGNhdXNlc1swXS5nZXRFcnJvckNvZGUoKSA9\nPSAtVHJhY2UuVklPTEFUSU9OX09GX1VOSVFVRV9JTkRFWCkgewogICAgICAg\nICAgICAoKFJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9uKSBrZSkuc2V0\nSW50ZWdyaXR5VmlvbGF0aW9uCiAgICAgICAgICAgICAgICAoUmVmZXJlbnRp\nYWxJbnRlZ3JpdHlFeGNlcHRpb24uSVZfVU5JUVVFKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGtlOwogICAgfQp9Cg==\n","encoding":"base64"}

