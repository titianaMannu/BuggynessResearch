{"sha":"cc4eac9eab2b94096be421d5b791665bc00382b4","node_id":"MDQ6QmxvYjIwNjM2NDpjYzRlYWM5ZWFiMmI5NDA5NmJlNDIxZDViNzkxNjY1YmMwMDM4MmI0","size":40052,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/cc4eac9eab2b94096be421d5b791665bc00382b4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc3FsLkJsb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5z\ncWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURh\ndGE7CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0\nIGphdmEuc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2Vw\ndGlvbjsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlRpbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7\nCmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwu\nSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2Vy\nbmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJWYWx1ZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5\nS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNl\ncXVlbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRl\nbGVnYXRpbmdEYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlv\nbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIERpY3Rpb25h\ncnkgZm9yIE9yYWNsZS4KICovCnB1YmxpYyBjbGFzcyBPcmFjbGVEaWN0aW9u\nYXJ5CiAgICBleHRlbmRzIERCRGljdGlvbmFyeSB7CgogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgU0VMRUNUX0hJTlQgPSAib3BlbmpwYS5oaW50\nLk9yYWNsZVNlbGVjdEhpbnQiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgVkVORE9SX09SQUNMRSA9ICJvcmFjbGUiOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBCRUhBVkVfT1RIRVIgPSAwOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEJFSEFWRV9PUkFDTEUgPSAxOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEJFSEFWRV9EQVRBRElSRUNUMzEgPSAy\nOwoKICAgIHByaXZhdGUgc3RhdGljIEJsb2IgRU1QVFlfQkxPQiA9IG51bGw7\nCiAgICBwcml2YXRlIHN0YXRpYyBDbG9iIEVNUFRZX0NMT0IgPSBudWxsOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoT3JhY2xlRGljdGlvbmFyeS5j\nbGFzcyk7CgogICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0aGVuIHNpbXVsYXRl\nIGF1dG8tYXNzaWduZWQgdmFsdWVzIGluIE9yYWNsZSBieQogICAgICogdXNp\nbmcgYSB0cmlnZ2VyIHRoYXQgaW5zZXJ0cyBhIHNlcXVlbmNlIHZhbHVlIGlu\ndG8gdGhlCiAgICAgKiBwcmltYXJ5IGtleSB2YWx1ZSB3aGVuIGEgcm93IGlz\nIGluc2VydGVkLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB1c2VUcmln\nZ2Vyc0ZvckF1dG9Bc3NpZ24gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRo\nZSBnbG9iYWwgc2VxdWVuY2UgbmFtZSB0byB1c2UgZm9yIGF1dG9hc3NpZ24g\nc2ltdWxhdGlvbi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBhdXRvQXNz\naWduU2VxdWVuY2VOYW1lID0gbnVsbDsKCiAgICAvKioKICAgICAqIEZsYWcg\ndG8gdXNlIE9wZW5KUEEgMC4zIHN0eWxlIG5hbWluZyBmb3IgYXV0byBhc3Np\nZ24gc2VxdWVuY2UgbmFtZSBhbmQKICAgICAqIHRyaWdnZXIgbmFtZSBmb3Ig\nYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIG9wZW5qcGEzR2VuZXJhdGVkS2V5TmFtZXMgPSBmYWxzZTsKCiAg\nICAvKioKICAgICAqIElmIHRydWUsIHRoZW4gT3BlbkpQQSB3aWxsIGF0dGVt\ncHQgdG8gdXNlIHRoZSBzcGVjaWFsCiAgICAgKiBPcmFjbGVQcmVwYXJlZFN0\nYXRlbWVudC5zZXRGb3JtT2ZVc2UgbWV0aG9kIHRvCiAgICAgKiBjb25maWd1\ncmUgc3RhdGVtZW50cyB0aGF0IGl0IGRldGVjdHMgYXJlIG9wZXJhdGluZyBv\nbiB1bmljb2RlIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\ndXNlU2V0Rm9ybU9mVXNlRm9yVW5pY29kZSA9IHRydWU7CgogICAgLy8gc29t\nZSBvcmFjbGUgZHJpdmVycyBoYXZlIHByb2JsZW1zIHdpdGggc2VsZWN0IGZv\nciB1cGRhdGU7IHdhcm4gdGhlCiAgICAvLyBmaXJzdCB0aW1lIGxvY2tpbmcg\naXMgYXR0ZW1wdGVkCiAgICBwcml2YXRlIGJvb2xlYW4gX2NoZWNrZWRVcGRh\ndGVCdWcgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfd2FybmVkQ2hh\nckNvbHVtbiA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF93YXJuZWRO\nY2hhckNvbHVtbiA9IGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX2RyaXZlckJl\naGF2aW9yID0gLTE7CgogICAgLy8gY2FjaGUgbG9iIG1ldGhvZHMKICAgIHBy\naXZhdGUgTWV0aG9kIF9wdXRCeXRlcyA9IG51bGw7CiAgICBwcml2YXRlIE1l\ndGhvZCBfcHV0U3RyaW5nID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9w\ndXRDaGFycyA9IG51bGw7CgogICAgcHVibGljIE9yYWNsZURpY3Rpb25hcnko\nKSB7CiAgICAgICAgcGxhdGZvcm0gPSAiT3JhY2xlIjsKICAgICAgICB2YWxp\nZGF0aW9uU1FMID0gIlNFTEVDVCBTWVNEQVRFIEZST00gRFVBTCI7CiAgICAg\nICAgbmV4dFNlcXVlbmNlUXVlcnkgPSAiU0VMRUNUIHswfS5ORVhUVkFMIEZS\nT00gRFVBTCI7CiAgICAgICAgc3RyaW5nTGVuZ3RoRnVuY3Rpb24gPSAiTEVO\nR1RIKHswfSkiOwogICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfREFUQUJB\nU0U7CiAgICAgICAgbWF4VGFibGVOYW1lTGVuZ3RoID0gMzA7CiAgICAgICAg\nbWF4Q29sdW1uTmFtZUxlbmd0aCA9IDMwOwogICAgICAgIG1heEluZGV4TmFt\nZUxlbmd0aCA9IDMwOwogICAgICAgIG1heENvbnN0cmFpbnROYW1lTGVuZ3Ro\nID0gMzA7CiAgICAgICAgbWF4RW1iZWRkZWRCbG9iU2l6ZSA9IDQwMDA7CiAg\nICAgICAgbWF4RW1iZWRkZWRDbG9iU2l6ZSA9IDQwMDA7CiAgICAgICAgaW5D\nbGF1c2VMaW1pdCA9IDEwMDA7CgogICAgICAgIHN1cHBvcnRzRGVmZXJyZWRD\nb25zdHJhaW50cyA9IHRydWU7CiAgICAgICAgc3VwcG9ydHNMb2NraW5nV2l0\naERpc3RpbmN0Q2xhdXNlID0gZmFsc2U7CiAgICAgICAgc3VwcG9ydHNTZWxl\nY3RTdGFydEluZGV4ID0gdHJ1ZTsKICAgICAgICBzdXBwb3J0c1NlbGVjdEVu\nZEluZGV4ID0gdHJ1ZTsKCiAgICAgICAgc3lzdGVtU2NoZW1hU2V0LmFkZEFs\nbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkNU\nWFNZUyIsICJNRFNZUyIsICJTWVMiLCAiU1lTVEVNIiwgIldLU1lTIiwgIldN\nU1lTIiwgIlhEQiIsCiAgICAgICAgfSkpOwoKICAgICAgICBiaWdpbnRUeXBl\nTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIGJpdFR5cGVOYW1lID0gIk5V\nTUJFUnswfSI7CiAgICAgICAgZGVjaW1hbFR5cGVOYW1lID0gIk5VTUJFUnsw\nfSI7CiAgICAgICAgZG91YmxlVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAg\nICAgICBpbnRlZ2VyVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBu\ndW1lcmljVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBzbWFsbGlu\ndFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgdGlueWludFR5cGVO\nYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgbG9uZ1ZhcmNoYXJUeXBlTmFt\nZSA9ICJMT05HIjsKICAgICAgICBiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsK\nICAgICAgICB2YXJiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICBs\nb25nVmFyYmluYXJ5VHlwZU5hbWUgPSAiQkxPQiI7CiAgICAgICAgdGltZVR5\ncGVOYW1lID0gIkRBVEUiOwogICAgICAgIHZhcmNoYXJUeXBlTmFtZSA9ICJW\nQVJDSEFSMnswfSI7CiAgICAgICAgZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRk\nQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAgICAi\nTE9ORyBSQVciLCAiUkFXIiwgIkxPTkciLCAiUkVGIiwKICAgICAgICB9KSk7\nCiAgICAgICAgcmVzZXJ2ZWRXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0\nKG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkFDQ0VTUyIsICJBVURJVCIs\nICJDTFVTVEVSIiwgIkNPTU1FTlQiLCAiQ09NUFJFU1MiLCAiRVhDTFVTSVZF\nIiwKICAgICAgICAgICAgIkZJTEUiLCAiSURFTlRJRklFRCIsICJJTkNSRU1F\nTlQiLCAiSU5ERVgiLCAiSU5JVElBTCIsICJMT0NLIiwKICAgICAgICAgICAg\nIkxPTkciLCAiTUFYRVhURU5UUyIsICJNSU5VUyIsICJNT0RFIiwgIk5PQVVE\nSVQiLCAiTk9DT01QUkVTUyIsCiAgICAgICAgICAgICJOT1dBSVQiLCAiT0ZG\nTElORSIsICJPTkxJTkUiLCAiUENURlJFRSIsICJST1ciLAogICAgICAgIH0p\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkg\newogICAgICAgIHN1cGVyLmVuZENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBp\nZiAodXNlVHJpZ2dlcnNGb3JBdXRvQXNzaWduKQogICAgICAgICAgICBzdXBw\nb3J0c0F1dG9Bc3NpZ24gPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oQ29ubmVjdGlvbiBjb25uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN1cGVyLmNvbm5l\nY3RlZENvbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAgaWYgKGRyaXZlclZl\nbmRvciA9PSBudWxsKSB7CiAgICAgICAgICAgIERhdGFiYXNlTWV0YURhdGEg\nbWV0YSA9IGNvbm4uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgU3RyaW5n\nIHVybCA9IChtZXRhLmdldFVSTCgpID09IG51bGwpID8gIiIgOiBtZXRhLmdl\ndFVSTCgpOwogICAgICAgICAgICBTdHJpbmcgZHJpdmVyTmFtZSA9IG1ldGEu\nZ2V0RHJpdmVyTmFtZSgpOwogICAgICAgICAgICBTdHJpbmcgbWV0YWRhdGFD\nbGFzc05hbWU7CiAgICAgICAgICAgIGlmIChtZXRhIGluc3RhbmNlb2YgRGVs\nZWdhdGluZ0RhdGFiYXNlTWV0YURhdGEpCiAgICAgICAgICAgICAgICBtZXRh\nZGF0YUNsYXNzTmFtZSA9ICgoRGVsZWdhdGluZ0RhdGFiYXNlTWV0YURhdGEp\nIG1ldGEpLgogICAgICAgICAgICAgICAgICAgIGdldElubmVybW9zdERlbGVn\nYXRlKCkuZ2V0Q2xhc3MoKS5nZXROYW1lKCk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIG1ldGFkYXRhQ2xhc3NOYW1lID0gbWV0YS5nZXRD\nbGFzcygpLmdldE5hbWUoKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGJvdGgg\ndGhlIGRyaXZlciBjbGFzcyBuYW1lIGFuZCB0aGUgVVJMIGZvciBrbm93biBw\nYXR0ZXJucwogICAgICAgICAgICBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3Rh\ncnRzV2l0aCgib3JhY2xlLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5k\nZXhPZigiamRiYzpvcmFjbGU6IikgIT0gLTEKICAgICAgICAgICAgICAgIHx8\nICJPcmFjbGUgSkRCQyBkcml2ZXIiLmVxdWFscyhkcml2ZXJOYW1lKSkgewog\nICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09SQUNMRSAr\nIG1ldGEuZ2V0RHJpdmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAgICAg\nICAgICArIG1ldGEuZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CgogICAgICAg\nICAgICAgICAgLy8gd2FybiBzcWw5MgogICAgICAgICAgICAgICAgaWYgKG1l\ndGEuZ2V0RGF0YWJhc2VQcm9kdWN0VmVyc2lvbigpLmluZGV4T2YoIlJlbGVh\nc2UgOC4iKSA+IDApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGpvaW5TeW50YXggPT0gU1lOVEFYX1NRTDkyICYmIGxvZy5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KCJvcmFjbGUtc3ludGF4IikpOwogICAgICAgICAgICAg\nICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfREFUQUJBU0U7CiAgICAgICAg\nICAgICAgICAgICAgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOyAvLyBhZGRlZCBv\ncmFjbGUgOQogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcFR5cGVOYW1l\nID0gIkRBVEUiOyAvLyBhZGRlZCBvcmFjbGUgOQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGVsc2UgaWYgKG1ldGFkYXRhQ2xhc3NOYW1lLnN0\nYXJ0c1dpdGgoImNvbS5kZHRlay4iKQogICAgICAgICAgICAgICAgfHwgdXJs\nLmluZGV4T2YoImpkYmM6ZGF0YWRpcmVjdDpvcmFjbGU6IikgIT0gLTEKICAg\nICAgICAgICAgICAgIHx8ICJPcmFjbGUiLmVxdWFscyhkcml2ZXJOYW1lKSkg\newogICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX0RBVEFE\nSVJFQ1QgKyBtZXRhLmdldERyaXZlck1ham9yVmVyc2lvbigpCiAgICAgICAg\nICAgICAgICAgICAgKyBtZXRhLmdldERyaXZlck1pbm9yVmVyc2lvbigpOwog\nICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGRyaXZlclZlbmRv\nciA9IFZFTkRPUl9PVEhFUjsKICAgICAgICB9CiAgICAgICAgY2FjaGVEcml2\nZXJCZWhhdmlvcihkcml2ZXJWZW5kb3IpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2FjaGUgY29uc3RhbnQgZm9yIGRyaXZlcnMgd2l0aCBiZWhhdmlvcnMg\nd2UgaGF2ZSB0byBkZWFsIHdpdGguCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBjYWNoZURyaXZlckJlaGF2aW9yKFN0cmluZyBkcml2ZXJWZW5kb3IpIHsK\nICAgICAgICBpZiAoX2RyaXZlckJlaGF2aW9yICE9IC0xKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGRyaXZlclZlbmRvciA9IGRyaXZlclZlbmRv\nci50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmIChkcml2ZXJWZW5kb3Iuc3Rh\ncnRzV2l0aChWRU5ET1JfT1JBQ0xFKSkKICAgICAgICAgICAgX2RyaXZlckJl\naGF2aW9yID0gQkVIQVZFX09SQUNMRTsKICAgICAgICBlbHNlIGlmIChkcml2\nZXJWZW5kb3IuZXF1YWxzKFZFTkRPUl9EQVRBRElSRUNUICsgIjMwIikKICAg\nICAgICAgICAgfHwgZHJpdmVyVmVuZG9yLmVxdWFscyhWRU5ET1JfREFUQURJ\nUkVDVCArICIzMSIpKQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3IgPSBC\nRUhBVkVfREFUQURJUkVDVDMxOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX2RyaXZlckJlaGF2aW9yID0gQkVIQVZFX09USEVSOwogICAgfQoKICAgIC8q\nKgogICAgICogRW5zdXJlIHRoYXQgdGhlIGRyaXZlciB2ZW5kb3IgaGFzIGJl\nZW4gc2V0LCBhbmQgaWYgbm90LCBzZXQgaXQgbm93LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBlbnN1cmVEcml2ZXJWZW5kb3IoKSB7CiAgICAgICAgaWYg\nKGRyaXZlclZlbmRvciAhPSBudWxsKSB7CiAgICAgICAgICAgIGNhY2hlRHJp\ndmVyQmVoYXZpb3IoZHJpdmVyVmVuZG9yKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkp\nCiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJvcmFjbGUtY29ubmVj\ndGluZy1mb3ItZHJpdmVyIikpOwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29ubiA9IGNvbmYu\nZ2V0RGF0YVNvdXJjZTIobnVsbCkuZ2V0Q29ubmVjdGlvbigpOwogICAgICAg\nICAgICBjb25uZWN0ZWRDb25maWd1cmF0aW9uKGNvbm4pOwogICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBT\nUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCB0aGlzKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25uLmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nKFNlbGVjdCBzZWwpIHsKICAg\nICAgICBpZiAoIXN1cGVyLnN1cHBvcnRzTG9ja2luZyhzZWwpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuICFyZXF1aXJlc1N1\nYnNlbGVjdEZvclJhbmdlKHNlbC5nZXRTdGFydEluZGV4KCksCiAgICAgICAg\nICAgIHNlbC5nZXRFbmRJbmRleCgpLCBzZWwuaXNEaXN0aW5jdCgpLCBzZWwu\nZ2V0T3JkZXJpbmcoKSk7CiAgICB9CgogICAgcHJvdGVjdGVkIFNRTEJ1ZmZl\nciBnZXRTZWxlY3RzKFNlbGVjdCBzZWwsIGJvb2xlYW4gZGlzdGluY3RJZGVu\ndGlmaWVycywKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAg\nIC8vIGlmIHJhbmdlIGRvZXNuJ3QgcmVxdWlyZSBhIHN1YnNlbGVjdCBjYW4g\ndXNlIHN1cGVyCiAgICAgICAgaWYgKCFyZXF1aXJlc1N1YnNlbGVjdEZvclJh\nbmdlKHNlbC5nZXRTdGFydEluZGV4KCksCiAgICAgICAgICAgIHNlbC5nZXRF\nbmRJbmRleCgpLCBzZWwuaXNEaXN0aW5jdCgpLCBzZWwuZ2V0T3JkZXJpbmco\nKSkpCiAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRTZWxlY3RzKHNlbCwg\nZGlzdGluY3RJZGVudGlmaWVycywgZm9yVXBkYXRlKTsKCiAgICAgICAgLy8g\naWYgdGhlcmUgYXJlIG5vIGpvaW5zIGludm9sdmVkIG9yIHdlJ3JlIHVzaW5n\nIGEgZnJvbSBzZWxlY3Qgc28KICAgICAgICAvLyB0aGF0IGFsbCBjb2xzIGFs\ncmVhZHkgaGF2ZSB1bmlxdWUgYWxpYXNlcywgY2FuIHVzZSBzdXBlcgogICAg\nICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwgfHwgc2VsLmdl\ndFRhYmxlQWxpYXNlcygpLnNpemUoKSA8IDIpCiAgICAgICAgICAgIHJldHVy\nbiBzdXBlci5nZXRTZWxlY3RzKHNlbCwgZGlzdGluY3RJZGVudGlmaWVycywg\nZm9yVXBkYXRlKTsKCiAgICAgICAgLy8gc2luY2Ugbm9uZSBvZiB0aGUgY29u\nZGl0aW9ucyBhYm92ZSB3ZXJlIG1ldCwgd2UncmUgZGVhbGluZyB3aXRoCiAg\nICAgICAgLy8gYSBzZWxlY3QgdGhhdCB1c2VzIGpvaW5zIGFuZCByZXF1aXJl\ncyBzdWJzZWxlY3RzIHRvIHNlbGVjdCB0aGUKICAgICAgICAvLyBwcm9wZXIg\ncmFuZ2U7IGFsaWFzIGFsbCBjb2x1bW4gdmFsdWVzIHNvIHRoYXQgdGhleSBh\ncmUgdW5pcXVlIHdpdGhpbgogICAgICAgIC8vIHRoZSBzdWJzZWxlY3QKICAg\nICAgICBTUUxCdWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlz\nKTsKICAgICAgICBMaXN0IGFsaWFzZXM7CiAgICAgICAgaWYgKGRpc3RpbmN0\nSWRlbnRpZmllcnMpCiAgICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0SWRl\nbnRpZmllckFsaWFzZXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFs\naWFzZXMgPSBzZWwuZ2V0U2VsZWN0QWxpYXNlcygpOwoKICAgICAgICBPYmpl\nY3QgYWxpYXM7CiAgICAgICAgaW50IGkgPSAwOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gYWxpYXNlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOyBpKyspIHsKICAgICAgICAgICAgYWxpYXMgPSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBpZiAoYWxpYXMgaW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAgICAg\nICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKChTUUxCdWZmZXIpIGFsaWFz\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2VsZWN0U1FM\nLmFwcGVuZChhbGlhcy50b1N0cmluZygpKTsKICAgICAgICAgICAgc2VsZWN0\nU1FMLmFwcGVuZCgiIEFTIGMiKS5hcHBlbmQoU3RyaW5nLnZhbHVlT2YoaSkp\nOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAg\nICAgIHNlbGVjdFNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBzZWxlY3RTUUw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nY2FuT3V0ZXJKb2luKGludCBzeW50YXgsIEZvcmVpZ25LZXkgZmspIHsKICAg\nICAgICBpZiAoIXN1cGVyLmNhbk91dGVySm9pbihzeW50YXgsIGZrKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChmayAhPSBudWxs\nICYmIHN5bnRheCA9PSBTWU5UQVhfREFUQUJBU0UpIHsKICAgICAgICAgICAg\naWYgKGZrLmdldENvbnN0YW50cygpLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChmay5nZXRQcmlt\nYXJ5S2V5Q29uc3RhbnRzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b05hdGl2ZUpvaW4oSm9p\nbiBqb2luKSB7CiAgICAgICAgaWYgKGpvaW4uZ2V0VHlwZSgpICE9IEpvaW4u\nVFlQRV9PVVRFUikKICAgICAgICAgICAgcmV0dXJuIHRvVHJhZGl0aW9uYWxK\nb2luKGpvaW4pOwoKICAgICAgICBGb3JlaWduS2V5IGZrID0gam9pbi5nZXRG\nb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGludmVyc2UgPSBq\nb2luLmlzRm9yZWlnbktleUludmVyc2VkKCk7CiAgICAgICAgQ29sdW1uW10g\nZnJvbSA9IChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkK\nICAgICAgICAgICAgOiBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1u\nW10gdG8gPSAoaW52ZXJzZSkgPyBmay5nZXRDb2x1bW5zKCkKICAgICAgICAg\nICAgOiBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICAvLyBk\nbyBjb2x1bW4gam9pbnMKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNR\nTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbS5sZW5ndGg7IGkrKywgY291bnQr\nKykgewogICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVu\nZChqb2luLmdldEFsaWFzMSgpKS5hcHBlbmQoIi4iKS5hcHBlbmQoZnJvbVtp\nXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLmFw\ncGVuZCh0b1tpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIigrKSIpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgY29uc3RhbnQgam9pbnMKICAg\nICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCkubGVuZ3RoID4gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJvcmFjbGUtY29uc3RhbnQiLAogICAgICAgICAgICAgICAgam9pbi5nZXRU\nYWJsZTEoKSwgam9pbi5nZXRUYWJsZTIoKSkpLnNldEZhdGFsKHRydWUpOwoK\nICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRQcmltYXJ5S2V5Q29sdW1ucygp\nLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2Vw\ndGlvbihfbG9jLmdldCgib3JhY2xlLWNvbnN0YW50IiwKICAgICAgICAgICAg\nICAgIGpvaW4uZ2V0VGFibGUxKCksIGpvaW4uZ2V0VGFibGUyKCkpKS5zZXRG\nYXRhbCh0cnVlKTsKICAgICAgICByZXR1cm4gYnVmOwogICAgfQoKICAgIHB1\nYmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdCwgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIg\ndGFibGVzLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwKICAg\nICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAg\nICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcg\nc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgaWYgKCFfY2hlY2tlZFVwZGF0\nZUJ1ZykgewogICAgICAgICAgICBlbnN1cmVEcml2ZXJWZW5kb3IoKTsKICAg\nICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBfZHJpdmVyQmVoYXZpb3IgPT0g\nQkVIQVZFX0RBVEFESVJFQ1QzMSkKICAgICAgICAgICAgICAgIGxvZy53YXJu\nKF9sb2MuZ2V0KCJkZC1sb2NrLWJ1ZyIpKTsKICAgICAgICAgICAgX2NoZWNr\nZWRVcGRhdGVCdWcgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYg\nbm8gcmFuZ2UsIHVzZSBzdGFuZGFyZCBzZWxlY3QKICAgICAgICBpZiAoc3Rh\ncnQgPT0gMCAmJiBlbmQgPT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAg\nIHJldHVybiBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJsZXMs\nIHdoZXJlLCBncm91cCwgaGF2aW5nLAogICAgICAgICAgICAgICAgb3JkZXIs\nIGRpc3RpbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFKTsKCiAg\nICAgICAgLy8gaWYgbm8gc2tpcCwgb3JkZXJpbmcsIG9yIGRpc3RpbmN0IGNh\nbiB1c2Ugcm93bnVtIGRpcmVjdGx5CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9\nIG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKCFyZXF1aXJlc1N1\nYnNlbGVjdEZvclJhbmdlKHN0YXJ0LCBlbmQsIGRpc3RpbmN0LCBvcmRlcikp\nIHsKICAgICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwgJiYgIXdoZXJlLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQod2hlcmUpLmFw\ncGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiUk9XTlVN\nIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAgICAgICAgICAgIHJldHVybiBz\ndXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJsZXMsIGJ1ZiwgZ3Jv\ndXAsIGhhdmluZywKICAgICAgICAgICAgICAgIG9yZGVyLCBkaXN0aW5jdCwg\nZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiB0aGVyZSBpcyBvcmRlcmluZywgc2tpcCwgb3IgZGlzdGlu\nY3Qgd2UgaGF2ZSB0byB1c2Ugc3Vic2VsZWN0cwogICAgICAgIFNRTEJ1ZmZl\nciBzZWwgPSBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJsZXMs\nIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlz\ndGluY3QsIGZvclVwZGF0ZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwoKICAgICAg\nICAvLyBpZiBubyBza2lwLCBjYW4gdXNlIHNpbmdsZSBuZXN0ZWQgc3Vic2Vs\nZWN0CiAgICAgICAgaWYgKHN0YXJ0ID09IDApIHsKICAgICAgICAgICAgYnVm\nLmFwcGVuZChnZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gpICsgIiAqIEZST00g\nKCIpOwogICAgICAgICAgICBidWYuYXBwZW5kKHNlbCk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIikgV0hFUkUgUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVl\nKGVuZCk7CiAgICAgICAgICAgIHJldHVybiBidWY7CiAgICAgICAgfQoKICAg\nICAgICAvLyB3aXRoIGEgc2tpcCwgd2UgaGF2ZSB0byB1c2UgYSBkb3VibGUt\nbmVzdGVkIHN1YnNlbGVjdCB0byBwdXQKICAgICAgICAvLyB3aGVyZSBjb25k\naXRpb25zIG9uIHRoZSByb3dudW0KICAgICAgICBidWYuYXBwZW5kKGdldFNl\nbGVjdE9wZXJhdGlvbihmZXRjaCkKICAgICAgICAgICAgKyAiICogRlJPTSAo\nU0VMRUNUIHIuKiwgUk9XTlVNIFJOVU0gRlJPTSAoIik7CiAgICAgICAgYnVm\nLmFwcGVuZChzZWwpOwogICAgICAgIGJ1Zi5hcHBlbmQoIikgciIpOwogICAg\nICAgIGlmIChlbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBXSEVSRSBST1dOVU0gPD0gIikuYXBwZW5kVmFsdWUoZW5k\nKTsKICAgICAgICBidWYuYXBwZW5kKCIpIFdIRVJFIFJOVU0gPiAiKS5hcHBl\nbmRWYWx1ZShzdGFydCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBzZWxlY3Qgd2l0aCB0\naGUgZ2l2ZW4gcGFyYW1ldGVycyBuZWVkcyBhCiAgICAgKiBzdWJzZWxlY3Qg\ndG8gYXBwbHkgYSByYW5nZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2UobG9uZyBzdGFydCwgbG9uZyBl\nbmQsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgU1FMQnVmZmVyIG9yZGVy\nKSB7CiAgICAgICAgaWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IExvbmcuTUFY\nX1ZBTFVFKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0\ndXJuIHN0YXJ0ICE9IDAgfHwgZGlzdGluY3QgfHwgKG9yZGVyICE9IG51bGwg\nJiYgIW9yZGVyLmlzRW1wdHkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\naGVjayB0byBzZWUgaWYgd2UgaGF2ZSBzZXQgdGhlIHtAbGluayAjU0VMRUNU\nX0hJTlR9IGluIHRoZQogICAgICogZmV0Y2ggY29uZmlndXJhaXRvbiwgYW5k\nIGlmIHNvLCBhcHBlbmQgdGhlIE9yYWNoZSBoaW50IGFmdGVyIHRoZQogICAg\nICogIlNFTEVDVCIgcGFydCBvZiB0aGUgcXVlcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0U2VsZWN0T3BlcmF0aW9uKEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBPYmplY3QgaGludCA9IGZldGNo\nID09IG51bGwgPyBudWxsIDogZmV0Y2guZ2V0SGludChTRUxFQ1RfSElOVCk7\nCiAgICAgICAgU3RyaW5nIHNlbGVjdCA9ICJTRUxFQ1QiOwogICAgICAgIGlm\nIChoaW50ICE9IG51bGwpCiAgICAgICAgICAgIHNlbGVjdCArPSAiICIgKyBo\naW50OwogICAgICAgIHJldHVybiBzZWxlY3Q7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc3Vic3RyaW5nKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHN0\nciwgRmlsdGVyVmFsdWUgc3RhcnQsCiAgICAgICAgRmlsdGVyVmFsdWUgZW5k\nKSB7CiAgICAgICAgYnVmLmFwcGVuZCgiU1VCU1RSKCIpOwogICAgICAgIHN0\nci5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiwgKCIpOwog\nICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiICsgMSkiKTsKICAgICAgICBpZiAoZW5kICE9IG51bGwpIHsKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiLCAoIik7CiAgICAgICAgICAgIGVuZC5hcHBl\nbmRUbyhidWYpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgLSAiKTsKICAg\nICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiKSIpOwogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5kKCIp\nIik7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3RyaW5nKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBTdHJpbmcgdmFsLAogICAgICAg\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gb3JhY2xlIE5DSEFSL05WQVJDSEFSL05DTE9CIHVuaWNvZGUg\nY29sdW1ucyByZXF1aXJlIHNvbWUKICAgICAgICAvLyBzcGVjaWFsIGhhbmRs\naW5nIHRvIGNvbmZpZ3VyZSB0aGVtIGNvcnJlY3RseTsgc2VlOgogICAgICAg\nIC8vIGh0dHA6Ly93d3cub3JhY2xlLmNvbS90ZWNobm9sb2d5L3NhbXBsZV9j\nb2RlL3RlY2gvamF2YS8KICAgICAgICAvLyBzcWxqX2pkYmMvZmlsZXMvOWlf\namRiYy9OQ0hBUnN1cHBvcnQ0VW5pY29kZVNhbXBsZS9SZWFkbWUuaHRtbAog\nICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IChjb2wgPT0gbnVsbCkgPyBudWxs\nIDogY29sLmdldFR5cGVOYW1lKCk7CiAgICAgICAgaWYgKHVzZVNldEZvcm1P\nZlVzZUZvclVuaWNvZGUgJiYgdHlwZU5hbWUgIT0gbnVsbCAmJgogICAgICAg\nICAgICAodHlwZU5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJudmFy\nY2hhciIpIHx8CiAgICAgICAgICAgICAgICB0eXBlTmFtZS50b0xvd2VyQ2Fz\nZSgpLnN0YXJ0c1dpdGgoIm5jaGFyIikgfHwKICAgICAgICAgICAgICAgIHR5\ncGVOYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgibmNsb2IiKSkpIHsK\nICAgICAgICAgICAgU3RhdGVtZW50IGlubmVyID0gc3RtbnQ7CiAgICAgICAg\nICAgIGlmIChpbm5lciBpbnN0YW5jZW9mIERlbGVnYXRpbmdQcmVwYXJlZFN0\nYXRlbWVudCkKICAgICAgICAgICAgICAgIGlubmVyID0gKChEZWxlZ2F0aW5n\nUHJlcGFyZWRTdGF0ZW1lbnQpIGlubmVyKS4KICAgICAgICAgICAgICAgICAg\nICBnZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgICAgICBpZiAoaXNP\ncmFjbGVQcmVwYXJlZFN0YXRlbWVudChpbm5lcikpIHsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaW5uZXIuZ2V0Q2xhc3Mo\nKS5nZXRNZXRob2QoInNldEZvcm1PZlVzZSIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MsIHNob3J0LmNsYXNzIH0p\nLgogICAgICAgICAgICAgICAgICAgICAgICBpbnZva2UoaW5uZXIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEludGVnZXIoaWR4KSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgib3JhY2xlLmpk\nYmMuT3JhY2xlUHJlcGFyZWRTdGF0ZW1lbnQiKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGQoIkZPUk1fTkNIQVIiKS5n\nZXQobnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndh\ncm4oZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoIV93YXJuZWROY2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgICAgICBfd2FybmVkTmNoYXJDb2x1bW4gPSB0cnVl\nOwogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVuY29uZmln\ndXJlZC1uY2hhci1jb2xzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBjYWxsIHNldEZpeGVkQ0hBUiBmb3IgZml4ZWQgd2lkdGgg\nY2hhcmFjdGVyIGNvbHVtbnMgdG8gZ2V0IHBhZGRpbmcKICAgICAgICAvLyBz\nZW1hbnRpY3MKICAgICAgICBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5\ncGUoKSA9PSBUeXBlcy5DSEFSCiAgICAgICAgICAgICYmIHZhbCAhPSBudWxs\nICYmIHZhbC5sZW5ndGgoKSAhPSBjb2wuZ2V0U2l6ZSgpKSB7CiAgICAgICAg\nICAgIFN0YXRlbWVudCBpbm5lciA9IHN0bW50OwogICAgICAgICAgICBpZiAo\naW5uZXIgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQp\nCiAgICAgICAgICAgICAgICBpbm5lciA9ICgoRGVsZWdhdGluZ1ByZXBhcmVk\nU3RhdGVtZW50KSBpbm5lcikuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5u\nZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKGlzT3JhY2xlUHJl\ncGFyZWRTdGF0ZW1lbnQoaW5uZXIpKSB7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIGlubmVyLmdldENsYXNzKCkuZ2V0TWV0\naG9kKCJzZXRGaXhlZENIQVIiLAogICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgaW50LmNsYXNzLCBTdHJpbmcuY2xhc3MgfSkuCiAgICAg\nICAgICAgICAgICAgICAgICAgIGludm9rZShpbm5lciwgbmV3IE9iamVjdFtd\neyBuZXcgSW50ZWdlcihpZHgpLCB2YWwgfSk7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFf\nd2FybmVkQ2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICBfd2FybmVkQ2hhckNvbHVtbiA9IHRydWU7CiAgICAg\nICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgidW5wYWRkZWQtY2hhci1j\nb2xzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN1cGVy\nLnNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwsIGNvbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgaW50IGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29sVHlw\nZSA9PSBUeXBlcy5CTE9CICYmIF9kcml2ZXJCZWhhdmlvciA9PSBCRUhBVkVf\nT1JBQ0xFKQogICAgICAgICAgICBzdG1udC5zZXRCbG9iKGlkeCwgZ2V0RW1w\ndHlCbG9iKCkpOwogICAgICAgIGVsc2UgaWYgKGNvbFR5cGUgPT0gVHlwZXMu\nQ0xPQiAmJiBfZHJpdmVyQmVoYXZpb3IgPT0gQkVIQVZFX09SQUNMRSkKICAg\nICAgICAgICAgc3RtbnQuc2V0Q2xvYihpZHgsIGdldEVtcHR5Q2xvYigpKTsK\nICAgICAgICBlbHNlIGlmICgoY29sVHlwZSA9PSBUeXBlcy5TVFJVQ1QgfHwg\nY29sVHlwZSA9PSBUeXBlcy5PVEhFUikKICAgICAgICAgICAgJiYgY29sICE9\nIG51bGwgJiYgY29sLmdldFR5cGVOYW1lKCkgIT0gbnVsbCkKICAgICAgICAg\nICAgc3RtbnQuc2V0TnVsbChpZHgsIFR5cGVzLlNUUlVDVCwgY29sLmdldFR5\ncGVOYW1lKCkpOwogICAgICAgICAgICAvLyBzb21lIHZlcnNpb25zIG9mIHRo\nZSBPcmFjbGUgSkRCQyBkcml2ZXIgd2lsbCBmYWlsIGlmIGNhbGxpbmcKICAg\nICAgICAgICAgLy8gc2V0TnVsbCB3aXRoIERBVEU7IHNlZSBidWcgIzExNzEK\nICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09IFR5cGVzLkRBVEUpCiAgICAg\nICAgICAgIHN1cGVyLnNldE51bGwoc3RtbnQsIGlkeCwgVHlwZXMuVElNRVNU\nQU1QLCBjb2wpOwogICAgICAgIC8vIHRoZSBPcmFjbGUgZHJpdmVyIGRvZXMg\nbm90IHN1cHBvcnQgVHlwZXMuT1RIRVIgd2l0aCBzZXROdWxsCiAgICAgICAg\nZWxzZSBpZiAoY29sVHlwZSA9PSBUeXBlcy5PVEhFUikKICAgICAgICAgICAg\nc3VwZXIuc2V0TnVsbChzdG1udCwgaWR4LCBUeXBlcy5OVUxMLCBjb2wpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChzdG1udCwg\naWR4LCBjb2xUeXBlLCBjb2wpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q2xvYlN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9kcml2ZXJC\nZWhhdmlvciAhPSBCRUhBVkVfT1JBQ0xFKQogICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZ2V0Q2xvYlN0cmluZyhycywgY29sdW1uKTsKCiAgICAgICAgQ2xv\nYiBjbG9iID0gZ2V0Q2xvYihycywgY29sdW1uKTsKICAgICAgICBpZiAoY2xv\nYiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoY2xvYi5nZXRDbGFzcygpLmdldE5hbWUoKS5lcXVhbHMoIm9yYWNsZS5z\ncWwuQ0xPQiIpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBpZiAoKChCb29sZWFuKSBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuc3FsLkNM\nT0IiKS4KICAgICAgICAgICAgICAgICAgICBnZXRNZXRob2QoImlzRW1wdHlM\nb2IiLCBuZXcgQ2xhc3NbMF0pLgogICAgICAgICAgICAgICAgICAgIGludm9r\nZShjbG9iLCBuZXcgT2JqZWN0WzBdKSkuCiAgICAgICAgICAgICAgICAgICAg\nYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAvLyBwb3NzaWJseSBkaWZmZXJlbnQgdmVyc2lvbiBvZiB0\naGUgZHJpdmVyCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKGNsb2IubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIC8vIHVubGlrZWx5IHRoYXQgd2UnbGwgaGF2ZSBzdHJpbmdz\nIG92ZXIgNCBiaWxsaW9uIGNoYXJzCiAgICAgICAgcmV0dXJuIGNsb2IuZ2V0\nU3ViU3RyaW5nKDEsIChpbnQpIGNsb2IubGVuZ3RoKCkpOwogICAgfQoKICAg\nIHB1YmxpYyBUaW1lc3RhbXAgZ2V0VGltZXN0YW1wKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbiwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFRp\nbWVzdGFtcChycywgY29sdW1uLCBjYWwpOwogICAgICAgICAgICB9IGNhdGNo\nIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gYWUpIHsKICAgICAg\nICAgICAgICAgIC8vIENSMjk1NjA0OiBpc3N1ZSBhIHdhcm5pbmcgdGhpcyB0\naGlzIGJ1ZyBjYW4gYmUgZ290dGVuCiAgICAgICAgICAgICAgICAvLyBhcm91\nbmQgd2l0aCBTdXBwb3J0c1RpbWVzdGFtcE5hbm9zPWZhbHNlCiAgICAgICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldCgib3JhY2xlLXRpbWVzdGFtcC1i\ndWciKSwgYWUpOwogICAgICAgICAgICAgICAgdGhyb3cgYWU7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGhhbmRsZSBPcmFjbGUgYnVn\nIHdoZXJlIG5hbm9zIG5vdCByZXR1cm5lZCBmcm9tIGNhbGwgd2l0aCBDYWxl\nbmRhcgogICAgICAgIC8vIHBhcmFtZXRlcgogICAgICAgIFRpbWVzdGFtcCB0\ncyA9IHJzLmdldFRpbWVzdGFtcChjb2x1bW4sIGNhbCk7CiAgICAgICAgaWYg\nKHRzICE9IG51bGwgJiYgdHMuZ2V0TmFub3MoKSA9PSAwKQogICAgICAgICAg\nICB0cy5zZXROYW5vcyhycy5nZXRUaW1lc3RhbXAoY29sdW1uKS5nZXROYW5v\ncygpKTsKICAgICAgICByZXR1cm4gdHM7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBnZXRPYmplY3QoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBNYXAg\nbWFwKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8v\nIHJlY2VudCBvcmFjbGUgZHJpdmVycyByZXR1cm4gb3JhY2xlLXNwZWNpZmlj\nIHR5cGVzIGZvciB0aW1lc3RhbXBzCiAgICAgICAgLy8gYW5kIGRhdGVzCiAg\nICAgICAgT2JqZWN0IG9iaiA9IHN1cGVyLmdldE9iamVjdChycywgY29sdW1u\nLCBtYXApOwogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCJvcmFjbGUuc3FsLkRBVEUiLmVx\ndWFscyhvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICBv\nYmogPSBjb252ZXJ0RnJvbU9yYWNsZVR5cGUob2JqLCAiZGF0ZVZhbHVlIik7\nCiAgICAgICAgZWxzZSBpZiAoIm9yYWNsZS5zcWwuVElNRVNUQU1QIi5lcXVh\nbHMob2JqLmdldENsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgb2Jq\nID0gY29udmVydEZyb21PcmFjbGVUeXBlKG9iaiwgInRpbWVzdGFtcFZhbHVl\nIik7CiAgICAgICAgcmV0dXJuIG9iajsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbnZlcnQgYW4gb2JqZWN0IGZyb20gaXRzIHByb3ByaWV0YXJ5IE9yYWNs\nZSB0eXBlIHRvIHRoZSBzdGFuZGFyZAogICAgICogSmF2YSB0eXBlLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgY29udmVydEZyb21PcmFj\nbGVUeXBlKE9iamVjdCBvYmosCiAgICAgICAgU3RyaW5nIGNvbnZlcnRNZXRo\nb2QpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgTWV0aG9kIG0gPSBvYmouZ2V0Q2xhc3MoKS5nZXRN\nZXRob2QoY29udmVydE1ldGhvZCwgKENsYXNzW10pIG51bGwpOwogICAgICAg\nICAgICByZXR1cm4gbS5pbnZva2Uob2JqLCAoT2JqZWN0W10pIG51bGwpOwog\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIGlm\nICh0IGluc3RhbmNlb2YgSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbikKICAg\nICAgICAgICAgICAgIHQgPSAoKEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24p\nIHQpLmdldFRhcmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICBpZiAodCBp\nbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93\nKFNRTEV4Y2VwdGlvbikgdDsKICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4\nY2VwdGlvbih0LmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0YURhdGEg\nbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5h\nbWUsIFN0cmluZyB0YWJsZU5hbWUsIFN0cmluZyBjb2x1bW5OYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ29sdW1uW10gY29scyA9IHN1cGVyLmdldENvbHVtbnMobWV0YSwg\nY2F0YWxvZywgc2NoZW1hTmFtZSwgdGFibGVOYW1lLAogICAgICAgICAgICBj\nb2x1bW5OYW1lLCBjb25uKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNv\nbHMgIT0gbnVsbCAmJiBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoY29sc1tpXS5nZXRUeXBlTmFtZSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGNvbHNbaV0u\nZ2V0VHlwZU5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIlRJTUVT\nVEFNUCIpKQogICAgICAgICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVz\nLlRJTUVTVEFNUCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCJCTE9CIi5lcXVh\nbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAg\nICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAg\nICAgIGVsc2UgaWYgKCJDTE9CIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0u\nZ2V0VHlwZU5hbWUoKSkKICAgICAgICAgICAgICAgIHx8ICJOQ0xPQiIuZXF1\nYWxzSWdub3JlQ2FzZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAg\nICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAg\nICAgICBlbHNlIGlmICgiRkxPQVQiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tp\nXS5nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0\nVHlwZShUeXBlcy5GTE9BVCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCJOVkFS\nQ0hBUiIuZXF1YWxzSWdub3JlQ2FzZShjb2xzW2ldLmdldFR5cGVOYW1lKCkp\nKQogICAgICAgICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLlZBUkNI\nQVIpOwogICAgICAgICAgICBlbHNlIGlmICgiTkNIQVIiLmVxdWFsc0lnbm9y\nZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAgICAg\nIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5DSEFSKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGNvbHM7CiAgICB9CgogICAgcHVibGljIFByaW1hcnlLZXlb\nXSBnZXRQcmltYXJ5S2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsCiAgICAg\nICAgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcg\ndGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgdDAu\nT1dORVIgQVMgVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQo\nInQwLlRBQkxFX05BTUUgQVMgVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgidDAuQ09MVU1OX05BTUUgQVMgQ09MVU1OX05BTUUsICIpLgog\nICAgICAgICAgICBhcHBlbmQoInQwLkNPTlNUUkFJTlRfTkFNRSBBUyBQS19O\nQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkZST00gQUxMX0NPTlNfQ09M\nVU1OUyB0MCwgQUxMX0NPTlNUUkFJTlRTIHQxICIpLgogICAgICAgICAgICBh\ncHBlbmQoIldIRVJFIHQwLk9XTkVSID0gdDEuT1dORVIgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiQU5EIHQwLkNPTlNUUkFJTlRfTkFNRSA9IHQxLkNPTlNU\nUkFJTlRfTkFNRSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEuQ09O\nU1RSQUlOVF9UWVBFID0gJ1AnIik7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUg\nIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCB0MC5PV05F\nUiA9ID8iKTsKICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAuVEFCTEVfTkFNRSA9ID8iKTsK\nCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBh\ncmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAgICAgIFJlc3VsdFNl\ndCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlk\neCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBzY2hlbWFO\nYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwogICAgICAgICAgICBpZiAodGFi\nbGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3Rt\nbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7Cgog\nICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAg\nICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAg\nICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAg\nICAgICAgcGtMaXN0LmFkZChuZXdQcmltYXJ5S2V5KHJzKSk7CiAgICAgICAg\nICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xpc3QudG9BcnJheQogICAg\nICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3BrTGlzdC5zaXplKCldKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\ncnMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBJbmRleFtdIGdldEluZGV4SW5mbyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBib29sZWFuIHVuaXF1\nZSwgYm9vbGVhbiBhcHByb3gsCiAgICAgICAgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZ0J1\nZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFw\ncGVuZCgiU0VMRUNUIHQwLklOREVYX09XTkVSIEFTIFRBQkxFX1NDSEVNLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJMRV9OQU1FIEFTIFRBQkxF\nX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoIkRFQ09ERSh0MS5VTklR\nVUVORVNTLCAnVU5JUVVFJywgMCwgJ05PTlVOSVFVRScsIDEpICIpLgogICAg\nICAgICAgICBhcHBlbmQoIkFTIE5PTl9VTklRVUUsICIpLgogICAgICAgICAg\nICBhcHBlbmQoInQwLklOREVYX05BTUUgQVMgSU5ERVhfTkFNRSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgidDAuQ09MVU1OX05BTUUgQVMgQ09MVU1OX05B\nTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfSU5EX0NPTFVN\nTlMgdDAsIEFMTF9JTkRFWEVTIHQxICIpLgogICAgICAgICAgICBhcHBlbmQo\nIldIRVJFIHQwLklOREVYX09XTkVSID0gdDEuT1dORVIgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiQU5EIHQwLklOREVYX05BTUUgPSB0MS5JTkRFWF9OQU1F\nIik7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9PV05FUiA9ID8iKTsKICAg\nICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBBTkQgdDAuVEFCTEVfTkFNRSA9ID8iKTsKCiAgICAgICAgUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQo\nYnVmLnRvU3RyaW5nKCkpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAg\nICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJD\nYXNlKCksIG51bGwpOwogICAgICAgICAgICBpZiAodGFibGVOYW1lICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCB0\nYWJsZU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7CgogICAgICAgICAgICBy\ncyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBMaXN0IGlk\neExpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChy\ncyAhPSBudWxsICYmIHJzLm5leHQoKSkKICAgICAgICAgICAgICAgIGlkeExp\nc3QuYWRkKG5ld0luZGV4KHJzKSk7CiAgICAgICAgICAgIHJldHVybiAoSW5k\nZXhbXSkgaWR4TGlzdC50b0FycmF5KG5ldyBJbmRleFtpZHhMaXN0LnNpemUo\nKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBycy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIEZvcmVpZ25LZXlbXSBnZXRJbXBvcnRl\nZEtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywK\nICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwg\nQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIFN0cmluZ0J1ZmZlciBkZWxBY3Rpb24gPSBuZXcgU3RyaW5n\nQnVmZmVyKCJERUNPREUodDEuREVMRVRFX1JVTEUiKS4KICAgICAgICAgICAg\nYXBwZW5kKCIsICdOTyBBQ1RJT04nLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRl\nZEtleU5vQWN0aW9uKS4KICAgICAgICAgICAgYXBwZW5kKCIsICdSRVNUUklD\nVCcsICIpLmFwcGVuZChtZXRhLmltcG9ydGVkS2V5UmVzdHJpY3QpLgogICAg\nICAgICAgICBhcHBlbmQoIiwgJ0NBU0NBREUnLCAiKS5hcHBlbmQobWV0YS5p\nbXBvcnRlZEtleUNhc2NhZGUpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1NF\nVCBOVUxMJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXROdWxsKS4K\nICAgICAgICAgICAgYXBwZW5kKCIsICdTRVQgREVGQVVMVCcsICIpLmFwcGVu\nZChtZXRhLmltcG9ydGVkS2V5U2V0RGVmYXVsdCkuCiAgICAgICAgICAgIGFw\ncGVuZCgiKSIpOwoKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0\ncmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVDVCB0Mi5P\nV05FUiBBUyBQS1RBQkxFX1NDSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5k\nKCJ0Mi5UQUJMRV9OQU1FIEFTIFBLVEFCTEVfTkFNRSwgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgidDIuQ09MVU1OX05BTUUgQVMgUEtDT0xVTU5fTkFNRSwg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuT1dORVIgQVMgRktUQUJMRV9T\nQ0hFTSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuVEFCTEVfTkFNRSBB\nUyBGS1RBQkxFX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLkNP\nTFVNTl9OQU1FIEFTIEZLQ09MVU1OX05BTUUsICIpLgogICAgICAgICAgICBh\ncHBlbmQoInQwLlBPU0lUSU9OIEFTIEtFWV9TRVEsICIpLgogICAgICAgICAg\nICBhcHBlbmQoZGVsQWN0aW9uKS5hcHBlbmQoIiBBUyBERUxFVEVfUlVMRSwg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1FIEFT\nIEZLX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoIkRFQ09ERSh0MS5E\nRUZFUlJFRCwgJ0RFRkVSUkVEJywgIikuCiAgICAgICAgICAgIGFwcGVuZCht\nZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5RGVmZXJyZWQpLgogICAgICAgICAg\nICBhcHBlbmQoIiwgJ0lNTUVESUFURScsICIpLgogICAgICAgICAgICBhcHBl\nbmQobWV0YS5pbXBvcnRlZEtleUluaXRpYWxseUltbWVkaWF0ZSkuCiAgICAg\nICAgICAgIGFwcGVuZCgiKSBBUyBERUZFUlJBQklMSVRZICIpLgogICAgICAg\nICAgICBhcHBlbmQoIkZST00gQUxMX0NPTlNfQ09MVU1OUyB0MCwgQUxMX0NP\nTlNUUkFJTlRTIHQxLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTExfQ09O\nU19DT0xVTU5TIHQyICIpLgogICAgICAgICAgICBhcHBlbmQoIldIRVJFIHQw\nLk9XTkVSID0gdDEuT1dORVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5E\nIHQwLkNPTlNUUkFJTlRfTkFNRSA9IHQxLkNPTlNUUkFJTlRfTkFNRSAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEuQ09OU1RSQUlOVF9UWVBFID0g\nJ1InICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5SX09XTkVSID0g\ndDIuT1dORVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJfQ09O\nU1RSQUlOVF9OQU1FID0gdDIuQ09OU1RSQUlOVF9OQU1FICIpLgogICAgICAg\nICAgICBhcHBlbmQoIkFORCB0MC5QT1NJVElPTiA9IHQyLlBPU0lUSU9OIik7\nCiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCB0MC5PV05FUiA9ID8iKTsKICAgICAgICBpZiAo\ndGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBB\nTkQgdDAuVEFCTEVfTkFNRSA9ID8iKTsKICAgICAgICBidWYuYXBwZW5kKCIg\nT1JERVIgQlkgdDIuT1dORVIsIHQyLlRBQkxFX05BTUUsIHQwLlBPU0lUSU9O\nIik7CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gY29ubi5w\ncmVwYXJlU3RhdGVtZW50KGJ1Zi50b1N0cmluZygpKTsKICAgICAgICBSZXN1\nbHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlu\ndCBpZHggPSAxOwogICAgICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgrKywgc2No\nZW1hTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKICAgICAgICAgICAgaWYg\nKHRhYmxlTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAgc2V0U3RyaW5n\nKHN0bW50LCBpZHgrKywgdGFibGVOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwp\nOwoKICAgICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAg\nICAgICAgICAgTGlzdCBma0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgICAgIHdoaWxlIChycyAhPSBudWxsICYmIHJzLm5leHQoKSkKICAgICAg\nICAgICAgICAgIGZrTGlzdC5hZGQobmV3Rm9yZWlnbktleShycykpOwogICAg\nICAgICAgICByZXR1cm4gKEZvcmVpZ25LZXlbXSkgZmtMaXN0LnRvQXJyYXkK\nICAgICAgICAgICAgICAgIChuZXcgRm9yZWlnbktleVtma0xpc3Quc2l6ZSgp\nXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVT\nUUwoVGFibGUgdGFibGUpIHsKICAgICAgICAvLyBvbmx5IG92ZXJyaWRlIGlm\nIHdlIGFyZSBzaW11bGF0aW5nIGF1dG8taW5jcmVtZW5ldCB3aXRoIHRyaWdn\nZXJzCiAgICAgICAgU3RyaW5nW10gY3JlYXRlID0gc3VwZXIuZ2V0Q3JlYXRl\nVGFibGVTUUwodGFibGUpOwogICAgICAgIGlmICghdXNlVHJpZ2dlcnNGb3JB\ndXRvQXNzaWduKQogICAgICAgICAgICByZXR1cm4gY3JlYXRlOwoKICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAg\nIExpc3Qgc2VxcyA9IG51bGw7CiAgICAgICAgU3RyaW5nIHNlcSwgdHJpZzsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgY29scyAhPSBudWxsICYmIGkgPCBj\nb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghY29sc1tpXS5p\nc0F1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAgICAgICAgICAgICBz\nZXFzID0gbmV3IEFycmF5TGlzdCg0KTsKCiAgICAgICAgICAgIHNlcSA9IGF1\ndG9Bc3NpZ25TZXF1ZW5jZU5hbWU7CiAgICAgICAgICAgIGlmIChzZXEgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKG9wZW5qcGEzR2VuZXJhdGVk\nS2V5TmFtZXMpCiAgICAgICAgICAgICAgICAgICAgc2VxID0gZ2V0T3BlbkpQ\nQTNHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2VxID0gZ2V0R2Vu\nZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbHNbaV0pOwogICAgICAgICAgICAg\nICAgc2Vxcy5hZGQoIkNSRUFURSBTRVFVRU5DRSAiICsgc2VxICsgIiBTVEFS\nVCBXSVRIIDEiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3Bl\nbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgICAgIHRyaWcg\nPSBnZXRPcGVuSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKGNvbHNbaV0p\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0cmlnID0gZ2V0\nR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUoY29sc1tpXSk7CgogICAgICAgICAg\nICAvLyBjcmVhdGUgdGhlIHRyaWdnZXIgdGhhdCB3aWxsIGluc2VydCBuZXcg\ndmFsdWVzIGludG8KICAgICAgICAgICAgLy8gdGhlIHRhYmxlIHdoZW5ldmVy\nIGEgcm93IGlzIGNyZWF0ZWQKICAgICAgICAgICAgc2Vxcy5hZGQoIkNSRUFU\nRSBPUiBSRVBMQUNFIFRSSUdHRVIgIiArIHRyaWcKICAgICAgICAgICAgICAg\nICsgIiBCRUZPUkUgSU5TRVJUIE9OICIgKyB0YWJsZS5nZXROYW1lKCkKICAg\nICAgICAgICAgICAgICsgIiBGT1IgRUFDSCBST1cgQkVHSU4gU0VMRUNUICIg\nKyBzZXEgKyAiLm5leHR2YWwgSU5UTyAiCiAgICAgICAgICAgICAgICArICI6\nbmV3LiIgKyBjb2xzW2ldLmdldE5hbWUoKSArICIgRlJPTSBEVUFMOyAiCiAg\nICAgICAgICAgICAgICArICJFTkQgIiArIHRyaWcgKyAiOyIpOwogICAgICAg\nIH0KICAgICAgICBpZiAoc2VxcyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gY3JlYXRlOwoKICAgICAgICAvLyBjb21iaW5lIGNyZWF0ZSB0YWJsZSBz\ncWwgYW5kIGNyZWF0ZSBzZXFlbmNlcyBzcWwKICAgICAgICBTdHJpbmdbXSBz\ncWwgPSBuZXcgU3RyaW5nW2NyZWF0ZS5sZW5ndGggKyBzZXFzLnNpemUoKV07\nCiAgICAgICAgU3lzdGVtLmFycmF5Y29weShjcmVhdGUsIDAsIHNxbCwgMCwg\nY3JlYXRlLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\nZXFzLnNpemUoKTsgaSsrKQogICAgICAgICAgICBzcWxbY3JlYXRlLmxlbmd0\naCArIGldID0gKFN0cmluZykgc2Vxcy5nZXQoaSk7CiAgICAgICAgcmV0dXJu\nIHNxbDsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlU2Vx\ndWVuY2VTUUwoU2VxdWVuY2Ugc2VxKSB7CiAgICAgICAgU3RyaW5nW10gc3Fs\nID0gc3VwZXIuZ2V0Q3JlYXRlU2VxdWVuY2VTUUwoc2VxKTsKICAgICAgICBp\nZiAoc2VxLmdldEFsbG9jYXRlKCkgPiAxKQogICAgICAgICAgICBzcWxbMF0g\nKz0gIiBDQUNIRSAiICsgc2VxLmdldEFsbG9jYXRlKCk7CiAgICAgICAgcmV0\ndXJuIHNxbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNlcXVl\nbmNlc1NRTChTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFt\nZSkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIFNFUVVFTkNFX09X\nTkVSIEFTIFNFUVVFTkNFX1NDSEVNQSwgIikuCiAgICAgICAgICAgIGFwcGVu\nZCgiU0VRVUVOQ0VfTkFNRSBGUk9NIEFMTF9TRVFVRU5DRVMiKTsKICAgICAg\nICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsIHx8IHNlcXVlbmNlTmFtZSAhPSBu\ndWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgV0hFUkUgIik7CiAgICAg\nICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICBidWYu\nYXBwZW5kKCJTRVFVRU5DRV9PV05FUiA9ID8iKTsKICAgICAgICAgICAgaWYg\nKHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCAiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlcXVlbmNl\nTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCJTRVFVRU5D\nRV9OQU1FID0gPyIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbVNlcXVlbmNlKFN0\ncmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAogICAgICAgIGJvb2xlYW4gdGFy\nZ2V0U2NoZW1hKSB7CiAgICAgICAgaWYgKHN1cGVyLmlzU3lzdGVtU2VxdWVu\nY2UobmFtZSwgc2NoZW1hLCB0YXJnZXRTY2hlbWEpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKCiAgICAgICAgLy8gZmlsdGVyIG91dCBnZW5lcmF0ZWQg\nc2VxdWVuY2VzIHVzZWQgZm9yIGF1dG8tYXNzaWduCiAgICAgICAgcmV0dXJu\nIChhdXRvQXNzaWduU2VxdWVuY2VOYW1lICE9IG51bGwKICAgICAgICAgICAg\nJiYgbmFtZS5lcXVhbHNJZ25vcmVDYXNlKGF1dG9Bc3NpZ25TZXF1ZW5jZU5h\nbWUpKQogICAgICAgICAgICB8fCAoYXV0b0Fzc2lnblNlcXVlbmNlTmFtZSA9\nPSBudWxsCiAgICAgICAgICAgICYmIG5hbWUudG9VcHBlckNhc2UoKS5zdGFy\ndHNXaXRoKCJTVF8iKSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRH\nZW5lcmF0ZWRLZXkoQ29sdW1uIGNvbCwgQ29ubmVjdGlvbiBjb25uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghdXNlVHJp\nZ2dlcnNGb3JBdXRvQXNzaWduKQogICAgICAgICAgICByZXR1cm4gTnVtYmVy\ncy52YWx1ZU9mKDBMKTsKCiAgICAgICAgLy8gaWYgd2Ugc2ltdWxhdGUgYXV0\nby1hc3NpZ25lZCBjb2x1bW5zIHVzaW5nIHRyaWdnZXJzIGFuZAogICAgICAg\nIC8vIHNlcXVlbmNlcywgdGhlbiByZXR1cm4gdGhlIGN1cnJlbnQgdmFsdWUg\nb2YgdGhlIHNlcXVlbmNlCiAgICAgICAgLy8gZnJvbSBhdXRvQXNzaWduU2Vx\ndWVuY2VOYW1lCiAgICAgICAgU3RyaW5nIHNlcSA9IGF1dG9Bc3NpZ25TZXF1\nZW5jZU5hbWU7CiAgICAgICAgaWYgKHNlcSA9PSBudWxsICYmIG9wZW5qcGEz\nR2VuZXJhdGVkS2V5TmFtZXMpCiAgICAgICAgICAgIHNlcSA9IGdldE9wZW5K\nUEEzR2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAoc2VxID09IG51bGwpCiAgICAgICAgICAgIHNlcSA9IGdldEdlbmVy\nYXRlZEtleVNlcXVlbmNlTmFtZShjb2wpOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KCJTRUxFQ1Qg\nIiArIHNlcQogICAgICAgICAgICArICIuY3VycnZhbCBGUk9NIERVQUwiKTsK\nICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAg\nICAgIHJzLm5leHQoKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFs\ndWVPZihycy5nZXRMb25nKDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7\nIHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAg\nICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7fQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRyaWdnZXIgbmFtZSBmb3Igc2ltdWxhdGluZyBhdXRvLWFzc2lnbiB2YWx1\nZXMgb24gdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFN0cmluZyBnZXRHZW5lcmF0ZWRLZXlUcmlnZ2VyTmFtZShDb2x1bW4gY29s\nKSB7CiAgICAgICAgLy8gcmVwbGFjZSB0cmFpbGluZyBfU0VRIHdpdGggX1RS\nRwogICAgICAgIFN0cmluZyBzZXFOYW1lID0gZ2V0R2VuZXJhdGVkS2V5U2Vx\ndWVuY2VOYW1lKGNvbCk7CiAgICAgICAgcmV0dXJuIHNlcU5hbWUuc3Vic3Ry\naW5nKDAsIHNlcU5hbWUubGVuZ3RoKCkgLSAzKSArICJUUkciOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyBhIE9wZW5KUEEgMy1jb21wYXRpYmxl\nIG5hbWUgZm9yIGFuIGF1dG8tYXNzaWduIHNlcXVlbmNlLgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyBnZXRPcGVuSlBBM0dlbmVyYXRlZEtleVNlcXVl\nbmNlTmFtZShDb2x1bW4gY29sKSB7CiAgICAgICAgVGFibGUgdGFibGUgPSBj\nb2wuZ2V0VGFibGUoKTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZCgi\nU0VRXyIgKyB0YWJsZS5nZXROYW1lKCksIHRhYmxlLmdldFNjaGVtYSgpLgog\nICAgICAgICAgICBnZXRTY2hlbWFHcm91cCgpLCBtYXhUYWJsZU5hbWVMZW5n\ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\nYSBPcGVuSlBBIDMtY29tcGF0aWJsZSBuYW1lIGZvciBhbiBhdXRvLWFzc2ln\nbiB0cmlnZ2VyLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRPcGVu\nSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsKICAg\nICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgpOwogICAgICAgIHJl\ndHVybiBtYWtlTmFtZVZhbGlkKCJUUklHXyIgKyB0YWJsZS5nZXROYW1lKCks\nIHRhYmxlLmdldFNjaGVtYSgpLgogICAgICAgICAgICBnZXRTY2hlbWFHcm91\ncCgpLCBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRCeXRlczwv\nY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVjdC4KICAgICAq\nIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBibG9iIGlzIHdyYXBwZWQg\naW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3Ig\nZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAg\nICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUg\nbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Qnl0ZXMoT2Jq\nZWN0IGJsb2IsIGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChibG9iID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBpZiAoX3B1dEJ5dGVzID09IG51bGwpIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9wdXRCeXRlcyA9IGJs\nb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInB1dEJ5dGVzIiwKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0ZVtdLmNs\nYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1l\ndGhvZChfcHV0Qnl0ZXMsIGJsb2IsIGRhdGEpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1dFN0cmluZzwvY29kZT4g\nbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CIG9iamVjdC4KICAgICAqIFVzZXMg\ncmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQgaW4gYW5v\ndGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3IgZXhhbXBs\nZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAgICAqIGxv\nYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUgbWV0aG9k\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0U3RyaW5nKE9iamVjdCBj\nbG9iLCBTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoX3B1dFN0cmluZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0U3RyaW5nID0gY2xvYi5n\nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0U3RyaW5nIiwKICAgICAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgU3RyaW5nLmNsYXNz\nIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1ldGhv\nZChfcHV0U3RyaW5nLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRDaGFyczwvY29kZT4gbWV0\naG9kIG9uIHRoZSBnaXZlbiBDTE9CCiAgICAgKiBvYmplY3QuIFVzZXMgcmVm\nbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQgaW4gYW5vdGhl\ncgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3IgZXhhbXBsZSBX\nZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAgICAqIGxvYnMg\naW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUgbWV0aG9kcy4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Q2hhcnMoT2JqZWN0IGNsb2Is\nIGNoYXJbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChfcHV0Q2hhcnMgPT0gbnVsbCkgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgX3B1dENoYXJzID0gY2xvYi5nZXRDbGFz\ncygpLmdldE1ldGhvZCgicHV0Q2hhcnMiLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBjaGFyW10uY2xhc3MgfSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9wdXRD\naGFycywgY2xvYiwgZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZv\na2UgdGhlIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRhcmdldCB3\naXRoIHRoZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyB2b2lkIGludm9rZVB1dExvYk1ldGhvZChNZXRob2QgbWV0aG9kLCBPYmpl\nY3QgdGFyZ2V0LAogICAgICAgIE9iamVjdCBkYXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1l\ndGhvZC5pbnZva2UodGFyZ2V0LCBuZXcgT2JqZWN0W117IE51bWJlcnMudmFs\ndWVPZigxTCksIGRhdGEgfSk7CiAgICAgICAgfSBjYXRjaCAoSW52b2NhdGlv\nblRhcmdldEV4Y2VwdGlvbiBpdGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxl\nIHQgPSBpdGUuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAgICAg\ndGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24odCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBDbG9iIGdl\ndEVtcHR5Q2xvYigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKEVNUFRZX0NMT0IgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIEVNUFRZX0NMT0I7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIEVNUFRZX0NMT0IgPSAoQ2xvYikgQ2xhc3MuZm9yTmFtZSgib3JhY2xl\nLnNxbC5DTE9CIikuCiAgICAgICAgICAgICAgICBnZXRNZXRob2QoImVtcHR5\nX2xvYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICBpbnZva2Uo\nbnVsbCwgbmV3IE9iamVjdFswXSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihl\nLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIEJsb2IgZ2V0RW1wdHlCbG9iKCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoRU1QVFlfQkxPQiAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfQkxPQjsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfQkxPQiA9IChCbG9iKSBDbGFzcy5m\nb3JOYW1lKCJvcmFjbGUuc3FsLkJMT0IiKS4KICAgICAgICAgICAgICAgIGdl\ndE1ldGhvZCgiZW1wdHlfbG9iIiwgbmV3IENsYXNzWzBdKS4KICAgICAgICAg\nICAgICAgIGludm9rZShudWxsLCBuZXcgT2JqZWN0WzBdKTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nU1FMRXhjZXB0aW9uKGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc09yYWNsZVByZXBhcmVk\nU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJldHVybiBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuamRiYy5P\ncmFjbGVQcmVwYXJlZFN0YXRlbWVudCIpLgogICAgICAgICAgICAgICAgaXNJ\nbnN0YW5jZShzdG1udCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0K\nfQo=\n","encoding":"base64"}

