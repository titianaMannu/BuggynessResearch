{"sha":"183c3301b4e40e1d87988992f63e439efe6654e9","node_id":"MDQ6QmxvYjIwNjM2NDoxODNjMzMwMWI0ZTQwZTFkODc5ODg5OTJmNjNlNDM5ZWZlNjY1NGU5","size":14471,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/183c3301b4e40e1d87988992f63e439efe6654e9","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLlJlbGF0aW9uSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0\nYXRlRXhjZXB0aW9uOwoKLyoqCiAqIFByaW1hcnkgdGFibGUgcm93IHRoYXQg\ndHJhY2tzIGZvcmVpZ24ga2V5cyBhbmQgYXV0by1pbmMgY29sdW1ucy4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGlj\nIGNsYXNzIFByaW1hcnlSb3cKICAgIGV4dGVuZHMgUm93SW1wbCB7CgogICAg\nLy8gVkFMSUQgZmxhZyBpbiBzdXBlcmNsYXNzIHVzZXMgMiA8PCAwCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBieXRlIFBLX1NFVCA9IDIgPDwgMTsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGJ5dGUgUEtfV0hFUkUgPSAyIDw8IDI7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBieXRlIERFUEVOREVOVCA9IDIg\nPDwgNDsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFByaW1hcnlSb3cu\nY2xhc3MpOwoKICAgIHByaXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlciBfcGsg\nPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5JTyBfcGtJTyA9IG51bGw7CiAg\nICBwcml2YXRlIE9wZW5KUEFTdGF0ZU1hbmFnZXJbXSBfZmtTZXQgPSBudWxs\nOwogICAgcHJpdmF0ZSBDb2x1bW5JT1tdIF9ma0lPID0gbnVsbDsKICAgIHBy\naXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlcltdIF9ma1doZXJlID0gbnVsbDsK\nICAgIHByaXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlcltdIF9yZWxTZXQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBSZWxhdGlvbklkW10gX2NhbGxiYWNrcyA9IG51\nbGw7CiAgICBwcml2YXRlIE9iamVjdCBfZmFpbGVkID0gbnVsbDsKICAgIHBy\naXZhdGUgaW50IF9pZHggPSAtMTsKCiAgICAvKioKICAgICAqIENvbnN0cnVj\ndG9yOyBzdXBwbHkgdGFibGUgYW5kIGFjdGlvbi4KICAgICAqLwogICAgcHVi\nbGljIFByaW1hcnlSb3coVGFibGUgdGFibGUsIGludCBhY3Rpb24sIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgb3duZXIpIHsKICAgICAgICB0aGlzKHRhYmxlLmdl\ndENvbHVtbnMoKSwgYWN0aW9uLCBvd25lcik7CiAgICB9CgogICAgcHJvdGVj\ndGVkIFByaW1hcnlSb3coQ29sdW1uW10gY29scywgaW50IGFjdGlvbiwgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBvd25lcikgewogICAgICAgIHN1cGVyKGNvbHMs\nIGFjdGlvbik7CiAgICAgICAgX3BrID0gb3duZXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYXJrIHRoaXMgcm93IGFzIGRlcGVuZGVudCBvbiBzb21lIG90\naGVyIHJvdy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZXBlbmRl\nbnQoKSB7CiAgICAgICAgcmV0dXJuIChmbGFncyAmIERFUEVOREVOVCkgPiAw\nOwogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGlzIHJvdyBhcyBkZXBl\nbmRlbnQgb24gc29tZSBvdGhlciByb3cuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERlcGVuZGVudChib29sZWFuIGRlcGVuZGVudCkgewogICAgICAg\nIGlmIChkZXBlbmRlbnQpCiAgICAgICAgICAgIGZsYWdzIHw9IERFUEVOREVO\nVDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZsYWdzICY9IH5ERVBFTkRF\nTlQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggb2YgdGhpcyBy\nb3cgaW4gb3JkZXJlZCByb3cgbGlzdC4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2lkeDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBpbmRleCBvZiB0aGlzIHJvdyBpbiBvcmRlcmVk\nIHJvdyBsaXN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRleChp\nbnQgaWR4KSB7CiAgICAgICAgX2lkeCA9IGlkeDsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEZhaWxlZE9iamVjdCgpIHsKICAgICAgICByZXR1cm4g\nX2ZhaWxlZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGYWlsZWRPYmpl\nY3QoT2JqZWN0IGZhaWxlZCkgewogICAgICAgIF9mYWlsZWQgPSBmYWlsZWQ7\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0UHJp\nbWFyeUtleSgpIHsKICAgICAgICByZXR1cm4gX3BrOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFByaW1hcnlLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRQ\ncmltYXJ5S2V5KG51bGwsIHNtKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRQcmltYXJ5S2V5KENvbHVtbklPIGlvLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKSB7CiAgICAgICAgX3BrID0gc207CiAgICAgICAgZmxhZ3MgfD0gUEtf\nU0VUOwogICAgICAgIF9wa0lPID0gaW87CgogICAgICAgIC8vIGZvcmNlIHZh\nbGlkCiAgICAgICAgc2V0VmFsaWQodHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX3BrID0g\nc207CiAgICAgICAgZmxhZ3MgfD0gUEtfV0hFUkU7CgogICAgICAgIC8vIGZv\ncmNlIHZhbGlkCiAgICAgICAgaWYgKGdldEFjdGlvbigpID09IEFDVElPTl9E\nRUxFVEUpCiAgICAgICAgICAgIHNldFZhbGlkKHRydWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBJL08gaW5mb3JtYXRpb24gZm9yIHRo\nZSBnaXZlbiBzZXQgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2x1bW5JTyBnZXRGb3JlaWduS2V5SU8oRm9yZWlnbktleSBmaykgewogICAg\nICAgIHJldHVybiAoX2ZrSU8gPT0gbnVsbCkgPyBudWxsIDogX2ZrSU9bZmsu\nZ2V0SW5kZXgoKV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZhbHVlIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkuIFZhbHVlcyBub3Qg\nbmVlZGVkIGZvcgogICAgICogY29uc3RyYWludCBhbmFseXNlcyBhcmUgbm90\nIHJlY29yZGVkLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFu\nYWdlciBnZXRGb3JlaWduS2V5U2V0KEZvcmVpZ25LZXkgZmspIHsKICAgICAg\nICByZXR1cm4gKF9ma1NldCA9PSBudWxsKSA/IG51bGwgOiBfZmtTZXRbZmsu\nZ2V0SW5kZXgoKV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZhbHVlIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkuIFZhbHVlcyBub3Qg\nbmVlZGVkIGZvcgogICAgICogY29uc3RyYWludCBhbmFseXNlcyBhcmUgbm90\nIHJlY29yZGVkLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFu\nYWdlciBnZXRGb3JlaWduS2V5V2hlcmUoRm9yZWlnbktleSBmaykgewogICAg\nICAgIHJldHVybiAoX2ZrV2hlcmUgPT0gbnVsbCkgPyBudWxsIDogX2ZrV2hl\ncmVbZmsuZ2V0SW5kZXgoKV07CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndEZvcmVpZ25LZXkoZmssIG51bGwsIHNtKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIENvbHVtbklPIGlv\nLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFkZWxheUZvcmVpZ25L\nZXkoZmssIHNtLCB0cnVlKSkKICAgICAgICAgICAgc3VwZXIuc2V0Rm9yZWln\nbktleShmaywgaW8sIHNtKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJl\nY29yZEZvcmVpZ25LZXkoZmssIGlvLCBzbSwgdHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKCFkZWxheUZvcmVpZ25LZXkoZmssIHNtLCBm\nYWxzZSkpCiAgICAgICAgICAgIHN1cGVyLndoZXJlRm9yZWlnbktleShmaywg\nc20pOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVjb3JkRm9yZWlnbktl\neShmaywgbnVsbCwgc20sIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBjbGVhckZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5jbGVhckZvcmVpZ25L\nZXkoZmspOwogICAgICAgIGlmIChfZmtTZXQgIT0gbnVsbCkKICAgICAgICAg\nICAgX2ZrU2V0W2ZrLmdldEluZGV4KCldID0gbnVsbDsKICAgICAgICBpZiAo\nX2ZrSU8gIT0gbnVsbCkKICAgICAgICAgICAgX2ZrSU9bZmsuZ2V0SW5kZXgo\nKV0gPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhpcyBpcyBh\nIGRlbGV0ZSwgZGVsYXkgZm9yZWlnbiBrZXlzIHRvIG90aGVyIGRlbGV0ZWQg\nb2JqZWN0cyBpZgogICAgICogdGhlIGtleSBpcyByZXN0cmljdGVkLiBJZiB0\naGlzIGlzIGFuIHVwZGF0ZSBvciBpbnNlcnQsIGRlbGF5IGZvcmVpZ24KICAg\nICAqIGtleXMgdG8gb3RoZXIgaW5zZXJ0cyBpZiB0aGUga2V5IGlzIG5vdCBs\nb2dpY2FsLiBJZiB0aGUgZm9yZWlnbiBrZXkKICAgICAqIGlzIHRvIGEgbmV3\nIHJlY29yZCBhbmQgdGhlIGNvbHVtbnMgYXJlIGF1dG8taW5jLCByZWNvcmQg\naXQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBkZWxheUZvcmVpZ25L\nZXkoRm9yZWlnbktleSBmaywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAg\nICAgICBib29sZWFuIHNldCkgewogICAgICAgIGlmIChzbSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChnZXRBY3Rp\nb24oKSA9PSBBQ1RJT05fREVMRVRFKQogICAgICAgICAgICByZXR1cm4gc20u\naXNEZWxldGVkKCkgJiYgIWZrLmlzRGVmZXJyZWQoKQogICAgICAgICAgICAg\nICAgJiYgZmsuZ2V0RGVsZXRlQWN0aW9uKCkgPT0gRm9yZWlnbktleS5BQ1RJ\nT05fUkVTVFJJQ1Q7CgogICAgICAgIGlmICghc20uaXNOZXcoKSB8fCBzbS5p\nc0ZsdXNoZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmICghZmsuaXNEZWZlcnJlZCgpICYmICFmay5pc0xvZ2ljYWwoKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGZrLmlzUHJpbWFy\neUtleUF1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWNvcmQgYSBkZWxheWVkIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVjb3JkRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBDb2x1\nbW5JTyBpbywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29s\nZWFuIHNldCkgewogICAgICAgIGlmIChzZXQpIHsKICAgICAgICAgICAgLy8g\nZm9yY2UgdmFsaWQKICAgICAgICAgICAgaWYgKGNhblNldEFueShpbywgZmsu\nZ2V0Q29sdW1ucygpLmxlbmd0aAogICAgICAgICAgICAgICAgKyBmay5nZXRD\nb25zdGFudENvbHVtbnMoKS5sZW5ndGgsIGZhbHNlKSkKICAgICAgICAgICAg\nICAgIHNldFZhbGlkKHRydWUpOwoKICAgICAgICAgICAgaWYgKF9ma1NldCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2ZrU2V0ID0gbmV3IE9wZW5KUEFT\ndGF0ZU1hbmFnZXJbZ2V0VGFibGUoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRGb3JlaWduS2V5cygpLmxlbmd0aF07CiAgICAgICAgICAgIF9ma1NldFtm\nay5nZXRJbmRleCgpXSA9IHNtOwoKICAgICAgICAgICAgaWYgKF9ma0lPICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZmtJT1tmay5nZXRJbmRleCgpXSA9\nIGlvOwogICAgICAgICAgICBlbHNlIGlmIChpbyAhPSBudWxsICYmICgoZ2V0\nQWN0aW9uKCkgPT0gQUNUSU9OX0lOU0VSVAogICAgICAgICAgICAgICAgJiYg\nIWlvLmlzQWxsSW5zZXJ0YWJsZShmaywgZmFsc2UpKQogICAgICAgICAgICAg\nICAgfHwgKGdldEFjdGlvbigpICE9IEFDVElPTl9JTlNFUlQKICAgICAgICAg\nICAgICAgICYmICFpby5pc0FsbFVwZGF0YWJsZShmaywgZmFsc2UpKSkpIHsK\nICAgICAgICAgICAgICAgIF9ma0lPID0gbmV3IENvbHVtbklPW19ma1NldC5s\nZW5ndGhdOwogICAgICAgICAgICAgICAgX2ZrSU9bZmsuZ2V0SW5kZXgoKV0g\nPSBpbzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIC8vIGZvcmNlIHZhbGlkCiAgICAgICAgICAgIGlmIChnZXRBY3Rpb24o\nKSA9PSBBQ1RJT05fREVMRVRFKQogICAgICAgICAgICAgICAgc2V0VmFsaWQo\ndHJ1ZSk7CgogICAgICAgICAgICBpZiAoX2ZrV2hlcmUgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9ma1doZXJlID0gbmV3IE9wZW5KUEFTdGF0ZU1hbmFn\nZXJbZ2V0VGFibGUoKS4KICAgICAgICAgICAgICAgICAgICBnZXRGb3JlaWdu\nS2V5cygpLmxlbmd0aF07CiAgICAgICAgICAgIF9ma1doZXJlW2ZrLmdldElu\nZGV4KCldID0gc207CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSByZWNvcmRlZCB2YWx1ZSBmb3IgdGhlIGdpdmVuIHJlbGF0\naW9uIGlkIGNvbHVtbi4gT25seQogICAgICogdmFsdWVzIHRoYXQgYXJlIGRl\ncGVuZGVudCBvbiBhIG5ldywgdW5mbHVzaGVkIGF1dG8tYXNzaWduZWQgaW5z\ndGFuY2UKICAgICAqIGFyZSByZWNvcmRlZC4KICAgICAqLwogICAgcHVibGlj\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0UmVsYXRpb25JZFNldChDb2x1bW4g\nY29sKSB7CiAgICAgICAgcmV0dXJuIChfcmVsU2V0ID09IG51bGwpID8gbnVs\nbCA6IF9yZWxTZXRbZ2V0UmVsYXRpb25JZEluZGV4KGNvbCldOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZWNvcmRlZCBjYWxsYmFja3Mg\nZm9yIHRoZSBnaXZlbiByZWxhdGlvbiBpZCBjb2x1bW4uIE9ubHkKICAgICAq\nIHZhbHVlcyB0aGF0IGFyZSBkZXBlbmRlbnQgb24gYSBuZXcsIHVuZmx1c2hl\nZCBhdXRvLWFzc2lnbmVkIGluc3RhbmNlCiAgICAgKiBhcmUgcmVjb3JkZWQu\nCiAgICAgKi8KICAgIHB1YmxpYyBSZWxhdGlvbklkIGdldFJlbGF0aW9uSWRD\nYWxsYmFjayhDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIChfY2FsbGJh\nY2tzID09IG51bGwpID8gbnVsbAogICAgICAgICAgICA6IF9jYWxsYmFja3Nb\nZ2V0UmVsYXRpb25JZEluZGV4KGNvbCldOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFJlbGF0aW9uSWQoQ29sdW1uIGNvbCwgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwKICAgICAgICBSZWxhdGlvbklkIHJlbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc20gPT0gbnVsbCB8fCBz\nbS5nZXRPYmplY3RJZCgpICE9IG51bGwgfHwgIXNtLmlzTmV3KCkKICAgICAg\nICAgICAgfHwgc20uaXNGbHVzaGVkKCkgfHwgIWlzUHJpbWFyeUtleUF1dG9B\nc3NpZ25lZChzbSkpCiAgICAgICAgICAgIHN1cGVyLnNldFJlbGF0aW9uSWQo\nY29sLCBzbSwgcmVsKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYg\nKF9yZWxTZXQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29sdW1uW10g\nY29scyA9IGdldFRhYmxlKCkuZ2V0UmVsYXRpb25JZENvbHVtbnMoKTsKICAg\nICAgICAgICAgICAgIF9yZWxTZXQgPSBuZXcgT3BlbkpQQVN0YXRlTWFuYWdl\ncltjb2xzLmxlbmd0aF07CiAgICAgICAgICAgICAgICBfY2FsbGJhY2tzID0g\nbmV3IFJlbGF0aW9uSWRbY29scy5sZW5ndGhdOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGludCBpZHggPSBnZXRSZWxhdGlvbklkSW5kZXgoY29sKTsK\nICAgICAgICAgICAgX3JlbFNldFtpZHhdID0gc207CiAgICAgICAgICAgIF9j\nYWxsYmFja3NbaWR4XSA9IHJlbDsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY2xlYXJSZWxhdGlvbklkKENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuY2xlYXJSZWxh\ndGlvbklkKGNvbCk7CiAgICAgICAgaWYgKF9yZWxTZXQgIT0gbnVsbCkgewog\nICAgICAgICAgICBpbnQgaWR4ID0gZ2V0UmVsYXRpb25JZEluZGV4KGNvbCk7\nCiAgICAgICAgICAgIF9yZWxTZXRbaWR4XSA9IG51bGw7CiAgICAgICAgICAg\nIF9jYWxsYmFja3NbaWR4XSA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBpbmRleCBpbnRvIG91ciByZWxhdGlv\nbiBpZCBhcnJheSBvZiB0aGUgdmFsdWUgZm9yIHRoZQogICAgICogZ2l2ZW4g\nY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRSZWxhdGlvbklk\nSW5kZXgoQ29sdW1uIGNvbCkgewogICAgICAgIENvbHVtbltdIGNvbHMgPSBn\nZXRUYWJsZSgpLmdldFJlbGF0aW9uSWRDb2x1bW5zKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBpZiAoY29sc1tpXSA9PSBjb2wpCiAgICAgICAgICAgICAgICByZXR1cm4g\naTsKICAgICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiBhbnkgcHJpbWFyeSBrZXkgY29sdW1ucyBvZiB0aGUg\nZ2l2ZW4gaW5zdGFuY2UgYXJlCiAgICAgKiBhdXRvLWFzc2lnbmVkLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzUHJpbWFyeUtleUF1\ndG9Bc3NpZ25lZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nIGNscyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgd2hpbGUgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgQ29s\ndW1uW10gY29scyA9IGNscy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKGNvbHNbaV0uaXNBdXRvQXNzaWduZWQoKSkKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRPYmplY3QoQ29sdW1uIGNv\nbCwgT2JqZWN0IHZhbCwgaW50IG1ldGFUeXBlLAogICAgICAgIGJvb2xlYW4g\nb3ZlcnJpZGVEZWZhdWx0KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSdyZSBub3Qgc2V0dGluZyB0d28g\nZGlmZmVyZW50IHZhbHVlcwogICAgICAgIE9iamVjdCBwcmV2ID0gZ2V0U2V0\nKGNvbCk7CiAgICAgICAgaWYgKHByZXYgIT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAocHJldiA9PSBOVUxMKQogICAgICAgICAgICAgICAgcHJldiA9IG51\nbGw7CiAgICAgICAgICAgIGlmICghcm93VmFsdWVFcXVhbHMocHJldiwgdmFs\nKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgiZGlmZi12YWx1ZXMiLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgY29sLmdldEZ1bGxOYW1lKCksCiAgICAg\nICAgICAgICAgICAgICAgICAgIChwcmV2ID09IG51bGwpID8gbnVsbCA6IHBy\nZXYuZ2V0Q2xhc3MoKSwgcHJldiwKICAgICAgICAgICAgICAgICAgICAgICAg\nKHZhbCA9PSBudWxsKSA/IG51bGwgOiB2YWwuZ2V0Q2xhc3MoKSwgdmFsIH0p\nKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYXRhbCh0cnVlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBzdXBlci5zZXRPYmplY3QoY29s\nLCB2YWwsIG1ldGFUeXBlLCBvdmVycmlkZURlZmF1bHQpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHR3byB2YWx1ZXMgc2hv\ndWxkIGJlIGNvbnNpZGVyZWQgZXF1YWwuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGJvb2xlYW4gcm93VmFsdWVFcXVhbHMoT2JqZWN0IG8xLCBPYmpl\nY3QgbzIpIHsKICAgICAgICBpZiAoT2JqZWN0VXRpbHMuZXF1YWxzKG8xLCBv\nMikpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBjaGVj\nayBmb3IgbnVtZXJpYyBlcXVhbGl0eSAoYnVnICMxMTUxKQogICAgICAgIHJl\ndHVybiBvMSBpbnN0YW5jZW9mIE51bWJlciAmJiBvMiBpbnN0YW5jZW9mIE51\nbWJlcgogICAgICAgICAgICAmJiAoKE51bWJlcikgbzEpLmRvdWJsZVZhbHVl\nKCkgPT0gKChOdW1iZXIpIG8yKS5kb3VibGVWYWx1ZSgpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2VuZXJhdGVTUUwoREJEaWN0aW9uYXJ5IGRp\nY3QpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKGZsYWdzICYg\nUEtfU0VUKSA+IDApCiAgICAgICAgICAgICAgICBzdXBlci5zZXRQcmltYXJ5\nS2V5KF9wa0lPLCBfcGspOwogICAgICAgICAgICBpZiAoKGZsYWdzICYgUEtf\nV0hFUkUpID4gMCkKICAgICAgICAgICAgICAgIHN1cGVyLndoZXJlUHJpbWFy\neUtleShfcGspOwogICAgICAgICAgICBpZiAoX2ZrU2V0ICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSBnZXRUYWJsZSgp\nLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgICAgICBDb2x1bW5JTyBp\nbzsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2ZrU2V0\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9ma1Nl\ndFtpXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlvID0g\nKF9ma0lPID09IG51bGwpID8gbnVsbCA6IF9ma0lPW2ldOwogICAgICAgICAg\nICAgICAgICAgICAgICBzdXBlci5zZXRGb3JlaWduS2V5KGZrc1tpXSwgaW8s\nIF9ma1NldFtpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfcmVsU2V0\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSBn\nZXRUYWJsZSgpLmdldFJlbGF0aW9uSWRDb2x1bW5zKCk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9yZWxTZXQubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICAgICAgaWYgKF9yZWxTZXRbaV0gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXIuc2V0UmVsYXRpb25JZChj\nb2xzW2ldLCBfcmVsU2V0W2ldLCBfY2FsbGJhY2tzW2ldKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoX2ZrV2hlcmUgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IGdldFRhYmxlKCkuZ2V0\nRm9yZWlnbktleXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgX2ZrV2hlcmUubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9ma1doZXJlW2ldICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHN1cGVyLndoZXJlRm9yZWlnbktleShma3NbaV0sIF9ma1doZXJl\nW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2Vw\ndGlvbnMuZ2V0U3RvcmUoc2UsIGRpY3QpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gc3VwZXIuZ2VuZXJhdGVTUUwoZGljdCk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIFJvd0ltcGwgbmV3SW5zdGFuY2UoQ29sdW1uW10gY29scywgaW50\nIGFjdGlvbikgewogICAgICAgIHJldHVybiBuZXcgUHJpbWFyeVJvdyhjb2xz\nLCBhY3Rpb24sIF9wayk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29weUlu\ndG8oUm93SW1wbCByb3csIGJvb2xlYW4gd2hlcmVPbmx5KSB7CiAgICAgICAg\nc3VwZXIuY29weUludG8ocm93LCB3aGVyZU9ubHkpOwogICAgICAgIGlmICgh\nKHJvdyBpbnN0YW5jZW9mIFByaW1hcnlSb3cpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIFByaW1hcnlSb3cgcHJvdyA9IChQcmltYXJ5Um93KSBy\nb3c7CiAgICAgICAgcHJvdy5fcGsgPSBfcGs7CiAgICAgICAgcHJvdy5fcGtJ\nTyA9IF9wa0lPOwogICAgICAgIGlmICgoZmxhZ3MgJiBQS19XSEVSRSkgPiAw\nKQogICAgICAgICAgICBwcm93LmZsYWdzIHw9IFBLX1dIRVJFOwogICAgICAg\nIGlmICghd2hlcmVPbmx5ICYmIChmbGFncyAmIFBLX1NFVCkgPiAwKQogICAg\nICAgICAgICBwcm93LmZsYWdzIHw9IFBLX1NFVDsKCiAgICAgICAgaWYgKF9m\na1doZXJlICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHByb3cuX2ZrV2hl\ncmUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHByb3cuX2ZrV2hlcmUgPSBu\nZXcgT3BlbkpQQVN0YXRlTWFuYWdlcltfZmtXaGVyZS5sZW5ndGhdOwogICAg\nICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KF9ma1doZXJlLCAwLCBwcm93Ll9m\na1doZXJlLCAwLCBfZmtXaGVyZS5sZW5ndGgpOwogICAgICAgIH0KICAgICAg\nICBpZiAoIXdoZXJlT25seSAmJiBfZmtTZXQgIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAocHJvdy5fZmtTZXQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHByb3cuX2ZrU2V0ID0gbmV3IE9wZW5KUEFTdGF0ZU1hbmFnZXJbX2ZrU2V0\nLmxlbmd0aF07CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX2ZrU2V0\nLCAwLCBwcm93Ll9ma1NldCwgMCwgX2ZrU2V0Lmxlbmd0aCk7CiAgICAgICAg\nICAgIGlmIChfZmtJTyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\ncHJvdy5fZmtJTyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHByb3cu\nX2ZrSU8gPSBuZXcgQ29sdW1uSU9bX2ZrSU8ubGVuZ3RoXTsKICAgICAgICAg\nICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX2ZrSU8sIDAsIHByb3cuX2ZrSU8s\nIDAsIF9ma0lPLmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaWYgKCF3aGVyZU9ubHkgJiYgX3JlbFNldCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChwcm93Ll9yZWxTZXQgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgcHJvdy5fcmVsU2V0ID0gbmV3IE9wZW5KUEFTdGF0ZU1hbmFn\nZXJbX3JlbFNldC5sZW5ndGhdOwogICAgICAgICAgICAgICAgcHJvdy5fY2Fs\nbGJhY2tzID0gbmV3IFJlbGF0aW9uSWRbX2NhbGxiYWNrcy5sZW5ndGhdOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX3Jl\nbFNldCwgMCwgcHJvdy5fcmVsU2V0LCAwLCBfcmVsU2V0Lmxlbmd0aCk7CiAg\nICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX2NhbGxiYWNrcywgMCwgcHJv\ndy5fY2FsbGJhY2tzLCAwLAogICAgICAgICAgICAgICAgX2NhbGxiYWNrcy5s\nZW5ndGgpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

