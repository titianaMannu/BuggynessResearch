{"sha":"38b27c7ca8a4d5cde5a8620a977aabe6d9f4e7bb","node_id":"MDQ6QmxvYjIwNjM2NDozOGIyN2M3Y2E4YTRkNWNkZTVhODYyMGE5NzdhYWJlNmQ5ZjRlN2Ji","size":28607,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/38b27c7ca8a4d5cde5a8620a977aabe6d9f4e7bb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLm1hdGgu\nQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc3FsLkFycmF5OwppbXBvcnQgamF2\nYS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZh\nLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNx\nbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5Mb2NhbGU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9y\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5K\nYXZhU1FMVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5SZWxhdGlvbklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBz\nZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBCYXNpYyB7QGxpbmsgUm93fSBp\nbXBsZW1lbnRhdGlvbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5v\namF2YWRvYwogKi8KcHVibGljIGNsYXNzIFJvd0ltcGwKICAgIGltcGxlbWVu\ndHMgUm93LCBDbG9uZWFibGUgewoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7CiAgICBwcm90ZWN0ZWQg\nc3RhdGljIGZpbmFsIGludCBWQUxJRCA9IDIgPDwgMDsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgUkFXID0gSW50ZWdlci5NSU5fVkFMVUU7Cgog\nICAgcHJvdGVjdGVkIGJ5dGUgZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBmaW5h\nbCBDb2x1bW5bXSBfY29sczsKICAgIHByaXZhdGUgZmluYWwgaW50IF9hY3Rp\nb247CiAgICBwcml2YXRlIGZpbmFsIE9iamVjdFtdIF92YWxzOwogICAgcHJp\ndmF0ZSBmaW5hbCBpbnRbXSBfdHlwZXM7CgogICAgcHJpdmF0ZSBTdHJpbmcg\nX3NxbCA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAg\nICAqCiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIHRhYmxlIHRoZSByb3cgaXMg\nYSBwYXJ0IG9mCiAgICAgKiBAcGFyYW0gYWN0aW9uIHRoZSBhY3Rpb24gb24g\ndGhlIHJvdwogICAgICovCiAgICBwdWJsaWMgUm93SW1wbChUYWJsZSB0YWJs\nZSwgaW50IGFjdGlvbikgewogICAgICAgIHRoaXModGFibGUuZ2V0Q29sdW1u\ncygpLCBhY3Rpb24pOwogICAgfQoKICAgIHByb3RlY3RlZCBSb3dJbXBsKENv\nbHVtbltdIGNvbHMsIGludCBhY3Rpb24pIHsKICAgICAgICBfY29scyA9IGNv\nbHM7CiAgICAgICAgX2FjdGlvbiA9IGFjdGlvbjsKCiAgICAgICAgLy8gd2Ug\nbmVlZCByb29tIGZvciB2YWx1ZXMgYW5kIHR5cGVzIGZvciBhbGwgY29sdW1u\nczsgaWYgYW4gdXBkYXRlIG9yCiAgICAgICAgLy8gZGVsZXRlLCB0aGVuIHdl\nIG5lZWQgdG8gZG91YmxlIHRoYXQgZm9yIHdoZXJlIGNvbHVtbiBjb25kaXRp\nb25zCiAgICAgICAgaW50IGxlbiA9IF9jb2xzLmxlbmd0aDsKICAgICAgICBp\nZiAoYWN0aW9uICE9IEFDVElPTl9JTlNFUlQpCiAgICAgICAgICAgIGxlbiAq\nPSAyOwogICAgICAgIF92YWxzID0gbmV3IE9iamVjdFtsZW5dOwogICAgICAg\nIF90eXBlcyA9IG5ldyBpbnRbbGVuXTsKICAgIH0KCiAgICBwdWJsaWMgVGFi\nbGUgZ2V0VGFibGUoKSB7CiAgICAgICAgcmV0dXJuIF9jb2xzWzBdLmdldFRh\nYmxlKCk7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMo\nKSB7CiAgICAgICAgcmV0dXJuIF9jb2xzOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgZ2V0QWN0aW9uKCkgewogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVmFsaWQoKSB7CiAgICAgICAgcmV0\ndXJuIChmbGFncyAmIFZBTElEKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFZhbGlkKGJvb2xlYW4gdmFsaWQpIHsKICAgICAgICBpZiAodmFs\naWQpCiAgICAgICAgICAgIGZsYWdzIHw9IFZBTElEOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgZmxhZ3MgJj0gflZBTElEOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhpcyBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCB0cmFjayBwcmlt\nYXJ5IGtleXMuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIGdldFByaW1hcnlLZXkoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGltcGxlbWVudGF0aW9uIGRvZXMg\nbm90IHRyYWNrIGZhaWxlZCBvYmplY3RzLgogICAgICovCiAgICBwdWJsaWMg\nT2JqZWN0IGdldEZhaWxlZE9iamVjdCgpIHsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24g\nZG9lcyBub3QgdHJhY2sgZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEZhaWxlZE9iamVjdChPYmplY3QgZmFpbGVkKSB7CiAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZWNvbmRhcnkgcm93cyBjYW5ub3QgYmUgZGVwZW5k\nZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlcGVuZGVudCgp\nIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHZhbHVlIHNldCBmb3IgdXBkYXRlIG9uIHRoZSBnaXZl\nbiBjb2x1bW4uCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0U2V0KENv\nbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gX3ZhbHNbZ2V0U2V0SW5kZXgo\nY29sKV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVl\nIHNldCBmb3Igd2hlcmUgb24gdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwog\nICAgcHVibGljIE9iamVjdCBnZXRXaGVyZShDb2x1bW4gY29sKSB7CiAgICAg\nICAgcmV0dXJuIF92YWxzW2dldFdoZXJlSW5kZXgoY29sKV07CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0UHJpbWFyeUtleShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHNldFByaW1hcnlLZXkobnVsbCwgc20pOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFByaW1hcnlLZXkoQ29sdW1uSU8gaW8sIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgZmx1c2hQcmltYXJ5S2V5KHNtLCBpbywgdHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmx1c2hQcmltYXJ5S2V5KHNtLCBudWxsLCBmYWxzZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGbHVzaCB0aGUgcHJpbWFyeSBrZXkgdmFsdWVzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgZmx1c2hQcmltYXJ5S2V5KE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIENvbHVtbklPIGlvLAogICAgICAgIGJvb2xlYW4g\nc2V0KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICB3aGlsZSAobWFwcGluZy5nZXRUYWJsZSgpICE9\nIGdldFRhYmxlKCkpCiAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBwaW5nLmdl\ndFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGZs\ndXNoSm9pblZhbHVlcyhzbSwgY29scywgY29scywgaW8sIHNldCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Rm9yZWlnbktleShGb3JlaWduS2V5IGZr\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHNldEZvcmVpZ25LZXkoZmssIG51bGwsIHNt\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGb3JlaWduS2V5KEZvcmVp\nZ25LZXkgZmssIENvbHVtbklPIGlvLAogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgZmx1c2hGb3JlaWduS2V5KGZrLCBpbywgc20sIHRydWUpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZr\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGZsdXNoRm9yZWlnbktleShmaywgbnVsbCwg\nc20sIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGEgY2ly\nY3VsYXIgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNs\nZWFyRm9yZWlnbktleShGb3JlaWduS2V5IGZrKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIF9zcWwgPSBudWxsOwogICAgICAgIENv\nbHVtbltdIGNvbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBf\ndmFsc1tnZXRTZXRJbmRleChjb2xzW2ldKV0gPSBudWxsOwogICAgfQoKICAg\nIC8qKgogICAgICogRmx1c2ggdGhlIGZvcmVpZ24ga2V5IHZhbHVlcy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoRm9yZWlnbktleShGb3JlaWdu\nS2V5IGZrLCBDb2x1bW5JTyBpbywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBib29sZWFuIHNldCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBmbHVzaEpvaW5WYWx1ZXMoc20sIGZrLmdldFByaW1h\ncnlLZXlDb2x1bW5zKCksIGZrLmdldENvbHVtbnMoKSwKICAgICAgICAgICAg\naW8sIHNldCk7CiAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAg\nICAgQ29sdW1uW10gY29scyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwog\nICAgICAgICAgICBpbnQgbGVuID0gZmsuZ2V0Q29sdW1ucygpLmxlbmd0aDsK\nICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgaW50IHR5cGU7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgb2JqID0gZmsuZ2V0Q29uc3RhbnQo\nY29sc1tpXSk7CiAgICAgICAgICAgICAgICB0eXBlID0gY29sc1tpXS5nZXRK\nYXZhVHlwZSgpOwogICAgICAgICAgICAgICAgaWYgKHNldCAmJiBjYW5TZXQo\naW8sIGkgKyBsZW4sIG9iaiA9PSBudWxsKSkKICAgICAgICAgICAgICAgICAg\nICBzZXRPYmplY3QoY29sc1tpXSwgb2JqLCB0eXBlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBlbHNlIGlmICghc2V0KQogICAgICAgICAgICAgICAgICAg\nIHdoZXJlT2JqZWN0KGNvbHNbaV0sIG9iaiwgdHlwZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCB0aGUg\nZ2l2ZW4gaW5zdGFuY2UgdmFsdWUgdG8gdGhlIGdpdmVuIGNvbHVtbnMuIE5v\ndGUgdGhhdAogICAgICogZm9yZWlnbiBrZXlzIG1heSBpbmNsdWRlIGNvbHVt\nbnMgYWxzbyBtYXBwZWQgYnkgc2ltcGxlIHZhbHVlcy4gV2UKICAgICAqIHVz\nZSBhIHByaW9yaXR5IG1lY2hhbmlzbSB0byBlbnN1cmUgdGhhdCB3ZSBkbyBu\nb3QgbGV0IHRoZSBudWxsaW5nCiAgICAgKiBvZiBhIGZvcmVpZ24ga2V5IG51\nbGwgY29sdW1ucyBhbHNvIG93bmVkIGJ5IHNpbXBsZSB2YWx1ZXMuCiAgICAg\nKgogICAgICogQHBhcmFtIHRvIHRoZSBpbnN0YW5jZSBiZWluZyBqb2luZWQg\ndG8KICAgICAqIEBwYXJhbSB0b0NvbHMgdGhlIGNvbHVtbnMgYmVpbmcgam9p\nbmVkIHRvCiAgICAgKiBAcGFyYW0gZnJvbUNvbHMgdGhlIGNvbHVtbnMgYmVp\nbmcgam9pbmVkIGZyb20KICAgICAqIEBwYXJhbSBpbyBpbmZvcm1hdGlvbiBh\nYm91dCBJL08gY2FwYWJpbGl0aWVzIGluIHRoaXMgY29udGV4dAogICAgICog\nQHBhcmFtIHNldCB3aGV0aGVyIHRoaXMgc2hvdWxkIGJlIGZsdXNoZWQgYXMg\nYW4gdXBkYXRlIG9yCiAgICAgKiBhcyBhIHdoZXJlIGNvbmRpdGlvbgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgZmx1c2hKb2luVmFsdWVzKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgdG8sIENvbHVtbltdIHRvQ29scywKICAgICAgICBDb2x1\nbW5bXSBmcm9tQ29scywgQ29sdW1uSU8gaW8sIGJvb2xlYW4gc2V0KQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0byA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbUNv\nbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChzZXQgJiYg\nY2FuU2V0KGlvLCBpLCB0cnVlKSkKICAgICAgICAgICAgICAgICAgICBzZXRO\ndWxsKGZyb21Db2xzW2ldKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFz\nZXQpCiAgICAgICAgICAgICAgICAgICAgd2hlcmVOdWxsKGZyb21Db2xzW2ld\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIGlmIChzZXQgJiYgIWNhblNldEFueShpbywgZnJvbUNvbHMu\nbGVuZ3RoLCBmYWxzZSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nQ2xhc3NNYXBwaW5nIHRvTWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHRvLmdl\ndE1ldGFEYXRhKCk7CiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBP\nYmplY3QgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdG9Db2xz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGRvbid0IGV2ZW4gdHJh\nbnNsYXRlIGpvaW4gdmFsdWUgaWYgdW5zZXR0YWJsZQogICAgICAgICAgICBp\nZiAoc2V0KSB7CiAgICAgICAgICAgICAgICBpZiAoX2FjdGlvbiA9PSBBQ1RJ\nT05fSU5TRVJUICYmIGZyb21Db2xzW2ldLmlzQXV0b0Fzc2lnbmVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBp\nZiAoIWNhblNldChpbywgaSwgZmFsc2UpKQogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBqb2luID0g\ndG9NYXBwaW5nLmFzc2VydEpvaW5hYmxlKHRvQ29sc1tpXSk7CiAgICAgICAg\nICAgIHZhbCA9IGpvaW4uZ2V0Sm9pblZhbHVlKHRvLCB0b0NvbHNbaV0sIChK\nREJDU3RvcmUpIHRvLgogICAgICAgICAgICAgICAgZ2V0Q29udGV4dCgpLmdl\ndFN0b3JlTWFuYWdlcigpLmdldElubmVybW9zdERlbGVnYXRlKCkpOwogICAg\nICAgICAgICBpZiAoc2V0ICYmIHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAoY2FuU2V0KGlvLCBpLCB0cnVlKSkKICAgICAgICAgICAgICAg\nICAgICBzZXROdWxsKGZyb21Db2xzW2ldKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChzZXQgJiYgdmFsIGluc3RhbmNlb2YgUmF3KQogICAgICAgICAgICAg\nICAgc2V0UmF3KGZyb21Db2xzW2ldLCB2YWwudG9TdHJpbmcoKSk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHNldCkKICAgICAgICAgICAgICAgIHNldE9iamVj\ndChmcm9tQ29sc1tpXSwgdmFsLCB0b0NvbHNbaV0uZ2V0SmF2YVR5cGUoKSwg\nZmFsc2UpOwogICAgICAgICAgICBlbHNlIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHdoZXJlTnVsbChmcm9tQ29sc1tpXSk7CiAgICAgICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJhdykKICAgICAgICAgICAg\nICAgIHdoZXJlUmF3KGZyb21Db2xzW2ldLCB2YWwudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHdoZXJlT2JqZWN0KGZy\nb21Db2xzW2ldLCB2YWwsIHRvQ29sc1tpXS5nZXRKYXZhVHlwZSgpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBh\nbnkgb2YgdGhlIGdpdmVuIGNvbHVtbiBpbmRleGVzIGFyZSBzZXR0YWJsZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gY2FuU2V0QW55KENvbHVt\nbklPIGlvLCBpbnQgaSwgYm9vbGVhbiBudWxsVmFsdWUpIHsKICAgICAgICBp\nZiAoaW8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKF9hY3Rpb24gPT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAg\ncmV0dXJuIGlvLmlzQW55SW5zZXJ0YWJsZShpLCBudWxsVmFsdWUpOwogICAg\nICAgIGlmIChfYWN0aW9uID09IEFDVElPTl9VUERBVEUpCiAgICAgICAgICAg\nIHJldHVybiBpby5pc0FueVVwZGF0YWJsZShpLCBudWxsVmFsdWUpOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIGdpdmVuIGNvbHVtbiBpbmRleCBpcyBzZXR0YWJsZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gY2FuU2V0KENvbHVtbklP\nIGlvLCBpbnQgaSwgYm9vbGVhbiBudWxsVmFsdWUpIHsKICAgICAgICBpZiAo\naW8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\naWYgKF9hY3Rpb24gPT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgcmV0\ndXJuIGlvLmlzSW5zZXJ0YWJsZShpLCBudWxsVmFsdWUpOwogICAgICAgIGlm\nIChfYWN0aW9uID09IEFDVElPTl9VUERBVEUpCiAgICAgICAgICAgIHJldHVy\nbiBpby5pc1VwZGF0YWJsZShpLCBudWxsVmFsdWUpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlbGF0aW9uSWQo\nQ29sdW1uIGNvbCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBS\nZWxhdGlvbklkIHJlbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBzZXRPYmplY3QoY29sLCByZWwudG9SZWxhdGlvbkRhdGFTdG9y\nZVZhbHVlKHNtLCBjb2wpLAogICAgICAgICAgICBjb2wuZ2V0SmF2YVR5cGUo\nKSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYSBjaXJj\ndWxhciByZWxhdGlvbiBpZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xl\nYXJSZWxhdGlvbklkKENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgX3NxbCA9IG51bGw7CiAgICAgICAgX3ZhbHNb\nZ2V0U2V0SW5kZXgoY29sKV0gPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEFycmF5KENvbHVtbiBjb2wsIEFycmF5IHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCB2\nYWwsIEphdmFTUUxUeXBlcy5BUlJBWSwgZmFsc2UpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldEFzY2lpU3RyZWFtKENvbHVtbiBjb2wsIElucHV0U3Ry\nZWFtIHZhbCwgaW50IGxlbmd0aCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCAodmFsID09IG51bGwpID8g\nbnVsbCA6IG5ldyBTaXplZCh2YWwsIGxlbmd0aCksCiAgICAgICAgICAgIEph\ndmFTUUxUeXBlcy5BU0NJSV9TVFJFQU0sIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRCaWdEZWNpbWFsKENvbHVtbiBjb2wsIEJpZ0RlY2lt\nYWwgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLkJJR0RFQ0lNQUwsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdJbnRlZ2VyKENv\nbHVtbiBjb2wsIEJpZ0ludGVnZXIgdmFsKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVR5\ncGVzLkJJR0lOVEVHRVIsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRCaW5hcnlTdHJlYW0oQ29sdW1uIGNvbCwgSW5wdXRTdHJlYW0gdmFs\nLCBpbnQgbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldE9iamVjdChjb2wsICh2YWwgPT0gbnVsbCkgPyBudWxsIDog\nbmV3IFNpemVkKHZhbCwgbGVuZ3RoKSwKICAgICAgICAgICAgSmF2YVNRTFR5\ncGVzLkJJTkFSWV9TVFJFQU0sIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRCbG9iKENvbHVtbiBjb2wsIEJsb2IgdmFsKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZh\nbCwgSmF2YVNRTFR5cGVzLkJMT0IsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRCb29sZWFuKENvbHVtbiBjb2wsIGJvb2xlYW4gdmFsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVj\ndChjb2wsICgodmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0Up\nLAogICAgICAgICAgICBKYXZhVHlwZXMuQk9PTEVBTiwgZmFsc2UpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldEJ5dGUoQ29sdW1uIGNvbCwgYnl0ZSB2\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0\nT2JqZWN0KGNvbCwgbmV3IEJ5dGUodmFsKSwgSmF2YVR5cGVzLkJZVEUsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRCeXRlcyhDb2x1bW4g\nY29sLCBieXRlW10gdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLkJZ\nVEVTLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FsZW5k\nYXIoQ29sdW1uIGNvbCwgQ2FsZW5kYXIgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2\nYVR5cGVzLkNBTEVOREFSLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Q2hhcihDb2x1bW4gY29sLCBjaGFyIHZhbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBuZXcg\nQ2hhcmFjdGVyKHZhbCksIEphdmFUeXBlcy5DSEFSLCBmYWxzZSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKENvbHVtbiBj\nb2wsIFJlYWRlciB2YWwsIGludCBsZW5ndGgpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgKHZhbCA9PSBu\ndWxsKSA/IG51bGwgOiBuZXcgU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAg\nICAgICBKYXZhU1FMVHlwZXMuQ0hBUl9TVFJFQU0sIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRDbG9iKENvbHVtbiBjb2wsIENsb2IgdmFs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9i\namVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLkNMT0IsIGZhbHNlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREYXRlKENvbHVtbiBjb2wsIERhdGUg\ndmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndE9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLkRBVEUsIGZhbHNlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREYXRlKENvbHVtbiBjb2wsIGphdmEu\nc3FsLkRhdGUgdmFsLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICBpZiAo\ndmFsID09IG51bGwgfHwgY2FsID09IG51bGwpCiAgICAgICAgICAgIG9iaiA9\nIHZhbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG9iaiA9IG5ldyBDYWxl\nbmRhcmQodmFsLCBjYWwpOwogICAgICAgIHNldE9iamVjdChjb2wsIG9iaiwg\nSmF2YVNRTFR5cGVzLlNRTF9EQVRFLCBmYWxzZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0RG91YmxlKENvbHVtbiBjb2wsIGRvdWJsZSB2YWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0\nKGNvbCwgbmV3IERvdWJsZSh2YWwpLCBKYXZhVHlwZXMuRE9VQkxFLCBmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RmxvYXQoQ29sdW1uIGNv\nbCwgZmxvYXQgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldE9iamVjdChjb2wsIG5ldyBGbG9hdCh2YWwpLCBKYXZhVHlw\nZXMuRkxPQVQsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJ\nbnQoQ29sdW1uIGNvbCwgaW50IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBOdW1iZXJzLnZhbHVl\nT2YodmFsKSwgSmF2YVR5cGVzLklOVCwgZmFsc2UpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldExvbmcoQ29sdW1uIGNvbCwgbG9uZyB2YWwpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNv\nbCwgTnVtYmVycy52YWx1ZU9mKHZhbCksIEphdmFUeXBlcy5MT05HLCBmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TG9jYWxlKENvbHVtbiBj\nb2wsIExvY2FsZSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuTE9DQUxF\nLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TnVsbChDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHNldE51bGwoY29sLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0TnVsbChDb2x1bW4gY29sLCBib29sZWFuIG92ZXJyaWRlRGVmYXVsdCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmpl\nY3QoY29sLCBudWxsLCBjb2wuZ2V0SmF2YVR5cGUoKSwgb3ZlcnJpZGVEZWZh\ndWx0KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROdW1iZXIoQ29sdW1u\nIGNvbCwgTnVtYmVyIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzZXRPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5OVU1C\nRVIsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSYXcoQ29s\ndW1uIGNvbCwgU3RyaW5nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCB2YWwsIFJBVywgZmFsc2Up\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNob3J0KENvbHVtbiBjb2ws\nIHNob3J0IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBzZXRPYmplY3QoY29sLCBuZXcgU2hvcnQodmFsKSwgSmF2YVR5cGVz\nLlNIT1JULCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3Ry\naW5nKENvbHVtbiBjb2wsIFN0cmluZyB2YWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZh\nVHlwZXMuU1RSSU5HLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0VGltZShDb2x1bW4gY29sLCBUaW1lIHZhbCwgQ2FsZW5kYXIgY2FsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIE9iamVjdCBv\nYmo7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsIHx8IGNhbCA9PSBudWxsKQog\nICAgICAgICAgICBvYmogPSB2YWw7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBvYmogPSBuZXcgQ2FsZW5kYXJkKHZhbCwgY2FsKTsKICAgICAgICBzZXRP\nYmplY3QoY29sLCBvYmosIEphdmFTUUxUeXBlcy5USU1FLCBmYWxzZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1wKENvbHVtbiBjb2ws\nIFRpbWVzdGFtcCB2YWwsIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgIGlm\nICh2YWwgPT0gbnVsbCB8fCBjYWwgPT0gbnVsbCkKICAgICAgICAgICAgb2Jq\nID0gdmFsOwogICAgICAgIGVsc2UKICAgICAgICAgICAgb2JqID0gbmV3IENh\nbGVuZGFyZCh2YWwsIGNhbCk7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgb2Jq\nLCBKYXZhU1FMVHlwZXMuVElNRVNUQU1QLCBmYWxzZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0T2JqZWN0KENvbHVtbiBjb2wsIE9iamVjdCB2YWwp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHZh\nbCBpbnN0YW5jZW9mIFJhdykKICAgICAgICAgICAgc2V0T2JqZWN0KGNvbCwg\ndmFsLCBSQVcsIGZhbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNl\ndE9iamVjdChjb2wsIHZhbCwgY29sLmdldEphdmFUeXBlKCksIGZhbHNlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUFycmF5KENvbHVtbiBjb2ws\nIEFycmF5IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLlNRTF9B\nUlJBWSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVBc2NpaVN0cmVh\nbShDb2x1bW4gY29sLCBJbnB1dFN0cmVhbSB2YWwsIGludCBsZW5ndGgpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hlcmVPYmpl\nY3QoY29sLCAodmFsID09IG51bGwpID8gbnVsbCA6IG5ldyBTaXplZCh2YWws\nIGxlbmd0aCksCiAgICAgICAgICAgIEphdmFTUUxUeXBlcy5BU0NJSV9TVFJF\nQU0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQmlnRGVjaW1hbChD\nb2x1bW4gY29sLCBCaWdEZWNpbWFsIHZhbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2\nYVR5cGVzLkJJR0RFQ0lNQUwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdo\nZXJlQmlnSW50ZWdlcihDb2x1bW4gY29sLCBCaWdJbnRlZ2VyIHZhbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVj\ndChjb2wsIHZhbCwgSmF2YVR5cGVzLkJJR0lOVEVHRVIpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlQmluYXJ5U3RyZWFtKENvbHVtbiBjb2wsIElu\ncHV0U3RyZWFtIHZhbCwgaW50IGxlbmd0aCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsICh2YWwgPT0g\nbnVsbCkgPyBudWxsIDogbmV3IFNpemVkKHZhbCwgbGVuZ3RoKSwKICAgICAg\nICAgICAgSmF2YVNRTFR5cGVzLkJJTkFSWV9TVFJFQU0pOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlQmxvYihDb2x1bW4gY29sLCBCbG9iIHZhbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9i\namVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLkJMT0IpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlQm9vbGVhbihDb2x1bW4gY29sLCBib29sZWFu\nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3\naGVyZU9iamVjdChjb2wsICgodmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xl\nYW4uRkFMU0UpLAogICAgICAgICAgICBKYXZhVHlwZXMuQk9PTEVBTik7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVCeXRlKENvbHVtbiBjb2wsIGJ5\ndGUgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHdoZXJlT2JqZWN0KGNvbCwgbmV3IEJ5dGUodmFsKSwgSmF2YVR5cGVzLkJZ\nVEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQnl0ZXMoQ29sdW1u\nIGNvbCwgYnl0ZVtdIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVz\nLkJZVEVTKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUNhbGVuZGFy\nKENvbHVtbiBjb2wsIENhbGVuZGFyIHZhbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2\nYVR5cGVzLkNBTEVOREFSKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVy\nZUNoYXIoQ29sdW1uIGNvbCwgY2hhciB2YWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCBuZXcgQ2hh\ncmFjdGVyKHZhbCksIEphdmFUeXBlcy5DSEFSKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB3aGVyZUNoYXJhY3RlclN0cmVhbShDb2x1bW4gY29sLCBSZWFk\nZXIgdmFsLCBpbnQgbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgKHZhbCA9PSBudWxsKSA/\nIG51bGwgOiBuZXcgU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAgICBK\nYXZhU1FMVHlwZXMuQ0hBUl9TVFJFQU0pOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHdoZXJlQ2xvYihDb2x1bW4gY29sLCBDbG9iIHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2ws\nIHZhbCwgSmF2YVNRTFR5cGVzLkNMT0IpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHdoZXJlRGF0ZShDb2x1bW4gY29sLCBEYXRlIHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2ws\nIHZhbCwgSmF2YVR5cGVzLkRBVEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlRGF0ZShDb2x1bW4gY29sLCBqYXZhLnNxbC5EYXRlIHZhbCwgQ2Fs\nZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIE9iamVjdCBvYmo7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsIHx8IGNh\nbCA9PSBudWxsKQogICAgICAgICAgICBvYmogPSB2YWw7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBvYmogPSBuZXcgQ2FsZW5kYXJkKHZhbCwgY2FsKTsK\nICAgICAgICB3aGVyZU9iamVjdChjb2wsIG9iaiwgSmF2YVNRTFR5cGVzLlNR\nTF9EQVRFKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZURvdWJsZShD\nb2x1bW4gY29sLCBkb3VibGUgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgbmV3IERvdWJsZSh2\nYWwpLCBKYXZhVHlwZXMuRE9VQkxFKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB3aGVyZUZsb2F0KENvbHVtbiBjb2wsIGZsb2F0IHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2ws\nIG5ldyBGbG9hdCh2YWwpLCBKYXZhVHlwZXMuRkxPQVQpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlSW50KENvbHVtbiBjb2wsIGludCB2YWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hlcmVPYmpl\nY3QoY29sLCBOdW1iZXJzLnZhbHVlT2YodmFsKSwgSmF2YVR5cGVzLklOVCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVMb25nKENvbHVtbiBjb2ws\nIGxvbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgTnVtYmVycy52YWx1ZU9mKHZhbCksIEph\ndmFUeXBlcy5MT05HKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUxv\nY2FsZShDb2x1bW4gY29sLCBMb2NhbGUgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBK\nYXZhVHlwZXMuTE9DQUxFKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVy\nZU51bGwoQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIG51bGwsIGNvbC5nZXRKYXZh\nVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZU51bWJlcihD\nb2x1bW4gY29sLCBOdW1iZXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlw\nZXMuTlVNQkVSKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVJhdyhD\nb2x1bW4gY29sLCBTdHJpbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBSQVcpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlU2hvcnQoQ29sdW1uIGNvbCwg\nc2hvcnQgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgbmV3IFNob3J0KHZhbCksIEphdmFUeXBl\ncy5TSE9SVCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVTdHJpbmco\nQ29sdW1uIGNvbCwgU3RyaW5nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVR5\ncGVzLlNUUklORyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVUaW1l\nKENvbHVtbiBjb2wsIFRpbWUgdmFsLCBDYWxlbmRhciBjYWwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG9iajsKICAg\nICAgICBpZiAodmFsID09IG51bGwgfHwgY2FsID09IG51bGwpCiAgICAgICAg\nICAgIG9iaiA9IHZhbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG9iaiA9\nIG5ldyBDYWxlbmRhcmQodmFsLCBjYWwpOwogICAgICAgIHdoZXJlT2JqZWN0\nKGNvbCwgb2JqLCBKYXZhU1FMVHlwZXMuVElNRSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVUaW1lc3RhbXAoQ29sdW1uIGNvbCwgVGltZXN0YW1w\nIHZhbCwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsIHx8IGNhbCA9PSBudWxsKQogICAgICAgICAgICBvYmogPSB2YWw7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBvYmogPSBuZXcgQ2FsZW5kYXJkKHZh\nbCwgY2FsKTsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIG9iaiwgSmF2YVNR\nTFR5cGVzLlRJTUVTVEFNUCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmVPYmplY3QoQ29sdW1uIGNvbCwgT2JqZWN0IHZhbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsIGluc3RhbmNlb2Yg\nUmF3KQogICAgICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgUkFXKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFs\nLCBjb2wuZ2V0SmF2YVR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbGwgc2V0IGNvbHVtbiBtZXRob2RzIGRlbGVnYXRlIHRvIHRoaXMgb25lLiBT\nZXQgdGhlIGdpdmVuIG9iamVjdAogICAgICogdW5sZXNzIHRoaXMgaXMgYW4g\naW5zZXJ0IGFuZCB0aGUgZ2l2ZW4gY29sdW1uIGlzIGF1dG8tYXNzaWduZWQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldE9iamVjdChDb2x1bW4g\nY29sLCBPYmplY3QgdmFsLCBpbnQgbWV0YVR5cGUsCiAgICAgICAgYm9vbGVh\nbiBvdmVycmlkZURlZmF1bHQpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gbmV2ZXIgc2V0IGF1dG8gaW5jcmVtZW50IGNvbHVt\nbnMgYW5kIGhvbm9yIGNvbHVtbiBkZWZhdWx0cwogICAgICAgIGlmIChfYWN0\naW9uID09IEFDVElPTl9JTlNFUlQpIHsKICAgICAgICAgICAgaWYgKGNvbC5p\nc0F1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICBpZiAoIW92ZXJyaWRlRGVmYXVsdCAmJiB2YWwgPT0gbnVsbCAK\nICAgICAgICAgICAgICAgICYmIGNvbC5nZXREZWZhdWx0U3RyaW5nKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAg\nICAgaWYgKHZhbCA9PSBudWxsICYmIGNvbC5pc05vdE51bGwoKSkKICAgICAg\nICAgICAgdmFsID0gSmF2YVNRTFR5cGVzLmdldEVtcHR5VmFsdWUoY29sLmdl\ndEphdmFUeXBlKCkpOwogICAgICAgIGZsdXNoKGNvbCwgdmFsLCBtZXRhVHlw\nZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGwgd2hlcmUgY29s\ndW1uIG1ldGhvZHMgZGVsZWdhdGUgdG8gdGhpcyBvbmUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHdoZXJlT2JqZWN0KENvbHVtbiBjb2wsIE9iamVj\ndCB2YWwsIGludCBtZXRhVHlwZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBmbHVzaChjb2wsIHZhbCwgbWV0YVR5cGUsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHNldCBvciB3aGVyZSBjb25kaXRpb24uCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBmbHVzaChDb2x1bW4gY29sLCBPYmplY3QgdmFsLCBpbnQg\nbWV0YVR5cGUsIGJvb2xlYW4gc2V0KSB7CiAgICAgICAgaW50IGlkeCA9IChz\nZXQpID8gZ2V0U2V0SW5kZXgoY29sKSA6IGdldFdoZXJlSW5kZXgoY29sKTsK\nICAgICAgICBfdHlwZXNbaWR4XSA9IG1ldGFUeXBlOwogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgX3ZhbHNbaWR4XSA9IE5VTEw7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfdmFsc1tpZHhdID0gdmFsOwogICAg\nICAgIGlmIChzZXQgfHwgX2FjdGlvbiA9PSBBQ1RJT05fREVMRVRFKQogICAg\nICAgICAgICBzZXRWYWxpZCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgU1FMIGZvciB0aGUgb3BlcmF0aW9uIG9uIHRoaXMgcm93\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNRTChEQkRpY3Rpb25h\ncnkgZGljdCkgewogICAgICAgIGlmICghaXNWYWxpZCgpKQogICAgICAgICAg\nICByZXR1cm4gIiI7CiAgICAgICAgaWYgKF9zcWwgPT0gbnVsbCkKICAgICAg\nICAgICAgX3NxbCA9IGdlbmVyYXRlU1FMKGRpY3QpOwogICAgICAgIHJldHVy\nbiBfc3FsOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIFNR\nTCBmb3IgdGhpcyByb3c7IHRoZSByZXN1bHQgb2YgdGhpcyBtZXRob2QgaXMg\nY2FjaGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdlbmVyYXRl\nU1FMKERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAgICAgc3dpdGNoIChnZXRB\nY3Rpb24oKSkgewogICAgICAgICAgICBjYXNlIEFDVElPTl9VUERBVEU6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0VXBkYXRlU1FMKGRpY3QpOwogICAg\nICAgICAgICBjYXNlIEFDVElPTl9JTlNFUlQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0SW5zZXJ0U1FMKGRpY3QpOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldERlbGV0ZVNRTChkaWN0KTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNR\nTCBmb3IgYSBwcmVwYXJlZCBzdGF0ZW1lbnQgdXBkYXRlIG9uIHRoaXMgcm93\nLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRVcGRhdGVTUUwoREJE\naWN0aW9uYXJ5IGRpY3QpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlVQREFU\nRSAiKS5hcHBlbmQoZGljdC5nZXRGdWxsTmFtZShnZXRUYWJsZSgpLCBmYWxz\nZSkpLgogICAgICAgICAgICBhcHBlbmQoIiBTRVQgIik7CgogICAgICAgIGJv\nb2xlYW4gaGFzVmFsID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoX3Zh\nbHNbaV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgaWYgKGhhc1ZhbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiwgIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2NvbHNbaV0pOwog\nICAgICAgICAgICBpZiAoX3R5cGVzW2ldID09IFJBVykKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiA9ICIpLmFwcGVuZChfdmFsc1tpXSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ID8i\nKTsKICAgICAgICAgICAgaGFzVmFsID0gdHJ1ZTsKICAgICAgICB9CgogICAg\nICAgIGFwcGVuZFdoZXJlKGJ1Zik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBTUUwg\nZm9yIGEgcHJlcGFyZWQgc3RhdGVtZW50IGluc2VydCBvbiB0aGlzIHJvdy4K\nICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0SW5zZXJ0U1FMKERCRGlj\ndGlvbmFyeSBkaWN0KSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBTdHJpbmdCdWZmZXIgdmFscyA9\nIG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJJTlNF\nUlQgSU5UTyAiKS4KICAgICAgICAgICAgYXBwZW5kKGRpY3QuZ2V0RnVsbE5h\nbWUoZ2V0VGFibGUoKSwgZmFsc2UpKS5hcHBlbmQoIiAoIik7CgogICAgICAg\nIGJvb2xlYW4gaGFzVmFsID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBfY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nX3ZhbHNbaV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgaWYgKGhhc1ZhbCkgewogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgICAgIHZhbHMuYXBwZW5kKCIs\nICIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2Nv\nbHNbaV0pOwogICAgICAgICAgICBpZiAoX3R5cGVzW2ldID09IFJBVykKICAg\nICAgICAgICAgICAgIHZhbHMuYXBwZW5kKF92YWxzW2ldKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgdmFscy5hcHBlbmQoIj8iKTsKICAg\nICAgICAgICAgaGFzVmFsID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJ1\nZi5hcHBlbmQoIikgVkFMVUVTICgiKS5hcHBlbmQodmFscy50b1N0cmluZygp\nKS5hcHBlbmQoIikiKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgYSBw\ncmVwYXJlZCBzdGF0ZW1lbnQgZGVsZXRlIG9uIHRoaXMgcm93LgogICAgICov\nCiAgICBwcml2YXRlIFN0cmluZyBnZXREZWxldGVTUUwoREJEaWN0aW9uYXJ5\nIGRpY3QpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkRFTEVURSBGUk9NICIp\nLgogICAgICAgICAgICBhcHBlbmQoZGljdC5nZXRGdWxsTmFtZShnZXRUYWJs\nZSgpLCBmYWxzZSkpOwogICAgICAgIGFwcGVuZFdoZXJlKGJ1Zik7CiAgICAg\nICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXBwZW5kcyB0aGUgd2hlcmUgY2xhdXNlIG9udG8gdGhlIGdpdmVuIHNx\nbCBidWZmZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRXaGVy\nZShTdHJpbmdCdWZmZXIgYnVmKSB7CiAgICAgICAgYm9vbGVhbiBoYXNXaGVy\nZSA9IGZhbHNlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2NvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKF92YWxzW2dldFdoZXJl\nSW5kZXgoX2NvbHNbaV0pXSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICBpZiAoIWhhc1doZXJlKQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIFdIRVJFICIpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwoKICAgICAg\nICAgICAgLy8gc3Fsc2VydmVyIHNlZW1zIHRvIGhhdmUgcHJvYmxlbXMgdXNp\nbmcgbnVsbCBwYXJhbWV0ZXJzIGluIHRoZQogICAgICAgICAgICAvLyB3aGVy\nZSBjbGF1c2UKICAgICAgICAgICAgaWYgKF92YWxzW2dldFdoZXJlSW5kZXgo\nX2NvbHNbaV0pXSA9PSBOVUxMKQogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZChfY29sc1tpXSkuYXBwZW5kKCIgSVMgTlVMTCIpOwogICAgICAgICAgICBl\nbHNlIGlmIChfdHlwZXNbaV0gPT0gUkFXKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChfY29sc1tpXSkuYXBwZW5kKCIgPSAiKS5hcHBlbmQoX3ZhbHNb\naV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKF9jb2xzW2ldKS5hcHBlbmQoIiA9ID8iKTsKICAgICAgICAgICAgaGFz\nV2hlcmUgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBudW1iZXIgb2YgcGFyYW1ldGVycyB0aGF0IHdpbGwgYmUgc2V0IGZv\nciB0aGlzIHJvdy4KICAgICAqLwogICAgcHVibGljIGludCBnZXRQYXJhbWV0\nZXJDb3VudCgpIHsKICAgICAgICByZXR1cm4gX3ZhbHMubGVuZ3RoOwogICAg\nfQoKICAgIC8qKgogICAgICogRmx1c2ggdGhlIHJvdydzIHZhbHVlcyB0byB0\naGUgZ2l2ZW4gcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBmbHVzaChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgREJEaWN0\naW9uYXJ5IGRpY3QsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGZsdXNoKHN0bW50LCAx\nLCBkaWN0LCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCB0\naGUgcm93J3MgdmFsdWVzIHRvIHRoZSBnaXZlbiBwcmVwYXJlZCBzdGF0ZW1l\nbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGZsdXNoKFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBEQkRpY3Rpb25hcnkgZGljdCwKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CgogICAgICAgIC8vIHRoaXMgc2ltcGxlIG1ldGhvZCB3b3JrcyBi\nZWNhdXNlIHRoZSBTUUwgaXMgYWx3YXlzIHByZXBhcmVkCiAgICAgICAgLy8g\nYmFzZWQgb24gdGhlIGluZGV4aW5nIG9mIHRoZSBjb2x1bW5zIGluIHRoZSB0\nYWJsZSBvYmplY3QgLS0gdGhlCiAgICAgICAgLy8gc2FtZSBvcmRlcmluZyB3\nZSB1c2Ugd2hlbiBzdG9yaW5nIHZhbHVlcyBhbmQgbWV0YSB0eXBlcy4gc2tp\ncAogICAgICAgIC8vIHVwZGF0ZXMgd2hlbiBzZXR0aW5nIHBhcmFtcyBmb3Ig\nREVMRVRFczsgdGhlIHVwZGF0ZXMgYXJlIGp1c3QgdGhlcmUKICAgICAgICAv\nLyB0byBsZXQgdXMgZXZhbCBmayBjb25zdHJhaW50cwogICAgICAgIGludCBp\nID0gKGdldEFjdGlvbigpID09IEFDVElPTl9ERUxFVEUpID8gX2NvbHMubGVu\nZ3RoOiAwOwogICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgT2JqZWN0IHZh\nbDsKICAgICAgICBpbnQgaGFsZiA9IF92YWxzLmxlbmd0aCAvIDI7CiAgICAg\nICAgZm9yICg7IGkgPCBfdmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoX3ZhbHNbaV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgLy8gd2UgZG9uJ3Qgc2V0IG51bGwgcGFyYW1z\nIGluIHRoZSBXSEVSRSBjbGF1c2U7IHdlIHVzZSB0aGUgTlVMTAogICAgICAg\nICAgICAvLyBrZXl3b3JkIGluc3RlYWQgdG8gc2F0aXNmeSBzcWxzZXJ2ZXIK\nICAgICAgICAgICAgaWYgKF92YWxzW2ldID09IE5VTEwgJiYgZ2V0QWN0aW9u\nKCkgIT0gQUNUSU9OX0lOU0VSVCAmJiBpID49IGhhbGYpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYW4g\ndXBkYXRlIHRoZSB2YWxzIGFycmF5IHdpbGwgYmUgMiB4IHRoZSBjb2xzCiAg\nICAgICAgICAgIC8vIGFycmF5IGxlbmd0aDsgaXQgcmVwZWF0cyBmb3Igd2hl\ncmUgdmFsdWVzCiAgICAgICAgICAgIGlmIChpIDwgX2NvbHMubGVuZ3RoKQog\nICAgICAgICAgICAgICAgY29sID0gX2NvbHNbaV07CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGNvbCA9IF9jb2xzW2kgLSBfY29scy5sZW5n\ndGhdOwoKICAgICAgICAgICAgdmFsID0gX3ZhbHNbaV07CiAgICAgICAgICAg\nIGlmICh2YWwgPT0gTlVMTCkKICAgICAgICAgICAgICAgIHZhbCA9IG51bGw7\nCgogICAgICAgICAgICBpZiAodmFsID09IG51bGwgfHwgX3R5cGVzW2ldICE9\nIFJBVykgewogICAgICAgICAgICAgICAgZGljdC5zZXRUeXBlZChzdG1udCwg\naWR4LCB2YWwsIGNvbCwgX3R5cGVzW2ldLCBzdG9yZSk7CiAgICAgICAgICAg\nICAgICBpZHgrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBhcnJheSB2YWx1ZSBhcnJheSBpbmRleCBmb3Ig\ndGhlIGdpdmVuIGNvbHVtbidzIHZhbHVlLgogICAgICovCiAgICBwcml2YXRl\nIGludCBnZXRTZXRJbmRleChDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJu\nIGNvbC5nZXRJbmRleCgpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFy\ncmF5IHZhbHVlIGFycmF5IGluZGV4IGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3Mg\ndmFsdWUuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldFdoZXJlSW5kZXgo\nQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBjb2wuZ2V0SW5kZXgoKSAr\nIF9jb2xzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm1z\nIGEgcHJvcGVyIGRlZXAgY2xvbmUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmpl\nY3QgY2xvbmUoKSB7CiAgICAgICAgUm93SW1wbCBjbG9uZSA9IG5ld0luc3Rh\nbmNlKGdldENvbHVtbnMoKSwgZ2V0QWN0aW9uKCkpOwogICAgICAgIGNvcHlJ\nbnRvKGNsb25lLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIGNsb25lOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IHJvdy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFJvd0ltcGwgbmV3SW5zdGFuY2UoQ29sdW1uW10gY29s\ncywgaW50IGFjdGlvbikgewogICAgICAgIHJldHVybiBuZXcgUm93SW1wbChj\nb2xzLCBhY3Rpb24pOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBhbGwg\ndmFsdWVzIGZyb20gdGhpcyByb3cgaW50byB0aGUgZ2l2ZW4gb25lLgogICAg\nICoKICAgICAqIEBwYXJhbSB3aGVyZU9ubHkgaWYgdHJ1ZSwgb25seSBjb3B5\nIHdoZXJlIGNvbmRpdGlvbnMKICAgICAqLwogICAgcHVibGljIHZvaWQgY29w\neUludG8oUm93SW1wbCByb3csIGJvb2xlYW4gd2hlcmVPbmx5KSB7CiAgICAg\nICAgaW50IGFjdGlvbiA9IGdldEFjdGlvbigpOwogICAgICAgIGludCByb3dB\nY3Rpb24gPSByb3cuZ2V0QWN0aW9uKCk7CgogICAgICAgIGludCBzdGFydDsK\nICAgICAgICBpbnQgbGVuOwogICAgICAgIGlmICh3aGVyZU9ubHkpIHsKICAg\nICAgICAgICAgaWYgKGFjdGlvbiA9PSBBQ1RJT05fSU5TRVJUIHx8IHJvd0Fj\ndGlvbiA9PSBBQ1RJT05fSU5TRVJUKQogICAgICAgICAgICAgICAgc3RhcnQg\nPSBsZW4gPSAwOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\ndGFydCA9IGxlbiA9IF92YWxzLmxlbmd0aCAvIDI7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgc3RhcnQgPSAwOwogICAgICAgICAgICBpZiAocm93\nQWN0aW9uID09IEFDVElPTl9JTlNFUlQgJiYgYWN0aW9uICE9IEFDVElPTl9J\nTlNFUlQpCiAgICAgICAgICAgICAgICBsZW4gPSBfdmFscy5sZW5ndGggLyAy\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsZW4gPSBfdmFs\ncy5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKF92YWxzLCBzdGFydCwgcm93Ll92YWxzLCBzdGFydCwgbGVuKTsKICAgICAg\nICBTeXN0ZW0uYXJyYXljb3B5KF90eXBlcywgc3RhcnQsIHJvdy5fdHlwZXMs\nIHN0YXJ0LCBsZW4pOwogICAgICAgIGlmIChpc1ZhbGlkKCkpCiAgICAgICAg\nICAgIHJvdy5zZXRWYWxpZCh0cnVlKTsKICAgIH0KfQo=\n","encoding":"base64"}

