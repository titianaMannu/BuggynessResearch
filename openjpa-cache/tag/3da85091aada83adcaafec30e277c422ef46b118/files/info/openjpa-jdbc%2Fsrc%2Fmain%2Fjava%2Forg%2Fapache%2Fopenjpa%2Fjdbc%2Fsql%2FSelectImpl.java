{"sha":"0c26abaaf2149bf3a562e983089ff280b46d64b2","node_id":"MDQ6QmxvYjIwNjM2NDowYzI2YWJhYWYyMTQ5YmYzYTU2MmU5ODMwODlmZjI4MGI0NmQ2NGIy","size":91935,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0c26abaaf2149bf3a562e983089ff280b46d64b2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGls\nLlRyZWVNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLml0ZXJhdG9ycy5FbXB0eUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hNb2Rl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNMb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5BcHBsaWNhdGlvbklkczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8q\nKgogKiBTdGFuZGFyZCB7QGxpbmsgU2VsZWN0fSBpbXBsZW1lbnRhdGlvbi4g\nVXNhZ2Ugbm90ZTogdGhvdWdoIHRoaXMgY2xhc3MKICogaW1wbGVtZW50cyB7\nQGxpbmsgSm9pbnN9LCBpdCBzaG91bGQgbm90IGJlIHVzZWQgZm9yIGpvaW5p\nbmcgZGlyZWN0bHkuCiAqIEluc3RlYWQsIHVzZSB0aGUgcmV0dXJuIHZhbHVl\nIG9mIHtAbGluayAjbmV3Sm9pbnN9LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgU2VsZWN0SW1wbAog\nICAgaW1wbGVtZW50cyBTZWxlY3QsIFBhdGhKb2lucyB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IE5PTkFVVE9fRElTVElOQ1QgPSAyIDw8IDA7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRElTVElOQ1QgPSAyIDw8\nIDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTk9UX0RJU1RJTkNU\nID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IElNUExJ\nQ0lUX0RJU1RJTkNUID0gMiA8PCAzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IFRPX01BTlkgPSAyIDw8IDQ7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgQUdHUkVHQVRFID0gMiA8PCA1OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IExPQiA9IDIgPDwgNjsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBPVVRFUiA9IDIgPDwgNzsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBMUlMgPSAyIDw8IDg7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRUFHRVJfVE9fT05FID0gMiA8PCA5OwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX01BTlkgPSAyIDw8IDEwOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFJFQ09SRF9PUkRFUkVEID0gMiA8\nPCAxMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBHUk9VUElORyA9\nIDIgPDwgMTI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRk9SQ0Vf\nQ09VTlQgPSAyIDw8IDEzOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0\ncmluZ1tdIFRBQkxFX0FMSUFTRVMgPSBuZXcgU3RyaW5nWzE2XTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZ1tdIE9SREVSX0FMSUFTRVMgPSBu\nZXcgU3RyaW5nWzE2XTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVj\ndFtdIE5VTExfSURTID0gbmV3IE9iamVjdFsxNl07CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBPYmplY3RbXSBQTEFDRUhPTERFUlMgPSBuZXcgT2JqZWN0\nWzUwXTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKFNlbGVjdC5jbGFzcyk7CgogICAg\nc3RhdGljIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IFRBQkxFX0FM\nSUFTRVMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIFRBQkxFX0FMSUFTRVNb\naV0gPSAidCIgKyBpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgT1JE\nRVJfQUxJQVNFUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgT1JERVJfQUxJ\nQVNFU1tpXSA9ICJvIiArIGk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBOVUxMX0lEUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgTlVMTF9JRFNb\naV0gPSBuZXcgTnVsbElkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBQTEFDRUhPTERFUlMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIFBMQUNF\nSE9MREVSU1tpXSA9IG5ldyBQbGFjZWhvbGRlcigpOwogICAgfQoKICAgIHBy\naXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBwcml2\nYXRlIGZpbmFsIERCRGljdGlvbmFyeSBfZGljdDsKCiAgICAvLyBtYXAgb2Yg\ndmFyaWFibGUgKyByZWxhdGlvbiBwYXRoICsgdGFibGUga2V5cyB0byB0aGUg\nY29ycmVjdCBhbGlhcyBpbmRleDoKICAgIC8vIGVhY2ggcmVsYXRpb24gcGF0\naC90YWJsZSBjb21iaW5hdGlvbiBzaG91bGQgaGF2ZSBhIHVuaXF1ZSBhbGlh\ncyBiZWNhdXNlCiAgICAvLyBpdCByZXByZXNlbnRzIGEgc2VwYXJhdGUgb2Jq\nZWN0OyBmb3IgZXhhbXBsZSwgaWYgYSBQZXJzb24gY2xhc3MgaGFzIGEKICAg\nIC8vICdwYXJlbnQnIGZpZWxkIHJlcHJlc2VudGluZyBhbm90aGVyIFBlcnNv\nbiBhbmQgYWxzbyBoYXMgYW4gJ2FkZHJlc3MnCiAgICAvLyBmaWVsZCBvZiB0\neXBlIEFkZHJlc3M6CiAgICAvLyAnYWRkcmVzcy5zdHJlZXQnIHNob3VsZCBt\nYXAgdG8gYSBkaWZmZXJlbnQgdGFibGUgYWxpYXMgdGhhbgogICAgLy8gJ3Bh\ncmVudC5hZGRyZXNzLnN0cmVldCcgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21w\nYXJpc29ucwogICAgcHJpdmF0ZSBNYXAgX2FsaWFzZXMgPSBudWxsOwoKICAg\nIC8vIG1hcCBvZiBpbmRleGVzIHRvIHRhYmxlIGFsaWFzZXMgbGlrZSAnVEFC\nTEVOQU1FIHQwJwogICAgcHJpdmF0ZSBTb3J0ZWRNYXAgX3RhYmxlcyA9IG51\nbGw7CgogICAgLy8gY29tYmluZWQgbGlzdCBvZiBzZWxlY3RlZCBpZHMgYW5k\nIG1hcCBvZiBlYWNoIGlkIHRvIGl0cyBhbGlhcwogICAgcHJpdmF0ZSBmaW5h\nbCBTZWxlY3RzIF9zZWxlY3RzID0gbmV3IFNlbGVjdHMoKTsKICAgIHByaXZh\ndGUgTGlzdCBfb3JkZXJlZCA9IG51bGw7CgogICAgLy8gZmxhZ3MKICAgIHBy\naXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2YXRlIGludCBfam9pblN5\nbnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0YXJ0SWR4ID0gMDsKICAg\nIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5NQVhfVkFMVUU7CiAgICBw\ncml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBwcml2YXRlIGludCBfb3Jk\nZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFjZWhvbGRlcnMgPSAwOwog\nICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0Q291bnQgPSAwOwoKICAg\nIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9vcmRl\ncmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1ZmZlciBfd2hlcmUgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dyb3VwaW5nID0gbnVsbDsK\nICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcgPSBudWxsOwoKICAgIC8v\nIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91ciB3aGVyZSBjbGF1c2Us\nIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAvLyBhbGwgc2VsZWN0cyAo\nc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhvZCkKICAgIHByaXZhdGUg\nU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAgIHByaXZhdGUgU3RhY2sg\nX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAgb2Ygam9pbnMra2V5cyB0\nbyBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0IG9mIGVhZ2VyIGtleXM7\nIHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUgdXNlZCBtb3JlIHRoYW4g\nb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0gbnVsbDsKICAgIHByaXZh\ndGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAgIC8vIHN1YnNlbGVjdCBz\ndXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNlbHMgPSBudWxsOwogICAg\ncHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAgIC8vIGZyb20gc2VsZWN0\nIGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBhIHRtcCB0YWJsZSBjcmVh\ndGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2VsZWN0SW1wbCBfZnJvbSA9\nIG51bGw7CiAgICBwcml2YXRlIFNlbGVjdEltcGwgX291dGVyID0gbnVsbDsK\nICAgICAKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4g\ndGhlIHByb3BlciB0YWJsZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGFsaWFzIGlu\nZGV4LgogICAgICovCiAgICBzdGF0aWMgU3RyaW5nIHRvQWxpYXMoaW50IGlu\nZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBUQUJMRV9BTElBU0VT\nLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIFRBQkxFX0FMSUFTRVNbaW5k\nZXhdOwogICAgICAgIHJldHVybiAidCIgKyBpbmRleDsKICAgIH0KCiAgICAv\nKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIg\nb3JkZXIgYWxpYXMgZm9yIHRoZSBnaXZlbiBvcmRlcgogICAgICogY29sdW1u\nIGluZGV4LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b09y\nZGVyQWxpYXMoaW50IGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0x\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXgg\nPCBPUkRFUl9BTElBU0VTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIE9S\nREVSX0FMSUFTRVNbaW5kZXhdOwogICAgICAgIHJldHVybiAibyIgKyBpbmRl\neDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkg\nY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNlbGVjdEltcGwo\nSkRCQ0NvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29u\nZjsKICAgICAgICBfZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3Rh\nbmNlKCk7CiAgICAgICAgX2pvaW5TeW50YXggPSBfZGljdC5qb2luU3ludGF4\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1wbGVtZW50YXRpb24KICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBK\nREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRv\nU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0LnRvU2VsZWN0KHRo\naXMsIGZvclVwZGF0ZSwgZmV0Y2gpOwogICAgfQoKICAgIHB1YmxpYyBTUUxC\ndWZmZXIgdG9TZWxlY3RDb3VudCgpIHsKICAgICAgICByZXR1cm4gX2RpY3Qu\ndG9TZWxlY3RDb3VudCh0aGlzKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRBdXRvRGlzdGluY3QoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3Mg\nJiBOT05BVVRPX0RJU1RJTkNUKSA9PSAwOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEF1dG9EaXN0aW5jdChib29sZWFuIHZhbCkgewogICAgICAgIGlm\nICh2YWwpCiAgICAgICAgICAgIF9mbGFncyAmPSB+Tk9OQVVUT19ESVNUSU5D\nVDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyB8PSBOT05BVVRP\nX0RJU1RJTkNUOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlzdGlu\nY3QoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBOT1RfRElTVElOQ1Qp\nID09IDAgJiYgKChfZmxhZ3MgJiBESVNUSU5DVCkgIT0gMAogICAgICAgICAg\nICB8fCAoKF9mbGFncyAmIE5PTkFVVE9fRElTVElOQ1QpID09IDAKICAgICAg\nICAgICAgJiYgKF9mbGFncyAmIElNUExJQ0lUX0RJU1RJTkNUKSAhPSAwKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGlzdGluY3QoYm9vbGVhbiBk\naXN0aW5jdCkgewogICAgICAgIC8vIG5lZWQgdHdvIGZsYWdzIGluIGNhc2Ug\nc2V0IG5vdF9kaXN0aW5jdCwgdGhlbiBhIHRvLW1hbnkgam9pbiBoYXBwZW5z\nCiAgICAgICAgLy8gYW5kIGRpc3RpbmN0IGZsYWcgZ2V0cyBzZXQgYXV0b21h\ndGljYWxseQogICAgICAgIGlmIChkaXN0aW5jdCkgewogICAgICAgICAgICBf\nZmxhZ3MgfD0gRElTVElOQ1Q7CiAgICAgICAgICAgIF9mbGFncyAmPSB+Tk9U\nX0RJU1RJTkNUOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9mbGFn\ncyB8PSBOT1RfRElTVElOQ1Q7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RElT\nVElOQ1Q7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nTFJTKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgTFJTKSAhPSAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExSUyhib29sZWFuIGxycykgewog\nICAgICAgIGlmIChscnMpCiAgICAgICAgICAgIF9mbGFncyB8PSBMUlM7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfZmxhZ3MgJj0gfkxSUzsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldEV4cGVjdGVkUmVzdWx0Q291bnQoKSB7CiAg\nICAgICAgLy8gaWYgdGhlIGNvdW50IGlzbid0IGZvcmNlZCBhbmQgd2UgaGF2\nZSB0by1tYW55IGVhZ2VyIGpvaW5zIHRoYXQgY291bGQKICAgICAgICAvLyB0\naHJvdyB0aGUgY291bnQgb2ZmLCBkb24ndCBwYXkgYXR0ZW50aW9uIHRvIGl0\nCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGT1JDRV9DT1VOVCkgPT0gMCAmJiBo\nYXNFYWdlckpvaW4odHJ1ZSkpCiAgICAgICAgICAgIHJldHVybiAwOwogICAg\nICAgIHJldHVybiBfZXhwZWN0ZWRSZXN1bHRDb3VudDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRFeHBlY3RlZFJlc3VsdENvdW50KGludCBleHBlY3Rl\nZFJlc3VsdENvdW50LCBib29sZWFuIGZvcmNlKSB7CiAgICAgICAgX2V4cGVj\ndGVkUmVzdWx0Q291bnQgPSBleHBlY3RlZFJlc3VsdENvdW50OwogICAgICAg\nIGlmIChmb3JjZSkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZPUkNFX0NPVU5U\nOwogICAgICAgIGVsc2UgCiAgICAgICAgICAgIF9mbGFncyAmPSB+Rk9SQ0Vf\nQ09VTlQ7CiAgICB9CgogICAgcHVibGljIGludCBnZXRKb2luU3ludGF4KCkg\newogICAgICAgIHJldHVybiBfam9pblN5bnRheDsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRKb2luU3ludGF4KGludCBqb2luU3ludGF4KSB7CiAgICAg\nICAgX2pvaW5TeW50YXggPSBqb2luU3ludGF4OwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNjZXNzKGJvb2xlYW4gZm9yVXBk\nYXRlKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0LnN1cHBvcnRzUmFuZG9tQWNj\nZXNzUmVzdWx0U2V0KHRoaXMsIGZvclVwZGF0ZSk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nKCkgewogICAgICAgIHJldHVy\nbiBfZGljdC5zdXBwb3J0c0xvY2tpbmcodGhpcyk7CiAgICB9CgogICAgcHVi\nbGljIGludCBnZXRDb3VudChKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0g\nbnVsbDsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7\nCiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0gdG9TZWxlY3RDb3VudCgpOwog\nICAgICAgICAgICBjb25uID0gc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAg\nICAgICAgICBzdG1udCA9IHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4pOwog\nICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAg\nICAgICBycy5uZXh0KCk7CiAgICAgICAgICAgIHJldHVybiBycy5nZXRJbnQo\nMSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlmIChzdG1u\ndCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2Uo\nKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBp\nZiAoY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5j\nbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3RvcmUg\nc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZldGNoID09IG51\nbGwpCiAgICAgICAgICAgIGZldGNoID0gc3RvcmUuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3RvcmUuZ2V0Q29u\ndGV4dCgpLCBzdG9yZSwgZmV0Y2gsCiAgICAgICAgICAgIGZldGNoLmdldFJl\nYWRMb2NrTGV2ZWwoKSk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdCBleGVj\ndXRlKEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICBpbnQgbG9ja0xldmVsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAg\nICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigp\nOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0b3JlLmdldENvbnRleHQoKSwg\nc3RvcmUsIGZldGNoLCBsb2NrTGV2ZWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogRXhlY3V0ZSB0aGlzIHNlbGVjdCBpbiB0aGUgY29udGV4dCBvZiB0aGUg\nZ2l2ZW4gc3RvcmUgbWFuYWdlci4gVGhlCiAgICAgKiBjb250ZXh0IGlzIHBh\nc3NlZCBpbiBzZXBhcmF0ZWx5IGZvciBwcm9maWxpbmcgcHVycG9zZXMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHQgZXhlY3V0ZShTdG9yZUNvbnRl\neHQgY3R4LCBKREJDU3RvcmUgc3RvcmUsIAogICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUg\nPSBmYWxzZTsKICAgICAgICBpZiAoIWlzQWdncmVnYXRlKCkgJiYgX2dyb3Vw\naW5nID09IG51bGwpIHsKICAgICAgICAgICAgSkRCQ0xvY2tNYW5hZ2VyIGxt\nID0gc3RvcmUuZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICAgICAgaWYgKGxt\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3JVcGRhdGUgPSBsbS5zZWxl\nY3RGb3JVcGRhdGUodGhpcywgbG9ja0xldmVsKTsKICAgICAgICB9CgogICAg\nICAgIFNRTEJ1ZmZlciBzcWwgPSB0b1NlbGVjdChmb3JVcGRhdGUsIGZldGNo\nKTsKICAgICAgICBpbnQgcnNUeXBlID0gKGlzTFJTKCkgJiYgc3VwcG9ydHNS\nYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAgICAgICAgICAgPyAtMSA6IFJl\nc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsKICAgICAgICBDb25uZWN0aW9u\nIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIFJlc3VsdFNldCBy\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzTFJT\nKCkpCiAgICAgICAgICAgICAgICBzdG1udCA9IHNxbC5wcmVwYXJlU3RhdGVt\nZW50KGNvbm4sIGZldGNoLCByc1R5cGUsIC0xKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgc3RtbnQgPSBzcWwucHJlcGFyZVN0YXRlbWVu\ndChjb25uLCByc1R5cGUsIC0xKTsKCiAgICAgICAgICAgIC8vIGlmIHRoaXMg\naXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhlIGxvY2sgdGltZW91dCBpcyBn\ncmVhdGVyIHRoYW4KICAgICAgICAgICAgLy8gdGhlIGNvbmZpZ3VyZWQgcXVl\ncnkgdGltZW91dCwgdXNlIHRoZSBsb2NrIHRpbWVvdXQKICAgICAgICAgICAg\naWYgKGZvclVwZGF0ZSAmJiBfZGljdC5zdXBwb3J0c1F1ZXJ5VGltZW91dCAm\nJiBmZXRjaCAhPSBudWxsIAogICAgICAgICAgICAgICAgJiYgZmV0Y2guZ2V0\nTG9ja1RpbWVvdXQoKSA+IHN0bW50LmdldFF1ZXJ5VGltZW91dCgpICogMTAw\nMCkgewogICAgICAgICAgICAgICAgaW50IHRpbWVvdXQgPSBmZXRjaC5nZXRM\nb2NrVGltZW91dCgpOwogICAgICAgICAgICAgICAgaWYgKHRpbWVvdXQgPCAx\nMDAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IDEwMDA7IAog\nICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSBfY29uZi5nZXRMb2coSkRC\nQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgibWlsbGlzLXF1ZXJ5LXRpbWVvdXQi\nKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdG1udC5z\nZXRRdWVyeVRpbWVvdXQoZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSAvIDEwMDAp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0\nZVF1ZXJ5KCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIC8vIGNsZWFuIHVwIHN0YXRlbWVudAogICAgICAgICAg\nICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHN0\nbW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAg\nICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlMikge30KICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAg\nfQoKICAgICAgICBTZWxlY3RSZXN1bHQgcmVzID0gbmV3IFNlbGVjdFJlc3Vs\ndChjb25uLCBzdG1udCwgcnMsIF9kaWN0KTsKICAgICAgICByZXMuc2V0U2Vs\nZWN0KHRoaXMpOwogICAgICAgIHJlcy5zZXRTdG9yZShzdG9yZSk7CiAgICAg\nICAgcmVzLnNldExvY2tpbmcoZm9yVXBkYXRlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhZGRFYWdlclJlc3VsdHMocmVzLCB0aGlzLCBzdG9yZSwg\nZmV0Y2gpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICAgICAgdGhyb3cgc2U7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFeGVjdXRlIG91ciBlYWdlciBzZWxlY3RzLCBhZGRpbmcgdGhl\nIHJlc3VsdHMgdW5kZXIgdGhlIHNhbWUga2V5cwogICAgICogdG8gdGhlIGdp\ndmVuIHJlc3VsdC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBh\nZGRFYWdlclJlc3VsdHMoU2VsZWN0UmVzdWx0IHJlcywgU2VsZWN0SW1wbCBz\nZWwsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChzZWwuX2VhZ2VyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgLy8gZXhlY3V0ZSBlYWdlciBzZWxlY3RzCiAgICAg\nICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIFJlc3VsdCBlcmVzOwogICAg\nICAgIE1hcCBlYWdlcjsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNl\nbC5fZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0\nKCk7CgogICAgICAgICAgICAvLyBzaW11bGF0ZWQgYmF0Y2hlZCBzZWxlY3Rz\nIGZvciBpbm5lci9vdXRlciBqb2luczsgZm9yIHNlcGFyYXRlCiAgICAgICAg\nICAgIC8vIHNlbGVjdHMsIGRvbid0IHBhc3Mgb24gbG9jayBsZXZlbCwgYmVj\nYXVzZSB0aGV5J3JlIHByb2JhYmx5CiAgICAgICAgICAgIC8vIGZvciByZWxh\ndGlvbnMgYW5kIHRoZXJlZm9yZSBzaG91bGQgdXNlIGRlZmF1bHQgbGV2ZWwK\nICAgICAgICAgICAgaWYgKGVudHJ5LmdldFZhbHVlKCkgPT0gc2VsKQogICAg\nICAgICAgICAgICAgZXJlcyA9IHJlczsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgZXJlcyA9ICgoU2VsZWN0RXhlY3V0b3IpIGVudHJ5Lmdl\ndFZhbHVlKCkpLmV4ZWN1dGUoc3RvcmUsCiAgICAgICAgICAgICAgICAgICAg\nZmV0Y2gpOwoKICAgICAgICAgICAgZWFnZXIgPSByZXMuZ2V0RWFnZXJNYXAo\nZmFsc2UpOwogICAgICAgICAgICBpZiAoZWFnZXIgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgZWFnZXIgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAg\nICAgICAgcmVzLnNldEVhZ2VyTWFwKGVhZ2VyKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBlYWdlci5wdXQoZW50cnkuZ2V0S2V5KCksIGVyZXMpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBTZWxlY3QgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgaW50IGluZGV4T2YoKSB7CiAg\nICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0U3Vi\nc2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gKF9zdWJzZWxzID09IG51bGwp\nID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IF9zdWJzZWxzOwogICAgfQoK\nICAgIHB1YmxpYyBTZWxlY3QgZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVy\nbiBfcGFyZW50OwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3Vic2Vs\nZWN0UGF0aCgpIHsKICAgICAgICByZXR1cm4gX3N1YlBhdGg7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0UGFyZW50KFNlbGVjdCBwYXJlbnQsIFN0cmlu\nZyBwYXRoKSB7CiAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAgICAg\nICAgX3N1YlBhdGggPSBwYXRoICsgJzonOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX3N1YlBhdGggPSBudWxsOwoKICAgICAgICBpZiAocGFyZW50ID09\nIF9wYXJlbnQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3Bh\ncmVudCAhPSBudWxsKQogICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzLnJl\nbW92ZSh0aGlzKTsKCiAgICAgICAgLy8jIyMgcmlnaHQgbm93IHdlIGNhbid0\nIHVzZSBzcWw5MiBqb2lucyB3aXRoIHN1YnNlbGVjdHMsIGNhdXNlCiAgICAg\nICAgLy8jIyMgSSBjYW4ndCBmaWd1cmUgb3V0IHdoYXQgdG8gZG8gd2hlbiB0\naGUgc3Vic2VsZWN0IGhhcyBhIGpvaW4KICAgICAgICAvLyMjIyB3aXRoIGFu\nIGFsaWFzIGFsc28gcHJlc2VudCBpbiB0aGUgb3V0ZXIgc2VsZWN0Li4uIHlv\ndSBkb24ndCB3YW50CiAgICAgICAgLy8jIyMgdGhlIGpvaW4gdG8gYXBwZWFy\nIGluIHRoZSBGUk9NIGNsYXVzZSBvZiB0aGUgc3Vic2VsZWN0IGNhdXNlCiAg\nICAgICAgLy8jIyMgdGhlbiBpdCByZS1hbGlhc2VzIGJvdGggdGFibGVzIGlu\nIHRoZSBzY29wZSBvZiB0aGUgc3Vic2VsZWN0CiAgICAgICAgLy8jIyMgYW5k\nIHRoZSBjb3JyZWxhdGlvbiB3aXRoIHRoZSBvdXRlciBzZWxlY3QgaXMgbG9z\ndAogICAgICAgIF9wYXJlbnQgPSAoU2VsZWN0SW1wbCkgcGFyZW50OwogICAg\nICAgIGlmIChfcGFyZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9w\nYXJlbnQuX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wYXJl\nbnQuX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0KDIpOwogICAgICAgICAgICBf\ncGFyZW50Ll9zdWJzZWxzLmFkZCh0aGlzKTsKICAgICAgICAgICAgaWYgKF9w\nYXJlbnQuX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5\nMikKICAgICAgICAgICAgICAgIF9qb2luU3ludGF4ID0gSm9pblN5bnRheGVz\nLlNZTlRBWF9UUkFESVRJT05BTDsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgX2pvaW5TeW50YXggPSBfcGFyZW50Ll9qb2luU3ludGF4Owog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0IGdldEZyb21TZWxl\nY3QoKSB7CiAgICAgICAgcmV0dXJuIF9mcm9tOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEZyb21TZWxlY3QoU2VsZWN0IHNlbCkgewogICAgICAgIF9m\ncm9tID0gKFNlbGVjdEltcGwpIHNlbDsKICAgICAgICBpZiAoX2Zyb20gIT0g\nbnVsbCkKICAgICAgICAgICAgX2Zyb20uX291dGVyID0gdGhpczsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNFYWdlckpvaW4oYm9vbGVhbiB0b01h\nbnkpIHsKICAgICAgICBpZiAodG9NYW55KQogICAgICAgICAgICByZXR1cm4g\nKF9mbGFncyAmIEVBR0VSX1RPX01BTlkpICE9IDA7CiAgICAgICAgcmV0dXJu\nIChfZmxhZ3MgJiBFQUdFUl9UT19PTkUpICE9IDA7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaGFzSm9pbihib29sZWFuIHRvTWFueSkgewogICAgICAg\nIGlmICh0b01hbnkpCiAgICAgICAgICAgIHJldHVybiAoX2ZsYWdzICYgVE9f\nTUFOWSkgIT0gMDsKICAgICAgICByZXR1cm4gX3RhYmxlcyAhPSBudWxsICYm\nIF90YWJsZXMuc2l6ZSgpID4gMTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc1NlbGVjdGVkKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgUGF0aEpvaW5z\nIHBqID0gZ2V0Sm9pbnMobnVsbCwgZmFsc2UpOwogICAgICAgIGlmIChfZnJv\nbSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2Zyb20uZ2V0VGFibGVJ\nbmRleCh0YWJsZSwgcGosIGZhbHNlKSAhPSAtMTsKICAgICAgICByZXR1cm4g\nZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIGZhbHNlKSAhPSAtMTsKICAgIH0K\nCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRUYWJsZUFsaWFzZXMoKSB7CiAg\nICAgICAgcmV0dXJuIChfdGFibGVzID09IG51bGwpID8gQ29sbGVjdGlvbnMu\nRU1QVFlfU0VUIDogX3RhYmxlcy52YWx1ZXMoKTsKICAgIH0KCiAgICBwdWJs\naWMgTGlzdCBnZXRTZWxlY3RBbGlhc2VzKCkgewogICAgICAgIHJldHVybiBf\nc2VsZWN0cy5nZXRBbGlhc2VzKGZhbHNlLCBfb3V0ZXIgIT0gbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIExpc3QgZ2V0SWRlbnRpZmllckFsaWFzZXMoKSB7\nCiAgICAgICAgcmV0dXJuIF9zZWxlY3RzLmdldEFsaWFzZXModHJ1ZSwgX291\ndGVyICE9IG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0\nT3JkZXJpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9vcmRlcmluZzsKICAgIH0K\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldEdyb3VwaW5nKCkgewogICAgICAg\nIHJldHVybiBfZ3JvdXBpbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciBnZXRXaGVyZSgpIHsKICAgICAgICByZXR1cm4gX3doZXJlOwogICAgfQoK\nICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0SGF2aW5nKCkgewogICAgICAgIHJl\ndHVybiBfaGF2aW5nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZEpvaW5D\nbGFzc0NvbmRpdGlvbnMoKSB7CiAgICAgICAgaWYgKF9qb2lucyA9PSBudWxs\nIHx8IF9qb2lucy5qb2lucygpID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gam9pbiBzZXQgaXRlcmF0b3IgYWxsb3dzIGNvbmN1\ncnJlbnQgbW9kaWZpY2F0aW9uCiAgICAgICAgSm9pbiBqOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gX2pvaW5zLmpvaW5zKCkuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgaiA9IChKb2luKSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICBpZiAoai5nZXRSZWxhdGlvblRhcmdldCgp\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGouZ2V0UmVsYXRpb25UYXJn\nZXQoKS5nZXREaXNjcmltaW5hdG9yKCkuYWRkQ2xhc3NDb25kaXRpb25zCiAg\nICAgICAgICAgICAgICAgICAgKHRoaXMsIGouZ2V0U3ViY2xhc3NlcygpID09\nIFNVQlNfSk9JTkFCTEUsIAogICAgICAgICAgICAgICAgICAgIGouZ2V0UmVs\nYXRpb25Kb2lucygpKTsKICAgICAgICAgICAgICAgIGouc2V0UmVsYXRpb24o\nbnVsbCwgMCwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIEpvaW5zIGdldEpvaW5zKCkgewogICAgICAgIHJldHVy\nbiBfam9pbnM7CiAgICB9CgogICAgcHVibGljIEl0ZXJhdG9yIGdldEpvaW5J\ndGVyYXRvcigpIHsKICAgICAgICBpZiAoX2pvaW5zID09IG51bGwgfHwgX2pv\naW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVtcHR5SXRlcmF0\nb3IuSU5TVEFOQ0U7CiAgICAgICAgcmV0dXJuIF9qb2lucy5qb2lucygpLmpv\naW5JdGVyYXRvcigpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGdldFN0YXJ0\nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9zdGFydElkeDsKICAgIH0KCiAg\nICBwdWJsaWMgbG9uZyBnZXRFbmRJbmRleCgpIHsKICAgICAgICByZXR1cm4g\nX2VuZElkeDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSYW5nZShsb25n\nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgICAgIF9zdGFydElkeCA9IHN0YXJ0\nOwogICAgICAgIF9lbmRJZHggPSBlbmQ7CiAgICB9CgogICAgcHVibGljIFN0\ncmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0\ndXJuIGdldENvbHVtbkFsaWFzKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2ws\nIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFz\nKGNvbCwgZ2V0Sm9pbnMoam9pbnMsIGZhbHNlKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4gY29sdW1u\nLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhD\nb2x1bW4gY29sLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICByZXR1cm4gZ2V0\nQ29sdW1uQWxpYXMoY29sLmdldE5hbWUoKSwgY29sLmdldFRhYmxlKCksIHBq\nKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKFN0\ncmluZyBjb2wsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIGdldENv\nbHVtbkFsaWFzKGNvbCwgdGFibGUsIChKb2lucykgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhTdHJpbmcgY29sLCBU\nYWJsZSB0YWJsZSwgSm9pbnMgam9pbnMpIHsKICAgICAgICByZXR1cm4gZ2V0\nQ29sdW1uQWxpYXMoY29sLCB0YWJsZSwgZ2V0Sm9pbnMoam9pbnMsIGZhbHNl\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIFN0cmlu\nZyBnZXRDb2x1bW5BbGlhcyhTdHJpbmcgY29sLCBUYWJsZSB0YWJsZSwgUGF0\naEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpIHsKICAg\nICAgICAgICAgU3RyaW5nIGFsaWFzID0gdG9BbGlhcyhfZnJvbS5nZXRUYWJs\nZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpOwogICAgICAgICAgICBpZiAoX2Rp\nY3QucmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAgICAg\nIHJldHVybiBGUk9NX1NFTEVDVF9BTElBUyArICIuIiArIGFsaWFzICsgIl8i\nICsgY29sOwogICAgICAgICAgICByZXR1cm4gYWxpYXMgKyAiXyIgKyBjb2w7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0b0FsaWFzKGdldFRhYmxlSW5k\nZXgodGFibGUsIHBqLCB0cnVlKSkgKyAiLiIgKyBjb2w7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIChfZmxhZ3MgJiBBR0dSRUdBVEUpICE9IDA7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0QWdncmVnYXRlKGJvb2xlYW4gYWdnKSB7CiAgICAgICAgaWYg\nKGFnZykKICAgICAgICAgICAgX2ZsYWdzIHw9IEFHR1JFR0FURTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+QUdHUkVHQVRFOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTG9iKCkgewogICAgICAgIHJldHVy\nbiAoX2ZsYWdzICYgTE9CKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldExvYihib29sZWFuIGxvYikgewogICAgICAgIGlmIChsb2IpCiAgICAg\nICAgICAgIF9mbGFncyB8PSBMT0I7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkxPQjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVh\nclNlbGVjdHMoKSB7CiAgICAgICAgX3NlbGVjdHMuY2xlYXIoKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU1FMQnVmZmVyIHNxbCwgT2Jq\nZWN0IGlkKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdChzcWwsIGlkLCBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU1FMQnVmZmVy\nIHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGlmICgh\naXNHcm91cGluZygpKQogICAgICAgICAgICByZXR1cm4gc2VsZWN0KChPYmpl\nY3QpIHNxbCwgaWQsIGpvaW5zKTsKICAgICAgICBncm91cEJ5KHNxbCwgam9p\nbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlY29yZCB0aGUgc2VsZWN0IG9mIHRoZSBnaXZlbiBTUUwgYnVmZmVy\nIG9yIHN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVj\ndChPYmplY3Qgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGJvb2xlYW4gY29u\ndGFpbnM7CiAgICAgICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAg\naW50IGlkeCA9IF9zZWxlY3RzLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAg\nICAgICBjb250YWlucyA9IGlkeCAhPSAtMTsKICAgICAgICAgICAgaWYgKGNv\nbnRhaW5zKQogICAgICAgICAgICAgICAgaWQgPSBfc2VsZWN0cy5nZXQoaWR4\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWQgPSBudWxs\nSWQoKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY29udGFpbnMgPSBf\nc2VsZWN0cy5jb250YWlucyhpZCk7CgogICAgICAgIGlmIChjb250YWlucykK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIF9zZWxlY3RzLnNl\ndEFsaWFzKGlkLCBzcWwsIGZhbHNlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSB1bmlxdWUgaWQgZm9y\nIGEgU1FMIHN0cmluZyB3aG9zZSBnaXZlbiBpZCBpcyBudWxsLgogICAgICov\nCiAgICBwcml2YXRlIE9iamVjdCBudWxsSWQoKSB7CiAgICAgICAgaWYgKF9u\ndWxsSWRzID49IE5VTExfSURTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBOdWxsSWQoKTsKICAgICAgICByZXR1cm4gTlVMTF9JRFNbX251bGxJ\nZHMrK107CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFN0cmlu\nZyBzcWwsIE9iamVjdCBpZCkgewogICAgICAgIHJldHVybiBzZWxlY3Qoc3Fs\nLCBpZCwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0\nKFN0cmluZyBzcWwsIE9iamVjdCBpZCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBpZiAoIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVj\ndCgoT2JqZWN0KSBzcWwsIGlkLCBqb2lucyk7CiAgICAgICAgZ3JvdXBCeShz\ncWwsIGpvaW5zKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZWxlY3RQbGFjZWhvbGRlcihTdHJpbmcgc3FsKSB7CiAg\nICAgICAgT2JqZWN0IGhvbGRlciA9IChfcGxhY2Vob2xkZXJzID49IFBMQUNF\nSE9MREVSUy5sZW5ndGgpCiAgICAgICAgICAgID8gbmV3IFBsYWNlaG9sZGVy\nKCkgOiBQTEFDRUhPTERFUlNbX3BsYWNlaG9sZGVycysrXTsKICAgICAgICBz\nZWxlY3Qoc3FsLCBob2xkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogSW5z\nZXJ0IGEgcGxhY2Vob2xkZXIgYXQgdGhlIGdpdmVuIGluZGV4OyB1c2UgYSBu\nZWdhdGl2ZSBpbmRleAogICAgICogdG8gY291bnQgZnJvbSB0aGUgYmFjayBv\nZiB0aGUgc2VsZWN0IGxpc3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGlu\nc2VydFBsYWNlaG9sZGVyKFN0cmluZyBzcWwsIGludCBwb3MpIHsKICAgICAg\nICBPYmplY3QgaG9sZGVyID0gKF9wbGFjZWhvbGRlcnMgPj0gUExBQ0VIT0xE\nRVJTLmxlbmd0aCkKICAgICAgICAgICAgPyBuZXcgUGxhY2Vob2xkZXIoKSA6\nIFBMQUNFSE9MREVSU1tfcGxhY2Vob2xkZXJzKytdOwogICAgICAgIF9zZWxl\nY3RzLmluc2VydEFsaWFzKHBvcywgaG9sZGVyLCBzcWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgc2VsZWN0ZWQgcGxhY2Vob2xkZXJzLCBhbmQg\ncmV0dXJuIHJlbW92ZWQgc2VsZWN0IGluZGV4ZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGNsZWFyUGxhY2Vob2xkZXJTZWxlY3RzKCkgewogICAgICAg\nIF9zZWxlY3RzLmNsZWFyUGxhY2Vob2xkZXJzKCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc2VsZWN0KENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1\ncm4gc2VsZWN0KGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsK\nICAgICAgICBpZiAoIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJu\nIHNlbGVjdChjb2wsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgZmFsc2UpOwog\nICAgICAgIGdyb3VwQnkoY29sLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0KENvbHVtbltdIGNv\nbHMpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KGNvbHMsIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0KENvbHVtbltdIGNvbHMsIEpvaW5z\nIGpvaW5zKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAo\naXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywgam9p\nbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAg\nUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAg\nIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29sc1tp\nXSwgcGosIGZhbHNlKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBp\nOwogICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIC8qKgogICAgICog\nU2VsZWN0IHRoZSBnaXZlbiBjb2x1bW4gYWZ0ZXIgbWFraW5nIHRoZSBnaXZl\nbiBqb2lucy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdChD\nb2x1bW4gY29sLCBQYXRoSm9pbnMgcGosIGJvb2xlYW4gaWRlbnQpIHsKICAg\nICAgICAvLyB3ZSBjYWNoZSBvbiBjb2x1bW4gb2JqZWN0IGlmIHRoZXJlIGFy\nZSBubyBqb2lucyBzbyB0aGF0IHdoZW4KICAgICAgICAvLyBsb29raW5nIHVw\nIGNvbHVtbnMgaW4gdGhlIHJlc3VsdCB3ZSBkb24ndCBoYXZlIHRvIGNyZWF0\nZSBhIHN0cmluZwogICAgICAgIC8vIGJ1ZmZlciBmb3IgdGhlIHRhYmxlICsg\nY29sdW1uIGFsaWFzOyBpZiB0aGVyZSBhcmUgam9pbnMsIHRoZW4KICAgICAg\nICAvLyB3ZSBrZXkgb24gdGhlIGFsaWFzCiAgICAgICAgU3RyaW5nIGFsaWFz\nID0gZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7CiAgICAgICAgT2JqZWN0IGlk\nOwogICAgICAgIGlmIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxs\nKQogICAgICAgICAgICBpZCA9IGNvbDsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGlkID0gYWxpYXM7CiAgICAgICAgaWYgKF9zZWxlY3RzLmNvbnRhaW5z\nKGlkKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAo\nY29sLmdldFR5cGUoKSA9PSBUeXBlcy5CTE9CIHx8IGNvbC5nZXRUeXBlKCkg\nPT0gVHlwZXMuQ0xPQikKICAgICAgICAgICAgc2V0TG9iKHRydWUpOwogICAg\nICAgIF9zZWxlY3RzLnNldEFsaWFzKGlkLCBhbGlhcywgaWRlbnQpOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndChDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBpbnQgZWFnZXIpIHsKICAgICAgICBzZWxlY3QobWFwcGluZywgc3Vi\nY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBp\nbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwKICAgICAgICBK\nb2lucyBqb2lucykgewogICAgICAgIHNlbGVjdCh0aGlzLCBtYXBwaW5nLCBz\ndWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBqb2lucywgZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBnaXZlbiBtYXBw\naW5nLgogICAgICovCiAgICB2b2lkIHNlbGVjdChTZWxlY3Qgd3JhcHBlciwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFuIGlk\nZW50KSB7CiAgICAgICAgLy8gbm90ZSB0aGF0IHRoaXMgaXMgb25lIGNhc2Ug\nd2hlcmUgd2UgZG9uJ3Qgd2FudCB0byB1c2UgdGhlIHJlc3VsdAogICAgICAg\nIC8vIG9mIGdldEpvaW5zKCk7IGp1c3QgdXNlIHRoZSBnaXZlbiBqb2lucywg\nd2hpY2ggd2lsbCBlaXRoZXIgYmUgY2xlYW4KICAgICAgICAvLyBvciB0aGUg\ncmVzdWx0IG9mIHByZXZpb3VzIHByZS1qb2lucy4gdGhpcyB3YXkgd2UgZG9u\nJ3QgcHVzaCBleHRyYQogICAgICAgIC8vIHN0YWNrIHN0dWZmIHdoZW4gbm8g\nYWN0dWFsIG5ldyBqb2lucyBoYXZlIGJlZW4gbWFkZSwgYW5kIHdlIGRvbid0\nCiAgICAgICAgLy8gdGhpbmsgdGhlIHVzZXIgd2FudHMgb3V0ZXIgam9pbnMg\nd2hlbiBhY3R1YWxseSBvbmx5IHRoZSBwcmV2aW91cwogICAgICAgIC8vIGpv\naW5zIHdlcmUgb3V0ZXIuICB3ZSBkbyBpbnZva2UgZ2V0Sm9pbnMoKSwgdGhv\ndWdoLCB0byBhZGQgdGhlc2UKICAgICAgICAvLyBqb2lucyAoaWYgYW55KSB0\nbyBvdXIgdG9wLWxldmVsIGpvaW5zOyBvdGhlcndpc2UgaXQnZCBiZSBwb3Nz\naWJsZQogICAgICAgIC8vIGZvciB0aGUgdXNlciB0byBpbW1lZGlhdGVseSBk\nbyBhbm90aGVyIGpvaW4gYW5kIHNlbGVjdCBzb21ldGhpbmcsCiAgICAgICAg\nLy8gYW5kIGlmIHdlJ3JlIGluIG91dGVyIG1vZGUgYWxsIHRoZXNlIGpvaW5z\nIHdpbGwgZ2V0IHN3aXRjaGVkIHRvIG91dGVyCiAgICAgICAgLy8gam9pbnMu\nICBjYWNoaW5nIHRoZW0gYXMgdGhlaXIgb3JpZ2luYWwgam9pbiB0eXBlIHBy\nZXZlbnRzIHRoYXQKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7Cgog\nICAgICAgIFBhdGhKb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwogICAg\nICAgIGJvb2xlYW4gaGFzSm9pbnMgPSBwaiAhPSBudWxsICYmIHBqLmlzRGly\ndHkoKTsKICAgICAgICBpZiAoaGFzSm9pbnMpIHsKICAgICAgICAgICAgaWYg\nKF9wcmVKb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3ByZUpvaW5z\nID0gbmV3IFN0YWNrKCk7CiAgICAgICAgICAgIF9wcmVKb2lucy5wdXNoKHBq\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoZXkgYXJlIHNlbGVjdGlu\nZyB0aGlzIG1hcHBpbmcgd2l0aCBvdXRlciBqb2lucywgdGhlbiBhbGwgam9p\nbnMKICAgICAgICAvLyBmcm9tIHRoaXMgbWFwcGluZyBzaG91bGQgYWxzbyBi\nZSBvdXRlcgogICAgICAgIGJvb2xlYW4gd2FzT3V0ZXIgPSAoX2ZsYWdzICYg\nT1VURVIpICE9IDA7CiAgICAgICAgaWYgKGhhc0pvaW5zICYmICF3YXNPdXRl\nciAmJiBwai5pc091dGVyKCkpCiAgICAgICAgICAgIF9mbGFncyB8PSBPVVRF\nUjsKCiAgICAgICAgLy8gZGVsZWdhdGUgdG8gc3RvcmUgbWFuYWdlciB0byBz\nZWxlY3QgaW4gc2FtZSBvcmRlciBpdCBsb2FkcyByZXN1bHQKICAgICAgICAo\nKEpEQkNTdG9yZU1hbmFnZXIpIHN0b3JlKS5zZWxlY3Qod3JhcHBlciwgbWFw\ncGluZywgc3ViY2xhc3NlcywgbnVsbCwKICAgICAgICAgICAgbnVsbCwgZmV0\nY2gsIGVhZ2VyLCBpZGVudCwgKF9mbGFncyAmIE9VVEVSKSAhPSAwKTsKCiAg\nICAgICAgLy8gcmVzZXQKICAgICAgICBpZiAoaGFzSm9pbnMpCiAgICAgICAg\nICAgIF9wcmVKb2lucy5wb3AoKTsKICAgICAgICBpZiAoIXdhc091dGVyICYm\nIChfZmxhZ3MgJiBPVVRFUikgIT0gMCkKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5PVVRFUjsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVu\ndGlmaWVyKENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gc2VsZWN0SWRl\nbnRpZmllcihjb2wsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gc2VsZWN0SWRlbnRpZmllcihDb2x1bW4gY29sLCBKb2lucyBq\nb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAg\nICByZXR1cm4gc2VsZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCB0\ncnVlKTsKICAgICAgICBncm91cEJ5KGNvbCwgam9pbnMpOwogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdElkZW50\naWZpZXIoQ29sdW1uW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3RJ\nZGVudGlmaWVyKGNvbHMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nc2VsZWN0SWRlbnRpZmllcihDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykg\newogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGlzR3JvdXBp\nbmcoKSkgewogICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIFBhdGhKb2lu\ncyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2Vs\nZCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoc2VsZWN0KGNvbHNbaV0sIHBqLCB0\ncnVlKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAg\nIHJldHVybiBzZWxkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdElk\nZW50aWZpZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2Vz\nLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgaW50IGVhZ2VyKSB7CiAgICAgICAgc2VsZWN0SWRlbnRp\nZmllcihtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2Vy\nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RJZGVudGlm\naWVyKENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGludCBlYWdlciwKICAgICAgICBKb2lucyBqb2lucykgewogICAg\nICAgIHNlbGVjdCh0aGlzLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwg\nZmV0Y2gsIGVhZ2VyLCBqb2lucywgdHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIGludCBzZWxlY3RQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nKSB7\nCiAgICAgICAgcmV0dXJuIHNlbGVjdFByaW1hcnlLZXkobWFwcGluZywgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3RQcmltYXJ5S2V5KENs\nYXNzTWFwcGluZyBtYXBwaW5nLCBKb2lucyBqb2lucykgewogICAgICAgIHJl\ndHVybiBwcmltYXJ5S2V5T3BlcmF0aW9uKG1hcHBpbmcsIHRydWUsIG51bGws\nIGpvaW5zLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVyYXRl\nIG9uIHByaW1hcnkga2V5IGRhdGEuIFJldHVybiBhIGJpdCBtYXNrIG9mIHNl\nbGVjdGVkIGNvbHVtbnMuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHByaW1h\ncnlLZXlPcGVyYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4g\nc2VsLAogICAgICAgIEJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVh\nbiBhbGlhc09yZGVyKSB7CiAgICAgICAgaWYgKCFzZWwgJiYgYXNjID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiAwOwoKICAgICAgICAvLyBpZiB0aGlz\nIG1hcHBpbmcgY2FuJ3Qgc2VsZWN0IHRoZSBmdWxsIHBrIHZhbHVlcywgdGhl\nbiBqb2luIHRvCiAgICAgICAgLy8gc3VwZXIgYW5kIHJlY3Vyc2UKICAgICAg\nICBDbGFzc01hcHBpbmcgc3VwOwogICAgICAgIGlmICghbWFwcGluZy5pc1By\naW1hcnlLZXlPYmplY3RJZCh0cnVlKSkgewogICAgICAgICAgICBzdXAgPSBt\nYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAg\nICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpv\naW5zID0gbmV3Sm9pbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5n\nLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIHJl\ndHVybiBwcmltYXJ5S2V5T3BlcmF0aW9uKHN1cCwgc2VsLCBhc2MsIGpvaW5z\nLCBhbGlhc09yZGVyKTsKICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNv\nbHMgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAg\naWYgKGlzR3JvdXBpbmcoKSkgewogICAgICAgICAgICBncm91cEJ5KGNvbHMs\nIGpvaW5zKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAg\nICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgZmFsc2UpOwog\nICAgICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2x1bW5P\ncGVyYXRpb24oY29sc1tpXSwgc2VsLCBhc2MsIHBqLCBhbGlhc09yZGVyKSkK\nICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwoKICAgICAgICAvLyBp\nZiB0aGlzIG1hcHBpbmcgaGFzIG5vdCBiZWVuIHVzZWQgaW4gdGhlIHNlbGVj\ndCB5ZXQgKGFuZCB0aGVyZWZvcmUKICAgICAgICAvLyBpcyBub3Qgam9pbmVk\nIHRvIGFueXRoaW5nKSwgYnV0IGhhcyBhbiBvdGhlci10YWJsZSBzdXBlcmNs\nYXNzIHRoYXQKICAgICAgICAvLyBoYXMgYmVlbiB1c2VkLCBtYWtlIHN1cmUg\ndG8gam9pbiB0byBpdAogICAgICAgIGJvb2xlYW4gam9pbmVkID0gZmFsc2U7\nCiAgICAgICAgZm9yIChzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpOyBzdXAgIT0gbnVsbDsKICAgICAgICAgICAgbWFw\ncGluZyA9IHN1cCwgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKSkgewogICAgICAgICAgICBpZiAoc3VwLmdldFRhYmxl\nKCkgPT0gbWFwcGluZy5nZXRUYWJsZSgpKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICBpZiAobWFwcGluZy5nZXRUYWJsZSgpICE9\nIHN1cC5nZXRUYWJsZSgpCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUlu\nZGV4KG1hcHBpbmcuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSA9PSAtMQogICAg\nICAgICAgICAgICAgJiYgZ2V0VGFibGVJbmRleChzdXAuZ2V0VGFibGUoKSwg\ncGosIGZhbHNlKSAhPSAtMSkgewogICAgICAgICAgICAgICAgaWYgKHBqID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBu\nZXdKb2lucygpOwogICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBt\nYXBwaW5nLmpvaW5TdXBlcmNsYXNzKHBqLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICBqb2luZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoam9pbmVk\nKQogICAgICAgICAgICB3aGVyZShwaik7CgogICAgICAgIHJldHVybiBzZWxk\nOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBhbiBvcGVyYXRpb24g\nb24gYSBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBjb2x1\nbW5PcGVyYXRpb24oQ29sdW1uIGNvbCwgYm9vbGVhbiBzZWwsIEJvb2xlYW4g\nYXNjLAogICAgICAgIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBhbGlhc09yZGVy\nKSB7CiAgICAgICAgU3RyaW5nIGFzID0gbnVsbDsKICAgICAgICBpZiAoYXNj\nICE9IG51bGwgJiYgKGFsaWFzT3JkZXIgfHwgKF9mbGFncyAmIFJFQ09SRF9P\nUkRFUkVEKSAhPSAwKSkgewogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAg\nICAgICAgIGlmIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgaWQgPSBjb2w7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGlkID0gZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7CiAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9IDAp\nIHsKICAgICAgICAgICAgICAgIGlmIChfb3JkZXJlZCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9vcmRlcmVkID0gbmV3IEFycmF5TGlzdCg1KTsK\nICAgICAgICAgICAgICAgIF9vcmRlcmVkLmFkZChpZCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKGFsaWFzT3JkZXIpIHsKICAgICAgICAgICAg\nICAgIGFzID0gdG9PcmRlckFsaWFzKF9vcmRlcnMrKyk7CiAgICAgICAgICAg\nICAgICBfc2VsZWN0cy5zZXRTZWxlY3RBcyhpZCwgYXMpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIHNlbGQgPSBzZWwgJiYg\nc2VsZWN0KGNvbCwgcGosIGZhbHNlKTsKICAgICAgICBpZiAoYXNjICE9IG51\nbGwpIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gKGFzICE9IG51bGwp\nID8gYXMgOiBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAgICAgICAg\nYXBwZW5kT3JkZXJpbmcoYWxpYXMsIGFzYy5ib29sZWFuVmFsdWUoKSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIC8qKgog\nICAgICogQXBwZW5kIG9yZGVyaW5nIGluZm9ybWF0aW9uIHRvIG91ciBpbnRl\ncm5hbCBidWZmZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRP\ncmRlcmluZyhPYmplY3Qgb3JkZXJCeSwgYm9vbGVhbiBhc2MpIHsKICAgICAg\nICBpZiAoX29yZGVyaW5nID09IG51bGwpCiAgICAgICAgICAgIF9vcmRlcmlu\nZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX29yZGVyaW5nLmFwcGVuZCgiLCAiKTsKCiAgICAgICAgaWYgKG9y\nZGVyQnkgaW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgIF9vcmRl\ncmluZy5hcHBlbmQoKFNRTEJ1ZmZlcikgb3JkZXJCeSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKChTdHJpbmcpIG9yZGVy\nQnkpOwogICAgICAgIGlmIChhc2MpCiAgICAgICAgICAgIF9vcmRlcmluZy5h\ncHBlbmQoIiBBU0MiKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRl\ncmluZy5hcHBlbmQoIiBERVNDIik7CiAgICB9CgogICAgcHVibGljIGludCBv\ncmRlckJ5UHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVh\nbiBhc2MsCiAgICAgICAgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4g\nb3JkZXJCeVByaW1hcnlLZXkobWFwcGluZywgYXNjLCBudWxsLCBzZWwpOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpv\naW5zLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5UHJp\nbWFyeUtleShtYXBwaW5nLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNl\ncyBvbiBvcmRlciBjb2x1bW5zLgogICAgICovCiAgICBwdWJsaWMgaW50IG9y\nZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFu\nIGFzYywKICAgICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsIGJvb2xl\nYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVybiBwcmltYXJ5S2V5T3Bl\ncmF0aW9uKG1hcHBpbmcsIHNlbCwKICAgICAgICAgICAgKGFzYykgPyBCb29s\nZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLCBqb2lucywgYWxpYXNPcmRlcik7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJCeShDb2x1bW4gY29s\nLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4g\nb3JkZXJCeShjb2wsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBvcmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBK\nb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3Jk\nZXJCeShjb2wsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9y\nZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJCeShDb2x1\nbW4gY29sLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2Vs\nLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVy\nbiBjb2x1bW5PcGVyYXRpb24oY29sLCBzZWwsIChhc2MpID8gQm9vbGVhbi5U\nUlVFIDogQm9vbGVhbi5GQUxTRSwKICAgICAgICAgICAgZ2V0Sm9pbnMoam9p\nbnMsIHRydWUpLCBhbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIG9yZGVyQnkoQ29sdW1uW10gY29scywgYm9vbGVhbiBhc2MsIGJvb2xlYW4g\nc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29scywgYXNjLCBudWxs\nLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeShDb2x1bW5b\nXSBjb2xzLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2Vs\nKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29scywgYXNjLCBqb2lucywg\nc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlv\nbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwog\nICAgaW50IG9yZGVyQnkoQ29sdW1uW10gY29scywgYm9vbGVhbiBhc2MsIEpv\naW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFz\nT3JkZXIpIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKGNvbHVtbk9wZXJhdGlvbihjb2xzW2ldLCBzZWwsCiAgICAgICAgICAg\nICAgICAoYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIHBq\nLCBhbGlhc09yZGVyKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBp\nOwogICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIG9yZGVyQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIGJvb2xl\nYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2MsIChK\nb2lucykgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBv\ncmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lu\ncywKICAgICAgICBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRl\nckJ5KHNxbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3Jk\nZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1\nZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBz\nZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0\ndXJuIG9yZGVyQnkoKE9iamVjdCkgc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGFs\naWFzT3JkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogT3JkZXIgb24gYSBT\nUUwgYnVmZmVyIG9yIHN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIG9yZGVyQnkoT2JqZWN0IHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpv\naW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIp\nIHsKICAgICAgICBPYmplY3Qgb3JkZXIgPSBzcWw7CiAgICAgICAgaWYgKGFs\naWFzT3JkZXIpIHsKICAgICAgICAgICAgb3JkZXIgPSB0b09yZGVyQWxpYXMo\nX29yZGVycysrKTsKICAgICAgICAgICAgX3NlbGVjdHMuc2V0U2VsZWN0QXMo\nc3FsLCAoU3RyaW5nKSBvcmRlcik7CiAgICAgICAgfQogICAgICAgIGlmICgo\nX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9IDApIHsKICAgICAgICAgICAg\naWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAgICAgICAgICAgICBfb3JkZXJl\nZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAgICAgICAgIF9vcmRlcmVkLmFk\nZChzcWwpOwogICAgICAgIH0KCiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRy\ndWUpOwogICAgICAgIGFwcGVuZE9yZGVyaW5nKG9yZGVyLCBhc2MpOwogICAg\nICAgIGlmIChzZWwpIHsKICAgICAgICAgICAgaW50IGlkeCA9IF9zZWxlY3Rz\nLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAgICAgICBpZiAoaWR4ID09IC0x\nKSB7CiAgICAgICAgICAgICAgICBfc2VsZWN0cy5zZXRBbGlhcyhudWxsSWQo\nKSwgc3FsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJCeShTdHJpbmcgc3Fs\nLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4g\nb3JkZXJCeShzcWwsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gYXNjLCBK\nb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3Jk\nZXJCeShzcWwsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9y\nZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJCeShTdHJp\nbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2Vs\nLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVy\nbiBvcmRlckJ5KChPYmplY3QpIHNxbCwgYXNjLCBqb2lucywgc2VsLCBhbGlh\nc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhck9yZGVyaW5n\nKCkgewogICAgICAgIF9vcmRlcmluZyA9IG51bGw7CiAgICAgICAgX29yZGVy\ncyA9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8g\ncmVjb3JkIHRoZSBzZWxlY3QgbGlzdCBpbmRleGVzIG9mIGl0ZW1zIHdlIG9y\nZGVyIGJ5LgogICAgICovCiAgICB2b2lkIHNldFJlY29yZE9yZGVyZWRJbmRl\neGVzKGJvb2xlYW4gcmVjb3JkKSB7CiAgICAgICAgaWYgKHJlY29yZCkKICAg\nICAgICAgICAgX2ZsYWdzIHw9IFJFQ09SRF9PUkRFUkVEOwogICAgICAgIGVs\nc2UgewogICAgICAgICAgICBfb3JkZXJlZCA9IG51bGw7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+UkVDT1JEX09SREVSRUQ7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBpbmRleGVzIGluIHRoZSBzZWxl\nY3QgbGlzdCBvZiBhbGwgaXRlbXMgd2UncmUgb3JkZXJpbmcKICAgICAqIGJ5\nLCBvciBudWxsIGlmIG5vbmUuIEZvciB1c2Ugd2l0aCB1bmlvbnMuCiAgICAg\nKi8KICAgIExpc3QgZ2V0T3JkZXJlZEluZGV4ZXMoKSB7CiAgICAgICAgaWYg\nKF9vcmRlcmVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIExpc3QgaWR4cyA9IG5ldyBBcnJheUxpc3QoX29yZGVyZWQuc2l6\nZSgpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9vcmRlcmVkLnNp\nemUoKTsgaSsrKQogICAgICAgICAgICBpZHhzLmFkZChOdW1iZXJzLnZhbHVl\nT2YoX3NlbGVjdHMuaW5kZXhPZihfb3JkZXJlZC5nZXQoaSkpKSk7CiAgICAg\nICAgcmV0dXJuIGlkeHM7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVQ\ncmltYXJ5S2V5KE9iamVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLAog\nICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHdoZXJlUHJpbWFy\neUtleShvaWQsIG1hcHBpbmcsIG51bGwsIHN0b3JlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCB3aGVyZSBjb25kaXRpb25zIHNldHRpbmcgdGhlIG1h\ncHBpbmcncyBwcmltYXJ5IGtleSB0byB0aGUgZ2l2ZW4KICAgICAqIG9pZCB2\nYWx1ZXMuIElmIHRoZSBnaXZlbiBtYXBwaW5nIGRvZXMgbm90IHVzZSBvaWQg\ndmFsdWVzIGZvciBpdHMKICAgICAqIHByaW1hcnkga2V5LCB3ZSB3aWxsIHJl\nY3Vyc2l2ZWx5IGpvaW4gdG8gaXRzIHN1cGVyY2xhc3MgdW50aWwgd2UgZmlu\nZAogICAgICogYW4gYW5jZXN0b3IgdGhhdCBkb2VzLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9iamVjdCBvaWQsIENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBKb2lucyBqb2lucywKICAgICAgICBKREJDU3Rv\ncmUgc3RvcmUpIHsKICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcncyBpZGVu\ndGlmaWVycyBpbmNsdWRlIHNvbWV0aGluZyBvdGhlciB0aGFuCiAgICAgICAg\nLy8gdGhlIHBrIHZhbHVlcywgam9pbiB0byBzdXBlciBhbmQgcmVjdXJzZQog\nICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1hcnlLZXlPYmplY3RJZChmYWxz\nZSkpIHsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IG1hcHBpbmcu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAg\nIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgam9pbnMgPSBu\nZXdKb2lucygpOwogICAgICAgICAgICBqb2lucyA9IG1hcHBpbmcuam9pblN1\ncGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAgd2hlcmVQcmlt\nYXJ5S2V5KG9pZCwgc3VwLCBqb2lucywgc3RvcmUpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gbWFw\ncGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIHdoZXJlKG9p\nZCwgbWFwcGluZywgY29scywgY29scywgbnVsbCwgbnVsbCwgZ2V0Sm9pbnMo\nam9pbnMsIHRydWUpLAogICAgICAgICAgICBzdG9yZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9i\namVjdCBvaWQsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNT\ndG9yZSBzdG9yZSkgewogICAgICAgIHdoZXJlRm9yZWlnbktleShmaywgb2lk\nLCBtYXBwaW5nLCBudWxsLCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgd2hlcmUgY29uZGl0aW9ucyBzZXR0aW5nIHRoZSBnaXZlbiBmb3Jl\naWduIGtleSB0byB0aGUgZ2l2ZW4KICAgICAqIG9pZCB2YWx1ZXMuCiAgICAg\nKgogICAgICogQHNlZSAjd2hlcmVQcmltYXJ5S2V5CiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCB3aGVyZUZvcmVpZ25LZXkoRm9yZWlnbktleSBmaywgT2Jq\nZWN0IG9pZCwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgSm9pbnMg\nam9pbnMsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIC8vIGlmIHRoaXMg\nbWFwcGluZydzIGlkZW50aWZpZXJzIGluY2x1ZGUgc29tZXRoaW5nIG90aGVy\nIHRoYW4KICAgICAgICAvLyB0aGUgcGsgdmFsdWVzLCBvciBpZiB0aGlzIGZv\ncmVpZ24ga2V5IGRvZXNuJ3QgbGluayB0byBvbmx5CiAgICAgICAgLy8gaWRl\nbnRpZmllcnMsIGpvaW4gdG8gdGFibGUgYW5kIGRvIGEgZ2V0UHJpbWFyeUtl\neQogICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1hcnlLZXlPYmplY3RJZChm\nYWxzZSkgfHwgIWNvbnRhaW5zQWxsCiAgICAgICAgICAgIChtYXBwaW5nLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCksIGZrLmdldFByaW1hcnlLZXlDb2x1bW5z\nKCkpKSB7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICAvLyB0\ncmF2ZXJzZSB0byBmb3JlaWduIGtleSB0YXJnZXQgbWFwcGluZwogICAgICAg\nICAgICB3aGlsZSAobWFwcGluZy5nZXRUYWJsZSgpICE9IGZrLmdldFByaW1h\ncnlLZXlUYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoam9pbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5zKCk7\nCiAgICAgICAgICAgICAgICBqb2lucyA9IG1hcHBpbmcuam9pblN1cGVyY2xh\nc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIG1hcHBpbmcgPSBt\nYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAg\nICAgICAgICAgICAgaWYgKG1hcHBpbmcgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBqb2lucyA9IGpvaW5zLmpvaW4oZmssIGZh\nbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIHdoZXJlUHJpbWFyeUtleShvaWQs\nIG1hcHBpbmcsIGpvaW5zLCBzdG9yZSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGZyb21Db2xzID0gZmsuZ2V0\nQ29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHRvQ29scyA9IGZrLmdldFBy\naW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gY29uc3RDb2xz\nID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAgICAgT2JqZWN0W10g\nY29uc3RzID0gZmsuZ2V0Q29uc3RhbnRzKCk7CiAgICAgICAgd2hlcmUob2lk\nLCBtYXBwaW5nLCB0b0NvbHMsIGZyb21Db2xzLCBjb25zdHMsIGNvbnN0Q29s\ncywKICAgICAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCBzdG9yZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gZmx1\nc2ggdGhlIG9pZCB2YWx1ZXMgYXMgd2hlcmUgY29uZGl0aW9ucyB0byB0aGUK\nICAgICAqIGdpdmVuIGNvbHVtbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB3aGVyZShPYmplY3Qgb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywgQ29s\ndW1uW10gdG9Db2xzLAogICAgICAgIENvbHVtbltdIGZyb21Db2xzLCBPYmpl\nY3RbXSB2YWxzLCBDb2x1bW5bXSBjb25zdENvbHMsIFBhdGhKb2lucyBwaiwK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgZW1iZWQgPSBtYXBwaW5nLmdldEVtYmVkZGluZ01hcHBpbmcoKTsKICAg\nICAgICBpZiAoZW1iZWQgIT0gbnVsbCkgewogICAgICAgICAgICB3aGVyZShv\naWQsIGVtYmVkLmdldEZpZWxkTWFwcGluZygpLmdldERlZmluaW5nTWFwcGlu\nZygpLAogICAgICAgICAgICAgICAgdG9Db2xzLCBmcm9tQ29scywgdmFscywg\nY29uc3RDb2xzLCBwaiwgc3RvcmUpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICAvLyBvbmx5IGJvdGhlciB0byBwYWNrIHBrIHZh\nbHVlcyBpbnRvIGFycmF5IGlmIGFwcCBpZAogICAgICAgIE9iamVjdFtdIHBr\ncyA9IG51bGw7CiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAg\nICBwa3MgPSBBcHBsaWNhdGlvbklkcy50b1BLVmFsdWVzKG9pZCwgbWFwcGlu\nZyk7CgogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKF9k\naWN0KTsKICAgICAgICBKb2luYWJsZSBqb2luOwogICAgICAgIE9iamVjdCB2\nYWw7CiAgICAgICAgaW50IGNvdW50ID0gMDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHRvQ29scy5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAg\nICAgICAgICBpZiAocGtzID09IG51bGwpCiAgICAgICAgICAgICAgICB2YWwg\nPSAob2lkID09IG51bGwpID8gbnVsbCA6IE51bWJlcnMudmFsdWVPZigoKElk\nKW9pZCkuZ2V0SWQoKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgLy8gbXVzdCBiZSBhcHAgaWRlbnRpdHk7IHVzZSBwayBpbmRleCB0\nbyBnZXQgY29ycmVjdCBwayB2YWx1ZQogICAgICAgICAgICAgICAgam9pbiA9\nIG1hcHBpbmcuYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ldKTsKICAgICAgICAg\nICAgICAgIHZhbCA9IHBrc1ttYXBwaW5nLmdldEZpZWxkKGpvaW4uZ2V0Rmll\nbGRJbmRleCgpKS4KICAgICAgICAgICAgICAgICAgICBnZXRQcmltYXJ5S2V5\nSW5kZXgoKV07CiAgICAgICAgICAgICAgICB2YWwgPSBqb2luLmdldEpvaW5W\nYWx1ZSh2YWwsIHRvQ29sc1tpXSwgc3RvcmUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXRD\nb2x1bW5BbGlhcyhmcm9tQ29sc1tpXSwgcGopKTsKICAgICAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElT\nICIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIgPSAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKHZhbCwg\nZnJvbUNvbHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnN0Q29s\ncyAhPSBudWxsICYmIGNvbnN0Q29scy5sZW5ndGggPiAwKSB7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RDb2xzLmxlbmd0aDsgaSsr\nLCBjb3VudCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAwKQog\nICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVtbkFsaWFzKGNvbnN0Q29s\nc1tpXSwgcGopKTsKCiAgICAgICAgICAgICAgICBpZiAodmFsc1tpXSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJUyAiKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1\nZSh2YWxzW2ldLCBjb25zdENvbHNbaV0pOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICB3aGVyZShidWYsIHBqKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRlc3QgdG8gc2VlIGlmIHRoZSBnaXZlbiBzZXQgb2YgY29sdW1u\ncyBjb250YWlucyBhbGwgdGhlCiAgICAgKiBjb2x1bW5zIGluIHRoZSBnaXZl\nbiBwb3RlbnRpYWwgc3Vic2V0LgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbHVtbltdIHNldCwgQ29sdW1uW10g\nc3ViKSB7CiAgICAgICAgaWYgKHN1Yi5sZW5ndGggPiBzZXQubGVuZ3RoKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHRoaXMgaXMg\nb2J2aW91c2x5IG5eMiwgYnV0IHRoZSBudW1iZXIgb2YgY29sdW1ucyBzaG91\nbGQgYmUgaW4KICAgICAgICAvLyB0aGUgMS0yIHJhbmdlLCBzbyBubyBiaWdn\naWUKICAgICAgICBib29sZWFuIGZvdW5kID0gdHJ1ZTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHN1Yi5sZW5ndGggJiYgZm91bmQ7IGkrKykgewog\nICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGlu\ndCBqID0gMDsgaiA8IHNldC5sZW5ndGggJiYgIWZvdW5kOyBqKyspCiAgICAg\nICAgICAgICAgICBmb3VuZCA9IHN1YltpXSA9PSBzZXRbal07CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB3aGVyZShKb2lucyBqb2lucykgewogICAgICAgIGlmIChqb2lucyAhPSBu\ndWxsKQogICAgICAgICAgICB3aGVyZSgoU3RyaW5nKSBudWxsLCBqb2lucyk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCkg\newogICAgICAgIHdoZXJlKHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsLCBKb2lucyBqb2lu\ncykgewogICAgICAgIHdoZXJlKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0\naW9uIHRvIHRoZSBXSEVSRSBjbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsLCBQYXRoSm9pbnMgcGopIHsKICAg\nICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgogICAgICAgIGlmIChz\ncWwgPT0gbnVsbCB8fCBzcWwuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmIChfd2hlcmUgPT0gbnVsbCkKICAgICAgICAgICAg\nX3doZXJlID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBp\nZiAoIV93aGVyZS5pc0VtcHR5KCkpCiAgICAgICAgICAgIF93aGVyZS5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgX3doZXJlLmFwcGVuZChzcWwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFN0cmluZyBzcWwpIHsKICAgICAg\nICB3aGVyZShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmUoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0byB0aGUg\nV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmUo\nU3RyaW5nIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gbm8gbmVl\nZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShzcWwpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChf\nd2hlcmUgPT0gbnVsbCkKICAgICAgICAgICAgX3doZXJlID0gbmV3IFNRTEJ1\nZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAoIV93aGVyZS5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIF93aGVyZS5hcHBlbmQoIiBBTkQgIik7CiAgICAg\nICAgX3doZXJlLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGhhdmluZyhTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgaGF2aW5nKHNxbCwg\nKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZpbmco\nU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBoYXZpbmco\nc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIEhBVklORyBj\nbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYXZpbmcoU1FMQnVm\nZmVyIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0\nbyB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoc3FsID09IG51bGwgfHwgc3Fs\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAo\nX2hhdmluZyA9PSBudWxsKQogICAgICAgICAgICBfaGF2aW5nID0gbmV3IFNR\nTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAoIV9oYXZpbmcuaXNF\nbXB0eSgpKQogICAgICAgICAgICBfaGF2aW5nLmFwcGVuZCgiIEFORCAiKTsK\nICAgICAgICBfaGF2aW5nLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGhhdmluZyhTdHJpbmcgc3FsKSB7CiAgICAgICAgaGF2aW5nKHNx\nbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZp\nbmcoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBoYXZpbmco\nc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIEhBVklORyBj\nbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYXZpbmcoU3RyaW5n\nIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0byB1\nc2Ugam9pbnMuLi4KICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShz\ncWwpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChfaGF2aW5n\nID09IG51bGwpCiAgICAgICAgICAgIF9oYXZpbmcgPSBuZXcgU1FMQnVmZmVy\nKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICghX2hhdmluZy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIF9oYXZpbmcuYXBwZW5kKCIgQU5EICIpOwogICAgICAg\nIF9oYXZpbmcuYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZ3JvdXBCeShTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgZ3JvdXBCeShzcWws\nIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBC\neShTUUxCdWZmZXIgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIGdldEpv\naW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpZiAoX2dyb3VwaW5nID09IG51\nbGwpCiAgICAgICAgICAgIF9ncm91cGluZyA9IG5ldyBTUUxCdWZmZXIoX2Rp\nY3QpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2dyb3VwaW5nLmFwcGVu\nZCgiLCAiKTsKICAgICAgICBfZ3JvdXBpbmcuYXBwZW5kKHNxbCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShTdHJpbmcgc3FsKSB7CiAgICAg\nICAgZ3JvdXBCeShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgZ3JvdXBCeShTdHJpbmcgc3FsLCBKb2lucyBqb2lucykgewog\nICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpZiAoX2dy\nb3VwaW5nID09IG51bGwpCiAgICAgICAgICAgIF9ncm91cGluZyA9IG5ldyBT\nUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2dy\nb3VwaW5nLmFwcGVuZCgiLCAiKTsKICAgICAgICBfZ3JvdXBpbmcuYXBwZW5k\nKHNxbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW4g\nY29sKSB7CiAgICAgICAgZ3JvdXBCeShjb2wsIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBpZiAoX2dyb3VwaW5nID09IG51bGwpCiAgICAgICAgICAg\nIF9ncm91cGluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgX2dyb3VwaW5nLmFwcGVuZCgiLCAiKTsKCiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAg\nICAgIF9ncm91cGluZy5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29sLCBwaikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uW10gY29s\ncykgewogICAgICAgIGdyb3VwQnkoY29scywgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGlmIChfZ3JvdXBpbmcgPT0gbnVsbCkKICAgICAgICAg\nICAgX2dyb3VwaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBfZ3JvdXBpbmcuYXBwZW5kKCIsICIpOwoKICAg\nICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGlmIChpID4gMCkKICAgICAgICAgICAgICAgIF9ncm91\ncGluZy5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIF9ncm91cGluZy5hcHBl\nbmQoZ2V0Q29sdW1uQWxpYXMoY29sc1tpXSwgcGopKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDbGFzc01hcHBpbmcgbWFw\ncGluZywgaW50IHN1YmNsYXNzZXMsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgZ3Jv\ndXBCeShtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIG51bGwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLCBKREJDU3RvcmUgc3RvcmUsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9p\nbnMpIHsKICAgICAgICAvLyB3ZSBpbXBsZW1lbnQgdGhpcyBieSBwdXR0aW5n\nIG91cnNlbHZlcyBpbnRvIGdyb3VwaW5nIG1vZGUsIHdoZXJlCiAgICAgICAg\nLy8gYWxsIHNlbGVjdCBpbnZvY2F0aW9ucyBhcmUgcmUtcm91dGVkIHRvIGdy\nb3VwLWJ5IGludm9jYXRpb25zIGluc3RlYWQuCiAgICAgICAgLy8gdGhpcyBh\nbGxvd3MgdXMgdG8gdXRpbGl6ZSB0aGUgc2FtZSBzZWxlY3QgQVBJcyBvZiB0\naGUgc3RvcmUgbWFuYWdlcgogICAgICAgIC8vIGFuZCBhbGwgdGhlIG1hcHBp\nbmcgc3RyYXRlZ2llcywgcmF0aGVyIHRoYW4gaGF2aW5nIHRvIGNyZWF0ZSAK\nICAgICAgICAvLyBlcXVpdmFsZW50IEFQSXMgYW5kIGR1cGxpY2F0ZSBsb2dp\nYyBmb3IgZ3JvdXBpbmcKICAgICAgICBib29sZWFuIHdhc0dyb3VwaW5nID0g\naXNHcm91cGluZygpOwogICAgICAgIF9mbGFncyB8PSBHUk9VUElORzsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBzZWxlY3QobWFwcGluZywgc3ViY2xh\nc3Nlcywgc3RvcmUsIGZldGNoLCAKICAgICAgICAgICAgICAgIEVhZ2VyRmV0\nY2hNb2Rlcy5FQUdFUl9OT05FLCBqb2lucyk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgaWYgKCF3YXNHcm91cGluZykKICAgICAgICAgICAg\nICAgIF9mbGFncyAmPSB+R1JPVVBJTkc7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB3ZSdyZSBpbiBncm91cCBtb2RlLCB3aGVy\nZSBhbnkgc2VsZWN0IGlzIGNoYW5nZWQgdG8gYSBncm91cC1ieQogICAgICog\nY2FsbC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzR3JvdXBpbmco\nKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBHUk9VUElORykgIT0gMDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgam9pbnMgdG8gdXNl\nIGZvciBjb2x1bW4gYWxpYXNlcywgZXRjLgogICAgICoKICAgICAqIEBwYXJh\nbSBqb2lucyBqb2lucyBnaXZlbiBieSB0aGUgdXNlcgogICAgICogQHJldHVy\nbiB0aGUgam9pbnMgdG8gdXNlIGZvciBhbGlhc2VzLCBldGMKICAgICAqLwog\nICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMsIGJv\nb2xlYW4gcmVjb3JkKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhK\nb2lucykgam9pbnM7CiAgICAgICAgYm9vbGVhbiBwcmUgPSAocGogPT0gbnVs\nbCB8fCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAgICAmJiBfcHJlSm9pbnMg\nIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKTsKICAgICAgICBpZiAo\ncHJlKQogICAgICAgICAgICBwaiA9IChQYXRoSm9pbnMpIF9wcmVKb2lucy5w\nZWVrKCk7CgogICAgICAgIGlmIChwaiA9PSBudWxsIHx8ICFwai5pc0RpcnR5\nKCkpCiAgICAgICAgICAgIHBqID0gX2pvaW5zOwogICAgICAgIGVsc2UgaWYg\nKCFwcmUpIHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBPVVRFUikgIT0g\nMCkKICAgICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgb3V0ZXIocGop\nOwogICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICBp\nZiAoIXBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICByZW1vdmVQ\nYXJlbnRKb2lucyhwaik7CiAgICAgICAgICAgICAgICBpZiAoIXBqLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZUpvaW5zRnJvbVN1\nYnNlbGVjdHMocGopOwogICAgICAgICAgICAgICAgICAgIGlmIChfam9pbnMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3\nIFNlbGVjdEpvaW5zKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChf\nam9pbnMuam9pbnMoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBfam9pbnMuc2V0Sm9pbnMobmV3IEpvaW5TZXQocGouam9pbnMoKSkpOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgX2pvaW5zLmpvaW5zKCkuYWRkQWxsKHBqLmpvaW5zKCkpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBwajsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhbnkgam9p\nbnMgYWxyZWFkeSBpbiBvdXIgcGFyZW50IHNlbGVjdCBmcm9tIHRoZSBnaXZl\nbiBub24tZW1wdHkKICAgICAqIGpvaW4gc2V0LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVtb3ZlUGFyZW50Sm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAg\nICAgICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIGlmIChfcGFyZW50Ll9qb2lucyAhPSBudWxsICYmICFfcGFy\nZW50Ll9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHBqLmpvaW5zKCku\ncmVtb3ZlQWxsKF9wYXJlbnQuX2pvaW5zLmpvaW5zKCkpOwogICAgICAgIGlm\nICghcGouaXNFbXB0eSgpKQogICAgICAgICAgICBfcGFyZW50LnJlbW92ZVBh\ncmVudEpvaW5zKHBqKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0\naGUgZ2l2ZW4gbm9uLWVtcHR5IGpvaW5zIGZyb20gdGhlIGpvaW5zIG9mIG91\nciBzdWJzZWxlY3RzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3Zl\nSm9pbnNGcm9tU3Vic2VsZWN0cyhQYXRoSm9pbnMgcGopIHsKICAgICAgICBp\nZiAoX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIFNlbGVjdEltcGwgc3ViOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgc3ViID0g\nKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAgICAgaWYg\nKHN1Yi5fam9pbnMgIT0gbnVsbCAmJiAhc3ViLl9qb2lucy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICBzdWIuX2pvaW5zLmpvaW5zKCkucmVtb3ZlQWxs\nKHBqLmpvaW5zKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU2Vs\nZWN0RXhlY3V0b3Igd2hlcmVDbG9uZShpbnQgc2VscykgewogICAgICAgIGlm\nIChzZWxzIDwgMSkKICAgICAgICAgICAgc2VscyA9IDE7CgogICAgICAgIFNl\nbGVjdFtdIGNsb25lcyA9IG51bGw7CiAgICAgICAgU2VsZWN0SW1wbCBzZWw7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWxzOyBpKyspIHsKICAg\nICAgICAgICAgc2VsID0gKFNlbGVjdEltcGwpIF9jb25mLmdldFNRTEZhY3Rv\ncnlJbnN0YW5jZSgpLm5ld1NlbGVjdCgpOwogICAgICAgICAgICBzZWwuX2Zs\nYWdzID0gX2ZsYWdzOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5BR0dS\nRUdBVEU7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfk9VVEVSOwogICAg\nICAgICAgICBzZWwuX2ZsYWdzICY9IH5MUlM7CiAgICAgICAgICAgIHNlbC5f\nZmxhZ3MgJj0gfkVBR0VSX1RPX09ORTsKICAgICAgICAgICAgc2VsLl9mbGFn\ncyAmPSB+RUFHRVJfVE9fTUFOWTsKICAgICAgICAgICAgc2VsLl9mbGFncyAm\nPSB+Rk9SQ0VfQ09VTlQ7CiAgICAgICAgICAgIHNlbC5fam9pblN5bnRheCA9\nIF9qb2luU3ludGF4OwogICAgICAgICAgICBpZiAoX2FsaWFzZXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNlbC5fYWxpYXNlcyA9IG5ldyBIYXNoTWFw\nKF9hbGlhc2VzKTsKICAgICAgICAgICAgaWYgKF90YWJsZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHNlbC5fdGFibGVzID0gbmV3IFRyZWVNYXAoX3Rh\nYmxlcyk7CiAgICAgICAgICAgIGlmIChfam9pbnMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNlbC5fam9pbnMgPSBfam9pbnMuY2xvbmUoc2VsKTsKICAg\nICAgICAgICAgaWYgKF93aGVyZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nc2VsLl93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX3doZXJlKTsKICAgICAgICAg\nICAgaWYgKF9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbC5f\nZnJvbSA9IChTZWxlY3RJbXBsKSBfZnJvbS53aGVyZUNsb25lKDEpOwogICAg\nICAgICAgICAgICAgc2VsLl9mcm9tLl9vdXRlciA9IHNlbDsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoX3N1YnNlbHMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgc2VsLl9zdWJzZWxzID0gbmV3IEFycmF5TGlzdChfc3Vi\nc2Vscy5zaXplKCkpOwogICAgICAgICAgICAgICAgU2VsZWN0SW1wbCBzdWIs\nIHNlbFN1YjsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwg\nX3N1YnNlbHMuc2l6ZSgpOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBz\ndWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGopOwogICAgICAgICAg\nICAgICAgICAgIHNlbFN1YiA9IChTZWxlY3RJbXBsKSBzdWIuZnVsbENsb25l\nKDEpOwogICAgICAgICAgICAgICAgICAgIHNlbFN1Yi5fcGFyZW50ID0gc2Vs\nOwogICAgICAgICAgICAgICAgICAgIHNlbFN1Yi5fc3ViUGF0aCA9IHN1Yi5f\nc3ViUGF0aDsKICAgICAgICAgICAgICAgICAgICBzZWwuX3N1YnNlbHMuYWRk\nKHNlbFN1Yik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbC5fd2hlcmUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsLl93aGVyZS5y\nZXBsYWNlKHN1Yiwgc2VsU3ViKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlbHMgPT0gMSkKICAgICAgICAg\nICAgICAgIHJldHVybiBzZWw7CiAgICAgICAgICAgIGlmIChjbG9uZXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vs\nc107CiAgICAgICAgICAgIGNsb25lc1tpXSA9IHNlbDsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5l\nd1VuaW9uKGNsb25lcyk7CiAgICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1\ndG9yIGZ1bGxDbG9uZShpbnQgc2VscykgewogICAgICAgIGlmIChzZWxzIDwg\nMSkKICAgICAgICAgICAgc2VscyA9IDE7CgogICAgICAgIFNlbGVjdFtdIGNs\nb25lcyA9IG51bGw7CiAgICAgICAgU2VsZWN0SW1wbCBzZWw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzZWxzOyBpKyspIHsKICAgICAgICAgICAg\nc2VsID0gKFNlbGVjdEltcGwpIHdoZXJlQ2xvbmUoMSk7CiAgICAgICAgICAg\nIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAgICAgIHNlbC5fZXhwZWN0\nZWRSZXN1bHRDb3VudCA9IF9leHBlY3RlZFJlc3VsdENvdW50OwogICAgICAg\nICAgICBzZWwuX3NlbGVjdHMuYWRkQWxsKF9zZWxlY3RzKTsKICAgICAgICAg\nICAgaWYgKF9vcmRlcmluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2Vs\nLl9vcmRlcmluZyA9IG5ldyBTUUxCdWZmZXIoX29yZGVyaW5nKTsKICAgICAg\nICAgICAgc2VsLl9vcmRlcnMgPSBfb3JkZXJzOwogICAgICAgICAgICBpZiAo\nX2dyb3VwaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2dyb3Vw\naW5nID0gbmV3IFNRTEJ1ZmZlcihfZ3JvdXBpbmcpOwogICAgICAgICAgICBp\nZiAoX2hhdmluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2VsLl9oYXZp\nbmcgPSBuZXcgU1FMQnVmZmVyKF9oYXZpbmcpOwogICAgICAgICAgICBpZiAo\nX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9mcm9tID0g\nKFNlbGVjdEltcGwpIF9mcm9tLmZ1bGxDbG9uZSgxKTsKICAgICAgICAgICAg\nICAgIHNlbC5fZnJvbS5fb3V0ZXIgPSBzZWw7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChzZWxzID09IDEpCiAgICAgICAgICAgICAgICByZXR1\ncm4gc2VsOwogICAgICAgICAgICBpZiAoY2xvbmVzID09IG51bGwpCiAgICAg\nICAgICAgICAgICBjbG9uZXMgPSBuZXcgU2VsZWN0W3NlbHNdOwogICAgICAg\nICAgICBjbG9uZXNbaV0gPSBzZWw7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdVbmlvbihjbG9u\nZXMpOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRvciBlYWdlckNs\nb25lKEZpZWxkTWFwcGluZyBrZXksIGludCBlYWdlclR5cGUsCiAgICAgICAg\nYm9vbGVhbiB0b01hbnksIGludCBzZWxzKSB7CiAgICAgICAgaWYgKGVhZ2Vy\nVHlwZSA9PSBFQUdFUl9PVVRFUgogICAgICAgICAgICAmJiBfam9pblN5bnRh\neCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoX2VhZ2VyS2V5cyAhPSBu\ndWxsICYmIF9lYWdlcktleXMuY29udGFpbnMoa2V5KSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIC8vIGdsb2JhbCBzZXQgb2YgZWFnZXIg\na2V5cwogICAgICAgIGlmIChfZWFnZXJLZXlzID09IG51bGwpCiAgICAgICAg\nICAgIF9lYWdlcktleXMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgIF9lYWdl\ncktleXMuYWRkKGtleSk7CgogICAgICAgIFNlbGVjdEV4ZWN1dG9yIHNlbDsK\nICAgICAgICBpZiAoZWFnZXJUeXBlICE9IEVBR0VSX1BBUkFMTEVMKSB7CiAg\nICAgICAgICAgIGlmICh0b01hbnkpCiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nfD0gRUFHRVJfVE9fTUFOWTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IEVBR0VSX1RPX09ORTsKICAgICAgICAgICAgc2Vs\nID0gdGhpczsKICAgICAgICB9IGVsc2UgaWYgKHNlbHMgPCAyKQogICAgICAg\nICAgICBzZWwgPSBwYXJhbGxlbENsb25lKCk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIFNlbGVjdFtdIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2xvbmVzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgY2xvbmVzW2ldID0gcGFyYWxsZWxD\nbG9uZSgpOwogICAgICAgICAgICBzZWwgPSBfY29uZi5nZXRTUUxGYWN0b3J5\nSW5zdGFuY2UoKS5uZXdVbmlvbihjbG9uZXMpOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKF9lYWdlciA9PSBudWxsKQogICAgICAgICAgICBfZWFnZXIgPSBu\nZXcgSGFzaE1hcCgpOwogICAgICAgIF9lYWdlci5wdXQodG9FYWdlcktleShr\nZXksIGdldEpvaW5zKG51bGwsIGZhbHNlKSksIHNlbCk7CiAgICAgICAgcmV0\ndXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNsb25l\nIG9mIHRoaXMgc2VsZWN0IGZvciB1c2UgaW4gZWFnZXIgcGFyYWxsZWwgc2Vs\nZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIHBhcmFsbGVs\nQ2xvbmUoKSB7CiAgICAgICAgU2VsZWN0SW1wbCBzZWwgPSAoU2VsZWN0SW1w\nbCkgd2hlcmVDbG9uZSgxKTsKICAgICAgICBzZWwuX2ZsYWdzICY9IH5OT05B\nVVRPX0RJU1RJTkNUOwogICAgICAgIHNlbC5fZWFnZXJLZXlzID0gX2VhZ2Vy\nS2V5czsKICAgICAgICBpZiAoX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVK\nb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgc2VsLl9wcmVKb2lucyA9\nIG5ldyBTdGFjaygpOwogICAgICAgICAgICBzZWwuX3ByZUpvaW5zLnB1c2go\nKChTZWxlY3RKb2lucykgX3ByZUpvaW5zLnBlZWsoKSkuCiAgICAgICAgICAg\nICAgICBjbG9uZShzZWwpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNl\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB2aWV3IG9mIGVhZ2Vy\nIHNlbGVjdHMuIE1heSBiZSBudWxsLgogICAgICovCiAgICBwdWJsaWMgTWFw\nIGdldEVhZ2VyTWFwKCkgewogICAgICAgIHJldHVybiBfZWFnZXI7CiAgICB9\nCgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGdldEVhZ2VyKEZpZWxkTWFw\ncGluZyBrZXkpIHsKICAgICAgICBpZiAoX2VhZ2VyID09IG51bGwgfHwgIV9l\nYWdlcktleXMuY29udGFpbnMoa2V5KSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIChTZWxlY3RFeGVjdXRvcikgX2VhZ2VyLmdl\ndCh0b0VhZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVsbCwKICAgICAgICAgICAg\nZmFsc2UpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVh\nZ2VyIGtleSB0byB1c2UgZm9yIHRoZSB1c2VyLWdpdmVuIGtleS4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRvRWFnZXJLZXkoRmllbGRN\nYXBwaW5nIGtleSwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKHBqID09\nIG51bGwgfHwgcGoucGF0aCgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBrZXk7CiAgICAgICAgcmV0dXJuIG5ldyBLZXkocGoucGF0aCgpLnRvU3Ry\naW5nKCksIGtleSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG5ld0pvaW5z\nKCkgewogICAgICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpv\naW5zLmlzRW1wdHkoKSkgewogICAgICAgICAgICBTZWxlY3RKb2lucyBzaiA9\nIChTZWxlY3RKb2lucykgX3ByZUpvaW5zLnBlZWsoKTsKICAgICAgICAgICAg\ncmV0dXJuIHNqLmNsb25lKHRoaXMpOwogICAgICAgIH0KICAgICAgICAvLyBy\nZXR1cm4gdGhpcyBmb3IgZWZmaWNpZW5jeSBpbiBjYXNlIG5vIGpvaW5zIGVu\nZCB1cCBiZWluZyBtYWRlCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cgog\nICAgcHVibGljIEpvaW5zIG5ld091dGVySm9pbnMoKSB7CiAgICAgICAgcmV0\ndXJuICgoUGF0aEpvaW5zKSBuZXdKb2lucygpKS5zZXRPdXRlcih0cnVlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmQoU1FMQnVmZmVyIGJ1Ziwg\nSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCB8fCBq\nb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naWYgKCFidWYuaXNFbXB0eSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nQU5EICIpOwogICAgICAgIEpvaW4gam9pbiA9IG51bGw7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSAoKFBhdGhKb2lucykgam9pbnMpLmpvaW5zKCku\nam9pbkl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgc3dpdGNoIChfam9pblN5bnRheCkgewogICAgICAgICAgICAgICAg\nY2FzZSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMOgogICAgICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2RpY3QudG9UcmFkaXRpb25hbEpv\naW4oam9pbikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKb2luU3ludGF4ZXMuU1lOVEFYX0RBVEFCQVNFOgog\nICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2RpY3QudG9OYXRpdmVK\nb2luKGpvaW4pKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIEpvaW5zIGFuZChKb2lucyBqb2luczEsIEpvaW5zIGpvaW5zMikgewogICAg\nICAgIHJldHVybiBhbmQoKFBhdGhKb2lucykgam9pbnMxLCAoUGF0aEpvaW5z\nKSBqb2luczIsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tYmlu\nZSB0aGUgZ2l2ZW4gam9pbnMuCiAgICAgKi8KICAgIHByaXZhdGUgU2VsZWN0\nSm9pbnMgYW5kKFBhdGhKb2lucyBqMSwgUGF0aEpvaW5zIGoyLCBib29sZWFu\nIG51bGxKb2lucykgewogICAgICAgIGlmICgoajEgPT0gbnVsbCB8fCBqMS5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICYmIChqMiA9PSBudWxsIHx8IGoyLmlz\nRW1wdHkoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBT\nZWxlY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAg\nICBpZiAoajEgPT0gbnVsbCB8fCBqMS5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgaWYgKG51bGxKb2lucykKICAgICAgICAgICAgICAgIHNqLnNldEpvaW5z\nKGoyLmpvaW5zKCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBzai5zZXRKb2lucyhuZXcgSm9pblNldChqMi5qb2lucygpKSk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgSm9pblNldCBzZXQ7CiAgICAgICAg\nICAgIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAgICAgICBzZXQgPSBqMS5q\nb2lucygpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXQg\nPSBuZXcgSm9pblNldChqMS5qb2lucygpKTsKCiAgICAgICAgICAgIGlmIChq\nMiAhPSBudWxsICYmICFqMi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBz\nZXQuYWRkQWxsKGoyLmpvaW5zKCkpOwogICAgICAgICAgICBzai5zZXRKb2lu\ncyhzZXQpOwogICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCBwcmV2aW91cyBq\nb2luczsgYWxsIGFyZSBjb21iaW5lZCBpbnRvIHRoaXMgb25lCiAgICAgICAg\naWYgKG51bGxKb2lucyAmJiBqMSAhPSBudWxsKQogICAgICAgICAgICBqMS5u\ndWxsSm9pbnMoKTsKICAgICAgICBpZiAobnVsbEpvaW5zICYmIGoyICE9IG51\nbGwpCiAgICAgICAgICAgIGoyLm51bGxKb2lucygpOwoKICAgICAgICByZXR1\ncm4gc2o7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG9yKEpvaW5zIGpvaW5z\nMSwgSm9pbnMgam9pbnMyKSB7CiAgICAgICAgUGF0aEpvaW5zIGoxID0gKFBh\ndGhKb2lucykgam9pbnMxOwogICAgICAgIFBhdGhKb2lucyBqMiA9IChQYXRo\nSm9pbnMpIGpvaW5zMjsKCiAgICAgICAgLy8gaWYgbm8gY29tbW9uIGpvaW5z\nLCByZXR1cm4gbnVsbDsgaWYgb25lIHNpZGUgb2YgdGhlIG9yIGNsYXVzZSBo\nYXMKICAgICAgICAvLyBkaWZmZXJlbnQgam9pbnMgdGhhbiB0aGUgb3RoZXIs\nIHRoZW4gd2UgbmVlZCB0byB1c2UgZGlzdGluY3QKICAgICAgICBib29sZWFu\nIGoxRW1wdHkgPSBqMSA9PSBudWxsIHx8IGoxLmlzRW1wdHkoKTsKICAgICAg\nICBib29sZWFuIGoyRW1wdHkgPSBqMiA9PSBudWxsIHx8IGoyLmlzRW1wdHko\nKTsKICAgICAgICBpZiAoajFFbXB0eSB8fCBqMkVtcHR5KSB7CiAgICAgICAg\nICAgIGlmIChqMUVtcHR5ICYmICFqMkVtcHR5KSB7CiAgICAgICAgICAgICAg\nICBjb2xsZWN0T3V0ZXJKb2lucyhqMik7CiAgICAgICAgICAgICAgICBpZiAo\nIWoyLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBfZmxhZ3MgfD0g\nSU1QTElDSVRfRElTVElOQ1Q7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoajJF\nbXB0eSAmJiAhajFFbXB0eSkgewogICAgICAgICAgICAgICAgY29sbGVjdE91\ndGVySm9pbnMoajEpOwogICAgICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJ\nU1RJTkNUOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgYWxsIGNvbW1vbiBqb2lucywg\nbW92ZSBhbGwgam9pbnMgdG8gcmV0dXJuZWQgaW5zdGFuY2UKICAgICAgICBT\nZWxlY3RKb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAg\nICBpZiAoajEuam9pbnMoKS5lcXVhbHMoajIuam9pbnMoKSkpIHsKICAgICAg\nICAgICAgc2ouc2V0Sm9pbnMoajEuam9pbnMoKSk7CiAgICAgICAgICAgIGox\nLm51bGxKb2lucygpOwogICAgICAgICAgICBqMi5udWxsSm9pbnMoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBKb2luU2V0IGNvbW1vbkpvaW5z\nID0gbmV3IEpvaW5TZXQoajEuam9pbnMoKSk7CiAgICAgICAgICAgIGNvbW1v\nbkpvaW5zLnJldGFpbkFsbChqMi5qb2lucygpKTsKICAgICAgICAgICAgaWYg\nKCFjb21tb25Kb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIC8v\nIHB1dCBjb21tb24gam9pbnMgaW4gcmV0dXJuZWQgaW5zdGFuY2U7IHJlbW92\nZSB0aGVtIGZyb20KICAgICAgICAgICAgICAgIC8vIGVhY2ggZ2l2ZW4gaW5z\ndGFuY2UKICAgICAgICAgICAgICAgIHNqLnNldEpvaW5zKGNvbW1vbkpvaW5z\nKTsKICAgICAgICAgICAgICAgIGoxLmpvaW5zKCkucmVtb3ZlQWxsKGNvbW1v\nbkpvaW5zKTsKICAgICAgICAgICAgICAgIGoyLmpvaW5zKCkucmVtb3ZlQWxs\nKGNvbW1vbkpvaW5zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2xs\nZWN0T3V0ZXJKb2lucyhqMSk7CiAgICAgICAgICAgIGNvbGxlY3RPdXRlckpv\naW5zKGoyKTsKCiAgICAgICAgICAgIC8vIGlmIG9uZSBzaWRlIG9mIHRoZSBv\nciBjbGF1c2UgaGFzIGRpZmZlcmVudCBqb2lucyB0aGFuIHRoZSBvdGhlciwK\nICAgICAgICAgICAgLy8gdGhlbiB3ZSBuZWVkIHRvIHVzZSBkaXN0aW5jdAog\nICAgICAgICAgICBpZiAoIWoxLmlzRW1wdHkoKSB8fCAhajIuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNU\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2o7CiAgICB9CgogICAgcHVi\nbGljIEpvaW5zIG91dGVyKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKF9q\nb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwg\nfHwgam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwoK\nICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlzIGlzIGFuIG91dGVyIGpvaW4g\nc2V0LCBldmVuIGlmIGl0J3MgZW1wdHkKICAgICAgICBQYXRoSm9pbnMgcGog\nPSAoKFBhdGhKb2lucykgam9pbnMpLnNldE91dGVyKHRydWUpOwogICAgICAg\nIGlmIChwai5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBwajsKCiAg\nICAgICAgSm9pbiBqb2luOwogICAgICAgIEpvaW4gcmVjOwogICAgICAgIGJv\nb2xlYW4gaGFzSm9pbnMgPSBfam9pbnMgIT0gbnVsbCAmJiBfam9pbnMuam9p\nbnMoKSAhPSBudWxsOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGou\nam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlm\nIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAg\nICAgICAgICAgIGlmICghaGFzSm9pbnMpCiAgICAgICAgICAgICAgICAgICAg\nam9pbi5zZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZWMgPSBfam9pbnMuam9p\nbnMoKS5nZXRSZWNvcmRlZEpvaW4oam9pbik7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKHJlYyA9PSBudWxsIHx8IHJlYy5nZXRUeXBlKCkgPT0gSm9pbi5U\nWVBFX09VVEVSKQogICAgICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5\ncGUoSm9pbi5UWVBFX09VVEVSKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNb3ZlcyB0aGUgam9pbnMgZnJvbSB0aGUgZ2l2\nZW4gaW5zdGFuY2UgaW50byBvdXIgb3V0ZXIgam9pbnMgc2V0LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgY29sbGVjdE91dGVySm9pbnMoUGF0aEpvaW5z\nIHBqKSB7CiAgICAgICAgaWYgKF9qb2luU3ludGF4ID09IEpvaW5TeW50YXhl\ncy5TWU5UQVhfVFJBRElUSU9OQUwgfHwgcGogPT0gbnVsbAogICAgICAgICAg\nICB8fCBwai5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICBfam9pbnMgPSBu\nZXcgU2VsZWN0Sm9pbnModGhpcyk7CgogICAgICAgIGJvb2xlYW4gYWRkID0g\ndHJ1ZTsKICAgICAgICBpZiAoX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkgewog\nICAgICAgICAgICBfam9pbnMuc2V0Sm9pbnMocGouam9pbnMoKSk7CiAgICAg\nICAgICAgIGFkZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgSm9pbiBq\nb2luOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGouam9pbnMoKS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2lu\nID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChqb2luLmdl\ndFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAgICAgICAgICAg\nIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsCiAgICAgICAgICAg\nICAgICAgICAgJiYgIV9kaWN0LmNhbk91dGVySm9pbihfam9pblN5bnRheCwg\nam9pbi5nZXRGb3JlaWduS2V5KCkpKSB7CiAgICAgICAgICAgICAgICAgICAg\nTG9nIGxvZyA9IF9jb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0df\nSkRCQyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2Mu\nZ2V0KCJjYW50LW91dGVyLWZrIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGpvaW4uZ2V0Rm9yZWlnbktleSgpKSk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5U\nWVBFX09VVEVSKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWRk\nKQogICAgICAgICAgICAgICAgX2pvaW5zLmpvaW5zKCkuYWRkKGpvaW4pOwog\nICAgICAgIH0KICAgICAgICBwai5udWxsSm9pbnMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiB0YWJs\nZSB1bmRlciB0aGUgZ2l2ZW4gam9pbnMuCiAgICAgKiBOT1RFOiBXRSBSRUxZ\nIE9OIFRIRVNFIElOREVYRVMgQkVJTkcgTU9OT1RPTklDQUxMWSBJTkNSRUFT\nSU5HIEZST00gMAogICAgICovCiAgICBwcml2YXRlIGludCBnZXRUYWJsZUlu\nZGV4KFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGosIGJvb2xlYW4gY3JlYXRl\nKSB7CiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIGZyb20gc2VsZWN0LCB0aGVu\nIHRoZXJlIGFyZSBubyB0YWJsZSBhbGlhc2VzCiAgICAgICAgaWYgKF9mcm9t\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgT2Jq\nZWN0IGtleSA9IHRhYmxlLmdldEZ1bGxOYW1lKCk7CiAgICAgICAgaWYgKHBq\nICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgIGtl\neSA9IG5ldyBLZXkocGoucGF0aCgpLnRvU3RyaW5nKCksIGtleSk7CgogICAg\nICAgIC8vIGNoZWNrIG91dCBleGlzdGluZyBhbGlhc2VzCiAgICAgICAgSW50\nZWdlciBpID0gZmluZEFsaWFzKHRhYmxlLCBrZXksIGZhbHNlLCBudWxsKTsK\nICAgICAgICBpZiAoaSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gaS5p\nbnRWYWx1ZSgpOwogICAgICAgIGlmICghY3JlYXRlKQogICAgICAgICAgICBy\nZXR1cm4gLTE7CgogICAgICAgIC8vIG5vdCBmb3VuZDsgY3JlYXRlIGFsaWFz\nCiAgICAgICAgaSA9IE51bWJlcnMudmFsdWVPZihhbGlhc1NpemUoKSk7CiAg\nICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBpKTsKICAgICAg\nICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nQXR0ZW1wdCB0byBmaW5kIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGtleS4K\nICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVBhcmVudCB3aGV0aGVyIGEgcGFy\nZW50IGlzIGNoZWNraW5nIGl0cyBzdWJzZWxlY3RzCiAgICAgKiBAcGFyYW0g\nZnJvbVN1YiB0aGUgc3Vic2VsZWN0IGNoZWNraW5nIGl0cyBwYXJlbnQKICAg\nICAqLwogICAgcHJpdmF0ZSBJbnRlZ2VyIGZpbmRBbGlhcyhUYWJsZSB0YWJs\nZSwgT2JqZWN0IGtleSwgYm9vbGVhbiBmcm9tUGFyZW50LAogICAgICAgIFNl\nbGVjdEltcGwgZnJvbVN1YikgewogICAgICAgIEludGVnZXIgYWxpYXMgPSBu\ndWxsOwogICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGFsaWFzID0gKEludGVnZXIpICgoZnJvbVBhcmVudCkgPyBfYWxpYXNl\ncy5yZW1vdmUoa2V5KQogICAgICAgICAgICAgICAgOiBfYWxpYXNlcy5nZXQo\na2V5KSk7CiAgICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZnJvbVBhcmVudCkKICAgICAgICAgICAgICAgICAg\nICBfdGFibGVzLnJlbW92ZShhbGlhcyk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYWxpYXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKCFmcm9tUGFyZW50ICYmIF9wYXJlbnQgIT0gbnVsbCkgewogICAgICAgICAg\nICBhbGlhcyA9IF9wYXJlbnQuZmluZEFsaWFzKHRhYmxlLCBrZXksIGZhbHNl\nLCB0aGlzKTsKICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgfQogICAgICAgIGlm\nIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAgIFNlbGVjdEltcGwg\nc3ViOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9zdWJzZWxz\nLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdWIgPSAoU2VsZWN0\nSW1wbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgaWYgKHN1\nYiA9PSBmcm9tU3ViKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoc3ViLl9hbGlhc2VzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHN1Yi5fYWxpYXNlcy5yZW1vdmUoa2V5KTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoc3ViLl90YWJsZXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgc3ViLl90YWJsZXMucmVtb3ZlKGFsaWFz\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgYWxpYXMgPSBzdWIuZmluZEFsaWFzKHRhYmxlLCBrZXksIHRydWUsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgIGlmICghZnJvbVBhcmVudCAmJiBh\nbGlhcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRU\nYWJsZUFsaWFzKHRhYmxlLCBrZXksIGFsaWFzKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYWxp\nYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIG1hcHBpbmcg\nb2YgdGhlIGdpdmVuIGtleSB0byB0aGUgZ2l2ZW4gYWxpYXMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZWNvcmRUYWJsZUFsaWFzKFRhYmxlIHRhYmxl\nLCBPYmplY3Qga2V5LCBJbnRlZ2VyIGFsaWFzKSB7CiAgICAgICAgaWYgKF9h\nbGlhc2VzID09IG51bGwpCiAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICBfYWxpYXNlcy5wdXQoa2V5LCBhbGlhcyk7Cgog\nICAgICAgIFN0cmluZyB0YWJsZVN0cmluZyA9IF9kaWN0LmdldEZ1bGxOYW1l\nKHRhYmxlLCBmYWxzZSkgKyAiICIKICAgICAgICAgICAgKyB0b0FsaWFzKGFs\naWFzLmludFZhbHVlKCkpOwogICAgICAgIGlmIChfdGFibGVzID09IG51bGwp\nCiAgICAgICAgICAgIF90YWJsZXMgPSBuZXcgVHJlZU1hcCgpOwogICAgICAg\nIF90YWJsZXMucHV0KGFsaWFzLCB0YWJsZVN0cmluZyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDYWxjdWxhdGUgdG90YWwgbnVtYmVyIG9mIGFsaWFzZXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGFsaWFzU2l6ZSgpIHsKICAgICAg\nICByZXR1cm4gYWxpYXNTaXplKGZhbHNlLCBudWxsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENhbGN1bGF0ZSB0b3RhbCBudW1iZXIgb2YgYWxpYXNlcy4K\nICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVBhcmVudCB3aGV0aGVyIGEgcGFy\nZW50IGlzIGNoZWNraW5nIGl0cyBzdWJzZWxlY3RzCiAgICAgKiBAcGFyYW0g\nZnJvbVN1YiB0aGUgc3Vic2VsZWN0IGNoZWNraW5nIGl0cyBwYXJlbnQKICAg\nICAqLwogICAgcHJpdmF0ZSBpbnQgYWxpYXNTaXplKGJvb2xlYW4gZnJvbVBh\ncmVudCwgU2VsZWN0SW1wbCBmcm9tU3ViKSB7CiAgICAgICAgaW50IGFsaWFz\nZXMgPSAoZnJvbVBhcmVudCB8fCBfcGFyZW50ID09IG51bGwpID8gMAogICAg\nICAgICAgICA6IF9wYXJlbnQuYWxpYXNTaXplKGZhbHNlLCB0aGlzKTsKICAg\nICAgICBhbGlhc2VzICs9IChfYWxpYXNlcyA9PSBudWxsKSA/IDAgOiBfYWxp\nYXNlcy5zaXplKCk7CiAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwpIHsK\nICAgICAgICAgICAgU2VsZWN0SW1wbCBzdWI7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAg\nICAgICAgICAgIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7\nCiAgICAgICAgICAgICAgICBpZiAoc3ViICE9IGZyb21TdWIpCiAgICAgICAg\nICAgICAgICAgICAgYWxpYXNlcyArPSBzdWIuYWxpYXNTaXplKHRydWUsIG51\nbGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBh\nbGlhc2VzOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7\nCiAgICAgICAgcmV0dXJuIHRvU2VsZWN0KGZhbHNlLCBudWxsKS5nZXRTUUwo\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBQYXRoSm9pbnMgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVy\nKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMg\nUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLnNldE91dGVyKHRydWUpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdCdWZmZXIg\ncGF0aCgpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJs\naWMgSm9pblNldCBqb2lucygpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAgICAgICByZXR1\ncm4gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2lu\nKFRhYmxlIGxvY2FsVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAg\nICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuY3Jvc3NKb2luKGxv\nY2FsVGFibGUsIGZvcmVpZ25UYWJsZSk7CiAgICB9CgogICAgcHVibGljIEpv\naW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29s\nZWFuIHRvTWFueSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnMo\ndGhpcykuam9pbihmaywgaW52ZXJzZSwgdG9NYW55KTsKICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4g\naW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3\nIFNlbGVjdEpvaW5zKHRoaXMpLm91dGVySm9pbihmaywgaW52ZXJzZSwgdG9N\nYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0\ncmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCBDbGFzc01hcHBpbmcgdGFyZ2V0\nLAogICAgICAgIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlz\nKS5qb2luUmVsYXRpb24obmFtZSwgZmssIHRhcmdldCwgc3VicywgCiAgICAg\nICAgICAgIGludmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGljIEpv\naW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5\nIGZrLCAKICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3Vicywg\nYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgIHJl\ndHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykub3V0ZXJKb2luUmVsYXRpb24o\nbmFtZSwgZmssIHRhcmdldCwgc3VicywgCiAgICAgICAgICAgIGludmVyc2Us\nIHRvTWFueSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIHNldFZhcmlhYmxl\nKFN0cmluZyB2YXIpIHsKICAgICAgICBpZiAodmFyID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVybiBuZXcgU2VsZWN0\nSm9pbnModGhpcykuc2V0VmFyaWFibGUodmFyKTsKICAgIH0KCiAgICBwdWJs\naWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmluZyBhbGlhcykgewogICAgICAg\nIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLnNldFN1YnNl\nbGVjdChhbGlhcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRz\nIGEgU1FMIHN0cmluZyBzZWxlY3RlZCB3aXRoIG51bGwgaWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE51bGxJZCB7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXByZXNlbnRzIGEgcGxhY2Vob2xkZXIgU1FMIHN0cmlu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUGxhY2Vob2xk\nZXIgewogICAgfQoKICAgIC8qKgogICAgICogS2V5IHR5cGUgdXNlZCBmb3Ig\nYWxpYXNlcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgS2V5\nIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX3BhdGg7CiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBPYmplY3QgX2tleTsKCiAgICAgICAgcHVibGlj\nIEtleShTdHJpbmcgcGF0aCwgT2JqZWN0IGtleSkgewogICAgICAgICAgICBf\ncGF0aCA9IHBhdGg7CiAgICAgICAgICAgIF9rZXkgPSBrZXk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAg\nICByZXR1cm4gX3BhdGguaGFzaENvZGUoKSBeIF9rZXkuaGFzaENvZGUoKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmpl\nY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG90\naGVyLmdldENsYXNzKCkgIT0gZ2V0Q2xhc3MoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgS2V5IGsgPSAoS2V5KSBvdGhl\ncjsKICAgICAgICAgICAgcmV0dXJuIGsuX3BhdGguZXF1YWxzKF9wYXRoKSAm\nJiBrLl9rZXkuZXF1YWxzKF9rZXkpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIF9w\nYXRoICsgInwiICsgX2tleTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBIHtAbGluayBSZXN1bHR9IGltcGxlbWVudGF0aW9uIHdyYXBwZWQg\nYXJvdW5kIHRoaXMgc2VsZWN0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGNsYXNzIFNlbGVjdFJlc3VsdAogICAgICAgIGV4dGVuZHMgUmVzdWx0U2V0\nUmVzdWx0CiAgICAgICAgaW1wbGVtZW50cyBQYXRoSm9pbnMgewoKICAgICAg\nICBwcml2YXRlIFNlbGVjdEltcGwgX3NlbCA9IG51bGw7CgogICAgICAgIC8v\nIHBvc2l0aW9uIGluIHNlbGVjdGVkIGNvbHVtbnMgbGlzdCB3aGVyZSB3ZSBl\neHBlY3QgdGhlIG5leHQgbG9hZAogICAgICAgIHByaXZhdGUgaW50IF9wb3Mg\nPSAwOwogICAgICAgIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsK\nCiAgICAgICAgLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IuCiAgICAgICAg\nICovCiAgICAgICAgcHVibGljIFNlbGVjdFJlc3VsdChDb25uZWN0aW9uIGNv\nbm4sIFN0YXRlbWVudCBzdG1udCwgUmVzdWx0U2V0IHJzLAogICAgICAgICAg\nICBEQkRpY3Rpb25hcnkgZGljdCkgewogICAgICAgICAgICBzdXBlcihjb25u\nLCBzdG1udCwgcnMsIGRpY3QpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogU2VsZWN0IGZvciB0aGlzIHJlc3VsdC4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgU2VsZWN0SW1wbCBnZXRTZWxlY3QoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfc2VsOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogU2VsZWN0IGZvciB0aGlzIHJlc3VsdC4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRTZWxlY3QoU2VsZWN0SW1wbCBzZWwp\nIHsKICAgICAgICAgICAgX3NlbCA9IHNlbDsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBPYmplY3QgZ2V0RWFnZXIoRmllbGRNYXBwaW5nIGtleSkgewog\nICAgICAgICAgICAvLyBkb24ndCBib3RoZXIgY3JlYXRpbmcga2V5IGlmIHdl\nIGtub3cgd2UgZG9uJ3QgaGF2ZSBhbnkKICAgICAgICAgICAgLy8gZWFnZXIg\ncmVzdWx0cwogICAgICAgICAgICBpZiAoX3NlbC5fZWFnZXIgPT0gbnVsbCB8\nfCAhX3NlbC5fZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgTWFwIG1hcCA9IFNlbGVj\ndFJlc3VsdC50aGlzLmdldEVhZ2VyTWFwKHRydWUpOwogICAgICAgICAgICBp\nZiAobWFwID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQoX3NlbC50b0VhZ2VyS2V5KGtl\neSwgZ2V0Sm9pbnMobnVsbCkpKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHB1dEVhZ2VyKEZpZWxkTWFwcGluZyBrZXksIE9iamVjdCByZXMp\nIHsKICAgICAgICAgICAgTWFwIG1hcCA9IFNlbGVjdFJlc3VsdC50aGlzLmdl\ndEVhZ2VyTWFwKHRydWUpOwogICAgICAgICAgICBpZiAobWFwID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIG1hcCA9IG5ldyBIYXNoTWFwKCk7CiAgICAg\nICAgICAgICAgICBzZXRFYWdlck1hcChtYXApOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIG1hcC5wdXQoX3NlbC50b0VhZ2VyS2V5KGtleSwgZ2V0Sm9p\nbnMobnVsbCkpLCByZXMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9i\namVjdCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDU3RvcmUgc3Rv\ncmUsCiAgICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIEpvaW5zIGpvaW5zKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IGpvaW5zICE9IG51\nbGwKICAgICAgICAgICAgICAgICYmICgoUGF0aEpvaW5zKSBqb2lucykucGF0\naCgpICE9IG51bGw7CiAgICAgICAgICAgIGlmIChoYXNKb2lucykgewogICAg\nICAgICAgICAgICAgaWYgKF9wcmVKb2lucyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIF9wcmVKb2lucyA9IG5ldyBTdGFjaygpOwogICAgICAgICAg\nICAgICAgX3ByZUpvaW5zLnB1c2goam9pbnMpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBPYmplY3Qgb2JqID0gc3VwZXIubG9hZChtYXBwaW5nLCBz\ndG9yZSwgZmV0Y2gsIGpvaW5zKTsKCiAgICAgICAgICAgIC8vIHJlc2V0CiAg\nICAgICAgICAgIGlmIChoYXNKb2lucykKICAgICAgICAgICAgICAgIF9wcmVK\nb2lucy5wb3AoKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBuZXdKb2lucygpIHsKICAgICAgICAg\nICAgUGF0aEpvaW5zIHByZSA9IGdldFByZUpvaW5zKCk7CiAgICAgICAgICAg\nIGlmIChwcmUgPT0gbnVsbCB8fCBwcmUucGF0aCgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgICAgIFBhdGhKb2lu\nc0ltcGwgcGogPSBuZXcgUGF0aEpvaW5zSW1wbCgpOwogICAgICAgICAgICBw\nai5wYXRoID0gbmV3IFN0cmluZ0J1ZmZlcihwcmUucGF0aCgpLnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICByZXR1cm4gcGo7CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBjb250YWluc0ludGVybmFsKE9iamVjdCBv\nYmosIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgICAgIC8vIHdlIGtleSBkaXJl\nY3RseSBvbiBvYmpzIGFuZCBqb2luLWxlc3MgY29scywgb3Igb24gdGhlIGFs\naWFzCiAgICAgICAgICAgIC8vIGZvciBjb2xzIHdpdGggam9pbnMKICAgICAg\nICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAg\nICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIG9iaiA9IGdldENvbHVtbkFsaWFzKChDb2x1bW4pIG9i\naiwgcGopOwogICAgICAgICAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgX3Nl\nbC5fc2VsZWN0cy5jb250YWlucyhvYmopOwogICAgICAgIH0KCiAgICAgICAg\ncHJvdGVjdGVkIGJvb2xlYW4gY29udGFpbnNBbGxJbnRlcm5hbChPYmplY3Rb\nXSBvYmpzLCBKb2lucyBqb2lucykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5z\nKGpvaW5zKTsKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcygo\nQ29sdW1uKSBvYmpzW2ldLCBwaik7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgb2JqID0gb2Jqc1tpXTsKICAgICAgICAgICAg\nICAgIGlmIChvYmogPT0gbnVsbCB8fCAhX3NlbC5fc2VsZWN0cy5jb250YWlu\ncyhvYmopKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHB1c2hCYWNrKCkKICAgICAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSAwOwog\nICAgICAgICAgICBzdXBlci5wdXNoQmFjaygpOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIGJvb2xlYW4gYWJzb2x1dGVJbnRlcm5hbChpbnQgcm93\nKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5hYnNvbHV0\nZUludGVybmFsKHJvdyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBuZXh0SW50ZXJuYWwoKQogICAgICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5uZXh0SW50ZXJuYWwoKTsKICAgICAgICB9CgogICAg\nICAgIHByb3RlY3RlZCBpbnQgZmluZE9iamVjdChPYmplY3Qgb2JqLCBKb2lu\ncyBqb2lucykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGlmIChfcG9zID09IF9zZWwuX3NlbGVjdHMuc2l6ZSgpKQog\nICAgICAgICAgICAgICAgX3BvcyA9IDA7CgogICAgICAgICAgICAvLyB3ZSBr\nZXkgZGlyZWN0bHkgb24gb2JqcyBhbmQgam9pbi1sZXNzIGNvbHMsIG9yIG9u\nIHRoZSBhbGlhcwogICAgICAgICAgICAvLyBmb3IgY29scyB3aXRoIGpvaW5z\nCiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsK\nICAgICAgICAgICAgQm9vbGVhbiBwayA9IG51bGw7CiAgICAgICAgICAgIGlm\nIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBDb2x1bW4gY29sID0gKENvbHVtbikgb2JqOwogICAgICAgICAg\nICAgICAgcGsgPSAoY29sLmlzUHJpbWFyeUtleSgpKSA/IEJvb2xlYW4uVFJV\nRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgICAgICBvYmogPSBnZXRD\nb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAgICAgICAgICAgIGlmIChvYmog\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhj\nZXB0aW9uKGNvbC5nZXRUYWJsZSgpICsgIjogIgogICAgICAgICAgICAgICAg\nICAgICAgICArIHBqLnBhdGgoKSArICIgKCIgKyBfc2VsLl9hbGlhc2VzICsg\nIikiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gd2UgbG9hZCBp\nbiB0aGUgc2FtZSBvcmRlciB3ZSBzZWxlY3QsIG1vcmUgb3IgbGVzcy4uLgog\nICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5nZXQoX3BvcykuZXF1YWxz\nKG9iaikpCiAgICAgICAgICAgICAgICByZXR1cm4gKytfcG9zOwoKICAgICAg\nICAgICAgLy8gaWYgd2UncmUgbG9va2luZyBmb3IgYSBwcmltYXJ5IGtleSwg\ndHJ5IGJhY2sgYSBjb3VwbGUgcGxhY2VzLAogICAgICAgICAgICAvLyBzaW5j\nZSBwa3MgbWlnaHQgYmUgc2VsZWN0ZWQgaW4gYSBzbGlnaHRseSBkaWZmZXJl\nbnQgb3JkZXIgdGhhbgogICAgICAgICAgICAvLyB0aGV5IGFyZSBsb2FkZWQg\nYmFjazsgZG9uJ3QgY2hhbmdlIHRoZSBtYXJrZXIgcG9zaXRpb24KICAgICAg\nICAgICAgaWYgKHBrID09IG51bGwpCiAgICAgICAgICAgICAgICBwayA9IChv\nYmogaW5zdGFuY2VvZiBDb2x1bW4gJiYgKChDb2x1bW4pIG9iaikuaXNQcmlt\nYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUg\nOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBpZiAocGsuYm9vbGVhblZh\nbHVlKCkpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSBfcG9zIC0g\nMTsgaSA+PSAwICYmIGkgPj0gX3BvcyAtIDM7IGktLSkKICAgICAgICAgICAg\nICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5nZXQoaSkuZXF1YWxzKG9iaikp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gc2VhcmNoIGZvcndhcmQgb24gdGhl\nIGFzc3VtcHRpb24gdGhhdCB3ZSBtaWdodCBiZSBza2lwcGluZwogICAgICAg\nICAgICAvLyBzZWxlY3RzIGZvciBzaWJsaW5nIGNsYXNzZXM7IGFkdmFuY2Ug\ndGhlIHBvc2l0aW9uIGlmIHdlIGZpbmQKICAgICAgICAgICAgLy8gc29tZXRo\naW5nIGZvcndhcmQKICAgICAgICAgICAgZm9yIChpbnQgaSA9IF9wb3MgKyAx\nOyBpIDwgX3NlbC5fc2VsZWN0cy5zaXplKCk7IGkrKykgewogICAgICAgICAg\nICAgICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmopKSB7\nCiAgICAgICAgICAgICAgICAgICAgX3BvcyA9IGk7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuICsrX3BvczsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbWF5YmUgdGhlIGNvbHVtbiB3YXMg\nc2VsZWN0ZWQgYnkgMiBkaWZmZXJlbnQgbWFwcGluZ3MsIHNvIGl0J3MKICAg\nICAgICAgICAgLy8gc29tZXdoZXJlIHByaW9yIHRvIHRoZSBjdXJyZW50IHBv\nc2l0aW9uOyBpbiB0aGlzIGNhc2UgbGVhdmUgdGhlCiAgICAgICAgICAgIC8v\nIHBvc2l0aW9uIG1hcmtlciBhdCBpdHMgY3VycmVudCBwbGFjZSBjYXVzZSBz\ndWJzZXF1ZW50IGxvYWRzIHdpbGwKICAgICAgICAgICAgLy8gc3RpbGwgcHJv\nYmFibHkgc3RhcnQgZnJvbSB0aGVyZQogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9wb3M7IGkrKykKICAgICAgICAgICAgICAgIGlmIChfc2Vs\nLl9zZWxlY3RzLmdldChpKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gaSArIDE7CgogICAgICAgICAgICAvLyBzb21ldGhpbmdz\nJ3Mgd3JvbmcuLi4KICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlv\nbihvYmoudG9TdHJpbmcoKSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZXR1cm4gdGhlIGpvaW5zIHRvIHVzZSB0byBmaW5kIGNvbHVt\nbiBkYXRhLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgUGF0aEpvaW5z\nIGdldEpvaW5zKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgICAgIFBhdGhKb2lu\ncyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwogICAgICAgICAgICBpZiAocGog\nIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBwajsKICAgICAgICAgICAgcmV0dXJuIGdldFByZUpvaW5zKCk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhl\nIHByZSBqb2lucyBmb3IgdGhlIHJlc3VsdCwgb3IgbnVsbCBpZiBub25lLiBO\nb3RlIHRoYXQKICAgICAgICAgKiB3ZSBoYXZlIHRvIHRha2UgdGhlIFNlbGVj\ndCdzIHByZSBqb2lucyBpbnRvIGFjY291bnQgdG9vLCBzaW5jZQogICAgICAg\nICAqIGJhdGNoZWQgc2VsZWN0cyBjYW4gaGF2ZSBhZGRpdGlvbmFsIHByZSBq\nb2lucyBvbiB0aGUgc3RhY2sgZXZlbgogICAgICAgICAqIG9uIGV4ZWN1dGlv\nbi4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIFBhdGhKb2lucyBnZXRQ\ncmVKb2lucygpIHsKICAgICAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxs\nICYmICFfcHJlSm9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIChQYXRoSm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CiAgICAgICAgICAg\nIGlmIChfc2VsLl9wcmVKb2lucyAhPSBudWxsICYmICFfc2VsLl9wcmVKb2lu\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gKFBhdGhKb2lu\ncykgX3NlbC5fcHJlSm9pbnMucGVlaygpOwogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVy\nbiB0aGUgYWxpYXMgdXNlZCB0byBrZXkgb24gdGhlIGNvbHVtbiBkYXRhLCBj\nb25zaWRlcmluZyB0aGUKICAgICAgICAgKiBnaXZlbiBqb2lucy4KICAgICAg\nICAgKi8KICAgICAgICBwcml2YXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhD\nb2x1bW4gY29sLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICAgICAgU3RyaW5n\nIGFsaWFzOwogICAgICAgICAgICBpZiAoX3NlbC5fZnJvbSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBhbGlhcyA9IF9zZWwudG9BbGlhcyhfc2VsLl9m\ncm9tLmdldFRhYmxlSW5kZXgKICAgICAgICAgICAgICAgICAgICAoY29sLmdl\ndFRhYmxlKCksIHBqLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgaWYgKGFs\naWFzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgICAgICBpZiAoX3NlbC5fZGljdC5yZXF1aXJlc0FsaWFz\nRm9yU3Vic2VsZWN0KQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGUk9N\nX1NFTEVDVF9BTElBUyArICIuIiArIGFsaWFzICsgIl8iICsgY29sOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGFsaWFzICsgIl8iICsgY29sOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGFsaWFzID0gX3NlbC50b0FsaWFzKF9zZWwu\nZ2V0VGFibGVJbmRleChjb2wuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSk7CiAg\nICAgICAgICAgIHJldHVybiAoYWxpYXMgPT0gbnVsbCkgPyBudWxsIDogYWxp\nYXMgKyAiLiIgKyBjb2w7CiAgICAgICAgfQoKICAgICAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gUGF0aEpvaW5zIGltcGxl\nbWVudGF0aW9uCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBpc0RpcnR5KCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgoKSB7\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIEpvaW5TZXQgam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBqb2luQ291bnQo\nKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NK\nb2luKFRhYmxlIGxvY2FsVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZv\ncmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3Jl\naWduS2V5IGZrLCAKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwg\naW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkuam9pblJl\nbGF0aW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIAogICAgICAgICAgICAg\nICAgaW52ZXJzZSwgdG9NYW55KTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBKb2lucyBvdXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWln\nbktleSBmaywKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50\nIHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkub3V0ZXJKb2lu\nUmVsYXRpb24obmFtZSwgZmssIHRhcmdldCwgc3VicywKICAgICAgICAgICAg\nICAgIGludmVyc2UsIHRvTWFueSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAgICAg\nICBpZiAodmFyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkuc2V0\nVmFyaWFibGUodmFyKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgICAgIGlm\nIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLnNldFN1\nYnNlbGVjdChhbGlhcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQmFzZSBqb2lucyBpbXBsZW1lbnRhdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgUGF0aEpvaW5zSW1wbAogICAgICAgIGltcGxl\nbWVudHMgUGF0aEpvaW5zIHsKCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZ0J1\nZmZlciBwYXRoID0gbnVsbDsKICAgICAgICBwcm90ZWN0ZWQgU3RyaW5nIHZh\nciA9IG51bGw7CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcikgewog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAgIHJldHVybiB2\nYXIgIT0gbnVsbCB8fCBwYXRoICE9IG51bGw7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBwYXRoOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5TZXQg\nam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgICAg\nIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgbnVs\nbEpvaW5zKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNl\ndFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgdGhpcy52YXIg\nPSB2YXI7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIEpvaW5zIHNldFN1YnNlbGVjdChTdHJpbmcgYWxpYXMp\nIHsKICAgICAgICAgICAgaWYgKCFhbGlhcy5lbmRzV2l0aCgiOiIpKQogICAg\nICAgICAgICAgICAgYWxpYXMgKz0gJzonOwogICAgICAgICAgICBhcHBlbmQo\nYWxpYXMpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5z\nIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFi\nbGUpIHsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZh\nciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBh\ncHBlbmQodmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9p\nbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwg\nYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAg\nICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlv\nbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZChuYW1lKTsK\nICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51\nbGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1l\nLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFy\nZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgICAgICBhcHBlbmQobmFtZSk7CiAgICAgICAgICAgIGFw\ncGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2\nb2lkIGFwcGVuZChTdHJpbmcgc3RyKSB7CiAgICAgICAgICAgIGlmIChzdHIg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHBhdGggPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBwYXRoID0gbmV3IFN0cmluZ0J1ZmZlcihz\ndHIpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIHBhdGguYXBwZW5kKCcuJykuYXBwZW5kKHN0cik7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7\nCiAgICAgICAgICAgIHJldHVybiAiUGF0aEpvaW5zSW1wbDwiICsgaGFzaENv\nZGUoKSArICI+OiAiCiAgICAgICAgICAgICAgICArIFN0cmluZy52YWx1ZU9m\nKHBhdGgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEpvaW5z\nIGltcGxlbWVudGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBTZWxlY3RKb2lucwogICAgICAgIGV4dGVuZHMgUGF0aEpvaW5zSW1w\nbCAKICAgICAgICBpbXBsZW1lbnRzIENsb25lYWJsZSB7CgogICAgICAgIHBy\naXZhdGUgZmluYWwgU2VsZWN0SW1wbCBfc2VsOwogICAgICAgIHByaXZhdGUg\nSm9pblNldCBfam9pbnMgPSBudWxsOwogICAgICAgIHByaXZhdGUgYm9vbGVh\nbiBfb3V0ZXIgPSBmYWxzZTsKICAgICAgICBwcml2YXRlIGludCBfY291bnQg\nPSAwOwoKICAgICAgICBwdWJsaWMgU2VsZWN0Sm9pbnMoU2VsZWN0SW1wbCBz\nZWwpIHsKICAgICAgICAgICAgX3NlbCA9IHNlbDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfb3V0ZXI7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpv\naW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAgX291\ndGVyID0gb3V0ZXI7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmlzRGlydHkoKSB8fCAhaXNFbXB0eSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5TZXQgam9pbnMoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfam9pbnM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzZXRKb2lucyhKb2luU2V0IGpvaW5zKSB7CiAgICAgICAg\nICAgIF9qb2lucyA9IGpvaW5zOwogICAgICAgICAgICBfb3V0ZXIgPSBqb2lu\ncyAhPSBudWxsICYmIGpvaW5zLmxhc3QoKSAhPSBudWxsCiAgICAgICAgICAg\nICAgICAmJiBqb2lucy5sYXN0KCkuZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9P\nVVRFUjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50\nKCkgewogICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gX2NvdW50OwogICAgICAgICAgICByZXR1cm4gTWF0\naC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgpKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAgICAgICAgICAgaWYg\nKF9qb2lucyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NvdW50ID0gTWF0\naC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgpKTsKICAgICAgICAgICAgX2pv\naW5zID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiBfam9pbnMgPT0gbnVs\nbCB8fCBfam9pbnMuaXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxlLCBUYWJsZSBm\nb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgLy8gY3Jvc3Mgam9pbnMgYXJl\nIGZvciB1bmJvdW5kIHZhcmlhYmxlczsgdW5mb3J0dW5hdGVseSB3ZSBoYXZl\nCiAgICAgICAgICAgIC8vIHRvIGFsd2F5cyBnbyBESVNUSU5DVCBmb3IgdW5i\nb3VuZCB2YXJzIGJlY2F1c2UgdGhlcmUgYXJlIGNlcnRhaW4KICAgICAgICAg\nICAgLy8gY2FzZXMgdGhhdCByZXF1aXJlIGl0LCBhbmQgd2UgY2FuJ3QgZGlm\nZmVyZW50aWF0ZSB0aGVtIGZyb20gdGhlCiAgICAgICAgICAgIC8vIGNhc2Vz\nIHRoYXQgZG9uJ3QKICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gSU1QTElD\nSVRfRElTVElOQ1Q7CgogICAgICAgICAgICBpZiAoX3NlbC5nZXRKb2luU3lu\ndGF4KCkgIT0gSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5MgogICAgICAgICAg\nICAgICAgfHwgX3NlbC5fZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAvLyBkb24ndCBtYWtlIGFueSBqb2lucywgYnV0IHVwZGF0ZSB0aGUgcGF0\naCBpZiBhIHZhcmlhYmxlCiAgICAgICAgICAgICAgICAvLyBoYXMgYmVlbiBz\nZXQKICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kKHRoaXMudmFyKTsKICAg\nICAgICAgICAgICAgIHRoaXMudmFyID0gbnVsbDsKICAgICAgICAgICAgICAg\nIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRvbid0IGxldCB0aGUg\nZ2V0IGFsaWFzIG1ldGhvZHMgc2VlIHRoYXQgYSB2YXIgaGFzIGJlZW4gc2V0\nCiAgICAgICAgICAgIC8vIHVudGlsIHdlIGdldCBwYXN0IHRoZSBsb2NhbCB0\nYWJsZQogICAgICAgICAgICBTdHJpbmcgdmFyID0gdGhpcy52YXI7CiAgICAg\nICAgICAgIHRoaXMudmFyID0gbnVsbDsKCiAgICAgICAgICAgIGludCBhbGlh\nczEgPSBfc2VsLmdldFRhYmxlSW5kZXgobG9jYWxUYWJsZSwgdGhpcywgdHJ1\nZSk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kKHZhcik7CiAgICAgICAgICAg\nIGludCBhbGlhczIgPSBfc2VsLmdldFRhYmxlSW5kZXgoZm9yZWlnblRhYmxl\nLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAgSm9pbiBqID0gbmV3IEpvaW4o\nbG9jYWxUYWJsZSwgYWxpYXMxLCBmb3JlaWduVGFibGUsIGFsaWFzMiwKICAg\nICAgICAgICAgICAgIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgai5zZXRU\neXBlKEpvaW4uVFlQRV9DUk9TUyk7CgogICAgICAgICAgICBpZiAoX2pvaW5z\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfam9pbnMgPSBuZXcgSm9pblNl\ndCgpOwogICAgICAgICAgICBfam9pbnMuYWRkKGopOwogICAgICAgICAgICBf\nb3V0ZXIgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWduS2V5IGZr\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIHJldHVybiBqb2luKG51bGwsIGZrLCBudWxsLCAtMSwgaW52ZXJzZSwg\ndG9NYW55LCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9p\nbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwg\nYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4obnVs\nbCwgZmssIG51bGwsIC0xLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJp\nbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAgICAgICAgIENsYXNzTWFw\ncGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xl\nYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBqb2luKG5hbWUsIGZr\nLCB0YXJnZXQsIHN1YnMsIGludmVyc2UsIHRvTWFueSwgZmFsc2UpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9u\nKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAgICBDbGFz\nc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBi\nb29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gam9pbihuYW1l\nLCBmaywgdGFyZ2V0LCBzdWJzLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwog\nICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBKb2lucyBqb2luKFN0cmluZyBu\nYW1lLCBGb3JlaWduS2V5IGZrLCBDbGFzc01hcHBpbmcgdGFyZ2V0LAogICAg\nICAgICAgICBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSwgYm9vbGVhbiBvdXRlcikgewogICAgICAgICAgICAvLyBkb24ndCBs\nZXQgdGhlIGdldCBhbGlhcyBtZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBi\nZWVuIHNldAogICAgICAgICAgICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUg\nbG9jYWwgdGFibGUKICAgICAgICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFy\nOwogICAgICAgICAgICB0aGlzLnZhciA9IG51bGw7CgogICAgICAgICAgICAv\nLyBnZXQgZmlyc3QgdGFibGUgYWxpYXMgYmVmb3JlIHVwZGF0aW5nIHBhdGg7\nIGlmIHRoZXJlIGlzIGEgZnJvbQogICAgICAgICAgICAvLyBzZWxlY3QgdGhl\nbiB3ZSBzaG91bGRuJ3QgYWN0dWFsbHkgY3JlYXRlIGEgam9pbiBvYmplY3Qs\nIHNpbmNlCiAgICAgICAgICAgIC8vIHRoZSBqb2lucyB3aWxsIGFsbCBiZSBk\nb25lIGluIHRoZSBmcm9tIHNlbGVjdAogICAgICAgICAgICBib29sZWFuIGNy\nZWF0ZUpvaW4gPSBfc2VsLl9mcm9tID09IG51bGw7CiAgICAgICAgICAgIFRh\nYmxlIHRhYmxlMSA9IG51bGw7CiAgICAgICAgICAgIGludCBhbGlhczEgPSAt\nMTsKICAgICAgICAgICAgaWYgKGNyZWF0ZUpvaW4pIHsKICAgICAgICAgICAg\nICAgIHRhYmxlMSA9IChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlUYWJs\nZSgpIDogZmsuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIGFsaWFzMSA9\nIF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTEsIHRoaXMsIHRydWUpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyB1cGRhdGUgdGhlIHBhdGggd2l0\naCB0aGUgcmVsYXRpb24gbmFtZSBiZWZvcmUgZ2V0dGluZyBwayBhbGlhcwog\nICAgICAgICAgICB0aGlzLmFwcGVuZChuYW1lKTsKICAgICAgICAgICAgdGhp\ncy5hcHBlbmQodmFyKTsKICAgICAgICAgICAgaWYgKHRvTWFueSkgewogICAg\nICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7\nCiAgICAgICAgICAgICAgICBfc2VsLl9mbGFncyB8PSBUT19NQU5ZOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIF9vdXRlciA9IG91dGVyOwoKICAgICAg\nICAgICAgaWYgKGNyZWF0ZUpvaW4pIHsKICAgICAgICAgICAgICAgIFRhYmxl\nIHRhYmxlMiA9IChpbnZlcnNlKSA/IGZrLmdldFRhYmxlKCkgCiAgICAgICAg\nICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5VGFibGUoKTsKICAgICAg\nICAgICAgICAgIGludCBhbGlhczIgPSBfc2VsLmdldFRhYmxlSW5kZXgodGFi\nbGUyLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAgICAgIEpvaW4gaiA9IG5l\ndyBKb2luKHRhYmxlMSwgYWxpYXMxLCB0YWJsZTIsIGFsaWFzMiwgZmssIGlu\ndmVyc2UpOwogICAgICAgICAgICAgICAgai5zZXRUeXBlKChvdXRlcikgPyBK\nb2luLlRZUEVfT1VURVIgOiBKb2luLlRZUEVfSU5ORVIpOwoKICAgICAgICAg\nICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBfam9pbnMgPSBuZXcgSm9pblNldCgpOwogICAgICAgICAgICAgICAgaWYg\nKF9qb2lucy5hZGQoaikgJiYgKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFC\nTEUgCiAgICAgICAgICAgICAgICAgICAgfHwgc3VicyA9PSBTZWxlY3QuU1VC\nU19OT05FKSkKICAgICAgICAgICAgICAgICAgICBqLnNldFJlbGF0aW9uKHRh\ncmdldCwgc3VicywgY2xvbmUoX3NlbCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFNlbGVjdEpvaW5zIGNsb25lKFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAg\nICAgIFNlbGVjdEpvaW5zIHNqID0gbmV3IFNlbGVjdEpvaW5zKHNlbCk7CiAg\nICAgICAgICAgIHNqLnZhciA9IHZhcjsKICAgICAgICAgICAgaWYgKHBhdGgg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNqLnBhdGggPSBuZXcgU3RyaW5n\nQnVmZmVyKHBhdGgudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGlmIChfam9p\nbnMgIT0gbnVsbCAmJiAhX2pvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nICAgIHNqLl9qb2lucyA9IG5ldyBKb2luU2V0KF9qb2lucyk7CiAgICAgICAg\nICAgIHNqLl9vdXRlciA9IF9vdXRlcjsKICAgICAgICAgICAgcmV0dXJuIHNq\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp\nIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnRvU3RyaW5nKCkgKyAiICgi\nICsgX291dGVyICsgIik6ICIgKyBfam9pbnM7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHRvIHRyYWNrIHNlbGVjdGVk\nIGNvbHVtbnMsIHdpdGggZmFzdCBjb250YWlucyBtZXRob2QuCiAgICAgKiBB\nY3RzIGFzIGEgbGlzdCBvZiBzZWxlY3QgaWRzLCB3aXRoIGFkZGl0aW9uYWwg\nbWV0aG9kcyB0byBtYW5pcHVsYXRlCiAgICAgKiB0aGUgYWxpYXMgb2YgZWFj\naCBzZWxlY3RlZCBpZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xh\nc3MgU2VsZWN0cwogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RMaXN0IHsKCiAg\nICAgICAgcHJpdmF0ZSBMaXN0IF9pZHMgPSBudWxsOwogICAgICAgIHByaXZh\ndGUgTGlzdCBfaWRlbnRzID0gbnVsbDsKICAgICAgICBwcml2YXRlIE1hcCBf\nYWxpYXNlcyA9IG51bGw7CiAgICAgICAgcHJpdmF0ZSBNYXAgX3NlbGVjdEFz\nID0gbnVsbDsKCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIGFsbCBhbGlh\nc2VzIGZyb20gYW5vdGhlciBpbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgdm9pZCBhZGRBbGwoU2VsZWN0cyBzZWxzKSB7CiAgICAgICAg\nICAgIGlmIChfaWRzID09IG51bGwgJiYgc2Vscy5faWRzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfaWRzID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZHMp\nOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9pZHMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9pZHMuYWRkQWxsKHNlbHMuX2lkcyk7CgogICAgICAg\nICAgICBpZiAoX2lkZW50cyA9PSBudWxsICYmIHNlbHMuX2lkZW50cyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX2lkZW50cyA9IG5ldyBBcnJheUxpc3Qo\nc2Vscy5faWRlbnRzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5faWRl\nbnRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRlbnRzLmFkZEFsbChz\nZWxzLl9pZGVudHMpOwoKICAgICAgICAgICAgaWYgKF9hbGlhc2VzID09IG51\nbGwgJiYgc2Vscy5fYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2FsaWFzZXMgPSBuZXcgSGFzaE1hcChzZWxzLl9hbGlhc2VzKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoc2Vscy5fYWxpYXNlcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2FsaWFzZXMucHV0QWxsKHNlbHMuX2FsaWFzZXMpOwoKICAg\nICAgICAgICAgaWYgKF9zZWxlY3RBcyA9PSBudWxsICYmIHNlbHMuX3NlbGVj\ndEFzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMgPSBuZXcg\nSGFzaE1hcChzZWxzLl9zZWxlY3RBcyk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKHNlbHMuX3NlbGVjdEFzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc2Vs\nZWN0QXMucHV0QWxsKHNlbHMuX3NlbGVjdEFzKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGFsaWFzIG9mIGEgZ2l2\nZW4gaWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRB\nbGlhcyhPYmplY3QgaWQpIHsKICAgICAgICAgICAgcmV0dXJuIChfYWxpYXNl\ncyA9PSBudWxsKSA/IG51bGwgOiBfYWxpYXNlcy5nZXQoaWQpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBh\nIGdpdmVuIGlkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgc2V0\nQWxpYXMoT2JqZWN0IGlkLCBPYmplY3QgYWxpYXMsIGJvb2xlYW4gaWRlbnQp\nIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgX2lkcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAg\nIF9hbGlhc2VzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaW50IGlkeDsKICAgICAgICAgICAgaWYgKF9hbGlhc2VzLnB1\ndChpZCwgYWxpYXMpICE9IG51bGwpCiAgICAgICAgICAgICAgICBpZHggPSBf\naWRzLmluZGV4T2YoaWQpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIF9pZHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgIGlkeCA9IF9p\nZHMuc2l6ZSgpIC0gMTsKCiAgICAgICAgICAgICAgICBpZiAoaWRlbnQpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX2lkZW50cyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICBfaWRlbnRzID0gbmV3IEFycmF5TGlzdCgz\nKTsKICAgICAgICAgICAgICAgICAgICBfaWRlbnRzLmFkZChpZCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIGlkeDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCBh\nbiBhbGlhcyBmb3IgYSBnaXZlbiBpbmRleC4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgdm9pZCBzZXRBbGlhcyhpbnQgaWR4LCBPYmplY3QgYWxpYXMp\nIHsKICAgICAgICAgICAgT2JqZWN0IGlkID0gX2lkcy5nZXQoaWR4KTsKICAg\nICAgICAgICAgX2FsaWFzZXMucHV0KGlkLCBhbGlhcyk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBJbnNlcnQgYW4gYWxpYXMgYmVmb3Jl\nIHRoZSBnaXZlbiBpbmRleCwgdXNpbmcgbmVnYXRpdmUgaW5kZXhlcwogICAg\nICAgICAqIHRvIGNvdW50IGJhY2t3YXJkcy4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgdm9pZCBpbnNlcnRBbGlhcyhpbnQgaWR4LCBPYmplY3QgaWQs\nIE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBfYWxpYXNlcy5wdXQoaWQs\nIGFsaWFzKTsKICAgICAgICAgICAgaWYgKGlkeCA+PSAwKQogICAgICAgICAg\nICAgICAgX2lkcy5hZGQoaWR4LCBpZCk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIF9pZHMuYWRkKF9pZHMuc2l6ZSgpICsgaWR4LCBpZCk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhl\nIGluZGV4IG9mIHRoZSBnaXZlbiBhbGlhcy4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgaW50IGluZGV4T2ZBbGlhcyhPYmplY3QgYWxpYXMpIHsKICAg\nICAgICAgICAgaWYgKF9hbGlhc2VzID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gLTE7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX2lkcy5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgIGlmIChhbGlhcy5l\ncXVhbHMoX2FsaWFzZXMuZ2V0KF9pZHMuZ2V0KGkpKSkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEEgbGlzdCByZXByZXNl\nbnRhdGlvbiBvZiB0aGUgYWxpYXNlcywgaW4gc2VsZWN0IG9yZGVyLCB3aXRo\nCiAgICAgICAgICogQVMgYWxpYXNlcyBwcmVzZW50LgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyBMaXN0IGdldEFsaWFzZXMoZmluYWwgYm9vbGVhbiBp\nZGVudCwgZmluYWwgYm9vbGVhbiBpbm5lcikgewogICAgICAgICAgICBpZiAo\nX2lkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLkVNUFRZX0xJU1Q7CgogICAgICAgICAgICByZXR1cm4gbmV3IEFic3Ry\nYWN0TGlzdCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgp\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGlkZW50ICYmIF9pZGVu\ndHMgIT0gbnVsbCkgPyBfaWRlbnRzLnNpemUoKQogICAgICAgICAgICAgICAg\nICAgICAgICA6IF9pZHMuc2l6ZSgpOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpKSB7CiAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0IGlkID0gKGlkZW50ICYmIF9pZGVudHMg\nIT0gbnVsbCkgPyBfaWRlbnRzLmdldChpKQogICAgICAgICAgICAgICAgICAg\nICAgICA6IF9pZHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgICAgIE9iamVj\ndCBhbGlhcyA9IF9hbGlhc2VzLmdldChpZCk7CiAgICAgICAgICAgICAgICAg\nICAgU3RyaW5nIGFzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAo\naW5uZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGFzID0gKChTdHJpbmcp\nIGFsaWFzKS5yZXBsYWNlKCcuJywgJ18nKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlIGlmIChfc2VsZWN0QXMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgYXMgPSAoU3RyaW5nKSBfc2VsZWN0QXMuZ2V0KGlkKTsKCiAg\nICAgICAgICAgICAgICAgICAgaWYgKGFzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGlkZW50ICYmIF9pZGVudHMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhczsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGFsaWFzIGluc3RhbmNlb2YgU1FMQnVm\nZmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXMgPSBuZXcg\nU1FMQnVmZmVyKChTUUxCdWZmZXIpIGFsaWFzKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBhcHBlbmQoIiBBUyAiKS5hcHBlbmQoYXMpOwog\nICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBhbGlhcyA9IGFsaWFzICsgIiBBUyAiICsgYXM7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBh\nbGlhczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGF0IGEgZ2l2ZW4g\naWQncyBhbGlhcyBoYXMgYW4gQVMgdmFsdWUuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHZvaWQgc2V0U2VsZWN0QXMoT2JqZWN0IGlkLCBTdHJpbmcg\nYXMpIHsKICAgICAgICAgICAgaWYgKF9zZWxlY3RBcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgX3NlbGVjdEFzID0gbmV3IEhhc2hNYXAoKGludCkgKDUg\nKiAxLjMzICsgMSkpOwogICAgICAgICAgICBfc2VsZWN0QXMucHV0KGlkLCBh\ncyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDbGVhciBh\nbGwgcGxhY2Vob2xkZXJzIGFuZCBzZWxlY3QgQVMgY2xhdXNlcy4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBjbGVhclBsYWNlaG9sZGVycygp\nIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIE9iamVjdCBpZDsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBfaWRzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBpZCA9IGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBpZiAoaWQgaW5zdGFuY2VvZiBQbGFjZWhvbGRl\ncikgewogICAgICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAg\nICAgICAgICAgICAgICBfYWxpYXNlcy5yZW1vdmUoaWQpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBjb250YWlucyhPYmplY3QgaWQpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9hbGlhc2VzICE9IG51bGwgJiYgX2FsaWFzZXMuY29udGFpbnNL\nZXkoaWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXQo\naW50IGkpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9pZHMuZ2V0KGkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAg\nICByZXR1cm4gKF9pZHMgPT0gbnVsbCkgPyAwIDogX2lkcy5zaXplKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAg\nICAgICAgX2lkcyA9IG51bGw7CiAgICAgICAgICAgIF9hbGlhc2VzID0gbnVs\nbDsKICAgICAgICAgICAgX3NlbGVjdEFzID0gbnVsbDsKICAgICAgICAgICAg\nX2lkZW50cyA9IG51bGw7CiAgICAgICAgfQogICAgfQp9CgovKioKICogQ29t\nbW9uIGpvaW5zIGludGVyZmFjZSB1c2VkIGludGVybmFsbHkuIENhbm5vdCBi\nZSBtYWRlIGFuIGlubmVyIGNsYXNzCiAqIGJlY2F1c2UgdGhlIG91dGVyIGNs\nYXNzIChTZWxlY3QpIGhhcyB0byBpbXBsZW1lbnQgaXQuCiAqLwppbnRlcmZh\nY2UgUGF0aEpvaW5zCiAgICBleHRlbmRzIEpvaW5zIHsKCiAgICAvKioKICAg\nICAqIE1hcmsgdGhpcyBhcyBhbiBvdXRlciBqb2lucyBzZXQuCiAgICAgKi8K\nICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcik7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGluc3RhbmNl\nIGhhcyBhIHBhdGgsIGFueSBqb2lucywgb3IgYSB2YXJpYWJsZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSByZWxhdGlvbiBwYXRoIHRyYXZlcnNlZCBieSB0aGVz\nZSBqb2lucywgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nQnVmZmVyIHBhdGgoKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgc2V0IG9mIHtAbGluayBKb2lufSBlbGVtZW50cywgb3IgbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgSm9pblNldCBqb2lucygpOwoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtYXhpbXVtIG51bWJlciBvZiBqb2lu\ncyBjb250YWluZWQgaW4gdGhpcyBpbnN0YW5jZSBhdCBhbnkKICAgICAqIHRp\nbWUuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCk7CgogICAg\nLyoqCiAgICAgKiBOdWxsIHRoZSBzZXQgb2Yge0BsaW5rIEpvaW59IGVsZW1l\nbnRzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKTsKfQoK\n","encoding":"base64"}

