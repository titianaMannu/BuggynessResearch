{"sha":"991c463b14d1eb03eaf4b32cd437bb584e75e30d","node_id":"MDQ6QmxvYjIwNjM2NDo5OTFjNDYzYjE0ZDFlYjAzZWFmNGIzMmNkNDM3YmI1ODRlNzVlMzBk","size":144154,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/991c463b14d1eb03eaf4b32cd437bb584e75e30d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxl\nY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBs\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29u\nZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxv\nZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xh\nc3NBcmdQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuQnl0ZWNvZGVXcml0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuU2VydmljZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuVGVtcG9yYXJ5Q2xhc3NMb2FkZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJ\nZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYXJJZDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkRvdWJsZUlkOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Mb25n\nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RJZDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlNob3J0SWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC5ieXRlY29kZS5CQ0NsYXNzOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5CQ0ZpZWxkOwppbXBvcnQgc2VycC5ieXRlY29kZS5CQ01ldGhvZDsKaW1w\nb3J0IHNlcnAuYnl0ZWNvZGUuQ29kZTsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQ29uc3RhbnRzOwppbXBvcnQgc2VycC5ieXRlY29kZS5FeGNlcHRpb25zOwpp\nbXBvcnQgc2VycC5ieXRlY29kZS5GaWVsZEluc3RydWN0aW9uOwppbXBvcnQg\nc2VycC5ieXRlY29kZS5HZXRGaWVsZEluc3RydWN0aW9uOwppbXBvcnQgc2Vy\ncC5ieXRlY29kZS5JZkluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5JbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSnVtcEluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Mb2FkSW5zdHJ1Y3Rpb247\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLk1ldGhvZEluc3RydWN0aW9uOwppbXBv\ncnQgc2VycC5ieXRlY29kZS5Qcm9qZWN0OwppbXBvcnQgc2VycC5ieXRlY29k\nZS5UYWJsZVN3aXRjaEluc3RydWN0aW9uOwppbXBvcnQgc2VycC51dGlsLk51\nbWJlcnM7CgovKioKICogQnl0ZWNvZGUgZW5oYW5jZXIgdXNlZCB0byBlbmhh\nbmNlIHBlcnNpc3RlbnQgY2xhc3NlcyBmcm9tIG1ldGFkYXRhLiBUaGUKICog\nZW5oYW5jZXIgbXVzdCBiZSBpbnZva2VkIG9uIGFsbCBwZXJzaXN0ZW5jZS1j\nYXBhYmxlIGFuZCBwZXJzaXN0ZW5jZSBhd2FyZQogKiBjbGFzc2VzLgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFBDRW5oYW5j\nZXIgewogICAgLy8gRGVzaWduYXRlcyBhIHZlcnNpb24gZm9yIG1haW50YWlu\naW5nIGNvbXBhdGJpbGl0eSB3aGVuIFBDRW5oYW5jZXIKICAgIC8vIG1vZGlm\naWVzIGVuaGFuY2VtZW50IHRoYXQgY2FuIGJyZWFrIHNlcmlhbGl6YXRpb24g\nb3Igb3RoZXIgY29udHJhY3RzCiAgICAvLyBFYWNoIGVuaGFuY2VkIGNsYXNz\nIHdpbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIHZpYQogICAg\nLy8gcHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigp\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFUl9WRVJTSU9O\nID0gMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX05P\nTkUgPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9B\nV0FSRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVO\nSEFOQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgUFJFID0gInBjIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzIFBDVFlQRSA9IFBlcnNpc3RlbmNlQ2FwYWJsZS5j\nbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBTTSA9IFBS\nRSArICJTdGF0ZU1hbmFnZXIiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nQ2xhc3MgU01UWVBFID0gU3RhdGVNYW5hZ2VyLmNsYXNzOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgU3RyaW5nIElOSEVSSVQgPSBQUkUgKyAiSW5oZXJp\ndGVkRmllbGRDb3VudCI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgQ09OVEVYVE5BTUUgPSAiR2VuZXJpY0NvbnRleHQiOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgQ2xhc3MgVVNFUkVYQ0VQID0gVXNlckV4Y2VwdGlv\nbi5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIElOVEVS\nTkVYQ0VQID0gSW50ZXJuYWxFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBDbGFzcyBIRUxQRVJUWVBFID0gUENSZWdpc3RyeS5j\nbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBTVVBFUiA9\nIFBSRSArICJQQ1N1cGVyY2xhc3MiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgQ2xhc3MgT0lERlNUWVBFID0gRmllbGRTdXBwbGllci5jbGFzczsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIE9JREZDVFlQRSA9IEZpZWxk\nQ29uc3VtZXIuY2xhc3M7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9j\nYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChQ\nQ0VuaGFuY2VyLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEF1\neGlsaWFyeUVuaGFuY2VyW10gX2F1eEVuaGFuY2VyczsKICAgIHN0YXRpYyB7\nCiAgICAgICAgQ2xhc3NbXSBjbGFzc2VzID0gU2VydmljZXMuZ2V0SW1wbGVt\nZW50b3JDbGFzc2VzKAogICAgICAgICAgICBBdXhpbGlhcnlFbmhhbmNlci5j\nbGFzcywgCiAgICAgICAgICAgIEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzLmdl\ndENsYXNzTG9hZGVyKCkpOwogICAgICAgIExpc3QgYXV4RW5oYW5jZXJzID0g\nbmV3IEFycmF5TGlzdChjbGFzc2VzLmxlbmd0aCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhdXhFbmhhbmNlcnMuYWRkKGNs\nYXNzZXNbaV0ubmV3SW5zdGFuY2UoKSk7CgkJICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBhdXggZW5oYW5jZXIgbWF5\nIHJlbHkgb24gbm9uLWV4aXN0YW50IHNwZWMgY2xhc3NlcywgZXRjCgkJICAg\nIH0KCQl9CiAgICAJX2F1eEVuaGFuY2VycyA9IChBdXhpbGlhcnlFbmhhbmNl\ncltdKSBhdXhFbmhhbmNlcnMudG9BcnJheQogICAgICAgICAgICAobmV3IEF1\neGlsaWFyeUVuaGFuY2VyW2F1eEVuaGFuY2Vycy5zaXplKCldKTsKICAgIH0K\nCiAgICBwcml2YXRlIGZpbmFsIEJDQ2xhc3MgX3BjOwogICAgcHJpdmF0ZSBm\naW5hbCBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBm\naW5hbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBM\nb2cgX2xvZzsKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9mYWlsID0gZmFsc2U7CiAgICBwcml2YXRlIEZpbGUg\nX2RpciA9IG51bGw7CiAgICBwcml2YXRlIEJ5dGVjb2RlV3JpdGVyIF93cml0\nZXIgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2JhY2tpbmdGaWVsZHMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTZXQgX3Zpb2xhdGlvbnMgPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9u\nIGFuZCB0eXBlIHRvIGVuaGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0Vu\naGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIENsYXNzIHR5cGUp\nIHsKICAgICAgICB0aGlzKGNvbmYsIG5ldyBQcm9qZWN0KCkubG9hZENsYXNz\nKHR5cGUpLCAoTWV0YURhdGFSZXBvc2l0b3J5KSBudWxsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlv\nbiBhbmQgdHlwZSB0byBlbmhhbmNlLgogICAgICovCiAgICBwdWJsaWMgUENF\nbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzc01ldGFE\nYXRhIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYsIG5ldyBQcm9qZWN0KCku\nbG9hZENsYXNzKHR5cGUuZ2V0RGVzY3JpYmVkVHlwZSgpKSwKICAgICAgICAg\nICAgdHlwZS5nZXRSZXBvc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICoK\nICAgICAqIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSByZXByZXNlbnRhdGlv\nbiBmbyB0aGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsgdGhpcyBjYW4gYmUg\nY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQogICAgICogQHBhcmFt\nIHJlcG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFk\nYXRhIGFjY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJl\ncG9yaXRvcnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBmcm9tIHRoZSBnaXZl\nbiBjb25maWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVmYXVsdAogICAgICog\nYmVjYXVzZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBiZSBhbgogICAgICog\naW1wbGVtZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRh\ndGEKICAgICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRh\ndGEgZmlsZXMKICAgICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIE1l\ndGFEYXRhUmVwb3NpdG9yeSByZXBvcykgewogICAgICAgIF9wYyA9IHR5cGU7\nCiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0\naW9uLkxPR19FTkhBTkNFKTsKCiAgICAgICAgaWYgKHJlcG9zID09IG51bGwp\nIHsKICAgICAgICAgICAgX3JlcG9zID0gY29uZi5uZXdNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICBfcmVwb3Muc2V0U291cmNl\nTW9kZShNZXRhRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsKICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAgX21l\ndGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEodHlwZS5nZXRUeXBlKCksIG51bGws\nIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBT\ndXBwbHkgY29uZmlndXJhdGlvbiwgdHlwZSwgYW5kIG1ldGFkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlv\nbiBjb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgX3BjID0gdHlwZTsKICAgICAgICBfbG9nID0gY29u\nZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwog\nICAgICAgIF9yZXBvcyA9IG1ldGEuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAg\nIF9tZXRhID0gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNsYXNzIGJlaW5n\nIG1hbmlwdWxhdGVkLgogICAgICovCiAgICBwdWJsaWMgQkNDbGFzcyBnZXRC\neXRlY29kZSgpIHsKICAgICAgICByZXR1cm4gX3BjOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNzIGJl\naW5nIG1hbmlwdWxhdGVkLCBvciBudWxsIGlmIG5vdAogICAgICogYSBwZXJz\naXN0ZW50IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRh\nIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbWV0YTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIg\ndGhlIGVuaGFuY2VyIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBjb25z\ndHJ1Y3RvciBpZiBvbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0aGUg\nY2xhc3MuIE9wZW5KUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1hcmcg\nY29uc3RydWN0b3IgKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGlsZXIK\nICAgICAqIG9yIGJ5IHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25zdHJ1\nY3RvcigpIHsKICAgICAgICByZXR1cm4gX2RlZkNvbnM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBl\nbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0\nb3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNz\nLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0\ncnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAg\nKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3IoYm9v\nbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IpIHsKICAgICAgICBfZGVmQ29u\ncyA9IGFkZERlZmF1bHRDb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdG8gZmFpbCBpZiB0aGUgcGVyc2lzdGVudCB0eXBlIHVz\nZXMgcHJvcGVydHkgYWNjZXNzIGFuZAogICAgICogYnl0ZWNvZGUgYW5hbHlz\naXMgc2hvd3MgdGhhdCBpdCBtYXkgYmUgdmlvbGF0aW5nIE9wZW5KUEEncyBw\ncm9wZXJ0eQogICAgICogYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gZ2V0RW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rp\nb25zKCkgewogICAgICAgIHJldHVybiBfZmFpbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gZmFpbCBpZiB0aGUgcGVyc2lzdGVudCB0eXBl\nIHVzZXMgcHJvcGVydHkgYWNjZXNzIGFuZAogICAgICogYnl0ZWNvZGUgYW5h\nbHlzaXMgc2hvd3MgdGhhdCBpdCBtYXkgYmUgdmlvbGF0aW5nIE9wZW5KUEEn\ncyBwcm9wZXJ0eQogICAgICogYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rp\nb25zKGJvb2xlYW4gZmFpbCkgewogICAgICAgIF9mYWlsID0gZmFpbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBiYXNlIGJ1aWxkIGRpcmVjdG9yeSB0\nbyBnZW5lcmF0ZSBjb2RlIHRvLiBUaGUgcHJvcGVyIHBhY2thZ2UKICAgICAq\nIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aCB0aGlzIGRpcmVj\ndG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92ZXJ3cml0aW5nIHRoZSBleGlz\ndGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBG\naWxlIGdldERpcmVjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2RpcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBiYXNlIGJ1aWxkIGRpcmVjdG9yeSB0\nbyBnZW5lcmF0ZSBjb2RlIHRvLiBUaGUgcHJvcGVyIHBhY2thZ2UKICAgICAq\nIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWFlZCBiZW5lYXRoIHRoaXMgZGlyZWN0\nb3J5LiBEZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRpbmcgdGhlIGV4aXN0\naW5nIGNsYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0RGlyZWN0b3J5KEZpbGUgZGlyKSB7CiAgICAgICAgX2RpciA9IGRp\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY3VycmVudCB7\nQGxpbmsgQnl0ZWNvZGVXcml0ZXJ9IHRvIHdyaXRlIHRvIG9yIG51bGwgaWYg\nbm9uZS4KICAgICAqLwogICAgcHVibGljIEJ5dGVjb2RlV3JpdGVyIGdldEJ5\ndGVjb2RlV3JpdGVyKCkgewogICAgICAgIHJldHVybiBfd3JpdGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB7QGxpbmsgQnl0ZWNvZGVXcml0\nZXJ9IHRvIHdyaXRlIHRoZSBieXRlY29kZSB0byBvciBudWxsIGlmIG5vbmUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVjb2RlV3JpdGVyKEJ5\ndGVjb2RlV3JpdGVyIHdyaXRlcikgewogICAgICAgIF93cml0ZXIgPSB3cml0\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGJ5dGVjb2RlIGVu\naGFuY2VtZW50cy4KICAgICAqCiAgICAgKiBAcmV0dXJuIDxjb2RlPkVOSEFO\nQ0VfKjwvY29kZT4gY29uc3RhbnQKICAgICAqLwogICAgcHVibGljIGludCBy\ndW4oKSB7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1zdGFydCIs\nIF9wYy5nZXRUeXBlKCkpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gaWYgbWFuYWdlZCBpbnRlcmZhY2UsIHNraXAKICAgICAgICAgICAgaWYg\nKF9wYy5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIEVO\nSEFOQ0VfSU5URVJGQUNFOwoKICAgICAgICAgICAgLy8gY2hlY2sgaWYgYWxy\nZWFkeSBlbmhhbmNlZAogICAgICAgICAgICBDbGFzc1tdIGludGVyZmFjZXMg\nPSBfcGMuZ2V0RGVjbGFyZWRJbnRlcmZhY2VUeXBlcygpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGludGVyZmFjZXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChpbnRlcmZhY2VzW2ldLmdldE5hbWUo\nKS5lcXVhbHMoUENUWVBFLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYy10eXBlIiwgX3Bj\nLmdldFR5cGUoKSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBFTkhB\nTkNFX05PTkU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIHZhbGlkYXRlIHByb3BlcnRpZXMgYmVmb3JlIHJlcGxh\nY2luZyBmaWVsZCBhY2Nlc3Mgc28gdGhhdAogICAgICAgICAgICAvLyB3ZSBi\ndWlsZCB1cCBhIHJlY29yZCBvZiBiYWNraW5nIGZpZWxkcywgZXRjCiAgICAg\nICAgICAgIGlmIChfbWV0YSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBf\nbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1Nf\nUFJPUEVSVFkpCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVByb3BlcnRpZXMo\nKTsKICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3Mo\nKTsKICAgICAgICAgICAgcHJvY2Vzc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpbnQg\ncmV0ID0gRU5IQU5DRV9QQzsKICAgICAgICAgICAgICAgIGVuaGFuY2VDbGFz\ncygpOwogICAgICAgICAgICAgICAgYWRkRmllbGRzKCk7CiAgICAgICAgICAg\nICAgICBhZGRTdGF0aWNJbml0aWFsaXplcigpOwogICAgICAgICAgICAgICAg\nYWRkUENNZXRob2RzKCk7CiAgICAgICAgICAgICAgICBhZGRBY2Nlc3NvcnMo\nKTsKICAgICAgICAgICAgICAgIGFkZEF0dGFjaERldGFjaENvZGUoKTsKICAg\nICAgICAgICAgICAgIGFkZFNlcmlhbGl6YXRpb25Db2RlKCk7CiAgICAgICAg\nICAgICAgICBhZGRDbG9uaW5nQ29kZSgpOwogICAgICAgICAgICAgICAgcnVu\nQXV4aWxpYXJ5RW5oYW5jZXJzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmV0OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoInBlcnMtYXdhcmUiLCBfcGMuZ2V0VHlwZSgpKSk7CiAgICAgICAgICAg\nIHJldHVybiBFTkhBTkNFX0FXQVJFOwogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogV3JpdGUgdGhlIGdlbmVyYXRlZCBieXRlY29kZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgcmVjb3JkKCkKICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIHJlY29yZChfcGMpOwogICAgICAgIGlm\nIChfb2lkcyAhPSBudWxsKQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IF9vaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAg\nICAgICAgICAgcmVjb3JkKChCQ0NsYXNzKSBpdHIubmV4dCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBnaXZlbiBjbGFzcy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZChCQ0NsYXNzIGJjKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF93cml0ZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgX3dyaXRlci53cml0ZShiYyk7CiAgICAgICAg\nZWxzZSBpZiAoX2RpciA9PSBudWxsKQogICAgICAgICAgICBiYy53cml0ZSgp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBGaWxlIGRpciA9IEZpbGVz\nLmdldFBhY2thZ2VGaWxlKF9kaXIsIGJjLmdldFBhY2thZ2VOYW1lKCksIHRy\ndWUpOwogICAgICAgICAgICBiYy53cml0ZShuZXcgRmlsZShkaXIsIGJjLmdl\ndENsYXNzTmFtZSgpICsgIi5jbGFzcyIpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoZSBtZXRob2RzIGluIHRo\naXMgcHJvcGVydHktYWNjZXNzIGluc3RhbmNlIGFyZQogICAgICogd3JpdHRl\nbiBjb3JyZWN0bHkuIFRoaXMgbWV0aG9kIGFsc28gZ2F0aGVycyBpbmZvcm1h\ndGlvbiBvbiBlYWNoCiAgICAgKiBwcm9wZXJ0eSdzIGJhY2tpbmcgZmllbGQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZVByb3BlcnRpZXMo\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAg\nIEJDTWV0aG9kIGdldHRlciwgc2V0dGVyID0gbnVsbDsKICAgICAgICBCQ0Zp\nZWxkIHJldHVybmVkLCBhc3NpZ25lZCA9IG51bGw7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmICghKGZtZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpIGluc3RhbmNlb2Yg\nTWV0aG9kKSkgewogICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9w\nZXJ0eS1iYWQtbWVtYmVyIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGZtZHNbaV0sIGZtZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpIH0s\nCiAgICAgICAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWV0aCA9IChN\nZXRob2QpIGZtZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgICAg\nICBnZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QobWV0aC5nZXROYW1l\nKCksCiAgICAgICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkp\nOwogICAgICAgICAgICBpZiAoZ2V0dGVyID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktbm8tZ2V0dGVyIiwgbmV3\nIE9iamVjdFtdeyBmbWRzW2ldIH0sCiAgICAgICAgICAgICAgICAgICAgdHJ1\nZSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm5lZCA9IGdldFJldHVybmVkRmllbGQoZ2V0dGVy\nKTsKICAgICAgICAgICAgaWYgKHJldHVybmVkICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmIChfYmFja2luZ0ZpZWxkcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIF9iYWNraW5nRmllbGRzID0gbmV3IEhhc2hNYXAoKTsK\nICAgICAgICAgICAgICAgIF9iYWNraW5nRmllbGRzLnB1dChnZXR0ZXIuZ2V0\nTmFtZSgpLCByZXR1cm5lZC5nZXROYW1lKCkpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBzZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoZ2V0\nU2V0dGVyTmFtZShmbWRzW2ldKSwKICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAg\nICBpZiAoc2V0dGVyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChy\nZXR1cm5lZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkVmlv\nbGF0aW9uKCJwcm9wZXJ0eS1uby1zZXR0ZXIiLAogICAgICAgICAgICAgICAg\nICAgICAgICBuZXcgT2JqZWN0W117IGZtZHNbaV0gfSwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBzeW50aGV0aWMg\nc2V0dGVyCiAgICAgICAgICAgICAgICAgICAgc2V0dGVyID0gX3BjLmRlY2xh\ncmVNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWRzW2ldKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgICAgICAgICAgICAgc2V0\ndGVyLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgICAgICAgICAgQ29kZSBj\nb2RlID0gc2V0dGVyLmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKHJldHVybmVkKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNldHRlciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgYXNzaWduZWQgPSBnZXRBc3NpZ25l\nZEZpZWxkKHNldHRlcik7CgogICAgICAgICAgICBpZiAoYXNzaWduZWQgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9iYWNraW5nRmllbGRzID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2JhY2tpbmdGaWVsZHMgPSBu\nZXcgSGFzaE1hcCgpOwoKICAgICAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBfYmFja2luZ0ZpZWxkcy5wdXQo\nc2V0dGVyLmdldE5hbWUoKSwgYXNzaWduZWQuZ2V0TmFtZSgpKTsKCiAgICAg\nICAgICAgICAgICBpZiAoYXNzaWduZWQgIT0gcmV0dXJuZWQpCiAgICAgICAg\nICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1zZXR0ZXItZ2V0\ndGVyLW1pc21hdGNoIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAgICAgICAg\nICAgICAgIHsgZm1kc1tpXSwgYXNzaWduZWQuZ2V0TmFtZSgpLCAocmV0dXJu\nZWQgPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAgICAgID8gbnVsbCA6\nIHJldHVybmVkLmdldE5hbWUoKSB9LCBmYWxzZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5h\nbWUgb2YgdGhlIHNldHRlciBtZXRob2QgZm9yIHRoZSBnaXZlbiBmaWVsZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFNldHRlck5h\nbWUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gInNldCIg\nKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5lZCBi\neSB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKiBQ\nYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZvciB0ZXN0aW5nLgogICAg\nICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRSZXR1cm5lZEZpZWxkKEJDTWV0\naG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmluZEZpZWxkKG1ldGgsIG5l\ndyBDb2RlKCkueHJldHVybigpLnNldFR5cGUKICAgICAgICAgICAgKG1ldGgu\nZ2V0UmV0dXJuVHlwZSgpKSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBmaWVsZCBhc3NpZ25lZCBpbiB0aGUgZ2l2ZW4gbWV0\naG9kLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3Rl\nZCBhbmQgc3RhdGljIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMg\nQkNGaWVsZCBnZXRBc3NpZ25lZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAg\nICAgICByZXR1cm4gZmluZEZpZWxkKG1ldGgsIG5ldyBDb2RlKCkucHV0Zmll\nbGQoKSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGZpZWxkIHJldHVybmVkIC8gYXNzaWduZWQgYnkgPGNvZGU+bWV0aDwvY29k\nZT4uIFJldHVybnMKICAgICAqIG51bGwgaWYgbm9uLWZpZWxkcyAobWV0aG9k\ncywgbGl0ZXJhbHMsIHBhcmFtZXRlcnMsIHZhcmlhYmxlcykgYXJlCiAgICAg\nKiByZXR1cm5lZCwgb3IgaWYgbm9uLXBhcmFtZXRlcnMgYXJlIGFzc2lnbmVk\nIHRvIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQkNGaWVs\nZCBmaW5kRmllbGQoQkNNZXRob2QgbWV0aCwgSW5zdHJ1Y3Rpb24gdGVtcGxh\ndGUsCiAgICAgICAgYm9vbGVhbiBmaW5kQWNjZXNzZWQpIHsKICAgICAgICAv\nLyBpZ25vcmUgYW55IHN0YXRpYyBtZXRob2RzLiBPcGVuSlBBIG9ubHkgY3Vy\ncmVudGx5IHN1cHBvcnRzIG5vbi1zdGF0aWMKICAgICAgICAvLyBzZXR0ZXJz\nIGFuZCBnZXR0ZXJzCiAgICAgICAgaWYgKG1ldGguaXNTdGF0aWMoKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvZGUgY29kZSA9IG1l\ndGguZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgaWYgKGNvZGUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgY29kZS5iZWZvcmVG\naXJzdCgpOwoKICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gbnVsbCwgY3VyOwog\nICAgICAgIEluc3RydWN0aW9uIHRlbXBsYXRlSW5zLCBwcmV2SW5zLCB0d29Q\ncmV2SW5zOwogICAgICAgIHdoaWxlIChjb2RlLnNlYXJjaEZvcndhcmQodGVt\ncGxhdGUpKSB7CiAgICAgICAgICAgIHRlbXBsYXRlSW5zID0gY29kZS5wcmV2\naW91cygpOwogICAgICAgICAgICBpZiAoIWNvZGUuaGFzUHJldmlvdXMoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBwcmV2\nSW5zID0gY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBpZiAoIWNvZGUu\naGFzUHJldmlvdXMoKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICB0d29QcmV2SW5zID0gY29kZS5wcmV2aW91cygpOwoKICAg\nICAgICAgICAgLy8gaWYgdGhlIG9wY29kZSB0d28gYmVmb3JlIHRoZSB0ZW1w\nbGF0ZSB3YXMgYW4gYWxvYWRfMCwgY2hlY2sKICAgICAgICAgICAgLy8gYWdh\naW5zdCB0aGUgbWlkZGxlIGluc3RydWN0aW9uIGJhc2VkIG9uIHdoYXQgdHlw\nZSBvZiBmaW5kCiAgICAgICAgICAgIC8vIHdlJ3JlIGRvaW5nCiAgICAgICAg\nICAgIGlmICghKHR3b1ByZXZJbnMgaW5zdGFuY2VvZiBMb2FkSW5zdHJ1Y3Rp\nb24pCiAgICAgICAgICAgICAgICB8fCAhKChMb2FkSW5zdHJ1Y3Rpb24pIHR3\nb1ByZXZJbnMpLmlzVGhpcygpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgICAgICAvLyBpZiB0aGUgbWlkZGxlIGluc3RydWN0aW9u\nIHdhcyBhIGdldGZpZWxkLCB0aGVuIGl0J3MgdGhlCiAgICAgICAgICAgIC8v\nIGZpZWxkIHRoYXQncyBiZWluZyBhY2Nlc3NlZAogICAgICAgICAgICBpZiAo\nIWZpbmRBY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3RhbmNlb2YgR2V0RmllbGRJ\nbnN0cnVjdGlvbikKICAgICAgICAgICAgICAgIGN1ciA9ICgoRmllbGRJbnN0\ncnVjdGlvbikgcHJldklucykuZ2V0RmllbGQoKTsKICAgICAgICAgICAgICAg\nIC8vIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2FkXzEs\nIHRoZW4gdGhlCiAgICAgICAgICAgICAgICAvLyBtYXRjaGVkIGluc3RydWN0\naW9uIGlzIHRoZSBmaWVsZCB0aGF0J3MgYmVpbmcgc2V0LgogICAgICAgICAg\nICBlbHNlIGlmIChmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0YW5jZW9m\nIExvYWRJbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgJiYgKChMb2FkSW5z\ndHJ1Y3Rpb24pIHByZXZJbnMpLmdldFBhcmFtKCkgPT0gMCkKICAgICAgICAg\nICAgICAgIGN1ciA9ICgoRmllbGRJbnN0cnVjdGlvbikgdGVtcGxhdGVJbnMp\nLmdldEZpZWxkKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAgICAgaWYgKGZpZWxkICE9IG51bGwg\nJiYgY3VyICE9IGZpZWxkKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgIGZpZWxkID0gY3VyOwoKICAgICAgICAgICAgLy8gcmVh\nZHkgZm9yIG5leHQgc2VhcmNoIGl0ZXJhdGlvbgogICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAg\nIGNvZGUubmV4dCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmllbGQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgYSB2aW9sYXRpb24gb2Yg\ndGhlIHByb3BlcnR5IGFjY2VzcyByZXN0cmljdGlvbnMuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRWaW9sYXRpb24oU3RyaW5nIGtleSwgT2JqZWN0\nW10gYXJncywgYm9vbGVhbiBmYXRhbCkgewogICAgICAgIGlmIChfdmlvbGF0\naW9ucyA9PSBudWxsKQogICAgICAgICAgICBfdmlvbGF0aW9ucyA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAgICAgX3Zpb2xhdGlvbnMuYWRkKF9sb2MuZ2V0KGtl\neSwgYXJncykpOwogICAgICAgIF9mYWlsIHw9IGZhdGFsOwogICAgfQoKICAg\nIC8qKgogICAgICogTG9nIC8gdGhyb3cgcmVjb3JkZWQgcHJvcGVydHkgYWNj\nZXNzIHZpb2xhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm9j\nZXNzVmlvbGF0aW9ucygpIHsKICAgICAgICBpZiAoX3Zpb2xhdGlvbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcgc2Vw\nID0gU3lzdGVtLmdldFByb3BlcnR5KCJsaW5lLnNlcGFyYXRvciIpOwogICAg\nICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfdmlvbGF0aW9ucy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYuYXBwZW5k\nKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VwKTsKICAgICAgICB9CiAg\nICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgicHJvcGVydHktdmlvbGF0\naW9ucyIsIGJ1Zik7CgogICAgICAgIGlmIChfZmFpbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24obXNnKTsKICAgICAgICBpZiAoX2xv\nZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fybihtc2cp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZWQgYWxsIGRpcmVjdCBh\nY2Nlc3MgdG8gbWFuYWdlZCBmaWVsZHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUK\nICAgICAqIHBjR2V0L3BjU2V0IG1ldGhvZC4gTm90ZSB0aGF0IHRoaXMgaW5j\nbHVkZXMgYWNjZXNzIHRvIGZpZWxkcwogICAgICogb3duZWQgYnkgUGVyc2lz\ndGVuY2VDYXBhYmxlIGNsYXNzZXMgb3RoZXIgdGhhbiB0aGlzIG9uZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxk\nQWNjZXNzKCkgewogICAgICAgIC8vIGNyZWF0ZSB0ZW1wbGF0ZSBwdXRmaWVs\nZC9nZXRmaWVsZCBpbnN0cnVjdGlvbnMgdG8gc2VhcmNoIGZvcgogICAgICAg\nIENvZGUgdGVtcGxhdGUgPSBuZXcgQ29kZSgpOwogICAgICAgIEluc3RydWN0\naW9uIHB1dCA9IHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1\nY3Rpb24gZ2V0ID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsKICAgICAgICBJbnN0\ncnVjdGlvbiBzdGF0ID0gdGVtcGxhdGUuaW52b2tlc3RhdGljKCk7CgogICAg\nICAgIC8vIGxvb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsgdGhpcyBpcyBkb25l\nIGJlZm9yZSBhbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAgICAgICAvLyBzbyB3\nZSBkb24ndCBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBzeW50aGV0\naWMgbWV0aG9kcy4KICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAgICAgICAgQ29kZSBjb2RlOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBjb2RlID0gbWV0aG9kc1tpXS5nZXRDb2RlKGZhbHNl\nKTsKCiAgICAgICAgICAgIC8vIGRvbid0IG1vZGlmeSB0aGUgbWV0aG9kcyBz\ncGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMKICAgICAgICAg\nICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAhc2tpcEVuaGFuY2UobWV0aG9kc1tp\nXSkpIHsKICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxk\nQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwgc3RhdCk7CiAgICAgICAgICAgICAg\nICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBwdXQsIGZh\nbHNlLCBzdGF0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlcGxhY2VzIGFsbCBpbnN0cnVjdGlvbnMgbWF0Y2hp\nbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBnaXZlbgogICAgICogY29k\nZSBibG9jayB3aXRoIGNhbGxzIHRvIHRoZSBhcHByb3ByaWF0ZSBnZW5lcmF0\nZWQgZ2V0dGVyL3NldHRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gY29kZSB0\naGUgY29kZSBibG9jayB0byBtb2RpZnk7IHRoZSBjb2RlIGl0ZXJhdG9yIHdp\nbGwKICAgICAqIGJlIHBsYWNlZCBiZWZvcmUgdGhlIGZpcnN0IGluc3RydWN0\naW9uIG9uIG1ldGhvZCBzdGFydCwKICAgICAqIGFuZCB3aWxsIGJlIGFmdGVy\nIHRoZSBsYXN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBjb21wbGV0aW9uCiAg\nICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlvbiB0byBz\nZWFyY2ggZm9yOyBlaXRoZXIgYQogICAgICogZ2V0ZmllbGQgb3IgcHV0Zmll\nbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBnZXQgYm9vbGVhbiBpbmRp\nY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQgaW5zdHJ1Y3Rpb24KICAgICAqIEBw\nYXJhbSBzdGF0IHRlbXBsYXRlIGludm9rZXN0YXRpYyBpbnN0cnVjdGlvbiB0\nbyByZXBsYWNlIHdpdGgKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxh\nY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKENvZGUgY29kZSwgSW5zdHJ1Y3Rp\nb24gaW5zLAogICAgICAgIGJvb2xlYW4gZ2V0LCBJbnN0cnVjdGlvbiBzdGF0\nKSB7CiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICBGaWVs\nZEluc3RydWN0aW9uIGZpOwogICAgICAgIE1ldGhvZEluc3RydWN0aW9uIG1p\nOwogICAgICAgIENsYXNzTWV0YURhdGEgb3duZXI7CiAgICAgICAgU3RyaW5n\nIG5hbWUsIHR5cGVOYW1lLCBtZXRob2ROYW1lOwogICAgICAgIHdoaWxlIChj\nb2RlLnNlYXJjaEZvcndhcmQoaW5zKSkgewogICAgICAgICAgICAvLyBiYWNr\nIHVwIHRvIHRoZSBtYXRjaGVkIGluc3RydWN0aW9uCiAgICAgICAgICAgIGZp\nID0gKEZpZWxkSW5zdHJ1Y3Rpb24pIGNvZGUucHJldmlvdXMoKTsKICAgICAg\nICAgICAgbmFtZSA9IGZpLmdldEZpZWxkTmFtZSgpOwogICAgICAgICAgICB0\neXBlTmFtZSA9IGZpLmdldEZpZWxkVHlwZU5hbWUoKTsKICAgICAgICAgICAg\nb3duZXIgPSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihuYW1lLAogICAg\nICAgICAgICAgICAgZmkuZ2V0RmllbGREZWNsYXJlclR5cGUoKSk7CgogICAg\nICAgICAgICBpZiAob3duZXIgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYg\nb3duZXIuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNT\nX1BST1BFUlRZKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBkaXJl\nY3RseSBhY2Nlc3NpbmcgYSBmaWVsZCBpbiBhbm90aGVyIGNsYXNzCiAgICAg\nICAgICAgICAgICAvLyBoaWVyYXJjaHkgdGhhdCB1c2VzIHByb3BlcnR5IGFj\nY2Vzcywgc29tZXRoaW5nIGlzIHdyb25nCiAgICAgICAgICAgICAgICBpZiAo\nb3duZXIgIT0gX21ldGEgJiYgb3duZXIuZ2V0RGVjbGFyZWRGaWVsZChuYW1l\nKSAhPSBudWxsICYmCiAgICAgICAgICAgICAgICAgICAgX21ldGEgIT0gbnVs\nbCAmJiAhb3duZXIuZ2V0RGVzY3JpYmVkVHlwZSgpLgogICAgICAgICAgICAg\nICAgICAgIGlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgicHJvcGVydHktZmllbGQtYWNjZXNzIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBfbWV0YSwgb3duZXIs\nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmdldE1l\ndGhvZCgpLmdldE5hbWUoKSB9KSk7CgogICAgICAgICAgICAgICAgLy8gaWYg\nd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5nIGEgcHJvcGVydHktYmFja2luZyBm\naWVsZCBvdXRzaWRlCiAgICAgICAgICAgICAgICAvLyB0aGUgcHJvcGVydHkg\naW4gb3VyIG93biBjbGFzcywgbm90aWZ5IHVzZXIKICAgICAgICAgICAgICAg\nIGlmIChpc0JhY2tpbmdGaWVsZE9mQW5vdGhlclByb3BlcnR5KG5hbWUsIGNv\nZGUpKQogICAgICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVy\ndHktZmllbGQtYWNjZXNzIiwgbmV3IE9iamVjdFtdeyBfbWV0YSwKICAgICAg\nICAgICAgICAgICAgICAgICAgb3duZXIsIG5hbWUsIGNvZGUuZ2V0TWV0aG9k\nKCkuZ2V0TmFtZSgpIH0sIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBub3QgcGVyc2lzdGVudCBmaWVsZD8KICAg\nICAgICAgICAgaWYgKG93bmVyID09IG51bGwgfHwgb3duZXIuZ2V0RGVjbGFy\nZWRGaWVsZChuYW1lKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyByZXBsYWNlIHRoZSBpbnN0cnVjdGlvbiB3\naXRoIGEgY2FsbCB0byB0aGUgZ2VuZXJhdGVkIGFjY2VzcwogICAgICAgICAg\nICAvLyBtZXRob2QKICAgICAgICAgICAgbWkgPSAoTWV0aG9kSW5zdHJ1Y3Rp\nb24pIGNvZGUuc2V0KHN0YXQpOwoKICAgICAgICAgICAgLy8gaW52b2tlIHRo\nZSBwcm9wZXIgYWNjZXNzIG1ldGhvZCwgd2hldGhlciBnZXR0ZXIgb3Igc2V0\ndGVyCiAgICAgICAgICAgIFN0cmluZyBwcmVmaXggPSAoZ2V0KSA/IFBSRSAr\nICJHZXQiIDogUFJFICsgIlNldCI7CiAgICAgICAgICAgIG1ldGhvZE5hbWUg\nPSBwcmVmaXggKyBuYW1lOwogICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAg\nICAgICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgIG1ldGhvZE5hbWUsIHR5cGVOYW1l\nLCBuZXcgU3RyaW5nW10KICAgICAgICAgICAgICAgICAgICB7IGdldFR5cGUo\nb3duZXIpLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIG1pLnNldE1ldGhvZChnZXRUeXBlKG93bmVyKS5nZXRO\nYW1lKCksCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZSwgInZvaWQi\nLCBuZXcgU3RyaW5nW10KICAgICAgICAgICAgICAgICAgICB7IGdldFR5cGUo\nb3duZXIpLmdldE5hbWUoKSwgdHlwZU5hbWUgfSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNzZXMgYSBmaWVsZCB0aGF0\nIGlzIGEgYmFja2luZwogICAgICogZmllbGQgb2YgYW5vdGhlciBwcm9wZXJ0\neSBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBjbGFzcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVy\ndHkoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewogICAgICAgIFN0cmluZyBt\nZXRoTmFtZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpOwogICAgICAg\nIHJldHVybiAhIjxpbml0PiIuZXF1YWxzKG1ldGhOYW1lKQogICAgICAgICAg\nICAmJiBfYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAgICAgICAgICAgICYmICFu\nYW1lLmVxdWFscyhfYmFja2luZ0ZpZWxkcy5nZXQobWV0aE5hbWUpKQogICAg\nICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcy5jb250YWluc1ZhbHVlKG5hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1\ncm4gdGhlIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Mgb2YK\nICAgICAqIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZmllbGROYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFt\nIG93bmVyIHRoZSBub21pbmFsIG93bmVyIG9mIHRoZSBmaWVsZAogICAgICog\nQHJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQZXJzaXN0ZW5jZUNhcGFi\nbGUgdHlwZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0aGUgZmllbGQgKGFuZCB0\naGVyZWZvcmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9kKSwgb3IgbnVsbCBpZiBu\nb25lCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRQZXJz\naXN0ZW5jZUNhcGFibGVPd25lcihTdHJpbmcgZmllbGROYW1lLAogICAgICAg\nIENsYXNzIG93bmVyKSB7CiAgICAgICAgLy8gZmluZCB0aGUgYWN0dWFsIGFu\nY2VzdG9yIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhlIGZpZWxkLCB0aGVuCiAg\nICAgICAgLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlzIHBlcnNpc3RlbnQsIGFu\nZCBpZiB0aGUgZmllbGQgaXMgbWFuYWdlZAogICAgICAgIGZvciAoOyAhb3du\nZXIuZ2V0TmFtZSgpLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgb3duZXIgPSBvd25lci5nZXRTdXBlcmNsYXNzKCkpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG93bmVyLmdldERl\nY2xhcmVkRmllbGQoZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvd25lci5nZXROYW1lKCku\nZXF1YWxzKE9iamVjdC5jbGFzcy5nZXROYW1lKCkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gbWFuYWdlZCBpbnRlcmZhY2UKICAg\nICAgICBpZiAoX21ldGEgIT0gbnVsbCAmJiBfbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgcmV0dXJuIF9tZXRh\nOwoKICAgICAgICByZXR1cm4gX3JlcG9zLmdldE1ldGFEYXRhKG93bmVyLCBu\ndWxsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFsbCBz\neW50aGV0aWMgbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGUgYnkgZGVsZWdhdGlu\nZyB0bwogICAgICogdGhlIHZhcmlvdXMgYWRkWFhYTWV0aG9kcyAoKSBmdW5j\ndGlvbnMgaW4gdGhpcyBjbGFzcy4gSW5jbHVkZXMKICAgICAqIGFsbCBzdGF0\naWMgZmllbGQgYWNjZXNzIG1ldGhvZHMuCiAgICAgKiBOb3RlIHRoYXQgdGhl\nICdzdG9jaycgbWV0aG9kcyBsaWtlIDxjb2RlPnBjSXNUcmFuc2FjdGlvbmFs\nPC9jb2RlPiwKICAgICAqIDxjb2RlPnBjRmV0Y2hPYmplY3RJZDwvY29kZT4s\nIGV0YyBhcmUgZGVmaW5lZCBvbmx5IGluIHRoZQogICAgICogbGVhc3QtZGVy\naXZlZCBQZXJzaXN0ZW5jZUNhcGFibGUgdHlwZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZFBDTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgYWRkQ2xlYXJGaWVsZHNNZXRo\nb2QoKTsKICAgICAgICBhZGROZXdJbnN0YW5jZU1ldGhvZCh0cnVlKTsKICAg\nICAgICBhZGROZXdJbnN0YW5jZU1ldGhvZChmYWxzZSk7CiAgICAgICAgYWRk\nTWFuYWdlZEZpZWxkQ291bnRNZXRob2QoKTsKICAgICAgICBhZGRSZXBsYWNl\nRmllbGRzTWV0aG9kcygpOwogICAgICAgIGFkZFByb3ZpZGVGaWVsZHNNZXRo\nb2RzKCk7CiAgICAgICAgYWRkQ29weUZpZWxkc01ldGhvZCgpOwoKICAgICAg\nICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCkgewogICAg\nICAgICAgICBhZGRTdG9ja01ldGhvZHMoKTsKICAgICAgICAgICAgYWRkR2V0\nVmVyc2lvbk1ldGhvZCgpOwogICAgICAgICAgICBhZGRSZXBsYWNlU3RhdGVN\nYW5hZ2VyTWV0aG9kKCk7CgogICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikK\nICAgICAgICAgICAgICAgIGFkZE5vT3BBcHBsaWNhdGlvbklkZW50aXR5TWV0\naG9kcygpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHRoZSBhcHAgaWQg\nbWV0aG9kcyB0byBlYWNoIHN1YmNsYXNzIHJhdGhlcgogICAgICAgIC8vIHRo\nYW4ganVzdCB0aGUgc3VwZXJjbGFzcywgc2luY2UgaXQgaXMgcG9zc2libGUg\ndG8gaGF2ZQogICAgICAgIC8vIGEgc3ViY2xhc3Mgd2l0aCBhbiBhcHAgaWQg\naGllcmFyY2h5IHRoYXQgbWF0Y2hlcyB0aGUKICAgICAgICAvLyBwZXJzaXN0\nZW50IGNsYXNzIGluaGVyaXRhbmNlIGhpZXJhcmNoeQogICAgICAgIGlmIChf\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQ\nUExJQ0FUSU9OCiAgICAgICAgICAgICYmIChfbWV0YS5nZXRQQ1N1cGVyY2xh\nc3MoKSA9PSBudWxsIHx8IF9tZXRhLmdldE9iamVjdElkVHlwZSgpCiAgICAg\nICAgICAgICE9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0\nT2JqZWN0SWRUeXBlKCkpKSB7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVs\nZHNUb09iamVjdElkTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAg\nIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7CiAg\nICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2Qo\nZmFsc2UpOwogICAgICAgICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0\naG9kKHRydWUpOwogICAgICAgICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNl\nTWV0aG9kKGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGQgYSBtZXRob2QgdG8gY2xlYXIgYWxsIHBlcnNpc3RlbnQgZmllbGRz\nOyB3ZSdsbCBjYWxsIHRoaXMgZnJvbQogICAgICogdGhlIG5ldyBpbnN0YW5j\nZSBtZXRob2QgdG8gZW5zdXJlIHRoYXQgdW5sb2FkZWQgZmllbGRzIGhhdmUK\nICAgICAqIGRlZmF1bHQgdmFsdWVzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkQ2xlYXJGaWVsZHNNZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHByb3RlY3RlZCB2b2lk\nIHBjQ2xlYXJGaWVsZHMgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVBy\nb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyBzdXBlci5wY0NsZWFyRmllbGRzICgpCiAg\nICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21l\ndGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nKSwgUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywgCiAgICAgICAg\nICAgICAgICBudWxsKTsKICAgICAgICB9CgogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxk\nTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEU6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKDBEKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5MT05HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFkZFNldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgfQoKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnBjTmV3SW5zdGFu\nY2U8L2NvZGU+IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKiBUaGVz\nZSBtZXRob2RzIGFyZSB1c2VkIGJ5IHRoZSBpbXBsIGhlbHBlciB0byBjcmVh\ndGUgbmV3CiAgICAgKiBtYW5hZ2VkIGluc3RhbmNlcyBlZmZpY2llbnRseSB3\naXRob3V0IHJlZmxlY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIG9pZCBz\nZXQgdG8gdHJ1ZSB0byBtaW1pYyB0aGUgbWV0aG9kIHZlcnNpb24gdGhhdCB0\nYWtlcwogICAgICogYW4gb2lkIHZhbHVlIGFzIHdlbGwgYXMgYSBzdGF0ZSBt\nYW5hZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROZXdJbnN0YW5j\nZU1ldGhvZChib29sZWFuIG9pZCkgewogICAgICAgIC8vIHB1YmxpYyBQZXJz\naXN0ZW5jZUNhcGFibGUgcGNOZXdJbnN0YW5jZSAoLi4uKQogICAgICAgIENs\nYXNzW10gYXJncyA9CiAgICAgICAgICAgIChvaWQpID8gbmV3IENsYXNzW117\nIFNNVFlQRSwgT2JqZWN0LmNsYXNzLCBib29sZWFuLmNsYXNzIH0KICAgICAg\nICAgICAgICAgIDogbmV3IENsYXNzW117IFNNVFlQRSwgYm9vbGVhbi5jbGFz\ncyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJOZXdJbnN0YW5jZSIsIFBDVFlQRSwgYXJncyk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAg\nIC8vIGlmIHRoZSB0eXBlIGlzIGFic3RyYWN0LCB0aHJvdyBhIFVzZXJFeGNl\ncHRpb24KICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkgewogICAgICAg\nICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBVU0VSRVhDRVApOwogICAgICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gWFhYIHBjID0gbmV3IFhYWCAoKTsKICAgICAgICBjb2RlLmFuZXco\nKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQu\nY2xhc3MsIG51bGwpOwogICAgICAgIGludCBpbnN0ID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2Fs\nKGluc3QpOwoKICAgICAgICAvLyBpZiAoY2xlYXIpCiAgICAgICAgLy8gICBw\nYy5wY0NsZWFyRmllbGRzICgpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQ\nYXJhbSgob2lkKSA/IDIgOiAxKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24g\nbm9jbGVhciA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywgbnVs\nbCk7CgogICAgICAgIC8vIHBjLnBjU3RhdGVNYW5hZ2VyID0gc207CiAgICAg\nICAgbm9jbGVhci5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldExvY2FsKGlu\nc3QpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwoKICAg\nICAgICAvLyBjb3B5IGtleSBmaWVsZHMgZnJvbSBvaWQKICAgICAgICBpZiAo\nb2lkKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsg\nIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICB9CgogICAgICAgIC8vIHJldHVybiBwYzsKICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUgPGNvZGU+cHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNHZXRN\nYW5hZ2VkRmllbGRDb3VudCAoKTwvY29kZT4KICAgICAqIG1ldGhvZCB0byB0\naGUgYnl0ZWNvZGUsIHJldHVybmluZyB0aGUgaW5oZXJpdGVkIGZpZWxkIGNv\ndW50IGFkZGVkCiAgICAgKiB0byB0aGUgbnVtYmVyIG9mIG1hbmFnZWQgZmll\nbGRzIGluIHRoZSBjdXJyZW50IFBlcnNpc3RlbmNlQ2FwYWJsZSBjbGFzcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE1hbmFnZWRGaWVsZENvdW50\nTWV0aG9kKCkgewogICAgICAgIC8vIHByb3RlY3RlZCBzdGF0aWMgaW50IHBj\nR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0TWFuYWdlZEZpZWxk\nQ291bnQiLAogICAgICAgICAgICBpbnQuY2xhc3MsIG51bGwpOwogICAgICAg\nIG1ldGhvZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgbWV0aG9kLm1ha2VQ\ncm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29k\nZSh0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgcGNJbmhl\ncml0ZWRGaWVsZENvdW50CiAgICAgICAgLy8gYXdoaXRlOiB0aGUgYWJvdmUg\nc2hvdWxkIHdvcmssIGJ1dCBJJ20gc2VlaW5nIGEgbWVzc2VkIHVwIHNpdHVh\ndGlvbgogICAgICAgIC8vIGFsbCBvZiBhIHN1ZGRlbiB3aGVyZSB3aGVuIGEg\nc3ViY2xhc3MgY2FsbHMgdGhpcyBtZXRob2QsIGl0IHNvbWVob3cKICAgICAg\nICAvLyBoYXBwZW5zIGJlZm9yZSA8Y2xpbml0PiBpcyBldmVyIGludm9rZWQs\nIGFuZCBzbyBvdXIKICAgICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291bnQg\nZmllbGQgaXNuJ3QgaW5pdGlhbGl6ZWQhICBzbyBpbnN0ZWFkLAogICAgICAg\nIC8vIHJldHVybiA8ZmllbGRzPiArIDxzdXBlcmNsYXNzPi5wY0dldE1hbmFn\nZWRGaWVsZENvdW50ICgpCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCkubGVuZ3RoKTsKICAgICAg\nICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkgewogICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBl\nKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgUFJFICsgIkdldE1h\nbmFnZWRGaWVsZENvdW50IiwgaW50LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7\nCiAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIH0KICAgICAgICBj\nb2RlLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVy\nc2lzdGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkfSBhbmQKICAgICAqIHtA\nbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNQcm92aWRlRmllbGRzfSBtZXRo\nb2RzIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFByb3ZpZGVGaWVsZHNNZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBw\nY1Byb3ZpZGVGaWVsZCAoaW50IGZpZWxkTnVtYmVyKQogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJQcm92aWRl\nRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsg\naW50LmNsYXNzIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhyb3Vn\naCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVnaW5T\nd2l0Y2hNZXRob2QoUFJFICsgIlByb3ZpZGVGaWVsZCIsIGNvZGUpOwoKICAg\nICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRocm93\nIGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21l\ndGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1kcy5sZW5n\ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAgIGNvZGUu\naWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAgIFRhYmxl\nU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgp\nOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgICAgICB0\nYWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAgICAg\nLy8gPGZpZWxkPiA9IHBjU3RhdGVNYW5hZ2VyLnByb3ZpZGVkPHR5cGU+Rmll\nbGQKICAgICAgICAgICAgLy8gICAgICh0aGlzLCBmaWVsZE51bWJlcik7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBm\nbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAgICAgICAg\nICAgICAgICAgIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAicHJvdmlk\nZWQiLCBmYWxzZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWZhdWx0\nOiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAg\nICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9u\nCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1l\ndGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkfSBhbmQKICAgICAq\nIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmllbGRzfSBt\nZXRob2RzIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFJlcGxhY2VGaWVsZHNNZXRob2RzKCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9p\nZCBwY1JlcGxhY2VGaWVsZCAoaW50IGZpZWxkTnVtYmVyKQogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJSZXBs\nYWNlRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgaW50LmNsYXNzIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhy\nb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVn\naW5Td2l0Y2hNZXRob2QoUFJFICsgIlJlcGxhY2VGaWVsZCIsIGNvZGUpOwoK\nICAgICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRo\ncm93IGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1kcy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAgIGNv\nZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAgIFRh\nYmxlU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3aXRj\naCgpOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgICAg\nICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAg\nICAgLy8gPGZpZWxkPiA9IHBjU3RhdGVNYW5hZ2VyLnJlcGxhY2U8dHlwZT5G\naWVsZAogICAgICAgICAgICAvLyAgKHRoaXMsIGZpZWxkTnVtYmVyKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGhlIGFkZFNldE1hbmFnZWRW\nYWx1ZUNvZGUgY2FsbCBiZWxvdy4KICAgICAgICAgICAgICAgIHRhYmlucy5h\nZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwoK\nICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmlsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAg\nICAgICAgICAgICAgICAgICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwg\nInJlcGxhY2UiLCB0cnVlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgaWYg\nKCFmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLmlzUHJpbWl0aXZlKCkpCiAg\nICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAgICAgICAgIGFk\nZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbiAoKQogICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdl\ndCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAgICAgKGNvZGUsIElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0KCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGFkZE11bHRpcGxlRmllbGRz\nTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0NvcHlGaWVs\nZHN9IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRDb3B5RmllbGRzTWV0aG9kKCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9p\nZCBwY0NvcHlGaWVsZCAoT2JqZWN0IHBjLCBpbnQgZmllbGQpCiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNv\ncHlGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLAog\nICAgICAgICAgICBuZXcgU3RyaW5nW117IF9wYy5nZXROYW1lKCksIGludC5j\nbGFzcy5nZXROYW1lKCkgfSk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0\nZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3\naXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0\naG9kKFBSRSArICJDb3B5RmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYg\nbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24K\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldERlY2xh\ncmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0\nTG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3Ry\ndWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAg\nICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhp\nZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nLy8gPGZpZWxkPiA9IG90aGVyLjxmaWVsZD47CiAgICAgICAgICAgICAgICAv\nLyBvciBzZXQ8ZmllbGQ+IChvdGhlci5nZXQ8ZmllbGQ+KTsKICAgICAgICAg\nICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGFkZFNldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAg\nICAgLy8gYnJlYWs7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0\nYWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAg\nICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwog\nICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQgdGhl\nIGNvZGUgY29tbW9uIHRvIHRoZSBiZWdpbm5pbmcgb2YgYm90aCB0aGUKICAg\nICAqIHBjUmVwbGFjZUZpZWxkIG1ldGhvZCBhbmQgdGhlIHBjUHJvdmlkZUZp\nZWxkIG1ldGhvZC4gVGhpcyBpbmNsdWRlcwogICAgICogY2FsY3VsYXRpbmcg\ndGhlIHJlbGF0aXZlIGZpZWxkIG51bWJlciBvZiB0aGUgZGVzaXJlZCBmaWVs\nZCBhbmQgY2FsbGluZwogICAgICogdGhlIHN1cGVyY2xhc3MgaWYgbmVjZXNz\nYXJ5LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGluZGV4IGluIHdoaWNo\nIHRoZSBsb2NhbCB2YXJpYWJsZSBob2xkaW5nIHRoZSByZWxhdGl2ZQogICAg\nICogZmllbGQgbnVtYmVyIGlzIHN0b3JlZAogICAgICovCiAgICBwcml2YXRl\nIGludCBiZWdpblN3aXRjaE1ldGhvZChTdHJpbmcgbmFtZSwgQ29kZSBjb2Rl\nKSB7CiAgICAgICAgYm9vbGVhbiBjb3B5ID0gKFBSRSArICJDb3B5RmllbGQi\nKS5lcXVhbHMobmFtZSk7CiAgICAgICAgaW50IGZpZWxkTnVtYmVyID0gKGNv\ncHkpID8gMSA6IDA7CgogICAgICAgIC8vIGludCByZWwgPSBmaWVsZE51bWJl\nciAtIHBjSW5oZXJpdGVkRmllbGRDb3VudAogICAgICAgIGludCByZWxMb2Nh\nbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5p\nbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICBjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAg\nICAgY29kZS5pc3ViKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2Nh\nbChyZWxMb2NhbCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJl\nbExvY2FsKTsKCiAgICAgICAgLy8gc3VwZXI6IGlmIChyZWwgPCAwKSBzdXBl\nci5wY1JlcGxhY2VGaWVsZCAoZmllbGROdW1iZXIpOyByZXR1cm47CiAgICAg\nICAgLy8gbm8gc3VwZXI6IGlmIChyZWwgPCAwKSB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uICgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZnZSgpOwogICAgICAgIGlmIChfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBTdHJpbmdb\nXSBhcmdzOwogICAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAgICAg\nICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgZ2V0VHlwZShfbWV0YS5nZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICBnZXRO\nYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0cmluZ1tdeyBpbnQuY2xh\nc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQ\nYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAg\nICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLCBuYW1l\nLCAKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdz\nKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbi5jbGFzcyk7CgogICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLm5vcCgpKTsKICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIGhlbHBlciBtZXRob2QsIGdpdmVuIHRo\nZSBwY1JlcGxhY2VGaWVsZCBvciBwY1Byb3ZpZGVGaWVsZAogICAgICogbWV0\naG9kLCBhZGRzIHRoZSBieXRlY29kZSBmb3IgdGhlIGNvcnJlc3BvbmRpbmcg\nJ3BsdXJhbCcgdmVyc2lvbgogICAgICogb2YgdGhlIG1ldGhvZCAtLSB0aGUg\ndmVyc2lvbiB0aGF0IHRha2VzIGFuIGludFtdIG9mIGZpZWxkcyB0bwogICAg\nICogdG8gYWNjZXNzIHJhdGhlciB0aGFuIGEgc2luZ2xlIGZpZWxkLiBUaGUg\nbXVsdGlwbGUgZmllbGRzIHZlcnNpb24KICAgICAqIHNpbXBseSBsb29wcyB0\naHJvdWdoIHRoZSBwcm92aWRlZCBpbmRleGVzIGFuZCBkZWxlZ2F0ZXMgdG8g\ndGhlCiAgICAgKiBzaW5ndWxhciB2ZXJzaW9uIGZvciBlYWNoIG9uZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE11bHRpcGxlRmllbGRzTWV0aG9k\nVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUpIHsKICAgICAgICBib29sZWFuIGNv\ncHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhzaW5nbGUuZ2V0TmFt\nZSgpKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgPG1ldGhvZD5zIChpbnRb\nXSBmaWVsZHMpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKGNvcHkpID8gbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcywgaW50W10uY2xhc3MgfQogICAgICAg\nICAgICA6IG5ldyBDbGFzc1tdeyBpbnRbXS5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKHNpbmdsZS5nZXRO\nYW1lKCkgKyAicyIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3MpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICBpbnQgZmllbGROdW1iZXJzID0gMDsKICAgICAgICBpbnQgaW5zdCA9\nIDA7CiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgZmllbGROdW1i\nZXJzID0gMTsKCiAgICAgICAgICAgIC8vIFhYWCBvdGhlciA9IChYWFgpIHBj\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfcGMpOwogICAgICAg\nICAgICBpbnN0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAg\nICAgIC8vIGlmIChvdGhlci5wY1N0YXRlTWFuYWdlciAhPSBwY1N0YXRlTWFu\nYWdlcikKICAgICAgICAgICAgLy8JdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbgogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\naW5zdCk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmaW5zID0gY29kZS5pZmFjbXBlcSgpOwogICAgICAgICAgICB0aHJvd0V4\nY2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3Mp\nOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7Cgog\nICAgICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgLy8gIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24K\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwog\nICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsU3RhdGVF\neGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQo\nY29kZS5ub3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBmb3IgKGludCBp\nID0gMDsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAg\nICAgICAgaW50IGlkeCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAg\nICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpZHgpOwogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiB0ZXN0aW5zID0gY29kZS5nbzIoKTsKCiAgICAgICAg\nLy8gPG1ldGhvZD4gKGZpZWxkc1tpXSk7CiAgICAgICAgSW5zdHJ1Y3Rpb24g\nYm9keWlucyA9IGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGlmIChjb3B5KQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGZp\nZWxkTnVtYmVycyk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGlk\neCk7CiAgICAgICAgY29kZS5pYWxvYWQoKTsKICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2luZ2xlKTsKCiAgICAgICAgLy8gaSsr\nOwogICAgICAgIGNvZGUuaWluYygpLnNldEluY3JlbWVudCgxKS5zZXRMb2Nh\nbChpZHgpOwoKICAgICAgICAvLyBpIDwgZmllbGRzLmxlbmd0aAogICAgICAg\nIHRlc3RpbnMuc2V0VGFyZ2V0KGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpZHgp\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXJz\nKTsKICAgICAgICBjb2RlLmFycmF5bGVuZ3RoKCk7CiAgICAgICAgY29kZS5p\nZmljbXBsdCgpLnNldFRhcmdldChib2R5aW5zKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSAnc3RvY2snIG1ldGhvZHMgdG8gdGhlIGJ5\ndGVjb2RlOyB0aGVzZSBpbmNsdWRlIG1ldGhvZHMKICAgICAqIGxpa2Uge0Bs\naW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0ZldGNoT2JqZWN0SWR9CiAgICAg\nKiBhbmQge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0lzVHJhbnNhY3Rp\nb25hbH0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTdG9ja01ldGhv\nZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIC8vIHBjR2V0R2VuZXJpY0NvbnRleHQKICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNsYXJlZE1l\ndGhvZAogICAgICAgICAgICAoImdldCIgKyBDT05URVhUTkFNRSwgKENsYXNz\nW10pIG51bGwpKTsKCiAgICAgICAgLy8gcGNGZXRjaE9iamVjdElkCiAgICAg\nICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChTTVRZUEUuZ2V0\nRGVjbGFyZWRNZXRob2QKICAgICAgICAgICAgKCJmZXRjaE9iamVjdElkIiwg\nKENsYXNzW10pIG51bGwpKTsKCiAgICAgICAgLy8gcGNJc0RlbGV0ZWQKICAg\nICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5n\nZXREZWNsYXJlZE1ldGhvZAogICAgICAgICAgICAoImlzRGVsZXRlZCIsIChD\nbGFzc1tdKSBudWxsKSk7CgogICAgICAgIC8vIHBjSXNEaXJ0eQogICAgICAg\nIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoU01UWVBFLmdldERl\nY2xhcmVkTWV0aG9kCiAgICAgICAgICAgICgiaXNEaXJ0eSIsIChDbGFzc1td\nKSBudWxsKSk7CgogICAgICAgIC8vIHBjSXNOZXcKICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNsYXJlZE1l\ndGhvZAogICAgICAgICAgICAoImlzTmV3IiwgKENsYXNzW10pIG51bGwpKTsK\nCiAgICAgICAgLy8gcGNJc1BlcnNpc3RlbnQKICAgICAgICB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNsYXJlZE1ldGhv\nZAogICAgICAgICAgICAoImlzUGVyc2lzdGVudCIsIChDbGFzc1tdKSBudWxs\nKSk7CgogICAgICAgIC8vIHBjSXNUcmFuc2FjdGlvbmFsCiAgICAgICAgdHJh\nbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChTTVRZUEUuZ2V0RGVjbGFy\nZWRNZXRob2QKICAgICAgICAgICAgKCJpc1RyYW5zYWN0aW9uYWwiLCAoQ2xh\nc3NbXSkgbnVsbCkpOwoKICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAgICAg\nICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChTTVRZUEUuZ2V0\nRGVjbGFyZWRNZXRob2QKICAgICAgICAgICAgKCJzZXJpYWxpemluZyIsIChD\nbGFzc1tdKSBudWxsKSk7CgogICAgICAgIC8vIHBjRGlydHkKICAgICAgICB0\ncmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNs\nYXJlZE1ldGhvZCgiZGlydHkiLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsg\nU3RyaW5nLmNsYXNzIH0pKTsKCiAgICAgICAgLy8gcGNHZXRTdGF0ZU1hbmFn\nZXIKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIkdldFN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlci5jbGFzcywgbnVsbCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5n\nZXRDb2RlKHRydWUpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU3RhdGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIGEgc3RvY2sgbWV0aG9kIHRvIHRo\nZSBieXRlY29kZS4gRWFjaAogICAgICogc3RvY2sgbWV0aG9kIHNpbXBseSBk\nZWxlZ2F0ZXMgdG8gYSBjb3JyZXNwb25kaW5nIFN0YXRlTWFuYWdlciBtZXRo\nb2QuCiAgICAgKiBHaXZlbiB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhvZCwgdGhl\nbiwgdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGl0IGludG8KICAgICAqIHRo\nZSB3cmFwcGVyIG1ldGhvZCB0aGF0IHNob3VsZCBiZSBhZGRlZCB0byB0aGUg\nYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKE1ldGhvZCBtKSB7CiAgICAgICAgLy8g\nZm9ybSB0aGUgbmFtZSBvZiB0aGUgbWV0aG9kIGJ5IHByZXBlbmRpbmcgJ3Bj\nJyB0byB0aGUgc20gbWV0aG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBQUkUg\nKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG0uZ2V0TmFtZSgpKTsKICAgICAg\nICBDbGFzc1tdIHBhcmFtcyA9IG0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAg\nICAgICBDbGFzcyByZXR1cm5UeXBlID0gbS5nZXRSZXR1cm5UeXBlKCk7Cgog\nICAgICAgIC8vIGFkZCB0aGUgbWV0aG9kIHRvIHRoZSBwYwogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKG5hbWUsIHJldHVy\nblR5cGUsIHBhcmFtcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9\nPSBudWxsKSByZXR1cm4gPGRlZmF1bHQ+OwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGlmIChyZXR1\ncm5UeXBlLmVxdWFscyhib29sZWFuLmNsYXNzKSkKICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICBlbHNlIGlm\nICghcmV0dXJuVHlwZS5lcXVhbHModm9pZC5jbGFzcykpCiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS54cmV0\ndXJuKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsKCiAgICAgICAgLy8gcmV0dXJu\nIHBjU3RhdGVNYW5hZ2VyLjxtZXRob2Q+ICg8YXJncz4pOwogICAgICAgIGlm\naW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSk7\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QobSk7\nCiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsK\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjR2V0VmVy\nc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRWZXJzaW9uIiwg\nT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYg\nKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsK\nCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1cm4gbnVsbDsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJuIDx2ZXJzaW9u\nRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0gdG9QcmltaXRp\ndmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3cmFw\ncGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkgewogICAg\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFwcGVyKTsKICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbkZp\nZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZpZWxk\nLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB2ZXJz\naW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfQogICAg\nICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1cm4gcGNTdGF0\nZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlucy5zZXRUYXJn\nZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJn\nZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNpb24g\nZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBvciBudWxsIGlm\nCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJpbWl0aXZlLgog\nICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZlV3JhcHBlcihG\naWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xh\nc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBDaGFyYWN0\nZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAg\nIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9ydC5jbGFzczsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJz\naXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVNYW5hZ2VyfQogICAgICog\nbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKSB7CiAgICAgICAg\nLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVNYW5hZ2VyIChTdGF0ZU1h\nbmFnZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU01UWVBFIH0pOwogICAg\nICAgIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1ZSk7CiAgICAgICAgbWV0\naG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKFNlY3VyaXR5\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2Vy\nICE9IG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1hbmFnZXIgPSBwY1N0YXRl\nTWFuYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VTdGF0ZU1hbmFnZXIiLAog\nICAgICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1tdeyBTTVRZUEUgfSk7CiAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBTZWN1cml0eU1h\nbmFnZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5TWFuYWdlciAoKTsKICAg\nICAgICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAgICAgLy8JCXNlYy5jaGVj\na1Blcm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NUQVRFX01BTkFHRVIpOwog\nICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAgICAgICJnZXRTZWN1cml0\neU1hbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xhc3MsIG51bGwpKTsKCiAg\nICAgICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBpZmlucy5z\nZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2Rl\nLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29k\nZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxl\nIG1ldGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0aW9uCiAgICAgKiBpZGVu\ndGl0eSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBsZW1lbnRhdGlvbnMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09wQXBwbGljYXRpb25JZGVu\ndGl0eU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZz\nLAogICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRz\nVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdeyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVj\ndElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3Mg\nfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAog\nICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERkNU\nWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1Ymxp\nYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0IG9p\nZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7Cgog\nICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNl\nICgpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAg\nICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAo\nT2JqZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9i\namVjdC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQ8\nL2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGlj\nYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRD\nb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxkTWFu\nYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVj\ndElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAgICAgLy8JT2Jq\nZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFuYWdl\ncikgPwogICAgICAgICAgICBuZXcgU3RyaW5nW117IE9JREZTVFlQRS5nZXRO\nYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6\nIG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc2luZ2xlIGZpZWxk\nIGlkZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0aW9uCiAgICAgICAgaWYg\nKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgdGhy\nb3dFeGNlcHRpb24oY29kZSwgSU5URVJORVhDRVApOwogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAg\nICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNUb09i\namVjdElkIiwgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gT2JqZWN0IGlkID0gb2lkOwogICAgICAgIGlmIChm\naWVsZE1hbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgxKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKCiAgICAgICAgaWYgKF9tZXRhLmlzT2JqZWN0SWRUeXBl\nU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkg\naWQpLmdldElkICgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIs\nCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gPG9pZCB0eXBlPiBpZCA9ICg8b2lkIHR5cGU+KSBv\naWQ7CiAgICAgICAgaW50IGlkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgo\nKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRU\neXBlKCk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5\ncGUpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAg\nICAgICAvLyBpbnQgaW5oZXJpdGVkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50\nOwogICAgICAgIGludCBpbmhlcml0ZWQgPSAwOwogICAgICAgIGlmIChmaWVs\nZE1hbmFnZXIpIHsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRG\naWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICBpbmhlcml0\nZWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICBj\nb2RlLmlzdG9yZSgpLnNldExvY2FsKGluaGVyaXRlZCk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBpZC48ZmllbGQ+ID0gZnMuZmV0Y2g8dHlwZT5GaWVsZCAo\nPGluZGV4Pik7IG9yLi4uCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IHBjLjxm\naWVsZD47CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIENsYXNzIHR5cGU7CiAgICAg\nICAgU3RyaW5nIG5hbWU7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAg\nTWV0aG9kIHNldHRlcjsKICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwoaWQpOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0\nTmFtZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJ\nZEZpZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAg\nICAgICAgICAgICBzZXR0ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgZmll\nbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVl\nKTsKICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJs\naWMoZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAgICAgaWYg\nKHJlZmxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29u\nc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKFJlZmxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAi\nZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3Mu\nY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywg\nYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihv\naWRUeXBlLCBuYW1lLCB0eXBlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJl\nZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMoc2V0dGVyLmdldE1vZGlmaWVy\ncygpKTsKICAgICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lk\nVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Nj\nb25zdGFudCgpLnNldENsYXNzKHR5cGUpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0\naW9uLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRTZXR0\nZXIiLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgQ2xhc3Mu\nY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAg\nICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpbmhlcml0ZWQp\nOwogICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZAogICAgICAgICAg\nICAgICAgICAgIChnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKHR5cGUpKTsKCiAg\nICAgICAgICAgICAgICAvLyBpZiB0aGUgdHlwZSBvZiB0aGlzIGZpZWxkIG1l\ndGEgZGF0YSBpcwogICAgICAgICAgICAgICAgLy8gbm9uLXByaW1pdGl2ZSBh\nbmQgbm9uLXN0cmluZywgYmUgc3VyZSB0byBjYXN0CiAgICAgICAgICAgICAg\nICAvLyB0byB0aGUgYXBwcm9wcmlhdGUgdHlwZS4KICAgICAgICAgICAgICAg\nIGlmICghcmVmbGVjdCAmJiAhdHlwZS5pc1ByaW1pdGl2ZSgpCiAgICAgICAg\nICAgICAgICAgICAgJiYgIXR5cGUuZ2V0TmFtZSgpLmVxdWFscyhTdHJpbmcu\nY2xhc3MuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAgICAgLy8gZ2V0IGlkL3Br\nIGZyb20gcGMgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAg\nICAgICAgICAgICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNv\nZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChyZWZsZWN0ICYmIGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24u\nY2xhc3MsICJzZXQiLCAKICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgRmllbGQuY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBl\nIDogT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJl\nZmxlY3QpIHsgCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygp\nLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmplY3Qu\nY2xhc3MsIE1ldGhvZC5jbGFzcywKICAgICAgICAgICAgICAgICAgICAodHlw\nZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChzZXR0ZXIpOwogICAgICAgIH0KICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgY29kZSB0byBleHRyYWN0IHRoZSBpZCBvZiB0\naGUgZ2l2ZW4gcHJpbWFyeSBrZXkgcmVsYXRpb24gZmllbGQgZm9yCiAgICAg\nKiBzZXR0aW5nIGludG8gYW4gb2JqZWN0aWQgaW5zdGFuY2UuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVl\nQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgcGspIHsKICAgICAgICAv\nLyBpZiAodmFsICE9IG51bGwpIAogICAgICAgIC8vICB2YWwgPSAoKFBlcnNp\nc3RlbmNlQ2FwYWJsZSkgdmFsKS5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAg\nICBpbnQgcGMgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChwYyk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\nbnVsbDEgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChwYyk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7IAogICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5j\nbGFzcywKICAgICAgICAgICAgUFJFICsgIkZldGNoT2JqZWN0SWQiLCBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGludCBvaWQgPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9j\nYWwob2lkKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZudWxsMiA9IGNvZGUuaWZudWxs\nKCk7IAoKICAgICAgICAvLyBmb3IgZGF0YXN0b3JlIC8gc2luZ2xlLWZpZWxk\nIGlkZW50aXR5OgogICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkKICAgICAg\nICAvLyAgIHZhbCA9ICgoT3BlbkpQQUlkKSB2YWwpLmdldElkKCk7CiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBwa21ldGEgPSBway5nZXREZWNsYXJlZFR5cGVN\nZXRhRGF0YSgpOwogICAgICAgIGludCBwa2NvZGUgPSBway5nZXRPYmplY3RJ\nZEZpZWxkVHlwZUNvZGUoKTsKICAgICAgICBDbGFzcyBwa3R5cGUgPSBway5n\nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgIGlmIChwa21ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUg\nCiAgICAgICAgICAgICYmIHBrY29kZSA9PSBKYXZhVHlwZXMuTE9ORykgewog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKElkLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKElkLmNs\nYXNzLCAiZ2V0SWQiLCAKICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51\nbGwpOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldElkZW50aXR5VHlw\nZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKSB7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgIH0gZWxz\nZSBpZiAocGttZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAg\nICAgc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5l\ndygpLnNldFR5cGUoQnl0ZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQnl0ZUlk\nLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoQnl0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAg\nICAgICAgICAgICAgICAgICBieXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5CWVRFX09CSikK\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKEJ5dGUuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2J5dGUu\nY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQ2hhcmFjdGVyLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAg\nICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShDaGFySWQuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDaGFySWQuY2xh\nc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0g\nSmF2YVR5cGVzLkNIQVJfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoQ2hhcmFjdGVyLmNsYXNz\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7Y2hhci5jbGFzc30pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXco\nKS5zZXRUeXBlKERvdWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAg\nICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEb3Vi\nbGVJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKERvdWJsZUlkLmNsYXNzLCAiZ2V0SWQiLAog\nICAgICAgICAgICAgICAgICAgICAgICBkb3VibGUuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkRP\nVUJMRV9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChEb3VibGUuY2xhc3MsICI8aW5pdD4iLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tde2RvdWJsZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JK\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoRmxv\nYXQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAg\nICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShGbG9hdElkLmNsYXNzKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoRmxvYXRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgZmxvYXQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkZMT0FUX09CSikKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKEZsb2F0LmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtmbG9hdC5jbGFzc30p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKEludGVnZXIuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoSW50SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChJbnRJZC5jbGFzcywgImdldElkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5JTlRf\nT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoSW50ZWdlci5jbGFzcywgIjxpbml0PiIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7aW50LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKExvbmcuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKExvbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKExvbmdJZC5j\nbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9uZy5j\nbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9\nPSBKYXZhVHlwZXMuTE9OR19PQkopCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChMb25nLmNsYXNzLCAi\nPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdIHtsb25nLmNsYXNzfSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nSE9SVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0\nVHlwZShTaG9ydC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5k\ndXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNob3J0SWQuY2xh\nc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChTaG9ydElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBzaG9ydC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuU0hPUlRfT0JKKQog\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoU2hvcnQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde3Nob3J0\nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRlSWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChEYXRlSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RS\nSU5HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShTdHJpbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZ0lkLmNsYXNz\nLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChP\nYmplY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSBpZiAocGttZXRhLmdldE9iamVjdElkVHlwZSgpICE9IG51bGwp\nIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwa3R5cGUpOwog\nICAgICAgIH0gZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gY29kZS5n\nbzIoKTsKCiAgICAgICAgLy8gaWYgKHZhbCA9PSBudWxsKQogICAgICAgIC8v\nICAgdmFsID0gPGRlZmF1bHQ+OwogICAgICAgIEluc3RydWN0aW9uIGRlZjsK\nICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAg\nICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChieXRl\nKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKChjaGFyKSAwKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMEQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTE9ORzoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBkZWYg\nPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKHNob3J0KSAwKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAg\nICAgICB9CiAgICAgICAgaWZudWxsMS5zZXRUYXJnZXQoZGVmKTsKICAgICAg\nICBpZm51bGwyLnNldFRhcmdldChkZWYpOwogICAgICAgIGdvMi5zZXRUYXJn\nZXQoY29kZS5ub3AoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRo\nZSA8Y29kZT5wY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQ8L2NvZGU+IG1l\ndGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRpb24gaWRl\nbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5S2V5Rmll\nbGRzRnJvbU9iamVjdElkTWV0aG9kKGJvb2xlYW4gZmllbGRNYW5hZ2VyKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAo\nT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBv\naWQpCiAgICAgICAgU3RyaW5nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpIAog\nICAgICAgICAgICA/ICBuZXcgU3RyaW5nW117IE9JREZDVFlQRS5nZXROYW1l\nKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6IG5l\ndyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJD\nb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5j\nbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1l\ndGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBjYWxsIHN1cGVyY2xh\nc3MgbWV0aG9kCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygp\nICE9IG51bGwpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbShpKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICBQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsIHZv\naWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5K\nUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkp\nIHsKICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElk\nICgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2Jq\nZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gPG9pZCB0eXBlPiBjYXN0ID0gKDxvaWQgdHlwZT4pIG9pZDsKICAg\nICAgICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsK\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8v\nIGZzLnN0b3JlPHR5cGU+RmllbGQgKDxpbmRleD4sIGlkLjxmaWVsZD4pOyBv\nci4uLgogICAgICAgIC8vIHRoaXMuPGZpZWxkPiA9IGlkLjxmaWVsZD4KICAg\nICAgICAvLyBvciBmb3Igc2luZ2xlIGZpZWxkIGlkZW50aXR5OiBpZC5nZXRJ\nZCAoKQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAg\nICBDbGFzcyB0eXBlOwogICAgICAgIENsYXNzIHVud3JhcHBlZDsKICAgICAg\nICBGaWVsZCBmaWVsZDsKICAgICAgICBNZXRob2QgZ2V0dGVyOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIG5hbWUgPSBmbWRzW2ld\nLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNbaV0uZ2V0T2Jq\nZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFn\nZXIgCiAgICAgICAgICAgICAgICAmJiBmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAgICAgICAgIC8v\nIHNtLmdldFBDUHJpbWFyeUtleShvaWQsIGkgKyBwY0luaGVyaXRlZEZpZWxk\nQ291bnQpOyAKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8g\nbGVhdmUgb3JpZyBvbiBzdGFjayB0byBzZXQgdmFsdWUgaW50bwogICAgICAg\nICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsK\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsK\nICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5I\nRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgp\nOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoU3RhdGVNYW5hZ2VyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAg\nICAiZ2V0UENQcmltYXJ5S2V5IiwgT2JqZWN0LmNsYXNzLCAKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNs\nYXNzIH0pOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICB9\nIGVsc2UgeyAKICAgICAgICAgICAgICAgIHVud3JhcHBlZCA9IChmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIAogICAg\nICAgICAgICAgICAgICAgID8gdHlwZSA6IHVud3JhcFNpbmdsZUZpZWxkSWRl\nbnRpdHkoZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRNYW5h\nZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBpZiAodW53cmFwcGVkICE9IHR5\ncGUpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaWQpOwogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQ\nQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2lkVHlw\nZSA9PSBPYmplY3RJZC5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgImdl\ndElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRN\nYW5hZ2VyICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAob2lkVHlwZSA9PSBEYXRlSWQuY2xhc3MpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKG9pZFR5cGUsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBEYXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKCFmaWVsZE1hbmFnZXIgJiYgdHlwZSAhPSBEYXRlLmNsYXNzKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcHBlZCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlw\nZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+IiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\ndW53cmFwcGVkIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENs\nYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKXsKICAgICAgICAgICAgICAgICAg\nICBmaWVsZCA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUs\nIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1B1\nYmxpYyhmaWVsZC5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5kRmll\nbGQoLi4uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Nj\nb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3\nIENsYXNzW10geyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNz\nLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlv\nbkdldHRlck1ldGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBl\nICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIGdldHRlciA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRU\neXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9k\naWZpZXIuaXNQdWJsaWMoZ2V0dGVyLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKGdldHRlcik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwg\nUmVmbGVjdGlvbi5maW5kR2V0dGVyKC4uLikpOwogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24u\nY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmluZEdldHRl\nciIsIE1ldGhvZC5jbGFzcywgbmV3IENsYXNzW10geyAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJv\nb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1ldGhvZCh0eXBlLCBNZXRo\nb2QuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0eXBl\nLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRNYW5h\nZ2VyKQogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5z\nZXRNZXRob2QoZ2V0RmllbGRDb25zdW1lck1ldGhvZCh0eXBlKSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUu\ndnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBpZiB0aGUgY2xhc3MgdXNlcyB0aGUgQ2xh\nc3MvU3RyaW5nIGNvbnN0cnVjdG9yCiAgICAgKiBpbnN0ZWFkIG9mIGp1c3Qg\nU3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gdXNlc0NsYXNz\nU3RyaW5nSWRDb25zdHJ1Y3RvcigpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTikKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAg\nIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAg\nIGlmIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBPYmplY3RJZC5jbGFz\ncykKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0KCiAgICAgICAgQ2xhc3Mg\nb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIG9pZFR5cGUuZ2V0Q29uc3RydWN0b3IobmV3IENs\nYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgfSBjYXRjaCAoVGhy\nb3dhYmxlIHQpIHsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzIH0pOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsK\nICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRo\nZSBnaXZlbiBmaWVsZCBpcyBhIHdyYXBwZXItdHlwZSBzaW5nbGUgZmllbGQg\naWRlbnRpdHkgcHJpbWFyeSBrZXksCiAgICAgKiByZXR1cm4gaXRzIGNvcnJl\nc3BvbmRpbmcgcHJpbWl0aXZlIGNsYXNzLiBFbHNlIHJldHVybiB0aGUgZmll\nbGQgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzcyB1bndyYXBTaW5n\nbGVGaWVsZElkZW50aXR5KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\naWYgKCFmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmlzT3BlbkpQQUlkZW50\naXR5KCkpCiAgICAgICAgICAgIHJldHVybiBmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAg\nICAgICAgICAgICAgIHJldHVybiBieXRlLmNsYXNzOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBjaGFyLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VC\nTEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGRvdWJsZS5jbGFzczsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGlu\ndC5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JK\nOgogICAgICAgICAgICAgICAgcmV0dXJuIHNob3J0LmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBsb25nLmNsYXNzOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3Bl\nciBnZXR0ZXIgbWV0aG9kIG9mIHRoZSB7QGxpbmsgUmVmbGVjdGlvbn0gaGVs\ncGVyIGZvcgogICAgICogYSBmaWVsZCBvciBnZXR0ZXIgbWV0aG9kIG9mIHRo\nZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRS\nZWZsZWN0aW9uR2V0dGVyTWV0aG9kKENsYXNzIHR5cGUsIENsYXNzIGFyZ1R5\ncGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgU3RyaW5nIG5hbWUgPSAiZ2V0IjsKICAgICAgICBpZiAodHlwZS5p\nc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICBuYW1lICs9IFN0cmluZ1V0aWxz\nLmNhcGl0YWxpemUodHlwZS5nZXROYW1lKCkpOwogICAgICAgIHJldHVybiBS\nZWZsZWN0aW9uLmNsYXNzLmdldE1ldGhvZChuYW1lLCBuZXcgQ2xhc3NbXSB7\nIE9iamVjdC5jbGFzcywgCiAgICAgICAgICAgIGFyZ1R5cGUgfSk7IAogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIgZmV0Y2ggbWV0\naG9kIG9mIHRoZSBPYmplY3RJZEZpZWxkU3VwcGxpZXIgZm9yCiAgICAgKiBh\nIGZpZWxkIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRl\nIE1ldGhvZCBnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKENsYXNzIHR5cGUpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIGdldE1ldGhvZChPSURGU1RZUEUsIHR5cGUsICJmZXRjaCIsIHRy\ndWUsIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhlIE9iamVjdElkRmll\nbGRDb25zdW1lciBmb3IKICAgICAqIGEgZmllbGQgb2YgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldEZpZWxkQ29uc3Vt\nZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9kKE9JREZD\nVFlQRSwgdHlwZSwgInN0b3JlIiwgZmFsc2UsIGZhbHNlLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBwY05ld09iamVjdElkSW5z\ndGFuY2UgbWV0aG9kIHRvIGNsYXNzZXMgdXNpbmcKICAgICAqIGFwcGxpY2F0\naW9uIGlkZW50aXR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTmV3\nT2JqZWN0SWRJbnN0YW5jZU1ldGhvZChib29sZWFuIG9iaikKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJs\naWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoKQogICAgICAgIENs\nYXNzW10gYXJncyA9IChvYmopID8gbmV3IENsYXNzW117IE9iamVjdC5jbGFz\ncyB9IDogbnVsbDsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgYXJncyk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIEJvb2xlYW4gdXNl\nc0Nsc1N0cmluZyA9IHVzZXNDbGFzc1N0cmluZ0lkQ29uc3RydWN0b3IoKTsK\nICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBl\nKCk7CiAgICAgICAgaWYgKG9iaiAmJiB1c2VzQ2xzU3RyaW5nID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbiAoLi4uKTsKICAgICAgICAgICAgU3RyaW5nIG1zZyA9IF9sb2Mu\nZ2V0KCJzdHItY29ucyIsIG9pZFR5cGUsCiAgICAgICAgICAgICAgICBfbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpLmdldE1lc3NhZ2UoKTsKICAgICAgICAg\nICAgY29kZS5hbmV3KCkuc2V0VHlwZShJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobXNnKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH0pOwogICAg\nICAgICAgICBjb2RlLmF0aHJvdygpOwogICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFfbWV0YS5p\nc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hh\ncmVkKCkpIHsKICAgICAgICAgICAgLy8gbmV3IE9iamVjdElkIChjbHMsIG9p\nZCkKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShPYmplY3RJZC5j\nbGFzcyk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNv\nZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5cGUoX21ldGEpKTsK\nICAgICAgICB9CgogICAgICAgIC8vIG5ldyA8b2lkIGNsYXNzPiAoKTsKICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNv\nZGUuZHVwKCk7CiAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5\nKCkgfHwgKG9iaiAmJiB1c2VzQ2xzU3RyaW5nID09IEJvb2xlYW4uVFJVRSkp\nCiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdl\ndFR5cGUoX21ldGEpKTsKICAgICAgICBpZiAob2JqKSB7CiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAg\nIGlmICh1c2VzQ2xzU3RyaW5nID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAg\nICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmlu\nZy5jbGFzcyB9OwogICAgICAgICAgICBlbHNlIGlmICh1c2VzQ2xzU3RyaW5n\nID09IEJvb2xlYW4uRkFMU0UpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3\nIENsYXNzW117IFN0cmluZy5jbGFzcyB9OwogICAgICAgIH0gZWxzZSBpZiAo\nX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICAvLyBu\nZXcgPHR5cGU+SWRlbnRpdHkgKFhYWC5jbGFzcywgPHBrPik7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhIHBrID0gX21ldGEuZ2V0UHJpbWFyeUtleUZp\nZWxkcygpWzBdOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIHBrKTsKICAgICAgICAgICAgaWYgKHBrLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICBhZGRF\neHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29kZShjb2RlLCBwayk7CiAgICAg\nICAgICAgIGlmIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBPYmplY3RJ\nZC5jbGFzcykKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsg\nQ2xhc3MuY2xhc3MsIE9iamVjdC5jbGFzcyB9OwogICAgICAgICAgICBlbHNl\nIGlmIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBEYXRlLmNsYXNzKQog\nICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFz\ncywgRGF0ZS5jbGFzcyB9OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBway5nZXRP\nYmplY3RJZEZpZWxkVHlwZSgpIH07CiAgICAgICAgfQoKICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgIjxpbml0PiIs\nIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAgICAgIGlmICghX21ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgp\nKQogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nT2JqZWN0SWQuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBPYmplY3QuY2xh\nc3MgfSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogV2hlbiBjb21tdW5p\nY2F0aW5nIHdpdGggdGhlIFN0YXRlTWFuYWdlciwgbWFueSBtZXRob2RzIGFy\nZSB1c2VkCiAgICAgKiBkZXBlbmRpbmcgb24gdGhlIGNsYXNzIG9mIHN0YXRl\nIGJlaW5nIHBhc3NlZC4gVGhpcyBtZXRob2QsCiAgICAgKiBnaXZlbiB0aGUg\ndHlwZSBvZiBpbmZvcm1hdGlvbiBiZWluZyBwYXNzZWQgYW5kIHRoZSBwcmVm\naXgKICAgICAqICgncHJvdmlkZWQnLCAncmVwbGFjZScsIGV0Yykgb2YgdGhl\nIG1ldGhvZCB0bwogICAgICogY2FsbCwgcmV0dXJucyB0aGUgU3RhdGVNYW5h\nZ2VyIG1ldGhvZCB0aGF0IHNob3VsZCBiZSB1c2VkLgogICAgICoKICAgICAq\nIEBwYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAog\nICAgICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4IG9mIHRoZSBtZXRob2Qg\ndG8gY2FsbDsgYWxsIG1ldGhvZHMKICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5\ncGVdRmllbGQnOyBvbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAgICAgKiBAcGFy\nYW0gZ2V0IHRydWUgaWYgcmVjZWl2aW5nIGluZm9ybWF0aW9uIGZyb20gdGhl\nCiAgICAgKiBTdGF0ZU1hbmFnZXIsIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8g\ndGhlIFNNCiAgICAgKiBAcGFyYW0gY3VyVmFsdWUgdHJ1ZSBpZiB0aGUgY3Vy\ncmVudCBzdGF0ZSB2YWx1ZSBpcyBwYXNzZWQgdG8KICAgICAqIHRoZSBTdGF0\nZU1hbmFnZXIgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAqLwogICAgcHJp\ndmF0ZSBNZXRob2QgZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kKENsYXNzIHR5cGUs\nIFN0cmluZyBwcmVmaXgsCiAgICAgICAgYm9vbGVhbiBnZXQsIGJvb2xlYW4g\nY3VyVmFsdWUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChTTVRZUEUsIHR5cGUsIHBy\nZWZpeCwgZ2V0LCB0cnVlLCBjdXJWYWx1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG1ldGhvZCBvZiB0aGUgZ2l2ZW4gb3duZXIgdHlw\nZSBtYXRjaGluZyB0aGUgZ2l2ZW4gY3JpdGVyaWEuCiAgICAgKgogICAgICog\nQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAg\nICAgKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0\nbyBjYWxsOyBhbGwgbWV0aG9kcwogICAgICogZW5kIGluICdbc3RhdGUgdHlw\nZV1GaWVsZCc7IG9ubHkgdGhlIHByZWZpeCB2YXJpZXMKICAgICAqIEBwYXJh\nbSBnZXQgdHJ1ZSBpZiByZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUK\nICAgICAqIG93bmVyLCBmYWxzZSBpZiBwYXNzaW5nIGl0IHRvIHRoZSBvd25l\ncgogICAgICogQHBhcmFtIGhhc3BjIHRydWUgaWYgdGhlIHBjIGlzIHBhc3Nl\nZCBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICogQHBhcmFtIGN1clZhbHVl\nIHRydWUgaWYgdGhlIGN1cnJlbnQgc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRv\nCiAgICAgKiB0aGUgb3duZXIgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAq\nLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0TWV0aG9kKENsYXNzIG93bmVyLCBD\nbGFzcyB0eXBlLCBTdHJpbmcgcHJlZml4LAogICAgICAgIGJvb2xlYW4gZ2V0\nLCBib29sZWFuIGhhc3BjLCBib29sZWFuIGN1clZhbHVlKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGFsbCBt\nZXRob2RzIGVuZCBpbiBbZmllbGQgdHlwZV1GaWVsZCwgd2hlcmUgdGhlIGZp\nZWxkIHR5cGUKICAgICAgICAvLyBjYW4gYmUgYW55IG9mIHRoZSBwcmltaXR2\nZSB0eXBlcyAoYnV0IGNhcGl0YWxpemVkKSwgJ1N0cmluZycsCiAgICAgICAg\nLy8gb3IgJ09iamVjdCc7IGZpZ3VyZSBvdXQgd2hhdCB0eXBlIHRvIHVzZQog\nICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAg\nICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIHR5cGVO\nYW1lID0gdHlwZU5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKCkK\nICAgICAgICAgICAgICAgICsgdHlwZU5hbWUuc3Vic3RyaW5nKDEpOwogICAg\nICAgIGVsc2UgaWYgKHR5cGUuZXF1YWxzKFN0cmluZy5jbGFzcykpCiAgICAg\nICAgICAgIHR5cGVOYW1lID0gIlN0cmluZyI7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIHR5cGVOYW1lID0gIk9iamVjdCI7CiAgICAgICAgICAgIHR5\ncGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgfQoKICAgICAgICAvLyB0aGUg\nZmllbGQgaW5kZXggaXMgYWx3YXlzIHBhc3NlZCBhcyBhbiBhcmc7IHRoZSBw\nYyBpbnN0YW5jZSBhbmQKICAgICAgICAvLyB0aGUgY3VycmVudCB2YWx1ZSBt\nYXkgYmUgcGFzc2VkOyBpZiBzZXR0aW5nIHRoZSBuZXcgdmFsdWUgaXMKICAg\nICAgICAvLyBhbHNvIHBhc3NlZAogICAgICAgIExpc3QgcGxpc3QgPSBuZXcg\nQXJyYXlMaXN0KDQpOwogICAgICAgIGlmIChoYXNwYykKICAgICAgICAgICAg\ncGxpc3QuYWRkKFBDVFlQRSk7CiAgICAgICAgcGxpc3QuYWRkKGludC5jbGFz\ncyk7CiAgICAgICAgaWYgKCFnZXQgfHwgY3VyVmFsdWUpCiAgICAgICAgICAg\nIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICBpZiAoIWdldCAmJiBjdXJWYWx1\nZSkgewogICAgICAgICAgICBwbGlzdC5hZGQodHlwZSk7CiAgICAgICAgICAg\nIHBsaXN0LmFkZChpbnQuY2xhc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8g\ndXNlIHJlZmxlY3Rpb24gdG8gcmV0dXJuIHRoZSByaWdodCBtZXRob2QKICAg\nICAgICBTdHJpbmcgbmFtZSA9IHByZWZpeCArIHR5cGVOYW1lICsgIkZpZWxk\nIjsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IChDbGFzc1tdKSBwbGlzdC50\nb0FycmF5KG5ldyBDbGFzc1twbGlzdC5zaXplKCldKTsKICAgICAgICByZXR1\ncm4gb3duZXIuZ2V0RGVjbGFyZWRNZXRob2QobmFtZSwgcGFyYW1zKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBj\nb2RlIG5lY2Vzc2FyeSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAgICAqIGV4Y2Vw\ndGlvbiB0eXBlLCBzYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAgIHByaXZhdGUg\nSW5zdHJ1Y3Rpb24gdGhyb3dFeGNlcHRpb24oQ29kZSBjb2RlLCBDbGFzcyB0\neXBlKSB7CiAgICAgICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29kZS5hbmV3KCku\nc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hdGhyb3coKTsKICAg\nICAgICByZXR1cm4gaW5zOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0\naGUgUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZSB0byB0aGUgY2xhc3Mg\nYmVpbmcgZW5oYW5jZWQsIGFuZAogICAgICogYWRkcyBhIGRlZmF1bHQgY29u\nc3RydWN0b3IgZm9yIHVzZSBieSBPcGVuSlBBIGlmIGl0IGlzIG5vdCBhbHJl\nYWR5IHByZXNlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBlbmhhbmNl\nQ2xhc3MoKSB7CiAgICAgICAgLy8gbWFrZSB0aGUgY2xhc3MgaW1wbGVtZW50\nIFBlcnNpc3RlbmNlQ2FwYWJsZQogICAgICAgIF9wYy5kZWNsYXJlSW50ZXJm\nYWNlKFBDVFlQRSk7CgogICAgICAgIC8vIGFkZCBhIHZlcnNpb24gc3RhbXAK\nICAgICAgICBhZGRHZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhv\nZCgpOwoKICAgICAgICAvLyBmaW5kIHRoZSBkZWZhdWx0IGNvbnN0cnVjdG9y\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmdldERlY2xhcmVkTWV0\naG9kKCI8aW5pdD4iLCAoU3RyaW5nW10pIG51bGwpOwoKICAgICAgICAvLyBh\nIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcmVxdWlyZWQKICAgICAgICBpZiAo\nbWV0aG9kID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IF9w\nYy5nZXRUeXBlKCk7CiAgICAgICAgICAgIGlmICghX2RlZkNvbnMpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nZW5oYW5jZS1kZWZhdWx0Y29uc3QiLAogICAgICAgICAgICAgICAgICAgIHR5\ncGUpKTsKCiAgICAgICAgICAgIG1ldGhvZCA9IF9wYy5hZGREZWZhdWx0Q29u\nc3RydWN0b3IoKTsKICAgICAgICAgICAgU3RyaW5nIGFjY2VzczsKICAgICAg\nICAgICAgaWYgKF9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAg\nICAgICAvLyBleHRlcm5hbGl6YWJsZSByZXF1aXJlcyB0aGF0IHRoZSBjb25z\ndHJ1Y3RvcgogICAgICAgICAgICAgICAgLy8gYmUgcHVibGljLCBzbyBtYWtl\nIHRoZSBhZGRlZCBjb25zdHJ1Y3RvciBwdWJsaWMKICAgICAgICAgICAgICAg\nIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3Mg\nPSAicHVibGljIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChfcGMuaXNGaW5h\nbCgpKSB7CiAgICAgICAgICAgICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsK\nICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJwcml2YXRlIjsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJvdGVj\ndGVkKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAicHJvdGVjdGVkIjsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIV9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpICYmIF9sb2cuaXNXYXJuRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhh\nbmNlLWFkZGRlZmF1bHRjb25zdCIsIHR5cGUsIGFjY2VzcykpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGZvbGxvd2luZyBm\naWVsZHMgdG8gdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZToKICAg\nICAqIDx1bD4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBpbnQg\ncGNJbmhlcml0ZWRGaWVsZENvdW50PC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+\nPGNvZGU+cHJpdmF0ZSBzdGF0aWMgQ2xhc3MgcGNQQ1N1cGVyY2xhc3M8L2Nv\nZGU+CiAgICAgKiA8L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3Rh\ndGljIFN0cmluZ1tdIHBjRmllbGROYW1lczwvY29kZT48L2xpPgogICAgICog\nPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIENsYXNzW10gcGNGaWVsZFR5cGVz\nPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMg\nYnl0ZVtdIHBjRmllbGRGbGFnczwvY29kZT48L2xpPgogICAgICogPGxpPjxj\nb2RlPnByb3RlY3RlZCB0cmFuc2llbnQgU3RhdGVNYW5hZ2VyIHBjU3RhdGVN\nYW5hZ2VyPC9jb2RlPgogICAgICogaWYgbm8gUGVyc2lzdGVuY2VDYXBhYmxl\nIHN1cGVyY2xhc3MgcHJlc2VudCk8L2xpPgogICAgICogPC91bD4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEZpZWxkcygpIHsKICAgICAgICBfcGMu\nZGVjbGFyZUZpZWxkKElOSEVSSVQsIGludC5jbGFzcykuc2V0U3RhdGljKHRy\ndWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkTmFt\nZXMiLCBTdHJpbmdbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAg\nIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1td\nLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVG\naWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcykuc2V0U3Rh\ndGljKHRydWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoU1VQRVIsIENs\nYXNzLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CgogICAgICAgIGlmIChfbWV0\nYS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIEJD\nRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgICAgICBmaWVsZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAg\nIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNb2RpZmllcyB0aGUgY2xhc3MgaW5pdGlhbGl6YXRp\nb24gbWV0aG9kIChjcmVhdGluZyBvbmUgaWYgbmVjZXNzYXJ5KQogICAgICog\ndG8gaW5pdGlhbGl6ZSB0aGUgc3RhdGljIGZpZWxkcyBvZiB0aGUgUGVyc2lz\ndGVuY2VDYXBhYmxlIGluc3RhbmNlIGFuZAogICAgICogdG8gcmVnaXN0ZXIg\naXQgd2l0aCB0aGUgaW1wbCBoZWxwZXIuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRTdGF0aWNJbml0aWFsaXplcigpIHsKICAgICAgICBDb2RlIGNv\nZGUgPSBnZXRPckNyZWF0ZUNsYXNzSW5pdENvZGUodHJ1ZSk7CiAgICAgICAg\naWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsKICAgICAg\nICAgICAgLy8gcGNJbmhlcml0ZWRGaWVsZENvdW50ID0gPHN1cGVyQ2xhc3M+\nLnBjR2V0TWFuYWdlZEZpZWxkQ291bnQoKQogICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAg\nICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgp\nLCAKICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3Vu\ndCIsIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAgICBj\nb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7\nCgogICAgICAgICAgICAvLyBwY1BDU3VwZXJjbGFzcyA9IDxzdXBlckNsYXNz\nPjsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mo\nZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkpKTsKICAgICAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5z\nZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3IFN0cmluZ1tdIHsgIjxuYW1lMT4i\nLCAiPG5hbWUyPiIsIC4uLiB9OwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNv\nZGUuYW5ld2FycmF5KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGNvZGUu\nYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0YXRpYygp\nLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3Mp\nOwoKICAgICAgICAvLyBwY0ZpZWxkVHlwZXMgPSBuZXcgQ2xhc3NbXSB7IDx0\neXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xhc3MsIC4uLiB9OwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAgICAg\nY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBlKENsYXNzLmNsYXNzKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3Rh\nbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAg\nICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIGNv\nZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBD\nbGFzc1tdLmNsYXNzKTsKCiAgICAgICAgLy8gcGNGaWVsZEZsYWdzID0gbmV3\nIGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFnMj4sIC4uLiB9OwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAgICAg\nY29kZS5uZXdhcnJheSgpLnNldFR5cGUoYnl0ZS5jbGFzcyk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGdldEZpZWxkRmxhZyhmbWRzW2ldKSk7CiAgICAgICAgICAgIGNv\nZGUuYmFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0YXRp\nYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNz\nKTsKCiAgICAgICAgLy8gUENSZWdpc3RyeS5yZWdpc3RlciAoY2xzLAogICAg\nICAgIC8vCXBjRmllbGROYW1lcywgcGNGaWVsZFR5cGVzLCBwY0ZpZWxkRmxh\nZ3MsCiAgICAgICAgLy8gIHBjUENTdXBlcmNsYXNzLCBhbGlhcywgbmV3IFhY\nWCAoKSk7CiAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mo\nX3BjKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSAr\nICJGaWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3MpOwogICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFz\nc1tdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKICAgICAgICBj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKF9tZXRhLmdldFR5\ncGVBbGlhcygpKTsKICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfcGMpOwog\nICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51\nbGwpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5z\nZXRNZXRob2QoSEVMUEVSVFlQRSwgInJlZ2lzdGVyIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmdb\nXS5jbGFzcywgQ2xhc3NbXS5jbGFzcywKICAgICAgICAgICAgICAgIGJ5dGVb\nXS5jbGFzcywgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgUENUWVBFIH0p\nOwoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGZsYWcgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgYnl0ZSBnZXRGaWVsZEZsYWcoRmllbGRNZXRhRGF0YSBm\nbWQpIHsKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVs\nZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICByZXR1cm4gLTE7\nCgogICAgICAgIGJ5dGUgZmxhZ3MgPSAwOwogICAgICAgIGlmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUoKQogICAgICAgICAgICB8fCBT\nZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCkpKQogICAgICAgICAgICBmbGFncyA9IFBlcnNpc3RlbmNl\nQ2FwYWJsZS5TRVJJQUxJWkFCTEU7CgogICAgICAgIGlmIChmbWQuZ2V0TWFu\nYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX1RSQU5TQUNUSU9O\nQUwpCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5D\nSEVDS19XUklURTsKICAgICAgICBlbHNlIGlmICghZm1kLmlzUHJpbWFyeUtl\neSgpICYmICFmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAg\nICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURQog\nICAgICAgICAgICAgICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfUkVB\nRDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5NRURJQVRFX1dSSVRFCiAgICAgICAgICAgICAgICB8IFBl\ncnNpc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1JFQUQ7CiAgICAgICAgcmV0dXJu\nIGZsYWdzOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgY29kZSB0\nbyBwcm9wZXJseSBoYW5kbGUgUGVyc2lzdGVuY2VDYXBhYmxlIHNlcmlhbGl6\nYXRpb24KICAgICAqIHRvIHRoZSBieXRlY29kZS4gVGhpcyBpbmNsdWRlcyBj\ncmVhdGluZyBhbmQgaW5pdGlhbGl6aW5nIHRoZQogICAgICogc3RhdGljIDxj\nb2RlPnNlcmlhbFZlcnNpb25VSUQ8L2NvZGU+IGNvbnN0YW50IGlmIG5vdCBh\nbHJlYWR5IGRlZmluZWQsCiAgICAgKiBhcyB3ZWxsIGFzIGNyZWF0aW5nIGEg\nY3VzdG9tIDxjb2RlPndyaXRlT2JqZWN0PC9jb2RlPiBtZXRob2QgaWYgdGhl\nCiAgICAgKiBjbGFzcyBpcyBTZXJpYWxpemFibGUgYW5kIGRvZXMgbm90IGRl\nZmluZSB0aGVtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2VyaWFs\naXphdGlvbkNvZGUoKSB7CiAgICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNo\nZWQoKQogICAgICAgICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBwcmVz\nZW50LCBhZGQgYSBzZXJpYWxWZXJzaW9uVUlEIGZpZWxkOyBpZiB0aGUgaW5z\ndGFuY2UKICAgICAgICAvLyBpcyBkZXRhY2hhYmxlIGFuZCB1c2VzIGRldGFj\naGVkIHN0YXRlIHdpdGhvdXQgYSBkZWNsYXJlZCBmaWVsZCwKICAgICAgICAv\nLyBjYW4ndCBhZGQgYSBzZXJpYWwgdmVyc2lvbiBVSUQgYmVjYXVzZSB3ZSds\nbCBiZSBhZGRpbmcgZXh0cmEgZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIGVu\naGFuY2VkIHZlcnNpb24KICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdl\ndERlY2xhcmVkRmllbGQoInNlcmlhbFZlcnNpb25VSUQiKTsKICAgICAgICBp\nZiAoZmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBMb25nIHVpZCA9IG51\nbGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB1aWQgPSBO\ndW1iZXJzLnZhbHVlT2YoT2JqZWN0U3RyZWFtQ2xhc3MubG9va3VwCiAgICAg\nICAgICAgICAgICAgICAgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkuZ2V0\nU2VyaWFsVmVyc2lvblVJRCgpKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhy\nb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGxhc3QtY2hhbmNlIGNh\ndGNoIGZvciBidWcgIzI4MyAod2hpY2ggY2FuIGhhcHBlbgogICAgICAgICAg\nICAgICAgLy8gaW4gYSB2YXJpZXR5IG9mIENsYXNzTG9hZGluZyBlbnZpcm9u\nbWVudHMpCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVu\naGFuY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSwgdCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGlmIHdlIGNvdWxkbid0IGFjY2VzcyB0aGUgc2Vy\naWFsVmVyc2lvblVJRCwgd2Ugd2lsbCBoYXZlIHRvCiAgICAgICAgICAgIC8v\nIHNraXAgdGhlIG92ZXJyaWRlIG9mIHRoYXQgZmllbGQgYW5kIG5vdCBiZSBz\nZXJpYWxpemF0aW9uCiAgICAgICAgICAgIC8vIGNvbXBhdGlibGUgd2l0aCBu\nb24tZW5oYW5jZWQgY2xhc3NlcwogICAgICAgICAgICBpZiAodWlkICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVs\nZCgic2VyaWFsVmVyc2lvblVJRCIsIGxvbmcuY2xhc3MpOwogICAgICAgICAg\nICAgICAgZmllbGQubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGZp\nZWxkLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNl\ndEZpbmFsKHRydWUpOwoKICAgICAgICAgICAgICAgIENvZGUgY29kZSA9IGdl\ndE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShmYWxzZSk7CiAgICAgICAgICAgICAg\nICBjb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUodWlkLmxvbmdWYWx1ZSgpKTsKICAgICAgICAg\nICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoZmllbGQpOwoKICAg\nICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHdyaXRlIG9iamVj\ndCBtZXRob2QKICAgICAgICBCQ01ldGhvZCB3cml0ZSA9IF9wYy5nZXREZWNs\nYXJlZE1ldGhvZCgid3JpdGVPYmplY3QiLAogICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgIGJv\nb2xlYW4gZnVsbCA9IHdyaXRlID09IG51bGw7CiAgICAgICAgaWYgKGZ1bGwp\nIHsKICAgICAgICAgICAgLy8gcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0IChP\nYmplY3RPdXRwdXRTdHJlYW0gb3V0KQogICAgICAgICAgICB3cml0ZSA9IF9w\nYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFt\nLmNsYXNzIH0pOwogICAgICAgICAgICB3cml0ZS5nZXRFeGNlcHRpb25zKHRy\ndWUpLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIHdyaXRlLm1ha2VQcml2YXRlKCk7CiAgICAgICAgfQogICAgICAgIG1v\nZGlmeVdyaXRlT2JqZWN0TWV0aG9kKHdyaXRlLCBmdWxsKTsKCiAgICAgICAg\nLy8gYW5kIHJlYWQgb2JqZWN0CiAgICAgICAgQkNNZXRob2QgcmVhZCA9IF9w\nYy5nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsCiAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsKICAg\nICAgICBmdWxsID0gcmVhZCA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7\nCiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0IChPYmpl\nY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICAgICAgcmVhZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKCJyZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9\nKTsKICAgICAgICAgICAgcmVhZC5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4\nY2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHJlYWQu\nZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAgICAgICAgICAg\nICAgIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgcmVhZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2Rp\nZnlSZWFkT2JqZWN0TWV0aG9kKHJlYWQsIGZ1bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGUgY2xhc3MgYmVpbmcgZW5oYW5jZWQgc2hv\ndWxkIGV4dGVybmFsaXplIHRvIGEgZGV0YWNoZWQKICAgICAqIGluc3RhbmNl\nIHJhdGhlciB0aGFuIHNlcmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGV4dGVybmFsaXplRGV0YWNoZWQoKSB7CiAgICAgICAgcmV0dXJu\nIENsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRh\nY2hlZFN0YXRlKCkpCiAgICAgICAgICAgICYmIFNlcmlhbGl6YWJsZS5jbGFz\ncy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkK\nICAgICAgICAgICAgJiYgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0\nRGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVk\nU3RhdGVUcmFuc2llbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\nYSBjdXN0b20gd3JpdGVPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRv\nIHRoZQogICAgICoge0BsaW5rIE9iamVjdE91dHB1dFN0cmVhbSNkZWZhdWx0\nV3JpdGVPYmplY3R9IG1ldGhvZCwKICAgICAqIGJ1dCBvbmx5IGFmdGVyIGNh\nbGxpbmcgdGhlIGludGVybmFsIDxjb2RlPnBjU2VyaWFsaXppbmc8L2NvZGU+\nIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVdyaXRl\nT2JqZWN0TWV0aG9kKEJDTWV0aG9kIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICAvLyBib29sIGNs\nZWFyID0gcGNTZXJpYWxpemluZyAoKTsKICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoUFJFICsgIlNlcmlhbGl6aW5nIiwKICAgICAgICAg\nICAgYm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGNsZWFyID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmlzdG9y\nZSgpLnNldExvY2FsKGNsZWFyKTsKCiAgICAgICAgaWYgKGZ1bGwpIHsKICAg\nICAgICAgICAgLy8gb3V0LmRlZmF1bHRXcml0ZU9iamVjdCAoKTsKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0U3Ry\nZWFtLmNsYXNzLAogICAgICAgICAgICAgICAgImRlZmF1bHRXcml0ZU9iamVj\ndCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKICAgICAgICB9CgogICAgICAgIEluc3RydWN0aW9uIHRtcGxhdGUg\nPSBuZXcgQ29kZSgpLnZyZXR1cm4oKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gdG9yZXQ7CiAgICAgICAgSW5zdHJ1Y3Rpb24gcmV0OwogICAgICAgIGNv\nZGUuYmVmb3JlRmlyc3QoKTsKICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hG\nb3J3YXJkKHRtcGxhdGUpKSB7CiAgICAgICAgICAgIHJldCA9IGNvZGUucHJl\ndmlvdXMoKTsKICAgICAgICAgICAgLy8gaWYgKGNsZWFyKSBwY1NldERldGFj\naGVkU3RhdGUgKG51bGwpOwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0\nTG9jYWwoY2xlYXIpOwogICAgICAgICAgICB0b3JldCA9IGNvZGUuaWZlcSgp\nOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSAr\nICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAg\nIHRvcmV0LnNldFRhcmdldChyZXQpOwogICAgICAgICAgICBjb2RlLm5leHQo\nKTsgLy8ganVtcCBvdmVyIHJldHVybgogICAgICAgIH0KICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBjdXN0\nb20gcmVhZE9iamVjdCBtZXRob2QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAg\nICAgKiB7QGxpbmsgT2JqZWN0SW5wdXRTdHJlYW0jcmVhZE9iamVjdH0gbWV0\naG9kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbW9kaWZ5UmVhZE9iamVj\ndE1ldGhvZChCQ01ldGhvZCBtZXRob2QsIGJvb2xlYW4gZnVsbCkgewogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpbnN0\nYW5jZSB1c2VzIHN5bnRoZXRpYyBkZXRhY2hlZCBzdGF0ZSwgbm90ZSB0aGF0\nIGl0IGhhcwogICAgICAgIC8vIGJlZW4gZGVzZXJpYWxpemVkCiAgICAgICAg\naWYgKENsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXRE\nZXRhY2hlZFN0YXRlKCkpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAg\nICAgICAgICAgICJERVNFUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsg\nIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChmdWxsKSB7CiAgICAgICAgICAgIC8vIGluLmRlZmF1bHRS\nZWFkT2JqZWN0ICgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChPYmplY3RJbnB1dFN0cmVhbS5jbGFzcywKICAgICAgICAgICAgICAg\nICJkZWZhdWx0UmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0\naGUgcGNJc0RldGFjaGVkKCkgbWV0aG9kIHRvIGRldGVybWluZSBpZiBhbiBp\nbnN0YW5jZQogICAgICogaXMgZGV0YWNoZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRJc0RldGFjaGVkTWV0aG9kKCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgYm9v\nbGVhbiBwY0lzRGV0YWNoZWQgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiSXNEZXRhY2hlZCIsCiAgICAg\nICAgICAgIEJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5t\nYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgd3JpdGVJc0RldGFjaGVkTWV0aG9kKGNvZGUp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlcyB0aGUgYm9keSBvZiB0aGUgcGNJc0RldGFjaGVkKCkgbWV0\naG9kIHRvIGRldGVybWluZSBpZiBhbgogICAgICogaW5zdGFuY2UgaXMgZGV0\nYWNoZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3cml0ZUlzRGV0YWNo\nZWRNZXRob2QoQ29kZSBjb2RlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIC8vIG5vdCBkZXRhY2hhYmxlOiByZXR1\ncm4gQm9vbGVhbi5GQUxTRQogICAgICAgIGlmICghX21ldGEuaXNEZXRhY2hh\nYmxlKCkpIHsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAg\nIC8vCQlyZXR1cm4gKHNtLmlzRGV0YWNoZWQgKCkpID8gQm9vbGVhbi5UUlVF\nIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5z\nID0gY29kZS5pZm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoU01UWVBFLCAiaXNEZXRhY2hlZCIsCiAgICAgICAgICAg\nIGJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmZhbHNlID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4u\nY2xhc3MpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGlmZmFs\nc2Uuc2V0VGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIkZBTFNFIiwKICAgICAgICAgICAgQm9vbGVhbi5jbGFzcykp\nOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyBpZiB3ZSB1\nc2UgZGV0YWNoZWQgc3RhdGU6CiAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNo\nZWRTdGF0ZSAoKSAhPSBudWxsCiAgICAgICAgLy8gICAgICYmIHBjR2V0RGV0\nYWNoZWRTdGF0ZSAhPSBERVNFUklBTElaRUQpCiAgICAgICAgLy8gICAgIHJl\ndHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgQm9vbGVhbiBzdGF0ZSA9IF9t\nZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCk7CiAgICAgICAgSnVtcEluc3RydWN0\naW9uIG5vdGRlc2VyID0gbnVsbDsKICAgICAgICBJbnN0cnVjdGlvbiB0YXJn\nZXQ7CiAgICAgICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uRkFMU0UpIHsKICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAg\nICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlm\naW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIs\nCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICJERVNFUklBTElaRUQiLCBP\nYmplY3QuY2xhc3MpOwogICAgICAgICAgICBub3RkZXNlciA9IGNvZGUuaWZh\nY21wZXEoKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAg\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgICAgIGlmIChzdGF0\nZSA9PSBCb29sZWFuLlRSVUUpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdl\nIGhhdmUgdG8gdXNlIGRldGFjaGVkIHN0YXRlOgogICAgICAgICAgICAgICAg\nLy8gcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgICAgICB0YXJn\nZXQgPSBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3Ms\nICJGQUxTRSIsCiAgICAgICAgICAgICAgICAgICAgQm9vbGVhbi5jbGFzcyk7\nCiAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAg\nICAgICAgICAgICAgIG5vdGRlc2VyLnNldFRhcmdldCh0YXJnZXQpOwogICAg\nICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNy\nZWF0ZSBhcnRpZmljaWFsIHRhcmdldCB0byBzaW1wbGlmeQogICAgICAgIHRh\ncmdldCA9IGNvZGUubm9wKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRh\ncmdldCk7CiAgICAgICAgaWYgKG5vdGRlc2VyICE9IG51bGwpCiAgICAgICAg\nICAgIG5vdGRlc2VyLnNldFRhcmdldCh0YXJnZXQpOwoKICAgICAgICAvLyBh\nbGxvdyB1c2VycyB3aXRoIHZlcnNpb24gZmllbGRzIHRvIG1hbnVhbGx5IGNv\nbnN0cnVjdCBhICJkZXRhY2hlZCIKICAgICAgICAvLyBpbnN0YW5jZSwgc28g\nY2hlY2sgdmVyc2lvbiBiZWZvcmUgdGFraW5nIGludG8gYWNjb3VudCBub24t\nZXhpc3RlbnQKICAgICAgICAvLyBkZXRhY2hlZCBzdGF0ZQoKICAgICAgICAv\nLyBjb25zaWRlciBkZXRhY2hlZCBpZiB2ZXJzaW9uIGlzIG5vbi1kZWZhdWx0\nCiAgICAgICAgRmllbGRNZXRhRGF0YSB2ZXJzaW9uID0gX21ldGEuZ2V0VmVy\nc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uVFJV\nRSAmJiB2ZXJzaW9uICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgKDx2\nZXJzaW9uPiAhPSA8ZGVmYXVsdD4pCiAgICAgICAgICAgIC8vCQlyZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgdmVyc2lvbik7CiAgICAgICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFs\ndWUoY29kZSwgdmVyc2lvbik7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJv\nb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAgICAgICAgICAgICBCb29sZWFu\nLmNsYXNzKSk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBubyBkZXRhY2hl\nZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSBhbmQg\naXQncyBub3QKICAgICAgICAvLyBzeW50aGV0aWMgb3IgdGhlIGluc3RhbmNl\nIGlzIG5vdCBzZXJpYWxpemFibGUgb3IgdGhlIHN0YXRlIGlzbid0CiAgICAg\nICAgLy8gdHJhbnNpZW50LCBtdXN0IG5vdCBiZSBkZXRhY2hlZAogICAgICAg\nIGlmIChzdGF0ZSA9PSBudWxsCiAgICAgICAgICAgICYmICghQ2xhc3NNZXRh\nRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3RhdGUo\nKSkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAg\nICAgfHwgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3Rh\ndGVJbnN0YW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVUcmFu\nc2llbnQoKSkpIHsKICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xlYW4uRkFM\nU0UKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29s\nZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIC8vIG5vIGRldGFjaGVkIHN0YXRlOiBpZiBpbnN0YW5j\nZSB1c2VzIGRldGFjaGVkIHN0YXRlIChhbmQgbXVzdCBiZQogICAgICAgIC8v\nIHN5bnRoZXRpYyBhbmQgdHJhbnNpZW50IGluIHNlcmlhbGl6YWJsZSBpbnN0\nYW5jZSBhdCB0aGlzIHBvaW50KSwKICAgICAgICAvLyBub3QgZGV0YWNoZWQg\naWYgc3RhdGUgbm90IHNldCB0byBERVNFUklBTElaRUQKICAgICAgICBpZiAo\nc3RhdGUgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiAocGNHZXREZXRh\nY2hlZFN0YXRlICgpID09IG51bGwpIC8vIGluc3RlYWQgb2YgREVTRVJJQUxJ\nWkVECiAgICAgICAgICAgIC8vICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQ\nUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZu\nb25udWxsKCk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICBpZmlucy5z\nZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBj\nb25zaWRlciBkZXRhY2hlZCBpZiBhdXRvLWdlbm5lZCBwcmltYXJ5IGtleXMg\nYXJlIG5vbi1kZWZhdWx0CiAgICAgICAgaWZpbnMgPSBudWxsOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiBpZmluczIgPSBudWxsOwogICAgICAgIGlmIChz\ndGF0ZSAhPSBCb29sZWFuLlRSVUUKICAgICAgICAgICAgJiYgX21ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTikgewogICAgICAgICAgICAvLyBmb3IgZWFjaCBwayBmaWVsZDoKICAgICAg\nICAgICAgLy8gaWYgKDxwaz4gIT0gPGRlZmF1bHQ+IFsmJiAhIiIuZXF1YWxz\nICg8cGs+KV0pCiAgICAgICAgICAgIC8vCQlyZXR1cm4gQm9vbGVhbi5UUlVF\nOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gX21ldGEuZ2V0\nUHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVz\nLk5PTkUpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAgICAgdGFyZ2V0ID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoaWZpbnMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAg\nICAgICAgICAgICAgIGlmIChpZmluczIgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBpZmluczIuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAg\nICAgICBpZmluczIgPSBudWxsOwoKICAgICAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAg\nIGlmaW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgcGtzW2ldKTsKICAgICAg\nICAgICAgICAgIGlmIChwa3NbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5TVFJJTkcpIHsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoIiIpOwogICAgICAgICAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGtzW2ld\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoU3RyaW5nLmNsYXNzLCAiZXF1YWxzIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbmV3IENsYXNzW117IE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgICAgICBpZmluczIgPSBjb2Rl\nLmlmbmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNv\nZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUi\nLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAg\nICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qga25vdwog\nICAgICAgIHRhcmdldCA9IGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAg\nICAgICAgaWYgKGlmaW5zICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zLnNl\ndFRhcmdldCh0YXJnZXQpOwogICAgICAgIGlmIChpZmluczIgIT0gbnVsbCkK\nICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFy\nZSB0aGUgZ2l2ZW4gZmllbGQgdG8gaXRzIEphdmEgZGVmYXVsdCwgcmV0dXJu\naW5nIHRoZQogICAgICogY29tcGFyaXNvbiBpbnN0cnVjdGlvbi4gVGhlIGZp\nZWxkIHZhbHVlIHdpbGwgYWxyZWFkeSBiZSBvbiB0aGUgc3RhY2suCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIEp1bXBJbnN0cnVjdGlvbiBpZkRlZmF1\nbHRWYWx1ZShDb2RlIGNvZGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5U\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAgIGNvZGUuZGNtcGwo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEYpOwogICAgICAgICAgICAgICAg\nY29kZS5mY21wbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZl\ncSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAg\nICAgICAgICAgIGNvZGUubGNtcCgpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIGNvZGUuaWZudWxsKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBnZXQgdGhlIGNvZGUg\nZm9yIHRoZSBjbGFzcyBpbml0aWFsaXplciBtZXRob2QsCiAgICAgKiBjcmVh\ndGluZyB0aGUgbWV0aG9kIGlmIGl0IGRvZXMgbm90IGFscmVhZHkgZXhpc3Qu\nCiAgICAgKi8KICAgIHByaXZhdGUgQ29kZSBnZXRPckNyZWF0ZUNsYXNzSW5p\ndENvZGUoYm9vbGVhbiByZXBsYWNlTGFzdCkgewogICAgICAgIEJDTWV0aG9k\nIGNsaW5pdCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgiPGNsaW5pdD4iKTsK\nICAgICAgICBDb2RlIGNvZGU7CiAgICAgICAgaWYgKGNsaW5pdCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICAgICAgaWYgKHJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgICAg\nICBDb2RlIHRlbXBsYXRlID0gbmV3IENvZGUoKTsKICAgICAgICAgICAgICAg\nIGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0dXJuKCkpOwogICAg\nICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAgICAg\nY29kZS5zZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAgICAgICAgICAgY29k\nZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNv\nZGU7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgc3RhdGljIGluaXRpYWxp\nemVyIG1ldGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAgY2xpbml0ID0gX3Bj\nLmRlY2xhcmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAgICAgICAgY2xpbml0\nLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQuc2V0RmluYWwodHJ1\nZSk7CgogICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVlKTsKICAg\nICAgICBpZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBjb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyBieXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25pbmcgYmVoYXZpb3Ig\nb2YgdGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCB0byBjb3JyZWN0\nbHkgcmVwbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFnZXI8L2NvZGU+IAog\nICAgICogaW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9uZSBjcmVhdGVkIHdp\ndGggdGhlaXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICogQWxzbywgaWYgdGhp\ncyBjbGFzcyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBkb2VzIG5vdCBkZWNs\nYXJlZCAKICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUgd2lsbCBiZSBhZGRl\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkg\newogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGFkZCB0aGUgY2xv\nbmUgbWV0aG9kIGlmIG5lY2Vzc2FyeQogICAgICAgIEJDTWV0aG9kIGNsb25l\nID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCJjbG9uZSIsIChTdHJpbmdbXSkg\nbnVsbCk7CiAgICAgICAgU3RyaW5nIHN1cGVyTmFtZSA9IF9wYy5nZXRTdXBl\ncmNsYXNzTmFtZSgpOwogICAgICAgIENvZGUgY29kZSA9IG51bGw7CiAgICAg\nICAgaWYgKGNsb25lID09IG51bGwpIHsKICAgICAgICAgICAgLy8gYWRkIGNs\nb25lIHN1cHBvcnQgZm9yIGJhc2UgY2xhc3NlcwogICAgICAgICAgICAvLyB3\naGljaCBhbHNvIGltcGxlbWVudCBjbG9uZWFibGUKICAgICAgICAgICAgaWYg\nKCFfcGMuaXNJbnN0YW5jZU9mKENsb25lYWJsZS5jbGFzcykKICAgICAgICAg\nICAgICAgIHx8ICFzdXBlck5hbWUuZXF1YWxzKE9iamVjdC5jbGFzcy5nZXRO\nYW1lKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtY2xvbmVhYmxlIiwgX3BjLmdl\ndFR5cGUoKSkpOwoKICAgICAgICAgICAgLy8gYWRkIGNsb25lIG1ldGhvZAog\nICAgICAgICAgICAvLyBwcm90ZWN0ZWQgT2JqZWN0IGNsb25lICgpIHRocm93\ncyBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbgogICAgICAgICAgICBjbG9u\nZSA9IF9wYy5kZWNsYXJlTWV0aG9kKCJjbG9uZSIsIE9iamVjdC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgIGNsb25lLm1ha2VQcm90ZWN0ZWQoKTsKICAg\nICAgICAgICAgY2xvbmUuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRp\nb24KICAgICAgICAgICAgICAgIChDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlv\nbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUgPSBjbG9uZS5nZXRDb2RlKHRy\ndWUpOwoKICAgICAgICAgICAgLy8gcmV0dXJuIHN1cGVyLmNsb25lICgpOwog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9w\nYy5nZXRTdXBlcmNsYXNzTmFtZSgpLAogICAgICAgICAgICAgICAgImNsb25l\nIiwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7CiAgICAgICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIC8vIGdldCB0aGUgY2xvbmUgbWV0aG9kIGNvZGUKICAgICAgICAgICAgY29k\nZSA9IGNsb25lLmdldENvZGUoZmFsc2UpOwogICAgICAgICAgICBpZiAoY29k\nZSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgLy8gY3JlYXRlIHRlbXBsYXRlIHN1cGVyLmNsb25lICgpIGlu\nc3RydWN0aW9uIHRvIG1hdGNoIGFnYWluc3QKICAgICAgICBJbnN0cnVjdGlv\nbiB0ZW1wbGF0ZSA9IG5ldyBDb2RlKCkuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZAogICAgICAgICAgICAoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3Qu\nY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxs\ncyB0byB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAg\nICAgLy8gY2xvbmUgd2lsbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVm\nb3JlRmlyc3QoKTsKICAgICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRl\nbXBsYXRlKSkgewogICAgICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBj\nU3RhdGVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAg\nICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAg\nICAgICAgICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBy\nZWdpc3RlcmVkIGFzIHtAbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAg\nKi8KICAgIHB1YmxpYyBBdXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFy\neUVuaGFuY2VycygpIHsKCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhp\nbGlhcnkgY29kZSBnZW5lcmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3Ig\nKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAg\nICAJCV9hdXhFbmhhbmNlcnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhv\nZCBiZSBza2lwcGVkLgogICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1l\ndGhvZCB0byBiZSBza2lwcGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVl\nIGlmIGFueSBvZiB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUg\nZ2l2ZW4gbWV0aG9kCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lw\nRW5oYW5jZShCQ01ldGhvZCBtZXRob2QpIHsKICAgIAlmb3IgKGludCBpID0g\nMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCWlmIChf\nYXV4RW5oYW5jZXJzW2ldLnNraXBFbmhhbmNlKG1ldGhvZCkpCiAgICAJCQly\nZXR1cm4gdHJ1ZTsKICAgIAlyZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcyB0\naGF0IHdpbGwgcmVwbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBhY2Nl\nc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29ycygp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBhZGRHZXRNZXRob2QoaSwgZm1kc1tp\nXSk7CiAgICAgICAgICAgIGFkZFNldE1ldGhvZChpLCBmbWRzW2ldKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgc3RhdGljIGdl\ndHRlciBtZXRob2QgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqIFRoZSBn\nZW5lcmF0ZWQgbWV0aG9kIGludGVyYWN0cyB3aXRoIHRoZSBpbnN0YW5jZSBz\ndGF0ZSBhbmQgdGhlCiAgICAgKiBTdGF0ZU1hbmFnZXIgdG8gZ2V0IHRoZSB2\nYWx1ZSBvZiB0aGUgZmllbGQuCiAgICAgKgogICAgICogQHBhcmFtIGluZGV4\nIHRoZSByZWxhdGl2ZSBudW1iZXIgb2YgdGhlIGZpZWxkCiAgICAgKiBAcGFy\nYW0gZm1kIG1ldGFkYXRhIGFib3V0IHRoZSBmaWVsZCB0byBnZXQKICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldE1ldGhvZChpbnQgaW5kZXgsIEZp\nZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IGNyZWF0ZUdl\ndE1ldGhvZChmbWQpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiByZWFkcyBhcmUgbm90IGNoZWNr\nZWQsIGp1c3QgcmV0dXJuIHRoZSB2YWx1ZQogICAgICAgIGJ5dGUgZmllbGRG\nbGFnID0gZ2V0RmllbGRGbGFnKGZtZCk7CiAgICAgICAgaWYgKChmaWVsZEZs\nYWcgJiBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfUkVBRCkgPT0gMAogICAg\nICAgICAgICAmJiAoZmllbGRGbGFnICYgUGVyc2lzdGVuY2VDYXBhYmxlLk1F\nRElBVEVfUkVBRCkgPT0gMCkgewogICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIGNvZGUueHJldHVy\nbigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgKGluc3QucGNTdGF0ZU1hbmFnZXIg\nPT0gbnVsbCkgcmV0dXJuIGluc3QuPGZpZWxkPjsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgYWRkR2V0TWFu\nYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIGNvZGUueHJldHVy\nbigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAg\nLy8gaW50IGZpZWxkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGZpZWxk\naW5kZXg+OwogICAgICAgIGludCBmaWVsZExvY2FsID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAg\nIGNvZGUuaWFkZCgpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwo\nZmllbGRMb2NhbCk7CgogICAgICAgIC8vIGluc3QucGNTdGF0ZU1hbmFnZXIu\nYWNjZXNzaW5nRmllbGQgKGZpZWxkKTsKICAgICAgICAvLyByZXR1cm4gaW5z\ndC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\ndHJ1ZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChmaWVsZExv\nY2FsKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChTTVRZUEUsICJhY2Nlc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54cmV0\ndXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\nYSBzdGF0aWMgc2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgog\nICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhl\nIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0\nbyBzZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQK\nICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRv\nIHNldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2V0TWV0aG9kKGlu\ndCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gY3JlYXRlU2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIFBDRW5oYW5jZXIg\ndXNlcyBzdGF0aWMgbWV0aG9kczsgUENTdWJjbGFzc2VyIGRvZXMgbm90Lgog\nICAgICAgIGludCBmaXJzdFBhcmFtT2Zmc2V0ID0gZ2V0QWNjZXNzb3JQYXJh\nbWV0ZXJPZmZzZXQoKTsKCiAgICAgICAgLy8gaWYgKGluc3QucGNTdGF0ZU1h\nbmFnZXIgPT0gbnVsbCkgaW5zdC48ZmllbGQ+ID0gdmFsdWU7CiAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVt\ncEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNv\nZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0KTsKICAgICAg\nICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAg\nY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8vIGluc3QucGNTdGF0ZU1hbmFn\nZXIuc2V0dGluZzxmaWVsZFR5cGU+RmllbGQgKGluc3QsCiAgICAgICAgLy8J\ncGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGluZGV4PiwgaW5zdC48ZmllbGQ+\nLCB2YWx1ZSwgMCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSkpOwogICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAgIGNvZGUuaWFk\nZCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwog\nICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVN\nYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCksICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBt\nZXRob2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0\ndGFjaERldGFjaENvZGUoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2Vz\nIGFyZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hh\nYmxlID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVu\ndCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nICAgIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKSkgewogICAgICAgICAgICBpZiAocGFyZW50Lmlz\nRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJlbnREZXRhY2hh\nYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFj\naGFibGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRz\nIGFuZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAo\nX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbAogICAgICAgICAgICB8\nfCBwYXJlbnREZXRhY2hhYmxlICE9IF9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7\nCiAgICAgICAgICAgIGFkZElzRGV0YWNoZWRNZXRob2QoKTsKICAgICAgICAg\nICAgYWRkRGV0YWNoZWRTdGF0ZU1ldGhvZHMoX21ldGEudXNlc0RldGFjaGVk\nU3RhdGUoKQogICAgICAgICAgICAgICAgIT0gQm9vbGVhbi5GQUxTRSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiB3ZSBkZXRhY2ggb24gc2VyaWFsaXpl\nLCB3ZSBhbHNvIG5lZWQgdG8gaW1wbGVtZW50IHRoZQogICAgICAgIC8vIGV4\ndGVybmFsaXphYmxlIGludGVyZmFjZSB0byB3cml0ZSBqdXN0IHRoZSBzdGF0\nZSBmb3IgdGhlIGZpZWxkcwogICAgICAgIC8vIGJlaW5nIGRldGFjaGVkCiAg\nICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNoZWQoKSkgewogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgYWRkRGV0YWNoRXh0ZXJuYWxpemUo\ncGFyZW50RGV0YWNoYWJsZSwKICAgICAgICAgICAgICAgICAgICBfbWV0YS51\nc2VzRGV0YWNoZWRTdGF0ZSgpICE9IEJvb2xlYW4uRkFMU0UpOwogICAgICAg\nICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24obnNt\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGZpZWxkcyB0byBob2xkIGRldGFjaGVkIHN0YXRlIGFu\nZCB0aGVpciBhY2Nlc3NvciBtZXRob2RzLgogICAgICoKICAgICAqIEBwYXJh\nbSBpbXBsIHdoZXRoZXIgdG8gZnVsbHkgaW1wbGVtZW50IGRldGFjaCBzdGF0\nZSBmdW5jdGlvbmFsaXR5CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRE\nZXRhY2hlZFN0YXRlTWV0aG9kcyhib29sZWFuIGltcGwpIHsKICAgICAgICBG\naWVsZCBkZXRhY2hGaWVsZCA9IF9tZXRhLmdldERldGFjaGVkU3RhdGVGaWVs\nZCgpOwogICAgICAgIFN0cmluZyBuYW1lID0gbnVsbDsKICAgICAgICBTdHJp\nbmcgZGVjbGFyZXIgPSBudWxsOwogICAgICAgIGlmIChpbXBsICYmIGRldGFj\naEZpZWxkID09IG51bGwpIHsKICAgICAgICAgICAgbmFtZSA9IFBSRSArICJE\nZXRhY2hlZFN0YXRlIjsKICAgICAgICAgICAgZGVjbGFyZXIgPSBfcGMuZ2V0\nTmFtZSgpOwogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xh\ncmVGaWVsZChuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBmaWVs\nZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICBmaWVsZC5zZXRUcmFuc2ll\nbnQodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChpbXBsKSB7CiAgICAgICAg\nICAgIG5hbWUgPSBkZXRhY2hGaWVsZC5nZXROYW1lKCk7CiAgICAgICAgICAg\nIGRlY2xhcmVyID0gZGV0YWNoRmllbGQuZ2V0RGVjbGFyaW5nQ2xhc3MoKS5n\nZXROYW1lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0\nIHBjR2V0RGV0YWNoZWRTdGF0ZSAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBt\nZXRob2Quc2V0U3RhdGljKGZhbHNlKTsKICAgICAgICBtZXRob2QubWFrZVB1\nYmxpYygpOwogICAgICAgIGludCBhY2Nlc3MgPSBtZXRob2QuZ2V0QWNjZXNz\nRmxhZ3MoKTsKCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgaWYgKGltcGwpIHsKICAgICAgICAgICAgLy8gcmV0\ndXJuIHBjRGV0YWNoZWRTdGF0ZTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChkZWNsYXJlciwgbmFtZSwgT2JqZWN0LmNsYXNzLmdl\ndE5hbWUoKSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lk\nIHBjU2V0RGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAgICAgIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0\nYXRlIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzIFtdeyBP\nYmplY3QuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdz\nKGFjY2Vzcyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwogICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBjRGV0YWNo\nZWRTdGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0Rmll\nbGQoZGVjbGFyZXIsIG5hbWUsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbXBsZW1lbnQgdGhlIGV4dGVybmFsaXphYmxlIGludGVyZmFjZSB0\nbyBkZXRhY2ggb24gc2VyaWFsaXplLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVhbiBwYXJlbnREZXRhY2hh\nYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBlbnN1\ncmUgdGhhdCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBjb25zdHJ1Y3RvciBpcyBw\ndWJsaWMgCiAgICAgICAgLy8gZm9yIGV4dGVybmFsaXphdGlvbgogICAgICAg\nIEJDTWV0aG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIjxpbml0\nPiIsIChTdHJpbmdbXSkgbnVsbCk7CiAgICAgICAgaWYgKCFtZXRoLmlzUHVi\nbGljKCkpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNl\nLWRlZmNvbnMtZXh0ZXJuIiwgCiAgICAgICAgICAgICAgICAgIF9tZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSkpOwogICAgICAgICAgICBtZXRoLm1ha2VQdWJs\naWMoKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVjbGFyZSBleHRlcm5hbGl6\nYWJsZSBpbnRlcmZhY2UKICAgICAgICBpZiAoIUV4dGVybmFsaXphYmxlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nKSkKICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoRXh0ZXJuYWxp\nemFibGUuY2xhc3MpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHVzZXIg\nZG9lc24ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4dGVybmFsaXphdGlvbiBv\ncgogICAgICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0aG9kcwogICAgICAgIENs\nYXNzW10gaW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0u\nY2xhc3MgfTsKICAgICAgICBDbGFzc1tdIG91dHB1dCA9IG5ldyBDbGFzc1td\neyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBpZiAoX3Bj\nLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2JqZWN0IiwgaW5wdXQpICE9IG51\nbGwKICAgICAgICAgICAgfHwgX3BjLmdldERlY2xhcmVkTWV0aG9kKCJ3cml0\nZU9iamVjdCIsIG91dHB1dCkgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImRldGFjaC1jdXN0b20tc2Vy\nIiwgX21ldGEpKTsKICAgICAgICBpbnB1dFswXSA9IE9iamVjdElucHV0LmNs\nYXNzOwogICAgICAgIG91dHB1dFswXSA9IE9iamVjdE91dHB1dC5jbGFzczsK\nICAgICAgICBpZiAoX3BjLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkRXh0ZXJu\nYWwiLCBpbnB1dCkgIT0gbnVsbAogICAgICAgICAgICB8fCBfcGMuZ2V0RGVj\nbGFyZWRNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCBvdXRwdXQpICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJkZXRhY2gtY3VzdG9tLWV4dGVybiIsIF9tZXRhKSk7CgogICAgICAgIC8v\nIGNyZWF0ZSBsaXN0IG9mIGFsbCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZp\nZWxkcwogICAgICAgIEJDRmllbGRbXSBmaWVsZHMgPSBfcGMuZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVubWdkID0gbmV3IEFy\ncmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nIWZpZWxkc1tpXS5pc1RyYW5zaWVudCgpICYmICFmaWVsZHNbaV0uaXNTdGF0\naWMoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5pc0ZpbmFsKCkK\nICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uZ2V0TmFtZSgpLnN0YXJ0\nc1dpdGgoUFJFKQogICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0RGVjbGFy\nZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAgfQoKICAg\nICAgICBhZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJsZSwgZGV0YWNo\nZWRTdGF0ZSk7CiAgICAgICAgYWRkUmVhZFVubWFuYWdlZCh1bm1nZCwgcGFy\nZW50RGV0YWNoYWJsZSk7CiAgICAgICAgYWRkV3JpdGVFeHRlcm5hbChwYXJl\nbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAgICBhZGRXcml0\nZVVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRFeHRlcm5hbCBtZXRob2Qu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkRXh0ZXJuYWwoYm9v\nbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNo\nZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFzc1tdeyBPYmpl\nY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMu\nZGVjbGFyZU1ldGhvZCgicmVhZEV4dGVybmFsIiwgdm9pZC5jbGFzcywgaW5h\ncmdzKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhj\nZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElP\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9u\nKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIu\ncmVhZEV4dGVybmFsIChpbik7CiAgICAgICAgQ2xhc3Mgc3VwID0gX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBp\nZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFibGUuY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChzdXAsICJyZWFkRXh0ZXJuYWwiLAogICAgICAg\nICAgICAgICAgdm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAgICAgICAgICBQUkUgKyAiUmVh\nZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJncyk7CgogICAgICAgIGlm\nIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIHBjU2V0RGV0YWNo\nZWRTdGF0ZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAicmVh\nZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKCiAgICAg\nICAgICAgIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoKFN0YXRlTWFuYWdl\ncikgaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAicmVhZE9iamVj\ndCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3RhdGVNYW5hZ2Vy\nLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdGF0ZU1hbmFnZXIu\nY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFkIG1hbmFnZWQg\nZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5n\nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1RyYW5z\naWVudCgpKQogICAgICAgICAgICAgICAgcmVhZEV4dGVybmFsKGNvZGUsIGZt\nZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxkcyBmcm9tIHRoZSBzdHJl\nYW0gKHBjUmVhZFVubWFuYWdlZCkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRSZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFz\nc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1l\ndGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVhZFVubWFuYWdlZCIs\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIGluYXJncyk7CiAgICAgICAgbWV0\naC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMg\nPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFk\nZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZXhjZXBz\nLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIC8vIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBpZiAo\ncGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiUmVhZFVubWFuYWdl\nZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAgICAgaW5hcmdzKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHJlYWQgZGVjbGFyZWQgdW5tYW5hZ2VkIHNl\ncmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVsZCkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgcmVhZEV4dGVybmFsKGNvZGUsIGZp\nZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgpLCBudWxsKTsKICAgICAg\nICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRv\nIHJlYWQgYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFsaXphdGlvbiBpbnB1dCBz\ndHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFkRXh0ZXJuYWwo\nQ29kZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hN\nZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsKICAg\nICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAgIG1l\ndGhOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhOYW1l\nID0gQ2hhcmFjdGVyLnRvVXBwZXJDYXNlKG1ldGhOYW1lLmNoYXJBdCgwKSkK\nICAgICAgICAgICAgICAgICsgbWV0aE5hbWUuc3Vic3RyaW5nKDEpOwogICAg\nICAgICAgICBtZXRoTmFtZSA9ICJyZWFkIiArIG1ldGhOYW1lOwogICAgICAg\nIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFkT2JqZWN0IjsK\nCiAgICAgICAgLy8gPGZpZWxkPiA9IGluLnJlYWQ8dHlwZT4gKCk7CiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIENsYXNzIHJldCA9\nICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVjdC5jbGFzczsK\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmpl\nY3RJbnB1dC5jbGFzcywgbWV0aE5hbWUsCiAgICAgICAgICAgIHJldCwgbnVs\nbCk7CiAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAh\nPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAg\nICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZE5hbWUsIHR5\ncGUpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBhZGRTZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAg\nICAgICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIC8vICAgc20ucHJveHlEZXRhY2hlZERlc2VyaWFsaXplZCAoPGluZGV4\nPik7CiAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgICAg\nIElmSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwogICAgICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZm1kLmdldEluZGV4KCkpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQ\nRSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb3h5RGV0YWNoZWREZXNl\ncmlhbGl6ZWQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgICAgICAgICAg\nICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBjdXN0b20g\nd3JpdGVFeHRlcm5hbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRXcml0ZUV4dGVybmFsKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwK\nICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NbXSBvdXRh\ncmdzID0gbmV3IENsYXNzW117IE9iamVjdE91dHB1dC5jbGFzcyB9OwogICAg\nICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVF\neHRlcm5hbCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAgICAgIEV4Y2Vw\ndGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAg\nICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gc3VwZXIud3JpdGVFeHRlcm5hbCAob3V0KTsKICAgICAgICBDbGFz\ncyBzdXAgPSBnZXRUeXBlKF9tZXRhKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAg\nICAgaWYgKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3VwLCAid3JpdGVFeHRlcm5hbCIsCiAg\nICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHdyaXRlVW5tYW5hZ2VkIChvdXQpOwogICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YSksCiAgICAgICAgICAgIFBS\nRSArICJXcml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwoK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gbnVsbDsKICAgICAgICBp\nZiAoZGV0YWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBpZiAoc20gIT0g\nbnVsbCkKICAgICAgICAgICAgLy8gICBpZiAoc20ud3JpdGVEZXRhY2hlZCAo\nb3V0KSkKICAgICAgICAgICAgLy8gICAgICByZXR1cm47CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZudWxsID0gY29kZS5pZm51bGwoKTsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChT\nTVRZUEUsICJ3cml0ZURldGFjaGVkIiwKICAgICAgICAgICAgICAgIGJvb2xl\nYW4uY2xhc3MsIG91dGFyZ3MpOwogICAgICAgICAgICBnbzIgPSBjb2RlLmlm\nZXEoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgICAg\nICAvLyBlbHNlCiAgICAgICAgICAgIC8vICAgb3V0LndyaXRlT2JqZWN0IChw\nY0dldERldGFjaGVkU3RhdGUgKCkpOwogICAgICAgICAgICBDbGFzc1tdIG9i\namFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH07CiAgICAgICAg\nICAgIGlmbnVsbC5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3MsCiAgICAg\nICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLCBvYmphcmdz\nKTsKICAgICAgICAgICAgLy8gICAgb3V0LndyaXRlT2JqZWN0IChudWxsKSAv\nLyBTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nKE9iamVjdCkgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywKICAgICAgICAg\nICAgICAgICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9iamFyZ3MpOwog\nICAgICAgIH0KICAgICAgICBpZiAoZ28yICE9IG51bGwpCiAgICAgICAgICAg\nIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAgIC8vIHdyaXRl\nIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tp\nXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgd3JpdGVFeHRlcm5h\nbChjb2RlLCBmbWRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAg\nICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAg\nICAgLy8gcmV0dXJuCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB1\nbm1hbmFnZWQgZmllbGRzIHRvIHRoZSBzdHJlYW0gKHBjV3JpdGVVbm1hbmFn\nZWQpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVVbm1hbmFn\nZWQoQ29sbGVjdGlvbiB1bm1nZCwgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRw\ndXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgb3V0YXJncyk7CiAgICAgICAgbWV0aC5tYWtlUHJvdGVj\ndGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4\nY2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJ\nT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci53cml0ZVVubWFuYWdl\nZCAob3V0KTsKICAgICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0\nYS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkp\nLCBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCAKICAgICAg\nICAgICAgICAgIG91dGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gd3Jp\ndGUgZGVjbGFyZWQgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAg\nICAgICBCQ0ZpZWxkIGZpZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgZmllbGQgPSAoQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmaWVsZC5nZXROYW1lKCksIGZpZWxk\nLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byB3cml0ZSBhIGZpZWxkIHRvIGFu\nIGV4dGVybmFsaXphdGlvbiBvdXRwdXQgc3RyZWFtLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd3JpdGVFeHRlcm5hbChDb2RlIGNvZGUsIFN0cmluZyBm\naWVsZE5hbWUsIENsYXNzIHR5cGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgU3RyaW5nIG1ldGhOYW1lOwogICAgICAgIGlmICh0eXBlLmlzUHJp\nbWl0aXZlKCkpIHsKICAgICAgICAgICAgbWV0aE5hbWUgPSB0eXBlLmdldE5h\nbWUoKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSBDaGFyYWN0ZXIudG9VcHBl\nckNhc2UobWV0aE5hbWUuY2hhckF0KDApKQogICAgICAgICAgICAgICAgKyBt\nZXRoTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0g\nIndyaXRlIiArIG1ldGhOYW1lOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBtZXRoTmFtZSA9ICJ3cml0ZU9iamVjdCI7CgogICAgICAgIC8vIG91dC53\ncml0ZTx0eXBlPiAoPGZpZWxkPik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGZpZWxkTmFtZSwgdHlwZSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIGZtZCk7CiAgICAgICAgQ2xhc3NbXSBhcmdzID0gbmV3IENsYXNz\nW117IHR5cGUgfTsKICAgICAgICBpZiAodHlwZSA9PSBieXRlLmNsYXNzIHx8\nIHR5cGUgPT0gY2hhci5jbGFzcyB8fCB0eXBlID09IHNob3J0LmNsYXNzKQog\nICAgICAgICAgICBhcmdzWzBdID0gaW50LmNsYXNzOwogICAgICAgIGVsc2Ug\naWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIGFyZ3NbMF0g\nPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNzLCBtZXRoTmFtZSwKICAg\nICAgICAgICAgdm9pZC5jbGFzcywgYXJncyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBMb2FkIHRoZSBmaWVsZCB2YWx1ZSBzcGVjaWZpZWQgYnkgPGNvZGU+\nZm1kPC9jb2RlPiBvbnRvIHRoZSBzdGFjay4KICAgICAqIEJlZm9yZSB0aGlz\nIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBz\naG91bGQgYmUgbG9hZGVkCiAgICAgKiBmcm9tIHdpbGwgYmUgb24gdGhlIHRv\ncCBvZiB0aGUgc3RhY2suCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBm\nbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLkFDQ0VTU19GSUVMRCkKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKGZtZC5nZXROYW1lKCksIGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSk7CiAgICAgICAgZWxzZSAvLyBwcm9wZXJ0eQogICAgICAgIHsKICAgICAg\nICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0QmFja2luZ01l\nbWJlcigpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoUFJFICsgbWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBt\nZXRoLmdldFJldHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSB0aGUg\ndmFsdWUgYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2sgaW50byB0aGUgZmllbGQg\ndmFsdWUgc3BlY2lmaWVkCiAgICAgKiBieSA8Y29kZT5mbWQ8L2NvZGU+LiBC\nZWZvcmUgdGhpcyBtZXRob2QgaXMgY2FsbGVkLCB0aGUgZGF0YSB0byBsb2Fk\nIHdpbGwKICAgICAqIGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGFuZCB0\naGUgb2JqZWN0IHRoYXQgdGhlIGRhdGEgc2hvdWxkIGJlIGxvYWRlZAogICAg\nICogaW50byB3aWxsIGJlIHNlY29uZCBpbiB0aGUgc3RhY2suCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUg\nY29kZSwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9tZXRhLmdldEFjY2Vz\nc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkKICAgICAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGZtZC5nZXROYW1lKCks\nIGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgZWxzZSAvLyBwcm9w\nZXJ0eQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoUFJFICsgZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW117IGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgb2Zmc2V0\nIHRoYXQgdGhlIGZpcnN0IG1lYW5pbmdmdWwgYWNjZXNzb3IgcGFyYW1ldGVy\nIGlzIGF0LgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRBY2Nlc3NvclBh\ncmFtZXRlck9mZnNldCgpIHsKICAgICAgICByZXR1cm4gKF9tZXRhLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgPyAx\nIDogMDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUge0BsaW5rIElu\nc3RydWN0aW9ufXMgdG8gbG9hZCB0aGUgaW5zdGFuY2UgdG8gbW9kaWZ5IG9u\ndG8gdGhlCiAgICAgKiBzdGFjaywgYW5kIHJldHVybiBpdC4gSWYgPGNvZGU+\ndXNlck9iamVjdDwvY29kZT4gaXMgc2V0LAogICAgICogdGhlbiA8Y29kZT5j\nb2RlPC9jb2RlPiB3aWxsIGJlIGFjY2Vzc2luZyBkYXRhIGluIHRoZSB1c2Vy\nLXZpc2libGUKICAgICAqIG9iamVjdCAod2hpY2ggbWlnaHQgbm90IGJlICd0\naGlzJyBpbiBwcm94eWluZyBjb250ZXh0cyksCiAgICAgKiBhbmQgdGhlIGxv\nYWQgY29kZSBzaG91bGQgYmVoYXZlIGFjY29yZGluZ2x5LiBPdGhlcndpc2Us\nCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiB3aWxsIGJlIGFjY2Vzc2luZyBQ\nQy1jb250cmFjdCBkYXRhLCB3aGljaCBtdXN0IGFsd2F5cwogICAgICogYmUg\naW4gJ3RoaXMnLiBJZiA8Y29kZT5mb3JBY2Nlc29yPC9jb2RlPiBpcyBzZXQs\nIHRoZW4gPGNvZGU+Y29kZTwvY29kZT4KICAgICAqIGlzIGluIGFuIGFjY2Vz\nc29yIG1ldGhvZDsgb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBD\nLXNwZWNpZmllZAogICAgICogbWV0aG9kcy4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRoZSBmaXJzdCBpbnN0cnVjdGlvbiBhZGRlZCB0byA8Y29kZT5jb2Rl\nPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBJbnN0cnVjdGlvbiBsb2Fk\nTWFuYWdlZEluc3RhbmNlKENvZGUgY29kZSwKICAgICAgICBib29sZWFuIGZv\nckFjY2Vzc29yKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCAmJiBmb3JBY2Nlc3Nv\ncikKICAgICAgICAgICAgcmV0dXJuIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgZ2VuZXJhdGVkIGdldHRl\nciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8L2NvZGU+LiBUaGUK\nICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0aGVuIHBvcHVsYXRl\nIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAgICAqLwogICAgcHJpdmF0\nZSBCQ01ldGhvZCBjcmVhdGVHZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXI7CiAgICAgICAgaWYgKF9tZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgPGZpZWxkdHlwZT4gcGNHZXQ8\nZmllbGQ+IChYWFggaW5zdCkKICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9\nIF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXROYW1lKCkpOwogICAgICAg\nICAgICBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0IiAr\nIGZtZC5nZXROYW1lKCksIGZtZC4KICAgICAgICAgICAgICAgIGdldERlY2xh\ncmVkVHlwZSgpLmdldE5hbWUoKSwgbmV3IFN0cmluZ1tdeyBfcGMuZ2V0TmFt\nZSgpIH0pOwogICAgICAgICAgICBnZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZmll\nbGQuZ2V0QWNjZXNzRmxhZ3MoKQogICAgICAgICAgICAgICAgJiB+Q29uc3Rh\nbnRzLkFDQ0VTU19UUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VTU19WT0xB\nVElMRSk7CiAgICAgICAgICAgIGdldHRlci5zZXRTdGF0aWModHJ1ZSk7CiAg\nICAgICAgICAgIGdldHRlci5zZXRGaW5hbCh0cnVlKTsKICAgICAgICAgICAg\ncmV0dXJuIGdldHRlcjsKICAgICAgICB9CgogICAgICAgIC8vIHByb3BlcnR5\nIGFjY2VzczoKICAgICAgICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0dGVyIG1l\ndGhvZCB0byBhIG5ldyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0CiAgICAg\nICAgLy8gdGhlIG5hbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28gcmVzZXQg\nYWxsIGNhbGxzIHRvIHRoZSBtZXRob2QKICAgICAgICBNZXRob2QgbWV0aCA9\nIChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgZ2V0\ndGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAog\nICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAg\nIEJDTWV0aG9kIG5ld2dldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nIG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICBtZXRoLmdldFJldHVyblR5\ncGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBuZXdn\nZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZ2V0dGVyLmdldEFjY2Vzc0ZsYWdzKCkp\nOwogICAgICAgIG5ld2dldHRlci5tYWtlUHJpdmF0ZSgpOwogICAgICAgIHRy\nYW5zZmVyQ29kZUF0dHJpYnV0ZXMoZ2V0dGVyLCBuZXdnZXR0ZXIpOwogICAg\nICAgIHJldHVybiBnZXR0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgdGhlIGdlbmVyYXRlZCBzZXR0ZXIge0BsaW5rIEJDTWV0aG9kfSBmb3Ig\nPGNvZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5nIGVudmlyb25t\nZW50IHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdzIGNvZGUgYmxv\nY2suCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3JlYXRlU2V0TWV0\naG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNNZXRob2Qgc2V0\ndGVyOwogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAgLy8gc3Rh\ndGljIHZvaWQgcGNTZXQ8ZmllbGQ+IChYWFggaW5zdCwgPGZpZWxkdHlwZT4g\ndmFsdWUpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVj\nbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgc2V0dGVy\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNldCIgKyBmbWQuZ2V0TmFt\nZSgpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117\nIGdldFR5cGUoX21ldGEpLCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAg\nICAgICAgICAgIHNldHRlci5zZXRBY2Nlc3NGbGFncyhmaWVsZC5nZXRBY2Nl\nc3NGbGFncygpCiAgICAgICAgICAgICAgICAmIH5Db25zdGFudHMuQUNDRVNT\nX1RSQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNTX1ZPTEFUSUxFKTsKICAg\nICAgICAgICAgc2V0dGVyLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAg\nc2V0dGVyLnNldEZpbmFsKHRydWUpOwogICAgICAgICAgICByZXR1cm4gc2V0\ndGVyOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzOgog\nICAgICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0ZXIgbWV0aG9kIHRvIGEg\nbmV3IG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQKICAgICAgICAvLyB0aGUg\nbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyByZXNldCBhbGwgY2FsbHMg\ndG8gdGhlIG1ldGhvZAogICAgICAgIHNldHRlciA9IF9wYy5nZXREZWNsYXJl\nZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAgICAgICAgIG5ldyBD\nbGFzc1tdeyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgQkNN\nZXRob2QgbmV3c2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgc2V0\ndGVyLmdldE5hbWUoKSwKICAgICAgICAgICAgc2V0dGVyLmdldFJldHVybk5h\nbWUoKSwgc2V0dGVyLmdldFBhcmFtTmFtZXMoKSk7CiAgICAgICAgbmV3c2V0\ndGVyLnNldEFjY2Vzc0ZsYWdzKHNldHRlci5nZXRBY2Nlc3NGbGFncygpKTsK\nICAgICAgICBuZXdzZXR0ZXIubWFrZVByaXZhdGUoKTsKICAgICAgICB0cmFu\nc2ZlckNvZGVBdHRyaWJ1dGVzKHNldHRlciwgbmV3c2V0dGVyKTsKICAgICAg\nICByZXR1cm4gc2V0dGVyOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRH\nZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpIHsKICAgICAg\nICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9u\nKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAKICAgICAgICAgICAgICAgICJHZXRFbmhhbmNlbWVudENvbnRy\nYWN0VmVyc2lvbiIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9k\nLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nRU5IQU5DRVJfVkVSU0lPTik7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgcmV0dXJuOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25jcmV0ZSB0eXBlIGZvciB0\naGUgZ2l2ZW4gY2xhc3MsIGkuZS4gaW1wbCBmb3IgbWFuYWdlZAogICAgICog\naW50ZXJmYWNlcwogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0VHlwZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRJbnRl\ncmZhY2VJbXBsKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1ldGEu\nZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIHJldHVybiBtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1vdmUgY29k\nZS1yZWxhdGVkIGF0dHJpYnV0ZXMgZnJvbSBvbmUgbWV0aG9kIHRvIGFub3Ro\nZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdHJhbnNmZXJD\nb2RlQXR0cmlidXRlcyhCQ01ldGhvZCBmcm9tLCBCQ01ldGhvZCB0bykgewog\nICAgICAgIENvZGUgY29kZSA9IGZyb20uZ2V0Q29kZShmYWxzZSk7CiAgICAg\nICAgaWYgKGNvZGUgIT0gbnVsbCkgewogICAgICAgICAgICB0by5hZGRBdHRy\naWJ1dGUoY29kZSk7CiAgICAgICAgICAgIGZyb20ucmVtb3ZlQ29kZSgpOwog\nICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBmcm9tLmdl\ndEV4Y2VwdGlvbnMoZmFsc2UpOwogICAgICAgIGlmIChleGNlcHMgIT0gbnVs\nbCkKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRlKGV4Y2Vwcyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBhY2hlLm9wZW5q\ncGEuZW5oYW5jZS5QQ0VuaGFuY2VyIFtvcHRpb25dKgogICAgICogJmx0O2Ns\nYXNzIG5hbWUgfCAuamF2YSBmaWxlIHwgLmNsYXNzIGZpbGUgfCAuamRvIGZp\nbGUmZ3Q7KwogICAgICogIFdoZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBh\ncmUgcmVjb2duaXplZC4KICAgICAqIDx1bD4KICAgICAqIDxsaT48aT4tcHJv\ncGVydGllcy8tcCAmbHQ7cHJvcGVydGllcyBmaWxlJmd0OzwvaT46IFRoZSBw\nYXRoIHRvIGEgT3BlbkpQQQogICAgICogcHJvcGVydGllcyBmaWxlIGNvbnRh\naW5pbmcgaW5mb3JtYXRpb24gYXMgb3V0bGluZWQgaW4KICAgICAqIHtAbGlu\nayBDb25maWd1cmF0aW9ufTsgb3B0aW9uYWwuPC9saT4KICAgICAqIDxsaT48\naT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7ICZsdDtwcm9wZXJ0eSB2YWx1ZSZn\ndDs8L2k+OiBBbGwgYmVhbgogICAgICogcHJvcGVydGllcyBvZiB0aGUgc3Rh\nbmRhcmQgT3BlbkpQQSB7QGxpbmsgT3BlbkpQQUNvbmZpZ3VyYXRpb259IGNh\nbiBiZQogICAgICogc2V0IGJ5IHVzaW5nIHRoZWlyIG5hbWVzIGFuZCBzdXBw\nbHlpbmcgYSB2YWx1ZTsgZm9yIGV4YW1wbGU6CiAgICAgKiA8bGk+PGk+LWRp\ncmVjdG9yeS8tZCAmbHQ7YnVpbGQgZGlyZWN0b3J5Jmd0OzwvaT46IFRoZSBw\nYXRoIHRvIHRoZSBiYXNlCiAgICAgKiBkaXJlY3Rvcnkgd2hlcmUgZW5oYW5j\nZWQgY2xhc3NlcyBhcmUgc3RvcmVkLiBCeSBkZWZhdWx0LCB0aGUKICAgICAq\nIGVuaGFuY2VyIG92ZXJ3cml0ZXMgdGhlIG9yaWdpbmFsIC5jbGFzcyBmaWxl\nIHdpdGggdGhlIGVuaGFuY2VkCiAgICAgKiB2ZXJzaW9uLiBVc2UgdGhpcyBv\ncHRpb24gdG8gc3RvcmUgdGhlIGdlbmVyYXRlZCAuY2xhc3MgZmlsZSBpbgog\nICAgICogYW5vdGhlciBkaXJlY3RvcnkuIFRoZSBwYWNrYWdlIHN0cnVjdHVy\nZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aAogICAgICogdGhlIGdpdmVuIGRp\ncmVjdG9yeS48L2xpPgogICAgICogPGxpPjxpPi1hZGREZWZhdWx0Q29uc3Ry\ndWN0b3IvLWFkYyBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+OiBXaGV0aGVyIHRv\nCiAgICAgKiBhZGQgYSBkZWZhdWx0IGNvbnN0cnVjdG9yIHRvIHBlcnNpc3Rl\nbnQgY2xhc3NlcyBtaXNzaW5nIG9uZSwgYXMKICAgICAqIG9wcG9zZWQgdG8g\ndGhyb3dpbmcgYW4gZXhjZXB0aW9uLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+\nCiAgICAgKiA8bGk+PGk+LXRtcENsYXNzTG9hZGVyLy10Y2wgW3RydWUvdCB8\nIGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAgICogbG9hZCB0aGUgcHJl\nLWVuaGFuY2VkIGNsYXNzZXMgdXNpbmcgYSB0ZW1wb3JhcnkgY2xhc3MgbG9h\nZGVyLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4gU2V0IHRoaXMgdG8gZmFs\nc2Ugd2hlbiBhdHRlbXB0aW5nIHRvIGRlYnVnCiAgICAgKiBjbGFzcyBsb2Fk\naW5nIGVycm9ycy48L2xpPgogICAgICogPGxpPjxpPi1lbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMvLWVwciBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+Ogog\nICAgICogV2hldGhlciB0byB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBQUk9Q\nRVJUWSBhY2Nlc3MgZW50aXR5IGFwcGVhcnMKICAgICAqIHRvIGJlIHZpb2xh\ndGluZyBzdGFuZGFyZCBwcm9wZXJ0eSByZXN0cmljdGlvbnMuIERlZmF1bHRz\nIHRvIGZhbHNlLjwvbGk+CiAgICAgKiA8L3VsPgogICAgICogIEVhY2ggYWRk\naXRpb25hbCBhcmd1bWVudCBjYW4gYmUgZWl0aGVyIHRoZSBmdWxsIGNsYXNz\nIG5hbWUgb2YgdGhlCiAgICAgKiB0eXBlIHRvIGVuaGFuY2UsIHRoZSBwYXRo\nIHRvIHRoZSAuamF2YSBmaWxlIGZvciB0aGUgdHlwZSwgdGhlIHBhdGggdG8K\nICAgICAqIHRoZSAuY2xhc3MgZmlsZSBmb3IgdGhlIHR5cGUsIG9yIHRoZSBw\nYXRoIHRvIGEgLmpkbyBmaWxlIGxpc3Rpbmcgb25lCiAgICAgKiBvciBtb3Jl\nIHR5cGVzIHRvIGVuaGFuY2UuCiAgICAgKiBJZiB0aGUgdHlwZSBiZWluZyBl\nbmhhbmNlZCBoYXMgbWV0YWRhdGEsIGl0IHdpbGwgYmUgZW5oYW5jZWQgYXMg\nYQogICAgICogcGVyc2lzdGVuY2UgY2FwYWJsZSBjbGFzcy4gSWYgbm90LCBp\ndCB3aWxsIGJlIGNvbnNpZGVyZWQgYSBwZXJzaXN0ZW5jZQogICAgICogYXdh\ncmUgY2xhc3MsIGFuZCBhbGwgYWNjZXNzIHRvIGZpZWxkcyBvZiBwZXJzaXN0\nZW5jZSBjYXBhYmxlIGNsYXNzZXMKICAgICAqIHdpbGwgYmUgcmVwbGFjZWQg\nYnkgdGhlIGFwcHJvcHJpYXRlCWdldC9zZXQgbWV0aG9kLiBJZiB0aGUgdHlw\nZQogICAgICogZXhwbGljaXRseSBkZWNsYXJlcyB0aGUgcGVyc2lzdGVuY2Ut\nY2FwYWJsZSBpbnRlcmZhY2UsIGl0IHdpbGwKICAgICAqIG5vdCBiZSBlbmhh\nbmNlZC4gVGh1cywgaXQgaXMgc2FmZSB0byBpbnZva2UgdGhlIGVuaGFuY2Vy\nIG9uIGNsYXNzZXMKICAgICAqIHRoYXQgYXJlIGFscmVhZHkgZW5oYW5jZWQu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1td\nIGFyZ3MpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBP\ncHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIGFyZ3MgPSBv\ncHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwogICAgICAgIE9wZW5KUEFDb25m\naWd1cmF0aW9uIGNvbmYgPSBuZXcgT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBs\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFydW4oY29uZiwg\nYXJncywgb3B0cykpCiAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50\nbG4oX2xvYy5nZXQoImVuaGFuY2UtdXNhZ2UiKSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJucyBmYWxz\nZSBpZiBpbnZhbGlkIG9wdGlvbnMgZ2l2ZW4uCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29u\nZiwgU3RyaW5nW10gYXJncywKICAgICAgICBPcHRpb25zIG9wdHMpCiAgICAg\nICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAob3B0cy5jb250\nYWluc0tleSgiaGVscCIpIHx8IG9wdHMuY29udGFpbnNLZXkoIi1oZWxwIikp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgRmxhZ3MgZmxh\nZ3MgPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kaXJlY3RvcnkgPSBG\naWxlcy5nZXRGaWxlKG9wdHMucmVtb3ZlUHJvcGVydHkoImRpcmVjdG9yeSIs\nICJkIiwKICAgICAgICAgICAgbnVsbCksIG51bGwpOwogICAgICAgIGZsYWdz\nLmFkZERlZmF1bHRDb25zdHJ1Y3RvciA9IG9wdHMucmVtb3ZlQm9vbGVhblBy\nb3BlcnR5CiAgICAgICAgICAgICgiYWRkRGVmYXVsdENvbnN0cnVjdG9yIiwg\nImFkYyIsIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAg\nZmxhZ3MudG1wQ2xhc3NMb2FkZXIgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9w\nZXJ0eQogICAgICAgICAgICAoInRtcENsYXNzTG9hZGVyIiwgInRjbCIsIGZs\nYWdzLnRtcENsYXNzTG9hZGVyKTsKICAgICAgICBmbGFncy5lbmZvcmNlUHJv\ncGVydHlSZXN0cmljdGlvbnMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0\neQogICAgICAgICAgICAoImVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyIs\nICJlcHIiLAogICAgICAgICAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5\nUmVzdHJpY3Rpb25zKTsKCiAgICAgICAgQ29uZmlndXJhdGlvbnMucG9wdWxh\ndGVDb25maWd1cmF0aW9uKGNvbmYsIG9wdHMpOwogICAgICAgIHJldHVybiBy\ndW4oY29uZiwgYXJncywgZmxhZ3MsIG51bGwsIG51bGwsIG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogRW5oYW5jZSB0aGUgZ2l2ZW4gY2xhc3Nlcy4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAgIEZs\nYWdzIGZsYWdzLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIEJ5dGVjb2Rl\nV3JpdGVyIHdyaXRlciwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIpCiAg\nICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobG9hZGVy\nID09IG51bGwpCiAgICAgICAgICAgIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NS\nZXNvbHZlckluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRDbGFzc0xv\nYWRlcihQQ0VuaGFuY2VyLmNsYXNzLCBudWxsKTsKICAgICAgICBpZiAoZmxh\nZ3MudG1wQ2xhc3NMb2FkZXIpCiAgICAgICAgICAgIGxvYWRlciA9IG5ldyBU\nZW1wb3JhcnlDbGFzc0xvYWRlcihsb2FkZXIpOwoKICAgICAgICBpZiAocmVw\nb3MgPT0gbnVsbCkgewogICAgICAgICAgICByZXBvcyA9IGNvbmYubmV3TWV0\nYURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmVwb3Mu\nc2V0U291cmNlTW9kZShNZXRhRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsK\nICAgICAgICB9CgogICAgICAgIExvZyBsb2cgPSBjb25mLmdldExvZyhPcGVu\nSlBBQ29uZmlndXJhdGlvbi5MT0dfVE9PTCk7CiAgICAgICAgQ29sbGVjdGlv\nbiBjbGFzc2VzOwogICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAwKSB7CiAg\nICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJydW5uaW5nLWFsbC1jbGFz\nc2VzIikpOwogICAgICAgICAgICBjbGFzc2VzID0gcmVwb3MubG9hZFBlcnNp\nc3RlbnRUeXBlcyh0cnVlLCBsb2FkZXIpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIENsYXNzQXJnUGFyc2VyIGNhcCA9IGNvbmYuZ2V0TWV0YURh\ndGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1l\ndGFEYXRhRmFjdG9yeSgpLm5ld0NsYXNzQXJnUGFyc2VyKCk7CiAgICAgICAg\nICAgIGNhcC5zZXRDbGFzc0xvYWRlcihsb2FkZXIpOwogICAgICAgICAgICBj\nbGFzc2VzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\nY2xhc3Nlcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChjYXAucGFyc2VUeXBlcyhh\ncmdzW2ldKSkpOwogICAgICAgIH0KCiAgICAgICAgUHJvamVjdCBwcm9qZWN0\nID0gbmV3IFByb2plY3QoKTsKICAgICAgICBCQ0NsYXNzIGJjOwogICAgICAg\nIFBDRW5oYW5jZXIgZW5oYW5jZXI7CiAgICAgICAgaW50IHN0YXR1czsKICAg\nICAgICBDbGFzcyBjbHM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\nbGFzc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIGNscyA9IChDbGFzcykgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLXJ1bm5pbmciLCBjbHMpKTsKCiAgICAg\nICAgICAgIGJjID0gcHJvamVjdC5sb2FkQ2xhc3MoY2xzKTsKICAgICAgICAg\nICAgZW5oYW5jZXIgPSBuZXcgUENFbmhhbmNlcihjb25mLCBiYywgcmVwb3Mp\nOwogICAgICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBlbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAg\nICAgICAgICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5\nKTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVj\ndG9yKGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAg\nIHN0YXR1cyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3Rh\ndHVzID09IEVOSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShfbG9jLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAg\nICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50\nZXJmYWNlIikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBF\nTkhBTkNFX0FXQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJlbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAgICAgZW5o\nYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHByb2plY3Qu\nY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBk\naXJlY3RvcnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERl\nZmF1bHRDb25zdHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gdG1wQ2xhc3NMb2FkZXIgPSB0cnVlOwoJCXB1YmxpYyBib29sZWFuIGVu\nZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwoJfQoKCS8qKgog\nCSAqIFBsdWdpbiBpbnRlcmZhY2UgZm9yIGFkZGl0aW9uYWwgZW5oYW5jZW1l\nbnQuCgkgKi8KCXB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIEF1eGlsaWFyeUVu\naGFuY2VyCgl7CgkJcHVibGljIHZvaWQgcnVuIChCQ0NsYXNzIGJjLCBDbGFz\nc01ldGFEYXRhIG1ldGEpOwoJCXB1YmxpYyBib29sZWFuIHNraXBFbmhhbmNl\nKEJDTWV0aG9kIG0pOwoJfQp9Cg==\n","encoding":"base64"}

