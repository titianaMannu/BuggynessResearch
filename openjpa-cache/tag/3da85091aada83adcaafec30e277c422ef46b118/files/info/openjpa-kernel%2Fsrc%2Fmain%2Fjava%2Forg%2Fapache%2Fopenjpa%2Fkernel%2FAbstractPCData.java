{"sha":"0c53840e490da2db0539c7222b9f1a15e1d88474","node_id":"MDQ6QmxvYjIwNjM2NDowYzUzODQwZTQ5MGRhMmRiMDUzOWM3MjIyYjlmMWExNWUxZDg4NDc0","size":12823,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0c53840e490da2db0539c7222b9f1a15e1d88474","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsKCi8qKgogKiBBYnN0\ncmFjdCBiYXNlIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgY29yZSBQQ0RhdGEg\nYmVoYXZpb3IuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0\ncmFjdCBjbGFzcyBBYnN0cmFjdFBDRGF0YQogICAgaW1wbGVtZW50cyBQQ0Rh\ndGEgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBu\nZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Rb\nXSBFTVBUWV9BUlJBWSA9IG5ldyBPYmplY3RbMF07CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGxvYWRlZCBmaWVsZCBtYXNrLgogICAgICovCiAgICBw\ndWJsaWMgYWJzdHJhY3QgQml0U2V0IGdldExvYWRlZCgpOwoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHBjZGF0YSBmb3IgaG9sZGluZyB0aGUgc3Rh\ndGUgb2YgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBhYnN0cmFjdCBBYnN0cmFjdFBDRGF0YSBuZXdFbWJlZGRlZFBDRGF0YShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtKTsKCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0xvYWRlZChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0TG9hZGVk\nKCkuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9y\nbSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSBpbnRvIGl0cyBmaWVsZCB2YWx1ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0ZpZWxkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIE9i\namVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgUHJveHlEYXRhTGlzdCBjID0g\nKFByb3h5RGF0YUxpc3QpIGRhdGE7CiAgICAgICAgICAgICAgICBDb2xsZWN0\naW9uIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjLnNpemUoKTsgaSsrKQogICAgICAgICAgICAgICAgICAgIGMyLmFkZCh0\nb05lc3RlZEZpZWxkKHNtLCBmbWQuZ2V0RWxlbWVudCgpLCBjLmdldChpKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2gsIGNvbnRleHQpKTsKICAg\nICAgICAgICAgICAgIGlmIChjMiBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAg\nICAgICAgICAgICAgICAgQ2hhbmdlVHJhY2tlciBjdCA9ICgoUHJveHkpIGMy\nKS5nZXRDaGFuZ2VUcmFja2VyKCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGN0LnNldE5l\neHRTZXF1ZW5jZShjLm5leHRTZXF1ZW5jZSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXR1cm4gYzI7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIE1hcCBtID0gKE1hcCkg\nZGF0YTsKICAgICAgICAgICAgICAgIE1hcCBtMiA9IChNYXApIHNtLm5ld0Zp\nZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAgTWFw\nLkVudHJ5IGU7CiAgICAgICAgICAgICAgICBPYmplY3Qga2V5OwogICAgICAg\nICAgICAgICAgT2JqZWN0IHZhbHVlOwogICAgICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBtaSA9IG0uZW50cnlTZXQoKS5pdGVyYXRvcigpOyBtaS5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgZSA9IChNYXAuRW50cnkp\nIG1pLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBrZXkgPSB0b05lc3Rl\nZEZpZWxkKHNtLCBmbWQuZ2V0S2V5KCksIGUuZ2V0S2V5KCksCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZldGNoLCBjb250ZXh0KTsKICAgICAgICAgICAg\nICAgICAgICB2YWx1ZSA9IHRvTmVzdGVkRmllbGQoc20sIGZtZC5nZXRFbGVt\nZW50KCksIGUuZ2V0VmFsdWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgIG0yLnB1dChr\nZXksIHZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHJldHVybiBtMjsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgICAgICBpbnQgbGVuZ3RoID0gQXJyYXkuZ2V0TGVuZ3Ro\nKGRhdGEpOwogICAgICAgICAgICAgICAgT2JqZWN0IGEgPSBBcnJheS5uZXdJ\nbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAog\nICAgICAgICAgICAgICAgICAgIGxlbmd0aCk7CiAgICAgICAgICAgICAgICBp\nZiAobGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7\nCgogICAgICAgICAgICAgICAgaWYgKGlzSW1tdXRhYmxlVHlwZShmbWQuZ2V0\nRWxlbWVudCgpKSkgewogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkoZGF0YSwgMCwgYSwgMCwgbGVuZ3RoKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBB\ncnJheS5zZXQoYSwgaSwgdG9OZXN0ZWRGaWVsZChzbSwgZm1kLmdldEVsZW1l\nbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFycmF5LmdldChk\nYXRhLCBpKSwgZmV0Y2gsIGNvbnRleHQpKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4g\nYTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVy\nbiB0b05lc3RlZEZpZWxkKHNtLCBmbWQsIGRhdGEsIGZldGNoLCBjb250ZXh0\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm0g\ndGhlIGdpdmVuIGRhdGEgdmFsdWUgdG8gaXRzIGZpZWxkIHZhbHVlLiBUaGUg\nZGF0YSB2YWx1ZQogICAgICogbWF5IGJlIGEga2V5LCB2YWx1ZSwgb3IgZWxl\nbWVudCBvZiBhIG1hcCBvciBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcm90\nZWN0ZWQgT2JqZWN0IHRvTmVzdGVkRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgVmFsdWVNZXRhRGF0YSB2bWQsCiAgICAgICAgT2JqZWN0IGRhdGEs\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgc3dpdGNoICh2bWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gKChEYXRlKSBkYXRhKS5jbG9uZSgpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gKExvY2FsZSkgZGF0YTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWQo\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9FbWJlZGRlZEZpZWxk\nKHNtLCB2bWQsIGRhdGEsIGZldGNoLCBjb250ZXh0KTsKICAgICAgICAgICAg\nICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBD\nX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBPYmplY3QgcmV0ID0KICAgICAg\nICAgICAgICAgICAgICB0b1JlbGF0aW9uRmllbGQoc20sIHZtZCwgZGF0YSwg\nZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgaWYgKHJldCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAg\nICAgICAgICBPcnBoYW5lZEtleUFjdGlvbiBhY3Rpb24gPSBzbS5nZXRDb250\nZXh0KCkuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAgICAg\nIGdldE9ycGhhbmVkS2V5QWN0aW9uSW5zdGFuY2UoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBhY3Rpb24ub3JwaGFuKGRhdGEsIHNtLCB2bWQpOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRo\nZSBnaXZlbiBkYXRhIGludG8gYSByZWxhdGlvbiBmaWVsZCB2YWx1ZS4gRGVm\nYXVsdAogICAgICogaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgZGF0YSBp\ncyBhbiBvaWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9SZWxh\ndGlvbkZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFZhbHVlTWV0YURh\ndGEgdm1kLAogICAgICAgIE9iamVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIHNt\nLmdldENvbnRleHQoKS5maW5kKGRhdGEsIGZldGNoLCBudWxsLCBudWxsLCAw\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4g\nZGF0YSBpbnRvIGFuIGVtYmVkZGVkIFBDIGZpZWxkIHZhbHVlLiBEZWZhdWx0\nCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZSBkYXRhIGlzIGFu\nIHtAbGluayBBYnN0cmFjdFBDRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBPYmplY3QgdG9FbWJlZGRlZEZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIFZhbHVlTWV0YURhdGEgdm1kLAogICAgICAgIE9iamVjdCBkYXRhLCBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgQWJzdHJhY3RQQ0RhdGEgcGNkYXRhID0gKEFic3RyYWN0UENEYXRh\nKSBkYXRhOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW1iZWRkZWQg\nPSBzbS5nZXRDb250ZXh0KCkuZW1iZWQobnVsbCwKICAgICAgICAgICAgcGNk\nYXRhLmdldElkKCksIHNtLCB2bWQpOwogICAgICAgIHBjZGF0YS5sb2FkKGVt\nYmVkZGVkLCAoQml0U2V0KSBwY2RhdGEuZ2V0TG9hZGVkKCkuY2xvbmUoKSwK\nICAgICAgICAgICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgIHJldHVybiBl\nbWJlZGRlZC5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZmllbGQgdmFsdWUgdG8gYSBk\nYXRhIHZhbHVlIGZvciBjYWNoaW5nLiBSZXR1cm4KICAgICAqIHtAbGluayAj\nTlVMTH0gaWYgdW5hYmxlIHRvIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgT2JqZWN0IHRvRGF0YShGaWVsZE1ldGFEYXRhIGZtZCwgT2JqZWN0IHZh\nbCwgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmICh2YWwgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgQ29sbGVj\ndGlvbiBjID0gKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICAgICAgICAgIGlm\nIChjLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJv\neHlEYXRhTGlzdC5FTVBUWV9MSVNUOwogICAgICAgICAgICAgICAgUHJveHlE\nYXRhTGlzdCBjMiA9IG51bGw7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZTsK\nICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgY2kgPSBjLml0ZXJhdG9y\nKCk7IGNpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICB2YWwg\nPSB0b05lc3RlZERhdGEoZm1kLmdldEVsZW1lbnQoKSwgY2kubmV4dCgpLCBj\ndHgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gTlVMTCkKICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGMyID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgc2l6ZSA9IGMuc2l6ZSgpOwogICAgICAgICAgICAgICAgICAgICAg\nICBjMiA9IG5ldyBQcm94eURhdGFMaXN0KHNpemUpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94\neSkgYykuZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYzIubmV4dFNlcXVlbmNlID0gY3QuZ2V0TmV4dFNlcXVl\nbmNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgYzIubmV4dFNlcXVlbmNlID0gc2l6ZTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYzIu\nYWRkKHZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXR1cm4gYzI7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgIE1hcCBtID0gKE1hcCkgdmFsOwogICAgICAgICAgICAg\nICAgaWYgKG0uaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7CiAgICAgICAgICAgICAgICBNYXAg\nbTIgPSBudWxsOwogICAgICAgICAgICAgICAgTWFwLkVudHJ5IGU7CiAgICAg\nICAgICAgICAgICBPYmplY3QgdmFsMjsKICAgICAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgbWkgPSBtLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgbWkuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIGUgPSAoTWFwLkVudHJ5\nKSBtaS5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gdG9OZXN0\nZWREYXRhKGZtZC5nZXRLZXkoKSwgZS5nZXRLZXkoKSwgY3R4KTsKICAgICAg\nICAgICAgICAgICAgICBpZiAodmFsID09IE5VTEwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICAgICAgICAgICAgIHZh\nbDIgPSB0b05lc3RlZERhdGEoZm1kLmdldEVsZW1lbnQoKSwgZS5nZXRWYWx1\nZSgpLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwyID09IE5V\nTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAg\nICAgICAgICAgICAgICAgIGlmIChtMiA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBtMiA9IG5ldyBIYXNoTWFwKG0uc2l6ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBtMi5wdXQodmFsLCB2YWwyKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBtMjsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpbnQgbGVu\nZ3RoID0gQXJyYXkuZ2V0TGVuZ3RoKHZhbCk7CiAgICAgICAgICAgICAgICBp\nZiAobGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX0FSUkFZOwoKICAgICAgICAgICAgICAgIE9iamVjdCBhOwogICAgICAg\nICAgICAgICAgaWYgKGlzSW1tdXRhYmxlVHlwZShmbWQuZ2V0RWxlbWVudCgp\nKSkgewogICAgICAgICAgICAgICAgICAgIGEgPSBBcnJheS5uZXdJbnN0YW5j\nZShmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAg\nICBTeXN0ZW0uYXJyYXljb3B5KHZhbCwgMCwgYSwgMCwgbGVuZ3RoKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgT2Jq\nZWN0W10gZGF0YSA9IG5ldyBPYmplY3RbbGVuZ3RoXTsKICAgICAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGRhdGFbaV0gPSB0b05lc3RlZERhdGEo\nZm1kLmdldEVsZW1lbnQoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBBcnJheS5nZXQodmFsLCBpKSwgY3R4KTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgYSA9IGRhdGE7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiB0b05lc3RlZERhdGEo\nZm1kLCB2YWwsIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHdoZXRoZXIgdGhlIGRlY2xhcmVkIHR5cGUgb2YgdGhlIGdp\ndmVuIHZhbHVlIGlzIGltbXV0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGlzSW1tdXRhYmxlVHlwZShWYWx1ZU1ldGFEYXRhIGVsZW1lbnQp\nIHsKICAgICAgICBzd2l0Y2ggKGVsZW1lbnQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVJfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVf\nT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lO\nVEVHRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm0gdGhlIGdp\ndmVuIG5lc3RlZCB2YWx1ZSB0byBhIGNhY2hhYmxlIHZhbHVlLiBSZXR1cm4K\nICAgICAqIHtAbGluayAjTlVMTH0gaWYgdGhlIHZhbHVlIGNhbm5vdCBiZSBj\nYWNoZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9OZXN0ZWRE\nYXRhKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3QgdmFsLAogICAgICAgIFN0\nb3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBzd2l0Y2ggKHZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWQo\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9FbWJlZGRlZERhdGEo\ndmFsLCBjdHgpOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAg\nICAgIHJldHVybiB0b1JlbGF0aW9uRGF0YSh2YWwsIGN0eCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBpZiAo\ndmFsIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuICgoUHJveHkpIHZhbCkuY29weSh2YWwpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIHZhbCku\nY2xvbmUoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIChMb2NhbGUpIHZhbDsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgaWYg\nKHZhbCBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiAoKFByb3h5KSB2YWwpLmNvcHkodmFsKTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVl\nIHRvIGNhY2hlIGZvciB0aGUgZ2l2ZW4gb2JqZWN0LiBDYWNoZXMgaXRzIG9p\nZCBieQogICAgICogZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIE9i\namVjdCB0b1JlbGF0aW9uRGF0YShPYmplY3QgdmFsLCBTdG9yZUNvbnRleHQg\nY3R4KSB7CiAgICAgICAgcmV0dXJuIGN0eC5nZXRPYmplY3RJZCh2YWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSB0byBjYWNo\nZSBmb3IgdGhlIGdpdmVuIGVtYmVkZGVkIFBDLiBDYWNoZXMgYQogICAgICog\ne0BsaW5rIFBDRGF0YX0gZnJvbSB7QGxpbmsgI25ld0VtYmVkZGVkUENEYXRh\nfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRv\nRW1iZWRkZWREYXRhKE9iamVjdCB2YWwsIFN0b3JlQ29udGV4dCBjdHgpIHsK\nICAgICAgICBpZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBO\nVUxMOwoKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gY3R4Lmdl\ndFN0YXRlTWFuYWdlcih2YWwpOwogICAgICAgIGlmIChzbSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gTlVMTDsKCiAgICAgICAgLy8gaGF2ZSB0byBj\nYWNoZSBhbGwgZGF0YSwgc28gbWFrZSBzdXJlIGl0J3MgYWxsIGxvYWRlZAog\nICAgICAgIC8vICMjIyBwcmV2ZW50IGxvYWRpbmcgb2YgdGhpbmdzIHRoYXQg\nYXJlbid0IGNhY2hlZCAobG9icywgbHJzLCBldGMpCiAgICAgICAgY3R4LnJl\ndHJpZXZlKHZhbCwgZmFsc2UsIG51bGwpOwoKICAgICAgICBQQ0RhdGEgcGNk\nYXRhID0gbmV3RW1iZWRkZWRQQ0RhdGEoc20pOwogICAgICAgIHBjZGF0YS5z\ndG9yZShzbSk7CiAgICAgICAgcmV0dXJuIHBjZGF0YTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRyYWNrcyBwcm94eSBkYXRhIGFsb25nIHdpdGggbGlzdCBl\nbGVtZW50cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJv\neHlEYXRhTGlzdAogICAgICAgIGV4dGVuZHMgQXJyYXlMaXN0IHsKCiAgICAg\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBQcm94eURhdGFMaXN0IEVNUFRZX0xJ\nU1QgPSBuZXcgUHJveHlEYXRhTGlzdCgwKTsKCiAgICAgICAgcHVibGljIGlu\ndCBuZXh0U2VxdWVuY2UgPSAwOwoKICAgICAgICBwdWJsaWMgUHJveHlEYXRh\nTGlzdChpbnQgc2l6ZSkgewoJCQlzdXBlciAoc2l6ZSk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

