{"sha":"15da014ca48e707245fbc9164310c7644d59c360","node_id":"MDQ6QmxvYjIwNjM2NDoxNWRhMDE0Y2E0OGU3MDcyNDVmYmM5MTY0MzEwYzc2NDRkNTljMzYw","size":20275,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/15da014ca48e707245fbc9164310c7644d59c360","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwoKLyoqCiAqIFN0cmF0ZWd5IGZvciBhdHRhY2hpbmcgb2JqZWN0cy4K\nICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBT\ndGV2ZSBLaW0KICogQG5vamF2YWRvYwogKi8KYWJzdHJhY3QgY2xhc3MgQXR0\nYWNoU3RyYXRlZ3kKICAgIGV4dGVuZHMgVHJhbnNmZXJGaWVsZE1hbmFnZXIg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQXR0YWNoU3RyYXRlZ3ku\nY2xhc3MpOwoKICAgIC8qKgogICAgICogQXR0YWNoLgogICAgICoKICAgICAq\nIEBwYXJhbSBtYW5hZ2VyIG1hbmFnZXIgaG9sZGluZyBjYWNoZSBvZiBhdHRh\nY2hlZCBpbnN0YW5jZXMKICAgICAqIEBwYXJhbSB0b0F0dGFjaCBkZXRhY2hl\nZCBpbnN0YW5jZQogICAgICogQHBhcmFtIG1ldGEgbWV0YWRhdGEgZm9yIHRo\nZSBpbnN0YW5jZSBiZWluZyBhdHRhY2hlZAogICAgICogQHBhcmFtIGludG8g\naW5zdGFuY2Ugd2UncmUgYXR0YWNoaW5nIGludG8KICAgICAqIEBwYXJhbSBv\nd25lciBzdGF0ZSBtYW5hZ2VyIGZvciA8Y29kZT5pbnRvPC9jb2RlPgogICAg\nICogQHBhcmFtIG93bmVyTWV0YSBmaWVsZCB3ZSB0cmF2ZXJzZWQgdG8gZmlu\nZCA8Y29kZT50b0F0dGFjaDwvY29kZT4KICAgICAqIEBwYXJhbSBleHBsaWNp\ndCB3aGV0aGVyIHRvIG1ha2UgbmV3IGluc3RhbmNlcyBleHBsaWNpdGx5IHBl\ncnNpc3RlbnQKICAgICAqLwogICAgcHVibGljIGFic3RyYWN0IE9iamVjdCBh\ndHRhY2goQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIE9iamVjdCB0\nb0F0dGFjaCwgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFi\nbGUgaW50bywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBW\nYWx1ZU1ldGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCk7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGlkZW50aXR5IG9mIHRoZSBnaXZl\nbiBkZXRhY2hlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IE9iamVjdCBnZXREZXRhY2hlZE9iamVjdElkKEF0dGFjaE1hbmFn\nZXIgbWFuYWdlciwKICAgICAgICBPYmplY3QgdG9BdHRhY2gpOwoKICAgIC8q\nKgogICAgICogUHJvdmlkZSB0aGUgZ2l2ZW4gZmllbGQgaW50byB0aGlzIGZp\nZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2\nb2lkIHByb3ZpZGVGaWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdl\nckltcGwgc20sCiAgICAgICAgaW50IGZpZWxkKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiBhIFBOZXcvUE5ld1Byb3Zpc2lvbmFsIG1hbmFnZWQgb2JqZWN0\nIGZvciB0aGUgZ2l2ZW4gZGV0YWNoZWQgCiAgICAgKiBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgcGVyc2lzdChB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEsIE9iamVjdCBhcHBJZCwgCiAg\nICAgICAgYm9vbGVhbiBleHBsaWNpdCkgewogICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBuZXdJbnN0YW5jZTsKICAgICAgICBpZiAoIW1hbmFnZXIuZ2V0\nQ29weU5ldygpKQogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjOwogICAg\nICAgIGVsc2UgaWYgKGFwcElkID09IG51bGwpIC8vIGRhdGFzdG9yZSBpZGVu\ndGl0eQogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjLnBjTmV3SW5zdGFu\nY2UobnVsbCwgZmFsc2UpOwogICAgICAgIGVsc2UgLy8gYXBwbGljYXRpb24g\naWRlbnRpdHk6IHVzZSBleGlzdGluZyBmaWVsZHMKICAgICAgICAgICAgbmV3\nSW5zdGFuY2UgPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIGFwcElkLCBmYWxz\nZSk7CgogICAgICAgIHJldHVybiAoU3RhdGVNYW5hZ2VySW1wbCkgbWFuYWdl\nci5nZXRCcm9rZXIoKS5wZXJzaXN0CiAgICAgICAgICAgIChuZXdJbnN0YW5j\nZSwgYXBwSWQsIGV4cGxpY2l0LCBtYW5hZ2VyLmdldEJlaGF2aW9yKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBmaWVsZCBp\nbnRvIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\ndG9BdHRhY2ggdGhlIGRldGFjaGVkIHBlcnNpc3RlbnQgaW5zdGFuY2UKICAg\nICAqIEBwYXJhbSBzbSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgbWFuYWdlZCBp\nbnN0YW5jZSB3ZSdyZSBjb3B5aW5nCiAgICAgKiBpbnRvOyA8Y29kZT50b0F0\ndGFjaDwvY29kZT4gYWxzbyB1c2VzIHRoaXMgc3RhdGUgbWFuYWdlcgogICAg\nICogQHBhcmFtIGZtZCBtZXRhZGF0YSBvbiB0aGUgZmllbGQgd2UncmUgY29w\neWluZwogICAgICogQHBhcmFtIG51bGxMb2FkZWQgaWYgZmFsc2UsIG51bGxz\nIHdpbGwgYmUgY29uc2lkZXJlZCB1bmxvYWRlZCBhbmQgd2lsbAogICAgICog\nbm90IGJlIGF0dGFjaGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFu\nIGF0dGFjaEZpZWxkKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0IHRv\nQXR0YWNoLAogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20sIEZpZWxkTWV0\nYURhdGEgZm1kLCBib29sZWFuIG51bGxMb2FkZWQpIHsKICAgICAgICBpZiAo\nZm1kLmlzVmVyc2lvbigpCiAgICAgICAgICAgIHx8IGZtZC5nZXRNYW5hZ2Vt\nZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQZXJzaXN0ZW5jZUNh\ncGFibGUgaW50byA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAg\nICAgIGludCBpID0gZm1kLmdldEluZGV4KCk7CiAgICAgICAgcHJvdmlkZUZp\nZWxkKHRvQXR0YWNoLCBzbSwgaSk7CgogICAgICAgIGludCBzZXQgPSBTdGF0\nZU1hbmFnZXIuU0VUX0FUVEFDSDsKICAgICAgICBPYmplY3QgdmFsOwogICAg\nICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAg\nICAgc20uc2V0dGluZ0Jvb2xlYW5GaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJv\nb2xlYW5GaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaEJvb2xl\nYW5GaWVsZChpKSwgc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAg\nc20uc2V0dGluZ0J5dGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJ5dGVGaWVs\nZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaEJ5dGVGaWVsZChpKSwg\nc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ0No\nYXJGaWVsZChpbnRvLCBpLCBzbS5mZXRjaENoYXJGaWVsZChpKSwKICAgICAg\nICAgICAgICAgICAgICBmZXRjaENoYXJGaWVsZChpKSwgc2V0KTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEU6CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nRG91YmxlRmllbGQo\naW50bywgaSwgc20uZmV0Y2hEb3VibGVGaWVsZChpKSwKICAgICAgICAgICAg\nICAgICAgICBmZXRjaERvdWJsZUZpZWxkKGkpLCBzZXQpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ0Zsb2F0RmllbGQoaW50bywg\naSwgc20uZmV0Y2hGbG9hdEZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAg\nIGZldGNoRmxvYXRGaWVsZChpKSwgc2V0KTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgICAgICBzbS5zZXR0aW5nSW50RmllbGQoaW50bywgaSwgc20uZmV0Y2hJ\nbnRGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaEludEZpZWxk\nKGkpLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBzbS5zZXR0\naW5nTG9uZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoTG9uZ0ZpZWxkKGkpLAog\nICAgICAgICAgICAgICAgICAgIGZldGNoTG9uZ0ZpZWxkKGkpLCBzZXQpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ1Nob3J0Rmll\nbGQoaW50bywgaSwgc20uZmV0Y2hTaG9ydEZpZWxkKGkpLAogICAgICAgICAg\nICAgICAgICAgIGZldGNoU2hvcnRGaWVsZChpKSwgc2V0KTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJ\nTkc6CiAgICAgICAgICAgICAgICBTdHJpbmcgc3ZhbCA9IGZldGNoU3RyaW5n\nRmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAoc3ZhbCA9PSBudWxsICYm\nICFudWxsTG9hZGVkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTdHJpbmdGaWVsZChpbnRv\nLCBpLCBzbS5mZXRjaFN0cmluZ0ZpZWxkKGkpLCBzdmFsLAogICAgICAgICAg\nICAgICAgICAgIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk5VTUJFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9P\nQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09C\nSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9CSkVDVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAg\nICAgICAgICAgICAgdmFsID0gZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAg\nICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAg\nICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgc20uZmV0Y2hPYmpl\nY3RGaWVsZChpKSwgdmFsLAogICAgICAgICAgICAgICAgICAgIHNldCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUEM6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6\nCiAgICAgICAgICAgICAgICBPYmplY3QgZnJtcGMgPSBmZXRjaE9iamVjdEZp\nZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKGZybXBjID09IG51bGwgJiYg\nIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciB0b3NtID0g\nbWFuYWdlci5nZXRCcm9rZXIoKS5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAg\nICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVsZChpKSk7CiAgICAgICAg\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgdG9wYyA9ICh0b3NtID09IG51\nbGwpID8gbnVsbAogICAgICAgICAgICAgICAgICAgIDogdG9zbS5nZXRQZXJz\naXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICAgICAgICAgIGlmIChmcm1wYyAh\nPSBudWxsIHx8IHRvcGMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChmbWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgICAgICAgICBmcm1wYyA9\nIGdldFJlZmVyZW5jZShtYW5hZ2VyLCBmcm1wYywgc20sIGZtZCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvcGMgPSB0b3BjOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIWZtZC5pc0VtYmVkZGVkUEMoKSAmJiBmcm1w\nYyAhPSBudWxsICYmIHRvcGMgIT0gbnVsbAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgIU9iamVjdFV0aWxzLmVxdWFscyh0b3BjLnBjRmV0Y2hP\nYmplY3RJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdl\nci5nZXREZXRhY2hlZE9iamVjdElkKGZybXBjKSkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGludG9wYyA9IG51bGw7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZnJtcGMgPSBt\nYW5hZ2VyLmF0dGFjaChmcm1wYywgaW50b3BjLCBzbSwgZm1kLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlm\nIChmcm1wYyAhPSB0b3BjKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5z\nZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgdG9wYywgZnJtcGMsIHNldCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIENvbGxlY3Rpb24gZnJtYyA9IChDb2xsZWN0aW9uKSBmZXRjaE9i\namVjdEZpZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKGZybWMgPT0gbnVs\nbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIHRvYyA9IChDb2xs\nZWN0aW9uKSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAg\nICAgaWYgKCh0b2MgIT0gbnVsbCAmJiAhdG9jLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgICAgICB8fCBmcm1jICE9IG51bGwgJiYgIWZybWMuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZybWMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxk\nKGludG8sIGksIHRvYywgbnVsbCwgc2V0KTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlIGlmICh0b2MgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgbnVsbCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaENvbGxlY3Rpb24obWFu\nYWdlciwgZnJtYywgc20sIGZtZCksIHNldCk7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIGlmICh0b2MgaW5zdGFuY2VvZiBTZXQgJiYgZnJtYyBpbnN0\nYW5jZW9mIFNldCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUNv\nbGxlY3Rpb24obWFuYWdlciwgZnJtYywgdG9jLCBzbSwgZm1kKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvYywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJlcGxhY2VMaXN0KG1hbmFnZXIsIGZybWMs\nIHRvYywgc20sIGZtZCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIE1h\ncCBmcm1tID0gKE1hcCkgZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAg\nICAgICAgIGlmIChmcm1tID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nTWFwIHRvbSA9IChNYXApIHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAg\nICAgICAgICAgICBpZiAoKHRvbSAhPSBudWxsICYmICF0b20uaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgICAgIHx8IChmcm1tICE9IG51bGwgJiYgIWZy\nbW0uaXNFbXB0eSgpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmcm1t\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdP\nYmplY3RGaWVsZChpbnRvLCBpLCB0b20sIG51bGwsIHNldCk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZSBpZiAodG9tID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCBu\ndWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoTWFwKG1h\nbmFnZXIsIGZybW0sIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZU1hcCht\nYW5hZ2VyLCBmcm1tLCB0b20sIHNtLCBmbWQpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgT2JqZWN0IGZybWEgPSBm\nZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKGZybWEg\nPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBPYmplY3QgdG9hID0gc20u\nZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmICgodG9h\nICE9IG51bGwgJiYgQXJyYXkuZ2V0TGVuZ3RoKHRvYSkgPiAwKQogICAgICAg\nICAgICAgICAgICAgIHx8IChmcm1hICE9IG51bGwgJiYgQXJyYXkuZ2V0TGVu\nZ3RoKGZybWEpID4gMCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJt\nYSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nT2JqZWN0RmllbGQoaW50bywgaSwgdG9hLCBudWxsLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc20u\nc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvYSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcGxhY2VBcnJheShtYW5hZ2VyLCBmcm1hLCB0\nb2EsIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oZm1kLnRvU3Ry\naW5nKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIG1hbmFnZWQsIHBvc3NpYmx5IGhv\nbGxvdyByZWZlcmVuY2UgZm9yIHRoZSBnaXZlbiBkZXRhY2hlZAogICAgICog\nb2JqZWN0LgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGdldFJlZmVy\nZW5jZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIE9iamVjdCB0b0F0dGFjaCwK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBWYWx1ZU1ldGFEYXRh\nIHZtZCkgewogICAgICAgIGlmICh0b0F0dGFjaCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAobWFuYWdlci5nZXRCcm9r\nZXIoKS5pc0RldGFjaGVkKHRvQXR0YWNoKSkgewogICAgICAgICAgICBPYmpl\nY3Qgb2lkID0gbWFuYWdlci5nZXREZXRhY2hlZE9iamVjdElkKHRvQXR0YWNo\nKTsKICAgICAgICAgICAgaWYgKG9pZCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG1hbmFnZXIuZ2V0QnJva2VyKCkuZmluZChvaWQsIGZhbHNl\nLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoImNhbnQtY2FzY2FkZS1hdHRhY2giLAogICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHRvQXR0YWNoKSwgdm1kLAogICAg\nICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKSkpLgogICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QodG9BdHRh\nY2gpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSB0aGUgY29udGVu\ndHMgb2YgPGNvZGU+dG9jPC9jb2RlPiB3aXRoIHRoZSBjb250ZW50cyBvZgog\nICAgICogPGNvZGU+ZnJtYzwvY29kZT4uIE5laXRoZXIgY29sbGVjdGlvbiBp\ncyBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVwbGFjZUNvbGxl\nY3Rpb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBDb2xsZWN0aW9uIGZybWMs\nCiAgICAgICAgQ29sbGVjdGlvbiB0b2MsIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgLy8gaWYgZnJtYyBj\nb2xsZWN0aW9uIGlzIGVtcHR5LCBqdXN0IGNsZWFyIHRvYwogICAgICAgIGlm\nIChmcm1jLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoIXRvYy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICB0b2MuY2xlYXIoKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBpcyBh\nIHBjIGNvbGxlY3Rpb24sIGF0dGFjaCBhbGwgaW5zdGFuY2VzCiAgICAgICAg\nYm9vbGVhbiBwYyA9IGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQ\nQygpOwogICAgICAgIGlmIChwYykKICAgICAgICAgICAgZnJtYyA9IGF0dGFj\naENvbGxlY3Rpb24obWFuYWdlciwgZnJtYywgc20sIGZtZCk7CgogICAgICAg\nIC8vIHJlbW92ZSBhbGwgZWxlbWVudHMgZnJvbSB0aGUgdG9jIGNvbGxlY3Rp\nb24gdGhhdCBhcmVuJ3QgaW4gZnJtYwogICAgICAgIHRvYy5yZXRhaW5BbGwo\nZnJtYyk7CgogICAgICAgIC8vIG5vdyBhZGQgYWxsIGVsZW1lbnRzIHRoYXQg\nYXJlIGluIGZybWMgYnV0IG5vdCB0b2MKICAgICAgICBpZiAoZnJtYy5zaXpl\nKCkgIT0gdG9jLnNpemUoKSkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGkgPSBmcm1jLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgT2JqZWN0IG9iID0gaS5uZXh0KCk7CiAgICAgICAgICAgICAg\nICBpZiAoIXRvYy5jb250YWlucyhvYikpCiAgICAgICAgICAgICAgICAgICAg\ndG9jLmFkZChvYik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgY29sbGVjdGlvbiB3aXRoIHRo\nZSBhdHRhY2hlZCBjb250ZW50cyBvZiB0aGUgZ2l2ZW4gb25lLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBhdHRhY2hDb2xsZWN0aW9uKEF0\ndGFjaE1hbmFnZXIgbWFuYWdlciwKICAgICAgICBDb2xsZWN0aW9uIG9yaWcs\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gY29weUNvbGxlY3Rpb24obWFu\nYWdlciwgb3JpZywgZm1kKTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCA9\nIGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgaWYgKCF2bWQuaXNEZWNsYXJl\nZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4gY29sbDsKCiAgICAgICAg\nLy8gdW5mb3J0dW5hdGVseSB3ZSBoYXZlIHRvIGNsZWFyIHRoZSBvcmlnaW5h\nbCBhbmQgcmUtYWRkCiAgICAgICAgY29sbC5jbGVhcigpOwogICAgICAgIE9i\namVjdCBlbGVtOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb3JpZy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBpZiAo\ndm1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfTk9ORSkKICAgICAgICAgICAgICAgIGVsZW0gPSBnZXRSZWZlcmVuY2Uo\nbWFuYWdlciwgaXRyLm5leHQoKSwgc20sIHZtZCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGVsZW0gPSBtYW5hZ2VyLmF0dGFjaChpdHIu\nbmV4dCgpLCBudWxsLCBzbSwgdm1kLCBmYWxzZSk7CiAgICAgICAgICAgIGNv\nbGwuYWRkKGVsZW0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29sbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvcGllcyB0aGUgZ2l2ZW4gY29sbGVj\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIGNvcHlDb2xs\nZWN0aW9uKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgQ29sbGVjdGlvbiBvcmln\nLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQ29sbGVj\ndGlvbiBjb2xsID0gbWFuYWdlci5nZXRQcm94eU1hbmFnZXIoKS5jb3B5Q29s\nbGVjdGlvbihvcmlnKTsKICAgICAgICBpZiAoY29sbCA9PSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLWNvcHlhYmxlIiwgZm1kKSk7CiAgICAgICAgcmV0dXJuIGNvbGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGF0dGFjaGVkIHZlcnNpb24g\nb2YgdGhlIDxjb2RlPmZybWw8L2NvZGU+CiAgICAgKiBsaXN0IGlmIGl0IGlz\nIGRpZmZlcmVudCB0aGFuIDxjb2RlPnRvbDwvY29kZT4uIElmIHRoZSBsaXN0\ncwogICAgICogd2lsbCBiZSBpZGVudGljYWwsIHJldHVybnMgPGNvZGU+dG9s\nPC9jb2RlPi4gTmVpdGhlciBsaXN0IGlzIG51bGwuCiAgICAgKi8KICAgIHBy\naXZhdGUgQ29sbGVjdGlvbiByZXBsYWNlTGlzdChBdHRhY2hNYW5hZ2VyIG1h\nbmFnZXIsIENvbGxlY3Rpb24gZnJtbCwKICAgICAgICBDb2xsZWN0aW9uIHRv\nbCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBib29sZWFuIHBjID0gZm1kLmdldEVsZW1lbnQoKS5pc0Rl\nY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgaWYgKHBjKQogICAgICAgICAgICBm\ncm1sID0gYXR0YWNoQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1sLCBzbSwgZm1k\nKTsKCiAgICAgICAgLy8gaWYgdGhlIG9ubHkgZGlmZiBiZXR3ZWVuIGZybWwg\nYW5kIHRvbCBpcyBzb21lIGFkZGVkIGVsZW1lbnRzIGF0CiAgICAgICAgLy8g\ndGhlIGVuZCwgbWFrZSB0aGUgY2hhbmdlcyBkaXJlY3RseSBpbiB0b2wKICAg\nICAgICBpZiAoZnJtbC5zaXplKCkgPj0gdG9sLnNpemUoKSkgewogICAgICAg\nICAgICBJdGVyYXRvciBmcm1pID0gZnJtbC5pdGVyYXRvcigpOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIHRvaSA9IHRvbC5pdGVyYXRvcigpOyB0b2ku\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBh\nbiBpbmNvbXBhdGliaWxpdHksIGp1c3QgcmV0dXJuIGEgY29weSBvZiBmcm1s\nCiAgICAgICAgICAgICAgICAvLyAoaXQncyBhbHJlYWR5IGNvcGllZCBpZiB3\nZSBhdHRhY2hlZCBpdCkKICAgICAgICAgICAgICAgIGlmICghZXF1YWxzKGZy\nbWkubmV4dCgpLCB0b2kubmV4dCgpLCBwYykpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIChwYykgPyBmcm1sIDogY29weUNvbGxlY3Rpb24obWFuYWdl\nciwgZnJtbCwgZm1kKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nanVzdCBhZGQgdGhlIGV4dHJhIGVsZW1lbnRzIGluIGZybWwgdG8gdG9sIGFu\nZCByZXR1cm4gdG9sCiAgICAgICAgICAgIHdoaWxlIChmcm1pLmhhc05leHQo\nKSkKICAgICAgICAgICAgICAgIHRvbC5hZGQoZnJtaS5uZXh0KCkpOwogICAg\nICAgICAgICByZXR1cm4gdG9sOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhl\nIGxpc3RzIGFyZSBkaWZmZXJlbnQ7IGp1c3QgbWFrZSBzdXJlIGZybWwgaXMg\nY29waWVkIGFuZCByZXR1cm4gaXQKICAgICAgICByZXR1cm4gKHBjKSA/IGZy\nbWwgOiBjb3B5Q29sbGVjdGlvbihtYW5hZ2VyLCBmcm1sLCBmbWQpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVwbGFjZSB0aGUgY29udGVudHMgb2YgPGNv\nZGU+dG9tPC9jb2RlPiB3aXRoIHRoZSBjb250ZW50cyBvZgogICAgICogPGNv\nZGU+ZnJtbTwvY29kZT4uIE5laXRoZXIgbWFwIGlzIG51bGwuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZXBsYWNlTWFwKEF0dGFjaE1hbmFnZXIgbWFu\nYWdlciwgTWFwIGZybW0sIE1hcCB0b20sCiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAo\nZnJtbS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgaWYgKCF0b20uaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgdG9tLmNsZWFyKCk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBw\nYyBtYXAsIGF0dGFjaCBhbGwgaW5zdGFuY2VzCiAgICAgICAgYm9vbGVhbiBr\nZXlQQyA9IGZtZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAg\nICAgYm9vbGVhbiB2YWxQQyA9IGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJl\nZFR5cGVQQygpOwogICAgICAgIGlmIChrZXlQQyB8fCB2YWxQQykKICAgICAg\nICAgICAgZnJtbSA9IGF0dGFjaE1hcChtYW5hZ2VyLCBmcm1tLCBzbSwgZm1k\nKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCB0aGUga2V5cyBpbiB0aGUg\nZnJvbSBtYXAgYXJlIGluIHRoZSB0d28gbWFwLCBhbmQKICAgICAgICAvLyB0\naGF0IHRoZXkgaGF2ZSB0aGUgc2FtZSB2YWx1ZXMKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGkgPSBmcm1tLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaS5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeSA9IChNYXAu\nRW50cnkpIGkubmV4dCgpOwogICAgICAgICAgICBpZiAoIXRvbS5jb250YWlu\nc0tleShlbnRyeS5nZXRLZXkoKSkKICAgICAgICAgICAgICAgIHx8ICFlcXVh\nbHModG9tLmdldChlbnRyeS5nZXRLZXkoKSksIGVudHJ5LmdldFZhbHVlKCks\nIHZhbFBDKSkgewogICAgICAgICAgICAgICAgdG9tLnB1dChlbnRyeS5nZXRL\nZXkoKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIHJlbW92ZSBhbnkga2V5cyBpbiB0aGUgdG8gbWFw\nIHRoYXQgYXJlbid0IGluIHRoZSBmcm9tIG1hcAogICAgICAgIGlmICh0b20u\nc2l6ZSgpICE9IGZybW0uc2l6ZSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaSA9IHRvbS5rZXlTZXQoKS5pdGVyYXRvcigpOyBpLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGlmICghKGZybW0uY29udGFpbnNLZXko\naS5uZXh0KCkpKSkKICAgICAgICAgICAgICAgICAgICBpLnJlbW92ZSgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTWFrZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBtYXAgYXJl\nIGF0dGFjaGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgTWFwIGF0dGFjaE1h\ncChBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIE1hcCBvcmlnLAogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICAgICAgTWFwIG1hcCA9IG1hbmFnZXIuZ2V0UHJveHlNYW5hZ2VyKCkuY29w\neU1hcChvcmlnKTsKICAgICAgICBpZiAobWFwID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtY29w\neWFibGUiLCBmbWQpKTsKCiAgICAgICAgVmFsdWVNZXRhRGF0YSBrZXltZCA9\nIGZtZC5nZXRLZXkoKTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZhbG1kID0g\nZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICBpZiAoIWtleW1kLmlzRGVjbGFy\nZWRUeXBlUEMoKSAmJiAhdmFsbWQuaXNEZWNsYXJlZFR5cGVQQygpKQogICAg\nICAgICAgICByZXR1cm4gbWFwOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlIHRv\nIHJlcGxhY2Uga2V5cywganVzdCBjbGVhciBhbmQgcmUtYWRkOyBvdGhlcndp\nc2UKICAgICAgICAvLyB3ZSBjYW4gdXNlIHRoZSBlbnRyeSBzZXQgdG8gcmVz\nZXQgdGhlIHZhbHVlcyBvbmx5CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5Owog\nICAgICAgIGlmIChrZXltZC5pc0RlY2xhcmVkVHlwZVBDKCkpIHsKICAgICAg\nICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAgICAgIE9iamVjdCBrZXksIHZh\nbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvcmlnLmVudHJ5\nU2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGtleSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAg\nICAgaWYgKGtleW1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgICAgICAgICBrZXkgPSBn\nZXRSZWZlcmVuY2UobWFuYWdlciwga2V5LCBzbSwga2V5bWQpOwogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGtleSA9IG1hbmFn\nZXIuYXR0YWNoKGtleSwgbnVsbCwgc20sIGtleW1kLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICB2YWwgPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAgICAg\nICAgICAgaWYgKHZhbG1kLmlzRGVjbGFyZWRUeXBlUEMoKSkgewogICAgICAg\nICAgICAgICAgICAgIGlmICh2YWxtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZhbCA9IGdldFJlZmVyZW5jZShtYW5hZ2VyLCB2YWwsIHNtLCB2\nYWxtZCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICB2YWwgPSBtYW5hZ2VyLmF0dGFjaCh2YWwsIG51bGwsIHNt\nLCB2YWxtZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgbWFwLnB1dChrZXksIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBPYmplY3QgdmFsOwogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9\nIChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAo\ndmFsbWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEuQ0FT\nQ0FERV9OT05FKQogICAgICAgICAgICAgICAgICAgIHZhbCA9IGdldFJlZmVy\nZW5jZShtYW5hZ2VyLCBlbnRyeS5nZXRWYWx1ZSgpLCBzbSwgdmFsbWQpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHZhbCA9\nIG1hbmFnZXIuYXR0YWNoKGVudHJ5LmdldFZhbHVlKCksIG51bGwsIHNtLCB2\nYWxtZCwgCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGVudHJ5LnNldFZhbHVlKHZhbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1hcDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgYW4gYXR0YWNoZWQgdmVyc2lvbiBvZiB0aGUgPGNv\nZGU+ZnJtYTwvY29kZT4KICAgICAqIGFycmF5IGlmIGl0IGlzIGRpZmZlcmVu\ndCB0aGFuIDxjb2RlPnRvYTwvY29kZT4uIElmIHRoZSBhcnJheXMKICAgICAq\nIHdpbGwgYmUgaWRlbnRpY2FsLCByZXR1cm5zIDxjb2RlPnRvYTwvY29kZT4u\nCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IHJlcGxhY2VBcnJheShBdHRh\nY2hNYW5hZ2VyIG1hbmFnZXIsIE9iamVjdCBmcm1hLAogICAgICAgIE9iamVj\ndCB0b2EsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgaW50IGxlbiA9IEFycmF5LmdldExlbmd0aChmcm1h\nKTsKICAgICAgICBib29sZWFuIGRpZmYgPSB0b2EgPT0gbnVsbCB8fCBsZW4g\nIT0gQXJyYXkuZ2V0TGVuZ3RoKHRvYSk7CgogICAgICAgIC8vIHBvcHVsYXRl\nIGFuIGFycmF5IGNvcHkgb24gdGhlIGluaXRpYWwgYXNzdW1wdGlvbiB0aGF0\nIHRoZSBhcnJheQogICAgICAgIC8vIGlzIGRpcnR5CiAgICAgICAgT2JqZWN0\nIG5ld2EgPSBBcnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgpLmdl\ndERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICBsZW4pOwogICAgICAgIFZh\nbHVlTWV0YURhdGEgdm1kID0gZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICBi\nb29sZWFuIHBjID0gdm1kLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAgICBP\nYmplY3QgZWxlbTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsg\naSsrKSB7CiAgICAgICAgICAgIGVsZW0gPSBBcnJheS5nZXQoZnJtYSwgaSk7\nCiAgICAgICAgICAgIGlmIChwYykgewogICAgICAgICAgICAgICAgaWYgKHZt\nZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX05PTkUpCiAgICAgICAgICAgICAgICAgICAgZWxlbSA9IGdldFJlZmVyZW5j\nZShtYW5hZ2VyLCBlbGVtLCBzbSwgdm1kKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBlbGVtID0gbWFuYWdlci5hdHRhY2go\nZWxlbSwgbnVsbCwgc20sIHZtZCwgZmFsc2UpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGRpZmYgPSBkaWZmIHx8ICFlcXVhbHMoZWxlbSwgQXJyYXku\nZ2V0KHRvYSwgaSksIHBjKTsKICAgICAgICAgICAgQXJyYXkuc2V0KG5ld2Es\nIGksIGVsZW0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGRpZmYpID8g\nbmV3YSA6IHRvYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVl\nIGlmIHRoZSBnaXZlbiBvYmplY3RzIGFyZSBlcXVhbC4gUENzIGFyZSBjb21w\nYXJlZCBmb3IKICAgICAqIG9uIEpWTSBpZGVudGl0eS4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IGEsIE9iamVj\ndCBiLCBib29sZWFuIHBjKSB7CiAgICAgICAgaWYgKGEgPT0gYikKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKHBjIHx8IGEgPT0gbnVs\nbCB8fCBiID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQly\nZXR1cm4gYS5lcXVhbHMgKGIpOwoJfQp9Cg==\n","encoding":"base64"}

