{"sha":"ecdf5090ef8b8b83122199be62d5992fa7769d75","node_id":"MDQ6QmxvYjIwNjM2NDplY2RmNTA5MGVmOGI4YjgzMTIyMTk5YmU2MmQ1OTkyZmE3NzY5ZDc1","size":167115,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ecdf5090ef8b8b83122199be62d5992fa7769d75","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTW9kaWZpZXI7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1w\nb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC5yZXNvdXJjZS5Ob3RT\ndXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBqYXZheC5yZXNvdXJjZS5SZXNv\ndXJjZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmF4LnJlc291cmNlLmNjaS5Db25u\nZWN0aW9uOwppbXBvcnQgamF2YXgucmVzb3VyY2UuY2NpLkNvbm5lY3Rpb25N\nZXRhRGF0YTsKaW1wb3J0IGphdmF4LnJlc291cmNlLmNjaS5JbnRlcmFjdGlv\nbjsKaW1wb3J0IGphdmF4LnJlc291cmNlLmNjaS5JbnRlcmFjdGlvblNwZWM7\nCmltcG9ydCBqYXZheC5yZXNvdXJjZS5jY2kuTG9jYWxUcmFuc2FjdGlvbjsK\naW1wb3J0IGphdmF4LnJlc291cmNlLmNjaS5SZWNvcmQ7CmltcG9ydCBqYXZh\neC5yZXNvdXJjZS5jY2kuUmVzb3VyY2VXYXJuaW5nOwppbXBvcnQgamF2YXgu\ncmVzb3VyY2UuY2NpLlJlc3VsdFNldEluZm87CmltcG9ydCBqYXZheC50cmFu\nc2FjdGlvbi5TdGF0dXM7CmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TeW5j\naHJvbml6YXRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxl\nY3Rpb25zLml0ZXJhdG9ycy5JdGVyYXRvckNoYWluOwppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5JZGVudGl0eU1hcDsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2Vk\nTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNl\ndC5NYXBCYWNrZWRTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29u\nZi5Db21wYXRpYmlsaXR5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5lZS5NYW5hZ2VkUnVudGltZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNv\nbW1pdEV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\ndmVudC5UcmFuc2FjdGlvbkV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LlRyYW5zYWN0aW9uRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hN\nYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJl\nbmNlSGFzaFNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5SZWZlcmVuY2VNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuY29uY3VycmVudC5SZWVudHJhbnRMb2NrOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2ll\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9u\nSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNl\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJh\nbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklt\ncGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRl\ncm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludmFsaWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk5vVHJhbnNhY3Rpb25FeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RFeGlzdHNFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGlt\naXN0aWNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5SdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoq\nCiAqIENvbmNyZXRlIHtAbGluayBCcm9rZXJ9LiBUaGUgYnJva2VyIGhhbmRs\nZXMgb2JqZWN0LWxldmVsIGJlaGF2aW9yLAogKiBidXQgbGVhdmVzIGFsbCBp\nbnRlcmFjdGlvbiB3aXRoIHRoZSBkYXRhIHN0b3JlIHRvIGEge0BsaW5rIFN0\nb3JlTWFuYWdlcn0KICogdGhhdCBtdXN0IGJlIHN1cHBsaWVkIGF0IGluaXRp\nYWxpemF0aW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGlj\nIGNsYXNzIEJyb2tlckltcGwKICAgIGltcGxlbWVudHMgQnJva2VyLCBGaW5k\nQ2FsbGJhY2tzLCBDbG9uZWFibGUgewoKICAgIC8qKgogICAgICogSW5jcmVt\nZW50YWwgZmx1c2guCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgaW50IEZMVVNIX0lOQyA9IDA7CgogICAgLyoqCiAgICAgKiBGbHVzaCBp\nbiBwcmVwYXJhdGlvbiBvZiBjb21taXQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBzdGF0aWMgZmluYWwgaW50IEZMVVNIX0NPTU1JVCA9IDE7CgogICAgLyoq\nCiAgICAgKiBGbHVzaCB0byBjaGVjayBjb25zaXN0ZW5jeSBvZiBjYWNoZSwg\ndGhlbiBpbW1lZGlhdGVseSByb2xsYmFjayBjaGFuZ2VzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9ST0xMQkFDSyA9\nIDI7CgogICAgLyoqCiAgICAgKiBSdW4gcGVyc2lzdGVuY2UtYnktcmVhY2hh\nYmlsaXR5IGFuZCBvdGhlciBmbHVzaC10aW1lIG9wZXJhdGlvbnMgd2l0aG91\ndAogICAgICogYWNjZXNzaW5nIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfTE9HSUNBTCA9IDM7\nCgogICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfSU5JVCA9IDA7CiAgICBz\ndGF0aWMgZmluYWwgaW50IFNUQVRVU19UUkFOU0lFTlQgPSAxOwogICAgc3Rh\ndGljIGZpbmFsIGludCBTVEFUVVNfT0lEX0FTU0lHTiA9IDI7CiAgICBzdGF0\naWMgZmluYWwgaW50IFNUQVRVU19DT01NSVRfTkVXID0gMzsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19BQ1RJVkUgPSAyIDw8IDA7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9BQ1RJVkUg\nPSAyIDw8IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19D\nTE9TRV9JTlZPS0VEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IEZMQUdfUFJFU1RPUklORyA9IDIgPDwgMzsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0RFUkVGREVMRVRJTkcgPSAyIDw8IDQ7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSElORyA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1NU\nT1JFX0ZMVVNISU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IEZMQUdfRkxVU0hFRCA9IDIgPDwgNzsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8PCA4Owog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVNT1RFX0xJU1RF\nTkVSID0gMiA8PCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUkVUQUlORURfQ09OTiA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDExOwoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0KICAgICAg\nICBMb2NhbGl6ZXIuZm9yUGFja2FnZShCcm9rZXJJbXBsLmNsYXNzKTsKCiAg\nICAvLwl0aGUgc3RvcmUgbWFuYWdlciBpbiB1c2U7IHRoaXMgbWF5IGJlIGEg\nZGVjb3JhdG9yIHN1Y2ggYXMgYQogICAgLy8JZGF0YSBjYWNoZSBzdG9yZSBt\nYW5hZ2VyIGFyb3VuZCB0aGUgbmF0aXZlIHN0b3JlIG1hbmFnZXIKICAgIHBy\naXZhdGUgRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBfc3RvcmUgPSBudWxsOwoK\nICAgIC8vIHJlZiB0byBwcm9kdWNpbmcgZmFjdG9yeSBhbmQgY29uZmlndXJh\ndGlvbgogICAgcHJpdmF0ZSBBYnN0cmFjdEJyb2tlckZhY3RvcnkgX2ZhY3Rv\ncnkgPSBudWxsOwogICAgcHJpdmF0ZSBPcGVuSlBBQ29uZmlndXJhdGlvbiBf\nY29uZiA9IG51bGw7CiAgICBwcml2YXRlIENvbXBhdGliaWxpdHkgX2NvbXBh\ndCA9IG51bGw7CiAgICBwcml2YXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMg\nPSBudWxsOwogICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CiAgICBwcml2\nYXRlIFN0cmluZyBfdXNlciA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBf\ncGFzcyA9IG51bGw7CiAgICBwcml2YXRlIE1hbmFnZWRSdW50aW1lIF9ydW50\naW1lID0gbnVsbDsKICAgIHByaXZhdGUgTG9ja01hbmFnZXIgX2xtID0gbnVs\nbDsKICAgIHByaXZhdGUgSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsKICAg\nIHByaXZhdGUgSkNBSGVscGVyIF9qY2EgPSBudWxsOwogICAgcHJpdmF0ZSBS\nZWVudHJhbnRMb2NrIF9sb2NrID0gbnVsbDsKICAgIHByaXZhdGUgT3BDYWxs\nYmFja3MgX2NhbGwgPSBudWxsOwogICAgcHJpdmF0ZSBSdW50aW1lRXhjZXB0\naW9uVHJhbnNsYXRvciBfZXh0cmFucyA9IG51bGw7CgogICAgLy8gY2FjaGUg\nY2xhc3MgbG9hZGVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgYnJva2VyCiAgICBw\ncml2YXRlIENsYXNzTG9hZGVyIF9sb2FkZXIgPSBudWxsOwoKICAgIC8vIHVz\nZXIgc3RhdGUKICAgIHByaXZhdGUgU3luY2hyb25pemF0aW9uIF9zeW5jID0g\nbnVsbDsKICAgIHByaXZhdGUgTWFwIF91c2VyT2JqZWN0cyA9IG51bGw7Cgog\nICAgLy8gbWFuYWdlZCBvYmplY3QgY2FjaGVzCiAgICBwcml2YXRlIE1hbmFn\nZWRDYWNoZSBfY2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBUcmFuc2FjdGlv\nbmFsQ2FjaGUgX3RyYW5zQ2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQg\nX3RyYW5zQWRkaXRpb25zID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9kZXJl\nZkNhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9kZXJlZkFkZGl0aW9u\ncyA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfbG9hZGluZyA9IG51bGw7CiAg\nICBwcml2YXRlIFNldCBfb3BlcmF0aW5nID0gbnVsbDsKICAgIHByaXZhdGUg\nU2V0IF9wZXJzaXN0ZWRDbHNzID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF91\ncGRhdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVsZXRlZENs\nc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX3BlbmRpbmcgPSBudWxsOwoK\nICAgIC8vIHRyYWNrIGluc3RhbmNlcyB0aGF0IGJlY29tZSB0cmFuc2FjdGlv\nbmFsIGFmdGVyIHRoZSBmaXJzdCBzYXZlcG9pbnQKICAgIC8vICh0aGUgZmly\nc3QgdXNlcyB0aGUgdHJhbnNhY3Rpb25hbCBjYWNoZSkKICAgIHByaXZhdGUg\nU2V0IF9zYXZlcG9pbnRDYWNoZSA9IG51bGw7CiAgICBwcml2YXRlIExpbmtl\nZE1hcCBfc2F2ZXBvaW50cyA9IG51bGw7CiAgICBwcml2YXRlIFNhdmVwb2lu\ndE1hbmFnZXIgX3NwbSA9IG51bGw7CgogICAgLy8gdHJhY2sgb3BlbiBxdWVy\naWVzIGFuZCBleHRlbnRzIHNvIHdlIGNhbiBmcmVlIHRoZWlyIHJlc291cmNl\ncyBvbiBjbG9zZQogICAgcHJpdmF0ZSBSZWZlcmVuY2VIYXNoU2V0IF9xdWVy\naWVzID0gbnVsbDsKICAgIHByaXZhdGUgUmVmZXJlbmNlSGFzaFNldCBfZXh0\nZW50cyA9IG51bGw7CgogICAgLy8gdHJhY2sgb3BlcmF0aW9uIHN0YWNrIGRl\ncHRoCiAgICBwcml2YXRlIGludCBfb3BlcmF0aW9uQ291bnQgPSAwOwoKICAg\nIC8vIG9wdGlvbnMKICAgIHByaXZhdGUgYm9vbGVhbiBfbm9udHJhbnNSZWFk\nID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX25vbnRyYW5zV3JpdGUg\nPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfcmV0YWluU3RhdGUgPSBm\nYWxzZTsKICAgIHByaXZhdGUgaW50IF9hdXRvQ2xlYXIgPSBDTEVBUl9EQVRB\nU1RPUkU7CiAgICBwcml2YXRlIGludCBfcmVzdG9yZVN0YXRlID0gUkVTVE9S\nRV9JTU1VVEFCTEU7CiAgICBwcml2YXRlIGJvb2xlYW4gX29wdGltaXN0aWMg\nPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfaWdub3JlQ2hhbmdlcyA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9tdWx0aXRocmVhZGVkID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX21hbmFnZWQgPSBmYWxzZTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfc3luY01hbmFnZWQgPSBmYWxzZTsKICAg\nIHByaXZhdGUgaW50IF9jb25uUmV0YWluTW9kZSA9IENPTk5fUkVUQUlOX0RF\nTUFORDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZXZpY3REYXRhQ2FjaGUgPSBm\nYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfcG9wdWxhdGVEYXRhQ2FjaGUg\nPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9sYXJnZVRyYW5zYWN0aW9u\nID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfYXV0b0RldGFjaCA9IDA7CiAg\nICBwcml2YXRlIGludCBfZGV0YWNoU3RhdGUgPSBERVRBQ0hfTE9BREVEOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9kZXRhY2hlZE5ldyA9IHRydWU7CiAgICBw\ncml2YXRlIGJvb2xlYW4gX29yZGVyRGlydHkgPSBmYWxzZTsKCiAgICAvLyBz\ndGF0dXMKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2Nsb3NlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBSdW50aW1l\nRXhjZXB0aW9uIF9jbG9zZWRFeGNlcHRpb24gPSBudWxsOwoKICAgIC8vIGV2\nZW50IG1hbmFnZXJzCiAgICBwcml2YXRlIFRyYW5zYWN0aW9uRXZlbnRNYW5h\nZ2VyIF90cmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfdHJhbnNDYWxsYmFja01vZGUgPSAwOwogICAgcHJpdmF0ZSBMaWZlY3lj\nbGVFdmVudE1hbmFnZXIgX2xpZmVFdmVudE1hbmFnZXIgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnQgX2xpZmVDYWxsYmFja01vZGUgPSAwOwoKICAgIHByaXZh\ndGUgYm9vbGVhbiBfaW5pdGlhbGl6ZVdhc0ludm9rZWQgPSBmYWxzZTsKICAg\nIAogICAgLyoqCiAgICAgKiBTZXQgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIn\ncyBhdXRoZW50aWNhdGlvbi4gVGhpcyBpcyB0aGUgZmlyc3QKICAgICAqIG1l\ndGhvZCBjYWxsZWQgYWZ0ZXIgY29uc3RydWN0aW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSB1c2VyIHRoZSB1c2VybmFtZSB0aGlzIGJyb2tlciByZXByZXNl\nbnRzOyB1c2VkIHdoZW4gcG9vbGluZwogICAgICogYnJva2VycyB0byBtYWtl\nIHN1cmUgdGhhdCBhIHJlcXVlc3QgdG8gdGhlIGZhY3RvcnkgZm9yCiAgICAg\nKiBhIGNvbm5lY3Rpb24gd2l0aCBhbiBleHBsaWNpdCB1c2VyIGlzIGRlbGVn\nYXRlZCB0byBhIHN1aXRhYmxlIGJyb2tlcgogICAgICogQHBhcmFtIHBhc3Mg\ndGhlIHBhc3N3b3JkIGZvciB0aGUgYWJvdmUgdXNlcgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRBdXRoZW50aWNhdGlvbihTdHJpbmcgdXNlciwgU3Ry\naW5nIHBhc3MpIHsKICAgICAgICBfdXNlciA9IHVzZXI7CiAgICAgICAgX3Bh\nc3MgPSBwYXNzOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSB0\naGUgcGVyc2lzdGVuY2UgbWFuYWdlci4gVGhpcyBtZXRob2QgaXMgY2FsbGVk\nCiAgICAgKiBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBmYWN0b3J5IGJlZm9yZSB1\nc2UuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhlIGZhY3Rvcnkg\ndXNlZCB0byBjcmVhdGUgdGhpcyBicm9rZXIKICAgICAqIEBwYXJhbSBzbSBh\nIGNvbmNyZXRlIFN0b3JlTWFuYWdlciBpbXBsZW1lbnRhdGlvbiB0bwogICAg\nICogaGFuZGxlIGludGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3RvcmUKICAg\nICAqIEBwYXJhbSBtYW5hZ2VkIHRoZSB0cmFuc2FjdGlvbiBtb2RlCiAgICAg\nKiBAcGFyYW0gY29ubk1vZGUgdGhlIGNvbm5lY3Rpb24gcmV0YWluIG1vZGUK\nICAgICAqLwogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZShBYnN0cmFjdEJy\nb2tlckZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBEZWxlZ2F0aW5nU3RvcmVN\nYW5hZ2VyIHNtLCBib29sZWFuIG1hbmFnZWQsIGludCBjb25uTW9kZSkgewog\nICAgICAgIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IHRydWU7CiAgICAgICAg\nX2xvYWRlciA9IFRocmVhZC5jdXJyZW50VGhyZWFkKCkuZ2V0Q29udGV4dENs\nYXNzTG9hZGVyKCk7CiAgICAgICAgX2pjYSA9IG5ldyBKQ0FIZWxwZXIoKTsK\nICAgICAgICBfY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwog\nICAgICAgIF9jb21wYXQgPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFu\nY2UoKTsKICAgICAgICBfZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAgICAgX2xv\nZyA9IF9jb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVO\nVElNRSk7CiAgICAgICAgX2NhY2hlID0gbmV3IE1hbmFnZWRDYWNoZShuZXdN\nYW5hZ2VkT2JqZWN0Q2FjaGUoKSk7CiAgICAgICAgX29wZXJhdGluZyA9IE1h\ncEJhY2tlZFNldC5kZWNvcmF0ZShuZXcgSWRlbnRpdHlNYXAoKSk7CiAgICAg\nICAgX2Nvbm5SZXRhaW5Nb2RlID0gY29ubk1vZGU7CiAgICAgICAgX21hbmFn\nZWQgPSBtYW5hZ2VkOwogICAgICAgIGlmIChtYW5hZ2VkKQogICAgICAgICAg\nICBfcnVudGltZSA9IF9jb25mLmdldE1hbmFnZWRSdW50aW1lSW5zdGFuY2Uo\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9ydW50aW1lID0gbmV3IExv\nY2FsTWFuYWdlZFJ1bnRpbWUodGhpcyk7CgogICAgICAgIF9saWZlRXZlbnRN\nYW5hZ2VyID0gbmV3IExpZmVjeWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAg\nIF90cmFuc0V2ZW50TWFuYWdlciA9IG5ldyBUcmFuc2FjdGlvbkV2ZW50TWFu\nYWdlcigpOwogICAgICAgIGludCBjbW9kZSA9IF9jb25mLmdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRh\nRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAg\nICAgICAgc2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUp\nOwogICAgICAgIHNldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUo\nY21vZGUpOwoKICAgICAgICAvLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMKICAg\nICAgICBfZmFjdG9yeS5jb25maWd1cmVCcm9rZXIodGhpcyk7CgogICAgICAg\nIC8vIG1ha2Ugc3VyZSB0byBkbyB0aGlzIGFmdGVyIGNvbmZpZ3VyaW5nIGJy\nb2tlciBzbyB0aGF0IHN0b3JlIG1hbmFnZXIKICAgICAgICAvLyBjYW4gbG9v\nayB0byBicm9rZXIgY29uZmlndXJhdGlvbjsgd2Ugc2V0IGJvdGggc3RvcmUg\nYW5kIGxvY2sgbWFuYWdlcnMKICAgICAgICAvLyBiZWZvcmUgaW5pdGlhbGl6\naW5nIHRoZW0gYmVjYXVzZSB0aGV5IG1heSBlYWNoIHRyeSB0byBhY2Nlc3Mg\ndGhlCiAgICAgICAgLy8gb3RoZXIgaW4gdGhpZXIgaW5pdGlhbGl6YXRpb24K\nICAgICAgICBfc3RvcmUgPSBzbTsKICAgICAgICBfbG0gPSBfY29uZi5uZXdM\nb2NrTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX2ltID0gX2NvbmYubmV3\nSW52ZXJzZU1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9zcG0gPSBfY29u\nZi5nZXRTYXZlcG9pbnRNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfc3Rv\ncmUuc2V0Q29udGV4dCh0aGlzKTsKICAgICAgICBfbG0uc2V0Q29udGV4dCh0\naGlzKTsKCiAgICAgICAgaWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JF\nVEFJTl9BTFdBWVMpCiAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsK\nICAgICAgICBfZmMgPSBfc3RvcmUubmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgX2ZjLnNldENvbnRleHQodGhpcyk7CgogICAgICAgIC8vIHN5\nbmNoIHdpdGggdGhlIGdsb2JhbCB0cmFuc2FjdGlvbiBpbiBwcm9ncmVzcywg\naWYgYW55CiAgICAgICAgaWYgKF9mYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRy\nYW5zYWN0aW9uKHRoaXMsIGZhbHNlKSkKICAgICAgICAgICAgYmVnaW5JbnRl\ncm5hbCgpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKQogICAg\nICAgIHRocm93cyBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKF9pbml0aWFsaXplV2FzSW52b2tlZCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5jbG9uZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIHtAbGluayBN\nYXB9IHRvIGJlIHVzZWQgZm9yIHRoZSBwcmltYXJ5IG1hbmFnZWQgb2JqZWN0\nIGNhY2hlLgogICAgICogTWFwcyBvaWRzIHRvIHN0YXRlIG1hbmFnZXJzLiBC\neSBkZWZhdWx0LCB0aGlzIGNyZWF0ZXMgYQogICAgICoge0BsaW5rIFJlZmVy\nZW5jZU1hcH0gd2l0aCBzb2Z0IHZhbHVlcy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE1hcCBuZXdNYW5hZ2VkT2JqZWN0Q2FjaGUoKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBSZWZlcmVuY2VIYXNoTWFwKFJlZmVyZW5jZU1hcC5IQVJELCBS\nZWZlcmVuY2VNYXAuU09GVCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRh\ndGlvbiBvZiBDb25uZWN0aW9uIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIENv\nbm5lY3Rpb25NZXRhRGF0YSBnZXRNZXRhRGF0YSgpCiAgICAgICAgdGhyb3dz\nIFJlc291cmNlRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gX2pjYTsKICAg\nIH0KCiAgICBwdWJsaWMgSW50ZXJhY3Rpb24gY3JlYXRlSW50ZXJhY3Rpb24o\nKQogICAgICAgIHRocm93cyBSZXNvdXJjZUV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIF9qY2E7CiAgICB9CgogICAgcHVibGljIExvY2FsVHJhbnNhY3Rp\nb24gZ2V0TG9jYWxUcmFuc2FjdGlvbigpCiAgICAgICAgdGhyb3dzIFJlc291\ncmNlRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgUmVzdWx0U2V0SW5mbyBnZXRSZXN1bHRTZXRJbmZvKCkKICAg\nICAgICB0aHJvd3MgUmVzb3VyY2VFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBfamNhOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIFN0b3JlQ29udGV4\ndAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAg\nIHB1YmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcm9wZXJ0\naWVzCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNldElt\ncGxpY2l0QmVoYXZpb3IoT3BDYWxsYmFja3MgY2FsbCwKICAgICAgICBSdW50\naW1lRXhjZXB0aW9uVHJhbnNsYXRvciBleCkgewogICAgICAgIGlmIChfY2Fs\nbCA9PSBudWxsKQogICAgICAgICAgICBfY2FsbCA9IGNhbGw7CiAgICAgICAg\naWYgKF9leHRyYW5zID09IG51bGwpCiAgICAgICAgICAgIF9leHRyYW5zID0g\nZXg7CiAgICB9CgogICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgZ2V0\nSW5zdGFuY2VFeGNlcHRpb25UcmFuc2xhdG9yKCkgewogICAgICAgIHJldHVy\nbiAoX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4dHJhbnMgOiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5IGdldEJyb2tlckZhY3Rv\ncnkoKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5OwogICAgfQoKICAgIHB1\nYmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkg\newogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgRmV0\nY2hDb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAg\nICAgICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0Q29u\nbmVjdGlvblJldGFpbk1vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9jb25uUmV0\nYWluTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWQo\nKSB7CiAgICAgICAgcmV0dXJuIF9tYW5hZ2VkOwogICAgfQoKICAgIHB1Ymxp\nYyBNYW5hZ2VkUnVudGltZSBnZXRNYW5hZ2VkUnVudGltZSgpIHsKICAgICAg\nICByZXR1cm4gX3J1bnRpbWU7CiAgICB9CgogICAgcHVibGljIENsYXNzTG9h\nZGVyIGdldENsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfbG9hZGVy\nOwogICAgfQoKICAgIHB1YmxpYyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIGdl\ndFN0b3JlTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX3N0b3JlOwogICAg\nfQoKICAgIHB1YmxpYyBMb2NrTWFuYWdlciBnZXRMb2NrTWFuYWdlcigpIHsK\nICAgICAgICByZXR1cm4gX2xtOwogICAgfQoKICAgIHB1YmxpYyBJbnZlcnNl\nTWFuYWdlciBnZXRJbnZlcnNlTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4g\nX2ltOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ubmVjdGlvblVz\nZXJOYW1lKCkgewogICAgICAgIHJldHVybiBfdXNlcjsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nIGdldENvbm5lY3Rpb25QYXNzd29yZCgpIHsKICAgICAg\nICByZXR1cm4gX3Bhc3M7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0\nTXVsdGl0aHJlYWRlZCgpIHsKICAgICAgICByZXR1cm4gX211bHRpdGhyZWFk\nZWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TXVsdGl0aHJlYWRlZChi\nb29sZWFuIG11bHRpdGhyZWFkZWQpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgX211bHRpdGhyZWFkZWQgPSBtdWx0aXRocmVhZGVkOwogICAg\nICAgIGlmIChtdWx0aXRocmVhZGVkICYmIF9sb2NrID09IG51bGwpCiAgICAg\nICAgICAgIF9sb2NrID0gbmV3IFJlZW50cmFudExvY2soKTsKICAgICAgICBl\nbHNlIGlmICghbXVsdGl0aHJlYWRlZCkKICAgICAgICAgICAgX2xvY2sgPSBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldElnbm9yZUNoYW5n\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pZ25vcmVDaGFuZ2VzOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldElnbm9yZUNoYW5nZXMoYm9vbGVhbiB2YWwp\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2lnbm9yZUNoYW5n\nZXMgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJh\nbnNhY3Rpb25hbFJlYWQoKSB7CiAgICAgICAgcmV0dXJuIF9ub250cmFuc1Jl\nYWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJp\nbGxlZ2FsLW9wLWluLXByZXN0b3JlIikpOwoKICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAgICBpZiAodmFsICYm\nICFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMKICAgICAgICAg\nICAgKF9jb25mLk9QVElPTl9OT05UUkFOU19SRUFEKSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAg\nICAgICAgICAgICAoIm5vbnRyYW5zLXJlYWQtbm90LXN1cHBvcnRlZCIpKTsK\nCiAgICAgICAgX25vbnRyYW5zUmVhZCA9IHZhbDsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsV3JpdGUoKSB7CiAgICAg\nICAgcmV0dXJuIF9ub250cmFuc1dyaXRlOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldE5vbnRyYW5zYWN0aW9uYWxXcml0ZShib29sZWFuIHZhbCkgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwtb3AtaW4tcHJlc3RvcmUi\nKSk7CgogICAgICAgIF9ub250cmFuc1dyaXRlID0gdmFsOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGdldE9wdGltaXN0aWMoKSB7CiAgICAgICAgcmV0\ndXJuIF9vcHRpbWlzdGljOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE9w\ndGltaXN0aWMoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgidHJhbnMtYWN0aXZlIiwKICAgICAgICAgICAgICAgICJPcHRpbWlz\ndGljIikpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3Vw\ncG9ydHMgaXQKICAgICAgICBpZiAodmFsICYmICFfY29uZi5zdXBwb3J0ZWRP\ncHRpb25zKCkuY29udGFpbnMoX2NvbmYuT1BUSU9OX09QVElNSVNUSUMpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICgib3B0aW1pc3RpYy1ub3Qtc3VwcG9y\ndGVkIikpOwoKICAgICAgICBfb3B0aW1pc3RpYyA9IHZhbDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldFJlc3RvcmVTdGF0ZSgpIHsKICAgICAgICByZXR1\ncm4gX3Jlc3RvcmVTdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRS\nZXN0b3JlU3RhdGUoaW50IHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAgICAgICAgIlJlc3RvcmUi\nKSk7CgogICAgICAgIF9yZXN0b3JlU3RhdGUgPSB2YWw7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0UmV0YWluU3RhdGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9yZXRhaW5TdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRS\nZXRhaW5TdGF0ZShib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0g\nMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoImlsbGVnYWwtb3AtaW4tcHJlc3RvcmUiKSk7CiAgICAgICAgX3JldGFp\nblN0YXRlID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QXV0b0Ns\nZWFyKCkgewogICAgICAgIHJldHVybiBfYXV0b0NsZWFyOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEF1dG9DbGVhcihpbnQgdmFsKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIF9hdXRvQ2xlYXIgPSB2YWw7CiAgICB9\nCgogICAgcHVibGljIGludCBnZXRBdXRvRGV0YWNoKCkgewogICAgICAgIHJl\ndHVybiBfYXV0b0RldGFjaDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRB\ndXRvRGV0YWNoKGludCBkZXRhY2hGbGFncykgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBfYXV0b0RldGFjaCA9IGRldGFjaEZsYWdzOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFjaEZs\nYWcsIGJvb2xlYW4gb24pIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgaWYgKG9uKQogICAgICAgICAgICBfYXV0b0RldGFjaCB8PSBkZXRhY2hG\nbGFnOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2F1dG9EZXRhY2ggJj0g\nfmRldGFjaEZsYWc7CiAgICB9CgogICAgcHVibGljIGludCBnZXREZXRhY2hT\ndGF0ZSgpIHsKICAgICAgICByZXR1cm4gX2RldGFjaFN0YXRlOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldERldGFjaFN0YXRlKGludCBtb2RlKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9kZXRhY2hTdGF0ZSA9IG1v\nZGU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hlZE5ldygp\nIHsKICAgICAgICByZXR1cm4gX2RldGFjaGVkTmV3OwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldERldGFjaGVkTmV3KGJvb2xlYW4gaXNOZXcpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2RldGFjaGVkTmV3ID0gaXNO\nZXc7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0U3luY1dpdGhNYW5h\nZ2VkVHJhbnNhY3Rpb25zKCkgewogICAgICAgIHJldHVybiBfc3luY01hbmFn\nZWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3luY1dpdGhNYW5hZ2Vk\nVHJhbnNhY3Rpb25zKGJvb2xlYW4gc3luYykgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBfc3luY01hbmFnZWQgPSBzeW5jOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGdldEV2aWN0RnJvbURhdGFDYWNoZSgpIHsKICAg\nICAgICByZXR1cm4gX2V2aWN0RGF0YUNhY2hlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEV2aWN0RnJvbURhdGFDYWNoZShib29sZWFuIGV2aWN0KSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9ldmljdERhdGFDYWNo\nZSA9IGV2aWN0OwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFBvcHVs\nYXRlRGF0YUNhY2hlKCkgewogICAgICAgIHJldHVybiBfcG9wdWxhdGVEYXRh\nQ2FjaGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UG9wdWxhdGVEYXRh\nQ2FjaGUoYm9vbGVhbiBjYWNoZSkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfcG9wdWxhdGVEYXRhQ2FjaGUgPSBjYWNoZTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0xhcmdlVHJhbnNhY3Rpb24oKSB7CiAgICAg\nICAgcmV0dXJuIF9sYXJnZVRyYW5zYWN0aW9uOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldExhcmdlVHJhbnNhY3Rpb24oYm9vbGVhbiBsYXJnZVRyYW5z\nYWN0aW9uKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9sYXJn\nZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFuc2FjdGlvbjsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFVzZXJPYmplY3QoT2JqZWN0IGtleSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9PSBudWxsKSA/IG51bGwg\nOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgcHV0VXNlck9iamVjdChPYmplY3Qga2V5LCBP\nYmplY3QgdmFsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiAoX3VzZXJPYmplY3RzID09IG51bGwpID8g\nbnVsbCA6IF91c2VyT2JqZWN0cy5yZW1vdmUoa2V5KTsKCiAgICAgICAgICAg\nIGlmIChfdXNlck9iamVjdHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91\nc2VyT2JqZWN0cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIHJldHVy\nbiBfdXNlck9iamVjdHMucHV0KGtleSwgdmFsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIoT2Jq\nZWN0IGxpc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNsYXNz\nZXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIobGlzdGVu\nZXIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGdldExp\nZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJldHVy\nbiBfbGlmZUNhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRMaWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfbGlmZUNhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAg\nICAgIF9saWZlRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FM\nTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHaXZlIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0byB0\naGUgbGlmZWN5Y2xlIGV2ZW50IG1hbmFnZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBMaWZlY3ljbGVFdmVudE1hbmFnZXIgZ2V0TGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyKCkgewogICAgICAgIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gbGlmZWN5Y2xlIGV2ZW50\nLCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAg\nICoKICAgICAqIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHBy\nb2Nlc3NlZCBhdCB0aGlzIHRpbWUKICAgICAqLwogICAgYm9vbGVhbiBmaXJl\nTGlmZWN5Y2xlRXZlbnQoT2JqZWN0IHNyYywgT2JqZWN0IHJlbGF0ZWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBpbnQgZXZlbnRUeXBlKSB7CiAg\nICAgICAgaWYgKF9saWZlRXZlbnRNYW5hZ2VyID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2Vw\ndGlvbnMoX2xpZmVFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRl\nZCwgCiAgICAgICAgICAgIG1ldGEsIGV2ZW50VHlwZSksIF9saWZlQ2FsbGJh\nY2tNb2RlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBleGNlcHRpb25zIGRl\ncGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKEV4Y2VwdGlvbltdIGV4\nY2VwcywgaW50IG1vZGUpIHsKICAgICAgICBpZiAoZXhjZXBzLmxlbmd0aCA9\nPSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAhPSAwKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIE9wZW5KUEFFeGNlcHRpb24gY2U7CiAg\nICAgICAgaWYgKGV4Y2Vwcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgY2Ug\nPSBuZXcgQ2FsbGJhY2tFeGNlcHRpb24oZXhjZXBzWzBdKTsKICAgICAgICBl\nbHNlIAogICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihf\nbG9jLmdldCgiY2FsbGJhY2stZXJyIikpLgogICAgICAgICAgICAgICAgc2V0\nTmVzdGVkVGhyb3dhYmxlcyhleGNlcHMpOwogICAgICAgIGlmICgobW9kZSAm\nIENBTExCQUNLX1JPTExCQUNLKSAhPSAwICYmIChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCkgewogICAgICAgICAgICBjZS5zZXRGYXRhbCh0cnVlKTsK\nICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoY2UpOwogICAg\nICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBDQUxMQkFDS19MT0cpICE9IDAg\nJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fy\nbihjZSk7CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUkVUSFJPVykg\nIT0gMCkKICAgICAgICAgICAgdGhyb3cgY2U7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYWRkVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgdGwpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKHRsKTsK\nICAgICAgICAgICAgaWYgKHRsIGluc3RhbmNlb2YgUmVtb3RlQ29tbWl0RXZl\nbnRNYW5hZ2VyKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVN\nT1RFX0xJU1RFTkVSOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByZW1vdmVUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3Rl\nbmVyKHRsKQogICAgICAgICAgICAgICAgJiYgKHRsIGluc3RhbmNlb2YgUmVt\nb3RlQ29tbWl0RXZlbnRNYW5hZ2VyKSkKICAgICAgICAgICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19SRU1PVEVfTElTVEVORVI7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBpbnQgZ2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxi\nYWNrTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tNb2Rl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFRyYW5zYWN0aW9uTGlzdGVu\nZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3RyYW5z\nQ2FsbGJhY2tNb2RlID0gbW9kZTsKICAgICAgICAgICAgX3RyYW5zRXZlbnRN\nYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FMTEJBQ0tfRkFJTF9GQVNU\nKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBG\naXJlIGdpdmVuIHRyYW5zYWN0aW9uIGV2ZW50LCBoYW5kbGluZyBhbnkgZXhj\nZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAgICoKICAgICAqIEByZXR1cm4g\nd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHByb2Nlc3NlZCBhdCB0aGlzIHRp\nbWUKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZpcmVUcmFuc2FjdGlvbkV2\nZW50KFRyYW5zYWN0aW9uRXZlbnQgdHJhbnMpIHsKICAgICAgICBpZiAoX3Ry\nYW5zRXZlbnRNYW5hZ2VyICE9IG51bGwpCiAgICAgICAgICAgIGhhbmRsZUNh\nbGxiYWNrRXhjZXB0aW9ucyhfdHJhbnNFdmVudE1hbmFnZXIuZmlyZUV2ZW50\nKHRyYW5zKSwKICAgICAgICAgICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSk7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIExvb2t1cHMKICAgIC8v\nLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQs\nIGJvb2xlYW4gdmFsaWRhdGUsIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGludCBmbGFncyA9IE9JRF9DT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9J\nRF9OT0RFTEVURUQ7CiAgICAgICAgaWYgKCF2YWxpZGF0ZSkKICAgICAgICAg\nICAgZmxhZ3MgfD0gT0lEX05PVkFMSURBVEU7CiAgICAgICAgcmV0dXJuIGZp\nbmQob2lkLCBfZmMsIG51bGwsIG51bGwsIGZsYWdzLCBjYWxsKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQoT2JqZWN0IG9pZCwgRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBCaXRTZXQgZXhjbHVkZSwKICAgICAgICBPYmpl\nY3QgZWRhdGEsIGludCBmbGFncykgewogICAgICAgIHJldHVybiBmaW5kKG9p\nZCwgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRhLCBmbGFncywgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBPYmplY3QgZmluZChPYmplY3Qgb2lkLCBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBleGNsdWRlLAogICAgICAgIE9iamVj\ndCBlZGF0YSwgaW50IGZsYWdzLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBjYWxsID0gdGhp\nczsKICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1bWVudChvaWQpOwog\nICAgICAgIGlmIChvaWQgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoKGZs\nYWdzICYgT0lEX05PVkFMSURBVEUpID09IDApCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQoIm51\nbGwtb2lkIikpOwogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0\ndXJuKG9pZCwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGlmIChmZXRjaCA9\nPSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IF9mYzsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIC8v\nIGNhY2hlZCBpbnN0YW5jZT8KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwKICAgICAgICAg\nICAgICAgIChmbGFncyAmIE9JRF9BTExPV19ORVcpICE9IDAgfHwgKF9mbGFn\ncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCk7CiAgICAgICAgICAgIGlmIChzbSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoIXJlcXVpcmVzTG9hZChz\nbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRhLCBmbGFncykpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKCiAg\nICAgICAgICAgICAgICBpZiAoIXNtLmlzTG9hZGluZygpKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCB0aGUgY29uZmlndXJlZCBm\naWVsZHMgYXJlIGxvYWRlZDsgZG8gdGhpcwogICAgICAgICAgICAgICAgICAg\nIC8vIGFmdGVyIG1ha2luZyBpbnN0YW5jZSB0cmFuc2FjdGlvbmFsIGZvciBs\nb2NraW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKCFzbS5pc1RyYW5zYWN0\naW9uYWwoKSAmJiB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQogICAg\nICAgICAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAg\nICAgICAgICAgICAgICAgYm9vbGVhbiBsb2FkZWQgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBs\nb2FkZWQgPSBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURf\nRkdTLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGUsIGVk\nYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoT2Jq\nZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFM\nSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBvbmZlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5w\ncm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgICAgICAvLyBpZiBubyBkYXRhIG5lZWRlZCB0\nbyBiZSBsb2FkZWQgYW5kIHRoZSB1c2VyIHdhbnRzIHRvCiAgICAgICAgICAg\nICAgICAgICAgLy8gdmFsaWRhdGUsIGp1c3QgbWFrZSBzdXJlIHRoZSBvYmpl\nY3QgZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFsb2FkZWQgJiYg\nKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09IDAKICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgX2NvbXBhdC5nZXRWYWxpZGF0ZVRydWVDaGVja3NTdG9y\nZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFzbS5pc1RyYW5zYWN0\naW9uYWwoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhX3N0b3JlLmV4\naXN0cyhzbSwgZWRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQs\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2Jq\nZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICgiZGVsLWluc3RhbmNlIiwgc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCksIG9pZCkpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgLy8gc2luY2UgdGhlIG9iamVjdCB3YXMgY2FjaGVkLCB3ZSBt\nYXkgbmVlZCB0byB1cGdyYWRlIGxvY2sKICAgICAgICAgICAgICAgIC8vIGlm\nIGN1cnJlbnQgbGV2ZWwgaXMgaGlnaGVyIHRoYW4gbGV2ZWwgb2YgaW5pdGlh\nbCBsb2FkCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IGxldmVsID0g\nZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAgICAgICAgICAgICAg\nIF9sbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwg\nZWRhdGEpOwogICAgICAgICAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2\nZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVy\nbihvaWQsIHNtKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYg\ndGhlcmUncyBubyBjYWNoZWQgc20gZm9yIGEgbmV3L3RyYW5zaWVudCBpZCB0\neXBlLCB3ZQogICAgICAgICAgICAvLyBpdCBkZWZpbml0ZWx5IGRvZXNuJ3Qg\nZXhpc3QKICAgICAgICAgICAgaWYgKG9pZCBpbnN0YW5jZW9mIFN0YXRlTWFu\nYWdlcklkKQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1Jl\ndHVybihvaWQsIG51bGwpOwoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBh\nIG5ldyBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZGF0YXN0b3JlIGluc3RhbmNl\nCiAgICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIChm\nbGFncyAmIE9JRF9DT1BZKSAhPSAwKTsKICAgICAgICAgICAgYm9vbGVhbiBs\nb2FkID0gcmVxdWlyZXNMb2FkKHNtLCBmYWxzZSwgZmV0Y2gsIGVkYXRhLCBm\nbGFncyk7CiAgICAgICAgICAgIHNtID0gaW5pdGlhbGl6ZShzbSwgbG9hZCwg\nZmV0Y2gsIGVkYXRhKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkg\nIT0gMCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90\nRm91bmRFeGNlcHRpb24ob2lkKTsKICAgICAgICAgICAgICAgIHJldHVybiBj\nYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjb25maWd1cmVkIGZpZWxk\ncyB3ZXJlIGxvYWRlZAogICAgICAgICAgICBpZiAobG9hZCkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKGZl\ndGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBleGNsdWRlLAogICAg\nICAgICAgICAgICAgICAgICAgICBlZGF0YSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkg\newogICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxF\nVEVEKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAm\nIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNz\nUmV0dXJuKG9pZCwgc20pOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5ld2x5LWNvbnN0cnVj\ndGVkIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0\nZU1hbmFnZXJJbXBsIGluaXRpYWxpemUoU3RhdGVNYW5hZ2VySW1wbCBzbSwg\nYm9vbGVhbiBsb2FkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgaWYgKCFsb2FkKSB7CiAgICAg\nICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNj\ncmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICBQQ1N0YXRlLkhPTExPVyk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZSA9\nICh1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQogICAgICAgICAgICAg\nICAgPyBQQ1N0YXRlLlBDTEVBTiA6IFBDU3RhdGUuUE5PTlRSQU5TOwogICAg\nICAgICAgICBzbS5zZXRMb2FkaW5nKHRydWUpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgaWYgKCFfc3RvcmUuaW5pdGlhbGl6ZShzbSwg\nc3RhdGUsIGZldGNoLCBlZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBzbS5zZXRMb2FkaW5nKGZhbHNlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gc207CiAgICB9CgogICAgcHVibGljIE9i\namVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBib29sZWFuIHZhbGlk\nYXRlLAogICAgICAgIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlu\ndCBmbGFncyA9IE9JRF9DT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RF\nTEVURUQ7CiAgICAgICAgaWYgKCF2YWxpZGF0ZSkKICAgICAgICAgICAgZmxh\nZ3MgfD0gT0lEX05PVkFMSURBVEU7CiAgICAgICAgcmV0dXJuIGZpbmRBbGwo\nb2lkcywgX2ZjLCBudWxsLCBudWxsLCBmbGFncywgY2FsbCk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1\nZGUsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAgICAgICAgcmV0dXJu\nIGZpbmRBbGwob2lkcywgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRhLCBmbGFncywg\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3RbXSBmaW5kQWxsKENvbGxl\nY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAg\nIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncywgRmlu\nZENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgLy8gdGhyb3cgYW55IGV4Y2Vw\ndGlvbnMgZm9yIG51bGwgb2lkcyB1cCBpbW1lZGlhdGVseQogICAgICAgIGlm\nIChvaWRzID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigib2lkcyA9PSBudWxsIik7CiAgICAgICAgaWYgKChm\nbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwICYmIG9pZHMuY29udGFpbnMo\nbnVsbCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJudWxsLW9pZHMiKSk7CgogICAgICAgIC8vIHdlIGhhdmUgdG8g\ndXNlIGEgbWFwIG9mIG9pZC0+c20gcmF0aGVyIHRoYW4gYSBzaW1wbGUKICAg\nICAgICAvLyBhcnJheSwgc28gdGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRvIGNy\nZWF0ZSBtdWx0aXBsZSBzbXMgZm9yIGVxdWl2YWxlbnQKICAgICAgICAvLyBv\naWRzIGlmIHRoZSB1c2VyIGhhcyBkdXBsaWNhdGVzIGluIHRoZSBnaXZlbiBh\ncnJheQogICAgICAgIF9sb2FkaW5nID0gbmV3IEhhc2hNYXAoKGludCkgKG9p\nZHMuc2l6ZSgpICogMS4zMyArIDEpKTsKICAgICAgICBpZiAoY2FsbCA9PSBu\ndWxsKQogICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBpZiAoZmV0\nY2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAg\nICAvLyBjb2xsZWN0aW9uIG9mIHN0YXRlIG1hbmFnZXJzIHRvIHBhc3MgdG8g\nc3RvcmUgbWFuYWdlcgogICAgICAgICAgICBMaXN0IGxvYWQgPSBudWxsOwog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBi\nb29sZWFuIGluaXRpYWxpemVkOwogICAgICAgICAgICBib29sZWFuIHRyYW5z\nU3RhdGUgPSB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpOwogICAgICAg\nICAgICBPYmplY3Qgb2JqLCBvaWQ7CiAgICAgICAgICAgIGludCBpZHggPSAw\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9pZHMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspIHsKICAgICAgICAgICAgICAg\nIC8vIGlmIHdlJ3ZlIGFscmVhZHkgc2VlbiB0aGlzIG9pZCwgc2tpcCByZXBl\nYXRzCiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2JqKTsKICAg\nICAgICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCB8fCBfbG9hZGluZy5jb250\nYWluc0tleShvYmopKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgYSBjYWNoZWQg\naW5zdGFuY2Ugb3IgaXQgaXMgbm90IHRyYW5zYWN0aW9uYWwKICAgICAgICAg\nICAgICAgIC8vIGFuZCBpcyBob2xsb3cgb3Igd2UgbmVlZCB0byB2YWxpZGF0\nZSwgbG9hZCBpdAogICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsQnlJZChvaWQsIChmbGFncyAmIE9JRF9BTExPV19ORVcpICE9IDAK\nICAgICAgICAgICAgICAgICAgICB8fCAoX2ZsYWdzICYgRkxBR19GTFVTSEVE\nKSAhPSAwKTsKICAgICAgICAgICAgICAgIGluaXRpYWxpemVkID0gc20gIT0g\nbnVsbDsKICAgICAgICAgICAgICAgIGlmICghaW5pdGlhbGl6ZWQpCiAgICAg\nICAgICAgICAgICAgICAgc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwg\nKGZsYWdzICYgT0lEX0NPUFkpICE9IDApOwoKICAgICAgICAgICAgICAgIF9s\nb2FkaW5nLnB1dChvYmosIHNtKTsKICAgICAgICAgICAgICAgIGlmIChyZXF1\naXJlc0xvYWQoc20sIGluaXRpYWxpemVkLCBmZXRjaCwgZWRhdGEsIGZsYWdz\nKSkgewogICAgICAgICAgICAgICAgICAgIHRyYW5zU3RhdGUgPSB0cmFuc1N0\nYXRlIHx8IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGluaXRpYWxpemVkICYmICFzbS5pc1RyYW5zYWN0\naW9uYWwoKSAmJiB0cmFuc1N0YXRlKQogICAgICAgICAgICAgICAgICAgICAg\nICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9\nIG5ldyBBcnJheUxpc3Qob2lkcy5zaXplKCkgLSBpZHgpOwogICAgICAgICAg\nICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSBpZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNtLmlu\naXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGFzcyBhbGwgc3RhdGUgbWFu\nYWdlcnMgaW4gbmVlZCBvZiBsb2FkaW5nIG9yIHZhbGlkYXRpb24gdG8gdGhl\nCiAgICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAgaWYg\nKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgUENTdGF0ZSBzdGF0\nZSA9ICh0cmFuc1N0YXRlKSA/IFBDU3RhdGUuUENMRUFOCiAgICAgICAgICAg\nICAgICAgICAgOiBQQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgICAg\nIENvbGxlY3Rpb24gZmFpbGVkID0gX3N0b3JlLmxvYWRBbGwobG9hZCwgc3Rh\ndGUsCiAgICAgICAgICAgICAgICAgICAgU3RvcmVNYW5hZ2VyLkZPUkNFX0xP\nQURfTk9ORSwgZmV0Y2gsIGVkYXRhKTsKCiAgICAgICAgICAgICAgICAvLyBz\nZXQgZmFpbGVkIGluc3RhbmNlcyB0byBudWxsCiAgICAgICAgICAgICAgICBp\nZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUp\nICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld09iamVj\ndE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCk7CiAgICAgICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2FkaW5n\nLnB1dChpdHIubmV4dCgpLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY3JlYXRlIHJlc3VsdHMgYXJy\nYXk7IG1ha2Ugc3VyZSBhbGwgY29uZmlndXJlZCBmaWVsZHMgYXJlCiAgICAg\nICAgICAgIC8vIGxvYWRlZCBpbiBlYWNoIGluc3RhbmNlCiAgICAgICAgICAg\nIE9iamVjdFtdIHJlc3VsdHMgPSBuZXcgT2JqZWN0W29pZHMuc2l6ZSgpXTsK\nICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSAoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDA7CiAgICAgICAgICAgIGludCBsZXZlbCA9IGZldGNoLmdl\ndFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAgaWR4ID0gMDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICBvaWQgPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCAmJiByZXF1aXJlc0xvYWQoc20sIHRydWUsIGZldGNoLCBl\nZGF0YSwgZmxhZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5h\nZ2VySW1wbC5MT0FEX0ZHUywKICAgICAgICAgICAgICAgICAgICAgICAgCWV4\nY2x1ZGUsIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChhY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRh\ndGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20ucmVhZExvY2tl\nZChsZXZlbCwgZmV0Y2guZ2V0V3JpdGVMb2NrTGV2ZWwoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9u\nIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAm\nIE9JRF9OT0RFTEVURUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgc20gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdHNbaWR4\nXSA9IGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9sb2FkaW5nID0gbnVsbDsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIGluc3Rh\nbmNlIG5lZWRzIGxvYWRpbmcgYmVmb3JlIGJlaW5nIHJldHVybmVkCiAgICAg\nKiB0byB0aGUgdXNlci4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHJl\ncXVpcmVzTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29sZWFuIGlu\naXRpYWxpemVkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\nT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICBpZiAoIWZldGNo\nLnJlcXVpcmVzTG9hZCgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAwKQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZWRhdGEgIT0gbnVs\nbCkgLy8gdGFrZSBhZHZhbnRhZ2Ugb2YgZXhpc3RpbmcgcmVzdWx0CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChpbml0aWFsaXplZCAm\nJiBzbS5nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5IT0xMT1cpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIWluaXRpYWxpemVkICYm\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0UENTdWJjbGFzc2VzKCkubGVuZ3RoID4g\nMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuICFf\nY29tcGF0LmdldFZhbGlkYXRlRmFsc2VSZXR1cm5zSG9sbG93KCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0byB1c2UgYSB0cmFu\nc2FjdGlvbmFsIHN0YXRlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\ndXNlVHJhbnNhY3Rpb25hbFN0YXRlKEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9\nIDAgJiYgKCFfb3B0aW1pc3RpYwogICAgICAgICAgICB8fCBfYXV0b0NsZWFy\nID09IENMRUFSX0FMTAogICAgICAgICAgICB8fCBmZXRjaC5nZXRSZWFkTG9j\na0xldmVsKCkgIT0gTE9DS19OT05FKTsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGZpbmRDYWNoZWQoT2JqZWN0IG9pZCwgRmluZENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2Fs\nbCA9IHRoaXM7CiAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQo\nb2lkKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxC\neUlkKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nl\nc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoQ2xhc3MgY2xzKSB7CiAgICAg\nICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBn\nZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIGZhbHNlKTsKICAgICAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbAogICAgICAgICAgICAgICAgfHwgbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKG1l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBM\nSUNBVElPTikKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhLmdldE9iamVj\ndElkVHlwZSgpOwoKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5nZXREYXRh\nU3RvcmVJZFR5cGUobWV0YSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBuZXdPYmplY3RJZChDbGFzcyBjbHMs\nIE9iamVjdCB2YWwpIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgX2xvYWRlciwg\ndHJ1ZSk7CiAgICAgICAgICAgIHN3aXRjaCAobWV0YS5nZXRJZGVudGl0eVR5\ncGUoKSkgewogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfREFU\nQVNUT1JFOgogICAgICAgICAgICAgICAgLy8gZGVsZWdhdGUgdG8gc3RvcmUg\nbWFuYWdlciBmb3IgZGF0YXN0b3JlIGlkcwogICAgICAgICAgICAgICAgaWYg\nKHZhbCBpbnN0YW5jZW9mIFN0cmluZwogICAgICAgICAgICAgICAgICAgICYm\nICgoU3RyaW5nKSB2YWwpLnN0YXJ0c1dpdGgoU3RhdGVNYW5hZ2VySWQuU1RS\nSU5HX1BSRUZJWCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBT\ndGF0ZU1hbmFnZXJJZCgoU3RyaW5nKSB2YWwpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIF9zdG9yZS5uZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEpOwogICAg\nICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT046CiAg\nICAgICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc0Fzc2lnbmFibGUobWV0\nYS5nZXRPYmplY3RJZFR5cGUoKSwgCiAgICAgICAgICAgICAgICAgICAgdmFs\nLmdldENsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkgCiAgICAgICAgICAgICAgICAgICAgICAg\nICYmIG1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIHZhbCk7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIE9iamVjdFtdIGFyciA9ICh2YWwgaW5zdGFu\nY2VvZiBPYmplY3RbXSkgPyAoT2JqZWN0W10pIHZhbAogICAgICAgICAgICAg\nICAgICAgIDogbmV3IE9iamVjdFtdeyB2YWwgfTsKICAgICAgICAgICAgICAg\nIHJldHVybiBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMoYXJyLCBtZXRh\nKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIs\nIGNscykpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChDbGFzc0Nhc3RFeGNlcHRpb24gY2NlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtaWQt\ndmFsdWUiLCB2YWwsCiAgICAgICAgICAgICAgICB2YWwuZ2V0Q2xhc3MoKS5n\nZXROYW1lKCksIGNscykpLnNldENhdXNlKGNjZSk7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHN0YXRlIG1hbmFnZXIgZm9y\nIHRoZSBnaXZlbiBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgU3RhdGVNYW5h\nZ2VySW1wbCBuZXdTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvaWQsIGJvb2xl\nYW4gY29weSkgewogICAgICAgIC8vIHNlZSBpZiB3ZSdyZSBpbiB0aGUgcHJv\nY2VzcyBvZiBsb2FkaW5nIHRoaXMgb2lkIGluIGEgbG9hZEFsbCBjYWxsCiAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBpZiAoX2xvYWRp\nbmcgIT0gbnVsbCkgewogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBfbG9hZGluZy5nZXQob2lkKTsKICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwgJiYgc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICB9CgogICAgICAg\nIC8vIGZpbmQgbWV0YWRhdGEgZm9yIHRoZSBvaWQKICAgICAgICBDbGFzcyBw\nY1R5cGUgPSBfc3RvcmUuZ2V0TWFuYWdlZFR5cGUob2lkKTsKICAgICAgICBN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi5nZXRNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYTsKICAgICAgICBpZiAocGNUeXBlICE9IG51bGwpCiAgICAgICAgICAgIG1l\ndGEgPSByZXBvcy5nZXRNZXRhRGF0YShwY1R5cGUsIF9sb2FkZXIsIHRydWUp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0YSA9IHJlcG9zLmdldE1l\ndGFEYXRhKG9pZCwgX2xvYWRlciwgdHJ1ZSk7CgogICAgICAgIC8vIGNvcHkg\ndGhlIG9pZCBpZiBuZWVkZWQKICAgICAgICBpZiAoY29weSAmJiBfY29tcGF0\nLmdldENvcHlPYmplY3RJZHMoKSkgewogICAgICAgICAgICBpZiAobWV0YS5n\nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FU\nSU9OKQogICAgICAgICAgICAgICAgb2lkID0gQXBwbGljYXRpb25JZHMuY29w\neShvaWQsIG1ldGEpOwogICAgICAgICAgICBlbHNlIGlmIChtZXRhLmdldElk\nZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJtZXRhLXVua25vd25pZCIsIG1ldGEpKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgb2lkID0gX3N0b3JlLmNvcHlEYXRhU3RvcmVJZChv\naWQsIG1ldGEpOwogICAgICAgIH0KCiAgICAgICAgc20gPSBuZXdTdGF0ZU1h\nbmFnZXJJbXBsKG9pZCwgbWV0YSk7CiAgICAgICAgc20uc2V0T2JqZWN0SWQo\nb2lkKTsKICAgICAgICByZXR1cm4gc207CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gb2lkIGFu\nZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdl\nckltcGwgbmV3U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2lkLAogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBuZXcgU3Rh\ndGVNYW5hZ2VySW1wbChvaWQsIG1ldGEsIHRoaXMpOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gVHJhbnNhY3Rpb24KICAgIC8vLy8vLy8v\nLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGJlZ2luKCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJhY3RpdmUiKSk7CiAgICAgICAgICAgIF9mYWN0b3J5LnN5bmNXaXRoTWFu\nYWdlZFRyYW5zYWN0aW9uKHRoaXMsIHRydWUpOwogICAgICAgICAgICBiZWdp\nbkludGVybmFsKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogTm90aWZ5IHRoZSBzdG9yZSBtYW5hZ2VyIG9mIGEgdHJhbnNhY3Rpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWdpbkludGVybmFsKCkgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5hZ2VyVHJh\nbnNhY3Rpb24oX29wdGltaXN0aWMpOwogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19BQ1RJVkU7CgogICAgICAgICAgICAvLyBzdGFydCBsb2NraW5nCiAg\nICAgICAgICAgIGlmICghX29wdGltaXN0aWMpIHsKICAgICAgICAgICAgICAg\nIF9mYy5zZXRSZWFkTG9ja0xldmVsKF9jb25mLmdldFJlYWRMb2NrTGV2ZWxD\nb25zdGFudCgpKTsKICAgICAgICAgICAgICAgIF9mYy5zZXRXcml0ZUxvY2tM\nZXZlbChfY29uZi5nZXRXcml0ZUxvY2tMZXZlbENvbnN0YW50KCkpOwogICAg\nICAgICAgICAgICAgX2ZjLnNldExvY2tUaW1lb3V0KF9jb25mLmdldExvY2tU\naW1lb3V0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9sbS5iZWdp\nblRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRN\nYW5hZ2VyLmhhc0JlZ2luTGlzdGVuZXJzKCkpCiAgICAgICAgICAgICAgICBm\naXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlz\nLAogICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQuQUZURVJf\nQkVHSU4sIG51bGwsIG51bGwsIG51bGwsIG51bGwpKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIC8vIGlm\nIHdlIGFscmVhZHkgc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24sIGRvbid0IGxl\ndCBpdCBjb21taXQKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUlu\ndGVybmFsKGtlKTsKICAgICAgICAgICAgdGhyb3cga2Uuc2V0RmF0YWwodHJ1\nZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5IHN0YXJ0ZWQgdGhlIHRyYW5z\nYWN0aW9uLCBkb24ndCBsZXQgaXQgY29tbWl0CiAgICAgICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBz\nZXRSb2xsYmFja09ubHlJbnRlcm5hbChyZSk7CiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoX3BlbmRpbmcgIT0gbnVsbCkgewogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ID0gX3BlbmRpbmcuaXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkg\naXQubmV4dCgpOwogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgp\nOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAg\nICAgICAgICAgICBzZXREaXJ0eShzbSwgdHJ1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgX3BlbmRpbmcgPSBudWxsOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBiZWdpblN0b3JlKCkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09IDApCiAgICAgICAgICAg\nICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGZhbHNlKTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBCZWdp\nbiBhIHN0b3JlIG1hbmFnZXIgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGJvb2xl\nYW4gb3B0aW1pc3RpYykgewogICAgICAgIGlmICghb3B0aW1pc3RpYykgewog\nICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9z\ndG9yZS5iZWdpbigpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19TVE9S\nRV9BQ1RJVkU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKF9j\nb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9UUkFOUykKICAgICAgICAg\nICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgX3N0b3Jl\nLmJlZ2luT3B0aW1pc3RpYygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEVuZCB0aGUgY3VycmVudCBzdG9yZSBtYW5hZ2VyIHRyYW5zYWN0\naW9uLiBUaHJvd3MgYW4KICAgICAqIGV4Y2VwdGlvbiB0byBzaWduYWwgYSBm\nb3JjZWQgcm9sbGJhY2sgYWZ0ZXIgZmFpbGVkIGNvbW1pdCwgb3RoZXJ3aXNl\nCiAgICAgKiByZXR1cm5zIGFueSBleGNlcHRpb24gZW5jb3VudGVyZWQgZHVy\naW5nIHRoZSBlbmQgcHJvY2Vzcy4KICAgICAqLwogICAgcHJpdmF0ZSBSdW50\naW1lRXhjZXB0aW9uIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKGJvb2xl\nYW4gcm9sbGJhY2spIHsKICAgICAgICBib29sZWFuIGZvcmNlZFJvbGxiYWNr\nID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiByZWxlYXNlQ29ubiA9IGZhbHNl\nOwogICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVf\nQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZWxlYXNlQ29ubiA9\nIF9jb25uUmV0YWluTW9kZSAhPSBDT05OX1JFVEFJTl9BTFdBWVM7CiAgICAg\nICAgICAgICAgICBpZiAocm9sbGJhY2spCiAgICAgICAgICAgICAgICAgICAg\nX3N0b3JlLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgX3N0b3JlLmNvbW1pdCgpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm4gPSBfY29ublJl\ndGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5fVFJBTlM7CiAgICAgICAgICAgICAg\nICBfc3RvcmUucm9sbGJhY2tPcHRpbWlzdGljKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgaWYgKCFyb2xsYmFjaykgewogICAgICAgICAgICAg\nICAgZm9yY2VkUm9sbGJhY2sgPSB0cnVlOwogICAgICAgICAgICAgICAgdHJ5\nIHsgX3N0b3JlLnJvbGxiYWNrKCk7IH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUyKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVyciA9IHJl\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19TVE9SRV9BQ1RJVkU7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVs\nZWFzZUNvbm4pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHJlbGVhc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIGlmIChlcnIg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBlcnIgPSByZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZvcmNlZFJvbGxiYWNr\nKQogICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgcmV0dXJuIGVycjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBq\nYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAg\nICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRU\ncmFuc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoIm51bGwtdHJhbnMiKSk7CgogICAgICAgICAgICAvLyB0\naGlzIGNvbW1pdCBvbiB0aGUgdHJhbnNhY3Rpb24gd2lsbCBjYXVzZSBvdXIK\nICAgICAgICAgICAgLy8gYmVmb3JlQ29tcGxldGlvbiBtZXRob2QgdG8gYmUg\naW52b2tlZAogICAgICAgICAgICB0cmFucy5jb21taXQoKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5z\nLWVycm9yIiksIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJvbGxiYWNrKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9w\nZXJhdGlvbigpOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJh\nbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0\nVHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAg\nICAgICAgaWYgKHRyYW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cmFu\ncy5yb2xsYmFjaygpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10\ncmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgZSk7CiAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3luY1dpdGhNYW5hZ2VkVHJh\nbnNhY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIGlmICghX21hbmFnZWQpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJ0\ncmFucy1ub3QtbWFuYWdlZCIpKTsKICAgICAgICAgICAgaWYgKF9mYWN0b3J5\nLnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIGZhbHNlKSkgewog\nICAgICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21t\naXRBbmRSZXN1bWUoKSB7CiAgICAgICAgZW5kQW5kUmVzdW1lKHRydWUpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrQW5kUmVzdW1lKCkgewog\nICAgICAgIGVuZEFuZFJlc3VtZShmYWxzZSk7CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIGVuZEFuZFJlc3VtZShib29sZWFuIGNvbW1pdCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoY29tbWl0KQogICAgICAgICAgICAgICAgY29tbWl0KCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJvbGxiYWNrKCk7CiAg\nICAgICAgICAgIGJlZ2luKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldFJvbGxiYWNrT25seSgpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rp\nb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRp\nbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsK\nICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cmFucy5nZXRT\ndGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xMQkFDSzsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgVGhyb3dhYmxlIGdldFJv\nbGxiYWNrQ2F1c2UoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJh\nbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25N\nYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRy\nYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICAgICAgaWYgKHRyYW5zLmdldFN0YXR1cygpID09IFN0YXR1cy5TVEFU\nVVNfTUFSS0VEX1JPTExCQUNLKQogICAgICAgICAgICAgICAgcmV0dXJuIF9y\ndW50aW1lLmdldFJvbGxiYWNrQ2F1c2UoKTsKCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFJvbGxiYWNrT25seSgpIHsKICAgICAgICBzZXRSb2xsYmFja09ubHko\nbmV3IFVzZXJFeGNlcHRpb24oKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0Um9sbGJhY2tPbmx5KFRocm93YWJsZSBjYXVzZSkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIHNl\ndFJvbGxiYWNrT25seUludGVybmFsKGNhdXNlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoZSBjdXJyZW50IHRyYW5zYWN0\naW9uIGFzIHJvbGxiYWNrLW9ubHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChUaHJvd2FibGUgY2F1c2UpIHsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlvbi5U\ncmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGltZS5n\nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwogICAg\nICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwt\ndHJhbnMiKSk7CiAgICAgICAgICAgIF9ydW50aW1lLnNldFJvbGxiYWNrT25s\neShjYXVzZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0U2F2ZXBvaW50KFN0cmluZyBuYW1lKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9p\nbnRzICE9IG51bGwgJiYgX3NhdmVwb2ludHMuY29udGFpbnNLZXkobmFtZSkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgic2F2ZXBvaW50LWV4aXN0cyIsIG5hbWUpKTsKCiAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAhPSAwCiAgICAgICAgICAg\nICAgICAmJiAhX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1c2goKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgic2F2ZXBvaW50LWZsdXNo\nLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgICAgICBPcGVuSlBBU2F2ZXBv\naW50IHNhdmUgPSBfc3BtLm5ld1NhdmVwb2ludChuYW1lLCB0aGlzKTsKICAg\nICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51bGwgfHwgX3NhdmVwb2lu\ndHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzYXZlLnNhdmUoZ2V0\nVHJhbnNhY3Rpb25hbFN0YXRlcygpKTsKICAgICAgICAgICAgICAgIF9zYXZl\ncG9pbnRzID0gbmV3IExpbmtlZE1hcCgpOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShDb2xsZWN0aW9ucy5F\nTVBUWV9MSVNUKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHNhdmUuc2F2ZShfc2F2ZXBvaW50Q2FjaGUpOwogICAgICAg\nICAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZS5jbGVhcigpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9zYXZlcG9p\nbnRzLnB1dChuYW1lLCBzYXZlKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoX3NhdmVwb2ludHMgPT0gbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tbGFzdHNhdmVwb2ludCIpKTsKICAgICAgICAgICAg\ncmVsZWFzZVNhdmVwb2ludCgoU3RyaW5nKSBfc2F2ZXBvaW50cy5nZXQKICAg\nICAgICAgICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkgLSAxKSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9p\nbnQoU3RyaW5nIHNhdmVwb2ludCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3Rp\ndmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgaW50IGluZGV4ID0gKF9z\nYXZlcG9pbnRzID09IG51bGwpID8gLTEKICAgICAgICAgICAgICAgIDogX3Nh\ndmVwb2ludHMuaW5kZXhPZihzYXZlcG9pbnQpOwogICAgICAgICAgICBpZiAo\naW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLXNhdmVwb2ludCIsIHNhdmVwb2ludCkpOwoK\nICAgICAgICAgICAgLy8gY2xlYXIgb2xkIGluIHJldmVyc2UKICAgICAgICAg\nICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAgICAgICAgICB3aGlsZSAo\nX3NhdmVwb2ludHMuc2l6ZSgpID4gaW5kZXggKyAxKSB7CiAgICAgICAgICAg\nICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJl\nbW92ZQogICAgICAgICAgICAgICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkg\nLSAxKTsKICAgICAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVw\nb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKGluZGV4KTsKICAgICAgICAgICAg\nc2F2ZS5yZWxlYXNlKHRydWUpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2lu\ndENhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2ZXBvaW50Q2Fj\naGUuY2xlYXIoKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByb2xsYmFja1RvU2F2ZXBvaW50KCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nX3NhdmVwb2ludHMgPT0gbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgibm8tbGFzdHNhdmVwb2ludCIpKTsKICAgICAgICAgICAgcm9sbGJh\nY2tUb1NhdmVwb2ludCgoU3RyaW5nKSBfc2F2ZXBvaW50cy5nZXQKICAgICAg\nICAgICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkgLSAxKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9p\nbnQoU3RyaW5nIHNhdmVwb2ludCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3Rp\ndmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgaW50IGluZGV4ID0gKF9z\nYXZlcG9pbnRzID09IG51bGwpID8gLTEKICAgICAgICAgICAgICAgIDogX3Nh\ndmVwb2ludHMuaW5kZXhPZihzYXZlcG9pbnQpOwogICAgICAgICAgICBpZiAo\naW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLXNhdmVwb2ludCIsIHNhdmVwb2ludCkpOwoK\nICAgICAgICAgICAgLy8gY2xlYXIgb2xkIGluIHJldmVyc2UKICAgICAgICAg\nICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAgICAgICAgICB3aGlsZSAo\nX3NhdmVwb2ludHMuc2l6ZSgpID4gaW5kZXggKyAxKSB7CiAgICAgICAgICAg\nICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJl\nbW92ZQogICAgICAgICAgICAgICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkg\nLSAxKTsKICAgICAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVw\nb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKGluZGV4KTsKICAgICAgICAgICAg\nQ29sbGVjdGlvbiBzYXZlZCA9IHNhdmUucm9sbGJhY2soX3NhdmVwb2ludHMu\ndmFsdWVzKCkpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludENhY2hlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuY2xlYXIo\nKTsKICAgICAgICAgICAgaWYgKF90cmFuc0NhY2hlICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIC8vIGJ1aWxkIHVwIGEgbmV3IGNvbGxlY3Rpb24gb2Yg\nc3RhdGVzCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbmFsQ2FjaGUgb2xk\nVHJhbnNDYWNoZSA9IF90cmFuc0NhY2hlOwogICAgICAgICAgICAgICAgVHJh\nbnNhY3Rpb25hbENhY2hlIG5ld1RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rp\nb25hbENhY2hlCiAgICAgICAgICAgICAgICAgICAgKF9vcmRlckRpcnR5KTsK\nICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlID0gbnVsbDsKCiAgICAgICAg\nICAgICAgICAvLyBjdXJyZW50bHkgdGhlcmUgaXMgdGhlIGFzc3VtcHRpb24g\ndGhhdCBpbmNyZW1lbnRhbAogICAgICAgICAgICAgICAgLy8gZmx1c2ggaXMg\nZWl0aGVyIGEpIG5vdCBhbGxvd2VkLCBvciBiKSByZXF1aXJlZAogICAgICAg\nICAgICAgICAgLy8gcHJlLXNhdmVwb2ludC4gIHRoaXMgc29sdmVzIGEgbnVt\nYmVyIG9mIGlzc3VlcyBpbmNsdWRpbmcKICAgICAgICAgICAgICAgIC8vIHN0\nb3JpbmcgZmx1c2hlZCBzdGF0ZXMgYXMgd2VsbCBhcyBPSUQgaGFuZGxpbmcu\nCiAgICAgICAgICAgICAgICAvLyBpZiBmdXR1cmUgcGx1Z2lucyBkbyBub3Qg\nZm9sbG93IHRoaXMsIHdlIG5lZWQgdG8gY2FjaGUKICAgICAgICAgICAgICAg\nIC8vIG1vcmUgaW5mbyBwZXIgc3RhdGUKICAgICAgICAgICAgICAgIFNhdmVw\nb2ludEZpZWxkTWFuYWdlciBmbTsKICAgICAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHNhdmVkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICAgICAgZm0gPSAoU2F2ZXBvaW50RmllbGRNYW5hZ2VyKSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHNtID0gZm0uZ2V0U3Rh\ndGVNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2tU\nb1NhdmVwb2ludChmbSk7CiAgICAgICAgICAgICAgICAgICAgb2xkVHJhbnND\nYWNoZS5yZW1vdmUoc20pOwogICAgICAgICAgICAgICAgICAgIGlmIChzbS5p\nc0RpcnR5KCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RyYW5zQ2Fj\naGUuYWRkRGlydHkoc20pOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgbmV3VHJhbnNDYWNoZS5hZGRDbGVhbihz\nbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG9sZFRyYW5zQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHNt\nLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRnJvbVRy\nYW5zYWN0aW9uKHNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIG9sZFRyYW5zQ2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIF90\ncmFuc0NhY2hlID0gbmV3VHJhbnNDYWNoZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZmx1\nc2goKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gcmV0dXJuIHNpbGVudGx5IGlmIG5vIHRy\nYW5zIGlzIGFjdGl2ZSwgb3IgaWYgdGhpcyBpcyBhIHJlZW50cmFudAogICAg\nICAgICAgICAvLyBjYWxsLCB3aGljaCBjYW4gaGFwcGVuIGlmIHRoZSBzdG9y\nZSBtYW5hZ2VyIHRyaWVzIHRvIGdldCBhbgogICAgICAgICAgICAvLyBhdXRv\nLWluYyBvaWQgZHVyaW5nIGZsdXNoCiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpID09IDAKICAgICAgICAgICAgICAgIHx8IChfZmxh\nZ3MgJiBGTEFHX1NUT1JFX0ZMVVNISU5HKSAhPSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBydW50\naW1lIHN1cHBvcnRzIGl0CiAgICAgICAgICAgIGlmICghX2NvbmYuc3VwcG9y\ndGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNfRkxVU0gp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbmNyZW1lbnRh\nbC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwogICAgICAgICAgICBpZiAoX3Nh\ndmVwb2ludHMgIT0gbnVsbCAmJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpCiAg\nICAgICAgICAgICAgICAmJiAhX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1\nc2goKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgic2F2ZXBv\naW50LWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0lOQyk7CiAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nICAgICAvLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkg\nYmUgaW4gaW5jb25zaXN0ZW50IHN0YXRlCiAgICAgICAgICAgICAgICBzZXRS\nb2xsYmFja09ubHkoa2UpOwogICAgICAgICAgICAgICAgdGhyb3cga2Uuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIG9uIGZs\ndXNoIGVycm9yOyBvYmplY3RzIG1heSBiZSBpbiBpbmNvbnNpc3RlbnQgc3Rh\ndGUKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seShyZSk7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpLnNldEZh\ndGFsKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcHJlRmx1c2goKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAg\nICAgICAgIGZsdXNoU2FmZShGTFVTSF9MT0dJQ0FMKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdmFsaWRhdGVDaGFuZ2VzKCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIGlmIG5vIHRyYW5zLCBqdXN0IHJldHVybjsgaWYgYWN0\naXZlIGRhdGFzdG9yZSB0cmFucywgZmx1c2gKICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FD\nVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgZmx1c2goKTsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGluYyBmbHVzaAog\nICAgICAgICAgICBpZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250\nYWlucyhfY29uZi5PUFRJT05fSU5DX0ZMVVNIKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAg\nICAgICAgICAgICAgICAgICgiaW5jcmVtZW50YWwtZmx1c2gtbm90LXN1cHBv\ncnRlZCIpKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBm\nbHVzaFNhZmUoRkxVU0hfUk9MTEJBQ0spOwogICAgICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKHJlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzQWN0aXZlKCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDA7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU3RvcmVBY3RpdmUo\nKSB7CiAgICAgICAgLy8gd2UgbmVlZCB0byBsb2NrIGhlcmUsIGJlY2F1c2Ug\nd2UgbWlnaHQgYmUgaW4gdGhlIG1pZGRsZSBvZiBhbgogICAgICAgIC8vIGF0\nb21pYyB0cmFuc2FjdGlvbiBwcm9jZXNzIChlLmcuLCBjb21taXRBbmRSZXN1\nbWUpCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FD\nVElWRSkgIT0gMDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gd2hldGhlciB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBpcyBl\nbmRpbmcsIGkuZS4gaW4gdGhlIDJuZCBwaGFzZQogICAgICogb2YgYSBjb21t\naXQgb3Igcm9sbGJhY2sKICAgICAqLwogICAgYm9vbGVhbiBpc1RyYW5zYWN0\naW9uRW5kaW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19U\nUkFOU19FTkRJTkcpICE9IDA7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nYmVnaW5PcGVyYXRpb24oYm9vbGVhbiBzeW5jVHJhbnMpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Blbigp\nOwoKICAgICAgICAgICAgaWYgKHN5bmNUcmFucyAmJiBfb3BlcmF0aW9uQ291\nbnQgPT0gMCAmJiBfc3luY01hbmFnZWQKICAgICAgICAgICAgICAgICYmIChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIHN5\nbmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIHJldHVy\nbiBfb3BlcmF0aW9uQ291bnQrKyA9PSAxOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoZSBvcGVyYXRpb24gb3Zl\nci4gSWYgb3V0ZXJtb3N0IGNhbGxlciBvZiBzdGFjaywgcmV0dXJucyB0cnVl\nCiAgICAgKiBhbmQgd2lsbCBkZXRhY2ggbWFuYWdlZCBpbnN0YW5jZXMgaWYg\nbmVjZXNzYXJ5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBlbmRPcGVy\nYXRpb24oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9vcGVy\nYXRpb25Db3VudCA9PSAxICYmIChfYXV0b0RldGFjaCAmIERFVEFDSF9OT05U\nWFJFQUQpICE9IDAKICAgICAgICAgICAgICAgICYmIChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgPT0gMCkgewogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50\nZXJuYWwobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9v\ncGVyYXRpb25Db3VudCA8IDEpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9vcGVy\nYXRpb25Db3VudCA9PSAxOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgX29wZXJhdGlvbkNvdW50LS07CiAgICAgICAgICAg\nIGlmIChfb3BlcmF0aW9uQ291bnQgPT0gMCkKICAgICAgICAgICAgICAgIF9v\ncGVyYXRpbmcuY2xlYXIoKTsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBTeW5jaHJvbml6YXRpb24gZ2V0U3lu\nY2hyb25pemF0aW9uKCkgewogICAgICAgIHJldHVybiBfc3luYzsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRTeW5jaHJvbml6YXRpb24oU3luY2hyb25p\nemF0aW9uIHN5bmMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nX3N5bmMgPSBzeW5jOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRh\ndGlvbiBvZiBTeW5jaHJvbml6YXRpb24gaW50ZXJmYWNlCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAg\nIHB1YmxpYyB2b2lkIGJlZm9yZUNvbXBsZXRpb24oKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIHVzZXItc3VwcGxpZWQgc3luY2hyb25pemF0aW9uCiAgICAgICAgICAg\nIGlmIChfc3luYyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N5bmMuYmVm\nb3JlQ29tcGxldGlvbigpOwoKICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNI\nX0NPTU1JVCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5z\nLWVycm9yIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFu\nYWdlZENvbXBsZXRpb25FeGNlcHRpb24oa2UpOwogICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2Uo\nX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCByZSk7CiAgICAgICAgICAg\nIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKG5l\ndyBTdG9yZUV4Y2VwdGlvbihyZSkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBhZnRlckNvbXBsZXRpb24oaW50IHN0YXR1cykgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfVFJBTlNfRU5ESU5HOwogICAgICAgICAg\nICBlbmRUcmFuc2FjdGlvbihzdGF0dXMpOwogICAgICAgICAgICBpZiAoX3N5\nbmMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zeW5jLmFmdGVyQ29tcGxl\ndGlvbihzdGF0dXMpOwoKICAgICAgICAgICAgaWYgKChfYXV0b0RldGFjaCAm\nIERFVEFDSF9DT01NSVQpICE9IDApCiAgICAgICAgICAgICAgICBkZXRhY2hB\nbGxJbnRlcm5hbChudWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAoc3RhdHVz\nID09IFN0YXR1cy5TVEFUVVNfUk9MTEVEQkFDSyAKICAgICAgICAgICAgICAg\nICYmIChfYXV0b0RldGFjaCAmIERFVEFDSF9ST0xMQkFDSykgIT0gMCkgewog\nICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIGluIGFuIGVlIGNvbnRleHQsIGl0\nJ3MgcG9zc2libGUgdGhhdCB0aGUgdXNlciB0cmllZCB0byBjbG9zZQogICAg\nICAgICAgICAvLyB1cyBidXQgd2UgZGlkbid0IGFjdHVhbGx5IGNsb3NlIGJl\nY2F1c2Ugd2Ugd2VyZSB3YWl0aW5nIG9uIHRoaXMKICAgICAgICAgICAgLy8g\ndHJhbnNhY3Rpb247IGlmIHRoYXQncyB0cnVlLCB0aGVuIGNsb3NlIG5vdwog\nICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkg\nIT0gMAogICAgICAgICAgICAgICAgJiYgX2NvbXBhdC5nZXRDbG9zZU9uTWFu\nYWdlZENvbW1pdCgpKQogICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAg\nICAgICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhj\nZXB0aW9uKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJh\nbnMtZXJyb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVN\nYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24o\ncmUpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfQUNUSVZFOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nRkxVU0hFRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1RSQU5TX0VO\nRElORzsKCiAgICAgICAgICAgIC8vIGV2ZW50IG1hbmFnZXIgbnVsbGVkIGlm\nIGZyZWVkIGJyb2tlcgogICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5h\nZ2VyICE9IG51bGwgCiAgICAgICAgICAgICAgICAmJiBfdHJhbnNFdmVudE1h\nbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsKICAgICAgICAgICAgICAgIGZp\ncmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMs\nCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID09IFN0YXR1cy5TVEFUVVNf\nQ09NTUlUVEVECiAgICAgICAgICAgICAgICAgICAgICAgID8gVHJhbnNhY3Rp\nb25FdmVudC5BRlRFUl9DT01NSVRfQ09NUExFVEUKICAgICAgICAgICAgICAg\nICAgICAgICAgOiBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX1JPTExCQUNLX0NP\nTVBMRVRFLAogICAgICAgICAgICAgICAgICAgIG51bGwsIG51bGwsIG51bGws\nIG51bGwpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgd2Un\ncmUgaW4gYSBtYW5hZ2VkIHRyYW5zYWN0aW9uLCB1c2Ugb3VyIGltcGxpY2l0\nIGJlaGF2aW9yIGV4Y2VwdGlvbgogICAgICogdHJhbnNsYXRvciB0byB0cmFu\nc2xhdGUgYmVmb3JlL2FmdGVyQ29tcGxldGlvbiBjYWxsYmFjayBlcnJvcnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiB0cmFuc2xh\ndGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbgogICAgICAgIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgcmV0dXJuICghX21hbmFnZWQgfHwg\nX2V4dHJhbnMgPT0gbnVsbCkgPyByZSA6IF9leHRyYW5zLnRyYW5zbGF0ZShy\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBzYWZlbHksIGNhdGNo\naW5nIHJlZW50cmFudCBjYWxscy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGZsdXNoU2FmZShpbnQgcmVhc29uKSB7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0ZMVVNISU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWVudHJhbnQtZmx1\nc2giKSk7CgogICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNISU5HOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGZsdXNoKHJlYXNvbik7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNI\nSU5HOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRo\nZSB0cmFuc2FjdGlvbmFsIHN0YXRlIHRvIHRoZSBkYXRhIHN0b3JlLiBTdWJj\nbGFzc2VzIHRoYXQKICAgICAqIGN1c3RvbWl6ZSBjb21taXQgYmVoYXZpb3Ig\nc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kLiBUaGUgbWV0aG9kCiAgICAg\nKiBhc3N1bWVzIHRoYXQgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgaXMgbG9j\na2VkLCBpcyBub3QgY2xvc2VkLAogICAgICogYW5kIGhhcyBhbiBhY3RpdmUg\ndHJhbnNhY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHJlYXNvbiBvbmUg\nb2Yge0BsaW5rICNGTFVTSF9JTkN9LCB7QGxpbmsgI0ZMVVNIX0NPTU1JVH0s\nCiAgICAgKiB7QGxpbmsgI0ZMVVNIX1JPTExCQUNLfSwgb3Ige0BsaW5rICNG\nTFVTSF9MT0dJQ0FMfQogICAgICogQHNpbmNlIDAuMi41CiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIGZsdXNoKGludCByZWFzb24pIHsKICAgICAgICAv\nLyB0aGlzIHdpbGwgZW5saXN0IHByb3hpZWQgc3RhdGVzIGFzIG5lY2Vzc2Fy\neSBzbyB3ZSBrbm93IHdoZXRoZXIgd2UKICAgICAgICAvLyBoYXZlIGFueXRo\naW5nIHRvIGZsdXNoCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFs\nID0gZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpOwoKICAgICAgICAvLyBkbyB3\nZSBhY3R1YWxseSBoYXZlIHRvIGZsdXNoPyAgb25seSBpZiBvdXIgZmxhZ3Mg\nc2F5IHNvLCBvciBpZgogICAgICAgIC8vIHdlIGhhdmUgdHJhbnNhY3Rpb24g\nbGlzdGVuZXJzIHRoYXQgbmVlZCB0byBiZSBpbnZva2VkIGZvciBjb21taXQK\nICAgICAgICAvLyAobm8gbmVlZCB0byBpbnZva2UgdGhlbSBvbiBpbmMgZmx1\nc2ggaWYgbm90aGluZyBpcyBkaXJ0eSkuICB3ZQogICAgICAgIC8vIHNwZWNp\nYWwgY2FzZSB0aGUgcmVtb3RlIGNvbW1pdCBsaXN0ZW5lciB1c2VkIGJ5IHRo\nZSBkYXRhY2FjaGUgY2F1c2UKICAgICAgICAvLyB3ZSBrbm93IGl0IGRvZXNu\nJ3QgcmVxdWlyZSB0aGUgY29tbWl0IGV2ZW50IHdoZW4gbm90aGluZyBjaGFu\nZ2VzCiAgICAgICAgYm9vbGVhbiBmbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIX1JFUVVJUkVEKSAhPSAwOwogICAgICAgIGJvb2xlYW4gbGlzdGVuZXJz\nID0gKF90cmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpCiAg\nICAgICAgICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5l\ncnMoKSkKICAgICAgICAgICAgJiYgKChfZmxhZ3MgJiBGTEFHX1JFTU9URV9M\nSVNURU5FUikgPT0gMAogICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFn\nZXIuZ2V0TGlzdGVuZXJzKCkuc2l6ZSgpID4gMSk7CiAgICAgICAgaWYgKCFm\nbHVzaCAmJiAocmVhc29uICE9IEZMVVNIX0NPTU1JVCB8fCAhbGlzdGVuZXJz\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDb2xsZWN0aW9uIG1v\nYmpzID0gbnVsbDsKICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVTVE9SSU5H\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChmbHVzaCkgewogICAg\nICAgICAgICAgICAgLy8gY2FsbCBwcmUgc3RvcmUgb24gYWxsIGN1cnJlbnRs\neSB0cmFuc2FjdGlvbmFsIG9ianMKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gdHJhbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdlcklt\ncGwpIGl0ci5uZXh0KCkpLmJlZm9yZUZsdXNoKHJlYXNvbiwgX2NhbGwpOwog\nICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwg\ncmVhc29uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaG9wZWZ1\nbGx5IG5vdyBhbGwgZGVwZW5kZW50IGluc3RhbmNlcyB0aGF0IGFyZSBnb2lu\nZyB0byBlbmQKICAgICAgICAgICAgLy8gdXAgcmVmZXJlbmNlZCBoYXZlIGJl\nZW4gbWFya2VkIGFzIHN1Y2g7IGRlbGV0ZSB1bnJlZmVkCiAgICAgICAgICAg\nIC8vIGRlcGVuZGVudHMKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVS\nRUZERUxFVElORzsKICAgICAgICAgICAgaWYgKGZsdXNoICYmIF9kZXJlZkNh\nY2hlICE9IG51bGwgJiYgIV9kZXJlZkNhY2hlLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAg\nICBkZWxldGVEZXJlZigoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSk7\nCiAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFs\nLCByZWFzb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVh\nc29uICE9IEZMVVNIX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAgIC8vIGlm\nIG5vIGRhdGFzdG9yZSB0cmFuc2FjdGlvbiwgc3RhcnQgb25lOyBldmVuIGlm\nIHdlIGRvbid0CiAgICAgICAgICAgICAgICAvLyB0aGluayB3ZSdsbCBuZWVk\nIHRvIGZsdXNoIGF0IHRoaXMgcG9pbnQsIG91ciB0cmFuc2FjdGlvbgogICAg\nICAgICAgICAgICAgLy8gbGlzdGVuZXJzIG1pZ2h0IGludHJvZHVjZSBzb21l\nIGRpcnR5IG9iamVjdHMgb3IgaW50ZXJhY3QKICAgICAgICAgICAgICAgIC8v\nIGRpcmVjdGx5IHdpdGggdGhlIGRhdGFiYXNlCiAgICAgICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSA9PSAwKQogICAgICAg\nICAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oZmFs\nc2UpOwoKICAgICAgICAgICAgICAgIGlmICgoX3RyYW5zRXZlbnRNYW5hZ2Vy\nLmhhc0ZsdXNoTGlzdGVuZXJzKCkKICAgICAgICAgICAgICAgICAgICB8fCBf\ndHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAg\nICAgICAgICAgICAgJiYgKGZsdXNoIHx8IHJlYXNvbiA9PSBGTFVTSF9DT01N\nSVQpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZmlyZSBldmVudHMKICAg\nICAgICAgICAgICAgICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0Q29s\nbGVjdGlvbih0cmFuc2FjdGlvbmFsKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAocmVhc29uID09IEZMVVNIX0NPTU1JVAogICAgICAgICAgICAgICAgICAg\nICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZl\nbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkJFRk9SRV9DT01NSVQs\nIG1vYmpzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3Rl\nZENsc3MsIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRDbHNzKSk7CgogICAgICAg\nICAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFs\nLCByZWFzb24pOwogICAgICAgICAgICAgICAgICAgICAgICBmbHVzaCA9IChf\nZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwOwogICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGZsdXNoICYm\nIF90cmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5l\ndyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsIAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgVHJhbnNhY3Rpb25FdmVudC5CRUZPUkVfRkxVU0gsIG1vYmpz\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3Ms\nIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRDbHNzKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNv\nbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUFJFU1RPUklORzsKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX0RFUkVGREVMRVRJTkc7CiAgICAgICAgICAg\nIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICAgICAgICAgIF9kZXJlZkFk\nZGl0aW9ucyA9IG51bGw7CgogICAgICAgICAgICAvLyBhbHNvIGNsZWFyIGRl\ncmVmZWQgc2V0OyB0aGUgZGVsZXRlcyBoYXZlIGJlZW4gcmVjb3JkZWQKICAg\nICAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZGVyZWZDYWNoZS5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gZmx1c2ggdG8gc3RvcmUgbWFuYWdlcgogICAgICAgIExpc3QgZXhjZXBz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoZmx1c2gg\nJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX1NUT1JFX0ZMVVNISU5HOwogICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywKICAgICAgICAgICAgICAgICAgICBu\nZXdGbHVzaEV4Y2VwdGlvbihfc3RvcmUuZmx1c2godHJhbnNhY3Rpb25hbCkp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19TVE9SRV9GTFVTSElORzsKCiAgICAgICAg\nICAgIGlmIChyZWFzb24gPT0gRkxVU0hfUk9MTEJBQ0spCiAgICAgICAgICAg\nICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFu\nc2FjdGlvbih0cnVlKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbiAh\nPSBGTFVTSF9MT0dJQ0FMKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX0ZMVVNIX1JFUVVJUkVEOwoKICAgICAgICAgICAgLy8gbWFyayBzdGF0\nZXMgYXMgZmx1c2hlZAogICAgICAgICAgICBpZiAoZmx1c2gpIHsKICAgICAg\nICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBzbSA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBz\ndGF0ZSBtYXkgaGF2ZSBiZWNvbWUgdHJhbnNpZW50LCBzdWNoIGFzIGlmCiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGl0IGlzIGVtYmVkZGVkIGFuZCB0\naGUgb3duZXIgaGFzIGJlZW4gZGVsZXRlZCBkdXJpbmcKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gdGhpcyBmbHVzaCBwcm9jZXNzOyBidWcgIzExMDAK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9\nPSBQQ1N0YXRlLlRSQU5TSUVOVCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgc20uYWZ0\nZXJGbHVzaChyZWFzb24pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ncmVhc29uID09IEZMVVNIX0lOQykgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gaWYgbm90IGFib3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hlIGZv\nciBjb21taXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbnl3\nYXksIHJlLWNhY2hlIGRpcnR5IG9iamVjdHMgd2l0aCBkZWZhdWx0IHNvZnQK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnM7IHdlIGRvbid0\nIG5lZWQgaGFyZCByZWZzIG5vdyB0aGF0IHRoZSAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnByb3h5RmllbGRzKHRydWUs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90cmFuc0Nh\nY2hlLmZsdXNoZWQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhj\nZXB0aW9ucyB0byBzaG9ydGN1dCBsaXN0ZW5lcnMgb24gZmFpbAogICAgICAg\nIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwoKICAgICAg\nICBpZiAoZmx1c2ggJiYgcmVhc29uICE9IEZMVVNIX1JPTExCQUNLICYmIHJl\nYXNvbiAhPSBGTFVTSF9MT0dJQ0FMCiAgICAgICAgICAgICYmIF90cmFuc0V2\nZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAgICAg\nIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRo\naXMsCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0ZM\nVVNILCBtb2JqcywgX3BlcnNpc3RlZENsc3MsCiAgICAgICAgICAgICAgICBf\ndXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEZsdXNoIG5ld2x5LXRyYW5zYWN0aW9uYWwgb2Jq\nZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoQWRkaXRpb25z\nKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikgewogICAg\nICAgIGJvb2xlYW4gbG9vcDsKICAgICAgICBkbyB7CiAgICAgICAgICAgIC8v\nIGZsdXNoIG5ldyB0cmFuc2FjdGlvbmFsIGluc3RhbmNlczsgbm90ZSBsb2dp\nY2FsIG9yCiAgICAgICAgICAgIGxvb3AgPSBmbHVzaFRyYW5zQWRkaXRpb25z\nKHRyYW5zYWN0aW9uYWwsIHJlYXNvbikKICAgICAgICAgICAgICAgIHwgZGVs\nZXRlRGVyZWZBZGRpdGlvbnMoX2RlcmVmQ2FjaGUpOwogICAgICAgIH0gd2hp\nbGUgKGxvb3ApOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggdHJhbnNh\nY3Rpb25hbCBhZGRpdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBmbHVzaFRyYW5zQWRkaXRpb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25h\nbCwgaW50IHJlYXNvbikgewogICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMg\nPT0gbnVsbCB8fCBfdHJhbnNBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGtlZXAgbG9jYWwgdHJh\nbnNhY3Rpb25hbCBsaXN0IGNvcHkgdXAgdG8gZGF0ZQogICAgICAgIHRyYW5z\nYWN0aW9uYWwuYWRkQWxsKF90cmFuc0FkZGl0aW9ucyk7CgogICAgICAgIC8v\nIGNvcHkgdGhlIGNoYW5nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRoZSBu\nZXh0IGl0ZXJhdGlvbgogICAgICAgIFN0YXRlTWFuYWdlckltcGxbXSBzdGF0\nZXMgPSAoU3RhdGVNYW5hZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMuCiAg\nICAgICAgICAgIHRvQXJyYXkobmV3IFN0YXRlTWFuYWdlckltcGxbX3RyYW5z\nQWRkaXRpb25zLnNpemUoKV0pOwogICAgICAgIF90cmFuc0FkZGl0aW9ucy5j\nbGVhcigpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgc3RhdGVzW2ldLmJlZm9yZUZsdXNo\nKHJlYXNvbiwgX2NhbGwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoK\nICAgIC8qKgogICAgICogRGVsZXRlIG5ldyBkZXJlZmVyZW5jZWQgb2JqZWN0\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGRlbGV0ZURlcmVmQWRk\naXRpb25zKENvbGxlY3Rpb24gZGVyZWZzKSB7CiAgICAgICAgaWYgKF9kZXJl\nZkFkZGl0aW9ucyA9PSBudWxsIHx8IF9kZXJlZkFkZGl0aW9ucy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gcmVt\nZW1iZXIgdGhlc2UgYWRkaXRpb25zIGluIGNhc2Ugb25lIGJlY29tZXMgZGVy\nZWZlZCBhZ2FpbiBsYXRlcgogICAgICAgIGRlcmVmcy5hZGRBbGwoX2RlcmVm\nQWRkaXRpb25zKTsKCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbFtdIHN0YXRl\ncyA9IChTdGF0ZU1hbmFnZXJJbXBsW10pIF9kZXJlZkFkZGl0aW9ucy4KICAg\nICAgICAgICAgdG9BcnJheShuZXcgU3RhdGVNYW5hZ2VySW1wbFtfZGVyZWZB\nZGRpdGlvbnMuc2l6ZSgpXSk7CiAgICAgICAgX2RlcmVmQWRkaXRpb25zLmNs\nZWFyKCk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBkZWxldGVEZXJlZihzdGF0ZXNbaV0p\nOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICog\nRGVsZXRlIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGRlbGV0ZURlcmVmKFN0YXRlTWFuYWdlckltcGwgc20p\nIHsKICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX0RFTEVURSwKICAgICAgICAgICAgc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCksIHNtLCBudWxsKTsKICAgICAgICBpZiAoKGFjdGlvbiAmIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4pICE9IDApCiAgICAgICAgICAgIHNtLmRlbGV0\nZSgpOwogICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NB\nU0NBREUpICE9IDApCiAgICAgICAgICAgIHNtLmNhc2NhZGVEZWxldGUoX2Nh\nbGwpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBhY3Rp\nb24gdG8gdGFrZSBiYXNlZCBvbiB0aGUgdXNlcidzIGdpdmVuIGNhbGxiYWNr\ncyBhbmQKICAgICAqIG91ciBpbXBsaWNpdCBiZWhhdmlvci4KICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgcHJvY2Vzc0FyZ3VtZW50KGludCBvcCwgT2JqZWN0\nIG9iaiwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKGNhbGwgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9wLCBvYmosIHNt\nKTsKICAgICAgICBpZiAoX2NhbGwgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIF9jYWxsLnByb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7CiAgICAg\nICAgcmV0dXJuIE9wQ2FsbGJhY2tzLkFDVF9SVU4gfCBPcENhbGxiYWNrcy5B\nQ1RfQ0FTQ0FERTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IHRoZSBw\ncm9wZXIgZXhjZXB0aW9uIGJhc2VkIG9uIHRoZSBnaXZlbiBzZXQgb2YgZmx1\nc2ggZXJyb3JzLCBvcgogICAgICogZG8gbm90aGluZyBpZiBubyBlcnJvcnMg\nb2NjdXJyZWQuCiAgICAgKi8KICAgIHByaXZhdGUgT3BlbkpQQUV4Y2VwdGlv\nbiBuZXdGbHVzaEV4Y2VwdGlvbihDb2xsZWN0aW9uIGV4Y2VwcykgewogICAg\nICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgVGhyb3dhYmxlW10g\ndCA9IChUaHJvd2FibGVbXSkgZXhjZXBzLnRvQXJyYXkKICAgICAgICAgICAg\nKG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0pOwogICAgICAgIExpc3Qg\nZmFpbGVkID0gbmV3IEFycmF5TGlzdCh0Lmxlbmd0aCk7CgogICAgICAgIC8v\nIGNyZWF0ZSBmYXRhbCBleGNlcHRpb24gd2l0aCBuZXN0ZWQgZXhjZXB0aW9u\ncyBmb3IgYWxsIHRoZSBmYWlsZWQKICAgICAgICAvLyBvYmplY3RzOyBpZiBh\nbGwgT0wgZXhjZXB0aW9ucywgdGhyb3cgYSB0b3AtbGV2ZWwgT0wgZXhjZXB0\naW9uCiAgICAgICAgYm9vbGVhbiBvcHQgPSB0cnVlOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBvcHQgJiYgaSA8IHQubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgb3B0ID0gdFtpXSBpbnN0YW5jZW9mIE9wdGltaXN0aWNFeGNlcHRp\nb247CiAgICAgICAgICAgIGlmIChvcHQpIHsKICAgICAgICAgICAgICAgIE9i\namVjdCBmID0gKChPcHRpbWlzdGljRXhjZXB0aW9uKSB0W2ldKS5nZXRGYWls\nZWRPYmplY3QoKTsKICAgICAgICAgICAgICAgIGlmIChmICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgZmFpbGVkLmFkZChmKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBpZiAob3B0ICYmICFmYWlsZWQuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRp\nb24oZmFpbGVkLCB0KTsKICAgICAgICBpZiAob3B0KQogICAgICAgICAgICBy\nZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24odCk7CiAgICAgICAgcmV0\ndXJuIG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdldCgicm9sbGVkLWJhY2si\nKSkuCiAgICAgICAgICAgIHNldE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0\nYWwodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGhlIGN1cnJl\nbnQgdHJhbnNhY3Rpb24sIG1ha2luZyBhcHByb3ByaWF0ZSBzdGF0ZSB0cmFu\nc2l0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZW5kVHJhbnNh\nY3Rpb24oaW50IHN0YXR1cykgewogICAgICAgIC8vIGlmIGEgZGF0YSBzdG9y\nZSB0cmFuc2FjdGlvbiB3YXMgaW4gcHJvZ3Jlc3MsIGRvIHRoZQogICAgICAg\nIC8vIGFwcHJvcHJpYXRlIHRyYW5zYWN0aW9uIGNoYW5nZQogICAgICAgIGJv\nb2xlYW4gcm9sbGJhY2sgPSBzdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19DT01N\nSVRURUQ7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwoKICAgICAgICB0\ncnkgewogICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRTdG9y\nZU1hbmFnZXJUcmFuc2FjdGlvbihyb2xsYmFjaykpOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgcm9sbGJh\nY2sgPSB0cnVlOwogICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBy\nZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBnbyBiYWNrIHRvIGRlZmF1bHQg\nbm9uZSBsb2NrIGxldmVsCiAgICAgICAgX2ZjLnNldFJlYWRMb2NrTGV2ZWwo\nTE9DS19OT05FKTsKICAgICAgICBfZmMuc2V0V3JpdGVMb2NrTGV2ZWwoTE9D\nS19OT05FKTsKICAgICAgICBfZmMuc2V0TG9ja1RpbWVvdXQoLTEpOwoKICAg\nICAgICBDb2xsZWN0aW9uIHRyYW5zU3RhdGVzID0gX3RyYW5zQ2FjaGU7CiAg\nICAgICAgaWYgKHRyYW5zU3RhdGVzID09IG51bGwpCiAgICAgICAgICAgIHRy\nYW5zU3RhdGVzID0gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAgICAg\nLy8gZmlyZSBhZnRlciByb2xsYmFjay9jb21taXQgZXZlbnQKICAgICAgICBD\nb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsKICAgICAgICBpZiAoX3RyYW5zRXZl\nbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIG1v\nYmpzID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5zU3RhdGVz\nKTsKICAgICAgICAgICAgaW50IGV2ZW50VHlwZSA9IChyb2xsYmFjaykgPyBU\ncmFuc2FjdGlvbkV2ZW50LkFGVEVSX1JPTExCQUNLCiAgICAgICAgICAgICAg\nICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlUOwogICAgICAgICAg\nICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0\naGlzLCBldmVudFR5cGUsIG1vYmpzLCAKICAgICAgICAgICAgICAgIF9wZXJz\naXN0ZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gbnVsbCB0cmFuc2FjdGlvbmFsIGNhY2hlcyBu\nb3cgc28gdGhhdCBhbGwgdGhlIHJlbW92ZUZyb21UcmFuc2FjdGlvbgogICAg\nICAgIC8vIGNhbGxzIGFzIHdlIHRyYW5zaXRpb24gZWFjaCBvYmplY3QgZG9u\nJ3QgaGF2ZSB0byBkbyBhbnkgd29yazsgZG9uJ3QKICAgICAgICAvLyBjbGVh\nciB0cmFucyBjYWNoZSBvYmplY3QgYmVjYXVzZSB3ZSBzdGlsbCBuZWVkIHRo\nZSB0cmFuc1N0YXRlcwogICAgICAgIC8vIHJlZmVyZW5jZSB0byBpdCBiZWxv\ndwogICAgICAgIF90cmFuc0NhY2hlID0gbnVsbDsKICAgICAgICBpZiAoX3Bl\ncnNpc3RlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAgX3BlcnNpc3RlZENs\nc3MuY2xlYXIoKTsKICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzICE9IG51bGwp\nCiAgICAgICAgICAgIF91cGRhdGVkQ2xzcy5jbGVhcigpOwogICAgICAgIGlm\nIChfZGVsZXRlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAgX2RlbGV0ZWRD\nbHNzLmNsZWFyKCk7CgogICAgICAgIC8vIG5ldyBjYWNoZSB3b3VsZCBnZXQg\nY2xlYXJlZCBhbnl3YXkgZHVyaW5nIHRyYW5zaXRpb25zLCBidXQgZG9pbmcg\nc28KICAgICAgICAvLyBpbW1lZGlhdGVseSBzYXZlcyB1cyBzb21lIGxvb2t1\ncHMKICAgICAgICBfY2FjaGUuY2xlYXJOZXcoKTsKCiAgICAgICAgLy8gdGVs\nbCBhbGwgZGVyZWZlZCBpbnN0YW5jZXMgdGhleSdyZSBubyBsb25nZXIgZGVy\nZWZlZDsgd2UgY2FuJ3QKICAgICAgICAvLyByZWx5IG9uIHJvbGxiYWNrIGFu\nZCBjb21taXQgY2FsbHMgYmVsb3cgY2F1c2Ugc29tZSBpbnN0YW5jZXMgbWln\naHQKICAgICAgICAvLyBub3QgYmUgdHJhbnNhY3Rpb25hbAogICAgICAgIGlm\nIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGVyZWZD\nYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAg\nICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuc2V0RGVyZWZl\ncmVuY2VkRGVwZW5kZW50CiAgICAgICAgICAgICAgICAgICAgKGZhbHNlLCBm\nYWxzZSk7CiAgICAgICAgICAgIF9kZXJlZkNhY2hlLmNsZWFyKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBwZWZvcm0gY29tbWl0IG9yIHJvbGxiYWNrIHN0\nYXRlIHRyYW5zaXRpb25zIG9uIGVhY2ggaW5zdGFuY2UKICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\ndHJhbnNTdGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChyb2xsYmFj\naykgewogICAgICAgICAgICAgICAgICAgIC8vIHRlbGwgb2JqZWN0cyB0aGF0\nIG1heSBoYXZlIGJlZW4gZGVyZWZlZCB0aGVuIGZsdXNoZWQKICAgICAgICAg\nICAgICAgICAgICAvLyAoYW5kIHRoZXJlZm9yZSBkZWxldGVkKSB0byB1bi1k\nZXJlZgogICAgICAgICAgICAgICAgICAgIHNtLnNldERlcmVmZXJlbmNlZERl\ncGVuZGVudChmYWxzZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHNt\nLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgICAgICAgICBzbS5jb21taXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2VwcywgcmUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBub3RpZnkgdGhlIGxvY2sgbWFuYWdlciB0byBjbGVhbiB1\ncCBhbmQgcmVsZWFzZSByZW1haW5pbmcgbG9ja3MKICAgICAgICBfbG0uZW5k\nVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgLy8gY2xlYXIgb2xkIHNhdmVwb2lu\ndHMgaW4gcmV2ZXJzZQogICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsK\nICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiBfc2F2ZXBv\naW50cy5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgIHNhdmUgPQogICAgICAg\nICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92\nZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAgICAgc2F2ZS5y\nZWxlYXNlKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgX3NhdmVwb2ludHMg\nPSBudWxsOwogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9IG51bGw7CgogICAg\nICAgIC8vIGZpcmUgYWZ0ZXIgc3RhdGUgY2hhbmdlIGV2ZW50CiAgICAgICAg\naWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAg\nICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9u\nRXZlbnQodGhpcywgVHJhbnNhY3Rpb25FdmVudC4KICAgICAgICAgICAgICAg\nIEFGVEVSX1NUQVRFX1RSQU5TSVRJT05TLCBtb2JqcywgbnVsbCwgbnVsbCwg\nbnVsbCkpOwoKICAgICAgICAvLyBub3cgY2xlYXIgdHJhbnMgY2FjaGU7IGtl\nZXAgY2xlYXJlZCB2ZXJzaW9uIHJhdGhlciB0aGFuCiAgICAgICAgLy8gbnVs\nbCB0byBhdm9pZCBoYXZpbmcgdG8gcmUtY3JlYXRlIHRoZSBzZXQgbGF0ZXI7\nIG1vcmUgZWZmaWNpZW50CiAgICAgICAgaWYgKHRyYW5zU3RhdGVzICE9IENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1QpIHsKICAgICAgICAgICAgX3RyYW5zQ2Fj\naGUgPSAoVHJhbnNhY3Rpb25hbENhY2hlKSB0cmFuc1N0YXRlczsKICAgICAg\nICAgICAgX3RyYW5zQ2FjaGUuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAg\nIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBPYmplY3QgbGlmZWN5\nY2xlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lk\nIHBlcnNpc3QoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIHBlcnNpc3Qob2JqLCBudWxsLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAg\nICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBv\nYmosIE9iamVjdCBpZCwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgcmV0dXJuIHBlcnNpc3Qob2JqLCBpZCwgdHJ1ZSwgY2FsbCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcGVyc2lzdEFsbChDb2xsZWN0aW9uIG9i\nanMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBwZXJzaXN0QWxsKG9i\nanMsIHRydWUsIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lz\ndCB0aGUgZ2l2ZW4gb2JqZWN0cy4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3\nYXMgYW4gZXhwbGljaXQgcGVyc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJv\ndmlzb25hbCBwZXJzaXN0IChQTkVXUFJPVklTSU9OQUwpLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBwZXJzaXN0QWxsKENvbGxlY3Rpb24gb2JqcywgYm9v\nbGVhbiBleHBsaWNpdCwgCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICBMaXN0\nIGV4Y2VwcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNz\nZXJ0V3JpdGVPcGVyYXRpb24oKTsKCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBwZXJz\naXN0KGl0ci5uZXh0KCksIGV4cGxpY2l0LCBjYWxsKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhy\nb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogSWYgdGhlIGdpdmVuIGVsZW1lbnQgaXMgbm90IG51bGws\nIGFkZCBpdCB0byB0aGUgZ2l2ZW4gbGlzdCwKICAgICAqIGNyZWF0aW5nIHRo\nZSBsaXN0IGlmIG5lY2Vzc2FyeS4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0\nIGFkZChMaXN0IGwsIE9iamVjdCBvKSB7CiAgICAgICAgaWYgKG8gPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGw7CiAgICAgICAgaWYgKGwgPT0gbnVs\nbCkKICAgICAgICAgICAgbCA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAg\nbC5hZGQobyk7CiAgICAgICAgcmV0dXJuIGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaHJvdyBhbiBleGNlcHRpb24gd3JhcHBpbmcgdGhlIGdpdmVuIG5l\nc3RlZCBleGNlcHRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdGhy\nb3dOZXN0ZWRFeGNlcHRpb25zKExpc3QgZXhjZXBzLCBib29sZWFuIGRhdGFz\ndG9yZSkgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMu\naXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKGRh\ndGFzdG9yZSAmJiBleGNlcHMuc2l6ZSgpID09IDEpCiAgICAgICAgICAgIHRo\ncm93IChSdW50aW1lRXhjZXB0aW9uKSBleGNlcHMuZ2V0KDApOwoKICAgICAg\nICBib29sZWFuIGZhdGFsID0gZmFsc2U7CiAgICAgICAgVGhyb3dhYmxlW10g\ndCA9IChUaHJvd2FibGVbXSkgZXhjZXBzLnRvQXJyYXkKICAgICAgICAgICAg\nKG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0pOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAodFtpXSBpbnN0YW5jZW9mIE9wZW5KUEFFeGNlcHRpb24KICAgICAgICAg\nICAgICAgICYmICgoT3BlbkpQQUV4Y2VwdGlvbikgdFtpXSkuaXNGYXRhbCgp\nKQogICAgICAgICAgICAgICAgZmF0YWwgPSB0cnVlOwogICAgICAgIH0KICAg\nICAgICBPcGVuSlBBRXhjZXB0aW9uIGVycjsKICAgICAgICBpZiAoZGF0YXN0\nb3JlKQogICAgICAgICAgICBlcnIgPSBuZXcgU3RvcmVFeGNlcHRpb24oX2xv\nYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBlcnIgPSBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibmVzdGVk\nLWV4Y2VwcyIpKTsKICAgICAgICB0aHJvdyBlcnIuc2V0TmVzdGVkVGhyb3dh\nYmxlcyh0KS5zZXRGYXRhbChmYXRhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3QuICBJbmRpY2F0ZSB3aGV0aGVy\nIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNpc3QKICAgICAqIChQTkVXKSBv\nciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFMKQogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0KE9iamVjdCBvYmosIGJvb2xl\nYW4gZXhwbGljaXQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBwZXJz\naXN0KG9iaiwgbnVsbCwgZXhwbGljaXQsIGNhbGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5kaWNhdGUg\nd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAgICAgKiAo\nUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9WSVNJT05B\nTCkuCiAgICAgKiBTZWUge0BsaW5rIEJyb2tlcn0gZm9yIGRldGFpbHMgb24g\ndGhpcyBtZXRob2QuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHBlcnNpc3QoT2JqZWN0IG9iaiwgT2JqZWN0IGlkLCBib29sZWFu\nIGV4cGxpY2l0LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAg\nICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwoKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwo\nb2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFkZChv\nYmopKQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAg\naW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9Q\nRVJTSVNULCBvYmosIHNtLCBjYWxsKTsKICAgICAgICAgICAgaWYgKGFjdGlv\nbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBzbTsKCiAgICAgICAgICAgIC8vIEFDVF9DQVNDQURFCiAgICAgICAg\nICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkg\newogICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVu\ndChPcENhbGxiYWNrcy5PUF9QRVJTSVNULCBvYmosIGNhbGwsCiAgICAgICAg\nICAgICAgICAgICAgICAgICJwZXJzaXN0Iik7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gc207CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFDVF9S\nVU4KICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjOwogICAgICAg\nICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNt\nLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAgICAgICAgICgicGVyc2lzdC1kZXRhY2hlZCIsIEV4Y2VwdGlvbnMudG9T\ndHJpbmcob2JqKSkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWls\nZWRPYmplY3Qob2JqKTsKCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzRW1i\nZWRkZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHNtLnBlcnNpc3QoKTsK\nICAgICAgICAgICAgICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1Rf\nQ0FTQ0FERSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgc20uY2Fz\nY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHNtOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGFu\nIGVtYmVkZGVkIGZpZWxkOyBub3RpZnkgdGhlIG93bmVyIHRoYXQgdGhlIHZh\nbHVlIGhhcwogICAgICAgICAgICAgICAgLy8gY2hhbmdlZCBieSBiZWNvbWlu\nZyBpbmRlcGVuZGVudGx5IHBlcnNpc3RlbnQKICAgICAgICAgICAgICAgIHNt\nLmdldE93bmVyKCkuZGlydHkoc20uZ2V0T3duZXJNZXRhRGF0YSgpLgogICAg\nICAgICAgICAgICAgICAgIGdldEZpZWxkTWV0YURhdGEoKS5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgICAgIF9jYWNoZS5wZXJzaXN0KHNtKTsKICAgICAg\nICAgICAgICAgIHBjID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYyA9IGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopOwogICAgICAgICAgICAgICAgaWYg\nKHBjLnBjSXNEZXRhY2hlZCgpID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgicGVyc2lzdC1kZXRh\nY2hlZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLgogICAgICAgICAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAg\nICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVl\nKTsKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KG9iaiwgbnVsbCwg\nbWV0YSwgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1BFUlNJU1QpOwoKICAgICAg\nICAgICAgLy8gY3JlYXRlIGlkIGZvciBpbnN0YW5jZQogICAgICAgICAgICBp\nZiAoaWQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKG1ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTikKICAgICAgICAgICAgICAgICAgICBpZCA9IEFwcGxpY2F0aW9uSWRzLmNy\nZWF0ZShwYywgbWV0YSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtZXRh\nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9X\nTikKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBtZXRhKSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWQgPSBTdGF0ZU1h\nbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IGFscmVhZHkgaGF2ZSB0\naGUgaW5zdGFuY2UgY2FjaGVkCiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgb3RoZXIgPSBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChpZCwgZmFsc2Up\nOwogICAgICAgICAgICBpZiAob3RoZXIgIT0gbnVsbCAmJiAhb3RoZXIuaXNE\nZWxldGVkKCkgJiYgIW90aGVyLmlzTmV3KCkpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWNo\nZS1leGlzdHMiLAogICAgICAgICAgICAgICAgICAgIG9iai5nZXRDbGFzcygp\nLmdldE5hbWUoKSwgaWQpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKCiAgICAg\nICAgICAgIC8vIGlmIGhhZCBlbWJlZGRlZCBzbSwgbnVsbCBpdAogICAgICAg\nICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBjLnBjUmVw\nbGFjZVN0YXRlTWFuYWdlcihudWxsKTsKCiAgICAgICAgICAgIC8vIGNyZWF0\nZSBuZXcgc20KICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1w\nbChpZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChleHBs\naWNpdCkKICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQ\nQ1N0YXRlLlBORVcpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5FV1BST1ZJ\nU0lPTkFMKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBz\nbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBOT05UUkFOU05FVyk7CiAgICAg\nICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUp\nICE9IDApCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxs\nKTsKICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVtcG9yYXJpbHkgbWFuYWdl\nIHRoZSBnaXZlbiBpbnN0YW5jZSBpbiBvcmRlciB0byBjYXNjYWRlIHRoZSBn\naXZlbgogICAgICogb3BlcmF0aW9uIHRocm91Z2ggaXQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBjYXNjYWRlVHJhbnNpZW50KGludCBvcCwgT2JqZWN0\nIG9iaiwgT3BDYWxsYmFja3MgY2FsbCwKICAgICAgICBTdHJpbmcgZXJyT3Ap\nIHsKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBhc3NlcnRQZXJz\naXN0ZW5jZUNhcGFibGUob2JqKTsKCiAgICAgICAgLy8gaWYgdXNpbmcgZGV0\nYWNoZWQgc3RhdGUgbWFuYWdlciwgZG9uJ3QgcmVwbGFjZQogICAgICAgIGlm\nIChwYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwpCiAgICAgICAgICAg\nIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgZXJyT3ApOwoKICAg\nICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YShv\nYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKFN0YXRlTWFu\nYWdlcklkLgogICAgICAgICAgICBuZXdJbnN0YW5jZSh0aGlzKSwgbWV0YSwg\ndGhpcyk7CiAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5UTE9B\nREVEKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBzd2l0Y2ggKG9wKSB7\nCiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1BFUlNJU1Q6\nCiAgICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE9wQ2FsbGJhY2tzLk9QX0RFTEVURToKICAgICAgICAgICAgICAgICAg\nICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9S\nRUZSRVNIOgogICAgICAgICAgICAgICAgICAgIHNtLmdhdGhlckNhc2NhZGVS\nZWZyZXNoKGNhbGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2Yob3ApKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAg\nICAgICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgZGVsZXRlQWxsKENvbGxlY3Rpb24gb2JqcywgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0\naW9uKCk7CgogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAg\nICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBvYmogPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3dOZXN0ZWRF\neGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigp\nOwogICAgICAgICAgICBkZWxldGUob2JqLCBnZXRTdGF0ZU1hbmFnZXJJbXBs\nKG9iaiwgdHJ1ZSksIGNhbGwpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZGVsZXRlLgogICAgICov\nCiAgICB2b2lkIGRlbGV0ZShPYmplY3Qgb2JqLCBTdGF0ZU1hbmFnZXJJbXBs\nIHNtLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKCFfb3BlcmF0\naW5nLmFkZChvYmopKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlu\ndCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfREVM\nRVRFLCBvYmosIHNtLCBjYWxsKTsKICAgICAgICBpZiAoYWN0aW9uID09IE9w\nQ2FsbGJhY2tzLkFDVF9OT05FKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIC8vIEFDVF9DQVNDQURFCiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKSB7CiAgICAgICAgICAgIGlmIChzbSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxs\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY2FzY2FkZVRy\nYW5zaWVudChPcENhbGxiYWNrcy5PUF9ERUxFVEUsIG9iaiwgY2FsbCwgImRl\nbGV0ZSIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICAvLyBBQ1RfUlVOCiAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgImRlbGV0ZSIpOwogICAg\nICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURF\nKSAhPSAwKQogICAgICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxs\nKTsKICAgICAgICAgICAgc20uZGVsZXRlKCk7CiAgICAgICAgfSBlbHNlIGlm\nIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQo\nKSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgImRlbGV0ZSIpOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGluZGljYXRpbmcgdGhhdCB0aGUg\nY3VycmVudCBhY3Rpb24gY2FuJ3QgYmUKICAgICAqIHBlcmZvcm1lZCBvbiBh\nIGRldGFjaGVkIG9iamVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBPcGVuSlBB\nRXhjZXB0aW9uIG5ld0RldGFjaGVkRXhjZXB0aW9uKE9iamVjdCBvYmosCiAg\nICAgICAgU3RyaW5nIG9wZXJhdGlvbikgewogICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGV0YWNoZWQtb3AiLCBvcGVy\nYXRpb24sCiAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkp\nLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlbGVhc2VBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHJlbGVhc2UoaXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAg\nICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93TmVz\ndGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcmVsZWFzZShPYmplY3Qgb2JqLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAg\nICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tz\nLk9QX1JFTEVBU0UsIG9iaiwgc20sIGNhbGwpOwoKICAgICAgICAgICAgaWYg\nKHNtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCAm\nJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgYm9vbGVh\nbiBwZW5kaW5nID0gc20uaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpOwogICAg\nICAgICAgICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAgICAg\nIGlmIChwZW5kaW5nKQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21Q\nZW5kaW5nVHJhbnNhY3Rpb24oc20pOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBlbWJlZChPYmplY3Qgb2JqLCBPYmplY3QgaWQs\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwgVmFsdWVNZXRh\nRGF0YSBvd25lck1ldGEpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIG9yaWcgPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAg\nICAgICAgIGlmIChvcmlnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8v\nIGlmIGFscmVhZHkgZW1iZWRkZWQsIG5vdGhpbmcgdG8gZG8KICAgICAgICAg\nICAgICAgIGlmIChvcmlnLmdldE93bmVyKCkgPT0gb3duZXIgJiYgb3JpZy5n\nZXRNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEVtYmVkZGlu\nZ01ldGFEYXRhKCkgPT0gb3duZXJNZXRhKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBvcmlnOwoKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBt\nYWtlIHN1cmUgcGMgaXMgZnVsbHkgbG9hZGVkIGZvciB3aGVuIHdlIGNvcHkg\naXRzCiAgICAgICAgICAgICAgICAvLyBkYXRhIGJlbG93CiAgICAgICAgICAg\nICAgICBvcmlnLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxM\nLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGNyZWF0ZSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGVtYmVkZGVk\nIG1ldGFkYXRhCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG93\nbmVyTWV0YS5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgIGlm\nIChtZXRhID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1lbWJlZCIsIG93bmVyTWV0\nYSkpOwoKICAgICAgICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAg\nICAgICBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwoK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1h\nbmFnZXJJbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgc20uc2V0\nT3duZXIoKFN0YXRlTWFuYWdlckltcGwpIG93bmVyLCBvd25lck1ldGEpOwoK\nICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGNvcHk7CiAgICAgICAg\nICAgIFBDU3RhdGUgc3RhdGU7CiAgICAgICAgICAgIENsYXNzIHR5cGUgPSBt\nZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgaWYgKHR5cGUu\naXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAgIHR5cGUgPSBtZXRhLmdl\ndEludGVyZmFjZUltcGwoKTsKICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBnaXZlIGNvcHkgYW5kIHRoZSBvcmln\naW5hbCBpbnN0YW5jZSB0aGUgc2FtZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAg\nICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiBjb3B5IGZpZWxkcyBmcm9tIG9u\nZSB0byB0aGUgb3RoZXIKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgY29weVNNOwogICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGNvcHlTTSA9IHNtOwogICAgICAgICAgICAgICAg\nICAgIHBjID0gYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CiAgICAg\nICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nY29weVNNID0gb3JpZzsKICAgICAgICAgICAgICAgICAgICBwYyA9IG9yaWcu\nZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBj\nb3B5IHRoZSBpbnN0YW5jZS4gIHdlIGRvIHRoaXMgZXZlbiBpZiBpdCBkb2Vz\nbid0IGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIGEgc3Rh\ndGUgbWFuYWdlciBpbiBjYXNlIGl0IGlzIGxhdGVyIGFzc2lnbmVkIHRvIGEK\nICAgICAgICAgICAgICAgICAgICAvLyBQQyBmaWVsZDsgYXQgdGhhdCBwb2lu\ndCBpdCdzIHRvbyBsYXRlIHRvIGNvcHkKICAgICAgICAgICAgICAgICAgICBj\nb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZSh0eXBlLCBjb3B5U00sIGZh\nbHNlKTsKICAgICAgICAgICAgICAgICAgICBpbnRbXSBmaWVsZHMgPSBuZXcg\naW50W21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoXTsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ldID0gaTsKICAgICAg\nICAgICAgICAgICAgICBjb3B5LnBjQ29weUZpZWxkcyhwYywgZmllbGRzKTsK\nICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRUNPUFk7CiAg\nICAgICAgICAgICAgICAgICAgY29weS5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIo\nbnVsbCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5jZSBkaWRuJ3QgaGF2ZSBhIHN0\nYXRlIG1hbmFnZXIgdG8gc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgLy8g\ncmV2ZXJ0IGl0IHRvIGJlaW5nIHRyYW5zaWVudAogICAgICAgICAgICAgICAg\nICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNv\ncHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUsIHNtLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAh\nPSAwICYmICFfb3B0aW1pc3RpYykKICAgICAgICAgICAgICAgICAgICBzdGF0\nZSA9IFBDU3RhdGUuRUNMRUFOOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FTk9OVFJBTlM7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoY29weSwg\nc3RhdGUpOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBub3QgYWxyZWFk\neSBjYWNoZWQsIGNyZWF0ZSBhbiBlbXB0eSBjb3B5IG9mIHRoZSBnaXZlbiBz\ndGF0ZQogICAgICogbWFuYWdlciBpbiB0aGUgZ2l2ZW4gc3RhdGUuCiAgICAg\nKi8KICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weShPcGVuSlBBU3RhdGVN\nYW5hZ2VyIGNvcHksIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBjb3B5LmZldGNo\nT2JqZWN0SWQoKTsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IGNvcHkuZ2V0\nTWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xhc3MoKTsKICAgICAgICAgICAgaWYg\nKG9pZCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIC8vIGNhY2hlZCBpbnN0YW5j\nZT8KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG51bGw7CiAg\nICAgICAgICAgIGlmICghY29weS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAg\nICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwgdHJ1ZSk7\nCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi4KICAgICAgICAg\nICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwog\nICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVwb3MuZ2V0\nTWV0YURhdGEodHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAg\nICAvLyBjb25zdHJ1Y3QgYSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGFsbCBp\nbmZvIGtub3duCiAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFn\nZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICBzbS5z\nZXRPYmplY3RJZChvaWQpOwogICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6\nZShzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwgc3RhdGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVmcmVzaEFsbChDb2xs\nZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNo\nKGl0ci5uZXh0KCksIGNhbGwpOwogICAgICAgICAgICBpZiAoX29wZXJhdGlu\nZy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGlmIChfb3BlcmF0aW5nLnNpemUoKSA9PSAxKQogICAgICAgICAgICAg\nICAgcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcuaXRlcmF0b3IoKS5uZXh0\nKCksIGNhbGwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBy\nZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywgY2FsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlZnJlc2goT2JqZWN0IG9iaiwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFu\nc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJl\nZnJlc2gob2JqLCBjYWxsKTsKICAgICAgICAgICAgaWYgKF9vcGVyYXRpbmcu\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICBpZiAoX29wZXJhdGluZy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgICAg\nIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLml0ZXJhdG9yKCkubmV4dCgp\nLCBjYWxsKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmVm\ncmVzaEludGVybmFsKF9vcGVyYXRpbmcsIGNhbGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlcnMgYWxsIG9iamVjdHMgcmVh\nY2hhYmxlIHRocm91Z2ggY2FzY2FkZS1yZWZyZXNoIHJlbGF0aW9ucwogICAg\nICogaW50byB0aGUgb3BlcmF0aW5nIHNldC4KICAgICAqLwogICAgdm9pZCBn\nYXRoZXJDYXNjYWRlUmVmcmVzaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwogICAgICAgIGlu\ndCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVG\nUkVTSCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBP\ncENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgc20u\nZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJF\nU0gsIG9iaiwgY2FsbCwgInJlZnJlc2giKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aXRoIHRoZSBmdWxsIHNldCBv\nZiBvYmplY3RzIHJlYWNoYWJsZSB2aWEKICAgICAqIGNhc2NhZGUtcmVmcmVz\naCByZWxhdGlvbnMgZnJvbSB0aGUgdXNlci1naXZlbiBpbnN0YW5jZXMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5hbChDb2xs\nZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBMaXN0\nIGV4Y2VwcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g\nY29sbGVjdCBpbnN0YW5jZXMgdGhhdCBuZWVkIGEgcmVmcmVzaAogICAgICAg\nICAgICBDb2xsZWN0aW9uIGxvYWQgPSBudWxsOwogICAgICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKHByb2Nl\nc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBj\nYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNl\ncHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAgICAgICAgICAgICAgICAg\nICBlbHNlIGlmIChzbS5iZWZvcmVSZWZyZXNoKHRydWUpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0\nKG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxv\nYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBh\nYmxlKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2Up\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyByZWZyZXNoIGFsbAogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IF9zdG9y\nZS5sb2FkQWxsKGxvYWQsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgU3Rv\ncmVNYW5hZ2VyLkZPUkNFX0xPQURfUkVGUkVTSCwgX2ZjLCBudWxsKTsKICAg\nICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKCiAg\nICAgICAgICAgICAgICAvLyBwZXJmb3JtIHBvc3QtcmVmcmVzaCB0cmFuc2l0\naW9ucyBhbmQgbWFrZSBzdXJlIGFsbCBmZXRjaAogICAgICAgICAgICAgICAg\nLy8gZ3JvdXAgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gbG9hZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdl\nckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZh\naWxlZCAhPSBudWxsICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmFm\ndGVyUmVmcmVzaCgpOwogICAgICAgICAgICAgICAgICAgICAgICBzbS5sb2Fk\nKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgbnVsbCwgbnVsbCwg\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBr\nZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBub3cgaW52b2tlIHBvc3RS\nZWZyZXNoIG9uIGFsbCB0aGUgaW5zdGFuY2VzCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwoaXRyLm5leHQoKSwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgIXNtLmlz\nRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlm\nZWN5Y2xlRXZlbnQuQUZURVJfUkVGUkVTSCk7CiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICAg\nICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogT3B0aW1pemF0aW9uIGZvciBzaW5nbGUtb2Jq\nZWN0IHJlZnJlc2guCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJl\nc2hJbnRlcm5hbChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwg\nb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\nd0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKHNtLmJlZm9yZVJlZnJlc2goZmFsc2UpKSB7CiAg\nICAgICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlcklt\ncGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgICAgICBzbS5hZnRlclJlZnJlc2goKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBzbS5n\nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9SRUZSRVNIKTsK\nICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqKS5wY0lzRGV0YWNoZWQoKQogICAgICAgICAgICAgICAgPT0gQm9v\nbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRF\neGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJldHJpZXZlQWxsKENvbGxlY3Rp\nb24gb2JqcywgYm9vbGVhbiBkZmdPbmx5LAogICAgICAgIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgewog\nICAgICAgICAgICByZXRyaWV2ZShvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCBk\nZmdPbmx5LCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJl\nYWQoKTsKCiAgICAgICAgICAgIC8vIGNvbGxlY3QgYWxsIGhvbGxvdyBpbnN0\nYW5jZXMgZm9yIGxvYWQKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAg\nICAgICAgQ29sbGVjdGlvbiBsb2FkID0gbnVsbDsKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMg\nPSBuZXcgQXJyYXlMaXN0KG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAg\nICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQo\nT3BDYWxsYmFja3MuT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0g\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmos\nICJyZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20u\naXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHNtcy5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lz\nRGV0YWNoZWQoKQogICAgICAgICAgICAgICAgICAgICAgICA9PSBCb29sZWFu\nLlRSVUUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBsb2FkIGFsbCBo\nb2xsb3cgaW5zdGFuY2VzCiAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVk\nID0gbnVsbDsKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBfc3RvcmUuRk9S\nQ0VfTE9BRF9ERkcKICAgICAgICAgICAgICAgICAgICA6IF9zdG9yZS5GT1JD\nRV9MT0FEX0FMTDsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5s\nb2FkQWxsKGxvYWQsIG51bGwsIG1vZGUsIF9mYywgbnVsbCk7CiAgICAgICAg\nICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywg\nbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIHJldHJpZXZlIGFsbCBub24tZmFpbGVk\nIGluc3RhbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNt\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFp\nbnMoc20uZ2V0SWQoKSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdGF0\nZU1hbmFnZXJJbXBsLkxPQURfRkdTCiAgICAgICAgICAgICAgICAgICAgOiBT\ndGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxMOwogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAg\nICAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFk\nZChleGNlcHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByZXRyaWV2ZShPYmplY3Qgb2JqLCBib29sZWFuIGRmZ09ubHksIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJn\ndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwp\nCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQo\nKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2Vw\ndGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgaWYgKHNt\nLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IG1v\nZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTCiAg\nICAgICAgICAgICAgICAgICAgICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FE\nX0FMTDsKICAgICAgICAgICAgICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsK\nICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwg\nbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nIGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNE\nZXRhY2hlZCgpCiAgICAgICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmos\nICJyZXRyaWV2ZSIpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gZXZpY3QgYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5z\nIG9iamVjdHMKICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdl\nZFN0YXRlcygpOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKFN0YXRl\nTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nc20uaXNQZXJzaXN0ZW50KCkgJiYgIXNtLmlzRGlydHkoKSkKICAgICAgICAg\nICAgICAgICAgICBldmljdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgY2Fs\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBldmljdEFsbChDb2xsZWN0aW9uIG9ianMsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBldmljdChpdHIubmV4dCgpLCBjYWxsKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsK\nICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2Up\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKEV4dGVudCBleHRl\nbnQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoZXh0ZW50ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGV2\naWN0IGFsbCBQQ2xlYW4gYW5kIFBOb25UcmFucyBvYmplY3RzIGluIGV4dGVu\ndAogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSBnZXRNYW5hZ2VkU3RhdGVz\nKCk7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAg\nICAgIENsYXNzIGNsczsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0Rp\ncnR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBjbHMgPSBzbS5nZXRNZXRh\nRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoY2xzID09IGV4dGVudC5nZXRFbGVtZW50VHlwZSgpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHx8IChleHRlbnQuaGFzU3ViY2xhc3NlcygpCiAg\nICAgICAgICAgICAgICAgICAgICAgICYmIGV4dGVudC5nZXRFbGVtZW50VHlw\nZSgpLmlzQXNzaWduYWJsZUZyb20oY2xzKSkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGV2aWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBjYWxsKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdChPYmplY3Qgb2JqLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAg\nICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9FVklD\nVCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFj\na3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CgogICAgICAgICAgICBzbS5ldmljdCgpOwogICAgICAgICAgICBpZiAo\nX2V2aWN0RGF0YUNhY2hlICYmIHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgRGF0YUNhY2hlIGNhY2hlID0gc20uZ2V0TWV0\nYURhdGEoKS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICAgICAgICAgIGlmIChj\nYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNhY2hlLnJlbW92\nZShzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBkZXRhY2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9\nIF9jYWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICByZXR1cm4gbmV3IERldGFjaE1hbmFnZXIo\ndGhpcywgZmFsc2UsIGNhbGwpLmRldGFjaChvYmopOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBkZXRhY2hB\nbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9ianMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm4gbmV3IE9iamVjdFswXTsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQog\nICAgICAgICAgICBjYWxsID0gX2NhbGw7CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgRGV0YWNoTWFuYWdlcih0aGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoQWxs\nKG9ianMpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGRldGFjaEFsbChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgZGV0YWNoQWxsKGNhbGwsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGRldGFjaEFsbChPcENhbGxiYWNrcyBjYWxsLCBib29sZWFuIGZsdXNo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gSWYgYSBmbHVzaCBpcyBkZXNpcmVkIChiYXNl\nZCBvbiBpbnB1dCBwYXJtKSwgdGhlbiBjaGVjayBpZiB0aGUKICAgICAgICAg\nICAgLy8gICAiZGlydHkiIGZsYWcgaXMgc2V0IGJlZm9yZSBjYWxsaW5nIGZs\ndXNoKCkuCiAgICAgICAgICAgIGlmICgoZmx1c2gpICYmICgoX2ZsYWdzICYg\nRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0gMCkpCiAgICAgICAgICAgICAgICBm\nbHVzaCgpOwogICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChjYWxsKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgZGV0YWNoQWxsSW50ZXJuYWwoT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIENvbGxlY3Rpb24gc3RhdGVzID0gZ2V0TWFuYWdlZFN0YXRlcygpOwog\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBzdGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSkKICAg\nICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoIXNtLmdldE1ldGFEYXRhKCkuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAg\nICAgICAgICAgIHNtLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAgICAgICAgICBp\ndHIucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\naWYgKHN0YXRlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IF9j\nYWxsOwogICAgICAgIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIHRydWUsIGNh\nbGwpLmRldGFjaEFsbAogICAgICAgICAgICAobmV3IE1hbmFnZWRPYmplY3RD\nb2xsZWN0aW9uKHN0YXRlcykpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nYXR0YWNoKE9iamVjdCBvYmosIGJvb2xlYW4gY29weU5ldywgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub3Qg\ndG8gdHJ5IHRvIHNldCByb2xsYmFjayBvbmx5IGlmIHRoaXMgZmFpbHMKICAg\nICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNoTWFuYWdl\ncih0aGlzLCBjb3B5TmV3LCBjYWxsKS5hdHRhY2gob2JqKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkgewogICAgICAg\nICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG9lKTsKICAgICAgICAgICAgICAg\nIHRocm93IG9lLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIE9iamVjdFtdIGF0dGFjaEFsbChDb2xsZWN0aW9u\nIG9ianMsIGJvb2xlYW4gY29weU5ldywKICAgICAgICBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9ianMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm4gbmV3IE9iamVjdFswXTsKCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8gc2V0IHJvbGxiYWNrIG9ubHkgaWYg\ndGhpcyBmYWlscwogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBBdHRhY2hNYW5hZ2VyKHRoaXMsIGNvcHlOZXcsIGNhbGwpLmF0dGFjaEFs\nbChvYmpzKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3B0aW1pc3RpY0V4Y2Vw\ndGlvbiBvZSkgewogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG9l\nKTsKICAgICAgICAgICAgICAgIHRocm93IG9lLnNldEZhdGFsKHRydWUpOwog\nICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9udHJh\nbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBub250cmFuc2FjdGlvbmFsKGl0ci5uZXh0KCksIGNhbGwp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkg\newogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAg\nICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIG5vbnRyYW5zYWN0aW9u\nYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChv\nYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChP\ncENhbGxiYWNrcy5PUF9OT05UUkFOU0FDVElPTkFMLCBvYmosIHNtLCBjYWxs\nKQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAw\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNtLm5vbnRyYW5zYWN0aW9uYWwo\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIE1ha2UgdGhlIGdpdmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlvbmFsQWxsKENvbGxl\nY3Rpb24gb2JqcywgYm9vbGVhbiB1cGRhdGVWZXJzaW9uLAogICAgICAgIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXplKCkg\nPT0gMSkgewogICAgICAgICAgICB0cmFuc2FjdGlvbmFsKG9ianMuaXRlcmF0\nb3IoKS5uZXh0KCksIHVwZGF0ZVZlcnNpb24sIGNhbGwpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjb2xsZWN0IGFs\nbCBob2xsb3cgaW5zdGFuY2VzIGZvciBsb2FkLCBhbmQgbWFrZSB1bm1hbmFu\nZ2VkCiAgICAgICAgICAgIC8vIGluc3RhbmNlcyB0cmFuc2llbnQtdHJhbnNh\nY3Rpb25hbAogICAgICAgICAgICBDb2xsZWN0aW9uIGxvYWQgPSBudWxsOwog\nICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBTdGF0ZU1hbmFn\nZXJJbXBsIHNtOwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAg\nICAgICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpz\nLnNpemUoKSk7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChwcm9j\nZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJBTlNBQ1RJT05BTCwgb2Jq\nLCBzbSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbCkgJiBPcENhbGxi\nYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFuYWdlIHRyYW5zaWVu\ndCBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhID0gX2Nv\nbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygp\nLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHNt\nID0gbmV3IFN0YXRlTWFuYWdlckltcGwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIChTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKSwgbWV0\nYSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxp\nemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigp\nOwogICAgICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2FkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNp\nb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGRhdGVW\nZXJzaW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0VXBk\nYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hlY2sv\ndXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAg\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAgICAgICBDb2xsZWN0\naW9uIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChsb2FkICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxs\nKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JDRV9MT0FEX05PTkUsCiAgICAgICAg\nICAgICAgICAgICAgX2ZjLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChm\nYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAgICAg\nICAgICAgICAgICBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQp\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbFN0\nYXRlc0FsbChzbXMsIGZhaWxlZCwgZXhjZXBzKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVu\nIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCB0cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIGJvb2xlYW4gdXBkYXRl\nVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBs\nKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50\nKE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNhbGwp\nCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAg\nICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgICAg\nIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNtLmxvYWQo\nX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNpb24odHJ1\nZSk7CiAgICAgICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAgICAg\nICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwogICAg\nICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8v\nIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAgICAgfSBlbHNlIGlmIChzbSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNpZW50\nIGluc3RhbmNlCiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAg\nICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygpLCBf\nbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIE9iamVjdCBpZCA9IFN0\nYXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwogICAgICAgICAgICAg\nICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhpcyk7\nCiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAgIFBDU3RhdGUu\nVENMRUFOKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHRo\nZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0cmFuc2FjdGlvbmFsLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNhY3Rpb25hbFN0YXRlc0FsbChD\nb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlvbiBmYWlsZWQsCiAgICAgICAgTGlz\ndCBleGNlcHMpIHsKICAgICAgICAvLyBtYWtlIGluc3RhbmNlcyB0cmFuc2Fj\ndGlvbmFsIGFuZCBtYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVkCiAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5z\nKHNtLmdldElkKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdl\nckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNl\ncHMsIGZhbHNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAg\nLy8gRXh0ZW50LCBRdWVyeQogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1\nYmNsYXNzZXMpIHsKICAgICAgICByZXR1cm4gbmV3RXh0ZW50KHR5cGUsIHN1\nYmNsYXNzZXMsIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgRXh0ZW50IG5l\nd0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRXh0\nZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlzLCB0eXBlLCBz\ndWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50cyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVudHMgPSBuZXcgUmVmZXJl\nbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAgICAgICAg\nICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsKCiAgICAgICAgICAgIHJldHVybiBl\neHRlbnQ7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJhdG9yKENsYXNzIHR5cGUsIGJvb2xl\nYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGJvb2xlYW4gaWdub3JlQ2hhbmdlcykgewogICAgICAgIEV4dGVudCBl\neHRlbnQgPSBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gpOwog\nICAgICAgIGV4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKGlnbm9yZUNoYW5nZXMp\nOwogICAgICAgIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsKICAgIH0KCiAg\nICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIENsYXNzIGNs\ncywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgUXVlcnkgcSA9IG5ld1F1ZXJ5\nKGxhbmcsIHF1ZXJ5KTsKICAgICAgICBxLnNldENhbmRpZGF0ZVR5cGUoY2xz\nLCB0cnVlKTsKICAgICAgICByZXR1cm4gcTsKICAgIH0KCiAgICBwdWJsaWMg\nUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBxdWVyeSkgewog\nICAgICAgIC8vIGNvbW1vbiBtaXN0YWtlcwogICAgICAgIGlmIChxdWVyeSBp\nbnN0YW5jZW9mIEV4dGVudCB8fCBxdWVyeSBpbnN0YW5jZW9mIENsYXNzKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLW5ldy1xdWVyeSIpKTsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0b3JlUXVlcnkgc3Eg\nPSBfc3RvcmUubmV3UXVlcnkobGFuZyk7CiAgICAgICAgICAgIGlmIChzcSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBFeHByZXNzaW9uUGFyc2VyIGVw\nID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZyk7CiAg\nICAgICAgICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBzcSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShlcCk7CiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX01FVEhP\nRFFMLmVxdWFscyhsYW5nKSkKICAgICAgICAgICAgICAgICAgICBzcSA9IG5l\ndyBNZXRob2RTdG9yZVF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKGxhbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBRdWVyeSBx\nID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNxKTsKICAgICAgICAgICAgcS5zZXRJ\nZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAgaWYg\nKHF1ZXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBxLnNldFF1ZXJ5KHF1\nZXJ5KTsKCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMKICAgICAgICAg\nICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBfcXVl\ncmllcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQu\nV0VBSyk7CiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChxKTsKICAgICAgICAg\nICAgcmV0dXJuIHE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBRdWVyeUltcGwgbmV3UXVlcnlJbXBsKFN0cmluZyBsYW5n\nLCBTdG9yZVF1ZXJ5IHNxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUlt\ncGwodGhpcywgbGFuZywgc3EpOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0\nSWRlbnRpdHlTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UoZm1k\nLmdldERlZmluaW5nTWV0YURhdGEoKSwgZm1kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUgZ2l2ZW4gY2xhc3Mg\nYW5kIG9wdGlvbmFsIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIFNlcSBn\nZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgLy8gZ2V0IHNlcXVlbmNlIHN0cmF0ZWd5IGZyb20g\nbWV0YWRhdGEKICAgICAgICBpbnQgc3RyYXRlZ3k7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKQogICAgICAgICAgICBzdHJhdGVneSA9IG1ldGEuZ2V0SWRl\nbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Ry\nYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOwoKICAgICAgICAvLyB3\nZSBjYW4gaGFuZGxlIG5vbi1uYXRpdmUgc3RyYXRlZ2llcyB3aXRob3V0IHRo\nZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkgewog\nICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoKICAg\nICAgICAgICAgICAgIHJldHVybiBVVUlESGV4U2VxLmdldEluc3RhbmNlKCk7\nCiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5H\nOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURTdHJpbmdTZXEuZ2V0SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuU0VR\nVUVOQ0U6CiAgICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIHNtZCA9\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICA/IG1ldGEuZ2V0\nSWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRhKCkKICAgICAgICAgICAgICAgICAg\nICA6IGZtZC5nZXRWYWx1ZVNlcXVlbmNlTWV0YURhdGEoKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBzbWQuZ2V0SW5zdGFuY2UoX2xvYWRlcik7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyB1c2Ugc3RvcmUg\nbWFuYWdlciBmb3IgbmF0aXZlIHNlcXVlbmNlCiAgICAgICAgICAgICAgICBp\nZiAoZm1kID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlz\nIHdpbGwgcmV0dXJuIGEgc2VxdWVuY2UgZXZlbiBmb3IgYXBwIGlkIGNsYXNz\nZXMsCiAgICAgICAgICAgICAgICAgICAgLy8gd2hpY2ggaXMgd2hhdCB3ZSB3\nYW50IGZvciBiYWNrd2FyZHMtY29tcGF0aWJpbGl0eQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0b3JlSWRTZXF1ZW5jZSht\nZXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVy\nbiBfc3RvcmUuZ2V0VmFsdWVTZXF1ZW5jZShmbWQpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9ja2luZwogICAgLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9iamVjdCBvYmosIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nIC8vIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVsIGFsd2F5cyBOT05FCiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9jayhvYmosIF9mYy5nZXRXcml0\nZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9ja1RpbWVvdXQoKSwgY2FsbCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2soT2JqZWN0\nIG9iaiwgaW50IGxldmVsLCBpbnQgdGltZW91dCwgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFu\nYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNz\nQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTE9DSywgb2JqLCBzbSwgY2FsbCkK\nICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKHNtID09\nIG51bGwgfHwgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCB0aW1l\nb3V0LCBudWxsKTsKICAgICAgICAgICAgc20ucmVhZExvY2tlZChsZXZlbCwg\nbGV2ZWwpOyAvLyB1c2Ugc2FtZSBsZXZlbCBmb3IgZnV0dXJlIHdyaXRlCiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7IC8vIGhhdmUgdG8g\nc3luYyBvciBsb2NrIGxldmVsIGFsd2F5cyBOT05FCiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgbG9ja0FsbChvYmpzLCBfZmMuZ2V0V3JpdGVMb2NrTGV2\nZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0KCksCiAgICAgICAgICAgICAgICBj\nYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9j\na0FsbChDb2xsZWN0aW9uIG9ianMsIGludCBsZXZlbCwgaW50IHRpbWVvdXQs\nCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChv\nYmpzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgIGxvY2sob2Jqcy5pdGVy\nYXRvcigpLm5leHQoKSwgbGV2ZWwsIHRpbWVvdXQsIGNhbGwpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3Rp\ndmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMg\nPSBuZXcgQXJyYXlMaXN0KG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgT2Jq\nZWN0IG9iajsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHNt\nID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAg\nICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTE9D\nSywgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICAgICAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5p\nc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNt\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2xtLmxvY2tBbGwoc21z\nLCBsZXZlbCwgdGltZW91dCwgbnVsbCk7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQog\nICAgICAgICAgICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgp\nKS5yZWFkTG9ja2VkKGxldmVsLCBsZXZlbCk7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbm5l\nY3Rpb24KICAgIC8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4g\nY2FuY2VsQWxsKCkgewogICAgICAgIC8vIHRoaXMgbWV0aG9kIGRvZXMgbm90\nIGxvY2ssIHNpbmNlIHdlIHdhbnQgdG8gYWxsb3cgYSBkaWZmZXJlbnQKICAg\nICAgICAvLyB0aHJlYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgb24gYSBsb2Nr\nZWQtdXAgcGVyc2lzdGVuY2UgbWFuYWdlcgoKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgd2UncmUgZmx1\nc2hpbmcsIGhhdmUgdG8gc2V0IHJvbGxiYWNrIG9ubHkgLS0gZG8gdGhpcyBi\nZWZvcmUgd2UKICAgICAgICAgICAgLy8gYXR0ZW1wdCB0byBjYW5jZWwsIGJl\nY2F1c2Ugb3RoZXJ3aXNlIHRoZSBjYW5jZWwgbWlnaHQgY2FzZSB0aGUKICAg\nICAgICAgICAgLy8gdHJhbnNhY3Rpb24gdG8gY29tcGxldGUgYmVmb3JlIHdl\nIGhhdmUgYSBjaGFuY2UgdG8gc2V0IHRoZQogICAgICAgICAgICAvLyByb2xs\nYmFjayBvbmx5IGZsYWcKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX1NUT1JFX0ZMVVNISU5HKSAhPSAwKQogICAgICAgICAgICAgICAgc2V0Um9s\nbGJhY2tPbmx5SW50ZXJuYWwobmV3IFVzZXJFeGNlcHRpb24oKSk7CiAgICAg\nICAgICAgIHJldHVybiBfc3RvcmUuY2FuY2VsQWxsKCk7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Q29ubmVjdGlv\nbigpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKCFfY29u\nZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMKICAgICAgICAgICAgKF9j\nb25mLk9QVElPTl9EQVRBU1RPUkVfQ09OTkVDVElPTikpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiY29u\nbi1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICByZXR1cm4gX3N0b3JlLmdl\ndENsaWVudENvbm5lY3Rpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNDb25uZWN0aW9uKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfUkVUQUlORURfQ09OTikgIT0g\nMDsKICAgIH0KCiAgICAvKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmV0YWlu\nIGNvbm5lY3Rpb24gaWYgd2UgaGF2ZW4ndCBhbHJlYWR5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcmV0YWluQ29ubmVjdGlvbigpIHsKICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfUkVUQUlORURfQ09OTikgPT0gMCkgewogICAg\nICAgICAgICBfc3RvcmUucmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgICAg\nICBfZmxhZ3MgfD0gRkxBR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmVsZWFzZSBjb25u\nZWN0aW9uIGlmIHdlIGhhdmUgcmV0YWluZWQgb25lLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcmVsZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NPTk4pICE9IDApIHsKICAgICAg\nICAgICAgX3N0b3JlLnJlbGVhc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLy8vLy8vLy8KICAgIC8vIENhY2hlCiAgICAvLy8vLy8vLy8K\nCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkT2JqZWN0cygpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlv\nbihnZXRNYW5hZ2VkU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRUcmFuc2FjdGlvbmFsT2JqZWN0cygp\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVj\ndGlvbihnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNh\nY3Rpb25hbE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFu\nYWdlZE9iamVjdENvbGxlY3Rpb24KICAgICAgICAgICAgICAgIChnZXRQZW5k\naW5nVHJhbnNhY3Rpb25hbFN0YXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0RGlydHlPYmplY3RzKCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9u\nKGdldERpcnR5U3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRPcmRlckRpcnR5T2JqZWN0cygpIHsKICAgICAg\nICByZXR1cm4gX29yZGVyRGlydHk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0T3JkZXJEaXJ0eU9iamVjdHMoYm9vbGVhbiBvcmRlcikgewogICAgICAg\nIF9vcmRlckRpcnR5ID0gb3JkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBjb3B5IG9mIGFsbCBtYW5hZ2VkIHN0YXRlIG1hbmFnZXJzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkU3Rh\ndGVzKCkgewogICAgICAgIHJldHVybiBfY2FjaGUuY29weSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rp\nb25hbCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENv\nbGxlY3Rpb24gZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpIHsKICAgICAgICBp\nZiAoX3RyYW5zQ2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIF90cmFuc0Nh\nY2hlLmNvcHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNv\ncHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXREaXJ0eVN0YXRlcygpIHsKICAgICAg\nICBpZiAoX3RyYW5zQ2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAgICAgIHJldHVybiBfdHJh\nbnNDYWNoZS5jb3B5RGlydHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiBhIGNvcHkgb2YgYWxsIHN0YXRlIG1hbmFnZXJzIHdoaWNoIHdpbGwg\nYmVjb21lCiAgICAgKiB0cmFuc2FjdGlvbmFsIHVwb24gdGhlIG5leHQgdHJh\nbnNhY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdl\ndFBlbmRpbmdUcmFuc2FjdGlvbmFsU3RhdGVzKCkgewogICAgICAgIGlmIChf\ncGVuZGluZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlv\nbnMuRU1QVFlfTElTVDsKICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdChf\ncGVuZGluZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hl\nZCBTdGF0ZU1hbmFnZXIgZm9yIHRoZSBpbnN0YW5jZSB0aGF0IGhhZCB0aGUg\nZ2l2ZW4gb2lkLgogICAgICogVGhpcyBtZXRob2QgbXVzdCBub3QgYmUgY2Fs\nbGVkIG11bHRpcGxlIHRpbWVzIGZvciBuZXcgaW5zdGFuY2VzLgogICAgICoK\nICAgICAqIEBwYXJhbSBpZCB0aGUgaWQgcHJldmlvdXNseSB1c2VkIGJ5IHRo\nZSBpbnN0YW5jZQogICAgICogQHBhcmFtIHNtIHRoZSBzdGF0ZSBtYW5hZ2Vy\nIGZvciB0aGUgaW5zdGFuY2U7IGlmIHRoZSBzdGF0ZQogICAgICogbWFuYWdl\nciBpcyB0cmFuc2llbnQsIHdlJ2xsIHN0b3AgbWFuYWdpbmcgdGhlIGluc3Rh\nbmNlOwogICAgICogaWYgaXQgaGFzIHVwZGF0ZWQgaXRzIG9pZCwgd2UnbGwg\ncmUtY2FjaGUgdW5kZXIgdGhlIG5ldyBvaWQKICAgICAqIEBwYXJhbSBzdGF0\ndXMgb25lIG9mIG91ciBTVEFUVVMgY29uc3RhbnRzIGRlc2NyaWJpbmcgd2h5\nIHdlJ3JlCiAgICAgKiBzZXR0aW5nIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAg\nKi8KICAgIHZvaWQgc2V0U3RhdGVNYW5hZ2VyKE9iamVjdCBpZCwgU3RhdGVN\nYW5hZ2VySW1wbCBzbSwgaW50IHN0YXR1cykgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykgewog\nICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfSU5JVDoKICAgICAgICAgICAg\nICAgICAgICBfY2FjaGUuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX1RSQU5TSUVOVDoK\nICAgICAgICAgICAgICAgICAgICBfY2FjaGUucmVtb3ZlKGlkLCBzbSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFNUQVRVU19PSURfQVNTSUdOOgogICAgICAgICAgICAgICAgICAgIF9jYWNo\nZS5hc3NpZ25PYmplY3RJZChpZCwgc20pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfQ09NTUlUX05F\nVzoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUuY29tbWl0TmV3KGlkLCBz\nbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIGJyb2tlciB0aGF0\nIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgYWRk\nZWQgdG8gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4gdGhlIGN1\ncnJlbnQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgYWRkVG9UcmFu\nc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgLy8gd2Ug\nb25seSBhZGQgY2xlYW4gaW5zdGFuY2VzIG5vdzsgZGlydHkgaW5zdGFuY2Vz\nIGFyZSBhZGRlZCBpbgogICAgICAgIC8vIHRoZSBzZXREaXJ0eSBjYWxsYmFj\nawogICAgICAgIGlmIChzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChfdHJhbnNDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3Ry\nYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5\nKTsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVu\nY2UgbWFuYWdlciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3Vs\nZAogICAgICogYmUgcmVtb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2Vz\nIGludm9sdmVkIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLgogICAgICov\nCiAgICB2b2lkIHJlbW92ZUZyb21UcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJ\nbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChfdHJhbnNDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX3RyYW5zQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9k\nZXJlZkNhY2hlICE9IG51bGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICAgICAgX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgZ2l2\nZW4gaW5zdGFuY2UgaGFzIGJlZW4gZGlydGllZC4gVGhpcwogICAgICogbm90\naWZpY2F0aW9uIGlzIGdpdmVuIHdoZW4gYW4gb2JqZWN0IGZpcnN0IHRyYW5z\naXRpb25zIHRvIGEgZGlydHkgc3RhdGUsCiAgICAgKiBhbmQgZXZlcnkgdGlt\nZSB0aGUgb2JqZWN0IGlzIG1vZGlmaWVkIGJ5IHRoZSB1c2VyIHRoZXJlYWZ0\nZXIuCiAgICAgKi8KICAgIHZvaWQgc2V0RGlydHkoU3RhdGVNYW5hZ2VySW1w\nbCBzbSwgYm9vbGVhbiBmaXJzdERpcnR5KSB7CiAgICAgICAgaWYgKHNtLmlz\nUGVyc2lzdGVudCgpKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVT\nSF9SRVFVSVJFRDsKCiAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwg\nJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAo\nX3NhdmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2\nZXBvaW50Q2FjaGUgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfc2F2\nZXBvaW50Q2FjaGUuYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIGlmIChm\naXJzdERpcnR5ICYmIHNtLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAg\nICAgIGxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIC8vIGNhY2hlIGRpcnR5IGluc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAo\nX3RyYW5zQ2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfdHJh\nbnNDYWNoZSA9IG5ldyBUcmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkp\nOwogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUuYWRkRGlydHkoc20pOwoK\nICAgICAgICAgICAgICAgIC8vIGFsc28gcmVjb3JkIHRoYXQgdGhlIGNsYXNz\nIGlzIGRpcnR5CiAgICAgICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG5l\ndyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENs\nc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc20uaXNEZWxldGVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9kZWxldGVkQ2xzcyA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzLmFk\nZChzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChf\ndXBkYXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nX3VwZGF0ZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAg\nICAgICBfdXBkYXRlZENsc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAvLyBpZiB0cmFja2luZyBjaGFuZ2VzIGFuZCB0aGlzIGluc3RhbmNl\nIHdhc24ndCBhbHJlYWR5IGRpcnR5LAogICAgICAgICAgICAgICAgLy8gYWRk\nIHRvIGNoYW5nZWQgc2V0OyB3ZSB1c2UgdGhpcyBmb3IgZGV0ZWN0aW5nIGlu\nc3RhbmNlcyB0aGF0CiAgICAgICAgICAgICAgICAvLyBlbnRlciB0aGUgdHJh\nbnNhY3Rpb24gZHVyaW5nIHByZSBzdG9yZQogICAgICAgICAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoX3RyYW5zQWRkaXRpb25zID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG5ldyBIYXNo\nU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zLmFk\nZChzbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgYnJv\na2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAg\nKiBiZSBhZGRlZCB0byB0aGUgc2V0IG9mIGluc3RhbmNlcyB0aGF0IHdpbGwg\nYmVjb21lIHRyYW5zYWN0aW9uYWwKICAgICAqIG9uIHRoZSBuZXh0IHRyYW5z\nYWN0aW9uCiAgICAgKi8KICAgIHZvaWQgYWRkVG9QZW5kaW5nVHJhbnNhY3Rp\nb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9wZW5kaW5nID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgX3BlbmRpbmcuYWRkKHNtKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBOb3RpZnkgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgdGhh\ndCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAqIGJlIHJl\nbW92ZWQgZnJvbSB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZlZCBpbiB0\naGUgbmV4dCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgdm9pZCByZW1vdmVG\ncm9tUGVuZGluZ1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKF9wZW5kaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfcGVuZGluZy5y\nZW1vdmUoc20pOwogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVs\nbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICBfZGVy\nZWZDYWNoZS5yZW1vdmUoc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBhIGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0IHRvIHRo\nZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyJ3MgY2FjaGUuCiAgICAgKiBPbiBmbHVz\naCwgdGhlc2Ugb2JqZWN0cyB3aWxsIGJlIGRlbGV0ZWQuCiAgICAgKi8KICAg\nIHZvaWQgYWRkRGVyZWZlcmVuY2VkRGVwZW5kZW50KFN0YXRlTWFuYWdlcklt\ncGwgc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBmbHVzaCBhbmQg\naW50cm9kdWNpbmcgbW9yZSBkZXJlZnMKICAgICAgICAgICAgLy8gdmlhIGlu\nc3RhbmNlIGNhbGxiYWNrcywgYWRkIHRoZW0gdG8gdGhlIHNwZWNpYWwgYWRk\naXRpb25zIHNldAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfREVS\nRUZERUxFVElORykgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9kZXJl\nZkFkZGl0aW9ucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9kZXJl\nZkFkZGl0aW9ucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICBf\nZGVyZWZBZGRpdGlvbnMuYWRkKHNtKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlLmFkZChzbSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSB0aGUgZ2l2ZW4gcHJldmlvdXNseSBkZXJlZmVyZW5jZWQgZGVwZW5k\nZW50IG9iamVjdCBmcm9tIHRoZQogICAgICogY2FjaGUuIEl0IGlzIG5vdyBy\nZWZlcmVuY2VkLgogICAgICovCiAgICB2b2lkIHJlbW92ZURlcmVmZXJlbmNl\nZERlcGVuZGVudChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmVtb3Zl\nZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZW1vdmVkID0gX2RlcmVmQWRkaXRp\nb25zLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmICghcmVtb3ZlZCAmJiAo\nX2RlcmVmQ2FjaGUgPT0gbnVsbCB8fCAhX2RlcmVmQ2FjaGUucmVtb3ZlKHNt\nKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJub3QtZGVyZWZlZCIsCiAgICAgICAgICAgICAg\nICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSkpKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qo\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpLgogICAgICAgICAgICAgICAgICAg\nIHNldEZhdGFsKHRydWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBkaXJ0eVR5cGUoQ2xhc3MgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3Vw\nZGF0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICBfdXBkYXRlZENs\nc3MgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfdXBkYXRlZENsc3Mu\nYWRkKGNscyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGdldFBlcnNpc3RlZFR5cGVzKCkgewogICAgICAgIGlmIChfcGVy\nc2lzdGVkQ2xzcyA9PSBudWxsIHx8IF9wZXJzaXN0ZWRDbHNzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nCiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxl\nY3Rpb24oX3BlcnNpc3RlZENsc3MpOwogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGdldFVwZGF0ZWRUeXBlcygpIHsKICAgICAgICBpZiAoX3VwZGF0\nZWRDbHNzID09IG51bGwgfHwgX3VwZGF0ZWRDbHNzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24o\nX3VwZGF0ZWRDbHNzKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBn\nZXREZWxldGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9\nPSBudWxsIHx8IF9kZWxldGVkQ2xzcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgICAgIHJldHVy\nbiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0aW9uKF9kZWxldGVk\nQ2xzcyk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIENsb3NpbmcK\nICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZWQo\nKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZWQ7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNDbG9zZUludm9rZWQoKSB7CiAgICAgICAgcmV0dXJuIF9j\nbG9zZWQgfHwgKF9mbGFncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGNsb3NpbmcgaW4gYW4gYWN0aXZl\nIGxvY2FsIHRyYW5zCiAgICAgICAgICAgIGlmICghX21hbmFnZWQgJiYgKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiYWN0aXZl\nIikpOwoKICAgICAgICAgICAgLy8gb25seSBjbG9zZSBpZiBub3QgYWN0aXZl\nOyBpZiBhY3RpdmUgbWFuYWdlZCB0cmFucyB3YWl0CiAgICAgICAgICAgIC8v\nIGZvciBjb21wbGV0aW9uCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0NM\nT1NFX0lOVk9LRUQ7CgogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZyZWUgdGhlIHJlc291cmNl\ncyB1c2VkIGJ5IHRoaXMgcGVyc2lzdGVuY2UgbWFuYWdlci4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgZnJlZSgpIHsKICAgICAgICBSdW50aW1lRXhj\nZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgaWYgKChfYXV0b0RldGFjaCAm\nIERFVEFDSF9DTE9TRSkgIT0gMCkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwoX2NhbGwpOwogICAgICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgICAgICBlcnIgPSByZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgX3N5bmMgPSBudWxsOwogICAgICAgIF91c2VyT2JqZWN0cyA9IG51\nbGw7CiAgICAgICAgX2NhY2hlLmNsZWFyKCk7CiAgICAgICAgX3RyYW5zQ2Fj\naGUgPSBudWxsOwogICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbnVsbDsKICAg\nICAgICBfdXBkYXRlZENsc3MgPSBudWxsOwogICAgICAgIF9kZWxldGVkQ2xz\ncyA9IG51bGw7CiAgICAgICAgX2RlcmVmQ2FjaGUgPSBudWxsOwogICAgICAg\nIF9wZW5kaW5nID0gbnVsbDsKICAgICAgICBfbG9hZGVyID0gbnVsbDsKICAg\nICAgICBfdHJhbnNFdmVudE1hbmFnZXIgPSBudWxsOwogICAgICAgIF9saWZl\nRXZlbnRNYW5hZ2VyID0gbnVsbDsKCiAgICAgICAgT3BlbkpQQVNhdmVwb2lu\ndCBzYXZlOwogICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cyAhPSBudWxsICYm\nICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgc2F2ZSA9\nCiAgICAgICAgICAgICAgICAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2lu\ndHMucmVtb3ZlKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAg\nICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBfc2F2\nZXBvaW50cyA9IG51bGw7CiAgICAgICAgX3NhdmVwb2ludENhY2hlID0gbnVs\nbDsKCiAgICAgICAgaWYgKF9xdWVyaWVzICE9IG51bGwpIHsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBfcXVlcmllcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAoKFF1ZXJ5KSBpdHIubmV4dCgpKS5jbG9zZVJlc291\ncmNlcygpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9xdWVyaWVzID0gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIGlmIChfZXh0ZW50cyAhPSBudWxsKSB7CiAgICAgICAgICAgIEV4dGVudCBl\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9leHRlbnRzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBl\nID0gKEV4dGVudCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgZS5jbG9zZUFsbCgpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9leHRlbnRz\nID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHRyeSB7IHJlbGVhc2VDb25u\nZWN0aW9uKCk7IH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHt9Cgog\nICAgICAgIF9sbS5jbG9zZSgpOwogICAgICAgIF9zdG9yZS5jbG9zZSgpOwog\nICAgICAgIF9mbGFncyA9IDA7CiAgICAgICAgX2Nsb3NlZCA9IHRydWU7CiAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nX2Nsb3NlZEV4Y2VwdGlvbiA9IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24o\nKTsKCiAgICAgICAgaWYgKGVyciAhPSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBlcnI7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nU3luY2hyb25pemF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHVibGljIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVs\nbCkKICAgICAgICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkK\nICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRlIG1hbmFnZW1lbnQKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBuZXdJbnN0\nYW5jZShDbGFzcyBjbHMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAg\nICAgIGlmIChjbHMuaXNJbnRlcmZhY2UoKSkgewogICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJ\nbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBf\nbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgY2xzID0gbWV0YS5nZXRJbnRl\ncmZhY2VJbXBsKCk7CiAgICAgICAgfSBlbHNlIGlmIChNb2RpZmllci5pc0Fi\nc3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgKCJuZXctYWJzdHJhY3QiLCBjbHMpLmdldE1lc3Nh\nZ2UoKSk7CgogICAgICAgIC8vIDEuNSBkb2Vzbid0IGluaXRpYWxpemUgY2xh\nc3NlcyB3aXRob3V0IGEgdHJ1ZSBDbGFzcy5mb3JOYW1lCiAgICAgICAgaWYg\nKCFQQ1JlZ2lzdHJ5LmlzUmVnaXN0ZXJlZChjbHMpKSB7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNscy5nZXRO\nYW1lKCksIHRydWUsIGNscy5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShj\nbHMsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndE9iamVjdElkKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJs\nZSkKICAgICAgICAgICAgcmV0dXJuICgoUGVyc2lzdGVuY2VDYXBhYmxlKSBv\nYmopLnBjRmV0Y2hPYmplY3RJZCgpOwogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja0xldmVsKE9iamVjdCBvKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGdldFN0YXRlTWFuYWdl\ncihvKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgICAgIHJldHVybiBnZXRM\nb2NrTWFuYWdlcigpLmdldExvY2tMZXZlbChzbSk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBnZXRWZXJzaW9uKE9iamVjdCBvYmopIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFBlcnNp\nc3RlbmNlQ2FwYWJsZSkKICAgICAgICAgICAgcmV0dXJuICgoUGVyc2lzdGVu\nY2VDYXBhYmxlKSBvYmopLnBjR2V0VmVyc2lvbigpOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoT2Jq\nZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAo\nb2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAg\nICByZXR1cm4gKChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iaikucGNJc0RpcnR5\nKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzVHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBQZXJz\naXN0ZW5jZUNhcGFibGUpCiAgICAgICAgICAgIHJldHVybiAoKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSkgb2JqKS5wY0lzVHJhbnNhY3Rpb25hbCgpOwogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1Bl\ncnNpc3RlbnQoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxl\nKQogICAgICAgICAgICByZXR1cm4gKChQZXJzaXN0ZW5jZUNhcGFibGUpIG9i\naikucGNJc1BlcnNpc3RlbnQoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNOZXcoT2JqZWN0IG9iaikgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAob2JqIGluc3RhbmNl\nb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAgICByZXR1cm4gKChQ\nZXJzaXN0ZW5jZUNhcGFibGUpIG9iaikucGNJc05ldygpOwogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlbGV0\nZWQoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICBpZiAob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQogICAg\nICAgICAgICByZXR1cm4gKChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iaikucGNJ\nc0RlbGV0ZWQoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNEZXRhY2hlZChPYmplY3Qgb2JqKSB7CiAgICAg\nICAgaWYgKCEob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvYmo7CiAgICAg\nICAgQm9vbGVhbiBkZXRhY2hlZCA9IHBjLnBjSXNEZXRhY2hlZCgpOwogICAg\nICAgIGlmIChkZXRhY2hlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZGV0YWNoZWQuYm9vbGVhblZhbHVlKCk7CgogICAgICAgIC8vIGxhc3QgcmVz\nb3J0OiBpbnN0YW5jZSBpcyBkZXRhY2hlZCBpZiBpdCBoYXMgYSBzdG9yZSBy\nZWNvcmQKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRN\nZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRN\nZXRhRGF0YShwYy5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAg\nICBPYmplY3Qgb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKHBjLCBtZXRh\nKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICByZXR1cm4gZmluZChvaWQsIG51bGwsIEVYQ0xV\nREVfQUxMLCBudWxsLCAwKSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIGdldFN0YXRlTWFuYWdlcihPYmplY3Qgb2Jq\nKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBnZXRT\ndGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4g\naW5zdGFuY2UsIG9yIG51bGwuCiAgICAgKgogICAgICogQHBhcmFtIGFzc2Vy\ndFRoaXNDb250ZXh0IGlmIHRydWUsIHRob3cgYW4gZXhjZXB0aW9uIGlmIHRo\nZSBnaXZlbgogICAgICogb2JqZWN0IGlzIG1hbmFnZWQgYnkgYW5vdGhlciBi\ncm9rZXIKICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwg\nZ2V0U3RhdGVNYW5hZ2VySW1wbChPYmplY3Qgb2JqLAogICAgICAgIGJvb2xl\nYW4gYXNzZXJ0VGhpc0NvbnRleHQpIHsKICAgICAgICBpZiAob2JqIGluc3Rh\nbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKSB7CiAgICAgICAgICAgIFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iajsK\nICAgICAgICAgICAgaWYgKHBjLnBjR2V0R2VuZXJpY0NvbnRleHQoKSA9PSB0\naGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIChTdGF0ZU1hbmFnZXJJbXBs\nKSBwYy5wY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAgICAgICBpZiAoYXNz\nZXJ0VGhpc0NvbnRleHQgJiYgcGMucGNHZXRHZW5lcmljQ29udGV4dCgpICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm90LW1hbmFnZWQiLAogICAgICAgICAgICAgICAgICAg\nIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChv\nYmopOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGdpdmVuIG9pZC4KICAgICAqCiAgICAgKiBAcGFyYW0gYWxsb3dOZXcgaWYg\ndHJ1ZSwgb2JqZWN0cyBtYWRlIHBlcnNpc3RlbnQgaW4gdGhlIGN1cnJlbnQK\nICAgICAqIHRyYW5zYWN0aW9uIHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIHNl\nYXJjaDsgaWYKICAgICAqIG11bHRpcGxlIG5ldyBvYmplY3RzIG1hdGNoIHRo\nZSBnaXZlbiBvaWQsIGl0IGlzCiAgICAgKiB1bmRlZmluZWQgd2hpY2ggd2ls\nbCBiZSByZXR1cm5lZAogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5h\nZ2VySW1wbCBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChPYmplY3Qgb2lkLAog\nICAgICAgIGJvb2xlYW4gYWxsb3dOZXcpIHsKICAgICAgICByZXR1cm4gX2Nh\nY2hlLmdldEJ5SWQob2lkLCBhbGxvd05ldyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGdpdmVuIGluc3RhbmNlIGFzIGEge0BsaW5rIFBl\ncnNpc3RlbmNlQ2FwYWJsZX0uCiAgICAgKiBJZiB0aGUgaW5zdGFuY2UgaXMg\nbm90IG1hbmFnZWFibGUgdGhyb3cgdGhlIHByb3BlciBleGNlcHRpb24uCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgYXNzZXJ0\nUGVyc2lzdGVuY2VDYXBhYmxlKE9iamVjdCBvYmopIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGlmIChvYmogaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZUNhcGFibGUpCiAgICAg\nICAgICAgIHJldHVybiAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvYmo7CgogICAg\nICAgIC8vIGNoZWNrIGZvciBkaWZmZXJlbmNlIGluc3RhbmNlcyBvZiB0aGUg\nUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZQogICAgICAgIC8vIGFuZCB0\naHJvdyBhIGJldHRlciBlcnJvciB0aGF0IG1lbnRpb25zIHRoZSBjbGFzcyBs\nb2FkZXJzCiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9IG9iai5nZXRDbGFzcygp\nLmdldEludGVyZmFjZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW50\nZnMgIT0gbnVsbCAmJiBpIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKGludGZzW2ldLmdldE5hbWUoKS5lcXVhbHMoUGVyc2lzdGVu\nY2VDYXBhYmxlLmNsYXNzLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1sb2FkZXIt\nZGlmZmVyZW50IiwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRv\nU3RyaW5nKG9iaiksCiAgICAgICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlLmNsYXNzLmdldENsYXNzTG9hZGVyKCksCiAgICAgICAgICAgICAg\nICAgICAgaW50ZnNbaV0uZ2V0Q2xhc3NMb2FkZXIoKSkpLnNldEZhaWxlZE9i\namVjdChvYmopOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nLyBub3QgZW5oYW5jZWQKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgicGMtY2FzdCIsCiAgICAgICAgICAgIEV4Y2VwdGlvbnMu\ndG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQoK\nICAgIC8vLy8vLy8vLwogICAgLy8gVXRpbHMKICAgIC8vLy8vLy8vLwogICAg\nLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gaWYgdGhlIGNvbnRleHQg\naXMgY2xvc2VkLiAgVGhlIGV4YWN0IG1lc3NhZ2UgYW5kCiAgICAgKiBjb250\nZW50IG9mIHRoZSBleGNlcHRpb24gdmFyaWVzIHdoZXRoZXIgVFJBQ0UgaXMg\nZW5hYmxlZCBvciBub3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzc2Vy\ndE9wZW4oKSB7CiAgICAgICAgaWYgKF9jbG9zZWQpIHsKICAgICAgICAgICAg\naWYgKF9jbG9zZWRFeGNlcHRpb24gPT0gbnVsbCkgIC8vIFRSQUNFIG5vdCBl\nbmFibGVkCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJjbG9zZWQtbm90cmFjZSIpKQogICAgICAg\nICAgICAgICAgICAgICAgICAuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQoImNsb3NlZCIpLAogICAgICAgICAgICAgICAg\nICAgICAgICBfY2xvc2VkRXhjZXB0aW9uKS5zZXRGYXRhbCh0cnVlKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYXNzZXJ0QWN0aXZlVHJh\nbnNhY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElW\nRSkgPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rpb25F\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1hY3RpdmUiKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaHJvdyBleGNlcHRpb24gaWYgYSB0cmFuc2FjdGlvbi1y\nZWxhdGVkIG9wZXJhdGlvbiBpcyBhdHRlbXB0ZWQgYW5kCiAgICAgKiBubyB0\ncmFuc2FjdGlvbiBpcyBhY3RpdmUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0\naXZlIikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE5vbnRyYW5z\nYWN0aW9uYWxSZWFkKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDAgJiYgIV9ub250cmFuc1JlYWQpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vbi10\ncmFucy1yZWFkIikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydFdy\naXRlT3BlcmF0aW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDAgJiYgKCFfbm9udHJhbnNXcml0ZQogICAgICAgICAgICB8\nfCAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAhPSAwKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rpb25FeGNlcHRpb24oX2xv\nYy5nZXQoIndyaXRlLW9wZXJhdGlvbiIpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhbiBvYmplY3Qgbm90IGZvdW5kIGV4Y2VwdGlvbiBjb250\nYWluaW5nIG5lc3RlZCBleGNlcHRpb25zCiAgICAgKiBmb3IgYWxsIG9mIHRo\nZSBnaXZlbiBmYWlsZWQgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gbmV3T2JqZWN0Tm90Rm91\nbmRFeGNlcHRpb24KICAgICAgICAoQ29sbGVjdGlvbiBmYWlsZWQpIHsKICAg\nICAgICBUaHJvd2FibGVbXSB0ID0gbmV3IFRocm93YWJsZVtmYWlsZWQuc2l6\nZSgpXTsKICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IGZhaWxlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBp\nZHgrKykKICAgICAgICAgICAgdFtpZHhdID0gbmV3IE9iamVjdE5vdEZvdW5k\nRXhjZXB0aW9uKGl0ci5uZXh0KCkpOwogICAgICAgIHJldHVybiBuZXcgT2Jq\nZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkLCB0KTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRmluZENh\nbGxiYWNrcyBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NBcmd1\nbWVudChPYmplY3Qgb2lkKSB7CiAgICAgICAgcmV0dXJuIG9pZDsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NSZXR1cm4oT2JqZWN0IG9pZCwg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHJldHVybiAoc20g\nPT0gbnVsbCkgPyBudWxsIDogc20uZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBvZiBtYW5hZ2VkIG9iamVjdHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1hbmFnZWRDYWNo\nZSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWFwIF9tYWluOyAvLyBvaWQg\nLT4gc20KICAgICAgICBwcml2YXRlIE1hcCBfY29uZmxpY3RzID0gbnVsbDsg\nLy8gY29uZmxpY3Qgb2lkIC0+IG5ldyBzbQogICAgICAgIHByaXZhdGUgTWFw\nIF9uZXdzID0gbnVsbDsgLy8gdG1wIGlkIC0+IG5ldyBzbQogICAgICAgIHBy\naXZhdGUgQ29sbGVjdGlvbiBfZW1iZWRzID0gbnVsbDsgLy8gZW1iZWRkZWQv\nbm9uLXBlcnNpc3RlbnQgc21zCgogICAgICAgIC8qKgogICAgICAgICAqIENv\nbnN0cnVjdG9yOyBzdXBwbHkgcHJpbWFyeSBjYWNoZSBtYXAuCiAgICAgICAg\nICovCiAgICAgICAgcHVibGljIE1hbmFnZWRDYWNoZShNYXAgY2FjaGUpIHsK\nICAgICAgICAgICAgX21haW4gPSBjYWNoZTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5zdGFuY2UgZm9yIHRoZSBn\naXZlbiBvaWQsIG9wdGlvbmFsbHkgYWxsb3dpbmcKICAgICAgICAgKiBuZXcg\naW5zdGFuY2VzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTdGF0ZU1h\nbmFnZXJJbXBsIGdldEJ5SWQoT2JqZWN0IG9pZCwgYm9vbGVhbiBhbGxvd05l\ndykgewogICAgICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIGNoZWNrIG1haW4g\nY2FjaGUgZm9yIG9pZAogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLmdldChvaWQpOwogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtMjsKICAgICAgICAgICAgaWYgKHNt\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgYSBuZXcg\naW5zdGFuY2UsIHdlIGtub3cgaXQncyB0aGUgb25seSBtYXRjaCwgYmVjYXVz\nZQogICAgICAgICAgICAgICAgLy8gb3RoZXIgcGVycyBpbnN0YW5jZXMgb3Zl\ncnJpZGUgbmV3IGluc3RhbmNlcyBpbiBfY2FjaGUKICAgICAgICAgICAgICAg\nIGlmIChzbS5pc05ldygpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAo\nYWxsb3dOZXcpID8gc20gOiBudWxsOwogICAgICAgICAgICAgICAgaWYgKCFh\nbGxvd05ldyB8fCAhc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAgICAgIC8vIHNtIGlzIGRlbGV0\nZWQ7IGNoZWNrIGNvbmZsaWN0IGNhY2hlCiAgICAgICAgICAgICAgICBpZiAo\nX2NvbmZsaWN0cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgc20y\nID0gKFN0YXRlTWFuYWdlckltcGwpIF9jb25mbGljdHMuZ2V0KG9pZCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHNtMiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gc20yOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhdCB0aGlzIHBvaW50IHNt\nIGlzIG51bGwgb3IgZGVsZXRlZDsgY2hlY2sgdGhlIG5ldyBjYWNoZSBmb3IK\nICAgICAgICAgICAgLy8gYW55IG1hdGNoZXMuIHRoaXMgYWxsb3dzIHVzIHRv\nIG1hdGNoIGFwcCBpZCBvYmplY3RzIHRvIG5ldwogICAgICAgICAgICAvLyBp\nbnN0YW5jZXMgd2l0aG91dCBwZXJtYW5hbnQgb2lkcwogICAgICAgICAgICBp\nZiAoYWxsb3dOZXcgJiYgX25ld3MgIT0gbnVsbCAmJiAhX25ld3MuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICBzbTIgPSAoU3RhdGVNYW5hZ2VySW1w\nbCkgX25ld3MuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAoc20yICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtMjsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBDYWxsIHRoaXMgbWV0aG9kIHdoZW4gYSBu\nZXcgc3RhdGUgbWFuYWdlciBpbml0aWFsaXplcyBpdHNlbGYuCiAgICAgICAg\nICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkKFN0YXRlTWFuYWdlckltcGwg\nc20pIHsKICAgICAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSB8fCBz\nbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgIGlmIChfZW1iZWRz\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2VtYmVkcyA9IG5ldyBS\nZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7CiAgICAg\nICAgICAgICAgICBfZW1iZWRzLmFkZChzbSk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGluaXRpYWxp\nemluZyBuZXcgaW5zdGFuY2U7IHB1dCBpbiBuZXcgY2FjaGUgYmVjYXVzZSB3\nb24ndCBoYXZlCiAgICAgICAgICAgIC8vIHBlcm1hbmVudCBvaWQgeWV0CiAg\nICAgICAgICAgIGlmIChzbS5pc05ldygpKSB7CiAgICAgICAgICAgICAgICBp\nZiAoX25ld3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfbmV3cyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICBfbmV3cy5wdXQoc20u\nZ2V0SWQoKSwgc20pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFsaXppbmcgcGVyc2lzdGVu\ndCBpbnN0YW5jZTsgcHV0IGluIG1haW4gY2FjaGUKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWlu\nLnB1dAogICAgICAgICAgICAgICAgKHNtLmdldE9iamVjdElkKCksIHNtKTsK\nICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIG9yaWcpOwogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImR1\ncC1sb2FkIiwKICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgp\nLCBFeGNlcHRpb25zLnRvU3RyaW5nCiAgICAgICAgICAgICAgICAgICAgKG9y\naWcuZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAgICAgICAgICAgICAg\nICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmVtb3ZlIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIGZyb20gdGhlIGNh\nY2hlIHdoZW4gaXQgdHJhbnNpdGlvbnMKICAgICAgICAgKiB0byB0cmFuc2ll\nbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKE9i\namVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICAv\nLyBpZiBpdCBoYXMgYSBwZXJtYW5lbnQgb2lkLCByZW1vdmUgZnJvbSBtYWlu\nIC8gY29uZmxpY3QgY2FjaGUsCiAgICAgICAgICAgIC8vIGVsc2UgcmVtb3Zl\nIGZyb20gZW1iZWRkZWQvbm9udHJhbnMgY2FjaGUsIGFuZCBpZiBub3QgdGhl\ncmUKICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gbmV3IGNhY2hlCiAgICAg\nICAgICAgIE9iamVjdCBvcmlnOwogICAgICAgICAgICBpZiAoc20uZ2V0T2Jq\nZWN0SWQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBvcmlnID0gX21h\naW4ucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgIGlmIChvcmlnICE9IHNt\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgX21haW4ucHV0KGlkLCBvcmlnKTsgLy8g\ncHV0IGJhY2sKICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbmZsaWN0cyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWcgPSBfY29u\nZmxpY3RzLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChvcmlnICE9IG51bGwgJiYgb3JpZyAhPSBzbSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9jb25mbGljdHMucHV0KGlkLCBvcmlnKTsgLy8gcHV0\nIGJhY2sKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpZiAoKF9lbWJlZHMg\nPT0gbnVsbCB8fCAhX2VtYmVkcy5yZW1vdmUoc20pKSAmJiBfbmV3cyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBvcmlnID0gX25ld3MucmVtb3ZlKGlk\nKTsKICAgICAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwgJiYgb3JpZyAh\nPSBzbSkKICAgICAgICAgICAgICAgICAgICBfbmV3cy5wdXQoaWQsIG9yaWcp\nOyAvLyBwdXQgYmFjawogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBBbiBlbWJlZGRlZCBvciBub25wZXJzaXN0ZW50\nIG1hbmFnZWQgaW5zdGFuY2UgaGFzIGJlZW4gcGVyc2lzdGVkLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgICAgICBpZiAoX2VtYmVkcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2VtYmVkcy5yZW1vdmUoc20pOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogQSBuZXcgaW5zdGFuY2UgaGFzIGp1\nc3QgYmVlbiBhc3NpZ25lZCBhIHBlcm1hbmVudCBvaWQuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgYXNzaWduT2JqZWN0SWQoT2JqZWN0IGlk\nLCBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIC8vIGlmIGFz\nc2lnbmluZyBvaWQsIHJlbW92ZSBmcm9tIG5ldyBjYWNoZSBhbmQgcHV0IGlu\nIHByaW1hcnk7IG1heQogICAgICAgICAgICAvLyBub3QgYmUgaW4gbmV3IGNh\nY2hlIGlmIGFub3RoZXIgbmV3IGluc3RhbmNlIGhhZCBzYW1lIGlkCiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3JpZyA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBfbmV3cy5yZW1vdmUoaWQpOwogICAgICAgICAgICBpZiAob3JpZyAh\nPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAgICAgICAgICBfbmV3cy5w\ndXQoaWQsIG9yaWcpOyAvLyBwdXQgYmFjawoKICAgICAgICAgICAgLy8gcHV0\nIGluIG1haW4gY2FjaGUsIGJ1dCBtYWtlIHN1cmUgd2UgZG9uJ3QgcmVwbGFj\nZSBhbm90aGVyCiAgICAgICAgICAgIC8vIGluc3RhbmNlIHdpdGggdGhlIHNh\nbWUgb2lkCiAgICAgICAgICAgIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkg\nX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIHNtKTsKICAgICAgICAgICAg\naWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX21haW4ucHV0\nKHNtLmdldE9iamVjdElkKCksIG9yaWcpOwogICAgICAgICAgICAgICAgaWYg\nKCFvcmlnLmlzRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE9iamVjdElkKCksIEV4\nY2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgKHNt\nLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAgICAgICAg\nICAgICBzZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkp\nOwoKICAgICAgICAgICAgICAgIC8vIHNhbWUgb2lkIGFzIGRlbGV0ZWQgaW5z\ndGFuY2U7IHB1dCBpbiBjb25mbGljdCBjYWNoZQogICAgICAgICAgICAgICAg\naWYgKF9jb25mbGljdHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nY29uZmxpY3RzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9j\nb25mbGljdHMucHV0KHNtLmdldE9iamVjdElkKCksIHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQSBuZXcg\naW5zdGFuY2UgaGFzIGNvbW1pdHRlZDsgcmVjYWNoZSB1bmRlciBwZXJtYW5l\nbnQgb2lkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNvbW1p\ndE5ldyhPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICAgICAgLy8gaWYgdGhlIGlkIGRpZG4ndCBjaGFuZ2UsIHRoZSBpbnN0YW5j\nZSB3YXMgYWxyZWFkeSBhc3NpZ25lZCBhbgogICAgICAgICAgICAvLyBpZCwg\nYnV0IGl0IGNvdWxkIGhhdmUgYmVlbiBpbiBjb25mbGljdCBjYWNoZQogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWc7CiAgICAgICAgICAgIGlm\nIChzbS5nZXRPYmplY3RJZCgpID09IGlkKSB7CiAgICAgICAgICAgICAgICBv\ncmlnID0gKF9jb25mbGljdHMgPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAg\nICAgICAgICAgOiAoU3RhdGVNYW5hZ2VySW1wbCkgX2NvbmZsaWN0cy5yZW1v\ndmUoaWQpOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gc20pIHsKICAg\nICAgICAgICAgICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9t\nYWluLnB1dChpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGlmIChvcmln\nICE9IG51bGwgJiYgIW9yaWcuaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIG9yaWcp\nOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgiZHVwLW9pZC1hc3NpZ24iLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0aW9ucy50\nb1N0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNtLmdldE1h\nbmFnZWRJbnN0YW5jZSgpKSkpLnNldEZhaWxlZE9iamVjdAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKS5z\nZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIG9pZCBjaGFuZ2VkLCBzbyBpdCBtdXN0IHBy\nZXZpb3VzbHkgaGF2ZSBiZWVuIGEgbmV3IGluc3RhbmNlCiAgICAgICAgICAg\nIC8vIHdpdGhvdXQgYW4gYXNzaWduZWQgb2lkLiAgcmVtb3ZlIGl0IGZyb20g\ndGhlIG5ldyBjYWNoZTsgb2sgaWYKICAgICAgICAgICAgLy8gd2UgZW5kIHVw\nIHJlbW92aW5nIGFub3RoZXIgaW5zdGFuY2Ugd2l0aCBzYW1lIGlkCiAgICAg\nICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAgICAgICAgX25l\nd3MucmVtb3ZlKGlkKTsKCiAgICAgICAgICAgIC8vIGFuZCBwdXQgaW50byBt\nYWluIGNhY2hlIG5vdyB0aGF0IGlkIGlzIGFzc3NpZ25lZAogICAgICAgICAg\nICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLnB1dChzbS5nZXRP\nYmplY3RJZCgpLCBzbSk7CiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwg\nJiYgb3JpZyAhPSBzbSAmJiAhb3JpZy5pc0RlbGV0ZWQoKSkgewogICAgICAg\nICAgICAgICAgLy8gcHV0IGJhY2sgb3JpZyBhbmQgdGhyb3cgZXJyb3IKICAg\nICAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgpLCBvcmln\nKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIsCiAgICAgICAgICAgICAgICAgICAg\nc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAg\nICAgICAgICAgICAgIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS5zZXRG\nYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAoc20uZ2V0TWFuYWdl\nZEluc3RhbmNlKCkpLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBjb3B5\nIG9mIGFsbCBjYWNoZWQgcGVyc2lzdGVudCBvYmplY3RzLgogICAgICAgICAq\nLwogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHkoKSB7CiAgICAgICAg\nICAgIC8vIHByb3hpZXMgbm90IGluY2x1ZGVkIGhlcmUgYmVjYXVzZSB0aGUg\nc3RhdGUgbWFuYWdlciBpcyBhbHdheXMKICAgICAgICAgICAgLy8gcHJlc2Vu\ndCBpbiBvdGhlciBjYWNoZXMgdG9vCgogICAgICAgICAgICBpbnQgc2l6ZSA9\nIF9tYWluLnNpemUoKTsKICAgICAgICAgICAgaWYgKF9jb25mbGljdHMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2NvbmZsaWN0cy5zaXpl\nKCk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgc2l6ZSArPSBfbmV3cy5zaXplKCk7CiAgICAgICAgICAgIGlmIChf\nZW1iZWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBzaXplICs9IF9lbWJl\nZHMuc2l6ZSgpOwogICAgICAgICAgICBpZiAoc2l6ZSA9PSAwKQogICAgICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAg\nICAgICAgICBMaXN0IGNvcHkgPSBuZXcgQXJyYXlMaXN0KHNpemUpOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9tYWluLnZhbHVlcygpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgY29w\neS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChfY29uZmxpY3Rz\nICE9IG51bGwgJiYgIV9jb25mbGljdHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfY29uZmxpY3RzLnZhbHVlcygp\nLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgaXRyLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7\nCiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsICYmICFfbmV3cy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9u\nZXdzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAg\nICAgICBpZiAoX2VtYmVkcyAhPSBudWxsICYmICFfZW1iZWRzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2VtYmVk\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgcmV0dXJu\nIGNvcHk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDbGVh\nciB0aGUgY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgICAgIF9tYWluLmNsZWFyKCk7CiAgICAgICAg\nICAgIGlmIChfY29uZmxpY3RzICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nY29uZmxpY3RzLmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX25ld3MuY2xlYXIoKTsKICAgICAgICAg\nICAgaWYgKF9lbWJlZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9lbWJl\nZHMuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIENsZWFyIG5ldyBpbnN0YW5jZXMgd2l0aG91dCBwZXJtYW5lbnQgb2lkcy4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBjbGVhck5ldygpIHsK\nICAgICAgICAgICAgaWYgKF9uZXdzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfbmV3cy5jbGVhcigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRyYW5zYWN0aW9uYWwgY2FjaGUgdGhhdCBob2xkcyBzb2Z0IHJlZnMg\ndG8gY2xlYW4gaW5zdGFuY2VzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBjbGFzcyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICBpbXBsZW1lbnRz\nIFNldCB7CgogICAgICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfb3JkZXJE\naXJ0eTsKICAgICAgICBwcml2YXRlIFNldCBfZGlydHkgPSBudWxsOwogICAg\nICAgIHByaXZhdGUgU2V0IF9jbGVhbiA9IG51bGw7CgogICAgICAgIHB1Ymxp\nYyBUcmFuc2FjdGlvbmFsQ2FjaGUoYm9vbGVhbiBvcmRlckRpcnR5KSB7CiAg\nICAgICAgICAgIF9vcmRlckRpcnR5ID0gb3JkZXJEaXJ0eTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxs\nIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIENvbGxlY3Rpb24gY29weSgpIHsKICAgICAgICAgICAg\naWYgKGlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0\naW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAgICAgLy8gc2l6ZSBtYXkgbm90\nIGJlIGVudGlyZWx5IGFjY3VyYXRlIGR1ZSB0byByZWZzIGV4cGlyaW5nLCBz\nbwogICAgICAgICAgICAvLyBtYW51YWxseSBjb3B5IGVhY2ggb2JqZWN0OyBk\nb2Vzbid0IG1hdHRlciB0aGlzIHdheSBpZiBzaXplIHRvbwogICAgICAgICAg\nICAvLyBiaWcgYnkgc29tZQogICAgICAgICAgICBMaXN0IGNvcHkgPSBuZXcg\nQXJyYXlMaXN0KHNpemUoKSk7CiAgICAgICAgICAgIGlmIChfZGlydHkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2Rp\ncnR5Lml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAo\nX2NsZWFuICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9jbGVhbi5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAg\nICAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAg\nICAgICAgcmV0dXJuIGNvcHk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBkaXJ0eSBzdGF0ZSBtYW5h\nZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBj\nb3B5RGlydHkoKSB7CiAgICAgICAgICAgIGlmIChfZGlydHkgPT0gbnVsbCB8\nfCBfZGlydHkuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nQXJyYXlMaXN0KF9kaXJ0eSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBUcmFuc2ZlciB0aGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSB0aGUg\nZGlydHkgY2FjaGUgdG8gdGhlIGNsZWFuIGNhY2hlLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyB2b2lkIGZsdXNoZWQoU3RhdGVNYW5hZ2VySW1wbCBz\nbSkgewogICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpICYmIF9kaXJ0eSAh\nPSBudWxsICYmIF9kaXJ0eS5yZW1vdmUoc20pKQogICAgICAgICAgICAgICAg\nYWRkQ2xlYW5JbnRlcm5hbChzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBBZGQgdGhlIGdpdmVuIGluc3RhbmNlIHRvIHRoZSBjbGVh\nbiBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGRD\nbGVhbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChh\nZGRDbGVhbkludGVybmFsKHNtKSAmJiBfZGlydHkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9kaXJ0eS5yZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBib29sZWFuIGFkZENsZWFuSW50ZXJuYWwoU3RhdGVNYW5h\nZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoX2NsZWFuID09IG51bGwp\nCiAgICAgICAgICAgICAgICBfY2xlYW4gPSBuZXcgUmVmZXJlbmNlSGFzaFNl\ndChSZWZlcmVuY2VIYXNoU2V0LlNPRlQpOwogICAgICAgICAgICByZXR1cm4g\nX2NsZWFuLmFkZChzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBBZGQgdGhlIGdpdmVuIGluc3RhbmNlIHRvIHRoZSBkaXJ0eSBjYWNo\nZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGREaXJ0eShT\ndGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChfZGlydHkg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9vcmRlckRpcnR5KQog\nICAgICAgICAgICAgICAgICAgIF9kaXJ0eSA9IE1hcEJhY2tlZFNldC5kZWNv\ncmF0ZShuZXcgTGlua2VkTWFwKCkpOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIF9kaXJ0eSA9IG5ldyBIYXNoU2V0KCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9kaXJ0eS5hZGQoc20pKQog\nICAgICAgICAgICAgICAgcmVtb3ZlQ2xlYW5JbnRlcm5hbChzbSk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmUgdGhlIGdpdmVu\nIGluc3RhbmNlIGZyb20gdGhlIGNhY2hlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7\nCiAgICAgICAgICAgIHJldHVybiByZW1vdmVDbGVhbkludGVybmFsKHNtKQog\nICAgICAgICAgICAgICAgfHwgKF9kaXJ0eSAhPSBudWxsICYmIF9kaXJ0eS5y\nZW1vdmUoc20pKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgYm9vbGVh\nbiByZW1vdmVDbGVhbkludGVybmFsKFN0YXRlTWFuYWdlckltcGwgc20pIHsK\nICAgICAgICAgICAgcmV0dXJuIF9jbGVhbiAhPSBudWxsICYmIF9jbGVhbi5y\nZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9y\nIGl0ZXJhdG9yKCkgewogICAgICAgICAgICBJdGVyYXRvckNoYWluIGNoYWlu\nID0gbmV3IEl0ZXJhdG9yQ2hhaW4oKTsKICAgICAgICAgICAgaWYgKF9kaXJ0\neSAhPSBudWxsICYmICFfZGlydHkuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgY2hhaW4uYWRkSXRlcmF0b3IoX2RpcnR5Lml0ZXJhdG9yKCkpOwogICAg\nICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwgJiYgIV9jbGVhbi5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICBjaGFpbi5hZGRJdGVyYXRvcihfY2xlYW4u\naXRlcmF0b3IoKSk7CiAgICAgICAgICAgIHJldHVybiBjaGFpbjsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBv\nYmopIHsKICAgICAgICAgICAgcmV0dXJuIChfZGlydHkgIT0gbnVsbCAmJiBf\nZGlydHkuY29udGFpbnMob2JqKSkKICAgICAgICAgICAgICAgIHx8IChfY2xl\nYW4gIT0gbnVsbCAmJiBfY2xlYW4uY29udGFpbnMob2JqKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWluc0FsbChDb2xsZWN0\naW9uIGNvbGwpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\nb2xsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgaWYgKCFjb250YWlucyhpdHIubmV4dCgpKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAg\nICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9k\naXJ0eS5jbGVhcigpOwogICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfY2xlYW4uY2xlYXIoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAg\nIHJldHVybiAoX2RpcnR5ID09IG51bGwgfHwgX2RpcnR5LmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgICYmIChfY2xlYW4gPT0gbnVsbCB8fCBfY2xlYW4u\naXNFbXB0eSgpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgc2l6\nZSgpIHsKICAgICAgICAgICAgaW50IHNpemUgPSAwOwogICAgICAgICAgICBp\nZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBzaXplICs9IF9k\naXJ0eS5zaXplKCk7CiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHNpemUgKz0gX2NsZWFuLnNpemUoKTsKICAgICAg\nICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBhZGQoT2JqZWN0IG9iaikgewogICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChDb2xsZWN0aW9uIGNv\nbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0\naW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiByZW1vdmUoT2JqZWN0IG9iaikgewogICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChDb2xsZWN0aW9u\nIGNvbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3Bl\ncmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiByZXRhaW5BbGwoQ29sbGVjdGlvbiBjKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRvQXJyYXkoKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4\nY2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdFtd\nIHRvQXJyYXkoT2JqZWN0W10gYXJyKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFVuaXF1ZSBpZCBmb3Igc3RhdGUgbWFu\nYWdlcnMgb2YgbmV3IGRhdGFzdG9yZSBpbnN0YW5jZXMgd2l0aG91dCBhc3Np\nZ25lZAogICAgICogb2JqZWN0IGlkcy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgU3RhdGVNYW5hZ2VySWQKICAgICAgICBpbXBsZW1lbnRz\nIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIFNUUklOR19QUkVGSVggPSAib3BlbmpwYXNtOiI7CgogICAgICAg\nIHByaXZhdGUgc3RhdGljIGxvbmcgX2dlbmVyYXRvciA9IDA7CgogICAgICAg\nIHByaXZhdGUgZmluYWwgaW50IF9iaGFzaDsKICAgICAgICBwcml2YXRlIGZp\nbmFsIGxvbmcgX2lkOwoKICAgICAgICBwdWJsaWMgc3RhdGljIFN0YXRlTWFu\nYWdlcklkIG5ld0luc3RhbmNlKEJyb2tlciBiKSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgU3RhdGVNYW5hZ2VySWQoU3lzdGVtLmlkZW50aXR5SGFzaENv\nZGUoYiksIF9nZW5lcmF0b3IrKyk7CiAgICAgICAgfQoKICAgICAgICBwcml2\nYXRlIFN0YXRlTWFuYWdlcklkKGludCBiaGFzaCwgbG9uZyBpZCkgewogICAg\nICAgICAgICBfYmhhc2ggPSBiaGFzaDsKICAgICAgICAgICAgX2lkID0gaWQ7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RhdGVNYW5hZ2VySWQoU3Ry\naW5nIHN0cikgewogICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKFNU\nUklOR19QUkVGSVgubGVuZ3RoKCkpOwogICAgICAgICAgICBpbnQgaWR4ID0g\nc3RyLmluZGV4T2YoJzonKTsKICAgICAgICAgICAgX2JoYXNoID0gSW50ZWdl\nci5wYXJzZUludChzdHIuc3Vic3RyaW5nKDAsIGlkeCkpOwogICAgICAgICAg\nICBfaWQgPSBMb25nLnBhcnNlTG9uZyhzdHIuc3Vic3RyaW5nKGlkeCArIDEp\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhP\nYmplY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYg\nKCEob3RoZXIgaW5zdGFuY2VvZiBTdGF0ZU1hbmFnZXJJZCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\ncklkIHNpZCA9IChTdGF0ZU1hbmFnZXJJZCkgb3RoZXI7CiAgICAgICAgICAg\nIHJldHVybiBfYmhhc2ggPT0gc2lkLl9iaGFzaCAmJiBfaWQgPT0gc2lkLl9p\nZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7\nCiAgICAgICAgICAgIHJldHVybiAoaW50KSAoX2lkIF4gKF9pZCA+Pj4gMzIp\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmco\nKSB7CiAgICAgICAgICAgIHJldHVybiBTVFJJTkdfUFJFRklYICsgX2JoYXNo\nICsgIjoiICsgX2lkOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENvbGxlY3Rpb24gdHlwZSB0aGF0IGhvbGRzIHN0YXRlIG1hbmFnZXJzIGJ1\ndCB3aG9zZSBpbnRlcmZhY2UgZGVhbHMKICAgICAqIHdpdGggdGhlIGNvcnJl\nc3BvbmRpbmcgbWFuYWdlZCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbgogICAgICAg\nIGV4dGVuZHMgQWJzdHJhY3RDb2xsZWN0aW9uIHsKCiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBDb2xsZWN0aW9uIF9zdGF0ZXM7CgogICAgICAgIHB1YmxpYyBN\nYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihDb2xsZWN0aW9uIHN0YXRlcykgewog\nICAgICAgICAgICBfc3RhdGVzID0gc3RhdGVzOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIENvbGxlY3Rpb24gZ2V0U3RhdGVNYW5hZ2VycygpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9zdGF0ZXM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiBfc3RhdGVz\nLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBp\ndGVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvcigp\nIHsKICAgICAgICAgICAgICAgIHByaXZhdGUgZmluYWwgSXRlcmF0b3IgX2l0\nciA9IF9zdGF0ZXMuaXRlcmF0b3IoKTsKCiAgICAgICAgICAgICAgICBwdWJs\naWMgYm9vbGVhbiBoYXNOZXh0KCkgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBfaXRyLmhhc05leHQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICBwdWJsaWMgT2JqZWN0IG5leHQoKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuICgoT3BlbkpQQVN0YXRlTWFuYWdlcikgX2l0ci5u\nZXh0KCkpLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRNYW5hZ2VkSW5z\ndGFuY2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCByZW1vdmUoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogSGVscGVyIGNsYXNzIHRvIGltcGxlbWVudCBKQ0EgaW50ZXJmYWNl\ncy4gVGhpcyBpcyBwbGFjZWQgaW4gYQogICAgICogc2VwYXJhdGUgY2xhc3Mg\nc28gdGhhdCBpdHMgbWV0aG9kcyBkbyBub3QgaW50ZXJmZXJlIHdpdGggdGhl\nCiAgICAgKiBwZXJzaXN0ZW5jZSBtYW5hZ2VyIEFQSXMuCiAgICAgKi8KICAg\nIHByaXZhdGUgY2xhc3MgSkNBSGVscGVyCiAgICAgICAgaW1wbGVtZW50cyBJ\nbnRlcmFjdGlvbiwgUmVzdWx0U2V0SW5mbywgQ29ubmVjdGlvbk1ldGFEYXRh\nIHsKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCiAgICAgICAgLy8gSW1wbGVtZW50YXRpb24gb2YgSW50ZXJh\nY3Rpb24gaW50ZXJmYWNlCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMgdm9pZCBj\nbGVhcldhcm5pbmdzKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJl\nY29yZCBleGVjdXRlKEludGVyYWN0aW9uU3BlYyBzcGVjLCBSZWNvcmQgaW5w\ndXQpCiAgICAgICAgICAgIHRocm93cyBSZXNvdXJjZUV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFeGNlcHRpb24oImV4\nZWN1dGUiKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGV4\nZWN1dGUoSW50ZXJhY3Rpb25TcGVjIHNwZWMsIFJlY29yZCBpbnB1dCwKICAg\nICAgICAgICAgUmVjb3JkIG91dHB1dCkKICAgICAgICAgICAgdGhyb3dzIFJl\nc291cmNlRXhjZXB0aW9uIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFN1\ncHBvcnRlZEV4Y2VwdGlvbigiZXhlY3V0ZSIpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29ubmVjdGlvbigpIHsKICAgICAg\nICAgICAgcmV0dXJuIEJyb2tlckltcGwudGhpczsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBSZXNvdXJjZVdhcm5pbmcgZ2V0V2FybmluZ3MoKSB7CiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgfQoKICAgICAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAg\nICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBSZXN1bHRTZXRJbmZvIGludGVyZmFj\nZQogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBkZWxldGVzQXJl\nRGV0ZWN0ZWQoaW50IHR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpbnNlcnRzQXJl\nRGV0ZWN0ZWQoaW50IHR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBvdGhlcnNEZWxl\ndGVzQXJlVmlzaWJsZShpbnQgdHlwZSkgewogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIG90aGVy\nc0luc2VydHNBcmVWaXNpYmxlKGludCB0eXBlKSB7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nb3RoZXJzVXBkYXRlc0FyZVZpc2libGUoaW50IHR5cGUpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBvd25EZWxldGVzQXJlVmlzaWJsZShpbnQgdHlwZSkgewogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIG93bkluc2VydHNBcmVWaXNpYmxlKGludCB0eXBlKSB7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gb3duVXBkYXRlc0FyZVZpc2libGUoaW50IHR5cGUpIHsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3VsdFNldFR5cGUoaW50IHR5cGUpIHsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3VsdFR5cGVDb25jdXJyZW5jeShp\nbnQgdHlwZSwKICAgICAgICAgICAgaW50IGNvbmN1cnJlbmN5KSB7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gdXBkYXRlc0FyZURldGVjdGVkKGludCB0eXBlKSB7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAgICAgLy8gSW1wbGVtZW50YXRpb24gb2YgQ29ubmVjdGlvbk1ldGFE\nYXRhIGludGVyZmFjZQogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIGdldEVJU1Byb2R1Y3ROYW1lKCkgewogICAgICAgICAgICByZXR1\ncm4gX2NvbmYuZ2V0Q29ubmVjdGlvbkRyaXZlck5hbWUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0RUlTUHJvZHVjdFZlcnNpb24o\nKSB7CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0VXNlck5hbWUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfdXNlcjsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

