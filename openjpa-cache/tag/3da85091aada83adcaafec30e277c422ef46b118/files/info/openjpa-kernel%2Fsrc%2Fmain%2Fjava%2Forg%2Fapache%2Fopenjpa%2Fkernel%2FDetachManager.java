{"sha":"bebc49c70549cf803b84d9eef664f533655a113d","node_id":"MDQ6QmxvYjIwNjM2NDpiZWJjNDljNzA1NDljZjgwM2I4NGQ5ZWVmNjY0ZjUzMzY1NWExMTNk","size":29479,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bebc49c70549cf803b84d9eef664f533655a113d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuRGV0YWNoT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5DYWxsYmFja01vZGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHlNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBIYW5kbGVzIGRldGFjaGluZyBpbnN0YW5jZXMuCiAqCiAq\nIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBEZXRhY2hNYW5hZ2VyCiAgICBpbXBsZW1lbnRzIERl\ndGFjaFN0YXRlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKERldGFjaE1hbmFnZXIuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgZmluYWwgQnJva2VySW1wbCBfYnJva2VyOwogICAg\ncHJpdmF0ZSBmaW5hbCBib29sZWFuIF9jb3B5OwogICAgcHJpdmF0ZSBmaW5h\nbCBib29sZWFuIF9mdWxsOwogICAgcHJpdmF0ZSBmaW5hbCBQcm94eU1hbmFn\nZXIgX3Byb3h5OwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hPcHRpb25zIF9v\ncHRzOwogICAgcHJpdmF0ZSBmaW5hbCBPcENhbGxiYWNrcyBfY2FsbDsKICAg\nIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfZmFpbEZhc3Q7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2ZsdXNoZWQgPSBmYWxzZTsKCiAgICAvLyBpZiB3ZSdyZSBu\nb3QgZGV0YWNoaW5nIGZ1bGwsIHdlIG5lZWQgdG8gdHJhY2sgYWxsIGRldGFj\naGVkIG9iamVjdHM7CiAgICAvLyBpZiB3ZSBhcmUsIHRoZW4gd2UgdXNlIGEg\nc3BlY2lhbCBmaWVsZCBtYW5hZ2VyIGZvciBtb3JlIGVmZmljaWVudAogICAg\nLy8gZGV0YWNobWVudCB0aGFuIHRoZSBzdGFuZGFyZCBvbmUKICAgIHByaXZh\ndGUgZmluYWwgSWRlbnRpdHlNYXAgX2RldGFjaGVkOwogICAgcHJpdmF0ZSBm\naW5hbCBEZXRhY2hGaWVsZE1hbmFnZXIgX2Z1bGxGTTsKCiAgICAvKioKICAg\nICAqIFVzZWQgdG8gcHJlcGFyZSBhIGRldGFjaGFibGUgaW5zdGFuY2UgdGhh\ndCBkb2VzIG5vdCBleHRlcm5hbGl6ZQogICAgICogZGV0YWNoZWQgc3RhdGUu\nCiAgICAgKi8KICAgIHN0YXRpYyBib29sZWFuIHByZVNlcmlhbGl6ZShTdGF0\nZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBmbHVz\naERpcnR5KHNtKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20u\nZ2V0TWV0YURhdGEoKTsKICAgICAgICBib29sZWFuIHNldFN0YXRlID0gbWV0\nYS5nZXREZXRhY2hlZFN0YXRlKCkgIT0gbnVsbAogICAgICAgICAgICAmJiAh\nQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNo\nZWRTdGF0ZSgpKTsKICAgICAgICBCaXRTZXQgaWR4cyA9IChzZXRTdGF0ZSkg\nPyBuZXcgQml0U2V0KG1ldGEuZ2V0RmllbGRzKCkubGVuZ3RoKSA6IG51bGw7\nCiAgICAgICAgcHJlRGV0YWNoKHNtLmdldEJyb2tlcigpLCBzbSwgaWR4cyk7\nCgogICAgICAgIGlmIChzZXRTdGF0ZSkgewogICAgICAgICAgICBzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKS5wY1NldERldGFjaGVkU3RhdGUoZ2V0RGV0\nYWNoZWRTdGF0ZQogICAgICAgICAgICAgICAgKHNtLCBpZHhzKSk7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsgLy8gZG9uJ3QgbnVsbCBzdGF0ZQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzZWQgYnkgY2xhc3NlcyB0aGF0IGV4dGVybmFsaXplIGRldGFjaGVk\nIHN0YXRlLgogICAgICoKICAgICAqIEByZXR1cm4gd2hldGhlciB0byB1c2Ug\nYSBkZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHN0YXRpYyBi\nb29sZWFuIHdyaXRlRGV0YWNoZWRTdGF0ZShTdGF0ZU1hbmFnZXJJbXBsIHNt\nLCBPYmplY3RPdXRwdXQgb3V0LAogICAgICAgIEJpdFNldCBpZHhzKQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzbS5pc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICBvdXQud3JpdGVPYmplY3QobnVs\nbCk7IC8vIHN0YXRlCiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxs\nKTsgLy8gc20KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgLy8gZGlydHkgc3RhdGUgY2F1c2VzIGZsdXNoCiAgICAgICAg\nZmx1c2hEaXJ0eShzbSk7CgogICAgICAgIEJyb2tlciBicm9rZXIgPSBzbS5n\nZXRCcm9rZXIoKTsKICAgICAgICBwcmVEZXRhY2goYnJva2VyLCBzbSwgaWR4\ncyk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVkIHN0YXRlIG9iamVjdCBh\nbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cyA9\nIGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERl\ndGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoIW9wdHMuZ2V0RGV0\nYWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICB8fCAhdXNlRGV0YWNo\nZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAgICAgICAgICAgIG91dC53\ncml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNtLCBpZHhzKSk7CiAgICAg\nICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBvdXQud3JpdGVPYmplY3Qo\nbnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG5ldyBEZXRhY2hlZFN0\nYXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwKICAgICAg\nICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNzVW5sb2FkZWQoKSwgYnJv\na2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkgdGhlIG9iamVjdCBmb3Ig\nZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcgdGhlIGZpZWxkcyB0byBi\nZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5nIHZlcnNpb24gaW5mb3Jt\nYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlkeHMgdGhlIGluZGV4ZXMg\nb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNldCBhcyBhIHNpZGUKICAg\nICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIgYnJva2VyLCBTdGF0ZU1h\nbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBpZHhzKSB7CiAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoZSBleGlzdGluZyBvYmplY3QgaGFzIHRoZSByaWdo\ndCBmaWVsZHMgZmV0Y2hlZDsgY2FsbAogICAgICAgIC8vIGV2ZW4gaWYgdXNp\nbmcgY3VycmVudGx5LWxvYWRlZCBmaWVsZHMgZm9yIGRldGFjaCB0byBtYWtl\nIHN1cmUKICAgICAgICAvLyB2ZXJzaW9uIGlzIHNldAogICAgICAgIGludCBk\nZXRhY2hNb2RlID0gYnJva2VyLmdldERldGFjaFN0YXRlKCk7CiAgICAgICAg\naW50IGxvYWRNb2RlID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUzsKICAg\nICAgICBCaXRTZXQgZXhjbHVkZSA9IG51bGw7CiAgICAgICAgaWYgKGRldGFj\naE1vZGUgPT0gREVUQUNIX0xPQURFRCkKICAgICAgICAgICAgZXhjbHVkZSA9\nIFN0b3JlQ29udGV4dC5FWENMVURFX0FMTDsKICAgICAgICBlbHNlIGlmIChk\nZXRhY2hNb2RlID09IERFVEFDSF9BTEwpCiAgICAgICAgICAgIGxvYWRNb2Rl\nID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBzbS5sb2FkKGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKSwgbG9hZE1vZGUsIGV4Y2x1ZGUsIG51bGwsIAogICAgICAgICAgICAg\nICAgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgLy8gY29uc3VtZSB0aGUgZXhj\nZXB0aW9uCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYml0c2V0IG9m\nIGZpZWxkcyB0byBkZXRhY2g7IGlmIG1vZGUgaXMgYWxsIHdlIGNhbiB1c2UK\nICAgICAgICAvLyBjdXJyZW50bHkgbG9hZGVkIGJpdHNldCBjbG9uZSwgc2lu\nY2Ugd2Uga25vdyBhbGwgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICBpZiAo\naWR4cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChkZXRhY2hNb2RlID09\nIERFVEFDSF9GR1MpCiAgICAgICAgICAgICAgICBzZXRGZXRjaEdyb3VwRmll\nbGRzKGJyb2tlciwgc20sIGlkeHMpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBpZHhzLm9yKHNtLmdldExvYWRlZCgpKTsKCiAgICAgICAg\nICAgIC8vIGNsZWFyIGxycyBmaWVsZHMKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKQogICAg\nICAgICAgICAgICAgICAgIGlkeHMuY2xlYXIoaSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIGRldGFjaGVkIHN0YXRl\nIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIE9iamVjdCBnZXREZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlcklt\ncGwgc20sIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICAvLyBpZiBkYXRhc3Rv\ncmUsIHN0b3JlIGlkIGluIGZpcnN0IGVsZW1lbnQKICAgICAgICBpbnQgb2Zm\nc2V0ID0gKHNtLmdldE1ldGFEYXRhKCkuZ2V0SWRlbnRpdHlUeXBlKCkgPT0K\nICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpID8gMSA6\nIDA7CgogICAgICAgIC8vIG1ha2UgdmVyc2lvbiBzdGF0ZSBhcnJheSBvbmUg\nbGFyZ2VyIGZvciBuZXcgaW5zdGFuY2VzOyBtYXJrcyBuZXcKICAgICAgICAv\nLyBpbnN0YW5jZXMgd2l0aG91dCBhZmZlY3Rpbmcgc2VyaWFsaXphdGlvbiBz\naXplIG11Y2gKICAgICAgICBPYmplY3RbXSBzdGF0ZTsKICAgICAgICBpZiAo\nc20uaXNOZXcoKSkKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2JqZWN0WzMg\nKyBvZmZzZXRdOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RhdGUgPSBu\nZXcgT2JqZWN0WzIgKyBvZmZzZXRdOwoKICAgICAgICBpZiAob2Zmc2V0ID4g\nMCkgewogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGlmIChz\nbS5pc0VtYmVkZGVkKCkgfHwgc20uZ2V0T2JqZWN0SWQoKSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgaWQgPSBzbS5nZXRJZCgpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBpZCA9IHNtLmdldE9iamVjdElkKCk7CiAg\nICAgICAgICAgIHN0YXRlWzBdID0gaWQudG9TdHJpbmcoKTsKICAgICAgICB9\nCiAgICAgICAgc3RhdGVbb2Zmc2V0XSA9IHNtLmdldFZlcnNpb24oKTsKICAg\nICAgICBzdGF0ZVtvZmZzZXQgKyAxXSA9IGZpZWxkczsKICAgICAgICByZXR1\ncm4gc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBvciBpbnZv\na2UgcHJlLXN0b3JlIGNhbGxiYWNrcyBvbiB0aGUgZ2l2ZW4gYnJva2VyIGlm\nCiAgICAgKiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIGZsdXNoZWQvc3RvcmVk\nLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGJvb2xlYW4gZmx1c2hEaXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAg\nICAgICAgaWYgKCFzbS5pc0RpcnR5KCkgfHwgIXNtLmdldEJyb2tlcigpLmlz\nQWN0aXZlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nLy8gb25seSBmbHVzaCBpZiB0aGVyZSBhcmUgYWN0dWFsbHkgYW55IGRpcnR5\nIG5vbi1mbHVzaGVkIGZpZWxkcwogICAgICAgIEJpdFNldCBkaXJ0eUZpZWxk\ncyA9IHNtLmdldERpcnR5KCk7CiAgICAgICAgQml0U2V0IGZsdXNoZWRGaWVs\nZHMgPSBzbS5nZXRGbHVzaGVkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBkaXJ0eUZpZWxkcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBp\nZiAoZGlydHlGaWVsZHMuZ2V0KGkpICYmICFmbHVzaGVkRmllbGRzLmdldChp\nKSkgewogICAgICAgICAgICAgICAgaWYgKHNtLmdldEJyb2tlcigpLmdldFJv\nbGxiYWNrT25seSgpKQogICAgICAgICAgICAgICAgICAgIHNtLmdldEJyb2tl\ncigpLnByZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgc20uZ2V0QnJva2VyKCkuZmx1c2goKTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIGJpdCBzZXQgZm9yIHRoZSBmaWVsZHMgaW4gdGhlIGN1cnJlbnQg\nZmV0Y2ggZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lk\nIHNldEZldGNoR3JvdXBGaWVsZHMoQnJva2VyIGJyb2tlciwKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtLCBCaXRTZXQgaWR4cykgewogICAgICAgIEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRGZXRjaENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNt\nLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nIChmbWRzW2ldLmlzUHJpbWFyeUtleSgpIHx8IGZldGNoLnJlcXVpcmVzRmV0\nY2goZm1kc1tpXSkKICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJh\ndGlvbi5GRVRDSF9OT05FKQogICAgICAgICAgICAgICAgaWR4cy5zZXQoaSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3Iu\nCiAgICAgKgogICAgICogQHBhcmFtIGJyb2tlciBvd25pbmcgYnJva2VyCiAg\nICAgKiBAcGFyYW0gZnVsbCB3aGV0aGVyIHRoZSBlbnRpcmUgYnJva2VyIGNh\nY2hlIGlzIGJlaW5nIGRldGFjaGVkOyBpZgogICAgICogdGhpcyBpcyB0aGUg\nY2FzZSwgd2UgYXNzdW1lIHRoZSBicm9rZXIgaGFzIGFscmVhZHkKICAgICAq\nIGZsdXNoZWQgaWYgbmVlZGVkLCBhbmQgdGhhdCB3ZSdyZSBkZXRhY2hpbmcg\naW4tcGxhY2UKICAgICAqLwogICAgcHVibGljIERldGFjaE1hbmFnZXIoQnJv\na2VySW1wbCBicm9rZXIsIGJvb2xlYW4gZnVsbCwgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAgICAgICAgX3Byb3h5\nID0gYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRQcm94eU1hbmFnZXJJ\nbnN0YW5jZSgpOwogICAgICAgIF9vcHRzID0gYnJva2VyLmdldENvbmZpZ3Vy\nYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCk7CiAgICAgICAgX2Nv\ncHkgPSAhZnVsbDsKICAgICAgICBfZmx1c2hlZCA9IGZ1bGw7CiAgICAgICAg\nX2NhbGwgPSBjYWxsOwogICAgICAgIF9mYWlsRmFzdCA9IChicm9rZXIuZ2V0\nQ29uZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNl\nKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1\nbHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCkKICAgICAgICAgICAgJiBDYWxsYmFj\na01vZGVzLkNBTExCQUNLX0ZBSUxfRkFTVCkgIT0gMDsKCiAgICAgICAgLy8g\nd2UgY2FuIG9ubHkgcmVseSBvbiBvdXIgImFsbCIgc2hvcnRjdXRzIGlmIHdl\nIGtub3cgd2Ugd29uJ3QgYmUKICAgICAgICAvLyBsb2FkaW5nIGFueSBtb3Jl\nIGRhdGEKICAgICAgICBfZnVsbCA9IGZ1bGwgJiYgYnJva2VyLmdldERldGFj\naFN0YXRlKCkgPT0gRGV0YWNoU3RhdGUuREVUQUNIX0xPQURFRDsKICAgICAg\nICBpZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2RldGFjaGVkID0gbnVsbDsK\nICAgICAgICAgICAgX2Z1bGxGTSA9IG5ldyBEZXRhY2hGaWVsZE1hbmFnZXIo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfZGV0YWNoZWQgPSBu\nZXcgSWRlbnRpdHlNYXAoKTsKICAgICAgICAgICAgX2Z1bGxGTSA9IG51bGw7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgZGV0\nYWNoZWQgdmVyc2lvbiBvZiB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8K\nICAgIHB1YmxpYyBPYmplY3QgZGV0YWNoKE9iamVjdCB0b0RldGFjaCkgewog\nICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gZGV0YWNoSW50ZXJuYWwodG9EZXRhY2gpOwogICAg\nICAgIH0gY2F0Y2ggKENhbGxiYWNrRXhjZXB0aW9uIGNlKSB7CiAgICAgICAg\nICAgIGV4Y2VwcyA9IG5ldyBBcnJheUxpc3QoMSk7CiAgICAgICAgICAgIGV4\nY2Vwcy5hZGQoY2UpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8gd29u\nJ3QgYmUgcmVhY2hlZCBhcyBleGNlcHRpb24gd2lsbCBiZSByZXRocm93bgog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChleGNlcHMgPT0g\nbnVsbCB8fCAhX2ZhaWxGYXN0KQogICAgICAgICAgICAgICAgZXhjZXBzID0g\naW52b2tlQWZ0ZXJEZXRhY2goQ29sbGVjdGlvbnMuc2luZ2xldG9uKHRvRGV0\nYWNoKSwKICAgICAgICAgICAgICAgICAgICBleGNlcHMpOwogICAgICAgICAg\nICBpZiAoX2RldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGV0\nYWNoZWQuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb25zKGV4\nY2Vwcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGRldGFjaGVkIHZlcnNpb25zIG9mIGFsbCB0aGUgZ2l2ZW4gaW5zdGFuY2Vz\nLiBJZiBub3QgY29weWluZywKICAgICAqIG51bGwgd2lsbCBiZSByZXR1cm5l\nZC4KICAgICAqLwogICAgcHVibGljIE9iamVjdFtdIGRldGFjaEFsbChDb2xs\nZWN0aW9uIGluc3RhbmNlcykgewogICAgICAgIExpc3QgZXhjZXBzID0gbnVs\nbDsKICAgICAgICBMaXN0IGRldGFjaGVkID0gbnVsbDsKICAgICAgICBpZiAo\nX2NvcHkpCiAgICAgICAgICAgIGRldGFjaGVkID0gbmV3IEFycmF5TGlzdChp\nbnN0YW5jZXMuc2l6ZSgpKTsKCiAgICAgICAgYm9vbGVhbiBmYWlsRmFzdCA9\nIGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE9iamVjdCBkZXRh\nY2g7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gaW5zdGFuY2Vz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICBkZXRhY2ggPSBkZXRhY2hJbnRlcm5hbChpdHIubmV4dCgpKTsKICAgICAg\nICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICBkZXRh\nY2hlZC5hZGQoZGV0YWNoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICBpZiAocmUgaW5zdGFuY2VvZiBDYWxsYmFja0V4Y2VwdGlvbiAmJiBfZmFp\nbEZhc3QpCiAgICAgICAgICAgICAgICBmYWlsRmFzdCA9IHRydWU7CiAgICAg\nICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAoIWZhaWxGYXN0KQogICAgICAgICAg\nICAgICAgZXhjZXBzID0gaW52b2tlQWZ0ZXJEZXRhY2goaW5zdGFuY2VzLCBl\neGNlcHMpOwogICAgICAgICAgICBpZiAoX2RldGFjaGVkICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfZGV0YWNoZWQuY2xlYXIoKTsKICAgICAgICB9CiAg\nICAgICAgdGhyb3dFeGNlcHRpb25zKGV4Y2Vwcyk7CgogICAgICAgIGlmIChf\nY29weSkKICAgICAgICAgICAgcmV0dXJuIGRldGFjaGVkLnRvQXJyYXkoKTsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIElu\ndm9rZSBwb3N0RGV0YWNoKCkgb24gYW55IGRldGFjaGVkIGluc3RhbmNlcyB0\naGF0IGltcGxlbWVudAogICAgICogUG9zdERldGFjaENhbGxiYWNrLiBUaGlz\nIHdpbGwgYmUgZG9uZSBhZnRlciB0aGUgZW50aXJlIGdyYXBoIGhhcwogICAg\nICogYmVlbiBkZXRhY2hlZC4gVGhpcyBtZXRob2QgaGFzIHRoZSBzaWRlLWVm\nZmVjdCBvZiBhbHNvIGNsZWFyaW5nCiAgICAgKiBvdXQgdGhlIG1hcCBvZiBh\nbGwgZGV0YWNoZWQgaW5zdGFuY2VzLgogICAgICovCiAgICBwcml2YXRlIExp\nc3QgaW52b2tlQWZ0ZXJEZXRhY2goQ29sbGVjdGlvbiBvYmpzLCBMaXN0IGV4\nY2VwcykgewogICAgICAgIEl0ZXJhdG9yIGl0ciA9IChfZnVsbCkgPyBvYmpz\nLml0ZXJhdG9yKCkKICAgICAgICAgICAgOiBfZGV0YWNoZWQuZW50cnlTZXQo\nKS5pdGVyYXRvcigpOwoKICAgICAgICBPYmplY3Qgb3JpZywgZGV0YWNoZWQ7\nCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIHdoaWxlIChpdHIu\naGFzTmV4dCgpKSB7CiAgICAgICAgICAgIGlmIChfZnVsbCkgewogICAgICAg\nICAgICAgICAgb3JpZyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBk\nZXRhY2hlZCA9IG9yaWc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBvcmlnID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAg\nICAgICBkZXRhY2hlZCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2Vy\nLmdldFN0YXRlTWFuYWdlckltcGwob3JpZywgdHJ1ZSk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudChkZXRh\nY2hlZCwgb3JpZywKICAgICAgICAgICAgICAgICAgICAgICAgc20uZ2V0TWV0\nYURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVUQUNIKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2UpIHsKICAgICAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGNlKTsKICAgICAgICAg\nICAgICAgIGlmIChfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7IC8vIGRvbid0IGNvbnRpbnVlIHByb2Nlc3NpbmcKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhjZXBzOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIGFuIGV4Y2VwdGlvbiB0byB0aGUgbGlzdC4KICAg\nICAqLwogICAgcHJpdmF0ZSBMaXN0IGFkZChMaXN0IGV4Y2VwcywgUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCkK\nICAgICAgICAgICAgZXhjZXBzID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAg\nICBleGNlcHMuYWRkKHJlKTsKICAgICAgICByZXR1cm4gZXhjZXBzOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhyb3cgYWxsIGdhdGhlcmVkIGV4Y2VwdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0aHJvd0V4Y2VwdGlvbnMo\nTGlzdCBleGNlcHMpIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGV4Y2Vwcy5zaXplKCkg\nPT0gMSkKICAgICAgICAgICAgdGhyb3cgKFJ1bnRpbWVFeGNlcHRpb24pIGV4\nY2Vwcy5nZXQoMCk7CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSkuCiAgICAgICAgICAgIHNldE5l\nc3RlZFRocm93YWJsZXMoKFRocm93YWJsZVtdKSBleGNlcHMudG9BcnJheQog\nICAgICAgICAgICAgICAgKG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0p\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGFjaC4KICAgICAqLwogICAg\ncHJpdmF0ZSBPYmplY3QgZGV0YWNoSW50ZXJuYWwoT2JqZWN0IHRvRGV0YWNo\nKSB7CiAgICAgICAgaWYgKHRvRGV0YWNoID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAvLyBhbHJlYWR5IGRldGFjaGVkPwog\nICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkgewogICAgICAgICAgICBP\nYmplY3QgZGV0YWNoZWQgPSBfZGV0YWNoZWQuZ2V0KHRvRGV0YWNoKTsKICAg\nICAgICAgICAgaWYgKGRldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZGV0YWNoZWQ7CiAgICAgICAgfQoKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtID0gX2Jyb2tlci5nZXRTdGF0ZU1hbmFnZXJJbXBsKHRv\nRGV0YWNoLCB0cnVlKTsKICAgICAgICBpZiAoX2NhbGwgIT0gbnVsbCAmJiAo\nX2NhbGwucHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0RFVEFDSCwK\nICAgICAgICAgICAgdG9EZXRhY2gsIHNtKSAmIE9wQ2FsbGJhY2tzLkFDVF9S\nVU4pID09IDApCiAgICAgICAgICAgIHJldHVybiB0b0RldGFjaDsKICAgICAg\nICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRvRGV0YWNo\nOwoKICAgICAgICAvLyBDYWxsIFByZURldGFjaCBmaXJzdCBhcyB3ZSBjYW4n\ndCB0ZWxsIGlmIHRoZSBuZXcgc3lzdGVtCiAgICAgICAgLy8gZmlyZWQgYW4g\nZXZlbnQgb3IganVzdCBkaWQgbm90IGZhaWwuCiAgICAgICAgX2Jyb2tlci5m\naXJlTGlmZWN5Y2xlRXZlbnQodG9EZXRhY2gsIG51bGwsIHNtLmdldE1ldGFE\nYXRhKCksCiAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ERVRB\nQ0gpOwoKICAgICAgICAvLyBhbnkgZGlydHkgaW5zdGFuY2VzIGNhdXNlIGEg\nZmx1c2ggdG8gb2NjdXIKICAgICAgICBfZmx1c2hlZCA9IF9mbHVzaGVkIHx8\nIGZsdXNoRGlydHkoc20pOwogICAgICAgIEJpdFNldCBmaWVsZHMgPSBuZXcg\nQml0U2V0KCk7CiAgICAgICAgcHJlRGV0YWNoKF9icm9rZXIsIHNtLCBmaWVs\nZHMpOwoKICAgICAgICAvLyBjcmVhdGUgYW5kIHN0b3JlIG5ldyBvYmplY3Qg\nYmVmb3JlIGNvcHkgdG8gYXZvaWQgZW5kbGVzcyByZWN1cnNpb24KICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNh\ncGFibGUoKTsKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgZGV0YWNoZWRQ\nQzsKICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgIGRldGFjaGVkUEMg\nPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIHRydWUpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgZGV0YWNoZWRQQyA9IHBjOwogICAgICAgIGlmIChfZGV0\nYWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgX2RldGFjaGVkLnB1dCh0b0Rl\ndGFjaCwgZGV0YWNoZWRQQyk7CgogICAgICAgIC8vIGRldGFjaCBmaWVsZHMg\nYW5kIHNldCBkZXRhY2hlZCB2YXJpYWJsZXMKICAgICAgICBEZXRhY2hlZFN0\nYXRlTWFuYWdlciBkZXRTTSA9IG51bGw7CiAgICAgICAgaWYgKF9vcHRzLmdl\ndERldGFjaGVkU3RhdGVNYW5hZ2VyKCkKICAgICAgICAgICAgJiYgdXNlRGV0\nYWNoZWRTdGF0ZU1hbmFnZXIoc20sIF9vcHRzKSkKICAgICAgICAgICAgZGV0\nU00gPSBuZXcgRGV0YWNoZWRTdGF0ZU1hbmFnZXIoZGV0YWNoZWRQQywgc20s\nIGZpZWxkcywKICAgICAgICAgICAgICAgIF9vcHRzLmdldEFjY2Vzc1VubG9h\nZGVkKCksIF9icm9rZXIuZ2V0TXVsdGl0aHJlYWRlZCgpKTsKICAgICAgICBp\nZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFn\nZXIoc20pOwogICAgICAgICAgICBfZnVsbEZNLmRldGFjaFZlcnNpb24oKTsK\nICAgICAgICAgICAgX2Z1bGxGTS5yZXByb3h5KGRldFNNKTsKICAgICAgICAg\nICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFnZXIobnVsbCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIg\nZm0gPSBuZXcgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIKICAgICAgICAg\nICAgICAgIChkZXRhY2hlZFBDLCBkZXRTTSk7CiAgICAgICAgICAgIGZtLnNl\ndFN0YXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAgIGZtLmRldGFjaEZpZWxk\ncyhmaWVsZHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFCb29sZWFuLkZB\nTFNFLmVxdWFscyhzbS5nZXRNZXRhRGF0YSgpLnVzZXNEZXRhY2hlZFN0YXRl\nKCkpKQogICAgICAgICAgICBkZXRhY2hlZFBDLnBjU2V0RGV0YWNoZWRTdGF0\nZShnZXREZXRhY2hlZFN0YXRlKHNtLCBmaWVsZHMpKTsKICAgICAgICBpZiAo\nIV9jb3B5KQogICAgICAgICAgICBzbS5yZWxlYXNlKGZhbHNlLCAhX2NvcHkp\nOwogICAgICAgIGlmIChkZXRTTSAhPSBudWxsKQogICAgICAgICAgICBkZXRh\nY2hlZFBDLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihkZXRTTSk7CiAgICAgICAg\ncmV0dXJuIGRldGFjaGVkUEM7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiB1c2VEZXRhY2hlZFN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXJJ\nbXBsIHNtLAogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cykgewogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAg\nICAgcmV0dXJuICFCb29sZWFuLkZBTFNFLmVxdWFscyhtZXRhLnVzZXNEZXRh\nY2hlZFN0YXRlKCkpICYmCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEuU1lO\nVEhFVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUoKSkgJiYKICAg\nICAgICAgICAgb3B0cy5nZXREZXRhY2hlZFN0YXRlTWFuYWdlcigpOwogICAg\nfQoKICAgIC8qKgogICAgICogQmFzZSBkZXRhY2ggZmllbGQgbWFuYWdlci4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRGV0YWNoRmllbGRN\nYW5hZ2VyCiAgICAgICAgZXh0ZW5kcyBUcmFuc2ZlckZpZWxkTWFuYWdlciB7\nCgogICAgICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIHNtOwoKICAg\nICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIHNvdXJjZSBzdGF0ZSBtYW5h\nZ2VyLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0YXRl\nTWFuYWdlcihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHRo\naXMuc20gPSBzbTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFRyYW5zZmVyIHRoZSBjdXJyZW50IHZlcnNpb24gb2JqZWN0IGZyb20gdGhl\nIHN0YXRlIG1hbmFnZXIgdG8gdGhlCiAgICAgICAgICogZGV0YWNoZWQgaW5z\ndGFuY2UuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0YWNo\nVmVyc2lvbigpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBz\nbS5nZXRNZXRhRGF0YSgpLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgICAg\nICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgICAgICBPYmplY3QgdmFsID0gSmF2YVR5cGVzLmNvbnZlcnQoc20u\nZ2V0VmVyc2lvbigpLAogICAgICAgICAgICAgICAgZm1kLmdldFR5cGVDb2Rl\nKCkpOwogICAgICAgICAgICB2YWwgPSBmbWQuZ2V0RmllbGRWYWx1ZSh2YWws\nIHNtLmdldEJyb2tlcigpKTsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBsb25ndmFsID0g\nKHZhbCA9PSBudWxsKSA/IDBMIDogKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVl\nKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgIGRibHZhbCA9ICh2YWwgPT0gbnVsbCkg\nPyAwRCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIG9ianZhbCA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBzbS5yZXBsYWNlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKSwgdGhpcywKICAgICAgICAgICAgICAgIGZtZC5nZXRJbmRleCgpKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFVucHJveGllcyBz\nZWNvbmQgY2xhc3Mgb2JqZWN0IGZpZWxkcy4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgdm9pZCByZXByb3h5KERldGFjaGVkU3RhdGVNYW5hZ2VyIGRz\nbSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgICAgICAvLyBscnMgcHJveGllcyBub3QgZGV0YWNoZWQKICAgICAgICAg\nICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIG9ianZhbCA9IG51bGw7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBlcnNpc3RlbmNl\nQ2FwYWJsZSgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMs\nIGkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAg\nICAgICAgc20ucHJvdmlkZUZpZWxkKGdldERldGFjaGVkUGVyc2lzdGVuY2VD\nYXBhYmxlKCksIHRoaXMsIGkpOwogICAgICAgICAgICAgICAgICAgIGlmIChv\nYmp2YWwgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBQcm94eSBwcm94eSA9IChQcm94eSkgb2JqdmFsOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAocHJveHkuZ2V0Q2hhbmdlVHJhY2tlcigpICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eS5nZXRD\naGFuZ2VUcmFja2VyKCkuc3RvcFRyYWNraW5nKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHByb3h5LnNldE93bmVyKGRzbSwgKGRzbSA9PSBudWxsKSA/\nIC0xIDogaSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNsZWFyKCk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGluc3Rh\nbmNlIGJlaW5nIGRldGFjaGVkLgogICAgICAgICAqLwogICAgICAgIHByb3Rl\nY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgZ2V0RGV0YWNoZWRQZXJzaXN0ZW5j\nZUNhcGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBzbS5nZXRQZXJzaXN0\nZW5jZUNhcGFibGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGaWVsZE1hbmFnZXIgdGhhdCBjYW4gY29weSBhbGwgdGhlIGZpZWxkcyBm\ncm9tIG9uZQogICAgICogUGVyc2lzdGVuY2VDYXBhYmxlIGluc3RhbmNlIHRv\nIGFub3RoZXIuIE9uZSBvZiB0aGUKICAgICAqIGluc3RhbmNlcyBtdXN0IGJl\nIG1hbmFnZWQgYnkgYSBTdGF0ZU1hbmFnZXIsIGFuZCB0aGUKICAgICAqIG90\naGVyIG11c3QgYmUgdW5tYW5hZ2VkLgogICAgICoKICAgICAqIEBhdXRob3Ig\nTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3Mg\nSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIKICAgICAgICBleHRlbmRzIERl\ndGFjaEZpZWxkTWFuYWdlciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUGVy\nc2lzdGVuY2VDYXBhYmxlIF90bzsKICAgICAgICBwcml2YXRlIGZpbmFsIERl\ndGFjaGVkU3RhdGVNYW5hZ2VyIF9kZXRTTTsKCiAgICAgICAgLyoqCiAgICAg\nICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBpbnN0YW5jZSB0byB0byBjb3B5\nIHRvLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBJbnN0YW5jZURldGFj\naEZpZWxkTWFuYWdlcihQZXJzaXN0ZW5jZUNhcGFibGUgdG8sCiAgICAgICAg\nICAgIERldGFjaGVkU3RhdGVNYW5hZ2VyIGRldFNNKSB7CiAgICAgICAgICAg\nIF90byA9IHRvOwogICAgICAgICAgICBfZGV0U00gPSBkZXRTTTsKICAgICAg\nICB9CgogICAgICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgZ2V0\nRGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfdG87CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBE\nZXRhY2ggdGhlIGZpZWxkcyBvZiB0aGUgc3RhdGUgbWFuYWdlciBnaXZlbiBv\nbiBjb25zdHJ1Y3Rpb24gdG8KICAgICAgICAgKiB0aGUgcGVyc2lzdGVuY2Ug\nY2FwYWJsZSBnaXZlbiBvbiBjb25zdHJ1Y3Rpb24uCiAgICAgICAgICogT25s\neSB0aGUgZmllbGRzIGluIHRoZSBnaXZlbiBiaXQgc2V0IHdpbGwgYmUgY29w\naWVkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGRldGFjaEZp\nZWxkcyhCaXRTZXQgZmdmaWVsZHMpIHsKICAgICAgICAgICAgUGVyc2lzdGVu\nY2VDYXBhYmxlIGZyb20gPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IHNtLmdldE1ldGFE\nYXRhKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRz\nKCk7CgogICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgICAgICBf\ndG8ucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIC8vIHdlIHN0YXJ0IHdpdGggcGsgZmllbGRz\nOiBvYmplY3RzIG1pZ2h0IHJlbHkgb24gcGsgZmllbGRzIGZvcgogICAgICAg\nICAgICAgICAgLy8gZXF1YWxzIGFuZCBoYXNoQ29kZSBtZXRob2RzLCBhbmQg\ndGhpcyBlbnN1cmVzIHRoYXQgcGsgZmllbGRzCiAgICAgICAgICAgICAgICAv\nLyBhcmUgc2V0IHByb3Blcmx5IGlmIHdlIHJldHVybiBhbnkgcGFydGlhbGx5\nLWRldGFjaGVkIG9iamVjdHMKICAgICAgICAgICAgICAgIC8vIGR1ZSB0byBy\nZWVudHJhbnQgY2FsbHMgd2hlbiB0cmF2ZXJzaW5nIHJlbGF0aW9ucwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICAgICAgZGV0YWNoRmllbGQoZnJvbSwgcGtz\nW2ldLmdldEluZGV4KCksIHRydWUpOwogICAgICAgICAgICAgICAgZGV0YWNo\nVmVyc2lvbigpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmICgh\nZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiAhZm1kc1tpXS5pc1ZlcnNpb24o\nKSkgCiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaEZpZWxkKGZyb20s\nIGksIGZnZmllbGRzLmdldChpKSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAvLyBjbGVhciB0aGUgU3RhdGVNYW5hZ2VyIGZy\nb20gdGhlIHRhcmdldCBvYmplY3QKICAgICAgICAgICAgICAgIGlmIChfY29w\neSkKICAgICAgICAgICAgICAgICAgICBfdG8ucGNSZXBsYWNlU3RhdGVNYW5h\nZ2VyKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBEZXRhY2ggKG9yIGNsZWFyKSB0aGUgZ2l2ZW4gZmll\nbGQgaW5kZXguCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRl\ndGFjaEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBmcm9tLCBpbnQgaSwgYm9v\nbGVhbiBmZykgewogICAgICAgICAgICAvLyB0ZWxsIHRoZSBzdGF0ZSBtYW5h\nZ2VyIHRvIHByb3ZpZGUgdGhlIGZpZWxkcyBmcm9tIHRoZSBzb3VyY2UgdG8K\nICAgICAgICAgICAgLy8gdGhpcyBmaWVsZCBtYW5hZ2VyLCB3aGljaCB3aWxs\nIHRoZW4gcmVwbGFjZSB0aGUgZmllbGQgd2l0aCBhCiAgICAgICAgICAgIC8v\nIGRldGFjaGVkIHZlcnNpb24KICAgICAgICAgICAgaWYgKGZnKQogICAgICAg\nICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGZyb20sIHRoaXMsIGkpOwogICAg\nICAgICAgICBlbHNlIGlmICghX2NvcHkpIHsKICAgICAgICAgICAgICAgIC8v\nIGlmIG5vdCBjb3B5aW5nIGFuZCBmaWVsZCBzaG91bGQgbm90IGJlIGRldGFj\naGVkLCBjbGVhciBpdAogICAgICAgICAgICAgICAgY2xlYXIoKTsKICAgICAg\nICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9y\nZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3VyVmFsKSB7CiAg\nICAgICAgICAgIHN1cGVyLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBm\naWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUJ5\ndGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFsKSB7CiAgICAgICAgICAg\nIHN1cGVyLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAg\nICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUNoYXJGaWVsZChpbnQg\nZmllbGQsIGNoYXIgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3Jl\nQ2hhckZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBs\nYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxkKGludCBmaWVsZCwgZG91\nYmxlIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZURvdWJsZUZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmll\nbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzdG9yZUZsb2F0RmllbGQoaW50IGZpZWxkLCBmbG9hdCBjdXJW\nYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVGbG9hdEZpZWxkKGZpZWxk\nLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0\naGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBz\ndG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1clZhbCkgewogICAgICAg\nICAgICBzdXBlci5zdG9yZUludEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUxvbmdGaWVsZChp\nbnQgZmllbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0\nb3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5y\nZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0RmllbGQoaW50IGZpZWxkLCBz\naG9ydCBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVTaG9ydEZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmll\nbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5nIGN1\nclZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVN0cmluZ0ZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3Rv\nLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBzdG9yZU9iamVjdEZpZWxkKGludCBmaWVsZCwgT2JqZWN0IGN1clZhbCkg\newogICAgICAgICAgICBzdXBlci5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCBk\nZXRhY2hGaWVsZChjdXJWYWwsIGZpZWxkKSk7CiAgICAgICAgICAgIHNtLnJl\ncGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgb3duZXIgb2YgdGhlIGZpZWxk\nJ3MgcHJveHkgdG8gdGhlIGRldGFjaGVkIHN0YXRlIG1hbmFnZXIuCiAgICAg\nICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgcmVwcm94eShPYmplY3Qg\nb2JqLCBpbnQgZmllbGQpIHsKICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxs\nICYmIF9kZXRTTSAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9mIFByb3h5KQog\nICAgICAgICAgICAgICAgKChQcm94eSkgb2JqKS5zZXRPd25lcihfZGV0U00s\nIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIERldGFjaCB0aGUgZ2l2ZW4gdmFsdWUg\naWYgbmVlZGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgT2JqZWN0\nIGRldGFjaEZpZWxkKE9iamVjdCBjdXJWYWwsIGludCBmaWVsZCkgewogICAg\nICAgICAgICBpZiAoY3VyVmFsID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAg\nIE9iamVjdCBuZXdWYWwgPSBudWxsOwogICAgICAgICAgICBzd2l0Y2ggKGZt\nZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAg\nICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNvcHlBcnJheShj\ndXJWYWwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAgICAgICAgIGRldGFjaEFy\ncmF5KG5ld1ZhbCwgZm1kKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXdW\nYWw7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAg\nICAgICAgICAgICAgICBpZiAoX2NvcHkpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2RldFNNICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3VmFsID0gX3Byb3h5Lm5ld0NvbGxlY3Rpb25Qcm94eShmbWQuZ2V0\nUHJveHlUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kLmdldEluaXRpYWxpemVyKCkgaW5zdGFuY2Vv\nZiBDb21wYXJhdG9yID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChD\nb21wYXJhdG9yKSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSA6IG51bGwpOwogICAg\nICAgICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIG5ld1ZhbCkuYWRk\nQWxsKChDb2xsZWN0aW9uKSBjdXJWYWwpOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJv\neHkuY29weUNvbGxlY3Rpb24oKENvbGxlY3Rpb24pIGN1clZhbCk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBuZXdWYWwg\nPSBjdXJWYWw7CiAgICAgICAgICAgICAgICBkZXRhY2hDb2xsZWN0aW9uKChD\nb2xsZWN0aW9uKSBuZXdWYWwsIChDb2xsZWN0aW9uKSBjdXJWYWwsIGZtZCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcm94eShuZXdWYWwsIGZpZWxk\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAg\nICAgICAgaWYgKF9jb3B5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9k\nZXRTTSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Zh\nbCA9IF9wcm94eS5uZXdNYXBQcm94eShmbWQuZ2V0UHJveHlUeXBlKCksCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkuZ2V0RGVj\nbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kLmdldEluaXRpYWxpemVyKCkgaW5zdGFuY2Vv\nZiBDb21wYXJhdG9yID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAoQ29tcGFyYXRvcikgZm1kLmdldEluaXRpYWxpemVyKCkgOiBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgKChNYXApIG5ld1ZhbCkucHV0QWxs\nKChNYXApIGN1clZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IF9wcm94eS5jb3B5TWFw\nKChNYXApIGN1clZhbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgICAgICAgICBuZXdWYWwgPSBjdXJWYWw7CiAgICAgICAgICAgICAg\nICBkZXRhY2hNYXAoKE1hcCkgbmV3VmFsLCAoTWFwKSBjdXJWYWwsIGZtZCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcm94eShuZXdWYWwsIGZpZWxk\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAg\nICAgICAgICAgICBuZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5LmNvcHlDYWxl\nbmRhcigoQ2FsZW5kYXIpIGN1clZhbCkgOgogICAgICAgICAgICAgICAgICAg\nIGN1clZhbDsKICAgICAgICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1Zh\nbCwgZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgog\nICAgICAgICAgICAgICAgbmV3VmFsID0gKF9jb3B5KSA/IF9wcm94eS5jb3B5\nRGF0ZSgoRGF0ZSkgY3VyVmFsKSA6IGN1clZhbDsKICAgICAgICAgICAgICAg\nIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBpZiAoX2Nv\ncHkpCiAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNvcHlD\ndXN0b20oY3VyVmFsKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXByb3h5\nKChuZXdWYWwgPT0gbnVsbCkgPyBjdXJWYWwgOiBuZXdWYWwsIGZpZWxkKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZGV0YWNoSW50ZXJuYWwoY3VyVmFsKTsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHJldHVybiBjdXJWYWw7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIE1ha2Ugc3Vy\nZSBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gYXJyYXkgYXJlIGRldGFj\naGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBkZXRhY2hB\ncnJheShPYmplY3QgYXJyYXksIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgICAgIGlmICghZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBD\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpbnQg\nbGVuID0gQXJyYXkuZ2V0TGVuZ3RoKGFycmF5KTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAgIEFy\ncmF5LnNldChhcnJheSwgaSwgZGV0YWNoSW50ZXJuYWwoQXJyYXkuZ2V0KGFy\ncmF5LCBpKSkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nTWFrZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBjb2xsZWN0\naW9uIGFyZSBkZXRhY2hlZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRl\nIHZvaWQgZGV0YWNoQ29sbGVjdGlvbihDb2xsZWN0aW9uIGNvbGwsIENvbGxl\nY3Rpb24gb3JpZywKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpIHsK\nICAgICAgICAgICAgLy8gY29sbCBjYW4gYmUgbnVsbCBpZiBub3QgY29weWFi\nbGUKICAgICAgICAgICAgaWYgKF9jb3B5ICYmIGNvbGwgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICAgICAgaWYgKCFmbWQu\nZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIHVuZm9ydHVuYXRlbHkgd2Ug\naGF2ZSB0byBjbGVhciB0aGUgb3JpZ2luYWwgYW5kIHJlLWFkZCB0byBjb3B5\nCiAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgIGNvbGwu\nY2xlYXIoKTsKICAgICAgICAgICAgT2JqZWN0IGRldGFjaGVkOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9yaWcuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGRldGFjaGVkID0gZGV0\nYWNoSW50ZXJuYWwoaXRyLm5leHQoKSk7CiAgICAgICAgICAgICAgICBpZiAo\nX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgY29sbC5hZGQoZGV0YWNoZWQp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIG1h\ncCBhcmUgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2\nb2lkIGRldGFjaE1hcChNYXAgbWFwLCBNYXAgb3JpZywgRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICAgICAgLy8gbWFwIGNhbiBiZSBudWxsIGlmIG5v\ndCBjb3B5YWJsZQogICAgICAgICAgICBpZiAoX2NvcHkgJiYgbWFwID09IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWNvcHlhYmxlIiwgZm1kKSk7CiAgICAgICAgICAgIGJv\nb2xlYW4ga2V5UEMgPSBmbWQuZ2V0S2V5KCkuaXNEZWNsYXJlZFR5cGVQQygp\nOwogICAgICAgICAgICBib29sZWFuIHZhbFBDID0gZm1kLmdldEVsZW1lbnQo\nKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgICAgIGlmICgha2V5UEMg\nJiYgIXZhbFBDKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAg\nICAgLy8gaWYgd2UgaGF2ZSB0byBjb3B5IGtleXMsIGp1c3QgY2xlYXIgYW5k\nIHJlLWFkZDsgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHdlIGNhbiB1c2Ug\ndGhlIGVudHJ5IHNldCB0byByZXNldCB0aGUgdmFsdWVzIG9ubHkKICAgICAg\nICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgICAgICBpZiAoIV9jb3B5\nIHx8IGtleVBDKSB7CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAg\nICAgICAgICAgICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBP\nYmplY3Qga2V5LCB2YWw7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG9yaWcuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOyl7CiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGtleSA9IGVudHJ5\nLmdldEtleSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChrZXlQQykKICAg\nICAgICAgICAgICAgICAgICAgICAga2V5ID0gZGV0YWNoSW50ZXJuYWwoa2V5\nKTsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBlbnRyeS5nZXRWYWx1ZSgp\nOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWxQQykKICAgICAgICAgICAg\nICAgICAgICAgICAgdmFsID0gZGV0YWNoSW50ZXJuYWwodmFsKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIG1hcC5wdXQoa2V5LCB2YWwpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRy\neSkgaXRyLm5leHQgKCk7CgkJCQkJZW50cnkuc2V0VmFsdWUgKGRldGFjaElu\ndGVybmFsIChlbnRyeS5nZXRWYWx1ZSAoKSkpOwoJCQkJfQoJCQl9CgkJfQoJ\nfQp9Cg==\n","encoding":"base64"}

