{"sha":"42807cfd2b321cfe3ea6c31b5762dca5650840ed","node_id":"MDQ6QmxvYjIwNjM2NDo0MjgwN2NmZDJiMzIxY2ZlM2VhNmMzMWI1NzYyZGNhNTY1MDg0MGVk","size":21653,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/42807cfd2b321cfe3ea6c31b5762dca5650840ed","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0\naWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQ\nQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnJvcC5FYWdlclJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5MaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5TaW1wbGVS\nZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nV2luZG93UmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmV0Y2hHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Ob1RyYW5zYWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBBbGxvd3Mg\nY29uZmlndXJhdGlvbiBhbmQgb3B0aW1pemF0aW9uIG9mIGhvdyBvYmplY3Rz\nIGFyZSBsb2FkZWQgZnJvbQogKiB0aGUgZGF0YSBzdG9yZS4KICoKICogQHNp\nbmNlIDAuMy4wCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGlu\nYWtpIFBvZGRhcgogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRmV0\nY2hDb25maWd1cmF0aW9uSW1wbAogICAgaW1wbGVtZW50cyBGZXRjaENvbmZp\nZ3VyYXRpb24sIENsb25lYWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChGZXRjaENvbmZpZ3VyYXRpb25JbXBsLmNsYXNzKTsKCiAgICAvKioK\nICAgICAqIENvbmZpZ3VyYWJsZSBzdGF0ZSBzaGFyZWQgdGhyb3VnaG91dCBh\nIHRyYXZlcnNhbCBjaGFpbi4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBjbGFzcyBDb25maWd1cmF0aW9uU3RhdGUKICAgICAgICBpbXBsZW1lbnRz\nIFNlcmlhbGl6YWJsZQogICAgewogICAgICAgIHB1YmxpYyB0cmFuc2llbnQg\nU3RvcmVDb250ZXh0IGN0eCA9IG51bGw7CiAgICAgICAgcHVibGljIGludCBm\nZXRjaEJhdGNoU2l6ZSA9IDA7CiAgICAgICAgcHVibGljIGludCBtYXhGZXRj\naERlcHRoID0gMTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBxdWVyeUNhY2hl\nID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgaW50IGZsdXNoUXVlcnkgPSAwOwog\nICAgICAgIHB1YmxpYyBpbnQgbG9ja1RpbWVvdXQgPSAtMTsKICAgICAgICBw\ndWJsaWMgaW50IHJlYWRMb2NrTGV2ZWwgPSBMT0NLX05PTkU7CiAgICAgICAg\ncHVibGljIGludCB3cml0ZUxvY2tMZXZlbCA9IExPQ0tfTk9ORTsKICAgICAg\nICBwdWJsaWMgU2V0IGZldGNoR3JvdXBzID0gbnVsbDsKICAgICAgICBwdWJs\naWMgU2V0IGZpZWxkcyA9IG51bGw7CiAgICAgICAgcHVibGljIFNldCByb290\nQ2xhc3NlczsKICAgICAgICBwdWJsaWMgU2V0IHJvb3RJbnN0YW5jZXM7CiAg\nICAgICAgcHVibGljIE1hcCBoaW50cyA9IG51bGw7CiAgICB9CgogICAgcHJp\ndmF0ZSBmaW5hbCBDb25maWd1cmF0aW9uU3RhdGUgX3N0YXRlOwogICAgcHJp\ndmF0ZSBGZXRjaENvbmZpZ3VyYXRpb25JbXBsIF9wYXJlbnQ7CiAgICBwcml2\nYXRlIFN0cmluZyBfZnJvbUZpZWxkOwogICAgcHJpdmF0ZSBDbGFzcyBfZnJv\nbVR5cGU7CiAgICBwcml2YXRlIFN0cmluZyBfZGlyZWN0UmVsYXRpb25Pd25l\ncjsKICAgIHByaXZhdGUgYm9vbGVhbiBfbG9hZCA9IHRydWU7CiAgICBwcml2\nYXRlIGludCBfYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgcHJpdmF0ZSBpbnQg\nX2F2YWlsYWJsZURlcHRoOwoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb25JbXBsKCkgewogICAgICAgIHRoaXMobnVsbCk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIEZldGNoQ29uZmlndXJhdGlvbkltcGwoQ29uZmlndXJhdGlvblN0\nYXRlIHN0YXRlKSB7CiAgICAgICAgX3N0YXRlID0gKHN0YXRlID09IG51bGwp\nID8gbmV3IENvbmZpZ3VyYXRpb25TdGF0ZSgpIDogc3RhdGU7CiAgICAgICAg\nX2F2YWlsYWJsZURlcHRoID0gX3N0YXRlLm1heEZldGNoRGVwdGg7CiAgICB9\nIAoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAg\nICAgICByZXR1cm4gX3N0YXRlLmN0eDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICAvLyBj\nYW4ndCByZXNldCBub24tbnVsbCBjb250ZXh0IHRvIGFub3RoZXIgY29udGV4\ndAogICAgICAgIGlmIChjdHggIT0gbnVsbCAmJiBfc3RhdGUuY3R4ICE9IG51\nbGwgJiYgY3R4ICE9IF9zdGF0ZS5jdHgpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIF9zdGF0ZS5jdHggPSBj\ndHg7CiAgICAgICAgaWYgKGN0eCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGluaXRpYWxpemUgdG8gY29uZiBpbmZvCiAgICAg\nICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGN0eC5nZXRDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgc2V0RmV0Y2hCYXRjaFNpemUoY29uZi5nZXRG\nZXRjaEJhdGNoU2l6ZSgpKTsKICAgICAgICBzZXRGbHVzaEJlZm9yZVF1ZXJp\nZXMoY29uZi5nZXRGbHVzaEJlZm9yZVF1ZXJpZXNDb25zdGFudCgpKTsKICAg\nICAgICBjbGVhckZldGNoR3JvdXBzKCk7CiAgICAgICAgYWRkRmV0Y2hHcm91\ncHMoQXJyYXlzLmFzTGlzdChjb25mLmdldEZldGNoR3JvdXBzTGlzdCgpKSk7\nCiAgICAgICAgc2V0TWF4RmV0Y2hEZXB0aChjb25mLmdldE1heEZldGNoRGVw\ndGgoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9uZSB0aGlzIGluc3Rh\nbmNlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewogICAg\nICAgIEZldGNoQ29uZmlndXJhdGlvbkltcGwgY2xvbmUgPSBuZXdJbnN0YW5j\nZShudWxsKTsKICAgICAgICBjbG9uZS5fc3RhdGUuY3R4ID0gX3N0YXRlLmN0\neDsKICAgICAgICBjbG9uZS5fcGFyZW50ID0gX3BhcmVudDsKICAgICAgICBj\nbG9uZS5fZnJvbUZpZWxkID0gX2Zyb21GaWVsZDsKICAgICAgICBjbG9uZS5f\nZnJvbVR5cGUgPSBfZnJvbVR5cGU7CiAgICAgICAgY2xvbmUuX2RpcmVjdFJl\nbGF0aW9uT3duZXIgPSBfZGlyZWN0UmVsYXRpb25Pd25lcjsKICAgICAgICBj\nbG9uZS5fbG9hZCA9IF9sb2FkOwogICAgICAgIGNsb25lLl9hdmFpbGFibGVS\nZWN1cnNpb24gPSBfYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgICAgIGNsb25l\nLl9hdmFpbGFibGVEZXB0aCA9IF9hdmFpbGFibGVEZXB0aDsKICAgICAgICBj\nbG9uZS5jb3B5KHRoaXMpOwogICAgICAgIHJldHVybiBjbG9uZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBob2xsb3cgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBGZXRjaENvbmZpZ3VyYXRpb25JbXBs\nIG5ld0luc3RhbmNlKENvbmZpZ3VyYXRpb25TdGF0ZSBzdGF0ZSkgewogICAg\nICAgIHJldHVybiBuZXcgRmV0Y2hDb25maWd1cmF0aW9uSW1wbChzdGF0ZSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBzZXRGZXRjaEJhdGNoU2l6ZShmZXRjaC5n\nZXRGZXRjaEJhdGNoU2l6ZSgpKTsKICAgICAgICBzZXRNYXhGZXRjaERlcHRo\nKGZldGNoLmdldE1heEZldGNoRGVwdGgoKSk7CiAgICAgICAgc2V0UXVlcnlD\nYWNoZShmZXRjaC5nZXRRdWVyeUNhY2hlKCkpOwogICAgICAgIHNldEZsdXNo\nQmVmb3JlUXVlcmllcyhmZXRjaC5nZXRGbHVzaEJlZm9yZVF1ZXJpZXMoKSk7\nCiAgICAgICAgc2V0TG9ja1RpbWVvdXQoZmV0Y2guZ2V0TG9ja1RpbWVvdXQo\nKSk7CiAgICAgICAgY2xlYXJGZXRjaEdyb3VwcygpOwogICAgICAgIGFkZEZl\ndGNoR3JvdXBzKGZldGNoLmdldEZldGNoR3JvdXBzKCkpOwogICAgICAgIGNs\nZWFyRmllbGRzKCk7CiAgICAgICAgYWRkRmllbGRzKGZldGNoLmdldEZpZWxk\ncygpKTsKCiAgICAgICAgLy8gZG9uJ3QgdXNlIHNldHRlcnMgYmVjYXVzZSBy\nZXF1aXJlIGFjdGl2ZSB0cmFuc2FjdGlvbgogICAgICAgIF9zdGF0ZS5yZWFk\nTG9ja0xldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAg\nIF9zdGF0ZS53cml0ZUxvY2tMZXZlbCA9IGZldGNoLmdldFdyaXRlTG9ja0xl\ndmVsKCk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRGZXRjaEJhdGNoU2l6\nZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmZldGNoQmF0Y2hTaXplOwog\nICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0RmV0Y2hC\nYXRjaFNpemUoaW50IGZldGNoQmF0Y2hTaXplKSB7CiAgICAgICAgaWYgKGZl\ndGNoQmF0Y2hTaXplID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAhPSBudWxs\nKQogICAgICAgICAgICBmZXRjaEJhdGNoU2l6ZSA9IF9zdGF0ZS5jdHguZ2V0\nQ29uZmlndXJhdGlvbigpLmdldEZldGNoQmF0Y2hTaXplKCk7CiAgICAgICAg\naWYgKGZldGNoQmF0Y2hTaXplICE9IERFRkFVTFQpCiAgICAgICAgICAgIF9z\ndGF0ZS5mZXRjaEJhdGNoU2l6ZSA9IGZldGNoQmF0Y2hTaXplOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TWF4RmV0\nY2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLm1heEZldGNoRGVw\ndGg7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRN\nYXhGZXRjaERlcHRoKGludCBkZXB0aCkgewogICAgICAgIGlmIChkZXB0aCA9\nPSBERUZBVUxUICYmIF9zdGF0ZS5jdHggIT0gbnVsbCkKICAgICAgICAgICAg\nZGVwdGggPSBfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRNYXhG\nZXRjaERlcHRoKCk7CiAgICAgICAgaWYgKGRlcHRoICE9IERFRkFVTFQpCiAg\nICAgICAgewogICAgICAgICAgICBfc3RhdGUubWF4RmV0Y2hEZXB0aCA9IGRl\ncHRoOwogICAgICAgICAgICBpZiAoX3BhcmVudCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX2F2YWlsYWJsZURlcHRoID0gZGVwdGg7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGdldFF1ZXJ5Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5xdWVy\neUNhY2hlOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24g\nc2V0UXVlcnlDYWNoZShib29sZWFuIGNhY2hlKSB7CiAgICAgICAgX3N0YXRl\nLnF1ZXJ5Q2FjaGUgPSBjYWNoZTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IGdldEZsdXNoQmVmb3JlUXVlcmllcygpIHsK\nICAgICAgICByZXR1cm4gX3N0YXRlLmZsdXNoUXVlcnk7CiAgICB9CgogICAg\ncHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRGbHVzaEJlZm9yZVF1ZXJp\nZXMoaW50IGZsdXNoKSB7CiAgICAgICAgaWYgKGZsdXNoID09IERFRkFVTFQg\nJiYgX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBfc3RhdGUuZmx1\nc2hRdWVyeSA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICAgICAgZ2V0Rmx1c2hCZWZvcmVRdWVyaWVzQ29uc3RhbnQoKTsK\nICAgICAgICBlbHNlIGlmIChmbHVzaCAhPSBERUZBVUxUKQogICAgICAgICAg\nICBfc3RhdGUuZmx1c2hRdWVyeSA9IGZsdXNoOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0RmV0Y2hHcm91cHMoKSB7\nCiAgICAgICAgcmV0dXJuIChfc3RhdGUuZmV0Y2hHcm91cHMgPT0gbnVsbCkg\nPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgCiAgICAgICAgICAgIDogX3N0YXRl\nLmZldGNoR3JvdXBzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0Zl\ndGNoR3JvdXAoU3RyaW5nIGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0\nZS5mZXRjaEdyb3VwcyAhPSBudWxsCiAgICAgICAgICAgICYmIChfc3RhdGUu\nZmV0Y2hHcm91cHMuY29udGFpbnMoZ3JvdXApCiAgICAgICAgICAgIHx8IF9z\ndGF0ZS5mZXRjaEdyb3Vwcy5jb250YWlucyhGZXRjaEdyb3VwLk5BTUVfQUxM\nKSk7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBhZGRG\nZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWZnIikpOwoKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5mZXRj\naEdyb3VwcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNo\nR3JvdXBzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3N0YXRlLmZl\ndGNoR3JvdXBzLmFkZChuYW1lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBhZGRG\nZXRjaEdyb3VwcyhDb2xsZWN0aW9uIGdyb3VwcykgewogICAgICAgIGlmIChn\ncm91cHMgPT0gbnVsbCB8fCBncm91cHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGdy\nb3Vwcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAg\nYWRkRmV0Y2hHcm91cCgoU3RyaW5nKSBpdHIubmV4dCgpKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0\naW9uIHJlbW92ZUZldGNoR3JvdXAoU3RyaW5nIGdyb3VwKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUu\nZmV0Y2hHcm91cHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5m\nZXRjaEdyb3Vwcy5yZW1vdmUoZ3JvdXApOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9u\nIHJlbW92ZUZldGNoR3JvdXBzKENvbGxlY3Rpb24gZ3JvdXBzKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3Rh\ndGUuZmV0Y2hHcm91cHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0\nZS5mZXRjaEdyb3Vwcy5yZW1vdmVBbGwoZ3JvdXBzKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmln\ndXJhdGlvbiBjbGVhckZldGNoR3JvdXBzKCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3Jv\ndXBzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91\ncHMuY2xlYXIoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZXNldEZldGNoR3Jv\ndXBzKCkgewogICAgICAgIGNsZWFyRmV0Y2hHcm91cHMoKTsKICAgICAgICBp\nZiAoX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBhZGRGZXRjaEdy\nb3VwcyhBcnJheXMuYXNMaXN0KF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlv\nbigpLgogICAgICAgICAgICAgICAgZ2V0RmV0Y2hHcm91cHNMaXN0KCkpKTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU2V0IGdl\ndEZpZWxkcygpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5maWVsZHMgPT0g\nbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgOiBfc3RhdGUuZmllbGRz\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0ZpZWxkKFN0cmluZyBm\naWVsZCkgewogICAgICAgIHJldHVybiBfc3RhdGUuZmllbGRzICE9IG51bGwg\nJiYgX3N0YXRlLmZpZWxkcy5jb250YWlucyhmaWVsZCk7CiAgICB9CgogICAg\ncHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBhZGRGaWVsZChTdHJpbmcgZmll\nbGQpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShmaWVsZCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJudWxsLWZpZWxkIikpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMgPSBuZXcgSGFzaFNldCgpOwog\nICAgICAgICAgICBfc3RhdGUuZmllbGRzLmFkZChmaWVsZCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENv\nbmZpZ3VyYXRpb24gYWRkRmllbGRzKENvbGxlY3Rpb24gZmllbGRzKSB7CiAg\nICAgICAgaWYgKGZpZWxkcyA9PSBudWxsIHx8IGZpZWxkcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMgPSBuZXcgSGFz\naFNldCgpOwogICAgICAgICAgICBfc3RhdGUuZmllbGRzLmFkZEFsbChmaWVs\nZHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBw\ndWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHJlbW92ZUZpZWxkKFN0cmluZyBm\naWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoX3N0YXRlLmZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX3N0YXRlLmZpZWxkcy5yZW1vdmUoZmllbGQpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1\ncmF0aW9uIHJlbW92ZUZpZWxkcyhDb2xsZWN0aW9uIGZpZWxkcykgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0\nYXRlLmZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLmZp\nZWxkcy5yZW1vdmVBbGwoZmllbGRzKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBj\nbGVhckZpZWxkcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9zdGF0ZS5maWVsZHMuY2xlYXIoKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRMb2Nr\nVGltZW91dCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmxvY2tUaW1lb3V0\nOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0TG9j\na1RpbWVvdXQoaW50IHRpbWVvdXQpIHsKICAgICAgICBpZiAodGltZW91dCA9\nPSBERUZBVUxUICYmIF9zdGF0ZS5jdHggIT0gbnVsbCkKICAgICAgICAgICAg\nX3N0YXRlLmxvY2tUaW1lb3V0ID0gX3N0YXRlLmN0eC5nZXRDb25maWd1cmF0\naW9uKCkuZ2V0TG9ja1RpbWVvdXQoKTsKICAgICAgICBlbHNlIGlmICh0aW1l\nb3V0ICE9IERFRkFVTFQpCiAgICAgICAgICAgIF9zdGF0ZS5sb2NrVGltZW91\ndCA9IHRpbWVvdXQ7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRSZWFkTG9ja0xldmVsKCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUucmVhZExvY2tMZXZlbDsKICAgIH0KCiAgICBwdWJsaWMgRmV0\nY2hDb25maWd1cmF0aW9uIHNldFJlYWRMb2NrTGV2ZWwoaW50IGxldmVsKSB7\nCiAgICAgICAgaWYgKF9zdGF0ZS5jdHggPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAgICAg\nICAgICBpZiAobGV2ZWwgPT0gREVGQVVMVCkKICAgICAgICAgICAgICAgIF9z\ndGF0ZS5yZWFkTG9ja0xldmVsID0gX3N0YXRlLmN0eC5nZXRDb25maWd1cmF0\naW9uKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0UmVhZExvY2tMZXZlbENv\nbnN0YW50KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9z\ndGF0ZS5yZWFkTG9ja0xldmVsID0gbGV2ZWw7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0V3JpdGVMb2Nr\nTGV2ZWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS53cml0ZUxvY2tMZXZl\nbDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNldFdy\naXRlTG9ja0xldmVsKGludCBsZXZlbCkgewogICAgICAgIGlmIChfc3RhdGUu\nY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0\naXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKGxldmVsID09IERF\nRkFVTFQpCiAgICAgICAgICAgICAgICBfc3RhdGUud3JpdGVMb2NrTGV2ZWwg\nPSBfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAg\nICAgICAgICBnZXRXcml0ZUxvY2tMZXZlbENvbnN0YW50KCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9zdGF0ZS53cml0ZUxvY2tMZXZl\nbCA9IGxldmVsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0K\nCiAgICBwdWJsaWMgUmVzdWx0TGlzdCBuZXdSZXN1bHRMaXN0KFJlc3VsdE9i\namVjdFByb3ZpZGVyIHJvcCkgewogICAgICAgIGlmIChyb3AgaW5zdGFuY2Vv\nZiBMaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXIpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgU2ltcGxlUmVzdWx0TGlzdChyb3ApOwogICAgICAgIGlmIChfc3Rh\ndGUuZmV0Y2hCYXRjaFNpemUgPCAwKQogICAgICAgICAgICByZXR1cm4gbmV3\nIEVhZ2VyUmVzdWx0TGlzdChyb3ApOwogICAgICAgIGlmIChyb3Auc3VwcG9y\ndHNSYW5kb21BY2Nlc3MoKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW1w\nbGVSZXN1bHRMaXN0KHJvcCk7CiAgICAgICAgcmV0dXJuIG5ldyBXaW5kb3dS\nZXN1bHRMaXN0KHJvcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBh\nbiBleGNlcHRpb24gaWYgbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24o\nKSB7CiAgICAgICAgaWYgKF9zdGF0ZS5jdHggIT0gbnVsbCAmJiAhX3N0YXRl\nLmN0eC5pc0FjdGl2ZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTm9UcmFu\nc2FjdGlvbkV4Y2VwdGlvbihfbG9jLmdldCgibm90LWFjdGl2ZSIpKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRIaW50KFN0cmluZyBuYW1lLCBPYmpl\nY3QgdmFsdWUpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKF9zdGF0ZS5oaW50cyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgX3N0YXRlLmhpbnRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAg\nICAgX3N0YXRlLmhpbnRzLnB1dChuYW1lLCB2YWx1ZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SGludChTdHJpbmcgbmFtZSkgewog\nICAgICAgIHJldHVybiAoX3N0YXRlLmhpbnRzID09IG51bGwpID8gbnVsbCA6\nIF9zdGF0ZS5oaW50cy5nZXQobmFtZSk7CiAgICB9CgogICAgcHVibGljIFNl\ndCBnZXRSb290Q2xhc3NlcygpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5y\nb290Q2xhc3NlcyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX1NFVCAK\nICAgICAgICAgICAgOiBfc3RhdGUucm9vdENsYXNzZXM7CiAgICB9CgogICAg\ncHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRSb290Q2xhc3NlcyhDb2xs\nZWN0aW9uIGNsYXNzZXMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290Q2xhc3NlcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgX3N0YXRlLnJvb3RDbGFzc2VzLmNsZWFyKCk7\nCiAgICAgICAgICAgIGlmIChjbGFzc2VzICE9IG51bGwgJiYgIWNsYXNzZXMu\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX3N0YXRlLnJvb3RD\nbGFzc2VzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3N0YXRlLnJv\nb3RDbGFzc2VzID0gbmV3IEhhc2hTZXQoY2xhc3Nlcyk7CiAgICAgICAgICAg\nICAgICBlbHNlIAogICAgICAgICAgICAgICAgICAgIF9zdGF0ZS5yb290Q2xh\nc3Nlcy5hZGRBbGwoY2xhc3Nlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNldCBnZXRS\nb290SW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiAoX3N0YXRlLnJvb3RJ\nbnN0YW5jZXMgPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgCiAg\nICAgICAgICAgIDogX3N0YXRlLnJvb3RJbnN0YW5jZXM7CiAgICB9CgogICAg\ncHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRSb290SW5zdGFuY2VzKENv\nbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUucm9vdEluc3RhbmNlcyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLnJvb3RJbnN0YW5jZXMu\nY2xlYXIoKTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlcyAhPSBudWxsICYm\nICFpbnN0YW5jZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX3N0YXRlLnJvb3RJbnN0YW5jZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBfc3RhdGUucm9vdEluc3RhbmNlcyA9IG5ldyBIYXNoU2V0KGluc3Rh\nbmNlcyk7CiAgICAgICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAgICAg\nICAgIF9zdGF0ZS5yb290SW5zdGFuY2VzLmFkZEFsbChpbnN0YW5jZXMpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9zdGF0\nZS5jdHggIT0gbnVsbCkKICAgICAgICAgICAgX3N0YXRlLmN0eC5sb2NrKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdW5sb2NrKCkgewogICAgICAgIGlm\nIChfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIF9zdGF0ZS5jdHgu\ndW5sb2NrKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLwogICAgLy8gVHJh\ndmVyc2FsCiAgICAvLy8vLy8vLy8vLy8vCiAgICAKICAgIHB1YmxpYyBpbnQg\ncmVxdWlyZXNGZXRjaChGaWVsZE1ldGFEYXRhIGZtKSB7CiAgICAgICAgaWYg\nKCFpbmNsdWRlcyhmbSkpCiAgICAgICAgICAgIHJldHVybiBGRVRDSF9OT05F\nOwogICAgICAgIAogICAgICAgIENsYXNzIHR5cGUgPSBnZXRSZWxhdGlvblR5\ncGUoZm0pOwogICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBGRVRDSF9MT0FEOwogICAgICAgIGlmIChfYXZhaWxhYmxlRGVw\ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIEZFVENIX05PTkU7CgogICAg\nICAgIC8vIHdlIGNhbiBza2lwIGNhbGN1bGF0aW5nIHJlY3Vyc2lvbiBkZXB0\naCBpZiB0aGlzIGlzIGEgdG9wLWxldmVsIGNvbmY6CiAgICAgICAgLy8gdGhl\nIGZpZWxkIGlzIGluIG91ciBmZXRjaCBncm91cHMsIHNvIGNhbid0IHBvc3Np\nYmx5IG5vdCBzZWxlY3QKICAgICAgICBpZiAoX3BhcmVudCA9PSBudWxsKSAK\nICAgICAgICAgICAgcmV0dXJuIEZFVENIX0xPQUQ7CgogICAgICAgIGludCBy\nZGVwdGggPSBnZXRBdmFpbGFibGVSZWN1cnNpb25EZXB0aChmbSwgdHlwZSwg\nZmFsc2UpOwogICAgICAgIGlmIChyZGVwdGggIT0gRmV0Y2hHcm91cC5ERVBU\nSF9JTkZJTklURSAmJiByZGVwdGggPD0gMCkKICAgICAgICAgICAgcmV0dXJu\nIEZFVENIX05PTkU7CgogICAgICAgIGlmIChTdHJpbmdVdGlscy5lcXVhbHMo\nX2RpcmVjdFJlbGF0aW9uT3duZXIsIGZtLmdldEZ1bGxOYW1lKCkpKQogICAg\nICAgICAgICByZXR1cm4gRkVUQ0hfUkVGOwogICAgICAgIHJldHVybiBGRVRD\nSF9MT0FEOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzTG9h\nZCgpIHsKICAgICAgICByZXR1cm4gX2xvYWQ7CiAgICB9CgogICAgcHVibGlj\nIEZldGNoQ29uZmlndXJhdGlvbiB0cmF2ZXJzZShGaWVsZE1ldGFEYXRhIGZt\nKSB7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGdldFJlbGF0aW9uVHlwZShmbSk7\nCiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CgogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbkltcGwgY2xvbmUg\nPSBuZXdJbnN0YW5jZShfc3RhdGUpOwogICAgICAgIGNsb25lLl9wYXJlbnQg\nPSB0aGlzOwogICAgICAgIGNsb25lLl9hdmFpbGFibGVEZXB0aCA9IHJlZHVj\nZShfYXZhaWxhYmxlRGVwdGgpOwogICAgICAgIGNsb25lLl9mcm9tRmllbGQg\nPSBmbS5nZXRGdWxsTmFtZShmYWxzZSk7CiAgICAgICAgY2xvbmUuX2Zyb21U\neXBlID0gdHlwZTsKICAgICAgICBjbG9uZS5fYXZhaWxhYmxlUmVjdXJzaW9u\nID0gZ2V0QXZhaWxhYmxlUmVjdXJzaW9uRGVwdGgoZm0sIHR5cGUsIHRydWUp\nOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5lcXVhbHMoX2RpcmVjdFJlbGF0\naW9uT3duZXIsIGZtLmdldEZ1bGxOYW1lKCkpKQogICAgICAgICAgICBjbG9u\nZS5fbG9hZCA9IGZhbHNlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY2xv\nbmUuX2xvYWQgPSBfbG9hZDsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBvd25l\nciA9IGZtLmdldE1hcHBlZEJ5TWV0YURhdGEoKTsKICAgICAgICBpZiAob3du\nZXIgIT0gbnVsbCAmJiBvd25lci5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBl\ncy5QQykKICAgICAgICAgICAgY2xvbmUuX2RpcmVjdFJlbGF0aW9uT3duZXIg\nPSBvd25lci5nZXRGdWxsTmFtZSgpOwogICAgICAgIAogICAgICAgIHJldHVy\nbiBjbG9uZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3VyIGNv\nbmZpZ3VyYXRpb24gc3RhdGUgaW5jbHVkZXMgdGhlIGdpdmVuIGZpZWxkLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaW5jbHVkZXMoRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICBpZiAoKGZtZC5pc0luRGVmYXVsdEZldGNo\nR3JvdXAoKSAKICAgICAgICAgICAgJiYgaGFzRmV0Y2hHcm91cChGZXRjaEdy\nb3VwLk5BTUVfREVGQVVMVCkpCiAgICAgICAgICAgIHx8IGhhc0ZldGNoR3Jv\ndXAoRmV0Y2hHcm91cC5OQU1FX0FMTCkKICAgICAgICAgICAgfHwgaGFzRmll\nbGQoZm1kLmdldEZ1bGxOYW1lKGZhbHNlKSkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIFN0cmluZ1tdIGZncyA9IGZtZC5nZXRDdXN0b21G\nZXRjaEdyb3VwcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmdz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoaGFzRmV0Y2hHcm91cChm\nZ3NbaV0pKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\ncmV0dXJuIGZhbHNlOyAKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgYXZhaWxhYmxlIHJlY3Vyc2lvbiBkZXB0aCB2aWEgdGhlIGdpdmVuIGZp\nZWxkIGZvciB0aGUKICAgICAqIGdpdmVuIHR5cGUuCiAgICAgKgogICAgICog\nQHBhcmFtIHRyYXZlcnNlIHdoZXRoZXIgd2UncmUgdHJhdmVyc2luZyB0aGUg\nZmllbGQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0QXZhaWxhYmxlUmVj\ndXJzaW9uRGVwdGgoRmllbGRNZXRhRGF0YSBmbSwgQ2xhc3MgdHlwZSwgCiAg\nICAgICAgYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIC8vIHNlZSBpZiB0\naGVyZSdzIGEgcHJldmlvdXMgbGltaXQKICAgICAgICBpbnQgYXZhaWwgPSBJ\nbnRlZ2VyLk1JTl9WQUxVRTsKICAgICAgICBmb3IgKEZldGNoQ29uZmlndXJh\ndGlvbkltcGwgZiA9IHRoaXM7IGYgIT0gbnVsbDsgZiA9IGYuX3BhcmVudCkg\newogICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc0Fzc2lnbmFibGUoZi5f\nZnJvbVR5cGUsIHR5cGUpKSB7CiAgICAgICAgICAgICAgICBhdmFpbCA9IGYu\nX2F2YWlsYWJsZVJlY3Vyc2lvbjsKICAgICAgICAgICAgICAgIGlmICh0cmF2\nZXJzZSkKICAgICAgICAgICAgICAgICAgICBhdmFpbCA9IHJlZHVjZShhdmFp\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpZiAoYXZhaWwgPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuIDA7CiAgICAgICAgCiAgICAgICAgLy8gY2FsY3VsYXRlIGZldGNoIGdy\nb3VwcyBtYXgKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBmbS5nZXRE\nZWZpbmluZ01ldGFEYXRhKCk7CiAgICAgICAgaW50IG1heCA9IEludGVnZXIu\nTUlOX1ZBTFVFOwogICAgICAgIGlmIChmbS5pc0luRGVmYXVsdEZldGNoR3Jv\ndXAoKSkKICAgICAgICAgICAgbWF4ID0gbWV0YS5nZXRGZXRjaEdyb3VwKEZl\ndGNoR3JvdXAuTkFNRV9ERUZBVUxUKS4KICAgICAgICAgICAgICAgIGdldFJl\nY3Vyc2lvbkRlcHRoKGZtKTsKICAgICAgICBTdHJpbmdbXSBncm91cHMgPSBm\nbS5nZXRDdXN0b21GZXRjaEdyb3VwcygpOwogICAgICAgIGludCBjdXI7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IG1heCAhPSBGZXRjaEdyb3VwLkRFUFRI\nX0lORklOSVRFIAogICAgICAgICAgICAmJiBpIDwgZ3JvdXBzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGN1ciA9IG1ldGEuZ2V0RmV0Y2hHcm91cChn\ncm91cHNbaV0pLmdldFJlY3Vyc2lvbkRlcHRoKGZtKTsKICAgICAgICAgICAg\naWYgKGN1ciA9PSBGZXRjaEdyb3VwLkRFUFRIX0lORklOSVRFIHx8IGN1ciA+\nIG1heCkgCiAgICAgICAgICAgICAgICBtYXggPSBjdXI7CiAgICAgICAgfQog\nICAgICAgIC8vIHJlZHVjZSBtYXggaWYgd2UncmUgdHJhdmVyc2luZyBhIHNl\nbGYtdHlwZSByZWxhdGlvbgogICAgICAgIGlmICh0cmF2ZXJzZSAmJiBtYXgg\nIT0gSW50ZWdlci5NSU5fVkFMVUUKICAgICAgICAgICAgJiYgSW1wbEhlbHBl\nci5pc0Fzc2lnbmFibGUobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIHR5cGUp\nKQogICAgICAgICAgICBtYXggPSByZWR1Y2UobWF4KTsKCiAgICAgICAgLy8g\ndGFrZSBtaW4vZGVmaW5lZCBvZiBwcmV2aW91cyBhdmFpbCBhbmQgZmV0Y2gg\nZ3JvdXAgbWF4CiAgICAgICAgaWYgKGF2YWlsID09IEludGVnZXIuTUlOX1ZB\nTFVFICYmIG1heCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAg\nICBpbnQgZGVmID0gRmV0Y2hHcm91cC5SRUNVUlNJT05fREVQVEhfREVGQVVM\nVDsKICAgICAgICAgICAgcmV0dXJuICh0cmF2ZXJzZSAmJiBJbXBsSGVscGVy\nLmlzQXNzaWduYWJsZSgKICAgICAgICAgICAgICAgICAgICBtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSwgdHlwZSkpID8gZGVmIC0gMSA6IGRlZjsKICAgICAg\nICB9CiAgICAgICAgaWYgKGF2YWlsID09IEludGVnZXIuTUlOX1ZBTFVFIHx8\nIGF2YWlsID09IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUpCiAgICAgICAg\nICAgIHJldHVybiBtYXg7CiAgICAgICAgaWYgKG1heCA9PSBJbnRlZ2VyLk1J\nTl9WQUxVRSB8fCBtYXggPT0gRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSkK\nICAgICAgICAgICAgcmV0dXJuIGF2YWlsOwogICAgICAgIHJldHVybiBNYXRo\nLm1pbihtYXgsIGF2YWlsKTsKICAgIH0KIAogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJlbGF0aW9uIHR5cGUgb2YgdGhlIGdpdmVuIGZpZWxkLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzcyBnZXRSZWxhdGlvblR5cGUo\nRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIGlmIChmbS5pc0RlY2xhcmVk\nVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBmbS5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgICAgICBpZiAoZm0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRU\neXBlUEMoKSkKICAgICAgICAgICAgcmV0dXJuIGZtLmdldEVsZW1lbnQoKS5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0S2V5KCkuaXNE\nZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4gZm0uZ2V0S2V5\nKCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWR1Y2UgdGhlIGdpdmVuIGxvZ2ljYWwg\nZGVwdGggYnkgMS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHJl\nZHVjZShpbnQgZCkgewogICAgICAgIGlmIChkID09IDApCiAgICAgICAgICAg\nIHJldHVybiAwOwogICAgICAgIGlmIChkICE9IEZldGNoR3JvdXAuREVQVEhf\nSU5GSU5JVEUpCiAgICAgICAgICAgIGQtLTsKICAgICAgICByZXR1cm4gZDsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGVidWcgbWV0\naG9kcwogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBGZXRjaENvbmZpZ3Vy\nYXRpb24gZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVybiBfcGFyZW50Owog\nICAgfQogICAgCiAgICBib29sZWFuIGlzUm9vdCgpIHsKICAgICAgICByZXR1\ncm4gX3BhcmVudCA9PSBudWxsOwogICAgfQogICAgCiAgICBGZXRjaENvbmZp\nZ3VyYXRpb24gZ2V0Um9vdCgpIHsKICAgICAgICByZXR1cm4gKGlzUm9vdCgp\nKSA/IHRoaXMgOiBfcGFyZW50LmdldFJvb3QoKTsKICAgIH0KCiAgICBpbnQg\nZ2V0QXZhaWxhYmxlRmV0Y2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2\nYWlsYWJsZURlcHRoOwogICAgfQoKICAgIGludCBnZXRBdmFpbGFibGVSZWN1\ncnNpb25EZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2YWlsYWJsZVJlY3Vy\nc2lvbjsKICAgIH0KCiAgICBTdHJpbmcgZ2V0VHJhdmVyc2VkRnJvbUZpZWxk\nKCkgewogICAgICAgIHJldHVybiBfZnJvbUZpZWxkOwogICAgfQoKICAgIENs\nYXNzIGdldFRyYXZlcnNlZEZyb21UeXBlKCkgewogICAgICAgIHJldHVybiBf\nZnJvbVR5cGU7CiAgICB9CgogICAgTGlzdCBnZXRQYXRoKCkgewogICAgICAg\nIGlmIChpc1Jvb3QoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIHRyYWNrUGF0aChuZXcgQXJy\nYXlMaXN0KCkpOwogICAgfQogICAgCiAgICBMaXN0IHRyYWNrUGF0aChMaXN0\nIHBhdGgpIHsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKQogICAgICAg\nICAgICBfcGFyZW50LnRyYWNrUGF0aChwYXRoKTsKICAgICAgICBwYXRoLmFk\nZCh0aGlzKTsKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KICAgICAgIAog\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4g\nIkZldGNoQ29uZmlndXJhdGlvbkAiICsgU3lzdGVtLmlkZW50aXR5SGFzaENv\nZGUodGhpcykgCiAgICAgICAgICAgICsgIiAoIiArIF9hdmFpbGFibGVEZXB0\naCArICIpIiArIGdldFBhdGhTdHJpbmcoKTsKICAgIH0KICAgIAogICAgcHJp\ndmF0ZSBTdHJpbmcgZ2V0UGF0aFN0cmluZygpCiAgICB7CiAgICAgICAgTGlz\ndCBwYXRoID0gZ2V0UGF0aCgpOwogICAgICAgIGlmIChwYXRoLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIFN0cmluZ0J1ZmZl\nciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCkuYXBwZW5kICgiOiAiKTsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhdGguaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgoKEZldGNo\nQ29uZmlndXJhdGlvbkltcGwpIGl0ci5uZXh0KCkpLgogICAgICAgICAgICAg\nICAgZ2V0VHJhdmVyc2VkRnJvbUZpZWxkKCkpOwogICAgICAgICAgICBpZiAo\naXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIi0+\nIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KfQo=\n","encoding":"base64"}

