{"sha":"70ed56298bc7494df91596f0cf42934c93a3d6f8","node_id":"MDQ6QmxvYjIwNjM2NDo3MGVkNTYyOThiYzc0OTRkZjkxNTk2ZjBjZjQyOTM0YzkzYTNkNmY4","size":69546,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/70ed56298bc7494df91596f0cf42934c93a3d6f8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTGlzdEl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsK\naW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlZhbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIucm9wLkVhZ2VyUmVzdWx0TGlzdDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLlJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnJvcC5SZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNl\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5jb25jdXJy\nZW50LlJlZW50cmFudExvY2s7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob25VbmlxdWVSZXN1bHRFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob1Jlc3VsdEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5K\nUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVy\nczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEltcGxlbWVu\ndGF0aW9uIG9mIHRoZSB7QGxpbmsgUXVlcnl9IGludGVyZmFjZS4KICoKICog\nQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNs\nYXNzIFF1ZXJ5SW1wbAogICAgaW1wbGVtZW50cyBRdWVyeSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShRdWVyeUltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgU3Ry\naW5nIF9sYW5ndWFnZTsKICAgIHByaXZhdGUgZmluYWwgU3RvcmVRdWVyeSBf\nc3RvcmVRdWVyeTsKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIEJyb2tl\nckltcGwgX2Jyb2tlcjsKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIExv\nZyBfbG9nOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xv\nYWRlciA9IG51bGw7CgogICAgLy8gcXVlcnkgaGFzIGl0cyBvd24gaW50ZXJu\nYWwgbG9jawogICAgcHJpdmF0ZSBmaW5hbCBSZWVudHJhbnRMb2NrIF9sb2Nr\nID0gbmV3IFJlZW50cmFudExvY2soKTsKCiAgICAvLyB1bnBhcnNlZCBzdGF0\nZQogICAgcHJpdmF0ZSBDbGFzcyBfY2xhc3MgPSBudWxsOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zdWJjbGFzc2VzID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfcmVhZE9ubHkgPSBmYWxzZTsKICAgIHByaXZhdGUgU3RyaW5nIF9x\ndWVyeSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFyYW1zID0gbnVs\nbDsKCiAgICAvLyBwYXJzZWQgc3RhdGUKICAgIHByaXZhdGUgdHJhbnNpZW50\nIENvbXBpbGF0aW9uIF9jb21waWxlZCA9IG51bGw7CiAgICBwcml2YXRlIHRy\nYW5zaWVudCBib29sZWFuIF9jb21waWxpbmcgPSBmYWxzZTsKICAgIHByaXZh\ndGUgdHJhbnNpZW50IFJlc3VsdFBhY2tlciBfcGFja2VyID0gbnVsbDsKCiAg\nICAvLyBjYW5kaWRhdGVzCiAgICBwcml2YXRlIHRyYW5zaWVudCBDb2xsZWN0\naW9uIF9jb2xsZWN0aW9uID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50\nIEV4dGVudCBfZXh0ZW50ID0gbnVsbDsKCiAgICAvLyBsaXN0ZW5lcnMKICAg\nIHByaXZhdGUgTWFwIF9maWx0TGlzdGVuZXJzID0gbnVsbDsKICAgIHByaXZh\ndGUgTWFwIF9hZ2dMaXN0ZW5lcnMgPSBudWxsOwoKICAgIC8vIGNvbmZpZ3Vy\nYXRpb24gZm9yIGxvYWRpbmcgb2JqZWN0cwogICAgcHJpdmF0ZSBGZXRjaENv\nbmZpZ3VyYXRpb24gX2ZjID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\naWdub3JlQ2hhbmdlcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDbGFzcyBfcmVz\ndWx0TWFwcGluZ1Njb3BlID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9y\nZXN1bHRNYXBwaW5nTmFtZSA9IG51bGw7CgogICAgLy8gdGhlc2UgZmllbGRz\nIHNob3VsZCBvbmx5IGJlIHVzZWQgZGlyZWN0bHkgYWZ0ZXIgd2UgaGF2ZSBh\nIGNvbXBpbGF0aW9uLAogICAgLy8gYmVjYXVzZSB0aGVpciB2YWx1ZXMgbWF5\nIGJlIGVuY29kZWQgaW4gdGhlIHF1ZXJ5IHN0cmluZwogICAgcHJpdmF0ZSBC\nb29sZWFuIF91bmlxdWUgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfcmVz\ndWx0Q2xhc3MgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBf\nc3RhcnRJZHggPSAwOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBfZW5k\nSWR4ID0gTG9uZy5NQVhfVkFMVUU7CiAgICBwcml2YXRlIHRyYW5zaWVudCBi\nb29sZWFuIF9yYW5nZVNldCA9IGZhbHNlOwoKICAgIC8vIHJlbWVtYmVyIHRo\nZSBsaXN0IG9mIGFsbCB0aGUgcmVzdWx0cyB3ZSBoYXZlIHJldHVybmVkIHNv\nIHdlCiAgICAvLyBjYW4gZnJlZSB0aGVpciByZXNvdXJjZXMgd2hlbiBjbG9z\nZSBvciBjbG9zZUFsbCBpcyBjYWxsZWQKICAgIHByaXZhdGUgdHJhbnNpZW50\nIGZpbmFsIENvbGxlY3Rpb24gX3Jlc3VsdExpc3RzID0gbmV3IFJlZmVyZW5j\nZUhhc2hTZXQKICAgICAgICAoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsKCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdCBhIHF1ZXJ5IG1hbmFnZWQgYnkgdGhl\nIGdpdmVuIGJyb2tlci4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5SW1wbChC\ncm9rZXIgYnJva2VyLCBTdHJpbmcgbGFuZ3VhZ2UsIFN0b3JlUXVlcnkgc3Rv\ncmVRdWVyeSkgewogICAgICAgIF9icm9rZXIgPSAoQnJva2VySW1wbCkgYnJv\na2VyOwogICAgICAgIF9sYW5ndWFnZSA9IGxhbmd1YWdlOwogICAgICAgIF9z\ndG9yZVF1ZXJ5ID0gc3RvcmVRdWVyeTsKICAgICAgICBfZmMgPSAoRmV0Y2hD\nb25maWd1cmF0aW9uKSBicm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCku\nY2xvbmUoKTsKICAgICAgICBfbG9nID0gYnJva2VyLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1FVRVJZKTsK\nICAgICAgICBfc3RvcmVRdWVyeS5zZXRDb250ZXh0KHRoaXMpOwogICAgfQoK\nICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmUgcXVlcnkuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IGdldFN0b3JlUXVlcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdG9yZVF1ZXJ5OwogICAgfQoKICAgIHB1YmxpYyBCcm9r\nZXIgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwogICAg\nfQoKICAgIHB1YmxpYyBRdWVyeSBnZXRRdWVyeSgpIHsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVDb250ZXh0IGdldFN0\nb3JlQ29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGdldExhbmd1YWdlKCkgewogICAgICAgIHJl\ndHVybiBfbGFuZ3VhZ2U7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmln\ndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF9mYzsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFF1ZXJ5U3Ry\naW5nKCkgewogICAgICAgIHJldHVybiBfcXVlcnk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9pZ25vcmVDaGFuZ2VzOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldElnbm9yZUNoYW5nZXMoYm9vbGVhbiBm\nbGFnKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgLy8gYWxsb3dlZCBtb2Rp\nZmljYXRpb246IG5vIHJlYWQtb25seSBjaGVjawogICAgICAgICAgICBfaWdu\nb3JlQ2hhbmdlcyA9IGZsYWc7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzUmVhZE9ubHkoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIHJldHVybiBfcmVhZE9ubHk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0UmVhZE9ubHkoYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgX3JlYWRPbmx5ID0gZmxhZzsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYWRkRmlsdGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIg\nbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb3RS\nZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2ZpbHRMaXN0ZW5lcnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9maWx0TGlzdGVuZXJzID0gbmV3IEhh\nc2hNYXAoNSk7CiAgICAgICAgICAgIF9maWx0TGlzdGVuZXJzLnB1dChsaXN0\nZW5lci5nZXRUYWcoKSwgbGlzdGVuZXIpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByZW1vdmVGaWx0ZXJMaXN0ZW5lcihGaWx0ZXJMaXN0ZW5l\nciBsaXN0ZW5lcikgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5v\ndFJlYWRPbmx5KCk7CiAgICAgICAgICAgIGlmIChfZmlsdExpc3RlbmVycyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2ZpbHRMaXN0ZW5lcnMucmVtb3Zl\nKGxpc3RlbmVyLmdldFRhZygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIENvbGxlY3Rpb24gZ2V0RmlsdGVyTGlzdGVuZXJzKCkgewogICAgICAgIHJl\ndHVybiAoX2ZpbHRMaXN0ZW5lcnMgPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5F\nTVBUWV9MSVNUCiAgICAgICAgICAgIDogX2ZpbHRMaXN0ZW5lcnMudmFsdWVz\nKCk7CiAgICB9CgogICAgcHVibGljIEZpbHRlckxpc3RlbmVyIGdldEZpbHRl\nckxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICAvLyBmaXJzdCBjaGVj\nayBsaXN0ZW5lcnMgZm9yIHRoaXMgcXVlcnkKICAgICAgICBpZiAoX2ZpbHRM\naXN0ZW5lcnMgIT0gbnVsbCkgewogICAgICAgICAgICBGaWx0ZXJMaXN0ZW5l\nciBsaXN0ZW4gPSAoRmlsdGVyTGlzdGVuZXIpIF9maWx0TGlzdGVuZXJzLmdl\ndCh0YWcpOwogICAgICAgICAgICBpZiAobGlzdGVuICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbGlzdGVuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gY2hlY2sgdXNlci1kZWZpbmVkIGxpc3RlbmVycyBmcm9tIGNvbmZpZ3Vy\nYXRpb24KICAgICAgICBGaWx0ZXJMaXN0ZW5lcltdIGNvbmZMaXN0ZW5lcnMg\nPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0\nRmlsdGVyTGlzdGVuZXJJbnN0YW5jZXMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbmZMaXN0ZW5lcnMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgIGlmIChjb25mTGlzdGVuZXJzW2ldLmdldFRhZygpLmVxdWFscyh0YWcp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZMaXN0ZW5lcnNbaV07Cgog\nICAgICAgIC8vIGNoZWNrIHN0b3JlIGxpc3RlbmVycwogICAgICAgIHJldHVy\nbiBfc3RvcmVRdWVyeS5nZXRGaWx0ZXJMaXN0ZW5lcih0YWcpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGFkZEFnZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3JlZ2F0\nZUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAg\nYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgaWYgKF9hZ2dMaXN0\nZW5lcnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hZ2dMaXN0ZW5lcnMg\nPSBuZXcgSGFzaE1hcCg1KTsKICAgICAgICAgICAgX2FnZ0xpc3RlbmVycy5w\ndXQobGlzdGVuZXIuZ2V0VGFnKCksIGxpc3RlbmVyKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcmVtb3ZlQWdncmVnYXRlTGlzdGVuZXIoQWdn\ncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nICAgICBhc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2Fn\nZ0xpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FnZ0xpc3Rl\nbmVycy5yZW1vdmUobGlzdGVuZXIuZ2V0VGFnKCkpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRBZ2dyZWdhdGVMaXN0ZW5lcnMo\nKSB7CiAgICAgICAgcmV0dXJuIChfYWdnTGlzdGVuZXJzID09IG51bGwpID8g\nQ29sbGVjdGlvbnMuRU1QVFlfTElTVAogICAgICAgICAgICA6IF9hZ2dMaXN0\nZW5lcnMudmFsdWVzKCk7CiAgICB9CgogICAgcHVibGljIEFnZ3JlZ2F0ZUxp\nc3RlbmVyIGdldEFnZ3JlZ2F0ZUxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAg\nICAgICAvLyBmaXJzdCBjaGVjayBsaXN0ZW5lcnMgZm9yIHRoaXMgcXVlcnkK\nICAgICAgICBpZiAoX2FnZ0xpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbiA9IChBZ2dyZWdhdGVMaXN0\nZW5lcikgX2FnZ0xpc3RlbmVycy4KICAgICAgICAgICAgICAgIGdldCh0YWcp\nOwogICAgICAgICAgICBpZiAobGlzdGVuICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbGlzdGVuOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hl\nY2sgdXNlci1kZWZpbmVkIGxpc3RlbmVycyBmcm9tIGNvbmZpZ3VyYXRpb24K\nICAgICAgICBBZ2dyZWdhdGVMaXN0ZW5lcltdIGNvbmZMaXN0ZW5lcnMgPSBf\nYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0QWdn\ncmVnYXRlTGlzdGVuZXJJbnN0YW5jZXMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbmZMaXN0ZW5lcnMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgIGlmIChjb25mTGlzdGVuZXJzW2ldLmdldFRhZygpLmVxdWFscyh0YWcp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZMaXN0ZW5lcnNbaV07Cgog\nICAgICAgIC8vIGNoZWNrIHN0b3JlIGxpc3RlbmVycwogICAgICAgIHJldHVy\nbiBfc3RvcmVRdWVyeS5nZXRBZ2dyZWdhdGVMaXN0ZW5lcih0YWcpOwogICAg\nfQoKICAgIHB1YmxpYyBFeHRlbnQgZ2V0Q2FuZGlkYXRlRXh0ZW50KCkgewog\nICAgICAgIC8vIGlmIGp1c3QgdGhlIGNsYXNzIGlzIHNldCwgZmV0Y2ggdGhl\nIGNvcnJlc3BvbmRpbmcgZXh0ZW50OyBpZiB0aGUKICAgICAgICAvLyBleHRl\nbnQgaXMgYWxyZWFkeSBzZXQgYnV0IGl0cyBpZ25vcmUgY2FjaGUgc2V0dGlu\nZyBpcyB3cm9uZywKICAgICAgICAvLyBnZXQgYSBuZXcgZXh0ZW50IHdpdGgg\ndGhlIGNvcnJlY3Qgc2V0dGluZyAoZG9uJ3QgbW9kaWZ5IG9yaWcgZXh0ZW50\nCiAgICAgICAgLy8gaW4gY2FzZSB0aGUgdXNlciBoYXMgYSByZWZlcmVuY2Ug\ndG8gaXQgYW5kIG1pZ2h0IHVzZSBpdCkKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3MgY2xzID0gZ2V0Q2FuZGlkYXRl\nVHlwZSgpOwogICAgICAgICAgICBpZiAoX2V4dGVudCA9PSBudWxsICYmIF9j\nb2xsZWN0aW9uID09IG51bGwgJiYgX2Jyb2tlciAhPSBudWxsCiAgICAgICAg\nICAgICAgICAmJiBjbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2V4\ndGVudCA9IF9icm9rZXIubmV3RXh0ZW50KGNscywgX3N1YmNsYXNzZXMpOwog\nICAgICAgICAgICAgICAgX2V4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKF9pZ25v\ncmVDaGFuZ2VzKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfZXh0ZW50ICE9\nIG51bGwKICAgICAgICAgICAgICAgICYmIF9leHRlbnQuZ2V0SWdub3JlQ2hh\nbmdlcygpICE9IF9pZ25vcmVDaGFuZ2VzICYmIGNscyAhPSBudWxsKXsKICAg\nICAgICAgICAgICAgIF9leHRlbnQgPSBfYnJva2VyLm5ld0V4dGVudChjbHMs\nIF9leHRlbnQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIF9l\neHRlbnQuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hhbmdlcyk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9leHRlbnQ7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbmRpZGF0ZUV4dGVudChFeHRl\nbnQgY2FuZGlkYXRlRXh0ZW50KSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAg\nYXNzZXJ0Tm90UmVhZE9ubHkoKTsKCiAgICAgICAgICAgIGlmIChjYW5kaWRh\ndGVFeHRlbnQgPT0gX2V4dGVudCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZUV4dGVudCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBfZXh0ZW50ID0gbnVsbDsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgZXh0\nZW50IHRoZW4gbm90IGNvbGxlY3Rpb24KICAgICAgICAgICAgX2V4dGVudCA9\nIGNhbmRpZGF0ZUV4dGVudDsKICAgICAgICAgICAgX2NvbGxlY3Rpb24gPSBu\ndWxsOwoKICAgICAgICAgICAgYm9vbGVhbiBpbnZhbGlkYXRlID0gZmFsc2U7\nCiAgICAgICAgICAgIGlmIChfZXh0ZW50LmdldEVsZW1lbnRUeXBlKCkgIT0g\nX2NsYXNzKSB7CiAgICAgICAgICAgICAgICBfY2xhc3MgPSBfZXh0ZW50Lmdl\ndEVsZW1lbnRUeXBlKCk7CiAgICAgICAgICAgICAgICBfbG9hZGVyID0gbnVs\nbDsKICAgICAgICAgICAgICAgIGludmFsaWRhdGUgPSB0cnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChfZXh0ZW50Lmhhc1N1YmNsYXNzZXMo\nKSAhPSBfc3ViY2xhc3NlcykgewogICAgICAgICAgICAgICAgX3N1YmNsYXNz\nZXMgPSBfZXh0ZW50Lmhhc1N1YmNsYXNzZXMoKTsKICAgICAgICAgICAgICAg\nIGludmFsaWRhdGUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChpbnZhbGlkYXRlKQogICAgICAgICAgICAgICAgaW52YWxpZGF0ZUNv\nbXBpbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0\naW9uIGdldENhbmRpZGF0ZUNvbGxlY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIHJldHVybiBfY29sbGVjdGlvbjsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDYW5kaWRhdGVDb2xsZWN0aW9uKENvbGxlY3Rp\nb24gY2FuZGlkYXRlQ29sbGVjdGlvbikgewogICAgICAgIGlmICghX3N0b3Jl\nUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInF1\nZXJ5LW5vc3VwcG9ydCIsCiAgICAgICAgICAgICAgICBfbGFuZ3VhZ2UpKTsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE9wZW4oKTsKCiAgICAgICAgICAgIC8vIGlmIGNvbGxlY3Rpb24gdGhl\nbiBub3QgZXh0ZW50CiAgICAgICAgICAgIF9jb2xsZWN0aW9uID0gY2FuZGlk\nYXRlQ29sbGVjdGlvbjsKICAgICAgICAgICAgaWYgKF9jb2xsZWN0aW9uICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gbnVsbDsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIENsYXNzIGdldENhbmRpZGF0ZVR5cGUoKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYgKF9jbGFzcyAhPSBudWxsIHx8\nIF9jb21waWxlZCAhPSBudWxsIHx8IF9xdWVyeSA9PSBudWxsCiAgICAgICAg\nICAgICAgICB8fCBfYnJva2VyID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gX2NsYXNzOwoKICAgICAgICAgICAgLy8gY2hlY2sgYWdhaW4gYWZ0\nZXIgY29tcGlsYXRpb247IG1heWJlIGVuY29kZWQgaW4gc3RyaW5nCiAgICAg\nICAgICAgIGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICBy\nZXR1cm4gX2NsYXNzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRDYW5kaWRhdGVUeXBlKENsYXNzIGNhbmRpZGF0ZUNsYXNzLCBib29sZWFu\nIHN1YnMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb3RSZWFk\nT25seSgpOwogICAgICAgICAgICBfY2xhc3MgPSBjYW5kaWRhdGVDbGFzczsK\nICAgICAgICAgICAgX3N1YmNsYXNzZXMgPSBzdWJzOwogICAgICAgICAgICBf\nbG9hZGVyID0gbnVsbDsKICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0\naW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc1N1\nYmNsYXNzZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJjbGFzc2VzOwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVzdWx0TWFwcGluZ05hbWUoKSB7\nCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBfcmVzdWx0\nTWFwcGluZ05hbWU7CiAgICB9CgogICAgcHVibGljIENsYXNzIGdldFJlc3Vs\ndE1hcHBpbmdTY29wZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgcmV0dXJuIF9yZXN1bHRNYXBwaW5nU2NvcGU7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0UmVzdWx0TWFwcGluZyhDbGFzcyBzY29wZSwgU3RyaW5n\nIG5hbWUpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBfcmVzdWx0TWFwcGlu\nZ1Njb3BlID0gc2NvcGU7CiAgICAgICAgICAgIF9yZXN1bHRNYXBwaW5nTmFt\nZSA9IG5hbWU7CiAgICAgICAgICAgIF9wYWNrZXIgPSBudWxsOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1VuaXF1ZSgpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgICAgICBpZiAoX3VuaXF1ZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIF91bmlxdWUuYm9vbGVhblZhbHVlKCk7CiAgICAg\nICAgICAgIGlmIChfcXVlcnkgPT0gbnVsbCB8fCBfY29tcGlsaW5nIHx8IF9i\ncm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgICAgIC8vIGNoZWNrIGFnYWluIGFmdGVyIGNvbXBpbGF0aW9u\nOyBtYXliZSBlbmNvZGVkIGluIHN0cmluZwogICAgICAgICAgICBpZiAoX2Nv\nbXBpbGVkID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbXBpbGVGb3JD\nb21waWxhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKF91bmlxdWUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3VuaXF1ZS5ib29s\nZWFuVmFsdWUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbm8g\nZXhwbGljaXQgc2V0dGluZzsgZGVmYXVsdAogICAgICAgICAgICBTdG9yZVF1\nZXJ5LkV4ZWN1dG9yIGV4ID0gY29tcGlsZUZvckV4ZWN1dG9yKCk7CiAgICAg\nICAgICAgIGlmICghZXguaXNBZ2dyZWdhdGUoX3N0b3JlUXVlcnkpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4g\nIWV4Lmhhc0dyb3VwaW5nKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0VW5pcXVlKGJvb2xlYW4gdW5pcXVlKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAg\nICAgICAgICAgX3VuaXF1ZSA9ICh1bmlxdWUpID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNz\nIGdldFJlc3VsdFR5cGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYg\nKF9yZXN1bHRDbGFzcyAhPSBudWxsIHx8IF9jb21waWxlZCAhPSBudWxsIHx8\nIF9xdWVyeSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBfYnJva2VyID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX3Jlc3VsdENsYXNzOwoK\nICAgICAgICAgICAgLy8gY2hlY2sgYWdhaW4gYWZ0ZXIgY29tcGlsYXRpb247\nIG1heWJlIGVuY29kZWQgaW4gc3RyaW5nCiAgICAgICAgICAgIGNvbXBpbGVG\nb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX3Jlc3VsdENs\nYXNzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXN1bHRU\neXBlKENsYXNzIGNscykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIC8vIGFs\nbG93ZWQgbW9kaWZpY2F0aW9uOiBubyByZWFkLW9ubHkgY2hlY2sKICAgICAg\nICAgICAgX3Jlc3VsdENsYXNzID0gY2xzOwogICAgICAgICAgICBfcGFja2Vy\nID0gbnVsbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U3Rh\ncnRSYW5nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0\ndXJuIF9zdGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRFbmRS\nYW5nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJu\nIF9lbmRJZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmFuZ2UobG9u\nZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBpZiAoc3RhcnQgPCAwIHx8\nIGVuZCA8IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJpbnZhbGlkLXJhbmdlIiwKICAgICAgICAgICAgICAgIFN0\ncmluZy52YWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZhbHVlT2YoZW5kKSkpOwoK\nICAgICAgICBpZiAoZW5kIC0gc3RhcnQgPiBJbnRlZ2VyLk1BWF9WQUxVRSAm\nJiBlbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJyYW5nZS10b28tYmlnIiwKICAg\nICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZh\nbHVlT2YoZW5kKSkpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAvLyBhbGxv\nd2VkIG1vZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5IGNoZWNrCiAgICAgICAg\nICAgIF9zdGFydElkeCA9IHN0YXJ0OwogICAgICAgICAgICBfZW5kSWR4ID0g\nZW5kOwogICAgICAgICAgICBfcmFuZ2VTZXQgPSB0cnVlOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFBhcmFtZXRlckRlY2xhcmF0aW9u\nKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfcGFyYW1zICE9IG51\nbGwgfHwgX2NvbXBpbGVkICE9IG51bGwgfHwgX2NvbXBpbGluZwogICAgICAg\nICAgICAgICAgfHwgX2Jyb2tlciA9PSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIF9wYXJhbXM7CgogICAgICAgICAgICAvLyBjaGVjayBhZ2FpbiBh\nZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcKICAg\nICAgICAgICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAg\nIHJldHVybiBfcGFyYW1zOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBkZWNsYXJlUGFyYW1ldGVycyhTdHJpbmcgcGFyYW1zKSB7CiAgICAgICAg\naWYgKCFfc3RvcmVRdWVyeS5zdXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9u\ncygpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRp\nb24oX2xvYy5nZXQoInF1ZXJ5LW5vc3VwcG9ydCIsCiAgICAgICAgICAgICAg\nICBfbGFuZ3VhZ2UpKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0\nTm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgX3BhcmFtcyA9IFN0cmluZ1V0\naWxzLnRyaW1Ub051bGwocGFyYW1zKTsKICAgICAgICAgICAgaW52YWxpZGF0\nZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGNvbXBpbGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgU3RvcmVRdWVy\neS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAgICAg\nICAgICBnZXRSZXN1bHRQYWNrZXIoX3N0b3JlUXVlcnksIGV4KTsKICAgICAg\nICAgICAgZXgudmFsaWRhdGUoX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGdldENvbXBpbGF0aW9uKCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29t\ncGlsZUZvckNvbXBpbGF0aW9uKCkuc3RvcmVEYXRhOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENvbXBpbGUgcXVlcnkgcHJvcGVydGllcy4KICAg\nICAqLwogICAgcHJpdmF0ZSBDb21waWxhdGlvbiBjb21waWxlRm9yQ29tcGls\nYXRpb24oKSB7CiAgICAgICAgaWYgKF9jb21waWxlZCAhPSBudWxsIHx8IF9j\nb21waWxpbmcpCiAgICAgICAgICAgIHJldHVybiBfY29tcGlsZWQ7CgogICAg\nICAgIGFzc2VydE5vdFNlcmlhbGl6ZWQoKTsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CgogICAgICAgIGJvb2xlYW4gcmVhZE9ubHkgPSBfcmVhZE9ubHk7CiAg\nICAgICAgX3JlYWRPbmx5ID0gZmFsc2U7CiAgICAgICAgX2NvbXBpbGluZyA9\nIHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2NvbXBpbGVkID0g\nY29tcGlsYXRpb25Gcm9tQ2FjaGUoKTsKICAgICAgICAgICAgcmV0dXJuIF9j\nb21waWxlZDsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9jb21waWxpbmcgPSBmYWxzZTsKICAgICAgICAgICAgX3JlYWRP\nbmx5ID0gcmVhZE9ubHk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogRmluZCB0aGUgY2FjaGVkIGNvbXBpbGF0aW9uIGZvciB0aGUgY3VycmVu\ndCBxdWVyeSwgY3JlYXRpbmcgb25lIGlmIGl0CiAgICAgKiBkb2VzIG5vdCBl\neGlzdC4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbXBpbGF0aW9uIGNvbXBp\nbGF0aW9uRnJvbUNhY2hlKCkgewogICAgICAgIE1hcCBjb21wQ2FjaGUgPQog\nICAgICAgICAgICBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRRdWVy\neUNvbXBpbGF0aW9uQ2FjaGVJbnN0YW5jZSgpOwogICAgICAgIGlmIChjb21w\nQ2FjaGUgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gbmV3Q29tcGls\nYXRpb24oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBDb21waWxh\ndGlvbktleSBrZXkgPSBuZXcgQ29tcGlsYXRpb25LZXkoKTsKICAgICAgICAg\nICAga2V5LnF1ZXJ5VHlwZSA9IF9zdG9yZVF1ZXJ5LmdldENsYXNzKCk7CiAg\nICAgICAgICAgIGtleS5jYW5kaWRhdGVUeXBlID0gZ2V0Q2FuZGlkYXRlVHlw\nZSgpOwogICAgICAgICAgICBrZXkuc3ViY2xhc3NlcyA9IGhhc1N1YmNsYXNz\nZXMoKTsKICAgICAgICAgICAga2V5LnF1ZXJ5ID0gZ2V0UXVlcnlTdHJpbmco\nKTsKICAgICAgICAgICAga2V5Lmxhbmd1YWdlID0gZ2V0TGFuZ3VhZ2UoKTsK\nICAgICAgICAgICAga2V5LnN0b3JlS2V5ID0gX3N0b3JlUXVlcnkubmV3Q29t\ncGlsYXRpb25LZXkoKTsKICAgICAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9\nIChDb21waWxhdGlvbikgY29tcENhY2hlLmdldChrZXkpOwoKICAgICAgICAg\nICAgLy8gcGFyc2UgZGVjbGFyYXRpb25zIGlmIG5lZWRlZAogICAgICAgICAg\nICBib29sZWFuIGNhY2hlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChjb21w\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbXAgPSBuZXdDb21waWxh\ndGlvbigpOwogICAgICAgICAgICAgICAgLy8gb25seSBjYWNoZSB0aG9zZSBx\ndWVyaWVzIHRoYXQgY2FuIGJlIGNvbXBpbGVkCiAgICAgICAgICAgICAgICBj\nYWNoZSA9IGNvbXAuc3RvcmVEYXRhICE9IG51bGw7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgX3N0b3JlUXVlcnkucG9wdWxhdGVGcm9t\nQ29tcGlsYXRpb24oY29tcC5zdG9yZURhdGEpOwoKICAgICAgICAgICAgLy8g\nY2FjaGUgcGFyc2VkIHN0YXRlIGlmIG5lZWRlZAogICAgICAgICAgICBpZiAo\nY2FjaGUpCiAgICAgICAgICAgICAgICBjb21wQ2FjaGUucHV0KGtleSwgY29t\ncCk7CiAgICAgICAgICAgIHJldHVybiBjb21wOwogICAgICAgIH0KICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRlIGEgbmV3\nIGNvbXBpbGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbXBpbGF0aW9u\nIG5ld0NvbXBpbGF0aW9uKCkgewogICAgICAgIENvbXBpbGF0aW9uIGNvbXAg\nPSBuZXcgQ29tcGlsYXRpb24oKTsKICAgICAgICBjb21wLnN0b3JlRGF0YSA9\nIF9zdG9yZVF1ZXJ5Lm5ld0NvbXBpbGF0aW9uKCk7CiAgICAgICAgX3N0b3Jl\nUXVlcnkucG9wdWxhdGVGcm9tQ29tcGlsYXRpb24oY29tcC5zdG9yZURhdGEp\nOwogICAgICAgIHJldHVybiBjb21wOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29tcGlsZSBmb3IgZXhlY3V0aW9uLCBjaG9vc2luZyBiZXR3ZWVuIGRhdGFz\ndG9yZSBhbmQgaW4tbWVtCiAgICAgKiBjb21waWxhdGlvbiBiYXNlZCBvbiB3\naGF0IHdlIHN1cHBvcnQgYW5kIG91ciBzZXR0aW5ncy4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGNvbXBpbGVGb3JFeGVjdXRv\ncigpIHsKICAgICAgICBDb21waWxhdGlvbiBjb21wID0gY29tcGlsZUZvckNv\nbXBpbGF0aW9uKCk7CiAgICAgICAgaWYgKF9jb2xsZWN0aW9uID09IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKGNvbXAuZGF0YXN0b3JlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gY29tcC5kYXRhc3RvcmU7CiAgICAgICAg\nICAgIGlmIChjb21wLm1lbW9yeSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGNvbXAubWVtb3J5OwogICAgICAgICAgICBpZiAoX3N0b3JlUXVl\ncnkuc3VwcG9ydHNEYXRhU3RvcmVFeGVjdXRpb24oKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXApOwogICAgICAg\nICAgICByZXR1cm4gY29tcGlsZUZvckluTWVtb3J5KGNvbXApOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKGNvbXAubWVtb3J5ICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBjb21wLm1lbW9yeTsKICAgICAgICBpZiAoY29tcC5kYXRh\nc3RvcmUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNvbXAuZGF0YXN0\nb3JlOwogICAgICAgIGlmIChfc3RvcmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5\nRXhlY3V0aW9uKCkpCiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9ySW5N\nZW1vcnkoY29tcCk7CiAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JEYXRhU3Rv\ncmUoY29tcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gZXhw\ncmVzc2lvbiB0cmVlIGZvciBkYXRhc3RvcmUgZXhlY3V0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY29tcGlsZUZvckRh\ndGFTdG9yZShDb21waWxhdGlvbiBjb21wKSB7CiAgICAgICAgaWYgKGNvbXAu\nZGF0YXN0b3JlID09IG51bGwpCiAgICAgICAgICAgIGNvbXAuZGF0YXN0b3Jl\nID0gY3JlYXRlRXhlY3V0b3IoZmFsc2UpOwogICAgICAgIHJldHVybiBjb21w\nLmRhdGFzdG9yZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiBl\neHByZXNzaW9uIHRyZWUgZm9yIGluLW1lbW9yeSBleGVjdXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRvciBjb21waWxlRm9y\nSW5NZW1vcnkoQ29tcGlsYXRpb24gY29tcCkgewogICAgICAgIGlmIChjb21w\nLm1lbW9yeSA9PSBudWxsKQogICAgICAgICAgICBjb21wLm1lbW9yeSA9IGNy\nZWF0ZUV4ZWN1dG9yKHRydWUpOwogICAgICAgIHJldHVybiBjb21wLm1lbW9y\neTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHF1ZXJ5IGV4ZWN1\ndG9yIG9mIHRoZSBwcm9wZXIgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBT\ndG9yZVF1ZXJ5LkV4ZWN1dG9yIGNyZWF0ZUV4ZWN1dG9yKGJvb2xlYW4gaW5N\nZW0pIHsKICAgICAgICBhc3NlcnRDYW5kaWRhdGVUeXBlKCk7CgogICAgICAg\nIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9icm9rZXIuZ2V0Q29uZmln\ndXJhdGlvbigpLgogICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJ\nbnN0YW5jZSgpOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHJlcG9z\nLmdldE1ldGFEYXRhKF9jbGFzcywKICAgICAgICAgICAgX2Jyb2tlci5nZXRD\nbGFzc0xvYWRlcigpLCBmYWxzZSk7CgogICAgICAgIENsYXNzTWV0YURhdGFb\nXSBtZXRhczsKICAgICAgICBpZiAoX2NsYXNzID09IG51bGwgfHwgX3N0b3Jl\nUXVlcnkuc3VwcG9ydHNBYnN0cmFjdEV4ZWN1dG9ycygpKQogICAgICAgICAg\nICBtZXRhcyA9IG5ldyBDbGFzc01ldGFEYXRhW117IG1ldGEgfTsKICAgICAg\nICBlbHNlIGlmIChfc3ViY2xhc3NlcyAmJiAobWV0YSA9PSBudWxsIHx8IG1l\ndGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpKQogICAgICAgICAgICBtZXRhcyA9\nIHJlcG9zLmdldEltcGxlbWVudG9yTWV0YURhdGFzKF9jbGFzcywKICAgICAg\nICAgICAgICAgIF9icm9rZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CiAg\nICAgICAgZWxzZSBpZiAobWV0YSAhPSBudWxsICYmIChfc3ViY2xhc3NlcyB8\nfCBtZXRhLmlzTWFwcGVkKCkpKQogICAgICAgICAgICBtZXRhcyA9IG5ldyBD\nbGFzc01ldGFEYXRhW117IG1ldGEgfTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIG1ldGFzID0gU3RvcmVRdWVyeS5FTVBUWV9NRVRBUzsKCiAgICAgICAg\naWYgKG1ldGFzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8taW1wbHMiLCBfY2xhc3MpKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobWV0YXMubGVuZ3RoID09\nIDEpIHsKICAgICAgICAgICAgICAgIGlmIChpbk1lbSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkubmV3SW5NZW1vcnlFeGVjdXRv\ncihtZXRhc1swXSwKICAgICAgICAgICAgICAgICAgICAgICAgX3N1YmNsYXNz\nZXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5Lm5ld0Rh\ndGFTdG9yZUV4ZWN1dG9yKG1ldGFzWzBdLCBfc3ViY2xhc3Nlcyk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIG11bHRpcGxlIGltcGxlbWVudG9y\ncwogICAgICAgICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yW10gZXMgPSBuZXcg\nU3RvcmVRdWVyeS5FeGVjdXRvclttZXRhcy5sZW5ndGhdOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGVzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoaW5NZW0pCiAgICAgICAgICAgICAgICAgICAgZXNb\naV0gPSBfc3RvcmVRdWVyeS5uZXdJbk1lbW9yeUV4ZWN1dG9yKG1ldGFzW2ld\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBlc1tpXSA9IF9zdG9yZVF1ZXJ5Lm5ld0RhdGFTdG9yZUV4ZWN1dG9y\nKG1ldGFzW2ldLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gbmV3IE1lcmdlZEV4ZWN1dG9yKGVzKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFueSBjb21waWxh\ndGlvbiwgZm9yY2luZyB0aGlzIHF1ZXJ5IHRvIGJlIHJlY29tcGlsZWQKICAg\nICAqIG5leHQgdGltZSBpdCdzIGV4ZWN1dGVkLiBUaGlzIHNob3VsZCBiZSBp\nbnZva2VkIHdoZW5ldmVyIGFueQogICAgICogc3RhdGUgY2hhbmdlcyB0aGF0\nIHdvdWxkIGNhdXNlIHRoZSB1bmRlcmx5aW5nIHF1ZXJ5CiAgICAgKiByZXBy\nZXNlbnRhdGlvbiB0byBjaGFuZ2UuCiAgICAgKgogICAgICogQHNpbmNlIDAu\nMy4wCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpbnZhbGlkYXRlQ29t\ncGlsYXRpb24oKSB7CiAgICAgICAgaWYgKF9jb21waWxpbmcpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBfc3RvcmVRdWVyeS5pbnZhbGlk\nYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICBfY29tcGlsZWQgPSBudWxsOwog\nICAgICAgIF9wYWNrZXIgPSBudWxsOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZXhlY3V0ZSgpIHsKICAgICAgICBy\nZXR1cm4gZXhlY3V0ZSgoT2JqZWN0W10pIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZXhlY3V0ZShPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICByZXR1cm4gZXhlY3V0ZShPUF9TRUxFQ1QsIHBhcmFtcyk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBleGVjdXRlKE1hcCBwYXJhbXMpIHsKICAgICAg\nICByZXR1cm4gZXhlY3V0ZShPUF9TRUxFQ1QsIHBhcmFtcyk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBPYmplY3QgZXhlY3V0ZShpbnQgb3BlcmF0aW9uLCBPYmpl\nY3RbXSBwYXJhbXMpIHsKICAgICAgICBpZiAocGFyYW1zID09IG51bGwpCiAg\nICAgICAgICAgIHBhcmFtcyA9IFN0b3JlUXVlcnkuRU1QVFlfT0JKRUNUUzsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE5vdFNlcmlhbGl6ZWQoKTsKICAgICAgICAgICAgX2Jyb2tlci5iZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgICAgIF9icm9rZXIu\nYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgICAg\nICAvLyBnZXQgZXhlY3V0b3IKICAgICAgICAgICAgICAgIENvbXBpbGF0aW9u\nIGNvbXAgPSBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAg\nICAgIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXggPSAoaXNJbk1lbW9yeShvcGVy\nYXRpb24pKQogICAgICAgICAgICAgICAgICAgID8gY29tcGlsZUZvckluTWVt\nb3J5KGNvbXApIDogY29tcGlsZUZvckRhdGFTdG9yZShjb21wKTsKCiAgICAg\nICAgICAgICAgICBhc3NlcnRQYXJhbWV0ZXJzKF9zdG9yZVF1ZXJ5LCBleCwg\ncGFyYW1zKTsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nRXhlY3V0aW9uKG9wZXJh\ndGlvbiwgZXguZ2V0UGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpLAogICAg\nICAgICAgICAgICAgICAgICAgICBwYXJhbXMpOwoKICAgICAgICAgICAgICAg\nIGlmIChvcGVyYXRpb24gPT0gT1BfU0VMRUNUKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBleGVjdXRlKF9zdG9yZVF1ZXJ5LCBleCwgcGFyYW1zKTsK\nICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0gT1BfREVMRVRFKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxldGUoX3N0b3JlUXVlcnks\nIGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9\nPSBPUF9VUERBVEUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0\nZShfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihl\nKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9i\ncm9rZXIuZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBleGVjdXRlKGludCBv\ncGVyYXRpb24sIE1hcCBwYXJhbXMpIHsKICAgICAgICBpZiAocGFyYW1zID09\nIG51bGwpCiAgICAgICAgICAgIHBhcmFtcyA9IENvbGxlY3Rpb25zLkVNUFRZ\nX01BUDsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIF9icm9rZXIuYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBhc3NlcnROb3RTZXJpYWxpemVkKCk7\nCiAgICAgICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgICAg\nICBfYnJva2VyLmFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAg\nICAgICAgICAgICAgLy8gZ2V0IGV4ZWN1dG9yCiAgICAgICAgICAgICAgICBD\nb21waWxhdGlvbiBjb21wID0gY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAg\nICAgICAgICAgICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gKGlzSW5N\nZW1vcnkob3BlcmF0aW9uKSkKICAgICAgICAgICAgICAgICAgICA/IGNvbXBp\nbGVGb3JJbk1lbW9yeShjb21wKSA6IGNvbXBpbGVGb3JEYXRhU3RvcmUoY29t\ncCk7CgogICAgICAgICAgICAgICAgT2JqZWN0W10gYXJyID0gKHBhcmFtcy5p\nc0VtcHR5KCkpID8gU3RvcmVRdWVyeS5FTVBUWV9PQkpFQ1RTIDoKICAgICAg\nICAgICAgICAgICAgICB0b1BhcmFtZXRlckFycmF5KGV4LmdldFBhcmFtZXRl\nclR5cGVzKF9zdG9yZVF1ZXJ5KSwgcGFyYW1zKTsKICAgICAgICAgICAgICAg\nIGFzc2VydFBhcmFtZXRlcnMoX3N0b3JlUXVlcnksIGV4LCBhcnIpOwogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBsb2dFeGVjdXRpb24ob3BlcmF0aW9uLCBwYXJhbXMp\nOwoKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0gT1BfU0VMRUNU\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBleGVjdXRlKF9zdG9yZVF1\nZXJ5LCBleCwgYXJyKTsKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24g\nPT0gT1BfREVMRVRFKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxl\ndGUoX3N0b3JlUXVlcnksIGV4LCBhcnIpOwogICAgICAgICAgICAgICAgaWYg\nKG9wZXJhdGlvbiA9PSBPUF9VUERBVEUpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHVwZGF0ZShfc3RvcmVRdWVyeSwgZXgsIGFycik7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIF9icm9rZXIuZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxldGVB\nbGwoKSB7CiAgICAgICAgcmV0dXJuIGRlbGV0ZUFsbCgoT2JqZWN0W10pIG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGRlbGV0ZUFsbChPYmplY3Rb\nXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGV4ZWN1dGUo\nT1BfREVMRVRFLCBwYXJhbXMpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBw\ndWJsaWMgbG9uZyBkZWxldGVBbGwoTWFwIHBhcmFtcykgewogICAgICAgIHJl\ndHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9ERUxFVEUsIHBhcmFtcykpLmxv\nbmdWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbCgp\nIHsKICAgICAgICByZXR1cm4gdXBkYXRlQWxsKChPYmplY3RbXSkgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIGxvbmcgdXBkYXRlQWxsKE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgIHJldHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9V\nUERBVEUsIHBhcmFtcykpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBsb25nIHVwZGF0ZUFsbChNYXAgcGFyYW1zKSB7CiAgICAgICAgcmV0dXJu\nICgoTnVtYmVyKSBleGVjdXRlKE9QX1VQREFURSwgcGFyYW1zKSkubG9uZ1Zh\nbHVlKCk7CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3RbXSB0b1BhcmFtZXRl\nckFycmF5KExpbmtlZE1hcCBwYXJhbVR5cGVzLCBNYXAgcGFyYW1zKSB7CiAg\nICAgICAgaWYgKHBhcmFtcyA9PSBudWxsIHx8IHBhcmFtcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX09CSkVDVFM7\nCgogICAgICAgIE9iamVjdFtdIGFyciA9IG5ldyBPYmplY3RbcGFyYW1zLnNp\nemUoKV07CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIE9iamVj\ndCBrZXk7CiAgICAgICAgaW50IGlkeDsKICAgICAgICBpbnQgYmFzZSA9IC0x\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGFyYW1zLmVudHJ5U2V0\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICBr\nZXkgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgaWR4ID0gKHBhcmFt\nVHlwZXMgPT0gbnVsbCkgPyAtMSA6IHBhcmFtVHlwZXMuaW5kZXhPZihrZXkp\nOwoKICAgICAgICAgICAgLy8gYWxsb3cgcG9zaXRpb25hbCBwYXJhbWV0ZXJz\nIGFuZCBuYXR1cmFsIG9yZGVyIHBhcmFtZXRlcnMKICAgICAgICAgICAgaWYg\nKGlkeCAhPSAtMSkKICAgICAgICAgICAgICAgIGFycltpZHhdID0gZW50cnku\nZ2V0VmFsdWUoKTsKICAgICAgICAgICAgZWxzZSBpZiAoa2V5IGluc3RhbmNl\nb2YgTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoYmFzZSA9PSAtMSkK\nICAgICAgICAgICAgICAgICAgICBiYXNlID0gcG9zaXRpb25hbFBhcmFtZXRl\nckJhc2UocGFyYW1zLmtleVNldCgpKTsKICAgICAgICAgICAgICAgIGFyclso\nKE51bWJlcikga2V5KS5pbnRWYWx1ZSgpIC0gYmFzZV0gPSBlbnRyeS5nZXRW\nYWx1ZSgpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGFyYW0tbmFt\nZSIsIGtleSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBiYXNlIChnZW5lcmFsbHkg\nMCBvciAxKSB0byB1c2UgZm9yIHBvc2l0aW9uYWwgcGFyYW1ldGVycy4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHBvc2l0aW9uYWxQYXJhbWV0\nZXJCYXNlKENvbGxlY3Rpb24gcGFyYW1zKSB7CiAgICAgICAgaW50IGxvdyA9\nIEludGVnZXIuTUFYX1ZBTFVFOwogICAgICAgIE9iamVjdCBvYmo7CiAgICAg\nICAgaW50IHZhbDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhcmFt\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBv\nYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoIShvYmogaW5zdGFu\nY2VvZiBOdW1iZXIpKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7IC8vIHVz\nZSAwIGJhc2Ugd2hlbiBwYXJhbXMgYXJlIG1peGVkIHR5cGVzCgogICAgICAg\nICAgICB2YWwgPSAoKE51bWJlcikgb2JqKS5pbnRWYWx1ZSgpOwogICAgICAg\nICAgICBpZiAodmFsID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gdmFs\nOwogICAgICAgICAgICBpZiAodmFsIDwgbG93KQogICAgICAgICAgICAgICAg\nbG93ID0gdmFsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG93OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgd2Ugc2hvdWxkIGV4\nZWN1dGUgdGhpcyBxdWVyeSBpbiBtZW1vcnkuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBpc0luTWVtb3J5KGludCBvcGVyYXRpb24pIHsKICAgICAg\nICAvLyBpZiBubyBjYW5kaWRhdGVzLCBjcmVhdGUgY2FuZGlkYXRlIGV4dGVu\ndAogICAgICAgIGlmIChfY29sbGVjdGlvbiA9PSBudWxsICYmIF9leHRlbnQg\nPT0gbnVsbCAmJiBfY2xhc3MgIT0gbnVsbCkgewogICAgICAgICAgICBfZXh0\nZW50ID0gX2Jyb2tlci5uZXdFeHRlbnQoX2NsYXNzLCBfc3ViY2xhc3Nlcyk7\nCiAgICAgICAgICAgIF9leHRlbnQuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3Jl\nQ2hhbmdlcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGVyZSBhcmUg\nYW55IGRpcnR5IGluc3RhbmNlcyBpbiB0aGUgY3VycmVudCB0cmFucyB0aGF0\nIGFyZQogICAgICAgIC8vIGludm9sdmVkIGluIHRoaXMgcXVlcnksIHdlIGhh\ndmUgdG8gZXhlY3V0ZSBpbiBtZW1vcnkgb3IgZmx1c2gKICAgICAgICBib29s\nZWFuIGluTWVtID0gIV9zdG9yZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhl\nY3V0aW9uKCkKICAgICAgICAgICAgfHwgX2NvbGxlY3Rpb24gIT0gbnVsbDsK\nICAgICAgICBpZiAoIWluTWVtICYmICghX2lnbm9yZUNoYW5nZXMgfHwgb3Bl\ncmF0aW9uICE9IE9QX1NFTEVDVCkKICAgICAgICAgICAgJiYgX2Jyb2tlci5p\nc0FjdGl2ZSgpICYmIGlzQWNjZXNzUGF0aERpcnR5KCkpIHsKICAgICAgICAg\nICAgaW50IGZsdXNoID0gX2ZjLmdldEZsdXNoQmVmb3JlUXVlcmllcygpOwog\nICAgICAgICAgICBpZiAoKGZsdXNoID09IEZMVVNIX1RSVUUKICAgICAgICAg\nICAgICAgIHx8IChmbHVzaCA9PSBGTFVTSF9XSVRIX0NPTk5FQ1RJT04gJiYg\nX2Jyb2tlci5oYXNDb25uZWN0aW9uKCkpCiAgICAgICAgICAgICAgICB8fCBv\ncGVyYXRpb24gIT0gT1BfU0VMRUNUCiAgICAgICAgICAgICAgICB8fCAhX3N0\nb3JlUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpKQogICAgICAg\nICAgICAgICAgJiYgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuc3VwcG9y\ndGVkT3B0aW9ucygpLgogICAgICAgICAgICAgICAgY29udGFpbnMoT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24uT1BUSU9OX0lOQ19GTFVTSCkpIHsKICAgICAgICAg\nICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgICAgICBfbG9nLmluZm8oX2xvYy5nZXQoImZvcmNlLWlu\nLW1lbSIsIF9jbGFzcykpOwogICAgICAgICAgICAgICAgaW5NZW0gPSB0cnVl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5NZW0g\nJiYgIV9zdG9yZVF1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgiY2FudC1leGVjLWlubWVtIiwKICAgICAgICAgICAgICAgIF9s\nYW5ndWFnZSkpOwogICAgICAgIHJldHVybiBpbk1lbTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEV4ZWN1dGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBnaXZlbiBj\nb21waWxhdGlvbiwgZXhlY3V0b3IsIGFuZCBwYXJhbWV0ZXIKICAgICAqIHZh\nbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0ZSB0byB0\naGlzIG9uZSBvciB0bwogICAgICoge0BsaW5rICNleGVjdXRlKFN0b3JlUXVl\ncnkuRXhlY3V0b3IsTWFwKX0gYWZ0ZXIgdmFsaWRhdGlvbiBhbmQgbG9ja2lu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZXhlY3V0ZShTdG9yZVF1\nZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIAogICAgICAgIE9iamVj\ndFtdIHBhcmFtcykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBpZiB0aGlzIGlzIGFuIGltcG9zc2libGUgcmVzdWx0IHJhbmdlLCBy\nZXR1cm4gbnVsbCAvIGVtcHR5IGxpc3QKICAgICAgICBTdG9yZVF1ZXJ5LlJh\nbmdlIHJhbmdlID0gbmV3IFN0b3JlUXVlcnkuUmFuZ2UoX3N0YXJ0SWR4LCBf\nZW5kSWR4KTsKICAgICAgICBpZiAoIV9yYW5nZVNldCkKICAgICAgICAgICAg\nZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5nZSk7CiAgICAgICAgaWYgKHJh\nbmdlLnN0YXJ0ID49IHJhbmdlLmVuZCkKICAgICAgICAgICAgcmV0dXJuIGVt\ncHR5UmVzdWx0KHEsIGV4KTsKCiAgICAgICAgLy8gZXhlY3V0ZTsgaWYgd2Ug\naGF2ZSBhIHJlc3VsdCBjbGFzcyBvciB3ZSBoYXZlIG9ubHkgb25lIHJlc3Vs\ndAogICAgICAgIC8vIGFuZCBzbyBuZWVkIHRvIHJlbW92ZSBpdCBmcm9tIGl0\ncyBhcnJheSwgd3JhcCBpbiBhIHBhY2tpbmcgcm9wCiAgICAgICAgcmFuZ2Uu\nbHJzID0gaXNMUlMocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7CiAgICAgICAg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wID0gZXguZXhlY3V0ZVF1ZXJ5KHEs\nIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiB0b1Jlc3VsdChxLCBleCwgcm9wLCByYW5nZSk7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKHJvcCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcm9wLmNsb3NlKCk7IH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlMikge30KICAgICAgICAgICAgdGhyb3cgZTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgdGhlIHF1ZXJ5\nIHVzaW5nIHRoZSBnaXZlbiBleGVjdXRvciwgYW5kIHBhcmFtZXRlcgogICAg\nICogdmFsdWVzLiBBbGwgb3RoZXIgZXhlY3V0ZSBtZXRob2RzIGRlbGVnYXRl\nIHRvIHRoaXMgb25lIG9yIHRvCiAgICAgKiB7QGxpbmsgI2RlbGV0ZShTdG9y\nZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZhbGlkYXRpb24gYW5kIGxv\nY2tpbmcuCiAgICAgKiBUaGUgcmV0dXJuIHZhbHVlIHdpbGwgYmUgYSBOdW1i\nZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mCiAgICAgKiBpbnN0YW5jZXMg\nZGVsZXRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBOdW1iZXIgZGVsZXRlKFN0\nb3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgT2JqZWN0W10g\ncGFyYW1zKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGFz\nc2VydEJ1bGtNb2RpZnkocSwgZXgsIHBhcmFtcyk7CiAgICAgICAgcmV0dXJu\nIGV4LmV4ZWN1dGVEZWxldGUocSwgcGFyYW1zKTsKICAgIH0KCiAgICBwdWJs\naWMgTnVtYmVyIGRlbGV0ZUluTWVtb3J5KFN0b3JlUXVlcnkgcSwgU3RvcmVR\ndWVyeS5FeGVjdXRvciBleGVjdXRvciwKICAgICAgICBPYmplY3RbXSBwYXJh\nbXMpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBPYmplY3QgbyA9IGV4\nZWN1dGUocSwgZXhlY3V0b3IsIHBhcmFtcyk7CiAgICAgICAgICAgIGlmICgh\nKG8gaW5zdGFuY2VvZiBDb2xsZWN0aW9uKSkKICAgICAgICAgICAgICAgIG8g\nPSBDb2xsZWN0aW9ucy5zaW5nbGV0b24obyk7CgogICAgICAgICAgICBpbnQg\nc2l6ZSA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaSA9ICgoQ29s\nbGVjdGlvbikgbykuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7IHNpemUrKykK\nICAgICAgICAgICAgICAgIF9icm9rZXIuZGVsZXRlKGkubmV4dCgpLCBudWxs\nKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihzaXplKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGUpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgcXVl\ncnkgdXNpbmcgdGhlIGdpdmVuIGNvbXBpbGF0aW9uLCBleGVjdXRvciwgYW5k\nIHBhcmFtZXRlcgogICAgICogdmFsdWVzLiBBbGwgb3RoZXIgZXhlY3V0ZSBt\nZXRob2RzIGRlbGVnYXRlIHRvIHRoaXMgb25lIG9yIHRvCiAgICAgKiB7QGxp\nbmsgI3VwZGF0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZh\nbGlkYXRpb24gYW5kIGxvY2tpbmcuCiAgICAgKiBUaGUgcmV0dXJuIHZhbHVl\nIHdpbGwgYmUgYSBOdW1iZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mCiAg\nICAgKiBpbnN0YW5jZXMgdXBkYXRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBO\ndW1iZXIgdXBkYXRlKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRv\nciBleCwgT2JqZWN0W10gcGFyYW1zKQogICAgICAgIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGFzc2VydEJ1bGtNb2RpZnkocSwgZXgsIHBhcmFtcyk7\nCiAgICAgICAgcmV0dXJuIGV4LmV4ZWN1dGVVcGRhdGUocSwgcGFyYW1zKTsK\nICAgIH0KCiAgICBwdWJsaWMgTnVtYmVyIHVwZGF0ZUluTWVtb3J5KFN0b3Jl\nUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleGVjdXRvciwKICAgICAg\nICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBPYmplY3QgbyA9IGV4ZWN1dGUocSwgZXhlY3V0b3IsIHBhcmFtcyk7CiAg\nICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBDb2xsZWN0aW9uKSkKICAg\nICAgICAgICAgICAgIG8gPSBDb2xsZWN0aW9ucy5zaW5nbGV0b24obyk7Cgog\nICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaSA9ICgoQ29sbGVjdGlvbikgbykuaXRlcmF0b3IoKTsgaS5oYXNO\nZXh0KCk7IHNpemUrKykKICAgICAgICAgICAgICAgIHVwZGF0ZUluTWVtb3J5\nKGkubmV4dCgpLCBwYXJhbXMpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVy\ncy52YWx1ZU9mKHNpemUpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSB2YWx1ZXMgZm9yIHRoZSB1cGRhdGVzIGluIG1lbW9yeS4K\nICAgICAqCiAgICAgKiBAcGFyYW0gb2IgdGhlIHBlcnNpc3RlbnQgaW5zdGFu\nY2UgdG8gY2hhbmdlCiAgICAgKiBAcGFyYW0gcGFyYW1zIHRoZSBwYXJhbWV0\nZXJzIHBhc3NlZCB0byB0aGUgcXVlcnkKICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHVwZGF0ZUluTWVtb3J5KE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdCA9IGdldFVwZGF0ZXMoKS5l\nbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgIGl0Lmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBp\ndC5uZXh0KCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gKEZp\nZWxkTWV0YURhdGEpIGUuZ2V0S2V5KCk7CgogICAgICAgICAgICBPYmplY3Qg\ndmFsOwogICAgICAgICAgICBPYmplY3QgdmFsdWUgPSBlLmdldFZhbHVlKCk7\nCiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFZhbCkgewogICAg\nICAgICAgICAgICAgdmFsID0gKChWYWwpIHZhbHVlKS4KICAgICAgICAgICAg\nICAgICAgICBldmFsdWF0ZShvYiwgbnVsbCwgZ2V0U3RvcmVDb250ZXh0KCks\nIHBhcmFtcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFu\nY2VvZiBMaXRlcmFsKSB7CiAgICAgICAgICAgICAgICB2YWwgPSAoKExpdGVy\nYWwpIHZhbHVlKS5nZXRWYWx1ZSgpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHZhbHVlIGluc3RhbmNlb2YgQ29uc3RhbnQpIHsKICAgICAgICAgICAgICAg\nIHZhbCA9ICgoQ29uc3RhbnQpIHZhbHVlKS5nZXRWYWx1ZShwYXJhbXMpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm9ubHktdXBkYXRlLXByaW1pdGl2\nZXMiKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdlcihvYik7CiAg\nICAgICAgICAgIGludCBpID0gZm1kLmdldEluZGV4KCk7CiAgICAgICAgICAg\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvID0gKFBlcnNpc3RlbmNlQ2FwYWJs\nZSkgb2I7CgogICAgICAgICAgICAvLyBzZXQgdGhlIGFjdHVhbCBmaWVsZCBp\nbiB0aGUgaW5zdGFuY2UKICAgICAgICAgICAgaW50IHNldCA9IE9wZW5KUEFT\ndGF0ZU1hbmFnZXIuU0VUX1VTRVI7CiAgICAgICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgICAgICBzbS5z\nZXR0aW5nQm9vbGVhbkZpZWxkKGludG8sIGksIHNtLmZldGNoQm9vbGVhbkZp\nZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/\nIGZhbHNlIDogKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBzZXQpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToK\nICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nQnl0ZUZpZWxkKGludG8s\nIGksIHNtLmZldGNoQnl0ZUZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAg\nICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5ieXRlVmFs\ndWUoKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAg\nICAgICAgc20uc2V0dGluZ0NoYXJGaWVsZChpbnRvLCBpLCBzbS5mZXRjaENo\nYXJGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51\nbGwgPyAwIDogdmFsLnRvU3RyaW5nKCkuY2hhckF0KDApLCBzZXQpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRp\nbmdEb3VibGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaERvdWJsZUZpZWxkKGkp\nLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAo\nKE51bWJlcikgdmFsKS5kb3VibGVWYWx1ZSgpLCBzZXQpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0Zsb2F0\nRmllbGQoaW50bywgaSwgc20uZmV0Y2hGbG9hdEZpZWxkKGkpLAogICAgICAg\nICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikg\ndmFsKS5mbG9hdFZhbHVlKCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0ludEZpZWxkKGludG8sIGks\nIHNtLmZldGNoSW50RmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmludFZhbHVlKCks\nIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdMb25nRmllbGQoaW50bywgaSwgc20uZmV0Y2hMb25nRmll\nbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8g\nMCA6ICgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ1No\nb3J0RmllbGQoaW50bywgaSwgc20uZmV0Y2hTaG9ydEZpZWxkKGkpLAogICAg\nICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJl\ncikgdmFsKS5zaG9ydFZhbHVlKCksIHNldCk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJ\nTkc6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ1N0cmluZ0ZpZWxk\nKGludG8sIGksIHNtLmZldGNoU3RyaW5nRmllbGQoaSksCiAgICAgICAgICAg\nICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gbnVsbCA6IHZhbC50b1N0cmlu\nZygpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVF9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRf\nT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0\naW5nT2JqZWN0RmllbGQoaW50bywgaSwgc20uZmV0Y2hPYmplY3RGaWVsZChp\nKSwgdmFsLAogICAgICAgICAgICAgICAgICAgICAgICBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgib25seS11cGRhdGUtcHJpbWl0aXZlcyIpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyYWNlIGxv\nZyB0aGF0IHRoZSBxdWVyeSBpcyBleGVjdXRpbmcuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBsb2dFeGVjdXRpb24oaW50IG9wLCBMaW5rZWRNYXAgdHlw\nZXMsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIE1hcCBwbWFwID0gQ29s\nbGVjdGlvbnMuRU1QVFlfTUFQOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3Ro\nID4gMCkgewogICAgICAgICAgICBwbWFwID0gbmV3IEhhc2hNYXAoKGludCkg\nKHBhcmFtcy5sZW5ndGggKiAxLjMzICsgMSkpOwogICAgICAgICAgICBpZiAo\ndHlwZXMgIT0gbnVsbCAmJiB0eXBlcy5zaXplKCkgPT0gcGFyYW1zLmxlbmd0\naCkgewogICAgICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSB0eXBlcy5rZXlTZXQoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBwbWFw\nLnB1dChpdHIubmV4dCgpLCBwYXJhbXNbaSsrXSk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBh\ncmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBwbWFwLnB1\ndChTdHJpbmcudmFsdWVPZihpKSwgcGFyYW1zW2ldKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBsb2dFeGVjdXRpb24ob3AsIHBtYXApOwog\nICAgfQoKICAgIC8qKgogICAgICogVHJhY2UgbG9nIHRoYXQgdGhlIHF1ZXJ5\nIGlzIGV4ZWN1dGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvZ0V4\nZWN1dGlvbihpbnQgb3AsIE1hcCBwYXJhbXMpIHsKICAgICAgICBTdHJpbmcg\ncyA9IF9xdWVyeTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShz\nKSkKICAgICAgICAgICAgcyA9IHRvU3RyaW5nKCk7CgogICAgICAgIFN0cmlu\nZyBtc2cgPSAiZXhlY3V0aW5nLXF1ZXJ5IjsKICAgICAgICBpZiAoIXBhcmFt\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgIG1zZyArPSAiLXdpdGgtcGFyYW1z\nIjsKCiAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldChtc2csIHMsIHBhcmFt\ncykpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhp\ncyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIHBvdGVudGlhbCBsYXJnZSByZXN1\nbHQgc2V0LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNMUlMobG9u\nZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBsb25nIHJhbmdlID0gZW5k\nIC0gc3RhcnQ7CiAgICAgICAgcmV0dXJuIF9mYy5nZXRGZXRjaEJhdGNoU2l6\nZSgpID49IDAKICAgICAgICAgICAgJiYgIShyYW5nZSA8PSBfZmMuZ2V0RmV0\nY2hCYXRjaFNpemUoKQogICAgICAgICAgICB8fCAoX2ZjLmdldEZldGNoQmF0\nY2hTaXplKCkgPT0gMCAmJiByYW5nZSA8PSA1MCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBxdWVyeSByZXN1bHQgZm9yIHRoZSBnaXZl\nbiByZXN1bHQgb2JqZWN0IHByb3ZpZGVyLgogICAgICovCiAgICBwcm90ZWN0\nZWQgT2JqZWN0IHRvUmVzdWx0KFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5F\neGVjdXRvciBleCwgCiAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9w\nLCBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKQogICAgICAgIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIC8vIHBhY2sgcHJvamVjdGlvbnMgaWYgbmVjZXNz\nYXJ5CiAgICAgICAgU3RyaW5nW10gYWxpYXNlcyA9IGV4LmdldFByb2plY3Rp\nb25BbGlhc2VzKHEpOwogICAgICAgIGlmICghZXguaXNQYWNraW5nKHEpKSB7\nCiAgICAgICAgICAgIFJlc3VsdFBhY2tlciBwYWNrZXIgPSBnZXRSZXN1bHRQ\nYWNrZXIocSwgZXgpOwogICAgICAgICAgICBpZiAocGFja2VyICE9IG51bGwg\nfHwgYWxpYXNlcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgIHJvcCA9\nIG5ldyBQYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCBwYWNrZXIs\nCiAgICAgICAgICAgICAgICAgICAgYWxpYXNlcy5sZW5ndGgpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaWYgc2luZ2xlIHJlc3VsdCwgZXh0cmFjdCBpdAog\nICAgICAgIGlmIChfdW5pcXVlID09IEJvb2xlYW4uVFJVRSB8fCAoYWxpYXNl\ncy5sZW5ndGggPiAwCiAgICAgICAgICAgICYmICFleC5oYXNHcm91cGluZyhx\nKSAmJiBleC5pc0FnZ3JlZ2F0ZShxKSkpCiAgICAgICAgICAgIHJldHVybiBz\naW5nbGVSZXN1bHQocm9wLCByYW5nZSk7CgogICAgICAgIC8vIG5vdyB0aGF0\nIHdlJ3ZlIGV4ZWN1dGVkIHRoZSBxdWVyeSwgd2UgY2FuIGNhbGwgaXNBZ2dy\nZWdhdGUgYW5kCiAgICAgICAgLy8gaGFzR3JvdXBpbmcgZWZmaWNpZW50bHkK\nICAgICAgICBib29sZWFuIGRldGFjaCA9IChfYnJva2VyLmdldEF1dG9EZXRh\nY2goKSAmCiAgICAgICAgICAgIEF1dG9EZXRhY2guREVUQUNIX05PTlRYUkVB\nRCkgPiAwICYmICFfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgYm9vbGVh\nbiBscnMgPSByYW5nZS5scnMgJiYgIWV4LmlzQWdncmVnYXRlKHEpICYmICFl\neC5oYXNHcm91cGluZyhxKTsKICAgICAgICBSZXN1bHRMaXN0IHJlcyA9ICgh\nZGV0YWNoICYmIGxycykgPyBfZmMubmV3UmVzdWx0TGlzdChyb3ApCiAgICAg\nICAgICAgIDogbmV3IEVhZ2VyUmVzdWx0TGlzdChyb3ApOwoKICAgICAgICBf\ncmVzdWx0TGlzdHMuYWRkKGRlY29yYXRlUmVzdWx0TGlzdChyZXMpKTsKICAg\nICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8qKgogICAgICogT3B0aW9u\nYWxseSBkZWNvcmF0ZSB0aGUgbmF0aXZlIHJlc3VsdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFJlc3VsdExpc3QgZGVjb3JhdGVSZXN1bHRMaXN0KFJlc3Vs\ndExpc3QgcmVzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdmVPbkNsb3Nl\nUmVzdWx0TGlzdChyZXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgcmVzdWx0IHBhY2tlciBmb3IgdGhpcyBwcm9qZWN0aW9uLCBvciBudWxs\nLgogICAgICovCiAgICBwcml2YXRlIFJlc3VsdFBhY2tlciBnZXRSZXN1bHRQ\nYWNrZXIoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4KSB7\nCiAgICAgICAgaWYgKF9wYWNrZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIF9wYWNrZXI7CgogICAgICAgIENsYXNzIHJlc3VsdENsYXNzID0gKF9y\nZXN1bHRDbGFzcyAhPSBudWxsKSA/IF9yZXN1bHRDbGFzcwogICAgICAgICAg\nICA6IGV4LmdldFJlc3VsdENsYXNzKHEpOwogICAgICAgIGlmIChyZXN1bHRD\nbGFzcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgU3RyaW5nW10gYWxpYXNlcyA9IGV4LmdldFByb2plY3Rpb25BbGlhc2Vz\nKHEpOwogICAgICAgIGlmIChhbGlhc2VzLmxlbmd0aCA9PSAwKSB7CiAgICAg\nICAgICAgIC8vIHJlc3VsdCBjbGFzcyBidXQgbm8gcmVzdWx0OyBtZWFucyBj\nYW5kaWRhdGUgaXMgYmVpbmcgc2V0CiAgICAgICAgICAgIC8vIGludG8gc29t\nZSByZXN1bHQgY2xhc3MKICAgICAgICAgICAgX3BhY2tlciA9IG5ldyBSZXN1\nbHRQYWNrZXIoX2NsYXNzLCBnZXRBbGlhcygpLCByZXN1bHRDbGFzcyk7CiAg\nICAgICAgfSBlbHNlIGlmIChyZXN1bHRDbGFzcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIHByb2plY3Rpb24KICAgICAgICAgICAgQ2xhc3NbXSB0eXBl\ncyA9IGV4LmdldFByb2plY3Rpb25UeXBlcyhxKTsKICAgICAgICAgICAgX3Bh\nY2tlciA9IG5ldyBSZXN1bHRQYWNrZXIodHlwZXMsIGFsaWFzZXMsIHJlc3Vs\ndENsYXNzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9wYWNrZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gZW1wdHkgcmVzdWx0IGZv\nciB0aGlzIHF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBlbXB0\neVJlc3VsdChTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgp\nIHsKICAgICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUgfHwgKF91\nbmlxdWUgPT0gbnVsbAogICAgICAgICAgICAmJiAhZXguaGFzR3JvdXBpbmco\ncSkgJiYgZXguaXNBZ2dyZWdhdGUocSkpKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgYW4gZXhwZWN0ZWQgc2lu\nZ2xlIHJlc3VsdCBmcm9tIHRoZSBnaXZlbiBwcm92aWRlci4gVXNlZCB3aGVu\nCiAgICAgKiB0aGUgcmVzdWx0IGlzIGFuIHVuZ3JvdXBlZCBhZ2dyZWdhdGUg\nb3IgdGhlIHVuaXF1ZSBmbGFnIGlzIHNldCB0byB0cnVlLgogICAgICovCiAg\nICBwcml2YXRlIE9iamVjdCBzaW5nbGVSZXN1bHQoUmVzdWx0T2JqZWN0UHJv\ndmlkZXIgcm9wLCAKICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKQog\nICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHJvcC5vcGVuKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbW92ZSB0byBleHBlY3Rl\nZCByZXN1bHQKICAgICAgICAgICAgYm9vbGVhbiBuZXh0ID0gcm9wLm5leHQo\nKTsKCiAgICAgICAgICAgIC8vIGV4dHJhY3Qgc2luZ2xlIHJlc3VsdDsgdGhy\nb3cgYW4gZXhjZXB0aW9uIGlmIG11bHRpcGxlIHJlc3VsdHMKICAgICAgICAg\nICAgLy8gbWF0Y2ggYW5kIG5vdCBjb25zdHJhaW50ZWQgYnkgcmFuZ2UsIG9y\nIGlmIGEgdW5pcXVlIHF1ZXJ5IHdpdGgKICAgICAgICAgICAgLy8gbm8gcmVz\ndWx0cwogICAgICAgICAgICBPYmplY3Qgc2luZ2xlID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKG5leHQpIHsKICAgICAgICAgICAgICAgIHNpbmdsZSA9IHJv\ncC5nZXRSZXN1bHRPYmplY3QoKTsKICAgICAgICAgICAgICAgIGlmIChyYW5n\nZS5lbmQgIT0gcmFuZ2Uuc3RhcnQgKyAxICYmIHJvcC5uZXh0KCkpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2Vw\ndGlvbihfbG9jLmdldCgibm90LXVuaXF1ZSIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9jbGFzcywgX3F1ZXJ5KSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTm9SZXN1bHRFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXJlc3Vs\ndCIsIAogICAgICAgICAgICAgICAgICAgIF9jbGFzcywgX3F1ZXJ5KSk7Cgog\nICAgICAgICAgICAvLyBpZiB1bmlxdWUgc2V0IHRvIGZhbHNlLCB1c2UgY29s\nbGVjdGlvbgogICAgICAgICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLkZB\nTFNFKSB7CiAgICAgICAgICAgICAgICBpZiAoIW5leHQpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAg\nICAgICAgICAgICAvLyBDb2xsZWN0aW9ucy5zaW5nbGV0b25MaXN0IGlzIEpE\nSyAxLjMsIHNvLi4uCiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFz\nTGlzdChuZXcgT2JqZWN0W117IHNpbmdsZSB9KTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAKICAgICAgICAgICAgLy8gcmV0dXJuIHNpbmdsZSByZXN1\nbHQKICAgICAgICAgICAgcmV0dXJuIHNpbmdsZTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICByb3AuY2xvc2UoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIHdoZXRoZXIgdGhlIGFjY2Vz\ncyBwYXRoIG9mIHRoaXMgcXVlcnkgaW50ZXJzZWN0cyB3aXRoCiAgICAgKiBh\nbnkgZGlydHkgb2JqZWN0cyBpbiB0aGUgdHJhbnNhY3Rpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBpc0FjY2Vzc1BhdGhEaXJ0eSgpIHsKICAg\nICAgICByZXR1cm4gaXNBY2Nlc3NQYXRoRGlydHkoX2Jyb2tlciwgZ2V0QWNj\nZXNzUGF0aE1ldGFEYXRhcygpKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGlj\nIGJvb2xlYW4gaXNBY2Nlc3NQYXRoRGlydHkoQnJva2VyIGJyb2tlciwKICAg\nICAgICBDbGFzc01ldGFEYXRhW10gYWNjZXNzTWV0YXMpIHsKICAgICAgICBD\nb2xsZWN0aW9uIHBlcnNpc3RlZCA9IGJyb2tlci5nZXRQZXJzaXN0ZWRUeXBl\ncygpOwogICAgICAgIENvbGxlY3Rpb24gdXBkYXRlZCA9IGJyb2tlci5nZXRV\ncGRhdGVkVHlwZXMoKTsKICAgICAgICBDb2xsZWN0aW9uIGRlbGV0ZWQgPSBi\ncm9rZXIuZ2V0RGVsZXRlZFR5cGVzKCk7CiAgICAgICAgaWYgKHBlcnNpc3Rl\nZC5pc0VtcHR5KCkgJiYgdXBkYXRlZC5pc0VtcHR5KCkgJiYgZGVsZXRlZC5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nLy8gaWYgbm8gYWNjZXNzIG1ldGFzLCBhc3N1bWUgZXZlcnkgZGlydHkgb2Jq\nZWN0IGFmZmVjdHMgcGF0aCBqdXN0CiAgICAgICAgLy8gdG8gYmUgc2FmZQog\nICAgICAgIGlmIChhY2Nlc3NNZXRhcy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIGNvbXBhcmUgZGlydHkgY2xh\nc3NlcyB0byB0aGUgYWNjZXNzIHBhdGggY2xhc3NlcwogICAgICAgIENsYXNz\nIGFjY0NsYXNzOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYWNjZXNz\nTWV0YXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gc2hvcnRjdXQg\naWYgYWN0dWFsIGNsYXNzIGlzIGRpcnR5CiAgICAgICAgICAgIGFjY0NsYXNz\nID0gYWNjZXNzTWV0YXNbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAg\nICAgICBpZiAocGVyc2lzdGVkLmNvbnRhaW5zKGFjY0NsYXNzKSB8fCB1cGRh\ndGVkLmNvbnRhaW5zKGFjY0NsYXNzKQogICAgICAgICAgICAgICAgfHwgZGVs\nZXRlZC5jb250YWlucyhhY2NDbGFzcykpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBkaXJ0eSBzdWJj\nbGFzcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gcGVyc2lz\ndGVkLml0ZXJhdG9yKCk7IGRpcnR5Lmhhc05leHQoKTspCiAgICAgICAgICAg\nICAgICBpZiAoYWNjQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgoQ2xhc3MpIGRp\ncnR5Lm5leHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgZGlydHkgPSB1cGRhdGVkLml0\nZXJhdG9yKCk7IGRpcnR5Lmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBp\nZiAoYWNjQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgoQ2xhc3MpIGRpcnR5Lm5l\neHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgZGlydHkgPSBkZWxldGVkLml0ZXJhdG9y\nKCk7IGRpcnR5Lmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBpZiAoYWNj\nQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgoQ2xhc3MpIGRpcnR5Lm5leHQoKSkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoK\nICAgICAgICAvLyBubyBpbnRlcnNlY3Rpb24KICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2VBbGwoKSB7CiAgICAg\nICAgY2xvc2VSZXN1bHRzKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGNsb3NlUmVzb3VyY2VzKCkgewogICAgICAgIGNsb3NlUmVzdWx0cyhmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZSBvcGVuIHJlc3VsdHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjbG9zZVJlc3VsdHMoYm9vbGVh\nbiBmb3JjZSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBSZW1vdmVPbkNs\nb3NlUmVzdWx0TGlzdCByZXM7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX3Jlc3VsdExpc3RzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICByZXMgPSAoUmVtb3ZlT25DbG9zZVJlc3Vs\ndExpc3QpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoZm9yY2Ug\nfHwgcmVzLmlzUHJvdmlkZXJPcGVuKCkpCiAgICAgICAgICAgICAgICAgICAg\ncmVzLmNsb3NlKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBf\ncmVzdWx0TGlzdHMuY2xlYXIoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlvbnMoTWFwIHBhcmFtcykgewog\nICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgcGFyYW1z\nID0gQ29sbGVjdGlvbnMuRU1QVFlfTUFQOwoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm90U2VyaWFsaXplZCgp\nOwogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBTdG9y\nZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gY29tcGlsZUZvckV4ZWN1dG9yKCk7CiAg\nICAgICAgICAgIE9iamVjdFtdIGFyciA9IHRvUGFyYW1ldGVyQXJyYXkoZXgu\nZ2V0UGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpLAogICAgICAgICAgICAg\nICAgcGFyYW1zKTsKICAgICAgICAgICAgYXNzZXJ0UGFyYW1ldGVycyhfc3Rv\ncmVRdWVyeSwgZXgsIGFycik7CiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFu\nZ2UgcmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZShfc3RhcnRJZHgsIF9l\nbmRJZHgpOwogICAgICAgICAgICBpZiAoIV9yYW5nZVNldCkKICAgICAgICAg\nICAgICAgIGV4LmdldFJhbmdlKF9zdG9yZVF1ZXJ5LCBhcnIsIHJhbmdlKTsK\nICAgICAgICAgICAgcmV0dXJuIGV4LmdldERhdGFTdG9yZUFjdGlvbnMoX3N0\nb3JlUXVlcnksIGFyciwgcmFuZ2UpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIHNldFF1ZXJ5KE9iamVjdCBxdWVyeSkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CgogICAgICAgICAg\nICBpZiAocXVlcnkgPT0gbnVsbCB8fCBxdWVyeSBpbnN0YW5jZW9mIFN0cmlu\nZykgewogICAgICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7\nCiAgICAgICAgICAgICAgICBfcXVlcnkgPSAoU3RyaW5nKSBxdWVyeTsKICAg\nICAgICAgICAgICAgIGlmIChfcXVlcnkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBfcXVlcnkgPSBfcXVlcnkudHJpbSgpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKCEocXVlcnkgaW5zdGFuY2VvZiBRdWVyeUltcGwpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIF9zdG9yZVF1ZXJ5LnNldFF1ZXJ5KHF1ZXJ5KTsKCiAgICAg\nICAgICAgIC8vIGNvcHkgYWxsIG5vbi10cmFuc2llbnQgc3RhdGUgZnJvbSB0\naGUgZ2l2ZW4gcXVlcnkKICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0\naW9uKCk7CiAgICAgICAgICAgIFF1ZXJ5SW1wbCBxID0gKFF1ZXJ5SW1wbCkg\ncXVlcnk7CiAgICAgICAgICAgIF9jbGFzcyA9IHEuX2NsYXNzOwogICAgICAg\nICAgICBfc3ViY2xhc3NlcyA9IHEuX3N1YmNsYXNzZXM7CiAgICAgICAgICAg\nIF9xdWVyeSA9IHEuX3F1ZXJ5OwogICAgICAgICAgICBfaWdub3JlQ2hhbmdl\ncyA9IHEuX2lnbm9yZUNoYW5nZXM7CiAgICAgICAgICAgIF91bmlxdWUgPSBx\nLl91bmlxdWU7CiAgICAgICAgICAgIF9yZXN1bHRDbGFzcyA9IHEuX3Jlc3Vs\ndENsYXNzOwogICAgICAgICAgICBfcGFyYW1zID0gcS5fcGFyYW1zOwogICAg\nICAgICAgICBfcmVzdWx0TWFwcGluZ1Njb3BlID0gcS5fcmVzdWx0TWFwcGlu\nZ1Njb3BlOwogICAgICAgICAgICBfcmVzdWx0TWFwcGluZ05hbWUgPSBxLl9y\nZXN1bHRNYXBwaW5nTmFtZTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0gcS5f\ncmVhZE9ubHk7CgogICAgICAgICAgICAvLyBkb24ndCBzaGFyZSBtdXRhYmxl\nIG9iamVjdHMKICAgICAgICAgICAgX2ZjLmNvcHkocS5fZmMpOwogICAgICAg\nICAgICBpZiAocS5fZmlsdExpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2ZpbHRMaXN0ZW5lcnMgPSBuZXcgSGFzaE1hcChxLl9maWx0TGlz\ndGVuZXJzKTsKICAgICAgICAgICAgaWYgKHEuX2FnZ0xpc3RlbmVycyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX2FnZ0xpc3RlbmVycyA9IG5ldyBIYXNo\nTWFwKHEuX2FnZ0xpc3RlbmVycyk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldEFsaWFzKCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBT\ndHJpbmcgYWxpYXMgPSBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRBbGlhcyhf\nc3RvcmVRdWVyeSk7CiAgICAgICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgYWxpYXMgPSBTdHJpbmdzLmdldENsYXNzTmFtZShf\nY2xhc3MpOwogICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRQcm9qZWN0aW9uQWxpYXNlcygp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdldFByb2plY3Rpb25BbGlh\nc2VzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENs\nYXNzW10gZ2V0UHJvamVjdGlvblR5cGVzKCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4\nZWN1dG9yKCkuZ2V0UHJvamVjdGlvblR5cGVzKF9zdG9yZVF1ZXJ5KTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRPcGVyYXRpb24oKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRPcGVyYXRpb24oX3N0b3JlUXVl\ncnkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3Jl\nZ2F0ZSgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmlzQWdncmVnYXRl\nKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaGFzR3JvdXBpbmcoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5o\nYXNHcm91cGluZyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcygp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gY29tcGlsZUZvckV4ZWN1dG9yKCku\nCiAgICAgICAgICAgICAgICBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKF9zdG9y\nZVF1ZXJ5KTsKICAgICAgICAgICAgcmV0dXJuIChtZXRhcyA9PSBudWxsKSA/\nIFN0b3JlUXVlcnkuRU1QVFlfTUVUQVMgOiBtZXRhczsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIExpbmtlZE1hcCBnZXRQYXJhbWV0ZXJUeXBlcygpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdldFBhcmFtZXRlclR5cGVzKF9z\ndG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE1hcCBnZXRV\ncGRhdGVzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0VXBkYXRl\ncyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGxvY2soKSB7CiAgICAgICAgaWYgKF9icm9rZXIgPT0gbnVsbCB8fCBfYnJv\na2VyLmdldE11bHRpdGhyZWFkZWQoKSkKICAgICAgICAgICAgX2xvY2subG9j\naygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygpIHsKICAgICAg\nICBpZiAoX2xvY2suaXNMb2NrZWQoKSkKICAgICAgICAgICAgX2xvY2sudW5s\nb2NrKCk7CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBVdGlscwogICAg\nLy8vLy8vLy8vCgogICAgcHVibGljIENsYXNzIGNsYXNzRm9yTmFtZShTdHJp\nbmcgbmFtZSwgU3RyaW5nW10gaW1wb3J0cykgewogICAgICAgIC8vIGZ1bGwg\nY2xhc3MgbmFtZSBvciBwcmltaXRpdmUgdHlwZT8KICAgICAgICBDbGFzcyB0\neXBlID0gdG9DbGFzcyhuYW1lKTsKICAgICAgICBpZiAodHlwZSAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gdHlwZTsKCiAgICAgICAgLy8gZmlyc3Qg\nY2hlY2sgdGhlIGFsaWFzZXMgbWFwIGluIHRoZSBNZXRhRGF0YVJlcG9zaXRv\ncnkKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSAoX2NsYXNzID09IG51\nbGwpID8gX2xvYWRlcgogICAgICAgICAgICA6IF9jbGFzcy5nZXRDbGFzc0xv\nYWRlcigpOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9icm9rZXIu\nZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpLmdldE1ldGFEYXRhKG5hbWUsIGxvYWRlciwg\nZmFsc2UpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAgLy8g\ndHJ5IHRoZSBuYW1lIGluIHRoZSBwYWNrYWdlIG9mIHRoZSBjYW5kaWRhdGUg\nY2xhc3MKICAgICAgICBpZiAoX2NsYXNzICE9IG51bGwpIHsKICAgICAgICAg\nICAgU3RyaW5nIGZ1bGxOYW1lID0gX2NsYXNzLmdldE5hbWUoKS5zdWJzdHJp\nbmcKICAgICAgICAgICAgICAgICgwLCBfY2xhc3MuZ2V0TmFtZSgpLmxhc3RJ\nbmRleE9mKCcuJykgKyAxKSArIG5hbWU7CiAgICAgICAgICAgIHR5cGUgPSB0\nb0NsYXNzKGZ1bGxOYW1lKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdHJ5IGphdmEubGFuZwogICAgICAgIHR5cGUgPSB0b0NsYXNz\nKCJqYXZhLmxhbmcuIiArIG5hbWUpOwogICAgICAgIGlmICh0eXBlICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiB0eXBlOwoKICAgICAgICAvLyB0cnkg\nZWFjaCBpbXBvcnQKICAgICAgICBpZiAoaW1wb3J0cyAhPSBudWxsICYmIGlt\ncG9ydHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBTdHJpbmcgZG90TmFt\nZSA9ICIuIiArIG5hbWU7CiAgICAgICAgICAgIFN0cmluZyBpbXBvcnROYW1l\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGltcG9ydHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGltcG9ydE5hbWUgPSBpbXBv\ncnRzW2ldOwoKICAgICAgICAgICAgICAgIC8vIGZ1bGwgY2xhc3MgbmFtZSBp\nbXBvcnQKICAgICAgICAgICAgICAgIGlmIChpbXBvcnROYW1lLmVuZHNXaXRo\nKGRvdE5hbWUpKQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSB0b0NsYXNz\nKGltcG9ydE5hbWUpOwogICAgICAgICAgICAgICAgICAgIC8vIHdpbGRjYXJk\nOyBzdHJpcCB0byBwYWNrYWdlCiAgICAgICAgICAgICAgICBlbHNlIGlmIChp\nbXBvcnROYW1lLmVuZHNXaXRoKCIuKiIpKSB7CiAgICAgICAgICAgICAgICAg\nICAgaW1wb3J0TmFtZSA9IGltcG9ydE5hbWUuc3Vic3RyaW5nCiAgICAgICAg\nICAgICAgICAgICAgICAgICgwLCBpbXBvcnROYW1lLmxlbmd0aCgpIC0gMSk7\nCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRvQ2xhc3MoaW1wb3J0TmFt\nZSArIG5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\naWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ndHlwZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUge0BsaW5r\nIENsYXNzfSBmb3IgdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbmFtZSBu\nb3QgdmFsaWQuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgdG9DbGFzcyhT\ndHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbG9hZGVyID09IG51bGwpCiAg\nICAgICAgICAgIF9sb2FkZXIgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24o\nKS5nZXRDbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4KICAgICAgICAgICAgICAg\nIGdldENsYXNzTG9hZGVyKF9jbGFzcywgX2Jyb2tlci5nZXRDbGFzc0xvYWRl\ncigpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gU3RyaW5n\ncy50b0NsYXNzKG5hbWUsIF9sb2FkZXIpOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICB9IGNhdGNoIChOb0NsYXNz\nRGVmRm91bmRFcnJvciBuY2RmZSkgewogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVuKCkg\newogICAgICAgIGlmIChfYnJva2VyICE9IG51bGwpCiAgICAgICAgICAgIF9i\ncm9rZXIuYXNzZXJ0T3BlbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE5vdFJlYWRPbmx5KCkgewogICAgICAgIGlmIChfcmVhZE9ubHkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQoInJlYWQtb25seSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBh\nc3NlcnROb3RTZXJpYWxpemVkKCkgewogICAgICAgIGlmIChfYnJva2VyID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInNlcmlhbGl6ZWQiKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDaGVjayB0aGF0IGEgY2FuZGlkYXRlIGNsYXNzIGhhcyBiZWVu\nIHNldCBmb3IgdGhlIHF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYXNzZXJ0Q2FuZGlkYXRlVHlwZSgpIHsKICAgICAgICBpZiAoX2NsYXNzID09\nIG51bGwgJiYgX3N0b3JlUXVlcnkucmVxdWlyZXNDYW5kaWRhdGVUeXBlKCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLWNsYXNzIikpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2hlY2sgdGhhdCB3ZSBhcmUgaW4gYSBzdGF0ZSB0byBiZSBhYmxlIHRvIHBl\ncmZvcm0gYSBidWxrIG9wZXJhdGlvbjsKICAgICAqIGFsc28gZmx1c2ggdGhl\nIGN1cnJlbnQgbW9kZmljYXRpb25zIGlmIGFueSBlbGVtZW50cyBhcmUgY3Vy\ncmVudGx5IGRpcnR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0\nQnVsa01vZGlmeShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3Ig\nZXgsIAogICAgICAgIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIF9icm9r\nZXIuYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICBpZiAoX3N0\nYXJ0SWR4ICE9IDAgfHwgX2VuZElkeCAhPSBMb25nLk1BWF9WQUxVRSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLW1vZGlmeS1yYW5nZSIpKTsKICAgICAgICBpZiAoX3Jlc3VsdENsYXNzICE9\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1tb2RpZnktcmVzdWx0Y2xhc3MiKSk7CiAgICAgICAgU3Rv\ncmVRdWVyeS5SYW5nZSByYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKCk7\nCiAgICAgICAgZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5nZSk7CiAgICAg\nICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDAgfHwgcmFuZ2UuZW5kICE9IExvbmcu\nTUFYX1ZBTFVFKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tbW9kaWZ5LXJhbmdlIikpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ2hlY2tzIHRoYXQgdGhlIHBhc3NlZCBwYXJhbWV0ZXJzIG1h\ndGNoIHRoZSBkZWNsYXJhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGFzc2VydFBhcmFtZXRlcnMoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yIGV4LCAKICAgICAgICBPYmplY3RbXSBwYXJhbXMpIHsKICAg\nICAgICBpZiAoIXEucmVxdWlyZXNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBMaW5rZWRNYXAgcGFyYW1U\neXBlcyA9IGV4LmdldFBhcmFtZXRlclR5cGVzKHEpOwogICAgICAgIGludCB0\neXBlQ291bnQgPSBwYXJhbVR5cGVzLnNpemUoKTsKICAgICAgICBpZiAodHlw\nZUNvdW50ID4gcGFyYW1zLmxlbmd0aCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInVuYm91bmQtcGFyYW1zIiwKICAg\nICAgICAgICAgICAgIHBhcmFtVHlwZXMua2V5U2V0KCkpKTsKCiAgICAgICAg\nSXRlcmF0b3IgaXRyID0gcGFyYW1UeXBlcy5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpdHIuaGFzTmV4dCgpOyBpKyspIHsKICAgICAgICAgICAgZW50\ncnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nKChDbGFzcykgZW50cnkuZ2V0VmFsdWUoKSkuaXNQcmltaXRpdmUoKSAmJiBw\nYXJhbXNbaV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXByaW1pdGl2ZS1wYXJhbSIs\nCiAgICAgICAgICAgICAgICAgICAgZW50cnkuZ2V0S2V5KCkpKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcig2NCk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiUXVlcnk6ICIpLmFwcGVuZChzdXBlci50\nb1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5kKCI7IGNhbmRpZGF0ZSBj\nbGFzczogIikuYXBwZW5kKF9jbGFzcyk7CiAgICAgICAgYnVmLmFwcGVuZCgi\nOyBxdWVyeTogIikuYXBwZW5kKF9xdWVyeSk7CiAgICAgICAgcmV0dXJuIGJ1\nZi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogU3RydWN0IG9m\nIGNvbXBpbGVkIHF1ZXJ5IHByb3BlcnRpZXMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBzdGF0aWMgY2xhc3MgQ29tcGlsYXRpb24gewoKICAgICAgICBwdWJs\naWMgU3RvcmVRdWVyeS5FeGVjdXRvciBtZW1vcnkgPSBudWxsOwogICAgICAg\nIHB1YmxpYyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGRhdGFzdG9yZSA9IG51bGw7\nCiAgICAgICAgcHVibGljIE9iamVjdCBzdG9yZURhdGEgPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogU3RydWN0IHRvIGhvbGQgdGhlIHVucGFyc2Vk\nIHByb3BlcnRpZXMgYXNzb2NpYXRlZCB3aXRoIGEgcXVlcnkuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENvbXBpbGF0aW9uS2V5CiAgICAg\nICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwdWJsaWMg\nQ2xhc3MgcXVlcnlUeXBlID0gbnVsbDsKICAgICAgICBwdWJsaWMgQ2xhc3Mg\nY2FuZGlkYXRlVHlwZSA9IG51bGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4g\nc3ViY2xhc3NlcyA9IHRydWU7CiAgICAgICAgcHVibGljIFN0cmluZyBxdWVy\neSA9IG51bGw7CiAgICAgICAgcHVibGljIFN0cmluZyBsYW5ndWFnZSA9IG51\nbGw7CiAgICAgICAgcHVibGljIE9iamVjdCBzdG9yZUtleSA9IG51bGw7Cgog\nICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIGlu\ndCBycyA9IDE3OwogICAgICAgICAgICBycyA9IDM3ICogcnMgKyAoKHF1ZXJ5\nVHlwZSA9PSBudWxsKSA/IDAgOiBxdWVyeVR5cGUuaGFzaENvZGUoKSk7CiAg\nICAgICAgICAgIHJzID0gMzcgKiBycyArICgocXVlcnkgPT0gbnVsbCkgPyAw\nIDogcXVlcnkuaGFzaENvZGUoKSk7CiAgICAgICAgICAgIHJzID0gMzcgKiBy\ncyArICgobGFuZ3VhZ2UgPT0gbnVsbCkgPyAwIDogbGFuZ3VhZ2UuaGFzaENv\nZGUoKSk7CiAgICAgICAgICAgIHJzID0gMzcgKiBycyArICgoc3RvcmVLZXkg\nPT0gbnVsbCkgPyAwIDogc3RvcmVLZXkuaGFzaENvZGUoKSk7CiAgICAgICAg\nICAgIHJldHVybiByczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90\naGVyID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgaWYgKG90aGVyID09IG51bGwgfHwgb3RoZXIuZ2V0Q2xhc3Mo\nKSAhPSBnZXRDbGFzcygpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICAgICAgQ29tcGlsYXRpb25LZXkga2V5ID0gKENvbXBpbGF0\naW9uS2V5KSBvdGhlcjsKICAgICAgICAgICAgaWYgKGtleS5xdWVyeVR5cGUg\nIT0gcXVlcnlUeXBlCiAgICAgICAgICAgICAgICB8fCAhU3RyaW5nVXRpbHMu\nZXF1YWxzKGtleS5xdWVyeSwgcXVlcnkpCiAgICAgICAgICAgICAgICB8fCAh\nU3RyaW5nVXRpbHMuZXF1YWxzKGtleS5sYW5ndWFnZSwgbGFuZ3VhZ2UpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgaWYg\nKCFPYmplY3RVdGlscy5lcXVhbHMoa2V5LnN0b3JlS2V5LCBzdG9yZUtleSkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAv\nLyBhbGxvdyBlaXRoZXIgY2FuZGlkYXRlIHR5cGUgdG8gYmUgbnVsbCBiZWNh\ndXNlIGl0IG1pZ2h0IGJlCiAgICAgICAgICAgIC8vIGVuY29kZWQgaW4gdGhl\nIHF1ZXJ5IHN0cmluZywgYnV0IGlmIGJvdGggYXJlIHNldCB0aGVuIHRoZXkK\nICAgICAgICAgICAgLy8gbXVzdCBiZSBlcXVhbAogICAgICAgICAgICBpZiAo\nY2FuZGlkYXRlVHlwZSAhPSBudWxsICYmIGtleS5jYW5kaWRhdGVUeXBlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlVHlwZSA9\nPSBrZXkuY2FuZGlkYXRlVHlwZQogICAgICAgICAgICAgICAgICAgICYmIHN1\nYmNsYXNzZXMgPT0ga2V5LnN1YmNsYXNzZXM7CgogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBIG1l\ncmdlZCBleGVjdXRvciBleGVjdXRlcyBtdWx0aXBsZSBRdWVyaWVzIGFuZCBy\nZXR1cm5zCiAgICAgKiBhIG1lcmdlZCByZXN1bHQgbGlzdCB3aXRoIHRoZSBh\ncHByb3ByaWF0ZSBvcmRlcmluZyAoaWYgbW9yZSB0aGFuCiAgICAgKiBvbmUg\ncXVlcnkgbmVlZHMgdG8gYmUgZXhlY3V0ZWQpLiBUaGlzIGV4ZWN1dG9yIGhh\ncyB0aGUgZm9sbG93aW5nCiAgICAgKiBsaW1pdGF0aW9uczoKICAgICAqIDx1\nbD4KICAgICAqIDxsaT5JdCBjYW5ub3QgY29tYmluZSBhZ2dyZWdhdGVzLgog\nICAgICogPGxpPkl0IGNhbm5vdCBjb2xsYXRlIHRoZSByZXN1bHQgbGlzdHMg\naWYgb3JkZXJpbmcgaXMgc3BlY2lmaWVkIGFuZAogICAgICogYSByZXN1bHQg\nc3RyaW5nIGlzIGdpdmVuLCBidXQgZG9lcyBub3QgaW5jbHVkZSB0aGUgb3Jk\nZXJpbmcKICAgICAqIGNyaXRlcmlhLjwvbGk+CiAgICAgKiA8bGk+SXQgY2Fu\nbm90IGZpbHRlciBkdXBsaWNhdGUgcmVzdWx0cyBmcm9tIGRpZmZlcmVudCBy\nZXN1bHQgbGlzdHMgaWYKICAgICAqIHRoZSByZXN1bHQgaXMgbWFya2VkIGRp\nc3RpbmN0LiBUaGlzIHdvdWxkIHJlcXVpcmUgdHJhY2tpbmcgYWxsCiAgICAg\nKiBwcmV2aW91cyByZXN1bHRzLCB3aGljaCB3b3VsZCBpbnRlcmZlcmUgd2l0\naCBsYXJnZSByZXN1bHQgc2V0CiAgICAgKiBoYW5kbGluZy48L2xpPgogICAg\nICogPC91bD4KICAgICAqCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21t\nZWF1eAogICAgICogQG5vamF2YWRvYwogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBjbGFzcyBNZXJnZWRFeGVjdXRvcgogICAgICAgIGltcGxlbWVudHMg\nU3RvcmVRdWVyeS5FeGVjdXRvciB7CgogICAgICAgIHByaXZhdGUgZmluYWwg\nU3RvcmVRdWVyeS5FeGVjdXRvcltdIF9leGVjdXRvcnM7CgogICAgICAgIHB1\nYmxpYyBNZXJnZWRFeGVjdXRvcihTdG9yZVF1ZXJ5LkV4ZWN1dG9yW10gZXhl\nY3V0b3JzKSB7CiAgICAgICAgICAgIF9leGVjdXRvcnMgPSBleGVjdXRvcnM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUmVzdWx0T2JqZWN0UHJvdmlk\nZXIgZXhlY3V0ZVF1ZXJ5KFN0b3JlUXVlcnkgcSwKICAgICAgICAgICAgT2Jq\nZWN0W10gcGFyYW1zLCBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKSB7CiAgICAg\nICAgICAgIGlmIChfZXhlY3V0b3JzLmxlbmd0aCA9PSAxKQogICAgICAgICAg\nICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZXhlY3V0ZVF1ZXJ5KHEsIHBh\ncmFtcywgcmFuZ2UpOwoKICAgICAgICAgICAgLy8gdXNlIGxycyBzZXR0aW5n\ncyBpZiB3ZSBjb3VsZG4ndCB0YWtlIGFkdmFudGFnZSBvZiB0aGUgc3RhcnQg\naW5kZXgKICAgICAgICAgICAgLy8gc28gdGhhdCBob3BlZnVsbHkgdGhlIHNr\naXAgdG8gdGhlIHN0YXJ0IHdpbGwgYmUgZWZmaWNpZW50CiAgICAgICAgICAg\nIFN0b3JlUXVlcnkuUmFuZ2Ugcm9wUmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5S\nYW5nZSgwLCByYW5nZS5lbmQpOwogICAgICAgICAgICByb3BSYW5nZS5scnMg\nPSByYW5nZS5scnMgfHwgKHJhbmdlLnN0YXJ0ID4gMCAmJiBxLmdldENvbnRl\neHQoKS4KICAgICAgICAgICAgICAgIGdldEZldGNoQ29uZmlndXJhdGlvbigp\nLmdldEZldGNoQmF0Y2hTaXplKCkgPj0gMCk7CgogICAgICAgICAgICAvLyBl\neGVjdXRlIHRoZSBxdWVyeTsgd2UgY2Fubm90IHVzZSB0aGUgbG93ZXIgYm91\nbmQgb2YgdGhlIHJlc3VsdAogICAgICAgICAgICAvLyByYW5nZSwgYnV0IHdl\nIGNhbiB0YWtlIGFkdmFudGFnZSBvZiB0aGUgdXBwZXIgYm91bmQKICAgICAg\nICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0KICAgICAgICAg\nICAgICAgIG5ldyBSZXN1bHRPYmplY3RQcm92aWRlcltfZXhlY3V0b3JzLmxl\nbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1\ndG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBf\nZXhlY3V0b3JzW2ldLmV4ZWN1dGVRdWVyeShxLCBwYXJhbXMsIHJvcFJhbmdl\nKTsKCiAgICAgICAgICAgIGJvb2xlYW5bXSBhc2MgPSBfZXhlY3V0b3JzWzBd\nLmdldEFzY2VuZGluZyhxKTsKICAgICAgICAgICAgUmVzdWx0T2JqZWN0UHJv\ndmlkZXIgcm9wOwogICAgICAgICAgICBpZiAoYXNjLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICAgICAgcm9wID0gbmV3IE1lcmdlZFJlc3VsdE9iamVjdFBy\nb3ZpZGVyKHJvcHMpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICByb3AgPSBuZXcgT3JkZXJpbmdNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRl\ncihyb3BzLCBhc2MsCiAgICAgICAgICAgICAgICAgICAgX2V4ZWN1dG9ycywg\ncSwgcGFyYW1zKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgbG93\nZXIgYm91bmQsIHdyYXAgaW4gcmFuZ2Ugcm9wCiAgICAgICAgICAgIGlmIChy\nYW5nZS5zdGFydCAhPSAwKQogICAgICAgICAgICAgICAgcm9wID0gbmV3IFJh\nbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCByYW5nZS5zdGFydCwgCiAg\nICAgICAgICAgICAgICAgICAgcmFuZ2UuZW5kKTsKICAgICAgICAgICAgcmV0\ndXJuIHJvcDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOdW1iZXIgZXhl\nY3V0ZURlbGV0ZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcykgewog\nICAgICAgICAgICBsb25nIG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIG51bSArPSBfZXhlY3V0b3JzW2ldLmV4ZWN1dGVEZWxldGUocSwg\ncGFyYW1zKS5sb25nVmFsdWUoKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJl\ncnMudmFsdWVPZihudW0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE51\nbWJlciBleGVjdXRlVXBkYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFy\nYW1zKSB7CiAgICAgICAgICAgIGxvbmcgbnVtID0gMDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZVVw\nZGF0ZShxLCBwYXJhbXMpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICByZXR1\ncm4gTnVtYmVycy52YWx1ZU9mKG51bSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5\nIHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgU3RvcmVRdWVyeS5S\nYW5nZSByYW5nZSkgewogICAgICAgICAgICBpZiAoX2V4ZWN1dG9ycy5sZW5n\ndGggPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBd\nLmdldERhdGFTdG9yZUFjdGlvbnMocSwgcGFyYW1zLCByYW5nZSk7CgogICAg\nICAgICAgICBMaXN0IHJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0KF9leGVjdXRv\ncnMubGVuZ3RoKTsKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByb3BS\nYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKDBMLCByYW5nZS5lbmQpOwog\nICAgICAgICAgICBTdHJpbmdbXSBhY3Rpb25zOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGFjdGlvbnMgPSBfZXhlY3V0b3JzW2ldLmdldERhdGFT\ndG9yZUFjdGlvbnMocSwgcGFyYW1zLHJvcFJhbmdlKTsKICAgICAgICAgICAg\nICAgIGlmIChhY3Rpb25zICE9IG51bGwgJiYgYWN0aW9ucy5sZW5ndGggPiAw\nKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYWRkQWxsKEFycmF5cy5h\nc0xpc3QoYWN0aW9ucykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiAoU3RyaW5nW10pIHJlc3VsdHMudG9BcnJheShuZXcgU3RyaW5nW3Jl\nc3VsdHMuc2l6ZSgpXSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCB2YWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgX2V4ZWN1\ndG9yc1swXS52YWxpZGF0ZShxKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIGdldFJhbmdlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1z\nLCAKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkgewogICAg\nICAgICAgICBfZXhlY3V0b3JzWzBdLmdldFJhbmdlKHEsIHBhcmFtcywgcmFu\nZ2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRl\ncmluZ1ZhbHVlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAg\nICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgaWR4KSB7CiAgICAg\nICAgICAgIC8vIHVuZm9ydHVuYXRlbHksIGF0IHRoaXMgcG9pbnQgKG11c3Qg\nYmUgYSBtZXJnZWQgcm9wIGNvbnRhaW5pbmcKICAgICAgICAgICAgLy8gb3Ro\nZXIgbWVyZ2VkIHJvcHMpIHdlIGhhdmUgbm8gaWRlYSB3aGljaCBleGVjdXRv\nciB0byBleHRyYWN0CiAgICAgICAgICAgIC8vIHRoZSB2YWx1ZSBmcm9tCiAg\nICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldE9yZGVyaW5nVmFs\ndWUocSwgcGFyYW1zLCByZXN1bHRPYmplY3QsIGlkeCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbltdIGdldEFzY2VuZGluZyhTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0\nQXNjZW5kaW5nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmlu\nZyBnZXRBbGlhcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leGVjdXRvcnNbMF0uZ2V0QWxpYXMocSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgU3RyaW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMoU3RvcmVR\ndWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdl\ndFByb2plY3Rpb25BbGlhc2VzKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIENsYXNzIGdldFJlc3VsdENsYXNzKFN0b3JlUXVlcnkgcSkgewogICAg\nICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRSZXN1bHRDbGFzcyhx\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDbGFzc1tdIGdldFByb2pl\nY3Rpb25UeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leGVjdXRvcnNbMF0uZ2V0UHJvamVjdGlvblR5cGVzKHEpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQYWNraW5nKFN0b3JlUXVl\ncnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5pc1Bh\nY2tpbmcocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3NNZXRh\nRGF0YVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoU3RvcmVRdWVyeSBxKSB7\nCiAgICAgICAgICAgIGlmIChfZXhlY3V0b3JzLmxlbmd0aCA9PSAxKQogICAg\nICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0QWNjZXNzUGF0\naE1ldGFEYXRhcyhxKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBzZXQgb2Yg\nYmFzZSBjbGFzcyBtZXRhZGF0YXMgaW4gYWNjZXNzIHBhdGgKICAgICAgICAg\nICAgTGlzdCBtZXRhcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgIG1ldGFzID0gRmlsdGVycy5hZGRBY2Nlc3NQYXRoTWV0YURhdGFzKG1l\ndGFzLCBfZXhlY3V0b3JzW2ldLgogICAgICAgICAgICAgICAgICAgIGdldEFj\nY2Vzc1BhdGhNZXRhRGF0YXMocSkpOwogICAgICAgICAgICBpZiAobWV0YXMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVN\nUFRZX01FVEFTOwogICAgICAgICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFb\nXSkgbWV0YXMudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBDbGFzc01l\ndGFEYXRhW21ldGFzLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUoU3RvcmVRdWVyeSBxKSB7CiAgICAg\nICAgICAgIGlmICghX2V4ZWN1dG9yc1swXS5pc0FnZ3JlZ2F0ZShxKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHdl\nIGNhbid0IG1lcmdlIGFnZ3JlZ2F0ZXMKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXJnZWQtYWdncmVn\nYXRlIiwKICAgICAgICAgICAgICAgIHEuZ2V0Q29udGV4dCgpLmdldENhbmRp\nZGF0ZVR5cGUoKSwKICAgICAgICAgICAgICAgIHEuZ2V0Q29udGV4dCgpLmdl\ndFF1ZXJ5U3RyaW5nKCkpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgZ2V0T3BlcmF0aW9uKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBy\nZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRPcGVyYXRpb24ocSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNHcm91cGluZyhTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uaGFz\nR3JvdXBpbmcocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTGlua2Vk\nTWFwIGdldFBhcmFtZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAg\nICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRQYXJhbWV0ZXJUeXBlcyhx\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBNYXAgZ2V0VXBkYXRlcyhT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNb\nMF0uZ2V0VXBkYXRlcyhxKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXN1bHQgb2JqZWN0IHByb3ZpZGVyIHRoYXQgcGFja3MgcmVzdWx0\ncyBiZWZvcmUgcmV0dXJuaW5nIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFBhY2tpbmdSZXN1bHRPYmplY3RQcm92aWRlcgogICAg\nICAgIGltcGxlbWVudHMgUmVzdWx0T2JqZWN0UHJvdmlkZXIgewoKICAgICAg\nICBwcml2YXRlIGZpbmFsIFJlc3VsdE9iamVjdFByb3ZpZGVyIF9kZWxlZ2F0\nZTsKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdFBhY2tlciBfcGFja2Vy\nOwogICAgICAgIHByaXZhdGUgZmluYWwgaW50IF9sZW47CgogICAgICAgIHB1\nYmxpYyBQYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoUmVzdWx0T2JqZWN0\nUHJvdmlkZXIgZGVsZWdhdGUsCiAgICAgICAgICAgIFJlc3VsdFBhY2tlciBw\nYWNrZXIsIGludCByZXN1bHRMZW5ndGgpIHsKICAgICAgICAgICAgX2RlbGVn\nYXRlID0gZGVsZWdhdGU7CiAgICAgICAgICAgIF9wYWNrZXIgPSBwYWNrZXI7\nCiAgICAgICAgICAgIF9sZW4gPSByZXN1bHRMZW5ndGg7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzcygp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5zdXBwb3J0c1JhbmRv\nbUFjY2VzcygpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3Bl\nbigpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAg\nICBfZGVsZWdhdGUub3BlbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIE9iamVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0IG9iID0gX2RlbGVnYXRl\nLmdldFJlc3VsdE9iamVjdCgpOwogICAgICAgICAgICBpZiAoX3BhY2tlciA9\nPSBudWxsICYmIF9sZW4gPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiAo\nKE9iamVjdFtdKSBvYilbMF07CiAgICAgICAgICAgIGlmIChfcGFja2VyID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gb2I7CiAgICAgICAgICAg\nIGlmIChfbGVuID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gX3BhY2tl\nci5wYWNrKG9iKTsKICAgICAgICAgICAgcmV0dXJuIF9wYWNrZXIucGFjaygo\nT2JqZWN0W10pIG9iKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIG5leHQoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5uZXh0KCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShpbnQgcG9zKQogICAg\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJu\nIF9kZWxlZ2F0ZS5hYnNvbHV0ZShwb3MpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBzaXplKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHJldHVybiBfZGVsZWdhdGUuc2l6ZSgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVzZXQoKQogICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgX2RlbGVnYXRlLnJl\nc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgp\nCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBf\nZGVsZWdhdGUuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGhhbmRsZUNoZWNrZWRFeGNlcHRpb24oRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgX2RlbGVnYXRlLmhhbmRsZUNoZWNrZWRFeGNlcHRpb24oZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVzdWx0IGxpc3Qg\ndGhhdCByZW1vdmVzIGl0c2VsZiBmcm9tIHRoZSBxdWVyeSdzIG9wZW4gcmVz\ndWx0IGxpc3QKICAgICAqIHdoZW4gaXQgaXMgY2xvc2VkLiBQdWJsaWMgZm9y\nIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBjbGFzcyBSZW1vdmVPbkNs\nb3NlUmVzdWx0TGlzdAogICAgICAgIGltcGxlbWVudHMgUmVzdWx0TGlzdCB7\nCgogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0TGlzdCBfcmVzOwoKICAg\nICAgICBwdWJsaWMgUmVtb3ZlT25DbG9zZVJlc3VsdExpc3QoUmVzdWx0TGlz\ndCByZXMpIHsKICAgICAgICAgICAgX3JlcyA9IHJlczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBSZXN1bHRMaXN0IGdldERlbGVnYXRlKCkgewogICAg\nICAgICAgICByZXR1cm4gX3JlczsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzUHJvdmlkZXJPcGVuKCkgewogICAgICAgICAgICByZXR1\ncm4gX3Jlcy5pc1Byb3ZpZGVyT3BlbigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmVzLmlzQ2xvc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBjbG9zZSgpIHsKICAgICAgICAgICAgY2xvc2UodHJ1ZSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZShib29sZWFuIHJlbW92\nZSkgewogICAgICAgICAgICBpZiAoaXNDbG9zZWQoKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIF9yZXMuY2xvc2UoKTsKICAgICAg\nICAgICAgaWYgKCFyZW1vdmUpCiAgICAgICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgICAgICBsb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAvLyBkb24ndCB1c2Ugc3RhbmRhcmQgX3Jlc3VsdExpc3RzLnJl\nbW92ZSBtZXRob2QgYi9jIHJlbGllcyBvbgogICAgICAgICAgICAgICAgLy8g\nY29sbGVjdGlvbiBlcXVhbGl0eSwgd2hpY2ggcmVsaWVzIG9uIGVsZW1lbnQg\nZXF1YWxpdHksIHdoaWNoCiAgICAgICAgICAgICAgICAvLyBtZWFucyB3ZSBl\nbmQgdXAgdHJhdmVyc2luZyBlbnRpcmUgcmVzdWx0IGxpc3RzIQogICAgICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfcmVzdWx0TGlzdHMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXRyLm5leHQoKSA9PSB0aGlzKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuc2l6ZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXNFbXB0eSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0IG8p\nIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuY29udGFpbnMobyk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzLml0ZXJhdG9yKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMudG9BcnJheSgpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE9iamVjdFtdIHRvQXJyYXkoT2JqZWN0W10gYSkgewogICAgICAg\nICAgICByZXR1cm4gX3Jlcy50b0FycmF5KGEpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gYWRkKE9iamVjdCBvKSB7CiAgICAgICAgICAg\nIHJldHVybiBfcmVzLmFkZChvKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIHJlbW92ZShPYmplY3QgbykgewogICAgICAgICAgICByZXR1\ncm4gX3Jlcy5yZW1vdmUobyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBjb250YWluc0FsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMuY29udGFpbnNBbGwoYyk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwoQ29sbGVjdGlvbiBjKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzLmFkZEFsbChjKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChpbnQgaWR4LCBDb2xsZWN0\naW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuYWRkQWxsKGlkeCwg\nYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVB\nbGwoQ29sbGVjdGlvbiBjKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnJl\nbW92ZUFsbChjKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9yZXMucmV0YWluQWxsKGMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9yZXMuY2xlYXIoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpZHgpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9yZXMuZ2V0KGlkeCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgT2JqZWN0IHNldChpbnQgaWR4LCBPYmplY3Qgbykg\newogICAgICAgICAgICByZXR1cm4gX3Jlcy5zZXQoaWR4LCBvKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGFkZChpbnQgaWR4LCBPYmplY3Qg\nbykgewogICAgICAgICAgICBfcmVzLmFkZChpZHgsIG8pOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCByZW1vdmUoaW50IGlkeCkgewogICAg\nICAgICAgICByZXR1cm4gX3Jlcy5yZW1vdmUoaWR4KTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgaW5kZXhPZihPYmplY3QgbykgewogICAgICAg\nICAgICByZXR1cm4gX3Jlcy5pbmRleE9mKG8pOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBsYXN0SW5kZXhPZihPYmplY3QgbykgewogICAgICAg\nICAgICByZXR1cm4gX3Jlcy5sYXN0SW5kZXhPZihvKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBMaXN0SXRlcmF0b3IgbGlzdEl0ZXJhdG9yKCkgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5saXN0SXRlcmF0b3IoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBMaXN0SXRlcmF0b3IgbGlzdEl0ZXJhdG9y\nKGludCBpZHgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMubGlzdEl0ZXJh\ndG9yKGlkeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTGlzdCBzdWJM\naXN0KGludCBzdGFydCwgaW50IGVuZCkgewogICAgICAgICAgICByZXR1cm4g\nX3Jlcy5zdWJMaXN0KHN0YXJ0LCBlbmQpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvKSB7CiAgICAgICAgICAg\nIHJldHVybiBfcmVzLmVxdWFscyhvKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVz\nLmhhc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5n\nIHRvU3RyaW5nICgpCgkJewoJCQlyZXR1cm4gX3Jlcy50b1N0cmluZyAoKTsK\nCQl9CgoJCXB1YmxpYyBPYmplY3Qgd3JpdGVSZXBsYWNlICgpCgkJewoJCQly\nZXR1cm4gX3JlczsKCQl9Cgl9Cn0K\n","encoding":"base64"}

