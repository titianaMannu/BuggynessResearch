{"sha":"8fe64c3817dabcfd64313e3284199b03ced279d7","node_id":"MDQ6QmxvYjIwNjM2NDo4ZmU2NGMzODE3ZGFiY2ZkNjQzMTNlMzI4NDE5OWIwM2NlZDI3OWQ3","size":12961,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8fe64c3817dabcfd64313e3284199b03ced279d7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkNvbnN0cnVjdG9yOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZW1i\nZXI7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBq\nYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEubWF0aC5CaWdJbnRl\nZ2VyOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2\nYS51dGlsLkdyZWdvcmlhbkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAq\nIEhlbHBlciBjbGFzcyB0byBwYWNrIHJlc3VsdHMgaW50byB0aGUgcmVzdWx0\nIGNsYXNzIHNldCBvbiB0aGUgcXVlcnkuCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBub2phdmFkb2MK\nICovCnB1YmxpYyBjbGFzcyBSZXN1bHRQYWNrZXIgewoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoUmVzdWx0UGFja2VyLmNsYXNzKTsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIFNldCBfc3RkVHlwZXMgPSBuZXcgSGFzaFNldCgp\nOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChPYmplY3Rb\nXS5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChPYmplY3QuY2xhc3Mp\nOwogICAgICAgIF9zdGRUeXBlcy5hZGQoTWFwLmNsYXNzKTsKICAgICAgICBf\nc3RkVHlwZXMuYWRkKEhhc2hNYXAuY2xhc3MpOwogICAgICAgIF9zdGRUeXBl\ncy5hZGQoQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMuYWRk\nKEJvb2xlYW4uY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoQnl0ZS5j\nbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChTaG9ydC5jbGFzcyk7CiAg\nICAgICAgX3N0ZFR5cGVzLmFkZChJbnRlZ2VyLmNsYXNzKTsKICAgICAgICBf\nc3RkVHlwZXMuYWRkKExvbmcuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5h\nZGQoRmxvYXQuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoRG91Ymxl\nLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMuYWRkKFN0cmluZy5jbGFzcyk7\nCiAgICAgICAgX3N0ZFR5cGVzLmFkZChCaWdJbnRlZ2VyLmNsYXNzKTsKICAg\nICAgICBfc3RkVHlwZXMuYWRkKEJpZ0RlY2ltYWwuY2xhc3MpOwogICAgICAg\nIF9zdGRUeXBlcy5hZGQoRGF0ZS5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVz\nLmFkZChqYXZhLnNxbC5EYXRlLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMu\nYWRkKGphdmEuc3FsLlRpbWUuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5h\nZGQoamF2YS5zcWwuVGltZXN0YW1wLmNsYXNzKTsKICAgICAgICBfc3RkVHlw\nZXMuYWRkKENhbGVuZGFyLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMuYWRk\nKEdyZWdvcmlhbkNhbGVuZGFyLmNsYXNzKTsKICAgIH0KCiAgICBwcml2YXRl\nIGZpbmFsIENsYXNzIF9yZXN1bHRDbGFzczsKICAgIHByaXZhdGUgZmluYWwg\nU3RyaW5nW10gX2FsaWFzZXM7CiAgICBwcml2YXRlIGZpbmFsIE1lbWJlcltd\nIF9zZXRzOwogICAgcHJpdmF0ZSBmaW5hbCBNZXRob2QgX3B1dDsKICAgIHBy\naXZhdGUgZmluYWwgQ29uc3RydWN0b3IgX2NvbnN0cnVjdG9yOwoKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3IgZm9yIHJlc3VsdCBjbGFzcyB3aXRob3V0\nIGEgcHJvamVjdGlvbi4KICAgICAqLwogICAgcHVibGljIFJlc3VsdFBhY2tl\ncihDbGFzcyBjYW5kaWRhdGUsIFN0cmluZyBhbGlhcywgQ2xhc3MgcmVzdWx0\nQ2xhc3MpIHsKICAgICAgICB0aGlzKGNhbmRpZGF0ZSwgbnVsbCwgbmV3IFN0\ncmluZ1tdeyBhbGlhcyB9LCByZXN1bHRDbGFzcyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3RvciBmb3Igc3RhbmRhcmQgcHJvamVjdGlvbi4K\nICAgICAqCiAgICAgKiBAcGFyYW0gdHlwZXMgdGhlIHByb2plY3Rpb24gdmFs\ndWUgdHlwZXMKICAgICAqIEBwYXJhbSBhbGlhc2VzIHRoZSBhbGlhcyBmb3Ig\nZWFjaCBwcm9qZWN0aW9uIHZhbHVlCiAgICAgKiBAcGFyYW0gcmVzdWx0Q2xh\nc3MgdGhlIGNsYXNzIHRvIHBhY2sgaW50bwogICAgICovCiAgICBwdWJsaWMg\nUmVzdWx0UGFja2VyKENsYXNzW10gdHlwZXMsIFN0cmluZ1tdIGFsaWFzZXMs\nIENsYXNzIHJlc3VsdENsYXNzKSB7CiAgICAgICAgdGhpcyhudWxsLCB0eXBl\ncywgYWxpYXNlcywgcmVzdWx0Q2xhc3MpOwogICAgfQoKICAgIC8qKgogICAg\nICogSW50ZXJuYWwgY29uc3RydWN0b3IuCiAgICAgKi8KICAgIHByaXZhdGUg\nUmVzdWx0UGFja2VyKENsYXNzIGNhbmRpZGF0ZSwgQ2xhc3NbXSB0eXBlcywg\nU3RyaW5nW10gYWxpYXNlcywKICAgICAgICBDbGFzcyByZXN1bHRDbGFzcykg\newogICAgICAgIF9hbGlhc2VzID0gYWxpYXNlczsKICAgICAgICBpZiAocmVz\ndWx0Q2xhc3MuaXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBhc3NlcnRD\nb252ZXJ0YWJsZShjYW5kaWRhdGUsIHR5cGVzLCByZXN1bHRDbGFzcyk7CiAg\nICAgICAgICAgIF9yZXN1bHRDbGFzcyA9IEZpbHRlcnMud3JhcChyZXN1bHRD\nbGFzcyk7CiAgICAgICAgICAgIF9zZXRzID0gbnVsbDsKICAgICAgICAgICAg\nX3B1dCA9IG51bGw7CiAgICAgICAgICAgIF9jb25zdHJ1Y3RvciA9IG51bGw7\nCiAgICAgICAgfSBlbHNlIGlmICghX3N0ZFR5cGVzLmNvbnRhaW5zKF9yZXN1\nbHRDbGFzcyA9IHJlc3VsdENsYXNzKSkgewogICAgICAgICAgICAvLyBjaGVj\nayBmb3IgYSBjb25zdHJ1Y3RvciB0aGF0IG1hdGNoZXMgdGhlIHByb2plY3Rp\nb24gdHlwZXMKICAgICAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IG51bGw7\nCiAgICAgICAgICAgIGlmICh0eXBlcyAhPSBudWxsICYmIHR5cGVzLmxlbmd0\naCA+IDApIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgY29ucyA9IF9yZXN1bHRDbGFzcy5nZXRDb25zdHJ1Y3Rvcih0eXBl\ncyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gbnNtZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIF9jb25zdHJ1Y3RvciA9IGNvbnM7CgogICAgICAgICAg\nICBpZiAoY29ucyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBNZXRob2Rb\nXSBtZXRob2RzID0gX3Jlc3VsdENsYXNzLmdldE1ldGhvZHMoKTsKICAgICAg\nICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gX3Jlc3VsdENsYXNzLmdldEZp\nZWxkcygpOwogICAgICAgICAgICAgICAgX3B1dCA9IGZpbmRQdXQobWV0aG9k\ncyk7CiAgICAgICAgICAgICAgICBfc2V0cyA9IG5ldyBNZW1iZXJbYWxpYXNl\ncy5sZW5ndGhdOwoKICAgICAgICAgICAgICAgIENsYXNzIHR5cGU7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9zZXRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICh0eXBlcyA9PSBu\ndWxsKSA/IGNhbmRpZGF0ZSA6IHR5cGVzW2ldOwogICAgICAgICAgICAgICAg\nICAgIF9zZXRzW2ldID0gZmluZFNldChhbGlhc2VzW2ldLCB0eXBlLCBmaWVs\nZHMsIG1ldGhvZHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChfc2V0c1tp\nXSA9PSBudWxsICYmIF9wdXQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImNhbnQt\nc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENsYXNz\nLCBhbGlhc2VzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlw\nZXMgPT0gbnVsbCA/IG51bGwgOiBBcnJheXMuYXNMaXN0KHR5cGVzKSkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgX3NldHMgPSBudWxsOwogICAgICAgICAgICAgICAgX3B1dCA9\nIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBpZiAocmVzdWx0Q2xhc3MgIT0gTWFwLmNsYXNzICYmIHJlc3VsdENs\nYXNzICE9IEhhc2hNYXAuY2xhc3MKICAgICAgICAgICAgICAgICYmIHJlc3Vs\ndENsYXNzICE9IE9iamVjdFtdLmNsYXNzKQogICAgICAgICAgICAgICAgYXNz\nZXJ0Q29udmVydGFibGUoY2FuZGlkYXRlLCB0eXBlcywgcmVzdWx0Q2xhc3Mp\nOwogICAgICAgICAgICBfc2V0cyA9IG51bGw7CiAgICAgICAgICAgIF9wdXQg\nPSBudWxsOwogICAgICAgICAgICBfY29uc3RydWN0b3IgPSBudWxsOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0IGNvbnZl\ncnNpb24gaXMgcG9zc2libGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nc3NlcnRDb252ZXJ0YWJsZShDbGFzcyBjYW5kaWRhdGUsIENsYXNzW10gdHlw\nZXMsCiAgICAgICAgQ2xhc3MgcmVzdWx0Q2xhc3MpIHsKICAgICAgICBDbGFz\ncyBjID0gKHR5cGVzID09IG51bGwpID8gY2FuZGlkYXRlIDogdHlwZXNbMF07\nCiAgICAgICAgaWYgKCh0eXBlcyAhPSBudWxsICYmIHR5cGVzLmxlbmd0aCAh\nPSAxKSB8fCAoYyAhPSBudWxsCiAgICAgICAgICAgICYmIGMgIT0gT2JqZWN0\nLmNsYXNzICYmICFGaWx0ZXJzLmNhbkNvbnZlcnQoYywgcmVzdWx0Q2xhc3Ms\nIHRydWUpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImNhbnQtY29udmVydC1yZXN1bHQiLAogICAgICAgICAgICAg\nICAgYywgcmVzdWx0Q2xhc3MpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\nY2sgdGhlIGdpdmVuIG9iamVjdCBpbnRvIGFuIGluc3RhbmNlIG9mIHRoZSBx\ndWVyeSdzIHJlc3VsdCBjbGFzcy4KICAgICAqLwogICAgcHVibGljIE9iamVj\ndCBwYWNrKE9iamVjdCByZXN1bHQpIHsKICAgICAgICAvLyBzcGVjaWFsIGNh\nc2VzIGZvciBlZmZpY2llbnQgYmFzaWMgdHlwZXMgd2hlcmUgd2Ugd2FudCB0\nbyBhdm9pZAogICAgICAgIC8vIGNyZWF0aW5nIGFuIGFycmF5IGZvciBjYWxs\nIHRvIGdlbmVyYWwgcGFjayBtZXRob2QgYmVsb3cKICAgICAgICBpZiAoX3Jl\nc3VsdENsYXNzID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nIHJlc3VsdDsKICAgICAgICBpZiAoX3Jlc3VsdENsYXNzID09IE9iamVjdFtd\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdFtdeyByZXN1\nbHQgfTsKICAgICAgICBpZiAoX3Jlc3VsdENsYXNzID09IEhhc2hNYXAuY2xh\nc3MgfHwgX3Jlc3VsdENsYXNzID09IE1hcC5jbGFzcykgewogICAgICAgICAg\nICBIYXNoTWFwIG1hcCA9IG5ldyBIYXNoTWFwKDEsIDFGKTsKICAgICAgICAg\nICAgbWFwLnB1dChfYWxpYXNlc1swXSwgcmVzdWx0KTsKICAgICAgICAgICAg\ncmV0dXJuIG1hcDsKICAgICAgICB9CgogICAgICAgIC8vIHByaW1pdGl2ZSBv\nciBzaW1wbGUgdHlwZT8KICAgICAgICBpZiAoX2NvbnN0cnVjdG9yID09IG51\nbGwgJiYgX3NldHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEZpbHRl\ncnMuY29udmVydChyZXN1bHQsIF9yZXN1bHRDbGFzcyk7CgogICAgICAgIC8v\nIHRoaXMgaXMgc29tZSBjb21wbGV4IGNhc2UsIHNvIHdvcnRoIGl0IHRvIGNy\nZWF0ZSB0aGUgYXJyYXkgYW5kCiAgICAgICAgLy8gdXNlIHRoZSBnZW5lcmFs\nIHBhY2sgbWV0aG9kCiAgICAgICAgcmV0dXJuIHBhY2tVc2VyVHlwZShuZXcg\nT2JqZWN0W117IHJlc3VsdCB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\nY2sgdGhlIGdpdmVuIGFycmF5IGludG8gYW4gaW5zdGFuY2Ugb2YgdGhlIHF1\nZXJ5J3MgcmVzdWx0IGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0\nIHBhY2soT2JqZWN0W10gcmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdCA9\nPSBudWxsIHx8IHJlc3VsdC5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIC8vIHNwZWNpYWwgY2FzZXMgZm9yIG9iamVj\ndCBhcnJheXMgYW5kIG1hcHMKICAgICAgICBpZiAoX3Jlc3VsdENsYXNzID09\nIE9iamVjdFtdLmNsYXNzKSB7CiAgICAgICAgICAgIC8vIHRoZSByZXN1bHQg\nbWlnaHQgY29udGFpbiBleHRyYSBkYXRhIGF0IHRoZSBlbmQKICAgICAgICAg\nICAgaWYgKHJlc3VsdC5sZW5ndGggPiBfYWxpYXNlcy5sZW5ndGgpIHsKICAg\nICAgICAgICAgICAgIE9iamVjdFtdIHRyaW0gPSBuZXcgT2JqZWN0W19hbGlh\nc2VzLmxlbmd0aF07CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKHJlc3VsdCwgMCwgdHJpbSwgMCwgdHJpbS5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRyaW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgaWYgKF9yZXN1bHRD\nbGFzcyA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiByZXN1\nbHRbMF07CiAgICAgICAgaWYgKF9yZXN1bHRDbGFzcyA9PSBIYXNoTWFwLmNs\nYXNzIHx8IF9yZXN1bHRDbGFzcyA9PSBNYXAuY2xhc3MpIHsKICAgICAgICAg\nICAgTWFwIG1hcCA9IG5ldyBIYXNoTWFwKHJlc3VsdC5sZW5ndGgpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hbGlhc2VzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgbWFwLnB1dChfYWxpYXNlc1tpXSwgcmVz\ndWx0W2ldKTsKICAgICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICB9Cgog\nICAgICAgIC8vIHByaW1pdGl2ZSBvciBzaW1wbGUgdHlwZT8KICAgICAgICBp\nZiAoX3NldHMgPT0gbnVsbCAmJiBfY29uc3RydWN0b3IgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIEZpbHRlcnMuY29udmVydChyZXN1bHRbMF0sIF9y\nZXN1bHRDbGFzcyk7CgogICAgICAgIC8vIG11c3QgYmUgYSB1c2VyLWRlZmlu\nZWQgdHlwZQogICAgICAgIHJldHVybiBwYWNrVXNlclR5cGUocmVzdWx0KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhY2sgdGhlIGdpdmVuIHJlc3VsdCBp\nbnRvIHRoZSB1c2VyLWRlZmluZWQgcmVzdWx0IGNsYXNzLgogICAgICovCiAg\nICBwcml2YXRlIE9iamVjdCBwYWNrVXNlclR5cGUoT2JqZWN0W10gcmVzdWx0\nKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdXNlIHRoZSBjb25z\ndHJ1Y3RvciBmaXJzdCwgaWYgd2UgaGF2ZSBvbmUKICAgICAgICAgICAgaWYg\nKF9jb25zdHJ1Y3RvciAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIF9jb25zdHJ1Y3Rvci5uZXdJbnN0YW5jZShyZXN1bHQpOwoKICAgICAgICAg\nICAgT2JqZWN0IHVzZXIgPSBfcmVzdWx0Q2xhc3MubmV3SW5zdGFuY2UoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfYWxpYXNlcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9zZXRzW2ldIGluc3Rh\nbmNlb2YgTWV0aG9kKSB7CiAgICAgICAgICAgICAgICAgICAgTWV0aG9kIG1l\ndGggPSAoTWV0aG9kKSBfc2V0c1tpXTsKICAgICAgICAgICAgICAgICAgICBt\nZXRoLmludm9rZSh1c2VyLCBuZXcgT2JqZWN0W117IEZpbHRlcnMuY29udmVy\ndAogICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0W2ldLCBtZXRoLmdl\ndFBhcmFtZXRlclR5cGVzKClbMF0pIH0pOwogICAgICAgICAgICAgICAgfSBl\nbHNlIGlmIChfc2V0c1tpXSBpbnN0YW5jZW9mIEZpZWxkKSB7CiAgICAgICAg\nICAgICAgICAgICAgRmllbGQgZmllbGQgPSAoRmllbGQpIF9zZXRzW2ldOwog\nICAgICAgICAgICAgICAgICAgIGZpZWxkLnNldCh1c2VyLCBGaWx0ZXJzLmNv\nbnZlcnQocmVzdWx0W2ldLAogICAgICAgICAgICAgICAgICAgICAgICBmaWVs\nZC5nZXRUeXBlKCkpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3B1\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgX3B1dC5pbnZva2Uo\ndXNlciwgbmV3IE9iamVjdFtdeyBfYWxpYXNlc1tpXSwgcmVzdWx0W2ldIH0p\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiB1c2VyOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoSW5zdGFudGlhdGlvbkV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicGFjay1pbnN0YW50\naWF0aW9uLWVyciIsCiAgICAgICAgICAgICAgICBfcmVzdWx0Q2xhc3MpLCBp\nZSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBhY2stZXJy\nIiwgX3Jlc3VsdENsYXNzKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBzZXQgbWV0aG9kIGZvciB0aGUgZ2l2ZW4g\ncHJvcGVydHkuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE1lbWJlciBm\naW5kU2V0KFN0cmluZyBhbGlhcywgQ2xhc3MgdHlwZSwgRmllbGRbXSBmaWVs\nZHMsCiAgICAgICAgTWV0aG9kW10gbWV0aG9kcykgewogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KGFsaWFzKSkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgaWYgKHR5cGUgPT0gT2JqZWN0LmNsYXNzKQogICAg\nICAgICAgICB0eXBlID0gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgcHVibGlj\nIGZpZWxkcyBmaXJzdAogICAgICAgIEZpZWxkIGZpZWxkID0gbnVsbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAvLyBpZiB3ZSBmaW5kIGEgZmllbGQgd2l0aCB0aGUg\nZXhhY3QgbmFtZSwgZWl0aGVyIHJldHVybiBpdAogICAgICAgICAgICAvLyBp\nZiBpdCdzIHRoZSByaWdodCB0eXBlIG9yIGdpdmUgdXAgaWYgaXQncyBub3QK\nICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5nZXROYW1lKCkuZXF1YWxzKGFs\naWFzKSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbAogICAg\nICAgICAgICAgICAgICAgIHx8IEZpbHRlcnMuY2FuQ29udmVydCh0eXBlLCBm\naWVsZHNbaV0uZ2V0VHlwZSgpLCB0cnVlKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSBpZiB3ZSBm\naW5kIGEgZmllbGQgd2l0aCB0aGUgcmlnaHQgbmFtZSBidXQgdGhlCiAgICAg\nICAgICAgIC8vIHdyb25nIGNhc2UsIHJlY29yZCBpdCBhbmQgaWYgd2UgZG9u\nJ3QgZmluZCBhbiBleGFjdCBtYXRjaAogICAgICAgICAgICAvLyBmb3IgYSBm\naWVsZCBvciBzZXR0ZXIgd2UnbGwgdXNlIGl0CiAgICAgICAgICAgIGlmIChm\naWVsZCA9PSBudWxsICYmIGZpZWxkc1tpXS5nZXROYW1lKCkuZXF1YWxzSWdu\nb3JlQ2FzZShhbGlhcykKICAgICAgICAgICAgICAgICYmICh0eXBlID09IG51\nbGwKICAgICAgICAgICAgICAgIHx8IEZpbHRlcnMuY2FuQ29udmVydCh0eXBl\nLCBmaWVsZHNbaV0uZ2V0VHlwZSgpLCB0cnVlKSkpCiAgICAgICAgICAgICAg\nICBmaWVsZCA9IGZpZWxkc1tpXTsKICAgICAgICB9CgogICAgICAgIC8vIGNo\nZWNrIHNldHRlciBtZXRob2RzCiAgICAgICAgU3RyaW5nIHNldE5hbWUgPSAi\nc2V0IiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoYWxpYXMpOwogICAgICAg\nIE1ldGhvZCBtZXRob2QgPSBudWxsOwogICAgICAgIGJvb2xlYW4gZXFOYW1l\nID0gZmFsc2U7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXM7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBtZXRob2RzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghbWV0aG9kc1tpXS5nZXROYW1lKCkuZXF1YWxzSWdub3Jl\nQ2FzZShzZXROYW1lKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICBwYXJhbXMgPSBtZXRob2RzW2ldLmdldFBhcmFtZXRlclR5cGVz\nKCk7CiAgICAgICAgICAgIGlmIChwYXJhbXMubGVuZ3RoICE9IDEpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmICh0eXBlICE9\nIG51bGwgJiYgcGFyYW1zWzBdID09IE9iamVjdC5jbGFzcykgewogICAgICAg\nICAgICAgICAgLy8gd2UgZm91bmQgYSBnZW5lcmljIG9iamVjdCBzZXR0ZXI7\nIG5vdyBzZWUgaWYgdGhlIG5hbWUKICAgICAgICAgICAgICAgIC8vIGlzIGFu\nIGV4YWN0IG1hdGNoLCBhbmQgaWYgc28gcmVjb3JkIHRoaXMgc2V0dGVyLiAg\naWYgd2UKICAgICAgICAgICAgICAgIC8vIGRvbid0IGZpbmQgYW4gZXhhY3Qg\ndHlwZSBtYXRjaCBsYXRlciwgd2UnbGwgdXNlIGl0LiAgaWYKICAgICAgICAg\nICAgICAgIC8vIHRoZSBuYW1lcyBhcmUgbm90IGFuIGV4YWN0IG1hdGNoLCBv\nbmx5IHJlY29yZCB0aGlzIHNldHRlcgogICAgICAgICAgICAgICAgLy8gaWYg\nd2UgaGF2ZW4ndCBmb3VuZCBhbnkgb3RoZXJzIHRoYXQgbWF0Y2ggYXQgYWxs\nCiAgICAgICAgICAgICAgICBpZiAobWV0aG9kc1tpXS5nZXROYW1lKCkuZXF1\nYWxzKHNldE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgZXFOYW1lID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBtZXRob2RzW2ld\nOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBtZXRob2RzW2ldOwogICAg\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCB8\nfCBGaWx0ZXJzLmNhbkNvbnZlcnQodHlwZSwgcGFyYW1zWzBdLCB0cnVlKSkg\newogICAgICAgICAgICAgICAgLy8gd2UgZm91bmQgYSBzZXR0ZXIgd2l0aCB0\naGUgcmlnaHQgdHlwZTsgbm93IHNlZSBpZiB0aGUgbmFtZQogICAgICAgICAg\nICAgICAgLy8gaXMgYW4gZXhhY3QgbWF0Y2guICBpZiBzbywgcmV0dXJuIHRo\nZSBzZXR0ZXIuICBpZiBub3QsCiAgICAgICAgICAgICAgICAvLyByZWNvcmQg\ndGhlIHNldHRlciBvbmx5IGlmIHdlIGhhdmVuJ3QgZm91bmQgYSBnZW5lcmlj\nIG9uZQogICAgICAgICAgICAgICAgLy8gd2l0aCBhbiBleGFjdCBuYW1lIG1h\ndGNoCiAgICAgICAgICAgICAgICBpZiAobWV0aG9kc1tpXS5nZXROYW1lKCku\nZXF1YWxzKHNldE5hbWUpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBt\nZXRob2RzW2ldOwogICAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PSBudWxs\nIHx8ICFlcU5hbWUpCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gbWV0\naG9kc1tpXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\naWYgd2UgaGF2ZSBhbiBleGFjdCBtZXRob2QgbmFtZSBtYXRjaCwgcmV0dXJu\nIGl0OyBvdGhlcndpc2UgZmF2b3IKICAgICAgICAvLyBhbiBpbmV4YWN0IGZp\nZWxkIHRvIGFuIGluZXhhY3QgbWV0aG9kCiAgICAgICAgaWYgKGVxTmFtZSB8\nfCBmaWVsZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWV0aG9kOwog\nICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgcHV0IG1ldGhvZCBpZiBvbmUgZXhpc3RzLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBNZXRob2QgZmluZFB1dChNZXRob2RbXSBtZXRo\nb2RzKSB7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXM7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBtZXRob2RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmICghbWV0aG9kc1tpXS5nZXROYW1lKCkuZXF1YWxzKCJwdXQiKSkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgcGFyYW1z\nID0gbWV0aG9kc1tpXS5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAg\nICBpZiAocGFyYW1zLmxlbmd0aCA9PSAyCiAgICAgICAgICAgICAgICAmJiBw\nYXJhbXNbMF0gPT0gT2JqZWN0LmNsYXNzCiAgICAgICAgICAgICAgICAmJiBw\nYXJhbXNbMV0gPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG1ldGhvZHNbaV07CiAgICAgICAgfQoJCXJldHVybiBudWxsOwoJfQp9\nCg==\n","encoding":"base64"}

