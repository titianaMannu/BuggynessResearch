{"sha":"f17042035884eef8bc9133d04aad169bd02dd9ca","node_id":"MDQ6QmxvYjIwNjM2NDpmMTcwNDIwMzU4ODRlZWY4YmM5MTMzZDA0YWFkMTY5YmQwMmRkOWNh","size":101917,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f17042035884eef8bc9133d04aad169bd02dd9ca","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQg\namF2YS51dGlsLio7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2Fs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdy\nb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0\nZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVT\ndHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBw\nbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5F\neGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9y\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEltcGxlbWVu\ndGF0aW9uIG9mIHRoZSB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlcn0gaW50\nZXJmYWNlIGZvciB1c2UKICogd2l0aCB0aGlzIHJ1bnRpbWUuIEVhY2ggc3Rh\ndGUgbWFuYWdlciBtYW5hZ2VzIHRoZSBzdGF0ZSBvZiBhIHNpbmdsZQogKiBw\nZXJzaXN0ZW5jZSBjYXBhYmxlIGluc3RhbmNlLiBUaGUgc3RhdGUgbWFuYWdl\nciBpcyBhbHNvIHJlc3BvbnNpYmxlIGZvcgogKiBhbGwgY29tbXVuaWNhdGlv\nbnMgYWJvdXQgdGhlIGluc3RhbmNlIHRvIHRoZSB7QGxpbmsgU3RvcmVNYW5h\nZ2VyfS4KICogIFRoZSBzdGF0ZSBtYW5hZ2VyIHVzZXMgdGhlIFN0YXRlIHBh\ndHRlcm4gaW4gYm90aCBpdHMgaW50ZXJhY3Rpb24gd2l0aAogKiB0aGUgZ292\nZXJuZWQgaW5zdGFuY2UgYW5kIGl0cyBpbnRlcmFjdGlvbiB3aXRoIHRoZSBi\ncm9rZXIuCiAqIEluIGl0cyBpbnRlcmFjdGlvbnMgd2l0aCB0aGUgcGVyc2lz\ndGVuY2UgY2FwYWJsZSBpbnN0YW5jZSwgaXQgdXNlcyB0aGUKICoge0BsaW5r\nIEZpZWxkTWFuYWdlcn0gaW50ZXJmYWNlLiBTaW1pbGFybHksIHdoZW4gaW50\nZXJhY3Rpbmcgd2l0aCB0aGUKICogYnJva2VyLCBpdCB1c2VzIHRoZSB7QGxp\nbmsgUENTdGF0ZX0gc2luZ2xldG9uIHRoYXQgcmVwcmVzZW50cwogKiB0aGUg\nY3VycmVudCBsaWZlY3ljbGUgc3RhdGUgb2YgdGhlIGluc3RhbmNlLgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFN0YXRlTWFu\nYWdlckltcGwKICAgIGltcGxlbWVudHMgT3BlbkpQQVN0YXRlTWFuYWdlciB7\nCgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9BRF9GR1MgPSAwOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9BRF9BTEwgPSAxOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9BRF9TRVJJQUxJWkUgPSAyOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1NBVkUgPSAyIDw8\nIDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19ERVJFRiA9\nIDIgPDwgMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0xP\nQURFRCA9IDIgPDwgMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1JFQURfTE9DS0VEID0gMiA8PCAzOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfV1JJVEVfTE9DS0VEID0gMiA8PCA0OwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfT0lEX0FTU0lHTkVEID0gMiA8\nPCA1OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfTE9BRElO\nRyA9IDIgPDwgNjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFH\nX1BSRV9ERUxFVElORyA9IDIgPDwgNzsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0ZMVVNIRUQgPSAyIDw8IDg7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19QUkVfRkxVU0hFRCA9IDIgPDwgOTsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNIRURfRElSVFkg\nPSAyIDw8IDEwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nSU1QTF9DQUNIRSA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBpbnQgRkxBR19JTlZFUlNFUyA9IDIgPDwgMTI7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19OT19VTlBST1hZID0gMiA8PCAxMzsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1ZFUlNJT05fQ0hFQ0sg\nPSAyIDw8IDE0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nVkVSU0lPTl9VUERBVEUgPSAyIDw8IDE1OwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfREVUQUNISU5HID0gMiA8PCAxNjsKCiAgICBwcml2\nYXRlIHN0YXRpYyBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKFN0YXRlTWFuYWdlckltcGwuY2xhc3MpOwoKICAgIC8v\nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBpbnN0YW5jZQogICAgcHJpdmF0ZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgX3BjID0gbnVsbDsKICAgIHByaXZhdGUgQ2xh\nc3NNZXRhRGF0YSBfbWV0YSA9IG51bGw7CiAgICBwcml2YXRlIEJpdFNldCBf\nbG9hZGVkID0gbnVsbDsKICAgIHByaXZhdGUgQml0U2V0IF9kaXJ0eSA9IG51\nbGw7CiAgICBwcml2YXRlIEJpdFNldCBfZmx1c2ggPSBudWxsOwogICAgcHJp\ndmF0ZSBpbnQgX2ZsYWdzID0gMDsKCiAgICAvLyBpZCBpcyB0aGUgc3RhdGUg\nbWFuYWdlciBpZGVudGl0eTsgb2lkIGlzIHRoZSBwZXJzaXN0ZW50IGlkZW50\naXR5LiAgb2lkCiAgICAvLyBtYXkgYmUgbnVsbCBmb3IgZW1iZWRkZWQgYW5k\nIHRyYW5zaWVudC10cmFuc2FjdGlvbmFsIG9iamVjdHMgb3IgbmV3CiAgICAv\nLyBpbnN0YW5jZXMgdGhhdCBoYXZlbid0IGJlZW4gYXNzaWduZWQgYW4gb2lk\nLiAgaWQgaXMgcmVhc3NpZ25lZCB0byBvaWQKICAgIC8vIG9uIHN1Y2Nlc3Nm\ndWwgb2lkIGFzc2lnbm1lbnQgKG9yIGZsdXNoIGNvbXBsZXRpb24gaWYgYXNz\naWdubWVudCBpcwogICAgLy8gZHVyaW5nIGZsdXNoKQogICAgcHJpdmF0ZSBP\nYmplY3QgX2lkID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0IF9vaWQgPSBu\ndWxsOwoKICAgIC8vIHRoZSBtYW5hZ2luZyBwZXJzaXN0ZW5jZSBtYW5hZ2Vy\nIGFuZCBsaWZlY3ljbGUgc3RhdGUKICAgIHByaXZhdGUgZmluYWwgQnJva2Vy\nSW1wbCBfYnJva2VyOwogICAgcHJpdmF0ZSBQQ1N0YXRlIF9zdGF0ZSA9IFBD\nU3RhdGUuVFJBTlNJRU5UOwoKICAgIC8vIHRoZSBjdXJyZW50IGFuZCBsYXN0\nIGxvYWRlZCB2ZXJzaW9uIGluZGljYXRvcnMsIGFuZCB0aGUgbG9jayBvYmpl\nY3QKICAgIHByaXZhdGUgT2JqZWN0IF92ZXJzaW9uID0gbnVsbDsKICAgIHBy\naXZhdGUgT2JqZWN0IF9sb2FkVmVyc2lvbiA9IG51bGw7CiAgICBwcml2YXRl\nIE9iamVjdCBfbG9jayA9IG51bGw7CiAgICBwcml2YXRlIGludCBfcmVhZExv\nY2tMZXZlbCA9IC0xOwogICAgcHJpdmF0ZSBpbnQgX3dyaXRlTG9ja0xldmVs\nID0gLTE7CgogICAgLy8gZGVsZWdhdGVzIHdoZW4gcHJvdmlkaW5nL3JlcGxh\nY2luZyBpbnN0YW5jZSBkYXRhCiAgICBwcml2YXRlIFNpbmdsZUZpZWxkTWFu\nYWdlciBfc2luZ2xlID0gbnVsbDsKICAgIHByaXZhdGUgU2F2ZUZpZWxkTWFu\nYWdlciBfc2F2ZWQgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1hbmFnZXIg\nX2ZtID0gbnVsbDsKCiAgICAvLyBpbXBsZGF0YTsgZmllbGQgaW1wbGRhdGEg\nYW5kIGludGVybWVkaWF0ZSBkYXRhIHNoYXJlIHRoZSBzYW1lIGFycmF5CiAg\nICBwcml2YXRlIE9iamVjdCBfaW1wbCA9IG51bGw7CiAgICBwcml2YXRlIE9i\namVjdFtdIF9maWVsZEltcGwgPSBudWxsOwoKICAgIC8vIGluZm9ybWF0aW9u\nIGFib3V0IHRoZSBvd25lciBvZiB0aGlzIGluc3RhbmNlLCBpZiBpdCBpcyBl\nbWJlZGRlZAogICAgcHJpdmF0ZSBTdGF0ZU1hbmFnZXJJbXBsIF9vd25lciA9\nIG51bGw7CiAgICBwcml2YXRlIFZhbHVlTWV0YURhdGEgX293bmVyTWV0YSA9\nIG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvcjsgc3VwcGx5IGlk\nLCB0eXBlIG1ldGFkYXRhLCBhbmQgb3duaW5nIHBlcnNpc3RlbmNlIG1hbmFn\nZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsKE9i\namVjdCBpZCwgQ2xhc3NNZXRhRGF0YSBtZXRhLCAKICAgICAgICBCcm9rZXJJ\nbXBsIGJyb2tlcikgewogICAgICAgIF9pZCA9IGlkOwogICAgICAgIF9tZXRh\nID0gbWV0YTsKICAgICAgICBfYnJva2VyID0gYnJva2VyOwogICAgICAgIF9z\naW5nbGUgPSBuZXcgU2luZ2xlRmllbGRNYW5hZ2VyKHRoaXMsIGJyb2tlcik7\nCgogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIF9tZXRh\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG93bmluZyBzdGF0\nZSBhbmQgZmllbGQgaWYgdGhpcyBpcyBhbiBlbWJlZGRlZCBpbnN0YW5jZS4K\nICAgICAqLwogICAgdm9pZCBzZXRPd25lcihTdGF0ZU1hbmFnZXJJbXBsIG93\nbmVyLCBWYWx1ZU1ldGFEYXRhIG93bmVyTWV0YSkgewogICAgICAgIF9vd25l\nciA9IG93bmVyOwogICAgICAgIF9vd25lck1ldGEgPSBvd25lck1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3RhdGUgbWFuYWdl\nciBpcyBpbiB0aGUgbWlkZGxlIG9mIGEgbG9hZC4KICAgICAqLwogICAgYm9v\nbGVhbiBpc0xvYWRpbmcoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBG\nTEFHX0xPQURJTkcpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhpcyBzdGF0ZSBtYW5hZ2VyIGlzIGluIHRoZSBtaWRkbGUgb2YgYSBs\nb2FkIGluaXRpYXRlZAogICAgICogYnkgb3V0c2lkZSBjb2RlOyBmb3IgYW55\nIGludGVybmFsIG1ldGhvZHMgdGhhdCBjYXVzZSBsb2FkaW5nLCB0aGUKICAg\nICAqIGxvYWRpbmcgZmxhZyBpcyBzZXQgYXV0b21hdGljYWxseS4KICAgICAq\nLwogICAgdm9pZCBzZXRMb2FkaW5nKGJvb2xlYW4gbG9hZGluZykgewogICAg\nICAgIGlmIChsb2FkaW5nKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19M\nT0FESU5HOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX0xPQURJTkc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb3IgcmVz\nZXQgdGhlIGxpZmVjeWNsZSBzdGF0ZSBvZiB0aGUgbWFuYWdlZCBpbnN0YW5j\nZS4gSWYgdGhlCiAgICAgKiB0cmFuc2FjdGlvbmFsIHN0YXRlIG9mIHRoZSBp\nbnN0YW5jZSBjaGFuZ2VzLCBpdCB3aWxsIGJlIGVubGlzdGVkLwogICAgICog\nZGVsaXN0ZWQgZnJvbSB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyBuZWNl\nc3NhcnkuIFRoZSBnaXZlbgogICAgICogc3RhdGUgd2lsbCBiZSBpbml0aWFs\naXplZCBhZnRlciBiZWluZyBzZXQuIElmIHRoZSBnaXZlbiBzdGF0ZQogICAg\nICogaXMgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgc3RhdGUsIHRoaXMgbWV0\naG9kIHdpbGwgaGF2ZSBubyBlZmZlY3QuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBzZXRQQ1N0YXRlKFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAo\nX3N0YXRlID09IHN0YXRlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBub3RpZnkg\ndGhlIHN0b3JlIG1hbmFnZXIgdGhhdCB3ZSdyZSBjaGFuZ2luZyBzdGF0ZXM7\nIGNhbiB2ZXRvCiAgICAgICAgICAgIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2Vy\nKCkuYmVmb3JlU3RhdGVDaGFuZ2UodGhpcywgX3N0YXRlLCBzdGF0ZSk7Cgog\nICAgICAgICAgICAvLyByZXBsYWNlIHN0YXRlCiAgICAgICAgICAgIGJvb2xl\nYW4gd2FzRGVsZXRlZCA9IF9zdGF0ZS5pc0RlbGV0ZWQoKTsKICAgICAgICAg\nICAgYm9vbGVhbiB3YXNEaXJ0eSA9IF9zdGF0ZS5pc0RpcnR5KCk7CiAgICAg\nICAgICAgIGJvb2xlYW4gd2FzUGVuZGluZyA9IF9zdGF0ZS5pc1BlbmRpbmdU\ncmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgIF9zdGF0ZSA9IHN0YXRlOwoK\nICAgICAgICAgICAgLy8gZW5saXN0L2RlbGlzdCBmcm9tIHRyYW5zYWN0aW9u\nCiAgICAgICAgICAgIGlmIChfc3RhdGUuaXNUcmFuc2FjdGlvbmFsKCkpIHsK\nICAgICAgICAgICAgICAgIF9icm9rZXIuYWRkVG9UcmFuc2FjdGlvbih0aGlz\nKTsKICAgICAgICAgICAgICAgIGlmIChfc3RhdGUuaXNEZWxldGVkKCkgIT0g\nd2FzRGVsZXRlZCkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERp\ncnR5KHRoaXMsICF3YXNEaXJ0eSB8fCBpc0ZsdXNoZWQoKSk7CiAgICAgICAg\nICAgICAgICBlbHNlIGlmIChfc3RhdGUuaXNEaXJ0eSgpICYmICF3YXNEaXJ0\neSkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRoaXMs\nIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKCF3YXNQZW5kaW5nICYm\nIF9zdGF0ZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCkpCiAgICAgICAgICAg\nICAgICBfYnJva2VyLmFkZFRvUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwog\nICAgICAgICAgICBlbHNlIGlmICh3YXNQZW5kaW5nICYmICFfc3RhdGUuaXNQ\nZW5kaW5nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tl\nci5yZW1vdmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZUZyb21U\ncmFuc2FjdGlvbih0aGlzKTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUK\nICAgICAgICAgICAgX3N0YXRlLmluaXRpYWxpemUodGhpcyk7CiAgICAgICAg\nICAgIGlmIChfc3RhdGUuaXNEZWxldGVkKCkgJiYgIXdhc0RlbGV0ZWQpCiAg\nICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZl\nbnQuQUZURVJfREVMRVRFKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgaW5p\ndGlhbGl6ZShDbGFzcyBjbHMsIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICAv\nLyBjaGVjayB0byBzZWUgaWYgb3VyIGN1cnJlbnQgb2JqZWN0IGlkIGluc3Rh\nbmNlIGlzIHRoZQogICAgICAgIC8vIGNvcnJlY3QgaWQgdHlwZSBmb3IgdGhl\nIHNwZWNpZmllZCBjbGFzczsgdGhpcyBpcyBmb3IgY2FzZXMKICAgICAgICAv\nLyB3aGVuIHdlIGhhdmUgYW4gYXBwbGljYXRpb24gaWQgaGllcmFyY2h5IGFu\nZCB3ZSBoYWQgc2V0IHRoZQogICAgICAgIC8vIG1ldGFkYXRhIHRvIGEgc3Vw\nZXJjbGFzcyBpZCAtLSB0aGUgc3ViY2xhc3MnIGlkIG1heSBiZSBhCiAgICAg\nICAgLy8gZGlmZmVyZW50IGNsYXNzLCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGl0\nCiAgICAgICAgaWYgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBjbHMp\nIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdWIgPSBfbWV0YS5nZXRS\nZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGEKICAgICAgICAgICAgICAgIChjbHMs\nIF9icm9rZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChfb2lkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFT\nVE9SRSkKICAgICAgICAgICAgICAgICAgICBfb2lkID0gX2Jyb2tlci5nZXRT\ndG9yZU1hbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQoX29pZCwKICAgICAgICAg\nICAgICAgICAgICAgICAgc3ViKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgICAgICAg\nICAgX29pZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgc3ViKTsKICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKHN1Yi5nZXRPYmplY3RJZFR5cGUoKSAh\nPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAgICAgICAg\nICAgIE9iamVjdFtdIHBrRmllbGRzID0gQXBwbGljYXRpb25JZHMudG9QS1Zh\nbHVlcyhfb2lkLCBfbWV0YSk7CiAgICAgICAgICAgICAgICAgICAgX29pZCA9\nIEFwcGxpY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhwa0ZpZWxkcywgc3ViKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBf\nbWV0YSA9IHN1YjsKICAgICAgICB9CiAgICAgICAgaWYgKGNscy5pc0ludGVy\nZmFjZSgpKQogICAgICAgICAgICBjbHMgPSBfbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0ID0gUENS\nZWdpc3RyeS5uZXdJbnN0YW5jZShjbHMsIHRoaXMsIF9vaWQsIHRydWUpOwog\nICAgICAgIGlmIChpbnN0ID09IG51bGwpIHsKICAgICAgICAgICAgLy8gdGhl\nIGluc3RhbmNlIHdhcyBudWxsOiBjaGVjayB0byBzZWUgaWYgdGhlIGluc3Rh\nbmNlIGlzCiAgICAgICAgICAgIC8vIGFic3RyYWN0IChhcyBjYW4gc29tZXRp\nbWVzIGJlIHRoZSBjYXNlIHdoZW4gdGhlCiAgICAgICAgICAgIC8vIGNsYXNz\nIGRpc2NyaW1pbmF0b3Igc3RyYXRlZ3kgaXMgbm90IGNvbmZpZ3VyZWQgY29y\ncmVjdGx5KQogICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNBYnN0cmFjdChj\nbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImluc3RhbnRpYXRlLWFic3RyYWN0\nIiwKICAgICAgICAgICAgICAgICAgICBjbHMuZ2V0TmFtZSgpLCBfb2lkKSk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgaW5pdGlhbGl6ZShpbnN0LCBzdGF0ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHdpdGggdGhlIGdpdmVu\nIGluc3RhbmNlIGFuZCBzdGF0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgaW5pdGlhbGl6ZShQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIFBDU3RhdGUg\nc3RhdGUpIHsKICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImluaXQtbnVsbC1w\nYyIsIF9tZXRhKSk7CiAgICAgICAgaWYgKHBjLnBjR2V0U3RhdGVNYW5hZ2Vy\nKCkgIT0gbnVsbCAmJiBwYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IHRoaXMp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpbml0LXNtLXBjIiwKICAgICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9T\ndHJpbmcocGMpKSkuc2V0RmFpbGVkT2JqZWN0KHBjKTsKICAgICAgICBwYy5w\nY1JlcGxhY2VTdGF0ZU1hbmFnZXIodGhpcyk7CgogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgX2xv\nYWRlZCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAgIF9mbHVz\naCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAgIF9kaXJ0eSA9\nIG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8g\nbWFyayBwcmltYXJ5IGtleSBhbmQgbm9uLXBlcnNpc3RlbnQgZmllbGRzIGFz\nIGxvYWRlZAogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1ByaW1hcnlLZXko\nKQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkg\nIT0gZm1kc1tpXS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAg\nIF9sb2FkZWQuc2V0KGkpOwoKICAgICAgICAgICAgLy8gcmVjb3JkIHdoZXRo\nZXIgdGhlcmUgYXJlIGFueSBtYW5hZ2VkIGludmVyc2UgZmllbGRzCiAgICAg\nICAgICAgIGlmIChfYnJva2VyLmdldEludmVyc2VNYW5hZ2VyKCkgIT0gbnVs\nbAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRJbnZlcnNlTWV0YURh\ndGFzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX0lOVkVSU0VTOwogICAgICAgIH0KCiAgICAgICAgcGMucGNTZXREZXRh\nY2hlZFN0YXRlKG51bGwpOwogICAgICAgIF9wYyA9IHBjOwoKICAgICAgICBp\nZiAoX29pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAgICAgICAgKChP\ncGVuSlBBSWQpIF9vaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBv\ndXIgc3RhdGUgYW5kIGFkZCBvdXJzZWx2ZXMgdG8gdGhlIGJyb2tlcidzIGNh\nY2hlCiAgICAgICAgc2V0UENTdGF0ZShzdGF0ZSk7CiAgICAgICAgX2Jyb2tl\nci5zZXRTdGF0ZU1hbmFnZXIoX2lkLCB0aGlzLCBCcm9rZXJJbXBsLlNUQVRV\nU19JTklUKTsKICAgICAgICBpZiAoc3RhdGUgPT0gUENTdGF0ZS5QTkVXKQog\nICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQu\nQUZURVJfUEVSU0lTVCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXJlIHRo\nZSBnaXZlbiBsaWZlY3ljbGUgZXZlbnQgdG8gYWxsIGxpc3RlbmVycy4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGZpcmVMaWZlY3ljbGVFdmVudChp\nbnQgdHlwZSkgewogICAgICAgIHJldHVybiBfYnJva2VyLmZpcmVMaWZlY3lj\nbGVFdmVudChnZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVsbCwKICAgICAgICAg\nICAgX21ldGEsIHR5cGUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQo\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgbG9hZChmZXRj\naCwgTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIExvYWQgdGhlIHN0YXRlIG9mIHRoaXMgaW5zdGFuY2UgYmFz\nZWQgb24gdGhlIGdpdmVuIGZldGNoIGNvbmZpZ3VyYXRpb24KICAgICAqIGFu\nZCBsb2FkIG1vZGUuIFJldHVybiB0cnVlIGlmIGFueSBkYXRhIHdhcyBsb2Fk\nZWQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gbG9hZChGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2Fk\nTW9kZSwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IHNkYXRhLCBi\nb29sZWFuIGZvcldyaXRlKSB7CiAgICAgICAgaWYgKCFmb3JXcml0ZSAmJiAo\nIWlzUGVyc2lzdGVudCgpIHx8IGlzTmV3KCkgfHwgaXNEZWxldGVkKCkpKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGlmIGFueSBm\naWVsZHMgYmVpbmcgbG9hZGVkLCBkbyBzdGF0ZSB0cmFuc2l0aW9ucyBmb3Ig\ncmVhZAogICAgICAgIEJpdFNldCBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVy\nbmFsKGZldGNoLCBsb2FkTW9kZSwgZXhjbHVkZSk7CiAgICAgICAgYm9vbGVh\nbiBhY3RpdmUgPSBfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgaWYgKCFm\nb3JXcml0ZSAmJiBmaWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgYmVmb3Jl\nUmVhZCgtMSk7CgogICAgICAgIC8vIGNhbGwgbG9hZCBldmVuIGlmIG5vIGZp\nZWxkcyBhcmUgYmVpbmcgbG9hZGVkLCBiZWNhdXNlIGl0IHRha2VzCiAgICAg\nICAgLy8gY2FyZSBvZiBjaGVja2luZyBpZiB0aGUgREZHIGlzIGxvYWRlZCwg\nbWFraW5nIHN1cmUgdmVyc2lvbiBpbmZvCiAgICAgICAgLy8gaXMgbG9hZGVk\nLCBldGMKICAgICAgICBpbnQgbG9ja0xldmVsID0gY2FsY3VsYXRlTG9ja0xl\ndmVsKGFjdGl2ZSwgZm9yV3JpdGUsIGZldGNoKTsKICAgICAgICBib29sZWFu\nIHJldCA9IGxvYWRGaWVsZHMoZmllbGRzLCBmZXRjaCwgbG9ja0xldmVsLCBz\nZGF0YSwgZm9yV3JpdGUpOwogICAgICAgIG9idGFpbkxvY2tzKGFjdGl2ZSwg\nZm9yV3JpdGUsIGxvY2tMZXZlbCwgZmV0Y2gsIHNkYXRhKTsKICAgICAgICBy\nZXR1cm4gcmV0OwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0TWFuYWdl\nZEluc3RhbmNlKCkgewogICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAg\ncHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIF9wYzsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX21ldGE7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZ2V0T3duZXIoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0KCiAg\nICBwdWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRPd25lck1ldGFEYXRhKCkgewog\nICAgICAgIHJldHVybiBfb3duZXJNZXRhOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRW1iZWRkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lciAh\nPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZCgp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgPiAw\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZERpcnR5KCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZ\nKSA+IDA7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXRMb2FkZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9sb2FkZWQ7CiAgICB9CgogICAgcHVibGljIEJp\ndFNldCBnZXRGbHVzaGVkKCkgewogICAgICAgIHJldHVybiBfZmx1c2g7CiAg\nICB9CgogICAgcHVibGljIEJpdFNldCBnZXREaXJ0eSgpIHsKICAgICAgICBy\nZXR1cm4gX2RpcnR5OwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0VW5s\nb2FkZWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgLy8g\nY29sbGVjdCBmaWVsZHMgdG8gbG9hZCBmcm9tIGRhdGEgc3RvcmUgYmFzZWQg\nb24gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIEJpdFNldCBmaWVsZHMg\nPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7\nCiAgICAgICAgcmV0dXJuIChmaWVsZHMgPT0gbnVsbCkgPyBuZXcgQml0U2V0\nKDApIDogZmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwg\ndmVyc2lvbiBvZiB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlciNnZXRVbmxv\nYWRlZH0gdGhhdCBhdm9pZHMKICAgICAqIGNyZWF0aW5nIGFuIGVtcHR5IGJp\ndCBzZXQgYnkgcmV0dXJuaW5nIG51bGwgd2hlbiB0aGVyZSBhcmUgbm8gdW5s\nb2FkZWQKICAgICAqIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRT\nZXQgZ2V0VW5sb2FkZWRJbnRlcm5hbChGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGludCBtb2RlLAogICAgICAgIEJpdFNldCBleGNsdWRlKSB7CiAgICAg\nICAgaWYgKGV4Y2x1ZGUgPT0gU3RvcmVDb250ZXh0LkVYQ0xVREVfQUxMKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQml0U2V0IGZpZWxk\ncyA9IG51bGw7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIGxvYWQ7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChfbG9hZGVkLmdldChpKSB8fCAoZXhjbHVkZSAhPSBudWxs\nICYmIGV4Y2x1ZGUuZ2V0KGkpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIExPQURfU0VSSUFMSVpFOgogICAgICAgICAgICAgICAgICAgIGxv\nYWQgPSAhZm1kc1tpXS5pc1RyYW5zaWVudCgpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMT0FEX0ZHUzoKICAg\nICAgICAgICAgICAgICAgICBsb2FkID0gZmV0Y2ggPT0gbnVsbCB8fCBmZXRj\naC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAgICAgICAgICAg\nICAgICAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nIC8vIExPQURfQUxMCiAgICAgICAgICAgICAgICAgICAgbG9hZCA9IHRydWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2FkKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAg\nICAgICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9CgogICAgcHVibGlj\nIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIC8qKgogICAgICogTWFuYWdpbmcgYnJva2Vy\nLgogICAgICovCiAgICBCcm9rZXJJbXBsIGdldEJyb2tlcigpIHsKICAgICAg\nICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndElkKCkgewogICAgICAgIHJldHVybiBfaWQ7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRPYmplY3RJZCgpIHsKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20uZ2V0T3duZXIoKSAh\nPSBudWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBz\nbS5nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbS5fb2lkOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldE9iamVjdElkKE9iamVjdCBvaWQpIHsKICAg\nICAgICBfb2lkID0gb2lkOwogICAgICAgIGlmIChfcGMgIT0gbnVsbCAmJiBv\naWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQ\nQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3Np\nZ25PYmplY3RJZChib29sZWFuIGZsdXNoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJ\nZChmbHVzaCwgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFzayBzdG9yZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIgb2lkLCBvcHRpb25h\nbGx5IGZsdXNoaW5nIGFuZAogICAgICogb3B0aW9uYWxseSByZWNhY2hpbmcg\nb24gdGhlIG5ldyBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBh\nc3NpZ25PYmplY3RJZChib29sZWFuIGZsdXNoLCBib29sZWFuIHByZUZsdXNo\naW5nKSB7CiAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCB8fCBpc0VtYmVkZGVk\nKCkgfHwgIWlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYXNz\naWduT2JqZWN0SWQodGhpcywgcHJlRmx1c2hpbmcpKSB7CiAgICAgICAgICAg\nIGlmICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgICAgICBhc3NlcnRPYmpl\nY3RJZEFzc2lnbmVkKHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAoZmx1c2gp\nCiAgICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSB3ZXJlIGFzc2ln\nbmVkIGFuIG9pZCwgYW5kIHBlcmZvcm0gYWN0aW9ucyB0byBtYWtlIGl0CiAg\nICAgKiBwZXJtYW5lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHJlY2FjaGUg\nd2hldGhlciB0byByZWNhY2hlIG91cnNlbGYgb24gdGhlIG5ldyBvaWQKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE9iamVjdElkQXNzaWduZWQo\nYm9vbGVhbiByZWNhY2hlKSB7CiAgICAgICAgaWYgKCFpc05ldygpIHx8IGlz\nRGVsZXRlZCgpIHx8IGlzUHJvdmlzaW9uYWwoKSAKICAgICAgICAgICAgfHwg\nKF9mbGFncyAmIEZMQUdfT0lEX0FTU0lHTkVEKSAhPSAwKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAg\nICAgICAgICAgICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgICAg\nICAgICBfb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKF9wYywgX21ldGEp\nOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG9yaWcgPSBfaWQ7CiAgICAg\nICAgX2lkID0gX29pZDsKICAgICAgICBpZiAocmVjYWNoZSkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgX2Jyb2tlci5zZXRTdGF0ZU1h\nbmFnZXIob3JpZywgdGhpcywKICAgICAgICAgICAgICAgICAgICBCcm9rZXJJ\nbXBsLlNUQVRVU19PSURfQVNTSUdOKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgX2lkID0g\nb3JpZzsKICAgICAgICAgICAgICAgIF9vaWQgPSBudWxsOwogICAgICAgICAg\nICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfT0lEX0FTU0lHTkVEOwogICAgfQoKICAgIC8q\nKgogICAgICogQXNzaWduIHRoZSBwcm9wZXIgZ2VuZXJhdGVkIHZhbHVlIHRv\nIHRoZSBnaXZlbiBmaWVsZCBiYXNlZCBvbiBpdHMKICAgICAqIHZhbHVlLXN0\ncmF0ZWd5LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gYXNzaWduRmll\nbGQoaW50IGZpZWxkLCBib29sZWFuIHByZUZsdXNoaW5nKSB7CiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IHRoaXM7CiAgICAgICAgd2hpbGUg\nKHNtLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgc20gPSBzbS5nZXRPd25l\ncigpOwogICAgICAgIGlmICghc20uaXNOZXcoKSB8fCBzbS5pc0ZsdXNoZWQo\nKSB8fCBzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICAvLyBzcGVjaWFsLWNhc2Ugb2lkIGZpZWxkcywgd2hpY2gg\ncmVxdWlyZSB1cyB0byBsb29rIGluc2lkZSB0aGUgb2lkCiAgICAgICAgLy8g\nb2JqZWN0CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICAvLyB0cnkg\ndG8gc2hvcnRjdXQgaWYgcG9zc2libGUKICAgICAgICAgICAgaWYgKF9vaWQg\nIT0gbnVsbCB8fCBpc0VtYmVkZGVkKCkgfHwgIWlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAvLyBj\naGVjayBlbWJlZGRlZCBmaWVsZHMgb2Ygb2lkIGZvciB2YWx1ZSBzdHJhdGVn\neSArIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIHBrcyA9IGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBudWxs\nOwogICAgICAgICAgICBib29sZWFuIGFzc2lnbiA9IGZhbHNlOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgIWFzc2lnbiAmJiBpIDwgcGtzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldFZhbHVl\nU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChvaWRz\nbSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIG9pZHNtID0gbmV3IE9i\namVjdElkU3RhdGVNYW5hZ2VyKGZldGNoT2JqZWN0RmllbGQoZmllbGQpLAog\nICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBmbWQpOwogICAgICAgICAg\nICAgICAgYXNzaWduID0gb2lkc20uaXNEZWZhdWx0VmFsdWUoaSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFzc2lnbiAmJiBhc3NpZ25P\nYmplY3RJZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGRvbid0IGFzc2lnbiB2YWx1ZXMgdG8gZmllbGRzIHdp\ndGggbm9uLWRlZmF1bHQgdmFsdWVzIGFscmVhZHkKICAgICAgICBpZiAoZm1k\nLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORQog\nICAgICAgICAgICB8fCAhaXNEZWZhdWx0VmFsdWUoZmllbGQpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGZvciBwcmltYXJ5IGtl\neSBmaWVsZHMsIGFzc2lnbiB0aGUgb2JqZWN0IGlkIGFuZCByZWNhY2hlIHNv\nIHRoYXQKICAgICAgICAvLyB0byB0aGUgdXNlciwgc28gaXQgbG9va3MgbGlr\nZSB0aGUgb2lkIGFsd2F5cyBtYXRjaGVzIHRoZSBwayBmaWVsZHMKICAgICAg\nICBpZiAoZm1kLmlzUHJpbWFyeUtleSgpICYmICFpc0VtYmVkZGVkKCkpCiAg\nICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJZCghcHJlRmx1c2hpbmcs\nIHByZUZsdXNoaW5nKTsKCiAgICAgICAgLy8gZm9yIG90aGVyIGZpZWxkcyBq\ndXN0IGFzc2lnbiB0aGUgZmllbGQgb3IgZmx1c2ggaWYgbmVlZGVkCiAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYXNzaWduRmllbGQo\ndGhpcywgZmllbGQsIHByZUZsdXNoaW5nKSkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgaWYgKCFwcmVGbHVzaGluZykKICAgICAgICAgICAg\nX2Jyb2tlci5mbHVzaCgpOwogICAgICAgIHJldHVybiAhcHJlRmx1c2hpbmc7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRMb2NrKCkgewogICAgICAg\nIHJldHVybiBfbG9jazsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMb2Nr\nKE9iamVjdCBsb2NrKSB7CiAgICAgICAgX2xvY2sgPSBsb2NrOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0VmVyc2lvbigpIHsKICAgICAgICByZXR1\ncm4gX3ZlcnNpb247CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VmVyc2lv\nbihPYmplY3QgdmVyc2lvbikgewogICAgICAgIF9sb2FkVmVyc2lvbiA9IHZl\ncnNpb247CiAgICAgICAgYXNzaWduVmVyc2lvbkZpZWxkKHZlcnNpb24pOwog\nICAgfQoKICAgIE9iamVjdCBnZXRMb2FkVmVyc2lvbigpIHsKICAgICAgICBy\nZXR1cm4gX2xvYWRWZXJzaW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndE5leHRWZXJzaW9uKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAgICAgYXNzaWdu\nVmVyc2lvbkZpZWxkKHZlcnNpb24pOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBhc3NpZ25WZXJzaW9uRmllbGQoT2JqZWN0IHZlcnNpb24pIHsKICAgICAg\nICBfdmVyc2lvbiA9IHZlcnNpb247CiAgICAgICAgRmllbGRNZXRhRGF0YSB2\nZmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKICAgICAgICBpZiAo\ndmZpZWxkICE9IG51bGwpCiAgICAgICAgICAgIHN0b3JlKHZmaWVsZC5nZXRJ\nbmRleCgpLCBKYXZhVHlwZXMuY29udmVydCh2ZXJzaW9uLAogICAgICAgICAg\nICAgICAgdmZpZWxkLmdldFR5cGVDb2RlKCkpKTsKICAgIH0KCiAgICBwdWJs\naWMgUENTdGF0ZSBnZXRQQ1N0YXRlKCkgewogICAgICAgIHJldHVybiBfc3Rh\ndGU7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBPYmplY3QgZ2V0\nSW1wbERhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9pbXBsOwogICAgfQoKICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IHNldEltcGxEYXRhKE9iamVj\ndCBkYXRhLCBib29sZWFuIGNhY2hlYWJsZSkgewogICAgICAgIE9iamVjdCBv\nbGQgPSBfaW1wbDsKICAgICAgICBfaW1wbCA9IGRhdGE7CiAgICAgICAgaWYg\nKGNhY2hlYWJsZSAmJiBkYXRhICE9IG51bGwpCiAgICAgICAgICAgIF9mbGFn\ncyB8PSBGTEFHX0lNUExfQ0FDSEU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfSU1QTF9DQUNIRTsKICAgICAgICByZXR1cm4g\nb2xkOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzSW1wbERhdGFDYWNo\nZWFibGUoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0lNUExf\nQ0FDSEUpICE9IDA7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRJbXBs\nRGF0YShpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0RXh0cmFGaWVs\nZERhdGEoZmllbGQsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nc2V0SW1wbERhdGEoaW50IGZpZWxkLCBPYmplY3QgZGF0YSkgewogICAgICAg\nIHJldHVybiBzZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgZGF0YSwgdHJ1ZSk7\nCiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBib29sZWFuIGlzSW1w\nbERhdGFDYWNoZWFibGUoaW50IGZpZWxkKSB7CiAgICAgICAgaWYgKF9maWVs\nZEltcGwgPT0gbnVsbCB8fCAhX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9tZXRhLmdldEZpZWxk\nKGZpZWxkKS51c2VzSW1wbERhdGEoKSAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJh\nRmllbGREYXRhSW5kZXgoZmllbGQpOwogICAgICAgIHJldHVybiBpZHggIT0g\nLTEgJiYgX2ZpZWxkSW1wbFtpZHhdICE9IG51bGw7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBnZXRJbnRlcm1lZGlhdGUoaW50IGZpZWxkKSB7CiAgICAg\nICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZpZWxkLCBmYWxzZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0SW50ZXJtZWRpYXRlKGludCBmaWVs\nZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICBzZXRFeHRyYUZpZWxkRGF0YShm\naWVsZCwgZGF0YSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBkYXRhIGZyb20gdGhlIHByb3BlciBpbmRleCBvZiB0aGUgZXh0\ncmEgZmllbGQgZGF0YSBhcnJheS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5j\naHJvbml6ZWQgT2JqZWN0IGdldEV4dHJhRmllbGREYXRhKGludCBmaWVsZCwg\nYm9vbGVhbiBpc0xvYWRlZCkgewogICAgICAgIC8vIG9ubHkgcmV0dXJuIHRo\nZSBmaWVsZCBkYXRhIGlmIHRoZSBmaWVsZCBpcyBpbiB0aGUgcmlnaHQgbG9h\nZGVkCiAgICAgICAgLy8gc3RhdGU7IG90aGVyd2lzZSB3ZSBtaWdodCByZXR1\ncm4gaW50ZXJtZWRpYXRlIGZvciBpbXBsIGRhdGEgb3IKICAgICAgICAvLyB2\naWNlIHZlcnNhCiAgICAgICAgaWYgKF9maWVsZEltcGwgPT0gbnVsbCB8fCBf\nbG9hZGVkLmdldChmaWVsZCkgIT0gaXNMb2FkZWQpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZp\nZWxkRGF0YUluZGV4KGZpZWxkKTsKICAgICAgICByZXR1cm4gKGlkeCA9PSAt\nMSkgPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBkYXRhIGZyb20gdG8gcHJvcGVyIGluZGV4IG9mIHRo\nZSBleHRyYSBmaWVsZCBkYXRhIGFycmF5LgogICAgICovCiAgICBwcml2YXRl\nIHN5bmNocm9uaXplZCBPYmplY3Qgc2V0RXh0cmFGaWVsZERhdGEoaW50IGZp\nZWxkLCBPYmplY3QgZGF0YSwKICAgICAgICBib29sZWFuIGxvYWRlZCkgewog\nICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxkRGF0YUluZGV4\nKGZpZWxkKTsKICAgICAgICBpZiAoaWR4ID09IC0xKQogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2YoX21l\ndGEuZ2V0RmllbGQoZmllbGQpKSk7CgogICAgICAgIE9iamVjdCBvbGQgPSAo\nX2ZpZWxkSW1wbCA9PSBudWxsKSA/IG51bGwgOiBfZmllbGRJbXBsW2lkeF07\nCiAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBj\nYW5ub3Qgc2V0IGlmIGZpZWxkIGluIHdyb25nIGxvYWRlZCBzdGF0ZQogICAg\nICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpICE9IGxvYWRlZCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJp\nbmcudmFsdWVPZihfbWV0YS5nZXRGaWVsZAogICAgICAgICAgICAgICAgICAg\nIChmaWVsZCkpKTsKCiAgICAgICAgICAgIC8vIHNldCBkYXRhCiAgICAgICAg\nICAgIGlmIChfZmllbGRJbXBsID09IG51bGwpCiAgICAgICAgICAgICAgICBf\nZmllbGRJbXBsID0gbmV3IE9iamVjdFtfbWV0YS5nZXRFeHRyYUZpZWxkRGF0\nYUxlbmd0aCgpXTsKICAgICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gZGF0\nYTsKICAgICAgICB9IGVsc2UgaWYgKF9maWVsZEltcGwgIT0gbnVsbCAmJiBf\nbG9hZGVkLmdldChmaWVsZCkgPT0gbG9hZGVkKQogICAgICAgICAgICBfZmll\nbGRJbXBsW2lkeF0gPSBudWxsOwogICAgICAgIHJldHVybiBvbGQ7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBmZXRjaChpbnQgZmllbGQpIHsKICAgICAg\nICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAg\nICAgIHJldHVybiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nZmV0Y2hGaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gdHJhbnNpdGlvbnMpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1maWVsZCIsCiAg\nICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihmaWVsZCksIGdldE1hbmFn\nZWRJbnN0YW5jZSgpLmdldENsYXNzKCkpKS4KICAgICAgICAgICAgICAgIHNl\ndEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CgogICAgICAg\nIC8vIGRvIG5vcm1hbCBzdGF0ZSB0cmFuc2l0aW9ucwogICAgICAgIGlmICgh\nZm1kLmlzUHJpbWFyeUtleSgpICYmIHRyYW5zaXRpb25zKQogICAgICAgICAg\nICBhY2Nlc3NpbmdGaWVsZChmaWVsZCk7CgogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hT\ndHJpbmdGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9CSkVDVDoKICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaE9iamVjdEZp\nZWxkKGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVB\nTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZmV0Y2hCb29sZWFuRmllbGQo\nZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAgIDog\nQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZShmZXRjaEJ5dGVG\naWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFS\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0ZXIoZmV0Y2hD\naGFyRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoZmV0\nY2hEb3VibGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQo\nZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZh\nbHVlT2YoZmV0Y2hJbnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgcmV0dXJuIE51bWJl\ncnMudmFsdWVPZihmZXRjaExvbmdGaWVsZChmaWVsZCkpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgU2hvcnQoZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hPYmpl\nY3RGaWVsZChmaWVsZCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0b3JlKGludCBmaWVsZCwgT2JqZWN0IHZhbCkgewogICAgICAgIHZh\nbCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKS5nZXRGaWVsZFZhbHVlKHZhbCwg\nX2Jyb2tlcik7CiAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgdmFsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUZpZWxkKGludCBmaWVsZCwgT2Jq\nZWN0IHZhbCkgewogICAgICAgIHN0b3JlRmllbGQoZmllbGQsIHZhbCwgdGhp\ncyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaEluaXRpYWxGaWVs\nZChpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoX2Jyb2tlci5nZXRS\nZXN0b3JlU3RhdGUoKSA9PSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05FCiAg\nICAgICAgICAgICYmICgoX2ZsYWdzICYgRkxBR19JTlZFUlNFUykgPT0gMAog\nICAgICAgICAgICB8fCBmbWQuZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0\naCA9PSAwKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgicmVzdG9yZS11bnNldCIpKTsKCiAgICAgICAg\nc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAvLyBpZiB3\nZSdyZSBub3Qgc2F2aW5nIG11dGFibGUgdHlwZXMsIHRocm93IGFuIGV4Y2Vw\ndGlvbgogICAgICAgICAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0\nYXRlKCkgIT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVfQUxMCiAgICAgICAgICAg\nICAgICAgICAgJiYgKChfZmxhZ3MgJiBGTEFHX0lOVkVSU0VTKSA9PSAwCiAg\nICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldEludmVyc2VNZXRhRGF0YXMo\nKS5sZW5ndGggPT0gMCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAg\nICAgICAgICAgICAoIm11dGFibGUtcmVzdG9yZS11bnNldCIpKTsKICAgICAg\nICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoX3NhdmVkID09IG51bGwgfHwgIV9sb2FkZWQuZ2V0KGZpZWxkKSB8\nfCAhX2RpcnR5LmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwoKICAgICAgICAgICAgLy8gaWYg\ndGhlIGZpZWxkIGlzIGRpcnR5IGJ1dCB3ZSBuZXZlciBsb2FkZWQgaXQsIHdl\nIGNhbid0IHJlc3RvcmUgaXQKICAgICAgICAgICAgaWYgKF9zYXZlZC5nZXRV\nbmxvYWRlZCgpLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbml0aWFsLXVu\nbG9hZGVkIiwKICAgICAgICAgICAgICAgICAgICBmbWQpKTsKCiAgICAgICAg\nICAgIHByb3ZpZGVGaWVsZChfc2F2ZWQuZ2V0U3RhdGUoKSwgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICByZXR1cm4gZmV0Y2hGaWVsZChfc2luZ2xl\nLCBmbWQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZldGNoIHRo\nZSBzcGVjaWZpZWQgZmllbGQgZnJvbSB0aGUgc3BlY2lmaWVkIGZpZWxkIG1h\nbmFnZXIsIHdyYXBwaW5nIGl0CiAgICAgKiBpbiBhbiBvYmplY3QgaWYgaXQn\ncyBhIHByaW1pdGl2ZS4gQSBmaWVsZCBzaG91bGQgYmUgcHJvdmlkZWQgdG8g\ndGhlCiAgICAgKiBmaWVsZCBtYW5hZ2VyIGJlZm9yZSB0aGlzIGNhbGwgaXMg\nbWFkZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGZldGNo\nRmllbGQoRmllbGRNYW5hZ2VyIGZtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewog\nICAgICAgIGludCBmaWVsZCA9IGZtZC5nZXRJbmRleCgpOwogICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0\ndXJuIChmbS5mZXRjaEJvb2xlYW5GaWVsZChmaWVsZCkpID8gQm9vbGVhbi5U\nUlVFCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBCeXRlKGZtLmZldGNoQnl0ZUZpZWxkKGZpZWxkKSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IENoYXJhY3RlcihmbS5mZXRjaENoYXJGaWVsZChmaWVs\nZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShmbS5mZXRjaERvdWJsZUZp\nZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdChmbS5mZXRjaEZs\nb2F0RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihm\nbS5mZXRjaEludEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52\nYWx1ZU9mKGZtLmZldGNoTG9uZ0ZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTaG9ydChmbS5mZXRjaFNob3J0RmllbGQoZmllbGQpKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGZtLmZldGNoU3RyaW5nRmllbGQoZmllbGQpOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZtLmZldGNoT2Jq\nZWN0RmllbGQoZmllbGQpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRSZW1vdGUoaW50IGZpZWxkLCBPYmplY3QgdmFsdWUpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVh\nbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIGZhbHNlKTsK\nICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgdmFsdWUsIF9zaW5nbGUp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBMaWZlY3lj\nbGUgb3BlcmF0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgb2JqZWN0IGlz\nIGFib3V0IHRvIGJlIGFjY2Vzc2VkLgogICAgICoKICAgICAqIEBwYXJhbSBm\naWVsZCB0aGUgZmllbGQgbnVtYmVyIGJlaW5nIHJlYWQsIG9yIC0xIGlmIG5v\ndCBhIHNpbmdsZQogICAgICogZmllbGQgcmVhZAogICAgICovCiAgICB2b2lk\nIGJlZm9yZVJlYWQoaW50IGZpZWxkKSB7CiAgICAgICAgLy8gYWxsb3cgdW5t\nZWRpYXRlZCByZWFkcyBvZiBwcmltYXJ5IGtleSBmaWVsZHMKICAgICAgICBp\nZiAoZmllbGQgIT0gLTEgJiYgX21ldGEuZ2V0RmllbGQoZmllbGQpLmlzUHJp\nbWFyeUtleSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChf\nYnJva2VyLmlzQWN0aXZlKCkgJiYgIV9icm9rZXIuaXNUcmFuc2FjdGlvbkVu\nZGluZygpKSB7CiAgICAgICAgICAgIGlmIChfYnJva2VyLmdldE9wdGltaXN0\naWMoKSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9y\nZU9wdGltaXN0aWNSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZVJl\nYWQodGhpcywgZmllbGQpKTsKICAgICAgICB9IGVsc2UgaWYgKF9icm9rZXIu\nZ2V0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKSkKICAgICAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUuYmVmb3JlTm9udHJhbnNhY3Rpb25hbFJlYWQodGhpcywg\nZmllbGQpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vbi10cmFucy1yZWFk\nIikpLgogICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFn\nZWRJbnN0YW5jZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRl\ncyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBD\nU3RhdGUjYmVmb3JlRmx1c2gKICAgICAqLwogICAgdm9pZCBiZWZvcmVGbHVz\naChpbnQgcmVhc29uLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgX3N0\nYXRlLmJlZm9yZUZsdXNoKHRoaXMsIHJlYXNvbiA9PSBCcm9rZXJJbXBsLkZM\nVVNIX0xPR0lDQUwsIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogRGVs\nZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBz\nZWUgUENTdGF0ZSNmbHVzaAogICAgICovCiAgICB2b2lkIGFmdGVyRmx1c2go\naW50IHJlYXNvbikgewogICAgICAgIC8vIG5vdGhpbmcgaGFwcGVucyB3aGVu\nIHdlIGZsdXNoIG5vbi1wZXJzaXN0ZW50IHN0YXRlcwogICAgICAgIGlmICgh\naXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naWYgKHJlYXNvbiAhPSBCcm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLCiAgICAg\nICAgICAgICYmIHJlYXNvbiAhPSBCcm9rZXJJbXBsLkZMVVNIX0xPR0lDQUwp\nIHsKICAgICAgICAgICAgLy8gYWxsIGRpcnR5IGZpZWxkcyB3ZXJlIGZsdXNo\nZWQKICAgICAgICAgICAgX2ZsdXNoLm9yKF9kaXJ0eSk7CgogICAgICAgICAg\nICAvLyBpbXBvcnRhbnQgdG8gc2V0IGZsdXNoZWQgYml0IGFmdGVyIGNhbGxp\nbmcgX3N0YXRlLmZsdXNoIHNvCiAgICAgICAgICAgIC8vIHRoYXQgdGhlIHN0\nYXRlIGNhbiB0ZWxsIHdoZXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgZmx1c2gK\nICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuZmx1c2godGhpcykpOwog\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19WRVJTSU9OX0NIRUNLOwogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9VUERBVEU7CgogICAgICAgICAgICAv\nLyBpZiB0aGlzIHdhcyBhbiBpbmMgZmx1c2ggZHVyaW5nIHdoaWNoIHdlIGhh\nZCBvdXIgaWRlbnRpdHkKICAgICAgICAgICAgLy8gYXNzaWduZWQsIHRlbGwg\ndGhlIGJyb2tlciB0byBjYWNoZSB1cyB1bmRlciBvdXIgZmluYWwgb2lkCiAg\nICAgICAgICAgIGlmIChyZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9JTkMp\nCiAgICAgICAgICAgICAgICBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKHRydWUp\nOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyBvYmplY3Qgd2FzIHN0b3JlZCB3\naXRoIHByZUZsdXNoLCBkbyBwb3N0LXN0b3JlIGNhbGxiYWNrCiAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVfRkxVU0hFRCkgPiAwKQogICAg\nICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50\nLkFGVEVSX1NUT1JFKTsKICAgICAgICB9IGVsc2UgaWYgKHJlYXNvbiA9PSBC\ncm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLKSB7CiAgICAgICAgICAgIC8vIHJl\ndmVydCB0byBsYXN0IGxvYWRlZCB2ZXJzaW9uIGFuZCBvcmlnaW5hbCBvaWQK\nICAgICAgICAgICAgYXNzaWduVmVyc2lvbkZpZWxkKF9sb2FkVmVyc2lvbik7\nCiAgICAgICAgICAgIGlmIChpc05ldygpICYmIChfZmxhZ3MgJiBGTEFHX09J\nRF9BU1NJR05FRCkgPT0gMCkKICAgICAgICAgICAgICAgIF9vaWQgPSBudWxs\nOwogICAgICAgIH0KICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUFJFX0ZMVVNI\nRUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1\ncnJlbnQgc3RhdGUgYWZ0ZXIgY2hlY2tpbmcgdGhlIHZhbHVlCiAgICAgKiBv\nZiB0aGUgUmV0YWluU3RhdGUgZmxhZy4KICAgICAqCiAgICAgKiBAc2VlIFBD\nU3RhdGUjY29tbWl0CiAgICAgKiBAc2VlIFBDU3RhdGUjY29tbWl0UmV0YWlu\nCiAgICAgKi8KICAgIHZvaWQgY29tbWl0KCkgewogICAgICAgIC8vIHJlbGVh\nc2UgbG9ja3MgYmVmb3JlIG9pZCB1cGRhdGVkCiAgICAgICAgcmVsZWFzZUxv\nY2tzKCk7CgogICAgICAgIC8vIHVwZGF0ZSB2ZXJzaW9uIGFuZCBvaWQgaW5m\nb3JtYXRpb24KICAgICAgICBzZXRWZXJzaW9uKF92ZXJzaW9uKTsKICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgT2JqZWN0IG9yaWcgPSBf\naWQ7CiAgICAgICAgYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZChmYWxzZSk7Cgog\nICAgICAgIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKSAmJiAhaXNEZWxldGVk\nKCkgJiYgIWlzUHJvdmlzaW9uYWwoKTsKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRSZXRhaW5TdGF0ZSgpKQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0\nZS5jb21taXRSZXRhaW4odGhpcykpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc2V0UENTdGF0ZShfc3RhdGUuY29tbWl0KHRoaXMpKTsKCiAgICAgICAg\nLy8gYXNrIHRoZSBicm9rZXIgdG8gcmUtY2FjaGUgdXMgaWYgd2Ugd2VyZSBu\nZXcgcHJldmlvdXNseQogICAgICAgIGlmICh3YXNOZXcpCiAgICAgICAgICAg\nIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKG9yaWcsIHRoaXMsIEJyb2tlcklt\ncGwuU1RBVFVTX0NPTU1JVF9ORVcpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVyIGNoZWNraW5n\nIHRoZSB2YWx1ZQogICAgICogb2YgdGhlIFJldGFpblN0YXRlIGZsYWcuCiAg\nICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3JvbGxiYWNrCiAgICAgKiBAc2Vl\nIFBDU3RhdGUjcm9sbGJhY2tSZXN0b3JlCiAgICAgKi8KICAgIHZvaWQgcm9s\nbGJhY2soKSB7CiAgICAgICAgLy8gcmVsZWFzZSBsb2NrcwogICAgICAgIHJl\nbGVhc2VMb2NrcygpOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVE\nOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEX0RJUlRZOwogICAg\nICAgIGFmdGVyRmx1c2goQnJva2VySW1wbC5GTFVTSF9ST0xMQkFDSyk7Cgog\nICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3Rv\ncmVTdGF0ZS5SRVNUT1JFX05PTkUpCiAgICAgICAgICAgIHNldFBDU3RhdGUo\nX3N0YXRlLnJvbGxiYWNrUmVzdG9yZSh0aGlzKSk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFjayh0aGlzKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSb2xsYmFjayBzdGF0ZSBvZiB0aGUg\nbWFuYWdlZCBpbnN0YW5jZSB0byB0aGUgZ2l2ZW4gc2F2ZXBvaW50LgogICAg\nICovCiAgICB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoU2F2ZXBvaW50Rmll\nbGRNYW5hZ2VyIHNhdmVwb2ludCkgewogICAgICAgIF9zdGF0ZSA9IHNhdmVw\nb2ludC5nZXRQQ1N0YXRlKCk7CiAgICAgICAgQml0U2V0IGxvYWRlZCA9IHNh\ndmVwb2ludC5nZXRMb2FkZWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMCwg\nbGVuID0gbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKGxvYWRlZC5nZXQoaSkgJiYgc2F2ZXBvaW50LnJlc3RvcmVG\naWVsZChpKSkgewogICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKHNhdmVw\nb2ludC5nZXRDb3B5KCksIHNhdmVwb2ludCwgaSk7CiAgICAgICAgICAgICAg\nICByZXBsYWNlRmllbGQoX3BjLCBzYXZlcG9pbnQsIGkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIF9sb2FkZWQgPSBsb2FkZWQ7CiAgICAg\nICAgX2RpcnR5ID0gc2F2ZXBvaW50LmdldERpcnR5KCk7CiAgICAgICAgX2Zs\ndXNoID0gc2F2ZXBvaW50LmdldEZsdXNoZWQoKTsKICAgICAgICBfdmVyc2lv\nbiA9IHNhdmVwb2ludC5nZXRWZXJzaW9uKCk7CiAgICAgICAgX2xvYWRWZXJz\naW9uID0gc2F2ZXBvaW50LmdldExvYWRWZXJzaW9uKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAg\nICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3BlcnNpc3QKICAgICAqIEBzZWUg\nQnJva2VyI3BlcnNpc3QKICAgICAqLwogICAgdm9pZCBwZXJzaXN0KCkgewog\nICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnBlcnNpc3QodGhpcykpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0\nYXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNkZWxldGUKICAgICAq\nIEBzZWUgQnJva2VyI2RlbGV0ZQogICAgICovCiAgICB2b2lkIGRlbGV0ZSgp\nIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5kZWxldGUodGhpcykpOwog\nICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50\nIHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNub250cmFuc2Fj\ndGlvbmFsCiAgICAgKiBAc2VlIEJyb2tlciNub250cmFuc2FjdGlvbmFsCiAg\nICAgKi8KICAgIHZvaWQgbm9udHJhbnNhY3Rpb25hbCgpIHsKICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5ub250cmFuc2FjdGlvbmFsKHRoaXMpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBz\ndGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjdHJhbnNhY3Rpb25h\nbAogICAgICogQHNlZSBCcm9rZXIjdHJhbnNhY3Rpb25hbAogICAgICovCiAg\nICB2b2lkIHRyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgc2V0UENTdGF0ZShf\nc3RhdGUudHJhbnNhY3Rpb25hbCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgog\nICAgICogQHNlZSBQQ1N0YXRlI25vbnByb3Zpc2lvbmFsCiAgICAgKi8KICAg\nIHZvaWQgbm9ucHJvdmlzaW9uYWwoYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUubm9ucHJv\ndmlzaW9uYWwodGhpcywgbG9naWNhbCwgY2FsbCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAg\nICoKICAgICAqIEBzZWUgUENTdGF0ZSNyZWxlYXNlCiAgICAgKiBAc2VlIEJy\nb2tlciNyZWxlYXNlCiAgICAgKi8KICAgIHZvaWQgcmVsZWFzZShib29sZWFu\nIHVucHJveHkpIHsKICAgICAgICByZWxlYXNlKHVucHJveHksIGZhbHNlKTsK\nICAgIH0KCiAgICB2b2lkIHJlbGVhc2UoYm9vbGVhbiB1bnByb3h5LCBib29s\nZWFuIGZvcmNlKSB7CiAgICAgICAgLy8gb3B0aW1pemF0aW9uIGZvciBkZXRh\nY2gtaW4tcGxhY2Ugc3BlY2lhbCBjYXNlIHdoZW4gZmllbGRzIGFyZQogICAg\nICAgIC8vIGFscmVhZHkgKHVuKXByb3hpZWQgY29ycmVjdGx5CiAgICAgICAg\naWYgKCF1bnByb3h5KQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19OT19V\nTlBST1hZOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChmb3JjZSkK\nICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoUENTdGF0ZS5UUkFOU0lFTlQp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5yZWxlYXNlKHRoaXMpKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfTk9fVU5QUk9YWTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1\ncnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2V2aWN0\nCiAgICAgKiBAc2VlIEJyb2tlciNldmljdAogICAgICovCiAgICB2b2lkIGV2\naWN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmV2aWN0KHRoaXMp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlciByZWxhdGlvbnMgcmVh\nY2hhYmxlIGZyb20gdmFsdWVzIHVzaW5nCiAgICAgKiB7QGxpbmsgVmFsdWVN\nZXRhRGF0YSNDQVNDQURFX0lNTUVESUFURX0uCiAgICAgKi8KICAgIHZvaWQg\nZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdl\ndENhc2NhZGVSZWZyZXNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lN\nTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRLZXkoKS5n\nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBm\nbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAg\nICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRF\nKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQo\naSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgX3Np\nbmdsZS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBiZWZvcmVSZWZyZXNoKGJvb2xl\nYW4gcmVmcmVzaEFsbCkgewogICAgICAgIC8vIG5vdGU6IGFsbCBsb2dpYyBw\nbGFjZWQgaGVyZSByYXRoZXIgdGhhbiBpbiB0aGUgc3RhdGVzIGZvcgogICAg\nICAgIC8vIG9wdGltaXphdGlvbjsgdGhpcyBtZXRob2QgcHVibGljIGIvYyB1\nc2VkIGJ5IHJlbW90ZSBwYWNrYWdlCgogICAgICAgIC8vIG5vdGhpbmcgdG8g\nZG8gZm9yIG5vbiBwZXJzaXN0ZW50IG9yIG5ldyB1bmZsdXNoZWQgaW5zdGFu\nY2VzCiAgICAgICAgaWYgKCFpc1BlcnNpc3RlbnQoKSB8fCAoaXNOZXcoKSAm\nJiAhaXNGbHVzaGVkKCkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBp\nZiBkaXJ0eSBuZWVkIHRvIGNsZWFyIGZpZWxkcwogICAgICAgICAgICBpZiAo\naXNEaXJ0eSgpKSB7CiAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIGlmIHNvbWUgZmllbGRzIGhhdmUgYmVlbiBsb2FkZWQg\nYnV0IHRoZSBpbnN0YW5jZSBpcyBvdXQgb2YKICAgICAgICAgICAgLy8gZGF0\nZSBvciB0aGlzIGlzIHBhcnQgb2YgYSByZWZyZXNoQWxsKCkgYW5kIHdlIGRv\nbid0IHdhbnQgdG8KICAgICAgICAgICAgLy8gdGFrZSB0aGUgZXh0cmEgaGl0\nIHRvIHNlZSBpZiB0aGUgaW5zdGFuY2UgaXMgb3V0IG9mIGRhdGUsIGNsZWFy\nCiAgICAgICAgICAgIGlmIChfbG9hZGVkLmxlbmd0aCgpID4gMCAmJiAocmVm\ncmVzaEFsbCB8fCBpc0VtYmVkZGVkKCkKICAgICAgICAgICAgICAgIHx8ICFz\neW5jVmVyc2lvbihudWxsKSkpIHsKICAgICAgICAgICAgICAgIE9iamVjdCB2\nZXJzaW9uID0gX3ZlcnNpb247CiAgICAgICAgICAgICAgICBjbGVhckZpZWxk\ncygpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHN5bmNWZXJzaW9uIGp1c3Qg\ncmVwbGFjZWQgdGhlIHZlcnNpb24sIHJlc2V0IGl0CiAgICAgICAgICAgICAg\nICBpZiAoIXJlZnJlc2hBbGwgJiYgIWlzRW1iZWRkZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBzZXRWZXJzaW9uKHZlcnNpb24pOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZv\ncm0gc3RhdGUgdHJhbnNpdGlvbnMgYWZ0ZXIgcmVmcmVzaC4gVGhpcyBtZXRo\nb2QgaXMgb25seQogICAgICogY2FsbGVkIGlmIHtAbGluayAjYmVmb3JlUmVm\ncmVzaH0gcmV0dXJucyB0cnVlLgogICAgICovCiAgICB2b2lkIGFmdGVyUmVm\ncmVzaCgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gdHJhbnNpdGlvbiB0byBjbGVhbiBvciBub250cmFuc2FjdGlv\nbmFsIGRlcGVuZGluZyBvbiB0cmFucyBzdGF0dXMKICAgICAgICAgICAgaWYg\nKCFfYnJva2VyLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBzZXRQQ1N0\nYXRlKF9zdGF0ZS5hZnRlck5vbnRyYW5zYWN0aW9uYWxSZWZyZXNoKCkpOwog\nICAgICAgICAgICBlbHNlIGlmIChfYnJva2VyLmdldE9wdGltaXN0aWMoKSkK\nICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVyT3B0aW1p\nc3RpY1JlZnJlc2goKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVyUmVmcmVzaCgpKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoaXMgb2JqZWN0IGFzIGEg\nZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmplY3QuCiAgICAgKi8KICAgIHZv\naWQgc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KGJvb2xlYW4gZGVyZWYsIGJv\nb2xlYW4gbm90aWZ5KSB7CiAgICAgICAgaWYgKCFkZXJlZiAmJiAoX2ZsYWdz\nICYgRkxBR19ERVJFRikgPiAwKSB7CiAgICAgICAgICAgIGlmIChub3RpZnkp\nCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZURlcmVmZXJlbmNlZERl\ncGVuZGVudCh0aGlzKTsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0RF\nUkVGOwogICAgICAgIH0gZWxzZSBpZiAoZGVyZWYgJiYgKF9mbGFncyAmIEZM\nQUdfREVSRUYpID09IDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nREVSRUY7CiAgICAgICAgICAgIGlmIChub3RpZnkpCiAgICAgICAgICAgICAg\nICBfYnJva2VyLmFkZERlcmVmZXJlbmNlZERlcGVuZGVudCh0aGlzKTsKICAg\nICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIExvY2tpbmcK\nICAgIC8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24g\ndGhhdCB3ZSd2ZSBiZWVuIHJlYWQtbG9ja2VkLiBQYXNzIGluIHRoZSBsZXZl\nbCBhdCB3aGljaAogICAgICogd2Ugd2VyZSBsb2NrZWQgYW5kIHRoZSBsZXZl\nbCBhdCB3aGljaCB3ZSBzaG91bGQgd3JpdGUgbG9jayBvdXJzZWx2ZXMKICAg\nICAqIG9uIGRpcnR5LgogICAgICovCiAgICB2b2lkIHJlYWRMb2NrZWQoaW50\nIHJlYWRMb2NrTGV2ZWwsIGludCB3cml0ZUxvY2tMZXZlbCkgewogICAgICAg\nIC8vIG1ha2Ugc3VyZSBvYmplY3QgaXMgYWRkZWQgdG8gdHJhbnNhY3Rpb24g\nc28gbG9jayB3aWxsIGdldAogICAgICAgIC8vIGNsZWFyZWQgb24gY29tbWl0\nL3JvbGxiYWNrCiAgICAgICAgaWYgKHJlYWRMb2NrTGV2ZWwgIT0gTG9ja0xl\ndmVscy5MT0NLX05PTkUpCiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwoKTsK\nCiAgICAgICAgX3JlYWRMb2NrTGV2ZWwgPSByZWFkTG9ja0xldmVsOwogICAg\nICAgIF93cml0ZUxvY2tMZXZlbCA9IHdyaXRlTG9ja0xldmVsOwogICAgICAg\nIF9mbGFncyB8PSBGTEFHX1JFQURfTE9DS0VEOwogICAgICAgIF9mbGFncyAm\nPSB+RkxBR19XUklURV9MT0NLRUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGxvY2sgbGV2ZWwgdG8gdXNlIHdoZW4gbG9hZGluZyBzdGF0\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgY2FsY3VsYXRlTG9ja0xldmVs\nKGJvb2xlYW4gYWN0aXZlLCBib29sZWFuIGZvcldyaXRlLAogICAgICAgIEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmICghYWN0aXZl\nKQogICAgICAgICAgICByZXR1cm4gTG9ja0xldmVscy5MT0NLX05PTkU7CiAg\nICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0g\nX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKCiAgICAgICAgaWYg\nKF9yZWFkTG9ja0xldmVsID09IC0xKQogICAgICAgICAgICBfcmVhZExvY2tM\nZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICBpZiAo\nX3dyaXRlTG9ja0xldmVsID09IC0xKQogICAgICAgICAgICBfd3JpdGVMb2Nr\nTGV2ZWwgPSBmZXRjaC5nZXRXcml0ZUxvY2tMZXZlbCgpOwogICAgICAgIHJl\ndHVybiAoZm9yV3JpdGUpID8gX3dyaXRlTG9ja0xldmVsIDogX3JlYWRMb2Nr\nTGV2ZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgd2UncmUg\nbG9ja2VkIGF0IHRoZSBnaXZlbiBsZXZlbC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIG9idGFpbkxvY2tzKGJvb2xlYW4gYWN0aXZlLCBib29sZWFuIGZv\ncldyaXRlLCBpbnQgbG9ja0xldmVsLAogICAgICAgIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgT2JqZWN0IHNkYXRhKSB7CiAgICAgICAgaWYgKCFhY3Rp\ndmUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgd2UgaGF2\nZW4ndCBiZWVuIGxvY2tlZCB5ZXQsIGxvY2sgbm93IGF0IHRoZSBnaXZlbiBs\nZXZlbAogICAgICAgIGludCBmbGFnID0gKGZvcldyaXRlKSA/IEZMQUdfV1JJ\nVEVfTE9DS0VEIDogRkxBR19SRUFEX0xPQ0tFRDsKICAgICAgICBpZiAoKF9m\nbGFncyAmIGZsYWcpID09IDApIHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIG9iamVjdCBpcyBhZGRlZCB0byB0cmFuc2FjdGlvbiBzbyBsb2NrIHdpbGwg\nZ2V0CiAgICAgICAgICAgIC8vIGNsZWFyZWQgb24gY29tbWl0L3JvbGxiYWNr\nCiAgICAgICAgICAgIGlmIChsb2NrTGV2ZWwgIT0gTG9ja0xldmVscy5MT0NL\nX05PTkUpCiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbmFsKCk7CgogICAg\nICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZl\ndGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICAgICAgX2Jyb2tlci5nZXRMb2NrTWFuYWdlcigpLmxvY2sodGhpcywgbG9j\na0xldmVsLAogICAgICAgICAgICAgICAgZmV0Y2guZ2V0TG9ja1RpbWVvdXQo\nKSwgc2RhdGEpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRUFEX0xP\nQ0tFRDsKICAgICAgICAgICAgX2ZsYWdzIHw9IGZsYWc7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBsb2Nrcy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VMb2NrcygpIHsKICAgICAgICBpZiAo\nX2xvY2sgIT0gbnVsbCkKICAgICAgICAgICAgX2Jyb2tlci5nZXRMb2NrTWFu\nYWdlcigpLnJlbGVhc2UodGhpcyk7CiAgICAgICAgX3JlYWRMb2NrTGV2ZWwg\nPSAtMTsKICAgICAgICBfd3JpdGVMb2NrTGV2ZWwgPSAtMTsKICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX1dSSVRFX0xPQ0tFRDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW1wbGVt\nZW50YXRpb24gb2YgU3RhdGVNYW5hZ2VyIGludGVyZmFjZQogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgYm9vbGVhbiBzZXJpYWxpemluZygpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX21ldGEuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gRGV0YWNoTWFuYWdlci5wcmVTZXJpYWxpemUodGhp\ncyk7CgogICAgICAgICAgICBsb2FkKF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCksIExPQURfU0VSSUFMSVpFLCBudWxsLCBudWxsLCAKICAgICAg\nICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gd3JpdGVEZXRhY2hlZChPYmplY3RPdXRwdXQg\nb3V0KQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQml0\nU2V0IGlkeHMgPSBuZXcgQml0U2V0KF9tZXRhLmdldEZpZWxkcygpLmxlbmd0\naCk7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGJvb2xlYW4gZGV0c20gPSBEZXRhY2hNYW5hZ2VyLndyaXRlRGV0YWNoZWRT\ndGF0ZSh0aGlzLCBvdXQsIGlkeHMpOwogICAgICAgICAgICBpZiAoZGV0c20p\nCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19ERVRBQ0hJTkc7Cgog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZp\nZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmlz\nVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsK\nICAgICAgICAgICAgICAgIF9zaW5nbGUuc2VyaWFsaXplKG91dCwgIWlkeHMu\nZ2V0KGkpKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX0RFVEFDSElORzsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBy\nb3h5RGV0YWNoZWREZXNlcmlhbGl6ZWQoaW50IGlkeCkgewogICAgICAgIC8v\nIHdlIGRvbid0IHNlcmlhbGl6ZSBzdGF0ZSBtYW5hZ2VyIGltcGxzCiAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNUcmFuc2FjdGlvbmFsKCkgewogICAgICAgIC8v\nIHNwZWNpYWwgY2FzZSBmb3IgVENMRUFOLCB3aGljaCB3ZSB3YW50IHRvIGFw\ncGVhciBub24tdHJhbnMgdG8KICAgICAgICAvLyBpbnRlcm5hbCBjb2RlLCBi\ndXQgd2hpY2ggcHVibGljbHkgc2hvdWxkIGJlIHRyYW5zYWN0aW9uYWwKICAg\nICAgICByZXR1cm4gX3N0YXRlID09IFBDU3RhdGUuVENMRUFOIHx8IF9zdGF0\nZS5pc1RyYW5zYWN0aW9uYWwoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCkgewogICAgICAgIHJldHVybiBf\nc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzUHJvdmlzaW9uYWwoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdGF0ZS5pc1Byb3Zpc2lvbmFsKCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNQZXJzaXN0ZW50KCkgewogICAgICAgIHJldHVybiBfc3RhdGUu\naXNQZXJzaXN0ZW50KCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNO\nZXcoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc05ldygpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzRGVsZXRlZCgpIHsKICAgICAgICByZXR1\ncm4gX3N0YXRlLmlzRGVsZXRlZCgpOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzRGlydHkoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc0RpcnR5\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hlZCgpIHsK\nICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfREVUQUNISU5HKSAhPSAw\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0R2VuZXJpY0NvbnRleHQo\nKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXI7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBmZXRjaE9iamVjdElkKCkgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2lnbk9iamVjdElkKHRydWUpOwogICAgICAgICAgICBpZiAo\nX29pZCA9PSBudWxsIHx8ICFfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4K\nICAgICAgICAgICAgICAgIGdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdl\ndENvcHlPYmplY3RJZHMoKSkKICAgICAgICAgICAgICAgIHJldHVybiBfb2lk\nOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKQogICAgICAgICAgICAgICAg\ncmV0dXJuIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuY29weURhdGFTdG9y\nZUlkKF9vaWQsIF9tZXRhKTsKICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0\naW9uSWRzLmNvcHkoX29pZCwgX21ldGEpOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNs\nYXRlKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBn\nZXRQQ1ByaW1hcnlLZXkoT2JqZWN0IG9pZCwgaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgT2JqZWN0IHBrID0gQXBwbGljYXRpb25JZHMuZ2V0KG9pZCwg\nZm1kKTsKICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgcmVsbWV0YSA9IGZt\nZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGlmIChyZWxt\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFU\nQVNUT1JFCiAgICAgICAgICAgICYmIGZtZC5nZXRPYmplY3RJZEZpZWxkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuTE9ORykKICAgICAgICAgICAgcGsgPSBf\nYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLm5ld0RhdGFTdG9yZUlkKHBrLCBy\nZWxtZXRhKTsKICAgICAgICBlbHNlIGlmIChyZWxtZXRhLmdldElkZW50aXR5\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04gCiAgICAg\nICAgICAgICYmIGZtZC5nZXRPYmplY3RJZEZpZWxkVHlwZSgpICE9IHJlbG1l\ndGEuZ2V0T2JqZWN0SWRUeXBlKCkpCiAgICAgICAgICAgIHBrID0gQXBwbGlj\nYXRpb25JZHMuZnJvbVBLVmFsdWVzKG5ldyBPYmplY3RbXSB7IHBrIH0sIHJl\nbG1ldGEpOwogICAgICAgIHJldHVybiBfYnJva2VyLmZpbmQocGssIGZhbHNl\nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0ZSByZXBsYWNlRmxhZ3Mo\nKSB7CiAgICAgICAgLy8gd2UgYWx3YXlzIHVzZSBsb2FkIHJlcXVpcmVkIHNv\nIHRoYXQgd2UgY2FuIGRldGVjdCB3aGVuIG9iamVjdHMKICAgICAgICAvLyBh\ncmUgdG91Y2hlZCBmb3IgbG9ja2luZyBvciBtYWtpbmcgdHJhbnNhY3Rpb25h\nbAogICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZUNhcGFibGUuTE9BRF9SRVFV\nSVJFRDsKICAgIH0KCiAgICBwdWJsaWMgU3RhdGVNYW5hZ2VyIHJlcGxhY2VT\ndGF0ZU1hbmFnZXIoU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgcmV0dXJu\nIHNtOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFjY2Vzc2luZ0ZpZWxkKGlu\ndCBmaWVsZCkgewogICAgICAgIC8vIHBvc3NpYmx5IGNoYW5nZSBzdGF0ZQog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJlZm9yZVJlYWQoZmllbGQpOwog\nICAgICAgICAgICBiZWZvcmVBY2Nlc3NGaWVsZChmaWVsZCk7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkIGJlZm9yZSBhY2Nlc3MuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGJlZm9yZUFjY2Vzc0ZpZWxkKGlu\ndCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsK\nICAgICAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNhbGN1bGF0ZUxvY2tMZXZl\nbChhY3RpdmUsIGZhbHNlLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmll\nbGQsIGxvY2tMZXZlbCwgZmFsc2UsIHRydWUpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBhc3NpZ25GaWVsZChmaWVsZCwgZmFsc2UpOwog\nICAgICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUsIGZhbHNlLCBsb2NrTGV2\nZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGlydHkoU3RyaW5nIGZp\nZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGUobmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWZpZWxkIiwgZmllbGQsCiAgICAgICAgICAgICAgICBfcGMuZ2V0\nQ2xhc3MoKSkpLnNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSkpOwoKICAgICAgICBkaXJ0eShmbWQuZ2V0SW5kZXgoKSwgbnVsbCwgdHJ1\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZGlydHkoaW50IGZpZWxkKSB7\nCiAgICAgICAgZGlydHkoZmllbGQsIG51bGwsIHRydWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gZmllbGQgZGlydHkuCiAgICAg\nKgogICAgICogQHBhcmFtIG11dGF0ZSBpZiBudWxsLCBtYXkgYmUgYW4gU0NP\nIG11dGF0aW9uOyBpZiB0cnVlLCBpcyBjZXJ0YWlubHkKICAgICAqIGEgbXV0\nYXRpb24gKG9yIGF0IGxlYXN0IHRyZWF0IGFzIG9uZSkKICAgICAqIEByZXR1\ncm4ge0BsaW5rIEJvb2xlYW4jRkFMU0V9IGlmIHRoaXMgaW5zdGFuY2Ugd2Fz\nIGFscmVhZHkgZGlydHksCiAgICAgKiA8Y29kZT5udWxsPC9jb2RlPiBpZiBp\ndCB3YXMgZGlydHkgYnV0IG5vdCBzaW5jZSBmbHVzaCwgYW5kCiAgICAgKiB7\nQGxpbmsgQm9vbGVhbiNUUlVFfSBpZiBpdCB3YXMgbm90IGRpcnR5CiAgICAg\nKi8KICAgIHByaXZhdGUgQm9vbGVhbiBkaXJ0eShpbnQgZmllbGQsIEJvb2xl\nYW4gbXV0YXRlLCBib29sZWFuIGxvYWRGZXRjaEdyb3VwKSB7CiAgICAgICAg\nYm9vbGVhbiBsb2NrZWQgPSBmYWxzZTsKICAgICAgICBib29sZWFuIG5ld0Zs\ndXNoID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBjbGVhbiA9IGZhbHNlOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICBpZiAoIWlzTmV3\nKCkgfHwgaXNGbHVzaGVkKCkpIHsKICAgICAgICAgICAgICAgIGlmIChmbWQu\nZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRhdGVTdHJhdGVnaWVzLlJFU1RS\nSUNUKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAg\nKCJ1cGRhdGUtcmVzdHJpY3QiLCBmbWQpKTsKICAgICAgICAgICAgICAgIGlm\nIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRhdGVTdHJhdGVnaWVz\nLklHTk9SRSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5G\nQUxTRTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzRW1iZWRk\nZWQoKSkgewogICAgICAgICAgICAgICAgLy8gbm90aWZ5IG93bmVyIG9mIGNo\nYW5nZQogICAgICAgICAgICAgICAgX293bmVyLmRpcnR5KF9vd25lck1ldGEu\nZ2V0RmllbGRNZXRhRGF0YSgpLmdldEluZGV4KCksCiAgICAgICAgICAgICAg\nICAgICAgQm9vbGVhbi5UUlVFLCBsb2FkRmV0Y2hHcm91cCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGlzIHRoaXMgYSBkaXJlY3QgbXV0YXRp\nb24gb2YgYW4gc2NvIGZpZWxkPwogICAgICAgICAgICBpZiAobXV0YXRlID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FM\nRU5EQVI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JK\nRUNUOgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFu\nLlRSVUU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAg\nICAgICAgICAgICBtdXRhdGUgPQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKGZtZC5pc0VtYmVkZGVkKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAg\nICAgbXV0YXRlID0gQm9vbGVhbi5GQUxTRTsgLy8gbm90IHNjbwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBwb3Nz\naWJseSBjaGFuZ2Ugc3RhdGUKICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUg\nPSBfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgICAgIGNsZWFuID0gIV9z\ndGF0ZS5pc0RpcnR5KCk7IC8vIGludGVudGlvbmFsIGRpcmVjdCBhY2Nlc3MK\nCiAgICAgICAgICAgIC8vIGZpcmUgZXZlbnQgZmFzdCBiZWZvcmUgc3RhdGUg\nY2hhbmdlLgogICAgICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJ\nUlRZKTsKICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAgICAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAg\nICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU9wdGltaXN0aWNXcml0\nZSh0aGlzLCBmaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRl\nLmJvb2xlYW5WYWx1ZSgpKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlV3JpdGUo\ndGhpcywgZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZS5i\nb29sZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZtZC5n\nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkgewogICAgICAgICAgICAgICAgaWYgKGlzUGVyc2lzdGVudCgpICYm\nICFfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJub24tdHJhbnMt\nd3JpdGUiKSkuc2V0RmFpbGVkT2JqZWN0CiAgICAgICAgICAgICAgICAgICAg\nICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgICAgICAgICAg\nc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlTm9udHJhbnNhY3Rpb25hbFdyaXRl\nKHRoaXMsIGZpZWxkLAogICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29s\nZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCkgewogICAgICAgICAgICAg\nICAgbmV3Rmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZKSA9\nPSAwOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRF9E\nSVJUWTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jaygpOwogICAg\nICAgICAgICBsb2NrZWQgPSB0cnVlOwoKICAgICAgICAgICAgLy8gbm90ZSB0\naGF0IHRoZSBmaWVsZCBpcyBpbiBuZWVkIG9mIGZsdXNoaW5nIGFnYWluLCBh\nbmQgdGVsbCB0aGUKICAgICAgICAgICAgLy8gYnJva2VyIHRvbwogICAgICAg\nICAgICBfZmx1c2guY2xlYXIoZmllbGQpOwogICAgICAgICAgICBfYnJva2Vy\nLnNldERpcnR5KHRoaXMsIG5ld0ZsdXNoICYmICFjbGVhbik7CgogICAgICAg\nICAgICAvLyBzYXZlIHRoZSBmaWVsZCBmb3Igcm9sbGJhY2sgaWYgbmVlZGVk\nCiAgICAgICAgICAgIHNhdmVGaWVsZChmaWVsZCk7CgogICAgICAgICAgICAv\nLyBkaXJ0eSB0aGUgZmllbGQgYW5kIG1hcmsgbG9hZGVkOyBsb2FkIGZldGNo\nIGdyb3VwIGlmIG5lZWRlZAogICAgICAgICAgICBpbnQgbG9ja0xldmVsID0g\nY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgdHJ1ZSwgbnVsbCk7CiAgICAg\nICAgICAgIGlmICghX2RpcnR5LmdldChmaWVsZCkpIHsKICAgICAgICAgICAg\nICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBf\nZGlydHkuc2V0KGZpZWxkKTsKCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIGZpZWxkJ3MgZmV0Y2ggZ3JvdXAgaXMgbG9hZGVkCiAgICAgICAg\nICAgICAgICBpZiAobG9hZEZldGNoR3JvdXAgJiYgaXNQZXJzaXN0ZW50KCkK\nICAgICAgICAgICAgICAgICAgICAmJiBmbWQuZ2V0TWFuYWdlbWVudCgpID09\nIGZtZC5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBs\nb2FkRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgdHJ1ZSwgdHJ1ZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCB0cnVl\nLCBsb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNs\nYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nbG9ja2VkKQogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoK\nICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgIHJldHVybiBCb29sZWFu\nLlRSVUU7CiAgICAgICAgaWYgKG5ld0ZsdXNoKSB7CiAgICAgICAgICAgIC8v\nIHRoaXMgZXZlbnQgY2FuIGJlIGZpcmVkIGxhdGVyIGNhdXNlIHdlJ3JlIGFs\ncmVhZHkgZGlydHkuCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChM\naWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFlfRkxVU0hFRCk7CiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9v\nbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgcG9zdC1k\naXJ0eSBldmVudHMgYWZ0ZXIgZmllbGQgdmFsdWUgY2hhbmdlcy4KICAgICAq\nCiAgICAgKiBAcGFyYW0gc3RhdHVzIHJldHVybiB2YWx1ZSBmcm9tIHtAbGlu\nayAjZGlydHkoaW50LGJvb2xlYW4sYm9vbGVhbil9CiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwb3N0RGlydHkoQm9vbGVhbiBzdGF0dXMpIHsKICAgICAg\nICBpZiAoQm9vbGVhbi5UUlVFLmVxdWFscyhzdGF0dXMpKQogICAgICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfRElS\nVFkpOwogICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBudWxsKQogICAgICAg\nICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJf\nRElSVFlfRkxVU0hFRCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3Zl\nZChpbnQgZmllbGQsIE9iamVjdCByZW1vdmVkLCBib29sZWFuIGtleSkgewog\nICAgICAgIGlmIChyZW1vdmVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gZGVyZWZlcmVuY2Ug\nZGVwZW5kZW50IGZpZWxkcywgZGVsZXRlIGVtYmVkZGVkCiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCA9IChrZXkpID8gZm1kLmdl\ndEtleSgpIDogZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICAgICAgaWYgKHZt\nZC5pc0VtYmVkZGVkUEMoKSkKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVs\nZXRlKHZtZCwgcmVtb3ZlZCwgbnVsbCk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKHZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0FVVE8pCiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlcmVmZXJlbmNl\nRGVwZW5kZW50KHJlbW92ZWQpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdQcm94\neShpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVy\nbmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gbmV3RmllbGRQcm94eShm\naWVsZCk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldFR5cGVDb2RlKCkpIHsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAg\nICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gamF2YS5zcWwuRGF0\nZS5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGphdmEu\nc3FsLkRhdGUoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpOwogICAgICAg\nICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNx\nbC5UaW1lc3RhbXAuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBqYXZhLnNxbC5UaW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkpOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSA9PSBqYXZhLnNxbC5UaW1lLmNsYXNzKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgamF2YS5zcWwuVGltZShTeXN0ZW0uY3VycmVudFRp\nbWVNaWxsaXMoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUo\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAg\nICAgICAgICAgICByZXR1cm4gQ2FsZW5kYXIuZ2V0SW5zdGFuY2UoKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nSGFzaE1hcCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld0ZpZWxkUHJveHkoaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgUHJveHlNYW5hZ2VyIG1nciA9IF9icm9rZXIu\nZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRQcm94eU1hbmFn\nZXJJbnN0YW5jZSgpOwogICAgICAgIE9iamVjdCBpbml0ID0gZm1kLmdldElu\naXRpYWxpemVyKCk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRF\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdEYXRlUHJveHkoZm1k\nLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0Nh\nbGVuZGFyUHJveHkoZm1kLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgICAgIGluaXQgaW5zdGFuY2VvZiBUaW1lWm9uZSA/IChUaW1lWm9u\nZSkgaW5pdCA6IG51bGwpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdDb2xs\nZWN0aW9uUHJveHkoZm1kLmdldFByb3h5VHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAg\nICAgICAgICAgICAgICAgICAgaW5pdCBpbnN0YW5jZW9mIENvbXBhcmF0b3Ig\nPyAoQ29tcGFyYXRvcikgaW5pdCA6IG51bGwpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5l\nd01hcFByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAg\nICAgICBmbWQuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFy\nYXRvciA/IChDb21wYXJhdG9yKSBpbml0IDogbnVsbCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzRGVmYXVsdFZhbHVlKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAg\nICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgYm9vbGVhbiByZXQgPSBfc2luZ2xlLmlzRGVmYXVsdFZh\nbHVlKCk7CiAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAg\nICAgcmV0dXJuIHJldDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBSZWNvcmQgdGhhdCB0aGUgZmllbGQgaXMgZGlydHkgKHdoaWNo\nIG1pZ2h0IGxvYWQgREZHKQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIHZvaWQgc2V0dGluZ0Jvb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIGludCBmaWVsZCwKICAgICAgICBib29sZWFuIGN1clZhbCwgYm9vbGVh\nbiBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9S\nRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYg\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwog\nICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZB\nTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXR0aW5nQnl0ZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkLAogICAgICAgIGJ5dGUgY3VyVmFsLCBieXRlIG5ld1ZhbCwgaW50\nIHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAg\nICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVh\nbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBT\nRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVCeXRlRmllbGQo\nZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdDaGFyRmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAg\nY2hhciBjdXJWYWwsIGNoYXIgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAg\naWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdW\nYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5\nQ2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShm\naWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAg\nICAgICAgX3NpbmdsZS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgbmV3VmFsKTsK\nICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7\nCiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0dGluZ0RvdWJsZUZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJsZSBjdXJWYWws\nIGRvdWJsZSBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9\nIFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJW\nYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmll\nbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29s\nZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2lu\nZ2xlLnN0b3JlRG91YmxlRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldHRpbmdGbG9hdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIGZsb2F0IGN1clZhbCwgZmxvYXQgbmV3\nVmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RF\nKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2Fk\nZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAg\nICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwg\nc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUZs\nb2F0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGly\ndHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRp\nbmdJbnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBpbnQgY3VyVmFsLCBpbnQgbmV3VmFsLCBpbnQgc2V0KSB7CiAg\nICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlm\nIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9Qcmlt\nYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBk\naXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsK\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUludEZpZWxkKGZpZWxkLCBuZXdW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nTG9uZ0ZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGxvbmcgY3VyVmFs\nLCBsb25nIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0g\nU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZh\nbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVs\nZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xl\nYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5n\nbGUuc3RvcmVMb25nRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAg\nIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldHRpbmdPYmplY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCwKICAgICAgICBPYmplY3QgY3VyVmFsLCBPYmplY3QgbmV3\nVmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RF\nKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmll\nbGQpKSB7CiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAg\nLy8gb25seSBjb21wYXJlIG5ldyB0byBvbGQgdmFsdWVzIGlmIHRoZSBjb21w\nYXJpc29uIGlzIGdvaW5nIHRvCiAgICAgICAgICAgICAgICAvLyBiZSBjaGVh\ncCAtLSBkb24ndCBjb21wYXJlIGNvbGxlY3Rpb25zLCBtYXBzLCBVRFRzCiAg\nICAgICAgICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJB\nWToKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNU\nSU9OOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFs\nICE9IG51bGwgJiYgbmV3VmFsLmVxdWFscyhjdXJWYWwpKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYgdGhp\ncyBpcyBhIGRlcGVuZGVudCB1bmxvYWRlZCBmaWVsZCwgbWFrZSBzdXJlIHRv\nIGxvYWQKICAgICAgICAgICAgICAgIC8vIGl0IG5vdwogICAgICAgICAgICAg\nICAgaWYgKGZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0FVVE8KICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0\nS2V5KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAgICAgICAgICAg\nPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8KICAgICAgICAgICAgICAg\nICAgICB8fCBmbWQuZ2V0RWxlbWVudCgpLmdldENhc2NhZGVEZWxldGUoKQog\nICAgICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9B\nVVRPKQogICAgICAgICAgICAgICAgICAgIGN1clZhbCA9IGZldGNoT2JqZWN0\nRmllbGQoZmllbGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhc3Nl\ncnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgICAgICBpZiAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKQog\nICAgICAgICAgICAgICAgYXNzZXJ0Tm90TWFuYWdlZE9iamVjdElkKG5ld1Zh\nbCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xl\nYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIGlmIChz\nZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZU9iamVjdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICAg\nICAgX3NpbmdsZS51bnByb3h5KCk7CiAgICAgICAgICAgICAgICBfc2luZ2xl\nLmRlcmVmZXJlbmNlRGVwZW5kZW50KCk7CiAgICAgICAgICAgICAgICBfc2lu\nZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAg\nICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXR0aW5nU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCwKICAgICAgICBzaG9ydCBjdXJWYWwsIHNob3J0IG5ld1Zh\nbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkg\newogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAg\nfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNl\ndCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTaG9y\ndEZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmll\nbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5\nKHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5n\nU3RyaW5nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQs\nCiAgICAgICAgU3RyaW5nIGN1clZhbCwgU3RyaW5nIG5ld1ZhbCwgaW50IHNl\ndCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAg\nICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKG5ld1ZhbCwgY3VyVmFsKSAm\nJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4u\nRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEaXNhbGxvd3MgY2hhbmdpbmcgcHJpbWFyeSBrZXkgZmllbGRzIGZvciBp\nbnN0YW5jZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnROb1By\naW1hcnlLZXlDaGFuZ2UoaW50IGZpZWxkKSB7CiAgICAgICAgaWYgKF9vaWQg\nIT0gbnVsbCAmJiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuaXNQcmltYXJ5S2V5\nKCkpCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoImNoYW5n\nZS1pZGVudGl0eSIpKS5zZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc2FsbG93cyBzZXR0\naW5nIGFuIG9iamVjdCBpZCBmaWVsZCB0byBhIG1hbmFnZWQgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHZvaWQgYXNzZXJ0Tm90TWFuYWdlZE9iamVjdElkKE9i\namVjdCB2YWwpIHsKICAgICAgICBpZiAodmFsICE9IG51bGwKICAgICAgICAg\nICAgJiYgKChQZXJzaXN0ZW5jZUNhcGFibGUpIHZhbCkucGNHZXRHZW5lcmlj\nQ29udGV4dCgpICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAoIm1hbmFnZWQtb2lkIiwgRXhjZXB0aW9ucy50b1N0cmluZyh2\nYWwpLAogICAgICAgICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmco\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBEZWxlZ2F0\nZSB0byBGaWVsZE1hbmFnZXIKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEJvb2xlYW5GaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBib29s\nZWFuIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUJvb2xlYW5GaWVsZChm\naWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRl\nZEJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBieXRlIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUJ5dGVG\naWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncm92aWRlZENoYXJGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBjaGFyIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9y\nZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBwcm92aWRlZERvdWJsZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJsZSBjdXJWYWwpIHsKICAgICAg\nICBfZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEZsb2F0RmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZmxvYXQgY3VyVmFs\nKSB7CiAgICAgICAgX2ZtLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3VyVmFs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEludEZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGludCBj\ndXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVJbnRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZExvbmdGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBs\nb25nIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUxvbmdGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZE9i\namVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIE9iamVjdCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVPYmpl\nY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcm92aWRlZFNob3J0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3VyVmFsKSB7CiAgICAgICAgX2Zt\nLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBwcm92aWRlZFN0cmluZ0ZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIFN0cmluZyBjdXJWYWwpIHsK\nICAgICAgICBfZm0uc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXBsYWNlQm9vbGVhbkZpZWxk\nKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAg\ncmV0dXJuIF9mbS5mZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CiAgICB9Cgog\nICAgcHVibGljIGJ5dGUgcmVwbGFjZUJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0\nY2hCeXRlRmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBjaGFyIHJl\ncGxhY2VDaGFyRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoQ2hhckZpZWxkKGZpZWxk\nKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIHJlcGxhY2VEb3VibGVGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAg\nIHJldHVybiBfZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAgICB9Cgog\nICAgcHVibGljIGZsb2F0IHJlcGxhY2VGbG9hdEZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5m\nZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\ncmVwbGFjZUludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEludEZpZWxkKGZpZWxk\nKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyByZXBsYWNlTG9uZ0ZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0\ndXJuIF9mbS5mZXRjaExvbmdGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCByZXBsYWNlT2JqZWN0RmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNo\nT2JqZWN0RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBzaG9ydCBy\nZXBsYWNlU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hTaG9ydEZpZWxkKGZp\nZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHJlcGxhY2VTdHJpbmdG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAg\nICAgIHJldHVybiBfZm0uZmV0Y2hTdHJpbmdGaWVsZChmaWVsZCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAg\nLy8gSW1wbGVtZW50YXRpb24gb2YgRmllbGRNYW5hZ2VyCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xl\nYW4gZmV0Y2hCb29sZWFuKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlm\nICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBm\nZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwg\nPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgo\nQm9vbGVhbikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSku\nYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZmV0\nY2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2\nZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHBy\nb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncmV0dXJuIF9zaW5nbGUuZmV0Y2hCb29sZWFuRmllbGQoZmllbGQpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBmZXRjaEJ5dGUoaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZldGNoQnl0ZUZpZWxkKGZpZWxkKTsKCiAg\nICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKHZhbCwgX2Jyb2tlcikpLmJ5dGVWYWx1ZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQu\nZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwg\nTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAg\nICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoQnl0ZUZpZWxkKGZpZWxkKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGNoYXIgZmV0Y2hDaGFyKGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaENoYXJGaWVsZChmaWVsZCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CiAgICAgICAgcmV0dXJuICgoQ2hhcmFjdGVyKSBmbWQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5jaGFyVmFsdWUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgY2hhciBmZXRjaENoYXJGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaENoYXJGaWVsZChm\naWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBkb3VibGUgZmV0Y2hE\nb3VibGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNF\neHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoRG91Ymxl\nRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVs\nZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1k\nLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkuZG91YmxlVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIGZldGNoRG91YmxlRmllbGQo\naW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAg\nICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwg\nZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMs\nIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUu\nZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBmbG9hdCBmZXRjaEZsb2F0KGludCBmaWVsZCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJl\ndHVybiBmZXRjaEZsb2F0RmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3Qg\ndmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2Vy\nKSkuZmxvYXRWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBmbG9hdCBmZXRj\naEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxz\nLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0\ndXJuIF9zaW5nbGUuZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIGludCBmZXRjaEludChpbnQgZmllbGQpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICByZXR1cm4gZmV0Y2hJbnRGaWVsZChmaWVsZCk7CgogICAgICAgIE9i\namVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZmV0\nY2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkp\nCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMu\nTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlk\nZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1\ncm4gX3NpbmdsZS5mZXRjaEludEZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25nKGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmZXRjaExvbmdGaWVsZChmaWVsZCk7CgogICAgICAgIE9i\namVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBm\nZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVs\nZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZl\nbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJv\ndmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBy\nZXR1cm4gX3NpbmdsZS5mZXRjaExvbmdGaWVsZChmaWVsZCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3QoaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwoK\nICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2Up\nOwogICAgICAgIHJldHVybiBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3RG\naWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAg\nICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19O\nT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxk\nKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3Np\nbmdsZS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHNob3J0IGZldGNoU2hvcnQoaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZldGNoU2hvcnRGaWVsZChmaWVsZCk7CgogICAgICAgIE9i\namVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5zaG9ydFZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIHNob3J0\nIGZldGNoU2hvcnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tM\nZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAg\ncHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICByZXR1cm4gX3NpbmdsZS5mZXRjaFNob3J0RmllbGQoZmllbGQpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGZldGNoU3RyaW5nKGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaFN0cmluZ0ZpZWxkKGZpZWxk\nKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZh\nbHNlKTsKICAgICAgICByZXR1cm4gKFN0cmluZykgZm1kLmdldEV4dGVybmFs\nVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTdHJpbmdGaWVsZChmaWVsZCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQm9vbGVhbihpbnQg\nZmllbGQsIGJvb2xlYW4gZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUJv\nb2xlYW5GaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICBPYmplY3QgdmFsID0gKGV4dGVybmFsVmFsKSA/IEJv\nb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIHN0b3Jl\nRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKHZhbCwgX2Jyb2tlcikp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJvb2xl\nYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3VyVmFsKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3Rv\ncmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\nc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQo\nZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZUJ5dGUoaW50IGZpZWxkLCBieXRlIGV4dGVybmFsVmFsKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgc3RvcmVCeXRlRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRG\naWVsZFZhbHVlKG5ldyBCeXRlKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAg\nICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJ5\ndGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFsKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVC\neXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9h\nZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQs\nIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUNo\nYXIoaW50IGZpZWxkLCBjaGFyIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3Rv\ncmVDaGFyRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZh\nbHVlKG5ldyBDaGFyYWN0ZXIoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAg\nICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hh\nckZpZWxkKGludCBmaWVsZCwgY2hhciBjdXJWYWwpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUNo\nYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2Fk\nZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwg\nbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlRG91\nYmxlKGludCBmaWVsZCwgZG91YmxlIGV4dGVybmFsVmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\nc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZp\nZWxkVmFsdWUobmV3IERvdWJsZShleHRlcm5hbFZhbCksCiAgICAgICAgICAg\nICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVE\nb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJsZSBjdXJWYWwpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVGbG9hdChpbnQgZmllbGQsIGZsb2F0IGV4dGVybmFsVmFsKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAg\nICAgICAgc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQu\nZ2V0RmllbGRWYWx1ZShuZXcgRmxvYXQoZXh0ZXJuYWxWYWwpLAogICAgICAg\nICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IGN1clZhbCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9h\nZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlSW50KGludCBmaWVsZCwgaW50IGV4dGVybmFsVmFsKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgc3RvcmVJbnRGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZp\nZWxkVmFsdWUoTnVtYmVycy52YWx1ZU9mKGV4dGVybmFsVmFsKSwKICAgICAg\nICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxh\nY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0\nTG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmll\nbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9y\nZUxvbmcoaW50IGZpZWxkLCBsb25nIGV4dGVybmFsVmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\nc3RvcmVMb25nRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVs\nZFZhbHVlKE51bWJlcnMudmFsdWVPZihleHRlcm5hbFZhbCksCiAgICAgICAg\nICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVMb25nRmllbGQoaW50IGZpZWxkLCBsb25nIGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBs\nYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNl\ndExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZp\nZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVPYmplY3QoaW50IGZpZWxkLCBPYmplY3QgZXh0ZXJuYWxWYWwpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBleHRlcm5hbFZhbCA9IGZtZC5vcmRlcihleHRlcm5hbFZh\nbCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAg\nICAgICAgc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1k\nLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxWYWwsIF9icm9rZXIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdEZpZWxkKGludCBmaWVsZCwg\nT2JqZWN0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIF9zaW5nbGUucHJveHkodHJ1ZSwgZmFs\nc2UpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVTaG9ydChpbnQgZmllbGQsIHNob3J0\nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVTaG9ydEZpZWxkKGZpZWxk\nLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgU2hvcnQoZXh0\nZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNo\nb3J0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nKGludCBmaWVsZCwgU3Ry\naW5nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNF\neHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVTdHJpbmdGaWVsZChm\naWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxW\nYWwsIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZVN0\ncmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5nIGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\nc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQo\nZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0\nb3JlIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZSBpbnRvIHRoZSBnaXZlbiBmaWVs\nZCBtYW5hZ2VyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc3RvcmVGaWVs\nZChpbnQgZmllbGQsIE9iamVjdCB2YWwsIEZpZWxkTWFuYWdlciBmbSkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkLWluZGV4\nIiwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKGZpZWxkKSwgX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIGJv\nb2xlYW4gYm9vbCA9IHZhbCAhPSBudWxsICYmICgoQm9vbGVhbikgdmFsKS5i\nb29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlQm9vbGVh\nbkZpZWxkKGZpZWxkLCBib29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAg\nICAgYnl0ZSBiID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFs\nKS5ieXRlVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlQnl0ZUZp\nZWxkKGZpZWxkLCBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgY2hh\nciBjID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKENoYXJhY3RlcikgdmFsKS5j\naGFyVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlQ2hhckZpZWxk\nKGZpZWxkLCBjKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBkb3Vi\nbGUgZCA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuZG91\nYmxlVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlRG91YmxlRmll\nbGQoZmllbGQsIGQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgZmxv\nYXQgZiA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuZmxv\nYXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVGbG9hdEZpZWxk\nKGZpZWxkLCBmKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBpbnQgaSA9\nICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuaW50VmFsdWUo\nKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlSW50RmllbGQoZmllbGQsIGkp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBsb25nIGwgPSAodmFsID09\nIG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgZm0uc3RvcmVMb25nRmllbGQoZmllbGQsIGwpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICAgICAgc2hvcnQgcyA9ICh2YWwgPT0gbnVs\nbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgZm0uc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBzKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nVFJJTkc6CiAgICAgICAgICAgICAgICBmbS5zdG9yZVN0cmluZ0ZpZWxkKGZp\nZWxkLCAoU3RyaW5nKSB2YWwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBmbS5zdG9yZU9i\namVjdEZpZWxkKGZpZWxkLCB2YWwpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIEVyYXNlIHRoZSBmYWN0IHRoYXQgdGhpcyBp\nbnN0YW5jZSBoYXMgYmVlbiBmbHVzaGVkLgogICAgICovCiAgICB2b2lkIGVy\nYXNlRmx1c2goKSB7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7\nCiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CgogICAg\nICAgIGludCBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kczsgaSsrKQogICAgICAgICAg\nICBfZmx1c2guY2xlYXIoaSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNv\ncmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxkcyBhcmUvYXJlIG5vdCBsb2Fk\nZWQuCiAgICAgKiBQcmltYXJ5IGtleSBhbmQgbm9uLXBlcnNpc3RlbnQgZmll\nbGRzIGFyZSBub3QgYWZmZWN0ZWQuCiAgICAgKi8KICAgIHZvaWQgc2V0TG9h\nZGVkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmlzUHJpbWFyeUtleSgpCiAgICAgICAgICAgICAgICAmJiBmbWRz\nW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRzW2ldLk1BTkFHRV9QRVJTSVNU\nRU5UKQogICAgICAgICAgICAgICAgc2V0TG9hZGVkKGksIHZhbCk7CiAgICAg\nICAgfQogICAgICAgIGlmICghdmFsKSB7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19MT0FERUQ7CiAgICAgICAgICAgIHNldERpcnR5KGZhbHNlKTsK\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9B\nREVEOwogICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkcyB0aGF0IGFsbCBp\nbnN0YW5jZSBmaWVsZHMgYXJlL2FyZSBub3QgZGlydHksCiAgICAgKiBhbmQg\nY2hhbmdlcyB0aGUgZmxhZ3Mgb2YgdGhlIGluc3RhbmNlIGFjY29yZGluZ2x5\nLgogICAgICovCiAgICB2b2lkIHNldERpcnR5KGJvb2xlYW4gdmFsKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9ICFpc05ldygpIHx8IGlzRmx1\nc2hlZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodmFsICYmICghdXBkYXRlCiAg\nICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldFVwZGF0ZVN0cmF0ZWd5KCkg\nIT0gVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUpKQogICAgICAgICAgICAgICAg\nX2RpcnR5LnNldChpKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXZhbCkgewog\nICAgICAgICAgICAgICAgLy8gd2UgbmV2ZXIgY29uc2lkZXIgY2xlYW4gZmll\nbGRzIGZsdXNoZWQ7IHRoaXMgYWxzbyB0YWtlcwogICAgICAgICAgICAgICAg\nLy8gY2FyZSBvZiBjbGVhcmluZyB0aGUgZmx1c2hlZCBmaWVsZHMgb24gY29t\nbWl0L3JvbGxiYWNrCiAgICAgICAgICAgICAgICBfZmx1c2guY2xlYXIoaSk7\nCiAgICAgICAgICAgICAgICBfZGlydHkuY2xlYXIoaSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0xPQURFRDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4\nZWN1dGVzIHByZS1jbGVhciBjYWxsYmFja3MsIGNsZWFycyBhbGwgbWFuYWdl\nZCBmaWVsZHMsIGFuZCBjYWxscyB0aGUKICAgICAqIHtAbGluayAjc2V0TG9h\nZGVkfSBtZXRob2Qgd2l0aCBhIHZhbHVlIG9mIGZhbHNlLiBQcmltYXJ5IGtl\neSBmaWVsZHMKICAgICAqIGFyZSBub3QgY2xlYXJlZC4KICAgICAqLwogICAg\ndm9pZCBjbGVhckZpZWxkcygpIHsKICAgICAgICBmaXJlTGlmZWN5Y2xlRXZl\nbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFSKTsKCiAgICAgICAgLy8g\ndW5wcm94eSBhbGwgZmllbGRzCiAgICAgICAgdW5wcm94eUZpZWxkcygpOwoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g\nY2xlYXIgbm9uLXBrIGZpZWxkcwogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiBmbWRzW2ld\nLmdldE1hbmFnZW1lbnQoKQogICAgICAgICAgICAgICAgICAgID09IEZpZWxk\nTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKF9wYywgQ2xlYXJGaWVsZE1hbmFnZXIuZ2V0SW5z\ndGFuY2UoKSwgaSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZv\ncmdldCB2ZXJzaW9uIGluZm8gYW5kIGltcGwgZGF0YSBzbyB3ZSByZS1yZWFk\nIG5leHQgdGltZQogICAgICAgICAgICBzZXRMb2FkZWQoZmFsc2UpOwogICAg\nICAgICAgICBfdmVyc2lvbiA9IG51bGw7CiAgICAgICAgICAgIF9sb2FkVmVy\nc2lvbiA9IG51bGw7CiAgICAgICAgICAgIGlmIChfZmllbGRJbXBsICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBBcnJheXMuZmlsbChfZmllbGRJbXBsLCBu\ndWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CgogICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZl\nY3ljbGVFdmVudC5BRlRFUl9DTEVBUik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWNvcmQgdGhhdCB3ZSBzaG91bGQgc2F2ZSBhbnkgZmllbGRzIHRoYXQg\nY2hhbmdlIGZyb20gdGhpcyBwb2ludAogICAgICogZm9yd2FyZC4KICAgICAq\nLwogICAgdm9pZCBzYXZlRmllbGRzKGJvb2xlYW4gaW1tZWRpYXRlKSB7CiAg\nICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0gUmVzdG9y\nZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAoX2ZsYWdzICYg\nRkxBR19JTlZFUlNFUykgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19TQVZFOwogICAgICAgIGlmIChpbW1lZGlh\ndGUpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2Fk\nZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAgIHNh\ndmVGaWVsZChpKTsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NBVkU7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGZpZWxk\nIGlzbid0IGFscmVhZHkgc2F2ZWQsIHNhdmVzIHRoZSBjdXJyZW50bHkgbG9h\nZGVkIGZpZWxkCiAgICAgKiBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UuIFRoZSBz\nYXZlZCB2YWx1ZXMgY2FuIGFsbCBiZSByZXN0b3JlZCB2aWEKICAgICAqIHtA\nbGluayAjcmVzdG9yZUZpZWxkc30uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBzYXZlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1NBVkUpID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gaWYgdGhpcyBpcyBhIG1hbmFnZWQgaW52ZXJzZSBmaWVsZCwgbG9h\nZCBpdCBzbyB3ZSdyZSBzdXJlIHRvIGhhdmUKICAgICAgICAvLyB0aGUgb3Jp\nZ2luYWwgdmFsdWUKICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSAm\nJiAoKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpICE9IDAKICAgICAgICAgICAg\nJiYgX21ldGEuZ2V0RmllbGQoZmllbGQpLmdldEludmVyc2VNZXRhRGF0YXMo\nKS5sZW5ndGggPiAwKSkKICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBM\nb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAg\nLy8gZG9uJ3QgYm90aGVyIGNyZWF0aW5nIHRoZSBzYXZlIGZpZWxkIG1hbmFn\nZXIgaWYgd2UncmUgbm90IGdvaW5nIHRvCiAgICAgICAgLy8gc2F2ZSB0aGUg\nb2xkIGZpZWxkIHZhbHVlIGFueXdheQogICAgICAgIGlmIChfc2F2ZWQgPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgX3NhdmVkID0gbmV3IFNhdmVGaWVsZE1hbmFnZXIo\ndGhpcywgbnVsbCwgX2RpcnR5KTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gY29weSB0\naGUgZmllbGQgdG8gc2F2ZSBmaWVsZCBtYW5hZ2VyOyBpZiB0aGUgZmllbGQg\naXMgbm90IGRpcmVjdGx5CiAgICAgICAgLy8gY29weWFibGUsIGltbWVkaWF0\nZWx5IHByb3ZpZGUgYW5kIHJlcGxhY2UgaXQgdmlhIHRoZSBzYXZlIGZpZWxk\nCiAgICAgICAgLy8gbWFuYWdlciwgd2hpY2ggd2lsbCBjb3B5IHRoZSBtdXRh\nYmxlIHZhbHVlIHRvIHByZXZlbnQgYnktcmVmIG1vZHMKICAgICAgICBpZiAo\nX3NhdmVkLnNhdmVGaWVsZChmaWVsZCkpIHsKICAgICAgICAgICAgcHJvdmlk\nZUZpZWxkKF9wYywgX3NhdmVkLCBmaWVsZCk7CiAgICAgICAgICAgIHJlcGxh\nY2VGaWVsZChfc2F2ZWQuZ2V0U3RhdGUoKSwgX3NhdmVkLCBmaWVsZCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTm90aWZpY2F0aW9uIHRo\nYXQgdGhlIHN0YXRlIHdpbGwgbm90IG5lZWQgdG8gYmUgcm9sbGVkIGJhY2sK\nICAgICAqIHRvIHRoYXQgb2YgdGhlIGxhc3QgY2FsbCB0byB7QGxpbmsgI3Nh\ndmVGaWVsZHN9LgogICAgICovCiAgICB2b2lkIGNsZWFyU2F2ZWRGaWVsZHMo\nKSB7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NBVkU7CiAgICAgICAgX3Nh\ndmVkID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJvbGxiYWNrIHRo\nZSBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UgdG8gdGhlIHNhdmVkIHN0YXRlIGZy\nb20gdGhlCiAgICAgKiBsYXN0IGNhbGwgdG8ge0BsaW5rICNzYXZlRmllbGRz\nfSwgb3IgdG8gZGVmYXVsdCB2YWx1ZXMgaWYgbmV2ZXIgc2F2ZWQuCiAgICAg\nKi8KICAgIHZvaWQgcmVzdG9yZUZpZWxkcygpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU0FWRSkg\nPT0gMCkKICAgICAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpOwogICAg\nICAgICAgICAgICAgZWxzZSAvLyBvbmx5IHVubG9hZGVkIGZpZWxkcyB3ZXJl\nIGRpcnRpZWQKICAgICAgICAgICAgICAgICAgICBfbG9hZGVkLmFuZE5vdChf\nbG9hZGVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB3ZSBkaXJl\nY3Qgc3RhdGUgdHJhbnNpdGlvbnMgYmFzZWQgb24gb3VyIG93biBnZXRSZXN0\nb3JlU3RhdGUKICAgICAgICAgICAgLy8gbWV0aG9kLCBidXQgdG8gZGVjaWRl\nIHdoZXRoZXIgdG8gYWN0dWFsbHkgcm9sbGJhY2sgZmllbGQKICAgICAgICAg\nICAgLy8gdmFsdWVzLCB3ZSBjb25zdWx0IHRoZSBicm9rZXIgZm9yIHRoZSB1\nc2VyJ3Mgc2V0dGluZwogICAgICAgICAgICBlbHNlIGlmIChfYnJva2VyLmdl\ndFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUp\nIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIGFsbCBjdXJyZW50bHkt\nbG9hZGVkIGZpZWxkcwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAs\nIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykKICAgICAg\nICAgICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoaSkgJiYgX3NhdmVkLnJl\nc3RvcmVGaWVsZChpKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKF9wYywgX3NhdmVkLCBpKTsKCiAgICAgICAgICAgICAgICAvLyBy\nb2xsYmFjayBsb2FkZWQgc2V0CiAgICAgICAgICAgICAgICBfbG9hZGVkLmFu\nZE5vdChfc2F2ZWQuZ2V0VW5sb2FkZWQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2VzIGFs\nbCBzZWNvbmQgY2xhc3Mgb2JqZWN0IGZpZWxkcyB3aXRoIGZyZXNoIHByb3hp\nZWQgaW5zdGFuY2VzCiAgICAgKiBjb250YWluaW5nIHRoZSBzYW1lIGluZm9y\nbWF0aW9uIGFzIHRoZSBvcmlnaW5hbHMuCiAgICAgKi8KICAgIHZvaWQgcHJv\neHlGaWVsZHMoYm9vbGVhbiByZXNldCwgYm9vbGVhbiByZXBsYWNlTnVsbCkg\newogICAgICAgIC8vIHdlIG9ubHkgcmVwbGFjZSBudWxscyBpZiB0aGUgcnVu\ndGltZSBjYW4ndCBkaWZmZXJlbnRpYXRlIGJldHdlZW4KICAgICAgICAvLyBu\ndWxsIGFuZCBlbXB0eSBjb250YWluZXJzLiAgd2UgcmVwbGFjZSBudWxscyBp\nbiB0aGlzIGNhc2UgdG8KICAgICAgICAvLyBtYWludGFpbiBjb25zaXN0ZW5j\neSB3aGV0aGVyIHZhbHVlcyBhcmUgYmVpbmcgcmV0YWluZWQgb3Igbm90CiAg\nICAgICAgaWYgKHJlcGxhY2VOdWxsKQogICAgICAgICAgICByZXBsYWNlTnVs\nbCA9ICFfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5zdXBwb3J0ZWRPcHRp\nb25zKCkuCiAgICAgICAgICAgICAgICBjb250YWlucyhPcGVuSlBBQ29uZmln\ndXJhdGlvbi5PUFRJT05fTlVMTF9DT05UQUlORVIpOwoKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAs\nIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKF9zaW5nbGUucHJveHkocmVzZXQsIHJlcGxh\nY2VOdWxsKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxk\nKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVbnByb3h5IGFsbCBmaWVsZHMuCiAgICAgKi8KICAgIHZv\naWQgdW5wcm94eUZpZWxkcygpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfTk9fVU5QUk9YWSkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkr\nKykgewogICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Npbmds\nZSwgaSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnVucHJveHkoKTsKICAg\nICAgICAgICAgICAgIF9zaW5nbGUucmVsZWFzZUVtYmVkZGVkKCk7CiAgICAg\nICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdldCByZWFkeSBm\nb3IgYSBmbHVzaC4gUGVyc2lzdHMgYWxsIHBlcnNpc3RlbmNlLWNhcGFibGUg\nb2JqZWN0IGZpZWxkcywKICAgICAqIGFuZCBjaGVja3MgZm9yIGlsbGVnYWwg\nbnVsbCB2YWx1ZXMuIEFsc28gYXNzaWducyBvaWRzIGFuZCBmaWVsZCB2YWx1\nZXMKICAgICAqIGZvciBhbGwgc3RyYXRlZ2llcyB0aGF0IGRvbid0IHJlcXVp\ncmUgZmx1c2hpbmcuCiAgICAgKi8KICAgIHZvaWQgcHJlRmx1c2goYm9vbGVh\nbiBsb2dpY2FsLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX1BSRV9GTFVTSEVEKSAhPSAwKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGlmIChpc1BlcnNpc3RlbnQoKSkgewogICAgICAg\nICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JF\nX1NUT1JFKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0ZMVVNI\nRUQ7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKCFsb2dpY2FsKQogICAgICAgICAgICAgICAgYXNz\naWduT2JqZWN0SWQoZmFsc2UsIHRydWUpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMCwgbGVuID0gX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoOyBpIDwg\nbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICgobG9naWNhbCB8fCAh\nYXNzaWduRmllbGQoaSwgdHJ1ZSkpICYmICFfZmx1c2guZ2V0KGkpCiAgICAg\nICAgICAgICAgICAgICAgJiYgX2RpcnR5LmdldChpKSkgewogICAgICAgICAg\nICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChfc2luZ2xlLnByZUZsdXNoKGxvZ2ljYWws\nIGNhbGwpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQo\nX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE1ha2UgY2FsbGJhY2tzIGZvciBkZWxldGlvbi4KICAgICAq\nLwogICAgdm9pZCBwcmVEZWxldGUoKSB7CiAgICAgICAgLy8gc2V0IGEgZmxh\nZyB3aGlsZSBjYWxsIHByZSBkZWxldGUgY2FsbGJhY2sgc28gdGhhdCB1c2Vy\nIGNhbid0CiAgICAgICAgLy8gZ2V0IGludG8gaW5maW5pdGUgcmVjdXJzaW9u\nIGJ5IGNhbGxpbmcgZGVsZXRlKHRoaXMpCiAgICAgICAgLy8gd2l0aGluIGhp\ncyBjYWxsYmFjayBtZXRob2QKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nUFJFX0RFTEVUSU5HKSA9PSAwKSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZP\nUkVfREVMRVRFKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVfREVMRVRJTkc7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDYXNjYWRl\nIGRlbGV0ZXMgYW5kIGRlcmVmZXJlbmNlIGRlcGVuZGVudCBmaWVsZHMuCiAg\nICAgKi8KICAgIHZvaWQgY2FzY2FkZURlbGV0ZShPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRG\naWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2Fk\nZURlbGV0ZSgpICE9IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FCiAgICAg\nICAgICAgICAgICB8fCBmbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVEZWxl\ndGUoKQogICAgICAgICAgICAgICAgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX05PTkUKICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVudCgp\nLmdldENhc2NhZGVEZWxldGUoKQogICAgICAgICAgICAgICAgIT0gVmFsdWVN\nZXRhRGF0YS5DQVNDQURFX05PTkUpIHsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuc3RvcmVPYmplY3RGaWVsZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7\nCiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlbGV0ZShjYWxsKTsKICAgICAg\nICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENhbGxlZCBhZnRlciBhbiBp\nbnN0YW5jZSBpcyBwZXJzaXN0ZWQgYnkgYSB1c2VyIHRocm91Z2ggdGhlIGJy\nb2tlci4KICAgICAqIENhc2NhZGVzIHRoZSBwZXJzaXN0IG9wZXJhdGlvbiB0\nbyBmaWVsZHMgbWFya2VkCiAgICAgKiB7QGxpbmsgVmFsdWVNZXRhRGF0YSND\nQVNDQURFX0lNTUVESUFURX0uCiAgICAgKi8KICAgIHZvaWQgY2FzY2FkZVBl\ncnNpc3QoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmICghX2xvYWRlZC5nZXQoaSkpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldENhc2NhZGVQZXJzaXN0\nKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAg\nICAgICAgICAgfHwgZm1kc1tpXS5nZXRLZXkoKS5nZXRDYXNjYWRlUGVyc2lz\ndCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEVsZW1l\nbnQoKS5nZXRDYXNjYWRlUGVyc2lzdCgpCiAgICAgICAgICAgICAgICA9PSBW\nYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAg\nICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChp\nLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5wZXJzaXN0KGNh\nbGwpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0\naGUgZ2l2ZW4gZmllbGQgc2V0IGZyb20gdGhlIGRhdGEgc3RvcmUgaW50byB0\naGUgaW5zdGFuY2UuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBhbnkgZGF0YSBp\ncyBsb2FkZWQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgYm9vbGVh\nbiBsb2FkRmllbGRzKEJpdFNldCBmaWVsZHMsIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwKICAgICAgICBPYmplY3Qgc2RhdGEs\nIGJvb2xlYW4gZm9yV3JpdGUpIHsKICAgICAgICAvLyBjYW4ndCBsb2FkIHZl\ncnNpb24gZmllbGQgZnJvbSBzdG9yZQogICAgICAgIGlmIChmaWVsZHMgIT0g\nbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIHZmaWVsZCA9IF9t\nZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgICAgICBpZiAodmZpZWxk\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBmaWVsZHMuY2xlYXIodmZpZWxk\nLmdldEluZGV4KCkpOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiByZXQg\nPSBmYWxzZTsKICAgICAgICBzZXRMb2FkaW5nKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIGlmIGFueSBmaWVsZHMgZ2l2ZW4sIGxvYWQg\ndGhlbQogICAgICAgICAgICBpbnQgbGVuID0gKGZpZWxkcyA9PSBudWxsKSA/\nIDAgOiBmaWVsZHMubGVuZ3RoKCk7CiAgICAgICAgICAgIGlmIChsZW4gPiAw\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoIV9icm9rZXIuZ2V0U3Rv\ncmVNYW5hZ2VyKCkubG9hZCh0aGlzLCBmaWVsZHMsIGZldGNoLAogICAgICAg\nICAgICAgICAgICAgIGxvY2tMZXZlbCwgc2RhdGEpKSB7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJkZWwtaW5zdGFuY2UiLAogICAgICAgICAgICAgICAgICAgICAg\nICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIF9vaWQpKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0\nYW5jZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSB2ZXJzaW9uIGluZm9ybWF0aW9uIGhhcyBiZWVuIHNldDsgdmVyc2lv\nbiBpbmZvIG11c3QKICAgICAgICAgICAgLy8gYWx3YXlzIGJlIHNldCBhZnRl\nciB0aGUgZmlyc3Qgc3RhdGUgbG9hZCBvciBzZXQgKHdoaWNoIGlzIHdoeQog\nICAgICAgICAgICAvLyB3ZSBkbyB0aGlzIGV2ZW4gaWYgbm8gZmllbGRzIHdl\ncmUgbG9hZGVkIC0tIGNvdWxkIGJlIHRoYXQgdGhpcwogICAgICAgICAgICAv\nLyBtZXRob2QgaXMgYmVpbmcgY2FsbGVkIGFmdGVyIGEgZmllbGQgaXMgc2V0\nKS4uLiBzb21lIGluc3RhbmNlcwogICAgICAgICAgICAvLyBtaWdodCBub3Qg\naGF2ZSB2ZXJzaW9uIGluZm8sIGluIHdoaWNoIGNhc2UgdGhpcyBnZXRzIGNh\nbGxlZAogICAgICAgICAgICAvLyBtdXRpcGxlIHRpbWVzOyB0aGF0IHNob3Vs\nZCBiZSBvayB0b28KICAgICAgICAgICAgaWYgKF9sb2FkVmVyc2lvbiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzeW5jVmVyc2lvbihzZGF0YSk7CiAg\nICAgICAgICAgICAgICByZXQgPSByZXQgfHwgX2xvYWRWZXJzaW9uICE9IG51\nbGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7\nCiAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2UpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gc2VlIGlmIHRoZSBkZmcgaXMgbm93IGxvYWRlZDsgZG8gdGhp\ncyByZWdhcmRsZXNzIG9mIHdoZXRoZXIgd2UKICAgICAgICAvLyBsb2FkZWQg\nYW55IGZpZWxkcywgY2F1c2UgbWF5IGFscmVhZHkgaGF2ZSBiZWVuIGxvYWRl\nZCBieQogICAgICAgIC8vIFN0b3JlTWFuYWdlciBkdXJpbmcgaW5pdGlhbGl6\nYXRpb24KICAgICAgICBwb3N0TG9hZCgtMSwgZmV0Y2gpOwogICAgICAgIHJl\ndHVybiByZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZl\nbiBmaWVsZCdzIGZldGNoIGdyb3VwOyB0aGUgZmllbGQgaXRzZWxmIG1heSBh\nbHJlYWR5IGJlCiAgICAgKiBsb2FkZWQgaWYgaXQgaXMgYmVpbmcgc2V0IGJ5\nIHRoZSB1c2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBsb2FkRmll\nbGQoaW50IGZpZWxkLCBpbnQgbG9ja0xldmVsLCBib29sZWFuIGZvcldyaXRl\nLAogICAgICAgIGJvb2xlYW4gZmdzKSB7CiAgICAgICAgRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBCaXRTZXQgZmllbGRzID0gbnVsbDsKCiAgICAg\nICAgLy8gaWYgdGhpcyBpcyBhIGRmZyBmaWVsZCBvciB3ZSBuZWVkIHRvIGxv\nYWQgb3VyIGRmZywgZG8gc28KICAgICAgICBpZiAoZmdzICYmIChfZmxhZ3Mg\nJiBGTEFHX0xPQURFRCkgPT0gMCkKICAgICAgICAgICAgZmllbGRzID0gZ2V0\nVW5sb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9GR1MsIG51bGwpOwogICAg\nICAgIAogICAgICAgIC8vIGNoZWNrIGZvciBsb2FkIGZldGNoIGdyb3VwCiAg\nICAgICAgU3RyaW5nIGxmZyA9IGZtZC5nZXRMb2FkRmV0Y2hHcm91cCgpOwog\nICAgICAgIGJvb2xlYW4gbGZnQWRkZWQgPSBmYWxzZTsKICAgICAgICBpZiAo\nbGZnICE9IG51bGwpIHsgIAogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGlmICghX2xvYWRlZC5nZXQoaSkgJiYgKGkgPT0gZmllbGQKICAgICAg\nICAgICAgICAgICAgICB8fCBmbWRzW2ldLmlzSW5GZXRjaEdyb3VwKGxmZykp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBuZXcgQml0U2V0KGZt\nZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBmaWVsZHMuc2V0KGkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyByZWxhdGlvbiBmaWVsZCBpcyBsb2FkZWQgd2l0aCB0aGUgbG9hZC1m\nZXRjaC1ncm91cAogICAgICAgICAgICAvLyBidXQgdGhpcyBhZGRpdGlvbiBt\ndXN0IGJlIHJldmVydGVkIG9uY2UgdGhlIGxvYWQgaXMgb3ZlcgogICAgICAg\nICAgICBpZiAoIWZldGNoLmhhc0ZldGNoR3JvdXAobGZnKSkgewogICAgICAg\nICAgICAgICAgZmV0Y2guYWRkRmV0Y2hHcm91cChsZmcpOwogICAgICAgICAg\nICAgICAgbGZnQWRkZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlIGlmIChmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgJiYgZmll\nbGRzID09IG51bGwpIHsKICAgICAgICAgICAgLy8gbm8gbG9hZCBncm91cCBi\ndXQgZGZnOiBhZGQgZGZnIGZpZWxkcyBpZiB3ZSBoYXZlbid0IGFscmVhZHkK\nICAgICAgICAgICAgZmllbGRzID0gZ2V0VW5sb2FkZWRJbnRlcm5hbChmZXRj\naCwgTE9BRF9GR1MsIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAoIV9sb2Fk\nZWQuZ2V0KGZtZC5nZXRJbmRleCgpKSkgewogICAgICAgICAgICAvLyBubyBs\nb2FkIGdyb3VwIG9yIGRmZzogbG9hZCBpbmRpdmlkdWFsIGZpZWxkCiAgICAg\nICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZp\nZWxkcyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICAgICAgZmllbGRzLnNldChm\nbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjYWxsIHRo\naXMgbWV0aG9kIGV2ZW4gaWYgdGhlcmUgYXJlIG5vIHVubG9hZGVkIGZpZWxk\nczsgbG9hZEZpZWxkcwogICAgICAgIC8vIHRha2VzIGNhcmUgb2YgdGhpbmdz\nIGxpa2UgbG9hZGluZyB2ZXJzaW9uIGluZm8gYW5kIHNldHRpbmcgUEMgZmxh\nZ3MKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2FkRmllbGRzKGZpZWxk\ncywgZmV0Y2gsIGxvY2tMZXZlbCwgbnVsbCwgZm9yV3JpdGUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsZmdBZGRlZCkKICAgICAg\nICAgICAgICAgIGZldGNoLnJlbW92ZUZldGNoR3JvdXAobGZnKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHBy\nb3ZpZGUgdGhlIGdpdmVuIGZpZWxkIG51bWJlciB0byB0aGUgZ2l2ZW4KICAg\nICAqIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHZvaWQgcHJvdmlkZUZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgRmllbGRNYW5hZ2VyIHN0b3Jl\nLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1hbmFnZXIgYmVmb3JlRk0g\nPSBfZm07CiAgICAgICAgX2ZtID0gc3RvcmU7CiAgICAgICAgcGMucGNQcm92\naWRlRmllbGQoZmllbGQpOwogICAgICAgIC8vIFJldGFpbmluZyBvcmlnaW5h\nbCBGTSBiZWNhdXNlIG9mIHRoZSBwb3NzaWJpbGl0eSBvZiByZWVudHJhbnQg\nY2FsbHMKICAgICAgICBfZm0gPSBiZWZvcmVGTTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmVwbGFjZSB0aGUgZ2l2ZW4gZmll\nbGQgbnVtYmVyIHRvIHRoZSBnaXZlbgogICAgICogZmllbGQgbWFuYWdlci4K\nICAgICAqLwogICAgdm9pZCByZXBsYWNlRmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBGaWVsZE1hbmFnZXIgbG9hZCwgaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNYW5hZ2VyIGJlZm9yZUZNID0gX2ZtOwogICAgICAgIF9mbSA9\nIGxvYWQ7CiAgICAgICAgcGMucGNSZXBsYWNlRmllbGQoZmllbGQpOwogICAg\nICAgIC8vIFJldGFpbmluZyBvcmlnaW5hbCBGTSBiZWNhdXNlIG9mIHRoZSBw\nb3NzaWJpbGl0eSBvZiByZWVudHJhbnQgY2FsbHMKICAgICAgICBfZm0gPSBi\nZWZvcmVGTTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhlIGZpZWxk\nIGFzIGxvYWRlZCBvciB1bmxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHNldExvYWRlZChpbnQgZmllbGQsIGJvb2xlYW4gaXNMb2FkZWQpIHsK\nICAgICAgICAvLyBkb24ndCBjb250aW51ZSBpZiBsb2FkZWQgc3RhdGUgaXMg\nYWxyZWFkeSBjb3JyZWN0OyBvdGhlcndpc2Ugd2UKICAgICAgICAvLyBjYW4g\nZW5kIHVwIGNsZWFyaW5nIF9maWVsZEltcGwgd2hlbiB3ZSBzaG91bGRuJ3QK\nICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpID09IGlzTG9hZGVkKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIGxvYWRpbmcsIGNs\nZWFyIGludGVybWVkaWF0ZSBkYXRhOyBpZiB1bmxvYWRpbmcsIGNsZWFyIGlt\ncGwgZGF0YQogICAgICAgIGlmIChfZmllbGRJbXBsICE9IG51bGwpIHsKICAg\nICAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5k\nZXgoZmllbGQpOwogICAgICAgICAgICBpZiAoaWR4ICE9IC0xKQogICAgICAg\nICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIGlmIChpc0xvYWRlZCkKICAgICAgICAgICAgX2xvYWRlZC5zZXQo\nZmllbGQpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2xvYWRlZC5jbGVh\ncihmaWVsZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHBvc3Qt\nbG9hZCBzdGVwcywgaW5jbHVkaW5nIHRoZSBwb3N0IGxvYWQgY2FsbGJhY2su\nCiAgICAgKiBXZSBoYXZlIHRvIGNoZWNrIHRoZSBkZmcgYWZ0ZXIgYWxsIGZp\nZWxkIGxvYWRzIGJlY2F1c2UgaXQgbWlnaHQgYmUKICAgICAqIGxvYWRlZCBp\nbiBtdWx0aXBsZSBzdGVwcyB3aGVuIHBhZ2luZyBpcyBpbnZvbHZlZDsgdGhl\nIGluaXRpYWwgbG9hZAogICAgICogbWlnaHQgZXhjbHVkZSBzb21lIGZpZWxk\ncyB3aGljaCBhcmUgdGhlbiBpbW1lZGlhdGVseSBsb2FkZWQgaW4gYQogICAg\nICogc2VwYXJhdGUgc3RlcCBiZWZvcmUgYmVpbmcgcmV0dXJuZWQgdG8gdGhl\nIHVzZXIuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkIHRoZSBmaWVsZCBp\nbmRleCB0aGF0IHdhcyBsb2FkZWQsIG9yIC0xIHRvIGluZGljYXRlCiAgICAg\nKiB0aGF0IGEgZ3JvdXAgb2YgcG9zc2libHkgdW5rbm93biBmaWVsZHMgd2Fz\nIGxvYWRlZAogICAgICovCiAgICBwcml2YXRlIHZvaWQgcG9zdExvYWQoaW50\nIGZpZWxkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICAv\nLyBubyBuZWVkIGZvciBwb3N0TG9hZCBjYWxsYmFjaz8KICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfTE9BREVEKSAhPSAwKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGluIHRoZSBtaWRkbGUgb2YgYSBncm91cCBsb2Fk\nLCBhZnRlciB3aGljaCB0aGlzIG1ldGhvZCB3aWxsIGJlCiAgICAgICAgLy8g\nY2FsbGVkIGFnYWluPwogICAgICAgIGlmIChmaWVsZCAhPSAtMSAmJiBpc0xv\nYWRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBubyBs\naXN0ZW5lcnM/CiAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIG1nciA9\nIF9icm9rZXIuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VyKCk7CiAgICAgICAg\naWYgKG1nciA9PSBudWxsIHx8ICFtZ3IuaGFzTG9hZExpc3RlbmVycyhnZXRN\nYW5hZ2VkSW5zdGFuY2UoKSwgX21ldGEpKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRj\naCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\nLy8gaXMgdGhpcyBmaWVsZCBhIHBvc3QtbG9hZCBmaWVsZD8KICAgICAgICBp\nZiAoZmllbGQgIT0gLTEpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChm\nbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAgICAgICAm\nJiBmZXRjaC5oYXNGZXRjaEdyb3VwKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxU\nKQogICAgICAgICAgICAgICAgJiYgcG9zdExvYWQoRmV0Y2hHcm91cC5OQU1F\nX0RFRkFVTFQsIGZldGNoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgU3RyaW5nW10gZmdzID0gZm1kLmdldEN1c3RvbUZldGNoR3Jv\ndXBzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmdzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZldGNoLmhhc0ZldGNo\nR3JvdXAoZmdzW2ldKSAmJiBwb3N0TG9hZChmZ3NbaV0sIGZldGNoKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmZXRjaC5nZXRGZXRjaEdy\nb3VwcygpLml0ZXJhdG9yKCk7IAogICAgICAgICAgICAgICAgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIGlmIChwb3N0TG9hZCgoU3RyaW5n\nKSBpdHIubmV4dCgpLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGVyZm9ybSBwb3N0LWxvYWQgYWN0aW9ucyBpZiB0aGUgZ2l2ZW4g\nZmV0Y2ggZ3JvdXAgaXMgYSBwb3N0LWxvYWQgZ3JvdXAKICAgICAqIGFuZCBp\ncyBmdWxseSBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBw\nb3N0TG9hZChTdHJpbmcgZmdOYW1lLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gX21ldGEuZ2V0RmV0Y2hH\ncm91cChmZ05hbWUpOwogICAgICAgIGlmIChmZyA9PSBudWxsIHx8ICFmZy5p\nc1Bvc3RMb2FkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkgJiYgZm1kc1tpXS5p\nc0luRmV0Y2hHcm91cChmZ05hbWUpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICAg\nICAgX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCksIGZldGNoLCBfbWV0YSwgCiAgICAgICAgCUxpZmVjeWNsZUV2ZW50\nLkFGVEVSX0xPQUQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIC8qKgogICAgICogU3luY2hyb25pemUgb3VyIHZlcnNpb24gb2JqZWN0IHdp\ndGggdGhlIGRhdGFzdG9yZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHN5bmNWZXJzaW9uKE9iamVjdCBzZGF0YSkgewogICAgICAgIHJldHVybiBf\nYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLnN5bmNWZXJzaW9uKHRoaXMsIHNk\nYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0\naGlzIGluc3RhbmNlIG5lZWRzIGEgdmVyc2lvbiBjaGVjay4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCgpIHsK\nICAgICAgICAvLyBleHBsaWNpdCBmbGFnIGZvciB2ZXJzaW9uIGNoZWNrCiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1ZFUlNJT05fQ0hFQ0spICE9IDAp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBpZiAoIV9icm9r\nZXIuZ2V0T3B0aW1pc3RpYygpICYmICFfYnJva2VyLmdldENvbmZpZ3VyYXRp\nb24oKS4KICAgICAgICAgICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCku\nZ2V0Tm9uT3B0aW1pc3RpY1ZlcnNpb25DaGVjaygpKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1ZlcnNpb25D\naGVja1JlcXVpcmVkKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSByZXF1aXJlcyBhIHZlcnNpb24gY2hl\nY2sgb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8KICAgIHZvaWQgc2V0Q2hl\nY2tWZXJzaW9uKGJvb2xlYW4gdmVyc2lvbkNoZWNrKSB7CiAgICAgICAgaWYg\nKHZlcnNpb25DaGVjaykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfVkVS\nU0lPTl9DSEVDSzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19WRVJTSU9OX0NIRUNLOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgbmVlZHMgYSB2ZXJzaW9u\nIHVwZGF0ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9u\nVXBkYXRlUmVxdWlyZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBG\nTEFHX1ZFUlNJT05fVVBEQVRFKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJlcXVpcmVzIGEgdmVyc2lv\nbiB1cGRhdGUgb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8KICAgIHZvaWQg\nc2V0VXBkYXRlVmVyc2lvbihib29sZWFuIHZlcnNpb25VcGRhdGUpIHsKICAg\nICAgICBpZiAodmVyc2lvblVwZGF0ZSkKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfVkVSU0lPTl9VUERBVEU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9VUERBVEU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUcmFuc2xhdGUgdGhlIGdpdmVuIGV4Y2VwdGlvbiBiYXNl\nZCBvbiB0aGUgYnJva2VyJ3MgaW1wbGljaXQgYmVoYXZpb3IuCiAgICAgKiBU\ncmFuc2xhdGlvbiBvbmx5IG9jY3VycyBpZiB0aGUgZXhjZXB0aW9uIGlzIGlu\naXRpYXRlZCBieSBhIHVzZXIgYWN0aW9uCiAgICAgKiBvbiBhbiBpbnN0YW5j\nZSwgYW5kIHRoZXJlZm9yZSB3aWxsIG5vdCBiZSBjYXVnaHQgYW5kIHRyYW5z\nbGF0ZWQgYnkgdGhlCiAgICAgKiBicm9rZXIuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBSdW50aW1lRXhjZXB0aW9uIHRyYW5zbGF0ZShSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3Ig\ndHJhbnMgPSBfYnJva2VyLgogICAgICAgICAgICBnZXRJbnN0YW5jZUV4Y2Vw\ndGlvblRyYW5zbGF0b3IoKTsKICAgICAgICByZXR1cm4gKHRyYW5zID09IG51\nbGwpID8gcmUgOiB0cmFucy50cmFuc2xhdGUocmUpOwogICAgfQoKICAgIC8q\nKgogICAgICogTG9jayB0aGUgc3RhdGUgbWFuYWdlciBpZiB0aGUgbXVsdGl0\naHJlYWRlZCBvcHRpb24gaXMgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBsb2NrKCkgewogICAgICAgIC8vIHVzZSBicm9rZXItbGV2ZWwgbG9j\nayB0byBhdm9pZCBkZWFkbG9jayBzaXR1YXRpb25zIHdpdGggdGhlIHN0YXRl\nCiAgICAgICAgLy8gbWFuYWdlciBsb2NrIGFuZCBicm9rZXIgbG9jayBiZWlu\nZyBvYnRhaW5lZCBpbiBkaWZmZXJlbnQgb3JkZXJzCiAgICAgICAgX2Jyb2tl\nci5sb2NrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVbmxvY2sgdGhlIHN0\nYXRlIG1hbmFnZXIuCiAgICAgKi8KCXByb3RlY3RlZCB2b2lkIHVubG9jayAo\nKQoJewoJCS8vIHVzZSBicm9rZXItbGV2ZWwgbG9jayB0byBhdm9pZCBkZWFk\nbG9jayBzaXR1YXRpb25zIHdpdGggdGhlIHN0YXRlIAoJCS8vIG1hbmFnZXIg\nbG9jayBhbmQgYnJva2VyIGxvY2sgYmVpbmcgb2J0YWluZWQgaW4gZGlmZmVy\nZW50IG9yZGVycwoJCV9icm9rZXIudW5sb2NrICgpOwoJfQp9Cg==\n","encoding":"base64"}

