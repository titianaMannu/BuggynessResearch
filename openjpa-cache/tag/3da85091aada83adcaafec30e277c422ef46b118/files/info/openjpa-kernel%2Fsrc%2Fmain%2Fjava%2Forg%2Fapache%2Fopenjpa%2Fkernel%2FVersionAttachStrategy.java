{"sha":"735a3e14c129adee66e0b69a31aa61b318562cf2","node_id":"MDQ6QmxvYjIwNjM2NDo3MzVhM2UxNGMxMjlhZGVlNjZlMGI2OWEzMWFhNjFiMzE4NTYyY2Yy","size":13059,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/735a3e14c129adee66e0b69a31aa61b318562cf2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0\naWNFeGNlcHRpb247CgovKioKICogSGFuZGxlcyBhdHRhY2hpbmcgaW5zdGFu\nY2VzIHVzaW5nIHZlcnNpb24gYW5kIHByaW1hcnkga2V5IGZpZWxkcy4KICoK\nICogQG5vamF2YWRvYwogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKi8KY2xhc3Mg\nVmVyc2lvbkF0dGFjaFN0cmF0ZWd5CiAgICBleHRlbmRzIEF0dGFjaFN0cmF0\nZWd5CiAgICBpbXBsZW1lbnRzIERldGFjaFN0YXRlIHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQ\nYWNrYWdlCiAgICAgICAgKFZlcnNpb25BdHRhY2hTdHJhdGVneS5jbGFzcyk7\nCgogICAgcHJvdGVjdGVkIE9iamVjdCBnZXREZXRhY2hlZE9iamVjdElkKEF0\ndGFjaE1hbmFnZXIgbWFuYWdlciwKICAgICAgICBPYmplY3QgdG9BdHRhY2gp\nIHsKICAgICAgICBCcm9rZXIgYnJva2VyID0gbWFuYWdlci5nZXRCcm9rZXIo\nKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBicm9rZXIuZ2V0Q29u\nZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpLmdldE1ldGFEYXRhKHRvQXR0YWNoLmdldENsYXNzKCks\nCiAgICAgICAgICAgIGJyb2tlci5nZXRDbGFzc0xvYWRlcigpLCB0cnVlKTsK\nICAgICAgICByZXR1cm4gQXBwbGljYXRpb25JZHMuY3JlYXRlKChQZXJzaXN0\nZW5jZUNhcGFibGUpIHRvQXR0YWNoLCBtZXRhKTsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgdm9pZCBwcm92aWRlRmllbGQoT2JqZWN0IHRvQXR0YWNoLCBTdGF0\nZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIGludCBmaWVsZCkgewogICAgICAg\nIHNtLnByb3ZpZGVGaWVsZCgoUGVyc2lzdGVuY2VDYXBhYmxlKSB0b0F0dGFj\naCwgdGhpcywgZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgYXR0\nYWNoKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0IHRvQXR0YWNoLAog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSwgUGVyc2lzdGVuY2VDYXBhYmxl\nIGludG8sIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIsCiAgICAgICAgVmFs\ndWVNZXRhRGF0YSBvd25lck1ldGEsIGJvb2xlYW4gZXhwbGljaXQpIHsKICAg\nICAgICBCcm9rZXJJbXBsIGJyb2tlciA9IG1hbmFnZXIuZ2V0QnJva2VyKCk7\nCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gKFBlcnNpc3RlbmNl\nQ2FwYWJsZSkgdG9BdHRhY2g7CgogICAgICAgIGJvb2xlYW4gZW1iZWRkZWQg\nPSBvd25lck1ldGEgIT0gbnVsbCAmJiBvd25lck1ldGEuaXNFbWJlZGRlZFBD\nKCk7CiAgICAgICAgYm9vbGVhbiBpc05ldyA9ICFicm9rZXIuaXNEZXRhY2hl\nZChwYyk7CiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBudWxsOwogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBudWxsOwoKICAgICAgICAvLyBpZiB0\naGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGVtYmVkZGVkIGluc3RhbmNlIGlz\nIG51bGwsIHRoZW4KICAgICAgICAvLyBpdCBzaG91bGQgYmUgdHJlYXRlZCBh\ncyBhIG5ldyBpbnN0YW5jZSAoc2luY2UgdGhlCiAgICAgICAgLy8gbmV3bHkg\ncGVyc2lzdGVkIG93bmVyIG1heSBjcmVhdGUgYSBuZXcgZW1iZWRkZWQgaW5z\ndGFuY2UKICAgICAgICAvLyBpbiB0aGUgY29uc3RydWN0b3IpOyBmaXhlZCBi\ndWcgIzEwNzUuCiAgICAgICAgLy8gYWxzbywgaWYgdGhlIHVzZXIgaGFzIGF0\ndGFjaGVkIGEgZGV0YWNoZWQgb2JqIGZyb20gc29tZXdoZXJlCiAgICAgICAg\nLy8gZWxzZSBpbiB0aGUgZ3JhcGggdG8gYW4gZW1iZWRkZWQgZmllbGQgdGhh\ndCB3YXMgcHJldmlvdXNseSBudWxsLAogICAgICAgIC8vIGNvcHkgaW50byBh\nIG5ldyBlbWJlZGRlZCBpbnN0YW5jZQogICAgICAgIGlmIChlbWJlZGRlZCAm\nJiAoaXNOZXcgfHwgaW50byA9PSBudWxsCiAgICAgICAgICAgIHx8IGJyb2tl\nci5nZXRTdGF0ZU1hbmFnZXIoaW50bykgPT0gbnVsbCkpIHsKICAgICAgICAg\nICAgaWYgKGludG8gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGludG8gPSBw\nYy5wY05ld0luc3RhbmNlKG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgc20g\nPSAoU3RhdGVNYW5hZ2VySW1wbCkgYnJva2VyLmVtYmVkKGludG8sIG51bGws\nIG93bmVyLCBvd25lck1ldGEpOwogICAgICAgICAgICBpbnRvID0gc20uZ2V0\nUGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgfSBlbHNlIGlmIChpc05l\ndykgewogICAgICAgICAgICBzbSA9IHBlcnNpc3QobWFuYWdlciwgcGMsIG1l\ndGEsIEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywgbWV0YSksCiAgICAgICAg\nICAgICAgICBleHBsaWNpdCk7CiAgICAgICAgICAgIGludG8gPSBzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICB9IGVsc2UgaWYgKCFlbWJl\nZGRlZCAmJiBpbnRvID09IG51bGwpIHsKICAgICAgICAgICAgT2JqZWN0IGlk\nID0gZ2V0RGV0YWNoZWRPYmplY3RJZChtYW5hZ2VyLCB0b0F0dGFjaCk7CiAg\nICAgICAgICAgIGlmIChpZCAhPSBudWxsKQogICAgICAgICAgICAgICAgaW50\nbyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIGJyb2tlci5maW5kKGlkLCB0cnVl\nLCBudWxsKTsKICAgICAgICAgICAgaWYgKGludG8gPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBPcHRpbWlzdGljRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJhdHRhY2gtdmVyc2lvbi1kZWwiLAogICAgICAgICAgICAgICAgICAg\nIHBjLmdldENsYXNzKCksIGlkLCB2ZXJzaW9uKSkuc2V0RmFpbGVkT2JqZWN0\nKHRvQXR0YWNoKTsKCiAgICAgICAgICAgIHNtID0gbWFuYWdlci5hc3NlcnRN\nYW5hZ2VkKGludG8pOwogICAgICAgICAgICBpZiAobWV0YS5nZXREZXNjcmli\nZWRUeXBlKCkKICAgICAgICAgICAgICAgICE9IHNtLmdldE1ldGFEYXRhKCku\nZ2V0RGVzY3JpYmVkVHlwZSgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICAgICAoImF0dGFjaC13cm9uZ2NsYXNzIiwgaWQsIHRvQXR0YWNo\nLmdldENsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAgICAgICAgICAgICAg\nICAgICAgc2V0RmFpbGVkT2JqZWN0KHRvQXR0YWNoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZQogICAgICAgICAgICBzbSA9IG1hbmFnZXIuYXNz\nZXJ0TWFuYWdlZChpbnRvKTsKCiAgICAgICAgLy8gbWFyayB0aGF0IHdlIGF0\ndGFjaGVkIHRoZSBpbnN0YW5jZSAqYmVmb3JlKiB3ZQogICAgICAgIC8vIGZp\nbGwgaW4gdmFsdWVzIHRvIGF2b2lkIGVuZGxlc3MgcmVjdXJzaW9uCiAgICAg\nICAgbWFuYWdlci5zZXRBdHRhY2hlZENvcHkodG9BdHRhY2gsIGludG8pOwoK\nICAgICAgICAvLyBpZiBwZXJzaXN0aW5nIGluIHBsYWNlLCBqdXN0IGF0dGFj\naCBmaWVsZCB2YWx1ZXMKICAgICAgICBpZiAocGMgPT0gaW50bykgewogICAg\nICAgICAgICBhdHRhY2hGaWVsZHNJblBsYWNlKG1hbmFnZXIsIHNtKTsKICAg\nICAgICAgICAgcmV0dXJuIGludG87CiAgICAgICAgfQoKICAgICAgICAvLyBp\nbnZva2UgYW55IHByZUF0dGFjaCBvbiB0aGUgZGV0YWNoZWQgaW5zdGFuY2UK\nICAgICAgICBtYW5hZ2VyLmZpcmVCZWZvcmVBdHRhY2godG9BdHRhY2gsIG1l\ndGEpOwoKICAgICAgICAvLyBhc3NpZ24gdGhlIGRldGFjaGVkIHBjIHRoZSBz\nYW1lIHN0YXRlIG1hbmFnZXIgYXMgdGhlIG9iamVjdCB3ZSdyZQogICAgICAg\nIC8vIGNvcHlpbmcgaW50byBkdXJpbmcgdGhlIGF0dGFjaCBwcm9jZXNzCiAg\nICAgICAgU3RhdGVNYW5hZ2VyIHNtQmVmb3JlID0gcGMucGNHZXRTdGF0ZU1h\nbmFnZXIoKTsKICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc20p\nOwogICAgICAgIGludCBkZXRhY2ggPSAoaXNOZXcpID8gREVUQUNIX0FMTCA6\nIGJyb2tlci5nZXREZXRhY2hTdGF0ZSgpOwogICAgICAgIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IG1ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgc3dpdGNoIChkZXRhY2gpIHsKICAgICAgICAgICAgICAgICAgICBjYXNl\nIERFVEFDSF9BTEw6CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaEZp\nZWxkKG1hbmFnZXIsIHRvQXR0YWNoLCBzbSwgZm1kc1tpXSwgdHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgIGNhc2UgREVUQUNIX0ZHUzoKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGZldGNoLnJlcXVpcmVzRmV0Y2goZm1kc1tpXSkgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hf\nTk9ORSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaEZpZWxk\nKG1hbmFnZXIsIHRvQXR0YWNoLCBzbSwgZm1kc1tpXSwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIGNhc2UgREVUQUNIX0xPQURFRDoKICAgICAgICAgICAgICAgICAgICAgICAg\nYXR0YWNoRmllbGQobWFuYWdlciwgdG9BdHRhY2gsIHNtLCBmbWRzW2ldLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtQmVmb3Jl\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlbWJlZGRlZCAmJiAhaXNOZXcp\nCiAgICAgICAgICAgIGNvbXBhcmVWZXJzaW9uKHNtLCBwYyk7CiAgICAgICAg\ncmV0dXJuIGludG87CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUg\ndGhlIHZlcnNpb24gaW5mb3JtYXRpb24gaXMgY29ycmVjdCBpbiB0aGUgZGV0\nYWNoZWQgb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29tcGFy\nZVZlcnNpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSwgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjKSB7CiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBwYy5wY0dldFZl\ncnNpb24oKTsKICAgICAgICBpZiAodmVyc2lvbiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIGRvbid0IG5lZWQgdG8gbG9hZCB1\nbmxvYWRlZCBmaWVsZHMgc2luY2UgaXRzIGltcGxpY2l0bHkKICAgICAgICAv\nLyBhIHNpbmdsZSBmaWVsZCB2YWx1ZQogICAgICAgIFN0b3JlTWFuYWdlciBz\ndG9yZSA9IHNtLmdldEJyb2tlcigpLmdldFN0b3JlTWFuYWdlcigpOwogICAg\nICAgIHN3aXRjaCAoc3RvcmUuY29tcGFyZVZlcnNpb24oc20sIHZlcnNpb24s\nIHNtLmdldFZlcnNpb24oKSkpIHsKICAgICAgICAgICAgY2FzZSBTdG9yZU1h\nbmFnZXIuVkVSU0lPTl9MQVRFUjoKICAgICAgICAgICAgICAgIC8vIHdlIGhh\ndmUgYSBsYXRlciB2ZXJzaW9uOiBzZXQgaXQgaW50byB0aGUgb2JqZWN0Lgog\nICAgICAgICAgICAgICAgLy8gbG9jayB2YWxpZGF0aW9uIHdpbGwgb2NjdXIg\nYXQgY29tbWl0IHRpbWUKICAgICAgICAgICAgICAgIHNtLnNldFZlcnNpb24o\ndmVyc2lvbik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBTdG9yZU1hbmFnZXIuVkVSU0lPTl9FQVJMSUVSOgogICAgICAgICAg\nICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVOVDoKICAgICAg\nICAgICAgICAgIHNtLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2Vy\nLlZFUlNJT05fU0FNRToKICAgICAgICAgICAgICAgIC8vIG5vIGFjdGlvbiBy\nZXF1aXJlZAogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBmaWVsZHMgb2YgYW4gaW4t\ncGxhY2UgcGVyc2lzdGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYXR0YWNoRmllbGRzSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFn\nZXIsCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVs\nZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVu\ndCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIE9iamVjdCBjdXIs\nIGF0dGFjaGVkOwogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5QQzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VO\nVFlQRUQ6CiAgICAgICAgICAgICAgICAgICAgY3VyID0gc20uZmV0Y2hPYmpl\nY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgICAgICBhdHRhY2hlZCA9IGF0\ndGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZHNbaV0sIGN1cik7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgICAgICBpZiAoIWZtZHNb\naV0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAg\nY3VyID0gc20uZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAg\nICAgICBhdHRhY2hlZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFj\naEluUGxhY2UobWFuYWdlciwgc20sIGZtZHNbaV0sIChPYmplY3RbXSkgY3Vy\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFmbWRzW2ldLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBD\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgICAgIGN1ciA9IHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAg\nICAgICAgICAgICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1h\nbmFnZXIsIHNtLCBmbWRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAo\nQ29sbGVjdGlvbikgY3VyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0RWxlbWVudCgpLmlzRGVjbGFy\nZWRUeXBlUEMoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhZm1kc1tp\nXS5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGN1ciA9\nIHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICAgICAg\nYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWRzW2ld\nLCAoTWFwKSBjdXIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1ciAhPSBh\ndHRhY2hlZCkKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVs\nZChzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwgaSwKICAgICAgICAgICAg\nICAgICAgICBjdXIsIGF0dGFjaGVkLCBTdGF0ZU1hbmFnZXIuU0VUX1JFTU9U\nRSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRo\nZSBnaXZlbiBwYy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgYXR0YWNo\nSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIFN0YXRlTWFuYWdlcklt\ncGwgc20sCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBwYykg\newogICAgICAgIGlmIChwYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBPYmplY3QgYXR0YWNoZWQgPSBtYW5hZ2VyLmdldEF0\ndGFjaGVkQ29weShwYyk7CiAgICAgICAgaWYgKGF0dGFjaGVkICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBhdHRhY2hlZDsKCiAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBpbnRvID0gbWFuYWdlci5nZXRCcm9rZXIoKS5nZXRT\ndGF0ZU1hbmFnZXIocGMpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBp\nbnRvUEMgPSAoaW50byA9PSBudWxsKSA/IG51bGwKICAgICAgICAgICAgOiBp\nbnRvLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIGlmICh2bWQu\naXNFbWJlZGRlZCgpKQogICAgICAgICAgICByZXR1cm4gbWFuYWdlci5hdHRh\nY2gocGMsIGludG9QQywgc20sIHZtZCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiBtYW5hZ2VyLmF0dGFjaChwYywgaW50b1BDLCBudWxsLCBudWxsLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGdpdmVuIGFy\ncmF5LgogICAgICovCiAgICBwcml2YXRlIE9iamVjdFtdIGF0dGFjaEluUGxh\nY2UoQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNt\nLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kLCBPYmplY3RbXSBhcnIpIHsK\nICAgICAgICBpZiAoYXJyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgYXJyW2ldID0gYXR0YWNoSW5QbGFjZShtYW5h\nZ2VyLCBzbSwgZm1kLmdldEVsZW1lbnQoKSwgYXJyW2ldKTsKICAgICAgICBy\nZXR1cm4gYXJyOwogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBn\naXZlbiBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rp\nb24gYXR0YWNoSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSwgRmllbGRNZXRhRGF0YSBmbWQsIENv\nbGxlY3Rpb24gY29sbCkgewogICAgICAgIGlmIChjb2xsID09IG51bGwgfHwg\nY29sbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBjb2xsOwoKICAg\nICAgICAvLyBjb3B5IGlmIGVsZW1lbnRzIGVtYmVkZGVkIG9yIGNvbnRhaW5z\nIGRldGFjaGVkLCB3aGljaCB3aWxsIG1lYW4KICAgICAgICAvLyB3ZSdsbCBo\nYXZlIHRvIGNvcHkgdGhlIGV4aXN0aW5nIGVsZW1lbnRzCiAgICAgICAgQ29s\nbGVjdGlvbiBjb3B5ID0gbnVsbDsKICAgICAgICBpZiAoZm1kLmdldEVsZW1l\nbnQoKS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVj\ndGlvbikgc20ubmV3RmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29s\nbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgaWYgKG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZChpdHIubmV4\ndCgpKSkgewogICAgICAgICAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlv\nbikgc20ubmV3RmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIE9iamVjdCBhdHRhY2hlZDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJ\nblBsYWNlKG1hbmFnZXIsIHNtLCBmbWQuZ2V0RWxlbWVudCgpLAogICAgICAg\nICAgICAgICAgaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBjb3B5LmFkZChhdHRhY2hlZCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IGNvbGwg\nOiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZl\nbiBtYXAuCiAgICAgKi8KICAgIHByaXZhdGUgTWFwIGF0dGFjaEluUGxhY2Uo\nQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kLCBNYXAgbWFwKSB7CiAgICAgICAg\naWYgKG1hcCA9PSBudWxsIHx8IG1hcC5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBtYXA7CgogICAgICAgIE1hcCBjb3B5ID0gbnVsbDsKICAgICAg\nICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgYm9vbGVhbiBrZXlQQyA9IGZt\nZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgYm9vbGVh\nbiB2YWxQQyA9IGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygp\nOwoKICAgICAgICAvLyBjb3B5IGlmIGVtYmVkZGVkIHBjcyBvciBkZXRhY2hl\nZCBwY3MsIHdoaWNoIHdpbGwgcmVxdWlyZSB1cyB0bwogICAgICAgIC8vIGNv\ncHkgZWxlbWVudHMKICAgICAgICBpZiAoZm1kLmdldEtleSgpLmlzRW1iZWRk\nZWRQQygpIHx8IGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRlZFBDKCkpCiAg\nICAgICAgICAgIGNvcHkgPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5n\nZXRJbmRleCgpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVu\ndHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKChrZXlQQyAm\nJiBtYW5hZ2VyLmdldEJyb2tlcigpLmlzRGV0YWNoZWQoZW50cnkuZ2V0S2V5\nKCkpKQogICAgICAgICAgICAgICAgICAgIHx8ICh2YWxQQyAmJiBtYW5hZ2Vy\nLmdldEJyb2tlcigpLmlzRGV0YWNoZWQKICAgICAgICAgICAgICAgICAgICAo\nZW50cnkuZ2V0VmFsdWUoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29w\neSA9IChNYXApIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBPYmplY3Qga2V5LCB2\nYWw7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQo\nKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBl\nbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGtl\neSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICBpZiAoa2V5UEMpCiAg\nICAgICAgICAgICAgICBrZXkgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNt\nLCBmbWQuZ2V0S2V5KCksIGtleSk7CiAgICAgICAgICAgIHZhbCA9IGVudHJ5\nLmdldFZhbHVlKCk7CiAgICAgICAgICAgIGlmICh2YWxQQykKICAgICAgICAg\nICAgICAgIHZhbCA9IGF0dGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZC5n\nZXRFbGVtZW50KCksIHZhbCk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBjb3B5LnB1dChrZXksIHZhbCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IG1hcCA6IGNv\ncHk7Cgl9Cn0K\n","encoding":"base64"}

