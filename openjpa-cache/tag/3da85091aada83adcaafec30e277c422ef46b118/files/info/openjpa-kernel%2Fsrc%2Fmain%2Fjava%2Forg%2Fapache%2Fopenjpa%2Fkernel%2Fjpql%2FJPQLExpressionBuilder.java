{"sha":"2ba8530dd8ef687ccaee13002a12424d33f7ebbe","node_id":"MDQ6QmxvYjIwNjM2NDoyYmE4NTMwZGQ4ZWY2ODdjY2FlZTEzMDAyYTEyNDI0ZDMzZjdlYmJl","size":58962,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2ba8530dd8ef687ccaee13002a12424d33f7ebbe","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1w\nb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlDb250ZXh0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWJz\ndHJhY3RFeHByZXNzaW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25GYWN0b3J5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkxpdGVyYWw7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGFyYW1ldGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlF\neHByZXNzaW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nZXhwcy5TdWJxdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBCdWlsZGVyIGZvciBKUFFMIGV4cHJlc3Np\nb25zLiBUaGlzIGNsYXNzIHRha2VzIHRoZSBxdWVyeSBwYXJzZWQKICogaW4g\ne0BsaW5rIEpQUUx9IGFuZCBjb252ZXJ0cyBpdCB0byBhbiBleHByZXNzaW9u\nIHRyZWUgdXNpbmcKICogYW4ge0BsaW5rIEV4cHJlc3Npb25GYWN0b3J5fS4g\nUHVibGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAqCiAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgUGF0cmljayBMaW5z\na2V5CiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXIKICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNzaW9uQnVp\nbGRlcgogICAgaW1wbGVtZW50cyBKUFFMVHJlZUNvbnN0YW50cyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFZBUl9QQVRIID0gMTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBWQVJfRVJST1IgPSAyOwoKICAgIHBy\naXZhdGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoSlBRTEV4cHJlc3Npb25CdWlsZGVyLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0YWNrIGNvbnRleHRzID0gbmV3IFN0YWNr\nKCk7CiAgICBwcml2YXRlIExpbmtlZE1hcCBwYXJhbWV0ZXJUeXBlczsKICAg\nIHByaXZhdGUgaW50IGFsaWFzQ291bnQgPSAwOwoKICAgIC8qKgogICAgICog\nQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhl\nIGV4cHJlc3Npb24gZmFjdG9yeSB0byB1c2UKICAgICAqIEBwYXJhbSBxdWVy\neSB1c2VkIHRvIHJlc29sdmUgdmFyaWFibGVzLCBwYXJhbWV0ZXJzLAogICAg\nICogYW5kIGNsYXNzIG5hbWVzIHVzZWQgaW4gdGhlIHF1ZXJ5CiAgICAgKiBA\ncGFyYW0gcGFyc2VkUXVlcnkgdGhlIHBhcnNlZCBxdWVyeQogICAgICovCiAg\nICBwdWJsaWMgSlBRTEV4cHJlc3Npb25CdWlsZGVyKEV4cHJlc3Npb25GYWN0\nb3J5IGZhY3RvcnksCiAgICAgICAgRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVl\ncnksIE9iamVjdCBwYXJzZWRRdWVyeSkgewogICAgICAgIHN1cGVyKGZhY3Rv\ncnksIHF1ZXJ5LmdldFJlc29sdmVyKCkpOwoKICAgICAgICBjb250ZXh0cy5w\ndXNoKG5ldyBDb250ZXh0KHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgUGFyc2Vk\nSlBRTAogICAgICAgICAgICA/IChQYXJzZWRKUFFMKSBwYXJzZWRRdWVyeQog\nICAgICAgICAgICA6IHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5nCiAg\nICAgICAgICAgID8gZ2V0UGFyc2VkUXVlcnkoKFN0cmluZykgcGFyc2VkUXVl\ncnkpCiAgICAgICAgICAgIDogbnVsbCwgbnVsbCkpOwoKICAgICAgICBpZiAo\nY3R4KCkucGFyc2VkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbihwYXJzZWRRdWVyeSArICIiKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgTG9jYWxpemVyIGdldExvY2FsaXplcigpIHsKICAgICAg\nICByZXR1cm4gX2xvYzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NMb2Fk\nZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgcmVz\nb2x2ZSBpbiB0aGUgY29udGV4dCBvZiBhbnl0aGluZyBidXQgb3Vyc2VsdmVz\nCiAgICAgICAgcmV0dXJuIGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgUGFyc2VkSlBRTCBnZXRQYXJzZWRRdWVy\neSgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFyc2VkOwogICAgfQoKICAg\nIHByb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KFN0cmluZyBq\ncHFsKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZWRKUFFMKGpwcWwpOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRDYW5kaWRhdGUoQ2xhc3NNZXRh\nRGF0YSBjbWQsIFN0cmluZyBzY2hlbWFBbGlhcykgewogICAgICAgIGFkZEFj\nY2Vzc1BhdGgoY21kKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICBjdHgoKS5tZXRhID0gY21kOwoKICAgICAgICBpZiAoc2NoZW1h\nQWxpYXMgIT0gbnVsbCkKICAgICAgICAgICAgY3R4KCkuc2NoZW1hQWxpYXMg\nPSBzY2hlbWFBbGlhczsKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBuZXh0\nQWxpYXMoKSB7CiAgICAgICAgcmV0dXJuICJqcHFsYWxpYXMiICsgKCsrYWxp\nYXNDb3VudCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEg\ncmVzb2x2ZUNsYXNzTWV0YURhdGEoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIC8vIGhhbmRsZSBsb29raW5nIHVwIGFsaWFzIG5hbWVzCiAgICAgICAgU3Ry\naW5nIHNjaGVtYU5hbWUgPSBhc3NlcnRTY2hlbWFOYW1lKG5vZGUpOwogICAg\nICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0Q2xhc3NNZXRhRGF0YShzY2hl\nbWFOYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyB3ZSBtaWdodCBiZSBy\nZWZlcmVuY2luZyBhIGNvbGxlY3Rpb24gZmllbGQgb2YgYSBzdWJxdWVyeSdz\nIHBhcmVudAogICAgICAgIGlmIChpc1BhdGgobm9kZSkpIHsKICAgICAgICAg\nICAgUGF0aCBwYXRoID0gZ2V0UGF0aChub2RlKTsKICAgICAgICAgICAgcmV0\ndXJuIGdldEZpZWxkVHlwZShwYXRoLmxhc3QoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBub3cgcnVuIGFnYWluIHRvIHRocm93IHRoZSBjb3JyZWN0IGV4\nY2VwdGlvbgogICAgICAgIHJldHVybiBnZXRDbGFzc01ldGFEYXRhKHNjaGVt\nYU5hbWUsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYSBnZXRDbGFzc01ldGFEYXRhKFN0cmluZyBhbGlhcywgYm9vbGVhbiBhc3Nl\ncnRWYWxpZCkgewogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGdldENs\nYXNzTG9hZGVyKCk7CiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nID0gcmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBn\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwoKICAgICAgICAvLyBm\naXJzdCBjaGVjayBmb3IgdGhlIGFsaWFzCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9hZGVyLCBmYWxz\nZSk7CgogICAgICAgIGlmIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGNtZDsKCiAgICAgICAgLy8gbm93IGNoZWNrIGZvciB0aGUgY2xhc3Mg\nbmFtZTsgdGhpcyBpcyBub3QgdGVjaG5pY2FsbHkgcGVybWl0dGVkCiAgICAg\nICAgLy8gYnkgdGhlIEpQQSBzcGVjLCBidXQgaXMgcmVxdWlyZWQgaW4gb3Jk\nZXIgdG8gYmUgYWJsZSB0byBleGVjdXRlCiAgICAgICAgLy8gSlBRTCBxdWVy\naWVzIGZyb20gb3RoZXIgZmFjYWRlcyAobGlrZSBKRE8pIHRoYXQgZG8gbm90\nIGhhdmUKICAgICAgICAvLyB0aGUgY29uY2VwdCBvZiBlbnRpdHkgbmFtZXMg\nb3IgYWxpYXNlcwogICAgICAgIENsYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUoYWxpYXMsIG51bGwpOwogICAgICAgIGlmIChjICE9IG51bGwpCiAg\nICAgICAgICAgIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRhKGMsIGxvYWRlciwg\nYXNzZXJ0VmFsaWQpOwogICAgICAgIGVsc2UgaWYgKGFzc2VydFZhbGlkKQog\nICAgICAgICAgICBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9h\nZGVyLCB0cnVlKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGFzc2Vy\ndFZhbGlkKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgYWxpYXMgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBjbWQ7\nCiAgICB9CgogICAgcHJpdmF0ZSBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkg\newogICAgICAgIHJldHVybiBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKGN0eCgp\nLm1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGN0eCgpLm1ldGE7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgY2xzID0gZ2V0Q2FuZGlkYXRlTWV0\nYURhdGEocm9vdCgpKTsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2No\nZW1hLW5hbWUiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290\nKCkgfSwgbnVsbCk7CgogICAgICAgIHNldENhbmRpZGF0ZShjbHMsIG51bGwp\nOwogICAgICAgIHJldHVybiBjbHM7CiAgICB9CgogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIC8vIGV4YW1pbmcgdGhlIG5vZGUgdG8gZmluZCB0aGUg\nY2FuZGlkYXRlIHF1ZXJ5CiAgICAgICAgLy8gIyMjIHRoaXMgc2hvdWxkIGFj\ndHVhbGx5IGJlIHRoZSBwcmltYXJ5IFNFTEVDVCBpbnN0YW5jZQogICAgICAg\nIC8vIHJlc29sdmVkIGFnYWluc3QgdGhlIGZyb20gdmFyaWFibGUgZGVjbGFy\nYXRpb25zCiAgICAgICAgSlBRTE5vZGUgZnJvbSA9IG5vZGUuZmluZENoaWxk\nQnlJRChKSlRGUk9NSVRFTSwgdHJ1ZSk7CiAgICAgICAgaWYgKGZyb20gPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBPUEVOSlBBLTE1IGFsbG93IHN1YnF1\nZXJ5IHdpdGhvdXQgYSBGUk9NSVRFTQogICAgICAgICAgICBpZiAobm9kZS5p\nZCA9PSBKSlRTVUJTRUxFQ1QpIHsgCiAgICAgICAgICAgICAgICBmcm9tID0g\nbm9kZS5maW5kQ2hpbGRCeUlEKEpKVEZST00sIHRydWUpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZyb20tY2xhdXNlIiwgbnVs\nbCwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZnJvbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBKUFFMTm9kZSBuID0gZnJvbS5jaGlsZHJlbltpXTsK\nCiAgICAgICAgICAgIGlmIChuLmlkID09IEpKVEFCU1RSQUNUU0NIRU1BTkFN\nRSkgewogICAgICAgICAgICAgICAgLy8gd2Ugc2ltcGx5IHJldHVybiB0aGUg\nZmlyc3QgYWJzdHJhY3Qgc2NoZW1hIGNoaWxkCiAgICAgICAgICAgICAgICAv\nLyBhcyByZXNvbHZlZCBpbnRvIGEgY2xhc3MKICAgICAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgY21kID0gcmVzb2x2ZUNsYXNzTWV0YURhdGEobik7Cgog\nICAgICAgICAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgICAgICAgICAgLy8gbm90IGEg\nc2NoZW1hOiB0cmVhdCBpdCBhcyBhIGNsYXNzCiAgICAgICAgICAgICAgICBT\ndHJpbmcgY2xzID0gYXNzZXJ0U2NoZW1hTmFtZShuKTsKICAgICAgICAgICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290KCkg\nfSwgbnVsbCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGdldENsYXNzTWV0\nYURhdGEoY2xzLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBPUEVOSlBBLTE1IHN1cHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBk\nbyBub3Qgc3RhcnQgd2l0aCAKICAgICAgICAgICAgLy8gaWRlbnRpZmljYXRp\nb25fdmFyaWFibGVfZGVjbGFyYXRpb24oKQogICAgICAgICAgICBpZiAobm9k\nZS5pZCA9PSBKSlRTVUJTRUxFQ1QpIHsKICAgICAgICAgICAgICAgIGlmIChu\nLmlkID09IEpKVElOTkVSSk9JTikgewogICAgICAgICAgICAgICAgICAgIG4g\nPSBuLmdldENoaWxkKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKG4uaWQgPT0gSkpUUEFUSCkgewogICAgICAgICAgICAgICAg\nICAgIFBhdGggcGF0aCA9IGdldFBhdGgobik7CiAgICAgICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRGaWVsZFR5cGUocGF0aC5sYXN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChjbWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21kOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNF\nUiwgIm5vLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBuIH0sIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAgICAg\nICAgCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIGN1cnJlbnRRdWVyeSgpIHsKICAgICAgICBy\nZXR1cm4gY3R4KCkucGFyc2VkID09IG51bGwgfHwgcm9vdCgpLnBhcnNlciA9\nPSBudWxsID8gbnVsbAogICAgICAgICAgICA6IHJvb3QoKS5wYXJzZXIuanBx\nbDsKICAgIH0KCiAgICBRdWVyeUV4cHJlc3Npb25zIGdldFF1ZXJ5RXhwcmVz\nc2lvbnMoKSB7CiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBzID0gbmV3\nIFF1ZXJ5RXhwcmVzc2lvbnMoKTsKCiAgICAgICAgZXZhbFF1ZXJ5T3BlcmF0\naW9uKGV4cHMpOwoKICAgICAgICBFeHByZXNzaW9uIGZpbHRlciA9IG51bGw7\nCiAgICAgICAgZmlsdGVyID0gYW5kKGV2YWxGcm9tQ2xhdXNlKHJvb3QoKS5p\nZCA9PSBKSlRTRUxFQ1QpLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFu\nZChldmFsV2hlcmVDbGF1c2UoZXhwcyksIGZpbHRlcik7CiAgICAgICAgZmls\ndGVyID0gYW5kKGV2YWxTZWxlY3RDbGF1c2UoZXhwcyksIGZpbHRlcik7Cgog\nICAgICAgIGV4cHMuZmlsdGVyID0gZmlsdGVyID09IG51bGwgPyBmYWN0b3J5\nLmVtcHR5RXhwcmVzc2lvbigpIDogZmlsdGVyOwoKICAgICAgICBldmFsR3Jv\ndXBpbmdDbGF1c2UoZXhwcyk7CiAgICAgICAgZXZhbEhhdmluZ0NsYXVzZShl\neHBzKTsKICAgICAgICBldmFsRmV0Y2hKb2lucyhleHBzKTsKICAgICAgICBl\ndmFsU2V0Q2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxPcmRlcmluZ0NsYXVz\nZXMoZXhwcyk7CgogICAgICAgIGlmIChwYXJhbWV0ZXJUeXBlcyAhPSBudWxs\nKQogICAgICAgICAgICBleHBzLnBhcmFtZXRlclR5cGVzID0gcGFyYW1ldGVy\nVHlwZXM7CgogICAgICAgIGV4cHMuYWNjZXNzUGF0aCA9IGdldEFjY2Vzc1Bh\ndGgoKTsKCiAgICAgICAgcmV0dXJuIGV4cHM7CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGFuZChFeHByZXNzaW9uIGUxLCBFeHByZXNzaW9uIGUy\nKSB7CiAgICAgICAgcmV0dXJuIGUxID09IG51bGwgPyBlMiA6IGUyID09IG51\nbGwgPyBlMSA6IGZhY3RvcnkuYW5kKGUxLCBlMik7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUpIHsK\nICAgICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSwgIi4iLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBjaGlsZHJlbiBvZiB0aGUg\nc3BlY2lmaWMgbm9kZSBieSBhcHBlbmRpbmcgZWFjaAogICAgICogY2hpbGQs\nIHNlcGFyYXRlZCBieSB0aGUgZGVsaW1pdGVyLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBTdHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSwgU3Ry\naW5nIGRlbGltaXRlciwgaW50IGxhc3QpIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIEpQUUxO\nb2RlW10gcGFydHMgPSBub2RlLmNoaWxkcmVuOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBwYXJ0cyAhPSBudWxsICYmIGkgPCBwYXJ0cy5sZW5ndGggLSBs\nYXN0OyBpKyspCiAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQocmVzdWx0Lmxl\nbmd0aCgpID4gMCA/IGRlbGltaXRlciA6ICIiKS4KICAgICAgICAgICAgICAg\nIGFwcGVuZChwYXJ0c1tpXS50ZXh0KTsKCiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC50b1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBh\nc3NpZ25Qcm9qZWN0aW9ucyhKUFFMTm9kZSBwYXJhbWV0ZXJzTm9kZSwKICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBpbnQgY291\nbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9ucyA9IG5ldyBWYWx1ZVtjb3VudF07CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9uQ2xhdXNlcyA9IG5ldyBTdHJpbmdbY291bnRdOwog\nICAgICAgIGV4cHMucHJvamVjdGlvbkFsaWFzZXMgPSBuZXcgU3RyaW5nW2Nv\ndW50XTsKCiAgICAgICAgRXhwcmVzc2lvbiBleHAgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAg\nICBKUFFMTm9kZSBwYXJlbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZChp\nKTsKICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9ubHlDaGlsZChwYXJl\nbnQpOwogICAgICAgICAgICBWYWx1ZSBwcm9qID0gZ2V0VmFsdWUobm9kZSk7\nCiAgICAgICAgICAgIGV4cHMucHJvamVjdGlvbnNbaV0gPSBwcm9qOwogICAg\nICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzW2ldID0gbmV4dEFsaWFz\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlvbihRdWVyeUV4cHJlc3Np\nb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSB3\nYW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRhdGUKICAgICAgICBpZiAo\ncm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290KCkuaWQgPT0gSkpUU1VC\nU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxzZSBpZiAocm9vdCgpLmlk\nID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhwcy5vcGVyYXRpb24gPSBR\ndWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAgICAgIGVsc2UgaWYgKHJv\nb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAgICAgIGV4cHMub3BlcmF0\naW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQUE9S\nVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lv\nbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1c2Vz\nCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUgPSByb290KCkuZmluZENo\naWxkQnlJRChKSlRHUk9VUEJZLCB0cnVlKTsKCiAgICAgICAgaWYgKGdyb3Vw\nQnlOb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naW50IGdyb3VwQnlDb3VudCA9IGdyb3VwQnlOb2RlLmdldENoaWxkQ291bnQo\nKTsKCiAgICAgICAgZXhwcy5ncm91cGluZyA9IG5ldyBWYWx1ZVtncm91cEJ5\nQ291bnRdOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdyb3VwQnlD\nb3VudDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBncm91\ncEJ5Tm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgZXhwcy5ncm91cGlu\nZ1tpXSA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEhhdmluZ0NsYXVzZShRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgSEFWSU5HIGNsYXVzZXMKICAg\nICAgICBKUFFMTm9kZSBoYXZpbmdOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5\nSUQoSkpUSEFWSU5HLCB0cnVlKTsKCiAgICAgICAgaWYgKGhhdmluZ05vZGUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBleHBzLmhh\ndmluZyA9IGdldEV4cHJlc3Npb24ob25seUNoaWxkKGhhdmluZ05vZGUpKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbE9yZGVyaW5nQ2xhdXNlcyhR\ndWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgT1JE\nRVIgQlkgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIG9yZGVyYnkgPSByb290\nKCkuZmluZENoaWxkQnlJRChKSlRPUkRFUkJZLCBmYWxzZSk7CiAgICAgICAg\naWYgKG9yZGVyYnkgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgb3JkZXJj\nb3VudCA9IG9yZGVyYnkuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBl\neHBzLm9yZGVyaW5nID0gbmV3IFZhbHVlW29yZGVyY291bnRdOwogICAgICAg\nICAgICBleHBzLmFzY2VuZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRd\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7\nIGkrKykgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVy\nYnkuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5n\nW2ldID0gZ2V0VmFsdWUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAg\nICAgICAvLyBvbW1pc3Npb24gb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBh\nc2NlbmRpbmcKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0g\nbm9kZS5nZXRDaGlsZENvdW50KCkgPD0gMSB8fAogICAgICAgICAgICAgICAg\nICAgIGxhc3RDaGlsZChub2RlKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVl\nIDogZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxTZWxlY3RDbGF1c2UoUXVlcnlFeHBy\nZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaWYgKGV4cHMub3BlcmF0aW9uICE9\nIFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3ROb2RlID0gcm9vdCgp\nOwoKICAgICAgICBKUFFMTm9kZSBjb25zdHJ1Y3RvciA9IHNlbGVjdE5vZGUu\nZmluZENoaWxkQnlJRChKSlRDT05TVFJVQ1RPUiwgdHJ1ZSk7CiAgICAgICAg\naWYgKGNvbnN0cnVjdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gYnVp\nbGQgdXAgdGhlIGZ1bGx5LXF1YWxpZmllZCByZXN1bHQgY2xhc3MgbmFtZSBi\neQogICAgICAgICAgICAvLyBhcHBlbmRpbmcgdG9nZXRoZXIgdGhlIGNvbXBv\nbmVudHMgb2YgdGhlIGNoaWxkcmVuCiAgICAgICAgICAgIFN0cmluZyByZXN1\nbHRDbGFzc05hbWUgPSBhc3NlbWJsZShsZWZ0KGNvbnN0cnVjdG9yKSk7CiAg\nICAgICAgICAgIGV4cHMucmVzdWx0Q2xhc3MgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUocmVzdWx0Q2xhc3NOYW1lLCBudWxsKTsKCiAgICAgICAgICAgIC8v\nIG5vdyBhc3NpZ24gdGhlIGFyZ3VtZW50cyB0byB0aGUgc2VsZWN0IGNsYXVz\nZSBhcyB0aGUgcHJvamVjdGlvbnMKICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IGV4cHMuRElTVElOQ1RfRkFMU0U7CiAgICAgICAgICAgIHJldHVybiBh\nc3NpZ25Qcm9qZWN0aW9ucyhyaWdodChjb25zdHJ1Y3RvciksIGV4cHMpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpQUUxOb2RlIHNlbGVjdENs\nYXVzZSA9IHNlbGVjdE5vZGUuCiAgICAgICAgICAgICAgICBmaW5kQ2hpbGRC\neUlEKEpKVFNFTEVDVENMQVVTRSwgZmFsc2UpOwogICAgICAgICAgICBpZiAo\nc2VsZWN0Q2xhdXNlICE9IG51bGwgJiYgc2VsZWN0Q2xhdXNlLmhhc0NoaWxk\nSUQoSkpURElTVElOQ1QpKQogICAgICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IGV4cHMuRElTVElOQ1RfVFJVRSB8IGV4cHMuRElTVElOQ1RfQVVUTzsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IGV4cHMuRElTVElOQ1RfRkFMU0U7CgogICAgICAgICAgICAvLyBoYW5k\nbGUgU0VMRUNUIGNsYXVzZXMKICAgICAgICAgICAgSlBRTE5vZGUgZXhwTm9k\nZSA9IHNlbGVjdE5vZGUuCiAgICAgICAgICAgICAgICBmaW5kQ2hpbGRCeUlE\nKEpKVFNFTEVDVEVYUFJFU1NJT05TLCB0cnVlKTsKICAgICAgICAgICAgaWYg\nKGV4cE5vZGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAgICAgaW50IHNlbGVjdENvdW50ID0gZXhwTm9kZS5nZXRD\naGlsZENvdW50KCk7CiAgICAgICAgICAgIEpQUUxOb2RlIHNlbGVjdENoaWxk\nID0gZmlyc3RDaGlsZChleHBOb2RlKTsKCiAgICAgICAgICAgIC8vIGlmIHdl\nIGFyZSBzZWxlY3RpbmcganVzdCBvbmUgdGhpbmcgYW5kIHRoYXQgdGhpbmcg\naXMgdGhlCiAgICAgICAgICAgIC8vIHNjaGVtYSdzIGFsaWFzLCB0aGVuIGRv\nIG5vdCB0cmVhdCBpdCBhcyBhIHByb2plY3Rpb24KICAgICAgICAgICAgaWYg\nKHNlbGVjdENvdW50ID09IDEgJiYgc2VsZWN0Q2hpbGQgIT0gbnVsbCAmJgog\nICAgICAgICAgICAgICAgc2VsZWN0Q2hpbGQuZ2V0Q2hpbGRDb3VudCgpID09\nIDEgJiYKICAgICAgICAgICAgICAgIG9ubHlDaGlsZChzZWxlY3RDaGlsZCkg\nIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgYXNzZXJ0U2NoZW1hQWxpYXMo\nKS4KICAgICAgICAgICAgICAgICAgICBlcXVhbHNJZ25vcmVDYXNlKG9ubHlD\naGlsZChzZWxlY3RDaGlsZCkudGV4dCkpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgLy8gSlBRTCBkb2VzIG5vdCBmaWx0ZXIgcmVsYXRpb25hbCBqb2lucyBm\nb3IgcHJvamVjdGlvbnMKICAgICAgICAgICAgICAgIGV4cHMuZGlzdGluY3Qg\nJj0gfmV4cHMuRElTVElOQ1RfQVVUTzsKICAgICAgICAgICAgICAgIHJldHVy\nbiBhc3NpZ25Qcm9qZWN0aW9ucyhleHBOb2RlLCBleHBzKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBhc3Nl\ncnRTY2hlbWFBbGlhcygpIHsKICAgICAgICBTdHJpbmcgYWxpYXMgPSBjdHgo\nKS5zY2hlbWFBbGlhczsKCiAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJhbGlh\ncy1yZXF1aXJlZCIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGN0\neCgpLm1ldGEgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBhbGlhczsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgRXhwcmVzc2lvbiBldmFsRmV0Y2hKb2lucyhR\ndWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBFeHByZXNzaW9uIGZp\nbHRlciA9IG51bGw7CgogICAgICAgIC8vIGhhbmRsZSBKT0lOIEZFVENICiAg\nICAgICAgU2V0IGpvaW5zID0gbnVsbDsKCiAgICAgICAgSlBRTE5vZGVbXSBv\ndXRlcnMgPSByb290KCkuZmluZENoaWxkcmVuQnlJRChKSlRPVVRFUkZFVENI\nSk9JTik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IG91dGVycyAhPSBudWxs\nICYmIGkgPCBvdXRlcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIChqb2lu\ncyA9PSBudWxsID8gam9pbnMgPSBuZXcgVHJlZVNldCgpIDogam9pbnMpLgog\nICAgICAgICAgICAgICAgYWRkKGdldFBhdGgob25seUNoaWxkKG91dGVyc1tp\nXSkpLmxhc3QoKS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICBKUFFM\nTm9kZVtdIGlubmVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpKVElO\nTkVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW5uZXJz\nICE9IG51bGwgJiYgaSA8IGlubmVycy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5ldyBUcmVlU2V0KCkgOiBq\nb2lucykuCiAgICAgICAgICAgICAgICBhZGQoZ2V0UGF0aChvbmx5Q2hpbGQo\naW5uZXJzW2ldKSkubGFzdCgpLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAg\nICAgIGlmIChqb2lucyAhPSBudWxsKQogICAgICAgICAgICBleHBzLmZldGNo\nUGF0aHMgPSAoU3RyaW5nW10pIGpvaW5zLgogICAgICAgICAgICAgICAgdG9B\ncnJheShuZXcgU3RyaW5nW2pvaW5zLnNpemUoKV0pOwoKICAgICAgICByZXR1\ncm4gZmlsdGVyOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGV2YWxTZXRD\nbGF1c2UoUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFu\nZGxlIFNFVCBmaWVsZCA9IHZhbHVlCiAgICAgICAgSlBRTE5vZGVbXSBub2Rl\ncyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpKVFVQREFURUlURU0pOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBub2RlcyAhPSBudWxsICYmIGkgPCBu\nb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZpZWxkID0gZ2V0UGF0aChmaXJzdENoaWxkKG5vZGVzW2ldKSkubGFzdCgp\nOwogICAgICAgICAgICBWYWx1ZSB2YWwgPSBnZXRWYWx1ZShvbmx5Q2hpbGQo\nbGFzdENoaWxkKG5vZGVzW2ldKSkpOwogICAgICAgICAgICBleHBzLnB1dFVw\nZGF0ZShmaWVsZCwgdmFsKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGV2YWxXaGVyZUNsYXVzZShRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBldmFsdWF0ZSB0aGUgV0hFUkUgY2xhdXNl\nCiAgICAgICAgSlBRTE5vZGUgd2hlcmVOb2RlID0gcm9vdCgpLmZpbmRDaGls\nZEJ5SUQoSkpUV0hFUkUsIGZhbHNlKTsKICAgICAgICBpZiAod2hlcmVOb2Rl\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJl\ndHVybiAoRXhwcmVzc2lvbikgZXZhbCh3aGVyZU5vZGUpOwogICAgfQoKICAg\nIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsRnJvbUNsYXVzZShib29sZWFuIG5l\nZWRzQWxpYXMpIHsKICAgICAgICBFeHByZXNzaW9uIGV4cCA9IG51bGw7Cgog\nICAgICAgIC8vIGJ1aWxkIHVwIHRoZSBhbGlhcyBtYXAgaW4gdGhlIEZST00g\nY2xhdXNlCiAgICAgICAgSlBRTE5vZGUgZnJvbSA9IHJvb3QoKS5maW5kQ2hp\nbGRCeUlEKEpKVEZST00sIGZhbHNlKTsKICAgICAgICBpZiAoZnJvbSA9PSBu\ndWxsKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm8tZnJvbS1jbGF1c2UiLCBudWxsLCBudWxsKTsKCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmcm9tLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBmcm9tLmNoaWxkcmVuW2ld\nOwoKICAgICAgICAgICAgaWYgKG5vZGUuaWQgPT0gSkpURlJPTUlURU0pCiAg\nICAgICAgICAgICAgICBleHAgPSBldmFsRnJvbUl0ZW0oZXhwLCBub2RlLCBu\nZWVkc0FsaWFzKTsKICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5pZCA9PSBK\nSlRPVVRFUkpPSU4pCiAgICAgICAgICAgICAgICBleHAgPSBhZGRKb2luKG5v\nZGUsIGZhbHNlLCBleHApOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlk\nID09IEpKVElOTkVSSk9JTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpv\naW4obm9kZSwgdHJ1ZSwgZXhwKTsKICAgICAgICAgICAgZWxzZSBpZiAobm9k\nZS5pZCA9PSBKSlRJTk5FUkZFVENISk9JTikKICAgICAgICAgICAgICAgIGV4\ncCA9IGFkZEpvaW4obm9kZSwgdHJ1ZSwgZXhwKTsKICAgICAgICAgICAgZWxz\nZSBpZiAobm9kZS5pZCA9PSBKSlRPVVRFUkZFVENISk9JTikKICAgICAgICAg\nICAgICAgIDsgLy8gd2UgaGFuZGxlIG91dGVyIGZldGNoIGpvaW5zIGluIHRo\nZSBldmFsRmV0Y2hKb2lucygpIG1ldGhvZAogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nbm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IG5vZGUgfSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gZXhwOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGpvaW4gY29u\nZGl0aW9uIHRvIHRoZSBnaXZlbiBleHByZXNzaW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSBub2RlIHRoZSBub2RlIHRvIGNoZWNrCiAgICAgKiBAcGFyYW0g\naW5uZXIgd2hldGhlciBvciBub3QgdGhlIGpvaW4gc2hvdWxkIGJlIGFuIGlu\nbmVyIGpvaW4KICAgICAqIEBwYXJhbSBleHAgYW4gZXhpc3RpbmcgZXhwcmVz\nc2lvbiB0byBBTkQsIG9yIG51bGwgaWYgbm9uZQogICAgICogQHJldHVybiB0\naGUgRXhwcmVzc2lvbiB3aXRoIHRoZSBqb2luIGNvbmRpdGlvbiBhZGRlZAog\nICAgICovCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYWRkSm9pbihKUFFMTm9k\nZSBub2RlLCBib29sZWFuIGlubmVyLCBFeHByZXNzaW9uIGV4cCkgewogICAg\nICAgIC8vIHRoZSB0eXBlIHdpbGwgYmUgdGhlIGRlY2xhcmVkIHR5cGUgZm9y\nIHRoZSBmaWVsZAogICAgICAgIFBhdGggcGF0aCA9IGdldFBhdGgoZmlyc3RD\naGlsZChub2RlKSwgZmFsc2UsIGlubmVyKTsKCiAgICAgICAgSlBRTE5vZGUg\nYWxpYXMgPSBub2RlLmdldENoaWxkQ291bnQoKSA+PSAyID8gcmlnaHQobm9k\nZSkgOiBudWxsOwogICAgICAgIC8vIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJx\ndWVyeSdzIGZyb20gY2xhdXNlIGRvIG5vdCBzdGFydCB3aXRoIAogICAgICAg\nIC8vIGlkZW50aWZpY2F0aW9uX3ZhcmlhYmxlX2RlY2xhcmF0aW9uKCkKICAg\nICAgICBpZiAoaW5uZXIgJiYgY3R4KCkuc3VicXVlcnkgIT0gbnVsbCAmJiBj\ndHgoKS5zY2hlbWFBbGlhcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHNldENh\nbmRpZGF0ZShnZXRGaWVsZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcy50ZXh0\nKTsKCiAgICAgICAgICAgIFBhdGggc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0\naChjdHgoKS5zdWJxdWVyeSk7CiAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0\nYURhdGEoY3R4KCkuc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAg\nICAgIGV4cCA9ICBhbmQoZXhwLCBmYWN0b3J5LmVxdWFsKHBhdGgsIHN1YnBh\ndGgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhZGRKb2luKHBhdGgs\nIGFsaWFzLCBpbm5lciwgZXhwKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJl\nc3Npb24gYWRkSm9pbihQYXRoIHBhdGgsIEpQUUxOb2RlIGFsaWFzTm9kZSwg\nYm9vbGVhbiBpbm5lciwKICAgICAgICBFeHByZXNzaW9uIGV4cCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0KCk7CgogICAgICAg\nIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgInBhdGgtbm8tbWV0YSIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHBhdGgsIG51bGwgfSwgbnVsbCk7CgogICAgICAg\nIFN0cmluZyBhbGlhcyA9IGFsaWFzTm9kZSAhPSBudWxsID8gYWxpYXNOb2Rl\nLnRleHQgOiBuZXh0QWxpYXMoKTsKCiAgICAgICAgVmFsdWUgdmFyID0gZ2V0\nVmFyaWFibGUoYWxpYXMsIHRydWUpOwogICAgICAgIHZhci5zZXRNZXRhRGF0\nYShnZXRGaWVsZFR5cGUoZm1kKSk7CgogICAgICAgIEV4cHJlc3Npb24gam9p\nbiA9IG51bGw7CgogICAgICAgIC8vIGlmIHRoZSB2YXJpYWJsZSBpcyBhbHJl\nYWR5IGJvdW5kLCBnZXQgdGhlIHZhcidzIHZhbHVlIGFuZAogICAgICAgIC8v\nIGRvIGEgcmVndWxhciBjb250YWlucyB3aXRoIHRoYXQKICAgICAgICBib29s\nZWFuIGJvdW5kID0gaXNCb3VuZCh2YXIpOwogICAgICAgIGlmIChib3VuZCkg\newogICAgICAgICAgICB2YXIgPSBnZXRWYWx1ZShhbGlhc05vZGUsIFZBUl9Q\nQVRIKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaW5kKHZhcik7\nCiAgICAgICAgICAgIGpvaW4gPSBhbmQoam9pbiwgZmFjdG9yeS5iaW5kVmFy\naWFibGUodmFyLCBwYXRoKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWZt\nZC5pc1R5cGVQQygpKSAvLyBtdWx0aS12YWx1ZWQgcmVsYXRpb24KICAgICAg\nICB7CiAgICAgICAgICAgIGlmIChib3VuZCkKICAgICAgICAgICAgICAgIGpv\naW4gPSBhbmQoam9pbiwgZmFjdG9yeS5jb250YWlucyhwYXRoLCB2YXIpKTsK\nCiAgICAgICAgICAgIHNldEltcGxpY2l0Q29udGFpbnNUeXBlcyhwYXRoLCB2\nYXIsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gYW5kKGV4cCwgam9pbik7CiAgICB9CgogICAgcHJpdmF0ZSBF\neHByZXNzaW9uIGV2YWxGcm9tSXRlbShFeHByZXNzaW9uIGV4cCwgSlBRTE5v\nZGUgbm9kZSwKICAgICAgICBib29sZWFuIG5lZWRzQWxpYXMpIHsKICAgICAg\nICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlc29sdmVDbGFzc01ldGFEYXRhKGZp\ncnN0Q2hpbGQobm9kZSkpOwoKICAgICAgICBTdHJpbmcgYWxpYXMgPSBudWxs\nOwoKICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPCAyKSB7CiAg\nICAgICAgICAgIGlmIChuZWVkc0FsaWFzKQogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGNtZCB9LCBudWxs\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGlhcyA9IHJpZ2h0\nKG5vZGUpLnRleHQ7CiAgICAgICAgICAgIEpQUUxOb2RlIGxlZnQgPSBsZWZ0\nKG5vZGUpOwoKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3\nZSBhcmUgcmVmZXJyaW5nIHRvIGEgcGF0aCBpbiB0aGUgZnJvbQogICAgICAg\nICAgICAvLyBjbGF1c2UsIHNpbmNlIHdlIG1pZ2h0IGJlIGluIGEgc3VicXVl\ncnkgYWdhaW5zdCBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKGlzUGF0\naChsZWZ0KSkgewogICAgICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0\naChsZWZ0KTsKICAgICAgICAgICAgICAgIHNldENhbmRpZGF0ZShnZXRGaWVs\nZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcyk7CgogICAgICAgICAgICAgICAg\nUGF0aCBzdWJwYXRoID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5\nKTsKICAgICAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY3R4KCku\nc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYW5kKGV4cCwgZmFjdG9yeS5lcXVhbChwYXRoLCBzdWJwYXRoKSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZl\nIGFuIGFsaWFzOiBiaW5kIGl0IGFzIGEgdmFyaWFibGUKICAgICAgICAgICAg\nICAgIFZhbHVlIHZhciA9IGdldFZhcmlhYmxlKGFsaWFzLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIHZhci5zZXRNZXRhRGF0YShjbWQpOwogICAgICAgICAg\nICAgICAgYmluZCh2YXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyAjIyMgd2UgYXNzaWduIHRoZSBmaXJzdCBGUk9NSVRFTSBpbnN0\nYW5jZSB3ZSBzZWUgYXMKICAgICAgICAvLyB0aGUgZ2xvYmFsIGNhbmRpZGF0\nZSwgd2hpY2ggaXMgaW5jb3JyZWN0OiB3ZSBzaG91bGQKICAgICAgICAvLyBp\nbnN0ZWFkIGJlIG1hcHBpbmcgdGhpcyB0byB0aGUgU0VMRUNUSVRFTSB0byBz\nZWUKICAgICAgICAvLyB3aGljaCBpcyB0aGUgZGVzaXJlZCBjYW5kaWRhdGUK\nICAgICAgICBpZiAoY3R4KCkuc2NoZW1hQWxpYXMgPT0gbnVsbCkKICAgICAg\nICAgICAgc2V0Q2FuZGlkYXRlKGNtZCwgYWxpYXMpOwoKICAgICAgICByZXR1\ncm4gZXhwOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzRGVjbGFy\nZWRWYXJpYWJsZShTdHJpbmcgbmFtZSkgewogICAgICAgIC8vIEpQUUwgZG9l\nc24ndCBzdXBwb3J0IGRlY2xhcmluZyB2YXJpYWJsZXMKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0byBzZWUg\naWYgdGhlIHNwZWNpZmljIG5vZGUgaXMgYSBwYXRoICh2cy4gYSBzY2hlbWEg\nbmFtZSkKICAgICAqLwogICAgYm9vbGVhbiBpc1BhdGgoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA8IDIpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgU3RyaW5n\nIG5hbWUgPSBmaXJzdENoaWxkKG5vZGUpLnRleHQ7CiAgICAgICAgaWYgKG5h\nbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMg\ndGhlIGFsaWFzCiAgICAgICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRv\nbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAgICAgICAgaWYgKGdldE1l\ndGFEYXRhRm9yQWxpYXMobmFtZSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CgogICAgICAgIGlmICghaXNTZWVuVmFyaWFibGUobmFtZSkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgVmFs\ndWUgdmFyID0gZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBp\nZiAodmFyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBpc0JvdW5kKHZh\ncik7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBDbGFzc01ldGFEYXRhIGdldEZpZWxkVHlwZShGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0g\nbnVsbDsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZDsKCiAgICAgICAgaWYg\nKCh2bWQgPSBmbWQuZ2V0RWxlbWVudCgpKSAhPSBudWxsKQogICAgICAgICAg\nICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBlbHNlIGlmICgodm1kID0gZm1kLmdldEtleSgpKSAhPSBudWxsKQogICAg\nICAgICAgICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsK\nICAgICAgICBlbHNlIGlmICgodm1kID0gZm1kLmdldFZhbHVlKCkpICE9IG51\nbGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpOwoKICAgICAgICBpZiAoY21kID09IG51bGwgfHwgY21kLmdldERl\nc2NyaWJlZFR5cGUoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNt\nZCA9IGZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwoKICAgICAgICBy\nZXR1cm4gY21kOwogICAgfQoKICAgIC8qKgogICAgICogSWRlbnRpZmljYXRp\nb24gdmFyaWFibGVzIGluIEpQUUwgYXJlIGNhc2UgaW5zZW5zaXRpdmUsIHNv\nIGxvd2VyLWNhc2UKICAgICAqIGFsbCB2YXJpYWJsZXMgd2UgYXJlIGdvaW5n\nIHRvIGJpbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZSBnZXRWYXJp\nYWJsZShTdHJpbmcgaWQsIGJvb2xlYW4gYmluZCkgewogICAgICAgIGlmIChp\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldFZhcmlhYmxlKGlkLnRvTG93ZXJDYXNlKCksIGJp\nbmQpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzU2VlbmRWYXJp\nYWJsZShTdHJpbmcgaWQpIHsKICAgICAgICByZXR1cm4gaWQgIT0gbnVsbCAm\nJiBzdXBlci5pc1NlZW5WYXJpYWJsZShpZC50b0xvd2VyQ2FzZSgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNzIG5hbWUgdXNp\nbmcgdGhlIGNoaWxkcmVuIG9mIHRoZSBKUFFMTm9kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgYXNzZXJ0U2NoZW1hTmFtZShKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgaWYgKG5vZGUuaWQgIT0gSkpUQUJTVFJBQ1RTQ0hFTUFO\nQU1FKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm90LWlkZW50aWZlciIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IG5vZGUgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBhc3NlbWJsZShu\nb2RlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIg\nbWV0aG9kIHRvIGV2YWx1YXRlIHRoZSBnaXZlbiBub2RlLgogICAgICovCiAg\nICBwcml2YXRlIE9iamVjdCBldmFsKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICBWYWx1ZSB2YWwxID0gbnVsbDsKICAgICAgICBWYWx1ZSB2YWwyID0gbnVs\nbDsKICAgICAgICBWYWx1ZSB2YWwzID0gbnVsbDsKCiAgICAgICAgYm9vbGVh\nbiBub3QgPSBub2RlLm5vdDsKCiAgICAgICAgc3dpdGNoIChub2RlLmlkKSB7\nCiAgICAgICAgICAgIGNhc2UgSkpUV0hFUkU6IC8vIHRvcC1sZXZlbCBXSEVS\nRSBjbGF1c2UKICAgICAgICAgICAgICAgIHJldHVybiBnZXRFeHByZXNzaW9u\nKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVEJPT0xF\nQU5MSVRFUkFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3\nTGl0ZXJhbCgidHJ1ZSIuZXF1YWxzSWdub3JlQ2FzZQogICAgICAgICAgICAg\nICAgICAgIChub2RlLnRleHQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRSwKICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfQk9PTEVB\nTik7CgogICAgICAgICAgICBjYXNlIEpKVElOVEVHRVJMSVRFUkFMOgogICAg\nICAgICAgICAgICAgLy8gdXNlIEJpZ0RlY2ltYWwgYmVjYXVzZSBpdCBjYW4g\naGFuZGxlIHBhcnNpbmcgZXhwb25lbnRzCiAgICAgICAgICAgICAgICBCaWdE\nZWNpbWFsIGludGxpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAg\nICAgICAgKG5vZGUudGV4dC5lbmRzV2l0aCgibCIpIHx8IG5vZGUudGV4dC5l\nbmRzV2l0aCgiTCIpCiAgICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50\nZXh0LnN1YnN0cmluZygwLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAg\nICAgICAgICAgICAgICAgICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAg\nICAgICAgICAgbXVsdGlwbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9k\nZSkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVy\nYWwobmV3IExvbmcoaW50bGl0LmxvbmdWYWx1ZSgpKSwKICAgICAgICAgICAg\nICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUREVDSU1BTExJVEVSQUw6CiAgICAgICAgICAgICAgICBCaWdEZWNp\nbWFsIGRlY2xpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAgICAg\nICAgKG5vZGUudGV4dC5lbmRzV2l0aCgiZCIpIHx8IG5vZGUudGV4dC5lbmRz\nV2l0aCgiRCIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudGV4\ndC5lbmRzV2l0aCgiZiIpIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiRiIpCiAg\nICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50ZXh0LnN1YnN0cmluZygw\nLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAg\nICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAgICAgICAgICAgbXVsdGlw\nbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9kZSkpKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwoZGVjbGl0LCBMaXRl\ncmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1RSSU5H\nTElURVJBTDoKICAgICAgICAgICAgY2FzZSBKSlRUUklNQ0hBUkFDVEVSOgog\nICAgICAgICAgICBjYXNlIEpKVEVTQ0FQRUNIQVJBQ1RFUjoKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwodHJpbVF1b3Rlcyhu\nb2RlLnRleHQpLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9T\nUV9TVFJJTkcpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRURVJOVkFMVUU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChmaXJzdENoaWxkKG5vZGUp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTkFNRURJTlBVVFBBUkFNRVRFUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0ZXIobm9kZS50ZXh0\nLCBmYWxzZSk7CgogICAgICAgICAgICBjYXNlIEpKVFBPU0lUSU9OQUxJTlBV\nVFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0\nZXIobm9kZS50ZXh0LCB0cnVlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUT1I6\nIC8vIHggT1IgeQogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkub3Io\nZ2V0RXhwcmVzc2lvbihsZWZ0KG5vZGUpKSwKICAgICAgICAgICAgICAgICAg\nICBnZXRFeHByZXNzaW9uKHJpZ2h0KG5vZGUpKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVEFORDogLy8geCBBTkQgeQogICAgICAgICAgICAgICAgcmV0dXJu\nIGFuZChnZXRFeHByZXNzaW9uKGxlZnQobm9kZSkpLAogICAgICAgICAgICAg\nICAgICAgIGdldEV4cHJlc3Npb24ocmlnaHQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURVFVQUxTOiAvLyB4ID0geQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUTk9URVFVQUxTOiAvLyB4IDw+IHkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwodmFs\nMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVExFU1NUSEFOOiAvLyB4\nIDwgeQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwg\ndmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5s\nZXNzVGhhbih2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTEVT\nU09SRVFVQUw6IC8vIHggPD0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdl\ndFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdl\ndFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxp\nY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5sZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDIpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRHUkVBVEVSVEhBTjogLy8geCA+IHkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRlclRoYW4o\ndmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEdSRUFURVJPUkVR\nVUFMOiAvLyB4ID49IHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1\nZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1\nZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuZ3JlYXRlclRoYW5FcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUQUREOiAvLyB4ICsgeQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWRkKHZhbDEsIHZhbDIp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJUUkFDVDogLy8geCAtIHkKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZ\nUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1\nYnRyYWN0KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRNVUxU\nSVBMWTogLy8geCAqIHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1\nZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1\nZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm11bHRpcGx5KHZhbDEsIHZhbDIpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRESVZJREU6IC8vIHggLyB5CiAgICAgICAgICAgICAg\nICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAg\nICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5kaXZpZGUodmFsMSwg\ndmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEJFVFdFRU46IC8vIHguZmll\nbGQgW05PVF0gQkVUV0VFTiA1IEFORCAxMAogICAgICAgICAgICAgICAgdmFs\nMSA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAgICAgICAg\nICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7CiAgICAg\nICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMiwgMykp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBudWxsKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFs\nMSwgdmFsMywgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5v\ndChub3QsIGFuZChmYWN0b3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFs\nMiksCiAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5sZXNzVGhhbkVxdWFs\nKHZhbDEsIHZhbDMpKSk7CgogICAgICAgICAgICBjYXNlIEpKVElOOiAvLyB4\nLmZpZWxkIFtOT1RdIElOICgnYScsICdiJywgJ2MnKQoKICAgICAgICAgICAg\nICAgIEV4cHJlc3Npb24gaW5FeHAgPSBudWxsOwogICAgICAgICAgICAgICAg\nSXRlcmF0b3IgaW5JdGVyYXRvciA9IG5vZGUuaXRlcmF0b3IoKTsKICAgICAg\nICAgICAgICAgIC8vIHRoZSBmaXJzdCBjaGlsZCBpcyB0aGUgcGF0aAogICAg\nICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKChKUFFMTm9kZSkgaW5JdGVy\nYXRvci5uZXh0KCkpOwoKICAgICAgICAgICAgICAgIHdoaWxlIChpbkl0ZXJh\ndG9yLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZSgoSlBRTE5vZGUpIGluSXRlcmF0b3IubmV4dCgpKTsKCiAgICAg\nICAgICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciA8dmFsdWU+IElO\nICg8c3VicXVlcnk+KSBvcgogICAgICAgICAgICAgICAgICAgIC8vIDx2YWx1\nZT4gSU4gKDxzaW5nbGUgdmFsdWU+KQogICAgICAgICAgICAgICAgICAgIGlm\nICghKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsKSAmJiBub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAyKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZXZhbE5vdChub3QsIGZhY3RvcnkuY29udGFpbnModmFsMiwgdmFsMSkpOyAK\nCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBjdXJyZW50bHkgYSBz\nZXF1ZW5jZSBvZiBPUiBleHByZXNzaW9ucywgc2luY2Ugd2UKICAgICAgICAg\nICAgICAgICAgICAvLyBkbyBub3QgaGF2ZSBzdXBwb3J0IGZvciBJTiBleHBy\nZXNzaW9ucwogICAgICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXMo\ndmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlu\nRXhwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGluRXhwID0g\nZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGluRXhwID0gZmFjdG9y\neS5vcihpbkV4cCwgZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKSk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gd2UgYWRkaXRpb25h\nbGx5IG5lZWQgdG8gYWRkIGluIGEgIk5PVCBOVUxMIiBjbGF1c2UsIHNpbmNl\nCiAgICAgICAgICAgICAgICAvLyB0aGUgSU4gYmVoYXZpb3IgdGhhdCBpcyBl\neHBlY3RlZCBieSB0aGUgQ1RTIGFsc28gZXhwZWN0cwogICAgICAgICAgICAg\nICAgLy8gdG8gZmlsdGVyIG91ciBOVUxMcwogICAgICAgICAgICAgICAgcmV0\ndXJuIGFuZChldmFsTm90KG5vdCwgaW5FeHApLAogICAgICAgICAgICAgICAg\nICAgIGZhY3Rvcnkubm90RXF1YWwodmFsMSwgZmFjdG9yeS5nZXROdWxsKCkp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSVNOVUxMOiAvLyB4LmZpZWxkIElT\nIFtOT1RdIE5VTEwKICAgICAgICAgICAgICAgIGlmIChub3QpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwKICAgICAgICAg\nICAgICAgICAgICAgICAgKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSksIGZh\nY3RvcnkuZ2V0TnVsbCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbAogICAgICAgICAg\nICAgICAgICAgICAgICAoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKSwgZmFj\ndG9yeS5nZXROdWxsKCkpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRIOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFBhdGhPckNvbnN0YW50KG5vZGUp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRJREVOVElGSUVSOgogICAgICAgICAg\nICBjYXNlIEpKVElERU5USUZJQ0FUSU9OVkFSSUFCTEU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0SWRlbnRpZmllcihub2RlKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUTk9UOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbm90KGdldEV4cHJlc3Npb24ob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAg\nICAgICBjYXNlIEpKVExJS0U6IC8vIGZpZWxkIExJS0UgJyVzb21ldmFsJScK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCgogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVf\nU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwy\nLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgLy8gbG9vayBmb3Ig\nYW4gZXNjYXBlIGNoYXJhY3RlciBiZW5lYXRoIHRoZSBub2RlCiAgICAgICAg\nICAgICAgICBTdHJpbmcgZXNjYXBlID0gbnVsbDsKICAgICAgICAgICAgICAg\nIEpQUUxOb2RlIGVzY2FwZU5vZGUgPSByaWdodChub2RlKS4KICAgICAgICAg\nICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVEVTQ0FQRUNIQVJBQ1RFUiwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZXNjYXBlTm9kZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGVzY2FwZSA9IHRyaW1RdW90ZXMob25s\neUNoaWxkKGVzY2FwZU5vZGUpLnRleHQpOwoKICAgICAgICAgICAgICAgIGlm\nIChub3QpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90\nTWF0Y2hlcyh2YWwxLCB2YWwyLCAiXyIsICIlIiwgZXNjYXBlKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5tYXRjaGVzKHZhbDEsIHZhbDIsICJfIiwgIiUiLCBlc2NhcGUpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRJU0VNUFRZOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGV2YWxOb3Qobm90LAogICAgICAgICAgICAgICAgICAgIGZhY3Rv\ncnkuaXNFbXB0eShnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVFNJWkU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5zaXplKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRVUFBFUjoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5LnRvVXBwZXJDYXNlKHZhbDEpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRMT1dFUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LnRvTG93ZXJDYXNlKGdldFN0cmluZ1ZhbHVlKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRMRU5HVEg6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdHJpbmdMZW5ndGgoZ2V0U3Ry\naW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVEFCUzoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFicyhn\nZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUU1FSVDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLnNxcnQoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVE1PRDoKICAgICAgICAgICAgICAgIHZhbDEgPSBn\nZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm1vZCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUVFJJTTogLy8gVFJJTShbW3doZXJlXSBbY2hhcl0g\nRlJPTV0gZmllbGQpCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGFzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgQm9v\nbGVhbiB0cmltV2hlcmUgPSBudWxsOwoKICAgICAgICAgICAgICAgIEpQUUxO\nb2RlIGZpcnN0VHJpbUNoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAg\nICAgICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPiAxKSB7CiAg\nICAgICAgICAgICAgICAgICAgdHJpbVdoZXJlID0KICAgICAgICAgICAgICAg\nICAgICAgICAgZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTUxFQURJTkcg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpbUNoaWxkLmlk\nID09IEpKVFRSSU1UUkFJTElORyA/IEJvb2xlYW4uRkFMU0UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICA6IG51bGw7CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgVmFsdWUgdHJpbUNoYXI7CgogICAgICAg\nICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIDMgY2hpbGRyZW4sIHRoZW4gd2Ug\na25vdyB0aGUgdHJpbQogICAgICAgICAgICAgICAgLy8gY2hhciBpcyB0aGUg\nc2Vjb25kIG5vZGUKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAzKQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0g\nZ2V0VmFsdWUoc2Vjb25kQ2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZXJlIGFyZSB0d28gY2hpbGRyZW4sIHRoZW4gd2UgbmVl\nZCB0byBjaGVjayB0byBzZWUKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0\naGUgZmlyc3QgY2hpbGQgaXMgYSBsZWFkaW5nL3RyYWlsaW5nL2JvdGggbm9k\nZSwKICAgICAgICAgICAgICAgICAgICAvLyBvciB0aGUgdHJpbSBjaGFyYWN0\nZXIgbm9kZQogICAgICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5nZXRDaGls\nZENvdW50KCkgPT0gMgogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0VHJp\nbUNoaWxkLmlkICE9IEpKVFRSSU1MRUFESU5HCiAgICAgICAgICAgICAgICAg\nICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTVRSQUlMSU5HCiAg\nICAgICAgICAgICAgICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpU\nVFJJTUJPVEgpCiAgICAgICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBnZXRW\nYWx1ZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgICAgICAv\nLyBvdGh3ZXJ3aXNlLCB3ZSBkZWZhdWx0IHRvIHRyaW1taW5nIHRoZSBzcGFj\nZSBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICB0cmltQ2hhciA9IGZhY3RvcnkubmV3TGl0ZXJhbCgiICIsIExp\ndGVyYWwuVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LnRyaW0odmFsMSwgdHJpbUNoYXIsIHRyaW1XaGVyZSk7CgogICAg\nICAgICAgICBjYXNlIEpKVENPTkNBVDoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LmNvbmNhdCh2YWwxLCB2YWwyKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUU1VCU1RSSU5HOgogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7\nCiAgICAgICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwg\nMiwgMykpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEs\nIFRZUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZSh2YWwyLCBJbnRlZ2VyLlRZUEUpOwogICAgICAgICAgICAgICAgc2V0SW1w\nbGljaXRUeXBlKHZhbDMsIEludGVnZXIuVFlQRSk7CgogICAgICAgICAgICAg\nICAgLy8gdGhlIHNlbWFudGljcyBvZiB0aGUgSlBRTCBzdWJzdHJpbmcoKSBm\ndW5jdGlvbgogICAgICAgICAgICAgICAgLy8gYXJlIHRoYXQgYXJnMiBpcyB0\naGUgMS1iYXNlZCBzdGFydCBpbmRleCwgYW5kIGFyZzMgaXMKICAgICAgICAg\nICAgICAgIC8vIHRoZSBsZW5ndGggb2YgdGhlIHN0cmluZyB0byBiZSByZXR1\ncm47IHRoaXMgaXMgZGlmZmVyZW50CiAgICAgICAgICAgICAgICAvLyB0aGFu\nIHRoZSBzZW1hbnRpY3Mgb2YgdGhlIEV4cHJlc3Npb25GYWN0b3J5J3Mgc3Vi\nc3RyaW5nLAogICAgICAgICAgICAgICAgLy8gd2hpY2ggbWF0Y2hlcyB0aGUg\nSmF2YSBsYW5ndWFnZSAoMC1iYXNlZCBzdGFydCBpbmRleCwKICAgICAgICAg\nICAgICAgIC8vIGFyZzIgaXMgdGhlIGVuZCBpbmRleCk6IHdlIHBlcmZvcm0g\ndGhlIHRyYW5zbGF0aW9uIGJ5CiAgICAgICAgICAgICAgICAvLyBhZGRpbmcg\nb25lIHRvIHRoZSBmaXJzdCBhcmd1bWVudCwgYW5kIHRoZW4gYWRkaW5nIHRo\nZQogICAgICAgICAgICAgICAgLy8gZmlyc3QgYXJndW1lbnQgdG8gdGhlIHNl\nY29uZCBhcmd1bWVudCB0byBnZXQgdGhlIGVuZEluZGV4CiAgICAgICAgICAg\nICAgICAvLwogICAgICAgICAgICAgICAgLy8gIyMjIHdlIGNvdWxkIGdldCBy\naWQgb2Ygc29tZSBtZXNzeSBleHByZXNzaW9ucyBieSBjaGVja2luZyBmb3IK\nICAgICAgICAgICAgICAgIC8vIHRoZSBjb21tb24gY2FzZSB3aGVyZSB0aGUg\nYXJndW1lbnRzIGFyZSBzcGVjaWZpZWQgYXMKICAgICAgICAgICAgICAgIC8v\nIGEgbGl0ZXJhbCwgaW4gd2hpY2ggY2FzZSB3ZSBjb3VsZCBqdXN0IGRvIHRo\nZSBjYWxjdWxhdGlvbnMKICAgICAgICAgICAgICAgIC8vIGluIG1lbW9yeTsg\nb3RoZXJ3aXNlIHdlIHdpbmQgdXAgd2l0aCB1Z2x5IGxvb2tpbmcgU1FMIGxp\na2U6CiAgICAgICAgICAgICAgICAvLyBTRUxFQ1QgLi4uIEZST00gLi4uIHQx\nCiAgICAgICAgICAgICAgICAvLyAoU1VCU1RSSU5HKHQxLkFTVFIsICg/IC0g\nPykgKyAxLCAoPyArICg/IC0gPykpIC0gKCg/IC0gPykpKSA9ID8pCiAgICAg\nICAgICAgICAgICAvLyBbcGFyYW1zPShsb25nKSAyLCAoaW50KSAxLCAobG9u\nZykgMiwgKGxvbmcpIDIsIChpbnQpIDEsCiAgICAgICAgICAgICAgICAvLyAo\nbG9uZykgMiwgKGludCkgMSwgKFN0cmluZykgb28KICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LnN1YnN0cmluZyh2YWwxLCBmYWN0b3J5Lm5ld0Fy\nZ3VtZW50TGlzdAogICAgICAgICAgICAgICAgICAgIChmYWN0b3J5LnN1YnRy\nYWN0KHZhbDIsIGZhY3RvcnkubmV3TGl0ZXJhbAogICAgICAgICAgICAgICAg\nICAgICAgICAoTnVtYmVycy52YWx1ZU9mKDEpLCBMaXRlcmFsLlRZUEVfTlVN\nQkVSKSksCiAgICAgICAgICAgICAgICAgICAgICAgIChmYWN0b3J5LmFkZCh2\nYWwzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZhY3Rvcnkuc3Vi\ndHJhY3QodmFsMiwgZmFjdG9yeS5uZXdMaXRlcmFsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKE51bWJlcnMudmFsdWVPZigxKSwgTGl0ZXJh\nbC5UWVBFX05VTUJFUikpKSkpKSk7CgogICAgICAgICAgICBjYXNlIEpKVExP\nQ0FURToKICAgICAgICAgICAgICAgIC8vIGFzIHdpdGggU1VCU1RSSU5HIChh\nYm92ZSksIHRoZSBzZW1hbnRpY3MgZm9yIExPQ0FURSBkaWZmZXIKICAgICAg\nICAgICAgICAgIC8vIGZyb20gRXhwcmVzc2lvbkZhY3RvcnkuaW5kZXhPZiBp\nbiB0aGF0IExPQ0FURSB1c2VzIGEKICAgICAgICAgICAgICAgIC8vIDAtYmFz\nZWQgaW5kZXgsIGFuZCBpbmRleE9mIHVzZXMgYSAxLWJhc2VkIGluZGV4CiAg\nICAgICAgICAgICAgICBWYWx1ZSBsb2NhdGVQYXRoID0gZ2V0VmFsdWUoZmly\nc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAgICAgICBWYWx1ZSBsb2NhdGVT\nZWFyY2ggPSBnZXRWYWx1ZShzZWNvbmRDaGlsZChub2RlKSk7CiAgICAgICAg\nICAgICAgICBWYWx1ZSBsb2NhdGVGcm9tSW5kZXggPSBudWxsOwogICAgICAg\nICAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID4gMikgLy8gb3B0\naW9uYWwgc3RhcnQgaW5kZXggYXJnCiAgICAgICAgICAgICAgICAgICAgbG9j\nYXRlRnJvbUluZGV4ID0gZ2V0VmFsdWUodGhpcmRDaGlsZChub2RlKSk7Cgog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZVBhdGgsIFRZ\nUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShs\nb2NhdGVTZWFyY2gsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAgICBp\nZiAobG9jYXRlRnJvbUluZGV4ICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZUZyb21JbmRleCwgVFlQRV9TVFJJ\nTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFkZChmYWN0\nb3J5LmluZGV4T2YobG9jYXRlU2VhcmNoLAogICAgICAgICAgICAgICAgICAg\nIGxvY2F0ZUZyb21JbmRleCA9PSBudWxsID8gbG9jYXRlUGF0aAogICAgICAg\nICAgICAgICAgICAgICAgICA6IGZhY3RvcnkubmV3QXJndW1lbnRMaXN0KGxv\nY2F0ZVBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rvcnkuc3Vi\ndHJhY3QobG9jYXRlRnJvbUluZGV4LAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmFjdG9yeS5uZXdMaXRlcmFsKE51bWJlcnMudmFsdWVPZigxKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVf\nTlVNQkVSKSkpKSwKICAgICAgICAgICAgICAgICAgICBmYWN0b3J5Lm5ld0xp\ndGVyYWwoTnVtYmVycy52YWx1ZU9mKDEpLAogICAgICAgICAgICAgICAgICAg\nICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVEFHR1JFR0FURToKICAgICAgICAgICAgICAgIC8vIHNpbXBseSBwYXNz\nLXRocm91Z2ggd2hpbGUgYXNzZXJ0aW5nIGEgc2luZ2xlIGNoaWxkCiAgICAg\nICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRDT1VOVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LmNvdW50KGdldFZhbHVlKGxhc3RDaGlsZChub2RlKSkpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRNQVg6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5tYXgoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVE1JTjoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm1pbihnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1VNOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc3VtKGdldE51bWJlclZhbHVlKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBVkVSQUdFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYXZnKGdldE51bWJlclZh\nbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRE\nSVNUSU5DVFBBVEg6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5k\naXN0aW5jdChnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURVhJU1RTOgogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3RvcnkuaXNOb3RFbXB0eSgoVmFsdWUpIGV2YWwob25seUNoaWxkKG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFOWToKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LmFueSgoVmFsdWUpIGV2YWwob25seUNoaWxkKG5v\nZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFMTDoKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWN0b3J5LmFsbCgoVmFsdWUpIGV2YWwob25seUNoaWxk\nKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNVQlNFTEVDVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShub2RlKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUTUVNQkVST0Y6CiAgICAgICAgICAgICAgICB2YWwx\nID0gZ2V0VmFsdWUobGVmdChub2RlKSwgVkFSX1BBVEgpOwogICAgICAgICAg\nICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpLCBWQVJfUEFUSCk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdENvbnRhaW5zVHlwZXModmFs\nMiwgdmFsMSwgQ09OVEFJTlNfVFlQRV9FTEVNRU5UKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBldmFsTm90KG5vdCwgZmFjdG9yeS5jb250YWlucyh2YWwy\nLCB2YWwxKSk7CgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlREQVRFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudERhdGUo\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVFRJTUU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5nZXRDdXJyZW50VGltZSgpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRDVVJSRU5UVElNRVNUQU1QOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudFRpbWVzdGFtcCgpOwoK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX0ZBVEFMLCAiYmFkLXRyZWUiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgc2V0SW1wbGljaXRUeXBl\ncyhWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLCBDbGFzcyBleHBlY3RlZCkgewog\nICAgICAgIHN1cGVyLnNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgZXhw\nZWN0ZWQpOwoKICAgICAgICAvLyBhcyB3ZWxsIGFzIHNldHRpbmcgdGhlIHR5\ncGVzIGZvciBjb252ZXJzaW9ucywgd2UgYWxzbyBuZWVkIHRvCiAgICAgICAg\nLy8gZW5zdXJlIHRoYXQgYW55IHBhcmFtZXRlcnMgYXJlIGRlY2xhcmVkIHdp\ndGggdGhlIGNvcnJlY3QgdHlwZSwKICAgICAgICAvLyBzaW5jZSB0aGUgSlBB\nIHNwZWMgZXhwZWN0cyB0aGF0IHRoZXNlIHdpbGwgYmUgdmFsaWRhdGVkCiAg\nICAgICAgUGFyYW1ldGVyIHBhcmFtID0gdmFsMSBpbnN0YW5jZW9mIFBhcmFt\nZXRlciA/IChQYXJhbWV0ZXIpIHZhbDEKICAgICAgICAgICAgOiB2YWwyIGlu\nc3RhbmNlb2YgUGFyYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMiA6IG51bGw7\nCiAgICAgICAgUGF0aCBwYXRoID0gdmFsMSBpbnN0YW5jZW9mIFBhdGggPyAo\nUGF0aCkgdmFsMQogICAgICAgICAgICA6IHZhbDIgaW5zdGFuY2VvZiBQYXRo\nID8gKFBhdGgpIHZhbDIgOiBudWxsOwoKICAgICAgICAvLyB3ZSBvbmx5IGNo\nZWNrIGZvciBwYXJhbWV0ZXItdG8tcGF0aCBjb21wYXJpc29ucwogICAgICAg\nIGlmIChwYXJhbSA9PSBudWxsIHx8IHBhdGggPT0gbnVsbCB8fCBwYXJhbWV0\nZXJUeXBlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0KCk7CiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENs\nYXNzIHR5cGUgPSBmbWQuZ2V0VHlwZSgpOwogICAgICAgIGlmICh0eXBlID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHBh\ncmFtTmFtZSA9IHBhcmFtLmdldFBhcmFtZXRlck5hbWUoKTsKICAgICAgICBp\nZiAocGFyYW1OYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgYWxyZWFkeSBkZWNsYXJlZCB0\naGUgcGFyYW1ldGVyCiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVzLmNvbnRh\naW5zS2V5KHBhcmFtTmFtZSkpCiAgICAgICAgICAgIHBhcmFtZXRlclR5cGVz\nLnB1dChwYXJhbU5hbWUsIHR5cGUpOwogICAgfQoKICAgIHByaXZhdGUgVmFs\ndWUgZ2V0U3RyaW5nVmFsdWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJl\ndHVybiBnZXRUeXBlVmFsdWUobm9kZSwgVFlQRV9TVFJJTkcpOwogICAgfQoK\nICAgIHByaXZhdGUgVmFsdWUgZ2V0TnVtYmVyVmFsdWUoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIHJldHVybiBnZXRUeXBlVmFsdWUobm9kZSwgVFlQRV9O\nVU1CRVIpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0VHlwZVZhbHVl\nKEpQUUxOb2RlIG5vZGUsIENsYXNzIGltcGxpY2l0VHlwZSkgewogICAgICAg\nIFZhbHVlIHZhbCA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIHNldEltcGxp\nY2l0VHlwZSh2YWwsIGltcGxpY2l0VHlwZSk7CiAgICAgICAgcmV0dXJuIHZh\nbDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFN1YnF1ZXJ5KEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMg\nPSB0cnVlOwogICAgICAgIFN0cmluZyBhbGlhcyA9IG5leHRBbGlhcygpOwoK\nICAgICAgICAvLyBwYXJzZSB0aGUgc3VicXVlcnkKICAgICAgICBQYXJzZWRK\nUFFMIHBhcnNlZCA9IG5ldyBQYXJzZWRKUFFMKG5vZGUucGFyc2VyLmpwcWws\nIG5vZGUpOwoKICAgICAgICBDbGFzc01ldGFEYXRhIGNhbmRpZGF0ZSA9IGdl\ndENhbmRpZGF0ZU1ldGFEYXRhKG5vZGUpOwogICAgICAgIFN1YnF1ZXJ5IHN1\nYnEgPSBmYWN0b3J5Lm5ld1N1YnF1ZXJ5KGNhbmRpZGF0ZSwgc3ViY2xhc3Nl\ncywgYWxpYXMpOwogICAgICAgIHN1YnEuc2V0TWV0YURhdGEoY2FuZGlkYXRl\nKTsKCiAgICAgICAgY29udGV4dHMucHVzaChuZXcgQ29udGV4dChwYXJzZWQs\nIHN1YnEpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgUXVlcnlFeHBy\nZXNzaW9ucyBzdWJleHAgPSBnZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAg\nICAgICAgIHN1YnEuc2V0UXVlcnlFeHByZXNzaW9ucyhzdWJleHApOwogICAg\nICAgICAgICByZXR1cm4gc3VicTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAvLyByZW1vdmUgdGhlIHN1YnF1ZXJ5IHBhcnNlIGNvbnRleHQK\nICAgICAgICAgICAgY29udGV4dHMucG9wKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBuYW1lcyBhbmQgb3JkZXIgb2Yg\naW1wbGljaXQgcGFyYW1ldGVycy4KICAgICAqLwogICAgcHJpdmF0ZSBQYXJh\nbWV0ZXIgZ2V0UGFyYW1ldGVyKFN0cmluZyBpZCwgYm9vbGVhbiBwb3NpdGlv\nbmFsKSB7CiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVzID09IG51bGwpCiAg\nICAgICAgICAgIHBhcmFtZXRlclR5cGVzID0gbmV3IExpbmtlZE1hcCg2KTsK\nICAgICAgICBpZiAoIXBhcmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5KGlkKSkK\nICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXMucHV0KGlkLCBUWVBFX09CSkVD\nVCk7CgogICAgICAgIENsYXNzIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbnVsbDsKICAgICAgICBpbnQgaW5k\nZXg7CgogICAgICAgIGlmIChwb3NpdGlvbmFsKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAvLyBpbmRleGVzIGluIEpQUUwgYXJlIDEt\nYmFzZWQsIGFzIG9wcG9zZWQgdG8gMC1iYXNlZCBpbgogICAgICAgICAgICAg\nICAgLy8gdGhlIGNvcmUgRXhwcmVzc2lvbkZhY3RvcnkKICAgICAgICAgICAg\nICAgIGluZGV4ID0gSW50ZWdlci5wYXJzZUludChpZCkgLSAxOwogICAgICAg\nICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJh\nZC1wb3NpdGlvbmFsLXBhcmFtZXRlciIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBpZCB9LCBlKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX1VTRVIsICJiYWQtcG9zaXRpb25hbC1wYXJhbWV0\nZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgaWQgfSwg\nbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gb3RoZXJ3\naXNlIHRoZSBpbmRleCBpcyBqdXN0IHRoZSBjdXJyZW50IHNpemUgb2YgdGhl\nIHBhcmFtcwogICAgICAgICAgICBpbmRleCA9IHBhcmFtZXRlclR5cGVzLmlu\nZGV4T2YoaWQpOwogICAgICAgIH0KCiAgICAgICAgUGFyYW1ldGVyIHBhcmFt\nID0gZmFjdG9yeS5uZXdQYXJhbWV0ZXIoaWQsIHR5cGUpOwogICAgICAgIHBh\ncmFtLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgIHBhcmFtLnNldEluZGV4\nKGluZGV4KTsKCiAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgfQoKICAgIC8q\nKgogICAgICogQ2hlY2tzIHRvIHNlZSBpZiB3ZSBzaG91bGQgZXZhbHVhdGUg\nZm9yIGEgTk9UIGV4cHJlc3Npb24uCiAgICAgKi8KICAgIHByaXZhdGUgRXhw\ncmVzc2lvbiBldmFsTm90KGJvb2xlYW4gbm90LCBFeHByZXNzaW9uIGV4cCkg\newogICAgICAgIHJldHVybiBub3QgPyBmYWN0b3J5Lm5vdChleHApIDogZXhw\nOwogICAgfQoKICAgIC8qKgogICAgICogVHJpbSBvZmYgbGVhZGluZyBhbmQg\ndHJhaWxpbmcgc2luZ2xlLXF1b3RlcywgYW5kIHRoZW4KICAgICAqIHJlcGxh\nY2UgYW55IGludGVybmFsICcnIGluc3RhbmNlcyB3aXRoICcgKHNpbmNlIHJl\ncGVhdGluZyB0aGUKICAgICAqIHF1b3RlIGlzIHRoZSBKUFFMIG1lY2hhbmlz\nbSBvZiBlc2NhcGluZyBhIHNpbmdsZSBxdW90ZSkuCiAgICAgKi8KICAgIHBy\naXZhdGUgU3RyaW5nIHRyaW1RdW90ZXMoU3RyaW5nIHN0cikgewogICAgICAg\nIGlmIChzdHIgPT0gbnVsbCB8fCBzdHIubGVuZ3RoKCkgPD0gMSkKICAgICAg\nICAgICAgcmV0dXJuIHN0cjsKCiAgICAgICAgaWYgKHN0ci5zdGFydHNXaXRo\nKCInIikgJiYgc3RyLmVuZHNXaXRoKCInIikpCiAgICAgICAgICAgIHN0ciA9\nIHN0ci5zdWJzdHJpbmcoMSwgc3RyLmxlbmd0aCgpIC0gMSk7CgogICAgICAg\nIGludCBpbmRleCA9IC0xOwoKICAgICAgICB3aGlsZSAoKGluZGV4ID0gc3Ry\nLmluZGV4T2YoIicnIiwgaW5kZXggKyAxKSkgIT0gLTEpCiAgICAgICAgICAg\nIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgaW5kZXggKyAxKSArIHN0ci5zdWJz\ndHJpbmcoaW5kZXggKyAyKTsKCiAgICAgICAgcmV0dXJuIHN0cjsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFuIEludGVnZXJMaXRlcmFsIGFuZCBEZWNpbWFs\nTGl0ZXJhbCBub2RlIHdpbGwKICAgICAqIGhhdmUgYSBjaGlsZCBub2RlIG9m\nIE5lZ2F0aXZlIGlmIGl0IGlzIG5lZ2F0aXZlOgogICAgICogaWYgc28sIHRo\naXMgbWV0aG9kIHJldHVybnMgLTEsIGVsc2UgaXQgcmV0dXJucyAxLgogICAg\nICovCiAgICBwcml2YXRlIHNob3J0IG5lZ2F0aXZlKEpQUUxOb2RlIG5vZGUp\nIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAhPSBudWxsICYmIG5vZGUu\nY2hpbGRyZW4ubGVuZ3RoID09IDEKICAgICAgICAgICAgJiYgZmlyc3RDaGls\nZChub2RlKS5pZCA9PSBKSlRORUdBVElWRSkKICAgICAgICAgICAgcmV0dXJu\nIC0xOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICB9\nCgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRJZGVudGlmaWVyKEpQUUxOb2RlIG5v\nZGUpIHsKICAgICAgICBmaW5hbCBTdHJpbmcgbmFtZSA9IG5vZGUudGV4dDsK\nICAgICAgICBmaW5hbCBWYWx1ZSB2YWwgPSBnZXRWYXJpYWJsZShuYW1lLCBm\nYWxzZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0TWV0YURh\ndGFGb3JBbGlhcyhuYW1lKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xh\nc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAgICAgLy8gZm9yIHRoZSBj\nYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAg\nICAgICAgICAgIFZhbHVlIHRoaXogPSBmYWN0b3J5LmdldFRoaXMoKTsKICAg\nICAgICAgICAgdGhpei5zZXRNZXRhRGF0YShjbWQpOwogICAgICAgICAgICBy\nZXR1cm4gdGhpejsKICAgICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIFBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuIChQYXRoKSB2YWw7CiAgICAg\nICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBWYWx1ZSkgewogICAgICAg\nICAgICByZXR1cm4gKFZhbHVlKSB2YWw7CiAgICAgICAgfQoKICAgICAgICB0\naHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAidW5rbm93bi1pZGVudGlm\naWVyIiwKICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBuYW1lIH0sIG51bGwp\nOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0UGF0aE9yQ29uc3RhbnQo\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIC8vIGZpcnN0IGNoZWNrIHRvIHNl\nZSBpZiB0aGUgcGF0aCBpcyBhbiBlbnVtIG9yIHN0YXRpYyBmaWVsZCwgYW5k\nCiAgICAgICAgLy8gaWYgc28sIGxvYWQgaXQKICAgICAgICBTdHJpbmcgY2xh\nc3NOYW1lID0gYXNzZW1ibGUobm9kZSwgIi4iLCAxKTsKICAgICAgICBDbGFz\ncyBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKGNsYXNzTmFtZSwgbnVsbCk7\nCiAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcg\nZmllbGROYW1lID0gbGFzdENoaWxkKG5vZGUpLnRleHQ7CgogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgRmllbGQgZmllbGQgPSBjLmdldEZp\nZWxkKGZpZWxkTmFtZSk7CiAgICAgICAgICAgICAgICBPYmplY3QgdmFsdWUg\nPSBmaWVsZC5nZXQobnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5uZXdMaXRlcmFsKHZhbHVlLCBMaXRlcmFsLlRZUEVfVU5LTk9XTik7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaEZpZWxkRXhjZXB0aW9uIG5z\nZmUpIHsKICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJuby1maWVsZCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBjbGFzc05hbWUsIGZpZWxkTmFtZSB9LCBuc2ZlKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmFjY2Vzc2libGUt\nZmllbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgY2xh\nc3NOYW1lLCBmaWVsZE5hbWUgfSwgZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0UGF0aChub2RlLCBm\nYWxzZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgUGF0\naCBnZXRQYXRoKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gZ2V0\nUGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSBQ\nYXRoIGdldFBhdGgoSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiBwY09ubHksIGJv\nb2xlYW4gaW5uZXIpIHsKICAgICAgICAvLyByZXNvbHZlIHRoZSBmaXJzdCBl\nbGVtZW50IGFnYWluc3QgdGhlIGFsaWFzZXMgbWFwIC4uLgogICAgICAgIC8v\nIGkuZS4sIHRoZSBwYXRoICJTRUxFQ1QgeC5pZCBGUk9NIFNvbWVDbGFzcyB4\nIHdoZXJlIHguaWQgPiAxMCIKICAgICAgICAvLyB3aWxsIG5lZWQgdG8gaGF2\nZSAieCIgaW4gdGhlIGFsaWFzIG1hcCBpbiBvcmRlciB0byByZXNvbHZlCiAg\nICAgICAgUGF0aCBwYXRoOwoKICAgICAgICBmaW5hbCBTdHJpbmcgbmFtZSA9\nIGZpcnN0Q2hpbGQobm9kZSkudGV4dDsKICAgICAgICBmaW5hbCBWYWx1ZSB2\nYWwgPSBnZXRWYXJpYWJsZShuYW1lLCBmYWxzZSk7CgogICAgICAgIC8vIGhh\nbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xhc3MgbmFtZSBpcyB0aGUgYWxp\nYXMKICAgICAgICAvLyBmb3IgdGhlIGNhbmRpZGF0ZSAod2UgZG9uJ3QgdXNl\nIHZhcmlhYmxlcyBmb3IgdGhpcykKICAgICAgICBpZiAobmFtZS5lcXVhbHNJ\nZ25vcmVDYXNlKGN0eCgpLnNjaGVtYUFsaWFzKSkgewogICAgICAgICAgICBp\nZiAoY3R4KCkuc3VicXVlcnkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\ncGF0aCA9IGZhY3RvcnkubmV3UGF0aChjdHgoKS5zdWJxdWVyeSk7CiAgICAg\nICAgICAgICAgICBwYXRoLnNldE1ldGFEYXRhKGN0eCgpLnN1YnF1ZXJ5Lmdl\ndE1ldGFEYXRhKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0aCgpOwogICAgICAgICAgICAg\nICAgcGF0aC5zZXRNZXRhRGF0YShjdHgoKS5tZXRhKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSBpZiAoZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1l\nKSAhPSBudWxsKQogICAgICAgICAgICBwYXRoID0gbmV3UGF0aChudWxsLCBn\nZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBQYXRoKQogICAgICAgICAgICBwYXRoID0gKFBhdGgp\nIHZhbDsKICAgICAgICBlbHNlIGlmICh2YWwuZ2V0TWV0YURhdGEoKSAhPSBu\ndWxsKQogICAgICAgICAgICBwYXRoID0gbmV3UGF0aCh2YWwsIHZhbC5nZXRN\nZXRhRGF0YSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRoLW5vLW1ldGEiLAogICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBhc3NlbWJsZShub2RlKSwgbnVsbCB9\nLCBudWxsKTsKCiAgICAgICAgLy8gd2FsayB0aHJvdWdoIHRoZSBjaGlsZHJl\nbiBhbmQgYXNzZW1ibGUgdGhlIHBhdGgKICAgICAgICBib29sZWFuIGFsbG93\nTnVsbCA9ICFpbm5lcjsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IG5v\nZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcGF0aCA9\nIChQYXRoKSB0cmF2ZXJzZVBhdGgocGF0aCwgbm9kZS5jaGlsZHJlbltpXS50\nZXh0LCBwY09ubHksCiAgICAgICAgICAgICAgICBhbGxvd051bGwpOwoKICAg\nICAgICAgICAgLy8gYWxsIHRyYXZlcnNhbHMgYnV0IHRoZSBmaXJzdCBvbmUg\nd2lsbCBhbHdheXMgYmUgaW5uZXIgam9pbnMKICAgICAgICAgICAgYWxsb3dO\ndWxsID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcGF0aDsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3MgZ2V0RGVjbGFyZWRWYXJpYWJs\nZVR5cGUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIGNt\nZCA9IGdldE1ldGFEYXRhRm9yQWxpYXMobmFtZSk7CiAgICAgICAgaWYgKGNt\nZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY21kLmdldERlc2NyaWJl\nZFR5cGUoKTsKCiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBuYW1lLmVx\ndWFscyhjdHgoKS5zY2hlbWFBbGlhcykpCiAgICAgICAgICAgIHJldHVybiBn\nZXRDYW5kaWRhdGVUeXBlKCk7CgogICAgICAgIC8vIEpQUUwgaGFzIG5vIGRl\nY2xhcmVkIHZhcmlhYmxlcwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyBhbiBFeHByZXNzaW9uIGZvciB0aGUg\nZ2l2ZW4gbm9kZSBieSBldmFsJ2luZyBpdC4KICAgICAqLwogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGdldEV4cHJlc3Npb24oSlBRTE5vZGUgbm9kZSkgewog\nICAgICAgIE9iamVjdCBleHAgPSBldmFsKG5vZGUpOwoKICAgICAgICAvLyBj\naGVjayBmb3IgYm9vbGVhbiB2YWx1ZXMgdXNlZCBhcyBleHByZXNzaW9ucwog\nICAgICAgIGlmICghKGV4cCBpbnN0YW5jZW9mIEV4cHJlc3Npb24pKQogICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5hc0V4cHJlc3Npb24oKFZhbHVlKSBl\neHApOwogICAgICAgIHJldHVybiAoRXhwcmVzc2lvbikgZXhwOwogICAgfQoK\nICAgIHByaXZhdGUgVmFsdWUgZ2V0VmFsdWUoSlBRTE5vZGUgbm9kZSkgewog\nICAgICAgIHJldHVybiBnZXRWYWx1ZShub2RlLCBWQVJfUEFUSCk7CiAgICB9\nCgogICAgcHJpdmF0ZSBQYXRoIG5ld1BhdGgoVmFsdWUgdmFsLCBDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBQYXRoIHBhdGggPSB2YWwgPT0gbnVs\nbCA/IGZhY3RvcnkubmV3UGF0aCgpIDogZmFjdG9yeS5uZXdQYXRoKHZhbCk7\nCiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcGF0aC5z\nZXRNZXRhRGF0YShtZXRhKTsKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgYSBWYWx1ZSBmb3IgdGhlIGdpdmVu\nIG5vZGUgYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8KICAgIHByaXZhdGUgVmFs\ndWUgZ2V0VmFsdWUoSlBRTE5vZGUgbm9kZSwgaW50IGhhbmRsZVZhcikgewog\nICAgICAgIFZhbHVlIHZhbCA9IChWYWx1ZSkgZXZhbChub2RlKTsKCiAgICAg\nICAgLy8gZGV0ZXJtaW5kIGhvdyB0byBldmF1YXRlIGEgdmFyaWFiZQogICAg\nICAgIGlmICghdmFsLmlzVmFyaWFibGUoKSkKICAgICAgICAgICAgcmV0dXJu\nIHZhbDsKICAgICAgICBlbHNlIGlmIChoYW5kbGVWYXIgPT0gVkFSX1BBVEgg\nJiYgISh2YWwgaW5zdGFuY2VvZiBQYXRoKSkKICAgICAgICAgICAgcmV0dXJu\nIG5ld1BhdGgodmFsLCB2YWwuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgZWxz\nZSBpZiAoaGFuZGxlVmFyID09IFZBUl9FUlJPUikKICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInVuZXhwZWN0ZWQtdmFyIiwK\nICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZS50ZXh0IH0sIG51\nbGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQ\nYXJzZSBDb250ZXh0IE1hbmFnZW1lbnQKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KCiAgICBwcml2YXRlIENvbnRleHQgY3R4KCkgewogICAg\nICAgIHJldHVybiAoQ29udGV4dCkgY29udGV4dHMucGVlaygpOwogICAgfQoK\nICAgIHByaXZhdGUgSlBRTE5vZGUgcm9vdCgpIHsKICAgICAgICByZXR1cm4g\nY3R4KCkucGFyc2VkLnJvb3Q7CiAgICB9CgogICAgcHJpdmF0ZSBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhRm9yQWxpYXMoU3RyaW5nIGFsaWFzKSB7CiAg\nICAgICAgZm9yIChpbnQgaSA9IGNvbnRleHRzLnNpemUoKSAtIDE7IGkgPj0g\nMDsgaS0tKSB7CiAgICAgICAgICAgIENvbnRleHQgY29udGV4dCA9IChDb250\nZXh0KSBjb250ZXh0cy5nZXQoaSk7CiAgICAgICAgICAgIGlmIChhbGlhcy5l\ncXVhbHNJZ25vcmVDYXNlKGNvbnRleHQuc2NoZW1hQWxpYXMpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGNvbnRleHQubWV0YTsKICAgICAgICB9CgogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQ29u\ndGV4dCB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUGFyc2VkSlBRTCBwYXJz\nZWQ7CiAgICAgICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAg\nICAgcHJpdmF0ZSBTdHJpbmcgc2NoZW1hQWxpYXM7CiAgICAgICAgcHJpdmF0\nZSBTdWJxdWVyeSBzdWJxdWVyeTsKCiAgICAgICAgQ29udGV4dChQYXJzZWRK\nUFFMIHBhcnNlZCwgU3VicXVlcnkgc3VicXVlcnkpIHsKICAgICAgICAgICAg\ndGhpcy5wYXJzZWQgPSBwYXJzZWQ7CiAgICAgICAgICAgIHRoaXMuc3VicXVl\ncnkgPSBzdWJxdWVyeTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTm9kZSB0cmF2ZXJzYWwgdXRp\nbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHJpdmF0ZSBKUFFMTm9kZSBvbmx5Q2hpbGQoSlBRTE5vZGUgbm9kZSkKICAg\nICAgICB0aHJvd3MgVXNlckV4Y2VwdGlvbiB7CiAgICAgICAgSlBRTE5vZGUg\nY2hpbGQgPSBmaXJzdENoaWxkKG5vZGUpOwoKICAgICAgICBpZiAobm9kZS5j\naGlsZHJlbi5sZW5ndGggPiAxKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4\nY2VwdGlvbihFWF9VU0VSLCAibXVsdGktY2hpbGRyZW4iLAogICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdeyBub2RlLCBBcnJheXMuYXNMaXN0KG5vZGUu\nY2hpbGRyZW4pIH0sIG51bGwpOwoKICAgICAgICByZXR1cm4gY2hpbGQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBsZWZ0IG5vZGUgKHRo\nZSBmaXJzdCBvZiB0aGUgY2hpbGRyZW4pLCBhbmQgYXNzZXJ0cwogICAgICog\ndGhhdCB0aGVyZSBhcmUgZXhhY3RseSB0d28gY2hpbGRyZW4uCiAgICAgKi8K\nICAgIHByaXZhdGUgSlBRTE5vZGUgbGVmdChKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgcmV0dXJuIGNoaWxkKG5vZGUsIDAsIDIpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0aGUgcmlnaHQgbm9kZSAodGhlIHNlY29uZCBv\nZiB0aGUgY2hpbGRyZW4pLCBhbmQgYXNzZXJ0cwogICAgICogdGhhdCB0aGVy\nZSBhcmUgZXhhY3RseSB0d28gY2hpbGRyZW4uCiAgICAgKi8KICAgIHByaXZh\ndGUgSlBRTE5vZGUgcmlnaHQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJl\ndHVybiBjaGlsZChub2RlLCAxLCAyKTsKICAgIH0KCiAgICBwcml2YXRlIEpQ\nUUxOb2RlIGNoaWxkKEpQUUxOb2RlIG5vZGUsIGludCBjaGlsZE51bSwgaW50\nIGFzc2VydENvdW50KSB7CiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVu\nZ3RoICE9IGFzc2VydENvdW50KQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4\nY2VwdGlvbihFWF9VU0VSLCAid3JvbmctY2hpbGQtY291bnQiLAogICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBuZXcgSW50ZWdlcihhc3NlcnRDb3Vu\ndCksIG5vZGUsCiAgICAgICAgICAgICAgICAgICAgQXJyYXlzLmFzTGlzdChu\nb2RlLmNoaWxkcmVuKSB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIG5vZGUu\nY2hpbGRyZW5bY2hpbGROdW1dOwogICAgfQoKICAgIHByaXZhdGUgSlBRTE5v\nZGUgZmlyc3RDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5v\nZGUuY2hpbGRyZW4gPT0gbnVsbCB8fCBub2RlLmNoaWxkcmVuLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm8tY2hpbGRyZW4iLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBub2RlIH0sIG51bGwpOwogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVu\nWzBdOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIHNlY29u\nZENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5j\naGlsZHJlblsxXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9k\nZSB0aGlyZENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4g\nbm9kZS5jaGlsZHJlblsyXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBK\nUFFMTm9kZSBsYXN0Q2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJl\ndHVybiBsYXN0Q2hpbGQobm9kZSwgMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgTnRoIGZyb20gdGhlIGxhc3QgY2hpbGQuIEUuZy4sCiAgICAgKiBs\nYXN0Q2hpbGQoMSkgd2lsbCByZXR1cm4gdGhlIHNlY29uZC10by10aGUtbGFz\ndCBjaGlsZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUg\nbGFzdENoaWxkKEpQUUxOb2RlIG5vZGUsIGludCBmcm9tTGFzdCkgewogICAg\nICAgIHJldHVybiBub2RlLmNoaWxkcmVuW25vZGUuY2hpbGRyZW4ubGVuZ3Ro\nIC0gKDEgKyBmcm9tTGFzdCldOwogICAgfQoKICAgIC8qKgogICAgICogQmFz\nZSBub2RlIHRoYXQgd2lsbCBiZSBnZW5lcmF0ZWQgYnkgdGhlIEpQUUxFeHBy\nZXNzaW9uQnVpbGRlcjsgYmFzZQogICAgICogY2xhc3Mgb2YgdGhlIHtAbGlu\nayBTaW1wbGVOb2RlfSB0aGF0IGlzIHVzZWQgYnkge0BsaW5rIEpQUUx9Lgog\nICAgICoKICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAg\nKiBAc2VlIE5vZGUKICAgICAqIEBzZWUgU2ltcGxlTm9kZQogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIEpQUUxOb2RlCiAg\nICAgICAgaW1wbGVtZW50cyBOb2RlLCBTZXJpYWxpemFibGUgewoKICAgICAg\nICBmaW5hbCBpbnQgaWQ7CiAgICAgICAgZmluYWwgSlBRTCBwYXJzZXI7CiAg\nICAgICAgSlBRTE5vZGUgcGFyZW50OwogICAgICAgIEpQUUxOb2RlW10gY2hp\nbGRyZW47CiAgICAgICAgU3RyaW5nIHRleHQ7CiAgICAgICAgYm9vbGVhbiBu\nb3QgPSBmYWxzZTsKCiAgICAgICAgcHVibGljIEpQUUxOb2RlKEpQUUwgcGFy\nc2VyLCBpbnQgaWQpIHsKICAgICAgICAgICAgdGhpcy5pZCA9IGlkOwogICAg\nICAgICAgICB0aGlzLnBhcnNlciA9IHBhcnNlcjsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGpqdE9wZW4oKSB7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBqanRDbG9zZSgpIHsKICAgICAgICB9CgogICAgICAg\nIEpQUUxOb2RlW10gZmluZENoaWxkcmVuQnlJRChpbnQgaWQpIHsKICAgICAg\nICAgICAgQ29sbGVjdGlvbiBzZXQgPSBuZXcgSGFzaFNldCgpOwogICAgICAg\nICAgICBmaW5kQ2hpbGRyZW5CeUlEKGlkLCBzZXQpOwogICAgICAgICAgICBy\nZXR1cm4gKEpQUUxOb2RlW10pIHNldC50b0FycmF5KG5ldyBKUFFMTm9kZVtz\nZXQuc2l6ZSgpXSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQg\nZmluZENoaWxkcmVuQnlJRChpbnQgaWQsIENvbGxlY3Rpb24gc2V0KSB7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBjaGlsZHJlbiAhPSBudWxsICYm\nIGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKGNoaWxkcmVuW2ldLmlkID09IGlkKQogICAgICAgICAgICAgICAgICAg\nIHNldC5hZGQoY2hpbGRyZW5baV0pOwoKICAgICAgICAgICAgICAgIGNoaWxk\ncmVuW2ldLmZpbmRDaGlsZHJlbkJ5SUQoaWQsIHNldCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gaGFzQ2hpbGRJRChpbnQg\naWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZpbmRDaGlsZEJ5SUQoaWQsIGZh\nbHNlKSAhPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgSlBRTE5vZGUgZmlu\nZENoaWxkQnlJRChpbnQgaWQsIGJvb2xlYW4gcmVjdXJzZSkgewogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgY2hpbGRyZW4gIT0gbnVsbCAmJiBpIDwg\nY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIEpQUUxO\nb2RlIGNoaWxkID0gY2hpbGRyZW5baV07CgogICAgICAgICAgICAgICAgaWYg\nKGNoaWxkLmlkID09IGlkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBj\naGlsZHJlbltpXTsKCiAgICAgICAgICAgICAgICBpZiAocmVjdXJzZSkgewog\nICAgICAgICAgICAgICAgICAgIEpQUUxOb2RlIGZvdW5kID0gY2hpbGQuZmlu\nZENoaWxkQnlJRChpZCwgcmVjdXJzZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGZvdW5kICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmb3VuZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gbm90IGZvdW5kCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgamp0U2V0UGFy\nZW50KE5vZGUgcGFyZW50KSB7CiAgICAgICAgICAgIHRoaXMucGFyZW50ID0g\nKEpQUUxOb2RlKSBwYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nTm9kZSBqanRHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlz\nLnBhcmVudDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGpqdEFk\nZENoaWxkKE5vZGUgbiwgaW50IGkpIHsKICAgICAgICAgICAgaWYgKGNoaWxk\ncmVuID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gbmV3\nIEpQUUxOb2RlW2kgKyAxXTsKICAgICAgICAgICAgfSBlbHNlIGlmIChpID49\nIGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgICAgICAgSlBRTE5vZGUg\nY1tdID0gbmV3IEpQUUxOb2RlW2kgKyAxXTsKICAgICAgICAgICAgICAgIFN5\nc3RlbS5hcnJheWNvcHkoY2hpbGRyZW4sIDAsIGMsIDAsIGNoaWxkcmVuLmxl\nbmd0aCk7CiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGM7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGNoaWxkcmVuW2ldID0gKEpQUUxOb2RlKSBu\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5vZGUgamp0R2V0Q2hpbGQo\naW50IGkpIHsKICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuW2ldOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRDaGlsZENvdW50KCkgewog\nICAgICAgICAgICByZXR1cm4gamp0R2V0TnVtQ2hpbGRyZW4oKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBKUFFMTm9kZSBnZXRDaGlsZChpbnQgaW5k\nZXgpIHsKICAgICAgICAgICAgcmV0dXJuIChKUFFMTm9kZSkgamp0R2V0Q2hp\nbGQoaW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9y\nIGl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlz\ndChjaGlsZHJlbikuaXRlcmF0b3IoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgamp0R2V0TnVtQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIHJl\ndHVybiAoY2hpbGRyZW4gPT0gbnVsbCkgPyAwIDogY2hpbGRyZW4ubGVuZ3Ro\nOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRUZXh0KFN0cmluZyB0ZXh0\nKSB7CiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CiAgICAgICAgfQoK\nICAgICAgICB2b2lkIHNldFRva2VuKFRva2VuIHQpIHsKICAgICAgICAgICAg\nc2V0VGV4dCh0LmltYWdlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBKUFFMVHJl\nZUNvbnN0YW50cy5qanROb2RlTmFtZVt0aGlzLmlkXTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoU3RyaW5nIHByZWZpeCkg\newogICAgICAgICAgICByZXR1cm4gcHJlZml4ICsgdG9TdHJpbmcoKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERlYnVnZ2luZyBtZXRo\nb2QuCiAgICAgICAgICoKICAgICAgICAgKiBAc2VlICNkdW1wKGphdmEuaW8u\nUHJpbnRTdHJlYW0sU3RyaW5nKQogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIGR1bXAoU3RyaW5nIHByZWZpeCkgewogICAgICAgICAgICBkdW1w\nKFN5c3RlbS5vdXQsIHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBkdW1wKCkgewogICAgICAgICAgICBkdW1wKCIgIik7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBEZWJ1Z2dpbmcgbWV0aG9k\nIHRvIG91dHB1dCBhIHBhcnNlIHRyZWUuCiAgICAgICAgICoKICAgICAgICAg\nKiBAcGFyYW0gb3V0IHRoZSBzdHJlYW0gdG8gd2hpY2ggdG8gd3JpdGUgdGhl\nIGRlYnVnZ2luZyBpbmZvCiAgICAgICAgICogQHBhcmFtIHByZWZpeCB0aGUg\ncHJlZml4IHRvIHdyaXRlIG91dCBiZWZvcmUgbGluZXMKICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBkdW1wKFByaW50U3RyZWFtIG91dCwgU3Ry\naW5nIHByZWZpeCkgewogICAgICAgICAgICBkdW1wKG91dCwgcHJlZml4LCBm\nYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBkdW1wKFBy\naW50U3RyZWFtIG91dCwgU3RyaW5nIHByZWZpeCwgYm9vbGVhbiB0ZXh0KSB7\nCiAgICAgICAgICAgIG91dC5wcmludGxuKHRvU3RyaW5nKHByZWZpeCkKICAg\nICAgICAgICAgICAgICsgKHRleHQgJiYgdGhpcy50ZXh0ICE9IG51bGwgPyAi\nIFsiICsgdGhpcy50ZXh0ICsgIl0iIDogIiIpKTsKICAgICAgICAgICAgaWYg\nKGNoaWxkcmVuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICAg\nICAgICAgICAgICBKUFFMTm9kZSBuID0gKEpQUUxOb2RlKSBjaGlsZHJlbltp\nXTsKICAgICAgICAgICAgICAgICAgICBpZiAobiAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIG4uZHVtcChvdXQsIHByZWZpeCArICIgIiwg\ndGV4dCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUHVibGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAgICAgKiBA\nbm9qYXZhZG9jCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUGFy\nc2VkSlBRTAogICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAg\nICAgICAgcHJvdGVjdGVkIGZpbmFsIEpQUUxOb2RlIHJvb3Q7CiAgICAgICAg\ncHJvdGVjdGVkIGZpbmFsIFN0cmluZyBxdWVyeTsKICAgICAgICAKICAgICAg\nICAvLyBjYWNoZSBvZiBjYW5kaWRhdGUgdHlwZSBkYXRhLiBUaGlzIGlzIHN0\nb3JlZCBoZXJlIGluIGNhc2UgdGhpcyAgCiAgICAgICAgLy8gcGFyc2UgdHJl\nZSBpcyByZXVzZWQgaW4gYSBjb250ZXh0IHRoYXQgZG9lcyBub3Qga25vdyB3\naGF0IHRoZSAKICAgICAgICAvLyBjYW5kaWRhdGUgdHlwZSBpcyBhbHJlYWR5\nLiAKICAgICAgICBwcml2YXRlIENsYXNzIF9jYW5kaWRhdGVUeXBlOwoKICAg\nICAgICBQYXJzZWRKUFFMKFN0cmluZyBqcHFsKSB7CiAgICAgICAgICAgIHRo\naXMoanBxbCwgcGFyc2UoanBxbCkpOwogICAgICAgIH0KCiAgICAgICAgUGFy\nc2VkSlBRTChTdHJpbmcgcXVlcnksIEpQUUxOb2RlIHJvb3QpIHsKICAgICAg\nICAgICAgdGhpcy5yb290ID0gcm9vdDsKICAgICAgICAgICAgdGhpcy5xdWVy\neSA9IHF1ZXJ5OwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgSlBRTE5vZGUgcGFyc2UoU3RyaW5nIGpwcWwpIHsKICAgICAgICAg\nICAgaWYgKGpwcWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpwcWwgPSAi\nIjsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nKEpQUUxOb2RlKSBuZXcgSlBRTChqcHFsKS5wYXJzZVF1ZXJ5KCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEVycm9yIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIHNwZWNpYWwgaGFuZGxpbmcgZm9yIEVycm9yIHN1YmNsYXNzZXMsIHdoaWNo\nIHRoZQogICAgICAgICAgICAgICAgLy8gcGFyc2VyIG1heSBzb21ldGltZXMg\nKHVuZm9ydHVuYXRlbHkpIHRocm93CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicGFyc2UtZXJyb3IiLAogICAg\nICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZS50b1N0cmluZygpLCBq\ncHFsIH0pKTsKICAgICAgICAgICAgfSBjYXRjaCAoUGFyc2VFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoInBhcnNlLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IGUudG9TdHJpbmcoKSwganBxbCB9KSwgZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZvaWQgcG9wdWxhdGUoRXhw\ncmVzc2lvblN0b3JlUXVlcnkgcXVlcnkpIHsKICAgICAgICAgICAgUXVlcnlD\nb250ZXh0IGN0eCA9IHF1ZXJ5LmdldENvbnRleHQoKTsKCiAgICAgICAgICAg\nIC8vIGlmIHRoZSBvd25pbmcgcXVlcnkncyBjb250ZXh0IGRvZXMgbm90IGhh\ndmUKICAgICAgICAgICAgLy8gYW55IGNhbmRpZGF0ZSBjbGFzcywgdGhlbiBz\nZXQgaXQgaGVyZQogICAgICAgICAgICBpZiAoY3R4LmdldENhbmRpZGF0ZVR5\ncGUoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX2NhbmRpZGF0\nZVR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY2FuZGlkYXRl\nVHlwZSA9IG5ldyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIKICAgICAgICAgICAg\nICAgICAgICAgICAgKG51bGwsIHF1ZXJ5LCB0aGlzKS5nZXRDYW5kaWRhdGVU\neXBlKCk7CiAgICAgICAgICAgICAgICBjdHguc2V0Q2FuZGlkYXRlVHlwZShf\nY2FuZGlkYXRlVHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogUHVibGljIGZvciB1\nbml0IHRlc3RpbmcgcHVycG9zZXMuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIENsYXNzIGdldENhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfY2FuZGlkYXRlVHlwZTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTdHJpbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiB0aGlzLnF1ZXJ5\nOwoJCX0KCX0KfQoK\n","encoding":"base64"}

