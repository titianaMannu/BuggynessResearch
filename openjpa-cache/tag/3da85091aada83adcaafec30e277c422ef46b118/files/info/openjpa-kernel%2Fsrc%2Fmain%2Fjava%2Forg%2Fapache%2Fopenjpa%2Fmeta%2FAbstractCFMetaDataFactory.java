{"sha":"d4d96d2f74413f63e92de3fc1ea4a55331f179e8","node_id":"MDQ6QmxvYjIwNjM2NDpkNGQ5NmQyZjc0NDEzZjYzZTkyZGUzZmMxZWE0YTU1MzMxZjE3OWU4","size":29264,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d4d96d2f74413f63e92de3fc1ea4a55331f179e8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQg\namF2YS5uZXQuTWFsZm9ybWVkVVJMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5u\nZXQuVVJMOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZh\nLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLnppcC5aaXBGaWxlOwppbXBv\ncnQgamF2YS51dGlsLnppcC5aaXBJbnB1dFN0cmVhbTsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubWV0YS5DbGFzc0FyZ1BhcnNlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5DbGFzc3BhdGhNZXRhRGF0\nYUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRh\nLkZpbGVNZXRhRGF0YUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5tZXRhLk1ldGFEYXRhRmlsdGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5tZXRhLk1ldGFEYXRhSXRlcmF0b3I7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuTWV0YURhdGFQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuTWV0YURhdGFTZXJp\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlJl\nc291cmNlTWV0YURhdGFJdGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIubWV0YS5VUkxNZXRhRGF0YUl0ZXJhdG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlppcEZpbGVNZXRhRGF0YUl0ZXJh\ndG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlppcFN0\ncmVhbU1ldGFEYXRhSXRlcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0aWwuU3Ry\naW5nczsKCi8qKgogKiBCYXNlIGNsYXNzIGZvciBmYWN0b3J5IGltcGxlbWVu\ndGF0aW9ucyBidWlsdCBhcm91bmQgWE1MIG1ldGFkYXRhIGZpbGVzCiAqIGlu\nIHRoZSBjb21tb24gZm9tYXQuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nIEBzaW5jZSAwLjQuMAogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEFic3Ry\nYWN0Q0ZNZXRhRGF0YUZhY3RvcnkKICAgIGV4dGVuZHMgQWJzdHJhY3RNZXRh\nRGF0YUZhY3RvcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQWJz\ndHJhY3RNZXRhRGF0YUZhY3RvcnkuY2xhc3MpOwoKICAgIHByb3RlY3RlZCBD\nb2xsZWN0aW9uIGZpbGVzID0gbnVsbDsKICAgIHByb3RlY3RlZCBDb2xsZWN0\naW9uIHVybHMgPSBudWxsOwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gcnNy\nY3MgPSBudWxsOwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gY3BhdGggPSBu\ndWxsOwoKICAgIHByaXZhdGUgU2V0IF90eXBlTmFtZXMgPSBudWxsOwoKICAg\nIC8qKgogICAgICogU2V0IG9mIHtAbGluayBGaWxlfXMgb2YgbWV0YWRhdGEg\nZmlsZXMgb3IgZGlyZWN0b3JpZXMgc3VwcGxpZWQgYnkgdXNlci4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RmlsZXMoQ29sbGVjdGlvbiBmaWxlcykg\newogICAgICAgIHRoaXMuZmlsZXMgPSBmaWxlczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCBvZiBzZW1pY29sb24tc2VwYXJhdGVkIHtAbGluayBGaWxl\nfXMgb2YgbWV0YWRhdGEgZmlsZXMgb3IKICAgICAqIGRpcmVjdG9yaWVzIHN1\ncHBsaWVkIGJ5IHVzZXIgdmlhIGF1dG8tY29uZmlndXJhdGlvbi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RmlsZXMoU3RyaW5nIGZpbGVzKSB7CiAg\nICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZmlsZXMpKQogICAgICAg\nICAgICB0aGlzLmZpbGVzID0gbnVsbDsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgU3RyaW5nW10gc3RycyA9IFN0cmluZ3Muc3BsaXQoZmlsZXMsICI7\nIiwgMCk7CiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBuZXcgSGFzaFNldCgo\naW50KSAoc3Rycy5sZW5ndGggKiAxLjMzICsgMSkpOwoKICAgICAgICAgICAg\nRmlsZSBmaWxlOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0\ncnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcg\nRmlsZShzdHJzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChmaWxlLmV4aXN0\ncygpKQogICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZXMuYWRkKGZpbGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IG9mIHtAbGluayBVUkx9cyBvZiBtZXRhZGF0YSBmaWxlcyBvciBq\nYXJzIHN1cHBsaWVkIGJ5IHVzZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFVSTHMoQ29sbGVjdGlvbiB1cmxzKSB7CiAgICAgICAgdGhpcy51cmxz\nID0gdXJsczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBvZiBzZW1pY29s\nb24tc2VwYXJhdGVkIHtAbGluayBVUkx9cyBvZiBtZXRhZGF0YSBmaWxlcyBv\nciBqYXJzCiAgICAgKiBzdXBwbGllZCBieSB1c2VyIHZpYSBhdXRvLWNvbmZp\nZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFVSTHMoU3Ry\naW5nIHVybHMpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eSh1\ncmxzKSkKICAgICAgICAgICAgdGhpcy51cmxzID0gbnVsbDsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgU3RyaW5nW10gc3RycyA9IFN0cmluZ3Muc3Bs\naXQodXJscywgIjsiLCAwKTsKICAgICAgICAgICAgdGhpcy51cmxzID0gbmV3\nIEhhc2hTZXQoKGludCkgKHN0cnMubGVuZ3RoICogMS4zMyArIDEpKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgc3Rycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICB0\naGlzLnVybHMuYWRkKG5ldyBVUkwoc3Ryc1tpXSkpOwogICAgICAgICAgICB9\nIGNhdGNoIChNYWxmb3JtZWRVUkxFeGNlcHRpb24gbXVlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihtdWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9m\nIHJlc291cmNlIHBhdGhzIG9mIG1ldGFkYXRhIGZpbGVzIG9yIGphcnMgc3Vw\ncGxpZWQgYnkgdXNlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVz\nb3VyY2VzKENvbGxlY3Rpb24gcnNyY3MpIHsKICAgICAgICB0aGlzLnJzcmNz\nID0gcnNyY3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb2Ygc2VtaWNv\nbG9uLXNlcGFyYXRlZCByZXNvdXJjZSBwYXRocyBvZiBtZXRhZGF0YSBmaWxl\ncyBvciBqYXJzCiAgICAgKiBzdXBwbGllZCBieSB1c2VyIHZpYSBhdXRvLWNv\nbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc291\ncmNlcyhTdHJpbmcgcnNyY3MpIHsKICAgICAgICAvLyBrZWVwIGxpc3QgbXV0\nYWJsZSBzbyBzdWJjbGFzc2VzIGNhbiBhZGQgaW1wbGljaXQgbG9jYXRpb25z\nCiAgICAgICAgdGhpcy5yc3JjcyA9IChTdHJpbmdVdGlscy5pc0VtcHR5KHJz\ncmNzKSkgPyBudWxsCiAgICAgICAgICAgIDogbmV3IEFycmF5TGlzdChBcnJh\neXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQocnNyY3MsICI7IiwgMCkpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCBvZiBjbGFzc3BhdGggZGlyZWN0b3Jp\nZXMgb3IgamFycyB0byBzY2FuIGZvciBtZXRhZGF0YSBzdXBwbGllZAogICAg\nICogYnkgdXNlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2xhc3Nw\nYXRoU2NhbihDb2xsZWN0aW9uIGNwYXRoKSB7CiAgICAgICAgdGhpcy5jcGF0\naCA9IGNwYXRoOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9mIGNsYXNz\ncGF0aCBkaXJlY3RvcmllcyBvciBqYXJzIHRvIHNjYW4gZm9yIG1ldGFkYXRh\nIHN1cHBsaWVkCiAgICAgKiBieSB1c2VyIHZpYSBhdXRvLWNvbmZpZ3VyYXRp\nb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENsYXNzcGF0aFNjYW4o\nU3RyaW5nIGNwYXRoKSB7CiAgICAgICAgLy8ga2VlcCBsaXN0IG11dGFibGUg\nc28gc3ViY2xhc3NlcyBjYW4gYWRkIGltcGxpY2l0IGxvY2F0aW9ucwogICAg\nICAgIHRoaXMuY3BhdGggPSAoU3RyaW5nVXRpbHMuaXNFbXB0eShjcGF0aCkp\nID8gbnVsbAogICAgICAgICAgICA6IG5ldyBBcnJheUxpc3QoQXJyYXlzLmFz\nTGlzdChTdHJpbmdzLnNwbGl0KGNwYXRoLCAiOyIsIDApKSk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gc3RvcmUoQ2xhc3NNZXRhRGF0YVtdIG1ldGFz\nLCBRdWVyeU1ldGFEYXRhW10gcXVlcmllcywKICAgICAgICBTZXF1ZW5jZU1l\ndGFEYXRhW10gc2VxcywgaW50IG1vZGUsIE1hcCBvdXRwdXQpIHsKICAgICAg\nICBpZiAobW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmIChpc01hcHBpbmdPbmx5RmFjdG9yeSgpICYmICht\nb2RlICYgTU9ERV9NQVBQSU5HKSA9PSAwKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKCiAgICAgICAgaWYgKCFzdHJpY3QgJiYgKG1vZGUgJiBNT0RFX01F\nVEEpICE9IDApCiAgICAgICAgICAgIG1vZGUgfD0gTU9ERV9NQVBQSU5HOwog\nICAgICAgIENsYXNzIGNscyA9IChtZXRhcy5sZW5ndGggPT0gMCkgPyBudWxs\nIDogbWV0YXNbMF0uZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgIENsYXNz\nTG9hZGVyIGxvYWRlciA9IHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKS4KICAg\nICAgICAgICAgZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNlKCkuZ2V0Q2xhc3NM\nb2FkZXIoY2xzLCBudWxsKTsKICAgICAgICBNYXAgY2xzTmFtZXMgPSBuZXcg\nSGFzaE1hcCgoaW50KSAobWV0YXMubGVuZ3RoICogMS4zMyArIDEpKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBjbHNOYW1lcy5wdXQobWV0YXNbaV0uZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE5hbWUoKSwgbWV0YXNbaV0pOwoKICAgICAgICAvLyBhc3Np\nZ24gZGVmYXVsdCBmaWxlcyBpZiBpbiBtZXRhZGF0YSBtb2RlIChpbiBvdGhl\nciBtb2RlcyB3ZSBhc3N1bWUKICAgICAgICAvLyB0aGUgZmlsZXMgd291bGQg\naGF2ZSB0byBiZSByZWFkIGFscmVhZHkgdG8gY3JlYXRlIHRoZSBtZXRhZGF0\nYXMpCiAgICAgICAgU2V0IG1ldGFGaWxlcyA9IG51bGw7CiAgICAgICAgU2V0\nIHF1ZXJ5RmlsZXMgPSBudWxsOwogICAgICAgIGlmIChpc01hcHBpbmdPbmx5\nRmFjdG9yeSgpIHx8IChtb2RlICYgTU9ERV9NRVRBKSAhPSAwKQogICAgICAg\nICAgICBtZXRhRmlsZXMgPSBhc3NpZ25EZWZhdWx0TWV0YURhdGFGaWxlcyht\nZXRhcywgcXVlcmllcywgc2VxcywgbW9kZSwKICAgICAgICAgICAgICAgIGNs\nc05hbWVzKTsKICAgICAgICBpZiAoIWlzTWFwcGluZ09ubHlGYWN0b3J5KCkg\nJiYgKG1vZGUgJiBNT0RFX1FVRVJZKSAhPSAwKQogICAgICAgICAgICBxdWVy\neUZpbGVzID0gYXNzaWduRGVmYXVsdFF1ZXJ5RmlsZXMocXVlcmllcywgY2xz\nTmFtZXMpOwoKICAgICAgICAvLyBwYXJzZSBhbGwgZmlsZXMgdG8gYmUgc3Vy\nZSB3ZSBkb24ndCBkZWxldGUgZXhpc3RpbmcgbWV0YWRhdGEgd2hlbgogICAg\nICAgIC8vIHdyaXRpbmcgb3V0IG5ldyBtZXRhZGF0YSwgdGhlbiBzZXJpYWxp\nemUKICAgICAgICBTZXJpYWxpemVyIHNlcjsKICAgICAgICBQYXJzZXIgcGFy\nc2VyOwogICAgICAgIGlmIChtb2RlICE9IE1PREVfUVVFUlkpIHsKICAgICAg\nICAgICAgaW50IHNlcm1vZGUgPSAoaXNNYXBwaW5nT25seUZhY3RvcnkoKSkg\nPyBtb2RlIDogbW9kZSB8IE1PREVfTUVUQTsKICAgICAgICAgICAgc2VyID0g\nbmV3U2VyaWFsaXplcigpOwogICAgICAgICAgICBzZXIuc2V0TW9kZShzZXJt\nb2RlKTsKICAgICAgICAgICAgaWYgKG1ldGFGaWxlcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBwYXJzZXIgPSBuZXdQYXJzZXIoZmFsc2UpOwogICAg\nICAgICAgICAgICAgcGFyc2VyLnNldE1vZGUoc2VybW9kZSk7CiAgICAgICAg\nICAgICAgICBwYXJzZXIuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAg\nICAgICAgICAgIHBhcnNlKHBhcnNlciwgbWV0YUZpbGVzKTsKCiAgICAgICAg\nICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcHIgPSBwYXJzZXIuZ2V0UmVw\nb3NpdG9yeSgpOwogICAgICAgICAgICAgICAgcHIuc2V0U291cmNlTW9kZSht\nb2RlKTsKICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPbmx5RmFjdG9y\neSgpKQogICAgICAgICAgICAgICAgICAgIHByLnNldFJlc29sdmUoTU9ERV9O\nT05FKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICBwci5zZXRSZXNvbHZlKE1PREVfTUFQUElORywgZmFsc2UpOwogICAgICAg\nICAgICAgICAgc2VyLmFkZEFsbChwcik7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0YXMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBzZXIuYWRkTWV0YURhdGEobWV0YXNbaV0pOwog\nICAgICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICAgICAgc2VyLmFkZFNlcXVlbmNlTWV0\nYURhdGEoc2Vxc1tpXSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgcXVlcmllcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChx\ndWVyaWVzW2ldLmdldFNvdXJjZU1vZGUoKSAhPSBNT0RFX1FVRVJZCiAgICAg\nICAgICAgICAgICAgICAgJiYgKHF1ZXJpZXNbaV0uZ2V0U291cmNlTW9kZSgp\nICYgbW9kZSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICBzZXIuYWRkUXVl\ncnlNZXRhRGF0YShxdWVyaWVzW2ldKTsKCiAgICAgICAgICAgIGludCBmbGFn\ncyA9IHNlci5QUkVUVFk7CiAgICAgICAgICAgIGlmICgoc3RvcmUgJiBTVE9S\nRV9WRVJCT1NFKSAhPSAwKQogICAgICAgICAgICAgICAgZmxhZ3MgfD0gc2Vy\nLlZFUkJPU0U7CiAgICAgICAgICAgIHNlcmlhbGl6ZShzZXIsIG91dHB1dCwg\nZmxhZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gZG8gd2UgaGF2ZSBhbnkg\ncXVlcmllcyBzdG9yZWQgaW4gcXVlcnkgZmlsZXM/CiAgICAgICAgaWYgKCFp\nc01hcHBpbmdPbmx5RmFjdG9yeSgpKSB7CiAgICAgICAgICAgIGJvb2xlYW4g\ncUZpbGVzID0gcXVlcnlGaWxlcyAhPSBudWxsOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgIXFGaWxlcyAmJiBpIDwgcXVlcmllcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgIHFGaWxlcyA9IHF1ZXJpZXNbaV0uZ2V0U291\ncmNlTW9kZSgpID09IE1PREVfUVVFUlk7CiAgICAgICAgICAgIGlmIChxRmls\nZXMpIHsKICAgICAgICAgICAgICAgIHNlciA9IG5ld1NlcmlhbGl6ZXIoKTsK\nICAgICAgICAgICAgICAgIHNlci5zZXRNb2RlKE1PREVfUVVFUlkpOwogICAg\nICAgICAgICAgICAgaWYgKHF1ZXJ5RmlsZXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHBhcnNlciA9IG5ld1BhcnNlcihmYWxzZSk7CiAgICAg\nICAgICAgICAgICAgICAgcGFyc2VyLnNldE1vZGUoTU9ERV9RVUVSWSk7CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VyLnNldENsYXNzTG9hZGVyKGxvYWRl\ncik7CiAgICAgICAgICAgICAgICAgICAgcGFyc2UocGFyc2VyLCBxdWVyeUZp\nbGVzKTsKICAgICAgICAgICAgICAgICAgICBzZXIuYWRkQWxsKHBhcnNlci5n\nZXRSZXBvc2l0b3J5KCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBxdWVyaWVzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgICAgIGlmIChxdWVyaWVzW2ldLmdldFNvdXJj\nZU1vZGUoKSA9PSBNT0RFX1FVRVJZKQogICAgICAgICAgICAgICAgICAgICAg\nICBzZXIuYWRkUXVlcnlNZXRhRGF0YShxdWVyaWVzW2ldKTsKICAgICAgICAg\nICAgICAgIHNlcmlhbGl6ZShzZXIsIG91dHB1dCwgc2VyLlBSRVRUWSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gZHJvcChDbGFzc1tdIGNscywgaW50\nIG1vZGUsIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmICht\nb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgaWYgKGlzTWFwcGluZ09ubHlGYWN0b3J5KCkgJiYgKG1vZGUgJiBN\nT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoK\nICAgICAgICBQYXJzZXIgcGFyc2VyID0gbmV3UGFyc2VyKGZhbHNlKTsKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcHIgPSBwYXJzZXIuZ2V0UmVwb3Np\ndG9yeSgpOwogICAgICAgIHByLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5H\nLCBmYWxzZSk7CiAgICAgICAgcHIuc2V0UmVzb2x2ZShNT0RFX01BUFBJTkcs\nIGZhbHNlKTsKCiAgICAgICAgLy8gcGFyc2UgbWV0YWRhdGEgZm9yIGFsbCB0\naGVzZSBjbGFzc2VzCiAgICAgICAgaWYgKChtb2RlICYgKE1PREVfTUVUQSB8\nIE1PREVfTUFQUElORykpICE9IDApIHsKICAgICAgICAgICAgcGFyc2VyLnNl\ndE1vZGUoKGlzTWFwcGluZ09ubHlGYWN0b3J5KCkpID8gbW9kZQogICAgICAg\nICAgICAgICAgOiBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RFX1FV\nRVJZKTsKICAgICAgICAgICAgcGFyc2UocGFyc2VyLCBjbHMpOwogICAgICAg\nIH0KICAgICAgICBpZiAoIWlzTWFwcGluZ09ubHlGYWN0b3J5KCkgJiYgKG1v\nZGUgJiBNT0RFX1FVRVJZKSAhPSAwKSB7CiAgICAgICAgICAgIHBhcnNlci5z\nZXRNb2RlKE1PREVfUVVFUlkpOwogICAgICAgICAgICBwYXJzZShwYXJzZXIs\nIGNscyk7CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgbWV0YWRhdGFz\nIGZyb20gcmVwb3NpdG9yeSBvciBjbGVhciB0aGVpciBtYXBwaW5ncwogICAg\nICAgIFNldCBmaWxlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgU2V0IGNs\nc05hbWVzID0gbnVsbDsKICAgICAgICBpZiAoKG1vZGUgJiAoTU9ERV9NRVRB\nIHwgTU9ERV9NQVBQSU5HKSkgIT0gMCkgewogICAgICAgICAgICBjbHNOYW1l\ncyA9IG5ldyBIYXNoU2V0KChpbnQpIChjbHMubGVuZ3RoICogMS4zMyArIDEp\nKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNscy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKGNsc1tpXSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGNsc05hbWVzLmFkZChudWxsKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBjbHNOYW1lcy5hZGQoY2xzW2ldLmdl\ndE5hbWUoKSk7CiAgICAgICAgICAgICAgICBtZXRhID0gcHIuZ2V0TWV0YURh\ndGEoY2xzW2ldLCBlbnZMb2FkZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nZ2V0U291cmNlRmlsZShtZXRhKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICBmaWxlcy5hZGQoZ2V0U291cmNlRmlsZShtZXRhKSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NRVRBKSAhPSAwKQog\nICAgICAgICAgICAgICAgICAgICAgICBwci5yZW1vdmVNZXRhRGF0YShtZXRh\nKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghaXNNYXBwaW5nT25s\neUZhY3RvcnkoKSkKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJNYXBw\naW5nKG1ldGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgcXVlcnkgbW9kZSBtZXRhZGF0\nYXMgc28gd2UgY2FuIHN0b3JlIHRoZW0gc2VwYXJhdGVseQogICAgICAgIFF1\nZXJ5TWV0YURhdGFbXSBxdWVyaWVzID0gcHIuZ2V0UXVlcnlNZXRhRGF0YXMo\nKTsKICAgICAgICBMaXN0IHFxcyA9ICghaXNNYXBwaW5nT25seUZhY3Rvcnko\nKSAmJiAobW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgID8g\nbnVsbCA6IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBib29sZWFuIHJlbTsK\nICAgICAgICBDbGFzcyBkZWY7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBxdWVyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghaXNN\nYXBwaW5nT25seUZhY3RvcnkoKSAmJiBxdWVyaWVzW2ldLmdldFNvdXJjZUZp\nbGUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgZmlsZXMuYWRkKHF1ZXJp\nZXNbaV0uZ2V0U291cmNlRmlsZSgpKTsKICAgICAgICAgICAgZGVmID0gcXVl\ncmllc1tpXS5nZXREZWZpbmluZ1R5cGUoKTsKICAgICAgICAgICAgcmVtID0g\nKHF1ZXJpZXNbaV0uZ2V0U291cmNlTW9kZSgpICYgbW9kZSkgIT0gMAogICAg\nICAgICAgICAgICAgJiYgY2xzTmFtZXMuY29udGFpbnMoKGRlZiA9PSBudWxs\nKSA/IG51bGwgOiBkZWYuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKHJl\nbSB8fCAoIWlzTWFwcGluZ09ubHlGYWN0b3J5KCkKICAgICAgICAgICAgICAg\nICYmIHF1ZXJpZXNbaV0uZ2V0U291cmNlTW9kZSgpID09IE1PREVfUVVFUlkp\nKQogICAgICAgICAgICAgICAgcHIucmVtb3ZlUXVlcnlNZXRhRGF0YShxdWVy\naWVzW2ldKTsKICAgICAgICAgICAgaWYgKHFxcyAhPSBudWxsICYmIHF1ZXJp\nZXNbaV0uZ2V0U291cmNlTW9kZSgpID09IE1PREVfUVVFUlkgJiYgIXJlbSkK\nICAgICAgICAgICAgICAgIHFxcy5hZGQocXVlcmllc1tpXSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyB3cml0ZSBuZXcgbWV0YWRhdGEgd2l0aG91dCByZW1v\ndmVkIGluc3RhbmNlcwogICAgICAgIGJhY2t1cEFuZERlbGV0ZShmaWxlcyk7\nCiAgICAgICAgU2VyaWFsaXplciBzZXI7CiAgICAgICAgaWYgKChtb2RlICYg\nKE1PREVfTUVUQSB8IE1PREVfTUFQUElORykpICE9IDApIHsKICAgICAgICAg\nICAgc2VyID0gbmV3U2VyaWFsaXplcigpOwogICAgICAgICAgICBzZXIuc2V0\nTW9kZSgoaXNNYXBwaW5nT25seUZhY3RvcnkoKSkgPyBtb2RlIDogbW9kZSB8\nIE1PREVfTUVUQSk7CiAgICAgICAgICAgIHNlci5hZGRBbGwocHIpOwogICAg\nICAgICAgICAvLyByZW1vdmUgZnJvbSBzZXJpYWxpemVyIHJhdGhlciB0aGFu\nIGZyb20gcmVwb3NpdG9yeSBhYm92ZSBzbyB0aGF0CiAgICAgICAgICAgIC8v\nIGNhbGxpbmcgY29kZSBjYW4gdGFrZSBhZHZhbnRhZ2Ugb2YgbWV0YWRhdGEg\nc3RpbGwgaW4gcmVwb3MKICAgICAgICAgICAgaWYgKGlzTWFwcGluZ09ubHlG\nYWN0b3J5KCkpCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNscy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBzZXIucmVt\nb3ZlTWV0YURhdGEocHIuZ2V0TWV0YURhdGEoY2xzW2ldLCBlbnZMb2FkZXIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAgICAgICAg\nIHNlcmlhbGl6ZShzZXIsIG51bGwsIHNlci5QUkVUVFkpOwogICAgICAgIH0K\nICAgICAgICBpZiAocXFzICE9IG51bGwgJiYgIXFxcy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgc2VyID0gbmV3U2VyaWFsaXplcigpOwogICAgICAgICAg\nICBzZXIuc2V0TW9kZShNT0RFX1FVRVJZKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBxcXMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAg\nICBzZXIuYWRkUXVlcnlNZXRhRGF0YSgoUXVlcnlNZXRhRGF0YSkgcXFzLmdl\ndChpKSk7CiAgICAgICAgICAgIHNlcmlhbGl6ZShzZXIsIG51bGwsIHNlci5Q\nUkVUVFkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFzc2lnbiBkZWZhdWx0IHNvdXJjZSBmaWxlcyB0\nbyB0aGUgZ2l2ZW4gbWV0YWRhdGFzLgogICAgICoKICAgICAqIEBwYXJhbSBj\nbHNOYW1lcyBtYXAgb2YgY2xhc3MgbmFtZXMgdG8gbWV0YWRhdGFzCiAgICAg\nKiBAcmV0dXJuIHNldCBvZiBleGlzdGluZyBmaWxlcyB1c2VkIGJ5IHRoZXNl\nIG1ldGFkYXRhcywgb3IKICAgICAqIG51bGwgaWYgbm8gZXhpc3RpbmcgZmls\nZXMKICAgICAqLwogICAgcHJpdmF0ZSBTZXQgYXNzaWduRGVmYXVsdE1ldGFE\nYXRhRmlsZXMoQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLAogICAgICAgIFF1ZXJ5\nTWV0YURhdGFbXSBxdWVyaWVzLCBTZXF1ZW5jZU1ldGFEYXRhW10gc2Vxcywg\naW50IG1vZGUsCiAgICAgICAgTWFwIGNsc05hbWVzKSB7CiAgICAgICAgU2V0\nIGZpbGVzID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1l\ndGFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChnZXRTb3VyY2VG\naWxlKG1ldGFzW2ldKSA9PSBudWxsKQogICAgICAgICAgICAgICAgc2V0U291\ncmNlRmlsZShtZXRhc1tpXSwgZGVmYXVsdFNvdXJjZUZpbGUobWV0YXNbaV0p\nKTsKICAgICAgICAgICAgaWYgKGdldFNvdXJjZUZpbGUobWV0YXNbaV0pLmV4\naXN0cygpKSB7CiAgICAgICAgICAgICAgICBpZiAoZmlsZXMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBmaWxlcyA9IG5ldyBIYXNoU2V0KCk7CiAg\nICAgICAgICAgICAgICBmaWxlcy5hZGQoZ2V0U291cmNlRmlsZShtZXRhc1tp\nXSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgcXVlcmllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAocXVlcmllc1tpXS5nZXRTb3VyY2VNb2RlKCkgPT0gTU9ERV9RVUVS\nWQogICAgICAgICAgICAgICAgfHwgKG1vZGUgJiBxdWVyaWVzW2ldLmdldFNv\ndXJjZU1vZGUoKSkgPT0gMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICBpZiAocXVlcmllc1tpXS5nZXRTb3VyY2VGaWxlKCkgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHF1ZXJpZXNbaV0uc2V0U291cmNlKGRl\nZmF1bHRTb3VyY2VGaWxlKHF1ZXJpZXNbaV0sCiAgICAgICAgICAgICAgICAg\nICAgY2xzTmFtZXMpLCBxdWVyaWVzW2ldLmdldFNvdXJjZVNjb3BlKCksCiAg\nICAgICAgICAgICAgICAgICAgcXVlcmllc1tpXS5nZXRTb3VyY2VUeXBlKCkp\nOwogICAgICAgICAgICBpZiAocXVlcmllc1tpXS5nZXRTb3VyY2VGaWxlKCku\nZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChmaWxlcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGZpbGVzID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICAgICAgICAgIGZpbGVzLmFkZChxdWVyaWVzW2ldLmdldFNvdXJj\nZUZpbGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKChtb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwKSB7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc2Vxcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKGdldFNvdXJjZUZpbGUoc2Vxc1tpXSkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBzZXRTb3VyY2VGaWxlKHNlcXNbaV0sIGRl\nZmF1bHRTb3VyY2VGaWxlKHNlcXNbaV0sCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNsc05hbWVzKSk7CiAgICAgICAgICAgICAgICBpZiAoZ2V0U291cmNl\nRmlsZShzZXFzW2ldKS5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChmaWxlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBm\naWxlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgZmls\nZXMuYWRkKGdldFNvdXJjZUZpbGUoc2Vxc1tpXSkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBm\naWxlczsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiBkZWZhdWx0IHNv\ndXJjZSBmaWxlcyB0byB0aGUgZ2l2ZW4gcXVlcmllcy4KICAgICAqCiAgICAg\nKiBAcGFyYW0gY2xzTmFtZXMgbWFwIG9mIGNsYXNzIG5hbWVzIHRvIG1ldGFk\nYXRhcwogICAgICogQHJldHVybiBzZXQgb2YgZXhpc3RpbmcgZmlsZXMgdXNl\nZCBieSB0aGVzZSBtZXRhZGF0YXMsIG9yCiAgICAgKiBudWxsIGlmIG5vIGV4\naXN0aW5nIGZpbGVzCiAgICAgKi8KICAgIHByaXZhdGUgU2V0IGFzc2lnbkRl\nZmF1bHRRdWVyeUZpbGVzKFF1ZXJ5TWV0YURhdGFbXSBxdWVyaWVzLAogICAg\nICAgIE1hcCBjbHNOYW1lcykgewogICAgICAgIFNldCBmaWxlcyA9IG51bGw7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBxdWVyaWVzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChxdWVyaWVzW2ldLmdldFNvdXJjZU1v\nZGUoKSAhPSBNT0RFX1FVRVJZKQogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIGlmIChxdWVyaWVzW2ldLmdldFNvdXJjZUZpbGUoKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcXVlcmllc1tpXS5zZXRTb3VyY2Uo\nZGVmYXVsdFNvdXJjZUZpbGUocXVlcmllc1tpXSwgY2xzTmFtZXMpLAogICAg\nICAgICAgICAgICAgICAgIHF1ZXJpZXNbaV0uZ2V0U291cmNlU2NvcGUoKSwg\ncXVlcmllc1tpXS5nZXRTb3VyY2VUeXBlKCkpOwogICAgICAgICAgICBpZiAo\ncXVlcmllc1tpXS5nZXRTb3VyY2VGaWxlKCkuZXhpc3RzKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChmaWxlcyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGZpbGVzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIGZp\nbGVzLmFkZChxdWVyaWVzW2ldLmdldFNvdXJjZUZpbGUoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpbGVzOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBmYWN0b3J5IGRl\nYWxzIG9ubHkgd2l0aCBtYXBwaW5nIGRhdGEsIGFuZCByZWxpZXMKICAgICAq\nIG9uIGEgc2VwYXJhdGUgZmFjdG9yeSBmb3IgbWV0YWRhdGEuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ09ubHlGYWN0b3J5KCkg\newogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGFsbCBnaXZlbiBmaWxlcy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgcGFyc2UoTWV0YURhdGFQYXJzZXIgcGFyc2VyLCBDb2xsZWN0aW9u\nIGZpbGVzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBmaWxlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykK\nICAgICAgICAgICAgICAgIHBhcnNlci5wYXJzZSgoRmlsZSkgaXRyLm5leHQo\nKSk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGlvZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgYWxsIGdpdmVuIGNs\nYXNzc2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZShNZXRh\nRGF0YVBhcnNlciBwYXJzZXIsIENsYXNzW10gY2xzKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBwYXJzZXIucGFyc2UoY2xzW2ldLCBp\nc1BhcnNlVG9wRG93bigpKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpb2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24oaW9lKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHRvIHBhcnNlIGNsYXNzZXMgdG9wIGRvd24uIERlZmF1bHRzIHRvIGZh\nbHNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1BhcnNlVG9w\nRG93bigpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUZWxsIHRoZSBnaXZlbiBzZXJpYWxpZXIgdG8gd3JpdGUgaXRz\nIG1ldGFkYXRhcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFs\naXplKE1ldGFEYXRhU2VyaWFsaXplciBzZXIsIE1hcCBvdXRwdXQsIGludCBm\nbGFncykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChvdXRwdXQg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlci5zZXJpYWxpemUoZmxhZ3Mp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXIuc2VyaWFs\naXplKG91dHB1dCwgZmxhZ3MpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0\naW9uIGlvZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihpb2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEJh\nY2t1cCBhbmQgZGVsZXRlIHRoZSBzb3VyY2UgZmlsZXMgZm9yIHRoZSBnaXZl\nbiBtZXRhZGF0YXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGJhY2t1\ncEFuZERlbGV0ZShDb2xsZWN0aW9uIGZpbGVzKSB7CiAgICAgICAgRmlsZSBm\naWxlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmlsZXMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmlsZSA9IChG\naWxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoRmlsZXMuYmFja3Vw\nKGZpbGUsIGZhbHNlKSAhPSBudWxsKQogICAgICAgICAgICAgICAgZmlsZS5k\nZWxldGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVh\nciBtYXBwaW5nIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhck1hcHBpbmcoQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2Rl\nKE1PREVfTUFQUElORywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBjdXJyZW50IHNvdXJjZSBmaWxlIG9mIHRoZSBnaXZlbiBt\nZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpbGUgZ2V0U291cmNl\nRmlsZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbWV0\nYS5nZXRTb3VyY2VGaWxlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIGN1cnJlbnQgc291cmNlIGZpbGUgb2YgdGhlIGdpdmVuIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRTb3VyY2VGaWxlKENs\nYXNzTWV0YURhdGEgbWV0YSwgRmlsZSBzb3VyY2VGaWxlKSB7CiAgICAgICAg\nbWV0YS5zZXRTb3VyY2Uoc291cmNlRmlsZSwgbWV0YS5nZXRTb3VyY2VUeXBl\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXJyZW50\nIHNvdXJjZSBmaWxlIG9mIHRoZSBnaXZlbiBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIEZpbGUgZ2V0U291cmNlRmlsZShTZXF1ZW5jZU1ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbWV0YS5nZXRTb3VyY2VGaWxl\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGN1cnJlbnQgc291\ncmNlIGZpbGUgb2YgdGhlIGdpdmVuIG1ldGFkYXRhLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBzZXRTb3VyY2VGaWxlKFNlcXVlbmNlTWV0YURhdGEg\nbWV0YSwgRmlsZSBzb3VyY2VGaWxlKSB7CiAgICAgICAgbWV0YS5zZXRTb3Vy\nY2Uoc291cmNlRmlsZSwgbWV0YS5nZXRTb3VyY2VTY29wZSgpLAogICAgICAg\nICAgICBtZXRhLmdldFNvdXJjZVR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGRlZmF1bHQgZmlsZSBmb3IgdGhlIGdpdmVuIG1l\ndGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRmlsZSBk\nZWZhdWx0U291cmNlRmlsZShDbGFzc01ldGFEYXRhIG1ldGEpOwoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgZGVmYXVsdCBmaWxlIGZvciB0aGUgZ2l2ZW4g\ncXVlcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBGaWxlIGRl\nZmF1bHRTb3VyY2VGaWxlKFF1ZXJ5TWV0YURhdGEgcXVlcnksCiAgICAgICAg\nTWFwIGNsc05hbWVzKTsKCiAgICAvKioKICAgICAqIFJldHVybiBhIGRlZmF1\nbHQgZmlsZSBmb3IgdGhlIGdpdmVuIHNlcXVlbmNlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgYWJzdHJhY3QgRmlsZSBkZWZhdWx0U291cmNlRmlsZShTZXF1\nZW5jZU1ldGFEYXRhIHNlcSwKICAgICAgICBNYXAgY2xzTmFtZXMpOwoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IG1ldGFkYXRhIHBhcnNlci4KICAg\nICAqCiAgICAgKiBAcGFyYW0gbG9hZGluZyBpZiB0cnVlLCB0aGlzIHdpbGwg\nYmUgdGhlIGNhY2hlZCBwYXJzZXIgdXNlZCBmb3IKICAgICAqIGxvYWRpbmcg\nbWV0YWRhdGEKICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IFBhcnNl\nciBuZXdQYXJzZXIoYm9vbGVhbiBsb2FkaW5nKTsKCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSBzZXJpYWxpemVyLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3QgU2VyaWFsaXplciBuZXdTZXJpYWxpemVy\nKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIHRoYXQg\nZGVmaW5lcyB0aGUgZ2l2ZW4gcXVlcnksIGlmIGFueS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gY2xzTmFtZXMgbWFwIG9mIGNsYXNzIG5hbWVzIHRvIG1ldGFk\nYXRhcwogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSBnZXRE\nZWZpbmluZ01ldGFEYXRhKFF1ZXJ5TWV0YURhdGEgcXVlcnksCiAgICAgICAg\nTWFwIGNsc05hbWVzKSB7CiAgICAgICAgQ2xhc3MgZGVmID0gcXVlcnkuZ2V0\nRGVmaW5pbmdUeXBlKCk7CiAgICAgICAgaWYgKGRlZiAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gKENsYXNzTWV0YURhdGEpIGNsc05hbWVzLmdldChk\nZWYuZ2V0TmFtZSgpKTsKCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAg\nICAgIFN0cmluZyBwa2c7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\nbHNOYW1lcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgcGtnID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZSgo\nU3RyaW5nKSBlbnRyeS5nZXRLZXkoKSk7CiAgICAgICAgICAgIGlmIChwa2cu\nbGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiAoQ2xhc3NN\nZXRhRGF0YSkgZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIFNldCBnZXRQZXJzaXN0\nZW50VHlwZU5hbWVzKGJvb2xlYW4gZGV2cGF0aCwgQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyKSB7CiAgICAgICAgLy8gc29tZSBjb25maWd1cmVkIGxvY2F0aW9u\ncyBtaWdodCBiZSBpbXBsaWNpdCBpbiBzcGVjLCBzbyByZXR1cm4KICAgICAg\nICAvLyBudWxsIGlmIHdlIGRvbid0IGZpbmQgYW55IGNsYXNzZXMsIHJhdGhl\nciB0aGFuIGlmIHdlIGRvbid0IGhhdmUKICAgICAgICAvLyBhbnkgbG9jYXRp\nb25zCiAgICAgICAgaWYgKF90eXBlTmFtZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIChfdHlwZU5hbWVzLmlzRW1wdHkoKSkgPyBudWxsIDogX3R5\ncGVOYW1lczsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NMb2Fk\nZXIgbG9hZGVyID0gcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAg\nICAgICAgICAgZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNlKCkuZ2V0Q2xhc3NM\nb2FkZXIoZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgICAgIGVudkxvYWRlcik7\nCiAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKTsKCiAgICAgICAgICAgIFNldCBuYW1lcyA9IHBhcnNlUGVyc2lz\ndGVudFR5cGVOYW1lcyhsb2FkZXIpOwogICAgICAgICAgICBpZiAobmFtZXMu\naXNFbXB0eSgpICYmIGRldnBhdGgpCiAgICAgICAgICAgICAgICBzY2FuKG5l\ndyBDbGFzc3BhdGhNZXRhRGF0YUl0ZXJhdG9yKG51bGwsIG5ld01ldGFEYXRh\nRmlsdGVyKCkpLAogICAgICAgICAgICAgICAgICAgIG5ld0NsYXNzQXJnUGFy\nc2VyKCksIG5hbWVzLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAgIGVsc2Ug\nLy8gd2UgZG9uJ3QgY2FjaGUgYSBmdWxsIGRldiBjcCBzY2FuCiAgICAgICAg\nICAgICAgICBfdHlwZU5hbWVzID0gbmFtZXM7CgogICAgICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJh\nY2UoX2xvYy5nZXQoImZvdW5kLXBjcyIsIFN0cmluZy52YWx1ZU9mKG5hbWVz\nLnNpemUoKSksCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2Yo\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydCkpKTsKICAgICAg\nICAgICAgcmV0dXJuIChuYW1lcy5pc0VtcHR5KCkpID8gbnVsbCA6IG5hbWVz\nOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihpb2UpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBlcnNpc3RlbnQgdHlw\nZSBuYW1lcy4KICAgICAqLwogICAgcHJpdmF0ZSBTZXQgcGFyc2VQZXJzaXN0\nZW50VHlwZU5hbWVzKENsYXNzTG9hZGVyIGxvYWRlcikKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIENsYXNzQXJnUGFyc2VyIGNwYXJz\nZXIgPSBuZXdDbGFzc0FyZ1BhcnNlcigpOwogICAgICAgIFN0cmluZ1tdIGNs\nc3M7CiAgICAgICAgU2V0IG5hbWVzID0gbmV3IEhhc2hTZXQoKTsKICAgICAg\nICBpZiAoZmlsZXMgIT0gbnVsbCkgewogICAgICAgICAgICBGaWxlIGZpbGU7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmlsZXMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGZpbGUg\nPSAoRmlsZSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChmaWxl\nLmlzRGlyZWN0b3J5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxv\nZy50cmFjZShfbG9jLmdldCgic2Nhbm5pbmctZGlyZWN0b3J5IiwgZmlsZSkp\nOwogICAgICAgICAgICAgICAgICAgIHNjYW4obmV3IEZpbGVNZXRhRGF0YUl0\nZXJhdG9yKGRpciwgbmV3TWV0YURhdGFGaWx0ZXIoKSksCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNwYXJzZXIsIG5hbWVzLCB0cnVlLCBmaWxlKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZS5nZXROYW1lKCkuZW5kc1dp\ndGgoIi5qYXIiKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJzY2FubmluZy1qYXIiLCBmaWxlKSk7CiAgICAgICAg\nICAgICAgICAgICAgc2NhbihuZXcgWmlwRmlsZU1ldGFEYXRhSXRlcmF0b3Io\nbmV3IFppcEZpbGUoZmlsZSksCiAgICAgICAgICAgICAgICAgICAgICAgIG5l\nd01ldGFEYXRhRmlsdGVyKCkpLCBjcGFyc2VyLCBuYW1lcywgdHJ1ZSwgZmls\nZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzY2FubmluZy1maWxlIiwg\nZmlsZSkpOwogICAgICAgICAgICAgICAgICAgIGNsc3MgPSBjcGFyc2VyLnBh\ncnNlVHlwZU5hbWVzKG5ldyBGaWxlTWV0YURhdGFJdGVyYXRvcgogICAgICAg\nICAgICAgICAgICAgICAgICAoZmlsZSkpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzY2FuLWZvdW5kLW5hbWVzIiwg\nY2xzcywgZmlsZSkpOwogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFkZEFs\nbChBcnJheXMuYXNMaXN0KGNsc3MpKTsKICAgICAgICAgICAgICAgICAgICBt\nYXBQZXJzaXN0ZW50VHlwZU5hbWVzKGZpbGUuZ2V0QWJzb2x1dGVGaWxlKCku\ndG9VUkwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY2xzcyk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nVVJMIHVybDsKICAgICAgICBpZiAodXJscyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdXJscy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdXJsID0gKFVSTCkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICgiamFyIi5lcXVhbHModXJs\nLmdldFByb3RvY29sKCkpCiAgICAgICAgICAgICAgICAgICAgJiYgdXJsLmdl\ndFBhdGgoKS5lbmRzV2l0aCgiIS8iKSkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzY2FubmluZy1qYXItdXJsIiwg\ndXJsKSk7CiAgICAgICAgICAgICAgICAgICAgc2NhbihuZXcgWmlwRmlsZU1l\ndGFEYXRhSXRlcmF0b3IodXJsLAogICAgICAgICAgICAgICAgICAgICAgICBu\nZXdNZXRhRGF0YUZpbHRlcigpKSwgY3BhcnNlciwgbmFtZXMsIHRydWUsIHVy\nbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVybC5nZXRQYXRoKCku\nZW5kc1dpdGgoIi5qYXIiKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJzY2FubmluZy1qYXItYXQtdXJsIiwgdXJs\nKSk7CiAgICAgICAgICAgICAgICAgICAgc2NhbihuZXcgWmlwU3RyZWFtTWV0\nYURhdGFJdGVyYXRvcigKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFpp\ncElucHV0U3RyZWFtKHVybC5vcGVuU3RyZWFtKCkpLAogICAgICAgICAgICAg\nICAgICAgICAgICBuZXdNZXRhRGF0YUZpbHRlcigpKSwgY3BhcnNlciwgbmFt\nZXMsIHRydWUsIHVybCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzY2Fu\nbmluZy11cmwiLCB1cmwpKTsKICAgICAgICAgICAgICAgICAgICBjbHNzID0g\nY3BhcnNlci5wYXJzZVR5cGVOYW1lcyhuZXcgVVJMTWV0YURhdGFJdGVyYXRv\ncih1cmwpKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShf\nbG9jLmdldCgic2Nhbi1mb3VuZC1uYW1lcyIsIGNsc3MsIHVybCkpOwogICAg\nICAgICAgICAgICAgICAgIG5hbWVzLmFkZEFsbChBcnJheXMuYXNMaXN0KGNs\nc3MpKTsKICAgICAgICAgICAgICAgICAgICBtYXBQZXJzaXN0ZW50VHlwZU5h\nbWVzKHVybCwgY2xzcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaWYgKHJzcmNzICE9IG51bGwpIHsKICAg\nICAgICAgICAgU3RyaW5nIHJzcmM7CiAgICAgICAgICAgIE1ldGFEYXRhSXRl\ncmF0b3IgbWl0cjsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBy\nc3Jjcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgcnNyYyA9IChTdHJpbmcpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBpZiAocnNyYy5lbmRzV2l0aCgiLmphciIpKSB7CiAgICAgICAgICAg\nICAgICAgICAgdXJsID0gbG9hZGVyLmdldFJlc291cmNlKHJzcmMpOwogICAg\nICAgICAgICAgICAgICAgIGlmICh1cmwgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoInNj\nYW5uaW5nLWphci1zdHJlYW0tdXJsIiwgdXJsKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHNjYW4obmV3IFppcFN0cmVhbU1ldGFEYXRhSXRlcmF0b3IK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgWmlwSW5wdXRTdHJl\nYW0odXJsLm9wZW5TdHJlYW0oKSksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3TWV0YURhdGFGaWx0ZXIoKSksIGNwYXJzZXIsIG5hbWVz\nLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5n\nZXQoInNjYW5uaW5nLXJlc291cmNlIiwgcnNyYykpOwogICAgICAgICAgICAg\nICAgICAgIG1pdHIgPSBuZXcgUmVzb3VyY2VNZXRhRGF0YUl0ZXJhdG9yKHJz\ncmMsIGxvYWRlcik7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG1pdHIu\naGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IChV\nUkwpIG1pdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjbHNz\nID0gY3BhcnNlci5wYXJzZVR5cGVOYW1lcyhuZXcgVVJMTWV0YURhdGFJdGVy\nYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHVybCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5n\nZXQoInNjYW4tZm91bmQtbmFtZXMiLCBjbHNzLCByc3JjKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIG5hbWVzLmFkZEFsbChBcnJheXMuYXNMaXN0KGNs\nc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFwUGVyc2lzdGVudFR5\ncGVOYW1lcyh1cmwsIGNsc3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBtaXRyLmNsb3NlKCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNwYXRo\nICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nW10gZGlycyA9IChTdHJp\nbmdbXSkgY3BhdGgudG9BcnJheShuZXcgU3RyaW5nW2NwYXRoLnNpemUoKV0p\nOwogICAgICAgICAgICBzY2FuKG5ldyBDbGFzc3BhdGhNZXRhRGF0YUl0ZXJh\ndG9yKGRpcnMsIG5ld01ldGFEYXRhRmlsdGVyKCkpLAogICAgICAgICAgICAg\nICAgY3BhcnNlciwgbmFtZXMsIHRydWUsIGRpcnMpOwogICAgICAgIH0KICAg\nICAgICBpZiAodHlwZXMgIT0gbnVsbCkKICAgICAgICAgICAgbmFtZXMuYWRk\nQWxsKHR5cGVzKTsKICAgICAgICAKICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgicGFy\nc2UtZm91bmQtbmFtZXMiLCBuYW1lcykpOwogICAgICAgIAogICAgICAgIHJl\ndHVybiBuYW1lczsKICAgIH0KCiAgICAvKioKICAgICAqIFNjYW4gZm9yIHBl\ncnNpc3RlbnQgdHlwZSBuYW1lcyB1c2luZyB0aGUgZ2l2ZW4gbWV0YWRhdGEg\naXRlcmF0b3IuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzY2FuKE1ldGFE\nYXRhSXRlcmF0b3IgbWl0ciwgQ2xhc3NBcmdQYXJzZXIgY3BhcnNlciwgU2V0\nIG5hbWVzLAogICAgICAgIGJvb2xlYW4gbWFwTmFtZXMsIE9iamVjdCBkZWJ1\nZ0NvbnRleHQpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBNYXAgbWFwOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1hcCA9IGNw\nYXJzZXIubWFwVHlwZU5hbWVzKG1pdHIpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIG1pdHIuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAg\nIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgaWYgKG1hcE5hbWVzKQogICAgICAgICAgICAgICAgbWFw\nUGVyc2lzdGVudFR5cGVOYW1lcyhlbnRyeS5nZXRLZXkoKSwgKFN0cmluZ1td\nKQogICAgICAgICAgICAgICAgICAgIGVudHJ5LmdldFZhbHVlKCkpOwogICAg\nICAgICAgICBMaXN0IG5ld05hbWVzID0gQXJyYXlzLmFzTGlzdCgoU3RyaW5n\nW10pIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICBpZiAobG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xv\nYy5nZXQoInNjYW4tZm91bmQtbmFtZXMiLCBuZXdOYW1lcywgZGVidWdDb250\nZXh0KSk7CiAgICAgICAgICAgIG5hbWVzLmFkZEFsbChuZXdOYW1lcyk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoaXMg\nbWV0aG9kIHRvIG1hcCBtZXRhZGF0YSByZXNvdXJjZXMgdG8gdGhlIHBlcnNp\nc3RlbnQKICAgICAqIHR5cGVzIGNvbnRhaW5lZCB3aXRoaW4gdGhlbS4gVGhl\nIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCB3aGVuCiAgICAgKiB7QGxpbmsgI2dl\ndFBlcnNpc3RlbnRUeXBlTmFtZXN9IGlzIGludm9rZWQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIG1hcFBlcnNpc3RlbnRUeXBlTmFtZXMoT2JqZWN0\nIHJzcmMsIFN0cmluZ1tdIG5hbWVzKSB7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBtZXRhZGF0YSBmaWx0ZXIgdGhhdCBpZGVudGlmaWVzIG1l\ndGFkYXRhIHJlc291cmNlcyB3aGVuCiAgICAgKiBwZXJmb3JtaW5nIGphciBh\nbmQgY2xhc3NwYXRoIHNjYW5zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3QgTWV0YURhdGFGaWx0ZXIgbmV3TWV0YURhdGFGaWx0ZXIoKTsKCiAg\nICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigp\nOwogICAgICAgIF90eXBlTmFtZXMgPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgcGFyc2VyIGludGVyZmFjZS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBpbnRlcmZhY2UgUGFyc2VyCiAgICAgICAgZXh0ZW5k\ncyBNZXRhRGF0YVBhcnNlciB7CgogICAgICAgIC8qKgogICAgICAgICAqIFJl\ndHVybnMgdGhlIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLiBJZiBub25l\nIGhhcyBiZWVuIHNldCwKICAgICAgICAgKiBjcmVhdGVzIGEgbmV3IHJlcG9z\naXRvcnkgYW5kIHNldHMgaXQuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCk7CgogICAgICAg\nIC8qKgogICAgICAgICAqIFRoZSBwYXJzZSBtb2RlIGFjY29yZGluZyB0byB0\naGUgZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBtb2RlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEludGVybmFsIHNlcmlhbGl6ZXIgaW50ZXJmYWNlLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFjZSBTZXJpYWxpemVyCiAg\nICAgICAgZXh0ZW5kcyBNZXRhRGF0YVNlcmlhbGl6ZXIgewoKICAgICAgICAv\nKioKICAgICAgICAgKiBUaGUgc2VyaWFsaXphdGlvbiBtb2RlIGFjY29yZGlu\nZyB0byB0aGUgZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4gVGhlCiAgICAgICAg\nICogbW9kZSBjb25zdGFudHMgYWN0IGFzIGJpdCBmbGFncywgYW5kIHRoZXJl\nZm9yZSBjYW4gYmUgY29tYmluZWQuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSk7CgogICAgICAgIC8qKgogICAg\nICAgICAqIEFkZCBhIGNsYXNzIG1ldGEgZGF0YSB0byB0aGUgc2V0IHRvIGJl\nIHNlcmlhbGl6ZWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQg\nYWRkTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKTsKCiAgICAgICAgLyoq\nCiAgICAgICAgICogUmVtb3ZlIGEgY2xhc3MgbWV0YSBkYXRhIGZyb20gdGhl\nIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyBib29sZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNzTWV0YURhdGEgbWV0\nYSk7CgogICAgICAgIC8qKgogICAgICAgICAqIEFkZCBhIHNlcXVlbmNlIG1l\ndGEgZGF0YSB0byB0aGUgc2V0IHRvIGJlIHNlcmlhbGl6ZWQuCiAgICAgICAg\nICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkU2VxdWVuY2VNZXRhRGF0YShT\nZXF1ZW5jZU1ldGFEYXRhIG1ldGEpOwoKICAgICAgICAvKioKICAgICAgICAg\nKiBBZGQgYSBxdWVyeSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJp\nYWxpemVkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZFF1\nZXJ5TWV0YURhdGEoUXVlcnlNZXRhRGF0YSBtZXRhKTsKCiAgICAgICAgLyoq\nCiAgICAgICAgICogQWRkIGFsbCBjb21wb25lbnRzIGluIHRoZSBnaXZlbiBy\nZXBvc2l0b3J5IHRvIHRoZSBzZXQgdG8gYmUKCQkgKiBzZXJpYWxpemVkLgoJ\nCSAqLwoJCXB1YmxpYyB2b2lkIGFkZEFsbCAoTWV0YURhdGFSZXBvc2l0b3J5\nIHJlcG9zKTsKCX0KfQo=\n","encoding":"base64"}

