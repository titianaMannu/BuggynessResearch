{"sha":"f3cdd3a46a93b647d37117cb257dee1e1c113026","node_id":"MDQ6QmxvYjIwNjM2NDpmM2NkZDNhNDZhOTNiNjQ3ZDM3MTE3Y2IyNTdkZWUxZTFjMTEzMDI2","size":11308,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f3cdd3a46a93b647d37117cb257dee1e1c113026","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1lbWJlcjsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgog\nKiBBYnN0cmFjdCBtZXRhZGF0YSBkZWZhdWx0cy4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdE1l\ndGFEYXRhRGVmYXVsdHMKICAgIGltcGxlbWVudHMgTWV0YURhdGFEZWZhdWx0\ncyB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChBYnN0cmFjdE1ldGFE\nYXRhRGVmYXVsdHMuY2xhc3MpOwoKICAgIHByaXZhdGUgaW50IF9hY2Nlc3Mg\nPSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRDsKICAgIHByaXZhdGUgaW50\nIF9pZGVudGl0eSA9IENsYXNzTWV0YURhdGEuSURfVU5LTk9XTjsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaWdub3JlID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfaW50ZXJmYWNlID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\ncGNSZWdpc3RyeSA9IHRydWU7CiAgICBwcml2YXRlIGludCBfY2FsbGJhY2sg\nPSBDQUxMQkFDS19SRVRIUk9XOwogICAgcHJpdmF0ZSBib29sZWFuIF91bndy\nYXBwZWQgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gYXR0\nZW1wdCB0byB1c2UgdGhlIGluZm9ybWF0aW9uIGZyb20gcmVnaXN0ZXJlZCBj\nbGFzc2VzCiAgICAgKiB0byBwb3B1bGF0ZSBtZXRhZGF0YSBkZWZhdWx0cy4g\nRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZ2V0VXNlUENSZWdpc3RyeSgpIHsKICAgICAgICByZXR1cm4gX3BjUmVnaXN0\ncnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGF0dGVtcHQg\ndG8gdXNlIHRoZSBpbmZvcm1hdGlvbiBmcm9tIHJlZ2lzdGVyZWQgY2xhc3Nl\ncwogICAgICogdG8gcG9wdWxhdGUgbWV0YWRhdGEgZGVmYXVsdHMuIERlZmF1\nbHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFVzZVBD\nUmVnaXN0cnkoYm9vbGVhbiBwY1JlZ2lzdHJ5KSB7CiAgICAgICAgX3BjUmVn\naXN0cnkgPSBwY1JlZ2lzdHJ5OwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIGRlZmF1bHQgYWNjZXNzIHR5cGUgZm9yIGJhc2UgY2xhc3NlcyB3aXRoIEFD\nQ0VTU19VTktOT1dOLgogICAgICogQUNDRVNTX0ZJRUxEIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RGVmYXVsdEFjY2Vzc1R5cGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9hY2Nlc3M7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgZGVmYXVsdCBhY2Nlc3MgdHlwZSBmb3IgYmFzZSBjbGFzc2Vz\nIHdpdGggQUNDRVNTX1VOS05PV04uCiAgICAgKiBBQ0NFU1NfRklFTEQgYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGVmYXVsdEFj\nY2Vzc1R5cGUoaW50IGFjY2VzcykgewogICAgICAgIF9hY2Nlc3MgPSBhY2Nl\nc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBpZGVudGl0\neSB0eXBlIGZvciB1bm1hcHBlZCBjbGFzc2VzIHdpdGhvdXQgcHJpbWFyeSAK\nICAgICAqIGtleSBmaWVsZHMuIElEX1VOS05PV04gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIGludCBnZXREZWZhdWx0SWRlbnRpdHlUeXBlKCkg\newogICAgICAgIHJldHVybiBfaWRlbnRpdHk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgZGVmYXVsdCBpZGVudGl0eSB0eXBlIGZvciB1bm1hcHBlZCBj\nbGFzc2VzIHdpdGhvdXQgcHJpbWFyeSAKICAgICAqIGtleSBmaWVsZHMuIElE\nX1VOS05PV04gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0RGVmYXVsdElkZW50aXR5VHlwZShpbnQgaWRlbnRpdHkpIHsKICAgICAg\nICBfaWRlbnRpdHkgPSBpZGVudGl0eTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIGdldENhbGxiYWNrTW9kZSgpIHsKICAgICAgICByZXR1cm4gX2NhbGxiYWNr\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbGxiYWNrTW9kZShpbnQg\nbW9kZSkgewogICAgICAgIF9jYWxsYmFjayA9IG1vZGU7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0Q2FsbGJhY2tNb2RlKGludCBtb2RlLCBib29sZWFu\nIG9uKSB7CiAgICAgICAgaWYgKG9uKQogICAgICAgICAgICBfY2FsbGJhY2sg\nfD0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9jYWxsYmFjayAm\nPSB+bW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRDYWxsYmFj\na3NCZWZvcmVMaXN0ZW5lcnMoaW50IHR5cGUpIHsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEZWNsYXJlZElu\ndGVyZmFjZVBlcnNpc3RlbnQoKSB7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZh\nY2U7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGVjbGFyZWRJbnRlcmZh\nY2VQZXJzaXN0ZW50KGJvb2xlYW4gcGVycykgewogICAgICAgIF9pbnRlcmZh\nY2UgPSBwZXJzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGF0YVN0\nb3JlT2JqZWN0SWRGaWVsZFVud3JhcHBlZCgpIHsKICAgICAgICByZXR1cm4g\nX3Vud3JhcHBlZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhU3Rv\ncmVPYmplY3RJZEZpZWxkVW53cmFwcGVkKGJvb2xlYW4gdW53cmFwcGVkKSB7\nCiAgICAgICAgX3Vud3JhcHBlZCA9IHVud3JhcHBlZDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRJZ25vcmVOb25QZXJzaXN0ZW50KCkgewogICAg\nICAgIHJldHVybiBfaWdub3JlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndElnbm9yZU5vblBlcnNpc3RlbnQoYm9vbGVhbiBpZ25vcmUpIHsKICAgICAg\nICBfaWdub3JlID0gaWdub3JlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBv\ncHVsYXRlKENsYXNzTWV0YURhdGEgbWV0YSwgaW50IGFjY2VzcykgewogICAg\nICAgIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSA9PSBPYmplY3QuY2xh\nc3MpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGFjY2VzcyA9\nPSBDbGFzc01ldGFEYXRhLkFDQ0VTU19VTktOT1dOKSB7CiAgICAgICAgICAg\nIC8vIHdlIGRvIG5vdCBhbGxvdyB1c2luZyBib3RoIGZpZWxkIGFuZCBtZXRo\nb2QgYWNjZXNzIGF0CiAgICAgICAgICAgIC8vIHRoZSBzYW1lIHRpbWUKICAg\nICAgICAgICAgYWNjZXNzID0gZ2V0QWNjZXNzVHlwZShtZXRhKTsKICAgICAg\nICAgICAgaWYgKChhY2Nlc3MgJiBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCkgIT0gMAogICAgICAgICAgICAgICAgJiYgKGFjY2VzcyAmIENsYXNzTWV0\nYURhdGEuQUNDRVNTX1BST1BFUlRZKSAhPSAwKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImFjY2Vzcy1maWVs\nZC1hbmQtcHJvcCIsCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgfQogICAgICAgIG1l\ndGEuc2V0QWNjZXNzVHlwZShhY2Nlc3MpOwoKICAgICAgICBMb2cgbG9nID0g\nbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2UoX2xv\nYy5nZXQoImdlbi1tZXRhIiwgbWV0YSkpOwogICAgICAgIGlmICghX3BjUmVn\naXN0cnkgfHwgIXBvcHVsYXRlRnJvbVBDUmVnaXN0cnkobWV0YSkpIHsKICAg\nICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJtZXRhLXJlZmxlY3QiKSk7CiAg\nICAgICAgICAgIHBvcHVsYXRlRnJvbVJlZmxlY3Rpb24obWV0YSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUG9wdWxhdGUgaW5pdGlhbCBm\naWVsZCBkYXRhLiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgcG9wdWxhdGUoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgIH0KCiAgICAvKioKICAgICAqIFBvcHVsYXRlIHRoZSBnaXZlbiBt\nZXRhZGF0YSB1c2luZyB0aGUge0BsaW5rIFBDUmVnaXN0cnl9LgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gcG9wdWxhdGVGcm9tUENSZWdpc3RyeShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBDbGFzcyBjbHMgPSBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBTdHJpbmdbXSBmaWVsZE5hbWVzID0gUENSZWdpc3RyeS5nZXRGaWVsZE5h\nbWVzKGNscyk7CiAgICAgICAgICAgIENsYXNzW10gZmllbGRUeXBlcyA9IFBD\nUmVnaXN0cnkuZ2V0RmllbGRUeXBlcyhjbHMpOwogICAgICAgICAgICBNZW1i\nZXIgbWVtYmVyOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZE5hbWVzLmxlbmd0\naDsgaSArKykgewogICAgICAgICAgICAgICAgaWYgKG1ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAg\nICAgICAgICAgICAgIG1lbWJlciA9IGNscy5nZXREZWNsYXJlZEZpZWxkKGZp\nZWxkTmFtZXNbaV0pOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIG1lbWJlciA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nZmllbGROYW1lc1tpXSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBmbWQgPSBt\nZXRhLmFkZERlY2xhcmVkRmllbGQoZmllbGROYW1lc1tpXSwgZmllbGRUeXBl\nc1tpXSk7CiAgICAgICAgICAgICAgICBmbWQuYmFja2luZ01lbWJlcihtZW1i\nZXIpOwogICAgICAgICAgICAgICAgcG9wdWxhdGUoZm1kKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNo\nIChJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWFlKSB7CiAgICAgICAgICAgIC8v\nIHRocm93biBieSByZWdpc3RyeSB3aGVuIG5vIG1ldGFkYXRhIGF2YWlsYWJs\nZQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgZ2l2ZW4gbWV0YWRhdGEgdXNp\nbmcgcmVmbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBvcHVs\nYXRlRnJvbVJlZmxlY3Rpb24oQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgTWVtYmVyW10gbWVtYmVyczsKICAgICAgICBib29sZWFuIGlmYWNlID0g\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZhY2UoKTsKICAgICAg\nICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5B\nQ0NFU1NfRklFTEQgJiYgIWlmYWNlKQogICAgICAgICAgICBtZW1iZXJzID0g\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0RGVjbGFyZWRGaWVsZHMoKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIG1lbWJlcnMgPSBtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKS5nZXREZWNsYXJlZE1ldGhvZHMoKTsKCiAgICAgICAg\naW50IG1vZHM7CiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgYm9vbGVh\nbiBkZWY7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBtZW1iZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIG1vZHMgPSBtZW1iZXJzW2ldLmdldE1vZGlmaWVycygpOwogICAg\nICAgICAgICBpZiAoTW9kaWZpZXIuaXNTdGF0aWMobW9kcykgfHwgTW9kaWZp\nZXIuaXNGaW5hbChtb2RzKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgbmFtZSA9IGdldEZpZWxkTmFtZShtZW1iZXJzW2ldKTsK\nICAgICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCB8fCBpc1Jlc2VydmVkRmll\nbGROYW1lKG5hbWUpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICBkZWYgPSBpc0RlZmF1bHRQZXJzaXN0ZW50KG1ldGEsIG1lbWJl\ncnNbaV0sIG5hbWUpOwogICAgICAgICAgICBpZiAoIWRlZiAmJiBfaWdub3Jl\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBw\nYXNzZWQgdGhlIHRlc3RzOyBwZXJzaXN0ZW50IHR5cGUgLS0gd2UgY29uc3Ry\ndWN0IHdpdGgKICAgICAgICAgICAgLy8gT2JqZWN0LmNsYXNzIGJlY2F1c2Ug\nc2V0dGluZyBiYWNraW5nIG1lbWJlciB3aWxsIHNldCBwcm9wZXIKICAgICAg\nICAgICAgLy8gdHlwZSBhbnl3YXkKICAgICAgICAgICAgZm1kID0gbWV0YS5h\nZGREZWNsYXJlZEZpZWxkKG5hbWUsIE9iamVjdC5jbGFzcyk7CiAgICAgICAg\nICAgIGZtZC5iYWNraW5nTWVtYmVyKG1lbWJlcnNbaV0pOwogICAgICAgICAg\nICBpZiAoIWRlZikgewogICAgICAgICAgICAgICAgZm1kLnNldEV4cGxpY2l0\nKHRydWUpOwogICAgICAgICAgICAgICAgZm1kLnNldE1hbmFnZW1lbnQoRmll\nbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcG9wdWxhdGUoZm1kKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGFjY2VzcyB0eXBlIG9mIHRoZSBnaXZlbiBt\nZXRhZGF0YS4gTWF5IGJlIGEgYml0d2lzZQogICAgICogY29tYmluYXRpb24g\nb2YgZmllbGQgYW5kIHByb3BlcnR5IGFjY2VzcyBjb25zdGFudHMsIG9yIEFD\nQ0VTU19VTktOT1dOLgogICAgICogUmV0dXJucyBBQ0NFU1NfRklFTEQgYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGludCBnZXRBY2Nlc3NU\neXBlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBDbGFz\nc01ldGFEYXRhLkFDQ0VTU19GSUVMRDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZmllbGQgbmFtZSBmb3IgdGhlIGdpdmVuIG1lbWJlci4g\nVGhpcyB3aWxsIG9ubHkgYmUgaW52b2tlZAogICAgICogb24gbWVtYmVycyBv\nZiB0aGUgcmlnaHQgdHlwZSAoZmllbGQgdnMuIG1ldGhvZCkuIFJldHVybiBu\ndWxsIGlmIHRoZQogICAgICogbWVtYmVyIGNhbm5vdCBiZSBtYW5hZ2VkLiBE\nZWZhdWx0IGJlaGF2aW9yOiBGb3IgZmllbGRzLCByZXR1cm5zIHRoZQogICAg\nICogZmllbGQgbmFtZS4gRm9yIGdldHRlciBtZXRob2RzLCByZXR1cm5zIHRo\nZSBtaW51cyAiZ2V0IiBvciAiaXMiIHdpdGgKICAgICAqIHRoZSBuZXh0IGxl\ndHRlciBsb3dlci1jYXNlZC4gRm9yIG90aGVyIG1ldGhvZHMsIHJldHVybnMg\nbnVsbC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRGaWVsZE5h\nbWUoTWVtYmVyIG1lbWJlcikgewogICAgICAgIGlmIChtZW1iZXIgaW5zdGFu\nY2VvZiBGaWVsZCkKICAgICAgICAgICAgcmV0dXJuIG1lbWJlci5nZXROYW1l\nKCk7CgogICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgbWVtYmVyOwog\nICAgICAgIGlmIChtZXRoLmdldFJldHVyblR5cGUoKSA9PSB2b2lkLmNsYXNz\nCiAgICAgICAgICAgIHx8IG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKS5sZW5n\ndGggIT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFN0\ncmluZyBuYW1lID0gbWV0aC5nZXROYW1lKCk7CiAgICAgICAgaWYgKG5hbWUu\nc3RhcnRzV2l0aCgiZ2V0IikgJiYgbmFtZS5sZW5ndGgoKSA+IDMpCiAgICAg\nICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygzKTsKICAgICAgICBlbHNl\nIGlmICgobWV0aC5nZXRSZXR1cm5UeXBlKCkgPT0gYm9vbGVhbi5jbGFzcwog\nICAgICAgICAgICB8fCBtZXRoLmdldFJldHVyblR5cGUoKSA9PSBCb29sZWFu\nLmNsYXNzKQogICAgICAgICAgICAmJiBuYW1lLnN0YXJ0c1dpdGgoImlzIikg\nJiYgbmFtZS5sZW5ndGgoKSA+IDIpCiAgICAgICAgICAgIG5hbWUgPSBuYW1l\nLnN1YnN0cmluZygyKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA9PSAxKQogICAg\nICAgICAgICByZXR1cm4gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHJl\ndHVybiBDaGFyYWN0ZXIudG9Mb3dlckNhc2UobmFtZS5jaGFyQXQoMCkpICsg\nbmFtZS5zdWJzdHJpbmcoMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRydWUgaWYgdGhlIGdpdmVuIGZpZWxkIG5hbWUgaXMgcmVzZXJ2ZWQg\nZm9yIHVubWFuYWdlZCBmaWVsZHMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIGlzUmVzZXJ2ZWRGaWVsZE5hbWUoU3RyaW5nIG5hbWUpIHsKICAg\nICAgICAvLyBuYW1lcyB1c2VkIGJ5IGVuaGFuY2VycwogICAgICAgIHJldHVy\nbiBuYW1lLnN0YXJ0c1dpdGgoIm9wZW5qcGEiKSB8fCBuYW1lLnN0YXJ0c1dp\ndGgoImpkbyIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUg\naWYgdGhlIGdpdmVuIG1lbWJlciBpcyBwZXJzaXN0ZW50IGJ5IGRlZmF1bHQu\nIFRoaXMgd2lsbAogICAgICogb25seSBiZSBpbnZva2VkIG9uIG1lbWJlcnMg\nb2YgdGhlIHJpZ2h0IHR5cGUgKGZpZWxkIHZzLiBtZXRob2QpLgogICAgICog\nUmV0dXJucyBmYWxzZSBpZiBtZW1iZXIgaXMgc3RhdGljIG9yIGZpbmFsIGJ5\nIGRlZmF1bHQuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgdGhlIGZpZWxk\nIG5hbWUgZnJvbSB7QGxpbmsgI2dldEZpZWxkTmFtZX0KICAgICAqLwogICAg\ncHJvdGVjdGVkIGFic3RyYWN0IGJvb2xlYW4gaXNEZWZhdWx0UGVyc2lzdGVu\ndChDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgTWVtYmVyIG1lbWJlciwg\nU3RyaW5nIG5hbWUpOwoKICAgIHB1YmxpYyBNZW1iZXIgZ2V0QmFja2luZ01l\nbWJlcihGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8jIyMgbm90ZSB0aGF0IHdlIG1pZ2h0IG5vdCBoYXZl\nIGFjY2VzcyB0byBkZWNsYXJpbmcgbWV0YWRhdGEgeWV0CiAgICAgICAgICAg\nIC8vIyMjICh0aGlzIGNvdWxkIGJlIHVzZWQgZHVyaW5nIHBhcnNlKSwgc28g\nd2UgaGF2ZSB0byBzZXR0bGUgZm9yCiAgICAgICAgICAgIC8vIyMjIGRlZmlu\naW5nLiAgY291bGQgY2F1c2UgcHJvYmxlbXMgaWYgbWFwcyBhIHN1cGVyY2xh\nc3MgZmllbGQKICAgICAgICAgICAgLy8jIyMgd2hlcmUgdGhlIHN1cGVyY2xh\nc3MgdXNlcyBhIGRpZmZlcmVudCBhY2Nlc3MgdHlwZQogICAgICAgICAgICBp\nZiAoZm1kLmdldERlZmluaW5nTWV0YURhdGEoKS5nZXRBY2Nlc3NUeXBlKCkg\nPT0KICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxE\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJpbmdUeXBl\nKCkuZ2V0RGVjbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgcmV0dXJuIFJlZmxlY3Rpb24uZmluZEdldHRlcihmbWQuZ2V0RGVjbGFy\naW5nVHlwZSgpLCBmbWQuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgdHJ1\nZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRV\nbmltcGxlbWVudGVkRXhjZXB0aW9uVHlwZSgpIHsKICAgICAgICByZXR1cm4g\nVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24uY2xhc3M7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kOyByZXR1cm5zIHRydWUgaWYg\ndGhlIGdpdmVuIGNsYXNzIGFwcGVhcnMgdG8gYmUKICAgICAqIHVzZXItZGVm\naW5lZC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBib29sZWFuIGlz\nVXNlckRlZmluZWQoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJuIGNscyAh\nPSBudWxsICYmICFjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImphdmEuIikK\nICAgICAgICAgICAgJiYgIWNscy5nZXROYW1lKCkuc3RhcnRzV2l0aCAoImph\ndmF4LiIpOwoJfQp9Cg==\n","encoding":"base64"}

