{"sha":"e3cbd0d3182ef31fca089018b1db52af6fcb18cc","node_id":"MDQ6QmxvYjIwNjM2NDplM2NiZDBkMzE4MmVmMzFmY2EwODkwMThiMWRiNTJhZjZmY2IxOGNj","size":77979,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e3cbd0d3182ef31fca089018b1db52af6fcb18cc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VD\nYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVm\nbGVjdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxv\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5Tb3VyY2VU\ncmFja2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIueG1sLkNv\nbW1lbnRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQnl0\nZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhcklkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRGF0ZUlkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRG91YmxlSWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5GbG9hdElkOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGlsLlN0\ncmluZ3M7CgovKioKICogQ29udGFpbnMgbWV0YWRhdGEgYWJvdXQgYSBwZXJz\naXN0ZW50IHR5cGUuCiAqIFRoaXMgbWV0YWRhdGEgaXMgYXZhaWxhYmxlIGJv\ndGggYXQgZW5oYW5jZW1lbnQgdGltZSBhbmQgcnVudGltZS4KICogIE5vdGUg\ndGhhdCB0aGlzIGNsYXNzIGVtcGxveXMgYWdncmVzc2l2ZSBjYWNoaW5nLCBh\nbmQgdGhlcmVmb3JlIGl0IGlzCiAqIGltcG9ydGFudCB0byBmaW5hbGl6ZSB0\naGUgY29uZmlndXJhdGlvbiBvZiBmaWVsZCBtZXRhZGF0YXMgYmVmb3JlIGlu\ndm9raW5nCiAqIG1ldGhvZHMgdGhhdCBkZXBlbmQgb24gdGhhdCBjb25maWd1\ncmF0aW9uLCBzdWNoIGFzCiAqIHtAbGluayAjZ2V0UHJpbWFyeUtleUZpZWxk\nc30uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3Mg\nQ2xhc3NNZXRhRGF0YQogICAgZXh0ZW5kcyBFeHRlbnNpb25zCiAgICBpbXBs\nZW1lbnRzIENvbXBhcmFibGUsIFNvdXJjZVRyYWNrZXIsIE1ldGFEYXRhQ29u\ndGV4dCwgTWV0YURhdGFNb2RlcywKICAgIENvbW1lbnRhYmxlIHsKCiAgICAv\nKioKICAgICAqIFVua29ud24gaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSURfVU5LTk9XTiA9IDA7CgogICAg\nLyoqCiAgICAgKiBEYXRhc3RvcmUgaWRlbnRpdHkgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSURfREFUQVNUT1JFID0gMTsK\nCiAgICAvKioKICAgICAqIEFwcGxpY2F0aW9uIGlkZW50aXR5IHR5cGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElEX0FQUExJQ0FU\nSU9OID0gMjsKCiAgICAvKioKICAgICAqIFVua25vd24gYWNjZXNzIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19V\nTktOT1dOID0gMDsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmli\ndXRlcyBhcmUgYWNjZXNzZWQgdmlhIGRpcmVjdCBmaWVsZCBhY2Nlc3MuIEJp\ndCBmbGFnLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBB\nQ0NFU1NfRklFTEQgPSAyIDw8IDA7CgogICAgLyoqCiAgICAgKiBQZXJzaXN0\nZW50IGF0dHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBzZXR0ZXJzIGFuZCBn\nZXR0ZXJzLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgQUNDRVNTX1BST1BFUlRZID0gMiA8PCAxOwoKICAgIC8qKgog\nICAgICogVmFsdWUgZm9yIHVzaW5nIGEgc3ludGhldGljIGRldGFjaGVkIHN0\nYXRlIGZpZWxkLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1lOVEhFVElDID0gImBzeW4i\nOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIERFRkFVTFRf\nU1RSSU5HID0gImAiOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQ2xh\nc3NNZXRhRGF0YS5jbGFzcyk7CgogICAgcHJpdmF0ZSBNZXRhRGF0YVJlcG9z\naXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NMb2Fk\nZXIgX2xvYWRlciA9IG51bGw7CgogICAgcHJpdmF0ZSBmaW5hbCBWYWx1ZU1l\ndGFEYXRhIF9vd25lcjsKICAgIHByaXZhdGUgZmluYWwgTGlmZWN5Y2xlTWV0\nYURhdGEgX2xpZmVNZXRhID0gbmV3IExpZmVjeWNsZU1ldGFEYXRhKHRoaXMp\nOwogICAgcHJpdmF0ZSBGaWxlIF9zcmNGaWxlID0gbnVsbDsKICAgIHByaXZh\ndGUgaW50IF9zcmNUeXBlID0gU1JDX09USEVSOwogICAgcHJpdmF0ZSBTdHJp\nbmdbXSBfY29tbWVudHMgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX2xpc3RJ\nbmRleCA9IC0xOwogICAgcHJpdmF0ZSBpbnQgX3NyY01vZGUgPSBNT0RFX01F\nVEEgfCBNT0RFX01BUFBJTkc7CiAgICBwcml2YXRlIGludCBfcmVzTW9kZSA9\nIE1PREVfTk9ORTsKCiAgICBwcml2YXRlIENsYXNzIF90eXBlID0gT2JqZWN0\nLmNsYXNzOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2ZpZWxkTWFwID0gbmV3\nIFRyZWVNYXAoKTsKICAgIHByaXZhdGUgTWFwIF9zdXBGaWVsZE1hcCA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2RlZlN1cEZpZWxkcyA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF9zdGF0aWNGaWVsZHMgPSBudWxs\nOwogICAgcHJpdmF0ZSBpbnRbXSBfZmllbGREYXRhVGFibGUgPSBudWxsOwog\nICAgcHJpdmF0ZSBNYXAgX2ZnTWFwID0gbnVsbDsKCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gTm90ZTogaWYgeW91IGFkZCBhZGRpdGlv\nbmFsIHN0YXRlLCBtYWtlIHN1cmUgdG8gYWRkIGl0IHRvIGNvcHkoKQogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwcml2YXRlIENsYXNzIF9v\nYmplY3RJZCA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX29iamVjdElk\nU2hhcmVkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfb3BlbmpwYUlk\nID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfZXh0ZW50ID0gbnVsbDsK\nICAgIHByaXZhdGUgQm9vbGVhbiBfZW1iZWRkZWQgPSBudWxsOwogICAgcHJp\ndmF0ZSBCb29sZWFuIF9pbnRlcmZhY2UgPSBudWxsOwogICAgcHJpdmF0ZSBD\nbGFzcyBfaW1wbCA9IG51bGw7CiAgICBwcml2YXRlIExpc3QgX2ludGVyZmFj\nZXMgPSBudWxsOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2lmYWNlTWFwID0g\nbmV3IEhhc2hNYXAoKTsKICAgIHByaXZhdGUgaW50IF9pZGVudGl0eSA9IElE\nX1VOS05PV047CiAgICBwcml2YXRlIGludCBfaWRTdHJhdGVneSA9IFZhbHVl\nU3RyYXRlZ2llcy5OT05FOwogICAgcHJpdmF0ZSBpbnQgX2FjY2Vzc1R5cGUg\nPSBBQ0NFU1NfVU5LTk9XTjsKCiAgICBwcml2YXRlIFN0cmluZyBfc2VxTmFt\nZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBTZXF1ZW5jZU1ldGFE\nYXRhIF9zZXFNZXRhID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9jYWNo\nZU5hbWUgPSBERUZBVUxUX1NUUklORzsKICAgIHByaXZhdGUgaW50IF9jYWNo\nZVRpbWVvdXQgPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgIHByaXZhdGUgQm9v\nbGVhbiBfZGV0YWNoYWJsZSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBf\nZGV0YWNoU3RhdGUgPSBERUZBVUxUX1NUUklORzsKICAgIHByaXZhdGUgU3Ry\naW5nIF9hbGlhcyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfdmVyc2lvbklk\neCA9IEludGVnZXIuTUlOX1ZBTFVFOwoKICAgIHByaXZhdGUgQ2xhc3MgX3N1\ncGVyID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBfc3VwZXJN\nZXRhID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NbXSBfc3VicyA9IG51bGw7\nCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGFbXSBfc3ViTWV0YXMgPSBudWxs\nOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhW10gX21hcFN1Yk1ldGFzID0g\nbnVsbDsKCiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfZmllbGRzID0g\nbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF91bm1nZEZpZWxk\ncyA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsRmll\nbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxQ\nS0ZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBf\nYWxsREZHRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0\nYVtdIF9kZWZpbmVkRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRN\nZXRhRGF0YVtdIF9saXN0aW5nRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUg\nRmllbGRNZXRhRGF0YVtdIF9hbGxMaXN0aW5nRmllbGRzID0gbnVsbDsKICAg\nIHByaXZhdGUgRmV0Y2hHcm91cFtdIF9mZ3MgPSBudWxsOwogICAgcHJpdmF0\nZSBGZXRjaEdyb3VwW10gX2N1c3RvbUZHcyA9IG51bGw7CgogICAgLyoqCiAg\nICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCBy\nZXBvc2l0b3J5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0\nYShDbGFzcyB0eXBlLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAg\nICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfb3duZXIgPSBudWxsOwog\nICAgICAgIHNldERlc2NyaWJlZFR5cGUodHlwZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFbWJlZGRlZCBjb25zdHJ1Y3Rvci4gU3VwcGx5IGVtYmVkZGlu\nZyB2YWx1ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEo\nVmFsdWVNZXRhRGF0YSBvd25lcikgewogICAgICAgIF9vd25lciA9IG93bmVy\nOwogICAgICAgIF9yZXBvcyA9IG93bmVyLmdldFJlcG9zaXRvcnkoKTsKICAg\nICAgICBzZXRFbnZDbGFzc0xvYWRlcihvd25lci5nZXRGaWVsZE1ldGFEYXRh\nKCkuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAgICBnZXRFbnZD\nbGFzc0xvYWRlcigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgb3duaW5nIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBNZXRh\nRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgpIHsKICAgICAgICByZXR1\ncm4gX3JlcG9zOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhpcyBtZXRh\nZGF0YSBpcyBmb3IgYW4gZW1iZWRkZWQgb2JqZWN0LCByZXR1cm5pbmcgdGhl\nIG93bmluZyB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFZhbHVlTWV0YURh\ndGEgZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9v\nd25lcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwZXJzaXN0ZW5jZSBj\nYXBhYmxlIGNsYXNzIGRlc2NyaWJlZCBieSB0aGlzIG1ldGFkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0RGVzY3JpYmVkVHlwZSgpIHsKICAg\nICAgICByZXR1cm4gX3R5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIGNsYXNzIGRlc2NpYmVkIGJ5IHRoaXMgbWV0YWRhdGEuIFRoZSB0eXBl\nIG1heSBiZSByZXNldCB3aGVuCiAgICAgKiBhbiBlbWJlZGRlZCB2YWx1ZSBj\naGFuZ2VzIGl0cyBkZWNsYXJlZCB0eXBlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBzZXREZXNjcmliZWRUeXBlKENsYXNzIHR5cGUpIHsKICAgICAg\nICBpZiAodHlwZS5nZXRTdXBlcmNsYXNzKCkgIT0gbnVsbCAmJiAiamF2YS5s\nYW5nLkVudW0iLmVxdWFscwogICAgICAgICAgICAodHlwZS5nZXRTdXBlcmNs\nYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbnVtIiwgdHlwZSkpOwogICAgICAg\nIF90eXBlID0gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBlbnZp\ncm9ubWVudGFsIGxvYWRlciB1c2VkIHdoZW4gbG9hZGluZyB0aGlzIG1ldGFk\nYXRhLgogICAgICogVGhlIGNsYXNzIG1ldGFkYXRhIHNob3VsZCB1c2UgdGhp\ncyBsb2FkZXIgd2hlbiBsb2FkaW5nIG1ldGFkYXRhIGZvcgogICAgICogaXRz\nIHN1cGVyY2xhc3MgYW5kIGZpZWxkIHR5cGVzLgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3NMb2FkZXIgZ2V0RW52Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAg\ncmV0dXJuIF9sb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xh\nc3MgZW52aXJvbm1lbnRhbCBsb2FkZXIgdXNlZCB3aGVuIGxvYWRpbmcgdGhp\ncyBtZXRhZGF0YS4KICAgICAqIFRoZSBjbGFzcyBtZXRhZGF0YSBzaG91bGQg\ndXNlIHRoaXMgbG9hZGVyIHdoZW4gbG9hZGluZyBtZXRhZGF0YSBmb3IKICAg\nICAqIGl0cyBzdXBlcmNsYXNzIGFuZCBmaWVsZCB0eXBlcy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIg\nbG9hZGVyKSB7CiAgICAgICAgX2xvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1cGVyY2xh\nc3Mgb2YgdGhlIGRlc2NyaWJlZCB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3MgZ2V0UENTdXBlcmNsYXNzKCkgewogICAgICAgIHJldHVybiBfc3Vw\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGVyc2lzdGVuY2UgY2Fw\nYWJsZSBzdXBlcmNsYXNzIG9mIHRoZSBkZXNjcmliZWQgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0UENTdXBlcmNsYXNzKENsYXNzIHBjKSB7\nCiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX3N1cGVy\nID0gcGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9y\nIHRoaXMgY2xhc3MnIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzc01ldGFEYXRhIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAg\nICAgIGlmIChfc3VwZXJNZXRhID09IG51bGwgJiYgX3N1cGVyICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBfc3VwZXJNZXRhID0gX3JlcG9zLm5ld0VtYmVkZGVkQ2xhc3NN\nZXRhRGF0YShfb3duZXIpOwogICAgICAgICAgICAgICAgX3N1cGVyTWV0YS5z\nZXREZXNjcmliZWRUeXBlKF9zdXBlcik7CiAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgX3N1cGVyTWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0\nYShfc3VwZXIsIF9sb2FkZXIsIHRydWUpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX3N1cGVyTWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBt\nZXRhZGF0YSBmb3IgdGhpcyBjbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0UENTdXBlcmNsYXNzTWV0YURhdGEoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7\nCiAgICAgICAgX3N1cGVyTWV0YSA9IG1ldGE7CiAgICAgICAgaWYgKG1ldGEg\nIT0gbnVsbCkKICAgICAgICAgICAgc2V0UENTdXBlcmNsYXNzKG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhpcyBjbGFzcyBpcyBtYXBwZWQgdG8gdGhlIGRhdGFzdG9yZS4gQnkg\nZGVmYXVsdCwgb25seQogICAgICogcmV0dXJucyBmYWxzZSBpZiBjbGFzcyBp\ncyBlbWJlZGRlZC1vbmx5LCBidXQgc3ViY2xhc3NlcyBtaWdodCBvdmVycmlk\nZQogICAgICogdG8gYWxsb3cgdW5tYXBwZWQgb3RoZXIgdHlwZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzTWFwcGVkKCkgewogICAgICAgIHJl\ndHVybiBfZW1iZWRkZWQgIT0gQm9vbGVhbi5UUlVFOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBjbG9zZXN0IG1hcHBlZCBzdXBlcmNsYXNz\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNYXBwZWRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpIHsKICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYg\nKHN1cCA9PSBudWxsIHx8IHN1cC5pc01hcHBlZCgpKQogICAgICAgICAgICBy\nZXR1cm4gc3VwOwogICAgICAgIHJldHVybiBzdXAuZ2V0TWFwcGVkUENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUga25vd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9m\nIHRoZSBkZXNjcmliZWQgdHlwZSwKICAgICAqIG9yIGVtcHR5IGFycmF5IGlm\nIG5vbmUgb3IgaWYgdGhpcyBpcyBlbWJlZGRlZCBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHVibGljIENsYXNzW10gZ2V0UENTdWJjbGFzc2VzKCkgewogICAg\nICAgIGlmIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9y\nZXBvcy5FTVBUWV9DTEFTU0VTOwoKICAgICAgICBfcmVwb3MucHJvY2Vzc1Jl\nZ2lzdGVyZWRDbGFzc2VzKF9sb2FkZXIpOwogICAgICAgIGlmIChfc3VicyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc3VicyA9IF9yZXBv\ncy5nZXRQQ1N1YmNsYXNzZXMoX3R5cGUpOwogICAgICAgICAgICBfc3VicyA9\nIChDbGFzc1tdKSBzdWJzLnRvQXJyYXkobmV3IENsYXNzW3N1YnMuc2l6ZSgp\nXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfc3ViczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBrbm93\nbiBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1YmNsYXNzZXMgb2YKICAgICAqIHRo\nZSBkZXNjcmliZWQgdHlwZSwgb3IgZW1wdHkgYXJyYXkgaWYgbm9uZSBvciBp\nZiB0aGlzIGlzIGVtYmVkZGVkCiAgICAgKiBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWV0YURhdGFbXSBnZXRQQ1N1YmNsYXNzTWV0YURh\ndGFzKCkgewogICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9yZXBvcy5FTVBUWV9NRVRBUzsKCiAgICAgICAgQ2xhc3Nb\nXSBzdWJzID0gZ2V0UENTdWJjbGFzc2VzKCk7IC8vIGNoZWNrcyBmb3IgbmV3\nCiAgICAgICAgaWYgKF9zdWJNZXRhcyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChzdWJzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgX3N1Yk1l\ndGFzID0gX3JlcG9zLkVNUFRZX01FVEFTOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcyA9IF9yZXBv\ncy5uZXdDbGFzc01ldGFEYXRhQXJyYXkKICAgICAgICAgICAgICAgICAgICAo\nc3Vicy5sZW5ndGgpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBzdWJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIG1l\ndGFzW2ldID0gX3JlcG9zLmdldE1ldGFEYXRhKHN1YnNbaV0sIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgICAgICAgICAgX3N1Yk1ldGFzID0gbWV0YXM7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdWJNZXRh\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgbWFwcGVkIHN1\nYmNsYXNzZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10g\nZ2V0TWFwcGVkUENTdWJjbGFzc01ldGFEYXRhcygpIHsKICAgICAgICBpZiAo\nX293bmVyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1Q\nVFlfTUVUQVM7CgogICAgICAgIENsYXNzTWV0YURhdGFbXSBzdWJzID0gZ2V0\nUENTdWJjbGFzc01ldGFEYXRhcygpOyAvLyBjaGVja3MgZm9yIG5ldwogICAg\nICAgIGlmIChfbWFwU3ViTWV0YXMgPT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoc3Vicy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIF9tYXBTdWJN\nZXRhcyA9IHN1YnM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgTGlzdCBtYXBwZWQgPSBuZXcgQXJyYXlMaXN0KHN1YnMubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic1tpXS5pc01h\ncHBlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWQuYWRkKHN1\nYnNbaV0pOwogICAgICAgICAgICAgICAgX21hcFN1Yk1ldGFzID0gKENsYXNz\nTWV0YURhdGFbXSkgbWFwcGVkLnRvQXJyYXkKICAgICAgICAgICAgICAgICAg\nICAoX3JlcG9zLm5ld0NsYXNzTWV0YURhdGFBcnJheShtYXBwZWQuc2l6ZSgp\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9t\nYXBTdWJNZXRhczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0eXBlIG9m\nIGlkZW50aXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBiZSBvbmUgb2Y6CiAg\nICAgKiA8dWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9VTktOT1dOfTogdW5r\nbm93biBpZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI0lE\nX0RBVEFTVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGRhdGEgc3Rv\ncmUgYW5kCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUgZmllbGRzIG9mIHRo\nZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9BUFBMSUNB\nVElPTn06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFwcGxpY2F0aW9uIGFu\nZAogICAgICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBmaWVsZHMgb2YgdGhl\nIGluc3RhbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVuc3BlY2lmaWVkLCBk\nZWZhdWx0cyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0gaWYgdGhlcmUgYXJl\nIG5vCiAgICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFuZCB7QGxpbmsgI0lE\nX0FQUExJQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHB1YmxpYyBp\nbnQgZ2V0SWRlbnRpdHlUeXBlKCkgewogICAgICAgIGlmIChfaWRlbnRpdHkg\nPT0gSURfVU5LTk9XTikgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1\ncCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlm\nIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURf\nVU5LTk9XTikKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IHN1cC5nZXRJ\nZGVudGl0eVR5cGUoKTsKICAgICAgICAgICAgZWxzZSBpZiAoZ2V0UHJpbWFy\neUtleUZpZWxkcygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBfaWRl\nbnRpdHkgPSBJRF9BUFBMSUNBVElPTjsKICAgICAgICAgICAgZWxzZSBpZiAo\naXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IElEX0RB\nVEFTVE9SRTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lk\nZW50aXR5ID0gX3JlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1\nbHRzKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVmYXVsdElkZW50aXR5\nVHlwZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2lkZW50aXR5Owog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIHR5cGUgb2YgaWRlbnRpdHkgYmVp\nbmcgdXNlZC4gVGhpcyB3aWxsIGJlIG9uZSBvZjoKICAgICAqIDx1bD4KICAg\nICAqIDxsaT57QGxpbmsgI0lEX1VOS05PV059OiB1bmtub3duIGlkZW50aXR5\nIHR5cGU8L2xpPgogICAgICogPGxpPntAbGluayAjSURfREFUQVNUT1JFfTog\naWRlbnRpdHkgbWFuYWdlZCBieSB0aGUgZGF0YSBzdG9yZSBhbmQKICAgICAq\nIGluZGVwZW5kZW50CW9mIHRoZSBmaWVsZHMgb2YgdGhlIGluc3RhbmNlPC9s\naT4KICAgICAqIDxsaT57QGxpbmsgI0lEX0FQUExJQ0FUSU9OfTogaWRlbnRp\ndHkgbWFuYWdlZCBieSB0aGUgYXBwbGljYXRpb24gYW5kCiAgICAgKiBkZWZp\nbmVkIGJ5IG9uZSBvciBtb3JlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xp\nPgogICAgICogPC91bD4gSWYgdW5zcGVjaWZpZWQsIGRlZmF1bHRzIHRvIHtA\nbGluayAjSURfREFUQVNUT1JFfSBpZiB0aGVyZSBhcmUgbm8KICAgICAqIHBy\naW1hcnkga2V5IGZpZWxkcywgYW5kIHtAbGluayAjSURfQVBQTElDQVRJT059\nIG90aGVyd2lzZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SWRlbnRp\ndHlUeXBlKGludCB0eXBlKSB7CiAgICAgICAgX2lkZW50aXR5ID0gdHlwZTsK\nICAgICAgICBpZiAodHlwZSAhPSBJRF9BUFBMSUNBVElPTikgewogICAgICAg\nICAgICBfb2JqZWN0SWQgPSBudWxsOwogICAgICAgICAgICBfb3BlbmpwYUlk\nID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nbWV0YWRhdGEtc3BlY2lmaWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVj\ndCBJRC4KICAgICAqLwogICAgcHVibGljIENsYXNzIGdldE9iamVjdElkVHlw\nZSgpIHsKICAgICAgICBpZiAoX29iamVjdElkICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBfb2JqZWN0SWQ7CiAgICAgICAgaWYgKGdldElkZW50aXR5\nVHlwZSgpICE9IElEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1\ncC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKSB7CiAgICAgICAg\nICAgIF9vYmplY3RJZCA9IHN1cC5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAg\nICAgICAgcmV0dXJuIF9vYmplY3RJZDsKICAgICAgICB9CgogICAgICAgIC8v\nIGZpZ3VyZSBvdXQgb3BlbmpwYSBpZGVudGl0eSB0eXBlIGJhc2VkIG9uIHBy\naW1hcnkga2V5IGZpZWxkCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9\nIGdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAocGtzLmxlbmd0\naCAhPSAxKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBzd2l0\nY2ggKHBrc1swXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJ\nZCA9IEJ5dGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJ\nZCA9IENoYXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBfb2Jq\nZWN0SWQgPSBEb3VibGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAg\nX29iamVjdElkID0gRmxvYXRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBf\nb2JqZWN0SWQgPSBJbnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIF9v\nYmplY3RJZCA9IExvbmdJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAg\nX29iamVjdElkID0gU2hvcnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAg\nICAgICAgICAgICBfb2JqZWN0SWQgPSBTdHJpbmdJZC5jbGFzczsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nQVRFOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gRGF0ZUlkLmNsYXNz\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9JRDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gT2JqZWN0SWQuY2xhc3M7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9vYmplY3RJZDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YS1zcGVjaWZpZWQgY2xhc3MgdG8gdXNlIGZvciB0aGUgb2JqZWN0IElE\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3RJZFR5cGUoQ2xh\nc3MgY2xzLCBib29sZWFuIHNoYXJlZCkgewogICAgICAgIF9vYmplY3RJZCA9\nIG51bGw7CiAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgX29i\namVjdElkU2hhcmVkID0gbnVsbDsKICAgICAgICBpZiAoY2xzICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHBlb3BsZSBhc3NpZ24gT3Bl\nbkpQQUlkIHR5cGVzOyBzYWZlciB0byBjYWxjdWxhdGUgaXQKICAgICAgICAg\nICAgLy8gb3Vyc2VsdmVzCiAgICAgICAgICAgIHNldElkZW50aXR5VHlwZShJ\nRF9BUFBMSUNBVElPTik7CiAgICAgICAgICAgIGlmICghT3BlbkpQQUlkLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkgewogICAgICAgICAgICAgICAg\nX29iamVjdElkID0gY2xzOwogICAgICAgICAgICAgICAgX29iamVjdElkU2hh\ncmVkID0gKHNoYXJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGlzIHR5cGUgdXNlcyBhbiBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzcyB0aGF0IGlzIHNoYXJlZAogICAgICogd2l0aCBvdGhlciBj\nbGFzc2VzLCBhbmQgaXMgdGhlcmVmb3JlIHdyYXBwZWQgaW4gYW4ge0BsaW5r\nIE9iamVjdElkfS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNPYmpl\nY3RJZFR5cGVTaGFyZWQoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJZFNoYXJl\nZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElkU2hhcmVk\nLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\naXNPYmplY3RJZFR5cGVTaGFyZWQoKTsKICAgICAgICByZXR1cm4gaXNPcGVu\nSlBBSWRlbnRpdHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhpcyB0eXBlIHVzZXMgT3BlbkpQQSBpZGVudGl0eS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNPcGVuSlBBSWRlbnRpdHkoKSB7CiAgICAgICAg\naWYgKF9vcGVuanBhSWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBj\nbHMgPSBnZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgaWYgKGNscyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBfb3BlbmpwYUlkID0gKE9wZW5KUEFJZC5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKGNscykpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb3Bl\nbmpwYUlkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHN0cmF0ZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdl\nbmVyYXRpb24uCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtA\nbGluayBWYWx1ZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldElkZW50aXR5U3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGdldElkZW50\naXR5VHlwZSgpID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAmJiBfaWRT\ndHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkgewogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRl\nbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIF9p\nZFN0cmF0ZWd5ID0gc3VwLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBWYWx1\nZVN0cmF0ZWdpZXMuTkFUSVZFOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2lkU3RyYXRlZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRl\nZ3kgdG8gdXNlIGZvciBkYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4K\nICAgICAqIE9uZSBvZiB0aGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVl\nU3RyYXRlZ2llc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50\naXR5U3RyYXRlZ3koaW50IHN0cmF0ZWd5KSB7CiAgICAgICAgX2lkU3RyYXRl\nZ3kgPSBzdHJhdGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gVmFsdWVT\ndHJhdGVnaWVzLlNFUVVFTkNFKQogICAgICAgICAgICBzZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZShudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBk\nYXRhc3RvcmUgaWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Ig\nbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1\nYWxzKF9zZXFOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfc2VxTmFtZSA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBudWxsOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX3NlcU5hbWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNlIG5h\nbWUsIG9yIG51bGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldElkZW50aXR5U2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7CiAg\nICAgICAgX3NlcU5hbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFNZXRhID0g\nbnVsbDsKICAgICAgICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAgICAgICAg\nICBzZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5D\nRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBmb3IgdGhlIGRh\ndGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5jZS4KICAgICAqLwogICAgcHVibGlj\nIFNlcXVlbmNlTWV0YURhdGEgZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRh\nKCkgewogICAgICAgIGlmIChfc2VxTWV0YSA9PSBudWxsICYmIGdldElkZW50\naXR5U2VxdWVuY2VOYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgX3NlcU1l\ndGEgPSBfcmVwb3MuZ2V0U2VxdWVuY2VNZXRhRGF0YSh0aGlzLAogICAgICAg\nICAgICAgICAgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSwgdHJ1ZSk7CiAg\nICAgICAgcmV0dXJuIF9zZXFNZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nSW5mb3JtYXRpb24gYWJvdXQgbGlmZWN5Y2xlIGNhbGxiYWNrcyBmb3IgdGhp\ncyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZU1ldGFEYXRh\nIGdldExpZmVjeWNsZU1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbGlm\nZU1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBhbGlh\ncyBmb3IgdGhlIGRlc2NyaWJlZCB0eXBlLCBvciA8Y29kZT5udWxsPC9jb2Rl\nPiBpZiBub25lCiAgICAgKiBoYXMgYmVlbiBzZXQuCiAgICAgKiAKICAgICAq\nIEBzZWUgI3NldFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFR5cGVBbGlhcygpIHsKICAgICAgICBpZiAoX2FsaWFzID09IG51bGwp\nCiAgICAgICAgICAgIF9hbGlhcyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF90\neXBlKTsKICAgICAgICByZXR1cm4gX2FsaWFzOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0cyB0aGUgYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQgdHlwZS4g\nVGhlIGFsaWFzIGNhbiBiZQogICAgICogYW55IGFyYml0cmFyeSBzdHJpbmcg\ndGhhdCB0aGUgaW1wbGVtZW50YXRpb24gY2FuIGxhdGVyIHVzZSB0bwogICAg\nICogcmVmZXIgdG8gdGhlIGNsYXNzLiBOb3RlIHRoYXQgYXQgcnVudGltZSwg\nb25seSB0aGUgYWxpYXMKICAgICAqIGNvbXB1dGVkIHdoZW4gdGhlIHBlcnNp\nc3RlbnQgdHlwZSB3YXMgZW5oYW5jZWQgaXMgdXNlZC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gYWxpYXMgdGhlIGFsaWFzIG5hbWUgdG8gYXBwbHkgdG8gdGhl\nIGRlc2NyaWJlZCB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFR5\ncGVBbGlhcyhTdHJpbmcgYWxpYXMpIHsKICAgICAgICBfYWxpYXMgPSBhbGlh\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2Vk\nIGJ5IHRoaXMgY2xhc3MuIEVpdGhlciB7QGxpbmsgI0FDQ0VTU19GSUVMRH0K\nICAgICAqIG9yIHtAbGluayAjQUNDRVNTX1BST1BFUlRZfS4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRBY2Nlc3NUeXBlKCkgewogICAgICAgIGlmIChf\nYWNjZXNzVHlwZSA9PSBBQ0NFU1NfVU5LTk9XTikgewogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7\nCiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXAuZ2V0QWNjZXNzVHlwZSgpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRSZXBvc2l0b3J5KCkuZ2V0\nTWV0YURhdGFGYWN0b3J5KCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVm\nYXVsdHMoKS5nZXREZWZhdWx0QWNjZXNzVHlwZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWNjZXNzVHlwZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2VkIGJ5IHRoaXMg\nY2xhc3MuIE11c3QgYmUgZWl0aGVyCiAgICAgKiB7QGxpbmsgI0FDQ0VTU19G\nSUVMRH0gb3Ige0BsaW5rICNBQ0NFU1NfUFJPUEVSVFl9LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRBY2Nlc3NUeXBlKGludCB0eXBlKSB7CiAgICAg\nICAgX2FjY2Vzc1R5cGUgPSB0eXBlOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSByZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UmVxdWlyZXNFeHRlbnQo\nKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsIHx8IGlzRW1iZWRkZWRP\nbmx5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYg\nKF9leHRlbnQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9leHRlbnQgPSAo\nc3VwLmdldFJlcXVpcmVzRXh0ZW50KCkpID8gQm9vbGVhbi5UUlVFCiAgICAg\nICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gQm9vbGVhbi5UUlVFOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2V4dGVudC5ib29sZWFuVmFsdWUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgcmVx\ndWlyZXMgZXh0ZW50IG1hbmFnZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldFJlcXVpcmVzRXh0ZW50KGJvb2xlYW4gcmVxKSB7CiAgICAgICAg\nX2V4dGVudCA9IChyZXEpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgY2Fu\nIG9ubHkgYmUgdXNlZCBhcyBhbiBlbWJlZGRlZCBvYmplY3QuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkZWRPbmx5KCkgewogICAgICAg\nIGlmIChfZW1iZWRkZWQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9lbWJl\nZGRlZCA9IChzdXAuaXNFbWJlZGRlZE9ubHkoKSkgPyBCb29sZWFuLlRSVUUK\nICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZW1iZWRkZWQuYm9v\nbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\nZSB0eXBlIGNhbiBvbmx5IGJlIHVzZWQgYXMgYW4gZW1iZWRkZWQgb2JqZWN0\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbWJlZGRlZE9ubHkoYm9v\nbGVhbiBlbWJlZCkgewogICAgICAgIF9lbWJlZGRlZCA9IChlbWJlZCkgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGUgdHlwZSBpcyBhIG1hbmFnZWQgaW50ZXJmYWNl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWRJbnRlcmZh\nY2UoKSB7CiAgICAgICAgaWYgKCFfdHlwZS5pc0ludGVyZmFjZSgpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZh\nY2UgPT0gbnVsbCA/IGZhbHNlIDogX2ludGVyZmFjZS5ib29sZWFuVmFsdWUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgaXMg\nYSBtYW5hZ2VkIGludGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRNYW5hZ2VkSW50ZXJmYWNlKGJvb2xlYW4gbWFuYWdlZEludGVyZmFjZSkg\newogICAgICAgIGlmICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qt\naW50ZXJmYWNlIiwgX3R5cGUpKTsKICAgICAgICBfaW50ZXJmYWNlID0gbWFu\nYWdlZEludGVyZmFjZSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1hbmFnZWQgaW50\nZXJmYWNlIGltcGxlbWVudG9yIGlmIGFueS4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzIGdldEludGVyZmFjZUltcGwoKSB7CiAgICAgICAgcmV0dXJuIF9p\nbXBsOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtYW5hZ2VkIGlu\ndGVyZmFjZSBpbXBsZW1lbnRvciBjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzcyBpbXBsKSB7CiAgICAgICAg\nX2ltcGwgPSBpbXBsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFs\nbCBleHBsaWNpdGx5IGRlY2xhcmVkIGludGVyZmFjZXMgdGhpcyBjbGFzcyBp\nbXBsZW1lbnRzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NbXSBnZXREZWNs\nYXJlZEludGVyZmFjZXMoKSB7CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBNZXRhRGF0YVJlcG9zaXRvcnku\nRU1QVFlfQ0xBU1NFUzsKICAgICAgICByZXR1cm4gKENsYXNzW10pIF9pbnRl\ncmZhY2VzLnRvQXJyYXkobmV3IENsYXNzW19pbnRlcmZhY2VzLnNpemUoKV0p\nOwogICAgfQoKICAgIC8qKgogICAgICogRXhwbGljaXRseSBkZWNsYXJlIHRo\nZSBnaXZlbiBpbnRlcmZhY2UgYW1vbmcgdGhlIG9uZXMgdGhpcwogICAgICog\nY2xhc3MgaW1wbGVtZW50cy4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRk\nRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgICAgICBpZiAo\naWZhY2UgPT0gbnVsbCB8fCAhaWZhY2UuaXNJbnRlcmZhY2UoKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJk\nZWNsYXJlLW5vbi1pbnRlcmZhY2UiLAogICAgICAgICAgICAgICAgdGhpcywg\naWZhY2UpKTsKICAgICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAg\nICAgICAgICAgX2ludGVyZmFjZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgX2ludGVyZmFjZXMuYWRkKGlmYWNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSB0aGUgZ2l2ZW4gaW50ZXJmYWNlIGZyb20gdGhlIGRlY2xh\ncmVkIGxpc3QuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURl\nY2xhcmVkSW50ZXJmYWNlKENsYXNzIGlmYWNlKSB7CiAgICAgICAgaWYgKF9p\nbnRlcmZhY2VzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gX2ludGVyZmFjZXMucmVtb3ZlKGlmYWNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFsaWFzIHByb3BlcnRpZXMgZnJvbSB0aGUg\nZ2l2ZW4gaW50ZXJmYWNlIGR1cmluZyAgcXVlcmllcyB0bwogICAgICogdGhl\nIGxvY2FsIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRl\ncmZhY2VQcm9wZXJ0eUFsaWFzKENsYXNzIGlmYWNlLCBTdHJpbmcgb3JpZywg\nCiAgICAgICAgU3RyaW5nIGxvY2FsKSB7CiAgICAgICAgc3luY2hyb25pemVk\nIChfaWZhY2VNYXApIHsKICAgICAgICAgICAgTWFwIGZpZWxkcyA9IChNYXAp\nIF9pZmFjZU1hcC5nZXQoaWZhY2UpOwogICAgICAgICAgICBpZiAoZmllbGRz\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ldyBIYXNo\nTWFwKCk7CiAgICAgICAgICAgICAgICBfaWZhY2VNYXAucHV0KGlmYWNlLCBm\naWVsZHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaWVsZHMu\nY29udGFpbnNLZXkob3JpZykpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImR1cGxpY2F0ZS1pZmFjZS1h\nbGlhcyIsIAogICAgICAgICAgICAgICAgICAgIHRoaXMsIG9yaWcsIGxvY2Fs\nKSk7CiAgICAgICAgICAgIGZpZWxkcy5wdXQob3JpZywgbG9jYWwpOwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXQgbG9jYWwgZmll\nbGQgYWxpYXMgZm9yIHRoZSBnaXZlbiBpbnRlcmZhY2UgcHJvcGVydHkuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0SW50ZXJmYWNlUHJvcGVydHlB\nbGlhcyhDbGFzcyBpZmFjZSwgU3RyaW5nIG9yaWcpIHsKICAgICAgICBzeW5j\naHJvbml6ZWQgKF9pZmFjZU1hcCkgewogICAgICAgICAgICBNYXAgZmllbGRz\nID0gKE1hcCkgX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlm\nIChmaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICByZXR1cm4gKFN0cmluZykgZmllbGRzLmdldChvcmln\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJu\nIGFsbCBhbGlhc2VzIHByb3BlcnR5IG5hbWVkIGZvciB0aGUgZ2l2ZW4gaW50\nZXJmYWNlLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0SW50ZXJm\nYWNlQWxpYXNlZFByb3BlcnRpZXMoQ2xhc3MgaWZhY2UpIHsKICAgICAgICBz\neW5jaHJvbml6ZWQgKF9pZmFjZU1hcCkgewogICAgICAgICAgICBNYXAgZmll\nbGRzID0gKE1hcCkgX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAg\nIGlmIChmaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgU3RyaW5nWzBdOwogICAgICAgICAgICByZXR1cm4gKFN0cmluZ1tdKSBm\naWVsZHMua2V5U2V0KCkudG9BcnJheShuZXcgU3RyaW5nWzBdKTsKICAgICAg\nICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1i\nZXIgb2YgZmllbGRzIHRoYXQgdXNlIGltcGwgb3IgaW50ZXJtZWRpYXRlIGRh\ndGEsIGluCiAgICAgKiBvcmRlciB0byBjcmVhdGUgYSBjb21wYWN0ZWQgYXJy\nYXkgZm9yIHN0b3JhZ2Ugb2Ygc2FpZCBkYXRhLgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldEV4dHJhRmllbGREYXRhTGVuZ3RoKCkgewogICAgICAgIGlu\ndFtdIHRhYmxlID0gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpOwogICAgICAg\nIGZvciAoaW50IGkgPSB0YWJsZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkK\nICAgICAgICAgICAgaWYgKHRhYmxlW2ldICE9IC0xKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHRhYmxlW2ldICsgMTsKICAgICAgICByZXR1cm4gMDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgaW1wbCAvIGludGVybWVk\naWF0ZSBmaWVsZCBkYXRhIGluZGV4IG9mIHRoZSBnaXZlbiBmaWVsZAogICAg\nICogaW4gdGhlIGNvbXBhY3RlZCBhcnJheSwgb3IgLTEgaWYgdGhlIGZpZWxk\nIGRvZXMgbm90IHVzZSBleHRyYSBkYXRhLgogICAgICoKICAgICAqIEBzZWUg\nI2dldEV4dHJhRmllbGREYXRhTGVuZ3RoCiAgICAgKi8KICAgIHB1YmxpYyBp\nbnQgZ2V0RXh0cmFGaWVsZERhdGFJbmRleChpbnQgZmllbGQpIHsKICAgICAg\nICByZXR1cm4gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpW2ZpZWxkXTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYSB0YWJsZSBtYXBwaW5nIGVh\nY2ggZmllbGQgaW5kZXggdG8gaXRzIGV4dHJhIGRhdGEgaW5kZXguCiAgICAg\nKi8KICAgIHByaXZhdGUgaW50W10gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgp\nIHsKICAgICAgICBpZiAoX2ZpZWxkRGF0YVRhYmxlID09IG51bGwpIHsKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRGaWVsZHMoKTsK\nICAgICAgICAgICAgaW50W10gdGFibGUgPSBuZXcgaW50W2ZtZHMubGVuZ3Ro\nXTsKICAgICAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgaWYgKGZtZHNbaV0udXNlc0ludGVybWVkaWF0ZSgpCiAgICAgICAg\nICAgICAgICAgICAgfHwgZm1kc1tpXS51c2VzSW1wbERhdGEoKSAhPSBCb29s\nZWFuLkZBTFNFKQogICAgICAgICAgICAgICAgICAgIHRhYmxlW2ldID0gaWR4\nKys7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\ndGFibGVbaV0gPSAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfZmll\nbGREYXRhVGFibGUgPSB0YWJsZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9maWVsZERhdGFUYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB3aGV0aGVyIHRoZSBnaXZlbiBuYW1lIHJlcHJlc2VudHMgYSBtYW5hZ2Vk\nIG9yIHN0YXRpYyBmaWVsZCBvZgogICAgICogdGhpcyBjbGFzcywgaW5jbHVk\naW5nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0FjY2Vzc2libGVGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAg\nICBpZiAoZ2V0RGVjbGFyZWRGaWVsZChmaWVsZCkgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9zdGF0aWNGaWVsZHMg\nPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZFtdIGZpZWxkcyA9IF90eXBl\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgIFNldCBuYW1lcyA9\nIG5ldyBIYXNoU2V0KChpbnQpIChmaWVsZHMubGVuZ3RoICogMS4zMyArIDEp\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNTdGF0\naWMoZmllbGRzW2ldLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAg\nICAgICBuYW1lcy5hZGQoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgIF9zdGF0aWNGaWVsZHMgPSBuYW1lczsKICAgICAgICB9CiAgICAgICAg\naWYgKF9zdGF0aWNGaWVsZHMuY29udGFpbnMoZmllbGQpKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmlz\nQWNjZXNzaWJsZUZpZWxkKGZpZWxkKTsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGZpZWxkIG1ldGFk\nYXRhcywgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICovCiAg\nICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldEZpZWxkcygpIHsKICAgICAg\nICBpZiAoX2FsbEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChf\nc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hbGxGaWVsZHMgPSBn\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1\ncEZpZWxkcyA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0RmllbGRzKCk7CgogICAgICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGFsbEZpZWxkcyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFE\nYXRhQXJyYXkKICAgICAgICAgICAgICAgICAgICAoZmllbGRzLmxlbmd0aCAr\nIHN1cEZpZWxkcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShzdXBGaWVsZHMsIDAsIGFsbEZpZWxkcywgMCwgc3VwRmllbGRz\nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICByZXBsYWNlRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZHMoYWxsRmllbGRzLCBzdXBGaWVsZHMubGVuZ3RoKTsKCiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5zZXRJ\nbmRleChzdXBGaWVsZHMubGVuZ3RoICsgaSk7CiAgICAgICAgICAgICAgICAg\nICAgYWxsRmllbGRzW3N1cEZpZWxkcy5sZW5ndGggKyBpXSA9IGZpZWxkc1tp\nXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9hbGxGaWVs\nZHMgPSBhbGxGaWVsZHM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9hbGxGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXBsYWNlIHN1cGVyY2xhc3MgZmllbGRzIHRoYXQgd2UgZGVmaW5lIHdpdGgg\nb3VyIHZlcnNpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNl\nRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoRmllbGRNZXRhRGF0YVtdIGZpZWxk\ncywKICAgICAgICBpbnQgbGVuKSB7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1h\ncCA9PSBudWxsIHx8ICFfZGVmU3VwRmllbGRzKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGRvbid0IGFzc3VtZSBmaWVsZHMgYXJlIGluIG9y\nZGVyOyB0aGlzIG1ldGhvZCBpcyB1c2VkIGZvcgogICAgICAgIC8vIGxpc3Rp\nbmcgb3JkZXIgYXMgd2VsbAogICAgICAgIEZpZWxkTWV0YURhdGEgc3VwRmll\nbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewog\nICAgICAgICAgICBzdXBGaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfc3VwRmll\nbGRNYXAuZ2V0KGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBp\nZiAoc3VwRmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmllbGRz\nW2ldID0gc3VwRmllbGQ7CiAgICAgICAgICAgICAgICBzdXBGaWVsZC5zZXRJ\nbmRleChpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgc3VwZXJjbGFzcyBjb3B5IG9mIHRoZSBn\naXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURh\ndGEgZ2V0U3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEgc3VwRmllbGQp\nIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHNtID0gZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHNtID09\nIG51bGwgPyBudWxsIDogc20uZ2V0RmllbGQoc3VwRmllbGQuZ2V0TmFtZSgp\nKTsKICAgICAgICBpZiAoZm1kID09IG51bGwgfHwgZm1kLmdldE1hbmFnZW1l\nbnQoKSAhPSBmbWQuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5tYW5hZ2Vk\nLXN1cC1maWVsZCIsCiAgICAgICAgICAgICAgICBzdXBGaWVsZCwgdGhpcykp\nOwogICAgICAgIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gb25seSB0aGUgZmllbGRzIGZvciB0aGlzIGNsYXNzLCB3aXRob3V0\nIHN1cGVyY2xhc3MgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YVtdIGdldERlY2xhcmVkRmllbGRzKCkgewogICAgICAgIGlmIChf\nZmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgTGlzdCBmaWVsZHMgPSBu\nZXcgQXJyYXlMaXN0KF9maWVsZE1hcC5zaXplKCkpOwogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfZmllbGRNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIGZtZCA9IChGaWVsZE1ldGFEYXRh\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRNYW5h\nZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSkgewogICAg\nICAgICAgICAgICAgICAgIGZtZC5zZXREZWNsYXJlZEluZGV4KGZpZWxkcy5z\naXplKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0SW5kZXgo\nKSA9PSAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEluZGV4\nKGZtZC5nZXREZWNsYXJlZEluZGV4KCkpOwogICAgICAgICAgICAgICAgICAg\nIGZpZWxkcy5hZGQoZm1kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBfZmllbGRzID0gKEZpZWxkTWV0YURhdGFbXSkg\nZmllbGRzLnRvQXJyYXkKICAgICAgICAgICAgICAgIChfcmVwb3MubmV3Rmll\nbGRNZXRhRGF0YUFycmF5KGZpZWxkcy5zaXplKCkpKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9maWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gcHJpbWFyeSBrZXkgZmllbGRzLCBvciBlbXB0eSBhcnJheSBpZiBu\nb25lLiBUaGUgb3JkZXIKICAgICAqIGluIHdoaWNoIHRoZSBrZXlzIGFyZSBy\nZXR1cm5lZCB3aWxsIGJlIHRoZSBvcmRlciBpbiB3aGljaAogICAgICogdGhl\nIGZpZWxkcyBhcmUgZGVjbGFyZWQsIHN0YXJ0aW5nIGF0IHRoZSBsZWFzdC1k\nZXJpdmVkIHN1cGVyY2xhc3MKICAgICAqIGFuZCBlbmRpbmcgd2l0aCB0aGUg\ncHJpbWFyeSBrZXkgZmllbGRzIG9mIHRoZSBtb3N0LWRlcml2ZWQgc3ViY2xh\nc3MuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0UHJp\nbWFyeUtleUZpZWxkcygpIHsKICAgICAgICAvLyBjaGVjayBmb3IgcGsgZmll\nbGRzIGV2ZW4gaWYgbm90IHNldCB0byBJRF9BUFBMSUNBVElPTiBzbyB0aGF0\nCiAgICAgICAgLy8gYXBwIGlkIHRvb2wgc2VlcyB0aGVtIGV2ZW4gd2hlbiB1\nc2VyIGRvZXNuJ3QgZGVjbGFyZSBhcHAgaWQKICAgICAgICBpZiAoX2FsbFBL\nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnQgbnVtID0g\nMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzUHJp\nbWFyeUtleSgpKQogICAgICAgICAgICAgICAgICAgIG51bSsrOwoKICAgICAg\nICAgICAgaWYgKG51bSA9PSAwKQogICAgICAgICAgICAgICAgX2FsbFBLRmll\nbGRzID0gX3JlcG9zLkVNUFRZX0ZJRUxEUzsKICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gX3JlcG9z\nLm5ld0ZpZWxkTWV0YURhdGFBcnJheShudW0pOwogICAgICAgICAgICAgICAg\nbnVtID0gMDsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXkoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBmaWVsZHNbaV0uc2V0UHJpbWFyeUtleUluZGV4KG51bSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHBrc1tudW1dID0gZmllbGRzW2ldOwog\nICAgICAgICAgICAgICAgICAgICAgICBudW0rKzsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfYWxs\nUEtGaWVsZHMgPSBwa3M7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9hbGxQS0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbGlzdCBvZiBmaWVsZHMgaW4gdGhlIGRlZmF1bHQgZmV0\nY2ggZ3JvdXAsCiAgICAgKiBpbmNsdWRpbmcgc3VwZXJjbGFzcyBmaWVsZHMs\nIG9yIGFuIGVtcHR5IGFycmF5IGlmIG5vbmUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVmYXVsdEZldGNoR3JvdXBGaWVsZHMo\nKSB7CiAgICAgICAgaWYgKF9hbGxERkdGaWVsZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIGludCBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgIGlmIChmaWVsZHNbaV0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAg\nICAgICAgICAgICAgICAgICAgbnVtKys7CgogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZGZncyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXko\nbnVtKTsKICAgICAgICAgICAgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICBpZiAoZmllbGRzW2ldLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQog\nICAgICAgICAgICAgICAgICAgIGRmZ3NbbnVtKytdID0gZmllbGRzW2ldOwog\nICAgICAgICAgICBfYWxsREZHRmllbGRzID0gZGZnczsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9hbGxERkdGaWVsZHM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHZlcnNpb24gZmllbGQgZm9yIHRoaXMgY2xhc3Ms\nIGlmIGFueS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0\nVmVyc2lvbkZpZWxkKCkgewogICAgICAgIGlmIChfdmVyc2lvbklkeCA9PSBJ\nbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludCBpZHgg\nPSAtMTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0u\naXNWZXJzaW9uKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ICE9\nIC0xKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICgibXVsdC12ZXJzLWZpZWxkcyIsIHRoaXMsIGZpZWxkc1tpZHhdLCBm\naWVsZHNbaV0pKTsKICAgICAgICAgICAgICAgICAgICBpZHggPSBpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF92ZXJz\naW9uSWR4ID0gaWR4OwogICAgICAgIH0KICAgICAgICBpZiAoX3ZlcnNpb25J\nZHggPT0gLTEpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJl\ndHVybiBnZXRGaWVsZHMoKVtfdmVyc2lvbklkeF07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVu\ndCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZl\nbiBhYnNvbHV0ZSBpbmRleC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBm\naWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRGaWVsZChpbnQgaW5kZXgp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRz\nKCk7CiAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBmaWVsZHMu\nbGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gZmllbGRzW2luZGV4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5zYWN0\naW9uYWwgZmllbGQgd2l0aAogICAgICogdGhlIGdpdmVuIHJlbGF0aXZlIGlu\nZGV4LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRh\ndGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1ldGFEYXRhIGdldERlY2xhcmVkRmllbGQoaW50IGluZGV4KSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBmaWVs\nZHMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBy\nZXR1cm4gZmllbGRzW2luZGV4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5z\nYWN0aW9uYWwgZmllbGQgd2l0aAogICAgICogdGhlIGdpdmVuIG5hbWUuCiAg\nICAgKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBtZXRhZGF0YSwgb3Ig\nbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGEgZ2V0RmllbGQoU3RyaW5nIG5hbWUpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IGdldERlY2xhcmVkRmllbGQobmFtZSk7CiAgICAgICAg\naWYgKGZtZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZm1kOwogICAg\nICAgIGlmIChfc3VwRmllbGRNYXAgIT0gbnVsbCAmJiBfZGVmU3VwRmllbGRz\nKSB7CiAgICAgICAgICAgIGZtZCA9IChGaWVsZE1ldGFEYXRhKSBfc3VwRmll\nbGRNYXAuZ2V0KG5hbWUpOwogICAgICAgICAgICBpZiAoZm1kICE9IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gZm1kOwogICAgICAgIH0KICAgICAg\nICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldEZpZWxkKG5hbWUpOwogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25h\nbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gbmFtZSwgd2l0aG91dCBp\nbmNsdWRpbmcgc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAgKgogICAgICogQHJl\ndHVybiB0aGUgZmllbGQncyBtZXRhZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91\nbmQKICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVjbGFy\nZWRGaWVsZChTdHJpbmcgbmFtZSkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZmllbGQgPSAoRmllbGRNZXRhRGF0YSkgX2ZpZWxkTWFwLmdldChuYW1lKTsK\nICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCB8fCBmaWVsZC5nZXRNYW5hZ2Vt\nZW50KCkgPT0gZmllbGQuTUFOQUdFX05PTkUpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhbnkgZmllbGRzIHRoYXQgd2VyZSBhZGRlZCBhcyBu\nb24tbWFuYWdlZC4KICAgICAqIEFsbCBvdGhlciBtZXRob2RzIHRvIGdldCBm\naWVsZHMgcmV0dXJuIG9ubHkgdGhvc2UgdGhhdCBhcmUgbWFuYWdlZC4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJlZFVu\nbWFuYWdlZEZpZWxkcygpIHsKICAgICAgICBpZiAoX3VubWdkRmllbGRzID09\nIG51bGwpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiB1bm1hbmFnZWQgPSBu\nZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZp\nZWxkOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9maWVsZE1h\ncC52YWx1ZXMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgZmllbGQgPSAoRmllbGRNZXRhRGF0YSkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRNYW5hZ2VtZW50KCkg\nPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgICAg\nICAgICB1bm1hbmFnZWQuYWRkKGZpZWxkKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBfdW5tZ2RGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSB1bm1h\nbmFnZWQudG9BcnJheQogICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdGaWVs\nZE1ldGFEYXRhQXJyYXkodW5tYW5hZ2VkLnNpemUoKSkpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX3VubWdkRmllbGRzOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGEgbmV3IGZpZWxkIG1ldGFkYXRhIHRvIHRoaXMgY2xhc3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGFkZERlY2xhcmVk\nRmllbGQoU3RyaW5nIG5hbWUsIENsYXNzIHR5cGUpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhKG5hbWUs\nIHR5cGUsIHRoaXMpOwogICAgICAgIGNsZWFyRmllbGRDYWNoZSgpOwogICAg\nICAgIF9maWVsZE1hcC5wdXQobmFtZSwgZm1kKTsKICAgICAgICByZXR1cm4g\nZm1kOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBm\naWVsZCBmcm9tIG1hbmFnZW1lbnQuCiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIHRoZSBmaWVsZCB3YXMgcmVtb3ZlZCwgZmFsc2Ugb3RoZXJ3aXNl\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xhcmVkRmll\nbGQoRmllbGRNZXRhRGF0YSBmaWVsZCkgewogICAgICAgIGlmIChmaWVsZCAh\nPSBudWxsICYmIF9maWVsZE1hcC5yZW1vdmUoZmllbGQuZ2V0TmFtZSgpKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGNsZWFyRmllbGRDYWNoZSgpOwogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWZp\nbmVkIHN1cGVyY2xhc3MgZmllbGQgd2l0aCB0aGUgZ2l2ZW4gbmFtZSwgb3Ig\nbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYSBnZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKEZpZWxkTWV0YURhdGEpIF9z\ndXBGaWVsZE1hcC5nZXQobmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgYSBuZXcgZGVmaW5lZCBzdXBlcmNsYXNzIGZpZWxkIG1ldGFkYXRhIHRv\nIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRh\nIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5nIG5hbWUsIENsYXNz\nIHR5cGUsCiAgICAgICAgQ2xhc3Mgc3VwKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YShuYW1lLCB0eXBl\nLCB0aGlzKTsKICAgICAgICBmbWQuc2V0RGVjbGFyaW5nVHlwZShzdXApOwog\nICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgIF9kZWZTdXBG\naWVsZHMgPSBmYWxzZTsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51\nbGwpCiAgICAgICAgICAgIF9zdXBGaWVsZE1hcCA9IG5ldyBIYXNoTWFwKCk7\nCiAgICAgICAgX3N1cEZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAg\nIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhl\nIGdpdmVuIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBv\ndGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVm\naW5lZFN1cGVyY2xhc3NGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAg\nICAgICAgaWYgKGZpZWxkICE9IG51bGwgJiYgX3N1cEZpZWxkTWFwICE9IG51\nbGwKICAgICAgICAgICAgJiYgX3N1cEZpZWxkTWFwLnJlbW92ZShmaWVsZC5n\nZXROYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJBbGxGaWVs\nZENhY2hlKCk7CiAgICAgICAgICAgIF9kZWZTdXBGaWVsZHMgPSBmYWxzZTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEluY29ycG9yYXRl\nIHN1cGVyY2xhc3MgZmllbGRzIHJlZGVmaW5lZCBpbiB0aGlzIHN1YmNsYXNz\nIGludG8gdGhpcwogICAgICogbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGlzIGdl\nbmVyYWxseSBjYWxsZWQgYWZ0ZXIgbWV0YWRhdGEgaXMgcmVzb2x2ZWQKICAg\nICAqIGFuZCBtYXBwaW5nIGluZm9ybWF0aW9uIGlzIGxvYWRlZCwgYnV0IGJl\nZm9yZSBtYXBwaW5nIHJlc29sdmUuCiAgICAgKgogICAgICogQHBhcmFtIGZv\ncmNlIHdoZXRoZXIgdG8gZm9yY2UgcmUtbWFwcGluZyBvZiBldmVuIG1hcHBl\nZCBzdXBlcmNsYXNzIGZpZWxkcwogICAgICovCiAgICBwdWJsaWMgdm9pZCBk\nZWZpbmVTdXBlcmNsYXNzRmllbGRzKGJvb2xlYW4gZm9yY2UpIHsKICAgICAg\nICBpZiAoX2RlZlN1cEZpZWxkcykKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgaWYgKGlzTWFwcGVkKCkgJiYgc3VwICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gcmVkZWZpbmUgYWxsIHVubWFwcGVkIHN1cGVy\nY2xhc3MgZmllbGRzCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBz\nID0gc3VwLmdldEZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHN1cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlm\nICgoZm9yY2UgfHwgIXN1cHNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmlz\nTWFwcGVkKCkpCiAgICAgICAgICAgICAgICAgICAgJiYgZ2V0RGVmaW5lZFN1\ncGVyY2xhc3NGaWVsZChzdXBzW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQo\nc3Vwc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHN1\ncHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIHN1cHNbaV0uZ2V0RGVjbGFyaW5n\nVHlwZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMo\nKTsKCiAgICAgICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQgYWxsIGZpZWxkIGlu\nZGV4ZXMgZ2V0IHNldCB3aGVuIGZpZWxkcyBhcmUgY2FjaGVkLgogICAgICAg\nIC8vIEkgZG9uJ3QgbGlrZSBkb2luZyB0aGlzIHR3aWNlIChpdCdzIGFsc28g\nZG9uZSBpbiByZXNvbHZlTWV0YSksIGJ1dAogICAgICAgIC8vIHdlIGhhdmUg\ndG8gcmUtY2FjaGUgaW4gY2FzZSB0aGlzIGNsYXNzIG9yIGFueSBzdXBlcmNs\nYXNzIHJlcGxhY2VkCiAgICAgICAgLy8gc29tZSBmaWVsZHMgd2l0aCByZWRl\nZmluZWQgdmVyc2lvbnMsIGFuZCBJIGRvbid0IHdhbnQgb3V0c2lkZSBjb2Rl\nCiAgICAgICAgLy8gdG8gaGF2ZSB0byBjYWxsIHRoaXMgbWV0aG9kIGFmdGVy\nIHJlc29sdmUganVzdCB0byBnZXQgZmllbGQgaW5kZXhlcywKICAgICAgICAv\nLyBldGMgc2V0IGNvcnJlY3RseQogICAgICAgIGNsZWFyQWxsRmllbGRDYWNo\nZSgpOwogICAgICAgIGNhY2hlRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXNvbHZlIHN1cGVyY2xhc3MgZmllbGRzIHdlJ3ZlIHJlZGVmaW5l\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVEZWZpbmVkU3Vw\nZXJjbGFzc0ZpZWxkcygpIHsKICAgICAgICBfZGVmU3VwRmllbGRzID0gdHJ1\nZTsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBzdXA7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfc3VwRmllbGRNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0YURhdGEp\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHN1cCA9IGdldFN1cGVyY2xhc3NG\naWVsZChmbWQpOwoKICAgICAgICAgICAgLy8ganBhIG1ldGFkYXRhIGRvZXNu\nJ3QgcXVhbGlmeSBzdXBlcmNsYXNzIGZpZWxkIG5hbWVzLCBzbyB3ZQogICAg\nICAgICAgICAvLyBtaWdodCBub3Qga25vdyB0aGUgZGVjbGFyaW5nIHR5cGUg\ndW50aWwgbm93CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyaW5nVHlw\nZSgpID09IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICAgICAgZm1kLnNl\ndERlY2xhcmluZ1R5cGUoc3VwLmdldERlY2xhcmluZ1R5cGUoKSk7CiAgICAg\nICAgICAgICAgICBmbWQuYmFja2luZ01lbWJlcihnZXRSZXBvc2l0b3J5KCku\nZ2V0TWV0YURhdGFGYWN0b3J5KCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGVmYXVsdHMoKS5nZXRCYWNraW5nTWVtYmVyKGZtZCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGZtZC5jb3B5KHN1cCk7CiAgICAgICAgICAgIGZt\nZC5yZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgdGhlIGZpZWxkcyBk\nZWZpbmVkIGJ5IHRoaXMgY2xhc3MuCiAgICAgKiBUaGlzIGluY2x1ZGVzIG1h\ncHBlZCBkZWNsYXJlZCBmaWVsZHMgYW5kIGFueSBjb25jcmV0ZSBtYXBwaW5n\nIG9mCiAgICAgKiB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxkcyBwZXJmb3Jt\nZWQgYnkgdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGFbXSBnZXREZWZpbmVkRmllbGRzKCkgewogICAgICAgIGlmIChfZGVm\naW5lZEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgTGlzdCBk\nZWZpbmVkID0gbmV3IEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNNYXBwZWQoKQog\nICAgICAgICAgICAgICAgICAgICYmIGZpZWxkc1tpXS5nZXREZWZpbmluZ01l\ndGFEYXRhKCkgPT0gdGhpcykKICAgICAgICAgICAgICAgICAgICBkZWZpbmVk\nLmFkZChmaWVsZHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9k\nZWZpbmVkRmllbGRzID0gKEZpZWxkTWV0YURhdGFbXSkgZGVmaW5lZC50b0Fy\ncmF5CiAgICAgICAgICAgICAgICAoX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFB\ncnJheShkZWZpbmVkLnNpemUoKSkpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2RlZmluZWRGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIGFsbCBmaWVsZHMgaW4gdGhlIG9yZGVyIHRoZXkgYXJlIGxpc3RlZCBp\nbiB0aGUgbWV0YWRhdGEKICAgICAqIGZpbGUuIFVubGlzdGVkIGZpZWxkcyBh\ncmUgcGxhY2VkIGFmdGVyIGxpc3RlZCBvbmVzLgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YVtdIGdldEZpZWxkc0luTGlzdGluZ09yZGVyKCkg\newogICAgICAgIGlmIChfYWxsTGlzdGluZ0ZpZWxkcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIGNvbWJpbmUgZGVjbGFyZWQgYW5kIHVubWFuYWdlZCBm\naWVsZHMgaW50byBsaXN0aW5nIG9yZGVyIGFycmF5CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBkZWMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gdW5tZ2QgPSBnZXREZWNsYXJlZFVu\nbWFuYWdlZEZpZWxkcygpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZGVjTGlzdGluZyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAg\nICAgICAgICAgICAgIChkZWMubGVuZ3RoICsgdW5tZ2QubGVuZ3RoKTsKICAg\nICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWMsIDAsIGRlY0xpc3Rpbmcs\nIDAsIGRlYy5sZW5ndGgpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKHVubWdkLCAwLCBkZWNMaXN0aW5nLCBkZWMubGVuZ3RoLCB1bm1nZC5sZW5n\ndGgpOwogICAgICAgICAgICBBcnJheXMuc29ydChkZWNMaXN0aW5nLCBMaXN0\naW5nT3JkZXJDb21wYXJhdG9yLmdldEluc3RhbmNlKCkpOwoKICAgICAgICAg\nICAgaWYgKF9zdXBlciA9PSBudWxsKQogICAgICAgICAgICAgICAgX2FsbExp\nc3RpbmdGaWVsZHMgPSBkZWNMaXN0aW5nOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIC8vIHBsYWNlIHN1cGVyY2xhc3MgZmllbGRzIGlu\nIGxpc3Rpbmcgb3JkZXIgYmVmb3JlIG91cgogICAgICAgICAgICAgICAgLy8g\nbGlzdGluZy1vcmRlciBkZWNsYXJlZCBmaWVsZHMKICAgICAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpLgogICAgICAgICAgICAgICAgICAgIGdldEZpZWxkc0luTGlzdGluZ09y\nZGVyKCk7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gbGlzdGlu\nZyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAgICAgICAgICAg\nICAgICAgICAoc3VwLmxlbmd0aCArIGRlY0xpc3RpbmcubGVuZ3RoKTsKICAg\nICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoc3VwLCAwLCBsaXN0aW5n\nLCAwLCBzdXAubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJlcGxhY2VEZWZp\nbmVkU3VwZXJjbGFzc0ZpZWxkcyhsaXN0aW5nLCBzdXAubGVuZ3RoKTsKICAg\nICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoZGVjTGlzdGluZywgMCwg\nbGlzdGluZywgc3VwLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICBkZWNM\naXN0aW5nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBfYWxsTGlzdGluZ0Zp\nZWxkcyA9IGxpc3Rpbmc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9hbGxMaXN0aW5nRmllbGRzOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyBhbGwgZmllbGRzIGRlZmluZWQgYnkgdGhpcyBjbGFz\ncyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgbGlzdGVkCiAgICAgKiBpbiB0aGUg\nbWV0YWRhdGEgZmlsZS4gVW5saXN0ZWQgZmllbGRzIGFyZSBwbGFjZWQgYWZ0\nZXIgbGlzdGVkIG9uZXMuCiAgICAgKiBUaGlzIGFycmF5IGluY2x1ZGVzIGRl\nY2xhcmVkIHRyYW5zYWN0aW9uYWwgYW5kIHVubWFuYWdlZCBmaWVsZHMuCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVmaW5lZEZp\nZWxkc0luTGlzdGluZ09yZGVyKCkgewogICAgICAgIGlmIChfbGlzdGluZ0Zp\nZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\naWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgTGlzdCBkZWZpbmVk\nID0gbmV3IEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzW2ldLmdldERlZmluaW5nTWV0YURhdGEo\nKSA9PSB0aGlzKQogICAgICAgICAgICAgICAgICAgIGRlZmluZWQuYWRkKGZp\nZWxkc1tpXSk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9\nIGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBsaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURh\ndGFBcnJheQogICAgICAgICAgICAgICAgKGRlZmluZWQuc2l6ZSgpICsgdW5t\nZ2QubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBk\nZWZpbmVkLnNpemUoKTsgaSsrKQogICAgICAgICAgICAgICAgbGlzdGluZ1tp\nXSA9IChGaWVsZE1ldGFEYXRhKSBkZWZpbmVkLmdldChpKTsKICAgICAgICAg\nICAgU3lzdGVtLmFycmF5Y29weSh1bm1nZCwgMCwgbGlzdGluZywgZGVmaW5l\nZC5zaXplKCksIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5z\nb3J0KGxpc3RpbmcsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFu\nY2UoKSk7CiAgICAgICAgICAgIF9saXN0aW5nRmllbGRzID0gbGlzdGluZzsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9saXN0aW5nRmllbGRzOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGFjYWNoZSB0\nbyB1c2UgZm9yIHRoaXMgY2xhc3MsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXREYXRhQ2FjaGVOYW1lKCkgewogICAg\nICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2NhY2hlTmFtZSkpIHsK\nICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2NhY2hlTmFtZSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0\nRGF0YUNhY2hlTmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBfY2FjaGVOYW1lID0gRGF0YUNhY2hlLk5BTUVfREVGQVVMVDsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIF9jYWNoZU5hbWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hlIG5hbWUgZm9yIHRoaXMgY2xhc3Mu\nIFNldCB0byBudWxsIHRvIGRpc2FibGUgY2FjaGluZy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RGF0YUNhY2hlTmFtZShTdHJpbmcgbmFtZSkgewog\nICAgICAgIF9jYWNoZU5hbWUgPSBuYW1lOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIGNhY2hlIHRpbWVvdXQgZm9yIHRoaXMgY2xhc3MuIC0xIGluZGlj\nYXRlcyBubyB0aW1lb3V0LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldERh\ndGFDYWNoZVRpbWVvdXQoKSB7CiAgICAgICAgaWYgKF9jYWNoZVRpbWVvdXQg\nPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAgICAgaWYgKF9zdXBl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfY2FjaGVUaW1lb3V0ID0gX3JlcG9zLmdldENvbmZpZ3Vy\nYXRpb24oKS4KICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1l\nb3V0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2FjaGVUaW1lb3V0\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGNhY2hlIHRpbWVvdXQgZm9y\nIHRoaXMgY2xhc3MuIC0xIGluZGljYXRlcyBubyB0aW1lb3V0LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVUaW1lb3V0KGludCB0aW1l\nb3V0KSB7CiAgICAgICAgX2NhY2hlVGltZW91dCA9IHRpbWVvdXQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGEgY2FjaGUgZm9yIHRo\naXMgY2xhc3MsIG9yIG51bGwgaWYgaXQgaXMgbm90IGNhY2hhYmxlLgogICAg\nICovCiAgICBwdWJsaWMgRGF0YUNhY2hlIGdldERhdGFDYWNoZSgpIHsKICAg\nICAgICBTdHJpbmcgbmFtZSA9IGdldERhdGFDYWNoZU5hbWUoKTsKICAgICAg\nICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5nZXRE\nYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0RGF0\nYUNhY2hlKG5hbWUsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciBpbnN0YW5jZXMgYXJlIGRldGFjaGFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzRGV0YWNoYWJsZSgpIHsKICAgICAgICBpZiAoX2Rl\ndGFjaGFibGUgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZGV0YWNoYWJsZSA9IChnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpLmlzRGV0YWNoYWJsZSgpKQogICAgICAgICAg\nICAgICAgICAgID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2RldGFjaGFibGUgPSBC\nb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2RldGFj\naGFibGUuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RGV0YWNoYWJsZShib29sZWFuIGRldGFjaGFibGUp\nIHsKICAgICAgICBfZGV0YWNoYWJsZSA9IChkZXRhY2hhYmxlKSA/IEJvb2xl\nYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgbmFtZSBvZiB0aGUgZGV0YWNoIHN0YXRlIGZpZWxkLCBvciBudWxs\nIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RGV0YWNo\nZWRTdGF0ZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxz\nKF9kZXRhY2hTdGF0ZSkpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBp\nZiAoc3VwICE9IG51bGwgJiYgc3VwLmlzRGV0YWNoYWJsZSgpID09IGlzRGV0\nYWNoYWJsZSgpKQogICAgICAgICAgICAgICAgX2RldGFjaFN0YXRlID0gc3Vw\nLmdldERldGFjaGVkU3RhdGUoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBCb29sZWFuIHVzZSA9IHVzZXNEZXRhY2hlZFN0YXRlKFNZ\nTlRIRVRJQywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBfZGV0YWNoU3RhdGUg\nPSAoQm9vbGVhbi5GQUxTRS5lcXVhbHModXNlKSkgPyBudWxsIDogU1lOVEhF\nVElDOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nZGV0YWNoU3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBv\nZiB0aGUgZGV0YWNoIHN0YXRlIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaGVkU3RhdGUoU3RyaW5n\nIGZpZWxkKSB7CiAgICAgICAgX2RldGFjaFN0YXRlID0gZmllbGQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRldGFjaCBzdGF0ZSBmaWVs\nZCwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGQg\nZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCkgewogICAgICAgIC8vIG5vIGNhY2hp\nbmc7IG9ubHkgdXNlZCBhdCBlbmhhbmNlbWVudAogICAgICAgIFN0cmluZyBm\naWVsZE5hbWUgPSBnZXREZXRhY2hlZFN0YXRlKCk7CiAgICAgICAgaWYgKGZp\nZWxkTmFtZSA9PSBudWxsIHx8IFNZTlRIRVRJQy5lcXVhbHMoZmllbGROYW1l\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGZvciAoQ2xh\nc3MgdHlwZSA9IF90eXBlOyB0eXBlICE9IG51bGwgJiYgdHlwZSAhPSBPYmpl\nY3QuY2xhc3M7CiAgICAgICAgICAgIHR5cGUgPSB0eXBlLmdldFN1cGVyY2xh\nc3MoKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIHR5cGUuZ2V0RGVjbGFyZWRGaWVsZChmaWVsZE5hbWUpOwogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tZGV0YWNoLXN0YXRlIiwgZmllbGROYW1lLAogICAgICAg\nICAgICBfdHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBh\nbiBpbnN0YW5jZSBvZiB0aGlzIHR5cGUgaGFzIGRldGFjaGVkIHN0YXRlLgog\nICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhIGRldGFjaGVkIGluc3Rh\nbmNlIG11c3QgaGF2ZSBkZXRhY2hlZCBzdGF0ZSwgZmFsc2UKICAgICAqIGlm\nIGl0IGRvZXMgbm90LCBhbmQgbnVsbCBpZiBpdCBtYXkgdXNlIGEKICAgICAq\nIG1hbnVhbGx5LWNvbnN0cnVjdGVkIGluc3RhbmNlIHdpdGhvdXQgZGV0YWNo\nZWQgc3RhdGUKICAgICAqLwogICAgcHVibGljIEJvb2xlYW4gdXNlc0RldGFj\naGVkU3RhdGUoKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0byBsZXQgY29uZiBk\naXNhbGxvdyBiZWNhdXNlIGl0J3MgdGFrZW4gaW50byBhY2NvdW50IGluCiAg\nICAgICAgLy8gZ2V0RGV0YWNoZWRTdGF0ZSgpIGNhbGwKICAgICAgICByZXR1\ncm4gdXNlc0RldGFjaGVkU3RhdGUoZ2V0RGV0YWNoZWRTdGF0ZSgpLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGFuIGluc3RhbmNl\nIG9mIHRoaXMgdHlwZSBoYXMgZGV0YWNoZWQgc3RhdGUsIGFzc3VtaW5nIHRo\nZSBnaXZlbgogICAgICogZGV0YWNoZWQgc3RhdGUgZmllbGQuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIGEgZGV0YWNoZWQgaW5zdGFuY2UgbXVz\ndCBoYXZlIGRldGFjaGVkIHN0YXRlLCBmYWxzZQogICAgICogaWYgaXQgZG9l\ncyBub3QsIGFuZCBudWxsIGlmIGl0IG1heSB1c2UgYQogICAgICogbWFudWFs\nbHktY29uc3RydWN0ZWQgaW5zdGFuY2Ugd2l0aG91dCBkZXRhY2hlZCBzdGF0\nZQogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gdXNlc0RldGFjaGVkU3Rh\ndGUoU3RyaW5nIGRldGFjaGVkRmllbGQsCiAgICAgICAgYm9vbGVhbiBjb25m\nRGlzYWxsb3dzKSB7CiAgICAgICAgaWYgKCFpc0RldGFjaGFibGUoKSkKICAg\nICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAgIC8vIGlm\nIHdlIGRlY2xhcmUgYSBkZXRhY2hlZCBzdGF0ZSBmaWVsZCwgaGF2ZSB0byB1\nc2UgaXQKICAgICAgICBpZiAoZGV0YWNoZWRGaWVsZCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICBpZiAoIVNZ\nTlRIRVRJQy5lcXVhbHMoZGV0YWNoZWRGaWVsZCkpCiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLlRSVUU7CgogICAgICAgIC8vIGFsbG93IGNvbmYgdG8g\nZGlzYWxsb3cKICAgICAgICBpZiAoY29uZkRpc2FsbG93cyAmJiAhX3JlcG9z\nLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGV0YWNoU3Rh\ndGVJbnN0YW5jZSgpLmdldERldGFjaGVkU3RhdGVGaWVsZCgpKQogICAgICAg\nICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgLy8gaGF2ZSB0\nbyB1c2UgZGV0YWNoZWQgc3RhdGUgdG8gc3RvcmUgZGF0YXN0b3JlIGlkCiAg\nICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgpID09IElEX0RBVEFTVE9SRSkK\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKCiAgICAgICAgLy8g\nYWxsb3cgZGV0YWNoZWQgc3RhdGUgdXNlLCBidXQgZG9uJ3QgcmVxdWlyZQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xl\nYXIgY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGNsZWFyQWxsRmllbGRDYWNoZSgpIHsKICAgICAgICBfYWxsRmllbGRz\nID0gbnVsbDsKICAgICAgICBfYWxsREZHRmllbGRzID0gbnVsbDsKICAgICAg\nICBfYWxsUEtGaWVsZHMgPSBudWxsOwogICAgICAgIF9kZWZpbmVkRmllbGRz\nID0gbnVsbDsKICAgICAgICBfbGlzdGluZ0ZpZWxkcyA9IG51bGw7CiAgICAg\nICAgX2FsbExpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgICAgIF9maWVsZERh\ndGFUYWJsZSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBk\nZWZpbmVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIGNsZWFyRGVmaW5lZEZpZWxkQ2FjaGUoKSB7CiAgICAgICAgX2RlZmluZWRG\naWVsZHMgPSBudWxsOwogICAgICAgIF9saXN0aW5nRmllbGRzID0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlZCBmaWVsZCBkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckZpZWxkQ2FjaGUo\nKSB7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX2Zp\nZWxkcyA9IG51bGw7CiAgICAgICAgX3VubWdkRmllbGRzID0gbnVsbDsKICAg\nICAgICBfdmVyc2lvbklkeCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAgfQoK\nICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVkIHN1YmNsYXNzIGRhdGEuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyU3ViY2xhc3NDYWNoZSgp\nIHsKICAgICAgICBfc3VicyA9IG51bGw7CiAgICAgICAgX3N1Yk1ldGFzID0g\nbnVsbDsKICAgICAgICBfbWFwU3ViTWV0YXMgPSBudWxsOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgaW1wbCBkYXRhIGFuZCBpbnRlcm1lZGlhdGUg\nZGF0YSB0YWJsZS4KICAgICAqLwogICAgdm9pZCBjbGVhckV4dHJhRmllbGRE\nYXRhVGFibGUoKSB7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENhY2hlIGZpZWxkIGFycmF5cy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRmllbGRzKCkgewogICAgICAg\nIGdldEZpZWxkcygpOwogICAgICAgIGdldFByaW1hcnlLZXlGaWVsZHMoKTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgIHJl\ndHVybiBfdHlwZS5nZXROYW1lKCkuaGFzaENvZGUoKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAg\naWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgQ2xhc3NNZXRhRGF0YSkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX3R5\ncGUgPT0gKChDbGFzc01ldGFEYXRhKSBvdGhlcikuZ2V0RGVzY3JpYmVkVHlw\nZSgpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgY29tcGFyZVRvKE9iamVjdCBv\ndGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAg\nICByZXR1cm4gMDsKICAgICAgICByZXR1cm4gX3R5cGUuZ2V0TmFtZSgpLmNv\nbXBhcmVUbygoKENsYXNzTWV0YURhdGEpIG90aGVyKS4KICAgICAgICAgICAg\nZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSk7CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gZ2V0RGVz\nY3JpYmVkVHlwZSgpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlc29sdmUgYW5kIHZhbGlkYXRlCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFRo\nZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMgbWV0YWRhdGEuCiAgICAgKi8KICAg\nIHB1YmxpYyBpbnQgZ2V0UmVzb2x2ZSgpIHsKICAgICAgICByZXR1cm4gX3Jl\nc01vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcmVzb2x2ZSBtb2Rl\nIGZvciB0aGlzIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRSZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgX3Jlc01vZGUgPSBtb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUgbW9kZSBmb3Ig\ndGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVz\nb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2Rl\nID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX3Jlc01vZGUgPSBtb2RlOwog\nICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfcmVzTW9kZSB8PSBt\nb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3Jlc01vZGUgJj0gfm1v\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIGFuZCB2YWxpZGF0\nZSBtZXRhZGF0YS4gUmV0dXJuIHRydWUgaWYgYWxyZWFkeSByZXNvbHZlZC4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVzb2x2ZShpbnQgbW9kZSkg\newogICAgICAgIGlmICgoX3Jlc01vZGUgJiBtb2RlKSA9PSBtb2RlKQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpbnQgY3VyID0gX3Jlc01v\nZGU7CiAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKCiAgICAgICAgaW50IHZh\nbCA9IF9yZXBvcy5nZXRWYWxpZGF0ZSgpOwogICAgICAgIGJvb2xlYW4gcnVu\ndGltZSA9ICh2YWwgJiBfcmVwb3MuVkFMSURBVEVfUlVOVElNRSkgIT0gMDsK\nICAgICAgICBib29sZWFuIHZhbGlkYXRlID0gIVBlcnNpc3RlbmNlQ2FwYWJs\nZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF90eXBlKQogICAgICAgICAgICB8\nfCAodmFsICYgTWV0YURhdGFSZXBvc2l0b3J5LlZBTElEQVRFX1VORU5IQU5D\nRUQpID09IDA7CgogICAgICAgIC8vIHdlIG9ubHkgZG8gYW55IGFjdGlvbnMg\nZm9yIG1ldGFkYXRhIG1vZGUKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01F\nVEEpICE9IDAgJiYgKGN1ciAmIE1PREVfTUVUQSkgPT0gMCkgewogICAgICAg\nICAgICByZXNvbHZlTWV0YShydW50aW1lKTsKICAgICAgICAgICAgaWYgKHZh\nbGlkYXRlICYmICh2YWwgJiBfcmVwb3MuVkFMSURBVEVfTUVUQSkgIT0gMCkK\nICAgICAgICAgICAgICAgIHZhbGlkYXRlTWV0YShydW50aW1lKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwICYm\nIChjdXIgJiBNT0RFX01BUFBJTkcpID09IDApIHsKICAgICAgICAgICAgcmVz\nb2x2ZU1hcHBpbmcocnVudGltZSk7CiAgICAgICAgICAgIGlmICh2YWxpZGF0\nZSAmJiAodmFsICYgX3JlcG9zLlZBTElEQVRFX01BUFBJTkcpICE9IDApCiAg\nICAgICAgICAgICAgICB2YWxpZGF0ZU1hcHBpbmcocnVudGltZSk7CiAgICAg\nICAgfQogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAh\nPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkdfSU5JVCkgPT0gMCkKICAgICAg\nICAgICAgaW5pdGlhbGl6ZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWV0YShib29sZWFu\nIHJ1bnRpbWUpIHsKICAgICAgICBib29sZWFuIGVtYmVkID0gX293bmVyICE9\nIG51bGwgJiYgX293bmVyLmdldERlY2xhcmVkVHlwZSgpID09IF90eXBlOwog\nICAgICAgIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uo\nX2xvYy5nZXQoKGVtYmVkKSA/ICJyZXNvbHZlLWVtYmVkLW1ldGEiIDogInJl\nc29sdmUtbWV0YSIsCiAgICAgICAgICAgICAgICB0aGlzICsgIkAiICsgU3lz\ndGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpKTsKCiAgICAgICAgaWYgKHJ1\nbnRpbWUgJiYgIV90eXBlLmlzSW50ZXJmYWNlKCkgJiYgCiAgICAgICAgICAg\nICFQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShf\ndHlwZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm90LWVuaGFuY2VkIiwgX3R5cGUpKTsKCiAgICAgICAg\nLy8gYXJlIHdlIHRoZSB0YXJnZXQgb2YgYW4gZW1iZWRkZWQgdmFsdWU/CiAg\nICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgIGlmIChfb3duZXIuZ2V0\nRmllbGRNZXRhRGF0YSgpLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAgICAg\nICAgICAgICAgIGdldERlc2NyaWJlZFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9t\nKF90eXBlKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgicmVjdXJzZS1lbWJlZCIsIF9vd25lcikpOwoK\nICAgICAgICAgICAgLy8gY29weSBpbmZvIGZyb20gdGhlICJyZWFsIiBtZXRh\nZGF0YSBmb3IgdGhpcyB0eXBlCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YShfdHlwZSwgX2xvYWRlciwgdHJ1\nZSk7CiAgICAgICAgICAgIG1ldGEucmVzb2x2ZShNT0RFX01FVEEpOwogICAg\nICAgICAgICBjb3B5KHRoaXMsIG1ldGEpOwogICAgICAgICAgICBfZW1iZWRk\nZWQgPSBCb29sZWFuLkZBTFNFOyAvLyBlbWJlZGRlZCBpbnN0YW5jZSBpc24n\ndCBlbWJlZGRlZC1vbmx5CiAgICAgICAgfQoKICAgICAgICAvLyBtYWtlIHN1\ncmUgc3VwZXJjbGFzcyBpcyByZXNvbHZlZAogICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBp\nZiAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgc3VwLnJlc29sdmUoTU9E\nRV9NRVRBKTsKICAgICAgICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAg\nICAgICAvLyBlbWJlZGRlZCBpbnN0YW5jZSBhbHdheXMgcmVkZWZpbmUgYWxs\nIHN1cGVyY2xhc3MgZmllbGRzCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gc3VwcyA9IHN1cC5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbAogICAg\nICAgICAgICAgICAgICAgICAgICB8fCAhX3N1cEZpZWxkTWFwLmNvbnRhaW5z\nS2V5KHN1cHNbaV0uZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBhZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1\ncHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIHJlc29sdmUgZmllbGRzIGFuZCByZW1vdmUgaW52YWxp\nZHMKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IF9maWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAvLyBvbmx5IHBhc3Mgb24g\nbWV0YWRhdGEgcmVzb2x2ZSBtb2RlIHNvIHRoYXQgbWV0YWRhdGEgaXMgYWx3\nYXlzCiAgICAgICAgICAgIC8vIHJlc29sdmVkIGJlZm9yZSBhbnkgb3RoZXIg\ncmVzb2x2ZSBtb2RlcyBvdXIgc3ViY2xhc3NlcyBwYXNzIGFsb25nCiAgICAg\nICAgICAgIGZtZCA9IChGaWVsZE1ldGFEYXRhKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01FVEEpOwoKICAgICAgICAgICAg\naWYgKCFmbWQuaXNFeHBsaWNpdCgpCiAgICAgICAgICAgICAgICAmJiAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0JKRUNUCiAg\nICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQ19VTlRZUEVECiAgICAgICAgICAgICAgICB8fCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkKICAg\nICAgICAgICAgICAgICYmIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpCiAgICAgICAgICAgICAgICA9PSBKYXZhVHlwZXMuT0JKRUNU\nKSkpIHsKICAgICAgICAgICAgICAgIF9yZXBvcy5nZXRMb2coKS53YXJuKF9s\nb2MuZ2V0KCJybS1maWVsZCIsIGZtZCkpOwogICAgICAgICAgICAgICAgaWYg\nKGZtZC5nZXRMaXN0aW5nSW5kZXgoKSAhPSAtMSkKICAgICAgICAgICAgICAg\nICAgICBmbWQuc2V0TWFuYWdlbWVudChmbWQuTUFOQUdFX05PTkUpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGl0ci5yZW1v\ndmUoKTsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRDYWNoZSgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBlbWJlZGRlZCBpbnN0\nYW5jZXMgbXVzdCBlbWJlZCBhbGwgc3VwZXJjbGFzcyBmaWVsZHMgdG9vCiAg\nICAgICAgaWYgKGVtYmVkKSB7CiAgICAgICAgICAgIGNsZWFyQWxsRmllbGRD\nYWNoZSgpOwogICAgICAgICAgICByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NG\naWVsZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIHRoaXMgZW5zdXJlcyB0\naGF0IGFsbCBmaWVsZCBpbmRleGVzIGdldCBzZXQgd2hlbiBmaWVsZHMgYXJl\nIGNhY2hlZAogICAgICAgIGNhY2hlRmllbGRzKCk7CgogICAgICAgIC8vIHJl\nc29sdmUgbGlmZWN5Y2xlIG1ldGFkYXRhIG5vdyB0byBwcmV2ZW50IGxhenkg\ndGhyZWFkaW5nIHByb2JsZW1zCiAgICAgICAgX2xpZmVNZXRhLnJlc29sdmUo\nKTsKCiAgICAgICAgLy8gcmVjb3JkIGltcGxlbWVudHMgaW4gdGhlIHJlcG9z\naXRvcnkKICAgICAgICBpZiAoX2ludGVyZmFjZXMgIT0gbnVsbCkgewogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ID0gX2ludGVyZmFjZXMuaXRlcmF0\nb3IoKTsgaXQuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIF9yZXBvcy5h\nZGREZWNsYXJlZEludGVyZmFjZUltcGwodGhpcywgKENsYXNzKSBpdC5uZXh0\nKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2ZSBmZXRjaCBncm91\ncHMKICAgICAgICBpZiAoX2ZnTWFwICE9IG51bGwpCiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gX2ZnTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgKChGZXRjaEdyb3Vw\nKSBpdHIubmV4dCgpKS5yZXNvbHZlKCk7CgogICAgICAgIGlmICghZW1iZWQg\nJiYgX3R5cGUuaXNJbnRlcmZhY2UoKSkgewogICAgICAgICAgICBpZiAoX2lu\ndGVyZmFjZSAhPSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludGVyZmFjZSIs\nIF90eXBlKSk7CgogICAgICAgICAgICBpZiAocnVudGltZSkgewogICAgICAg\nICAgICAgICAgX2ltcGwgPSBfcmVwb3MuZ2V0SW1wbEdlbmVyYXRvcigpLmNy\nZWF0ZUltcGwodGhpcyk7CiAgICAgICAgICAgICAgICBfcmVwb3Muc2V0SW50\nZXJmYWNlSW1wbCh0aGlzLCBfaW1wbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgcnVudGltZSwgY3JlYXRlIGEg\ncGMgaW5zdGFuY2UgYW5kIHNjYW4gaXQgZm9yIGNvbXBhcmF0b3JzCiAgICAg\nICAgaWYgKHJ1bnRpbWUgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3QoX3R5cGUu\nZ2V0TW9kaWZpZXJzKCkpKSB7CiAgICAgICAgICAgIFByb3h5U2V0dXBTdGF0\nZU1hbmFnZXIgc20gPSBuZXcgUHJveHlTZXR1cFN0YXRlTWFuYWdlcigpOwog\nICAgICAgICAgICBzbS5zZXRQcm94eURhdGEoUENSZWdpc3RyeS5uZXdJbnN0\nYW5jZShfdHlwZSwgc20sIGZhbHNlKSwgdGhpcyk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgcmVzb2x2ZWQgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHZhbGlkYXRlTWV0YShib29s\nZWFuIHJ1bnRpbWUpIHsKICAgICAgICB2YWxpZGF0ZURhdGFDYWNoZSgpOwog\nICAgICAgIHZhbGlkYXRlRGV0YWNoYWJsZSgpOwogICAgICAgIHZhbGlkYXRl\nRXh0ZW5zaW9uS2V5cygpOwogICAgICAgIHZhbGlkYXRlSWRlbnRpdHkocnVu\ndGltZSk7CiAgICAgICAgdmFsaWRhdGVBY2Nlc3NUeXBlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXNvbHZlIG1hcHBpbmcgZGF0YS4gTG9ncyByZXNv\nbHZlIG1lc3NhZ2UgYW5kIHJlc29sdmVzIHN1cGVyIGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlc29sdmVNYXBwaW5nKGJvb2xl\nYW4gcnVudGltZSkgewogICAgICAgIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9n\nKCk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBsb2cudHJhY2UoX2xvYy5nZXQoInJlc29sdmUtbWFwcGluZyIsIHRo\naXMgKyAiQCIKICAgICAgICAgICAgICAgICsgU3lzdGVtLmlkZW50aXR5SGFz\naENvZGUodGhpcykpKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHN1cGVyY2xh\nc3MgaXMgcmVzb2x2ZWQgZmlyc3QKICAgICAgICBDbGFzc01ldGFEYXRhIHN1\ncCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1\ncCAhPSBudWxsKQogICAgICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01BUFBJ\nTkcpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgbWFwcGluZyBk\nYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCB2YWxpZGF0ZU1hcHBp\nbmcoYm9vbGVhbiBydW50aW1lKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nbml0aWFsaXplIG1hcHBpbmcuIExvZ3MgaW5pdCBtZXNzYWdlIGJ5IGRlZmF1\nbHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGluaXRpYWxpemVNYXBw\naW5nKCkgewogICAgICAgIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9nKCk7CiAg\nICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBs\nb2cudHJhY2UoX2xvYy5nZXQoImluaXQtbWFwcGluZyIsIHRoaXMgKyAiQCIK\nICAgICAgICAgICAgICAgICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhp\ncykpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIGRhdGEgY2Fj\naGUgc2V0dGluZ3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0\nZURhdGFDYWNoZSgpIHsKICAgICAgICBpbnQgdGltZW91dCA9IGdldERhdGFD\nYWNoZVRpbWVvdXQoKTsKICAgICAgICBpZiAodGltZW91dCA8IC0xIHx8IHRp\nbWVvdXQgPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJjYWNoZS10aW1lb3V0LWludmFsaWQiLAogICAg\nICAgICAgICAgICAgX3R5cGUsIFN0cmluZy52YWx1ZU9mKHRpbWVvdXQpKSk7\nCgogICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIFN0cmluZyBjYWNoZSA9IGdldERhdGFDYWNoZU5hbWUo\nKTsKICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBTdHJpbmcgc3VwZXJDYWNoZSA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuZXF1YWxzKGNhY2hlLCBzdXBlckNhY2hlKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJjYWNoZS1uYW1lcyIsIG5ldyBPYmplY3RbXQogICAgICAgICAgICAgICAg\neyBfdHlwZSwgY2FjaGUsIF9zdXBlciwgc3VwZXJDYWNoZSB9KSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgaWRlbnRpdHkgaGFu\nZGxpbmcgZm9yIHRoaXMgY2xhc3MgaXMgdmFsaWQuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCB2YWxpZGF0ZUlkZW50aXR5KGJvb2xlYW4gcnVudGltZSkg\newogICAgICAgIC8vIG1ha2Ugc3VyZSBpZGVudGl0eSB0eXBlcyBhcmUgY29u\nc2lzdGVudAogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpbnQgaWQgPSBnZXRJZGVudGl0\neVR5cGUoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElk\nZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04KICAgICAgICAgICAgJiYgc3Vw\nLmdldElkZW50aXR5VHlwZSgpICE9IGlkKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImlkLXR5cGVzIiwgX3R5\ncGUpKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIHRoaW5ncyB0aGUgZGF0YSBz\ndG9yZSBkb2Vzbid0IHN1cHBvcnQKICAgICAgICBDb2xsZWN0aW9uIG9wdHMg\nPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRlZE9wdGlvbnMo\nKTsKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04KICAgICAgICAg\nICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BU\nSU9OX0lEX0FQUExJQ0FUSU9OKSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImFwcGlkLW5vdC1zdXBw\nb3J0ZWQiLAogICAgICAgICAgICAgICAgX3R5cGUpKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKGlkID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAmJiAh\nb3B0cy5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fSURf\nREFUQVNUT1JFKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgiZGF0YXN0\nb3JlaWQtbm90LXN1cHBvcnRlZCIsIF90eXBlKSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAg\naWYgKF9pZFN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJhcHBpZC1zdHJhdGVneSIsIF90eXBlKSk7CiAgICAgICAgICAgIHZh\nbGlkYXRlQXBwSWRDbGFzcyhydW50aW1lKTsKICAgICAgICB9IGVsc2UgaWYg\nKGlkICE9IElEX1VOS05PV04pCiAgICAgICAgICAgIHZhbGlkYXRlTm9QS0Zp\nZWxkcygpOwoKICAgICAgICBpbnQgc3RyYXRlZ3kgPSBnZXRJZGVudGl0eVN0\ncmF0ZWd5KCk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09IFZhbHVlU3RyYXRl\nZ2llcy5TRVFVRU5DRQogICAgICAgICAgICAmJiBnZXRJZGVudGl0eVNlcXVl\nbmNlTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCBfdHlwZSkp\nOwoKICAgICAgICBWYWx1ZVN0cmF0ZWdpZXMuYXNzZXJ0U3VwcG9ydGVkKHN0\ncmF0ZWd5LCB0aGlzLAogICAgICAgICAgICAiZGF0YXN0b3JlIGlkZW50aXR5\nIHN0cmF0ZWd5Iik7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUg\ndGhlIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIGlzIHZhbGlkLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzKGJvb2xl\nYW4gcnVudGltZSkgewogICAgICAgIC8vIGJhc2UgdHlwZXMgbXVzdCBkZWNs\nYXJlIGFuIG9pZCBjbGFzcyBpZiBub3Qgc2luZ2xlLWZpZWxkIGlkZW50aXR5\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGdldFByaW1hcnlLZXlG\naWVsZHMoKTsKICAgICAgICBpZiAoZ2V0T2JqZWN0SWRUeXBlKCkgPT0gbnVs\nbCkgewogICAgICAgICAgICBpZiAocGtzLmxlbmd0aCA9PSAxKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ1bnN1cHBvcnRlZC1pZC10eXBlIiwKICAgICAgICAgICAgICAgICAgICBf\ndHlwZSwgcGtzWzBdLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBw\na3NbMF0uZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8t\naWQtY2xhc3MiLCBfdHlwZSkpOwogICAgICAgIH0KICAgICAgICBpZiAoX29i\namVjdElkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naWYgKGlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKHBr\nc1swXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkg\newogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrc1sw\nXS5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICB2YWxp\nZGF0ZUFwcElkQ2xhc3NNZXRob2RzKGVtYmVkLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NQS3MoZW1i\nZWQsIGVtYmVkLmdldEZpZWxkcygpLAogICAgICAgICAgICAgICAgICAgIGVt\nYmVkLmdldERlc2NyaWJlZFR5cGUoKSwgcnVudGltZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKF9zdXBlciAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNvbmNyZXRlIHN1\ncGVyY2xhc3Mgb2lkcyBtdXN0IG1hdGNoIG9yIGJlIHBhcmVudCBvZiBvdXJz\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKCFzdXAuZ2V0T2JqZWN0\nSWRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShfb2JqZWN0SWQpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpZC1jbGFzc2VzIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IF90eXBlLCBfb2JqZWN0SWQsIF9zdXBlciwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3VwLmdldE9iamVjdElkVHlwZSgpIH0pKTsKCiAgICAgICAg\nICAgIC8vIHZhbGlkYXRlIHRoYXQgbm8gb3RoZXIgcGtzIGFyZSBkZWNsYXJl\nZCBpZiB3ZSBoYXZlIGEKICAgICAgICAgICAgLy8gY29uY3JldGUgUEMgc3Vw\nZXJjbGFzcwogICAgICAgICAgICBpZiAoaGFzQ29uY3JldGVQQ1N1cGVyY2xh\nc3MoKSkKICAgICAgICAgICAgICAgIHZhbGlkYXRlTm9QS0ZpZWxkcygpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBjbGFzcyBoYXMgaXRzIG93\nbiBvaWQgY2xhc3MsIGRvIHNvbWUgbW9yZSB2YWxpZGF0aW9uCiAgICAgICAg\naWYgKF9zdXBlciA9PSBudWxsCiAgICAgICAgICAgIHx8IF9vYmplY3RJZCAh\nPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldE9iamVjdElkVHlwZSgp\nKSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub24tYWJzdHJhY3Qgb2lk\nIGNsYXNzZXMgb3ZlcnJpZGUgdGhlIHByb3BlciBtZXRob2RzCiAgICAgICAg\nICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChfb2JqZWN0SWQuZ2V0TW9k\naWZpZXJzKCkpKQogICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNz\nTWV0aG9kcyhfb2JqZWN0SWQpOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIHRoZSBhcHAgaWQgY2xhc3MgaGFzIGFsbCBwayBmaWVsZHMKICAgICAgICAg\nICAgdmFsaWRhdGVBcHBJZENsYXNzUEtzKHRoaXMsIHBrcywgX29iamVjdElk\nLCBydW50aW1lKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiB0aGlzIGNsYXNzIGhhcyBhIGNvbmNyZXRlIHBlcnNp\nc3RlbnQgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkgewogICAgICAgIGlmIChfc3Vw\nZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChfc3VwZXIuZ2V0TW9kaWZpZXJz\nKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5oYXNDb25jcmV0ZVBDU3VwZXJj\nbGFzcygpOwogICAgfQoKICAgIC8qKgogICAgICogRW5zdXJlIHRoYXQgdGhl\nIHVzZXIgaGFzIG92ZXJyaWRkZW4gdGhlIGVxdWFscyBhbmQgaGFzaENvZGUg\nbWV0aG9kcywKICAgICAqIGFuZCBoYXMgdGhlIHByb3BlciBjb25zdHJ1Y3Rv\ncnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xh\nc3NNZXRob2RzKENsYXNzIG9pZCkgewogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIG9pZC5nZXRDb25zdHJ1Y3RvcigoQ2xhc3NbXSkgbnVsbCk7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWNvbnMiLCBf\ndHlwZSkpLgogICAgICAgICAgICAgICAgc2V0Q2F1c2UoZSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBjaGVjayBmb3IgZXF1YWxzIGFuZCBoYXNoY29kZSBv\ndmVycmlkZXM7IGRvbid0IGVuZm9yY2UgaXQKICAgICAgICAvLyBmb3IgYWJz\ndHJhY3QgYXBwIGlkIGNsYXNzZXMsIHNpbmNlIHRoZXkgbWF5IG5vdCBuZWNl\nc3NhcmlseQogICAgICAgIC8vIGRlY2xhcmUgcHJpbWFyeSBrZXkgZmllbGRz\nCiAgICAgICAgTWV0aG9kIG1ldGhvZDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBtZXRob2QgPSBvaWQuZ2V0TWV0aG9kKCJlcXVhbHMiLCBuZXcgQ2xh\nc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgYm9v\nbGVhbiBhYnMgPSBNb2RpZmllci5pc0Fic3RyYWN0KF90eXBlLmdldE1vZGlm\naWVycygpKTsKICAgICAgICBpZiAoIWFicyAmJiBtZXRob2QuZ2V0RGVjbGFy\naW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZXEtbWV0aG9kIiwg\nX3R5cGUpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9kID0g\nb2lkLmdldE1ldGhvZCgiaGFzaENvZGUiLCAoQ2xhc3NbXSkgbnVsbCk7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSkuc2V0RmF0YWwodHJ1ZSk7CiAg\nICAgICAgfQogICAgICAgIGlmICghYWJzICYmIG1ldGhvZC5nZXREZWNsYXJp\nbmdDbGFzcygpID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJoYy1tZXRob2QiLCBf\ndHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0\naGUgcHJpbWFyeSBrZXkgY2xhc3MgaGFzIGFsbCBwayBmaWVsZHMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xhc3NQS3MoQ2xh\nc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nLCBDbGFzcyBvaWQsIGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIGlmIChm\nbWRzLmxlbmd0aCA9PSAwICYmICFNb2RpZmllci5pc0Fic3RyYWN0KG1ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLgogICAgICAgICAgICBnZXRNb2RpZmllcnMo\nKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tcGsiLCBfdHlwZSkpOwoKICAgICAgICAvLyBjaGVjayB0\naGF0IHRoZSBvaWQgdHlwZSBjb250YWlucyBhbGwgcGsgZmllbGRzCiAgICAg\nICAgRmllbGQgZjsKICAgICAgICBNZXRob2QgbTsKICAgICAgICBDbGFzcyBj\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGUoKS5nZXRDb21wb25lbnRUeXBlKCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGMgPT0gYnl0ZS5jbGFzcyB8fCBjID09IEJ5dGUuY2xhc3MK\nICAgICAgICAgICAgICAgICAgICAgICAgfHwgYyA9PSBjaGFyLmNsYXNzIHx8\nIGMgPT0gQ2hhcmFjdGVyLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGMgPSBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgLy8gZWxzZSBubyBicmVhawogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5PSUQ6IC8vIHdlJ3JlIHZhbGlkYXRpbmcgZW1iZWRkZWQgZmll\nbGRzCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGstdHlwZSIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtZHNbaV0pKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0T2JqZWN0SWRG\naWVsZFR5cGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1l\ndGEuZ2V0QWNjZXNzVHlwZSgpID09IEFDQ0VTU19GSUVMRCkgewogICAgICAg\nICAgICAgICAgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZCwgZm1kc1tp\nXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChmID09\nIG51bGwgfHwgIWYuZ2V0VHlwZSgpLmlzQXNzaWduYWJsZUZyb20oYykpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQUNDRVNTX1BST1BF\nUlRZKSB7CiAgICAgICAgICAgICAgICBtID0gUmVmbGVjdGlvbi5maW5kR2V0\ndGVyKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGlmIChtID09IG51bGwgfHwgIW0uZ2V0UmV0dXJuVHlwZSgpLmlz\nQXNzaWduYWJsZUZyb20oYykpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFt\nZSgpKSk7CiAgICAgICAgICAgICAgICBtID0gUmVmbGVjdGlvbi5maW5kU2V0\ndGVyKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgaWYgKG0gPT0gbnVsbCB8fCBtLmdldFJldHVyblR5cGUoKSAh\nPSB2b2lkLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVmFsaWRhdGUgdGhhdCB0aGlzIGNsYXNzIGRvZXNuJ3QgZGVjbGFyZSBh\nbnkgcHJpbWFyeSBrZXkgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgdmFsaWRhdGVOb1BLRmllbGRzKCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtcGsiLCBmaWVsZHNbaV0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFz\nc2VydCB0aGF0IHRoaXMgY2xhc3MnIGFjY2VzcyB0eXBlIGlzIGFsbG93ZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFjY2Vzc1R5cGUo\nKSB7CiAgICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFDQ0VTU19VTktOT1dO\nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChz\ndXAgIT0gbnVsbCAmJiBzdXAuZ2V0QWNjZXNzVHlwZSgpICE9IEFDQ0VTU19V\nTktOT1dOCiAgICAgICAgICAgICYmIHN1cC5nZXRBY2Nlc3NUeXBlKCkgIT0g\nX2FjY2Vzc1R5cGUgJiYKICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKS5nZXRGaWVsZHMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW5jb25z\naXN0ZW50LWFjY2VzcyIsCiAgICAgICAgICAgICAgICB0aGlzLCBzdXApKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCBk\nZXRhY2htZW50IGNvbmZpZ3VyYXRpb24gaXMgdmFsaWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCB2YWxpZGF0ZURldGFjaGFibGUoKSB7CiAgICAgICAg\nYm9vbGVhbiBmaXJzdCA9IHRydWU7CiAgICAgICAgZm9yIChDbGFzc01ldGFE\nYXRhIHBhcmVudCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgICAgIGZpcnN0ICYmIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJl\nbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICB7CiAgICAg\nICAgICAgIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAg\nICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRmllbGQg\nZmllbGQgPSBnZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAgICBpZiAo\nZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWZpcnN0KQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJwYXJlbnQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAgICAg\nICBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZ2V0RmllbGQoZmllbGQuZ2V0\nTmFtZSgpKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYW5hZ2VkLWRldGFjaC1zdGF0\nZSIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlw\nZSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZSgpICE9IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaC1zdGF0ZSIsCiAgICAgICAg\nICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlwZSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZldGNoIEdy\nb3VwCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZmV0Y2ggZ3JvdXBzIGRlY2xhcmVkIGV4cGxpY2l0bHkgaW4gdGhp\ncyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldERl\nY2xhcmVkRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9mZ3MgPT0gbnVs\nbCkKICAgICAgICAgICAgX2ZncyA9IChfZmdNYXAgPT0gbnVsbCkgPyBuZXcg\nRmV0Y2hHcm91cFswXSA6IChGZXRjaEdyb3VwW10pCiAgICAgICAgICAgICAg\nICBfZmdNYXAudmFsdWVzKCkudG9BcnJheShuZXcgRmV0Y2hHcm91cFtfZmdN\nYXAuc2l6ZSgpXSk7IAogICAgICAgIHJldHVybiBfZmdzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGFsbCBmZXRjaCBncm91cHMgZm9yIHRoaXMg\ndHlwZSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZ3JvdXBzLgogICAgICovCiAg\nICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldEN1c3RvbUZldGNoR3JvdXBzKCkg\newogICAgICAgIGlmIChfY3VzdG9tRkdzID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gbWFwIGZncyB0byBuYW1lcywgYWxsb3dpbmcgb3VyIGZncyB0byBv\ndmVycmlkZSBzdXBlcnMKICAgICAgICAgICAgTWFwIGZncyA9IG5ldyBIYXNo\nTWFwKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBGZXRjaEdyb3Vw\nW10gc3VwRkdzID0gc3VwLmdldEN1c3RvbUZldGNoR3JvdXBzKCk7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1cEZHcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgICAgICBmZ3MucHV0KHN1cEZHc1tpXS5n\nZXROYW1lKCksIHN1cEZHc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgRmV0Y2hHcm91cFtdIGRlY3MgPSBnZXREZWNsYXJlZEZldGNoR3JvdXBz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVjcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZncy5wdXQoZGVjc1tpXS5nZXRO\nYW1lKCksIGRlY3NbaV0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g\ncmVtb3ZlIHN0ZCBncm91cHMKICAgICAgICAgICAgZmdzLnJlbW92ZShGZXRj\naEdyb3VwLk5BTUVfREVGQVVMVCk7CiAgICAgICAgICAgIGZncy5yZW1vdmUo\nRmV0Y2hHcm91cC5OQU1FX0FMTCk7CgogICAgICAgICAgICBfY3VzdG9tRkdz\nID0gKEZldGNoR3JvdXBbXSkgZmdzLnZhbHVlcygpLnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChuZXcgRmV0Y2hHcm91cFtmZ3Muc2l6ZSgpXSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfY3VzdG9tRkdzOwogICAgfQoKICAgIC8q\nKgogICAgICogR2V0cyBhIG5hbWVkIGZlY3RoIGdyb3VwLiBJZiBub3QgYXZh\naWxhYmxlIGluIHRoaXMgcmVjZWl2ZXIgdGhlbiBsb29rcwogICAgICogdXAg\ndGhlIGluaGVyaXRlbmNlIGhpZXJhcmNoeS4gCiAgICAgKgogICAgICogQHBh\ncmFtIG5hbWUgbmFtZSBvZiBhIGZldGNoIGdyb3VwLgogICAgICogQHJldHVy\nbiBhbiBleGlzdGluZyBmZWN0aCBncm91cCBvZiB0aGUgZ2l2ZW4gbmFtZSBp\nZiBrbm93biB0byB0aGlzIAogICAgICogcmVjZWl2ZXIgb3IgYW55IG9mIGl0\ncyBzdXBlcmNsYXNzZXMuIE90aGVyd2lzZSBudWxsLgogICAgICovCiAgICBw\ndWJsaWMgRmV0Y2hHcm91cCBnZXRGZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IChfZmdNYXAgPT0gbnVsbCkgPyBu\ndWxsIDogKEZldGNoR3JvdXApIF9mZ01hcC5nZXQobmFtZSk7CiAgICAgICAg\naWYgKGZnICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmZzsKICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gc3VwLmdldEZldGNoR3JvdXAobmFtZSk7CiAgICAgICAgaWYgKEZldGNo\nR3JvdXAuTkFNRV9ERUZBVUxULmVxdWFscyhuYW1lKSkKICAgICAgICAgICAg\ncmV0dXJuIEZldGNoR3JvdXAuREVGQVVMVDsKICAgICAgICBpZiAoRmV0Y2hH\ncm91cC5OQU1FX0FMTC5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJldHVy\nbiBGZXRjaEdyb3VwLkFMTDsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgZmV0Y2ggZ3JvdXAgb2YgdGhlIGdpdmVu\nIG5hbWUsIG9yIHJldHVybnMgZXhpc3RpbmcgaW5zdGFuY2UuCiAgICAgKgog\nICAgICogQHBhcmFtIG5hbWUgYSBub24tbnVsbCwgbm9uLWVtcHR5IG5hbWUu\nIE11c3QgYmUgdW5pcXVlIHdpdGhpbiB0aGlzCiAgICAgKiByZWNlaXZlcidz\nIHNjb3BlLiBUaGUgc3VwZXIgY2xhc3MgPGVtPm1heTwvZW0+IGhhdmUgYSBn\ncm91cCB3aXRoCiAgICAgKiB0aGUgc2FtZSBuYW1lLgogICAgICovCiAgICBw\ndWJsaWMgRmV0Y2hHcm91cCBhZGREZWNsYXJlZEZldGNoR3JvdXAoU3RyaW5n\nIG5hbWUpIHsKICAgIAlpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkK\nICAgIAkJdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJl\nbXB0eS1mZy1uYW1lIiwgdGhpcykpOwogICAgICAgIGlmIChfZmdNYXAgPT0g\nbnVsbCkKICAgICAgICAgICAgX2ZnTWFwID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICBGZXRjaEdyb3VwIGZnID0gKEZldGNoR3JvdXApIF9mZ01hcC5nZXQo\nbmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51bGwpIHsKICAgICAgICAJZmcg\nPSBuZXcgRmV0Y2hHcm91cCh0aGlzLCBuYW1lKTsKICAgICAgICAJX2ZnTWFw\nLnB1dChuYW1lLCBmZyk7CiAgICAgICAgICAgIF9mZ3MgPSBudWxsOwogICAg\nICAgICAgICBfY3VzdG9tRkdzID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZnOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgZGVj\nbGFyZWQgZmV0Y2ggZ3JvdXAuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIHJlbW92ZURlY2xhcmVkRmV0Y2hHcm91cChGZXRjaEdyb3VwIGZnKSB7CiAg\nICAgICAgaWYgKGZnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoX2ZnTWFwLnJlbW92ZShmZy5nZXROYW1lKCkpICE9\nIG51bGwpIHsKICAgICAgICAgICAgX2ZncyA9IG51bGw7CiAgICAgICAgICAg\nIF9jdXN0b21GR3MgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTb3VyY2VUcmFja2VyCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9zcmNGaWxlOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRTb3VyY2VUeXBlKCkgewog\nICAgICAgIHJldHVybiBfc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRTb3VyY2UoRmlsZSBmaWxlLCBpbnQgc3JjVHlwZSkgewogICAgICAg\nIF9zcmNGaWxlID0gZmlsZTsKICAgICAgICBfc3JjVHlwZSA9IHNyY1R5cGU7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRSZXNvdXJjZU5hbWUoKSB7\nCiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBi\nZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIGludCBnZXRT\nb3VyY2VNb2RlKCkgewogICAgICAgIHJldHVybiBfc3JjTW9kZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRh\nIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkgewogICAgICAgIF9zcmNNb2Rl\nID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9k\nZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSwgYm9v\nbGVhbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAg\nICAgICAgICAgX3NyY01vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9u\nKQogICAgICAgICAgICBfc3JjTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgX3NyY01vZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhpcyBjbGFzcyB3YXMgbGlz\ndGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2Rl\nPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlzdGVkIGluIHRo\nZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRMaXN0aW5n\nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9saXN0SW5kZXg7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhpcyBmaWVsZCB3\nYXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAq\nIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlzdGVk\nIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nTGlzdGluZ0luZGV4KGludCBpbmRleCkgewogICAgICAgIF9saXN0SW5kZXgg\nPSBpbmRleDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIENv\nbW1lbnRhYmxlCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0Q29tbWVudHMoKSB7CiAgICAgICAgcmV0dXJuIChfY29tbWVu\ndHMgPT0gbnVsbCkgPyBFTVBUWV9DT01NRU5UUyA6IF9jb21tZW50czsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb21tZW50cyhTdHJpbmdbXSBjb21t\nZW50cykgewogICAgICAgIF9jb21tZW50cyA9IGNvbW1lbnRzOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBjb3B5CiAgICAvLy8v\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29weSB0aGUgbWV0YWRhdGEg\nZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhpcyBvbmUuIERvIG5vdAog\nICAgICogY29weSBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBfdHlwZSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nc3VwZXIuY29weShtZXRhKTsKCiAgICAgICAgLy8gY29weSBjbGFzcy1sZXZl\nbCBpbmZvOyB1c2UgZ2V0IG1ldGhvZHMgdG8gZm9yY2UgcmVzb2x1dGlvbiBv\nZgogICAgICAgIC8vIGxhenkgZGF0YQogICAgICAgIF9zdXBlciA9IG1ldGEu\nZ2V0UENTdXBlcmNsYXNzKCk7CiAgICAgICAgX29iamVjdElkID0gbWV0YS5n\nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBfZXh0ZW50ID0gKG1ldGEuZ2V0\nUmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIF9lbWJlZGRlZCA9IChtZXRhLmlzRW1iZWRkZWRPbmx5\nKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBf\naW50ZXJmYWNlID0gKG1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBfaW1wbCA9IG1l\ndGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIF9pZGVudGl0eSA9IG1l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgX2lkU3RyYXRlZ3kgPSBt\nZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBfc2VxTmFtZSA9\nIG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICBfc2Vx\nTWV0YSA9IG51bGw7CiAgICAgICAgX2FsaWFzID0gbWV0YS5nZXRUeXBlQWxp\nYXMoKTsKICAgICAgICBfYWNjZXNzVHlwZSA9IG1ldGEuZ2V0QWNjZXNzVHlw\nZSgpOwoKICAgICAgICAvLyBvbmx5IGNvcHkgdGhpcyBpbmZvcm1hdGlvbiBp\nZiBpdCB3YXNuJ3Qgc2V0IGV4cGxpY2l0bHkgZm9yIHRoaXMKICAgICAgICAv\nLyBpbnN0YW5jZQogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMo\nX2NhY2hlTmFtZSkpCiAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBtZXRhLmdl\ndERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoX2NhY2hlVGltZW91dCA9\nPSBJbnRlZ2VyLk1JTl9WQUxVRSkKICAgICAgICAgICAgX2NhY2hlVGltZW91\ndCA9IG1ldGEuZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgIGlmIChf\nZGV0YWNoYWJsZSA9PSBudWxsKQogICAgICAgICAgICBfZGV0YWNoYWJsZSA9\nIG1ldGEuX2RldGFjaGFibGU7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5H\nLmVxdWFscyhfZGV0YWNoU3RhdGUpKQogICAgICAgICAgICBfZGV0YWNoU3Rh\ndGUgPSBtZXRhLmdldERldGFjaGVkU3RhdGUoKTsKCiAgICAgICAgLy8gc3lu\nY2ggZmllbGQgaW5mb3JtYXRpb247IGZpcnN0IHJlbW92ZSBleHRyYSBmaWVs\nZHMKICAgICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRN\nYXAua2V5U2V0KCkucmV0YWluQWxsKG1ldGEuX2ZpZWxkTWFwLmtleVNldCgp\nKTsKCiAgICAgICAgLy8gYWRkIGNvcGllcyBvZiBkZWNsYXJlZCBmaWVsZHM7\nIG90aGVyIGRlZmluZWQgZmllbGRzIGFscmVhZHkgY29waWVkCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0RGVjbGFyZWRGaWVs\nZHMoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGZpZWxkID0gZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgaWYgKGZpZWxkID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmaWVsZCA9IGFkZERlY2xhcmVkRmllbGQoZmllbGRzW2ld\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBmaWVsZC5zZXREZWNsYXJl\nZEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQuc2V0SW5kZXgoLTEpOwog\nICAgICAgICAgICBmaWVsZC5jb3B5KGZpZWxkc1tpXSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBjb3B5IGZldGNoIGdyb3VwcwogICAgICAgIEZldGNoR3Jv\ndXBbXSBmZ3MgPSBtZXRhLmdldERlY2xhcmVkRmV0Y2hHcm91cHMoKTsKICAg\nICAgICBGZXRjaEdyb3VwIGZnOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZnID0gYWRkRGVj\nbGFyZWRGZXRjaEdyb3VwKGZnc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAg\nICBmZy5jb3B5KGZnc1tpXSk7IAogICAgICAgIH0KCiAgICAgICAgLy8gY29w\neSBpZmFjZSByZS1tYXBwaW5nCiAgICAgICAgX2lmYWNlTWFwLmNsZWFyKCk7\nCiAgICAgICAgX2lmYWNlTWFwLnB1dEFsbChtZXRhLl9pZmFjZU1hcCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVyIHRvIGNvcHkg\nZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIHZvaWQgY29weShDbGFzc01ldGFEYXRhIGVtYmVkLCBDbGFzc01ldGFEYXRh\nIGRlYykgewogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZGVjLmdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGVtYmVkLnNldFBDU3VwZXJjbGFzcyhzdXAuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29weShlbWJlZC5nZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLCBzdXApOwogICAgICAgIH0KICAgICAg\nICBlbWJlZC5jb3B5KGRlYyk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQg\nYWRkRXh0ZW5zaW9uS2V5cyhDb2xsZWN0aW9uIGV4dHMpIHsKICAgICAgICBf\ncmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCkuYWRkQ2xhc3NFeHRlbnNpb25L\nZXlzKGV4dHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyYXRvciB1\nc2VkIHRvIHB1dCBmaWVsZCBtZXRhZGF0YXMgaW50byBsaXN0aW5nIG9yZGVy\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBMaXN0aW5nT3Jk\nZXJDb21wYXJhdG9yCiAgICAgICAgaW1wbGVtZW50cyBDb21wYXJhdG9yIHsK\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTGlzdGluZ09yZGVyQ29t\ncGFyYXRvciBfaW5zdGFuY2UKICAgICAgICAgICAgPSBuZXcgTGlzdGluZ09y\nZGVyQ29tcGFyYXRvcigpOwoKICAgICAgICAvKioKICAgICAgICAgKiBBY2Nl\nc3Mgc2luZ2xldG9uIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyBzdGF0aWMgTGlzdGluZ09yZGVyQ29tcGFyYXRvciBnZXRJbnN0YW5j\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9iamVj\ndCBvMikgewogICAgICAgICAgICBpZiAobzEgPT0gbzIpCiAgICAgICAgICAg\nICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKG8xID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKG8yID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhIGYxID0gKEZpZWxkTWV0YURhdGEpIG8xOwogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhIGYyID0gKEZpZWxkTWV0YURhdGEpIG8y\nOwogICAgICAgICAgICBpZiAoZjEuZ2V0TGlzdGluZ0luZGV4KCkgPT0gZjIu\nZ2V0TGlzdGluZ0luZGV4KCkpIHsKICAgICAgICAgICAgICAgIGlmIChmMS5n\nZXRJbmRleCgpID09IGYyLmdldEluZGV4KCkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGYxLmdldEZ1bGxOYW1lKGZhbHNlKS5jb21wYXJlVG8KICAg\nICAgICAgICAgICAgICAgICAgICAgKGYyLmdldEZ1bGxOYW1lKGZhbHNlKSk7\nCgkJCQlpZiAoZjEuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJuIDE7\nCgkJCQlpZiAoZjIuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJuIC0x\nOwoJCQkJcmV0dXJuIGYxLmdldEluZGV4ICgpIC0gZjIuZ2V0SW5kZXggKCk7\nCgkJCX0JCgkJCWlmIChmMS5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJ\nCQlyZXR1cm4gMTsKCQkJaWYgKGYyLmdldExpc3RpbmdJbmRleCAoKSA9PSAt\nMSkKCQkJCXJldHVybiAtMTsKCQkJcmV0dXJuIGYxLmdldExpc3RpbmdJbmRl\neCAoKSAtIGYyLmdldExpc3RpbmdJbmRleCAoKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

