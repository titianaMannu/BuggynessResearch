{"sha":"0bbea16195bce328c39fd605750c6782ee20813c","node_id":"MDQ6QmxvYjIwNjM2NDowYmJlYTE2MTk1YmNlMzI4YzM5ZmQ2MDU3NTBjNjc4MmVlMjA4MTNj","size":63793,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0bbea16195bce328c39fd605750c6782ee20813c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51\ndGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5Tb3J0ZWRTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuVHJlZVNldDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nbGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5j\nb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnkuUmVnaXN0ZXJDbGFzc0xpc3Rl\nbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lz\ndGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50\nLkxpZmVjeWNsZUV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIuY29uZi5Db25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5DbG9zZWFibGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IHNl\ncnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFJlcG9zaXRvcnkgb2YgYW5kIGZh\nY3RvcnkgZm9yIHBlcnNpc3RlbnQgbWV0YWRhdGEuCiAqCiAqIEBzaW5jZSAw\nLjMuMAogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtp\nbSAocXVlcnkgbWV0YWRhdGEpCiAqLwpwdWJsaWMgY2xhc3MgTWV0YURhdGFS\nZXBvc2l0b3J5CiAgICBpbXBsZW1lbnRzIFBDUmVnaXN0cnkuUmVnaXN0ZXJD\nbGFzc0xpc3RlbmVyLCBDb25maWd1cmFibGUsIENsb3NlYWJsZSwgCiAgICBN\nZXRhRGF0YU1vZGVzLCBTZXJpYWxpemFibGUgewoKICAgIC8qKgogICAgICog\nQ29uc3RhbnQgdG8gbm90IHZhbGlkYXRlIGFueSBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVkFMSURBVEVfTk9ORSA9\nIDA7CgogICAgLyoqCiAgICAgKiBCaXQgZmxhZyB0byB2YWxpZGF0ZSBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVkFM\nSURBVEVfTUVUQSA9IDE7CgogICAgLyoqCiAgICAgKiBCaXQgZmxhZyB0byB2\nYWxpZGF0ZSBtYXBwaW5ncy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgVkFMSURBVEVfTUFQUElORyA9IDI7CgogICAgLyoqCiAgICAg\nKiBCaXQgZmxhZyB0byB2YWxpZGF0ZSB1bmVuaGFuY2VkIG1ldGFkYXRhIG9u\nbHkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElE\nQVRFX1VORU5IQU5DRUQgPSA0OwoKICAgIC8qKgogICAgICogQml0IGZsYWcg\nZm9yIHJ1bnRpbWUgdmFsaWRhdGlvbi4gUmVxdWlyZXMgdGhhdCBhbGwgY2xh\nc3NlcyBhcmUKICAgICAqIGVuaGFuY2VkLCBhbmQgcGVyZm9ybXMgZXh0cmEg\nZmllbGQgcmVzb2x1dGlvbiBzdGVwcy4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgVkFMSURBVEVfUlVOVElNRSA9IDg7CgogICAgcHJv\ndGVjdGVkIHN0YXRpYyBmaW5hbCBDbGFzc1tdIEVNUFRZX0NMQVNTRVMgPSBu\nZXcgQ2xhc3NbMF07CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIE5vblBl\ncnNpc3RlbnRNZXRhRGF0YVtdIEVNUFRZX05PTl9QRVJTSVNURU5UID0gCiAg\nICAJbmV3IE5vblBlcnNpc3RlbnRNZXRhRGF0YVswXTsKICAgIHByb3RlY3Rl\nZCBmaW5hbCBDbGFzc01ldGFEYXRhW10gRU1QVFlfTUVUQVM7CiAgICBwcm90\nZWN0ZWQgZmluYWwgRmllbGRNZXRhRGF0YVtdIEVNUFRZX0ZJRUxEUzsKICAg\nIHByb3RlY3RlZCBmaW5hbCBPcmRlcltdIEVNUFRZX09SREVSUzsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKE1ldGFEYXRhUmVwb3NpdG9yeS5jbGFz\ncyk7CgogICAgLy8gc3lzdGVtIHNlcXVlbmNlCiAgICBwcml2YXRlIFNlcXVl\nbmNlTWV0YURhdGEgX3N5c1NlcSA9IG51bGw7CgogICAgLy8gY2FjaGUgb2Yg\ncGFyc2VkIG1ldGFkYXRhLCBvaWQgY2xhc3MgdG8gY2xhc3MsIGFuZCBpbnRl\ncmZhY2UgY2xhc3MKICAgIC8vIHRvIG1ldGFkYXRhcwogICAgcHJpdmF0ZSBm\naW5hbCBNYXAgX21ldGFzID0gbmV3IEhhc2hNYXAoKTsKICAgIHByaXZhdGUg\nZmluYWwgTWFwIF9vaWRzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFw\nKG5ldyBIYXNoTWFwKCkpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2ltcGxz\nID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkp\nOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2lmYWNlcyA9IENvbGxlY3Rpb25z\nLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKICAgIHByaXZhdGUg\nZmluYWwgTWFwIF9xdWVyaWVzID0gbmV3IEhhc2hNYXAoKTsKICAgIHByaXZh\ndGUgZmluYWwgTWFwIF9zZXFzID0gbmV3IEhhc2hNYXAoKTsKICAgIHByaXZh\ndGUgZmluYWwgTWFwIF9hbGlhc2VzID0gQ29sbGVjdGlvbnMuc3luY2hyb25p\nemVkTWFwKG5ldyBIYXNoTWFwKCkpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAg\nX3Bhd2FyZXMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhh\nc2hNYXAoKSk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfbm9uTWFwcGVkID0g\nQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkpOwog\nICAgCiAgICAvLyBtYXAgb2YgY2xhc3NlcyB0byBsaXN0cyBvZiB0aGVpciBz\ndWJjbGFzc2VzCiAgICBwcml2YXRlIGZpbmFsIE1hcCBfc3VicyA9IENvbGxl\nY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9\nIG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBMb2cgX2xvZyA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBJbnRlcmZhY2VJbXBsR2VuZXJhdG9y\nIF9pbXBsR2VuID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IE1ldGFE\nYXRhRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CgogICAgcHJpdmF0ZSBpbnQg\nX3Jlc01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkc7CiAgICBwcml2\nYXRlIGludCBfc291cmNlTW9kZSA9IE1PREVfTUVUQSB8IE1PREVfTUFQUElO\nRyB8IE1PREVfUVVFUlk7CiAgICBwcml2YXRlIGludCBfdmFsaWRhdGUgPSBW\nQUxJREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNFRDsKCiAgICAvLyB3\nZSBidWZmZXIgdXAgYW55IGNsYXNzZXMgdGhhdCByZWdpc3RlciB0aGVtc2Vs\ndmVzIHRvIHByZXZlbnQKICAgIC8vIHJlZW50cmFuY3kgZXJyb3JzIGlmIGNs\nYXNzZXMgcmVnaXN0ZXIgZHVyaW5nIGEgY3VycmVudCBwYXJzZSAoY29tbW9u\nKQogICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIF9yZWdpc3RlcmVkID0g\nbmV3IEFycmF5TGlzdCgpOwoKICAgIC8vIHNldCBvZiBtZXRhZGF0YXMgd2Un\ncmUgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5nCiAgICBwcml2YXRlIGZp\nbmFsIFNvcnRlZFNldCBfcmVzb2x2aW5nID0gbmV3IFRyZWVTZXQKICAgICAg\nICAobmV3IE1ldGFEYXRhSW5oZXJpdGFuY2VDb21wYXJhdG9yKCkpOwogICAg\ncHJpdmF0ZSBmaW5hbCBTb3J0ZWRTZXQgX21hcHBpbmcgPSBuZXcgVHJlZVNl\ndAogICAgICAgIChuZXcgTWV0YURhdGFJbmhlcml0YW5jZUNvbXBhcmF0b3Io\nKSk7CiAgICBwcml2YXRlIGZpbmFsIExpc3QgX2VycnMgPSBuZXcgTGlua2Vk\nTGlzdCgpOwoKICAgIC8vIHN5c3RlbSBsaXN0ZW5lcnMKICAgIHByaXZhdGUg\nTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBfbGlzdGVuZXJz\nID0KICAgICAgICBuZXcgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVy\nTGlzdCgzKTsKCiAgICAvKioKICAgICAqIERlZmF1bHQgY29uc3RydWN0b3Iu\nICBDb25maWd1cmUgdmlhIHtAbGluayBDb25maWd1cmFibGV9LgogICAgICov\nCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5KCkgewogICAgICAgIEVN\nUFRZX01FVEFTID0gbmV3Q2xhc3NNZXRhRGF0YUFycmF5KDApOwogICAgICAg\nIEVNUFRZX0ZJRUxEUyA9IG5ld0ZpZWxkTWV0YURhdGFBcnJheSgwKTsKICAg\nICAgICBFTVBUWV9PUkRFUlMgPSBuZXdPcmRlckFycmF5KDApOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25maWd1cmF0aW9uIGZvciB0\naGUgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFDb25m\naWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJu\nIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRh\nZGF0YSBsb2cuCiAgICAgKi8KICAgIHB1YmxpYyBMb2cgZ2V0TG9nKCkgewog\nICAgICAgIHJldHVybiBfbG9nOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIEkvTyB1c2VkIHRvIGxvYWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1Ymxp\nYyBNZXRhRGF0YUZhY3RvcnkgZ2V0TWV0YURhdGFGYWN0b3J5KCkgewogICAg\nICAgIHJldHVybiBfZmFjdG9yeTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBJL08gdXNlZCB0byBsb2FkIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRNZXRhRGF0YUZhY3RvcnkoTWV0YURhdGFGYWN0b3J5IGZh\nY3RvcnkpIHsKICAgICAgICBmYWN0b3J5LnNldFJlcG9zaXRvcnkodGhpcyk7\nCiAgICAgICAgX2ZhY3RvcnkgPSBmYWN0b3J5OwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1bHRz\nIHRvCiAgICAgKiA8Y29kZT5WQUxJREFURV9NRVRBIHwgVkFMSURBVEVfVU5F\nTkhBTkNFRDwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0VmFs\naWRhdGUoKSB7CiAgICAgICAgcmV0dXJuIF92YWxpZGF0ZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBE\nZWZhdWx0cyB0bwogICAgICogPGNvZGU+VkFMSURBVEVfTUVUQSB8IFZBTElE\nQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRWYWxpZGF0ZShpbnQgdmFsaWRhdGUpIHsKICAgICAgICBfdmFsaWRh\ndGUgPSB2YWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0bwogICAgICogPGNv\nZGU+VkFMSURBVEVfTUVUQSB8IFZBTElEQVRFX01BUFBJTkcgfCBWQUxJREFU\nRV9VTkVOSEFOQ0VEPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0VmFsaWRhdGUoaW50IHZhbGlkYXRlLCBib29sZWFuIG9uKSB7CiAgICAg\nICAgaWYgKHZhbGlkYXRlID09IFZBTElEQVRFX05PTkUpCiAgICAgICAgICAg\nIF92YWxpZGF0ZSA9IHZhbGlkYXRlOwogICAgICAgIGVsc2UgaWYgKG9uKQog\nICAgICAgICAgICBfdmFsaWRhdGUgfD0gdmFsaWRhdGU7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfdmFsaWRhdGUgJj0gfnZhbGlkYXRlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRpb24gbW9kZS4g\nRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQ\nUElORzwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UmVzb2x2\nZSgpIHsKICAgICAgICByZXR1cm4gX3Jlc01vZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgbWV0YWRhdGEgcmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0\ncyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HPC9j\nb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShpbnQg\nbW9kZSkgewogICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERlZmF1\nbHRzIHRvCiAgICAgKiA8Y29kZT5NT0RFX01FVEEgfCBNT0RFX01BUFBJTkc8\nL2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGlu\ndCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9E\nRV9OT05FKQogICAgICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICAgICAg\nZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfcmVzTW9kZSAmPSB+bW9kZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSBkZXRlcm1pbmlu\nZyB3aGF0IG1ldGFkYXRhIHRvIGxvYWQuIERlZmF1bHRzIHRvCiAgICAgKiA8\nY29kZT5NT0RFX01FVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RFX1FVRVJZPC9j\nb2RlPi4KICAgICAqLwogICAgcHVibGljIGludCBnZXRTb3VyY2VNb2RlKCkg\newogICAgICAgIHJldHVybiBfc291cmNlTW9kZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBzb3VyY2UgbW9kZSBkZXRlcm1pbmluZyB3aGF0IG1ldGFk\nYXRhIHRvIGxvYWQuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5NT0RFX01F\nVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RFX1FVRVJZPC9jb2RlPi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIF9zb3VyY2VNb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBzb3VyY2UgbW9kZSBkZXRlcm1pbmluZyB3aGF0IG1ldGFkYXRh\nIHRvIGxvYWQuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5NT0RFX01FVEEg\nfCBNT0RFX01BUFBJTkcgfCBNT0RFX1FVRVJZPC9jb2RlPi4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSwgYm9vbGVh\nbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAg\nICAgICAgX3NvdXJjZU1vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9u\nKQogICAgICAgICAgICBfc291cmNlTW9kZSB8PSBtb2RlOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgX3NvdXJjZU1vZGUgJj0gfm1vZGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgZ2l2\nZW4gY2xhc3MuCiAgICAgKgogICAgICogQHBhcmFtIGNscyB0aGUgY2xhc3Mg\ndG8gcmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9h\nZGVyIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAg\nICAgKiBAcGFyYW0gbXVzdEV4aXN0IGlmIHRydWUsIHRocm93cyBhIHtAbGlu\nayBNZXRhRGF0YUV4Y2VwdGlvbn0KICAgICAqIGlmIG5vIG1ldGFkYXRhIGlz\nIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgQ2xhc3NN\nZXRhRGF0YSBnZXRNZXRhRGF0YShDbGFzcyBjbHMsCiAgICAgICAgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IGdldE1ldGFEYXRhSW50ZXJuYWwoY2xz\nLCBlbnZMb2FkZXIpOwogICAgICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVz\ndEV4aXN0KSB7CiAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiAhUGVy\nc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbWV0YS1ub3RwYyIsIGNscykpLgogICAgICAgICAgICAg\nICAgICAgIHNldEZhdGFsKGZhbHNlKTsKCiAgICAgICAgICAgIFNldCBwY05h\nbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVy\nKTsKICAgICAgICAgICAgaWYgKHBjTmFtZXMgIT0gbnVsbCAmJiBwY05hbWVz\nLnNpemUoKSA+IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEtdHlwZXMiLAogICAgICAg\nICAgICAgICAgICAgIGNscywgcGNOYW1lcykpOwoKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhIiwg\nY2xzKSk7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUobWV0YSk7CiAgICAg\nICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gYWxpYXMgbmFtZS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gYWxpYXMgdGhlIGFsaWFzIHRvIGNsYXNzIHRvIHJl\ndHJpZXZlIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlciB0\naGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAgICog\nQHBhcmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0\nYURhdGFFeGNlcHRpb259CiAgICAgKiBpZiBubyBtZXRhZGF0YSBpcyBmb3Vu\nZAogICAgICogQHNlZSBDbGFzc01ldGFEYXRhI2dldFR5cGVBbGlhcwogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YShTdHJp\nbmcgYWxpYXMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29s\nZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChhbGlhcyA9PSBudWxsICYm\nIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsCiAgICAg\nICAgICAgICAgICBfYWxpYXNlcykpOwogICAgICAgIGlmIChhbGlhcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hl\nY2sgY2FjaGUKICAgICAgICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52\nTG9hZGVyKTsKICAgICAgICBMaXN0IGNsYXNzTGlzdCA9IChMaXN0KSBfYWxp\nYXNlcy5nZXQoYWxpYXMpOwoKICAgICAgICAvLyBtdWx0aXBsZSBjbGFzc2Vz\nIG1heSBoYXZlIGJlZW4gZGVmaW5lZCB3aXRoIHRoZSBzYW1lIGFsaWFzOiB3\nZQogICAgICAgIC8vIHdpbGwgZmlsdGVyIGJ5IGNoZWNraW5nIGFnYWluc3Qg\ndGhlIGN1cnJlbnQgbGlzdCBvZiB0aGUKICAgICAgICAvLyBwZXJzaXN0ZW50\nIHR5cGVzIGFuZCBmaWx0ZWQgYmFzZWQgb24gd2hpY2ggY2xhc3NlcyBhcmUg\nbG9hZGFibGUKICAgICAgICAvLyB2aWEgdGhlIGN1cnJlbnQgZW52aXJvbm1l\nbnQncyBDbGFzc0xvYWRlcgogICAgICAgIFNldCBwY05hbWVzID0gZ2V0UGVy\nc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICBD\nbGFzcyBjbHMgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBjbGFz\nc0xpc3QgIT0gbnVsbCAmJiBpIDwgY2xhc3NMaXN0LnNpemUoKTsgaSsrKSB7\nCiAgICAgICAgICAgIENsYXNzIGMgPSAoQ2xhc3MpIGNsYXNzTGlzdC5nZXQo\naSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyByZS1s\nb2FkIHRoZSBjbGFzcyBpbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudCBsb2Fk\nZXIgc28KICAgICAgICAgICAgICAgIC8vIHRoYXQgd2UgY2FuIGhhbmRsZSBy\nZWRlcGxveW1lbnQgb2YgdGhlIHNhbWUgY2xhc3MgbmFtZQogICAgICAgICAg\nICAgICAgQ2xhc3MgbmMgPSBDbGFzcy5mb3JOYW1lKGMuZ2V0TmFtZSgpLCBm\nYWxzZSwgZW52TG9hZGVyKTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBo\nYXZlIHNwZWNpZmllZCBhIGxpc3Qgb2YgcGVyc2lzdGVudCBjbGFzZXMsCiAg\nICAgICAgICAgICAgICAvLyBhbHNvIGNoZWNrIHRvIGVuc3VyZSB0aGF0IHRo\nZSBjbGFzcyBpcyBpbiB0aGF0IGxpc3QKICAgICAgICAgICAgICAgIGlmIChw\nY05hbWVzID09IG51bGwgfHwgcGNOYW1lcy5zaXplKCkgPT0gMCAKICAgICAg\nICAgICAgICAgICAgICB8fCBwY05hbWVzLmNvbnRhaW5zKG5jLmdldE5hbWUo\nKSkpIHsKICAgICAgICAgICAgICAgICAgICBjbHMgPSBuYzsKICAgICAgICAg\nICAgICAgICAgICBpZiAoIWNsYXNzTGlzdC5jb250YWlucyhjbHMpKQogICAg\nICAgICAgICAgICAgICAgICAgICBjbGFzc0xpc3QuYWRkKGNscyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAg\nICAvLyB0aGlzIGhhcHBlbnMgd2hlbiB0aGUgY2xhc3MgaXMgbm90IGxvYWRh\nYmxlIGJ5CiAgICAgICAgICAgICAgICAvLyB0aGUgZW52aXJvbm1lbnQgY2xh\nc3MgbG9hZGVyLCBzbyBpdCB3YXMgcHJvYmFibHkKICAgICAgICAgICAgICAg\nIC8vIGxpc3RlZCBlbHNld2hlcmU7IGFsc28gaWdub3JlIGxpbmthZ2UgZmFp\nbHVyZXMgYW5kCiAgICAgICAgICAgICAgICAvLyBvdGhlciBjbGFzcyBsb2Fk\naW5nIHByb2JsZW1zCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\naWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURh\ndGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CgogICAgICAgIC8vIG1h\neWJlIHRoaXMgaXMgc29tZSB0eXBlIHdlJ3ZlIHNlZW4gYnV0IGp1c3QgaXNu\nJ3QgdmFsaWQKICAgICAgICBpZiAoX2FsaWFzZXMuY29udGFpbnNLZXkoYWxp\nYXMpKSB7CiAgICAgICAgICAgIGlmIChtdXN0RXhpc3QpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLWFsaWFzLW1ldGEiLCBhbGlhcywKICAgICAgICAgICAgICAgICAgICBfYWxp\nYXNlcykpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIC8vIHJlY29yZCB0aGF0IHRoaXMgaXMgYW4gaW52YWxpZCB0eXBl\nCiAgICAgICAgX2FsaWFzZXMucHV0KGFsaWFzLCBudWxsKTsKCiAgICAgICAg\naWYgKCFtdXN0RXhpc3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8t\nYWxpYXMtbWV0YSIsIGFsaWFzLCBfYWxpYXNlcykpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGdldCB0aGUgbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBjbGFzcywgd2l0aG91dAogICAgICogcmVzb2x2aW5n\nIGl0LgogICAgICovCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0TWV0\nYURhdGFJbnRlcm5hbChDbGFzcyBjbHMsCiAgICAgICAgQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUgZm9y\nIGV4aXN0aW5nIG1ldGFkYXRhLCBvciBnaXZlIHVwIGlmIG5vIG1ldGFkYXRh\nIGFuZAogICAgICAgIC8vIG91ciBsaXN0IG9mIGNvbmZpZ3VyZWQgcGVyc2lz\ndGVudCB0eXBlcyBkb2Vzbid0IGluY2x1ZGUgdGhlIGNsYXNzCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5n\nZXQoY2xzKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5n\nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01FVEEpICE9IDAKICAgICAgICAgICAg\nfHwgKF9zb3VyY2VNb2RlICYgTU9ERV9NRVRBKSA9PSAwKSkKICAgICAgICAg\nICAgcmV0dXJuIG1ldGE7CgogICAgICAgIC8vIGlmIHJ1bnRpbWUsIGN1dCBv\nZmYgc2VhcmNoIGlmIG5vdCBpbiBwYyBsaXN0LiAgd2UgZG9uJ3QgZG8gdGhp\ncyBhdAogICAgICAgIC8vIGRldiB0aW1lIHNvIHRoYXQgdXNlciBjYW4gbWFu\naXB1bGF0ZSBwZXJzaXN0ZW50IGNsYXNzZXMgaGUncyB3cml0aW5nCiAgICAg\nICAgLy8gYmVmb3JlIGFkZGluZyB0aGVtIHRvIHRoZSBsaXN0CiAgICAgICAg\naWYgKChfdmFsaWRhdGUgJiBWQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAg\nICAgICAgICAgIFNldCBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAgaWYgKHBjTmFtZXMg\nIT0gbnVsbCAmJiAhcGNOYW1lcy5jb250YWlucyhjbHMuZ2V0TmFtZSgpKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBjaGVjayB0\nbyBzZWUgaWYgbWF5YmUgd2Uga25vdyB0aGlzIGNsYXNzIGhhcyBubyBtZXRh\nZGF0YQogICAgICAgICAgICBpZiAoX21ldGFzLmNvbnRhaW5zS2V5KGNscykp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8v\nIG1ha2Ugc3VyZSB0aGlzIGlzbid0IGFuIG9idmlvdXNseSBiYWQgY2xhc3MK\nICAgICAgICAgICAgaWYgKGNscy5pc1ByaW1pdGl2ZSgpIHx8IGNscy5nZXRO\nYW1lKCkuc3RhcnRzV2l0aCgiamF2YS4iKQogICAgICAgICAgICAgICAgfHwg\nY2xzID09IFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gZGVzaWduZWQgdG8g\nZ2V0IGFyb3VuZCBqaWtlcyAxLjE3IC8gSkRLMS41IGlzc3VlIHdoZXJlIHN0\nYXRpYwogICAgICAgICAgICAvLyBpbml0aWFsaXplcnMgYXJlIG5vdCBpbnZv\na2VkIHdoZW4gYSBjbGFzcyBpcyByZWZlcmVuY2VkLCBzbyB0aGUKICAgICAg\nICAgICAgLy8gY2xhc3MgbmV2ZXIgcmVnaXN0ZXJzIGl0c2VsZiB3aXRoIHRo\nZSBzeXN0ZW0KICAgICAgICAgICAgaWYgKChfdmFsaWRhdGUgJiBWQUxJREFU\nRV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdldE5hbWUoKSwg\ndHJ1ZSwgY2xzLmdldENsYXNzTG9hZGVyKCkpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90IGluIGNhY2hl\nOiBsb2FkIG1ldGFkYXRhIG9yIG1hcHBpbmdzIGRlcGVuZGluZyBvbiBzb3Vy\nY2UgbW9kZS4KICAgICAgICAvLyBsb2FkaW5nIG1ldGFkYXRhIG1pZ2h0IGFs\nc28gbG9hZCBtYXBwaW5ncywgYnV0IGRvZXNuJ3QgaGF2ZSB0bwogICAgICAg\nIGludCBtb2RlID0gMDsKICAgICAgICBpZiAoKF9zb3VyY2VNb2RlICYgTU9E\nRV9NRVRBKSAhPSAwKQogICAgICAgICAgICBtb2RlID0gX3NvdXJjZU1vZGUg\nJiB+TU9ERV9NQVBQSU5HOwogICAgICAgIGVsc2UgaWYgKChfc291cmNlTW9k\nZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAgICAgICAgICAgbW9kZSA9IF9z\nb3VyY2VNb2RlOwogICAgICAgIGlmIChtb2RlICE9IE1PREVfTk9ORSkgewog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgibG9hZC1jbHMiLCBjbHMs\nIHRvTW9kZVN0cmluZyhtb2RlKSkpOwogICAgICAgICAgICBfZmFjdG9yeS5s\nb2FkKGNscywgbW9kZSwgZW52TG9hZGVyKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGNoZWNrIGNhY2hlIGFnYWluCiAgICAgICAgaWYgKG1ldGEgPT0gbnVs\nbCkKICAgICAgICAgICAgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBfbWV0YXMu\nZ2V0KGNscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCAmJiAoKG1ldGEu\nZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAhPSAwCiAgICAgICAgICAg\nIHx8IChfc291cmNlTW9kZSAmIE1PREVfTUVUQSkgPT0gMCkpCiAgICAgICAg\nICAgIHJldHVybiBtZXRhOwoKICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlz\nIGNsYXNzIGhhcyBubyBtZXRhZGF0YTsgY2hlY2tpbmcgZm9yIHRoaXMgbGF0\nZXIKICAgICAgICAvLyBzcGVlZHMgdGhpbmdzIHVwIGluIGVudmlyb25tZW50\ncyB3aXRoIHNsb3cgY2xhc3MgbG9hZGluZwogICAgICAgIC8vIGxpa2UgYXBw\nc2VydmVycwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAg\nIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgIF9tZXRhcy5wdXQoY2xz\nLCBudWxsKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUg\nZ2l2ZW4gbW9kZSBmbGFncy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nU3RyaW5nIHRvTW9kZVN0cmluZyhpbnQgbW9kZSkgewogICAgICAgIFN0cmlu\nZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKDMxKTsKICAgICAgICBp\nZiAoKG1vZGUgJiBNT0RFX01FVEEpICE9IDApCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIltNRVRBXSIpOwogICAgICAgIGlmICgobW9kZSAmIE1PREVfUVVF\nUlkpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltRVUVSWV0iKTsK\nICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIltNQVBQSU5HXSIpOwogICAgICAgIGlmICgo\nbW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCJbTUFQUElOR19JTklUXSIpOwogICAgICAgIHJldHVybiBi\ndWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUg\nbWV0YWRhdGEgZm9yIG1hcHBpbmcgcmVzb2x1dGlvbi4gVGhpcyBtZXRob2Qg\nbWlnaHQgbWFwIHBhcnRzCiAgICAgKiBvZiB0aGUgbWV0YWRhdGEgdGhhdCBk\nb24ndCByZWx5IG9uIG90aGVyIGNsYXNzZXMgYmVpbmcgbWFwcGVkLCBidXQg\ndGhhdAogICAgICogb3RoZXIgY2xhc3NlcyBtaWdodCByZWx5IG9uIGR1cmlu\nZyB0aGVpciBvd24gbWFwcGluZyAoZm9yIGV4YW1wbGUsCiAgICAgKiBwcmlt\nYXJ5IGtleSBmaWVsZHMpLiBCeSBkZWZhdWx0LCB0aGlzIG1ldGhvZCBvbmx5\nIGNhbGxzCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNkZWZpbmVTdXBl\ncmNsYXNzRmllbGRzfS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcHJl\ncGFyZU1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgbWV0\nYS5kZWZpbmVTdXBlcmNsYXNzRmllbGRzKGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc29sdmUgdGhlIGdpdmVuIG1ldGFkYXRhIGlmIG5lZWRl\nZC4gVGhlcmUgYXJlIHRocmVlIGdvYWxzOgogICAgICogPG9sPgogICAgICog\nPGxpPk1ha2Ugc3VyZSBubyB1bnJlc29sdmVkIG1ldGFkYXRhIGdldHMgYmFj\nayB0byB0aGUgY2xpZW50LjwvbGk+CiAgICAgKiA8bGk+QXZvaWQgaW5maW5p\ndGUgcmVlbnRyYW50IGNhbGxzIGZvciBtdXR1YWxseS1kZXBlbmRlbnQgbWV0\nYWRhdGFzIGJ5CiAgICAgKiBhbGxvd2luZyB1bnJlc29sdmVkIG1ldGFkYXRh\nIHRvIGJlIHJldHVybmVkIHRvIG90aGVyIG1ldGFkYXRhcy48L2xpPgogICAg\nICogPGxpPkFsd2F5cyBtYWtlIHN1cmUgdGhlIHN1cGVyY2xhc3MgbWV0YWRh\ndGEgaXMgcmVzb2x2ZWQgYmVmb3JlIHRoZQogICAgICogc3ViY2xhc3MgbWV0\nYWRhdGEgc28gdGhhdCB0aGUgc3ViY2xhc3MgY2FuIGFjY2VzcyB0aGUgc3Vw\nZXIncyBsaXN0CiAgICAgKiBvZiBmaWVsZHMuPC9saT4KICAgICAqIDwvb2w+\nIE5vdGUgdGhhdCB0aGUgY29kZSBjYWxsaW5nIHRoaXMgbWV0aG9kIGlzIHN5\nbmNocm9uaXplZCwgc28gdGhpcwogICAgICogbWV0aG9kIGRvZXNuJ3QgaGF2\nZSB0byBiZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmUoQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgLy8gcmV0dXJuIGFueXRoaW5n\nIHRoYXQgaGFzIGl0cyBtZXRhZGF0YSByZXNvbHZlZCwgYmVjYXVzZSB0aGF0\nIG1lYW5zCiAgICAgICAgLy8gaXQgaXMgZWl0aGVyIGZ1bGx5IHJlc29sdmVk\nIG9yIG11c3QgYXQgbGVhc3QgYmUgaW4gdGhlIHByb2Nlc3Mgb2YKICAgICAg\nICAvLyByZXNvbHZpbmcgbWFwcGluZywgZXRjIHNpbmNlIHdlIGRvIHRoYXQg\ncmlnaHQgYWZ0ZXIgbWV0YSByZXNvbHZlCiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCB8fCBfcmVzTW9kZSA9PSBNT0RFX05PTkUKICAgICAgICAgICAgfHwg\nKG1ldGEuZ2V0UmVzb2x2ZSgpICYgTU9ERV9NRVRBKSAhPSAwKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIHJlc29sdmUgbWV0YWRhdGEKICAg\nICAgICBMaXN0IHJlc29sdmVkID0gcmVzb2x2ZU1ldGEobWV0YSk7CiAgICAg\nICAgaWYgKHJlc29sdmVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gbG9hZCBtYXBwaW5nIGRhdGEKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHJlc29sdmVkLnNpemUoKTsgaSsrKQogICAgICAgICAg\nICBsb2FkTWFwcGluZygoQ2xhc3NNZXRhRGF0YSkgcmVzb2x2ZWQuZ2V0KGkp\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVkLnNpemUo\nKTsgaSsrKQogICAgICAgICAgICBwcmVNYXBwaW5nKChDbGFzc01ldGFEYXRh\nKSByZXNvbHZlZC5nZXQoaSkpOwoKICAgICAgICAvLyByZXNvbHZlIG1hcHBp\nbmdzCiAgICAgICAgYm9vbGVhbiBlcnIgPSB0cnVlOwogICAgICAgIGlmICgo\nX3Jlc01vZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcmVzb2x2ZWQuc2l6ZSgpOyBpKyspCiAgICAg\nICAgICAgICAgICBlcnIgJj0gcmVzb2x2ZU1hcHBpbmcoKENsYXNzTWV0YURh\ndGEpIHJlc29sdmVkLmdldChpKSk7CgogICAgICAgIC8vIHRocm93IGVycm9y\ncyBlbmNvdW50ZXJlZAogICAgICAgIGlmIChlcnIgJiYgIV9lcnJzLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICBSdW50aW1lRXhjZXB0aW9uIHJlOwogICAg\nICAgICAgICBpZiAoX2VycnMuc2l6ZSgpID09IDEpCiAgICAgICAgICAgICAg\nICByZSA9IChSdW50aW1lRXhjZXB0aW9uKSBfZXJycy5nZXQoMCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJlID0gbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZXNvbHZlLWVycnMiKSkuCiAgICAgICAg\nICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10p\nIF9lcnJzLnRvQXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAgKG5ldyBF\neGNlcHRpb25bX2VycnMuc2l6ZSgpXSkpOwogICAgICAgICAgICBfZXJycy5j\nbGVhcigpOwogICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXNvbHZlIG1ldGFkYXRhIG1vZGUsIHJldHVy\nbmluZyBsaXN0IG9mIHByb2Nlc3NlZCBtZXRhZGFkYXRhcywgb3IgbnVsbAog\nICAgICogaWYgd2UncmUgc3RpbGwgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2\naW5nIG90aGVyIG1ldGFkYXRhcy4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0\nIHJlc29sdmVNZXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlm\nIChtZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gc2V0IHN1cGVyY2xhc3MKICAgICAgICAgICAgQ2xhc3Mgc3VwID0g\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0U3VwZXJjbGFzcygpOwogICAg\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cE1ldGE7CiAgICAgICAgICAgIHdo\naWxlIChzdXAgIT0gbnVsbCAmJiBzdXAgIT0gT2JqZWN0LmNsYXNzKSB7CiAg\nICAgICAgICAgICAgICBzdXBNZXRhID0gZ2V0TWV0YURhdGEoc3VwLCBtZXRh\nLmdldEVudkNsYXNzTG9hZGVyKCksIGZhbHNlKTsKICAgICAgICAgICAgICAg\nIGlmIChzdXBNZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBt\nZXRhLnNldFBDU3VwZXJjbGFzcyhzdXApOwogICAgICAgICAgICAgICAgICAg\nIG1ldGEuc2V0UENTdXBlcmNsYXNzTWV0YURhdGEoc3VwTWV0YSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgICAgICBzdXAgPSBzdXAuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAgICAgICBD\nbGFzc1tdIHN1cHMgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRJbnRl\ncmZhY2VzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHN1cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBzdXBN\nZXRhID0gZ2V0TWV0YURhdGEoc3Vwc1tpXSwgbWV0YS5nZXRFbnZDbGFzc0xv\nYWRlcigpLCAKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChzdXBNZXRhICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Moc3VwKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJh\nc3NpZ25lZC1zdXAiLCBtZXRhLAogICAgICAgICAgICAgICAgICAgIG1ldGEu\nZ2V0UENTdXBlcmNsYXNzKCkpKTsKICAgICAgICB9CgogICAgICAgIC8vIHJl\nc29sdmUgcmVsYXRpb24gcHJpbWFyeSBrZXkgZmllbGRzIGZvciBtYXBwaW5n\nIGRlcGVuZGVuY2llcwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZt\nZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBnZXRNZXRh\nRGF0YShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAKICAgICAgICAgICAg\nICAgICAgICBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIGZhbHNlKTsKCiAg\nICAgICAgLy8gcmVzb2x2ZSBtZXRhZGF0YTsgaWYgd2UncmUgbm90IGluIHRo\nZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAgICAgIC8vIG90aGVycywgdGhp\ncyB3aWxsIHJldHVybiB0aGUgc2V0IG9mIGludGVycmVsYXRlZCBtZXRhcyB0\naGF0CiAgICAgICAgLy8gcmVzb2x2ZWQKICAgICAgICByZXR1cm4gcHJvY2Vz\nc0J1ZmZlcihtZXRhLCBfcmVzb2x2aW5nLCBNT0RFX01FVEEpOwogICAgfQoK\nICAgIC8qKgogICAgICogTG9hZCBtYXBwaW5nIGluZm9ybWF0aW9uIGZvciB0\naGUgZ2l2ZW4gbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBs\nb2FkTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAo\nKG1ldGEuZ2V0UmVzb2x2ZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGxvYWQgbWFwcGluZyBpbmZv\ncm1hdGlvbgogICAgICAgIGlmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBN\nT0RFX01BUFBJTkcpID09IDAKICAgICAgICAgICAgJiYgKF9zb3VyY2VNb2Rl\nICYgTU9ERV9NQVBQSU5HKSAhPSAwKSB7CiAgICAgICAgICAgIC8vIGVtYmVk\nZGVkLW9ubHkgbWV0YWRhdGEgZG9lc24ndCBoYXZlIG1hcHBpbmcsIHNvIGFs\nd2F5cyBsb2FkZWQKICAgICAgICAgICAgaWYgKG1ldGEuaXNFbWJlZGRlZE9u\nbHkoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RF\nX01BUFBJTkcsIHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIC8vIGxvYWQgbWFwcGluZyBkYXRhCiAgICAgICAgICAgICAgICBp\nbnQgbW9kZSA9IF9zb3VyY2VNb2RlICYgfk1PREVfTUVUQTsKICAgICAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgibG9hZC1tYXBwaW5nIiwg\nbWV0YSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9Nb2RlU3RyaW5nKG1v\nZGUpKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIF9mYWN0b3J5LmxvYWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIG1v\nZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0RW52Q2xhc3NM\nb2FkZXIoKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlTWV0YURh\ndGEobWV0YSk7CiAgICAgICAgICAgICAgICAgICAgX2VycnMuYWRkKHJlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFByZS1tYXBwaW5nIHByZXBhcmF0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJlTWFwcGluZyhDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBpZiAoKG1ldGEuZ2V0UmVzb2x2ZSgpICYg\nTU9ERV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIC8vIHByZXBhcmUgbWFwcGluZ3MgZm9yIHJlc29sdmU7IGlmIG5vdCBy\nZXNvbHZpbmcgbWFwcGluZ3MsIHRoZW4KICAgICAgICAvLyBtYWtlIHN1cmUg\nYW55IHN1cGVyY2xhc3MgZmllbGRzIGRlZmluZWQgaW4gbWV0YWRhdGEgYXJl\nIHJlc29sdmVkCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfcmVz\nTW9kZSAmIE1PREVfTUFQUElORykgIT0gMCkgewogICAgICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcmVwLW1hcHBpbmciLCBtZXRhKSk7\nCiAgICAgICAgICAgICAgICBwcmVwYXJlTWFwcGluZyhtZXRhKTsKICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBtZXRhLmRlZmluZVN1cGVy\nY2xhc3NGaWVsZHMoZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgcmVtb3ZlTWV0YURhdGEobWV0\nYSk7CiAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBhbmQgaW5pdGlhbGl6ZSBtYXBw\naW5nLgogICAgICoKICAgICAqIEByZXR1cm4gZmFsc2UgaWYgd2UncmUgc3Rp\nbGwgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5nIG1hcHBpbmdzCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiByZXNvbHZlTWFwcGluZyhDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBMaXN0IG1hcHBlZCA9IHByb2Nlc3NC\ndWZmZXIobWV0YSwgX21hcHBpbmcsIE1PREVfTUFQUElORyk7CiAgICAgICAg\naWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIC8vIGluaXRpYWxpemUgbWFwcGluZyBmb3IgcnVudGltZSB1\nc2UKICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5HX0lOSVQp\nICE9IDApIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBw\nZWQuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIG1ldGEgPSAoQ2xh\nc3NNZXRhRGF0YSkgbWFwcGVkLmdldChpKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5yZXNvbHZlKE1PREVfTUFQ\nUElOR19JTklUKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVNZXRh\nRGF0YShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBfZXJycy5hZGQocmUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUHJv\nY2VzcyB0aGUgZ2l2ZW4gbWV0YWRhdGEgYW5kIHRoZSBhc3NvY2lhdGVkIGJ1\nZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0IHByb2Nlc3NCdWZmZXIo\nQ2xhc3NNZXRhRGF0YSBtZXRhLCBTb3J0ZWRTZXQgYnVmZmVyLCBpbnQgbW9k\nZSkgewogICAgICAgIC8vIGlmIHdlJ3JlIGFscmVhZHkgcHJvY2Vzc2luZyBh\nIG1ldGFkYXRhLCBqdXN0IGJ1ZmZlciB0aGlzIG9uZTsgd2hlbgogICAgICAg\nIC8vIHRoZSBpbml0aWFsIG1ldGFkYXRhIGZpbmlzaGVzIHByb2Nlc3Npbmcs\nIHdlIHRyYXZlcnNlIHRoZSBidWZmZXIKICAgICAgICAvLyBhbmQgcHJvY2Vz\ncyBhbGwgdGhlIG90aGVycyB0aGF0IHdlcmUgaW50cm9kdWNlZCBkdXJpbmcg\ncmVlbnRyYW50CiAgICAgICAgLy8gY2FsbHMKICAgICAgICBpZiAoIWJ1ZmZl\nci5hZGQobWV0YSkgfHwgYnVmZmVyLnNpemUoKSAhPSAxKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY29udGludWFsbHkgcG9wIGEg\nbWV0YWRhdGEgYW5kIHByb2Nlc3MgaXQgdW50aWwgd2UgcnVuIG91dDsgbm90\nZQogICAgICAgIC8vIHRoYXQgZWFjaCBwcm9jZXNzaW5nIGNhbGwgbWlnaHQg\ncGxhY2UgbW9yZSBtZXRhcyBpbiB0aGUgYnVmZmVyIGFzCiAgICAgICAgLy8g\nb25lIGNsYXNzIHRyaWVzIHRvIGFjY2VzcyBtZXRhZGF0YSBmb3IgYW5vdGhl\ncjsgYWxzbyBub3RlIHRoYXQgdGhlCiAgICAgICAgLy8gYnVmZmVyIG9yZGVy\ncyBpdHNlbGYgZnJvbSBsZWFzdCB0byBtb3N0IGRlcml2ZWQKICAgICAgICBD\nbGFzc01ldGFEYXRhIGJ1ZmZlcmVkOwogICAgICAgIExpc3QgcHJvY2Vzc2Vk\nID0gbmV3IEFycmF5TGlzdCg1KTsKICAgICAgICB3aGlsZSAoIWJ1ZmZlci5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgYnVmZmVyZWQgPSAoQ2xhc3NNZXRh\nRGF0YSkgYnVmZmVyLmZpcnN0KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBidWZmZXJlZC5yZXNvbHZlKG1vZGUpOwogICAgICAgICAg\nICAgICAgcHJvY2Vzc2VkLmFkZChidWZmZXJlZCk7CiAgICAgICAgICAgICAg\nICBidWZmZXIucmVtb3ZlKGJ1ZmZlcmVkKTsKICAgICAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgX2Vy\ncnMuYWRkKHJlKTsKCiAgICAgICAgICAgICAgICAvLyBhbnkgZXhjZXB0aW9u\nIGR1cmluZyByZXNvbHV0aW9uIG9mIG9uZSB0eXBlIG1lYW5zIHdlIGNhbid0\nCiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGFueSBvZiB0aGUgcmVsYXRl\nZCB0eXBlcywgc28gY2xlYXIgYnVmZmVyLiAgdGhpcyBhbHNvCiAgICAgICAg\nICAgICAgICAvLyBlbnN1cmVzIHRoYXQgaWYgdHdvIHR5cGVzIHJlbGF0ZSB0\nbyBlYWNoIG90aGVyIGFuZCBvbmUKICAgICAgICAgICAgICAgIC8vIGRpZXMs\nIHdlIGRvbid0IGdldCBpbnRvIGluZmluaXRlIGN5Y2xlcwogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBidWZmZXIuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBtZXRhID0g\nKENsYXNzTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAg\nICAgcmVtb3ZlTWV0YURhdGEobWV0YSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG1ldGEgIT0gYnVmZmVyZWQpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgX2VycnMuYWRkKG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJwcmV2LWVycnMiLCBtZXRh\nLCBidWZmZXJlZCkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBidWZmZXIuY2xlYXIoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJvY2Vzc2Vk\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCB0aGUgbWV0YWRh\ndGEgaW5zdGFuY2VzIGN1cnJlbnRseSBpbiB0aGUgcmVwb3NpdG9yeS4KICAg\nICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBDbGFzc01ldGFEYXRhW10g\nZ2V0TWV0YURhdGFzKCkgewogICAgICAgIC8vIHByZXZlbnQgY29uY3VycmVu\ndCBtb2QgZXJyb3JzIHdoZW4gcmVzb2x2aW5nIG9uZSBtZXRhZGF0YQogICAg\nICAgIC8vIGludHJvZHVjZXMgb3RoZXJzCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYVtdIG1ldGFzID0gKENsYXNzTWV0YURhdGFbXSkgX21ldGFzLnZhbHVlcygp\nLgogICAgICAgICAgICB0b0FycmF5KG5ldyBDbGFzc01ldGFEYXRhW19tZXRh\ncy5zaXplKCldKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGFz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAobWV0YXNbaV0gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG1ldGFzW2ldLmdldERl\nc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBtZXRhc1tpXS5n\nZXRFbnZDbGFzc0xvYWRlcigpLCB0cnVlKTsKCiAgICAgICAgTGlzdCByZXNv\nbHZlZCA9IG5ldyBBcnJheUxpc3QoX21ldGFzLnNpemUoKSk7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gX21ldGFzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJlc29sdmVkLmFkZChtZXRhKTsKICAgICAgICB9CiAgICAgICAg\nbWV0YXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSByZXNvbHZlZC50b0FycmF5CiAg\nICAgICAgICAgIChuZXdDbGFzc01ldGFEYXRhQXJyYXkocmVzb2x2ZWQuc2l6\nZSgpKSk7CiAgICAgICAgQXJyYXlzLnNvcnQobWV0YXMpOwogICAgICAgIHJl\ndHVybiBtZXRhczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY2FjaGVkIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIHdpdGhvdXQg\nYW55IHJlc29sdXRpb24uCiAgICAgKiBSZXR1cm4gbnVsbCBpZiBub25lLgog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRDYWNoZWRNZXRh\nRGF0YShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWV0YURh\ndGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdpdGggZGVm\nYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvCiAgICAgKiB0aGUgcmVwb3Np\ndG9yeSwgYW5kIHJldHVybiBpdC4gVXNlIHRoZSBkZWZhdWx0IGFjY2VzcyB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBhZGRNZXRh\nRGF0YShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gYWRkTWV0YURhdGEo\nY2xzLCBDbGFzc01ldGFEYXRhLkFDQ0VTU19VTktOT1dOKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9wdWxhdGUg\naXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8KICAgICAq\nIHRoZSByZXBvc2l0b3J5LCBhbmQgcmV0dXJuIGl0LgogICAgICoKICAgICAq\nIEBwYXJhbSBhY2Nlc3MgdGhlIGFjY2VzcyB0eXBlIHRvIHVzZSBpbiBwb3B1\nbGF0aW5nIG1ldGFkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGFkZE1ldGFEYXRhKENsYXNzIGNscywgaW50IGFjY2VzcykgewogICAg\nICAgIGlmIChjbHMgPT0gbnVsbCB8fCBjbHMuaXNQcmltaXRpdmUoKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IG5ld0NsYXNzTWV0YURhdGEoY2xzKTsKICAgICAgICBfZmFjdG9y\neS5nZXREZWZhdWx0cygpLnBvcHVsYXRlKG1ldGEsIGFjY2Vzcyk7CgogICAg\nICAgIC8vIHN5bmNocm9uaXplIG9uIHRoaXMgcmF0aGVyIHRoYW4gdGhlIG1h\ncCwgYmVjYXVzZSBhbGwgb3RoZXIgbWV0aG9kcwogICAgICAgIC8vIHRoYXQg\nYWNjZXNzIF9tZXRhcyBhcmUgc3luY2hyb25pemVkIG9uIHRoaXMKICAgICAg\nICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKF9wYXdh\ncmVzLmNvbnRhaW5zS2V5KGNscykpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1hd2FyZSIs\nIGNscykpOwogICAgICAgICAgICBfbWV0YXMucHV0KGNscywgbWV0YSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBjbGFzcyBtZXRhZGF0YSBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3Q2xh\nc3NNZXRhRGF0YShDbGFzcyB0eXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBD\nbGFzc01ldGFEYXRhKHR5cGUsIHRoaXMpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IGFycmF5IG9mIHRoZSBwcm9wZXIgY2xhc3MgbWV0\nYWRhdGEgc3ViY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01l\ndGFEYXRhW10gbmV3Q2xhc3NNZXRhRGF0YUFycmF5KGludCBsZW5ndGgpIHsK\nICAgICAgICByZXR1cm4gbmV3IENsYXNzTWV0YURhdGFbbGVuZ3RoXTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBmaWVsZCBtZXRhZGF0\nYSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURh\ndGEgbmV3RmllbGRNZXRhRGF0YShTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSwK\nICAgICAgICBDbGFzc01ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBGaWVsZE1ldGFEYXRhKG5hbWUsIHR5cGUsIG93bmVyKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJv\ncGVyIGZpZWxkIG1ldGFkYXRhIHN1YmNsYXNzLgogICAgICovCiAgICBwcm90\nZWN0ZWQgRmllbGRNZXRhRGF0YVtdIG5ld0ZpZWxkTWV0YURhdGFBcnJheShp\nbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZE1ldGFEYXRh\nW2xlbmd0aF07CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nZW1iZWRkZWQgY2xhc3MgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIG5ld0VtYmVkZGVkQ2xhc3NNZXRh\nRGF0YShWYWx1ZU1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBDbGFzc01ldGFEYXRhKG93bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyB2YWx1ZSBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFZhbHVlTWV0YURhdGEgbmV3VmFsdWVNZXRhRGF0\nYShGaWVsZE1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBW\nYWx1ZU1ldGFEYXRhSW1wbChvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYW4ge0BsaW5rIE9yZGVyfSBmb3IgdGhlIGdpdmVuIGZpZWxk\nIGFuZCBkZWNsYXJhdGlvbi4gVGhpcwogICAgICogbWV0aG9kIGRlbGVnYXRl\ncyB0byB7QGxpbmsgI25ld1JlbGF0ZWRGaWVsZE9yZGVyfSBhbmQKICAgICAq\nIHtAbGluayAjbmV3VmFsdWVGaWVsZE9yZGVyfSBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3T3JkZXIoRmllbGRNZXRhRGF0\nYSBvd25lciwgU3RyaW5nIG5hbWUsIGJvb2xlYW4gYXNjKSB7CiAgICAgICAg\nLy8gcGF0aHMgY2FuIHN0YXJ0IHdpdGggKG9yIGVxdWFsKSAnI2VsZW1lbnQn\nCiAgICAgICAgaWYgKG5hbWUuc3RhcnRzV2l0aChPcmRlci5FTEVNRU5UKSkK\nICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKE9yZGVyLkVMRU1F\nTlQubGVuZ3RoKCkpOwogICAgICAgIGlmIChuYW1lLmxlbmd0aCgpID09IDAp\nCiAgICAgICAgICAgIHJldHVybiBuZXdWYWx1ZU9yZGVyKG93bmVyLCBhc2Mp\nOwoKICAgICAgICAvLyBuZXh0IHRva2VuIHNob3VsZCBiZSAnLicKICAgICAg\nICBpZiAobmFtZS5jaGFyQXQoMCkgPT0gJy4nKQogICAgICAgICAgICBuYW1l\nID0gbmFtZS5zdWJzdHJpbmcoMSk7CgogICAgICAgIC8vIHJlbGF0ZWQgZmll\nbGQKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBvd25lci5nZXRFbGVt\nZW50KCkuZ2V0VHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub25wYy1maWVsZC1vcmRlcmFibGUiLAogICAgICAgICAg\nICAgICAgb3duZXIsIG5hbWUpKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIHJl\nbCA9IG1ldGEuZ2V0RmllbGQobmFtZSk7CiAgICAgICAgaWYgKHJlbCA9PSBu\ndWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1maWVsZC1vcmRlcmFibGUiLAogICAgICAgICAgICAg\nICAgb3duZXIsIG5hbWUpKTsKICAgICAgICByZXR1cm4gbmV3UmVsYXRlZEZp\nZWxkT3JkZXIob3duZXIsIHJlbCwgYXNjKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE9yZGVyIGJ5IHRoZSBmaWVsZCB2YWx1ZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIE9yZGVyIG5ld1ZhbHVlT3JkZXIoRmllbGRNZXRhRGF0YSBvd25l\nciwgYm9vbGVhbiBhc2MpIHsKICAgICAgICByZXR1cm4gbmV3IEluTWVtb3J5\nVmFsdWVPcmRlcihhc2MpOwogICAgfQoKICAgIC8qKgogICAgICogT3JkZXIg\nYnkgYSBmaWVsZCBvZiB0aGUgcmVsYXRlZCB0eXBlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgT3JkZXIgbmV3UmVsYXRlZEZpZWxkT3JkZXIoRmllbGRNZXRh\nRGF0YSBvd25lciwKICAgICAgICBGaWVsZE1ldGFEYXRhIHJlbCwgYm9vbGVh\nbiBhc2MpIHsKICAgICAgICByZXR1cm4gbmV3IEluTWVtb3J5UmVsYXRlZEZp\nZWxkT3JkZXIocmVsLCBhc2MpOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGFuIGFycmF5IG9mIG9yZGVycyBvZiB0aGUgZ2l2ZW4gc2l6ZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIE9yZGVyW10gbmV3T3JkZXJBcnJheShpbnQg\nc2l6ZSkgewogICAgICAgIHJldHVybiBuZXcgT3JkZXJbc2l6ZV07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBtZXRhZGF0YSBpbnN0YW5jZSBm\ncm9tIHRoZSByZXBvc2l0b3J5LgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gdGhpcyByZXBvc2l0b3J5\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFEYXRhKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gcmVt\nb3ZlTWV0YURhdGEobWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVtb3ZlIGEgbWV0YWRhdGEgaW5zdGFuY2UgZnJv\nbSB0aGUgcmVwb3NpdG9yeS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUg\naWYgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHRoaXMgcmVwb3NpdG9yeQog\nICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3Zl\nTWV0YURhdGEoQ2xhc3MgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9tZXRh\ncy5yZW1vdmUoY2xzKSAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzIGlt\ncGwgPSAoQ2xhc3MpIF9pZmFjZXMucmVtb3ZlKGNscyk7CiAgICAgICAgICAg\nIGlmIChpbXBsICE9IG51bGwpCiAgICAgICAgICAgICAgICBfbWV0YXMucmVt\nb3ZlKGltcGwpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIHRoZSBnaXZlbiBtZXRhZGF0YSBhcyBkZWNsYXJlZCBpbnRlcmZhY2Ug\naW1wbGVtZW50YXRpb24uCiAgICAgKi8KICAgIHZvaWQgYWRkRGVjbGFyZWRJ\nbnRlcmZhY2VJbXBsKENsYXNzTWV0YURhdGEgbWV0YSwgQ2xhc3MgaWZhY2Up\nIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pbXBscykgewogICAgICAgICAg\nICBDb2xsZWN0aW9uIHZhbHMgPSAoQ29sbGVjdGlvbikgX2ltcGxzLmdldChp\nZmFjZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjaGVjayB0byBz\nZWUgaWYgdGhlIHN1cGVyY2xhc3MgYWxyZWFkeSBkZWNsYXJlcyB0byBhdm9p\nZCBkdXBzCiAgICAgICAgICAgIGlmICh2YWxzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgZm9yICg7IHN1cCAh\nPSBudWxsOyBzdXAgPSBzdXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkK\nICAgICAgICAgICAgICAgICAgICBpZiAodmFscy5jb250YWlucyhzdXAuZ2V0\nRGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlv\nbihfaW1wbHMsIGlmYWNlLCBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgZmFs\nc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\naW1wbGVtZW50YXRpb24gZm9yIHRoZSBnaXZlbiBtYW5hZ2VkIGludGVyZmFj\nZS4KICAgICAqLwogICAgc3luY2hyb25pemVkIHZvaWQgc2V0SW50ZXJmYWNl\nSW1wbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzIGltcGwpIHsKICAgICAg\nICBpZiAoIW1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1h\nbmFnZWQtaW50ZXJmYWNlIiwgCiAgICAgICAgICAgICAgICBtZXRhLCBpbXBs\nKSk7CiAgICAgICAgX2lmYWNlcy5wdXQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIGltcGwpOwogICAgICAgIF9tZXRhcy5wdXQoaW1wbCwgbWV0YSk7CiAg\nICAgICAgYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsKG1ldGEsIG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9\nIG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICB3aGls\nZSAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gcmVjb3JkIHN1cGVy\nY2xhc3MgaW50ZXJmYWNlIGluZm8gd2hpbGUgd2UgY2FuIGFzIHdlbGwgYXMg\nd2UKICAgICAgICAgICAgLy8gd2lsbCBvbmx5IHJlZ2lzdGVyIGNvbmNyZXRl\nIHN1cGVyY2xhc3MgaW4gUENSZWdpc3RyeQogICAgICAgICAgICBzdXAuY2xl\nYXJTdWJjbGFzc0NhY2hlKCk7CiAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlv\nbihfc3Vicywgc3VwLmdldERlc2NyaWJlZFR5cGUoKSwgaW1wbCwgdHJ1ZSk7\nCiAgICAgICAgICAgIHN1cCA9IChDbGFzc01ldGFEYXRhKSBzdXAuZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAg\nIHN5bmNocm9uaXplZCBJbnRlcmZhY2VJbXBsR2VuZXJhdG9yIGdldEltcGxH\nZW5lcmF0b3IoKSB7CiAgICAgICAgaWYgKF9pbXBsR2VuID09IG51bGwpCiAg\nICAgICAgICAgIF9pbXBsR2VuID0gbmV3IEludGVyZmFjZUltcGxHZW5lcmF0\nb3IodGhpcyk7CiAgICAgICAgcmV0dXJuIF9pbXBsR2VuOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBsZWFzdC1kZXJpdmVkIGNsYXNzIG1l\ndGFkYXRhIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24KICAgICAqIGlkZW50\naXR5IG9iamVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0gb2lkIHRoZSBvaWQg\ndG8gZ2V0IHRoZSBtZXRhZGF0YSBmb3IKICAgICAqIEBwYXJhbSBlbnZMb2Fk\nZXIgdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkKICAg\nICAqIEBwYXJhbSBtdXN0RXhpc3QgaWYgdHJ1ZSwgdGhyb3dzIGEge0BsaW5r\nIE1ldGFEYXRhRXhjZXB0aW9ufQogICAgICogaWYgbm8gbWV0YWRhdGEgaXMg\nZm91bmQKICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0\nYURhdGEoT2JqZWN0IG9pZCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLAogICAg\nICAgIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKG9pZCA9PSBu\ndWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwgIj8i\nLAogICAgICAgICAgICAgICAgX29pZHMpKTsKICAgICAgICBpZiAob2lkID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAo\nb2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkKSB7CiAgICAgICAgICAgIENsYXNz\nIGNscyA9ICgoT3BlbkpQQUlkKSBvaWQpLmdldFR5cGUoKTsKICAgICAgICAg\nICAgcmV0dXJuIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhp\nc3QpOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAg\nICBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAg\nICBDbGFzcyBjbHMgPSAoQ2xhc3MpIF9vaWRzLmdldChvaWQuZ2V0Q2xhc3Mo\nKSk7CiAgICAgICAgaWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7Cgog\nICAgICAgIC8vIG1heWJlIHRoaXMgaXMgc29tZSB0eXBlIHdlJ3ZlIHNlZW4g\nYnV0IGp1c3QgaXNuJ3QgdmFsaWQKICAgICAgICBpZiAoX29pZHMuY29udGFp\nbnNLZXkob2lkLmdldENsYXNzKCkpKSB7CiAgICAgICAgICAgIGlmIChtdXN0\nRXhpc3QpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLW9pZC1tZXRhIiwgb2lkLAogICAgICAgICAg\nICAgICAgICAgIG9pZC5nZXRDbGFzcygpLCBfb2lkcykpOwogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHN0aWxs\nIG5vdCBtYXRjaCwgcmVnaXN0ZXIgYW55IGNsYXNzZXMgdGhhdCBsb29rIHNp\nbWlsYXIgdG8gdGhlCiAgICAgICAgLy8gb2lkIGNsYXNzIGFuZCBjaGVjayBh\nZ2FpbgogICAgICAgIHJlc29sdmVJZGVudGl0eUNsYXNzKG9pZCk7CiAgICAg\nICAgaWYgKHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpLmxl\nbmd0aCA+IDApIHsKICAgICAgICAgICAgY2xzID0gKENsYXNzKSBfb2lkcy5n\nZXQob2lkLmdldENsYXNzKCkpOwogICAgICAgICAgICBpZiAoY2xzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGEoY2xzLCBl\nbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQoKICAgICAgICAvLyBy\nZWNvcmQgdGhhdCB0aGlzIGlzIGFuIGludmFsaWQgdHlwZQogICAgICAgIF9v\naWRzLnB1dChvaWQuZ2V0Q2xhc3MoKSwgbnVsbCk7CgogICAgICAgIGlmICgh\nbXVzdEV4aXN0KQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW9pZC1t\nZXRhIiwgb2lkLAogICAgICAgICAgICBvaWQuZ2V0Q2xhc3MoKSwgX29pZHMp\nLCBvaWQpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBzb21lIGd1ZXNz\nZXMgYWJvdXQgdGhlIG5hbWUgb2YgYSB0YXJnZXQgY2xhc3MgZm9yIGFuCiAg\nICAgKiB1bmtub3duIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZUlkZW50aXR5Q2xhc3MoT2Jq\nZWN0IG9pZCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBDbGFzcyBvaWRDbGFzcyA9IG9pZC5nZXRD\nbGFzcygpOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInJlc29sdmUtaWRlbnRp\ndHkiLCBvaWRDbGFzcykpOwoKICAgICAgICBDbGFzc0xvYWRlciBjbCA9IG9p\nZENsYXNzLmdldENsYXNzTG9hZGVyKCk7CiAgICAgICAgU3RyaW5nIGNsYXNz\nTmFtZTsKICAgICAgICB3aGlsZSAob2lkQ2xhc3MgIT0gbnVsbCAmJiBvaWRD\nbGFzcyAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAgICAgY2xhc3NOYW1l\nID0gb2lkQ2xhc3MuZ2V0TmFtZSgpOwoKICAgICAgICAgICAgLy8gd2UgdGFr\nZSBhIGJydXRlLWZvcmNlIGFwcHJvYWNoOiB0cnkgdG8gbG9hZCBhbGwgdGhl\nIGNsYXNzJwogICAgICAgICAgICAvLyBzdWJzdHJpbmdzLiB0aGlzIHdpbGwg\naGFuZGxlIHRoZSBmb2xsb3dpbmcgY29tbW9uIG5hbWluZyBjYXNlczoKICAg\nICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICBjb20uY29tcGFueS5NeUNs\nYXNzJElECS0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAgICAgLy8g\nICBjb20uY29tcGFueS5NeUNsYXNzSWQJLT4gY29tLmNvbXBhbnkuTXlDbGFz\ncwogICAgICAgICAgICAvLyAgIGNvbS5jb21wYW55Lk15Q2xhc3NPaWQJLT4g\nY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAvLyAgIGNvbS5jb21w\nYW55Lk15Q2xhc3NQSwktPiBjb20uY29tcGFueS5NeUNsYXNzCiAgICAgICAg\nICAgIC8vCiAgICAgICAgICAgIC8vIHRoaXMgaXNuJ3QgdGhlIGZhc3Rlc3Qg\ndGhpbmcgcG9zc2libGUsIGJ1dCB0aGlzIG1ldGhvZCB3aWxsCiAgICAgICAg\nICAgIC8vIG9ubHkgYmUgY2FsbGVkIG9uY2UgcGVyIEpWTSBwZXIgdW5rbm93\nbiBhcHAgaWQgY2xhc3MKICAgICAgICAgICAgZm9yIChpbnQgaSA9IGNsYXNz\nTmFtZS5sZW5ndGgoKTsgaSA+IDE7IGktLSkgewogICAgICAgICAgICAgICAg\naWYgKGNsYXNzTmFtZS5jaGFyQXQoaSAtIDEpID09ICcuJykKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xhc3NOYW1lLnN1YnN0\ncmluZygwLCBpKSwgdHJ1ZSwgY2wpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0gLy8gY29uc3Vt\nZSBhbGwgZXhjZXB0aW9ucwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBtb3ZlIHVwIHRoZSBPSUQgaGllcmFyY2h5CiAgICAgICAgICAgIG9pZENs\nYXNzID0gb2lkQ2xhc3MuZ2V0U3VwZXJjbGFzcygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgbGVhc3QtZGVyaXZlZCBt\nZXRhZGF0YXMgd2l0aCBzb21lIG1hcHBlZCBhc3NpZ25hYmxlIHR5cGUgdGhh\ndAogICAgICogaW1wbGVtZW50IHRoZSBnaXZlbiBjbGFzcy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gY2xzIHRoZSBjbGFzcyBvciBpbnRlcmZhY2UgdG8gcmV0\ncmlldmUgaW1wbGVtZW50b3JzIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRl\nciB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAg\nICogQHBhcmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsg\nTWV0YURhdGFFeGNlcHRpb259CiAgICAgKiBpZiBubyBtZXRhZGF0YSBpcyBm\nb3VuZAogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldElt\ncGxlbWVudG9yTWV0YURhdGFzKENsYXNzIGNscywKICAgICAgICBDbGFzc0xv\nYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAg\naWYgKGNscyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhIiwg\nY2xzKSk7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfTUVUQVM7CgogICAgICAgIC8vIGdldCBpbXBscyBvZiBn\naXZlbiBpbnRlcmZhY2UgLyBhYnN0cmFjdCBjbGFzcwogICAgICAgIGxvYWRS\nZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShlbnZMb2FkZXIpOwogICAgICAgIENv\nbGxlY3Rpb24gdmFscyA9IChDb2xsZWN0aW9uKSBfaW1wbHMuZ2V0KGNscyk7\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgIENvbGxlY3Rp\nb24gbWFwcGVkID0gbnVsbDsKICAgICAgICBpZiAodmFscyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodmFscykgewogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB2YWxzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YSA9IGdl\ndE1ldGFEYXRhKChDbGFzcykgaXRyLm5leHQoKSwgZW52TG9hZGVyLCB0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWV0YS5pc01hcHBlZCgpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHx8IG1ldGEuZ2V0TWFwcGVkUENTdWJj\nbGFzc01ldGFEYXRhcygpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGVkID0gbmV3IEFycmF5TGlzdCh2YWxzLnNpemUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZC5hZGQobWV0YSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobWFwcGVkID09IG51\nbGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEiLCBjbHMpKTsKICAgICAg\nICBpZiAobWFwcGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBFTVBU\nWV9NRVRBUzsKICAgICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgbWFw\ncGVkLnRvQXJyYXkobmV3Q2xhc3NNZXRhRGF0YUFycmF5CiAgICAgICAgICAg\nIChtYXBwZWQuc2l6ZSgpKSk7CiAgICB9CiAgICAgCiAgICAvKioKICAgICAq\nIEdldHMgdGhlIG1ldGFkYXRhIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVu\nIHBlcnNpc3RlbmNlLWF3YXJlIGNsYXNzLiAKICAgICAqIFJldHVybnMgbnVs\nbCwgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIG5vdCByZWdpc3RlcmVkIGFzIAog\nICAgICogcGVyc2lzdGVuY2UtYXdhcmUuCiAgICAgKi8KICAgIHB1YmxpYyBO\nb25QZXJzaXN0ZW50TWV0YURhdGEgZ2V0UGVyc2lzdGVuY2VBd2FyZShDbGFz\ncyBjbHMpIHsKICAgIAlyZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSlf\ncGF3YXJlcy5nZXQoY2xzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBH\nZXRzIGFsbCB0aGUgbWV0YWRhdGFzIGZvciBwZXJzaXN0ZW5jZS1hd2FyZSBj\nbGFzc2VzCiAgICAgKiAKICAgICAqIEByZXR1cm4gZW1wdHkgYXJyYXkgaWYg\nbm8gY2xhc3MgaGFzIGJlZW4gcmVnaXN0ZXJlZCBhcyBwZXJzLWF3YXJlCiAg\nICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0ZW50TWV0YURhdGFbXSBnZXRQ\nZXJzaXN0ZW5jZUF3YXJlcygpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9w\nYXdhcmVzKSB7CiAgICAgICAgICAgIGlmIChfcGF3YXJlcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gRU1QVFlfTk9OX1BFUlNJU1RFTlQ7\nCiAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhW10p\nX3Bhd2FyZXMudmFsdWVzKCkudG9BcnJheQogICAgICAgICAgICAgICAgKG5l\ndyBOb25QZXJzaXN0ZW50TWV0YURhdGFbX3Bhd2FyZXMuc2l6ZSgpXSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBj\nbGFzcyBhcyBwZXJzaXN0ZW5jZS1hd2FyZS4KICAgICAqIAogICAgICogQHBh\ncmFtIGNscyBub24tbnVsbCBhbmQgbXVzdCBub3QgYWxyZWFkZHkgYmUgYWRk\nZWQgYXMgcGVyc2l0ZW5jZS1jYXBhYmxlCiAgICAgKi8KICAgIHB1YmxpYyBO\nb25QZXJzaXN0ZW50TWV0YURhdGEgYWRkUGVyc2lzdGVuY2VBd2FyZShDbGFz\ncyBjbHMpIHsKICAgIAlpZiAoY2xzID09IG51bGwpCiAgICAJCXJldHVybiBu\ndWxsOwogICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAg\nIGlmIChfcGF3YXJlcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGEpX3Bhd2FyZXMuZ2V0\nKGNscyk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0YShjbHMp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1hd2FyZSIsIGNscykpOwogICAg\nICAgICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEgbWV0YSA9IG5ldyBOb25Q\nZXJzaXN0ZW50TWV0YURhdGEoY2xzLCB0aGlzLAogICAgICAgICAgICAgICAg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhLlRZUEVfUEVSU0lTVEVOQ0VfQVdBUkUp\nOwogICAgICAgICAgICBfcGF3YXJlcy5wdXQoY2xzLCBtZXRhKTsKICAgICAg\nICAgICAgcmV0dXJuIG1ldGE7CiAgICAJfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIGEgcGVyc2l0ZW5jZS1hd2FyZSBjbGFzcyBmcm9tIHRoZSBy\nZXBvc2l0b3J5CiAgICAgKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1v\ndmVkCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVBlcnNpc3Rl\nbmNlQXdhcmUoQ2xhc3MgY2xzKSB7CiAgICAJcmV0dXJuIF9wYXdhcmVzLnJl\nbW92ZShjbHMpICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRz\nIHRoZSBtZXRhZGF0YSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBub24t\nbWFwcGVkIGludGVyZmFjZS4KICAgICAqIFJldHVybnMgbnVsbCwgaWYgdGhl\nIGdpdmVuIGludGVyZmFjZSBpcyBub3QgcmVnaXN0ZXJlZCBhcyAKICAgICAq\nIHBlcnNpc3RlbmNlLWF3YXJlLgogICAgICovCiAgICBwdWJsaWMgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhIGdldE5vbk1hcHBlZEludGVyZmFjZShDbGFzcyBp\nZmFjZSkgewogICAgCXJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKV9u\nb25NYXBwZWQuZ2V0KGlmYWNlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBHZXRzIHRoZSBjb3JyZXNwb25kaW5nIG1ldGFkYXRhcyBmb3IgYWxsIHJl\nZ2lzdGVyZWQsIG5vbi1tYXBwZWQKICAgICAqIGludGVyZmFjZXMKICAgICAq\nIAogICAgICogQHJldHVybiBlbXB0eSBhcnJheSBpZiBubyBub24tbWFwcGVk\nIGludGVyZmFjZSBoYXMgYmVlbiByZWdpc3RlcmVkLgogICAgICovCiAgICBw\ndWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gZ2V0Tm9uTWFwcGVkSW50\nZXJmYWNlcygpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9ub25NYXBwZWQp\nIHsKICAgICAgICAgICAgaWYgKF9ub25NYXBwZWQuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX05PTl9QRVJTSVNURU5UOwogICAg\nICAgICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdKV9ub25N\nYXBwZWQudmFsdWVzKCkudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBO\nb25QZXJzaXN0ZW50TWV0YURhdGFbX25vbk1hcHBlZC5zaXplKCldKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIG5v\nbi1tYXBwZWQgaW50ZXJmYWNlIHRvIHRoZSByZXBvc2l0b3J5LgogICAgICog\nCiAgICAgKiBAcGFyYW0gaWZhY2UgdGhlIG5vbi1tYXBwZWQgaW50ZXJmYWNl\nCiAgICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0ZW50TWV0YURhdGEgYWRk\nTm9uTWFwcGVkSW50ZXJmYWNlKENsYXNzIGlmYWNlKSB7CiAgICAJaWYgKGlm\nYWNlID09IG51bGwpCiAgICAJCXJldHVybiBudWxsOwogICAgICAgIGlmICgh\naWZhY2UuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qtbm9uLW1hcHBlZCIsIGlm\nYWNlKSk7CiAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAg\nICAgaWYgKF9ub25NYXBwZWQuY29udGFpbnNLZXkoaWZhY2UpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGEpX25vbk1h\ncHBlZC5nZXQoaWZhY2UpOwogICAgICAgICAgICBpZiAoZ2V0Q2FjaGVkTWV0\nYURhdGEoaWZhY2UpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vbi1tYXBwZWQtcGMi\nLCBpZmFjZSkpOwogICAgICAgICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEg\nbWV0YSA9IG5ldyBOb25QZXJzaXN0ZW50TWV0YURhdGEoaWZhY2UsIHRoaXMs\nCiAgICAgICAgICAgICAgICBOb25QZXJzaXN0ZW50TWV0YURhdGEuVFlQRV9O\nT05fTUFQUEVEX0lOVEVSRkFDRSk7CiAgICAgICAgICAgIF9ub25NYXBwZWQu\ncHV0KGlmYWNlLCBtZXRhKTsKICAgICAgICAgICAgcmV0dXJuIG1ldGE7CiAg\nICAJfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgbm9uLW1hcHBl\nZCBpbnRlcmZhY2UgZnJvbSB0aGUgcmVwb3NpdG9yeQogICAgICogCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVOb25NYXBwZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2Up\nIHsKICAgIAlyZXR1cm4gX25vbk1hcHBlZC5yZW1vdmUoaWZhY2UpICE9IG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciB0aGUgY2FjaGUgb2Yg\ncGFyc2VkIG1ldGFkYXRhLiBUaGlzIG1ldGhvZCBhbHNvIGNsZWFycyB0aGUK\nICAgICAqIGludGVybmFsIHtAbGluayBNZXRhRGF0YUZhY3RvcnkgTWV0YURh\ndGFGYWN0b3J5fSdzIGNhY2hlLgogICAgICovCiAgICBwdWJsaWMgc3luY2hy\nb25pemVkIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgi\nY2xlYXItcmVwb3MiLCB0aGlzKSk7CgogICAgICAgIF9tZXRhcy5jbGVhcigp\nOwogICAgICAgIF9vaWRzLmNsZWFyKCk7CiAgICAgICAgX3N1YnMuY2xlYXIo\nKTsKICAgICAgICBfaW1wbHMuY2xlYXIoKTsKICAgICAgICBfcXVlcmllcy5j\nbGVhcigpOwogICAgICAgIF9zZXFzLmNsZWFyKCk7CiAgICAgICAgX3JlZ2lz\ndGVyZWQuY2xlYXIoKTsKICAgICAgICBfZmFjdG9yeS5jbGVhcigpOwogICAg\nICAgIF9hbGlhc2VzLmNsZWFyKCk7CiAgICAgICAgX3Bhd2FyZXMuY2xlYXIo\nKTsKICAgICAgICBfbm9uTWFwcGVkLmNsZWFyKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHNldCBvZiBjb25maWd1cmVkIHBlcnNpc3Rl\nbnQgY2xhc3Nlcywgb3IgbnVsbCBpZiB0aGUgdXNlcgogICAgICogZGlkIG5v\ndCBjb25maWd1cmUgYW55LgogICAgICoKICAgICAqIEBwYXJhbSBkZXZwYXRo\nIGlmIHRydWUsIHNlYXJjaCBmb3IgbWV0YWRhdGEgZmlsZXMgaW4gZGlyZWN0\nb3JpZXMKICAgICAqIGluIHRoZSBjbGFzc3BhdGggaWYgbm8gY2xhc3NlcyBh\ncmUgY29uZmlndXJlZCBleHBsaWNpdGx5CiAgICAgKiBAcGFyYW0gZW52TG9h\nZGVyIHRoZSBjbGFzcyBsb2FkZXIgdG8gdXNlLCBvciBudWxsIGZvciBkZWZh\ndWx0CiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgU2V0IGdldFBl\ncnNpc3RlbnRUeXBlTmFtZXMoYm9vbGVhbiBkZXZwYXRoLAogICAgICAgIENs\nYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIHJldHVybiBfZmFjdG9y\neS5nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGRldnBhdGgsIGVudkxvYWRlcik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBwZXJzaXN0ZW50IGNs\nYXNzZXMgbmFtZWQgaW4gY29uZmlndXJhdGlvbi4KICAgICAqIFRoaXMgZW5z\ndXJlcyB0aGF0IGFsbCBzdWJjbGFzc2VzIGFuZCBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzc2VzIG9mCiAgICAgKiBlYWNoIHR5cGUgYXJlIGtub3duIGlu\nIGFkdmFuY2UsIHdpdGhvdXQgaGF2aW5nIHRvIHJlbHkgb24gdGhlCiAgICAg\nKiBhcHBsaWNhdGlvbiBsb2FkaW5nIHRoZSBjbGFzc2VzIGJlZm9yZSBwZXJm\nb3JtaW5nIG9wZXJhdGlvbnMgdGhhdAogICAgICogbWlnaHQgaW52b2x2ZSB0\naGVtLgogICAgICoKICAgICAqIEBwYXJhbSBkZXZwYXRoIGlmIHRydWUsIHNl\nYXJjaCBmb3IgbWV0YWRhdGEgZmlsZXMgaW4gZGlyZWN0b3JpZXMKICAgICAq\nIGluIHRoZSBjbGFzc3BhdGggaWYgdGhlIG5vIGNsYXNzZXMgYXJlIGNvbmZp\nZ3VyZWQgZXhwbGljaXRseQogICAgICogQHBhcmFtIGVudkxvYWRlciB0aGUg\nY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3IgbnVsbCBmb3IgZGVmYXVsdAogICAg\nICogQHJldHVybiB0aGUgbG9hZGVkIGNsYXNzZXMsIG9yIGVtcHR5IGNvbGxl\nY3Rpb24gaWYgbm9uZQogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVk\nIENvbGxlY3Rpb24gbG9hZFBlcnNpc3RlbnRUeXBlcyhib29sZWFuIGRldnBh\ndGgsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAg\nU2V0IG5hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhkZXZwYXRoLCBl\nbnZMb2FkZXIpOwogICAgICAgIGlmIChuYW1lcyA9PSBudWxsIHx8IG5hbWVz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVN\nUFRZX0xJU1Q7CgogICAgICAgIC8vIGF0dGVtcHQgdG8gbG9hZCBjbGFzc2Vz\nIHNvIHRoYXQgdGhleSBnZXQgcHJvY2Vzc2VkCiAgICAgICAgQ2xhc3NMb2Fk\nZXIgY2xzTG9hZGVyID0gX2NvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNl\nKCkuCiAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKGdldENsYXNzKCksIGVu\ndkxvYWRlcik7CiAgICAgICAgTGlzdCBjbGFzc2VzID0gbmV3IEFycmF5TGlz\ndChuYW1lcy5zaXplKCkpOwogICAgICAgIENsYXNzIGNsczsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IG5hbWVzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGNscyA9IGNsYXNzRm9yTmFtZSgoU3Ry\naW5nKSBpdHIubmV4dCgpLCBjbHNMb2FkZXIpOwogICAgICAgICAgICBpZiAo\nY2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICBjbGFzc2VzLmFkZChjbHMp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xhc3NlczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY2xhc3MgZm9yIHRoZSBnaXZlbiBu\nYW1lLCBvciBudWxsIGlmIG5vdCBsb2FkYWJsZS4KICAgICAqLwogICAgcHJp\ndmF0ZSBDbGFzcyBjbGFzc0Zvck5hbWUoU3RyaW5nIG5hbWUsIENsYXNzTG9h\nZGVyIGxvYWRlcikgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBDbGFzcy5mb3JOYW1lKG5hbWUsIHRydWUsIGxvYWRlcik7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKChfdmFs\naWRhdGUgJiBWQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAg\nICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3Mi\nLCBuYW1lKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX2xvZy5pc0luZm9F\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLmluZm8oX2xvYy5nZXQo\nImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5hbWUpKTsKICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBrbm93biBzdWJjbGFzc2Vz\nIGZvciB0aGUgZ2l2ZW4gY2xhc3MgbWFwcGluZy4gTm90ZQogICAgICogdGhh\ndCB0aGlzIG1ldGhvZCBvbmx5IHdvcmtzIGR1cmluZyBydW50aW1lIHdoZW4g\ndGhlIHJlcG9zaXRvcnkgaXMKICAgICAqIHJlZ2lzdGVyZWQgYXMgYSB7QGxp\nbmsgUmVnaXN0ZXJDbGFzc0xpc3RlbmVyfS4KICAgICAqLwogICAgQ29sbGVj\ndGlvbiBnZXRQQ1N1YmNsYXNzZXMoQ2xhc3MgY2xzKSB7CiAgICAgICAgQ29s\nbGVjdGlvbiBzdWJzID0gKENvbGxlY3Rpb24pIF9zdWJzLmdldChjbHMpOwog\nICAgICAgIGlmIChzdWJzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgICAgIHJldHVybiBzdWJzOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIFJlZ2lzdGVyQ2xhc3NMaXN0ZW5lciBpbXBsZW1lbnRh\ndGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVyKENsYXNzIGNscykgewog\nICAgICAgIC8vIGJ1ZmZlciByZWdpc3RlcmVkIGNsYXNzZXMgdW50aWwgYW4g\nb2lkIG1ldGFkYXRhIHJlcXVlc3QgaXMgbWFkZSwKICAgICAgICAvLyBhdCB3\naGljaCBwb2ludCB3ZSdsbCBwYXJzZSBldmVyeXRoaW5nIGluIHRoZSBidWZm\nZXIKICAgICAgICBzeW5jaHJvbml6ZWQgKF9yZWdpc3RlcmVkKSB7CiAgICAg\nICAgICAgIF9yZWdpc3RlcmVkLmFkZChjbHMpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlcyB0aGUgbWV0YWRhdGEgZm9yIGFsbCBy\nZWdpc3RlcmVkIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBs\nb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoQ2xhc3NMb2FkZXIgZW52TG9h\nZGVyKSB7CiAgICAgICAgQ2xhc3NbXSByZWcgPSBwcm9jZXNzUmVnaXN0ZXJl\nZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHJlZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgZ2V0TWV0YURhdGEocmVnW2ldLCBlbnZMb2FkZXIsIGZh\nbHNlKTsKICAgICAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFFeGNlcHRpb24g\nbWUpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4obWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRl\ncyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0aGUgbGF0ZXN0IHJlZ2lzdGVy\nZWQgY2xhc3Nlcy4KICAgICAqLwogICAgQ2xhc3NbXSBwcm9jZXNzUmVnaXN0\nZXJlZENsYXNzZXMoQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAg\naWYgKF9yZWdpc3RlcmVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIEVNUFRZX0NMQVNTRVM7CgogICAgICAgIC8vIGNvcHkgaW50byBuZXcgY29s\nbGVjdGlvbiB0byBhdm9pZCBjb25jdXJyZW50IG1vZCBlcnJvcnMgb24gcmVl\nbnRyYW50CiAgICAgICAgLy8gcmVnaXN0cmF0aW9ucwogICAgICAgIENsYXNz\nW10gcmVnOwogICAgICAgIHN5bmNocm9uaXplZCAoX3JlZ2lzdGVyZWQpIHsK\nICAgICAgICAgICAgcmVnID0gKENsYXNzW10pIF9yZWdpc3RlcmVkLnRvQXJy\nYXkobmV3IENsYXNzW19yZWdpc3RlcmVkLnNpemUoKV0pOwogICAgICAgICAg\nICBfcmVnaXN0ZXJlZC5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAgQ29s\nbGVjdGlvbiBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxz\nZSwgZW52TG9hZGVyKTsKICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51\nbGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZWcubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgLy8gZG9uJ3QgcHJvY2VzcyB0eXBlcyB0aGF0\nIGFyZW4ndCBsaXN0ZWQgYnkgdGhlIHVzZXI7IG1heSBiZWxvbmcKICAgICAg\nICAgICAgLy8gdG8gYSBkaWZmZXJlbnQgcGVyc2lzdGVuY2UgdW5pdAogICAg\nICAgICAgICBpZiAocGNOYW1lcyAhPSBudWxsICYmICFwY05hbWVzLmlzRW1w\ndHkoKQogICAgICAgICAgICAgICAgJiYgIXBjTmFtZXMuY29udGFpbnMocmVn\nW2ldLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBwcm9jZXNzUmVnaXN0\nZXJlZENsYXNzKHJlZ1tpXSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICBpZiAoIV9jb25mLmdldFJldHJ5\nQ2xhc3NSZWdpc3RyYXRpb24oKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVycm9yLXJlZ2lz\ndGVyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICByZWdbaV0pLCB0KTsK\nCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJmYWlsZWQt\ncmVnaXN0ZXJlZCIsIHJlZ1tpXSksIHQpOwogICAgICAgICAgICAgICAgaWYg\nKGZhaWxlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZhaWxlZCA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIGZhaWxlZC5hZGQo\ncmVnW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAo\nZmFpbGVkICE9IG51bGwpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChf\ncmVnaXN0ZXJlZCkgewogICAgICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRk\nQWxsKGZhaWxlZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJlZzsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgb3Vy\nIGRhdGFzdHJ1Y3R1cmVzIHdpdGggdGhlIGdpdmVuIHJlZ2lzdGVyZWQgY2xh\nc3MuCiAgICAgKiBSZWxpZXMgb24gdGhlIGZhY3QgdGhhdCBhIGNoaWxkIGNs\nYXNzIGNhbm5vdCByZWdpc3RlciBpdHNlbGYgd2l0aG91dAogICAgICogYWxz\nbyByZWdpc3RlcmluZyBpdHMgcGFyZW50IGNsYXNzIGJ5IHNwZWNpZnlpbmcg\naXRzIHBlcnNpc3RlbmNlCiAgICAgKiBjYXBhYmxlIHN1cGVyY2xhc3MgaW4g\ndGhlIHJlZ2lzdHJhdGlvbiBldmVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3MoQ2xhc3MgY2xzKSB7CiAgICAg\nICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgicHJvY2Vzcy1yZWdpc3RlcmVkIiwgY2xzKSk7\nCgogICAgICAgIC8vIHVwZGF0ZSBzdWJjbGFzcyBsaXN0czsgc3luY2hyb25p\nemUgb24gdGhpcyBiZWNhdXNlIGFjY2Vzc2luZyBfbWV0YXMKICAgICAgICAv\nLyByZXF1aXJlcyBpdAogICAgICAgIENsYXNzIGxlYXN0RGVyaXZlZCA9IGNs\nczsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAgICBmb3IgKENsYXNzIGFu\nYyA9IGNsczsKICAgICAgICAgICAgICAgIChhbmMgPSBQQ1JlZ2lzdHJ5Lmdl\ndFBlcnNpc3RlbnRTdXBlcmNsYXNzKGFuYykpICE9IG51bGw7KSB7CiAgICAg\nICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIGFuYywgY2xzLCB0\ncnVlKTsKICAgICAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkg\nX21ldGFzLmdldChhbmMpOwogICAgICAgICAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBtZXRhLmNsZWFyU3ViY2xhc3ND\nYWNoZSgpOwogICAgICAgICAgICAgICAgbGVhc3REZXJpdmVkID0gYW5jOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB1cGRhdGUgb2lk\nIG1hcHBpbmdzIGlmIHRoaXMgaXMgYSBiYXNlIGNvbmNyZXRlIGNsYXNzCiAg\nICAgICAgT2JqZWN0IG9pZCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgb2lkID0gUENSZWdpc3RyeS5uZXdPYmplY3RJZChjbHMpOwogICAg\nICAgIH0gY2F0Y2ggKEludGVybmFsRXhjZXB0aW9uIGllKSB7CiAgICAgICAg\nICAgIC8vIHRocm93biBmb3Igc2luZ2xlIGZpZWxkIGlkZW50aXR5IHdpdGgg\nbnVsbCBwayBmaWVsZCB2YWx1ZQogICAgICAgIH0KICAgICAgICBpZiAob2lk\nICE9IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3MgZXhpc3RpbmcgPSAoQ2xh\nc3MpIF9vaWRzLmdldChvaWQuZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAgIGlm\nIChleGlzdGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGVyZSBpcyBhbHJlYWR5IGEgY2xhc3MgZm9yIHRoaXMgT0lELCB0aGVuIHdl\nIGtub3cKICAgICAgICAgICAgICAgIC8vIHRoYXQgbXVsdGlwbGUgY2xhc3Nl\ncyBhcmUgdXNpbmcgdGhlIHNhbWUgT0lEOiB0aGVyZWZvcmUsCiAgICAgICAg\nICAgICAgICAvLyBwdXQgdGhlIGxlYXN0IGRlcml2ZWQgUEMgc3VwZXJjbGFz\ncyBpbnRvIHRoZSBtYXAuIFRoaXMKICAgICAgICAgICAgICAgIC8vIGdldHMg\nYXJvdW5kIHRoZSBwcm9ibGVtIG9mIGFuIGFic3RyYWN0IFBDIHN1cGVyY2xh\nc3MKICAgICAgICAgICAgICAgIC8vIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50\naXR5IChzaW5jZSBuZXdPYmplY3RJZAogICAgICAgICAgICAgICAgLy8gd2ls\nbCByZXR1cm4gbnVsbCBmb3IgYWJzdHJhY3QgY2xhc3NlcykuCiAgICAgICAg\nICAgICAgICBDbGFzcyBzdXAgPSBjbHM7CiAgICAgICAgICAgICAgICB3aGls\nZSAoUENSZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhzdXApICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgc3VwID0gUENSZWdpc3RyeS5n\nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhzdXApOwoKICAgICAgICAgICAgICAg\nIF9vaWRzLnB1dChvaWQuZ2V0Q2xhc3MoKSwgc3VwKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChleGlzdGluZyA9PSBudWxsIHx8IGNscy5pc0Fzc2lnbmFi\nbGVGcm9tKGV4aXN0aW5nKSkKICAgICAgICAgICAgICAgIF9vaWRzLnB1dChv\naWQuZ2V0Q2xhc3MoKSwgY2xzKTsKICAgICAgICB9CgogICAgICAgIC8vIHVw\nZGF0ZSBtYXBwaW5ncyBmcm9tIGludGVyZmFjZXMgYW5kIG5vbi1wYyBzdXBl\ncmNsYXNzZXMgdG8KICAgICAgICAvLyBwYyBpbXBsZW1lbnRpbmcgdHlwZXMK\nICAgICAgICBzeW5jaHJvbml6ZWQgKF9pbXBscykgewogICAgICAgICAgICB1\ncGRhdGVJbXBscyhjbHMsIGxlYXN0RGVyaXZlZCwgY2xzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHNldCBhbGlhcyBmb3IgY2xhc3MKICAgICAgICBTdHJp\nbmcgYWxpYXMgPSBQQ1JlZ2lzdHJ5LmdldFR5cGVBbGlhcyhjbHMpOwogICAg\nICAgIHN5bmNocm9uaXplZCAoX2FsaWFzZXMpIHsKICAgICAgICAgICAgTGlz\ndCBjbGFzc0xpc3QgPSAoTGlzdCkgX2FsaWFzZXMuZ2V0KGFsaWFzKTsKICAg\nICAgICAgICAgaWYgKGNsYXNzTGlzdCA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBjbGFzc0xpc3QgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAg\nICAgICAgX2FsaWFzZXMucHV0KGFsaWFzLCBjbGFzc0xpc3QpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNs\ncykpCiAgICAgICAgICAgICAgICBjbGFzc0xpc3QuYWRkKGNscyk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBsaXN0IG9m\nIGltcGxlbWVudGF0aW9ucyBvZiBiYXNlIGNsYXNzZXMgYW5kIGludGVyZmFj\nZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVJbXBscyhDbGFz\ncyBjbHMsIENsYXNzIGxlYXN0RGVyaXZlZCwgQ2xhc3MgY2hlY2spIHsKICAg\nICAgICAvLyBhbGxvdyB1c2VycyB0byBxdWVyeSBvbiBjb21tb24gbm9uLXBj\nIHN1cGVyY2xhc3NlcwogICAgICAgIENsYXNzIHN1cCA9IGNoZWNrLmdldFN1\ncGVyY2xhc3MoKTsKICAgICAgICBpZiAobGVhc3REZXJpdmVkID09IGNscyAm\nJiBzdXAgIT0gbnVsbCAmJiBzdXAgIT0gT2JqZWN0LmNsYXNzKSB7CiAgICAg\nICAgICAgIGFkZFRvQ29sbGVjdGlvbihfaW1wbHMsIHN1cCwgY2xzLCBmYWxz\nZSk7CiAgICAgICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVhc3REZXJpdmVk\nLCBzdXApOwogICAgICAgIH0KCiAgICAgICAgLy8gYWxsb3cgdXNlcnMgdG8g\ncXVlcnkgb24gYW55IGltcGxlbWVudGVkIGludGVyZmFjZXMgdW5sZXNzIGRl\nZmF1bHRzIAogICAgICAgIC8vIHNheSB0aGUgdXNlciBtdXN0IGltcGxlbWVu\ndCBwZXJzaXN0ZW50IGludGVyZmFjZXMgZXhwbGljaXRseSBpbiBtZXRhCiAg\nICAgICAgaWYgKCFfZmFjdG9yeS5nZXREZWZhdWx0cygpLmlzRGVjbGFyZWRJ\nbnRlcmZhY2VQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBDbGFzc1tdIGludHMgPSBjaGVjay5nZXRJbnRlcmZhY2VzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpbnRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIC8vIGRvbid0IG1hcCBqYXZhLXN0YW5kYXJkIGludGVy\nZmFjZXMKICAgICAgICAgICAgaWYgKGludHNbaV0uZ2V0TmFtZSgpLnN0YXJ0\nc1dpdGgoImphdmEuIikpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIC8vIG9ubHkgbWFwIGxlYXN0LWRlcml2ZWQgaW50ZXJmYWNl\nIGltcGxlbWVudG9ycwogICAgICAgICAgICBpZiAobGVhc3REZXJpdmVkID09\nIGNscyB8fCBpc0xlYXN0RGVyaXZlZEltcGwoaW50c1tpXSwgY2xzKSkgewog\nICAgICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uKF9pbXBscywgaW50c1tp\nXSwgY2xzLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB1cGRhdGVJbXBscyhj\nbHMsIGxlYXN0RGVyaXZlZCwgaW50c1tpXSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGUgZ2l2ZW4gY2xhc3MgaXMgdGhlIGxlYXN0LWRlcml2ZWQgcGVyc2lzdGVu\ndAogICAgICogaW1wbGVtZW50b3Igb2YgdGhlIGdpdmVuIGludGVyZmFjZSwg\nZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\naXNMZWFzdERlcml2ZWRJbXBsKENsYXNzIGludGVyLCBDbGFzcyBjbHMpIHsK\nICAgICAgICBDbGFzcyBwYXJlbnQgPSBQQ1JlZ2lzdHJ5LmdldFBlcnNpc3Rl\nbnRTdXBlcmNsYXNzKGNscyk7CiAgICAgICAgd2hpbGUgKHBhcmVudCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChBcnJheXMuYXNMaXN0KHBhcmVudC5n\nZXRJbnRlcmZhY2VzKCkpLmNvbnRhaW5zKGludGVyKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcGFyZW50ID0gUENSZWdp\nc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhwYXJlbnQpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhlIGNvbGxlY3Rpb24gY2FjaGVk\nIGluIHRoZSBnaXZlbiBtYXAgdW5kZXIKICAgICAqIHRoZSBnaXZlbiBrZXku\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRUb0NvbGxlY3Rpb24oTWFw\nIG1hcCwgQ2xhc3Mga2V5LCBDbGFzcyB2YWx1ZSwKICAgICAgICBib29sZWFu\nIGluaGVyaXRhbmNlKSB7CiAgICAgICAgc3luY2hyb25pemVkIChtYXApIHsK\nICAgICAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gKENvbGxlY3Rpb24pIG1h\ncC5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKGNvbGwgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKGluaGVyaXRhbmNlKSB7CiAgICAgICAgICAg\nICAgICAgICAgSW5oZXJpdGFuY2VDb21wYXJhdG9yIGNvbXAgPSBuZXcgSW5o\nZXJpdGFuY2VDb21wYXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgY29t\ncC5zZXRCYXNlKGtleSk7CiAgICAgICAgICAgICAgICAgICAgY29sbCA9IG5l\ndyBUcmVlU2V0KGNvbXApOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgY29sbCA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAg\nICAgICAgICAgICBtYXAucHV0KGtleSwgY29sbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgY29sbC5hZGQodmFsdWUpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBD\nb25maWd1cmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1\ncmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0g\nKE9wZW5KUEFDb25maWd1cmF0aW9uKSBjb25mOwogICAgICAgIF9sb2cgPSBf\nY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX01FVEFEQVRB\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3VyYXRpb24o\nKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJhdGlvbigp\nIHsKICAgICAgICBpbml0aWFsaXplTWV0YURhdGFGYWN0b3J5KCk7CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVNZXRhRGF0YUZhY3Rvcnko\nKSB7CiAgICAgICAgaWYgKF9mYWN0b3J5ID09IG51bGwpIHsKICAgICAgICAg\nICAgTWV0YURhdGFGYWN0b3J5IG1kZiA9IF9jb25mLm5ld01ldGFEYXRhRmFj\ndG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmIChtZGYgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbWV0YWRhdGFmYWN0b3J5IikpOwogICAgICAgICAgICBz\nZXRNZXRhRGF0YUZhY3RvcnkobWRmKTsKICAgICAgICB9CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBtZXRhZGF0YQogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gcXVl\ncnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcywgbmFtZSwgYW5kIGNs\nYXNzbG9hZGVyLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFF1\nZXJ5TWV0YURhdGEgZ2V0UXVlcnlNZXRhRGF0YShDbGFzcyBjbHMsIFN0cmlu\nZyBuYW1lLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVh\nbiBtdXN0RXhpc3QpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEgPSBn\nZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIp\nOwogICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgLy8g\nbG9hZCBhbGwgdGhlIG1ldGFkYXRhcyBmb3IgYWxsIHRoZSBrbm93biBjbGFz\nc2VzIHNvIHRoYXQKICAgICAgICAgICAgLy8gcXVlcnkgbmFtZXMgYXJlIHNl\nZW4gYW5kIHJlZ2lzdGVyZWQKICAgICAgICAgICAgcmVzb2x2ZUFsbChlbnZM\nb2FkZXIpOwogICAgICAgICAgICBtZXRhID0gZ2V0UXVlcnlNZXRhRGF0YUlu\ndGVybmFsKGNscywgbmFtZSwgZW52TG9hZGVyKTsKICAgICAgICB9CgogICAg\nICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KSB7CiAgICAgICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAgICAgKCJuby1uYW1lZC1xdWVyeS1udWxsLWNsYXNzIiwgCiAgICAgICAg\nICAgICAgICAgICAgICAgIGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2Us\nIGVudkxvYWRlciksIG5hbWUpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgibm8tbmFtZWQtcXVlcnkiLAogICAgICAgICAgICAgICAgICAgIGNs\ncywgbmFtZSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBy\nZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKiogCiAgICAgKiBSZXNvbHZlIGFs\nbCBrbm93biBtZXRhZGF0YSBjbGFzc2VzLiAKICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHJlc29sdmVBbGwoQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAg\nICAgICAgQ29sbGVjdGlvbiB0eXBlcyA9IGxvYWRQZXJzaXN0ZW50VHlwZXMo\nZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgZm9yIChJdGVyYXRvciBpID0g\ndHlwZXMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7ICkgewogICAgICAgICAg\nICBDbGFzcyBjID0gKENsYXNzKSBpLm5leHQoKTsKICAgICAgICAgICAgZ2V0\nTWV0YURhdGEoYywgZW52TG9hZGVyLCBmYWxzZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHF1ZXJ5IG1ldGFkYXRhIGZvciB0\naGUgZ2l2ZW4gY2xhc3MsIG5hbWUsIGFuZCBjbGFzc2xvYWRlci4KICAgICAq\nLwogICAgcHJpdmF0ZSBRdWVyeU1ldGFEYXRhIGdldFF1ZXJ5TWV0YURhdGFJ\nbnRlcm5hbChDbGFzcyBjbHMsIFN0cmluZyBuYW1lLAogICAgICAgIENsYXNz\nTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChuYW1lID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVjayBj\nYWNoZQogICAgICAgIE9iamVjdCBrZXkgPSBnZXRRdWVyeUtleShjbHMsIG5h\nbWUpOwogICAgICAgIFF1ZXJ5TWV0YURhdGEgcW0gPSAoUXVlcnlNZXRhRGF0\nYSkgX3F1ZXJpZXMuZ2V0KGtleSk7CiAgICAgICAgaWYgKHFtICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBxbTsKCiAgICAgICAgLy8gZ2V0IG1ldGFk\nYXRhIGZvciBjbGFzcywgd2hpY2ggd2lsbCBmaW5kIHF1ZXJpZXMgaW4gbWV0\nYWRhdGEgZmlsZQogICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBnZXRNZXRh\nRGF0YShjbHMsIGVudkxvYWRlciwgZmFsc2UpICE9IG51bGwpIHsKICAgICAg\nICAgICAgcW0gPSAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0KGtleSk7\nCiAgICAgICAgICAgIGlmIChxbSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIHFtOwogICAgICAgIH0KICAgICAgICBpZiAoKF9zb3VyY2VNb2Rl\nICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIC8vIHNlZSBpZiBmYWN0b3J5IGNhbiBmaWd1cmUgb3V0IGEg\nc2NvcGUgZm9yIHRoaXMgcXVlcnkKICAgICAgICBpZiAoY2xzID09IG51bGwp\nCiAgICAgICAgICAgIGNscyA9IF9mYWN0b3J5LmdldFF1ZXJ5U2NvcGUobmFt\nZSwgZW52TG9hZGVyKTsKCiAgICAgICAgLy8gbm90IGluIGNhY2hlOyBsb2Fk\nCiAgICAgICAgX2ZhY3RvcnkubG9hZChjbHMsIE1PREVfUVVFUlksIGVudkxv\nYWRlcik7CiAgICAgICAgcmV0dXJuIChRdWVyeU1ldGFEYXRhKSBfcXVlcmll\ncy5nZXQoa2V5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgc3lu\nY2hyb25pemVkIFF1ZXJ5TWV0YURhdGFbXSBnZXRRdWVyeU1ldGFEYXRhcygp\nIHsKICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURhdGFbXSkgX3F1ZXJpZXMu\ndmFsdWVzKCkudG9BcnJheQogICAgICAgICAgICAobmV3IFF1ZXJ5TWV0YURh\ndGFbX3F1ZXJpZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGNhY2hlZCBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVu\nIG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlN\nZXRhRGF0YSBnZXRDYWNoZWRRdWVyeU1ldGFEYXRhKENsYXNzIGNscywKICAg\nICAgICBTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiAoUXVlcnlNZXRh\nRGF0YSkgX3F1ZXJpZXMuZ2V0KGdldFF1ZXJ5S2V5KGNscywgbmFtZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IHF1ZXJ5IG1ldGFkYXRh\nIHRvIHRoZSByZXBvc2l0b3J5IGFuZCByZXR1cm4gaXQuCiAgICAgKi8KICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlNZXRhRGF0YSBhZGRRdWVyeU1l\ndGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBRdWVy\neU1ldGFEYXRhIG1ldGEgPSBuZXdRdWVyeU1ldGFEYXRhKGNscywgbmFtZSk7\nCiAgICAgICAgX3F1ZXJpZXMucHV0KGdldFF1ZXJ5S2V5KG1ldGEpLCBtZXRh\nKTsKICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBxdWVyeSBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFF1ZXJ5TWV0YURhdGEgbmV3UXVlcnlNZXRhRGF0\nYShDbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgUXVlcnlNZXRh\nRGF0YSBtZXRhID0gbmV3IFF1ZXJ5TWV0YURhdGEobmFtZSk7CiAgICAgICAg\nbWV0YS5zZXREZWZpbmluZ1R5cGUoY2xzKTsKICAgICAgICByZXR1cm4gbWV0\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gcXVl\ncnkgbWV0YWRhdGEgZnJvbSB0aGUgcmVwb3NpdG9yeS4KICAgICAqLwogICAg\ncHVibGljIHN5bmNocm9uaXplZCBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURh\ndGEoUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVy\nbiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlLZXkobWV0YSkpICE9IG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgcXVlcnkgbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGlmIGluIHRoZSByZXBvc2l0b3J5\nLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVt\nb3ZlUXVlcnlNZXRhRGF0YShDbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIHJldHVybiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVlcnlL\nZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIHVuaXF1ZSBrZXkgZm9yIGEgZ2l2ZW4gUXVlcnlNZXRhRGF0\nYS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGdldFF1ZXJ5\nS2V5KFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVy\nbiBnZXRRdWVyeUtleShtZXRhLmdldERlZmluaW5nVHlwZSgpLCBtZXRhLmdl\ndE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlx\ndWUga2V5IGZvciBhIGdpdmVuIGNsYXNzIC8gbmFtZS4gVGhlIGNsYXNzCiAg\nICAgKiBhcmd1bWVudCBjYW4gYmUgbnVsbC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHN0YXRpYyBPYmplY3QgZ2V0UXVlcnlLZXkoQ2xhc3MgY2xzLCBTdHJp\nbmcgbmFtZSkgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG5hbWU7CiAgICAgICAgUXVlcnlLZXkga2V5ID0gbmV3IFF1\nZXJ5S2V5KCk7CiAgICAgICAga2V5LmNsc05hbWUgPSBjbHMuZ2V0TmFtZSgp\nOwogICAgICAgIGtleS5uYW1lID0gbmFtZTsKICAgICAgICByZXR1cm4ga2V5\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2Vx\ndWVuY2UgbWV0YWRhdGEKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogUmV0dXJuIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUg\nZ2l2ZW4gbmFtZSBhbmQgY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1ZW5jZU1l\ndGFEYXRhKFN0cmluZyBuYW1lLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxv\nYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBTZXF1ZW5jZU1l\ndGFEYXRhIG1ldGEgPSBnZXRTZXF1ZW5jZU1ldGFEYXRhSW50ZXJuYWwobmFt\nZSwgZW52TG9hZGVyKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsICYmIFNl\ncXVlbmNlTWV0YURhdGEuTkFNRV9TWVNURU0uZXF1YWxzKG5hbWUpKSB7CiAg\nICAgICAgICAgIGlmIChfc3lzU2VxID09IG51bGwpCiAgICAgICAgICAgICAg\nICBfc3lzU2VxID0gbmV3U2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAg\nICAgICAgcmV0dXJuIF9zeXNTZXE7CiAgICAgICAgfQogICAgICAgIGlmICht\nZXRhID09IG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXNlcXVl\nbmNlIiwgbmFtZSkpOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAg\nIC8qKgogICAgICogVXNlZCBpbnRlcm5hbGx5IGJ5IG1ldGFkYXRhIHRvIHJl\ndHJpZXZlIHNlcXVlbmNlIG1ldGFkYXRhcyBiYXNlZCBvbgogICAgICogcG9z\nc2libHktdW5xdWFsaWZpZWQgc2VxdWVuY2UgbmFtZS4KICAgICAqLwogICAg\nU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1ZW5jZU1ldGFEYXRhKENsYXNzTWV0\nYURhdGEgY29udGV4dCwgU3RyaW5nIG5hbWUsCiAgICAgICAgYm9vbGVhbiBt\ndXN0RXhpc3QpIHsKICAgICAgICAvLyB0cnkgd2l0aCBnaXZlbiBuYW1lCiAg\nICAgICAgTWV0YURhdGFFeGNlcHRpb24gZSA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBzZXEgPSBnZXRTZXF1\nZW5jZU1ldGFEYXRhKG5hbWUsCiAgICAgICAgICAgICAgICBjb250ZXh0Lmdl\ndEVudkNsYXNzTG9hZGVyKCksIG11c3RFeGlzdCk7CiAgICAgICAgICAgIGlm\nIChzZXEgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBzZXE7CiAg\nICAgICAgfSBjYXRjaCAoTWV0YURhdGFFeGNlcHRpb24gbWRlKSB7CiAgICAg\nICAgICAgIGUgPSBtZGU7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBnaXZl\nbiBuYW1lIGFscmVhZHkgZnVsbHkgcXVhbGlmaWVkLCBnaXZlIHVwCiAgICAg\nICAgaWYgKG5hbWUuaW5kZXhPZignLicpICE9IC0xKSB7CiAgICAgICAgICAg\nIGlmIChlICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIHRy\neSB3aXRoIHF1YWxpZmllZCBuYW1lCiAgICAgICAgbmFtZSA9IFN0cmluZ3Mu\nZ2V0UGFja2FnZU5hbWUoY29udGV4dC5nZXREZXNjcmliZWRUeXBlKCkpCiAg\nICAgICAgICAgICsgIi4iICsgbmFtZTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gZ2V0U2VxdWVuY2VNZXRhRGF0YShuYW1lLCBjb250ZXh0\nLmdldEVudkNsYXNzTG9hZGVyKCksCiAgICAgICAgICAgICAgICBtdXN0RXhp\nc3QpOwogICAgICAgIH0gY2F0Y2ggKE1ldGFEYXRhRXhjZXB0aW9uIG1kZSkg\newogICAgICAgICAgICAvLyB0aHJvdyBvcmlnaW5hbCBleGNlcHRpb24KICAg\nICAgICAgICAgaWYgKGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIGU7CiAgICAgICAgICAgIHRocm93IG1kZTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRo\nZSBnaXZlbiBuYW1lIGFuZCBjbGFzc2xvYWRlci4KICAgICAqLwogICAgcHJp\ndmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIGdldFNlcXVlbmNlTWV0YURhdGFJbnRl\ncm5hbChTdHJpbmcgbmFtZSwKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2Fk\nZXIpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgICBT\nZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSAoU2VxdWVuY2VNZXRhRGF0YSkgX3Nl\ncXMuZ2V0KG5hbWUpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAg\nICAgICAgICAgLy8gbG9hZCBtZXRhZGF0YSBmb3IgcmVnaXN0ZXJlZCBjbGFz\nc2VzIHRvIGhvcGVmdWxseSBmaW5kIHNlcXVlbmNlCiAgICAgICAgICAgIC8v\nIGRlZmluaXRpb24KICAgICAgICAgICAgbG9hZFJlZ2lzdGVyZWRDbGFzc01l\ndGFEYXRhKGVudkxvYWRlcik7CiAgICAgICAgICAgIG1ldGEgPSAoU2VxdWVu\nY2VNZXRhRGF0YSkgX3NlcXMuZ2V0KG5hbWUpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgY2FjaGVkIHNlcXVlbmNlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgc3luY2hyb25pemVkIFNlcXVlbmNlTWV0YURhdGFbXSBnZXRTZXF1ZW5j\nZU1ldGFEYXRhcygpIHsKICAgICAgICByZXR1cm4gKFNlcXVlbmNlTWV0YURh\ndGFbXSkgX3NlcXMudmFsdWVzKCkudG9BcnJheQogICAgICAgICAgICAobmV3\nIFNlcXVlbmNlTWV0YURhdGFbX3NlcXMuc2l6ZSgpXSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBhIHNlcXVlbmNlIG1ldGFk\nYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHVibGljIHN5\nbmNocm9uaXplZCBTZXF1ZW5jZU1ldGFEYXRhIGdldENhY2hlZFNlcXVlbmNl\nTWV0YURhdGEoCiAgICAgICAgU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1\ncm4gKFNlcXVlbmNlTWV0YURhdGEpIF9zZXFzLmdldChuYW1lKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBhIG5ldyBzZXF1ZW5jZSBtZXRhZGF0YSB0\nbyB0aGUgcmVwb3NpdG9yeSBhbmQgcmV0dXJuIGl0LgogICAgICovCiAgICBw\ndWJsaWMgc3luY2hyb25pemVkIFNlcXVlbmNlTWV0YURhdGEgYWRkU2VxdWVu\nY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkgewogICAgICAgIFNlcXVlbmNlTWV0\nYURhdGEgbWV0YSA9IG5ld1NlcXVlbmNlTWV0YURhdGEobmFtZSk7CiAgICAg\nICAgX3NlcXMucHV0KG5hbWUsIG1ldGEpOwogICAgICAgIHJldHVybiBtZXRh\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNlcXVlbmNl\nIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgU2Vx\ndWVuY2VNZXRhRGF0YSBuZXdTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZXF1ZW5jZU1ldGFEYXRhKG5hbWUs\nIHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZl\nbiBzZXF1ZW5jZSBtZXRhZGF0YSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAg\nICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlU2Vx\ndWVuY2VNZXRhRGF0YShTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgcmV0dXJuIF9zZXFzLnJlbW92ZShtZXRhLmdldE5hbWUoKSkg\nIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBzZXF1ZW5j\nZSBtZXRhZGF0YSBmb3IgdGhlIG5hbWUgaWYgaW4gdGhlIHJlcG9zaXRvcnku\nCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiByZW1v\ndmVTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIHJldHVybiBfc2Vxcy5yZW1vdmUobmFtZSkgIT0gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gc3lzdGVtIGxpZmVjeWNs\nZSBsaXN0ZW5lci4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCB2\nb2lkIGFkZFN5c3RlbUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lcikgewogICAg\nICAgIC8vIGNvcHkgdG8gYXZvaWQgaXNzdWVzIHdpdGggTGlzdGVuZXJMaXN0\nIGFuZCBhdm9pZCB1bm5jZXNzYXJ5CiAgICAgICAgLy8gbG9ja2luZyBvbiB0\naGUgbGlzdCBkdXJpbmcgcnVudGltZQogICAgICAgIExpZmVjeWNsZUV2ZW50\nTWFuYWdlci5MaXN0ZW5lckxpc3QgbGlzdGVuZXJzID0gbmV3CiAgICAgICAg\nICAgIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QoX2xpc3Rl\nbmVycyk7CiAgICAgICAgbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICAg\nICAgX2xpc3RlbmVycyA9IGxpc3RlbmVyczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSB0aGUgZ2l2ZW4gc3lzdGVtIGxpZmVjeWNsZSBsaXN0ZW5l\nci4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBib29sZWFuIHJl\nbW92ZVN5c3RlbUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lcikgewogICAgICAg\nIGlmICghX2xpc3RlbmVycy5jb250YWlucyhsaXN0ZW5lcikpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gY29weSB0byBhdm9pZCBp\nc3N1ZXMgd2l0aCBMaXN0ZW5lckxpc3QgYW5kIGF2b2lkIHVubmNlc3NhcnkK\nICAgICAgICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1cmluZyBydW50aW1l\nCiAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBs\naXN0ZW5lcnMgPSBuZXcKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICBsaXN0ZW5l\ncnMucmVtb3ZlKGxpc3RlbmVyKTsKICAgICAgICBfbGlzdGVuZXJzID0gbGlz\ndGVuZXJzOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVycwog\nICAgICovCiAgICBwdWJsaWMgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3Rl\nbmVyTGlzdCBnZXRTeXN0ZW1MaXN0ZW5lcnMoKSB7CiAgICAgICAgcmV0dXJu\nIF9saXN0ZW5lcnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBGcmVlIHRoZSBy\nZXNvdXJjZXMgdXNlZCBieSB0aGlzIHJlcG9zaXRvcnkuIENsb3NlcyBhbGwg\ndXNlciBzZXF1ZW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6\nZWQgdm9pZCBjbG9zZSgpIHsKICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhW10g\nc21kcyA9IGdldFNlcXVlbmNlTWV0YURhdGFzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBz\nbWRzW2ldLmNsb3NlKCk7CiAgICAgICAgY2xlYXIoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFF1ZXJ5IGtleSBzdHJ1Y3QuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIFF1ZXJ5S2V5CiAgICAgICAgaW1wbGVtZW50cyBT\nZXJpYWxpemFibGUgewoKICAgICAgICBwdWJsaWMgU3RyaW5nIGNsc05hbWU7\nCiAgICAgICAgcHVibGljIFN0cmluZyBuYW1lOwoKICAgICAgICBwdWJsaWMg\naW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQgY2xzSGFzaCA9IChj\nbHNOYW1lID09IG51bGwpID8gMCA6IGNsc05hbWUuaGFzaENvZGUoKTsKICAg\nICAgICAgICAgaW50IG5hbWVIYXNoID0gKG5hbWUgPT0gbnVsbCkgPyAwIDog\nbmFtZS5oYXNoQ29kZSgpOwogICAgICAgICAgICByZXR1cm4gY2xzSGFzaCAr\nIG5hbWVIYXNoOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvYmopCgkJewoJCQlpZiAob2JqID09IHRoaXMpCgkJ\nCQlyZXR1cm4gdHJ1ZTsKCQkJaWYgKCEob2JqIGluc3RhbmNlb2YgUXVlcnlL\nZXkpKQoJCQkJcmV0dXJuIGZhbHNlOwoJCQoJCQlRdWVyeUtleSBxayA9IChR\ndWVyeUtleSkgb2JqOwoJCQlyZXR1cm4gU3RyaW5nVXRpbHMuZXF1YWxzIChj\nbHNOYW1lLCBxay5jbHNOYW1lKQoJCQkJJiYgU3RyaW5nVXRpbHMuZXF1YWxz\nIChuYW1lLCBxay5uYW1lKTsJCgkJfQoJfQp9Cg==\n","encoding":"base64"}

