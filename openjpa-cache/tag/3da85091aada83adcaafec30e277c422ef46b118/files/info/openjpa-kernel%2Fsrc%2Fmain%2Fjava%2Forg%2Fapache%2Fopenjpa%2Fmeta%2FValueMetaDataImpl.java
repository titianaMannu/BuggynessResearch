{"sha":"51cfe2e2cc106f269b153aef9f562169745d9887","node_id":"MDQ6QmxvYjIwNjM2NDo1MWNmZTJlMmNjMTA2ZjI2OWIxNTNhZWY5ZjU2MjE2OTc0NWQ5ODg3","size":15085,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/51cfe2e2cc106f269b153aef9f562169745d9887","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoq\nCiAqIERlZmF1bHQge0BsaW5rIFZhbHVlTWV0YURhdGF9IGltcGxlbWVudGF0\naW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAq\nLwpwdWJsaWMgY2xhc3MgVmFsdWVNZXRhRGF0YUltcGwKICAgIGltcGxlbWVu\ndHMgVmFsdWVNZXRhRGF0YSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAg\nIChWYWx1ZU1ldGFEYXRhSW1wbC5jbGFzcyk7CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBOb3RlOiBpZiB5b3UgYWRkIGFkZGl0aW9uYWwgc3Rh\ndGUgdGhhdCBzaG91bGQgYmUgY29waWVkIHRvCiAgICAvLyBlbWJlZGRlZCBt\nZXRhZGF0YSwgbWFrZSBzdXJlIHRvIGFkZCBpdCB0byB0aGUgY29weSgpIG1l\ndGhvZAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJpdmF0ZSBGaWVs\nZE1ldGFEYXRhIF9vd25lcjsKICAgIHByaXZhdGUgQ2xhc3MgX2RlY1R5cGUg\nPSBPYmplY3QuY2xhc3M7CiAgICBwcml2YXRlIGludCBfZGVjQ29kZSA9IEph\ndmFUeXBlcy5PQkpFQ1Q7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgX2Rl\nY1R5cGVNZXRhID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3MgX3R5cGUgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgX2NvZGUgPSBKYXZhVHlwZXMuT0JKRUNU\nOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF90eXBlTWV0YSA9IG51bGw7\nCiAgICBwcml2YXRlIENsYXNzIF90eXBlT3ZlcnJpZGUgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnQgX2RlbGV0ZSA9IENBU0NBREVfTk9ORTsKICAgIHByaXZh\ndGUgaW50IF9wZXJzaXN0ID0gQ0FTQ0FERV9BVVRPOwogICAgcHJpdmF0ZSBp\nbnQgX2F0dGFjaCA9IENBU0NBREVfSU1NRURJQVRFOwogICAgcHJpdmF0ZSBp\nbnQgX3JlZnJlc2ggPSBDQVNDQURFX0FVVE87CiAgICBwcml2YXRlIGJvb2xl\nYW4gX3NlcmlhbGl6ZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgQm9vbGVhbiBf\nZW1iZWRkZWQgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9l\nbWJlZGRlZE1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX3Jlc01vZGUg\nPSBNT0RFX05PTkU7CiAgICBwcml2YXRlIFN0cmluZyBfbWFwcGVkQnkgPSBu\ndWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhIF9tYXBwZWRCeU1ldGEg\nPSBudWxsOwoKICAgIHByb3RlY3RlZCBWYWx1ZU1ldGFEYXRhSW1wbChGaWVs\nZE1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgX293bmVyID0gb3duZXI7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IgZm9yIHNlcmlh\nbGl6YXRpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZU1ldGFEYXRh\nSW1wbCgpIHsKICAgIH0KCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRG\naWVsZE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfb3duZXI7CiAgICB9\nCgogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5\nKCkgewogICAgICAgIHJldHVybiBfb3duZXIuZ2V0UmVwb3NpdG9yeSgpOwog\nICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKCkgewogICAgICAgIHJl\ndHVybiAoX3R5cGUgPT0gbnVsbCkgPyBfZGVjVHlwZSA6IF90eXBlOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFR5cGUoQ2xhc3MgdHlwZSkgewogICAg\nICAgIF90eXBlID0gdHlwZTsKICAgICAgICBfdHlwZU1ldGEgPSBudWxsOwog\nICAgICAgIGlmICh0eXBlICE9IG51bGwpCiAgICAgICAgICAgIHNldFR5cGVD\nb2RlKEphdmFUeXBlcy5nZXRUeXBlQ29kZSh0eXBlKSk7CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRUeXBlQ29kZSgpIHsKICAgICAgICByZXR1cm4gKF90\neXBlID09IG51bGwpID8gX2RlY0NvZGUgOiBfY29kZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRUeXBlQ29kZShpbnQgY29kZSkgewogICAgICAgIF9j\nb2RlID0gY29kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1R5cGVQ\nQygpIHsKICAgICAgICByZXR1cm4gZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuUEMKICAgICAgICAgICAgfHwgZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuUENfVU5UWVBFRDsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0\nYSBnZXRUeXBlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKF90eXBlID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBnZXREZWNsYXJlZFR5cGVNZXRhRGF0\nYSgpOwogICAgICAgIGlmIChfdHlwZU1ldGEgPT0gbnVsbCAmJiBfY29kZSA9\nPSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gX293bmVyLmdldERlZmluaW5nTWV0YURhdGEoKTsKICAgICAgICAg\nICAgX3R5cGVNZXRhID0gbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0TWV0YURh\ndGEoX3R5cGUsCiAgICAgICAgICAgICAgICBtZXRhLmdldEVudkNsYXNzTG9h\nZGVyKCksIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3R5cGVN\nZXRhOwogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXREZWNsYXJlZFR5cGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9kZWNUeXBlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldERlY2xhcmVkVHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAg\nX2RlY1R5cGUgPSB0eXBlOwogICAgICAgIF9kZWNUeXBlTWV0YSA9IG51bGw7\nCiAgICAgICAgX2RlY0NvZGUgPSBKYXZhVHlwZXMuZ2V0VHlwZUNvZGUodHlw\nZSk7CiAgICAgICAgaWYgKF9lbWJlZGRlZE1ldGEgIT0gbnVsbCkKICAgICAg\nICAgICAgX2VtYmVkZGVkTWV0YS5zZXREZXNjcmliZWRUeXBlKHR5cGUpOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RGVjbGFyZWRUeXBlQ29kZSgpIHsK\nICAgICAgICByZXR1cm4gX2RlY0NvZGU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0RGVjbGFyZWRUeXBlQ29kZShpbnQgY29kZSkgewogICAgICAgIF9k\nZWNDb2RlID0gY29kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Rl\nY2xhcmVkVHlwZVBDKCkgewogICAgICAgIHJldHVybiBfZGVjQ29kZSA9PSBK\nYXZhVHlwZXMuUEMgfHwgX2RlY0NvZGUgPT0gSmF2YVR5cGVzLlBDX1VOVFlQ\nRUQ7CiAgICB9CgogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0RGVjbGFy\nZWRUeXBlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKF9kZWNUeXBlTWV0YSA9\nPSBudWxsICYmIF9kZWNDb2RlID09IEphdmFUeXBlcy5QQykgewogICAgICAg\nICAgICBpZiAoaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgX2RlY1R5\ncGVNZXRhID0gZ2V0RW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9v\nd25lci5nZXREZWZpbmluZ01ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICBf\nZGVjVHlwZU1ldGEgPSBtZXRhLmdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0\nYShfZGVjVHlwZSwKICAgICAgICAgICAgICAgICAgICBtZXRhLmdldEVudkNs\nYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfZGVjVHlwZU1ldGE7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNFbWJlZGRlZCgpIHsKICAgICAgICBpZiAoX293bmVyLmdl\ndE1hbmFnZW1lbnQoKSAhPSBfb3duZXIuTUFOQUdFX1BFUlNJU1RFTlQpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2VtYmVkZGVk\nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gZmllbGQgbGVmdCBhcyBkZWZh\ndWx0OyBlbWJlZGRlZCBzZXR0aW5nIGRlcGVuZHMgb24gdHlwZQogICAgICAg\nICAgICBzd2l0Y2ggKF9kZWNDb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5N\nQVA6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVE\nOgogICAgICAgICAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4uRkFM\nU0U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJv\nb2xlYW4uVFJVRTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX2VtYmVkZGVkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldEVtYmVkZGVkKGJvb2xlYW4gZW1iZWRkZWQpIHsKICAg\nICAgICBpZiAoZW1iZWRkZWQgJiYgX2VtYmVkZGVkICE9IEJvb2xlYW4uVFJV\nRSkgewogICAgICAgICAgICBfZGVjVHlwZU1ldGEgPSBudWxsOwogICAgICAg\nICAgICBfdHlwZU1ldGEgPSBudWxsOwogICAgICAgIH0KICAgICAgICBfZW1i\nZWRkZWQgPSAoZW1iZWRkZWQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VtYmVkZGVkUEMo\nKSB7CiAgICAgICAgcmV0dXJuIF9kZWNDb2RlID09IEphdmFUeXBlcy5QQyAm\nJiBpc0VtYmVkZGVkKCk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWV0YURh\ndGEgZ2V0RW1iZWRkZWRNZXRhRGF0YSgpIHsKICAgICAgICBpZiAoX2VtYmVk\nZGVkTWV0YSA9PSBudWxsICYmIGlzRW1iZWRkZWRQQygpKQogICAgICAgICAg\nICBhZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIF9lbWJl\nZGRlZE1ldGE7CiAgICB9CgogICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRk\nRW1iZWRkZWRNZXRhRGF0YSgpIHsKICAgICAgICBNZXRhRGF0YVJlcG9zaXRv\ncnkgcmVwb3MgPSBfb3duZXIuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIF9l\nbWJlZGRlZE1ldGEgPSByZXBvcy5uZXdFbWJlZGRlZENsYXNzTWV0YURhdGEo\ndGhpcyk7CiAgICAgICAgX2VtYmVkZGVkTWV0YS5zZXREZXNjcmliZWRUeXBl\nKF9kZWNUeXBlKTsKICAgICAgICByZXBvcy5nZXRNZXRhRGF0YUZhY3Rvcnko\nKS5nZXREZWZhdWx0cygpLnBvcHVsYXRlKF9lbWJlZGRlZE1ldGEsCiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEuQUNDRVNTX1VOS05PV04pOwoKICAgICAg\nICBzZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICByZXR1cm4gX2VtYmVkZGVk\nTWV0YTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENhc2NhZGVEZWxldGUo\nKSB7CiAgICAgICAgaWYgKF9vd25lci5nZXRNYW5hZ2VtZW50KCkgIT0gRmll\nbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgcmV0\ndXJuIENBU0NBREVfTk9ORTsKICAgICAgICBpZiAoaXNFbWJlZGRlZFBDKCkp\nCiAgICAgICAgICAgIHJldHVybiBDQVNDQURFX0lNTUVESUFURTsKCiAgICAg\nICAgc3dpdGNoIChfZGVsZXRlKSB7CiAgICAgICAgICAgIGNhc2UgQ0FTQ0FE\nRV9OT05FOgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHVzZXIgbWFya3Mg\ndGhlIG93bmluZyBmaWVsZCBkZXBlbmRlbnQgYW5kIHdlIAogICAgICAgICAg\nICAgICAgLy8gZXh0ZXJuYWxpemUgdG8gYSBwYyB0eXBlLCB0aGVuIGJlY29t\nZSBkZXBlbmRlbnQKICAgICAgICAgICAgICAgIGlmICh0aGlzICE9IF9vd25l\nci5nZXRWYWx1ZSgpICYmIGlzVHlwZVBDKCkKICAgICAgICAgICAgICAgICAg\nICAmJiAoKFZhbHVlTWV0YURhdGFJbXBsKSBfb3duZXIuZ2V0VmFsdWUoKSku\nX2RlbGV0ZQogICAgICAgICAgICAgICAgICAgID09IENBU0NBREVfQVVUTykK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ0FTQ0FERV9BVVRPOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ0FTQ0FERV9B\nVVRPOgogICAgICAgICAgICAgICAgaWYgKGlzVHlwZVBDKCkpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIENBU0NBREVfQVVUTzsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIENBU0NBREVfSU1NRURJQVRF\nOgogICAgICAgICAgICAgICAgaWYgKGlzRGVjbGFyZWRUeXBlUEMoKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gQ0FTQ0FERV9JTU1FRElBVEU7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIENBU0NBREVfTk9ORTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYXNj\nYWRlRGVsZXRlKGludCBkZWxldGUpIHsKICAgICAgICBfZGVsZXRlID0gZGVs\nZXRlOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0Q2FzY2FkZVBlcnNpc3Qo\nKSB7CiAgICAgICAgaWYgKF9vd25lci5nZXRNYW5hZ2VtZW50KCkgIT0gRmll\nbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgcmV0\ndXJuIENBU0NBREVfTk9ORTsKICAgICAgICBpZiAoaXNEZWNsYXJlZFR5cGVQ\nQygpKQogICAgICAgICAgICByZXR1cm4gX3BlcnNpc3Q7CiAgICAgICAgaWYg\nKCFpc1R5cGVQQygpKQogICAgICAgICAgICByZXR1cm4gQ0FTQ0FERV9OT05F\nOwogICAgICAgIC8vIGlmIG9ubHkgZXh0ZXJuYWxpemVkIHR5cGUgaXMgcGMs\nIGNhbid0IGNhc2NhZGUgaW1tZWRpYXRlCiAgICAgICAgcmV0dXJuIChfcGVy\nc2lzdCA9PSBDQVNDQURFX0lNTUVESUFURSkgPyBDQVNDQURFX0FVVE8gOiBf\ncGVyc2lzdDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYXNjYWRlUGVy\nc2lzdChpbnQgcGVyc2lzdCkgewogICAgICAgIF9wZXJzaXN0ID0gcGVyc2lz\ndDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENhc2NhZGVBdHRhY2goKSB7\nCiAgICAgICAgaWYgKF9vd25lci5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRN\nZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVAogICAgICAgICAgICB8fCAhaXNE\nZWNsYXJlZFR5cGVQQygpKSAvLyBhdHRhY2ggYWN0cyBvbiBkZWNsYXJlZCB0\neXBlCiAgICAgICAgICAgIHJldHVybiBDQVNDQURFX05PTkU7CiAgICAgICAg\naWYgKGlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICByZXR1cm4gQ0FTQ0FE\nRV9JTU1FRElBVEU7CiAgICAgICAgcmV0dXJuIF9hdHRhY2g7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0Q2FzY2FkZUF0dGFjaChpbnQgYXR0YWNoKSB7\nCiAgICAgICAgaWYgKGF0dGFjaCA9PSBDQVNDQURFX0FVVE8pCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIkNBU0NB\nREVfQVVUTyIpOwogICAgICAgIF9hdHRhY2ggPSBhdHRhY2g7CiAgICB9Cgog\nICAgcHVibGljIGludCBnZXRDYXNjYWRlUmVmcmVzaCgpIHsKICAgICAgICBp\nZiAoX293bmVyLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9QRVJTSVNURU5UCiAgICAgICAgICAgIHx8ICFpc0RlY2xhcmVkVHlw\nZVBDKCkpIC8vIHJlZnJlc2ggYWN0cyBvbiBkZWNsYXJlZCB0eXBlCiAgICAg\nICAgICAgIHJldHVybiBDQVNDQURFX05PTkU7CiAgICAgICAgcmV0dXJuIF9y\nZWZyZXNoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhc2NhZGVSZWZy\nZXNoKGludCByZWZyZXNoKSB7CiAgICAgICAgX3JlZnJlc2ggPSByZWZyZXNo\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU2VyaWFsaXplZCgpIHsK\nICAgICAgICByZXR1cm4gX3NlcmlhbGl6ZWQ7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0U2VyaWFsaXplZChib29sZWFuIHNlcmlhbGl6ZWQpIHsKICAg\nICAgICBfc2VyaWFsaXplZCA9IHNlcmlhbGl6ZWQ7CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyBnZXRWYWx1ZU1hcHBlZEJ5KCkgewogICAgICAgIGlmIChf\nbWFwcGVkQnkgPT0gTUFQUEVEX0JZX1BLKSB7CiAgICAgICAgICAgIC8vIHVz\nZSB0aGlzIGluc3RlYWQgb2YgZ2V0dGluZyBtZXRhIGZyb20gZWxlbWVudCBi\nL2MgdGhhdAogICAgICAgICAgICAvLyByZXF1aXJlcyBlbGVtZW50IHRvIGJl\nIHJlc29sdmVkCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGdl\ndFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YQogICAgICAgICAgICAgICAgKF9v\nd25lci5nZXRFbGVtZW50KCkuZ2V0VHlwZSgpLCBudWxsLCBmYWxzZSk7CiAg\nICAgICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInZhbC1ub3Qt\ncGMiLCBfb3duZXIpKTsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0UHJpbWFy\neUtleUZpZWxkcygpLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ2YWwtbm90LW9u\nZS1wayIsCiAgICAgICAgICAgICAgICAgICAgX293bmVyKSk7CiAgICAgICAg\nICAgIF9tYXBwZWRCeU1ldGEgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMo\nKVswXTsKICAgICAgICAgICAgX21hcHBlZEJ5ID0gX21hcHBlZEJ5TWV0YS5n\nZXROYW1lKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfbWFwcGVkQnk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VmFsdWVNYXBwZWRCeShTdHJp\nbmcgbWFwcGVkKSB7CiAgICAgICAgaWYgKF9vd25lci5nZXRLZXkoKSAhPSB0\naGlzICYmIG1hcHBlZCAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWFwcGVkLWJ5LW5vdC1rZXkiLCB0\naGlzKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9tYXBwZWRCeSA9\nIG1hcHBlZDsKICAgICAgICAgICAgX21hcHBlZEJ5TWV0YSA9IG51bGw7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldFZh\nbHVlTWFwcGVkQnlNZXRhRGF0YSgpIHsKICAgICAgICBpZiAoZ2V0VmFsdWVN\nYXBwZWRCeSgpICE9IG51bGwgJiYgX21hcHBlZEJ5TWV0YSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9vd25lci5nZXRF\nbGVtZW50KCkuZ2V0VHlwZU1ldGFEYXRhKCk7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZmllbGQgPSAobWV0YSA9PSBudWxsKSA/IG51bGwKICAgICAg\nICAgICAgICAgIDogbWV0YS5nZXRGaWVsZChnZXRWYWx1ZU1hcHBlZEJ5KCkp\nOwogICAgICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8t\nbWFwcGVkLWJ5IiwgdGhpcywKICAgICAgICAgICAgICAgICAgICBnZXRWYWx1\nZU1hcHBlZEJ5KCkpKTsKICAgICAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBl\nZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2lyYy1tYXBwZWQtYnkiLCB0aGlz\nLAogICAgICAgICAgICAgICAgICAgIGdldFZhbHVlTWFwcGVkQnkoKSkpOwog\nICAgICAgICAgICBfbWFwcGVkQnlNZXRhID0gZmllbGQ7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfbWFwcGVkQnlNZXRhOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzcyBnZXRUeXBlT3ZlcnJpZGUoKSB7CiAgICAgICAgcmV0dXJuIF90\neXBlT3ZlcnJpZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHlwZU92\nZXJyaWRlKENsYXNzIHZhbCkgewogICAgICAgIF90eXBlT3ZlcnJpZGUgPSB2\nYWw7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICBTdHJpbmcgcmV0ID0gX293bmVyLmdldEZ1bGxOYW1lKHRydWUpOwog\nICAgICAgIGlmICh0aGlzID09IF9vd25lci5nZXRLZXkoKSkKICAgICAgICAg\nICAgcmV0dXJuIHJldCArICI8a2V5OiIgKyBfZGVjVHlwZSArICI+IjsKICAg\nICAgICBpZiAodGhpcyA9PSBfb3duZXIuZ2V0RWxlbWVudCgpKSB7CiAgICAg\nICAgICAgIGlmIChfb3duZXIuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nTUFQKQogICAgICAgICAgICAgICAgcmV0dXJuIHJldCArICI8dmFsdWU6IiAr\nIF9kZWNUeXBlICsgIj4iOwogICAgICAgICAgICByZXR1cm4gcmV0ICsgIjxl\nbGVtZW50OiIgKyBfZGVjVHlwZSArICI+IjsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJldCArICI8IiArIF9kZWNUeXBlICsgIj4iOwogICAgfQoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVzb2x2ZSBhbmQg\ndmFsaWRhdGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyBpbnQgZ2V0UmVzb2x2ZSgpIHsKICAgICAgICByZXR1cm4gX3Jlc01v\nZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShpbnQgbW9k\nZSkgewogICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAg\nICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAgICBfcmVz\nTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAg\nIF9yZXNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\ncmVzTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgaWYgKChfcmVzTW9kZSAmIG1v\nZGUpID09IG1vZGUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGludCBjdXIgPSBfcmVzTW9kZTsKICAgICAgICBfcmVzTW9kZSB8PSBtb2Rl\nOwoKICAgICAgICAvLyB3ZSBvbmx5IHBlcmZvcm0gYWN0aW9ucyBmb3IgbWV0\nYSBtb2RlCiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NRVRBKSA9PSAwIHx8\nIChjdXIgJiBNT0RFX01FVEEpICE9IDApCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIHR5cGUgZXh0ZW5zaW9uCiAg\nICAgICAgaW50IGNvZGVPdmVycmlkZSA9IEphdmFUeXBlcy5PQkpFQ1Q7CiAg\nICAgICAgaWYgKF90eXBlT3ZlcnJpZGUgIT0gbnVsbCkgewogICAgICAgICAg\nICBjb2RlT3ZlcnJpZGUgPSBKYXZhVHlwZXMuZ2V0VHlwZUNvZGUoX3R5cGVP\ndmVycmlkZSk7CgogICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyBleHRl\ncm5hbGl6ZXIgbWV0aG9kIG9yIHRoaXMgdmFsdWUgaXMgYSBrZXkgb3IKICAg\nICAgICAgICAgLy8gZWxlbWVudCwgc2V0IG91ciB0eXBlIHRvIHRoZSB0eXBl\nIGV4dGVuc2lvbjsgb3RoZXJ3aXNlLCB1c2UgdGhlCiAgICAgICAgICAgIC8v\nIHR5cGUgZXh0ZW5zaW9uIGFzIGEgaGludCB0byB0aGUgYWN0dWFsIHR5cGUg\nb2YgdGhlIGRlY2xhcmVkCiAgICAgICAgICAgIC8vIHZhbHVlIChlLmcuIG1h\ncmtpbmcgYW4gaW50ZXJmYWNlIGFzIG5vbi1wYykKICAgICAgICAgICAgaWYg\nKF9vd25lci5nZXRFeHRlcm5hbGl6ZXJNZXRob2QoKSA9PSBudWxsCiAgICAg\nICAgICAgICAgICB8fCBfb3duZXIuZ2V0VmFsdWUoKSAhPSB0aGlzKSB7CiAg\nICAgICAgICAgICAgICBfdHlwZSA9IF90eXBlT3ZlcnJpZGU7CiAgICAgICAg\nICAgICAgICBfY29kZSA9IGNvZGVPdmVycmlkZTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIF9kZWNDb2RlID0gY29kZU92ZXJyaWRl\nOwogICAgICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKGNvZGVP\ndmVycmlkZSwgX3R5cGVPdmVycmlkZSkpCiAgICAgICAgICAgICAgICAgICAg\ncmVzb2x2ZURlY2xhcmVkVHlwZShfdHlwZU92ZXJyaWRlKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2VlIGlmIGFjdHVhbCB0eXBl\nIGlzIHBjCiAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKF9jb2RlLCBf\ndHlwZSkpIHsKICAgICAgICAgICAgX3R5cGVNZXRhID0gX293bmVyLmdldFJl\ncG9zaXRvcnkoKS5nZXRNZXRhRGF0YShfdHlwZSwKICAgICAgICAgICAgICAg\nIF9vd25lci5nZXREZWZpbmluZ01ldGFEYXRhKCkuZ2V0RW52Q2xhc3NMb2Fk\nZXIoKSwgZmFsc2UpOwogICAgICAgICAgICBpZiAoX3R5cGVNZXRhICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfY29kZSA9IEphdmFUeXBlcy5QQzsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGV4dGVybmFsaXpl\nciwgc2V0IG91ciBkZWNsYXJlZCB0eXBlIGNvZGUgdG8gdGhlCiAgICAgICAg\nLy8gYWN0dWFsIHR5cGUgc28gdGhhdCB3ZSB0cmVhdCB0aGUgdmFsdWUgY29y\ncmVjdGx5IGF0IHJ1bnRpbWUKICAgICAgICAvLyAocGVycyBieSByZWFjaCwg\nZXRjKQogICAgICAgIGlmIChfdHlwZU92ZXJyaWRlICE9IG51bGwgJiYgX293\nbmVyLmdldEV4dGVybmFsaXplck1ldGhvZCgpID09IG51bGwKICAgICAgICAg\nICAgJiYgX293bmVyLmdldEV4dGVybmFsVmFsdWVzKCkgPT0gbnVsbCkgewog\nICAgICAgICAgICAvLyBjYWNoZSB0aGUgbWV0YWRhdGEgaW1tZWRpYXRlbHkg\nc2luY2Ugd2Ugd29uJ3QgYmUgYWJsZSB0byBnZXQKICAgICAgICAgICAgLy8g\naXQgbGF6aWx5LCBzaW5jZSB3ZSdyZSBub3QgcmVzZXR0aW5nIF9kZWNUeXBl\nIHRvIF90eXBlCiAgICAgICAgICAgIF9kZWNDb2RlID0gX2NvZGU7CiAgICAg\nICAgICAgIF9kZWNUeXBlTWV0YSA9IF90eXBlTWV0YTsKICAgICAgICB9IGVs\nc2UgaWYgKEphdmFUeXBlcy5tYXliZVBDKF9kZWNDb2RlLCBfZGVjVHlwZSkp\nCiAgICAgICAgICAgIHJlc29sdmVEZWNsYXJlZFR5cGUoX2RlY1R5cGUpOwoK\nICAgICAgICAvLyByZXNvbHZlcyBtYXBwZWQgYnkKICAgICAgICBnZXRWYWx1\nZU1hcHBlZEJ5KCk7CgogICAgICAgIENsYXNzTWV0YURhdGEgZW1iZWQgPSBn\nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKGVtYmVkICE9IG51\nbGwpCiAgICAgICAgICAgIGVtYmVkLnJlc29sdmUoTU9ERV9NRVRBKTsKCiAg\nICAgICAgLy8gb2lkIGFzIHByaW1hcnkga2V5IGZpZWxkPwogICAgICAgIGlm\nIChfZGVjQ29kZSA9PSBKYXZhVHlwZXMuUEMgJiYgaXNFbWJlZGRlZCgpCiAg\nICAgICAgICAgICYmIF9vd25lci5pc1ByaW1hcnlLZXkoKSAmJiBfb3duZXIu\nZ2V0VmFsdWUoKSA9PSB0aGlzKQogICAgICAgICAgICBfY29kZSA9IF9kZWND\nb2RlID0gSmF2YVR5cGVzLk9JRDsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSB0aGUgZGVjbGFyZWQgdHlw\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVEZWNsYXJlZFR5\ncGUoQ2xhc3MgdHlwZSkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIF9vd25lci5nZXRSZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGEodHlwZSwKICAg\nICAgICAgICAgX293bmVyLmdldERlZmluaW5nTWV0YURhdGEoKS5nZXRFbnZD\nbGFzc0xvYWRlcigpLCBmYWxzZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVs\nbCkKICAgICAgICAgICAgX2RlY0NvZGUgPSBKYXZhVHlwZXMuUEM7CiAgICAg\nICAgaWYgKCFpc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIF9kZWNUeXBlTWV0\nYSA9IG1ldGE7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShWYWx1ZU1l\ndGFEYXRhIHZtZCkgewogICAgICAgIC8vIGNvcHkgZGVjbGFyZWQgdHlwZXMs\nIGJ1dCBpZiBPSUQgcmV2ZXJ0IHRvIFBDIHVudGlsIHdlIHJlc29sdmUKICAg\nICAgICAvLyB0byBPSUQgb3Vyc2VsdmVzCiAgICAgICAgX2RlY1R5cGUgPSB2\nbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgX2RlY0NvZGUgPSB2bWQu\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpOwogICAgICAgIGlmIChfZGVjQ29kZSA9\nPSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICBfZGVjQ29kZSA9IEphdmFU\neXBlcy5QQzsKCiAgICAgICAgX2RlbGV0ZSA9IHZtZC5nZXRDYXNjYWRlRGVs\nZXRlKCk7CiAgICAgICAgX3BlcnNpc3QgPSB2bWQuZ2V0Q2FzY2FkZVBlcnNp\nc3QoKTsKICAgICAgICBfYXR0YWNoID0gdm1kLmdldENhc2NhZGVBdHRhY2go\nKTsKICAgICAgICBfcmVmcmVzaCA9IHZtZC5nZXRDYXNjYWRlUmVmcmVzaCgp\nOwogICAgICAgIF90eXBlT3ZlcnJpZGUgPSB2bWQuZ2V0VHlwZU92ZXJyaWRl\nKCk7CiAgICAgICAgX3NlcmlhbGl6ZWQgPSB2bWQuaXNTZXJpYWxpemVkKCk7\nCiAgICAgICAgaWYgKF9lbWJlZGRlZE1ldGEgIT0gbnVsbCkKICAgICAgICAg\nICAgX2VtYmVkZGVkTWV0YS5zZXREZXNjcmliZWRUeXBlKHZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CgogICAgICAgIC8vIGRvbid0IGFsbG93IGNvcHkgdG8g\nb3ZlcnJpZGUgZW1iZWRkZWQKICAgICAgICBpZiAoX2VtYmVkZGVkID09IG51\nbGwpCiAgICAgICAgICAgIHNldEVtYmVkZGVkKHZtZC5pc0VtYmVkZGVkKCkp\nOwogICAgfQp9Cg==\n","encoding":"base64"}

