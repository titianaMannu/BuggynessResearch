{"sha":"e84ff8abfa150076311e9e68a0da8d0d64b5118c","node_id":"MDQ6QmxvYjIwNjM2NDplODRmZjhhYmZhMTUwMDc2MzExZTllNjhhMGRhOGQwZDY0YjUxMThj","size":21218,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e84ff8abfa150076311e9e68a0da8d0d64b5118c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1vZGlmaWVyOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5GaWVsZE1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT2JqZWN0SWRT\ndGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IHNlcnAudXRpbC5O\ndW1iZXJzOwoKLyoqCiAqIFV0aWxpdHkgY2xhc3MgZm9yIG1hbmlwdWxhdGlu\nZyBhcHBsaWNhdGlvbiBvYmplY3QgaWRzLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgQXBwbGljYXRp\nb25JZHMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQXBwbGljYXRp\nb25JZHMuY2xhc3MpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmlt\nYXJ5IGtleSB2YWx1ZXMgZm9yIHRoZSBnaXZlbiBvYmplY3QgaWQuIFRoZSB2\nYWx1ZXMKICAgICAqIHdpbGwgYmUgcmV0dXJuZWQgaW4gdGhlIHNhbWUgb3Jk\nZXIgYXMgdGhlIG1ldGFkYXRhIHByaW1hcnkga2V5IGZpZWxkcy4KICAgICAq\nIFZhbHVlcyBmb3IgUEMgcHJpbWFyeSBrZXkgZmllbGRzIHdpbGwgYmUgdGhl\nIHByaW1hcmt5IGtleSB2YWx1ZSBvcgogICAgICogb2lkIHZhbHVlIG9mIHRo\nZSByZWxhdGVkIGluc3RhbmNlIChkZXBlbmRpbmcgb24gCiAgICAgKiB7QGxp\nbmsgRmllbGRNZXRhRGF0YSNpc09iamVjdElkRmllbGRJZE9mUEN9KS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3RbXSB0b1BLVmFsdWVzKE9i\namVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICht\nZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBPYmplY3RbXSBwa3M7CiAgICAgICAgaWYgKG1ldGEuaXNPcGVuSlBBSWRl\nbnRpdHkoKSkgewogICAgICAgICAgICBwa3MgPSBuZXcgT2JqZWN0WzFdOwog\nICAgICAgICAgICBpZiAob2lkICE9IG51bGwpCiAgICAgICAgICAgICAgICBw\na3NbMF0gPSAoKE9wZW5KUEFJZCkgb2lkKS5nZXRJZE9iamVjdCgpOwogICAg\nICAgICAgICByZXR1cm4gcGtzOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVz\nZXQgb3duaW5nICdtZXRhJyB0byB0aGUgb3duZXIgb2YgdGhlIHByaW1hcnkg\na2V5IGZpZWxkcywgYmVjYXVzZQogICAgICAgIC8vIHRoZSBvbmUgcGFzc2Vk\nIGluIG1pZ2h0IGJlIGEgcHJveHksIGxpa2UgZm9yIGVtYmVkZGVkIG1hcHBp\nbmdzOwogICAgICAgIC8vIHNpbmNlIGdldFByaW1hcnlLZXlGaWVsZHMgaXMg\nZ3VhcmFudGVlZCB0byByZXR1cm4gdGhlIHByaW1hcnkKICAgICAgICAvLyBr\nZXlzIGluIHRoZSBvcmRlciBvZiBpbmhlcml0YW5jZSwgd2UgYXJlIGd1YXJh\nbnRlZWQgdGhhdAogICAgICAgIC8vIHRoZSBsYXN0IGVsZW1lbnQgd2lsbCBi\nZSB0aGUgbW9zdC1kZXJpdmVkIGNsYXNzLgogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAg\nICAgbWV0YSA9IGZtZHNbZm1kcy5sZW5ndGggLSAxXS5nZXREZWNsYXJpbmdN\nZXRhRGF0YSgpOwogICAgICAgIHBrcyA9IG5ldyBPYmplY3RbZm1kcy5sZW5n\ndGhdOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHBrczsKCiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3RyYWN0KG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlmaWVycygpKSkgewogICAg\nICAgICAgICAvLyBjb3B5IGZpZWxkcyBmcm9tIHRoZSBvaWQKICAgICAgICAg\nICAgUHJpbWFyeUtleUZpZWxkTWFuYWdlciBjb25zdW1lciA9IG5ldyBQcmlt\nYXJ5S2V5RmllbGRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN1bWVyLnNl\ndFN0b3JlKHBrcyk7CiAgICAgICAgICAgIFBDUmVnaXN0cnkuY29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwKICAg\nICAgICAgICAgICAgIGNvbnN1bWVyLCBvaWQpOwogICAgICAgICAgICByZXR1\ncm4gY29uc3VtZXIuZ2V0U3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIC8v\nIGRlZmF1bHQgdG8gcmVmbGVjdGlvbgogICAgICAgIGlmIChtZXRhLmlzT2Jq\nZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAgIG9pZCA9ICgoT2JqZWN0\nSWQpIG9pZCkuZ2V0SWQoKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0gb2lk\nLmdldENsYXNzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChtZXRhLmdldEFjY2Vz\nc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkKICAgICAg\nICAgICAgICAgIHBrc1tpXSA9IFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVmbGVj\ndGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAgICAgICAgICAgICAgICAgICAg\nZm1kc1tpXS5nZXROYW1lKCksIHRydWUpKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgcGtzW2ldID0gUmVmbGVjdGlvbi5nZXQob2lkLCBS\nZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlwZSwKICAgICAgICAgICAgICAg\nICAgICBmbWRzW2ldLmdldE5hbWUoKSwgdHJ1ZSkpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcGtzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgbmV3IG9iamVjdCBpZCBjb25zdHJ1Y3RlZCBmcm9tIHRoZSBnaXZlbiBw\ncmltYXJ5IGtleSB2YWx1ZXMuCiAgICAgKiBWYWx1ZXMgZm9yIFBDIHByaW1h\ncnkga2V5IGZpZWxkcyBzaG91bGQgYmUgdGhlIHByaW1hcmt5IGtleSB2YWx1\nZSBvcgogICAgICogb2lkIHZhbHVlIG9mIHRoZSByZWxhdGVkIGluc3RhbmNl\nIChkZXBlbmRpbmcgb24gCiAgICAgKiB7QGxpbmsgRmllbGRNZXRhRGF0YSNp\nc09iamVjdElkRmllbGRJZE9mUEN9KS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgZnJvbVBLVmFsdWVzKE9iamVjdFtdIHBrcywgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCB8fCBw\na3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIGJvb2xlYW4gY29udmVydCA9ICFtZXRhLmdldFJlcG9zaXRvcnkoKS5nZXRD\nb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldENvbXBhdGliaWxpdHlJ\nbnN0YW5jZSgpLmdldFN0cmljdElkZW50aXR5VmFsdWVzKCk7CiAgICAgICAg\naWYgKG1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICBp\nbnQgdHlwZSA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpWzBdLmdldE9i\namVjdElkRmllbGRUeXBlQ29kZSgpOwogICAgICAgICAgICBPYmplY3QgdmFs\nID0gKGNvbnZlcnQpID8gSmF2YVR5cGVzLmNvbnZlcnQocGtzWzBdLCB0eXBl\nKSA6IHBrc1swXTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNlb2YgQnl0ZSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNl\ncHRpb24oIiEoeCBpbnN0YW5jZW9mIEJ5dGUpIik7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBCeXRlSWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICgoTnVtYmVyKSB2YWwpLmJ5\ndGVWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVI6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENoYXJJZChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgKChD\naGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCkpOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBpZiAo\nIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBEb3VibGUpKQogICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9u\nKCIhKHggaW5zdGFuY2VvZiBEb3VibGUpIik7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBEb3VibGVJZChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgKChOdW1iZXIpIHZhbCkuZG91\nYmxlVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09C\nSjoKICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnZlcnQgJiYgISh2YWwg\naW5zdGFuY2VvZiBGbG9hdCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIEZs\nb2F0KSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXRJ\nZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1ZSgpKTsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNlb2YgSW50ZWdlcikpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRp\nb24oIiEoeCBpbnN0YW5jZW9mIEludGVnZXIpIik7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBJbnRJZChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgKChOdW1iZXIpIHZhbCkuaW50\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05H\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgTG9uZykpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIExvbmcpIik7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMb25nSWQobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICgo\nTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgICAgIGlmICghY29u\ndmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIFNob3J0KSkKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4\nIGluc3RhbmNlb2YgU2hvcnQpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTaG9ydElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICAoKE51bWJlcikgdmFsKS5zaG9ydFZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nSWQobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCksIChTdHJpbmcpIHZhbCk7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgRGF0ZUlkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCAo\nRGF0ZSkgdmFsKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9J\nRDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElkKG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpLCB2YWwpOwogICAgICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nY29weSBwa3MgdG8gb2lkCiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3Ry\nYWN0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlmaWVycygpKSkg\newogICAgICAgICAgICBPYmplY3Qgb2lkID0gUENSZWdpc3RyeS5uZXdPYmpl\nY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIFBy\naW1hcnlLZXlGaWVsZE1hbmFnZXIgcHJvZHVjZXIgPSBuZXcgUHJpbWFyeUtl\neUZpZWxkTWFuYWdlcigpOwogICAgICAgICAgICBwcm9kdWNlci5zZXRTdG9y\nZShwa3MpOwogICAgICAgICAgICBpZiAoY29udmVydCkKICAgICAgICAgICAg\nICAgIHByb2R1Y2VyLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICBQ\nQ1JlZ2lzdHJ5LmNvcHlLZXlGaWVsZHNUb09iamVjdElkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcHJvZHVjZXIsIG9pZCk7\nCiAgICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoKICAgICAgICAv\nLyBkZWZhdWx0IHRvIHJlZmxlY3Rpb24KICAgICAgICBDbGFzcyBvaWRUeXBl\nID0gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBpZiAoTW9kaWZp\nZXIuaXNBYnN0cmFjdChvaWRUeXBlLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm9iamVj\ndGlkLWFic3RyYWN0IiwgbWV0YSkpOwogICAgICAgIE9iamVjdCBjb3B5ID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb3B5ID0gb2lkVHlw\nZS5uZXdJbnN0YW5jZSgpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQp\nOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBt\nZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBPYmplY3QgdmFs\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB2YWwgPSAoY29udmVydCkgPyBKYXZhVHlwZXMu\nY29udmVydChwa3NbaV0sCiAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE9i\namVjdElkRmllbGRUeXBlQ29kZSgpKSA6IHBrc1tpXTsKICAgICAgICAgICAg\naWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX0ZJRUxEKQogICAgICAgICAgICAgICAgUmVmbGVjdGlvbi5zZXQoY29w\neSwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAgICAgICAgICAg\nICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHRydWUpLCB2YWwpOyAKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUmVmbGVjdGlvbi5zZXQo\nY29weSwgUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5cGUsIAogICAgICAg\nICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCBmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZSgpLCB0cnVlKSwgdmFsKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAg\nIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCks\nIGNvcHkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoKICAgIC8qKgog\nICAgICogQ29weSB0aGUgZ2l2ZW4gb2lkIHZhbHVlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIE9iamVjdCBjb3B5KE9iamVjdCBvaWQsIENsYXNzTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwgfHwgb2lk\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBp\nZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIC8v\nIHVzZSBtZXRhIHR5cGUgaW5zdGVhZCBvZiBvaWQgdHlwZSBpbiBjYXNlIGl0\nJ3MgYSBzdWJjbGFzcwogICAgICAgICAgICBDbGFzcyBjbHMgPSBtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgT3BlbkpQQUlkIGtvaWQg\nPSAoT3BlbkpQQUlkKSBvaWQ7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEg\ncGsgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXTsKICAgICAgICAg\nICAgc3dpdGNoIChway5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgQnl0ZUlkKGNscywgKChCeXRlSWQpIG9pZCku\nZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNTdWJj\nbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hB\nUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklkKGNscywgKChD\naGFySWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\na29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIERvdWJsZUlkKGNscywgKChEb3VibGVJZCkgb2lkKS5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQoY2xzLCAoKEZsb2F0SWQpIG9p\nZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNT\ndWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludElkKGNscywgKChJ\nbnRJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBr\nb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMb25n\nSWQoY2xzLCAoKExvbmdJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAg\nICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IFNob3J0SWQoY2xzLCAoKFNob3J0SWQpIG9pZCkuZ2V0SWQo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNTdWJjbGFzc2Vz\nKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nSWQoY2xzLCBv\naWQudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5o\nYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuT0lEOgogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgZW1i\nZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAg\nICAgICAgT2JqZWN0IGlubmVyID0ga29pZC5nZXRJZE9iamVjdCgpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICBpbm5lciA9IGNvcHkoaW5uZXIsIGVtYmVkLCBlbWJl\nZC5nZXRGaWVsZHMoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBPYmplY3RJZChjbHMsIGlubmVyLCBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIGtvaWQu\nZ2V0SWRPYmplY3QoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIGtvaWQu\naGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRl\nSWQoY2xzLCAoKERhdGVJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAg\nICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBjcmVhdGUgYSBuZXcgcGMgaW5zdGFuY2Ugb2YgdGhlIHJp\nZ2h0IHR5cGUsIHNldCBpdHMga2V5IGZpZWxkcwogICAgICAgIC8vIHRvIHRo\nZSBvcmlnaW5hbCBvaWQgdmFsdWVzLCB0aGVuIGNvcHkgaXRzIGtleSBmaWVs\nZHMgdG8gYSBuZXcKICAgICAgICAvLyBvaWQgaW5zdGFuY2UKICAgICAgICBp\nZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3QobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkuZ2V0TW9kaWZpZXJzKCkpCiAgICAgICAgICAgICYmICFoYXNQQ1ByaW1h\ncnlLZXlGaWVsZHMobWV0YSkpIHsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9\nIG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgICAgICBpZiAodHlw\nZSA9PSBudWxsKQogICAgICAgICAgICAgICAgdHlwZSA9IG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUsIG51bGwsIG9pZCwg\nCiAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICBPYmplY3Qg\nY29weSA9IHBjLnBjTmV3T2JqZWN0SWRJbnN0YW5jZSgpOwogICAgICAgICAg\nICBwYy5wY0NvcHlLZXlGaWVsZHNUb09iamVjdElkKGNvcHkpOwogICAgICAg\nICAgICByZXR1cm4gY29weTsKICAgICAgICB9CgogICAgICAgIE9iamVjdCBj\nb3B5ID0gKCFtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpID8gb2lkCiAg\nICAgICAgICAgIDogKChPYmplY3RJZCkgb2lkKS5nZXRJZCgpOwogICAgICAg\nIGNvcHkgPSBjb3B5KGNvcHksIG1ldGEsIG1ldGEuZ2V0UHJpbWFyeUtleUZp\nZWxkcygpKTsKICAgICAgICBpZiAobWV0YS5pc09iamVjdElkVHlwZVNoYXJl\nZCgpKQogICAgICAgICAgICBjb3B5ID0gbmV3IE9iamVjdElkKG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpLCBjb3B5LAogICAgICAgICAgICAgICAgKChPcGVu\nSlBBSWQpIG9pZCkuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICByZXR1cm4g\nY29weTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIGFu\neSBvZiB0aGUgZ2l2ZW4gdHlwZSdzIHByaW1hcnkga2V5IGZpZWxkcyBhcmUg\nCiAgICAgKiBwZXJzaXN0ZW50IG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gaGFzUENQcmltYXJ5S2V5RmllbGRzKENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSB0aGUgZ2l2\nZW4gaWRlbnRpdHkgb2JqZWN0IHVzaW5nIHJlZmxlY3Rpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb3B5KE9iamVjdCBvaWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncykgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIENsYXNzIG9pZFR5cGUgPSBvaWQuZ2V0Q2xh\nc3MoKTsKICAgICAgICBPYmplY3QgY29weSA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgY29weSA9IG9pZFR5cGUubmV3SW5zdGFuY2UoKTsK\nICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbih0KTsKICAgICAgICB9CgogICAg\nICAgIEZpZWxkIGZpZWxkOwogICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1l\ndGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAg\nICAgICAgICBmaWVsZCA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUs\nIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBSZWZsZWN0aW9uLnNldChjb3B5\nLCBmaWVsZCwgUmVmbGVjdGlvbi5nZXQob2lkLCBmaWVsZCkpOwogICAgICAg\nICAgICAgICAgfSBlbHNlIHsgLy8gcHJvcGVydHkKICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmlu\nZEdldHRlcihvaWRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBmbWRz\nW2ldLmdldE5hbWUoKSwgdHJ1ZSkpOwogICAgICAgICAgICAgICAgICAgIFJl\nZmxlY3Rpb24uc2V0KGNvcHksIFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWRU\neXBlLCBmbWRzW2ldLgogICAgICAgICAgICAgICAgICAgICAgICBnZXROYW1l\nKCksIGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSwgdHJ1ZSksIHZh\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGNvcHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGdpdmVuIHByaW1hcnkga2V5IGZpZWxkIHZhbHVlIGZyb20gdGhlIGdp\ndmVuIG9pZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2V0\nKE9iamVjdCBvaWQsIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYg\nKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAob2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkKQogICAgICAgICAgICBy\nZXR1cm4gKChPcGVuSlBBSWQpIG9pZCkuZ2V0SWRPYmplY3QoKTsKCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZm1kLmdldERlZmluaW5nTWV0YURh\ndGEoKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0gb2lkLmdldENsYXNzKCk7\nCiAgICAgICAgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0\nYURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICByZXR1cm4gUmVmbGVj\ndGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCAK\nICAgICAgICAgICAgICAgIGZtZC5nZXROYW1lKCksIHRydWUpKTsKICAgICAg\nICByZXR1cm4gUmVmbGVjdGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRH\nZXR0ZXIob2lkVHlwZSwgZm1kLmdldE5hbWUoKSwKICAgICAgICAgICAgdHJ1\nZSkpOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYW4gYXBwbGlj\nYXRpb24gaWQgYmFzZWQgb24gdGhlIGN1cnJlbnQgcHJpbWFyeSBrZXkgZmll\nbGQgc3RhdGUKICAgICAqIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgY3JlYXRlKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYg\nKHBjID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBPYmplY3Qgb2lkID0gcGMucGNOZXdPYmplY3RJZEluc3RhbmNlKCk7CiAg\nICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgaWYgKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsK\nICAgICAgICAgICAgcGMucGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZChvaWQp\nOwogICAgICAgICAgICByZXR1cm4gb2lkOwogICAgICAgIH0KCiAgICAgICAg\nRmllbGRNZXRhRGF0YSBwayA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygp\nWzBdOwogICAgICAgIGlmIChway5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0g\nSmF2YVR5cGVzLk9JRCkKICAgICAgICAgICAgcmV0dXJuIG9pZDsKCiAgICAg\nICAgLy8gYWx3YXlzIGNvcHkgb2lkIG9iamVjdCBpbiBjYXNlIGZpZWxkIHZh\nbHVlIG11dGF0ZXMgb3IgYmVjb21lcwogICAgICAgIC8vIG1hbmFnZWQKICAg\nICAgICBPYmplY3RJZCBvYmppZCA9IChPYmplY3RJZCkgb2lkOwogICAgICAg\nIENsYXNzTWV0YURhdGEgZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRh\nKCk7CiAgICAgICAgb2JqaWQuc2V0SWQoY29weShvYmppZC5nZXRJZCgpLCBl\nbWJlZCwgZW1iZWQuZ2V0RmllbGRzKCkpKTsKICAgICAgICByZXR1cm4gb2Jq\naWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NpZ24gYW4gYXBwbGljYXRp\nb24gaWRlbnRpdHkgb2JqZWN0IHRvIHRoZSBnaXZlbiBzdGF0ZSwgb3IgcmV0\ndXJuCiAgICAgKiBmYWxzZSBpZiBkZXRlcm1pbmluZyB0aGUgYXBwbGljYXRp\nb24gaWRlbnRpdHkgcmVxdWlyZXMgYSBmbHVzaC4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBib29sZWFuIGFzc2lnbihPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBTdG9yZU1hbmFnZXIgc3RvcmUsCiAgICAgICAgYm9vbGVhbiBwcmVG\nbHVzaCkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1l\ndGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkg\nIT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CgogICAgICAgIGJvb2xl\nYW4gcmV0OwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBtZXRhLmdl\ndFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAobWV0YS5pc09wZW5K\nUEFJZGVudGl0eSgpCiAgICAgICAgICAgICYmIHBrc1swXS5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIG9pZHNtID0gbmV3IE9iamVjdElkU3RhdGVN\nYW5hZ2VyCiAgICAgICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVsZChw\na3NbMF0uZ2V0SW5kZXgoKSksIHNtLCBwa3NbMF0pOwogICAgICAgICAgICBy\nZXQgPSBhc3NpZ24ob2lkc20sIHN0b3JlLCBwa3NbMF0uZ2V0RW1iZWRkZWRN\nZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgZ2V0RmllbGRzKCksIHByZUZs\ndXNoKTsKICAgICAgICAgICAgc20uc3RvcmVPYmplY3RGaWVsZChwa3NbMF0u\nZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgIG9pZHNtLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0ID0g\nYXNzaWduKHNtLCBzdG9yZSwgbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCks\nIHByZUZsdXNoKTsKICAgICAgICBpZiAoIXJldCkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICAvLyBiYXNlIG9pZCBvbiBmaWVsZCB2YWx1\nZXMKICAgICAgICBzbS5zZXRPYmplY3RJZChjcmVhdGUoc20uZ2V0UGVyc2lz\ndGVuY2VDYXBhYmxlKCksIG1ldGEpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiBnZW5lcmF0ZWQgdmFsdWVz\nIHRvIGdpdmVuIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiBhc3NpZ24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgU3RvcmVN\nYW5hZ2VyIHN0b3JlLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MsIGJv\nb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHBrcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRW\nYWx1ZVN0cmF0ZWd5KCkgIT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUKICAgICAg\nICAgICAgICAgICYmIHNtLmlzRGVmYXVsdFZhbHVlKHBrc1tpXS5nZXRJbmRl\neCgpKQogICAgICAgICAgICAgICAgJiYgIXN0b3JlLmFzc2lnbkZpZWxkKHNt\nLCBwa3NbaV0uZ2V0SW5kZXgoKSwgcHJlRmx1c2gpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHVzZWQgdG8gdHJhbnNmZXIg\ncGsgdmFsdWVzIHRvL2Zyb20gYXBwbGljYXRpb24gb2lkcy4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJpbWFyeUtleUZpZWxkTWFuYWdl\ncgogICAgICAgIGltcGxlbWVudHMgRmllbGRNYW5hZ2VyIHsKCiAgICAgICAg\ncHJpdmF0ZSBPYmplY3RbXSBfc3RvcmUgPSBudWxsOwogICAgICAgIHByaXZh\ndGUgaW50IF9pbmRleCA9IDA7CiAgICAgICAgcHJpdmF0ZSBDbGFzc01ldGFE\nYXRhIF9tZXRhID0gbnVsbDsKCiAgICAgICAgcHVibGljIHZvaWQgc2V0TWV0\nYURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgICAgIF9tZXRh\nID0gbWV0YTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3RbXSBn\nZXRTdG9yZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0b3JlKE9iamVjdFtdIHN0\nb3JlKSB7CiAgICAgICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCb29sZWFuRmllbGQoaW50IGZp\nZWxkLCBib29sZWFuIHZhbCkgewogICAgICAgICAgICBzdG9yZSgodmFsKSA/\nIEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgc3RvcmVCeXRlRmllbGQoaW50IGZpZWxkLCBi\neXRlIHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgQnl0ZSh2YWwpKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxk\nKGludCBmaWVsZCwgY2hhciB2YWwpIHsKICAgICAgICAgICAgc3RvcmUobmV3\nIENoYXJhY3Rlcih2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNob3J0IHZhbCkgewog\nICAgICAgICAgICBzdG9yZShuZXcgU2hvcnQodmFsKSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwg\naW50IHZhbCkgewogICAgICAgICAgICBzdG9yZShOdW1iZXJzLnZhbHVlT2Yo\ndmFsKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUxv\nbmdGaWVsZChpbnQgZmllbGQsIGxvbmcgdmFsKSB7CiAgICAgICAgICAgIHN0\nb3JlKE51bWJlcnMudmFsdWVPZih2YWwpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0\nIHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgRmxvYXQodmFsKSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxk\nKGludCBmaWVsZCwgZG91YmxlIHZhbCkgewogICAgICAgICAgICBzdG9yZShu\nZXcgRG91YmxlKHZhbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgc3RvcmVTdHJpbmdGaWVsZChpbnQgZmllbGQsIFN0cmluZyB2YWwpIHsK\nICAgICAgICAgICAgc3RvcmUodmFsKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3Qg\ndmFsKSB7CiAgICAgICAgICAgIHN0b3JlKHZhbCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW5GaWVsZChpbnQgZmll\nbGQpIHsKICAgICAgICAgICAgcmV0dXJuIChyZXRyaWV2ZShmaWVsZCkgPT0g\nQm9vbGVhbi5UUlVFKSA/IHRydWUgOiBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBjaGFyIGZldGNoQ2hhckZpZWxkKGludCBmaWVsZCkgewog\nICAgICAgICAgICByZXR1cm4gKChDaGFyYWN0ZXIpIHJldHJpZXZlKGZpZWxk\nKSkuY2hhclZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYnl0\nZSBmZXRjaEJ5dGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0\ndXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmJ5dGVWYWx1ZSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHNob3J0IGZldGNoU2hvcnRGaWVs\nZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBy\nZXRyaWV2ZShmaWVsZCkpLnNob3J0VmFsdWUoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmlu\ndFZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgbG9uZyBmZXRj\naExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgo\nTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmxvbmdWYWx1ZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXRGaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2\nZShmaWVsZCkpLmZsb2F0VmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBkb3VibGUgZmV0Y2hEb3VibGVGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmRv\ndWJsZVZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5n\nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAgIHJl\ndHVybiAoU3RyaW5nKSByZXRyaWV2ZShmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0RmllbGQoaW50IGZpZWxk\nKSB7CiAgICAgICAgICAgIHJldHVybiByZXRyaWV2ZShmaWVsZCk7CiAgICAg\nICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgc3RvcmUoT2JqZWN0IHZhbCkg\newogICAgICAgICAgICBfc3RvcmVbX2luZGV4KytdID0gdmFsOwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgcmV0cmlldmUoaW50IGZpZWxk\nKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBfc3RvcmVbX2luZGV4Kytd\nOwogICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSAhPSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAgdmFs\nID0gSmF2YVR5cGVzLmNvbnZlcnQodmFsLCBmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBKYXZhVHlwZXMuY29udmVydCh2YWwsIEphdmFUeXBlcy5n\nZXRUeXBlQ29kZShmbWQuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE9i\namVjdElkRmllbGRUeXBlKCkpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdmFsOwoJCX0KCX0KfQo=\n","encoding":"base64"}

