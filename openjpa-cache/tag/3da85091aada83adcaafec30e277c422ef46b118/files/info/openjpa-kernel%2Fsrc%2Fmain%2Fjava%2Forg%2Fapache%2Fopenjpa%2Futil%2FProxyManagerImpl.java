{"sha":"67be3711a681c1cb7c4add74eefeb8bbe17bfe2b","node_id":"MDQ6QmxvYjIwNjM2NDo2N2JlMzcxMWE2ODFjMWNiN2M0YWRkNzRlZWZlYjhiYmUxN2JmZTJi","size":59527,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/67be3711a681c1cb7c4add74eefeb8bbe17bfe2b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQg\namF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb247CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkNv\nbnN0cnVjdG9yOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZh\nLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5DYWxl\nbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1w\nb3J0IGphdmEudXRpbC5HcmVnb3JpYW5DYWxlbmRhcjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQgamF2YS51dGls\nLlNvcnRlZFNldDsKaW1wb3J0IGphdmEudXRpbC5UaW1lWm9uZTsKaW1wb3J0\nIGphdmEudXRpbC5UcmVlTWFwOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0\nZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSmF2\nYVZlcnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBzZXJwLmJ5\ndGVjb2RlLkJDQ2xhc3M7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3NM\nb2FkZXI7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDRmllbGQ7CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkJDTWV0aG9kOwppbXBvcnQgc2VycC5ieXRlY29kZS5D\nb2RlOwppbXBvcnQgc2VycC5ieXRlY29kZS5KdW1wSW5zdHJ1Y3Rpb247Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9ydCBzZXJwLnV0aWwu\nU3RyaW5nczsKCi8qKgogKiBEZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIHRo\nZSB7QGxpbmsgUHJveHlNYW5hZ2VyfSBpbnRlcmZhY2UuCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgUHJveHlNYW5hZ2VySW1w\nbAogICAgaW1wbGVtZW50cyBQcm94eU1hbmFnZXIgewoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFN0cmluZyBQUk9YWV9TVUZGSVggPSAiJHByb3h5IjsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFByb3h5TWFuYWdlckltcGwu\nY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGljIGxvbmcgX3Byb3h5SWQgPSAw\nTDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1hcCBfc3RkQ29sbGVjdGlv\nbnMgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTWFwIF9zdGRNYXBzID0gbmV3IEhhc2hNYXAoKTsKICAgIHN0YXRpYyB7CiAg\nICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChDb2xsZWN0aW9uLmNsYXNzLCBB\ncnJheUxpc3QuY2xhc3MpOwogICAgICAgIF9zdGRDb2xsZWN0aW9ucy5wdXQo\nU2V0LmNsYXNzLCBIYXNoU2V0LmNsYXNzKTsKICAgICAgICBfc3RkQ29sbGVj\ndGlvbnMucHV0KFNvcnRlZFNldC5jbGFzcywgVHJlZVNldC5jbGFzcyk7CiAg\nICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChMaXN0LmNsYXNzLCBBcnJheUxp\nc3QuY2xhc3MpOwogICAgICAgIGlmIChKYXZhVmVyc2lvbnMuVkVSU0lPTiA+\nPSA1KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBDbGFz\ncyBxdWV1ZSA9IENsYXNzLmZvck5hbWUoImphdmEudXRpbC5RdWV1ZSIsIGZh\nbHNlLCAKICAgICAgICAgICAgICAgICAgICBDb2xsZWN0aW9uLmNsYXNzLmdl\ndENsYXNzTG9hZGVyKCkpOwogICAgICAgICAgICAgICAgX3N0ZENvbGxlY3Rp\nb25zLnB1dChxdWV1ZSwgTGlua2VkTGlzdC5jbGFzcyk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBu\nb3QgcmVhbGx5IGphdmEgNSBhZnRlciBhbGw/CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIF9zdGRNYXBzLnB1dChNYXAuY2xhc3MsIEhhc2hN\nYXAuY2xhc3MpOwogICAgICAgIF9zdGRNYXBzLnB1dChTb3J0ZWRNYXAuY2xh\nc3MsIFRyZWVNYXAuY2xhc3MpOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwg\nU2V0IF91bnByb3h5YWJsZSA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcml2YXRl\nIGZpbmFsIE1hcCBfcHJveGllcyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcCgp\nOwogICAgcHJpdmF0ZSBib29sZWFuIF90cmFja0NoYW5nZXMgPSB0cnVlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9hc3NlcnRUeXBlID0gZmFsc2U7CgogICAg\ncHVibGljIFByb3h5TWFuYWdlckltcGwoKSB7CiAgICAgICAgX3VucHJveHlh\nYmxlLmFkZChUaW1lWm9uZS5jbGFzcy5nZXROYW1lKCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciBwcm94aWVzIHByb2R1Y2VkIGJ5IHRoaXMg\nZmFjdG9yeSB3aWxsIHVzZSB7QGxpbmsgQ2hhbmdlVHJhY2tlcn1zCiAgICAg\nKiB0byB0cnkgdG8gY3V0IGRvd24gb24gZGF0YSBzdG9yZSBvcGVyYXRpb25z\nIGF0IHRoZSBjb3N0IG9mIHNvbWUgZXh0cmEKICAgICAqIGJvb2trZWVwaW5n\nIG92ZXJoZWFkLiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRUcmFja0NoYW5nZXMoKSB7CiAgICAgICAgcmV0dXJu\nIF90cmFja0NoYW5nZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHByb3hpZXMgcHJvZHVjZWQgYnkgdGhpcyBmYWN0b3J5IHdpbGwgdXNlIHtA\nbGluayBDaGFuZ2VUcmFja2VyfXMKICAgICAqIHRvIHRyeSB0byBjdXQgZG93\nbiBvbiBkYXRhIHN0b3JlIG9wZXJhdGlvbnMgYXQgdGhlIGNvc3Qgb2Ygc29t\nZSBleHRyYQogICAgICogYm9va2tlZXBpbmcgb3ZlcmhlYWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRyYWNrQ2hh\nbmdlcyhib29sZWFuIHRyYWNrKSB7CiAgICAgICAgX3RyYWNrQ2hhbmdlcyA9\nIHRyYWNrOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBwZXJm\nb3JtIHJ1bnRpbWUgY2hlY2tzIHRvIGVuc3VyZSB0aGF0IGFsbCBlbGVtZW50\ncwogICAgICogYWRkZWQgdG8gY29sbGVjdGlvbiBhbmQgbWFwIHByb3hpZXMg\nYXJlIHRoZSBwcm9wZXIgZWxlbWVudC9rZXkvdmFsdWUKICAgICAqIHR5cGUg\nYXMgZGVmaW5lZCBieSB0aGUgbWV0YWRhdGEuIERlZmF1bHRzIHRvIGZhbHNl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBc3NlcnRBbGxvd2Vk\nVHlwZSgpIHsKICAgICAgICByZXR1cm4gX2Fzc2VydFR5cGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHBlcmZvcm0gcnVudGltZSBjaGVj\na3MgdG8gZW5zdXJlIHRoYXQgYWxsIGVsZW1lbnRzCiAgICAgKiBhZGRlZCB0\nbyBjb2xsZWN0aW9uIGFuZCBtYXAgcHJveGllcyBhcmUgdGhlIHByb3BlciBl\nbGVtZW50L2tleS92YWx1ZQogICAgICogdHlwZSBhcyBkZWZpbmVkIGJ5IHRo\nZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEFzc2VydEFsbG93ZWRUeXBlKGJvb2xlYW4gYXNzZXJ0\nVHlwZSkgewogICAgICAgIF9hc3NlcnRUeXBlID0gYXNzZXJ0VHlwZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG11dGFibGUgdmlldyBvZiBj\nbGFzcyBuYW1lcyB3ZSBrbm93IGNhbm5vdCBiZSBwcm94aWVkICAKICAgICAq\nIGNvcnJlY3RseSBieSB0aGlzIG1hbmFnZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uIGdldFVucHJveHlhYmxlKCkgewogICAgICAgIHJldHVy\nbiBfdW5wcm94eWFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm92aWRl\nZCBmb3IgYXV0by1jb25maWd1cmF0aW9uLiAgQWRkIHRoZSBnaXZlbiBzZW1p\nY29sb24tc2VwYXJhdGVkCiAgICAgKiBjbGFzcyBuYW1lcyB0byB0aGUgc2V0\nIG9mIGNsYXNzIG5hbWVzIHdlIGtub3cgY2Fubm90IGJlIHByb3hpZWQgY29y\ncmVjdGx5CiAgICAgKiBieSB0aGlzIG1hbmFnZXIuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFVucHJveHlhYmxlKFN0cmluZyBjbHNOYW1lcykgewog\nICAgICAgIGlmIChjbHNOYW1lcyAhPSBudWxsKQogICAgICAgICAgICBfdW5w\ncm94eWFibGUuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdChj\nbHNOYW1lcywgIjsiLCAwKSkpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nY29weUFycmF5KE9iamVjdCBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGludCBsZW5ndGggPSBBcnJheS5nZXRMZW5ndGgob3Jp\nZyk7CiAgICAgICAgICAgIE9iamVjdCBhcnJheSA9IEFycmF5Lm5ld0luc3Rh\nbmNlKG9yaWcuZ2V0Q2xhc3MoKS4KICAgICAgICAgICAgICAgIGdldENvbXBv\nbmVudFR5cGUoKSwgbGVuZ3RoKTsKCiAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkob3JpZywgMCwgYXJyYXksIDAsIGxlbmd0aCk7CiAgICAgICAgICAg\nIHJldHVybiBhcnJheTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1hcnJheSIsCiAgICAgICAgICAgICAgICBlLmdldE1l\nc3NhZ2UoKSksIGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29s\nbGVjdGlvbiBjb3B5Q29sbGVjdGlvbihDb2xsZWN0aW9uIG9yaWcpIHsKICAg\nICAgICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIFByb3h5KQogICAgICAg\nICAgICByZXR1cm4gKENvbGxlY3Rpb24pICgoUHJveHkpIG9yaWcpLmNvcHko\nb3JpZyk7CgogICAgICAgIFByb3h5Q29sbGVjdGlvbiBwcm94eSA9IGdldEZh\nY3RvcnlQcm94eUNvbGxlY3Rpb24ob3JpZy5nZXRDbGFzcygpKTsKICAgICAg\nICByZXR1cm4gKENvbGxlY3Rpb24pIHByb3h5LmNvcHkob3JpZyk7CiAgICB9\nCgogICAgcHVibGljIFByb3h5IG5ld0NvbGxlY3Rpb25Qcm94eShDbGFzcyB0\neXBlLCBDbGFzcyBlbGVtZW50VHlwZSwKICAgICAgICBDb21wYXJhdG9yIGNv\nbXBhcmUpIHsKICAgICAgICB0eXBlID0gdG9Qcm94eWFibGVDb2xsZWN0aW9u\nVHlwZSh0eXBlKTsKICAgICAgICBQcm94eUNvbGxlY3Rpb24gcHJveHkgPSBn\nZXRGYWN0b3J5UHJveHlDb2xsZWN0aW9uKHR5cGUpOwogICAgICAgIHJldHVy\nbiBwcm94eS5uZXdJbnN0YW5jZSgoX2Fzc2VydFR5cGUpID8gZWxlbWVudFR5\ncGUgOiBudWxsLCBjb21wYXJlLAogICAgICAgICAgICBfdHJhY2tDaGFuZ2Vz\nKTsKICAgIH0KCiAgICBwdWJsaWMgTWFwIGNvcHlNYXAoTWFwIG9yaWcpIHsK\nICAgICAgICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIFByb3h5KQogICAg\nICAgICAgICByZXR1cm4gKE1hcCkgKChQcm94eSkgb3JpZykuY29weShvcmln\nKTsKCiAgICAgICAgUHJveHlNYXAgcHJveHkgPSBnZXRGYWN0b3J5UHJveHlN\nYXAob3JpZy5nZXRDbGFzcygpKTsKICAgICAgICByZXR1cm4gKE1hcCkgcHJv\neHkuY29weShvcmlnKTsKICAgIH0KCiAgICBwdWJsaWMgUHJveHkgbmV3TWFw\nUHJveHkoQ2xhc3MgdHlwZSwgQ2xhc3Mga2V5VHlwZSwgCiAgICAgICAgQ2xh\nc3MgZWxlbWVudFR5cGUsIENvbXBhcmF0b3IgY29tcGFyZSkgewogICAgICAg\nIHR5cGUgPSB0b1Byb3h5YWJsZU1hcFR5cGUodHlwZSk7CiAgICAgICAgUHJv\neHlNYXAgcHJveHkgPSBnZXRGYWN0b3J5UHJveHlNYXAodHlwZSk7CiAgICAg\nICAgcmV0dXJuIHByb3h5Lm5ld0luc3RhbmNlKChfYXNzZXJ0VHlwZSkgPyBr\nZXlUeXBlIDogbnVsbCwgCiAgICAgICAgICAgIChfYXNzZXJ0VHlwZSkgPyBl\nbGVtZW50VHlwZSA6IG51bGwsIGNvbXBhcmUsIF90cmFja0NoYW5nZXMpOwog\nICAgfQoKICAgIHB1YmxpYyBEYXRlIGNvcHlEYXRlKERhdGUgb3JpZykgewog\nICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgUHJveHkpCiAgICAg\nICAgICAgIHJldHVybiAoRGF0ZSkgKChQcm94eSkgb3JpZykuY29weShvcmln\nKTsKCiAgICAgICAgUHJveHlEYXRlIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5\nRGF0ZShvcmlnLmdldENsYXNzKCkpOwogICAgICAgIHJldHVybiAoRGF0ZSkg\ncHJveHkuY29weShvcmlnKTsKICAgIH0KCiAgICBwdWJsaWMgUHJveHkgbmV3\nRGF0ZVByb3h5KENsYXNzIHR5cGUpIHsKICAgICAgICBQcm94eURhdGUgcHJv\neHkgPSBnZXRGYWN0b3J5UHJveHlEYXRlKHR5cGUpOwogICAgICAgIHJldHVy\nbiBwcm94eS5uZXdJbnN0YW5jZSgpOwogICAgfQoKICAgIHB1YmxpYyBDYWxl\nbmRhciBjb3B5Q2FsZW5kYXIoQ2FsZW5kYXIgb3JpZykgewogICAgICAgIGlm\nIChvcmlnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIGlmIChvcmlnIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAgIHJl\ndHVybiAoQ2FsZW5kYXIpICgoUHJveHkpIG9yaWcpLmNvcHkob3JpZyk7Cgog\nICAgICAgIFByb3h5Q2FsZW5kYXIgcHJveHkgPSBnZXRGYWN0b3J5UHJveHlD\nYWxlbmRhcihvcmlnLmdldENsYXNzKCkpOwogICAgICAgIHJldHVybiAoQ2Fs\nZW5kYXIpIHByb3h5LmNvcHkob3JpZyk7CiAgICB9CgogICAgcHVibGljIFBy\nb3h5IG5ld0NhbGVuZGFyUHJveHkoQ2xhc3MgdHlwZSwgVGltZVpvbmUgem9u\nZSkgewogICAgICAgIGlmICh0eXBlID09IENhbGVuZGFyLmNsYXNzKQogICAg\nICAgICAgICB0eXBlID0gR3JlZ29yaWFuQ2FsZW5kYXIuY2xhc3M7CiAgICAg\nICAgUHJveHlDYWxlbmRhciBwcm94eSA9IGdldEZhY3RvcnlQcm94eUNhbGVu\nZGFyKHR5cGUpOwogICAgICAgIFByb3h5Q2FsZW5kYXIgY2FsID0gcHJveHku\nbmV3SW5zdGFuY2UoKTsKICAgICAgICBpZiAoem9uZSAhPSBudWxsKQogICAg\nICAgICAgICAoKENhbGVuZGFyKSBjYWwpLnNldFRpbWVab25lKHpvbmUpOwog\nICAgICAgIHJldHVybiBjYWw7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBj\nb3B5Q3VzdG9tKE9iamVjdCBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9y\naWcgaW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuICgoUHJv\neHkpIG9yaWcpLmNvcHkob3JpZyk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIu\naXNNYW5hZ2VhYmxlKG9yaWcpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIENvbGxlY3Rpb24pCiAgICAg\nICAgICAgIHJldHVybiBjb3B5Q29sbGVjdGlvbigoQ29sbGVjdGlvbikgb3Jp\nZyk7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBNYXApCiAgICAgICAg\nICAgIHJldHVybiBjb3B5TWFwKChNYXApIG9yaWcpOwogICAgICAgIGlmIChv\ncmlnIGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICAgICAgcmV0dXJuIGNvcHlE\nYXRlKChEYXRlKSBvcmlnKTsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9m\nIENhbGVuZGFyKQogICAgICAgICAgICByZXR1cm4gY29weUNhbGVuZGFyKChD\nYWxlbmRhcikgb3JpZyk7CiAgICAgICAgUHJveHlCZWFuIHByb3h5ID0gZ2V0\nRmFjdG9yeVByb3h5QmVhbihvcmlnKTsKICAgICAgICByZXR1cm4gKHByb3h5\nID09IG51bGwpID8gbnVsbCA6IHByb3h5LmNvcHkob3JpZyk7IAogICAgfQoK\nICAgIHB1YmxpYyBQcm94eSBuZXdDdXN0b21Qcm94eShPYmplY3Qgb3JpZykg\newogICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgUHJveHkpCiAg\nICAgICAgICAgIHJldHVybiAoUHJveHkpIG9yaWc7CiAgICAgICAgaWYgKElt\ncGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9yaWcpKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIENvbGxlY3Rp\nb24pIHsKICAgICAgICAgICAgQ29tcGFyYXRvciBjb21wID0gKG9yaWcgaW5z\ndGFuY2VvZiBTb3J0ZWRTZXQpIAogICAgICAgICAgICAgICAgPyAoKFNvcnRl\nZFNldCkgb3JpZykuY29tcGFyYXRvcigpIDogbnVsbDsKICAgICAgICAgICAg\nQ29sbGVjdGlvbiBjID0gKENvbGxlY3Rpb24pIG5ld0NvbGxlY3Rpb25Qcm94\neShvcmlnLmdldENsYXNzKCksIAogICAgICAgICAgICAgICAgbnVsbCwgY29t\ncCk7IAogICAgICAgICAgICBjLmFkZEFsbCgoQ29sbGVjdGlvbikgb3JpZyk7\nCiAgICAgICAgICAgIHJldHVybiAoUHJveHkpIGM7CiAgICAgICAgfQogICAg\nICAgIGlmIChvcmlnIGluc3RhbmNlb2YgTWFwKSB7CiAgICAgICAgICAgIENv\nbXBhcmF0b3IgY29tcCA9IChvcmlnIGluc3RhbmNlb2YgU29ydGVkTWFwKSAK\nICAgICAgICAgICAgICAgID8gKChTb3J0ZWRNYXApIG9yaWcpLmNvbXBhcmF0\nb3IoKSA6IG51bGw7CiAgICAgICAgICAgIE1hcCBtID0gKE1hcCkgbmV3TWFw\nUHJveHkob3JpZy5nZXRDbGFzcygpLCBudWxsLCBudWxsLCBjb21wKTsKICAg\nICAgICAgICAgbS5wdXRBbGwoKE1hcCkgb3JpZyk7CiAgICAgICAgICAgIHJl\ndHVybiAoUHJveHkpIG07CiAgICAgICAgfQogICAgICAgIGlmIChvcmlnIGlu\nc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgICBEYXRlIGQgPSAoRGF0ZSkg\nbmV3RGF0ZVByb3h5KG9yaWcuZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAgIGQu\nc2V0VGltZSgoKERhdGUpIG9yaWcpLmdldFRpbWUoKSk7CiAgICAgICAgICAg\nIGlmIChvcmlnIGluc3RhbmNlb2YgVGltZXN0YW1wKQogICAgICAgICAgICAg\nICAgKChUaW1lc3RhbXApIGQpLnNldE5hbm9zKCgoVGltZXN0YW1wKSBvcmln\nKS5nZXROYW5vcygpKTsKICAgICAgICAgICAgcmV0dXJuIChQcm94eSkgZDsK\nICAgICAgICB9CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBDYWxlbmRh\ncikgewogICAgICAgICAgICBDYWxlbmRhciBjID0gKENhbGVuZGFyKSBuZXdD\nYWxlbmRhclByb3h5KG9yaWcuZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgICAg\nICgoQ2FsZW5kYXIpIG9yaWcpLmdldFRpbWVab25lKCkpOwogICAgICAgICAg\nICBjLnNldFRpbWVJbk1pbGxpcygoKENhbGVuZGFyKSBvcmlnKS5nZXRUaW1l\nSW5NaWxsaXMoKSk7CiAgICAgICAgICAgIHJldHVybiAoUHJveHkpIGM7CiAg\nICAgICAgfQoKICAgICAgICBQcm94eUJlYW4gcHJveHkgPSBnZXRGYWN0b3J5\nUHJveHlCZWFuKG9yaWcpOwogICAgICAgIHJldHVybiAocHJveHkgPT0gbnVs\nbCkgPyBudWxsIDogcHJveHkubmV3SW5zdGFuY2Uob3JpZyk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbmNyZXRlIHR5cGUgZm9yIHBy\nb3h5aW5nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3MgdG9Qcm94eWFi\nbGVDb2xsZWN0aW9uVHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAgaWYgKHR5\ncGUuZ2V0TmFtZSgpLmVuZHNXaXRoKFBST1hZX1NVRkZJWCkpCiAgICAgICAg\nICAgIHR5cGUgPSB0eXBlLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBlbHNl\nIGlmICh0eXBlLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgdHlwZSA9\nIHRvQ29uY3JldGVUeXBlKHR5cGUsIF9zdGRDb2xsZWN0aW9ucyk7CiAgICAg\nICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXByb3h5\nLWludGYiLCB0eXBlKSk7CiAgICAgICAgfSBlbHNlIGlmIChNb2RpZmllci5p\nc0Fic3RyYWN0KHR5cGUuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXBy\nb3h5LWFic3RyYWN0IiwgdHlwZSkpOwogICAgICAgIHJldHVybiB0eXBlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25jcmV0ZSB0eXBl\nIGZvciBwcm94eWluZy4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzIHRv\nUHJveHlhYmxlTWFwVHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAgaWYgKHR5\ncGUuZ2V0TmFtZSgpLmVuZHNXaXRoKFBST1hZX1NVRkZJWCkpCiAgICAgICAg\nICAgIHR5cGUgPSB0eXBlLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBlbHNl\nIGlmICh0eXBlLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgdHlwZSA9\nIHRvQ29uY3JldGVUeXBlKHR5cGUsIF9zdGRNYXBzKTsKICAgICAgICAgICAg\naWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgibm8tcHJveHktaW50ZiIs\nIHR5cGUpKTsKICAgICAgICB9IGVsc2UgaWYgKE1vZGlmaWVyLmlzQWJzdHJh\nY3QodHlwZS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgibm8tcHJveHktYWJz\ndHJhY3QiLCB0eXBlKSk7CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBMb2NhdGUgYSBjb25jcmV0ZSB0eXBlIHRvIHByb3h5\nIGZvciB0aGUgZ2l2ZW4gY29sbGVjdGlvbiBpbnRlcmZhY2UuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIENsYXNzIHRvQ29uY3JldGVUeXBlKENsYXNz\nIGludGYsIE1hcCBjb25jcmV0ZXMpIHsKICAgICAgICBDbGFzcyBjb25jcmV0\nZSA9IChDbGFzcykgY29uY3JldGVzLmdldChpbnRmKTsKICAgICAgICBpZiAo\nY29uY3JldGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNvbmNyZXRl\nOwogICAgICAgIENsYXNzW10gaW50ZnMgPSBpbnRmLmdldEludGVyZmFjZXMo\nKTsgICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGludGZz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbmNyZXRlID0gdG9Db25j\ncmV0ZVR5cGUoaW50ZnNbaV0sIGNvbmNyZXRlcyk7CiAgICAgICAgICAgIGlm\nIChjb25jcmV0ZSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGNv\nbmNyZXRlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsgCiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBmYWN0b3J5IHBy\nb3h5IGZvciB0aGUgZ2l2ZW4gY29sbGVjdGlvbiB0eXBlLgogICAgICovCiAg\nICBwcml2YXRlIFByb3h5Q29sbGVjdGlvbiBnZXRGYWN0b3J5UHJveHlDb2xs\nZWN0aW9uKENsYXNzIHR5cGUpIHsKICAgICAgICAvLyB3ZSBkb24ndCBsb2Nr\nIGhlcmU7IG9rIGlmIHR3byBwcm94aWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNh\nbWUgdHlwZQogICAgICAgIFByb3h5Q29sbGVjdGlvbiBwcm94eSA9IChQcm94\neUNvbGxlY3Rpb24pIF9wcm94aWVzLmdldCh0eXBlKTsKICAgICAgICBpZiAo\ncHJveHkgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc0xvYWRlciBsID0g\nZ2V0TW9zdERlcml2ZWRMb2FkZXIodHlwZSwgUHJveHlDb2xsZWN0aW9uLmNs\nYXNzKTsKICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQ\ncm94eSh0eXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHBjbHMgPSBsb2FkUHJveHkoZ2VuZXJhdGVQcm94\neUNvbGxlY3Rpb25CeXRlY29kZSh0eXBlLCB0cnVlKSxsKTsKICAgICAgICAg\nICAgcHJveHkgPSAoUHJveHlDb2xsZWN0aW9uKSBpbnN0YW50aWF0ZVByb3h5\nKHBjbHMsIG51bGwsIG51bGwpOwogICAgICAgICAgICBfcHJveGllcy5wdXQo\ndHlwZSwgcHJveHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJveHk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBmYWN0\nb3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4gbWFwIHR5cGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgUHJveHlNYXAgZ2V0RmFjdG9yeVByb3h5TWFwKENsYXNzIHR5\ncGUpIHsKICAgICAgICAvLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3\nbyBwcm94aWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQogICAgICAg\nIFByb3h5TWFwIHByb3h5ID0gKFByb3h5TWFwKSBfcHJveGllcy5nZXQodHlw\nZSk7CiAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsKICAgICAgICAgICAg\nQ2xhc3NMb2FkZXIgbCA9IGdldE1vc3REZXJpdmVkTG9hZGVyKHR5cGUsIFBy\nb3h5TWFwLmNsYXNzKTsKICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRC\ndWlsZFRpbWVQcm94eSh0eXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHBjbHMgPSBsb2FkUHJveHkoZ2Vu\nZXJhdGVQcm94eU1hcEJ5dGVjb2RlKHR5cGUsIHRydWUpLCBsKTsKICAgICAg\nICAgICAgcHJveHkgPSAoUHJveHlNYXApIGluc3RhbnRpYXRlUHJveHkocGNs\ncywgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgIF9wcm94aWVzLnB1dCh0eXBl\nLCBwcm94eSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm94eTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIGZhY3Rvcnkg\ncHJveHkgZm9yIHRoZSBnaXZlbiBkYXRlIHR5cGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgUHJveHlEYXRlIGdldEZhY3RvcnlQcm94eURhdGUoQ2xhc3MgdHlw\nZSkgewogICAgICAgIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYgdHdv\nIHByb3hpZXMgZ2V0IGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBlCiAgICAgICAg\nUHJveHlEYXRlIHByb3h5ID0gKFByb3h5RGF0ZSkgX3Byb3hpZXMuZ2V0KHR5\ncGUpOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAg\nIENsYXNzTG9hZGVyIGwgPSBnZXRNb3N0RGVyaXZlZExvYWRlcih0eXBlLCBQ\ncm94eURhdGUuY2xhc3MpOwogICAgICAgICAgICBDbGFzcyBwY2xzID0gbG9h\nZEJ1aWxkVGltZVByb3h5KHR5cGUsIGwpOwogICAgICAgICAgICBpZiAocGNs\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgcGNscyA9IGxvYWRQcm94eShn\nZW5lcmF0ZVByb3h5RGF0ZUJ5dGVjb2RlKHR5cGUsIHRydWUpLCBsKTsKICAg\nICAgICAgICAgcHJveHkgPSAoUHJveHlEYXRlKSBpbnN0YW50aWF0ZVByb3h5\nKHBjbHMsIG51bGwsIG51bGwpOwogICAgICAgICAgICBfcHJveGllcy5wdXQo\ndHlwZSwgcHJveHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJveHk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBmYWN0\nb3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4gY2FsZW5kYXIgdHlwZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBQcm94eUNhbGVuZGFyIGdldEZhY3RvcnlQcm94eUNh\nbGVuZGFyKENsYXNzIHR5cGUpIHsKICAgICAgICAvLyB3ZSBkb24ndCBsb2Nr\nIGhlcmU7IG9rIGlmIHR3byBwcm94aWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNh\nbWUgdHlwZQogICAgICAgIFByb3h5Q2FsZW5kYXIgcHJveHkgPSAoUHJveHlD\nYWxlbmRhcikgX3Byb3hpZXMuZ2V0KHR5cGUpOwogICAgICAgIGlmIChwcm94\neSA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTG9hZGVyIGwgPSBnZXRN\nb3N0RGVyaXZlZExvYWRlcih0eXBlLCBQcm94eUNhbGVuZGFyLmNsYXNzKTsK\nICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQcm94eSh0\neXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHBjbHMgPSBsb2FkUHJveHkoZ2VuZXJhdGVQcm94eUNhbGVu\nZGFyQnl0ZWNvZGUodHlwZSwgdHJ1ZSksIGwpOwogICAgICAgICAgICBwcm94\neSA9IChQcm94eUNhbGVuZGFyKSBpbnN0YW50aWF0ZVByb3h5KHBjbHMsIG51\nbGwsIG51bGwpOwogICAgICAgICAgICBfcHJveGllcy5wdXQodHlwZSwgcHJv\neHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBmYWN0b3J5IHByb3h5\nIGZvciB0aGUgZ2l2ZW4gYmVhbiB0eXBlLgogICAgICovCiAgICBwcml2YXRl\nIFByb3h5QmVhbiBnZXRGYWN0b3J5UHJveHlCZWFuKE9iamVjdCBvcmlnKSB7\nCiAgICAgICAgQ2xhc3MgdHlwZSA9IG9yaWcuZ2V0Q2xhc3MoKTsKICAgICAg\nICBpZiAoaXNVbnByb3h5YWJsZSh0eXBlKSkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYg\ndHdvIHByb3hpZXMgZ2V0IGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBlCiAgICAg\nICAgUHJveHlCZWFuIHByb3h5ID0gKFByb3h5QmVhbikgX3Byb3hpZXMuZ2V0\nKHR5cGUpOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsICYmICFfcHJveGll\ncy5jb250YWluc0tleSh0eXBlKSkgewogICAgICAgICAgICBDbGFzc0xvYWRl\nciBsID0gZ2V0TW9zdERlcml2ZWRMb2FkZXIodHlwZSwgUHJveHlCZWFuLmNs\nYXNzKTsKICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQ\ncm94eSh0eXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgQkNDbGFzcyBiYyA9IGdlbmVyYXRlUHJveHlC\nZWFuQnl0ZWNvZGUodHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAo\nYmMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwY2xzID0gbG9hZFBy\nb3h5KGJjLCBsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGNs\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgcHJveHkgPSAoUHJveHlCZWFu\nKSBpbnN0YW50aWF0ZVByb3h5KHBjbHMsIAogICAgICAgICAgICAgICAgICAg\nIGZpbmRDb3B5Q29uc3RydWN0b3IodHlwZSksIG5ldyBPYmplY3RbXSB7b3Jp\nZ30pOwogICAgICAgICAgICBfcHJveGllcy5wdXQodHlwZSwgcHJveHkpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gdHlwZSBpcyBrbm93\nbiB0byBiZSB1bnByb3h5YWJsZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaXNVbnByb3h5YWJsZShDbGFzcyB0eXBlKSB7CiAgICAgICAgZm9y\nICg7IHR5cGUgIT0gbnVsbCAmJiB0eXBlICE9IE9iamVjdC5jbGFzczsgCiAg\nICAgICAgICAgIHR5cGUgPSB0eXBlLmdldFN1cGVyY2xhc3MoKSkgewogICAg\nICAgICAgICBpZiAoX3VucHJveHlhYmxlLmNvbnRhaW5zKHR5cGUuZ2V0TmFt\nZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBM\nb2FkIHRoZSBwcm94eSBjbGFzcyBnZW5lcmF0ZWQgYXQgYnVpbGQgdGltZSBm\nb3IgdGhlIGdpdmVuIHR5cGUsCiAgICAgKiByZXR1cm5pbmcgbnVsbCBpZiBu\nb25lIGV4aXN0cy4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzIGxvYWRC\ndWlsZFRpbWVQcm94eShDbGFzcyB0eXBlLCBDbGFzc0xvYWRlciBsb2FkZXIp\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gQ2xhc3MuZm9y\nTmFtZShnZXRQcm94eUNsYXNzTmFtZSh0eXBlLCBmYWxzZSksIHRydWUsIGxv\nYWRlcik7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogTG9hZCB0aGUgcHJveHkgY2xhc3MgcmVwcmVzZW50ZWQgYnkgdGhl\nIGdpdmVuIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIGxv\nYWRQcm94eShCQ0NsYXNzIGJjLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAg\nICAgICBCQ0NsYXNzTG9hZGVyIGJjbG9hZGVyID0gbmV3IEJDQ2xhc3NMb2Fk\nZXIoYmMuZ2V0UHJvamVjdCgpLCBsb2FkZXIpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIENsYXNzIGMgPSBDbGFzcy5mb3JOYW1lKGJjLmdldE5hbWUo\nKSwgdHJ1ZSwgYmNsb2FkZXIpOwogICAgICAgICAgICBiYy5nZXRQcm9qZWN0\nKCkuY2xlYXIoKTsKICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24oYmMuZ2V0TmFtZSgpKS5zZXRDYXVzZSh0KTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUg\nZ2l2ZW4gcHJveHkgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgUHJveHkg\naW5zdGFudGlhdGVQcm94eShDbGFzcyBjbHMsIENvbnN0cnVjdG9yIGNvbnMs\nIE9iamVjdFtdIGFyZ3MpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoY29ucyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIChQcm94\neSkgY2xzLmdldENvbnN0cnVjdG9yKGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMo\nKSkuCiAgICAgICAgICAgICAgICAgICAgbmV3SW5zdGFuY2UoYXJncyk7CiAg\nICAgICAgICAgIHJldHVybiAoUHJveHkpIGNscy5uZXdJbnN0YW5jZSgpOwog\nICAgICAgIH0gY2F0Y2ggKEluc3RhbnRpYXRpb25FeGNlcHRpb24gaWUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJjYW50LW5ld2luc3RhbmNlIiwgCiAgICAgICAgICAgICAgICBj\nbHMuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpOwogICAgICAgIH0gY2F0\nY2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGNscy5nZXROYW1lKCkpLnNldENhdXNlKHQpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbW9yZSBk\nZXJpdmVkIGxvYWRlciBvZiB0aGUgY2xhc3MgbGFvZGVycyBmb3IgdGhlIGdp\ndmVuIAogICAgICogY2xhc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgQ2xhc3NMb2FkZXIgZ2V0TW9zdERlcml2ZWRMb2FkZXIoQ2xhc3MgYzEs\nIENsYXNzIGMyKSB7CiAgICAgICAgQ2xhc3NMb2FkZXIgbDEgPSBjMS5nZXRD\nbGFzc0xvYWRlcigpOwogICAgICAgIENsYXNzTG9hZGVyIGwyID0gYzIuZ2V0\nQ2xhc3NMb2FkZXIoKTsKICAgICAgICBpZiAobDEgPT0gbDIpCiAgICAgICAg\nICAgIHJldHVybiBsMTsKICAgICAgICBpZiAobDEgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGwyOwogICAgICAgIGlmIChsMiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbDE7CiAgICAgICAgCiAgICAgICAgZm9yIChDbGFz\nc0xvYWRlciBwID0gbDEuZ2V0UGFyZW50KCk7IHAgIT0gbnVsbDsgcCA9IHAu\nZ2V0UGFyZW50KCkpCiAgICAgICAgICAgIGlmIChwID09IGwyKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGwxOwogICAgICAgIHJldHVybiBsMjsKICAgIH0K\nCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3IgYSBj\nb2xsZWN0aW9uIHByb3h5IGZvciB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIEJDQ2xhc3MgZ2VuZXJhdGVQcm94eUNvbGxlY3Rpb25C\neXRlY29kZShDbGFzcyB0eXBlLCAKICAgICAgICBib29sZWFuIHJ1bnRpbWUp\nIHsKICAgICAgICBhc3NlcnROb3RGaW5hbCh0eXBlKTsKICAgICAgICBQcm9q\nZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgpOyAKICAgICAgICBCQ0NsYXNz\nIGJjID0gcHJvamVjdC5sb2FkQ2xhc3MoZ2V0UHJveHlDbGFzc05hbWUodHlw\nZSwgcnVudGltZSkpOwogICAgICAgIGJjLnNldFN1cGVyY2xhc3ModHlwZSk7\nCiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFjZShQcm94eUNvbGxlY3Rpb24u\nY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMoYmMsIHR5\ncGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHlwZSwgZmFsc2Up\nOwogICAgICAgIGFkZFByb3h5Q29sbGVjdGlvbk1ldGhvZHMoYmMsIHR5cGUp\nOwogICAgICAgIHByb3h5UmVjb2duaXplZE1ldGhvZHMoYmMsIHR5cGUsIFBy\nb3h5Q29sbGVjdGlvbnMuY2xhc3MsIAogICAgICAgICAgICBQcm94eUNvbGxl\nY3Rpb24uY2xhc3MpOwogICAgICAgIHByb3h5U2V0dGVycyhiYywgdHlwZSk7\nCiAgICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKGJjLCBydW50aW1lKTsK\nICAgICAgICByZXR1cm4gYmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIG5hbWUgb2YgdGhlIHByb3h5IGNsYXNzIHRvIGdlbmVyYXRlIGZv\nciB0aGUgZ2l2ZW4gdHlwZS4gICAKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgU3RyaW5nIGdldFByb3h5Q2xhc3NOYW1lKENsYXNzIHR5cGUsIGJvb2xl\nYW4gcnVudGltZSkgewogICAgICAgIFN0cmluZyBpZCA9IChydW50aW1lKSA/\nICIkIiArIG5leHRQcm94eUlkKCkgOiAiIjsKICAgICAgICByZXR1cm4gU3Ry\naW5ncy5nZXRQYWNrYWdlTmFtZShQcm94eU1hbmFnZXJJbXBsLmNsYXNzKSAr\nICIuIiAKICAgICAgICAgICAgKyB0eXBlLmdldE5hbWUoKS5yZXBsYWNlKCcu\nJywgJyQnKSArIGlkICsgUFJPWFlfU1VGRklYOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhyb3cgYXBwcm9wcmlhdGUgZXhjZXB0aW9uIGlmIHRoZSBnaXZl\nbiB0eXBlIGlzIGZpbmFsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2\nb2lkIGFzc2VydE5vdEZpbmFsKENsYXNzIHR5cGUpIHsKICAgICAgICBpZiAo\nTW9kaWZpZXIuaXNGaW5hbCh0eXBlLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1wcm94eS1maW5hbCIsIHR5cGUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3IgYSBtYXAgcHJveHkgZm9y\nIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQkNDbGFz\ncyBnZW5lcmF0ZVByb3h5TWFwQnl0ZWNvZGUoQ2xhc3MgdHlwZSwgYm9vbGVh\nbiBydW50aW1lKSB7CiAgICAgICAgYXNzZXJ0Tm90RmluYWwodHlwZSk7CiAg\nICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsgCiAgICAg\nICAgQkNDbGFzcyBiYyA9IHByb2plY3QubG9hZENsYXNzKGdldFByb3h5Q2xh\nc3NOYW1lKHR5cGUsIHJ1bnRpbWUpKTsKICAgICAgICBiYy5zZXRTdXBlcmNs\nYXNzKHR5cGUpOwogICAgICAgIGJjLmRlY2xhcmVJbnRlcmZhY2UoUHJveHlN\nYXAuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMoYmMs\nIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHlwZSwgZmFs\nc2UpOwogICAgICAgIGFkZFByb3h5TWFwTWV0aG9kcyhiYywgdHlwZSk7CiAg\nICAgICAgcHJveHlSZWNvZ25pemVkTWV0aG9kcyhiYywgdHlwZSwgUHJveHlN\nYXBzLmNsYXNzLCBQcm94eU1hcC5jbGFzcyk7CiAgICAgICAgcHJveHlTZXR0\nZXJzKGJjLCB0eXBlKTsKICAgICAgICBhZGRXcml0ZVJlcGxhY2VNZXRob2Qo\nYmMsIHJ1bnRpbWUpOwogICAgICAgIHJldHVybiBiYzsKICAgIH0KCiAgICAv\nKioKICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3IgYSBkYXRlIHBy\nb3h5IGZvciB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIEJDQ2xhc3MgZ2VuZXJhdGVQcm94eURhdGVCeXRlY29kZShDbGFzcyB0eXBl\nLCBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBhc3NlcnROb3RGaW5hbCh0\neXBlKTsKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgp\nOyAKICAgICAgICBCQ0NsYXNzIGJjID0gcHJvamVjdC5sb2FkQ2xhc3MoZ2V0\nUHJveHlDbGFzc05hbWUodHlwZSwgcnVudGltZSkpOwogICAgICAgIGJjLnNl\ndFN1cGVyY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFj\nZShQcm94eURhdGUuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1\nY3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywg\ndHlwZSwgdHJ1ZSk7CiAgICAgICAgYWRkUHJveHlEYXRlTWV0aG9kcyhiYywg\ndHlwZSk7CiAgICAgICAgcHJveHlTZXR0ZXJzKGJjLCB0eXBlKTsKICAgICAg\nICBhZGRXcml0ZVJlcGxhY2VNZXRob2QoYmMsIHJ1bnRpbWUpOwogICAgICAg\nIHJldHVybiBiYzsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRo\nZSBieXRlY29kZSBmb3IgYSBjYWxlbmRhciBwcm94eSBmb3IgdGhlIGdpdmVu\nIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVyYXRl\nUHJveHlDYWxlbmRhckJ5dGVjb2RlKENsYXNzIHR5cGUsIAogICAgICAgIGJv\nb2xlYW4gcnVudGltZSkgewogICAgICAgIGFzc2VydE5vdEZpbmFsKHR5cGUp\nOwogICAgICAgIFByb2plY3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7IAog\nICAgICAgIEJDQ2xhc3MgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcyhnZXRQcm94\neUNsYXNzTmFtZSh0eXBlLCBydW50aW1lKSk7CiAgICAgICAgYmMuc2V0U3Vw\nZXJjbGFzcyh0eXBlKTsKICAgICAgICBiYy5kZWNsYXJlSW50ZXJmYWNlKFBy\nb3h5Q2FsZW5kYXIuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1\nY3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywg\ndHlwZSwgdHJ1ZSk7CiAgICAgICAgYWRkUHJveHlDYWxlbmRhck1ldGhvZHMo\nYmMsIHR5cGUpOwogICAgICAgIHByb3h5U2V0dGVycyhiYywgdHlwZSk7CiAg\nICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKGJjLCBydW50aW1lKTsKICAg\nICAgICByZXR1cm4gYmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSB0aGUgYnl0ZWNvZGUgZm9yIGEgYmVhbiBwcm94eSBmb3IgdGhlIGdpdmVu\nIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVyYXRl\nUHJveHlCZWFuQnl0ZWNvZGUoQ2xhc3MgdHlwZSwgYm9vbGVhbiBydW50aW1l\nKSB7CiAgICAgICAgaWYgKE1vZGlmaWVyLmlzRmluYWwodHlwZS5nZXRNb2Rp\nZmllcnMoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChJbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUodHlwZSkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAvLyB3ZSBjYW4gb25seSBnZW5lcmF0\nZSBhIHZhbGlkIHByb3h5IGlmIHRoZXJlIGlzIGEgY29weSBjb25zdHJ1Y3Rv\ncgogICAgICAgIC8vIG9yIGEgZGVmYXVsdCBjb25zdHJ1Y3RvcgogICAgICAg\nIENvbnN0cnVjdG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUp\nOwogICAgICAgIGlmIChjb25zID09IG51bGwpIHsKICAgICAgICAgICAgQ29u\nc3RydWN0b3JbXSBjcyA9IHR5cGUuZ2V0Q29uc3RydWN0b3JzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBjb25zID09IG51bGwgJiYgaSA8IGNz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICBpZiAoY3NbaV0uZ2V0UGFy\nYW1ldGVyVHlwZXMoKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAg\nICBjb25zID0gY3NbaV07IAogICAgICAgICAgICBpZiAoY29ucyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAg\nICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgpOyAKICAgICAg\nICBCQ0NsYXNzIGJjID0gcHJvamVjdC5sb2FkQ2xhc3MoZ2V0UHJveHlDbGFz\nc05hbWUodHlwZSwgcnVudGltZSkpOwogICAgICAgIGJjLnNldFN1cGVyY2xh\nc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFjZShQcm94eUJl\nYW4uY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMoYmMs\nIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHlwZSwgdHJ1\nZSk7CiAgICAgICAgYWRkUHJveHlCZWFuTWV0aG9kcyhiYywgdHlwZSwgY29u\ncyk7CiAgICAgICAgaWYgKCFwcm94eVNldHRlcnMoYmMsIHR5cGUpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBhZGRXcml0ZVJlcGxhY2VN\nZXRob2QoYmMsIHJ1bnRpbWUpOwogICAgICAgIHJldHVybiBiYzsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBwYXNzLXRocm91Z2ggY29uc3RydWN0\nb3JzIHRvIGJhc2UgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRl\nbGVnYXRlQ29uc3RydWN0b3JzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsK\nICAgICAgICBDb25zdHJ1Y3RvcltdIGNvbnMgPSB0eXBlLmdldENvbnN0cnVj\ndG9ycygpOwogICAgICAgIENsYXNzW10gcGFyYW1zOwogICAgICAgIEJDTWV0\naG9kIG07CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwYXJh\nbXMgPSBjb25zW2ldLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgICAg\nIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBw\nYXJhbXMpOyAKICAgICAgICAgICAgbS5tYWtlUHVibGljKCk7CgogICAgICAg\nICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBmb3IgKGludCBqID0g\nMDsgaiA8IHBhcmFtcy5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIGNv\nZGUueGxvYWQoKS5zZXRQYXJhbShqKS5zZXRUeXBlKHBhcmFtc1tqXSk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChjb25z\nW2ldKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbXBsZW1lbnQgdGhlIG1ldGhvZHMgaW4gdGhlIHtAbGluayBQ\ncm94eX0gaW50ZXJmYWNlLCB3aXRoIHRoZSBleGNlcHRpb24KICAgICAqIG9m\nIHtAbGluayBQcm94eSNjb3B5fS4KICAgICAqCiAgICAgKiBAcGFyYW0gY2hh\nbmdlVHJhY2tlciB3aGV0aGVyIHRvIGltcGxlbWVudCBhIG51bGwgY2hhbmdl\nIHRyYWNrZXI7IGlmIGZhbHNlCiAgICAgKiB0aGUgY2hhbmdlIHRyYWNrZXIg\nbWV0aG9kIGlzIGxlZnQgdW5pbXBsZW1lbnRlZAogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkUHJveHlNZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5\ncGUsIAogICAgICAgIGJvb2xlYW4gY2hhbmdlVHJhY2tlcikgewogICAgICAg\nIEJDRmllbGQgc20gPSBiYy5kZWNsYXJlRmllbGQoInNtIiwgT3BlbkpQQVN0\nYXRlTWFuYWdlci5jbGFzcyk7CiAgICAgICAgc20uc2V0VHJhbnNpZW50KHRy\ndWUpOwogICAgICAgIEJDRmllbGQgZmllbGQgPSBiYy5kZWNsYXJlRmllbGQo\nImZpZWxkIiwgaW50LmNsYXNzKTsKICAgICAgICBmaWVsZC5zZXRUcmFuc2ll\nbnQodHJ1ZSk7CgogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0\naG9kKCJzZXRPd25lciIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAg\nICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcywgaW50LmNsYXNz\nIH0pOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29k\nZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoc20pOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNl\ndFBhcmFtKDEpOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CgogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRP\nd25lciIsIE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAg\nICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoc20pOwogICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBt\nID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0T3duZXJGaWVsZCIsIGludC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29k\nZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIGlmIChjaGFuZ2VUcmFja2VyKSB7CiAgICAgICAg\nICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRDaGFuZ2VUcmFja2VyIiwg\nQ2hhbmdlVHJhY2tlci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUp\nOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAg\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElt\ncGxlbWVudCB0aGUgbWV0aG9kcyBpbiB0aGUge0BsaW5rIFByb3h5Q29sbGVj\ndGlvbn0gaW50ZXJmYWNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nUHJveHlDb2xsZWN0aW9uTWV0aG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgLy8gY2hhbmdlIHRyYWNrZXIKICAgICAgICBCQ0ZpZWxk\nIGNoYW5nZVRyYWNrZXIgPSBiYy5kZWNsYXJlRmllbGQoImNoYW5nZVRyYWNr\nZXIiLCAKICAgICAgICAgICAgQ29sbGVjdGlvbkNoYW5nZVRyYWNrZXIuY2xh\nc3MpOwogICAgICAgIGNoYW5nZVRyYWNrZXIuc2V0VHJhbnNpZW50KHRydWUp\nOwogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRD\naGFuZ2VUcmFja2VyIiwgQ2hhbmdlVHJhY2tlci5jbGFzcywgCiAgICAgICAg\nICAgIG51bGwpOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENv\nZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChjaGFuZ2VUcmFja2VyKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gY29sbGVjdGlvbiBj\nb3B5CiAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZpbmRDb3B5Q29uc3Ry\ndWN0b3IodHlwZSk7CiAgICAgICAgaWYgKGNvbnMgPT0gbnVsbCAmJiBTb3J0\nZWRTZXQuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAg\nICAgY29ucyA9IGZpbmRDb21wYXJhdG9yQ29uc3RydWN0b3IodHlwZSk7CiAg\nICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAoY29ucyA9PSBudWxsKSA/IG5ldyBD\nbGFzc1swXSAKICAgICAgICAgICAgOiBjb25zLmdldFBhcmFtZXRlclR5cGVz\nKCk7CgogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2Jq\nZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXSB7T2JqZWN0LmNsYXNzfSk7CiAgICAg\nICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09\nIDEpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICBpZiAocGFyYW1zWzBdID09IENvbXBhcmF0b3IuY2xhc3Mp\nIHsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShT\nb3J0ZWRTZXQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoU29ydGVkU2V0LmNsYXNzLCAiY29tcGFy\nYXRvciIsIAogICAgICAgICAgICAgICAgICAgIENvbXBhcmF0b3IuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwYXJhbXNbMF0pOwogICAgICAgIH0K\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwg\nIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBhcmFtcyk7CiAgICAgICAgaWYgKHBh\ncmFtcy5sZW5ndGggPT0gMCB8fCBwYXJhbXNbMF0gPT0gQ29tcGFyYXRvci5j\nbGFzcykgewogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShDb2xsZWN0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJhZGRB\nbGwiLCBib29sZWFuLmNsYXNzLCAKICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgQ29sbGVjdGlvbi5jbGFzcyB9KTsKICAgICAgICAgICAgY29kZS5w\nb3AoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIGVsZW1lbnQgdHlwZQog\nICAgICAgIEJDRmllbGQgZWxlbWVudFR5cGUgPSBiYy5kZWNsYXJlRmllbGQo\nImVsZW1lbnRUeXBlIiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIGVsZW1lbnRU\neXBlLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICBtID0gYmMuZGVjbGFy\nZU1ldGhvZCgiZ2V0RWxlbWVudFR5cGUiLCBDbGFzcy5jbGFzcywgbnVsbCk7\nCiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChlbGVtZW50VHlwZSk7\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CgogICAgICAgIC8vIG5ldyBpbnN0YW5jZSBmYWN0b3J5CiAgICAgICAg\nbSA9IGJjLmRlY2xhcmVNZXRob2QoIm5ld0luc3RhbmNlIiwgUHJveHlDb2xs\nZWN0aW9uLmNsYXNzLCAKICAgICAgICAgICAgbmV3IENsYXNzW10geyBDbGFz\ncy5jbGFzcywgQ29tcGFyYXRvci5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsK\nICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKGJjKTsg\nCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBjb25zID0gZmluZENvbXBh\ncmF0b3JDb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBwYXJhbXMgPSAoY29u\ncyA9PSBudWxsKSA/IG5ldyBDbGFzc1swXSA6IGNvbnMuZ2V0UGFyYW1ldGVy\nVHlwZXMoKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKQogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNs\nYXNzLCBwYXJhbXMpOwogICAgICAgIGludCByZXQgPSBjb2RlLmdldE5leHRM\nb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\ncmV0KTsKCiAgICAgICAgLy8gc2V0IGVsZW1lbnQgdHlwZQogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0Rmll\nbGQoZWxlbWVudFR5cGUpOwoKICAgICAgICAvLyBjcmVhdGUgY2hhbmdlIHRy\nYWNrZXIgYW5kIHNldCBpdAogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJh\nbSgyKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlm\nZXEoKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0KTsKICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKENvbGxlY3Rpb25DaGFuZ2VUcmFj\na2VySW1wbC5jbGFzcyk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0KTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoYWxsb3dzRHVwbGljYXRlcyh0eXBlKSk7CiAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGlzT3JkZXJlZCh0eXBlKSk7\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKENvbGxl\nY3Rpb25DaGFuZ2VUcmFja2VySW1wbC5jbGFzcywgCiAgICAgICAgICAgICI8\naW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IENvbGxlY3Rpb24u\nY2xhc3MsIAogICAgICAgICAgICBib29sZWFuLmNsYXNzLCBib29sZWFuLmNs\nYXNzIH0pOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChjaGFu\nZ2VUcmFja2VyKTsKCiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChyZXQpKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBjb2xsZWN0aW9uIHR5cGUgYWxs\nb3dzIGR1cGxpY2F0ZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFu\nIGFsbG93c0R1cGxpY2F0ZXMoQ2xhc3MgdHlwZSkgewogICAgICAgIHJldHVy\nbiAhU2V0LmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gY29sbGVj\ndGlvbiB0eXBlIG1haW50YWlucyBhbiBhcnRpZmljaWFsIAogICAgICogb3Jk\nZXJpbmcuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzT3JkZXJl\nZChDbGFzcyB0eXBlKSB7CiAgICAgICAgcmV0dXJuIExpc3QuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSh0eXBlKQogICAgICAgICAgICB8fCAiamF2YS51dGls\nLkxpbmtlZEhhc2hTZXQiLmVxdWFscyh0eXBlLmdldE5hbWUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIG1ldGhvZHMgaW4gdGhl\nIHtAbGluayBQcm94eU1hcH0gaW50ZXJmYWNlLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkUHJveHlNYXBNZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNz\nIHR5cGUpIHsKICAgICAgICAvLyBjaGFuZ2UgdHJhY2tlcgogICAgICAgIEJD\nRmllbGQgY2hhbmdlVHJhY2tlciA9IGJjLmRlY2xhcmVGaWVsZCgiY2hhbmdl\nVHJhY2tlciIsIAogICAgICAgICAgICBNYXBDaGFuZ2VUcmFja2VyLmNsYXNz\nKTsKICAgICAgICBjaGFuZ2VUcmFja2VyLnNldFRyYW5zaWVudCh0cnVlKTsK\nICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0Q2hh\nbmdlVHJhY2tlciIsIENoYW5nZVRyYWNrZXIuY2xhc3MsIAogICAgICAgICAg\nICBudWxsKTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nY2hhbmdlVHJhY2tlcik7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIG1hcCBjb3B5CiAgICAg\nICAgQ29uc3RydWN0b3IgY29ucyA9IGZpbmRDb3B5Q29uc3RydWN0b3IodHlw\nZSk7CiAgICAgICAgaWYgKGNvbnMgPT0gbnVsbCAmJiBTb3J0ZWRNYXAuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgY29ucyA9\nIGZpbmRDb21wYXJhdG9yQ29uc3RydWN0b3IodHlwZSk7CiAgICAgICAgQ2xh\nc3NbXSBwYXJhbXMgPSAoY29ucyA9PSBudWxsKSA/IG5ldyBDbGFzc1swXSAK\nICAgICAgICAgICAgOiBjb25zLmdldFBhcmFtZXRlclR5cGVzKCk7CgogICAg\nICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2JqZWN0LmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7T2JqZWN0LmNsYXNzfSk7CiAgICAgICAgbS5tYWtl\nUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2Rl\nLmR1cCgpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEpIHsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICBpZiAocGFyYW1zWzBdID09IENvbXBhcmF0b3IuY2xhc3MpIHsKICAgICAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTb3J0ZWRNYXAu\nY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoU29ydGVkTWFwLmNsYXNzLCAiY29tcGFyYXRvciIsIAog\nICAgICAgICAgICAgICAgICAgIENvbXBhcmF0b3IuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICB9IGVsc2UgCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4i\nLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAgICAgIGlmIChwYXJhbXMubGVu\nZ3RoID09IDAgfHwgcGFyYW1zWzBdID09IENvbXBhcmF0b3IuY2xhc3MpIHsK\nICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoTWFwLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJwdXRBbGwiLCB2b2lkLmNsYXNz\nLCAKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgTWFwLmNsYXNzIH0p\nOwogICAgICAgIH0KICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8ga2V5IHR5cGUKICAgICAgICBC\nQ0ZpZWxkIGtleVR5cGUgPSBiYy5kZWNsYXJlRmllbGQoImtleVR5cGUiLCBD\nbGFzcy5jbGFzcyk7CiAgICAgICAga2V5VHlwZS5zZXRUcmFuc2llbnQodHJ1\nZSk7CiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoImdldEtleVR5cGUi\nLCBDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7\nCiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChrZXlUeXBlKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gdmFsdWUgdHlwZQog\nICAgICAgIEJDRmllbGQgdmFsdWVUeXBlID0gYmMuZGVjbGFyZUZpZWxkKCJ2\nYWx1ZVR5cGUiLCBDbGFzcy5jbGFzcyk7CiAgICAgICAgdmFsdWVUeXBlLnNl\ndFRyYW5zaWVudCh0cnVlKTsKICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhv\nZCgiZ2V0VmFsdWVUeXBlIiwgQ2xhc3MuY2xhc3MsIG51bGwpOwogICAgICAg\nIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQodmFsdWVUeXBlKTsKICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAg\nICAgLy8gbmV3IGluc3RhbmNlIGZhY3RvcnkKICAgICAgICBtID0gYmMuZGVj\nbGFyZU1ldGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eU1hcC5jbGFzcywgCiAg\nICAgICAgICAgIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3MsIENsYXNzLmNs\nYXNzLCBDb21wYXJhdG9yLmNsYXNzLCAKICAgICAgICAgICAgYm9vbGVhbi5j\nbGFzcyB9KTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBjb2Rl\nID0gbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICBjb2RlLmFuZXcoKS5zZXRU\neXBlKGJjKTsgCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBjb25zID0g\nZmluZENvbXBhcmF0b3JDb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBwYXJh\nbXMgPSAoY29ucyA9PSBudWxsKSA/IG5ldyBDbGFzc1swXSA6IGNvbnMuZ2V0\nUGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9\nPSAxKQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMik7CiAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4i\nLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAgICAgIGludCByZXQgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCku\nc2V0TG9jYWwocmV0KTsKCiAgICAgICAgLy8gc2V0IGtleSBhbmQgdmFsdWUg\ndHlwZXMKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0KTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5w\ndXRmaWVsZCgpLnNldEZpZWxkKGtleVR5cGUpOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChyZXQpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgxKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQodmFs\ndWVUeXBlKTsKCiAgICAgICAgLy8gY3JlYXRlIGNoYW5nZSB0cmFja2VyIGFu\nZCBzZXQgaXQKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMyk7CiAg\nICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZmVxKCk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJldCk7CiAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZShNYXBDaGFuZ2VUcmFja2VySW1wbC5jbGFzcyk7\nCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwocmV0KTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoTWFwQ2hhbmdlVHJhY2tlckltcGwuY2xhc3MsIAogICAgICAgICAg\nICAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBNYXAuY2xh\nc3MgfSk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGNoYW5n\nZVRyYWNrZXIpOwoKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5hbG9h\nZCgpLnNldExvY2FsKHJldCkpOwogICAgICAgIGNvZGUuYXJldHVybigpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICog\nSW1wbGVtZW50IHRoZSBtZXRob2RzIGluIHRoZSB7QGxpbmsgUHJveHlEYXRl\nfSBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94\neURhdGVNZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsKICAgICAg\nICBib29sZWFuIGhhc0RlZmF1bHRDb25zID0gYmMuZ2V0RGVjbGFyZWRNZXRo\nb2QoIjxpbml0PiIsIAogICAgICAgICAgICAoQ2xhc3NbXSkgbnVsbCkgIT0g\nbnVsbDsKICAgICAgICBib29sZWFuIGhhc01pbGxpc0NvbnMgPSBiYy5nZXRE\nZWNsYXJlZE1ldGhvZCgiPGluaXQ+IiwgCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgbG9uZy5jbGFzcyB9KSAhPSBudWxsOwogICAgICAgIGlmICghaGFz\nRGVmYXVsdENvbnMgJiYgIWhhc01pbGxpc0NvbnMpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgibm8tZGF0\nZS1jb25zIiwgdHlwZSkpOwoKICAgICAgICAvLyBhZGQgYSBkZWZhdWx0IGNv\nbnN0cnVjdG9yIHRoYXQgZGVsZWdhdGVzIHRvIHRoZSBtaWxsaXMgY29uc3Ry\ndWN0b3IKICAgICAgICBCQ01ldGhvZCBtOwogICAgICAgIENvZGUgY29kZTsK\nICAgICAgICBpZiAoIWhhc0RlZmF1bHRDb25zKSB7CiAgICAgICAgICAgIG0g\nPSBiYy5kZWNsYXJlTWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxs\nKTsKICAgICAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgICAgIGNv\nZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCku\nc2V0TWV0aG9kKFN5c3RlbS5jbGFzcywgImN1cnJlbnRUaW1lTWlsbGlzIiwK\nICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7\nIGxvbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwog\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7ICAgICAgICAg\nICAKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGRhdGUgY29weQogICAgICAgIENvbnN0cnVj\ndG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpOwogICAgICAg\nIENsYXNzW10gcGFyYW1zOwogICAgICAgIGlmIChjb25zICE9IG51bGwpCiAg\nICAgICAgICAgIHBhcmFtcyA9IGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsK\nICAgICAgICBlbHNlIGlmIChoYXNNaWxsaXNDb25zKQogICAgICAgICAgICBw\nYXJhbXMgPSBuZXcgQ2xhc3NbXSB7IGxvbmcuY2xhc3MgfTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBDbGFzc1swXTsKCiAgICAg\nICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoImNvcHkiLCBPYmplY3QuY2xhc3Ms\nIG5ldyBDbGFzc1tdIHtPYmplY3QuY2xhc3N9KTsKICAgICAgICBtLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMSkgewogICAg\nICAgICAgICBpZiAocGFyYW1zWzBdID09IGxvbmcuY2xhc3MpIHsKICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRlLmNsYXNzKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChEYXRlLmNsYXNzLCAiZ2V0VGltZSIsIAogICAgICAgICAgICAgICAgICAg\nIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHBhcmFtc1swXSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLCB2b2lkLmNsYXNz\nLCBwYXJhbXMpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApIHsK\nICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoRGF0ZS5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChEYXRlLmNsYXNzLCAiZ2V0VGltZSIsIGxv\nbmcuY2xhc3MsIAogICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0VGlt\nZSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7\nIGxvbmcuY2xhc3MgfSk7CiAgICAgICAgfQogICAgICAgIGlmICgocGFyYW1z\nLmxlbmd0aCA9PSAwIHx8IHBhcmFtc1swXSA9PSBsb25nLmNsYXNzKSAKICAg\nICAgICAgICAgJiYgVGltZXN0YW1wLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\ndHlwZSkpIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoVGltZXN0YW1wLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFRpbWVzdGFtcC5j\nbGFzcywgImdldE5hbm9zIiwgCiAgICAgICAgICAgICAgICBpbnQuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QodHlwZSwgInNldE5hbm9zIiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgICAgIG5ldyBDbGFzc1tdIHsgaW50LmNsYXNzIH0pOwogICAgICAgIH0K\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKCiAgICAgICAgLy8gbmV3IGluc3RhbmNlIGZhY3RvcnkKICAgICAgICBt\nID0gYmMuZGVjbGFyZU1ldGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eURhdGUu\nY2xhc3MsIG51bGwpOyAKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAg\nICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUoYmMpOyAKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1l\nbnQgdGhlIG1ldGhvZHMgaW4gdGhlIHtAbGluayBQcm94eUNhbGVuZGFyfSBp\nbnRlcmZhY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94eUNh\nbGVuZGFyTWV0aG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7CiAgICAg\nICAgLy8gY2FsZW5kYXIgY29weQogICAgICAgIENvbnN0cnVjdG9yIGNvbnMg\nPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpOwogICAgICAgIENsYXNzW10g\ncGFyYW1zID0gKGNvbnMgPT0gbnVsbCkgPyBuZXcgQ2xhc3NbMF0gCiAgICAg\nICAgICAgIDogY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpOwoKICAgICAgICBC\nQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgiY29weSIsIE9iamVjdC5j\nbGFzcywgCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHtPYmplY3QuY2xhc3N9\nKTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGNvZGUuYW5ldygpLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBpZiAocGFy\nYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKHBhcmFtc1swXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFz\ncywgcGFyYW1zKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAwKSB7\nCiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKENhbGVuZGFyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKENhbGVuZGFyLmNsYXNzLCAiZ2V0\nVGltZUluTWlsbGlzIiwgCiAgICAgICAgICAgICAgICBsb25nLmNsYXNzLCBu\ndWxsKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKHR5cGUsICJzZXRUaW1lSW5NaWxsaXMiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW10geyBsb25nLmNsYXNzIH0pOwoKICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoQ2FsZW5kYXIuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoQ2FsZW5kYXIuY2xhc3MsICJpc0xlbmll\nbnQiLCAKICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlw\nZSwgInNldExlbmllbnQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAg\nbmV3IENsYXNzW10geyBib29sZWFuLmNsYXNzIH0pOwoKICAgICAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2Fs\nZW5kYXIuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoQ2FsZW5kYXIuY2xhc3MsICJnZXRGaXJzdERheU9mV2Vl\nayIsIAogICAgICAgICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJz\nZXRGaXJzdERheU9mV2VlayIsIAogICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW10geyBpbnQuY2xhc3MgfSk7CgogICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDYWxl\nbmRhci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChDYWxlbmRhci5jbGFzcywgCiAgICAgICAgICAgICAgICAi\nZ2V0TWluaW1hbERheXNJbkZpcnN0V2VlayIsIGludC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0\neXBlLCAic2V0TWluaW1hbERheXNJbkZpcnN0V2VlayIsIAogICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBpbnQuY2xhc3MgfSk7\nCgogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShDYWxlbmRhci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDYWxlbmRhci5jbGFzcywgImdl\ndFRpbWVab25lIiwgCiAgICAgICAgICAgICAgICBUaW1lWm9uZS5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZCh0eXBlLCAic2V0VGltZVpvbmUiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICAgICAgbmV3IENsYXNzW10geyBUaW1lWm9uZS5jbGFzcyB9KTsKICAg\nICAgICB9CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CgogICAgICAgIC8vIG5ldyBpbnN0YW5jZSBmYWN0b3J5CiAg\nICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoIm5ld0luc3RhbmNlIiwgUHJv\neHlDYWxlbmRhci5jbGFzcywgbnVsbCk7IAogICAgICAgIG0ubWFrZVB1Ymxp\nYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShiYyk7IAogICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5p\ndD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHJveHkg\ndGhlIHByb3RlY3RlZCBjb21wdXRlRmllbGRzIG1ldGhvZCBiL2MgaXQgaXMg\nY2FsbGVkIG9uCiAgICAgICAgLy8gbXV0YXRlLCBhbmQgc29tZSBzZXR0ZXJz\nIGFyZSBmaW5hbCBhbmQgdGhlcmVmb3JlIG5vdCBwcm94eWFibGUKICAgICAg\nICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiY29tcHV0ZUZpZWxkcyIsIHZvaWQu\nY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFrZVByb3RlY3RlZCgpOwogICAg\nICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUodHJ1ZSk7CiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoUHJveGllcy5jbGFzcywgImRpcnR5Iiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgbmV3IENsYXNzW10geyBQcm94eS5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiY29tcHV0\nZUZpZWxkcyIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW1wbGVtZW50IHRoZSBtZXRob2RzIGluIHRoZSB7QGxpbmsg\nUHJveHlCZWFufSBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRQcm94eUJlYW5NZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUs\nIENvbnN0cnVjdG9yIGNvbnMpIHsKICAgICAgICAvLyBiZWFuIGNvcHkKICAg\nICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgiY29weSIsIE9i\namVjdC5jbGFzcywgCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0\nLmNsYXNzIH0pOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENv\nZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgY29kZS5hbmV3\nKCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAg\nIENsYXNzW10gcGFyYW1zID0gY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpOwog\nICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsKICAgICAgICB9CiAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGNvbnMpOwogICAg\nICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApCiAgICAgICAgICAgIGNvcHlQ\ncm9wZXJ0aWVzKHR5cGUsIGNvZGUpOwogICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBuZXcgaW5z\ndGFuY2UgZmFjdG9yeQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJu\nZXdJbnN0YW5jZSIsIFByb3h5QmVhbi5jbGFzcywgCiAgICAgICAgICAgIG5l\ndyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzIH0pOyAKICAgICAgICBtLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUoYmMpOyAKICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEpIHsKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsKICAgICAgICB9\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5p\ndD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAgICAgIGlmIChwYXJhbXMu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIGNvcHlQcm9wZXJ0aWVzKHR5cGUs\nIGNvZGUpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBiZWFuIHBy\nb3BlcnRpZXMuICBDYWxsZWQgd2l0aCB0aGUgY29weSBvYmplY3Qgb24gdGhl\nIHN0YWNrLiAgTXVzdAogICAgICogcmV0dXJuIHdpdGggdGhlIGNvcHkgb2Jq\nZWN0IG9uIHRoZSBzdGFjay4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNv\ncHlQcm9wZXJ0aWVzKENsYXNzIHR5cGUsIENvZGUgY29kZSkgewogICAgICAg\nIGludCBjb3B5ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAg\nICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGNvcHkpOwogICAgICAgIAogICAg\nICAgIE1ldGhvZFtdIG1ldGhzID0gdHlwZS5nZXRNZXRob2RzKCk7CiAgICAg\nICAgTWV0aG9kIGdldHRlcjsKICAgICAgICBpbnQgbW9kczsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IG1ldGhzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIG1vZHMgPSBtZXRoc1tpXS5nZXRNb2RpZmllcnMoKTsgCiAgICAg\nICAgICAgIGlmICghTW9kaWZpZXIuaXNQdWJsaWMobW9kcykgfHwgTW9kaWZp\nZXIuaXNTdGF0aWMobW9kcykpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgaWYgKCFzdGFydHNXaXRoKG1ldGhzW2ldLmdldE5hbWUo\nKSwgInNldCIpCiAgICAgICAgICAgICAgICB8fCBtZXRoc1tpXS5nZXRQYXJh\nbWV0ZXJUeXBlcygpLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIGdldHRlciA9IGZpbmRHZXR0ZXIodHlwZSwg\nbWV0aHNbaV0pOwogICAgICAgICAgICBpZiAoZ2V0dGVyID09IG51bGwpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGNvcHku\nc2V0WFhYKG9yaWcuZ2V0WFhYKCkpOwogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwoY29weSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKHR5cGUpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoZ2V0dGVyKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKG1ldGhzW2ldKTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKGNvcHkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUHJveHkgcmVjb2duaXplZCBtZXRob2RzIHRvIGludm9rZSBoZWxw\nZXJzIGluIGdpdmVuIGhlbHBlciBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHByb3h5UmVjb2duaXplZE1ldGhvZHMoQkNDbGFzcyBiYywgQ2xh\nc3MgdHlwZSwgQ2xhc3MgaGVscGVyLAogICAgICAgIENsYXNzIHByb3h5VHlw\nZSkgewogICAgICAgIE1ldGhvZFtdIG1ldGhzID0gdHlwZS5nZXRNZXRob2Rz\nKCk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXM7CiAgICAgICAgQ2xhc3NbXSBh\nZnRlclBhcmFtczsKICAgICAgICBNZXRob2QgbWF0Y2g7CiAgICAgICAgTWV0\naG9kIGFmdGVyOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcGFyYW1zID0gdG9IZWxwZXJQ\nYXJhbWV0ZXJzKG1ldGhzW2ldLmdldFBhcmFtZXRlclR5cGVzKCksIAogICAg\nICAgICAgICAgICAgcHJveHlUeXBlKTsKCiAgICAgICAgICAgIC8vIGZpcnN0\nIGNoZWNrIGZvciBvdmVycmlkaW5nIG1ldGhvZCAKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIG1hdGNoID0gaGVscGVyLmdldE1ldGhvZCht\nZXRoc1tpXS5nZXROYW1lKCksIHBhcmFtcyk7IAogICAgICAgICAgICAgICAg\ncHJveHlPdmVycmlkZU1ldGhvZChiYywgbWV0aHNbaV0sIG1hdGNoLCBwYXJh\nbXMpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGJlZm9yZSBhbmQgYWZ0ZXIgbWV0\naG9kcywgZWl0aGVyIG9mIHdoaWNoIG1heSBub3QKICAgICAgICAgICAgLy8g\nZXhpc3QKICAgICAgICAgICAgbWF0Y2ggPSBudWxsOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgbWF0Y2ggPSBoZWxwZXIuZ2V0TWV0aG9k\nKCJiZWZvcmUiIAogICAgICAgICAgICAgICAgICAgICsgU3RyaW5nVXRpbHMu\nY2FwaXRhbGl6ZShtZXRoc1tpXS5nZXROYW1lKCkpLCBwYXJhbXMpOwogICAg\nICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkg\newogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgYWZ0ZXIgPSBudWxsOwogICAgICAgICAg\nICBhZnRlclBhcmFtcyA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBhZnRlclBhcmFtcyA9IHRvSGVscGVyQWZ0ZXJQYXJhbWV0\nZXJzKHBhcmFtcywgCiAgICAgICAgICAgICAgICAgICAgbWV0aHNbaV0uZ2V0\nUmV0dXJuVHlwZSgpLCAobWF0Y2ggPT0gbnVsbCkgCiAgICAgICAgICAgICAg\nICAgICAgPyB2b2lkLmNsYXNzIDogbWF0Y2guZ2V0UmV0dXJuVHlwZSgpKTsK\nICAgICAgICAgICAgICAgIGFmdGVyID0gaGVscGVyLmdldE1ldGhvZCgiYWZ0\nZXIiIAogICAgICAgICAgICAgICAgICAgICsgU3RyaW5nVXRpbHMuY2FwaXRh\nbGl6ZShtZXRoc1tpXS5nZXROYW1lKCkpLCBhZnRlclBhcmFtcyk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAobWF0Y2ggIT0gbnVsbCB8fCBhZnRl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgcHJveHlCZWZvcmVBZnRlck1l\ndGhvZChiYywgdHlwZSwgbWV0aHNbaV0sIG1hdGNoLCBwYXJhbXMsIGFmdGVy\nLAogICAgICAgICAgICAgICAgICAgIGFmdGVyUGFyYW1zKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBhcmFtZXRlciB0\neXBlcyB0byB0aGUgY29ycmVzcG9uZGluZyBoZWxwZXIgY2xhc3MgbWV0aG9k\nLgogICAgICovIAogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3NbXSB0b0hlbHBl\nclBhcmFtZXRlcnMoQ2xhc3NbXSBjbHMsIENsYXNzIGhlbHBlcikgewogICAg\nICAgIENsYXNzW10gcGFyYW1zID0gbmV3IENsYXNzW2Nscy5sZW5ndGggKyAx\nXTsKICAgICAgICBwYXJhbXNbMF0gPSBoZWxwZXI7CiAgICAgICAgU3lzdGVt\nLmFycmF5Y29weShjbHMsIDAsIHBhcmFtcywgMSwgY2xzLmxlbmd0aCk7IAog\nICAgICAgIHJldHVybiBwYXJhbXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHBhcmFtZXRlciB0eXBlcyB0byB0aGUgY29ycmVzcG9uZGlu\nZyBoZWxwZXIgY2xhc3MgImFmdGVyIiAgICAgCiAgICAgKiBtZXRob2QuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNzW10gdG9IZWxwZXJBZnRl\nclBhcmFtZXRlcnMoQ2xhc3NbXSBjbHMsIENsYXNzIHJldCwKICAgICAgICBD\nbGFzcyBiZWZvcmVSZXQpIHsKICAgICAgICBpZiAocmV0ID09IHZvaWQuY2xh\nc3MgJiYgYmVmb3JlUmV0ID09IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIHJl\ndHVybiBjbHM7CiAgICAgICAgaW50IGxlbiA9IGNscy5sZW5ndGg7CiAgICAg\nICAgaWYgKHJldCAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBsZW4rKzsK\nICAgICAgICBpZiAoYmVmb3JlUmV0ICE9IHZvaWQuY2xhc3MpCiAgICAgICAg\nICAgIGxlbisrOwogICAgICAgIENsYXNzW10gcGFyYW1zID0gbmV3IENsYXNz\nW2xlbl07CiAgICAgICAgU3lzdGVtLmFycmF5Y29weShjbHMsIDAsIHBhcmFt\ncywgMCwgY2xzLmxlbmd0aCk7CiAgICAgICAgaW50IHBvcyA9IGNscy5sZW5n\ndGg7CiAgICAgICAgaWYgKHJldCAhPSB2b2lkLmNsYXNzKQogICAgICAgICAg\nICBwYXJhbXNbcG9zKytdID0gcmV0OwogICAgICAgIGlmIChiZWZvcmVSZXQg\nIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgcGFyYW1zW3BvcysrXSA9IGJl\nZm9yZVJldDsKICAgICAgICByZXR1cm4gcGFyYW1zOwogICAgfQoKICAgIC8q\nKgogICAgICogUHJveHkgc2V0dGVyIG1ldGhvZHMgb2YgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB3ZSBmaW5kIGFu\neSBzZXR0ZXJzLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHByb3h5U2V0dGVycyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgTWV0aG9kW10gbWV0aHMgPSB0eXBlLmdldE1ldGhvZHMo\nKTsKICAgICAgICBpbnQgc2V0dGVycyA9IDA7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBtZXRocy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoaXNTZXR0ZXIobWV0aHNbaV0pICYmICFNb2RpZmllci5pc0ZpbmFsKG1l\ndGhzW2ldLmdldE1vZGlmaWVycygpKQogICAgICAgICAgICAgICAgJiYgYmMu\nZ2V0RGVjbGFyZWRNZXRob2QobWV0aHNbaV0uZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgbWV0aHNbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKSkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgc2V0dGVycysrOwogICAgICAgICAgICAg\nICAgcHJveHlTZXR0ZXIoYmMsIHR5cGUsIG1ldGhzW2ldKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gCiAgICAgICAgcmV0dXJuIHNldHRlcnMgPiAwOwog\nICAgfQoKICAgIC8qKgogICAgICogUHJveHkgdGhlIGdpdmVuIG1ldGhvZCB3\naXRoIG9uZSB0aGF0IG92ZXJyaWRlcyBpdCBieSBjYWxsaW5nIGludG8gdGhl\nCiAgICAgKiBnaXZlbiBoZWxwZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwcm94eU92ZXJyaWRlTWV0aG9kKEJDQ2xhc3MgYmMsIE1ldGhvZCBtZXRo\nLCAKICAgICAgICBNZXRob2QgaGVscGVyLCBDbGFzc1tdIHBhcmFtcykgewog\nICAgICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKG1ldGguZ2V0\nTmFtZSgpLCBtZXRoLmdldFJldHVyblR5cGUoKSwKICAgICAgICAgICAgbWV0\naC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDE7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNv\nZGUueGxvYWQoKS5zZXRQYXJhbShpIC0gMSkuc2V0VHlwZShwYXJhbXNbaV0p\nOwogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKGhlbHBl\ncik7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShtZXRoLmdldFJl\ndHVyblR5cGUoKSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogUHJveHkgdGhlIGdpdmVuIG1ldGhvZCB3aXRoIG9u\nZSB0aGF0IG92ZXJyaWRlcyBpdCBieSBjYWxsaW5nIGludG8gdGhlCiAgICAg\nKiBnaXZlbiBoZWxwZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm94\neUJlZm9yZUFmdGVyTWV0aG9kKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUsIE1l\ndGhvZCBtZXRoLCAKICAgICAgICBNZXRob2QgYmVmb3JlLCBDbGFzc1tdIHBh\ncmFtcywgTWV0aG9kIGFmdGVyLCBDbGFzc1tdIGFmdGVyUGFyYW1zKSB7CiAg\nICAgICAgQkNNZXRob2QgbSA9IGJjLmRlY2xhcmVNZXRob2QobWV0aC5nZXRO\nYW1lKCksIG1ldGguZ2V0UmV0dXJuVHlwZSgpLAogICAgICAgICAgICBtZXRo\nLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIG0ubWFrZVB1YmxpYygp\nOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gaW52b2tlIGJlZm9yZQogICAgICAgIGludCBiZWZvcmVSZXQgPSAt\nMTsKICAgICAgICBpZiAoYmVmb3JlICE9IG51bGwpIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDE7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSAtIDEpLnNldFR5cGUocGFyYW1z\nW2ldKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoYmVmb3JlKTsKICAgICAgICAgICAgaWYgKGFmdGVyICE9IG51bGwgJiYg\nYmVmb3JlLmdldFJldHVyblR5cGUoKSAhPSB2b2lkLmNsYXNzKSB7CiAgICAg\nICAgICAgICAgICBiZWZvcmVSZXQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRl\neCgpOwogICAgICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbChi\nZWZvcmVSZXQpLgogICAgICAgICAgICAgICAgICAgIHNldFR5cGUoYmVmb3Jl\nLmdldFJldHVyblR5cGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIGludm9rZSBzdXBlcgogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRUaGlzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBwYXJhbXMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJh\nbShpIC0gMSkuc2V0VHlwZShwYXJhbXNbaV0pOwogICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCBtZXRoLmdldE5hbWUoKSwg\nCiAgICAgICAgICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBh\ncmFtZXRlclR5cGVzKCkpOwoKICAgICAgICAvLyBpbnZva2UgYWZ0ZXIgCiAg\nICAgICAgaWYgKGFmdGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaW50IHJl\ndCA9IC0xOwogICAgICAgICAgICBpZiAobWV0aC5nZXRSZXR1cm5UeXBlKCkg\nIT0gdm9pZC5jbGFzcykgewogICAgICAgICAgICAgICAgcmV0ID0gY29kZS5n\nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgIGNvZGUueHN0\nb3JlKCkuc2V0TG9jYWwocmV0KS5zZXRUeXBlKG1ldGguZ2V0UmV0dXJuVHlw\nZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBh\ncmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUueGxvYWQo\nKS5zZXRQYXJhbShpIC0gMSkuc2V0VHlwZShwYXJhbXNbaV0pOwogICAgICAg\nICAgICBpZiAocmV0ICE9IC0xKQogICAgICAgICAgICAgICAgY29kZS54bG9h\nZCgpLnNldExvY2FsKHJldCkuc2V0VHlwZShtZXRoLmdldFJldHVyblR5cGUo\nKSk7CiAgICAgICAgICAgIGlmIChiZWZvcmVSZXQgIT0gLTEpCiAgICAgICAg\nICAgICAgICBjb2RlLnhsb2FkKCkuc2V0TG9jYWwoYmVmb3JlUmV0KS4KICAg\nICAgICAgICAgICAgICAgICBzZXRUeXBlKGJlZm9yZS5nZXRSZXR1cm5UeXBl\nKCkpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChhZnRlcik7CiAgICAgICAgfQogICAgICAgIGNvZGUueHJldHVybigpLnNl\ndFR5cGUobWV0aC5nZXRSZXR1cm5UeXBlKCkpOwoKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBtZXRob2QgaXMgYSBzZXR0ZXIuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBib29sZWFuIGlzU2V0dGVyKE1ldGhvZCBtZXRoKSB7CiAgICAg\nICAgcmV0dXJuIHN0YXJ0c1dpdGgobWV0aC5nZXROYW1lKCksICJzZXQiKQog\nICAgICAgICAgICB8fCBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAiYWRk\nIikKICAgICAgICAgICAgfHwgc3RhcnRzV2l0aChtZXRoLmdldE5hbWUoKSwg\nInJlbW92ZSIpCiAgICAgICAgICAgIHx8IHN0YXJ0c1dpdGgobWV0aC5nZXRO\nYW1lKCksICJpbnNlcnQiKQogICAgICAgICAgICB8fCBzdGFydHNXaXRoKG1l\ndGguZ2V0TmFtZSgpLCAiY2xlYXIiKQogICAgICAgICAgICB8fCBzdGFydHNX\naXRoKG1ldGguZ2V0TmFtZSgpLCAicm9sbCIpOyAvLyB1c2VkIGJ5IENhbGVu\nZGFyCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGdldHRlciBj\nb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBzZXR0ZXIsIG9yIG51bGwuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBNZXRob2QgZmluZEdldHRlcihDbGFzcyB0\neXBlLCBNZXRob2Qgc2V0dGVyKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBz\nZXR0ZXIuZ2V0TmFtZSgpLnN1YnN0cmluZygzKTsKICAgICAgICBDbGFzcyBw\nYXJhbSA9IHNldHRlci5nZXRQYXJhbWV0ZXJUeXBlcygpWzBdOwogICAgICAg\nIE1ldGhvZCBnZXR0ZXI7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZ2V0\ndGVyID0gdHlwZS5nZXRNZXRob2QoImdldCIgKyBuYW1lLCAoQ2xhc3NbXSkg\nbnVsbCk7ICAgCiAgICAgICAgICAgIGlmIChnZXR0ZXIuZ2V0UmV0dXJuVHlw\nZSgpLmlzQXNzaWduYWJsZUZyb20ocGFyYW0pCiAgICAgICAgICAgICAgICB8\nfCBwYXJhbS5pc0Fzc2lnbmFibGVGcm9tKGdldHRlci5nZXRSZXR1cm5UeXBl\nKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgICAgICB9\nIGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKHBhcmFtID09IGJvb2xlYW4uY2xhc3MgfHwgcGFyYW0gPT0gQm9vbGVhbi5j\nbGFzcykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZ2V0\ndGVyID0gdHlwZS5nZXRNZXRob2QoImlzIiArIG5hbWUsIChDbGFzc1tdKSBu\ndWxsKTsgICAKICAgICAgICAgICAgICAgIGlmIChnZXR0ZXIuZ2V0UmV0dXJu\nVHlwZSgpLmlzQXNzaWduYWJsZUZyb20ocGFyYW0pCiAgICAgICAgICAgICAg\nICAgICAgfHwgcGFyYW0uaXNBc3NpZ25hYmxlRnJvbShnZXR0ZXIuZ2V0UmV0\ndXJuVHlwZSgpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0dGVy\nOwogICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24g\nbnNtZSkgewogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgdGFy\nZ2V0IHN0cmluZyBzdGFycyB3aXRoIHRoZSBnaXZlbiB0b2tlbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBzdGFydHNXaXRoKFN0cmlu\nZyBzdHIsIFN0cmluZyB0b2tlbikgewogICAgICAgIHJldHVybiBzdHIuc3Rh\ncnRzV2l0aCh0b2tlbikKICAgICAgICAgICAgJiYgKHN0ci5sZW5ndGgoKSA9\nPSB0b2tlbi5sZW5ndGgoKSAKICAgICAgICAgICAgfHwgQ2hhcmFjdGVyLmlz\nVXBwZXJDYXNlKHN0ci5jaGFyQXQodG9rZW4ubGVuZ3RoKCkpKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQcm94eSB0aGUgZ2l2ZW4gc2V0dGVyIG1ldGhv\nZCB0byBkaXJ0eSB0aGUgcHJveHkgb3duZXIuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwcm94eVNldHRlcihCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlLCBN\nZXRob2QgbWV0aCkgewogICAgICAgIENsYXNzW10gcGFyYW1zID0gbWV0aC5n\nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgIENsYXNzIHJldCA9IG1ldGgu\nZ2V0UmV0dXJuVHlwZSgpOwogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNs\nYXJlTWV0aG9kKG1ldGguZ2V0TmFtZSgpLCByZXQsIHBhcmFtcyk7CiAgICAg\nICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbS5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFByb3hpZXMuY2xhc3Ms\nICJkaXJ0eSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1td\nIHsgUHJveHkuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgY29kZS54bG9h\nZCgpLnNldFBhcmFtKGkpLnNldFR5cGUocGFyYW1zW2ldKTsKICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgbWV0aC5nZXRO\nYW1lKCksIHJldCwgcGFyYW1zKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5z\nZXRUeXBlKHJldCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgYSB3cml0ZVJlcGxhY2UgaW1wbGVtZW50YXRp\nb24gdGhhdCBzZXJpYWxpemVzIHRvIGEgbm9uLXByb3h5IHR5cGUKICAgICAq\nIHVubGVzcyBkZXRhY2hlZCBhbmQgdGhpcyBpcyBhIGJ1aWxkLXRpbWUgZ2Vu\nZXJhdGVkIGNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkV3Jp\ndGVSZXBsYWNlTWV0aG9kKEJDQ2xhc3MgYmMsIGJvb2xlYW4gcnVudGltZSkg\newogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJ3cml0\nZVJlcGxhY2UiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFr\nZVByb3RlY3RlZCgpOwogICAgICAgIG0uZ2V0RXhjZXB0aW9ucyh0cnVlKS5h\nZGRFeGNlcHRpb24oT2JqZWN0U3RyZWFtRXhjZXB0aW9uLmNsYXNzKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoIXJ1bnRpbWUpOwogICAgICAgIGNvZGUuaW52b2tlc3RhdGlj\nKCkuc2V0TWV0aG9kKFByb3hpZXMuY2xhc3MsICJ3cml0ZVJlcGxhY2UiLCAK\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXSB7IFByb3h5\nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgdW5pcXVlIGlkIHRvIGF2b2lkIHByb3h5IGNsYXNz\nIG5hbWUgY29uZmxpY3RzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBz\neW5jaHJvbml6ZWQgbG9uZyBuZXh0UHJveHlJZCgpIHsKICAgICAgICByZXR1\ncm4gX3Byb3h5SWQrKzsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgYW4g\nYXBwcm9wcmlhdGUgY29weSBjb25zdHJ1Y3RvciBmb3IgdGhlIGdpdmVuIHR5\ncGUsIG9yIHJldHVybiBudWxsCiAgICAgKiBpZiBub25lLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ29uc3RydWN0b3IgZmluZENvcHlDb25zdHJ1Y3RvcihD\nbGFzcyBjbHMpIHsKICAgICAgICBDb25zdHJ1Y3RvcltdIGNvbnMgPSBjbHMu\nZ2V0Q29uc3RydWN0b3JzKCk7CiAgICAgICAgQ29uc3RydWN0b3IgbWF0Y2gg\nPSBudWxsOwogICAgICAgIENsYXNzIG1hdGNoUGFyYW0gPSBudWxsOwogICAg\nICAgIENsYXNzW10gcGFyYW1zOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwYXJhbXMgPSBj\nb25zW2ldLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgICAgIGlmIChw\nYXJhbXMubGVuZ3RoICE9IDEpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIC8vIHF1aXQgaW1tZWRpYXRlbHkgb24gZXhhY3QgbWF0\nY2gKICAgICAgICAgICAgaWYgKHBhcmFtc1swXSA9PSBjbHMpCiAgICAgICAg\nICAgICAgICByZXR1cm4gY29uc1tpXTsKCiAgICAgICAgICAgIGlmIChwYXJh\nbXNbMF0uaXNBc3NpZ25hYmxlRnJvbShjbHMpICYmIChtYXRjaFBhcmFtID09\nIG51bGwKICAgICAgICAgICAgICAgIHx8IG1hdGNoUGFyYW0uaXNBc3NpZ25h\nYmxlRnJvbShwYXJhbXNbMF0pKSkgewogICAgICAgICAgICAgICAgIC8vIHRy\nYWNrIG1vc3QgZGVyaXZlZCBjb2xsZWN0aW9uIGNvbnN0cnVjdG9yCiAgICAg\nICAgICAgICAgICBtYXRjaCA9IGNvbnNbaV07CiAgICAgICAgICAgICAgICBt\nYXRjaFBhcmFtID0gcGFyYW1zWzBdOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBtYXRjaDsgCiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNvbnN0cnVjdG9yIHRoYXQgdGFrZXMgYSBjb21wYXJh\ndG9yIGZvciB0aGUgZ2l2ZW4gdHlwZSwgb3IKICAgICAqIG51bGwgaWYgbm9u\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29uc3RydWN0b3IgZmlu\nZENvbXBhcmF0b3JDb25zdHJ1Y3RvcihDbGFzcyBjbHMpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gY2xzLmdldENvbnN0cnVjdG9yKG5l\ndyBDbGFzc1tdIHsgQ29tcGFyYXRvci5jbGFzcyB9KTsKICAgICAgICB9IGNh\ndGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5wcm94eS5Qcm94eU1hbmFnZXJJbXBs\nIFtvcHRpb25dKgogICAgICogJmx0O2NsYXNzIG5hbWUmZ3Q7KzxiciAvPgog\nICAgICogV2hlcmUgdGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25p\nemVkOgogICAgICogPHVsPiAKICAgICAqIDxsaT48aT4tdXRpbHMvLXUgJmx0\nO251bWJlciZndDs8L2k+OiBHZW5lcmF0ZSBwcm94aWVzIGZvciB0aGUgc3Rh\nbmRhcmQKICAgICAqIGphdmEudXRpbCBjb2xsZWN0aW9uLCBtYXAsIGRhdGUs\nIGFuZCBjYWxlbmRhciBjbGFzc2VzIG9mIHRoZSBnaXZlbiBKYXZhCiAgICAg\nKiB2ZXJzaW9uLiAgVXNlIDQgZm9yIEphdmEgMS40LCA1IGZvciBKYXZhIDUs\nIGV0Yy48L2xpPgogICAgICogPC91bD4KICAgICAqCiAgICAgKiBUaGUgbWFp\nbiBtZXRob2QgZ2VuZXJhdGVzIC5jbGFzcyBmaWxlcyBmb3IgdGhlIHByb3hp\nZXMgdG8gdGhlIGNsYXNzZXMgICAgCiAgICAgKiBnaXZlbiBvbiB0aGUgY29t\nbWFuZCBsaW5lLiAgSXQgd3JpdGVzIHRoZSBnZW5lcmF0ZWQgY2xhc3NlcyB0\nbyBiZXNpZGUgdGhlCiAgICAgKiBQcm94eU1hbmFnZXJJbXBsLmNsYXNzIGZp\nbGUgaWYgcG9zc2libGU7IG90aGVyd2lzZSBpdCB3cml0ZXMgdG8gdGhlIAog\nICAgICogY3VycmVudCBkaXJlY3RvcnkuICBUaGUgcHJveHkgbWFuYWdlciBs\nb29rcyBmb3IgdGhlc2UgY2xhc3NlcyAKICAgICAqIGJlZm9yZSBnZW5lcmF0\naW5nIGl0cyBvd24gcHJveGllcyBhdCBydW50aW1lLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSAKICAgICAg\nICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24g\newogICAgICAgIEZpbGUgZGlyID0gRmlsZXMuZ2V0Q2xhc3NGaWxlKFByb3h5\nTWFuYWdlckltcGwuY2xhc3MpOwogICAgICAgIGRpciA9IChkaXIgPT0gbnVs\nbCkgPyBuZXcgRmlsZShTeXN0ZW0uZ2V0UHJvcGVydHkoInVzZXIuZGlyIikp\nCiAgICAgICAgICAgIDogZGlyLmdldFBhcmVudEZpbGUoKTsKCiAgICAgICAg\nT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBhcmdzID0g\nb3B0cy5zZXRGcm9tQ21kTGluZShhcmdzKTsKCiAgICAgICAgTGlzdCB0eXBl\ncyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICB0eXBlcy5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChhcmdzKSk7CiAgICAgICAgaW50IHV0aWxzID0gb3B0cy5y\nZW1vdmVJbnRQcm9wZXJ0eSgidXRpbHMiLCAidSIsIDApOwogICAgICAgIGlm\nICh1dGlscyA+PSA0KSB7CiAgICAgICAgICAgIHR5cGVzLmFkZEFsbChBcnJh\neXMuYXNMaXN0KG5ldyBTdHJpbmdbXSB7CiAgICAgICAgICAgICAgICBqYXZh\nLnNxbC5EYXRlLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGph\ndmEuc3FsLlRpbWUuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAg\namF2YS5zcWwuVGltZXN0YW1wLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgIGphdmEudXRpbC5BcnJheUxpc3QuY2xhc3MuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgamF2YS51dGlsLkRhdGUuY2xhc3MuZ2V0TmFtZSgp\nLAogICAgICAgICAgICAgICAgamF2YS51dGlsLkdyZWdvcmlhbkNhbGVuZGFy\nLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGphdmEudXRpbC5I\nYXNoTWFwLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGphdmEu\ndXRpbC5IYXNoU2V0LmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nIGphdmEudXRpbC5IYXNodGFibGUuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgamF2YS51dGlsLkxpbmtlZExpc3QuY2xhc3MuZ2V0TmFtZSgp\nLAogICAgICAgICAgICAgICAgamF2YS51dGlsLlByb3BlcnRpZXMuY2xhc3Mu\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLlRyZWVNYXAu\nY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLlRy\nZWVTZXQuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51\ndGlsLlZlY3Rvci5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgIH0pKTsg\nCiAgICAgICAgfQogICAgICAgIGlmICh1dGlscyA+PSA1KSB7CiAgICAgICAg\nICAgIHR5cGVzLmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXSB7\nCiAgICAgICAgICAgICAgICAiamF2YS51dGlsLkVudW1NYXAiLAogICAgICAg\nICAgICAgICAgImphdmEudXRpbC5JZGVudGl0eUhhc2hNYXAiLAogICAgICAg\nICAgICAgICAgImphdmEudXRpbC5MaW5rZWRIYXNoTWFwIiwKICAgICAgICAg\nICAgICAgICJqYXZhLnV0aWwuTGlua2VkSGFzaFNldCIsCiAgICAgICAgICAg\nICAgICAiamF2YS51dGlsLlByaW9yaXR5UXVldWUiLAogICAgICAgICAgICB9\nKSk7IAogICAgICAgIH0KCiAgICAgICAgUHJveHlNYW5hZ2VySW1wbCBtZ3Ig\nPSBuZXcgUHJveHlNYW5hZ2VySW1wbCgpOwogICAgICAgIENsYXNzIGNsczsK\nICAgICAgICBCQ0NsYXNzIGJjOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgdHlwZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgY2xzID0gQ2xh\nc3MuZm9yTmFtZSgoU3RyaW5nKSB0eXBlcy5nZXQoaSkpOwogICAgICAgICAg\nICBpZiAobWdyLmxvYWRCdWlsZFRpbWVQcm94eShjbHMsIGdldE1vc3REZXJp\ndmVkTG9hZGVyKGNscywgCiAgICAgICAgICAgICAgICBQcm94eS5jbGFzcykp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIGlmIChDb2xsZWN0aW9uLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xz\nKSkKICAgICAgICAgICAgICAgIGJjID0gbWdyLmdlbmVyYXRlUHJveHlDb2xs\nZWN0aW9uQnl0ZWNvZGUoY2xzLCBmYWxzZSk7ICAgICAgICAgCiAgICAgICAg\nICAgIGVsc2UgaWYgKE1hcC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykp\nCiAgICAgICAgICAgICAgICBiYyA9IG1nci5nZW5lcmF0ZVByb3h5TWFwQnl0\nZWNvZGUoY2xzLCBmYWxzZSk7ICAgICAgICAgCiAgICAgICAgICAgIGVsc2Ug\naWYgKERhdGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAg\nICAgICAgICAgYmMgPSBtZ3IuZ2VuZXJhdGVQcm94eURhdGVCeXRlY29kZShj\nbHMsIGZhbHNlKTsKICAgICAgICAgICAgZWxzZSBpZiAoQ2FsZW5kYXIuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICAgICAgYmMg\nPSBtZ3IuZ2VuZXJhdGVQcm94eUNhbGVuZGFyQnl0ZWNvZGUoY2xzLCBmYWxz\nZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJjID0gbWdy\nLmdlbmVyYXRlUHJveHlCZWFuQnl0ZWNvZGUoY2xzLCBmYWxzZSk7CgogICAg\nICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oYmMuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgYmMud3JpdGUobmV3IEZpbGUoZGlyLCBiYy5nZXRDbGFzc05h\nbWUoKSArICIuY2xhc3MiKSk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

