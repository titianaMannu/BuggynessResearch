{"sha":"febbb2d4652fefb1bc0053ba45cf5cf4c2b70f31","node_id":"MDQ6QmxvYjIwNjM2NDpmZWJiYjJkNDY1MmZlZmIxYmMwMDUzYmE0NWNmNWNmNGMyYjcwZjMx","size":22559,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/febbb2d4652fefb1bc0053ba45cf5cf4c2b70f31","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5N\naXNzaW5nUmVzb3VyY2VFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuUHJv\ncGVydGllczsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IGph\ndmF4Lm5hbWluZy5Db250ZXh0OwppbXBvcnQgamF2YXgubmFtaW5nLkluaXRp\nYWxDb250ZXh0OwppbXBvcnQgamF2YXgubmFtaW5nLk5hbWluZ0V4Y2VwdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGls\nczsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5O\nZXN0YWJsZVJ1bnRpbWVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuUGFyc2VFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFz\naE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5jb25j\ndXJyZW50LkNvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwOwoKaW1wb3J0IHNl\ncnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFV0aWxpdHkgbWV0aG9kcyBkZWFs\naW5nIHdpdGggY29uZmlndXJhdGlvbi4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIENvbmZpZ3VyYXRp\nb25zIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKENvbmZpZ3VyYXRp\nb25zLmNsYXNzKTsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgQ29uY3VycmVu\ndFJlZmVyZW5jZUhhc2hNYXAgX2xvYWRlcnMgPSBuZXcgCiAgICAgICAgQ29u\nY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoQ29uY3VycmVudFJlZmVyZW5jZUhh\nc2hNYXAuV0VBSywgCiAgICAgICAgICAgICAgICBDb25jdXJyZW50UmVmZXJl\nbmNlSGFzaE1hcC5IQVJEKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBP\nYmplY3QgTlVMTF9MT0FERVIgPSAibnVsbC1sb2FkZXIiOwoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjbGFzcyBuYW1lIGZyb20gdGhlIGdpdmVuIHBs\ndWdpbiBzdHJpbmcsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBTdHJpbmcgZ2V0Q2xhc3NOYW1lKFN0cmluZyBwbHVnaW4p\nIHsKICAgICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdpbiwg\ndHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3Bl\ncnRpZXMgcGFydCBvZiB0aGUgZ2l2ZW4gcGx1Z2luIHN0cmluZywgb3IgbnVs\nbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBn\nZXRQcm9wZXJ0aWVzKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1cm4g\nZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdpbiwgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGVpdGhlciB0aGUgY2xhc3MgbmFtZSBvciBw\ncm9wZXJ0aWVzIHN0cmluZyBmcm9tIGEgcGx1Z2luIHN0cmluZy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFBsdWdpbkNvbXBvbmVu\ndChTdHJpbmcgcGx1Z2luLCBib29sZWFuIGNsc05hbWUpIHsKICAgICAgICBp\nZiAocGx1Z2luICE9IG51bGwpCiAgICAgICAgICAgIHBsdWdpbiA9IHBsdWdp\nbi50cmltKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocGx1\nZ2luKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGludCBv\ncGVuUGFyZW4gPSAtMTsKICAgICAgICBpZiAocGx1Z2luLmNoYXJBdChwbHVn\naW4ubGVuZ3RoKCkgLSAxKSA9PSAnKScpCiAgICAgICAgICAgIG9wZW5QYXJl\nbiA9IHBsdWdpbi5pbmRleE9mKCcoJyk7CiAgICAgICAgaWYgKG9wZW5QYXJl\nbiA9PSAtMSkgewogICAgICAgICAgICBpbnQgZXEgPSBwbHVnaW4uaW5kZXhP\nZignPScpOwogICAgICAgICAgICBpZiAoZXEgPT0gLTEpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKGNsc05hbWUpID8gcGx1Z2luIDogbnVsbDsKICAgICAg\nICAgICAgcmV0dXJuIChjbHNOYW1lKSA/IG51bGwgOiBwbHVnaW47CiAgICAg\nICAgfQoKICAgICAgICAvLyBjbHNOYW1lKHByb3BzKSBmb3JtCiAgICAgICAg\naWYgKGNsc05hbWUpCiAgICAgICAgICAgIHJldHVybiBwbHVnaW4uc3Vic3Ry\naW5nKDAsIG9wZW5QYXJlbikudHJpbSgpOwogICAgICAgIFN0cmluZyBwcm9w\nID0gcGx1Z2luLnN1YnN0cmluZyhvcGVuUGFyZW4gKyAxLAogICAgICAgICAg\nICBwbHVnaW4ubGVuZ3RoKCkgLSAxKS50cmltKCk7CiAgICAgICAgcmV0dXJu\nIChwcm9wLmxlbmd0aCgpID09IDApID8gbnVsbCA6IHByb3A7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGFu\nZCBwcm9wZXJ0aWVzIGludG8gYSBwbHVnaW4gc3RyaW5nLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRQbHVnaW4oU3RyaW5nIGNsc05h\nbWUsIFN0cmluZyBwcm9wcykgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KGNsc05hbWUpKQogICAgICAgICAgICByZXR1cm4gcHJvcHM7CiAg\nICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcHMpKQogICAgICAg\nICAgICByZXR1cm4gY2xzTmFtZTsKICAgICAgICByZXR1cm4gY2xzTmFtZSAr\nICIoIiArIHByb3BzICsgIikiOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgcGx1Z2luIHN0cmluZyB0aGF0IGNvbWJpbmVzIHRoZSBwcm9wZXJ0\naWVzIG9mIHRoZSBnaXZlbiBwbHVnaW4KICAgICAqIHN0cmluZ3MsIHdoZXJl\nIHByb3BlcnRpZXMgb2YgPGNvZGU+b3ZlcnJpZGU8L2NvZGU+IHdpbGwgb3Zl\ncnJpZGUgdGhlCiAgICAgKiBzYW1lIHByb3BlcnRpZXMgb2YgPGNvZGU+b3Jp\nZzwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGNv\nbWJpbmVQbHVnaW5zKFN0cmluZyBvcmlnLCBTdHJpbmcgb3ZlcnJpZGUpIHsK\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnKSkKICAgICAg\nICAgICAgcmV0dXJuIG92ZXJyaWRlOwogICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KG92ZXJyaWRlKSkKICAgICAgICAgICAgcmV0dXJuIG9yaWc7\nCgogICAgICAgIFN0cmluZyBvcmlnQ2xzID0gZ2V0Q2xhc3NOYW1lKG9yaWcp\nOwogICAgICAgIFN0cmluZyBvdmVycmlkZUNscyA9IGdldENsYXNzTmFtZShv\ndmVycmlkZSk7CiAgICAgICAgU3RyaW5nIGNsczsKICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuaXNFbXB0eShvcmlnQ2xzKSkKICAgICAgICAgICAgY2xzID0g\nb3ZlcnJpZGVDbHM7CiAgICAgICAgZWxzZSBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShvdmVycmlkZUNscykpCiAgICAgICAgICAgIGNscyA9IG9yaWdDbHM7\nCiAgICAgICAgZWxzZSBpZiAoIW9yaWdDbHMuZXF1YWxzKG92ZXJyaWRlQ2xz\nKSkKICAgICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOyAvLyBjb21wbGV0ZWx5\nIGRpZmZlcmVudCBwbHVnaW4KICAgICAgICBlbHNlCiAgICAgICAgICAgIGNs\ncyA9IG9yaWdDbHM7CgogICAgICAgIFN0cmluZyBvcmlnUHJvcHMgPSBnZXRQ\ncm9wZXJ0aWVzKG9yaWcpOwogICAgICAgIFN0cmluZyBvdmVycmlkZVByb3Bz\nID0gZ2V0UHJvcGVydGllcyhvdmVycmlkZSk7CiAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkob3JpZ1Byb3BzKSkKICAgICAgICAgICAgcmV0dXJu\nIGdldFBsdWdpbihjbHMsIG92ZXJyaWRlUHJvcHMpOwogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KG92ZXJyaWRlUHJvcHMpKQogICAgICAgICAg\nICByZXR1cm4gZ2V0UGx1Z2luKGNscywgb3JpZ1Byb3BzKTsKCiAgICAgICAg\nUHJvcGVydGllcyBwcm9wcyA9IHBhcnNlUHJvcGVydGllcyhvcmlnUHJvcHMp\nOwogICAgICAgIHByb3BzLnB1dEFsbChwYXJzZVByb3BlcnRpZXMob3ZlcnJp\nZGVQcm9wcykpOwogICAgICAgIHJldHVybiBnZXRQbHVnaW4oY2xzLCBzZXJp\nYWxpemVQcm9wZXJ0aWVzKHByb3BzKSk7IAogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIHRoZSBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiBjbGFzcyBu\nYW1lLCB1c2luZyB0aGUgZ2l2ZW4KICAgICAqIGNsYXNzIGxvYWRlci4gTm8g\nY29uZmlndXJhdGlvbiBvZiB0aGUgaW5zdGFuY2UgaXMgcGVyZm9ybWVkIGJ5\nCiAgICAgKiB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBPYmplY3QgbmV3SW5zdGFuY2UoU3RyaW5nIGNsc05hbWUsIENsYXNzTG9h\nZGVyIGxvYWRlcikgewogICAgICAgIHJldHVybiBuZXdJbnN0YW5jZShjbHNO\nYW1lLCBudWxsLCBudWxsLCBsb2FkZXIsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGFuZCBjb25maWd1cmUgYW4gaW5zdGFuY2Ugd2l0\naCB0aGUgZ2l2ZW4gY2xhc3MgbmFtZSBhbmQKICAgICAqIHByb3BlcnRpZXMu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNl\nKFN0cmluZyBjbHNOYW1lLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAg\nU3RyaW5nIHByb3BzLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBP\nYmplY3Qgb2JqID0gbmV3SW5zdGFuY2UoY2xzTmFtZSwgbnVsbCwgY29uZiwg\nbG9hZGVyLCB0cnVlKTsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmos\nIGNvbmYsIHByb3BzKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAg\nIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB1c2VkIGJ5IG1lbWJlcnMgb2Yg\ndGhpcyBwYWNrYWdlIHRvIGluc3RhbnRpYXRlIHBsdWdpbgogICAgICogdmFs\ndWVzLgogICAgICovCiAgICBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0\ncmluZyBjbHNOYW1lLCBWYWx1ZSB2YWwsIENvbmZpZ3VyYXRpb24gY29uZiwK\nICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZmF0YWwpIHsK\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjbHNOYW1lKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzIGNscyA9IG51\nbGw7IAoKICAgICAgICAvLyBjYW4ndCBoYXZlIGEgbnVsbCByZWZlcmVuY2Ug\naW4gdGhlIG1hcCwgc28gdXNlIHN5bWJvbGljIAogICAgICAgIC8vIGNvbnN0\nYW50IGFzIGtleQogICAgICAgIE9iamVjdCBrZXkgPSBsb2FkZXIgPT0gbnVs\nbCA/IE5VTExfTE9BREVSIDogbG9hZGVyOwogICAgICAgIE1hcCBsb2FkZXJD\nYWNoZSA9IChNYXApIF9sb2FkZXJzLmdldChrZXkpOwogICAgICAgIGlmIChs\nb2FkZXJDYWNoZSA9PSBudWxsKSB7IC8vIFdlIGRvbid0IGhhdmUgYSBjYWNo\nZSBmb3IgdGhpcyBsb2FkZXIuCiAgICAgICAgICAgIGxvYWRlckNhY2hlID0g\nbmV3IENvbmN1cnJlbnRIYXNoTWFwKCk7CiAgICAgICAgICAgIF9sb2FkZXJz\nLnB1dChrZXksIGxvYWRlckNhY2hlKTsKICAgICAgICB9IGVsc2UgeyAgLy8g\nV2UgaGF2ZSBhIGNhY2hlIGZvciB0aGlzIGxvYWRlci4KICAgICAgICAgICAg\nY2xzID0gKENsYXNzKSBsb2FkZXJDYWNoZS5nZXQoY2xzTmFtZSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoY2xzID09IG51bGwpIHsgLy8gd2UgaGF2ZW4n\ndCBjYWNoZWQgdGhpcy4KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGNscyA9IFN0cmluZ3MudG9DbGFzcyhjbHNOYW1lLCBmaW5kRGVyaXZl\nZExvYWRlcihjb25mLCBsb2FkZXIpKTsKICAgICAgICAgICAgICAgIGxvYWRl\nckNhY2hlLnB1dChjbHNOYW1lLCBjbHMpOwogICAgICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBpZiAo\ndmFsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmUgPSBnZXRDcmVh\ndGVFeGNlcHRpb24oY2xzTmFtZSwgdmFsLCByZSk7CiAgICAgICAgICAgICAg\nICBpZiAoZmF0YWwpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAg\nICAgICAgICAgICAgICBMb2cgbG9nID0gKGNvbmYgPT0gbnVsbCkgPyBudWxs\nIDogY29uZi5nZXRDb25maWd1cmF0aW9uTG9nKCk7CiAgICAgICAgICAgICAg\nICBpZiAobG9nICE9IG51bGwgJiYgbG9nLmlzRXJyb3JFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKF9sb2MuZ2V0KCJwbHVnaW4t\nY3JlYXRpb24tZXhjZXB0aW9uIiwgdmFsKSwgcmUpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjbHMubmV3SW5zdGFuY2Uo\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBSdW50aW1lRXhjZXB0aW9uIHJlID0gbmV3IE5lc3RhYmxlUnVudGltZUV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJvYmotY3JlYXRl\nIiwgY2xzKS5nZXRNZXNzYWdlKCksIGUpOwogICAgICAgICAgICBpZiAoZmF0\nYWwpCiAgICAgICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICAgICAgTG9n\nIGxvZyA9IChjb25mID09IG51bGwpID8gbnVsbCA6IGNvbmYuZ2V0Q29uZmln\ndXJhdGlvbkxvZygpOwogICAgICAgICAgICBpZiAobG9nICE9IG51bGwgJiYg\nbG9nLmlzRXJyb3JFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cuZXJy\nb3IoX2xvYy5nZXQoInBsdWdpbi1jcmVhdGlvbi1leGNlcHRpb24iLCB2YWwp\nLCByZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEF0dGVtcHQgdG8gZmluZCBhIGRlcml2ZWQg\nbG9hZGVyIHRoYXQgZGVsZWdhdGVzIHRvIG91ciB0YXJnZXQgbG9hZGVyLgog\nICAgICogVGhpcyBhbGxvd3MgYXBwbGljYXRpb24gbG9hZGVycyB0aGF0IGRl\nbGVnYXRlIGFwcHJvcHJpYXRlbHkgZm9yIGtub3duCiAgICAgKiBjbGFzc2Vz\nIGZpcnN0IGNyYWNrIGF0IGNsYXNzIG5hbWVzLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBDbGFzc0xvYWRlciBmaW5kRGVyaXZlZExvYWRlcihDb25m\naWd1cmF0aW9uIGNvbmYsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7\nCiAgICAgICAgLy8gd2UgYWx3YXlzIHByZWZlciB0aGUgdGhyZWFkIGxvYWRl\nciwgYmVjYXVzZSBpdCdzIHRoZSBvbmx5IHRoaW5nIHdlCiAgICAgICAgLy8g\nY2FuIGFjY2VzcyB0aGF0IGlzbid0IGJvdW5kIHRvIHRoZSBPcGVuSlBBIGNs\nYXNzbG9hZGVyLCB1bmxlc3MKICAgICAgICAvLyB0aGUgY29uZiBvYmplY3Qg\naXMgb2YgYSBjdXN0b20gY2xhc3MKICAgICAgICBDbGFzc0xvYWRlciBjdHhM\nb2FkZXIgPSBUaHJlYWQuY3VycmVudFRocmVhZCgpLmdldENvbnRleHRDbGFz\nc0xvYWRlcigpOwogICAgICAgIGlmIChsb2FkZXIgPT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoY3R4TG9hZGVyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gY3R4TG9hZGVyOwogICAgICAgICAgICBpZiAoY29uZiAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmYuZ2V0Q2xhc3MoKS5n\nZXRDbGFzc0xvYWRlcigpOwogICAgICAgICAgICByZXR1cm4gQ29uZmlndXJh\ndGlvbnMuY2xhc3MuZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICB9CgogICAg\nICAgIGZvciAoQ2xhc3NMb2FkZXIgcGFyZW50ID0gY3R4TG9hZGVyOyBwYXJl\nbnQgIT0gbnVsbDsgCiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5nZXRQ\nYXJlbnQoKSkgewogICAgICAgICAgICBpZiAocGFyZW50ID09IGxvYWRlcikK\nICAgICAgICAgICAgICAgIHJldHVybiBjdHhMb2FkZXI7CiAgICAgICAgfQog\nICAgICAgIGlmIChjb25mICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yIChD\nbGFzc0xvYWRlciBwYXJlbnQgPSBjb25mLmdldENsYXNzKCkuZ2V0Q2xhc3NM\nb2FkZXIoKTsgCiAgICAgICAgICAgICAgICBwYXJlbnQgIT0gbnVsbDsgcGFy\nZW50ID0gcGFyZW50LmdldFBhcmVudCgpKSB7CiAgICAgICAgICAgICAgICBp\nZiAocGFyZW50ID09IGxvYWRlcikKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gY29uZi5nZXRDbGFzcygpLmdldENsYXNzTG9hZGVyKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxvYWRlcjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4ge0BsaW5rIENvbmZpZ3Vy\nYXRpb259IGluc3RhbmNlIGZyb20gdGhlIGNvbW1hbmQgbGluZQogICAgICog\nb3B0aW9ucyBwcm92aWRlZC4gQWxsIHByb3BlcnR5IG5hbWVzIG9mIHRoZSBn\naXZlbiBjb25maWd1cmF0aW9uIGFyZQogICAgICogcmVjb2duaXplZDsgYWRk\naXRpb25hbGx5LCBpZiBhIDxjb2RlPnByb3BlcnRpZXM8L2NvZGU+IG9yCiAg\nICAgKiA8Y29kZT5wPC9jb2RlPiBhcmd1bWVudCBleGlzdHMsIHRoZSByZXNv\ndXJjZSBpdAogICAgICogcG9pbnRzIHRvIHdpbGwgYmUgbG9hZGVkIGFuZCBz\nZXQgaW50byB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbiBpbnN0YW5jZS4KICAg\nICAqIEl0IGNhbiBwb2ludCB0byBlaXRoZXIgYSBmaWxlIG9yIGEgcmVzb3Vy\nY2UgbmFtZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHBvcHVs\nYXRlQ29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYsIE9wdGlvbnMg\nb3B0cykgewogICAgICAgIFN0cmluZyBwcm9wcyA9IG9wdHMucmVtb3ZlUHJv\ncGVydHkoInByb3BlcnRpZXMiLCAicCIsIG51bGwpOwogICAgICAgIENvbmZp\nZ3VyYXRpb25Qcm92aWRlciBwcm92aWRlcjsKICAgICAgICBpZiAoIVN0cmlu\nZ1V0aWxzLmlzRW1wdHkocHJvcHMpKSB7CiAgICAgICAgICAgIFN0cmluZyBw\nYXRoID0gcHJvcHM7CiAgICAgICAgICAgIFN0cmluZyBhbmNob3IgPSBudWxs\nOwogICAgICAgICAgICBpbnQgaWR4ID0gcGF0aC5sYXN0SW5kZXhPZignIycp\nOwogICAgICAgICAgICBpZiAoaWR4ICE9IC0xKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaWR4IDwgcGF0aC5sZW5ndGgoKSAtIDEpCiAgICAgICAgICAgICAg\nICAgICAgYW5jaG9yID0gcGF0aC5zdWJzdHJpbmcoaWR4ICsgMSk7CiAgICAg\nICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgaWR4KTsKICAg\nICAgICAgICAgICAgIGlmIChwYXRoLmxlbmd0aCgpID09IDApCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlv\nbihfbG9jLmdldCgiYW5jaG9yLW9ubHkiLAogICAgICAgICAgICAgICAgICAg\nICAgICBwcm9wcykuZ2V0TWVzc2FnZSgpLCBDb25maWd1cmF0aW9ucy5jbGFz\ncy5nZXROYW1lKCksIAogICAgICAgICAgICAgICAgICAgICAgICBwcm9wcyk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZpbGUgZmlsZSA9IG5ldyBG\naWxlKHBhdGgpOwogICAgICAgICAgICBpZiAoZmlsZS5pc0ZpbGUoKSkKICAg\nICAgICAgICAgICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxv\nYWQoZmlsZSwgYW5jaG9yLCBudWxsKTsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBmaWxlID0gbmV3IEZpbGUoIk1FVEEtSU5GIiArIEZp\nbGUuc2VwYXJhdG9yQ2hhciArIHBhdGgpOwogICAgICAgICAgICAgICAgaWYg\nKGZpbGUuaXNGaWxlKCkpCiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIg\nPSBQcm9kdWN0RGVyaXZhdGlvbnMubG9hZChmaWxlLCBhbmNob3IsIG51bGwp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHBy\nb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWQocGF0aCwgYW5jaG9y\nLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHJvdmlk\nZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHByb3ZpZGVyLnNldEludG8o\nY29uZik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNaXNzaW5nUmVzb3VyY2VFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXBy\nb3ZpZGVyIiwKICAgICAgICAgICAgICAgICAgICBwcm9wcykuZ2V0TWVzc2Fn\nZSgpLCBDb25maWd1cmF0aW9ucy5jbGFzcy5nZXROYW1lKCksIAogICAgICAg\nICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBwcm92aWRlciA9IFByb2R1Y3REZXJpdmF0aW9ucy5sb2FkRGVmYXVs\ndHMobnVsbCk7CiAgICAgICAgICAgIGlmIChwcm92aWRlciAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhjb25mKTsKICAgICAg\nICB9CiAgICAgICAgb3B0cy5zZXRJbnRvKGNvbmYpOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byB0aHJvdyBhbiBpbmZvcm1hdGl2\nZSBkZXNjcmlwdGlvbiBvbiBpbnN0YW50aWF0aW9uIGVycm9yLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBSdW50aW1lRXhjZXB0aW9uIGdldENyZWF0\nZUV4Y2VwdGlvbihTdHJpbmcgY2xzTmFtZSwKICAgICAgICBWYWx1ZSB2YWws\nIEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgLy8gcmUtdGhyb3cgdGhlIGV4Y2Vw\ndGlvbiB3aXRoIHNvbWUgYmV0dGVyIGluZm9ybWF0aW9uCiAgICAgICAgZmlu\nYWwgU3RyaW5nIG1zZzsKICAgICAgICBmaW5hbCBPYmplY3RbXSBwYXJhbXM7\nCgogICAgICAgIFN0cmluZyBhbGlhcyA9IHZhbC5hbGlhcyhjbHNOYW1lKTsK\nICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0gdmFsLmdldEFsaWFzZXMoKTsK\nICAgICAgICBTdHJpbmdbXSBrZXlzOwogICAgICAgIGlmIChhbGlhc2VzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICBrZXlzID0gYWxpYXNlczsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAga2V5cyA9IG5ldyBTdHJpbmdbYWxpYXNl\ncy5sZW5ndGggLyAyXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBhbGlhc2VzLmxlbmd0aDsgaSArPSAyKQogICAgICAgICAgICAgICAga2V5\nc1tpIC8gMl0gPSBhbGlhc2VzW2ldOwogICAgICAgIH0KCiAgICAgICAgU3Ry\naW5nIGNsb3Nlc3Q7CiAgICAgICAgaWYgKGtleXMubGVuZ3RoID09IDApIHsK\nICAgICAgICAgICAgbXNnID0gImludmFsaWQtcGx1Z2luIjsKICAgICAgICAg\nICAgcGFyYW1zID0gbmV3IE9iamVjdFtdeyB2YWwuZ2V0UHJvcGVydHkoKSwg\nYWxpYXMsIGUudG9TdHJpbmcoKSwgfTsKICAgICAgICB9IGVsc2UgaWYgKChj\nbG9zZXN0ID0gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0ZWlu\nRGlzdGFuY2UKICAgICAgICAgICAgKGFsaWFzLCBrZXlzLCAwLjVmKSkgPT0g\nbnVsbCkgewogICAgICAgICAgICBtc2cgPSAiaW52YWxpZC1wbHVnaW4tYWxp\nYXNlcyI7CiAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBPYmplY3RbXXsKICAg\nICAgICAgICAgICAgIHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0\ncmluZygpLAogICAgICAgICAgICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFz\nTGlzdChrZXlzKSksIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nbXNnID0gImludmFsaWQtcGx1Z2luLWFsaWFzZXMtaGludCI7CiAgICAgICAg\nICAgIHBhcmFtcyA9IG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgIHZh\nbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmluZygpLAogICAgICAg\nICAgICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFzTGlzdChrZXlzKSksIGNs\nb3Nlc3QsIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgUGFyc2VF\neGNlcHRpb24oX2xvYy5nZXQobXNnLCBwYXJhbXMpLCBlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3aXRo\nIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAgKiBtYXRjaGluZyB0aGUg\ncHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVjdCdzIHNldHRlcgogICAg\nICogbWV0aG9kcy4gVGhlIHByb3BlcnRpZXMgc3RyaW5nIHNob3VsZCBiZSBp\nbiB0aGUgZm9ybQogICAgICogInByb3AxPXZhbDEsIHByb3AyPXZhbDIgLi4u\nIi4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXIKICAgICAqIG1ldGhv\nZHMgZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEB0\naHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVycm9y\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJbnN0\nYW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAg\nU3RyaW5nIHByb3BlcnRpZXMpIHsKICAgICAgICBjb25maWd1cmVJbnN0YW5j\nZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhl\nIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9w\nZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBt\nZXRob2RzLiBUaGUgcHJvcGVydGllcyBzdHJpbmcgc2hvdWxkIGJlIGluIHRo\nZSBmb3JtCiAgICAgKiAicHJvcDE9dmFsMSwgcHJvcDI9dmFsMiAuLi4iLiBW\nYWxpZGF0ZXMgdGhhdCBzZXR0ZXIgbWV0aG9kcwogICAgICogZXhpc3QgZm9y\nIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgUnVudGlt\nZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qg\nb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3Bl\ncnRpZXMsIFN0cmluZyBjb25maWd1cmF0aW9uTmFtZSkgewogICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBQ\ncm9wZXJ0aWVzIHByb3BzID0gbnVsbDsKICAgICAgICBpZiAoIVN0cmluZ1V0\naWxzLmlzRW1wdHkocHJvcGVydGllcykpCiAgICAgICAgICAgIHByb3BzID0g\ncGFyc2VQcm9wZXJ0aWVzKHByb3BlcnRpZXMpOwogICAgICAgIGNvbmZpZ3Vy\nZUluc3RhbmNlKG9iaiwgY29uZiwgcHJvcHMsIGNvbmZpZ3VyYXRpb25OYW1l\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVu\nIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAgKiBt\nYXRjaGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVjdCdz\nIHNldHRlcgogICAgICogbWV0aG9kcy4gRG9lcyBub3QgdmFsaWRhdGUgdGhh\ndCBzZXR0ZXIgbWV0aG9kcyBleGlzdCBmb3IgdGhlIHByb3BlcnRpZXMuCiAg\nICAgKgogICAgICogQHRocm93cyBSdW50aW1lRXhjZXB0aW9uIG9uIGNvbmZp\nZ3VyYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lk\nIGNvbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmosIENvbmZpZ3VyYXRpb24g\nY29uZiwKICAgICAgICBQcm9wZXJ0aWVzIHByb3BlcnRpZXMpIHsKICAgICAg\nICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51\nbGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2\nZW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAq\nIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0\nJ3Mgc2V0dGVyCiAgICAgKiBtZXRob2RzLiBJZiA8Y29kZT5jb25maWd1cmF0\naW9uTmFtZTwvY29kZT4gaXMKICAgICAqIG5vbi08Y29kZT5udWxsPC9jb2Rl\nPiwgdmFsaWRhdGVzIHRoYXQgc2V0dGVyIG1ldGhvZHMgZXhpc3QgZm9yCiAg\nICAgKiB0aGUgcHJvcGVydGllcy4KICAgICAqCiAgICAgKiBAdGhyb3dzIFJ1\nbnRpbWVFeGNlcHRpb24gb24gY29uZmlndXJhdGlvbiBlcnJvcgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmlndXJlSW5zdGFuY2UoT2Jq\nZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIFByb3BlcnRp\nZXMgcHJvcGVydGllcywgU3RyaW5nIGNvbmZpZ3VyYXRpb25OYW1lKSB7CiAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIE9wdGlvbnMgb3B0czsKICAgICAgICBpZiAocHJvcGVydGllcyBp\nbnN0YW5jZW9mIE9wdGlvbnMpCiAgICAgICAgICAgIG9wdHMgPSAoT3B0aW9u\ncykgcHJvcGVydGllczsKICAgICAgICBlbHNlIHsgCiAgICAgICAgICAgIG9w\ndHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgICAgICBpZiAocHJvcGVydGll\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgb3B0cy5wdXRBbGwocHJvcGVy\ndGllcyk7CiAgICAgICAgfQoKICAgICAgICBDb25maWd1cmFibGUgY29uZmln\ndXJhYmxlID0gbnVsbDsKICAgICAgICBpZiAoY29uZiAhPSBudWxsICYmIG9i\naiBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkKICAgICAgICAgICAgY29uZmln\ndXJhYmxlID0gKENvbmZpZ3VyYWJsZSkgb2JqOwoKICAgICAgICBpZiAoY29u\nZmlndXJhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgY29uZmlndXJhYmxl\nLnNldENvbmZpZ3VyYXRpb24oY29uZik7CiAgICAgICAgICAgIGNvbmZpZ3Vy\nYWJsZS5zdGFydENvbmZpZ3VyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAg\nT3B0aW9ucyBpbnZhbGlkRW50cmllcyA9IG9wdHMuc2V0SW50byhvYmopOwog\nICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBHZW5lcmljQ29uZmlndXJhYmxl\nKQogICAgICAgICAgICAoKEdlbmVyaWNDb25maWd1cmFibGUpIG9iaikuc2V0\nSW50byhpbnZhbGlkRW50cmllcyk7CgoJCWlmICghaW52YWxpZEVudHJpZXMu\naXNFbXB0eSgpICYmIGNvbmZpZ3VyYXRpb25OYW1lICE9IG51bGwpIHsKCQkJ\nTG9jYWxpemVyLk1lc3NhZ2UgbXNnID0gbnVsbDsKCQkJU3RyaW5nIGZpcnN0\nID0gKFN0cmluZykgaW52YWxpZEVudHJpZXMua2V5U2V0KCkuaXRlcmF0b3Io\nKS5uZXh0KCk7CgkJCWlmIChpbnZhbGlkRW50cmllcy5rZXlTZXQoKS5zaXpl\nKCkgPT0gMSAmJgoJCQkJZmlyc3QuaW5kZXhPZignLicpID09IC0xKSB7CgkJ\nCQkvLyBpZiB0aGVyZSdzIGp1c3Qgb25lIG1pc3NwZWxsaW5nIGFuZCB0aGlz\nIGlzIG5vdCBhCgkJCQkvLyBwYXRoIHRyYXZlcnNhbCwgY2hlY2sgZm9yIG5l\nYXIgbWlzc2VzLgoJCQkJQ29sbGVjdGlvbiBvcHRpb25zID0gZmluZE9wdGlv\nbnNGb3Iob2JqLmdldENsYXNzKCkpOwoJCQkJU3RyaW5nIGNsb3NlID0gU3Ry\naW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0ZWluRGlzdGFuY2UKCQkJ\nCQkoZmlyc3QsIG9wdGlvbnMsIDAuNzVmKTsKCQkJCWlmIChjbG9zZSAhPSBu\ndWxsKQoJCQkJCW1zZyA9IF9sb2MuZ2V0KCJpbnZhbGlkLWNvbmZpZy1wYXJh\nbS1oaW50IiwgbmV3IE9iamVjdFtdewoJCQkJCQljb25maWd1cmF0aW9uTmFt\nZSwgb2JqLmdldENsYXNzKCksIGZpcnN0LCBjbG9zZSwKCQkJCQkJb3B0aW9u\ncywgfSk7CgkJCX0KCiAgICAgICAgICAgIGlmIChtc2cgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgbXNnID0gX2xvYy5nZXQoImludmFsaWQtY29uZmln\nLXBhcmFtcyIsIG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgICAgICAgICBj\nb25maWd1cmF0aW9uTmFtZSwgb2JqLmdldENsYXNzKCkuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgICAgIGludmFsaWRFbnRyaWVzLmtleVNldCgpLnRv\nU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZmluZE9wdGlvbnNGb3Io\nb2JqLmdldENsYXNzKCkpLnRvU3RyaW5nKCksIH0pOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHRocm93IG5ldyBQYXJzZUV4Y2VwdGlvbihtc2cpOwog\nICAgICAgIH0KICAgICAgICBpZiAoY29uZmlndXJhYmxlICE9IG51bGwpCiAg\nICAgICAgICAgIGNvbmZpZ3VyYWJsZS5lbmRDb25maWd1cmF0aW9uKCk7CiAg\nICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgQ29sbGVjdGlvbiBmaW5kT3B0aW9u\nc0ZvcihDbGFzcyBjbHMpIHsKICAgICAgICBDb2xsZWN0aW9uIGMgPSBPcHRp\nb25zLmZpbmRPcHRpb25zRm9yKGNscyk7CiAgICAgICAgCiAgICAgICAgLy8g\ncmVtb3ZlIENvbmZpZ3VyYWJsZS5zZXRDb25maWd1cmF0aW9uKCkgYW5kIAog\nICAgICAgIC8vIEdlbmVyaWNDb25maWd1cmFibGUuc2V0SW50bygpIGZyb20g\ndGhlIHNldCwgaWYgYXBwbGljYWJsZS4KICAgICAgICBpZiAoQ29uZmlndXJh\nYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAg\nYy5yZW1vdmUoIkNvbmZpZ3VyYXRpb24iKTsKICAgICAgICBpZiAoR2VuZXJp\nY0NvbmZpZ3VyYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykpCiAg\nICAgICAgICAgIGMucmVtb3ZlKCJJbnRvIik7CiAgICAgICAgCiAgICAgICAg\ncmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUdXJuIGEgc2V0IG9m\nIHByb3BlcnRpZXMgaW50byBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIHNlcmlhbGl6ZVByb3Bl\ncnRpZXMoTWFwIG1hcCkgewogICAgICAgIGlmIChtYXAgPT0gbnVsbCB8fCBt\nYXAuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAg\nICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgU3RyaW5nIHZhbDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVudHJ5ID0g\nKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGJ1Zi5s\nZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIp\nOwogICAgICAgICAgICBidWYuYXBwZW5kKGVudHJ5LmdldEtleSgpKS5hcHBl\nbmQoJz0nKTsKICAgICAgICAgICAgdmFsID0gU3RyaW5nLnZhbHVlT2YoZW50\ncnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIGlmICh2YWwuaW5kZXhPZign\nLCcpICE9IC0xKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgnIicpLmFw\ncGVuZCh2YWwpLmFwcGVuZCgnIicpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKHZhbCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGEgc2V0IG9mIHByb3BlcnRpZXMgZnJvbSBhIGNvbW1hLXNlcGFy\nYXRlZCBzdHJpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT3B0aW9u\ncyBwYXJzZVByb3BlcnRpZXMoU3RyaW5nIHByb3BlcnRpZXMpIHsKICAgICAg\nICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIHByb3Bl\ncnRpZXMgPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKHByb3BlcnRpZXMpOwog\nICAgICAgIGlmIChwcm9wZXJ0aWVzID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBvcHRzOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmdb\nXSBwcm9wcyA9IFN0cmluZ3Muc3BsaXQocHJvcGVydGllcywgIiwiLCAwKTsK\nICAgICAgICAgICAgaW50IGlkeDsKICAgICAgICAgICAgY2hhciBxdW90ZTsK\nICAgICAgICAgICAgU3RyaW5nIHByb3A7CiAgICAgICAgICAgIFN0cmluZyB2\nYWw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcHJvcHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlkeCA9IHByb3BzW2ldLmlu\nZGV4T2YoJz0nKTsKICAgICAgICAgICAgICAgIGlmIChpZHggPT0gLTEpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUga2V5IGlzIG5vdCBhc3Np\nZ25lZCB0byBhbnkgdmFsdWUsIHNldCB0aGUKICAgICAgICAgICAgICAgICAg\nICAvLyB2YWx1ZSB0byB0aGUgc2FtZSB0aGluZyBhcyB0aGUga2V5LCBhbmQg\nY29udGludWUuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBwZXJtaXRz\nIEdlbmVyaWNDb25maWd1cmFibGUgaW5zdGFuY2VzIHRvCiAgICAgICAgICAg\nICAgICAgICAgLy8gYmVoYXZlIG1lYW5pbmdmdWxseS4gV2UgbWlnaHQgY29u\nc2lkZXIgc2V0dGluZyB0aGUKICAgICAgICAgICAgICAgICAgICAvLyB2YWx1\nZSB0byBzb21lIHdlbGwta25vd24gInZhbHVlIHdhcyBub3Qgc2V0LCBidXQK\nICAgICAgICAgICAgICAgICAgICAvLyBrZXkgaXMgcHJlc2VudCIgc3RyaW5n\nIHNvIHRoYXQgaW5zdGFuY2VzIGdldHRpbmcKICAgICAgICAgICAgICAgICAg\nICAvLyB2YWx1ZXMgaW5qZWN0ZWQgY2FuIGRpZmZlcmVudGlhdGUgYmV0d2Vl\nbiBhIG1lbnRpb25lZAogICAgICAgICAgICAgICAgICAgIC8vIHByb3BlcnR5\nIGFuZCBvbmUgc2V0IHRvIGEgcGFydGljdWxhciB2YWx1ZS4KICAgICAgICAg\nICAgICAgICAgICBwcm9wID0gcHJvcHNbaV07CiAgICAgICAgICAgICAgICAg\nICAgdmFsID0gcHJvcDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgcHJvcCA9IHByb3BzW2ldLnN1YnN0cmluZygwLCBp\nZHgpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBwcm9wc1tp\nXS5zdWJzdHJpbmcoaWR4ICsgMSkudHJpbSgpOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBxdW90ZWQs\nIHJlYWQgdW50aWwgdGhlIGVuZCBxdW90ZQogICAgICAgICAgICAgICAgaWYg\nKCgodmFsLnN0YXJ0c1dpdGgoIlwiIikgJiYgdmFsLmVuZHNXaXRoKCJcIiIp\nKQogICAgICAgICAgICAgICAgICAgIHx8ICh2YWwuc3RhcnRzV2l0aCgiJyIp\nICYmIHZhbC5lbmRzV2l0aCgiJyIpKSkKICAgICAgICAgICAgICAgICAgICAm\nJiB2YWwubGVuZ3RoKCkgPiAxKQogICAgICAgICAgICAgICAgICAgIHZhbCA9\nIHZhbC5zdWJzdHJpbmcoMSwgdmFsLmxlbmd0aCgpIC0gMSk7CiAgICAgICAg\nICAgICAgICBlbHNlIGlmICh2YWwuc3RhcnRzV2l0aCgiXCIiKSB8fCB2YWwu\nc3RhcnRzV2l0aCgiJyIpKSB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGUg\nPSB2YWwuY2hhckF0KDApOwogICAgICAgICAgICAgICAgICAgIFN0cmluZ0J1\nZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKHZhbC5zdWJzdHJpbmcoMSkp\nOwogICAgICAgICAgICAgICAgICAgIGludCBxdW90SWR4OwogICAgICAgICAg\nICAgICAgICAgIHdoaWxlICgrK2kgPCBwcm9wcy5sZW5ndGgpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCIpOwoKICAgICAgICAg\nICAgICAgICAgICAgICAgcXVvdElkeCA9IHByb3BzW2ldLmluZGV4T2YocXVv\ndGUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVvdElkeCAhPSAt\nMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChw\ncm9wc1tpXS5zdWJzdHJpbmcoMCwgcXVvdElkeCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHF1b3RJZHggKyAxIDwgcHJvcHNbaV0ubGVu\nZ3RoKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZChwcm9wc1tpXS5zdWJzdHJpbmcocXVvdElkeCArIDEpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQocHJvcHNbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB2YWwgPSBidWYudG9TdHJpbmcoKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9wdHMucHV0KHByb3AsIHZh\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9wdHM7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5nZXQoInByb3At\ncGFyc2UiLCBwcm9wZXJ0aWVzKSwgcmUpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIExvb2tzIHVwIHRoZSBnaXZlbiBuYW1lIGluIEpOREku\nIElmIHRoZSBuYW1lIGlzIG51bGwsIG51bGwgaXMgcmV0dXJuZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGxvb2t1cChTdHJpbmcgbmFt\nZSkgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29udGV4dCBjdHgg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGN0eCA9IG5ldyBJ\nbml0aWFsQ29udGV4dCgpOwogICAgICAgICAgICByZXR1cm4gY3R4Lmxvb2t1\ncChuYW1lKTsKICAgICAgICB9IGNhdGNoIChOYW1pbmdFeGNlcHRpb24gbmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5lc3RhYmxlUnVudGltZUV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJuYW1pbmctZXJyIiwg\nbmFtZSkuZ2V0TWVzc2FnZSgpLCBuZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKGN0eCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgY3R4LmNsb3NlKCk7IH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7fQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qgd2hldGhlciB0\naGUgbWFwIGNvbnRhaW5zIHRoZSBnaXZlbiBwYXJ0aWFsIGtleSwgcHJlZml4\nZWQgd2l0aCBhbnkKICAgICAqIHBvc3NpYmxlIGNvbmZpZ3VyYXRpb24gcHJl\nZml4LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gY29udGFp\nbnNQcm9wZXJ0eShTdHJpbmcgcGFydGlhbEtleSwgTWFwIHByb3BzKSB7CiAg\nICAgICAgaWYgKHBhcnRpYWxLZXkgPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxs\nIHx8IHByb3BzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHByb3BzLmNvbnRh\naW5zS2V5KAogICAgICAgICAgICAgICAgUHJvZHVjdERlcml2YXRpb25zLmdl\ndENvbmZpZ3VyYXRpb25LZXkocGFydGlhbEtleSwgcHJvcHMpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEdldCB0aGUgcHJvcGVydHkgdW5kZXIgdGhlIGdp\ndmVuIHBhcnRpYWwga2V5LCBwcmVmaXhlZCB3aXRoIGFueSBwb3NzaWJsZQog\nICAgICogY29uZmlndXJhdGlvbiBwcmVmaXguCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgT2JqZWN0IGdldFByb3BlcnR5KFN0cmluZyBwYXJ0aWFsS2V5\nLCBNYXAgbSkgewogICAgICAgIGlmIChwYXJ0aWFsS2V5ID09IG51bGwgfHwg\nbSA9PSBudWxsIHx8IG0uaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBlbHNlIAogICAgICAgICAgICByZXR1cm4gbS5nZXQo\nUHJvZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXkocGFydGlh\nbEtleSwgbSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBw\ncm9wZXJ0eSB1bmRlciB0aGUgZ2l2ZW4gcGFydGlhbCBrZXksIHByZWZpeGVk\nIHdpdGggYW55CiAgICAgKiBwb3NzaWJsZSBjb25maWd1cmF0aW9uIHByZWZp\neC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgcmVtb3ZlUHJv\ncGVydHkoU3RyaW5nIHBhcnRpYWxLZXksIE1hcCBwcm9wcykgewogICAgICAg\nIGlmIChwYXJ0aWFsS2V5ID09IG51bGwgfHwgcHJvcHMgPT0gbnVsbCB8fCBw\ncm9wcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIHJldHVybiBwcm9wcy5yZW1vdmUoUHJvZHVjdERlcml2YXRpb25zLmdl\ndENvbmZpZ3VyYXRpb25LZXkocGFydGlhbEtleSwKICAgICAgICAgICAgcHJv\ncHMpKTsKICAgIH0KfQo=\n","encoding":"base64"}

