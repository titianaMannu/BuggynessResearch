{"sha":"27ab4f27d0774fe439431357ce478de85ba07c5c","node_id":"MDQ6QmxvYjIwNjM2NDoyN2FiNGYyN2QwNzc0ZmU0Mzk0MzEzNTdjZTQ3OGRlODViYTA3YzVj","size":59691,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/27ab4f27d0774fe439431357ce478de85ba07c5c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBq\nYXZhLm5ldC5VUklTeW50YXhFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5V\nUkw7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51\ndGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0\naWwuVHJlZVNldDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkJhc2ljOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5F\nbWJlZGRlZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5Owpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVuZXJzOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnM7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3VwZXJjbGFzc0xp\nc3RlbmVyczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZldGNoVHlwZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwppbXBvcnQgc3RhdGlj\nIGphdmF4LnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFVVE87CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLklkQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuTWFwS2V5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwcGVk\nU3VwZXJjbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0\naXZlUXVlcmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0\naXZlUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJp\nZXM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJ5OwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5PcmRlckJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdExvYWQ7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UGVyc2lzdDsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlBvc3RSZW1vdmU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5Qb3N0VXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuUHJlUGVyc2lzdDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVJl\nbW92ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVVwZGF0ZTsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuVmVyc2lvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmV2ZW50LkJlYW5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlQ2FsbGJhY2tz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lk1ldGhvZExp\nZmVjeWNsZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5MaWZlY3ljbGVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhTW9k\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJl\ncG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5PcmRl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlF1ZXJ5TWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVXBkYXRl\nU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZh\nbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5NZXRhRGF0YURlZmF1bHRzOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy4qOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2Vw\ndGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51\ndGlsLlN0cmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlvbiBt\nZXRhZGF0YSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQogKiBk\nZXBsb3ltZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIK\nICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBh\ncnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENs\nYXNzLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNoTWFw\nPENsYXNzLCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAgICAg\nIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJFRERFRF9JRCk7CiAg\nICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5jbGFzcywgRU5USVRZ\nX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVEZWZhdWx0\nTGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJTKTsK\nICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5lcnMu\nY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNURU5F\nUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVUeXBlLmNsYXNzLCBG\nTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2VuZXJhdGVkVmFsdWUu\nY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAgX3RhZ3MucHV0KElk\nLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElkQ2xhc3MuY2xhc3Ms\nIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5LmNsYXNzLCBN\nQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVyaWVz\nLmNsYXNzLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0KE5h\nbWVkTmF0aXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAgICAg\nX3RhZ3MucHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAgICAg\nICAgX3RhZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAgICAg\nICBfdGFncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAgICAg\nIF90YWdzLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAgICAg\nICBfdGFncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lTVCk7\nCiAgICAgICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1RfUkVN\nT1ZFKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywgUE9T\nVF9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNsYXNz\nLCBQUkVfUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92ZS5j\nbGFzcywgUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVwZGF0\nZS5jbGFzcywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNlcXVl\nbmNlR2VuZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAgICBf\ndGFncy5wdXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAgX3Rh\nZ3MucHV0KERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAgICAg\nX3RhZ3MucHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQpOwog\nICAgICAgIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVOVCk7\nCiAgICAgICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERFVEFD\nSEVEX1NUQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVuZGVu\ndC5jbGFzcywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1dChF\nbGVtZW50VHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFncy5w\ndXQoRXh0ZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwogICAg\nICAgIF90YWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFMSVpF\nUik7CiAgICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RPUlkp\nOwogICAgICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRDSF9H\nUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNzLCBG\nRVRDSF9HUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9naWNh\nbC5jbGFzcywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5wdXQo\nS2V5RGVwZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAgICBf\ndGFncy5wdXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAgIF90\nYWdzLnB1dChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9HUk9V\nUCk7CiAgICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAgICAg\nICBfdGFncy5wdXQoUmVhZE9ubHkuY2xhc3MsIFJFQURfT05MWSk7CiAgICAg\nICAgX3RhZ3MucHV0KFR5cGUuY2xhc3MsIFRZUEUpOwogICAgfQoKICAgIHBy\naXZhdGUgZmluYWwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBw\ncml2YXRlIGZpbmFsIExvZyBfbG9nOwogICAgcHJpdmF0ZSBNZXRhRGF0YVJl\ncG9zaXRvcnkgX3JlcG9zID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NMb2Fk\nZXIgX2VudkxvYWRlciA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX292\nZXJyaWRlID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1PREVf\nTk9ORTsKCiAgICAvLyBwYWNrYWdlcyBhbmQgdGhlaXIgcGFyc2UgbW9kZXMK\nICAgIHByaXZhdGUgZmluYWwgTWFwPFBhY2thZ2UsIEludGVnZXI+IF9wa2dz\nID0gbmV3IEhhc2hNYXA8UGFja2FnZSwgSW50ZWdlcj4oKTsKCiAgICAvLyB0\naGUgY2xhc3Mgd2Ugd2VyZSBpbnZva2VkIHRvIHBhcnNlCiAgICBwcml2YXRl\nIENsYXNzIF9jbHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWxlIF9maWxlID0g\nbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgY29u\nZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25QZXJz\naXN0ZW5jZU1ldGFEYXRhUGFyc2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNv\nbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2xvZyA9IGNv\nbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRBREFUQSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uIHN1cHBsaWVk\nIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFD\nb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogTWV0YWRhdGEgbG9n\nLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAgICBy\nZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhl\nIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLiBJZiBub25lIGhhcyBiZWVu\nIHNldCwKICAgICAqIGNyZWF0ZSBhIG5ldyByZXBvc2l0b3J5IGFuZCBzZXRz\nIGl0LgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5IGdl\ndFJlcG9zaXRvcnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9jb25m\nLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAg\nIE1ldGFEYXRhRmFjdG9yeSBtZGYgPSByZXBvcy5nZXRNZXRhRGF0YUZhY3Rv\ncnkoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIERlbGVnYXRp\nbmdNZXRhRGF0YUZhY3RvcnkpCiAgICAgICAgICAgICAgICBtZGYgPSAoKERl\nbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpIG1kZikuZ2V0SW5uZXJtb3N0RGVs\nZWdhdGUoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIFBlcnNp\nc3RlbmNlTWV0YURhdGFGYWN0b3J5KQogICAgICAgICAgICAgICAgKChQZXJz\naXN0ZW5jZU1ldGFEYXRhRmFjdG9yeSkgbWRmKS5zZXRBbm5vdGF0aW9uUGFy\nc2VyKHRoaXMpOwogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgbWV0YWRhdGEgcmVwb3NpdG9yeSBmb3IgdGhpcyBwYXJz\nZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcG9zaXRvcnkoTWV0\nYURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9zID0gcmVw\nb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVudmlyb25t\nZW50YWwgY2xhc3MgbG9hZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2VkCiAgICAg\nKiBtZXRhZGF0YSBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1cm4g\nX2VudkxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZW52\naXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFzcyBvbiB0byBwYXJzZWQK\nICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7\nCiAgICAgICAgX2VudkxvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBp\nbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5m\nb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxz\nZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xh\nc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAq\nIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBh\ncmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNYXBwaW5nT3ZlcnJpZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9vdmVycmlkZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBpbmcgaW5m\nb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5mb3JtYXRp\nb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxzZS4gVXNl\nZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xhc3MsIHNv\nIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGluZm9y\nbWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUgc3Rv\ncmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRNYXBwaW5nT3ZlcnJpZGUoYm9vbGVhbiBvdmVycmlk\nZSkgewogICAgICAgIF9vdmVycmlkZSA9IG92ZXJyaWRlOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBpbnQgZ2V0TW9kZSgpIHsKICAgICAgICByZXR1cm4gX21vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9kZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewog\nICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX21v\nZGUgPSBNT0RFX05PTkU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAg\nICAgIF9tb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nbW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwYXJz\nZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBt\nb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcge0Bs\naW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\naXNNZXRhRGF0YU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9kZSAmIE1P\nREVfTUVUQSkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmll\nbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzUXVlcnlNb2RlKCkg\newogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX1FVRVJZKSAhPSAwOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBp\nbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgpIHsKICAgICAgICByZXR1\ncm4gKF9tb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0cnVlIGlmIHdlJ3JlIGluIG1hcHBpbmcgbW9k\nZSBvciBpbiBtZXRhZGF0YSBtb2RlIHdpdGgKICAgICAqIG1hcHBpbmcgb3Zl\ncmlkZSBlbmFibGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIGlzTWFw\ncGluZ01vZGUoKSB8fCAoX292ZXJyaWRlICYmIGlzTWV0YURhdGFNb2RlKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVzLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBfY2xzID0gbnVs\nbDsKICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgX3BrZ3MuY2xlYXIo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBlcnNpc3RlbmNlIG1l\ndGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHBhcnNlKENsYXNzIGNscykgewogICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoInBhcnNlLWNsYXNzIiwgY2xzLmdldE5hbWUoKSkpOwoKICAgICAgICBf\nY2xzID0gY2xzOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcnNlUGFj\na2FnZUFubm90YXRpb25zKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IHBhcnNlQ2xhc3NBbm5vdGF0aW9ucygpOwogICAgICAgICAgICB1\ncGRhdGVTb3VyY2VNb2RlKG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgICAgICBfZmlsZSA9IG51\nbGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRo\nZSBzb3VyY2UgbW9kZSB0byB0aGUgY2xhc3MgcGFja2FnZSBhbmQgY2xhc3Mg\ndG8gaW5kaWNhdGUgdGhhdAogICAgICogd2UndmUgZnVsbHkgcGFyc2VkIHRo\nZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVTb3VyY2VNb2Rl\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfY2xzLmdldFBh\nY2thZ2UoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRTb3VyY2VNb2RlKF9j\nbHMuZ2V0UGFja2FnZSgpLCBfbW9kZSk7CiAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKF9tb2RlLCB0\ncnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGluZm9ybWF0aW9u\nIGluIHBhY2thZ2UtbGV2ZWwgY2xhc3MgYW5ub3RhdGlvbnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZVBhY2thZ2VBbm5vdGF0aW9ucygpIHsK\nICAgICAgICBQYWNrYWdlIHBrZyA9IF9jbHMuZ2V0UGFja2FnZSgpOwogICAg\nICAgIGlmIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpbnQgcGtnTW9kZSA9IGdldFNvdXJjZU1vZGUocGtnKTsKICAgICAg\nICBpZiAocGtnTW9kZSA9PSAwICYmIF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtcGFja2Fn\nZSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgaWYgKChwa2dNb2RlICYg\nX21vZGUpID09IF9tb2RlKSAvLyBhbHJlYWR5IHZpc2l0ZWQKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAgICAg\nZm9yIChBbm5vdGF0aW9uIGFubm8gOiBwa2cuZ2V0RGVjbGFyZWRBbm5vdGF0\naW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFu\nbm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25QYWNrYWdlQW5ub3Rh\ndGlvbihwa2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9R\nVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1l\nZE5hdGl2ZVF1ZXJpZXMocGtnLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBO\nQVRJVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlN\nb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAg\nICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhwa2cs\nIChOYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAm\nIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlTmFtZWRRdWVyaWVzKHBrZywgKChOYW1lZFF1ZXJpZXMpIGFubm8pLnZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNR\ndWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywg\nKE5hbWVkUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJgog\nICAgICAgICAgICAgICAgICAgICAgICAocGtnTW9kZSAmIE1PREVfTUFQUElO\nRykgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5j\nZUdlbmVyYXRvcihwa2csIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBwa2csCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhbHdheXMgcGFyc2UgbWFw\ncGluZyBzdHVmZiBhZnRlciBtZXRhZGF0YSBzdHVmZiwgaW4gY2FzZSB0aGVy\nZSBhcmUKICAgICAgICAvLyBkZXBlbmRlbmNpZXMgb24gbWV0YWRhdGEKICAg\nICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgKHBrZ01vZGUg\nJiBNT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIHBhcnNlUGFja2Fn\nZU1hcHBpbmdBbm5vdGF0aW9ucyhwa2cpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgcGFja2FnZSBtYXBwaW5nIGFubm90YXRpb25zLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3Rh\ndGlvbnMoUGFja2FnZSBwa2cpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEFs\nbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25Q\nYWNrYWdlQW5ub3RhdGlvbihQYWNrYWdlIHBrZywKICAgICAgICBBbm5vdGF0\naW9uIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZlbiBwYWNr\nYWdlLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRTb3VyY2VNb2RlKFBh\nY2thZ2UgcGtnKSB7CiAgICAgICAgTnVtYmVyIG51bSA9IF9wa2dzLmdldChw\na2cpOwogICAgICAgIHJldHVybiAobnVtID09IG51bGwpID8gMCA6IG51bS5p\nbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRvIHRoZSBz\nb3VyY2UgbW9kZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRTb3VyY2VNb2RlKFBhY2thZ2UgcGtnLCBpbnQg\nbW9kZSkgewogICAgICAgIEludGVnZXIgbnVtID0gX3BrZ3MuZ2V0KHBrZyk7\nCiAgICAgICAgaWYgKG51bSA9PSBudWxsKQogICAgICAgICAgICBudW0gPSBO\ndW1iZXJzLnZhbHVlT2YobW9kZSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBudW0gPSBOdW1iZXJzLnZhbHVlT2YobnVtLmludFZhbHVlKCkgfCBtb2Rl\nKTsKICAgICAgICBfcGtncy5wdXQocGtnLCBudW0pOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVhZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGN1cnJlbnQgdHlw\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIHBhcnNlQ2xh\nc3NBbm5vdGF0aW9ucygpIHsKICAgICAgICAvLyBjaGVjayBpbW1lZGlhdGVs\neSB3aGV0aGVyIHRoZSB1c2VyIGlzIHVzaW5nIGFueSBhbm5vdGF0aW9ucywK\nICAgICAgICAvLyByZWdhcmRsZXNzIG9mIG1vZGUuICB0aGlzIHByZXZlbnRz\nIGFkZGluZyBub24tZW50aXR5IGNsYXNzZXMgdG8KICAgICAgICAvLyByZXBv\nc2l0b3J5IGlmIHdlJ3JlIGlnbm9yaW5nIHRoZXNlIGFubm90YXRpb25zIGlu\nIG1hcHBpbmcgbW9kZQogICAgICAgIGlmICghX2Nscy5pc0Fubm90YXRpb25Q\ncmVzZW50KEVudGl0eS5jbGFzcykKICAgICAgICAgICAgJiYgIV9jbHMuaXNB\nbm5vdGF0aW9uUHJlc2VudChFbWJlZGRhYmxlLmNsYXNzKQogICAgICAgICAg\nICAmJiAhX2Nscy5pc0Fubm90YXRpb25QcmVzZW50KE1hcHBlZFN1cGVyY2xh\nc3MuY2xhc3MpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nLy8gZmluZCAvIGNyZWF0ZSBtZXRhZGF0YQogICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YSA9IGdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEVudGl0\neSBlbnRpdHkgPSAoRW50aXR5KSBfY2xzLmdldEFubm90YXRpb24oRW50aXR5\nLmNsYXNzKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAg\nICAgICAgICAvLyB3aGlsZSB0aGUgc3BlYyBvbmx5IHByb3ZpZGVzIGZvciBl\nbWJlZGRlZCBleGNsdXNpdmUsIGl0IGRvZXNuJ3QKICAgICAgICAgICAgLy8g\nc2VlbSBoYXJkIHRvIHN1cHBvcnQgb3RoZXJ3aXNlCiAgICAgICAgICAgIGlm\nIChlbnRpdHkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1i\nZWRkZWRPbmx5KHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIG1ldGEuc2V0RW1iZWRkZWRPbmx5KGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShlbnRpdHkubmFtZSgp\nKSkKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFR5cGVBbGlhcyhlbnRp\ndHkubmFtZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gdHJhY2sgZmV0Y2ggZ3JvdXBzIHRvIHBhcnNlIHRoZW0gYWZ0ZXIgZmll\nbGRzLCBzaW5jZSB0aGV5CiAgICAgICAgLy8gcmVseSBvbiBmaWVsZCBtZXRh\nZGF0YQogICAgICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBudWxsOwogICAgICAg\nIERldGFjaGVkU3RhdGUgZGV0YWNoZWQgPSBudWxsOwoKICAgICAgICAvLyB0\ncmFjayBsaXN0ZW5lcnMgc2luY2Ugd2UgbmVlZCB0byBtZXJnZSB0aGVtIHdp\ndGggZW50aXR5IGNhbGxiYWNrcwogICAgICAgIENvbGxlY3Rpb248TGlmZWN5\nY2xlQ2FsbGJhY2tzPltdIGxpc3RlbmVycyA9IG51bGw7CiAgICAgICAgTWV0\nYURhdGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDog\nX2Nscy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAg\ndGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAg\nICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFu\nZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihtZXRhLCBhbm5vKTsKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBFTlRJVFlf\nTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMgPSBw\nYXJzZUVudGl0eUxpc3RlbmVycyhtZXRhLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKEVudGl0eUxpc3RlbmVycykgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYQ0xVREVf\nREVGQVVMVF9MSVNURU5FUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEu\nZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLnNldElnbm9yZVN5c3RlbUxpc3RlbmVycyh0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhD\nTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpLnNldElnbm9yZVN1cGVy\nY2xhc3NDYWxsYmFja3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChM\naWZlY3ljbGVNZXRhRGF0YS5JR05PUkVfSElHSCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUobWV0YSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIElEX0NMQVNTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhLnNldE9iamVj\ndElkVHlwZSgoKElkQ2xhc3MpIGFubm8pLnZhbHVlKCksIHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBO\nQVRJVkVfUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVy\neU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5h\ndGl2ZVF1ZXJpZXMoX2NscywKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICgoTmFtZWROYXRpdmVRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTkFU\nSVZFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZl\nUXVlcmllcyhfY2xzLCAoTmFtZWROYXRpdmVRdWVyeSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFV\nRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKF9j\nbHMsICgoTmFtZWRRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUlk6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKF9jbHMsIChO\nYW1lZFF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVSQVRPUjoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoX2Ns\ncywgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREFUQV9DQUNIRToK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhQ2FjaGUobWV0YSwgKERh\ndGFDYWNoZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIERBVEFTVE9SRV9JRDoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgcGFyc2VEYXRhU3RvcmVJZChtZXRhLCAoRGF0YVN0b3JlSWQp\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBERVRBQ0hFRF9TVEFURToKICAgICAgICAgICAgICAgICAg\nICBkZXRhY2hlZCA9IChEZXRhY2hlZFN0YXRlKSBhbm5vOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRVRDSF9H\nUk9VUDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZmdzID0gbmV3IEZldGNoR3Jv\ndXBbXXsgKEZldGNoR3JvdXApIGFubm8gfTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkVUQ0hfR1JPVVBTOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBmZ3MgPSAoKEZldGNoR3JvdXBzKSBhbm5v\nKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVk\nIiwgX2NscywKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmlu\nZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNlRGV0YWNoZWRT\ndGF0ZShtZXRhLCBkZXRhY2hlZCk7CgogICAgICAgICAgICAvLyBtZXJnZSBj\nYWxsYmFjayBtZXRob2RzIHdpdGggZGVjbGFyZWQgbGlzdGVuZXJzCiAgICAg\nICAgICAgIGludFtdIGhpZ2hzID0gbnVsbDsKICAgICAgICAgICAgaWYgKGxp\nc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBoaWdocyA9IG5l\ndyBpbnRbbGlzdGVuZXJzLmxlbmd0aF07CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGhpZ2hzW2ldID0gbGlzdGVuZXJzW2ldLnNp\nemUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWNvcmRDYWxsYmFj\na3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2NscywgbGlzdGVuZXJz\nLCBmYWxzZSwKICAgICAgICAgICAgICAgIGZhbHNlLCBnZXRSZXBvc2l0b3J5\nKCkpLCBoaWdocywgZmFsc2UpOwoKICAgICAgICAgICAgLy8gc2NhbiBwb3Nz\naWJseSBub24tUEMgaGllcmFyY2h5IGZvciBjYWxsYmFja3MuCiAgICAgICAg\nICAgIC8vIHJlZHVuZGFudCBmb3IgUEMgc3VwZXJjbGFzcyBidXQgd2UgZG9u\nJ3Qga25vdyB0aGF0IHlldAogICAgICAgICAgICAvLyBzbyBsZXQgTGlmZWN5\nY2xlTWV0YURhdGEgZGV0ZXJtaW5lIHRoYXQKICAgICAgICAgICAgaWYgKCFP\nYmplY3QuY2xhc3MuZXF1YWxzKF9jbHMuZ2V0U3VwZXJjbGFzcygpKSkgewog\nICAgICAgICAgICAgICAgcmVjb3JkQ2FsbGJhY2tzKG1ldGEsIHBhcnNlQ2Fs\nbGJhY2tNZXRob2RzKF9jbHMuZ2V0U3VwZXJjbGFzcygpLAogICAgICAgICAg\nICAgICAgICAgIG51bGwsIHRydWUsIGZhbHNlLCBnZXRSZXBvc2l0b3J5KCkp\nLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKSkKICAgICAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkg\nPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAg\nICAgICAgIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoZm1kKTsKICAgICAgICAv\nLyBwYXJzZSBmZXRjaCBncm91cHMgYWZ0ZXIgZmllbGRzCiAgICAgICAgaWYg\nKGZncyAhPSBudWxsKQogICAgICAgICAgICBwYXJzZUZldGNoR3JvdXBzKG1l\ndGEsIGZncyk7CgogICAgICAgIC8vIGFsd2F5cyBwYXJzZSBtYXBwaW5nIGFm\ndGVyIG1ldGFkYXRhIGluIGNhc2UgdGhlcmUgYXJlIGRlcGVuZGVuY2llcwog\nICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkgewogICAgICAg\nICAgICBwYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRpb25zKG1ldGEpOwogICAg\nICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogbWV0YS5nZXREZWNs\nYXJlZEZpZWxkcygpKQogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRNYW5h\nZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkK\nICAgICAgICAgICAgICAgICAgICBwYXJzZU1lbWJlck1hcHBpbmdBbm5vdGF0\naW9ucyhmbWQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNsYXNzIG1hcHBpbmcgYW5ub3Rh\ndGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlQ2xhc3NN\nYXBwaW5nQW5ub3RhdGlvbnMoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1\nbmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NBbm5vdGF0aW9uKENsYXNzTWV0YURh\ndGEgbWV0YSwKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIG9yIGNy\nZWF0ZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuIE1heSByZXR1cm4g\nbnVsbCBpZgogICAgICogdGhpcyBjbGFzcyBoYXMgYWxyZWFkeSBiZWVuIHBh\ncnNlZCBmdWxseS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRh\nIGdldE1ldGFEYXRhKCkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRNZXRhRGF0YShfY2xzKTsKICAg\nICAgICBpZiAobWV0YSAhPSBudWxsICYmCiAgICAgICAgICAgICgoaXNNZXRh\nRGF0YU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01F\nVEEpICE9IDApIHx8CiAgICAgICAgICAgICAgICAoaXNNYXBwaW5nTW9kZSgp\nICYmCiAgICAgICAgICAgICAgICAgICAgKG1ldGEuZ2V0U291cmNlTW9kZSgp\nICYgTU9ERV9NQVBQSU5HKSAhPSAwKSkpIHsKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJu\nKF9sb2MuZ2V0KCJkdXAtbWV0YWRhdGEiLCBfY2xzLmdldE5hbWUoKSkpOwog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlm\nIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9z\naXRvcnkoKS5hZGRNZXRhRGF0YShfY2xzKTsKICAgICAgICAgICAgbWV0YS5z\nZXRFbnZDbGFzc0xvYWRlcihfZW52TG9hZGVyKTsKICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKE1PREVfTk9ORSk7CiAgICAgICAgICAgIG1ldGEu\nc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgbWV0YS5TUkNfQU5OT1RBVElP\nTlMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERldGVybWluZSB0aGUgc291cmNlIGZpbGUgd2UncmUg\ncGFyc2luZy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpbGUgZ2V0U291cmNl\nRmlsZSgpIHsKICAgICAgICBpZiAoX2ZpbGUgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9maWxlOwoKICAgICAgICBDbGFzcyBjbHMgPSBfY2xzOwog\nICAgICAgIHdoaWxlIChjbHMuZ2V0RW5jbG9zaW5nQ2xhc3MoKSAhPSBudWxs\nKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0RW5jbG9zaW5nQ2xhc3MoKTsK\nCiAgICAgICAgU3RyaW5nIHJzcmMgPSBTdHJpbmdVdGlscy5yZXBsYWNlKGNs\ncy5nZXROYW1lKCksICIuIiwgIi8iKTsKICAgICAgICBDbGFzc0xvYWRlciBs\nb2FkZXIgPSBjbHMuZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICBpZiAobG9h\nZGVyID09IG51bGwpCiAgICAgICAgICAgIGxvYWRlciA9IENsYXNzTG9hZGVy\nLmdldFN5c3RlbUNsYXNzTG9hZGVyKCk7CiAgICAgICAgaWYgKGxvYWRlciA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBVUkwg\ndXJsID0gbG9hZGVyLmdldFJlc291cmNlKHJzcmMgKyAiLmphdmEiKTsKICAg\nICAgICBpZiAodXJsID09IG51bGwpIHsKICAgICAgICAgICAgdXJsID0gbG9h\nZGVyLmdldFJlc291cmNlKHJzcmMgKyAiLmNsYXNzIik7CiAgICAgICAgICAg\nIGlmICh1cmwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBfZmlsZSA9\nIG5ldyBGaWxlKHVybC50b1VSSSgpKTsKICAgICAgICB9IGNhdGNoIChVUklT\neW50YXhFeGNlcHRpb24gZSkgewogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbiBpYWUpIHsKICAgICAgICAgICAgLy8gdGhpcyBp\ncyB0aHJvd24gd2hlbiB0aGUgVVJJIGlzIG5vbi1oaWVyYXJjaGljYWwgKGFr\nYSBKQm9zcykKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9maWxlOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQERhdGFTdG9yZUlkLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEYXRhU3RvcmVJZChDbGFzc01ldGFE\nYXRhIG1ldGEsIERhdGFTdG9yZUlkIGlkKSB7CiAgICAgICAgbWV0YS5zZXRJ\nZGVudGl0eVR5cGUoQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpOwoKICAg\nICAgICBpbnQgc3RyYXQgPSBnZXRHZW5lcmF0ZWRWYWx1ZVN0cmF0ZWd5KG1l\ndGEsIGlkLnN0cmF0ZWd5KCksCiAgICAgICAgICAgIGlkLmdlbmVyYXRvcigp\nKTsKICAgICAgICBpZiAoc3RyYXQgIT0gLTEpCiAgICAgICAgICAgIG1ldGEu\nc2V0SWRlbnRpdHlTdHJhdGVneShzdHJhdCk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIHN3aXRjaCAoaWQuc3RyYXRlZ3koKSkgewogICAgICAgICAg\nICAgICAgY2FzZSBUQUJMRToKICAgICAgICAgICAgICAgIGNhc2UgU0VRVUVO\nQ0U6CiAgICAgICAgICAgICAgICAgICAgLy8gdGVjaG5pY2FsbHkgd2Ugc2hv\ndWxkIGhhdmUgc2VwYXJhdGUgc3lzdGVtIHRhYmxlIGFuZAogICAgICAgICAg\nICAgICAgICAgIC8vIHNlcXVlbmNlIGdlbmVyYXRvcnMsIGJ1dCBpdCdzIGVh\nc2llciB0byBqdXN0IHJlbHkgb24KICAgICAgICAgICAgICAgICAgICAvLyB0\naGUgc3lzdGVtIG9yZy5hcGFjaGUub3BlbmpwYS5TZXF1ZW5jZSBzZXR0aW5n\nIGZvciBib3RoCiAgICAgICAgICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkoaWQuZ2VuZXJhdG9yKCkpKQogICAgICAgICAgICAgICAgICAg\nICAgICBtZXRhLnNldElkZW50aXR5U2VxdWVuY2VOYW1lKAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RF\nTSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICBtZXRhLnNldElkZW50aXR5U2VxdWVuY2VOYW1lKGlkLmdlbmVy\nYXRvcigpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgQVVUTzoKICAgICAgICAgICAgICAgICAgICBtZXRhLnNl\ndElkZW50aXR5U3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVzLk5BVElWRSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIElERU5USVRZOgogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRlbnRp\ndHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuQVVUT0FTU0lHTik7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihpZC5zdHJhdGVneSgpLnRvU3RyaW5nKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2FybiB0aGF0\nIEBGbHVzaE1vZGUgaXMgbm90IHN1cHBvcnRlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHdhcm5GbHVzaE1vZGUoT2JqZWN0IGNvbnRleHQpIHsKICAg\nICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCAiRmx1c2hNb2RlIiwg\nY29udGV4dCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQERhdGFD\nYWNoZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGF0YUNhY2hl\nKENsYXNzTWV0YURhdGEgbWV0YSwgRGF0YUNhY2hlIGNhY2hlKSB7CiAgICAg\nICAgaWYgKGNhY2hlLnRpbWVvdXQoKSAhPSBJbnRlZ2VyLk1JTl9WQUxVRSkK\nICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVUaW1lb3V0KGNhY2hlLnRp\nbWVvdXQoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGNh\nY2hlLm5hbWUoKSkpCiAgICAgICAgICAgIG1ldGEuc2V0RGF0YUNhY2hlTmFt\nZShjYWNoZS5uYW1lKCkpOwogICAgICAgIGVsc2UgaWYgKGNhY2hlLmVuYWJs\nZWQoKSkKICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVOYW1lKAogICAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRh\nQ2FjaGUuTkFNRV9ERUZBVUxUKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIG1ldGEuc2V0RGF0YUNhY2hlTmFtZShudWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIEBEZXRhY2hlZFN0YXRlLiBUaGUgYW5ub3RhdGlvbiBt\nYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGV0\nYWNoZWRTdGF0ZShDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgRGV0YWNo\nZWRTdGF0ZSBkZXRhY2hlZCkgewogICAgICAgIGlmIChkZXRhY2hlZCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmICghZGV0YWNoZWQuZW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKG51bGwpOwog\nICAgICAgICAgICBlbHNlIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShkZXRh\nY2hlZC5maWVsZE5hbWUoKSkpCiAgICAgICAgICAgICAgICBtZXRhLnNldERl\ndGFjaGVkU3RhdGUoQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3Rh\ndGUoZGV0YWNoZWQuZmllbGROYW1lKCkpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICBpZiAoZmllbGRzW2ldLmlzQW5ub3RhdGlvblByZXNlbnQoRGV0YWNo\nZWRTdGF0ZS5jbGFzcykpCiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRE\nZXRhY2hlZFN0YXRlKGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBFbnRpdHlMaXN0ZW5lcnMK\nICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxi\nYWNrcz5bXSBwYXJzZUVudGl0eUxpc3RlbmVycwogICAgICAgIChDbGFzc01l\ndGFEYXRhIG1ldGEsIEVudGl0eUxpc3RlbmVycyBsaXN0ZW5lcnMpIHsKICAg\nICAgICBDbGFzc1tdIGNsYXNzZXMgPSBsaXN0ZW5lcnMudmFsdWUoKTsKICAg\nICAgICBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBwYXJzZWQg\nPSBudWxsOwogICAgICAgIGZvciAoQ2xhc3MgY2xzIDogY2xhc3NlcykKICAg\nICAgICAgICAgcGFyc2VkID0gcGFyc2VDYWxsYmFja01ldGhvZHMoY2xzLCBw\nYXJzZWQsIHRydWUsIHRydWUsIAogICAgICAgICAgICAgICAgZ2V0UmVwb3Np\ndG9yeSgpKTsKICAgICAgICByZXR1cm4gcGFyc2VkOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgY2FsbGJhY2sgbWV0aG9kcyBpbnRvIHRoZSBnaXZl\nbiBhcnJheSwgYW5kIHJldHVybiB0aGF0IGFycmF5LAogICAgICogY3JlYXRp\nbmcgb25lIGlmIG51bGwuIEVhY2ggaW5kZXggaW50byB0aGUgYXJyYXkgaXMg\nYSBjb2xsZWN0aW9uIG9mCiAgICAgKiBjYWxsYmFjayBhZGFwdGVycyBmb3Ig\ndGhhdCBudW1lcmljIGV2ZW50IHR5cGUuCiAgICAgKgogICAgICogQHBhcmFt\nIHN1cHMgd2hldGhlciB0byBzY2FuIHN1cGVyY2xhc3NlcwogICAgICogQHBh\ncmFtIGxpc3RlbmVyIHdoZXRoZXIgdGhpcyBpcyBhIGxpc3RlbmVyIG9yIG5v\ndAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIENvbGxlY3Rpb248TGlmZWN5\nY2xlQ2FsbGJhY2tzPltdIHBhcnNlQ2FsbGJhY2tNZXRob2RzCiAgICAgICAg\nKENsYXNzIGNscywgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10g\nY2FsbGJhY2tzLCBib29sZWFuIHN1cHMsCiAgICAgICAgYm9vbGVhbiBsaXN0\nZW5lciwgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgLy8g\nZmlyc3Qgc29ydCAvIGZpbHRlciBiYXNlZCBvbiBpbmhlcml0YW5jZQogICAg\nICAgIFNldDxNZXRob2Q+IG1ldGhvZHMgPSBuZXcgVHJlZVNldDxNZXRob2Q+\nKE1ldGhvZENvbXBhcmF0b3IuCiAgICAgICAgICAgIGdldEluc3RhbmNlKCkp\nOwoKICAgICAgICBpbnQgbW9kczsKICAgICAgICBDbGFzcyBzdXAgPSBjbHM7\nCiAgICAgICAgTWV0aG9kS2V5IGtleTsKICAgICAgICBTZXQ8TWV0aG9kS2V5\nPiBzZWVuID0gbmV3IEhhc2hTZXQ8TWV0aG9kS2V5PigpOwogICAgICAgIGRv\nIHsKICAgICAgICAgICAgZm9yIChNZXRob2QgbSA6IHN1cC5nZXREZWNsYXJl\nZE1ldGhvZHMoKSkgewogICAgICAgICAgICAgICAgbW9kcyA9IG0uZ2V0TW9k\naWZpZXJzKCk7CiAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNTdGF0\naWMobW9kcykgfHwgTW9kaWZpZXIuaXNGaW5hbChtb2RzKSB8fAogICAgICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcy5lcXVhbHMobS5nZXREZWNsYXJp\nbmdDbGFzcygpKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICBrZXkgPSBuZXcgTWV0aG9kS2V5KG0pOwogICAgICAg\nICAgICAgICAgaWYgKCFzZWVuLmNvbnRhaW5zKGtleSkpIHsKICAgICAgICAg\nICAgICAgICAgICBtZXRob2RzLmFkZChtKTsKICAgICAgICAgICAgICAgICAg\nICBzZWVuLmFkZChrZXkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHN1cCA9IHN1cC5nZXRTdXBlcmNsYXNzKCk7CiAg\nICAgICAgfSB3aGlsZSAoc3VwcyAmJiAhT2JqZWN0LmNsYXNzLmVxdWFscyhz\ndXApKTsKCiAgICAgICAgTWV0YURhdGFEZWZhdWx0cyBkZWYgPSByZXBvcy5n\nZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpOwogICAgICAgIGZv\nciAoTWV0aG9kIG0gOiBtZXRob2RzKSB7CiAgICAgICAgICAgIGZvciAoQW5u\nb3RhdGlvbiBhbm5vIDogbS5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsK\nICAgICAgICAgICAgICAgIE1ldGFEYXRhVGFnIHRhZyA9IF90YWdzLmdldChh\nbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICAgICAgaWYgKHRh\nZyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICAgICAgaW50W10gZXZlbnRzID0gTWV0YURhdGFQYXJzZXJzLmdl\ndEV2ZW50VHlwZXModGFnKTsKICAgICAgICAgICAgICAgIGlmIChldmVudHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICBpZiAoY2FsbGJhY2tzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgY2FsbGJhY2tzID0gKENvbGxlY3Rpb248TGlmZWN5Y2xlQ2Fs\nbGJhY2tzPltdKQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ29sbGVj\ndGlvbltMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRTLmxlbmd0aF07CgogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBldmVudHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpbnQgZSA9IGV2ZW50c1tp\nXTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tzW2VdID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tlXSA9IG5l\ndyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgICAgICAgICAgTWV0YURhdGFQ\nYXJzZXJzLnZhbGlkYXRlTWV0aG9kc0ZvclNhbWVDYWxsYmFjayhjbHMsIAog\nICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0sIG0sIHRhZywg\nZGVmLCByZXBvcy5nZXRMb2coKSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNr\nc1tlXS5hZGQobmV3IEJlYW5MaWZlY3ljbGVDYWxsYmFja3MoY2xzLCBtLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpKTsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBj\nYWxsYmFja3NbZV0uYWRkKG5ldyBNZXRob2RMaWZlY3ljbGVDYWxsYmFja3Mo\nbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjYWxsYmFja3M7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogU3RvcmUgbGlmZWN5Y2xlIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVjb3JkQ2FsbGJhY2tzKENs\nYXNzTWV0YURhdGEgY2xzLAogICAgICAgIENvbGxlY3Rpb248TGlmZWN5Y2xl\nQ2FsbGJhY2tzPltdIGNhbGxiYWNrcywgaW50W10gaGlnaHMsCiAgICAgICAg\nYm9vbGVhbiBzdXBlckNsYXNzKSB7CiAgICAgICAgaWYgKGNhbGxiYWNrcyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgTGlmZWN5Y2xl\nTWV0YURhdGEgbWV0YSA9IGNscy5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpOwog\nICAgICAgIExpZmVjeWNsZUNhbGxiYWNrc1tdIGFycmF5OwogICAgICAgIGZv\nciAoaW50IGV2ZW50IDogTGlmZWN5Y2xlRXZlbnQuQUxMX0VWRU5UUykgewog\nICAgICAgICAgICBpZiAoY2FsbGJhY2tzW2V2ZW50XSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGFycmF5ID0gY2Fs\nbGJhY2tzW2V2ZW50XS50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IExp\nZmVjeWNsZUNhbGxiYWNrc1tjYWxsYmFja3NbZXZlbnRdLnNpemUoKV0pOwoK\nICAgICAgICAgICAgaWYgKHN1cGVyQ2xhc3MpIHsKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0Tm9uUENTdXBlcmNsYXNzQ2FsbGJhY2tzKGV2ZW50LCBhcnJh\neSwKICAgICAgICAgICAgICAgICAgICAoaGlnaHMgPT0gbnVsbCkgPyAwIDog\naGlnaHNbZXZlbnRdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIG1ldGEuc2V0RGVjbGFyZWRDYWxsYmFja3MoZXZlbnQsIGFycmF5\nLAogICAgICAgICAgICAgICAgICAgIChoaWdocyA9PSBudWxsKSA/IDAgOiBo\naWdoc1tldmVudF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGZldGNoIGdyb3Vwcy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlRmV0Y2hHcm91cHMoQ2xhc3NNZXRhRGF0\nYSBtZXRhLCBGZXRjaEdyb3VwLi4uIGdyb3VwcykgewogICAgICAgIG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXAgZmc7CiAgICAgICAgZm9y\nIChGZXRjaEdyb3VwIGdyb3VwIDogZ3JvdXBzKSB7CiAgICAgICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KGdyb3VwLm5hbWUoKSkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nInVubmFtZWQtZmciLCBtZXRhKSk7CgogICAgICAgICAgICBmZyA9IG1ldGEu\nYWRkRGVjbGFyZWRGZXRjaEdyb3VwKGdyb3VwLm5hbWUoKSk7CiAgICAgICAg\nICAgIGlmIChncm91cC5wb3N0TG9hZCgpKQogICAgICAgICAgICAgICAgZmcu\nc2V0UG9zdExvYWQodHJ1ZSk7IAogICAgICAgICAgICBmb3IgKFN0cmluZyBz\nIDogZ3JvdXAuZmV0Y2hHcm91cHMoKSkKICAgICAgICAgICAgICAgIGZnLmFk\nZERlY2xhcmVkSW5jbHVkZShzKTsKICAgICAgICAgICAgZm9yIChGZXRjaEF0\ndHJpYnV0ZSBhdHRyIDogZ3JvdXAuYXR0cmlidXRlcygpKQogICAgICAgICAg\nICAgICAgcGFyc2VGZXRjaEF0dHJpYnV0ZShtZXRhLCBmZywgYXR0cik7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IGEgZmllbGQncyBm\nZXRjaCBncm91cC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRmV0\nY2hBdHRyaWJ1dGUoQ2xhc3NNZXRhRGF0YSBtZXRhLCAKICAgICAgICBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwIGZnLCBGZXRjaEF0dHJp\nYnV0ZSBhdHRyKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZCA9IG1l\ndGEuZ2V0RGVjbGFyZWRGaWVsZChhdHRyLm5hbWUoKSk7CiAgICAgICAgaWYg\nKGZpZWxkID09IG51bGwKICAgICAgICAgICAgfHwgZmllbGQuZ2V0TWFuYWdl\nbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLWZnLWZpZWxkIiwgZmcuZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgbWV0YSwgYXR0ci5uYW1lKCkpKTsKCiAgICAgICAgZmllbGQuc2V0SW5G\nZXRjaEdyb3VwKGZnLmdldE5hbWUoKSwgdHJ1ZSk7CiAgICAgICAgaWYgKGF0\ndHIucmVjdXJzaW9uRGVwdGgoKSAhPSBJbnRlZ2VyLk1JTl9WQUxVRSkKICAg\nICAgICAgICAgZmcuc2V0UmVjdXJzaW9uRGVwdGgoZmllbGQsIGF0dHIucmVj\ndXJzaW9uRGVwdGgoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIGFu\nbm90YXRpb25zIGZvciB0aGUgZ2l2ZW4gbWVtYmVyLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VNZW1iZXJBbm5vdGF0aW9ucyhGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIC8vIGxvb2sgZm9yIHBlcnNpc3RlbmNlIHN0\ncmF0ZWd5IGluIGFubm90YXRpb24gdGFibGUKICAgICAgICBNZW1iZXIgbWVt\nYmVyID0gZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhRmFjdG9yeSgpLmdl\ndERlZmF1bHRzKCkuCiAgICAgICAgICAgIGdldEJhY2tpbmdNZW1iZXIoZm1k\nKTsKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHBzdHJhdCA9IFBlcnNp\nc3RlbmNlTWV0YURhdGFEZWZhdWx0cy4KICAgICAgICAgICAgZ2V0UGVyc2lz\ndGVuY2VTdHJhdGVneShmbWQsIG1lbWJlcik7CiAgICAgICAgaWYgKHBzdHJh\ndCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZm1kLnNl\ndEV4cGxpY2l0KHRydWUpOwoKICAgICAgICBBbm5vdGF0ZWRFbGVtZW50IGVs\nID0gKEFubm90YXRlZEVsZW1lbnQpIG1lbWJlcjsKICAgICAgICBib29sZWFu\nIGxvYiA9IGVsLmlzQW5ub3RhdGlvblByZXNlbnQoTG9iLmNsYXNzKTsKICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAgICAgICAgICBzd2l0\nY2ggKHBzdHJhdCkgewogICAgICAgICAgICAgICAgY2FzZSBCQVNJQzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUJhc2ljKGZtZCwgKEJhc2ljKSBlbC5n\nZXRBbm5vdGF0aW9uKEJhc2ljLmNsYXNzKSwgbG9iKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFOWV9PTkU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYW55VG9PbmUoZm1kLCAoTWFu\neVRvT25lKSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAg\nICAgIChNYW55VG9PbmUuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX09ORToKICAgICAgICAg\nICAgICAgICAgICBwYXJzZU9uZVRvT25lKGZtZCwgKE9uZVRvT25lKSBlbC5n\nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChPbmVUb09u\nZS5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFTUJFRERFRDoKICAgICAgICAgICAgICAgICAgICBw\nYXJzZUVtYmVkZGVkKGZtZCwgKEVtYmVkZGVkKSBlbC5nZXRBbm5vdGF0aW9u\nCiAgICAgICAgICAgICAgICAgICAgICAgIChFbWJlZGRlZC5jbGFzcykpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBPTkVfTUFOWToKICAgICAgICAgICAgICAgICAgICBwYXJzZU9uZVRvTWFu\neShmbWQsIChPbmVUb01hbnkpIGVsLmdldEFubm90YXRpb24KICAgICAgICAg\nICAgICAgICAgICAgICAgKE9uZVRvTWFueS5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQU5ZX01B\nTlk6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYW55VG9NYW55KGZtZCwg\nKE1hbnlUb01hbnkpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAg\nICAgICAgICAgKE1hbnlUb01hbnkuY2xhc3MpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSUzoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZVBlcnNpc3RlbnQoZm1kLCAoUGVyc2lzdGVu\ndCkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAo\nUGVyc2lzdGVudC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBQRVJTX0NPTEw6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VQZXJzaXN0ZW50Q29sbGVjdGlvbihmbWQsIChQZXJz\naXN0ZW50Q29sbGVjdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgZWwu\nZ2V0QW5ub3RhdGlvbihQZXJzaXN0ZW50Q29sbGVjdGlvbi5jbGFzcykpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBQRVJTX01BUDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVBlcnNpc3Rl\nbnRNYXAoZm1kLCAoUGVyc2lzdGVudE1hcCkKICAgICAgICAgICAgICAgICAg\nICAgICAgZWwuZ2V0QW5ub3RhdGlvbihQZXJzaXN0ZW50TWFwLmNsYXNzKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFRSQU5TSUVOVDoKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAm\nJiBsb2IpCiAgICAgICAgICAgIHBhcnNlTG9iTWFwcGluZyhmbWQpOwoKICAg\nICAgICAvLyBleHRlbnNpb25zCiAgICAgICAgTWV0YURhdGFUYWcgdGFnOwog\nICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogZWwuZ2V0RGVjbGFyZWRB\nbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChh\nbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25NZW1iZXJB\nbm5vdGF0aW9uKGZtZCwgYW5ubyk7CiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgRkxVU0hfTU9ERToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgd2FybkZsdXNoTW9kZShmbWQpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBHRU5FUkFURURfVkFM\nVUU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRl\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUdlbmVyYXRl\nZFZhbHVlKGZtZCwgKEdlbmVyYXRlZFZhbHVlKSBhbm5vKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSUQ6CiAg\nICAgICAgICAgICAgICBjYXNlIEVNQkVEREVEX0lEOgogICAgICAgICAgICAg\nICAgICAgIGZtZC5zZXRQcmltYXJ5S2V5KHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQVBfS0VZOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBLZXkoZm1kLCAo\nTWFwS2V5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgT1JERVJfQlk6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VPcmRlckJ5KGZtZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nKE9yZGVyQnkpIGVsLmdldEFubm90YXRpb24oT3JkZXJCeS5jbGFzcykpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01h\ncHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihlbCwgKFNlcXVlbmNlR2VuZXJhdG9y\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgVkVSU0lPTjoKICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0VmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgREVQRU5ERU5UOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpICYmICgoRGVwZW5kZW50KSBh\nbm5vKS52YWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0\nQ2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEVMRU1fREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01l\ndGFEYXRhTW9kZSgpICYmICgoRWxlbWVudERlcGVuZGVudCkgYW5ubykudmFs\ndWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXRDYXNjYWRlRGVsZXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAoVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX1RZUEU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0VHlw\nZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBlCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAoKChFbGVtZW50VHlwZSkgYW5ubykudmFsdWUoKSkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBF\nWFRFUk5BTF9WQUxTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RXh0\nZXJuYWxWYWx1ZXMoU3RyaW5ncy5qb2luKCgoRXh0ZXJuYWxWYWx1ZXMpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBhbm5vKS52YWx1ZSgpLCAiLCIp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRVhURVJOQUxJWkVSOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0RXh0ZXJuYWxpemVyKCgoRXh0ZXJuYWxpemVyKSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRkFDVE9SWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEZh\nY3RvcnkoKChGYWN0b3J5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSU5WRVJTRV9M\nT0dJQ0FMOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0SW52ZXJzZSgo\nKEludmVyc2VMb2dpY2FsKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0RFUEVO\nREVOVDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSAmJiAoKEtleURlcGVuZGVudCkgYW5ubykudmFsdWUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kLmdldEtleSgpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfQVVUTyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEtFWV9UWVBFOgogICAgICAgICAgICAgICAgICAg\nIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAg\nICBmbWQuZ2V0S2V5KCkuc2V0VHlwZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBl\nKCgoS2V5VHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFubm8p\nLnZhbHVlKCkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgTE9BRF9GRVRDSF9HUk9VUDoKICAgICAgICAgICAg\nICAgIAlpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgIAkJ\nZm1kLnNldExvYWRGZXRjaEdyb3VwKCgoTG9hZEZldGNoR3JvdXApYW5ubyku\ndmFsdWUoKSk7CiAgICAgICAgICAgICAgICAJYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIExSUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldExS\nUygoKExSUykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFJFQURfT05MWToKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcGFyc2VSZWFkT25seShmbWQsIChSZWFkT25seSkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFRZUEU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRU\neXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUoKChUeXBlKSBhbm5vKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGZtZCwKICAgICAgICAgICAg\nICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBtZW1iZXIg\nbWFwcGluZyBjb21wb25lbnRzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBwYXJzZU1lbWJlck1hcHBpbmdBbm5vdGF0aW9ucyhGaWVsZE1ldGFEYXRh\nIGZtZCkgewogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3Nl\ncyB0byBoYW5kbGUgdW5rbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5rbm93bk1lbWJlckFubm90YXRp\nb24oRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgQW5ub3RhdGlvbiBhbm5v\nKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgZ2l2ZW4gY2xhc3MgdG8gaXRzIE9wZW5KUEEgdHlw\nZSBvdmVycmlkZSBlcXVpdmFsZW50LgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBDbGFzcyB0b092ZXJyaWRlVHlwZShDbGFzcyBjbHMpIHsKICAgICAg\nICByZXR1cm4gKGNscyA9PSBFbnRpdHkuY2xhc3MpCiAgICAgICAgICAgID8g\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzIDogY2xzOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFJl\nYWRPbmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VSZWFkT25s\neShGaWVsZE1ldGFEYXRhIGZtZCwgUmVhZE9ubHkgcm8pIHsKICAgICAgICBp\nZiAocm8udmFsdWUoKSA9PSBVcGRhdGVBY3Rpb24uUkVTVFJJQ1QpCiAgICAg\nICAgICAgIGZtZC5zZXRVcGRhdGVTdHJhdGVneShVcGRhdGVTdHJhdGVnaWVz\nLlJFU1RSSUNUKTsKICAgICAgICBlbHNlIGlmIChyby52YWx1ZSgpID09IFVw\nZGF0ZUFjdGlvbi5JR05PUkUpCiAgICAgICAgICAgIGZtZC5zZXRVcGRhdGVT\ndHJhdGVneShVcGRhdGVTdHJhdGVnaWVzLklHTk9SRSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBp\nbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VHZW5lcmF0ZWRWYWx1ZShGaWVsZE1ldGFEYXRh\nIGZtZCwgR2VuZXJhdGVkVmFsdWUgZ2VuKSB7CiAgICAgICAgaW50IHN0cmF0\nID0gZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShmbWQsIGdlbi5zdHJhdGVn\neSgpLAogICAgICAgICAgICBnZW4uZ2VuZXJhdG9yKCkpOwogICAgICAgIGlm\nIChzdHJhdCAhPSAtMSkKICAgICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRl\nZ3koc3RyYXQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2gg\nKGdlbi5zdHJhdGVneSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxF\nOgogICAgICAgICAgICAgICAgY2FzZSBTRVFVRU5DRToKICAgICAgICAgICAg\nICAgICAgICAvLyB0ZWNobmljYWxseSB3ZSBzaG91bGQgaGF2ZSBzZXBhcmF0\nZSBzeXN0ZW0gdGFibGUgYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gc2Vx\ndWVuY2UgZ2VuZXJhdG9ycywgYnV0IGl0J3MgZWFzaWVyIHRvIGp1c3QgcmVs\neSBvbgogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzeXN0ZW0gb3JnLmFw\nYWNoZS5vcGVuanBhLlNlcXVlbmNlIHNldHRpbmcgZm9yIGJvdGgKICAgICAg\nICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShnZW4uZ2Vu\nZXJhdG9yKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFs\ndWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTSk7\nCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoZ2VuLmdlbmVyYXRvcigp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgQVVUTzoKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVT\nZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIElERU5USVRZOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVN0\ncmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKGdlbi5zdHJhdGVneSgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2\nYWx1ZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGdlbmVyYXRvciwgb3IgLTEg\naWYgdGhlCiAgICAgKiBzdHJhdGVneSBkZXBlbmRzIG9uIHRoZSA8Y29kZT5H\nZW5lcmF0aW9uVHlwZTwvY29kZT4gcmF0aGVyIHRoYW4gdGhlCiAgICAgKiBn\nZW5lcmF0b3IgbmFtZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50\nIGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koT2JqZWN0IGNvbnRleHQsCiAg\nICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3ksIFN0cmluZyBnZW5lcmF0\nb3IpIHsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gQVVUTyB8fCBTdHJpbmdV\ndGlscy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiAt\nMTsKCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX0hFWC5lcXVhbHMoZ2Vu\nZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3RyYXRlZ2llcy5V\nVUlEX0hFWDsKICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURfU1RSSU5HLmVx\ndWFscyhnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gVmFsdWVTdHJh\ndGVnaWVzLlVVSURfU1RSSU5HOwogICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiZ2VuZXJhdG9yLWJhZC1zdHJhdGVneSIs\nCiAgICAgICAgICAgIGNvbnRleHQsIGdlbmVyYXRvcikpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQEJhc2ljLiBHaXZlbiBhbm5vdGF0aW9uIG1h\neSBiZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VCYXNp\nYyhGaWVsZE1ldGFEYXRhIGZtZCwgQmFzaWMgYW5ubywgYm9vbGVhbiBsb2Ip\nIHsKICAgICAgICBDbGFzcyB0eXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgp\nOwogICAgICAgIGlmIChsb2IgJiYgdHlwZSAhPSBTdHJpbmcuY2xhc3MKICAg\nICAgICAgICAgJiYgdHlwZSAhPSBjaGFyW10uY2xhc3MgJiYgdHlwZSAhPSBD\naGFyYWN0ZXJbXS5jbGFzcwogICAgICAgICAgICAmJiB0eXBlICE9IGJ5dGVb\nXS5jbGFzcyAmJiB0eXBlICE9IEJ5dGVbXS5jbGFzcykKICAgICAgICAgICAg\nZm1kLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAgICAgICAgZWxzZSBpZiAoIWxv\nYikgewogICAgICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVD\nVDoKICAgICAgICAgICAgICAgICAgICBpZiAoRW51bS5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgICAgIGlmIChTZXJp\nYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgZm1kLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1t\nZXRhLWFubm8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm1kLCAi\nQmFzaWMiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAg\nICAgICBpZiAodHlwZSA9PSBjaGFyW10uY2xhc3MgfHwgdHlwZSA9PSBDaGFy\nYWN0ZXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCB0eXBl\nID09IGJ5dGVbXS5jbGFzcyB8fCB0eXBlID09IEJ5dGVbXS5jbGFzcykKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tCiAg\nICAgICAgICAgICAgICAgICAgICAgICh0eXBlLmdldENvbXBvbmVudFR5cGUo\nKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxpemVk\nKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtbWV0YS1hbm5vIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZCwgIkJhc2ljIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYW5ubyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZm1kLnNldElu\nRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5F\nQUdFUik7CiAgICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAg\nICAgIGZtZC5zZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQ\nVElPTik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATWFueVRvT25l\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYW55VG9PbmUoRmll\nbGRNZXRhRGF0YSBmbWQsIE1hbnlUb09uZSBhbm5vKSB7CiAgICAgICAgaWYg\nKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJNYW55VG9PbmUi\nKSk7CgogICAgICAgIC8vIGRvbid0IHNwZWNpZmljYWxseSBleGNsdWRlIHJl\nbGF0aW9uIGZyb20gREZHIGIvYyB0aGF0IHdpbGwgcHJldmVudAogICAgICAg\nIC8vIHVzIGZyb20gZXZlbiByZWFkaW5nIHRoZSBmayB3aGVuIHJlYWRpbmcg\nZnJvbSB0aGUgcHJpbWFyeSB0YWJsZSwKICAgICAgICAvLyB3aGljaCBpcyBu\nb3Qgd2hhdCBtb3N0IHVzZXJzIHdpbGwgd2FudAogICAgICAgIGlmIChhbm5v\nLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKQogICAgICAgICAgICBmbWQu\nc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAgICBpZiAoIWFu\nbm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51bGxWYWx1ZShG\naWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9OKTsKICAgICAgICBpZiAoYW5u\nby50YXJnZXRFbnRpdHkoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBm\nbWQuc2V0VHlwZU92ZXJyaWRlKGFubm8udGFyZ2V0RW50aXR5KCkpOwogICAg\nICAgIHNldENhc2NhZGVzKGZtZCwgYW5uby5jYXNjYWRlKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgQE9uZVRvT25lLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VPbmVUb09uZShGaWVsZE1ldGFEYXRhIGZtZCwg\nT25lVG9PbmUgYW5ubykgewogICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJl\nUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQs\nCiAgICAgICAgICAgICAgICAiT25lVG9PbmUiKSk7CgogICAgICAgIC8vIGRv\nbid0IHNwZWNpZmljYWxseSBleGNsdWRlIHJlbGF0aW9uIGZyb20gREZHIGIv\nYyB0aGF0IHdpbGwgcHJldmVudAogICAgICAgIC8vIHVzIGZyb20gZXZlbiBy\nZWFkaW5nIHRoZSBmayB3aGVuIHJlYWRpbmcgZnJvbSB0aGUgcHJpbWFyeSB0\nYWJsZSwKICAgICAgICAvLyB3aGljaCBpcyBub3Qgd2hhdCBtb3N0IHVzZXJz\nIHdpbGwgd2FudAogICAgICAgIGlmIChhbm5vLmZldGNoKCkgPT0gRmV0Y2hU\neXBlLkVBR0VSKQogICAgICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hH\ncm91cCh0cnVlKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAg\nICAgICAgICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExf\nRVhDRVBUSU9OKTsKCiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9k\nZSgpICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkp\nCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkp\nOwogICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xh\nc3MpCiAgICAgICAgICAgIGZtZC5zZXRUeXBlT3ZlcnJpZGUoYW5uby50YXJn\nZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNh\nc2NhZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARW1iZWRk\nZWQuIEdpdmVuIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVkKEZpZWxkTWV0YURhdGEgZm1k\nLCBFbWJlZGRlZCBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5\nYmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZt\nZCwKICAgICAgICAgICAgICAgICJFbWJlZGRlZCIpKTsKCiAgICAgICAgZm1k\nLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgZm1kLnNl\ndEVtYmVkZGVkKHRydWUpOwogICAgICAgIGlmIChmbWQuZ2V0RW1iZWRkZWRN\nZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgIGZtZC5hZGRFbWJlZGRl\nZE1ldGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAT25l\nVG9NYW55LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPbmVUb01h\nbnkoRmllbGRNZXRhRGF0YSBmbWQsIE9uZVRvTWFueSBhbm5vKSB7CiAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJl\nUEMoZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAg\nICAgICAgICAgICAgICJPbmVUb01hbnkiKSk7CiAgICAgICAgfQoKICAgICAg\nICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0g\nRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJp\nZGVNb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRC\neSgpKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVk\nQnkoKSk7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9p\nZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNs\nYXJlZFR5cGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2Fz\nY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5jYXNjYWRlKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hbnlUb01hbnkuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZU1hbnlUb01hbnkoRmllbGRNZXRhRGF0\nYSBmbWQsIE1hbnlUb01hbnkgYW5ubykgewogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRFbGVt\nZW50KCkpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAi\nT25lVG9NYW55IikpOwogICAgICAgIH0KCiAgICAgICAgZm1kLnNldEluRGVm\nYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdF\nUik7CiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmICFT\ndHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAg\nICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAg\nIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8u\ndGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRF\nbGVtZW50KCksIGFubm8uY2FzY2FkZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBNYXBLZXkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZU1hcEtleShGaWVsZE1ldGFEYXRhIGZtZCwgTWFwS2V5IGFubm8pIHsK\nICAgICAgICBTdHJpbmcgbmFtZSA9IGFubm8ubmFtZSgpOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBmbWQu\nZ2V0S2V5KCkuc2V0VmFsdWVNYXBwZWRCeShWYWx1ZU1ldGFEYXRhLk1BUFBF\nRF9CWV9QSyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmbWQuZ2V0S2V5\nKCkuc2V0VmFsdWVNYXBwZWRCeShuYW1lKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldHVwIHRoZSBmaWVsZCBhcyBhIExPQiBtYXBwaW5nLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUxvYk1hcHBpbmcoRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBPcmRl\nckJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPcmRlckJ5KEZp\nZWxkTWV0YURhdGEgZm1kLCBPcmRlckJ5IGFubm8pIHsKICAgICAgICBTdHJp\nbmcgZGVjID0gYW5uby52YWx1ZSgpOwogICAgICAgIGlmIChkZWMubGVuZ3Ro\nKCkgPT0gMCkKICAgICAgICAgICAgZGVjID0gT3JkZXIuRUxFTUVOVCArICIg\nYXNjIjsKICAgICAgICBmbWQuc2V0T3JkZXJEZWNsYXJhdGlvbihkZWMpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFBlcnNpc3RlbnQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNpc3RlbnQoRmllbGRNZXRh\nRGF0YSBmbWQsIFBlcnNpc3RlbnQgYW5ubykgewogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAg\nICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgpID09IEJ5dGVbXS5jbGFz\ncwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICB8fCBmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpCiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyBubyBi\ncmVhawogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1t\nZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3Rl\nbnQiKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1kLnNldE1h\ncHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAgZm1kLnNldEluRGVm\nYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdF\nUik7CiAgICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAg\nIGZtZC5zZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElP\nTik7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7\nCiAgICAgICAgaWYgKGFubm8uZW1iZWRkZWQoKSkgewogICAgICAgICAgICBp\nZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAi\nUGVyc2lzdGVudChlbWJlZGRlZD10cnVlKSIpKTsKICAgICAgICAgICAgZm1k\nLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdldEVt\nYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgZm1k\nLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudENvbGxlY3Rpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNpc3RlbnRDb2xsZWN0aW9u\nKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIFBlcnNpc3RlbnRDb2xsZWN0\naW9uIGFubm8pIHsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSAhPSBKYXZhVHlwZXMuQVJSQVkKICAgICAgICAgICAgJiYgZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQ09MTEVDVElPTikK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIlBl\ncnNpc3RlbnRDb2xsZWN0aW9uIikpOwoKICAgICAgICBpZiAoIVN0cmluZ1V0\naWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1k\nLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAgZm1kLnNl\ndEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNoVHlw\nZS5FQUdFUik7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudFR5cGUoKSAhPSB2\nb2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldERl\nY2xhcmVkVHlwZShhbm5vLmVsZW1lbnRUeXBlKCkpOwogICAgICAgIHNldENh\nc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8uZWxlbWVudENhc2NhZGUo\nKSk7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudEVtYmVkZGVkKCkpIHsKICAg\nICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0RWxlbWVu\ndCgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAg\nICAgICAgICAgICAiUGVyc2lzdGVudENvbGxlY3Rpb24oZW1iZWRkZWRFbGVt\nZW50PXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNl\ndEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdldEVsZW1l\nbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGZtZC5nZXRFbGVtZW50KCkuYWRkRW1iZWRkZWRNZXRhRGF0YSgp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBQZXJz\naXN0ZW50TWFwLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQZXJz\naXN0ZW50TWFwKEZpZWxkTWV0YURhdGEgZm1kLCBQZXJzaXN0ZW50TWFwIGFu\nbm8pIHsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAh\nPSBKYXZhVHlwZXMuTUFQKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAg\nICAgICAgICAgICAgICAiUGVyc2lzdGVudE1hcCIpKTsKCiAgICAgICAgZm1k\nLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNo\nVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGFubm8ua2V5VHlwZSgpICE9IHZv\naWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXREZWNsYXJl\nZFR5cGUoYW5uby5rZXlUeXBlKCkpOwogICAgICAgIGlmIChhbm5vLmVsZW1l\nbnRUeXBlKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVs\nZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5uby5lbGVtZW50VHlwZSgpKTsK\nICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0S2V5KCksIGFubm8ua2V5Q2Fz\nY2FkZSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0RWxlbWVudCgp\nLCBhbm5vLmVsZW1lbnRDYXNjYWRlKCkpOwogICAgICAgIGlmIChhbm5vLmtl\neUVtYmVkZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5\nYmVQQyhmbWQuZ2V0S2V5KCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwg\nZm1kLAogICAgICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50TWFwKGVtYmVk\nZGVkS2V5PXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0\nRW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0S2V5KCku\nZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAg\nICBmbWQuZ2V0S2V5KCkuYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAg\nIH0KICAgICAgICBpZiAoYW5uby5lbGVtZW50RW1iZWRkZWQoKSkgewogICAg\nICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRFbGVtZW50\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAg\nICAgICAgICAgICJQZXJzaXN0ZW50TWFwKGVtYmVkZGVkVmFsdWU9dHJ1ZSki\nKSk7CiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RW1iZWRkZWQo\ndHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmdldEVt\nYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgZm1k\nLmdldEVsZW1lbnQoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IGNhc2NhZGVzIG9uIHJlbGF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Q2FzY2FkZXMoVmFs\ndWVNZXRhRGF0YSB2bWQsIENhc2NhZGVUeXBlW10gY2FzY2FkZXMpIHsKICAg\nICAgICBmb3IgKENhc2NhZGVUeXBlIGNhc2NhZGUgOiBjYXNjYWRlcykgewog\nICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwg\nY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5SRU1PVkUpCiAgICAgICAgICAgICAg\nICB2bWQuc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2Fk\nZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUEVSU0lTVCkK\nICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlUGVyc2lzdChWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNh\nc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2Fk\nZVR5cGUuTUVSR0UpCiAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZUF0\ndGFjaChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAg\nICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2Nh\nZGUgPT0gQ2FzY2FkZVR5cGUuUkVGUkVTSCkKICAgICAgICAgICAgICAgIHZt\nZC5zZXRDYXNjYWRlUmVmcmVzaChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1N\nRURJQVRFKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBAU2VxdWVuY2VHZW5lcmF0b3IuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKEFubm90YXRlZEVsZW1lbnQgZWws\nCiAgICAgICAgU2VxdWVuY2VHZW5lcmF0b3IgZ2VuKSB7CiAgICAgICAgU3Ry\naW5nIG5hbWUgPSBnZW4ubmFtZSgpOwogICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNlcS1uYW1lIiwgZWwpKTsKCiAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2Utc2VxdWVuY2UiLCBuYW1lKSk7\nCgogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IGdldFJlcG9zaXRv\ncnkoKS5nZXRDYWNoZWRTZXF1ZW5jZU1ldGFEYXRhCiAgICAgICAgICAgIChu\nYW1lKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgiZHVwLXNlcXVlbmNlIiwgbmFtZSwgZWwpKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gY3Jl\nYXRlIG5ldyBzZXF1ZW5jZQogICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5\nKCkuYWRkU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAgICBTdHJpbmcg\nc2VxID0gZ2VuLnNlcXVlbmNlTmFtZSgpOwogICAgICAgIGludCBpbml0aWFs\nID0gZ2VuLmluaXRpYWxWYWx1ZSgpOwogICAgICAgIGludCBhbGxvY2F0ZSA9\nIGdlbi5hbGxvY2F0aW9uU2l6ZSgpOwogICAgICAgIC8vIGRvbid0IGFsbG93\nIGluaXRpYWwgb2YgMCBiL2MgbG9va3MgbGlrZSBkZWYgdmFsdWUKICAgICAg\nICBpZiAoaW5pdGlhbCA9PSAwKQogICAgICAgICAgICBpbml0aWFsID0gMTsK\nCiAgICAgICAgLy8gY3JlYXRlIHBsdWdpbiBzdHJpbmcgZnJvbSBpbmZvCiAg\nICAgICAgU3RyaW5nIGNsc05hbWUsIHByb3BzOwogICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KHNlcSkpIHsKICAgICAgICAgICAgY2xzTmFtZSA9\nIFNlcXVlbmNlTWV0YURhdGEuSU1QTF9OQVRJVkU7CiAgICAgICAgICAgIHBy\nb3BzID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKHNlcS5pbmRleE9mKCco\nJykgIT0gLTEpIC8vIHBsdWdpbgogICAgICAgIHsKICAgICAgICAgICAgY2xz\nTmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShzZXEpOwogICAg\nICAgICAgICBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMo\nc2VxKTsKICAgICAgICAgICAgc2VxID0gbnVsbDsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBjbHNOYW1lID0gU2VxdWVuY2VNZXRhRGF0YS5JTVBM\nX05BVElWRTsKICAgICAgICAgICAgcHJvcHMgPSBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgbWV0YS5zZXRTZXF1ZW5jZVBsdWdpbihDb25maWd1cmF0aW9u\ncy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJvcHMpKTsKICAgICAgICBtZXRhLnNl\ndFNlcXVlbmNlKHNlcSk7CiAgICAgICAgbWV0YS5zZXRJbml0aWFsVmFsdWUo\naW5pdGlhbCk7CiAgICAgICAgbWV0YS5zZXRBbGxvY2F0ZShhbGxvY2F0ZSk7\nCiAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNlRmlsZSgpLCAoZWwg\naW5zdGFuY2VvZiBDbGFzcykgPyBlbCA6IG51bGwsCiAgICAgICAgICAgIG1l\ndGEuU1JDX0FOTk9UQVRJT05TKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBOYW1lZFF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VOYW1lZFF1ZXJpZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwgTmFtZWRRdWVy\neS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRhOwog\nICAgICAgIGZvciAoTmFtZWRRdWVyeSBxdWVyeSA6IHF1ZXJpZXMpIHsKICAg\nICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkubmFtZSgp\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tcXVlcnktbmFtZSIsIGVsKSk7CiAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAgICAgICAgIHF1\nZXJ5Lm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJwYXJzZS1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSkpOwoKICAgICAgICAg\nICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRRdWVyeU1ldGFE\nYXRhKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChtZXRh\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoImR1cC1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSwgZWwpKTsKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWV0\nYSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRhKG51bGwsIHF1\nZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0UXVlcnlTdHJpbmco\ncXVlcnkucXVlcnkoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0TGFuZ3VhZ2Uo\nSlBRTFBhcnNlci5MQU5HX0pQUUwpOwogICAgICAgICAgICBmb3IgKFF1ZXJ5\nSGludCBoaW50IDogcXVlcnkuaGludHMoKSkKICAgICAgICAgICAgICAgIG1l\ndGEuYWRkSGludChoaW50Lm5hbWUoKSwgaGludC52YWx1ZSgpKTsKCiAgICAg\nICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGlu\nc3RhbmNlb2YgQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICAgICAg\nbWV0YS5TUkNfQU5OT1RBVElPTlMpOwogICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9k\nZShNT0RFX01FVEEpOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdN\nb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9E\nRV9NQVBQSU5HKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfUVVFUlkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBOYW1lZE5hdGl2ZVF1ZXJ5Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJp\nZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwKICAgICAgICBOYW1lZE5hdGl2ZVF1\nZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7\nCiAgICAgICAgZm9yIChOYW1lZE5hdGl2ZVF1ZXJ5IHF1ZXJ5IDogcXVlcmll\ncykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVy\neS5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnktbmFtZSIsCiAg\nICAgICAgICAgICAgICAgICAgZWwpKTsKICAgICAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5h\ndGl2ZS1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5\nLm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJwYXJzZS1uYXRpdmUtcXVlcnkiLCBxdWVyeS5uYW1lKCkpKTsKCiAgICAg\nICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2FjaGVkUXVlcnlN\nZXRhRGF0YShudWxsLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBpZiAo\nbWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJkdXAtcXVlcnkiLCBxdWVyeS5uYW1lKCksIGVsKSk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRhRGF0YShudWxs\nLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNldFF1ZXJ5U3Ry\naW5nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRhLnNldExhbmd1\nYWdlKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMKTsKICAgICAgICAgICAgQ2xh\nc3MgcmVzID0gcXVlcnkucmVzdWx0Q2xhc3MoKTsKICAgICAgICAgICAgaWYg\nKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShyZXMpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRDYW5kaWRhdGVUeXBlKHJlcyk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKCF2b2lkLmNsYXNzLmVxdWFscyhyZXMpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRSZXN1bHRUeXBlKHJlcyk7CgogICAgICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucmVzdWx0U2V0TWFwcGluZygp\nKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0UmVzdWx0U2V0TWFwcGluZ05h\nbWUocXVlcnkucmVzdWx0U2V0TWFwcGluZygpKTsKCiAgICAgICAgICAgIG1l\ndGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGluc3RhbmNlb2Yg\nQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICAgICAgbWV0YS5TUkNf\nQU5OT1RBVElPTlMpOwogICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01F\nVEEpOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdNb2RlKCkpCiAg\nICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5H\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0YS5zZXRT\nb3VyY2VNb2RlKE1PREVfUVVFUlkpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBNZXRob2RLZXkgewoKICAgICAgICBwcml2\nYXRlIGZpbmFsIE1ldGhvZCBfbWV0aG9kOwoKICAgICAgICBwdWJsaWMgTWV0\naG9kS2V5KE1ldGhvZCBtKSB7CiAgICAgICAgICAgIF9tZXRob2QgPSBtOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICAgICAgaW50IGNvZGUgPSA0NiAqIDEyICsgX21ldGhvZC5nZXROYW1l\nKCkuaGFzaENvZGUoKTsKICAgICAgICAgICAgZm9yIChDbGFzcyBwYXJhbSA6\nIF9tZXRob2QuZ2V0UGFyYW1ldGVyVHlwZXMoKSkKICAgICAgICAgICAgICAg\nIGNvZGUgPSA0NiAqIGNvZGUgKyBwYXJhbS5oYXNoQ29kZSgpOwogICAgICAg\nICAgICByZXR1cm4gY29kZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGVxdWFscyhPYmplY3QgbykgewogICAgICAgICAgICBpZiAoIShv\nIGluc3RhbmNlb2YgTWV0aG9kS2V5KSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgTWV0aG9kIG90aGVyID0gKChNZXRob2RL\nZXkpIG8pLl9tZXRob2Q7CiAgICAgICAgICAgIGlmICghX21ldGhvZC5nZXRO\nYW1lKCkuZXF1YWxzKG90aGVyLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBBcnJheXMuZXF1\nYWxzKF9tZXRob2QuZ2V0UGFyYW1ldGVyVHlwZXMoKSwKICAgICAgICAgICAg\nICAgIG90aGVyLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNZXRob2RDb21wYXJhdG9y\nIGltcGxlbWVudHMgQ29tcGFyYXRvciB7CgogICAgICAgIHByaXZhdGUgc3Rh\ndGljIE1ldGhvZENvbXBhcmF0b3IgSU5TVEFOQ0UgPSBudWxsOwoKICAgICAg\nICBwdWJsaWMgc3RhdGljIE1ldGhvZENvbXBhcmF0b3IgZ2V0SW5zdGFuY2Uo\nKSB7CiAgICAgICAgICAgIGlmIChJTlNUQU5DRSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgSU5TVEFOQ0UgPSBuZXcgTWV0aG9kQ29tcGFyYXRvcigpOwog\nICAgICAgICAgICByZXR1cm4gSU5TVEFOQ0U7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGNvbXBhcmUoT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsK\nICAgICAgICAgICAgTWV0aG9kIG0xID0gKE1ldGhvZCkgbzE7CiAgICAgICAg\nICAgIE1ldGhvZCBtMiA9IChNZXRob2QpIG8yOwoKICAgICAgICAgICAgQ2xh\nc3MgYzEgPSBtMS5nZXREZWNsYXJpbmdDbGFzcygpOwogICAgICAgICAgICBD\nbGFzcyBjMiA9IG0yLmdldERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgICAg\nIGlmICghYzEuZXF1YWxzKGMyKSkgewogICAgICAgICAgICAgICAgaWYgKGMx\nLmlzQXNzaWduYWJsZUZyb20oYzIpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiAtMTsKICAgICAgICAgICAgICAgIGVsc2UKCQkJCQlyZXR1cm4gMTsK\nCQkJfQoJCQlpbnQgY29tcGFyZSA9IG0xLmdldE5hbWUgKCkuY29tcGFyZVRv\nIChtMi5nZXROYW1lICgpKTsKCQkJaWYgKGNvbXBhcmUgPT0gMCkKCQkJCXJl\ndHVybiBtMS5oYXNoQ29kZSAoKSAtIG0yLmhhc2hDb2RlICgpOwoJCQlyZXR1\ncm4gY29tcGFyZTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

