{"sha":"40a97d9cc3950a91aba02e33c59dd2e224bf68cb","node_id":"MDQ6QmxvYjIwNjM2NDo0MGE5N2Q5Y2MzOTUwYTkxYWJhMDJlMzNjNTlkZDJlMjI0YmY2OGNi","size":51033,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/40a97d9cc3950a91aba02e33c59dd2e224bf68cb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGls\nLk1hcDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3Zl\ncnJpZGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Bc3NvY2lhdGlvbk92\nZXJyaWRlczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkF0dHJpYnV0ZU92\nZXJyaWRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3Zl\ncnJpZGVzOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQ29sdW1uUmVzdWx0\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRGlzY3JpbWluYXRvckNvbHVt\nbjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkRpc2NyaW1pbmF0b3JWYWx1\nZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudGl0eVJlc3VsdDsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVudW1UeXBlOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRW51bWVyYXRlZDsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLkZpZWxkUmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuSW5o\nZXJpdGFuY2U7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Kb2luQ29sdW1u\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuSm9pbkNvbHVtbnM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5Kb2luVGFibGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5QcmltYXJ5S2V5Sm9pbkNvbHVtbjsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlByaW1hcnlLZXlKb2luQ29sdW1uczsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLlNlY29uZGFyeVRhYmxlOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuU2Vjb25kYXJ5VGFibGVzOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuU3FsUmVzdWx0U2V0TWFwcGluZzsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlNxbFJlc3VsdFNldE1hcHBpbmdzOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuVGFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5U\nYWJsZUdlbmVyYXRvcjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlRlbXBv\ncmFsOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVW5pcXVlQ29uc3RyYWlu\ndDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGls\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0Nv\nbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5r\nZXJuZWwuRWFnZXJGZXRjaE1vZGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZ0luZm87CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuTWFwcGluZ0luZm87\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdS\nZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5RdWVyeVJlc3VsdE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLlNlcXVlbmNlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmdJbmZvOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRW51\nbVZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNzU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5WZXJ0aWNhbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5Bbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBh\ncnNlcjsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lz\ndGVuY2UuamRiYy5NYXBwaW5nVGFnLio7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoK\nLyoqCiAqIFBlcnNpc3RlbmNlIGFubm90YXRpb24gbWFwcGluZyBwYXJzZXIu\nCiAqCiAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgogKiBAYXV0aG9yIFN0ZXZl\nIEtpbQogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIEFu\nbm90YXRpb25QZXJzaXN0ZW5jZU1hcHBpbmdQYXJzZXIKICAgIGV4dGVuZHMg\nQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIgewoKICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFRSVUUgPSAxOwogICAgcHJvdGVj\ndGVkIHN0YXRpYyBmaW5hbCBpbnQgRkFMU0UgPSAyOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoQW5ub3RhdGlvblBlcnNpc3RlbmNlTWFwcGluZ1Bh\ncnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENs\nYXNzLCBNYXBwaW5nVGFnPiBfdGFncyA9CiAgICAgICAgbmV3IEhhc2hNYXA8\nQ2xhc3MsIE1hcHBpbmdUYWc+KCk7CgogICAgc3RhdGljIHsKICAgICAgICBf\ndGFncy5wdXQoQXNzb2NpYXRpb25PdmVycmlkZS5jbGFzcywgQVNTT0NfT1ZF\nUlJJREUpOwogICAgICAgIF90YWdzLnB1dChBc3NvY2lhdGlvbk92ZXJyaWRl\ncy5jbGFzcywgQVNTT0NfT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5wdXQo\nQXR0cmlidXRlT3ZlcnJpZGUuY2xhc3MsIEFUVFJfT1ZFUlJJREUpOwogICAg\nICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlkZXMuY2xhc3MsIEFUVFJf\nT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5wdXQoamF2YXgucGVyc2lzdGVu\nY2UuQ29sdW1uLmNsYXNzLCBDT0wpOwogICAgICAgIF90YWdzLnB1dChDb2x1\nbW5SZXN1bHQuY2xhc3MsIENPTFVNTl9SRVNVTFQpOwogICAgICAgIF90YWdz\nLnB1dChEaXNjcmltaW5hdG9yQ29sdW1uLmNsYXNzLCBESVNDUklNX0NPTCk7\nCiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0b3JWYWx1ZS5jbGFzcywg\nRElTQ1JJTV9WQUwpOwogICAgICAgIF90YWdzLnB1dChFbnRpdHlSZXN1bHQu\nY2xhc3MsIEVOVElUWV9SRVNVTFQpOwogICAgICAgIF90YWdzLnB1dChFbnVt\nZXJhdGVkLmNsYXNzLCBFTlVNRVJBVEVEKTsKICAgICAgICBfdGFncy5wdXQo\nRmllbGRSZXN1bHQuY2xhc3MsIEZJRUxEX1JFU1VMVCk7CiAgICAgICAgX3Rh\nZ3MucHV0KEluaGVyaXRhbmNlLmNsYXNzLCBJTkhFUklUQU5DRSk7CiAgICAg\nICAgX3RhZ3MucHV0KEpvaW5Db2x1bW4uY2xhc3MsIEpPSU5fQ09MKTsKICAg\nICAgICBfdGFncy5wdXQoSm9pbkNvbHVtbnMuY2xhc3MsIEpPSU5fQ09MUyk7\nCiAgICAgICAgX3RhZ3MucHV0KEpvaW5UYWJsZS5jbGFzcywgSk9JTl9UQUJM\nRSk7CiAgICAgICAgX3RhZ3MucHV0KFByaW1hcnlLZXlKb2luQ29sdW1uLmNs\nYXNzLCBQS19KT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFByaW1hcnlL\nZXlKb2luQ29sdW1ucy5jbGFzcywgUEtfSk9JTl9DT0xTKTsKICAgICAgICBf\ndGFncy5wdXQoU2Vjb25kYXJ5VGFibGUuY2xhc3MsIFNFQ09OREFSWV9UQUJM\nRSk7CiAgICAgICAgX3RhZ3MucHV0KFNlY29uZGFyeVRhYmxlcy5jbGFzcywg\nU0VDT05EQVJZX1RBQkxFUyk7CiAgICAgICAgX3RhZ3MucHV0KFNxbFJlc3Vs\ndFNldE1hcHBpbmcuY2xhc3MsIFNRTF9SRVNVTFRfU0VUX01BUFBJTkcpOwog\nICAgICAgIF90YWdzLnB1dChTcWxSZXN1bHRTZXRNYXBwaW5ncy5jbGFzcywg\nU1FMX1JFU1VMVF9TRVRfTUFQUElOR1MpOwogICAgICAgIF90YWdzLnB1dChU\nYWJsZS5jbGFzcywgVEFCTEUpOwogICAgICAgIF90YWdzLnB1dChUZW1wb3Jh\nbC5jbGFzcywgVEVNUE9SQUwpOwogICAgICAgIF90YWdzLnB1dChUYWJsZUdl\nbmVyYXRvci5jbGFzcywgVEFCTEVfR0VOKTsKICAgICAgICBfdGFncy5wdXQo\nQ2xhc3NDcml0ZXJpYS5jbGFzcywgQ0xBU1NfQ1JJVCk7CiAgICAgICAgX3Rh\nZ3MucHV0KENvbHVtbnMuY2xhc3MsIENPTFMpOwogICAgICAgIF90YWdzLnB1\ndChDb250YWluZXJUYWJsZS5jbGFzcywgQ09OVEFJTkVSX1RBQkxFKTsKICAg\nICAgICBfdGFncy5wdXQoRGF0YVN0b3JlSWRDb2x1bW4uY2xhc3MsIERBVEFT\nVE9SRV9JRF9DT0wpOwogICAgICAgIF90YWdzLnB1dChEaXNjcmltaW5hdG9y\nU3RyYXRlZ3kuY2xhc3MsIERJU0NSSU1fU1RSQVQpOwogICAgICAgIF90YWdz\nLnB1dChFYWdlckZldGNoTW9kZS5jbGFzcywgRUFHRVJfRkVUQ0hfTU9ERSk7\nCiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRDbGFzc0NyaXRlcmlhLmNsYXNz\nLCBFTEVNX0NMQVNTX0NSSVQpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50\nRm9yZWlnbktleS5jbGFzcywgRUxFTV9GSyk7CiAgICAgICAgX3RhZ3MucHV0\nKEVsZW1lbnRJbmRleC5jbGFzcywgRUxFTV9JTkRFWCk7CiAgICAgICAgX3Rh\nZ3MucHV0KEVsZW1lbnRKb2luQ29sdW1uLmNsYXNzLCBFTEVNX0pPSU5fQ09M\nKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEpvaW5Db2x1bW5zLmNsYXNz\nLCBFTEVNX0pPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRO\nb25wb2x5bW9ycGhpYy5jbGFzcywgRUxFTV9OT05QT0xZKTsKICAgICAgICBf\ndGFncy5wdXQoRW1iZWRkZWRNYXBwaW5nLmNsYXNzLCBFTUJFRERFRF9NQVBQ\nSU5HKTsKICAgICAgICBfdGFncy5wdXQoRm9yZWlnbktleS5jbGFzcywgRksp\nOwogICAgICAgIF90YWdzLnB1dChJbmRleC5jbGFzcywgSU5ERVgpOwogICAg\nICAgIF90YWdzLnB1dChNYXBwaW5nT3ZlcnJpZGUuY2xhc3MsIE1BUFBJTkdf\nT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChNYXBwaW5nT3ZlcnJpZGVz\nLmNsYXNzLCBNQVBQSU5HX09WRVJSSURFUyk7CiAgICAgICAgX3RhZ3MucHV0\nKE5vbnBvbHltb3JwaGljLmNsYXNzLCBOT05QT0xZKTsKICAgICAgICBfdGFn\ncy5wdXQoT3JkZXJDb2x1bW4uY2xhc3MsIE9SREVSX0NPTCk7CiAgICAgICAg\nX3RhZ3MucHV0KFN0cmF0ZWd5LmNsYXNzLCBTVFJBVCk7CiAgICAgICAgX3Rh\nZ3MucHV0KFN1YmNsYXNzRmV0Y2hNb2RlLmNsYXNzLCBTVUJDTEFTU19GRVRD\nSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoVW5pcXVlLmNsYXNzLCBVTklR\nVUUpOwogICAgICAgIF90YWdzLnB1dChWZXJzaW9uQ29sdW1uLmNsYXNzLCBW\nRVJTSU9OX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFZlcnNpb25Db2x1bW5z\nLmNsYXNzLCBWRVJTSU9OX0NPTFMpOwogICAgICAgIF90YWdzLnB1dChWZXJz\naW9uU3RyYXRlZ3kuY2xhc3MsIFZFUlNJT05fU1RSQVQpOwogICAgICAgIF90\nYWdzLnB1dChYSm9pbkNvbHVtbi5jbGFzcywgWF9KT0lOX0NPTCk7CiAgICAg\nICAgX3RhZ3MucHV0KFhKb2luQ29sdW1ucy5jbGFzcywgWF9KT0lOX0NPTFMp\nOwogICAgICAgIF90YWdzLnB1dChYU2Vjb25kYXJ5VGFibGUuY2xhc3MsIFhf\nU0VDT05EQVJZX1RBQkxFKTsKICAgICAgICBfdGFncy5wdXQoWFNlY29uZGFy\neVRhYmxlcy5jbGFzcywgWF9TRUNPTkRBUllfVEFCTEVTKTsKICAgICAgICBf\ndGFncy5wdXQoWFRhYmxlLmNsYXNzLCBYX1RBQkxFKTsKICAgIH0KCiAgICBw\ndWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWFwcGluZ1BhcnNlcihKREJD\nQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgc3VwZXIoY29uZik7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVBh\nY2thZ2VNYXBwaW5nQW5ub3RhdGlvbnMoUGFja2FnZSBwa2cpIHsKICAgICAg\nICBNYXBwaW5nVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRpb24gYW5u\nbyA6IHBrZy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAg\nICAgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAg\nICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\naGFuZGxlVW5rbm93blBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbihwa2csIGFu\nbm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAgICAgICBwYXJzZVRhYmxl\nR2VuZXJhdG9yKHBrZywgKFRhYmxlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIHBrZywKICAgICAgICAg\nICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJj\nbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duUGFja2FnZU1h\ncHBpbmdBbm5vdGF0aW9uKFBhY2thZ2UgcGtnLAogICAgICAgIEFubm90YXRp\nb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBUYWJsZUdlbmVyYXRvci4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlVGFibGVHZW5lcmF0b3IoQW5ub3RhdGVkRWxl\nbWVudCBlbCwgVGFibGVHZW5lcmF0b3IgZ2VuKSB7CiAgICAgICAgU3RyaW5n\nIG5hbWUgPSBnZW4ubmFtZSgpOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KG5hbWUpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWdlbi1uYW1lIiwgZWwpKTsKCiAgICAg\nICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJw\nYXJzZS1nZW4iLCBuYW1lKSk7CgogICAgICAgIFNlcXVlbmNlTWFwcGluZyBt\nZXRhID0gKFNlcXVlbmNlTWFwcGluZykgZ2V0UmVwb3NpdG9yeSgpLgogICAg\nICAgICAgICBnZXRDYWNoZWRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAg\nICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGxvZy5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldCgiZHVwLWdlbiIsIG5hbWUsIGVsKSk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIG1ldGEgPSAoU2VxdWVuY2VNYXBwaW5n\nKSBnZXRSZXBvc2l0b3J5KCkuYWRkU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsK\nICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2luKFNlcXVlbmNlTWFwcGlu\nZy5JTVBMX1ZBTFVFX1RBQkxFKTsKICAgICAgICBtZXRhLnNldFRhYmxlKHRv\nVGFibGVOYW1lKGdlbi5zY2hlbWEoKSwgZ2VuLnRhYmxlKCkpKTsKICAgICAg\nICBtZXRhLnNldFByaW1hcnlLZXlDb2x1bW4oZ2VuLnBrQ29sdW1uTmFtZSgp\nKTsKICAgICAgICBtZXRhLnNldFNlcXVlbmNlQ29sdW1uKGdlbi52YWx1ZUNv\nbHVtbk5hbWUoKSk7CiAgICAgICAgbWV0YS5zZXRQcmltYXJ5S2V5VmFsdWUo\nZ2VuLnBrQ29sdW1uVmFsdWUoKSk7CiAgICAgICAgbWV0YS5zZXRJbml0aWFs\nVmFsdWUoZ2VuLmluaXRpYWxWYWx1ZSgpKTsKICAgICAgICBtZXRhLnNldEFs\nbG9jYXRlKGdlbi5hbGxvY2F0aW9uU2l6ZSgpKTsKICAgICAgICBtZXRhLnNl\ndFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNz\nKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgbWV0YS5TUkNfQU5OT1RBVElP\nTlMpOwoKICAgICAgICAvLyMjIyBFSkIzCiAgICAgICAgaWYgKGdlbi51bmlx\ndWVDb25zdHJhaW50cygpLmxlbmd0aCA+IDAgJiYgbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVuaXF1ZS1j\nb25zdHJhaW50cyIsIG5hbWUpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHByb3RlY3RlZCB2b2lkIHBhcnNlQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMo\nQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGNt\nID0gKENsYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBDbGFzcyBjbHMgPSBj\nbS5nZXREZXNjcmliZWRUeXBlKCk7CgogICAgICAgIE1hcHBpbmdUYWcgdGFn\nOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogY2xzLmdldERlY2xh\ncmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5n\nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRh\nZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duQ2xh\nc3NNYXBwaW5nQW5ub3RhdGlvbihjbSwgYW5ubyk7CiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNo\nICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgQVNTT0NfT1ZFUlJJREU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRl\ncyhjbSwgKEFzc29jaWF0aW9uT3ZlcnJpZGUpIGFubm8pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBU1NPQ19P\nVkVSUklERVM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBc3NvY2lhdGlv\nbk92ZXJyaWRlcyhjbSwgKChBc3NvY2lhdGlvbk92ZXJyaWRlcykgYW5ubyku\nCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBVFRSX09W\nRVJSSURFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQXR0cmlidXRlT3Zl\ncnJpZGVzKGNtLCAoQXR0cmlidXRlT3ZlcnJpZGUpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBVFRS\nX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUF0dHJpYnV0\nZU92ZXJyaWRlcyhjbSwgKChBdHRyaWJ1dGVPdmVycmlkZXMpIGFubm8pLgog\nICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRElTQ1JJTV9D\nT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VEaXNjcmltaW5hdG9yQ29s\ndW1uKGNtLCAoRGlzY3JpbWluYXRvckNvbHVtbikgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERJU0NS\nSU1fVkFMOgogICAgICAgICAgICAgICAgICAgIGNtLmdldERpc2NyaW1pbmF0\nb3IoKS5nZXRNYXBwaW5nSW5mbygpLnNldFZhbHVlCiAgICAgICAgICAgICAg\nICAgICAgICAgICgoKERpc2NyaW1pbmF0b3JWYWx1ZSkgYW5ubykudmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIElOSEVSSVRBTkNFOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nSW5oZXJpdGFuY2UoY20sIChJbmhlcml0YW5jZSkgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBLX0pP\nSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUHJpbWFyeUtleUpv\naW5Db2x1bW5zKGNtLCAoUHJpbWFyeUtleUpvaW5Db2x1bW4pIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBQS19KT0lOX0NPTFM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQcmlt\nYXJ5S2V5Sm9pbkNvbHVtbnMoY20sCiAgICAgICAgICAgICAgICAgICAgICAg\nICgoUHJpbWFyeUtleUpvaW5Db2x1bW5zKSBhbm5vKS4KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRUNPTkRBUllfVEFCTEU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VTZWNvbmRhcnlUYWJsZXMoY20s\nIChTZWNvbmRhcnlUYWJsZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNFQ09OREFSWV9UQUJMRVM6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VTZWNvbmRhcnlUYWJsZXMoY20s\nICgoU2Vjb25kYXJ5VGFibGVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1FMX1JF\nU1VMVF9TRVRfTUFQUElORzoKICAgICAgICAgICAgICAgICAgICBwYXJzZVNR\nTFJlc3VsdFNldE1hcHBpbmdzKGNtLCAoU3FsUmVzdWx0U2V0TWFwcGluZykg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFNRTF9SRVNVTFRfU0VUX01BUFBJTkdTOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlU1FMUmVzdWx0U2V0TWFwcGluZ3MoY20sICgoU3Fs\nUmVzdWx0U2V0TWFwcGluZ3MpIGFubm8pLgogICAgICAgICAgICAgICAgICAg\nICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VUYWJsZShjbSwgKFRhYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEVfR0VOOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlVGFibGVHZW5lcmF0b3IoY2xzLCAo\nVGFibGVHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBEQVRBU1RPUkVfSURfQ09MOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlRGF0YVN0b3JlSWRDb2x1bW4oY20s\nIChEYXRhU3RvcmVJZENvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERJU0NSSU1fU1RSQVQ6\nCiAgICAgICAgICAgICAgICAgICAgY20uZ2V0RGlzY3JpbWluYXRvcigpLmdl\ndE1hcHBpbmdJbmZvKCkuc2V0U3RyYXRlZ3kKICAgICAgICAgICAgICAgICAg\nICAgICAgKCgoRGlzY3JpbWluYXRvclN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRks6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5\nKGNtLmdldE1hcHBpbmdJbmZvKCksIChGb3JlaWduS2V5KSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nTUFQUElOR19PVkVSUklERToKICAgICAgICAgICAgICAgICAgICBwYXJzZU1h\ncHBpbmdPdmVycmlkZXMoY20sIChNYXBwaW5nT3ZlcnJpZGUpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBNQVBQSU5HX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZU1hcHBpbmdPdmVycmlkZXMoY20sCiAgICAgICAgICAgICAgICAgICAgICAg\nICgoTWFwcGluZ092ZXJyaWRlcykgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNUUkFU\nOgogICAgICAgICAgICAgICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0\nU3RyYXRlZ3koKChTdHJhdGVneSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNVQkNM\nQVNTX0ZFVENIX01PREU6CiAgICAgICAgICAgICAgICAgICAgY20uc2V0U3Vi\nY2xhc3NGZXRjaE1vZGUodG9FYWdlckZldGNoTW9kZUNvbnN0YW50CiAgICAg\nICAgICAgICAgICAgICAgICAgICgoKFN1YmNsYXNzRmV0Y2hNb2RlKSBhbm5v\nKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFZFUlNJT05fQ09MOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlVmVyc2lvbkNvbHVtbnMoY20sIChWZXJzaW9uQ29sdW1uKSBh\nbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgVkVSU0lPTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlVmVyc2lvbkNvbHVtbnMoY20sICgoVmVyc2lvbkNvbHVtbnMpIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBWRVJTSU9OX1NUUkFUOgogICAgICAgICAgICAgICAg\nICAgIGNtLmdldFZlcnNpb24oKS5nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0\nZWd5CiAgICAgICAgICAgICAgICAgICAgICAgICgoKFZlcnNpb25TdHJhdGVn\neSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFhfVEFCTEU6CiAgICAgICAgICAgICAg\nICBjYXNlIFhfU0VDT05EQVJZX1RBQkxFOgogICAgICAgICAgICAgICAgY2Fz\nZSBYX1NFQ09OREFSWV9UQUJMRVM6CiAgICAgICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWs7IG5vdCBzdXBwb3J0ZWQgeWV0CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBjbSwKICAg\nICAgICAgICAgICAgICAgICAgICAgYW5ubykpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3Nl\ncyB0byBoYW5kbGUgdW5rbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5rbm93bkNsYXNzTWFwcGluZ0Fu\nbm90YXRpb24oQ2xhc3NNYXBwaW5nIGNscywKICAgICAgICBBbm5vdGF0aW9u\nIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBAQXNzb2NpYXRpb25PdmVycmlkZShzKS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQXNzb2NpYXRpb25PdmVycmlkZXMo\nQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIEFzc29jaWF0aW9uT3ZlcnJpZGUu\nLi4gYXNzb2NzKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIHN1cDsKICAgICAg\nICBKb2luQ29sdW1uW10gc2NvbHM7CiAgICAgICAgaW50IHVuaXF1ZTsKICAg\nICAgICBMaXN0PENvbHVtbj4gamNvbHM7CiAgICAgICAgZm9yIChBc3NvY2lh\ndGlvbk92ZXJyaWRlIGFzc29jIDogYXNzb2NzKSB7CiAgICAgICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KGFzc29jLm5hbWUoKSkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW92ZXJyaWRlLW5hbWUiLCBjbSkpOwogICAgICAgICAgICBzdXAgPSAo\nRmllbGRNYXBwaW5nKSBjbS5nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKGFz\nc29jLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChzdXAgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmFkZERlZmlu\nZWRTdXBlcmNsYXNzRmllbGQKICAgICAgICAgICAgICAgICAgICAoYXNzb2Mu\nbmFtZSgpLCBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyk7CiAgICAgICAg\nICAgIHNjb2xzID0gYXNzb2Muam9pbkNvbHVtbnMoKTsKICAgICAgICAgICAg\naWYgKHNjb2xzID09IG51bGwgfHwgc2NvbHMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGpjb2xzID0gbmV3\nIEFycmF5TGlzdDxDb2x1bW4+KHNjb2xzLmxlbmd0aCk7CiAgICAgICAgICAg\nIHVuaXF1ZSA9IDA7CiAgICAgICAgICAgIGZvciAoSm9pbkNvbHVtbiBzY29s\nIDogc2NvbHMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZSB8PSAoc2NvbC51\nbmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAgICAgICAgICAgICAgICBqY29s\ncy5hZGQobmV3Q29sdW1uKHNjb2wpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRDb2x1bW5zKHN1cCwgc3VwLmdldFZhbHVlSW5mbygpLCBqY29s\ncywgdW5pcXVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBAQXR0cmlidXRlT3ZlcnJpZGUocykuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZUF0dHJpYnV0ZU92ZXJyaWRlcyhDbGFzc01hcHBpbmcg\nY20sCiAgICAgICAgQXR0cmlidXRlT3ZlcnJpZGUuLi4gYXR0cnMpIHsKICAg\nICAgICBGaWVsZE1hcHBpbmcgc3VwOwogICAgICAgIGZvciAoQXR0cmlidXRl\nT3ZlcnJpZGUgYXR0ciA6IGF0dHJzKSB7CiAgICAgICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KGF0dHIubmFtZSgpKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tb3Zl\ncnJpZGUtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIHN1cCA9IChGaWVsZE1h\ncHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoYXR0ci5uYW1l\nKCkpOwogICAgICAgICAgICBpZiAoc3VwID09IG51bGwpCiAgICAgICAgICAg\nICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5hZGREZWZpbmVkU3VwZXJj\nbGFzc0ZpZWxkKGF0dHIubmFtZSgpLAogICAgICAgICAgICAgICAgICAgIE9i\namVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgaWYgKGF0\ndHIuY29sdW1uKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBhcnNlQ29s\ndW1ucyhzdXAsIGF0dHIuY29sdW1uKCkpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIGluaGVyaXRhbmNlIEBQcmltYXJ5S2V5Sm9p\nbkNvbHVtbihzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUHJp\nbWFyeUtleUpvaW5Db2x1bW5zKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBQ\ncmltYXJ5S2V5Sm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIExpc3Q8\nQ29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGpvaW5zLmxl\nbmd0aCk7CiAgICAgICAgZm9yIChQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2lu\nIDogam9pbnMpCiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbihqb2lu\nKSk7CiAgICAgICAgY20uZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5zKGNv\nbHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVt\nYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5v\ndGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3\nQ29sdW1uKFByaW1hcnlLZXlKb2luQ29sdW1uIGpvaW4pIHsKICAgICAgICBD\nb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGNvbC5zZXRGbGFn\nKENvbHVtbi5GTEFHX1BLX0pPSU4sIHRydWUpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkpCiAgICAgICAgICAgIGNv\nbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0\naWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAg\nICAgICBjb2wuc2V0TmFtZShqb2luLmNvbHVtbkRlZmluaXRpb24oKSk7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNl\nZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJnZXQoam9p\nbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAgICByZXR1cm4gY29s\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFNlY29uZGFyeVRhYmxl\nKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VTZWNvbmRhcnlU\nYWJsZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIFNlY29uZGFyeVRhYmxl\nLi4uIHRhYmxlcykgewogICAgICAgIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9\nIGNtLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgTG9nIGxvZyA9IGdldExv\nZygpOwoKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBMaXN0PENvbHVt\nbj4gam9pbnM7CiAgICAgICAgYm9vbGVhbiB3YXJuVW5pcXVlID0gZmFsc2U7\nCiAgICAgICAgZm9yIChTZWNvbmRhcnlUYWJsZSB0YWJsZSA6IHRhYmxlcykg\newogICAgICAgICAgICBuYW1lID0gdGFibGUubmFtZSgpOwogICAgICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgic2Vj\nb25kLW5hbWUiLCBjbSkpOwogICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkodGFibGUuc2NoZW1hKCkpKQogICAgICAgICAgICAgICAgbmFt\nZSA9IHRhYmxlLnNjaGVtYSgpICsgIi4iICsgbmFtZTsKICAgICAgICAgICAg\naWYgKHRhYmxlLnBrSm9pbkNvbHVtbnMoKS5sZW5ndGggPiAwKSB7CiAgICAg\nICAgICAgICAgICBqb2lucyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPih0YWJs\nZS5wa0pvaW5Db2x1bW5zKCkubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZv\nciAoUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbiA6IHRhYmxlLnBrSm9pbkNv\nbHVtbnMoKSkKICAgICAgICAgICAgICAgICAgICBqb2lucy5hZGQobmV3Q29s\ndW1uKGpvaW4pKTsKICAgICAgICAgICAgICAgIGluZm8uc2V0U2Vjb25kYXJ5\nVGFibGVKb2luQ29sdW1ucyhuYW1lLCBqb2lucyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgd2FyblVuaXF1ZSB8PSB0YWJsZS51bmlxdWVDb25zdHJh\naW50cygpLmxlbmd0aCA+IDA7CiAgICAgICAgfQoKICAgICAgICAvLyMjIyBF\nSkIzCiAgICAgICAgaWYgKHdhcm5VbmlxdWUgJiYgbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVuaXF1ZS1j\nb25zdHJhaW50cyIsIGNtKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\nY2xhc3MgdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVRh\nYmxlKENsYXNzTWFwcGluZyBjbSwgVGFibGUgdGFibGUpIHsKICAgICAgICBT\ndHJpbmcgdGFibGVOYW1lID0gdG9UYWJsZU5hbWUodGFibGUuc2NoZW1hKCks\nIHRhYmxlLm5hbWUoKSk7CiAgICAgICAgaWYgKHRhYmxlTmFtZSAhPSBudWxs\nKQogICAgICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFt\nZSh0YWJsZU5hbWUpOwoKICAgICAgICBmb3IgKFVuaXF1ZUNvbnN0cmFpbnQg\ndW5pcXVlQ29uc3RyYWludDp0YWJsZS51bmlxdWVDb25zdHJhaW50cygpKSB7\nCiAgICAgICAgICAgIFVuaXF1ZSB1bmlxdWUgPSBuZXdVbmlxdWUoY20sIG51\nbGwsIHVuaXF1ZUNvbnN0cmFpbnQuY29sdW1uTmFtZXMoKSk7CiAgICAgICAg\nICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuYWRkVW5pcXVlKHVuaXF1ZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRm9ybSBhIHF1YWxpZmll\nZCB0YWJsZSBuYW1lIGZyb20gYSBzY2hlbWEgYW5kIHRhYmxlIG5hbWUuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyB0b1RhYmxlTmFtZShT\ndHJpbmcgc2NoZW1hLCBTdHJpbmcgdGFibGUpIHsKICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuaXNFbXB0eSh0YWJsZSkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNjaGVtYSkp\nCiAgICAgICAgICAgIHJldHVybiB0YWJsZTsKICAgICAgICByZXR1cm4gc2No\nZW1hICsgIi4iICsgdGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZXMgdGhlIGdpdmVuIGFubm90YXRpb24gdG8gY3JlYXRlIGFuZCBjYWNoZSBh\nCiAgICAgKiB7QGxpbmsgU1FMUmVzdWx0U2V0TWFwcGluZ01ldGFEYXRhfS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlU1FMUmVzdWx0U2V0TWFw\ncGluZ3MoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIFNxbFJlc3VsdFNldE1h\ncHBpbmcuLi4gYW5ub3MpIHsKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSBy\nZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgZ2V0UmVwb3NpdG9yeSgpOwog\nICAgICAgIExvZyBsb2cgPSBnZXRMb2coKTsKICAgICAgICBmb3IgKFNxbFJl\nc3VsdFNldE1hcHBpbmcgYW5ubyA6IGFubm9zKSB7CiAgICAgICAgICAgIGlm\nIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShfbG9jLmdldCgicGFyc2Utc3FscnNtYXBwaW5nIiwgYW5uby5uYW1l\nKCkpKTsKCiAgICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXN1bHQg\nPSByZXBvcy5nZXRDYWNoZWRRdWVyeVJlc3VsdE1hcHBpbmcKICAgICAgICAg\nICAgICAgIChudWxsLCBhbm5vLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChy\nZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xv\nYy5nZXQoImR1cC1zcWxyc21hcHBpbmciLCBhbm5vLm5hbWUoKSwgY20pKTsK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICByZXN1bHQgPSByZXBvcy5hZGRRdWVyeVJlc3VsdE1hcHBpbmco\nbnVsbCwgYW5uby5uYW1lKCkpOwogICAgICAgICAgICByZXN1bHQuc2V0U291\ncmNlKGdldFNvdXJjZUZpbGUoKSwgY20uZ2V0RGVzY3JpYmVkVHlwZSgpLAog\nICAgICAgICAgICAgICAgcmVzdWx0LlNSQ19BTk5PVEFUSU9OUyk7CgogICAg\nICAgICAgICBmb3IgKEVudGl0eVJlc3VsdCBlbnRpdHkgOiBhbm5vLmVudGl0\naWVzKCkpIHsKICAgICAgICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZy5Q\nQ1Jlc3VsdCBlbnRpdHlSZXN1bHQgPSByZXN1bHQuYWRkUENSZXN1bHQKICAg\nICAgICAgICAgICAgICAgICAoZW50aXR5LmVudGl0eUNsYXNzKCkpOwogICAg\nICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGVudGl0eS5k\naXNjcmltaW5hdG9yQ29sdW1uKCkpKQogICAgICAgICAgICAgICAgICAgIGVu\ndGl0eVJlc3VsdC5hZGRNYXBwaW5nKGVudGl0eVJlc3VsdC5ESVNDUklNSU5B\nVE9SLAogICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkuZGlzY3JpbWlu\nYXRvckNvbHVtbigpKTsKCiAgICAgICAgICAgICAgICBmb3IgKEZpZWxkUmVz\ndWx0IGZpZWxkIDogZW50aXR5LmZpZWxkcygpKQogICAgICAgICAgICAgICAg\nICAgIGVudGl0eVJlc3VsdC5hZGRNYXBwaW5nKGZpZWxkLm5hbWUoKSwgZmll\nbGQuY29sdW1uKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAo\nQ29sdW1uUmVzdWx0IGNvbHVtbiA6IGFubm8uY29sdW1ucygpKQogICAgICAg\nICAgICAgICAgcmVzdWx0LmFkZENvbHVtblJlc3VsdChjb2x1bW4ubmFtZSgp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARGlz\nY3JpbWluYXRvckNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlRGlzY3JpbWluYXRvckNvbHVtbihDbGFzc01hcHBpbmcgY20sCiAgICAg\nICAgRGlzY3JpbWluYXRvckNvbHVtbiBkY29sKSB7CiAgICAgICAgQ29sdW1u\nIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoZGNvbC5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFt\nZShkY29sLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGRjb2wuY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29s\nLnNldFR5cGVOYW1lKGRjb2wuY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAg\nICBzd2l0Y2ggKGRjb2wuZGlzY3JpbWluYXRvclR5cGUoKSkgewogICAgICAg\nICAgICBjYXNlIENIQVI6CiAgICAgICAgICAgICAgICBjb2wuc2V0SmF2YVR5\ncGUoSmF2YVR5cGVzLkNIQVIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSU5URUdFUjoKICAgICAgICAgICAgICAgIGNvbC5z\nZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAgICAgICAgICAgIGlm\nIChkY29sLmxlbmd0aCgpICE9IDMxKQogICAgICAgICAgICAgICAgICAgIGNv\nbC5zZXRTaXplKGRjb2wubGVuZ3RoKCkpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBjb2wu\nc2V0SmF2YVR5cGUoSmF2YVR5cGVzLlNUUklORyk7CiAgICAgICAgICAgICAg\nICBjb2wuc2V0U2l6ZShkY29sLmxlbmd0aCgpKTsKICAgICAgICB9CiAgICAg\nICAgY20uZ2V0RGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJbmZvKCkuc2V0\nQ29sdW1ucwogICAgICAgICAgICAoQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1u\nW117IGNvbCB9KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBASW5o\nZXJpdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUluaGVy\naXRhbmNlKENsYXNzTWFwcGluZyBjbSwgSW5oZXJpdGFuY2UgaW5oZXJpdCkg\newogICAgICAgIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9IGNtLmdldE1hcHBp\nbmdJbmZvKCk7CiAgICAgICAgc3dpdGNoIChpbmhlcml0LnN0cmF0ZWd5KCkp\nIHsKICAgICAgICAgICAgY2FzZSBTSU5HTEVfVEFCTEU6CiAgICAgICAgICAg\nICAgICBpbmZvLnNldEhpZXJhcmNoeVN0cmF0ZWd5KEZsYXRDbGFzc1N0cmF0\nZWd5LkFMSUFTKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEpPSU5FRDoKICAgICAgICAgICAgICAgIGluZm8uc2V0SGllcmFy\nY2h5U3RyYXRlZ3koVmVydGljYWxDbGFzc1N0cmF0ZWd5LkFMSUFTKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFRBQkxFX1BF\nUl9DTEFTUzoKICAgICAgICAgICAgICAgIGluZm8uc2V0SGllcmFyY2h5U3Ry\nYXRlZ3koRnVsbENsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBjbGFzcy1sZXZlbCBATWFwcGlu\nZ092ZXJyaWRlKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VN\nYXBwaW5nT3ZlcnJpZGVzKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBNYXBw\naW5nT3ZlcnJpZGUuLi4gb3ZlcnMpIHsKICAgICAgICBGaWVsZE1hcHBpbmcg\nc3VwOwogICAgICAgIGZvciAoTWFwcGluZ092ZXJyaWRlIG92ZXIgOiBvdmVy\ncykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvdmVy\nLm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLW92ZXJyaWRlLW5hbWUiLCBjbSkpOwog\nICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5nZXREZWZpbmVk\nU3VwZXJjbGFzc0ZpZWxkKG92ZXIubmFtZSgpKTsKICAgICAgICAgICAgaWYg\nKHN1cCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFw\ncGluZykgY20uYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChvdmVyLm5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIE9iamVjdC5j\nbGFzcyk7CiAgICAgICAgICAgIHBvcHVsYXRlKHN1cCwgb3Zlcik7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUG9wdWxhdGUgdGhlIGdpdmVu\nIGZpZWxkIGZyb20gb3ZlcnJpZGUgZGF0YS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBvcHVsYXRlKEZpZWxkTWFwcGluZyBmbSwgTWFwcGluZ092ZXJy\naWRlIG92ZXIpIHsKICAgICAgICBpZiAob3Zlci5jb250YWluZXJUYWJsZSgp\nLnNwZWNpZmllZCgpKQogICAgICAgICAgICBwYXJzZUNvbnRhaW5lclRhYmxl\nKGZtLCBvdmVyLmNvbnRhaW5lclRhYmxlKCkpOwogICAgICAgIHBhcnNlQ29s\ndW1ucyhmbSwgb3Zlci5jb2x1bW5zKCkpOwogICAgICAgIHBhcnNlWEpvaW5D\nb2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwgb3Zlci5qb2lu\nQ29sdW1ucygpKTsKICAgICAgICBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhm\nbSwgb3Zlci5lbGVtZW50Sm9pbkNvbHVtbnMoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBkYXRhc3RvcmUgaWRlbnRpdHkgaW5mb3JtYXRpb24g\naW4gQERhdGFTdG9yZUlkQ29sdW1uLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VEYXRhU3RvcmVJZENvbHVtbihDbGFzc01hcHBpbmcgY20sIERh\ndGFTdG9yZUlkQ29sdW1uIGlkKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5l\ndyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\naWQubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoaWQubmFtZSgp\nKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaWQuY29sdW1u\nRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKGlk\nLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGlkLnByZWNpc2lv\nbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGlkLnByZWNpc2lv\nbigpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VS\nVEFCTEUsICFpZC5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFn\nKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhaWQudXBkYXRhYmxlKCkpOwog\nICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhBcnJheXMu\nYXNMaXN0KG5ldyBDb2x1bW5bXXsgY29sIH0pKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIHRoZSBnaXZlbiBmb3JlaWduIGtleS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlRm9yZWlnbktleShNYXBwaW5nSW5mbyBp\nbmZvLCBGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgcGFyc2VGb3JlaWduS2V5\nKGluZm8sIGZrLm5hbWUoKSwgZmsuZW5hYmxlZCgpLCBmay5kZWZlcnJlZCgp\nLAogICAgICAgICAgICBmay5kZWxldGVBY3Rpb24oKSwgZmsudXBkYXRlQWN0\naW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGZvcmVpZ24ga2V5\nIGRhdGEgb24gdGhlIGdpdmVuIG1hcHBpbmcgaW5mby4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgcGFyc2VGb3JlaWduS2V5KE1hcHBpbmdJbmZvIGlu\nZm8sIFN0cmluZyBuYW1lLAogICAgICAgIGJvb2xlYW4gZW5hYmxlZCwgYm9v\nbGVhbiBkZWZlcnJlZCwgRm9yZWlnbktleUFjdGlvbiBkZWxldGVBY3Rpb24s\nCiAgICAgICAgRm9yZWlnbktleUFjdGlvbiB1cGRhdGVBY3Rpb24pIHsKICAg\nICAgICBpZiAoIWVuYWJsZWQpIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5G\nb3JlaWduS2V5KGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZv\ncmVpZ25LZXkgZmsgPQogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZrLnNldE5h\nbWUobmFtZSk7CiAgICAgICAgZmsuc2V0RGVmZXJyZWQoZGVmZXJyZWQpOwog\nICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbih0b0ZvcmVpZ25LZXlBY3Rpb24o\nZGVsZXRlQWN0aW9uKSk7CiAgICAgICAgZmsuc2V0VXBkYXRlQWN0aW9uKHRv\nRm9yZWlnbktleUFjdGlvbihkZWxldGVBY3Rpb24pKTsKICAgICAgICBpbmZv\nLnNldEZvcmVpZ25LZXkoZmspOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCBvdXIgRksgYWN0aW9uIGVudW0gdG8gYW4gaW50ZXJuYWwgT3BlbkpQ\nQSBhY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHRvRm9yZWlnbktl\neUFjdGlvbihGb3JlaWduS2V5QWN0aW9uIGFjdGlvbikgewogICAgICAgIHN3\naXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgIGNhc2UgUkVTVFJJQ1Q6CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUOwogICAgICAgICAg\nICBjYXNlIENBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuQUNUSU9OX0NB\nU0NBREU7CiAgICAgICAgICAgIGNhc2UgTlVMTDoKICAgICAgICAgICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWln\nbktleS5BQ1RJT05fTlVMTDsKICAgICAgICAgICAgY2FzZSBERUZBVUxUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Gb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgdGhlIGdpdmVuIGluZGV4LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VJbmRleChNYXBwaW5nSW5mbyBpbmZvLCBJbmRleCBpZHgpIHsK\nICAgICAgICBwYXJzZUluZGV4KGluZm8sIGlkeC5uYW1lKCksIGlkeC5lbmFi\nbGVkKCksIGlkeC51bmlxdWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgaW5kZXggZGF0YSBvbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZvLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUluZGV4KE1hcHBpbmdJbmZv\nIGluZm8sIFN0cmluZyBuYW1lLAogICAgICAgIGJvb2xlYW4gZW5hYmxlZCwg\nYm9vbGVhbiB1bmlxdWUpIHsKICAgICAgICBpZiAoIWVuYWJsZWQpIHsKICAg\nICAgICAgICAgaW5mby5zZXRDYW5JbmRleChmYWxzZSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5JbmRleCBpZHggPQogICAgICAgICAgICBuZXcgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkluZGV4KCk7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBp\nZHguc2V0TmFtZShuYW1lKTsKICAgICAgICBpZHguc2V0VW5pcXVlKHVuaXF1\nZSk7CiAgICAgICAgaW5mby5zZXRJbmRleChpZHgpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHVuaXF1ZSBkYXRhIG9uIHRoZSBnaXZlbiBtYXBwaW5n\nIGluZm8uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVVuaXF1ZShG\naWVsZE1hcHBpbmcgZm0sIAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5w\nZXJzaXN0ZW5jZS5qZGJjLlVuaXF1ZSBhbm5vKSB7CiAgICAgICAgVmFsdWVN\nYXBwaW5nSW5mbyBpbmZvID0gZm0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAg\naWYgKCFhbm5vLmVuYWJsZWQoKSkgewogICAgICAgICAgICBpbmZvLnNldENh\nblVuaXF1ZShmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Vbmlx\ndWUgdW5xID0gCiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuVW5pcXVlKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGFubm8ubmFtZSgpKSkKICAgICAgICAgICAgdW5xLnNldE5h\nbWUoYW5uby5uYW1lKCkpOwogICAgICAgIHVucS5zZXREZWZlcnJlZChhbm5v\nLmRlZmVycmVkKCkpOwogICAgICAgIGluZm8uc2V0VW5pcXVlKHVucSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAVmVyc2lvbkNvbHVtbihzKS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVmVyc2lvbkNvbHVtbnMo\nQ2xhc3NNYXBwaW5nIGNtLCBWZXJzaW9uQ29sdW1uLi4uIHZjb2xzKSB7CiAg\nICAgICAgaWYgKHZjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlz\ndDxDb2x1bW4+KHZjb2xzLmxlbmd0aCk7CiAgICAgICAgZm9yIChWZXJzaW9u\nQ29sdW1uIHZjb2wgOiB2Y29scykKICAgICAgICAgICAgY29scy5hZGQobmV3\nQ29sdW1uKHZjb2wpKTsKICAgICAgICBjbS5nZXRWZXJzaW9uKCkuZ2V0TWFw\ncGluZ0luZm8oKS5zZXRDb2x1bW5zKGNvbHMpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1h\ndGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKFZlcnNpb25Db2x1bW4g\nYW5ubykgewogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFtZSgpKSkK\nICAgICAgICAgICAgY29sLnNldE5hbWUoYW5uby5uYW1lKCkpOwogICAgICAg\nIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRlZmluaXRp\nb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShhbm5vLmNvbHVt\nbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGFubm8ucHJlY2lzaW9uKCkg\nIT0gMCkKICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5wcmVjaXNpb24o\nKSk7CiAgICAgICAgZWxzZSBpZiAoYW5uby5sZW5ndGgoKSAhPSAyNTUpCiAg\nICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ubGVuZ3RoKCkpOwogICAgICAg\nIGNvbC5zZXROb3ROdWxsKCFhbm5vLm51bGxhYmxlKCkpOwogICAgICAgIGNv\nbC5zZXREZWNpbWFsRGlnaXRzKGFubm8uc2NhbGUoKSk7CiAgICAgICAgY29s\nLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhYW5uby5pbnNl\ncnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VO\nVVBEQVRBQkxFLCAhYW5uby51cGRhdGFibGUoKSk7CiAgICAgICAgcmV0dXJu\nIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zbGF0ZSB0aGUgZmV0\nY2ggbW9kZSBlbnVtIHZhbHVlIHRvIHRoZSBpbnRlcm5hbCBPcGVuSlBBIGNv\nbnN0YW50LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBpbnQgdG9FYWdl\nckZldGNoTW9kZUNvbnN0YW50KEVhZ2VyRmV0Y2hUeXBlIHR5cGUpIHsKICAg\nICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBOT05FOgog\nICAgICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9O\nT05FOwogICAgICAgICAgICBjYXNlIEpPSU46CiAgICAgICAgICAgICAgICBy\nZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU47CiAgICAgICAgICAg\nIGNhc2UgUEFSQUxMRUw6CiAgICAgICAgICAgICAgICByZXR1cm4gRWFnZXJG\nZXRjaE1vZGVzLkVBR0VSX1BBUkFMTEVMOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVj\ndGVkIHZvaWQgcGFyc2VMb2JNYXBwaW5nKEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBp\nZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RS\nSU5HCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBj\naGFyW10uY2xhc3MKICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlw\nZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICBjb2wuc2V0\nVHlwZShUeXBlcy5DTE9CKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNv\nbC5zZXRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgICgoRmllbGRNYXBwaW5n\nKSBmbWQpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoQXJyYXlzLmFzTGlz\ndAogICAgICAgICAgICAobmV3IENvbHVtbltdeyBjb2wgfSkpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VNZW1iZXJN\nYXBwaW5nQW5ub3RhdGlvbnMoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICBGaWVsZE1hcHBpbmcgZm0gPSAoRmllbGRNYXBwaW5nKSBmbWQ7CiAgICAg\nICAgQW5ub3RhdGVkRWxlbWVudCBlbCA9IChBbm5vdGF0ZWRFbGVtZW50KSBn\nZXRSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9y\neSgpLmdldERlZmF1bHRzKCkuZ2V0QmFja2luZ01lbWJlcihmbWQpOwoKICAg\nICAgICBNYXBwaW5nVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRpb24g\nYW5ubyA6IGVsLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAg\nICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsK\nICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBoYW5kbGVVbmtub3duTWVtYmVyTWFwcGluZ0Fubm90YXRpb24oZm0sIGFu\nbm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIEFTU09DX09WRVJSSURFOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nQXNzb2NpYXRpb25PdmVycmlkZXMoZm0sIChBc3NvY2lhdGlvbk92ZXJyaWRl\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgQVNTT0NfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlQXNzb2NpYXRpb25PdmVycmlkZXMoZm0sICgoQXNzb2NpYXRp\nb25PdmVycmlkZXMpIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAgICB2\nYWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgQVRUUl9PVkVSUklERToKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUF0dHJpYnV0ZU92ZXJyaWRlcyhmbSwgKEF0dHJpYnV0ZU92ZXJy\naWRlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgQVRUUl9PVkVSUklERVM6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoZm0sICgoQXR0cmlidXRl\nT3ZlcnJpZGVzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIENPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZUNvbHVt\nbnMoZm0sIChqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4pIGFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBD\nT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQ29sdW1ucyhmbSwgKChD\nb2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU5VTUVSQVRFRDoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZUVudW1lcmF0ZWQoZm0sIChFbnVtZXJhdGVk\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VKb2luQ29sdW1ucyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCksIHRydWUsCiAg\nICAgICAgICAgICAgICAgICAgICAgIChKb2luQ29sdW1uKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlSm9pbkNvbHVt\nbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAgICAg\nICAgICAgICAgICAoKEpvaW5Db2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSk9JTl9UQUJMRToKICAgICAgICAgICAgICAgICAgICBwYXJzZUpvaW5UYWJs\nZShmbSwgKEpvaW5UYWJsZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBLX0pPSU5fQ09MOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5zKGZt\nLCAoUHJpbWFyeUtleUpvaW5Db2x1bW4pIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQS19KT0lOX0NP\nTFM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQcmltYXJ5S2V5Sm9pbkNv\nbHVtbnMoZm0sCiAgICAgICAgICAgICAgICAgICAgICAgICgoUHJpbWFyeUtl\neUpvaW5Db2x1bW5zKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBUQUJMRV9HRU46CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VUYWJsZUdlbmVyYXRvcihlbCwgKFRhYmxlR2VuZXJhdG9yKSBh\nbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgVEVNUE9SQUw6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VU\nZW1wb3JhbChmbSwgKFRlbXBvcmFsKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ0xBU1NfQ1JJVDoK\nICAgICAgICAgICAgICAgICAgICBmbS5nZXRWYWx1ZUluZm8oKS5zZXRVc2VD\nbGFzc0NyaXRlcmlhCiAgICAgICAgICAgICAgICAgICAgICAgICgoKENsYXNz\nQ3JpdGVyaWEpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDT05UQUlORVJfVEFCTEU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VDb250YWluZXJUYWJsZShmbSwg\nKENvbnRhaW5lclRhYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUFHRVJfRkVUQ0hfTU9ERToK\nICAgICAgICAgICAgICAgICAgICBmbS5zZXRFYWdlckZldGNoTW9kZSh0b0Vh\nZ2VyRmV0Y2hNb2RlQ29uc3RhbnQKICAgICAgICAgICAgICAgICAgICAgICAg\nKCgoRWFnZXJGZXRjaE1vZGUpIGFubm8pLnZhbHVlKCkpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9D\nTEFTU19DUklUOgogICAgICAgICAgICAgICAgICAgIGZtLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0ZXJpYQog\nICAgICAgICAgICAgICAgICAgICAgICAoKChFbGVtZW50Q2xhc3NDcml0ZXJp\nYSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fRks6CiAgICAgICAgICAgICAg\nICAgICAgRWxlbWVudEZvcmVpZ25LZXkgZWZrID0gKEVsZW1lbnRGb3JlaWdu\nS2V5KSBhbm5vOwogICAgICAgICAgICAgICAgICAgIHBhcnNlRm9yZWlnbktl\neShmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLAogICAg\nICAgICAgICAgICAgICAgICAgICBlZmsubmFtZSgpLCBlZmsuZW5hYmxlZCgp\nLCBlZmsuZGVmZXJyZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZWZr\nLmRlbGV0ZUFjdGlvbigpLCBlZmsudXBkYXRlQWN0aW9uKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVN\nX0lOREVYOgogICAgICAgICAgICAgICAgICAgIEVsZW1lbnRJbmRleCBlaWR4\nID0gKEVsZW1lbnRJbmRleCkgYW5ubzsKICAgICAgICAgICAgICAgICAgICBw\nYXJzZUluZGV4KGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZv\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGVpZHgubmFtZSgpLCBlaWR4\nLmVuYWJsZWQoKSwgZWlkeC51bmlxdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fSk9JTl9DT0w6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbGVtZW50Sm9pbkNvbHVtbnMo\nZm0sIChFbGVtZW50Sm9pbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fSk9JTl9D\nT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRWxlbWVudEpvaW5Db2x1\nbW5zKGZtLCAoKEVsZW1lbnRKb2luQ29sdW1ucykgYW5ubykuCiAgICAgICAg\nICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX05PTlBPTFk6CiAg\nICAgICAgICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5zZXRQ\nb2x5bW9ycGhpYyh0b1BvbHltb3JwaGljQ29uc3RhbnQKICAgICAgICAgICAg\nICAgICAgICAgICAgKCgoRWxlbWVudE5vbnBvbHltb3JwaGljKSBhbm5vKS52\nYWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEVNQkVEREVEX01BUFBJTkc6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VFbWJlZGRlZE1hcHBpbmcoZm0sIChFbWJlZGRlZE1hcHBp\nbmcpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBGSzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUZv\ncmVpZ25LZXkoZm0uZ2V0VmFsdWVJbmZvKCksIChGb3JlaWduS2V5KSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSU5ERVg6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbmRleChm\nbS5nZXRWYWx1ZUluZm8oKSwgKEluZGV4KSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTk9OUE9MWToK\nICAgICAgICAgICAgICAgICAgICBmbS5zZXRQb2x5bW9ycGhpYyh0b1BvbHlt\nb3JwaGljQ29uc3RhbnQKICAgICAgICAgICAgICAgICAgICAgICAgKCgoTm9u\ncG9seW1vcnBoaWMpIGFubm8pLnZhbHVlKCkpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT1JERVJfQ09MOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlT3JkZXJDb2x1bW4oZm0sIChPcmRl\nckNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFNUUkFUOgogICAgICAgICAgICAgICAgICAg\nIGZtLmdldFZhbHVlSW5mbygpLnNldFN0cmF0ZWd5KCgoU3RyYXRlZ3kpIGFu\nbm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBVTklRVUU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VVbmlxdWUoZm0sIAogICAgICAgICAgICAgICAgICAgICAgICAob3Jn\nLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmpkYmMuVW5pcXVlKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgWF9KT0lOX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVhK\nb2luQ29sdW1ucyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCksIHRydWUsCiAgICAg\nICAgICAgICAgICAgICAgICAgIChYSm9pbkNvbHVtbikgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFhf\nSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlWEpvaW5Db2x1\nbW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwKICAgICAgICAgICAg\nICAgICAgICAgICAgKChYSm9pbkNvbHVtbnMpIGFubm8pLnZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVkIiwgZm0sCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cg\nc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBhbm5vdGF0aW9ucy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5rbm93bk1lbWJl\nck1hcHBpbmdBbm5vdGF0aW9uKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBB\nbm5vdGF0aW9uIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBWYWx1ZU1hcHBp\nbmd9IDxjb2RlPlBPTFlfKjwvY29kZT4gY29uc3RhbnQgZm9yCiAgICAgKiB0\naGUgZ2l2ZW4gZW51bSB2YWx1ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBpbnQgdG9Qb2x5bW9ycGhpY0NvbnN0YW50KE5vbnBvbHltb3JwaGlj\nVHlwZSB2YWwpIHsKICAgICAgICBzd2l0Y2ggKHZhbCkgewogICAgICAgICAg\nICBjYXNlIEVYQUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIFZhbHVlTWFw\ncGluZy5QT0xZX0ZBTFNFOwogICAgICAgICAgICBjYXNlIEpPSU5BQkxFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIFZhbHVlTWFwcGluZy5QT0xZX0pPSU5B\nQkxFOwogICAgICAgICAgICBjYXNlIEZBTFNFOgogICAgICAgICAgICAgICAg\ncmV0dXJuIFZhbHVlTWFwcGluZy5QT0xZX1RSVUU7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBnaXZlbiBAQXNzb2NpYXRpb25PdmVycmlkZSBhbm5vdGF0aW9ucyBvbiBh\nbiBlbWJlZGRlZCBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRlcyhGaWVsZE1hcHBpbmcgZm0sCiAg\nICAgICAgQXNzb2NpYXRpb25PdmVycmlkZS4uLiBhc3NvY3MpIHsKICAgICAg\nICBDbGFzc01hcHBpbmcgZW1iZWQgPSBmbS5nZXRFbWJlZGRlZE1hcHBpbmco\nKTsKICAgICAgICBpZiAoZW1iZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1iZWRk\nZWQiLCBmbSkpOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAg\nIEpvaW5Db2x1bW5bXSBlY29sczsKICAgICAgICBpbnQgdW5pcXVlOwogICAg\nICAgIExpc3Q8Q29sdW1uPiBqY29sczsKICAgICAgICBmb3IgKEFzc29jaWF0\naW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3NvY3MpIHsKICAgICAgICAgICAgZWZt\nID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5nKGFzc29jLm5hbWUoKSk7CiAgICAg\nICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1iZWQtb3ZlcnJp\nZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZm0sIGFzc29jLm5hbWUo\nKSkpOwogICAgICAgICAgICBlY29scyA9IGFzc29jLmpvaW5Db2x1bW5zKCk7\nCiAgICAgICAgICAgIGlmIChlY29scyA9PSBudWxsIHx8IGVjb2xzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICB1bmlxdWUgPSAwOwogICAgICAgICAgICBqY29scyA9IG5ldyBBcnJheUxp\nc3Q8Q29sdW1uPihlY29scy5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKEpv\naW5Db2x1bW4gZWNvbCA6IGVjb2xzKSB7CiAgICAgICAgICAgICAgICB1bmlx\ndWUgfD0gKGVjb2wudW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAg\nICAgICAgICAgamNvbHMuYWRkKG5ld0NvbHVtbihlY29sKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgc2V0Q29sdW1ucyhlZm0sIGVmbS5nZXRWYWx1\nZUluZm8oKSwgamNvbHMsIHVuaXF1ZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgZ2l2ZW4gQEF0dHJpYnV0ZU92ZXJyaWRlIGFu\nbm90YXRpb25zIG9uIGFuIGVtYmVkZGVkIG1hcHBpbmcuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZUF0dHJpYnV0ZU92ZXJyaWRlcyhGaWVsZE1h\ncHBpbmcgZm0sCiAgICAgICAgQXR0cmlidXRlT3ZlcnJpZGUuLi4gYXR0cnMp\nIHsKICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQgPSBmbS5nZXRFbWJlZGRl\nZE1hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb3QtZW1iZWRkZWQiLCBmbSkpOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWZt\nOwogICAgICAgIGZvciAoQXR0cmlidXRlT3ZlcnJpZGUgYXR0ciA6IGF0dHJz\nKSB7CiAgICAgICAgICAgIGVmbSA9IGVtYmVkLmdldEZpZWxkTWFwcGluZyhh\ndHRyLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAg\nICAgZm0sIGF0dHIubmFtZSgpKSk7CiAgICAgICAgICAgIGlmIChhdHRyLmNv\nbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBwYXJzZUNvbHVtbnMo\nZWZtLCBhdHRyLmNvbHVtbigpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBARW51bWVyYXRlZC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBhcnNlRW51bWVyYXRlZChGaWVsZE1hcHBpbmcgZm0sIEVudW1l\ncmF0ZWQgYW5ubykgewogICAgICAgIFN0cmluZyBzdHJhdCA9IEVudW1WYWx1\nZUhhbmRsZXIuY2xhc3MuZ2V0TmFtZSgpICsgIihTdG9yZU9yZGluYWw9Igog\nICAgICAgICAgICArIFN0cmluZy52YWx1ZU9mKGFubm8udmFsdWUoKSA9PSBF\nbnVtVHlwZS5PUkRJTkFMKSArICIpIjsKICAgICAgICBmbS5nZXRWYWx1ZUlu\nZm8oKS5zZXRTdHJhdGVneShzdHJhdCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBAVGVtcG9yYWwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZVRlbXBvcmFsKEZpZWxkTWFwcGluZyBmbSwgVGVtcG9yYWwgYW5ubykg\newogICAgICAgIExpc3QgY29scyA9IGZtLmdldFZhbHVlSW5mbygpLmdldENv\nbHVtbnMoKTsKICAgICAgICBpZiAoIWNvbHMuaXNFbXB0eSgpICYmIGNvbHMu\nc2l6ZSgpICE9IDEpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibnVtLWNvbHMtbWlzbWF0Y2giLCBmbSwKICAg\nICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKGNvbHMuc2l6ZSgpKSwgIjEi\nKSk7CiAgICAgICAgaWYgKGNvbHMuaXNFbXB0eSgpKQogICAgICAgICAgICBj\nb2xzID0gQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1uW117IG5ldyBDb2x1bW4o\nKSB9KTsKCiAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIGNvbHMuZ2V0\nKDApOwogICAgICAgIHN3aXRjaCAoYW5uby52YWx1ZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgREFURToKICAgICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5\ncGVzLkRBVEUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgVElNRToKICAgICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVz\nLlRJTUUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgVElNRVNUQU1QOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlw\nZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBDb2x1bW4ocykuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlQ29sdW1ucyhGaWVsZE1h\ncHBpbmcgZm0sCiAgICAgICAgamF2YXgucGVyc2lzdGVuY2UuQ29sdW1uLi4u\nIHBjb2xzKSB7CiAgICAgICAgaWYgKHBjb2xzLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1pZ2h0IGFscmVhZHkgaGF2\nZSBzb21lIGNvbHVtbiBpbmZvcm1hdGlvbiBmcm9tIG1hcHBpbmcgYW5ub3Rh\ndGlvbgogICAgICAgIExpc3QgY29scyA9IGZtLmdldFZhbHVlSW5mbygpLmdl\ndENvbHVtbnMoKTsKICAgICAgICBpZiAoIWNvbHMuaXNFbXB0eSgpICYmIGNv\nbHMuc2l6ZSgpICE9IHBjb2xzLmxlbmd0aCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29scy1taXNt\nYXRjaCIsIGZtLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY29s\ncy5zaXplKCkpLCBTdHJpbmcudmFsdWVPZihwY29scy5sZW5ndGgpKSk7Cgog\nICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAgIFN0cmluZyBzZWNvbmRh\ncnkgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbHMuc2l6ZSgpID4g\naSkKICAgICAgICAgICAgICAgIHNldHVwQ29sdW1uKChDb2x1bW4pIGNvbHMu\nZ2V0KGkpLCBwY29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgaWYgKGNvbHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\nICAgIGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4ocGNvbHMubGVuZ3Ro\nKTsKICAgICAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbihwY29sc1tp\nXSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1bmlxdWUgfD0gKHBj\nb2xzW2ldLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAg\nc2Vjb25kYXJ5ID0gdHJhY2tTZWNvbmRhcnlUYWJsZShmbSwgc2Vjb25kYXJ5\nLAogICAgICAgICAgICAgICAgcGNvbHNbaV0udGFibGUoKSwgaSk7CiAgICAg\nICAgfQoKICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8o\nKSwgY29scywgdW5pcXVlKTsKICAgICAgICBpZiAoc2Vjb25kYXJ5ICE9IG51\nbGwpCiAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVO\nYW1lKHNlY29uZGFyeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhl\nIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIENvbHVtbiBuZXdDb2x1bW4oamF2YXgucGVyc2lzdGVuY2UuQ29sdW1uIGFu\nbm8pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAg\nICAgIHNldHVwQ29sdW1uKGNvbCwgYW5ubyk7CiAgICAgICAgcmV0dXJuIGNv\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHVwIHRoZSBnaXZlbiBjb2x1\nbW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldHVwQ29sdW1u\nKENvbHVtbiBjb2wsIGphdmF4LnBlcnNpc3RlbmNlLkNvbHVtbiBhbm5vKSB7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFtZSgp\nKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoYW5uby5uYW1lKCkpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRlZmlu\naXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShhbm5vLmNv\nbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGFubm8ucHJlY2lzaW9u\nKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5wcmVjaXNp\nb24oKSk7CiAgICAgICAgZWxzZSBpZiAoYW5uby5sZW5ndGgoKSAhPSAyNTUp\nCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ubGVuZ3RoKCkpOwogICAg\nICAgIGNvbC5zZXROb3ROdWxsKCFhbm5vLm51bGxhYmxlKCkpOwogICAgICAg\nIGNvbC5zZXREZWNpbWFsRGlnaXRzKGFubm8uc2NhbGUoKSk7CiAgICAgICAg\nY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhYW5uby5p\nbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFH\nX1VOVVBEQVRBQkxFLCAhYW5uby51cGRhdGFibGUoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIGNvbHVtbnMgYXMgdGhlIGNvbHVt\nbnMgZm9yIDxjb2RlPmZtPC9jb2RlPi4KICAgICAqCiAgICAgKiBAcGFyYW0g\ndW5pcXVlIGJpdHdpc2UgY29tYmluYXRpb24gb2YgVFJVRSBhbmQgRkFMU0Ug\nZm9yIHRoZQogICAgICogdW5pcXVlIGF0dHJpYnV0ZSBvZiBlYWNoIGNvbHVt\nbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRDb2x1bW5zKEZpZWxk\nTWFwcGluZyBmbSwgTWFwcGluZ0luZm8gaW5mbywKICAgICAgICBMaXN0PENv\nbHVtbj4gY29scywgaW50IHVuaXF1ZSkgewogICAgICAgIGluZm8uc2V0Q29s\ndW1ucyhjb2xzKTsKICAgICAgICBpZiAodW5pcXVlID09IFRSVUUpCiAgICAg\nICAgICAgIGluZm8uc2V0VW5pcXVlKG5ldyBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuVW5pcXVlKCkpOwoKICAgICAgICAvLyMjIyBFSkIzCiAg\nICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNX\nYXJuRW5hYmxlZCgpICYmIHVuaXF1ZSA9PSAoVFJVRSB8IEZBTFNFKSkKICAg\nICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImluY29uc2lzdC1jb2wtYXR0\ncnMiLCBmbSkpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIHRvIHRy\nYWNrIHRoZSBzZWNvbmRhcnkgdGFibGUgZm9yIGEgc2V0IG9mIGNvbHVtbnMu\nCiAgICAgKgogICAgICogQHBhcmFtIHNlY29uZGFyeSBzZWNvbmRhcnkgdGFi\nbGUgZm9yIGxhc3QgY29sdW1uCiAgICAgKiBAcGFyYW0gY29sU2Vjb25kYXJ5\nIHNlY29uZGFyeSB0YWJsZSBmb3IgY3VycmVudCBjb2x1bW4KICAgICAqIEBy\nZXR1cm4gc2Vjb25kYXJ5IHRhYmxlIGZvciBmaWVsZAogICAgICovCiAgICBw\ncml2YXRlIFN0cmluZyB0cmFja1NlY29uZGFyeVRhYmxlKEZpZWxkTWFwcGlu\nZyBmbSwgU3RyaW5nIHNlY29uZGFyeSwKICAgICAgICBTdHJpbmcgY29sU2Vj\nb25kYXJ5LCBpbnQgY29sKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkoY29sU2Vjb25kYXJ5KSkKICAgICAgICAgICAgY29sU2Vjb25kYXJ5\nID0gbnVsbDsKICAgICAgICBpZiAoY29sID09IDApCiAgICAgICAgICAgIHJl\ndHVybiBjb2xTZWNvbmRhcnk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5l\ncXVhbHNJZ25vcmVDYXNlKHNlY29uZGFyeSwgY29sU2Vjb25kYXJ5KSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJzZWNvbmQtaW5jb25zaXN0IiwgZm0pKTsKICAgICAgICByZXR1cm4gc2Vj\nb25kYXJ5OwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEpvaW5UYWJs\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlSm9pblRhYmxlKEZp\nZWxkTWFwcGluZyBmbSwgSm9pblRhYmxlIGpvaW4pIHsKICAgICAgICBmbS5n\nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFtZSh0b1RhYmxlTmFtZShqb2lu\nLnNjaGVtYSgpLAogICAgICAgICAgICBqb2luLm5hbWUoKSkpOwogICAgICAg\nIHBhcnNlSm9pbkNvbHVtbnMoZm0sIGZtLmdldE1hcHBpbmdJbmZvKCksIGZh\nbHNlLCBqb2luLmpvaW5Db2x1bW5zKCkpOwogICAgICAgIHBhcnNlSm9pbkNv\nbHVtbnMoZm0sIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZv\nKCksIGZhbHNlLAogICAgICAgICAgICBqb2luLmludmVyc2VKb2luQ29sdW1u\ncygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBKb2lu\nQ29sdW1uIGFubm90YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VKb2luQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdJbmZv\nIGluZm8sCiAgICAgICAgYm9vbGVhbiBzZWNvbmRhcnlBbGxvd2VkLCBKb2lu\nQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAgaWYgKGpvaW5zLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIExpc3Q8Q29sdW1u\nPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGpvaW5zLmxlbmd0aCk7\nCiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAgICAgICAgU3RyaW5nIHNlY29u\nZGFyeSA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lu\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1\nbW4oam9pbnNbaV0pKTsKICAgICAgICAgICAgdW5pcXVlIHw9IChqb2luc1tp\nXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAgICAgICAgICAgIHNlY29u\nZGFyeSA9IHRyYWNrU2Vjb25kYXJ5VGFibGUoZm0sIHNlY29uZGFyeSwKICAg\nICAgICAgICAgICAgIGpvaW5zW2ldLnRhYmxlKCksIGkpOwogICAgICAgICAg\nICBpZiAoIXNlY29uZGFyeUFsbG93ZWQgJiYgc2Vjb25kYXJ5ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1zZWNvbmQiLCBmbSkpOwogICAgICAgIH0KCiAgICAg\nICAgc2V0Q29sdW1ucyhmbSwgaW5mbywgY29scywgdW5pcXVlKTsKICAgICAg\nICBpZiAoc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgIGZtLmdldE1h\ncHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKHNlY29uZGFyeSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRo\nIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oSm9pbkNv\nbHVtbiBqb2luKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4o\nKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5uYW1l\nKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLm5hbWUoKSk7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4uY29sdW1uRGVm\naW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoam9pbi5jb2x1\nbW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpKQogICAgICAgICAg\nICBjb2wuc2V0VGFyZ2V0KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSk7\nCiAgICAgICAgY29sLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAg\nICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAh\nam9pbi5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVt\nbi5GTEFHX1VOVVBEQVRBQkxFLCAham9pbi51cGRhdGFibGUoKSk7CiAgICAg\nICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdp\ndmVuIEBQcmltYXJ5S2V5Sm9pbkNvbHVtbiBhbm5vdGF0aW9ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5z\nKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBQcmltYXJ5S2V5Sm9pbkNvbHVt\nbi4uLiBqb2lucykgewogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3\nIEFycmF5TGlzdDxDb2x1bW4+KGpvaW5zLmxlbmd0aCk7CiAgICAgICAgZm9y\nIChQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2luIDogam9pbnMpCiAgICAgICAg\nICAgIGNvbHMuYWRkKG5ld0NvbHVtbihqb2luKSk7CiAgICAgICAgc2V0Q29s\ndW1ucyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCksIGNvbHMsIDApOwogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgZ2l2ZW4gQFhKb2luQ29sdW1uIGFubm90\nYXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVhKb2lu\nQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdJbmZvIGluZm8sCiAg\nICAgICAgYm9vbGVhbiBzZWNvbmRhcnlBbGxvd2VkLCBYSm9pbkNvbHVtbi4u\nLiBqb2lucykgewogICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9\nIG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAg\nIGludCB1bmlxdWUgPSAwOwogICAgICAgIFN0cmluZyBzZWNvbmRhcnkgPSBu\ndWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW5z\nW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8PSAoam9pbnNbaV0udW5pcXVl\nKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgICAgICBzZWNvbmRhcnkgPSB0\ncmFja1NlY29uZGFyeVRhYmxlKGZtLCBzZWNvbmRhcnksCiAgICAgICAgICAg\nICAgICBqb2luc1tpXS50YWJsZSgpLCBpKTsKICAgICAgICAgICAgaWYgKCFz\nZWNvbmRhcnlBbGxvd2VkICYmIHNlY29uZGFyeSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtc2Vjb25kIiwgZm0pKTsKICAgICAgICB9CgogICAgICAgIHNldENv\nbHVtbnMoZm0sIGluZm8sIGNvbHMsIHVuaXF1ZSk7CiAgICAgICAgaWYgKHNl\nY29uZGFyeSAhPSBudWxsKQogICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5m\nbygpLnNldFRhYmxlTmFtZShzZWNvbmRhcnkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1h\ndGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKFhKb2luQ29sdW1uIGpv\naW4pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkpCiAg\nICAgICAgICAgIGNvbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0aW9u\nKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLmNvbHVtbkRlZmlu\naXRpb24oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpv\naW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5z\nZXRUYXJnZXQoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQXR0\ncmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldEZpZWxk\nKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSk7CiAgICAgICAgY29s\nLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNl\ndEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAham9pbi5pbnNlcnRh\nYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBE\nQVRBQkxFLCAham9pbi51cGRhdGFibGUoKSk7CiAgICAgICAgcmV0dXJuIGNv\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGVtYmVkZGVkIGluZm8g\nZm9yIHRoZSBnaXZlbiBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VFbWJlZGRlZE1hcHBpbmcoRmllbGRNYXBwaW5nIGZtLCBFbWJl\nZGRlZE1hcHBpbmcgYW5ubykgewogICAgICAgIENsYXNzTWFwcGluZyBlbWJl\nZCA9IGZtLmdldEVtYmVkZGVkTWFwcGluZygpOwogICAgICAgIGlmIChlbWJl\nZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1lbWJlZGRlZCIsIGZtKSk7CgogICAgICAg\nIEZpZWxkTWFwcGluZyBlZm07CiAgICAgICAgZm9yIChNYXBwaW5nT3ZlcnJp\nZGUgb3ZlciA6IGFubm8ub3ZlcnJpZGVzKCkpIHsKICAgICAgICAgICAgZWZt\nID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5nKG92ZXIubmFtZSgpKTsKICAgICAg\nICAgICAgaWYgKGVmbSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVycmlk\nZS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBmbSwgb3Zlci5uYW1lKCkp\nKTsKICAgICAgICAgICAgcG9wdWxhdGUoZWZtLCBvdmVyKTsKICAgICAgICB9\nCgogICAgICAgIFN0cmluZyBudWxsSW5kID0gbnVsbDsKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5udWxsSW5kaWNhdG9yQXR0cmli\ndXRlTmFtZSgpKSkKICAgICAgICAgICAgbnVsbEluZCA9IGFubm8ubnVsbElu\nZGljYXRvckF0dHJpYnV0ZU5hbWUoKTsKICAgICAgICBlbHNlIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShhbm5vLm51bGxJbmRpY2F0b3JDb2x1bW5OYW1l\nKCkpKQogICAgICAgICAgICBudWxsSW5kID0gYW5uby5udWxsSW5kaWNhdG9y\nQ29sdW1uTmFtZSgpOwogICAgICAgIGlmIChudWxsSW5kID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyBp\nbmZvID0gZm0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgaWYgKCJmYWxzZSIu\nZXF1YWxzKG51bGxJbmQpKQogICAgICAgICAgICBpbmZvLnNldENhbkluZGlj\nYXRlTnVsbChmYWxzZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIENv\nbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgICAgIGlmICghInRy\ndWUiLmVxdWFscyhudWxsSW5kKSkKICAgICAgICAgICAgICAgIGNvbC5zZXRO\nYW1lKG51bGxJbmQpOwogICAgICAgICAgICBpbmZvLnNldENvbHVtbnMoQXJy\nYXlzLmFzTGlzdChuZXcgQ29sdW1uW117IGNvbCB9KSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQENvbnRhaW5lclRhYmxlLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUNvbnRhaW5lclRhYmxl\nKEZpZWxkTWFwcGluZyBmbSwgQ29udGFpbmVyVGFibGUgY3RibCkgewogICAg\nICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKHRvVGFibGVO\nYW1lKGN0Ymwuc2NoZW1hKCksCiAgICAgICAgICAgIGN0YmwubmFtZSgpKSk7\nCiAgICAgICAgcGFyc2VYSm9pbkNvbHVtbnMoZm0sIGZtLmdldE1hcHBpbmdJ\nbmZvKCksIGZhbHNlLCBjdGJsLmpvaW5Db2x1bW5zKCkpOwogICAgICAgIGlm\nIChjdGJsLmpvaW5Gb3JlaWduS2V5KCkuc3BlY2lmaWVkKCkpCiAgICAgICAg\nICAgIHBhcnNlRm9yZWlnbktleShmbS5nZXRNYXBwaW5nSW5mbygpLCBjdGJs\nLmpvaW5Gb3JlaWduS2V5KCkpOwogICAgICAgIGlmIChjdGJsLmpvaW5JbmRl\neCgpLnNwZWNpZmllZCgpKQogICAgICAgICAgICBwYXJzZUluZGV4KGZtLmdl\ndE1hcHBpbmdJbmZvKCksIGN0Ymwuam9pbkluZGV4KCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQE9yZGVyQ29sdW1uLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcGFyc2VPcmRlckNvbHVtbihGaWVsZE1hcHBpbmcgZm0s\nIE9yZGVyQ29sdW1uIG9yZGVyKSB7CiAgICAgICAgaWYgKCFvcmRlci5lbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRD\nYW5PcmRlckNvbHVtbihmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KG9yZGVyLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXROYW1lKG9yZGVyLm5hbWUoKSk7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KG9yZGVyLmNvbHVtbkRlZmlu\naXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShvcmRlci5j\nb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlmIChvcmRlci5wcmVjaXNp\nb24oKSAhPSAwKQogICAgICAgICAgICBjb2wuc2V0U2l6ZShvcmRlci5wcmVj\naXNpb24oKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5J\nTlNFUlRBQkxFLCAhb3JkZXIuaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wu\nc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIW9yZGVyLnVwZGF0\nYWJsZSgpKTsKICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldE9yZGVy\nQ29sdW1uKGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARWxl\nbWVudEpvaW5Db2x1bW4ocykuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKEZpZWxkTWFwcGluZyBmbSwKICAg\nICAgICBFbGVtZW50Sm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIGlm\nIChqb2lucy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1u\nPihqb2lucy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAwOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW5zW2ldKSk7CiAg\nICAgICAgICAgIHVuaXF1ZSB8PSAoam9pbnNbaV0udW5pcXVlKCkpID8gVFJV\nRSA6IEZBTFNFOwogICAgICAgIH0KICAgICAgICBzZXRDb2x1bW5zKGZtLCBm\nbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBjb2xzLCB1\nbmlxdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNj\naGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBh\nbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4g\nbmV3Q29sdW1uKEVsZW1lbnRKb2luQ29sdW1uIGpvaW4pIHsKICAgICAgICBD\nb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5z\nZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAg\nICBjb2wuc2V0TmFtZShqb2luLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNlZENv\nbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJnZXQoam9pbi5y\nZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0\naWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQXR0cmlidXRlTmFtZSgpKSkK\nICAgICAgICAgICAgY29sLnNldFRhcmdldEZpZWxkKGpvaW4ucmVmZXJlbmNl\nZEF0dHJpYnV0ZU5hbWUoKSk7CiAgICAgICAgY29sLnNldE5vdE51bGwoIWpv\naW4ubnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcgKENvbHVtbi5G\nTEFHX1VOSU5TRVJUQUJMRSwgIWpvaW4uaW5zZXJ0YWJsZSAoKSk7CgkJY29s\nLnNldEZsYWcgKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAham9pbi51cGRh\ndGFibGUgKCkpOwoJCXJldHVybiBjb2w7Cgl9CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIFVuaXF1ZSBuZXdVbmlxdWUoQ2xhc3NNYXBwaW5nIGNtLCBTdHJp\nbmcgbmFtZSwgCiAgICAgICAgU3RyaW5nW10gY29sdW1uTmFtZXMpIHsKICAg\nICAgICBpZiAoY29sdW1uTmFtZXMgPT0gbnVsbCB8fCBjb2x1bW5OYW1lcy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nVW5pcXVlIHVuaXF1ZUNvbnN0cmFpbnQgPSBuZXcgVW5pcXVlKCk7CiAgICAg\nICAgdW5pcXVlQ29uc3RyYWludC5zZXROYW1lKG5hbWUpOwogICAgICAgIGZv\nciAoaW50IGk9MDsgaTxjb2x1bW5OYW1lcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjb2x1bW5OYW1lc1tp\nXSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiZW1wdHktdW5pcXVlLWNvbHVtbiIsIAogICAgICAgICAgICAg\nICAgICAgIEFycmF5cy50b1N0cmluZyhjb2x1bW5OYW1lcyksIGNtKSk7CiAg\nICAgICAgICAgIENvbHVtbiBjb2x1bW4gPSBuZXcgQ29sdW1uKCk7CiAgICAg\nICAgICAgIGNvbHVtbi5zZXROYW1lKGNvbHVtbk5hbWVzW2ldKTsKICAgICAg\nICAgICAgdW5pcXVlQ29uc3RyYWludC5hZGRDb2x1bW4oY29sdW1uKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHVuaXF1ZUNvbnN0cmFpbnQ7CiAgICB9\nCn0K\n","encoding":"base64"}

