{"sha":"a928004fbcb20b2f698dca78662e2ae052fe345c","node_id":"MDQ6QmxvYjIwNjM2NDphOTI4MDA0ZmJjYjIwYjJmNjk4ZGNhNzg2NjJlMmFlMDUyZmUzNDVj","size":26173,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a928004fbcb20b2f698dca78662e2ae052fe345c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5FbnVtTWFw\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW51bVR5cGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5UZW1wb3JhbFR5cGU7CgppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcueG1s\nLnNheC5TQVhFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZ0luZm87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1pbmF0\nb3JNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9zaXRvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1ZXJ5UmVzdWx0TWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuU2VxdWVuY2VN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5W\nYWx1ZU1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuRW51bVZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuRnVsbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNzU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25h\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRh\nRGF0YU1vZGVzLk1PREVfTUFQUElORzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lzdGVuY2VTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5YTUxQ\nZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplcjsKaW1wb3J0IHNlcnAudXRp\nbC5TdHJpbmdzOwoKLyoqCiAqIFNlcmlhbGl6ZXMgcGVyc2lzdGVuY2UgbWFw\ncGluZyB0byBYTUwuCiAqCiAqIEBzaW5jZSAwLjQuMAogKiBAYXV0aG9yIFN0\nZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgWE1MUGVy\nc2lzdGVuY2VNYXBwaW5nU2VyaWFsaXplcgogICAgZXh0ZW5kcyBYTUxQZXJz\naXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplciB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFRZUEVfUkVTVUxUTUFQID0gVFlQRV9RVUVSWSArIDE7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENvbFR5cGUsIFN0cmlu\nZz4gX25hbWVzOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX25hbWVzID0gbmV3\nIEVudW1NYXA8Q29sVHlwZSwgU3RyaW5nPihDb2xUeXBlLmNsYXNzKTsKICAg\nICAgICBfbmFtZXMucHV0KENvbFR5cGUuQ09MLCAiY29sdW1uIik7CiAgICAg\nICAgX25hbWVzLnB1dChDb2xUeXBlLkpPSU4sICJqb2luLWNvbHVtbiIpOwog\nICAgICAgIF9uYW1lcy5wdXQoQ29sVHlwZS5JTlZFUlNFLCAiaW52ZXJzZS1q\nb2luLWNvbHVtbiIpOwogICAgICAgIF9uYW1lcy5wdXQoQ29sVHlwZS5QS19K\nT0lOLCAicHJpbWFyeS1rZXktam9pbi1jb2x1bW4iKTsKICAgICAgICBfbmFt\nZXMucHV0KENvbFR5cGUuRElTQywgImRpc2NyaW1pbmF0b3ItY29sdW1uIik7\nCiAgICB9CgogICAgcHJpdmF0ZSBMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4g\nX3Jlc3VsdHMgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9zeW5jID0g\nZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNv\nbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBYTUxQZXJzaXN0ZW5j\nZU1hcHBpbmdTZXJpYWxpemVyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYpIHsK\nICAgICAgICBzdXBlcihjb25mKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdG8gYXV0b21hdGljYWxseSBzeW5jaHJvbml6ZSBtYXBwaW5nIGlu\nZm8gd2l0aCBkYXRhIGF2YWlsYWJsZQogICAgICogZnJvbSBtYXBwZWQgY29t\ncG9uZW50cyBiZWZvcmUgc2VyaWFsaXphdGlvbi4gRGVmYXVsdHMgdG8gZmFs\nc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN5bmNNYXBwaW5n\nSW5mbygpIHsKICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgc3luY2hyb25pemUg\nbWFwcGluZyBpbmZvIHdpdGggZGF0YSBhdmFpbGFibGUKICAgICAqIGZyb20g\nbWFwcGVkIGNvbXBvbmVudHMgYmVmb3JlIHNlcmlhbGl6YXRpb24uIERlZmF1\nbHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTeW5j\nTWFwcGluZ0luZm8oYm9vbGVhbiBzeW5jKSB7CiAgICAgICAgX3N5bmMgPSBz\neW5jOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgZ2l2ZW4gcmVz\ndWx0IHNldCBtYXBwaW5nIHRvIGxvY2FsIGNhY2hlLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoUXVlcnlSZXN1bHRN\nYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3Jlc3VsdHMgPT0gbnVsbCkK\nICAgICAgICAgICAgX3Jlc3VsdHMgPSBuZXcgQXJyYXlMaXN0PFF1ZXJ5UmVz\ndWx0TWFwcGluZz4oKTsKICAgICAgICBfcmVzdWx0cy5hZGQobWV0YSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGdpdmVuIHJlc3VsdCBzZXQg\nbWFwcGluZyBmcm9tIHRoZSBsb2NhbCBjYWNoZS4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKFF1ZXJ5UmVz\ndWx0TWFwcGluZyBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRzICE9\nIG51bGwgJiYgX3Jlc3VsdHMucmVtb3ZlKG1ldGEpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgYWRkQWxsKE1ldGFEYXRhUmVwb3Np\ndG9yeSByZXBvcykgewogICAgICAgIHN1cGVyLmFkZEFsbChyZXBvcyk7CiAg\nICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChNYXBwaW5n\nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVyeVJlc3Vs\ndE1hcHBpbmdzKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5UmVzdWx0TWFwcGlu\nZyhyZXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xl\nYW4gcmVtb3ZlQWxsKE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcykgewogICAg\nICAgIGJvb2xlYW4gcmVtb3ZlZCA9IHN1cGVyLnJlbW92ZUFsbChyZXBvcyk7\nCiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChNYXBw\naW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVyeVJl\nc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIHJlbW92ZWQgfD0gcmVtb3Zl\nUXVlcnlSZXN1bHRNYXBwaW5nKHJlcyk7CiAgICAgICAgcmV0dXJuIHJlbW92\nZWQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjbGVh\ncigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIGlmIChfcmVz\ndWx0cyAhPSBudWxsKQogICAgICAgICAgICBfcmVzdWx0cy5jbGVhcigpOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZENvbW1tZW50cyhPYmplY3Qg\nb2JqKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlm\nIChpc01hcHBpbmdNb2RlKCkgJiYgIWlzTWV0YURhdGFNb2RlKCkpIHsKICAg\nICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIENsYXNzTWFwcGluZykKICAg\nICAgICAgICAgICAgIG9iaiA9ICgoQ2xhc3NNYXBwaW5nKSBvYmopLmdldE1h\ncHBpbmdJbmZvKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKG9iaiBpbnN0YW5j\nZW9mIEZpZWxkTWFwcGluZykKICAgICAgICAgICAgICAgIG9iaiA9ICgoRmll\nbGRNYXBwaW5nKSBvYmopLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgfQog\nICAgICAgIHN1cGVyLmFkZENvbW1lbnRzKG9iaik7CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFzcyhDbGFz\nc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gYWNjZXNzKQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmIChfc3luYyAmJiBpc01hcHBp\nbmdNb2RlKCkgJiYgbWV0YSBpbnN0YW5jZW9mIENsYXNzTWFwcGluZykgewog\nICAgICAgICAgICAvLyBzeW5jIGlmIHJlc29sdmVkIGFuZCBtYXBwZWQKICAg\nICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IChDbGFzc01hcHBpbmcpIG1l\ndGE7CiAgICAgICAgICAgIGlmICgoY2xzLmdldFJlc29sdmUoKSAmIE1PREVf\nTUFQUElORykgIT0gMCAmJiBjbHMuaXNNYXBwZWQoKSkgewogICAgICAgICAg\nICAgICAgY2xzLnN5bmNNYXBwaW5nSW5mbygpOwogICAgICAgICAgICAgICAg\nY2xzLmdldERpc2NyaW1pbmF0b3IoKS5zeW5jTWFwcGluZ0luZm8oKTsKICAg\nICAgICAgICAgICAgIGNscy5nZXRWZXJzaW9uKCkuc3luY01hcHBpbmdJbmZv\nKCk7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHM7CiAg\nICAgICAgICAgICAgICBpZiAoY2xzLmdldEVtYmVkZGluZ01ldGFEYXRhKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBjbHMuZ2V0\nRGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBjbHMuZ2V0RmllbGRNYXBw\naW5ncygpOwogICAgICAgICAgICAgICAgZm9yIChGaWVsZE1hcHBpbmcgZiA6\nIGZpZWxkcykKICAgICAgICAgICAgICAgICAgICBmLnN5bmNNYXBwaW5nSW5m\nbygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN1cGVyLnNl\ncmlhbGl6ZUNsYXNzKG1ldGEsIGFjY2Vzcyk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFzc01hcHBpbmdD\nb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gKENs\nYXNzTWFwcGluZykgbWFwcGluZzsKICAgICAgICBDbGFzc01hcHBpbmdJbmZv\nIGluZm8gPSBjbHMuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBzZXJpYWxp\nemVUYWJsZShpbmZvLmdldFRhYmxlTmFtZSgpLCAidGFibGUiLCBTdHJpbmdz\nCiAgICAgICAgICAgIC5nZXRDbGFzc05hbWUobWFwcGluZy5nZXREZXNjcmli\nZWRUeXBlKCkpLCBudWxsLCAKICAgICAgICAgICAgaW5mby5nZXRVbmlxdWVz\nKCkpOwogICAgICAgIGZvciAoU3RyaW5nIHNlY29uZCA6IGluZm8uZ2V0U2Vj\nb25kYXJ5VGFibGVOYW1lcygpKQogICAgICAgICAgICBzZXJpYWxpemVUYWJs\nZShzZWNvbmQsICJzZWNvbmRhcnktdGFibGUiLCBudWxsLCBpbmZvLCBudWxs\nKTsKICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGluZm8sIENvbFR5cGUuUEtf\nSk9JTiwgbnVsbCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0\nZWQgdm9pZCBzZXJpYWxpemVJbmhlcml0YW5jZUNvbnRlbnQoQ2xhc3NNZXRh\nRGF0YSBtYXBwaW5nKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewog\nICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSAoQ2xhc3NNYXBwaW5nKSBtYXBw\naW5nOwogICAgICAgIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9IGNscy5nZXRN\nYXBwaW5nSW5mbygpOwogICAgICAgIERpc2NyaW1pbmF0b3JNYXBwaW5nSW5m\nbyBkaW5mbyA9IGNscy5nZXREaXNjcmltaW5hdG9yKCkKICAgICAgICAgICAg\nLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgU3RyaW5nIHN0cmF0ID0gaW5m\nby5nZXRIaWVyYXJjaHlTdHJhdGVneSgpOwogICAgICAgIGlmIChGbGF0Q2xh\nc3NTdHJhdGVneS5BTElBUy5lcXVhbHMoc3RyYXQpKQogICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoInN0cmF0ZWd5IiwgIlNJTkdMRV9UQUJMRSIpOwogICAg\nICAgIGVsc2UgaWYgKFZlcnRpY2FsQ2xhc3NTdHJhdGVneS5BTElBUy5lcXVh\nbHMoc3RyYXQpKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInN0cmF0ZWd5\nIiwgIkpPSU5FRCIpOwogICAgICAgIGVsc2UgaWYgKEZ1bGxDbGFzc1N0cmF0\nZWd5LkFMSUFTLmVxdWFscyhzdHJhdCkpCiAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgic3RyYXRlZ3kiLCAiVEFCTEVfUEVSX0NMQVNTIik7CiAgICAgICAg\naWYgKHN0cmF0ICE9IG51bGwpIHsKICAgICAgICAgICAgc3RhcnRFbGVtZW50\nKCJpbmhlcml0YW5jZSIpOwogICAgICAgICAgICBlbmRFbGVtZW50KCJpbmhl\ncml0YW5jZSIpOwogICAgICAgIH0KICAgICAgICBpZiAoZGluZm8uZ2V0VmFs\ndWUoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgiZGlz\nY3JpbWluYXRvci12YWx1ZSIpOwogICAgICAgICAgICBhZGRUZXh0KGRpbmZv\nLmdldFZhbHVlKCkpOwogICAgICAgICAgICBlbmRFbGVtZW50KCJkaXNjcmlt\naW5hdG9yLXZhbHVlIik7CiAgICAgICAgfQogICAgICAgIHNlcmlhbGl6ZUNv\nbHVtbnMoZGluZm8sIENvbFR5cGUuRElTQywgbnVsbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXJpYWxpemUgdGFibGUgb3B0aW9uYWxseSBsaXN0aW5n\nIHByaW1hcnkta2V5LWpvaW5zIHN0b3JlZAogICAgICogaW4gdGhlIGdpdmVu\nIHtAbGluayBDbGFzc01hcHBpbmdJbmZvfS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNlcmlhbGl6ZVRhYmxlKFN0cmluZyB0YWJsZSwgU3RyaW5nIGVs\nZW1lbnROYW1lLAogICAgICAgIFN0cmluZyBkZWZhdWx0TmFtZSwgQ2xhc3NN\nYXBwaW5nSW5mbyBzZWNvbmRhcnlJbmZvLCBVbmlxdWVbXSB1bmlxdWVzKQog\nICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIExpc3Q8Q29s\ndW1uPiBjb2xzID0gbnVsbDsKICAgICAgICBpZiAoc2Vjb25kYXJ5SW5mbyAh\nPSBudWxsKQogICAgICAgICAgICBjb2xzID0gKExpc3Q8Q29sdW1uPikgc2Vj\nb25kYXJ5SW5mby5nZXRTZWNvbmRhcnlUYWJsZUpvaW5Db2x1bW5zCiAgICAg\nICAgICAgICAgICAodGFibGUpOwoKICAgICAgICBib29sZWFuIHByaW50ID0g\nKGNvbHMgIT0gbnVsbCAmJiBjb2xzLnNpemUoKSA+IDApIHx8IAogICAgICAg\nICAgICAodW5pcXVlcyAhPSBudWxsICYmIHVuaXF1ZXMubGVuZ3RoID4gMCk7\nCiAgICAgICAgaWYgKHRhYmxlICE9IG51bGwKICAgICAgICAgICAgJiYgKGRl\nZmF1bHROYW1lID09IG51bGwgfHwgIWRlZmF1bHROYW1lLmVxdWFscyh0YWJs\nZSkpKSB7CiAgICAgICAgICAgIHByaW50ID0gdHJ1ZTsKICAgICAgICAgICAg\naW50IGluZGV4ID0gdGFibGUuaW5kZXhPZignLicpOwogICAgICAgICAgICBp\nZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJu\nYW1lIiwgdGFibGUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgIGFkZEF0dHJpYnV0ZSgic2NoZW1hIiwgdGFibGUuc3Vic3RyaW5nKDAs\nIGluZGV4KSk7CiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUi\nLCB0YWJsZS5zdWJzdHJpbmcoaW5kZXggKyAxKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgaWYgKHByaW50KSB7CiAgICAgICAgICAgIHN0\nYXJ0RWxlbWVudChlbGVtZW50TmFtZSk7CiAgICAgICAgICAgIGlmIChjb2xz\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoQ29sdW1uIGNvbCA6\nIGNvbHMpCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQ29sdW1uKGNv\nbCwgQ29sVHlwZS5QS19KT0lOLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKHVuaXF1ZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGZvciAoVW5pcXVlIHVuaXF1ZTogdW5pcXVlcykKICAgICAgICAg\nICAgICAgICAgICBzZXJpYWxpemVVbmlxdWVDb25zdHJhaW50KHVuaXF1ZSk7\nCiAgICAgICAgICAgIGVuZEVsZW1lbnQoZWxlbWVudE5hbWUpOwogICAgICAg\nIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBib29sZWFu\nIHNlcmlhbGl6ZUF0dHJpYnV0ZU92ZXJyaWRlKEZpZWxkTWV0YURhdGEgZm1k\nLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZykgewogICAgICAgIGlmIChv\ncmlnID09IG51bGwgfHwgZm1kID09IG9yaWcpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0gKEZpZWxk\nTWFwcGluZykgZm1kOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZDIgPSAo\nRmllbGRNYXBwaW5nKSBvcmlnOwogICAgICAgIGlmIChmaWVsZC5nZXRNYXBw\naW5nSW5mbygpLmhhc1NjaGVtYUNvbXBvbmVudHMoKQogICAgICAgICAgICB8\nfCBmaWVsZDIuZ2V0TWFwcGluZ0luZm8oKS5oYXNTY2hlbWFDb21wb25lbnRz\nKCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBWYWx1ZU1h\ncHBpbmdJbmZvIGluZm8gPSBmaWVsZC5nZXRWYWx1ZUluZm8oKTsKICAgICAg\nICBMaXN0PENvbHVtbj4gY29scyA9IChMaXN0PENvbHVtbj4pIGluZm8uZ2V0\nQ29sdW1ucygpOwogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5z\naXplKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIFZhbHVlTWFwcGluZ0luZm8gaW5mbzIgPSBmaWVsZDIuZ2V0VmFsdWVJbmZv\nKCk7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMyID0gKExpc3Q8Q29sdW1u\nPikgaW5mbzIuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmIChjb2xzMiA9PSBu\ndWxsIHx8IGNvbHMyLnNpemUoKSAhPSBjb2xzLnNpemUoKSkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGNvbHMuc2l6ZSgpICE9IDEp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBDb2x1bW4gY29s\nOwogICAgICAgIENvbHVtbiBjb2wyOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29scy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBjb2wgPSBj\nb2xzLmdldChpKTsKICAgICAgICAgICAgY29sMiA9IGNvbHMyLmdldChpKTsK\nICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHMoY29sLmdldE5h\nbWUoKSwgY29sMi5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuZXF1YWxzKGNv\nbC5nZXRUeXBlTmFtZSgpLCBjb2wyLmdldFR5cGVOYW1lKCkpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0\nU2l6ZSgpICE9IGNvbDIuZ2V0U2l6ZSgpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RGVjaW1hbERpZ2l0\ncygpICE9IGNvbDIuZ2V0RGVjaW1hbERpZ2l0cygpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RmxhZyhD\nb2x1bW4uRkxBR19VTklOU0VSVEFCTEUpCiAgICAgICAgICAgICAgICAhPSBj\nb2wyLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKSkKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoY29sLmdl\ndEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUpCiAgICAgICAgICAgICAg\nICAhPSBjb2wyLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCB2b2lkIHNlcmlhbGl6ZUF0dHJpYnV0ZU92ZXJyaWRlTWFwcGluZ0Nv\nbnRlbnQoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgRmllbGRNZXRhRGF0\nYSBvcmlnKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAg\nIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBpbmcpIGZtZDsKICAgICAg\nICBzZXJpYWxpemVDb2x1bW5zKGZtLmdldFZhbHVlSW5mbygpLCBDb2xUeXBl\nLkNPTCwgZm0uZ2V0TWFwcGluZ0luZm8oKQogICAgICAgICAgICAuZ2V0VGFi\nbGVOYW1lKCkpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVk\nIFBlcnNpc3RlbmNlU3RyYXRlZ3kgZ2V0U3RyYXRlZ3koRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0ID0g\nc3VwZXIuZ2V0U3RyYXRlZ3koZm1kKTsKICAgICAgICBGaWVsZE1hcHBpbmcg\nZmllbGQgPSAoRmllbGRNYXBwaW5nKSBmbWQ7CiAgICAgICAgc3dpdGNoIChz\ndHJhdCkgewogICAgICAgICAgICBjYXNlIE1BTllfTUFOWToKICAgICAgICAg\nICAgICAgIC8vIHdlIGNhbiBkaWZmZXJlbnRpYXRlIGEgb25lLW1hbnkgYnkg\ndGhlIGZhY3QgdGhhdCB0aGVyZSBpcyBubwogICAgICAgICAgICAgICAgLy8g\nc2Vjb25kYXJ5IHRhYmxlIGpvaW4sIG9yIHRoZSBmayBpcyB1bmlxdWUKICAg\nICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpID09IG51bGwK\nICAgICAgICAgICAgICAgICAgICAmJiAoZmllbGQuZ2V0TWFwcGluZ0luZm8o\nKS5nZXRKb2luRGlyZWN0aW9uKCkKICAgICAgICAgICAgICAgICAgICA9PSBN\nYXBwaW5nSW5mby5KT0lOX05PTkUKICAgICAgICAgICAgICAgICAgICB8fCBm\naWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLmdldFVu\naXF1ZSgpCiAgICAgICAgICAgICAgICAgICAgIT0gbnVsbCkpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuT05FX01B\nTlk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBN\nQU5ZX09ORToKICAgICAgICAgICAgICAgIC8vIGludmVyc2Ugam9pbiBjb2xz\nIG9yIHVuaXF1ZSBmaz8KICAgICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRW\nYWx1ZUluZm8oKS5nZXRKb2luRGlyZWN0aW9uKCkKICAgICAgICAgICAgICAg\nICAgICA9PSBNYXBwaW5nSW5mby5KT0lOX0lOVkVSU0UKICAgICAgICAgICAg\nICAgICAgICB8fCBmaWVsZC5nZXRWYWx1ZUluZm8oKS5nZXRVbmlxdWUoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5j\nZVN0cmF0ZWd5Lk9ORV9PTkU7CgogICAgICAgICAgICAgICAgLy8gc2NhbiBm\nb3IgcHJpbWFyeS1rZXktam9pbi1jb2x1bW4KICAgICAgICAgICAgICAgIExp\nc3Q8Q29sdW1uPiBjb2xzID0gZmllbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29s\ndW1ucygpOwogICAgICAgICAgICAgICAgYm9vbGVhbiBwa0pvaW4gPSBjb2xz\nICE9IG51bGwgJiYgY29scy5zaXplKCkgPiAwOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IHBrSm9pbiAmJiBpIDwgY29scy5zaXplKCk7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBwa0pvaW4gPSBjb2xzLmdldChpKS5n\nZXRGbGFnKENvbHVtbi5GTEFHX1BLX0pPSU4pOwogICAgICAgICAgICAgICAg\naWYgKHBrSm9pbikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lz\ndGVuY2VTdHJhdGVneS5PTkVfT05FOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJhdDsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZUZpZWxkTWFw\ncGluZ0NvbnRlbnQoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgUGVyc2lz\ndGVuY2VTdHJhdGVneSBzdHJhdGVneSkKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoZm1kLmdldE1hcHBlZEJ5KCkgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyB3aGlsZSBJJ2Qg\nbGlrZSB0byBkbyBhdXRvIGRldGVjdGlvbiBiYXNlZCBvbiBqb2luIGRpcmVj\ndGlvbnMsIGV0Yy4KICAgICAgICAvLyB0aGUgZGlzdGluZ3Vpc2hlZCBjb2x1\nbW4gLyB0YWJsZSAvIGV0YyBuYW1lcyBmb3JjZXMgb3VyIGhhbmQKICAgICAg\nICAvLyBlc3AgZm9yIE9wZW5KUEEgY3VzdG9tIG1hcHBpbmdzLgogICAgICAg\nIEZpZWxkTWFwcGluZyBmaWVsZCA9IChGaWVsZE1hcHBpbmcpIGZtZDsKICAg\nICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7CiAgICAgICAgICAgIGNhc2UgT05F\nX09ORToKICAgICAgICAgICAgY2FzZSBNQU5ZX09ORToKICAgICAgICAgICAg\nICAgIHNlcmlhbGl6ZUNvbHVtbnMoZmllbGQuZ2V0VmFsdWVJbmZvKCksIENv\nbFR5cGUuSk9JTiwKICAgICAgICAgICAgICAgICAgICBmaWVsZC5nZXRNYXBw\naW5nSW5mbygpLmdldFRhYmxlTmFtZSgpKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgY2FzZSBPTkVfTUFOWToKICAgICAgICAgICAg\nICAgIGlmIChmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldEpvaW5EaXJlY3Rp\nb24oKSA9PQogICAgICAgICAgICAgICAgICAgIE1hcHBpbmdJbmZvLkpPSU5f\nTk9ORSkgewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUNvbHVtbnMo\nZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgQ29sVHlwZS5KT0lOLCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAgICAgICAgICAgIGNh\nc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdldE1h\ncHBpbmdJbmZvKCkuaGFzU2NoZW1hQ29tcG9uZW50cygpCiAgICAgICAgICAg\nICAgICAgICAgfHwgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1\nZUluZm8oKQogICAgICAgICAgICAgICAgICAgIC5oYXNTY2hlbWFDb21wb25l\nbnRzKCkpIHsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGUgPSBm\naWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldFRhYmxlTmFtZSgpOwogICAgICAg\nICAgICAgICAgICAgIGlmICh0YWJsZSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGludCBpbmRleCA9IHRhYmxlLmluZGV4T2YoJy4nKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIHRh\nYmxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInNjaGVtYSIsIHRh\nYmxlLnN1YnN0cmluZygwLCBpbmRleCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgdGFibGUuc3Vic3RyaW5n\nKGluZGV4ICsgMSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHN0YXJ0RWxl\nbWVudCgiam9pbi10YWJsZSIpOwogICAgICAgICAgICAgICAgICAgIHNlcmlh\nbGl6ZUNvbHVtbnMoZmllbGQuZ2V0TWFwcGluZ0luZm8oKSwgQ29sVHlwZS5K\nT0lOLAogICAgICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGZpZWxkLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIENvbFR5cGUuSU5WRVJTRSwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgZW5kRWxlbWVudCgiam9pbi10YWJsZSIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nc2VyaWFsaXplQ29sdW1ucyhmaWVsZC5nZXRWYWx1ZUluZm8oKSwgQ29sVHlw\nZS5DT0wsCiAgICAgICAgICAgIGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0\nVGFibGVOYW1lKCkpOwogICAgICAgIGlmIChzdHJhdGVneSA9PSBQZXJzaXN0\nZW5jZVN0cmF0ZWd5LkJBU0lDICYmIGlzTG9iKGZpZWxkKSkgewogICAgICAg\nICAgICBzdGFydEVsZW1lbnQoImxvYiIpOwogICAgICAgICAgICBlbmRFbGVt\nZW50KCJsb2IiKTsKICAgICAgICB9CiAgICAgICAgVGVtcG9yYWxUeXBlIHRl\nbXBvcmFsID0gZ2V0VGVtcG9yYWwoZmllbGQpOwogICAgICAgIGlmICh0ZW1w\nb3JhbCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgidGVt\ncG9yYWwiKTsKICAgICAgICAgICAgYWRkVGV4dCh0ZW1wb3JhbC50b1N0cmlu\nZygpKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgidGVtcG9yYWwiKTsKICAg\nICAgICB9CgogICAgICAgIEVudW1UeXBlIGVudW1UeXBlID0gZ2V0RW51bVR5\ncGUoZmllbGQpOwogICAgICAgIGlmIChlbnVtVHlwZSAhPSBudWxsICYmIGVu\ndW1UeXBlICE9IEVudW1UeXBlLk9SRElOQUwpIHsKICAgICAgICAgICAgc3Rh\ncnRFbGVtZW50KCJlbnVtZXJhdGVkIik7CiAgICAgICAgICAgIGFkZFRleHQo\nZW51bVR5cGUudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGVuZEVsZW1lbnQo\nImVudW1lcmF0ZWQiKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZXRlcm1pbmUgaWYgdGhlIGZpZWxkIGlzIGEgbG9iLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNMb2IoRmllbGRNYXBwaW5nIGZpZWxkKSB7\nCiAgICAgICAgZm9yIChDb2x1bW4gY29sIDogKExpc3Q8Q29sdW1uPikgZmll\nbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpKQogICAgICAgICAgICBp\nZiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5CTE9CIHx8IGNvbC5nZXRUeXBl\nKCkgPT0gVHlwZXMuQ0xPQikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBmaWVsZCdzIHRlbXBvcmFsIHR5cGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgVGVtcG9yYWxUeXBlIGdldFRlbXBvcmFsKEZpZWxkTWFwcGluZyBm\naWVsZCkgewogICAgICAgIGlmIChmaWVsZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLkRBVEUKICAgICAgICAgICAgJiYgZmllbGQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5DQUxFTkRBUikKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIERCRGljdGlvbmFyeSBk\naWN0ID0gKChKREJDQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJhdGlvbigp\nKQogICAgICAgICAgICAuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAg\nICAgICBpbnQgZGVmID0gZGljdC5nZXRKREJDVHlwZShmaWVsZC5nZXRUeXBl\nQ29kZSgpLCBmYWxzZSk7CiAgICAgICAgZm9yIChDb2x1bW4gY29sIDogKExp\nc3Q8Q29sdW1uPikgZmllbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygp\nKSB7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0VHlwZSgpID09IGRlZikKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBzd2l0Y2ggKGNv\nbC5nZXRUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgVHlwZXMuREFU\nRToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVGVtcG9yYWxUeXBlLkRB\nVEU7CiAgICAgICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUU6CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIFRlbXBvcmFsVHlwZS5USU1FOwogICAgICAg\nICAgICAgICAgY2FzZSBUeXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFRlbXBvcmFsVHlwZS5USU1FU1RBTVA7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gZW51bSB0eXBlIGZvciB0aGUgZmllbGQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBFbnVtVHlwZSBnZXRFbnVtVHlwZShG\naWVsZE1hcHBpbmcgZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5PQkpFQ1QpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICghKGZpZWxkLmdldEhhbmRs\nZXIoKSBpbnN0YW5jZW9mIEVudW1WYWx1ZUhhbmRsZXIpKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKChFbnVtVmFsdWVIYW5k\nbGVyKSBmaWVsZC5nZXRIYW5kbGVyKCkpLmdldFN0b3JlT3JkaW5hbCgpCiAg\nICAgICAgICAgID8gRW51bVR5cGUuT1JESU5BTCA6IEVudW1UeXBlLlNUUklO\nRzsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSB0aGUgY29sdW1u\ncyBpbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZvLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc2VyaWFsaXplQ29sdW1ucyhNYXBwaW5nSW5mbyBpbmZvLCBD\nb2xUeXBlIHR5cGUsCiAgICAgICAgU3RyaW5nIHNlY29uZGFyeSkKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBMaXN0PENvbHVtbj4g\nY29scyA9IChMaXN0PENvbHVtbj4pIGluZm8uZ2V0Q29sdW1ucygpOwogICAg\nICAgIGlmIChjb2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBmb3IgKENvbHVtbiBjb2wgOiBjb2xzKQogICAgICAgICAgICBzZXJp\nYWxpemVDb2x1bW4oY29sLCB0eXBlLCBzZWNvbmRhcnksIGluZm8uZ2V0VW5p\ncXVlKCkgIT0gbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxp\nemUgYSBzaW5nbGUgY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nc2VyaWFsaXplQ29sdW1uKENvbHVtbiBjb2wsIENvbFR5cGUgdHlwZSwgU3Ry\naW5nIHNlY29uZGFyeSwKICAgICAgICBib29sZWFuIHVuaXF1ZSkKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29sLmdldE5h\nbWUoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUi\nLCBjb2wuZ2V0TmFtZSgpKTsKICAgICAgICBpZiAoY29sLmdldFR5cGVOYW1l\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJjb2x1bW4t\nZGVmaW5pdGlvbiIsIGNvbC5nZXRUeXBlTmFtZSgpKTsKICAgICAgICBpZiAo\nY29sLmdldFRhcmdldCgpICE9IG51bGwKICAgICAgICAgICAgJiYgKHR5cGUg\nPT0gQ29sVHlwZS5KT0lOIHx8IHR5cGUgPT0gQ29sVHlwZS5JTlZFUlNFCiAg\nICAgICAgICAgIHx8IHR5cGUgPT0gQ29sVHlwZS5QS19KT0lOKSkKICAgICAg\nICAgICAgYWRkQXR0cmlidXRlKCJyZWZlcmVuY2VkLWNvbHVtbi1uYW1lIiwg\nY29sLmdldFRhcmdldCgpKTsKICAgICAgICBpZiAodHlwZSA9PSBDb2xUeXBl\nLkNPTCB8fCB0eXBlID09IENvbFR5cGUuSk9JTgogICAgICAgICAgICB8fCB0\neXBlID09IENvbFR5cGUuUEtfSk9JTikgewogICAgICAgICAgICBpZiAodW5p\ncXVlKQogICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJ1bmlxdWUiLCAi\ndHJ1ZSIpOwogICAgICAgICAgICBpZiAoY29sLmlzTm90TnVsbCgpKQogICAg\nICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJudWxsYWJsZSIsICJmYWxzZSIp\nOwogICAgICAgICAgICBpZiAoY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5J\nTlNFUlRBQkxFKSkKICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgiaW5z\nZXJ0YWJsZSIsICJmYWxzZSIpOwogICAgICAgICAgICBpZiAoY29sLmdldEZs\nYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUpKQogICAgICAgICAgICAgICAg\nYWRkQXR0cmlidXRlKCJ1cGRhdGFibGUiLCAiZmFsc2UiKTsKICAgICAgICAg\nICAgaWYgKHNlY29uZGFyeSAhPSBudWxsKQogICAgICAgICAgICAgICAgYWRk\nQXR0cmlidXRlKCJ0YWJsZSIsIHNlY29uZGFyeSk7CgogICAgICAgICAgICBp\nZiAodHlwZSA9PSBDb2xUeXBlLkNPTCkgewogICAgICAgICAgICAgICAgaWYg\nKGNvbC5nZXRTaXplKCkgPiAwICYmIGNvbC5nZXRTaXplKCkgIT0gMjU1KQog\nICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgibGVuZ3RoIiwgY29s\nLmdldFNpemUoKSArICIiKTsKICAgICAgICAgICAgICAgIGlmIChjb2wuZ2V0\nRGVjaW1hbERpZ2l0cygpICE9IDApCiAgICAgICAgICAgICAgICAgICAgYWRk\nQXR0cmlidXRlKCJzY2FsZSIsIGNvbC5nZXREZWNpbWFsRGlnaXRzKCkgKyAi\nIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUg\nIT0gQ29sVHlwZS5DT0wgfHwgZ2V0QXR0cmlidXRlcygpLmdldExlbmd0aCgp\nID4gMCkgewogICAgICAgICAgICBTdHJpbmcgbmFtZSA9IGNvbC5nZXRGbGFn\nKENvbHVtbi5GTEFHX1BLX0pPSU4pID8gX25hbWVzCiAgICAgICAgICAgICAg\nICAuZ2V0KENvbFR5cGUuUEtfSk9JTikgOiBfbmFtZXMuZ2V0KHR5cGUpOwog\nICAgICAgICAgICBzdGFydEVsZW1lbnQobmFtZSk7CiAgICAgICAgICAgIGVu\nZEVsZW1lbnQobmFtZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBzZXJpYWxpemVVbmlxdWVDb25zdHJhaW50KFVuaXF1ZSB1bmlxdWUp\nIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIHN0YXJ0RWxlbWVudCgi\ndW5pcXVlLWNvbnN0cmFpbnQiKTsKICAgICAgICBDb2x1bW5bXSBjb2x1bW5z\nID0gdW5pcXVlLmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKENvbHVtbiBj\nb2x1bW46Y29sdW1ucykgewogICAgICAgICAgICBzdGFydEVsZW1lbnQoImNv\nbHVtbi1uYW1lIik7CiAgICAgICAgICAgIGFkZFRleHQoY29sdW1uLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoImNvbHVtbi1uYW1lIik7\nCiAgICAgICAgfQogICAgICAgIGVuZEVsZW1lbnQoInVuaXF1ZS1jb25zdHJh\naW50Iik7CiAgICB9CiAgICAKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVk\nIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yIG5ld1NlcmlhbGl6YXRpb25Db21w\nYXJhdG9yKCkgewogICAgICAgIHJldHVybiBuZXcgTWFwcGluZ1NlcmlhbGl6\nYXRpb25Db21wYXJhdG9yKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhZGRTeXN0ZW1NYXBwaW5nRWxlbWVudHMoQ29sbGVj\ndGlvbiB0b1NlcmlhbGl6ZSkgewogICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgp\nKQogICAgICAgICAgICB0b1NlcmlhbGl6ZS5hZGRBbGwoZ2V0UXVlcnlSZXN1\nbHRNYXBwaW5ncyhudWxsKSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ncm90ZWN0ZWQgaW50IHR5cGUoT2JqZWN0IG8pIHsKICAgICAgICBpbnQgdHlw\nZSA9IHN1cGVyLnR5cGUobyk7CiAgICAgICAgaWYgKHR5cGUgPT0gLTEgJiYg\nbyBpbnN0YW5jZW9mIFF1ZXJ5UmVzdWx0TWFwcGluZykKICAgICAgICAgICAg\ncmV0dXJuIFRZUEVfUkVTVUxUTUFQOwogICAgICAgIHJldHVybiB0eXBlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZXN1bHQgc2V0IG1h\ncHBpbmdzIGZvciB0aGUgZ2l2ZW4gc2NvcGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+IGdldFF1ZXJ5UmVzdWx0TWFw\ncGluZ3MoQ2xhc3NNZXRhRGF0YSBjbSkgewogICAgICAgIGlmIChfcmVzdWx0\ncyA9PSBudWxsIHx8IF9yZXN1bHRzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuIChMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4pIENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1Q7CgogICAgICAgIExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5n\nPiByZXN1bHQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX3Jlc3VsdHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgUXVlcnlSZXN1\nbHRNYXBwaW5nIGVsZW1lbnQgPSBfcmVzdWx0cy5nZXQoaSk7CiAgICAgICAg\nICAgIGlmICgoY20gPT0gbnVsbCAmJiBlbGVtZW50LmdldFNvdXJjZVNjb3Bl\nKCkgIT0gbnVsbCkgfHwgKGNtICE9IG51bGwKICAgICAgICAgICAgICAgICYm\nIGVsZW1lbnQuZ2V0U291cmNlU2NvcGUoKSAhPSBjbS5nZXREZXNjcmliZWRU\neXBlKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICBpZiAocmVzdWx0ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXN1bHQg\nPSBuZXcgQXJyYXlMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4oX3Jlc3VsdHMu\nc2l6ZSgpIC0gaSk7CiAgICAgICAgICAgIHJlc3VsdC5hZGQoZWxlbWVudCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiAocmVzdWx0ID09IG51bGwpCiAg\nICAgICAgICAgID8gKExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPikgQ29sbGVj\ndGlvbnMuRU1QVFlfTElTVCA6IHJlc3VsdDsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVN5c3RlbU1hcHBpbmdF\nbGVtZW50KE9iamVjdCBvYmopCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFF1ZXJ5UmVzdWx0TWFw\ncGluZykKICAgICAgICAgICAgc2VyaWFsaXplUXVlcnlSZXN1bHRNYXBwaW5n\nKChRdWVyeVJlc3VsdE1hcHBpbmcpIG9iaik7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVRdWVyeU1hcHBpbmdz\nKENsYXNzTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0\naW9uIHsKICAgICAgICBmb3IgKFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgOiBn\nZXRRdWVyeVJlc3VsdE1hcHBpbmdzKG1ldGEpKQogICAgICAgICAgICBzZXJp\nYWxpemVRdWVyeVJlc3VsdE1hcHBpbmcocmVzKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNlcmlhbGl6ZSBnaXZlbiByZXN1bHQgc2V0IG1hcHBpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxpemVRdWVyeVJlc3VsdE1h\ncHBpbmcoUXVlcnlSZXN1bHRNYXBwaW5nIG1ldGEpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFnZXRTZXJpYWxpemVBbm5v\ndGF0aW9ucygpCiAgICAgICAgICAgICYmIG1ldGEuZ2V0U291cmNlVHlwZSgp\nID09IG1ldGEuU1JDX0FOTk9UQVRJT05TKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIG1ldGEuZ2V0TmFtZSgp\nKTsKICAgICAgICBzdGFydEVsZW1lbnQoInNxbC1yZXN1bHQtc2V0LW1hcHBp\nbmciKTsKICAgICAgICBmb3IgKFF1ZXJ5UmVzdWx0TWFwcGluZy5QQ1Jlc3Vs\ndCBwYyA6IG1ldGEuZ2V0UENSZXN1bHRzKCkpIHsKICAgICAgICAgICAgYWRk\nQXR0cmlidXRlKCJlbnRpdHktY2xhc3MiLCBwYy5nZXRDYW5kaWRhdGVUeXBl\nKCkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgT2JqZWN0IGRpc2NyaW0gPSBw\nYy5nZXRNYXBwaW5nKHBjLkRJU0NSSU1JTkFUT1IpOwogICAgICAgICAgICBp\nZiAoZGlzY3JpbSAhPSBudWxsKQogICAgICAgICAgICAgICAgYWRkQXR0cmli\ndXRlKCJkaXNjcmltaW5hdG9yLWNvbHVtbiIsIGRpc2NyaW0udG9TdHJpbmco\nKSk7CgogICAgICAgICAgICBzdGFydEVsZW1lbnQoImVudGl0eS1yZXN1bHQi\nKTsKICAgICAgICAgICAgZm9yIChTdHJpbmcgcGF0aCA6IHBjLmdldE1hcHBp\nbmdQYXRocygpKSB7CiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5h\nbWUiLCBwYXRoKTsKICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgiY29s\ndW1uIiwgcGMuZ2V0TWFwcGluZyhwYXRoKS50b1N0cmluZygpKTsKICAgICAg\nICAgICAgICAgIHN0YXJ0RWxlbWVudCgiZmllbGQtcmVzdWx0Iik7CiAgICAg\nICAgICAgICAgICBlbmRFbGVtZW50KCJmaWVsZC1yZXN1bHQiKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBlbmRFbGVtZW50KCJlbnRpdHktcmVzdWx0\nIik7CiAgICAgICAgfQogICAgICAgIGZvciAoT2JqZWN0IGNvbCA6IG1ldGEu\nZ2V0Q29sdW1uUmVzdWx0cygpKSB7CiAgICAgICAgICAgIGFkZEF0dHJpYnV0\nZSgibmFtZSIsIGNvbC50b1N0cmluZygpKTsKICAgICAgICAgICAgc3RhcnRF\nbGVtZW50KCJjb2x1bW4tcmVzdWx0Iik7CiAgICAgICAgICAgIGVuZEVsZW1l\nbnQoImNvbHVtbi1yZXN1bHQiKTsKICAgICAgICB9CiAgICAgICAgZW5kRWxl\nbWVudCgic3FsLXJlc3VsdC1zZXQtbWFwcGluZyIpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU2VxdWVuY2Uo\nU2VxdWVuY2VNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIGlmICghZ2V0U2VyaWFsaXplQW5ub3RhdGlvbnMo\nKQogICAgICAgICAgICAmJiBtZXRhLmdldFNvdXJjZVR5cGUoKSA9PSBtZXRh\nLlNSQ19BTk5PVEFUSU9OUykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIGlmIChTZXF1ZW5jZU1hcHBpbmcuSU1QTF9WQUxVRV9UQUJMRS5lcXVhbHMo\nbWV0YS5nZXRTZXF1ZW5jZVBsdWdpbigpKSkgewogICAgICAgICAgICBzdXBl\nci5zZXJpYWxpemVTZXF1ZW5jZShtZXRhKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgU2VxdWVuY2VNYXBwaW5nIHNlcSA9IChT\nZXF1ZW5jZU1hcHBpbmcpIG1ldGE7CiAgICAgICAgYWRkQXR0cmlidXRlKCJu\nYW1lIiwgc2VxLmdldE5hbWUoKSk7CiAgICAgICAgU3RyaW5nIHRhYmxlID0g\nc2VxLmdldFRhYmxlKCk7CiAgICAgICAgaWYgKHRhYmxlICE9IG51bGwpIHsK\nICAgICAgICAgICAgaW50IGRvdElkeCA9IHRhYmxlLmluZGV4T2YoJy4nKTsK\nICAgICAgICAgICAgaWYgKGRvdElkeCA9PSAtMSkKICAgICAgICAgICAgICAg\nIGFkZEF0dHJpYnV0ZSgidGFibGUiLCB0YWJsZSk7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJ0YWJsZSIsIHRh\nYmxlLnN1YnN0cmluZyhkb3RJZHggKyAxKSk7CiAgICAgICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoInNjaGVtYSIsIHRhYmxlLnN1YnN0cmluZygwLCBkb3RJ\nZHgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoc2VxLmdldFByaW1hcnlLZXlDb2x1bW4oKSkp\nCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgicGstY29sdW1uLW5hbWUiLCBz\nZXEuZ2V0UHJpbWFyeUtleUNvbHVtbigpKTsKICAgICAgICBpZiAoIVN0cmlu\nZ1V0aWxzLmlzRW1wdHkoc2VxLmdldFNlcXVlbmNlQ29sdW1uKCkpKQogICAg\nICAgICAgICBhZGRBdHRyaWJ1dGUoInZhbHVlLWNvbHVtbi1uYW1lIiwgc2Vx\nLmdldFNlcXVlbmNlQ29sdW1uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShzZXEuZ2V0UHJpbWFyeUtleVZhbHVlKCkpKQogICAgICAg\nICAgICBhZGRBdHRyaWJ1dGUoInBrLWNvbHVtbi12YWx1ZSIsIHNlcS5nZXRQ\ncmltYXJ5S2V5VmFsdWUoKSk7CiAgICAgICAgaWYgKHNlcS5nZXRBbGxvY2F0\nZSgpICE9IDUwICYmIHNlcS5nZXRBbGxvY2F0ZSgpICE9IC0xKQogICAgICAg\nICAgICBhZGRBdHRyaWJ1dGUoImFsbG9jYXRpb24tc2l6ZSIsIHNlcS5nZXRB\nbGxvY2F0ZSgpICsgIiIpOwogICAgICAgIGlmIChzZXEuZ2V0SW5pdGlhbFZh\nbHVlKCkgIT0gMCAmJiBzZXEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gLTEpCiAg\nICAgICAgICAgIGFkZEF0dHJpYnV0ZSgiaW5pdGlhbC12YWx1ZSIsIHNlcS5n\nZXRJbml0aWFsVmFsdWUoKSArICIiKTsKICAgICAgICBzdGFydEVsZW1lbnQo\nInRhYmxlLWdlbmVyYXRvciIpOwogICAgICAgIGVuZEVsZW1lbnQoInRhYmxl\nLWdlbmVyYXRvciIpOwogICAgfQoKICAgIC8qKgogICAgICogQ29sdW1uIHR5\ncGVzIHNlcmlhbGl6ZWQgdW5kZXIgZGlmZmVyZW50IG5hbWVzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBlbnVtIENvbFR5cGUgewoKICAgICAgICBD\nT0wsCiAgICAgICAgSk9JTiwKICAgICAgICBJTlZFUlNFLAogICAgICAgIFBL\nX0pPSU4sCiAgICAgICAgRElTQwogICAgfQoKICAgIC8qKgogICAgICogRXh0\nZW5kcyB7QGxpbmsgU2VyaWFsaXphdGlvbkNvbXBhcmF0b3J9IGZvciBzdG9y\nZS1zcGVjaWZpYyB0YWdzIHN1Y2gKICAgICAqIGFzICZsdDtzcWwtcmVzdWx0\nLXNldC1tYXBwaW5nJmd0Oy4KICAgICAqCiAgICAgKiBAYXV0aG9yIFBpbmFr\naSBQb2RkYXIKICAgICAqLwogICAgcHJvdGVjdGVkIGNsYXNzIE1hcHBpbmdT\nZXJpYWxpemF0aW9uQ29tcGFyYXRvcgogICAgICAgIGV4dGVuZHMgU2VyaWFs\naXphdGlvbkNvbXBhcmF0b3IgewoKICAgICAgICBwcm90ZWN0ZWQgaW50IGNv\nbXBhcmVVbmtub3duKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAg\nICAgIGlmICghKG8xIGluc3RhbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5jb21wYXJlVW5rbm93bihv\nMSwgbzIpOwoKICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlczEg\nPSAoUXVlcnlSZXN1bHRNYXBwaW5nKSBvMTsKICAgICAgICAgICAgUXVlcnlS\nZXN1bHRNYXBwaW5nIHJlczIgPSAoUXVlcnlSZXN1bHRNYXBwaW5nKSBvMjsK\nCiAgICAgICAgICAgIC8vIHN5c3RlbSBzY29wZSBiZWZvcmUgY2xhc3Mgc2Nv\ncGUKICAgICAgICAgICAgT2JqZWN0IHNjb3BlMSA9IHJlczEuZ2V0U291cmNl\nU2NvcGUoKTsKICAgICAgICAgICAgT2JqZWN0IHNjb3BlMiA9IHJlczIuZ2V0\nU291cmNlU2NvcGUoKTsKICAgICAgICAgICAgaWYgKHNjb3BlMSA9PSBudWxs\nICYmIHNjb3BlMiAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIC0x\nOwogICAgICAgICAgICBpZiAoc2NvcGUxICE9IG51bGwgJiYgc2NvcGUyID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKCiAgICAgICAgICAg\nIC8vIGNvbXBhcmUgb24gbGlzdGluZyBpbmRleCwgb3IgaWYgbm9uZS9zYW1l\nLCB1c2UgbmFtZQogICAgICAgICAgICBpbnQgbGlzdGluZ0luZGV4MSA9IHJl\nczEuZ2V0TGlzdGluZ0luZGV4KCk7CiAgICAgICAgICAgIGludCBsaXN0aW5n\nSW5kZXgyID0gcmVzMi5nZXRMaXN0aW5nSW5kZXgoKTsKICAgICAgICAgICAg\naWYgKGxpc3RpbmdJbmRleDEgIT0gbGlzdGluZ0luZGV4MikKICAgICAgICAg\nICAgICAgIHJldHVybiBsaXN0aW5nSW5kZXgxIC0gbGlzdGluZ0luZGV4MjsK\nICAgICAgICAgICAgcmV0dXJuIHJlczEuZ2V0TmFtZSAoKS5jb21wYXJlVG8g\nKHJlczIuZ2V0TmFtZSAoKSk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

