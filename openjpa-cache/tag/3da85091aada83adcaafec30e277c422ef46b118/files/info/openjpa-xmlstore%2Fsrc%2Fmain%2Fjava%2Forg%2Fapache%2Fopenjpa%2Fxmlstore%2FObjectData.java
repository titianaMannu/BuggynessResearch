{"sha":"6c96ffb2c44fb1d10773b077c1939067812ab2fb","node_id":"MDQ6QmxvYjIwNjM2NDo2Yzk2ZmZiMmM0NGZiMWQxMDc3M2IwNzdjMTkzOTA2NzgxMmFiMmZi","size":13949,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6c96ffb2c44fb1d10773b077c1939067812ab2fb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEueG1sc3RvcmU7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuQXJyYXk7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmV2ZW50Lk9ycGhhbmVkS2V5QWN0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29u\ndGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5\ncGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBJbi1t\nZW1vcnkgZm9ybSBvZiBkYXRhIGluIGRhdGFzdG9yZSBiYWNraW5nIGEgc2lu\nZ2xlIHBlcnNpc3RlbnQgb2JqZWN0LgogKi8KcHVibGljIGZpbmFsIGNsYXNz\nIE9iamVjdERhdGEKICAgIGltcGxlbWVudHMgQ2xvbmVhYmxlIHsKCiAgICBw\ncml2YXRlIE9iamVjdCBfb2lkOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZGF0\nYTsKICAgIHByaXZhdGUgTG9uZyBfdmVyc2lvbjsKICAgIHByaXZhdGUgQ2xh\nc3NNZXRhRGF0YSBfbWV0YTsKCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUg\nb2JqZWN0IHdpdGhvdXQgdW5kZXJseWluZyBkYXRhLiBKdXN0IHBhc3MgaW4g\ndHlwZSBzcGVjaWZpYwogICAgICogbWV0YWRhdGEgYW5kIHRoZSBvaWQuCiAg\nICAgKi8KICAgIHB1YmxpYyBPYmplY3REYXRhKE9iamVjdCBvaWQsIENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9vaWQgPSBvaWQ7CiAgICAgICAg\nX21ldGEgPSBtZXRhOwogICAgICAgIF9kYXRhID0gbmV3IE9iamVjdFttZXRh\nLmdldEZpZWxkcygpLmxlbmd0aF07CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZXR0ZXIgZm9yIG9pZC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRJ\nZCgpIHsKICAgICAgICByZXR1cm4gX29pZDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgZGF0YSBmb3IgdGhlIGZpZWxkIHdpdGggdGhlIGdpdmVu\nIGluZGV4LgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldEZpZWxkKGlu\ndCBudW0pIHsKICAgICAgICByZXR1cm4gX2RhdGFbbnVtXTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZGF0YSBmb3IgdGhlIGZpZWxkIHdpdGgg\ndGhlIGdpdmVuIGluZGV4LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRG\naWVsZChpbnQgbnVtLCBPYmplY3QgdmFsKSB7CiAgICAgICAgX2RhdGFbbnVt\nXSA9IHZhbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgdmVyc2lv\nbiBudW1iZXIgb2YgdGhlIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0VmVyc2lvbihMb25nIHZlcnNpb24pIHsKICAgICAgICBfdmVyc2lv\nbiA9IHZlcnNpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZl\ncnNpb24gbnVtYmVyIG9mIHRoZSBvYmplY3QuCiAgICAgKi8KICAgIHB1Ymxp\nYyBMb25nIGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF92ZXJzaW9u\nOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBtZXRhZGF0YSBhc3Nv\nY2lhdGVkIHdpdGggdGhlIHR5cGUgb2YgcGVyc2lzdGVudCBvYmplY3QgZm9y\nCiAgICAgKiB3aGljaCB0aGlzIGRhdGEgYXBwbGllcy4KICAgICAqLwogICAg\ncHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAgICAgICAg\ncmV0dXJuIF9tZXRhOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUg\nZGF0YSBhbmQgdmVyc2lvbiBpbmZvcm1hdGlvbiBmb3IgdGhpcyBvYmplY3Qg\naW50byB0aGUKICAgICAqIGdpdmVuIHN0YXRlIG1hbmFnZXIuIE9ubHkgZmll\nbGRzIGluIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1cmF0aW9uIGFyZQogICAg\nICogbG9hZGVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIGlmIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgc20uc2V0VmVyc2lvbihfdmVyc2lvbik7CgogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoIXNtLmdldExvYWRlZCgpLmdldChpKSAmJiBmZXRjaC5yZXF1\naXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAgICAgICAgIT0gRmV0Y2hD\nb25maWd1cmF0aW9uLkZFVENIX05PTkUpCiAgICAgICAgICAgICAgICBzbS5z\ndG9yZShpLCB0b0xvYWRhYmxlKHNtLCBmbWRzW2ldLCBfZGF0YVtpXSwgZmV0\nY2gpKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGRhdGEgYW5k\nIHZlcnNpb24gaW5mb3JtYXRpb24gZm9yIHRoaXMgb2JqZWN0IGludG8gdGhl\nCiAgICAgKiBnaXZlbiBzdGF0ZSBtYW5hZ2VyLiBPbmx5IGZpZWxkcyBpbiB0\naGUgZ2l2ZW4gYml0IHNldCB3aWxsIGJlIGxvYWRlZC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRT\nZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIGlmIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgc20uc2V0VmVyc2lvbihfdmVyc2lvbik7CgogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoZmllbGRzLmdldChpKSkKICAgICAgICAgICAgICAgIHNtLnN0\nb3JlKGksIHRvTG9hZGFibGUoc20sIGZtZHNbaV0sIF9kYXRhW2ldLCBmZXRj\naCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3RvcmVk\nIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4gaW50byBhIHZhbHVlIGZvciBsb2Fk\naW5nCiAgICAgKiBpbnRvIGEgc3RhdGUgbWFuYWdlci4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRvTG9hZGFibGUoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCwgT2JqZWN0\nIHZhbCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgQ29sbGVjdGlvbiBjOwogICAgICAgIHN3aXRjaCAoZm1kLmdldFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIC8vIHRoZSBzdG9yZWQgdmFsdWUgbXVzdCBi\nZSBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgICAgIGMgPSAoQ29sbGVjdGlv\nbikgdmFsOwoKICAgICAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSBtYW5hZ2Vy\nIHdpbGwgY3JlYXRlIGEgcHJveHkgY29sbGVjdGlvbiBvZiB0aGUgbmVlZGVk\nCiAgICAgICAgICAgICAgICAvLyB0eXBlIGRlcGVuZGluZyBvbiB0aGUgZGVj\nbGFyZWQgdHlwZSBvZiB0aGUgdXNlcidzIGZpZWxkOyB0aGUKICAgICAgICAg\nICAgICAgIC8vIHByb3h5IHdpbGwgcGVyZm9ybSBkaXJ0eSB0cmFja2luZywg\nZXRjCiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGMyID0gKENvbGxlY3Rp\nb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwoKICAgICAg\nICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBwcm94eSBjb2xsZWN0aW9uIHdp\ndGggb3VyIHN0b3JlZCBkYXRhLCBjb252ZXJ0aW5nCiAgICAgICAgICAgICAg\nICAvLyBpdCB0byB0aGUgcmlnaHQgdHlwZSBmcm9tIGl0cyBzdG9yZWQgZm9y\nbQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIGMy\nLmFkZCh0b05lc3RlZExvYWRhYmxlKHNtLCBmbWQuZ2V0RWxlbWVudCgpLCBp\ndHIubmV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaCkpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGMyOwoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAvLyB0aGUgc3RvcmVk\nIHZhbHVlIG11c3QgYmUgYSBjb2xsZWN0aW9uOyB3ZSBwdXQgYXJyYXlzIGlu\ndG8KICAgICAgICAgICAgICAgIC8vIGNvbGxlY3Rpb25zIGZvciBzdG9yYWdl\nCiAgICAgICAgICAgICAgICBjID0gKENvbGxlY3Rpb24pIHZhbDsKCiAgICAg\nICAgICAgICAgICAvLyBjcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHJpZ2h0\nIHR5cGU7IHVubGlrZSBjb2xsZWN0aW9ucyBpbgogICAgICAgICAgICAgICAg\nLy8gdGhlIGNhc2UgYWJvdmUsIGFycmF5cyBjYW5ub3QgYmUgcHJveGllZAog\nICAgICAgICAgICAgICAgT2JqZWN0IGEgPSBBcnJheS5uZXdJbnN0YW5jZShm\nbWQuZ2V0RWxlbWVudCgpLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICBjLnNpemUoKSk7CgogICAgICAgICAgICAgICAgLy8gcG9wdWxhdGUgdGhl\nIGFycmF5IHdpdGggb3VyIHN0b3JlZCBkYXRhLCBjb252ZXJ0aW5nIGl0IHRv\nIHRoZQogICAgICAgICAgICAgICAgLy8gcmlnaHQgdHlwZSBmcm9tIGl0cyBz\ndG9yZWQgZm9ybQogICAgICAgICAgICAgICAgaW50IGlkeCA9IDA7CiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAgICAgICAgICAgICAgQXJy\nYXkuc2V0KGEsIGlkeCwgdG9OZXN0ZWRMb2FkYWJsZShzbSwgZm1kLmdldEVs\nZW1lbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaXRyLm5leHQoKSwg\nZmV0Y2gpKTsKICAgICAgICAgICAgICAgIHJldHVybiBhOwoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgLy8gdGhl\nIHN0b3JlZCB2YWx1ZSBtdXN0IGJlIGEgbWFwCiAgICAgICAgICAgICAgICBN\nYXAgbSA9IChNYXApIHZhbDsKCiAgICAgICAgICAgICAgICAvLyB0aGUgc3Rh\ndGUgbWFuYWdlciB3aWxsIGNyZWF0ZSBhIHByb3h5IG1hcCBvZiB0aGUgbmVl\nZGVkCiAgICAgICAgICAgICAgICAvLyB0eXBlIGRlcGVuZGluZyBvbiB0aGUg\nZGVjbGFyZWQgdHlwZSBvZiB0aGUgdXNlcidzIGZpZWxkOyB0aGUKICAgICAg\nICAgICAgICAgIC8vIHByb3h5IHdpbGwgcGVyZm9ybSBkaXJ0eSB0cmFja2lu\nZywgZXRjCiAgICAgICAgICAgICAgICBNYXAgbTIgPSAoTWFwKSBzbS5uZXdG\naWVsZFByb3h5KGZtZC5nZXRJbmRleCgpKTsKCiAgICAgICAgICAgICAgICAv\nLyBwb3B1bGF0ZSB0aGUgcHJveHkgbWFwIHdpdGggb3VyIHN0b3JlZCBkYXRh\nLCBjb252ZXJ0aW5nCiAgICAgICAgICAgICAgICAvLyBpdCB0byB0aGUgcmln\naHQgdHlwZSBmcm9tIGl0cyBzdG9yZWQgZm9ybQogICAgICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBtLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBNYXAuRW50\ncnkgZSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICAgICAgbTIucHV0KHRvTmVzdGVkTG9hZGFibGUoc20sIGZtZC5nZXRLZXko\nKSwgZS5nZXRLZXkoKSxmZXRjaCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHRvTmVzdGVkTG9hZGFibGUoc20sIGZtZC5nZXRFbGVtZW50KCksIGUuZ2V0\nVmFsdWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbTI7\nCgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8ganVz\ndCBjb252ZXJ0IHRoZSBzdG9yZWQgdmFsdWUgaW50byBpdHMgbG9hZGFibGUg\nZXF1aXZhbGVudC4KICAgICAgICAgICAgICAgIHJldHVybiB0b05lc3RlZExv\nYWRhYmxlKHNtLCBmbWQsIHZhbCwgZmV0Y2gpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIHN0b3JlZCB2YWx1\nZSA8Y29kZT52YWw8L2NvZGU+IHRvIGEgdmFsdWUgZm9yIGxvYWRpbmcKICAg\nICAqIGludG8gYSBzdGF0ZSBtYW5hZ2VyLiBUaGUgdmFsdWUgPGNvZGU+dmFs\nPC9jb2RlPiBtdXN0IGJlIGEgc2luZ3VsYXIKICAgICAqIHZhbHVlOyBpdCBj\nYW5ub3QgYmUgYSBjb250YWluZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIE9iamVjdCB0b05lc3RlZExvYWRhYmxlKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCB2YWws\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmICh2YWwg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3\naXRjaCAodm1kLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgLy8gY2xv\nbmUgdGhlIGRhdGUgdG8gcHJldmVudCBkaXJlY3QgbW9kaWZpY2F0aW9uIG9m\nIG91ciBzdG9yZWQgdmFsdWUKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nREFURToKICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIHZhbCkuY2xv\nbmUoKTsKCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAg\nICAgLy8gZm9yIHJlbGF0aW9ucyB0byBvdGhlciBwZXJzaXN0ZW50IG9iamVj\ndHMsIHdlIHN0b3JlIHRoZSByZWxhdGVkCiAgICAgICAgICAgICAgICAvLyBv\nYmplY3QncyBvaWQgLS0gY29udmVydCBpdCBiYWNrIGludG8gYSBwZXJzaXN0\nZW50IGluc3RhbmNlCiAgICAgICAgICAgICAgICBTdG9yZUNvbnRleHQgY3R4\nID0gc20uZ2V0Q29udGV4dCgpOwogICAgICAgICAgICAgICAgT2JqZWN0IHBj\nID0gY3R4LmZpbmQodmFsLCBmZXRjaCwgbnVsbCwgbnVsbCwgMCk7CiAgICAg\nICAgICAgICAgICBpZiAocGMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gcGM7CiAgICAgICAgICAgICAgICBPcnBoYW5lZEtleUFjdGlv\nbiBhY3Rpb24gPSBjdHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAg\nICAgICAgICAgIGdldE9ycGhhbmVkS2V5QWN0aW9uSW5zdGFuY2UoKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBhY3Rpb24ub3JwaGFuKHZhbCwgc20sIHZt\nZCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gdmFsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3Jl\nIHRoZSBkYXRhIGFuZCB2ZXJzaW9uIGluZm9ybWF0aW9uIGZvciB0aGlzIG9i\namVjdCBmcm9tIHRoZQogICAgICogZ2l2ZW4gc3RhdGUgbWFuYWdlci4gT25s\neSBkaXJ0eSBmaWVsZHMgd2lsbCBiZSBzdG9yZWQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHN0b3JlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAg\nICAgICBfdmVyc2lvbiA9IChMb25nKSBzbS5nZXRWZXJzaW9uKCk7CgogICAg\nICAgIC8vIGlmIHRoZSB2ZXJzaW9uIGhhcyBub3QgYmVlbiBzZXQgaW4gdGhl\nIHN0YXRlIG1hbmFnZXIgKG9ubHkgdHJ1ZQogICAgICAgIC8vIHdoZW4gdGhl\nIG9iamVjdCBpcyBuZXcpLCBzZXQgdGhlIHZlcnNpb24gbnVtYmVyIHRvIDAK\nICAgICAgICBpZiAoX3ZlcnNpb24gPT0gbnVsbCkKICAgICAgICAgICAgX3Zl\ncnNpb24gPSBOdW1iZXJzLnZhbHVlT2YoMEwpOwoKICAgICAgICAvLyBydW4g\ndGhyb3VnaCBlYWNoIHBlcnNpc3RlbnQgZmllbGQgaW4gdGhlIHN0YXRlIG1h\nbmFnZXIgYW5kIHN0b3JlIGl0CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHNt\nLmdldERpcnR5KCkuZ2V0KGkpCiAgICAgICAgICAgICAgICAmJiBmbWRzW2ld\nLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRzW2ldLk1BTkFHRV9QRVJTSVNURU5U\nKQogICAgICAgICAgICAgICAgX2RhdGFbaV0gPSB0b1N0b3JhYmxlKGZtZHNb\naV0sIHNtLmZldGNoKGkpLCBzbS5nZXRDb250ZXh0KCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIGZpZWxk\nIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4gdG8gYSBmb3JtIHdlIGNhbiBzdG9y\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRvU3RvcmFi\nbGUoRmllbGRNZXRhRGF0YSBmbWQsIE9iamVjdCB2YWwsCiAgICAgICAgU3Rv\ncmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbGxlY3Rpb24gYzsK\nICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAg\nICBjID0gKENvbGxlY3Rpb24pIHZhbDsKCiAgICAgICAgICAgICAgICAvLyBj\ncmVhdGUgYSBjb2xsZWN0aW9uIHRvIGNvcHkgdGhlIGVsZW1lbnRzIGludG8g\nZm9yIHN0b3JhZ2UsIGFuZAogICAgICAgICAgICAgICAgLy8gcG9wdWxhdGUg\naXQgd2l0aCBjb252ZXJ0ZWQgZWxlbWVudCB2YWx1ZXMKICAgICAgICAgICAg\nICAgIENvbGxlY3Rpb24gYzIgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgYzIuYWRkKHRvTmVz\ndGVkU3RvcmFibGUoZm1kLmdldEVsZW1lbnQoKSwgaXRyLm5leHQoKSwgY3R4\nKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYzI7CgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIC8vIGNyZWF0\nZSBhIGNvbGxlY3Rpb24gdG8gY29weSB0aGUgZWxlbWVudHMgaW50byBmb3Ig\nc3RvcmFnZSwgYW5kCiAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSBpdCB3\naXRoIGNvbnZlcnRlZCBlbGVtZW50IHZhbHVlcwogICAgICAgICAgICAgICAg\nYyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwLCBsZW4gPSBBcnJheS5nZXRMZW5ndGgodmFsKTsgaSA8IGxlbjsg\naSsrKQogICAgICAgICAgICAgICAgICAgIGMuYWRkKHRvTmVzdGVkU3RvcmFi\nbGUoZm1kLmdldEVsZW1lbnQoKSwgQXJyYXkuZ2V0KHZhbCwgaSksCiAgICAg\nICAgICAgICAgICAgICAgICAgIGN0eCkpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGM7CgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICBNYXAgbSA9IChNYXApIHZhbDsKCiAgICAgICAgICAgICAg\nICAvLyBjcmVhdGUgYSBtYXAgdG8gY29weSB0aGUgZW50cmllcyBpbnRvIGZv\nciBzdG9yYWdlLCBhbmQKICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIGl0\nIHdpdGggY29udmVydGVkIGVudHJ5IHZhbHVlcwogICAgICAgICAgICAgICAg\nTWFwIG0yID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gbS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgTWFwLkVudHJ5IGUg\nPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAg\nIG0yLnB1dCh0b05lc3RlZFN0b3JhYmxlKGZtZC5nZXRLZXkoKSwgZS5nZXRL\nZXkoKSwgY3R4KSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9OZXN0ZWRT\ndG9yYWJsZShmbWQuZ2V0RWxlbWVudCgpLCBlLmdldFZhbHVlKCksIGN0eCkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG0y\nOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIGp1\nc3QgY29udmVydCB0aGUgbG9hZGVkIHZhbHVlIGludG8gaXRzIHN0b3JhYmxl\nIGVxdWl2YWxlbnQKICAgICAgICAgICAgICAgIHJldHVybiB0b05lc3RlZFN0\nb3JhYmxlKGZtZCwgdmFsLCBjdHgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIGxvYWRlZCB2YWx1ZSA8Y29k\nZT52YWw8L2NvZGU+IHRvIGEgdmFsdWUgZm9yIHN0b3JpbmcuCiAgICAgKiBU\naGUgdmFsdWUgPGNvZGU+dmFsPC9jb2RlPiBtdXN0IGJlIGEgc2luZ3VsYXIg\ndmFsdWU7IGl0IGNhbm5vdCBiZSBhCiAgICAgKiBjb250YWluZXIuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0b05lc3RlZFN0b3JhYmxl\nKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3QgdmFsLAogICAgICAgIFN0b3Jl\nQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBzd2l0Y2ggKHZtZC5nZXRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6\nCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZGF0ZSBpcyBhIHByb3h5IChz\naW5jZSBEYXRlcyBhcmUgc2Vjb25kIGNsYXNzCiAgICAgICAgICAgICAgICAv\nLyBvYmplY3RzIChTQ09zKSB0aGV5IGNhbiBiZSBwcm94aWVkIGZvciBkaXJ0\neSB0cmFja2luZywKICAgICAgICAgICAgICAgIC8vIGV0YykgdGhlbiBjb3B5\nIHRoZSB2YWx1ZSBvdXQgb2YgaXQgZm9yIHN0b3JhZ2UKICAgICAgICAgICAg\nICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKChQcm94eSkgdmFsKS5jb3B5KHZhbCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gKChEYXRlKSB2YWwpLmNsb25lKCk7CgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIHJldHVybiBjdHgu\nZ2V0T2JqZWN0SWQodmFsKTsKCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZ\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAg\nICAgICAvLyBuZXN0ZWQgcmVsYXRpb24gdHlwZXMgKGUuZy4gY29sbGVjdGlv\nbnMgb2YgY29sbGVjdGlvbnMpCiAgICAgICAgICAgICAgICAvLyBhcmUgbm90\nIGN1cnJlbnRseSBzdXBwb3J0ZWQKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigiVGhpcyBzdG9yZSBkb2VzIG5vdCBz\ndXBwb3J0ICIKICAgICAgICAgICAgICAgICAgICArICJuZXN0ZWQgY29udGFp\nbmVycyAoZS5nLiBjb2xsZWN0aW9ucyBvZiBjb2xsZWN0aW9ucykuIik7Cgog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZh\nbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9uZSB0aGlz\nIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7CiAg\nICAgICAgT2JqZWN0RGF0YSBkYXRhID0gbmV3IE9iamVjdERhdGEoX29pZCwg\nX21ldGEpOwogICAgICAgIGRhdGEuc2V0VmVyc2lvbihfdmVyc2lvbik7Cgog\nICAgICAgIC8vIGNvcHkgZWFjaCBmaWVsZAogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIE9iamVjdCB2YWwgPSBfZGF0YVtpXTsKICAgICAgICAgICAgaWYgKHZhbCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRhLnNldEZpZWxkKGksIG51\nbGwpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICAgICAgZGF0YS5zZXRGaWVsZChpLCBuZXcgQXJyYXlMaXN0KChD\nb2xsZWN0aW9uKSB2YWwpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgICAgICBkYXRhLnNldEZpZWxkKGksIG5ldyBIYXNoTWFwKChNYXAp\nIHZhbCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBkYXRhLnNldEZp\nZWxkKGksIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGRhdGE7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmlu\nZygpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1\nZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNsYXNzOiAoIiArIF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkgKyAiKVxuIik7CiAgICAg\nICAgYnVmLmFwcGVuZCgiT2JqZWN0IElkOiAoIiArIF9vaWQgKyAiKVxuIik7\nCiAgICAgICAgYnVmLmFwcGVuZCgiVmVyc2lvbjogKCIgKyBfdmVyc2lvbiAr\nICIpXG4iKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRh\nLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBidWYuYXBwZW5kKCIgIEZp\nZWxkOiAoIiArIGkgKyAiKVxuIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiAgTmFtZTogKCIgKyBmbWRzW2ldLmdldE5hbWUoKSArICIpXG4iKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiICBWYWx1ZTogKCIgKyBfZGF0YVtpXSAr\nICIpXG4iKTsKCQl9CgkJcmV0dXJuIGJ1Zi50b1N0cmluZyAoKTsKCX0KfQo=\n","encoding":"base64"}

