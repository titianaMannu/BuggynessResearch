{"sha":"8fed879bb415e2c1a1e5b4f59cdd983003550d12","node_id":"MDQ6QmxvYjIwNjM2NDo4ZmVkODc5YmI0MTVlMmMxYTFlNWI0ZjU5Y2RkOTgzMDAzNTUwZDEy","size":22279,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8fed879bb415e2c1a1e5b4f59cdd983003550d12","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbDsNCg0KaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247DQppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEudXRpbC5D\nb2xsZWN0aW9uOw0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOw0KaW1wb3J0\nIGphdmEudXRpbC5JdGVyYXRvcjsNCmltcG9ydCBqYXZhLnV0aWwuTGlua2Vk\nTGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsNCmltcG9ydCBqYXZhLnV0\naWwuTWFwOw0KDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5DbGFzc01hcHBpbmc7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkNvbHVtbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuRm9yZWlnbktleTsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlByaW1hcnlSb3c7DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlJvdzsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuUm93SW1wbDsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlckltcGw7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuZ3JhcGguRGVw\ndGhGaXJzdEFuYWx5c2lzOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuZ3JhcGguRWRnZTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmdyYXBoLkdyYXBoOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW50ZXJuYWxFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOw0KDQovKioNCiAqIDxwPlN0\nYW5kYXJkIHVwZGF0ZSBtYW5hZ2VyLCBjYXBhYmxlIG9mIGZvcmVpZ24ga2V5\nIGNvbnN0cmFpbnQgZXZhbHVhdGlvbi48L3A+DQogKg0KICogQHNpbmNlIDEu\nMC4wDQogKi8NCnB1YmxpYyBjbGFzcyBDb25zdHJhaW50VXBkYXRlTWFuYWdl\ncg0KICAgIGV4dGVuZHMgQWJzdHJhY3RVcGRhdGVNYW5hZ2VyIHsNCg0KICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UNCiAgICAgICAgKENvbnN0cmFpbnRVcGRhdGVNYW5h\nZ2VyLmNsYXNzKTsNCg0KICAgIHB1YmxpYyBib29sZWFuIG9yZGVyRGlydHko\nKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBwcm90\nZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VyIG5ld1ByZXBhcmVkU3Rh\ndGVtZW50TWFuYWdlcg0KICAgICAgICAoSkRCQ1N0b3JlIHN0b3JlLCBDb25u\nZWN0aW9uIGNvbm4pIHsNCiAgICAgICAgcmV0dXJuIG5ldyBQcmVwYXJlZFN0\nYXRlbWVudE1hbmFnZXJJbXBsKHN0b3JlLCBjb25uKTsNCiAgICB9DQoNCiAg\nICBwcm90ZWN0ZWQgUm93TWFuYWdlciBuZXdSb3dNYW5hZ2VyKCkgew0KICAg\nICAgICByZXR1cm4gbmV3IFJvd01hbmFnZXJJbXBsKGZhbHNlKTsNCiAgICB9\nDQoNCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBmbHVzaChSb3dNYW5hZ2Vy\nIHJvd01nciwNCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VyIHBz\nTWdyLCBDb2xsZWN0aW9uIGV4Y2Vwcykgew0KICAgICAgICBSb3dNYW5hZ2Vy\nSW1wbCBybWltcGwgPSAoUm93TWFuYWdlckltcGwpIHJvd01ncjsNCg0KICAg\nICAgICAvLyBmaXJzdCB0YWtlIGNhcmUgb2YgYWxsIHNlY29uZGFyeSB0YWJs\nZSBkZWxldGVzIGFuZCAnYWxsIHJvdycgZGVsZXRlcw0KICAgICAgICAvLyAo\nd2hpY2ggYXJlIHByb2JhYmx5IHNlY29uZGFyeSB0YWJsZSBkZWxldGVzKSwg\nc2luY2Ugbm8gZm9yZWlnbg0KICAgICAgICAvLyBrZXlzIGV2ZXIgcmVseSBv\nbiBzZWNvbmRhcnkgdGFibGUgcGtzDQogICAgICAgIGZsdXNoKHJtaW1wbC5n\nZXRBbGxSb3dEZWxldGVzKCksIHBzTWdyKTsNCiAgICAgICAgZmx1c2gocm1p\nbXBsLmdldFNlY29uZGFyeURlbGV0ZXMoKSwgcHNNZ3IpOw0KDQogICAgICAg\nIC8vIG5vdyBkbyBhbnkgJ2FsbCByb3cnIHVwZGF0ZXMNCiAgICAgICAgZmx1\nc2gocm1pbXBsLmdldEFsbFJvd1VwZGF0ZXMoKSwgcHNNZ3IpOw0KDQogICAg\nICAgIC8vIGFuYWx5emUgZm9yZWlnbiBrZXlzDQogICAgICAgIENvbGxlY3Rp\nb24gaW5zZXJ0cyA9IHJtaW1wbC5nZXRJbnNlcnRzKCk7DQogICAgICAgIENv\nbGxlY3Rpb24gdXBkYXRlcyA9IHJtaW1wbC5nZXRVcGRhdGVzKCk7DQogICAg\nICAgIENvbGxlY3Rpb24gZGVsZXRlcyA9IHJtaW1wbC5nZXREZWxldGVzKCk7\nDQogICAgICAgIEdyYXBoW10gZ3JhcGhzID0gbmV3IEdyYXBoWzJdOyAgICAv\nLyBpbnNlcnQgZ3JhcGgsIGRlbGV0ZSBncmFwaA0KICAgICAgICBhbmFseXpl\nRm9yZWlnbktleXMoaW5zZXJ0cywgdXBkYXRlcywgZGVsZXRlcywgcm1pbXBs\nLCBncmFwaHMpOw0KDQogICAgICAgIC8vIGZsdXNoIGluc2VydCBncmFwaCwg\naWYgYW55DQogICAgICAgIGJvb2xlYW4gYXV0b0Fzc2lnbiA9IHJtaW1wbC5o\nYXNBdXRvQXNzaWduQ29uc3RyYWludHMoKTsNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIGZsdXNoR3JhcGgoZ3JhcGhzWzBdLCBwc01nciwgYXV0b0Fz\nc2lnbik7DQogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgew0K\nICAgICAgICAgICAgZXhjZXBzID0gYWRkRXhjZXB0aW9uKGV4Y2VwcywgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgZGljdCkpOw0KICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICBleGNl\ncHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBrZSk7DQogICAgICAgIH0NCg0K\nICAgICAgICAvLyBmbHVzaCB0aGUgcmVzdCBvZiB0aGUgaW5zZXJ0cyBhbmQg\ndXBkYXRlczsgaW5zZXJ0cyBiZWZvcmUgdXBkYXRlcw0KICAgICAgICAvLyBi\nZWNhdXNlIHNvbWUgdXBkYXRlIGZrcyBtaWdodCByZWZlcmVuY2UgcGtzIHRo\nYXQgaGF2ZSB0byBiZSBpbnNlcnRlZA0KICAgICAgICBmbHVzaChpbnNlcnRz\nLCBwc01ncik7DQogICAgICAgIGZsdXNoKHVwZGF0ZXMsIHBzTWdyKTsNCg0K\nICAgICAgICAvLyBmbHVzaCB0aGUgZGVsZXRlIGdyYXBoLCBpZiBhbnkNCiAg\nICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGZsdXNoR3JhcGgoZ3JhcGhzWzFd\nLCBwc01nciwgYXV0b0Fzc2lnbik7DQogICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkgew0KICAgICAgICAgICAgZXhjZXBzID0gYWRkRXhjZXB0\naW9uKGV4Y2VwcywgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgZGljdCkp\nOw0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQog\nICAgICAgICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBrZSk7\nDQogICAgICAgIH0NCg0KICAgICAgICAvLyBwdXQgdGhlIHJlbWFpbmRlciBv\nZiB0aGUgZGVsZXRlcyBhZnRlciB1cGRhdGVzIGJlY2F1c2Ugc29tZSB1cGRh\ndGVzDQogICAgICAgIC8vIG1heSBiZSBudWxsaW5nIGZrcyB0byByb3dzIHRo\nYXQgYXJlIGdvaW5nIHRvIGJlIGRlbGV0ZWQNCiAgICAgICAgZmx1c2goZGVs\nZXRlcywgcHNNZ3IpOw0KDQogICAgICAgIC8vIHRha2UgY2FyZSBvZiBhbGwg\nc2Vjb25kYXJ5IHRhYmxlIGluc2VydHMgYW5kIHVwZGF0ZXMgbGFzdCwgc2lu\nY2UNCiAgICAgICAgLy8gdGhleSBtYXkgcmVseSBvbiBwcmV2aW91cyBpbnNl\ncnRzIG9yIHVwZGF0ZXMsIGJ1dCBub3RoaW5nIHJlbGllcw0KICAgICAgICAv\nLyBvbiB0aGVtDQogICAgICAgIGZsdXNoKHJtaW1wbC5nZXRTZWNvbmRhcnlV\ncGRhdGVzKCksIHBzTWdyKTsNCg0KICAgICAgICAvLyBmbHVzaCBhbnkgbGVm\ndCBvdmVyIHByZXBhcmVkIHN0YXRlbWVudHMNCiAgICAgICAgcHNNZ3IuZmx1\nc2goKTsNCiAgICAgICAgcmV0dXJuIGV4Y2VwczsNCiAgICB9DQoNCiAgICAv\nKioNCiAgICAgKiBBbmFseXplIGZvcmVpZ24ga2V5IGRlcGVuZGVuY2llcyBv\nbiB0aGUgZ2l2ZW4gcm93cw0KICAgICAqIGFuZCBjcmVhdGUgYW4gaW5zZXJ0\nIGFuZCBhIGRlbGV0ZSBncmFwaCB0byBleGVjdXRlLiAgVGhlIGluc2VydA0K\nICAgICAqIGdyYXBoIHdpbGwgYmUgZmx1c2hlZCBiZWZvcmUgYWxsIG90aGVy\nIHJvd3MsIGFuZCB0aGUgZGVsZXRlIGdyYXBoIHdpbGwNCiAgICAgKiBiZSBm\nbHVzaGVkIGFmdGVyIHRoZW0uDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lk\nIGFuYWx5emVGb3JlaWduS2V5cyhDb2xsZWN0aW9uIGluc2VydHMsIENvbGxl\nY3Rpb24gdXBkYXRlcywNCiAgICAgICAgQ29sbGVjdGlvbiBkZWxldGVzLCBS\nb3dNYW5hZ2VySW1wbCByb3dNZ3IsIEdyYXBoW10gZ3JhcGhzKSB7DQogICAg\nICAgIC8vIGlmIHRoZXJlIGFyZSBhbnkgZGVsZXRlcywgd2UgaGF2ZSB0byBt\nYXAgdGhlIGluc2VydCBvYmplY3RzIG9uIHRoZWlyDQogICAgICAgIC8vIG9p\nZHMgc28gd2UnbGwgYmUgYWJsZSB0byBkZXRlY3QgZGVsZXRlLXRoZW4taW5z\nZXJ0LXNhbWUtcGsgY2FzZXMNCiAgICAgICAgTWFwIGluc2VydE1hcCA9IG51\nbGw7DQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207DQogICAgICAg\nIGlmICghZGVsZXRlcy5pc0VtcHR5KCkgJiYgIWluc2VydHMuaXNFbXB0eSgp\nKSB7DQogICAgICAgICAgICBpbnNlcnRNYXAgPSBuZXcgSGFzaE1hcCgoaW50\nKSAoaW5zZXJ0cy5zaXplKCkgKiAxLjMzICsgMSkpOw0KICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBpbnNlcnRzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgc20gPSAoKFJvdykgaXRy\nLm5leHQoKSkuZ2V0UHJpbWFyeUtleSgpOw0KICAgICAgICAgICAgICAgIGlm\nIChzbSAhPSBudWxsICYmIHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICAgICAgaW5zZXJ0TWFwLnB1dChzbS5nZXRPYmplY3RJ\nZCgpLCBzbSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAg\nICAvLyBmaXJzdCBjb25zdHJ1Y3QgdGhlIGdyYXBoIGZvciBkZWxldGVzOyB0\naGlzIG1heSBleHBhbmQgdG8gaW5jbHVkZQ0KICAgICAgICAvLyBpbnNlcnRz\nIGFuZCB1cGRhdGVzIGFzIHdlbGwgaWYgdGhlcmUgYXJlIGFueSBpbnNlcnRz\nIHRoYXQgcmVseSBvbg0KICAgICAgICAvLyBkZWxldGVzIChkZWxldGUtdGhl\nbi1pbnNlcnQtc2FtZS1wayBjYXNlcykNCiAgICAgICAgUHJpbWFyeVJvdyBy\nb3c7DQogICAgICAgIFJvdyByb3cyOw0KICAgICAgICBGb3JlaWduS2V5W10g\nZmtzOw0KICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGZrVmFsOw0KICAg\nICAgICBib29sZWFuIGlnbm9yZVVwZGF0ZXMgPSB0cnVlOw0KICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGRlbGV0ZXMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsNCiAgICAgICAgICAgIHJvdyA9IChQcmltYXJ5Um93KSBp\ndHIubmV4dCgpOw0KICAgICAgICAgICAgaWYgKCFyb3cuaXNWYWxpZCgpKQ0K\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICByb3cy\nID0gZ2V0SW5zZXJ0Um93KGluc2VydE1hcCwgcm93TWdyLCByb3cpOw0KICAg\nICAgICAgICAgaWYgKHJvdzIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAg\nIGlnbm9yZVVwZGF0ZXMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBncmFw\naHNbMV0gPSBhZGRFZGdlKGdyYXBoc1sxXSwgKFByaW1hcnlSb3cpIHJvdzIs\nIHJvdywgbnVsbCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8v\nIG5vdyBjaGVjayB0aGlzIHJvdydzIGZrcyBhZ2FpbnN0IG90aGVyIGRlbGV0\nZXMNCiAgICAgICAgICAgIGZrcyA9IHJvdy5nZXRUYWJsZSgpLmdldEZvcmVp\nZ25LZXlzKCk7DQogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGZr\ncy5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICAgIC8vIHdoZW4gZGVs\nZXRpbmcgcmVmIGZrcyB0aGV5J2xsIGp1c3Qgc2V0IGEgd2hlcmUgdmFsdWUs\nIHNvDQogICAgICAgICAgICAgICAgLy8gY2hlY2sgYm90aCBmb3IgZmsgdXBk\nYXRlcyAocmVsYXRpb24gZmtzKSBhbmQgd2hlcmVzIChyZWYgZmtzKQ0KICAg\nICAgICAgICAgICAgIGZrVmFsID0gcm93LmdldEZvcmVpZ25LZXlTZXQoZmtz\nW2pdKTsNCiAgICAgICAgICAgICAgICBpZiAoZmtWYWwgPT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICAgICAgZmtWYWwgPSByb3cuZ2V0Rm9yZWlnbktleVdo\nZXJlKGZrc1tqXSk7DQogICAgICAgICAgICAgICAgaWYgKGZrVmFsID09IG51\nbGwpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAg\nICAgICAgICAgcm93MiA9IHJvd01nci5nZXRSb3coZmtzW2pdLmdldFByaW1h\ncnlLZXlUYWJsZSgpLA0KICAgICAgICAgICAgICAgICAgICBSb3cuQUNUSU9O\nX0RFTEVURSwgZmtWYWwsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICBpZiAo\ncm93MiAhPSBudWxsICYmIHJvdzIuaXNWYWxpZCgpICYmIHJvdzIgIT0gcm93\nKQ0KICAgICAgICAgICAgICAgICAgICBncmFwaHNbMV0gPSBhZGRFZGdlKGdy\nYXBoc1sxXSwgKFByaW1hcnlSb3cpIHJvdzIsIHJvdywNCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZrc1tqXSk7DQogICAgICAgICAgICB9DQogICAgICAg\nIH0NCg0KICAgICAgICBpZiAoaWdub3JlVXBkYXRlcykNCiAgICAgICAgICAg\nIGdyYXBoc1swXSA9IGFuYWx5emVBZ2FpbnN0SW5zZXJ0cyhpbnNlcnRzLCBy\nb3dNZ3IsIGdyYXBoc1swXSk7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAg\nICAgLy8gcHV0IGluc2VydHMgKmFuZCB1cGRhdGVzKiBpbiB0aGUgZGVsZXRl\nIGdyYXBoOyB0aGV5IGFsbCByZWx5DQogICAgICAgICAgICAvLyBvbiBlYWNo\nIG90aGVyDQogICAgICAgICAgICBncmFwaHNbMV0gPSBhbmFseXplQWdhaW5z\ndEluc2VydHModXBkYXRlcywgcm93TWdyLCBncmFwaHNbMV0pOw0KICAgICAg\nICAgICAgZ3JhcGhzWzFdID0gYW5hbHl6ZUFnYWluc3RJbnNlcnRzKGluc2Vy\ndHMsIHJvd01nciwgZ3JhcGhzWzFdKTsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBpcyBhbiBp\nbnNlcnQgZm9yIGZvciB0aGUgc2FtZSB0YWJsZSBhbmQgcHJpbWFyeQ0KICAg\nICAqIGtleSB2YWx1ZXMgYXMgdGhlIGdpdmVuIGRlbGV0ZSByb3cuDQogICAg\nICovDQogICAgcHJpdmF0ZSBSb3cgZ2V0SW5zZXJ0Um93KE1hcCBpbnNlcnRN\nYXAsIFJvd01hbmFnZXJJbXBsIHJvd01nciwgUm93IHJvdykgew0KICAgICAg\nICBpZiAoaW5zZXJ0TWFwID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsNCg0KICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gcm93\nLmdldFByaW1hcnlLZXkoKTsNCiAgICAgICAgaWYgKHNtID09IG51bGwpDQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICAvLyBsb29rIGZv\nciBhIG5ldyBvYmplY3Qgd2hvc2UgaW5zZXJ0IGlkIGlzIHRoZSBzYW1lIGFz\nIHRoaXMgZGVsZXRlIG9uZQ0KICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0\nT2JqZWN0SWQoKTsNCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBuc20g\nPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgaW5zZXJ0TWFwLmdldChvaWQpOw0K\nICAgICAgICBpZiAobnNtID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsNCg0KICAgICAgICAvLyBmb3VuZCBuZXcgb2JqZWN0OyBnZXQgaXRz\nIHJvdw0KICAgICAgICByb3cgPSByb3dNZ3IuZ2V0Um93KHJvdy5nZXRUYWJs\nZSgpLCBSb3cuQUNUSU9OX0lOU0VSVCwgbnNtLCBmYWxzZSk7DQogICAgICAg\nIHJldHVybiAocm93ID09IG51bGwgfHwgcm93LmlzVmFsaWQoKSkgPyByb3cg\nOiBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFuYWx5emUgdGhl\nIGdpdmVuIHJvd3MgYWdhaW5zdCB0aGUgaW5zZXJ0cywgcGxhY2luZyBkZXBl\nbmRlbmNpZXMNCiAgICAgKiBpbiB0aGUgZ2l2ZW4gZ3JhcGguDQogICAgICov\nDQogICAgcHJpdmF0ZSBHcmFwaCBhbmFseXplQWdhaW5zdEluc2VydHMoQ29s\nbGVjdGlvbiByb3dzLCBSb3dNYW5hZ2VySW1wbCByb3dNZ3IsDQogICAgICAg\nIEdyYXBoIGdyYXBoKSB7DQogICAgICAgIFByaW1hcnlSb3cgcm93Ow0KICAg\nICAgICBSb3cgcm93MjsNCiAgICAgICAgRm9yZWlnbktleVtdIGZrczsNCiAg\nICAgICAgQ29sdW1uW10gY29sczsNCiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSByb3dzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAg\nICAgICAgICByb3cgPSAoUHJpbWFyeVJvdykgaXRyLm5leHQoKTsNCiAgICAg\nICAgICAgIGlmICghcm93LmlzVmFsaWQoKSkNCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsNCg0KICAgICAgICAgICAgLy8gY2hlY2sgdGhpcyByb3cncyBm\na3MgYWdhaW5zdCBpbnNlcnRzOyBhIGxvZ2ljYWwgZmsgdG8gYW4gYXV0by1p\nbmMNCiAgICAgICAgICAgIC8vIGNvbHVtbiBpcyB0cmVhdGVkIGp1c3QgYXMg\nYWN0dWFsIGRhdGFiYXNlIGZrIGJlY2F1c2UgdGhlIHJlc3VsdA0KICAgICAg\nICAgICAgLy8gaXMgdGhlIHNhbWU6IHRoZSBwayByb3cgaGFzIHRvIGJlIGlu\nc2VydGVkIGJlZm9yZSB0aGUgZmsgcm93DQogICAgICAgICAgICBma3MgPSBy\nb3cuZ2V0VGFibGUoKS5nZXRGb3JlaWduS2V5cygpOw0KICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCBma3MubGVuZ3RoOyBqKyspIHsNCiAgICAg\nICAgICAgICAgICBpZiAocm93LmdldEZvcmVpZ25LZXlTZXQoZmtzW2pdKSA9\nPSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAg\nICAgICAgICAgICAgIC8vIHNlZSBpZiB0aGlzIHJvdyBpcyBkZXBlbmRlbnQg\nb24gYW5vdGhlci4gIGlmIGl0J3Mgb25seQ0KICAgICAgICAgICAgICAgIC8v\nIGRlcGVuZW50IG9uIGl0c2VsZiwgc2VlIGlmIHRoZSBmayBpcyBsb2dpY2Fs\nIG9yIGRlZmVycmVkLCBpbg0KICAgICAgICAgICAgICAgIC8vIHdoaWNoIGNh\nc2UgaXQgbXVzdCBiZSBhbiBhdXRvLWluYyBiZWNhdXNlIG90aGVyd2lzZSB3\nZQ0KICAgICAgICAgICAgICAgIC8vIHdvdWxkbid0IGhhdmUgcmVjb3JkZWQg\naXQNCiAgICAgICAgICAgICAgICByb3cyID0gcm93TWdyLmdldFJvdyhma3Nb\nal0uZ2V0UHJpbWFyeUtleVRhYmxlKCksDQogICAgICAgICAgICAgICAgICAg\nIFJvdy5BQ1RJT05fSU5TRVJULCByb3cuZ2V0Rm9yZWlnbktleVNldChma3Nb\nal0pLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgaWYgKHJvdzIgIT0gbnVs\nbCAmJiByb3cyLmlzVmFsaWQoKSAmJiAocm93MiAhPSByb3cNCiAgICAgICAg\nICAgICAgICAgICAgfHwgZmtzW2pdLmlzRGVmZXJyZWQoKSB8fCBma3Nbal0u\naXNMb2dpY2FsKCkpKQ0KICAgICAgICAgICAgICAgICAgICBncmFwaCA9IGFk\nZEVkZ2UoZ3JhcGgsIHJvdywgKFByaW1hcnlSb3cpIHJvdzIsIGZrc1tqXSk7\nDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHNlZSBpZiB0aGVy\nZSBhcmUgYW55IHJlbGF0aW9uIGlkIGNvbHVtbnMgZGVwZW5kZW50IG9uDQog\nICAgICAgICAgICAvLyBhdXRvLWluYyBvYmplY3RzDQogICAgICAgICAgICBj\nb2xzID0gcm93LmdldFRhYmxlKCkuZ2V0UmVsYXRpb25JZENvbHVtbnMoKTsN\nCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgY29scy5sZW5ndGg7\nIGorKykgew0KICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20gPSByb3cuZ2V0UmVsYXRpb25JZFNldChjb2xzW2pdKTsNCiAgICAgICAg\nICAgICAgICBpZiAoc20gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7DQoNCiAgICAgICAgICAgICAgICByb3cyID0gcm93TWdyLmdl\ndFJvdyhnZXRCYXNlVGFibGUoc20pLCBSb3cuQUNUSU9OX0lOU0VSVCwNCiAg\nICAgICAgICAgICAgICAgICAgc20sIGZhbHNlKTsNCiAgICAgICAgICAgICAg\nICBpZiAocm93MiAhPSBudWxsICYmIHJvdzIuaXNWYWxpZCgpKQ0KICAgICAg\nICAgICAgICAgICAgICBncmFwaCA9IGFkZEVkZ2UoZ3JhcGgsIHJvdywgKFBy\naW1hcnlSb3cpIHJvdzIsIGNvbHNbal0pOw0KICAgICAgICAgICAgfQ0KICAg\nICAgICB9DQogICAgICAgIHJldHVybiBncmFwaDsNCiAgICB9DQoNCiAgICAv\nKioNCiAgICAgKiBSZXR1cm4gdGhlIGJhc2UgdGFibGUgZm9yIHRoZSBnaXZl\nbiBpbnN0YW5jZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIHN0YXRpYyBUYWJs\nZSBnZXRCYXNlVGFibGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgew0KICAg\nICAgICBDbGFzc01hcHBpbmcgY2xzID0gKENsYXNzTWFwcGluZykgc20uZ2V0\nTWV0YURhdGEoKTsNCiAgICAgICAgd2hpbGUgKGNscy5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQ0KICAgICAgICAgICAgY2xz\nID0gY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOw0KICAg\nICAgICByZXR1cm4gY2xzLmdldFRhYmxlKCk7DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogQWRkIGFuIGVkZ2UgYmV0d2VlbiB0aGUgZ2l2ZW4gcm93cyBp\nbiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgZ3JhcGguDQogICAgICovDQogICAg\ncHJpdmF0ZSBHcmFwaCBhZGRFZGdlKEdyYXBoIGdyYXBoLCBQcmltYXJ5Um93\nIHJvdzEsIFByaW1hcnlSb3cgcm93MiwNCiAgICAgICAgT2JqZWN0IGZrKSB7\nDQogICAgICAgIC8vIGRlbGF5IGNyZWF0aW9uIG9mIHRoZSBncmFwaA0KICAg\nICAgICBpZiAoZ3JhcGggPT0gbnVsbCkNCiAgICAgICAgICAgIGdyYXBoID0g\nbmV3IEdyYXBoKCk7DQoNCiAgICAgICAgcm93MS5zZXREZXBlbmRlbnQodHJ1\nZSk7DQogICAgICAgIHJvdzIuc2V0RGVwZW5kZW50KHRydWUpOw0KICAgICAg\nICBncmFwaC5hZGROb2RlKHJvdzEpOw0KICAgICAgICBncmFwaC5hZGROb2Rl\nKHJvdzIpOw0KDQogICAgICAgIC8vIGFkZCBhbiBlZGdlIGZyb20gcm93MSB0\nbyByb3cyLCBhbmQgc2V0IHRoZSBmayBjYXVzaW5nIHRoZQ0KICAgICAgICAv\nLyBkZXBlbmRlbmN5IGFzIHRoZSB1c2VyIG9iamVjdCBzbyB3ZSBjYW4gcmV0\ncmlldmUgaXQgd2hlbiByZXNvbHZpbmcNCiAgICAgICAgLy8gY2lyY3VsYXIg\nY29uc3RyYWludHMNCiAgICAgICAgRWRnZSBlZGdlID0gbmV3IEVkZ2Uocm93\nMSwgcm93MiwgdHJ1ZSk7DQogICAgICAgIGVkZ2Uuc2V0VXNlck9iamVjdChm\nayk7DQogICAgICAgIGdyYXBoLmFkZEVkZ2UoZWRnZSk7DQoNCiAgICAgICAg\ncmV0dXJuIGdyYXBoOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZsdXNo\nIHRoZSBnaXZlbiBncmFwaCBvZiByb3dzIGluIHRoZSBwcm9wZXIgb3JkZXIu\nDQogICAgICogQHBhcmFtIGdyYXBoIFRoZSBncmFwaCBvZiBzdGF0ZW1lbnRz\nIHRvIGJlIHdhbGtlZA0KICAgICAqIEBwYXJhbSBwc01nciBUaGUgcHJlcGFy\nZWQgc3RhdGVtZW50IG1hbmFnZXIgdG8gdXNlIHRvIGlzc3VlIHRoZQ0KICAg\nICAqIHN0YXRlbWVudHMNCiAgICAgKiBAcGFyYW0gYXV0b0Fzc2lnbiBXaGV0\naGVyIGFueSBvZiB0aGUgcm93cyBpbiB0aGUgZ3JhcGggaGF2ZSBhbnkNCiAg\nICAgKiBhdXRvLWFzc2lnbiBjb25zdHJhaW50cw0KICAgICAqLw0KICAgIHBy\nb3RlY3RlZCB2b2lkIGZsdXNoR3JhcGgoR3JhcGggZ3JhcGgsIFByZXBhcmVk\nU3RhdGVtZW50TWFuYWdlciBwc01nciwNCiAgICAgICAgYm9vbGVhbiBhdXRv\nQXNzaWduKQ0KICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAg\nICAgaWYgKGdyYXBoID09IG51bGwpDQogICAgICAgICAgICByZXR1cm47DQoN\nCiAgICAgICAgRGVwdGhGaXJzdEFuYWx5c2lzIGRmYSA9IG5ld0RlcHRoRmly\nc3RBbmFseXNpcyhncmFwaCwgYXV0b0Fzc2lnbik7DQogICAgICAgIENvbGxl\nY3Rpb24gaW5zZXJ0VXBkYXRlcyA9IG5ldyBMaW5rZWRMaXN0KCk7DQogICAg\nICAgIENvbGxlY3Rpb24gZGVsZXRlVXBkYXRlcyA9IG5ldyBMaW5rZWRMaXN0\nKCk7DQogICAgICAgIGJvb2xlYW4gcmVjYWxjdWxhdGU7DQoNCiAgICAgICAg\nLy8gSGFuZGxlIGNpcmN1bGFyIGNvbnN0cmFpbnRzOg0KICAgICAgICAvLyAt\nIGlmIGRlbGV0ZWQgcm93IEEgaGFzIGEgY2lyaWN1bGFyIGZrIHRvIGRlbGV0\nZWQgcm93IEIsIA0KICAgICAgICAvLyAgIHRoZW4gdXNlIGFuIHVwZGF0ZSBz\ndGF0ZW1lbnQgdG8gbnVsbCBBJ3MgZmsgdG8gQiBiZWZvcmUgZmx1c2hpbmcs\nIA0KICAgICAgICAvLyAgIGFuZCB0aGVuIGZsdXNoDQogICAgICAgIC8vIC0g\naWYgaW5zZXJ0ZWQgcm93IEEgaGFzIGEgY2lyY3VsYXIgZmsgdG8gdXBkYXRl\nZC9pbnNlcnRlZCByb3cgQiwNCiAgICAgICAgLy8gICB0aGVuIG51bGwgdGhl\nIGZrIGluIHRoZSBCIHJvdyBvYmplY3QsIHRoZW4gZmx1c2gsDQogICAgICAg\nIC8vICAgYW5kIGFmdGVyIGZsdXNoaW5nLCB1c2UgYW4gdXBkYXRlIHRvIHNl\ndCB0aGUgZmsgYmFjayB0byBBDQogICAgICAgIC8vIERlcGVuZGluZyBvbiB3\naGVyZSBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYXJlIGJyb2tlbiwgdGhlICAN\nCiAgICAgICAgLy8gdG9wb2xvZ2ljYWwgb3JkZXIgb2YgdGhlIGdyYXBoIG5v\nZGVzIGhhcyB0byBiZSByZS1jYWxjdWxhdGVkLg0KICAgICAgICByZWNhbGN1\nbGF0ZSA9IHJlc29sdmVDeWNsZXMoZ3JhcGgsIGRmYS5nZXRFZGdlcyhFZGdl\nLlRZUEVfQkFDSyksDQogICAgICAgICAgICAgICAgZGVsZXRlVXBkYXRlcywg\naW5zZXJ0VXBkYXRlcyk7DQogICAgICAgIHJlY2FsY3VsYXRlIHw9IHJlc29s\ndmVDeWNsZXMoZ3JhcGgsIGRmYS5nZXRFZGdlcyhFZGdlLlRZUEVfRk9SV0FS\nRCksDQogICAgICAgICAgICAgICAgZGVsZXRlVXBkYXRlcywgaW5zZXJ0VXBk\nYXRlcyk7DQoNCiAgICAgICAgaWYgKHJlY2FsY3VsYXRlKSB7DQogICAgICAg\nICAgICBkZmEgPSByZWNhbGN1bGF0ZURlcHRoRmlyc3RBbmFseXNpcyhncmFw\naCwgYXV0b0Fzc2lnbik7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBmbHVz\naCBkZWxldGUgdXBkYXRlcyB0byBudWxsIGZrcywgdGhlbiBhbGwgcm93cyBp\nbiBvcmRlciwgdGhlbg0KICAgICAgICAvLyB0aGUgaW5zZXJ0IHVwZGF0ZXMg\ndG8gc2V0IGNpcmN1bGFyIGZrIHZhbHVlcw0KICAgICAgICBmbHVzaChkZWxl\ndGVVcGRhdGVzLCBwc01ncik7DQogICAgICAgIENvbGxlY3Rpb24gbm9kZXMg\nPSBkZmEuZ2V0U29ydGVkTm9kZXMoKTsNCiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBub2Rlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykNCiAg\nICAgICAgICAgIHBzTWdyLmZsdXNoKChSb3dJbXBsKSBpdHIubmV4dCgpKTsN\nCiAgICAgICAgZmx1c2goaW5zZXJ0VXBkYXRlcywgcHNNZ3IpOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIEJyZWFrIGEgY2lyY3VsYXIgZGVwZW5kZW5j\neSBjYXVzZWQgYnkgZGVsZXRlIG9wZXJhdGlvbnMuDQogICAgICogSWYgZGVs\nZXRlZCByb3cgQSBoYXMgYSBjaXJpY3VsYXIgZmsgdG8gZGVsZXRlZCByb3cg\nQiwgdGhlbiB1c2UgYW4gdXBkYXRlIA0KICAgICAqIHN0YXRlbWVudCB0byBu\ndWxsIEEncyBmayB0byBCIGJlZm9yZSBkZWxldGluZyBCLCB0aGVuIGRlbGV0\nZSBBLg0KICAgICAqIEBwYXJhbSBlZGdlIEVkZ2UgaW4gdGhlIGRlcGVuZGVu\nY3kgZ3JhcGggY29ycmVzcG9uZGluZyB0byBhIGZvcmVpZ24ga2V5DQogICAg\nICogY29uc3RyYWludC4gVGhpcyBkZXBlbmRlbmN5IGlzIGJyb2tlbiBieSBu\ndWxsaWZ5aW5nIHRoZSBmb3JlaWduIGtleS4NCiAgICAgKiBAcGFyYW0gZGVs\nZXRlVXBkYXRlcyBDb2xsZWN0aW9uIG9mIHVwZGF0ZSBzdGF0ZW1lbnRzIHRo\nYXQgYXJlIGV4ZWN1dGVkDQogICAgICogYmVmb3JlIHRoZSBkZWxldGUgb3Bl\ncmF0aW9ucyBhcmUgZmx1c2hlZCANCiAgICAgKi8NCiAgICBwcml2YXRlIHZv\naWQgYWRkRGVsZXRlVXBkYXRlKEVkZ2UgZWRnZSwgQ29sbGVjdGlvbiBkZWxl\ndGVVcGRhdGVzKQ0KICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAg\nICAgICAgUHJpbWFyeVJvdyByb3c7DQogICAgICAgIFJvd0ltcGwgdXBkYXRl\nOw0KICAgICAgICBGb3JlaWduS2V5IGZrOw0KDQogICAgICAgIC8vIGNvcHkg\nd2hlcmUgY29uZGl0aW9ucyBpbnRvIG5ldyB1cGRhdGUgdGhhdCBudWxscyB0\naGUgZmsNCiAgICAgICAgcm93ID0gKFByaW1hcnlSb3cpIGVkZ2UuZ2V0VG8o\nKTsNCiAgICAgICAgdXBkYXRlID0gbmV3IFByaW1hcnlSb3cocm93LmdldFRh\nYmxlKCksIFJvdy5BQ1RJT05fVVBEQVRFLCBudWxsKTsNCiAgICAgICAgcm93\nLmNvcHlJbnRvKHVwZGF0ZSwgdHJ1ZSk7DQogICAgICAgIGlmIChlZGdlLmdl\ndFVzZXJPYmplY3QoKSBpbnN0YW5jZW9mIEZvcmVpZ25LZXkpIHsNCiAgICAg\nICAgICAgIGZrID0gKEZvcmVpZ25LZXkpIGVkZ2UuZ2V0VXNlck9iamVjdCgp\nOw0KICAgICAgICAgICAgdXBkYXRlLnNldEZvcmVpZ25LZXkoZmssIHJvdy5n\nZXRGb3JlaWduS2V5SU8oZmspLCBudWxsKTsNCiAgICAgICAgfSBlbHNlDQog\nICAgICAgICAgICB1cGRhdGUuc2V0TnVsbCgoQ29sdW1uKSBlZGdlLmdldFVz\nZXJPYmplY3QoKSk7DQoNCiAgICAgICAgZGVsZXRlVXBkYXRlcy5hZGQodXBk\nYXRlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBCcmVhayBhIGNpcmN1\nbGFyIGRlcGVuZGVuY3kgY2F1c2VkIGJ5IGluc2VydCBvcGVyYXRpb25zLg0K\nICAgICAqIElmIGluc2VydGVkIHJvdyBBIGhhcyBhIGNpcmN1bGFyIGZrIHRv\nIHVwZGF0ZWQvaW5zZXJ0ZWQgcm93IEIsDQogICAgICogdGhlbiBudWxsIHRo\nZSBmayBpbiB0aGUgQiByb3cgb2JqZWN0LCB0aGVuIGZsdXNoLA0KICAgICAq\nIGFuZCBhZnRlciBmbHVzaGluZywgdXNlIGFuIHVwZGF0ZSB0byBzZXQgdGhl\nIGZrIGJhY2sgdG8gQS4NCiAgICAgKiBAcGFyYW0gcm93IFJvdyB0byBiZSBm\nbHVzaGVkDQogICAgICogQHBhcmFtIGVkZ2UgRWRnZSBpbiB0aGUgZGVwZW5k\nZW5jeSBncmFwaCBjb3JyZXNwb25kaW5nIHRvIGEgZm9yZWlnbiBrZXkNCiAg\nICAgKiBjb25zdHJhaW50LiBUaGlzIGRlcGVuZGVuY3kgaXMgYnJva2VuIGJ5\nIG51bGxpZnlpbmcgdGhlIGZvcmVpZ24ga2V5Lg0KICAgICAqIEBwYXJhbSBp\nbnNlcnRVcGRhdGVzIENvbGxlY3Rpb24gb2YgdXBkYXRlIHN0YXRlbWVudHMg\ndGhhdCBhcmUgZXhlY3V0ZWQNCiAgICAgKiBhZnRlciB0aGUgaW5zZXJ0L3Vw\nZGF0ZSBvcGVyYXRpb25zIGFyZSBmbHVzaGVkIA0KICAgICAqLw0KICAgIHBy\naXZhdGUgdm9pZCBhZGRJbnNlcnRVcGRhdGUoUHJpbWFyeVJvdyByb3csIEVk\nZ2UgZWRnZSwNCiAgICAgICAgQ29sbGVjdGlvbiBpbnNlcnRVcGRhdGVzKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAgICAgUm93SW1wbCB1cGRhdGU7\nDQogICAgICAgIEZvcmVpZ25LZXkgZms7DQogICAgICAgIENvbHVtbiBjb2w7\nDQoNCiAgICAgICAgLy8gY29weSB3aGVyZSBjb25kaXRpb25zIGludG8gbmV3\nIHVwZGF0ZSB0aGF0IHNldHMgdGhlIGZrDQogICAgICAgIHVwZGF0ZSA9IG5l\ndyBQcmltYXJ5Um93KHJvdy5nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX1VQREFU\nRSwgbnVsbCk7DQogICAgICAgIGlmIChyb3cuZ2V0QWN0aW9uKCkgPT0gUm93\nLkFDVElPTl9JTlNFUlQpIHsNCiAgICAgICAgICAgIGlmIChyb3cuZ2V0UHJp\nbWFyeUtleSgpID09IG51bGwpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWYtY3ljbGUiKSk7DQog\nICAgICAgICAgICB1cGRhdGUud2hlcmVQcmltYXJ5S2V5KHJvdy5nZXRQcmlt\nYXJ5S2V5KCkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8g\nUm93LkFDVElPTl9VUERBVEUNCiAgICAgICAgICAgIHJvdy5jb3B5SW50byh1\ncGRhdGUsIHRydWUpOw0KICAgICAgICB9DQogICAgICAgIGlmIChlZGdlLmdl\ndFVzZXJPYmplY3QoKSBpbnN0YW5jZW9mIEZvcmVpZ25LZXkpIHsNCiAgICAg\nICAgICAgIGZrID0gKEZvcmVpZ25LZXkpIGVkZ2UuZ2V0VXNlck9iamVjdCgp\nOw0KICAgICAgICAgICAgdXBkYXRlLnNldEZvcmVpZ25LZXkoZmssIHJvdy5n\nZXRGb3JlaWduS2V5SU8oZmspLA0KICAgICAgICAgICAgICAgIHJvdy5nZXRG\nb3JlaWduS2V5U2V0KGZrKSk7DQogICAgICAgICAgICByb3cuY2xlYXJGb3Jl\naWduS2V5KGZrKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNv\nbCA9IChDb2x1bW4pIGVkZ2UuZ2V0VXNlck9iamVjdCgpOw0KICAgICAgICAg\nICAgdXBkYXRlLnNldFJlbGF0aW9uSWQoY29sLCByb3cuZ2V0UmVsYXRpb25J\nZFNldChjb2wpLA0KICAgICAgICAgICAgICAgIHJvdy5nZXRSZWxhdGlvbklk\nQ2FsbGJhY2soY29sKSk7DQogICAgICAgICAgICByb3cuY2xlYXJSZWxhdGlv\nbklkKGNvbCk7DQogICAgICAgIH0NCg0KICAgICAgICBpbnNlcnRVcGRhdGVz\nLmFkZCh1cGRhdGUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZpbmRz\nIGEgbnVsbGFibGUgZm9yZWlnbiBrZXkgYnkgd2Fsa2luZyB0aGUgZGVwZW5k\nZW5jeSBjeWNsZS4gDQogICAgICogQ2lyY3VsYXIgZGVwZW5kZW5jaWVzIGNh\nbiBiZSBicm9rZW4gYXQgdGhpcyBwb2ludC4NCiAgICAgKiBAcGFyYW0gY3lj\nbGUgQ3ljbGUgaW4gdGhlIGRlcGVuZGVuY3kgZ3JhcGguDQogICAgICogQHJl\ndHVybiBFZGdlIGNvcnJlc3BvbmRpbmcgdG8gYSBudWxsYWJsZSBmb3JlaWdu\nIGtleS4NCiAgICAgKi8NCiAgICBwcml2YXRlIEVkZ2UgZmluZEJyZWFrYWJs\nZUxpbmsoTGlzdCBjeWNsZSkgew0KICAgICAgICBFZGdlIGJyZWFrYWJsZUxp\nbmsgPSBudWxsOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBjeWNs\nZS5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgKSB7DQogICAgICAgICAg\nICBFZGdlIGVkZ2UgPSAoRWRnZSkgaXRlci5uZXh0KCk7DQogICAgICAgICAg\nICBPYmplY3QgdXNlck9iamVjdCA9IGVkZ2UuZ2V0VXNlck9iamVjdCgpOw0K\nICAgICAgICAgICAgaWYgKHVzZXJPYmplY3QgaW5zdGFuY2VvZiBGb3JlaWdu\nS2V5KSB7DQogICAgICAgICAgICAgICAgIGlmICghKChGb3JlaWduS2V5KSB1\nc2VyT2JqZWN0KS5oYXNOb3ROdWxsQ29sdW1ucygpKSB7DQogICAgICAgICAg\nICAgICAgICAgICBicmVha2FibGVMaW5rID0gZWRnZTsNCiAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICB9DQogICAgICAg\nICAgICB9IGVsc2UgaWYgKHVzZXJPYmplY3QgaW5zdGFuY2VvZiBDb2x1bW4p\nIHsNCiAgICAgICAgICAgICAgICBpZiAoISgoQ29sdW1uKSB1c2VyT2JqZWN0\nKS5pc05vdE51bGwoKSkgew0KICAgICAgICAgICAgICAgICAgICBicmVha2Fi\nbGVMaW5rID0gZWRnZTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQog\nICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQog\nICAgICAgIHJldHVybiBicmVha2FibGVMaW5rOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIFJlLWNhbGN1bGF0ZXMgdGhlIERlcHRoRmlyc3RTZWFyY2gg\nYW5hbHlzaXMgb2YgdGhlIGdyYXBoIA0KICAgICAqIGFmdGVyIHNvbWUgb2Yg\ndGhlIGVkZ2VzIGhhdmUgYmVlbiByZW1vdmVkLiBFbnN1cmVzDQogICAgICog\ndGhhdCB0aGUgZGVwZW5kZW5jeSBncmFwaCBpcyBjeWNsZSBmcmVlLg0KICAg\nICAqIEBwYXJhbSBncmFwaCBUaGUgZ3JhcGggb2Ygc3RhdGVtZW50cyB0byBi\nZSB3YWxrZWQNCiAgICAgKiBAcGFyYW0gYXV0b0Fzc2lnbiBXaGV0aGVyIGFu\neSBvZiB0aGUgcm93cyBpbiB0aGUgZ3JhcGggaGF2ZSBhbnkNCiAgICAgKiBh\ndXRvLWFzc2lnbiBjb25zdHJhaW50cw0KICAgICAqLw0KICAgIHByaXZhdGUg\nRGVwdGhGaXJzdEFuYWx5c2lzIHJlY2FsY3VsYXRlRGVwdGhGaXJzdEFuYWx5\nc2lzKEdyYXBoIGdyYXBoLA0KICAgICAgICBib29sZWFuIGF1dG9Bc3NpZ24p\nIHsNCiAgICAgICAgRGVwdGhGaXJzdEFuYWx5c2lzIGRmYTsNCiAgICAgICAg\nLy8gY2xlYXIgcHJldmlvdXMgdHJhdmVyc2FsIGRhdGENCiAgICAgICAgZ3Jh\ncGguY2xlYXJUcmF2ZXJzYWwoKTsNCiAgICAgICAgZGZhID0gbmV3RGVwdGhG\naXJzdEFuYWx5c2lzKGdyYXBoLCBhdXRvQXNzaWduKTsNCiAgICAgICAgLy8g\nbWFrZSBzdXJlIHRoYXQgdGhlIGdyYXBoIGlzIG5vbi1jeWNsaWMgbm93DQog\nICAgICAgIGFzc2VydCAoZGZhLmhhc05vQ3ljbGVzKCkpOiBfbG9jLmdldCgi\nZ3JhcGgtbm90LWN5Y2xlLWZyZWUiKTsNCiAgICAgICAgcmV0dXJuIGRmYTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXNvbHZlIGNpcmN1bGFyIGRl\ncGVuZGVuY2llcyBieSBpZGVudGlmeWluZyBhbmQgYnJlYWtpbmcNCiAgICAg\nKiBhIG51bGxhYmxlIGZvcmVpZ24ga2V5Lg0KICAgICAqIEBwYXJhbSBncmFw\naCBEZXBlbmRlbmN5IGdyYXBoLg0KICAgICAqIEBwYXJhbSBlZGdlcyBDb2xs\nZWN0aW9uIG9mIGVkZ2VzLiBFYWNoIGVkZ2UgaW5kaWNhdGVzIGEgcG9zc2li\nbGUgDQogICAgICogY2lyY3VsYXIgZGVwZW5kZW5jeQ0KICAgICAqIEBwYXJh\nbSBkZWxldGVVcGRhdGVzIENvbGxlY3Rpb24gb2YgdXBkYXRlIG9wZXJhdGlv\nbnMgKG51bGxpZnlpbmcgDQogICAgICogZm9yZWlnbiBrZXlzKSB0byBiZSBm\naWxsZWQuIFRoZXNlIHVwZGF0ZXMgd2lsbCBiZSBleGVjdXRlZCBiZWZvcmUg\nDQogICAgICogdGhlIHJvd3MgaW4gdGhlIGRlcGVuZGVuY3kgZ3JhcGggYXJl\nIGZsdXNoZWQNCiAgICAgKiBAcGFyYW0gaW5zZXJ0VXBkYXRlcyBDQ29sbGVj\ndGlvbiBvZiB1cGRhdGUgb3BlcmF0aW9ucyAobnVsbGlmeWluZyANCiAgICAg\nKiBmb3JlaWduIGtleXMpIHRvIGJlIGZpbGxlZC4gVGhlc2UgdXBkYXRlcyB3\naWxsIGJlIGV4ZWN1dGVkIGFmdGVyIA0KICAgICAqIHRoZSByb3dzIGluIHRo\nZSBkZXBlbmRlbmN5IGdyYXBoIGFyZSBmbHVzaGVkDQogICAgICogQHJldHVy\nbiBEZXBlbmRpbmcgb24gd2hlcmUgY2lyY3VsYXIgZGVwZW5kZW5jaWVzIGFy\nZSBicm9rZW4sIHRoZSAgDQogICAgICogdG9wb2xvZ2ljYWwgb3JkZXIgb2Yg\ndGhlIGdyYXBoIG5vZGVzIGhhcyB0byBiZSByZS1jYWxjdWxhdGVkLg0KICAg\nICAqLw0KICAgIHByaXZhdGUgYm9vbGVhbiByZXNvbHZlQ3ljbGVzKEdyYXBo\nIGdyYXBoLCBDb2xsZWN0aW9uIGVkZ2VzLA0KICAgICAgICBDb2xsZWN0aW9u\nIGRlbGV0ZVVwZGF0ZXMsIENvbGxlY3Rpb24gaW5zZXJ0VXBkYXRlcykNCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7DQogICAgICAgIGJvb2xlYW4g\ncmVjYWxjdWxhdGUgPSBmYWxzZTsNCiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBlZGdlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAg\nICAgICAgICAgRWRnZSBlZGdlID0gKEVkZ2UpIGl0ci5uZXh0KCk7DQogICAg\nICAgICAgICBMaXN0IGN5Y2xlID0gZWRnZS5nZXRDeWNsZSgpOw0KDQogICAg\nICAgICAgICBpZiAoY3ljbGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAg\nIC8vIGZpbmQgYSBudWxsYWJsZSBmb3JlaWduIGtleQ0KICAgICAgICAgICAg\nICAgIEVkZ2UgYnJlYWthYmxlTGluayA9IGZpbmRCcmVha2FibGVMaW5rKGN5\nY2xlKTsNCiAgICAgICAgICAgICAgICBpZiAoYnJlYWthYmxlTGluayA9PSBu\ndWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1udWxsYWJsZS1mayIpKTsNCiAgICAgICAg\nICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyB0b3BvbG9naWMgbm9k\nZSBvcmRlciBtdXN0IGJlIHJlLWNhbGN1bGF0ZWQsICBpZiB0aGUNCiAgICAg\nICAgICAgICAgICAvLyBicmVha2FibGUgbGluayBpcyBkaWZmZXJlbnQgZnJv\nbSB0aGUgZWRnZSB3aGVyZQ0KICAgICAgICAgICAgICAgIC8vIHRoZSBjaXJj\ndWxhciBkZXBlbmRlbmN5IHdhcyBvcmlnaW5hbGx5IGRldGVjdGVkDQogICAg\nICAgICAgICAgICAgaWYgKGVkZ2UgIT0gYnJlYWthYmxlTGluaykgew0KICAg\nICAgICAgICAgICAgICAgICByZWNhbGN1bGF0ZSA9IHRydWU7DQogICAgICAg\nICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCFicmVha2FibGVM\naW5rLmlzUmVtb3ZlZEZyb21HcmFwaCgpKSB7DQoNCiAgICAgICAgICAgICAg\nICAgICAgLy8gdXNlIGEgcHJpbWFyeSByb3cgdXBkYXRlIHRvIHByZXZlbnQg\nc2V0dGluZyBwayBhbmQgZmsgdmFsdWVzDQogICAgICAgICAgICAgICAgICAg\nIC8vIHVudGlsIGFmdGVyIGZsdXNoLCB0byBnZXQgbGF0ZXN0IGF1dG8taW5j\ncmVtZW50IHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICBQcmltYXJ5Um93\nIHJvdyA9IChQcmltYXJ5Um93KSBicmVha2FibGVMaW5rLmdldEZyb20oKTsN\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBS\nb3cuQUNUSU9OX0RFTEVURSkgew0KICAgICAgICAgICAgICAgICAgICAgICAg\nYWRkRGVsZXRlVXBkYXRlKGJyZWFrYWJsZUxpbmssIGRlbGV0ZVVwZGF0ZXMp\nOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAg\nICAgICAgICAgICAgYWRkSW5zZXJ0VXBkYXRlKHJvdywgYnJlYWthYmxlTGlu\naywgaW5zZXJ0VXBkYXRlcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAg\nICAgICAgICAgICAgICAgICAgZ3JhcGgucmVtb3ZlRWRnZShicmVha2FibGVM\naW5rKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAg\nICAgIH0NCiAgICAgICAgcmV0dXJuIHJlY2FsY3VsYXRlOw0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIENyZWF0ZSBhIG5ldyB7QGxpbmsgRGVwdGhGaXJz\ndEFuYWx5c2lzfSBzdWl0YWJsZSBmb3IgdGhlIGdpdmVuIGdyYXBoDQogICAg\nICogYW5kIGF1dG8tYXNzaWduIHNldHRpbmdzLg0KICAgICAqLw0KICAgIHBy\nb3RlY3RlZCBEZXB0aEZpcnN0QW5hbHlzaXMgbmV3RGVwdGhGaXJzdEFuYWx5\nc2lzKEdyYXBoIGdyYXBoLA0KICAgICAgICBib29sZWFuIGF1dG9Bc3NpZ24p\nIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXB0aEZpcnN0QW5hbHlzaXMoZ3Jh\ncGgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZsdXNoIHRoZSBnaXZl\nbiBjb2xsZWN0aW9uIG9mIHNlY29uZGFyeSByb3dzLg0KICAgICAqLw0KICAg\nIHByb3RlY3RlZCB2b2lkIGZsdXNoKENvbGxlY3Rpb24gcm93cywgUHJlcGFy\nZWRTdGF0ZW1lbnRNYW5hZ2VyIHBzTWdyKSB7DQogICAgICAgIGlmIChyb3dz\nLnNpemUoKSA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAg\nIFJvd0ltcGwgcm93Ow0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHJv\nd3MuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgKSB7DQogICAgICAgICAg\nICByb3cgPSAoUm93SW1wbCkgaXRyLm5leHQoKTsNCiAgICAgICAgICAgIGlm\nIChyb3cuaXNWYWxpZCgpICYmICFyb3cuaXNEZXBlbmRlbnQoKSkNCiAgICAg\nICAgICAgICAgICBwc01nci5mbHVzaChyb3cpOw0KICAgICAgICB9DQogICAg\nfQ0KfQ==\n","encoding":"base64"}

