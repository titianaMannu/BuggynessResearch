{"sha":"6afc604e35ce5700c88c01b5e9dfe864eb3afac0","node_id":"MDQ6QmxvYjIwNjM2NDo2YWZjNjA0ZTM1Y2U1NzAwYzg4YzAxYjVlOWRmZTg2NGViM2FmYWMw","size":52178,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6afc604e35ce5700c88c01b5e9dfe864eb3afac0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3Rh\ndGVtZW50OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLlNldDsKaW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5PcnBoYW5lZEtleUFj\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRC\nQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5TeW50YXhlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVj\ndXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Vbmlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5M\nb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29ubmVjdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nUHJl\ncGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmpkYmMuRGVsZWdhdGluZ1N0YXRlbWVudDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0\nUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xh\nc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZp\nZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5K\nYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5B\ncHBsaWNhdGlvbklkczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3Jl\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNl\nckV4Y2VwdGlvbjsKCi8qKgogKiBTdG9yZU1hbmFnZXIgcGx1Z2luIHRoYXQg\ndXNlcyBKREJDIHRvIHN0b3JlIHBlcnNpc3RlbnQgZGF0YSBpbiBhCiAqIHJl\nbGF0aW9uYWwgZGF0YSBzdG9yZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZU1hbmFn\nZXIgCiAgICBpbXBsZW1lbnRzIFN0b3JlTWFuYWdlciwgSkRCQ1N0b3JlIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEpEQkNTdG9yZU1hbmFnZXIu\nY2xhc3MpOwoKICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9jdHggPSBudWxs\nOwogICAgcHJpdmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7\nCiAgICBwcml2YXRlIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CiAgICBw\ncml2YXRlIFNRTEZhY3RvcnkgX3NxbCA9IG51bGw7CiAgICBwcml2YXRlIEpE\nQkNMb2NrTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhU291\ncmNlIF9kcyA9IG51bGw7CiAgICBwcml2YXRlIFJlZkNvdW50Q29ubmVjdGlv\nbiBfY29ubiA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2FjdGl2ZSA9\nIGZhbHNlOwoKICAgIC8vIHRyYWNrIHRoZSBwZW5kaW5nIHN0YXRlbWVudHMg\nc28gd2UgY2FuIGNhbmNlbCB0aGVtCiAgICBwcml2YXRlIFNldCBfc3RtbnRz\nID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkU2V0KG5ldyBIYXNoU2V0KCkp\nOwoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAg\nICAgICByZXR1cm4gX2N0eDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRD\nb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBfY3R4ID0gY3R4\nOwogICAgICAgIF9jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBjdHguZ2V0\nQ29uZmlndXJhdGlvbigpOwogICAgICAgIF9kaWN0ID0gX2NvbmYuZ2V0REJE\naWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBfc3FsID0gX2NvbmYuZ2V0\nU1FMRmFjdG9yeUluc3RhbmNlKCk7CgogICAgICAgIExvY2tNYW5hZ2VyIGxt\nID0gY3R4LmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAgaWYgKGxtIGluc3Rh\nbmNlb2YgSkRCQ0xvY2tNYW5hZ2VyKQogICAgICAgICAgICBfbG0gPSAoSkRC\nQ0xvY2tNYW5hZ2VyKSBsbTsKCiAgICAgICAgaWYgKCFjdHguaXNNYW5hZ2Vk\nKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkp\nCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3VyY2UyKGN0eCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHMgPSBfY29uZi5nZXREYXRh\nU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRVcGRhdGVNYW5h\nZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAgICAgIGN0eC5z\nZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMg\nSkRCQ0NvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVibGljIERCRGljdGlvbmFy\neSBnZXREQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0Owog\nICAgfQoKICAgIHB1YmxpYyBTUUxGYWN0b3J5IGdldFNRTEZhY3RvcnkoKSB7\nCiAgICAgICAgcmV0dXJuIF9zcWw7CiAgICB9CgogICAgcHVibGljIEpEQkNM\nb2NrTWFuYWdlciBnZXRMb2NrTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4g\nX2xtOwogICAgfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gKEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24pIF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5PcHRpbWlzdGlj\nKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrT3B0aW1pc3Rp\nYygpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAg\nICBfYWN0aXZlID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25G\nYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgICYmIF9jb25u\nLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgIF9jb25uLnNldEF1\ndG9Db21taXQoZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAg\nICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0KCkgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2N0eC5pc01hbmFnZWQo\nKSB8fCAhX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkp\nCiAgICAgICAgICAgICAgICBfY29ubi5jb21taXQoKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHsKICAgICAgICAgICAgfQogICAg\nICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGlj\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2ZSA9\nIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xs\nYmFjaygpIHsKICAgICAgICAvLyBhbHJlYWR5IHJvbGxlZCBiYWNrIG91cnNl\nbHZlcz8KICAgICAgICBpZiAoIV9hY3RpdmUpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9jb25uICE9IG51\nbGwKICAgICAgICAgICAgICAgICYmICghX2N0eC5pc01hbmFnZWQoKSB8fCAh\nX2NvbmYKICAgICAgICAgICAgICAgICAgICAuaXNDb25uZWN0aW9uRmFjdG9y\neU1vZGVNYW5hZ2VkKCkpKQogICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJh\nY2soKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUg\nPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0\nYWluQ29ubmVjdGlvbigpIHsKICAgICAgICBjb25uZWN0KGZhbHNlKTsKICAg\nICAgICBfY29ubi5zZXRSZXRhaW4odHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVsZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKF9jb25u\nICE9IG51bGwpCiAgICAgICAgICAgIF9jb25uLnNldFJldGFpbihmYWxzZSk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRDbGllbnRDb25uZWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29ubmVjdGlvbihnZXRD\nb25uZWN0aW9uKCkpOwogICAgfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGdl\ndENvbm5lY3Rpb24oKSB7CiAgICAgICAgY29ubmVjdCh0cnVlKTsKICAgICAg\nICByZXR1cm4gX2Nvbm47CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZXhp\nc3RzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBjb250ZXh0KSB7\nCiAgICAgICAgLy8gYWRkIHdoZXJlIGNvbmRpdGlvbnMgb24gYmFzZSBjbGFz\ncyB0byBhdm9pZCBqb2lucyBpZiBzdWJjbGFzcwogICAgICAgIC8vIGRvZXNu\nJ3QgdXNlIG9pZCBhcyBpZGVudGlmaWVyCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwog\nICAgICAgIHJldHVybiBleGlzdHMobWFwcGluZywgc20uZ2V0T2JqZWN0SWQo\nKSwgY29udGV4dCk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGV4aXN0\ncyhDbGFzc01hcHBpbmcgbWFwcGluZywgT2JqZWN0IG9pZCwgT2JqZWN0IGNv\nbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0aW9ucyBvbiBi\nYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNzCiAgICAgICAg\nLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAgICAgICBTZWxl\nY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICB3aGlsZSAobWFw\ncGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxs\nKQogICAgICAgICAgICBtYXBwaW5nID0gbWFwcGluZy5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKCiAgICAgICAgc2VsLndoZXJlUHJpbWFy\neUtleShvaWQsIG1hcHBpbmcsIHRoaXMpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBzZWwuZ2V0Q291bnQodGhpcykgIT0gMDsKICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhy\nb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lvbihPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29udGV4dCkgewogICAgICAg\nIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0\nTWV0YURhdGEoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nbWFwcGluZy5nZXRWZXJzaW9uKCkuY2hlY2tWZXJzaW9uKHNtLCB0aGlzLCB0\ncnVlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGNvbXBhcmVW\nZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc3RhdGUsIE9iamVjdCB2MSwg\nT2JqZWN0IHYyKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAo\nQ2xhc3NNYXBwaW5nKSBzdGF0ZS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHJl\ndHVybiBtYXBwaW5nLmdldFZlcnNpb24oKS5jb21wYXJlVmVyc2lvbih2MSwg\ndjIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGluaXRpYWxpemUoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBzdGF0ZSwKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IChDb25uZWN0aW9uSW5mbykg\nY29udGV4dDsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gaW5p\ndGlhbGl6ZVN0YXRlKHNtLCBzdGF0ZSwgKEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24pIGZldGNoLCAKICAgICAgICAgICAgICAgIGluZm8pOwogICAgICAgIH0g\nY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cg\nU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgYSBuZXdseS1sb2Fk\nZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpbml0\naWFsaXplU3RhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBz\ndGF0ZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBD\nb25uZWN0aW9uSW5mbyBpbmZvKQogICAgICAgIHRocm93cyBDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewogICAgICAgIE9iamVjdCBv\naWQgPSBzbS5nZXRPYmplY3RJZCgpOwogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAg\nICAgICBSZXN1bHQgcmVzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoaW5mbyAhPSBudWxsICYmIGluZm8ucmVzdWx0ICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIHJlcyA9IGluZm8ucmVzdWx0OwogICAgICAg\nICAgICAgICAgaW5mby5zbSA9IHNtOwogICAgICAgICAgICAgICAgaWYgKGlu\nZm8ubWFwcGluZyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGluZm8u\nbWFwcGluZyA9IG1hcHBpbmc7CiAgICAgICAgICAgICAgICBtYXBwaW5nID0g\naW5mby5tYXBwaW5nOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9pZCBpbnN0\nYW5jZW9mIE9wZW5KUEFJZAogICAgICAgICAgICAgICAgJiYgISgoT3BlbkpQ\nQUlkKSBvaWQpLmhhc1N1YmNsYXNzZXMoKSkgewogICAgICAgICAgICAgICAg\nQm9vbGVhbiBjdXN0b20gPSBjdXN0b21Mb2FkKHNtLCBtYXBwaW5nLCBzdGF0\nZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKGN1c3RvbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b20uYm9vbGVhblZh\nbHVlKCk7CiAgICAgICAgICAgICAgICByZXMgPSBnZXRJbml0aWFsaXplU3Rh\ndGVSZXN1bHQoc20sIG1hcHBpbmcsIGZldGNoLAogICAgICAgICAgICAgICAg\nICAgIFNlbGVjdC5TVUJTX0VYQUNUKTsKICAgICAgICAgICAgICAgIGlmIChy\nZXMgPT0gbnVsbCAmJiAhc2VsZWN0UHJpbWFyeUtleShzbSwgbWFwcGluZywg\nZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAhcmVzLm5leHQoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBw\naW5ncyA9IG1hcHBpbmcuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5kZXBl\nbmRlbnRBc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGlm\nIChtYXBwaW5ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgICAg\nIG1hcHBpbmcgPSBtYXBwaW5nc1swXTsKICAgICAgICAgICAgICAgICAgICBC\nb29sZWFuIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20sIG1hcHBpbmcsIHN0YXRl\nLCBmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1c3RvbSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VzdG9tLmJv\nb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHJlcyA9IGdldElu\naXRpYWxpemVTdGF0ZVJlc3VsdChzbSwgbWFwcGluZywgZmV0Y2gsCiAgICAg\nICAgICAgICAgICAgICAgICAgIFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyA9PSBudWxsICYmICFzZWxl\nY3RQcmltYXJ5S2V5KHNtLCBtYXBwaW5nLCBmZXRjaCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxpemVT\ndGF0ZVVuaW9uUmVzdWx0KHNtLCBtYXBwaW5nLCBtYXBwaW5ncywKICAgICAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYg\nKHJlcyAhPSBudWxsICYmICFyZXMubmV4dCgpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gZmlndXJlIG91dCB3aGF0IHR5cGUgb2Ygb2JqZWN0IHRoaXMgaXM7IHRo\nZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgIC8vIG9ubHkgZ3VhcmFudGVl\ncyB0byBwcm92aWRlIGEgYmFzZSBjbGFzcwogICAgICAgICAgICBDbGFzcyB0\neXBlOwogICAgICAgICAgICBpZiAocmVzID09IG51bGwpCiAgICAgICAgICAg\nICAgICB0eXBlID0gbWFwcGluZy5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHJlcy5nZXRCYXNl\nTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWFwcGlu\nZyA9IHJlcy5nZXRCYXNlTWFwcGluZygpOwogICAgICAgICAgICAgICAgcmVz\nLnN0YXJ0RGF0YVJlcXVlc3QobWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB0\neXBlID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0Q2xhc3ModGhp\ncywgbWFwcGluZywKICAgICAgICAgICAgICAgICAgICAgICAgcmVzKTsKICAg\nICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAg\ncmVzLmVuZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHN0YXRl\nIG1hbmFnZXI7IHRoaXMgbWF5IGNoYW5nZSB0aGUgbWFwcGluZwogICAgICAg\nICAgICAvLyBhbmQgdGhlIG9iamVjdCBpZCBpbnN0YW5jZSBpZiB0aGUgdHlw\nZSBhcyBkZXRlcm1pbmVkCiAgICAgICAgICAgIC8vIGZyb20gdGhlIGluZGlj\nYXRvciBpcyBhIHN1YmNsYXNzIG9mIGV4cGVjdGVkIHR5cGUKICAgICAgICAg\nICAgc20uaW5pdGlhbGl6ZSh0eXBlLCBzdGF0ZSk7CgogICAgICAgICAgICAv\nLyBsb2FkIHRoZSBzZWxlY3RlZCBtYXBwaW5ncyBpbnRvIHRoZSBnaXZlbiBz\ndGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgLy8gcmUtZ2V0IHRoZSBtYXBwaW5nIGluIGNhc2Ug\ndGhlIGluc3RhbmNlIHdhcyBhIHN1YmNsYXNzCiAgICAgICAgICAgICAgICBt\nYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMpOwog\nICAgICAgICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2Fk\nKHNtLCB0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocmVz\nICE9IG51bGwgJiYgKGluZm8gPT0gbnVsbCB8fCByZXMgIT0gaW5mby5yZXN1\nbHQpKQogICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdGhlIG1hcHBpbmcgdG8gY3Vz\ndG9tIGxvYWQgZGF0YS4gUmV0dXJuIG51bGwgaWYgdGhlIG1hcHBpbmcKICAg\nICAqIGRvZXMgbm90IHVzZSBjdXN0b20gbG9hZGluZy4KICAgICAqLwogICAg\ncHJpdmF0ZSBCb29sZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgUENTdGF0ZSBz\ndGF0ZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAgICB0\naHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhlIG1hcHBpbmcgdGFrZXMg\nY2FyZSBvZiBpbml0aWFsaXphdGlvbgogICAgICAgIGlmICghbWFwcGluZy5j\ndXN0b21Mb2FkKHNtLCB0aGlzLCBzdGF0ZSwgZmV0Y2gpKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoc20uZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkgIT0gbnVsbCkgewogICAgICAgICAgICBtYXBwaW5nLmdldFZlcnNp\nb24oKS5hZnRlckxvYWQoc20sIHRoaXMpOwogICAgICAgICAgICByZXR1cm4g\nQm9vbGVhbi5UUlVFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9vbGVh\nbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZGF0\nYSBmb3IgdGhlIGdpdmVuIGluc3RhbmNlIGFuZCByZXR1cm4gdGhlIHJlc3Vs\ndC4gUmV0dXJuCiAgICAgKiBudWxsIGlmIHRoZXJlIGlzIG5vIGRhdGEgaW4g\ndGhlIGN1cnJlbnQgZmV0Y2ggZ3JvdXBzIHRvIHNlbGVjdC4KICAgICAqLwog\nICAgcHJpdmF0ZSBSZXN1bHQgZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBzdWJz\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNlbGVj\ndCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgIGlmICghc2VsZWN0\nKHNlbCwgbWFwcGluZywgc3Vicywgc20sIG51bGwsIGZldGNoLAogICAgICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIHRydWUs\nIGZhbHNlKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc2Vs\nLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0\naGlzKTsKICAgICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgxLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuIHNlbC5leGVjdXRlKHRoaXMsIGZldGNo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBhIHVuaW9uIG9mIHRo\nZSBkYXRhIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSBwb3NzaWJsZSBj\nb25jcmV0ZQogICAgICogbWFwcGluZ3MgYW5kIHJldHVybiB0aGUgcmVzdWx0\nLgogICAgICovCiAgICBwcml2YXRlIFJlc3VsdCBnZXRJbml0aWFsaXplU3Rh\ndGVVbmlvblJlc3VsdChmaW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBmaW5hbCBDbGFzc01hcHBp\nbmdbXSBtYXBwaW5ncywKICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBm\naW5hbCBKREJDU3RvcmVNYW5hZ2VyIHN0b3JlID0gdGhpczsKICAgICAgICBm\naW5hbCBpbnQgZWFnZXIgPSBNYXRoLm1pbihmZXRjaC5nZXRFYWdlckZldGNo\nTW9kZSgpLAogICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVB\nR0VSX0pPSU4pOwoKICAgICAgICBVbmlvbiB1bmlvbiA9IF9zcWwubmV3VW5p\nb24obWFwcGluZ3MubGVuZ3RoKTsKICAgICAgICB1bmlvbi5zZXRFeHBlY3Rl\nZFJlc3VsdENvdW50KDEsIGZhbHNlKTsKICAgICAgICBpZiAoZmV0Y2guZ2V0\nU3ViY2xhc3NGZXRjaE1vZGUobWFwcGluZykgIT0gZmV0Y2guRUFHRVJfSk9J\nTikKICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgIHVu\naW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaSkgewogICAg\nICAgICAgICAgICAgc2VsLnNlbGVjdChtYXBwaW5nc1tpXSwgU2VsZWN0LlNV\nQlNfQU5ZX0pPSU5BQkxFLCBzdG9yZSwgZmV0Y2gsCiAgICAgICAgICAgICAg\nICAgICAgZWFnZXIpOwogICAgICAgICAgICAgICAgc2VsLndoZXJlUHJpbWFy\neUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nc1tpXSwgc3RvcmUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHVuaW9u\nLmV4ZWN1dGUodGhpcywgZmV0Y2gpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2VsZWN0IHByaW1hcnkga2V5IGRhdGEgdG8gbWFrZSBzdXJlIHRoZSBnaXZl\nbiBpbnN0YW5jZSBleGlzdHMsIGxvY2tpbmcKICAgICAqIGlmIG5lZWRlZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdFByaW1hcnlLZXko\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBzZWxlY3QgcGtz\nIGZyb20gYmFzZSBjbGFzcyByZWNvcmQgdG8gZW5zdXJlIGl0IGV4aXN0cyBh\nbmQgbG9jawogICAgICAgIC8vIGl0IGlmIG5lZWRlZAogICAgICAgIENsYXNz\nTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAg\nICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKTsKCiAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0\nKCk7CiAgICAgICAgc2VsLnNlbGVjdChiYXNlLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCkpOwogICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2Jq\nZWN0SWQoKSwgYmFzZSwgdGhpcyk7CiAgICAgICAgUmVzdWx0IGV4aXN0cyA9\nIHNlbC5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoIWV4aXN0cy5uZXh0KCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyByZWNvcmQgbG9ja2VkPwog\nICAgICAgICAgICBpZiAoX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiBleGlz\ndHMuaXNMb2NraW5nKCkpCiAgICAgICAgICAgICAgICBfbG0ubG9hZGVkRm9y\nVXBkYXRlKHNtKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZXhpc3RzLmNsb3NlKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGxvYWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwsIE9iamVjdCBjb250\nZXh0KSB7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBqZmV0Y2gg\nPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgZmV0Y2g7CgogICAgICAgIC8v\nIGdldCBhIGNvbm5lY3Rpb24sIG9yIHJldXNlIGN1cnJlbnQgb25lCiAgICAg\nICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IChDb25uZWN0aW9uSW5mbykgY29u\ndGV4dDsKICAgICAgICBSZXN1bHQgcmVzID0gbnVsbDsKICAgICAgICBpZiAo\naW5mbyAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIGluaXRpYWxpemUo\nKSBmYWlscyB0byBsb2FkIHJlcXVpcmVkIGZpZWxkcywgdGhlbiB0aGlzIG1l\ndGhvZAogICAgICAgICAgICAvLyBpcyBjYWxsZWQ7IG1ha2Ugc3VyZSBub3Qg\ndG8gdHJ5IHRvIHVzZSB0aGUgZ2l2ZW4gcmVzdWx0IGlmIGl0J3MKICAgICAg\nICAgICAgLy8gdGhlIHNhbWUgb25lIHdlIGp1c3QgZmFpbGVkIHRvIGNvbXBs\nZXRlbHkgaW5pdGlhbGl6ZSgpIHdpdGgKICAgICAgICAgICAgaWYgKGluZm8u\nc20gIT0gc20pCiAgICAgICAgICAgICAgICByZXMgPSBpbmZvLnJlc3VsdDsK\nICAgICAgICAgICAgaW5mby5zbSA9IG51bGw7CiAgICAgICAgfQogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYW4gZXhpc3Rpbmcg\ncmVzdWx0LCBsb2FkIGFsbCB3ZSBjYW4gZnJvbSBpdAogICAgICAgICAgICBD\nbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1l\ndGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgbG9hZChtYXBwaW5nLCBzbSwgamZldGNoLCByZXMpOwog\nICAgICAgICAgICAgICAgcmVtb3ZlTG9hZGVkRmllbGRzKHNtLCBmaWVsZHMp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGUgaW5zdGFu\nY2UgaXMgaG9sbG93IGFuZCB0aGVyZSdzIGEgY3VzdG9taXplZAogICAgICAg\nICAgICAvLyBnZXQgYnkgaWQgbWV0aG9kLCB1c2UgaXQKICAgICAgICAgICAg\naWYgKHNtLmdldExvYWRlZCgpLmxlbmd0aCgpID09IDAgCiAgICAgICAgICAg\nICAgICAmJiBtYXBwaW5nLmN1c3RvbUxvYWQoc20sIHRoaXMsIG51bGwsIGpm\nZXRjaCkpCiAgICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVsZHMoc20s\nIGZpZWxkcyk7CgogICAgICAgICAgICAvLyMjIyBzZWxlY3QgaXMga2luZCBv\nZiBhIGJpZyBvYmplY3QsIGFuZCBpbiBzb21lIGNhc2VzIHdlIGRvbid0CiAg\nICAgICAgICAgIC8vIyMjIHVzZSBpdC4uLiB3b3VsZCBpdCBiZSB3b3J0aCBp\ndCB0byBoYXZlIGEgc21hbGwgc2hlbGwgc2VsZWN0CiAgICAgICAgICAgIC8v\nIyMjIG9iamVjdCB0aGF0IG9ubHkgY3JlYXRlcyBhIHJlYWwgc2VsZWN0IHdo\nZW4gYWN0dWFsbHkgdXNlZD8KCiAgICAgICAgICAgIFNlbGVjdCBzZWwgPSBf\nc3FsLm5ld1NlbGVjdCgpOwogICAgICAgICAgICBpZiAoc2VsZWN0KHNlbCwg\nbWFwcGluZywgU2VsZWN0LlNVQlNfRVhBQ1QsIHNtLCBmaWVsZHMsIGpmZXRj\naCwKICAgICAgICAgICAgICAgIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9KT0lO\nLCB0cnVlLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywgdGhpcyk7CiAg\nICAgICAgICAgICAgICByZXMgPSBzZWwuZXhlY3V0ZSh0aGlzLCBqZmV0Y2gs\nIGxvY2tMZXZlbCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIGlmICghcmVzLm5leHQoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGxvYWQo\nbWFwcGluZywgc20sIGpmZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIG5vdyBhbGxvdyB0aGUgZmllbGRzIHRvIGxvYWQgdGhlbXNlbHZlcyBpbmRp\ndmlkdWFsbHkgdG9vCiAgICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9\nIG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgIGlmIChmaWVsZHMuZ2V0KGkpICYmICFzbS5nZXRMb2FkZWQoKS5nZXQo\naSkpCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmxvYWQoc20sIHRoaXMs\nIGpmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSk7CiAgICAgICAgICAgIG1h\ncHBpbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKENsYXNzTm90\nRm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBsaXN0IGZvcm1lZCBieSByZW1vdmluZyBhbGwg\nbG9hZGVkIGZpZWxkcyBmcm9tIHRoZSBnaXZlbiBvbmUuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCByZW1vdmVMb2FkZWRGaWVsZHMoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcykgewogICAgICAgIGZvciAoaW50\nIGkgPSAwLCBsZW4gPSBmaWVsZHMubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykK\nICAgICAgICAgICAgaWYgKGZpZWxkcy5nZXQoaSkgJiYgc20uZ2V0TG9hZGVk\nKCkuZ2V0KGkpKQogICAgICAgICAgICAgICAgZmllbGRzLmNsZWFyKGkpOwog\nICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGxvYWRBbGwoQ29sbGVjdGlv\nbiBzbXMsIFBDU3RhdGUgc3RhdGUsIGludCBsb2FkLAogICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAg\nICByZXR1cm4gSW1wbEhlbHBlci5sb2FkQWxsKHNtcywgdGhpcywgc3RhdGUs\nIGxvYWQsIGZldGNoLCBjb250ZXh0KTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBiZWZvcmVTdGF0ZUNoYW5nZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQ\nQ1N0YXRlIGZyb21TdGF0ZSwKICAgICAgICBQQ1N0YXRlIHRvU3RhdGUpIHsK\nICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBmbHVzaChDb2xsZWN0aW9u\nIHNtcykgewogICAgICAgIHJldHVybiBfY29uZi5nZXRVcGRhdGVNYW5hZ2Vy\nSW5zdGFuY2UoKS5mbHVzaChzbXMsIHRoaXMpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAvLyBub3RlIHRoYXQg\ndGhpcyBtZXRob2QgZG9lcyBub3QgbG9jayB0aGUgY29udGV4dCwgc2luY2UK\nICAgICAgICAvLyB3ZSB3YW50IHRvIGFsbG93IGEgZGlmZmVyZW50IHRocmVh\nZCB0byBiZSBhYmxlIHRvIGNhbmNlbCB0aGUKICAgICAgICAvLyBvdXRzdGFu\nZGluZyBzdGF0ZW1lbnQgb24gYSBkaWZmZXJlbnQgY29udGV4dAoKICAgICAg\nICBDb2xsZWN0aW9uIHN0bW50czsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9z\ndG1udHMpIHsKICAgICAgICAgICAgaWYgKF9zdG1udHMuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBzdG1u\ndHMgPSBuZXcgQXJyYXlMaXN0KF9zdG1udHMpOwogICAgICAgIH0KCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzdG1u\ndHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAg\nICAoKFN0YXRlbWVudCkgaXRyLm5leHQoKSkuY2FuY2VsKCk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0\nb3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGFzc2lnbk9iamVjdElkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIGJvb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEgPSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhLmdldElk\nZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04p\nCiAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5hc3NpZ24oc20s\nIHRoaXMsIHByZUZsdXNoKTsKCiAgICAgICAgLy8gZGF0YXN0b3JlIGlkZW50\naXR5CiAgICAgICAgT2JqZWN0IHZhbCA9IEltcGxIZWxwZXIuZ2VuZXJhdGVJ\nZGVudGl0eVZhbHVlKF9jdHgsIG1ldGEsCiAgICAgICAgICAgIEphdmFUeXBl\ncy5MT05HKTsKICAgICAgICBpZiAodmFsID09IG51bGwgJiYgbWV0YS5nZXRJ\nZGVudGl0eVN0cmF0ZWd5KCkgIT0gVmFsdWVTdHJhdGVnaWVzLk5BVElWRSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICh2YWwgPT0g\nbnVsbCkKICAgICAgICAgICAgdmFsID0gZ2V0RGF0YVN0b3JlSWRTZXF1ZW5j\nZShtZXRhKS5uZXh0KF9jdHgsIG1ldGEpOwogICAgICAgIHNtLnNldE9iamVj\ndElkKG5ld0RhdGFTdG9yZUlkKHZhbCwgbWV0YSkpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGFzc2lnbkZpZWxk\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGludCBmaWVsZCwKICAgICAgICBi\nb29sZWFuIHByZUZsdXNoKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBP\nYmplY3QgdmFsID0gSW1wbEhlbHBlci5nZW5lcmF0ZUZpZWxkVmFsdWUoX2N0\neCwgZm1kKTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBzbS5zdG9yZShmaWVsZCwgdmFsKTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3Mg\nZ2V0TWFuYWdlZFR5cGUoT2JqZWN0IG9pZCkgewogICAgICAgIGlmIChvaWQg\naW5zdGFuY2VvZiBJZCkKICAgICAgICAgICAgcmV0dXJuICgoSWQpIG9pZCku\nZ2V0VHlwZSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1\nYmxpYyBDbGFzcyBnZXREYXRhU3RvcmVJZFR5cGUoQ2xhc3NNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgcmV0dXJuIElkLmNsYXNzOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgY29weURhdGFTdG9yZUlkKE9iamVjdCBvaWQsIENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIElkIGlkID0gKElkKSBvaWQ7CiAg\nICAgICAgcmV0dXJuIG5ldyBJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwg\naWQuZ2V0SWQoKSwgaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IG5ld0RhdGFTdG9yZUlkKE9iamVjdCB2YWwsIENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBJZC5uZXdJbnN0YW5j\nZShtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgdmFsKTsKICAgIH0KCiAgICBw\ndWJsaWMgSWQgbmV3RGF0YVN0b3JlSWQobG9uZyBpZCwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGJvb2xlYW4gc3VicykgewogICAgICAgIHJldHVybiBuZXcg\nSWQobWFwcGluZy5nZXREZXNjcmliZWRUeXBlKCksIGlkLCBzdWJzKTsKICAg\nIH0KCiAgICBwdWJsaWMgUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZUV4\ndGVudChDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgZmluYWwgYm9vbGVh\nbiBzdWJjbGFzc2VzLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIG1l\ndGE7CiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3M7CiAg\nICAgICAgaWYgKHN1YmNsYXNzZXMpCiAgICAgICAgICAgIG1hcHBpbmdzID0g\nbWFwcGluZy5nZXRJbmRlcGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgbWFwcGluZ3MgPSBuZXcgQ2xhc3NN\nYXBwaW5nW10geyBtYXBwaW5nIH07CgogICAgICAgIFJlc3VsdE9iamVjdFBy\nb3ZpZGVyW10gcm9wcyA9IG51bGw7CiAgICAgICAgZmluYWwgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBqZmV0Y2ggPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbikgZmV0Y2g7CiAgICAgICAgaWYgKGpmZXRjaC5nZXRTdWJjbGFzc0ZldGNo\nTW9kZShtYXBwaW5nKSAhPSBqZmV0Y2guRUFHRVJfSk9JTikKICAgICAgICAg\nICAgcm9wcyA9IG5ldyBSZXN1bHRPYmplY3RQcm92aWRlclttYXBwaW5ncy5s\nZW5ndGhdOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjaGVjayBm\nb3IgY3VzdG9tIGxvYWRzCiAgICAgICAgICAgIFJlc3VsdE9iamVjdFByb3Zp\nZGVyIHJvcDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBw\naW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcm9wID0gbWFw\ncGluZ3NbaV0uY3VzdG9tTG9hZCh0aGlzLCBzdWJjbGFzc2VzLCBqZmV0Y2gs\nIDAsCiAgICAgICAgICAgICAgICAgICAgTG9uZy5NQVhfVkFMVUUpOwogICAg\nICAgICAgICAgICAgaWYgKHJvcCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHJvcHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcm9wcyA9IG5ldyBSZXN1bHRPYmplY3RQcm92aWRlclttYXBwaW5ncy5s\nZW5ndGhdOwogICAgICAgICAgICAgICAgICAgIHJvcHNbaV0gPSByb3A7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGlmIHdlJ3JlIHNlbGVjdGluZyBpbmRlcGVuZGVudCBtYXBwaW5ncyBzZXBh\ncmF0ZWx5IG9yIGhhdmUKICAgICAgICAgICAgLy8gY3VzdG9tIGxvYWRzLCBk\nbyBpbmRpdmlkdWFsIHNlbGVjdHMgZm9yIGVhY2ggY2xhc3MKICAgICAgICAg\nICAgcm9wID0gbnVsbDsKICAgICAgICAgICAgaWYgKHJvcHMgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5n\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChyb3Bz\nW2ldICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdT\nZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0TFJTKHRydWUp\nOwogICAgICAgICAgICAgICAgICAgIEJpdFNldCBwYWdlZCA9IHNlbGVjdEV4\ndGVudChzZWwsIG1hcHBpbmdzW2ldLCBqZmV0Y2gsCiAgICAgICAgICAgICAg\nICAgICAgICAgIHN1YmNsYXNzZXMpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwYWdlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICByb3Bz\nW2ldID0gbmV3IEluc3RhbmNlUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZ3NbaV0sIHRoaXMs\nIGpmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICByb3BzW2ldID0gbmV3IFBhZ2luZ1Jlc3VsdE9iamVj\ndFByb3ZpZGVyKHNlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1h\ncHBpbmdzW2ldLCB0aGlzLCBqZmV0Y2gsIHBhZ2VkLCBMb25nLk1BWF9WQUxV\nRSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocm9w\ncy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9w\nc1swXTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTWVyZ2VkUmVzdWx0\nT2JqZWN0UHJvdmlkZXIocm9wcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIHBlcmZvcm0gYSB1bmlvbiBvbiBhbGwgaW5kZXBlbmRlbnQgY2xh\nc3NlcwogICAgICAgICAgICBVbmlvbiB1bmlvbiA9IF9zcWwubmV3VW5pb24o\nbWFwcGluZ3MubGVuZ3RoKTsKICAgICAgICAgICAgdW5pb24uc2V0TFJTKHRy\ndWUpOwogICAgICAgICAgICBmaW5hbCBCaXRTZXRbXSBwYWdlZCA9IG5ldyBC\naXRTZXRbbWFwcGluZ3MubGVuZ3RoXTsKICAgICAgICAgICAgdW5pb24uc2Vs\nZWN0KG5ldyBVbmlvbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAg\nICAgICAgICAgICAgICAgcGFnZWRbaWR4XSA9IHNlbGVjdEV4dGVudChzZWws\nIG1hcHBpbmdzW2lkeF0sIGpmZXRjaCwKICAgICAgICAgICAgICAgICAgICAg\nICAgc3ViY2xhc3Nlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0pOwoKICAgICAgICAgICAgLy8gdXNpbmcgcGFnaW5nIHJvcCBpZiBhbnkg\ndW5pb24gZWxlbWVudCBoYXMgcGFnZWQgZmllbGRzCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcGFnZWQubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChwYWdlZFtpXSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIo\ndW5pb24sIG1hcHBpbmdzLAogICAgICAgICAgICAgICAgICAgICAgICBKREJD\nU3RvcmVNYW5hZ2VyLnRoaXMsIGpmZXRjaCwgcGFnZWQsIExvbmcuTUFYX1ZB\nTFVFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IElu\nc3RhbmNlUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdzWzBd\nLCB0aGlzLAogICAgICAgICAgICAgICAgamZldGNoKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZ2l2ZW4gbWFwcGluZyBm\nb3IgdXNlIGluIGFuIGV4dGVudCwgcmV0dXJuaW5nIHBhZ2VkIGZpZWxkcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBCaXRTZXQgc2VsZWN0RXh0ZW50KFNlbGVj\ndCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJvb2xlYW4gc3ViY2xhc3Nlcykgewog\nICAgICAgIGludCBzdWJzID0gKHN1YmNsYXNzZXMpID8gU2VsZWN0LlNVQlNf\nSk9JTkFCTEUgOiBTZWxlY3QuU1VCU19OT05FOwogICAgICAgIC8vIGRlY2lk\nZSBiZXR3ZWVuIHBhZ2luZyBhbmQgc3RhbmRhcmQgaXRlcmF0aW9uCiAgICAg\nICAgQml0U2V0IHBhZ2VkID0gUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIu\nZ2V0UGFnZWRGaWVsZHMoc2VsLCBtYXBwaW5nLAogICAgICAgICAgICB0aGlz\nLCBmZXRjaCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9QQVJBTExF\nTCwKICAgICAgICAgICAgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgIGlmIChw\nYWdlZCA9PSBudWxsKQogICAgICAgICAgICBzZWwuc2VsZWN0SWRlbnRpZmll\ncihtYXBwaW5nLCBzdWJzLCB0aGlzLCBmZXRjaCwKICAgICAgICAgICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFSQUxMRUwpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgc2VsLnNlbGVjdElkZW50aWZpZXIobWFw\ncGluZywgc3VicywgdGhpcywgZmV0Y2gsCiAgICAgICAgICAgICAgICBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4pOwogICAgICAgIHJldHVy\nbiBwYWdlZDsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBuZXdRdWVy\neShTdHJpbmcgbGFuZ3VhZ2UpIHsKICAgICAgICBFeHByZXNzaW9uUGFyc2Vy\nIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZ3Vh\nZ2UpOwogICAgICAgIGlmIChlcCAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbmV3IEpEQkNTdG9yZVF1ZXJ5KHRoaXMsIGVwKTsKICAgICAgICBpZiAo\nUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKGxhbmd1YWdlKSkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTUUxTdG9yZVF1ZXJ5KHRoaXMpOwogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gbmV3RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJl\ndHVybiBuZXcgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgIH0K\nCiAgICBwdWJsaWMgU2VxIGdldERhdGFTdG9yZUlkU2VxdWVuY2UoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlT\ndHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUKICAgICAgICAg\nICAgfHwgbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJh\ndGVnaWVzLk5PTkUpCiAgICAgICAgICAgIHJldHVybiBfY29uZi5nZXRTZXF1\nZW5jZUluc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwpCiAg\nICAgICAgICAgIF9jb25uLmZyZWUoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAv\nKioKICAgICAqIENvbm5lY3QgdG8gdGhlIGRiLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgY29ubmVjdChib29sZWFuIHJlZikgewogICAgICAgIF9jdHgu\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbm5lY3Qg\naWYgdGhlIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IG51bGwsIG9yIGlmCiAg\nICAgICAgICAgIC8vIHRoZSBjb25uZWN0aW9uIGhhcyBiZWVuIGNsb3NlZCBv\ndXQgZnJvbSB1bmRlciB1cwogICAgICAgICAgICBpZiAoX2Nvbm4gPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9jb25uID0gY29ubmVjdEludGVybmFsKCk7\nCiAgICAgICAgICAgIGlmIChyZWYpCiAgICAgICAgICAgICAgICBfY29ubi5y\nZWYoKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jdHgudW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVj\ndCB0byB0aGUgZGF0YWJhc2UuIFRoaXMgbWV0aG9kIGlzIHNlcGFyYXRlZCBv\ndXQgc28gdGhhdCBpdAogICAgICogY2FuIGJlIG92ZXJyaWRkZW4uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBSZWZDb3VudENvbm5lY3Rpb24gY29ubmVjdElu\ndGVybmFsKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIG5ldyBSZWZDb3VudENvbm5lY3Rpb24oX2RzLmdldENvbm5lY3Rpb24oKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBvYmplY3Qgd2l0aCB0\naGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQo\nT2JqZWN0IG9pZCwgVmFsdWVNYXBwaW5nIHZtLCAKICAgICAgICBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKG9pZCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBPYmplY3Qg\ncGMgPSBfY3R4LmZpbmQob2lkLCBmZXRjaCwgbnVsbCwgbnVsbCwgMCk7CiAg\nICAgICAgaWYgKHBjID09IG51bGwgJiYgdm0gIT0gbnVsbCkgewogICAgICAg\nICAgICBPcnBoYW5lZEtleUFjdGlvbiBhY3Rpb24gPSBfY29uZi5nZXRPcnBo\nYW5lZEtleUFjdGlvbkluc3RhbmNlKCk7CiAgICAgICAgICAgIHBjID0gYWN0\naW9uLm9ycGhhbihvaWQsIG51bGwsIHZtKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHBjOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgb2Jq\nZWN0IGluIHRoZSBjdXJyZW50IHJvdyBvZiB0aGUgZ2l2ZW4gcmVzdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGxvYWQoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAg\nQml0U2V0IGV4Y2x1ZGUsIFJlc3VsdCByZXN1bHQpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICghbWFwcGluZy5pc01hcHBlZCgpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ2aXJ0dWFsLW1hcHBpbmciLCAKICAgICAgICAgICAgICAgIG1hcHBp\nbmcpKTsKCiAgICAgICAgLy8gZ2V0IHRoZSBvYmplY3QgaWQgZm9yIHRoZSBy\nb3c7IGJhc2UgY2xhc3Mgc2VsZWN0cyBwayBjb2x1bW5zCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIGJhc2UgPSBtYXBwaW5nOwogICAgICAgIHdoaWxlIChiYXNl\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAg\nICAgICAgICAgIGJhc2UgPSBiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpOwogICAgICAgIE9iamVjdCBvaWQgPSBiYXNlLmdldE9iamVj\ndElkKHRoaXMsIHJlc3VsdCwgbnVsbCwgdHJ1ZSwgbnVsbCk7CiAgICAgICAg\naWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IG5ldyBDb25uZWN0aW9uSW5m\nbygpOwogICAgICAgIGluZm8ucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIGlu\nZm8ubWFwcGluZyA9IG1hcHBpbmc7CiAgICAgICAgcmV0dXJuIF9jdHguZmlu\nZChvaWQsIGZldGNoLCBleGNsdWRlLCBpbmZvLCAwKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIExvYWQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgd2l0aCBk\nYXRhIGZyb20gdGhlIHJlc3VsdCBzZXQuIE9ubHkKICAgICAqIG1hcHBpbmdz\nIG9yaWdpbmFsbHkgc2VsZWN0ZWQgd2lsbCBiZSBsb2FkZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSA9IGxvYWQo\nbWFwcGluZywgc20sIGZldGNoLCByZXMsIG51bGwpOwogICAgICAgIGlmIChl\nYWdlclRvTWFueSAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueS5s\nb2FkRWFnZXJKb2luKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZWFn\nZXJUb01hbnkpLAogICAgICAgICAgICAgICAgcmVzKTsKICAgICAgICBpZiAo\nX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2NraW5nKCkpCiAg\nICAgICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAgfQoKICAg\nIC8qKgogICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBnaXZlbiBtYXBw\naW5nLiBSZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQKICAgICAqIHdp\ndGhvdXQgbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBGaWVsZE1h\ncHBpbmcgbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBSZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG1hcHBp\nbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykpCiAgICAgICAg\nICAgIHJldHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8gbG9hZCBzdXBl\ncmNsYXNzIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lvbgogICAgICAg\nIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJlbnQgIT0gbnVs\nbCkKICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBhcmVudCwgc20s\nIGZldGNoLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBlbHNlIGlmIChz\nbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgbWFwcGluZy5n\nZXRWZXJzaW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAgICAgICAgLy8g\nbG9hZCB1bmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1hcHBpbmdbXSBm\nbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAg\nICAgT2JqZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nZm1zW2ldLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRlZCgpLmdldChm\nbXNbaV0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBlYWdlciBy\nZXN1bHQsIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFyZCBsb2FkCiAg\nICAgICAgICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ldKTsKICAgICAg\nICAgICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0gcmVzKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09IG51bGwgJiYg\nZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9h\nZEVhZ2VySm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgICAg\nIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdlclBhcmFsbGVs\nKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVy\nc2VKREJDKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwcm9jZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAgICAgICAgICAg\ncmVzLnB1dEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5sb2FkKHNt\nLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHJlcy5lbmRE\nYXRhUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioKICAgICAqIEZv\nciBpbXBsZW1lbnRhdGlvbiB1c2Ugb25seS4KICAgICAqIFJldHVybiBhIHNl\nbGVjdCBmb3IgdGhlIHByb3BlciBtYXBwaW5ncy4gUmV0dXJuIG51bGwgaWYg\nbm8gc2VsZWN0IGlzCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRob2QgaXMgZGVz\naWduZWQgdG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGUgbG9hZCBtZXRob2Rz\nLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRvIGJ1aWxkIG9u\nCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBmb3IgdGhlIGJh\nc2UgdHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gc3VicyB3aGV0\naGVyIHRoZSBzZWxlY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFzc2VzIG9mIHRo\nZQogICAgICogZ2l2ZW4gbWFwcGluZwogICAgICogQHBhcmFtIHNtIHN0YXRl\nIG1hbmFnZXIgaWYgYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9hZGVkIG9yCiAg\nICAgKiBpbml0aWFsaXplZCwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmll\nbGRzIGlmIGEgc3RhdGUgbWFuYWdlciBpcyBiZWluZyBsb2FkZWQsIHRoZSBz\nZXQgb2YKICAgICAqIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9hZGVkIGluIG9y\nZGVyLCBlbHNlIG51bGwKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2gg\nY29uZmlndXJhdGlvbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBmaWVsZHMKICAg\nICAqIG11c3QgYmUgbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNlbGVjdGluZyBy\nZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciBlYWdlciBmZXRjaCBtb2Rl\nIHRvIHVzZQogICAgICogQHBhcmFtIGlkZW50IHdoZXRoZXIgdG8gc2VsZWN0\nIHByaW1hcnkga2V5IGNvbHVtbnMgYXMgZGlzdGluY3QKICAgICAqIGlkZW50\naWZpZXJzCiAgICAgKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3ZSdyZSBvdXRl\nci1qb2luaW5nIHRvIHRoaXMgdHlwZQogICAgICogQHJldHVybiB0cnVlIGlm\nIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIGZhbHNlIG90aGVyd2lzZQogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0IHNlbCwgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyLCBib29sZWFuIGlk\nZW50LCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gYWRkIGNsYXNzIGNv\nbmRpdGlvbnMgc28gdGhhdCB0aGV5J3JlIGNsb25lZCBmb3IgYW55IGJhdGNo\nZWQgc2VsZWN0cwogICAgICAgIGJvb2xlYW4gam9pbmVkU3VwZXJzID0gZmFs\nc2U7CiAgICAgICAgaWYgKChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUo\nKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCkKICAgICAgICAgICAgJiYgKHN1YnMg\nPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgfHwgc3VicyA9PSBTZWxlY3QuU1VC\nU19OT05FKSkgewogICAgICAgICAgICBsb2FkU3ViY2xhc3NlcyhtYXBwaW5n\nKTsgCiAgICAgICAgICAgIEpvaW5zIGpvaW5zID0gKG91dGVyKSA/IHNlbC5u\nZXdPdXRlckpvaW5zKCkgOiBudWxsOwogICAgICAgICAgICBqb2luZWRTdXBl\ncnMgPSBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRDbGFzc0NvbmRp\ndGlvbnMoc2VsLAogICAgICAgICAgICAgICAgc3VicyA9PSBTZWxlY3QuU1VC\nU19KT0lOQUJMRSwgam9pbnMpOwogICAgICAgIH0KCiAgICAgICAgLy8gY3Jl\nYXRlIGFsbCBvdXIgZWFnZXIgc2VsZWN0cyBzbyB0aGF0IHRob3NlIGZpZWxk\ncyBhcmUgcmVzZXJ2ZWQKICAgICAgICAvLyBhbmQgY2Fubm90IGJlIHJldXNl\nZCBkdXJpbmcgdGhlIGFjdHVhbCBlYWdlciBzZWxlY3QgcHJvY2VzcywKICAg\nICAgICAvLyBwcmV2ZW50aW5nIGluZmluaXRlIHJlY3Vyc2lvbgogICAgICAg\nIGVhZ2VyID0gTWF0aC5taW4oZWFnZXIsIGZldGNoLmdldEVhZ2VyRmV0Y2hN\nb2RlKCkpOwogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSA9IGNy\nZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIG1hcHBpbmcsIHNtLCBmaWVsZHMsCiAg\nICAgICAgICAgIGZldGNoLCBlYWdlcik7CgogICAgICAgIC8vIHNlbGVjdCBh\nbGwgYmFzZSBjbGFzcyBtYXBwaW5nczsgZG8gdGhpcyBhZnRlciBiYXRjaGlu\nZyBzbyB0aGF0CiAgICAgICAgLy8gdGhlIGpvaW5zIG5lZWRlZCBieSB0aGVz\nZSBzZWxlY3RzIGRvbid0IGdldCBpbiB0aGUgV0hFUkUgY2xhdXNlCiAgICAg\nICAgLy8gb2YgdGhlIGJhdGNoZWQgc2VsZWN0cwogICAgICAgIGludCBzZWxk\nID0gc2VsZWN0QmFzZU1hcHBpbmdzKHNlbCwgbWFwcGluZywgbWFwcGluZywg\nc20sIGZpZWxkcywKICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyLCBlYWdlclRv\nTWFueSwgaWRlbnQsIGpvaW5lZFN1cGVycyk7CgogICAgICAgIC8vIHNlbGVj\ndCBlYWdlciB0by1tYW55IHJlbGF0aW9ucyBsYXN0IGJlY2F1c2UgZHVyaW5n\nIGxvYWQgdGhleQogICAgICAgIC8vIGFkdmFuY2UgdGhlIHJlc3VsdCBzZXQg\nYW5kIGNvdWxkIGV4aGF1c3QgaXQsIHNvIG5vIG90aGVyIG1hcHBpbmdzCiAg\nICAgICAgLy8gY2FuIGxvYWQgYWZ0ZXJ3b3JkcwogICAgICAgIGlmIChlYWdl\nclRvTWFueSAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueS5zZWxl\nY3RFYWdlckpvaW4oc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICBm\nZXRjaC50cmF2ZXJzZUpEQkMoZWFnZXJUb01hbnkpLCBlYWdlcik7CgogICAg\nICAgIC8vIG9wdGlvbmFsbHkgc2VsZWN0IHN1YmNsYXNzIG1hcHBpbmdzCiAg\nICAgICAgaWYgKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgfHwgc3Vi\ncyA9PSBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEUpCiAgICAgICAgICAgIHNl\nbGVjdFN1YmNsYXNzTWFwcGluZ3Moc2VsLCBtYXBwaW5nLCBzbSwgZmV0Y2gp\nOwogICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICBzZWwuc2V0\nRGlzdGluY3QoZmFsc2UpOwogICAgICAgIHJldHVybiBzZWxkID4gMDsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhlIGZpZWxkcyBvZiB0aGlzIG1h\ncHBpbmcgYXMgcmVzZXJ2ZWQgc28gdGhhdCBlYWdlciBmZXRjaGVzIGNhbid0\nCiAgICAgKiBnZXQgaW50byBpbmZpbml0ZSByZWN1cnNpdmUgc2l0dWF0aW9u\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcgY3JlYXRlRWFn\nZXJTZWxlY3RzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVh\nZ2VyKSB7CiAgICAgICAgaWYgKG1hcHBpbmcgPT0gbnVsbCB8fCBlYWdlciA9\nPSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX05PTkUpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWFnZXJU\nb01hbnkgPSBjcmVhdGVFYWdlclNlbGVjdHMoc2VsLCAKICAgICAgICAgICAg\nbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSwgc20s\nIGZpZWxkcywgZmV0Y2gsIGVhZ2VyKTsKCiAgICAgICAgRmllbGRNYXBwaW5n\nW10gZm1zID0gbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwog\nICAgICAgIGJvb2xlYW4gaW5FYWdlckpvaW4gPSBzZWwuaGFzRWFnZXJKb2lu\nKGZhbHNlKTsKICAgICAgICBpbnQgc2VsczsKICAgICAgICBpbnQganR5cGU7\nCiAgICAgICAgaW50IG1vZGU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbW9kZSA9IGZtc1tp\nXS5nZXRFYWdlckZldGNoTW9kZSgpOwogICAgICAgICAgICBpZiAobW9kZSA9\nPSBmZXRjaC5FQUdFUl9OT05FKQogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIGlmICghcmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwg\nZmllbGRzLCBmZXRjaCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIC8vIHRyeSB0byBzZWxlY3Qgd2l0aCBqb2luIGZpcnN0CiAg\nICAgICAgICAgIGp0eXBlID0gKGZtc1tpXS5nZXROdWxsVmFsdWUoKSA9PSBm\nbXNbaV0uTlVMTF9FWENFUFRJT04pIAogICAgICAgICAgICAgICAgPyBzZWwu\nRUFHRVJfSU5ORVIgOiBzZWwuRUFHRVJfT1VURVI7CiAgICAgICAgICAgIGlm\nIChtb2RlICE9IGZldGNoLkVBR0VSX1BBUkFMTEVMICYmICFmbXNbaV0uaXNF\nYWdlclNlbGVjdFRvTWFueSgpCiAgICAgICAgICAgICAgICAmJiBmbXNbaV0u\nc3VwcG9ydHNTZWxlY3Qoc2VsLCBqdHlwZSwgc20sIHRoaXMsIGZldGNoKSA+\nIDAKICAgICAgICAgICAgICAgICYmIHNlbC5lYWdlckNsb25lKGZtc1tpXSwg\nanR5cGUsIGZhbHNlLCAxKSAhPSBudWxsKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICBib29sZWFuIGhhc0pvaW4gPSBmZXRjaC5o\nYXNKb2luKGZtc1tpXS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICAg\nICAgLy8gaWYgdGhlIGZpZWxkIGRlY2xhcmVzIGEgcHJlZmVycmVkIHNlbGVj\ndCBtb2RlIG9mIGpvaW4gb3IgZG9lcyBub3QKICAgICAgICAgICAgLy8gaGF2\nZSBhIHByZWZlcnJlZCBtb2RlIGFuZCB3ZSdyZSBkb2luZyBhIGJ5LWlkIGxv\nb2t1cCwgdHJ5CiAgICAgICAgICAgIC8vIHRvIHVzZSBhIHRvLW1hbnkgam9p\nbiBhbHNvLiAgY3VycmVudGx5IHdlIGxpbWl0IGVhZ2VyCiAgICAgICAgICAg\nIC8vIG91dGVyIGpvaW5zIHRvIG5vbi1MUlMsIG5vbi1yYW5nZWQgc2VsZWN0\ncyB0aGF0IGRvbid0IGFscmVhZHkKICAgICAgICAgICAgLy8gaGF2ZSBhbiBl\nYWdlciB0by1tYW55IGpvaW4KICAgICAgICAgICAgaWYgKChoYXNKb2luIHx8\nIG1vZGUgPT0gZmV0Y2guRUFHRVJfSk9JTiAKICAgICAgICAgICAgICAgIHx8\nIChtb2RlID09IGZldGNoLkRFRkFVTFQgJiYgc20gIT0gbnVsbCkpCiAgICAg\nICAgICAgICAgICAmJiBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpCiAg\nICAgICAgICAgICAgICAmJiAhaW5FYWdlckpvaW4KICAgICAgICAgICAgICAg\nICYmICFzZWwuaGFzRWFnZXJKb2luKHRydWUpCiAgICAgICAgICAgICAgICAm\nJiAoIXNlbC5nZXRBdXRvRGlzdGluY3QoKSB8fCAoIXNlbC5pc0xSUygpCiAg\nICAgICAgICAgICAgICAmJiBzZWwuZ2V0U3RhcnRJbmRleCgpID09IDAgCiAg\nICAgICAgICAgICAgICAmJiBzZWwuZ2V0RW5kSW5kZXgoKSA9PSBMb25nLk1B\nWF9WQUxVRSkpCiAgICAgICAgICAgICAgICAmJiBmbXNbaV0uc3VwcG9ydHNT\nZWxlY3Qoc2VsLCBqdHlwZSwgc20sIHRoaXMsIGZldGNoKSA+IDApIHsKICAg\nICAgICAgICAgICAgIGlmIChzZWwuZWFnZXJDbG9uZShmbXNbaV0sIGp0eXBl\nLCB0cnVlLCAxKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGVhZ2Vy\nVG9NYW55ID0gZm1zW2ldOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBmaW5hbGx5LCB0cnkgcGFyYWxsZWwKICAgICAgICAgICAgaWYg\nKGVhZ2VyID09IGZldGNoLkVBR0VSX1BBUkFMTEVMCiAgICAgICAgICAgICAg\nICAmJiAoc2VscyA9IGZtc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIHNlbC5F\nQUdFUl9QQVJBTExFTCwgc20sCiAgICAgICAgICAgICAgICB0aGlzLCBmZXRj\naCkpICE9IDApCiAgICAgICAgICAgICAgICBzZWwuZWFnZXJDbG9uZShmbXNb\naV0sIFNlbGVjdC5FQUdFUl9QQVJBTExFTCwgCiAgICAgICAgICAgICAgICAg\nICAgZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSwgc2Vscyk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAv\nKioKICAgICAqIERldGVybWluZSBpZiB0aGUgZ2l2ZW4gZmllbGQgbmVlZHMg\ndG8gYmUgc2VsZWN0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gcmVxdWlyZXNTZWxlY3QoRmllbGRNYXBwaW5nIGZtLAogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAoZmllbGRz\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmaWVsZHMuZ2V0KGZtLmdl\ndEluZGV4KCkpOwogICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmdldFBD\nU3RhdGUoKSAhPSBQQ1N0YXRlLlRSQU5TSUVOVAogICAgICAgICAgICAmJiBz\nbS5nZXRMb2FkZWQoKS5nZXQoZm0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gZmV0Y2gucmVxdWlyZXNG\nZXRjaChmbSkgPT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX0xPQUQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGZpZWxkIG1hcHBpbmdz\nIG9mIHRoZSBnaXZlbiBjbGFzcyBhbmQgYWxsIGl0cyBzdXBlcmNsYXNzZXMu\nCiAgICAgKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQog\nICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIG1vc3QtZGVyaXZlZCB0eXBlIHRv\nIHNlbGVjdCBmb3IKICAgICAqIEBwYXJhbSBvcmlnIHRoZSBvcmlnaW5hbCBt\nYXBwaW5nIHR5cGUgc2VsZWN0ZWQKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5z\ndGFuY2UgYmVpbmcgc2VsZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAg\nICAqIEBwYXJhbSBmaWVsZHMgdGhlIGZpZWxkcyB0byBsb2FkCiAgICAgKiBA\ncGFyYW0gZmV0Y2ggZmV0Y2ggY29uZmlndXJhdGlvbiB0byB1c2UgZm9yIGxv\nYWRpbmcgcmVsYXRpb25zCiAgICAgKiBAcGFyYW0gZWFnZXIgdGhlIGVhZ2Vy\nIGZldGNoIG1vZGUgdG8gdXNlCiAgICAgKiBAcGFyYW0gam9pbmVkIHdoZXRo\nZXIgdGhlIGNsYXNzIGhhcyBhbHJlYWR5IGJlZW4gam9pbmVkIGRvd24gdG8K\nICAgICAqIGl0cyBiYXNlIGNsYXNzCiAgICAgKiBAcmV0dXJuICZndDsgMCBp\nZiB0aGUgc2VsZWN0IGlzIHJlcXVpcmVkLCAwIGlmIGRhdGEgd2FzCiAgICAg\nKiBzZWxlY3RlZCBidXQgaXMgbm90IHJlcXVpcmVkLCBhbmQgJmx0OyAwIGlm\nIG5vdGhpbmcgd2FzIHNlbGVjdGVkCiAgICAgKi8KICAgIHByaXZhdGUgaW50\nIHNlbGVjdEJhc2VNYXBwaW5ncyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcg\nbWFwcGluZywKICAgICAgICBDbGFzc01hcHBpbmcgb3JpZywgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIsIEZpZWxkTWFwcGlu\nZyBlYWdlclRvTWFueSwKICAgICAgICBib29sZWFuIGlkZW50LCBib29sZWFu\nIGpvaW5lZCkgewogICAgICAgIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBw\naW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAg\nIGlmIChwYXJlbnQgPT0gbnVsbCAmJiAhbWFwcGluZy5pc01hcHBlZCgpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJ2aXJ0dWFsLW1hcHBpbmciLCBtYXBwaW5nLgogICAgICAgICAg\nICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSk7CgogICAgICAgIGludCBzZWxk\nID0gLTE7CiAgICAgICAgaW50IHBzZWxkID0gLTE7CgogICAgICAgIC8vIGJh\nc2UgY2xhc3Mgc2VsZWN0cyBwa3MsIGV0YwogICAgICAgIGlmIChwYXJlbnQg\nPT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSwgc2Vs\nZWN0IHBrcwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKGlkZW50KQogICAgICAgICAgICAgICAgICAgIHNlbC5z\nZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMo\nKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nc2VsLnNlbGVjdChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpOwog\nICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGlmIG5vIGluc3RhbmNlIG9yIG5vdCBpbml0aWFsaXplZCBh\nbmQgbm90IGV4YWN0IG9pZCwgc2VsZWN0IHR5cGUKICAgICAgICAgICAgaWYg\nKChzbSA9PSBudWxsIHx8IChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5U\nUkFOU0lFTlQgCiAgICAgICAgICAgICAgICAmJiAoIShzbS5nZXRPYmplY3RJ\nZCgpIGluc3RhbmNlb2YgT3BlbkpQQUlkKSAKICAgICAgICAgICAgICAgIHx8\nICgoT3BlbkpQQUlkKSBzbS5nZXRPYmplY3RJZCgpKS5oYXNTdWJjbGFzc2Vz\nKCkpKSkKICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0RGlzY3JpbWlu\nYXRvcigpLnNlbGVjdChzZWwsIG9yaWcpKQogICAgICAgICAgICAgICAgc2Vs\nZCA9IDE7CgogICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSBvciBubyB2\nZXJzaW9uLCBzZWxlY3QgdmVyc2lvbgogICAgICAgICAgICBpZiAoKHNtID09\nIG51bGwgfHwgc20uZ2V0VmVyc2lvbigpID09IG51bGwpCiAgICAgICAgICAg\nICAgICAmJiBtYXBwaW5nLmdldFZlcnNpb24oKS5zZWxlY3Qoc2VsLCBvcmln\nKSkKICAgICAgICAgICAgICAgIHNlbGQgPSAxOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIC8vIHJlY3Vyc2Ugb24gcGFyZW50CiAgICAgICAgICAg\nIHBzZWxkID0gc2VsZWN0QmFzZU1hcHBpbmdzKHNlbCwgcGFyZW50LCBvcmln\nLCBzbSwgZmllbGRzLAogICAgICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyLCBl\nYWdlclRvTWFueSwgaWRlbnQsIGpvaW5lZCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBzZWxlY3QgdGhlIG1hcHBpbmdzIGluIHRoZSBnaXZlbiBmaWVsZHMg\nc2V0LCBvciBiYXNlZCBvbiBmZXRjaAogICAgICAgIC8vIGNvbmZpZ3VyYXRp\nb24gaWYgbm8gZmllbGRzIGdpdmVuCiAgICAgICAgRmllbGRNYXBwaW5nW10g\nZm1zID0gbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAg\nICAgIFNlbGVjdEV4ZWN1dG9yIGVzZWw7CiAgICAgICAgaW50IGZzZWxkOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIC8vIHNraXAgZWFnZXIgdG8tbWFueSBzZWxlY3Q7IHdl\nIGRvIHRoYXQgc2VwYXJhdGVseSBpbiBjYWxsaW5nCiAgICAgICAgICAgIC8v\nIG1ldGhvZAogICAgICAgICAgICBpZiAoZm1zW2ldID09IGVhZ2VyVG9NYW55\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBj\naGVjayBmb3IgZWFnZXIgc2VsZWN0CiAgICAgICAgICAgIGVzZWwgPSBzZWwu\nZ2V0RWFnZXIoZm1zW2ldKTsKICAgICAgICAgICAgaWYgKGVzZWwgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgaWYgKGVzZWwgPT0gc2VsKQogICAgICAg\nICAgICAgICAgICAgIGZtc1tpXS5zZWxlY3RFYWdlckpvaW4oc2VsLCBzbSwg\ndGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRC\nQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VyUGFyYWxsZWwoZXNl\nbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2\nZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2Vs\nZCA9IE1hdGgubWF4KDAsIHNlbGQpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHJlcXVpcmVzU2VsZWN0KGZtc1tpXSwgc20sIGZpZWxkcywgZmV0Y2gpKSB7\nCiAgICAgICAgICAgICAgICBmc2VsZCA9IGZtc1tpXS5zZWxlY3Qoc2VsLCBz\nbSwgdGhpcywgCiAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJD\nKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNlbGQgPSBNYXRo\nLm1heChmc2VsZCwgc2VsZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0\nU2VsZWN0KGZtc1tpXSwgc2VsLCBzbSwgZmV0Y2gpKSB7CiAgICAgICAgICAg\nICAgICBmc2VsZCA9IGZtc1tpXS5zZWxlY3Qoc2VsLCBzbSwgdGhpcywgCiAg\nICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGZl\ndGNoLkVBR0VSX05PTkUpOwoKICAgICAgICAgICAgICAgIC8vIGRvbid0IHVw\nZ3JhZGUgc2VsZCB0byA+IDAgYmFzZWQgb24gdGhlc2UgZmllbGRzLCBzaW5j\nZQogICAgICAgICAgICAgICAgLy8gdGhleSdyZSBub3QgaW4gdGhlIGNhbGN1\nbGF0ZWQgZmllbGQgc2V0CiAgICAgICAgICAgICAgICBpZiAoZnNlbGQgPj0g\nMCAmJiBzZWxkIDwgMCkKICAgICAgICAgICAgICAgICAgICBzZWxkID0gMDsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gam9pbiB0byBw\nYXJlbnQgdGFibGUgaWYgdGhlIHBhcmVudCAvIGFueSBhbmNlc3RvcnMgaGF2\nZSBzZWxlY3RlZAogICAgICAgIC8vIGFueXRoaW5nCiAgICAgICAgaWYgKCFq\nb2luZWQgJiYgcHNlbGQgPj0gMCAmJiBwYXJlbnQuZ2V0VGFibGUoKSAhPSBt\nYXBwaW5nLmdldFRhYmxlKCkpCiAgICAgICAgICAgIHNlbC53aGVyZShtYXBw\naW5nLmpvaW5TdXBlcmNsYXNzKHNlbC5uZXdKb2lucygpLCBmYWxzZSkpOwoK\nICAgICAgICAvLyByZXR1cm4gdGhlIGhpZ2hlc3QgdmFsdWUKICAgICAgICBy\nZXR1cm4gTWF0aC5tYXgocHNlbGQsIHNlbGQpOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hlbiBzZWxlY3RpbmcgZmllbGRlcywgYSBzcGVjaWFsIGNhc2Ug\naXMgbWFkZSBmb3IgbWFwcGluZ3MgdGhhdCB1c2UKICAgICAqIDItcGFydCBz\nZWxlY3RzIHRoYXQgYXJlbid0IGV4cGxpY2l0bHkgKm5vdCogaW4gdGhlIGRm\nZyBzbyB0aGF0IHRoZXkKICAgICAqIGNhbiBnZXQgdGhlaXIgcHJpbWFyeSB0\nYWJsZSBkYXRhLiBUaGlzIG1ldGhvZCB0ZXN0cyBmb3IgdGhhdCBzcGVjaWFs\nCiAgICAgKiBjYXNlIGFzIGFuIG9wdGltaXphdGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIG9wdFNlbGVjdChGaWVsZE1hcHBpbmcgZm0sIFNl\nbGVjdCBzZWwsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVybiAh\nZm0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAgICYmICFm\nbS5pc0RlZmF1bHRGZXRjaEdyb3VwRXhwbGljaXQoKQogICAgICAgICAgICAm\nJiAoc20gPT0gbnVsbCB8fCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5U\nUkFOU0lFTlQgCiAgICAgICAgICAgIHx8ICFzbS5nZXRMb2FkZWQoKS5nZXQo\nZm0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICYmIGZtLnN1cHBvcnRzU2Vs\nZWN0KHNlbCwgc2VsLlRZUEVfVFdPX1BBUlQsIHNtLCB0aGlzLCBmZXRjaCkg\nPiAwOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGZpZWxkIG1hcHBp\nbmdzIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIGZldGNoIGNvbmZpZ3VyYXRpb24g\nZm9yCiAgICAgKiBzdWJjbGFzc2VzIG9mIHRoZSBnaXZlbiB0eXBlLgogICAg\nICoKICAgICAqIEBwYXJhbSBzZWwgdGhlIHNlbGVjdCB0byB1c2UKICAgICAq\nIEBwYXJhbSBtYXBwaW5nIHRoZSB0eXBlIHdob3NlIHN1YmNsYXNzZXMgdG8g\nc2VsZWN0CiAgICAgKiBAcGFyYW0gc20gdGhlIGluc3RhbmNlIGJlaW5nIHNl\nbGVjdGVkIGZvciwgb3IgbnVsbCBpZiBub25lCiAgICAgKiBAcGFyYW0gZmV0\nY2ggdGhlIGZldGNoIGNvbmZpZ3VyYXRpb24KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNlbGVjdFN1YmNsYXNzTWFwcGluZ3MoU2VsZWN0IHNlbCwgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIGxvYWRTdWJjbGFzc2VzKG1hcHBpbmcpOwogICAgICAgIENsYXNzTWFwcGlu\nZ1tdIHN1Yk1hcHBpbmdzID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3ViY2xh\nc3NNYXBwaW5ncygpOwogICAgICAgIGlmIChzdWJNYXBwaW5ncy5sZW5ndGgg\nPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBzZWxlY3Qg\nYWxsIHN1YmNsYXNzIG1hcHBpbmdzIHRoYXQgbWF0Y2ggdGhlIGZldGNoIGNv\nbmZpZ3VyYXRpb24KICAgICAgICAvLyBhbmQgd2hvc2UgdGFibGUgaXMgaW4g\ndGhlIGxpc3Qgb2YgdGhvc2Ugc2VsZWN0ZWQgc28gZmFyOyB0aGlzCiAgICAg\nICAgLy8gd2F5IHdlIHNlbGVjdCB0aGUgbWF4IHBvc3NpYmxlIHdpdGhvdXQg\nc2VsZWN0aW5nIGFueSB0YWJsZXMgdGhhdAogICAgICAgIC8vIGFyZW4ndCBw\ncmVzZW50IGluIGFsbCBwb3NzaWJsZSBxdWVyeSBtYXRjaGVzOyBhIHNwZWNp\nYWwgY2FzZQogICAgICAgIC8vIGlzIG1hZGUgZm9yIG1hcHBpbmdzIHRoYXQg\ndXNlIDItcGFydCBzZWxlY3RzIHRoYXQgYXJlbid0CiAgICAgICAgLy8gZXhw\nbGljaXRseSAqbm90KiBpbiB0aGUgZGVmYXVsdCBzbyB0aGF0IHRoZXkgY2Fu\nIGdldCB0aGVpcgogICAgICAgIC8vIHByaW1hcnkgdGFibGUgZGF0YQogICAg\nICAgIEZpZWxkTWFwcGluZ1tdIGZtczsKICAgICAgICBib29sZWFuIGpvaW5l\nZDsKICAgICAgICBib29sZWFuIGNhbkpvaW4gPSBfZGljdC5qb2luU3ludGF4\nICE9IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwKICAgICAgICAg\nICAgJiYgZmV0Y2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUobWFwcGluZykgIT0g\nZmV0Y2guRUFHRVJfTk9ORTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHN1Yk1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgh\nc3ViTWFwcGluZ3NbaV0uc3VwcG9ydHNFYWdlclNlbGVjdChzZWwsIHNtLCB0\naGlzLCBtYXBwaW5nLAogICAgICAgICAgICAgICAgZmV0Y2gpKQogICAgICAg\nICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBpbml0aWFsaXpl\nIHNvIHRoYXQgaWYgd2UgY2FuJ3Qgam9pbiwgd2UgcHJldGVuZCB3ZSBhbHJl\nYWR5IGhhdmUKICAgICAgICAgICAgam9pbmVkID0gIWNhbkpvaW47CiAgICAg\nICAgICAgIGZtcyA9IHN1Yk1hcHBpbmdzW2ldLmdldERlZmluZWRGaWVsZE1h\ncHBpbmdzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZm1z\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUg\naW4gb25lIG9mIGNvbmZpZ3VyZWQgZmV0Y2ggZ3JvdXBzCiAgICAgICAgICAg\nIAlpZiAoZmV0Y2gucmVxdWlyZXNGZXRjaChmbXNbal0pICE9IEZldGNoQ29u\nZmlndXJhdGlvbi5GRVRDSF9MT0FECiAgICAgICAgICAgICAgICAgICAgJiYg\nKCghZm1zW2pdLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAgICAg\nICAgICAgICAgICYmIGZtc1tqXS5pc0RlZmF1bHRGZXRjaEdyb3VwRXhwbGlj\naXQoKSkKICAgICAgICAgICAgICAgICAgICB8fCBmbXNbal0uc3VwcG9ydHNT\nZWxlY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIAogICAg\nICAgICAgICAgICAgICAgIGZldGNoKSA8PSAwKSkgCiAgICAgICAgICAgIAkJ\nY29udGludWU7CgogICAgICAgICAgICAgICAgLy8gaWYgd2UgY2FuIGpvaW4g\ndG8gdGhlIHN1YmNsYXNzLCBkbyBzbzsgbXVjaCBiZXR0ZXIgY2hhbmNlCiAg\nICAgICAgICAgICAgICAvLyB0aGF0IHRoZSBmaWVsZCB3aWxsIGJlIGFibGUg\ndG8gc2VsZWN0IGl0c2VsZiB3aXRob3V0IGpvaW5zCiAgICAgICAgICAgICAg\nICBpZiAoIWpvaW5lZCkgewogICAgICAgICAgICAgICAgICAgIC8vIG1hcmsg\nam9pbmVkIHdoZXRoZXIgb3Igbm90IHdlIGpvaW4sIHNvIHdlIGRvbid0IGhh\ndmUgdG8KICAgICAgICAgICAgICAgICAgICAvLyB0ZXN0IGNvbmRpdGlvbnMg\nYWdhaW4gZm9yIHRoaXMgc3ViY2xhc3MKICAgICAgICAgICAgICAgICAgICBq\nb2luZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHNlbC53aGVyZShq\nb2luU3ViY2xhc3Moc2VsLCBtYXBwaW5nLCBzdWJNYXBwaW5nc1tpXSwgbnVs\nbCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlm\nIGNhbiBzZWxlY3Qgd2l0aCB0YWJsZXMgYWxyZWFkeSBzZWxlY3RlZCwgZG8g\naXQKICAgICAgICAgICAgICAgIGlmIChmbXNbal0uc3VwcG9ydHNTZWxlY3Qo\nc2VsLCBzZWwuVFlQRV9KT0lOTEVTUywgc20sIHRoaXMsCiAgICAgICAgICAg\nICAgICAgICAgZmV0Y2gpID4gMCkKICAgICAgICAgICAgICAgICAgICBmbXNb\nal0uc2VsZWN0KHNlbCwgbnVsbCwgdGhpcywgZmV0Y2gudHJhdmVyc2VKREJD\nKGZtc1tqXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoLkVBR0VS\nX05PTkUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byBqb2luIGZyb20gY2xhc3MgdG8g\naXRzIHN1YmNsYXNzLiBSZWN1cnNpdmUgdG8gYWxsb3cKICAgICAqIGZvciBt\ndWx0aXBsZSBob3BzLCBzdGFydGluZyBmcm9tIHRoZSBiYXNlIGNsYXNzLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBKb2lucyBqb2luU3ViY2xhc3Mo\nU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGJhc2UsCiAgICAgICAgQ2xhc3NN\nYXBwaW5nIHN1YiwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoc3ViID09\nIGJhc2UgfHwgc3ViLmdldFRhYmxlKCkgPT0gYmFzZS5nZXRUYWJsZSgpCiAg\nICAgICAgICAgIHx8IHNlbC5pc1NlbGVjdGVkKHN1Yi5nZXRUYWJsZSgpKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHJlY3Vyc2Ug\nZmlyc3Qgc28gd2UgZ28gbGVhc3QtPm1vc3QgZGVyaXZlZAogICAgICAgIENs\nYXNzTWFwcGluZyBzdXAgPSBzdWIuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCk7CiAgICAgICAgam9pbnMgPSBqb2luU3ViY2xhc3Moc2VsLCBi\nYXNlLCBzdXAsIGpvaW5zKTsKICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgam9pbnMgPSBzZWwubmV3Sm9pbnMoKTsKICAgICAgICBy\nZXR1cm4gc3ViLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCB0cnVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2VzIHN1cmUgYWxsIHN1YmNsYXNzZXMgb2Yg\ndGhlIGdpdmVuIHR5cGUgYXJlIGxvYWRlZCBpbiB0aGUgSlZNLgogICAgICog\nVGhpcyBpcyB1c3VhbGx5IGRvbmUgYXV0b21hdGljYWxseS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgbG9hZFN1YmNsYXNzZXMoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcpIHsKICAgICAgICBEaXNjcmltaW5hdG9yIGRzYyA9IG1hcHBpbmcu\nZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgIGlmIChkc2MuZ2V0U3ViY2xh\nc3Nlc0xvYWRlZCgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8v\nIGlmIHRoZSBzdWJjbGFzcyBsaXN0IGlzIHNldCwgbm8gbmVlZCB0byBsb2Fk\nIHN1YnMKICAgICAgICBpZiAobWFwcGluZy5nZXRSZXBvc2l0b3J5KCkuZ2V0\nUGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwKICAgICAgICAgICAgX2N0eC5n\nZXRDbGFzc0xvYWRlcigpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGRzYy5z\nZXRTdWJjbGFzc2VzTG9hZGVkKHRydWUpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBkc2MubG9h\nZFN1YmNsYXNzZXModGhpcyk7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RG\nb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgdGhlIHN0YXRlbWVudCBhIGNhbmRpZGF0ZSBmb3IgY2Fu\nY2VsbGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVmb3JlRXhl\nY3V0ZVN0YXRlbWVudChTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3Rt\nbnRzLmFkZChzdG1udCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUg\ndGhlIHN0YXRlbWVudCBmcm9tIHRoZSBjYW5jZWxsYWJsZSBzZXQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQoU3Rh\ndGVtZW50IHN0bW50KSB7CiAgICAgICAgX3N0bW50cy5yZW1vdmUoc3RtbnQp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiByZXR1cm5lZCB0\nbyBjbGllbnQgY29kZS4gTWFrZXMgc3VyZSBpdHMgd3JhcHBlZCBjb25uZWN0\naW9uCiAgICAgKiByZWYgY291bnQgaXMgZGVjcmVtZW50ZWQgb24gZmluYWxp\nemUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENsaWVudENv\nbm5lY3Rpb24gZXh0ZW5kcyBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CgogICAgICAg\nIHB1YmxpYyBDbGllbnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikgewog\nICAgICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBzdXBlci5jbG9z\nZSgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZmluYWxp\nemUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKCFf\nY2xvc2VkKQogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHdyYXBwZXIgdGhhdCBr\nZWVwcyBhbiBpbnRlcm5hbCByZWYgY291bnQgc28gdGhhdCBpdCBrbm93cwog\nICAgICogd2hlbiB0byByZWFsbHkgY2xvc2UuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBjbGFzcyBSZWZDb3VudENvbm5lY3Rpb24gZXh0ZW5kcyBEZWxlZ2F0\naW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfcmV0\nYWluID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX3JlZnMgPSAwOwog\nICAgICAgIHByaXZhdGUgYm9vbGVhbiBfZnJlZWQgPSBmYWxzZTsKCiAgICAg\nICAgcHVibGljIFJlZkNvdW50Q29ubmVjdGlvbihDb25uZWN0aW9uIGNvbm4p\nIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW4oKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfcmV0YWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nc2V0UmV0YWluKGJvb2xlYW4gcmV0YWluKSB7CiAgICAgICAgICAgIGlmIChf\ncmV0YWluICYmICFyZXRhaW4gJiYgX3JlZnMgPD0gMCkKICAgICAgICAgICAg\nICAgIGZyZWUoKTsKICAgICAgICAgICAgX3JldGFpbiA9IHJldGFpbjsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlZigpIHsKICAgICAgICAg\nICAgLy8gZG9uJ3QgaGF2ZSB0byBsb2NrOyBjYWxsZWQgZnJvbSBjb25uZWN0\nKCksIHdoaWNoIGlzIGxvY2tlZAogICAgICAgICAgICBfcmVmcysrOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gbG9jayBhdCBicm9rZXIgbGV2\nZWwgdG8gYXZvaWQgZGVhZGxvY2tzCiAgICAgICAgICAgIF9jdHgubG9jaygp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3JlZnMtLTsK\nICAgICAgICAgICAgICAgIGlmIChfcmVmcyA8PSAwICYmICFfcmV0YWluKQog\nICAgICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGZyZWUoKSB7\nCiAgICAgICAgICAgIC8vIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBjbG9zZSB0\naGUgdW5kZXJseWluZyBjb25uZWN0aW9uCiAgICAgICAgICAgIC8vIG11bHRp\ncGxlIHRpbWVzOyB0aGlzIGNvdWxkIGhhcHBlbiBpZiBzb21lb25lIChlLmcu\nLCBhbgogICAgICAgICAgICAvLyBFeHRlbnQpIGhvbGRzIGEgUmVmQ29ubmVj\ndGlvbiwgYW5kIHRoZW4gY2xvc2VzIGl0IChlLmcuLCBpbgogICAgICAgICAg\nICAvLyB0aGUgZmluYWxpemVyKSBhZnRlciB0aGUgU3RvcmVNYW5hZ2VyIGhh\ncyBhbHJlYWR5IGJlZW4gY2xvc2VkLgogICAgICAgICAgICBpZiAoX2ZyZWVk\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGdldERlbGVnYXRlKCkuY2xvc2UoKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgX2ZyZWVkID0gdHJ1ZTsKICAgICAgICAgICAgX2Nv\nbm4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0YXRl\nbWVudCBjcmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxTdGF0\nZW1lbnQoc3VwZXIuY3JlYXRlU3RhdGVtZW50KGZhbHNlKSwKICAgICAgICAg\nICAgICAgIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9Cgog\nICAgICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGlu\ndCByc1R5cGUsIGludCByc0NvbmN1ciwKICAgICAgICAgICAgYm9vbGVhbiB3\ncmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBDYW5jZWxTdGF0ZW1lbnQoc3VwZXIuY3JlYXRlU3RhdGVtZW50KHJz\nVHlwZSwgcnNDb25jdXIsCiAgICAgICAgICAgICAgICBmYWxzZSksIFJlZkNv\ndW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmlu\nZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2VsUHJlcGFy\nZWRTdGF0ZW1lbnQoc3VwZXIucHJlcGFyZVN0YXRlbWVudChzcWwsCiAgICAg\nICAgICAgICAgICBmYWxzZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVu\ndCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsIGludCByc1R5cGUsCiAg\nICAgICAgICAgIGludCByc0NvbmN1ciwgYm9vbGVhbiB3cmFwKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxQ\ncmVwYXJlZFN0YXRlbWVudChzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwK\nICAgICAgICAgICAgICAgIHJzVHlwZSwgcnNDb25jdXIsIGZhbHNlKSwgUmVm\nQ291bnRDb25uZWN0aW9uLnRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3Zl\ncyBpdHNlbGYgZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVt\nZW50cyBzbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBjbGFzcyBDYW5jZWxTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxlZ2F0\naW5nU3RhdGVtZW50IHsKCiAgICAgICAgcHVibGljIENhbmNlbFN0YXRlbWVu\ndChTdGF0ZW1lbnQgc3RtbnQsIENvbm5lY3Rpb24gY29ubikgewogICAgICAg\nICAgICBzdXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IGV4ZWN1dGVVcGRhdGUoU3RyaW5nIHNxbCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1l\nbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVt\nZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3FsLCBi\nb29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLmV4ZWN1dGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRo\naXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVzIGl0\nc2VsZiBmcm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1lbnRz\nIHNvIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBwcml2\nYXRlIGNsYXNzIENhbmNlbFByZXBhcmVkU3RhdGVtZW50IGV4dGVuZHMgRGVs\nZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50IHsKCiAgICAgICAgcHVibGljIENh\nbmNlbFByZXBhcmVkU3RhdGVtZW50KFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCAKICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25uKSB7CiAgICAgICAgICAg\nIHN1cGVyKHN0bW50LCBjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4\nZWN1dGVVcGRhdGUoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFJlc3VsdFNl\ndCBleGVjdXRlUXVlcnkoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlz\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5leGVjdXRlUXVlcnkod3JhcCk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhp\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnRbXSBleGVjdXRlQmF0Y2goKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVj\ndXRlQmF0Y2goKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

