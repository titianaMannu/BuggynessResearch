{"sha":"957b3e46c76a08b35190f1d242bebcd05791a6fb","node_id":"MDQ6QmxvYjIwNjM2NDo5NTdiM2U0NmM3NmEwOGIzNTE5MGYxZDI0MmJlYmNkMDU3OTFhNmZi","size":29208,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/957b3e46c76a08b35190f1d242bebcd05791a6fb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0SXRlcmF0b3I7CgppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuT2JqZWN0VXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5GaWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nWE1MTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nc2VyRXhjZXB0aW9uOwoKLyoqCiAqIEEgcGF0aCByZXByZXNlbnRzIGEgdHJh\ndmVyc2FsIGludG8gZmllbGRzIG9mIGEgY2FuZGlkYXRlIG9iamVjdC4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICovCmNsYXNzIFBDUGF0aAogICAgZXh0\nZW5kcyBBYnN0cmFjdFZhbAogICAgaW1wbGVtZW50cyBKREJDUGF0aCB7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFBBVEggPSAwOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEJPVU5EX1ZBUiA9IDE7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgVU5CT1VORF9WQVIgPSAyOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IFVOQUNDRVNTRURfVkFSID0gMzsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBYUEFUSCA9IDQ7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIu\nZm9yUGFja2FnZShQQ1BhdGguY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwg\nQ2xhc3NNYXBwaW5nIF9jYW5kaWRhdGU7CiAgICBwcml2YXRlIENsYXNzTWFw\ncGluZyBfY2xhc3MgPSBudWxsOwogICAgcHJpdmF0ZSBMaW5rZWRMaXN0IF9h\nY3Rpb25zID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfa2V5ID0gZmFs\nc2U7CiAgICBwcml2YXRlIGludCBfdHlwZSA9IFBBVEg7CiAgICBwcml2YXRl\nIFN0cmluZyBfdmFyTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF9j\nYXN0ID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2lkID0gZmFsc2U7\nCiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGEgX3htbGZpZWxkID0gbnVsbDsK\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgd2l0aCB0\naGUgJ3RoaXMnIHB0ci4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFz\nc01hcHBpbmcgdHlwZSkgewogICAgICAgIF9jYW5kaWRhdGUgPSB0eXBlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBm\ncm9tIHRoZSBnaXZlbiB2YXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIFBD\nUGF0aChDbGFzc01hcHBpbmcgY2FuZGlkYXRlLCBWYXJpYWJsZSB2YXIpIHsK\nICAgICAgICBfY2FuZGlkYXRlID0gY2FuZGlkYXRlOwogICAgICAgIF9hY3Rp\nb25zID0gbmV3IExpbmtlZExpc3QoKTsKCiAgICAgICAgUENQYXRoIG90aGVy\nID0gdmFyLmdldFBDUGF0aCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBu\nZXcgQWN0aW9uKCk7CiAgICAgICAgaWYgKG90aGVyID09IG51bGwpIHsKICAg\nICAgICAgICAgX3R5cGUgPSBVTkJPVU5EX1ZBUjsKICAgICAgICAgICAgYWN0\naW9uLm9wID0gQWN0aW9uLlVOQk9VTkRfVkFSOwogICAgICAgICAgICBhY3Rp\nb24uZGF0YSA9IHZhcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAv\nLyBib3VuZCB2YXJpYWJsZTsgY29weSBwYXRoCiAgICAgICAgICAgIF90eXBl\nID0gVU5BQ0NFU1NFRF9WQVI7CiAgICAgICAgICAgIF9hY3Rpb25zLmFkZEFs\nbChvdGhlci5fYWN0aW9ucyk7CiAgICAgICAgICAgIF9rZXkgPSBvdGhlci5f\na2V5OwoKICAgICAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLlZBUjsKICAg\nICAgICAgICAgYWN0aW9uLmRhdGEgPSB2YXIuZ2V0TmFtZSgpOwogICAgICAg\nIH0KICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2Fz\ndCA9IHZhci5nZXRUeXBlKCk7IC8vIGluaXRpYWwgdHlwZSBpcyB2YXIgdHlw\nZQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGlu\nZyBmcm9tIHRoZSBnaXZlbiBzdWJxdWVyeS4KICAgICAqLwogICAgcHVibGlj\nIFBDUGF0aChTdWJRIHN1YikgewogICAgICAgIF9jYW5kaWRhdGUgPSBzdWIu\nZ2V0Q2FuZGlkYXRlKCk7CiAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2Vk\nTGlzdCgpOwoKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigp\nOwogICAgICAgIGFjdGlvbi5vcCA9IEFjdGlvbi5TVUJRVUVSWTsKICAgICAg\nICBhY3Rpb24uZGF0YSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAg\nICAgIF9hY3Rpb25zLmFkZChhY3Rpb24pOwogICAgICAgIF9jYXN0ID0gc3Vi\nLmdldFR5cGUoKTsgLy8gaW5pdGlhbCB0eXBlIGlzIHN1YnF1ZXJ5IHR5cGUK\nICAgICAgICBfdmFyTmFtZSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBwYXRoIGFzIGEgYmluZGlu\nZyBvZiB0aGUgZ2l2ZW4gdmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFkZFZhcmlhYmxlQWN0aW9uKFZhcmlhYmxlIHZhcikgewogICAgICAg\nIF92YXJOYW1lID0gdmFyLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0cnVlIGlmIHRoaXMgaXMgYSBib3VuZCB2YXJpYWJsZSB0\naGF0IGhhcyBub3QgYmVlbiBhY2Nlc3NlZAogICAgICogYWZ0ZXIgYmluZGlu\nZy4gVXNlZnVsIGZvciBmaWx0ZXJzIGxpa2UKICAgICAqICJjb2xsLmNvbnRh\naW5zICh2YXIpICZhbXA7JmFtcDsgdmFyID09IG51bGwiLCB3aGljaCBzaG91\nbGQgcmVhbGx5CiAgICAgKiBqdXN0IGFjdCBsaWtlICJjb2xsLmNvbnRhaW5z\nIChudWxsKSIuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVW5hY2Nl\nc3NlZFZhcmlhYmxlKCkgewogICAgICAgIHJldHVybiBfdHlwZSA9PSBVTkFD\nQ0VTU0VEX1ZBUjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHRoaXMgaXMgYSBwYXRoIGludm9sdmluZyBhIHZhcmlhYmxlLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZhcmlhYmxlUGF0aCgpIHsKICAg\nICAgICByZXR1cm4gX3R5cGUgIT0gUEFUSDsKICAgIH0KCiAgICAvKioKICAg\nICAqIElmIHRoaXMgcGF0aCBpcyBwYXJ0IG9mIGEgY29udGFpbnMgY2xhdXNl\nLCB0aGVuIGFsaWFzIGl0IHRvIHRoZQogICAgICogcHJvcGVyIGNvbnRhaW5z\nIGlkIGJlZm9yZSBpbml0aWFsaXphdGlvbi4KICAgICAqLwogICAgcHVibGlj\nIHN5bmNocm9uaXplZCB2b2lkIHNldENvbnRhaW5zSWQoU3RyaW5nIGlkKSB7\nCiAgICAgICAgaWYgKF9jaWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gdHJlYXQgaXQganVzdCBsaWtlIGEgdW5pcXVlIHZhcmlhYmxlCiAg\nICAgICAgQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBh\nY3Rpb24ub3AgPSBBY3Rpb24uVkFSOwogICAgICAgIGFjdGlvbi5kYXRhID0g\naWQ7CiAgICAgICAgaWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAg\nIF9hY3Rpb25zID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBfYWN0aW9u\ncy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2lkID0gdHJ1ZTsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAg\nICByZXR1cm4gX2NsYXNzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1l\ndGFEYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9jbGFzcyA9\nIChDbGFzc01hcHBpbmcpIG1ldGE7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNLZXkoKSB7CiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBib29sZWFuIGlzWFBhdGgoKSB7CiAgICAgICAgcmV0dXJu\nIF90eXBlID09IFhQQVRIOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFhQYXRoKCkgewogICAgICAgIFN0cmluZ0J1ZmZlciB4cGF0aCA9IG5l\ndyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uOwogICAg\nICAgIEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7CiAgICAg\nICAgCiAgICAgICAgLy8gU2tpcCB2YXJpYWJsZSBhY3Rpb25zIHNpbmNlIHRo\nZXkgYXJlIG5vdCBwYXJ0IG9mIHRoZSB4cGF0aAogICAgICAgIC8vIHVudGls\nIHdlIHJlYWNoIHRoZSBmaXJzdCB4cGF0aCBhY3Rpb24uCiAgICAgICAgLy8g\nVGhlIGZpcnN0IHhwYXRoIGFjdGlvbiBtYXBzIHRvIHRoZSByb290IG9mIGFu\nIHhtbCBkb2N1bWVudC4KICAgICAgICBkbyAKICAgICAgICAgICAgYWN0aW9u\nID0gKEFjdGlvbikgaXRyLm5leHQoKTsgCiAgICAgICAgd2hpbGUgKGFjdGlv\nbi5vcCAhPSBBY3Rpb24uR0VUX1hQQVRIKTsKICAgICAgICAKICAgICAgICAv\nLyBTa2lwIFhtbFJvb3RFbGVtZW50OgogICAgICAgIC8vIFdlIGNhbid0IHJl\nbHkgb24gdGhlIGFjY3VyYWN5IG9mIHRoZSBuYW1lIG9mIHRoZSByb290IGVs\nZW1lbnQsCiAgICAgICAgLy8gYmVjYXVzZSBpdCBjb3VsZCBiZSBzZXQgdG8g\nc29tZSBkZWZhdWx0IGJ5IEpBWEIgWE1MIEJpbmRpbmcuCiAgICAgICAgLy8g\nVGhlIGNhbGxlcihEQkRpY3Rpb25hcnkpIHNob3VsZCBzdGFydCB3aXRoICIv\nKiIgb3IgIi8qLyIsCiAgICAgICAgLy8gd2UgYnVpbGQgdGhlIHJlbWFpbmlu\nZyB4cGF0aCB0aGF0IGZvbGxvd3MgdGhlIHJvb3QgZWxlbWVudC4KICAgICAg\nICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24g\nPSAoQWN0aW9uKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoKChYTUxN\nZXRhRGF0YSkgYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSAhPSBudWxsKSAg\nICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aC5hcHBlbmQo\nKChYTUxNZXRhRGF0YSkgYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHhwYXRoLmFwcGVuZCgi\nKiIpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAg\nICAgICAgIHhwYXRoLmFwcGVuZCgiLyIpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4geHBhdGgudG9TdHJpbmcoKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIFN0cmluZyBnZXRQYXRoKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gKF92YXJOYW1lID09IG51bGwpID8g\nIiIgOiBfdmFyTmFtZSArICIuIjsKCiAgICAgICAgU3RyaW5nQnVmZmVyIHBh\ndGggPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgQWN0aW9uIGFjdGlv\nbjsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFjdGlvbiA9\nIChBY3Rpb24pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb24u\nb3AgPT0gQWN0aW9uLlZBUiB8fCBhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFV\nRVJZKQogICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoYWN0aW9uLmRhdGEp\nOwogICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVO\nQk9VTkRfVkFSKQogICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoKChWYXJp\nYWJsZSkgYWN0aW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGVs\nc2UgCiAgICAgICAgICAgICAgICBwYXRoLmFwcGVuZCgoKEZpZWxkTWFwcGlu\nZykgYWN0aW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHBhdGgu\nYXBwZW5kKCcuJyk7CiAgICAgICAgfQogICAgICAgIGlmIChfdmFyTmFtZSAh\nPSBudWxsKQogICAgICAgICAgICBwYXRoLmFwcGVuZChfdmFyTmFtZSkuYXBw\nZW5kKCcuJyk7CiAgICAgICAgcmV0dXJuIHBhdGgudG9TdHJpbmcoKTsKICAg\nIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldENsYXNzTWFwcGluZyhF\neHBTdGF0ZSBzdGF0ZSkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CiAgICAg\nICAgaWYgKF9rZXkpIHsKICAgICAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5n\nZXRLZXkoKS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAg\nICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGluZygp\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVsZW1lbnQo\nKS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAg\ncmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5\ncGVNYXBwaW5nKCk7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBz\ndGF0ZS5maWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RmllbGRN\nYXBwaW5nKEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuICgoUGF0\naEV4cFN0YXRlKSBzdGF0ZSkuZmllbGQ7CiAgICB9CgogICAgcHVibGljIENv\nbHVtbltdIGdldENvbHVtbnMoRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBQ\nYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAg\nICAgICAgaWYgKHBzdGF0ZS5jb2xzID09IG51bGwpCiAgICAgICAgICAgIHBz\ndGF0ZS5jb2xzID0gY2FsY3VsYXRlQ29sdW1ucyhwc3RhdGUpOwogICAgICAg\nIHJldHVybiBwc3RhdGUuY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBjb2x1bW5zIHVzZWQgYnkgdGhpcyBwYXRoLgogICAgICovCiAgICBwcml2\nYXRlIENvbHVtbltdIGNhbGN1bGF0ZUNvbHVtbnMoUGF0aEV4cFN0YXRlIHBz\ndGF0ZSkgewogICAgICAgIGlmIChfa2V5KSB7CiAgICAgICAgICAgIGlmICgh\ncHN0YXRlLmpvaW5lZFJlbCAKICAgICAgICAgICAgICAgICYmIHBzdGF0ZS5m\naWVsZC5nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGpvaW5SZWxhdGlvbihwc3RhdGUsIF9rZXksIGZhbHNl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHBzdGF0ZS5qb2luZWRS\nZWwgCiAgICAgICAgICAgICAgICAmJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCku\nZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAg\nICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRUeXBl\nTWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0\nS2V5TWFwcGluZygpLmdldENvbHVtbnMoKTsKICAgICAgICB9CiAgICAgICAg\naWYgKHBzdGF0ZS5maWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN3aXRj\naCAocHN0YXRlLmZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBWYWx1ZU1hcHBp\nbmcgZWxlbSA9IHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwc3RhdGUuam9pbmVkUmVsICYmIGVs\nZW0uZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldFR5cGVNYXBwaW5nKCkuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nZWxlbS5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0Q29sdW1ucygpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygpOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHBzdGF0ZS5qb2luZWRSZWwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlwZU1hcHBpbmco\nKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5m\naWVsZC5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29s\ndW1ucygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiAoX2NsYXNzID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9DT0xVTU5TCiAg\nICAgICAgICAgIDogX2NsYXNzLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZSgpIHsKICAgICAg\nICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSAoQWN0aW9uKSBfYWN0aW9u\ncy5nZXRMYXN0KCk7CiAgICAgICAgcmV0dXJuIGFjdGlvbi5vcCA9PSBBY3Rp\nb24uVU5CT1VORF9WQVIgfHwgYWN0aW9uLm9wID09IEFjdGlvbi5WQVI7IAog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGdldChGaWVsZE1ldGFEYXRhIGZpZWxk\nLCBib29sZWFuIG51bGxUcmF2ZXJzYWwpIHsKICAgICAgICBpZiAoX2FjdGlv\nbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2Vk\nTGlzdCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7\nCiAgICAgICAgYWN0aW9uLm9wID0gKG51bGxUcmF2ZXJzYWwpID8gQWN0aW9u\nLkdFVF9PVVRFUiA6IEFjdGlvbi5HRVQ7CiAgICAgICAgYWN0aW9uLmRhdGEg\nPSBmaWVsZDsKICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAg\nICBpZiAoX3R5cGUgPT0gVU5BQ0NFU1NFRF9WQVIpCiAgICAgICAgICAgIF90\neXBlID0gQk9VTkRfVkFSOwogICAgICAgIF9jYXN0ID0gbnVsbDsKICAgICAg\nICBfa2V5ID0gZmFsc2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGdl\ndChGaWVsZE1ldGFEYXRhIGZtZCwgWE1MTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAgICAgICAgICBfYWN0aW9u\ncyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbiA9\nIG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24ub3AgPSBBY3Rpb24uR0VU\nX1hQQVRIOwogICAgICAgIGFjdGlvbi5kYXRhID0gbWV0YTsKICAgICAgICBf\nYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IG51bGw7CiAg\nICAgICAgX2tleSA9IGZhbHNlOzsKICAgICAgICBfdHlwZSA9IFhQQVRIOwog\nICAgICAgIF94bWxmaWVsZCA9IGZtZDsKICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgZ2V0KFhNTE1ldGFEYXRhIG1ldGEsIFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBh\nY3Rpb24ub3AgPSBBY3Rpb24uR0VUX1hQQVRIOwogICAgICAgIGFjdGlvbi5k\nYXRhID0gbWV0YS5nZXRGaWVsZE1hcHBpbmcobmFtZSk7CiAgICAgICAgX2Fj\ndGlvbnMuYWRkKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSBudWxsOwogICAg\nICAgIF9rZXkgPSBmYWxzZTs7CiAgICAgICAgX3R5cGUgPSBYUEFUSDsKICAg\nIH0KICAgIAogICAgcHVibGljIFhNTE1ldGFEYXRhIGdldFhtbE1hcHBpbmco\nKSB7CiAgICAgICAgQWN0aW9uIGFjdCA9IChBY3Rpb24pIF9hY3Rpb25zLmdl\ndExhc3QoKTsKICAgICAgICBpZiAoYWN0ICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiAoWE1MTWV0YURhdGEpIGFjdC5kYXRhOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBn\nZXRLZXkoKSB7CiAgICAgICAgaWYgKF9jaWQpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gY2hhbmdlIHRoZSBsYXN0IGFjdGlvbiB0byBhIGdl\ndCBrZXkKICAgICAgICBBY3Rpb24gYWN0aW9uID0gKEFjdGlvbikgX2FjdGlv\nbnMuZ2V0TGFzdCgpOwogICAgICAgIGFjdGlvbi5vcCA9IEFjdGlvbi5HRVRf\nS0VZOwogICAgICAgIF9jYXN0ID0gbnVsbDsKICAgICAgICBfa2V5ID0gdHJ1\nZTsKICAgIH0KCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBsYXN0KCkgewog\nICAgICAgIEFjdGlvbiBhY3QgPSBsYXN0RmllbGRBY3Rpb24oKTsKICAgICAg\nICByZXR1cm4gKGFjdCA9PSBudWxsKSA/IG51bGwgOiBpc1hQYXRoKCkgPyBf\neG1sZmllbGQgOgogICAgICAgICAgICAoRmllbGRNZXRhRGF0YSkgYWN0LmRh\ndGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxhc3QgYWN0\naW9uIHRoYXQgZ2V0cyBhIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIEFj\ndGlvbiBsYXN0RmllbGRBY3Rpb24oKSB7CiAgICAgICAgaWYgKF9hY3Rpb25z\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBp\nZiAoaXNYUGF0aCgpKQogICAgICAgICAgICByZXR1cm4gKEFjdGlvbikgX2Fj\ndGlvbnMuZ2V0TGFzdCgpOwogICAgICAgIAogICAgICAgIExpc3RJdGVyYXRv\nciBpdHIgPSBfYWN0aW9ucy5saXN0SXRlcmF0b3IoX2FjdGlvbnMuc2l6ZSgp\nKTsKICAgICAgICBBY3Rpb24gcHJldjsKICAgICAgICB3aGlsZSAoaXRyLmhh\nc1ByZXZpb3VzKCkpIHsKICAgICAgICAgICAgcHJldiA9IChBY3Rpb24pIGl0\nci5wcmV2aW91cygpOwogICAgICAgICAgICBpZiAocHJldi5vcCA9PSBBY3Rp\nb24uR0VUIHx8IHByZXYub3AgPT0gQWN0aW9uLkdFVF9PVVRFUgogICAgICAg\nICAgICAgICAgfHwgcHJldi5vcCA9PSBBY3Rpb24uR0VUX0tFWSkKICAgICAg\nICAgICAgICAgIHJldHVybiBwcmV2OwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0VHlwZSgpIHsK\nICAgICAgICBpZiAoX2Nhc3QgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIF9jYXN0OwogICAgICAgIEFjdGlvbiBhY3QgPSBsYXN0RmllbGRBY3Rpb24o\nKTsKICAgICAgICBpZiAoYWN0ICE9IG51bGwgJiYgYWN0Lm9wID09IEFjdGlv\nbi5HRVRfWFBBVEgpCiAgICAgICAgICAgIHJldHVybiAoKFhNTE1ldGFEYXRh\nKSBhY3QuZGF0YSkuZ2V0VHlwZSgpOwogICAgICAgIAogICAgICAgIEZpZWxk\nTWV0YURhdGEgZmxkID0gKGFjdCA9PSBudWxsKSA/IG51bGwgOiAoRmllbGRN\nZXRhRGF0YSkgYWN0LmRhdGE7CiAgICAgICAgYm9vbGVhbiBrZXkgPSBhY3Qg\nIT0gbnVsbCAmJiBhY3Qub3AgPT0gQWN0aW9uLkdFVF9LRVk7CiAgICAgICAg\naWYgKGZsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZmxkLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGZsZC5n\nZXREZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgZmxkLmdldERlY2xhcmVkVHlwZSgpID09IEJ5dGVb\nXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBmbGQuZ2V0RGVj\nbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJb\nXS5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmxkLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAg\nICBpZiAoa2V5KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmxk\nLmdldEtleSgpLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmbGQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgp\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmxkLmdldEVsZW1lbnQoKS5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXREZWNsYXJlZFR5cGUo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX2NsYXNz\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2xhc3MuZ2V0RGVzY3Jp\nYmVkVHlwZSgpOwogICAgICAgIHJldHVybiBPYmplY3QuY2xhc3M7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0SW1wbGljaXRUeXBlKENsYXNzIHR5cGUp\nIHsKICAgICAgICBfY2FzdCA9IHR5cGU7CiAgICB9CgogICAgcHVibGljIEV4\ncFN0YXRlIGluaXRpYWxpemUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgs\nIGludCBmbGFncykgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSBu\nZXcgUGF0aEV4cFN0YXRlKHNlbC5uZXdKb2lucygpKTsKICAgICAgICBib29s\nZWFuIGtleSA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gZm9yY2VPdXRlciA9\nIGZhbHNlOwogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSBfY2FuZGlkYXRl\nOwoKICAgICAgICAvLyBpdGVyYXRlIHRvIHRoZSBmaW5hbCBmaWVsZAogICAg\nICAgIENsYXNzTWFwcGluZyBvd25lcjsKICAgICAgICBDbGFzc01hcHBpbmcg\nZnJvbSwgdG87CiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAgICBWYXJp\nYWJsZSB2YXI7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gKF9hY3Rpb25zID09\nIG51bGwpID8gbnVsbCA6IF9hY3Rpb25zLml0ZXJhdG9yKCk7CiAgICAgICAg\nRmllbGRNYXBwaW5nIGZpZWxkOwogICAgICAgIHdoaWxlIChpdHIgIT0gbnVs\nbCAmJiBpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IChB\nY3Rpb24pIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAvLyB0cmVhdCBzdWJx\ndWVyaWVzIGxpa2UgdmFyaWFibGVzIGZvciBhbGlhcyBnZW5lcmF0aW9uIHB1\ncnBvc2VzCiAgICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlZB\nUikKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lu\ncy5zZXRWYXJpYWJsZSgoU3RyaW5nKSBhY3Rpb24uZGF0YSk7CiAgICAgICAg\nICAgIGVsc2UgaWYgKGFjdGlvbi5vcCA9PSBBY3Rpb24uU1VCUVVFUlkpCiAg\nICAgICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0\nU3Vic2VsZWN0KChTdHJpbmcpIGFjdGlvbi5kYXRhKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5VTkJPVU5EX1ZBUikgewog\nICAgICAgICAgICAgICAgLy8gdW5ib3VuZCB2YXJzIGFyZSBjcm9zcy1qb2lu\nZWQgdG8gdGhlIGNhbmRpZGF0ZSB0YWJsZQogICAgICAgICAgICAgICAgdmFy\nID0gKFZhcmlhYmxlKSBhY3Rpb24uZGF0YTsKICAgICAgICAgICAgICAgIHJl\nbCA9IChDbGFzc01hcHBpbmcpIHZhci5nZXRNZXRhRGF0YSgpOwogICAgICAg\nICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFZhcmlh\nYmxlKHZhci5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgcHN0YXRlLmpv\naW5zID0gcHN0YXRlLmpvaW5zLmNyb3NzSm9pbihfY2FuZGlkYXRlLmdldFRh\nYmxlKCksIAogICAgICAgICAgICAgICAgICAgIHJlbC5nZXRUYWJsZSgpKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG1vdmUg\ncGFzdCB0aGUgcHJldmlvdXMgZmllbGQsIGlmIGFueQogICAgICAgICAgICAg\nICAgZmllbGQgPSAoYWN0aW9uLm9wID09IEFjdGlvbi5HRVRfWFBBVEgpID8g\nKEZpZWxkTWFwcGluZykgX3htbGZpZWxkIDoKICAgICAgICAgICAgICAgICAg\nICAoRmllbGRNYXBwaW5nKSBhY3Rpb24uZGF0YTsKICAgICAgICAgICAgICAg\nIGlmIChwc3RhdGUuZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoaXMgaXMgdGhlIHNlY29uZC10by1sYXN0IGZpZWxkIGFu\nZCB0aGUgbGFzdCBpcwogICAgICAgICAgICAgICAgICAgIC8vIHRoZSByZWxh\ndGVkIGZpZWxkIHRoaXMgZmllbGQgam9pbnMgdG8sIG5vIG5lZWQgdG8KICAg\nICAgICAgICAgICAgICAgICAvLyB0cmF2ZXJzZToganVzdCB1c2UgdGhpcyBm\naWVsZCdzIGZrIGNvbHVtbnMKICAgICAgICAgICAgICAgICAgICBpZiAoIWl0\nci5oYXNOZXh0KCkgJiYgKGZsYWdzICYgSk9JTl9SRUwpID09IDAKICAgICAg\nICAgICAgICAgICAgICAgICAgJiYgaXNKb2luZWRGaWVsZChwc3RhdGUuZmll\nbGQsIGtleSwgZmllbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBz\ndGF0ZS5jbXBmaWVsZCA9IGZpZWxkOwogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgcmVsID0gdHJhdmVyc2VGaWVsZChwc3RhdGUsIGtleSwgZm9yY2VP\ndXRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIC8vIG1hcmsgaWYgdGhlIG5leHQgdHJhdmVyc2FsIHNob3VsZCBnbyB0\naHJvdWdoCiAgICAgICAgICAgICAgICAvLyB0aGUga2V5IHJhdGhlciB0aGFu\nIHZhbHVlCiAgICAgICAgICAgICAgICBrZXkgPSBhY3Rpb24ub3AgPT0gQWN0\naW9uLkdFVF9LRVk7CiAgICAgICAgICAgICAgICBmb3JjZU91dGVyIHw9IGFj\ndGlvbi5vcCA9PSBBY3Rpb24uR0VUX09VVEVSOwoKICAgICAgICAgICAgICAg\nIC8vIGdldCBtYXBwaW5nIGZvciB0aGUgY3VycmVudCBmaWVsZAogICAgICAg\nICAgICAgICAgcHN0YXRlLmZpZWxkID0gZmllbGQ7CiAgICAgICAgICAgICAg\nICBvd25lciA9IHBzdGF0ZS5maWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKTsK\nICAgICAgICAgICAgICAgIGlmIChwc3RhdGUuZmllbGQuZ2V0TWFuYWdlbWVu\ndCgpIAogICAgICAgICAgICAgICAgICAgICE9IEZpZWxkTWFwcGluZy5NQU5B\nR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm9uLXBlcnMtZmllbGQiLCAKICAg\nICAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmZpZWxkKSk7CgogICAgICAg\nICAgICAgICAgLy8gZmluZCB0aGUgbW9zdC1kZXJpdmVkIHR5cGUgYmV0d2Vl\nbiB0aGUgZGVjbGFyZWQgcmVsYXRpb24KICAgICAgICAgICAgICAgIC8vIHR5\ncGUgYW5kIHRoZSBmaWVsZCdzIG93bmVyLCBhbmQgam9pbiBmcm9tIHRoYXQg\ndHlwZSB0bwogICAgICAgICAgICAgICAgLy8gdGhlIGxlc3NlciBkZXJpdmVk\nIHR5cGUKICAgICAgICAgICAgICAgIGlmIChyZWwgIT0gb3duZXIgJiYgcmVs\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVsLmdldERl\nc2NyaWJlZFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tCiAgICAgICAgICAgICAg\nICAgICAgICAgIChvd25lci5nZXREZXNjcmliZWRUeXBlKCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZyb20gPSBvd25lcjsKICAgICAgICAgICAg\nICAgICAgICAgICAgdG8gPSByZWw7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHJlbDsKICAg\nICAgICAgICAgICAgICAgICAgICAgdG8gPSBvd25lcjsKICAgICAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZvciAoOyBmcm9tICE9\nIG51bGwgJiYgZnJvbSAhPSB0bzsKICAgICAgICAgICAgICAgICAgICAgICAg\nZnJvbSA9IGZyb20uZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IGZyb20u\nam9pblN1cGVyY2xhc3MocHN0YXRlLmpvaW5zLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBub3RoaW5nIG1vcmUgdG8g\nZG8gZnJvbSBoZXJlIG9uIGFzIHdlIGVuY291bnRlcmVkIGFuIHhwYXRoIGFj\ndGlvbgogICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5vcCA9PSBBY3Rpb24u\nR0VUX1hQQVRIKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChfdmFyTmFtZSAhPSBudWxs\nKQogICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0\nVmFyaWFibGUoX3Zhck5hbWUpOwoKICAgICAgICAvLyBpZiB3ZSdyZSBub3Qg\nY29tcGFyaW5nIHRvIG51bGwgb3IgZG9pbmcgYW4gaXNFbXB0eSwgdGhlbgog\nICAgICAgIC8vIGpvaW4gaW50byB0aGUgZGF0YSBvbiB0aGUgZmluYWwgZmll\nbGQ7IG9idmlvdXNseSB3ZSBjYW4ndCBkbyB0aGVzZQogICAgICAgIC8vIGpv\naW5zIHdoZW4gY29tcGFyaW5nIHRvIG51bGwgYi9jIHRoZSB3aG9sZSBwdXJw\nb3NlIGlzIHRvIHNlZQogICAgICAgIC8vIHdoZXRoZXIgdGhlIGpvaW5zIGV2\nZW4gZXhpc3QKICAgICAgICBpZiAoKGZsYWdzICYgTlVMTF9DTVApID09IDAp\nCiAgICAgICAgICAgIHRyYXZlcnNlRmllbGQocHN0YXRlLCBrZXksIGZvcmNl\nT3V0ZXIsIHRydWUpOwogICAgICAgIHBzdGF0ZS5qb2luZWRSZWwgPSBmYWxz\nZTsKICAgICAgICBpZiAoKGZsYWdzICYgSk9JTl9SRUwpICE9IDApCiAgICAg\nICAgICAgIGpvaW5SZWxhdGlvbihwc3RhdGUsIGtleSwgZm9yY2VPdXRlciB8\nfCAoZmxhZ3MgJiBGT1JDRV9PVVRFUikgIT0gMCwKICAgICAgICAgICAgICAg\nIGZhbHNlKTsKICAgICAgICByZXR1cm4gcHN0YXRlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHNvdXJjZSBmaWVs\nZCBqb2lucyB0byB0aGUgZ2l2ZW4gdGFyZ2V0IGZpZWxkLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzSm9pbmVkRmllbGQoRmllbGRN\nYXBwaW5nIHNyYywgYm9vbGVhbiBrZXksIAogICAgICAgIEZpZWxkTWFwcGlu\nZyB0YXJnZXQpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgdm07CiAgICAgICAg\nc3dpdGNoIChzcmMuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIHZtID0gc3JjLmdldEVsZW1l\nbnRNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgdm0gPSAo\na2V5KSA/IHNyYy5nZXRLZXlNYXBwaW5nKCkgOiBzcmMuZ2V0RWxlbWVudE1h\ncHBpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdm0gPSBzcmM7CiAgICAgICAgfQog\nICAgICAgIGlmICh2bS5nZXRKb2luRGlyZWN0aW9uKCkgIT0gVmFsdWVNYXBw\naW5nLkpPSU5fRk9SV0FSRCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIEZvcmVpZ25LZXkgZmsgPSB2bS5nZXRGb3JlaWduS2V5KCk7CiAg\nICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsgCiAgICAgICAgCiAgICAgICAgLy8gZm9yZWlnbiBrZXkgbXVzdCBqb2lu\nIHRvIHRhcmdldCBjb2x1bW5zCiAgICAgICAgQ29sdW1uW10gcmVscyA9IGZr\nLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBwa3MgPSB0YXJnZXQu\nZ2V0Q29sdW1ucygpOyAKICAgICAgICBpZiAocmVscy5sZW5ndGggIT0gcGtz\nLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcmVscy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb2x1bW4ocmVsc1tpXSkgIT0gcGtz\nW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRXhwcmVzc2lvbiBz\ndGF0ZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUGF0aEV4\ncFN0YXRlCiAgICAgICAgZXh0ZW5kcyBFeHBTdGF0ZSB7CgogICAgICAgIHB1\nYmxpYyBGaWVsZE1hcHBpbmcgZmllbGQgPSBudWxsOwogICAgICAgIHB1Ymxp\nYyBGaWVsZE1hcHBpbmcgY21wZmllbGQgPSBudWxsOwogICAgICAgIHB1Ymxp\nYyBDb2x1bW5bXSBjb2xzID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBqb2luZWRSZWwgPSBmYWxzZTsKCiAgICAgICAgcHVibGljIFBhdGhFeHBT\ndGF0ZShKb2lucyBqb2lucykgewogICAgICAgICAgICBzdXBlcihqb2lucyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJhdmVyc2UgaW50\nbyB0aGUgcHJldmlvdXMgZmllbGQgb2YgYSByZWxhdGlvbiBwYXRoLgogICAg\nICoKICAgICAqIEBwYXJhbSBsYXN0IHdoZXRoZXIgdGhpcyBpcyB0aGUgbGFz\ndCBmaWVsZCBpbiB0aGUgcGF0aAogICAgICogQHJldHVybiB0aGUgbWFwcGlu\nZyBvZiB0aGUgcmVsYXRlZCB0eXBlLCBvciBudWxsCiAgICAgKi8KICAgIHBy\naXZhdGUgQ2xhc3NNYXBwaW5nIHRyYXZlcnNlRmllbGQoUGF0aEV4cFN0YXRl\nIHBzdGF0ZSwgYm9vbGVhbiBrZXksIAogICAgICAgIGJvb2xlYW4gZm9yY2VP\ndXRlciwgYm9vbGVhbiBsYXN0KSB7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVs\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nLy8gdHJhdmVyc2UgaW50byBmaWVsZCB2YWx1ZQogICAgICAgIGlmIChrZXkp\nCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5maWVsZC5qb2lu\nS2V5KHBzdGF0ZS5qb2lucywgZm9yY2VPdXRlcik7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pbihw\nc3RhdGUuam9pbnMsIGZvcmNlT3V0ZXIpOwoKICAgICAgICAvLyBpZiB0aGlz\nIGlzbid0IHRoZSBsYXN0IGZpZWxkLCB0cmF2ZXJzZSBpbnRvIHRoZSByZWxh\ndGlvbgogICAgICAgIGlmICghbGFzdCkKICAgICAgICAgICAgam9pblJlbGF0\naW9uKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVyLCB0cnVlKTsKCiAgICAgICAg\nLy8gcmV0dXJuIHRoZSBtYXBpbmcgb2YgdGhlIHJlbGF0ZWQgdHlwZSwgaWYg\nYW55CiAgICAgICAgaWYgKGtleSkKICAgICAgICAgICAgcmV0dXJuIHBzdGF0\nZS5maWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAg\nICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29k\nZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0\nZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7\nCiAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRUeXBlTWFwcGluZygp\nOwogICAgfQoKICAgIC8qKgogICAgICogSm9pbiBpbnRvIHRoZSByZWxhdGlv\nbiByZXByZXNlbnRlZCBieSB0aGUgY3VycmVudCBmaWVsZCwgaWYgYW55Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgam9pblJlbGF0aW9uKFBhdGhFeHBT\ndGF0ZSBwc3RhdGUsIGJvb2xlYW4ga2V5LCAKICAgICAgICBib29sZWFuIGZv\ncmNlT3V0ZXIsIGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICBpZiAocHN0\nYXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICBpZiAoa2V5KQogICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUu\nZmllbGQuam9pbktleVJlbGF0aW9uKHBzdGF0ZS5qb2lucywgCiAgICAgICAg\nICAgICAgICBmb3JjZU91dGVyLCB0cmF2ZXJzZSk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pblJl\nbGF0aW9uKHBzdGF0ZS5qb2lucywgZm9yY2VPdXRlciwKICAgICAgICAgICAg\nICAgIHRyYXZlcnNlKTsKICAgICAgICBwc3RhdGUuam9pbmVkUmVsID0gdHJ1\nZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0b3JlVmFsdWUo\nU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAK\nICAgICAgICBPYmplY3QgdmFsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBz\ndGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIEZpZWxkTWFw\ncGluZyBmaWVsZCA9IChwc3RhdGUuY21wZmllbGQgIT0gbnVsbCkgPyBwc3Rh\ndGUuY21wZmllbGQgCiAgICAgICAgICAgIDogcHN0YXRlLmZpZWxkOwogICAg\nICAgIGlmIChpc1hQYXRoKCkpCiAgICAgICAgICAgIHJldHVybiB2YWw7CiAg\nICAgICAgaWYgKGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9r\nZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQudG9LZXlEYXRhU3Rv\ncmVWYWx1ZSh2YWwsIGN0eC5zdG9yZSk7CiAgICAgICAgICAgIGlmIChmaWVs\nZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFU\neXBlcy5PQkpFQ1QpCiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQudG9E\nYXRhU3RvcmVWYWx1ZSh2YWwsIGN0eC5zdG9yZSk7CgogICAgICAgICAgICB2\nYWwgPSBmaWVsZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgY3R4LnN0b3JlLmdl\ndENvbnRleHQoKSk7CiAgICAgICAgICAgIHJldHVybiBmaWVsZC50b0RhdGFT\ndG9yZVZhbHVlKHZhbCwgY3R4LnN0b3JlKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9jbGFzcy50b0RhdGFTdG9yZVZhbHVlKHZhbCwgX2NsYXNzLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCksCiAgICAgICAgICAgIGN0eC5zdG9yZSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIEV4\ncENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgYm9vbGVh\nbiBwa3MpIHsKICAgICAgICBzZWxlY3RDb2x1bW5zKHNlbCwgY3R4LCBzdGF0\nZSwgcGtzKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RDb2x1bW5z\nKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwg\nCiAgICAgICAgYm9vbGVhbiBwa3MpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZyA9IGdldENsYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0\naEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAg\nICAgIGlmIChtYXBwaW5nID09IG51bGwgfHwgIXBzdGF0ZS5qb2luZWRSZWwp\nCiAgICAgICAgICAgIHNlbC5zZWxlY3QoZ2V0Q29sdW1ucyhzdGF0ZSksIHBz\ndGF0ZS5qb2lucyk7CiAgICAgICAgZWxzZSBpZiAocGtzKQogICAgICAgICAg\nICBzZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwg\ncHN0YXRlLmpvaW5zKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8g\nc2VsZWN0IHRoZSBtYXBwaW5nOyBhbGxvdyBhbnkgc3VicyBiZWNhdXNlIHdl\nIGtub3cgdGhpcyBtdXN0CiAgICAgICAgICAgIC8vIGJlIGVpdGhlciBhIHJl\nbGF0aW9uLCBpbiB3aGljaCBjYXNlIGl0IHdpbGwgYWxyZWFkeSBiZQogICAg\nICAgICAgICAvLyBjb25zdHJhaW5lZCBieSB0aGUgam9pbnMsIG9yICd0aGlz\nJywgaW4gd2hpY2ggY2FzZSB0aGUKICAgICAgICAgICAgLy8gSkRCQ0V4cHJl\nc3Npb25GYWN0b3J5IHRha2VzIGNhcmUgb2YgYWRkaW5nIGNsYXNzIGNvbmRp\ndGlvbnMgZm9yCiAgICAgICAgICAgIC8vIHRoZSBjYW5kaWRhdGUgY2xhc3Mg\nb24gdGhlIHNlbGVjdAogICAgICAgICAgICBpbnQgc3VicyA9IChfdHlwZSA9\nPSBVTkJPVU5EX1ZBUikgPyBTZWxlY3QuU1VCU19KT0lOQUJMRQogICAgICAg\nICAgICAgICAgOiBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEU7CiAgICAgICAg\nICAgIHNlbC5zZWxlY3QobWFwcGluZywgc3VicywgY3R4LnN0b3JlLCBjdHgu\nZmV0Y2gsCiAgICAgICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nLkVBR0VSX05PTkUsIHNlbC5vdXRlcihwc3RhdGUuam9pbnMpKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShTZWxlY3Qgc2Vs\nLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgbWFwcGluZyA9IGdldENsYXNzTWFwcGluZyhzdGF0ZSk7\nCiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUp\nIHN0YXRlOwogICAgICAgIGlmIChtYXBwaW5nID09IG51bGwgfHwgIXBzdGF0\nZS5qb2luZWRSZWwpCiAgICAgICAgICAgIHNlbC5ncm91cEJ5KGdldENvbHVt\nbnMoc3RhdGUpLCBzZWwub3V0ZXIocHN0YXRlLmpvaW5zKSk7CiAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgIGludCBzdWJzID0gKF90eXBlID09IFVOQk9V\nTkRfVkFSKSA/IFNlbGVjdC5TVUJTX0pPSU5BQkxFCiAgICAgICAgICAgICAg\nICA6IFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRTsKICAgICAgICAgICAgc2Vs\nLmdyb3VwQnkobWFwcGluZywgc3VicywgY3R4LnN0b3JlLCBjdHguZmV0Y2gs\nIAogICAgICAgICAgICAgICAgc2VsLm91dGVyKHBzdGF0ZS5qb2lucykpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBvcmRlckJ5KFNlbGVj\ndCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAg\nICAgYm9vbGVhbiBhc2MpIHsKICAgICAgICBzZWwub3JkZXJCeShnZXRDb2x1\nbW5zKHN0YXRlKSwgYXNjLCBzZWwub3V0ZXIoc3RhdGUuam9pbnMpLCBmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBsb2FkKEV4cENvbnRleHQg\nY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgUmVzdWx0IHJlcykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gbG9hZChjdHgsIHN0\nYXRlLCByZXMsIGZhbHNlKTsKICAgIH0KCiAgICBPYmplY3QgbG9hZChFeHBD\nb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIFJlc3VsdCByZXMsIGJvb2xl\nYW4gcGtzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIENsYXNzTWFwcGluZyBtYXBwaW5nID0gZ2V0Q2xhc3NNYXBwaW5nKHN0YXRl\nKTsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0\nZSkgc3RhdGU7CiAgICAgICAgaWYgKG1hcHBpbmcgIT0gbnVsbCAmJiAocHN0\nYXRlLmZpZWxkID09IG51bGwgCiAgICAgICAgICAgIHx8ICFwc3RhdGUuZmll\nbGQuaXNFbWJlZGRlZCgpKSkgewogICAgICAgICAgICBpZiAocGtzKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0T2JqZWN0SWQoY3R4LnN0\nb3JlLCByZXMsIG51bGwsIHRydWUsIAogICAgICAgICAgICAgICAgICAgIHBz\ndGF0ZS5qb2lucyk7CiAgICAgICAgICAgIHJldHVybiByZXMubG9hZChtYXBw\naW5nLCBjdHguc3RvcmUsIGN0eC5mZXRjaCwgcHN0YXRlLmpvaW5zKTsKICAg\nICAgICB9CgogICAgICAgIE9iamVjdCByZXQ7CiAgICAgICAgaWYgKF9rZXkp\nCiAgICAgICAgICAgIHJldCA9IHBzdGF0ZS5maWVsZC5sb2FkS2V5UHJvamVj\ndGlvbihjdHguc3RvcmUsIGN0eC5mZXRjaCwgcmVzLCAKICAgICAgICAgICAg\nICAgIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBy\nZXQgPSBwc3RhdGUuZmllbGQubG9hZFByb2plY3Rpb24oY3R4LnN0b3JlLCBj\ndHguZmV0Y2gsIHJlcywgCiAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMp\nOwogICAgICAgIGlmIChfY2FzdCAhPSBudWxsKQogICAgICAgICAgICByZXQg\nPSBGaWx0ZXJzLmNvbnZlcnQocmV0LCBfY2FzdCk7CiAgICAgICAgcmV0dXJu\nIHJldDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjYWxjdWxhdGVWYWx1ZShT\nZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAog\nICAgICAgIFZhbCBvdGhlciwgRXhwU3RhdGUgb3RoZXJTdGF0ZSkgewogICAg\nICAgIC8vIHdlIGRvbid0IGNyZWF0ZSB0aGUgU1FMIGIvYyBpdCBmb3JjZXMg\ndGhlIFNlbGVjdCB0byBjYWNoZSBhbGlhc2VzCiAgICAgICAgLy8gZm9yIHRo\nZSB0YWJsZXMgd2UgdXNlLCBhbmQgdGhlc2UgYWxpYXNlcyBtaWdodCBub3Qg\nZXZlciBiZSB1c2VkIGlmCiAgICAgICAgLy8gd2UgZXZlbnR1YWxseSBjYWxs\nIGFwcGVuZElzRW1wdHkgb3IgYXBwZW5kSXNOdWxsIHJhdGhlciB0aGFuIGFw\ncGVuZFRvCiAgICB9CgogICAgcHVibGljIGludCBsZW5ndGgoU2VsZWN0IHNl\nbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAg\ncmV0dXJuIGdldENvbHVtbnMoc3RhdGUpLmxlbmd0aDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBhcHBlbmRUbyhTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0\neCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwsIGlu\ndCBpbmRleCkgewogICAgICAgIENvbHVtbiBjb2wgPSBnZXRDb2x1bW5zKHN0\nYXRlKVtpbmRleF07CgogICAgICAgIC8vIGlmIHNlbGVjdCBpcyBudWxsLCBp\ndCBtZWFucyB3ZSBhcmUgbm90IGFsaWFzaW5nIGNvbHVtbnMKICAgICAgICAv\nLyAoZS5nLiwgZHVyaW5nIGEgYnVsayB1cGRhdGUpCiAgICAgICAgaWYgKHNl\nbCA9PSBudWxsKQogICAgICAgICAgICBzcWwuYXBwZW5kKGNvbC5nZXROYW1l\nKCkpOwogICAgICAgIGVsc2UgaWYgKF90eXBlID09IFhQQVRIKQogICAgICAg\nICAgICAvLyBpZiB0aGlzIGlzIGFuIHhwYXRoLCBhcHBlbmQgeHBhdGggc3Ry\naW5nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoZ2V0WFBhdGgoKSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5B\nbGlhcyhjb2wsIHN0YXRlLmpvaW5zKSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgYXBwZW5kSXNFbXB0eShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAg\nICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3Rh\ndGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAg\nICAgICBzcWwuYXBwZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc0VtcHR5KHNxbCwgc2VsLCBwc3Rh\ndGUuam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90\nRW1wdHkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0\nYXRlLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4\ncFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAg\nIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFw\ncGVuZChGQUxTRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUu\nZmllbGQuYXBwZW5kSXNOb3RFbXB0eShzcWwsIHNlbCwgcHN0YXRlLmpvaW5z\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRTaXplKFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIjEiKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRTaXpl\nKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGFwcGVuZElzTnVsbChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAg\nICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3Rh\ndGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAg\nICAgICBzcWwuYXBwZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc051bGwoc3FsLCBzZWwsIHBzdGF0\nZS5qb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNOb3RO\ndWxsKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0\nZSwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBT\ndGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBp\nZiAocHN0YXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoVFJVRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmll\nbGQuYXBwZW5kSXNOb3ROdWxsKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgaWYg\nKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FuZGlk\nYXRlLmhhc2hDb2RlKCk7CiAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGUuaGFz\naENvZGUoKSBeIF9hY3Rpb25zLmhhc2hDb2RlKCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFBDUGF0aCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBQQ1BhdGggcGF0aCA9IChQQ1Bh\ndGgpIG90aGVyOwogICAgICAgIHJldHVybiBPYmplY3RVdGlscy5lcXVhbHMo\nX2NhbmRpZGF0ZSwgcGF0aC5fY2FuZGlkYXRlKQogICAgICAgICAgICAmJiBP\nYmplY3RVdGlscy5lcXVhbHMoX2FjdGlvbnMsIHBhdGguX2FjdGlvbnMpOwog\nICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHJlcHJlc2VudGlu\nZyBhbiBhY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIEFjdGlvbiB7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEdF\nVCA9IDA7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgR0VUX09V\nVEVSID0gMTsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBHRVRf\nS0VZID0gMjsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQVIg\nPSAzOwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNVQlFVRVJZ\nID0gNDsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBVTkJPVU5E\nX1ZBUiA9IDU7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ0FT\nVCA9IDY7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgR0VUX1hQ\nQVRIID0gNzsKCiAgICAgICAgcHVibGljIGludCBvcCA9IC0xOwogICAgICAg\nIHB1YmxpYyBPYmplY3QgZGF0YSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBvcCArICJ8\nIiArIGRhdGE7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hD\nb2RlKCkgewogICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG9wOwogICAgICAgICAgICByZXR1cm4gb3AgXiBk\nYXRhLmhhc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmIChv\ndGhlciA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgICAgIEFjdGlvbiBhID0gKEFjdGlvbikgb3RoZXI7CiAgICAgICAg\nICAgIHJldHVybiBvcCA9PSBhLm9wCiAgICAgICAgICAgICAgICAmJiBPYmpl\nY3RVdGlscy5lcXVhbHMoZGF0YSwgYS5kYXRhKTsKICAgICAgICB9CiAgICB9\nCn0K\n","encoding":"base64"}

