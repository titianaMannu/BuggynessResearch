{"sha":"195f8b40ed275e235787b15182c1fc0535e7555b","node_id":"MDQ6QmxvYjIwNjM2NDoxOTVmOGI0MGVkMjc1ZTIzNTc4N2IxNTE4MmMxZmMwNTM1ZTc1NTVi","size":47351,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/195f8b40ed275e235787b15182c1fc0535e7555b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Q\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlw\nZXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5CbG9iVmFsdWVIYW5kbGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQnl0ZUFy\ncmF5VmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuQ2hhckFycmF5U3RyZWFtVmFsdWVIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2hh\nckFycmF5VmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuQ2xvYlZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLkVtYmVkRmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVtYmVkZGVk\nQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNzU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5IYW5kbGVyRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkltbXV0YWJsZVZhbHVlSGFuZGxlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk1h\neEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5NYXhFbWJlZGRlZEJ5dGVBcnJh\neUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5NYXhFbWJlZGRlZENoYXJBcnJheUZpZWxkU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5NYXhFbWJlZGRlZENsb2JGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNsYXNzU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5Ob25lRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUZpZWxkU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5O\nb25lVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuTnVtYmVyVmVyc2lvblN0cmF0ZWd5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuT2JqZWN0\nSWRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuT2JqZWN0SWRWYWx1ZUhhbmRsZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5QcmltaXRpdmVG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuUmVsYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZpZWxk\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5SZWxhdGlvbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5S\nZWxhdGlvbkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlvbk1hcEludmVyc2VLZXlGaWVs\nZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdGF0ZUNv\nbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdHJpbmdGaWVsZFN0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3Vi\nY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3VwZXJjbGFzc0Rpc2Ny\naW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuc3RyYXRzLlN1cGVyY2xhc3NWZXJzaW9uU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5UaW1l\nc3RhbXBWZXJzaW9uU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5VbnR5cGVkUENWYWx1ZUhhbmRsZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5WYWx1\nZU1hcERpc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZlcnRpY2FsQ2xhc3NTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2No\nZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLkpvaW5TeW50YXhlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuY29uZi5Db25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5PcmRlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247Cgov\nKioKICogUmVwb3NpdG9yeSBvZiBvYmplY3QvcmVsYXRpb25hbCBtYXBwaW5n\nIGluZm9ybWF0aW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVi\nbGljIGNsYXNzIE1hcHBpbmdSZXBvc2l0b3J5CiAgICBleHRlbmRzIE1ldGFE\nYXRhUmVwb3NpdG9yeSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9j\nYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChN\nYXBwaW5nUmVwb3NpdG9yeS5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBNYXAgX2hhbmRsZXJzID0gbmV3IEhhc2hNYXAoKTsKCiAgICBzdGF0\naWMgewogICAgICAgIC8vIHJlZ2lzdGVyIGRlZmF1bHQgdmFsdWUgaGFuZGxl\ncnMKICAgICAgICBfaGFuZGxlcnMucHV0KCJqYXZhLmxhbmcuRW51bSIsCiAg\nICAgICAgICAgICJvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5FbnVtVmFsdWVIYW5kbGVyIik7CiAgICB9CgogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgREJEaWN0aW9uYXJ5IF9kaWN0ID0gbnVsbDsKICAgIHByaXZhdGUg\ndHJhbnNpZW50IE1hcHBpbmdEZWZhdWx0cyBfZGVmYXVsdHMgPSBudWxsOwog\nICAgCiAgICBwcml2YXRlIE1hcCBfcmVzdWx0cyA9IG5ldyBIYXNoTWFwKCk7\nIC8vIG9iamVjdC0+cXVlcnlyZXN1bHRtYXBwaW5nCiAgICBwcml2YXRlIFNj\naGVtYUdyb3VwIF9zY2hlbWEgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJhdGVn\neUluc3RhbGxlciBfaW5zdGFsbGVyID0gbnVsbDsKCiAgICAvKioKICAgICAq\nIERlZmF1bHQgY29uc3RydWN0b3IuICBDb25maWd1cmUgdmlhIAogICAgICog\ne0BsaW5rIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmFi\nbGV9LgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ1JlcG9zaXRvcnkoKSB7\nCiAgICAgICAgc2V0VmFsaWRhdGUoVkFMSURBVEVfTUFQUElORywgdHJ1ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW50IGFjY2VzcyB0byBk\naWN0aW9uYXJ5IGZvciBtYXBwaW5ncy4KICAgICAqLwogICAgcHVibGljIERC\nRGljdGlvbmFyeSBnZXREQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0OwogICAgfQoKICAgIC8qKgogICAgICogTWFwcGluZyBkZWZhdWx0\ncy4KICAgICAqLwogICAgcHVibGljIE1hcHBpbmdEZWZhdWx0cyBnZXRNYXBw\naW5nRGVmYXVsdHMoKSB7CiAgICAgICAgcmV0dXJuIF9kZWZhdWx0czsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1hcHBpbmcgZGVmYXVsdC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TWFwcGluZ0RlZmF1bHRzKE1hcHBpbmdEZWZh\ndWx0cyBkZWZhdWx0cykgewogICAgICAgIF9kZWZhdWx0cyA9IGRlZmF1bHRz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50YXRpb24gb2YgdGhl\nIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCBTY2hlbWFHcm91cCBnZXRTY2hlbWFHcm91cCgpIHsKICAgICAgICBp\nZiAoX3NjaGVtYSA9PSBudWxsKQogICAgICAgICAgICBfc2NoZW1hID0gKChK\nREJDQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJhdGlvbigpKS4KICAgICAg\nICAgICAgICAgIGdldFNjaGVtYUZhY3RvcnlJbnN0YW5jZSgpLnJlYWRTY2hl\nbWEoKTsKICAgICAgICByZXR1cm4gX3NjaGVtYTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRhYmFzZSBzY2hlbWEu\nCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBzZXRTY2hl\nbWFHcm91cChTY2hlbWFHcm91cCBzY2hlbWEpIHsKICAgICAgICBfc2NoZW1h\nID0gc2NoZW1hOwogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFsbHMgbWFw\ncGluZyBzdHJhdGVnaWVzIG9uIGNvbXBvbmVudHMuCiAgICAgKi8KICAgIHB1\nYmxpYyBzeW5jaHJvbml6ZWQgU3RyYXRlZ3lJbnN0YWxsZXIgZ2V0U3RyYXRl\nZ3lJbnN0YWxsZXIoKSB7CiAgICAgICAgaWYgKF9pbnN0YWxsZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgX2luc3RhbGxlciA9IG5ldyBSdW50aW1lU3RyYXRl\nZ3lJbnN0YWxsZXIodGhpcyk7CiAgICAgICAgcmV0dXJuIF9pbnN0YWxsZXI7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YWxscyBtYXBwaW5nIHN0cmF0\nZWdpZXMgb24gY29tcG9uZW50cy4KICAgICAqLwogICAgcHVibGljIHN5bmNo\ncm9uaXplZCB2b2lkIHNldFN0cmF0ZWd5SW5zdGFsbGVyKFN0cmF0ZWd5SW5z\ndGFsbGVyIGluc3RhbGxlcikgewogICAgICAgIF9pbnN0YWxsZXIgPSBpbnN0\nYWxsZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHF1ZXJ5\nIHJlc3VsdCBtYXBwaW5nIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwog\nICAgcHVibGljIHN5bmNocm9uaXplZCBRdWVyeVJlc3VsdE1hcHBpbmcgZ2V0\nUXVlcnlSZXN1bHRNYXBwaW5nKENsYXNzIGNscywKICAgICAgICBTdHJpbmcg\nbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgPSBnZXRRdWVy\neVJlc3VsdE1hcHBpbmdJbnRlcm5hbChjbHMsIG5hbWUsCiAgICAgICAgICAg\nIGVudkxvYWRlcik7CiAgICAgICAgaWYgKHJlcyA9PSBudWxsICYmIG11c3RF\neGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1xdWVyeS1yZXMiLCBjbHMsIG5hbWUpKTsKICAgICAg\nICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuZWQg\ndGhlIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nIHdpdGggdGhlIGdpdmVuIG5hbWUu\nCiAgICAgKi8KICAgIHByaXZhdGUgUXVlcnlSZXN1bHRNYXBwaW5nIGdldFF1\nZXJ5UmVzdWx0TWFwcGluZ0ludGVybmFsKENsYXNzIGNscywKICAgICAgICBT\ndHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAg\naWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIGNoZWNrIGNhY2hlCiAgICAgICAgT2JqZWN0IGtleSA9IGdl\ndFF1ZXJ5UmVzdWx0S2V5KGNscywgbmFtZSk7CiAgICAgICAgUXVlcnlSZXN1\nbHRNYXBwaW5nIHJlcyA9IChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRz\nLmdldChrZXkpOwogICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHJlczsKCiAgICAgICAgLy8gZ2V0IG1ldGFkYXRhIGZvciBj\nbGFzcywgd2hpY2ggd2lsbCBmaW5kIHJlc3VsdHMgaW4gbWV0YWRhdGEgZmls\nZQogICAgICAgIGlmIChjbHMgIT0gbnVsbCAmJiBnZXRNZXRhRGF0YShjbHMs\nIGVudkxvYWRlciwgZmFsc2UpICE9IG51bGwpIHsKICAgICAgICAgICAgcmVz\nID0gKFF1ZXJ5UmVzdWx0TWFwcGluZykgX3Jlc3VsdHMuZ2V0KGtleSk7CiAg\nICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiByZXM7CiAgICAgICAgfQogICAgICAgIGlmICgoZ2V0U291cmNlTW9k\nZSgpICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgY2xz\nID0gZ2V0TWV0YURhdGFGYWN0b3J5KCkKICAgICAgICAgICAgICAgICAgICAu\nZ2V0UmVzdWx0U2V0TWFwcGluZ1Njb3BlKG5hbWUsIGVudkxvYWRlcik7CiAg\nICAgICAgLy8gbm90IGluIGNhY2hlOyBsb2FkCiAgICAgICAgZ2V0TWV0YURh\ndGFGYWN0b3J5KCkubG9hZChjbHMsIE1PREVfTUVUQSB8IE1PREVfTUFQUElO\nRywgZW52TG9hZGVyKTsKICAgICAgICByZXR1cm4gKFF1ZXJ5UmVzdWx0TWFw\ncGluZykgX3Jlc3VsdHMuZ2V0KGtleSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYWxsIGNhY2hlZCBxdWVyeSByZXN1bHQgbWFwcGluZ3MuCiAg\nICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlSZXN1bHRNYXBw\naW5nW10gZ2V0UXVlcnlSZXN1bHRNYXBwaW5ncygpIHsKICAgICAgICBDb2xs\nZWN0aW9uIHZhbHVlcyA9IF9yZXN1bHRzLnZhbHVlcygpOwogICAgICAgIHJl\ndHVybiAoUXVlcnlSZXN1bHRNYXBwaW5nW10pIHZhbHVlcy50b0FycmF5CiAg\nICAgICAgICAgIChuZXcgUXVlcnlSZXN1bHRNYXBwaW5nW3ZhbHVlcy5zaXpl\nKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVk\nIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9y\nIG51bGwgaWYKICAgICAqIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5j\naHJvbml6ZWQgUXVlcnlSZXN1bHRNYXBwaW5nIGdldENhY2hlZFF1ZXJ5UmVz\ndWx0TWFwcGluZwogICAgICAgIChDbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgcmV0dXJuIChRdWVyeVJlc3VsdE1hcHBpbmcpIF9yZXN1bHRz\nLmdldChnZXRRdWVyeVJlc3VsdEtleShjbHMsIG5hbWUpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBhIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nLgogICAg\nICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFF1ZXJ5UmVzdWx0TWFwcGlu\nZyBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAogICAgICAgIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlcyA9\nIG5ldyBRdWVyeVJlc3VsdE1hcHBpbmcobmFtZSwgdGhpcyk7CiAgICAgICAg\ncmVzLnNldERlZmluaW5nVHlwZShjbHMpOwogICAgICAgIF9yZXN1bHRzLnB1\ndChnZXRRdWVyeVJlc3VsdEtleShyZXMpLCByZXMpOwogICAgICAgIHJldHVy\nbiByZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBxdWVyeSBy\nZXN1bHQgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXpl\nZCBib29sZWFuIHJlbW92ZVF1ZXJ5UmVzdWx0TWFwcGluZwogICAgICAgIChR\ndWVyeVJlc3VsdE1hcHBpbmcgcmVzKSB7CiAgICAgICAgcmV0dXJuIF9yZXN1\nbHRzLnJlbW92ZShnZXRRdWVyeVJlc3VsdEtleShyZXMpKSAhPSBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgcXVlcnkgcmVzdWx0IG1h\ncHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVh\nbiByZW1vdmVRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAogICAgICAg\nIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfcmVzdWx0\ncy5yZW1vdmUoZ2V0UXVlcnlSZXN1bHRLZXkoY2xzLCBuYW1lKSkgIT0gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBrZXkg\nZm9yIHRoZSBnaXZlbiBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBPYmplY3QgZ2V0UXVlcnlSZXN1bHRLZXkoUXVlcnlSZXN1bHRNYXBw\naW5nIHJlcykgewogICAgICAgIGlmIChyZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5UmVzdWx0\nS2V5KHJlcy5nZXREZWZpbmluZ1R5cGUoKSwgcmVzLmdldE5hbWUoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciB0\naGUgZ2l2ZW4gY2xhc3MgLyBuYW1lLiBUaGUgY2xhc3MgYXJndW1lbnQKICAg\nICAqIGNhbiBiZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBP\nYmplY3QgZ2V0UXVlcnlSZXN1bHRLZXkoQ2xhc3MgY2xzLCBTdHJpbmcgbmFt\nZSkgewogICAgICAgIHJldHVybiBnZXRRdWVyeUtleShjbHMsIG5hbWUpOwog\nICAgfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0TWFwcGluZyhDbGFz\ncyBjbHMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29sZWFu\nIG11c3RFeGlzdCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBz\ndXBlci5nZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsK\nICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0TWFwcGluZ3Mo\nKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkgc3VwZXIuZ2V0\nTWV0YURhdGFzKCk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZyBn\nZXRNYXBwaW5nKE9iamVjdCBvaWQsIENsYXNzTG9hZGVyIGVudkxvYWRlciwK\nICAgICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIHJldHVybiAo\nQ2xhc3NNYXBwaW5nKSBzdXBlci5nZXRNZXRhRGF0YShvaWQsIGVudkxvYWRl\nciwgbXVzdEV4aXN0KTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5n\nW10gZ2V0SW1wbGVtZW50b3JNYXBwaW5ncyhDbGFzcyBjbHMsCiAgICAgICAg\nQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewog\nICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1cGVyLmdldEltcGxl\nbWVudG9yTWV0YURhdGFzKGNscywgZW52TG9hZGVyLAogICAgICAgICAgICBt\ndXN0RXhpc3QpOwogICAgfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9p\nZCBjbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIF9z\nY2hlbWEgPSBudWxsOwogICAgICAgIF9yZXN1bHRzLmNsZWFyKCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgcHJlcGFyZU1hcHBpbmcoQ2xhc3NNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgLy8gbWFrZSBzdXJlIHN1cGVyY2xhc3Mg\ncmVzb2x2ZWQgZmlyc3Q7IHJlc29sdmluZyBzdXBlcmNsYXNzIG1heSBoYXZl\nCiAgICAgICAgLy8gcmVzb2x2ZWQgdGhpcyBtYXBwaW5nCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAg\nICAgIENsYXNzTWFwcGluZyBzdXAgPSBtYXBwaW5nLmdldFBDU3VwZXJjbGFz\nc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgKG1hcHBp\nbmcuZ2V0UmVzb2x2ZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIGRlZmluZSBzdXBlcmNsYXNzIGZp\nZWxkcyBhZnRlciBtYXBwaW5nIGNsYXNzLCBzbyB3ZSBjYW4gdGVsbCB3aGV0\naGVyCiAgICAgICAgLy8gdGhlIGNsYXNzIGlzIG1hcHBlZCBhbmQgbmVlZHMg\ndG8gcmVkZWZpbmUgYWJzdHJhY3Qgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAg\nICBnZXRTdHJhdGVneUluc3RhbGxlcigpLmluc3RhbGxTdHJhdGVneShtYXBw\naW5nKTsKICAgICAgICBtYXBwaW5nLmRlZmluZVN1cGVyY2xhc3NGaWVsZHMo\nbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKQogICAg\nICAgICAgICA9PSBudWxsKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBldmVyeXRo\naW5nIHRoYXQgZG9lc24ndCBpbnZvbHZlIHJlbGF0aW9ucyB0byBhbGxvdyBy\nZWxhdGlvbgogICAgICAgIC8vIG1hcHBpbmdzIHRvIHVzZSB0aGUgb3RoZXJz\nIGFzIGpvaW5hYmxlcwogICAgICAgIG1hcHBpbmcucmVzb2x2ZU5vblJlbGF0\naW9uTWFwcGluZ3MoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRh\nRGF0YSBuZXdDbGFzc01ldGFEYXRhKENsYXNzIHR5cGUpIHsKICAgICAgICBy\nZXR1cm4gbmV3IENsYXNzTWFwcGluZyh0eXBlLCB0aGlzKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YVtdIG5ld0NsYXNzTWV0YURhdGFB\ncnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01h\ncHBpbmdbbGVuZ3RoXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRh\nRGF0YSBuZXdGaWVsZE1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBl\nLAogICAgICAgIENsYXNzTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1\ncm4gbmV3IEZpZWxkTWFwcGluZyhuYW1lLCB0eXBlLCAoQ2xhc3NNYXBwaW5n\nKSBvd25lcik7CiAgICB9CgogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURhdGFb\nXSBuZXdGaWVsZE1ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewogICAgICAg\nIHJldHVybiBuZXcgRmllbGRNYXBwaW5nW2xlbmd0aF07CiAgICB9CgogICAg\ncHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3RW1iZWRkZWRDbGFzc01ldGFE\nYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3\nIENsYXNzTWFwcGluZyhvd25lcik7CiAgICB9CgogICAgcHJvdGVjdGVkIFZh\nbHVlTWV0YURhdGEgbmV3VmFsdWVNZXRhRGF0YShGaWVsZE1ldGFEYXRhIG93\nbmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1hcHBpbmdJbXBsKChG\naWVsZE1hcHBpbmcpIG93bmVyKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU2Vx\ndWVuY2VNZXRhRGF0YSBuZXdTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZXF1ZW5jZU1hcHBpbmcobmFtZSwg\ndGhpcyk7CiAgICB9CgogICAgcHJvdGVjdGVkIE9yZGVyIG5ld1ZhbHVlT3Jk\nZXIoRmllbGRNZXRhRGF0YSBvd25lciwgYm9vbGVhbiBhc2MpIHsKICAgICAg\nICByZXR1cm4gbmV3IEpEQkNWYWx1ZU9yZGVyKChGaWVsZE1hcHBpbmcpIG93\nbmVyLCBhc2MpOwogICAgfQoKICAgIHByb3RlY3RlZCBPcmRlciBuZXdSZWxh\ndGVkRmllbGRPcmRlcihGaWVsZE1ldGFEYXRhIG93bmVyLAogICAgICAgIEZp\nZWxkTWV0YURhdGEgcmVsLCBib29sZWFuIGFzYykgewogICAgICAgIHJldHVy\nbiBuZXcgSkRCQ1JlbGF0ZWRGaWVsZE9yZGVyKChGaWVsZE1hcHBpbmcpIG93\nbmVyLAogICAgICAgICAgICAoRmllbGRNYXBwaW5nKSByZWwsIGFzYyk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIE9yZGVyW10gbmV3T3JkZXJBcnJheShpbnQg\nc2l6ZSkgewogICAgICAgIHJldHVybiBuZXcgSkRCQ09yZGVyW3NpemVdOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHZlcnNpb24gbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIFZl\ncnNpb24gbmV3VmVyc2lvbihDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBWZXJzaW9uKGNscyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgZGlzY3JpbWluYXRvciBtZXRhZGF0YSBmb3IgdGhlIGdpdmVu\nIGNsYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgRGlzY3JpbWluYXRvciBu\nZXdEaXNjcmltaW5hdG9yKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBy\nZXR1cm4gbmV3IERpc2NyaW1pbmF0b3IoY2xzKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0aGUgZ2l2ZW4g\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmdJ\nbmZvIG5ld01hcHBpbmdJbmZvKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAg\nICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBuZXcgQ2xhc3NNYXBwaW5nSW5m\nbygpOwogICAgICAgIGluZm8uc2V0Q2xhc3NOYW1lKGNscy5nZXREZXNjcmli\nZWRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4gaW5mbzsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZv\nciB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBG\naWVsZE1hcHBpbmdJbmZvIG5ld01hcHBpbmdJbmZvKEZpZWxkTWFwcGluZyBm\nbSkgewogICAgICAgIHJldHVybiBuZXcgRmllbGRNYXBwaW5nSW5mbygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8g\nZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFZhbHVlTWFwcGluZ0luZm8gbmV3TWFwcGluZ0luZm8oVmFsdWVNYXBwaW5n\nIHZtKSB7CiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1hcHBpbmdJbmZvKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcgaW5m\nbyBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgVmVyc2lvbk1hcHBpbmdJbmZvIG5ld01hcHBpbmdJbmZvKFZlcnNpb24g\ndmVyc2lvbikgewogICAgICAgIHJldHVybiBuZXcgVmVyc2lvbk1hcHBpbmdJ\nbmZvKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBp\nbmcgaW5mbyBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvIG5ld01hcHBpbmdJ\nbmZvKERpc2NyaW1pbmF0b3IgZGlzYykgewogICAgICAgIHJldHVybiBuZXcg\nRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gY2xhc3MnIG5hbWVkIHN0cmF0\nZWd5LCBvciByZXR1cm4gbnVsbCBpZiBubwogICAgICogbmFtZWQgc3RyYXRl\nZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc1N0cmF0ZWd5IG5hbWVk\nU3RyYXRlZ3koQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIFN0cmluZyBu\nYW1lID0gY2xzLmdldE1hcHBpbmdJbmZvKCkuZ2V0U3RyYXRlZ3koKTsKICAg\nICAgICByZXR1cm4gaW5zdGFudGlhdGVDbGFzc1N0cmF0ZWd5KG5hbWUsIGNs\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0cmF0ZWd5\nIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHJvdGVjdGVkIENs\nYXNzU3RyYXRlZ3kgaW5zdGFudGlhdGVDbGFzc1N0cmF0ZWd5KFN0cmluZyBu\nYW1lLAogICAgICAgIENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBpZiAo\nbmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAoTm9uZUNsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQog\nICAgICAgICAgICByZXR1cm4gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFu\nY2UoKTsKCiAgICAgICAgU3RyaW5nIHByb3BzID0gQ29uZmlndXJhdGlvbnMu\nZ2V0UHJvcGVydGllcyhuYW1lKTsKICAgICAgICBuYW1lID0gQ29uZmlndXJh\ndGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwogICAgICAgIENsYXNzIHN0cmF0\nID0gbnVsbDsKCiAgICAgICAgLy8gYmFzZSBhbmQgdmVydGljYWwgc3RyYXRl\nZ2llcyB1c2Ugc2FtZSBhbGlhczsgZGlmZmVyZW50aWF0ZSBvbiBqb2luCiAg\nICAgICAgaWYgKEZ1bGxDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1l\nKSkKICAgICAgICAgICAgc3RyYXQgPSBGdWxsQ2xhc3NTdHJhdGVneS5jbGFz\nczsKICAgICAgICBlbHNlIGlmIChGbGF0Q2xhc3NTdHJhdGVneS5BTElBUy5l\ncXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gRmxhdENsYXNzU3Ry\nYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoVmVydGljYWxDbGFzc1N0\ncmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQg\nPSBWZXJ0aWNhbENsYXNzU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgICAg\nICBzdHJhdCA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwgY2xzLAog\nICAgICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgQ2xhc3NTdHJhdGVneS5jbGFzcykpKTsKICAg\nICAgICAgICAgQ2xhc3NTdHJhdGVneSBzdHJhdGVneSA9IAogICAgICAgICAg\nICAgICAgKENsYXNzU3RyYXRlZ3kpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5l\nd0luc3RhbmNlQWN0aW9uKHN0cmF0KSk7CiAgICAgICAgICAgIENvbmZpZ3Vy\nYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKHN0cmF0ZWd5LCBnZXRDb25maWd1\ncmF0aW9uKCksCiAgICAgICAgICAgICAgICBwcm9wcyk7CiAgICAgICAgICAg\nIHJldHVybiBzdHJhdGVneTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAgICAgICBlID0gKChQcml2aWxl\nZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtY2xzLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIGNscywgbmFtZSks\nIGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRp\nYXRlIHRoZSBnaXZlbiBmaWVsZCdzIG5hbWVkIHN0cmF0ZWd5LCBvciByZXR1\ncm4gbnVsbCBpZiBubwogICAgICogbmFtZWQgc3RyYXRlZ3kuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBGaWVsZFN0cmF0ZWd5IG5hbWVkU3RyYXRlZ3koRmll\nbGRNYXBwaW5nIGZpZWxkLAogICAgICAgIGJvb2xlYW4gaW5zdGFsbEhhbmRs\nZXJzKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBmaWVsZC5nZXRNYXBwaW5n\nSW5mbygpLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmIChOb25l\nRmllbGRTdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAg\nIHJldHVybiBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAg\nICAgICBTdHJpbmcgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0\naWVzKG5hbWUpOwogICAgICAgIG5hbWUgPSBDb25maWd1cmF0aW9ucy5nZXRD\nbGFzc05hbWUobmFtZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xh\nc3MgYyA9IEphdmFUeXBlcy5jbGFzc0Zvck5hbWUobmFtZSwgZmllbGQsCiAg\nICAgICAgICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKEZpZWxkU3RyYXRlZ3kuY2xhc3Mp\nKSk7CiAgICAgICAgICAgIGlmIChGaWVsZFN0cmF0ZWd5LmNsYXNzLmlzQXNz\naWduYWJsZUZyb20oYykpIHsKICAgICAgICAgICAgICAgIEZpZWxkU3RyYXRl\nZ3kgc3RyYXQgPSAoRmllbGRTdHJhdGVneSkKICAgICAgICAgICAgICAgICAg\nICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24o\nYykpOwogICAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJl\nSW5zdGFuY2Uoc3RyYXQsIGdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAg\nICAgICAgICAgICBwcm9wcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3Ry\nYXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG11c3QgYmUgbmFt\nZWQgaGFuZGxlcgogICAgICAgICAgICBpZiAoaW5zdGFsbEhhbmRsZXJzKSB7\nCiAgICAgICAgICAgICAgICBWYWx1ZUhhbmRsZXIgdmggPSAoVmFsdWVIYW5k\nbGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihj\nKSk7CiAgICAgICAgICAgICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJ\nbnN0YW5jZSh2aCwgZ2V0Q29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAg\nICAgICAgIHByb3BzKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRs\nZXIodmgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcg\nSGFuZGxlckZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZp\nbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAgICAgICBlID0gKChQ\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZmllbGQtc3RyYXRlZ3kiLAogICAgICAgICAgICAgICAgZmll\nbGQsIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gZGlzY3JpbWluYXRvcidzIG5hbWVk\nIHN0cmF0ZWd5LCBvciByZXR1cm4gbnVsbAogICAgICogaWYgbm8gbmFtZWQg\nc3RyYXRlZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBEaXNjcmltaW5hdG9y\nU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShEaXNjcmltaW5hdG9yIGRpc2NyaW0p\nIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGRpc2NyaW0uZ2V0TWFwcGluZ0lu\nZm8oKS5nZXRTdHJhdGVneSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBpZiB0aGVy\nZSBpcyBhIG5hbWVkIHN0cmF0ZWd5IHByZXNlbnQsIGRpc2NhcmQgaXQgaWYg\naXQgbWF0Y2hlcwogICAgICAgIC8vIHRoZSBiYXNlIHN0cmF0ZWd5LCBzbyB0\naGF0IHdlIHdvbid0IGNyZWF0ZSBhbiBpbmRlcGVuZGVudCBpbnN0YW5jZQog\nICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSBkaXNjcmltLmdldENsYXNzTWFw\ncGluZygpOwogICAgICAgIHdoaWxlIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVy\nY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xz\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIERp\nc2NyaW1pbmF0b3IgYmFzZSA9IGNscy5nZXREaXNjcmltaW5hdG9yKCk7CiAg\nICAgICAgaWYgKGJhc2UgIT0gZGlzY3JpbSAmJiBiYXNlLmdldFN0cmF0ZWd5\nKCkgIT0gbnVsbAogICAgICAgICAgICAmJiBuYW1lLmVxdWFscyhiYXNlLmdl\ndFN0cmF0ZWd5KCkuZ2V0QWxpYXMoKSkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVEaXNjcmltaW5hdG9y\nU3RyYXRlZ3kobmFtZSwgZGlzY3JpbSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gZGlzY3JpbWluYXRvciBzdHJhdGVn\neS4KICAgICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3JTdHJhdGVn\neSBpbnN0YW50aWF0ZURpc2NyaW1pbmF0b3JTdHJhdGVneQogICAgICAgIChT\ndHJpbmcgbmFtZSwgRGlzY3JpbWluYXRvciBkaXNjcmltKSB7CiAgICAgICAg\naWYgKE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5h\nbWUpKQogICAgICAgICAgICByZXR1cm4gTm9uZURpc2NyaW1pbmF0b3JTdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBTdHJpbmcgcHJvcHMgPSBD\nb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5hbWUpOwogICAgICAgIG5h\nbWUgPSBDb25maWd1cmF0aW9ucy5nZXRDbGFzc05hbWUobmFtZSk7CiAgICAg\nICAgQ2xhc3Mgc3RyYXQgPSBudWxsOwoKICAgICAgICBpZiAoQ2xhc3NOYW1l\nRGlzY3JpbWluYXRvclN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAg\nICAgICAgICAgc3RyYXQgPSBDbGFzc05hbWVEaXNjcmltaW5hdG9yU3RyYXRl\nZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoVmFsdWVNYXBEaXNjcmltaW5h\ndG9yU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBz\ndHJhdCA9IFZhbHVlTWFwRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzOwog\nICAgICAgIGVsc2UgaWYgKFN1YmNsYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJh\ndGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0g\nU3ViY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoc3RyYXQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHN0cmF0ID0gSmF2YVR5cGVzLmNsYXNzRm9yTmFtZShu\nYW1lLAogICAgICAgICAgICAgICAgICAgIGRpc2NyaW0uZ2V0Q2xhc3NNYXBw\naW5nKCksCiAgICAgICAgICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBEaXNjcmltaW5hdG9yU3RyYXRl\nZ3kuY2xhc3MpKSk7CiAgICAgICAgICAgIERpc2NyaW1pbmF0b3JTdHJhdGVn\neSBzdHJhdGVneSA9IChEaXNjcmltaW5hdG9yU3RyYXRlZ3kpCiAgICAgICAg\nICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlv\nbihzdHJhdCkpOwogICAgICAgICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1\ncmVJbnN0YW5jZShzdHJhdGVneSwgZ2V0Q29uZmlndXJhdGlvbigpLAogICAg\nICAgICAgICAgICAgcHJvcHMpOwogICAgICAgICAgICByZXR1cm4gc3RyYXRl\nZ3k7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9u\nKQogICAgICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRpc2NyaW0tc3Ry\nYXRlZ3kiLAogICAgICAgICAgICAgICAgZGlzY3JpbS5nZXRDbGFzc01hcHBp\nbmcoKSwgbmFtZSksIGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEluc3RhbnRpYXRlIHRoZSBnaXZlbiB2ZXJzaW9uJ3MgbmFtZWQgc3Ry\nYXRlZ3ksIG9yIHJldHVybiBudWxsCiAgICAgKiBpZiBubyBuYW1lZCBzdHJh\ndGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25TdHJhdGVneSBu\nYW1lZFN0cmF0ZWd5KFZlcnNpb24gdmVyc2lvbikgewogICAgICAgIFN0cmlu\nZyBuYW1lID0gdmVyc2lvbi5nZXRNYXBwaW5nSW5mbygpLmdldFN0cmF0ZWd5\nKCk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgbmFtZWQgc3Ry\nYXRlZ3kgcHJlc2VudCwgZGlzY2FyZCBpdCBpZiBpdCBtYXRjaGVzCiAgICAg\nICAgLy8gdGhlIGJhc2Ugc3RyYXRlZ3ksIHNvIHRoYXQgd2Ugd29uJ3QgY3Jl\nYXRlIGFuIGluZGVwZW5kZW50IGluc3RhbmNlCiAgICAgICAgQ2xhc3NNYXBw\naW5nIGNscyA9IHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\nd2hpbGUgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAh\nPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgVmVyc2lvbiBiYXNlID0gY2xz\nLmdldFZlcnNpb24oKTsKICAgICAgICBpZiAoYmFzZSAhPSB2ZXJzaW9uICYm\nIGJhc2UuZ2V0U3RyYXRlZ3koKSAhPSBudWxsCiAgICAgICAgICAgICYmIG5h\nbWUuZXF1YWxzKGJhc2UuZ2V0U3RyYXRlZ3koKS5nZXRBbGlhcygpKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHJldHVybiBpbnN0YW50\naWF0ZVZlcnNpb25TdHJhdGVneShuYW1lLCB2ZXJzaW9uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBnaXZlbiB2ZXJzaW9uIHN0\ncmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5\nIGluc3RhbnRpYXRlVmVyc2lvblN0cmF0ZWd5KFN0cmluZyBuYW1lLAogICAg\nICAgIFZlcnNpb24gdmVyc2lvbikgewogICAgICAgIGlmIChOb25lVmVyc2lv\nblN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0\ndXJuIE5vbmVWZXJzaW9uU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAg\nICAgU3RyaW5nIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGll\ncyhuYW1lKTsKICAgICAgICBuYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xh\nc3NOYW1lKG5hbWUpOwogICAgICAgIENsYXNzIHN0cmF0ID0gbnVsbDsKCiAg\nICAgICAgaWYgKE51bWJlclZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMo\nbmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gTnVtYmVyVmVyc2lvblN0cmF0\nZWd5LmNsYXNzOwogICAgICAgIGVsc2UgaWYgKFRpbWVzdGFtcFZlcnNpb25T\ndHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0\nID0gVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5LmNsYXNzOwogICAgICAgIGVs\nc2UgaWYgKFN0YXRlQ29tcGFyaXNvblZlcnNpb25TdHJhdGVneS5BTElBUy5l\ncXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gU3RhdGVDb21wYXJp\nc29uVmVyc2lvblN0cmF0ZWd5LmNsYXNzOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0\ncmF0ID0gSmF2YVR5cGVzLmNsYXNzRm9yTmFtZShuYW1lLAogICAgICAgICAg\nICAgICAgICAgIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCksCiAgICAgICAg\nICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBWZXJzaW9uU3RyYXRlZ3kuY2xhc3MpKSk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdmVyc2lvbi1zdHJh\ndGVneSIsCiAgICAgICAgICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGlu\nZygpLCBuYW1lKSwgZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaW5z\ndGFudGlhdGVWZXJzaW9uU3RyYXRlZ3koc3RyYXQsIHZlcnNpb24sIHByb3Bz\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBnaXZl\nbiB2ZXJzaW9uIHN0cmF0ZWd5LgogICAgICovCiAgICBwcm90ZWN0ZWQgVmVy\nc2lvblN0cmF0ZWd5IGluc3RhbnRpYXRlVmVyc2lvblN0cmF0ZWd5KENsYXNz\nIHN0cmF0LAogICAgICAgIFZlcnNpb24gdmVyc2lvbiwgU3RyaW5nIHByb3Bz\nKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgVmVyc2lvblN0cmF0ZWd5\nIHN0cmF0ZWd5ID0gKFZlcnNpb25TdHJhdGVneSkKICAgICAgICAgICAgICAg\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKHN0cmF0\nKSk7CiAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3Rh\nbmNlKHN0cmF0ZWd5LCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAg\nICAgICBwcm9wcyk7CiAgICAgICAgICAgIHJldHVybiBzdHJhdGVneTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAo\nZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAg\nICAgICAgICAgICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBl\nKS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdmVyc2lvbi1zdHJhdGVneSIs\nCiAgICAgICAgICAgICAgICB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpLCBz\ndHJhdCArICIiKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLiBEb2VzCiAgICAgKiBub3QgdGFrZSBpbnRvIGFj\nY291bnQgdGhlIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENsYXNzU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KENs\nYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0\nZWd5KGNscywgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0\nIHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGNsYXNzLiBEb2VzCiAg\nICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3RyYXRl\nZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzU3RyYXRl\nZ3kgZGVmYXVsdFN0cmF0ZWd5KENsYXNzTWFwcGluZyBjbHMsCiAgICAgICAg\nYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIFZhbHVlTWFwcGluZyBlbWJl\nZCA9IGNscy5nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVt\nYmVkICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gc3VwZXJjbGFzcyBvZiBl\nbWJlZGRlZCBjbGFzcyBpc24ndCBtYXBwZWQKICAgICAgICAgICAgaWYgKGVt\nYmVkLmdldFR5cGUoKSAhPSBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpCiAgICAg\nICAgICAgICAgICB8fCBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRTdHJh\ndGVneSgpCiAgICAgICAgICAgICAgICA9PSBOb25lRmllbGRTdHJhdGVneS5n\nZXRJbnN0YW5jZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVDbGFz\nc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmIChlbWJl\nZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IE9iamVjdElkQ2xhc3NTdHJhdGVneSgpOwogICAg\nICAgICAgICByZXR1cm4gbmV3IEVtYmVkZGVkQ2xhc3NTdHJhdGVneSgpOwog\nICAgICAgIH0KICAgICAgICBpZiAoY2xzLmlzRW1iZWRkZWRPbmx5KCkpCiAg\nICAgICAgICAgIHJldHVybiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5j\nZSgpOwoKICAgICAgICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVsdHMuZ2V0U3Ry\nYXRlZ3koY2xzLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKHN0cmF0IGluc3Rh\nbmNlb2YgU3RyaW5nKQogICAgICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVD\nbGFzc1N0cmF0ZWd5KChTdHJpbmcpIHN0cmF0LCBjbHMpOwogICAgICAgIGlm\nIChzdHJhdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKENsYXNzU3Ry\nYXRlZ3kpIHN0cmF0OwogICAgICAgIAogICAgICAgIC8vIHNlZSBpZiB0aGVy\nZSBpcyBhIGRlY2xhcmVkIGhpZXJhcmNoeSBzdHJhdGVneQogICAgICAgIENs\nYXNzU3RyYXRlZ3kgaHN0cmF0ID0gbnVsbDsKICAgICAgICBmb3IgKENsYXNz\nTWFwcGluZyBiYXNlID0gY2xzOyBiYXNlICE9IG51bGwgJiYgaHN0cmF0ID09\nIG51bGw7KSB7CiAgICAgICAgICAgIGhzdHJhdCA9IGluc3RhbnRpYXRlQ2xh\nc3NTdHJhdGVneShiYXNlLmdldE1hcHBpbmdJbmZvKCkuCiAgICAgICAgICAg\nICAgICBnZXRIaWVyYXJjaHlTdHJhdGVneSgpLCBjbHMpOwogICAgICAgICAg\nICBiYXNlID0gYmFzZS5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyB0aGUgZnVsbCBzdHJhdGVneSBhcyBh\ncHBsaWVkIHRvIGEgaGllcmFyY2h5IGlzIGEKICAgICAgICAvLyB0YWJsZS1w\nZXItY29uY3JldGUtY2xhc3Mgc3RyYXRlZ3ksIHNvIGRvbid0IG1hcCBhYnN0\ncmFjdCB0eXBlcwogICAgICAgIGlmIChoc3RyYXQgaW5zdGFuY2VvZiBGdWxs\nQ2xhc3NTdHJhdGVneQogICAgICAgICAgICAmJiAhY2xzLmlzTWFuYWdlZElu\ndGVyZmFjZSgpCiAgICAgICAgICAgICYmIE1vZGlmaWVyLmlzQWJzdHJhY3Qo\nY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgIHJldHVybiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgp\nOwogICAgICAgIAogICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBjbHMuZ2V0\nTWFwcGVkUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChzdXAg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBGdWxsQ2xhc3NTdHJh\ndGVneSgpOwogICAgICAgIGlmIChoc3RyYXQgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGhzdHJhdDsKICAgICAgICByZXR1cm4gbmV3IEZsYXRDbGFz\nc1N0cmF0ZWd5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZmll\nbGQuIERvZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFt\nZWQgb3IgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LiBJZiBhCiAgICAgKiBu\nb24tbnVsbCBzdHJhdGVneSBpcyByZXR1cm5lZCwgdGhpcyBtZXRob2QgbWF5\nIGFzIGEgc2lkZSBlZmZlY3QgaW5zdGFsbAogICAgICogdmFsdWUgaGFuZGxl\ncnMgb24gdGhlIGZpZWxkJ3MgdmFsdWUgbWFwcGluZ3MuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBGaWVsZFN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShGaWVs\nZE1hcHBpbmcgZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxl\ncnMpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGZpZWxkLCBp\nbnN0YWxsSGFuZGxlcnMsCiAgICAgICAgICAgIGdldFN0cmF0ZWd5SW5zdGFs\nbGVyKCkuaXNBZGFwdGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERl\ndGVybWluZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBn\naXZlbiBmaWVsZC4gRG9lcwogICAgICogbm90IHRha2UgaW50byBhY2NvdW50\nIHRoZSBuYW1lZCBvciBjdXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuIElmIGEK\nICAgICAqIG5vbi1udWxsIHN0cmF0ZWd5IGlzIHJldHVybmVkLCB0aGlzIG1l\ndGhvZCBtYXkgYXMgYSBzaWRlIGVmZmVjdCBpbnN0YWxsCiAgICAgKiB2YWx1\nZSBoYW5kbGVycyBvbiB0aGUgZmllbGQncyB2YWx1ZSBtYXBwaW5ncy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgZGVmYXVsdFN0cmF0\nZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwKICAgICAgICBib29sZWFuIGluc3Rh\nbGxIYW5kbGVycywgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIC8vIG5v\ndCBwZXJzaXN0ZW50PwogICAgICAgIGlmIChmaWVsZC5nZXRNYW5hZ2VtZW50\nKCkgIT0gZmllbGQuTUFOQUdFX1BFUlNJU1RFTlQKICAgICAgICAgICAgfHwg\nZmllbGQuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgIHJldHVybiBOb25lRmll\nbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChmaWVsZC5n\nZXREZWZpbmluZ01hcHBpbmcoKS5nZXRTdHJhdGVneSgpID09CiAgICAgICAg\nICAgIE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkpCiAgICAgICAg\nICAgIHJldHVybiBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoK\nICAgICAgICAvLyBjaGVjayBmb3IgbmFtZWQgaGFuZGxlciBmaXJzdAogICAg\nICAgIFZhbHVlSGFuZGxlciBoYW5kbGVyID0gbmFtZWRIYW5kbGVyKGZpZWxk\nKTsKICAgICAgICBpZiAoaGFuZGxlciAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChpbnN0YWxsSGFuZGxlcnMpCiAgICAgICAgICAgICAgICBmaWVsZC5z\nZXRIYW5kbGVyKGhhbmRsZXIpOwogICAgICAgICAgICByZXR1cm4gbmV3IEhh\nbmRsZXJGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nZmllbGQuaXNTZXJpYWxpemVkKCkpIHsKICAgICAgICAgICAgaWYgKF9kaWN0\nLm1heEVtYmVkZGVkQmxvYlNpemUgIT0gLTEpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IE1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3koKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjaGVjayBmb3IgbWFwcGVk\nIHN0cmF0ZWd5CiAgICAgICAgICAgIE9iamVjdCBzdHJhdCA9IG1hcHBlZFN0\ncmF0ZWd5KGZpZWxkLCBmaWVsZC5nZXRUeXBlKCksIGFkYXB0aW5nKTsKICAg\nICAgICAgICAgaWYgKHN0cmF0IGluc3RhbmNlb2YgRmllbGRTdHJhdGVneSkK\nICAgICAgICAgICAgICAgIHJldHVybiAoRmllbGRTdHJhdGVneSkgc3RyYXQ7\nCiAgICAgICAgICAgIGlmIChzdHJhdCAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAoaW5zdGFsbEhhbmRsZXJzKQogICAgICAgICAgICAgICAgICAg\nIGZpZWxkLnNldEhhbmRsZXIoKFZhbHVlSGFuZGxlcikgc3RyYXQpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRTdHJhdGVneSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBm\nb3Iga25vd24gZmllbGQgc3RyYXRlZ2llcwogICAgICAgIGlmICghZmllbGQu\naXNTZXJpYWxpemVkKCkgJiYgKGZpZWxkLmdldFR5cGUoKSA9PSBieXRlW10u\nY2xhc3MKICAgICAgICAgICAgfHwgZmllbGQuZ2V0VHlwZSgpID09IEJ5dGVb\nXS5jbGFzcykpIHsKICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVk\nQmxvYlNpemUgIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1h\neEVtYmVkZGVkQnl0ZUFycmF5RmllbGRTdHJhdGVneSgpOwogICAgICAgIH0g\nZWxzZSBpZiAoIWZpZWxkLmlzU2VyaWFsaXplZCgpCiAgICAgICAgICAgICYm\nIChmaWVsZC5nZXRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAg\nIHx8IGZpZWxkLmdldFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykpIHsK\nICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0g\nLTEgJiYgaXNDbG9iKGZpZWxkLCBmYWxzZSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IE1heEVtYmVkZGVkQ2hhckFycmF5RmllbGRTdHJhdGVneSgp\nOwogICAgICAgIH0gZWxzZSBpZiAoIWZpZWxkLmlzU2VyaWFsaXplZCgpKSB7\nCiAgICAgICAgICAgIEZpZWxkU3RyYXRlZ3kgc3RyYXQgPSBkZWZhdWx0VHlw\nZVN0cmF0ZWd5KGZpZWxkLCBpbnN0YWxsSGFuZGxlcnMsCiAgICAgICAgICAg\nICAgICBhZGFwdGluZyk7CiAgICAgICAgICAgIGlmIChzdHJhdCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmF0OwogICAgICAgIH0KCiAg\nICAgICAgLy8gY2hlY2sgZm9yIGRlZmF1bHQgaGFuZGxlcgogICAgICAgIGhh\nbmRsZXIgPSBkZWZhdWx0SGFuZGxlcihmaWVsZCwgYWRhcHRpbmcpOwogICAg\nICAgIGlmIChoYW5kbGVyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGlu\nc3RhbGxIYW5kbGVycykKICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRs\nZXIoaGFuZGxlcik7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlckZp\nZWxkU3RyYXRlZ3koKTsKICAgICAgICB9CgogICAgICAgIC8vIGRlZmF1bHQg\ndG8gYmxvYgogICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAg\nICAgICAgaWYgKGdldExvZygpLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIGdldExvZygpLndhcm4oX2xvYy5nZXQoIm5vLWZpZWxkLXN0cmF0\nZWd5IiwgZmllbGQpKTsKICAgICAgICAgICAgZmllbGQuc2V0U2VyaWFsaXpl\nZCh0cnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVk\nZGVkQmxvYlNpemUgPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGluc3RhbGxI\nYW5kbGVycykKICAgICAgICAgICAgICAgIGZpZWxkLnNldEhhbmRsZXIoQmxv\nYlZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBIYW5kbGVyRmllbGRTdHJhdGVneSgpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbmV3IE1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3ko\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnVpbHQtaW4g\nc3RyYXRlZ3kgZm9yIHRoZSBmaWVsZCdzIHR5cGUsIG9yIG51bGwgaWYgbm9u\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgZGVmYXVs\ndFR5cGVTdHJhdGVneShGaWVsZE1hcHBpbmcgZmllbGQsCiAgICAgICAgYm9v\nbGVhbiBpbnN0YWxsSGFuZGxlcnMsIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAg\nICAgICBzd2l0Y2ggKGZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hB\nUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05H\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgUHJpbWl0aXZlRmllbGRTdHJhdGVneSgpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAg\nICAgICBpZiAoIWlzQ2xvYihmaWVsZCwgZmFsc2UpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nRmllbGRTdHJhdGVneSgpOwogICAg\nICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0g\nLTEpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhFbWJlZGRl\nZENsb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAg\nICBpZiAoZmllbGQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBFbWJlZEZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAg\nICAgICAgIGlmIChmaWVsZC5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkK\nICAgICAgICAgICAgICAgICAgICB8fCAhdXNlVW50eXBlZFBDSGFuZGxlcihm\naWVsZCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlv\nbkZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIFZhbHVl\nTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAg\nICAgICAgICAgICAgIFZhbHVlSGFuZGxlciBlaGFuZGxlciA9IG5hbWVkSGFu\nZGxlcihlbGVtKTsKICAgICAgICAgICAgICAgIGlmIChlaGFuZGxlciA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGVoYW5kbGVyID0gZGVmYXVsdEhh\nbmRsZXIoZWxlbSk7CiAgICAgICAgICAgICAgICBpZiAoZWhhbmRsZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlckNvbGxl\nY3Rpb25TdHJhdGVneShmaWVsZCwgZWhhbmRsZXIsIAogICAgICAgICAgICAg\nICAgICAgICAgICBpbnN0YWxsSGFuZGxlcnMpOwogICAgICAgICAgICAgICAg\naWYgKGVsZW0uZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAgICAg\nICAgICAgICAgICAgICAmJiAhZWxlbS5pc1NlcmlhbGl6ZWQoKSAmJiAhZWxl\nbS5pc0VtYmVkZGVkUEMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh1\nc2VJbnZlcnNlS2V5TWFwcGluZyhmaWVsZCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtl\neUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFJlbGF0aW9uQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIFZh\nbHVlTWFwcGluZyBrZXkgPSBmaWVsZC5nZXRLZXlNYXBwaW5nKCk7CiAgICAg\nICAgICAgICAgICBWYWx1ZUhhbmRsZXIga2hhbmRsZXIgPSBuYW1lZEhhbmRs\nZXIoa2V5KTsKICAgICAgICAgICAgICAgIGlmIChraGFuZGxlciA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGtoYW5kbGVyID0gZGVmYXVsdEhhbmRs\nZXIoa2V5KTsKICAgICAgICAgICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBm\naWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgICAgICAgICAgVmFs\ndWVIYW5kbGVyIHZoYW5kbGVyID0gbmFtZWRIYW5kbGVyKHZhbCk7CiAgICAg\nICAgICAgICAgICBpZiAodmhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICB2aGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKHZhbCk7CiAgICAg\nICAgICAgICAgICBib29sZWFuIGtyZWwgPSBraGFuZGxlciA9PSBudWxsIAog\nICAgICAgICAgICAgICAgICAgICYmIGtleS5nZXRUeXBlQ29kZSgpID09IEph\ndmFUeXBlcy5QQwogICAgICAgICAgICAgICAgICAgICYmICFrZXkuaXNTZXJp\nYWxpemVkKCkgJiYgIWtleS5pc0VtYmVkZGVkUEMoKTsKICAgICAgICAgICAg\nICAgIGJvb2xlYW4gdnJlbCA9IHZoYW5kbGVyID09IG51bGwgCiAgICAgICAg\nICAgICAgICAgICAgJiYgdmFsLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDCiAgICAgICAgICAgICAgICAgICAgJiYgIXZhbC5pc1NlcmlhbGl6ZWQo\nKSAmJiAhdmFsLmlzRW1iZWRkZWRQQygpOwogICAgICAgICAgICAgICAgaWYg\nKCFrcmVsICYmIHZyZWwgJiYga2V5LmdldFZhbHVlTWFwcGVkQnkoKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUludmVyc2VLZXlN\nYXBwaW5nKGZpZWxkKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBSZWxhdGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0ZWd5KCk7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvbk1hcFRhYmxl\nRmllbGRTdHJhdGVneSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKCFrcmVsICYmIGtoYW5kbGVyID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBpZiAoIXZyZWwg\nJiYgdmhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyTWFwU3RyYXRlZ3ko\nZmllbGQsIGtoYW5kbGVyLCB2aGFuZGxlciwga3JlbCwKICAgICAgICAgICAg\nICAgICAgICB2cmVsLCBpbnN0YWxsSGFuZGxlcnMpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY29sbGVjdGlvbiBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGVsZW1l\nbnQgaGFuZGxlciwgb3IgbnVsbAogICAgICogaWYgbm9uZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgaGFuZGxlckNvbGxlY3Rpb25T\ndHJhdGVneShGaWVsZE1hcHBpbmcgZmllbGQsIAogICAgICAgIFZhbHVlSGFu\nZGxlciBlaGFuZGxlciwgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbWFwIHN0cmF0ZWd5IGZvciB0aGUgZ2l2ZW4ga2V5IGFuZCB2YWx1\nZSBoYW5kbGVycyAvIHJlbGF0aW9ucywKICAgICAqIG9yIG51bGwgaWYgbm9u\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRlZ3kgaGFuZGxl\nck1hcFN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwgCiAgICAgICAgVmFs\ndWVIYW5kbGVyIGtoYW5kbGVyLCBWYWx1ZUhhbmRsZXIgdmhhbmRsZXIsIGJv\nb2xlYW4ga3JlbCwgCiAgICAgICAgYm9vbGVhbiB2cmVsLCAgYm9vbGVhbiBp\nbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFVzZSBoaW50cyBpbiBtYXBwaW5nIGRhdGEgdG8g\nZmlndXJlIG91dCB3aGV0aGVyIHRoZSBnaXZlbiByZWxhdGlvbgogICAgICog\nZmllbGQgc2hvdWxkIHVzZSBhbiBpbnZlcnNlIGZvcmVpZ24ga2V5IG9yIGFu\nIGFzc29jaWF0aW9uIHRhYmxlIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiB1c2VJbnZlcnNlS2V5TWFwcGluZyhGaWVsZE1hcHBpbmcg\nZmllbGQpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkID0gZmllbGQu\nZ2V0TWFwcGVkQnlNYXBwaW5nKCk7CiAgICAgICAgaWYgKG1hcHBlZCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChtYXBwZWQuZ2V0VHlwZUNvZGUoKSA9\nPSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKG1hcHBlZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLW1hcHBlZC1ieSIsIGZpZWxkLAogICAgICAgICAg\nICAgICAgbWFwcGVkKSk7CiAgICAgICAgfQoKICAgICAgICAvLyB3aXRob3V0\nIGEgbWFwcGVkLWJ5LCB3ZSBoYXZlIHRvIGxvb2sgZm9yIGNsdWVzIGFzIHRv\nIHRoZSBtYXBwaW5nLgogICAgICAgIC8vIHdlIGFzc3VtZSB0aGF0IGFueXRo\naW5nIHdpdGggZWxlbWVudCBmb3JlaWduIGtleSBjb2x1bW5zIGJ1dCBubyBq\nb2luCiAgICAgICAgLy8gY29sdW1ucyBvciB0YWJsZSB1c2VzIGFuIGludmVy\nc2UgZm9yZWlnbiBrZXksIGFuZCBhbnl0aGluZyBlbHNlIHVzZXMKICAgICAg\nICAvLyBhbiBhc3NvY2lhdGlvbiB0YWJsZQogICAgICAgIEZpZWxkTWFwcGlu\nZ0luZm8gaW5mbyA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAg\nVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIHJldHVybiBpbmZvLmdldFRhYmxlTmFtZSgpID09IG51bGwg\nJiYgaW5mby5nZXRDb2x1bW5zKCkuaXNFbXB0eSgpCiAgICAgICAgICAgICYm\nICFlbGVtLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKS5pc0VtcHR5KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0aGUgZ2l2ZW4gdmFsdWUg\nYWdhaW5zdCBtYXBwZWQgc3RyYXRlZ2llcy4KICAgICAqLwogICAgcHJpdmF0\nZSBPYmplY3QgbWFwcGVkU3RyYXRlZ3koVmFsdWVNYXBwaW5nIHZhbCwgQ2xh\nc3MgdHlwZSwKICAgICAgICBib29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAg\naWYgKHR5cGUgPT0gbnVsbCB8fCB0eXBlID09IE9iamVjdC5jbGFzcykKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE9iamVjdCBzdHJhdCA9\nIF9kZWZhdWx0cy5nZXRTdHJhdGVneSh2YWwsIHR5cGUsIGFkYXB0aW5nKTsK\nICAgICAgICBpZiAoc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgc3RyYXQg\nPSBfaGFuZGxlcnMuZ2V0KHR5cGUuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8g\ncmVjdXJzZSBvbiBzdXBlcmNsYXNzIHNvIHRoYXQsIGZvciBleGFtcGxlLCBh\nIHJlZ2lzdGVyZWQgaGFuZGxlcgogICAgICAgIC8vIGZvciBqYXZhLmxhbmcu\nRW51bSB3aWxsIHdvcmsgb24gYWxsIGVudW1zCiAgICAgICAgaWYgKHN0cmF0\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtYXBwZWRTdHJhdGVneSh2\nYWwsIHR5cGUuZ2V0U3VwZXJjbGFzcygpLCBhZGFwdGluZyk7CiAgICAgICAg\naWYgKCEoc3RyYXQgaW5zdGFuY2VvZiBTdHJpbmcpKQogICAgICAgICAgICBy\nZXR1cm4gc3RyYXQ7CgogICAgICAgIFN0cmluZyBuYW1lID0gKFN0cmluZykg\nc3RyYXQ7CiAgICAgICAgaWYgKE5vbmVGaWVsZFN0cmF0ZWd5LkFMSUFTLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVGaWVsZFN0cmF0\nZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENv\nbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFt\nZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBDbGFzcyBjID0gSmF2YVR5cGVzLmNsYXNz\nRm9yTmFtZShuYW1lLCB2YWwsCiAgICAgICAgICAgICAgICAoQ2xhc3NMb2Fk\nZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9u\nKEZpZWxkU3RyYXRlZ3kuY2xhc3MpKSk7CiAgICAgICAgICAgIE9iamVjdCBv\nID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjKSk7CiAg\nICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKG8s\nIGdldENvbmZpZ3VyYXRpb24oKSwgcHJvcHMpOwogICAgICAgICAgICByZXR1\ncm4gbzsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24pCiAgICAgICAgICAgICAgICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWFwcGVkLXN0\ncmF0ZWd5IiwKICAgICAgICAgICAgICAgIHZhbCwgbmFtZSksIGUpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBn\naXZlbiB2YWx1ZSdzIG5hbWVkIGhhbmRsZXIsIG9yIHJldHVybiBudWxsIGlm\nIG5vCiAgICAgKiBuYW1lZCBoYW5kbGVyLgogICAgICovCiAgICBwcm90ZWN0\nZWQgVmFsdWVIYW5kbGVyIG5hbWVkSGFuZGxlcihWYWx1ZU1hcHBpbmcgdmFs\nKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSB2YWwuZ2V0VmFsdWVJbmZvKCku\nZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIHByb3BzID0g\nQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhuYW1lKTsKICAgICAgICBu\nYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBKYXZhVHlwZXMuY2xh\nc3NGb3JOYW1lKG5hbWUsIHZhbCwKICAgICAgICAgICAgICAgIChDbGFzc0xv\nYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rp\nb24oVmFsdWVIYW5kbGVyLmNsYXNzKSkpOwogICAgICAgICAgICBpZiAoVmFs\ndWVIYW5kbGVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oYykpIHsKICAgICAg\nICAgICAgICAgIFZhbHVlSGFuZGxlciB2aCA9IChWYWx1ZUhhbmRsZXIpIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGMpKTsKICAg\nICAgICAgICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNl\nKHZoLCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAg\ncHJvcHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZoOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOyAvLyBuYW1lZCBmaWVsZCBz\ndHJhdGVneQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC12YWx1ZS1o\nYW5kbGVyIiwKICAgICAgICAgICAgICAgIHZhbCwgbmFtZSksIGUpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVm\nYXVsdCBoYW5kbGVyIHRvIHVzZSBmb3IgdGhlIGdpdmVuIHZhbHVlLiBEb2Vz\nCiAgICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIG5hbWVkIGhhbmRs\nZXIsIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlSGFuZGxl\nciBkZWZhdWx0SGFuZGxlcihWYWx1ZU1hcHBpbmcgdmFsKSB7CiAgICAgICAg\ncmV0dXJuIGRlZmF1bHRIYW5kbGVyKHZhbCwgZ2V0U3RyYXRlZ3lJbnN0YWxs\nZXIoKS5pc0FkYXB0aW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0\nZXJtaW5lIHRoZSBkZWZhdWx0IGhhbmRsZXIgdG8gdXNlIGZvciB0aGUgZ2l2\nZW4gdmFsdWUuIERvZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0\naGUgbmFtZWQgaGFuZGxlciwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0\nZWQgVmFsdWVIYW5kbGVyIGRlZmF1bHRIYW5kbGVyKFZhbHVlTWFwcGluZyB2\nYWwsIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBpZiAodmFsLmlzU2Vy\naWFsaXplZCgpKSB7CiAgICAgICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRl\nZEJsb2JTaXplICE9IC0xKQogICAgICAgICAgICAgICAgd2Fybk1heEVtYmVk\nZGVkKHZhbCwgX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6ZSk7CiAgICAgICAg\nICAgIHJldHVybiBCbG9iVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAg\nICAgICAgfQoKICAgICAgICBPYmplY3QgaGFuZGxlciA9IG1hcHBlZFN0cmF0\nZWd5KHZhbCwgdmFsLmdldFR5cGUoKSwgYWRhcHRpbmcpOwogICAgICAgIGlm\nIChoYW5kbGVyIGluc3RhbmNlb2YgVmFsdWVIYW5kbGVyKQogICAgICAgICAg\nICByZXR1cm4gKFZhbHVlSGFuZGxlcikgaGFuZGxlcjsKCiAgICAgICAgaWYg\nKHZhbC5nZXRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzIAogICAgICAgICAgICB8\nfCB2YWwuZ2V0VHlwZSgpID09IEJ5dGVbXS5jbGFzcykgewogICAgICAgICAg\nICBpZiAoX2RpY3QubWF4RW1iZWRkZWRCbG9iU2l6ZSAhPSAtMSkKICAgICAg\nICAgICAgICAgIHdhcm5NYXhFbWJlZGRlZCh2YWwsIF9kaWN0Lm1heEVtYmVk\nZGVkQmxvYlNpemUpOwogICAgICAgICAgICByZXR1cm4gQnl0ZUFycmF5VmFs\ndWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgfQogICAgICAgIGlm\nICh2YWwuZ2V0VHlwZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICB8\nfCB2YWwuZ2V0VHlwZSgpID09IENoYXJhY3RlcltdLmNsYXNzKSB7CiAgICAg\nICAgICAgIGlmIChpc0Nsb2IodmFsLCB0cnVlKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBDaGFyQXJyYXlTdHJlYW1WYWx1ZUhhbmRsZXIuZ2V0SW5zdGFu\nY2UoKTsKICAgICAgICAgICAgcmV0dXJuIENoYXJBcnJheVZhbHVlSGFuZGxl\nci5nZXRJbnN0YW5jZSgpOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICh2\nYWwuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ0FMRU5EQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToK\nICAgICAgICAgICAgICAgIHJldHVybiBJbW11dGFibGVWYWx1ZUhhbmRsZXIu\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RS\nSU5HOgogICAgICAgICAgICAgICAgaWYgKGlzQ2xvYih2YWwsIHRydWUpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBDbG9iVmFsdWVIYW5kbGVyLmdl\ndEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gSW1tdXRhYmxl\nVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYgKCF2YWwuZ2V0VHlw\nZU1hcHBpbmcoKS5pc01hcHBlZCgpCiAgICAgICAgICAgICAgICAgICAgJiYg\ndXNlVW50eXBlZFBDSGFuZGxlcih2YWwpKSAKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gVW50eXBlZFBDVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIHJldHVybiBVbnR5\ncGVkUENWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBPYmplY3RJZFZhbHVlSGFuZGxlcigpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVl\nIGlmIHdlIHNob3VsZCB1c2UgdGhlIGdlbmVyaWMgdW50eXBlZCBQQyBoYW5k\nbGVyIGZvciB0aGUKICAgICAqIGdpdmVuIHVubWFwcGVkIHJlbGF0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gdXNlVW50eXBlZFBDSGFuZGxl\ncihWYWx1ZU1hcHBpbmcgdmFsKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHJl\nbCA9IHZhbC5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiByZWwu\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX1VOS05PV04K\nICAgICAgICAgICAgfHwgKHJlbC5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFz\nc01hcHBpbmcuSURfQVBQTElDQVRJT04KICAgICAgICAgICAgJiYgKHJlbC5n\nZXRQcmltYXJ5S2V5RmllbGRzKCkubGVuZ3RoID09IDAKICAgICAgICAgICAg\nfHwgKCFyZWwuaXNPcGVuSlBBSWRlbnRpdHkoKSAmJiBNb2RpZmllci5pc0Fi\nc3RyYWN0CiAgICAgICAgICAgIChyZWwuZ2V0T2JqZWN0SWRUeXBlKCkuZ2V0\nTW9kaWZpZXJzKCkpKSkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2tz\nIGZvciBoaW50cyBhcyB0byB3aGV0aGVyIHRoZSBnaXZlbiBjb2x1bW4gaXMg\nYSBDTE9CLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNDbG9iKFZh\nbHVlTWFwcGluZyB2YWwsIGJvb2xlYW4gd2FybikgewogICAgICAgIExpc3Qg\nY29scyA9IHZhbC5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgaWYgKGNvbHMuc2l6ZSgpICE9IDEpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIGNvbHMuZ2V0\nKDApOwogICAgICAgIGlmIChjb2wuZ2V0U2l6ZSgpICE9IC0xICYmIGNvbC5n\nZXRUeXBlKCkgIT0gVHlwZXMuQ0xPQikKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBpZiAoX2RpY3QuZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5DTE9CKSAhPSBUeXBlcy5DTE9CKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIGlmICh3YXJuICYmIF9kaWN0Lm1heEVtYmVkZGVkQ2xv\nYlNpemUgIT0gLTEpCiAgICAgICAgICAgIHdhcm5NYXhFbWJlZGRlZCh2YWws\nIF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogV2FybiB0aGF0IHRoZSBnaXZl\nbiB2YWx1ZSBpcyBiZWluZyBtYXBwZWQgdG8gYSBoYW5kbGVyIHRoYXQgd2ls\nbCBub3QKICAgICAqIGJlIGFibGUgdG8gc3RvcmUgbGFyZ2UgbG9icy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdhcm5NYXhFbWJlZGRlZChWYWx1ZU1h\ncHBpbmcgdmFsLCBpbnQgc2l6ZSkgewogICAgICAgIGlmIChnZXRMb2coKS5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIGdldExvZygpLndhcm4oX2xv\nYy5nZXQoIm1heC1lbWJlZC1sb2IiLCB2YWwsCiAgICAgICAgICAgICAgICBT\ndHJpbmcudmFsdWVPZihzaXplKSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhl\nIGdpdmVuIGRpc2NyaW1pbmF0b3IuCiAgICAgKiBEb2VzIG5vdCB0YWtlIGlu\ndG8gYWNjb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgRGlzY3JpbWluYXRvclN0cmF0ZWd5IGRlZmF1\nbHRTdHJhdGVneShEaXNjcmltaW5hdG9yIGRpc2NyaW0pIHsKICAgICAgICBy\nZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGRpc2NyaW0sIGdldFN0cmF0ZWd5SW5z\ndGFsbGVyKCkuaXNBZGFwdGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRo\nZSBnaXZlbiBkaXNjcmltaW5hdG9yLgogICAgICogRG9lcyBub3QgdGFrZSBp\nbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3JTdHJhdGVneSBkZWZh\ndWx0U3RyYXRlZ3koRGlzY3JpbWluYXRvciBkaXNjcmltLAogICAgICAgIGJv\nb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0g\nZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoY2xzLmdl\ndEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsK\nICAgICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpID09IG51bGwKICAgICAgICAgICAgJiYgKGNscy5nZXRTdHJhdGVneSgp\nID09IE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkKICAgICAgICAg\nICAgfHwgTW9kaWZpZXIuaXNGaW5hbChkaXNjcmltLmdldENsYXNzTWFwcGlu\nZygpLmdldERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9kaWZp\nZXJzKCkpKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVEaXNjcmltaW5hdG9y\nU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgT2JqZWN0IHN0cmF0\nID0gX2RlZmF1bHRzLmdldFN0cmF0ZWd5KGRpc2NyaW0sIGFkYXB0aW5nKTsK\nICAgICAgICBpZiAoc3RyYXQgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAg\nICAgIHJldHVybiBpbnN0YW50aWF0ZURpc2NyaW1pbmF0b3JTdHJhdGVneSgo\nU3RyaW5nKSBzdHJhdCwgZGlzY3JpbSk7CiAgICAgICAgaWYgKHN0cmF0ICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiAoRGlzY3JpbWluYXRvclN0cmF0\nZWd5KSBzdHJhdDsKCiAgICAgICAgaWYgKGNscy5nZXRKb2luYWJsZVBDU3Vw\nZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbmV3IFN1cGVyY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3koKTsKICAgICAg\nICBpZiAoZGlzY3JpbS5nZXRNYXBwaW5nSW5mbygpLmdldFZhbHVlKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1hcERpc2NyaW1p\nbmF0b3JTdHJhdGVneSgpOwogICAgICAgIGlmIChjbHMuZ2V0TWFwcGVkUENT\ndXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAg\nICAgICAgaWYgKGFkYXB0aW5nIHx8IF9kZWZhdWx0cy5kZWZhdWx0TWlzc2lu\nZ0luZm8oKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBDbGFzc05hbWVEaXNj\ncmltaW5hdG9yU3RyYXRlZ3koKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGlj\ndCA9ICgoSkRCQ0NvbmZpZ3VyYXRpb24pIGdldENvbmZpZ3VyYXRpb24oKSku\nCiAgICAgICAgICAgIGdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAg\nICAgaWYgKGRpY3Quam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFY\nX1RSQURJVElPTkFMKQogICAgICAgICAgICByZXR1cm4gTm9uZURpc2NyaW1p\nbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiBu\nZXcgU3ViY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0ZWd5KCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1bHQgc3RyYXRl\nZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmVyc2lvbi4KICAgICAqIERvZXMg\nbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBjdXJyZW50IHN0cmF0ZWd5LCBp\nZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kg\nZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVyc2lvbikgewogICAgICAgIHJl\ndHVybiBkZWZhdWx0U3RyYXRlZ3kodmVyc2lvbiwgZ2V0U3RyYXRlZ3lJbnN0\nYWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhl\nIGdpdmVuIHZlcnNpb24uCiAgICAgKiBEb2VzIG5vdCB0YWtlIGludG8gYWNj\nb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShW\nZXJzaW9uIHZlcnNpb24sCiAgICAgICAgYm9vbGVhbiBhZGFwdGluZykgewog\nICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSB2ZXJzaW9uLmdldENsYXNzTWFw\ncGluZygpOwogICAgICAgIGlmIChjbHMuZ2V0RW1iZWRkaW5nTWV0YURhdGEo\nKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChjbHMuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0gbnVsbAogICAgICAgICAgICAm\nJiBjbHMuZ2V0U3RyYXRlZ3koKSA9PSBOb25lQ2xhc3NTdHJhdGVneS5nZXRJ\nbnN0YW5jZSgpKQogICAgICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBPYmplY3Qgc3RyYXQgPSBf\nZGVmYXVsdHMuZ2V0U3RyYXRlZ3kodmVyc2lvbiwgYWRhcHRpbmcpOwogICAg\nICAgIGlmIChzdHJhdCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAg\ncmV0dXJuIGluc3RhbnRpYXRlVmVyc2lvblN0cmF0ZWd5KChTdHJpbmcpIHN0\ncmF0LCB2ZXJzaW9uKTsKICAgICAgICBpZiAoc3RyYXQgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIChWZXJzaW9uU3RyYXRlZ3kpIHN0cmF0OwoKICAg\nICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3VwZXJjbGFzc1Zl\ncnNpb25TdHJhdGVneSgpOwoKICAgICAgICBGaWVsZE1hcHBpbmcgdmZpZWxk\nID0gdmVyc2lvbi5nZXRDbGFzc01hcHBpbmcoKS4KICAgICAgICAgICAgZ2V0\nVmVyc2lvbkZpZWxkTWFwcGluZygpOwogICAgICAgIGlmICh2ZmllbGQgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTdHJhdGVneSh2ZXJz\naW9uLCB2ZmllbGQpOwogICAgICAgIGlmIChhZGFwdGluZyB8fCBfZGVmYXVs\ndHMuZGVmYXVsdE1pc3NpbmdJbmZvKCkpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgTnVtYmVyVmVyc2lvblN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJuIE5v\nbmVWZXJzaW9uU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZGVmYXVsdCB2ZXJzaW9uIHN0cmF0ZWd5\nLCBnaXZlbiBhIHZlcnNpb24gZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBWZXJzaW9uU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVy\ncywKICAgICAgICBGaWVsZE1hcHBpbmcgdmZpZWxkKSB7CiAgICAgICAgc3dp\ndGNoICh2ZmllbGQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGltZXN0YW1w\nVmVyc2lvblN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEVfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE51bWJlclZlcnNpb25TdHJhdGVneSgpOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVWZXJzaW9uU3RyYXRlZ3ku\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKQogICAgewogICAgICAgIHN1cGVy\nLmVuZENvbmZpZ3VyYXRpb24oKTsKCiAgICAgICAgSkRCQ0NvbmZpZ3VyYXRp\nb24gY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJhdGlv\nbigpOwogICAgICAgIF9kaWN0ID0gY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0\nYW5jZSgpOwogICAgICAgIGlmIChfZGVmYXVsdHMgPT0gbnVsbCkKICAgICAg\nICAgICAgX2RlZmF1bHRzID0gY29uZi5nZXRNYXBwaW5nRGVmYXVsdHNJbnN0\nYW5jZSgpOwogICAgICAgIGlmIChfc2NoZW1hICE9IG51bGwgJiYgX3NjaGVt\nYSBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkgewogICAgICAgICAgICAoKENv\nbmZpZ3VyYWJsZSkgX3NjaGVtYSkuc2V0Q29uZmlndXJhdGlvbihjb25mKTsK\nICAgICAgICAgICAgKChDb25maWd1cmFibGUpIF9zY2hlbWEpLnN0YXJ0Q29u\nZmlndXJhdGlvbigpOwogICAgICAgICAgICAoKENvbmZpZ3VyYWJsZSkgX3Nj\naGVtYSkuZW5kQ29uZmlndXJhdGlvbigpOwogICAgICAgIH0gICAgICAgICAg\nICAKICAgIH0KfQo=\n","encoding":"base64"}

