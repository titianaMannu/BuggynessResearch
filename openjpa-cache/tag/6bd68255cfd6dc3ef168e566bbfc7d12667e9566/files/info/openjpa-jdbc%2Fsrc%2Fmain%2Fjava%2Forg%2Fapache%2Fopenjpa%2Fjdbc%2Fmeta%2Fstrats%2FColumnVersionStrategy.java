{"sha":"261e9c60bb609d3354ade1a6a0c0dd391151e590","node_id":"MDQ6QmxvYjIwNjM2NDoyNjFlOWM2MGJiNjA5ZDMzNTRhZGUxYTZhMGMwZGQzOTExNTFlNTkw","size":9287,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/261e9c60bb609d3354ade1a6a0c0dd391151e590","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3Rv\ncmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNz\nTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nVmVyc2lvbk1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgovKioKICogVXNlcyBh\nIHNpbmdsZSBjb2x1bW4gYW5kIGNvcnJlc3BvbmRpbmcgdmVyc2lvbiBvYmpl\nY3QuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqLwpwdWJs\naWMgYWJzdHJhY3QgY2xhc3MgQ29sdW1uVmVyc2lvblN0cmF0ZWd5CiAgICBl\neHRlbmRzIEFic3RyYWN0VmVyc2lvblN0cmF0ZWd5IHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQ\nYWNrYWdlCiAgICAgICAgKENvbHVtblZlcnNpb25TdHJhdGVneS5jbGFzcyk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvZGUgZnJvbSB7QGxpbmsg\nSmF2YVR5cGVzfSBmb3IgdGhlIHZlcnNpb24gdmFsdWVzIHRoaXMKICAgICAq\nIHN0cmF0ZWd5IHVzZXMuIFRoaXMgbWV0aG9kIGlzIG9ubHkgdXNlZCBkdXJp\nbmcgbWFwcGluZyBpbnN0YWxsYXRpb24uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBhYnN0cmFjdCBpbnQgZ2V0SmF2YVR5cGUoKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbmV4dCB2ZXJzaW9uIGdpdmVuIHRoZSBjdXJyZW50IG9u\nZSwgd2hpY2ggbWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBh\nYnN0cmFjdCBPYmplY3QgbmV4dFZlcnNpb24oT2JqZWN0IHZlcnNpb24pOwoK\nICAgIC8qKgogICAgICogQ29tcGFyZSB0aGUgdHdvIHZlcnNpb25zLiBEZWZh\ndWx0cyB0byBhc3N1bWluZyB0aGUgdmVyc2lvbiBvYmplY3RzCiAgICAgKiBp\nbXBsZW1lbnQge0BsaW5rIENvbXBhcmFibGV9LgogICAgICoKICAgICAqIEBz\nZWUgQ29tcGFyYXRvciNjb21wYXJlCiAgICAgKi8KICAgIHByb3RlY3RlZCBp\nbnQgY29tcGFyZShPYmplY3QgdjEsIE9iamVjdCB2MikgewogICAgICAgIGlm\nICh2MSA9PSB2MikKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYg\nKHYxID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBp\nZiAodjIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDE7CgogICAgICAg\nIGlmICh2MS5nZXRDbGFzcygpICE9IHYyLmdldENsYXNzKCkpIHsKICAgICAg\nICAgICAgaWYgKHYxIGluc3RhbmNlb2YgTnVtYmVyICYmICEodjEgaW5zdGFu\nY2VvZiBCaWdEZWNpbWFsKSkKICAgICAgICAgICAgICAgIHYxID0gbmV3IEJp\nZ0RlY2ltYWwoKChOdW1iZXIpIHYxKS5kb3VibGVWYWx1ZSgpKTsKCiAgICAg\nICAgICAgIGlmICh2MiBpbnN0YW5jZW9mIE51bWJlciAmJiAhKHYyIGluc3Rh\nbmNlb2YgQmlnRGVjaW1hbCkpCiAgICAgICAgICAgICAgICB2MiA9IG5ldyBC\naWdEZWNpbWFsKCgoTnVtYmVyKSB2MikuZG91YmxlVmFsdWUoKSk7CiAgICAg\nICAgfQoKICAgICAgICByZXR1cm4gKChDb21wYXJhYmxlKSB2MSkuY29tcGFy\nZVRvKHYyKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBtYXAoYm9vbGVhbiBh\nZGFwdCkgewogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSB2ZXJzLmdldENs\nYXNzTWFwcGluZygpOwogICAgICAgIGlmIChjbHMuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbAogICAgICAgICAgICB8fCBjbHMu\nZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSAhPSBudWxsKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1iYXNl\nLXZlcnMiLCBjbHMpKTsKCiAgICAgICAgVmVyc2lvbk1hcHBpbmdJbmZvIGlu\nZm8gPSB2ZXJzLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgaW5mby5hc3Nl\ncnROb0pvaW4odmVycywgdHJ1ZSk7CiAgICAgICAgaW5mby5hc3NlcnROb0Zv\ncmVpZ25LZXkodmVycywgIWFkYXB0KTsKICAgICAgICBpbmZvLmFzc2VydE5v\nVW5pcXVlKHZlcnMsIGZhbHNlKTsKCiAgICAgICAgQ29sdW1uIHRtcGxhdGUg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShn\nZXRKYXZhVHlwZSgpKTsKICAgICAgICB0bXBsYXRlLnNldE5hbWUoInZlcnNu\nIik7CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBpbmZvLmdldENvbHVtbnMo\ndmVycywgbmV3IENvbHVtbltdeyB0bXBsYXRlIH0sIGFkYXB0KTsKICAgICAg\nICBjb2xzWzBdLnNldFZlcnNpb25TdHJhdGVneSh0aGlzKTsKICAgICAgICB2\nZXJzLnNldENvbHVtbnMoY29scyk7CiAgICAgICAgdmVycy5zZXRDb2x1bW5J\nTyhpbmZvLmdldENvbHVtbklPKCkpOwoKICAgICAgICBJbmRleCBpZHggPSBp\nbmZvLmdldEluZGV4KHZlcnMsIGNvbHMsIGFkYXB0KTsKICAgICAgICB2ZXJz\nLnNldEluZGV4KGlkeCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5zZXJ0\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93\nTWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBDb2x1bW5bXSBjb2xzID0gdmVycy5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgQ29sdW1uSU8gaW8gPSB2ZXJzLmdldENvbHVtbklPKCk7CiAgICAgICAg\nT2JqZWN0IGluaXRpYWwgPSBuZXh0VmVyc2lvbihudWxsKTsKICAgICAgICBS\nb3cgcm93ID0gcm0uZ2V0Um93KHZlcnMuZ2V0Q2xhc3NNYXBwaW5nKCkuZ2V0\nVGFibGUoKSwKICAgICAgICAgICAgUm93LkFDVElPTl9JTlNFUlQsIHNtLCB0\ncnVlKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIGlmIChpby5pc0luc2VydGFibGUoaSwgaW5p\ndGlhbCA9PSBudWxsKSkKICAgICAgICAgICAgICAgIHJvdy5zZXRPYmplY3Qo\nY29sc1tpXSwgaW5pdGlhbCk7CgogICAgICAgIC8vIHNldCBpbml0aWFsIHZl\ncnNpb24gaW50byBzdGF0ZSBtYW5hZ2VyCiAgICAgICAgT2JqZWN0IG5leHRW\nZXJzaW9uOwogICAgICAgIG5leHRWZXJzaW9uID0gaW5pdGlhbDsKICAgICAg\nICBzbS5zZXROZXh0VmVyc2lvbihuZXh0VmVyc2lvbik7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgdXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpE\nQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdmVycy5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xz\nLmxlbmd0aCA9PSAwIHx8CiAgICAgICAgICAgICFzbS5pc0RpcnR5KCkgJiYg\nIXNtLmlzVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgT2JqZWN0IGN1clZlcnNpb24gPSBzbS5nZXRWZXJz\naW9uKCk7CiAgICAgICAgT2JqZWN0IG5leHRWZXJzaW9uID0gbmV4dFZlcnNp\nb24oY3VyVmVyc2lvbik7CgogICAgICAgIFJvdyByb3cgPSBybS5nZXRSb3co\ndmVycy5nZXRDbGFzc01hcHBpbmcoKS5nZXRUYWJsZSgpLAogICAgICAgICAg\nICBSb3cuQUNUSU9OX1VQREFURSwgc20sIHRydWUpOwogICAgICAgIHJvdy5z\nZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAg\nICAgICAvLyBzZXQgd2hlcmUgYW5kIHVwZGF0ZSBjb25kaXRpb25zIG9uIHJv\ndwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoY3VyVmVyc2lvbiAhPSBudWxsICYmIHNt\nLmlzVmVyc2lvbkNoZWNrUmVxdWlyZWQoKSkKICAgICAgICAgICAgICAgIHJv\ndy53aGVyZU9iamVjdChjb2xzW2ldLCBjdXJWZXJzaW9uKTsKICAgICAgICAg\nICAgaWYgKHZlcnMuZ2V0Q29sdW1uSU8oKS5pc1VwZGF0YWJsZShpLCBuZXh0\nVmVyc2lvbiA9PSBudWxsKSkKICAgICAgICAgICAgICAgIHJvdy5zZXRPYmpl\nY3QoY29sc1tpXSwgbmV4dFZlcnNpb24pOwogICAgICAgIH0KCiAgICAgICAg\naWYgKG5leHRWZXJzaW9uICE9IG51bGwpCiAgICAgICAgICAgIHNtLnNldE5l\neHRWZXJzaW9uKG5leHRWZXJzaW9uKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBkZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0\nb3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIFJvdyByb3cgPSBybS5nZXRSb3codmVycy5nZXRDbGFz\nc01hcHBpbmcoKS5nZXRUYWJsZSgpLAogICAgICAgICAgICBSb3cuQUNUSU9O\nX0RFTEVURSwgc20sIHRydWUpOwogICAgICAgIHJvdy5zZXRGYWlsZWRPYmpl\nY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgIENvbHVtbltd\nIGNvbHMgPSB2ZXJzLmdldENvbHVtbnMoKTsKCiAgICAgICAgT2JqZWN0IGN1\nclZlcnNpb24gPSBzbS5nZXRWZXJzaW9uKCk7CiAgICAgICAgT2JqZWN0IGN1\ncjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09IDEgfHwgY3Vy\nVmVyc2lvbiA9PSBudWxsKQogICAgICAgICAgICAgICAgY3VyID0gY3VyVmVy\nc2lvbjsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY3VyID0g\nKChPYmplY3RbXSkgY3VyVmVyc2lvbilbaV07CgogICAgICAgICAgICAvLyBz\nZXQgd2hlcmUgYW5kIHVwZGF0ZSBjb25kaXRpb25zIG9uIHJvdwogICAgICAg\nICAgICBpZiAoY3VyICE9IG51bGwpCiAgICAgICAgICAgICAgICByb3cud2hl\ncmVPYmplY3QoY29sc1tpXSwgY3VyKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gc2VsZWN0KFNlbGVjdCBzZWwsIENsYXNzTWFwcGlu\nZyBtYXBwaW5nKSB7CiAgICAgICAgc2VsLnNlbGVjdCh2ZXJzLmdldENvbHVt\nbnMoKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUsIFJlc3VsdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gdHlwaWNhbGx5IGlmIG9uZSB2ZXJzaW9uIGNvbHVt\nbiBpcyBpbiB0aGUgcmVzdWx0LCB0aGV5IGFsbCBhcmUsIHNvCiAgICAgICAg\nLy8gb3B0aW1pemUgYnkgY2hlY2tpbmcgZm9yIHRoZSBmaXJzdCBvbmUgYmVm\nb3JlIGRvaW5nIGFueSByZWFsIHdvcmsKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gdmVycy5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKCFyZXMuY29udGFp\nbnMoY29sc1swXSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT2Jq\nZWN0IHZlcnNpb24gPSBudWxsOwogICAgICAgIGlmIChjb2xzLmxlbmd0aCA+\nIDApCiAgICAgICAgICAgIHZlcnNpb24gPSBuZXcgT2JqZWN0W2NvbHMubGVu\nZ3RoXTsKICAgICAgICBPYmplY3QgY3VyOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\naSA+IDAgJiYgIXJlcy5jb250YWlucyhjb2xzW2ldKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgY3VyID0gcmVzLmdldE9iamVjdChj\nb2xzW2ldLCAtMSwgbnVsbCk7CiAgICAgICAgICAgIGlmIChjb2xzLmxlbmd0\naCA9PSAxKQogICAgICAgICAgICAgICAgdmVyc2lvbiA9IGN1cjsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgKChPYmplY3RbXSkgdmVyc2lv\nbilbaV0gPSBjdXI7CiAgICAgICAgfQogICAgICAgIHNtLnNldFZlcnNpb24o\ndmVyc2lvbik7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gY2hlY2tWZXJz\naW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwK\nICAgICAgICBib29sZWFuIHVwZGF0ZVZlcnNpb24pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHZlcnMu\nZ2V0Q29sdW1ucygpOwogICAgICAgIFNlbGVjdCBzZWwgPSBzdG9yZS5nZXRT\nUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgc2VsLnNlbGVjdChj\nb2xzKTsKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVj\ndElkKCksIHZlcnMuZ2V0Q2xhc3NNYXBwaW5nKCksIHN0b3JlKTsKCiAgICAg\nICAgUmVzdWx0IHJlcyA9IHNlbC5leGVjdXRlKHN0b3JlLCBudWxsKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXJlcy5uZXh0KCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICBPYmplY3Qg\nbWVtVmVyc2lvbiA9IHNtLmdldFZlcnNpb24oKTsKICAgICAgICAgICAgT2Jq\nZWN0IGRiVmVyc2lvbiA9IG51bGw7CiAgICAgICAgICAgIGlmIChjb2xzLmxl\nbmd0aCA+IDEpCiAgICAgICAgICAgICAgICBkYlZlcnNpb24gPSBuZXcgT2Jq\nZWN0W2NvbHMubGVuZ3RoXTsKCiAgICAgICAgICAgIGJvb2xlYW4gcmVmcmVz\naCA9IGZhbHNlOwogICAgICAgICAgICBPYmplY3QgbWVtLCBkYjsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBkYiA9IHJlcy5nZXRPYmplY3QoY29sc1tpXSwg\nLTEsIG51bGwpOwogICAgICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09\nIDEpCiAgICAgICAgICAgICAgICAgICAgZGJWZXJzaW9uID0gZGI7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgKChPYmplY3Rb\nXSkgZGJWZXJzaW9uKVtpXSA9IGRiOwoKICAgICAgICAgICAgICAgIC8vIGlm\nIHdlIGhhdmVuJ3QgYWxyZWFkeSBkZXRlcm1pbmVkIHRoYXQgd2UgbmVlZCBh\nIHJlZnJlc2gsCiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgbWVt\nIHZlcnNpb24gaXMgZWFybGllciB0aGFuIHRoZSBkYiBvbmUKICAgICAgICAg\nICAgICAgIGlmICghcmVmcmVzaCkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChjb2xzLmxlbmd0aCA9PSAxIHx8IG1lbVZlcnNpb24gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgbWVtID0gbWVtVmVyc2lvbjsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG1l\nbSA9ICgoT2JqZWN0W10pIG1lbVZlcnNpb24pW2ldOwoKICAgICAgICAgICAg\nICAgICAgICBpZiAobWVtID09IG51bGwgfHwgKGRiICE9IG51bGwgJiYgY29t\ncGFyZShtZW0sIGRiKSA8IDApKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKHVwZGF0ZVZlcnNpb24pCiAgICAgICAgICAg\nICAgICBzbS5zZXRWZXJzaW9uKGRiVmVyc2lvbik7CiAgICAgICAgICAgIHJl\ndHVybiAhcmVmcmVzaDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICByZXMuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGlu\ndCBjb21wYXJlVmVyc2lvbihPYmplY3QgdjEsIE9iamVjdCB2MikgewogICAg\nICAgIGlmICh2MSA9PSB2MikKICAgICAgICAgICAgcmV0dXJuIFN0b3JlTWFu\nYWdlci5WRVJTSU9OX1NBTUU7CiAgICAgICAgaWYgKHYxID09IG51bGwgfHwg\ndjIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIFN0b3JlTWFuYWdlci5W\nRVJTSU9OX0RJRkZFUkVOVDsKCiAgICAgICAgaW50IGNtcCA9IGNvbXBhcmUo\ndjEsIHYyKTsKICAgICAgICBpZiAoY21wIDwgMCkKICAgICAgICAgICAgcmV0\ndXJuIFN0b3JlTWFuYWdlci5WRVJTSU9OX0VBUkxJRVI7CiAgICAgICAgaWYg\nKGNtcCA+IDApCiAgICAgICAgICAgIHJldHVybiBTdG9yZU1hbmFnZXIuVkVS\nU0lPTl9MQVRFUjsKICAgICAgICByZXR1cm4gU3RvcmVNYW5hZ2VyLlZFUlNJ\nT05fU0FNRTsKICAgIH0KfQo=\n","encoding":"base64"}

