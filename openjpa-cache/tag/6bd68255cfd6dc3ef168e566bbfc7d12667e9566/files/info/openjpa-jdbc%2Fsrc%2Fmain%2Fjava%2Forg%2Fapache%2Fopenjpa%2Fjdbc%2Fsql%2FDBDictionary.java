{"sha":"e458af6d47821374d7b2168b57c6ccddee4d96dc","node_id":"MDQ6QmxvYjIwNjM2NDplNDU4YWY2ZDQ3ODIxMzc0ZDdiMjE2OGI1N2M2Y2NkZGVlNGQ5NmRj","size":140502,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e458af6d47821374d7b2168b57c6ccddee4d96dc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5w\ndXRTdHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlJlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uU3RyaW5nUmVhZGVyOwppbXBvcnQgamF2YS5pby5Xcml0ZXI7\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5JbnZvY2F0aW9uVGFyZ2V0RXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLm1hdGguQmln\nSW50ZWdlcjsKaW1wb3J0IGphdmEuc3FsLkFycmF5OwppbXBvcnQgamF2YS5z\ncWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZhLnNx\nbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0\nYTsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQg\namF2YS5zcWwuUmVmOwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU1FM\nV2FybmluZzsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGph\ndmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7CmltcG9y\ndCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudGV4dC5NZXNzYWdlRm9y\nbWF0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRp\nbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGls\nLkhhc2hNYXA7CmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5FeHBDb250ZXh0OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhwU3RhdGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0\nZXJWYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLkxpdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5leHBzLlBhcmFtOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2YVNRTFR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5EYXRhU291cmNlRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3Jl\naWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLk5hbWVTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hl\nbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5TY2hlbWE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GaWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5Mb2dnaW5nQ29ubmVj\ndGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU2VyaWFsaXphdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxp\nZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7Cmlt\ncG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBDbGFzcyB3aGljaCBh\nbGxvd3MgdGhlIGNyZWF0aW9uIG9mIFNRTCBkeW5hbWljYWxseSwgaW4gYQog\nKiBkYXRhYmFzZSBhZ25vc3RpYyBmYXNoaW9uLiBTdWJjbGFzcyBmb3IgdGhl\nIG51YW5jZXMgb2YgZGlmZmVyZW50IGRhdGEgc3RvcmVzLgogKi8KcHVibGlj\nIGNsYXNzIERCRGljdGlvbmFyeQogICAgaW1wbGVtZW50cyBDb25maWd1cmFi\nbGUsIENvbm5lY3Rpb25EZWNvcmF0b3IsIEpvaW5TeW50YXhlcywKICAgIExv\nZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLlNRTFdhcm5pbmdIYW5kbGVyIHsK\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBWRU5ET1JfT1RIRVIg\nPSAib3RoZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVkVO\nRE9SX0RBVEFESVJFQ1QgPSAiZGF0YWRpcmVjdCI7CgogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0VfVVBQRVIgPSAidXBwZXIi\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0Vf\nTE9XRVIgPSAibG93ZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU0NIRU1BX0NBU0VfUFJFU0VSVkUgPSAicHJlc2VydmUiOwoKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlNfTkFNRV9CRUZPUkUgPSAi\nYmVmb3JlIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlNf\nTkFNRV9NSUQgPSAibWlkIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry\naW5nIENPTlNfTkFNRV9BRlRFUiA9ICJhZnRlciI7CgogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0VfUE9TVF9TRUxFQ1QgPSAwOwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0VfUFJFX0RJU1RJTkNU\nID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BP\nU1RfRElTVElOQ1QgPSAyOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBp\nbnQgUkFOR0VfUE9TVF9MT0NLID0gMzsKCiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBOQU5PID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgaW50IE1JQ1JPID0gTkFOTyAqIDEwMDA7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIGludCBNSUxMSSA9IE1JQ1JPICogMTAwMDsKICAgIHByb3Rl\nY3RlZCBzdGF0aWMgZmluYWwgaW50IENFTlRJID0gTUlMTEkgKiAxMDsKICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IERFQ0kgPSBNSUxMSSAqIDEw\nMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFNFQyA9IE1JTExJ\nICogMTAwMDsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBOQU1F\nX0FOWSA9IDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBOQU1F\nX1RBQkxFID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IE5B\nTUVfU0VRVUVOQ0UgPSAyOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0\ncmluZyBaRVJPX0RBVEVfU1RSID0KICAgICAgICAiJyIgKyBuZXcgamF2YS5z\ncWwuRGF0ZSgwKSArICInIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0\ncmluZyBaRVJPX1RJTUVfU1RSID0gIiciICsgbmV3IFRpbWUoMCkgKyAiJyI7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgWkVST19USU1FU1RB\nTVBfU1RSID0KICAgICAgICAiJyIgKyBuZXcgVGltZXN0YW1wKDApICsgIici\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoREJEaWN0aW9uYXJ5LmNs\nYXNzKTsKCiAgICAvLyBzY2hlbWEgZGF0YQogICAgcHVibGljIFN0cmluZyBw\nbGF0Zm9ybSA9ICJHZW5lcmljIjsKICAgIHB1YmxpYyBTdHJpbmcgZHJpdmVy\nVmVuZG9yID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgY2F0YWxvZ1NlcGFy\nYXRvciA9ICIuIjsKICAgIHB1YmxpYyBib29sZWFuIGNyZWF0ZVByaW1hcnlL\nZXlzID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgY29uc3RyYWludE5hbWVN\nb2RlID0gQ09OU19OQU1FX0JFRk9SRTsKICAgIHB1YmxpYyBpbnQgbWF4VGFi\nbGVOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhDb2x1bW5O\nYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhDb25zdHJhaW50\nTmFtZUxlbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQgbWF4SW5kZXhOYW1l\nTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJbmRleGVzUGVyVGFi\nbGUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzRm9yZWlnbktleXMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4g\nc3VwcG9ydHNUaW1lc3RhbXBOYW5vcyA9IHRydWU7CiAgICBwdWJsaWMgYm9v\nbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0gdHJ1ZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3RyaWN0RGVsZXRl\nQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQ2Fz\nY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0gdHJ1ZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rpb24g\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRlVXBk\nYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbiA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFibGVXaXRo\nRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgU3RyaW5nIHJlc2VydmVk\nV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzeXN0ZW1TY2hlbWFz\nID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtVGFibGVzID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgZml4ZWRTaXplVHlwZU5hbWVzID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgc2NoZW1hQ2FzZSA9IFNDSEVNQV9DQVNF\nX1VQUEVSOwoKICAgIC8vIHNxbAogICAgcHVibGljIFN0cmluZyB2YWxpZGF0\naW9uU1FMID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgY2xvc2VQb29sU1FM\nID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgaW5pdGlhbGl6YXRpb25TUUwg\nPSBudWxsOwogICAgcHVibGljIGludCBqb2luU3ludGF4ID0gU1lOVEFYX1NR\nTDkyOwogICAgcHVibGljIFN0cmluZyBvdXRlckpvaW5DbGF1c2UgPSAiTEVG\nVCBPVVRFUiBKT0lOIjsKICAgIHB1YmxpYyBTdHJpbmcgaW5uZXJKb2luQ2xh\ndXNlID0gIklOTkVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBjcm9zc0pv\naW5DbGF1c2UgPSAiQ1JPU1MgSk9JTiI7CiAgICBwdWJsaWMgYm9vbGVhbiBy\nZXF1aXJlc0NvbmRpdGlvbkZvckNyb3NzSm9pbiA9IGZhbHNlOwogICAgcHVi\nbGljIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UgPSAiRk9SIFVQREFURSI7CiAg\nICBwdWJsaWMgU3RyaW5nIHRhYmxlRm9yVXBkYXRlQ2xhdXNlID0gbnVsbDsK\nICAgIHB1YmxpYyBTdHJpbmcgZGlzdGluY3RDb3VudENvbHVtblNlcGFyYXRv\nciA9IG51bGw7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1NlbGVjdEZv\nclVwZGF0ZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xv\nY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxlVGFibGVzID0gdHJ1\nZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhPcmRl\nckNsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xv\nY2tpbmdXaXRoT3V0ZXJKb2luID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzTG9ja2luZ1dpdGhJbm5lckpvaW4gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aFNlbGVjdFJhbmdlID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUXVlcnlUaW1lb3V0\nID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHNpbXVsYXRlTG9ja2luZyA9\nIGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTdWJzZWxlY3Qg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDb3JyZWxhdGVk\nU3Vic2VsZWN0ID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nSGF2aW5nID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2Vs\nZWN0U3RhcnRJbmRleCA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNTZWxlY3RFbmRJbmRleCA9IGZhbHNlOwogICAgcHVibGljIGludCBy\nYW5nZVBvc2l0aW9uID0gUkFOR0VfUE9TVF9TRUxFQ1Q7CiAgICBwdWJsaWMg\nYm9vbGVhbiByZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0ID0gZmFsc2U7CiAg\nICBwdWJsaWMgYm9vbGVhbiBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c011bHRpcGxlTm9udHJh\nbnNhY3Rpb25hbFJlc3VsdFNldHMgPSB0cnVlOwogICAgcHVibGljIFN0cmlu\nZyBzZWFyY2hTdHJpbmdFc2NhcGUgPSAiXFwiOwogICAgcHVibGljIGJvb2xl\nYW4gcmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyA9IGZhbHNlOwogICAg\ncHVibGljIGJvb2xlYW4gcmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNvbnMgPSBm\nYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTW9kT3BlcmF0b3Ig\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzWE1MQ29sdW1u\nID0gZmFsc2U7CgogICAgLy8gZnVuY3Rpb25zCiAgICBwdWJsaWMgU3RyaW5n\nIGNhc3RGdW5jdGlvbiA9ICJDQVNUKHswfSBBUyB7MX0pIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgdG9Mb3dlckNhc2VGdW5jdGlvbiA9ICJMT1dFUih7MH0pIjsK\nICAgIHB1YmxpYyBTdHJpbmcgdG9VcHBlckNhc2VGdW5jdGlvbiA9ICJVUFBF\nUih7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgc3RyaW5nTGVuZ3RoRnVuY3Rp\nb24gPSAiQ0hBUl9MRU5HVEgoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIGJp\ndExlbmd0aEZ1bmN0aW9uID0gIihPQ1RFVF9MRU5HVEgoezB9KSAqIDgpIjsK\nICAgIHB1YmxpYyBTdHJpbmcgdHJpbUxlYWRpbmdGdW5jdGlvbiA9ICJUUklN\nKExFQURJTkcgezF9IEZST00gezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRy\naW1UcmFpbGluZ0Z1bmN0aW9uID0gIlRSSU0oVFJBSUxJTkcgezF9IEZST00g\nezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRyaW1Cb3RoRnVuY3Rpb24gPSAi\nVFJJTShCT1RIIHsxfSBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmluZyBj\nb25jYXRlbmF0ZUZ1bmN0aW9uID0gIih7MH18fHsxfSkiOwogICAgcHVibGlj\nIFN0cmluZyBjb25jYXRlbmF0ZURlbGltaXRlciA9ICInT1BFTkpQQVRPS0VO\nJyI7CiAgICBwdWJsaWMgU3RyaW5nIHN1YnN0cmluZ0Z1bmN0aW9uTmFtZSA9\nICJTVUJTVFJJTkciOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50RGF0ZUZ1\nbmN0aW9uID0gIkNVUlJFTlRfREFURSI7CiAgICBwdWJsaWMgU3RyaW5nIGN1\ncnJlbnRUaW1lRnVuY3Rpb24gPSAiQ1VSUkVOVF9USU1FIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgY3VycmVudFRpbWVzdGFtcEZ1bmN0aW9uID0gIkNVUlJFTlRf\nVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcgZHJvcFRhYmxlU1FMID0g\nIkRST1AgVEFCTEUgezB9IjsKCiAgICAvLyB0eXBlcwogICAgcHVibGljIGJv\nb2xlYW4gc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwgPSBmYWxzZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzID0gZmFs\nc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yZUNoYXJzQXNOdW1iZXJzID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdldEJ5dGVzRm9yQmxvYnMg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZVNldEJ5dGVzRm9yQmxv\nYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdldE9iamVjdEZv\nckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRTdHJp\nbmdGb3JDbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlU2V0\nU3RyaW5nRm9yQ2xvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBpbnQgbWF4RW1i\nZWRkZWRCbG9iU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBtYXhFbWJlZGRl\nZENsb2JTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGluQ2xhdXNlTGltaXQg\nPSAtMTsKICAgIHB1YmxpYyBpbnQgZGF0ZVByZWNpc2lvbiA9IE1JTExJOwog\nICAgcHVibGljIGludCBjaGFyYWN0ZXJDb2x1bW5TaXplID0gMjU1OwogICAg\ncHVibGljIFN0cmluZyBhcnJheVR5cGVOYW1lID0gIkFSUkFZIjsKICAgIHB1\nYmxpYyBTdHJpbmcgYmlnaW50VHlwZU5hbWUgPSAiQklHSU5UIjsKICAgIHB1\nYmxpYyBTdHJpbmcgYmluYXJ5VHlwZU5hbWUgPSAiQklOQVJZIjsKICAgIHB1\nYmxpYyBTdHJpbmcgYml0VHlwZU5hbWUgPSAiQklUIjsKICAgIHB1YmxpYyBT\ndHJpbmcgYmxvYlR5cGVOYW1lID0gIkJMT0IiOwogICAgcHVibGljIFN0cmlu\nZyBib29sZWFuVHlwZU5hbWUgPSAiQk9PTEVBTiI7CiAgICBwdWJsaWMgU3Ry\naW5nIGNoYXJUeXBlTmFtZSA9ICJDSEFSIjsKICAgIHB1YmxpYyBTdHJpbmcg\nY2xvYlR5cGVOYW1lID0gIkNMT0IiOwogICAgcHVibGljIFN0cmluZyBkYXRl\nVHlwZU5hbWUgPSAiREFURSI7CiAgICBwdWJsaWMgU3RyaW5nIGRlY2ltYWxU\neXBlTmFtZSA9ICJERUNJTUFMIjsKICAgIHB1YmxpYyBTdHJpbmcgZGlzdGlu\nY3RUeXBlTmFtZSA9ICJESVNUSU5DVCI7CiAgICBwdWJsaWMgU3RyaW5nIGRv\ndWJsZVR5cGVOYW1lID0gIkRPVUJMRSI7CiAgICBwdWJsaWMgU3RyaW5nIGZs\nb2F0VHlwZU5hbWUgPSAiRkxPQVQiOwogICAgcHVibGljIFN0cmluZyBpbnRl\nZ2VyVHlwZU5hbWUgPSAiSU5URUdFUiI7CiAgICBwdWJsaWMgU3RyaW5nIGph\ndmFPYmplY3RUeXBlTmFtZSA9ICJKQVZBX09CSkVDVCI7CiAgICBwdWJsaWMg\nU3RyaW5nIGxvbmdWYXJiaW5hcnlUeXBlTmFtZSA9ICJMT05HVkFSQklOQVJZ\nIjsKICAgIHB1YmxpYyBTdHJpbmcgbG9uZ1ZhcmNoYXJUeXBlTmFtZSA9ICJM\nT05HVkFSQ0hBUiI7CiAgICBwdWJsaWMgU3RyaW5nIG51bGxUeXBlTmFtZSA9\nICJOVUxMIjsKICAgIHB1YmxpYyBTdHJpbmcgbnVtZXJpY1R5cGVOYW1lID0g\nIk5VTUVSSUMiOwogICAgcHVibGljIFN0cmluZyBvdGhlclR5cGVOYW1lID0g\nIk9USEVSIjsKICAgIHB1YmxpYyBTdHJpbmcgcmVhbFR5cGVOYW1lID0gIlJF\nQUwiOwogICAgcHVibGljIFN0cmluZyByZWZUeXBlTmFtZSA9ICJSRUYiOwog\nICAgcHVibGljIFN0cmluZyBzbWFsbGludFR5cGVOYW1lID0gIlNNQUxMSU5U\nIjsKICAgIHB1YmxpYyBTdHJpbmcgc3RydWN0VHlwZU5hbWUgPSAiU1RSVUNU\nIjsKICAgIHB1YmxpYyBTdHJpbmcgdGltZVR5cGVOYW1lID0gIlRJTUUiOwog\nICAgcHVibGljIFN0cmluZyB0aW1lc3RhbXBUeXBlTmFtZSA9ICJUSU1FU1RB\nTVAiOwogICAgcHVibGljIFN0cmluZyB0aW55aW50VHlwZU5hbWUgPSAiVElO\nWUlOVCI7CiAgICBwdWJsaWMgU3RyaW5nIHZhcmJpbmFyeVR5cGVOYW1lID0g\nIlZBUkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIHZhcmNoYXJUeXBlTmFt\nZSA9ICJWQVJDSEFSIjsKICAgIHB1YmxpYyBTdHJpbmcgeG1sVHlwZU5hbWUg\nPSAiWE1MIjsKICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3RyaW5nVmFsID0gIiI7\nCgogICAgLy8gc2NoZW1hIG1ldGFkYXRhCiAgICBwdWJsaWMgYm9vbGVhbiB1\nc2VTY2hlbWFOYW1lID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgdGFibGVU\neXBlcyA9ICJUQUJMRSI7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Nj\naGVtYUZvckdldFRhYmxlcyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c1NjaGVtYUZvckdldENvbHVtbnMgPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRDb2x1bW5zID0gdHJ1\nZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0\nUHJpbWFyeUtleXMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTnVsbFRhYmxlRm9yR2V0SW5kZXhJbmZvID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldEltcG9ydGVkS2V5\ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0QmVzdFJvd0lk\nZW50aWZpZXJGb3JQcmltYXJ5S2V5cyA9IGZhbHNlOwogICAgcHVibGljIGJv\nb2xlYW4gcmVxdWlyZXNBdXRvQ29tbWl0Rm9yTWV0YURhdGEgPSBmYWxzZTsK\nCiAgICAvLyBhdXRvLWluY3JlbWVudAogICAgcHVibGljIGludCBtYXhBdXRv\nQXNzaWduTmFtZUxlbmd0aCA9IDMxOwogICAgcHVibGljIFN0cmluZyBhdXRv\nQXNzaWduQ2xhdXNlID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fz\nc2lnblR5cGVOYW1lID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzQXV0b0Fzc2lnbiA9IGZhbHNlOwogICAgcHVibGljIFN0cmluZyBsYXN0\nR2VuZXJhdGVkS2V5UXVlcnkgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBu\nZXh0U2VxdWVuY2VRdWVyeSA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHNl\ncXVlbmNlU1FMID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VxdWVuY2VT\nY2hlbWFTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzZXF1ZW5jZU5h\nbWVTUUwgPSBudWxsOwoKICAgIHByb3RlY3RlZCBKREJDQ29uZmlndXJhdGlv\nbiBjb25mID0gbnVsbDsKICAgIHByb3RlY3RlZCBMb2cgbG9nID0gbnVsbDsK\nICAgIHByb3RlY3RlZCBib29sZWFuIGNvbm5lY3RlZCA9IGZhbHNlOwogICAg\ncHJvdGVjdGVkIGZpbmFsIFNldCByZXNlcnZlZFdvcmRTZXQgPSBuZXcgSGFz\naFNldCgpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCBzeXN0ZW1TY2hlbWFT\nZXQgPSBuZXcgSGFzaFNldCgpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCBz\neXN0ZW1UYWJsZVNldCA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQg\nZmluYWwgU2V0IGZpeGVkU2l6ZVR5cGVOYW1lU2V0ID0gbmV3IEhhc2hTZXQo\nKTsKCiAgICAvLyB3aGVuIHdlIHN0b3JlIHZhbHVlcyB0aGF0IGxvc2UgcHJl\nY2lvbiwgdHJhY2sgdGhlIHR5cGVzIHNvIHRoYXQgdGhlCiAgICAvLyBmaXJz\ndCB0aW1lIGl0IGhhcHBlbnMgd2UgY2FuIHdhcm4gdGhlIHVzZXIKICAgIHBy\naXZhdGUgU2V0IF9wcmVjaXNpb25XYXJuZWRUeXBlcyA9IG51bGw7CgogICAg\nLy8gY2FjaGUgbG9iIG1ldGhvZHMKICAgIHByaXZhdGUgTWV0aG9kIF9zZXRC\neXRlcyA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCBfc2V0U3RyaW5nID0g\nbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9zZXRDaGFyU3RyZWFtID0gbnVs\nbDsKCiAgICBwdWJsaWMgREJEaWN0aW9uYXJ5KCkgewogICAgICAgIGZpeGVk\nU2l6ZVR5cGVOYW1lU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJp\nbmdbXXsKICAgICAgICAgICAgIkJJR0lOVCIsICJCSVQiLCAiQkxPQiIsICJD\nTE9CIiwgIkRBVEUiLCAiREVDSU1BTCIsICJESVNUSU5DVCIsCiAgICAgICAg\nICAgICJET1VCTEUiLCAiRkxPQVQiLCAiSU5URUdFUiIsICJKQVZBX09CSkVD\nVCIsICJOVUxMIiwgIk5VTUVSSUMiLAogICAgICAgICAgICAiT1RIRVIiLCAi\nUkVBTCIsICJSRUYiLCAiU01BTExJTlQiLCAiU1RSVUNUIiwgIlRJTUUiLCAi\nVElNRVNUQU1QIiwKICAgICAgICAgICAgIlRJTllJTlQiLAogICAgICAgIH0p\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxl\nZCB3aGVuIHRoZSBkaWN0aW9uYXJ5IGZpcnN0IHNlZXMgYW55IGNvbm5lY3Rp\nb24uCiAgICAgKiBJdCBpcyB1c2VkIHRvIGluaXRpYWxpemUgZGljdGlvbmFy\neSBtZXRhZGF0YSBpZiBuZWVkZWQuIElmIHlvdQogICAgICogb3ZlcnJpZGUg\ndGhpcyBtZXRob2QsIGJlIHN1cmUgdG8gY2FsbAogICAgICogPGNvZGU+c3Vw\nZXIuY29ubmVjdGVkQ29uZmlndXJhdGlvbjwvY29kZT4uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oQ29ubmVjdGlv\nbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmICghY29ubmVjdGVkKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKERCRGljdGlvbmFyeUZhY3RvcnkudG9TdHJp\nbmcKICAgICAgICAgICAgICAgICAgICAgICAgKGNvbm4uZ2V0TWV0YURhdGEo\nKSkpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKGUudG9TdHJpbmcoKSwgZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29ubmVjdGVkID0gdHJ1ZTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZXN1\nbHRTZXQgd3JhcHBlcnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgQXJyYXkgZ2V0QXJyYXkoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBycy5nZXRBcnJheShjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRB\nc2NpaVN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEFz\nY2lpU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIEJpZ0RlY2ltYWwgZ2V0QmlnRGVjaW1hbChSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSB7CiAgICAg\nICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAg\nICAgICAgICAgIHJldHVybiAoc3RyID09IG51bGwpID8gbnVsbCA6IG5ldyBC\naWdEZWNpbWFsKHN0cik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBycy5n\nZXRCaWdEZWNpbWFsKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBzcGVjaWZpZWQgY29sdW1uIHZhbHVlIGFzIGFuIHVua25v\nd24gbnVtZXJpYyB0eXBlOwogICAgICogd2UgdHJ5IGZyb20gdGhlIG1vc3Qg\nZ2VuZXJpYyB0byB0aGUgbGVhc3QgZ2VuZXJpYy4KICAgICAqLwogICAgcHVi\nbGljIE51bWJlciBnZXROdW1iZXIoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHRy\neSBmcm9tIHRoZSBtb3N0IGdlbmVyaWMsIGFuZCBpZiBlcnJvcnMgb2NjdXIs\nIHRyeQogICAgICAgIC8vIGxlc3MgZ2VuZXJpYyB0eXBlczsgdGhpcyBlbmFi\nbGVzIHVzIHRvIGhhbmRsZSB2YWx1ZXMKICAgICAgICAvLyBsaWtlIERvdWJs\nZS5OYU4gd2l0aG91dCBoYXZpbmcgdG8gaW50cm9zcGVjdCBvbiB0aGUKICAg\nICAgICAvLyBSZXN1bHRTZXRNZXRhRGF0YSAoYnVnICMxMDUzKS4gbm90ZSB0\naGF0IHdlIGhhbmRsZQogICAgICAgIC8vIGdlbmVyaWMgZXhjZXB0aW9ucywg\nc2luY2Ugc29tZSBkcml2ZXJzIG1heSB0aHJvdwogICAgICAgIC8vIE51bWJl\nckZvcm1hdEV4Y2VwdGlvbnMsIHdoZXJlYXMgb3RoZXJzIG1heSB0aHJvdyBT\nUUxFeGNlcHRpb25zCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJu\nIGdldEJpZ0RlY2ltYWwocnMsIGNvbHVtbik7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUxKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IERvdWJsZShnZXREb3VibGUocnMsIGNvbHVtbikp\nOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTIpIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBGbG9hdChnZXRGbG9hdChycywgY29sdW1uKSk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZTMpIHsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVy\ncy52YWx1ZU9mKGdldExvbmcocnMsIGNvbHVtbikpOwogICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlNCkgewogICAgICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIE51bWJlcnMudmFsdWVPZihnZXRJbnQocnMsIGNvbHVtbikpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKGUxIGluc3RhbmNlb2YgUnVudGltZUV4Y2VwdGlvbikKICAg\nICAgICAgICAgICAgIHRocm93KFJ1bnRpbWVFeGNlcHRpb24pIGUxOwogICAg\nICAgICAgICBpZiAoZTEgaW5zdGFuY2VvZiBTUUxFeGNlcHRpb24pCiAgICAg\nICAgICAgICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIGUxOwogICAgICAgIH0K\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0\nU2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIEJpZ0ludGVnZXIgZ2V0QmlnSW50ZWdlcihSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSB7CiAg\nICAgICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7\nCiAgICAgICAgICAgIHJldHVybiAoc3RyID09IG51bGwpID8gbnVsbCA6IG5l\ndyBCaWdEZWNpbWFsKHN0cikudG9CaWdJbnRlZ2VyKCk7CiAgICAgICAgfQog\nICAgICAgIEJpZ0RlY2ltYWwgYmQgPSBnZXRCaWdEZWNpbWFsKHJzLCBjb2x1\nbW4pOwogICAgICAgIHJldHVybiAoYmQgPT0gbnVsbCkgPyBudWxsIDogYmQu\ndG9CaWdJbnRlZ2VyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIElucHV0U3RyZWFtIGdldEJpbmFyeVN0cmVhbShSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIHJzLmdldEJpbmFyeVN0cmVhbShjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBCbG9iIGdldEJsb2IoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCbG9iKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRCbG9i\nT2JqZWN0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgSkRCQ1N0b3JlIHN0\nb3JlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIElu\ncHV0U3RyZWFtIGluID0gbnVsbDsKICAgICAgICBpZiAodXNlR2V0Qnl0ZXNG\nb3JCbG9icyB8fCB1c2VHZXRPYmplY3RGb3JCbG9icykgewogICAgICAgICAg\nICBieXRlW10gYnl0ZXMgPSBnZXRCeXRlcyhycywgY29sdW1uKTsKICAgICAg\nICAgICAgaWYgKGJ5dGVzICE9IG51bGwgJiYgYnl0ZXMubGVuZ3RoID4gMCkK\nICAgICAgICAgICAgICAgIGluID0gbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFt\nKGJ5dGVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBCbG9iIGJs\nb2IgPSBnZXRCbG9iKHJzLCBjb2x1bW4pOwogICAgICAgICAgICBpZiAoYmxv\nYiAhPSBudWxsICYmIGJsb2IubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAg\nICAgaW4gPSBibG9iLmdldEJpbmFyeVN0cmVhbSgpOwogICAgICAgIH0KICAg\nICAgICBpZiAoaW4gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzdG9yZSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRpb24uZGVzZXJp\nYWxpemUoaW4sIG51bGwpOwogICAgICAgICAgICByZXR1cm4gU2VyaWFsaXph\ndGlvbi5kZXNlcmlhbGl6ZShpbiwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgaW4uY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gaW9lKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9m\nIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Qm9vbGVhbihS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJvb2xlYW4oY29sdW1u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgYnl0ZSBnZXRC\neXRlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Qnl0ZShjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlW10g\nZ2V0Qnl0ZXMoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1c2VHZXRCeXRlc0Zv\nckJsb2JzKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0Qnl0ZXMoY29sdW1u\nKTsKICAgICAgICBpZiAodXNlR2V0T2JqZWN0Rm9yQmxvYnMpCiAgICAgICAg\nICAgIHJldHVybiAoYnl0ZVtdKSBycy5nZXRPYmplY3QoY29sdW1uKTsKCiAg\nICAgICAgQmxvYiBibG9iID0gZ2V0QmxvYihycywgY29sdW1uKTsKICAgICAg\nICBpZiAoYmxvYiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpbnQgbGVuZ3RoID0gKGludCkgYmxvYi5sZW5ndGgoKTsKICAg\nICAgICBpZiAobGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBibG9iLmdldEJ5dGVzKDEsIGxlbmd0aCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4gQ29udmVydHMgdGhlIGRhdGUgZnJvbSBhIHtAbGluayBU\naW1lc3RhbXB9IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBDYWxl\nbmRhciBnZXRDYWxlbmRhcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRGF0ZSBkID0g\nZ2V0RGF0ZShycywgY29sdW1uKTsKICAgICAgICBpZiAoZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ2FsZW5kYXIgY2Fs\nID0gQ2FsZW5kYXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICBjYWwuc2V0VGlt\nZShkKTsKICAgICAgICByZXR1cm4gY2FsOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBjaGFyIGdldENoYXIoUmVzdWx0U2V0IHJzLCBpbnQg\nY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmIChzdG9yZUNoYXJzQXNOdW1iZXJzKQogICAgICAgICAgICByZXR1cm4g\nKGNoYXIpIGdldEludChycywgY29sdW1uKTsKCiAgICAgICAgU3RyaW5nIHN0\nciA9IGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICByZXR1cm4gKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoc3RyKSkgPyAwIDogc3RyLmNoYXJBdCgwKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgUmVhZGVyIGdldENo\nYXJhY3RlclN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdl\ndENoYXJhY3RlclN0cmVhbShjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBDbG9iIGdldENsb2IoUmVzdWx0U2V0IHJzLCBpbnQg\nY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBycy5nZXRDbG9iKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwg\nUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDbG9iU3RyaW5nKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAodXNlR2V0U3RyaW5nRm9yQ2xvYnMpCiAgICAgICAg\nICAgIHJldHVybiBycy5nZXRTdHJpbmcoY29sdW1uKTsKCiAgICAgICAgQ2xv\nYiBjbG9iID0gZ2V0Q2xvYihycywgY29sdW1uKTsKICAgICAgICBpZiAoY2xv\nYiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoY2xvYi5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gIiI7\nCgogICAgICAgIC8vIHVubGlrZWx5IHRoYXQgd2UnbGwgaGF2ZSBzdHJpbmdz\nIG92ZXIgSW50ZWdlci5NQVhfVkFMVUUgY2hhcnMKICAgICAgICByZXR1cm4g\nY2xvYi5nZXRTdWJTdHJpbmcoMSwgKGludCkgY2xvYi5sZW5ndGgoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4gQ29udmVydHMgdGhlIGRhdGUgZnJvbSBhIHtAbGluayBU\naW1lc3RhbXB9IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBEYXRl\nIGdldERhdGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFRpbWVzdGFtcCB0c3RhbXAg\nPSBnZXRUaW1lc3RhbXAocnMsIGNvbHVtbiwgbnVsbCk7CiAgICAgICAgaWYg\nKHRzdGFtcCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgLy8gZ2V0IHRoZSBmcmFjdGlvbmFsIHNlY29uZHMgY29tcG9uZW50\nLCByb3VuZGluZyBhd2F5IGFueXRoaW5nIGJleW9uZAogICAgICAgIC8vIG1p\nbGxpc2Vjb25kcwogICAgICAgIGludCBmcmFjdGlvbmFsID0gKGludCkgTWF0\naC5yb3VuZCh0c3RhbXAuZ2V0TmFub3MoKSAvIChkb3VibGUpIE1JTExJKTsK\nCiAgICAgICAgLy8gZ2V0IHRoZSBtaWxsaXMgY29tcG9uZW50OyBzb21lIEpE\nQkMgZHJpdmVycyByb3VuZCB0aGlzIHRvIHRoZQogICAgICAgIC8vIG5lYXJl\nc3Qgc2Vjb25kLCB3aGlsZSBvdGhlcnMgZG8gbm90CiAgICAgICAgbG9uZyBt\naWxsaXMgPSAodHN0YW1wLmdldFRpbWUoKSAvIDEwMDBMKSAqIDEwMDBMOwog\nICAgICAgIHJldHVybiBuZXcgRGF0ZShtaWxsaXMgKyBmcmFjdGlvbmFsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgamF2YS5zcWwuRGF0\nZSBnZXREYXRlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIg\nY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldERhdGUo\nY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0RGF0ZShjb2x1bW4sIGNh\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGRvdWJsZSBn\nZXREb3VibGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXREb3Vi\nbGUoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nZmxvYXQgZ2V0RmxvYXQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5n\nZXRGbG9hdChjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVy\ndCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0\nbyB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgZ2V0SW50KFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMu\nZ2V0SW50KGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIExvY2FsZSBnZXRMb2NhbGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmlu\nZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoc3RyKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIFN0cmluZ1tdIHBhcmFtcyA9IFN0cmluZ3Muc3BsaXQo\nc3RyLCAiXyIsIDMpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoIDwgMykK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIG5ldyBM\nb2NhbGUocGFyYW1zWzBdLCBwYXJhbXNbMV0sIHBhcmFtc1syXSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGxvbmcgZ2V0TG9uZyhSZXN1\nbHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldExvbmcoY29sdW1uKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldE9iamVj\ndChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIE1hcCBtYXApCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG1hcCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0T2JqZWN0KGNvbHVtbik7CiAg\nICAgICAgcmV0dXJuIHJzLmdldE9iamVjdChjb2x1bW4sIG1hcCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFJlZiBnZXRSZWYoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRSZWYoY29sdW1u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgc2hvcnQgZ2V0\nU2hvcnQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRTaG9ydChj\nb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3Bl\nY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJv\ncGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0U3RyaW5nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0\nU3RyaW5nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIFRpbWUgZ2V0VGltZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENh\nbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5n\nZXRUaW1lKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldFRpbWUoY29s\ndW1uLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUg\ncHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBU\naW1lc3RhbXAgZ2V0VGltZXN0YW1wKFJlc3VsdFNldCBycywgaW50IGNvbHVt\nbiwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHJzLmdldFRpbWVzdGFtcChjb2x1bW4pOwogICAgICAgIHJldHVybiBycy5n\nZXRUaW1lc3RhbXAoY29sdW1uLCBjYWwpOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHJlcGFyZWRTdGF0ZW1l\nbnQgd3JhcHBlcnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBh\ncmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRBcnJheShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgQXJyYXkgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QXJyYXkoaWR4\nLCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRBc2NpaVN0cmVhbShQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgaW50IGlkeCwKICAgICAgICBJbnB1dFN0cmVhbSB2YWws\nIGludCBsZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QXNjaWlTdHJlYW0oaWR4LCB2\nYWwsIGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpZ0RlY2ltYWwoUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEJpZ0RlY2ltYWwgdmFsLAogICAg\nICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxl\nKFR5cGVzLlZBUkNIQVIsIG51bGwsIDAsIDApKQogICAgICAgICAgICB8fCAo\nY29sID09IG51bGwgJiYgc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpKQog\nICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5n\nKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXRC\naWdEZWNpbWFsKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QmlnSW50ZWdlcihQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQmlnSW50ZWdlciB2\nYWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoKGNvbCAhPSBudWxsICYmIGNvbC5pc0Nv\nbXBhdGlibGUoVHlwZXMuVkFSQ0hBUiwgbnVsbCwgMCwgMCkpCiAgICAgICAg\nICAgIHx8IChjb2wgPT0gbnVsbCAmJiBzdG9yZUxhcmdlTnVtYmVyc0FzU3Ry\naW5ncykpCiAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwu\ndG9TdHJpbmcoKSwgY29sKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNl\ndEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgbmV3IEJpZ0RlY2ltYWwodmFsKSwg\nY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QmluYXJ5U3RyZWFtKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LAogICAgICAgIElucHV0U3RyZWFtIHZhbCwg\naW50IGxlbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRCaW5hcnlTdHJlYW0oaWR4LCB2\nYWwsIGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2IoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIEJsb2IgdmFsLCBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEJs\nb2IoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LiBV\nc2VzIHRoZQogICAgICoge0BsaW5rICNzZXJpYWxpemV9IG1ldGhvZCB0byBz\nZXJpYWxpemUgdGhlIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCbG9iT2JqZWN0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4\nLCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wsIEpEQkNTdG9yZSBz\ndG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBz\nZXRCeXRlcyhzdG1udCwgaWR4LCBzZXJpYWxpemUodmFsLCBzdG9yZSksIGNv\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVl\nIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldEJvb2xlYW4oUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIGJvb2xlYW4gdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQu\nc2V0SW50KGlkeCwgKHZhbCkgPyAxIDogMCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGUo\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGJ5dGUgdmFsLCBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHN0bW50LnNldEJ5dGUoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0\naGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCeXRl\ncyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgYnl0ZVtdIHZh\nbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICh1c2VTZXRCeXRlc0ZvckJsb2JzKQogICAg\nICAgICAgICBzdG1udC5zZXRCeXRlcyhpZHgsIHZhbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzZXRCaW5hcnlTdHJlYW0oc3RtbnQsIGlkeCwgbmV3\nIEJ5dGVBcnJheUlucHV0U3RyZWFtKHZhbCksCiAgICAgICAgICAgICAgICB2\nYWwubGVuZ3RoLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDaGFyKFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBjaGFyIHZhbCwgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoKGNv\nbCAhPSBudWxsICYmIGNvbC5pc0NvbXBhdGlibGUoVHlwZXMuSU5URUdFUiwg\nbnVsbCwgMCwgMCkpCiAgICAgICAgICAgIHx8IChjb2wgPT0gbnVsbCAmJiBz\ndG9yZUNoYXJzQXNOdW1iZXJzKSkKICAgICAgICAgICAgc2V0SW50KHN0bW50\nLCBpZHgsIChpbnQpIHZhbCwgY29sKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCBTdHJpbmcudmFsdWVPZih2YWwp\nLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRDaGFyYWN0ZXJTdHJlYW0oUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAgICAgUmVhZGVyIHZhbCwg\naW50IGxlbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRDaGFyYWN0ZXJTdHJlYW0oaWR4\nLCB2YWwsIGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENsb2IoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIENsb2IgdmFsLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndENsb2IoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDbG9iU3RyaW5nKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBTdHJpbmcgdmFsLAogICAg\nICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHVzZVNldFN0cmluZ0ZvckNsb2JzKQogICAgICAgICAg\nICBzdG1udC5zZXRTdHJpbmcoaWR4LCB2YWwpOwogICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAvLyBzZXQgcmVhZGVyIGZyb20gc3RyaW5nCiAgICAgICAg\nICAgIFN0cmluZ1JlYWRlciBpbiA9IG5ldyBTdHJpbmdSZWFkZXIodmFsKTsK\nICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBpZHgsIGlu\nLCB2YWwubGVuZ3RoKCksIGNvbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0\nbyB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRE\nYXRlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBEYXRlIHZh\nbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5cGUoKSA9PSBU\neXBlcy5EQVRFKQogICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIG5l\ndyBqYXZhLnNxbC5EYXRlKHZhbC5nZXRUaW1lKCkpLCBudWxsLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBlKCkg\nPT0gVHlwZXMuVElNRSkKICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4\nLCBuZXcgVGltZSh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lc3RhbXApCiAgICAgICAg\nICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LChUaW1lc3RhbXApIHZhbCwg\nbnVsbCwgY29sKTsgICAKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldFRp\nbWVzdGFtcChzdG1udCwgaWR4LCBuZXcgVGltZXN0YW1wKHZhbC5nZXRUaW1l\nKCkpLCBudWxsLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRlKFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBqYXZhLnNxbC5EYXRlIHZhbCwKICAg\nICAgICBDYWxlbmRhciBjYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAg\nICAgICAgICBzdG1udC5zZXREYXRlKGlkeCwgdmFsKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHN0bW50LnNldERhdGUoaWR4LCB2YWwsIGNhbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEg\ncGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldENhbGVuZGFyKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBDYWxlbmRhciB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBieSBkZWZh\ndWx0IHdlIG1lcmVseSBkZWxlZ2F0ZSB0aGUgdGhlIERhdGUgcGFyYW1ldGVy\nCiAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCB2YWwuZ2V0VGltZSgpLCBj\nb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREb3VibGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIGRvdWJsZSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5z\nZXREb3VibGUoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRGbG9hdChQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgZmxvYXQgdmFsLAogICAgICAg\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3RtbnQuc2V0RmxvYXQoaWR4LCB2YWwpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0\nbyB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJ\nbnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGludCB2YWws\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3RtbnQuc2V0SW50KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8g\ndGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TG9u\nZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgbG9uZyB2YWws\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3RtbnQuc2V0TG9uZyhpZHgsIHZhbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRv\nIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExv\nY2FsZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgTG9jYWxl\nIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwu\nZ2V0TGFuZ3VhZ2UoKSArICJfIiArIHZhbC5nZXRDb3VudHJ5KCkKICAgICAg\nICAgICAgKyAiXyIgKyB2YWwuZ2V0VmFyaWFudCgpLCBjb2wpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlcnMgdG8gdGhlIHN0YXRlbWVudC4gVGhlIGNvbHVtbgogICAgICogdHlw\nZSB3aWxsIGNvbWUgZnJvbSB7QGxpbmsgVHlwZXN9LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXROdWxsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBpbnQgY29sVHlwZSwKICAgICAgICBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldE51\nbGwoaWR4LCBjb2xUeXBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TnVtYmVyKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBOdW1iZXIgbnVtLAogICAgICAg\nIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gY2hlY2sgZm9yIGtub3duIGZsb2F0aW5nIHBvaW50IHR5cGVz\nIHRvIGdpdmUgZHJpdmVyIGEgY2hhbmNlIHRvCiAgICAgICAgLy8gaGFuZGxl\nIHNwZWNpYWwgbnVtYmVycyBsaWtlIE5hTiBhbmQgaW5maW5pdHk7IGJ1ZyAj\nMTA1MwogICAgICAgIGlmIChudW0gaW5zdGFuY2VvZiBEb3VibGUpCiAgICAg\nICAgICAgIHNldERvdWJsZShzdG1udCwgaWR4LCAoKERvdWJsZSkgbnVtKS5k\nb3VibGVWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKG51bSBpbnN0\nYW5jZW9mIEZsb2F0KQogICAgICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4\nLCAoKEZsb2F0KSBudW0pLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgbmV3\nIEJpZ0RlY2ltYWwobnVtLnRvU3RyaW5nKCkpLCBjb2wpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\ncnMgdG8gdGhlIHN0YXRlbWVudC4gVGhlIGNvbHVtbgogICAgICogdHlwZSB3\naWxsIGNvbWUgZnJvbSB7QGxpbmsgVHlwZXN9LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRPYmplY3QoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGlu\ndCBpZHgsIE9iamVjdCB2YWwsCiAgICAgICAgaW50IGNvbFR5cGUsIENvbHVt\nbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGNvbFR5cGUgPT0gLTEgfHwgY29sVHlwZSA9PSBUeXBlcy5PVEhFUikK\nICAgICAgICAgICAgc3RtbnQuc2V0T2JqZWN0KGlkeCwgdmFsKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNldE9iamVjdChpZHgsIHZhbCwg\nY29sVHlwZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlZihQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgUmVmIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRSZWYoaWR4\nLCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRTaG9ydChQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgc2hvcnQgdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQu\nc2V0U2hvcnQoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJpbmcoUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIFN0cmluZyB2YWwsCiAgICAg\nICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBzdG1udC5zZXRTdHJpbmcoaWR4LCB2YWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRUaW1lKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBUaW1l\nIHZhbCwKICAgICAgICBDYWxlbmRhciBjYWwsIENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBu\ndWxsKQogICAgICAgICAgICBzdG1udC5zZXRUaW1lKGlkeCwgdmFsKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNldFRpbWUoaWR4LCB2YWws\nIGNhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFRpbWVzdGFtcChQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwKICAgICAgICBUaW1lc3RhbXAgdmFsLCBDYWxl\nbmRhciBjYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgd2UgZG8gbm90IGluc2Vy\ndCBkYXRlcyBhdCBhIGdyZWF0ZXIgcHJlY2lzaW9uIHRoYW4KICAgICAgICAv\nLyB0aGF0IGF0IHdoaWNoIHRoZXkgd2lsbCBiZSByZXR1cm5lZCBieSBhIFNF\nTEVDVAogICAgICAgIGludCByb3VuZGVkID0gKGludCkgTWF0aC5yb3VuZCh2\nYWwuZ2V0TmFub3MoKSAvCiAgICAgICAgICAgIChkb3VibGUpIGRhdGVQcmVj\naXNpb24pOwogICAgICAgIGludCBuYW5vcyA9IHJvdW5kZWQgKiBkYXRlUHJl\nY2lzaW9uOwogICAgICAgIGlmIChuYW5vcyA+IDk5OTk5OTk5OSkgewogICAg\nICAgICAgICAvLyByb2xsb3ZlciB0byBuZXh0IHNlY29uZAogICAgICAgICAg\nICB2YWwuc2V0VGltZSh2YWwuZ2V0VGltZSgpICsgMTAwMCk7CiAgICAgICAg\nICAgIG5hbm9zID0gMDsKICAgICAgICB9CgogICAgICAgIGlmIChzdXBwb3J0\nc1RpbWVzdGFtcE5hbm9zKQogICAgICAgICAgICB2YWwuc2V0TmFub3MobmFu\nb3MpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFsLnNldE5hbm9zKDAp\nOwoKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0bW50\nLnNldFRpbWVzdGFtcChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG1udC5zZXRUaW1lc3RhbXAoaWR4LCB2YWwsIGNhbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgYSBjb2x1bW4gdmFsdWUgaW50byBhIHBy\nZXBhcmVkIHN0YXRlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RtbnQg\ndGhlIHByZXBhcmVkIHN0YXRlbWVudCB0byBwYXJhbWV0ZXJpemUKICAgICAq\nIEBwYXJhbSBpZHggdGhlIGluZGV4IG9mIHRoZSBwYXJhbWV0ZXIgaW4gdGhl\nIHByZXBhcmVkIHN0YXRlbWVudAogICAgICogQHBhcmFtIHZhbCB0aGUgdmFs\ndWUgb2YgdGhlIGNvbHVtbgogICAgICogQHBhcmFtIGNvbCB0aGUgY29sdW1u\nIGJlaW5nIHNldAogICAgICogQHBhcmFtIHR5cGUgdGhlIGZpZWxkIG1hcHBp\nbmcgdHlwZSBjb2RlIGZvciB0aGUgdmFsdWUKICAgICAqIEBwYXJhbSBzdG9y\nZSB0aGUgc3RvcmUgbWFuYWdlciBmb3IgdGhlIGN1cnJlbnQgY29udGV4dAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlZChQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1\nbW4gY29sLCBpbnQgdHlwZSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkg\newogICAgICAgICAgICBzZXROdWxsKHN0bW50LCBpZHgsIChjb2wgPT0gbnVs\nbCkgPyBUeXBlcy5PVEhFUiA6IGNvbC5nZXRUeXBlKCksCiAgICAgICAgICAg\nICAgICBjb2wpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBTaXplZCBzOwogICAgICAgIENhbGVuZGFyZCBjOwogICAgICAgIHN3\naXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09M\nRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoK\nICAgICAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChCb29s\nZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAg\nICAgICAgc2V0Qnl0ZShzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5ieXRl\nVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIHNldENoYXIoc3Rt\nbnQsIGlkeCwgKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCksIGNvbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VC\nTEVfT0JKOgogICAgICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgs\nICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAg\nICAgICAgICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2\nYWwpLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBzZXRJ\nbnQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05H\nX09CSjoKICAgICAgICAgICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChO\ndW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAg\nICAgICAgIHNldFNob3J0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLnNo\nb3J0VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAg\nICBpZiAoY29sICE9IG51bGwgJiYgKGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMu\nQ0xPQgogICAgICAgICAgICAgICAgICAgIHx8IGNvbC5nZXRUeXBlKCkgPT0g\nVHlwZXMuTE9OR1ZBUkNIQVIpKQogICAgICAgICAgICAgICAgICAgIHNldENs\nb2JTdHJpbmcoc3RtbnQsIGlkeCwgKFN0cmluZykgdmFsLCBjb2wpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFN0cmlu\nZyhzdG1udCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgc2V0QmxvYk9iamVjdChzdG1udCwgaWR4LCB2\nYWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBz\nZXREYXRlKHN0bW50LCBpZHgsIChEYXRlKSB2YWwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FM\nRU5EQVI6CiAgICAgICAgICAgICAgICBzZXRDYWxlbmRhcihzdG1udCwgaWR4\nLCAoQ2FsZW5kYXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAg\nICAgICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVj\naW1hbCkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAg\nICAgICBzZXRCaWdJbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2\nYWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgc2V0TnVt\nYmVyKHN0bW50LCBpZHgsIChOdW1iZXIpIHZhbCwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NB\nTEU6CiAgICAgICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExv\nY2FsZSkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAg\nICAgICAgIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAo\nU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldEFzY2lpU3RyZWFtKHN0\nbW50LCBpZHgsIChJbnB1dFN0cmVhbSkgcy52YWx1ZSwgcy5zaXplLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLkJJTkFSWV9TVFJFQU06CiAgICAgICAgICAgICAgICBzID0g\nKFNpemVkKSB2YWw7CiAgICAgICAgICAgICAgICBzZXRCaW5hcnlTdHJlYW0o\nc3RtbnQsIGlkeCwgKElucHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuQkxPQjoKICAgICAgICAgICAgICAgIHNldEJsb2Ioc3Rt\nbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAg\nICAgICAgICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZh\nbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5DSEFSX1NUUkVBTToKICAgICAgICAgICAgICAg\nIHMgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldENoYXJhY3Rl\nclN0cmVhbShzdG1udCwgaWR4LCAoUmVhZGVyKSBzLnZhbHVlLCBzLnNpemUs\nIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHNldENsb2Io\nc3RtbnQsIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfREFU\nRToKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRh\ncmQpIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFs\nOwogICAgICAgICAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGph\ndmEuc3FsLkRhdGUpIGMudmFsdWUsIGMuY2FsZW5kYXIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChqYXZhLnNx\nbC5EYXRlKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuUkVGOgogICAgICAg\nICAgICAgICAgc2V0UmVmKHN0bW50LCBpZHgsIChSZWYpIHZhbCwgY29sKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFT\nUUxUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5j\nZW9mIENhbGVuZGFyZCkgewogICAgICAgICAgICAgICAgICAgIGMgPSAoQ2Fs\nZW5kYXJkKSB2YWw7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1u\ndCwgaWR4LCAoVGltZSkgYy52YWx1ZSwgYy5jYWxlbmRhciwgY29sKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRp\nbWUoc3RtbnQsIGlkeCwgKFRpbWUpIHZhbCwgbnVsbCwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5USU1FU1RBTVA6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNl\nb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxl\nbmRhcmQpIHZhbDsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lc3RhbXAo\nc3RtbnQsIGlkeCwgKFRpbWVzdGFtcCkgYy52YWx1ZSwgYy5jYWxlbmRhciwK\nICAgICAgICAgICAgICAgICAgICAgICAgY29sKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1u\ndCwgaWR4LCAoVGltZXN0YW1wKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBU\neXBlcy5CTE9CCiAgICAgICAgICAgICAgICAgICAgfHwgY29sLmdldFR5cGUo\nKSA9PSBUeXBlcy5WQVJCSU5BUlkpKQogICAgICAgICAgICAgICAgICAgIHNl\ndEJsb2JPYmplY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wsIHN0b3JlKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRPYmpl\nY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wuZ2V0VHlwZSgpLCBjb2wpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNvbXBsZXRlbHkg\ndW5rbm93biBwYXJhbWV0ZXIgaW50byBhIHByZXBhcmVkIHN0YXRlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VW5rbm93bihQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFNpemVkIHNpemVkID0gbnVsbDsKICAgICAgICBDYWxlbmRhcmQgY2Fs\nZCA9IG51bGw7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFNpemVkKSB7\nCiAgICAgICAgICAgIHNpemVkID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAg\nIHZhbCA9IHNpemVkLnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodmFsIGlu\nc3RhbmNlb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgIGNhbGQgPSAoQ2Fs\nZW5kYXJkKSB2YWw7CiAgICAgICAgICAgIHZhbCA9IGNhbGQudmFsdWU7CiAg\nICAgICAgfQoKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAg\nIHNldE51bGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9U\nSEVSIDogY29sLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAg\nICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCksIGNv\nbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgSW50ZWdlcikK\nICAgICAgICAgICAgc2V0SW50KHN0bW50LCBpZHgsICgoSW50ZWdlcikgdmFs\nKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0\nYW5jZW9mIEJvb2xlYW4pCiAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQs\nIGlkeCwgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIExvbmcpCiAgICAgICAg\nICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChMb25nKSB2YWwpLmxvbmdWYWx1\nZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEZs\nb2F0KQogICAgICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKEZsb2F0\nKSB2YWwpLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAgIHNldERvdWJsZShz\ndG1udCwgaWR4LCAoKERvdWJsZSkgdmFsKS5kb3VibGVWYWx1ZSgpLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJ5dGUpCiAgICAg\nICAgICAgIHNldEJ5dGUoc3RtbnQsIGlkeCwgKChCeXRlKSB2YWwpLmJ5dGVW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIENoYXJhY3RlcikKICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAo\nKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBTaG9ydCkKICAgICAgICAgICAgc2V0\nU2hvcnQoc3RtbnQsIGlkeCwgKChTaG9ydCkgdmFsKS5zaG9ydFZhbHVlKCks\nIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgTG9jYWxl\nKQogICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkg\ndmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJp\nZ0RlY2ltYWwpCiAgICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlk\neCwgKEJpZ0RlY2ltYWwpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBCaWdJbnRlZ2VyKQogICAgICAgICAgICBzZXRCaWdJ\nbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpCiAgICAgICAg\nICAgIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJsb2IpCiAgICAgICAg\nICAgIHNldEJsb2Ioc3RtbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAg\nICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBieXRlW10pCiAgICAgICAg\nICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29sKTsK\nICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDbG9iKQogICAgICAg\nICAgICBzZXRDbG9iKHN0bW50LCBpZHgsIChDbG9iKSB2YWwsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgUmVmKQogICAgICAgICAg\nICBzZXRSZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAg\nIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIGphdmEuc3FsLkRhdGUpCiAgICAg\nICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZh\nbCwKICAgICAgICAgICAgICAgIChjYWxkID09IG51bGwpID8gbnVsbCA6IGNh\nbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3Rh\nbmNlb2YgVGltZXN0YW1wKQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3Rt\nbnQsIGlkeCwgKFRpbWVzdGFtcCkgdmFsLAogICAgICAgICAgICAgICAgKGNh\nbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwgY29sKTsKICAg\nICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lKQogICAgICAgICAg\nICBzZXRUaW1lKHN0bW50LCBpZHgsIChUaW1lKSB2YWwsCiAgICAgICAgICAg\nICAgICAoY2FsZCA9PSBudWxsKSA/IG51bGwgOiBjYWxkLmNhbGVuZGFyLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpCiAg\nICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKERhdGUpIHZhbCwgY29s\nKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcikK\nICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoKENhbGVuZGFyKSB2\nYWwpLmdldFRpbWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5z\ndGFuY2VvZiBSZWFkZXIpCiAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVh\nbShzdG1udCwgaWR4LCAoUmVhZGVyKSB2YWwsCiAgICAgICAgICAgICAgICAo\nc2l6ZWQgPT0gbnVsbCkgPyAwIDogc2l6ZWQuc2l6ZSwgY29sKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJiYWQtcGFyYW0iLCB2YWwuZ2V0Q2xhc3MoKSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXJpYWxpemVkIGJ5dGVzIGZv\nciB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtd\nIHNlcmlhbGl6ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAodmFs\nIGluc3RhbmNlb2YgU2VyaWFsaXplZERhdGEpCiAgICAgICAgICAgIHJldHVy\nbiAoKFNlcmlhbGl6ZWREYXRhKSB2YWwpLmJ5dGVzOwogICAgICAgIHJldHVy\nbiBTZXJpYWxpemF0aW9uLnNlcmlhbGl6ZSh2YWwsIHN0b3JlLmdldENvbnRl\neHQoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIEpESyAx\nLjQgPGNvZGU+c2V0Qnl0ZXM8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4g\nQkxPQiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEJ5dGVz\nKE9iamVjdCBibG9iLCBieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3NldEJ5dGVzID09IG51bGwpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRCeXRlcyA9\nIGJsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNldEJ5dGVzIiwKICAgICAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0ZVtd\nLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExv\nYk1ldGhvZChfc2V0Qnl0ZXMsIGJsb2IsCiAgICAgICAgICAgIG5ldyBPYmpl\nY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRTdHJp\nbmc8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICogb2Jq\nZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRTdHJpbmcoT2JqZWN0\nIGNsb2IsIFN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChfc2V0U3RyaW5nID09IG51bGwpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRTdHJpbmcgPSBjbG9i\nLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRTdHJpbmciLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBTdHJpbmcuY2xh\nc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0\naG9kKF9zZXRTdHJpbmcsIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRDaGFyYWN0\nZXJTdHJlYW08L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4KICAgICAqIENM\nT0Igb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRDaGFycyhP\nYmplY3QgY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKF9zZXRDaGFyU3RyZWFtID09IG51bGwp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRDaGFy\nU3RyZWFtID0gY2xvYi5nZXRDbGFzcygpLmdldE1ldGhvZAogICAgICAgICAg\nICAgICAgICAgICgic2V0Q2hhcmFjdGVyU3RyZWFtIiwgbmV3IENsYXNzW117\nIGxvbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRp\nb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFdyaXRl\nciB3cml0ZXIgPSAoV3JpdGVyKSBpbnZva2VQdXRMb2JNZXRob2QoX3NldENo\nYXJTdHJlYW0sIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgTnVt\nYmVycy52YWx1ZU9mKDFMKSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICB3cml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAgIHdyaXRlci5mbHVz\naCgpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGlvZS50b1N0cmluZygp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhl\nIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRhcmdldCB3aXRoIHRo\nZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmpl\nY3QgaW52b2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRob2QsIE9iamVjdCB0\nYXJnZXQsCiAgICAgICAgT2JqZWN0W10gYXJncykKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gbWV0aG9kLmludm9rZSh0YXJnZXQsIGFyZ3MpOwogICAgICAgIH0gY2F0\nY2ggKEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24gaXRlKSB7CiAgICAgICAg\nICAgIFRocm93YWJsZSB0ID0gaXRlLmdldFRhcmdldEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikKICAg\nICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikgdDsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHQpOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9y\nZUV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXYXJuIHRoYXQgYSBwYXJ0aWN1bGFyIHZhbHVlIGNvdWxkIG5vdCBiZSBz\ndG9yZWQgcHJlY2lzZWx5LgogICAgICogQWZ0ZXIgdGhlIGZpcnN0IHdhcm5p\nbmcgZm9yIGEgcGFydGljdWxhciB0eXBlLCBtZXNzYWdlcwogICAgICogd2ls\nbCBiZSB0dXJuZWQgaW50byB0cmFjZSBtZXNzYWdlcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc3RvcmFnZVdhcm5pbmcoT2JqZWN0IG9yaWcsIE9i\namVjdCBjb252ZXJ0ZWQpIHsKICAgICAgICBib29sZWFuIHdhcm47CiAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChfcHJl\nY2lzaW9uV2FybmVkVHlwZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9w\ncmVjaXNpb25XYXJuZWRUeXBlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAg\nICAgIHdhcm4gPSBfcHJlY2lzaW9uV2FybmVkVHlwZXMuYWRkKG9yaWcuZ2V0\nQ2xhc3MoKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RvcmFnZUxpbWl0\nYXRpb25zRmF0YWwgfHwgKHdhcm4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkK\nICAgICAgICAgICAgfHwgKCF3YXJuICYmIGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKSkgewogICAgICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJzdG9y\nYWdlLXJlc3RyaWN0aW9uIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAg\nICAgcGxhdGZvcm0sCiAgICAgICAgICAgICAgICBvcmlnLAogICAgICAgICAg\nICAgICAgb3JpZy5nZXRDbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIGNvbnZlcnRlZCwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBp\nZiAoc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24obXNnKTsKCiAgICAgICAgICAgIGlm\nICh3YXJuKQogICAgICAgICAgICAgICAgbG9nLndhcm4obXNnKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKG1zZyk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLwogICAgLy8gVHlwZXMKICAg\nIC8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJy\nZWQge0BsaW5rIFR5cGVzfSBjb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAg\nKiB7QGxpbmsgSmF2YVR5cGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBj\nb25zdGFudC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRKREJDVHlwZShp\nbnQgbWV0YVR5cGVDb2RlLCBib29sZWFuIGxvYikgewogICAgICAgIGlmIChs\nb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNIQVJfU1RSRUFNOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVz\nLkNMT0IpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CTE9CKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChtZXRh\nVHlwZUNvZGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVB\nTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5C\nSVQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTllJTlQpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIGlmIChzdG9y\nZUNoYXJzQXNOdW1iZXJzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLklOVEVHRVIpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0hBUik7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5SRUFMKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JK\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlw\nZXMuSU5URUdFUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklHSU5U\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlNNQUxMSU5UKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVNR\nTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgY2FzZSBKYXZhU1FM\nVHlwZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIGlmIChz\ndG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJJ\nR0lOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6\nCiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmlu\nZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5\ncGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5ET1VCTEUpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVM\nYXJnZU51bWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5OVU1FUklD\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FU1RBTVApOwogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfQVJSQVk6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5BUlJBWSk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJJTkFSWV9TVFJFQU06\nCiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJMT0I6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJZVEVTOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNMT0I6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5DTE9CKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0RBVEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5EQVRFKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuVElNRToKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUUpOwogICAgICAg\nICAgICBjYXNlIEphdmFTUUxUeXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FU1RBTVAp\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5r\nIFR5cGVzfSB0eXBlIGZvciB0aGUgZ2l2ZW4gb25lLiBSZXR1cm5zCiAgICAg\nKiB0aGUgZ2l2ZW4gdHlwZSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldFByZWZlcnJlZFR5cGUoaW50IHR5cGUpIHsKICAgICAgICBy\nZXR1cm4gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ncHJlZmVycmVkIGRhdGFiYXNlIHR5cGUgbmFtZSBmb3IgdGhlIGdpdmVuIGNv\nbHVtbidzIHR5cGUKICAgICAqIGZyb20ge0BsaW5rIFR5cGVzfS4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRUeXBlTmFtZShDb2x1bW4gY29sKSB7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGNvbC5nZXRUeXBl\nTmFtZSgpKSkKICAgICAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBj\nb2wuZ2V0VHlwZU5hbWUoKSk7CgogICAgICAgIGlmIChjb2wuaXNBdXRvQXNz\naWduZWQoKSAmJiBhdXRvQXNzaWduVHlwZU5hbWUgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBhdXRvQXNzaWduVHlwZU5h\nbWUpOwoKICAgICAgICByZXR1cm4gYXBwZW5kU2l6ZShjb2wsIGdldFR5cGVO\nYW1lKGNvbC5nZXRUeXBlKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdGhlIHR5cGUgbmFtZSBmb3IgdGhlIHNwZWNpZmljIGNvbnN0YW50\nIGFzIGRlZmluZWQKICAgICAqIGJ5IHtAbGluayBqYXZhLnNxbC5UeXBlc30u\nCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUKICAgICAqIEBy\nZXR1cm4gdGhlIG5hbWUgZm9yIHRoZSB0eXBlCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0VHlwZU5hbWUoaW50IHR5cGUpIHsKICAgICAgICBzd2l0\nY2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUeXBlcy5BUlJBWToKICAg\nICAgICAgICAgICAgIHJldHVybiBhcnJheVR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkJJR0lOVDoKICAgICAgICAgICAgICAgIHJldHVybiBi\naWdpbnRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSU5BUlk6\nCiAgICAgICAgICAgICAgICByZXR1cm4gYmluYXJ5VHlwZU5hbWU7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuQklUOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGJpdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJMT0I6CiAg\nICAgICAgICAgICAgICByZXR1cm4gYmxvYlR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIDE2OiAvLyBKREsgMS40IGludHJvZHVjZXMgVHlwZXMuQk9PTEVB\nTiwgd2hvc2UgdmFsdWUgaXMgMTYKICAgICAgICAgICAgICAgIHJldHVybiBi\nb29sZWFuVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBjaGFyVHlwZU5hbWU7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHJldHVybiBj\nbG9iVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgIHJldHVybiBkYXRlVHlwZU5hbWU7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuREVDSU1BTDoKICAgICAgICAgICAgICAgIHJldHVybiBk\nZWNpbWFsVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuRElTVElO\nQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZGlzdGluY3RUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZG91YmxlVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmxvYXRUeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5JTlRFR0VSOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGludGVnZXJUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5KQVZBX09CSkVDVDoKICAgICAgICAgICAgICAgIHJldHVybiBq\nYXZhT2JqZWN0VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuTE9O\nR1ZBUkJJTkFSWToKICAgICAgICAgICAgICAgIHJldHVybiBsb25nVmFyYmlu\nYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuTE9OR1ZBUkNI\nQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gbG9uZ1ZhcmNoYXJUeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5OVUxMOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGxUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5OVU1FUklDOgogICAgICAgICAgICAgICAgcmV0dXJuIG51bWVyaWNUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5PVEhFUjoKICAgICAgICAg\nICAgICAgIHJldHVybiBvdGhlclR5cGVOYW1lOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLlJFQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVhbFR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlJFRjoKICAgICAgICAgICAg\nICAgIHJldHVybiByZWZUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5TTUFMTElOVDoKICAgICAgICAgICAgICAgIHJldHVybiBzbWFsbGludFR5\ncGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlNUUlVDVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBzdHJ1Y3RUeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5USU1FU1RBTVA6CiAg\nICAgICAgICAgICAgICByZXR1cm4gdGltZXN0YW1wVHlwZU5hbWU7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuVElOWUlOVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiB0aW55aW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nVkFSQklOQVJZOgogICAgICAgICAgICAgICAgcmV0dXJuIHZhcmJpbmFyeVR5\ncGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlZBUkNIQVI6CiAgICAg\nICAgICAgICAgICByZXR1cm4gdmFyY2hhclR5cGVOYW1lOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIG90aGVyVHlwZU5h\nbWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1l\ndGhvZCB0byBhZGQgc2l6ZSBwcm9wZXJ0aWVzIHRvIHRoZSBzcGVjaWZpZWQg\ndHlwZS4KICAgICAqIElmIHByZXNlbnQsIHRoZSBzdHJpbmcgInswfSIgd2ls\nbCBiZSByZXBsYWNlZCB3aXRoIHRoZSBzaXplIGRlZmluaXRpb247CiAgICAg\nKiBvdGhlcndpc2UgdGhlIHNpemUgZGVmaW5pdGlvbiB3aWxsIGJlIGFwcGVu\nZGVkIHRvIHRoZSB0eXBlIG5hbWUuCiAgICAgKiBJZiB5b3VyIGRhdGFiYXNl\nIGhhcyBjb2x1bW4gdHlwZXMgdGhhdCBkb24ndCBhbGxvdyBzaXplIGRlZmlu\naXRpb25zLAogICAgICogb3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8gcmV0dXJu\nIHRoZSB1bmFsdGVyZWQgdHlwZSBuYW1lIGZvciBjb2x1bW5zIG9mCiAgICAg\nKiB0aG9zZSB0eXBlcyAob3IgYWRkIHRoZSB0eXBlIG5hbWVzIHRvIHRoZQog\nICAgICogPGNvZGU+Zml4ZWRTaXplVHlwZU5hbWVTZXQ8L2NvZGU+KS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBhcHBlbmRTaXplKENvbHVtbiBj\nb2wsIFN0cmluZyB0eXBlTmFtZSkgewogICAgICAgIGlmIChmaXhlZFNpemVU\neXBlTmFtZVNldC5jb250YWlucyh0eXBlTmFtZS50b1VwcGVyQ2FzZSgpKSkK\nICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lOwogICAgICAgIGlmICh0eXBl\nTmFtZS5pbmRleE9mKCcoJykgIT0gLTEpCiAgICAgICAgICAgIHJldHVybiB0\neXBlTmFtZTsKCiAgICAgICAgU3RyaW5nIHNpemUgPSBudWxsOwogICAgICAg\nIGlmIChjb2wuZ2V0U2l6ZSgpID4gMCkgewogICAgICAgICAgICBTdHJpbmdC\ndWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigxMCk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIigiKS5hcHBlbmQoY29sLmdldFNpemUoKSk7CiAgICAg\nICAgICAgIGlmIChjb2wuZ2V0RGVjaW1hbERpZ2l0cygpID4gMCkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBwZW5kKGNvbC5nZXREZWNp\nbWFsRGlnaXRzKCkpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAg\nICAgICAgICAgIHNpemUgPSBidWYudG9TdHJpbmcoKTsKICAgICAgICB9Cgog\nICAgICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9mKCJ7MH0iKTsKICAg\nICAgICBpZiAoaWR4ID09IC0xICYmIHNpemUgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHR5cGVOYW1lICsgc2l6ZTsKICAgICAgICBpZiAoaWR4ID09\nIC0xKQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7CgogICAgICAgIC8v\nIHJlcGxhY2UgJ3swfScgd2l0aCBzaXplCiAgICAgICAgU3RyaW5nIHJldCA9\nIHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAgICAgIGlmIChzaXpl\nICE9IG51bGwpCiAgICAgICAgICAgIHJldCA9IHJldCArIHNpemU7CiAgICAg\nICAgaWYgKHR5cGVOYW1lLmxlbmd0aCgpID4gaWR4ICsgMykKICAgICAgICAg\nICAgcmV0ID0gcmV0ICsgdHlwZU5hbWUuc3Vic3RyaW5nKGlkeCArIDMpOwog\nICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAg\nIC8vIFNlbGVjdHMKICAgIC8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIG5hbWUgb2YgdGhlIGpvaW4gc3ludGF4IHRvIHVzZTogc3FsOTIs\nIHRyYWRpdGlvbmFsLCBkYXRhYmFzZQogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRKb2luU3ludGF4KFN0cmluZyBzeW50YXgpIHsKICAgICAgICBpZiAo\nInNxbDkyIi5lcXVhbHMoc3ludGF4KSkKICAgICAgICAgICAgam9pblN5bnRh\neCA9IFNZTlRBWF9TUUw5MjsKICAgICAgICBlbHNlIGlmICgidHJhZGl0aW9u\nYWwiLmVxdWFscyhzeW50YXgpKQogICAgICAgICAgICBqb2luU3ludGF4ID0g\nU1lOVEFYX1RSQURJVElPTkFMOwogICAgICAgIGVsc2UgaWYgKCJkYXRhYmFz\nZSIuZXF1YWxzKHN5bnRheCkpCiAgICAgICAgICAgIGpvaW5TeW50YXggPSBT\nWU5UQVhfREFUQUJBU0U7CiAgICAgICAgZWxzZSBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoc3ludGF4KSkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbihzeW50YXgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgU1FMIHN0cmluZyB0byBhY3QgYXMgYSBwbGFjZWhv\nbGRlciBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRQbGFjZWhvbGRlclZhbHVlU3RyaW5nKENvbHVtbiBjb2wp\nIHsKICAgICAgICBzd2l0Y2ggKGNvbC5nZXRUeXBlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5CSUdJTlQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nQklUOgogICAgICAgICAgICBjYXNlIFR5cGVzLklOVEVHRVI6CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuTlVNRVJJQzoKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5TTUFMTElOVDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5USU5ZSU5UOgog\nICAgICAgICAgICAgICAgcmV0dXJuICIwIjsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIChzdG9yZUNoYXJz\nQXNOdW1iZXJzKSA/ICIwIiA6ICInICciOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLkNMT0I6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuTE9OR1ZBUkNIQVI6\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuVkFSQ0hBUjoKICAgICAgICAgICAg\nICAgIHJldHVybiAiJyciOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRBVEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gWkVST19EQVRFX1NUUjsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5ERUNJTUFMOgogICAgICAgICAgICBjYXNlIFR5\ncGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBUeXBlcy5GTE9BVDoKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5SRUFMOgogICAgICAgICAgICAgICAgcmV0\ndXJuICIwLjAiOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gWkVST19USU1FX1NUUjsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAgICAgICByZXR1cm4g\nWkVST19USU1FU1RBTVBfU1RSOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuICJOVUxMIjsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBTRUxFQ1QgQ09VTlQgc3RhdGVtZW50\nIGluIHRoZSBwcm9wZXIgam9pbiBzeW50YXggZm9yIHRoZQogICAgICogZ2l2\nZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9T\nZWxlY3RDb3VudChTZWxlY3Qgc2VsKSB7CiAgICAgICAgU1FMQnVmZmVyIHNl\nbGVjdFNRTCA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgU1FMQnVm\nZmVyIGZyb207CiAgICAgICAgc2VsLmFkZEpvaW5DbGFzc0NvbmRpdGlvbnMo\nKTsKICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxsKQog\nICAgICAgICAgICBmcm9tID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZhbHNlKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tKHNlbCwg\nZmFsc2UpOwogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IGdldFdoZXJlKHNl\nbCwgZmFsc2UpOwoKICAgICAgICAvLyBpZiBubyBncm91cGluZyBhbmQgbm8g\ncmFuZ2UsIHdlIG1pZ2h0IGJlIGFibGUgdG8gZ2V0IGJ5IHdpdGhvdXQKICAg\nICAgICAvLyBhIHN1YnNlbGVjdAogICAgICAgIGlmIChzZWwuZ2V0R3JvdXBp\nbmcoKSA9PSBudWxsICYmIHNlbC5nZXRTdGFydEluZGV4KCkgPT0gMAogICAg\nICAgICAgICAmJiBzZWwuZ2V0RW5kSW5kZXgoKSA9PSBMb25nLk1BWF9WQUxV\nRSkgewogICAgICAgICAgICAvLyBpZiB0aGUgc2VsZWN0IGhhcyBubyBpZGVu\ndGlmaWVyIGNvbHMsIHVzZSBDT1VOVCgqKQogICAgICAgICAgICBMaXN0IGFs\naWFzZXMgPSAoIXNlbC5pc0Rpc3RpbmN0KCkpID8gQ29sbGVjdGlvbnMuRU1Q\nVFlfTElTVAogICAgICAgICAgICAgICAgOiBzZWwuZ2V0SWRlbnRpZmllckFs\naWFzZXMoKTsKICAgICAgICAgICAgaWYgKGFsaWFzZXMuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVCgqKSIp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwg\nbnVsbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAg\nICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGEg\nc2luZ2xlIGRpc3RpbmN0IGNvbCwgdXNlIENPVU5UKERJU1RJTkNUIGNvbCkK\nICAgICAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpID09IDEpIHsKICAgICAg\nICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKERJU1RJTkNUICIp\nLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChhbGlhc2VzLmdldCgwKS50\nb1N0cmluZygpKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxs\nLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxz\nZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBjYW4gd2UgY29tYmluZSBkaXN0aW5jdCBjb2xzPwogICAgICAg\nICAgICBpZiAoZGlzdGluY3RDb3VudENvbHVtblNlcGFyYXRvciAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVChE\nSVNUSU5DVCAiKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYWxpYXNlcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgICAg\nIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RT\nUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVj\ndFNRTC5hcHBlbmQoZGlzdGluY3RDb3VudENvbHVtblNlcGFyYXRvcik7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiAiKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZChhbGlhc2VzLmdldChpKS50b1N0cmluZygpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBl\nbmQoIikiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxl\nY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxsLCBudWxsLCBudWxsLAog\nICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhf\nVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBz\naW5jZSB3ZSBjYW4ndCBjb21iaW5lIGRpc3RpbmN0IGNvbHMsIHdlIGhhdmUg\ndG8gcGVyZm9ybSBhbiBvdXRlcgogICAgICAgIC8vIENPVU5UKCopIHNlbGVj\ndCB1c2luZyB0aGUgb3JpZ2luYWwgc2VsZWN0IGFzIGEgc3Vic2VsZWN0IGlu\nIHRoZQogICAgICAgIC8vIEZST00gY2xhdXNlCiAgICAgICAgYXNzZXJ0U3Vw\ncG9ydChzdXBwb3J0c1N1YnNlbGVjdCwgIlN1cHBvcnRzU3Vic2VsZWN0Iik7\nCgogICAgICAgIFNRTEJ1ZmZlciBzdWJTZWxlY3QgPSBnZXRTZWxlY3RzKHNl\nbCwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIFNRTEJ1ZmZlciBzdWJGcm9tID0g\nZnJvbTsKICAgICAgICBmcm9tID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAg\nICAgICBmcm9tLmFwcGVuZCgiKCIpOwogICAgICAgIGZyb20uYXBwZW5kKHRv\nU2VsZWN0KHN1YlNlbGVjdCwgbnVsbCwgc3ViRnJvbSwgd2hlcmUsCiAgICAg\nICAgICAgIHNlbC5nZXRHcm91cGluZygpLCBzZWwuZ2V0SGF2aW5nKCksIG51\nbGwsIHNlbC5pc0Rpc3RpbmN0KCksCiAgICAgICAgICAgIGZhbHNlLCBzZWwu\nZ2V0U3RhcnRJbmRleCgpLCBzZWwuZ2V0RW5kSW5kZXgoKSkpOwogICAgICAg\nIGZyb20uYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKHJlcXVpcmVzQWxpYXNG\nb3JTdWJzZWxlY3QpCiAgICAgICAgICAgIGZyb20uYXBwZW5kKCIgIikuYXBw\nZW5kKFNlbGVjdC5GUk9NX1NFTEVDVF9BTElBUyk7CgogICAgICAgIHNlbGVj\ndFNRTC5hcHBlbmQoIkNPVU5UKCopIik7CiAgICAgICAgcmV0dXJuIHRvU2Vs\nZWN0KHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwgbnVsbCwgbnVsbCwgbnVsbCwg\nbnVsbCwKICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9W\nQUxVRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBERUxFVEUg\nc3RhdGVtZW50IGZvciB0aGUgc3BlY2lmaWVkIFNlbGVjdC4gSWYgdGhlCiAg\nICAgKiBkYXRhYmFzZSBkb2VzIG5vdCBzdXBwb3J0IHRoZSBidWxrIGRlbGV0\nZSBzdGF0ZW1lbnQgKHN1Y2ggYXMKICAgICAqIGNhc2VzIHdoZXJlIGEgc3Vi\nc2VsZWN0IGlzIHJlcXVpcmVkIGFuZCB0aGUgZGF0YWJhc2UgZG9lc24ndCBz\ndXBwb3J0CiAgICAgKiBzdWJzZWxlY3RzKSwgdGhpcyBtZXRob2Qgc2hvdWxk\nIHJldHVybiBudWxsLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRv\nRGVsZXRlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLCAKICAg\nICAgICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gdG9CdWxr\nT3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwgbnVsbCwgcGFyYW1zLCBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvVXBkYXRlKENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRlcykgewogICAgICAg\nIHJldHVybiB0b0J1bGtPcGVyYXRpb24obWFwcGluZywgc2VsLCBzdG9yZSwg\ncGFyYW1zLCB1cGRhdGVzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgdGhlIFNRTCBmb3IgYSBidWxrIG9wZXJhdGlvbiwgZWl0aGVyIGEgREVM\nRVRFIG9yIGFuIFVQREFURS4KICAgICAqCiAgICAgKiBAcGFyYW0gbWFwcGlu\nZyB0aGUgbWFwcG5nIGFnYWluc3Qgd2hpY2ggd2UgYXJlIG9wZXJhdGluZwog\nICAgICogQHBhcmFtIHNlbCB0aGUgU2VsZWN0IHRoYXQgd2lsbCBjb25zdGl0\ndXRlIHRoZSBXSEVSRSBjbGF1c2UKICAgICAqIEBwYXJhbSBzdG9yZSB0aGUg\nY3VycmVudCBzdG9yZQogICAgICogQHBhcmFtIHVwZGF0ZVBhcmFtcyB0aGUg\nTWFwIHRoYXQgaG9sZHMgdGhlIHVwZGF0ZSBwYXJhbWV0ZXJzOyBhIG51bGwK\nICAgICAqIHZhbHVlIGluZGljYXRlcyB0aGF0IHRoaXMgaXMgYSBkZWxldGUg\nb3BlcmF0aW9uCiAgICAgKiBAcmV0dXJuIHRoZSBTUUxCdWZmZXIgZm9yIHRo\nZSB1cGRhdGUsIG9yIDxlbT5udWxsPC9lbT4gaWYgaXQgaXMgbm90CiAgICAg\nKiBwb3NzaWJsZSB0byBwZXJmb3JtIHRoZSBidWxrIHVwZGF0ZQogICAgICov\nCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIHRvQnVsa09wZXJhdGlvbihDbGFz\nc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNlbCwKICAgICAgICBKREJDU3Rv\ncmUgc3RvcmUsIE9iamVjdFtdIHBhcmFtcywgTWFwIHVwZGF0ZVBhcmFtcykg\newogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBuZXcgU1FMQnVmZmVyKHRoaXMp\nOwogICAgICAgIGlmICh1cGRhdGVQYXJhbXMgPT0gbnVsbCkKICAgICAgICAg\nICAgc3FsLmFwcGVuZCgiREVMRVRFIEZST00gIik7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzcWwuYXBwZW5kKCJVUERBVEUgIik7CiAgICAgICAgc2Vs\nLmFkZEpvaW5DbGFzc0NvbmRpdGlvbnMoKTsKCiAgICAgICAgLy8gaWYgdGhl\ncmUgaXMgb25seSBhIHNpbmdsZSB0YWJsZSBpbiB0aGUgc2VsZWN0LCB0aGVu\nIHdlIGNhbgogICAgICAgIC8vIGp1c3QgaXNzdWUgYSBzaW5nbGUgREVMRVRF\nIEZST00gVEFCTEUgV0hFUkUgPGNvbmRpdGlvbnM+CiAgICAgICAgLy8gc3Rh\ndGVtZW50OyBvdGhlcndpc2UsIHNpbmNlIFNRTCBkb2Vzbid0IGFsbG93IGRl\nbGV0aW5nCiAgICAgICAgLy8gZnJvbSBvbmUgb2YgYSBtdWx0aS10YWJsZSBz\nZWxlY3QsIHdlIG5lZWQgdG8gaXNzdWUgYSBzdWJzZWxlY3QKICAgICAgICAv\nLyBsaWtlIERFTEVURSBGUk9NIFRBQkxFIFdIRVJFIEVYSVNUUwogICAgICAg\nIC8vIChTRUxFQ1QgMSBGUk9NIFRBQkxFIHQwIFdIRVJFIHQwLklEID0gVEFC\nTEUuSUQpOyBhbHNvLCBzb21lCiAgICAgICAgLy8gZGF0YWJhc2VzIGRvIG5v\ndCBhbGxvdyBhbGlhc2VzIGluIGRlbGV0ZSBzdGF0ZW1lbnRzLCB3aGljaAog\nICAgICAgIC8vIGFsc28gY2F1c2VzIHVzIHRvIHVzZSBhIHN1YnNlbGVjdAog\nICAgICAgIGlmIChzZWwuZ2V0VGFibGVBbGlhc2VzKCkuc2l6ZSgpID09IDEg\nJiYgc3VwcG9ydHNTdWJzZWxlY3QKICAgICAgICAgICAgJiYgYWxsb3dzQWxp\nYXNJbkJ1bGtDbGF1c2UpIHsKICAgICAgICAgICAgU1FMQnVmZmVyIGZyb207\nCiAgICAgICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBmcm9tID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZh\nbHNlKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZnJvbSA9\nIGdldEZyb20oc2VsLCBmYWxzZSk7CgogICAgICAgICAgICBzcWwuYXBwZW5k\nKGZyb20pOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUs\nIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsCiAgICAgICAgICAgICAgICBh\nbGxvd3NBbGlhc0luQnVsa0NsYXVzZSk7CgogICAgICAgICAgICBTUUxCdWZm\nZXIgd2hlcmUgPSBzZWwuZ2V0V2hlcmUoKTsKICAgICAgICAgICAgaWYgKHdo\nZXJlICE9IG51bGwgJiYgIXdoZXJlLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFICIpOwogICAgICAgICAgICAgICAg\nc3FsLmFwcGVuZCh3aGVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIHNxbDsKICAgICAgICB9CgogICAgICAgIFRhYmxlIHRhYmxlID0g\nbWFwcGluZy5nZXRUYWJsZSgpOwogICAgICAgIFN0cmluZyB0YWJsZU5hbWUg\nPSBnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpOwoKICAgICAgICAvLyBvbmx5\nIHVzZSBhICBzdWJzZWxlY3QgaWYgdGhlIHdoZXJlIGlzIG5vdCBlbXB0eTsg\nb3RoZXJ3aXNlCiAgICAgICAgLy8gYW4gdW5xdWFsaWZpZWQgZGVsZXRlIG9y\nIHVwZGF0ZSB3aWxsIHdvcmsKICAgICAgICBpZiAoc2VsLmdldFdoZXJlKCkg\nPT0gbnVsbCB8fCBzZWwuZ2V0V2hlcmUoKS5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBhcHBl\nbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJh\nbXMsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHNxbDsKICAgICAgICB9\nCgogICAgICAgIC8vIHdlIG5lZWQgdG8gdXNlIGEgc3Vic2VsZWN0IGlmIHdl\nIGFyZSB0byBidWxrIGRlbGV0ZSB3aGVyZQogICAgICAgIC8vIHRoZSBzZWxl\nY3QgaW5jbHVkZXMgbXVsdGlwbGUgdGFibGVzOyBpZiB0aGUgZGF0YWJhc2UK\nICAgICAgICAvLyBkb2Vzbid0IHN1cHBvcnQgaXQsIHRoZW4gd2UgbmVlZCB0\nbyBzaWdhbCB0aGlzIGJ5IHJldHVybmluZyBudWxsCiAgICAgICAgaWYgKCFz\ndXBwb3J0c1N1YnNlbGVjdCB8fCAhc3VwcG9ydHNDb3JyZWxhdGVkU3Vic2Vs\nZWN0KQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sdW1u\nW10gcGtzID0gbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAg\nICAgIHNlbC5jbGVhclNlbGVjdHMoKTsKICAgICAgICBzZWwuc2V0RGlzdGlu\nY3QodHJ1ZSk7CgogICAgICAgIC8vIGlmIHdlIGhhdmUgb25seSBhIHNpbmds\nZSBQSywgd2UgY2FuIHVzZSBhIG5vbi1jb3JyZWxhdGVkCiAgICAgICAgLy8g\nc3VicXVlcnkgKHVzaW5nIGFuIElOIHN0YXRlbWVudCksIHdoaWNoIGlzIG11\nY2ggZmFzdGVyIHRoYW4KICAgICAgICAvLyBhIGNvcnJlbGF0ZWQgc3VicXVl\ncnkgKHNpbmNlIGEgY29ycmVsYXRlZCBzdWJxdWVyeSBuZWVkcwogICAgICAg\nIC8vIHRvIGJlIGV4ZWN1dGVkIG9uY2UgZm9yIGVhY2ggcm93IGluIHRoZSB0\nYWJsZSkKICAgICAgICBpZiAocGtzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAg\nICAgIHNlbC5zZWxlY3QocGtzWzBdKTsKICAgICAgICAgICAgc3FsLmFwcGVu\nZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNlbCwg\nc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsKICAg\nICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFICIpLgogICAgICAgICAgICAg\nICAgYXBwZW5kKHBrc1swXSkuYXBwZW5kKCIgSU4gKCIpLgogICAgICAgICAg\nICAgICAgYXBwZW5kKHNlbC50b1NlbGVjdChmYWxzZSwgbnVsbCkpLmFwcGVu\nZCgiKSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbC5jbGVh\nclNlbGVjdHMoKTsKICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KGZhbHNl\nKTsKCiAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBzZWxlY3QgaXMgdXNpbmcg\nYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5LCB3ZQogICAgICAgICAgICAvLyBvbmx5\nIG5lZWQgdG8gc2VsZWN0IGEgYm9ndXMgdmlydHVhbCBjb2x1bW4KICAgICAg\nICAgICAgc2VsLnNlbGVjdCgiMSIsIG51bGwpOwoKICAgICAgICAgICAgLy8g\nYWRkIGluIHRoZSBqb2lucyB0byB0aGUgdGFibGUKICAgICAgICAgICAgQ29s\ndW1uW10gY29scyA9IHRhYmxlLmdldFByaW1hcnlLZXkoKS5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVy\nKHRoaXMpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIoIik7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKGkgPiAwKQogICAgICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CgogICAgICAgICAgICAgICAgLy8gYWRk\nIGluICJ0MC5QSyA9IE1ZVEFCTEUuUEsiCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhjb2xzW2ldLCBudWxsKSkuYXBw\nZW5kKCIgPSAiKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQodGFibGUp\nLmFwcGVuZChjYXRhbG9nU2VwYXJhdG9yKS5hcHBlbmQoY29sc1tpXSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAg\nICAgICAgICBzZWwud2hlcmUoYnVmLCBudWxsKTsKCiAgICAgICAgICAgIHNx\nbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICAgICAgYXBwZW5kVXBkYXRl\ncyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFyYW1zLCBmYWxz\nZSk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBXSEVSRSBFWElTVFMgKCIp\nLgogICAgICAgICAgICAgICAgYXBwZW5kKHNlbC50b1NlbGVjdChmYWxzZSwg\nbnVsbCkpLmFwcGVuZCgiKSIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZFVwZGF0ZXMo\nU2VsZWN0IHNlbCwgSkRCQ1N0b3JlIHN0b3JlLCBTUUxCdWZmZXIgc3FsLAog\nICAgICAgIE9iamVjdFtdIHBhcmFtcywgTWFwIHVwZGF0ZVBhcmFtcywgYm9v\nbGVhbiBhbGxvd0FsaWFzKSB7CiAgICAgICAgaWYgKHVwZGF0ZVBhcmFtcyA9\nPSBudWxsIHx8IHVwZGF0ZVBhcmFtcy5zaXplKCkgPT0gMCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAvLyBtYW51YWxseSBidWlsZCB1cCB0aGUg\nU0VUIGNsYXVzZSBmb3IgdGhlIFVQREFURSBzdGF0ZW1lbnQKICAgICAgICBz\ncWwuYXBwZW5kKCIgU0VUICIpOwogICAgICAgIEV4cENvbnRleHQgY3R4ID0g\nbmV3IEV4cENvbnRleHQoc3RvcmUsIHBhcmFtcywgCiAgICAgICAgICAgIHN0\nb3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpKTsKCiAgICAgICAgLy8gSWYg\ndGhlIHVwZGF0ZXMgbWFwIGNvbnRhaW5zIGFueSB2ZXJzaW9uIGZpZWxkcywg\nYXNzdW1lIHRoYXQgdGhlCiAgICAgICAgLy8gb3B0aW1pc3RpYyBsb2NrIHZl\ncnNpb24gZGF0YSBpcyBiZWluZyBoYW5kbGVkIHByb3Blcmx5IGJ5IHRoZQog\nICAgICAgIC8vIGNhbGxlci4gT3RoZXJ3aXNlLCBnaXZlIHRoZSB2ZXJzaW9u\nIGluZGljYXRvciBhbiBvcHBvcnR1bml0eSB0bwogICAgICAgIC8vIGFkZCBt\nb3JlIHVwZGF0ZSBjbGF1c2VzIGFzIG5lZWRlZC4KICAgICAgICBib29sZWFu\nIGF1Z21lbnRVcGRhdGVzID0gdHJ1ZTsKCiAgICAgICAgZm9yIChJdGVyYXRv\nciBpID0gdXBkYXRlUGFyYW1zLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaS5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBuZXh0ID0gKE1h\ncC5FbnRyeSkgaS5uZXh0KCk7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBm\nbWQgPSAoRmllbGRNYXBwaW5nKSBuZXh0LmdldEtleSgpOwoKICAgICAgICAg\nICAgaWYgKGZtZC5pc1ZlcnNpb24oKSkKICAgICAgICAgICAgICAgIGF1Z21l\nbnRVcGRhdGVzID0gZmFsc2U7CgogICAgICAgICAgICBWYWwgdmFsID0gKFZh\nbCkgbmV4dC5nZXRWYWx1ZSgpOwoKICAgICAgICAgICAgQ29sdW1uIGNvbCA9\nIGZtZC5nZXRDb2x1bW5zKClbMF07CiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nY29sLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiA9ICIp\nOwoKICAgICAgICAgICAgRXhwU3RhdGUgc3RhdGUgPSB2YWwuaW5pdGlhbGl6\nZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAgIHZhbC5jYWxjdWxhdGVWYWx1\nZShzZWwsIGN0eCwgc3RhdGUsIG51bGwsIG51bGwpOwoKICAgICAgICAgICAg\nLy8gYXBwZW5kIHRoZSB2YWx1ZSB3aXRoIGEgbnVsbCBmb3IgdGhlIFNlbGVj\ndDsgaQogICAgICAgICAgICAvLyBpbmRpY2F0ZXMgdGhhdCB0aGUKICAgICAg\nICAgICAgaW50IGxlbmd0aCA9IHZhbC5sZW5ndGgoc2VsLCBjdHgsIHN0YXRl\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBsZW5ndGg7IGor\nKykKICAgICAgICAgICAgICAgIHZhbC5hcHBlbmRUbygoYWxsb3dBbGlhcykg\nPyBzZWwgOiBudWxsLCBjdHgsIHN0YXRlLCBzcWwsIGopOwoKICAgICAgICAg\nICAgaWYgKGkuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgc3FsLmFwcGVu\nZCgiLCAiKTsKICAgICAgICB9CgogICAgICAgIGlmIChhdWdtZW50VXBkYXRl\ncykgewogICAgICAgICAgICBDbGFzc01hcHBpbmcgbWV0YSA9CiAgICAgICAg\nICAgICAgICAoKEZpZWxkTWFwcGluZykgdXBkYXRlUGFyYW1zLmtleVNldCgp\nLml0ZXJhdG9yKCkubmV4dCgpKQogICAgICAgICAgICAgICAgICAgIC5nZXRE\nZWNsYXJpbmdNYXBwaW5nKCk7CiAgICAgICAgICAgIE1hcCB1cGRhdGVzID0g\nbWV0YS5nZXRWZXJzaW9uKCkuZ2V0QnVsa1VwZGF0ZVZhbHVlcygpOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSB1cGRhdGVzLmVudHJ5U2V0\nKCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIGl0ZXIuaGFzTmV4dCgp\nOyApIHsKICAgICAgICAgICAgICAgIE1hcC5FbnRyeSBlID0gKE1hcC5FbnRy\neSkgaXRlci5uZXh0KCk7CiAgICAgICAgICAgICAgICBDb2x1bW4gY29sID0g\nKENvbHVtbikgZS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIFN0cmluZyB2\nYWwgPSAoU3RyaW5nKSBlLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBz\ncWwuYXBwZW5kKCIsICIpLmFwcGVuZChjb2wuZ2V0TmFtZSgpKQogICAgICAg\nICAgICAgICAgICAgIC5hcHBlbmQoIiA9ICIpLmFwcGVuZCh2YWwpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAq\nIENyZWF0ZSBTUUwgdG8gZGVsZXRlIHRoZSBjb250ZW50cyBvZiB0aGUgc3Bl\nY2lmaWVkIHRhYmxlcy4gCiAgICAgKiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRh\ndGlvbiBkcm9wcyBhbGwgbm9uLWRlZmVycmVkIFJFU1RSSUNUIGZvcmVpZ24g\na2V5IAogICAgICogY29uc3RyYWludHMgaW52b2x2aW5nIHRoZSBzcGVjaWZp\nZWQgdGFibGVzLCBpc3N1ZXMgREVMRVRFIHN0YXRlbWVudHMgCiAgICAgKiBh\nZ2FpbnN0IHRoZSB0YWJsZXMsIGFuZCB0aGVuIGFkZHMgdGhlIGRyb3BwZWQg\nY29uc3RyYWludHMgYmFjayBpbi4gCiAgICAgKiBEYXRhYmFzZXMgd2l0aCBt\nb3JlIG9wdGltYWwgd2F5cyBvZiBkZWxldGluZyB0aGUgY29udGVudHMgb2Yg\nc2V2ZXJhbCAKICAgICAqIHRhYmxlcyBzaG91bGQgb3ZlcnJpZGUgdGhpcyBt\nZXRob2QuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREZWxldGVU\nYWJsZUNvbnRlbnRzU1FMKFRhYmxlW10gdGFibGVzKSB7CiAgICAgICAgQ29s\nbGVjdGlvbiBzcWwgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgCiAgICAg\nICAgLy8gY29sbGVjdCBhbmQgZHJvcCBub24tZGVmZXJyZWQgcGh5c2ljYWwg\ncmVzdHJpY3QgY29uc3RyYWludHMsIGFuZAogICAgICAgIC8vIGNvbGxlY3Qg\ndGhlIERFTEVURSBGUk9NIHN0YXRlbWVudHMKICAgICAgICBDb2xsZWN0aW9u\nIGRlbGV0ZVNRTCA9IG5ldyBBcnJheUxpc3QodGFibGVzLmxlbmd0aCk7CiAg\nICAgICAgQ29sbGVjdGlvbiByZXN0cmljdENvbnN0cmFpbnRzID0gbmV3IExp\nbmtlZEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRh\nYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBGb3JlaWduS2V5W10g\nZmtzID0gdGFibGVzW2ldLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgZmtzLmxlbmd0aDsgaisrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIWZrc1tqXS5pc0xvZ2ljYWwoKSAmJiAhZmtzW2pd\nLmlzRGVmZXJyZWQoKSAKICAgICAgICAgICAgICAgICAgICAmJiBma3Nbal0u\nZ2V0RGVsZXRlQWN0aW9uKCkgPT0gRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJ\nQ1QpCiAgICAgICAgICAgICAgICByZXN0cmljdENvbnN0cmFpbnRzLmFkZChm\na3Nbal0pOwogICAgICAgICAgICAgICAgU3RyaW5nW10gY29uc3RyYWludFNR\nTCA9IGdldERyb3BGb3JlaWduS2V5U1FMKGZrc1tqXSk7CiAgICAgICAgICAg\nICAgICBzcWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29uc3RyYWludFNRTCkp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBkZWxl\ndGVTUUwuYWRkKCJERUxFVEUgRlJPTSAiICsgdGFibGVzW2ldLmdldEZ1bGxO\nYW1lKCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBhZGQgdGhl\nIGRlbGV0ZSBzdGF0ZW1lbnRzIGFmdGVyIGFsbCB0aGUgY29uc3RyYWludCBt\ndXRhdGlvbnMKICAgICAgICBzcWwuYWRkQWxsKGRlbGV0ZVNRTCk7CiAgICAg\nICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxldGVkIGNvbnN0cmFpbnRzIGJh\nY2sgdG8gdGhlIHNjaGVtYQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nIHJlc3RyaWN0Q29uc3RyYWludHMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0\nKCk7ICkgewogICAgICAgICAgICBTdHJpbmdbXSBjb25zdHJhaW50U1FMID0g\nCiAgICAgICAgICAgICAgICBnZXRBZGRGb3JlaWduS2V5U1FMKChGb3JlaWdu\nS2V5KSBpdGVyLm5leHQoKSk7CiAgICAgICAgICAgIHNxbC5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChjb25zdHJhaW50U1FMKSk7CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIHJldHVybiAoU3RyaW5nW10pIHNxbC50b0FycmF5KG5ldyBT\ndHJpbmdbc3FsLnNpemUoKV0pOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgU0VMRUNUIHN0YXRlbWVudCBpbiB0aGUgcHJvcGVyIGpvaW4gc3lu\ndGF4IGZvciB0aGUgZ2l2ZW4KICAgICAqIGluc3RhbmNlLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNlbGVjdCBzZWwsIGJvb2xl\nYW4gZm9yVXBkYXRlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gpIHsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygp\nOwogICAgICAgIGJvb2xlYW4gdXBkYXRlID0gZm9yVXBkYXRlICYmIHNlbC5n\nZXRGcm9tU2VsZWN0KCkgPT0gbnVsbDsKICAgICAgICBTUUxCdWZmZXIgc2Vs\nZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIGZhbHNlLCB1cGRhdGUpOwogICAgICAg\nIFNRTEJ1ZmZlciBvcmRlcmluZyA9IG51bGw7CiAgICAgICAgaWYgKCFzZWwu\naXNBZ2dyZWdhdGUoKSB8fCBzZWwuZ2V0R3JvdXBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICBvcmRlcmluZyA9IHNlbC5nZXRPcmRlcmluZygpOwogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNl\nbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tU2Vs\nZWN0KHNlbCwgZm9yVXBkYXRlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGZyb20gPSBnZXRGcm9tKHNlbCwgdXBkYXRlKTsKICAgICAgICBTUUxCdWZm\nZXIgd2hlcmUgPSBnZXRXaGVyZShzZWwsIHVwZGF0ZSk7CiAgICAgICAgcmV0\ndXJuIHRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIGZyb20sIHdoZXJlLCBzZWwu\nZ2V0R3JvdXBpbmcoKSwKICAgICAgICAgICAgc2VsLmdldEhhdmluZygpLCBv\ncmRlcmluZywgc2VsLmlzRGlzdGluY3QoKSwgZm9yVXBkYXRlLAogICAgICAg\nICAgICBzZWwuZ2V0U3RhcnRJbmRleCgpLCBzZWwuZ2V0RW5kSW5kZXgoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvcnRpb24gb2Yg\ndGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0d2VlbiB0aGUgRlJPTSBrZXl3b3Jk\nCiAgICAgKiBhbmQgdGhlIFdIRVJFIGtleXdvcmQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTUUxCdWZmZXIgZ2V0RnJvbShTZWxlY3Qgc2VsLCBib29sZWFu\nIGZvclVwZGF0ZSkgewogICAgICAgIFNRTEJ1ZmZlciBmcm9tU1FMID0gbmV3\nIFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBDb2xsZWN0aW9uIGFsaWFzZXMg\nPSBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAgICAgICAgaWYgKGFsaWFzZXMu\nc2l6ZSgpIDwgMiB8fCBzZWwuZ2V0Sm9pblN5bnRheCgpICE9IFNZTlRBWF9T\nUUw5MikgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFz\nZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIGZyb21TUUwuYXBwZW5kKGl0ci5uZXh0KCkudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxlRm9yVXBkYXRl\nQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5h\ncHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAg\nICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAg\nICAgICAgZnJvbVNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBJdGVyYXRvciBpdHIgPSBzZWwu\nZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGJvb2xlYW4gZmlyc3Qg\nPSB0cnVlOwogICAgICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewog\nICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQodG9TUUw5MkpvaW4oKEpv\naW4pIGl0ci5uZXh0KCksIGZvclVwZGF0ZSwKICAgICAgICAgICAgICAgICAg\nICBmaXJzdCkpOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZnJvbVNRTDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgRlJPTSBjbGF1c2Ug\nZm9yIGEgc2VsZWN0IHRoYXQgc2VsZWN0cyBmcm9tIGEgdG1wIHRhYmxlCiAg\nICAgKiBjcmVhdGVkIGJ5IGFuIGlubmVyIHNlbGVjdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWws\nIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVmZmVyIGZyb21T\nUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGZyb21TUUwuYXBw\nZW5kKCIoIik7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQodG9TZWxlY3Qoc2Vs\nLmdldEZyb21TZWxlY3QoKSwgZm9yVXBkYXRlLCBudWxsKSk7CiAgICAgICAg\nZnJvbVNRTC5hcHBlbmQoIikiKTsKICAgICAgICBpZiAocmVxdWlyZXNBbGlh\nc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAi\nKS5hcHBlbmQoU2VsZWN0LkZST01fU0VMRUNUX0FMSUFTKTsKICAgICAgICBy\nZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgV0hFUkUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRlbWVudCwgb3Ig\nbnVsbCBpZiBubyB3aGVyZQogICAgICogY29uZGl0aW9ucy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRXaGVyZShTZWxlY3Qgc2VsLCBi\nb29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIEpvaW5zIGpvaW5zID0gc2Vs\nLmdldEpvaW5zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRKb2luU3ludGF4KCkg\nPT0gU1lOVEFYX1NRTDkyCiAgICAgICAgICAgIHx8IGpvaW5zID09IG51bGwg\nfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gc2VsLmdl\ndFdoZXJlKCk7CgogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxC\ndWZmZXIodGhpcyk7CiAgICAgICAgaWYgKHNlbC5nZXRXaGVyZSgpICE9IG51\nbGwpCiAgICAgICAgICAgIHdoZXJlLmFwcGVuZChzZWwuZ2V0V2hlcmUoKSk7\nCiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5h\ncHBlbmQod2hlcmUsIGpvaW5zKTsKICAgICAgICByZXR1cm4gd2hlcmU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFu\nY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAq\nIHRoZSB0cmFkaXRpb25hbCBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciB0b1RyYWRpdGlvbmFsSm9pbihKb2luIGpvaW4pIHsKICAgICAg\nICBGb3JlaWduS2V5IGZrID0gam9pbi5nZXRGb3JlaWduS2V5KCk7CiAgICAg\nICAgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBib29sZWFuIGludmVyc2UgPSBqb2luLmlzRm9yZWlnbktleUlu\ndmVyc2VkKCk7CiAgICAgICAgQ29sdW1uW10gZnJvbSA9IChpbnZlcnNlKSA/\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG8gPSAoaW52ZXJzZSkg\nPyBmay5nZXRDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpOwoKICAgICAgICAvLyBkbyBjb2x1bW4gam9pbnMKICAg\nICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAg\nICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZnJvbS5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICBp\nZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFO\nRCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgp\nKS5hcHBlbmQoIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4u\nZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0b1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBkbyBjb25zdGFudCBqb2lucwogICAgICAgIENv\nbHVtbltdIGNvbnN0Q29scyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RDb2xzLmxlbmd0aDsg\naSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1\nZShmay5nZXRDb25zdGFudChjb25zdENvbHNbaV0pLCBjb25zdENvbHNbaV0p\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAg\nICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0pOwogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMigpKS5hcHBl\nbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoY29uc3RDb2xz\nW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNvbnN0Q29sc1tpXSksIGNvbnN0\nQ29sc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb25zdENv\nbHNQSyA9IGZrLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnN0Q29sc1BLLmxlbmd0aDsg\naSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9p\nbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAg\nICAgYXBwZW5kKGNvbnN0Q29sc1BLW2ldKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlL\nZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlLZXlDb25zdGFudChj\nb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAgICAgY29uc3RDb2xz\nUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLgogICAgICAg\nICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNQS1tpXSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBV\nc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2lu\naW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBTUUw5MiBzdHlsZS4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NRTDkySm9pbihKb2luIGpv\naW4sIGJvb2xlYW4gZm9yVXBkYXRlLCBib29sZWFuIGZpcnN0KSB7CiAgICAg\nICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAg\nICAgaWYgKGZpcnN0KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5n\nZXRUYWJsZTEoKSkuYXBwZW5kKCIgIikuCiAgICAgICAgICAgICAgICBhcHBl\nbmQoam9pbi5nZXRBbGlhczEoKSk7CiAgICAgICAgICAgIGlmIChmb3JVcGRh\ndGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVD\nbGF1c2UpOwogICAgICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwog\nICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQob3V0ZXJKb2luQ2xhdXNlKTsKICAg\nICAgICBlbHNlIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5O\nRVIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoaW5uZXJKb2luQ2xhdXNlKTsK\nICAgICAgICBlbHNlIC8vIGNyb3NzCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nY3Jvc3NKb2luQ2xhdXNlKTsKICAgICAgICBidWYuYXBwZW5kKCIgIik7Cgog\nICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTIoKSkuYXBwZW5kKCIg\nIikuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpOwogICAgICAgIGlmIChmb3JV\ncGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNs\nYXVzZSk7CgogICAgICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBu\ndWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKHRv\nVHJhZGl0aW9uYWxKb2luKGpvaW4pKTsKICAgICAgICBlbHNlIGlmIChyZXF1\naXJlc0NvbmRpdGlvbkZvckNyb3NzSm9pbiAmJgogICAgICAgICAgICBqb2lu\nLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfQ1JPU1MpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBPTiAoMSA9IDEpIik7CgogICAgICAgIHJldHVybiBidWY7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5z\ndGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAg\nICAqIHRoZSBkYXRhYmFzZSdzIG5hdGl2ZSBzeW50YXguIFRocm93cyBhbiBl\neGNlcHRpb24gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b05hdGl2ZUpvaW4oSm9pbiBqb2luKSB7CiAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIGlmIHRoZSBnaXZlbiBmb3JlaWduIGtleSBjYW4gYmUg\nZWFnZXJseSBsb2FkZWQgdXNpbmcgb3RoZXIgam9pbnMuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGNhbk91dGVySm9pbihpbnQgc3ludGF4LCBGb3Jl\naWduS2V5IGZrKSB7CiAgICAgICAgcmV0dXJuIHN5bnRheCAhPSBTWU5UQVhf\nVFJBRElUSU9OQUw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRo\nZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZl\nciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZl\nciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIg\nb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JV\ncGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgcmV0dXJu\nIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVj\ndHMsIGZyb20sIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBv\ncmRlciwgZGlzdGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZv\nclVwZGF0ZUNsYXVzZShmZXRjaCwgZm9yVXBkYXRlKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZXQgdGhlIHVwZGF0ZSBjbGF1c2UgZm9yIHRoZSBxdWVy\neSBiYXNlZCBvbiB0aGUKICAgICAqIHVwZGF0ZUNsYXVzZSBhbmQgaXNvbGF0\naW9uTGV2ZWwgaGludHMKICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBn\nZXRGb3JVcGRhdGVDbGF1c2UoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIGlmIChm\nZXRjaCAhPSBudWxsICYmIGZldGNoLmdldElzb2xhdGlvbigpICE9IC0xKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAiaXNvbGF0aW9uLWxldmVsLWNv\nbmZpZy1ub3Qtc3VwcG9ydGVkIiwgZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKTsK\nICAgICAgICB9IGVsc2UgaWYgKGZvclVwZGF0ZSAmJiAhc2ltdWxhdGVMb2Nr\naW5nKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNTZWxl\nY3RGb3JVcGRhdGUsICJTdXBwb3J0c1NlbGVjdEZvclVwZGF0ZSIpOwogICAg\nICAgICAgICByZXR1cm4gZm9yVXBkYXRlQ2xhdXNlOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgIlNFTEVDVCIgb3BlcmF0aW9u\nIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFpbGFibGUgaGludHMsIGV0Yy4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTZWxlY3RPcGVyYXRpb24oSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVybiAi\nU0VMRUNUIjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FM\nIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJpbmcgb3As\nIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBT\nUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVyIGhh\ndmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4gZGlzdGlu\nY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0cmluZyBmb3JV\ncGRhdGVDbGF1c2UpIHsKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNR\nTEJ1ZmZlcih0aGlzKTsKICAgICAgICBidWYuYXBwZW5kKG9wKTsKCiAgICAg\nICAgYm9vbGVhbiByYW5nZSA9IHN0YXJ0ICE9IDAgfHwgZW5kICE9IExvbmcu\nTUFYX1ZBTFVFOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9u\nID09IFJBTkdFX1BSRV9ESVNUSU5DVCkKICAgICAgICAgICAgYXBwZW5kU2Vs\nZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5kKTsKICAgICAgICBpZiAoZGlzdGlu\nY3QpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBESVNUSU5DVCIpOwogICAg\nICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1Rf\nRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwg\nc3RhcnQsIGVuZCk7CgogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQo\nc2VsZWN0cykuYXBwZW5kKCIgRlJPTSAiKS5hcHBlbmQoZnJvbSk7CgogICAg\nICAgIGlmICh3aGVyZSAhPSBudWxsICYmICF3aGVyZS5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAiKS5hcHBlbmQod2hlcmUp\nOwogICAgICAgIGlmIChncm91cCAhPSBudWxsICYmICFncm91cC5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBHUk9VUCBCWSAiKS5hcHBl\nbmQoZ3JvdXApOwogICAgICAgIGlmIChoYXZpbmcgIT0gbnVsbCAmJiAhaGF2\naW5nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBhc3NlcnRTdXBwb3J0KHN1\ncHBvcnRzSGF2aW5nLCAiU3VwcG9ydHNIYXZpbmciKTsKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEhBVklORyAiKS5hcHBlbmQoaGF2aW5nKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKG9yZGVyICE9IG51bGwgJiYgIW9yZGVyLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9SREVSIEJZICIpLmFw\ncGVuZChvcmRlcik7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRp\nb24gPT0gUkFOR0VfUE9TVF9TRUxFQ1QpCiAgICAgICAgICAgIGFwcGVuZFNl\nbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCk7CiAgICAgICAgaWYgKGZvclVw\nZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nIikuYXBwZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgaWYgKHJhbmdl\nICYmIHJhbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9MT0NLKQogICAgICAg\nICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQpOwogICAg\nICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGlz\nIGRpY3Rpb25hcnkgY2FuIHNlbGVjdCByYW5nZXMsCiAgICAgKiB1c2UgdGhp\ncyBtZXRob2QgdG8gYXBwZW5kIHRoZSByYW5nZSBTUUwuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIGFwcGVuZFNlbGVjdFJhbmdlKFNRTEJ1ZmZlciBi\ndWYsIGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1l\nbnQgYmV0d2VlbiB0aGUgU0VMRUNUIGtleXdvcmQKICAgICAqIGFuZCB0aGUg\nRlJPTSBrZXl3b3JkLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVy\nIGdldFNlbGVjdHMoU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50\naWZpZXJzLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAg\nLy8gYXBwZW5kIHRoZSBhbGlhc2VzIGZvciBhbGwgdGhlIGNvbHVtbnMKICAg\nICAgICBTUUxCdWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlz\nKTsKICAgICAgICBMaXN0IGFsaWFzZXM7CiAgICAgICAgaWYgKGRpc3RpbmN0\nSWRlbnRpZmllcnMpCiAgICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0SWRl\nbnRpZmllckFsaWFzZXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFs\naWFzZXMgPSBzZWwuZ2V0U2VsZWN0QWxpYXNlcygpOwoKICAgICAgICBPYmpl\nY3QgYWxpYXM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhbGlhc2Vz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFs\naWFzID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGFsaWFzIGluc3Rh\nbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFw\ncGVuZCgoU1FMQnVmZmVyKSBhbGlhcyk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoYWxpYXMudG9TdHJpbmco\nKSk7CiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHNlbGVjdFNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdHJ1ZSBpZiBhICJGT1IgVVBEQVRFIiBjbGF1c2UgY2FuIGJlIHVz\nZWQgZm9yIHRoZSBzcGVjaWZpZWQKICAgICAqIFNlbGVjdCBvYmplY3QuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZyhTZWxl\nY3Qgc2VsKSB7CiAgICAgICAgaWYgKHNlbC5pc0FnZ3JlZ2F0ZSgpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c1Nl\nbGVjdEZvclVwZGF0ZSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aFNlbGVjdFJhbmdlICYmIChz\nZWwuZ2V0U3RhcnRJbmRleCgpICE9IDAKICAgICAgICAgICAgfHwgc2VsLmdl\ndEVuZEluZGV4KCkgIT0gTG9uZy5NQVhfVkFMVUUpKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIG9ubHkgaW5uZXIgc2VsZWN0IGlz\nIGxvY2tlZAogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51\nbGwpCiAgICAgICAgICAgIHNlbCA9IHNlbC5nZXRGcm9tU2VsZWN0KCk7Cgog\nICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aERpc3RpbmN0Q2xhdXNl\nICYmIHNlbC5pc0Rpc3RpbmN0KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRh\nYmxlcwogICAgICAgICAgICAmJiBzZWwuZ2V0VGFibGVBbGlhc2VzKCkuc2l6\nZSgpID4gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nICghc3VwcG9ydHNMb2NraW5nV2l0aE9yZGVyQ2xhdXNlICYmIHNlbC5nZXRP\ncmRlcmluZygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gfHwg\nIXN1cHBvcnRzTG9ja2luZ1dpdGhJbm5lckpvaW4pIHsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBKb2luIGpvaW4gPSAo\nSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICghc3VwcG9y\ndHNMb2NraW5nV2l0aE91dGVySm9pbgogICAgICAgICAgICAgICAgICAgICYm\nIGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAo\nIXN1cHBvcnRzTG9ja2luZ1dpdGhJbm5lckpvaW4KICAgICAgICAgICAgICAg\nICAgICAmJiBqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGZhbHNlIGlmIHRoZSBnaXZlbiBzZWxlY3QgcmVx\ndWlyZXMgYSBmb3J3YXJkLW9ubHkgcmVzdWx0IHNldC4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQo\nU2VsZWN0IHNlbCwKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSkgewogICAg\nICAgIHJldHVybiAhc2VsLmlzQWdncmVnYXRlKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgZ2l2ZW4gZGljdGlvbmFyeSBmbGFn\nIGlzIHRydWUuIElmIGl0IGlzIG5vdCB0cnVlLAogICAgICogdGhyb3cgYW4g\nZXJyb3Igc2F5aW5nIHRoYXQgdGhlIGdpdmVuIHNldHRpbmcgbmVlZHMgdG8g\ncmV0dXJuIHRydWUgZm9yCiAgICAgKiB0aGUgY3VycmVudCBvcGVyYXRpb24g\ndG8gd29yay4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0U3VwcG9y\ndChib29sZWFuIGZlYXR1cmUsIFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAg\nIGlmICghZmVhdHVyZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJmZWF0dXJlLW5vdC1zdXBwb3J0ZWQi\nLAogICAgICAgICAgICAgICAgZ2V0Q2xhc3MoKSwgcHJvcGVydHkpKTsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUXVlcnkgZnVu\nY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAg\nICogSW52b2tlIHRoaXMgZGF0YWJhc2UncyBzdWJzdHJpbmcgZnVuY3Rpb24u\nCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3\ncml0ZSB0aGUgc3Vic3RyaW5nIGludm9jYXRpb24gdG8KICAgICAqIEBwYXJh\nbSBzdHIgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHRhcmdldCBz\ndHJpbmcKICAgICAqIEBwYXJhbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJl\nc2VudGluZyB0aGUgc3RhcnQgaW5kZXgKICAgICAqIEBwYXJhbSBlbmQgYSBx\ndWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIGVuZCBpbmRleCwgb3IgbnVs\nbCBmb3Igbm9uZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzdWJzdHJpbmco\nU1FMQnVmZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBz\ndGFydCwKICAgICAgICBGaWx0ZXJWYWx1ZSBlbmQpIHsKICAgICAgICBidWYu\nYXBwZW5kKHN1YnN0cmluZ0Z1bmN0aW9uTmFtZSkuYXBwZW5kKCIoKCIpOwog\nICAgICAgIHN0ci5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQo\nIiksICgiKTsKICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAg\nIGJ1Zi5hcHBlbmQoIiArIDEpIik7CiAgICAgICAgaWYgKGVuZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgKCIpOwogICAgICAgICAg\nICBlbmQuYXBwZW5kVG8oYnVmKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIC0gKCIpOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAg\nICAgICAgICBidWYuYXBwZW5kKCIpKSIpOwogICAgICAgIH0KICAgICAgICBi\ndWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2Ug\ndGhpcyBkYXRhYmFzZSdzIGluZGV4T2YgZnVuY3Rpb24uCiAgICAgKgogICAg\nICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgaW5k\nZXhPZiBpbnZvY2F0aW9uIHRvCiAgICAgKiBAcGFyYW0gc3RyIGEgcXVlcnkg\ndmFsdWUgcmVwcmVzZW50aW5nIHRoZSB0YXJnZXQgc3RyaW5nCiAgICAgKiBA\ncGFyYW0gZmluZCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgc2Vh\ncmNoIHN0cmluZwogICAgICogQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUg\ncmVwcmVzZW50aW5nIHRoZSBzdGFydCBpbmRleCwgb3IgbnVsbAogICAgICog\ndG8gc3RhcnQgYXQgdGhlIGJlZ2lubmluZwogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBpbmRleE9mKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHN0ciwg\nRmlsdGVyVmFsdWUgZmluZCwKICAgICAgICBGaWx0ZXJWYWx1ZSBzdGFydCkg\newogICAgICAgIGJ1Zi5hcHBlbmQoIihJTlNUUigoIik7CiAgICAgICAgaWYg\nKHN0YXJ0ICE9IG51bGwpCiAgICAgICAgICAgIHN1YnN0cmluZyhidWYsIHN0\nciwgc3RhcnQsIG51bGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Ry\nLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiKSwgKCIpOwog\nICAgICAgIGZpbmQuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5k\nKCIpKSAtIDEiKTsKICAgICAgICBpZiAoc3RhcnQgIT0gbnVsbCkgewogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgKyAiKTsKICAgICAgICAgICAgc3RhcnQu\nYXBwZW5kVG8oYnVmKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgi\nKSIpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIHRoZSBudW1lcmlj\nIHBhcnRzIG9mIGEgbWF0aGVtYXRpY2FsIGZ1bmN0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIG1h\ndGggZnVuY3Rpb24KICAgICAqIEBwYXJhbSBvcCB0aGUgbWF0aGVtYXRpY2Fs\nIG9wZXJhdGlvbiB0byBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBs\nZWZ0IGhhbmQgc2lkZSBvZiB0aGUgbWF0aCBmdW5jdGlvbgogICAgICogQHBh\ncmFtIHJocyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBtYXRoIGZ1bmN0\naW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG1hdGhGdW5jdGlvbihTUUxC\ndWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAg\nICBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBib29sZWFuIGNhc3RsaHMg\nPSBmYWxzZTsKICAgICAgICBib29sZWFuIGNhc3RyaHMgPSBmYWxzZTsKICAg\nICAgICBDbGFzcyBsYyA9IEZpbHRlcnMud3JhcChsaHMuZ2V0VHlwZSgpKTsK\nICAgICAgICBDbGFzcyByYyA9IEZpbHRlcnMud3JhcChyaHMuZ2V0VHlwZSgp\nKTsKICAgICAgICBpbnQgdHlwZSA9IDA7CiAgICAgICAgaWYgKHJlcXVpcmVz\nQ2FzdEZvck1hdGhGdW5jdGlvbnMgJiYgKGxjICE9IHJjCiAgICAgICAgICAg\nIHx8IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpKSkg\newogICAgICAgICAgICBDbGFzcyBjID0gRmlsdGVycy5wcm9tb3RlKGxjLCBy\nYyk7CiAgICAgICAgICAgIHR5cGUgPSBnZXRKREJDVHlwZShKYXZhVHlwZXMu\nZ2V0VHlwZUNvZGUoYyksIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHR5cGUg\nIT0gVHlwZXMuVkFSQklOQVJZICYmIHR5cGUgIT0gVHlwZXMuQkxPQikgewog\nICAgICAgICAgICAgICAgY2FzdGxocyA9IChsaHMuaXNDb25zdGFudCgpICYm\nIHJocy5pc0NvbnN0YW50KCkpIHx8IGxjICE9IGM7CiAgICAgICAgICAgICAg\nICBjYXN0cmhzID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3Rh\nbnQoKSkgfHwgcmMgIT0gYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgYm9vbGVhbiBtb2QgPSAiTU9EIi5lcXVhbHMob3ApOwogICAgICAg\nIGlmIChtb2QpIHsKICAgICAgICAgICAgaWYgKHN1cHBvcnRzTW9kT3BlcmF0\nb3IpCiAgICAgICAgICAgICAgICBvcCA9ICIlIjsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChvcCk7CiAgICAgICAgfQog\nICAgICAgIGJ1Zi5hcHBlbmQoIigiKTsKCiAgICAgICAgaWYgKGNhc3RsaHMp\nCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5cGUpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7CgogICAg\nICAgIGlmIChtb2QgJiYgIXN1cHBvcnRzTW9kT3BlcmF0b3IpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAiKTsKCiAg\nICAgICAgaWYgKGNhc3RyaHMpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVm\nLCByaHMsIHR5cGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmhzLmFw\ncGVuZFRvKGJ1Zik7CgogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFwcGVuZCBhIGNvbXBhcmlzb24uCiAgICAgKgog\nICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUg\nY29tcGFyaXNvbgogICAgICogQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9w\nZXJhdGlvbiB0byBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0\nIGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIHJo\ncyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGNvbXBhcmlzb24oU1FMQnVmZmVyIGJ1Ziwg\nU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVyVmFs\ndWUgcmhzKSB7CiAgICAgICAgYm9vbGVhbiBsaHN4bWwgPSBsaHMuZ2V0WFBh\ndGgoKSAhPSBudWxsOwogICAgICAgIGJvb2xlYW4gcmhzeG1sID0gcmhzLmdl\ndFhQYXRoKCkgIT0gbnVsbDsKICAgICAgICBpZiAobGhzeG1sIHx8IHJoc3ht\nbCkgewogICAgICAgICAgICBhcHBlbmRYbWxDb21wYXJpc29uKGJ1Ziwgb3As\nIGxocywgcmhzLCBsaHN4bWwsIHJoc3htbCk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CiAgICAgICAgYm9vbGVhbiBjYXN0bGhzID0gZmFsc2U7\nCiAgICAgICAgYm9vbGVhbiBjYXN0cmhzID0gZmFsc2U7CiAgICAgICAgQ2xh\nc3MgbGMgPSBGaWx0ZXJzLndyYXAobGhzLmdldFR5cGUoKSk7CiAgICAgICAg\nQ2xhc3MgcmMgPSBGaWx0ZXJzLndyYXAocmhzLmdldFR5cGUoKSk7CiAgICAg\nICAgaW50IHR5cGUgPSAwOwogICAgICAgIGlmIChyZXF1aXJlc0Nhc3RGb3JD\nb21wYXJpc29ucyAmJiAobGMgIT0gcmMKICAgICAgICAgICAgfHwgKGxocy5p\nc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkpKSB7CiAgICAgICAg\nICAgIENsYXNzIGMgPSBGaWx0ZXJzLnByb21vdGUobGMsIHJjKTsKICAgICAg\nICAgICAgdHlwZSA9IGdldEpEQkNUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29k\nZShjKSwgZmFsc2UpOwogICAgICAgICAgICBpZiAodHlwZSAhPSBUeXBlcy5W\nQVJCSU5BUlkgJiYgdHlwZSAhPSBUeXBlcy5CTE9CKSB7CiAgICAgICAgICAg\nICAgICBjYXN0bGhzID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29u\nc3RhbnQoKSkgfHwgbGMgIT0gYzsKICAgICAgICAgICAgICAgIGNhc3RyaHMg\nPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8fCBy\nYyAhPSBjOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\nY2FzdGxocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIGxocywgdHlw\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBsaHMuYXBwZW5kVG8oYnVm\nKTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5k\nKCIgIik7CgogICAgICAgIGlmIChjYXN0cmhzKQogICAgICAgICAgICBhcHBl\nbmRDYXN0KGJ1ZiwgcmhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHJocy5hcHBlbmRUbyhidWYpOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIFhNTCB0eXBlLAogICAgICog\ndXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB4bWwgcHJlZGljYXRlLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRYbWxDb21wYXJpc29uKFNRTEJ1\nZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAg\nIEZpbHRlclZhbHVlIHJocywgYm9vbGVhbiBsaHN4bWwsIGJvb2xlYW4gcmhz\neG1sKSB7CiAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1hNTENvbHVt\nbiwgIlN1cHBvcnRzWE1MQ29sdW1uIik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBcHBlbmQgU1FMIGZvciB0aGUgZ2l2ZW4gbnVtZXJpYyB2YWx1ZSB0byB0\naGUgYnVmZmVyLCBjYXN0aW5nIGFzIG5lZWRlZC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgYXBwZW5kTnVtZXJpY0Nhc3QoU1FMQnVmZmVyIGJ1Ziwg\nRmlsdGVyVmFsdWUgdmFsKSB7CiAgICAgICAgaWYgKHZhbC5pc0NvbnN0YW50\nKCkpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCB2YWwsIFR5cGVzLk5V\nTUVSSUMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFsLmFwcGVuZFRv\nKGJ1Zik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYXN0IHRoZSBzcGVjaWZp\nZWQgdmFsdWUgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICoKICAgICAq\nIEBwYXJhbSBidWYgdGhlIGJ1ZmZlciB0byBhcHBlbmQgdGhlIGNhc3QgdG8K\nICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGNhc3QKICAgICAqIEBw\nYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHRoZSBjYXNlLCBlLmcuIHtAbGluayBU\neXBlcyNOVU1FUklDfQogICAgICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRD\nYXN0KFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHZhbCwgaW50IHR5cGUp\nIHsKICAgICAgICAvLyBDb252ZXJ0IHRoZSBjYXN0IGZ1bmN0aW9uOiAiQ0FT\nVCh7MH0gQVMgezF9KSIKICAgICAgICBpbnQgZmlyc3RQYXJhbSA9IGNhc3RG\ndW5jdGlvbi5pbmRleE9mKCJ7MH0iKTsKICAgICAgICBTdHJpbmcgcHJlID0g\nY2FzdEZ1bmN0aW9uLnN1YnN0cmluZygwLCBmaXJzdFBhcmFtKTsgLy8gIkNB\nU1QoIgogICAgICAgIFN0cmluZyBtaWQgPSBjYXN0RnVuY3Rpb24uc3Vic3Ry\naW5nKGZpcnN0UGFyYW0gKyAzKTsKICAgICAgICBpbnQgc2Vjb25kUGFyYW0g\nPSBtaWQuaW5kZXhPZigiezF9Iik7CiAgICAgICAgU3RyaW5nIHBvc3Q7CiAg\nICAgICAgaWYgKHNlY29uZFBhcmFtID4gLTEpIHsKICAgICAgICAgICAgcG9z\ndCA9IG1pZC5zdWJzdHJpbmcoc2Vjb25kUGFyYW0gKyAzKTsgLy8gIikiCiAg\nICAgICAgICAgIG1pZCA9IG1pZC5zdWJzdHJpbmcoMCwgc2Vjb25kUGFyYW0p\nOyAvLyAiIEFTICIKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcG9zdCA9\nICIiOwoKICAgICAgICBidWYuYXBwZW5kKHByZSk7CiAgICAgICAgdmFsLmFw\ncGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZChtaWQpOwogICAgICAg\nIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5hbWUodHlwZSkpOwogICAgICAgIGFwcGVu\nZExlbmd0aChidWYsIHR5cGUpOwogICAgICAgIGJ1Zi5hcHBlbmQocG9zdCk7\nCiAgICB9CiAgICAKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZExlbmd0aChT\nUUxCdWZmZXIgYnVmLCBpbnQgdHlwZSkgeyAgICAgICAgCiAgICB9CgogICAg\nCiAgICAvKioKICAgICAqIGFkZCBDQVNUIGZvciBhIGZ1bmN0aW9uIG9wZXJh\ndG9yIHdoZXJlIG9wZXJhbmQgaXMgYSBwYXJhbQogICAgICogQHBhcmFtIGZ1\nbmMgIGZ1bmN0aW9uIG5hbWUKICAgICAqIEBwYXJhbSB2YWwgCiAgICAgKiBA\ncmV0dXJuIHVwZGF0ZWQgZnVuYwogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGFkZENhc3RBc1R5cGUoU3RyaW5nIGZ1bmMsIFZhbCB2YWwpIHsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0gICAgCgoKICAgIC8vLy8vLy8vLy8vCiAg\nICAvLyBEREwgU1FMCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nSW5jcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgYW55IHRhYmxlIGNv\nbXBvbmVudHMgdGhhdCB0aGlzCiAgICAgKiBkaWN0aW9uYXJ5IGFkZHMgdGhh\ndCBhcmUgbm90IHVzZWQgYnkgbWFwcGluZ3MuIERvZXMgbm90aGluZyBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWZTY2hlbWFDb21w\nb25lbnRzKFRhYmxlIHRhYmxlKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBpbmNsdWRpbmcg\ndGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxpbmsgI2NhdGFs\nb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRG\ndWxsTmFtZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dpY2FsKSB7CiAgICAg\nICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IHRhYmxlLmdldFNjaGVtYU5hbWUo\nKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGFibGUuZ2V0TmFtZSgp\nOwogICAgICAgIGlmIChsb2dpY2FsIHx8ICIuIi5lcXVhbHMoY2F0YWxvZ1Nl\ncGFyYXRvcikpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5nZXRGdWxsTmFt\nZSgpOwogICAgICAgIHJldHVybiB0YWJsZS5nZXRTY2hlbWFOYW1lKCkgKyBj\nYXRhbG9nU2VwYXJhdG9yICsgdGFibGUuZ2V0TmFtZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBuYW1lIG9mIHRoZSBpbmRl\neCwgaW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAogICAgICogYnkg\ndGhlIHJlc3VsdCBvZiB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJbmRleCBpbmRl\neCkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBpbmRleC5nZXRT\nY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGluZGV4\nLmdldE5hbWUoKTsKICAgICAgICBpZiAoIi4iLmVxdWFscyhjYXRhbG9nU2Vw\nYXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIGluZGV4LmdldEZ1bGxOYW1l\nKCk7CiAgICAgICAgcmV0dXJuIGluZGV4LmdldFNjaGVtYU5hbWUoKSArIGNh\ndGFsb2dTZXBhcmF0b3IgKyBpbmRleC5nZXROYW1lKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHNlcXVl\nbmNlLCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBi\neSB0aGUgcmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1lKFNlcXVlbmNl\nIHNlcSkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBzZXEuZ2V0\nU2NoZW1hTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBzZXEu\nZ2V0TmFtZSgpOwogICAgICAgIGlmICgiLiIuZXF1YWxzKGNhdGFsb2dTZXBh\ncmF0b3IpKQogICAgICAgICAgICByZXR1cm4gc2VxLmdldEZ1bGxOYW1lKCk7\nCiAgICAgICAgcmV0dXJuIHNlcS5nZXRTY2hlbWFOYW1lKCkgKyBjYXRhbG9n\nU2VwYXJhdG9yICsgc2VxLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB0\nYWJsZSBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3Vy\ncmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFRh\nYmxlTmFtZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAg\nIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFt\nZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFt\nZVZhbGlkKG5hbWUsIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAg\nICAgICBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfVEFCTEUpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8g\ndGhlIGdpdmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAg\nICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFZhbGlkU2VxdWVuY2VOYW1lKFN0cmluZyBuYW1lLCBTY2hlbWEg\nc2NoZW1hKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIp\nKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlNfIiArIG5hbWUsIHNjaGVtYS5n\nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhUYWJsZU5hbWVMZW5n\ndGgsIE5BTUVfU0VRVUVOQ0UpOwogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGNvbHVtbiBu\nYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBE\nQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZENvbHVtbk5h\nbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUg\nKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQo\nbmFtZSwgdGFibGUsIG1heENvbHVtbk5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFu\nZ2VzIHRvIHRoZSBnaXZlbiBwcmltYXJ5IGtleSBuYW1lIHRvIG1ha2UgaXQK\nICAgICAqIHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXRWYWxpZFByaW1hcnlLZXlOYW1lKFN0cmluZyBu\nYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0\nc1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5n\nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJQXyIgKyBuYW1l\nLCB0YWJsZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAg\nICAgICBtYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAg\nfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMg\ndG8gdGhlIGdpdmVuIGZvcmVpZ24ga2V5IG5hbWUgdG8gbWFrZSBpdAogICAg\nICogdmFsaWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFZhbGlkRm9yZWlnbktleU5hbWUoU3RyaW5nIG5hbWUs\nIFRhYmxlIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsKICAgICAg\nICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5h\nbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcgdGFibGVO\nYW1lID0gdGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4gPSBNYXRo\nLm1pbih0YWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIG5hbWUgPSAi\nRl8iICsgc2hvcnRlbih0YWJsZU5hbWUsIGxlbikgKyAiXyIgKyBuYW1lOwog\nICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLmdldFNj\naGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heENvbnN0\ncmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4g\naW5kZXggbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1\ncnJlbnQgREIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRJ\nbmRleE5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\nd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1l\nID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFt\nZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5t\naW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIklf\nIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAg\nICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hl\nbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhJbmRleE5h\nbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB1bmlxdWUg\nY29uc3RyYWludCBuYW1lIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkIGZvciB0\naGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRW\nYWxpZFVuaXF1ZU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAg\nICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRh\nYmxlTmFtZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0g\nTWF0aC5taW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1l\nID0gIlVfIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFt\nZTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5n\nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhD\nb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2hvcnRlbiB0aGUgc3BlY2lmaWVkIG5hbWUgdG8gdGhlIHNw\nZWNpZmllZCB0YXJnZXQgbmFtZS4gVGhpcyB3aWxsCiAgICAgKiBiZSBkb25l\nIGJ5IGZpcnN0IHN0cmlwcGluZyBvdXQgdGhlIHZvd2VscywgYW5kIHRoZW4g\ncmVtb3ZpbmcKICAgICAqIGNoYXJhY3RlcnMgZnJvbSB0aGUgbWlkZGxlIG9m\nIHRoZSB3b3JkIHVudGlsIGl0IHJlYWNoZXMgdGhlIHRhcmdldAogICAgICog\nbGVuZ3RoLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIFN0cmluZyBz\naG9ydGVuKFN0cmluZyBuYW1lLCBpbnQgdGFyZ2V0TGVuZ3RoKSB7CiAgICAg\nICAgaWYgKG5hbWUgPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpIDw9IHRhcmdl\ndExlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CgogICAgICAgIFN0\ncmluZ0J1ZmZlciBubSA9IG5ldyBTdHJpbmdCdWZmZXIobmFtZSk7CiAgICAg\nICAgd2hpbGUgKG5tLmxlbmd0aCgpID4gdGFyZ2V0TGVuZ3RoKSB7CiAgICAg\nICAgICAgIGlmICghc3RyaXBWb3dlbChubSkpIHsKICAgICAgICAgICAgICAg\nIC8vIGN1dCBvdXQgdGhlIG1pZGRsZSBjaGFyCiAgICAgICAgICAgICAgICBu\nbS5yZXBsYWNlKG5tLmxlbmd0aCgpIC8gMiwgKG5tLmxlbmd0aCgpIC8gMikg\nKyAxLCAiIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIG5tLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1v\ndmUgdm93ZWxzIGZyb20gdGhlIHNwZWNpZmllZCBTdHJpbmdCdWZmZXIuCiAg\nICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIGFueSB2b3dlbHMgaGF2ZSBi\nZWVuIHJlbW92ZWQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVh\nbiBzdHJpcFZvd2VsKFN0cmluZ0J1ZmZlciBuYW1lKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9IHsg\nJ0EnLCAnRScsICdJJywgJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCB2b3dlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\naW50IGluZGV4ID0gbmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5k\nZXhPZih2b3dlbHNbaV0pOwogICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEp\nIHsKICAgICAgICAgICAgICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5kZXgg\nKyAxLCAiIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0\naGUgZ2l2ZW4gbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAg\nICAqIGl0IGlzIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2Vy\ndmVkLCBhcHBlbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxp\nY3RzIHdpdGggYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhlIGxh\nc3QKICAgICAqIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVu\nICcxJywgZXRjLgogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVu\nIG1heSBiZSAwIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAgICog\naW5jb21wbGV0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBtYWtl\nTmFtZVZhbGlkKFN0cmluZyBuYW1lLCBOYW1lU2V0IHNldCwgaW50IG1heExl\nbiwKICAgICAgICBpbnQgbmFtZVR5cGUpIHsKICAgICAgICBpZiAobWF4TGVu\nIDwgMSkKICAgICAgICAgICAgbWF4TGVuID0gMjU1OwogICAgICAgIGlmIChu\nYW1lLmxlbmd0aCgpID4gbWF4TGVuKQogICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMCwgbWF4TGVuKTsKICAgICAgICBpZiAocmVzZXJ2ZWRX\nb3JkU2V0LmNvbnRhaW5zKG5hbWUudG9VcHBlckNhc2UoKSkpIHsKICAgICAg\nICAgICAgaWYgKG5hbWUubGVuZ3RoKCkgPT0gbWF4TGVuKQogICAgICAgICAg\nICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoKCkg\nLSAxKTsKICAgICAgICAgICAgbmFtZSArPSAiMCI7CiAgICAgICAgfQoKICAg\nICAgICAvLyBub3cgbWFrZSBzdXJlIHRoZSBuYW1lIGlzIHVuaXF1ZQogICAg\nICAgIGlmIChzZXQgIT0gbnVsbCkgewogICAgICAgICAgICBvdXRlcjoKICAg\nICAgICAgICAgZm9yIChpbnQgdmVyc2lvbiA9IDEsIGNoYXJzID0gMTsgdHJ1\nZTsgdmVyc2lvbisrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGFibGUg\nbmFtZXMsIHdlIGNoZWNrIGZvciB0aGUgdGFibGUgaXRzZWxmIGluIGNhc2Ug\ndGhlCiAgICAgICAgICAgICAgICAvLyBuYW1lIHNldCBpcyBsYXp5IGFib3V0\nIHNjaGVtYSByZWZsZWN0aW9uCiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5h\nbWVUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBOQU1FX1RBQkxF\nOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoU2NoZW1hR3JvdXAp\nIHNldCkuaXNLbm93blRhYmxlKG5hbWUpKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTkFNRV9TRVFVRU5D\nRToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoKFNjaGVtYUdyb3Vw\nKSBzZXQpLmlzS25vd25TZXF1ZW5jZShuYW1lKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoIXNldC5pc05hbWVUYWtlbihuYW1l\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGEgc2luZ2xl\nIGNoYXIgZm9yIHRoZSB2ZXJzaW9uIGlzIHByb2JhYmx5IGVub3VnaCwgYnV0\nIG1pZ2h0CiAgICAgICAgICAgICAgICAvLyBhcyB3ZWxsIGJlIGdlbmVyYWwg\nYWJvdXQgaXQuLi4KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uID4gMSkK\nICAgICAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwg\nbmFtZS5sZW5ndGgoKSAtIGNoYXJzKTsKICAgICAgICAgICAgICAgIGlmICh2\nZXJzaW9uID49IE1hdGgucG93KDEwLCBjaGFycykpCiAgICAgICAgICAgICAg\nICAgICAgY2hhcnMrKzsKICAgICAgICAgICAgICAgIGlmIChuYW1lLmxlbmd0\naCgpICsgY2hhcnMgPiBtYXhMZW4pCiAgICAgICAgICAgICAgICAgICAgbmFt\nZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG1heExlbiAtIGNoYXJzKTsKICAgICAg\nICAgICAgICAgIG5hbWUgPSBuYW1lICsgdmVyc2lvbjsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZS50b1VwcGVyQ2FzZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNR\nTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gdGFibGUsIGNvbXBs\nZXRlCiAgICAgKiB3aXRoIGNvbHVtbnMuIEluZGV4ZXMgYW5kIGNvbnN0cmFp\nbnRzIHdpbGwgYmUgY3JlYXRlZCBzZXBhcmF0ZWx5LgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUgdGFibGUp\nIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZl\ncigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSBUQUJMRSAiKS5hcHBl\nbmQoZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSkuCiAgICAgICAgICAgIGFw\ncGVuZCgiICgiKTsKCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdl\ndENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGkgPiAwKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgYnVmLmFw\ncGVuZChnZXREZWNsYXJlQ29sdW1uU1FMKGNvbHNbaV0sIGZhbHNlKSk7CiAg\nICAgICAgfQoKICAgICAgICBQcmltYXJ5S2V5IHBrID0gdGFibGUuZ2V0UHJp\nbWFyeUtleSgpOwogICAgICAgIFN0cmluZyBwa1N0cjsKICAgICAgICBpZiAo\ncGsgIT0gbnVsbCkgewogICAgICAgICAgICBwa1N0ciA9IGdldFByaW1hcnlL\nZXlDb25zdHJhaW50U1FMKHBrKTsKICAgICAgICAgICAgaWYgKHBrU3RyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVu\nZChwa1N0cik7CiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1bnFzID0g\ndGFibGUuZ2V0VW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFTdHI7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwo\ndW5xc1tpXSk7CiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBwZW5kKHVucVN0cik7\nCiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVt\nZW50cyB0byBkcm9wIHRoZSBnaXZlbiB0YWJsZS4gSW5kZXhlcwogICAgICog\nd2lsbCBiZSBkcm9wcGVkIHNlcGFyYXRlbHkuIFJldHVybnMKICAgICAqIDxj\nb2RlPkRST1AgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7PC9jb2RlPiBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcFRh\nYmxlU1FMKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgU3RyaW5nIGRyb3AgPSBN\nZXNzYWdlRm9ybWF0LmZvcm1hdChkcm9wVGFibGVTUUwsIG5ldyBPYmplY3Rb\nXXsKICAgICAgICAgICAgZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSB9KTsK\nICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBkcm9wIH07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVu\ndHMgdG8gY3JlYXRlIHRoZSBnaXZlbiBzZXF1ZW5jZS4gUmV0dXJucwogICAg\nICogPGNvZGU+Q1JFQVRFIFNFUVVFTkNFICZsdDtzZXF1ZW5jZSBuYW1lJmd0\nO1sgU1RBUlQgV0lUSCAmbHQ7c3RhcnQmZ3Q7XQogICAgICogWyBJTkNSRU1F\nTlQgQlkgJmx0O2luY3JlbWVudCZndDtdPC9jb2RlPiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlU2VxdWVuY2VT\nUUwoU2VxdWVuY2Ugc2VxKSB7CiAgICAgICAgaWYgKG5leHRTZXF1ZW5jZVF1\nZXJ5ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSBTRVFVRU5DRSAiKTsKICAgICAgICBi\ndWYuYXBwZW5kKGdldEZ1bGxOYW1lKHNlcSkpOwogICAgICAgIGlmIChzZXEu\nZ2V0SW5pdGlhbFZhbHVlKCkgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIFNUQVJUIFdJVEggIikuYXBwZW5kKHNlcS5nZXRJbml0aWFsVmFsdWUo\nKSk7CiAgICAgICAgaWYgKHNlcS5nZXRJbmNyZW1lbnQoKSA+IDEpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBJTkNSRU1FTlQgQlkgIikuYXBwZW5kKHNl\ncS5nZXRJbmNyZW1lbnQoKSk7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nXXsgYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBn\naXZlbiBzZXF1ZW5jZS4gUmV0dXJucwogICAgICogPGNvZGU+RFJPUCBTRVFV\nRU5DRSAmbHQ7c2VxdWVuY2UgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wU2VxdWVuY2VT\nUUwoU2VxdWVuY2Ugc2VxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nXXsgIkRST1AgU0VRVUVOQ0UgIiArIGdldEZ1bGxOYW1lKHNlcSkgfTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3Rh\ndGVtZW50cyB0byBjcmVhdGUgdGhlIGdpdmVuIGluZGV4LiBSZXR1cm5zCiAg\nICAgKiA8Y29kZT5DUkVBVEUgW1VOSVFVRV0gSU5ERVggJmx0O2luZGV4IG5h\nbWUmZ3Q7IE9OICZsdDt0YWJsZSBuYW1lJmd0OwogICAgICogKCZsdDtjb2wg\nbGlzdCZndDspPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0Q3JlYXRlSW5kZXhTUUwoSW5kZXggaW5kZXgpIHsK\nICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSAiKTsKICAgICAgICBpZiAo\naW5kZXguaXNVbmlxdWUoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiVU5J\nUVVFICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIklOREVYICIpLmFwcGVuZChp\nbmRleC5nZXROYW1lKCkpOwoKICAgICAgICBidWYuYXBwZW5kKCIgT04gIiku\nYXBwZW5kKGdldEZ1bGxOYW1lKGluZGV4LmdldFRhYmxlKCksIGZhbHNlKSk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiICgiKS5hcHBlbmQoU3RyaW5ncy5qb2lu\nKGluZGV4LmdldENvbHVtbnMoKSwgIiwgIikpLgogICAgICAgICAgICBhcHBl\nbmQoIikiKTsKCiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRv\nU3RyaW5nKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNl\ncmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZlbiBpbmRl\neC4gUmV0dXJucwogICAgICogPGNvZGU+RFJPUCBJTkRFWCAmbHQ7aW5kZXgg\nbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXREcm9wSW5kZXhTUUwoSW5kZXggaW5kZXgpIHsKICAg\nICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiRFJPUCBJTkRFWCAiICsgZ2V0\nRnVsbE5hbWUoaW5kZXgpIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZl\nbiBjb2x1bW4gdG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5\nIGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLiBSZXR1cm5zCiAg\nICAgKiA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQURE\nICgmbHQ7Y29sIGRlYyZndDspPC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZENvbHVtblNRTChD\nb2x1bW4gY29sdW1uKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0FsdGVyVGFi\nbGVXaXRoQWRkQ29sdW1uKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmlu\nZ1swXTsKCiAgICAgICAgU3RyaW5nIGRlYyA9IGdldERlY2xhcmVDb2x1bW5T\nUUwoY29sdW1uLCB0cnVlKTsKICAgICAgICBpZiAoZGVjID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsg\nZ2V0RnVsbE5hbWUoY29sdW1uLmdldFRhYmxlKCksIGZhbHNlKSArICIgQURE\nICIgKyBkZWMgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNl\ncmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZlbiBjb2x1\nbW4gZnJvbQogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJy\nYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuIFJldHVybnMKICAgICAq\nIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENP\nTFVNTiAmbHQ7Y29sIG5hbWUmZ3Q7PC9jb2RlPgogICAgICogYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BDb2x1bW5T\nUUwoQ29sdW1uIGNvbHVtbikgewogICAgICAgIGlmICghc3VwcG9ydHNBbHRl\nclRhYmxlV2l0aERyb3BDb2x1bW4pCiAgICAgICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRF\nUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoY29sdW1uLmdl\ndFRhYmxlKCksIGZhbHNlKQogICAgICAgICAgICArICIgRFJPUCBDT0xVTU4g\nIiArIGNvbHVtbiB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gcHJp\nbWFyeSBrZXkgdG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5\nIGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0\ndXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQURE\nCiAgICAgKiAmbHQ7cGsgY29ucyBzcWwgJmd0OzwvY29kZT4gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZFByaW1hcnlL\nZXlTUUwoUHJpbWFyeUtleSBwaykgewogICAgICAgIFN0cmluZyBwa3NxbCA9\nIGdldFByaW1hcnlLZXlDb25zdHJhaW50U1FMKHBrKTsKICAgICAgICBpZiAo\ncGtzcWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxF\nICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShway5nZXRUYWJsZSgpLCBm\nYWxzZSkgKyAiIEFERCAiICsgcGtzcWwgfTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9w\nIHRoZSBnaXZlbiBwcmltYXJ5IGtleSBmcm9tCiAgICAgKiBpdHMgdGFibGUu\nIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBv\ncnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3Rh\nYmxlIG5hbWUmZ3Q7IERST1AgQ09OU1RSQUlOVAogICAgICogJmx0O3BrIG5h\nbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nW10gZ2V0RHJvcFByaW1hcnlLZXlTUUwoUHJpbWFyeUtleSBwaykg\newogICAgICAgIGlmIChway5nZXROYW1lKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxs\nTmFtZShway5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAgKyAiIERS\nT1AgQ09OU1RSQUlOVCAiICsgcGsuZ2V0TmFtZSgpIH07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMg\ndG8gYWRkIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0bwogICAgICogaXRzIHRh\nYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBz\ndXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFMVEVSIFRBQkxFICZs\ndDt0YWJsZSBuYW1lJmd0OyBBREQKICAgICAqICZsdDtmayBjb25zIHNxbCAm\nZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0QWRkRm9yZWlnbktleVNRTChGb3JlaWduS2V5IGZrKSB7CiAg\nICAgICAgU3RyaW5nIGZrU1FMID0gZ2V0Rm9yZWlnbktleUNvbnN0cmFpbnRT\nUUwoZmspOwogICAgICAgIGlmIChma1NRTCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0\ncmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxO\nYW1lKGZrLmdldFRhYmxlKCksIGZhbHNlKSArICIgQUREICIgKyBma1NRTCB9\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNR\nTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGZy\nb20KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlm\nIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8Y29k\nZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgRFJPUCBDT05TVFJB\nSU5UCiAgICAgKiAmbHQ7ZmsgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wRm9yZWlnbktl\neVNRTChGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgaWYgKGZrLmdldE5hbWUo\nKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsK\nICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgog\nICAgICAgICAgICArIGdldEZ1bGxOYW1lKGZrLmdldFRhYmxlKCksIGZhbHNl\nKQogICAgICAgICAgICArICIgRFJPUCBDT05TVFJBSU5UICIgKyBmay5nZXRO\nYW1lKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVj\nbGFyYXRpb24gU1FMIGZvciB0aGUgZ2l2ZW4gY29sdW1uLiBUaGlzIG1ldGhv\nZCBpcyB1c2VkCiAgICAgKiBmb3IgZWFjaCBjb2x1bW4gZnJvbSB3aXRoaW4g\ne0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0gYW5kCiAgICAgKiB7QGxpbmsg\nI2dldEFkZENvbHVtblNRTH0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJp\nbmcgZ2V0RGVjbGFyZUNvbHVtblNRTChDb2x1bW4gY29sLCBib29sZWFuIGFs\ndGVyKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdC\ndWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKGNvbCkuYXBwZW5kKCIgIik7\nCiAgICAgICAgYnVmLmFwcGVuZChnZXRUeXBlTmFtZShjb2wpKTsKCiAgICAg\nICAgLy8gY2FuJ3QgYWRkIGNvbnN0cmFpbnRzIHRvIGEgY29sdW1uIHdlJ3Jl\nIGFkZGluZyBhZnRlciB0YWJsZQogICAgICAgIC8vIGNyZWF0aW9uLCBjYXVz\nZSBzb21lIGRhdGEgbWlnaHQgYWxyZWFkeSBiZSBpbnNlcnRlZAogICAgICAg\nIGlmICghYWx0ZXIpIHsKICAgICAgICAgICAgaWYgKGNvbC5nZXREZWZhdWx0\nU3RyaW5nKCkgIT0gbnVsbCAmJiAhY29sLmlzQXV0b0Fzc2lnbmVkKCkpCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgREVGQVVMVCAiKS5hcHBlbmQo\nY29sLmdldERlZmF1bHRTdHJpbmcoKSk7CiAgICAgICAgICAgIGlmIChjb2wu\naXNOb3ROdWxsKCkpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgTk9U\nIE5VTEwiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbC5pc0F1dG9Bc3Np\nZ25lZCgpKSB7CiAgICAgICAgICAgIGlmICghc3VwcG9ydHNBdXRvQXNzaWdu\nKQogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQt\nYXV0b2Fzc2lnbiIsIHBsYXRmb3JtLCBjb2wpKTsKICAgICAgICAgICAgZWxz\nZSBpZiAoYXV0b0Fzc2lnbkNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChhdXRvQXNzaWduQ2xhdXNlKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwg\nZm9yIHRoZSBnaXZlbiBwcmltYXJ5IGtleS4gVGhpcyBtZXRob2QgaXMKICAg\nICAqIHVzZWQgZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNR\nTH0gYW5kCiAgICAgKiB7QGxpbmsgI2dldEFkZFByaW1hcnlLZXlTUUx9LiBS\nZXR1cm5zCiAgICAgKiA8Y29kZT5DT05TVFJBSU5UICZsdDtwayBuYW1lJmd0\nOyBQUklNQVJZIEtFWSAoJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+CiAgICAg\nKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndFByaW1hcnlLZXlDb25zdHJhaW50U1FMKFByaW1hcnlLZXkgcGspIHsKICAg\nICAgICAvLyBpZiB3ZSBoYXZlIGRpc2FibGVkIHRoZSBjcmVhdGlvbiBvZiBw\ncmltYXJ5IGtleXMsIGFib3J0IGhlcmUKICAgICAgICBpZiAoIWNyZWF0ZVBy\naW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nU3RyaW5nIG5hbWUgPSBway5nZXROYW1lKCk7CiAgICAgICAgaWYgKG5hbWUg\nIT0gbnVsbCAmJiByZXNlcnZlZFdvcmRTZXQuY29udGFpbnMobmFtZS50b1Vw\ncGVyQ2FzZSgpKSkKICAgICAgICAgICAgbmFtZSA9IG51bGw7CgogICAgICAg\nIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAg\nICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVfQkVGT1JFLmVxdWFs\ncyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCJDT05TVFJBSU5UICIpLmFwcGVuZChuYW1lKS5hcHBlbmQoIiAiKTsKICAg\nICAgICBidWYuYXBwZW5kKCJQUklNQVJZIEtFWSAiKTsKICAgICAgICBpZiAo\nbmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9NSUQuZXF1YWxzKGNvbnN0cmFp\nbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQobmFtZSkuYXBw\nZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJp\nbmdzLmpvaW4ocGsuZ2V0Q29sdW1ucygpLCAiLCAiKSkuCiAgICAgICAgICAg\nIGFwcGVuZCgiKSIpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgQ09O\nU19OQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQobmFt\nZSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRo\nZSBnaXZlbiBmb3JlaWduIGtleSwgb3IgbnVsbCBpZiBpdCBpcwogICAgICog\nbm90IHN1cHBvcnRlZC4gVGhpcyBtZXRob2QgaXMgdXNlZCBmcm9tIHdpdGhp\nbgogICAgICoge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0gYW5kIHtAbGlu\nayAjZ2V0QWRkRm9yZWlnbktleVNRTH0uIFJldHVybnMKICAgICAqIDxjb2Rl\nPkNPTlNUUkFJTlQgJmx0O2NvbnMgbmFtZSZndDsgRk9SRUlHTiBLRVkgKCZs\ndDtjb2wgbGlzdCZndDspCiAgICAgKiBSRUZFUkVOQ0VTICZsdDtmb3JlaWdu\nIHRhYmxlJmd0OyAoJmx0O2NvbCBsaXN0Jmd0OykKICAgICAqIFtPTiBERUxF\nVEUgJmx0O2FjdGlvbiZndDtdIFtPTiBVUERBVEUgJmx0O2FjdGlvbiZndDtd\nPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldEZvcmVpZ25LZXlDb25zdHJhaW50U1FMKEZvcmVpZ25LZXkgZmsp\nIHsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChmay5nZXREZWxldGVBY3Rp\nb24oKSA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAoZmsuaXNEZWZlcnJlZCgpICYmICFz\ndXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmICghc3VwcG9ydHNEZWxldGVBY3Rpb24oZmsu\nZ2V0RGVsZXRlQWN0aW9uKCkpCiAgICAgICAgICAgIHx8ICFzdXBwb3J0c1Vw\nZGF0ZUFjdGlvbihmay5nZXRVcGRhdGVBY3Rpb24oKSkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1bW5bXSBsb2NhbHMgPSBmay5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gZm9yZWlnbnMgPSBmay5n\nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICBpbnQgZGVsQWN0aW9u\nSWQgPSBmay5nZXREZWxldGVBY3Rpb24oKTsKICAgICAgICBpZiAoZGVsQWN0\naW9uSWQgPT0gRm9yZWlnbktleS5BQ1RJT05fTlVMTCkgewogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGxvY2Fscy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKGxvY2Fsc1tpXS5pc05vdE51bGwoKSkKICAg\nICAgICAgICAgICAgICAgICBkZWxBY3Rpb25JZCA9IEZvcmVpZ25LZXkuQUNU\nSU9OX05PTkU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFN0\ncmluZyBkZWxBY3Rpb24gPSBnZXRBY3Rpb25OYW1lKGRlbEFjdGlvbklkKTsK\nICAgICAgICBTdHJpbmcgdXBBY3Rpb24gPSBnZXRBY3Rpb25OYW1lKGZrLmdl\ndFVwZGF0ZUFjdGlvbigpKTsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9\nIG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgp\nICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0JFRk9SRS5lcXVh\nbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiQ09OU1RSQUlOVCAiKS5hcHBlbmQoZmsuZ2V0TmFtZSgpKS5hcHBlbmQo\nIiAiKTsKICAgICAgICBidWYuYXBwZW5kKCJGT1JFSUdOIEtFWSAiKTsKICAg\nICAgICBpZiAoZmsuZ2V0TmFtZSgpICE9IG51bGwgJiYgQ09OU19OQU1FX01J\nRC5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZChmay5nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1\nZi5hcHBlbmQoIigiKS5hcHBlbmQoU3RyaW5ncy5qb2luKGxvY2FscywgIiwg\nIikpLmFwcGVuZCgiKSIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiBSRUZFUkVO\nQ0VTICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0RnVsbE5hbWUoZm9yZWln\nbnNbMF0uZ2V0VGFibGUoKSwgZmFsc2UpKTsKICAgICAgICBidWYuYXBwZW5k\nKCIgKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4oZm9yZWlnbnMsICIsICIpKS5h\ncHBlbmQoIikiKTsKICAgICAgICBpZiAoZGVsQWN0aW9uICE9IG51bGwpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiBERUxFVEUgIikuYXBwZW5kKGRl\nbEFjdGlvbik7CiAgICAgICAgaWYgKHVwQWN0aW9uICE9IG51bGwpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiBVUERBVEUgIikuYXBwZW5kKHVwQWN0\naW9uKTsKICAgICAgICBpZiAoZmsuaXNEZWZlcnJlZCgpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgSU5JVElBTExZIERFRkVSUkVEIik7CiAgICAgICAg\naWYgKHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cykKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAoZmsuZ2V0\nTmFtZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0FGVEVS\nLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQoZmsuZ2V0TmFtZSgpKTsK\nICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIGdpdmVuIGZvcmVpZ24g\na2V5IGFjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0QWN0\naW9uTmFtZShpbnQgYWN0aW9uKSB7CiAgICAgICAgc3dpdGNoIChhY3Rpb24p\nIHsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9DQVNDQURF\nOgogICAgICAgICAgICAgICAgcmV0dXJuICJDQVNDQURFIjsKICAgICAgICAg\nICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9OVUxMOgogICAgICAgICAgICAg\nICAgcmV0dXJuICJTRVQgTlVMTCI7CiAgICAgICAgICAgIGNhc2UgRm9yZWln\nbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiAi\nU0VUIERFRkFVTFQiOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGlzIGRhdGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZl\nbiBmb3JlaWduIGtleSBkZWxldGUgYWN0aW9uLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0RlbGV0ZUFjdGlvbihpbnQgYWN0aW9uKSB7\nCiAgICAgICAgaWYgKGFjdGlvbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05F\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIXN1cHBv\ncnRzRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIEZvcmVp\nZ25LZXkuQUNUSU9OX1JFU1RSSUNUOgogICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cHBvcnRzUmVzdHJpY3REZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNh\nc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBwb3J0c0Nhc2NhZGVEZWxldGVBY3Rpb247CiAgICAgICAg\nICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb247CiAgICAgICAg\nICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmF1bHREZWxldGVBY3Rpb247CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\naGlzIGRhdGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBmb3JlaWduIGtleSB1\ncGRhdGUgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c1VwZGF0ZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAgICAgICAgaWYgKGFj\ndGlvbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGFj\ndGlvbikgewogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX1JF\nU1RSSUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzUmVzdHJp\nY3RVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5B\nQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0\nc0Nhc2NhZGVVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWln\nbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBw\nb3J0c051bGxVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWln\nbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBT\nUUwgZm9yIHRoZSBnaXZlbiB1bmlxdWUgY29uc3RyYWludC4gVGhpcwogICAg\nICogbWV0aG9kIGlzIHVzZWQgZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRDcmVh\ndGVUYWJsZVNRTH0uCiAgICAgKiBSZXR1cm5zCTxjb2RlPkNPTlNUUkFJTlQg\nJmx0O25hbWUmZ3Q7IFVOSVFVRSAoJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+\nCiAgICAgKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwoVW5pcXVlIHVucSkgewogICAg\nICAgIGlmICghc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50cwogICAgICAgICAg\nICB8fCAodW5xLmlzRGVmZXJyZWQoKSAmJiAhc3VwcG9ydHNEZWZlcnJlZENv\nbnN0cmFpbnRzKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAg\nICAgaWYgKHVucS5nZXROYW1lKCkgIT0gbnVsbAogICAgICAgICAgICAmJiBD\nT05TX05BTUVfQkVGT1JFLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZCh1\nbnEuZ2V0TmFtZSgpKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5k\nKCJVTklRVUUgIik7CiAgICAgICAgaWYgKHVucS5nZXROYW1lKCkgIT0gbnVs\nbCAmJiBDT05TX05BTUVfTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUp\nKQogICAgICAgICAgICBidWYuYXBwZW5kKHVucS5nZXROYW1lKCkpLmFwcGVu\nZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBlbmQoU3RyaW5n\ncy5qb2luKHVucS5nZXRDb2x1bW5zKCksICIsICIpKS4KICAgICAgICAgICAg\nYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKHVucS5pc0RlZmVycmVkKCkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJTklUSUFMTFkgREVGRVJSRUQiKTsK\nICAgICAgICBpZiAoc3VwcG9ydHNEZWZlcnJlZENvbnN0cmFpbnRzKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgREVGRVJSQUJMRSIpOwogICAgICAgIGlm\nICh1bnEuZ2V0TmFtZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19O\nQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQodW5xLmdl\ndE5hbWUoKSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGF0YWJhc2Ug\nbWV0YWRhdGEKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHRh\nYmxlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRy\ndWUgaWYgdGhlIGdpdmVuIHRhYmxlIG5hbWUgcmVwcmVzZW50cyBhIHN5c3Rl\nbSB0YWJsZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVhciBpbiB0aGUg\nc2NoZW1hIGRlZmluaXRpb24uIEJ5IGRlZmF1bHQsIHJldHVybnMKICAgICAq\nIHRydWUgb25seSBpZiB0aGUgZ2l2ZW4gdGFibGUgaXMgaW4gdGhlIGludGVy\nbmFsIGxpc3Qgb2Ygc3lzdGVtIHRhYmxlcywKICAgICAqIG9yIGlmIHRoZSBn\naXZlbiBzY2hlbWEgaXMgaW4gdGhlIGxpc3Qgb2Ygc3lzdGVtIHNjaGVtYXMg\nYW5kIGlzIG5vdAogICAgICogdGhlIHRhcmdldCBzY2hlbWEuCiAgICAgKgog\nICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxlIG5hbWUKICAgICAqIEBwYXJh\nbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsgbWF5IGJlIG51bGwKICAgICAq\nIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1ZSwgdGhlbiB0aGUgZ2l2ZW4g\nc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAqIHRoZSB1c2VyIGFzIG9uZSBv\nZiBoaXMgc2NoZW1hcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5\nc3RlbVRhYmxlKFN0cmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAogICAgICAg\nIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7CiAgICAgICAgaWYgKHN5c3RlbVRh\nYmxlU2V0LmNvbnRhaW5zKG5hbWUudG9VcHBlckNhc2UoKSkpCiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiAhdGFyZ2V0U2NoZW1h\nICYmIHNjaGVtYSAhPSBudWxsCiAgICAgICAgICAgICYmIHN5c3RlbVNjaGVt\nYVNldC5jb250YWlucyhzY2hlbWEudG9VcHBlckNhc2UoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRlciBz\neXN0ZW0gaW5kZXhlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICog\nUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluZGV4IG5hbWUgcmVwcmVzZW50\ncyBhIHN5c3RlbSBpbmRleCB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVh\nciBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIFJldHVybnMgZmFsc2UgYnkg\nZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgaW5kZXgg\nbmFtZQogICAgICogQHBhcmFtIHRhYmxlIHRoZSBpbmRleCB0YWJsZQogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbUluZGV4KFN0cmluZyBu\nYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gZmls\ndGVyIHN5c3RlbSBzZXF1ZW5jZXMgZnJvbSBkYXRhYmFzZSBtZXRhZGF0YS4K\nICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBzZXF1ZW5jZSByZXBy\nZXNlbnRzIGEgc3lzdGVtIHNlcXVlbmNlIHRoYXQKICAgICAqIHNob3VsZCBu\nb3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gUmV0dXJucyB0\ncnVlIGlmIHN5c3RlbQogICAgICogc2NoZW1hIGJ5IGRlZmF1bHQuCiAgICAg\nKgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxlIG5hbWUKICAgICAqIEBw\nYXJhbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsgbWF5IGJlIG51bGwKICAg\nICAqIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1ZSwgdGhlbiB0aGUgZ2l2\nZW4gc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAqIHRoZSB1c2VyIGFzIG9u\nZSBvZiBoaXMgc2NoZW1hcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc1N5c3RlbVNlcXVlbmNlKFN0cmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAog\nICAgICAgIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7CiAgICAgICAgcmV0dXJu\nICF0YXJnZXRTY2hlbWEgJiYgc2NoZW1hICE9IG51bGwKICAgICAgICAgICAg\nJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5zKHNjaGVtYS50b1VwcGVyQ2Fz\nZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNj\naGVtYSB0byBmaW5kIHRhYmxlcyBtYXRjaGluZyB0aGUgZ2l2ZW4gbmFtZSBw\nYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMgVGFibGVbXSBnZXRUYWJsZXMo\nRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAg\nICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVj\ndGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICghc3VwcG9ydHNTY2hlbWFGb3JHZXRUYWJsZXMpCiAgICAgICAg\nICAgIHNjaGVtYU5hbWUgPSBudWxsOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc2NoZW1hTmFtZSA9IGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShzY2hl\nbWFOYW1lKTsKCiAgICAgICAgU3RyaW5nW10gdHlwZXMgPSBTdHJpbmdzLnNw\nbGl0KHRhYmxlVHlwZXMsICIsIiwgMCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCB0eXBlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgdHlwZXNb\naV0gPSB0eXBlc1tpXS50cmltKCk7CgogICAgICAgIGJlZm9yZU1ldGFkYXRh\nT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCB0YWJsZXMgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRhYmxlcyA9IG1ldGEu\nZ2V0VGFibGVzKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyks\nCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lLCBnZXRUYWJsZU5hbWVGb3JN\nZXRhZGF0YSh0YWJsZU5hbWUpLCB0eXBlcyk7CiAgICAgICAgICAgIExpc3Qg\ndGFibGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGls\nZSAodGFibGVzICE9IG51bGwgJiYgdGFibGVzLm5leHQoKSkKICAgICAgICAg\nICAgICAgIHRhYmxlTGlzdC5hZGQobmV3VGFibGUodGFibGVzKSk7CiAgICAg\nICAgICAgIHJldHVybiAoVGFibGVbXSkgdGFibGVMaXN0LnRvQXJyYXkobmV3\nIFRhYmxlW3RhYmxlTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAodGFibGVzICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHRhYmxlcy5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgdGFibGUgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4g\ndGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFRh\nYmxlIG5ld1RhYmxlKFJlc3VsdFNldCB0YWJsZU1ldGEpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVGFibGUgdCA9IG5ldyBUYWJs\nZSgpOwogICAgICAgIHQuc2V0TmFtZSh0YWJsZU1ldGEuZ2V0U3RyaW5nKCJU\nQUJMRV9OQU1FIikpOwogICAgICAgIHJldHVybiB0OwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgc2VxdWVu\nY2VzIG1hdGNoaW5nIHRoZSBnaXZlbiBuYW1lIHBhdHRlcm4uCiAgICAgKiBS\nZXR1cm5zIGFuIGVtcHR5IGFycmF5IGJ5IGRlZmF1bHQsIGFzIHRoZXJlIGlz\nIG5vIHN0YW5kYXJkIHdheSB0bwogICAgICogcmV0cmlldmUgYSBsaXN0IG9m\nIHNlcXVlbmNlcy4KICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlW10gZ2V0\nU2VxdWVuY2VzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFs\nb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyBzZXF1ZW5j\nZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U2VxdWVuY2VzU1FM\nKHNjaGVtYU5hbWUsIHNlcXVlbmNlTmFtZSk7CiAgICAgICAgaWYgKHN0ciA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFNlcXVlbmNlWzBdOwoK\nICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFy\nZVN0YXRlbWVudChzdHIpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAg\nICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzdG1udC5zZXRTdHJpbmcoaWR4KyssIHNjaGVtYU5hbWUpOwogICAgICAg\nICAgICBpZiAoc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzdG1udC5zZXRTdHJpbmcoaWR4KyssIHNlcXVlbmNlTmFtZSk7CgogICAg\nICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAg\nICBMaXN0IHNlcUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAg\nIHdoaWxlIChycy5uZXh0KCkpCiAgICAgICAgICAgICAgICBzZXFMaXN0LmFk\nZChuZXdTZXF1ZW5jZShycykpOwogICAgICAgICAgICByZXR1cm4gKFNlcXVl\nbmNlW10pIHNlcUxpc3QudG9BcnJheShuZXcgU2VxdWVuY2Vbc2VxTGlzdC5z\naXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\ncnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgcnMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBuZXcgc2VxdWVuY2UgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNj\naGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFNlcXVlbmNl\nIG5ld1NlcXVlbmNlKFJlc3VsdFNldCBzZXF1ZW5jZU1ldGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2VxdWVuY2Ugc2VxID0g\nbmV3IFNlcXVlbmNlKCk7CiAgICAgICAgc2VxLnNldFNjaGVtYU5hbWUoc2Vx\ndWVuY2VNZXRhLmdldFN0cmluZygiU0VRVUVOQ0VfU0NIRU1BIikpOwogICAg\nICAgIHNlcS5zZXROYW1lKHNlcXVlbmNlTWV0YS5nZXRTdHJpbmcoIlNFUVVF\nTkNFX05BTUUiKSk7CiAgICAgICAgcmV0dXJuIHNlcTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgU1FMIG5lZWRlZCB0byBzZWxlY3QgdGhl\nIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldFNlcXVlbmNlc1NRTChTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5n\nIHNlcXVlbmNlTmFtZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQg\nY29sdW1ucyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGFibGUgYW5kCiAgICAgKiBj\nb2x1bW4gcGF0dGVybnMuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBn\nZXRDb2x1bW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFs\nb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5h\nbWUsIFN0cmluZyBjb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFt\nZSA9PSBudWxsICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldENvbHVtbnMp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAoIXN1cHBv\ncnRzU2NoZW1hRm9yR2V0Q29sdW1ucykKICAgICAgICAgICAgc2NoZW1hTmFt\nZSA9IG51bGw7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzY2hlbWFOYW1l\nID0gZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpOwoKICAg\nICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAgICBS\nZXN1bHRTZXQgY29scyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgY29scyA9IG1ldGEuZ2V0Q29sdW1ucyhnZXRDYXRhbG9nTmFtZUZvck1l\ndGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgc2NoZW1hTmFtZSwg\nZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSwKICAgICAgICAg\nICAgICAgIGdldENvbHVtbk5hbWVGb3JNZXRhZGF0YShjb2x1bW5OYW1lKSk7\nCgogICAgICAgICAgICBMaXN0IGNvbHVtbkxpc3QgPSBuZXcgQXJyYXlMaXN0\nKCk7CiAgICAgICAgICAgIHdoaWxlIChjb2xzICE9IG51bGwgJiYgY29scy5u\nZXh0KCkpCiAgICAgICAgICAgICAgICBjb2x1bW5MaXN0LmFkZChuZXdDb2x1\nbW4oY29scykpOwogICAgICAgICAgICByZXR1cm4gKENvbHVtbltdKSBjb2x1\nbW5MaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgQ29sdW1uW2Nv\nbHVtbkxpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgaWYgKGNvbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgY29scy5jbG9zZSgpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBu\nZXcgY29sdW1uIGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2x1bW4gbmV3Q29s\ndW1uKFJlc3VsdFNldCBjb2xNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIENvbHVtbiBjID0gbmV3IENvbHVtbigpOwogICAg\nICAgIGMuc2V0U2NoZW1hTmFtZShjb2xNZXRhLmdldFN0cmluZygiVEFCTEVf\nU0NIRU0iKSk7CiAgICAgICAgYy5zZXRUYWJsZU5hbWUoY29sTWV0YS5nZXRT\ndHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAgICAgYy5zZXROYW1lKGNvbE1l\ndGEuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpKTsKICAgICAgICBjLnNldFR5\ncGUoY29sTWV0YS5nZXRJbnQoIkRBVEFfVFlQRSIpKTsKICAgICAgICBjLnNl\ndFR5cGVOYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJUWVBFX05BTUUiKSk7CiAg\nICAgICAgYy5zZXRTaXplKGNvbE1ldGEuZ2V0SW50KCJDT0xVTU5fU0laRSIp\nKTsKICAgICAgICBjLnNldERlY2ltYWxEaWdpdHMoY29sTWV0YS5nZXRJbnQo\nIkRFQ0lNQUxfRElHSVRTIikpOwogICAgICAgIGMuc2V0Tm90TnVsbChjb2xN\nZXRhLmdldEludCgiTlVMTEFCTEUiKQogICAgICAgICAgICA9PSBEYXRhYmFz\nZU1ldGFEYXRhLmNvbHVtbk5vTnVsbHMpOwoKICAgICAgICBTdHJpbmcgZGVm\nID0gY29sTWV0YS5nZXRTdHJpbmcoIkNPTFVNTl9ERUYiKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoZGVmKSAmJiAhIm51bGwiLmVxdWFs\nc0lnbm9yZUNhc2UoZGVmKSkKICAgICAgICAgICAgYy5zZXREZWZhdWx0U3Ry\naW5nKGRlZik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtl\neXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBw\ndWJsaWMgUHJpbWFyeUtleVtdIGdldFByaW1hcnlLZXlzKERhdGFiYXNlTWV0\nYURhdGEgbWV0YSwKICAgICAgICBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNl\nR2V0QmVzdFJvd0lkZW50aWZpZXJGb3JQcmltYXJ5S2V5cykKICAgICAgICAg\nICAgcmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUJlc3RSb3dJZGVudGlmaWVy\nKG1ldGEsIGNhdGFsb2csCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lLCB0\nYWJsZU5hbWUsIGNvbm4pOwogICAgICAgIHJldHVybiBnZXRQcmltYXJ5S2V5\nc0Zyb21HZXRQcmltYXJ5S2V5cyhtZXRhLCBjYXRhbG9nLAogICAgICAgICAg\nICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFy\neSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21H\nZXRQcmltYXJ5S2V5cwogICAgICAgIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEs\nIFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwKICAgICAgICAg\nICAgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUg\nPT0gbnVsbCAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRQcmltYXJ5S2V5\ncykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1l\ndGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBwa3Mg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBrcyA9IG1ldGEu\nZ2V0UHJpbWFyeUtleXMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRh\nbG9nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0\nYShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFtZUZv\nck1ldGFkYXRhKHRhYmxlTmFtZSkpOwoKICAgICAgICAgICAgTGlzdCBwa0xp\nc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChwa3Mg\nIT0gbnVsbCAmJiBwa3MubmV4dCgpKQogICAgICAgICAgICAgICAgcGtMaXN0\nLmFkZChuZXdQcmltYXJ5S2V5KHBrcykpOwogICAgICAgICAgICByZXR1cm4g\nKFByaW1hcnlLZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAg\nIChuZXcgUHJpbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBwa3MuY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHByaW1hcnkga2V5IGZyb20gdGhlIGluZm9ybWF0\naW9uIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBQcmltYXJ5S2V5IG5ld1ByaW1hcnlLZXkoUmVzdWx0U2V0IHBrTWV0\nYSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBQcmlt\nYXJ5S2V5IHBrID0gbmV3IFByaW1hcnlLZXkoKTsKICAgICAgICBway5zZXRT\nY2hlbWFOYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIikpOwog\nICAgICAgIHBrLnNldFRhYmxlTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJUQUJM\nRV9OQU1FIikpOwogICAgICAgIHBrLnNldENvbHVtbk5hbWUocGtNZXRhLmdl\ndFN0cmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAgcGsuc2V0TmFtZShw\na01ldGEuZ2V0U3RyaW5nKCJQS19OQU1FIikpOwogICAgICAgIHJldHVybiBw\nazsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVt\nYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVuIHRhYmxlIHBh\ndHRlcm4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5W10gZ2V0\nUHJpbWFyeUtleXNGcm9tQmVzdFJvd0lkZW50aWZpZXIKICAgICAgICAoRGF0\nYWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNj\naGVtYU5hbWUsCiAgICAgICAgICAgIFN0cmluZyB0YWJsZU5hbWUsIENvbm5l\nY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAodGFibGVOYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25u\nKTsKICAgICAgICBSZXN1bHRTZXQgcGtzID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBwa3MgPSBtZXRhLmdldEJlc3RSb3dJZGVudGlmaWVy\nKGNhdGFsb2csIHNjaGVtYU5hbWUsCiAgICAgICAgICAgICAgICB0YWJsZU5h\nbWUsIDAsIGZhbHNlKTsKCiAgICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAocGtzICE9IG51bGwg\nJiYgcGtzLm5leHQoKSkgewogICAgICAgICAgICAgICAgUHJpbWFyeUtleSBw\nayA9IG5ldyBQcmltYXJ5S2V5KCk7CiAgICAgICAgICAgICAgICBway5zZXRT\nY2hlbWFOYW1lKHNjaGVtYU5hbWUpOwogICAgICAgICAgICAgICAgcGsuc2V0\nVGFibGVOYW1lKHRhYmxlTmFtZSk7CiAgICAgICAgICAgICAgICBway5zZXRD\nb2x1bW5OYW1lKHBrcy5nZXRTdHJpbmcoIkNPTFVNTl9OQU1FIikpOwogICAg\nICAgICAgICAgICAgcGtMaXN0LmFkZChwayk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcmV0dXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5\nCiAgICAgICAgICAgICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUo\nKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChwa3Mg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgcGtzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBm\naW5kIGluZGV4ZXMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4u\nCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleFtdIGdldEluZGV4SW5mbyhEYXRh\nYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0\ncmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBib29sZWFuIHVu\naXF1ZSwKICAgICAgICBib29sZWFuIGFwcHJveCwgQ29ubmVjdGlvbiBjb25u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0\nYWJsZU5hbWUgPT0gbnVsbCAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJ\nbmRleEluZm8pCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBi\nZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRT\nZXQgaW5kZXhlcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naW5kZXhlcyA9IG1ldGEuZ2V0SW5kZXhJbmZvKGdldENhdGFsb2dOYW1lRm9y\nTWV0YWRhdGEoY2F0YWxvZyksCiAgICAgICAgICAgICAgICBnZXRTY2hlbWFO\nYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgICAgICBn\nZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0YWJsZU5hbWUpLCB1bmlxdWUsIGFw\ncHJveCk7CgogICAgICAgICAgICBMaXN0IGluZGV4TGlzdCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGluZGV4ZXMgIT0gbnVsbCAm\nJiBpbmRleGVzLm5leHQoKSkKICAgICAgICAgICAgICAgIGluZGV4TGlzdC5h\nZGQobmV3SW5kZXgoaW5kZXhlcykpOwogICAgICAgICAgICByZXR1cm4gKElu\nZGV4W10pIGluZGV4TGlzdC50b0FycmF5KG5ldyBJbmRleFtpbmRleExpc3Qu\nc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKGluZGV4ZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgaW5kZXhlcy5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\naW5kZXggZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIEluZGV4IG5ld0luZGV4KFJl\nc3VsdFNldCBpZHhNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIEluZGV4IGlkeCA9IG5ldyBJbmRleCgpOwogICAgICAgIGlk\neC5zZXRTY2hlbWFOYW1lKGlkeE1ldGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hF\nTSIpKTsKICAgICAgICBpZHguc2V0VGFibGVOYW1lKGlkeE1ldGEuZ2V0U3Ry\naW5nKCJUQUJMRV9OQU1FIikpOwogICAgICAgIGlkeC5zZXRDb2x1bW5OYW1l\nKGlkeE1ldGEuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpKTsKICAgICAgICBp\nZHguc2V0TmFtZShpZHhNZXRhLmdldFN0cmluZygiSU5ERVhfTkFNRSIpKTsK\nICAgICAgICBpZHguc2V0VW5pcXVlKCFpZHhNZXRhLmdldEJvb2xlYW4oIk5P\nTl9VTklRVUUiKSk7CiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byByZXR1cm4gZm9y\nZWlnbiBrZXlzIGltcG9ydGVkIGJ5IHRoZSBnaXZlbgogICAgICogdGFibGUg\ncGF0dGVybi4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXlbXSBnZXRJ\nbXBvcnRlZEtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0\nYWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxl\nTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICghc3VwcG9ydHNGb3JlaWduS2V5cykKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9\nPSBudWxsICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldEltcG9ydGVkS2V5\ncykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1l\ndGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBrZXlz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBrZXlzID0gbWV0\nYS5nZXRJbXBvcnRlZEtleXMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShj\nYXRhbG9nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRh\nZGF0YShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFt\nZUZvck1ldGFkYXRhKHRhYmxlTmFtZSkpOwoKICAgICAgICAgICAgTGlzdCBp\nbXBvcnRlZEtleUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAg\nIHdoaWxlIChrZXlzICE9IG51bGwgJiYga2V5cy5uZXh0KCkpCiAgICAgICAg\nICAgICAgICBpbXBvcnRlZEtleUxpc3QuYWRkKG5ld0ZvcmVpZ25LZXkoa2V5\ncykpOwogICAgICAgICAgICByZXR1cm4gKEZvcmVpZ25LZXlbXSkgaW1wb3J0\nZWRLZXlMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgRm9yZWln\nbktleVtpbXBvcnRlZEtleUxpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKGtleXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAga2V5cy5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgZm9yZWlnbiBrZXkgZnJvbSB0aGUgaW5mb3JtYXRp\nb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIEZvcmVpZ25LZXkgbmV3Rm9yZWlnbktleShSZXN1bHRTZXQgZmtNZXRh\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEZvcmVp\nZ25LZXkgZmsgPSBuZXcgRm9yZWlnbktleSgpOwogICAgICAgIGZrLnNldFNj\naGVtYU5hbWUoZmtNZXRhLmdldFN0cmluZygiRktUQUJMRV9TQ0hFTSIpKTsK\nICAgICAgICBmay5zZXRUYWJsZU5hbWUoZmtNZXRhLmdldFN0cmluZygiRktU\nQUJMRV9OQU1FIikpOwogICAgICAgIGZrLnNldENvbHVtbk5hbWUoZmtNZXRh\nLmdldFN0cmluZygiRktDT0xVTU5fTkFNRSIpKTsKICAgICAgICBmay5zZXRO\nYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZLX05BTUUiKSk7CiAgICAgICAgZmsu\nc2V0UHJpbWFyeUtleVNjaGVtYU5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtU\nQUJMRV9TQ0hFTSIpKTsKICAgICAgICBmay5zZXRQcmltYXJ5S2V5VGFibGVO\nYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBLVEFCTEVfTkFNRSIpKTsKICAgICAg\nICBmay5zZXRQcmltYXJ5S2V5Q29sdW1uTmFtZShma01ldGEuZ2V0U3RyaW5n\nKCJQS0NPTFVNTl9OQU1FIikpOwogICAgICAgIGZrLnNldEtleVNlcXVlbmNl\nKGZrTWV0YS5nZXRJbnQoIktFWV9TRVEiKSk7CiAgICAgICAgZmsuc2V0RGVm\nZXJyZWQoZmtNZXRhLmdldEludCgiREVGRVJSQUJJTElUWSIpCiAgICAgICAg\nICAgID09IERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlE\nZWZlcnJlZCk7CgogICAgICAgIGludCBkZWwgPSBma01ldGEuZ2V0SW50KCJE\nRUxFVEVfUlVMRSIpOwogICAgICAgIHN3aXRjaCAoZGVsKSB7CiAgICAgICAg\nICAgIGNhc2UgRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleVNldE51bGw6\nCiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktl\neS5BQ1RJT05fTlVMTCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBEYXRhYmFzZU1ldGFEYXRhLmltcG9ydGVkS2V5U2V0RGVm\nYXVsdDoKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihGb3Jl\naWduS2V5LkFDVElPTl9ERUZBVUxUKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRL\nZXlDYXNjYWRlOgogICAgICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9u\nKEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NBREUpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBm\nay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Qp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmazsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHRh\nYmxlIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZv\ncm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0VGFibGVOYW1lRm9y\nTWV0YWRhdGEoU3RyaW5nIHRhYmxlTmFtZSkgewogICAgICAgIHJldHVybiBj\nb252ZXJ0U2NoZW1hQ2FzZSh0YWJsZU5hbWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgc2NoZW1hIG5hbWUgdGhhdCB3aWxsIGJlIHVz\nZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxp\nbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKFN0cmluZyBzY2hlbWFO\nYW1lKSB7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgPT0gbnVsbCkKICAgICAg\nICAgICAgc2NoZW1hTmFtZSA9IGNvbmYuZ2V0U2NoZW1hKCk7CiAgICAgICAg\ncmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKHNjaGVtYU5hbWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY2F0YWxvZyBuYW1lIHRoYXQg\nd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAq\nIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nIGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoU3Ry\naW5nIGNhdGFsb2dOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hl\nbWFDYXNlKGNhdGFsb2dOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdGhlIGNvbHVtbiBuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBv\nYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFi\nYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndENvbHVtbk5hbWVGb3JNZXRhZGF0YShTdHJpbmcgY29sdW1uTmFtZSkgewog\nICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZShjb2x1bW5OYW1lKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBz\nY2hlbWEgbmFtZSB0byBhIG5hbWUgdGhhdCB0aGUgZGF0YWJhc2Ugd2lsbAog\nICAgICogYmUgYWJsZSB0byB1bmRlcnN0YW5kLgogICAgICovCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIGNvbnZlcnRTY2hlbWFDYXNlKFN0cmluZyBvYmplY3RO\nYW1lKSB7CiAgICAgICAgaWYgKG9iamVjdE5hbWUgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmIChTQ0hFTUFfQ0FTRV9M\nT1dFUi5lcXVhbHMoc2NoZW1hQ2FzZSkpCiAgICAgICAgICAgIHJldHVybiBv\nYmplY3ROYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9D\nQVNFX1BSRVNFUlZFLmVxdWFscyhzY2hlbWFDYXNlKSkKICAgICAgICAgICAg\ncmV0dXJuIG9iamVjdE5hbWU7CiAgICAgICAgcmV0dXJuIG9iamVjdE5hbWUu\ndG9VcHBlckNhc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmVk\nIHRoZSBjb25uZWN0aW9uIGZvciBtZXRhZGF0YSBvcGVyYXRpb25zLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24o\nQ29ubmVjdGlvbiBjKSB7CiAgICAgICAgaWYgKHJlcXVpcmVzQXV0b0NvbW1p\ndEZvck1ldGFEYXRhKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBjLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGlmICghYy5nZXRBdXRvQ29tbWl0KCkpCiAg\nICAgICAgICAgICAgICAgICAgYy5zZXRBdXRvQ29tbWl0KHRydWUpOwogICAg\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FsZSkgewogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBTZXF1ZW5jZXMgYW5kIEF1dG8tQXNzaWdu\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBsYXN0IGdlbmVyYXRlZCB2YWx1ZSBmb3IgdGhl\nIGdpdmVuIGNvbHVtbi4KICAgICAqIFRocm93cyBhbiBleGNlcHRpb24gYnkg\nZGVmYXVsdCBpZiB7QGxpbmsgI2xhc3RHZW5lcmF0ZWRLZXlRdWVyeX0gaXMg\nbnVsbC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRHZW5lcmF0ZWRL\nZXkoQ29sdW1uIGNvbCwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChsYXN0R2VuZXJhdGVkS2V5\nUXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1hdXRvLWFzc2lnbiIpKTsKCiAgICAgICAg\nLy8gcmVwbGFjZSB0aGluZ3MgbGlrZSAiU0VMRUNUIE1BWCh7MH0pIEZST00g\nezF9IgogICAgICAgIFN0cmluZyBxdWVyeSA9IGxhc3RHZW5lcmF0ZWRLZXlR\ndWVyeTsKICAgICAgICBpZiAocXVlcnkuaW5kZXhPZigneycpICE9IC0xKSAv\nLyBvbmx5IGlmIHRoZSB0b2tlbiBpcyBpbiB0aGUgc3RyaW5nCiAgICAgICAg\newogICAgICAgICAgICBxdWVyeSA9IE1lc3NhZ2VGb3JtYXQuZm9ybWF0KHF1\nZXJ5LCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICBjb2wuZ2V0TmFt\nZSgpLCBnZXRGdWxsTmFtZShjb2wuZ2V0VGFibGUoKSwgZmFsc2UpLAogICAg\nICAgICAgICAgICAgZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCks\nCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQocXVlcnkp\nOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAg\nICAgICAgaWYgKCFycy5uZXh0KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWdlbmtleSIpKTsKICAg\nICAgICAgICAgT2JqZWN0IGtleSA9IHJzLmdldE9iamVjdCgxKTsKICAgICAg\nICAgICAgaWYgKGtleSA9PSBudWxsKQogICAgICAgICAgICAgICAgbG9nLndh\ncm4oX2xvYy5nZXQoImludmFsaWQtZ2Vua2V5IiwgY29sKSk7CiAgICAgICAg\nICAgIHJldHVybiBrZXk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBycy5j\nbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAg\nICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkge30gCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBzZXF1ZW5jZSBuYW1lIHVzZWQgYnkgZGF0YWJhc2VzIGZvciB0\naGUgZ2l2ZW4gYXV0b2Fzc2lnbmVkCiAgICAgKiBjb2x1bW4uIFRoaXMgaXMg\nb25seSB1c2VkIGJ5IGRhdGFiYXNlcyB0aGF0IHJlcXVpcmUgYW4gZXhwbGlj\naXQgbmFtZQogICAgICogdG8gYmUgdXNlZCBmb3IgYXV0by1hc3NpZ24gc3Vw\ncG9ydC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRHZW5lcmF0\nZWRLZXlTZXF1ZW5jZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIFN0cmlu\nZyB0bmFtZSA9IGNvbC5nZXRUYWJsZU5hbWUoKTsKICAgICAgICBTdHJpbmcg\nY25hbWUgPSBjb2wuZ2V0TmFtZSgpOwogICAgICAgIGludCBtYXggPSBtYXhB\ndXRvQXNzaWduTmFtZUxlbmd0aDsKICAgICAgICBpbnQgZXh0cmFDaGFycyA9\nIC1tYXggKyB0bmFtZS5sZW5ndGgoKSArIDEgLy8gPHRuYW1lPiArICdfJwog\nICAgICAgICAgICArIGNuYW1lLmxlbmd0aCgpICsgNDsgLy8gPGNuYW1lPiAr\nICdfU0VRJwogICAgICAgIGlmIChleHRyYUNoYXJzID4gMCkgewogICAgICAg\nICAgICAvLyB0aGlzIGFzc3VtZXMgdGhhdCB0bmFtZSBpcyBsb25nZXIgdGhh\nbiBleHRyYUNoYXJzCiAgICAgICAgICAgIHRuYW1lID0gdG5hbWUuc3Vic3Ry\naW5nKDAsIHRuYW1lLmxlbmd0aCgpIC0gZXh0cmFDaGFycyk7CiAgICAgICAg\nfQogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVy\nKG1heCk7CiAgICAgICAgYnVmLmFwcGVuZCh0bmFtZSkuYXBwZW5kKCJfIiku\nYXBwZW5kKGNuYW1lKS5hcHBlbmQoIl9TRVEiKTsKICAgICAgICByZXR1cm4g\nYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uZmlndXJhYmxlIGltcGxlbWVudGF0\naW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHVibGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNv\nbmYpIHsKICAgICAgICB0aGlzLmNvbmYgPSAoSkRCQ0NvbmZpZ3VyYXRpb24p\nIGNvbmY7CiAgICAgICAgdGhpcy5sb2cgPSB0aGlzLmNvbmYuZ2V0TG9nKEpE\nQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKCiAgICAgICAgLy8gd2FybiBh\nYm91dCB1bnN1cHBvcnRlZCBkaWN0cwogICAgICAgIGlmIChsb2cuaXNXYXJu\nRW5hYmxlZCgpICYmICFpc1N1cHBvcnRlZCgpKQogICAgICAgICAgICBsb2cu\nd2FybihfbG9jLmdldCgiZGljdC1ub3Qtc3VwcG9ydGVkIiwgZ2V0Q2xhc3Mo\nKSkpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBpc1N1cHBvcnRlZCgp\nIHsKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgY3VzdG9tIGRpY3QsIHRyYXZl\ncnNlIHRvIHdoYXRldmVyIG9wZW5qcGEgZGljdCBpdCBleHRlbmRzCiAgICAg\nICAgQ2xhc3MgYyA9IGdldENsYXNzKCk7CiAgICAgICAgd2hpbGUgKCFjLmdl\ndE5hbWUoKS5zdGFydHNXaXRoKCJvcmcuYXBhY2hlLm9wZW5qcGEuIikpCiAg\nICAgICAgICAgIGMgPSBjLmdldFN1cGVyY2xhc3MoKTsKCiAgICAgICAgLy8g\ndGhlIGdlbmVyaWMgZGJkaWN0aW9uYXJ5IGlzIG5vdCBjb25zaWRlcmVkIGEg\nc3VwcG9ydGVkIGRpY3Q7IGFsbAogICAgICAgIC8vIG90aGVyIGNvbmNyZXRl\nIGRpY3Rpb25hcmllcyBhcmUKICAgICAgICBpZiAoYyA9PSBEQkRpY3Rpb25h\ncnkuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZp\nZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmln\ndXJhdGlvbigpIHsKICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzZXQgb2Yg\ncmVzZXJ2ZWQgU1FMOTIgd29yZHMgZnJvbSByZXNvdXJjZQogICAgICAgIElu\ncHV0U3RyZWFtIGluID0gREJEaWN0aW9uYXJ5LmNsYXNzLmdldFJlc291cmNl\nQXNTdHJlYW0KICAgICAgICAgICAgKCJzcWwta2V5d29yZHMucnNyYyIpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZyBrZXl3b3JkcyA9IG5l\ndyBCdWZmZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1SZWFkZXIoaW4pKS4K\nICAgICAgICAgICAgICAgIHJlYWRMaW5lKCk7CiAgICAgICAgICAgIGluLmNs\nb3NlKCk7CiAgICAgICAgICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwoQXJy\nYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoa2V5\nd29yZHMsICIsIiwgMCkpKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpb2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24oaW9lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkg\neyBpbi5jbG9zZSgpOyB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7fQogICAg\nICAgIH0KCiAgICAgICAgLy8gYWRkIGFkZGl0aW9uYWwgcmVzZXJ2ZWQgd29y\nZHMgc2V0IGJ5IHVzZXIKICAgICAgICBpZiAocmVzZXJ2ZWRXb3JkcyAhPSBu\ndWxsKQogICAgICAgICAgICByZXNlcnZlZFdvcmRTZXQuYWRkQWxsKEFycmF5\ncy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKHJlc2Vy\ndmVkV29yZHMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwoKICAgICAgICAv\nLyBhZGQgc3lzdGVtIHNjaGVtYXMgc2V0IGJ5IHVzZXIKICAgICAgICBpZiAo\nc3lzdGVtU2NoZW1hcyAhPSBudWxsKQogICAgICAgICAgICBzeXN0ZW1TY2hl\nbWFTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAg\nICAgICAgICAgICAgKHN5c3RlbVNjaGVtYXMudG9VcHBlckNhc2UoKSwgIiwi\nLCAwKSkpOwoKICAgICAgICAvLyBhZGQgc3lzdGVtIHRhYmxlcyBzZXQgYnkg\ndXNlcgogICAgICAgIGlmIChzeXN0ZW1UYWJsZXMgIT0gbnVsbCkKICAgICAg\nICAgICAgc3lzdGVtVGFibGVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3Ry\naW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKHN5c3RlbVRhYmxlcy50b1Vw\ncGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBmaXhlZCBz\naXplIHR5cGUgbmFtZXMgc2V0IGJ5IHRoZSB1c2VyCiAgICAgICAgaWYgKGZp\neGVkU2l6ZVR5cGVOYW1lcyAhPSBudWxsKQogICAgICAgICAgICBmaXhlZFNp\nemVUeXBlTmFtZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNw\nbGl0CiAgICAgICAgICAgICAgICAoZml4ZWRTaXplVHlwZU5hbWVzLnRvVXBw\nZXJDYXNlKCksICIsIiwgMCkpKTsKCiAgICAgICAgLy8gaWYgdXNlciBoYXMg\ndW5zZXQgc2VxdWVuY2Ugc3FsLCBudWxsIGl0IG91dCBzbyB3ZSBrbm93IHNl\ncXVlbmNlcwogICAgICAgIC8vIGFyZW4ndCBzdXBwb3J0ZWQKICAgICAgICBu\nZXh0U2VxdWVuY2VRdWVyeSA9IFN0cmluZ1V0aWxzLnRyaW1Ub051bGwobmV4\ndFNlcXVlbmNlUXVlcnkpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25uZWN0aW9uRGVjb3Jh\ndG9yIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogRGVjb3JhdGUgdGhl\nIGdpdmVuIGNvbm5lY3Rpb24gaWYgbmVlZGVkLiBTb21lIGRhdGFiYXNlcyBy\nZXF1aXJlIHNwZWNpYWwKICAgICAqIGhhbmRsaW5nIGZvciBKREJDIGJ1Z3Mu\nIFRoaXMgaW1wbGVtZW50YXRpb24gaXNzdWVzIGFueQogICAgICoge0BsaW5r\nICNpbml0aWFsaXphdGlvblNRTH0gdGhhdCBoYXMgYmVlbiBzZXQgZm9yIHRo\nZSBkaWN0aW9uYXJ5IGJ1dAogICAgICogZG9lcyBub3QgZGVjb3JlYXRlIHRo\nZSBjb25uZWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgQ29ubmVjdGlvbiBk\nZWNvcmF0ZShDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKCFjb25uZWN0ZWQpCiAgICAgICAgICAg\nIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KGluaXRpYWxpemF0aW9uU1FMKSkgewogICAg\nICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdG1udCA9IGNvbm4ucHJl\ncGFyZVN0YXRlbWVudChpbml0aWFsaXphdGlvblNRTCk7CiAgICAgICAgICAg\nICAgICBzdG1udC5leGVjdXRlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKGUudG9T\ndHJpbmcoKSwgZSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBzdG1udC5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkgewogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gY29ubjsKICAgIH0KCiAgICAvKioKICAg\nICAqIEltcGxlbWVudGF0aW9uIG9mIHRoZQogICAgICoge0BsaW5rIExvZ2dp\nbmdDb25uZWN0aW9uRGVjb3JhdG9yLlNRTFdhcm5pbmdIYW5kbGVyfSBpbnRl\ncmZhY2UKICAgICAqIHRoYXQgYWxsb3dzIGN1c3RvbWl6YXRpb24gb2YgdGhl\nIGFjdGlvbnMgdG8gcGVyZm9ybSB3aGVuIGEKICAgICAqIHtAbGluayBTUUxX\nYXJuaW5nfSBvY2N1cnMgYXQgYW55IHBvaW50IG9uIGEge0BsaW5rIENvbm5l\nY3Rpb259LAogICAgICoge0BsaW5rIFN0YXRlbWVudH0sIG9yIHtAbGluayBS\nZXN1bHRTZXR9LiBUaGlzIG1ldGhvZCBtYXkKICAgICAqIGJlIHVzZWQgZGV0\nZXJtaW5lIHRob3NlIHdhcm5pbmdzIHRoZSBhcHBsaWNhdGlvbiB3YW50cyB0\nbwogICAgICogY29uc2lkZXIgY3JpdGljYWwgZmFpbHVyZXMsIGFuZCB0aHJv\ndyB0aGUgd2FybmluZyBpbiB0aG9zZQogICAgICogY2FzZXMuIEJ5IGRlZmF1\nbHQsIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZy4KICAgICAqCiAgICAgKiBA\nc2VlIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yI3NldFdhcm5pbmdBY3Rp\nb24KICAgICAqIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3Ijc2V0\nV2FybmluZ0hhbmRsZXIKICAgICAqLwogICAgcHVibGljIHZvaWQgaGFuZGxl\nV2FybmluZyhTUUxXYXJuaW5nIHdhcm5pbmcpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBu\nZXcgZXhjZXB0aW9uIHRoYXQgd3JhcHMgPGNvZGU+Y2F1c2VzPC9jb2RlPi4K\nICAgICAqIEhvd2V2ZXIsIHRoZSBkZXRhaWxzIG9mIGV4YWN0bHkgd2hhdCB0\neXBlIG9mIGV4Y2VwdGlvbiBpcyByZXR1cm5lZCBjYW4KICAgICAqIGJlIGRl\ndGVybWluZWQgYnkgdGhlIGltcGxlbWVudGF0aW9uLiBUaGlzIG1heSB0YWtl\nIGludG8gYWNjb3VudAogICAgICogREItc3BlY2lmaWMgZXhjZXB0aW9uIGlu\nZm9ybWF0aW9uIGluIDxjb2RlPmNhdXNlczwvY29kZT4uCiAgICAgKi8KICAg\nIHB1YmxpYyBPcGVuSlBBRXhjZXB0aW9uIG5ld1N0b3JlRXhjZXB0aW9uKFN0\ncmluZyBtc2csIFNRTEV4Y2VwdGlvbltdIGNhdXNlcywKICAgICAgICBPYmpl\nY3QgZmFpbGVkKSB7CiAgICAgICAgaWYgKGNhdXNlcy5sZW5ndGggPiAwICYm\nICIyMzAwMCIuZXF1YWxzKGNhdXNlc1swXS5nZXRTUUxTdGF0ZSgpKSkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBSZWZlcmVudGlhbEludGVncml0eUV4Y2Vw\ndGlvbihtc2cpLgogICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGZh\naWxlZCkuc2V0TmVzdGVkVGhyb3dhYmxlcyhjYXVzZXMpOwogICAgICAgIHJl\ndHVybiBuZXcgU3RvcmVFeGNlcHRpb24obXNnKS5zZXRGYWlsZWRPYmplY3Qo\nZmFpbGVkKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyhjYXVz\nZXMpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2VzIHRoZSBzcGVjaWZp\nZWQge0BsaW5rIERhdGFTb3VyY2V9IGFuZCByZWxlYXNlcyBhbnkKICAgICAq\nIHJlc291cmNlcyBhc3NvY2lhdGVkIHdpdGggaXQuCiAgICAgKgogICAgICog\nQHBhcmFtIGRhdGFTb3VyY2UgdGhlIERhdGFTb3VyY2UgdG8gY2xvc2UKICAg\nICAqLwogICAgcHVibGljIHZvaWQgY2xvc2VEYXRhU291cmNlKERhdGFTb3Vy\nY2UgZGF0YVNvdXJjZSkgewogICAgICAgIERhdGFTb3VyY2VGYWN0b3J5LmNs\nb3NlRGF0YVNvdXJjZShkYXRhU291cmNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzZWQgYnkgc29tZSBtYXBwaW5ncyB0byByZXByZXNlbnQgZGF0YSB0\naGF0IGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHNlcmlhbGl6ZWQgc28gdGhh\ndCB3ZSBkb24ndCBoYXZlIHRvIHNlcmlhbGl6ZSBtdWx0aXBsZSB0aW1lcy4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBTZXJpYWxpemVkRGF0\nYSB7CgogICAgICAgIHB1YmxpYyBmaW5hbCBieXRlW10gYnl0ZXM7CgogICAg\nICAgIHB1YmxpYyBTZXJpYWxpemVkRGF0YShieXRlW10gYnl0ZXMpIHsKICAg\nICAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwogICAgICAgIH0KICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdmVyc2lvbiBjb2x1bW4gbmFt\nZQogICAgICogQHBhcmFtIGNvbHVtbgogICAgICogQHBhcmFtIHRhYmxlQWxp\nYXMgOiB0aGlzIGlzIG5lZWRlZCBmb3IgcGxhdGZvcm0gc3BlY2lmaWMgdmVy\nc2lvbiBjb2x1bW4KICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRWZXJzaW9uQ29sdW1uKENvbHVtbiBjb2x1bW4sIFN0cmlu\nZyB0YWJsZUFsaWFzKSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbi50b1N0cmlu\nZygpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEF0dGFjaCBDQVNUIHRv\nIHRoZSBjdXJyZW50IGZ1bmN0aW9uIGlmIG5lY2Vzc2FyeQogICAgICogCiAg\nICAgKiBAcGFyYW0gdmFsIG9wZXJhbmQgdmFsdWUKICAgICAqIEBwYXJtYSBm\ndW5jIHRoZSBzcWwgZnVuY3Rpb24gc3RhdGVtZW50CiAgICAgKiBAcmV0dXJu\nIGEgU3RyaW5nIHdpdGggdGhlIGNvcnJlY3QgQ0FTVCBmdW5jdGlvbiBzeW50\nYXgKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDYXN0RnVuY3Rpb24o\nVmFsIHZhbCwgU3RyaW5nIGZ1bmMpIHsKICAgICAgICByZXR1cm4gZnVuYzsK\nICAgIH0KICAgCn0K\n","encoding":"base64"}

