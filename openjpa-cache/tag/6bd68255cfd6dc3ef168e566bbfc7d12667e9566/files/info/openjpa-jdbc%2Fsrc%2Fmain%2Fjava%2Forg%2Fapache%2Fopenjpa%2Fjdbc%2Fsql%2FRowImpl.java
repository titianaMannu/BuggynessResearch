{"sha":"a4f4a5f2ada23253ca68be9ea3702d1cff7561bb","node_id":"MDQ6QmxvYjIwNjM2NDphNGY0YTVmMmFkYTIzMjUzY2E2OGJlOWVhMzcwMmQxY2ZmNzU2MWJi","size":28908,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a4f4a5f2ada23253ca68be9ea3702d1cff7561bb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5t\nYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLm1hdGguQmlnSW50ZWdlcjsK\naW1wb3J0IGphdmEuc3FsLkFycmF5OwppbXBvcnQgamF2YS5zcWwuQmxvYjsK\naW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJl\nZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7\nCmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5Mb2NhbGU7CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkpvaW5hYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5SZWxhdGlv\nbklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNv\nbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5D\nb2x1bW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVt\nYmVyczsKCi8qKgogKiBCYXNpYyB7QGxpbmsgUm93fSBpbXBsZW1lbnRhdGlv\nbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFJvd0ltcGwKICAgIGltcGxlbWVudHMgUm93LCBDbG9u\nZWFibGUgewoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgT2JqZWN0IE5V\nTEwgPSBuZXcgT2JqZWN0KCk7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBWQUxJRCA9IDIgPDwgMDsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBpbnQgUkFXID0gSW50ZWdlci5NSU5fVkFMVUU7CgogICAgcHJvdGVjdGVk\nIGJ5dGUgZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBmaW5hbCBDb2x1bW5bXSBf\nY29sczsKICAgIHByaXZhdGUgZmluYWwgaW50IF9hY3Rpb247CiAgICBwcml2\nYXRlIGZpbmFsIE9iamVjdFtdIF92YWxzOwogICAgcHJpdmF0ZSBmaW5hbCBp\nbnRbXSBfdHlwZXM7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3NxbCA9IG51bGw7\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBA\ncGFyYW0gdGFibGUgdGhlIHRhYmxlIHRoZSByb3cgaXMgYSBwYXJ0IG9mCiAg\nICAgKiBAcGFyYW0gYWN0aW9uIHRoZSBhY3Rpb24gb24gdGhlIHJvdwogICAg\nICovCiAgICBwdWJsaWMgUm93SW1wbChUYWJsZSB0YWJsZSwgaW50IGFjdGlv\nbikgewogICAgICAgIHRoaXModGFibGUuZ2V0Q29sdW1ucygpLCBhY3Rpb24p\nOwogICAgfQoKICAgIHByb3RlY3RlZCBSb3dJbXBsKENvbHVtbltdIGNvbHMs\nIGludCBhY3Rpb24pIHsKICAgICAgICBfY29scyA9IGNvbHM7CiAgICAgICAg\nX2FjdGlvbiA9IGFjdGlvbjsKCiAgICAgICAgLy8gd2UgbmVlZCByb29tIGZv\nciB2YWx1ZXMgYW5kIHR5cGVzIGZvciBhbGwgY29sdW1uczsgaWYgYW4gdXBk\nYXRlIG9yCiAgICAgICAgLy8gZGVsZXRlLCB0aGVuIHdlIG5lZWQgdG8gZG91\nYmxlIHRoYXQgZm9yIHdoZXJlIGNvbHVtbiBjb25kaXRpb25zCiAgICAgICAg\naW50IGxlbiA9IF9jb2xzLmxlbmd0aDsKICAgICAgICBpZiAoYWN0aW9uICE9\nIEFDVElPTl9JTlNFUlQpCiAgICAgICAgICAgIGxlbiAqPSAyOwogICAgICAg\nIF92YWxzID0gbmV3IE9iamVjdFtsZW5dOwogICAgICAgIF90eXBlcyA9IG5l\ndyBpbnRbbGVuXTsKICAgIH0KCiAgICBwdWJsaWMgVGFibGUgZ2V0VGFibGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9jb2xzWzBdLmdldFRhYmxlKCk7CiAgICB9\nCgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoKSB7CiAgICAgICAg\ncmV0dXJuIF9jb2xzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzVmFsaWQoKSB7CiAgICAgICAgcmV0dXJuIChmbGFncyAm\nIFZBTElEKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFZhbGlk\nKGJvb2xlYW4gdmFsaWQpIHsKICAgICAgICBpZiAodmFsaWQpCiAgICAgICAg\nICAgIGZsYWdzIHw9IFZBTElEOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nZmxhZ3MgJj0gflZBTElEOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBp\nbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCB0cmFjayBwcmltYXJ5IGtleXMuCiAg\nICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGdldFByaW1h\ncnlLZXkoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IHRyYWNrIGZh\naWxlZCBvYmplY3RzLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldEZh\naWxlZE9iamVjdCgpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24gZG9lcyBub3QgdHJh\nY2sgZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEZhaWxlZE9iamVjdChPYmplY3QgZmFpbGVkKSB7CiAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZWNvbmRhcnkgcm93cyBjYW5ub3QgYmUgZGVwZW5kZW50LgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlcGVuZGVudCgpIHsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZhbHVlIHNldCBmb3IgdXBkYXRlIG9uIHRoZSBnaXZlbiBjb2x1bW4uCiAg\nICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0U2V0KENvbHVtbiBjb2wpIHsK\nICAgICAgICByZXR1cm4gX3ZhbHNbZ2V0U2V0SW5kZXgoY29sKV07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIHNldCBmb3Igd2hl\ncmUgb24gdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIE9i\namVjdCBnZXRXaGVyZShDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIF92\nYWxzW2dldFdoZXJlSW5kZXgoY29sKV07CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0UHJpbWFyeUtleShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldFByaW1hcnlL\nZXkobnVsbCwgc20pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFByaW1h\ncnlLZXkoQ29sdW1uSU8gaW8sIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmx1c2hQcmlt\nYXJ5S2V5KHNtLCBpbywgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nd2hlcmVQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmx1c2hQcmltYXJ5\nS2V5KHNtLCBudWxsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBG\nbHVzaCB0aGUgcHJpbWFyeSBrZXkgdmFsdWVzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZmx1c2hQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIENvbHVtbklPIGlvLAogICAgICAgIGJvb2xlYW4gc2V0KQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAg\nICAgICB3aGlsZSAobWFwcGluZy5nZXRUYWJsZSgpICE9IGdldFRhYmxlKCkp\nCiAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBwaW5nLmdldFBDU3VwZXJjbGFz\nc01hcHBpbmcoKTsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gbWFwcGluZy5n\nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGZsdXNoSm9pblZhbHVl\ncyhzbSwgY29scywgY29scywgaW8sIHNldCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Rm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldEZvcmVpZ25LZXkoZmssIG51bGwsIHNtKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIENv\nbHVtbklPIGlvLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmx1c2hGb3Jl\naWduS2V5KGZrLCBpbywgc20sIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGZsdXNoRm9yZWlnbktleShmaywgbnVsbCwgc20sIGZhbHNlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGEgY2lyY3VsYXIgZm9yZWln\nbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyRm9yZWlnbktl\neShGb3JlaWduS2V5IGZrKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIF9zcWwgPSBudWxsOwogICAgICAgIENvbHVtbltdIGNvbHMg\nPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBfdmFsc1tnZXRTZXRJ\nbmRleChjb2xzW2ldKV0gPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nRmx1c2ggdGhlIGZvcmVpZ24ga2V5IHZhbHVlcy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGZsdXNoRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBDb2x1\nbW5JTyBpbywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29s\nZWFuIHNldCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBmbHVzaEpvaW5WYWx1ZXMoc20sIGZrLmdldFByaW1hcnlLZXlDb2x1bW5z\nKCksIGZrLmdldENvbHVtbnMoKSwKICAgICAgICAgICAgaW8sIHNldCk7CiAg\nICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1uW10g\nY29scyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwogICAgICAgICAgICBp\nbnQgbGVuID0gZmsuZ2V0Q29sdW1ucygpLmxlbmd0aDsKICAgICAgICAgICAg\nT2JqZWN0IG9iajsKICAgICAgICAgICAgaW50IHR5cGU7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgb2JqID0gZmsuZ2V0Q29uc3RhbnQoY29sc1tpXSk7CiAg\nICAgICAgICAgICAgICB0eXBlID0gY29sc1tpXS5nZXRKYXZhVHlwZSgpOwog\nICAgICAgICAgICAgICAgaWYgKHNldCAmJiBjYW5TZXQoaW8sIGkgKyBsZW4s\nIG9iaiA9PSBudWxsKSkKICAgICAgICAgICAgICAgICAgICBzZXRPYmplY3Qo\nY29sc1tpXSwgb2JqLCB0eXBlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBl\nbHNlIGlmICghc2V0KQogICAgICAgICAgICAgICAgICAgIHdoZXJlT2JqZWN0\nKGNvbHNbaV0sIG9iaiwgdHlwZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCB0aGUgZ2l2ZW4gaW5zdGFu\nY2UgdmFsdWUgdG8gdGhlIGdpdmVuIGNvbHVtbnMuIE5vdGUgdGhhdAogICAg\nICogZm9yZWlnbiBrZXlzIG1heSBpbmNsdWRlIGNvbHVtbnMgYWxzbyBtYXBw\nZWQgYnkgc2ltcGxlIHZhbHVlcy4gV2UKICAgICAqIHVzZSBhIHByaW9yaXR5\nIG1lY2hhbmlzbSB0byBlbnN1cmUgdGhhdCB3ZSBkbyBub3QgbGV0IHRoZSBu\ndWxsaW5nCiAgICAgKiBvZiBhIGZvcmVpZ24ga2V5IG51bGwgY29sdW1ucyBh\nbHNvIG93bmVkIGJ5IHNpbXBsZSB2YWx1ZXMuCiAgICAgKgogICAgICogQHBh\ncmFtIHRvIHRoZSBpbnN0YW5jZSBiZWluZyBqb2luZWQgdG8KICAgICAqIEBw\nYXJhbSB0b0NvbHMgdGhlIGNvbHVtbnMgYmVpbmcgam9pbmVkIHRvCiAgICAg\nKiBAcGFyYW0gZnJvbUNvbHMgdGhlIGNvbHVtbnMgYmVpbmcgam9pbmVkIGZy\nb20KICAgICAqIEBwYXJhbSBpbyBpbmZvcm1hdGlvbiBhYm91dCBJL08gY2Fw\nYWJpbGl0aWVzIGluIHRoaXMgY29udGV4dAogICAgICogQHBhcmFtIHNldCB3\naGV0aGVyIHRoaXMgc2hvdWxkIGJlIGZsdXNoZWQgYXMgYW4gdXBkYXRlIG9y\nCiAgICAgKiBhcyBhIHdoZXJlIGNvbmRpdGlvbgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZmx1c2hKb2luVmFsdWVzKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\ndG8sIENvbHVtbltdIHRvQ29scywKICAgICAgICBDb2x1bW5bXSBmcm9tQ29s\ncywgQ29sdW1uSU8gaW8sIGJvb2xlYW4gc2V0KQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0byA9PSBudWxsKSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbUNvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChzZXQgJiYgY2FuU2V0KGlvLCBp\nLCB0cnVlKSkKICAgICAgICAgICAgICAgICAgICBzZXROdWxsKGZyb21Db2xz\nW2ldKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFzZXQpCiAgICAgICAg\nICAgICAgICAgICAgd2hlcmVOdWxsKGZyb21Db2xzW2ldKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlm\nIChzZXQgJiYgIWNhblNldEFueShpbywgZnJvbUNvbHMubGVuZ3RoLCBmYWxz\nZSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHRvTWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHRvLmdldE1ldGFEYXRhKCk7\nCiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBPYmplY3QgdmFsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdG9Db2xzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIC8vIGRvbid0IGV2ZW4gdHJhbnNsYXRlIGpvaW4g\ndmFsdWUgaWYgdW5zZXR0YWJsZQogICAgICAgICAgICBpZiAoc2V0KSB7CiAg\nICAgICAgICAgICAgICBpZiAoX2FjdGlvbiA9PSBBQ1RJT05fSU5TRVJUICYm\nIGZyb21Db2xzW2ldLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIWNhblNldChp\nbywgaSwgZmFsc2UpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBqb2luID0gdG9NYXBwaW5nLmFz\nc2VydEpvaW5hYmxlKHRvQ29sc1tpXSk7CiAgICAgICAgICAgIHZhbCA9IGpv\naW4uZ2V0Sm9pblZhbHVlKHRvLCB0b0NvbHNbaV0sIChKREJDU3RvcmUpIHRv\nLgogICAgICAgICAgICAgICAgZ2V0Q29udGV4dCgpLmdldFN0b3JlTWFuYWdl\ncigpLmdldElubmVybW9zdERlbGVnYXRlKCkpOwogICAgICAgICAgICBpZiAo\nc2V0ICYmIHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoY2Fu\nU2V0KGlvLCBpLCB0cnVlKSkKICAgICAgICAgICAgICAgICAgICBzZXROdWxs\nKGZyb21Db2xzW2ldKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzZXQgJiYg\ndmFsIGluc3RhbmNlb2YgUmF3KQogICAgICAgICAgICAgICAgc2V0UmF3KGZy\nb21Db2xzW2ldLCB2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKHNldCkKICAgICAgICAgICAgICAgIHNldE9iamVjdChmcm9tQ29sc1tp\nXSwgdmFsLCB0b0NvbHNbaV0uZ2V0SmF2YVR5cGUoKSwgZmFsc2UpOwogICAg\nICAgICAgICBlbHNlIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHdoZXJlTnVsbChmcm9tQ29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIFJhdykKICAgICAgICAgICAgICAgIHdoZXJlUmF3\nKGZyb21Db2xzW2ldLCB2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIHdoZXJlT2JqZWN0KGZyb21Db2xzW2ldLCB2\nYWwsIHRvQ29sc1tpXS5nZXRKYXZhVHlwZSgpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBhbnkgb2YgdGhlIGdp\ndmVuIGNvbHVtbiBpbmRleGVzIGFyZSBzZXR0YWJsZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gY2FuU2V0QW55KENvbHVtbklPIGlvLCBpbnQg\naSwgYm9vbGVhbiBudWxsVmFsdWUpIHsKICAgICAgICBpZiAoaW8gPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9hY3Rp\nb24gPT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgcmV0dXJuIGlvLmlz\nQW55SW5zZXJ0YWJsZShpLCBudWxsVmFsdWUpOwogICAgICAgIGlmIChfYWN0\naW9uID09IEFDVElPTl9VUERBVEUpCiAgICAgICAgICAgIHJldHVybiBpby5p\nc0FueVVwZGF0YWJsZShpLCBudWxsVmFsdWUpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhl\nIGdpdmVuIGNvbHVtbiBpbmRleCBpcyBzZXR0YWJsZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gY2FuU2V0KENvbHVtbklPIGlvLCBpbnQgaSwg\nYm9vbGVhbiBudWxsVmFsdWUpIHsKICAgICAgICBpZiAoaW8gPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9hY3Rpb24g\nPT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgcmV0dXJuIGlvLmlzSW5z\nZXJ0YWJsZShpLCBudWxsVmFsdWUpOwogICAgICAgIGlmIChfYWN0aW9uID09\nIEFDVElPTl9VUERBVEUpCiAgICAgICAgICAgIHJldHVybiBpby5pc1VwZGF0\nYWJsZShpLCBudWxsVmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlbGF0aW9uSWQoQ29sdW1uIGNvbCwg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBSZWxhdGlvbklkIHJl\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRP\nYmplY3QoY29sLCByZWwudG9SZWxhdGlvbkRhdGFTdG9yZVZhbHVlKHNtLCBj\nb2wpLAogICAgICAgICAgICBjb2wuZ2V0SmF2YVR5cGUoKSwgZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYSBjaXJjdWxhciByZWxhdGlv\nbiBpZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXJSZWxhdGlvbklk\nKENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgX3NxbCA9IG51bGw7CiAgICAgICAgX3ZhbHNbZ2V0U2V0SW5kZXgo\nY29sKV0gPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEFycmF5\nKENvbHVtbiBjb2wsIEFycmF5IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCB2YWwsIEphdmFTUUxU\neXBlcy5BUlJBWSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndEFzY2lpU3RyZWFtKENvbHVtbiBjb2wsIElucHV0U3RyZWFtIHZhbCwgaW50\nIGxlbmd0aCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzZXRPYmplY3QoY29sLCAodmFsID09IG51bGwpID8gbnVsbCA6IG5ldyBT\naXplZCh2YWwsIGxlbmd0aCksCiAgICAgICAgICAgIEphdmFTUUxUeXBlcy5B\nU0NJSV9TVFJFQU0sIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRCaWdEZWNpbWFsKENvbHVtbiBjb2wsIEJpZ0RlY2ltYWwgdmFsKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChj\nb2wsIHZhbCwgSmF2YVR5cGVzLkJJR0RFQ0lNQUwsIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdJbnRlZ2VyKENvbHVtbiBjb2wsIEJp\nZ0ludGVnZXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLkJJR0lOVEVH\nRVIsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRCaW5hcnlT\ndHJlYW0oQ29sdW1uIGNvbCwgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVuZ3Ro\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9i\namVjdChjb2wsICh2YWwgPT0gbnVsbCkgPyBudWxsIDogbmV3IFNpemVkKHZh\nbCwgbGVuZ3RoKSwKICAgICAgICAgICAgSmF2YVNRTFR5cGVzLkJJTkFSWV9T\nVFJFQU0sIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRCbG9i\nKENvbHVtbiBjb2wsIEJsb2IgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVNRTFR5\ncGVzLkJMT0IsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRC\nb29sZWFuKENvbHVtbiBjb2wsIGJvb2xlYW4gdmFsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsICgodmFs\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpLAogICAgICAgICAg\nICBKYXZhVHlwZXMuQk9PTEVBTiwgZmFsc2UpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEJ5dGUoQ29sdW1uIGNvbCwgYnl0ZSB2YWwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwg\nbmV3IEJ5dGUodmFsKSwgSmF2YVR5cGVzLkJZVEUsIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRCeXRlcyhDb2x1bW4gY29sLCBieXRlW10g\ndmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndE9iamVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLkJZVEVTLCBmYWxzZSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FsZW5kYXIoQ29sdW1uIGNv\nbCwgQ2FsZW5kYXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLkNBTEVO\nREFSLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2hhcihD\nb2x1bW4gY29sLCBjaGFyIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBuZXcgQ2hhcmFjdGVyKHZh\nbCksIEphdmFUeXBlcy5DSEFSLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKENvbHVtbiBjb2wsIFJlYWRlciB2\nYWwsIGludCBsZW5ndGgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc2V0T2JqZWN0KGNvbCwgKHZhbCA9PSBudWxsKSA/IG51bGwg\nOiBuZXcgU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAgICBKYXZhU1FM\nVHlwZXMuQ0hBUl9TVFJFQU0sIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRDbG9iKENvbHVtbiBjb2wsIENsb2IgdmFsKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZh\nbCwgSmF2YVNRTFR5cGVzLkNMT0IsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXREYXRlKENvbHVtbiBjb2wsIERhdGUgdmFsKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2ws\nIHZhbCwgSmF2YVR5cGVzLkRBVEUsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXREYXRlKENvbHVtbiBjb2wsIGphdmEuc3FsLkRhdGUgdmFs\nLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICBpZiAodmFsID09IG51bGwg\nfHwgY2FsID09IG51bGwpCiAgICAgICAgICAgIG9iaiA9IHZhbDsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIG9iaiA9IG5ldyBDYWxlbmRhcmQodmFsLCBj\nYWwpOwogICAgICAgIHNldE9iamVjdChjb2wsIG9iaiwgSmF2YVNRTFR5cGVz\nLlNRTF9EQVRFLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRG91YmxlKENvbHVtbiBjb2wsIGRvdWJsZSB2YWwpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgbmV3IERv\ndWJsZSh2YWwpLCBKYXZhVHlwZXMuRE9VQkxFLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0RmxvYXQoQ29sdW1uIGNvbCwgZmxvYXQgdmFs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9i\namVjdChjb2wsIG5ldyBGbG9hdCh2YWwpLCBKYXZhVHlwZXMuRkxPQVQsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJbnQoQ29sdW1uIGNv\nbCwgaW50IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBzZXRPYmplY3QoY29sLCBOdW1iZXJzLnZhbHVlT2YodmFsKSwgSmF2\nYVR5cGVzLklOVCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndExvbmcoQ29sdW1uIGNvbCwgbG9uZyB2YWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgTnVtYmVycy52\nYWx1ZU9mKHZhbCksIEphdmFUeXBlcy5MT05HLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0TG9jYWxlKENvbHVtbiBjb2wsIExvY2FsZSB2\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0\nT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuTE9DQUxFLCBmYWxzZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0TnVsbChDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE51bGwoY29s\nLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TnVsbChDb2x1\nbW4gY29sLCBib29sZWFuIG92ZXJyaWRlRGVmYXVsdCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBudWxs\nLCBjb2wuZ2V0SmF2YVR5cGUoKSwgb3ZlcnJpZGVEZWZhdWx0KTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXROdW1iZXIoQ29sdW1uIGNvbCwgTnVtYmVy\nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBz\nZXRPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5OVU1CRVIsIGZhbHNlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSYXcoQ29sdW1uIGNvbCwgU3Ry\naW5nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzZXRPYmplY3QoY29sLCB2YWwsIFJBVywgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFNob3J0KENvbHVtbiBjb2wsIHNob3J0IHZhbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmpl\nY3QoY29sLCBuZXcgU2hvcnQodmFsKSwgSmF2YVR5cGVzLlNIT1JULCBmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3RyaW5nKENvbHVtbiBj\nb2wsIFN0cmluZyB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuU1RSSU5H\nLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VGltZShDb2x1\nbW4gY29sLCBUaW1lIHZhbCwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAg\naWYgKHZhbCA9PSBudWxsIHx8IGNhbCA9PSBudWxsKQogICAgICAgICAgICBv\nYmogPSB2YWw7CiAgICAgICAgZWxzZQogICAgICAgICAgICBvYmogPSBuZXcg\nQ2FsZW5kYXJkKHZhbCwgY2FsKTsKICAgICAgICBzZXRPYmplY3QoY29sLCBv\nYmosIEphdmFTUUxUeXBlcy5USU1FLCBmYWxzZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0VGltZXN0YW1wKENvbHVtbiBjb2wsIFRpbWVzdGFtcCB2\nYWwsIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgIGlmICh2YWwgPT0gbnVs\nbCB8fCBjYWwgPT0gbnVsbCkKICAgICAgICAgICAgb2JqID0gdmFsOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgb2JqID0gbmV3IENhbGVuZGFyZCh2YWws\nIGNhbCk7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgb2JqLCBKYXZhU1FMVHlw\nZXMuVElNRVNUQU1QLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0T2JqZWN0KENvbHVtbiBjb2wsIE9iamVjdCB2YWwpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9m\nIFJhdykKICAgICAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBSQVcsIGZh\nbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldE9iamVjdChjb2ws\nIHZhbCwgY29sLmdldEphdmFUeXBlKCksIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB3aGVyZUFycmF5KENvbHVtbiBjb2wsIEFycmF5IHZhbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9i\namVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgd2hlcmVBc2NpaVN0cmVhbShDb2x1bW4gY29s\nLCBJbnB1dFN0cmVhbSB2YWwsIGludCBsZW5ndGgpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCAodmFs\nID09IG51bGwpID8gbnVsbCA6IG5ldyBTaXplZCh2YWwsIGxlbmd0aCksCiAg\nICAgICAgICAgIEphdmFTUUxUeXBlcy5BU0NJSV9TVFJFQU0pOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHdoZXJlQmlnRGVjaW1hbChDb2x1bW4gY29sLCBC\naWdEZWNpbWFsIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLkJJR0RF\nQ0lNQUwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQmlnSW50ZWdl\ncihDb2x1bW4gY29sLCBCaWdJbnRlZ2VyIHZhbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwg\nSmF2YVR5cGVzLkJJR0lOVEVHRVIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlQmluYXJ5U3RyZWFtKENvbHVtbiBjb2wsIElucHV0U3RyZWFtIHZh\nbCwgaW50IGxlbmd0aCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICB3aGVyZU9iamVjdChjb2wsICh2YWwgPT0gbnVsbCkgPyBudWxs\nIDogbmV3IFNpemVkKHZhbCwgbGVuZ3RoKSwKICAgICAgICAgICAgSmF2YVNR\nTFR5cGVzLkJJTkFSWV9TVFJFQU0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlQmxvYihDb2x1bW4gY29sLCBCbG9iIHZhbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZh\nbCwgSmF2YVNRTFR5cGVzLkJMT0IpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlQm9vbGVhbihDb2x1bW4gY29sLCBib29sZWFuIHZhbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChj\nb2wsICgodmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpLAog\nICAgICAgICAgICBKYXZhVHlwZXMuQk9PTEVBTik7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVCeXRlKENvbHVtbiBjb2wsIGJ5dGUgdmFsKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0\nKGNvbCwgbmV3IEJ5dGUodmFsKSwgSmF2YVR5cGVzLkJZVEUpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHdoZXJlQnl0ZXMoQ29sdW1uIGNvbCwgYnl0ZVtd\nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3\naGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVNRTFR5cGVzLkJZVEVTKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUNhbGVuZGFyKENvbHVtbiBjb2ws\nIENhbGVuZGFyIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLkNBTEVO\nREFSKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUNoYXIoQ29sdW1u\nIGNvbCwgY2hhciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgd2hlcmVPYmplY3QoY29sLCBuZXcgQ2hhcmFjdGVyKHZhbCks\nIEphdmFUeXBlcy5DSEFSKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVy\nZUNoYXJhY3RlclN0cmVhbShDb2x1bW4gY29sLCBSZWFkZXIgdmFsLCBpbnQg\nbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHdoZXJlT2JqZWN0KGNvbCwgKHZhbCA9PSBudWxsKSA/IG51bGwgOiBuZXcg\nU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAgICBKYXZhU1FMVHlwZXMu\nQ0hBUl9TVFJFQU0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQ2xv\nYihDb2x1bW4gY29sLCBDbG9iIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVNR\nTFR5cGVzLkNMT0IpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlRGF0\nZShDb2x1bW4gY29sLCBEYXRlIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVR5\ncGVzLkRBVEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlRGF0ZShD\nb2x1bW4gY29sLCBqYXZhLnNxbC5EYXRlIHZhbCwgQ2FsZW5kYXIgY2FsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIE9iamVjdCBv\nYmo7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsIHx8IGNhbCA9PSBudWxsKQog\nICAgICAgICAgICBvYmogPSB2YWw7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBvYmogPSBuZXcgQ2FsZW5kYXJkKHZhbCwgY2FsKTsKICAgICAgICB3aGVy\nZU9iamVjdChjb2wsIG9iaiwgSmF2YVNRTFR5cGVzLlNRTF9EQVRFKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZURvdWJsZShDb2x1bW4gY29sLCBk\nb3VibGUgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgbmV3IERvdWJsZSh2YWwpLCBKYXZhVHlw\nZXMuRE9VQkxFKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUZsb2F0\nKENvbHVtbiBjb2wsIGZsb2F0IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIG5ldyBGbG9hdCh2\nYWwpLCBKYXZhVHlwZXMuRkxPQVQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlSW50KENvbHVtbiBjb2wsIGludCB2YWwpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCBOdW1i\nZXJzLnZhbHVlT2YodmFsKSwgSmF2YVR5cGVzLklOVCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVMb25nKENvbHVtbiBjb2wsIGxvbmcgdmFsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2Jq\nZWN0KGNvbCwgTnVtYmVycy52YWx1ZU9mKHZhbCksIEphdmFUeXBlcy5MT05H\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUxvY2FsZShDb2x1bW4g\nY29sLCBMb2NhbGUgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuTE9D\nQUxFKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZU51bGwoQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3\naGVyZU9iamVjdChjb2wsIG51bGwsIGNvbC5nZXRKYXZhVHlwZSgpKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZU51bWJlcihDb2x1bW4gY29sLCBO\ndW1iZXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuTlVNQkVSKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVJhdyhDb2x1bW4gY29sLCBT\ndHJpbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBSQVcpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHdoZXJlU2hvcnQoQ29sdW1uIGNvbCwgc2hvcnQgdmFsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2Jq\nZWN0KGNvbCwgbmV3IFNob3J0KHZhbCksIEphdmFUeXBlcy5TSE9SVCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVTdHJpbmcoQ29sdW1uIGNvbCwg\nU3RyaW5nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLlNUUklORyk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVUaW1lKENvbHVtbiBjb2ws\nIFRpbWUgdmFsLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICBpZiAodmFs\nID09IG51bGwgfHwgY2FsID09IG51bGwpCiAgICAgICAgICAgIG9iaiA9IHZh\nbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG9iaiA9IG5ldyBDYWxlbmRh\ncmQodmFsLCBjYWwpOwogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgb2JqLCBK\nYXZhU1FMVHlwZXMuVElNRSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmVUaW1lc3RhbXAoQ29sdW1uIGNvbCwgVGltZXN0YW1wIHZhbCwgQ2FsZW5k\nYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIE9iamVjdCBvYmo7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsIHx8IGNhbCA9\nPSBudWxsKQogICAgICAgICAgICBvYmogPSB2YWw7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBvYmogPSBuZXcgQ2FsZW5kYXJkKHZhbCwgY2FsKTsKICAg\nICAgICB3aGVyZU9iamVjdChjb2wsIG9iaiwgSmF2YVNRTFR5cGVzLlRJTUVT\nVEFNUCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVPYmplY3QoQ29s\ndW1uIGNvbCwgT2JqZWN0IHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgUmF3KQogICAgICAg\nICAgICB3aGVyZU9iamVjdChjb2wsIHZhbCwgUkFXKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBjb2wuZ2V0SmF2\nYVR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGwgc2V0IGNvbHVt\nbiBtZXRob2RzIGRlbGVnYXRlIHRvIHRoaXMgb25lLiBTZXQgdGhlIGdpdmVu\nIG9iamVjdAogICAgICogdW5sZXNzIHRoaXMgaXMgYW4gaW5zZXJ0IGFuZCB0\naGUgZ2l2ZW4gY29sdW1uIGlzIGF1dG8tYXNzaWduZWQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHNldE9iamVjdChDb2x1bW4gY29sLCBPYmplY3Qg\ndmFsLCBpbnQgbWV0YVR5cGUsCiAgICAgICAgYm9vbGVhbiBvdmVycmlkZURl\nZmF1bHQpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gbmV2ZXIgc2V0IGF1dG8gaW5jcmVtZW50IGNvbHVtbnMgYW5kIGhvbm9y\nIGNvbHVtbiBkZWZhdWx0cwogICAgICAgIGlmIChfYWN0aW9uID09IEFDVElP\nTl9JTlNFUlQpIHsKICAgICAgICAgICAgaWYgKGNvbC5pc0F1dG9Bc3NpZ25l\nZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAo\nIW92ZXJyaWRlRGVmYXVsdCAmJiB2YWwgPT0gbnVsbCAKICAgICAgICAgICAg\nICAgICYmIGNvbC5nZXREZWZhdWx0U3RyaW5nKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA9\nPSBudWxsICYmIGNvbC5pc05vdE51bGwoKSkKICAgICAgICAgICAgdmFsID0g\nSmF2YVNRTFR5cGVzLmdldEVtcHR5VmFsdWUoY29sLmdldEphdmFUeXBlKCkp\nOwogICAgICAgIGZsdXNoKGNvbCwgdmFsLCBtZXRhVHlwZSwgdHJ1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGwgd2hlcmUgY29sdW1uIG1ldGhvZHMg\nZGVsZWdhdGUgdG8gdGhpcyBvbmUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIHdoZXJlT2JqZWN0KENvbHVtbiBjb2wsIE9iamVjdCB2YWwsIGludCBt\nZXRhVHlwZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBmbHVzaChjb2wsIHZhbCwgbWV0YVR5cGUsIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEZsdXNoIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHNldCBv\nciB3aGVyZSBjb25kaXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBm\nbHVzaChDb2x1bW4gY29sLCBPYmplY3QgdmFsLCBpbnQgbWV0YVR5cGUsIGJv\nb2xlYW4gc2V0KSB7CiAgICAgICAgaW50IGlkeCA9IChzZXQpID8gZ2V0U2V0\nSW5kZXgoY29sKSA6IGdldFdoZXJlSW5kZXgoY29sKTsKICAgICAgICBfdHlw\nZXNbaWR4XSA9IG1ldGFUeXBlOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkK\nICAgICAgICAgICAgX3ZhbHNbaWR4XSA9IE5VTEw7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfdmFsc1tpZHhdID0gdmFsOwogICAgICAgIGlmIChzZXQg\nfHwgX2FjdGlvbiA9PSBBQ1RJT05fREVMRVRFKQogICAgICAgICAgICBzZXRW\nYWxpZCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nU1FMIGZvciB0aGUgb3BlcmF0aW9uIG9uIHRoaXMgcm93LgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFNRTChEQkRpY3Rpb25hcnkgZGljdCkgewog\nICAgICAgIGlmICghaXNWYWxpZCgpKQogICAgICAgICAgICByZXR1cm4gIiI7\nCiAgICAgICAgaWYgKF9zcWwgPT0gbnVsbCkKICAgICAgICAgICAgX3NxbCA9\nIGdlbmVyYXRlU1FMKGRpY3QpOwogICAgICAgIHJldHVybiBfc3FsOwogICAg\nfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIFNRTCBmb3IgdGhpcyBy\nb3c7IHRoZSByZXN1bHQgb2YgdGhpcyBtZXRob2QgaXMgY2FjaGVkLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdlbmVyYXRlU1FMKERCRGljdGlv\nbmFyeSBkaWN0KSB7CiAgICAgICAgc3dpdGNoIChnZXRBY3Rpb24oKSkgewog\nICAgICAgICAgICBjYXNlIEFDVElPTl9VUERBVEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0VXBkYXRlU1FMKGRpY3QpOwogICAgICAgICAgICBjYXNl\nIEFDVElPTl9JTlNFUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0SW5z\nZXJ0U1FMKGRpY3QpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldERlbGV0ZVNRTChkaWN0KTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgYSBwcmVw\nYXJlZCBzdGF0ZW1lbnQgdXBkYXRlIG9uIHRoaXMgcm93LgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyBnZXRVcGRhdGVTUUwoREJEaWN0aW9uYXJ5IGRp\nY3QpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1\nZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlVQREFURSAiKS5hcHBlbmQo\nZGljdC5nZXRGdWxsTmFtZShnZXRUYWJsZSgpLCBmYWxzZSkpLgogICAgICAg\nICAgICBhcHBlbmQoIiBTRVQgIik7CgogICAgICAgIGJvb2xlYW4gaGFzVmFs\nID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoX3ZhbHNbaV0gPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgaWYg\nKGhhc1ZhbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoX2NvbHNbaV0pOwogICAgICAgICAgICBp\nZiAoX3R5cGVzW2ldID09IFJBVykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiA9ICIpLmFwcGVuZChfdmFsc1tpXSk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ID8iKTsKICAgICAgICAg\nICAgaGFzVmFsID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGFwcGVuZFdo\nZXJlKGJ1ZiwgZGljdCk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBTUUwgZm9yIGEg\ncHJlcGFyZWQgc3RhdGVtZW50IGluc2VydCBvbiB0aGlzIHJvdy4KICAgICAq\nLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0SW5zZXJ0U1FMKERCRGljdGlvbmFy\neSBkaWN0KSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJp\nbmdCdWZmZXIoKTsKICAgICAgICBTdHJpbmdCdWZmZXIgdmFscyA9IG5ldyBT\ndHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJJTlNFUlQgSU5U\nTyAiKS4KICAgICAgICAgICAgYXBwZW5kKGRpY3QuZ2V0RnVsbE5hbWUoZ2V0\nVGFibGUoKSwgZmFsc2UpKS5hcHBlbmQoIiAoIik7CgogICAgICAgIGJvb2xl\nYW4gaGFzVmFsID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBfY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoX3ZhbHNb\naV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAg\nICAgICAgaWYgKGhhc1ZhbCkgewogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiLCAiKTsKICAgICAgICAgICAgICAgIHZhbHMuYXBwZW5kKCIsICIpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2NvbHNbaV0p\nOwogICAgICAgICAgICBpZiAoX3R5cGVzW2ldID09IFJBVykKICAgICAgICAg\nICAgICAgIHZhbHMuYXBwZW5kKF92YWxzW2ldKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgdmFscy5hcHBlbmQoIj8iKTsKICAgICAgICAg\nICAgaGFzVmFsID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJ1Zi5hcHBl\nbmQoIikgVkFMVUVTICgiKS5hcHBlbmQodmFscy50b1N0cmluZygpKS5hcHBl\nbmQoIikiKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgYSBwcmVwYXJl\nZCBzdGF0ZW1lbnQgZGVsZXRlIG9uIHRoaXMgcm93LgogICAgICovCiAgICBw\ncml2YXRlIFN0cmluZyBnZXREZWxldGVTUUwoREJEaWN0aW9uYXJ5IGRpY3Qp\nIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZl\ncigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkRFTEVURSBGUk9NICIpLgogICAg\nICAgICAgICBhcHBlbmQoZGljdC5nZXRGdWxsTmFtZShnZXRUYWJsZSgpLCBm\nYWxzZSkpOwogICAgICAgIGFwcGVuZFdoZXJlKGJ1ZiwgZGljdCk7CiAgICAg\nICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXBwZW5kcyB0aGUgd2hlcmUgY2xhdXNlIG9udG8gdGhlIGdpdmVuIHNx\nbCBidWZmZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRXaGVy\nZShTdHJpbmdCdWZmZXIgYnVmLCBEQkRpY3Rpb25hcnkgZGljdCkgewogICAg\nICAgIGJvb2xlYW4gaGFzV2hlcmUgPSBmYWxzZTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChfdmFsc1tnZXRXaGVyZUluZGV4KF9jb2xzW2ldKV0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgaWYgKCFo\nYXNXaGVyZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAi\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIEFORCAiKTsKCiAgICAgICAgICAgIC8vIEdldCBwbGF0Zm9ybSBzcGVj\naWZpYyB2ZXJzaW9uIGNvbHVtbiBuYW1lCiAgICAgICAgICAgIGlmIChfY29s\nc1tpXS5nZXRWZXJzaW9uU3RyYXRlZ3koKSAhPSBudWxsKQogICAgICAgICAg\nICAgICBidWYuYXBwZW5kKGRpY3QuZ2V0VmVyc2lvbkNvbHVtbihfY29sc1tp\nXSwgX2NvbHNbaV0KICAgICAgICAgICAgICAgICAgIC5nZXRUYWJsZU5hbWUo\nKSkpLmFwcGVuZCgiID0gPyIpOwogICAgICAgICAgICAvLyBzcWxzZXJ2ZXIg\nc2VlbXMgdG8gaGF2ZSBwcm9ibGVtcyB1c2luZyBudWxsIHBhcmFtZXRlcnMg\naW4gdGhlCiAgICAgICAgICAgIC8vIHdoZXJlIGNsYXVzZQogICAgICAgICAg\nICBlbHNlIGlmIChfdmFsc1tnZXRXaGVyZUluZGV4KF9jb2xzW2ldKV0gPT0g\nTlVMTCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2NvbHNbaV0pLmFw\ncGVuZCgiIElTIE5VTEwiKTsKICAgICAgICAgICAgZWxzZSBpZiAoX3R5cGVz\nW2ldID09IFJBVykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2NvbHNb\naV0pLmFwcGVuZCgiID0gIikuYXBwZW5kKF92YWxzW2ldKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfY29sc1tpXSku\nYXBwZW5kKCIgPSA/Iik7CiAgICAgICAgICAgIGhhc1doZXJlID0gdHJ1ZTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9m\nIHBhcmFtZXRlcnMgdGhhdCB3aWxsIGJlIHNldCBmb3IgdGhpcyByb3cuCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UGFyYW1ldGVyQ291bnQoKSB7CiAg\nICAgICAgcmV0dXJuIF92YWxzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEZsdXNoIHRoZSByb3cncyB2YWx1ZXMgdG8gdGhlIGdpdmVuIHByZXBh\ncmVkIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgZmx1c2go\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIERCRGljdGlvbmFyeSBkaWN0LAog\nICAgICAgIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBmbHVzaChzdG1udCwgMSwgZGljdCwgc3RvcmUp\nOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggdGhlIHJvdydzIHZhbHVl\ncyB0byB0aGUgZ2l2ZW4gcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBmbHVzaChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgREJEaWN0aW9uYXJ5IGRpY3QsCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewoKICAgICAg\nICAvLyB0aGlzIHNpbXBsZSBtZXRob2Qgd29ya3MgYmVjYXVzZSB0aGUgU1FM\nIGlzIGFsd2F5cyBwcmVwYXJlZAogICAgICAgIC8vIGJhc2VkIG9uIHRoZSBp\nbmRleGluZyBvZiB0aGUgY29sdW1ucyBpbiB0aGUgdGFibGUgb2JqZWN0IC0t\nIHRoZQogICAgICAgIC8vIHNhbWUgb3JkZXJpbmcgd2UgdXNlIHdoZW4gc3Rv\ncmluZyB2YWx1ZXMgYW5kIG1ldGEgdHlwZXMuIHNraXAKICAgICAgICAvLyB1\ncGRhdGVzIHdoZW4gc2V0dGluZyBwYXJhbXMgZm9yIERFTEVURXM7IHRoZSB1\ncGRhdGVzIGFyZSBqdXN0IHRoZXJlCiAgICAgICAgLy8gdG8gbGV0IHVzIGV2\nYWwgZmsgY29uc3RyYWludHMKICAgICAgICBpbnQgaSA9IChnZXRBY3Rpb24o\nKSA9PSBBQ1RJT05fREVMRVRFKSA/IF9jb2xzLmxlbmd0aDogMDsKICAgICAg\nICBDb2x1bW4gY29sOwogICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAgaW50\nIGhhbGYgPSBfdmFscy5sZW5ndGggLyAyOwogICAgICAgIGZvciAoOyBpIDwg\nX3ZhbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKF92YWxzW2ld\nID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIC8vIHdlIGRvbid0IHNldCBudWxsIHBhcmFtcyBpbiB0aGUgV0hFUkUg\nY2xhdXNlOyB3ZSB1c2UgdGhlIE5VTEwKICAgICAgICAgICAgLy8ga2V5d29y\nZCBpbnN0ZWFkIHRvIHNhdGlzZnkgc3Fsc2VydmVyCiAgICAgICAgICAgIGlm\nIChfdmFsc1tpXSA9PSBOVUxMICYmIGdldEFjdGlvbigpICE9IEFDVElPTl9J\nTlNFUlQgJiYgaSA+PSBoYWxmKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGFuIHVwZGF0ZSB0aGUgdmFs\ncyBhcnJheSB3aWxsIGJlIDIgeCB0aGUgY29scwogICAgICAgICAgICAvLyBh\ncnJheSBsZW5ndGg7IGl0IHJlcGVhdHMgZm9yIHdoZXJlIHZhbHVlcwogICAg\nICAgICAgICBpZiAoaSA8IF9jb2xzLmxlbmd0aCkKICAgICAgICAgICAgICAg\nIGNvbCA9IF9jb2xzW2ldOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBjb2wgPSBfY29sc1tpIC0gX2NvbHMubGVuZ3RoXTsKCiAgICAgICAg\nICAgIHZhbCA9IF92YWxzW2ldOwogICAgICAgICAgICBpZiAodmFsID09IE5V\nTEwpCiAgICAgICAgICAgICAgICB2YWwgPSBudWxsOwoKICAgICAgICAgICAg\naWYgKHZhbCA9PSBudWxsIHx8IF90eXBlc1tpXSAhPSBSQVcpIHsKICAgICAg\nICAgICAgICAgIGRpY3Quc2V0VHlwZWQoc3RtbnQsIGlkeCwgdmFsLCBjb2ws\nIF90eXBlc1tpXSwgc3RvcmUpOwogICAgICAgICAgICAgICAgaWR4Kys7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgYXJyYXkgdmFsdWUgYXJyYXkgaW5kZXggZm9yIHRoZSBnaXZlbiBjb2x1\nbW4ncyB2YWx1ZS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0U2V0SW5k\nZXgoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBjb2wuZ2V0SW5kZXgo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhcnJheSB2YWx1ZSBhcnJh\neSBpbmRleCBmb3IgdGhlIGdpdmVuIGNvbHVtbidzIHZhbHVlLgogICAgICov\nCiAgICBwcml2YXRlIGludCBnZXRXaGVyZUluZGV4KENvbHVtbiBjb2wpIHsK\nICAgICAgICByZXR1cm4gY29sLmdldEluZGV4KCkgKyBfY29scy5sZW5ndGg7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHByb3BlciBkZWVw\nIGNsb25lLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewog\nICAgICAgIFJvd0ltcGwgY2xvbmUgPSBuZXdJbnN0YW5jZShnZXRDb2x1bW5z\nKCksIGdldEFjdGlvbigpKTsKICAgICAgICBjb3B5SW50byhjbG9uZSwgZmFs\nc2UpOwogICAgICAgIHJldHVybiBjbG9uZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhIG5ldyByb3cuCiAgICAgKi8KICAgIHByb3RlY3RlZCBS\nb3dJbXBsIG5ld0luc3RhbmNlKENvbHVtbltdIGNvbHMsIGludCBhY3Rpb24p\nIHsKICAgICAgICByZXR1cm4gbmV3IFJvd0ltcGwoY29scywgYWN0aW9uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgYWxsIHZhbHVlcyBmcm9tIHRo\naXMgcm93IGludG8gdGhlIGdpdmVuIG9uZS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gd2hlcmVPbmx5IGlmIHRydWUsIG9ubHkgY29weSB3aGVyZSBjb25kaXRp\nb25zCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvcHlJbnRvKFJvd0ltcGwg\ncm93LCBib29sZWFuIHdoZXJlT25seSkgewogICAgICAgIGludCBhY3Rpb24g\nPSBnZXRBY3Rpb24oKTsKICAgICAgICBpbnQgcm93QWN0aW9uID0gcm93Lmdl\ndEFjdGlvbigpOwoKICAgICAgICBpbnQgc3RhcnQ7CiAgICAgICAgaW50IGxl\nbjsKICAgICAgICBpZiAod2hlcmVPbmx5KSB7CiAgICAgICAgICAgIGlmIChh\nY3Rpb24gPT0gQUNUSU9OX0lOU0VSVCB8fCByb3dBY3Rpb24gPT0gQUNUSU9O\nX0lOU0VSVCkKICAgICAgICAgICAgICAgIHN0YXJ0ID0gbGVuID0gMDsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RhcnQgPSBsZW4gPSBf\ndmFscy5sZW5ndGggLyAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIHN0YXJ0ID0gMDsKICAgICAgICAgICAgaWYgKHJvd0FjdGlvbiA9PSBBQ1RJ\nT05fSU5TRVJUICYmIGFjdGlvbiAhPSBBQ1RJT05fSU5TRVJUKQogICAgICAg\nICAgICAgICAgbGVuID0gX3ZhbHMubGVuZ3RoIC8gMjsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgbGVuID0gX3ZhbHMubGVuZ3RoOwogICAg\nICAgIH0KCiAgICAgICAgU3lzdGVtLmFycmF5Y29weShfdmFscywgc3RhcnQs\nIHJvdy5fdmFscywgc3RhcnQsIGxlbik7CiAgICAgICAgU3lzdGVtLmFycmF5\nY29weShfdHlwZXMsIHN0YXJ0LCByb3cuX3R5cGVzLCBzdGFydCwgbGVuKTsK\nICAgICAgICBpZiAoaXNWYWxpZCgpKQogICAgICAgICAgICByb3cuc2V0VmFs\naWQodHJ1ZSk7CiAgICB9Cn0K\n","encoding":"base64"}

