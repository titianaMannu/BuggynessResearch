{"sha":"82a10701a88de2cf5a5986d90be182c173c65797","node_id":"MDQ6QmxvYjIwNjM2NDo4MmExMDcwMWE4OGRlMmNmNWE1OTg2ZDkwYmUxODJjMTczYzY1Nzk3","size":13910,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/82a10701a88de2cf5a5986d90be182c173c65797","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5SZW1vdGVDb21t\naXRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5SZW1v\ndGVDb21taXRMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuY29uZi5Db25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuY29uY3VycmVudC5BYnN0cmFjdENvbmN1cnJlbnRFdmVu\ndE1hbmFnZXI7CgovKioKICogQWJzdHJhY3Qge0BsaW5rIERhdGFDYWNoZX0g\naW1wbGVtZW50YXRpb24gdGhhdCBwcm92aWRlcyB2YXJpb3VzCiAqIHN0YXRp\nc3RpY3MsIGxvZ2dpbmcsIGFuZCB0aW1lb3V0IGZ1bmN0aW9uYWxpdHkgY29t\nbW9uIGFjcm9zcyBjYWNoZQogKiBpbXBsZW1lbnRhdGlvbnMuCiAqCiAqIEBh\ndXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3REYXRhQ2FjaGUKICAg\nIGV4dGVuZHMgQWJzdHJhY3RDb25jdXJyZW50RXZlbnRNYW5hZ2VyCiAgICBp\nbXBsZW1lbnRzIERhdGFDYWNoZSwgQ29uZmlndXJhYmxlIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBCaXRTZXQgRU1QVFlfQklUU0VUID0gbmV3IEJp\ndFNldCgwKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nc19sb2MgPQogICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdlKEFic3RyYWN0\nRGF0YUNhY2hlLmNsYXNzKTsKCiAgICAvKioKICAgICAqIFRoZSBjb25maWd1\ncmF0aW9uIHNldCBieSB0aGUgc3lzdGVtLgogICAgICovCiAgICBwcm90ZWN0\nZWQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZjsKCiAgICAvKioKICAgICAq\nIFRoZSBsb2cgdG8gdXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgTG9nIGxv\nZzsKCiAgICBwcml2YXRlIFN0cmluZyBfbmFtZSA9IG51bGw7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2Nsb3NlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBTdHJp\nbmcgX3NjaGVkdWxlID0gbnVsbDsKCiAgICBwdWJsaWMgU3RyaW5nIGdldE5h\nbWUoKSB7CiAgICAgICAgcmV0dXJuIF9uYW1lOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBfbmFtZSA9\nIG5hbWU7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRFdmljdGlvblNj\naGVkdWxlKCkgewogICAgICAgIHJldHVybiBfc2NoZWR1bGU7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0RXZpY3Rpb25TY2hlZHVsZShTdHJpbmcgcykg\newogICAgICAgIF9zY2hlZHVsZSA9IHM7CiAgICB9CgogICAgcHVibGljIHZv\naWQgaW5pdGlhbGl6ZShEYXRhQ2FjaGVNYW5hZ2VyIG1hbmFnZXIpIHsKICAg\nICAgICBpZiAoX3NjaGVkdWxlICE9IG51bGwgJiYgISIiLmVxdWFscyhfc2No\nZWR1bGUpKSB7CiAgICAgICAgICAgIERhdGFDYWNoZVNjaGVkdWxlciBzY2hl\nZHVsZXIgPSBtYW5hZ2VyLmdldERhdGFDYWNoZVNjaGVkdWxlcigpOwogICAg\nICAgICAgICBpZiAoc2NoZWR1bGVyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzY2hlZHVsZXIuc2NoZWR1bGVFdmljdGlvbih0aGlzLCBfc2NoZWR1bGUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoQ29s\nbGVjdGlvbiBhZGRpdGlvbnMsIENvbGxlY3Rpb24gbmV3VXBkYXRlcywKICAg\nICAgICBDb2xsZWN0aW9uIGV4aXN0aW5nVXBkYXRlcywgQ29sbGVjdGlvbiBk\nZWxldGVzKSB7CiAgICAgICAgLy8gcmVtb3ZlIGFsbCBvYmplY3RzIGluIGRl\nbGV0ZXMgbGlzdAogICAgICAgIHJlbW92ZUFsbEludGVybmFsKGRlbGV0ZXMp\nOwoKICAgICAgICAvLyBuZXh0LCBhZGQgYWxsIHRoZSBuZXcgYWRkaXRpb25z\nCiAgICAgICAgcHV0QWxsSW50ZXJuYWwoYWRkaXRpb25zKTsKICAgICAgICBw\ndXRBbGxJbnRlcm5hbChuZXdVcGRhdGVzKTsKCiAgICAgICAgLy8gcG9zc2li\nbHkgYWRkIHRoZSBleGlzdGluZyB1cGRhdGVzLCBkZXBlbmRpbmcgb24gdGhl\nCiAgICAgICAgLy8gc2VtYW50aWNzIG9mIHRoZSBjYWNoZSwgYXMgZGljdGF0\nZWQgYnkgcmVjYWNoZVVwZGF0ZXMoKQogICAgICAgIGlmIChyZWNhY2hlVXBk\nYXRlcygpKQogICAgICAgICAgICBwdXRBbGxJbnRlcm5hbChleGlzdGluZ1Vw\nZGF0ZXMpOwoKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgQ29sbGVjdGlvbiBhZGRJZHMgPSBuZXcgQXJyYXlMaXN0\nKGFkZGl0aW9ucy5zaXplKCkpOwogICAgICAgICAgICBDb2xsZWN0aW9uIHVw\nSWRzID0gbmV3IEFycmF5TGlzdChuZXdVcGRhdGVzLnNpemUoKSk7CiAgICAg\nICAgICAgIENvbGxlY3Rpb24gZXhJZHMgPSBuZXcgQXJyYXlMaXN0KGV4aXN0\naW5nVXBkYXRlcy5zaXplKCkpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdGVyID0gYWRkaXRpb25zLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgICAgIGFkZElkcy5hZGQoKChEYXRhQ2FjaGVQQ0Rh\ndGEpIGl0ZXIubmV4dCgpKS5nZXRJZCgpKTsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdGVyID0gbmV3VXBkYXRlcy5pdGVyYXRvcigpOyBpdGVyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICB1cElkcy5hZGQoKChEYXRhQ2Fj\naGVQQ0RhdGEpIGl0ZXIubmV4dCgpKS5nZXRJZCgpKTsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdGVyID0gZXhpc3RpbmdVcGRhdGVzLml0ZXJhdG9y\nKCk7IGl0ZXIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIGV4SWRzLmFk\nZCgoKERhdGFDYWNoZVBDRGF0YSkgaXRlci5uZXh0KCkpLmdldElkKCkpOwoK\nICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtY29tbWl0\nIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgYWRkSWRzLCB1cElk\ncywgZXhJZHMsIGRlbGV0ZXMgfSkpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3Qga2V5KSB7CiAgICAgICAg\nRGF0YUNhY2hlUENEYXRhIG8gPSBnZXRJbnRlcm5hbChrZXkpOwogICAgICAg\nIGlmIChvICE9IG51bGwgJiYgby5pc1RpbWVkT3V0KCkpIHsKICAgICAgICAg\nICAgbyA9IG51bGw7CiAgICAgICAgICAgIHJlbW92ZUludGVybmFsKGtleSk7\nCiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXRpbWVvdXQi\nLCBrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG8gIT0gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgQml0U2V0IGNvbnRhaW5zQWxsKENvbGxlY3Rp\nb24ga2V5cykgewogICAgICAgIGlmIChrZXlzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgcmV0dXJuIEVNUFRZX0JJVFNFVDsKCiAgICAgICAgQml0U2V0IHNl\ndCA9IG5ldyBCaXRTZXQoa2V5cy5zaXplKCkpOwogICAgICAgIGludCBpID0g\nMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBrZXlzLml0ZXJhdG9y\nKCk7IGl0ZXIuaGFzTmV4dCgpOyBpKyspCiAgICAgICAgICAgIGlmIChjb250\nYWlucyhpdGVyLm5leHQoKSkpCiAgICAgICAgICAgICAgICBzZXQuc2V0KGkp\nOwogICAgICAgIHJldHVybiBzZXQ7CiAgICB9CgogICAgcHVibGljIERhdGFD\nYWNoZVBDRGF0YSBnZXQoT2JqZWN0IGtleSkgewogICAgICAgIERhdGFDYWNo\nZVBDRGF0YSBvID0gZ2V0SW50ZXJuYWwoa2V5KTsKICAgICAgICBpZiAobyAh\nPSBudWxsICYmIG8uaXNUaW1lZE91dCgpKSB7CiAgICAgICAgICAgIG8gPSBu\ndWxsOwogICAgICAgICAgICByZW1vdmVJbnRlcm5hbChrZXkpOwogICAgICAg\nICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS10aW1lb3V0Iiwga2V5KSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLW1pc3MiLCBrZXkpKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKHNfbG9j\nLmdldCgiY2FjaGUtaGl0Iiwga2V5KSk7CiAgICAgICAgfQoKICAgICAgICBy\nZXR1cm4gbzsKICAgIH0KCiAgICBwdWJsaWMgRGF0YUNhY2hlUENEYXRhIHB1\ndChEYXRhQ2FjaGVQQ0RhdGEgZGF0YSkgewogICAgICAgIERhdGFDYWNoZVBD\nRGF0YSBvID0gcHV0SW50ZXJuYWwoZGF0YS5nZXRJZCgpLCBkYXRhKTsKICAg\nICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxv\nZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXB1dCIsIGRhdGEuZ2V0SWQoKSkp\nOwogICAgICAgIHJldHVybiAobyA9PSBudWxsIHx8IG8uaXNUaW1lZE91dCgp\nKSA/IG51bGwgOiBvOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShE\nYXRhQ2FjaGVQQ0RhdGEgZGF0YSkgewogICAgICAgIGlmIChyZWNhY2hlVXBk\nYXRlcygpKQogICAgICAgICAgICBwdXRJbnRlcm5hbChkYXRhLmdldElkKCks\nIGRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBEYXRhQ2FjaGVQQ0RhdGEgcmVt\nb3ZlKE9iamVjdCBrZXkpIHsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgbyA9\nIHJlbW92ZUludGVybmFsKGtleSk7CiAgICAgICAgaWYgKG8gIT0gbnVsbCAm\nJiBvLmlzVGltZWRPdXQoKSkKICAgICAgICAgICAgbyA9IG51bGw7CiAgICAg\nICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGlm\nIChvID09IG51bGwpCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19sb2Mu\nZ2V0KCJjYWNoZS1yZW1vdmUtbWlzcyIsIGtleSkpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNo\nZS1yZW1vdmUtaGl0Iiwga2V5KSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBvOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgcmVtb3ZlQWxsKENvbGxl\nY3Rpb24ga2V5cykgewogICAgICAgIGlmIChrZXlzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIEVNUFRZX0JJVFNFVDsKCiAgICAgICAgQml0U2V0\nIHNldCA9IG5ldyBCaXRTZXQoa2V5cy5zaXplKCkpOwogICAgICAgIGludCBp\nID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBrZXlzLml0ZXJh\ndG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyBpKyspCiAgICAgICAgICAgIGlmIChy\nZW1vdmUoaXRlci5uZXh0KCkpICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nZXQuc2V0KGkpOwogICAgICAgIHJldHVybiBzZXQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZW1vdmUgdGhlIG9iamVjdHMgb2YgdGhlIGdpdmVuIGNsYXNz\nIGZyb20gdGhlIGNhY2hlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVBbGwoQ2xhc3MgY2xzLCBib29sZWFuIHN1YkNsYXNzZXMpIHsKICAgICAg\nICByZW1vdmVBbGxJbnRlcm5hbChjbHMsIHN1YkNsYXNzZXMpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIHBpbihPYmplY3Qga2V5KSB7CiAgICAgICAg\nYm9vbGVhbiBib29sID0gcGluSW50ZXJuYWwoa2V5KTsKICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKGJvb2wp\nCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1w\naW4taGl0Iiwga2V5KSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXBpbi1taXNzIiwga2V5\nKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBib29sOwogICAgfQoKICAg\nIHB1YmxpYyBCaXRTZXQgcGluQWxsKENvbGxlY3Rpb24ga2V5cykgewogICAg\nICAgIGlmIChrZXlzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVN\nUFRZX0JJVFNFVDsKCiAgICAgICAgQml0U2V0IHNldCA9IG5ldyBCaXRTZXQo\na2V5cy5zaXplKCkpOwogICAgICAgIGludCBpID0gMDsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ZXIgPSBrZXlzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4\ndCgpOyBpKyspCiAgICAgICAgICAgIGlmIChwaW4oaXRlci5uZXh0KCkpKQog\nICAgICAgICAgICAgICAgc2V0LnNldChpKTsKICAgICAgICByZXR1cm4gc2V0\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBpbkFsbChDbGFzcyBjbHMsIGJv\nb2xlYW4gc3VicykgewogICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgp\nKQogICAgICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImNhY2hlLWNsYXNz\nLXBpbiIsIGdldE5hbWUoKSkpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHVucGluKE9iamVjdCBrZXkpIHsKICAgICAgICBib29sZWFuIGJvb2wgPSB1\nbnBpbkludGVybmFsKGtleSk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgIGlmIChib29sKQogICAgICAgICAgICAg\nICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtdW5waW4taGl0Iiwga2V5\nKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFj\nZShzX2xvYy5nZXQoImNhY2hlLXVucGluLW1pc3MiLCBrZXkpKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGJvb2w7CiAgICB9CgogICAgcHVibGljIEJp\ndFNldCB1bnBpbkFsbChDb2xsZWN0aW9uIGtleXMpIHsKICAgICAgICBpZiAo\na2V5cy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CSVRT\nRVQ7CgogICAgICAgIEJpdFNldCBzZXQgPSBuZXcgQml0U2V0KGtleXMuc2l6\nZSgpKTsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdGVyID0ga2V5cy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgaSsr\nKQogICAgICAgICAgICBpZiAodW5waW4oaXRlci5uZXh0KCkpKQogICAgICAg\nICAgICAgICAgc2V0LnNldChpKTsKICAgICAgICByZXR1cm4gc2V0OwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHVucGluQWxsKENsYXNzIGNscywgYm9vbGVh\nbiBzdWJzKSB7CiAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAg\nICAgICAgICAgIGxvZy53YXJuKHNfbG9jLmdldCgiY2FjaGUtY2xhc3MtdW5w\naW4iLCBnZXROYW1lKCkpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVh\ncigpIHsKICAgICAgICBjbGVhckludGVybmFsKCk7CiAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uoc19s\nb2MuZ2V0KCJjYWNoZS1jbGVhciIsIGdldE5hbWUoKSkpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGNsb3NlKHRydWUpOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGNsb3NlKGJvb2xlYW4gY2xlYXIp\nIHsKICAgICAgICBpZiAoIV9jbG9zZWQpIHsKICAgICAgICAgICAgaWYgKGNs\nZWFyKQogICAgICAgICAgICAgICAgY2xlYXJJbnRlcm5hbCgpOwogICAgICAg\nICAgICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9z\nZWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgYWRkRXhwaXJhdGlvbkxpc3Rl\nbmVyKEV4cGlyYXRpb25MaXN0ZW5lciBsaXN0ZW4pIHsKICAgICAgICBhZGRM\naXN0ZW5lcihsaXN0ZW4pOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZUV4cGlyYXRpb25MaXN0ZW5lcihFeHBpcmF0aW9uTGlzdGVuZXIgbGlz\ndGVuKSB7CiAgICAgICAgcmV0dXJuIHJlbW92ZUxpc3RlbmVyKGxpc3Rlbik7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAg\nICByZXR1cm4gIlsiICsgc3VwZXIudG9TdHJpbmcoKSArICI6IiArIF9uYW1l\nICsgIl0iOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMg\ncGFydCBvZiB0aGUge0BsaW5rIFJlbW90ZUNvbW1pdExpc3RlbmVyfSBpbnRl\ncmZhY2UuIElmCiAgICAgKiB5b3VyIGNhY2hlIHN1YmNsYXNzIHJlbGllcyBv\nbiBPcGVuSlBBIGZvciBjbHVzdGVyaW5nIHN1cHBvcnQsIG1ha2UgaXQKICAg\nICAqIGltcGxlbWVudCA8Y29kZT5SZW1vdGVDb21taXRMaXN0ZW5lcjwvY29k\nZT4uIFRoaXMgbWV0aG9kIHdpbGwgdGFrZQogICAgICogY2FyZSBvZiBpbnZh\nbGlkYXRpbmcgZW50cmllcyBmcm9tIHJlbW90ZSBjb21taXRzLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBhZnRlckNvbW1pdChSZW1vdGVDb21taXRFdmVu\ndCBldmVudCkgewogICAgICAgIGlmIChfY2xvc2VkKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGlmIChldmVudC5nZXRQYXlsb2FkVHlwZSgpID09\nIFJlbW90ZUNvbW1pdEV2ZW50LlBBWUxPQURfRVhURU5UUykgewogICAgICAg\nICAgICByZW1vdmVBbGxUeXBlTmFtZXNJbnRlcm5hbChldmVudC5nZXRVcGRh\ndGVkVHlwZU5hbWVzKCkpOwogICAgICAgICAgICByZW1vdmVBbGxUeXBlTmFt\nZXNJbnRlcm5hbChldmVudC5nZXREZWxldGVkVHlwZU5hbWVzKCkpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGRyb3AgYWxsIHRoZSBjb21t\naXR0ZWQgT0lEcywgZXhjZXB0aW5nIGJyYW5kCiAgICAgICAgICAgIC8vIG5l\ndyBPSURzLiBicmFuZCBuZXcgT0lEcyBlaXRoZXIgd29uJ3QgYmUgaW4KICAg\nICAgICAgICAgLy8gdGhlIGNhY2hlLCBvciBpZiB0aGV5IGFyZSwgd2lsbCBi\nZSBtb3JlIHVwIHRvIGRhdGUKICAgICAgICAgICAgcmVtb3ZlQWxsSW50ZXJu\nYWwoZXZlbnQuZ2V0VXBkYXRlZE9iamVjdElkcygpKTsKICAgICAgICAgICAg\ncmVtb3ZlQWxsSW50ZXJuYWwoZXZlbnQuZ2V0RGVsZXRlZE9iamVjdElkcygp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2Ugd2hl\nbiBhIGtleSBpcyByZW1vdmVkIGZyb20gdGhpcyBjYWNoZS4gUHJvcGFnYXRl\ncyB0aGUKICAgICAqIGV4cGlyYXRpb24gZXZlbnQgb24gdG8gYWxsIGV4cGly\nYXRpb24gbGlzdGVuZXJzIHJlZ2lzdGVyZWQKICAgICAqIHdpdGggdGhpcyBj\nbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQga2V5UmVtb3ZlZChP\nYmplY3Qga2V5LCBib29sZWFuIGV4cGlyZWQpIHsKICAgICAgICAvLyBOb3Rp\nZnkgYW55IGV4cGlyYXRpb24gbGlzdGVuZXJzIG9mIHRoZSBleHBpcmF0aW9u\nLgogICAgICAgIGlmIChoYXNMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgZmly\nZUV2ZW50KG5ldyBFeHBpcmF0aW9uRXZlbnQodGhpcywga2V5LCBleHBpcmVk\nKSk7CgogICAgICAgIGlmIChleHBpcmVkICYmIGxvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uoc19sb2MuZ2V0KCJjYWNoZS1l\neHBpcmVkIiwga2V5KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nPGNvZGU+dHJ1ZTwvY29kZT4gaWYgdXBkYXRlcyB0byBkYXRhIGFscmVhZHkg\naW4gdGhlCiAgICAgKiBjYWNoZSAoZWl0aGVyIGluIHtAbGluayAjY29tbWl0\nfSBvciB0aGUge0BsaW5rICN1cGRhdGV9KQogICAgICogc2hvdWxkIGJlIHB1\ndCBiYWNrIGludG8gdGhlIGNhY2hlLiBSZXR1cm5zIGZhbHNlIGJ5IGRlZmF1\nbHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHJlY2FjaGVVcGRh\ndGVzKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gb2lkLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRGF0YUNhY2hlUENEYXRh\nIGdldEludGVybmFsKE9iamVjdCBvaWQpOwoKICAgIC8qKgogICAgICogQWRk\nIHRoZSBnaXZlbiBvYmplY3QgdG8gdGhlIGNhY2hlLCByZXR1cm5pbmcgdGhl\nIG9sZCBvYmplY3QgdW5kZXIgdGhlCiAgICAgKiBnaXZlbiBvaWQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBEYXRhQ2FjaGVQQ0RhdGEgcHV0\nSW50ZXJuYWwoT2JqZWN0IG9pZCwKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEg\ncGMpOwoKICAgIC8qKgogICAgICogQWxsIGFsbCBvZiB0aGUgZ2l2ZW4gb2Jq\nZWN0cyB0byB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHB1dEFsbEludGVybmFsKENvbGxlY3Rpb24gcGNzKSB7CiAgICAgICAgRGF0\nYUNhY2hlUENEYXRhIHBjOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nIHBjcy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgcGMgPSAoRGF0YUNhY2hlUENEYXRhKSBpdGVyLm5leHQoKTsKICAgICAg\nICAgICAgcHV0SW50ZXJuYWwocGMuZ2V0SWQoKSwgcGMpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgb2JqZWN0IHVuZGVy\nIHRoZSBnaXZlbiBvaWQgZnJvbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBEYXRhQ2FjaGVQQ0RhdGEgcmVtb3ZlSW50ZXJu\nYWwoT2JqZWN0IG9pZCk7CgogICAgLyoqCiAgICAgKiBFdmljdCBvYmplY3Rz\nIGluIGNhY2hlIGJ5IGNsYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3Qgdm9pZCByZW1vdmVBbGxJbnRlcm5hbChDbGFzcyBjbHMsIGJvb2xl\nYW4gc3ViY2xhc3Nlcyk7CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYWxsIG9i\namVjdHMgdW5kZXIgdGhlIGdpdmVuIG9pZHMgZnJvbSB0aGUgY2FjaGUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlbW92ZUFsbEludGVybmFsKENv\nbGxlY3Rpb24gb2lkcykgewogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nIG9pZHMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICByZW1vdmVJbnRlcm5hbChpdGVyLm5leHQoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZW1vdmUgYWxsIG9iamVjdHMgb2YgdGhlIGdpdmVuIGNsYXNz\nIG5hbWVzIGZyb20gdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCByZW1vdmVBbGxUeXBlTmFtZXNJbnRlcm5hbChDb2xsZWN0aW9uIGNs\nYXNzTmFtZXMpIHsKICAgICAgICBDb2xsZWN0aW9uIGNsYXNzZXMgPSBDYWNo\nZXMuYWRkVHlwZXNCeU5hbWUoY29uZiwgY2xhc3NOYW1lcywgbnVsbCk7CiAg\nICAgICAgaWYgKGNsYXNzZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndGVyID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgY2xzID0gKENsYXNzKSBpdGVyLm5leHQoKTsKICAgICAg\nICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcmVtb3ZlY2xhc3MiLCBj\nbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHJlbW92ZUFsbEludGVybmFs\nKGNscywgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENsZWFyIHRoZSBjYWNoZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IHZvaWQgY2xlYXJJbnRlcm5hbCgpOwoKICAgIC8qKgogICAgICogUGlu\nIGFuIG9iamVjdCB0byB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBhYnN0cmFjdCBib29sZWFuIHBpbkludGVybmFsKE9iamVjdCBvaWQpOwoK\nICAgIC8qKgogICAgICogVW5waW4gYW4gb2JqZWN0IGZyb20gdGhlIGNhY2hl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgYm9vbGVhbiB1bnBp\nbkludGVybmFsKE9iamVjdCBvaWQpOwoKICAgIC8vIC0tLS0tLS0tLS0gQ29u\nZmlndXJhYmxlIGltcGxlbWVudGF0aW9uIC0tLS0tLS0tLS0KCiAgICBwdWJs\naWMgdm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikg\newogICAgICAgIHRoaXMuY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikg\nY29uZjsKICAgICAgICB0aGlzLmxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFD\nb25maWd1cmF0aW9uLkxPR19EQVRBQ0FDSEUpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIGlmIChfbmFt\nZSA9PSBudWxsKQogICAgICAgICAgICBzZXROYW1lKE5BTUVfREVGQVVMVCk7\nCiAgICB9CgogICAgLy8gLS0tLS0tLS0tLSBBYnN0cmFjdEV2ZW50TWFuYWdl\nciBpbXBsZW1lbnRhdGlvbiAtLS0tLS0tLS0tCgogICAgcHJvdGVjdGVkIHZv\naWQgZmlyZUV2ZW50KE9iamVjdCBldmVudCwgT2JqZWN0IGxpc3RlbmVyKSB7\nCiAgICAgICAgRXhwaXJhdGlvbkxpc3RlbmVyIGxpc3RlbiA9IChFeHBpcmF0\naW9uTGlzdGVuZXIpIGxpc3RlbmVyOwogICAgICAgIEV4cGlyYXRpb25FdmVu\ndCBldiA9IChFeHBpcmF0aW9uRXZlbnQpIGV2ZW50OwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGxpc3Rlbi5vbkV4cGlyZShldik7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2FybihzX2xvYy5n\nZXQoImV4cC1saXN0ZW5lci1leCIpLCBlKTsKCQl9Cgl9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBvYmplY3RzIGZvciB0aGUgZ2l2ZW4ga2V5IExp\nc3QuCiAgICAgKi8KICAgIHB1YmxpYyBNYXAgZ2V0QWxsKExpc3Qga2V5cykg\newogICAgICAgIE1hcCByZXN1bHRNYXAgPSBuZXcgSGFzaE1hcChrZXlzLnNp\nemUoKSk7CiAgICAgICAgZm9yKGludCBpPTA7IGk8a2V5cy5zaXplKCk7IGkr\nKykKICAgICAgICAgICAgcmVzdWx0TWFwLnB1dChrZXlzLmdldChpKSwgZ2V0\nKGtleXMuZ2V0KGkpKSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdE1hcDsKICAg\nIH0KfQo=\n","encoding":"base64"}

