{"sha":"dab3e4d24bde5691db561b77fc10b0db726d9778","node_id":"MDQ6QmxvYjIwNjM2NDpkYWIzZTRkMjRiZGU1NjkxZGI1NjFiNzdmYzEwYjBkYjcyNmQ5Nzc4","size":26724,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/dab3e4d24bde5691db561b77fc10b0db726d9778","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTGlzdEl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdTdG9y\nZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZl\ndGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuTG9ja0xldmVsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247Cgov\nKioKICogU3RvcmVNYW5hZ2VyIHByb3h5IHRoYXQgZGVsZWdhdGVzIHRvIGEg\nZGF0YSBjYWNoZSB3aGVuIHBvc3NpYmxlLgogKgogKiBAYXV0aG9yIFBhdHJp\nY2sgTGluc2tleQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGF0\nYUNhY2hlU3RvcmVNYW5hZ2VyCiAgICBleHRlbmRzIERlbGVnYXRpbmdTdG9y\nZU1hbmFnZXIgewoKICAgIC8vIGFsbCB0aGUgc3RhdGUgbWFuYWdlcnMgY2hh\nbmdlZCBpbiB0aGlzIHRyYW5zYWN0aW9uCiAgICBwcml2YXRlIENvbGxlY3Rp\nb24gX2luc2VydHMgPSBudWxsOyAvLyBzdGF0ZW1hbmFnZXJzCiAgICBwcml2\nYXRlIE1hcCBfdXBkYXRlcyA9IG51bGw7IC8vIHN0YXRlbWFuYWdlciAtPiBm\nbWQgc2V0CiAgICBwcml2YXRlIENvbGxlY3Rpb24gX2RlbGV0ZXMgPSBudWxs\nOyAvLyBzdGF0ZW1hbmFnZXJzCgogICAgLy8gdGhlIG93bmluZyBjb250ZXh0\nCiAgICBwcml2YXRlIFN0b3JlQ29udGV4dCBfY3R4ID0gbnVsbDsKCiAgICAv\nLyBwYyBkYXRhIGdlbmVyYXRvcgogICAgcHJpdmF0ZSBQQ0RhdGFHZW5lcmF0\nb3IgX2dlbiA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4K\nICAgICAqCiAgICAgKiBAcGFyYW0gc20gdGhlIHN0b3JlIG1hbmFnZXIgdG8g\nZGVsZWdhdGUgdG8KICAgICAqLwogICAgcHVibGljIERhdGFDYWNoZVN0b3Jl\nTWFuYWdlcihTdG9yZU1hbmFnZXIgc20pIHsKICAgICAgICBzdXBlcihzbSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRl\neHQgY3R4KSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAgICAgICBfZ2VuID0g\nY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXREYXRhQ2FjaGVNYW5hZ2VySW5z\ndGFuY2UoKS4KICAgICAgICAgICAgZ2V0UENEYXRhR2VuZXJhdG9yKCk7CiAg\nICAgICAgc3VwZXIuc2V0Q29udGV4dChjdHgpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGJlZ2luKCkgewogICAgICAgIHN1cGVyLmJlZ2luKCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHN1cGVyLmNvbW1pdCgpOwogICAgICAgICAgICB1cGRhdGVD\nYWNoZXMoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaW5z\nZXJ0cyA9IG51bGw7CiAgICAgICAgICAgIF91cGRhdGVzID0gbnVsbDsKICAg\nICAgICAgICAgX2RlbGV0ZXMgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzdXBlci5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIF9pbnNlcnRzID0gbnVsbDsKICAgICAgICAgICAgX3Vw\nZGF0ZXMgPSBudWxsOwogICAgICAgICAgICBfZGVsZXRlcyA9IG51bGw7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRXZpY3QgYWxsIG1lbWJl\ncnMgb2YgdGhlIGdpdmVuIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBldmljdFR5cGVzKENvbGxlY3Rpb24gY2xhc3NlcykgewogICAgICAg\nIGlmIChjbGFzc2VzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgbWRyID0gX2N0eC5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gX2N0\neC5nZXRDbGFzc0xvYWRlcigpOwoKICAgICAgICBDbGFzcyBjbHM7CiAgICAg\nICAgRGF0YUNhY2hlIGNhY2hlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBjbHMgPSAoQ2xhc3MpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nIGNhY2hlID0gbWRyLmdldE1ldGFEYXRhKGNscywgbG9hZGVyLCBmYWxzZSku\nZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKGNscywgZmFsc2Up\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwg\nY2FjaGVzIHdpdGggdGhlIGNvbW1pdHRlZCBpbnNlcnRzLCB1cGRhdGVzLCBh\nbmQgZGVsZXRlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUNh\nY2hlcygpIHsKICAgICAgICAvLyBtYXAgZWFjaCBkYXRhIGNhY2hlIHRvIHRo\nZSBtb2RpZmljYXRpb25zIHdlIG5lZWQgdG8gcGVyZm9ybQogICAgICAgIE1h\ncCBtb2RNYXAgPSBudWxsOwogICAgICAgIE1vZGlmaWNhdGlvbnMgbW9kczsK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtOwogICAgICAgIERhdGFD\nYWNoZVBDRGF0YSBkYXRhOwogICAgICAgIERhdGFDYWNoZSBjYWNoZTsKCiAg\nICAgICAgLy8gY3JlYXRlIHBjIGRhdGFzIGZvciBpbnNlcnRzCiAgICAgICAg\naWYgKF9jdHguZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSAmJiBfaW5zZXJ0cyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2lu\nc2VydHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0\nRGF0YUNhY2hlKCk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICBpZiAobW9kTWFwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nbW9kTWFwID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIG1vZHMg\nPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwogICAgICAgICAg\nICAgICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgICAgICBk\nYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgIG1vZHMuYWRkaXRpb25z\nLmFkZChuZXcgUENEYXRhSG9sZGVyKGRhdGEsIHNtKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBwY2RhdGFzIGZvciB1\ncGRhdGVzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIGlmIChf\ndXBkYXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIEJpdFNldCBmaWVsZHM7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3VwZGF0ZXMuZW50\ncnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgZmll\nbGRzID0gKEJpdFNldCkgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAg\nICAgICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7\nCiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpdCdz\nIG9rIG5vdCB0byBjbG9uZSB0aGUgb2JqZWN0IHRoYXQgd2UgZ2V0IGZyb20g\ndGhlIGNhY2hlLAogICAgICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUgaW5z\naWRlIHRoZSBjb21taXQoKSBtZXRob2QsIHNvIGFueSBtb2RpZmljYXRpb25z\nCiAgICAgICAgICAgICAgICAvLyB0byB0aGUgdW5kZXJseWluZyBjYWNoZSBh\ncmUgdmFsaWQuIElmIHRoZSBjb21taXQgaGFkIG5vdAogICAgICAgICAgICAg\nICAgLy8gYWxyZWFkeSBzdWNjZWVkZWQsIHRoZW4gd2UnZCB3YW50IHRvIGNs\nb25lIHRoZSByZXRyaWV2ZWQKICAgICAgICAgICAgICAgIC8vIG9iamVjdC4K\nICAgICAgICAgICAgICAgIGlmIChtb2RNYXAgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBtb2RNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAg\nICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAg\nICAgICAgICAgICAgIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwg\nY2FjaGUpOwoKICAgICAgICAgICAgICAgIC8vIGRhdGEgc2hvdWxkIGFsd2F5\ncyBiZSBub24tbnVsbCwgc2luY2UgdGhlIG9iamVjdCBpcwogICAgICAgICAg\nICAgICAgLy8gZGlydHksIGJ1dCBtYXliZSBpdCBnb3QgZHJvcHBlZCBmcm9t\nIHRoZSBjYWNoZSBpbiB0aGUKICAgICAgICAgICAgICAgIC8vIGludGVyaW0K\nICAgICAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICBkYXRhID0gbmV3UENEYXRhKHNtKTsKICAgICAgICAgICAg\nICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgICAgICBt\nb2RzLm5ld1VwZGF0ZXMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20p\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgZGF0YS5zdG9yZShzbSwgZmllbGRzKTsKICAgICAgICAgICAgICAgICAg\nICBtb2RzLmV4aXN0aW5nVXBkYXRlcy5hZGQobmV3IFBDRGF0YUhvbGRlcihk\nYXRhLCBzbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgcGNkYXRhcyBmb3IgZGVsZXRl\ncwogICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gX2RlbGV0ZXMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBjYWNo\nZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAg\nICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZiAobW9kTWFwID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgbW9kTWFwID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICAgICAgICAgIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1v\nZE1hcCwgY2FjaGUpOwogICAgICAgICAgICAgICAgbW9kcy5kZWxldGVzLmFk\nZChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gbm90aWZ5IHRoZSBjYWNoZXMgb2YgdGhlIGNoYW5nZXMK\nICAgICAgICBpZiAobW9kTWFwICE9IG51bGwpIHsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBtb2RNYXAuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAo\nTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgY2FjaGUg\nPSAoRGF0YUNhY2hlKSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAg\nIG1vZHMgPSAoTW9kaWZpY2F0aW9ucykgZW50cnkuZ2V0VmFsdWUoKTsKCiAg\nICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UncmUgbm90IGNhY2hpbmcg\nb2xkIHZlcnNpb25zCiAgICAgICAgICAgICAgICBjYWNoZS53cml0ZUxvY2so\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\ndHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2FjaGUsIG1vZHMuYWRk\naXRpb25zKTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNp\nb25TYWZlUENEYXRhcyhjYWNoZSwgbW9kcy5uZXdVcGRhdGVzKTsKICAgICAg\nICAgICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRhcyhj\nYWNoZSwgbW9kcy5leGlzdGluZ1VwZGF0ZXMpOwogICAgICAgICAgICAgICAg\nICAgIGNhY2hlLmNvbW1pdChtb2RzLmFkZGl0aW9ucywgbW9kcy5uZXdVcGRh\ndGVzLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RzLmV4aXN0aW5nVXBk\nYXRlcywgbW9kcy5kZWxldGVzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgd2Ugd2VyZSBpbiBsYXJnZVRyYW5zYWN0aW9uIG1vZGUs\nIHRoZW4gd2UgaGF2ZSByZWNvcmRlZAogICAgICAgIC8vIHRoZSBjbGFzc2Vz\nIG9mIHVwZGF0ZWQvZGVsZXRlZCBvYmplY3RzIGFuZCB0aGVzZSBub3cgbmVl\nZCB0byBiZQogICAgICAgIC8vIGV2aWN0ZWQKICAgICAgICBpZiAoX2N0eC5p\nc1RyYWNrQ2hhbmdlc0J5VHlwZSgpKSB7CiAgICAgICAgICAgIGV2aWN0VHlw\nZXMoX2N0eC5nZXREZWxldGVkVHlwZXMoKSk7CiAgICAgICAgICAgIGV2aWN0\nVHlwZXMoX2N0eC5nZXRVcGRhdGVkVHlwZXMoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBhbmQgbm90aWZ5IHRoZSBxdWVyeSBjYWNoZS4gIG5vdGlmeSBp\nbiBvbmUgYmF0Y2ggdG8gcmVkdWNlIHN5bmNoCiAgICAgICAgUXVlcnlDYWNo\nZSBxdWVyeUNhY2hlID0gX2N0eC5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAg\nICAgICAgIGdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLmdldFN5c3Rl\nbVF1ZXJ5Q2FjaGUoKTsKICAgICAgICBpZiAocXVlcnlDYWNoZSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gcGVycyA9IF9jdHguZ2V0UGVy\nc2lzdGVkVHlwZXMoKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBkZWwgPSBf\nY3R4LmdldERlbGV0ZWRUeXBlcygpOwogICAgICAgICAgICBDb2xsZWN0aW9u\nIHVwID0gX2N0eC5nZXRVcGRhdGVkVHlwZXMoKTsKICAgICAgICAgICAgaW50\nIHNpemUgPSBwZXJzLnNpemUoKSArIGRlbC5zaXplKCkgKyB1cC5zaXplKCk7\nCiAgICAgICAgICAgIGlmIChzaXplID4gMCkgewogICAgICAgICAgICAgICAg\nQ29sbGVjdGlvbiB0eXBlcyA9IG5ldyBBcnJheUxpc3Qoc2l6ZSk7CiAgICAg\nICAgICAgICAgICB0eXBlcy5hZGRBbGwocGVycyk7CiAgICAgICAgICAgICAg\nICB0eXBlcy5hZGRBbGwoZGVsKTsKICAgICAgICAgICAgICAgIHR5cGVzLmFk\nZEFsbCh1cCk7CiAgICAgICAgICAgICAgICBxdWVyeUNhY2hlLm9uVHlwZXND\naGFuZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVudCh0aGlzLCB0eXBlcykpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVHJhbnNmb3JtcyBhIGNvbGxlY3Rpb24gb2Yge0BsaW5rIFBDRGF0YUhvbGRl\ncn1zIHRoYXQgbWlnaHQgY29udGFpbgogICAgICogc3RhbGUgaW5zdGFuY2Vz\nIGludG8gYSBjb2xsZWN0aW9uIG9mIHVwLXRvLWRhdGUge0BsaW5rIERhdGFD\nYWNoZVBDRGF0YX1zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNm\nb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoRGF0YUNhY2hlIGNhY2hlLAogICAg\nICAgIExpc3QgaG9sZGVycykgewogICAgICAgIFBDRGF0YUhvbGRlciBob2xk\nZXI7CiAgICAgICAgRGF0YUNhY2hlUENEYXRhIG9sZHBjOwogICAgICAgIGZv\nciAoTGlzdEl0ZXJhdG9yIGl0ZXIgPSBob2xkZXJzLmxpc3RJdGVyYXRvcigp\nOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgaG9sZGVyID0gKFBD\nRGF0YUhvbGRlcikgaXRlci5uZXh0KCk7CiAgICAgICAgICAgIG9sZHBjID0g\nY2FjaGUuZ2V0KGhvbGRlci5zbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAg\nICAgaWYgKG9sZHBjICE9IG51bGwgJiYgY29tcGFyZVZlcnNpb24oaG9sZGVy\nLnNtLAogICAgICAgICAgICAgICAgaG9sZGVyLnNtLmdldFZlcnNpb24oKSwg\nb2xkcGMuZ2V0VmVyc2lvbigpKSA9PSBWRVJTSU9OX0VBUkxJRVIpCiAgICAg\nICAgICAgICAgICBpdGVyLnJlbW92ZSgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBpdGVyLnNldChob2xkZXIucGNkYXRhKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSB7QGxpbmsgTW9k\naWZpY2F0aW9uc30gaW5zdGFuY2UgdG8gdHJhY2sgbW9kaWZpY2F0aW9ucwog\nICAgICogdG8gdGhlIGdpdmVuIGNhY2hlLCBjcmVhdGluZyBhbmQgY2FjaGlu\nZyB0aGUgaW5zdGFuY2UgaWYgaXQgZG9lcwogICAgICogbm90IGFscmVhZHkg\nZXhpc3QgaW4gdGhlIGdpdmVuIG1hcC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgTW9kaWZpY2F0aW9ucyBnZXRNb2RpZmljYXRpb25zKE1hcCBtb2RN\nYXAsIERhdGFDYWNoZSBjYWNoZSkgewogICAgICAgIE1vZGlmaWNhdGlvbnMg\nbW9kcyA9IChNb2RpZmljYXRpb25zKSBtb2RNYXAuZ2V0KGNhY2hlKTsKICAg\nICAgICBpZiAobW9kcyA9PSBudWxsKSB7CiAgICAgICAgICAgIG1vZHMgPSBu\nZXcgTW9kaWZpY2F0aW9ucygpOwogICAgICAgICAgICBtb2RNYXAucHV0KGNh\nY2hlLCBtb2RzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1vZHM7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gZXhpc3RzKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIE9iamVjdCBlZGF0YSkgewogICAgICAgIERhdGFDYWNoZSBj\nYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAg\nICAgaWYgKGNhY2hlICE9IG51bGwgJiYgIWlzTG9ja2luZyhudWxsKQogICAg\nICAgICAgICAmJiBjYWNoZS5jb250YWlucyhzbS5nZXRPYmplY3RJZCgpKSkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIHN1cGVy\nLmV4aXN0cyhzbSwgZWRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHN5bmNWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBl\nZGF0YSkgewogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFE\nYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51\nbGwgfHwgc20uaXNFbWJlZGRlZCgpKQogICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuc3luY1ZlcnNpb24oc20sIGVkYXRhKTsKCiAgICAgICAgRGF0YUNhY2hl\nUENEYXRhIGRhdGE7CiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBudWxsOwog\nICAgICAgIGRhdGEgPSBjYWNoZS5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CiAg\nICAgICAgaWYgKCFpc0xvY2tpbmcobnVsbCkgJiYgZGF0YSAhPSBudWxsKQog\nICAgICAgICAgICB2ZXJzaW9uID0gZGF0YS5nZXRWZXJzaW9uKCk7CgogICAg\nICAgIC8vIGlmIHdlIGhhdmUgYSBjYWNoZWQgdmVyc2lvbiB1cGRhdGUgZnJv\nbSB0aGVyZQogICAgICAgIGlmICh2ZXJzaW9uICE9IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKCF2ZXJzaW9uLmVxdWFscyhzbS5nZXRWZXJzaW9uKCkpKSB7\nCiAgICAgICAgICAgICAgICBzbS5zZXRWZXJzaW9uKHZlcnNpb24pOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gdXNl\nIGRhdGEgc3RvcmUgdmVyc2lvbgogICAgICAgIHJldHVybiBzdXBlci5zeW5j\nVmVyc2lvbihzbSwgZWRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGluaXRpYWxpemUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBz\ndGF0ZSwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVj\ndCBlZGF0YSkgewogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09\nIG51bGwgfHwgc20uaXNFbWJlZGRlZCgpKQogICAgICAgICAgICByZXR1cm4g\nc3VwZXIuaW5pdGlhbGl6ZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSk7Cgog\nICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRhID0gY2FjaGUuZ2V0KHNtLmdl\ndE9iamVjdElkKCkpOwogICAgICAgIGlmIChkYXRhICE9IG51bGwgJiYgIWlz\nTG9ja2luZyhmZXRjaCkpIHsKICAgICAgICAgICAgLy8jIyMgdGhlICdkYXRh\nLnR5cGUnIGFjY2VzcyBoZXJlIHByb2JhYmx5IG5lZWRzIHRvIGJlCiAgICAg\nICAgICAgIC8vIyMjIGFkZHJlc3NlZCBmb3IgYnVnIDUxMQogICAgICAgICAg\nICBzbS5pbml0aWFsaXplKGRhdGEuZ2V0VHlwZSgpLCBzdGF0ZSk7CiAgICAg\nICAgICAgIGRhdGEubG9hZChzbSwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBpbml0aWFs\naXplIGZyb20gc3RvcmUgbWFuYWdlcgogICAgICAgIGlmICghc3VwZXIuaW5p\ndGlhbGl6ZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIV9jdHguZ2V0UG9wdWxhdGVE\nYXRhQ2FjaGUoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAg\nIC8vIG1ha2Ugc3VyZSB0aGF0IHdlJ3JlIG5vdCB0cnlpbmcgdG8gY2FjaGUg\nYW4gb2xkIHZlcnNpb24KICAgICAgICBjYWNoZS53cml0ZUxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNtLmdl\ndE9iamVjdElkKCkpOwogICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYm\nIGNvbXBhcmVWZXJzaW9uKHNtLCBzbS5nZXRWZXJzaW9uKCksCiAgICAgICAg\nICAgICAgICBkYXRhLmdldFZlcnNpb24oKSkgPT0gVkVSU0lPTl9FQVJMSUVS\nKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAv\nLyBjYWNoZSBuZXdseSBsb2FkZWQgaW5mby4gSXQgaXMgc2FmZSB0byBjYWNo\nZSBkYXRhIGZyb3JtCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUoKSBiZWNh\ndXNlIHRoaXMgbWV0aG9kIGlzIG9ubHkgY2FsbGVkIHVwb24KICAgICAgICAg\nICAgLy8gaW5pdGlhbCBsb2FkIG9mIHRoZSBkYXRhLgogICAgICAgICAgICBp\nZiAoZGF0YSA9PSBudWxsKQogICAgICAgICAgICAgICAgZGF0YSA9IG5ld1BD\nRGF0YShzbSk7CiAgICAgICAgICAgIGRhdGEuc3RvcmUoc20pOwogICAgICAg\nICAgICBjYWNoZS5wdXQoZGF0YSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9h\nZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAg\nICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwg\nT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgRGF0YUNhY2hlIGNhY2hlID0gc20u\nZ2V0TWV0YURhdGEoKS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICBpZiAoY2Fj\naGUgPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5sb2FkKHNtLCBmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWws\nIGVkYXRhKTsKCiAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRhdGEgPSBjYWNo\nZS5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgaWYgKGxvY2tMZXZl\nbCA9PSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSAmJiAhaXNMb2NraW5nKGZldGNo\nKQogICAgICAgICAgICAmJiBkYXRhICE9IG51bGwpCiAgICAgICAgICAgIGRh\ndGEubG9hZChzbSwgZmllbGRzLCBmZXRjaCwgZWRhdGEpOwogICAgICAgIGlm\nIChmaWVsZHMubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CgogICAgICAgIC8vIGxvYWQgZnJvbSBzdG9yZSBtYW5hZ2VyOyBjbG9u\nZSB0aGUgc2V0IG9mIHN0aWxsLXVubG9hZGVkIGZpZWxkcwogICAgICAgIC8v\nIHNvIHRoYXQgaWYgdGhlIHN0b3JlIG1hbmFnZXIgZGVjaWRlcyB0byBtb2Rp\nZnkgaXQgaXQgd29uJ3QgYWZmZWN0IHVzCiAgICAgICAgaWYgKCFzdXBlci5s\nb2FkKHNtLCAoQml0U2V0KSBmaWVsZHMuY2xvbmUoKSwgZmV0Y2gsIGxvY2tM\nZXZlbCwgZWRhdGEpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgaWYgKCFfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCkpCiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIC8vIERvIG5vdCBsb2FkIGNoYW5n\nZXMgaW50byBjYWNoZSBpZiB0aGUgaW5zdGFuY2UgaGFzIGJlZW4gZmx1c2hl\nZAogICAgICAgIGlmIChzbS5pc0ZsdXNoZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHdlJ3JlIG5v\ndCB0cnlpbmcgdG8gY2FjaGUgYW4gb2xkIHZlcnNpb24KICAgICAgICBjYWNo\nZS53cml0ZUxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBkYXRh\nID0gY2FjaGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICBp\nZiAoZGF0YSAhPSBudWxsICYmIGNvbXBhcmVWZXJzaW9uKHNtLCBzbS5nZXRW\nZXJzaW9uKCksCiAgICAgICAgICAgICAgICBkYXRhLmdldFZlcnNpb24oKSkg\nPT0gVkVSU0lPTl9FQVJMSUVSKQogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CgogICAgICAgICAgICAvLyBjYWNoZSBuZXdseSBsb2FkZWQgaW5mbwog\nICAgICAgICAgICBib29sZWFuIGlzTmV3ID0gZGF0YSA9PSBudWxsOwogICAg\nICAgICAgICBpZiAoaXNOZXcpCiAgICAgICAgICAgICAgICBkYXRhID0gbmV3\nUENEYXRhKHNtKTsKICAgICAgICAgICAgZGF0YS5zdG9yZShzbSwgZmllbGRz\nKTsKICAgICAgICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAgICAgY2Fj\naGUucHV0KGRhdGEpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBjYWNoZS51cGRhdGUoZGF0YSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24g\nbG9hZEFsbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwgaW50IGxv\nYWQsCiAgICAJCUZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGVk\nYXRhKSB7CiAgICAgICAgaWYgKGlzTG9ja2luZyhmZXRjaCkpCiAgICAgICAg\nICAgIHJldHVybiBzdXBlci5sb2FkQWxsKHNtcywgc3RhdGUsIGxvYWQsIGZl\ndGNoLCBlZGF0YSk7CgogICAgICAgIE1hcCB1bmxvYWRlZCA9IG51bGw7CiAg\nICAgICAgTGlzdCBzbUxpc3QgPSBudWxsOwogICAgICAgIE1hcCBjYWNoZXMg\nPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc207CiAgICAgICAgRGF0YUNhY2hlIGNhY2hlOwogICAgICAgIERhdGFDYWNo\nZVBDRGF0YSBkYXRhOwogICAgICAgIEJpdFNldCBmaWVsZHM7CgogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGNhY2hlID0gc20uZ2V0TWV0\nYURhdGEoKS5nZXREYXRhQ2FjaGUoKTsKICAgICAgICAgICAgaWYgKGNhY2hl\nID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAg\nICB1bmxvYWRlZCA9IGFkZFVubG9hZGVkKHNtLCBudWxsLCB1bmxvYWRlZCk7\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpID09IG51bGwK\nICAgICAgICAgICAgICAgIHx8IGxvYWQgIT0gRk9SQ0VfTE9BRF9OT05FCiAg\nICAgICAgICAgICAgICB8fCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5I\nT0xMT1cpIHsKICAgICAgICAgICAgICAgIHNtTGlzdCA9IChMaXN0KSBjYWNo\nZXMuZ2V0KGNhY2hlKTsKICAgICAgICAgICAgICAgIGlmIChzbUxpc3QgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHNtTGlzdCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgICAgICAgICBjYWNoZXMucHV0KGNhY2hl\nLCBzbUxpc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nc21MaXN0LmFkZChzbSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWNhY2hl\nLmNvbnRhaW5zKHNtLmdldE9iamVjdElkKCkpKQogICAgICAgICAgICAgICAg\ndW5sb2FkZWQgPSBhZGRVbmxvYWRlZChzbSwgbnVsbCwgdW5sb2FkZWQpOwog\nICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGNhY2hlcy5rZXlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBjYWNoZSA9IChEYXRhQ2FjaGUpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIHNtTGlzdCA9IChMaXN0KSBjYWNoZXMuZ2V0KGNhY2hl\nKTsKICAgICAgICAgICAgTGlzdCBvaWRMaXN0ID0gbmV3IEFycmF5TGlzdChz\nbUxpc3Quc2l6ZSgpKTsKCiAgICAgICAgICAgIGZvciAoaXRyPXNtTGlzdC5p\ndGVyYXRvcigpO2l0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBz\nbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgb2lkTGlzdC5hZGQoKE9wZW5KUEFJZCkgc20uZ2V0T2JqZWN0\nSWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAg\nIE1hcCBkYXRhTWFwID0gY2FjaGUuZ2V0QWxsKG9pZExpc3QpOwoKICAgICAg\nICAgICAgZm9yIChpdHI9c21MaXN0Lml0ZXJhdG9yKCk7aXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBkYXRhID0gKERhdGFD\nYWNoZVBDRGF0YSkgZGF0YU1hcC5nZXQoCiAgICAgICAgICAgICAgICAgICAg\nICAgIChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkpOwoKICAgICAgICAg\nICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAvLyMjIyB0aGUgJ2RhdGEudHlwZScgYWNj\nZXNzIGhlcmUgcHJvYmFibHkgbmVlZHMKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8jIyMgdG8gYmUgYWRkcmVzc2VkIGZvciBidWcgNTExCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUoZGF0YS5nZXRUeXBlKCks\nIHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5sb2FkKHNt\nLCBmZXRjaCwgZWRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICB1bmxvYWRlZCA9IGFkZFVubG9hZGVk\nKHNtLCBudWxsLCB1bmxvYWRlZCk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\naWYgKGxvYWQgIT0gRk9SQ0VfTE9BRF9OT05FCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykg\newogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjYWNoZS5nZXQoc20uZ2V0\nT2JqZWN0SWQoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2FkIHVubG9h\nZGVkIGZpZWxkcwogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBz\nbS5nZXRVbmxvYWRlZChmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGRhdGEubG9hZChzbSwgZmllbGRzLCBmZXRjaCwgZWRhdGEpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoZmllbGRzLmxlbmd0aCgpID4gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2Fk\nZWQoc20sIGZpZWxkcywgdW5sb2FkZWQpOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB1bmxvYWRlZCA9IGFk\nZFVubG9hZGVkKHNtLCBudWxsLCB1bmxvYWRlZCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh1bmxv\nYWRlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVDsKCiAgICAgICAgLy8gbG9hZCB3aXRoIGRlbGVnYXRlCiAg\nICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBzdXBlci5sb2FkQWxsKHVubG9h\nZGVkLmtleVNldCgpLCBzdGF0ZSwgbG9hZCwKICAgICAgICAgICAgZmV0Y2gs\nIGVkYXRhKTsKICAgICAgICBpZiAoIV9jdHguZ2V0UG9wdWxhdGVEYXRhQ2Fj\naGUoKSkKICAgICAgICAgICAgcmV0dXJuIGZhaWxlZDsKCiAgICAgICAgLy8g\nZm9yIGVhY2ggbG9hZGVkIGluc3RhbmNlLCBtZXJnZSBsb2FkZWQgc3RhdGUg\naW50byBjYWNoZWQgZGF0YQogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAg\nICAgICBib29sZWFuIGlzTmV3OwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gdW5sb2FkZWQuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIp\nIGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICBmaWVsZHMgPSAoQml0U2V0\nKSBlbnRyeS5nZXRWYWx1ZSgpOwoKICAgICAgICAgICAgY2FjaGUgPSBzbS5n\nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAgICAgICAgICBpZiAo\nY2FjaGUgPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkgfHwgKGZhaWxlZCAh\nPSBudWxsCiAgICAgICAgICAgICAgICAmJiBmYWlsZWQuY29udGFpbnMoc20u\nZ2V0SWQoKSkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAvLyBtYWtlIHN1cmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNh\nY2hlIGFuIG9sZCB2ZXJzaW9uCiAgICAgICAgICAgIGNhY2hlLndyaXRlTG9j\naygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGF0YSA9\nIGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgICAg\nIGlmIChkYXRhICE9IG51bGwgJiYgY29tcGFyZVZlcnNpb24oc20sIHNtLmdl\ndFZlcnNpb24oKSwKICAgICAgICAgICAgICAgICAgICBkYXRhLmdldFZlcnNp\nb24oKSkgPT0gVkVSU0lPTl9FQVJMSUVSKQogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlzTmV3ID0gZGF0YSA9PSBu\ndWxsOwogICAgICAgICAgICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAg\nICAgICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAgICAgICAgICAgICAg\naWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGRhdGEu\nc3RvcmUoc20pOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIGRhdGEuc3RvcmUoc20sIGZpZWxkcyk7CiAgICAgICAgICAgICAg\nICBpZiAoaXNOZXcpCiAgICAgICAgICAgICAgICAgICAgY2FjaGUucHV0KGRh\ndGEpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIGNhY2hlLnVwZGF0ZShkYXRhKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhaWxlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIGFuIHVubG9h\nZGVkIGluc3RhbmNlIHRvIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIE1hcCBhZGRVbmxvYWRlZChPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIE1hcCB1bmxvYWRlZCkg\newogICAgICAgIGlmICh1bmxvYWRlZCA9PSBudWxsKQogICAgICAgICAgICB1\nbmxvYWRlZCA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgdW5sb2FkZWQucHV0\nKHNtLCBmaWVsZHMpOwogICAgICAgIHJldHVybiB1bmxvYWRlZDsKICAgIH0K\nCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBmbHVzaChDb2xsZWN0aW9uIHN0YXRl\ncykgewogICAgICAgIENvbGxlY3Rpb24gZXhjZXBzID0gc3VwZXIuZmx1c2go\nc3RhdGVzKTsKCiAgICAgICAgLy8gaWYgdGhlcmUgd2VyZSBlcnJvcnMgZXZp\nY3QgYmFkIGluc3RhbmNlcyBhbmQgZG9uJ3QgcmVjb3JkIGNoYW5nZXMKICAg\nICAgICBpZiAoIWV4Y2Vwcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdGVyID0gZXhjZXBzLml0ZXJhdG9yKCk7IGl0ZXIuaGFz\nTmV4dCgpOyApIHsKICAgICAgICAgICAgICAgIEV4Y2VwdGlvbiBlID0gKEV4\nY2VwdGlvbikgaXRlci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoZSBp\nbnN0YW5jZW9mIE9wdGltaXN0aWNFeGNlcHRpb24pCiAgICAgICAgICAgICAg\nICAgICAgbm90aWZ5T3B0aW1pc3RpY0xvY2tGYWlsdXJlKChPcHRpbWlzdGlj\nRXhjZXB0aW9uKSBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gZXhjZXBzOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgbGFyZ2UgdHJh\nbnNhY3Rpb24gbW9kZSBkb24ndCByZWNvcmQgaW5kaXZpZHVhbCBjaGFuZ2Vz\nCiAgICAgICAgaWYgKF9jdHguaXNUcmFja0NoYW5nZXNCeVR5cGUoKSkKICAg\nICAgICAgICAgcmV0dXJuIGV4Y2VwczsKCiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRl\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBz\nbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpdHIubmV4dCgpOwoKICAgICAg\nICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVcgJiYg\nIXNtLmlzRmx1c2hlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX2luc2Vy\ndHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfaW5zZXJ0cyA9IG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIF9pbnNlcnRzLmFkZChz\nbSk7CgogICAgICAgICAgICAgICAgLy8gbWF5IGhhdmUgYmVlbiByZS1wZXJz\naXN0ZWQKICAgICAgICAgICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9kZWxldGVzLnJlbW92ZShzbSk7CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAoX2luc2VydHMgIT0gbnVsbCAKICAgICAgICAg\nICAgICAgICYmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXREVM\nRVRFRCAKICAgICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLlBORVdGTFVTSEVEREVMRVRFRCkpCiAgICAgICAgICAgICAgICBf\naW5zZXJ0cy5yZW1vdmUoc20pOwogICAgICAgICAgICBlbHNlIGlmIChzbS5n\nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QRElSVFkpIHsKICAgICAgICAgICAg\nICAgIGlmIChfdXBkYXRlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF91cGRhdGVzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF91\ncGRhdGVzLnB1dChzbSwgc20uZ2V0RGlydHkoKSk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUERFTEVURUQp\nIHsKICAgICAgICAgICAgICAgIGlmIChfZGVsZXRlcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9kZWxldGVzID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgICAgIF9kZWxldGVzLmFkZChzbSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJ\nU1Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXJlIGxvY2FsIHN0YWxlbmVz\ncyBkZXRlY3Rpb24gZXZlbnRzIGZyb20gdGhlIGNhY2hlIHRoZSBPSUQgKGlm\nCiAgICAgKiBhdmFpbGFibGUpIHRoYXQgcmVzdWx0ZWQgaW4gYW4gb3B0aW1p\nc3RpYyBsb2NrIGV4Y2VwdGlvbiBpZmYgdGhlCiAgICAgKiB2ZXJzaW9uIGlu\nZm9ybWF0aW9uIGluIHRoZSBjYWNoZSBtYXRjaGVzIHRoZSB2ZXJzaW9uIGlu\nZm9ybWF0aW9uCiAgICAgKiBpbiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGZhaWxlZCBpbnN0YW5jZS4gVGhpcyBtZWFucyB0aGF0IHdlCiAgICAgKiB3\naWxsIGV2aWN0IGRhdGEgZnJvbSB0aGUgY2FjaGUgZm9yIHJlY29yZHMgdGhh\ndCBzaG91bGQgaGF2ZQogICAgICogc3VjY2Vzc2Z1bGx5IGNvbW1pdHRlZCBh\nY2NvcmRpbmcgdG8gdGhlIGRhdGEgY2FjaGUgYnV0CiAgICAgKiBkaWQgbm90\nLiBUaGUgb25seSBwcmVkaWN0YWJsZSByZWFzb24gdGhhdCBjb3VsZCBjYXVz\nZSB0aGlzIGJlaGF2aW9yCiAgICAgKiBpcyBhIGNvbmN1cnJlbnQgb3V0LW9m\nLWJhbmQgbW9kaWZpY2F0aW9uIHRvIHRoZSBkYXRhYmFzZSB0aGF0IHdhcyBu\nb3QgCiAgICAgKiBjb21tdW5pY2F0ZWQgdG8gdGhlIGNhY2hlLiBUaGlzIGxv\nZ2ljIG1ha2VzIE9wZW5KUEEncyBkYXRhIGNhY2hlIAogICAgICogc29tZXdo\nYXQgdG9sZXJhbnQgb2Ygc3VjaCBiZWhhdmlvciwgaW4gdGhhdCB0aGUgY2Fj\naGUgd2lsbCBiZSBjbGVhbmVkIAogICAgICogdXAgYXMgZmFpbHVyZXMgb2Nj\ndXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBub3RpZnlPcHRpbWlzdGlj\nTG9ja0ZhaWx1cmUoT3B0aW1pc3RpY0V4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nT2JqZWN0IG8gPSBlLmdldEZhaWxlZE9iamVjdCgpOwogICAgICAgIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20gPSBfY3R4LmdldFN0YXRlTWFuYWdlcihvKTsK\nICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIE9iamVjdCBvaWQgPSBzbS5nZXRJZCgpOwogICAgICAgIGJvb2xl\nYW4gcmVtb3ZlOwoKICAgICAgICAvLyB0aGlzIGxvZ2ljIGNvdWxkIGJlIG1v\ncmUgZWZmaWNpZW50IC0tIHdlIGNvdWxkIGFnZ3JlZ2F0ZQogICAgICAgIC8v\nIGFsbCB0aGUgY2FjaGUtPm9pZCBjaGFuZ2VzLCBhbmQgdGhlbiB1c2UgRGF0\nYUNhY2hlLnJlbW92ZUFsbCgpIAogICAgICAgIC8vIGFuZCBsZXNzIHdyaXRl\nIGxvY2tzIHRvIGRvIHRoZSBtdXRhdGlvbi4KICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIERhdGFDYWNo\nZSBjYWNoZSA9IG1ldGEuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNh\nY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgY2Fj\naGUud3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRGF0\nYUNhY2hlUENEYXRhIGRhdGEgPSBjYWNoZS5nZXQob2lkKTsKICAgICAgICAg\nICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIHN3aXRjaCAoY29tcGFyZVZlcnNpb24oc20sIHNtLmdl\ndFZlcnNpb24oKSwgZGF0YS5nZXRWZXJzaW9uKCkpKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0xBVEVSOgogICAgICAg\nICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVSU0lPTl9TQU1FOgogICAg\nICAgICAgICAgICAgICAgIC8vIFRoaXMgdHgncyBjdXJyZW50IHZlcnNpb24g\naXMgbGF0ZXIgdGhhbiBvciB0aGUgc2FtZSBhcyAKICAgICAgICAgICAgICAg\nICAgICAvLyB0aGUgZGF0YSBjYWNoZSB2ZXJzaW9uLiBJbiB0aGlzIGNhc2Us\nIHRoZSBjb21taXQgc2hvdWxkIAogICAgICAgICAgICAgICAgICAgIC8vIGhh\ndmUgc3VjY2VlZGVkIGZyb20gdGhlIHN0YW5kcG9pbnQgb2YgdGhlIGNhY2hl\nLiBSZW1vdmUgCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGluc3RhbmNl\nIGZyb20gY2FjaGUgaW4gdGhlIGhvcGVzIHRoYXQgdGhlIGNhY2hlIGlzIAog\nICAgICAgICAgICAgICAgICAgIC8vIG91dCBvZiBzeW5jLgogICAgICAgICAg\nICAgICAgICAgIHJlbW92ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJT\nSU9OX0VBUkxJRVI6CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB0eCdz\nIGN1cnJlbnQgdmVyc2lvbiBpcyBlYXJsaWVyIHRoYW4gdGhlIGRhdGEgCiAg\nICAgICAgICAgICAgICAgICAgLy8gY2FjaGUgdmVyc2lvbi4gVGhpcyBpcyBh\nIG5vcm1hbCBvcHRpbWlzdGljIGxvY2sgZmFpbHVyZS4gCiAgICAgICAgICAg\nICAgICAgICAgLy8gRG8gbm90IGNsZWFuIHVwIHRoZSBjYWNoZTsgaXQgcHJv\nYmFibHkgYWxyZWFkeSBoYXMgdGhlIAogICAgICAgICAgICAgICAgICAgIC8v\nIHJpZ2h0IHZhbHVlcywgYW5kIGlmIG5vdCwgaXQnbGwgZ2V0IGNsZWFuZWQg\ndXAgYnkgYSB0eAogICAgICAgICAgICAgICAgICAgIC8vIHRoYXQgZmFpbHMg\naW4gb25lIG9mIHRoZSBvdGhlciBjYXNlIHN0YXRlbWVudHMuCiAgICAgICAg\nICAgICAgICAgICAgcmVtb3ZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5W\nRVJTSU9OX0RJRkZFUkVOVDoKICAgICAgICAgICAgICAgICAgICAvLyBUaGUg\ndmVyc2lvbiBzdHJhdGVneSBmb3IgdGhlIGZhaWxlZCBvYmplY3QgZG9lcyBu\nb3QKICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBlbm91Z2ggaW5mb3Jt\nYXRpb24gdG8gb3B0aW1pemUgZm9yIGV4cGVjdGVkCiAgICAgICAgICAgICAg\nICAgICAgLy8gZmFpbHVyZXMuIENsZWFuIHVwIHRoZSBjYWNoZS4KICAgICAg\nICAgICAgICAgICAgICByZW1vdmUgPSB0cnVlOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICAvLyBVbmV4cGVjdGVkIHJldHVybiB2YWx1ZS4gUmVtb3Zl\nIHRvIGJlIGZ1dHVyZS1wcm9vZi4KICAgICAgICAgICAgICAgICAgICByZW1v\ndmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChyZW1vdmUpCiAgICAgICAgICAgICAg\nICAvLyByZW1vdmUgZGlyZWN0bHkgaW5zdGVhZCBvZiB2aWEgdGhlIFJlbW90\nZUNvbW1pdExpc3RlbmVyCiAgICAgICAgICAgICAgICAvLyBzaW5jZSB3ZSBo\nYXZlIGEgd3JpdGUgbG9jayBoZXJlIGFscmVhZHksIHNvIHRoaXMgaXMgbW9y\nZQogICAgICAgICAgICAgICAgLy8gZWZmaWNpZW50IHRoYW4gcmVhZC1sb2Nr\naW5nIGFuZCB0aGVuIHdyaXRlLWxvY2tpbmcgbGF0ZXIuCiAgICAgICAgICAg\nICAgICBjYWNoZS5yZW1vdmUoc20uZ2V0SWQoKSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGZpcmUgb2ZmIGEgcmVtb3RlIGNvbW1pdCBzdGFs\nZW5lc3NzIGRldGVjdGlvbiBldmVudC4KICAgICAgICBfY3R4LmdldENvbmZp\nZ3VyYXRpb24oKS5nZXRSZW1vdGVDb21taXRFdmVudE1hbmFnZXIoKQogICAg\nICAgICAgICAuZmlyZUxvY2FsU3RhbGVOb3RpZmljYXRpb24ob2lkKTsKICAg\nIH0KCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBuZXdRdWVyeShTdHJpbmcgbGFu\nZ3VhZ2UpIHsKICAgICAgICBTdG9yZVF1ZXJ5IHEgPSBzdXBlci5uZXdRdWVy\neShsYW5ndWFnZSk7CgogICAgICAgIC8vIGlmIHRoZSBxdWVyeSBjYW4ndCBi\nZSBwYXJzZWQgb3IgaXQncyB1c2luZyBhIG5vbi1wYXJzZWQgbGFuZ3VhZ2UK\nICAgICAgICAvLyAob25lIGZvciB3aGljaCB0aGVyZSBpcyBubyBFeHByZXNz\naW9uUGFyc2VyKSwgd2UgY2FuJ3QgY2FjaGUgaXQuCiAgICAgICAgaWYgKHEg\nPT0gbnVsbCB8fCBRdWVyeUxhbmd1YWdlcy5wYXJzZXJGb3JMYW5ndWFnZShs\nYW5ndWFnZSkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHE7CgogICAg\nICAgIFF1ZXJ5Q2FjaGUgcXVlcnlDYWNoZSA9IF9jdHguZ2V0Q29uZmlndXJh\ndGlvbigpLgogICAgICAgICAgICBnZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFu\nY2UoKS5nZXRTeXN0ZW1RdWVyeUNhY2hlKCk7CiAgICAgICAgaWYgKHF1ZXJ5\nQ2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHE7CgogICAgICAg\nIHJldHVybiBuZXcgUXVlcnlDYWNoZVN0b3JlUXVlcnkocSwgcXVlcnlDYWNo\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY2FjaGVh\nYmxlIGluc3RhbmNlIGZvciB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlci4KICAg\nICAqLwogICAgcHJpdmF0ZSBEYXRhQ2FjaGVQQ0RhdGEgbmV3UENEYXRhKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBDbGFzc01ldGFEYXRh\nIG1ldGEgPSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIGlmIChfZ2VuICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiAoRGF0YUNhY2hlUENEYXRhKSBf\nZ2VuLmdlbmVyYXRlUENEYXRhCiAgICAgICAgICAgICAgICAoc20uZ2V0T2Jq\nZWN0SWQoKSwgbWV0YSk7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQ2FjaGVQ\nQ0RhdGFJbXBsKHNtLmZldGNoT2JqZWN0SWQoKSwgbWV0YSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgY29udGV4dCBpcyBs\nb2NraW5nIGxvYWRlZCBkYXRhLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gaXNMb2NraW5nKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAg\nICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IF9j\ndHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGZl\ndGNoLmdldFJlYWRMb2NrTGV2ZWwoKSA+IExvY2tMZXZlbHMuTE9DS19OT05F\nOwogICAgfQoKICAgIC8qKgogICAgICogU3RydWN0dXJlIHVzZWQgZHVyaW5n\nIHRoZSBjb21taXQgcHJvY2VzcyB0byB0cmFjayBjYWNoZSBtb2RpZmljYXRp\nb25zLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNb2RpZmlj\nYXRpb25zIHsKCiAgICAgICAgcHVibGljIGZpbmFsIExpc3QgYWRkaXRpb25z\nID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgIHB1YmxpYyBmaW5hbCBMaXN0\nIG5ld1VwZGF0ZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgcHVibGlj\nIGZpbmFsIExpc3QgZXhpc3RpbmdVcGRhdGVzID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgIHB1YmxpYyBmaW5hbCBMaXN0IGRlbGV0ZXMgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUENE\nYXRhSG9sZGVyIHsKCiAgICAgICAgcHVibGljIGZpbmFsIERhdGFDYWNoZVBD\nRGF0YSBwY2RhdGE7CiAgICAgICAgcHVibGljIGZpbmFsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc207CgogICAgICAgIHB1YmxpYyBQQ0RhdGFIb2xkZXIoRGF0\nYUNhY2hlUENEYXRhIHBjZGF0YSwKICAgICAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSkgewogICAgICAgICAgICB0aGlzLnBjZGF0YSA9IHBjZGF0\nYTsKICAgICAgICAgICAgdGhpcy5zbSA9IHNtOwoJCX0KCX0KfQoK\n","encoding":"base64"}

