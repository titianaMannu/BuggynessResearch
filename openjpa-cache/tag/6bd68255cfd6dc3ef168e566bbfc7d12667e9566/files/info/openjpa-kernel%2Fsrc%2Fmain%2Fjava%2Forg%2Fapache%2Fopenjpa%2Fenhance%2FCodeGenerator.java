{"sha":"981937aa634ab3e581be80d2067968ba47b0eac5","node_id":"MDQ6QmxvYjIwNjM2NDo5ODE5MzdhYTYzNGFiM2U1ODFiZTgwZDIwNjc5NjhiYTQ3YjBlYWM1","size":21771,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/981937aa634ab3e581be80d2067968ba47b0eac5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5pby5Xcml0ZXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7\nCmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRyZWVT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5sYW5nLldvcmRVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkNvZGVGb3JtYXQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuUGFyYW1ldGVyVGVtcGxhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEdlbmVyYXRlcyBKYXZhIGNs\nYXNzIGNvZGUgZnJvbSBtZXRhZGF0YS4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICogQGF1dGhvciBTdGVwaGVuIEtpbQogKiBAc2luY2UgMC4zLjAKICog\nQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIENvZGVHZW5lcmF0b3IgewoK\nICAgIHByaXZhdGUgRmlsZSBfZGlyID0gbnVsbDsKICAgIHByaXZhdGUgQ29k\nZUZvcm1hdCBfZm9ybWF0ID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRh\nRGF0YSBfbWV0YSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF90eXBlID0g\nbnVsbDsKICAgIHByaXZhdGUgUGFyYW1ldGVyVGVtcGxhdGUgX2NvZGUgPSBu\ndWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25m\naWd1cmF0aW9uIGFuZCBjbGFzcyB0byBnZW5lcmF0ZSBjb2RlIGZvci4KICAg\nICAqLwogICAgcHVibGljIENvZGVHZW5lcmF0b3IoT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24gY29uZiwgQ2xhc3MgdHlwZSkgewogICAgICAgIHRoaXMoY29uZi5u\nZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICBn\nZXRNZXRhRGF0YSh0eXBlLCBudWxsLCB0cnVlKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24gYW5k\nIG1ldGFkYXRhIHRvIGdlbmVyYXRlIGNvZGUgZm9yLgogICAgICovCiAgICBw\ndWJsaWMgQ29kZUdlbmVyYXRvcihDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBfbWV0YSA9IG1ldGE7CiAgICAgICAgX3R5cGUgPSBtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkaXJl\nY3RvcnkgdG8gd3JpdGUgc291cmNlIHRvLiBEZWZhdWx0cyB0byB0aGUgY3Vy\ncmVudCBkaXJlY3RvcnkuCiAgICAgKiBJZiB0aGUgZ2l2ZW4gZGlyZWN0b3J5\nIGRvZXMgbm90IG1hdGNoIHRoZSBwYWNrYWdlIG9mIHRoZSBtZXRhZGF0YSwg\ndGhlCiAgICAgKiBwYWNrYWdlIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQg\nYmVsb3cgdGhlIGRpcmVjdG9yeS4KICAgICAqLwogICAgcHVibGljIEZpbGUg\nZ2V0Q29kZURpcmVjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2RpcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBkaXJlY3RvcnkgdG8gd3JpdGUgc291\ncmNlIHRvLiBEZWZhdWx0cyB0byB0aGUgY3VycmVudCBkaXJlY3RvcnkuCiAg\nICAgKiBJZiB0aGUgZ2l2ZW4gZGlyZWN0b3J5IGRvZXMgbm90IG1hdGNoIHRo\nZSBwYWNrYWdlIG9mIHRoZSBtZXRhZGF0YSwgdGhlCiAgICAgKiBwYWNrYWdl\nIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVsb3cgdGhlIGRpcmVjdG9y\neS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGlyZWN0b3J5KEZpbGUg\nZGlyKSB7CiAgICAgICAgX2RpciA9IGRpcjsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBjb2RlIGZvcm1hdHRlciBmb3IgdGhlIGdlbmVyYXRlZCBKYXZh\nIGNvZGUuCiAgICAgKi8KICAgIHB1YmxpYyBDb2RlRm9ybWF0IGdldENvZGVG\nb3JtYXQoKSB7CiAgICAgICAgcmV0dXJuIF9mb3JtYXQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGNvZGUgZm9ybWF0dGVyIGZvciB0aGUgZ2Vu\nZXJhdGVkIEphdmEgY29kZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQ29kZUZvcm1hdChDb2RlRm9ybWF0IGZvcm1hdCkgewogICAgICAgIF9mb3Jt\nYXQgPSBmb3JtYXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHR5cGUgYmVpbmcgZ2VuZXJhdGVkLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3MgZ2V0VHlwZSgpIHsKICAgICAgICByZXR1cm4gX3R5cGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gbWV0YWRhdGEgZm9yIHRoZSB0eXBlIGJl\naW5nIGdlbmVyYXRlZC4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURh\ndGEgZ2V0TWV0YURhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9tZXRhOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBnZW5lcmF0ZWQgY29kZSwg\nb3IgbnVsbCBpZiB7QGxpbmsgI2dlbmVyYXRlQ29kZX0gaGFzIG5vdAogICAg\nICogYmVlbiBjYWxsZWQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ29kZSgpIHsKICAgICAgICByZXR1cm4gKF9jb2RlID09IG51bGwpID8gbnVs\nbCA6IF9jb2RlLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\ncml0ZXMgdGhlIGdlbmVyYXRlZCBjb2RlIHRvIHRoZSBwcm9wZXIgZGlyZWN0\nb3J5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZUNvZGUoKSB7\nCiAgICAgICAgLy8gc2V0dXAgcGFyYW1ldGVycwogICAgICAgIFN0cmluZyBj\nbGFzc05hbWUgPSBTdHJpbmdzLmdldENsYXNzTmFtZShfdHlwZSk7CiAgICAg\nICAgU3RyaW5nIHBhY2thZ2VOYW1lID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFt\nZShfdHlwZSk7CiAgICAgICAgU3RyaW5nIHBhY2thZ2VEZWMgPSAiIjsKICAg\nICAgICBpZiAocGFja2FnZU5hbWUubGVuZ3RoKCkgPiAwKQogICAgICAgICAg\nICBwYWNrYWdlRGVjID0gInBhY2thZ2UgIiArIHBhY2thZ2VOYW1lICsgIjsi\nOwoKICAgICAgICBTdHJpbmcgZXh0ZW5kc0RlYyA9ICIiOwogICAgICAgIFN0\ncmluZyBleHRlbmRzTmFtZSA9ICIiOwogICAgICAgIGlmICghX3R5cGUuZ2V0\nU3VwZXJjbGFzcygpLmdldE5hbWUoKS5lcXVhbHMoT2JqZWN0LmNsYXNzLmdl\ndE5hbWUoKSkpIHsKICAgICAgICAgICAgZXh0ZW5kc05hbWUgPSBTdHJpbmdz\nLmdldENsYXNzTmFtZShfdHlwZS5nZXRTdXBlcmNsYXNzKCkpOwogICAgICAg\nICAgICBleHRlbmRzRGVjID0gImV4dGVuZHMgIiArIGV4dGVuZHNOYW1lOwog\nICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGltcG9ydHMgPSBnZXRJbXBvcnRz\nKCk7CiAgICAgICAgU3RyaW5nW10gZmllbGRDb2RlID0gZ2V0RmllbGRDb2Rl\nKCk7CiAgICAgICAgU3RyaW5nIGNvbnN0cnVjdG9yID0gZ2V0Q29uc3RydWN0\nb3IoKTsKCiAgICAgICAgLy8gZ2V0IGNvZGUgdGVtcGxhdGUKICAgICAgICBf\nY29kZSA9IG5ldyBQYXJhbWV0ZXJUZW1wbGF0ZSgpOwogICAgICAgIFN0cmlu\nZyBjb2RlU3RyID0gZ2V0Q2xhc3NDb2RlKCk7CiAgICAgICAgaWYgKGNvZGVT\ndHIgIT0gbnVsbCkgewogICAgICAgICAgICBfY29kZS5hcHBlbmQoY29kZVN0\ncik7CiAgICAgICAgICAgIF9jb2RlLnNldFBhcmFtZXRlcigicGFja2FnZURl\nYyIsIHBhY2thZ2VEZWMpOwogICAgICAgICAgICBfY29kZS5zZXRQYXJhbWV0\nZXIoImltcG9ydHMiLCBpbXBvcnRzKTsKICAgICAgICAgICAgX2NvZGUuc2V0\nUGFyYW1ldGVyKCJjbGFzc05hbWUiLCBjbGFzc05hbWUpOwogICAgICAgICAg\nICBfY29kZS5zZXRQYXJhbWV0ZXIoImV4dGVuZHNEZWMiLCBleHRlbmRzRGVj\nKTsKICAgICAgICAgICAgX2NvZGUuc2V0UGFyYW1ldGVyKCJjb25zdHJ1Y3Rv\nciIsIGNvbnN0cnVjdG9yKTsKICAgICAgICAgICAgX2NvZGUuc2V0UGFyYW1l\ndGVyKCJmaWVsZERlY3MiLCBmaWVsZENvZGVbMF0pOwogICAgICAgICAgICBf\nY29kZS5zZXRQYXJhbWV0ZXIoImZpZWxkQ29kZSIsIGZpZWxkQ29kZVsxXSk7\nCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIF9jb2RlLmFwcGVuZChnZXRD\nbGFzc0NvZGUocGFja2FnZURlYywgaW1wb3J0cywgY2xhc3NOYW1lLAogICAg\nICAgICAgICAgICAgZXh0ZW5kc05hbWUsIGNvbnN0cnVjdG9yLCBmaWVsZENv\nZGVbMF0sIGZpZWxkQ29kZVsxXSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nV3JpdGUgdGhlIGdlbmVyYXRlZCBjb2RlIHRvIHRoZSBwcm9wZXIgZmlsZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgd3JpdGVDb2RlKCkKICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChfY29kZSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEZpbGUgZmlsZSA9IGdl\ndEZpbGUoKTsKICAgICAgICBGaWxlcy5iYWNrdXAoZmlsZSwgZmFsc2UpOwog\nICAgICAgIF9jb2RlLndyaXRlKGZpbGUpOwogICAgfQoKICAgIC8qKgogICAg\nICogV3JpdGUgdGhlIGNvZGUgdG8gdGhlIHNwZWNpZmllZCB7QGxpbmsgV3Jp\ndGVyfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgd3JpdGVDb2RlKFdyaXRl\nciBvdXQpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoX2NvZGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBfY29kZS53cml0ZShvdXQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBuZWNlc3NhcnkgaW1wb3J0cyBmb3IgdGhlIGNsYXNzLgogICAg\nICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRJbXBvcnRzKCkgewogICAgICAg\nIFNldCBwa2dzID0gZ2V0SW1wb3J0UGFja2FnZXMoKTsKCiAgICAgICAgQ29k\nZUZvcm1hdCBpbXBvcnRzID0gbmV3Q29kZUZvcm1hdCgpOwogICAgICAgIFN0\ncmluZyBiYXNlID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShfdHlwZSk7CiAg\nICAgICAgU3RyaW5nIHBrZzsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIHBrZ3MuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgcGtnID0gKFN0cmluZykgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYg\nKHBrZy5sZW5ndGgoKSA+IDAgJiYgISJqYXZhLmxhbmciLmVxdWFscyhwa2cp\nCiAgICAgICAgICAgICAgICAmJiAhYmFzZS5lcXVhbHMocGtnKSkgewogICAg\nICAgICAgICAgICAgaWYgKGltcG9ydHMubGVuZ3RoKCkgPiAwKQogICAgICAg\nICAgICAgICAgICAgIGltcG9ydHMuZW5kbCgpOwogICAgICAgICAgICAgICAg\naW1wb3J0cy5hcHBlbmQoImltcG9ydCAiKS5hcHBlbmQocGtnKS5hcHBlbmQo\nIi4qOyIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBpbXBvcnRzLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBzZXQgb2YgcGFja2FnZXMgdGhhdCBuZWVkcyB0byBiZSBp\nbXBvcnRlZCBmb3IgdGhpcyBjb2RlLgogICAgICovCiAgICBwdWJsaWMgU2V0\nIGdldEltcG9ydFBhY2thZ2VzKCkgewogICAgICAgIFNldCBwa2dzID0gbmV3\nIFRyZWVTZXQoKTsKICAgICAgICBwa2dzLmFkZChTdHJpbmdzLmdldFBhY2th\nZ2VOYW1lKF90eXBlLmdldFN1cGVyY2xhc3MoKSkpOwoKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZmllbGRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgcGtncy5hZGQoU3RyaW5ncy5nZXRQYWNrYWdl\nTmFtZShmaWVsZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpKTsKCiAgICAgICAg\nZmllbGRzID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBwa2dzLmFkZChTdHJpbmdzLmdldFBhY2thZ2VOYW1lKGZpZWxk\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSkpOwoKICAgICAgICByZXR1cm4gcGtn\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBjb2RlIGZvciBhIHBy\naW1hcnkga2V5IGNvbnN0cnVjdG9yIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENvbnN0cnVjdG9yKCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBfbWV0YS5nZXRQcmlt\nYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgcmV0dXJuICIiOwoKICAgICAgICBDb2RlRm9ybWF0\nIGNvbnMgPSBuZXdDb2RlRm9ybWF0KCk7CiAgICAgICAgQ29kZUZvcm1hdCBi\nb2R5ID0gbmV3Q29kZUZvcm1hdCgpOwoKICAgICAgICAvLyBwdWJsaWMgPGNs\nYXNzPiAoCiAgICAgICAgY29ucy50YWIoKS5hcHBlbmQoInB1YmxpYyAiKS5h\ncHBlbmQoU3RyaW5ncy5nZXRDbGFzc05hbWUoX3R5cGUpKTsKICAgICAgICBj\nb25zLm9wZW5QYXJlbih0cnVlKTsKCiAgICAgICAgLy8gYXBwZW5kIGFyZ3Mg\ndG8gY29uc3RydWN0b3IsIGFuZCBidWlsZCB1cCBib2R5IGF0IHNhbWUgdGlt\nZQogICAgICAgIFN0cmluZyBwcm9wZXJ0eU5hbWU7CiAgICAgICAgU3RyaW5n\nIGZpZWxkVHlwZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwcm9wZXJ0eU5hbWUgPSBm\naWVsZHNbaV0uZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAocHJvcGVydHlO\nYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgICAgIHByb3BlcnR5\nTmFtZSA9IHByb3BlcnR5TmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAg\nIGZpZWxkVHlwZSA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKGZpZWxkc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgICAgICBpZiAoaSA+IDApCiAg\nICAgICAgICAgICAgICBjb25zLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAg\nY29ucy5hcHBlbmQoZmllbGRUeXBlKS5hcHBlbmQoIiAiKS5hcHBlbmQocHJv\ncGVydHlOYW1lKTsKCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVy\nY2xhc3MoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDAp\nCiAgICAgICAgICAgICAgICAgICAgYm9keS5lbmRsKCk7CiAgICAgICAgICAg\nICAgICBib2R5LnRhYigyKTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0\neU5hbWUuZXF1YWxzKGZpZWxkc1tpXS5nZXROYW1lKCkpKQogICAgICAgICAg\nICAgICAgICAgIGJvZHkuYXBwZW5kKCJ0aGlzLiIpOwogICAgICAgICAgICAg\nICAgYm9keS5hcHBlbmQoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgICAgICBib2R5LmFwcGVuZCgiID0gIikuYXBwZW5kKHByb3BlcnR5TmFt\nZSkuYXBwZW5kKCI7Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAvLyBzdXBlciAoLi4uKTsKICAgICAgICAgICAgICAgIGlmIChp\nID09IDApCiAgICAgICAgICAgICAgICAgICAgYm9keS50YWIoMikuYXBwZW5k\nKCJzdXBlciIpLm9wZW5QYXJlbih0cnVlKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBib2R5LmFwcGVuZCgiLCAiKTsKICAg\nICAgICAgICAgICAgIGJvZHkuYXBwZW5kKHByb3BlcnR5TmFtZSk7CiAgICAg\nICAgICAgICAgICBpZiAoaSA9PSBmaWVsZHMubGVuZ3RoIC0gMSkKICAgICAg\nICAgICAgICAgICAgICBib2R5LmNsb3NlUGFyZW4oKS5hcHBlbmQoIjsiKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zLmNsb3NlUGFy\nZW4oKTsKCiAgICAgICAgY29ucy5vcGVuQnJhY2UoMikuZW5kbCgpOwogICAg\nICAgIGNvbnMuYXBwZW5kKGJvZHkudG9TdHJpbmcoKSkuZW5kbCgpOwogICAg\nICAgIGNvbnMuY2xvc2VCcmFjZSgyKTsKICAgICAgICByZXR1cm4gY29ucy50\nb1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nSmF2YSBkZWNsYXJhdGlvbiBhbmQgYWNjZXNzIG1ldGhvZCBjb2RlIGZvciBh\nbGwgZGVjbGFyZWQKICAgICAqIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0\nZSBTdHJpbmdbXSBnZXRGaWVsZENvZGUoKSB7CiAgICAgICAgQ29kZUZvcm1h\ndCBkZWNzID0gbmV3Q29kZUZvcm1hdCgpOwogICAgICAgIENvZGVGb3JtYXQg\nY29kZSA9IG5ld0NvZGVGb3JtYXQoKTsKCiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZpZWxkcyA9IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIGFwcGVuZEZpZWxkQ29kZShmaWVsZHNbaV0sIGRlY3MsIGNv\nZGUpOwogICAgICAgIGZpZWxkcyA9IF9tZXRhLmdldERlY2xhcmVkVW5tYW5h\nZ2VkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVs\nZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGFwcGVuZEZpZWxkQ29kZShm\naWVsZHNbaV0sIGRlY3MsIGNvZGUpOwogICAgICAgIHJldHVybiBuZXcgU3Ry\naW5nW117IGRlY3MudG9TdHJpbmcoKSwgY29kZS50b1N0cmluZygpIH07CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgdGhlIGRlY2xhcmF0aW9uIGFu\nZCBjb2RlIGZvciB0aGUgZ2l2ZW4gZmllbGQgdG8gdGhlIGdpdmVuIGJ1ZmZl\ncnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRGaWVsZENvZGUo\nRmllbGRNZXRhRGF0YSBmbWQsIENvZGVGb3JtYXQgZGVjcywKICAgICAgICBD\nb2RlRm9ybWF0IGNvZGUpIHsKICAgICAgICBTdHJpbmcgZmllbGROYW1lID0g\nZm1kLmdldE5hbWUoKTsKICAgICAgICBTdHJpbmcgY2FwRmllbGROYW1lID0g\nU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmaWVsZE5hbWUpOwogICAgICAgIFN0\ncmluZyBwcm9wZXJ0eU5hbWUgPSBmaWVsZE5hbWU7CiAgICAgICAgaWYgKHBy\nb3BlcnR5TmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIHByb3Bl\ncnR5TmFtZSA9IHByb3BlcnR5TmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\nU3RyaW5nIGZpZWxkVHlwZSA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgIFN0cmluZyBrZXlUeXBlID0g\nbnVsbDsKICAgICAgICBTdHJpbmcgZWxlbWVudFR5cGUgPSBudWxsOwogICAg\nICAgIFN0cmluZyBwYXJhbVR5cGUgPSAiIjsKICAgICAgICBpZiAodXNlR2Vu\nZXJpY0NvbGxlY3Rpb25zKCkpIHsKICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkNPTExFQ1RJT04pIHsK\nICAgICAgICAgICAgICAgIENsYXNzIGVsbUNscyA9IGZtZC5nZXRFbGVtZW50\nKCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBlbGVtZW50\nVHlwZSA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKGVsbUNscyk7CiAgICAgICAg\nICAgICAgICBwYXJhbVR5cGUgPSBkZWNzLmdldFBhcmFtZXRyaXplZFR5cGUo\nCiAgICAgICAgICAgICAgICAgICAgbmV3IFN0cmluZ1tdIHtlbGVtZW50VHlw\nZX0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkgPT0gSmF2YVR5cGVzLk1BUCkgewogICAgICAgICAgICAgICAg\nQ2xhc3Mga2V5Q2xzID0gZm1kLmdldEtleSgpLmdldERlY2xhcmVkVHlwZSgp\nOwogICAgICAgICAgICAgICAgQ2xhc3MgZWxtQ2xzID0gZm1kLmdldEVsZW1l\nbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgIGtleVR5\ncGUgPSBTdHJpbmdzLmdldENsYXNzTmFtZShrZXlDbHMpOwogICAgICAgICAg\nICAgICAgZWxlbWVudFR5cGUgPSBTdHJpbmdzLmdldENsYXNzTmFtZShlbG1D\nbHMpOwogICAgICAgICAgICAgICAgcGFyYW1UeXBlID0gZGVjcy5nZXRQYXJh\nbWV0cml6ZWRUeXBlKAogICAgICAgICAgICAgICAgICAgIG5ldyBTdHJpbmdb\nXSB7a2V5VHlwZSwgZWxlbWVudFR5cGV9KTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgU3RyaW5nIGZpZWxkVmFsdWUgPSBnZXRJbml0aWFs\nVmFsdWUoZm1kKTsKICAgICAgICBpZiAoZmllbGRWYWx1ZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIGlmICgiU2V0Ii5lcXVhbHMoZmllbGRUeXBlKSkKICAg\nICAgICAgICAgICAgIGZpZWxkVmFsdWUgPSAibmV3IEhhc2hTZXQiICsgcGFy\nYW1UeXBlICsgZGVjcy5nZXRQYXJlbnMoKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoIlRyZWVTZXQiLmVxdWFscyhmaWVsZFR5cGUpKQogICAgICAgICAgICAg\nICAgZmllbGRWYWx1ZSA9ICJuZXcgVHJlZVNldCIgKyBwYXJhbVR5cGUgKyBk\nZWNzLmdldFBhcmVucygpOwogICAgICAgICAgICBlbHNlIGlmICgiQ29sbGVj\ndGlvbiIuZXF1YWxzKGZpZWxkVHlwZSkpCiAgICAgICAgICAgICAgICBmaWVs\nZFZhbHVlID0gIm5ldyBBcnJheUxpc3QiICsgcGFyYW1UeXBlICsgZGVjcy5n\nZXRQYXJlbnMoKTsKICAgICAgICAgICAgZWxzZSBpZiAoIk1hcCIuZXF1YWxz\nKGZpZWxkVHlwZSkpCiAgICAgICAgICAgICAgICBmaWVsZFZhbHVlID0gIm5l\ndyBIYXNoTWFwIiArIHBhcmFtVHlwZSArIGRlY3MuZ2V0UGFyZW5zKCk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKCJUcmVlTWFwIi5lcXVhbHMoZmllbGRUeXBl\nKSkKICAgICAgICAgICAgICAgIGZpZWxkVmFsdWUgPSAibmV3IFRyZWVNYXAi\nICsgcGFyYW1UeXBlICsgZGVjcy5nZXRQYXJlbnMoKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuQ09MTEVDVElPTiB8fAogICAgICAgICAgICAgICAgZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuTUFQKQogICAgICAgICAgICAg\nICAgZmllbGRWYWx1ZSA9ICJuZXcgIiArIGZpZWxkVHlwZSArIHBhcmFtVHlw\nZSArIGRlY3MuZ2V0UGFyZW5zKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGZpZWxkVmFsdWUgPSAiIjsKICAgICAgICB9CiAgICAgICAg\naWYgKGZpZWxkVmFsdWUubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICBmaWVs\nZFZhbHVlID0gIiA9ICIgKyBmaWVsZFZhbHVlOwoKICAgICAgICBib29sZWFu\nIGZpZWxkQWNjZXNzID0gIXVzZVByb3BlcnR5QmFzZWRBY2Nlc3MoKTsKICAg\nICAgICBTdHJpbmcgY3VzdG9tID0gZ2V0RGVjbGFyYXRpb24oZm1kKTsKICAg\nICAgICBpZiAoZGVjcy5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgIGRlY3Mu\nZW5kbCgpOwogICAgICAgIFBhcmFtZXRlclRlbXBsYXRlIHRlbXBsOwogICAg\nICAgIGlmIChjdXN0b20gIT0gbnVsbCkgewogICAgICAgICAgICB0ZW1wbCA9\nIG5ldyBQYXJhbWV0ZXJUZW1wbGF0ZSgpOwogICAgICAgICAgICB0ZW1wbC5h\ncHBlbmQoY3VzdG9tKTsKICAgICAgICAgICAgdGVtcGwuc2V0UGFyYW1ldGVy\nKCJmaWVsZE5hbWUiLCBmaWVsZE5hbWUpOwogICAgICAgICAgICB0ZW1wbC5z\nZXRQYXJhbWV0ZXIoImNhcEZpZWxkTmFtZSIsIGNhcEZpZWxkTmFtZSk7CiAg\nICAgICAgICAgIHRlbXBsLnNldFBhcmFtZXRlcigicHJvcGVydHlOYW1lIiwg\ncHJvcGVydHlOYW1lKTsKICAgICAgICAgICAgdGVtcGwuc2V0UGFyYW1ldGVy\nKCJmaWVsZFR5cGUiLCBmaWVsZFR5cGUpOwogICAgICAgICAgICB0ZW1wbC5z\nZXRQYXJhbWV0ZXIoImtleVR5cGUiLCBrZXlUeXBlKTsKICAgICAgICAgICAg\ndGVtcGwuc2V0UGFyYW1ldGVyKCJlbGVtZW50VHlwZSIsIGVsZW1lbnRUeXBl\nKTsKICAgICAgICAgICAgdGVtcGwuc2V0UGFyYW1ldGVyKCJmaWVsZFZhbHVl\nIiwgZmllbGRWYWx1ZSk7CiAgICAgICAgICAgIGRlY3MuYXBwZW5kKHRlbXBs\nLnRvU3RyaW5nKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlm\nIChmaWVsZEFjY2VzcykKICAgICAgICAgICAgICAgIHdyaXRlQW5ub3RhdGlv\nbnMoZGVjcywgZ2V0RmllbGRBbm5vdGF0aW9ucyhmbWQpLCAxKTsKICAgICAg\nICAgICAgZGVjcy50YWIoKS5hcHBlbmQoInByaXZhdGUgIikuYXBwZW5kKGZp\nZWxkVHlwZSkuCiAgICAgICAgICAgICAgICBhcHBlbmQocGFyYW1UeXBlKS5h\ncHBlbmQoIiAiKS5hcHBlbmQoZmllbGROYW1lKS4KICAgICAgICAgICAgICAg\nIGFwcGVuZChmaWVsZFZhbHVlKS5hcHBlbmQoIjsiKTsKICAgICAgICAgICAg\naWYgKGZpZWxkQWNjZXNzKQogICAgICAgICAgICAgICAgZGVjcy5lbmRsKCk7\nCiAgICAgICAgfQoKICAgICAgICBjdXN0b20gPSBnZXRGaWVsZENvZGUoZm1k\nKTsKICAgICAgICBpZiAoY29kZS5sZW5ndGgoKSA+IDApCiAgICAgICAgICAg\nIGNvZGUuYWZ0ZXJTZWN0aW9uKCk7CiAgICAgICAgaWYgKGN1c3RvbSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIHRlbXBsID0gbmV3IFBhcmFtZXRlclRlbXBs\nYXRlKCk7CiAgICAgICAgICAgIHRlbXBsLmFwcGVuZChjdXN0b20pOwogICAg\nICAgICAgICB0ZW1wbC5zZXRQYXJhbWV0ZXIoImZpZWxkTmFtZSIsIGZpZWxk\nTmFtZSk7CiAgICAgICAgICAgIHRlbXBsLnNldFBhcmFtZXRlcigiY2FwRmll\nbGROYW1lIiwgY2FwRmllbGROYW1lKTsKICAgICAgICAgICAgdGVtcGwuc2V0\nUGFyYW1ldGVyKCJwcm9wZXJ0eU5hbWUiLCBwcm9wZXJ0eU5hbWUpOwogICAg\nICAgICAgICB0ZW1wbC5zZXRQYXJhbWV0ZXIoImZpZWxkVHlwZSIsIGZpZWxk\nVHlwZSk7CiAgICAgICAgICAgIHRlbXBsLnNldFBhcmFtZXRlcigia2V5VHlw\nZSIsIGtleVR5cGUpOwogICAgICAgICAgICB0ZW1wbC5zZXRQYXJhbWV0ZXIo\nImVsZW1lbnRUeXBlIiwgZWxlbWVudFR5cGUpOwogICAgICAgICAgICB0ZW1w\nbC5zZXRQYXJhbWV0ZXIoImZpZWxkVmFsdWUiLCBmaWVsZFZhbHVlKTsKICAg\nICAgICAgICAgY29kZS5hcHBlbmQodGVtcGwudG9TdHJpbmcoKSk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZ2V0dGVyCiAgICAgICAgICAg\nIGlmICghZmllbGRBY2Nlc3MpCiAgICAgICAgICAgICAgICB3cml0ZUFubm90\nYXRpb25zKGNvZGUsIGdldEZpZWxkQW5ub3RhdGlvbnMoZm1kKSwgMSk7CiAg\nICAgICAgICAgIGNvZGUudGFiKCkuYXBwZW5kKCJwdWJsaWMgIikuYXBwZW5k\nKGZpZWxkVHlwZSkuYXBwZW5kKHBhcmFtVHlwZSkuCiAgICAgICAgICAgICAg\nICAgYXBwZW5kKCIgIik7CiAgICAgICAgICAgIGlmICgiYm9vbGVhbiIuZXF1\nYWxzSWdub3JlQ2FzZShmaWVsZFR5cGUpKQogICAgICAgICAgICAgICAgY29k\nZS5hcHBlbmQoImlzIik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGNvZGUuYXBwZW5kKCJnZXQiKTsKICAgICAgICAgICAgY29kZS5hcHBl\nbmQoY2FwRmllbGROYW1lKS5wYXJlbnMoKTsKICAgICAgICAgICAgY29kZS5v\ncGVuQnJhY2UoMikuZW5kbCgpOwogICAgICAgICAgICBjb2RlLnRhYigyKS5h\ncHBlbmQoInJldHVybiAiKS5hcHBlbmQoZmllbGROYW1lKS4KICAgICAgICAg\nICAgICAgIGFwcGVuZCgiOyIpLmVuZGwoKTsKICAgICAgICAgICAgY29kZS5j\nbG9zZUJyYWNlKDIpLmFmdGVyU2VjdGlvbigpOwoKICAgICAgICAgICAgLy8g\nc2V0dGVyCiAgICAgICAgICAgIGNvZGUudGFiKCkuYXBwZW5kKCJwdWJsaWMg\ndm9pZCBzZXQiKS5hcHBlbmQoY2FwRmllbGROYW1lKTsKICAgICAgICAgICAg\nY29kZS5vcGVuUGFyZW4odHJ1ZSkuYXBwZW5kKGZpZWxkVHlwZSkuYXBwZW5k\nKHBhcmFtVHlwZSkuCiAgICAgICAgICAgICAgICBhcHBlbmQoIiAiKS5hcHBl\nbmQocHJvcGVydHlOYW1lKS5jbG9zZVBhcmVuKCk7CiAgICAgICAgICAgIGNv\nZGUub3BlbkJyYWNlKDIpLmVuZGwoKTsKICAgICAgICAgICAgY29kZS50YWIo\nMik7CiAgICAgICAgICAgIGlmIChwcm9wZXJ0eU5hbWUuZXF1YWxzKGZpZWxk\nTmFtZSkpCiAgICAgICAgICAgICAgICBjb2RlLmFwcGVuZCgidGhpcy4iKTsK\nICAgICAgICAgICAgY29kZS5hcHBlbmQoZmllbGROYW1lKS5hcHBlbmQoIiA9\nICIpLmFwcGVuZChwcm9wZXJ0eU5hbWUpLgogICAgICAgICAgICAgICAgYXBw\nZW5kKCI7IikuZW5kbCgpOwogICAgICAgICAgICBjb2RlLmNsb3NlQnJhY2Uo\nMik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nY29kZSB0ZW1wbGF0ZSBmb3IgYSBnZW5lcmF0ZWQgSmF2YSBjbGFzcy4KICAg\nICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q2xhc3NDb2RlKFN0cmluZyBw\nYWNrYWdlRGVjLCBTdHJpbmcgaW1wb3J0cywKICAgICAgICBTdHJpbmcgY2xh\nc3NOYW1lLCBTdHJpbmcgZXh0ZW5kc05hbWUsIFN0cmluZyBjb25zdHJ1Y3Rv\nciwKICAgICAgICBTdHJpbmcgZmllbGREZWNzLCBTdHJpbmcgZmllbGRDb2Rl\nKSB7CiAgICAgICAgQ29kZUZvcm1hdCBjb2RlID0gbmV3Q29kZUZvcm1hdCgp\nOwogICAgICAgIGlmIChwYWNrYWdlRGVjLmxlbmd0aCgpID4gMCkKICAgICAg\nICAgICAgY29kZS5hcHBlbmQocGFja2FnZURlYykuYWZ0ZXJTZWN0aW9uKCk7\nCiAgICAgICAgaWYgKGltcG9ydHMubGVuZ3RoKCkgPiAwKQogICAgICAgICAg\nICBjb2RlLmFwcGVuZChpbXBvcnRzKS5hZnRlclNlY3Rpb24oKTsKCiAgICAg\nICAgY29kZS5hcHBlbmQoIi8qKiIpLmVuZGwoKS4KICAgICAgICAgICAgYXBw\nZW5kKCIgKiBBdXRvLWdlbmVyYXRlZCBieToiKS5lbmRsKCkuCiAgICAgICAg\nICAgIGFwcGVuZCgiICogIikuYXBwZW5kKGdldENsYXNzKCkuZ2V0TmFtZSgp\nKS5lbmRsKCkuCiAgICAgICAgICAgIGFwcGVuZCgiICovIikuZW5kbCgpOwoK\nICAgICAgICB3cml0ZUFubm90YXRpb25zKGNvZGUsIGdldENsYXNzQW5ub3Rh\ndGlvbnMoKSwgMCk7CiAgICAgICAgY29kZS5hcHBlbmQoInB1YmxpYyBjbGFz\ncyAiKS5hcHBlbmQoY2xhc3NOYW1lKTsKICAgICAgICBpZiAoZXh0ZW5kc05h\nbWUubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICBjb2RlLmV4dGVuZHNEZWMo\nMSkuYXBwZW5kKCIgIikuYXBwZW5kKGV4dGVuZHNOYW1lKTsKICAgICAgICBv\ncGVuQ2xhc3NCcmFjZShjb2RlKTsKCiAgICAgICAgaWYgKGZpZWxkRGVjcy5s\nZW5ndGgoKSA+IDApCiAgICAgICAgICAgIGNvZGUuYXBwZW5kKGZpZWxkRGVj\ncykuYWZ0ZXJTZWN0aW9uKCk7CgogICAgICAgIC8vIGRlZmF1bHQgY29uc3Ry\ndWN0b3IKICAgICAgICBjb2RlLnRhYigpLmFwcGVuZCgicHVibGljICIpLmFw\ncGVuZChjbGFzc05hbWUpLnBhcmVucygpOwogICAgICAgIGNvZGUub3BlbkJy\nYWNlKDIpLmVuZGwoKS5jbG9zZUJyYWNlKDIpOwoKICAgICAgICBpZiAoY29u\nc3RydWN0b3IubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICBjb2RlLmFmdGVy\nU2VjdGlvbigpLmFwcGVuZChjb25zdHJ1Y3Rvcik7CiAgICAgICAgaWYgKGZp\nZWxkQ29kZS5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgIGNvZGUuYWZ0ZXJT\nZWN0aW9uKCkuYXBwZW5kKGZpZWxkQ29kZSk7CiAgICAgICAgY29kZS5lbmRs\nKCk7CgogICAgICAgIGNsb3NlQ2xhc3NCcmFjZShjb2RlKTsKCiAgICAgICAg\ncmV0dXJuIGNvZGUudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFwcGVuZHMgdGhlIGdpdmVuIGxpc3Qgb2YgYW5ub3RhdGlvbnMgdG8gY29k\nZSBidWZmZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3cml0ZUFubm90\nYXRpb25zIChDb2RlRm9ybWF0IGNvZGUsIExpc3QgYW5uLAogICAgICAgIGlu\ndCB0YWJMZXZlbCkgewogICAgICAgIGlmIChhbm4gPT0gbnVsbCB8fCBhbm4u\nc2l6ZSgpID09IDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGkgPSBhbm4uaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGlmICh0YWJMZXZlbCA+IDApCiAgICAgICAgICAgICAg\nICBjb2RlLnRhYih0YWJMZXZlbCk7CiAgICAgICAgICAgIFN0cmluZyBzID0g\nKFN0cmluZykgaS5uZXh0KCk7CiAgICAgICAgICAgIGNvZGUuYXBwZW5kKHMp\nLmVuZGwoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBl\nbmQgdGhlIG9wZW5pbmcgY29kZS1sZXZlbCBicmFjZSB0byB0aGUgY29kZTsg\ndGhpcyBjYW4gYmUKICAgICAqIG92ZXJyaWRkZW4gdG8gYWRkIGNvZGUgdG8g\ndGhlIHRvcCBvZiB0aGUgY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIG9wZW5DbGFzc0JyYWNlKENvZGVGb3JtYXQgY29kZSkgewogICAgICAg\nIGNvZGUub3BlbkJyYWNlKDEpLmVuZGwoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFwcGVuZCB0aGUgY2xvc2luZyBjb2RlLWxldmVsIGJyYWNlIHRvIHRo\nZSBjb2RlOyB0aGlzIGNhbiBiZQogICAgICogb3ZlcnJpZGRlbiB0byBhZGQg\nY29kZSB0byB0aGUgYm90dG9tIG9mIHRoZSBjbGFzcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgY2xvc2VDbGFzc0JyYWNlKENvZGVGb3JtYXQgY29k\nZSkgewogICAgICAgIGNvZGUuY2xvc2VCcmFjZSgxKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBKYXZhIGZpbGUgdG8gd3JpdGUgdG8uCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWxlIGdldEZpbGUoKSB7CiAgICAgICAgU3RyaW5n\nIHBhY2thZ2VOYW1lID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShfdHlwZSk7\nCiAgICAgICAgU3RyaW5nIGZpbGVOYW1lID0gU3RyaW5ncy5nZXRDbGFzc05h\nbWUoX3R5cGUpICsgIi5qYXZhIjsKCiAgICAgICAgRmlsZSBkaXIgPSBGaWxl\ncy5nZXRQYWNrYWdlRmlsZShfZGlyLCBwYWNrYWdlTmFtZSwgdHJ1ZSk7CiAg\nICAgICAgcmV0dXJuIG5ldyBGaWxlKGRpciwgZmlsZU5hbWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiB0aGUgaW50ZXJuYWwg\nY29kZSBmb3JtYXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2RlRm9ybWF0\nIG5ld0NvZGVGb3JtYXQoKSB7CiAgICAgICAgaWYgKF9mb3JtYXQgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2RlRm9ybWF0KCk7CiAgICAg\nICAgcmV0dXJuIChDb2RlRm9ybWF0KSBfZm9ybWF0LmNsb25lKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjb2RlIHRlbXBsYXRlIGZvciB0\naGUgZ2l2ZW4gY2xhc3MsIG9yIG51bGwgdG8gdXNlIHRoZSBzdGFuZGFyZAog\nICAgICogc3lzdGVtLWdlbmVyYXRlZCBKYXZhIGNvZGUuIFRvIGZhY2lsaXRh\ndGUgdGVtcGxhdGUgcmV1c2UsIHRoZQogICAgICogZm9sbG93aW5nIHBhcmFt\nZXRlcnMgY2FuIGFwcGVhciBpbiB0aGUgdGVtcGxhdGU7IHRoZSBwcm9wZXIg\ndmFsdWVzCiAgICAgKiB3aWxsIGJlIHN1YnRpdHV0ZWQgYnkgdGhlIHN5c3Rl\nbToKICAgICAqIDx1bD4KICAgICAqIDxsaT4ke3BhY2thZ2VEZWN9OiBUaGUg\ncGFja2FnZSBkZWNsYXJhdGlvbiwgaW4gdGhlIGZvcm0KICAgICAqICJwYWNr\nYWdlICZsdDtwYWNrYWdlIG5hbWUgJmd0OzsiLCBvciBlbXB0eSBzdHJpbmcg\naWYgbm8gcGFja2FnZS48L2xpPgogICAgICogPGxpPiR7aW1wb3J0c306IElt\ncG9ydHMgZm9yIHRoZSBwYWNrYWdlcyB1c2VkIGJ5IHRoZSBkZWNsYXJlZAog\nICAgICogZmllbGQgdHlwZXMuPC9saT4KICAgICAqIDxsaT4ke2NsYXNzTmFt\nZX06IFRoZSBuYW1lIG9mIHRoZSBjbGFzcywgd2l0aG91dCBwYWNrYWdlLjwv\nbGk+CiAgICAgKiA8bGk+JHtleHRlbmRzRGVjfTogRXh0ZW5kcyBkZWNsYXJh\ndGlvbiwgaW4gdGhlIGZvcm0KICAgICAqICJleHRlbmRzICZsdDtzdXBlcmNs\nYXNzJmd0OyIsIG9yIGVtcHR5IHN0cmluZyBpZiBubyBzdXBlcmNsYXNzLjwv\nbGk+CiAgICAgKiA8bGk+JHtjb25zdHJ1Y3Rvcn06IEEgY29uc3RydWN0b3Ig\ndGhhdCB0YWtlcyBpbiBhbGwgcHJpbWFyeSBrZXkgZmllbGRzCiAgICAgKiBv\nZiB0aGUgY2xhc3MsIG9yIGVtcHR5IHN0cmluZyBpZiB0aGUgY2xhc3MgdXNl\ncyBkYXRhc3RvcmUgaWRlbnRpdHkuPC9saT4KICAgICAqIDxsaT4ke2ZpZWxk\nRGVjc306IERlY2xhcmF0aW9ucyBvZiBhbGwgdGhlIGRlY2xhcmVkIGZpZWxk\ncy48L2xpPgogICAgICogPGxpPiR7ZmllbGRDb2RlfTogR2V0L3NldCBtZXRo\nb2RzIGZvciBhbGwgdGhlIGRlY2xhcmVkIGZpZWxkcy48L2xpPgogICAgICog\nPC91bD4gUmV0dXJucyBudWxsIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdHJpbmcgZ2V0Q2xhc3NDb2RlKCkgewogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGNvZGUgZm9y\nIHRoZSBpbml0aWFsIHZhbHVlIGZvciB0aGUgZ2l2ZW4gZmllbGQsIG9yIG51\nbGwgdG8gdXNlCiAgICAgKiB0aGUgZGVmYXVsdCBnZW5lcmF0ZWQgYnkgdGhl\nIHN5c3RlbS4gUmV0dXJucyBudWxsIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0SW5pdGlhbFZhbHVlKEZpZWxkTWV0YURh\ndGEgZmllbGQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIGNvZGUgdGVtcGxhdGUgZm9yIHRoZSBkZWNs\nYXJhdGlvbiBvZiB0aGUgZ2l2ZW4gZmllbGQsIG9yIG51bGwKICAgICAqIHRv\nIHVzZSB0aGUgc3lzdGVtLWdlbmVyYXRlZCBkZWZhdWx0IEphdmEgY29kZS4K\nICAgICAqIFRvIGZhY2lsaXRhdGUgdGVtcGxhdGUgcmV1c2UsIHRoZSBmb2xs\nb3dpbmcgcGFyYW1ldGVycyBjYW4gYXBwZWFyIGluCiAgICAgKiB5b3VyIHRl\nbXBsYXRlOyB0aGUgcHJvcGVyIHZhbHVlcyB3aWxsIGJlIHN1YnRpdHV0ZWQg\nYnkgdGhlIHN5c3RlbToKICAgICAqIDx1bD4KICAgICAqIDxsaT4ke2ZpZWxk\nTmFtZX06IFRoZSBuYW1lIG9mIHRoZSBmaWVsZC48L2xpPgogICAgICogPGxp\nPiR7Y2FwRmllbGROYW1lfTogVGhlIGNhcGl0YWxpemVkIGZpZWxkIG5hbWUu\nPC9saT4KICAgICAqIDxsaT4ke3Byb3BlcnR5TmFtZX06IFRoZSBmaWVsZCBu\nYW1lIHdpdGhvdXQgbGVhZGluZyAnXycsIGlmIGFueS48L2xpPgogICAgICog\nPGxpPiR7ZmllbGRUeXBlfTogVGhlIGZpZWxkJ3MgdHlwZSBuYW1lLjwvbGk+\nCiAgICAgKiA8bGk+JHtrZXlUeXBlfTogS2V5IHR5cGUgbmFtZSBmb3IgbWFw\ncywgbnVsbCBvdGhlcndpc2UuPC9saT4KICAgICAqIDxsaT4ke2VsZW1lbnRU\neXBlfTogRWxlbWVudCB0eXBlIG5hbWUgZm9yIGNvbGxlY3Rpb25zLCBudWxs\nIG90aGVyd2lzZS4KICAgICAqIDwvbGk+CiAgICAgKiA8bGk+JHtmaWVsZFZh\nbHVlfTogVGhlIGZpZWxkJ3MgaW5pdGlhbCB2YWx1ZSwgaW4gdGhlIGZvcm0K\nICAgICAqICIgPSAmbHQ7dmFsdWUmZ3Q7Iiwgb3IgZW1wdHkgc3RyaW5nIGlm\nIG5vbmUuPC9saT4KICAgICAqIDwvdWw+IFJldHVybnMgbnVsbCBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldERlY2xhcmF0\naW9uKEZpZWxkTWV0YURhdGEgZmllbGQpIHsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvZGUgdGVtcGxh\ndGUgZm9yIHRoZSBnZXQvc2V0IG1ldGhvZHMgb2YgdGhlIGdpdmVuIGZpZWxk\nLCBvcgogICAgICogbnVsbCB0byB1c2UgdGhlIHN5c3RlbS1nZW5lcmF0ZWQg\nZGVmYXVsdCBKYXZhIGNvZGUuCiAgICAgKiBUbyBmYWNpbGl0YXRlIHRlbXBs\nYXRlIHJldXNlLCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnMgY2FuIGFwcGVh\nciBpbgogICAgICogeW91ciB0ZW1wbGF0ZTsgdGhlIHByb3BlciB2YWx1ZXMg\nd2lsbCBiZSBzdWJ0aXR1dGVkIGJ5IHRoZSBzeXN0ZW06CiAgICAgKiA8dWw+\nCiAgICAgKiA8bGk+JHtmaWVsZE5hbWV9OiBUaGUgbmFtZSBvZiB0aGUgZmll\nbGQuPC9saT4KICAgICAqIDxsaT4ke2NhcEZpZWxkTmFtZX06IFRoZSBjYXBp\ndGFsaXplZCBmaWVsZCBuYW1lLjwvbGk+CiAgICAgKiA8bGk+JHtwcm9wZXJ0\neU5hbWV9OiBUaGUgZmllbGQgbmFtZSB3aXRob3V0IGxlYWRpbmcgJ18nLCBp\nZiBhbnkuPC9saT4KICAgICAqIDxsaT4ke2ZpZWxkVHlwZX06IFRoZSBmaWVs\nZCdzIHR5cGUgbmFtZS48L2xpPgogICAgICogPGxpPiR7a2V5VHlwZX06IEtl\neSB0eXBlIG5hbWUgZm9yIG1hcHMsIG51bGwgb3RoZXJ3aXNlLjwvbGk+CiAg\nICAgKiA8bGk+JHtlbGVtZW50VHlwZX06IEVsZW1lbnQgdHlwZSBuYW1lIGZv\nciBjb2xsZWN0aW9ucywgbnVsbCBvdGhlcndpc2UuCiAgICAgKiA8L2xpPgog\nICAgICogPGxpPiR7ZmllbGRWYWx1ZX06IFRoZSBmaWVsZCdzIGluaXRpYWwg\ndmFsdWUsIGluIHRoZSBmb3JtCiAgICAgKiAiPSAmbHQ7dmFsdWUmZ3Q7Iiwg\nb3IgZW1wdHkgc3RyaW5nIGlmIG5vbmUuPC9saT4KICAgICAqIDwvdWw+CiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0RmllbGRDb2RlIChGaWVs\nZE1ldGFEYXRhIGZpZWxkKQoJewoJCXJldHVybiBudWxsOwoJfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0byB1c2UgcHJvcGVydHktYmFzZWQgYWNjZXNz\nIG9uIGdlbmVyYXRlZCBjb2RlLgogICAgICogRGVmYXVsdHMgdG8gZmFsc2Ug\nKGZpZWxkLWJhc2VkKS4KICAgICAqLyAgICAKICAgIHByb3RlY3RlZCBib29s\nZWFuIHVzZVByb3BlcnR5QmFzZWRBY2Nlc3MgKCkgewogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBjbGFzcy1s\nZXZlbCBhbm5vdGF0aW9ucy4gUmV0dXJucyBudWxsIGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBMaXN0IGdldENsYXNzQW5ub3RhdGlvbnMo\nKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gZmllbGQtbGV2ZWwgYW5ub3RhdGlvbnMuIFJldHVybnMgbnVs\nbCBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgTGlzdCBnZXRG\naWVsZEFubm90YXRpb25zKEZpZWxkTWV0YURhdGEgZmllbGQpIHsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndG8gdXNlIGdlbmVyaWMgY29sbGVjdGlvbnMgb24gb25lLXRvLW1hbnkgYW5k\nIG1hbnktdG8tbWFueQogICAgICogcmVsYXRpb25zIGluc3RlYWQgb2YgdW50\neXBlZCBjb2xsZWN0aW9ucy4KICAgICAqCiAgICAgKiBPdmVycmlkZSBpbiBk\nZXNjZW5kYW50cyB0byBjaGFuZ2UgZGVmYXVsdCBiZWhhdmlvci4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gdXNlR2VuZXJpY0NvbGxlY3Rpb25z\nKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCn0K\n","encoding":"base64"}

