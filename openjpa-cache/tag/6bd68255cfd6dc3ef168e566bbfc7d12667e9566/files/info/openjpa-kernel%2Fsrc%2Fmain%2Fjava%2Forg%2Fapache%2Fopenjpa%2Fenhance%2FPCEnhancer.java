{"sha":"4213372c7071a5e042315e5d448281a4fbc4b3d2","node_id":"MDQ6QmxvYjIwNjM2NDo0MjEzMzcyYzcwNzFhNWUwNDIzMTVlNWQ0NDgyODFhNGZiYzRiM2Qy","size":173296,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4213372c7071a5e042315e5d448281a4fbc4b3d2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5DbGFzc0FyZ1BhcnNl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5CeXRlY29k\nZVdyaXRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5G\naWxlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRv\nUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5TZXJ2aWNlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXIuTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQnl0ZUlkOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuQ2hhcklkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuRGF0ZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuRG91YmxlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludElkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRmxvYXRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuU2hvcnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlN0cmluZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgc2VycC5ieXRlY29kZS5C\nQ0NsYXNzOwppbXBvcnQgc2VycC5ieXRlY29kZS5CQ0ZpZWxkOwppbXBvcnQg\nc2VycC5ieXRlY29kZS5CQ01ldGhvZDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQ29kZTsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ29uc3RhbnRzOwppbXBvcnQg\nc2VycC5ieXRlY29kZS5FeGNlcHRpb25zOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5GaWVsZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5HZXRG\naWVsZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5JZkluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5JbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAuYnl0ZWNvZGUuSnVtcEluc3RydWN0aW9uOwppbXBvcnQgc2Vy\ncC5ieXRlY29kZS5Mb2FkSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLk1ldGhvZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Q\ncm9qZWN0OwppbXBvcnQgc2VycC5ieXRlY29kZS5UYWJsZVN3aXRjaEluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5DbGFzc0luc3RydWN0aW9u\nOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CmltcG9ydCBzZXJwLnV0aWwu\nU3RyaW5nczsKCi8qKgogKiBCeXRlY29kZSBlbmhhbmNlciB1c2VkIHRvIGVu\naGFuY2UgcGVyc2lzdGVudCBjbGFzc2VzIGZyb20gbWV0YWRhdGEuIFRoZQog\nKiBlbmhhbmNlciBtdXN0IGJlIGludm9rZWQgb24gYWxsIHBlcnNpc3RlbmNl\nLWNhcGFibGUgYW5kIHBlcnNpc3RlbmNlIGF3YXJlCiAqIGNsYXNzZXMuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgUENFbmhh\nbmNlciB7CiAgICAvLyBEZXNpZ25hdGVzIGEgdmVyc2lvbiBmb3IgbWFpbnRh\naW5pbmcgY29tcGF0YmlsaXR5IHdoZW4gUENFbmhhbmNlcgogICAgLy8gbW9k\naWZpZXMgZW5oYW5jZW1lbnQgdGhhdCBjYW4gYnJlYWsgc2VyaWFsaXphdGlv\nbiBvciBvdGhlciBjb250cmFjdHMKICAgIC8vIEVhY2ggZW5oYW5jZWQgY2xh\nc3Mgd2lsbCByZXR1cm4gdGhlIHZhbHVlIG9mIHRoaXMgZmllbGQgdmlhCiAg\nICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9u\nKCkKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VSX1ZFUlNJ\nT04gPSAyOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0Vf\nTk9ORSA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNF\nX0FXQVJFID0gMiA8PCAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nRU5IQU5DRV9JTlRFUkZBQ0UgPSAyIDw8IDE7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBFTkhBTkNFX1BDID0gMiA8PCAyOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ2xhc3MgUENUWVBFID0gUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNNID0g\nUFJFICsgIlN0YXRlTWFuYWdlciI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBDbGFzcyBTTVRZUEUgPSBTdGF0ZU1hbmFnZXIuY2xhc3M7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgSU5IRVJJVCA9IFBSRSArICJJbmhl\ncml0ZWRGaWVsZENvdW50IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0\ncmluZyBDT05URVhUTkFNRSA9ICJHZW5lcmljQ29udGV4dCI7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBVU0VSRVhDRVAgPSBVc2VyRXhjZXB0\naW9uLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSU5U\nRVJORVhDRVAgPSBJbnRlcm5hbEV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIENsYXNzIEhFTFBFUlRZUEUgPSBQQ1JlZ2lzdHJ5\nLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNVUEVS\nID0gUFJFICsgIlBDU3VwZXJjbGFzcyI7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBDbGFzcyBPSURGU1RZUEUgPSBGaWVsZFN1cHBsaWVyLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgT0lERkNUWVBFID0gRmll\nbGRDb25zdW1lci5jbGFzczsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAg\nKFBDRW5oYW5jZXIuY2xhc3MpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nU3RyaW5nIFJFREVGSU5FRF9BVFRSSUJVVEUKICAgICAgICA9IFBDRW5oYW5j\nZXIuY2xhc3MuZ2V0TmFtZSgpICsgIiNyZWRlZmluZWQtdHlwZSI7CiAgICAK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEF1eGlsaWFyeUVuaGFuY2VyW10g\nX2F1eEVuaGFuY2VyczsKICAgIHN0YXRpYyB7CiAgICAgICAgQ2xhc3NbXSBj\nbGFzc2VzID0gU2VydmljZXMuZ2V0SW1wbGVtZW50b3JDbGFzc2VzKAogICAg\nICAgICAgICBBdXhpbGlhcnlFbmhhbmNlci5jbGFzcywKICAgICAgICAgICAg\nKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzKSkpOwogICAgICAgIExp\nc3QgYXV4RW5oYW5jZXJzID0gbmV3IEFycmF5TGlzdChjbGFzc2VzLmxlbmd0\naCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBh\ndXhFbmhhbmNlcnMuYWRkKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3Rh\nbmNlQWN0aW9uKGNsYXNzZXNbaV0pKSk7CgkJICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBhdXggZW5oYW5jZXIgbWF5\nIHJlbHkgb24gbm9uLWV4aXN0YW50IHNwZWMgY2xhc3NlcywgZXRjCgkJICAg\nIH0KCQl9CiAgICAJX2F1eEVuaGFuY2VycyA9IChBdXhpbGlhcnlFbmhhbmNl\ncltdKSBhdXhFbmhhbmNlcnMudG9BcnJheQogICAgICAgICAgICAobmV3IEF1\neGlsaWFyeUVuaGFuY2VyW2F1eEVuaGFuY2Vycy5zaXplKCldKTsKICAgIH0K\nCiAgICBwcml2YXRlIEJDQ2xhc3MgX3BjOwogICAgcHJpdmF0ZSBmaW5hbCBC\nQ0NsYXNzIF9tYW5hZ2VkVHlwZTsKICAgIHByaXZhdGUgZmluYWwgTWV0YURh\ndGFSZXBvc2l0b3J5IF9yZXBvczsKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NN\nZXRhRGF0YSBfbWV0YTsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAg\nICBwcml2YXRlIENvbGxlY3Rpb24gX29pZHMgPSBudWxsOwogICAgcHJpdmF0\nZSBib29sZWFuIF9kZWZDb25zID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfcmVkZWZpbmUgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfc3Vi\nY2xhc3MgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfZmFpbCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBTZXQgX3Zpb2xhdGlvbnMgPSBudWxsOwogICAg\ncHJpdmF0ZSBGaWxlIF9kaXIgPSBudWxsOwogICAgcHJpdmF0ZSBCeXRlY29k\nZVdyaXRlciBfd3JpdGVyID0gbnVsbDsKICAgIHByaXZhdGUgTWFwIF9iYWNr\naW5nRmllbGRzID0gbnVsbDsgLy8gbWFwIG9mIHNldCAvIGdldCBuYW1lcyA9\nPiBmaWVsZCBuYW1lcwogICAgcHJpdmF0ZSBNYXAgX2F0dHJzVG9GaWVsZHMg\nPSBudWxsOyAvLyBtYXAgb2YgYXR0ciBuYW1lcyA9PiBmaWVsZCBuYW1lcwog\nICAgcHJpdmF0ZSBNYXAgX2ZpZWxkc1RvQXR0cnMgPSBudWxsOyAvLyBtYXAg\nb2YgZmllbGQgbmFtZXMgPT4gYXR0ciBuYW1lcwogICAgcHJpdmF0ZSBib29s\nZWFuIF9pc0FscmVhZHlSZWRlZmluZWQgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfaXNBbHJlYWR5U3ViY2xhc3NlZCA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9iY3NDb25maWd1cmVkID0gZmFsc2U7CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24gYW5k\nIHR5cGUgdG8gZW5oYW5jZS4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5j\nZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQ2xhc3MgdHlwZSkgewog\nICAgICAgIHRoaXMoY29uZiwgKEJDQ2xhc3MpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5sb2Fk\nUHJvamVjdENsYXNzQWN0aW9uKG5ldyBQcm9qZWN0KCksIHR5cGUpKSwKICAg\nICAgICAgICAgKE1ldGFEYXRhUmVwb3NpdG9yeSkgbnVsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRp\nb24gYW5kIHR5cGUgdG8gZW5oYW5jZS4KICAgICAqLwogICAgcHVibGljIFBD\nRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQ2xhc3NNZXRh\nRGF0YSB0eXBlKSB7CiAgICAgICAgdGhpcyhjb25mLCAoQkNDbGFzcykgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAg\nICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3Qo\nKSwgdHlwZS5nZXREZXNjcmliZWRUeXBlKCkpKSwKICAgICAgICAgICAgdHlw\nZS5nZXRSZXBvc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0\naGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRl\nZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQogICAgICogQHBhcmFtIHJlcG9z\nIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRhIGFj\nY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRv\ncnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBjb25m\naWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVjYXVz\nZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBiZSBhbgogICAgICogaW1wbGVt\nZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAg\nICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmls\nZXMKICAgICAqIEBkZXByZWNhdGVkIHVzZSB7QGxpbmsgI1BDRW5oYW5jZXIo\nT3BlbkpQQUNvbmZpZ3VyYXRpb24sIEJDQ2xhc3MsCiAgICAgICAgTWV0YURh\ndGFSZXBvc2l0b3J5LCBDbGFzc0xvYWRlcil9IGluc3RlYWQuIAogICAgICov\nCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBj\nb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5\nIHJlcG9zKSB7CiAgICAgICAgdGhpcyhjb25mLCB0eXBlLCByZXBvcywgbnVs\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5\nIGNvbmZpZ3VyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhl\nIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBlIHRvCiAgICAg\nKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20gYW55IHN0cmVh\nbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBv\nc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAogICAgICogb3Ig\nbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRv\ncnkKICAgICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3Qg\ndXNlZCBieSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0\naW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZp\nYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVxdWlyZWQgbW9y\nZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAgICogQHBhcmFt\nIGxvYWRlciB0aGUgZW52aXJvbm1lbnQgY2xhc3Nsb2FkZXIgdG8gdXNlIGZv\nciBsb2FkaW5nCiAgICAgKiBjbGFzc2VzIGFuZCByZXNvdXJjZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJlcG9zaXRv\ncnkgcmVwb3MsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIF9tYW5h\nZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAgX3BjID0gdHlwZTsKCiAgICAgICAg\nX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19F\nTkhBTkNFKTsKCiAgICAgICAgaWYgKHJlcG9zID09IG51bGwpIHsKICAgICAg\nICAgICAgX3JlcG9zID0gY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpOwogICAgICAgICAgICBfcmVwb3Muc2V0U291cmNlTW9kZShNZXRh\nRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsKICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAgX21ldGEgPSBfcmVw\nb3MuZ2V0TWV0YURhdGEodHlwZS5nZXRUeXBlKCksIGxvYWRlciwgZmFsc2Up\nOwogICAgfQoKICAgIHN0YXRpYyBTdHJpbmcgdG9QQ1N1YmNsYXNzTmFtZShD\nbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdl\nTmFtZShQQ0VuaGFuY2VyLmNsYXNzKSArICIuIgogICAgICAgICAgICArIGNs\ncy5nZXROYW1lKCkucmVwbGFjZSgnLicsICckJykgKyAiJHBjc3ViY2xhc3Mi\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBj\nb25maWd1cmF0aW9uLCB0eXBlLCBhbmQgbWV0YWRhdGEuCiAgICAgKi8KICAg\nIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nIEJDQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIG1ldGEuZ2V0UmVwb3NpdG9yeSgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUg\ncmVwcmVzZW50YXRpb24gb2YgdGhlIHBlcnNpc3RlbmNlLWNhcGFibGUgY2xh\nc3MKICAgICAqIGJlaW5nIG1hbmlwdWxhdGVkLgogICAgICovCiAgICBwdWJs\naWMgQkNDbGFzcyBnZXRQQ0J5dGVjb2RlKCkgewogICAgICAgIHJldHVybiBf\ncGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ5dGVjb2Rl\nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBtYW5hZ2VkIGNsYXNzIGJlaW5nCiAg\nICAgKiBtYW5pcHVsYXRlZC4gVGhpcyBpcyB1c3VhbGx5IHRoZSBzYW1lIGFz\nIHtAbGluayAjZ2V0UENCeXRlY29kZX0sCiAgICAgKiBleGNlcHQgd2hlbiBy\ndW5uaW5nIHRoZSBlbmhhbmNlciB0byByZWRlZmluZSBhbmQgc3ViY2xhc3MK\nICAgICAqIGV4aXN0aW5nIHBlcnNpc3RlbnQgdHlwZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBCQ0NsYXNzIGdldE1hbmFnZWRUeXBlQnl0ZWNvZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9tYW5hZ2VkVHlwZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyBiZWluZyBt\nYW5pcHVsYXRlZCwgb3IgbnVsbCBpZiBub3QKICAgICAqIGEgcGVyc2lzdGVu\ndCB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBl\nbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0\nb3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNz\nLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0\ncnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAg\nKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBZGREZWZhdWx0Q29uc3RydWN0b3Io\nKSB7CiAgICAgICAgcmV0dXJuIF9kZWZDb25zOwogICAgfQoKICAgIC8qKgog\nICAgICogQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW5oYW5j\nZXIgc2hvdWxkIGFkZCBhIG5vLWFyZ3MKICAgICAqIGNvbnN0cnVjdG9yIGlm\nIG9uZSBpcyBub3QgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBjbGFzcy4gT3Bl\nbkpQQQogICAgICogcmVxdWlyZXMgdGhhdCBhIG5vLWFyZyBjb25zdHJ1Y3Rv\nciAod2hldGhlciBjcmVhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgICogb3Ig\nYnkgdGhlIHVzZXIpIGJlIHByZXNlbnQgaW4gYSBQQy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGJvb2xlYW4g\nYWRkRGVmYXVsdENvbnN0cnVjdG9yKSB7CiAgICAgICAgX2RlZkNvbnMgPSBh\nZGREZWZhdWx0Q29uc3RydWN0b3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0cyBhcmd1bWVu\ndHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFuZCBvcHRpb25h\nbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5IHVzZWQgaW4g\nY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3JlYXRlU3ViY2xh\nc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZWRlZmluZSgpIHsKICAg\nICAgICByZXR1cm4gX3JlZGVmaW5lOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG11dGF0ZSBpdHMgYXJndW1l\nbnRzLCBvciBqdXN0IHJ1biB2YWxpZGF0aW9uCiAgICAgKiBhbmQgb3B0aW9u\nYWwgc3ViY2xhc3NpbmcgbG9naWMgb24gdGhlbS4gVXN1YWxseSB1c2VkIGlu\nIGNvbmp1bmN0aW9uIHdpdGgKICAgICAqIDxjb2RlPnNldENyZWF0ZVN1YmNs\nYXNzKHRydWUpPC9jb2RlPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAK\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVkZWZpbmUoYm9vbGVhbiBy\nZWRlZmluZSkgewogICAgICAgIF9yZWRlZmluZSA9IHJlZGVmaW5lOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMg\naW5zdGFuY2UgaXMgZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAq\nIHJlZGVmaW5lZC4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNBbHJlYWR5UmVkZWZpbmVkKCkgewog\nICAgICAgIHJldHVybiBfaXNBbHJlYWR5UmVkZWZpbmVkOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMgaW5zdGFu\nY2UgaXMgZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHN1YmNs\nYXNzZWQgaW4gdGhpcyBpbnN0YW5jZSdzIGVudmlyb25tZW50IGNsYXNzbG9h\nZGVyLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0FscmVhZHlTdWJjbGFzc2VkKCkgewogICAgICAg\nIHJldHVybiBfaXNBbHJlYWR5U3ViY2xhc3NlZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtYWtlIGl0cyBh\ncmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJsZSwKICAgICAqIG9yIGdlbmVy\nYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAgICAqCiAg\nICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJjbGFz\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2Vy\nIHNob3VsZCBtYWtlIGl0cyBhcmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJs\nZSwKICAgICAqIG9yIGdlbmVyYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBz\ndWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0Q3JlYXRlU3ViY2xhc3MoYm9vbGVhbiBzdWJj\nbGFzcykgewogICAgICAgIF9zdWJjbGFzcyA9IHN1YmNsYXNzOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0\nZW50IHR5cGUgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRl\nY29kZSBhbmFseXNpcyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcg\nT3BlbkpQQSdzIHByb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25z\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRFbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9mYWlsOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJz\naXN0ZW50IHR5cGUgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBi\neXRlY29kZSBhbmFseXNpcyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRp\nbmcgT3BlbkpQQSdzIHByb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rp\nb25zLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMoYm9vbGVhbiBmYWlsKSB7CiAgICAgICAgX2ZhaWwg\nPSBmYWlsOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQg\nZGlyZWN0b3J5IHRvIGdlbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFj\na2FnZQogICAgICogc3RydWN0dXJlIHdpbGwgYmUgY3JlYXRlZCBiZW5lYXRo\nIHRoaXMgZGlyZWN0b3J5LiBEZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRp\nbmcgdGhlIGV4aXN0aW5nIGNsYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwog\nICAgcHVibGljIEZpbGUgZ2V0RGlyZWN0b3J5KCkgewogICAgICAgIHJldHVy\nbiBfZGlyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQg\nZGlyZWN0b3J5IHRvIGdlbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFj\na2FnZQogICAgICogc3RydWN0dXJlIHdpbGwgYmUgY3JlYWVkIGJlbmVhdGgg\ndGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBvdmVyd3JpdGlu\nZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREaXJlY3RvcnkoRmlsZSBkaXIpIHsKICAgICAg\nICBfZGlyID0gZGlyOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBjdXJyZW50IHtAbGluayBCeXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdG8g\nb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgQnl0ZWNvZGVX\ncml0ZXIgZ2V0Qnl0ZWNvZGVXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIF93\ncml0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHtAbGluayBC\neXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdGhlIGJ5dGVjb2RlIHRvIG9yIG51\nbGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZWNv\nZGVXcml0ZXIoQnl0ZWNvZGVXcml0ZXIgd3JpdGVyKSB7CiAgICAgICAgX3dy\naXRlciA9IHdyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0g\nYnl0ZWNvZGUgZW5oYW5jZW1lbnRzLgogICAgICoKICAgICAqIEByZXR1cm4g\nPGNvZGU+RU5IQU5DRV8qPC9jb2RlPiBjb25zdGFudAogICAgICovCiAgICBw\ndWJsaWMgaW50IHJ1bigpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhh\nbmNlLXN0YXJ0IiwgX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBpZiBtYW5hZ2VkIGludGVyZmFjZSwg\nc2tpcAogICAgICAgICAgICBpZiAoX21hbmFnZWRUeXBlLmlzSW50ZXJmYWNl\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRU5IQU5DRV9JTlRFUkZBQ0U7\nCgogICAgICAgICAgICAvLyBjaGVjayBpZiBhbHJlYWR5IGVuaGFuY2VkCiAg\nICAgICAgICAgIENsYXNzW10gaW50ZXJmYWNlcyA9IF9tYW5hZ2VkVHlwZS5n\nZXREZWNsYXJlZEludGVyZmFjZVR5cGVzKCk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgaW50ZXJmYWNlcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKGludGVyZmFjZXNbaV0uZ2V0TmFtZSgpLmVxdWFs\ncyhQQ1RZUEUuZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBjLXR5cGUiLCBfbWFuYWdlZFR5\ncGUuZ2V0VHlwZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVO\nSEFOQ0VfTk9ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgY29uZmlndXJlQkNzKCk7CgogICAgICAgICAgICAvLyB2\nYWxpZGF0ZSBwcm9wZXJ0aWVzIGJlZm9yZSByZXBsYWNpbmcgZmllbGQgYWNj\nZXNzIHNvIHRoYXQKICAgICAgICAgICAgLy8gd2UgYnVpbGQgdXAgYSByZWNv\ncmQgb2YgYmFja2luZyBmaWVsZHMsIGV0YwogICAgICAgICAgICBpZiAoX21l\ndGEgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZKSB7CiAg\nICAgICAgICAgICAgICB2YWxpZGF0ZVByb3BlcnRpZXMoKTsKICAgICAgICAg\nICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAg\nICAgICAgIGFkZEF0dHJpYnV0ZVRyYW5zbGF0aW9uKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3Mo\nKTsKICAgICAgICAgICAgcHJvY2Vzc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBlbmhh\nbmNlQ2xhc3MoKTsKICAgICAgICAgICAgICAgIGFkZEZpZWxkcygpOwogICAg\nICAgICAgICAgICAgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKTsKICAgICAgICAg\nICAgICAgIGFkZFBDTWV0aG9kcygpOwogICAgICAgICAgICAgICAgYWRkQWNj\nZXNzb3JzKCk7CiAgICAgICAgICAgICAgICBhZGRBdHRhY2hEZXRhY2hDb2Rl\nKCk7CiAgICAgICAgICAgICAgICBhZGRTZXJpYWxpemF0aW9uQ29kZSgpOwog\nICAgICAgICAgICAgICAgYWRkQ2xvbmluZ0NvZGUoKTsKICAgICAgICAgICAg\nICAgIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIEVOSEFOQ0VfUEM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgicGVycy1hd2FyZSIsIF9tYW5hZ2VkVHlwZS5n\nZXRUeXBlKCkpKTsKICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfQVdBUkU7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNvbmZpZ3Vy\nZUJDcygpIHsKICAgICAgICBpZiAoIV9iY3NDb25maWd1cmVkKSB7CiAgICAg\nICAgICAgIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICBp\nZiAoX21hbmFnZWRUeXBlLmdldEF0dHJpYnV0ZShSRURFRklORURfQVRUUklC\nVVRFKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlw\nZS5hZGRBdHRyaWJ1dGUoUkVERUZJTkVEX0FUVFJJQlVURSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2lzQWxyZWFkeVJl\nZGVmaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlm\nIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBQQ1N1\nYmNsYXNzVmFsaWRhdG9yIHZhbCA9IG5ldyBQQ1N1YmNsYXNzVmFsaWRhdG9y\nKAogICAgICAgICAgICAgICAgICAgIF9tZXRhLCBfbWFuYWdlZFR5cGUsIF9s\nb2csIF9mYWlsKTsKICAgICAgICAgICAgICAgIHZhbC5hc3NlcnRDYW5TdWJj\nbGFzcygpOwoKICAgICAgICAgICAgICAgIF9wYyA9IF9tYW5hZ2VkVHlwZS5n\nZXRQcm9qZWN0KCkubG9hZENsYXNzKAogICAgICAgICAgICAgICAgICAgIHRv\nUENTdWJjbGFzc05hbWUoX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwogICAg\nICAgICAgICAgICAgaWYgKF9wYy5nZXRTdXBlcmNsYXNzQkMoKSAhPSBfbWFu\nYWdlZFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBfcGMuc2V0U3VwZXJj\nbGFzcyhfbWFuYWdlZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIF9wYy5z\nZXRBYnN0cmFjdChfbWFuYWdlZFR5cGUuaXNBYnN0cmFjdCgpKTsKICAgICAg\nICAgICAgICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShEeW5hbWljUGVy\nc2lzdGVuY2VDYXBhYmxlLmNsYXNzKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgX2lzQWxyZWFkeVN1YmNsYXNzZWQg\nPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgX3BjID0gX21hbmFnZWRUeXBlOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBfYmNzQ29uZmlndXJlZCA9IHRydWU7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIGdlbmVy\nYXRlZCBieXRlY29kZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgcmVjb3Jk\nKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChf\nbWFuYWdlZFR5cGUgIT0gX3BjICYmIGdldFJlZGVmaW5lKCkpCiAgICAgICAg\nICAgIHJlY29yZChfbWFuYWdlZFR5cGUpOwogICAgICAgIHJlY29yZChfcGMp\nOwogICAgICAgIGlmIChfb2lkcyAhPSBudWxsKQogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IF9vaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KQogICAgICAgICAgICAgICAgcmVjb3JkKChCQ0NsYXNzKSBpdHIubmV4\ndCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBnaXZlbiBj\nbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZChCQ0NsYXNz\nIGJjKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKF93cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgX3dyaXRlci53cml0ZShi\nYyk7CiAgICAgICAgZWxzZSBpZiAoX2RpciA9PSBudWxsKQogICAgICAgICAg\nICBiYy53cml0ZSgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBGaWxl\nIGRpciA9IEZpbGVzLmdldFBhY2thZ2VGaWxlKF9kaXIsIGJjLmdldFBhY2th\nZ2VOYW1lKCksIHRydWUpOwogICAgICAgICAgICBiYy53cml0ZShuZXcgRmls\nZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsgIi5jbGFzcyIpKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoZSBt\nZXRob2RzIGluIHRoaXMgcHJvcGVydHktYWNjZXNzIGluc3RhbmNlIGFyZQog\nICAgICogd3JpdHRlbiBjb3JyZWN0bHkuIFRoaXMgbWV0aG9kIGFsc28gZ2F0\naGVycyBpbmZvcm1hdGlvbiBvbiBlYWNoCiAgICAgKiBwcm9wZXJ0eSdzIGJh\nY2tpbmcgZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0\nZVByb3BlcnRpZXMoKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHM7\nCiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAg\nIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAg\nICAgIE1ldGhvZCBtZXRoOwogICAgICAgIEJDTWV0aG9kIGdldHRlciwgc2V0\ndGVyOwogICAgICAgIEJDRmllbGQgcmV0dXJuZWQsIGFzc2lnbmVkID0gbnVs\nbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKCEoZm1kc1tpXS5nZXRCYWNraW5nTWVt\nYmVyKCkgaW5zdGFuY2VvZiBNZXRob2QpKSB7CiAgICAgICAgICAgICAgICBh\nZGRWaW9sYXRpb24oInByb3BlcnR5LWJhZC1tZW1iZXIiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tpXSwgZm1kc1tpXS5nZXRC\nYWNraW5nTWVtYmVyKCkgfSwKICAgICAgICAgICAgICAgICAgICB0cnVlKTsK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBtZXRoID0gKE1ldGhvZCkgZm1kc1tpXS5nZXRCYWNraW5nTWVt\nYmVyKCk7CiAgICAgICAgICAgIC8vICMjIyMjIHRoaXMgd2lsbCBmYWlsIGlm\nIHdlIG92ZXJyaWRlIGFuZCBkb24ndCBjYWxsIHN1cGVyLgogICAgICAgICAg\nICBCQ0NsYXNzIGRlY2xhcmluZ1R5cGUgPSBfbWFuYWdlZFR5cGUuZ2V0UHJv\namVjdCgpCiAgICAgICAgICAgICAgICAubG9hZENsYXNzKGZtZHNbaV0uZ2V0\nRGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgZ2V0dGVyID0gZGVjbGFy\naW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChtZXRoLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAg\nICAgICAgIGlmIChnZXR0ZXIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1nZXR0ZXIiLCBuZXcgT2JqZWN0\nW117IGZtZHNbaV0gfSwKICAgICAgICAgICAgICAgICAgICB0cnVlKTsKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybmVkID0gZ2V0UmV0dXJuZWRGaWVsZChnZXR0ZXIpOwogICAg\nICAgICAgICBpZiAocmV0dXJuZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJlZ2lzdGVyQmFja2luZ0ZpZWxkSW5mbyhmbWRzW2ldLCBnZXR0ZXIsIHJl\ndHVybmVkKTsKCiAgICAgICAgICAgIHNldHRlciA9IGRlY2xhcmluZ1R5cGUu\nZ2V0RGVjbGFyZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWRzW2ldKSwKICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdldERlY2xhcmVk\nVHlwZSgpIH0pOwogICAgICAgICAgICBpZiAoc2V0dGVyID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1zZXR0\nZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGZt\nZHNbaV0gfSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRSZWRlZmluZSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIHN5bnRoZXRpYyBzZXR0\nZXIKICAgICAgICAgICAgICAgICAgICBzZXR0ZXIgPSBfbWFuYWdlZFR5cGUu\nZGVjbGFyZU1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0pLAogICAgICAg\nICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAgICAgICAg\nICBzZXR0ZXIubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgICAgICBD\nb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQocmV0dXJuZWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2V0\ndGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBhc3NpZ25lZCA9IGdldEFz\nc2lnbmVkRmllbGQoc2V0dGVyKTsKCiAgICAgICAgICAgIGlmIChhc3NpZ25l\nZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGVyICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJCYWNraW5nRmllbGRJ\nbmZvKGZtZHNbaV0sIHNldHRlciwgYXNzaWduZWQpOwoKICAgICAgICAgICAg\nICAgIGlmIChhc3NpZ25lZCAhPSByZXR1cm5lZCkKICAgICAgICAgICAgICAg\nICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LXNldHRlci1nZXR0ZXItbWlz\nbWF0Y2giLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAgICAgICAgICAgICAg\neyBmbWRzW2ldLCBhc3NpZ25lZC5nZXROYW1lKCksIChyZXR1cm5lZCA9PSBu\ndWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAgPyBudWxsIDogcmV0dXJu\nZWQuZ2V0TmFtZSgpIH0sIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVnaXN0ZXJCYWNraW5nRmll\nbGRJbmZvKEZpZWxkTWV0YURhdGEgZm1kLCBCQ01ldGhvZCBtZXRob2QsCiAg\nICAgICAgQkNGaWVsZCBmaWVsZCkgewogICAgICAgIGlmIChfYmFja2luZ0Zp\nZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYmFja2luZ0ZpZWxkcyA9IG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgX2JhY2tpbmdGaWVsZHMucHV0KG1ldGhv\nZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7CgogICAgICAgIGlmIChf\nYXR0cnNUb0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYXR0cnNUb0Zp\nZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2F0dHJzVG9GaWVsZHMu\ncHV0KGZtZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7CgogICAgICAg\nIGlmIChfZmllbGRzVG9BdHRycyA9PSBudWxsKQogICAgICAgICAgICBfZmll\nbGRzVG9BdHRycyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2ZpZWxkc1Rv\nQXR0cnMucHV0KGZpZWxkLmdldE5hbWUoKSwgZm1kLmdldE5hbWUoKSk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dHJpYnV0ZVRyYW5zbGF0aW9u\nKCkgewogICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKEF0dHJpYnV0ZVRy\nYW5zbGF0b3IuY2xhc3MpOwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJBdHRyaWJ1dGVJbmRleFRvRmllbGRO\nYW1lIiwKICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nIGludC5jbGFzcyB9KTsKICAgICAgICBtZXRob2QubWFrZVB1YmxpYygpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygp\nOwoKICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICBjb2RlLmlsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgdGFiaW5z\nLnNldExvdygwKTsKICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0\naCAtIDEpOwoKICAgICAgICAvLyBjYXNlIGk6CiAgICAgICAgLy8gICAgIHJl\ndHVybiA8X2F0dHJzVG9GaWVsZHMuZ2V0KGZtZHNbaV0uZ2V0TmFtZSgpKT4K\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoCiAgICAgICAgICAgICAgICBfYXR0cnNUb0ZpZWxkcy5n\nZXQoZm1kc1tpXS5nZXROYW1lKCkpKSk7CiAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgIHRhYmlu\ncy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAg\nIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHNldHRlciBtZXRob2QgZm9yIHRoZSBn\naXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5n\nIGdldFNldHRlck5hbWUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBy\nZXR1cm4gInNldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXRO\nYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVs\nZCByZXR1cm5lZCBieSB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlmIG5v\nbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZvciB0\nZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRSZXR1cm5l\nZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmluZEZp\nZWxkKG1ldGgsICgoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24o\nKSkpLnhyZXR1cm4oKQogICAgICAgICAgICAuc2V0VHlwZShtZXRoLmdldFJl\ndHVyblR5cGUoKSksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgZmllbGQgYXNzaWduZWQgaW4gdGhlIGdpdmVuIG1ldGhvZCwg\nb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1wcm90ZWN0ZWQgYW5k\nIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAgc3RhdGljIEJDRmll\nbGQgZ2V0QXNzaWduZWRGaWVsZChCQ01ldGhvZCBtZXRoKSB7CiAgICAgICAg\ncmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoKENvZGUpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5u\nZXdDb2RlQWN0aW9uKCkpKS5wdXRmaWVsZCgpLCB0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgcmV0dXJuZWQgLyBhc3Np\nZ25lZCBieSA8Y29kZT5tZXRoPC9jb2RlPi4gUmV0dXJucwogICAgICogbnVs\nbCBpZiBub24tZmllbGRzIChtZXRob2RzLCBsaXRlcmFscywgcGFyYW1ldGVy\ncywgdmFyaWFibGVzKSBhcmUKICAgICAqIHJldHVybmVkLCBvciBpZiBub24t\ncGFyYW1ldGVycyBhcmUgYXNzaWduZWQgdG8gZmllbGRzLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBCQ0ZpZWxkIGZpbmRGaWVsZChCQ01ldGhvZCBt\nZXRoLCBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSwKICAgICAgICBib29sZWFuIGZp\nbmRBY2Nlc3NlZCkgewogICAgICAgIC8vIGlnbm9yZSBhbnkgc3RhdGljIG1l\ndGhvZHMuIE9wZW5KUEEgb25seSBjdXJyZW50bHkgc3VwcG9ydHMKICAgICAg\nICAvLyBub24tc3RhdGljIHNldHRlcnMgYW5kIGdldHRlcnMKICAgICAgICBp\nZiAobWV0aC5pc1N0YXRpYygpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKGZhbHNlKTsKICAg\nICAgICBpZiAoY29kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIEJDRmll\nbGQgZmllbGQgPSBudWxsLCBjdXI7CiAgICAgICAgSW5zdHJ1Y3Rpb24gdGVt\ncGxhdGVJbnMsIHByZXZJbnMsIGVhcmxpZXJJbnM7CiAgICAgICAgaW50IGJh\nY2t1cENvdW50ID0gMzsKICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3\nYXJkKHRlbXBsYXRlKSkgewogICAgICAgICAgICB0ZW1wbGF0ZUlucyA9IGNv\nZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZp\nb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAg\nICAgcHJldklucyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIGlm\nIChwcmV2SW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0cnVjdGlvbgogICAgICAg\nICAgICAgICAgJiYgY29kZS5oYXNQcmV2aW91cygpKSB7CiAgICAgICAgICAg\nICAgICBwcmV2SW5zID0gY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAg\nICAgYmFja3VwQ291bnQrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICAgICAgZWFybGllcklucyA9IGNvZGUucHJldmlv\ndXMoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBvcGNvZGUgdHdvIGJlZm9y\nZSB0aGUgdGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAsIGNoZWNrCiAgICAgICAg\nICAgIC8vIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiBiYXNlZCBv\nbiB3aGF0IHR5cGUgb2YgZmluZAogICAgICAgICAgICAvLyB3ZSdyZSBkb2lu\nZwogICAgICAgICAgICBpZiAoIShlYXJsaWVySW5zIGluc3RhbmNlb2YgTG9h\nZEluc3RydWN0aW9uKQogICAgICAgICAgICAgICAgfHwgISgoTG9hZEluc3Ry\ndWN0aW9uKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG1pZGRsZSBp\nbnN0cnVjdGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhlbiBpdCdzIHRoZQogICAg\nICAgICAgICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcgYWNjZXNzZWQKICAgICAg\nICAgICAgaWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0YW5jZW9m\nIEdldEZpZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAgICAgICAgICAgIGZpbmFs\nIEZpZWxkSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAoRmllbGRJbnN0cnVjdGlv\nbikgcHJldkluczsKICAgICAgICAgICAgICAgIGN1ciA9IChCQ0ZpZWxkKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRB\nY3Rpb24oZlByZXZJbnMpKTsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBt\naWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2FkXzEsIHRoZW4gdGhlCiAg\nICAgICAgICAgICAgICAvLyBtYXRjaGVkIGluc3RydWN0aW9uIGlzIHRoZSBm\naWVsZCB0aGF0J3MgYmVpbmcgc2V0LgogICAgICAgICAgICB9IGVsc2UgaWYg\nKGZpbmRBY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3RhbmNlb2YgTG9hZEluc3Ry\ndWN0aW9uCiAgICAgICAgICAgICAgICAmJiAoKExvYWRJbnN0cnVjdGlvbikg\ncHJldklucykuZ2V0UGFyYW0oKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBm\naW5hbCBGaWVsZEluc3RydWN0aW9uIGZUZW1wbGF0ZUlucyA9CiAgICAgICAg\nICAgICAgICAgICAgKEZpZWxkSW5zdHJ1Y3Rpb24pIHRlbXBsYXRlSW5zOwog\nICAgICAgICAgICAgICAgY3VyID0gKEJDRmllbGQpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAg\nICAgICAgLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVsZEFjdGlvbihmVGVtcGxh\ndGVJbnMpKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGlmIChmaWVsZCAhPSBudWxsICYm\nIGN1ciAhPSBmaWVsZCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICBmaWVsZCA9IGN1cjsKCiAgICAgICAgICAgIC8vIHJlYWR5\nIGZvciBuZXh0IHNlYXJjaCBpdGVyYXRpb24KICAgICAgICAgICAgd2hpbGUg\nKGJhY2t1cENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgY29kZS5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBiYWNrdXBDb3VudC0tOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlY29yZCBhIHZpb2xhdGlvbiBvZiB0aGUgcHJvcGVy\ndHkgYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFZpb2xhdGlvbihTdHJpbmcga2V5LCBPYmplY3RbXSBhcmdzLCBi\nb29sZWFuIGZhdGFsKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25zID09IG51\nbGwpCiAgICAgICAgICAgIF92aW9sYXRpb25zID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICBfdmlvbGF0aW9ucy5hZGQoX2xvYy5nZXQoa2V5LCBhcmdzKSk7\nCiAgICAgICAgX2ZhaWwgfD0gZmF0YWw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBMb2cgLyB0aHJvdyByZWNvcmRlZCBwcm9wZXJ0eSBhY2Nlc3MgdmlvbGF0\naW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb2Nlc3NWaW9sYXRp\nb25zKCkgewogICAgICAgIGlmIChfdmlvbGF0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIFN0cmluZyBzZXAgPSBKMkRvUHJp\ndkhlbHBlci5nZXRMaW5lU2VwYXJhdG9yKCk7CiAgICAgICAgU3RyaW5nQnVm\nZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IF92aW9sYXRpb25zLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoaXRyLm5leHQoKSk7\nCiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChzZXApOwogICAgICAgIH0KICAgICAgICBNZXNzYWdl\nIG1zZyA9IF9sb2MuZ2V0KCJwcm9wZXJ0eS12aW9sYXRpb25zIiwgYnVmKTsK\nCiAgICAgICAgaWYgKF9mYWlsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihtc2cpOwogICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKG1zZyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXBsYWNlZCBhbGwgZGlyZWN0IGFjY2VzcyB0byBtYW5h\nZ2VkIGZpZWxkcyB3aXRoIHRoZSBhcHByb3ByaWF0ZQogICAgICogcGNHZXQv\ncGNTZXQgbWV0aG9kLiBOb3RlIHRoYXQgdGhpcyBpbmNsdWRlcyBhY2Nlc3Mg\ndG8gZmllbGRzCiAgICAgKiBvd25lZCBieSBQZXJzaXN0ZW5jZUNhcGFibGUg\nY2xhc3NlcyBvdGhlciB0aGFuIHRoaXMgb25lLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKSB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBjcmVhdGUg\ndGVtcGxhdGUgcHV0ZmllbGQvZ2V0ZmllbGQgaW5zdHJ1Y3Rpb25zIHRvIHNl\nYXJjaCBmb3IKICAgICAgICBDb2RlIHRlbXBsYXRlID0gKENvZGUpIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpOwogICAgICAgIEluc3RydWN0aW9u\nIHB1dCA9IHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1Y3Rp\nb24gZ2V0ID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsKICAgICAgICBJbnN0cnVj\ndGlvbiBzdGF0ID0gdGVtcGxhdGUuaW52b2tlc3RhdGljKCk7CgogICAgICAg\nIC8vIGxvb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsgdGhpcyBpcyBkb25lIGJl\nZm9yZSBhbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAgICAgICAvLyBzbyB3ZSBk\nb24ndCBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBzeW50aGV0aWMg\nbWV0aG9kcy4KICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfbWFuYWdl\nZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAgICAgICAgQ29kZSBjb2Rl\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBjb2RlID0gbWV0aG9kc1tpXS5nZXRDb2Rl\nKGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGRvbid0IG1vZGlmeSB0aGUgbWV0\naG9kcyBzcGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMKICAg\nICAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAhc2tpcEVuaGFuY2UobWV0\naG9kc1tpXSkpIHsKICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0\nZUZpZWxkQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwgc3RhdCk7CiAgICAgICAg\nICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBw\ndXQsIGZhbHNlLCBzdGF0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2VzIGFsbCBpbnN0cnVjdGlvbnMg\nbWF0Y2hpbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBnaXZlbgogICAg\nICogY29kZSBibG9jayB3aXRoIGNhbGxzIHRvIHRoZSBhcHByb3ByaWF0ZSBn\nZW5lcmF0ZWQgZ2V0dGVyL3NldHRlci4KICAgICAqCiAgICAgKiBAcGFyYW0g\nY29kZSB0aGUgY29kZSBibG9jayB0byBtb2RpZnk7IHRoZSBjb2RlIGl0ZXJh\ndG9yIHdpbGwKICAgICAqIGJlIHBsYWNlZCBiZWZvcmUgdGhlIGZpcnN0IGlu\nc3RydWN0aW9uIG9uIG1ldGhvZCBzdGFydCwKICAgICAqIGFuZCB3aWxsIGJl\nIGFmdGVyIHRoZSBsYXN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBjb21wbGV0\naW9uCiAgICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlv\nbiB0byBzZWFyY2ggZm9yOyBlaXRoZXIgYQogICAgICogZ2V0ZmllbGQgb3Ig\ncHV0ZmllbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBnZXQgYm9vbGVh\nbiBpbmRpY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQgaW5zdHJ1Y3Rpb24KICAg\nICAqIEBwYXJhbSBzdGF0IHRlbXBsYXRlIGludm9rZXN0YXRpYyBpbnN0cnVj\ndGlvbiB0byByZXBsYWNlIHdpdGgKICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKENvZGUgY29kZSwgSW5z\ndHJ1Y3Rpb24gaW5zLAogICAgICAgIGJvb2xlYW4gZ2V0LCBJbnN0cnVjdGlv\nbiBzdGF0KSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIEZpZWxkSW5zdHJ1Y3Rp\nb24gZmk7CiAgICAgICAgTWV0aG9kSW5zdHJ1Y3Rpb24gbWk7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBvd25lcjsKICAgICAgICBTdHJpbmcgbmFtZSwgdHlw\nZU5hbWUsIG1ldGhvZE5hbWU7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNo\nRm9yd2FyZChpbnMpKSB7CiAgICAgICAgICAgIC8vIGJhY2sgdXAgdG8gdGhl\nIG1hdGNoZWQgaW5zdHJ1Y3Rpb24KICAgICAgICAgICAgZmkgPSAoRmllbGRJ\nbnN0cnVjdGlvbikgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBuYW1l\nID0gZmkuZ2V0RmllbGROYW1lKCk7CiAgICAgICAgICAgIHR5cGVOYW1lID0g\nZmkuZ2V0RmllbGRUeXBlTmFtZSgpOwogICAgICAgICAgICBvd25lciA9IGdl\ndFBlcnNpc3RlbmNlQ2FwYWJsZU93bmVyKG5hbWUsIGZpLmdldEZpZWxkRGVj\nbGFyZXJUeXBlKCkpOwoKICAgICAgICAgICAgaWYgKG93bmVyICE9IG51bGwK\nICAgICAgICAgICAgICAgICYmIG93bmVyLmdldEFjY2Vzc1R5cGUoKSA9PSBD\nbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkgewogICAgICAgICAgICAg\nICAgLy8gaWYgd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5nIGEgZmllbGQgaW4g\nYW5vdGhlciBjbGFzcwogICAgICAgICAgICAgICAgLy8gaGllcmFyY2h5IHRo\nYXQgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MsIHNvbWV0aGluZyBpcyB3cm9uZwog\nICAgICAgICAgICAgICAgaWYgKG93bmVyICE9IF9tZXRhICYmIG93bmVyLmdl\ndERlY2xhcmVkRmllbGQobmFtZSkgIT0gbnVsbCAmJgogICAgICAgICAgICAg\nICAgICAgIF9tZXRhICE9IG51bGwgJiYgIW93bmVyLmdldERlc2NyaWJlZFR5\ncGUoKQogICAgICAgICAgICAgICAgICAgICAgICAuaXNBc3NpZ25hYmxlRnJv\nbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwcm9wZXJ0\neS1maWVsZC1hY2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IF9tZXRhLCBvd25lciwgbmFtZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpIH0pKTsK\nCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBkaXJlY3RseSBhY2Nlc3Np\nbmcgYSBwcm9wZXJ0eS1iYWNraW5nIGZpZWxkIG91dHNpZGUKICAgICAgICAg\nICAgICAgIC8vIHRoZSBwcm9wZXJ0eSBpbiBvdXIgb3duIGNsYXNzLCBub3Rp\nZnkgdXNlcgogICAgICAgICAgICAgICAgaWYgKGlzQmFja2luZ0ZpZWxkT2ZB\nbm90aGVyUHJvcGVydHkobmFtZSwgY29kZSkpCiAgICAgICAgICAgICAgICAg\nICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1maWVsZC1hY2Nlc3MiLCBuZXcg\nT2JqZWN0W117IF9tZXRhLAogICAgICAgICAgICAgICAgICAgICAgICBvd25l\nciwgbmFtZSwgY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCkgfSwgZmFsc2Up\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3duZXIgPT0gbnVs\nbCB8fAogICAgICAgICAgICAgICAgb3duZXIuZ2V0RGVjbGFyZWRGaWVsZChm\ncm9tQmFja2luZ0ZpZWxkTmFtZShuYW1lKSkgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgLy8gbm90IHBlcnNpc3RlbnQgZmllbGQ/CiAgICAgICAgICAg\nICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRSZWRlZmluZSgpICYmICFnZXRD\ncmVhdGVTdWJjbGFzcygpCiAgICAgICAgICAgICAgICAmJiBvd25lci5nZXRB\nY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsK\nICAgICAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGluc3RydWN0aW9uIHdp\ndGggYSBjYWxsIHRvIHRoZSBnZW5lcmF0ZWQgYWNjZXNzCiAgICAgICAgICAg\nICAgICAvLyBtZXRob2QKICAgICAgICAgICAgICAgIG1pID0gKE1ldGhvZElu\nc3RydWN0aW9uKSBjb2RlLnNldChzdGF0KTsKCiAgICAgICAgICAgICAgICAv\nLyBpbnZva2UgdGhlIHByb3BlciBhY2Nlc3MgbWV0aG9kLCB3aGV0aGVyIGdl\ndHRlciBvciBzZXR0ZXIKICAgICAgICAgICAgICAgIFN0cmluZyBwcmVmaXgg\nPSAoZ2V0KSA/IFBSRSArICJHZXQiIDogUFJFICsgIlNldCI7CiAgICAgICAg\nICAgICAgICBtZXRob2ROYW1lID0gcHJlZml4ICsgbmFtZTsKICAgICAgICAg\nICAgICAgIGlmIChnZXQpIHsKICAgICAgICAgICAgICAgICAgICBtaS5zZXRN\nZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgICAgICAgICBtZXRob2ROYW1lLCB0eXBlTmFtZSwgbmV3IFN0cmluZ1td\nCiAgICAgICAgICAgICAgICAgICAgICAgIHsgZ2V0VHlwZShvd25lcikuZ2V0\nTmFtZSgpIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lLCAidm9p\nZCIsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGdl\ndFR5cGUob3duZXIpLmdldE5hbWUoKSwgdHlwZU5hbWUgfSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAg\nICAgICBuYW1lID0gZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSk7CiAgICAg\nICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgYWRk\nTm90aWZ5QWNjZXNzKGNvZGUsIG93bmVyLmdldEZpZWxkKG5hbWUpKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHRoZSBz\nZXQgb3BlcmF0aW9ucyBhZnRlciB0aGUgZmllbGQgbXV0YXRpb24sIGJ1dAog\nICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGxvYWQgdGhlIG9sZCB2YWx1\nZSBmb3IgdXNlIGluIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIFN0YXRl\nTWFuYWdlci5zZXR0aW5nWFhYIG1ldGhvZC4KICAgICAgICAgICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZGaSA9IGZpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgK\nICAgICAgICAgICAgICAgICAgICAgICAgKEJDRmllbGQpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0RmllbGRJbnN0cnVjdGlvbkZpZWxkQWN0\naW9uKGZGaSkpKTsKICAgICAgICAgICAgICAgICAgICBpbnQgdmFsID0gY29k\nZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLnhzdG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlwZShmaS5nZXRGaWVs\nZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgcGFzdCB0\naGUgcHV0ZmllbGQKICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsK\nICAgICAgICAgICAgICAgICAgICBhZGROb3RpZnlNdXRhdGlvbihjb2RlLCBv\nd25lci5nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBh\nZGROb3RpZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIC8vIFBDSGVscGVyLmFjY2Vzc2luZ0ZpZWxkKHRoaXMsIDxh\nYnNvbHV0ZS1pbmRleD4pOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJ\nbmRleCgpKTsKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICJhY2Nl\nc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG11c3QgYmUgY2FsbGVkIGFmdGVyIHNldHRpbmcg\ndGhlIHZhbHVlIGluIHRoZSBvYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJh\nbSBjb2RlCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBwb3NpdGlvbiBpbiB0aGUg\nbG9jYWwgdmFyaWFibGUgdGFibGUgd2hlcmUgdGhlCiAgICAgKiBvbGQgdmFs\ndWUgaXMgc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFyYW0gdGhlIHBhcmFtZXRl\nciBwb3NpdGlvbiBjb250YWluaW5nIHRoZSBuZXcgdmFsdWUsIG9yCiAgICAg\nKiAtMSBpZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZhaWxhYmxlIGFuZCBzaG91\nbGQgdGhlcmVmb3JlIGJlIGxvb2tlZAogICAgICogdXAuCiAgICAgKiBAdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBjb2RlLCBGaWVsZE1ldGFE\nYXRhIGZtZCwgaW50IHZhbCwKICAgICAgICBpbnQgcGFyYW0pCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gUENI\nZWxwZXIuc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4sIG9s\nZCwgbmV3KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7\nCiAgICAgICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgICAgICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lhbCBzaWduYXR1cmVzIGZv\nciBwcmltaXRpdmVzIGFuZCBTdHJpbmdzCiAgICAgICAgaWYgKCF0eXBlLmlz\nUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcuY2xhc3MpCiAgICAgICAg\nICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS54bG9hZCgp\nLnNldExvY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAocGFy\nYW0gPT0gLTEpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBj\nb2RlLnhsb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgfQogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywgInNldHRpbmdGaWVsZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgaW50LmNsYXNzLCB0eXBlLCB0eXBlCiAg\nICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNzZXMgYSBmaWVsZCB0aGF0\nIGlzIGEgYmFja2luZwogICAgICogZmllbGQgb2YgYW5vdGhlciBwcm9wZXJ0\neSBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBjbGFzcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVy\ndHkoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewogICAgICAgIFN0cmluZyBt\nZXRoTmFtZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpOwogICAgICAg\nIHJldHVybiAhIjxpbml0PiIuZXF1YWxzKG1ldGhOYW1lKQogICAgICAgICAg\nICAmJiBfYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAgICAgICAgICAgICYmICFu\nYW1lLmVxdWFscyhfYmFja2luZ0ZpZWxkcy5nZXQobWV0aE5hbWUpKQogICAg\nICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcy5jb250YWluc1ZhbHVlKG5hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1\ncm4gdGhlIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Mgb2YK\nICAgICAqIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZmllbGROYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFt\nIG93bmVyIHRoZSBub21pbmFsIG93bmVyIG9mIHRoZSBmaWVsZAogICAgICog\nQHJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQZXJzaXN0ZW5jZUNhcGFi\nbGUgdHlwZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0aGUgZmllbGQgKGFuZCB0\naGVyZWZvcmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9kKSwgb3IgbnVsbCBpZiBu\nb25lCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRQZXJz\naXN0ZW5jZUNhcGFibGVPd25lcihTdHJpbmcgZmllbGROYW1lLAogICAgICAg\nIENsYXNzIG93bmVyKSB7CiAgICAgICAgLy8gZmluZCB0aGUgYWN0dWFsIGFu\nY2VzdG9yIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhlIGZpZWxkLCB0aGVuCiAg\nICAgICAgLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlzIHBlcnNpc3RlbnQsIGFu\nZCBpZiB0aGUgZmllbGQgaXMgbWFuYWdlZAogICAgICAgIEZpZWxkIGYgPSBS\nZWZsZWN0aW9uLmZpbmRGaWVsZChvd25lciwgZmllbGROYW1lLCBmYWxzZSk7\nCiAgICAgICAgaWYgKGYgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgICAgaWYg\nKF9tZXRhICE9IG51bGwgJiYgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlz\nSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBfbWV0YTsKCiAgICAg\nICAgcmV0dXJuIF9yZXBvcy5nZXRNZXRhRGF0YShmLmdldERlY2xhcmluZ0Ns\nYXNzKCksIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYWxsIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRoZSBieXRlY29kZSBieSBk\nZWxlZ2F0aW5nIHRvCiAgICAgKiB0aGUgdmFyaW91cyBhZGRYWFhNZXRob2Rz\nICgpIGZ1bmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJbmNsdWRlcwogICAgICog\nYWxsIHN0YXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcy4KICAgICAqIE5vdGUg\ndGhhdCB0aGUgJ3N0b2NrJyBtZXRob2RzIGxpa2UgPGNvZGU+cGNJc1RyYW5z\nYWN0aW9uYWw8L2NvZGU+LAogICAgICogPGNvZGU+cGNGZXRjaE9iamVjdElk\nPC9jb2RlPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkgaW4gdGhlCiAgICAgKiBs\nZWFzdC1kZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJsZSB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkUENNZXRob2RzKCkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBhZGRDbGVhckZp\nZWxkc01ldGhvZCgpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKHRy\ndWUpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAg\nICAgICBhZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhvZCgpOwogICAgICAgIGFk\nZFJlcGxhY2VGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkUHJvdmlkZUZp\nZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRDb3B5RmllbGRzTWV0aG9kKCk7\nCgogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxs\nIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgYWRkU3Rv\nY2tNZXRob2RzKCk7CiAgICAgICAgICAgIGFkZEdldFZlcnNpb25NZXRob2Qo\nKTsKICAgICAgICAgICAgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgp\nOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpICE9\nIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAg\nICBhZGROb09wQXBwbGljYXRpb25JZGVudGl0eU1ldGhvZHMoKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGFkZCB0aGUgYXBwIGlkIG1ldGhvZHMgdG8gZWFj\naCBzdWJjbGFzcyByYXRoZXIKICAgICAgICAvLyB0aGFuIGp1c3QgdGhlIHN1\ncGVyY2xhc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxlIHRvIGhhdmUKICAgICAg\nICAvLyBhIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlkIGhpZXJhcmNoeSB0aGF0\nIG1hdGNoZXMgdGhlCiAgICAgICAgLy8gcGVyc2lzdGVudCBjbGFzcyBpbmhl\ncml0YW5jZSBoaWVyYXJjaHkKICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTgogICAg\nICAgICAgICAmJiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8\nfCBnZXRDcmVhdGVTdWJjbGFzcygpIHx8CiAgICAgICAgICAgICAgICBfbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKSAhPQogICAgICAgICAgICAgICAgICAgIF9t\nZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0T2JqZWN0SWRUeXBl\nKCkpKSB7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElk\nTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlG\naWVsZHNGcm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7CiAgICAgICAgICAgIGFk\nZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAg\nICAgICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKHRydWUpOwog\nICAgICAgICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKGZhbHNl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBtZXRo\nb2QgdG8gY2xlYXIgYWxsIHBlcnNpc3RlbnQgZmllbGRzOyB3ZSdsbCBjYWxs\nIHRoaXMgZnJvbQogICAgICogdGhlIG5ldyBpbnN0YW5jZSBtZXRob2QgdG8g\nZW5zdXJlIHRoYXQgdW5sb2FkZWQgZmllbGRzIGhhdmUKICAgICAqIGRlZmF1\nbHQgdmFsdWVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xlYXJG\naWVsZHNNZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHByb3RlY3RlZCB2b2lkIHBjQ2xlYXJGaWVs\nZHMgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBzdXBlci5wY0NsZWFyRmllbGRzICgpCiAgICAgICAgaWYgKF9t\nZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpKSwgUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFz\ncywKICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxk\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRNYW5hZ2VtZW50\nKCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBG\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAg\nICB9CgogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+\ncGNOZXdJbnN0YW5jZTwvY29kZT4gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4K\nICAgICAqIFRoZXNlIG1ldGhvZHMgYXJlIHVzZWQgYnkgdGhlIGltcGwgaGVs\ncGVyIHRvIGNyZWF0ZSBuZXcKICAgICAqIG1hbmFnZWQgaW5zdGFuY2VzIGVm\nZmljaWVudGx5IHdpdGhvdXQgcmVmbGVjdGlvbi4KICAgICAqCiAgICAgKiBA\ncGFyYW0gb2lkIHNldCB0byB0cnVlIHRvIG1pbWljIHRoZSBtZXRob2QgdmVy\nc2lvbiB0aGF0IHRha2VzCiAgICAgKiBhbiBvaWQgdmFsdWUgYXMgd2VsbCBh\ncyBhIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZE5ld0luc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2lkKSB7CiAgICAgICAgLy8g\ncHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBwY05ld0luc3RhbmNlICguLi4p\nCiAgICAgICAgQ2xhc3NbXSBhcmdzID0KICAgICAgICAgICAgKG9pZCkgPyBu\nZXcgQ2xhc3NbXXsgU01UWVBFLCBPYmplY3QuY2xhc3MsIGJvb2xlYW4uY2xh\nc3MgfQogICAgICAgICAgICAgICAgOiBuZXcgQ2xhc3NbXXsgU01UWVBFLCBi\nb29sZWFuLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld0luc3RhbmNlIiwgUENUWVBFLCBh\ncmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgYWJzdHJhY3QsIHRocm93\nIGEgVXNlckV4Y2VwdGlvbgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgp\nKSB7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIFVTRVJFWENF\nUCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICAvLyBYWFggcGMgPSBuZXcgWFhYICgpOwogICAgICAg\nIGNvZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGlu\naXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGluc3QgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3Jl\nKCkuc2V0TG9jYWwoaW5zdCk7CgogICAgICAgIC8vIGlmIChjbGVhcikKICAg\nICAgICAvLyAgIHBjLnBjQ2xlYXJGaWVsZHMgKCk7CiAgICAgICAgY29kZS5p\nbG9hZCgpLnNldFBhcmFtKChvaWQpID8gMiA6IDEpOwogICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBub2NsZWFyID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lk\nLmNsYXNzLCBudWxsKTsKCiAgICAgICAgLy8gcGMucGNTdGF0ZU1hbmFnZXIg\nPSBzbTsKICAgICAgICBub2NsZWFyLnNldFRhcmdldChjb2RlLmFsb2FkKCku\nc2V0TG9jYWwoaW5zdCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CgogICAgICAgIC8vIGNvcHkga2V5IGZpZWxkcyBmcm9tIG9pZAog\nICAgICAgIGlmIChvaWQpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndExvY2FsKGluc3QpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNs\nYXNzIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gcmV0dXJuIHBjOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wcm90ZWN0ZWQgc3RhdGlj\nIGludCBwY0dldE1hbmFnZWRGaWVsZENvdW50ICgpPC9jb2RlPgogICAgICog\nbWV0aG9kIHRvIHRoZSBieXRlY29kZSwgcmV0dXJuaW5nIHRoZSBpbmhlcml0\nZWQgZmllbGQgY291bnQgYWRkZWQKICAgICAqIHRvIHRoZSBudW1iZXIgb2Yg\nbWFuYWdlZCBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgUGVyc2lzdGVuY2VDYXBh\nYmxlIGNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFuYWdl\nZEZpZWxkQ291bnRNZXRob2QoKSB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHN0\nYXRpYyBpbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRN\nYW5hZ2VkRmllbGRDb3VudCIsCiAgICAgICAgICAgIGludC5jbGFzcywgbnVs\nbCk7CiAgICAgICAgbWV0aG9kLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBt\nZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1l\ndGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyByZXR1cm4gPGZpZWxk\ncz4gKyBwY0luaGVyaXRlZEZpZWxkQ291bnQKICAgICAgICAvLyBhd2hpdGU6\nIHRoZSBhYm92ZSBzaG91bGQgd29yaywgYnV0IEknbSBzZWVpbmcgYSBtZXNz\nZWQgdXAgc2l0dWF0aW9uCiAgICAgICAgLy8gYWxsIG9mIGEgc3VkZGVuIHdo\nZXJlIHdoZW4gYSBzdWJjbGFzcyBjYWxscyB0aGlzIG1ldGhvZCwgaXQgc29t\nZWhvdwogICAgICAgIC8vIGhhcHBlbnMgYmVmb3JlIDxjbGluaXQ+IGlzIGV2\nZXIgaW52b2tlZCwgYW5kIHNvIG91cgogICAgICAgIC8vIHBjSW5oZXJpdGVk\nRmllbGRDb3VudCBmaWVsZCBpc24ndCBpbml0aWFsaXplZCEgIHNvIGluc3Rl\nYWQsCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgPHN1cGVyY2xhc3M+\nLnBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5n\ndGgpOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIENsYXNzIHN1cGVyQ2xhc3MgPSBnZXRUeXBl\nKF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpOwogICAgICAgICAg\nICBTdHJpbmcgc3VwZXJOYW1lID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/CiAg\nICAgICAgICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoc3Vw\nZXJDbGFzcykgOgogICAgICAgICAgICAgICAgc3VwZXJDbGFzcy5nZXROYW1l\nKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKHN1cGVyTmFtZSwKICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2Vk\nRmllbGRDb3VudCIsIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAg\nICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5p\ncmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSNwY1Byb3ZpZGVGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkc30gbWV0aG9kcyB0\nbyB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQ\ncm92aWRlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNQcm92\naWRlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxk\nIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5j\nbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhl\nIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNo\nTWV0aG9kKFBSRSArICJQcm92aWRlRmllbGQiLCBjb2RlKTsKCiAgICAgICAg\nLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNl\ncHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0\nZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6\nIF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUs\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBj\nb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBU\nYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0\nY2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAg\nICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAg\nICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5wcm92aWRlZDx0eXBl\nPkZpZWxkCiAgICAgICAgICAgIC8vICAgICAodGhpcywgZmllbGROdW1iZXIp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVy\nZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAg\nICAgICAgICAgICAgICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgInBy\nb3ZpZGVkIiwgZmFsc2UsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVm\nYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQog\nICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2Vw\ndGlvbgogICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lv\nbihtZXRob2QpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0Bs\naW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZH0gYW5kCiAg\nICAgKiB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxk\nc30gbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGlj\nIHZvaWQgcGNSZXBsYWNlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAg\nICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nUmVwbGFjZUZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENs\nYXNzW117IGludC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5n\nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9\nIGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCBjb2Rl\nKTsKCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVz\ndCB0aHJvdyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQog\nICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAg\nICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhj\nZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQog\nICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwog\nICAgICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNv\nZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygw\nKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAx\nKTsKCiAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5y\nZXBsYWNlPHR5cGU+RmllbGQKICAgICAgICAgICAgLy8gICh0aGlzLCBmaWVs\nZE51bWJlcik7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBh\nZGRTZXRNYW5hZ2VkVmFsdWVDb2RlIGNhbGwgYmVsb3cuCiAgICAgICAgICAg\nICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpKTsKCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5h\nZ2VyTWV0aG9kCiAgICAgICAgICAgICAgICAgICAgKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCksICJyZXBsYWNlIiwgdHJ1ZSwgZmFsc2UpKTsKICAgICAg\nICAgICAgICAgIGlmICghZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKS5pc1By\naW1pdGl2ZSgpKQogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAg\nICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNb\naV0pOwogICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxl\nZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNl\ndERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgICAg\nIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAg\nICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBhZGRN\ndWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFi\nbGUjcGNDb3B5RmllbGRzfSBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUZpZWxkc01ldGhvZCgpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gcHVibGljIHZvaWQgcGNDb3B5RmllbGQgKE9iamVjdCBwYywgaW50IGZp\nZWxkKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJDb3B5RmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNz\nLmdldE5hbWUoKSwKICAgICAgICAgICAgbmV3IFN0cmluZ1tdeyBfbWFuYWdl\nZFR5cGUuZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0TmFtZSgpIH0pOwogICAg\nICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZl\ncnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVs\nTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiQ29weUZpZWxkIiwg\nY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3Qs\nIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRz\nKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwog\nICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJv\nd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xh\nc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZh\nbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2Fs\nKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMg\nPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRM\nb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3Ro\nIC0gMSk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBv\ndGhlci48ZmllbGQ+OwogICAgICAgICAgICAgICAgLy8gb3Igc2V0PGZpZWxk\nPiAob3RoZXIuZ2V0PGZpZWxkPik7CiAgICAgICAgICAgICAgICB0YWJpbnMu\nYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nc1tpXSwgZmFsc2UpOwogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBi\ncmVhazsKICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRhYmlucy5z\nZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAg\nICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgYWRk\nTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCB0aGUgY29kZSBj\nb21tb24gdG8gdGhlIGJlZ2lubmluZyBvZiBib3RoIHRoZQogICAgICogcGNS\nZXBsYWNlRmllbGQgbWV0aG9kIGFuZCB0aGUgcGNQcm92aWRlRmllbGQgbWV0\naG9kLiBUaGlzIGluY2x1ZGVzCiAgICAgKiBjYWxjdWxhdGluZyB0aGUgcmVs\nYXRpdmUgZmllbGQgbnVtYmVyIG9mIHRoZSBkZXNpcmVkIGZpZWxkIGFuZCBj\nYWxsaW5nCiAgICAgKiB0aGUgc3VwZXJjbGFzcyBpZiBuZWNlc3NhcnkuCiAg\nICAgKgogICAgICogQHJldHVybiB0aGUgaW5kZXggaW4gd2hpY2ggdGhlIGxv\nY2FsIHZhcmlhYmxlIGhvbGRpbmcgdGhlIHJlbGF0aXZlCiAgICAgKiBmaWVs\nZCBudW1iZXIgaXMgc3RvcmVkCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGJl\nZ2luU3dpdGNoTWV0aG9kKFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsKICAg\nICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFs\ncyhuYW1lKTsKICAgICAgICBpbnQgZmllbGROdW1iZXIgPSAoY29weSkgPyAx\nIDogMDsKCiAgICAgICAgaW50IHJlbExvY2FsID0gY29kZS5nZXROZXh0TG9j\nYWxzSW5kZXgoKTsKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1i\nZXIpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKHJlbExv\nY2FsKTsKICAgICAgICAgICAgcmV0dXJuIHJlbExvY2FsOwogICAgICAgIH0K\nCiAgICAgICAgLy8gaW50IHJlbCA9IGZpZWxkTnVtYmVyIC0gcGNJbmhlcml0\nZWRGaWVsZENvdW50CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZp\nZWxkTnVtYmVyKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgY29kZS5pc3ViKCk7CiAg\nICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAg\nICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKCiAgICAgICAg\nLy8gc3VwZXI6IGlmIChyZWwgPCAwKSBzdXBlci5wY1JlcGxhY2VGaWVsZCAo\nZmllbGROdW1iZXIpOyByZXR1cm47CiAgICAgICAgLy8gbm8gc3VwZXI6IGlm\nIChyZWwgPCAwKSB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nICgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZn\nZSgpOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICBTdHJpbmdbXSBhcmdzOwogICAgICAgICAg\nICBpZiAoY29weSkgewogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBTdHJp\nbmdbXXsgZ2V0VHlwZShfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nKS4KICAgICAgICAgICAgICAgICAgICBnZXROYW1lKCksIGludC5jbGFzcy5n\nZXROYW1lKCkgfTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBh\ncmdzID0gbmV3IFN0cmluZ1tdeyBpbnQuY2xhc3MuZ2V0TmFtZSgpIH07CiAg\nICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcik7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChn\nZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKSkuZ2V0TmFtZSgpLCBuYW1lLCAKICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICAgICAgY29k\nZS52cmV0dXJuKCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRocm93\nRXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncyk7CgogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAg\nICAgICByZXR1cm4gcmVsTG9jYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGlzIGhlbHBlciBtZXRob2QsIGdpdmVuIHRoZSBwY1JlcGxhY2VGaWVsZCBv\nciBwY1Byb3ZpZGVGaWVsZAogICAgICogbWV0aG9kLCBhZGRzIHRoZSBieXRl\nY29kZSBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgJ3BsdXJhbCcgdmVyc2lvbgog\nICAgICogb2YgdGhlIG1ldGhvZCAtLSB0aGUgdmVyc2lvbiB0aGF0IHRha2Vz\nIGFuIGludFtdIG9mIGZpZWxkcyB0bwogICAgICogdG8gYWNjZXNzIHJhdGhl\nciB0aGFuIGEgc2luZ2xlIGZpZWxkLiBUaGUgbXVsdGlwbGUgZmllbGRzIHZl\ncnNpb24KICAgICAqIHNpbXBseSBsb29wcyB0aHJvdWdoIHRoZSBwcm92aWRl\nZCBpbmRleGVzIGFuZCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiBzaW5ndWxh\nciB2ZXJzaW9uIGZvciBlYWNoIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihCQ01ldGhvZCBz\naW5nbGUpIHsKICAgICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlG\naWVsZCIpLmVxdWFscyhzaW5nbGUuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8g\ncHVibGljIHZvaWQgPG1ldGhvZD5zIChpbnRbXSBmaWVsZHMpCiAgICAgICAg\nQ2xhc3NbXSBhcmdzID0gKGNvcHkpID8gbmV3IENsYXNzW117IE9iamVjdC5j\nbGFzcywgaW50W10uY2xhc3MgfQogICAgICAgICAgICA6IG5ldyBDbGFzc1td\neyBpbnRbXS5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKHNpbmdsZS5nZXROYW1lKCkgKyAicyIsCiAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBpbnQgZmllbGROdW1i\nZXJzID0gMDsKICAgICAgICBpbnQgaW5zdCA9IDA7CiAgICAgICAgaWYgKGNv\ncHkpIHsKICAgICAgICAgICAgZmllbGROdW1iZXJzID0gMTsKCiAgICAgICAg\nICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAg\nICAvLyBnZXQgdGhlIG1hbmFnZWQgaW5zdGFuY2UgaW50byB0aGUgbG9jYWwg\ndmFyaWFibGUgdGFibGUKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGlj\nKCkuc2V0TWV0aG9kKEltcGxIZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICAg\nICAgICAgImdldE1hbmFnZWRJbnN0YW5jZSIsIE9iamVjdC5jbGFzcywKICAg\nICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcyB9\nKTsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShf\nbWFuYWdlZFR5cGUpOwogICAgICAgICAgICAgICAgaW5zdCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9y\nZSgpLnNldExvY2FsKGluc3QpOwoKICAgICAgICAgICAgICAgIC8vIHRoZXJl\nIG1pZ2h0IGJlIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBjbGFzc2VzIG9m\nICd0aGlzJwogICAgICAgICAgICAgICAgLy8gdnMgJ290aGVyJyBpbiB0aGlz\nIGNvbnRleHQ7IHVzZSB0aGUgUEMgbWV0aG9kcyB0byBnZXQgdGhlIFNNCiAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAg\nICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qo\nSW1wbEhlbHBlci5jbGFzcywKICAgICAgICAgICAgICAgICAgICAidG9QZXJz\naXN0ZW5jZUNhcGFibGUiLCBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3Ms\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFz\ncywKICAgICAgICAgICAgICAgICAgICAicGNHZXRTdGF0ZU1hbmFnZXIiLCBT\ndGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgLy8gWFhYIG90aGVyID0gKFhYWCkgcGM7CiAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX3BjKTsKICAg\nICAgICAgICAgICAgIGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgp\nOwogICAgICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0\nKTsKCiAgICAgICAgICAgICAgICAvLyBhY2Nlc3MgdGhlIG90aGVyJ3Mgc20g\nZmllbGQgZGlyZWN0bHkKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChpbnN0KTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gaWYgKG90aGVyLnBjU3RhdGVNYW5hZ2VyICE9IHBjU3RhdGVN\nYW5hZ2VyKQogICAgICAgICAgICAvLwl0aHJvdyBuZXcgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uCgogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gaWZpbnMgPSBjb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAgIHRocm93\nRXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsK\nCiAgICAgICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxsKQog\nICAgICAgICAgICAvLyAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlv\nbgogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxTdGF0\nZUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLm5vcCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIGZvciAoaW50\nIGkgPSAwOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsK\nICAgICAgICBpbnQgaWR4ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGlkeCk7CiAgICAgICAg\nSnVtcEluc3RydWN0aW9uIHRlc3RpbnMgPSBjb2RlLmdvMigpOwoKICAgICAg\nICAvLyA8bWV0aG9kPiAoZmllbGRzW2ldKTsKICAgICAgICBJbnN0cnVjdGlv\nbiBib2R5aW5zID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgaWYgKGNvcHkpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nZmllbGROdW1iZXJzKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwo\naWR4KTsKICAgICAgICBjb2RlLmlhbG9hZCgpOwogICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChzaW5nbGUpOwoKICAgICAgICAvLyBp\nKys7CiAgICAgICAgY29kZS5paW5jKCkuc2V0SW5jcmVtZW50KDEpLnNldExv\nY2FsKGlkeCk7CgogICAgICAgIC8vIGkgPCBmaWVsZHMubGVuZ3RoCiAgICAg\nICAgdGVzdGlucy5zZXRUYXJnZXQoY29kZS5pbG9hZCgpLnNldExvY2FsKGlk\neCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJl\ncnMpOwogICAgICAgIGNvZGUuYXJyYXlsZW5ndGgoKTsKICAgICAgICBjb2Rl\nLmlmaWNtcGx0KCkuc2V0VGFyZ2V0KGJvZHlpbnMpOwogICAgICAgIGNvZGUu\ndnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgdGhlICdzdG9jaycgbWV0aG9kcyB0byB0aGUg\nYnl0ZWNvZGU7IHRoZXNlIGluY2x1ZGUgbWV0aG9kcwogICAgICogbGlrZSB7\nQGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjRmV0Y2hPYmplY3RJZH0KICAg\nICAqIGFuZCB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjSXNUcmFuc2Fj\ndGlvbmFsfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN0b2NrTWV0\naG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gcGNHZXRHZW5lcmljQ29u\ndGV4dAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0\naG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIFNNVFlQRSwgImdldCIgKyBDT05URVhUTkFNRSwgKENsYXNz\nW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjRmV0\nY2hPYmplY3RJZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5h\nZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgIFNNVFlQRSwgImZldGNoT2JqZWN0SWQiLCAoQ2xh\nc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJ\nc0RlbGV0ZWQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdl\nck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAg\nICAgICAgICAgICAgICBTTVRZUEUsICJpc0RlbGV0ZWQiLCAoQ2xhc3NbXSkg\nbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RpcnR5\nCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2Qo\nCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAg\nICAgICAgU01UWVBFLCAiaXNEaXJ0eSIsIChDbGFzc1tdKSBudWxsKSksIHRy\ndWUpOwogICAgCiAgICAgICAgICAgIC8vIHBjSXNOZXcKICAgICAgICAgICAg\ndHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAg\nICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVk\nTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUs\nICJpc05ldyIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAg\nICAgICAgICAvLyBwY0lzUGVyc2lzdGVudAogICAgICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1l\ndGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RB\nY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzUGVy\nc2lzdGVudCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAg\nICAgICAgICAvLyBwY0lzVHJhbnNhY3Rpb25hbAogICAgICAgICAgICB0cmFu\nc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAg\nKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRo\nb2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlz\nVHJhbnNhY3Rpb25hbCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAg\nIAogICAgICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAgICAgICAgICAgIHRy\nYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAg\nICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1l\ndGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAi\nc2VyaWFsaXppbmciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAK\nICAgICAgICAgICAgLy8gcGNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhv\nZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImRpcnR5Iiwg\nbmV3IENsYXNzW117IFN0cmluZy5jbGFzcyB9KSksIGZhbHNlKTsKICAgIAog\nICAgICAgICAgICAvLyBwY0dldFN0YXRlTWFuYWdlcgogICAgICAgICAgICBC\nQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFN0\nYXRlTWFuYWdlciIsCiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXIuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFN0YXRlTWFuYWdlci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUp\nIHsKICAgICAgICAgICAgIHRocm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24p\nIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBhIHN0b2NrIG1ldGhvZCB0\nbyB0aGUgYnl0ZWNvZGUuIEVhY2gKICAgICAqIHN0b2NrIG1ldGhvZCBzaW1w\nbHkgZGVsZWdhdGVzIHRvIGEgY29ycmVzcG9uZGluZyBTdGF0ZU1hbmFnZXIg\nbWV0aG9kLgogICAgICogR2l2ZW4gdGhlIFN0YXRlTWFuYWdlciBtZXRob2Qs\nIHRoZW4sIHRoaXMgZnVuY3Rpb24gdHJhbnNsYXRlcyBpdCBpbnRvCiAgICAg\nKiB0aGUgd3JhcHBlciBtZXRob2QgdGhhdCBzaG91bGQgYmUgYWRkZWQgdG8g\ndGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNs\nYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChNZXRob2QgbSwKICAgICAgICBi\nb29sZWFuIGlzRGlydHlDaGVja01ldGhvZCkgewogICAgICAgIC8vIGZvcm0g\ndGhlIG5hbWUgb2YgdGhlIG1ldGhvZCBieSBwcmVwZW5kaW5nICdwYycgdG8g\ndGhlIHNtIG1ldGhvZAogICAgICAgIFN0cmluZyBuYW1lID0gUFJFICsgU3Ry\naW5nVXRpbHMuY2FwaXRhbGl6ZShtLmdldE5hbWUoKSk7CiAgICAgICAgQ2xh\nc3NbXSBwYXJhbXMgPSBtLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAg\nQ2xhc3MgcmV0dXJuVHlwZSA9IG0uZ2V0UmV0dXJuVHlwZSgpOwoKICAgICAg\nICAvLyBhZGQgdGhlIG1ldGhvZCB0byB0aGUgcGMKICAgICAgICBCQ01ldGhv\nZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChuYW1lLCByZXR1cm5UeXBl\nLCBwYXJhbXMpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVs\nbCkgcmV0dXJuIDxkZWZhdWx0PjsKICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\naW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBpZiAocmV0dXJuVHlw\nZS5lcXVhbHMoYm9vbGVhbi5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgZWxzZSBpZiAoIXJl\ndHVyblR5cGUuZXF1YWxzKHZvaWQuY2xhc3MpKQogICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUueHJldHVybigp\nLnNldFR5cGUocmV0dXJuVHlwZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMg\ndGhlIGRpcnR5LWNoZWNrIG1ldGhvZCBhbmQgd2UncmUgc3ViY2xhc3Npbmcg\nYnV0IG5vdAogICAgICAgIC8vIHJlZGVmaW5pbmcsIGhvb2sgaW50byBQQ0hl\nbHBlciB0byBkbyB0aGUgZGlydHkgY2hlY2sKICAgICAgICBpZiAoaXNEaXJ0\neUNoZWNrTWV0aG9kICYmICFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAg\nIC8vIFJlZGVmaW5pdGlvbkhlbHBlci5kaXJ0eUNoZWNrKHNtKTsKICAgICAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBm\nb3IgdGhlIHJldHVybiBzdGF0ZW1lbnQgYmVsb3cKICAgICAgICAgICAgY29k\nZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVy\nLmNsYXNzLCAKICAgICAgICAgICAgICAgICJkaXJ0eUNoZWNrIiwgdm9pZC5j\nbGFzcywgbmV3IENsYXNzW10geyBTTVRZUEUgfSk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIH0KICAgICAgICAK\nICAgICAgICAvLyByZXR1cm4gcGNTdGF0ZU1hbmFnZXIuPG1ldGhvZD4gKDxh\ncmdzPik7CiAgICAgICAgLy8gbWFuYWdlZCBpbnN0YW5jZSBsb2FkZWQgYWJv\ndmUgaW4gaWYtZWxzZSBibG9jawogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgcGFyYW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2Fk\nKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QobSk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlw\nZShyZXR1cm5UeXBlKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VD\nYXBhYmxlI3BjR2V0VmVyc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2Qo\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJHZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxs\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRW\nZXJzaW9uRmllbGQoKTsKCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBu\ndWxsKQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAv\nLyByZXR1cm4gbnVsbDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8g\ncmV0dXJuIDx2ZXJzaW9uRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFw\ncGVyID0gdG9QcmltaXRpdmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAg\nICAgICAgIGlmICh3cmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJl\nZFR5cGUoKSkgewogICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZSh3cmFwcGVyKTsKICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgdmVyc2lvbkZpZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIg\nIT0gdmVyc2lvbkZpZWxkLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIs\nICI8aW5pdD4iLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyB2ZXJzaW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7\nCiAgICAgICAgfQogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAv\nLyByZXR1cm4gcGNTdGF0ZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAg\nICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSkpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChTTVRZUEUsICJnZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAg\nICAgICAgICBudWxsKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHZlcnNpb24gZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFw\ncGVyLCBvciBudWxsIGlmCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBu\nb3QgcHJpbWl0aXZlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJp\nbWl0aXZlV3JhcHBlcihGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAg\nIHJldHVybiBDaGFyYWN0ZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUu\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAg\nICAgICAgICAgICAgcmV0dXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50\nZWdlci5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoK\nICAgICAgICAgICAgICAgIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBTaG9ydC5jbGFzczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\ndGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyfQogICAgICogbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRo\nb2QoKSB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyIChTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1h\nbmFnZXIiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\nU01UWVBFIH0pOwogICAgICAgIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1\nZSk7CiAgICAgICAgbWV0aG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhj\nZXB0aW9uKFNlY3VyaXR5RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYg\nKHBjU3RhdGVNYW5hZ2VyICE9IG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1h\nbmFnZXIgPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNt\nKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwo\nKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUu\naW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VT\ndGF0ZU1hbmFnZXIiLAogICAgICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1td\neyBTTVRZUEUgfSk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAg\nICAvLyBTZWN1cml0eU1hbmFnZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5\nTWFuYWdlciAoKTsKICAgICAgICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAg\nICAgLy8JCXNlYy5jaGVja1Blcm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NU\nQVRFX01BTkFHRVIpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAg\nICAgICJnZXRTZWN1cml0eU1hbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xh\nc3MsIG51bGwpKTsKCiAgICAgICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsK\nICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVy\nc2lzdGVuY2VDYXBhYmxlIG1ldGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0\naW9uCiAgICAgKiBpZGVudGl0eSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBs\nZW1lbnRhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09w\nQXBwbGljYXRpb25JZGVudGl0eU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVi\nbGljIHZvaWQgcGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRG\naWVsZFN1cHBsaWVyIGZzLAogICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdeyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlL\nZXlGaWVsZHNUb09iamVjdElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2\nb2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVs\nZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVs\nZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXXsgT0lERkNUWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7Cgog\nICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmpl\nY3RJZCAoT2JqZWN0IG9pZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xh\nc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdP\nYmplY3RJZEluc3RhbmNlICgpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nTnVsbCgpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2Jq\nZWN0SWRJbnN0YW5jZSAoT2JqZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIs\nCiAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW117IE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZp\nZWxkc1RvT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNz\nZXMgdXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRDb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChi\nb29sZWFuIGZpZWxkTWFuYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlL\nZXlGaWVsZHNUb09iamVjdElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMs\nCiAgICAgICAgLy8JT2JqZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdz\nID0gKGZpZWxkTWFuYWdlcikgPwogICAgICAgICAgICBuZXcgU3RyaW5nW117\nIE9JREZTVFlQRS5nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkg\nfQogICAgICAgICAgICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdl\ndE5hbWUoKSB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gc2luZ2xlIGZpZWxkIGlkZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0\naW9uCiAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsK\nICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSU5URVJORVhDRVAp\nOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAg\nIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAg\nICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElk\nIiwgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gT2JqZWN0IGlkID0gb2lkOwogICAgICAgIGlmIChmaWVsZE1h\nbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKCiAgICAgICAgaWYgKF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVk\nKCkpIHsKICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdl\ndElkICgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\nT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAg\nICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gPG9pZCB0eXBlPiBpZCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAg\nICAgICAgaW50IGlkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwog\nICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAv\nLyBpbnQgaW5oZXJpdGVkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50OwogICAg\nICAgIGludCBpbmhlcml0ZWQgPSAwOwogICAgICAgIGlmIChmaWVsZE1hbmFn\nZXIpIHsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJ\nTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICBpbmhlcml0ZWQgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLmlz\ndG9yZSgpLnNldExvY2FsKGluaGVyaXRlZCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBpZC48ZmllbGQ+ID0gZnMuZmV0Y2g8dHlwZT5GaWVsZCAoPGluZGV4\nPik7IG9yLi4uCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IHBjLjxmaWVsZD47\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJj\nbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0\nYS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIENsYXNzIHR5cGU7CiAg\nICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAg\nICAgTWV0aG9kIHNldHRlcjsKICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0u\nZ2V0TmFtZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmpl\nY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoX21ldGEuZ2V0QWNj\nZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAg\nICAgICAgICAgICAgICBzZXR0ZXIgPSBudWxsOwogICAgICAgICAgICAgICAg\nZmllbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0\ncnVlKTsKICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQ\ndWJsaWMoZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAgICAg\naWYgKHJlZmxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNz\nY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kKFJlZmxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAg\nICAiZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xh\nc3MuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFz\ncywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDsK\nICAgICAgICAgICAgICAgIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRl\ncihvaWRUeXBlLCBuYW1lLCB0eXBlLCB0cnVlKTsKICAgICAgICAgICAgICAg\nIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMoc2V0dGVyLmdldE1vZGlm\naWVycygpKTsKICAgICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mo\nb2lkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xh\nc3Njb25zdGFudCgpLnNldENsYXNzKHR5cGUpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZs\nZWN0aW9uLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRT\nZXR0ZXIiLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgQ2xh\nc3MuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIp\nIHsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpbmhlcml0\nZWQpOwogICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZAogICAgICAg\nICAgICAgICAgICAgIChnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKHR5cGUpKTsK\nCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgdHlwZSBvZiB0aGlzIGZpZWxk\nIG1ldGEgZGF0YSBpcwogICAgICAgICAgICAgICAgLy8gbm9uLXByaW1pdGl2\nZSBhbmQgbm9uLXN0cmluZywgYmUgc3VyZSB0byBjYXN0CiAgICAgICAgICAg\nICAgICAvLyB0byB0aGUgYXBwcm9wcmlhdGUgdHlwZS4KICAgICAgICAgICAg\nICAgIGlmICghcmVmbGVjdCAmJiAhdHlwZS5pc1ByaW1pdGl2ZSgpCiAgICAg\nICAgICAgICAgICAgICAgJiYgIXR5cGUuZ2V0TmFtZSgpLmVxdWFscyhTdHJp\nbmcuY2xhc3MuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAgICAgLy8gZ2V0IGlk\nL3BrIGZyb20gcGMgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGlmIChmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAg\nICAgICAgICAgICAgICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1\nZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChyZWZsZWN0ICYmIGZpZWxkICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rp\nb24uY2xhc3MsICJzZXQiLCAKICAgICAgICAgICAgICAgICAgICB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgRmllbGQuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAgICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0\neXBlIDogT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHJlZmxlY3QpIHsgCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAg\nICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmpl\nY3QuY2xhc3MsIE1ldGhvZC5jbGFzcywKICAgICAgICAgICAgICAgICAgICAo\ndHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChzZXR0ZXIpOwogICAgICAgIH0KICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgY29kZSB0byBleHRyYWN0IHRoZSBpZCBv\nZiB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgcmVsYXRpb24gZmllbGQgZm9yCiAg\nICAgKiBzZXR0aW5nIGludG8gYW4gb2JqZWN0aWQgaW5zdGFuY2UuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZh\nbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgcGspIHsKICAgICAg\nICAvLyBpZiAodmFsICE9IG51bGwpIAogICAgICAgIC8vICB2YWwgPSAoKFBl\ncnNpc3RlbmNlQ2FwYWJsZSkgdmFsKS5wY0ZldGNoT2JqZWN0SWQoKTsKICAg\nICAgICBpbnQgcGMgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmbnVsbDEgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChwYyk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7IAogICAgICAgIGNvZGUu\naW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJs\nZS5jbGFzcywKICAgICAgICAgICAgUFJFICsgIkZldGNoT2JqZWN0SWQiLCBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGludCBvaWQgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZudWxsMiA9IGNvZGUuaWZu\ndWxsKCk7IAoKICAgICAgICAvLyBmb3IgZGF0YXN0b3JlIC8gc2luZ2xlLWZp\nZWxkIGlkZW50aXR5OgogICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkKICAg\nICAgICAvLyAgIHZhbCA9ICgoT3BlbkpQQUlkKSB2YWwpLmdldElkKCk7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBwa21ldGEgPSBway5nZXREZWNsYXJlZFR5\ncGVNZXRhRGF0YSgpOwogICAgICAgIGludCBwa2NvZGUgPSBway5nZXRPYmpl\nY3RJZEZpZWxkVHlwZUNvZGUoKTsKICAgICAgICBDbGFzcyBwa3R5cGUgPSBw\nay5nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgIGlmIChwa21ldGEu\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RP\nUkUgCiAgICAgICAgICAgICYmIHBrY29kZSA9PSBKYXZhVHlwZXMuTE9ORykg\newogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKElkLmNsYXNzKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKElk\nLmNsYXNzLCAiZ2V0SWQiLCAKICAgICAgICAgICAgICAgIGxvbmcuY2xhc3Ms\nIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldElkZW50aXR5\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKSB7CiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgIH0g\nZWxzZSBpZiAocGttZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAg\nICAgICAgc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoQnl0ZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVh\nawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQnl0\nZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoQnl0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBieXRlLmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5CWVRFX09C\nSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKEJ5dGUuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2J5\ndGUuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAg\nICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQ2hhcmFjdGVyLmNsYXNz\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAg\nICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShDaGFySWQuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDaGFySWQu\nY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUg\nPT0gSmF2YVR5cGVzLkNIQVJfT0JKKQogICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoQ2hhcmFjdGVyLmNs\nYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7Y2hhci5jbGFzc30pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKERvdWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVh\nawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShE\nb3VibGVJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKERvdWJsZUlkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgICAgICAgICBkb3VibGUuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVz\nLkRPVUJMRV9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChEb3VibGUuY2xhc3MsICI8aW5pdD4i\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5l\ndyBDbGFzc1tde2RvdWJsZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRf\nT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nRmxvYXQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShGbG9hdElkLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoRmxvYXRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgZmxvYXQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkZMT0FUX09CSikKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKEZsb2F0LmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtmbG9hdC5jbGFz\nc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFuZXcoKS5zZXRUeXBlKEludGVnZXIuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\nb2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoSW50SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChJbnRJZC5jbGFzcywgImdldElk\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5J\nTlRfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoSW50ZWdlci5jbGFzcywgIjxpbml0PiIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7aW50LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKExvbmcuY2xh\nc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAg\nICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKExvbmdJZC5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKExvbmdJ\nZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9u\nZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29k\nZSA9PSBKYXZhVHlwZXMuTE9OR19PQkopCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChMb25nLmNsYXNz\nLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdIHtsb25nLmNsYXNzfSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCku\nc2V0VHlwZShTaG9ydC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNob3J0SWQu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChTaG9ydElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAg\nICAgICAgICAgICAgICAgICBzaG9ydC5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuU0hPUlRfT0JK\nKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoU2hvcnQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde3No\nb3J0LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRlSWQuY2xh\nc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChEYXRlSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShTdHJpbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZ0lkLmNs\nYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSBpZiAocGttZXRhLmdldE9iamVjdElkVHlwZSgpICE9IG51\nbGwpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7\nCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwa3R5cGUp\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gY29k\nZS5nbzIoKTsKCiAgICAgICAgLy8gaWYgKHZhbCA9PSBudWxsKQogICAgICAg\nIC8vICAgdmFsID0gPGRlZmF1bHQ+OwogICAgICAgIEluc3RydWN0aW9uIGRl\nZjsKICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgZGVmID0gY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAg\nICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChi\neXRlKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgZGVmID0gY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKChjaGFyKSAwKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6\nCiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoMEQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgZGVmID0gY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBk\nZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKHNob3J0KSAwKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsK\nICAgICAgICB9CiAgICAgICAgaWZudWxsMS5zZXRUYXJnZXQoZGVmKTsKICAg\nICAgICBpZm51bGwyLnNldFRhcmdldChkZWYpOwogICAgICAgIGdvMi5zZXRU\nYXJnZXQoY29kZS5ub3AoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHRoZSA8Y29kZT5wY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQ8L2NvZGU+\nIG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRpb24g\naWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5S2V5\nRmllbGRzRnJvbU9iamVjdElkTWV0aG9kKGJvb2xlYW4gZmllbGRNYW5hZ2Vy\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJ\nZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVj\ndCBvaWQpCiAgICAgICAgU3RyaW5nW10gYXJncyA9IChmaWVsZE1hbmFnZXIp\nIAogICAgICAgICAgICA/ICBuZXcgU3RyaW5nW117IE9JREZDVFlQRS5nZXRO\nYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6\nIG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9p\nZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBjYWxsIHN1cGVy\nY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFz\ncygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShpKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5\ncGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBQUkUgKyAiQ29w\neUtleUZpZWxkc0Zyb21PYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgp\nLCBhcmdzKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaWVsZE1hbmFnZXIp\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9t\nZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8g\nb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgpOwogICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0\nSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9pZCB0eXBlPiBj\nYXN0ID0gKDxvaWQgdHlwZT4pIG9pZDsKICAgICAgICBpbnQgaWQgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIENsYXNzIG9pZFR5cGUg\nPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5hc3RvcmUo\nKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8vIGZzLnN0b3JlPHR5cGU+Rmll\nbGQgKDxpbmRleD4sIGlkLjxmaWVsZD4pOyBvci4uLgogICAgICAgIC8vIHRo\naXMuPGZpZWxkPiA9IGlkLjxmaWVsZD4KICAgICAgICAvLyBvciBmb3Igc2lu\nZ2xlIGZpZWxkIGlkZW50aXR5OiBpZC5nZXRJZCAoKQogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRh\nLmdldEZpZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBDbGFzcyB0\neXBlOwogICAgICAgIENsYXNzIHVud3JhcHBlZDsKICAgICAgICBGaWVsZCBm\naWVsZDsKICAgICAgICBNZXRob2QgZ2V0dGVyOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIG5hbWUgPSBmbWRzW2ldLmdldE5hbWUo\nKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVs\nZFR5cGUoKTsKICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFnZXIgCiAgICAg\nICAgICAgICAgICAmJiBmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9\nPSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAgICAgICAgIC8vIHNtLmdldFBD\nUHJpbWFyeUtleShvaWQsIGkgKyBwY0luaGVyaXRlZEZpZWxkQ291bnQpOyAK\nICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8gbGVhdmUgb3Jp\nZyBvbiBzdGFjayB0byBzZXQgdmFsdWUgaW50bwogICAgICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50\nLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU3Rh\ndGVNYW5hZ2VyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAiZ2V0UENQ\ncmltYXJ5S2V5IiwgT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNzIH0pOwog\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICB9IGVsc2UgeyAK\nICAgICAgICAgICAgICAgIHVud3JhcHBlZCA9IChmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIAogICAgICAgICAgICAg\nICAgICAgID8gdHlwZSA6IHVud3JhcFNpbmdsZUZpZWxkSWRlbnRpdHkoZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShp\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nCiAgICAgICAgICAgICAgICBpZiAodW53cmFwcGVkICE9IHR5cGUpIHsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQp\nOwogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2lkVHlwZSA9PSBPYmpl\nY3RJZC5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgImdldElkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2VyICYm\nIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo\nb2lkVHlwZSA9PSBEYXRlSWQuY2xhc3MpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUs\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRlLmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVs\nZE1hbmFnZXIgJiYgdHlwZSAhPSBEYXRlLmNsYXNzKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHVud3JhcHBlZCwgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlwZSkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZCh0eXBlLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgdW53cmFwcGVk\nIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX0ZJRUxEKXsKICAgICAgICAgICAgICAgICAgICBmaWVsZCA9\nIFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUsIHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1B1YmxpYyhmaWVs\nZC5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZmxl\nY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgp\nLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10g\neyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBT\ndHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1l\ndGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIGdldHRlciA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRUeXBlLCBuYW1l\nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNQ\ndWJsaWMoZ2V0dGVyLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldHRl\ncik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlv\nbi5maW5kR2V0dGVyKC4uLikpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAiZmluZEdldHRlciIsIE1ldGhv\nZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChn\nZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIE1ldGhvZC5jbGFzcykp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRp\ndmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChn\nZXRGaWVsZENvbnN1bWVyTWV0aG9kKHR5cGUpKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWRzW2ldKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGlmIHRoZSBjbGFzcyB1c2VzIHRoZSBDbGFzcy9TdHJpbmcg\nY29uc3RydWN0b3IKICAgICAqIGluc3RlYWQgb2YganVzdCBTdHJpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzQ2xhc3NTdHJpbmdJZENv\nbnN0cnVjdG9yKCkgewogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5\ncGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAg\nICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgaWYgKF9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKF9tZXRh\nLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBCb29s\nZWFuLlRSVUU7CiAgICAgICAgfQoKICAgICAgICBDbGFzcyBvaWRUeXBlID0g\nX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXXsgQ2xh\nc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBvaWRUeXBl\nLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7\nCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGdpdmVuIGZp\nZWxkIGlzIGEgd3JhcHBlci10eXBlIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBw\ncmltYXJ5IGtleSwKICAgICAqIHJldHVybiBpdHMgY29ycmVzcG9uZGluZyBw\ncmltaXRpdmUgY2xhc3MuIEVsc2UgcmV0dXJuIHRoZSBmaWVsZCB0eXBlLgog\nICAgICovCiAgICBwcml2YXRlIENsYXNzIHVud3JhcFNpbmdsZUZpZWxkSWRl\nbnRpdHkoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoIWZtZC5n\nZXREZWZpbmluZ01ldGFEYXRhKCkuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKCiAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGJ5dGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXIuY2xh\nc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAg\nICAgICAgICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGxv\nbmcuY2xhc3M7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGdldHRlciBt\nZXRob2Qgb2YgdGhlIHtAbGluayBSZWZsZWN0aW9ufSBoZWxwZXIgZm9yCiAg\nICAgKiBhIGZpZWxkIG9yIGdldHRlciBtZXRob2Qgb2YgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldFJlZmxlY3Rpb25H\nZXR0ZXJNZXRob2QoQ2xhc3MgdHlwZSwgQ2xhc3MgYXJnVHlwZSkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJp\nbmcgbmFtZSA9ICJnZXQiOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZl\nKCkpCiAgICAgICAgICAgIG5hbWUgKz0gU3RyaW5nVXRpbHMuY2FwaXRhbGl6\nZSh0eXBlLmdldE5hbWUoKSk7CiAgICAgICAgcmV0dXJuIFJlZmxlY3Rpb24u\nY2xhc3MuZ2V0TWV0aG9kKG5hbWUsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNs\nYXNzLCAKICAgICAgICAgICAgYXJnVHlwZSB9KTsgCiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhl\nIE9iamVjdElkRmllbGRTdXBwbGllciBmb3IKICAgICAqIGEgZmllbGQgb2Yg\ndGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdl\ndEZpZWxkU3VwcGxpZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0\nTWV0aG9kKE9JREZTVFlQRSwgdHlwZSwgImZldGNoIiwgdHJ1ZSwgZmFsc2Us\nIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJv\ncGVyIGZldGNoIG1ldGhvZCBvZiB0aGUgT2JqZWN0SWRGaWVsZENvbnN1bWVy\nIGZvcgogICAgICogYSBmaWVsZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0RmllbGRDb25zdW1lck1ldGhvZChD\nbGFzcyB0eXBlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2QoT0lERkNUWVBFLCB0eXBl\nLCAic3RvcmUiLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdGhlIHBjTmV3T2JqZWN0SWRJbnN0YW5jZSBtZXRo\nb2QgdG8gY2xhc3NlcyB1c2luZwogICAgICogYXBwbGljYXRpb24gaWRlbnRp\ndHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROZXdPYmplY3RJZElu\nc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2JqKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyBPYmplY3Qg\ncGNOZXdPYmplY3RJZEluc3RhbmNlICgpCiAgICAgICAgQ2xhc3NbXSBhcmdz\nID0gKG9iaikgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0gOiBudWxs\nOwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgQm9vbGVhbiB1c2VzQ2xzU3RyaW5n\nID0gdXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3RvcigpOwogICAgICAgIENs\nYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAg\nICBpZiAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gbnVsbCkgewogICAgICAg\nICAgICAvLyB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgu\nLi4pOwogICAgICAgICAgICBTdHJpbmcgbXNnID0gX2xvYy5nZXQoInN0ci1j\nb25zIiwgb2lkVHlwZSwKICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSkuZ2V0TWVzc2FnZSgpOwogICAgICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShtc2cpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nLmNsYXNzLAogICAgICAgICAgICAgICAgIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIGNv\nZGUuYXRocm93KCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlk\nZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewog\nICAgICAgICAgICAvLyBuZXcgT2JqZWN0SWQgKGNscywgb2lkKQogICAgICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gbmV3IDxvaWQgY2xhc3M+ICgpOwogICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSB8fCAob2Jq\nICYmIHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKSkKICAgICAgICAg\nICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0\nYSkpOwogICAgICAgIGlmIChvYmopIHsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICAgICAgaWYgKHVzZXND\nbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgYXJn\ncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzIH07\nCiAgICAgICAgICAgIGVsc2UgaWYgKHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVh\nbi5GQUxTRSkKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsg\nU3RyaW5nLmNsYXNzIH07CiAgICAgICAgfSBlbHNlIGlmIChfbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIC8vIG5ldyA8dHlwZT5J\nZGVudGl0eSAoWFhYLmNsYXNzLCA8cGs+KTsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgcGsgPSBfbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClbMF07\nCiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGsp\nOwogICAgICAgICAgICBpZiAocGsuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAgIGFkZEV4dHJhY3RPYmpl\nY3RJZEZpZWxkVmFsdWVDb2RlKGNvZGUsIHBrKTsKICAgICAgICAgICAgaWYg\nKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQog\nICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFz\ncywgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UgaWYgKF9tZXRh\nLmdldE9iamVjdElkVHlwZSgpID09IERhdGUuY2xhc3MpCiAgICAgICAgICAg\nICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBEYXRlLmNs\nYXNzIH07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFyZ3Mg\nPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIHBrLmdldE9iamVjdElkRmll\nbGRUeXBlKCkgfTsKICAgICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFz\ncywgYXJncyk7CiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChPYmplY3RJZC5j\nbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIGNvbW11bmljYXRpbmcgd2l0\naCB0aGUgU3RhdGVNYW5hZ2VyLCBtYW55IG1ldGhvZHMgYXJlIHVzZWQKICAg\nICAqIGRlcGVuZGluZyBvbiB0aGUgY2xhc3Mgb2Ygc3RhdGUgYmVpbmcgcGFz\nc2VkLiBUaGlzIG1ldGhvZCwKICAgICAqIGdpdmVuIHRoZSB0eXBlIG9mIGlu\nZm9ybWF0aW9uIGJlaW5nIHBhc3NlZCBhbmQgdGhlIHByZWZpeAogICAgICog\nKCdwcm92aWRlZCcsICdyZXBsYWNlJywgZXRjKSBvZiB0aGUgbWV0aG9kIHRv\nCiAgICAgKiBjYWxsLCByZXR1cm5zIHRoZSBTdGF0ZU1hbmFnZXIgbWV0aG9k\nIHRoYXQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKgogICAgICogQHBhcmFtIHR5\ncGUgdGhlIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAgICAgKiBAcGFy\nYW0gcHJlZml4IHRoZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0byBjYWxsOyBh\nbGwgbWV0aG9kcwogICAgICogZW5kIGluICdbc3RhdGUgdHlwZV1GaWVsZCc7\nIG9ubHkgdGhlIHByZWZpeCB2YXJpZXMKICAgICAqIEBwYXJhbSBnZXQgdHJ1\nZSBpZiByZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUKICAgICAqIFN0\nYXRlTWFuYWdlciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0aGUgU00KICAg\nICAqIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJyZW50IHN0YXRl\nIHZhbHVlIGlzIHBhc3NlZCB0bwogICAgICogdGhlIFN0YXRlTWFuYWdlciBh\ncyBhbiBleHRyYSBhcmd1bWVudAogICAgICovCiAgICBwcml2YXRlIE1ldGhv\nZCBnZXRTdGF0ZU1hbmFnZXJNZXRob2QoQ2xhc3MgdHlwZSwgU3RyaW5nIHBy\nZWZpeCwKICAgICAgICBib29sZWFuIGdldCwgYm9vbGVhbiBjdXJWYWx1ZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZ2V0TWV0aG9kKFNNVFlQRSwgdHlwZSwgcHJlZml4LCBnZXQs\nIHRydWUsIGN1clZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbWV0aG9kIG9mIHRoZSBnaXZlbiBvd25lciB0eXBlIG1hdGNoaW5n\nIHRoZSBnaXZlbiBjcml0ZXJpYS4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlw\nZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAgICAqIEBwYXJh\nbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRvIGNhbGw7IGFs\nbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBlXUZpZWxkJzsg\nb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFtIGdldCB0cnVl\nIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQogICAgICogb3du\nZXIsIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhlIG93bmVyCiAgICAgKiBA\ncGFyYW0gaGFzcGMgdHJ1ZSBpZiB0aGUgcGMgaXMgcGFzc2VkIGFzIGFuIGV4\ndHJhIGFyZ3VtZW50CiAgICAgKiBAcGFyYW0gY3VyVmFsdWUgdHJ1ZSBpZiB0\naGUgY3VycmVudCBzdGF0ZSB2YWx1ZSBpcyBwYXNzZWQgdG8KICAgICAqIHRo\nZSBvd25lciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICovCiAgICBwcml2\nYXRlIE1ldGhvZCBnZXRNZXRob2QoQ2xhc3Mgb3duZXIsIENsYXNzIHR5cGUs\nIFN0cmluZyBwcmVmaXgsCiAgICAgICAgYm9vbGVhbiBnZXQsIGJvb2xlYW4g\naGFzcGMsIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWxsIG1ldGhvZHMgZW5k\nIGluIFtmaWVsZCB0eXBlXUZpZWxkLCB3aGVyZSB0aGUgZmllbGQgdHlwZQog\nICAgICAgIC8vIGNhbiBiZSBhbnkgb2YgdGhlIHByaW1pdHZlIHR5cGVzIChi\ndXQgY2FwaXRhbGl6ZWQpLCAnU3RyaW5nJywKICAgICAgICAvLyBvciAnT2Jq\nZWN0JzsgZmlndXJlIG91dCB3aGF0IHR5cGUgdG8gdXNlCiAgICAgICAgU3Ry\naW5nIHR5cGVOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgaWYgKHR5\ncGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgdHlwZU5hbWUgPSB0eXBl\nTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoKQogICAgICAgICAg\nICAgICAgKyB0eXBlTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgZWxzZSBp\nZiAodHlwZS5lcXVhbHMoU3RyaW5nLmNsYXNzKSkKICAgICAgICAgICAgdHlw\nZU5hbWUgPSAiU3RyaW5nIjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\ndHlwZU5hbWUgPSAiT2JqZWN0IjsKICAgICAgICAgICAgdHlwZSA9IE9iamVj\ndC5jbGFzczsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBmaWVsZCBpbmRl\neCBpcyBhbHdheXMgcGFzc2VkIGFzIGFuIGFyZzsgdGhlIHBjIGluc3RhbmNl\nIGFuZAogICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlIG1heSBiZSBwYXNz\nZWQ7IGlmIHNldHRpbmcgdGhlIG5ldyB2YWx1ZSBpcwogICAgICAgIC8vIGFs\nc28gcGFzc2VkCiAgICAgICAgTGlzdCBwbGlzdCA9IG5ldyBBcnJheUxpc3Qo\nNCk7CiAgICAgICAgaWYgKGhhc3BjKQogICAgICAgICAgICBwbGlzdC5hZGQo\nUENUWVBFKTsKICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAgICAg\nICBpZiAoIWdldCB8fCBjdXJWYWx1ZSkKICAgICAgICAgICAgcGxpc3QuYWRk\nKHR5cGUpOwogICAgICAgIGlmICghZ2V0ICYmIGN1clZhbHVlKSB7CiAgICAg\nICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICAgICAgcGxpc3QuYWRk\nKGludC5jbGFzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyB1c2UgcmVmbGVj\ndGlvbiB0byByZXR1cm4gdGhlIHJpZ2h0IG1ldGhvZAogICAgICAgIFN0cmlu\nZyBuYW1lID0gcHJlZml4ICsgdHlwZU5hbWUgKyAiRmllbGQiOwogICAgICAg\nIENsYXNzW10gcGFyYW1zID0gKENsYXNzW10pIHBsaXN0LnRvQXJyYXkobmV3\nIENsYXNzW3BsaXN0LnNpemUoKV0pOwogICAgICAgIAogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKG93bmVyLCBuYW1lLCBwYXJhbXMp\nKTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9u\nIHBhZSkgewogICAgICAgICAgICAgdGhyb3cgKE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBjb2RlIG5l\nY2Vzc2FyeSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAgICAqIGV4Y2VwdGlvbiB0\neXBlLCBzYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1\nY3Rpb24gdGhyb3dFeGNlcHRpb24oQ29kZSBjb2RlLCBDbGFzcyB0eXBlKSB7\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29kZS5hbmV3KCkuc2V0VHlw\nZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hdGhyb3coKTsKICAgICAgICBy\nZXR1cm4gaW5zOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgUGVy\nc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZSB0byB0aGUgY2xhc3MgYmVpbmcK\nICAgICAqIGVuaGFuY2VkLCBhbmQgYWRkcyBhIGRlZmF1bHQgY29uc3RydWN0\nb3IgZm9yIHVzZSBieSBPcGVuSlBBCiAgICAgKiBpZiBpdCBpcyBub3QgYWxy\nZWFkeSBwcmVzZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5oYW5j\nZUNsYXNzKCkgewogICAgICAgIC8vIG1ha2UgdGhlIGNsYXNzIGltcGxlbWVu\ndCBQZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICBfcGMuZGVjbGFyZUludGVy\nZmFjZShQQ1RZUEUpOwoKICAgICAgICAvLyBhZGQgYSB2ZXJzaW9uIHN0YW1w\nCiAgICAgICAgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb25NZXRo\nb2QoKTsKCiAgICAgICAgLy8gZmluZCB0aGUgZGVmYXVsdCBjb25zdHJ1Y3Rv\ncgogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5nZXREZWNsYXJlZE1l\ndGhvZCgiPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKCiAgICAgICAgLy8g\nYSBkZWZhdWx0IGNvbnN0cnVjdG9yIGlzIHJlcXVpcmVkCiAgICAgICAgaWYg\nKG1ldGhvZCA9PSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBuYW1lID0g\nX3BjLmdldE5hbWUoKTsKICAgICAgICAgICAgaWYgKCFfZGVmQ29ucykKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJlbmhhbmNlLWRlZmF1bHRjb25zdCIsIG5hbWUpKTsKCiAgICAgICAgICAg\nIG1ldGhvZCA9IF9wYy5hZGREZWZhdWx0Q29uc3RydWN0b3IoKTsKICAgICAg\nICAgICAgU3RyaW5nIGFjY2VzczsKICAgICAgICAgICAgaWYgKF9tZXRhLmlz\nRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbGl6\nYWJsZSByZXF1aXJlcyB0aGF0IHRoZSBjb25zdHJ1Y3RvcgogICAgICAgICAg\nICAgICAgLy8gYmUgcHVibGljLCBzbyBtYWtlIHRoZSBhZGRlZCBjb25zdHJ1\nY3RvciBwdWJsaWMKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGlj\nKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAicHVibGljIjsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChfcGMuaXNGaW5hbCgpKSB7CiAgICAgICAgICAg\nICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGFj\nY2VzcyA9ICJwcml2YXRlIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAg\nICAgICBhY2Nlc3MgPSAicHJvdGVjdGVkIjsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoIShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRl\ncmZhY2UoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAg\nICAgJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBf\nbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2UtYWRkZGVmYXVsdGNvbnN0Iiwg\nbmFtZSwgYWNjZXNzKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUgZm9sbG93aW5nIGZpZWxkcyB0byB0aGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIGluc3RhbmNlOgogICAgICogPHVsPgogICAgICogPGxpPjxj\nb2RlPnByaXZhdGUgc3RhdGljIGludCBwY0luaGVyaXRlZEZpZWxkQ291bnQ8\nL2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBD\nbGFzcyBwY1BDU3VwZXJjbGFzczwvY29kZT4KICAgICAqIDwvbGk+CiAgICAg\nKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgU3RyaW5nW10gcGNGaWVsZE5h\nbWVzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0\naWMgQ2xhc3NbXSBwY0ZpZWxkVHlwZXM8L2NvZGU+PC9saT4KICAgICAqIDxs\naT48Y29kZT5wcml2YXRlIHN0YXRpYyBieXRlW10gcGNGaWVsZEZsYWdzPC9j\nb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJvdGVjdGVkIHRyYW5zaWVu\ndCBTdGF0ZU1hbmFnZXIgcGNTdGF0ZU1hbmFnZXI8L2NvZGU+CiAgICAgKiBp\nZiBubyBQZXJzaXN0ZW5jZUNhcGFibGUgc3VwZXJjbGFzcyBwcmVzZW50KTwv\nbGk+CiAgICAgKiA8L3VsPgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nRmllbGRzKCkgewogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoSU5IRVJJVCwg\naW50LmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xh\ncmVGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKS5z\nZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUg\nKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpLnNldFN0YXRpYyh0cnVl\nKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVsZEZsYWdz\nIiwgYnl0ZVtdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3Bj\nLmRlY2xhcmVGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpLnNldFN0YXRpYyh0\ncnVlKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09\nIG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBC\nQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAg\nICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGNsYXNzIGluaXRpYWxpemF0\naW9uIG1ldGhvZCAoY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2FyeSkKICAgICAq\nIHRvIGluaXRpYWxpemUgdGhlIHN0YXRpYyBmaWVsZHMgb2YgdGhlIFBlcnNp\nc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAgICAqIHRvIHJlZ2lzdGVy\nIGl0IHdpdGggdGhlIGltcGwgaGVscGVyLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKHRydWUpOwogICAgICAg\nIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAg\nICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5j\nbGFzcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAv\nLyBwY0luaGVyaXRlZEZpZWxkQ291bnQgPSA8c3VwZXJDbGFzcz4ucGNHZXRN\nYW5hZ2VkRmllbGRDb3VudCgpCiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAg\nICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZpZWxk\nQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAg\nICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50\nLmNsYXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGNQQ1N1\ncGVyY2xhc3MgPSA8c3VwZXJDbGFzcz47CiAgICAgICAgICAgIGNvZGUuY2xh\nc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5cGUoX21ldGEuCiAgICAgICAg\nICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSk7CiAgICAgICAg\nICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoU1VQRVIsIENsYXNzLmNs\nYXNzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBjRmllbGROYW1lcyA9IG5l\ndyBTdHJpbmdbXSB7ICI8bmFtZTE+IiwgIjxuYW1lMj4iLCAuLi4gfTsKICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldERlY2xhcmVk\nRmllbGRzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZt\nZHMubGVuZ3RoKTsKICAgICAgICBjb2RlLmFuZXdhcnJheSgpLnNldFR5cGUo\nU3RyaW5nLmNsYXNzKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kc1tpXS5nZXROYW1l\nKCkpOwogICAgICAgICAgICBjb2RlLmFhc3RvcmUoKTsKICAgICAgICB9CiAg\nICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGRO\nYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsKCiAgICAgICAgLy8gcGNGaWVsZFR5\ncGVzID0gbmV3IENsYXNzW10geyA8dHlwZTE+LmNsYXNzLCA8dHlwZTI+LmNs\nYXNzLCAuLi4gfTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlw\nZShDbGFzcy5jbGFzcyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAg\nICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGNvZGUuYWFzdG9yZSgp\nOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxk\nKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3NbXS5jbGFzcyk7CgogICAgICAg\nIC8vIHBjRmllbGRGbGFncyA9IG5ldyBieXRlW10geyA8ZmxhZzE+LCA8Zmxh\nZzI+LCAuLi4gfTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUubmV3YXJyYXkoKS5zZXRUeXBl\nKGJ5dGUuY2xhc3MpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShnZXRGaWVsZEZsYWcoZm1k\nc1tpXSkpOwogICAgICAgICAgICBjb2RlLmJhc3RvcmUoKTsKICAgICAgICB9\nCiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChQUkUgKyAiRmll\nbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7CgogICAgICAgIC8vIFBDUmVnaXN0\ncnkucmVnaXN0ZXIgKGNscywKICAgICAgICAvLwlwY0ZpZWxkTmFtZXMsIHBj\nRmllbGRUeXBlcywgcGNGaWVsZEZsYWdzLAogICAgICAgIC8vICBwY1BDU3Vw\nZXJjbGFzcywgYWxpYXMsIG5ldyBYWFggKCkpOwogICAgICAgIGNvZGUuY2xh\nc3Njb25zdGFudCgpLnNldENsYXNzKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGROYW1lcyIs\nIFN0cmluZ1tdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3NbXS5jbGFzcyk7CiAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGRG\nbGFncyIsIGJ5dGVbXS5jbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIAogICAg\nICAgIGlmIChfbWV0YS5pc01hcHBlZCgpKQogICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoX21ldGEuZ2V0VHlwZUFsaWFzKCkpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwo\nKTsKCiAgICAgICAgaWYgKF9wYy5pc0Fic3RyYWN0KCkpCiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAg\nICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKEhFTFBFUlRZUEUsICJyZWdpc3RlciIsIHZvaWQuY2xhc3MsCiAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nW10uY2xhc3Ms\nIENsYXNzW10uY2xhc3MsCiAgICAgICAgICAgICAgICBieXRlW10uY2xhc3Ms\nIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIFBDVFlQRSB9KTsKCiAgICAg\nICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmbGFn\nIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGJ5dGUgZ2V0RmllbGRGbGFnKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0\nYS5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAg\nICBieXRlIGZsYWdzID0gMDsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVk\nVHlwZSgpLmlzUHJpbWl0aXZlKCkKICAgICAgICAgICAgfHwgU2VyaWFsaXph\nYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oZm1kLmdldERlY2xhcmVkVHlw\nZSgpKSkKICAgICAgICAgICAgZmxhZ3MgPSBQZXJzaXN0ZW5jZUNhcGFibGUu\nU0VSSUFMSVpBQkxFOwoKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQo\nKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9UUkFOU0FDVElPTkFMKQogICAg\nICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfV1JJ\nVEU7CiAgICAgICAgZWxzZSBpZiAoIWZtZC5pc1ByaW1hcnlLZXkoKSAmJiAh\nZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBmbGFn\ncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfV1JJVEUKICAgICAgICAg\nICAgICAgIHwgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JFQUQ7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFi\nbGUuTUVESUFURV9XUklURQogICAgICAgICAgICAgICAgfCBQZXJzaXN0ZW5j\nZUNhcGFibGUuTUVESUFURV9SRUFEOwogICAgICAgIHJldHVybiBmbGFnczsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGNvZGUgdG8gcHJvcGVy\nbHkgaGFuZGxlIFBlcnNpc3RlbmNlQ2FwYWJsZSBzZXJpYWxpemF0aW9uCiAg\nICAgKiB0byB0aGUgYnl0ZWNvZGUuIFRoaXMgaW5jbHVkZXMgY3JlYXRpbmcg\nYW5kIGluaXRpYWxpemluZyB0aGUKICAgICAqIHN0YXRpYyA8Y29kZT5zZXJp\nYWxWZXJzaW9uVUlEPC9jb2RlPiBjb25zdGFudCBpZiBub3QgYWxyZWFkeSBk\nZWZpbmVkLAogICAgICogYXMgd2VsbCBhcyBjcmVhdGluZyBhIGN1c3RvbSA8\nY29kZT53cml0ZU9iamVjdDwvY29kZT4gbWV0aG9kIGlmIHRoZQogICAgICog\nY2xhc3MgaXMgU2VyaWFsaXphYmxlIGFuZCBkb2VzIG5vdCBkZWZpbmUgdGhl\nbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNlcmlhbGl6YXRpb25D\nb2RlKCkgewogICAgICAgIGlmIChleHRlcm5hbGl6ZURldGFjaGVkKCkKICAg\nICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAg\nICAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKAogICAgICAgICAgICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKSkKICAgICAgICAgICAgICAgIGFkZFN1YmNsYXNzU2VyaWFsaXphdGlv\nbkNvZGUoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgbm90IGFscmVhZHkgcHJlc2VudCwgYWRkIGEgc2VyaWFsVmVy\nc2lvblVJRCBmaWVsZDsgaWYgdGhlIGluc3RhbmNlCiAgICAgICAgLy8gaXMg\nZGV0YWNoYWJsZSBhbmQgdXNlcyBkZXRhY2hlZCBzdGF0ZSB3aXRob3V0IGEg\nZGVjbGFyZWQgZmllbGQsCiAgICAgICAgLy8gY2FuJ3QgYWRkIGEgc2VyaWFs\nIHZlcnNpb24gVUlEIGJlY2F1c2Ugd2UnbGwgYmUgYWRkaW5nIGV4dHJhIGZp\nZWxkcwogICAgICAgIC8vIHRvIHRoZSBlbmhhbmNlZCB2ZXJzaW9uCiAgICAg\nICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKCJzZXJp\nYWxWZXJzaW9uVUlEIik7CiAgICAgICAgaWYgKGZpZWxkID09IG51bGwpIHsK\nICAgICAgICAgICAgTG9uZyB1aWQgPSBudWxsOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgdWlkID0gTnVtYmVycy52YWx1ZU9mKE9iamVj\ndFN0cmVhbUNsYXNzLmxvb2t1cAogICAgICAgICAgICAgICAgICAgIChfbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpLmdldFNlcmlhbFZlcnNpb25VSUQoKSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAg\nICAgICAgICAvLyBsYXN0LWNoYW5jZSBjYXRjaCBmb3IgYnVnICMyODMgKHdo\naWNoIGNhbiBoYXBwZW4KICAgICAgICAgICAgICAgIC8vIGluIGEgdmFyaWV0\neSBvZiBDbGFzc0xvYWRpbmcgZW52aXJvbm1lbnRzKQogICAgICAgICAgICAg\nICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLXVpZC1hY2Nlc3MiLCBf\nbWV0YSksIHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB3\nZSBjb3VsZG4ndCBhY2Nlc3MgdGhlIHNlcmlhbFZlcnNpb25VSUQsIHdlIHdp\nbGwgaGF2ZSB0bwogICAgICAgICAgICAvLyBza2lwIHRoZSBvdmVycmlkZSBv\nZiB0aGF0IGZpZWxkIGFuZCBub3QgYmUgc2VyaWFsaXphdGlvbgogICAgICAg\nICAgICAvLyBjb21wYXRpYmxlIHdpdGggbm9uLWVuaGFuY2VkIGNsYXNzZXMK\nICAgICAgICAgICAgaWYgKHVpZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQoInNlcmlhbFZlcnNpb25VSUQi\nLCBsb25nLmNsYXNzKTsKICAgICAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2\nYXRlKCk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRTdGF0aWModHJ1ZSk7\nCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRGaW5hbCh0cnVlKTsKCiAgICAg\nICAgICAgICAgICBDb2RlIGNvZGUgPSBnZXRPckNyZWF0ZUNsYXNzSW5pdENv\nZGUoZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgp\nOwogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHVp\nZC5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRp\nYygpLnNldEZpZWxkKGZpZWxkKTsKCiAgICAgICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIGFkZCB3cml0ZSBvYmplY3QgbWV0aG9kCiAgICAgICAgQkNN\nZXRob2Qgd3JpdGUgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIndyaXRlT2Jq\nZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0\ncmVhbS5jbGFzcyB9KTsKICAgICAgICBib29sZWFuIGZ1bGwgPSB3cml0ZSA9\nPSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7CiAgICAgICAgICAgIC8vIHBy\naXZhdGUgdm9pZCB3cml0ZU9iamVjdCAoT2JqZWN0T3V0cHV0U3RyZWFtIG91\ndCkKICAgICAgICAgICAgd3JpdGUgPSBfcGMuZGVjbGFyZU1ldGhvZCgid3Jp\ndGVPYmplY3QiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENs\nYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICAg\nICAgd3JpdGUuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oSU9F\neGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICB3cml0ZS5tYWtlUHJpdmF0\nZSgpOwogICAgICAgIH0KICAgICAgICBtb2RpZnlXcml0ZU9iamVjdE1ldGhv\nZCh3cml0ZSwgZnVsbCk7CgogICAgICAgIC8vIGFuZCByZWFkIG9iamVjdAog\nICAgICAgIEJDTWV0aG9kIHJlYWQgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2Qo\nInJlYWRPYmplY3QiLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0\nSW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAgICAgZnVsbCA9IHJlYWQgPT0g\nbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBwcml2\nYXRlIHZvaWQgcmVhZE9iamVjdCAoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAg\nICAgICAgICAgIHJlYWQgPSBfcGMuZGVjbGFyZU1ldGhvZCgicmVhZE9iamVj\ndCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsg\nT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAgICAgICAgIHJlYWQu\nZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24u\nY2xhc3MpOwogICAgICAgICAgICByZWFkLmdldEV4Y2VwdGlvbnModHJ1ZSku\nYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoQ2xhc3NOb3RGb3VuZEV4\nY2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHJlYWQubWFrZVByaXZhdGUo\nKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5UmVhZE9iamVjdE1ldGhvZChy\nZWFkLCBmdWxsKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xh\nc3NTZXJpYWxpemF0aW9uQ29kZSgpIHsKICAgICAgICAvLyBmb3IgZ2VuZXJh\ndGVkIHN1YmNsYXNzZXMsIHNlcmlhbGl6YXRpb24gbXVzdCB3cml0ZSBhbiBp\nbnN0YW5jZSBvZgogICAgICAgIC8vIHRoZSBzdXBlcmNsYXNzIGluc3RlYWQg\nb2YgdGhlIHN1YmNsYXNzLCBzbyB0aGF0IHRoZSBjbGllbnQgVk0gY2FuCiAg\nICAgICAgLy8gZGVzZXJpYWxpemUgc3VjY2Vzc2Z1bGx5LgoKICAgICAgICAv\nLyBwcml2YXRlIE9iamVjdCB3cml0ZVJlcGxhY2UoKSB0aHJvd3MgT2JqZWN0\nU3RyZWFtRXhjZXB0aW9uCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoIndyaXRlUmVwbGFjZSIsIE9iamVjdC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgbWV0aG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRk\nRXhjZXB0aW9uKE9iamVjdFN0cmVhbUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAg\nIC8vIE9iamVjdCBvID0gbmV3IDxtYW5hZ2VkLXR5cGU+KCkKICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKF9tYW5hZ2VkVHlwZSk7IC8vIGZvciByZXR1\ncm4KICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgcG9zdC08aW5pdD4gd29y\nawogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciA8aW5pdD4KICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdl\ndFR5cGUoKSwgIjxpbml0PiIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG51\nbGwpOwoKICAgICAgICAvLyBjb3B5IGFsbCB0aGUgZmllbGRzLgogICAgICAg\nIC8vICMjIyMjIGxpbWl0aW5nIHRvIEpQQSBAVHJhbnNpZW50IGxpbWl0YXRp\nb25zCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRG\naWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uaXNUcmFuc2ll\nbnQoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAv\nLyBvLjxmaWVsZD4gPSB0aGlzLjxmaWVsZD4gKG9yIHJlZmxlY3RpdmUgYW5h\nbG9nKQogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgcHV0ZmllbGQK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsgLy8gZm9yIGdl\ndGZpZWxkCiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlw\nZSwgZm1kc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBwdXRmaWVsZChj\nb2RlLCBfbWFuYWdlZFR5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAg\nfQoKICAgICAgICBjb2RlLmFyZXR1cm4oKS5zZXRUeXBlKE9iamVjdC5jbGFz\ncyk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGUgY2xhc3MgYmVpbmcgZW5oYW5jZWQgc2hvdWxk\nIGV4dGVybmFsaXplIHRvIGEgZGV0YWNoZWQKICAgICAqIGluc3RhbmNlIHJh\ndGhlciB0aGFuIHNlcmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIGV4dGVybmFsaXplRGV0YWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIENs\nYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hl\nZFN0YXRlKCkpCiAgICAgICAgICAgICYmIFNlcmlhbGl6YWJsZS5jbGFzcy5p\nc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAg\nICAgICAgICAgJiYgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0\nYWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVkU3Rh\ndGVUcmFuc2llbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBj\ndXN0b20gd3JpdGVPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRo\nZQogICAgICoge0BsaW5rIE9iamVjdE91dHB1dFN0cmVhbSNkZWZhdWx0V3Jp\ndGVPYmplY3R9IG1ldGhvZCwKICAgICAqIGJ1dCBvbmx5IGFmdGVyIGNhbGxp\nbmcgdGhlIGludGVybmFsIDxjb2RlPnBjU2VyaWFsaXppbmc8L2NvZGU+IG1l\ndGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVdyaXRlT2Jq\nZWN0TWV0aG9kKEJDTWV0aG9kIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAg\nICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICAvLyBib29sIGNsZWFy\nID0gcGNTZXJpYWxpemluZyAoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoUFJFICsgIlNlcmlhbGl6aW5nIiwKICAgICAgICAgICAg\nYm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGNsZWFyID0gY29k\nZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmlzdG9yZSgp\nLnNldExvY2FsKGNsZWFyKTsKCiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAg\nICAgICAgLy8gb3V0LmRlZmF1bHRXcml0ZU9iamVjdCAoKTsKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0U3RyZWFt\nLmNsYXNzLAogICAgICAgICAgICAgICAgImRlZmF1bHRXcml0ZU9iamVjdCIs\nIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICB9CgogICAgICAgIEluc3RydWN0aW9uIHRtcGxhdGUgPSAo\nKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS52cmV0dXJu\nKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIHRvcmV0OwogICAgICAgIElu\nc3RydWN0aW9uIHJldDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CiAg\nICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2FyZCh0bXBsYXRlKSkgewog\nICAgICAgICAgICByZXQgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAg\nIC8vIGlmIChjbGVhcikgcGNTZXREZXRhY2hlZFN0YXRlIChudWxsKTsKICAg\nICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGNsZWFyKTsKICAgICAg\nICAgICAgdG9yZXQgPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIs\nCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB0b3JldC5zZXRUYXJnZXQocmV0\nKTsKICAgICAgICAgICAgY29kZS5uZXh0KCk7IC8vIGp1bXAgb3ZlciByZXR1\ncm4KICAgICAgICB9CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIGEgY3VzdG9tIHJlYWRPYmplY3QgbWV0aG9k\nIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9iamVjdElu\ncHV0U3RyZWFtI3JlYWRPYmplY3R9IG1ldGhvZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIG1vZGlmeVJlYWRPYmplY3RNZXRob2QoQkNNZXRob2QgbWV0\naG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7\nCgogICAgICAgIC8vIGlmIHRoaXMgaW5zdGFuY2UgdXNlcyBzeW50aGV0aWMg\nZGV0YWNoZWQgc3RhdGUsIG5vdGUgdGhhdCBpdCBoYXMKICAgICAgICAvLyBi\nZWVuIGRlc2VyaWFsaXplZAogICAgICAgIGlmIChDbGFzc01ldGFEYXRhLlNZ\nTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKSkgewog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0\nZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJ\nWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmpl\nY3QuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZnVsbCkgewog\nICAgICAgICAgICAvLyBpbi5kZWZhdWx0UmVhZE9iamVjdCAoKTsKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXRTdHJl\nYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAiZGVmYXVsdFJlYWRPYmplY3Qi\nLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIHBjSXNEZXRhY2hlZCgpIG1l\ndGhvZCB0byBkZXRlcm1pbmUgaWYgYW4gaW5zdGFuY2UKICAgICAqIGlzIGRl\ndGFjaGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkSXNEZXRhY2hl\nZE1ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gcHVibGljIGJvb2xlYW4gcGNJc0RldGFjaGVkICgp\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIklzRGV0YWNoZWQiLAogICAgICAgICAgICBCb29sZWFuLmNsYXNz\nLCBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIHdy\naXRlSXNEZXRhY2hlZE1ldGhvZChjb2RlKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIGJvZHkg\nb2YgdGhlIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYg\nYW4KICAgICAqIGluc3RhbmNlIGlzIGRldGFjaGVkLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd3JpdGVJc0RldGFjaGVkTWV0aG9kKENvZGUgY29kZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBub3QgZGV0YWNoYWJsZTogcmV0dXJuIEJvb2xlYW4uRkFMU0UKICAg\nICAgICBpZiAoIV9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZB\nTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAv\nLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAvLwkJcmV0dXJuIChzbS5pc0Rl\ndGFjaGVkICgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwg\nImlzRGV0YWNoZWQiLAogICAgICAgICAgICBib29sZWFuLmNsYXNzLCBudWxs\nKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZmYWxzZSA9IGNvZGUuaWZl\ncSgpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBpZmZhbHNlLnNldFRhcmdldChjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAg\nICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKCiAgICAgICAgLy8gaWYgd2UgdXNlIGRldGFjaGVkIHN0YXRlOgog\nICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUgKCkgIT0gbnVsbAog\nICAgICAgIC8vICAgICAmJiBwY0dldERldGFjaGVkU3RhdGUgIT0gREVTRVJJ\nQUxJWkVEKQogICAgICAgIC8vICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwog\nICAgICAgIEJvb2xlYW4gc3RhdGUgPSBfbWV0YS51c2VzRGV0YWNoZWRTdGF0\nZSgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub3RkZXNlciA9IG51bGw7\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gdGFyZ2V0OwogICAgICAgIGlmIChzdGF0\nZSAhPSBCb29sZWFuLkZBTFNFKSB7CiAgICAgICAgICAgIGlmaW5zLnNldFRh\ncmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZudWxsKCk7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAg\nICAgICAgbm90ZGVzZXIgPSBjb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRS\nVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CgogICAgICAgICAgICBpZiAoc3RhdGUgPT0gQm9vbGVhbi5UUlVFKSB7\nCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHRvIHVzZSBkZXRhY2hl\nZCBzdGF0ZToKICAgICAgICAgICAgICAgIC8vIHJldHVybiBCb29sZWFuLkZB\nTFNFOwogICAgICAgICAgICAgICAgdGFyZ2V0ID0gY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLAogICAgICAgICAg\nICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBub3RkZXNl\nci5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYXJ0aWZpY2lhbCB0YXJn\nZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJnZXQgPSBjb2RlLm5vcCgpOwog\nICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgIGlmIChu\nb3RkZXNlciAhPSBudWxsKQogICAgICAgICAgICBub3RkZXNlci5zZXRUYXJn\nZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gYWxsb3cgdXNlcnMgd2l0aCB2ZXJz\naW9uIGZpZWxkcyB0byBtYW51YWxseSBjb25zdHJ1Y3QgYSAiZGV0YWNoZWQi\nCiAgICAgICAgLy8gaW5zdGFuY2UsIHNvIGNoZWNrIHZlcnNpb24gYmVmb3Jl\nIHRha2luZyBpbnRvIGFjY291bnQgbm9uLWV4aXN0ZW50CiAgICAgICAgLy8g\nZGV0YWNoZWQgc3RhdGUKCiAgICAgICAgLy8gY29uc2lkZXIgZGV0YWNoZWQg\naWYgdmVyc2lvbiBpcyBub24tZGVmYXVsdAogICAgICAgIEZpZWxkTWV0YURh\ndGEgdmVyc2lvbiA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAg\nIGlmIChzdGF0ZSAhPSBCb29sZWFuLlRSVUUgJiYgdmVyc2lvbiAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIGlmICg8dmVyc2lvbj4gIT0gPGRlZmF1bHQ+\nKQogICAgICAgICAgICAvLwkJcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBh\nZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHZlcnNpb24pOwogICAgICAg\nICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHZlcnNpb24pOwog\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuYXJldHVybigpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0Ui\nLAogICAgICAgICAgICAgICAgQm9vbGVhbi5jbGFzcykpOwogICAgICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgLy8gbm8gZGV0YWNoZWQgc3RhdGU6IGlmIGluc3RhbmNl\nIHVzZXMgZGV0YWNoZWQgc3RhdGUgYW5kIGl0J3Mgbm90CiAgICAgICAgLy8g\nc3ludGhldGljIG9yIHRoZSBpbnN0YW5jZSBpcyBub3Qgc2VyaWFsaXphYmxl\nIG9yIHRoZSBzdGF0ZSBpc24ndAogICAgICAgIC8vIHRyYW5zaWVudCwgbXVz\ndCBub3QgYmUgZGV0YWNoZWQKICAgICAgICBpZiAoc3RhdGUgPT0gbnVsbAog\nICAgICAgICAgICAmJiAoIUNsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFs\ncyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpCiAgICAgICAgICAgIHx8ICFT\nZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCkpCiAgICAgICAgICAgIHx8ICFfcmVwb3MuZ2V0Q29u\nZmlndXJhdGlvbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKS4KICAgICAg\nICAgICAgaXNEZXRhY2hlZFN0YXRlVHJhbnNpZW50KCkpKSB7CiAgICAgICAg\nICAgIC8vIHJldHVybiBCb29sZWFuLkZBTFNFCiAgICAgICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwg\nQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBubyBk\nZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0\nZSAoYW5kIG11c3QgYmUKICAgICAgICAvLyBzeW50aGV0aWMgYW5kIHRyYW5z\naWVudCBpbiBzZXJpYWxpemFibGUgaW5zdGFuY2UgYXQgdGhpcyBwb2ludCks\nCiAgICAgICAgLy8gbm90IGRldGFjaGVkIGlmIHN0YXRlIG5vdCBzZXQgdG8g\nREVTRVJJQUxJWkVECiAgICAgICAgaWYgKHN0YXRlID09IG51bGwpIHsKICAg\nICAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSA9PSBudWxs\nKSAvLyBpbnN0ZWFkIG9mIERFU0VSSUFMSVpFRAogICAgICAgICAgICAvLyAg\nICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3Rh\ndGUiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJG\nQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gY29uc2lkZXIgZGV0YWNoZWQgaWYg\nYXV0by1nZW5uZWQgcHJpbWFyeSBrZXlzIGFyZSBub24tZGVmYXVsdAogICAg\nICAgIGlmaW5zID0gbnVsbDsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZp\nbnMyID0gbnVsbDsKICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVF\nCiAgICAgICAgICAgICYmIF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENs\nYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgLy8g\nZm9yIGVhY2ggcGsgZmllbGQ6CiAgICAgICAgICAgIC8vIGlmICg8cGs+ICE9\nIDxkZWZhdWx0PiBbJiYgISIiLmVxdWFscyAoPHBrPildKQogICAgICAgICAg\nICAvLwkJcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIHBrcyA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVTdHJh\ndGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRhcmdldCA9IGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgaWYgKGlmaW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAoaWZp\nbnMyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMyLnNldFRh\ncmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgaWZpbnMyID0gbnVsbDsK\nCiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUs\nIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVsdFZh\nbHVlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ld\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RSSU5HKSB7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKCIiKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBhZGRHZXRNYW5h\nZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZy5jbGFz\ncywgImVxdWFscyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4u\nY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAg\nICAgICAgICAgICAgaWZpbnMyID0gY29kZS5pZm5lKCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwKICAgICAgICAgICAgICAgICAg\nICBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBnaXZl\nIHVwOyB3ZSBqdXN0IGRvbid0IGtub3cKICAgICAgICB0YXJnZXQgPSBjb2Rl\nLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGlmIChpZmlucyAhPSBu\ndWxsKQogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAg\nICAgICBpZiAoaWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zMi5z\nZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbXBhcmUgdGhlIGdpdmVuIGZpZWxkIHRv\nIGl0cyBKYXZhIGRlZmF1bHQsIHJldHVybmluZyB0aGUKICAgICAqIGNvbXBh\ncmlzb24gaW5zdHJ1Y3Rpb24uIFRoZSBmaWVsZCB2YWx1ZSB3aWxsIGFscmVh\nZHkgYmUgb24gdGhlIHN0YWNrLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBKdW1wSW5zdHJ1Y3Rpb24gaWZEZWZhdWx0VmFsdWUoQ29kZSBjb2RlLAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5p\nZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmRjbXBsKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKDBGKTsKICAgICAgICAgICAgICAgIGNvZGUuZmNtcGwoKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBjb2RlLmxjbXAo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlm\nbnVsbCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gZ2V0IHRoZSBjb2RlIGZvciB0aGUgY2xhc3MgaW5pdGlh\nbGl6ZXIgbWV0aG9kLAogICAgICogY3JlYXRpbmcgdGhlIG1ldGhvZCBpZiBp\ndCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LgogICAgICovCiAgICBwcml2YXRl\nIENvZGUgZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKGJvb2xlYW4gcmVwbGFj\nZUxhc3QpIHsKICAgICAgICBCQ01ldGhvZCBjbGluaXQgPSBfcGMuZ2V0RGVj\nbGFyZWRNZXRob2QoIjxjbGluaXQ+Iik7CiAgICAgICAgQ29kZSBjb2RlOwog\nICAgICAgIGlmIChjbGluaXQgIT0gbnVsbCkgewogICAgICAgICAgICBjb2Rl\nID0gY2xpbml0LmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgIGlmIChyZXBs\nYWNlTGFzdCkgewogICAgICAgICAgICAgICAgQ29kZSB0ZW1wbGF0ZSA9IChD\nb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpOwog\nICAgICAgICAgICAgICAgY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlLnZy\nZXR1cm4oKSk7CiAgICAgICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAg\nICAgICAgICAgICAgICBjb2RlLnNldCh0ZW1wbGF0ZS5ub3AoKSk7CiAgICAg\nICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gY29kZTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCBz\ndGF0aWMgaW5pdGlhbGl6ZXIgbWV0aG9kIGlmIG5vbiBleGlzdHMKICAgICAg\nICBjbGluaXQgPSBfcGMuZGVjbGFyZU1ldGhvZCgiPGNsaW5pdD4iLCB2b2lk\nLmNsYXNzLCBudWxsKTsKICAgICAgICBjbGluaXQubWFrZVBhY2thZ2UoKTsK\nICAgICAgICBjbGluaXQuc2V0U3RhdGljKHRydWUpOwogICAgICAgIGNsaW5p\ndC5zZXRGaW5hbCh0cnVlKTsKCiAgICAgICAgY29kZSA9IGNsaW5pdC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGlmICghcmVwbGFjZUxhc3QpIHsKICAgICAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIGNvZGUucHJldmlv\ndXMoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvZGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIGJ5dGVjb2RlIG1vZGlmeWluZyB0aGUgY2xv\nbmluZyBiZWhhdmlvciBvZiB0aGUgY2xhc3MgYmVpbmcKICAgICAqIGVuaGFu\nY2VkIHRvIGNvcnJlY3RseSByZXBsYWNlIHRoZSA8Y29kZT5wY1N0YXRlTWFu\nYWdlcjwvY29kZT4gCiAgICAgKiBpbnN0YW5jZSBmaWVsZHMgb2YgYW55IGNs\nb25lIGNyZWF0ZWQgd2l0aCB0aGVpciBkZWZhdWx0IHZhbHVlcy4gCiAgICAg\nKiBBbHNvLCBpZiB0aGlzIGNsYXNzIGlzIHRoZSBiYXNlIFBDIHR5cGUgYW5k\nIGRvZXMgbm90IGRlY2xhcmVkIAogICAgICogYSBjbG9uZSBtZXRob2QsIG9u\nZSB3aWxsIGJlIGFkZGVkLiBBbHNvLCBpZiBfcGMgaXMgYSBzeW50aGV0aWMK\nICAgICAqIHN1YmNsYXNzLCBjcmVhdGUgdGhlIGNsb25lKCkgbWV0aG9kIHRo\nYXQgY2xlYXJzIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgKiB0aGF0IG1heSBo\nYXZlIGJlZW4gaW5pdGlhbGl6ZWQgaW4gYSBzdXBlcidzIGNsb25lKCkgbWV0\naG9kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xvbmluZ0NvZGUo\nKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51\nbGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gYWRkIHRoZSBjbG9uZSBtZXRob2QgaWYgbmVjZXNz\nYXJ5CiAgICAgICAgQkNNZXRob2QgY2xvbmUgPSBfcGMuZ2V0RGVjbGFyZWRN\nZXRob2QoImNsb25lIiwgCiAgICAgICAgICAgIChTdHJpbmdbXSkgbnVsbCk7\nCiAgICAgICAgU3RyaW5nIHN1cGVyTmFtZSA9IF9tYW5hZ2VkVHlwZS5nZXRT\ndXBlcmNsYXNzTmFtZSgpOwogICAgICAgIENvZGUgY29kZSA9IG51bGw7CiAg\nICAgICAgaWYgKGNsb25lID09IG51bGwpIHsKICAgICAgICAgICAgLy8gYWRk\nIGNsb25lIHN1cHBvcnQgZm9yIGJhc2UgY2xhc3NlcwogICAgICAgICAgICAv\nLyB3aGljaCBhbHNvIGltcGxlbWVudCBjbG9uZWFibGUKICAgICAgICAgICAg\nYm9vbGVhbiBpc0Nsb25lYWJsZSA9IENsb25lYWJsZS5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKAogICAgICAgICAgICAgICAgX21hbmFnZWRUeXBlLmdldFR5\ncGUoKSk7CiAgICAgICAgICAgIGJvb2xlYW4gZXh0ZW5kc09iamVjdCA9CiAg\nICAgICAgICAgICAgICBzdXBlck5hbWUuZXF1YWxzKE9iamVjdC5jbGFzcy5n\nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAoIWlzQ2xvbmVhYmxlIHx8ICgh\nZXh0ZW5kc09iamVjdCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkpCiAgICAg\nICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoIWdldENyZWF0\nZVN1YmNsYXNzKCkpCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJlbmhhbmNlLWNsb25l\nYWJsZSIsIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCkpKTsKCiAgICAgICAgICAg\nIC8vIGFkZCBjbG9uZSBtZXRob2QKICAgICAgICAgICAgLy8gcHJvdGVjdGVk\nIE9iamVjdCBjbG9uZSAoKSB0aHJvd3MgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNl\ncHRpb24KICAgICAgICAgICAgY2xvbmUgPSBfcGMuZGVjbGFyZU1ldGhvZCgi\nY2xvbmUiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZiAo\nIXNldFZpc2liaWxpdHlUb1N1cGVyTWV0aG9kKGNsb25lKSkKICAgICAgICAg\nICAgICAgIGNsb25lLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICAgICAgY2xv\nbmUuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAgICAgICAg\nICAgICAgIChDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUgPSBjbG9uZS5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAgICAgLy8gcmV0dXJuIHN1cGVyLmNsb25lICgpOwogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cGVyTmFtZSwgImNs\nb25lIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcy5nZXROYW1lKCks\nIG51bGwpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAvLyBnZXQgdGhlIGNsb25lIG1ldGhvZCBj\nb2RlCiAgICAgICAgICAgIGNvZGUgPSBjbG9uZS5nZXRDb2RlKGZhbHNlKTsK\nICAgICAgICAgICAgaWYgKGNvZGUgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSB0ZW1wbGF0\nZSBzdXBlci5jbG9uZSAoKSBpbnN0cnVjdGlvbiB0byBtYXRjaCBhZ2FpbnN0\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gdGVtcGxhdGUgPSAoKENvZGUpIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS5pbnZva2VzcGVjaWFsKCkKICAg\nICAgICAgICAgLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9uZSIsIE9iamVj\ndC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwoKICAgICAgICAvLyBmaW5kIGNh\nbGxzIHRvIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlvbjsgb24gbWF0Y2gKICAg\nICAgICAvLyBjbG9uZSB3aWxsIGJlIG9uIHN0YWNrCiAgICAgICAgY29kZS5i\nZWZvcmVGaXJzdCgpOwogICAgICAgIGlmIChjb2RlLnNlYXJjaEZvcndhcmQo\ndGVtcGxhdGUpKSB7CiAgICAgICAgICAgIC8vICgoPHR5cGU+KSBjbG9uZSku\ncGNTdGF0ZU1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX3BjKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwoK\nICAgICAgICAgICAgLy8gaWYgbW9kaWZpZWQsIGluY3JlYXNlIHN0YWNrCiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBhdXhpbGlhcnkgZW5oYW5jZXJz\nIHJlZ2lzdGVyZWQgYXMge0BsaW5rIFNlcnZpY2VzIHNlcnZpY2VzfS4KICAg\nICAqLwogICAgcHVibGljIEF1eGlsaWFyeUVuaGFuY2VyW10gZ2V0QXV4aWxp\nYXJ5RW5oYW5jZXJzKCkgewoJCXJldHVybiBfYXV4RW5oYW5jZXJzOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIEFsbG93IGFueSByZWdpc3RlcmVkIGF1\neGlsaWFyeSBjb2RlIGdlbmVyYXRvcnMgdG8gcnVuLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcnVuQXV4aWxpYXJ5RW5oYW5jZXJzKCkgewogICAgCWZv\nciAoaW50IGkgPSAwOyBpIDwgX2F1eEVuaGFuY2Vycy5sZW5ndGg7IGkrKykK\nICAgIAkJX2F1eEVuaGFuY2Vyc1tpXS5ydW4oX3BjLCBfbWV0YSk7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgZ2l2ZW4gbWV0\naG9kIGJlIHNraXBwZWQuCiAgICAgKiAKICAgICAqIEBwYXJhbSBtZXRob2Qg\nbWV0aG9kIHRvIGJlIHNraXBwZWQgb3Igbm90CiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgYW55IG9mIHRoZSBhdXhpbGlhcnkgZW5oYW5jZXJzIHNraXBzIHRo\nZSBnaXZlbiBtZXRob2QsCiAgICAgKiBvciBpZiB0aGUgbWV0aG9kIGlzIGEg\nY29uc3RydWN0b3IKICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNraXBF\nbmhhbmNlKEJDTWV0aG9kIG1ldGhvZCkgewogICAgICAgIGlmICgiPGluaXQ+\nIi5lcXVhbHMobWV0aG9kLmdldE5hbWUoKSkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX2F1eEVuaGFuY2Vycy5sZW5ndGg7IGkrKykKICAgIAkJaWYgKF9hdXhFbmhh\nbmNlcnNbaV0uc2tpcEVuaGFuY2UobWV0aG9kKSkKICAgIAkJCXJldHVybiB0\ncnVlOwogICAgICAgIAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgc3ludGhldGljIGZpZWxkIGFjY2VzcyBtZXRo\nb2RzIHRoYXQgd2lsbCByZXBsYWNlIGFsbCBkaXJlY3QKICAgICAqIGZpZWxk\nIGFjY2Vzc2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQWNjZXNz\nb3JzKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNs\nYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRh\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBpZiAoIWdldFJl\nZGVmaW5lKCkKICAgICAgICAgICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAg\nICAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc1NldE1ldGhvZChmbWRzW2ld\nKTsKICAgICAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc0dldE1ldGhvZChm\nbWRzW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIGFkZEdldE1ldGhvZChpLCBmbWRzW2ldKTsK\nICAgICAgICAgICAgICAgIGFkZFNldE1ldGhvZChpLCBmbWRzW2ldKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYSBub24tc3RhdGljIHNldHRlciB0aGF0IGRlbGVnYXRlcyB0byB0aGUg\nc3VwZXIgbWV0aG9kcywgYW5kCiAgICAgKiBwZXJmb3JtcyBhbnkgbmVjZXNz\nYXJ5IGZpZWxkIHRyYWNraW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkU3ViY2xhc3NTZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xh\nc3MgcHJvcFR5cGUgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAg\nU3RyaW5nIHNldHRlck5hbWUgPSBnZXRTZXR0ZXJOYW1lKGZtZCk7CiAgICAg\nICAgQkNNZXRob2Qgc2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2Qoc2V0dGVy\nTmFtZSwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW10geyBw\ncm9wVHlwZSB9KTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhv\nZChzZXR0ZXIpOwogICAgICAgIENvZGUgY29kZSA9IHNldHRlci5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyBub3QgbmVjZXNzYXJ5IGlmIHdlJ3JlIGFs\ncmVhZHkgdHJhY2tpbmcgYWNjZXNzIHZpYSByZWRlZmluaXRpb24KICAgICAg\nICBpZiAoIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgLy8gZ2V0IHRo\nZSBvcmlnIHZhbHVlIG9udG8gc3RhY2sKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBmbWQpOwogICAgICAgICAgICBpbnQgdmFsID0gY29kZS5n\nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgY29kZS54c3RvcmUo\nKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgp\nKTsKICAgICAgICAgICAgYWRkTm90aWZ5TXV0YXRpb24oY29kZSwgZm1kLCB2\nYWwsIDApOwogICAgICAgIH0KCiAgICAgICAgLy8gIyMjIyMgdGVzdCBjYXNl\nOiBCIGV4dGVuZHMgQS4gTWV0aG9kcyBkZWZpbmVkIGluIEEuIFdoYXQKICAg\nICAgICAvLyAjIyMjIyBoYXBwZW5zPwogICAgICAgIC8vIHN1cGVyLnNldFhY\nWCguLi4pCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAg\nICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oMCkuc2V0VHlwZShwcm9wVHlwZSk7\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5h\nZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgIHNldHRlck5hbWUsIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgcHJvcFR5cGUgfSk7CgogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nfQoKICAgIHByaXZhdGUgYm9vbGVhbiBzZXRWaXNpYmlsaXR5VG9TdXBlck1l\ndGhvZChCQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBCQ01ldGhvZFtdIG1l\ndGhvZHMgPSBfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRob2QuZ2V0TmFt\nZSgpLAogICAgICAgICAgICBtZXRob2QuZ2V0UGFyYW1UeXBlcygpKTsKICAg\nICAgICBpZiAobWV0aG9kcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWFjY2Vzc29yIiwK\nICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCksIG1ldGhv\nZC5nZXROYW1lKCkpKTsKICAgICAgICBCQ01ldGhvZCBzdXBlck1ldGggPSBt\nZXRob2RzWzBdOwogICAgICAgIGlmIChzdXBlck1ldGguaXNQcml2YXRlKCkp\nIHsKICAgICAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRo\nLmlzUGFja2FnZSgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUGFja2Fn\nZSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2Ug\naWYgKHN1cGVyTWV0aC5pc1Byb3RlY3RlZCgpKSB7CiAgICAgICAgICAgIG1l\ndGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRoLmlzUHVibGljKCkpIHsK\nICAgICAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBub24tc3RhdGljIGdldHRl\nciB0aGF0IGRlbGVnYXRlcyB0byB0aGUgc3VwZXIgbWV0aG9kcywgYW5kCiAg\nICAgKiBwZXJmb3JtcyBhbnkgbmVjZXNzYXJ5IGZpZWxkIHRyYWNraW5nLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NHZXRNZXRob2Qo\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWUg\nPSAiZ2V0IiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdldE5hbWUo\nKSk7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXRNZXRob2RzKG1ldGhO\nYW1lLCBuZXcgQ2xhc3NbMF0pLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBt\nZXRoTmFtZSA9ICJpcyIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5n\nZXROYW1lKCkpOwogICAgICAgIEJDTWV0aG9kIGdldHRlciA9IF9wYy5kZWNs\nYXJlTWV0aG9kKG1ldGhOYW1lLCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCksCiAg\nICAgICAgICAgIG51bGwpOwogICAgICAgIHNldFZpc2liaWxpdHlUb1N1cGVy\nTWV0aG9kKGdldHRlcik7CiAgICAgICAgZ2V0dGVyLm1ha2VQdWJsaWMoKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBnZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgLy8gaWYgd2UncmUgbm90IGFscmVhZHkgdHJhY2tpbmcgZmllbGQg\nYWNjZXNzIHZpYSByZWZsZWN0aW9uLCB0aGVuIHdlCiAgICAgICAgLy8gbXVz\ndCBtYWtlIHRoZSBnZXR0ZXIgaG9vayBpbiBsYXp5IGxvYWRpbmcgYmVmb3Jl\nIGFjY2Vzc2luZyB0aGUgc3VwZXIKICAgICAgICAvLyBtZXRob2QuCiAgICAg\nICAgaWYgKCFnZXRSZWRlZmluZSgpKQogICAgICAgICAgICBhZGROb3RpZnlB\nY2Nlc3MoY29kZSwgZm1kKTsKCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRo\naXMoKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nX21hbmFnZWRUeXBlLmdldFR5cGUoKSwgbWV0aE5hbWUsCiAgICAgICAgICAg\nIGZtZC5nZXREZWNsYXJlZFR5cGUoKSwgbnVsbCk7CiAgICAgICAgY29kZS54\ncmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyBhIHN0YXRpYyBnZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQu\nCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0aCB0\naGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5hZ2Vy\nIHRvIGdldCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAgICAq\nIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBmaWVs\nZAogICAgICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmllbGQg\ndG8gZ2V0CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRHZXRNZXRob2Qo\naW50IGluZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBjcmVhdGVHZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgcmVhZHMg\nYXJlIG5vdCBjaGVja2VkLCBqdXN0IHJldHVybiB0aGUgdmFsdWUKICAgICAg\nICBieXRlIGZpZWxkRmxhZyA9IGdldEZpZWxkRmxhZyhmbWQpOwogICAgICAg\nIGlmICgoZmllbGRGbGFnICYgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JF\nQUQpID09IDAKICAgICAgICAgICAgJiYgKGZpZWxkRmxhZyAmIFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5NRURJQVRFX1JFQUQpID09IDApIHsKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICAgICAg\nYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgICAg\nICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSk7CgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIChpbnN0LnBj\nU3RhdGVNYW5hZ2VyID09IG51bGwpIHJldHVybiBpbnN0LjxmaWVsZD47CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAg\nICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSk7CgogICAgICAgIC8vIGludCBmaWVsZCA9IHBjSW5oZXJpdGVkRmllbGRD\nb3VudCArIDxmaWVsZGluZGV4PjsKICAgICAgICBpbnQgZmllbGRMb2NhbCA9\nIGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50\nLmNsYXNzKSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGlu\nZGV4KTsKICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICBjb2RlLmlzdG9y\nZSgpLnNldExvY2FsKGZpZWxkTG9jYWwpOwoKICAgICAgICAvLyBpbnN0LnBj\nU3RhdGVNYW5hZ2VyLmFjY2Vzc2luZ0ZpZWxkIChmaWVsZCk7CiAgICAgICAg\nLy8gcmV0dXJuIGluc3QuPGZpZWxkPjsKICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0\nTG9jYWwoZmllbGRMb2NhbCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoU01UWVBFLCAiYWNjZXNzaW5nRmllbGQiLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0p\nOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAg\nICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAg\nICAgIGNvZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlw\nZSgpKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIGEgc3RhdGljIHNldHRlciBtZXRob2QgZm9yIHRoZSBn\naXZlbiBmaWVsZC4KICAgICAqIFRoZSBnZW5lcmF0ZWQgbWV0aG9kIGludGVy\nYWN0cyB3aXRoIHRoZSBpbnN0YW5jZSBzdGF0ZSBhbmQgdGhlCiAgICAgKiBT\ndGF0ZU1hbmFnZXIgdG8gc2V0IHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuCiAg\nICAgKgogICAgICogQHBhcmFtIGluZGV4IHRoZSByZWxhdGl2ZSBudW1iZXIg\nb2YgdGhlIGZpZWxkCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRhIGFib3V0\nIHRoZSBmaWVsZCB0byBzZXQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFNldE1ldGhvZChpbnQgaW5kZXgsIEZpZWxkTWV0YURhdGEgZm1kKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IGNyZWF0ZVNldE1ldGhvZChmbWQpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyBQQ0VuaGFuY2VyIHVzZXMgc3RhdGljIG1ldGhvZHM7IFBDU3ViY2xhc3Nl\nciBkb2VzIG5vdC4KICAgICAgICBpbnQgZmlyc3RQYXJhbU9mZnNldCA9IGdl\ndEFjY2Vzc29yUGFyYW1ldGVyT2Zmc2V0KCk7CgogICAgICAgIC8vIGlmIChp\nbnN0LnBjU3RhdGVNYW5hZ2VyID09IG51bGwpIGluc3QuPGZpZWxkPiA9IHZh\nbHVlOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25u\ndWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nKTsKICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oZmlyc3RQYXJhbU9m\nZnNldCk7CiAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBm\nbWQpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBpbnN0\nLnBjU3RhdGVNYW5hZ2VyLnNldHRpbmc8ZmllbGRUeXBlPkZpZWxkIChpbnN0\nLAogICAgICAgIC8vICAgICBwY0luaGVyaXRlZEZpZWxkQ291bnQgKyA8aW5k\nZXg+LCBpbnN0LjxmaWVsZD4sIHZhbHVlLCAwKTsKICAgICAgICBpZmlucy5z\nZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKSk7CiAg\nICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAg\nICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xh\nc3MpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7\nCiAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVD\nb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFt\nKGZpcnN0UGFyYW1PZmZzZXQpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSgwKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAgKGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSwgInNldHRpbmciLCBmYWxzZSwgdHJ1ZSkp\nOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZXMgd2hpY2gg\nYXR0YWNoIC8gZGV0YWNoIG1ldGhvZHMgdG8gdXNlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkQXR0YWNoRGV0YWNoQ29kZSgpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2VlIGlm\nIGFueSBzdXBlcmNsYXNzZXMgYXJlIGRldGFjaGFibGUKICAgICAgICBib29s\nZWFuIHBhcmVudERldGFjaGFibGUgPSBmYWxzZTsKICAgICAgICBmb3IgKENs\nYXNzTWV0YURhdGEgcGFyZW50ID0gX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICAgICAgcGFyZW50ICE9IG51bGw7IHBhcmVudCA9\nIHBhcmVudC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSB7CiAgICAgICAg\nICAgIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAg\nICAgIHBhcmVudERldGFjaGFibGUgPSB0cnVlOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHBhcmVudCBub3QgZGV0YWNoYWJsZSwgd2UgbmVlZCB0byBhZGQgdGhlIGRl\ndGFjaCBzdGF0ZSBmaWVsZHMgYW5kCiAgICAgICAgLy8gYWNjZXNzb3IgbWV0\naG9kcwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBu\ndWxsIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkKICAgICAgICAgICAgfHwgcGFy\nZW50RGV0YWNoYWJsZSAhPSBfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAg\nICAgICAgICBhZGRJc0RldGFjaGVkTWV0aG9kKCk7CiAgICAgICAgICAgIGFk\nZERldGFjaGVkU3RhdGVNZXRob2RzKF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRl\nKCkKICAgICAgICAgICAgICAgICE9IEJvb2xlYW4uRkFMU0UpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaWYgd2UgZGV0YWNoIG9uIHNlcmlhbGl6ZSwgd2Ug\nYWxzbyBuZWVkIHRvIGltcGxlbWVudCB0aGUKICAgICAgICAvLyBleHRlcm5h\nbGl6YWJsZSBpbnRlcmZhY2UgdG8gd3JpdGUganVzdCB0aGUgc3RhdGUgZm9y\nIHRoZSBmaWVsZHMKICAgICAgICAvLyBiZWluZyBkZXRhY2hlZAogICAgICAg\nIGlmIChleHRlcm5hbGl6ZURldGFjaGVkKCkpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGFkZERldGFjaEV4dGVybmFsaXplKHBhcmVu\ndERldGFjaGFibGUsCiAgICAgICAgICAgICAgICAgICAgX21ldGEudXNlc0Rl\ndGFjaGVkU3RhdGUoKSAhPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKG5zbWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIHRoZSBmaWVsZHMgdG8gaG9sZCBkZXRhY2hlZCBzdGF0ZSBhbmQgdGhl\naXIgYWNjZXNzb3IgbWV0aG9kcy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW1w\nbCB3aGV0aGVyIHRvIGZ1bGx5IGltcGxlbWVudCBkZXRhY2ggc3RhdGUgZnVu\nY3Rpb25hbGl0eQogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRGV0YWNo\nZWRTdGF0ZU1ldGhvZHMoYm9vbGVhbiBpbXBsKSB7CiAgICAgICAgRmllbGQg\nZGV0YWNoRmllbGQgPSBfbWV0YS5nZXREZXRhY2hlZFN0YXRlRmllbGQoKTsK\nICAgICAgICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAgU3RyaW5nIGRl\nY2xhcmVyID0gbnVsbDsKICAgICAgICBpZiAoaW1wbCAmJiBkZXRhY2hGaWVs\nZCA9PSBudWxsKSB7CiAgICAgICAgICAgIG5hbWUgPSBQUkUgKyAiRGV0YWNo\nZWRTdGF0ZSI7CiAgICAgICAgICAgIGRlY2xhcmVyID0gX3BjLmdldE5hbWUo\nKTsKICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5kZWNsYXJlRmll\nbGQobmFtZSwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgZmllbGQubWFr\nZVByaXZhdGUoKTsKICAgICAgICAgICAgZmllbGQuc2V0VHJhbnNpZW50KHRy\ndWUpOwogICAgICAgIH0gZWxzZSBpZiAoaW1wbCkgewogICAgICAgICAgICBu\nYW1lID0gZGV0YWNoRmllbGQuZ2V0TmFtZSgpOwogICAgICAgICAgICBkZWNs\nYXJlciA9IGRldGFjaEZpZWxkLmdldERlY2xhcmluZ0NsYXNzKCkuZ2V0TmFt\nZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBwY0dl\ndERldGFjaGVkU3RhdGUgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAg\nICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9k\nLnNldFN0YXRpYyhmYWxzZSk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBpbnQgYWNjZXNzID0gbWV0aG9kLmdldEFjY2Vzc0ZsYWdz\nKCk7CgogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwogICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBw\nY0RldGFjaGVkU3RhdGU7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBf\nbWFuYWdlZFR5cGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciks\nCiAgICAgICAgICAgICAgICBuYW1lKTsKICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKCiAgICAgICAg\nLy8gcHVibGljIHZvaWQgcGNTZXREZXRhY2hlZFN0YXRlIChPYmplY3Qgc3Rh\ndGUpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3MgW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBtZXRob2Qu\nc2V0QWNjZXNzRmxhZ3MoYWNjZXNzKTsKICAgICAgICBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CiAgICAgICAgaWYgKGltcGwpIHsKICAgICAgICAg\nICAgLy8gcGNEZXRhY2hlZFN0YXRlID0gc3RhdGU7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIHB1dGZpZWxk\nKGNvZGUsIF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9hZENsYXNzKGRl\nY2xhcmVyKSwKICAgICAgICAgICAgICAgIG5hbWUsIE9iamVjdC5jbGFzcyk7\nCiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0byA8\nY29kZT5jb2RlPC9jb2RlPiB0aGUgaW5zdHJ1Y3Rpb25zIHRvIGdldCBmaWVs\nZAogICAgICogPGNvZGU+YXR0ck5hbWU8L2NvZGU+IGRlY2xhcmVkIGluIHR5\ncGUgPGNvZGU+ZGVjbGFyZXI8L2NvZGU+CiAgICAgKiBvbnRvIHRoZSB0b3Ag\nb2YgdGhlIHN0YWNrLgogICAgICoKICAgICAqIFRoZSBpbnN0YW5jZSB0byBh\nY2Nlc3MgbXVzdCBhbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlCiAgICAg\nKiBzdGFjayB3aGVuIHRoaXMgaXMgaW52b2tlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGdldGZpZWxkKENvZGUgY29kZSwgQkNDbGFzcyBkZWNsYXJl\nciwgU3RyaW5nIGF0dHJOYW1lKSB7CiAgICAgICAgaWYgKGRlY2xhcmVyID09\nIG51bGwpCiAgICAgICAgICAgIGRlY2xhcmVyID0gX21hbmFnZWRUeXBlOwoK\nICAgICAgICAvLyBmaXJzdCwgc2VlIGlmIHdlIGNhbiBjb252ZXJ0IHRoZSBh\ndHRyaWJ1dGUgbmFtZSB0byBhIGZpZWxkIG5hbWUKICAgICAgICBTdHJpbmcg\nZmllbGROYW1lID0gdG9CYWNraW5nRmllbGROYW1lKGF0dHJOYW1lKTsKCiAg\nICAgICAgLy8gbmV4dCwgZmluZCB0aGUgZmllbGQgaW4gdGhlIG1hbmFnZWQg\ndHlwZS4KICAgICAgICBCQ0ZpZWxkW10gZmllbGRzID0gKEJDRmllbGRbXSkg\nQWNjZXNzQ29udHJvbGxlcgogICAgICAgICAgICAuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2SGVscGVyLmdldEJDQ2xhc3NGaWVsZHNBY3Rpb24oX21hbmFnZWRU\neXBlLAogICAgICAgICAgICAgICAgZmllbGROYW1lKSk7IAogICAgICAgIEJD\nRmllbGQgZmllbGQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpZWxkID0g\nZmllbGRzW2ldOwogICAgICAgICAgICAvLyBpZiB3ZSByZWFjaCBhIGZpZWxk\nIGRlY2xhcmVkIGluIHRoaXMgdHlwZSwgdGhlbiB0aGlzIGlzIHRoZQogICAg\nICAgICAgICAvLyBtb3N0LW1hc2tpbmcgZmllbGQsIGFuZCBpcyB0aGUgb25l\nIHRoYXQgd2Ugd2FudC4KICAgICAgICAgICAgLy8gIyMjIyMgcHJvYmFibHkg\nc2hvdWxkIHdhbGsgdXAgdGhlIGhpZXJhcmNoeSwgb3IgY2hlY2sgdGhhdAog\nICAgICAgICAgICAvLyAjIyMjIyBzZXJwIGRvZXMgdGhhdC4KICAgICAgICAg\nICAgaWYgKGZpZWxkc1tpXS5nZXREZWNsYXJlcigpID09IGRlY2xhcmVyKSB7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkgJiYgY29kZS5n\nZXRNZXRob2QoKS5nZXREZWNsYXJlcigpID09IF9wYwogICAgICAgICAgICAm\nJiAoZmllbGQgPT0gbnVsbCB8fCAhZmllbGQuaXNQdWJsaWMoKSkpIHsKICAg\nICAgICAgICAgLy8gd2UncmUgY3JlYXRpbmcgdGhlIHN1YmNsYXNzLCBub3Qg\ncmVkZWZpbmluZyB0aGUgdXNlciB0eXBlLgoKICAgICAgICAgICAgLy8gUmVm\nbGVjdGlvbi5nZXRYWFgodGhpcywgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4u\nKSk7CiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNz\nKGRlY2xhcmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGZpZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMo\nKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAg\nICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAg\nICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVh\nbi5jbGFzcyB9KTsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IF9tZXRhLmdl\ndEZpZWxkKGF0dHJOYW1lKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCku\nc2V0TWV0aG9kKAogICAgICAgICAgICAgICAgICAgIGdldFJlZmxlY3Rpb25H\nZXR0ZXJNZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIC8vIHNob3VsZCBuZXZlciBoYXBwZW4KICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBl\nICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFt\nZSgpLCBmaWVsZE5hbWUsCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUeXBl\nKCkuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRvIDxjb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMg\ndG8gc2V0IGZpZWxkCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVj\nbGFyZWQgaW4gdHlwZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIHRv\nIHRoZSB2YWx1ZSBvZiB0eXBlIDxjb2RlPmZpZWxkVHlwZTwvY29kZT4gb24g\ndGhlIHRvcCBvZiB0aGUgc3RhY2suCiAgICAgKgogICAgICogV2hlbiB0aGlz\nIG1ldGhvZCBpcyBpbnZva2VkLCB0aGUgdmFsdWUgdG8gbG9hZCBtdXN0CiAg\nICAgKiBhbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGluIDxj\nb2RlPmNvZGU8L2NvZGU+LAogICAgICogYW5kIHRoZSBpbnN0YW5jZSB0byBs\nb2FkIGludG8gbXVzdCBiZSBzZWNvbmQuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBwdXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0\ncmluZyBhdHRyTmFtZSwKICAgICAgICBDbGFzcyBmaWVsZFR5cGUpIHsKICAg\nICAgICBpZiAoZGVjbGFyZXIgPT0gbnVsbCkKICAgICAgICAgICAgZGVjbGFy\nZXIgPSBfbWFuYWdlZFR5cGU7CgogICAgICAgIFN0cmluZyBmaWVsZE5hbWUg\nPSB0b0JhY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUpOwoKICAgICAgICBpZiAo\nZ2V0UmVkZWZpbmUoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAg\nICAgICAgIC8vIFJlZmxlY3Rpb24uc2V0KHRoaXMsIFJlZmxlY3Rpb24uZmlu\nZEZpZWxkKC4uLiksIHZhbHVlKTsKICAgICAgICAgICAgY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3MoZGVjbGFyZXIpOwogICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZmllbGROYW1lKTsKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNz\nLAogICAgICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3Ry\naW5nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAi\nc2V0IiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0\nLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZS5pc1ByaW1p\ndGl2ZSgpID8gZmllbGRUeXBlIDogT2JqZWN0LmNsYXNzLCAKICAgICAgICAg\nICAgICAgICAgICBGaWVsZC5jbGFzcyB9KTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkKICAgICAgICAgICAgICAgIC5z\nZXRGaWVsZChkZWNsYXJlci5nZXROYW1lKCksIGZpZWxkTmFtZSwgZmllbGRU\neXBlLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogSWYgdXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMg\nYSBkaWZmZXJlbnQgYmFja2luZyBmaWVsZAogICAgICogbmFtZSBmb3IgdGhl\nIHBlcnNpc3RlbnQgYXR0cmlidXRlIDxjb2RlPm5hbWU8L2NvZGU+LgogICAg\nICovCiAgICBwcml2YXRlIFN0cmluZyB0b0JhY2tpbmdGaWVsZE5hbWUoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgp\nID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZCiAgICAgICAgICAg\nICYmIF9hdHRyc1RvRmllbGRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAg\nICAgICBuYW1lID0gKFN0cmluZykgX2F0dHJzVG9GaWVsZHMuZ2V0KG5hbWUp\nOwogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBk\naWZmZXJlbnQgcGVyc2lzdGVudAogICAgICogYXR0cmlidXRlIG5hbWUgZm9y\nIHRoZSBiYWNraW5nIGZpZWxkIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICov\nCiAgICBwcml2YXRlIFN0cmluZyBmcm9tQmFja2luZ0ZpZWxkTmFtZShTdHJp\nbmcgbmFtZSkgewogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkKICAgICAgICAgICAg\nJiYgX2ZpZWxkc1RvQXR0cnMuY29udGFpbnNLZXkobmFtZSkpCiAgICAgICAg\nICAgIG5hbWUgPSAoU3RyaW5nKSBfZmllbGRzVG9BdHRycy5nZXQobmFtZSk7\nCiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nbXBsZW1lbnQgdGhlIGV4dGVybmFsaXphYmxlIGludGVyZmFjZSB0byBkZXRh\nY2ggb24gc2VyaWFsaXplLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAog\nICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBlbnN1cmUgdGhh\ndCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBjb25zdHJ1Y3RvciBpcyBwdWJsaWMg\nCiAgICAgICAgLy8gZm9yIGV4dGVybmFsaXphdGlvbgogICAgICAgIEJDTWV0\naG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIjxpbml0PiIsIChT\ndHJpbmdbXSkgbnVsbCk7CiAgICAgICAgaWYgKCFtZXRoLmlzUHVibGljKCkp\nIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLWRlZmNv\nbnMtZXh0ZXJuIiwgCiAgICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSkpOwogICAgICAgICAgICBtZXRoLm1ha2VQdWJsaWMoKTsK\nICAgICAgICB9CiAgICAgICAgLy8gZGVjbGFyZSBleHRlcm5hbGl6YWJsZSBp\nbnRlcmZhY2UKICAgICAgICBpZiAoIUV4dGVybmFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAg\nICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoRXh0ZXJuYWxpemFibGUu\nY2xhc3MpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHVzZXIgZG9lc24n\ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4dGVybmFsaXphdGlvbiBvcgogICAg\nICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0aG9kcwogICAgICAgIENsYXNzW10g\naW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3Mg\nfTsKICAgICAgICBDbGFzc1tdIG91dHB1dCA9IG5ldyBDbGFzc1tdeyBPYmpl\nY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBpZiAoX21hbmFnZWRU\neXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2JqZWN0IiwgaW5wdXQpICE9\nIG51bGwKICAgICAgICAgICAgfHwgX21hbmFnZWRUeXBlLmdldERlY2xhcmVk\nTWV0aG9kKCJ3cml0ZU9iamVjdCIsIG91dHB1dCkgIT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImRldGFj\naC1jdXN0b20tc2VyIiwgX21ldGEpKTsKICAgICAgICBpbnB1dFswXSA9IE9i\namVjdElucHV0LmNsYXNzOwogICAgICAgIG91dHB1dFswXSA9IE9iamVjdE91\ndHB1dC5jbGFzczsKICAgICAgICBpZiAoX21hbmFnZWRUeXBlLmdldERlY2xh\ncmVkTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCBpbnB1dCkgIT0gbnVsbAogICAg\nICAgICAgICB8fCBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoIndy\naXRlRXh0ZXJuYWwiLCBvdXRwdXQpICE9IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZXRhY2gtY3VzdG9t\nLWV4dGVybiIsIF9tZXRhKSk7CgogICAgICAgIC8vIGNyZWF0ZSBsaXN0IG9m\nIGFsbCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxkcwogICAgICAgIEJD\nRmllbGRbXSBmaWVsZHMgPSBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRGaWVs\nZHMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVubWdkID0gbmV3IEFycmF5TGlz\ndChmaWVsZHMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIWZpZWxk\nc1tpXS5pc1RyYW5zaWVudCgpICYmICFmaWVsZHNbaV0uaXNTdGF0aWMoKQog\nICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5pc0ZpbmFsKCkKICAgICAg\nICAgICAgICAgICYmICFmaWVsZHNbaV0uZ2V0TmFtZSgpLnN0YXJ0c1dpdGgo\nUFJFKQogICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0RGVjbGFyZWRGaWVs\nZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBh\nZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJsZSwgZGV0YWNoZWRTdGF0\nZSk7CiAgICAgICAgYWRkUmVhZFVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0\nYWNoYWJsZSk7CiAgICAgICAgYWRkV3JpdGVFeHRlcm5hbChwYXJlbnREZXRh\nY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAgICBhZGRXcml0ZVVubWFu\nYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRFeHRlcm5hbCBtZXRob2QuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkRXh0ZXJuYWwoYm9vbGVhbiBw\nYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0\nZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1\ndC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFy\nZU1ldGhvZCgicmVhZEV4dGVybmFsIiwgdm9pZC5jbGFzcywgaW5hcmdzKTsK\nICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0aW9u\ncyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKENsYXNz\nTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIucmVhZEV4\ndGVybmFsIChpbik7CiAgICAgICAgQ2xhc3Mgc3VwID0gX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBpZiAoIXBh\ncmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChzdXAsICJyZWFkRXh0ZXJuYWwiLAogICAgICAgICAgICAg\nICAgdm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAgICB9CgogICAgICAgIC8v\nIHJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKGdldFR5cGUoX21ldGEpLAogICAgICAgICAgICBQUkUgKyAiUmVhZFVubWFu\nYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJncyk7CgogICAgICAgIGlmIChkZXRh\nY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIHBjU2V0RGV0YWNoZWRTdGF0\nZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAicmVhZE9iamVj\ndCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsg\nIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKCiAgICAgICAgICAg\nIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoKFN0YXRlTWFuYWdlcikgaW4u\ncmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAicmVhZE9iamVjdCIsCiAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3RhdGVNYW5hZ2VyLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKFBSRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdGF0ZU1hbmFnZXIuY2xhc3Mg\nfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFkIG1hbmFnZWQgZmllbGRz\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVs\nZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1RyYW5zaWVudCgp\nKQogICAgICAgICAgICAgICAgcmVhZEV4dGVybmFsKGNvZGUsIGZtZHNbaV0u\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxkcyBmcm9tIHRoZSBzdHJlYW0gKHBj\nUmVhZFVubWFuYWdlZCkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRS\nZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xlYW4gcGFyZW50\nRGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFzc1tdeyBP\nYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVhZFVubWFuYWdlZCIsIHZvaWQu\nY2xhc3MsCiAgICAgICAgICAgIGluYXJncyk7CiAgICAgICAgbWV0aC5tYWtl\nUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRo\nLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2Vw\ndGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZXhjZXBzLmFkZEV4\nY2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8v\nIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBpZiAocGFyZW50\nRGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiUmVhZFVubWFuYWdlZCIsIHZv\naWQuY2xhc3MsIAogICAgICAgICAgICAgICAgaW5hcmdzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHJlYWQgZGVjbGFyZWQgdW5tYW5hZ2VkIHNlcmlhbGl6\nYWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVsZCkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgcmVhZEV4dGVybmFsKGNvZGUsIGZpZWxkLmdl\ndE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgpLCBudWxsKTsKICAgICAgICB9CiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHJlYWQg\nYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFsaXphdGlvbiBpbnB1dCBzdHJlYW0u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFkRXh0ZXJuYWwoQ29kZSBj\nb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsKICAgICAgICBp\nZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAgIG1ldGhOYW1l\nID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gQ2hh\ncmFjdGVyLnRvVXBwZXJDYXNlKG1ldGhOYW1lLmNoYXJBdCgwKSkKICAgICAg\nICAgICAgICAgICsgbWV0aE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgICAg\nICBtZXRoTmFtZSA9ICJyZWFkIiArIG1ldGhOYW1lOwogICAgICAgIH0gZWxz\nZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFkT2JqZWN0IjsKCiAgICAg\nICAgLy8gPGZpZWxkPiA9IGluLnJlYWQ8dHlwZT4gKCk7CiAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIENsYXNzIHJldCA9ICh0eXBl\nLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVjdC5jbGFzczsKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RJbnB1\ndC5jbGFzcywgbWV0aE5hbWUsCiAgICAgICAgICAgIHJldCwgbnVsbCk7CiAg\nICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmpl\nY3QuY2xhc3MpCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZSh0eXBlKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAg\nIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZpZWxkTmFtZSwgdHlwZSk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgZm1kKTsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgICAgICAgICAg\nLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgLy8gICBz\nbS5wcm94eURldGFjaGVkRGVzZXJpYWxpemVkICg8aW5kZXg+KTsKICAgICAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAgICAgICAgSWZJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBFLAogICAgICAg\nICAgICAgICAgICAgICAgICAicHJveHlEZXRhY2hlZERlc2VyaWFsaXplZCIs\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGN1c3RvbSB3cml0ZUV4dGVy\nbmFsIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFdyaXRl\nRXh0ZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJv\nb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIG91dGFyZ3MgPSBuZXcg\nQ2xhc3NbXXsgT2JqZWN0T3V0cHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRo\nb2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZUV4dGVybmFsIiwg\ndm9pZC5jbGFzcywgb3V0YXJncyk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNl\ncHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBz\nLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBl\nci53cml0ZUV4dGVybmFsIChvdXQpOwogICAgICAgIENsYXNzIHN1cCA9IGdl\ndFR5cGUoX21ldGEpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBpZiAoIXBh\ncmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChzdXAsICJ3cml0ZUV4dGVybmFsIiwKICAgICAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gd3JpdGVVbm1hbmFnZWQgKG91dCk7CiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChnZXRUeXBlKF9tZXRhKSwKICAgICAgICAgICAgUFJFICsgIldyaXRl\nVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgb3V0YXJncyk7CgogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiBnbzIgPSBudWxsOwogICAgICAgIGlmIChkZXRhY2hl\nZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAg\nICAgICAgICAvLyAgIGlmIChzbS53cml0ZURldGFjaGVkIChvdXQpKQogICAg\nICAgICAgICAvLyAgICAgIHJldHVybjsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgSWZJ\nbnN0cnVjdGlvbiBpZm51bGwgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgIndy\naXRlRGV0YWNoZWQiLAogICAgICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywg\nb3V0YXJncyk7CiAgICAgICAgICAgIGdvMiA9IGNvZGUuaWZlcSgpOwogICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIC8vIGVsc2UK\nICAgICAgICAgICAgLy8gICBvdXQud3JpdGVPYmplY3QgKHBjR2V0RGV0YWNo\nZWRTdGF0ZSAoKSk7CiAgICAgICAgICAgIENsYXNzW10gb2JqYXJncyA9IG5l\ndyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfTsKICAgICAgICAgICAgaWZudWxs\nLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCkpOwogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJH\nZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywKICAgICAgICAgICAgICAg\nICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9iamFyZ3MpOwogICAgICAg\nICAgICAvLyAgICBvdXQud3JpdGVPYmplY3QgKG51bGwpIC8vIFN0YXRlTWFu\nYWdlcgogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoT2JqZWN0KSBu\ndWxsKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNzLAogICAgICAgICAgICAgICAgIndy\naXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgb2JqYXJncyk7CiAgICAgICAgfQog\nICAgICAgIGlmIChnbzIgIT0gbnVsbCkKICAgICAgICAgICAgZ28yLnNldFRh\ncmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgLy8gd3JpdGUgbWFuYWdlZCBm\naWVsZHMKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzVHJhbnNp\nZW50KCkpCiAgICAgICAgICAgICAgICB3cml0ZUV4dGVybmFsKGNvZGUsIGZt\nZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAgICAvLyByZXR1\ncm4KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHVubWFuYWdlZCBm\naWVsZHMgdG8gdGhlIHN0cmVhbSAocGNXcml0ZVVubWFuYWdlZCkuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZVVubWFuYWdlZChDb2xsZWN0\naW9uIHVubWdkLCBib29sZWFuIHBhcmVudERldGFjaGFibGUpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3Nb\nXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVjdE91dHB1dC5jbGFzcyB9\nOwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLAogICAgICAgICAg\nICBvdXRhcmdzKTsKICAgICAgICBtZXRoLm1ha2VQcm90ZWN0ZWQoKTsKICAg\nICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0aW9ucyh0\ncnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhjZXB0aW9u\nLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlVW5tYW5hZ2VkIChvdXQpOwog\nICAgICAgIGlmIChwYXJlbnREZXRhY2hhYmxlKSB7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAg\nICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSksIFBSRSArICJX\ncml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAgICAg\nb3V0YXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyB3cml0ZSBkZWNsYXJl\nZCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxkcwogICAgICAgIEJDRmll\nbGQgZmllbGQ7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB1bm1nZC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBmaWVs\nZCA9IChCQ0ZpZWxkKSBpdHIubmV4dCgpOwogICAgICAgICAgICB3cml0ZUV4\ndGVybmFsKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgp\nLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRvIHdyaXRlIGEgZmllbGQgdG8gYW4gZXh0ZXJuYWxp\nemF0aW9uIG91dHB1dCBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB3cml0ZUV4dGVybmFsKENvZGUgY29kZSwgU3RyaW5nIGZpZWxkTmFtZSwg\nQ2xhc3MgdHlwZSwKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJp\nbmcgbWV0aE5hbWU7CiAgICAgICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSkg\newogICAgICAgICAgICBtZXRoTmFtZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAg\nICAgICAgICBtZXRoTmFtZSA9IENoYXJhY3Rlci50b1VwcGVyQ2FzZShtZXRo\nTmFtZS5jaGFyQXQoMCkpCiAgICAgICAgICAgICAgICArIG1ldGhOYW1lLnN1\nYnN0cmluZygxKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSAid3JpdGUiICsg\nbWV0aE5hbWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIG1ldGhOYW1l\nID0gIndyaXRlT2JqZWN0IjsKCiAgICAgICAgLy8gb3V0LndyaXRlPHR5cGU+\nICg8ZmllbGQ+KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBnZXRmaWVsZChj\nb2RlLCBudWxsLCBmaWVsZE5hbWUpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAg\nIENsYXNzW10gYXJncyA9IG5ldyBDbGFzc1tdeyB0eXBlIH07CiAgICAgICAg\naWYgKHR5cGUgPT0gYnl0ZS5jbGFzcyB8fCB0eXBlID09IGNoYXIuY2xhc3Mg\nfHwgdHlwZSA9PSBzaG9ydC5jbGFzcykKICAgICAgICAgICAgYXJnc1swXSA9\nIGludC5jbGFzczsKICAgICAgICBlbHNlIGlmICghdHlwZS5pc1ByaW1pdGl2\nZSgpKQogICAgICAgICAgICBhcmdzWzBdID0gT2JqZWN0LmNsYXNzOwogICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91\ndHB1dC5jbGFzcywgbWV0aE5hbWUsCiAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIGFyZ3MpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgYWRk\nR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQsIHRydWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogTG9hZCB0aGUgZmllbGQgdmFsdWUgc3BlY2lmaWVk\nIGJ5IDxjb2RlPmZtZDwvY29kZT4gb250byB0aGUgc3RhY2suCiAgICAgKiBC\nZWZvcmUgdGhpcyBtZXRob2QgaXMgY2FsbGVkLCB0aGUgb2JqZWN0IHRoYXQg\ndGhlIGRhdGEgc2hvdWxkIGJlIGxvYWRlZAogICAgICogZnJvbSB3aWxsIGJl\nIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrLgogICAgICoKICAgICAqIEBwYXJh\nbSBmcm9tU2FtZUNsYXNzIGlmIDxjb2RlPnRydWU8L2NvZGU+LCB0aGVuIDxj\nb2RlPmZtZDwvY29kZT4gaXMKICAgICAqIGJlaW5nIGxvYWRlZCBmcm9tIGFu\nIGluc3RhbmNlIG9mIHRoZSBzYW1lIGNsYXNzIGFzIHRoZSBjdXJyZW50IGV4\nZWN1dGlvbgogICAgICogY29udGV4dC4gSWYgPGNvZGU+ZmFsc2U8L2NvZGU+\nLCB0aGVuIHRoZSBpbnN0YW5jZSBvbiB0aGUgdG9wIG9mIHRoZSBzdGFjawog\nICAgICogbWlnaHQgYmUgYSBzdXBlcmNsYXNzIG9mIHRoZSBjdXJyZW50IGV4\nZWN1dGlvbiBjb250ZXh0J3MgJ3RoaXMnIGluc3RhbmNlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShDb2RlIGNv\nZGUsIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIGJvb2xlYW4gZnJvbVNh\nbWVDbGFzcykKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICAvLyBpZiByZWRlZmluaW5nLCB0aGVuIHdlIG11c3QgYWx3\nYXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0aGUgZmllbGQKICAgICAgICAvLyBk\naXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwgc2luY2UgdGhlIHJlZGVmaW5lZCBt\nZXRob2RzIHdpbGwgYWx3YXlzCiAgICAgICAgLy8gdHJpZ2dlciBtZXRob2Qg\nY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBldmVuIGZyb20gaW50ZXJuYWwgZGly\nZWN0LQogICAgICAgIC8vIGFjY2VzcyB1c2FnZS4gV2UgY291bGQgd29yayBh\ncm91bmQgdGhpcyBieSBub3QgcmVkZWZpbmluZywgYW5kCiAgICAgICAgLy8g\nanVzdCBkbyBhIHN1YmNsYXNzIGFwcHJvYWNoIGluc3RlYWQuIEJ1dCB0aGlz\nIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAogICAgICAgIC8vIHNpbmNlIGl0IHdv\ndWxkIHNhY3JpZmljZSBsYXp5IGxvYWRpbmcgYW5kIGVmZmljaWVudCBkaXJ0\neSB0cmFja2luZy4KCiAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkKICAgICAg\nICAgICAgfHwgX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUs\nIG51bGwsIGZtZC5nZXROYW1lKCkpOwogICAgICAgIH0gZWxzZSBpZiAoZ2V0\nQ3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAvLyBwcm9wZXJ0eSBh\nY2Nlc3MsIGFuZCB3ZSdyZSBub3QgcmVkZWZpbmluZy4gSWYgd2UncmUgb3Bl\ncmF0aW5nCiAgICAgICAgICAgIC8vIG9uIGFuIGluc3RhbmNlIHRoYXQgaXMg\nZGVmaW5pdGVseSB0aGUgc2FtZSB0eXBlIGFzICd0aGlzJywgdGhlbgogICAg\nICAgICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0\ncmFja2luZy4gT3RoZXJ3aXNlLCByZWZsZWN0CiAgICAgICAgICAgIC8vIHRv\nIGJvdGggYnlwYXNzIHRyYWNraW5nIGFuZCBhdm9pZCBjbGFzcyB2ZXJpZmlj\nYXRpb24gZXJyb3JzLgogICAgICAgICAgICBpZiAoZnJvbVNhbWVDbGFzcykg\newogICAgICAgICAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQu\nZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzcGVjaWFsKCkuc2V0TWV0aG9kKG1ldGgpOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZm1k\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2VtZW50ICsgcHJvcGVydHkg\nYWNjZXNzCiAgICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1k\nLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArIG1ldGguZ2V0TmFtZSgpLAogICAg\nICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0UGFy\nYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU3RvcmUgdGhlIHZhbHVlIGF0IHRoZSB0b3Agb2YgdGhlIHN0YWNrIGlu\ndG8gdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZAogICAgICogYnkgPGNvZGU+\nZm1kPC9jb2RlPi4gQmVmb3JlIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhl\nIGRhdGEgdG8gbG9hZCB3aWxsCiAgICAgKiBiZSBvbiB0aGUgdG9wIG9mIHRo\nZSBzdGFjayBhbmQgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRhIHNob3VsZCBi\nZSBsb2FkZWQKICAgICAqIGludG8gd2lsbCBiZSBzZWNvbmQgaW4gdGhlIHN0\nYWNrLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2V0TWFuYWdlZFZh\nbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGlm\nIHJlZGVmaW5pbmcsIHRoZW4gd2UgbXVzdCBhbHdheXMgcmVmbGVjdCAob3Ig\nYWNjZXNzIHRoZSBmaWVsZAogICAgICAgIC8vIGRpcmVjdGx5IGlmIGFjY2Vz\nc2libGUpLCBzaW5jZSB0aGUgcmVkZWZpbmVkIG1ldGhvZHMgd2lsbCBhbHdh\neXMKICAgICAgICAvLyB0cmlnZ2VyIG1ldGhvZCBjYWxscyB0byBTdGF0ZU1h\nbmFnZXIsIGV2ZW4gZnJvbSBpbnRlcm5hbCBkaXJlY3QtCiAgICAgICAgLy8g\nYWNjZXNzIHVzYWdlLiBXZSBjb3VsZCB3b3JrIGFyb3VuZCB0aGlzIGJ5IG5v\ndCByZWRlZmluaW5nLCBhbmQKICAgICAgICAvLyBqdXN0IGRvIGEgc3ViY2xh\nc3MgYXBwcm9hY2ggaW5zdGVhZC4gQnV0IHRoaXMgaXMgbm90IGEgZ29vZCBv\ncHRpb24sCiAgICAgICAgLy8gc2luY2UgaXQgd291bGQgc2FjcmlmaWNlIGxh\nenkgbG9hZGluZyBhbmQgZWZmaWNpZW50IGRpcnR5IHRyYWNraW5nLgoKICAg\nICAgICBpZiAoZ2V0UmVkZWZpbmUoKQogICAgICAgICAgICB8fCBfbWV0YS5n\nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQp\nIHsKICAgICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVsbCwgZm1kLmdldE5h\nbWUoKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICB9IGVsc2Ug\naWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJv\ncGVydHkgYWNjZXNzLCBhbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIGludm9r\nZSB0aGUKICAgICAgICAgICAgLy8gc3VwZXJjbGFzcyBtZXRob2QgdG8gYnlw\nYXNzIHRyYWNraW5nLgogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwKICAgICAgICAg\nICAgICAgIGdldFNldHRlck5hbWUoZm1kKSwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdIHsgZm1kLmdldERlY2xhcmVkVHlwZSgp\nIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHJlZ3VsYXIg\nZW5oYW5jZW1lbnQgKyBwcm9wZXJ0eSBhY2Nlc3MKICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArIGdldFNldHRlck5h\nbWUoZm1kKSwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdIHsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgb2Zmc2V0IHRoYXQgdGhl\nIGZpcnN0IG1lYW5pbmdmdWwgYWNjZXNzb3IgcGFyYW1ldGVyIGlzIGF0Lgog\nICAgICovCiAgICBwcml2YXRlIGludCBnZXRBY2Nlc3NvclBhcmFtZXRlck9m\nZnNldCgpIHsKICAgICAgICByZXR1cm4gKF9tZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgPyAxIDogMDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUge0BsaW5rIEluc3RydWN0aW9u\nfXMgdG8gbG9hZCB0aGUgaW5zdGFuY2UgdG8gbW9kaWZ5IG9udG8gdGhlCiAg\nICAgKiBzdGFjaywgYW5kIHJldHVybiBpdC4gSWYgPGNvZGU+Zm9yU3RhdGlj\nPC9jb2RlPiBpcyBzZXQsIHRoZW4KICAgICAqIDxjb2RlPmNvZGU8L2NvZGU+\nIGlzIGluIGFuIGFjY2Vzc29yIG1ldGhvZCBvciBhbm90aGVyIHN0YXRpYyBt\nZXRob2Q7CiAgICAgKiBvdGhlcndpc2UsIGl0IGlzIGluIG9uZSBvZiB0aGUg\nUEMtc3BlY2lmaWVkIG1ldGhvZHMuCiAgICAgKgogICAgICogQHJldHVybiB0\naGUgZmlyc3QgaW5zdHJ1Y3Rpb24gYWRkZWQgdG8gPGNvZGU+Y29kZTwvY29k\nZT4uCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24gbG9hZE1hbmFn\nZWRJbnN0YW5jZShDb2RlIGNvZGUsIGJvb2xlYW4gZm9yU3RhdGljKSB7CiAg\nICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLkFDQ0VTU19GSUVMRCAmJiBmb3JTdGF0aWMpCiAgICAgICAgICAgIHJl\ndHVybiBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgcmV0dXJu\nIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgdGhlIGdlbmVyYXRlZCBnZXR0ZXIge0BsaW5rIEJDTWV0aG9k\nfSBmb3IgPGNvZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5nIGVu\ndmlyb25tZW50IHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdzIGNv\nZGUgYmxvY2suCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3JlYXRl\nR2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNNZXRo\nb2QgZ2V0dGVyOwogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAg\nLy8gc3RhdGljIDxmaWVsZHR5cGU+IHBjR2V0PGZpZWxkPiAoWFhYIGluc3Qp\nCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVjbGFyZWRG\naWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZ2V0dGVyID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldCIgKyBmbWQuZ2V0TmFtZSgpLCBm\nbWQuCiAgICAgICAgICAgICAgICBnZXREZWNsYXJlZFR5cGUoKS5nZXROYW1l\nKCksIG5ldyBTdHJpbmdbXXsgX3BjLmdldE5hbWUoKSB9KTsKICAgICAgICAg\nICAgZ2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdz\nKCkKICAgICAgICAgICAgICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJBTlNJ\nRU5UICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAgICAg\nICBnZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAgICAgICAgICBnZXR0ZXIu\nc2V0RmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBnZXR0ZXI7CiAg\nICAgICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAgICAg\nLy8gY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcgbmFt\nZTsgd2UgY2FuJ3QganVzdCByZXNldAogICAgICAgIC8vIHRoZSBuYW1lLCBi\nZWNhdXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0aGUg\nbWV0aG9kCiAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0\nQmFja2luZ01lbWJlcigpOwogICAgICAgIGdldHRlciA9IF9wYy5nZXREZWNs\nYXJlZE1ldGhvZChtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgbWV0aC5n\nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBCQ01ldGhvZCBuZXdnZXR0\nZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwK\nICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0UGFy\nYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgbmV3Z2V0dGVyLnNldEFjY2Vzc0Zs\nYWdzKGdldHRlci5nZXRBY2Nlc3NGbGFncygpKTsKICAgICAgICBuZXdnZXR0\nZXIubWFrZVByb3RlY3RlZCgpOyAKICAgICAgICB0cmFuc2ZlckNvZGVBdHRy\naWJ1dGVzKGdldHRlciwgbmV3Z2V0dGVyKTsKICAgICAgICByZXR1cm4gZ2V0\ndGVyOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBnZW5lcmF0\nZWQgc2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxjb2RlPmZtZDwvY29k\nZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVudCB3aWxsIHRoZW4g\ncG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2NrLgogICAgICovCiAg\nICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZVNldE1ldGhvZChGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIHNldHRlcjsKICAgICAgICBp\nZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIC8vIHN0YXRpYyB2b2lkIHBjU2V0\nPGZpZWxkPiAoWFhYIGluc3QsIDxmaWVsZHR5cGU+IHZhbHVlKQogICAgICAg\nICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVkRmllbGQoZm1k\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHNldHRlciA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJTZXQiICsgZm1kLmdldE5hbWUoKSwgdm9pZC5jbGFz\ncywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBnZXRUeXBlKF9tZXRh\nKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICBzZXR0\nZXIuc2V0QWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNjZXNzRmxhZ3MoKQogICAg\nICAgICAgICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VTU19UUkFOU0lFTlQgJiB+\nQ29uc3RhbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAgICAgICAgICAgIHNldHRl\nci5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgIHNldHRlci5zZXRGaW5h\nbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHNldHRlcjsKICAgICAgICB9\nCgogICAgICAgIC8vIHByb3BlcnR5IGFjY2VzczoKICAgICAgICAvLyBjb3B5\nIHRoZSB1c2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBhIG5ldyBuYW1lOyB3ZSBj\nYW4ndCBqdXN0IHJlc2V0CiAgICAgICAgLy8gdGhlIG5hbWUsIGJlY2F1c2Ug\ndGhhdCB3aWxsIGFsc28gcmVzZXQgYWxsIGNhbGxzIHRvIHRoZSBtZXRob2QK\nICAgICAgICBzZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoZ2V0U2V0\ndGVyTmFtZShmbWQpLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZm1kLmdl\ndERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIEJDTWV0aG9kIG5ld3NldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArIHNldHRlci5nZXROYW1lKCks\nCiAgICAgICAgICAgIHNldHRlci5nZXRSZXR1cm5OYW1lKCksIHNldHRlci5n\nZXRQYXJhbU5hbWVzKCkpOwogICAgICAgIG5ld3NldHRlci5zZXRBY2Nlc3NG\nbGFncyhzZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7CiAgICAgICAgbmV3c2V0\ndGVyLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICB0cmFuc2ZlckNvZGVBdHRy\naWJ1dGVzKHNldHRlciwgbmV3c2V0dGVyKTsKICAgICAgICByZXR1cm4gc2V0\ndGVyOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRFbmhhbmNlbWVu\ndENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpIHsKICAgICAgICAvLyBwdWJsaWMg\naW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9uKCkKICAgICAgICBC\nQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAKICAg\nICAgICAgICAgICAgICJHZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbiIs\nIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoRU5IQU5DRVJfVkVS\nU0lPTik7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNv\nbmNyZXRlIHR5cGUgZm9yIHRoZSBnaXZlbiBjbGFzcywgaS5lLiBpbXBsIGZv\nciBtYW5hZ2VkCiAgICAgKiBpbnRlcmZhY2VzCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzcyBnZXRUeXBlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGlmIChtZXRhLmdldEludGVyZmFjZUltcGwoKSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbWV0YS5nZXRJbnRlcmZhY2VJbXBsKCk7CiAgICAgICAg\ncmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogTW92ZSBjb2RlLXJlbGF0ZWQgYXR0cmlidXRlcyBmcm9tIG9u\nZSBtZXRob2QgdG8gYW5vdGhlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgdm9pZCB0cmFuc2ZlckNvZGVBdHRyaWJ1dGVzKEJDTWV0aG9kIGZyb20s\nIEJDTWV0aG9kIHRvKSB7CiAgICAgICAgQ29kZSBjb2RlID0gZnJvbS5nZXRD\nb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIHRvLmFkZEF0dHJpYnV0ZShjb2RlKTsKICAgICAgICAgICAgZnJv\nbS5yZW1vdmVDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBFeGNlcHRpb25z\nIGV4Y2VwcyA9IGZyb20uZ2V0RXhjZXB0aW9ucyhmYWxzZSk7CiAgICAgICAg\naWYgKGV4Y2VwcyAhPSBudWxsKQogICAgICAgICAgICB0by5hZGRBdHRyaWJ1\ndGUoZXhjZXBzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVzYWdlOiBqYXZh\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDRW5oYW5jZXIgW29wdGlv\nbl0qCiAgICAgKiAmbHQ7Y2xhc3MgbmFtZSB8IC5qYXZhIGZpbGUgfCAuY2xh\nc3MgZmlsZSB8IC5qZG8gZmlsZSZndDsrCiAgICAgKiAgV2hlcmUgdGhlIGZv\nbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVkLgogICAgICogPHVsPgog\nICAgICogPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZsdDtwcm9wZXJ0aWVzIGZp\nbGUmZ3Q7PC9pPjogVGhlIHBhdGggdG8gYSBPcGVuSlBBCiAgICAgKiBwcm9w\nZXJ0aWVzIGZpbGUgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhcyBvdXRsaW5l\nZCBpbgogICAgICoge0BsaW5rIENvbmZpZ3VyYXRpb259OyBvcHRpb25hbC48\nL2xpPgogICAgICogPGxpPjxpPi0mbHQ7cHJvcGVydHkgbmFtZSZndDsgJmx0\nO3Byb3BlcnR5IHZhbHVlJmd0OzwvaT46IEFsbCBiZWFuCiAgICAgKiBwcm9w\nZXJ0aWVzIG9mIHRoZSBzdGFuZGFyZCBPcGVuSlBBIHtAbGluayBPcGVuSlBB\nQ29uZmlndXJhdGlvbn0gY2FuIGJlCiAgICAgKiBzZXQgYnkgdXNpbmcgdGhl\naXIgbmFtZXMgYW5kIHN1cHBseWluZyBhIHZhbHVlOyBmb3IgZXhhbXBsZToK\nICAgICAqIDxsaT48aT4tZGlyZWN0b3J5Ly1kICZsdDtidWlsZCBkaXJlY3Rv\ncnkmZ3Q7PC9pPjogVGhlIHBhdGggdG8gdGhlIGJhc2UKICAgICAqIGRpcmVj\ndG9yeSB3aGVyZSBlbmhhbmNlZCBjbGFzc2VzIGFyZSBzdG9yZWQuIEJ5IGRl\nZmF1bHQsIHRoZQogICAgICogZW5oYW5jZXIgb3ZlcndyaXRlcyB0aGUgb3Jp\nZ2luYWwgLmNsYXNzIGZpbGUgd2l0aCB0aGUgZW5oYW5jZWQKICAgICAqIHZl\ncnNpb24uIFVzZSB0aGlzIG9wdGlvbiB0byBzdG9yZSB0aGUgZ2VuZXJhdGVk\nIC5jbGFzcyBmaWxlIGluCiAgICAgKiBhbm90aGVyIGRpcmVjdG9yeS4gVGhl\nIHBhY2thZ2Ugc3RydWN0dXJlIHdpbGwgYmUgY3JlYXRlZCBiZW5lYXRoCiAg\nICAgKiB0aGUgZ2l2ZW4gZGlyZWN0b3J5LjwvbGk+CiAgICAgKiA8bGk+PGk+\nLWFkZERlZmF1bHRDb25zdHJ1Y3Rvci8tYWRjIFt0cnVlL3QgfCBmYWxzZS9m\nXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGFkZCBhIGRlZmF1bHQgY29uc3Ry\ndWN0b3IgdG8gcGVyc2lzdGVudCBjbGFzc2VzIG1pc3Npbmcgb25lLCBhcwog\nICAgICogb3Bwb3NlZCB0byB0aHJvd2luZyBhbiBleGNlcHRpb24uIERlZmF1\nbHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48aT4tdG1wQ2xhc3NMb2Fk\nZXIvLXRjbCBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+OiBXaGV0aGVyIHRvCiAg\nICAgKiBsb2FkIHRoZSBwcmUtZW5oYW5jZWQgY2xhc3NlcyB1c2luZyBhIHRl\nbXBvcmFyeSBjbGFzcyBsb2FkZXIuCiAgICAgKiBEZWZhdWx0cyB0byB0cnVl\nLiBTZXQgdGhpcyB0byBmYWxzZSB3aGVuIGF0dGVtcHRpbmcgdG8gZGVidWcK\nICAgICAqIGNsYXNzIGxvYWRpbmcgZXJyb3JzLjwvbGk+CiAgICAgKiA8bGk+\nPGk+LWVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucy8tZXByIFt0cnVlL3Qg\nfCBmYWxzZS9mXTwvaT46CiAgICAgKiBXaGV0aGVyIHRvIHRocm93IGFuIGV4\nY2VwdGlvbiBpZiBhIFBST1BFUlRZIGFjY2VzcyBlbnRpdHkgYXBwZWFycwog\nICAgICogdG8gYmUgdmlvbGF0aW5nIHN0YW5kYXJkIHByb3BlcnR5IHJlc3Ry\naWN0aW9ucy4gRGVmYXVsdHMgdG8gZmFsc2UuPC9saT4KICAgICAqIDwvdWw+\nCiAgICAgKiAgRWFjaCBhZGRpdGlvbmFsIGFyZ3VtZW50IGNhbiBiZSBlaXRo\nZXIgdGhlIGZ1bGwgY2xhc3MgbmFtZSBvZiB0aGUKICAgICAqIHR5cGUgdG8g\nZW5oYW5jZSwgdGhlIHBhdGggdG8gdGhlIC5qYXZhIGZpbGUgZm9yIHRoZSB0\neXBlLCB0aGUgcGF0aCB0bwogICAgICogdGhlIC5jbGFzcyBmaWxlIGZvciB0\naGUgdHlwZSwgb3IgdGhlIHBhdGggdG8gYSAuamRvIGZpbGUgbGlzdGluZyBv\nbmUKICAgICAqIG9yIG1vcmUgdHlwZXMgdG8gZW5oYW5jZS4KICAgICAqIElm\nIHRoZSB0eXBlIGJlaW5nIGVuaGFuY2VkIGhhcyBtZXRhZGF0YSwgaXQgd2ls\nbCBiZSBlbmhhbmNlZCBhcyBhCiAgICAgKiBwZXJzaXN0ZW5jZSBjYXBhYmxl\nIGNsYXNzLiBJZiBub3QsIGl0IHdpbGwgYmUgY29uc2lkZXJlZCBhIHBlcnNp\nc3RlbmNlCiAgICAgKiBhd2FyZSBjbGFzcywgYW5kIGFsbCBhY2Nlc3MgdG8g\nZmllbGRzIG9mIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3NlcwogICAgICog\nd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYXBwcm9wcmlhdGUJZ2V0L3NldCBt\nZXRob2QuIElmIHRoZSB0eXBlCiAgICAgKiBleHBsaWNpdGx5IGRlY2xhcmVz\nIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGludGVyZmFjZSwgaXQgd2lsbAog\nICAgICogbm90IGJlIGVuaGFuY2VkLiBUaHVzLCBpdCBpcyBzYWZlIHRvIGlu\ndm9rZSB0aGUgZW5oYW5jZXIgb24gY2xhc3NlcwogICAgICogdGhhdCBhcmUg\nYWxyZWFkeSBlbmhhbmNlZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2\nb2lkIG1haW4oU3RyaW5nW10gYXJncykKICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7\nCiAgICAgICAgYXJncyA9IG9wdHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAg\nICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBPcGVuSlBB\nQ29uZmlndXJhdGlvbkltcGwoKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoIXJ1bihjb25mLCBhcmdzLCBvcHRzKSkKICAgICAgICAgICAgICAg\nIFN5c3RlbS5lcnIucHJpbnRsbihfbG9jLmdldCgiZW5oYW5jZS11c2FnZSIp\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjb25mLmNsb3Nl\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUnVuIHRoZSB0\nb29sLiBSZXR1cm5zIGZhbHNlIGlmIGludmFsaWQgb3B0aW9ucyBnaXZlbi4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAgIE9w\ndGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIGlmIChvcHRzLmNvbnRhaW5zS2V5KCJoZWxwIikgfHwgb3B0cy5jb250\nYWluc0tleSgiLWhlbHAiKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICBGbGFncyBmbGFncyA9IG5ldyBGbGFncygpOwogICAgICAgIGZs\nYWdzLmRpcmVjdG9yeSA9IEZpbGVzLmdldEZpbGUob3B0cy5yZW1vdmVQcm9w\nZXJ0eSgiZGlyZWN0b3J5IiwgImQiLAogICAgICAgICAgICBudWxsKSwgbnVs\nbCk7CiAgICAgICAgZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJhZGREZWZh\ndWx0Q29uc3RydWN0b3IiLCAiYWRjIiwgZmxhZ3MuYWRkRGVmYXVsdENvbnN0\ncnVjdG9yKTsKICAgICAgICBmbGFncy50bXBDbGFzc0xvYWRlciA9IG9wdHMu\ncmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgidG1wQ2xhc3NM\nb2FkZXIiLCAidGNsIiwgZmxhZ3MudG1wQ2xhc3NMb2FkZXIpOwogICAgICAg\nIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IG9wdHMucmVt\nb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiZW5mb3JjZVByb3Bl\ncnR5UmVzdHJpY3Rpb25zIiwgImVwciIsCiAgICAgICAgICAgICAgICBmbGFn\ncy5lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMpOwoKICAgICAgICBDb25m\naWd1cmF0aW9ucy5wb3B1bGF0ZUNvbmZpZ3VyYXRpb24oY29uZiwgb3B0cyk7\nCiAgICAgICAgcmV0dXJuIHJ1bihjb25mLCBhcmdzLCBmbGFncywgbnVsbCwg\nbnVsbCwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmhhbmNlIHRo\nZSBnaXZlbiBjbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJv\nb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIFN0cmluZ1td\nIGFyZ3MsCiAgICAgICAgRmxhZ3MgZmxhZ3MsIE1ldGFEYXRhUmVwb3NpdG9y\neSByZXBvcywgQnl0ZWNvZGVXcml0ZXIgd3JpdGVyLAogICAgICAgIENsYXNz\nTG9hZGVyIGxvYWRlcikKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGlmIChsb2FkZXIgPT0gbnVsbCkKICAgICAgICAgICAgbG9hZGVy\nID0gY29uZi5nZXRDbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4KICAgICAgICAg\nICAgICAgIGdldENsYXNzTG9hZGVyKFBDRW5oYW5jZXIuY2xhc3MsIG51bGwp\nOwogICAgICAgIGlmIChmbGFncy50bXBDbGFzc0xvYWRlcikKICAgICAgICAg\nICAgbG9hZGVyID0gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgLm5l\nd1RlbXBvcmFyeUNsYXNzTG9hZGVyQWN0aW9uKGxvYWRlcikpOwoKICAgICAg\nICBpZiAocmVwb3MgPT0gbnVsbCkgewogICAgICAgICAgICByZXBvcyA9IGNv\nbmYubmV3TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAg\nICAgcmVwb3Muc2V0U291cmNlTW9kZShNZXRhRGF0YVJlcG9zaXRvcnkuTU9E\nRV9NRVRBKTsKICAgICAgICB9CgogICAgICAgIExvZyBsb2cgPSBjb25mLmdl\ndExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfVE9PTCk7CiAgICAgICAg\nQ29sbGVjdGlvbiBjbGFzc2VzOwogICAgICAgIGlmIChhcmdzLmxlbmd0aCA9\nPSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJydW5uaW5n\nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAgICBjbGFzc2VzID0gcmVwb3Mu\nZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVlLCBsb2FkZXIpOwogICAgICAg\nICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7CiAgICAgICAgICAgIAlsb2cu\nd2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8tZW5oYW5jZSIpKTsKICAgICAg\nICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJnUGFyc2VyIGNhcCA9IGNvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAg\nICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5ld0NsYXNzQXJnUGFyc2VyKCk7\nCiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xvYWRlcihsb2FkZXIpOwogICAg\nICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChjYXAucGFy\nc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAgIH0KICAgICAgICAKICAgICAg\nICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgpOwogICAgICAgIEJD\nQ2xhc3MgYmM7CiAgICAgICAgUENFbmhhbmNlciBlbmhhbmNlcjsKICAgICAg\nICBpbnQgc3RhdHVzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2xh\nc3Nlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBPYmplY3QgbyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShf\nbG9jLmdldCgiZW5oYW5jZS1ydW5uaW5nIiwgbykpOwoKICAgICAgICAgICAg\naWYgKG8gaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICBiYyA9\nIHByb2plY3QubG9hZENsYXNzKChTdHJpbmcpIG8pOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBiYyA9IHByb2plY3QubG9hZENsYXNzKChD\nbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5j\nZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAo\nd3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBlbmhhbmNlci5zZXRC\neXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAgICAgICAgICBlbmhhbmNlci5z\nZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAgICAgICAgICAgZW5o\nYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGZsYWdzLmFkZERlZmF1\nbHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0YXR1cyA9IGVuaGFuY2Vy\nLnJ1bigpOwogICAgICAgICAgICBpZiAoc3RhdHVzID09IEVOSEFOQ0VfTk9O\nRSkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5o\nYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMg\nPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAgICAgICAgICAgICAgIGlmIChs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cu\ndHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50ZXJmYWNlIikpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0FXQVJFKSB7CiAg\nICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLWF3\nYXJlIikpOwogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVj\nb3JkKCk7CiAgICAgICAgICAgIHByb2plY3QuY2xlYXIoKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\ndW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRmxh\nZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3RvcnkgPSBudWxsOwog\nICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRDb25zdHJ1Y3RvciA9\nIHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1wQ2xhc3NMb2FkZXIg\nPSB0cnVlOwoJCXB1YmxpYyBib29sZWFuIGVuZm9yY2VQcm9wZXJ0eVJlc3Ry\naWN0aW9ucyA9IGZhbHNlOwoJfQoKCS8qKgogCSAqIFBsdWdpbiBpbnRlcmZh\nY2UgZm9yIGFkZGl0aW9uYWwgZW5oYW5jZW1lbnQuCgkgKi8KCXB1YmxpYyBz\ndGF0aWMgaW50ZXJmYWNlIEF1eGlsaWFyeUVuaGFuY2VyCgl7CgkJcHVibGlj\nIHZvaWQgcnVuIChCQ0NsYXNzIGJjLCBDbGFzc01ldGFEYXRhIG1ldGEpOwoJ\nCXB1YmxpYyBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9kIG0pOwoJfQp9\nCg==\n","encoding":"base64"}

