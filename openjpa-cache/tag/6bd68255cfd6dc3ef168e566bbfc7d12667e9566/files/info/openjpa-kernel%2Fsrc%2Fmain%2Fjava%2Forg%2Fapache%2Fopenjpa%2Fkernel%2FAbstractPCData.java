{"sha":"6bf11e427db04f10173d18d8a292375a7ae31ff8","node_id":"MDQ6QmxvYjIwNjM2NDo2YmYxMWU0MjdkYjA0ZjEwMTczZDE4ZDhhMjkyMzc1YTdhZTMxZmY4","size":14884,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6bf11e427db04f10173d18d8a292375a7ae31ff8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsKCi8qKgogKiBBYnN0\ncmFjdCBiYXNlIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgY29yZSBQQ0RhdGEg\nYmVoYXZpb3IuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0\ncmFjdCBjbGFzcyBBYnN0cmFjdFBDRGF0YQogICAgaW1wbGVtZW50cyBQQ0Rh\ndGEgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBu\nZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Rb\nXSBFTVBUWV9BUlJBWSA9IG5ldyBPYmplY3RbMF07CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGxvYWRlZCBmaWVsZCBtYXNrLgogICAgICovCiAgICBw\ndWJsaWMgYWJzdHJhY3QgQml0U2V0IGdldExvYWRlZCgpOwoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHBjZGF0YSBmb3IgaG9sZGluZyB0aGUgc3Rh\ndGUgb2YgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBhYnN0cmFjdCBBYnN0cmFjdFBDRGF0YSBuZXdFbWJlZGRlZFBDRGF0YShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtKTsKCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0xvYWRlZChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0TG9hZGVk\nKCkuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9y\nbSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSBpbnRvIGl0cyBmaWVsZCB2YWx1ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0ZpZWxkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIE9i\namVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgUHJveHlEYXRhTGlzdCBjID0g\nKFByb3h5RGF0YUxpc3QpIGRhdGE7CiAgICAgICAgICAgICAgICBDb2xsZWN0\naW9uIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgICAgICAgICAgYzIgPSB0b05lc3RlZEZpZWxk\ncyhzbSwgZm1kLmdldEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIGRhdGEsCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAg\nICAgICAgaWYgKGMyIGluc3RhbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAg\nICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94eSkgYzIpLmdldENo\nYW5nZVRyYWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY3Quc2V0TmV4dFNlcXVl\nbmNlKGMubmV4dFNlcXVlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgTWFwIG0gPSAoTWFwKSBkYXRhOwog\nICAgICAgICAgICAgICAgTWFwIG0yID0gKE1hcCkgc20ubmV3RmllbGRQcm94\neShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGtleXMgPSBuZXcgQXJyYXlMaXN0IChtLnNpemUoKSk7CgogICAgICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBtaSA9IG0uZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBtaS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIGtleXMu\nYWRkKG1pLm5leHQoKSk7CgogICAgICAgICAgICAgICAgT2JqZWN0W10ga2V5\nQXJyYXkgPSBrZXlzLnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgIE9iamVj\ndFtdIHZhbHVlcyA9IHRvTmVzdGVkRmllbGRzKHNtLCBmbWQuZ2V0RWxlbWVu\ndCgpLAogICAgICAgICAgICAgICAgICAgIGtleXMsIGZldGNoLCBjb250ZXh0\nKS50b0FycmF5KCk7CiAgICAgICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgbWkgPSBtLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsgbWkuaGFzTmV4dCgpOyBpZHgrKykKICAgICAgICAgICAg\nICAgICAgICBtMi5wdXQoa2V5QXJyYXlbaWR4XSwgdmFsdWVzW2lkeF0pOwoK\nICAgICAgICAgICAgICAgIHJldHVybiBtMjsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpbnQgbGVuZ3RoID0g\nQXJyYXkuZ2V0TGVuZ3RoKGRhdGEpOwogICAgICAgICAgICAgICAgT2JqZWN0\nIGEgPSBBcnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgpLmdldERl\nY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGxlbmd0aCk7CiAg\nICAgICAgICAgICAgICBpZiAobGVuZ3RoID09IDApCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGE7CgogICAgICAgICAgICAgICAgaWYgKGlzSW1tdXRh\nYmxlVHlwZShmbWQuZ2V0RWxlbWVudCgpKSkgewogICAgICAgICAgICAgICAg\nICAgIFN5c3RlbS5hcnJheWNvcHkoZGF0YSwgMCwgYSwgMCwgbGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgICAgICAgICBBcnJheS5zZXQoYSwgaSwgdG9OZXN0ZWRGaWVsZChz\nbSwgZm1kLmdldEVsZW1lbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIEFycmF5LmdldChkYXRhLCBpKSwgZmV0Y2gsIGNvbnRleHQpKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICByZXR1cm4gYTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHJldHVybiB0b05lc3RlZEZpZWxkKHNtLCBmbWQsIGRhdGEs\nIGZldGNoLCBjb250ZXh0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUcmFuc2Zvcm0gdGhlIGdpdmVuIGRhdGEgdmFsdWUgdG8gaXRzIGZp\nZWxkIHZhbHVlLiBUaGUgZGF0YSB2YWx1ZQogICAgICogbWF5IGJlIGEga2V5\nLCB2YWx1ZSwgb3IgZWxlbWVudCBvZiBhIG1hcCBvciBjb2xsZWN0aW9uLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvTmVzdGVkRmllbGQoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgVmFsdWVNZXRhRGF0YSB2bWQsCiAgICAg\nICAgT2JqZWN0IGRhdGEsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgc3dpdGNoICh2bWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRBVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gKChEYXRlKSBkYXRh\nKS5jbG9uZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gKExvY2FsZSkgZGF0YTsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAo\ndm1kLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ndG9FbWJlZGRlZEZpZWxkKHNtLCB2bWQsIGRhdGEsIGZldGNoLCBjb250ZXh0\nKTsKICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBPYmpl\nY3QgcmV0ID0KICAgICAgICAgICAgICAgICAgICB0b1JlbGF0aW9uRmllbGQo\nc20sIHZtZCwgZGF0YSwgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAgICAg\nICAgaWYgKHJldCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiByZXQ7CiAgICAgICAgICAgICAgICBPcnBoYW5lZEtleUFjdGlvbiBhY3Rp\nb24gPSBzbS5nZXRDb250ZXh0KCkuZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICAgICAgICAgIGdldE9ycGhhbmVkS2V5QWN0aW9uSW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24ub3JwaGFuKGRhdGEs\nIHNtLCB2bWQpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVHJhbnNmb3JtIHRoZSBnaXZlbiBkYXRhIHZhbHVlIHRvIGl0cyBmaWVs\nZCB2YWx1ZS4gVGhlIGRhdGEgdmFsdWUKICAgICAqIG1heSBiZSBhIGtleSwg\ndmFsdWUsIG9yIGVsZW1lbnQgb2YgYSBtYXAgb3IgY29sbGVjdGlvbi4KICAg\nICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gdG9OZXN0ZWRGaWVsZHMo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgCiAgICAgICAgVmFsdWVNZXRhRGF0\nYSB2bWQsIENvbGxlY3Rpb24gZGF0YSwgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgaWYgKGRh\ndGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIENvbGxlY3Rpb24gcmV0ID0gbmV3IEFycmF5TGlzdChkYXRhLnNpemUoKSk7\nCiAgICAgICAgc3dpdGNoICh2bWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0cj1kYXRhLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIHJldC5hZGQoKChEYXRl\nKWl0ci5uZXh0KCkpLmNsb25lKCkpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHJldDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHI9ZGF0YS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICByZXQuYWRk\nKChMb2NhbGUpIGl0ci5uZXh0KCkpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHJldDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAg\nICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0cj1kYXRhLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgICAgICByZXQuYWRkKHRv\nRW1iZWRkZWRGaWVsZChzbSwgdm1kLCBpdHIubmV4dCgpLCBmZXRjaAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLCBjb250ZXh0KSk7CiAgICAgICAg\nICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgT2JqZWN0W10gciA9IHRv\nUmVsYXRpb25GaWVsZHMoc20sIGRhdGEsIGZldGNoKTsKICAgICAgICAgICAg\nICAgIGlmIChyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChyW2ldICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZXQuYWRkKHJbaV0pOwogICAgICAgICAgICAgICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LmFk\nZChzbS5nZXRDb250ZXh0KCkuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZ2V0T3JwaGFuZWRLZXlBY3Rpb25J\nbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Jw\naGFuKGRhdGEsIHNtLCB2bWQpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZGF0YTsKICAgICAgICB9CiAgICB9CgogICAgCiAgICAvKioKICAg\nICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZGF0YSBpbnRvIGEgcmVsYXRpb24g\nZmllbGQgdmFsdWUuIERlZmF1bHQKICAgICAqIGltcGxlbWVudGF0aW9uIGFz\nc3VtZXMgdGhlIGRhdGEgaXMgYW4gb2lkLgogICAgICovCiAgICBwcm90ZWN0\nZWQgT2JqZWN0IHRvUmVsYXRpb25GaWVsZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBWYWx1ZU1ldGFEYXRhIHZtZCwKICAgICAgICBPYmplY3QgZGF0YSwg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4dCkgewog\nICAgICAgIHJldHVybiBzbS5nZXRDb250ZXh0KCkuZmluZChkYXRhLCBmZXRj\naCwgbnVsbCwgbnVsbCwgMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFu\nc2Zvcm0gdGhlIGdpdmVuIGRhdGEgaW50byByZWxhdGlvbiBmaWVsZCB2YWx1\nZXMuIERlZmF1bHQKICAgICAqIGltcGxlbWVudGF0aW9uIGFzc3VtZXMgdGhl\nIGRhdGEgaXMgYW4gb2lkLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0\nW10gdG9SZWxhdGlvbkZpZWxkcyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAog\nICAgICAgIE9iamVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gp\nIHsKICAgICAgICByZXR1cm4gc20uZ2V0Q29udGV4dCgpLmZpbmRBbGwoKENv\nbGxlY3Rpb24pIGRhdGEsIGZldGNoLCBudWxsLCBudWxsLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZGF0YSBpbnRv\nIGFuIGVtYmVkZGVkIFBDIGZpZWxkIHZhbHVlLiBEZWZhdWx0CiAgICAgKiBp\nbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZSBkYXRhIGlzIGFuIHtAbGluayBB\nYnN0cmFjdFBDRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3Qg\ndG9FbWJlZGRlZEZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFZhbHVl\nTWV0YURhdGEgdm1kLAogICAgICAgIE9iamVjdCBkYXRhLCBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgQWJz\ndHJhY3RQQ0RhdGEgcGNkYXRhID0gKEFic3RyYWN0UENEYXRhKSBkYXRhOwog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW1iZWRkZWQgPSBzbS5nZXRD\nb250ZXh0KCkuZW1iZWQobnVsbCwKICAgICAgICAgICAgcGNkYXRhLmdldElk\nKCksIHNtLCB2bWQpOwogICAgICAgIHBjZGF0YS5sb2FkKGVtYmVkZGVkLCAo\nQml0U2V0KSBwY2RhdGEuZ2V0TG9hZGVkKCkuY2xvbmUoKSwKICAgICAgICAg\nICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgIHJldHVybiBlbWJlZGRlZC5n\nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRy\nYW5zZm9ybSB0aGUgZ2l2ZW4gZmllbGQgdmFsdWUgdG8gYSBkYXRhIHZhbHVl\nIGZvciBjYWNoaW5nLiBSZXR1cm4KICAgICAqIHtAbGluayAjTlVMTH0gaWYg\ndW5hYmxlIHRvIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0\nIHRvRGF0YShGaWVsZE1ldGFEYXRhIGZtZCwgT2JqZWN0IHZhbCwgU3RvcmVD\nb250ZXh0IGN0eCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0g\nKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICAgICAgICAgIGlmIChjLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJveHlEYXRhTGlz\ndC5FTVBUWV9MSVNUOwogICAgICAgICAgICAgICAgUHJveHlEYXRhTGlzdCBj\nMiA9IG51bGw7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZTsKICAgICAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgY2kgPSBjLml0ZXJhdG9yKCk7IGNpLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSB0b05lc3Rl\nZERhdGEoZm1kLmdldEVsZW1lbnQoKSwgY2kubmV4dCgpLCBjdHgpOwogICAg\nICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gTlVMTCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGMyID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2l6\nZSA9IGMuc2l6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjMiA9IG5l\ndyBQcm94eURhdGFMaXN0KHNpemUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoYyBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94eSkgYykuZ2V0\nQ2hhbmdlVHJhY2tlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYzIubmV4dFNlcXVlbmNlID0gY3QuZ2V0TmV4dFNlcXVlbmNlKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYzIubmV4dFNlcXVlbmNlID0gc2l6ZTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYzIuYWRkKHZhbCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYzI7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIE1hcCBtID0gKE1hcCkgdmFsOwogICAgICAgICAgICAgICAgaWYgKG0u\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0\naW9ucy5FTVBUWV9NQVA7CiAgICAgICAgICAgICAgICBNYXAgbTIgPSBudWxs\nOwogICAgICAgICAgICAgICAgTWFwLkVudHJ5IGU7CiAgICAgICAgICAgICAg\nICBPYmplY3QgdmFsMjsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\nbWkgPSBtLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgbWkuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgICAgIGUgPSAoTWFwLkVudHJ5KSBtaS5uZXh0\nKCk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gdG9OZXN0ZWREYXRhKGZt\nZC5nZXRLZXkoKSwgZS5nZXRLZXkoKSwgY3R4KTsKICAgICAgICAgICAgICAg\nICAgICBpZiAodmFsID09IE5VTEwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBOVUxMOwogICAgICAgICAgICAgICAgICAgIHZhbDIgPSB0b05l\nc3RlZERhdGEoZm1kLmdldEVsZW1lbnQoKSwgZS5nZXRWYWx1ZSgpLCBjdHgp\nOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwyID09IE5VTEwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICAgICAg\nICAgICAgIGlmIChtMiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBtMiA9IG5ldyBIYXNoTWFwKG0uc2l6ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBtMi5wdXQodmFsLCB2YWwyKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHJldHVybiBtMjsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpbnQgbGVuZ3RoID0gQXJy\nYXkuZ2V0TGVuZ3RoKHZhbCk7CiAgICAgICAgICAgICAgICBpZiAobGVuZ3Ro\nID09IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0FSUkFZ\nOwoKICAgICAgICAgICAgICAgIE9iamVjdCBhOwogICAgICAgICAgICAgICAg\naWYgKGlzSW1tdXRhYmxlVHlwZShmbWQuZ2V0RWxlbWVudCgpKSkgewogICAg\nICAgICAgICAgICAgICAgIGEgPSBBcnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0\nRWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0u\nYXJyYXljb3B5KHZhbCwgMCwgYSwgMCwgbGVuZ3RoKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0W10gZGF0\nYSA9IG5ldyBPYmplY3RbbGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGRhdGFbaV0gPSB0b05lc3RlZERhdGEoZm1kLmdldEVs\nZW1lbnQoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBcnJheS5n\nZXQodmFsLCBpKSwgY3R4KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgYSA9IGRhdGE7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIHJldHVybiB0b05lc3RlZERhdGEoZm1kLCB2YWws\nIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHdoZXRoZXIgdGhlIGRlY2xhcmVkIHR5cGUgb2YgdGhlIGdpdmVuIHZhbHVl\nIGlzIGltbXV0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlz\nSW1tdXRhYmxlVHlwZShWYWx1ZU1ldGFEYXRhIGVsZW1lbnQpIHsKICAgICAg\nICBzd2l0Y2ggKGVsZW1lbnQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nSE9SVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lN\nQUw6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm0gdGhlIGdpdmVuIG5lc3Rl\nZCB2YWx1ZSB0byBhIGNhY2hhYmxlIHZhbHVlLiBSZXR1cm4KICAgICAqIHtA\nbGluayAjTlVMTH0gaWYgdGhlIHZhbHVlIGNhbm5vdCBiZSBjYWNoZWQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9OZXN0ZWREYXRhKFZhbHVl\nTWV0YURhdGEgdm1kLCBPYmplY3QgdmFsLAogICAgICAgIFN0b3JlQ29udGV4\ndCBjdHgpIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBzd2l0Y2ggKHZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6\nCiAgICAgICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWQoKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gdG9FbWJlZGRlZERhdGEodmFsLCBjdHgp\nOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgIHJldHVy\nbiB0b1JlbGF0aW9uRGF0YSh2YWwsIGN0eCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3Rh\nbmNlb2YgUHJveHkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoUHJv\neHkpIHZhbCkuY29weSh2YWwpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIHZhbCkuY2xvbmUoKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIChMb2NhbGUpIHZhbDsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0\nYW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKFBy\nb3h5KSB2YWwpLmNvcHkodmFsKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIHRvIGNhY2hl\nIGZvciB0aGUgZ2l2ZW4gb2JqZWN0LiBDYWNoZXMgaXRzIG9pZCBieQogICAg\nICogZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b1Jl\nbGF0aW9uRGF0YShPYmplY3QgdmFsLCBTdG9yZUNvbnRleHQgY3R4KSB7CiAg\nICAgICAgcmV0dXJuIGN0eC5nZXRPYmplY3RJZCh2YWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSB0byBjYWNoZSBmb3IgdGhl\nIGdpdmVuIGVtYmVkZGVkIFBDLiBDYWNoZXMgYQogICAgICoge0BsaW5rIFBD\nRGF0YX0gZnJvbSB7QGxpbmsgI25ld0VtYmVkZGVkUENEYXRhfSBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvRW1iZWRkZWRE\nYXRhKE9iamVjdCB2YWwsIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBp\nZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBOVUxMOwoKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gY3R4LmdldFN0YXRlTWFu\nYWdlcih2YWwpOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gTlVMTDsKCiAgICAgICAgLy8gaGF2ZSB0byBjYWNoZSBhbGwg\nZGF0YSwgc28gbWFrZSBzdXJlIGl0J3MgYWxsIGxvYWRlZAogICAgICAgIC8v\nICMjIyBwcmV2ZW50IGxvYWRpbmcgb2YgdGhpbmdzIHRoYXQgYXJlbid0IGNh\nY2hlZCAobG9icywgbHJzLCBldGMpCiAgICAgICAgY3R4LnJldHJpZXZlKHZh\nbCwgZmFsc2UsIG51bGwpOwoKICAgICAgICBQQ0RhdGEgcGNkYXRhID0gbmV3\nRW1iZWRkZWRQQ0RhdGEoc20pOwogICAgICAgIHBjZGF0YS5zdG9yZShzbSk7\nCiAgICAgICAgcmV0dXJuIHBjZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRyYWNrcyBwcm94eSBkYXRhIGFsb25nIHdpdGggbGlzdCBlbGVtZW50cy4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJveHlEYXRhTGlz\ndAogICAgICAgIGV4dGVuZHMgQXJyYXlMaXN0IHsKCiAgICAgICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBQcm94eURhdGFMaXN0IEVNUFRZX0xJU1QgPSBuZXcg\nUHJveHlEYXRhTGlzdCgwKTsKCiAgICAgICAgcHVibGljIGludCBuZXh0U2Vx\ndWVuY2UgPSAwOwoKICAgICAgICBwdWJsaWMgUHJveHlEYXRhTGlzdChpbnQg\nc2l6ZSkgewoJCQlzdXBlciAoc2l6ZSk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

