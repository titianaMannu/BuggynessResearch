{"sha":"f81f6609526a647e36a38b8f5a02006165f1ce29","node_id":"MDQ6QmxvYjIwNjM2NDpmODFmNjYwOTUyNmE2NDdlMzZhMzhiOGY1YTAyMDA2MTY1ZjFjZTI5","size":165780,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f81f6609526a647e36a38b8f5a02006165f1ce29","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xs\nZXI7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7\nCmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TeW5jaHJvbml6YXRpb247Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9y\ncy5JdGVyYXRvckNoYWluOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNv\nbGxlY3Rpb25zLm1hcC5JZGVudGl0eU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5Db21wYXRpYmlsaXR5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkRhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5h\nZ2VkUnVudGltZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNl\nLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlv\nbkV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5z\nYWN0aW9uRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNl\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVu\nY2VNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29u\nY3VycmVudC5SZWVudHJhbnRMb2NrOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRT\ndGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk5vVHJhbnNhY3Rpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5PYmplY3RFeGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1l\nRXhjZXB0aW9uVHJhbnNsYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIENvbmNy\nZXRlIHtAbGluayBCcm9rZXJ9LiBUaGUgYnJva2VyIGhhbmRsZXMgb2JqZWN0\nLWxldmVsIGJlaGF2aW9yLAogKiBidXQgbGVhdmVzIGFsbCBpbnRlcmFjdGlv\nbiB3aXRoIHRoZSBkYXRhIHN0b3JlIHRvIGEge0BsaW5rIFN0b3JlTWFuYWdl\ncn0KICogdGhhdCBtdXN0IGJlIHN1cHBsaWVkIGF0IGluaXRpYWxpemF0aW9u\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIEJy\nb2tlckltcGwKICAgIGltcGxlbWVudHMgQnJva2VyLCBGaW5kQ2FsbGJhY2tz\nLCBDbG9uZWFibGUgewoKICAgIC8qKgogICAgICogSW5jcmVtZW50YWwgZmx1\nc2guCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZM\nVVNIX0lOQyA9IDA7CgogICAgLyoqCiAgICAgKiBGbHVzaCBpbiBwcmVwYXJh\ndGlvbiBvZiBjb21taXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgaW50IEZMVVNIX0NPTU1JVCA9IDE7CgogICAgLyoqCiAgICAgKiBG\nbHVzaCB0byBjaGVjayBjb25zaXN0ZW5jeSBvZiBjYWNoZSwgdGhlbiBpbW1l\nZGlhdGVseSByb2xsYmFjayBjaGFuZ2VzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9ST0xMQkFDSyA9IDI7CgogICAg\nLyoqCiAgICAgKiBSdW4gcGVyc2lzdGVuY2UtYnktcmVhY2hhYmlsaXR5IGFu\nZCBvdGhlciBmbHVzaC10aW1lIG9wZXJhdGlvbnMgd2l0aG91dAogICAgICog\nYWNjZXNzaW5nIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfTE9HSUNBTCA9IDM7CgogICAgc3Rh\ndGljIGZpbmFsIGludCBTVEFUVVNfSU5JVCA9IDA7CiAgICBzdGF0aWMgZmlu\nYWwgaW50IFNUQVRVU19UUkFOU0lFTlQgPSAxOwogICAgc3RhdGljIGZpbmFs\nIGludCBTVEFUVVNfT0lEX0FTU0lHTiA9IDI7CiAgICBzdGF0aWMgZmluYWwg\naW50IFNUQVRVU19DT01NSVRfTkVXID0gMzsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19BQ1RJVkUgPSAyIDw8IDA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9BQ1RJVkUgPSAyIDw8IDE7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19DTE9TRV9JTlZP\nS0VEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFU1RPUklORyA9IDIgPDwgMzsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0RFUkVGREVMRVRJTkcgPSAyIDw8IDQ7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSElORyA9IDIgPDwgNTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0ZMVVNI\nSU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfRkxVU0hFRCA9IDIgPDwgNzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8PCA4OwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVNT1RFX0xJU1RFTkVSID0gMiA8\nPCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVUQUlO\nRURfQ09OTiA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDExOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBMb2NhbGl6\nZXIuZm9yUGFja2FnZShCcm9rZXJJbXBsLmNsYXNzKTsKCiAgICAvLwl0aGUg\nc3RvcmUgbWFuYWdlciBpbiB1c2U7IHRoaXMgbWF5IGJlIGEgZGVjb3JhdG9y\nIHN1Y2ggYXMgYQogICAgLy8JZGF0YSBjYWNoZSBzdG9yZSBtYW5hZ2VyIGFy\nb3VuZCB0aGUgbmF0aXZlIHN0b3JlIG1hbmFnZXIKICAgIHByaXZhdGUgRGVs\nZWdhdGluZ1N0b3JlTWFuYWdlciBfc3RvcmUgPSBudWxsOwoKICAgIC8vIHJl\nZiB0byBwcm9kdWNpbmcgZmFjdG9yeSBhbmQgY29uZmlndXJhdGlvbgogICAg\ncHJpdmF0ZSBBYnN0cmFjdEJyb2tlckZhY3RvcnkgX2ZhY3RvcnkgPSBudWxs\nOwogICAgcHJpdmF0ZSBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9IG51\nbGw7CiAgICBwcml2YXRlIENvbXBhdGliaWxpdHkgX2NvbXBhdCA9IG51bGw7\nCiAgICBwcml2YXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMgPSBudWxsOwog\nICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CiAgICBwcml2YXRlIFN0cmlu\nZyBfdXNlciA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFzcyA9IG51\nbGw7CiAgICBwcml2YXRlIE1hbmFnZWRSdW50aW1lIF9ydW50aW1lID0gbnVs\nbDsKICAgIHByaXZhdGUgTG9ja01hbmFnZXIgX2xtID0gbnVsbDsKICAgIHBy\naXZhdGUgSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsKICAgIHByaXZhdGUg\nUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7CiAgICBwcml2YXRlIE9wQ2Fs\nbGJhY2tzIF9jYWxsID0gbnVsbDsKICAgIHByaXZhdGUgUnVudGltZUV4Y2Vw\ndGlvblRyYW5zbGF0b3IgX2V4dHJhbnMgPSBudWxsOwoKICAgIC8vIGNhY2hl\nIGNsYXNzIGxvYWRlciBhc3NvY2lhdGVkIHdpdGggdGhlIGJyb2tlcgogICAg\ncHJpdmF0ZSBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsKCiAgICAvLyB1\nc2VyIHN0YXRlCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlvbiBfc3luYyA9\nIG51bGw7CiAgICBwcml2YXRlIE1hcCBfdXNlck9iamVjdHMgPSBudWxsOwoK\nICAgIC8vIG1hbmFnZWQgb2JqZWN0IGNhY2hlcwogICAgcHJpdmF0ZSBNYW5h\nZ2VkQ2FjaGUgX2NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgVHJhbnNhY3Rp\nb25hbENhY2hlIF90cmFuc0NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0\nIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVy\nZWZDYWNoZSA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVyZWZBZGRpdGlv\nbnMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2xvYWRpbmcgPSBudWxsOwog\nICAgcHJpdmF0ZSBTZXQgX29wZXJhdGluZyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldCBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBf\ndXBkYXRlZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX2RlbGV0ZWRD\nbHNzID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZW5kaW5nID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAgLy8gdHJh\nY2sgaW5zdGFuY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwgYWZ0ZXIg\ndGhlIGZpcnN0IHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRo\nZSB0cmFuc2FjdGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQgX3NhdmVw\nb2ludENhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2VkTWFwIF9zYXZl\ncG9pbnRzID0gbnVsbDsKICAgIHByaXZhdGUgU2F2ZXBvaW50TWFuYWdlciBf\nc3BtID0gbnVsbDsKCiAgICAvLyB0cmFjayBvcGVuIHF1ZXJpZXMgYW5kIGV4\ndGVudHMgc28gd2UgY2FuIGZyZWUgdGhlaXIgcmVzb3VyY2VzIG9uIGNsb3Nl\nCiAgICBwcml2YXRlIFJlZmVyZW5jZUhhc2hTZXQgX3F1ZXJpZXMgPSBudWxs\nOwogICAgcHJpdmF0ZSBSZWZlcmVuY2VIYXNoU2V0IF9leHRlbnRzID0gbnVs\nbDsKCiAgICAvLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVwdGgKICAgIHBy\naXZhdGUgaW50IF9vcGVyYXRpb25Db3VudCA9IDA7CgogICAgLy8gb3B0aW9u\ncwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1JlYWQgPSBmYWxzZTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfbm9udHJhbnNXcml0ZSA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9yZXRhaW5TdGF0ZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBpbnQgX2F1dG9DbGVhciA9IENMRUFSX0RBVEFTVE9SRTsKICAg\nIHByaXZhdGUgaW50IF9yZXN0b3JlU3RhdGUgPSBSRVNUT1JFX0lNTVVUQUJM\nRTsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3B0aW1pc3RpYyA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9pZ25vcmVDaGFuZ2VzID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX211bHRpdGhyZWFkZWQgPSBmYWxzZTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfbWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zeW5jTWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBp\nbnQgX2Nvbm5SZXRhaW5Nb2RlID0gQ09OTl9SRVRBSU5fREVNQU5EOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9ldmljdERhdGFDYWNoZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9wb3B1bGF0ZURhdGFDYWNoZSA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2xhcmdlVHJhbnNhY3Rpb24gPSBmYWxzZTsK\nICAgIHByaXZhdGUgaW50IF9hdXRvRGV0YWNoID0gMDsKICAgIHByaXZhdGUg\naW50IF9kZXRhY2hTdGF0ZSA9IERFVEFDSF9MT0FERUQ7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2RldGFjaGVkTmV3ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfb3JkZXJEaXJ0eSA9IGZhbHNlOwoKICAgIC8vIHN0YXR1cwogICAg\ncHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nY2xvc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIFJ1bnRpbWVFeGNlcHRpb24g\nX2Nsb3NlZEV4Y2VwdGlvbiA9IG51bGw7CgogICAgLy8gZXZlbnQgbWFuYWdl\ncnMKICAgIHByaXZhdGUgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIgX3RyYW5z\nRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF90cmFuc0Nh\nbGxiYWNrTW9kZSA9IDA7CiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFu\nYWdlciBfbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfbGlmZUNhbGxiYWNrTW9kZSA9IDA7CgogICAgcHJpdmF0ZSBib29sZWFu\nIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNUUyA9IG5ldyBPYmpl\nY3RbMF07CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHBlcnNpc3RlbmNlIG1h\nbmFnZXIncyBhdXRoZW50aWNhdGlvbi4gVGhpcyBpcyB0aGUgZmlyc3QKICAg\nICAqIG1ldGhvZCBjYWxsZWQgYWZ0ZXIgY29uc3RydWN0aW9uLgogICAgICoK\nICAgICAqIEBwYXJhbSB1c2VyIHRoZSB1c2VybmFtZSB0aGlzIGJyb2tlciBy\nZXByZXNlbnRzOyB1c2VkIHdoZW4gcG9vbGluZwogICAgICogYnJva2VycyB0\nbyBtYWtlIHN1cmUgdGhhdCBhIHJlcXVlc3QgdG8gdGhlIGZhY3RvcnkgZm9y\nCiAgICAgKiBhIGNvbm5lY3Rpb24gd2l0aCBhbiBleHBsaWNpdCB1c2VyIGlz\nIGRlbGVnYXRlZCB0byBhIHN1aXRhYmxlIGJyb2tlcgogICAgICogQHBhcmFt\nIHBhc3MgdGhlIHBhc3N3b3JkIGZvciB0aGUgYWJvdmUgdXNlcgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRoZW50aWNhdGlvbihTdHJpbmcgdXNl\nciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBfdXNlciA9IHVzZXI7CiAgICAg\nICAgX3Bhc3MgPSBwYXNzOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlh\nbGl6ZSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlci4gVGhpcyBtZXRob2QgaXMg\nY2FsbGVkCiAgICAgKiBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBmYWN0b3J5IGJl\nZm9yZSB1c2UuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhlIGZh\nY3RvcnkgdXNlZCB0byBjcmVhdGUgdGhpcyBicm9rZXIKICAgICAqIEBwYXJh\nbSBzbSBhIGNvbmNyZXRlIFN0b3JlTWFuYWdlciBpbXBsZW1lbnRhdGlvbiB0\nbwogICAgICogaGFuZGxlIGludGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3Rv\ncmUKICAgICAqIEBwYXJhbSBtYW5hZ2VkIHRoZSB0cmFuc2FjdGlvbiBtb2Rl\nCiAgICAgKiBAcGFyYW0gY29ubk1vZGUgdGhlIGNvbm5lY3Rpb24gcmV0YWlu\nIG1vZGUKICAgICAqLwogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZShBYnN0\ncmFjdEJyb2tlckZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBEZWxlZ2F0aW5n\nU3RvcmVNYW5hZ2VyIHNtLCBib29sZWFuIG1hbmFnZWQsIGludCBjb25uTW9k\nZSkgewogICAgICAgIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IHRydWU7CiAg\nICAgICAgX2xvYWRlciA9IChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdl\ndENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKTsKICAgICAgICBfY29uZiA9\nIGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIF9jb21wYXQg\nPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKTsKICAgICAgICBf\nZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAgICAgX2xvZyA9IF9jb25mLmdldExv\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSk7CiAgICAgICAg\nX2NhY2hlID0gbmV3IE1hbmFnZWRDYWNoZShuZXdNYW5hZ2VkT2JqZWN0Q2Fj\naGUoKSk7CiAgICAgICAgX29wZXJhdGluZyA9IE1hcEJhY2tlZFNldC5kZWNv\ncmF0ZShuZXcgSWRlbnRpdHlNYXAoKSk7CiAgICAgICAgX2Nvbm5SZXRhaW5N\nb2RlID0gY29ubk1vZGU7CiAgICAgICAgX21hbmFnZWQgPSBtYW5hZ2VkOwog\nICAgICAgIGlmIChtYW5hZ2VkKQogICAgICAgICAgICBfcnVudGltZSA9IF9j\nb25mLmdldE1hbmFnZWRSdW50aW1lSW5zdGFuY2UoKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9ydW50aW1lID0gbmV3IExvY2FsTWFuYWdlZFJ1bnRp\nbWUodGhpcyk7CgogICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbmV3IExp\nZmVjeWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAgIF90cmFuc0V2ZW50TWFu\nYWdlciA9IG5ldyBUcmFuc2FjdGlvbkV2ZW50TWFuYWdlcigpOwogICAgICAg\nIGludCBjbW9kZSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERl\nZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAgICAgICAgc2V0TGlmZWN5\nY2xlTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwogICAgICAgIHNldFRy\nYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwoKICAgICAg\nICAvLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMKICAgICAgICBfZmFjdG9yeS5j\nb25maWd1cmVCcm9rZXIodGhpcyk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0\nbyBkbyB0aGlzIGFmdGVyIGNvbmZpZ3VyaW5nIGJyb2tlciBzbyB0aGF0IHN0\nb3JlIG1hbmFnZXIKICAgICAgICAvLyBjYW4gbG9vayB0byBicm9rZXIgY29u\nZmlndXJhdGlvbjsgd2Ugc2V0IGJvdGggc3RvcmUgYW5kIGxvY2sgbWFuYWdl\ncnMKICAgICAgICAvLyBiZWZvcmUgaW5pdGlhbGl6aW5nIHRoZW0gYmVjYXVz\nZSB0aGV5IG1heSBlYWNoIHRyeSB0byBhY2Nlc3MgdGhlCiAgICAgICAgLy8g\nb3RoZXIgaW4gdGhpZXIgaW5pdGlhbGl6YXRpb24KICAgICAgICBfc3RvcmUg\nPSBzbTsKICAgICAgICBfbG0gPSBfY29uZi5uZXdMb2NrTWFuYWdlckluc3Rh\nbmNlKCk7CiAgICAgICAgX2ltID0gX2NvbmYubmV3SW52ZXJzZU1hbmFnZXJJ\nbnN0YW5jZSgpOwogICAgICAgIF9zcG0gPSBfY29uZi5nZXRTYXZlcG9pbnRN\nYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfc3RvcmUuc2V0Q29udGV4dCh0\naGlzKTsKICAgICAgICBfbG0uc2V0Q29udGV4dCh0aGlzKTsKCiAgICAgICAg\naWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9BTFdBWVMpCiAg\nICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICBfZmMgPSBf\nc3RvcmUubmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgX2ZjLnNl\ndENvbnRleHQodGhpcyk7CgogICAgICAgIC8vIHN5bmNoIHdpdGggdGhlIGds\nb2JhbCB0cmFuc2FjdGlvbiBpbiBwcm9ncmVzcywgaWYgYW55CiAgICAgICAg\naWYgKF9mYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMs\nIGZhbHNlKSkKICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKQogICAgICAgIHRocm93cyBDbG9u\nZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9pbml0aWFs\naXplV2FzSW52b2tlZCkKICAgICAgICAgICAgdGhyb3cgbmV3IENsb25lTm90\nU3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIHJldHVybiBzdXBlci5jbG9uZSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIHtAbGluayBNYXB9IHRvIGJlIHVzZWQg\nZm9yIHRoZSBwcmltYXJ5IG1hbmFnZWQgb2JqZWN0IGNhY2hlLgogICAgICog\nTWFwcyBvaWRzIHRvIHN0YXRlIG1hbmFnZXJzLiBCeSBkZWZhdWx0LCB0aGlz\nIGNyZWF0ZXMgYQogICAgICoge0BsaW5rIFJlZmVyZW5jZU1hcH0gd2l0aCBz\nb2Z0IHZhbHVlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIE1hcCBuZXdNYW5h\nZ2VkT2JqZWN0Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZWZlcmVu\nY2VIYXNoTWFwKFJlZmVyZW5jZU1hcC5IQVJELCBSZWZlcmVuY2VNYXAuU09G\nVCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3RvcmVDb250ZXh0CiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVi\nbGljIEJyb2tlciBnZXRCcm9rZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByb3BlcnRpZXMK\nICAgIC8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0SW1wbGlj\naXRCZWhhdmlvcihPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFJ1bnRpbWVF\neGNlcHRpb25UcmFuc2xhdG9yIGV4KSB7CiAgICAgICAgaWYgKF9jYWxsID09\nIG51bGwpCiAgICAgICAgICAgIF9jYWxsID0gY2FsbDsKICAgICAgICBpZiAo\nX2V4dHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2V4dHJhbnMgPSBleDsK\nICAgIH0KCiAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBnZXRJbnN0\nYW5jZUV4Y2VwdGlvblRyYW5zbGF0b3IoKSB7CiAgICAgICAgcmV0dXJuIChf\nb3BlcmF0aW9uQ291bnQgPT0gMCkgPyBfZXh0cmFucyA6IG51bGw7CiAgICB9\nCgogICAgcHVibGljIEJyb2tlckZhY3RvcnkgZ2V0QnJva2VyRmFjdG9yeSgp\nIHsKICAgICAgICByZXR1cm4gX2ZhY3Rvcnk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENv\nbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIHJldHVybiBfZmM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb25uZWN0\naW9uUmV0YWluTW9kZSgpIHsKICAgICAgICByZXR1cm4gX2Nvbm5SZXRhaW5N\nb2RlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZCgpIHsK\nICAgICAgICByZXR1cm4gX21hbmFnZWQ7CiAgICB9CgogICAgcHVibGljIE1h\nbmFnZWRSdW50aW1lIGdldE1hbmFnZWRSdW50aW1lKCkgewogICAgICAgIHJl\ndHVybiBfcnVudGltZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIg\nZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAg\nICB9CgogICAgcHVibGljIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgZ2V0U3Rv\ncmVNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9Cgog\nICAgcHVibGljIExvY2tNYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAg\nICAgIHJldHVybiBfbG07CiAgICB9CgogICAgcHVibGljIEludmVyc2VNYW5h\nZ2VyIGdldEludmVyc2VNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfaW07\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uVXNlck5h\nbWUoKSB7CiAgICAgICAgcmV0dXJuIF91c2VyOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkgewogICAgICAgIHJl\ndHVybiBfcGFzczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNdWx0\naXRocmVhZGVkKCkgewogICAgICAgIHJldHVybiBfbXVsdGl0aHJlYWRlZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRNdWx0aXRocmVhZGVkKGJvb2xl\nYW4gbXVsdGl0aHJlYWRlZCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBfbXVsdGl0aHJlYWRlZCA9IG11bHRpdGhyZWFkZWQ7CiAgICAgICAg\naWYgKG11bHRpdGhyZWFkZWQgJiYgX2xvY2sgPT0gbnVsbCkKICAgICAgICAg\nICAgX2xvY2sgPSBuZXcgUmVlbnRyYW50TG9jaygpOwogICAgICAgIGVsc2Ug\naWYgKCFtdWx0aXRocmVhZGVkKQogICAgICAgICAgICBfbG9jayA9IG51bGw7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygp\nIHsKICAgICAgICByZXR1cm4gX2lnbm9yZUNoYW5nZXM7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0SWdub3JlQ2hhbmdlcyhib29sZWFuIHZhbCkgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfaWdub3JlQ2hhbmdlcyA9\nIHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2Fj\ndGlvbmFsUmVhZCgpIHsKICAgICAgICByZXR1cm4gX25vbnRyYW5zUmVhZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsUmVh\nZChib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVn\nYWwtb3AtaW4tcHJlc3RvcmUiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0\naGUgcnVudGltZSBzdXBwb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9j\nb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucwogICAgICAgICAgICAo\nX2NvbmYuT1BUSU9OX05PTlRSQU5TX1JFQUQpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICgibm9udHJhbnMtcmVhZC1ub3Qtc3VwcG9ydGVkIikpOwoKICAg\nICAgICBfbm9udHJhbnNSZWFkID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpIHsKICAgICAgICBy\nZXR1cm4gX25vbnRyYW5zV3JpdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKGJvb2xlYW4gdmFsKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19Q\nUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsK\nCiAgICAgICAgX25vbnRyYW5zV3JpdGUgPSB2YWw7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0T3B0aW1pc3RpYygpIHsKICAgICAgICByZXR1cm4g\nX29wdGltaXN0aWM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T3B0aW1p\nc3RpYyhib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAgICAgICAgIk9wdGltaXN0aWMi\nKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0\ncyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9wdGlv\nbnMoKS5jb250YWlucyhfY29uZi5PUFRJT05fT1BUSU1JU1RJQykpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgKCJvcHRpbWlzdGljLW5vdC1zdXBwb3J0ZWQi\nKSk7CgogICAgICAgIF9vcHRpbWlzdGljID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0UmVzdG9yZVN0YXRlKCkgewogICAgICAgIHJldHVybiBf\ncmVzdG9yZVN0YXRlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlc3Rv\ncmVTdGF0ZShpbnQgdmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInRyYW5zLWFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiUmVzdG9yZSIpKTsK\nCiAgICAgICAgX3Jlc3RvcmVTdGF0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRSZXRhaW5TdGF0ZSgpIHsKICAgICAgICByZXR1cm4g\nX3JldGFpblN0YXRlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJldGFp\nblN0YXRlKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAwKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\naWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsKICAgICAgICBfcmV0YWluU3Rh\ndGUgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRBdXRvQ2xlYXIo\nKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvQ2xlYXI7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0QXV0b0NsZWFyKGludCB2YWwpIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgX2F1dG9DbGVhciA9IHZhbDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldEF1dG9EZXRhY2goKSB7CiAgICAgICAgcmV0dXJu\nIF9hdXRvRGV0YWNoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9E\nZXRhY2goaW50IGRldGFjaEZsYWdzKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9hdXRvRGV0YWNoID0gZGV0YWNoRmxhZ3M7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFjaChpbnQgZGV0YWNoRmxhZywg\nYm9vbGVhbiBvbikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBp\nZiAob24pCiAgICAgICAgICAgIF9hdXRvRGV0YWNoIHw9IGRldGFjaEZsYWc7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfYXV0b0RldGFjaCAmPSB+ZGV0\nYWNoRmxhZzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldERldGFjaFN0YXRl\nKCkgewogICAgICAgIHJldHVybiBfZGV0YWNoU3RhdGU7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0RGV0YWNoU3RhdGUoaW50IG1vZGUpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2RldGFjaFN0YXRlID0gbW9kZTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGVkTmV3KCkgewog\nICAgICAgIHJldHVybiBfZGV0YWNoZWROZXc7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0RGV0YWNoZWROZXcoYm9vbGVhbiBpc05ldykgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBfZGV0YWNoZWROZXcgPSBpc05ldzsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTeW5jV2l0aE1hbmFnZWRU\ncmFuc2FjdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9zeW5jTWFuYWdlZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTeW5jV2l0aE1hbmFnZWRUcmFu\nc2FjdGlvbnMoYm9vbGVhbiBzeW5jKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9zeW5jTWFuYWdlZCA9IHN5bmM7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0RXZpY3RGcm9tRGF0YUNhY2hlKCkgewogICAgICAg\nIHJldHVybiBfZXZpY3REYXRhQ2FjaGU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0RXZpY3RGcm9tRGF0YUNhY2hlKGJvb2xlYW4gZXZpY3QpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2V2aWN0RGF0YUNhY2hlID0g\nZXZpY3Q7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0UG9wdWxhdGVE\nYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9wb3B1bGF0ZURhdGFDYWNo\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRQb3B1bGF0ZURhdGFDYWNo\nZShib29sZWFuIGNhY2hlKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIF9wb3B1bGF0ZURhdGFDYWNoZSA9IGNhY2hlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzVHJhY2tDaGFuZ2VzQnlUeXBlKCkgewogICAgICAg\nIHJldHVybiBfbGFyZ2VUcmFuc2FjdGlvbjsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRUcmFja0NoYW5nZXNCeVR5cGUoYm9vbGVhbiBsYXJnZVRyYW5z\nYWN0aW9uKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9sYXJn\nZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFuc2FjdGlvbjsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFVzZXJPYmplY3QoT2JqZWN0IGtleSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9PSBudWxsKSA/IG51bGwg\nOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgcHV0VXNlck9iamVjdChPYmplY3Qga2V5LCBP\nYmplY3QgdmFsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiAoX3VzZXJPYmplY3RzID09IG51bGwpID8g\nbnVsbCA6IF91c2VyT2JqZWN0cy5yZW1vdmUoa2V5KTsKCiAgICAgICAgICAg\nIGlmIChfdXNlck9iamVjdHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91\nc2VyT2JqZWN0cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIHJldHVy\nbiBfdXNlck9iamVjdHMucHV0KGtleSwgdmFsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIoT2Jq\nZWN0IGxpc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNsYXNz\nZXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIobGlzdGVu\nZXIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGdldExp\nZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJldHVy\nbiBfbGlmZUNhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRMaWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfbGlmZUNhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAg\nICAgIF9saWZlRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FM\nTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHaXZlIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0byB0\naGUgbGlmZWN5Y2xlIGV2ZW50IG1hbmFnZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBMaWZlY3ljbGVFdmVudE1hbmFnZXIgZ2V0TGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyKCkgewogICAgICAgIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gbGlmZWN5Y2xlIGV2ZW50\nLCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAg\nICoKICAgICAqIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHBy\nb2Nlc3NlZCBhdCB0aGlzIHRpbWUKICAgICAqLwogICAgYm9vbGVhbiBmaXJl\nTGlmZWN5Y2xlRXZlbnQoT2JqZWN0IHNyYywgT2JqZWN0IHJlbGF0ZWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBpbnQgZXZlbnRUeXBlKSB7CiAg\nICAgICAgaWYgKF9saWZlRXZlbnRNYW5hZ2VyID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2Vw\ndGlvbnMoX2xpZmVFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRl\nZCwgCiAgICAgICAgICAgIG1ldGEsIGV2ZW50VHlwZSksIF9saWZlQ2FsbGJh\nY2tNb2RlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBleGNlcHRpb25zIGRl\ncGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKEV4Y2VwdGlvbltdIGV4\nY2VwcywgaW50IG1vZGUpIHsKICAgICAgICBpZiAoZXhjZXBzLmxlbmd0aCA9\nPSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAhPSAwKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIE9wZW5KUEFFeGNlcHRpb24gY2U7CiAg\nICAgICAgaWYgKGV4Y2Vwcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgY2Ug\nPSBuZXcgQ2FsbGJhY2tFeGNlcHRpb24oZXhjZXBzWzBdKTsKICAgICAgICBl\nbHNlIAogICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihf\nbG9jLmdldCgiY2FsbGJhY2stZXJyIikpLgogICAgICAgICAgICAgICAgc2V0\nTmVzdGVkVGhyb3dhYmxlcyhleGNlcHMpOwogICAgICAgIGlmICgobW9kZSAm\nIENBTExCQUNLX1JPTExCQUNLKSAhPSAwICYmIChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCkgewogICAgICAgICAgICBjZS5zZXRGYXRhbCh0cnVlKTsK\nICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoY2UpOwogICAg\nICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBDQUxMQkFDS19MT0cpICE9IDAg\nJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fy\nbihjZSk7CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUkVUSFJPVykg\nIT0gMCkKICAgICAgICAgICAgdGhyb3cgY2U7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYWRkVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgdGwpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKHRsKTsK\nICAgICAgICAgICAgaWYgKHRsIGluc3RhbmNlb2YgUmVtb3RlQ29tbWl0RXZl\nbnRNYW5hZ2VyKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVN\nT1RFX0xJU1RFTkVSOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByZW1vdmVUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3Rl\nbmVyKHRsKQogICAgICAgICAgICAgICAgJiYgKHRsIGluc3RhbmNlb2YgUmVt\nb3RlQ29tbWl0RXZlbnRNYW5hZ2VyKSkKICAgICAgICAgICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19SRU1PVEVfTElTVEVORVI7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBpbnQgZ2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxi\nYWNrTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tNb2Rl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFRyYW5zYWN0aW9uTGlzdGVu\nZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3RyYW5z\nQ2FsbGJhY2tNb2RlID0gbW9kZTsKICAgICAgICAgICAgX3RyYW5zRXZlbnRN\nYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FMTEJBQ0tfRkFJTF9GQVNU\nKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBG\naXJlIGdpdmVuIHRyYW5zYWN0aW9uIGV2ZW50LCBoYW5kbGluZyBhbnkgZXhj\nZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZmlyZVRyYW5zYWN0aW9uRXZlbnQoVHJhbnNhY3Rpb25FdmVudCB0cmFu\ncykgewogICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKF90cmFuc0V2\nZW50TWFuYWdlci5maXJlRXZlbnQodHJhbnMpLAogICAgICAgICAgICAgICAg\nX3RyYW5zQ2FsbGJhY2tNb2RlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwog\nICAgLy8gTG9va3VwcwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2Jq\nZWN0IGZpbmQoT2JqZWN0IG9pZCwgYm9vbGVhbiB2YWxpZGF0ZSwgRmluZENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaW50IGZsYWdzID0gT0lEX0NPUFkg\nfCBPSURfQUxMT1dfTkVXIHwgT0lEX05PREVMRVRFRDsKICAgICAgICBpZiAo\nIXZhbGlkYXRlKQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9WQUxJREFU\nRTsKICAgICAgICByZXR1cm4gZmluZChvaWQsIF9mYywgbnVsbCwgbnVsbCwg\nZmxhZ3MsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmluZChP\nYmplY3Qgb2lkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBl\neGNsdWRlLAogICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAg\nICAgICAgcmV0dXJuIGZpbmQob2lkLCBmZXRjaCwgZXhjbHVkZSwgZWRhdGEs\nIGZsYWdzLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFs\nIGZpbmRlci4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBmaW5kKE9i\namVjdCBvaWQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgQml0U2V0IGV4\nY2x1ZGUsCiAgICAgICAgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAg\nICAgICAgICAgIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9IGNhbGwucHJv\nY2Vzc0FyZ3VtZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgPT0g\nMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbihfbG9jLmdldCgibnVsbC1vaWQiKSk7CiAgICAgICAgICAgIHJl\ndHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNo\nID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVh\nZCgpOwoKICAgICAgICAgICAgLy8gY2FjaGVkIGluc3RhbmNlPwogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbEJ5SWQob2lkLAogICAgICAgICAgICAgICAgKGZsYWdzICYgT0lEX0FMTE9X\nX05FVykgIT0gMCB8fCAoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAhPSAwKTsK\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmICghcmVxdWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEsIGZs\nYWdzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNz\nUmV0dXJuKG9pZCwgc20pOwoKICAgICAgICAgICAgICAgIGlmICghc20uaXNM\nb2FkaW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUg\nYWxsIHRoZSBjb25maWd1cmVkIGZpZWxkcyBhcmUgbG9hZGVkOyBkbyB0aGlz\nCiAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgbWFraW5nIGluc3RhbmNl\nIHRyYW5zYWN0aW9uYWwgZm9yIGxvY2tpbmcKICAgICAgICAgICAgICAgICAg\nICBpZiAoIXNtLmlzVHJhbnNhY3Rpb25hbCgpICYmIHVzZVRyYW5zYWN0aW9u\nYWxTdGF0ZShmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnRy\nYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGxv\nYWRlZDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBsb2FkZWQgPSBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFn\nZXJJbXBsLkxPQURfRkdTLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGV4Y2x1ZGUsIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRF\nRCkgIT0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdz\nICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBpZiBubyBk\nYXRhIG5lZWRlZCB0byBiZSBsb2FkZWQgYW5kIHRoZSB1c2VyIHdhbnRzIHRv\nCiAgICAgICAgICAgICAgICAgICAgLy8gdmFsaWRhdGUsIGp1c3QgbWFrZSBz\ndXJlIHRoZSBvYmplY3QgZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFsb2FkZWQgJiYgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09IDAKICAg\nICAgICAgICAgICAgICAgICAgICAgJiYgX2NvbXBhdC5nZXRWYWxpZGF0ZVRy\ndWVDaGVja3NTdG9yZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFz\nbS5pc1RyYW5zYWN0aW9uYWwoKQogICAgICAgICAgICAgICAgICAgICAgICAm\nJiAhX3N0b3JlLmV4aXN0cyhzbSwgZWRhdGEpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSA9PSAwKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vz\nc1JldHVybihvaWQsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICgiZGVsLWluc3RhbmNlIiwgc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIG9pZCkpLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgLy8gc2luY2UgdGhlIG9iamVjdCB3YXMg\nY2FjaGVkLCB3ZSBtYXkgbmVlZCB0byB1cGdyYWRlIGxvY2sKICAgICAgICAg\nICAgICAgIC8vIGlmIGN1cnJlbnQgbGV2ZWwgaXMgaGlnaGVyIHRoYW4gbGV2\nZWwgb2YgaW5pdGlhbCBsb2FkCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAg\naW50IGxldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAg\nICAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9j\na1RpbWVvdXQoKSwgZWRhdGEpOwogICAgICAgICAgICAgICAgICAgIHNtLnJl\nYWRMb2NrZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwu\ncHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gaWYgdGhlcmUncyBubyBjYWNoZWQgc20gZm9yIGEgbmV3L3Ry\nYW5zaWVudCBpZCB0eXBlLCB3ZQogICAgICAgICAgICAvLyBpdCBkZWZpbml0\nZWx5IGRvZXNuJ3QgZXhpc3QKICAgICAgICAgICAgaWYgKG9pZCBpbnN0YW5j\nZW9mIFN0YXRlTWFuYWdlcklkKQogICAgICAgICAgICAgICAgcmV0dXJuIGNh\nbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwoKICAgICAgICAgICAgLy8g\naW5pdGlhbGl6ZSBhIG5ldyBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZGF0YXN0\nb3JlIGluc3RhbmNlCiAgICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2Vy\nSW1wbChvaWQsIChmbGFncyAmIE9JRF9DT1BZKSAhPSAwKTsKICAgICAgICAg\nICAgYm9vbGVhbiBsb2FkID0gcmVxdWlyZXNMb2FkKHNtLCBmYWxzZSwgZmV0\nY2gsIGVkYXRhLCBmbGFncyk7CiAgICAgICAgICAgIHNtID0gaW5pdGlhbGl6\nZShzbSwgbG9hZCwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAgICAgaWYgKHNt\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURf\nTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24ob2lkKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjb25m\naWd1cmVkIGZpZWxkcyB3ZXJlIGxvYWRlZAogICAgICAgICAgICBpZiAobG9h\nZCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBl\neGNsdWRlLAogICAgICAgICAgICAgICAgICAgICAgICBlZGF0YSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb24gb25mZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3Mg\nJiBPSURfTk9ERUxFVEVEKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5l\nd2x5LWNvbnN0cnVjdGVkIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGluaXRpYWxpemUoU3RhdGVNYW5h\nZ2VySW1wbCBzbSwgYm9vbGVhbiBsb2FkLAogICAgICAgIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgaWYgKCFs\nb2FkKSB7CiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURh\ndGEoKS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICBQQ1N0\nYXRlLkhPTExPVyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUENT\ndGF0ZSBzdGF0ZSA9ICh1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQog\nICAgICAgICAgICAgICAgPyBQQ1N0YXRlLlBDTEVBTiA6IFBDU3RhdGUuUE5P\nTlRSQU5TOwogICAgICAgICAgICBzbS5zZXRMb2FkaW5nKHRydWUpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFfc3RvcmUuaW5p\ndGlhbGl6ZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICBzbS5zZXRMb2FkaW5nKGZhbHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc207CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBi\nb29sZWFuIHZhbGlkYXRlLAogICAgICAgIEZpbmRDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGludCBmbGFncyA9IE9JRF9DT1BZIHwgT0lEX0FMTE9XX05F\nVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAgICAgaWYgKCF2YWxpZGF0ZSkKICAg\nICAgICAgICAgZmxhZ3MgfD0gT0lEX05PVkFMSURBVEU7CiAgICAgICAgcmV0\ndXJuIGZpbmRBbGwob2lkcywgX2ZjLCBudWxsLCBudWxsLCBmbGFncywgY2Fs\nbCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVj\ndGlvbiBvaWRzLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAg\nQml0U2V0IGV4Y2x1ZGUsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAg\nICAgICAgcmV0dXJuIGZpbmRBbGwob2lkcywgZmV0Y2gsIGV4Y2x1ZGUsIGVk\nYXRhLCBmbGFncywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRl\ncm5hbCBmaW5kZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3RbXSBm\naW5kQWxsKENvbGxlY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGlu\ndCBmbGFncywgRmluZENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZmluZEFs\nbERlcHRoICsrOwoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyBm\nb3IgbnVsbCBvaWRzIHVwIGltbWVkaWF0ZWx5CiAgICAgICAgaWYgKG9pZHMg\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCJvaWRzID09IG51bGwiKTsKICAgICAgICBpZiAoKGZsYWdzICYg\nT0lEX05PVkFMSURBVEUpICE9IDAgJiYgb2lkcy5jb250YWlucyhudWxsKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm51bGwtb2lkcyIpKTsKCiAgICAgICAgLy8gd2UgaGF2ZSB0byB1c2UgYSBt\nYXAgb2Ygb2lkLT5zbSByYXRoZXIgdGhhbiBhIHNpbXBsZQogICAgICAgIC8v\nIGFycmF5LCBzbyB0aGF0IHdlIG1ha2Ugc3VyZSBub3QgdG8gY3JlYXRlIG11\nbHRpcGxlIHNtcyBmb3IgZXF1aXZhbGVudAogICAgICAgIC8vIG9pZHMgaWYg\ndGhlIHVzZXIgaGFzIGR1cGxpY2F0ZXMgaW4gdGhlIGdpdmVuIGFycmF5CiAg\nICAgICAgaWYgKF9sb2FkaW5nID09IG51bGwpCiAgICAgICAgICAgIF9sb2Fk\naW5nID0gbmV3IEhhc2hNYXAoKGludCkgKG9pZHMuc2l6ZSgpICogMS4zMyAr\nIDEpKTsKCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAg\nY2FsbCA9IHRoaXM7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIGZldGNoID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFu\nc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVjdGlvbiBv\nZiBzdGF0ZSBtYW5hZ2VycyB0byBwYXNzIHRvIHN0b3JlIG1hbmFnZXIKICAg\nICAgICAgICAgTGlzdCBsb2FkID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgYm9vbGVhbiBpbml0aWFsaXpl\nZDsKICAgICAgICAgICAgYm9vbGVhbiB0cmFuc1N0YXRlID0gdXNlVHJhbnNh\nY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAgT2JqZWN0IG9iaiwg\nb2lkOwogICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSd2ZSBhbHJl\nYWR5IHNlZW4gdGhpcyBvaWQsIHNraXAgcmVwZWF0cwogICAgICAgICAgICAg\nICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIG9pZCA9IGNh\nbGwucHJvY2Vzc0FyZ3VtZW50KG9iaik7CiAgICAgICAgICAgICAgICBpZiAo\nb2lkID09IG51bGwgfHwgX2xvYWRpbmcuY29udGFpbnNLZXkob2JqKSkKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAv\nLyBpZiB3ZSBkb24ndCBoYXZlIGEgY2FjaGVkIGluc3RhbmNlIG9yIGl0IGlz\nIG5vdCB0cmFuc2FjdGlvbmFsCiAgICAgICAgICAgICAgICAvLyBhbmQgaXMg\naG9sbG93IG9yIHdlIG5lZWQgdG8gdmFsaWRhdGUsIGxvYWQgaXQKICAgICAg\nICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQob2lkLCAo\nZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwCiAgICAgICAgICAgICAgICAg\nICAgfHwgKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCk7CiAgICAgICAg\nICAgICAgICBpbml0aWFsaXplZCA9IHNtICE9IG51bGw7CiAgICAgICAgICAg\nICAgICBpZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNt\nID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIChmbGFncyAmIE9JRF9DT1BZ\nKSAhPSAwKTsKCiAgICAgICAgICAgICAgICBfbG9hZGluZy5wdXQob2JqLCBz\nbSk7CiAgICAgICAgICAgICAgICBpZiAocmVxdWlyZXNMb2FkKHNtLCBpbml0\naWFsaXplZCwgZmV0Y2gsIGVkYXRhLCBmbGFncykpIHsKICAgICAgICAgICAg\nICAgICAgICB0cmFuc1N0YXRlID0gdHJhbnNTdGF0ZSB8fCB1c2VUcmFuc2Fj\ndGlvbmFsU3RhdGUoZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGlmIChp\nbml0aWFsaXplZCAmJiAhc20uaXNUcmFuc2FjdGlvbmFsKCkgJiYgdHJhbnNT\ndGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0KG9p\nZHMuc2l6ZSgpIC0gaWR4KTsKICAgICAgICAgICAgICAgICAgICBsb2FkLmFk\nZChzbSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpbml0aWFsaXpl\nZCkKICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICBQQ1N0YXRlLkhPTExPVyk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHBhc3MgYWxsIHN0YXRlIG1hbmFnZXJzIGluIG5lZWQgb2Yg\nbG9hZGluZyBvciB2YWxpZGF0aW9uIHRvIHRoZQogICAgICAgICAgICAvLyBz\ndG9yZSBtYW5hZ2VyCiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIFBDU3RhdGUgc3RhdGUgPSAodHJhbnNTdGF0ZSkg\nPyBQQ1N0YXRlLlBDTEVBTgogICAgICAgICAgICAgICAgICAgIDogUENTdGF0\nZS5QTk9OVFJBTlM7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxl\nZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIHN0YXRlLAogICAgICAgICAgICAg\nICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX05PTkUsIGZldGNoLCBl\nZGF0YSk7CgogICAgICAgICAgICAgICAgLy8gc2V0IGZhaWxlZCBpbnN0YW5j\nZXMgdG8gbnVsbAogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxs\nICYmICFmYWlsZWQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihmYWlsZWQpOwogICAgICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gZmFpbGVkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgICAgICAgICBfbG9hZGluZy5wdXQoaXRyLm5leHQoKSwg\nbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGNyZWF0ZSByZXN1bHRzIGFycmF5OyBtYWtlIHN1cmUgYWxs\nIGNvbmZpZ3VyZWQgZmllbGRzIGFyZQogICAgICAgICAgICAvLyBsb2FkZWQg\naW4gZWFjaCBpbnN0YW5jZQogICAgICAgICAgICBPYmplY3RbXSByZXN1bHRz\nID0gbmV3IE9iamVjdFtvaWRzLnNpemUoKV07CiAgICAgICAgICAgIGJvb2xl\nYW4gYWN0aXZlID0gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAg\nICAgICAgICBpbnQgbGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCk7\nCiAgICAgICAgICAgIGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgr\nKykgewogICAgICAgICAgICAgICAgb2lkID0gaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIF9sb2FkaW5nLmdl\ndChvaWQpOwogICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgcmVx\ndWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkgewog\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1Ms\nCiAgICAgICAgICAgICAgICAgICAgICAgIAlleGNsdWRlLCBlZGF0YSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWws\nIGZldGNoLmdldExvY2tUaW1lb3V0KCksIGVkYXRhKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGZldGNoLmdl\ndFdyaXRlTG9ja0xldmVsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNh\ndGNoIChPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbiBvbmZlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSAh\nPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAoZmxhZ3MgJiBP\nSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRocm93IG9uZmU7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtID0g\nbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXN1bHRzW2lkeF0gPSBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHJlc3VsdHM7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBmaW5kQWxsRGVwdGgtLTsKICAgICAgICAgICAgaWYgKGZp\nbmRBbGxEZXB0aCA9PSAwKQogICAgICAgICAgICAgICAgX2xvYWRpbmcgPSBu\ndWxsOwogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4g\naW5zdGFuY2UgbmVlZHMgbG9hZGluZyBiZWZvcmUgYmVpbmcgcmV0dXJuZWQK\nICAgICAqIHRvIHRoZSB1c2VyLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gcmVxdWlyZXNMb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJvb2xl\nYW4gaW5pdGlhbGl6ZWQsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewogICAgICAgIGlmICgh\nZmV0Y2gucmVxdWlyZXNMb2FkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09IDAp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChlZGF0YSAh\nPSBudWxsKSAvLyB0YWtlIGFkdmFudGFnZSBvZiBleGlzdGluZyByZXN1bHQK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGluaXRpYWxp\nemVkICYmIHNtLmdldFBDU3RhdGUoKSAhPSBQQ1N0YXRlLkhPTExPVykKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghaW5pdGlhbGl6\nZWQgJiYgc20uZ2V0TWV0YURhdGEoKS5nZXRQQ1N1YmNsYXNzZXMoKS5sZW5n\ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1\ncm4gIV9jb21wYXQuZ2V0VmFsaWRhdGVGYWxzZVJldHVybnNIb2xsb3coKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRvIHVzZSBh\nIHRyYW5zYWN0aW9uYWwgc3RhdGUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0FDVElW\nRSkgIT0gMCAmJiAoIV9vcHRpbWlzdGljCiAgICAgICAgICAgIHx8IF9hdXRv\nQ2xlYXIgPT0gQ0xFQVJfQUxMCiAgICAgICAgICAgIHx8IGZldGNoLmdldFJl\nYWRMb2NrTGV2ZWwoKSAhPSBMT0NLX05PTkUpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZmluZENhY2hlZChPYmplY3Qgb2lkLCBGaW5kQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAg\nICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1\nbWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbEJ5SWQob2lkLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIGNhbGwu\ncHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIENsYXNzIGdldE9iamVjdElkVHlwZShDbGFzcyBjbHMpIHsK\nICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAg\nICAgIGdldE1ldGFEYXRhKGNscywgX2xvYWRlciwgZmFsc2UpOwogICAgICAg\nICAgICBpZiAobWV0YSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBtZXRh\nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9X\nTikKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBp\nZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCk7CgogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdl\ndERhdGFTdG9yZUlkVHlwZShtZXRhKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld09iamVjdElkKENsYXNz\nIGNscywgT2JqZWN0IHZhbCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9h\nZGVyLCB0cnVlKTsKICAgICAgICAgICAgc3dpdGNoIChtZXRhLmdldElkZW50\naXR5VHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgQ2xhc3NNZXRhRGF0YS5J\nRF9EQVRBU1RPUkU6CiAgICAgICAgICAgICAgICAvLyBkZWxlZ2F0ZSB0byBz\ndG9yZSBtYW5hZ2VyIGZvciBkYXRhc3RvcmUgaWRzCiAgICAgICAgICAgICAg\nICBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nCiAgICAgICAgICAgICAgICAg\nICAgJiYgKChTdHJpbmcpIHZhbCkuc3RhcnRzV2l0aChTdGF0ZU1hbmFnZXJJ\nZC5TVFJJTkdfUFJFRklYKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFN0YXRlTWFuYWdlcklkKChTdHJpbmcpIHZhbCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gX3N0b3JlLm5ld0RhdGFTdG9yZUlkKHZhbCwgbWV0YSk7\nCiAgICAgICAgICAgIGNhc2UgQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTjoKICAgICAgICAgICAgICAgIGlmIChJbXBsSGVscGVyLmlzQXNzaWduYWJs\nZShtZXRhLmdldE9iamVjdElkVHlwZSgpLCAKICAgICAgICAgICAgICAgICAg\nICB2YWwuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nIW1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAKICAgICAgICAgICAgICAgICAg\nICAgICAgJiYgbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElkKGNscywgdmFs\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHN0cmluZ2lmaWVkIGFwcCBp\nZD8KICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcg\nCiAgICAgICAgICAgICAgICAgICAgJiYgIV9jb25mLmdldENvbXBhdGliaWxp\ndHlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRTdHJp\nY3RJZGVudGl0eVZhbHVlcygpCiAgICAgICAgICAgICAgICAgICAgJiYgIU1v\nZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdPYmplY3RJZChj\nbHMsIChTdHJpbmcpIHZhbCk7CgogICAgICAgICAgICAgICAgT2JqZWN0W10g\nYXJyID0gKHZhbCBpbnN0YW5jZW9mIE9iamVjdFtdKSA/IChPYmplY3RbXSkg\ndmFsCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgT2JqZWN0W117IHZhbCB9\nOwogICAgICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmZyb21Q\nS1ZhbHVlcyhhcnIsIG1ldGEpOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm1ldGEtdW5rbm93bmlkIiwgY2xzKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKENsYXNzQ2FzdEV4Y2VwdGlv\nbiBjY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1pZC12YWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAg\nIHZhbC5nZXRDbGFzcygpLmdldE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoY2Nl\nKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdGF0ZU1hbmFnZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwo\nT2JqZWN0IG9pZCwgYm9vbGVhbiBjb3B5KSB7CiAgICAgICAgLy8gc2VlIGlm\nIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIGxvYWRpbmcgdGhpcyBvaWQgaW4g\nYSBsb2FkQWxsIGNhbGwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgIGlmIChfbG9hZGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIHNt\nID0gKFN0YXRlTWFuYWdlckltcGwpIF9sb2FkaW5nLmdldChvaWQpOwogICAg\nICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5nZXRQZXJzaXN0ZW5jZUNh\ncGFibGUoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZmluZCBtZXRhZGF0YSBmb3IgdGhlIG9p\nZAogICAgICAgIENsYXNzIHBjVHlwZSA9IF9zdG9yZS5nZXRNYW5hZ2VkVHlw\nZShvaWQpOwogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgIGlmIChwY1R5cGUgIT0gbnVs\nbCkKICAgICAgICAgICAgbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKHBjVHlw\nZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBt\nZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEob2lkLCBfbG9hZGVyLCB0cnVlKTsK\nCiAgICAgICAgLy8gY29weSB0aGUgb2lkIGlmIG5lZWRlZAogICAgICAgIGlm\nIChjb3B5ICYmIF9jb21wYXQuZ2V0Q29weU9iamVjdElkcygpKSB7CiAgICAg\nICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICBvaWQgPSBB\ncHBsaWNhdGlvbklkcy5jb3B5KG9pZCwgbWV0YSk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9VTktOT1dOKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgbWV0YSkpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBvaWQgPSBfc3RvcmUu\nY29weURhdGFTdG9yZUlkKG9pZCwgbWV0YSk7CiAgICAgICAgfQoKICAgICAg\nICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCBtZXRhKTsKICAgICAg\nICBzbS5zZXRPYmplY3RJZChvaWQpOwogICAgICAgIHJldHVybiBzbTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIHN0YXRlIG1hbmFnZXIgZm9y\nIHRoZSBnaXZlbiBvaWQgYW5kIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90\nZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBuZXdTdGF0ZU1hbmFnZXJJbXBsKE9i\namVjdCBvaWQsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhp\ncyk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBUcmFuc2Fj\ndGlvbgogICAgLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgYmVn\naW4oKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkg\nIT0gMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQoImFjdGl2ZSIpKTsKICAgICAgICAgICAgX2Zh\nY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24odGhpcywgdHJ1ZSk7\nCiAgICAgICAgICAgIGJlZ2luSW50ZXJuYWwoKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIHN0b3JlIG1hbmFnZXIg\nb2YgYSB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJl\nZ2luSW50ZXJuYWwoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmVn\naW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihfb3B0aW1pc3RpYyk7CiAgICAg\nICAgICAgIF9mbGFncyB8PSBGTEFHX0FDVElWRTsKCiAgICAgICAgICAgIC8v\nIHN0YXJ0IGxvY2tpbmcKICAgICAgICAgICAgaWYgKCFfb3B0aW1pc3RpYykg\newogICAgICAgICAgICAgICAgX2ZjLnNldFJlYWRMb2NrTGV2ZWwoX2NvbmYu\nZ2V0UmVhZExvY2tMZXZlbENvbnN0YW50KCkpOwogICAgICAgICAgICAgICAg\nX2ZjLnNldFdyaXRlTG9ja0xldmVsKF9jb25mLmdldFdyaXRlTG9ja0xldmVs\nQ29uc3RhbnQoKSk7CiAgICAgICAgICAgICAgICBfZmMuc2V0TG9ja1RpbWVv\ndXQoX2NvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX2xtLmJlZ2luVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAg\nIGlmIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzQmVnaW5MaXN0ZW5lcnMoKSkK\nICAgICAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFu\nc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNh\nY3Rpb25FdmVudC5BRlRFUl9CRUdJTiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVs\nbCkpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgLy8gaWYgd2UgYWxyZWFkeSBzdGFydGVkIHRoZSB0cmFu\nc2FjdGlvbiwgZG9uJ3QgbGV0IGl0IGNvbW1pdAogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAg\nc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoa2UpOwogICAgICAgICAgICB0aHJv\ndyBrZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIC8vIGlmIHdlIGFscmVhZHkg\nc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24sIGRvbid0IGxldCBpdCBjb21taXQK\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKHJlKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKS5zZXRG\nYXRhbCh0cnVlKTsKICAgICAgICB9CgogICAgICAgIGlmIChfcGVuZGluZyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXQgPSBfcGVuZGluZy5pdGVyYXRv\ncigpOyBpdC5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChT\ndGF0ZU1hbmFnZXJJbXBsKSBpdC5uZXh0KCk7CiAgICAgICAgICAgICAgICBz\nbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNE\naXJ0eSgpKQogICAgICAgICAgICAgICAgICAgIHNldERpcnR5KHNtLCB0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfcGVuZGluZyA9IG51bGw7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2luU3RvcmUo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsK\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkg\nPT0gMCkKICAgICAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNh\nY3Rpb24oZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEJlZ2luIGEgc3RvcmUgbWFuYWdlciB0cmFuc2FjdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJlZ2luU3RvcmVNYW5hZ2Vy\nVHJhbnNhY3Rpb24oYm9vbGVhbiBvcHRpbWlzdGljKSB7CiAgICAgICAgaWYg\nKCFvcHRpbWlzdGljKSB7CiAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgX3N0b3JlLmJlZ2luKCk7CiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX1NUT1JFX0FDVElWRTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBpZiAoX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlO\nX1RSQU5TKQogICAgICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlvbigpOwog\nICAgICAgICAgICBfc3RvcmUuYmVnaW5PcHRpbWlzdGljKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogRW5kIHRoZSBjdXJyZW50IHN0b3Jl\nIG1hbmFnZXIgdHJhbnNhY3Rpb24uIFRocm93cyBhbgogICAgICogZXhjZXB0\naW9uIHRvIHNpZ25hbCBhIGZvcmNlZCByb2xsYmFjayBhZnRlciBmYWlsZWQg\nY29tbWl0LCBvdGhlcndpc2UKICAgICAqIHJldHVybnMgYW55IGV4Y2VwdGlv\nbiBlbmNvdW50ZXJlZCBkdXJpbmcgdGhlIGVuZCBwcm9jZXNzLgogICAgICov\nCiAgICBwcml2YXRlIFJ1bnRpbWVFeGNlcHRpb24gZW5kU3RvcmVNYW5hZ2Vy\nVHJhbnNhY3Rpb24oYm9vbGVhbiByb2xsYmFjaykgewogICAgICAgIGJvb2xl\nYW4gZm9yY2VkUm9sbGJhY2sgPSBmYWxzZTsKICAgICAgICBib29sZWFuIHJl\nbGVhc2VDb25uID0gZmFsc2U7CiAgICAgICAgUnVudGltZUV4Y2VwdGlvbiBl\ncnIgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAg\nICAgIHJlbGVhc2VDb25uID0gX2Nvbm5SZXRhaW5Nb2RlICE9IENPTk5fUkVU\nQUlOX0FMV0FZUzsKICAgICAgICAgICAgICAgIGlmIChyb2xsYmFjaykKICAg\nICAgICAgICAgICAgICAgICBfc3RvcmUucm9sbGJhY2soKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfc3RvcmUuY29tbWl0\nKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZWxl\nYXNlQ29ubiA9IF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9UUkFO\nUzsKICAgICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFja09wdGltaXN0aWMo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBpZiAoIXJvbGxiYWNr\nKSB7CiAgICAgICAgICAgICAgICBmb3JjZWRSb2xsYmFjayA9IHRydWU7CiAg\nICAgICAgICAgICAgICB0cnkgeyBfc3RvcmUucm9sbGJhY2soKTsgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZTIpIHt9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX1NUT1JFX0FDVElWRTsKICAgICAgICB9\nCgogICAgICAgIGlmIChyZWxlYXNlQ29ubikgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm5lY3Rpb24oKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICAgICAgaWYgKGVyciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGVyciA9IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBp\nZiAoZm9yY2VkUm9sbGJhY2spCiAgICAgICAgICAgIHRocm93IGVycjsKICAg\nICAgICByZXR1cm4gZXJyOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1p\ndCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24o\nKTsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9u\nIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0\naW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC10cmFucyIpKTsK\nCiAgICAgICAgICAgIC8vIHRoaXMgY29tbWl0IG9uIHRoZSB0cmFuc2FjdGlv\nbiB3aWxsIGNhdXNlIG91cgogICAgICAgICAgICAvLyBiZWZvcmVDb21wbGV0\naW9uIG1ldGhvZCB0byBiZSBpbnZva2VkCiAgICAgICAgICAgIHRyYW5zLmNv\nbW1pdCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1l\ncnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgZSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBqYXZh\neC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAg\nICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFu\nc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRyYW5zLnJvbGxiYWNrKCk7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJv\nciIpLCBlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\neW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbigpIHsKICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKCFfbWFuYWdl\nZCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInRyYW5zLW5vdC1tYW5hZ2VkIikpOwogICAgICAg\nICAgICBpZiAoX2ZhY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24o\ndGhpcywgZmFsc2UpKSB7CiAgICAgICAgICAgICAgICBiZWdpbkludGVybmFs\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNvbW1pdEFuZFJlc3VtZSgpIHsKICAgICAgICBlbmRB\nbmRSZXN1bWUodHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJh\nY2tBbmRSZXN1bWUoKSB7CiAgICAgICAgZW5kQW5kUmVzdW1lKGZhbHNlKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZW5kQW5kUmVzdW1lKGJvb2xlYW4g\nY29tbWl0KSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb21taXQpCiAgICAgICAgICAg\nICAgICBjb21taXQoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgcm9sbGJhY2soKTsKICAgICAgICAgICAgYmVnaW4oKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Um9sbGJhY2tPbmx5\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAg\nICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAg\nICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5n\nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\ncmV0dXJuIHRyYW5zLmdldFN0YXR1cygpID09IFN0YXR1cy5TVEFUVVNfTUFS\nS0VEX1JPTExCQUNLOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBUaHJvd2FibGUgZ2V0Um9sbGJhY2tDYXVzZSgpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlv\nbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGlt\nZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwog\nICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAodHJhbnMuZ2V0U3RhdHVz\nKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJLRURfUk9MTEJBQ0spCiAgICAgICAg\nICAgICAgICByZXR1cm4gX3J1bnRpbWUuZ2V0Um9sbGJhY2tDYXVzZSgpOwoK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Um9sbGJhY2tPbmx5KCkgewogICAgICAg\nIHNldFJvbGxiYWNrT25seShuZXcgVXNlckV4Y2VwdGlvbigpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFja09ubHkoVGhyb3dhYmxlIGNh\ndXNlKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24o\nKTsKICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoY2F1c2Up\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhl\nIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMgcm9sbGJhY2stb25seS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNldFJvbGxiYWNrT25seUludGVybmFsKFRo\ncm93YWJsZSBjYXVzZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGph\ndmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAg\nICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRy\nYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgibnVsbC10cmFucyIpKTsKICAgICAgICAgICAgX3J1bnRp\nbWUuc2V0Um9sbGJhY2tPbmx5KGNhdXNlKTsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRTYXZlcG9pbnQoU3RyaW5nIG5hbWUpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAgICAg\nICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiBfc2F2ZXBvaW50cy5j\nb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzYXZlcG9pbnQtZXhpc3RzIiwgbmFt\nZSkpOwoKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZMVVNIRUQp\nICE9IDAKICAgICAgICAgICAgICAgICYmICFfc3BtLnN1cHBvcnRzSW5jcmVt\nZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAg\nKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAg\nICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZSA9IF9zcG0ubmV3U2F2ZXBvaW50\nKG5hbWUsIHRoaXMpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0g\nbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nICAgIHNhdmUuc2F2ZShnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAg\nICAgICAgICAgICAgX3NhdmVwb2ludHMgPSBuZXcgTGlua2VkTWFwKCk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoX3NhdmVw\nb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc2F2ZS5z\nYXZlKENvbGxlY3Rpb25zLkVNUFRZX0xJU1QpOwogICAgICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZS5zYXZlKF9zYXZlcG9p\nbnRDYWNoZSk7CiAgICAgICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hl\nLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX3NhdmVwb2ludHMucHV0KG5hbWUsIHNhdmUpOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9p\nbnQoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8\nIF9zYXZlcG9pbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50\nIikpOwogICAgICAgICAgICByZWxlYXNlU2F2ZXBvaW50KChTdHJpbmcpIF9z\nYXZlcG9pbnRzLmdldAogICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNp\nemUoKSAtIDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgcmVsZWFzZVNhdmVwb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAg\nICBpbnQgaW5kZXggPSAoX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAg\nICAgICAgICAgICAgOiBfc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7\nCiAgICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50\nIiwgc2F2ZXBvaW50KSk7CgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4g\ncmV2ZXJzZQogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAg\nICAgICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCAr\nIDEpIHsKICAgICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2lu\ndCkgX3NhdmVwb2ludHMucmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9z\nYXZlcG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5y\nZWxlYXNlKGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2\nZSA9IChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5k\nZXgpOwogICAgICAgICAgICBzYXZlLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAg\nICAgIGlmIChfc2F2ZXBvaW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9zYXZlcG9pbnRDYWNoZS5jbGVhcigpOwogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoKSB7\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9zYXZl\ncG9pbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50IikpOwog\nICAgICAgICAgICByb2xsYmFja1RvU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZl\ncG9pbnRzLmdldAogICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUo\nKSAtIDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncm9sbGJhY2tUb1NhdmVwb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAg\nICBpbnQgaW5kZXggPSAoX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAg\nICAgICAgICAgICAgOiBfc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7\nCiAgICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50\nIiwgc2F2ZXBvaW50KSk7CgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4g\ncmV2ZXJzZQogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAg\nICAgICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCAr\nIDEpIHsKICAgICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2lu\ndCkgX3NhdmVwb2ludHMucmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9z\nYXZlcG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5y\nZWxlYXNlKGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2\nZSA9IChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5k\nZXgpOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNhdmVkID0gc2F2ZS5yb2xs\nYmFjayhfc2F2ZXBvaW50cy52YWx1ZXMoKSk7CiAgICAgICAgICAgIGlmIChf\nc2F2ZXBvaW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zYXZl\ncG9pbnRDYWNoZS5jbGVhcigpOwogICAgICAgICAgICBpZiAoaGFzVHJhbnNh\nY3Rpb25hbE9iamVjdHMoKSkgewogICAgICAgICAgICAgICAgLy8gYnVpbGQg\ndXAgYSBuZXcgY29sbGVjdGlvbiBvZiBzdGF0ZXMKICAgICAgICAgICAgICAg\nIFRyYW5zYWN0aW9uYWxDYWNoZSBvbGRUcmFuc0NhY2hlID0gX3RyYW5zQ2Fj\naGU7CiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbmFsQ2FjaGUgbmV3VHJh\nbnNDYWNoZSA9IG5ldyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICAgICAg\nICAgICAgICAoX29yZGVyRGlydHkpOwogICAgICAgICAgICAgICAgX3RyYW5z\nQ2FjaGUgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRseSB0\naGVyZSBpcyB0aGUgYXNzdW1wdGlvbiB0aGF0IGluY3JlbWVudGFsCiAgICAg\nICAgICAgICAgICAvLyBmbHVzaCBpcyBlaXRoZXIgYSkgbm90IGFsbG93ZWQs\nIG9yIGIpIHJlcXVpcmVkCiAgICAgICAgICAgICAgICAvLyBwcmUtc2F2ZXBv\naW50LiAgdGhpcyBzb2x2ZXMgYSBudW1iZXIgb2YgaXNzdWVzIGluY2x1ZGlu\nZwogICAgICAgICAgICAgICAgLy8gc3RvcmluZyBmbHVzaGVkIHN0YXRlcyBh\ncyB3ZWxsIGFzIE9JRCBoYW5kbGluZy4KICAgICAgICAgICAgICAgIC8vIGlm\nIGZ1dHVyZSBwbHVnaW5zIGRvIG5vdCBmb2xsb3cgdGhpcywgd2UgbmVlZCB0\nbyBjYWNoZQogICAgICAgICAgICAgICAgLy8gbW9yZSBpbmZvIHBlciBzdGF0\nZQogICAgICAgICAgICAgICAgU2F2ZXBvaW50RmllbGRNYW5hZ2VyIGZtOwog\nICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc2F2ZWQuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBmbSA9IChT\nYXZlcG9pbnRGaWVsZE1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICAgICAgc20gPSBmbS5nZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAg\nICAgICAgICAgICBzbS5yb2xsYmFja1RvU2F2ZXBvaW50KGZtKTsKICAgICAg\nICAgICAgICAgICAgICBvbGRUcmFuc0NhY2hlLnJlbW92ZShzbSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3VHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBu\nZXdUcmFuc0NhY2hlLmFkZENsZWFuKHNtKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2xkVHJhbnND\nYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2soKTsKICAgICAgICAg\nICAgICAgICAgICByZW1vdmVGcm9tVHJhbnNhY3Rpb24oc20pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgb2xkVHJhbnNDYWNoZS5jbGVh\ncigpOwogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXdUcmFuc0Nh\nY2hlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBmbHVzaCgpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBy\nZXR1cm4gc2lsZW50bHkgaWYgbm8gdHJhbnMgaXMgYWN0aXZlLCBvciBpZiB0\naGlzIGlzIGEgcmVlbnRyYW50CiAgICAgICAgICAgIC8vIGNhbGwsIHdoaWNo\nIGNhbiBoYXBwZW4gaWYgdGhlIHN0b3JlIG1hbmFnZXIgdHJpZXMgdG8gZ2V0\nIGFuCiAgICAgICAgICAgIC8vIGF1dG8taW5jIG9pZCBkdXJpbmcgZmx1c2gK\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMAog\nICAgICAgICAgICAgICAgfHwgKF9mbGFncyAmIEZMQUdfU1RPUkVfRkxVU0hJ\nTkcpICE9IDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAg\nICAgICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMo\nX2NvbmYuT1BUSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQi\nKSk7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFf\nc2F2ZXBvaW50cy5pc0VtcHR5KCkKICAgICAgICAgICAgICAgICYmICFfc3Bt\nLnN1cHBvcnRzSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAg\nICAgICAgICAgICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRl\nZCIpKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmbHVz\naFNhZmUoRkxVU0hfSU5DKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX0ZMVVNIRUQ7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIG9uIGZs\ndXNoIGVycm9yOyBvYmplY3RzIG1heSBiZSBpbiBpbmNvbnNpc3RlbnQgc3Rh\ndGUKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seShrZSk7CiAgICAg\nICAgICAgICAgICB0aHJvdyBrZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICAgICAgLy8gcm9sbGJhY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5\nIGJlIGluIGluY29uc2lzdGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0\nUm9sbGJhY2tPbmx5KHJlKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcmVGbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNI\nX0xPR0lDQUwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB2YWxpZGF0ZUNoYW5nZXMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgbm8gdHJh\nbnMsIGp1c3QgcmV0dXJuOyBpZiBhY3RpdmUgZGF0YXN0b3JlIHRyYW5zLCBm\nbHVzaAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAg\nICAgICAgICBmbHVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRp\nbWUgc3VwcG9ydHMgaW5jIGZsdXNoCiAgICAgICAgICAgIGlmICghX2NvbmYu\nc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNf\nRkxVU0gpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVk\nRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbmNy\nZW1lbnRhbC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9ST0xMQkFD\nSyk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNBY3RpdmUoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgIT0gMDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNTdG9yZUFjdGl2ZSgpIHsKICAgICAgICAvLyB3ZSBuZWVk\nIHRvIGxvY2sgaGVyZSwgYmVjYXVzZSB3ZSBtaWdodCBiZSBpbiB0aGUgbWlk\nZGxlIG9mIGFuCiAgICAgICAgLy8gYXRvbWljIHRyYW5zYWN0aW9uIHByb2Nl\nc3MgKGUuZy4sIGNvbW1pdEFuZFJlc3VtZSkKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBj\ndXJyZW50IHRyYW5zYWN0aW9uIGlzIGVuZGluZywgaS5lLiBpbiB0aGUgMm5k\nIHBoYXNlCiAgICAgKiBvZiBhIGNvbW1pdCBvciByb2xsYmFjawogICAgICov\nCiAgICBib29sZWFuIGlzVHJhbnNhY3Rpb25FbmRpbmcoKSB7CiAgICAgICAg\ncmV0dXJuIChfZmxhZ3MgJiBGTEFHX1RSQU5TX0VORElORykgIT0gMDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBiZWdpbk9wZXJhdGlvbihib29sZWFu\nIHN5bmNUcmFucykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBpZiAoc3lu\nY1RyYW5zICYmIF9vcGVyYXRpb25Db3VudCA9PSAwICYmIF9zeW5jTWFuYWdl\nZAogICAgICAgICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwKQogICAgICAgICAgICAgICAgc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rp\nb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCsrID09\nIDE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE1hcmsgdGhlIG9wZXJhdGlvbiBvdmVyLiBJZiBvdXRlcm1vc3QgY2FsbGVy\nIG9mIHN0YWNrLCByZXR1cm5zIHRydWUKICAgICAqIGFuZCB3aWxsIGRldGFj\naCBtYW5hZ2VkIGluc3RhbmNlcyBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGVuZE9wZXJhdGlvbigpIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDEgJiYgKF9h\ndXRvRGV0YWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMAogICAgICAgICAg\nICAgICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKSB7CiAgICAg\nICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxsKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50IDwgMSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICByZXR1cm4gX29wZXJhdGlvbkNvdW50ID09IDE7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfb3BlcmF0\naW9uQ291bnQtLTsKICAgICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA9\nPSAwKQogICAgICAgICAgICAgICAgX29wZXJhdGluZy5jbGVhcigpOwogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIFN5bmNocm9uaXphdGlvbiBnZXRTeW5jaHJvbml6YXRpb24oKSB7CiAgICAg\nICAgcmV0dXJuIF9zeW5jOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFN5\nbmNocm9uaXphdGlvbihTeW5jaHJvbml6YXRpb24gc3luYykgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBfc3luYyA9IHN5bmM7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIFN5bmNocm9uaXphdGlv\nbiBpbnRlcmZhY2UKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgYmVmb3JlQ29t\ncGxldGlvbigpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdXNlci1zdXBwbGllZCBzeW5j\naHJvbml6YXRpb24KICAgICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfc3luYy5iZWZvcmVDb21wbGV0aW9uKCk7CgogICAg\nICAgICAgICBmbHVzaFNhZmUoRkxVU0hfQ09NTUlUKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlv\nbihrZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVy\ncm9yIiksIHJlKTsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdl\nZENvbXBsZXRpb25FeGNlcHRpb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29t\ncGxldGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2\nZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19U\nUkFOU19FTkRJTkc7CiAgICAgICAgICAgIGVuZFRyYW5zYWN0aW9uKHN0YXR1\ncyk7CiAgICAgICAgICAgIGlmIChfc3luYyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3N5bmMuYWZ0ZXJDb21wbGV0aW9uKHN0YXR1cyk7CgogICAgICAg\nICAgICBpZiAoKF9hdXRvRGV0YWNoICYgREVUQUNIX0NPTU1JVCkgIT0gMCkK\nICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwpOwogICAg\nICAgICAgICBlbHNlIGlmIChzdGF0dXMgPT0gU3RhdHVzLlNUQVRVU19ST0xM\nRURCQUNLIAogICAgICAgICAgICAgICAgJiYgKF9hdXRvRGV0YWNoICYgREVU\nQUNIX1JPTExCQUNLKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBkZXRhY2hB\nbGxJbnRlcm5hbChudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaW4gYW4gZWUgY29udGV4dCwgaXQncyBwb3NzaWJsZSB0aGF0IHRoZSB1\nc2VyIHRyaWVkIHRvIGNsb3NlCiAgICAgICAgICAgIC8vIHVzIGJ1dCB3ZSBk\naWRuJ3QgYWN0dWFsbHkgY2xvc2UgYmVjYXVzZSB3ZSB3ZXJlIHdhaXRpbmcg\nb24gdGhpcwogICAgICAgICAgICAvLyB0cmFuc2FjdGlvbjsgaWYgdGhhdCdz\nIHRydWUsIHRoZW4gY2xvc2Ugbm93CiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19DTE9TRV9JTlZPS0VEKSAhPSAwCiAgICAgICAgICAgICAgICAm\nJiBfY29tcGF0LmdldENsb3NlT25NYW5hZ2VkQ29tbWl0KCkpCiAgICAgICAg\nICAgICAgICBmcmVlKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5k\nLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cgdHJhbnNs\nYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRpb24oa2UpOwogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCByZSk7CiAgICAg\nICAgICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0\naW9uKG5ldyBTdG9yZUV4Y2VwdGlvbihyZSkpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19BQ1RJVkU7CiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEOwogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfVFJBTlNfRU5ESU5HOwoKICAgICAgICAgICAgLy8g\nZXZlbnQgbWFuYWdlciBudWxsZWQgaWYgZnJlZWQgYnJva2VyCiAgICAgICAg\nICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIgIT0gbnVsbCAKICAgICAgICAg\nICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMo\nKSkgewogICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3\nIFRyYW5zYWN0aW9uRXZlbnQodGhpcywKICAgICAgICAgICAgICAgICAgICBz\ndGF0dXMgPT0gU3RhdHVzLlNUQVRVU19DT01NSVRURUQKICAgICAgICAgICAg\nICAgICAgICAgICAgPyBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NPTU1JVF9D\nT01QTEVURQogICAgICAgICAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9u\nRXZlbnQuQUZURVJfUk9MTEJBQ0tfQ09NUExFVEUsCiAgICAgICAgICAgICAg\nICAgICAgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCkpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJZiB3ZSdyZSBpbiBhIG1hbmFnZWQgdHJhbnNh\nY3Rpb24sIHVzZSBvdXIgaW1wbGljaXQgYmVoYXZpb3IgZXhjZXB0aW9uCiAg\nICAgKiB0cmFuc2xhdG9yIHRvIHRyYW5zbGF0ZSBiZWZvcmUvYWZ0ZXJDb21w\nbGV0aW9uIGNhbGxiYWNrIGVycm9ycy4KICAgICAqLwogICAgcHJpdmF0ZSBS\ndW50aW1lRXhjZXB0aW9uIHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhj\nZXB0aW9uCiAgICAgICAgKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICByZXR1cm4gKCFfbWFuYWdlZCB8fCBfZXh0cmFucyA9PSBudWxsKSA/IHJl\nIDogX2V4dHJhbnMudHJhbnNsYXRlKHJlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEZsdXNoIHNhZmVseSwgY2F0Y2hpbmcgcmVlbnRyYW50IGNhbGxzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgZmx1c2hTYWZlKGludCByZWFzb24p\nIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfRkxVU0hJTkcpICE9IDAp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoInJlZW50cmFudC1mbHVzaCIpKTsKCiAgICAgICAgX2ZsYWdz\nIHw9IEZMQUdfRkxVU0hJTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nZmx1c2gocmVhc29uKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hJTkc7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogRmx1c2ggdGhlIHRyYW5zYWN0aW9uYWwgc3RhdGUg\ndG8gdGhlIGRhdGEgc3RvcmUuIFN1YmNsYXNzZXMgdGhhdAogICAgICogY3Vz\ndG9taXplIGNvbW1pdCBiZWhhdmlvciBzaG91bGQgb3ZlcnJpZGUgdGhpcyBt\nZXRob2QuIFRoZSBtZXRob2QKICAgICAqIGFzc3VtZXMgdGhhdCB0aGUgcGVy\nc2lzdGVuY2UgbWFuYWdlciBpcyBsb2NrZWQsIGlzIG5vdCBjbG9zZWQsCiAg\nICAgKiBhbmQgaGFzIGFuIGFjdGl2ZSB0cmFuc2FjdGlvbi4KICAgICAqCiAg\nICAgKiBAcGFyYW0gcmVhc29uIG9uZSBvZiB7QGxpbmsgI0ZMVVNIX0lOQ30s\nIHtAbGluayAjRkxVU0hfQ09NTUlUfSwKICAgICAqIHtAbGluayAjRkxVU0hf\nUk9MTEJBQ0t9LCBvciB7QGxpbmsgI0ZMVVNIX0xPR0lDQUx9CiAgICAgKiBA\nc2luY2UgMC4yLjUKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZmx1c2go\naW50IHJlYXNvbikgewogICAgICAgIC8vIHRoaXMgd2lsbCBlbmxpc3QgcHJv\neGllZCBzdGF0ZXMgYXMgbmVjZXNzYXJ5IHNvIHdlIGtub3cgd2hldGhlciB3\nZQogICAgICAgIC8vIGhhdmUgYW55dGhpbmcgdG8gZmx1c2gKICAgICAgICBD\nb2xsZWN0aW9uIHRyYW5zYWN0aW9uYWwgPSBnZXRUcmFuc2FjdGlvbmFsU3Rh\ndGVzKCk7CgogICAgICAgIC8vIGRvIHdlIGFjdHVhbGx5IGhhdmUgdG8gZmx1\nc2g/ICBvbmx5IGlmIG91ciBmbGFncyBzYXkgc28sIG9yIGlmCiAgICAgICAg\nLy8gd2UgaGF2ZSB0cmFuc2FjdGlvbiBsaXN0ZW5lcnMgdGhhdCBuZWVkIHRv\nIGJlIGludm9rZWQgZm9yIGNvbW1pdAogICAgICAgIC8vIChubyBuZWVkIHRv\nIGludm9rZSB0aGVtIG9uIGluYyBmbHVzaCBpZiBub3RoaW5nIGlzIGRpcnR5\nKS4gIHdlCiAgICAgICAgLy8gc3BlY2lhbCBjYXNlIHRoZSByZW1vdGUgY29t\nbWl0IGxpc3RlbmVyIHVzZWQgYnkgdGhlIGRhdGFjYWNoZSBjYXVzZQogICAg\nICAgIC8vIHdlIGtub3cgaXQgZG9lc24ndCByZXF1aXJlIHRoZSBjb21taXQg\nZXZlbnQgd2hlbiBub3RoaW5nIGNoYW5nZXMKICAgICAgICBib29sZWFuIGZs\ndXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7CiAg\nICAgICAgYm9vbGVhbiBsaXN0ZW5lcnMgPSAoX3RyYW5zRXZlbnRNYW5hZ2Vy\nLmhhc0ZsdXNoTGlzdGVuZXJzKCkKICAgICAgICAgICAgfHwgX3RyYW5zRXZl\nbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKQogICAgICAgICAgICAmJiAo\nKF9mbGFncyAmIEZMQUdfUkVNT1RFX0xJU1RFTkVSKSA9PSAwCiAgICAgICAg\nICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5nZXRMaXN0ZW5lcnMoKS5zaXpl\nKCkgPiAxKTsKICAgICAgICBpZiAoIWZsdXNoICYmIChyZWFzb24gIT0gRkxV\nU0hfQ09NTUlUIHx8ICFsaXN0ZW5lcnMpKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIENvbGxlY3Rpb24gbW9ianMgPSBudWxsOwogICAgICAgIF9m\nbGFncyB8PSBGTEFHX1BSRVNUT1JJTkc7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKGZsdXNoKSB7CiAgICAgICAgICAgICAgICAvLyBjYWxsIHBy\nZSBzdG9yZSBvbiBhbGwgY3VycmVudGx5IHRyYW5zYWN0aW9uYWwgb2Jqcwog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0cmFuc2FjdGlv\nbmFsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuYmVmb3Jl\nRmx1c2gocmVhc29uLCBfY2FsbCk7CiAgICAgICAgICAgICAgICBmbHVzaEFk\nZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBob3BlZnVsbHkgbm93IGFsbCBkZXBlbmRlbnQg\naW5zdGFuY2VzIHRoYXQgYXJlIGdvaW5nIHRvIGVuZAogICAgICAgICAgICAv\nLyB1cCByZWZlcmVuY2VkIGhhdmUgYmVlbiBtYXJrZWQgYXMgc3VjaDsgZGVs\nZXRlIHVucmVmZWQKICAgICAgICAgICAgLy8gZGVwZW5kZW50cwogICAgICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19ERVJFRkRFTEVUSU5HOwogICAgICAgICAg\nICBpZiAoZmx1c2ggJiYgX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhX2RlcmVm\nQ2FjaGUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IF9kZXJlZkNhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZURlcmVmKChTdGF0ZU1h\nbmFnZXJJbXBsKSBpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgIGZsdXNo\nQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkg\newogICAgICAgICAgICAgICAgLy8gaWYgbm8gZGF0YXN0b3JlIHRyYW5zYWN0\naW9uLCBzdGFydCBvbmU7IGV2ZW4gaWYgd2UgZG9uJ3QKICAgICAgICAgICAg\nICAgIC8vIHRoaW5rIHdlJ2xsIG5lZWQgdG8gZmx1c2ggYXQgdGhpcyBwb2lu\ndCwgb3VyIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5l\ncnMgbWlnaHQgaW50cm9kdWNlIHNvbWUgZGlydHkgb2JqZWN0cyBvciBpbnRl\ncmFjdAogICAgICAgICAgICAgICAgLy8gZGlyZWN0bHkgd2l0aCB0aGUgZGF0\nYWJhc2UKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9S\nRV9BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICAgICAgYmVnaW5TdG9y\nZU1hbmFnZXJUcmFuc2FjdGlvbihmYWxzZSk7CgogICAgICAgICAgICAgICAg\naWYgKChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQog\nICAgICAgICAgICAgICAgICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNF\nbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgICAgICAgICAmJiAoZmx1c2gg\nfHwgcmVhc29uID09IEZMVVNIX0NPTU1JVCkpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBmaXJlIGV2ZW50cwogICAgICAgICAgICAgICAgICAgIG1vYmpz\nID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5zYWN0aW9uYWwp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfQ09N\nTUlUCiAgICAgICAgICAgICAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFu\nYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVu\ndCh0aGlzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0\naW9uRXZlbnQuQkVGT1JFX0NPTU1JVCwgbW9ianMsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBf\nZGVsZXRlZENsc3MpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNo\nQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGZsdXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVR\nVUlSRUQpICE9IDA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICBpZiAoZmx1c2ggJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhh\nc0ZsdXNoTGlzdGVuZXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhp\ncywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2\nZW50LkJFRk9SRV9GTFVTSCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRl\nZENsc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlv\nbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19QUkVTVE9SSU5HOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVS\nRUZERUxFVElORzsKICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbnVs\nbDsKICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25zID0gbnVsbDsKCiAgICAg\nICAgICAgIC8vIGFsc28gY2xlYXIgZGVyZWZlZCBzZXQ7IHRoZSBkZWxldGVz\nIGhhdmUgYmVlbiByZWNvcmRlZAogICAgICAgICAgICBpZiAoX2RlcmVmQ2Fj\naGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlLmNsZWFy\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBmbHVzaCB0byBzdG9yZSBtYW5h\nZ2VyCiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfTE9H\nSUNBTCkgewogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVf\nRkxVU0hJTkc7CiAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBz\nLAogICAgICAgICAgICAgICAgICAgIG5ld0ZsdXNoRXhjZXB0aW9uKF9zdG9y\nZS5mbHVzaCh0cmFuc2FjdGlvbmFsKSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NU\nT1JFX0ZMVVNISU5HOwoKICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVT\nSF9ST0xMQkFDSykKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKHRydWUpKTsKICAgICAg\nICAgICAgZWxzZSBpZiAocmVhc29uICE9IEZMVVNIX0xPR0lDQUwpCiAgICAg\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hfUkVRVUlSRUQ7Cgog\nICAgICAgICAgICAvLyBtYXJrIHN0YXRlcyBhcyBmbHVzaGVkCiAgICAgICAg\nICAgIGlmIChmbHVzaCkgewogICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbTsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\ndHJhbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gdGhlIHN0YXRlIG1heSBoYXZlIGJlY29tZSB0\ncmFuc2llbnQsIHN1Y2ggYXMgaWYKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gaXQgaXMgZW1iZWRkZWQgYW5kIHRoZSBvd25lciBoYXMgYmVlbiBkZWxl\ndGVkIGR1cmluZwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZs\ndXNoIHByb2Nlc3M7IGJ1ZyAjMTEwMAogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAgICAgICAgICAgICBzbS5hZnRlckZsdXNoKHJlYXNvbik7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfSU5DKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBub3QgYWJvdXQg\ndG8gY2xlYXIgdHJhbnMgY2FjaGUgZm9yIGNvbW1pdCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGFueXdheSwgcmUtY2FjaGUgZGlydHkgb2Jq\nZWN0cyB3aXRoIGRlZmF1bHQgc29mdAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gcmVmczsgd2UgZG9uJ3QgbmVlZCBoYXJkIHJlZnMgbm93IHRo\nYXQgdGhlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdl\ncyBoYXZlIGJlZW4gZmx1c2hlZAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgc20ucHJveHlGaWVsZHModHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUuZmx1c2hlZChzbSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBl\neGNlcHMgPSBhZGQoZXhjZXBzLCBlKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIHRocm93IGFueSBleGNlcHRpb25zIHRvIHNob3J0Y3V0IGxp\nc3RlbmVycyBvbiBmYWlsCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25z\nKGV4Y2VwcywgdHJ1ZSk7CgogICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24g\nIT0gRkxVU0hfUk9MTEJBQ0sgJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwK\nICAgICAgICAgICAgJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlz\ndGVuZXJzKCkpIHsKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQo\nbmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywKICAgICAgICAgICAgICAgIFRy\nYW5zYWN0aW9uRXZlbnQuQUZURVJfRkxVU0gsIG1vYmpzLCBfcGVyc2lzdGVk\nQ2xzcywKICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRD\nbHNzKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmx1c2gg\nbmV3bHktdHJhbnNhY3Rpb25hbCBvYmplY3RzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZmx1c2hBZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFuc2FjdGlv\nbmFsLCBpbnQgcmVhc29uKSB7CiAgICAgICAgYm9vbGVhbiBsb29wOwogICAg\nICAgIGRvIHsKICAgICAgICAgICAgLy8gZmx1c2ggbmV3IHRyYW5zYWN0aW9u\nYWwgaW5zdGFuY2VzOyBub3RlIGxvZ2ljYWwgb3IKICAgICAgICAgICAgbG9v\ncCA9IGZsdXNoVHJhbnNBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29u\nKQogICAgICAgICAgICAgICAgfCBkZWxldGVEZXJlZkFkZGl0aW9ucyhfZGVy\nZWZDYWNoZSk7CiAgICAgICAgfSB3aGlsZSAobG9vcCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGbHVzaCB0cmFuc2FjdGlvbmFsIGFkZGl0aW9ucy4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGZsdXNoVHJhbnNBZGRpdGlvbnMo\nQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsLCBpbnQgcmVhc29uKSB7CiAgICAg\nICAgaWYgKF90cmFuc0FkZGl0aW9ucyA9PSBudWxsIHx8IF90cmFuc0FkZGl0\naW9ucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgLy8ga2VlcCBsb2NhbCB0cmFuc2FjdGlvbmFsIGxpc3QgY29weSB1\ncCB0byBkYXRlCiAgICAgICAgdHJhbnNhY3Rpb25hbC5hZGRBbGwoX3RyYW5z\nQWRkaXRpb25zKTsKCiAgICAgICAgLy8gY29weSB0aGUgY2hhbmdlIHNldCwg\ndGhlbiBjbGVhciBpdCBmb3IgdGhlIG5leHQgaXRlcmF0aW9uCiAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbFtdIHN0YXRlcyA9IChTdGF0ZU1hbmFnZXJJbXBs\nW10pIF90cmFuc0FkZGl0aW9ucy4KICAgICAgICAgICAgdG9BcnJheShuZXcg\nU3RhdGVNYW5hZ2VySW1wbFtfdHJhbnNBZGRpdGlvbnMuc2l6ZSgpXSk7CiAg\nICAgICAgX3RyYW5zQWRkaXRpb25zLmNsZWFyKCk7CgogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBzdGF0ZXNbaV0uYmVmb3JlRmx1c2gocmVhc29uLCBfY2FsbCk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUg\nbmV3IGRlcmVmZXJlbmNlZCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gZGVsZXRlRGVyZWZBZGRpdGlvbnMoQ29sbGVjdGlvbiBkZXJl\nZnMpIHsKICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zID09IG51bGwgfHwg\nX2RlcmVmQWRkaXRpb25zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICAvLyByZW1lbWJlciB0aGVzZSBhZGRpdGlvbnMg\naW4gY2FzZSBvbmUgYmVjb21lcyBkZXJlZmVkIGFnYWluIGxhdGVyCiAgICAg\nICAgZGVyZWZzLmFkZEFsbChfZGVyZWZBZGRpdGlvbnMpOwoKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsW10gc3RhdGVzID0gKFN0YXRlTWFuYWdlckltcGxb\nXSkgX2RlcmVmQWRkaXRpb25zLgogICAgICAgICAgICB0b0FycmF5KG5ldyBT\ndGF0ZU1hbmFnZXJJbXBsW19kZXJlZkFkZGl0aW9ucy5zaXplKCldKTsKICAg\nICAgICBfZGVyZWZBZGRpdGlvbnMuY2xlYXIoKTsKCiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGRlbGV0ZURlcmVmKHN0YXRlc1tpXSk7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgYSBkZXJlZmVyZW5jZWQg\nZGVwZW5kZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZGVsZXRlRGVy\nZWYoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGludCBhY3Rpb24g\nPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLAogICAg\nICAgICAgICBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgc20sIG51bGwpOwog\nICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0g\nMCkKICAgICAgICAgICAgc20uZGVsZXRlKCk7CiAgICAgICAgaWYgKChhY3Rp\nb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0gMCkKICAgICAgICAg\nICAgc20uY2FzY2FkZURlbGV0ZShfY2FsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZXRlcm1pbmUgdGhlIGFjdGlvbiB0byB0YWtlIGJhc2VkIG9uIHRo\nZSB1c2VyJ3MgZ2l2ZW4gY2FsbGJhY2tzIGFuZAogICAgICogb3VyIGltcGxp\nY2l0IGJlaGF2aW9yLgogICAgICovCiAgICBwcml2YXRlIGludCBwcm9jZXNz\nQXJndW1lbnQoaW50IG9wLCBPYmplY3Qgb2JqLCBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAoY2FsbCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9j\nZXNzQXJndW1lbnQob3AsIG9iaiwgc20pOwogICAgICAgIGlmIChfY2FsbCAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2NhbGwucHJvY2Vzc0FyZ3Vt\nZW50KG9wLCBvYmosIHNtKTsKICAgICAgICByZXR1cm4gT3BDYWxsYmFja3Mu\nQUNUX1JVTiB8IE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhyb3cgdGhlIHByb3BlciBleGNlcHRpb24gYmFzZWQg\nb24gdGhlIGdpdmVuIHNldCBvZiBmbHVzaCBlcnJvcnMsIG9yCiAgICAgKiBk\nbyBub3RoaW5nIGlmIG5vIGVycm9ycyBvY2N1cnJlZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBPcGVuSlBBRXhjZXB0aW9uIG5ld0ZsdXNoRXhjZXB0aW9uKENv\nbGxlY3Rpb24gZXhjZXBzKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9PSBudWxs\nIHx8IGV4Y2Vwcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBUaHJvd2FibGVbXSB0ID0gKFRocm93YWJsZVtdKSBleGNl\ncHMudG9BcnJheQogICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMu\nc2l6ZSgpXSk7CiAgICAgICAgTGlzdCBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0\nKHQubGVuZ3RoKTsKCiAgICAgICAgLy8gY3JlYXRlIGZhdGFsIGV4Y2VwdGlv\nbiB3aXRoIG5lc3RlZCBleGNlcHRpb25zIGZvciBhbGwgdGhlIGZhaWxlZAog\nICAgICAgIC8vIG9iamVjdHM7IGlmIGFsbCBPTCBleGNlcHRpb25zLCB0aHJv\ndyBhIHRvcC1sZXZlbCBPTCBleGNlcHRpb24KICAgICAgICBib29sZWFuIG9w\ndCA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IG9wdCAmJiBpIDwg\ndC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBvcHQgPSB0W2ldIGluc3Rh\nbmNlb2YgT3B0aW1pc3RpY0V4Y2VwdGlvbjsKICAgICAgICAgICAgaWYgKG9w\ndCkgewogICAgICAgICAgICAgICAgT2JqZWN0IGYgPSAoKE9wdGltaXN0aWNF\neGNlcHRpb24pIHRbaV0pLmdldEZhaWxlZE9iamVjdCgpOwogICAgICAgICAg\nICAgICAgaWYgKGYgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmYWls\nZWQuYWRkKGYpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlm\nIChvcHQgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQsIHQpOwogICAgICAg\nIGlmIChvcHQpCiAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4\nY2VwdGlvbih0KTsKICAgICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyb2xsZWQtYmFjayIpKS4KICAgICAgICAgICAgc2V0TmVz\ndGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEVuZCB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiwgbWFraW5n\nIGFwcHJvcHJpYXRlIHN0YXRlIHRyYW5zaXRpb25zLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBlbmRUcmFuc2FjdGlvbihpbnQgc3RhdHVzKSB7CiAg\nICAgICAgLy8gaWYgYSBkYXRhIHN0b3JlIHRyYW5zYWN0aW9uIHdhcyBpbiBw\ncm9ncmVzcywgZG8gdGhlCiAgICAgICAgLy8gYXBwcm9wcmlhdGUgdHJhbnNh\nY3Rpb24gY2hhbmdlCiAgICAgICAgYm9vbGVhbiByb2xsYmFjayA9IHN0YXR1\ncyAhPSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRDsKICAgICAgICBMaXN0IGV4\nY2VwcyA9IG51bGw7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGV4Y2Vw\ncyA9IGFkZChleGNlcHMsIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKHJv\nbGxiYWNrKSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICByb2xsYmFjayA9IHRydWU7CiAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGdvIGJhY2sgdG8gZGVmYXVsdCBub25lIGxvY2sgbGV2ZWwKICAgICAg\nICBfZmMuc2V0UmVhZExvY2tMZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9m\nYy5zZXRXcml0ZUxvY2tMZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9mYy5z\nZXRMb2NrVGltZW91dCgtMSk7CgogICAgICAgIENvbGxlY3Rpb24gdHJhbnNT\ndGF0ZXM7CiAgICAgICAgaWYgKGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkp\nCiAgICAgICAgICAgIHRyYW5zU3RhdGVzID0gX3RyYW5zQ2FjaGU7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICB0cmFuc1N0YXRlcyA9IENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1Q7CgogICAgICAgIC8vIGZpcmUgYWZ0ZXIgcm9sbGJhY2sv\nY29tbWl0IGV2ZW50CiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7\nCiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5l\ncnMoKSkgewogICAgICAgICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0\nQ29sbGVjdGlvbih0cmFuc1N0YXRlcyk7CiAgICAgICAgICAgIGludCBldmVu\ndFR5cGUgPSAocm9sbGJhY2spID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9S\nT0xMQkFDSwogICAgICAgICAgICAgICAgOiBUcmFuc2FjdGlvbkV2ZW50LkFG\nVEVSX0NPTU1JVDsKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQo\nbmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywgZXZlbnRUeXBlLCBtb2Jqcywg\nCiAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNz\nLCBfZGVsZXRlZENsc3MpKTsKICAgICAgICB9CgogICAgICAgIC8vIG51bGwg\ndHJhbnNhY3Rpb25hbCBjYWNoZXMgbm93IHNvIHRoYXQgYWxsIHRoZSByZW1v\ndmVGcm9tVHJhbnNhY3Rpb24KICAgICAgICAvLyBjYWxscyBhcyB3ZSB0cmFu\nc2l0aW9uIGVhY2ggb2JqZWN0IGRvbid0IGhhdmUgdG8gZG8gYW55IHdvcms7\nIGRvbid0CiAgICAgICAgLy8gY2xlYXIgdHJhbnMgY2FjaGUgb2JqZWN0IGJl\nY2F1c2Ugd2Ugc3RpbGwgbmVlZCB0aGUgdHJhbnNTdGF0ZXMKICAgICAgICAv\nLyByZWZlcmVuY2UgdG8gaXQgYmVsb3cKICAgICAgICBfdHJhbnNDYWNoZSA9\nIG51bGw7CiAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzICE9IG51bGwpCiAg\nICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLmNsZWFyKCk7CiAgICAgICAgaWYg\nKF91cGRhdGVkQ2xzcyAhPSBudWxsKQogICAgICAgICAgICBfdXBkYXRlZENs\nc3MuY2xlYXIoKTsKICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzICE9IG51bGwp\nCiAgICAgICAgICAgIF9kZWxldGVkQ2xzcy5jbGVhcigpOwoKICAgICAgICAv\nLyBuZXcgY2FjaGUgd291bGQgZ2V0IGNsZWFyZWQgYW55d2F5IGR1cmluZyB0\ncmFuc2l0aW9ucywgYnV0IGRvaW5nIHNvCiAgICAgICAgLy8gaW1tZWRpYXRl\nbHkgc2F2ZXMgdXMgc29tZSBsb29rdXBzCiAgICAgICAgX2NhY2hlLmNsZWFy\nTmV3KCk7CgogICAgICAgIC8vIHRlbGwgYWxsIGRlcmVmZWQgaW5zdGFuY2Vz\nIHRoZXkncmUgbm8gbG9uZ2VyIGRlcmVmZWQ7IHdlIGNhbid0CiAgICAgICAg\nLy8gcmVseSBvbiByb2xsYmFjayBhbmQgY29tbWl0IGNhbGxzIGJlbG93IGNh\ndXNlIHNvbWUgaW5zdGFuY2VzIG1pZ2h0CiAgICAgICAgLy8gbm90IGJlIHRy\nYW5zYWN0aW9uYWwKICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAm\nJiAhX2RlcmVmQ2FjaGUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX2RlcmVmQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwp\nIGl0ci5uZXh0KCkpLnNldERlcmVmZXJlbmNlZERlcGVuZGVudAogICAgICAg\nICAgICAgICAgICAgIChmYWxzZSwgZmFsc2UpOwogICAgICAgICAgICBfZGVy\nZWZDYWNoZS5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAgLy8gcGVmb3Jt\nIGNvbW1pdCBvciByb2xsYmFjayBzdGF0ZSB0cmFuc2l0aW9ucyBvbiBlYWNo\nIGluc3RhbmNlCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zU3RhdGVzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFu\nYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBpZiAocm9sbGJhY2spIHsKICAgICAgICAgICAgICAgICAg\nICAvLyB0ZWxsIG9iamVjdHMgdGhhdCBtYXkgaGF2ZSBiZWVuIGRlcmVmZWQg\ndGhlbiBmbHVzaGVkCiAgICAgICAgICAgICAgICAgICAgLy8gKGFuZCB0aGVy\nZWZvcmUgZGVsZXRlZCkgdG8gdW4tZGVyZWYKICAgICAgICAgICAgICAgICAg\nICBzbS5zZXREZXJlZmVyZW5jZWREZXBlbmRlbnQoZmFsc2UsIGZhbHNlKTsK\nICAgICAgICAgICAgICAgICAgICBzbS5yb2xsYmFjaygpOwogICAgICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgc20uY29tbWl0KCk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90aWZ5IHRoZSBs\nb2NrIG1hbmFnZXIgdG8gY2xlYW4gdXAgYW5kIHJlbGVhc2UgcmVtYWluaW5n\nIGxvY2tzCiAgICAgICAgX2xtLmVuZFRyYW5zYWN0aW9uKCk7CgogICAgICAg\nIC8vIGNsZWFyIG9sZCBzYXZlcG9pbnRzIGluIHJldmVyc2UKICAgICAgICBP\ncGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAgICAgd2hpbGUgKF9zYXZlcG9p\nbnRzICE9IG51bGwgJiYgX3NhdmVwb2ludHMuc2l6ZSgpID4gMCkgewogICAg\nICAgICAgICBzYXZlID0KICAgICAgICAgICAgICAgIChPcGVuSlBBU2F2ZXBv\naW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoX3NhdmVwb2ludHMuc2l6ZSgpIC0g\nMSk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAg\nfQogICAgICAgIF9zYXZlcG9pbnRzID0gbnVsbDsKICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUgPSBudWxsOwoKICAgICAgICAvLyBmaXJlIGFmdGVyIHN0YXRl\nIGNoYW5nZSBldmVudAogICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIu\naGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlv\nbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsIFRyYW5zYWN0aW9u\nRXZlbnQuCiAgICAgICAgICAgICAgICBBRlRFUl9TVEFURV9UUkFOU0lUSU9O\nUywgbW9ianMsIG51bGwsIG51bGwsIG51bGwpKTsKCiAgICAgICAgLy8gbm93\nIGNsZWFyIHRyYW5zIGNhY2hlOyBrZWVwIGNsZWFyZWQgdmVyc2lvbiByYXRo\nZXIgdGhhbgogICAgICAgIC8vIG51bGwgdG8gYXZvaWQgaGF2aW5nIHRvIHJl\nLWNyZWF0ZSB0aGUgc2V0IGxhdGVyOyBtb3JlIGVmZmljaWVudAogICAgICAg\nIGlmICh0cmFuc1N0YXRlcyAhPSBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUKSB7\nCiAgICAgICAgICAgIF90cmFuc0NhY2hlID0gKFRyYW5zYWN0aW9uYWxDYWNo\nZSkgdHJhbnNTdGF0ZXM7CiAgICAgICAgICAgIF90cmFuc0NhY2hlLmNsZWFy\nKCk7CiAgICAgICAgfQoKICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMo\nZXhjZXBzLCB0cnVlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gT2JqZWN0IGxpZmVjeWNsZQogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0KE9iamVjdCBvYmosIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBwZXJzaXN0KG9iaiwgbnVsbCwg\ndHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgcGVyc2lzdChPYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHJldHVybiBwZXJzaXN0KG9i\naiwgaWQsIHRydWUsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBl\ncnNpc3RBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgcGVyc2lzdEFsbChvYmpzLCB0cnVlLCBjYWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdHMuICBJ\nbmRpY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNpc3QK\nICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BS\nT1ZJU0lPTkFMKS4KICAgICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdEFs\nbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZXhwbGljaXQsIAogICAgICAg\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7Cgog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgcGVyc2lzdChpdHIubmV4dCgpLCBleHBsaWNp\ndCwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0\naW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNl\ncHMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBnaXZl\nbiBlbGVtZW50IGlzIG5vdCBudWxsLCBhZGQgaXQgdG8gdGhlIGdpdmVuIGxp\nc3QsCiAgICAgKiBjcmVhdGluZyB0aGUgbGlzdCBpZiBuZWNlc3NhcnkuCiAg\nICAgKi8KICAgIHByaXZhdGUgTGlzdCBhZGQoTGlzdCBsLCBPYmplY3Qgbykg\newogICAgICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBs\nOwogICAgICAgIGlmIChsID09IG51bGwpCiAgICAgICAgICAgIGwgPSBuZXcg\nTGlua2VkTGlzdCgpOwogICAgICAgIGwuYWRkKG8pOwogICAgICAgIHJldHVy\nbiBsOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9u\nIHdyYXBwaW5nIHRoZSBnaXZlbiBuZXN0ZWQgZXhjZXB0aW9ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHRocm93TmVzdGVkRXhjZXB0aW9ucyhMaXN0\nIGV4Y2VwcywgYm9vbGVhbiBkYXRhc3RvcmUpIHsKICAgICAgICBpZiAoZXhj\nZXBzID09IG51bGwgfHwgZXhjZXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIGlmIChkYXRhc3RvcmUgJiYgZXhjZXBzLnNpemUo\nKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2VwdGlvbikg\nZXhjZXBzLmdldCgwKTsKCiAgICAgICAgYm9vbGVhbiBmYXRhbCA9IGZhbHNl\nOwogICAgICAgIFRocm93YWJsZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4Y2Vw\ncy50b0FycmF5CiAgICAgICAgICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5z\naXplKCldKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHQubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRbaV0gaW5zdGFuY2VvZiBPcGVu\nSlBBRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAmJiAoKE9wZW5KUEFFeGNl\ncHRpb24pIHRbaV0pLmlzRmF0YWwoKSkKICAgICAgICAgICAgICAgIGZhdGFs\nID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBl\ncnI7CiAgICAgICAgaWYgKGRhdGFzdG9yZSkKICAgICAgICAgICAgZXJyID0g\nbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBzIikp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZXJyID0gbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7CiAgICAgICAgdGhy\nb3cgZXJyLnNldE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0YWwoZmF0YWwp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2Jq\nZWN0LiAgSW5kaWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBw\nZXJzaXN0CiAgICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3Qg\nKFBORVdQUk9WSVNJT05BTCkKICAgICAqLwogICAgcHVibGljIHZvaWQgcGVy\nc2lzdChPYmplY3Qgb2JqLCBib29sZWFuIGV4cGxpY2l0LCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgcGVyc2lzdChvYmosIG51bGwsIGV4cGxpY2l0\nLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdp\ndmVuIG9iamVjdC4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhw\nbGljaXQgcGVyc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBw\nZXJzaXN0IChQTkVXUFJPVklTSU9OQUwpLgogICAgICogU2VlIHtAbGluayBC\ncm9rZXJ9IGZvciBkZXRhaWxzIG9uIHRoaXMgbWV0aG9kLgogICAgICovCiAg\nICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBv\nYmosIE9iamVjdCBpZCwgYm9vbGVhbiBleHBsaWNpdCwKICAgICAgICBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVP\ncGVyYXRpb24oKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAg\nIGlmICghX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBzbTsKCiAgICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJn\ndW1lbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBzbSwgY2FsbCk7\nCiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05P\nTkUpCiAgICAgICAgICAgICAgICByZXR1cm4gc207CgogICAgICAgICAgICAv\nLyBBQ1RfQ0FTQ0FERQogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChz\nbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJz\naXN0KGNhbGwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lT\nVCwgb2JqLCBjYWxsLAogICAgICAgICAgICAgICAgICAgICAgICAicGVyc2lz\ndCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBBQ1RfUlVOCiAgICAgICAgICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYzsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihf\nbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNpc3QtZGV0\nYWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CgogICAgICAg\nICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBzbS5wZXJzaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgX2Nh\nY2hlLnBlcnNpc3Qoc20pOwogICAgICAgICAgICAgICAgICAgIGlmICgoYWN0\naW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICAvLyBhbiBlbWJlZGRlZCBmaWVsZDsgbm90aWZ5\nIHRoZSBvd25lciB0aGF0IHRoZSB2YWx1ZSBoYXMKICAgICAgICAgICAgICAg\nIC8vIGNoYW5nZWQgYnkgYmVjb21pbmcgaW5kZXBlbmRlbnRseSBwZXJzaXN0\nZW50CiAgICAgICAgICAgICAgICBzbS5nZXRPd25lcigpLmRpcnR5KHNtLmdl\ndE93bmVyTWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAgICBnZXRGaWVs\nZE1ldGFEYXRhKCkuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBfY2Fj\naGUucGVyc2lzdChzbSk7CiAgICAgICAgICAgICAgICBwYyA9IHNtLmdldFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2Jq\nKTsKICAgICAgICAgICAgICAgIGlmIChwYy5wY0lzRGV0YWNoZWQoKSA9PSBC\nb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9i\namVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAg\nICAgICAgICAoInBlcnNpc3QtZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3Ry\naW5nKG9iaikpKS4KICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVk\nT2JqZWN0KG9iaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUlu\nc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0\nQ2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChvYmosIG51bGwsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9QRVJTSVNUKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBpZCBmb3Ig\naW5zdGFuY2UKICAgICAgICAgICAgaWYgKGlkID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNz\nTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICAgICAg\naWQgPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUocGMsIG1ldGEpOwogICAgICAg\nICAgICAgICAgZWxzZSBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBD\nbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93\nbmlkIiwgbWV0YSkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhp\ncyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3\nZSBkb24ndCBhbHJlYWR5IGhhdmUgdGhlIGluc3RhbmNlIGNhY2hlZAogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG90aGVyID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbEJ5SWQoaWQsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKG90aGVy\nICE9IG51bGwgJiYgIW90aGVyLmlzRGVsZXRlZCgpICYmICFvdGhlci5pc05l\ndygpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4\nY2VwdGlvbihfbG9jLmdldCgiY2FjaGUtZXhpc3RzIiwKICAgICAgICAgICAg\nICAgICAgICBvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCksIGlkKSkuc2V0RmFp\nbGVkT2JqZWN0KG9iaik7CgogICAgICAgICAgICAvLyBpZiBoYWQgZW1iZWRk\nZWQgc20sIG51bGwgaXQKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7\nCgogICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHNtCiAgICAgICAgICAgIHNt\nID0gbmV3IFN0YXRlTWFuYWdlckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAg\nICAgICAgICAgICAgICBpZiAoZXhwbGljaXQpCiAgICAgICAgICAgICAgICAg\nICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVXKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXpl\nKHBjLCBQQ1N0YXRlLlBORVdQUk9WSVNJT05BTCk7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0\nZS5QTk9OVFJBTlNORVcpOwogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9w\nQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAgICAgICAgICAgICAg\nc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAgIHJldHVybiBz\nbTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlbXBvcmFyaWx5IG1hbmFnZSB0aGUgZ2l2ZW4gaW5zdGFuY2UgaW4g\nb3JkZXIgdG8gY2FzY2FkZSB0aGUgZ2l2ZW4KICAgICAqIG9wZXJhdGlvbiB0\naHJvdWdoIGl0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2FzY2FkZVRy\nYW5zaWVudChpbnQgb3AsIE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGws\nCiAgICAgICAgU3RyaW5nIGVyck9wKSB7CiAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjID0gYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7Cgog\nICAgICAgIC8vIGlmIHVzaW5nIGRldGFjaGVkIHN0YXRlIG1hbmFnZXIsIGRv\nbid0IHJlcGxhY2UKICAgICAgICBpZiAocGMucGNHZXRTdGF0ZU1hbmFnZXIo\nKSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2Vw\ndGlvbihvYmosIGVyck9wKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAg\nICAgICAgICAgZ2V0TWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBuZXcgU3Rh\ndGVNYW5hZ2VySW1wbChTdGF0ZU1hbmFnZXJJZC4KICAgICAgICAgICAgbmV3\nSW5zdGFuY2UodGhpcyksIG1ldGEsIHRoaXMpOwogICAgICAgIHNtLmluaXRp\nYWxpemUocGMsIFBDU3RhdGUuVExPQURFRCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgc3dpdGNoIChvcCkgewogICAgICAgICAgICAgICAgY2FzZSBP\ncENhbGxiYWNrcy5PUF9QRVJTSVNUOgogICAgICAgICAgICAgICAgICAgIHNt\nLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9ERUxF\nVEU6CiAgICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxs\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgT3BDYWxsYmFja3MuT1BfUkVGUkVTSDoKICAgICAgICAgICAgICAg\nICAgICBzbS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKFN0cmluZy52YWx1ZU9mKG9wKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHNtLnJlbGVhc2UodHJ1\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZUFs\nbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwoKICAgICAgICAgICAgTGlz\ndCBleGNlcHMgPSBudWxsOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAob2JqICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGRlbGV0ZShvYmosIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVl\nKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0\naW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRl\nKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAgICAgZGVsZXRlKG9i\naiwgZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpLCBjYWxsKTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElu\ndGVybmFsIGRlbGV0ZS4KICAgICAqLwogICAgdm9pZCBkZWxldGUoT2JqZWN0\nIG9iaiwgU3RhdGVNYW5hZ2VySW1wbCBzbSwgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGlmICghX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX0RFTEVURSwgb2JqLCBzbSwgY2FsbCk7CiAg\nICAgICAgaWYgKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBBQ1RfQ0FTQ0FERQogICAg\nICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkg\newogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1Bf\nREVMRVRFLCBvYmosIGNhbGwsICJkZWxldGUiKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gQUNUX1JVTgogICAgICAgIGlm\nIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVk\nKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlv\nbihvYmosICJkZWxldGUiKTsKICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBP\ncENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0gMCkKICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgIHNtLmRlbGV0\nZSgpOwogICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBh\nYmxlKG9iaikucGNJc0RldGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxl\ndGUiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlv\nbiBpbmRpY2F0aW5nIHRoYXQgdGhlIGN1cnJlbnQgYWN0aW9uIGNhbid0IGJl\nCiAgICAgKiBwZXJmb3JtZWQgb24gYSBkZXRhY2hlZCBvYmplY3QuCiAgICAg\nKi8KICAgIHByaXZhdGUgT3BlbkpQQUV4Y2VwdGlvbiBuZXdEZXRhY2hlZEV4\nY2VwdGlvbihPYmplY3Qgb2JqLAogICAgICAgIFN0cmluZyBvcGVyYXRpb24p\nIHsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLWRldGFjaGVkLW9wIiwgb3BlcmF0aW9uLAogICAgICAgICAgICBFeGNl\ncHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlQWxsKENvbGxlY3Rpb24g\nb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBMaXN0IGV4\nY2VwcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZWxlYXNlKGl0ci5u\nZXh0KCksIGNhbGwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4\nY2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFk\nZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBm\nYWxzZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJl\nbGVhc2UoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nl\nc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUxFQVNFLCBvYmosIHNtLCBj\nYWxsKTsKCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pICE9IDAgJiYgc20uaXNQZXJzaXN0ZW50KCkpIHsK\nICAgICAgICAgICAgICAgIGJvb2xlYW4gcGVuZGluZyA9IHNtLmlzUGVuZGlu\nZ1RyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNtLnJlbGVhc2Uo\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAocGVuZGluZykKICAgICAgICAg\nICAgICAgICAgICByZW1vdmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKHNtKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW1iZWQo\nT2JqZWN0IG9iaiwgT2JqZWN0IGlkLAogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgb3duZXIsIFZhbHVlTWV0YURhdGEgb3duZXJNZXRhKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvcmlnID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAob3JpZyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBhbHJlYWR5IGVtYmVkZGVkLCBu\nb3RoaW5nIHRvIGRvCiAgICAgICAgICAgICAgICBpZiAob3JpZy5nZXRPd25l\ncigpID09IG93bmVyICYmIG9yaWcuZ2V0TWV0YURhdGEoKS4KICAgICAgICAg\nICAgICAgICAgICBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09IG93bmVyTWV0\nYSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZzsKCiAgICAgICAg\nICAgICAgICAvLyBvdGhlcndpc2UgbWFrZSBzdXJlIHBjIGlzIGZ1bGx5IGxv\nYWRlZCBmb3Igd2hlbiB3ZSBjb3B5IGl0cwogICAgICAgICAgICAgICAgLy8g\nZGF0YSBiZWxvdwogICAgICAgICAgICAgICAgb3JpZy5sb2FkKF9mYywgU3Rh\ndGVNYW5hZ2VySW1wbC5MT0FEX0FMTCwgbnVsbCwgbnVsbCwgZmFsc2UpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHN0YXRl\nIG1hbmFnZXIgd2l0aCBlbWJlZGRlZCBtZXRhZGF0YQogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEgPSBvd25lck1ldGEuZ2V0RW1iZWRkZWRNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtZW1iZWQiLCBvd25lck1ldGEpKTsKCiAgICAgICAgICAgIGlmIChp\nZCA9PSBudWxsKQogICAgICAgICAgICAgICAgaWQgPSBTdGF0ZU1hbmFnZXJJ\nZC5uZXdJbnN0YW5jZSh0aGlzKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhp\ncyk7CiAgICAgICAgICAgIHNtLnNldE93bmVyKChTdGF0ZU1hbmFnZXJJbXBs\nKSBvd25lciwgb3duZXJNZXRhKTsKCiAgICAgICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBjb3B5OwogICAgICAgICAgICBQQ1N0YXRlIHN0YXRlOwogICAg\nICAgICAgICBDbGFzcyB0eXBlID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7\nCiAgICAgICAgICAgIGlmICh0eXBlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAg\nICAgICAgICB0eXBlID0gbWV0YS5nZXRJbnRlcmZhY2VJbXBsKCk7CiAgICAg\nICAgICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8g\nZ2l2ZSBjb3B5IGFuZCB0aGUgb3JpZ2luYWwgaW5zdGFuY2UgdGhlIHNhbWUg\nc3RhdGUgbWFuYWdlcgogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3ZSBj\nYW4gY29weSBmaWVsZHMgZnJvbSBvbmUgdG8gdGhlIG90aGVyCiAgICAgICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIGNvcHlTTTsKICAgICAgICAgICAg\nICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYzsKICAgICAgICAgICAgICAgIGlm\nIChvcmlnID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjb3B5U00g\nPSBzbTsKICAgICAgICAgICAgICAgICAgICBwYyA9IGFzc2VydFBlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmopOwogICAgICAgICAgICAgICAgICAgIHBjLnBjUmVw\nbGFjZVN0YXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIGNvcHlTTSA9IG9yaWc7CiAgICAgICAg\nICAgICAgICAgICAgcGMgPSBvcmlnLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gY29weSB0aGUgaW5zdGFuY2UuICB3ZSBk\nbyB0aGlzIGV2ZW4gaWYgaXQgZG9lc24ndCBhbHJlYWR5CiAgICAgICAgICAg\nICAgICAgICAgLy8gaGF2ZSBhIHN0YXRlIG1hbmFnZXIgaW4gY2FzZSBpdCBp\ncyBsYXRlciBhc3NpZ25lZCB0byBhCiAgICAgICAgICAgICAgICAgICAgLy8g\nUEMgZmllbGQ7IGF0IHRoYXQgcG9pbnQgaXQncyB0b28gbGF0ZSB0byBjb3B5\nCiAgICAgICAgICAgICAgICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3SW5z\ndGFuY2UodHlwZSwgY29weVNNLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAg\nICAgaW50W10gZmllbGRzID0gbmV3IGludFttZXRhLmdldEZpZWxkcygpLmxl\nbmd0aF07CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZpZWxkc1tpXSA9IGk7CiAgICAgICAgICAgICAgICAgICAgY29weS5wY0Nv\ncHlGaWVsZHMocGMsIGZpZWxkcyk7CiAgICAgICAgICAgICAgICAgICAgc3Rh\ndGUgPSBQQ1N0YXRlLkVDT1BZOwogICAgICAgICAgICAgICAgICAgIGNvcHku\ncGNSZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgaW5z\ndGFuY2UgZGlkbid0IGhhdmUgYSBzdGF0ZSBtYW5hZ2VyIHRvIHN0YXJ0LAog\nICAgICAgICAgICAgICAgICAgIC8vIHJldmVydCBpdCB0byBiZWluZyB0cmFu\nc2llbnQKICAgICAgICAgICAgICAgICAgICBpZiAob3JpZyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFn\nZXIobnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBjb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0\nYW5jZSh0eXBlLCBzbSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCAmJiAhX29wdGltaXN0aWMpCiAg\nICAgICAgICAgICAgICAgICAgc3RhdGUgPSBQQ1N0YXRlLkVDTEVBTjsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9\nIFBDU3RhdGUuRU5PTlRSQU5TOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzbS5pbml0aWFsaXplKGNvcHksIHN0YXRlKTsKICAgICAgICAgICAgcmV0\ndXJuIHNtOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSWYgbm90IGFscmVhZHkgY2FjaGVkLCBjcmVhdGUgYW4gZW1w\ndHkgY29weSBvZiB0aGUgZ2l2ZW4gc3RhdGUKICAgICAqIG1hbmFnZXIgaW4g\ndGhlIGdpdmVuIHN0YXRlLgogICAgICovCiAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIGNvcHkoT3BlbkpQQVN0YXRlTWFuYWdlciBjb3B5LCBQQ1N0YXRlIHN0\nYXRlKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBP\nYmplY3Qgb2lkID0gY29weS5mZXRjaE9iamVjdElkKCk7CiAgICAgICAgICAg\nIENsYXNzIHR5cGUgPSBjb3B5LmdldE1hbmFnZWRJbnN0YW5jZSgpLmdldENs\nYXNzKCk7CiAgICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICAvLyBjYWNoZWQgaW5zdGFuY2U/CiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc20gPSBudWxsOwogICAgICAgICAgICBpZiAoIWNvcHkuaXNF\nbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsQnlJZChvaWQsIHRydWUpOwogICAgICAgICAgICBpZiAoc20gPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJl\ncG9zID0gX2NvbmYuCiAgICAgICAgICAgICAgICAgICAgZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKHR5cGUsIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgICAgICAgICAgLy8gY29uc3RydWN0IGEgbmV3IHN0\nYXRlIG1hbmFnZXIgd2l0aCBhbGwgaW5mbyBrbm93bgogICAgICAgICAgICAg\nICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChvaWQsIG1ldGEsIHRoaXMp\nOwogICAgICAgICAgICAgICAgc20uc2V0T2JqZWN0SWQob2lkKTsKICAgICAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXRE\nZXNjcmliZWRUeXBlKCksIHN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gc207CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHJlZnJlc2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9u\nYWxSZWFkKCk7CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9i\nanMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAg\nICBnYXRoZXJDYXNjYWRlUmVmcmVzaChpdHIubmV4dCgpLCBjYWxsKTsKICAg\nICAgICAgICAgaWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXpl\nKCkgPT0gMSkKICAgICAgICAgICAgICAgIHJlZnJlc2hJbnRlcm5hbChfb3Bl\ncmF0aW5nLml0ZXJhdG9yKCkubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgcmVmcmVzaEludGVybmFsKF9vcGVyYXRp\nbmcsIGNhbGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCByZWZyZXNoKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAg\nICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKG9iaiwgY2FsbCk7CiAgICAg\nICAgICAgIGlmIChfb3BlcmF0aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKF9vcGVyYXRpbmcuc2l6ZSgp\nID09IDEpCiAgICAgICAgICAgICAgICByZWZyZXNoSW50ZXJuYWwoX29wZXJh\ndGluZy5pdGVyYXRvcigpLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5n\nLCBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nYXRoZXJzIGFsbCBvYmplY3RzIHJlYWNoYWJsZSB0aHJvdWdoIGNhc2NhZGUt\ncmVmcmVzaCByZWxhdGlvbnMKICAgICAqIGludG8gdGhlIG9wZXJhdGluZyBz\nZXQuCiAgICAgKi8KICAgIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT2Jq\nZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmog\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICghX29w\nZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChv\nYmosIGZhbHNlKTsKICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgc20sIGNhbGwpOwog\nICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUp\nID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKHNtICE9\nIG51bGwpCiAgICAgICAgICAgIHNtLmdhdGhlckNhc2NhZGVSZWZyZXNoKGNh\nbGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVu\ndChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIGNhbGwsICJyZWZyZXNo\nIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxs\nZWQgd2l0aCB0aGUgZnVsbCBzZXQgb2Ygb2JqZWN0cyByZWFjaGFibGUgdmlh\nCiAgICAgKiBjYXNjYWRlLXJlZnJlc2ggcmVsYXRpb25zIGZyb20gdGhlIHVz\nZXItZ2l2ZW4gaW5zdGFuY2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZWZyZXNoSW50ZXJuYWwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbGxlY3QgaW5zdGFuY2VzIHRoYXQg\nbmVlZCBhIHJlZnJlc2gKICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2FkID0g\nbnVsbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3JlUmVm\ncmVzaCh0cnVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2FkID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgp\nCiAgICAgICAgICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRp\nb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4\nY2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmVmcmVzaCBhbGwKICAgICAg\nICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbiBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLAog\nICAgICAgICAgICAgICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX1JF\nRlJFU0gsIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVk\nICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24oZmFpbGVkKSk7CgogICAgICAgICAgICAgICAgLy8gcGVyZm9y\nbSBwb3N0LXJlZnJlc2ggdHJhbnNpdGlvbnMgYW5kIG1ha2Ugc3VyZSBhbGwg\nZmV0Y2gKICAgICAgICAgICAgICAgIC8vIGdyb3VwIGZpZWxkcyBhcmUgbG9h\nZGVkCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGxvYWQu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQu\nY29udGFpbnMoc20uZ2V0SWQoKSkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgICAgICBzbS5hZnRlclJlZnJlc2goKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwu\nTE9BRF9GR1MsIG51bGwsIG51bGwsIAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gbm93IGludm9rZSBwb3N0UmVmcmVzaCBvbiBhbGwgdGhlIGluc3Rh\nbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKGl0ci5uZXh0KCksIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChzbSAhPSBudWxsICYmICFzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChzbS5nZXRNYW5hZ2Vk\nSW5zdGFuY2UoKSwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLmdldE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50LkFGVEVSX1JFRlJF\nU0gpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9u\ncyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9wdGlt\naXphdGlvbiBmb3Igc2luZ2xlLW9iamVjdCByZWZyZXNoLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCByZWZyZXNoSW50ZXJuYWwoT2JqZWN0IG9iaiwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9i\naiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9w\nQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgc20sIGNhbGwpCiAgICAgICAg\nICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAg\nICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmos\nICJyZWZyZXNoIik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChzbS5iZWZv\ncmVSZWZyZXNoKGZhbHNlKSkgewogICAgICAgICAgICAgICAgICAgIHNtLmxv\nYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxs\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJSZWZyZXNo\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaXJlTGlm\nZWN5Y2xlRXZlbnQoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAg\nICAgICAgICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xl\nRXZlbnQuQUZURVJfUkVGUkVTSCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\nYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkK\nICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2gi\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCByZXRyaWV2ZUFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZGZnT25s\neSwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9i\nanMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYg\nKG9ianMuc2l6ZSgpID09IDEpIHsKICAgICAgICAgICAgcmV0cmlldmUob2Jq\ncy5pdGVyYXRvcigpLm5leHQoKSwgZGZnT25seSwgY2FsbCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIExpc3QgZXhjZXBzID0g\nbnVsbDsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFz\nc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAvLyBj\nb2xsZWN0IGFsbCBob2xsb3cgaW5zdGFuY2VzIGZvciBsb2FkCiAgICAgICAg\nICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9\nIG51bGw7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAg\nICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpzLnNp\nemUoKSk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgICAg\nIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZF\nLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRh\nY2hlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nRGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENT\ndGF0ZS5IT0xMT1cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAobG9hZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAg\nICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRy\naWV2ZSIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlv\nbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAg\nICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlm\nIChsb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGludCBtb2RlID0g\nKGRmZ09ubHkpID8gX3N0b3JlLkZPUkNFX0xPQURfREZHCiAgICAgICAgICAg\nICAgICAgICAgOiBfc3RvcmUuRk9SQ0VfTE9BRF9BTEw7CiAgICAgICAgICAg\nICAgICBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLCBtb2Rl\nLCBfZmMsIG51bGwpOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBu\ndWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0\naW9uKGZhaWxlZCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBy\nZXRyaWV2ZSBhbGwgbm9uLWZhaWxlZCBpbnN0YW5jZXMKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBzbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlcklt\ncGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9\nIG51bGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNtLmdldElkKCkpKQogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGludCBt\nb2RlID0gKGRmZ09ubHkpID8gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUwog\nICAgICAgICAgICAgICAgICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FM\nTDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nc20uYmVmb3JlUmVhZCgtMSk7CiAgICAgICAgICAgICAgICAgICAgc20ubG9h\nZChfZmMsIG1vZGUsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0cmlldmUoT2JqZWN0IG9i\naiwgYm9vbGVhbiBkZmdPbmx5LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJh\nbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAg\nICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JF\nVFJJRVZFLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsK\nICAgICAgICAgICAgICAgIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09ubHkpID8gU3RhdGVN\nYW5hZ2VySW1wbC5MT0FEX0ZHUwogICAgICAgICAgICAgICAgICAgICAgICA6\nIFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAgICAgICAgICAg\nICAgc20uYmVmb3JlUmVhZCgtMSk7CiAgICAgICAgICAgICAgICAgICAgc20u\nbG9hZChfZmMsIG1vZGUsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0\nZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQogICAgICAgICAgICAg\nICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nRGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdEFs\nbChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGV2aWN0IGFs\nbCBQQ2xlYW4gYW5kIFBOb25UcmFucyBvYmplY3RzCiAgICAgICAgICAgIENv\nbGxlY3Rpb24gYyA9IGdldE1hbmFnZWRTdGF0ZXMoKTsKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFz\nbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXZpY3Qoc20uZ2V0\nTWFuYWdlZEluc3RhbmNlKCksIGNhbGwpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RB\nbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZXZp\nY3QoaXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhj\nZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhj\nZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBldmljdEFsbChFeHRlbnQgZXh0ZW50LCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKGV4dGVudCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQTm9u\nVHJhbnMgb2JqZWN0cyBpbiBleHRlbnQKICAgICAgICAgICAgQ29sbGVjdGlv\nbiBjID0gZ2V0TWFuYWdlZFN0YXRlcygpOwogICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChzbS5pc1Bl\ncnNpc3RlbnQoKSAmJiAhc20uaXNEaXJ0eSgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2xzID0gc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBl\nKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNscyA9PSBleHRlbnQuZ2V0\nRWxlbWVudFR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICB8fCAoZXh0\nZW50Lmhhc1N1YmNsYXNzZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAm\nJiBleHRlbnQuZ2V0RWxlbWVudFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGNs\ncykpKQogICAgICAgICAgICAgICAgICAgICAgICBldmljdChzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZXZpY3QoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfRVZJQ1QsIG9iaiwgc20sIGNhbGwpCiAgICAg\nICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgc20uZXZp\nY3QoKTsKICAgICAgICAgICAgaWYgKF9ldmljdERhdGFDYWNoZSAmJiBzbS5n\nZXRPYmplY3RJZCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIERhdGFD\nYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7\nCiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjYWNoZS5yZW1vdmUoc20uZ2V0T2JqZWN0SWQoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZGV0YWNoKE9iamVjdCBvYmosIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChjYWxsID09IG51\nbGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNlLCBjYWxsKS5kZXRh\nY2gob2JqKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0W10gZGV0YWNoQWxsKENvbGxlY3Rpb24gb2JqcywgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvYmpzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09CSkVDVFM7CiAgICAg\nICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IF9jYWxs\nOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gbmV3IERldGFjaE1hbmFnZXIodGhpcywg\nZmFsc2UsIGNhbGwpLmRldGFjaEFsbChvYmpzKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZXRhY2hBbGwoT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGRldGFjaEFsbChjYWxsLCB0cnVl\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZXRhY2hBbGwoT3BDYWxsYmFj\na3MgY2FsbCwgYm9vbGVhbiBmbHVzaCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIElmIGEg\nZmx1c2ggaXMgZGVzaXJlZCAoYmFzZWQgb24gaW5wdXQgcGFybSksIHRoZW4g\nY2hlY2sgaWYgdGhlCiAgICAgICAgICAgIC8vICAgImRpcnR5IiBmbGFnIGlz\nIHNldCBiZWZvcmUgY2FsbGluZyBmbHVzaCgpLgogICAgICAgICAgICBpZiAo\nKGZsdXNoKSAmJiAoKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9\nIDApKQogICAgICAgICAgICAgICAgZmx1c2goKTsKICAgICAgICAgICAgZGV0\nYWNoQWxsSW50ZXJuYWwoY2FsbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFsbEludGVybmFsKE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBDb2xsZWN0aW9uIHN0YXRlcyA9\nIGdldE1hbmFnZWRTdGF0ZXMoKTsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc3RhdGVzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKFN0\nYXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICgh\nc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICBpdHIucmVtb3Zl\nKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCFzbS5nZXRNZXRhRGF0YSgpLmlz\nRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRy\ndWUpOwogICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZXMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChjYWxsID09IG51bGwp\nCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKICAgICAgICBuZXcgRGV0YWNo\nTWFuYWdlcih0aGlzLCB0cnVlLCBjYWxsKS5kZXRhY2hBbGwKICAgICAgICAg\nICAgKG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihzdGF0ZXMpKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGF0dGFjaChPYmplY3Qgb2JqLCBib29s\nZWFuIGNvcHlOZXcsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBtYWtlIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sg\nb25seSBpZiB0aGlzIGZhaWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3Bl\ncmF0aW9uKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEF0dGFjaE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCku\nYXR0YWNoKG9iaik7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wdGltaXN0aWNF\neGNlcHRpb24gb2UpIHsKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25s\neShvZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBvZS5zZXRGYXRhbCh0cnVl\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3Rb\nXSBhdHRhY2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIGNvcHlOZXcs\nCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpz\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09C\nSkVDVFM7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBub3QgdG8gdHJ5IHRv\nIHNldCByb2xsYmFjayBvbmx5IGlmIHRoaXMgZmFpbHMKICAgICAgICAgICAg\nYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNoTWFuYWdlcih0aGlzLCBj\nb3B5TmV3LCBjYWxsKS5hdHRhY2hBbGwob2Jqcyk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE9wdGltaXN0aWNFeGNlcHRpb24gb2UpIHsKICAgICAgICAgICAg\nICAgIHNldFJvbGxiYWNrT25seShvZSk7CiAgICAgICAgICAgICAgICB0aHJv\ndyBvZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIG5vbnRyYW5zYWN0aW9uYWxBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTGlzdCBl\neGNlcHMgPSBudWxsOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbm9udHJhbnNhY3Rp\nb25hbChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBl\neGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25z\nKGV4Y2VwcywgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBub250cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTk9OVFJBTlNB\nQ1RJT05BTCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BD\nYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzbS5ub250cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHRoZSBnaXZlbiBpbnN0\nYW5jZXMgdHJhbnNhY3Rpb25hbC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\ndHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gdXBk\nYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgaWYgKG9ianMuc2l6ZSgpID09IDEpIHsKICAgICAgICAgICAgdHJh\nbnNhY3Rpb25hbChvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCB1cGRhdGVWZXJz\naW9uLCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gY29sbGVjdCBhbGwgaG9sbG93IGluc3RhbmNlcyBmb3Ig\nbG9hZCwgYW5kIG1ha2UgdW5tYW5hbmdlZAogICAgICAgICAgICAvLyBpbnN0\nYW5jZXMgdHJhbnNpZW50LXRyYW5zYWN0aW9uYWwKICAgICAgICAgICAgQ29s\nbGVjdGlvbiBsb2FkID0gbnVsbDsKICAgICAgICAgICAgT2JqZWN0IG9iajsK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNt\ncyA9IG5ldyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOwogICAgICAgICAgICBM\naXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tz\nLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNhbGwpICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAg\nICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIG1hbmFnZSB0cmFuc2llbnQgaW5zdGFuY2UKICAgICAgICAgICAg\nICAgICAgICAgICAgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRN\nZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CgogICAg\nICAgICAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoU3RhdGVNYW5hZ2VySWQu\nbmV3SW5zdGFuY2UodGhpcyksIG1ldGEsIHRoaXMpOwogICAgICAgICAgICAg\nICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBlcnNpc3RlbmNlQ2Fw\nYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUENTdGF0\nZS5UQ0xFQU4pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc20u\naXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXNz\nZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChz\nbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3Qo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAg\nICAgICAgc20uc2V0Q2hlY2tWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnNldFVwZGF0ZVZlcnNpb24odHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNIX1JFUVVJ\nUkVEOyAvLyB2ZXJzaW9uIGNoZWNrL3VwCiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKFVz\nZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGxvYWQgYWxsIGhvbGxvdyBpbnN0YW5j\nZXMKICAgICAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBudWxsOwogICAg\nICAgICAgICBpZiAobG9hZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBm\nYWlsZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLCBfc3RvcmUuRk9S\nQ0VfTE9BRF9OT05FLAogICAgICAgICAgICAgICAgICAgIF9mYywgbnVsbCk7\nCiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxl\nZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywKICAgICAgICAgICAgICAgICAgICAgICAgbmV3T2JqZWN0Tm90\nRm91bmRFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHRyYW5zYWN0aW9uYWxTdGF0ZXNBbGwoc21zLCBmYWlsZWQsIGV4\nY2Vwcyk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYWtlIHRoZSBnaXZlbiBpbnN0YW5jZXMgdHJhbnNhY3Rpb25h\nbC4KICAgICAqLwogICAgcHVibGljIHZvaWQgdHJhbnNhY3Rpb25hbChPYmpl\nY3Qgb2JqLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sCiAgICAgICAgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAg\nICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9UUkFOU0FD\nVElPTkFMLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uaXNQZXJzaXN0\nZW50KCkpIHsKICAgICAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0\naW9uKCk7CiAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAg\nICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5M\nT0FEX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nc20uc2V0Q2hlY2tWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgaWYg\nKHVwZGF0ZVZlcnNpb24pCiAgICAgICAgICAgICAgICAgICAgc20uc2V0VXBk\nYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX0ZMVVNIX1JFUVVJUkVEOyAvLyB2ZXJzaW9uIGNoZWNrL3VwCiAgICAg\nICAgICAgIH0gZWxzZSBpZiAoc20gPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgLy8gbWFuYWdlIHRyYW5zaWVudCBpbnN0YW5jZQogICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBv\nc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICBnZXRNZXRh\nRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICBPYmplY3QgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5j\nZSh0aGlzKTsKICAgICAgICAgICAgICAgIHNtID0gbmV3IFN0YXRlTWFuYWdl\nckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAgICAgICAgc20uaW5p\ndGlhbGl6ZShhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKSwKICAgICAg\nICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVHJhbnNpdGlvbiB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlcnMg\ndG8gdHJhbnNhY3Rpb25hbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRy\nYW5zYWN0aW9uYWxTdGF0ZXNBbGwoQ29sbGVjdGlvbiBzbXMsIENvbGxlY3Rp\nb24gZmFpbGVkLAogICAgICAgIExpc3QgZXhjZXBzKSB7CiAgICAgICAgLy8g\nbWFrZSBpbnN0YW5jZXMgdHJhbnNhY3Rpb25hbCBhbmQgbWFrZSBzdXJlIHRo\nZXkgYXJlIGxvYWRlZAogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzbXMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBu\ndWxsICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNt\nLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBu\ndWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsIGtlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJv\nd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEV4dGVudCwgUXVlcnkKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEV4dGVudCBuZXdFeHRlbnQo\nQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2VzKSB7CiAgICAgICAgcmV0\ndXJuIG5ld0V4dGVudCh0eXBlLCBzdWJjbGFzc2VzLCBudWxsKTsKICAgIH0K\nCiAgICBwcml2YXRlIEV4dGVudCBuZXdFeHRlbnQoQ2xhc3MgdHlwZSwgYm9v\nbGVhbiBzdWJjbGFzc2VzLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIEV4dGVudEltcGwgZXh0ZW50ID0gbmV3IEV4\ndGVudEltcGwodGhpcywgdHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gpOwogICAg\nICAgICAgICBpZiAoX2V4dGVudHMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9leHRlbnRzID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFz\naFNldC5XRUFLKTsKICAgICAgICAgICAgX2V4dGVudHMuYWRkKGV4dGVudCk7\nCgogICAgICAgICAgICByZXR1cm4gZXh0ZW50OwogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBJdGVyYXRvciBleHRlbnRJdGVy\nYXRvcihDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFuIGlnbm9yZUNoYW5n\nZXMpIHsKICAgICAgICBFeHRlbnQgZXh0ZW50ID0gbmV3RXh0ZW50KHR5cGUs\nIHN1YmNsYXNzZXMsIGZldGNoKTsKICAgICAgICBleHRlbnQuc2V0SWdub3Jl\nQ2hhbmdlcyhpZ25vcmVDaGFuZ2VzKTsKICAgICAgICByZXR1cm4gZXh0ZW50\nLml0ZXJhdG9yKCk7CiAgICB9CgogICAgcHVibGljIFF1ZXJ5IG5ld1F1ZXJ5\nKFN0cmluZyBsYW5nLCBDbGFzcyBjbHMsIE9iamVjdCBxdWVyeSkgewogICAg\nICAgIFF1ZXJ5IHEgPSBuZXdRdWVyeShsYW5nLCBxdWVyeSk7CiAgICAgICAg\ncS5zZXRDYW5kaWRhdGVUeXBlKGNscywgdHJ1ZSk7CiAgICAgICAgcmV0dXJu\nIHE7CiAgICB9CgogICAgcHVibGljIFF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBs\nYW5nLCBPYmplY3QgcXVlcnkpIHsKICAgICAgICAvLyBjb21tb24gbWlzdGFr\nZXMKICAgICAgICBpZiAocXVlcnkgaW5zdGFuY2VvZiBFeHRlbnQgfHwgcXVl\ncnkgaW5zdGFuY2VvZiBDbGFzcykKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1uZXctcXVlcnkiKSk7CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdG9yZVF1ZXJ5IHNxID0gX3N0b3JlLm5ld1F1ZXJ5KGxhbmcp\nOwogICAgICAgICAgICBpZiAoc3EgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgRXhwcmVzc2lvblBhcnNlciBlcCA9IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNl\nckZvckxhbmd1YWdlKGxhbmcpOwogICAgICAgICAgICAgICAgaWYgKGVwICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgc3EgPSBuZXcgRXhwcmVzc2lv\nblN0b3JlUXVlcnkoZXApOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoUXVl\ncnlMYW5ndWFnZXMuTEFOR19NRVRIT0RRTC5lcXVhbHMobGFuZykpCiAgICAg\nICAgICAgICAgICAgICAgc3EgPSBuZXcgTWV0aG9kU3RvcmVRdWVyeSgpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihsYW5nKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgUXVlcnkgcSA9IG5ld1F1ZXJ5SW1wbChsYW5nLCBz\ncSk7CiAgICAgICAgICAgIHEuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hh\nbmdlcyk7CiAgICAgICAgICAgIGlmIChxdWVyeSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcS5zZXRRdWVyeShxdWVyeSk7CgogICAgICAgICAgICAvLyB0\ncmFjayBxdWVyaWVzCiAgICAgICAgICAgIGlmIChfcXVlcmllcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgX3F1ZXJpZXMgPSBuZXcgUmVmZXJlbmNlSGFz\naFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAgICAgICAgICBfcXVl\ncmllcy5hZGQocSk7CiAgICAgICAgICAgIHJldHVybiBxOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IHF1ZXJ5LgogICAgICovCiAgICBwcm90ZWN0ZWQgUXVlcnlJbXBsIG5l\nd1F1ZXJ5SW1wbChTdHJpbmcgbGFuZywgU3RvcmVRdWVyeSBzcSkgewogICAg\nICAgIHJldHVybiBuZXcgUXVlcnlJbXBsKHRoaXMsIGxhbmcsIHNxKTsKICAg\nIH0KCiAgICBwdWJsaWMgU2VxIGdldElkZW50aXR5U2VxdWVuY2UoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFNlcXVl\nbmNlKG1ldGEsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0VmFs\ndWVTZXF1ZW5jZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChm\nbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\ncmV0dXJuIGdldFNlcXVlbmNlKGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCks\nIGZtZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXF1ZW5j\nZSBmb3IgdGhlIGdpdmVuIGNsYXNzIGFuZCBvcHRpb25hbCBmaWVsZC4KICAg\nICAqLwogICAgcHJpdmF0ZSBTZXEgZ2V0U2VxdWVuY2UoQ2xhc3NNZXRhRGF0\nYSBtZXRhLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIC8vIGdldCBz\nZXF1ZW5jZSBzdHJhdGVneSBmcm9tIG1ldGFkYXRhCiAgICAgICAgaW50IHN0\ncmF0ZWd5OwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAg\nc3RyYXRlZ3kgPSBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0cmF0ZWd5ID0gZm1kLmdldFZhbHVlU3Ry\nYXRlZ3koKTsKCiAgICAgICAgLy8gd2UgY2FuIGhhbmRsZSBub24tbmF0aXZl\nIHN0cmF0ZWdpZXMgd2l0aG91dCB0aGUgc3RvcmUgbWFuYWdlcgogICAgICAg\nIHN3aXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0\ncmF0ZWdpZXMuVVVJRF9IRVg6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJ\nREhleFNlcS5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjYXNlIFZhbHVl\nU3RyYXRlZ2llcy5VVUlEX1NUUklORzoKICAgICAgICAgICAgICAgIHJldHVy\nbiBVVUlEU3RyaW5nU2VxLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNh\nc2UgVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFOgogICAgICAgICAgICAgICAg\nU2VxdWVuY2VNZXRhRGF0YSBzbWQgPSAoZm1kID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgPyBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VNZXRhRGF0\nYSgpCiAgICAgICAgICAgICAgICAgICAgOiBmbWQuZ2V0VmFsdWVTZXF1ZW5j\nZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gc21kLmdldElu\nc3RhbmNlKF9sb2FkZXIpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgLy8gdXNlIHN0b3JlIG1hbmFnZXIgZm9yIG5hdGl2ZSBzZXF1\nZW5jZQogICAgICAgICAgICAgICAgaWYgKGZtZCA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gdGhpcyB3aWxsIHJldHVybiBhIHNlcXVlbmNl\nIGV2ZW4gZm9yIGFwcCBpZCBjbGFzc2VzLAogICAgICAgICAgICAgICAgICAg\nIC8vIHdoaWNoIGlzIHdoYXQgd2Ugd2FudCBmb3IgYmFja3dhcmRzLWNvbXBh\ndGliaWxpdHkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdl\ndERhdGFTdG9yZUlkU2VxdWVuY2UobWV0YSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdldFZhbHVlU2VxdWVu\nY2UoZm1kKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAg\nIC8vIExvY2tpbmcKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQg\nbG9jayhPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9j\nayBsZXZlbCBhbHdheXMgTk9ORQogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGxvY2sob2JqLCBfZmMuZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExv\nY2tUaW1lb3V0KCksIGNhbGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBsb2NrKE9iamVjdCBvYmosIGludCBsZXZlbCwgaW50IHRp\nbWVvdXQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAg\nICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsIHx8ICFzbS5pc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgdGltZW91dCwgbnVsbCk7CiAgICAgICAgICAg\nIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsgLy8gdXNlIHNhbWUgbGV2\nZWwgZm9yIGZ1dHVyZSB3cml0ZQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwoQ29sbGVjdGlvbiBvYmpz\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdh\neXMgTk9ORQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2tBbGwob2Jq\ncywgX2ZjLmdldFdyaXRlTG9ja0xldmVsKCksIF9mYy5nZXRMb2NrVGltZW91\ndCgpLAogICAgICAgICAgICAgICAgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwoQ29sbGVjdGlvbiBvYmpzLCBp\nbnQgbGV2ZWwsIGludCB0aW1lb3V0LAogICAgICAgIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgewogICAg\nICAgICAgICBsb2NrKG9ianMuaXRlcmF0b3IoKS5uZXh0KCksIGxldmVsLCB0\naW1lb3V0LCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAg\nICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpzLnNp\nemUoKSk7CiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwo\nb2JqLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAg\nICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQog\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwgJiYgc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAg\nICAgICAgICAgICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIF9sbS5sb2NrQWxsKHNtcywgbGV2ZWwsIHRpbWVvdXQsIG51bGwp\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVN\nYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkucmVhZExvY2tlZChsZXZlbCwgbGV2\nZWwpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vCiAgICAvLyBDb25uZWN0aW9uCiAgICAvLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAv\nLyB0aGlzIG1ldGhvZCBkb2VzIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRv\nIGFsbG93IGEgZGlmZmVyZW50CiAgICAgICAgLy8gdGhyZWFkIHRvIGJlIGFi\nbGUgdG8gY2FuY2VsIG9uIGEgbG9ja2VkLXVwIHBlcnNpc3RlbmNlIG1hbmFn\nZXIKCiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIGlmIHdlJ3JlIGZsdXNoaW5nLCBoYXZlIHRvIHNldCByb2xs\nYmFjayBvbmx5IC0tIGRvIHRoaXMgYmVmb3JlIHdlCiAgICAgICAgICAgIC8v\nIGF0dGVtcHQgdG8gY2FuY2VsLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2Fu\nY2VsIG1pZ2h0IGNhc2UgdGhlCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9u\nIHRvIGNvbXBsZXRlIGJlZm9yZSB3ZSBoYXZlIGEgY2hhbmNlIHRvIHNldCB0\naGUKICAgICAgICAgICAgLy8gcm9sbGJhY2sgb25seSBmbGFnCiAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKG5ldyBV\nc2VyRXhjZXB0aW9uKCkpOwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmNh\nbmNlbEFsbCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNv\nbnRhaW5zCiAgICAgICAgICAgIChfY29uZi5PUFRJT05fREFUQVNUT1JFX0NP\nTk5FQ1RJT04pKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oX2xvYy5nZXQoImNvbm4tbm90LXN1cHBvcnRlZCIpKTsKCiAg\nICAgICAgcmV0dXJuIF9zdG9yZS5nZXRDbGllbnRDb25uZWN0aW9uKCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzQ29ubmVjdGlvbigpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBG\nTEFHX1JFVEFJTkVEX0NPTk4pICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUZWxsIHN0b3JlIHRvIHJldGFpbiBjb25uZWN0aW9uIGlmIHdlIGhhdmVu\nJ3QgYWxyZWFkeS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJldGFpbkNv\nbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1JFVEFJ\nTkVEX0NPTk4pID09IDApIHsKICAgICAgICAgICAgX3N0b3JlLnJldGFpbkNv\nbm5lY3Rpb24oKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVUQUlO\nRURfQ09OTjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxs\nIHN0b3JlIHRvIHJlbGVhc2UgY29ubmVjdGlvbiBpZiB3ZSBoYXZlIHJldGFp\nbmVkIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VDb25u\nZWN0aW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19SRVRBSU5F\nRF9DT05OKSAhPSAwKSB7CiAgICAgICAgICAgIF9zdG9yZS5yZWxlYXNlQ29u\nbmVjdGlvbigpOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUkVUQUlO\nRURfQ09OTjsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAv\nLyBDYWNoZQogICAgLy8vLy8vLy8vCgogICAgcHVibGljIENvbGxlY3Rpb24g\nZ2V0TWFuYWdlZE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0TWFuYWdlZFN0YXRlcygpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nVHJhbnNhY3Rpb25hbE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0VHJhbnNhY3Rpb25hbFN0\nYXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAg\nICAgICAgICAgICAgICAoZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxTdGF0ZXMo\nKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9u\nIGdldERpcnR5T2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBN\nYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXREaXJ0eVN0YXRlcygpKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0T3JkZXJE\naXJ0eU9iamVjdHMoKSB7CiAgICAgICAgcmV0dXJuIF9vcmRlckRpcnR5Owog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE9yZGVyRGlydHlPYmplY3RzKGJv\nb2xlYW4gb3JkZXIpIHsKICAgICAgICBfb3JkZXJEaXJ0eSA9IG9yZGVyOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgbWFu\nYWdlZCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENv\nbGxlY3Rpb24gZ2V0TWFuYWdlZFN0YXRlcygpIHsKICAgICAgICByZXR1cm4g\nX2NhY2hlLmNvcHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIGNvcHkgb2YgYWxsIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9u\nYWxTdGF0ZXMoKSB7CiAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2Jq\nZWN0cygpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlf\nTElTVDsKICAgICAgICByZXR1cm4gX3RyYW5zQ2FjaGUuY29weSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciBvciBub3QgdGhlcmUgYXJlIGFu\neSB0cmFuc2FjdGlvbmFsIG9iamVjdHMgaW4gdGhlIGN1cnJlbnQKICAgICAq\nIHBlcnNpc3RlbmNlIGNvbnRleHQuIElmIHRoZXJlIGFyZSBhbnkgaW5zdGFu\nY2VzIHdpdGggdW50cmFja2VkIHN0YXRlLAogICAgICogdGhpcyBtZXRob2Qg\nd2lsbCBjYXVzZSB0aG9zZSBpbnN0YW5jZXMgdG8gYmUgc2Nhbm5lZC4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGhhc1RyYW5zYWN0aW9uYWxPYmpl\nY3RzKCkgewogICAgICAgIF9jYWNoZS5kaXJ0eUNoZWNrKCk7CiAgICAgICAg\ncmV0dXJuIF90cmFuc0NhY2hlICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vy\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0RGlydHlT\ndGF0ZXMoKSB7CiAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0\ncygpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElT\nVDsKCiAgICAgICAgcmV0dXJuIF90cmFuc0NhY2hlLmNvcHlEaXJ0eSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgc3Rh\ndGUgbWFuYWdlcnMgd2hpY2ggd2lsbCBiZWNvbWUKICAgICAqIHRyYW5zYWN0\naW9uYWwgdXBvbiB0aGUgbmV4dCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAg\ncHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxT\ndGF0ZXMoKSB7CiAgICAgICAgaWYgKF9wZW5kaW5nID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgICAg\nIHJldHVybiBuZXcgQXJyYXlMaXN0KF9wZW5kaW5nKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgY2FjaGVkIFN0YXRlTWFuYWdlciBmb3IgdGhl\nIGluc3RhbmNlIHRoYXQgaGFkIHRoZSBnaXZlbiBvaWQuCiAgICAgKiBUaGlz\nIG1ldGhvZCBtdXN0IG5vdCBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMgZm9y\nIG5ldyBpbnN0YW5jZXMuCiAgICAgKgogICAgICogQHBhcmFtIGlkIHRoZSBp\nZCBwcmV2aW91c2x5IHVzZWQgYnkgdGhlIGluc3RhbmNlCiAgICAgKiBAcGFy\nYW0gc20gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBpbnN0YW5jZTsgaWYg\ndGhlIHN0YXRlCiAgICAgKiBtYW5hZ2VyIGlzIHRyYW5zaWVudCwgd2UnbGwg\nc3RvcCBtYW5hZ2luZyB0aGUgaW5zdGFuY2U7CiAgICAgKiBpZiBpdCBoYXMg\ndXBkYXRlZCBpdHMgb2lkLCB3ZSdsbCByZS1jYWNoZSB1bmRlciB0aGUgbmV3\nIG9pZAogICAgICogQHBhcmFtIHN0YXR1cyBvbmUgb2Ygb3VyIFNUQVRVUyBj\nb25zdGFudHMgZGVzY3JpYmluZyB3aHkgd2UncmUKICAgICAqIHNldHRpbmcg\ndGhlIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgdm9pZCBzZXRTdGF0ZU1h\nbmFnZXIoT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBpbnQgc3Rh\ndHVzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBjYXNlIFNU\nQVRVU19JTklUOgogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5hZGQoc20p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBTVEFUVVNfVFJBTlNJRU5UOgogICAgICAgICAgICAgICAgICAgIF9j\nYWNoZS5yZW1vdmUoaWQsIHNtKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX09JRF9BU1NJR046CiAg\nICAgICAgICAgICAgICAgICAgX2NhY2hlLmFzc2lnbk9iamVjdElkKGlkLCBz\nbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIFNUQVRVU19DT01NSVRfTkVXOgogICAgICAgICAgICAgICAgICAg\nIF9jYWNoZS5jb21taXROZXcoaWQsIHNtKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE5vdGlmeSB0aGUgYnJva2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFn\nZXIgc2hvdWxkCiAgICAgKiBiZSBhZGRlZCB0byB0aGUgc2V0IG9mIGluc3Rh\nbmNlcyBpbnZvbHZlZCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KICAg\nICAqLwogICAgdm9pZCBhZGRUb1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlcklt\ncGwgc20pIHsKICAgICAgICAvLyB3ZSBvbmx5IGFkZCBjbGVhbiBpbnN0YW5j\nZXMgbm93OyBkaXJ0eSBpbnN0YW5jZXMgYXJlIGFkZGVkIGluCiAgICAgICAg\nLy8gdGhlIHNldERpcnR5IGNhbGxiYWNrCiAgICAgICAgaWYgKHNtLmlzRGly\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFs\nT2JqZWN0cygpKQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXcg\nVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0\nIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgcmVt\nb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRo\nZSBjdXJyZW50IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJlbW92\nZUZyb21UcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJh\nbnNDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgLy8gaW50ZW50aW9u\nYWwgZGlyZWN0IGFjY2Vzczsgd2UgZG9uJ3Qgd2FudCB0byByZWNvbXB1dGUK\nICAgICAgICAgICAgICAgIC8vIGRpcnRpbmVzcyB3aGlsZSByZW1vdmluZyBp\nbnN0YW5jZXMgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgICAgICAgICAgICAg\nIF90cmFuc0NhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmIChfZGVy\nZWZDYWNoZSAhPSBudWxsICYmICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAg\nICAgICAgICAgIF9kZXJlZkNhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIGdpdmVu\nIGluc3RhbmNlIGhhcyBiZWVuIGRpcnRpZWQuIFRoaXMKICAgICAqIG5vdGlm\naWNhdGlvbiBpcyBnaXZlbiB3aGVuIGFuIG9iamVjdCBmaXJzdCB0cmFuc2l0\naW9ucyB0byBhIGRpcnR5IHN0YXRlLAogICAgICogYW5kIGV2ZXJ5IHRpbWUg\ndGhlIG9iamVjdCBpcyBtb2RpZmllZCBieSB0aGUgdXNlciB0aGVyZWFmdGVy\nLgogICAgICovCiAgICB2b2lkIHNldERpcnR5KFN0YXRlTWFuYWdlckltcGwg\nc20sIGJvb2xlYW4gZmlyc3REaXJ0eSkgewogICAgICAgIGlmIChzbS5pc1Bl\ncnNpc3RlbnQoKSkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hf\nUkVRVUlSRUQ7CgogICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYm\nICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgaWYgKF9z\nYXZlcG9pbnRDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3NhdmVw\nb2ludENhY2hlID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3NhdmVw\nb2ludENhY2hlLmFkZChzbSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmly\nc3REaXJ0eSAmJiBzbS5pc1RyYW5zYWN0aW9uYWwoKSkgewogICAgICAgICAg\nICBsb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAv\nLyBjYWNoZSBkaXJ0eSBpbnN0YW5jZQogICAgICAgICAgICAgICAgaWYgKCFo\nYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAgICAgICAgICAgICAg\nIF90cmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZShfb3JkZXJE\naXJ0eSk7CiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZS5hZGREaXJ0eShz\nbSk7CgogICAgICAgICAgICAgICAgLy8gYWxzbyByZWNvcmQgdGhhdCB0aGUg\nY2xhc3MgaXMgZGlydHkKICAgICAgICAgICAgICAgIGlmIChzbS5pc05ldygp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNz\nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBfcGVyc2lz\ndGVkQ2xzcy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBl\nKCkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5pc0RlbGV0ZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfZGVsZXRlZENsc3MgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzID0g\nbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENs\nc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKF91cGRhdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBfdXBkYXRlZENsc3MgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAg\nICAgICAgICAgIF91cGRhdGVkQ2xzcy5hZGQoc20uZ2V0TWV0YURhdGEoKS5n\nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIC8vIGlmIHRyYWNraW5nIGNoYW5nZXMgYW5kIHRoaXMgaW5z\ndGFuY2Ugd2Fzbid0IGFscmVhZHkgZGlydHksCiAgICAgICAgICAgICAgICAv\nLyBhZGQgdG8gY2hhbmdlZCBzZXQ7IHdlIHVzZSB0aGlzIGZvciBkZXRlY3Rp\nbmcgaW5zdGFuY2VzIHRoYXQKICAgICAgICAgICAgICAgIC8vIGVudGVyIHRo\nZSB0cmFuc2FjdGlvbiBkdXJpbmcgcHJlIHN0b3JlCiAgICAgICAgICAgICAg\nICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlv\nbnMuYWRkKHNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTm90aWZ5IHRo\nZSBicm9rZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQK\nICAgICAqIGJlIGFkZGVkIHRvIHRoZSBzZXQgb2YgaW5zdGFuY2VzIHRoYXQg\nd2lsbCBiZWNvbWUgdHJhbnNhY3Rpb25hbAogICAgICogb24gdGhlIG5leHQg\ndHJhbnNhY3Rpb24KICAgICAqLwogICAgdm9pZCBhZGRUb1BlbmRpbmdUcmFu\nc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfcGVuZGluZyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX3BlbmRpbmcgPSBuZXcgSGFzaFNldCgp\nOwogICAgICAgICAgICBfcGVuZGluZy5hZGQoc20pOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdl\nciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICog\nYmUgcmVtb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVk\nIGluIHRoZSBuZXh0IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJl\nbW92ZUZyb21QZW5kaW5nVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBz\nbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoX3BlbmRpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wZW5k\naW5nLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSAh\nPSBudWxsICYmICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAg\nIF9kZXJlZkNhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmplY3Qg\ndG8gdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIncyBjYWNoZS4KICAgICAqIE9u\nIGZsdXNoLCB0aGVzZSBvYmplY3RzIHdpbGwgYmUgZGVsZXRlZC4KICAgICAq\nLwogICAgdm9pZCBhZGREZXJlZmVyZW5jZWREZXBlbmRlbnQoU3RhdGVNYW5h\nZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyBpZiB3ZSdyZSBpbiB0aGUgbWlkZGxlIG9mIGZsdXNo\nIGFuZCBpbnRyb2R1Y2luZyBtb3JlIGRlcmVmcwogICAgICAgICAgICAvLyB2\naWEgaW5zdGFuY2UgY2FsbGJhY2tzLCBhZGQgdGhlbSB0byB0aGUgc3BlY2lh\nbCBhZGRpdGlvbnMgc2V0CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19ERVJFRkRFTEVUSU5HKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2RlcmVmQWRkaXRpb25zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nX2RlcmVmQWRkaXRpb25zID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAg\nICAgIF9kZXJlZkFkZGl0aW9ucy5hZGQoc20pOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUgPSBuZXcgSGFzaFNl\ndCgpOwogICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUuYWRkKHNtKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIHRoZSBnaXZlbiBwcmV2aW91c2x5IGRlcmVmZXJlbmNlZCBk\nZXBlbmRlbnQgb2JqZWN0IGZyb20gdGhlCiAgICAgKiBjYWNoZS4gSXQgaXMg\nbm93IHJlZmVyZW5jZWQuCiAgICAgKi8KICAgIHZvaWQgcmVtb3ZlRGVyZWZl\ncmVuY2VkRGVwZW5kZW50KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiBy\nZW1vdmVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChfZGVyZWZBZGRpdGlv\nbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlbW92ZWQgPSBfZGVyZWZB\nZGRpdGlvbnMucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKCFyZW1vdmVk\nICYmIChfZGVyZWZDYWNoZSA9PSBudWxsIHx8ICFfZGVyZWZDYWNoZS5yZW1v\ndmUoc20pKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1kZXJlZmVkIiwKICAgICAgICAg\nICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHNtLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9i\namVjdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkuCiAgICAgICAgICAgICAg\nICAgICAgc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGRpcnR5VHlwZShDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoY2xz\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfdXBkYXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91cGRh\ndGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIF91cGRhdGVk\nQ2xzcy5hZGQoY2xzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIENvbGxlY3Rpb24gZ2V0UGVyc2lzdGVkVHlwZXMoKSB7CiAgICAgICAgaWYg\nKF9wZXJzaXN0ZWRDbHNzID09IG51bGwgfHwgX3BlcnNpc3RlZENsc3MuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlf\nTElTVDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxl\nQ29sbGVjdGlvbihfcGVyc2lzdGVkQ2xzcyk7CiAgICB9CgogICAgcHVibGlj\nIENvbGxlY3Rpb24gZ2V0VXBkYXRlZFR5cGVzKCkgewogICAgICAgIGlmIChf\ndXBkYXRlZENsc3MgPT0gbnVsbCB8fCBfdXBkYXRlZENsc3MuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsK\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVj\ndGlvbihfdXBkYXRlZENsc3MpOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0\naW9uIGdldERlbGV0ZWRUeXBlcygpIHsKICAgICAgICBpZiAoX2RlbGV0ZWRD\nbHNzID09IG51bGwgfHwgX2RlbGV0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX2Rl\nbGV0ZWRDbHNzKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gQ2xv\nc2luZwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Ns\nb3NlZCgpIHsKICAgICAgICByZXR1cm4gX2Nsb3NlZDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0Nsb3NlSW52b2tlZCgpIHsKICAgICAgICByZXR1\ncm4gX2Nsb3NlZCB8fCAoX2ZsYWdzICYgRkxBR19DTE9TRV9JTlZPS0VEKSAh\nPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyB0aHJvdyBhbiBleGNlcHRpb24gaWYgY2xvc2luZyBpbiBhbiBh\nY3RpdmUgbG9jYWwgdHJhbnMKICAgICAgICAgICAgaWYgKCFfbWFuYWdlZCAm\nJiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJh\nY3RpdmUiKSk7CgogICAgICAgICAgICAvLyBvbmx5IGNsb3NlIGlmIG5vdCBh\nY3RpdmU7IGlmIGFjdGl2ZSBtYW5hZ2VkIHRyYW5zIHdhaXQKICAgICAgICAg\nICAgLy8gZm9yIGNvbXBsZXRpb24KICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfQ0xPU0VfSU5WT0tFRDsKCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBmcmVlKCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRnJlZSB0aGUgcmVz\nb3VyY2VzIHVzZWQgYnkgdGhpcyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBmcmVlKCkgewogICAgICAgIFJ1bnRp\nbWVFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAgICBpZiAoKF9hdXRvRGV0\nYWNoICYgREVUQUNIX0NMT1NFKSAhPSAwKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChfY2FsbCk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgICAgIGVyciA9IHJlOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBfc3luYyA9IG51bGw7CiAgICAgICAgX3VzZXJPYmplY3Rz\nID0gbnVsbDsKICAgICAgICBfY2FjaGUuY2xlYXIoKTsKICAgICAgICBfdHJh\nbnNDYWNoZSA9IG51bGw7CiAgICAgICAgX3BlcnNpc3RlZENsc3MgPSBudWxs\nOwogICAgICAgIF91cGRhdGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlbGV0\nZWRDbHNzID0gbnVsbDsKICAgICAgICBfZGVyZWZDYWNoZSA9IG51bGw7CiAg\nICAgICAgX3BlbmRpbmcgPSBudWxsOwogICAgICAgIF9sb2FkZXIgPSBudWxs\nOwogICAgICAgIF90cmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIgPSBudWxsOwoKICAgICAgICBPcGVuSlBBU2F2\nZXBvaW50IHNhdmU7CiAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9IG51\nbGwgJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBz\nYXZlID0KICAgICAgICAgICAgICAgIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2\nZXBvaW50cy5yZW1vdmUoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAg\nICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAgfQogICAgICAg\nIF9zYXZlcG9pbnRzID0gbnVsbDsKICAgICAgICBfc2F2ZXBvaW50Q2FjaGUg\nPSBudWxsOwoKICAgICAgICBpZiAoX3F1ZXJpZXMgIT0gbnVsbCkgewogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9xdWVyaWVzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICgoUXVlcnkpIGl0ci5uZXh0KCkpLmNsb3Nl\nUmVzb3VyY2VzKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgX3F1ZXJpZXMgPSBudWxsOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKF9leHRlbnRzICE9IG51bGwpIHsKICAgICAgICAgICAgRXh0\nZW50IGU7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2V4dGVu\ndHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIGUgPSAoRXh0ZW50KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBlLmNsb3NlQWxsKCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2V4\ndGVudHMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsgcmVsZWFz\nZUNvbm5lY3Rpb24oKTsgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\ne30KCiAgICAgICAgX2xtLmNsb3NlKCk7CiAgICAgICAgX3N0b3JlLmNsb3Nl\nKCk7CiAgICAgICAgX2ZsYWdzID0gMDsKICAgICAgICBfY2xvc2VkID0gdHJ1\nZTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBfY2xvc2VkRXhjZXB0aW9uID0gbmV3IElsbGVnYWxTdGF0ZUV4Y2Vw\ndGlvbigpOwoKICAgICAgICBpZiAoZXJyICE9IG51bGwpCiAgICAgICAgICAg\nIHRocm93IGVycjsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBTeW5jaHJvbml6YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwdWJsaWMgdm9pZCBsb2NrKCkgewogICAgICAgIGlmIChfbG9jayAh\nPSBudWxsKQogICAgICAgICAgICBfbG9jay5sb2NrKCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgdW5sb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBu\ndWxsKQogICAgICAgICAgICBfbG9jay51bmxvY2soKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU3RhdGUgbWFuYWdlbWVudAog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2JqZWN0IG5l\nd0luc3RhbmNlKENsYXNzIGNscykgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nCiAgICAgICAgaWYgKGNscy5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3Np\ndG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShj\nbHMsIF9sb2FkZXIsIHRydWUpOwogICAgICAgICAgICBjbHMgPSBtZXRhLmdl\ndEludGVyZmFjZUltcGwoKTsKICAgICAgICB9IGVsc2UgaWYgKE1vZGlmaWVy\nLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAoIm5ldy1hYnN0cmFjdCIsIGNscykuZ2V0\nTWVzc2FnZSgpKTsKCiAgICAgICAgLy8gMS41IGRvZXNuJ3QgaW5pdGlhbGl6\nZSBjbGFzc2VzIHdpdGhvdXQgYSB0cnVlIENsYXNzLmZvck5hbWUKICAgICAg\nICBpZiAoIVBDUmVnaXN0cnkuaXNSZWdpc3RlcmVkKGNscykpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xz\nLmdldE5hbWUoKSwgdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgKENsYXNz\nTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2Fk\nZXJBY3Rpb24oY2xzKSkpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2Fi\nbGUgdCkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKGNscywgbnVsbCwgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0SWQoT2JqZWN0IG9i\naikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhl\nbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJ\nbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKQog\nICAgICAgICAgICAgICAgLnBjRmV0Y2hPYmplY3RJZCgpOwogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja0xldmVs\nKE9iamVjdCBvKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlm\nIChvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxP\nQ0tfTk9ORTsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGdl\ndFN0YXRlTWFuYWdlcihvKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgICAg\nIHJldHVybiBnZXRMb2NrTWFuYWdlcigpLmdldExvY2tMZXZlbChzbSk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRWZXJzaW9uKE9iamVjdCBvYmop\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxw\nZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1w\nbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNH\nZXRWZXJzaW9uKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNEaXJ0eShPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29u\nZik7CiAgICAgICAgICAgIHJldHVybiBwYy5wY0lzRGlydHkoKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzVHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9Q\nZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpCiAgICAgICAgICAgICAg\nICAucGNJc1RyYW5zYWN0aW9uYWwoKTsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZXJzaXN0ZW50KE9iamVj\ndCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKElt\ncGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVy\nbiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25m\nKSkucGNJc1BlcnNpc3RlbnQoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNOZXcoT2JqZWN0IG9iaikgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5p\nc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVs\ncGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0lzTmV3\nKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRGVsZXRlZChPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNEZWxldGVkKCk7CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRGV0YWNoZWQoT2JqZWN0IG9iaikgewogICAgICAgIGlmICghKEltcGxIZWxw\nZXIuaXNNYW5hZ2VhYmxlKG9iaikpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7CiAgICAgICAg\nQm9vbGVhbiBkZXRhY2hlZCA9IHBjLnBjSXNEZXRhY2hlZCgpOwogICAgICAg\nIGlmIChkZXRhY2hlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZGV0\nYWNoZWQuYm9vbGVhblZhbHVlKCk7CgogICAgICAgIC8vIGxhc3QgcmVzb3J0\nOiBpbnN0YW5jZSBpcyBkZXRhY2hlZCBpZiBpdCBoYXMgYSBzdG9yZSByZWNv\ncmQKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRh\nRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRNZXRh\nRGF0YShJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0YW5jZShwYykuZ2V0Q2xh\nc3MoKSwKICAgICAgICAgICAgICAgIF9sb2FkZXIsIHRydWUpOwogICAgICAg\nIE9iamVjdCBvaWQgPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUocGMsIG1ldGEp\nOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiBmaW5kKG9pZCwgbnVsbCwgRVhDTFVE\nRV9BTEwsIG51bGwsIDApICE9IG51bGw7CiAgICB9CgogICAgcHVibGljIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0U3RhdGVNYW5hZ2VyKE9iamVjdCBvYmop\nIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIGdldFN0\nYXRlTWFuYWdlckltcGwob2JqLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBp\nbnN0YW5jZSwgb3IgbnVsbC4KICAgICAqCiAgICAgKiBAcGFyYW0gYXNzZXJ0\nVGhpc0NvbnRleHQgaWYgdHJ1ZSwgdGhvdyBhbiBleGNlcHRpb24gaWYgdGhl\nIGdpdmVuCiAgICAgKiBvYmplY3QgaXMgbWFuYWdlZCBieSBhbm90aGVyIGJy\nb2tlcgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvYmosCiAgICAgICAgYm9vbGVh\nbiBhc3NlcnRUaGlzQ29udGV4dCkgewogICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlYWJsZShvYmopKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUo\nb2JqLCBfY29uZik7CiAgICAgICAgICAgIGlmIChwYy5wY0dldEdlbmVyaWND\nb250ZXh0KCkgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiAoU3Rh\ndGVNYW5hZ2VySW1wbCkgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAg\nICAgICAgaWYgKGFzc2VydFRoaXNDb250ZXh0ICYmIHBjLnBjR2V0R2VuZXJp\nY0NvbnRleHQoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2VkIiwKICAgICAg\nICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRG\nYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1h\nbmFnZXIgZm9yIHRoZSBnaXZlbiBvaWQuCiAgICAgKgogICAgICogQHBhcmFt\nIGFsbG93TmV3IGlmIHRydWUsIG9iamVjdHMgbWFkZSBwZXJzaXN0ZW50IGlu\nIHRoZSBjdXJyZW50CiAgICAgKiB0cmFuc2FjdGlvbiB3aWxsIGJlIGluY2x1\nZGVkIGluIHRoZSBzZWFyY2g7IGlmCiAgICAgKiBtdWx0aXBsZSBuZXcgb2Jq\nZWN0cyBtYXRjaCB0aGUgZ2l2ZW4gb2lkLCBpdCBpcwogICAgICogdW5kZWZp\nbmVkIHdoaWNoIHdpbGwgYmUgcmV0dXJuZWQKICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0YXRlTWFuYWdlckltcGwgZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQo\nT2JqZWN0IG9pZCwKICAgICAgICBib29sZWFuIGFsbG93TmV3KSB7CiAgICAg\nICAgcmV0dXJuIF9jYWNoZS5nZXRCeUlkKG9pZCwgYWxsb3dOZXcpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBnaXZlbiBpbnN0YW5jZSBh\ncyBhIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGV9LgogICAgICogSWYgdGhl\nIGluc3RhbmNlIGlzIG5vdCBtYW5hZ2VhYmxlIHRocm93IHRoZSBwcm9wZXIg\nZXhjZXB0aW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VD\nYXBhYmxlIGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShPYmplY3Qgb2JqKSB7\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2Jq\nKSkKICAgICAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5j\nZUNhcGFibGUob2JqLCBfY29uZik7CgogICAgICAgIC8vIGNoZWNrIGZvciBk\naWZmZXJlbnQgaW5zdGFuY2VzIG9mIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUg\naW50ZXJmYWNlCiAgICAgICAgLy8gYW5kIHRocm93IGEgYmV0dGVyIGVycm9y\nIHRoYXQgbWVudGlvbnMgdGhlIGNsYXNzIGxvYWRlcnMKICAgICAgICBDbGFz\nc1tdIGludGZzID0gb2JqLmdldENsYXNzKCkuZ2V0SW50ZXJmYWNlcygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpbnRmcyAhPSBudWxsICYmIGkgPCBp\nbnRmcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaW50ZnNbaV0u\nZ2V0TmFtZSgpLmVxdWFscyhQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuZ2V0\nTmFtZSgpKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoInBjLWxvYWRlci1kaWZmZXJlbnQiLAogICAgICAg\nICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSwKICAgICAg\nICAgICAgICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbigKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykpLAogICAg\nICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGludGZzW2ldKSkpKQog\nICAgICAgICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90IGVuaGFuY2Vk\nCiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBj\nLWNhc3QiLAogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikp\nKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgIH0KCiAgICAvLy8vLy8vLy8K\nICAgIC8vIFV0aWxzCiAgICAvLy8vLy8vLy8KICAgIC8qKgogICAgICogVGhy\nb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBjb250ZXh0IGlzIGNsb3NlZC4gIFRo\nZSBleGFjdCBtZXNzYWdlIGFuZAogICAgICogY29udGVudCBvZiB0aGUgZXhj\nZXB0aW9uIHZhcmllcyB3aGV0aGVyIFRSQUNFIGlzIGVuYWJsZWQgb3Igbm90\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVuKCkgewogICAg\nICAgIGlmIChfY2xvc2VkKSB7CiAgICAgICAgICAgIGlmIChfY2xvc2VkRXhj\nZXB0aW9uID09IG51bGwpICAvLyBUUkFDRSBub3QgZW5hYmxlZAogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgiY2xvc2VkLW5vdHJhY2UiKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJjbG9zZWQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgX2Nsb3Nl\nZEV4Y2VwdGlvbikuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCkgewog\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQoKICAgIC8qKgogICAgICogVGhy\nb3cgZXhjZXB0aW9uIGlmIGEgdHJhbnNhY3Rpb24tcmVsYXRlZCBvcGVyYXRp\nb24gaXMgYXR0ZW1wdGVkIGFuZAogICAgICogbm8gdHJhbnNhY3Rpb24gaXMg\nYWN0aXZlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0VHJhbnNh\nY3Rpb25PcGVyYXRpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRT\ndGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWFjdGl2ZSIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgp\nIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYm\nICFfbm9udHJhbnNSZWFkKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRXcml0ZU9wZXJhdGlvbigp\nIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYm\nICghX25vbnRyYW5zV3JpdGUKICAgICAgICAgICAgfHwgKF9hdXRvRGV0YWNo\nICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMCkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJ3cml0ZS1v\ncGVyYXRpb24iKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4g\nb2JqZWN0IG5vdCBmb3VuZCBleGNlcHRpb24gY29udGFpbmluZyBuZXN0ZWQg\nZXhjZXB0aW9ucwogICAgICogZm9yIGFsbCBvZiB0aGUgZ2l2ZW4gZmFpbGVk\nIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uCiAg\nICAgICAgKENvbGxlY3Rpb24gZmFpbGVkKSB7CiAgICAgICAgVGhyb3dhYmxl\nW10gdCA9IG5ldyBUaHJvd2FibGVbZmFpbGVkLnNpemUoKV07CiAgICAgICAg\naW50IGlkeCA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmYWls\nZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAg\nICAgIHRbaWR4XSA9IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihpdHIu\nbmV4dCgpKTsKICAgICAgICByZXR1cm4gbmV3IE9iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uKGZhaWxlZCwgdCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZpbmRDYWxsYmFja3MgaW1wbGVt\nZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIE9iamVjdCBwcm9jZXNzQXJndW1lbnQoT2JqZWN0IG9p\nZCkgewogICAgICAgIHJldHVybiBvaWQ7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBwcm9jZXNzUmV0dXJuKE9iamVjdCBvaWQsIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20pIHsKICAgICAgICByZXR1cm4gKHNtID09IG51bGwpID8gbnVs\nbCA6IHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2FjaGUgb2YgbWFuYWdlZCBvYmplY3RzLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBNYW5hZ2VkQ2FjaGUgewoKICAgICAgICBw\ncml2YXRlIGZpbmFsIE1hcCBfbWFpbjsgLy8gb2lkIC0+IHNtCiAgICAgICAg\ncHJpdmF0ZSBNYXAgX2NvbmZsaWN0cyA9IG51bGw7IC8vIGNvbmZsaWN0IG9p\nZCAtPiBuZXcgc20KICAgICAgICBwcml2YXRlIE1hcCBfbmV3cyA9IG51bGw7\nIC8vIHRtcCBpZCAtPiBuZXcgc20KICAgICAgICBwcml2YXRlIENvbGxlY3Rp\nb24gX2VtYmVkcyA9IG51bGw7IC8vIGVtYmVkZGVkL25vbi1wZXJzaXN0ZW50\nIHNtcwogICAgICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfdW50cmFja2VkID0g\nbnVsbDsgLy8gaGFyZCByZWZzIHRvIHVudHJhY2tlZCBzbXMKCiAgICAgICAg\nLyoqCiAgICAgICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBwcmltYXJ5IGNh\nY2hlIG1hcC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgTWFuYWdlZENh\nY2hlKE1hcCBjYWNoZSkgewogICAgICAgICAgICBfbWFpbiA9IGNhY2hlOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBp\nbnN0YW5jZSBmb3IgdGhlIGdpdmVuIG9pZCwgb3B0aW9uYWxseSBhbGxvd2lu\nZwogICAgICAgICAqIG5ldyBpbnN0YW5jZXMuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIFN0YXRlTWFuYWdlckltcGwgZ2V0QnlJZChPYmplY3Qgb2lk\nLCBib29sZWFuIGFsbG93TmV3KSB7CiAgICAgICAgICAgIGlmIChvaWQgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAg\nICAgLy8gY2hlY2sgbWFpbiBjYWNoZSBmb3Igb2lkCiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgX21haW4u\nZ2V0KG9pZCk7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20yOwog\nICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nLy8gaWYgaXQncyBhIG5ldyBpbnN0YW5jZSwgd2Uga25vdyBpdCdzIHRoZSBv\nbmx5IG1hdGNoLCBiZWNhdXNlCiAgICAgICAgICAgICAgICAvLyBvdGhlciBw\nZXJzIGluc3RhbmNlcyBvdmVycmlkZSBuZXcgaW5zdGFuY2VzIGluIF9jYWNo\nZQogICAgICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIChhbGxvd05ldykgPyBzbSA6IG51bGw7CiAgICAg\nICAgICAgICAgICBpZiAoIWFsbG93TmV3IHx8ICFzbS5pc0RlbGV0ZWQoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gc207CgogICAgICAgICAgICAg\nICAgLy8gc20gaXMgZGVsZXRlZDsgY2hlY2sgY29uZmxpY3QgY2FjaGUKICAg\nICAgICAgICAgICAgIGlmIChfY29uZmxpY3RzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICBzbTIgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX2NvbmZs\naWN0cy5nZXQob2lkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc20yICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzbTI7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGF0IHRoaXMgcG9pbnQgc20gaXMgbnVsbCBvciBkZWxldGVkOyBjaGVjayB0\naGUgbmV3IGNhY2hlIGZvcgogICAgICAgICAgICAvLyBhbnkgbWF0Y2hlcy4g\ndGhpcyBhbGxvd3MgdXMgdG8gbWF0Y2ggYXBwIGlkIG9iamVjdHMgdG8gbmV3\nCiAgICAgICAgICAgIC8vIGluc3RhbmNlcyB3aXRob3V0IHBlcm1hbmFudCBv\naWRzCiAgICAgICAgICAgIGlmIChhbGxvd05ldyAmJiBfbmV3cyAhPSBudWxs\nICYmICFfbmV3cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIHNtMiA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBfbmV3cy5nZXQob2lkKTsKICAgICAgICAg\nICAgICAgIGlmIChzbTIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gc20yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBz\nbTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGwgdGhp\ncyBtZXRob2Qgd2hlbiBhIG5ldyBzdGF0ZSBtYW5hZ2VyIGluaXRpYWxpemVz\nIGl0c2VsZi4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGQo\nU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoIXNtLmlz\nSW50ZXJjZXB0aW5nKCkpIHsKICAgICAgICAgICAgICAgIGlmIChfdW50cmFj\na2VkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3VudHJhY2tlZCA9\nIG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICBfdW50cmFja2VkLmFk\nZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghc20uaXNQ\nZXJzaXN0ZW50KCkgfHwgc20uaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAg\nICAgICBpZiAoX2VtYmVkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9lbWJlZHMgPSBuZXcgUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNo\nU2V0LldFQUspOwogICAgICAgICAgICAgICAgX2VtYmVkcy5hZGQoc20pOwog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBpbml0aWFsaXppbmcgbmV3IGluc3RhbmNlOyBwdXQgaW4gbmV3\nIGNhY2hlIGJlY2F1c2Ugd29uJ3QgaGF2ZQogICAgICAgICAgICAvLyBwZXJt\nYW5lbnQgb2lkIHlldAogICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkgewog\nICAgICAgICAgICAgICAgaWYgKF9uZXdzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgX25ld3MgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAg\nICAgX25ld3MucHV0KHNtLmdldElkKCksIHNtKTsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaW5pdGlh\nbGl6aW5nIHBlcnNpc3RlbnQgaW5zdGFuY2U7IHB1dCBpbiBtYWluIGNhY2hl\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3JpZyA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBfbWFpbi5wdXQKICAgICAgICAgICAgICAgIChzbS5nZXRP\nYmplY3RJZCgpLCBzbSk7CiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgp\nLCBvcmlnKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJkdXAtbG9hZCIsCiAgICAgICAgICAgICAgICAgICAg\nc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAg\nICAgICAgICAgICAgIChvcmlnLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgog\nICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gc3RhdGUgbWFu\nYWdlciBmcm9tIHRoZSBjYWNoZSB3aGVuIGl0IHRyYW5zaXRpb25zCiAgICAg\nICAgICogdG8gdHJhbnNpZW50LgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIHJlbW92ZShPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20p\nIHsKICAgICAgICAgICAgLy8gaWYgaXQgaGFzIGEgcGVybWFuZW50IG9pZCwg\ncmVtb3ZlIGZyb20gbWFpbiAvIGNvbmZsaWN0IGNhY2hlLAogICAgICAgICAg\nICAvLyBlbHNlIHJlbW92ZSBmcm9tIGVtYmVkZGVkL25vbnRyYW5zIGNhY2hl\nLCBhbmQgaWYgbm90IHRoZXJlCiAgICAgICAgICAgIC8vIHJlbW92ZSBmcm9t\nIG5ldyBjYWNoZQogICAgICAgICAgICBPYmplY3Qgb3JpZzsKICAgICAgICAg\nICAgaWYgKHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgb3JpZyA9IF9tYWluLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAg\nICBpZiAob3JpZyAhPSBzbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChv\ncmlnICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIF9tYWluLnB1\ndChpZCwgb3JpZyk7IC8vIHB1dCBiYWNrCiAgICAgICAgICAgICAgICAgICAg\naWYgKF9jb25mbGljdHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBvcmlnID0gX2NvbmZsaWN0cy5yZW1vdmUoaWQpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0gc20p\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29uZmxpY3RzLnB1dChp\nZCwgb3JpZyk7IC8vIHB1dCBiYWNrCiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKChfZW1i\nZWRzID09IG51bGwgfHwgIV9lbWJlZHMucmVtb3ZlKHNtKSkKICAgICAgICAg\nICAgICAgICYmIF9uZXdzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9y\naWcgPSBfbmV3cy5yZW1vdmUoaWQpOwogICAgICAgICAgICAgICAgaWYgKG9y\naWcgIT0gbnVsbCAmJiBvcmlnICE9IHNtKQogICAgICAgICAgICAgICAgICAg\nIF9uZXdzLnB1dChpZCwgb3JpZyk7IC8vIHB1dCBiYWNrCiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChfdW50cmFja2VkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfdW50cmFja2VkLnJlbW92ZShzbSk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBBbiBlbWJlZGRlZCBvciBub25wZXJz\naXN0ZW50IG1hbmFnZWQgaW5zdGFuY2UgaGFzIGJlZW4gcGVyc2lzdGVkLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoU3RhdGVN\nYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoX2VtYmVkcyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX2VtYmVkcy5yZW1vdmUoc20pOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQSBuZXcgaW5zdGFuY2Ug\naGFzIGp1c3QgYmVlbiBhc3NpZ25lZCBhIHBlcm1hbmVudCBvaWQuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYXNzaWduT2JqZWN0SWQoT2Jq\nZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIC8v\nIGlmIGFzc2lnbmluZyBvaWQsIHJlbW92ZSBmcm9tIG5ldyBjYWNoZSBhbmQg\ncHV0IGluIHByaW1hcnk7IG1heQogICAgICAgICAgICAvLyBub3QgYmUgaW4g\nbmV3IGNhY2hlIGlmIGFub3RoZXIgbmV3IGluc3RhbmNlIGhhZCBzYW1lIGlk\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3JpZyA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBfbmV3cy5yZW1vdmUoaWQpOwogICAgICAgICAgICBpZiAo\nb3JpZyAhPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAgICAgICAgICBf\nbmV3cy5wdXQoaWQsIG9yaWcpOyAvLyBwdXQgYmFjawoKICAgICAgICAgICAg\nLy8gcHV0IGluIG1haW4gY2FjaGUsIGJ1dCBtYWtlIHN1cmUgd2UgZG9uJ3Qg\ncmVwbGFjZSBhbm90aGVyCiAgICAgICAgICAgIC8vIGluc3RhbmNlIHdpdGgg\ndGhlIHNhbWUgb2lkCiAgICAgICAgICAgIG9yaWcgPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIHNtKTsKICAgICAg\nICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX21h\naW4ucHV0KHNtLmdldE9iamVjdElkKCksIG9yaWcpOwogICAgICAgICAgICAg\nICAgaWYgKCFvcmlnLmlzRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFz\nc2lnbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE9iamVjdElk\nKCksIEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAgICAgICAgICAg\nICAgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAg\nICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpOwoKICAgICAgICAgICAgICAgIC8vIHNhbWUgb2lkIGFzIGRlbGV0\nZWQgaW5zdGFuY2U7IHB1dCBpbiBjb25mbGljdCBjYWNoZQogICAgICAgICAg\nICAgICAgaWYgKF9jb25mbGljdHMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBfY29uZmxpY3RzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAg\nICAgIF9jb25mbGljdHMucHV0KHNtLmdldE9iamVjdElkKCksIHNtKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nQSBuZXcgaW5zdGFuY2UgaGFzIGNvbW1pdHRlZDsgcmVjYWNoZSB1bmRlciBw\nZXJtYW5lbnQgb2lkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIGNvbW1pdE5ldyhPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsK\nICAgICAgICAgICAgLy8gaWYgdGhlIGlkIGRpZG4ndCBjaGFuZ2UsIHRoZSBp\nbnN0YW5jZSB3YXMgYWxyZWFkeSBhc3NpZ25lZCBhbgogICAgICAgICAgICAv\nLyBpZCwgYnV0IGl0IGNvdWxkIGhhdmUgYmVlbiBpbiBjb25mbGljdCBjYWNo\nZQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWc7CiAgICAgICAg\nICAgIGlmIChzbS5nZXRPYmplY3RJZCgpID09IGlkKSB7CiAgICAgICAgICAg\nICAgICBvcmlnID0gKF9jb25mbGljdHMgPT0gbnVsbCkgPyBudWxsCiAgICAg\nICAgICAgICAgICAgICAgOiAoU3RhdGVNYW5hZ2VySW1wbCkgX2NvbmZsaWN0\ncy5yZW1vdmUoaWQpOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gc20p\nIHsKICAgICAgICAgICAgICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlcklt\ncGwpIF9tYWluLnB1dChpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGlm\nIChvcmlnICE9IG51bGwgJiYgIW9yaWcuaXNEZWxldGVkKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCks\nIG9yaWcpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiZHVwLW9pZC1hc3NpZ24iLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0\naW9ucy50b1N0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNt\nLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLnNldEZhaWxlZE9iamVjdAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0YW5j\nZSgpKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIG9pZCBjaGFuZ2VkLCBzbyBpdCBt\ndXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGEgbmV3IGluc3RhbmNlCiAgICAg\nICAgICAgIC8vIHdpdGhvdXQgYW4gYXNzaWduZWQgb2lkLiAgcmVtb3ZlIGl0\nIGZyb20gdGhlIG5ldyBjYWNoZTsgb2sgaWYKICAgICAgICAgICAgLy8gd2Ug\nZW5kIHVwIHJlbW92aW5nIGFub3RoZXIgaW5zdGFuY2Ugd2l0aCBzYW1lIGlk\nCiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX25ld3MucmVtb3ZlKGlkKTsKCiAgICAgICAgICAgIC8vIGFuZCBwdXQg\naW50byBtYWluIGNhY2hlIG5vdyB0aGF0IGlkIGlzIGFzc3NpZ25lZAogICAg\nICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLnB1dChz\nbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAgICAgICAgICAgIGlmIChvcmlnICE9\nIG51bGwgJiYgb3JpZyAhPSBzbSAmJiAhb3JpZy5pc0RlbGV0ZWQoKSkgewog\nICAgICAgICAgICAgICAgLy8gcHV0IGJhY2sgb3JpZyBhbmQgdGhyb3cgZXJy\nb3IKICAgICAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgp\nLCBvcmlnKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIsCiAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0aW9ucy50b1N0cmluZwog\nICAgICAgICAgICAgICAgICAgIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkp\nKS5zZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAoc20uZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpLnNldEZhdGFsKHRydWUpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4g\nYSBjb3B5IG9mIGFsbCBjYWNoZWQgcGVyc2lzdGVudCBvYmplY3RzLgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHkoKSB7CiAg\nICAgICAgICAgIC8vIHByb3hpZXMgbm90IGluY2x1ZGVkIGhlcmUgYmVjYXVz\nZSB0aGUgc3RhdGUgbWFuYWdlciBpcyBhbHdheXMKICAgICAgICAgICAgLy8g\ncHJlc2VudCBpbiBvdGhlciBjYWNoZXMgdG9vCgogICAgICAgICAgICBpbnQg\nc2l6ZSA9IF9tYWluLnNpemUoKTsKICAgICAgICAgICAgaWYgKF9jb25mbGlj\ndHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2NvbmZsaWN0\ncy5zaXplKCk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgc2l6ZSArPSBfbmV3cy5zaXplKCk7CiAgICAgICAgICAg\nIGlmIChfZW1iZWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBzaXplICs9\nIF9lbWJlZHMuc2l6ZSgpOwogICAgICAgICAgICBpZiAoc2l6ZSA9PSAwKQog\nICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nCgogICAgICAgICAgICBMaXN0IGNvcHkgPSBuZXcgQXJyYXlMaXN0KHNpemUp\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9tYWluLnZhbHVl\ncygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChfY29u\nZmxpY3RzICE9IG51bGwgJiYgIV9jb25mbGljdHMuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfY29uZmxpY3RzLnZh\nbHVlcygpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5l\neHQoKSk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsICYmICFfbmV3\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IF9uZXdzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwog\nICAgICAgICAgICBpZiAoX2VtYmVkcyAhPSBudWxsICYmICFfZW1iZWRzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nX2VtYmVkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAg\nICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAg\ncmV0dXJuIGNvcHk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBDbGVhciB0aGUgY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9tYWluLmNsZWFyKCk7CiAg\nICAgICAgICAgIGlmIChfY29uZmxpY3RzICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfY29uZmxpY3RzLmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChfbmV3\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgX25ld3MuY2xlYXIoKTsKICAg\nICAgICAgICAgaWYgKF9lbWJlZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9lbWJlZHMuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKF91bnRyYWNrZWQg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF91bnRyYWNrZWQuY2xlYXIoKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENsZWFyIG5ldyBp\nbnN0YW5jZXMgd2l0aG91dCBwZXJtYW5lbnQgb2lkcy4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBjbGVhck5ldygpIHsKICAgICAgICAgICAg\naWYgKF9uZXdzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfbmV3cy5jbGVh\ncigpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRpcnR5Q2hl\nY2soKSB7CiAgICAgICAgICAgIGlmIChfdW50cmFja2VkID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ZXIgPSBfdW50cmFja2VkLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4\ndCgpOyApCiAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0\nZXIubmV4dCgpKS5kaXJ0eUNoZWNrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogVHJhbnNhY3Rpb25hbCBjYWNoZSB0aGF0IGhvbGRzIHNv\nZnQgcmVmcyB0byBjbGVhbiBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIFRyYW5zYWN0aW9uYWxDYWNoZQogICAgICAgIGlt\ncGxlbWVudHMgU2V0IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFu\nIF9vcmRlckRpcnR5OwogICAgICAgIHByaXZhdGUgU2V0IF9kaXJ0eSA9IG51\nbGw7CiAgICAgICAgcHJpdmF0ZSBTZXQgX2NsZWFuID0gbnVsbDsKCiAgICAg\nICAgcHVibGljIFRyYW5zYWN0aW9uYWxDYWNoZShib29sZWFuIG9yZGVyRGly\ndHkpIHsKICAgICAgICAgICAgX29yZGVyRGlydHkgPSBvcmRlckRpcnR5Owog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29w\neSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBjb3B5KCkgewogICAg\nICAgICAgICBpZiAoaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAgICAgICAgICAvLyBzaXpl\nIG1heSBub3QgYmUgZW50aXJlbHkgYWNjdXJhdGUgZHVlIHRvIHJlZnMgZXhw\naXJpbmcsIHNvCiAgICAgICAgICAgIC8vIG1hbnVhbGx5IGNvcHkgZWFjaCBv\nYmplY3Q7IGRvZXNuJ3QgbWF0dGVyIHRoaXMgd2F5IGlmIHNpemUgdG9vCiAg\nICAgICAgICAgIC8vIGJpZyBieSBzb21lCiAgICAgICAgICAgIExpc3QgY29w\neSA9IG5ldyBBcnJheUxpc3Qoc2l6ZSgpKTsKICAgICAgICAgICAgaWYgKF9k\naXJ0eSAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfZGlydHkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAg\nICAgIGlmIChfY2xlYW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX2NsZWFuLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KQogICAgICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkp\nOwogICAgICAgICAgICByZXR1cm4gY29weTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0\nYXRlIG1hbmFnZXJzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGNvcHlEaXJ0eSgpIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSA9\nPSBudWxsIHx8IF9kaXJ0eS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBBcnJheUxpc3QoX2RpcnR5KTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFRyYW5zZmVyIHRoZSBnaXZlbiBpbnN0YW5jZSBm\ncm9tIHRoZSBkaXJ0eSBjYWNoZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZmx1c2hlZChTdGF0ZU1hbmFn\nZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkgJiYg\nX2RpcnR5ICE9IG51bGwgJiYgX2RpcnR5LnJlbW92ZShzbSkpCiAgICAgICAg\nICAgICAgICBhZGRDbGVhbkludGVybmFsKHNtKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8g\ndGhlIGNsZWFuIGNhY2hlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2\nb2lkIGFkZENsZWFuKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAg\nICAgaWYgKGFkZENsZWFuSW50ZXJuYWwoc20pICYmIF9kaXJ0eSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgX2RpcnR5LnJlbW92ZShzbSk7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gYWRkQ2xlYW5JbnRlcm5hbChT\ndGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChfY2xlYW4g\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jbGVhbiA9IG5ldyBSZWZlcmVu\nY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQuU09GVCk7CiAgICAgICAgICAg\nIHJldHVybiBfY2xlYW4uYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGRp\ncnR5IGNhY2hlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFk\nZERpcnR5KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYg\nKF9kaXJ0eSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX29yZGVy\nRGlydHkpCiAgICAgICAgICAgICAgICAgICAgX2RpcnR5ID0gTWFwQmFja2Vk\nU2V0LmRlY29yYXRlKG5ldyBMaW5rZWRNYXAoKSk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2RpcnR5ID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX2RpcnR5LmFk\nZChzbSkpCiAgICAgICAgICAgICAgICByZW1vdmVDbGVhbkludGVybmFsKHNt\nKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlbW92ZSB0\naGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSB0aGUgY2FjaGUuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKFN0YXRlTWFuYWdlcklt\ncGwgc20pIHsKICAgICAgICAgICAgcmV0dXJuIHJlbW92ZUNsZWFuSW50ZXJu\nYWwoc20pCiAgICAgICAgICAgICAgICB8fCAoX2RpcnR5ICE9IG51bGwgJiYg\nX2RpcnR5LnJlbW92ZShzbSkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0\nZSBib29sZWFuIHJlbW92ZUNsZWFuSW50ZXJuYWwoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgICAgICByZXR1cm4gX2NsZWFuICE9IG51bGwgJiYg\nX2NsZWFuLnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yQ2hh\naW4gY2hhaW4gPSBuZXcgSXRlcmF0b3JDaGFpbigpOwogICAgICAgICAgICBp\nZiAoX2RpcnR5ICE9IG51bGwgJiYgIV9kaXJ0eS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICBjaGFpbi5hZGRJdGVyYXRvcihfZGlydHkuaXRlcmF0b3Io\nKSk7CiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCAmJiAhX2NsZWFu\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9y\nKF9jbGVhbi5pdGVyYXRvcigpKTsKICAgICAgICAgICAgcmV0dXJuIGNoYWlu\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMo\nT2JqZWN0IG9iaikgewogICAgICAgICAgICByZXR1cm4gKF9kaXJ0eSAhPSBu\ndWxsICYmIF9kaXJ0eS5jb250YWlucyhvYmopKQogICAgICAgICAgICAgICAg\nfHwgKF9jbGVhbiAhPSBudWxsICYmIF9jbGVhbi5jb250YWlucyhvYmopKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQWxs\nKENvbGxlY3Rpb24gY29sbCkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICBpZiAoIWNvbnRhaW5zKGl0ci5uZXh0KCkpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigp\nIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2RpcnR5LmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChfY2xlYW4g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jbGVhbi5jbGVhcigpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgJiYgKF9jbGVhbiA9PSBudWxsIHx8\nIF9jbGVhbi5pc0VtcHR5KCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBzaXplKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAg\nICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNp\nemUgKz0gX2RpcnR5LnNpemUoKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfY2xlYW4uc2l6ZSgp\nOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIGFkZChPYmplY3Qgb2JqKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKENvbGxl\nY3Rpb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIHJlbW92ZShPYmplY3Qgb2JqKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENv\nbGxlY3Rpb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBw\nb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0\naW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9B\ncnJheSgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3Bl\ncmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nT2JqZWN0W10gdG9BcnJheShPYmplY3RbXSBhcnIpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5pcXVlIGlkIGZvciBz\ndGF0ZSBtYW5hZ2VycyBvZiBuZXcgZGF0YXN0b3JlIGluc3RhbmNlcyB3aXRo\nb3V0IGFzc2lnbmVkCiAgICAgKiBvYmplY3QgaWRzLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJZAogICAgICAgIGlt\ncGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU1RSSU5HX1BSRUZJWCA9ICJvcGVuanBhc206IjsK\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyBfZ2VuZXJhdG9yID0gMDsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2JoYXNoOwogICAgICAgIHBy\naXZhdGUgZmluYWwgbG9uZyBfaWQ7CgogICAgICAgIHB1YmxpYyBzdGF0aWMg\nU3RhdGVNYW5hZ2VySWQgbmV3SW5zdGFuY2UoQnJva2VyIGIpIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJZChTeXN0ZW0uaWRlbnRp\ndHlIYXNoQ29kZShiKSwgX2dlbmVyYXRvcisrKTsKICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgU3RhdGVNYW5hZ2VySWQoaW50IGJoYXNoLCBsb25nIGlk\nKSB7CiAgICAgICAgICAgIF9iaGFzaCA9IGJoYXNoOwogICAgICAgICAgICBf\naWQgPSBpZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdGF0ZU1hbmFn\nZXJJZChTdHJpbmcgc3RyKSB7CiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJz\ndHJpbmcoU1RSSU5HX1BSRUZJWC5sZW5ndGgoKSk7CiAgICAgICAgICAgIGlu\ndCBpZHggPSBzdHIuaW5kZXhPZignOicpOwogICAgICAgICAgICBfYmhhc2gg\nPSBJbnRlZ2VyLnBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMCwgaWR4KSk7CiAg\nICAgICAgICAgIF9pZCA9IExvbmcucGFyc2VMb25nKHN0ci5zdWJzdHJpbmco\naWR4ICsgMSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIg\nPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySWQgc2lkID0gKFN0YXRlTWFuYWdlcklkKSBvdGhlcjsKICAg\nICAgICAgICAgcmV0dXJuIF9iaGFzaCA9PSBzaWQuX2JoYXNoICYmIF9pZCA9\nPSBzaWQuX2lkOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNo\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIChpbnQpIChfaWQgXiAoX2lk\nID4+PiAzMikpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0\nb1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIFNUUklOR19QUkVGSVgg\nKyBfYmhhc2ggKyAiOiIgKyBfaWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQ29sbGVjdGlvbiB0eXBlIHRoYXQgaG9sZHMgc3RhdGUgbWFu\nYWdlcnMgYnV0IHdob3NlIGludGVyZmFjZSBkZWFscwogICAgICogd2l0aCB0\naGUgY29ycmVzcG9uZGluZyBtYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9u\nCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdENvbGxlY3Rpb24gewoKICAgICAg\nICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb24gX3N0YXRlczsKCiAgICAgICAg\ncHVibGljIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKENvbGxlY3Rpb24gc3Rh\ndGVzKSB7CiAgICAgICAgICAgIF9zdGF0ZXMgPSBzdGF0ZXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRTdGF0ZU1hbmFnZXJz\nKCkgewogICAgICAgICAgICByZXR1cm4gX3N0YXRlczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9zdGF0ZXMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0\nZXJhdG9yIGl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEl0\nZXJhdG9yKCkgewogICAgICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBJdGVy\nYXRvciBfaXRyID0gX3N0YXRlcy5pdGVyYXRvcigpOwoKICAgICAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIF9pdHIuaGFzTmV4dCgpOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gKChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nKSBfaXRyLm5leHQoKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1h\nbmFnZWRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

