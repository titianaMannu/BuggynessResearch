{"sha":"8ef8bdc01a1289a42a45590d84c75873d86f9856","node_id":"MDQ6QmxvYjIwNjM2NDo4ZWY4YmRjMDFhMTI4OWE0MmE0NTU5MGQ4NGM3NTg3M2Q4NmY5ODU2","size":29488,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8ef8bdc01a1289a42a45590d84c75873d86f9856","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuRGV0YWNoT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5DYWxsYmFja01vZGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHlNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBIYW5kbGVzIGRldGFjaGluZyBpbnN0YW5jZXMuCiAqCiAq\nIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBEZXRhY2hNYW5hZ2VyCiAgICBpbXBsZW1lbnRzIERl\ndGFjaFN0YXRlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKERldGFjaE1hbmFnZXIuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgZmluYWwgQnJva2VySW1wbCBfYnJva2VyOwogICAg\ncHJpdmF0ZSBmaW5hbCBib29sZWFuIF9jb3B5OwogICAgcHJpdmF0ZSBmaW5h\nbCBib29sZWFuIF9mdWxsOwogICAgcHJpdmF0ZSBmaW5hbCBQcm94eU1hbmFn\nZXIgX3Byb3h5OwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hPcHRpb25zIF9v\ncHRzOwogICAgcHJpdmF0ZSBmaW5hbCBPcENhbGxiYWNrcyBfY2FsbDsKICAg\nIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfZmFpbEZhc3Q7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2ZsdXNoZWQgPSBmYWxzZTsKCiAgICAvLyBpZiB3ZSdyZSBu\nb3QgZGV0YWNoaW5nIGZ1bGwsIHdlIG5lZWQgdG8gdHJhY2sgYWxsIGRldGFj\naGVkIG9iamVjdHM7CiAgICAvLyBpZiB3ZSBhcmUsIHRoZW4gd2UgdXNlIGEg\nc3BlY2lhbCBmaWVsZCBtYW5hZ2VyIGZvciBtb3JlIGVmZmljaWVudAogICAg\nLy8gZGV0YWNobWVudCB0aGFuIHRoZSBzdGFuZGFyZCBvbmUKICAgIHByaXZh\ndGUgZmluYWwgSWRlbnRpdHlNYXAgX2RldGFjaGVkOwogICAgcHJpdmF0ZSBm\naW5hbCBEZXRhY2hGaWVsZE1hbmFnZXIgX2Z1bGxGTTsKCiAgICAvKioKICAg\nICAqIFVzZWQgdG8gcHJlcGFyZSBhIGRldGFjaGFibGUgaW5zdGFuY2UgdGhh\ndCBkb2VzIG5vdCBleHRlcm5hbGl6ZQogICAgICogZGV0YWNoZWQgc3RhdGUu\nCiAgICAgKi8KICAgIHN0YXRpYyBib29sZWFuIHByZVNlcmlhbGl6ZShTdGF0\nZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBmbHVz\naERpcnR5KHNtKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20u\nZ2V0TWV0YURhdGEoKTsKICAgICAgICBib29sZWFuIHNldFN0YXRlID0gbWV0\nYS5nZXREZXRhY2hlZFN0YXRlKCkgIT0gbnVsbAogICAgICAgICAgICAmJiAh\nQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNo\nZWRTdGF0ZSgpKTsKICAgICAgICBCaXRTZXQgaWR4cyA9IChzZXRTdGF0ZSkg\nPyBuZXcgQml0U2V0KG1ldGEuZ2V0RmllbGRzKCkubGVuZ3RoKSA6IG51bGw7\nCiAgICAgICAgcHJlRGV0YWNoKHNtLmdldEJyb2tlcigpLCBzbSwgaWR4cyk7\nCgogICAgICAgIGlmIChzZXRTdGF0ZSkgewogICAgICAgICAgICBzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKS5wY1NldERldGFjaGVkU3RhdGUoZ2V0RGV0\nYWNoZWRTdGF0ZQogICAgICAgICAgICAgICAgKHNtLCBpZHhzKSk7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsgLy8gZG9uJ3QgbnVsbCBzdGF0ZQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzZWQgYnkgY2xhc3NlcyB0aGF0IGV4dGVybmFsaXplIGRldGFjaGVk\nIHN0YXRlLgogICAgICoKICAgICAqIEByZXR1cm4gd2hldGhlciB0byB1c2Ug\nYSBkZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHN0YXRpYyBi\nb29sZWFuIHdyaXRlRGV0YWNoZWRTdGF0ZShTdGF0ZU1hbmFnZXJJbXBsIHNt\nLCBPYmplY3RPdXRwdXQgb3V0LAogICAgICAgIEJpdFNldCBpZHhzKQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzbS5pc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICBvdXQud3JpdGVPYmplY3QobnVs\nbCk7IC8vIHN0YXRlCiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxs\nKTsgLy8gc20KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgLy8gZGlydHkgc3RhdGUgY2F1c2VzIGZsdXNoCiAgICAgICAg\nZmx1c2hEaXJ0eShzbSk7CgogICAgICAgIEJyb2tlciBicm9rZXIgPSBzbS5n\nZXRCcm9rZXIoKTsKICAgICAgICBwcmVEZXRhY2goYnJva2VyLCBzbSwgaWR4\ncyk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVkIHN0YXRlIG9iamVjdCBh\nbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cyA9\nIGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERl\ndGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoIW9wdHMuZ2V0RGV0\nYWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICB8fCAhdXNlRGV0YWNo\nZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAgICAgICAgICAgIG91dC53\ncml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNtLCBpZHhzKSk7CiAgICAg\nICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBvdXQud3JpdGVPYmplY3Qo\nbnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG5ldyBEZXRhY2hlZFN0\nYXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwKICAgICAg\nICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNzVW5sb2FkZWQoKSwgYnJv\na2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkgdGhlIG9iamVjdCBmb3Ig\nZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcgdGhlIGZpZWxkcyB0byBi\nZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5nIHZlcnNpb24gaW5mb3Jt\nYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlkeHMgdGhlIGluZGV4ZXMg\nb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNldCBhcyBhIHNpZGUKICAg\nICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIgYnJva2VyLCBTdGF0ZU1h\nbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBpZHhzKSB7CiAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoZSBleGlzdGluZyBvYmplY3QgaGFzIHRoZSByaWdo\ndCBmaWVsZHMgZmV0Y2hlZDsgY2FsbAogICAgICAgIC8vIGV2ZW4gaWYgdXNp\nbmcgY3VycmVudGx5LWxvYWRlZCBmaWVsZHMgZm9yIGRldGFjaCB0byBtYWtl\nIHN1cmUKICAgICAgICAvLyB2ZXJzaW9uIGlzIHNldAogICAgICAgIGludCBk\nZXRhY2hNb2RlID0gYnJva2VyLmdldERldGFjaFN0YXRlKCk7CiAgICAgICAg\naW50IGxvYWRNb2RlID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUzsKICAg\nICAgICBCaXRTZXQgZXhjbHVkZSA9IG51bGw7CiAgICAgICAgaWYgKGRldGFj\naE1vZGUgPT0gREVUQUNIX0xPQURFRCkKICAgICAgICAgICAgZXhjbHVkZSA9\nIFN0b3JlQ29udGV4dC5FWENMVURFX0FMTDsKICAgICAgICBlbHNlIGlmIChk\nZXRhY2hNb2RlID09IERFVEFDSF9BTEwpCiAgICAgICAgICAgIGxvYWRNb2Rl\nID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBzbS5sb2FkKGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKSwgbG9hZE1vZGUsIGV4Y2x1ZGUsIG51bGwsIAogICAgICAgICAgICAg\nICAgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgLy8gY29uc3VtZSB0aGUgZXhj\nZXB0aW9uCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYml0c2V0IG9m\nIGZpZWxkcyB0byBkZXRhY2g7IGlmIG1vZGUgaXMgYWxsIHdlIGNhbiB1c2UK\nICAgICAgICAvLyBjdXJyZW50bHkgbG9hZGVkIGJpdHNldCBjbG9uZSwgc2lu\nY2Ugd2Uga25vdyBhbGwgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICBpZiAo\naWR4cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChkZXRhY2hNb2RlID09\nIERFVEFDSF9GRVRDSF9HUk9VUFMpCiAgICAgICAgICAgICAgICBzZXRGZXRj\naEdyb3VwRmllbGRzKGJyb2tlciwgc20sIGlkeHMpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBpZHhzLm9yKHNtLmdldExvYWRlZCgpKTsK\nCiAgICAgICAgICAgIC8vIGNsZWFyIGxycyBmaWVsZHMKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZp\nZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xS\nUygpKQogICAgICAgICAgICAgICAgICAgIGlkeHMuY2xlYXIoaSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIGRldGFj\naGVkIHN0YXRlIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZXREZXRhY2hlZFN0YXRlKFN0YXRl\nTWFuYWdlckltcGwgc20sIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICAvLyBp\nZiBkYXRhc3RvcmUsIHN0b3JlIGlkIGluIGZpcnN0IGVsZW1lbnQKICAgICAg\nICBpbnQgb2Zmc2V0ID0gKHNtLmdldE1ldGFEYXRhKCkuZ2V0SWRlbnRpdHlU\neXBlKCkgPT0KICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RP\nUkUpID8gMSA6IDA7CgogICAgICAgIC8vIG1ha2UgdmVyc2lvbiBzdGF0ZSBh\ncnJheSBvbmUgbGFyZ2VyIGZvciBuZXcgaW5zdGFuY2VzOyBtYXJrcyBuZXcK\nICAgICAgICAvLyBpbnN0YW5jZXMgd2l0aG91dCBhZmZlY3Rpbmcgc2VyaWFs\naXphdGlvbiBzaXplIG11Y2gKICAgICAgICBPYmplY3RbXSBzdGF0ZTsKICAg\nICAgICBpZiAoc20uaXNOZXcoKSkKICAgICAgICAgICAgc3RhdGUgPSBuZXcg\nT2JqZWN0WzMgKyBvZmZzZXRdOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RhdGUgPSBuZXcgT2JqZWN0WzIgKyBvZmZzZXRdOwoKICAgICAgICBpZiAo\nb2Zmc2V0ID4gMCkgewogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAg\nICAgIGlmIChzbS5pc0VtYmVkZGVkKCkgfHwgc20uZ2V0T2JqZWN0SWQoKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgaWQgPSBzbS5nZXRJZCgpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZCA9IHNtLmdldE9iamVj\ndElkKCk7CiAgICAgICAgICAgIHN0YXRlWzBdID0gaWQudG9TdHJpbmcoKTsK\nICAgICAgICB9CiAgICAgICAgc3RhdGVbb2Zmc2V0XSA9IHNtLmdldFZlcnNp\nb24oKTsKICAgICAgICBzdGF0ZVtvZmZzZXQgKyAxXSA9IGZpZWxkczsKICAg\nICAgICByZXR1cm4gc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVz\naCBvciBpbnZva2UgcHJlLXN0b3JlIGNhbGxiYWNrcyBvbiB0aGUgZ2l2ZW4g\nYnJva2VyIGlmCiAgICAgKiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIGZsdXNo\nZWQvc3RvcmVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gZmx1c2hEaXJ0eShTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc0RpcnR5KCkgfHwgIXNtLmdldEJy\nb2tlcigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgLy8gb25seSBmbHVzaCBpZiB0aGVyZSBhcmUgYWN0dWFsbHkg\nYW55IGRpcnR5IG5vbi1mbHVzaGVkIGZpZWxkcwogICAgICAgIEJpdFNldCBk\naXJ0eUZpZWxkcyA9IHNtLmdldERpcnR5KCk7CiAgICAgICAgQml0U2V0IGZs\ndXNoZWRGaWVsZHMgPSBzbS5nZXRGbHVzaGVkKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBkaXJ0eUZpZWxkcy5zaXplKCk7IGkrKykgewogICAg\nICAgICAgICBpZiAoZGlydHlGaWVsZHMuZ2V0KGkpICYmICFmbHVzaGVkRmll\nbGRzLmdldChpKSkgewogICAgICAgICAgICAgICAgaWYgKHNtLmdldEJyb2tl\ncigpLmdldFJvbGxiYWNrT25seSgpKQogICAgICAgICAgICAgICAgICAgIHNt\nLmdldEJyb2tlcigpLnByZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0QnJva2VyKCkuZmx1c2goKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIGJpdCBzZXQgZm9yIHRoZSBmaWVsZHMgaW4gdGhl\nIGN1cnJlbnQgZmV0Y2ggZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyB2b2lkIHNldEZldGNoR3JvdXBGaWVsZHMoQnJva2VyIGJyb2tlciwK\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBCaXRTZXQgaWR4cykgewog\nICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmlzUHJpbWFyeUtleSgpIHx8IGZldGNoLnJl\ncXVpcmVzRmV0Y2goZm1kc1tpXSkKICAgICAgICAgICAgICAgICE9IEZldGNo\nQ29uZmlndXJhdGlvbi5GRVRDSF9OT05FKQogICAgICAgICAgICAgICAgaWR4\ncy5zZXQoaSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGJyb2tlciBvd25pbmcg\nYnJva2VyCiAgICAgKiBAcGFyYW0gZnVsbCB3aGV0aGVyIHRoZSBlbnRpcmUg\nYnJva2VyIGNhY2hlIGlzIGJlaW5nIGRldGFjaGVkOyBpZgogICAgICogdGhp\ncyBpcyB0aGUgY2FzZSwgd2UgYXNzdW1lIHRoZSBicm9rZXIgaGFzIGFscmVh\nZHkKICAgICAqIGZsdXNoZWQgaWYgbmVlZGVkLCBhbmQgdGhhdCB3ZSdyZSBk\nZXRhY2hpbmcgaW4tcGxhY2UKICAgICAqLwogICAgcHVibGljIERldGFjaE1h\nbmFnZXIoQnJva2VySW1wbCBicm9rZXIsIGJvb2xlYW4gZnVsbCwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAgICAg\nICAgX3Byb3h5ID0gYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRQcm94\neU1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9vcHRzID0gYnJva2VyLmdl\ndENvbmZpZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCk7CiAg\nICAgICAgX2NvcHkgPSAhZnVsbDsKICAgICAgICBfZmx1c2hlZCA9IGZ1bGw7\nCiAgICAgICAgX2NhbGwgPSBjYWxsOwogICAgICAgIF9mYWlsRmFzdCA9IChi\ncm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgp\nLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCkKICAgICAgICAgICAg\nJiBDYWxsYmFja01vZGVzLkNBTExCQUNLX0ZBSUxfRkFTVCkgIT0gMDsKCiAg\nICAgICAgLy8gd2UgY2FuIG9ubHkgcmVseSBvbiBvdXIgImFsbCIgc2hvcnRj\ndXRzIGlmIHdlIGtub3cgd2Ugd29uJ3QgYmUKICAgICAgICAvLyBsb2FkaW5n\nIGFueSBtb3JlIGRhdGEKICAgICAgICBfZnVsbCA9IGZ1bGwgJiYgYnJva2Vy\nLmdldERldGFjaFN0YXRlKCkgPT0gRGV0YWNoU3RhdGUuREVUQUNIX0xPQURF\nRDsKICAgICAgICBpZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2RldGFjaGVk\nID0gbnVsbDsKICAgICAgICAgICAgX2Z1bGxGTSA9IG5ldyBEZXRhY2hGaWVs\nZE1hbmFnZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfZGV0\nYWNoZWQgPSBuZXcgSWRlbnRpdHlNYXAoKTsKICAgICAgICAgICAgX2Z1bGxG\nTSA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgZGV0YWNoZWQgdmVyc2lvbiBvZiB0aGUgZ2l2ZW4gaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZGV0YWNoKE9iamVjdCB0b0Rl\ndGFjaCkgewogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gZGV0YWNoSW50ZXJuYWwodG9EZXRh\nY2gpOwogICAgICAgIH0gY2F0Y2ggKENhbGxiYWNrRXhjZXB0aW9uIGNlKSB7\nCiAgICAgICAgICAgIGV4Y2VwcyA9IG5ldyBBcnJheUxpc3QoMSk7CiAgICAg\nICAgICAgIGV4Y2Vwcy5hZGQoY2UpOwogICAgICAgICAgICByZXR1cm4gbnVs\nbDsgLy8gd29uJ3QgYmUgcmVhY2hlZCBhcyBleGNlcHRpb24gd2lsbCBiZSBy\nZXRocm93bgogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChl\neGNlcHMgPT0gbnVsbCB8fCAhX2ZhaWxGYXN0KQogICAgICAgICAgICAgICAg\nZXhjZXBzID0gaW52b2tlQWZ0ZXJEZXRhY2goQ29sbGVjdGlvbnMuc2luZ2xl\ndG9uKHRvRGV0YWNoKSwKICAgICAgICAgICAgICAgICAgICBleGNlcHMpOwog\nICAgICAgICAgICBpZiAoX2RldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZGV0YWNoZWQuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3dFeGNl\ncHRpb25zKGV4Y2Vwcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGRldGFjaGVkIHZlcnNpb25zIG9mIGFsbCB0aGUgZ2l2ZW4g\naW5zdGFuY2VzLiBJZiBub3QgY29weWluZywKICAgICAqIG51bGwgd2lsbCBi\nZSByZXR1cm5lZC4KICAgICAqLwogICAgcHVibGljIE9iamVjdFtdIGRldGFj\naEFsbChDb2xsZWN0aW9uIGluc3RhbmNlcykgewogICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsKICAgICAgICBMaXN0IGRldGFjaGVkID0gbnVsbDsKICAg\nICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgIGRldGFjaGVkID0gbmV3IEFy\ncmF5TGlzdChpbnN0YW5jZXMuc2l6ZSgpKTsKCiAgICAgICAgYm9vbGVhbiBm\nYWlsRmFzdCA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE9i\namVjdCBkZXRhY2g7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\naW5zdGFuY2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBkZXRhY2ggPSBkZXRhY2hJbnRlcm5hbChpdHIubmV4dCgp\nKTsKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAg\nICAgICBkZXRhY2hlZC5hZGQoZGV0YWNoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICBpZiAocmUgaW5zdGFuY2VvZiBDYWxsYmFja0V4Y2VwdGlv\nbiAmJiBfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICBmYWlsRmFzdCA9IHRy\ndWU7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoIWZhaWxGYXN0KQog\nICAgICAgICAgICAgICAgZXhjZXBzID0gaW52b2tlQWZ0ZXJEZXRhY2goaW5z\ndGFuY2VzLCBleGNlcHMpOwogICAgICAgICAgICBpZiAoX2RldGFjaGVkICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZGV0YWNoZWQuY2xlYXIoKTsKICAg\nICAgICB9CiAgICAgICAgdGhyb3dFeGNlcHRpb25zKGV4Y2Vwcyk7CgogICAg\nICAgIGlmIChfY29weSkKICAgICAgICAgICAgcmV0dXJuIGRldGFjaGVkLnRv\nQXJyYXkoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSBwb3N0RGV0YWNoKCkgb24gYW55IGRldGFjaGVkIGlu\nc3RhbmNlcyB0aGF0IGltcGxlbWVudAogICAgICogUG9zdERldGFjaENhbGxi\nYWNrLiBUaGlzIHdpbGwgYmUgZG9uZSBhZnRlciB0aGUgZW50aXJlIGdyYXBo\nIGhhcwogICAgICogYmVlbiBkZXRhY2hlZC4gVGhpcyBtZXRob2QgaGFzIHRo\nZSBzaWRlLWVmZmVjdCBvZiBhbHNvIGNsZWFyaW5nCiAgICAgKiBvdXQgdGhl\nIG1hcCBvZiBhbGwgZGV0YWNoZWQgaW5zdGFuY2VzLgogICAgICovCiAgICBw\ncml2YXRlIExpc3QgaW52b2tlQWZ0ZXJEZXRhY2goQ29sbGVjdGlvbiBvYmpz\nLCBMaXN0IGV4Y2VwcykgewogICAgICAgIEl0ZXJhdG9yIGl0ciA9IChfZnVs\nbCkgPyBvYmpzLml0ZXJhdG9yKCkKICAgICAgICAgICAgOiBfZGV0YWNoZWQu\nZW50cnlTZXQoKS5pdGVyYXRvcigpOwoKICAgICAgICBPYmplY3Qgb3JpZywg\nZGV0YWNoZWQ7CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIHdo\naWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIGlmIChfZnVsbCkg\newogICAgICAgICAgICAgICAgb3JpZyA9IGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBkZXRhY2hlZCA9IG9yaWc7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBvcmlnID0gZW50cnkuZ2V0S2V5KCk7CiAg\nICAgICAgICAgICAgICBkZXRhY2hlZCA9IGVudHJ5LmdldFZhbHVlKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBfYnJva2VyLmdldFN0YXRlTWFuYWdlckltcGwob3JpZywgdHJ1ZSk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVF\ndmVudChkZXRhY2hlZCwgb3JpZywKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVUQUNI\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2Up\nIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGNlKTsK\nICAgICAgICAgICAgICAgIGlmIChfZmFpbEZhc3QpCiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7IC8vIGRvbid0IGNvbnRpbnVlIHByb2Nlc3NpbmcKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhjZXBzOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGV4Y2VwdGlvbiB0byB0aGUg\nbGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0IGFkZChMaXN0IGV4Y2Vw\ncywgUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIGlmIChleGNlcHMg\nPT0gbnVsbCkKICAgICAgICAgICAgZXhjZXBzID0gbmV3IExpbmtlZExpc3Qo\nKTsKICAgICAgICBleGNlcHMuYWRkKHJlKTsKICAgICAgICByZXR1cm4gZXhj\nZXBzOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYWxsIGdhdGhlcmVk\nIGV4Y2VwdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0aHJvd0V4\nY2VwdGlvbnMoTGlzdCBleGNlcHMpIHsKICAgICAgICBpZiAoZXhjZXBzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGV4Y2Vw\ncy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgdGhyb3cgKFJ1bnRpbWVFeGNl\ncHRpb24pIGV4Y2Vwcy5nZXQoMCk7CiAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSkuCiAgICAgICAg\nICAgIHNldE5lc3RlZFRocm93YWJsZXMoKFRocm93YWJsZVtdKSBleGNlcHMu\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBUaHJvd2FibGVbZXhjZXBz\nLnNpemUoKV0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGFjaC4KICAg\nICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZGV0YWNoSW50ZXJuYWwoT2JqZWN0\nIHRvRGV0YWNoKSB7CiAgICAgICAgaWYgKHRvRGV0YWNoID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBhbHJlYWR5IGRl\ndGFjaGVkPwogICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkgewogICAg\nICAgICAgICBPYmplY3QgZGV0YWNoZWQgPSBfZGV0YWNoZWQuZ2V0KHRvRGV0\nYWNoKTsKICAgICAgICAgICAgaWYgKGRldGFjaGVkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQ7CiAgICAgICAgfQoKICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gX2Jyb2tlci5nZXRTdGF0ZU1hbmFn\nZXJJbXBsKHRvRGV0YWNoLCB0cnVlKTsKICAgICAgICBpZiAoX2NhbGwgIT0g\nbnVsbCAmJiAoX2NhbGwucHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX0RFVEFDSCwKICAgICAgICAgICAgdG9EZXRhY2gsIHNtKSAmIE9wQ2FsbGJh\nY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgIHJldHVybiB0b0RldGFj\naDsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHRvRGV0YWNoOwoKICAgICAgICAvLyBDYWxsIFByZURldGFjaCBmaXJzdCBh\ncyB3ZSBjYW4ndCB0ZWxsIGlmIHRoZSBuZXcgc3lzdGVtCiAgICAgICAgLy8g\nZmlyZWQgYW4gZXZlbnQgb3IganVzdCBkaWQgbm90IGZhaWwuCiAgICAgICAg\nX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQodG9EZXRhY2gsIG51bGwsIHNt\nLmdldE1ldGFEYXRhKCksCiAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9ERVRBQ0gpOwoKICAgICAgICAvLyBhbnkgZGlydHkgaW5zdGFuY2Vz\nIGNhdXNlIGEgZmx1c2ggdG8gb2NjdXIKICAgICAgICBfZmx1c2hlZCA9IF9m\nbHVzaGVkIHx8IGZsdXNoRGlydHkoc20pOwogICAgICAgIEJpdFNldCBmaWVs\nZHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgcHJlRGV0YWNoKF9icm9rZXIs\nIHNtLCBmaWVsZHMpOwoKICAgICAgICAvLyBjcmVhdGUgYW5kIHN0b3JlIG5l\ndyBvYmplY3QgYmVmb3JlIGNvcHkgdG8gYXZvaWQgZW5kbGVzcyByZWN1cnNp\nb24KICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBzbS5nZXRQZXJz\naXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\nZGV0YWNoZWRQQzsKICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgIGRl\ndGFjaGVkUEMgPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIHRydWUpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgZGV0YWNoZWRQQyA9IHBjOwogICAgICAg\nIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgX2RldGFjaGVk\nLnB1dCh0b0RldGFjaCwgZGV0YWNoZWRQQyk7CgogICAgICAgIC8vIGRldGFj\naCBmaWVsZHMgYW5kIHNldCBkZXRhY2hlZCB2YXJpYWJsZXMKICAgICAgICBE\nZXRhY2hlZFN0YXRlTWFuYWdlciBkZXRTTSA9IG51bGw7CiAgICAgICAgaWYg\nKF9vcHRzLmdldERldGFjaGVkU3RhdGVNYW5hZ2VyKCkKICAgICAgICAgICAg\nJiYgdXNlRGV0YWNoZWRTdGF0ZU1hbmFnZXIoc20sIF9vcHRzKSkKICAgICAg\nICAgICAgZGV0U00gPSBuZXcgRGV0YWNoZWRTdGF0ZU1hbmFnZXIoZGV0YWNo\nZWRQQywgc20sIGZpZWxkcywKICAgICAgICAgICAgICAgIF9vcHRzLmdldEFj\nY2Vzc1VubG9hZGVkKCksIF9icm9rZXIuZ2V0TXVsdGl0aHJlYWRlZCgpKTsK\nICAgICAgICBpZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2Z1bGxGTS5zZXRT\ndGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICBfZnVsbEZNLmRldGFjaFZl\ncnNpb24oKTsKICAgICAgICAgICAgX2Z1bGxGTS5yZXByb3h5KGRldFNNKTsK\nICAgICAgICAgICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFnZXIobnVsbCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSW5zdGFuY2VEZXRhY2hGaWVs\nZE1hbmFnZXIgZm0gPSBuZXcgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIK\nICAgICAgICAgICAgICAgIChkZXRhY2hlZFBDLCBkZXRTTSk7CiAgICAgICAg\nICAgIGZtLnNldFN0YXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAgIGZtLmRl\ndGFjaEZpZWxkcyhmaWVsZHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFC\nb29sZWFuLkZBTFNFLmVxdWFscyhzbS5nZXRNZXRhRGF0YSgpLnVzZXNEZXRh\nY2hlZFN0YXRlKCkpKQogICAgICAgICAgICBkZXRhY2hlZFBDLnBjU2V0RGV0\nYWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0YXRlKHNtLCBmaWVsZHMpKTsKICAg\nICAgICBpZiAoIV9jb3B5KQogICAgICAgICAgICBzbS5yZWxlYXNlKGZhbHNl\nLCAhX2NvcHkpOwogICAgICAgIGlmIChkZXRTTSAhPSBudWxsKQogICAgICAg\nICAgICBkZXRhY2hlZFBDLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihkZXRTTSk7\nCiAgICAgICAgcmV0dXJuIGRldGFjaGVkUEM7CiAgICB9CgogICAgcHJpdmF0\nZSBzdGF0aWMgYm9vbGVhbiB1c2VEZXRhY2hlZFN0YXRlTWFuYWdlcihTdGF0\nZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cykg\newogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRh\nKCk7CiAgICAgICAgcmV0dXJuICFCb29sZWFuLkZBTFNFLmVxdWFscyhtZXRh\nLnVzZXNEZXRhY2hlZFN0YXRlKCkpICYmCiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEuU1lOVEhFVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUo\nKSkgJiYKICAgICAgICAgICAgb3B0cy5nZXREZXRhY2hlZFN0YXRlTWFuYWdl\ncigpOwogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBkZXRhY2ggZmllbGQg\nbWFuYWdlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRGV0\nYWNoRmllbGRNYW5hZ2VyCiAgICAgICAgZXh0ZW5kcyBUcmFuc2ZlckZpZWxk\nTWFuYWdlciB7CgogICAgICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOwoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIHNvdXJjZSBz\ndGF0ZSBtYW5hZ2VyLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIHNldFN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgICAgIHRoaXMuc20gPSBzbTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIFRyYW5zZmVyIHRoZSBjdXJyZW50IHZlcnNpb24gb2JqZWN0\nIGZyb20gdGhlIHN0YXRlIG1hbmFnZXIgdG8gdGhlCiAgICAgICAgICogZGV0\nYWNoZWQgaW5zdGFuY2UuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZv\naWQgZGV0YWNoVmVyc2lvbigpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBzbS5nZXRNZXRhRGF0YSgpLmdldFZlcnNpb25GaWVsZCgpOwog\nICAgICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICBPYmplY3QgdmFsID0gSmF2YVR5cGVzLmNv\nbnZlcnQoc20uZ2V0VmVyc2lvbigpLAogICAgICAgICAgICAgICAgZm1kLmdl\ndFR5cGVDb2RlKCkpOwogICAgICAgICAgICB2YWwgPSBmbWQuZ2V0RmllbGRW\nYWx1ZSh2YWwsIHNtLmdldEJyb2tlcigpKTsKICAgICAgICAgICAgc3dpdGNo\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBs\nb25ndmFsID0gKHZhbCA9PSBudWxsKSA/IDBMIDogKChOdW1iZXIpIHZhbCku\nbG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGRibHZhbCA9ICh2YWwg\nPT0gbnVsbCkgPyAwRCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIG9ianZhbCA9IHZhbDsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0\nZW5jZUNhcGFibGUoKSwgdGhpcywKICAgICAgICAgICAgICAgIGZtZC5nZXRJ\nbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFVu\ncHJveGllcyBzZWNvbmQgY2xhc3Mgb2JqZWN0IGZpZWxkcy4KICAgICAgICAg\nKi8KICAgICAgICBwdWJsaWMgdm9pZCByZXByb3h5KERldGFjaGVkU3RhdGVN\nYW5hZ2VyIGRzbSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgICAgICAvLyBscnMgcHJveGllcyBub3QgZGV0YWNoZWQK\nICAgICAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIG9ianZhbCA9IG51bGw7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpLCAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRoaXMsIGkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAg\nICAgICAgICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGdldERldGFjaGVkUGVy\nc2lzdGVuY2VDYXBhYmxlKCksIHRoaXMsIGkpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChvYmp2YWwgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBQcm94eSBwcm94eSA9IChQcm94eSkgb2JqdmFsOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJveHkuZ2V0Q2hhbmdlVHJh\nY2tlcigpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBw\ncm94eS5nZXRDaGFuZ2VUcmFja2VyKCkuc3RvcFRyYWNraW5nKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHByb3h5LnNldE93bmVyKGRzbSwgKGRzbSA9\nPSBudWxsKSA/IC0xIDogaSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNsZWFy\nKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4g\ndGhlIGluc3RhbmNlIGJlaW5nIGRldGFjaGVkLgogICAgICAgICAqLwogICAg\nICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgZ2V0RGV0YWNoZWRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBzbS5n\nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGaWVsZE1hbmFnZXIgdGhhdCBjYW4gY29weSBhbGwgdGhl\nIGZpZWxkcyBmcm9tIG9uZQogICAgICogUGVyc2lzdGVuY2VDYXBhYmxlIGlu\nc3RhbmNlIHRvIGFub3RoZXIuIE9uZSBvZiB0aGUKICAgICAqIGluc3RhbmNl\ncyBtdXN0IGJlIG1hbmFnZWQgYnkgYSBTdGF0ZU1hbmFnZXIsIGFuZCB0aGUK\nICAgICAqIG90aGVyIG11c3QgYmUgdW5tYW5hZ2VkLgogICAgICoKICAgICAq\nIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAgIHByaXZh\ndGUgY2xhc3MgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIKICAgICAgICBl\neHRlbmRzIERldGFjaEZpZWxkTWFuYWdlciB7CgogICAgICAgIHByaXZhdGUg\nZmluYWwgUGVyc2lzdGVuY2VDYXBhYmxlIF90bzsKICAgICAgICBwcml2YXRl\nIGZpbmFsIERldGFjaGVkU3RhdGVNYW5hZ2VyIF9kZXRTTTsKCiAgICAgICAg\nLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBpbnN0YW5jZSB0\nbyB0byBjb3B5IHRvLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBJbnN0\nYW5jZURldGFjaEZpZWxkTWFuYWdlcihQZXJzaXN0ZW5jZUNhcGFibGUgdG8s\nCiAgICAgICAgICAgIERldGFjaGVkU3RhdGVNYW5hZ2VyIGRldFNNKSB7CiAg\nICAgICAgICAgIF90byA9IHRvOwogICAgICAgICAgICBfZGV0U00gPSBkZXRT\nTTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNh\ncGFibGUgZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfdG87CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBEZXRhY2ggdGhlIGZpZWxkcyBvZiB0aGUgc3RhdGUgbWFuYWdl\nciBnaXZlbiBvbiBjb25zdHJ1Y3Rpb24gdG8KICAgICAgICAgKiB0aGUgcGVy\nc2lzdGVuY2UgY2FwYWJsZSBnaXZlbiBvbiBjb25zdHJ1Y3Rpb24uCiAgICAg\nICAgICogT25seSB0aGUgZmllbGRzIGluIHRoZSBnaXZlbiBiaXQgc2V0IHdp\nbGwgYmUgY29waWVkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIGRldGFjaEZpZWxkcyhCaXRTZXQgZmdmaWVsZHMpIHsKICAgICAgICAgICAg\nUGVyc2lzdGVuY2VDYXBhYmxlIGZyb20gPSBzbS5nZXRQZXJzaXN0ZW5jZUNh\ncGFibGUoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IHNt\nLmdldE1ldGFEYXRhKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1ldGFEYXRhKCku\nZ2V0RmllbGRzKCk7CgogICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAg\nICAgICAgICBfdG8ucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIHdlIHN0YXJ0IHdpdGgg\ncGsgZmllbGRzOiBvYmplY3RzIG1pZ2h0IHJlbHkgb24gcGsgZmllbGRzIGZv\ncgogICAgICAgICAgICAgICAgLy8gZXF1YWxzIGFuZCBoYXNoQ29kZSBtZXRo\nb2RzLCBhbmQgdGhpcyBlbnN1cmVzIHRoYXQgcGsgZmllbGRzCiAgICAgICAg\nICAgICAgICAvLyBhcmUgc2V0IHByb3Blcmx5IGlmIHdlIHJldHVybiBhbnkg\ncGFydGlhbGx5LWRldGFjaGVkIG9iamVjdHMKICAgICAgICAgICAgICAgIC8v\nIGR1ZSB0byByZWVudHJhbnQgY2FsbHMgd2hlbiB0cmF2ZXJzaW5nIHJlbGF0\naW9ucwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3Mu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZGV0YWNoRmllbGQo\nZnJvbSwgcGtzW2ldLmdldEluZGV4KCksIHRydWUpOwogICAgICAgICAgICAg\nICAgZGV0YWNoVmVyc2lvbigpOwogICAgICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\nICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiAhZm1kc1tpXS5p\nc1ZlcnNpb24oKSkgCiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaEZp\nZWxkKGZyb20sIGksIGZnZmllbGRzLmdldChpKSk7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAvLyBjbGVhciB0aGUgU3RhdGVN\nYW5hZ2VyIGZyb20gdGhlIHRhcmdldCBvYmplY3QKICAgICAgICAgICAgICAg\nIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICBfdG8ucGNSZXBsYWNl\nU3RhdGVNYW5hZ2VyKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBEZXRhY2ggKG9yIGNsZWFyKSB0aGUg\nZ2l2ZW4gZmllbGQgaW5kZXguCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSB2b2lkIGRldGFjaEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBmcm9tLCBp\nbnQgaSwgYm9vbGVhbiBmZykgewogICAgICAgICAgICAvLyB0ZWxsIHRoZSBz\ndGF0ZSBtYW5hZ2VyIHRvIHByb3ZpZGUgdGhlIGZpZWxkcyBmcm9tIHRoZSBz\nb3VyY2UgdG8KICAgICAgICAgICAgLy8gdGhpcyBmaWVsZCBtYW5hZ2VyLCB3\naGljaCB3aWxsIHRoZW4gcmVwbGFjZSB0aGUgZmllbGQgd2l0aCBhCiAgICAg\nICAgICAgIC8vIGRldGFjaGVkIHZlcnNpb24KICAgICAgICAgICAgaWYgKGZn\nKQogICAgICAgICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGZyb20sIHRoaXMs\nIGkpOwogICAgICAgICAgICBlbHNlIGlmICghX2NvcHkpIHsKICAgICAgICAg\nICAgICAgIC8vIGlmIG5vdCBjb3B5aW5nIGFuZCBmaWVsZCBzaG91bGQgbm90\nIGJlIGRldGFjaGVkLCBjbGVhciBpdAogICAgICAgICAgICAgICAgY2xlYXIo\nKTsKICAgICAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMs\nIGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBzdG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3Vy\nVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlQm9vbGVhbkZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3Rv\nLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFsKSB7CiAg\nICAgICAgICAgIHN1cGVyLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVs\nZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUNoYXJG\naWVsZChpbnQgZmllbGQsIGNoYXIgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1\ncGVyLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAg\nICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxkKGludCBm\naWVsZCwgZG91YmxlIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9y\nZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5y\nZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzdG9yZUZsb2F0RmllbGQoaW50IGZpZWxkLCBm\nbG9hdCBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVGbG9hdEZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmll\nbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1clZhbCkg\newogICAgICAgICAgICBzdXBlci5zdG9yZUludEZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBm\naWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUxv\nbmdGaWVsZChpbnQgZmllbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgICAg\nIHN1cGVyLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAg\nICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0RmllbGQoaW50\nIGZpZWxkLCBzaG9ydCBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3Rv\ncmVTaG9ydEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5y\nZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwg\nU3RyaW5nIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVN0cmlu\nZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNl\nRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzdG9yZU9iamVjdEZpZWxkKGludCBmaWVsZCwgT2JqZWN0\nIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZU9iamVjdEZpZWxk\nKGZpZWxkLCBkZXRhY2hGaWVsZChjdXJWYWwsIGZpZWxkKSk7CiAgICAgICAg\nICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgb3duZXIgb2Yg\ndGhlIGZpZWxkJ3MgcHJveHkgdG8gdGhlIGRldGFjaGVkIHN0YXRlIG1hbmFn\nZXIuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgcmVwcm94\neShPYmplY3Qgb2JqLCBpbnQgZmllbGQpIHsKICAgICAgICAgICAgaWYgKG9i\naiAhPSBudWxsICYmIF9kZXRTTSAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9m\nIFByb3h5KQogICAgICAgICAgICAgICAgKChQcm94eSkgb2JqKS5zZXRPd25l\ncihfZGV0U00sIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERldGFjaCB0aGUgZ2l2\nZW4gdmFsdWUgaWYgbmVlZGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZh\ndGUgT2JqZWN0IGRldGFjaEZpZWxkKE9iamVjdCBjdXJWYWwsIGludCBmaWVs\nZCkgewogICAgICAgICAgICBpZiAoY3VyVmFsID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgIE9iamVjdCBuZXdWYWwgPSBudWxsOwogICAgICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpZiAo\nX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNv\ncHlBcnJheShjdXJWYWwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAgICAgICAg\nIGRldGFjaEFycmF5KG5ld1ZhbCwgZm1kKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXdWYWw7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoX2RldFNNICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5Lm5ld0NvbGxlY3Rpb25Qcm94\neShmbWQuZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEluaXRpYWxpemVyKCkg\naW5zdGFuY2VvZiBDb21wYXJhdG9yID8KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIChDb21wYXJhdG9yKSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSA6IG51\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIG5l\nd1ZhbCkuYWRkQWxsKChDb2xsZWN0aW9uKSBjdXJWYWwpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBuZXdW\nYWwgPSBfcHJveHkuY29weUNvbGxlY3Rpb24oKENvbGxlY3Rpb24pIGN1clZh\nbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAg\nICBuZXdWYWwgPSBjdXJWYWw7CiAgICAgICAgICAgICAgICBkZXRhY2hDb2xs\nZWN0aW9uKChDb2xsZWN0aW9uKSBuZXdWYWwsIChDb2xsZWN0aW9uKSBjdXJW\nYWwsIGZtZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcm94eShuZXdW\nYWwsIGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgog\nICAgICAgICAgICAgICAgaWYgKF9jb3B5KSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9kZXRTTSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIG5ld1ZhbCA9IF9wcm94eS5uZXdNYXBQcm94eShmbWQuZ2V0UHJveHlU\neXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5\nKCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEluaXRpYWxpemVyKCkg\naW5zdGFuY2VvZiBDb21wYXJhdG9yID8KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAoQ29tcGFyYXRvcikgZm1kLmdldEluaXRpYWxpemVyKCkg\nOiBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgKChNYXApIG5ld1Zh\nbCkucHV0QWxsKChNYXApIGN1clZhbCk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IF9wcm94\neS5jb3B5TWFwKChNYXApIGN1clZhbCk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBjdXJWYWw7CiAgICAg\nICAgICAgICAgICBkZXRhY2hNYXAoKE1hcCkgbmV3VmFsLCAoTWFwKSBjdXJW\nYWwsIGZtZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcm94eShuZXdW\nYWwsIGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5E\nQVI6CiAgICAgICAgICAgICAgICBuZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5\nLmNvcHlDYWxlbmRhcigoQ2FsZW5kYXIpIGN1clZhbCkgOgogICAgICAgICAg\nICAgICAgICAgIGN1clZhbDsKICAgICAgICAgICAgICAgIHJldHVybiByZXBy\nb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICAgICAgbmV3VmFsID0gKF9jb3B5KSA/IF9w\ncm94eS5jb3B5RGF0ZSgoRGF0ZSkgY3VyVmFsKSA6IGN1clZhbDsKICAgICAg\nICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAg\nICBpZiAoX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3By\nb3h5LmNvcHlDdXN0b20oY3VyVmFsKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiByZXByb3h5KChuZXdWYWwgPT0gbnVsbCkgPyBjdXJWYWwgOiBuZXdWYWws\nIGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZGV0YWNoSW50ZXJuYWwoY3VyVmFsKTsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBjdXJWYWw7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIE1ha2Ugc3VyZSBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gYXJyYXkg\nYXJlIGRldGFjaGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9p\nZCBkZXRhY2hBcnJheShPYmplY3QgYXJyYXksIEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgICAgIGlmICghZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xh\ncmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAg\nICAgICBpbnQgbGVuID0gQXJyYXkuZ2V0TGVuZ3RoKGFycmF5KTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykKICAgICAgICAg\nICAgICAgIEFycmF5LnNldChhcnJheSwgaSwgZGV0YWNoSW50ZXJuYWwoQXJy\nYXkuZ2V0KGFycmF5LCBpKSkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogTWFrZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZl\nbiBjb2xsZWN0aW9uIGFyZSBkZXRhY2hlZC4KICAgICAgICAgKi8KICAgICAg\nICBwcml2YXRlIHZvaWQgZGV0YWNoQ29sbGVjdGlvbihDb2xsZWN0aW9uIGNv\nbGwsIENvbGxlY3Rpb24gb3JpZywKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICAgICAgLy8gY29sbCBjYW4gYmUgbnVsbCBpZiBu\nb3QgY29weWFibGUKICAgICAgICAgICAgaWYgKF9jb3B5ICYmIGNvbGwgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICAgICAg\naWYgKCFmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIHVuZm9ydHVu\nYXRlbHkgd2UgaGF2ZSB0byBjbGVhciB0aGUgb3JpZ2luYWwgYW5kIHJlLWFk\nZCB0byBjb3B5CiAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAg\nICAgIGNvbGwuY2xlYXIoKTsKICAgICAgICAgICAgT2JqZWN0IGRldGFjaGVk\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9yaWcuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGRldGFj\naGVkID0gZGV0YWNoSW50ZXJuYWwoaXRyLm5leHQoKSk7CiAgICAgICAgICAg\nICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgY29sbC5hZGQo\nZGV0YWNoZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhl\nIGdpdmVuIG1hcCBhcmUgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAg\ncHJpdmF0ZSB2b2lkIGRldGFjaE1hcChNYXAgbWFwLCBNYXAgb3JpZywgRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAgICAgLy8gbWFwIGNhbiBiZSBu\ndWxsIGlmIG5vdCBjb3B5YWJsZQogICAgICAgICAgICBpZiAoX2NvcHkgJiYg\nbWFwID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibm90LWNvcHlhYmxlIiwgZm1kKSk7CiAgICAg\nICAgICAgIGJvb2xlYW4ga2V5UEMgPSBmbWQuZ2V0S2V5KCkuaXNEZWNsYXJl\nZFR5cGVQQygpOwogICAgICAgICAgICBib29sZWFuIHZhbFBDID0gZm1kLmdl\ndEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgICAgIGlm\nICgha2V5UEMgJiYgIXZhbFBDKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSB0byBjb3B5IGtleXMsIGp1c3Qg\nY2xlYXIgYW5kIHJlLWFkZDsgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHdl\nIGNhbiB1c2UgdGhlIGVudHJ5IHNldCB0byByZXNldCB0aGUgdmFsdWVzIG9u\nbHkKICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgICAgICBp\nZiAoIV9jb3B5IHx8IGtleVBDKSB7CiAgICAgICAgICAgICAgICBpZiAoX2Nv\ncHkpCiAgICAgICAgICAgICAgICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAg\nICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAgICAgICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IG9yaWcuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOyl7CiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSAo\nTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGtl\neSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChr\nZXlQQykKICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gZGV0YWNoSW50\nZXJuYWwoa2V5KTsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBlbnRyeS5n\nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWxQQykKICAg\nICAgICAgICAgICAgICAgICAgICAgdmFsID0gZGV0YWNoSW50ZXJuYWwodmFs\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIG1hcC5wdXQoa2V5LCB2YWwpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIGVudHJ5ID0g\nKE1hcC5FbnRyeSkgaXRyLm5leHQgKCk7CgkJCQkJZW50cnkuc2V0VmFsdWUg\nKGRldGFjaEludGVybmFsIChlbnRyeS5nZXRWYWx1ZSAoKSkpOwoJCQkJfQoJ\nCQl9CgkJfQoJfQp9Cg==\n","encoding":"base64"}

