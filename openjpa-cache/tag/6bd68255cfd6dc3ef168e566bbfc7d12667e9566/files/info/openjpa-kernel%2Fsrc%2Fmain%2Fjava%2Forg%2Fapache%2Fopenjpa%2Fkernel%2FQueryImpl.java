{"sha":"2b38f661cf4b1a1352d78064dd076f9305691244","node_id":"MDQ6QmxvYjIwNjM2NDoyYjM4ZjY2MWNmNGIxYTEzNTJkNzgwNjRkZDA3NmY5MzA1NjkxMjQ0","size":69818,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2b38f661cf4b1a1352d78064dd076f9305691244","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdEl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNl\nQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlZhbDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLkVhZ2VyUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVjdFByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmFuZ2VS\nZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIucm9wLlJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5SZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNl\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5jb25jdXJy\nZW50LlJlZW50cmFudExvY2s7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob25VbmlxdWVSZXN1bHRFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob1Jlc3VsdEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5K\nUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7\nCmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBJbXBsZW1lbnRh\ndGlvbiBvZiB0aGUge0BsaW5rIFF1ZXJ5fSBpbnRlcmZhY2UuCiAqCiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFz\ncyBRdWVyeUltcGwKICAgIGltcGxlbWVudHMgUXVlcnkgewoKICAgIHByaXZh\ndGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UoUXVlcnlJbXBsLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIFN0cmlu\nZyBfbGFuZ3VhZ2U7CiAgICBwcml2YXRlIGZpbmFsIFN0b3JlUXVlcnkgX3N0\nb3JlUXVlcnk7CiAgICBwcml2YXRlIHRyYW5zaWVudCBmaW5hbCBCcm9rZXJJ\nbXBsIF9icm9rZXI7CiAgICBwcml2YXRlIHRyYW5zaWVudCBmaW5hbCBMb2cg\nX2xvZzsKICAgIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTG9hZGVyIF9sb2Fk\nZXIgPSBudWxsOwoKICAgIC8vIHF1ZXJ5IGhhcyBpdHMgb3duIGludGVybmFs\nIGxvY2sKICAgIHByaXZhdGUgZmluYWwgUmVlbnRyYW50TG9jayBfbG9jayA9\nIG5ldyBSZWVudHJhbnRMb2NrKCk7CgogICAgLy8gdW5wYXJzZWQgc3RhdGUK\nICAgIHByaXZhdGUgQ2xhc3MgX2NsYXNzID0gbnVsbDsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfc3ViY2xhc3NlcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX3JlYWRPbmx5ID0gZmFsc2U7CiAgICBwcml2YXRlIFN0cmluZyBfcXVl\ncnkgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3BhcmFtcyA9IG51bGw7\nCgogICAgLy8gcGFyc2VkIHN0YXRlCiAgICBwcml2YXRlIHRyYW5zaWVudCBD\nb21waWxhdGlvbiBfY29tcGlsZWQgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgYm9vbGVhbiBfY29tcGlsaW5nID0gZmFsc2U7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBSZXN1bHRQYWNrZXIgX3BhY2tlciA9IG51bGw7CgogICAg\nLy8gY2FuZGlkYXRlcwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29sbGVjdGlv\nbiBfY29sbGVjdGlvbiA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBF\neHRlbnQgX2V4dGVudCA9IG51bGw7CgogICAgLy8gbGlzdGVuZXJzCiAgICBw\ncml2YXRlIE1hcCBfZmlsdExpc3RlbmVycyA9IG51bGw7CiAgICBwcml2YXRl\nIE1hcCBfYWdnTGlzdGVuZXJzID0gbnVsbDsKCiAgICAvLyBjb25maWd1cmF0\naW9uIGZvciBsb2FkaW5nIG9iamVjdHMKICAgIHByaXZhdGUgRmV0Y2hDb25m\naWd1cmF0aW9uIF9mYyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ln\nbm9yZUNoYW5nZXMgPSBmYWxzZTsKICAgIHByaXZhdGUgQ2xhc3MgX3Jlc3Vs\ndE1hcHBpbmdTY29wZSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcmVz\ndWx0TWFwcGluZ05hbWUgPSBudWxsOwoKICAgIC8vIHRoZXNlIGZpZWxkcyBz\naG91bGQgb25seSBiZSB1c2VkIGRpcmVjdGx5IGFmdGVyIHdlIGhhdmUgYSBj\nb21waWxhdGlvbiwKICAgIC8vIGJlY2F1c2UgdGhlaXIgdmFsdWVzIG1heSBi\nZSBlbmNvZGVkIGluIHRoZSBxdWVyeSBzdHJpbmcKICAgIHByaXZhdGUgQm9v\nbGVhbiBfdW5pcXVlID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3MgX3Jlc3Vs\ndENsYXNzID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgdHJhbnNpZW50IGxvbmcgX2VuZElk\neCA9IExvbmcuTUFYX1ZBTFVFOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9v\nbGVhbiBfcmFuZ2VTZXQgPSBmYWxzZTsKCiAgICAvLyByZW1lbWJlciB0aGUg\nbGlzdCBvZiBhbGwgdGhlIHJlc3VsdHMgd2UgaGF2ZSByZXR1cm5lZCBzbyB3\nZQogICAgLy8gY2FuIGZyZWUgdGhlaXIgcmVzb3VyY2VzIHdoZW4gY2xvc2Ug\nb3IgY2xvc2VBbGwgaXMgY2FsbGVkCiAgICBwcml2YXRlIHRyYW5zaWVudCBm\naW5hbCBDb2xsZWN0aW9uIF9yZXN1bHRMaXN0cyA9IG5ldyBSZWZlcmVuY2VI\nYXNoU2V0CiAgICAgICAgKFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSBxdWVyeSBtYW5hZ2VkIGJ5IHRoZSBn\naXZlbiBicm9rZXIuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeUltcGwoQnJv\na2VyIGJyb2tlciwgU3RyaW5nIGxhbmd1YWdlLCBTdG9yZVF1ZXJ5IHN0b3Jl\nUXVlcnkpIHsKICAgICAgICBfYnJva2VyID0gKEJyb2tlckltcGwpIGJyb2tl\ncjsKICAgICAgICBfbGFuZ3VhZ2UgPSBsYW5ndWFnZTsKICAgICAgICBfc3Rv\ncmVRdWVyeSA9IHN0b3JlUXVlcnk7CiAgICAgICAgX2ZjID0gKEZldGNoQ29u\nZmlndXJhdGlvbikgYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpLmNs\nb25lKCk7CiAgICAgICAgX2xvZyA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9u\nKCkuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19RVUVSWSk7CiAg\nICAgICAgX3N0b3JlUXVlcnkuc2V0Q29udGV4dCh0aGlzKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEludGVybmFsIHN0b3JlIHF1ZXJ5LgogICAgICovCiAg\nICBwdWJsaWMgU3RvcmVRdWVyeSBnZXRTdG9yZVF1ZXJ5KCkgewogICAgICAg\nIHJldHVybiBfc3RvcmVRdWVyeTsKICAgIH0KCiAgICBwdWJsaWMgQnJva2Vy\nIGdldEJyb2tlcigpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsKICAgIH0K\nCiAgICBwdWJsaWMgUXVlcnkgZ2V0UXVlcnkoKSB7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIFN0b3JlQ29udGV4dCBnZXRTdG9y\nZUNvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXI7CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZyBnZXRMYW5ndWFnZSgpIHsKICAgICAgICByZXR1\ncm4gX2xhbmd1YWdlOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVy\nbiBfZmM7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRRdWVyeVN0cmlu\nZygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5OwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGdldElnbm9yZUNoYW5nZXMoKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIHJldHVybiBfaWdub3JlQ2hhbmdlczsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25vcmVDaGFuZ2VzKGJvb2xlYW4gZmxh\nZykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIC8vIGFsbG93ZWQgbW9kaWZp\nY2F0aW9uOiBubyByZWFkLW9ubHkgY2hlY2sKICAgICAgICAgICAgX2lnbm9y\nZUNoYW5nZXMgPSBmbGFnOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1JlYWRPbmx5KCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICByZXR1cm4gX3JlYWRPbmx5OwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFJlYWRPbmx5KGJvb2xlYW4gZmxhZykgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgICAgIF9yZWFkT25seSA9IGZsYWc7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGFkZEZpbHRlckxpc3RlbmVyKEZpbHRlckxpc3RlbmVyIGxp\nc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVh\nZE9ubHkoKTsKICAgICAgICAgICAgaWYgKF9maWx0TGlzdGVuZXJzID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfZmlsdExpc3RlbmVycyA9IG5ldyBIYXNo\nTWFwKDUpOwogICAgICAgICAgICBfZmlsdExpc3RlbmVycy5wdXQobGlzdGVu\nZXIuZ2V0VGFnKCksIGxpc3RlbmVyKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcmVtb3ZlRmlsdGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIg\nbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb3RS\nZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2ZpbHRMaXN0ZW5lcnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9maWx0TGlzdGVuZXJzLnJlbW92ZShs\naXN0ZW5lci5nZXRUYWcoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBD\nb2xsZWN0aW9uIGdldEZpbHRlckxpc3RlbmVycygpIHsKICAgICAgICByZXR1\ncm4gKF9maWx0TGlzdGVuZXJzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1Q\nVFlfTElTVAogICAgICAgICAgICA6IF9maWx0TGlzdGVuZXJzLnZhbHVlcygp\nOwogICAgfQoKICAgIHB1YmxpYyBGaWx0ZXJMaXN0ZW5lciBnZXRGaWx0ZXJM\naXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAgICAgICAgLy8gZmlyc3QgY2hlY2sg\nbGlzdGVuZXJzIGZvciB0aGlzIHF1ZXJ5CiAgICAgICAgaWYgKF9maWx0TGlz\ndGVuZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgRmlsdGVyTGlzdGVuZXIg\nbGlzdGVuID0gKEZpbHRlckxpc3RlbmVyKSBfZmlsdExpc3RlbmVycy5nZXQo\ndGFnKTsKICAgICAgICAgICAgaWYgKGxpc3RlbiAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGxpc3RlbjsKICAgICAgICB9CgogICAgICAgIC8v\nIGNoZWNrIHVzZXItZGVmaW5lZCBsaXN0ZW5lcnMgZnJvbSBjb25maWd1cmF0\naW9uCiAgICAgICAgRmlsdGVyTGlzdGVuZXJbXSBjb25mTGlzdGVuZXJzID0g\nX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldEZp\nbHRlckxpc3RlbmVySW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb25mTGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBpZiAoY29uZkxpc3RlbmVyc1tpXS5nZXRUYWcoKS5lcXVhbHModGFnKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBjb25mTGlzdGVuZXJzW2ldOwoKICAg\nICAgICAvLyBjaGVjayBzdG9yZSBsaXN0ZW5lcnMKICAgICAgICByZXR1cm4g\nX3N0b3JlUXVlcnkuZ2V0RmlsdGVyTGlzdGVuZXIodGFnKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBhZGRBZ2dyZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVM\naXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFz\nc2VydE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIGlmIChfYWdnTGlzdGVu\nZXJzID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWdnTGlzdGVuZXJzID0g\nbmV3IEhhc2hNYXAoNSk7CiAgICAgICAgICAgIF9hZ2dMaXN0ZW5lcnMucHV0\nKGxpc3RlbmVyLmdldFRhZygpLCBsaXN0ZW5lcik7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHJlbW92ZUFnZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3Jl\nZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAg\nICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgaWYgKF9hZ2dM\naXN0ZW5lcnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hZ2dMaXN0ZW5l\ncnMucmVtb3ZlKGxpc3RlbmVyLmdldFRhZygpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIENvbGxlY3Rpb24gZ2V0QWdncmVnYXRlTGlzdGVuZXJzKCkg\newogICAgICAgIHJldHVybiAoX2FnZ0xpc3RlbmVycyA9PSBudWxsKSA/IENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1QKICAgICAgICAgICAgOiBfYWdnTGlzdGVu\nZXJzLnZhbHVlcygpOwogICAgfQoKICAgIHB1YmxpYyBBZ2dyZWdhdGVMaXN0\nZW5lciBnZXRBZ2dyZWdhdGVMaXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAgICAg\nICAgLy8gZmlyc3QgY2hlY2sgbGlzdGVuZXJzIGZvciB0aGlzIHF1ZXJ5CiAg\nICAgICAgaWYgKF9hZ2dMaXN0ZW5lcnMgIT0gbnVsbCkgewogICAgICAgICAg\nICBBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0ZW4gPSAoQWdncmVnYXRlTGlzdGVu\nZXIpIF9hZ2dMaXN0ZW5lcnMuCiAgICAgICAgICAgICAgICBnZXQodGFnKTsK\nICAgICAgICAgICAgaWYgKGxpc3RlbiAhPSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGxpc3RlbjsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNr\nIHVzZXItZGVmaW5lZCBsaXN0ZW5lcnMgZnJvbSBjb25maWd1cmF0aW9uCiAg\nICAgICAgQWdncmVnYXRlTGlzdGVuZXJbXSBjb25mTGlzdGVuZXJzID0gX2Jy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldEFnZ3Jl\nZ2F0ZUxpc3RlbmVySW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb25mTGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICBpZiAoY29uZkxpc3RlbmVyc1tpXS5nZXRUYWcoKS5lcXVhbHModGFnKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBjb25mTGlzdGVuZXJzW2ldOwoKICAg\nICAgICAvLyBjaGVjayBzdG9yZSBsaXN0ZW5lcnMKICAgICAgICByZXR1cm4g\nX3N0b3JlUXVlcnkuZ2V0QWdncmVnYXRlTGlzdGVuZXIodGFnKTsKICAgIH0K\nCiAgICBwdWJsaWMgRXh0ZW50IGdldENhbmRpZGF0ZUV4dGVudCgpIHsKICAg\nICAgICAvLyBpZiBqdXN0IHRoZSBjbGFzcyBpcyBzZXQsIGZldGNoIHRoZSBj\nb3JyZXNwb25kaW5nIGV4dGVudDsgaWYgdGhlCiAgICAgICAgLy8gZXh0ZW50\nIGlzIGFscmVhZHkgc2V0IGJ1dCBpdHMgaWdub3JlIGNhY2hlIHNldHRpbmcg\naXMgd3JvbmcsCiAgICAgICAgLy8gZ2V0IGEgbmV3IGV4dGVudCB3aXRoIHRo\nZSBjb3JyZWN0IHNldHRpbmcgKGRvbid0IG1vZGlmeSBvcmlnIGV4dGVudAog\nICAgICAgIC8vIGluIGNhc2UgdGhlIHVzZXIgaGFzIGEgcmVmZXJlbmNlIHRv\nIGl0IGFuZCBtaWdodCB1c2UgaXQpCiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIENsYXNzIGNscyA9IGdldENhbmRpZGF0ZVR5\ncGUoKTsKICAgICAgICAgICAgaWYgKF9leHRlbnQgPT0gbnVsbCAmJiBfY29s\nbGVjdGlvbiA9PSBudWxsICYmIF9icm9rZXIgIT0gbnVsbAogICAgICAgICAg\nICAgICAgJiYgY2xzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9leHRl\nbnQgPSBfYnJva2VyLm5ld0V4dGVudChjbHMsIF9zdWJjbGFzc2VzKTsKICAg\nICAgICAgICAgICAgIF9leHRlbnQuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3Jl\nQ2hhbmdlcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX2V4dGVudCAhPSBu\ndWxsCiAgICAgICAgICAgICAgICAmJiBfZXh0ZW50LmdldElnbm9yZUNoYW5n\nZXMoKSAhPSBfaWdub3JlQ2hhbmdlcyAmJiBjbHMgIT0gbnVsbCl7CiAgICAg\nICAgICAgICAgICBfZXh0ZW50ID0gX2Jyb2tlci5uZXdFeHRlbnQoY2xzLCBf\nZXh0ZW50Lmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBfZXh0\nZW50LnNldElnbm9yZUNoYW5nZXMoX2lnbm9yZUNoYW5nZXMpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBfZXh0ZW50OwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYW5kaWRhdGVFeHRlbnQoRXh0ZW50\nIGNhbmRpZGF0ZUV4dGVudCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFz\nc2VydE5vdFJlYWRPbmx5KCk7CgogICAgICAgICAgICBpZiAoY2FuZGlkYXRl\nRXh0ZW50ID09IF9leHRlbnQpCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIGlmIChjYW5kaWRhdGVFeHRlbnQgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgX2V4dGVudCA9IG51bGw7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIGV4dGVu\ndCB0aGVuIG5vdCBjb2xsZWN0aW9uCiAgICAgICAgICAgIF9leHRlbnQgPSBj\nYW5kaWRhdGVFeHRlbnQ7CiAgICAgICAgICAgIF9jb2xsZWN0aW9uID0gbnVs\nbDsKCiAgICAgICAgICAgIGJvb2xlYW4gaW52YWxpZGF0ZSA9IGZhbHNlOwog\nICAgICAgICAgICBpZiAoX2V4dGVudC5nZXRFbGVtZW50VHlwZSgpICE9IF9j\nbGFzcykgewogICAgICAgICAgICAgICAgX2NsYXNzID0gX2V4dGVudC5nZXRF\nbGVtZW50VHlwZSgpOwogICAgICAgICAgICAgICAgX2xvYWRlciA9IG51bGw7\nCiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlID0gdHJ1ZTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoX2V4dGVudC5oYXNTdWJjbGFzc2VzKCkg\nIT0gX3N1YmNsYXNzZXMpIHsKICAgICAgICAgICAgICAgIF9zdWJjbGFzc2Vz\nID0gX2V4dGVudC5oYXNTdWJjbGFzc2VzKCk7CiAgICAgICAgICAgICAgICBp\nbnZhbGlkYXRlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoaW52YWxpZGF0ZSkKICAgICAgICAgICAgICAgIGludmFsaWRhdGVDb21w\naWxhdGlvbigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlv\nbiBnZXRDYW5kaWRhdGVDb2xsZWN0aW9uKCkgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICByZXR1cm4gX2NvbGxlY3Rpb247CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0Q2FuZGlkYXRlQ29sbGVjdGlvbihDb2xsZWN0aW9u\nIGNhbmRpZGF0ZUNvbGxlY3Rpb24pIHsKICAgICAgICBpZiAoIV9zdG9yZVF1\nZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJxdWVy\neS1ub3N1cHBvcnQiLAogICAgICAgICAgICAgICAgX2xhbmd1YWdlKSk7Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CgogICAgICAgICAgICAvLyBpZiBjb2xsZWN0aW9uIHRoZW4g\nbm90IGV4dGVudAogICAgICAgICAgICBfY29sbGVjdGlvbiA9IGNhbmRpZGF0\nZUNvbGxlY3Rpb247CiAgICAgICAgICAgIGlmIChfY29sbGVjdGlvbiAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX2V4dGVudCA9IG51bGw7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfY2xhc3MgIT0gbnVsbCB8fCBf\nY29tcGlsZWQgIT0gbnVsbCB8fCBfcXVlcnkgPT0gbnVsbAogICAgICAgICAg\nICAgICAgfHwgX2Jyb2tlciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIF9jbGFzczsKCiAgICAgICAgICAgIC8vIGNoZWNrIGFnYWluIGFmdGVy\nIGNvbXBpbGF0aW9uOyBtYXliZSBlbmNvZGVkIGluIHN0cmluZwogICAgICAg\nICAgICBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAgcmV0\ndXJuIF9jbGFzczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nQ2FuZGlkYXRlVHlwZShDbGFzcyBjYW5kaWRhdGVDbGFzcywgYm9vbGVhbiBz\ndWJzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9u\nbHkoKTsKICAgICAgICAgICAgX2NsYXNzID0gY2FuZGlkYXRlQ2xhc3M7CiAg\nICAgICAgICAgIF9zdWJjbGFzc2VzID0gc3ViczsKICAgICAgICAgICAgX2xv\nYWRlciA9IG51bGw7CiAgICAgICAgICAgIGludmFsaWRhdGVDb21waWxhdGlv\nbigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJj\nbGFzc2VzKCkgewogICAgICAgIHJldHVybiBfc3ViY2xhc3NlczsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGdldFJlc3VsdE1hcHBpbmdOYW1lKCkgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gX3Jlc3VsdE1h\ncHBpbmdOYW1lOwogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRSZXN1bHRN\nYXBwaW5nU2NvcGUoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nIHJldHVybiBfcmVzdWx0TWFwcGluZ1Njb3BlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFJlc3VsdE1hcHBpbmcoQ2xhc3Mgc2NvcGUsIFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgX3Jlc3VsdE1hcHBpbmdT\nY29wZSA9IHNjb3BlOwogICAgICAgICAgICBfcmVzdWx0TWFwcGluZ05hbWUg\nPSBuYW1lOwogICAgICAgICAgICBfcGFja2VyID0gbnVsbDsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNVbmlxdWUoKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICAgICAgaWYgKF91bmlxdWUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBfdW5pcXVlLmJvb2xlYW5WYWx1ZSgpOwogICAgICAg\nICAgICBpZiAoX3F1ZXJ5ID09IG51bGwgfHwgX2NvbXBpbGluZyB8fCBfYnJv\na2VyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsg\nbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcKICAgICAgICAgICAgaWYgKF9jb21w\naWxlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb21waWxlRm9yQ29t\ncGlsYXRpb24oKTsKICAgICAgICAgICAgICAgIGlmIChfdW5pcXVlICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF91bmlxdWUuYm9vbGVh\nblZhbHVlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vIGV4\ncGxpY2l0IHNldHRpbmc7IGRlZmF1bHQKICAgICAgICAgICAgU3RvcmVRdWVy\neS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAgICAg\nICAgICBpZiAoIWV4LmlzQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuICFl\neC5oYXNHcm91cGluZyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFVuaXF1ZShib29sZWFuIHVuaXF1ZSkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAg\nICAgICAgIF91bmlxdWUgPSAodW5pcXVlKSA/IEJvb2xlYW4uVFJVRSA6IEJv\nb2xlYW4uRkFMU0U7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBn\nZXRSZXN1bHRUeXBlKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChf\ncmVzdWx0Q2xhc3MgIT0gbnVsbCB8fCBfY29tcGlsZWQgIT0gbnVsbCB8fCBf\ncXVlcnkgPT0gbnVsbAogICAgICAgICAgICAgICAgfHwgX2Jyb2tlciA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRDbGFzczsKCiAg\nICAgICAgICAgIC8vIGNoZWNrIGFnYWluIGFmdGVyIGNvbXBpbGF0aW9uOyBt\nYXliZSBlbmNvZGVkIGluIHN0cmluZwogICAgICAgICAgICBjb21waWxlRm9y\nQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRDbGFz\nczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVzdWx0VHlw\nZShDbGFzcyBjbHMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAvLyBhbGxv\nd2VkIG1vZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5IGNoZWNrCiAgICAgICAg\nICAgIF9yZXN1bHRDbGFzcyA9IGNsczsKICAgICAgICAgICAgX3BhY2tlciA9\nIG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBsb25nIGdldFN0YXJ0\nUmFuZ2UoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVy\nbiBfc3RhcnRJZHg7CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0RW5kUmFu\nZ2UoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBf\nZW5kSWR4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJhbmdlKGxvbmcg\nc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgaWYgKHN0YXJ0IDwgMCB8fCBl\nbmQgPCAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiaW52YWxpZC1yYW5nZSIsCiAgICAgICAgICAgICAgICBTdHJp\nbmcudmFsdWVPZihzdGFydCksIFN0cmluZy52YWx1ZU9mKGVuZCkpKTsKCiAg\nICAgICAgaWYgKGVuZCAtIHN0YXJ0ID4gSW50ZWdlci5NQVhfVkFMVUUgJiYg\nZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicmFuZ2UtdG9vLWJpZyIsCiAgICAg\nICAgICAgICAgICBTdHJpbmcudmFsdWVPZihzdGFydCksIFN0cmluZy52YWx1\nZU9mKGVuZCkpKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgLy8gYWxsb3dl\nZCBtb2RpZmljYXRpb246IG5vIHJlYWQtb25seSBjaGVjawogICAgICAgICAg\nICBfc3RhcnRJZHggPSBzdGFydDsKICAgICAgICAgICAgX2VuZElkeCA9IGVu\nZDsKICAgICAgICAgICAgX3JhbmdlU2V0ID0gdHJ1ZTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBnZXRQYXJhbWV0ZXJEZWNsYXJhdGlvbigp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBpZiAoX3BhcmFtcyAhPSBudWxs\nIHx8IF9jb21waWxlZCAhPSBudWxsIHx8IF9jb21waWxpbmcKICAgICAgICAg\nICAgICAgIHx8IF9icm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBfcGFyYW1zOwoKICAgICAgICAgICAgLy8gY2hlY2sgYWdhaW4gYWZ0\nZXIgY29tcGlsYXRpb247IG1heWJlIGVuY29kZWQgaW4gc3RyaW5nCiAgICAg\nICAgICAgIGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICBy\nZXR1cm4gX3BhcmFtczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZGVjbGFyZVBhcmFtZXRlcnMoU3RyaW5nIHBhcmFtcykgewogICAgICAgIGlm\nICghX3N0b3JlUXVlcnkuc3VwcG9ydHNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMo\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJxdWVyeS1ub3N1cHBvcnQiLAogICAgICAgICAgICAgICAg\nX2xhbmd1YWdlKSk7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5v\ndFJlYWRPbmx5KCk7CiAgICAgICAgICAgIF9wYXJhbXMgPSBTdHJpbmdVdGls\ncy50cmltVG9OdWxsKHBhcmFtcyk7CiAgICAgICAgICAgIGludmFsaWRhdGVD\nb21waWxhdGlvbigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nb21waWxlKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIFN0b3JlUXVlcnku\nRXhlY3V0b3IgZXggPSBjb21waWxlRm9yRXhlY3V0b3IoKTsKICAgICAgICAg\nICAgZ2V0UmVzdWx0UGFja2VyKF9zdG9yZVF1ZXJ5LCBleCk7CiAgICAgICAg\nICAgIGV4LnZhbGlkYXRlKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBnZXRDb21waWxhdGlvbigpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBp\nbGVGb3JDb21waWxhdGlvbigpLnN0b3JlRGF0YTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb21waWxlIHF1ZXJ5IHByb3BlcnRpZXMuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ29tcGlsYXRpb24gY29tcGlsZUZvckNvbXBpbGF0\naW9uKCkgewogICAgICAgIGlmIChfY29tcGlsZWQgIT0gbnVsbCB8fCBfY29t\ncGlsaW5nKQogICAgICAgICAgICByZXR1cm4gX2NvbXBpbGVkOwoKICAgICAg\nICBhc3NlcnROb3RTZXJpYWxpemVkKCk7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwoKICAgICAgICBib29sZWFuIHJlYWRPbmx5ID0gX3JlYWRPbmx5OwogICAg\nICAgIF9yZWFkT25seSA9IGZhbHNlOwogICAgICAgIF9jb21waWxpbmcgPSB0\ncnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9jb21waWxlZCA9IGNv\nbXBpbGF0aW9uRnJvbUNhY2hlKCk7CiAgICAgICAgICAgIHJldHVybiBfY29t\ncGlsZWQ7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBfY29tcGlsaW5nID0gZmFsc2U7CiAgICAgICAgICAgIF9yZWFkT25s\neSA9IHJlYWRPbmx5OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEZpbmQgdGhlIGNhY2hlZCBjb21waWxhdGlvbiBmb3IgdGhlIGN1cnJlbnQg\ncXVlcnksIGNyZWF0aW5nIG9uZSBpZiBpdAogICAgICogZG9lcyBub3QgZXhp\nc3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb21waWxhdGlvbiBjb21waWxh\ndGlvbkZyb21DYWNoZSgpIHsKICAgICAgICBNYXAgY29tcENhY2hlID0KICAg\nICAgICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0UXVlcnlD\nb21waWxhdGlvbkNhY2hlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoY29tcENh\nY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0NvbXBpbGF0\naW9uKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgQ29tcGlsYXRp\nb25LZXkga2V5ID0gbmV3IENvbXBpbGF0aW9uS2V5KCk7CiAgICAgICAgICAg\nIGtleS5xdWVyeVR5cGUgPSBfc3RvcmVRdWVyeS5nZXRDbGFzcygpOwogICAg\nICAgICAgICBrZXkuY2FuZGlkYXRlVHlwZSA9IGdldENhbmRpZGF0ZVR5cGUo\nKTsKICAgICAgICAgICAga2V5LnN1YmNsYXNzZXMgPSBoYXNTdWJjbGFzc2Vz\nKCk7CiAgICAgICAgICAgIGtleS5xdWVyeSA9IGdldFF1ZXJ5U3RyaW5nKCk7\nCiAgICAgICAgICAgIGtleS5sYW5ndWFnZSA9IGdldExhbmd1YWdlKCk7CiAg\nICAgICAgICAgIGtleS5zdG9yZUtleSA9IF9zdG9yZVF1ZXJ5Lm5ld0NvbXBp\nbGF0aW9uS2V5KCk7CiAgICAgICAgICAgIENvbXBpbGF0aW9uIGNvbXAgPSAo\nQ29tcGlsYXRpb24pIGNvbXBDYWNoZS5nZXQoa2V5KTsKCiAgICAgICAgICAg\nIC8vIHBhcnNlIGRlY2xhcmF0aW9ucyBpZiBuZWVkZWQKICAgICAgICAgICAg\nYm9vbGVhbiBjYWNoZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAoY29tcCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb21wID0gbmV3Q29tcGlsYXRp\nb24oKTsKICAgICAgICAgICAgICAgIC8vIG9ubHkgY2FjaGUgdGhvc2UgcXVl\ncmllcyB0aGF0IGNhbiBiZSBjb21waWxlZAogICAgICAgICAgICAgICAgY2Fj\naGUgPSBjb21wLnN0b3JlRGF0YSAhPSBudWxsOwogICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgIF9zdG9yZVF1ZXJ5LnBvcHVsYXRlRnJvbUNv\nbXBpbGF0aW9uKGNvbXAuc3RvcmVEYXRhKTsKCiAgICAgICAgICAgIC8vIGNh\nY2hlIHBhcnNlZCBzdGF0ZSBpZiBuZWVkZWQKICAgICAgICAgICAgaWYgKGNh\nY2hlKQogICAgICAgICAgICAgICAgY29tcENhY2hlLnB1dChrZXksIGNvbXAp\nOwogICAgICAgICAgICByZXR1cm4gY29tcDsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBwb3B1bGF0ZSBhIG5ldyBj\nb21waWxhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBDb21waWxhdGlvbiBu\nZXdDb21waWxhdGlvbigpIHsKICAgICAgICBDb21waWxhdGlvbiBjb21wID0g\nbmV3IENvbXBpbGF0aW9uKCk7CiAgICAgICAgY29tcC5zdG9yZURhdGEgPSBf\nc3RvcmVRdWVyeS5uZXdDb21waWxhdGlvbigpOwogICAgICAgIF9zdG9yZVF1\nZXJ5LnBvcHVsYXRlRnJvbUNvbXBpbGF0aW9uKGNvbXAuc3RvcmVEYXRhKTsK\nICAgICAgICByZXR1cm4gY29tcDsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbXBpbGUgZm9yIGV4ZWN1dGlvbiwgY2hvb3NpbmcgYmV0d2VlbiBkYXRhc3Rv\ncmUgYW5kIGluLW1lbQogICAgICogY29tcGlsYXRpb24gYmFzZWQgb24gd2hh\ndCB3ZSBzdXBwb3J0IGFuZCBvdXIgc2V0dGluZ3MuCiAgICAgKi8KICAgIHBy\naXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRvciBjb21waWxlRm9yRXhlY3V0b3Io\nKSB7CiAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9IGNvbXBpbGVGb3JDb21w\naWxhdGlvbigpOwogICAgICAgIGlmIChfY29sbGVjdGlvbiA9PSBudWxsKSB7\nCiAgICAgICAgICAgIGlmIChjb21wLmRhdGFzdG9yZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGNvbXAuZGF0YXN0b3JlOwogICAgICAgICAg\nICBpZiAoY29tcC5tZW1vcnkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBjb21wLm1lbW9yeTsKICAgICAgICAgICAgaWYgKF9zdG9yZVF1ZXJ5\nLnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gY29tcGlsZUZvckRhdGFTdG9yZShjb21wKTsKICAgICAgICAg\nICAgcmV0dXJuIGNvbXBpbGVGb3JJbk1lbW9yeShjb21wKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChjb21wLm1lbW9yeSAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gY29tcC5tZW1vcnk7CiAgICAgICAgaWYgKGNvbXAuZGF0YXN0\nb3JlICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjb21wLmRhdGFzdG9y\nZTsKICAgICAgICBpZiAoX3N0b3JlUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4\nZWN1dGlvbigpKQogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckluTWVt\nb3J5KGNvbXApOwogICAgICAgIHJldHVybiBjb21waWxlRm9yRGF0YVN0b3Jl\nKGNvbXApOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGV4cHJl\nc3Npb24gdHJlZSBmb3IgZGF0YXN0b3JlIGV4ZWN1dGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGNvbXBpbGVGb3JEYXRh\nU3RvcmUoQ29tcGlsYXRpb24gY29tcCkgewogICAgICAgIGlmIChjb21wLmRh\ndGFzdG9yZSA9PSBudWxsKQogICAgICAgICAgICBjb21wLmRhdGFzdG9yZSA9\nIGNyZWF0ZUV4ZWN1dG9yKGZhbHNlKTsKICAgICAgICByZXR1cm4gY29tcC5k\nYXRhc3RvcmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gZXhw\ncmVzc2lvbiB0cmVlIGZvciBpbi1tZW1vcnkgZXhlY3V0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY29tcGlsZUZvcklu\nTWVtb3J5KENvbXBpbGF0aW9uIGNvbXApIHsKICAgICAgICBpZiAoY29tcC5t\nZW1vcnkgPT0gbnVsbCkKICAgICAgICAgICAgY29tcC5tZW1vcnkgPSBjcmVh\ndGVFeGVjdXRvcih0cnVlKTsKICAgICAgICByZXR1cm4gY29tcC5tZW1vcnk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBxdWVyeSBleGVjdXRv\nciBvZiB0aGUgcHJvcGVyIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgU3Rv\ncmVRdWVyeS5FeGVjdXRvciBjcmVhdGVFeGVjdXRvcihib29sZWFuIGluTWVt\nKSB7CiAgICAgICAgYXNzZXJ0Q2FuZGlkYXRlVHlwZSgpOwoKICAgICAgICBN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfYnJva2VyLmdldENvbmZpZ3Vy\nYXRpb24oKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSByZXBvcy5n\nZXRNZXRhRGF0YShfY2xhc3MsCiAgICAgICAgICAgIF9icm9rZXIuZ2V0Q2xh\nc3NMb2FkZXIoKSwgZmFsc2UpOwoKICAgICAgICBDbGFzc01ldGFEYXRhW10g\nbWV0YXM7CiAgICAgICAgaWYgKF9jbGFzcyA9PSBudWxsIHx8IF9zdG9yZVF1\nZXJ5LnN1cHBvcnRzQWJzdHJhY3RFeGVjdXRvcnMoKSkKICAgICAgICAgICAg\nbWV0YXMgPSBuZXcgQ2xhc3NNZXRhRGF0YVtdeyBtZXRhIH07CiAgICAgICAg\nZWxzZSBpZiAoX3N1YmNsYXNzZXMgJiYgKG1ldGEgPT0gbnVsbCB8fCBtZXRh\nLmlzTWFuYWdlZEludGVyZmFjZSgpKSkKICAgICAgICAgICAgbWV0YXMgPSBy\nZXBvcy5nZXRJbXBsZW1lbnRvck1ldGFEYXRhcyhfY2xhc3MsCiAgICAgICAg\nICAgICAgICBfYnJva2VyLmdldENsYXNzTG9hZGVyKCksIHRydWUpOwogICAg\nICAgIGVsc2UgaWYgKG1ldGEgIT0gbnVsbCAmJiAoX3N1YmNsYXNzZXMgfHwg\nbWV0YS5pc01hcHBlZCgpKSkKICAgICAgICAgICAgbWV0YXMgPSBuZXcgQ2xh\nc3NNZXRhRGF0YVtdeyBtZXRhIH07CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBtZXRhcyA9IFN0b3JlUXVlcnkuRU1QVFlfTUVUQVM7CgogICAgICAgIGlm\nIChtZXRhcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWltcGxzIiwgX2NsYXNzKSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKG1ldGFzLmxlbmd0aCA9PSAx\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5NZW0pCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5Lm5ld0luTWVtb3J5RXhlY3V0b3Io\nbWV0YXNbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIF9zdWJjbGFzc2Vz\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmVRdWVyeS5uZXdEYXRh\nU3RvcmVFeGVjdXRvcihtZXRhc1swXSwgX3N1YmNsYXNzZXMpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBtdWx0aXBsZSBpbXBsZW1lbnRvcnMK\nICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvcltdIGVzID0gbmV3IFN0\nb3JlUXVlcnkuRXhlY3V0b3JbbWV0YXMubGVuZ3RoXTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBlcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKGluTWVtKQogICAgICAgICAgICAgICAgICAgIGVzW2ld\nID0gX3N0b3JlUXVlcnkubmV3SW5NZW1vcnlFeGVjdXRvcihtZXRhc1tpXSwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgZXNbaV0gPSBfc3RvcmVRdWVyeS5uZXdEYXRhU3RvcmVFeGVjdXRvciht\nZXRhc1tpXSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIG5ldyBNZXJnZWRFeGVjdXRvcihlcyk7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbnkgY29tcGlsYXRp\nb24sIGZvcmNpbmcgdGhpcyBxdWVyeSB0byBiZSByZWNvbXBpbGVkCiAgICAg\nKiBuZXh0IHRpbWUgaXQncyBleGVjdXRlZC4gVGhpcyBzaG91bGQgYmUgaW52\nb2tlZCB3aGVuZXZlciBhbnkKICAgICAqIHN0YXRlIGNoYW5nZXMgdGhhdCB3\nb3VsZCBjYXVzZSB0aGUgdW5kZXJseWluZyBxdWVyeQogICAgICogcmVwcmVz\nZW50YXRpb24gdG8gY2hhbmdlLgogICAgICoKICAgICAqIEBzaW5jZSAwLjMu\nMAogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaW52YWxpZGF0ZUNvbXBp\nbGF0aW9uKCkgewogICAgICAgIGlmIChfY29tcGlsaW5nKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgX3N0b3JlUXVlcnkuaW52YWxpZGF0\nZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgX2NvbXBpbGVkID0gbnVsbDsKICAg\nICAgICBfcGFja2VyID0gbnVsbDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGV4ZWN1dGUoKSB7CiAgICAgICAgcmV0\ndXJuIGV4ZWN1dGUoKE9iamVjdFtdKSBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGV4ZWN1dGUoT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAg\ncmV0dXJuIGV4ZWN1dGUoT1BfU0VMRUNULCBwYXJhbXMpOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZXhlY3V0ZShNYXAgcGFyYW1zKSB7CiAgICAgICAg\ncmV0dXJuIGV4ZWN1dGUoT1BfU0VMRUNULCBwYXJhbXMpOwogICAgfQoKICAg\nIHByaXZhdGUgT2JqZWN0IGV4ZWN1dGUoaW50IG9wZXJhdGlvbiwgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKQogICAg\nICAgICAgICBwYXJhbXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX09CSkVDVFM7Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnROb3RTZXJpYWxpemVkKCk7CiAgICAgICAgICAgIF9icm9rZXIuYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgICAgICBfYnJva2VyLmFz\nc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAgICAg\nLy8gZ2V0IGV4ZWN1dG9yCiAgICAgICAgICAgICAgICBDb21waWxhdGlvbiBj\nb21wID0gY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgICAg\nICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gKGlzSW5NZW1vcnkob3BlcmF0\naW9uKSkKICAgICAgICAgICAgICAgICAgICA/IGNvbXBpbGVGb3JJbk1lbW9y\neShjb21wKSA6IGNvbXBpbGVGb3JEYXRhU3RvcmUoY29tcCk7CgogICAgICAg\nICAgICAgICAgYXNzZXJ0UGFyYW1ldGVycyhfc3RvcmVRdWVyeSwgZXgsIHBh\ncmFtcyk7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZ0V4ZWN1dGlvbihvcGVyYXRp\nb24sIGV4LmdldFBhcmFtZXRlclR5cGVzKF9zdG9yZVF1ZXJ5KSwKICAgICAg\nICAgICAgICAgICAgICAgICAgcGFyYW1zKTsKCiAgICAgICAgICAgICAgICBp\nZiAob3BlcmF0aW9uID09IE9QX1NFTEVDVCkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZXhlY3V0ZShfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAg\nICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09IE9QX0RFTEVURSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlKF9zdG9yZVF1ZXJ5LCBl\neCwgcGFyYW1zKTsKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0g\nT1BfVVBEQVRFKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGUo\nX3N0b3JlUXVlcnksIGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7\nCiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBfYnJv\na2VyLmVuZE9wZXJhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3QgZXhlY3V0ZShpbnQgb3Bl\ncmF0aW9uLCBNYXAgcGFyYW1zKSB7CiAgICAgICAgaWYgKHBhcmFtcyA9PSBu\ndWxsKQogICAgICAgICAgICBwYXJhbXMgPSBDb2xsZWN0aW9ucy5FTVBUWV9N\nQVA7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBfYnJva2VyLmJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgYXNzZXJ0Tm90U2VyaWFsaXplZCgpOwog\nICAgICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAgICAg\nX2Jyb2tlci5hc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAg\nICAgICAgICAgIC8vIGdldCBleGVjdXRvcgogICAgICAgICAgICAgICAgQ29t\ncGlsYXRpb24gY29tcCA9IGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAg\nICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IChpc0luTWVt\nb3J5KG9wZXJhdGlvbikpCiAgICAgICAgICAgICAgICAgICAgPyBjb21waWxl\nRm9ySW5NZW1vcnkoY29tcCkgOiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXAp\nOwoKICAgICAgICAgICAgICAgIE9iamVjdFtdIGFyciA9IChwYXJhbXMuaXNF\nbXB0eSgpKSA/IFN0b3JlUXVlcnkuRU1QVFlfT0JKRUNUUyA6CiAgICAgICAg\nICAgICAgICAgICAgdG9QYXJhbWV0ZXJBcnJheShleC5nZXRQYXJhbWV0ZXJU\neXBlcyhfc3RvcmVRdWVyeSksIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBh\nc3NlcnRQYXJhbWV0ZXJzKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsKICAgICAg\nICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgbG9nRXhlY3V0aW9uKG9wZXJhdGlvbiwgcGFyYW1zKTsK\nCiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09IE9QX1NFTEVDVCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhlY3V0ZShfc3RvcmVRdWVy\neSwgZXgsIGFycik7CiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09\nIE9QX0RFTEVURSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRl\nKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsKICAgICAgICAgICAgICAgIGlmIChv\ncGVyYXRpb24gPT0gT1BfVVBEQVRFKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB1cGRhdGUoX3N0b3JlUXVlcnksIGV4LCBhcnIpOwogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBfYnJva2VyLmVuZE9wZXJhdGlvbigpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZGVsZXRlQWxs\nKCkgewogICAgICAgIHJldHVybiBkZWxldGVBbGwoKE9iamVjdFtdKSBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxldGVBbGwoT2JqZWN0W10g\ncGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBleGVjdXRlKE9Q\nX0RFTEVURSwgcGFyYW1zKSkubG9uZ1ZhbHVlKCk7CiAgICB9CgogICAgcHVi\nbGljIGxvbmcgZGVsZXRlQWxsKE1hcCBwYXJhbXMpIHsKICAgICAgICByZXR1\ncm4gKChOdW1iZXIpIGV4ZWN1dGUoT1BfREVMRVRFLCBwYXJhbXMpKS5sb25n\nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyB1cGRhdGVBbGwoKSB7\nCiAgICAgICAgcmV0dXJuIHVwZGF0ZUFsbCgoT2JqZWN0W10pIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbChPYmplY3RbXSBwYXJh\nbXMpIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGV4ZWN1dGUoT1BfVVBE\nQVRFLCBwYXJhbXMpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMg\nbG9uZyB1cGRhdGVBbGwoTWFwIHBhcmFtcykgewogICAgICAgIHJldHVybiAo\nKE51bWJlcikgZXhlY3V0ZShPUF9VUERBVEUsIHBhcmFtcykpLmxvbmdWYWx1\nZSgpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0W10gdG9QYXJhbWV0ZXJB\ncnJheShMaW5rZWRNYXAgcGFyYW1UeXBlcywgTWFwIHBhcmFtcykgewogICAg\nICAgIGlmIChwYXJhbXMgPT0gbnVsbCB8fCBwYXJhbXMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm4gU3RvcmVRdWVyeS5FTVBUWV9PQkpFQ1RTOwoK\nICAgICAgICBPYmplY3RbXSBhcnIgPSBuZXcgT2JqZWN0W3BhcmFtcy5zaXpl\nKCldOwogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICBPYmplY3Qg\na2V5OwogICAgICAgIGludCBpZHg7CiAgICAgICAgaW50IGJhc2UgPSAtMTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhcmFtcy5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVu\ndHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAga2V5\nID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgIGlkeCA9IChwYXJhbVR5\ncGVzID09IG51bGwpID8gLTEgOiBwYXJhbVR5cGVzLmluZGV4T2Yoa2V5KTsK\nCiAgICAgICAgICAgIC8vIGFsbG93IHBvc2l0aW9uYWwgcGFyYW1ldGVycyBh\nbmQgbmF0dXJhbCBvcmRlciBwYXJhbWV0ZXJzCiAgICAgICAgICAgIGlmIChp\nZHggIT0gLTEpCiAgICAgICAgICAgICAgICBhcnJbaWR4XSA9IGVudHJ5Lmdl\ndFZhbHVlKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSBpbnN0YW5jZW9m\nIE51bWJlcikgewogICAgICAgICAgICAgICAgaWYgKGJhc2UgPT0gLTEpCiAg\nICAgICAgICAgICAgICAgICAgYmFzZSA9IHBvc2l0aW9uYWxQYXJhbWV0ZXJC\nYXNlKHBhcmFtcy5rZXlTZXQoKSk7CiAgICAgICAgICAgICAgICBhcnJbKChO\ndW1iZXIpIGtleSkuaW50VmFsdWUoKSAtIGJhc2VdID0gZW50cnkuZ2V0VmFs\ndWUoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXBhcmFtLW5hbWUi\nLCBrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYmFzZSAoZ2VuZXJhbGx5IDAg\nb3IgMSkgdG8gdXNlIGZvciBwb3NpdGlvbmFsIHBhcmFtZXRlcnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIGludCBwb3NpdGlvbmFsUGFyYW1ldGVy\nQmFzZShDb2xsZWN0aW9uIHBhcmFtcykgewogICAgICAgIGludCBsb3cgPSBJ\nbnRlZ2VyLk1BWF9WQUxVRTsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAg\nIGludCB2YWw7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBwYXJhbXMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgb2Jq\nID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKCEob2JqIGluc3RhbmNl\nb2YgTnVtYmVyKSkKICAgICAgICAgICAgICAgIHJldHVybiAwOyAvLyB1c2Ug\nMCBiYXNlIHdoZW4gcGFyYW1zIGFyZSBtaXhlZCB0eXBlcwoKICAgICAgICAg\nICAgdmFsID0gKChOdW1iZXIpIG9iaikuaW50VmFsdWUoKTsKICAgICAgICAg\nICAgaWYgKHZhbCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsK\nICAgICAgICAgICAgaWYgKHZhbCA8IGxvdykKICAgICAgICAgICAgICAgIGxv\ndyA9IHZhbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxvdzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHdlIHNob3VsZCBleGVj\ndXRlIHRoaXMgcXVlcnkgaW4gbWVtb3J5LgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gaXNJbk1lbW9yeShpbnQgb3BlcmF0aW9uKSB7CiAgICAgICAg\nLy8gaWYgbm8gY2FuZGlkYXRlcywgY3JlYXRlIGNhbmRpZGF0ZSBleHRlbnQK\nICAgICAgICBpZiAoX2NvbGxlY3Rpb24gPT0gbnVsbCAmJiBfZXh0ZW50ID09\nIG51bGwgJiYgX2NsYXNzICE9IG51bGwpIHsKICAgICAgICAgICAgX2V4dGVu\ndCA9IF9icm9rZXIubmV3RXh0ZW50KF9jbGFzcywgX3N1YmNsYXNzZXMpOwog\nICAgICAgICAgICBfZXh0ZW50LnNldElnbm9yZUNoYW5nZXMoX2lnbm9yZUNo\nYW5nZXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhlcmUgYXJlIGFu\neSBkaXJ0eSBpbnN0YW5jZXMgaW4gdGhlIGN1cnJlbnQgdHJhbnMgdGhhdCBh\ncmUKICAgICAgICAvLyBpbnZvbHZlZCBpbiB0aGlzIHF1ZXJ5LCB3ZSBoYXZl\nIHRvIGV4ZWN1dGUgaW4gbWVtb3J5IG9yIGZsdXNoCiAgICAgICAgYm9vbGVh\nbiBpbk1lbSA9ICFfc3RvcmVRdWVyeS5zdXBwb3J0c0RhdGFTdG9yZUV4ZWN1\ndGlvbigpCiAgICAgICAgICAgIHx8IF9jb2xsZWN0aW9uICE9IG51bGw7CiAg\nICAgICAgaWYgKCFpbk1lbSAmJiAoIV9pZ25vcmVDaGFuZ2VzIHx8IG9wZXJh\ndGlvbiAhPSBPUF9TRUxFQ1QpCiAgICAgICAgICAgICYmIF9icm9rZXIuaXNB\nY3RpdmUoKSAmJiBpc0FjY2Vzc1BhdGhEaXJ0eSgpKSB7CiAgICAgICAgICAg\nIGludCBmbHVzaCA9IF9mYy5nZXRGbHVzaEJlZm9yZVF1ZXJpZXMoKTsKICAg\nICAgICAgICAgaWYgKChmbHVzaCA9PSBGTFVTSF9UUlVFCiAgICAgICAgICAg\nICAgICB8fCAoZmx1c2ggPT0gRkxVU0hfV0lUSF9DT05ORUNUSU9OICYmIF9i\ncm9rZXIuaGFzQ29ubmVjdGlvbigpKQogICAgICAgICAgICAgICAgfHwgb3Bl\ncmF0aW9uICE9IE9QX1NFTEVDVAogICAgICAgICAgICAgICAgfHwgIV9zdG9y\nZVF1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAg\nICAgICAgICYmIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRl\nZE9wdGlvbnMoKS4KICAgICAgICAgICAgICAgIGNvbnRhaW5zKE9wZW5KUEFD\nb25maWd1cmF0aW9uLk9QVElPTl9JTkNfRkxVU0gpKSB7CiAgICAgICAgICAg\nICAgICBfYnJva2VyLmZsdXNoKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBpZiAoX2xvZy5pc0luZm9FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJmb3JjZS1pbi1t\nZW0iLCBfY2xhc3MpKTsKICAgICAgICAgICAgICAgIGluTWVtID0gdHJ1ZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGluTWVtICYm\nICFfc3RvcmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQoImNhbnQtZXhlYy1pbm1lbSIsCiAgICAgICAgICAgICAgICBfbGFu\nZ3VhZ2UpKTsKICAgICAgICByZXR1cm4gaW5NZW07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFeGVjdXRlIHRoZSBxdWVyeSB1c2luZyB0aGUgZ2l2ZW4gY29t\ncGlsYXRpb24sIGV4ZWN1dG9yLCBhbmQgcGFyYW1ldGVyCiAgICAgKiB2YWx1\nZXMuIEFsbCBvdGhlciBleGVjdXRlIG1ldGhvZHMgZGVsZWdhdGUgdG8gdGhp\ncyBvbmUgb3IgdG8KICAgICAqIHtAbGluayAjZXhlY3V0ZShTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZhbGlkYXRpb24gYW5kIGxvY2tpbmcu\nCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGV4ZWN1dGUoU3RvcmVRdWVy\neSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4LCAKICAgICAgICBPYmplY3Rb\nXSBwYXJhbXMpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gaWYgdGhpcyBpcyBhbiBpbXBvc3NpYmxlIHJlc3VsdCByYW5nZSwgcmV0\ndXJuIG51bGwgLyBlbXB0eSBsaXN0CiAgICAgICAgU3RvcmVRdWVyeS5SYW5n\nZSByYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKF9zdGFydElkeCwgX2Vu\nZElkeCk7CiAgICAgICAgaWYgKCFfcmFuZ2VTZXQpCiAgICAgICAgICAgIGV4\nLmdldFJhbmdlKHEsIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIGlmIChyYW5n\nZS5zdGFydCA+PSByYW5nZS5lbmQpCiAgICAgICAgICAgIHJldHVybiBlbXB0\neVJlc3VsdChxLCBleCk7CgogICAgICAgIC8vIGV4ZWN1dGU7IGlmIHdlIGhh\ndmUgYSByZXN1bHQgY2xhc3Mgb3Igd2UgaGF2ZSBvbmx5IG9uZSByZXN1bHQK\nICAgICAgICAvLyBhbmQgc28gbmVlZCB0byByZW1vdmUgaXQgZnJvbSBpdHMg\nYXJyYXksIHdyYXAgaW4gYSBwYWNraW5nIHJvcAogICAgICAgIHJhbmdlLmxy\ncyA9IGlzTFJTKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpOwogICAgICAgIFJl\nc3VsdE9iamVjdFByb3ZpZGVyIHJvcCA9IGV4LmV4ZWN1dGVRdWVyeShxLCBw\nYXJhbXMsIHJhbmdlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gdG9SZXN1bHQocSwgZXgsIHJvcCwgcmFuZ2UpOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChyb3AgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJvcC5jbG9zZSgpOyB9IGNhdGNo\nIChFeGNlcHRpb24gZTIpIHt9CiAgICAgICAgICAgIHRocm93IGU7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlIHRoZSBxdWVyeSB1\nc2luZyB0aGUgZ2l2ZW4gZXhlY3V0b3IsIGFuZCBwYXJhbWV0ZXIKICAgICAq\nIHZhbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0ZSB0\nbyB0aGlzIG9uZSBvciB0bwogICAgICoge0BsaW5rICNkZWxldGUoU3RvcmVR\ndWVyeS5FeGVjdXRvcixNYXApfSBhZnRlciB2YWxpZGF0aW9uIGFuZCBsb2Nr\naW5nLgogICAgICogVGhlIHJldHVybiB2YWx1ZSB3aWxsIGJlIGEgTnVtYmVy\nIGluZGljYXRpbmcgdGhlIG51bWJlciBvZgogICAgICogaW5zdGFuY2VzIGRl\nbGV0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgTnVtYmVyIGRlbGV0ZShTdG9y\nZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE9iamVjdFtdIHBh\ncmFtcykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRCdWxrTW9kaWZ5KHEsIGV4LCBwYXJhbXMpOwogICAgICAgIHJldHVybiBl\neC5leGVjdXRlRGVsZXRlKHEsIHBhcmFtcyk7CiAgICB9CgogICAgcHVibGlj\nIE51bWJlciBkZWxldGVJbk1lbW9yeShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVl\ncnkuRXhlY3V0b3IgZXhlY3V0b3IsCiAgICAgICAgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgT2JqZWN0IG8gPSBleGVj\ndXRlKHEsIGV4ZWN1dG9yLCBwYXJhbXMpOwogICAgICAgICAgICBpZiAoIShv\nIGluc3RhbmNlb2YgQ29sbGVjdGlvbikpCiAgICAgICAgICAgICAgICBvID0g\nQ29sbGVjdGlvbnMuc2luZ2xldG9uKG8pOwoKICAgICAgICAgICAgaW50IHNp\nemUgPSAwOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSAoKENvbGxl\nY3Rpb24pIG8pLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOyBzaXplKyspCiAg\nICAgICAgICAgICAgICBfYnJva2VyLmRlbGV0ZShpLm5leHQoKSwgbnVsbCk7\nCiAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2Yoc2l6ZSk7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHF1ZXJ5\nIHVzaW5nIHRoZSBnaXZlbiBjb21waWxhdGlvbiwgZXhlY3V0b3IsIGFuZCBw\nYXJhbWV0ZXIKICAgICAqIHZhbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0\naG9kcyBkZWxlZ2F0ZSB0byB0aGlzIG9uZSBvciB0bwogICAgICoge0BsaW5r\nICN1cGRhdGUoU3RvcmVRdWVyeS5FeGVjdXRvcixNYXApfSBhZnRlciB2YWxp\nZGF0aW9uIGFuZCBsb2NraW5nLgogICAgICogVGhlIHJldHVybiB2YWx1ZSB3\naWxsIGJlIGEgTnVtYmVyIGluZGljYXRpbmcgdGhlIG51bWJlciBvZgogICAg\nICogaW5zdGFuY2VzIHVwZGF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgTnVt\nYmVyIHVwZGF0ZShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3Ig\nZXgsIE9iamVjdFtdIHBhcmFtcykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBhc3NlcnRCdWxrTW9kaWZ5KHEsIGV4LCBwYXJhbXMpOwog\nICAgICAgIHJldHVybiBleC5leGVjdXRlVXBkYXRlKHEsIHBhcmFtcyk7CiAg\nICB9CgogICAgcHVibGljIE51bWJlciB1cGRhdGVJbk1lbW9yeShTdG9yZVF1\nZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXhlY3V0b3IsCiAgICAgICAg\nT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nT2JqZWN0IG8gPSBleGVjdXRlKHEsIGV4ZWN1dG9yLCBwYXJhbXMpOwogICAg\nICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ29sbGVjdGlvbikpCiAgICAg\nICAgICAgICAgICBvID0gQ29sbGVjdGlvbnMuc2luZ2xldG9uKG8pOwoKICAg\nICAgICAgICAgaW50IHNpemUgPSAwOwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGkgPSAoKENvbGxlY3Rpb24pIG8pLml0ZXJhdG9yKCk7IGkuaGFzTmV4\ndCgpOyBzaXplKyspCiAgICAgICAgICAgICAgICB1cGRhdGVJbk1lbW9yeShp\nLm5leHQoKSwgcGFyYW1zKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMu\ndmFsdWVPZihzaXplKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgdmFsdWVzIGZvciB0aGUgdXBkYXRlcyBpbiBtZW1vcnkuCiAg\nICAgKgogICAgICogQHBhcmFtIG9iIHRoZSBwZXJzaXN0ZW50IGluc3RhbmNl\nIHRvIGNoYW5nZQogICAgICogQHBhcmFtIHBhcmFtcyB0aGUgcGFyYW1ldGVy\ncyBwYXNzZWQgdG8gdGhlIHF1ZXJ5CiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB1cGRhdGVJbk1lbW9yeShPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcykg\newogICAgICAgIGZvciAoSXRlcmF0b3IgaXQgPSBnZXRVcGRhdGVzKCkuZW50\ncnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAgICBpdC5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlID0gKE1hcC5FbnRyeSkgaXQu\nbmV4dCgpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IChGaWVs\nZE1ldGFEYXRhKSBlLmdldEtleSgpOwoKICAgICAgICAgICAgT2JqZWN0IHZh\nbDsKICAgICAgICAgICAgT2JqZWN0IHZhbHVlID0gZS5nZXRWYWx1ZSgpOwog\nICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBWYWwpIHsKICAgICAg\nICAgICAgICAgIHZhbCA9ICgoVmFsKSB2YWx1ZSkuCiAgICAgICAgICAgICAg\nICAgICAgZXZhbHVhdGUob2IsIG51bGwsIGdldFN0b3JlQ29udGV4dCgpLCBw\nYXJhbXMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNl\nb2YgTGl0ZXJhbCkgewogICAgICAgICAgICAgICAgdmFsID0gKChMaXRlcmFs\nKSB2YWx1ZSkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2\nYWx1ZSBpbnN0YW5jZW9mIENvbnN0YW50KSB7CiAgICAgICAgICAgICAgICB2\nYWwgPSAoKENvbnN0YW50KSB2YWx1ZSkuZ2V0VmFsdWUocGFyYW1zKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJvbmx5LXVwZGF0ZS1wcmltaXRpdmVz\nIikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtID0gX2Jyb2tlci5nZXRTdGF0ZU1hbmFnZXIob2IpOwogICAg\nICAgICAgICBpbnQgaSA9IGZtZC5nZXRJbmRleCgpOwogICAgICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgaW50byA9IEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2IsCiAgICAgICAgICAgICAgICBfYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKSk7CgogICAgICAgICAgICAvLyBzZXQgdGhlIGFjdHVh\nbCBmaWVsZCBpbiB0aGUgaW5zdGFuY2UKICAgICAgICAgICAgaW50IHNldCA9\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIuU0VUX1VTRVI7CiAgICAgICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAg\nICAgICBzbS5zZXR0aW5nQm9vbGVhbkZpZWxkKGludG8sIGksIHNtLmZldGNo\nQm9vbGVhbkZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwg\nPT0gbnVsbCA/IGZhbHNlIDogKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBzZXQpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nQnl0ZUZp\nZWxkKGludG8sIGksIHNtLmZldGNoQnl0ZUZpZWxkKGkpLAogICAgICAgICAg\nICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFs\nKS5ieXRlVmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAg\nICAgICAgICAgICAgICAgc20uc2V0dGluZ0NoYXJGaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaENoYXJGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAg\ndmFsID09IG51bGwgPyAwIDogdmFsLnRvU3RyaW5nKCkuY2hhckF0KDApLCBz\nZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdEb3VibGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaERvdWJs\nZUZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVs\nbCA/IDAgOiAoKE51bWJlcikgdmFsKS5kb3VibGVWYWx1ZSgpLCBzZXQpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0\ndGluZ0Zsb2F0RmllbGQoaW50bywgaSwgc20uZmV0Y2hGbG9hdEZpZWxkKGkp\nLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAo\nKE51bWJlcikgdmFsKS5mbG9hdFZhbHVlKCksIHNldCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0ludEZpZWxk\nKGludG8sIGksIHNtLmZldGNoSW50RmllbGQoaSksCiAgICAgICAgICAgICAg\nICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmlu\ndFZhbHVlKCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAg\nICAgICAgICAgIHNtLnNldHRpbmdMb25nRmllbGQoaW50bywgaSwgc20uZmV0\nY2hMb25nRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9\nPSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpLCBzZXQp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAgICAgc20u\nc2V0dGluZ1Nob3J0RmllbGQoaW50bywgaSwgc20uZmV0Y2hTaG9ydEZpZWxk\nKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAg\nOiAoKE51bWJlcikgdmFsKS5zaG9ydFZhbHVlKCksIHNldCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ1N0\ncmluZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoU3RyaW5nRmllbGQoaSksCiAg\nICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gbnVsbCA6IHZh\nbC50b1N0cmluZygpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTE9OR19PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJ\nTUFMOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdF\nUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgICAg\nICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgc20uZmV0Y2hPYmpl\nY3RGaWVsZChpKSwgdmFsLAogICAgICAgICAgICAgICAgICAgICAgICBzZXQp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgib25seS11cGRhdGUtcHJpbWl0aXZlcyIpKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRyYWNlIGxvZyB0aGF0IHRoZSBxdWVyeSBpcyBleGVjdXRpbmcuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBsb2dFeGVjdXRpb24oaW50IG9wLCBMaW5r\nZWRNYXAgdHlwZXMsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIE1hcCBw\nbWFwID0gQ29sbGVjdGlvbnMuRU1QVFlfTUFQOwogICAgICAgIGlmIChwYXJh\nbXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwbWFwID0gbmV3IEhhc2hN\nYXAoKGludCkgKHBhcmFtcy5sZW5ndGggKiAxLjMzICsgMSkpOwogICAgICAg\nICAgICBpZiAodHlwZXMgIT0gbnVsbCAmJiB0eXBlcy5zaXplKCkgPT0gcGFy\nYW1zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaW50IGkgPSAwOwogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0eXBlcy5rZXlTZXQo\nKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nICAgICBwbWFwLnB1dChpdHIubmV4dCgpLCBwYXJhbXNbaSsrXSk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAg\nICBwbWFwLnB1dChTdHJpbmcudmFsdWVPZihpKSwgcGFyYW1zW2ldKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb2dFeGVjdXRpb24ob3As\nIHBtYXApOwogICAgfQoKICAgIC8qKgogICAgICogVHJhY2UgbG9nIHRoYXQg\ndGhlIHF1ZXJ5IGlzIGV4ZWN1dGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGxvZ0V4ZWN1dGlvbihpbnQgb3AsIE1hcCBwYXJhbXMpIHsKICAgICAg\nICBTdHJpbmcgcyA9IF9xdWVyeTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShzKSkKICAgICAgICAgICAgcyA9IHRvU3RyaW5nKCk7CgogICAg\nICAgIFN0cmluZyBtc2cgPSAiZXhlY3V0aW5nLXF1ZXJ5IjsKICAgICAgICBp\nZiAoIXBhcmFtcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIG1zZyArPSAiLXdp\ndGgtcGFyYW1zIjsKCiAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldChtc2cs\nIHMsIHBhcmFtcykpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgdGhpcyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIHBvdGVudGlhbCBs\nYXJnZSByZXN1bHQgc2V0LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\naXNMUlMobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBsb25nIHJh\nbmdlID0gZW5kIC0gc3RhcnQ7CiAgICAgICAgcmV0dXJuIF9mYy5nZXRGZXRj\naEJhdGNoU2l6ZSgpID49IDAKICAgICAgICAgICAgJiYgIShyYW5nZSA8PSBf\nZmMuZ2V0RmV0Y2hCYXRjaFNpemUoKQogICAgICAgICAgICB8fCAoX2ZjLmdl\ndEZldGNoQmF0Y2hTaXplKCkgPT0gMCAmJiByYW5nZSA8PSA1MCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBxdWVyeSByZXN1bHQgZm9y\nIHRoZSBnaXZlbiByZXN1bHQgb2JqZWN0IHByb3ZpZGVyLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgT2JqZWN0IHRvUmVzdWx0KFN0b3JlUXVlcnkgcSwgU3Rv\ncmVRdWVyeS5FeGVjdXRvciBleCwgCiAgICAgICAgUmVzdWx0T2JqZWN0UHJv\ndmlkZXIgcm9wLCBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKQogICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIHBhY2sgcHJvamVjdGlvbnMg\naWYgbmVjZXNzYXJ5CiAgICAgICAgU3RyaW5nW10gYWxpYXNlcyA9IGV4Lmdl\ndFByb2plY3Rpb25BbGlhc2VzKHEpOwogICAgICAgIGlmICghZXguaXNQYWNr\naW5nKHEpKSB7CiAgICAgICAgICAgIFJlc3VsdFBhY2tlciBwYWNrZXIgPSBn\nZXRSZXN1bHRQYWNrZXIocSwgZXgpOwogICAgICAgICAgICBpZiAocGFja2Vy\nICE9IG51bGwgfHwgYWxpYXNlcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAg\nICAgIHJvcCA9IG5ldyBQYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9w\nLCBwYWNrZXIsCiAgICAgICAgICAgICAgICAgICAgYWxpYXNlcy5sZW5ndGgp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgc2luZ2xlIHJlc3VsdCwgZXh0\ncmFjdCBpdAogICAgICAgIGlmIChfdW5pcXVlID09IEJvb2xlYW4uVFJVRSB8\nfCAoYWxpYXNlcy5sZW5ndGggPiAwCiAgICAgICAgICAgICYmICFleC5oYXNH\ncm91cGluZyhxKSAmJiBleC5pc0FnZ3JlZ2F0ZShxKSkpCiAgICAgICAgICAg\nIHJldHVybiBzaW5nbGVSZXN1bHQocm9wLCByYW5nZSk7CgogICAgICAgIC8v\nIG5vdyB0aGF0IHdlJ3ZlIGV4ZWN1dGVkIHRoZSBxdWVyeSwgd2UgY2FuIGNh\nbGwgaXNBZ2dyZWdhdGUgYW5kCiAgICAgICAgLy8gaGFzR3JvdXBpbmcgZWZm\naWNpZW50bHkKICAgICAgICBib29sZWFuIGRldGFjaCA9IChfYnJva2VyLmdl\ndEF1dG9EZXRhY2goKSAmCiAgICAgICAgICAgIEF1dG9EZXRhY2guREVUQUNI\nX05PTlRYUkVBRCkgPiAwICYmICFfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAg\nICAgYm9vbGVhbiBscnMgPSByYW5nZS5scnMgJiYgIWV4LmlzQWdncmVnYXRl\nKHEpICYmICFleC5oYXNHcm91cGluZyhxKTsKICAgICAgICBSZXN1bHRMaXN0\nIHJlcyA9ICghZGV0YWNoICYmIGxycykgPyBfZmMubmV3UmVzdWx0TGlzdChy\nb3ApCiAgICAgICAgICAgIDogbmV3IEVhZ2VyUmVzdWx0TGlzdChyb3ApOwoK\nICAgICAgICBfcmVzdWx0TGlzdHMuYWRkKGRlY29yYXRlUmVzdWx0TGlzdChy\nZXMpKTsKICAgICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8qKgogICAg\nICogT3B0aW9uYWxseSBkZWNvcmF0ZSB0aGUgbmF0aXZlIHJlc3VsdC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdExpc3QgZGVjb3JhdGVSZXN1bHRM\naXN0KFJlc3VsdExpc3QgcmVzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZW1v\ndmVPbkNsb3NlUmVzdWx0TGlzdChyZXMpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGEgcmVzdWx0IHBhY2tlciBmb3IgdGhpcyBwcm9qZWN0aW9u\nLCBvciBudWxsLgogICAgICovCiAgICBwcml2YXRlIFJlc3VsdFBhY2tlciBn\nZXRSZXN1bHRQYWNrZXIoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1\ndG9yIGV4KSB7CiAgICAgICAgaWYgKF9wYWNrZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIF9wYWNrZXI7CgogICAgICAgIENsYXNzIHJlc3VsdENs\nYXNzID0gKF9yZXN1bHRDbGFzcyAhPSBudWxsKSA/IF9yZXN1bHRDbGFzcwog\nICAgICAgICAgICA6IGV4LmdldFJlc3VsdENsYXNzKHEpOwogICAgICAgIGlm\nIChyZXN1bHRDbGFzcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgU3RyaW5nW10gYWxpYXNlcyA9IGV4LmdldFByb2plY3Rp\nb25BbGlhc2VzKHEpOwogICAgICAgIGlmIChhbGlhc2VzLmxlbmd0aCA9PSAw\nKSB7CiAgICAgICAgICAgIC8vIHJlc3VsdCBjbGFzcyBidXQgbm8gcmVzdWx0\nOyBtZWFucyBjYW5kaWRhdGUgaXMgYmVpbmcgc2V0CiAgICAgICAgICAgIC8v\nIGludG8gc29tZSByZXN1bHQgY2xhc3MKICAgICAgICAgICAgX3BhY2tlciA9\nIG5ldyBSZXN1bHRQYWNrZXIoX2NsYXNzLCBnZXRBbGlhcygpLCByZXN1bHRD\nbGFzcyk7CiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHRDbGFzcyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIHByb2plY3Rpb24KICAgICAgICAgICAgQ2xh\nc3NbXSB0eXBlcyA9IGV4LmdldFByb2plY3Rpb25UeXBlcyhxKTsKICAgICAg\nICAgICAgX3BhY2tlciA9IG5ldyBSZXN1bHRQYWNrZXIodHlwZXMsIGFsaWFz\nZXMsIHJlc3VsdENsYXNzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9w\nYWNrZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gZW1wdHkg\ncmVzdWx0IGZvciB0aGlzIHF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIE9i\namVjdCBlbXB0eVJlc3VsdChTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhl\nY3V0b3IgZXgpIHsKICAgICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRS\nVUUgfHwgKF91bmlxdWUgPT0gbnVsbAogICAgICAgICAgICAmJiAhZXguaGFz\nR3JvdXBpbmcocSkgJiYgZXguaXNBZ2dyZWdhdGUocSkpKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1Q\nVFlfTElTVDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgYW4gZXhw\nZWN0ZWQgc2luZ2xlIHJlc3VsdCBmcm9tIHRoZSBnaXZlbiBwcm92aWRlci4g\nVXNlZCB3aGVuCiAgICAgKiB0aGUgcmVzdWx0IGlzIGFuIHVuZ3JvdXBlZCBh\nZ2dyZWdhdGUgb3IgdGhlIHVuaXF1ZSBmbGFnIGlzIHNldCB0byB0cnVlLgog\nICAgICovCiAgICBwcml2YXRlIE9iamVjdCBzaW5nbGVSZXN1bHQoUmVzdWx0\nT2JqZWN0UHJvdmlkZXIgcm9wLCAKICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdl\nIHJhbmdlKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHJv\ncC5vcGVuKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbW92ZSB0\nbyBleHBlY3RlZCByZXN1bHQKICAgICAgICAgICAgYm9vbGVhbiBuZXh0ID0g\ncm9wLm5leHQoKTsKCiAgICAgICAgICAgIC8vIGV4dHJhY3Qgc2luZ2xlIHJl\nc3VsdDsgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIG11bHRpcGxlIHJlc3VsdHMK\nICAgICAgICAgICAgLy8gbWF0Y2ggYW5kIG5vdCBjb25zdHJhaW50ZWQgYnkg\ncmFuZ2UsIG9yIGlmIGEgdW5pcXVlIHF1ZXJ5IHdpdGgKICAgICAgICAgICAg\nLy8gbm8gcmVzdWx0cwogICAgICAgICAgICBPYmplY3Qgc2luZ2xlID0gbnVs\nbDsKICAgICAgICAgICAgaWYgKG5leHQpIHsKICAgICAgICAgICAgICAgIHNp\nbmdsZSA9IHJvcC5nZXRSZXN1bHRPYmplY3QoKTsKICAgICAgICAgICAgICAg\nIGlmIChyYW5nZS5lbmQgIT0gcmFuZ2Uuc3RhcnQgKyAxICYmIHJvcC5uZXh0\nKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJl\nc3VsdEV4Y2VwdGlvbihfbG9jLmdldCgibm90LXVuaXF1ZSIsCiAgICAgICAg\nICAgICAgICAgICAgICAgIF9jbGFzcywgX3F1ZXJ5KSk7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTm9SZXN1bHRFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLXJlc3VsdCIsIAogICAgICAgICAgICAgICAgICAgIF9jbGFzcywgX3F1\nZXJ5KSk7CgogICAgICAgICAgICAvLyBpZiB1bmlxdWUgc2V0IHRvIGZhbHNl\nLCB1c2UgY29sbGVjdGlvbgogICAgICAgICAgICBpZiAoX3VuaXF1ZSA9PSBC\nb29sZWFuLkZBTFNFKSB7CiAgICAgICAgICAgICAgICBpZiAoIW5leHQpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJ\nU1Q7CiAgICAgICAgICAgICAgICAvLyBDb2xsZWN0aW9ucy5zaW5nbGV0b25M\naXN0IGlzIEpESyAxLjMsIHNvLi4uCiAgICAgICAgICAgICAgICByZXR1cm4g\nQXJyYXlzLmFzTGlzdChuZXcgT2JqZWN0W117IHNpbmdsZSB9KTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gcmV0dXJuIHNp\nbmdsZSByZXN1bHQKICAgICAgICAgICAgcmV0dXJuIHNpbmdsZTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICByb3AuY2xvc2UoKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIHdoZXRoZXIg\ndGhlIGFjY2VzcyBwYXRoIG9mIHRoaXMgcXVlcnkgaW50ZXJzZWN0cyB3aXRo\nCiAgICAgKiBhbnkgZGlydHkgb2JqZWN0cyBpbiB0aGUgdHJhbnNhY3Rpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0FjY2Vzc1BhdGhEaXJ0\neSgpIHsKICAgICAgICByZXR1cm4gaXNBY2Nlc3NQYXRoRGlydHkoX2Jyb2tl\nciwgZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcygpKTsKICAgIH0KCiAgICBwdWJs\naWMgc3RhdGljIGJvb2xlYW4gaXNBY2Nlc3NQYXRoRGlydHkoQnJva2VyIGJy\nb2tlciwKICAgICAgICBDbGFzc01ldGFEYXRhW10gYWNjZXNzTWV0YXMpIHsK\nICAgICAgICBDb2xsZWN0aW9uIHBlcnNpc3RlZCA9IGJyb2tlci5nZXRQZXJz\naXN0ZWRUeXBlcygpOwogICAgICAgIENvbGxlY3Rpb24gdXBkYXRlZCA9IGJy\nb2tlci5nZXRVcGRhdGVkVHlwZXMoKTsKICAgICAgICBDb2xsZWN0aW9uIGRl\nbGV0ZWQgPSBicm9rZXIuZ2V0RGVsZXRlZFR5cGVzKCk7CiAgICAgICAgaWYg\nKHBlcnNpc3RlZC5pc0VtcHR5KCkgJiYgdXBkYXRlZC5pc0VtcHR5KCkgJiYg\nZGVsZXRlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgLy8gaWYgbm8gYWNjZXNzIG1ldGFzLCBhc3N1bWUgZXZlcnkg\nZGlydHkgb2JqZWN0IGFmZmVjdHMgcGF0aCBqdXN0CiAgICAgICAgLy8gdG8g\nYmUgc2FmZQogICAgICAgIGlmIChhY2Nlc3NNZXRhcy5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIGNvbXBhcmUg\nZGlydHkgY2xhc3NlcyB0byB0aGUgYWNjZXNzIHBhdGggY2xhc3NlcwogICAg\nICAgIENsYXNzIGFjY0NsYXNzOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYWNjZXNzTWV0YXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8g\nc2hvcnRjdXQgaWYgYWN0dWFsIGNsYXNzIGlzIGRpcnR5CiAgICAgICAgICAg\nIGFjY0NsYXNzID0gYWNjZXNzTWV0YXNbaV0uZ2V0RGVzY3JpYmVkVHlwZSgp\nOwogICAgICAgICAgICBpZiAocGVyc2lzdGVkLmNvbnRhaW5zKGFjY0NsYXNz\nKSB8fCB1cGRhdGVkLmNvbnRhaW5zKGFjY0NsYXNzKQogICAgICAgICAgICAg\nICAgfHwgZGVsZXRlZC5jb250YWlucyhhY2NDbGFzcykpCiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBk\naXJ0eSBzdWJjbGFzcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5\nID0gcGVyc2lzdGVkLml0ZXJhdG9yKCk7IGRpcnR5Lmhhc05leHQoKTspCiAg\nICAgICAgICAgICAgICBpZiAoYWNjQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgo\nQ2xhc3MpIGRpcnR5Lm5leHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgZGlydHkgPSB1\ncGRhdGVkLml0ZXJhdG9yKCk7IGRpcnR5Lmhhc05leHQoKTspCiAgICAgICAg\nICAgICAgICBpZiAoYWNjQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgoQ2xhc3Mp\nIGRpcnR5Lm5leHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgZGlydHkgPSBkZWxldGVk\nLml0ZXJhdG9yKCk7IGRpcnR5Lmhhc05leHQoKTspCiAgICAgICAgICAgICAg\nICBpZiAoYWNjQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgoQ2xhc3MpIGRpcnR5\nLm5leHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQoKICAgICAgICAvLyBubyBpbnRlcnNlY3Rpb24KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2VBbGwo\nKSB7CiAgICAgICAgY2xvc2VSZXN1bHRzKHRydWUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGNsb3NlUmVzb3VyY2VzKCkgewogICAgICAgIGNsb3NlUmVz\ndWx0cyhmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZSBvcGVu\nIHJlc3VsdHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjbG9zZVJlc3Vs\ndHMoYm9vbGVhbiBmb3JjZSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBS\nZW1vdmVPbkNsb3NlUmVzdWx0TGlzdCByZXM7CiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX3Jlc3VsdExpc3RzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICByZXMgPSAoUmVtb3ZlT25D\nbG9zZVJlc3VsdExpc3QpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAoZm9yY2UgfHwgcmVzLmlzUHJvdmlkZXJPcGVuKCkpCiAgICAgICAgICAg\nICAgICAgICAgcmVzLmNsb3NlKGZhbHNlKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBfcmVzdWx0TGlzdHMuY2xlYXIoKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlvbnMoTWFwIHBh\ncmFtcykgewogICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkKICAgICAgICAg\nICAgcGFyYW1zID0gQ29sbGVjdGlvbnMuRU1QVFlfTUFQOwoKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm90U2Vy\naWFsaXplZCgpOwogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAg\nICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gY29tcGlsZUZvckV4ZWN1\ndG9yKCk7CiAgICAgICAgICAgIE9iamVjdFtdIGFyciA9IHRvUGFyYW1ldGVy\nQXJyYXkoZXguZ2V0UGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpLAogICAg\nICAgICAgICAgICAgcGFyYW1zKTsKICAgICAgICAgICAgYXNzZXJ0UGFyYW1l\ndGVycyhfc3RvcmVRdWVyeSwgZXgsIGFycik7CiAgICAgICAgICAgIFN0b3Jl\nUXVlcnkuUmFuZ2UgcmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZShfc3Rh\ncnRJZHgsIF9lbmRJZHgpOwogICAgICAgICAgICBpZiAoIV9yYW5nZVNldCkK\nICAgICAgICAgICAgICAgIGV4LmdldFJhbmdlKF9zdG9yZVF1ZXJ5LCBhcnIs\nIHJhbmdlKTsKICAgICAgICAgICAgcmV0dXJuIGV4LmdldERhdGFTdG9yZUFj\ndGlvbnMoX3N0b3JlUXVlcnksIGFyciwgcmFuZ2UpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIHNldFF1ZXJ5KE9iamVjdCBxdWVyeSkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7Cgog\nICAgICAgICAgICBpZiAocXVlcnkgPT0gbnVsbCB8fCBxdWVyeSBpbnN0YW5j\nZW9mIFN0cmluZykgewogICAgICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBp\nbGF0aW9uKCk7CiAgICAgICAgICAgICAgICBfcXVlcnkgPSAoU3RyaW5nKSBx\ndWVyeTsKICAgICAgICAgICAgICAgIGlmIChfcXVlcnkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBfcXVlcnkgPSBfcXVlcnkudHJpbSgpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKCEocXVlcnkgaW5zdGFuY2VvZiBRdWVyeUltcGwpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5LnNldFF1ZXJ5KHF1ZXJ5\nKTsKCiAgICAgICAgICAgIC8vIGNvcHkgYWxsIG5vbi10cmFuc2llbnQgc3Rh\ndGUgZnJvbSB0aGUgZ2l2ZW4gcXVlcnkKICAgICAgICAgICAgaW52YWxpZGF0\nZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgIFF1ZXJ5SW1wbCBxID0gKFF1\nZXJ5SW1wbCkgcXVlcnk7CiAgICAgICAgICAgIF9jbGFzcyA9IHEuX2NsYXNz\nOwogICAgICAgICAgICBfc3ViY2xhc3NlcyA9IHEuX3N1YmNsYXNzZXM7CiAg\nICAgICAgICAgIF9xdWVyeSA9IHEuX3F1ZXJ5OwogICAgICAgICAgICBfaWdu\nb3JlQ2hhbmdlcyA9IHEuX2lnbm9yZUNoYW5nZXM7CiAgICAgICAgICAgIF91\nbmlxdWUgPSBxLl91bmlxdWU7CiAgICAgICAgICAgIF9yZXN1bHRDbGFzcyA9\nIHEuX3Jlc3VsdENsYXNzOwogICAgICAgICAgICBfcGFyYW1zID0gcS5fcGFy\nYW1zOwogICAgICAgICAgICBfcmVzdWx0TWFwcGluZ1Njb3BlID0gcS5fcmVz\ndWx0TWFwcGluZ1Njb3BlOwogICAgICAgICAgICBfcmVzdWx0TWFwcGluZ05h\nbWUgPSBxLl9yZXN1bHRNYXBwaW5nTmFtZTsKICAgICAgICAgICAgX3JlYWRP\nbmx5ID0gcS5fcmVhZE9ubHk7CgogICAgICAgICAgICAvLyBkb24ndCBzaGFy\nZSBtdXRhYmxlIG9iamVjdHMKICAgICAgICAgICAgX2ZjLmNvcHkocS5fZmMp\nOwogICAgICAgICAgICBpZiAocS5fZmlsdExpc3RlbmVycyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2ZpbHRMaXN0ZW5lcnMgPSBuZXcgSGFzaE1hcChx\nLl9maWx0TGlzdGVuZXJzKTsKICAgICAgICAgICAgaWYgKHEuX2FnZ0xpc3Rl\nbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FnZ0xpc3RlbmVycyA9\nIG5ldyBIYXNoTWFwKHEuX2FnZ0xpc3RlbmVycyk7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndEFsaWFzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdHJpbmcgYWxpYXMgPSBjb21waWxlRm9yRXhlY3V0b3IoKS5n\nZXRBbGlhcyhfc3RvcmVRdWVyeSk7CiAgICAgICAgICAgIGlmIChhbGlhcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgYWxpYXMgPSBTdHJpbmdzLmdldENs\nYXNzTmFtZShfY2xhc3MpOwogICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRQcm9qZWN0aW9u\nQWxpYXNlcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdldFByb2pl\nY3Rpb25BbGlhc2VzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIENsYXNzW10gZ2V0UHJvamVjdGlvblR5cGVzKCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29t\ncGlsZUZvckV4ZWN1dG9yKCkuZ2V0UHJvamVjdGlvblR5cGVzKF9zdG9yZVF1\nZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRPcGVyYXRp\nb24oKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5nZXRPcGVyYXRpb24o\nX3N0b3JlUXVlcnkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0FnZ3JlZ2F0ZSgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmlz\nQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaGFzR3JvdXBpbmcoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9yRXhl\nY3V0b3IoKS5oYXNHcm91cGluZyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0QWNjZXNzUGF0aE1l\ndGFEYXRhcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gY29tcGlsZUZvckV4\nZWN1dG9yKCkuCiAgICAgICAgICAgICAgICBnZXRBY2Nlc3NQYXRoTWV0YURh\ndGFzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICAgICAgcmV0dXJuIChtZXRhcyA9\nPSBudWxsKSA/IFN0b3JlUXVlcnkuRU1QVFlfTUVUQVMgOiBtZXRhczsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIExpbmtlZE1hcCBnZXRQYXJhbWV0ZXJU\neXBlcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdldFBhcmFtZXRl\nclR5cGVzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIE1hcCBnZXRVcGRhdGVzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCku\nZ2V0VXBkYXRlcyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9icm9rZXIgPT0gbnVs\nbCB8fCBfYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSkKICAgICAgICAgICAg\nX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygp\nIHsKICAgICAgICBpZiAoX2xvY2suaXNMb2NrZWQoKSkKICAgICAgICAgICAg\nX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBV\ndGlscwogICAgLy8vLy8vLy8vCgogICAgcHVibGljIENsYXNzIGNsYXNzRm9y\nTmFtZShTdHJpbmcgbmFtZSwgU3RyaW5nW10gaW1wb3J0cykgewogICAgICAg\nIC8vIGZ1bGwgY2xhc3MgbmFtZSBvciBwcmltaXRpdmUgdHlwZT8KICAgICAg\nICBDbGFzcyB0eXBlID0gdG9DbGFzcyhuYW1lKTsKICAgICAgICBpZiAodHlw\nZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHlwZTsKCiAgICAgICAg\nLy8gZmlyc3QgY2hlY2sgdGhlIGFsaWFzZXMgbWFwIGluIHRoZSBNZXRhRGF0\nYVJlcG9zaXRvcnkKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSAoX2Ns\nYXNzID09IG51bGwpID8gX2xvYWRlcgogICAgICAgICAgICA6IChDbGFzc0xv\nYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihf\nY2xhc3MpKTsgCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2Jyb2tl\nci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0TWV0YURhdGEobmFtZSwgbG9hZGVy\nLCBmYWxzZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwoKICAgICAgICAv\nLyB0cnkgdGhlIG5hbWUgaW4gdGhlIHBhY2thZ2Ugb2YgdGhlIGNhbmRpZGF0\nZSBjbGFzcwogICAgICAgIGlmIChfY2xhc3MgIT0gbnVsbCkgewogICAgICAg\nICAgICBTdHJpbmcgZnVsbE5hbWUgPSBfY2xhc3MuZ2V0TmFtZSgpLnN1YnN0\ncmluZwogICAgICAgICAgICAgICAgKDAsIF9jbGFzcy5nZXROYW1lKCkubGFz\ndEluZGV4T2YoJy4nKSArIDEpICsgbmFtZTsKICAgICAgICAgICAgdHlwZSA9\nIHRvQ2xhc3MoZnVsbE5hbWUpOwogICAgICAgICAgICBpZiAodHlwZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgICAgfQoK\nICAgICAgICAvLyB0cnkgamF2YS5sYW5nCiAgICAgICAgdHlwZSA9IHRvQ2xh\nc3MoImphdmEubGFuZy4iICsgbmFtZSk7CiAgICAgICAgaWYgKHR5cGUgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHR5cGU7CgogICAgICAgIC8vIHRy\neSBlYWNoIGltcG9ydAogICAgICAgIGlmIChpbXBvcnRzICE9IG51bGwgJiYg\naW1wb3J0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIFN0cmluZyBkb3RO\nYW1lID0gIi4iICsgbmFtZTsKICAgICAgICAgICAgU3RyaW5nIGltcG9ydE5h\nbWU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW1wb3J0cy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaW1wb3J0TmFtZSA9IGlt\ncG9ydHNbaV07CgogICAgICAgICAgICAgICAgLy8gZnVsbCBjbGFzcyBuYW1l\nIGltcG9ydAogICAgICAgICAgICAgICAgaWYgKGltcG9ydE5hbWUuZW5kc1dp\ndGgoZG90TmFtZSkpCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRvQ2xh\nc3MoaW1wb3J0TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgLy8gd2lsZGNh\ncmQ7IHN0cmlwIHRvIHBhY2thZ2UKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKGltcG9ydE5hbWUuZW5kc1dpdGgoIi4qIikpIHsKICAgICAgICAgICAgICAg\nICAgICBpbXBvcnROYW1lID0gaW1wb3J0TmFtZS5zdWJzdHJpbmcKICAgICAg\nICAgICAgICAgICAgICAgICAgKDAsIGltcG9ydE5hbWUubGVuZ3RoKCkgLSAx\nKTsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gdG9DbGFzcyhpbXBvcnRO\nYW1lICsgbmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBpZiAodHlwZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB0eXBlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB7QGxp\nbmsgQ2xhc3N9IGZvciB0aGUgZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBuYW1l\nIG5vdCB2YWxpZC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzcyB0b0NsYXNz\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9sb2FkZXIgPT0gbnVsbCkK\nICAgICAgICAgICAgX2xvYWRlciA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlv\nbigpLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAg\nICAgZ2V0Q2xhc3NMb2FkZXIoX2NsYXNzLCBfYnJva2VyLmdldENsYXNzTG9h\nZGVyKCkpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBTdHJp\nbmdzLnRvQ2xhc3MobmFtZSwgX2xvYWRlcik7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIH0gY2F0Y2ggKE5vQ2xh\nc3NEZWZGb3VuZEVycm9yIG5jZGZlKSB7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE9wZW4o\nKSB7CiAgICAgICAgaWYgKF9icm9rZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nX2Jyb2tlci5hc3NlcnRPcGVuKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nYXNzZXJ0Tm90UmVhZE9ubHkoKSB7CiAgICAgICAgaWYgKF9yZWFkT25seSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgicmVhZC1vbmx5IikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE5vdFNlcmlhbGl6ZWQoKSB7CiAgICAgICAgaWYgKF9icm9rZXIg\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgic2VyaWFsaXplZCIpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENoZWNrIHRoYXQgYSBjYW5kaWRhdGUgY2xhc3MgaGFzIGJl\nZW4gc2V0IGZvciB0aGUgcXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhc3NlcnRDYW5kaWRhdGVUeXBlKCkgewogICAgICAgIGlmIChfY2xhc3Mg\nPT0gbnVsbCAmJiBfc3RvcmVRdWVyeS5yZXF1aXJlc0NhbmRpZGF0ZVR5cGUo\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tY2xhc3MiKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDaGVjayB0aGF0IHdlIGFyZSBpbiBhIHN0YXRlIHRvIGJlIGFibGUgdG8g\ncGVyZm9ybSBhIGJ1bGsgb3BlcmF0aW9uOwogICAgICogYWxzbyBmbHVzaCB0\naGUgY3VycmVudCBtb2RmaWNhdGlvbnMgaWYgYW55IGVsZW1lbnRzIGFyZSBj\ndXJyZW50bHkgZGlydHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3Nl\ncnRCdWxrTW9kaWZ5KFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRv\nciBleCwgCiAgICAgICAgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgX2Jy\nb2tlci5hc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAgICAgIGlmIChf\nc3RhcnRJZHggIT0gMCB8fCBfZW5kSWR4ICE9IExvbmcuTUFYX1ZBTFVFKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tbW9kaWZ5LXJhbmdlIikpOwogICAgICAgIGlmIChfcmVzdWx0Q2xhc3Mg\nIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLW1vZGlmeS1yZXN1bHRjbGFzcyIpKTsKICAgICAgICBT\ndG9yZVF1ZXJ5LlJhbmdlIHJhbmdlID0gbmV3IFN0b3JlUXVlcnkuUmFuZ2Uo\nKTsKICAgICAgICBleC5nZXRSYW5nZShxLCBwYXJhbXMsIHJhbmdlKTsKICAg\nICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gMCB8fCByYW5nZS5lbmQgIT0gTG9u\nZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1tb2RpZnktcmFuZ2UiKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDaGVja3MgdGhhdCB0aGUgcGFzc2VkIHBhcmFtZXRlcnMg\nbWF0Y2ggdGhlIGRlY2xhcmF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgYXNzZXJ0UGFyYW1ldGVycyhTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVl\ncnkuRXhlY3V0b3IgZXgsIAogICAgICAgIE9iamVjdFtdIHBhcmFtcykgewog\nICAgICAgIGlmICghcS5yZXF1aXJlc1BhcmFtZXRlckRlY2xhcmF0aW9ucygp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIExpbmtlZE1hcCBwYXJh\nbVR5cGVzID0gZXguZ2V0UGFyYW1ldGVyVHlwZXMocSk7CiAgICAgICAgaW50\nIHR5cGVDb3VudCA9IHBhcmFtVHlwZXMuc2l6ZSgpOwogICAgICAgIGlmICh0\neXBlQ291bnQgPiBwYXJhbXMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidW5ib3VuZC1wYXJhbXMiLAog\nICAgICAgICAgICAgICAgcGFyYW1UeXBlcy5rZXlTZXQoKSkpOwoKICAgICAg\nICBJdGVyYXRvciBpdHIgPSBwYXJhbVR5cGVzLmVudHJ5U2V0KCkuaXRlcmF0\nb3IoKTsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGl0ci5oYXNOZXh0KCk7IGkrKykgewogICAgICAgICAgICBl\nbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlm\nICgoKENsYXNzKSBlbnRyeS5nZXRWYWx1ZSgpKS5pc1ByaW1pdGl2ZSgpICYm\nIHBhcmFtc1tpXSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtcHJpbWl0aXZlLXBhcmFt\nIiwKICAgICAgICAgICAgICAgICAgICBlbnRyeS5nZXRLZXkoKSkpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewog\nICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKDY0\nKTsKICAgICAgICBidWYuYXBwZW5kKCJRdWVyeTogIikuYXBwZW5kKHN1cGVy\nLnRvU3RyaW5nKCkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIjsgY2FuZGlkYXRl\nIGNsYXNzOiAiKS5hcHBlbmQoX2NsYXNzKTsKICAgICAgICBidWYuYXBwZW5k\nKCI7IHF1ZXJ5OiAiKS5hcHBlbmQoX3F1ZXJ5KTsKICAgICAgICByZXR1cm4g\nYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJ1Y3Qg\nb2YgY29tcGlsZWQgcXVlcnkgcHJvcGVydGllcy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHN0YXRpYyBjbGFzcyBDb21waWxhdGlvbiB7CgogICAgICAgIHB1\nYmxpYyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIG1lbW9yeSA9IG51bGw7CiAgICAg\nICAgcHVibGljIFN0b3JlUXVlcnkuRXhlY3V0b3IgZGF0YXN0b3JlID0gbnVs\nbDsKICAgICAgICBwdWJsaWMgT2JqZWN0IHN0b3JlRGF0YSA9IG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTdHJ1Y3QgdG8gaG9sZCB0aGUgdW5wYXJz\nZWQgcHJvcGVydGllcyBhc3NvY2lhdGVkIHdpdGggYSBxdWVyeS4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ29tcGlsYXRpb25LZXkKICAg\nICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1Ymxp\nYyBDbGFzcyBxdWVyeVR5cGUgPSBudWxsOwogICAgICAgIHB1YmxpYyBDbGFz\ncyBjYW5kaWRhdGVUeXBlID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBzdWJjbGFzc2VzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgU3RyaW5nIHF1\nZXJ5ID0gbnVsbDsKICAgICAgICBwdWJsaWMgU3RyaW5nIGxhbmd1YWdlID0g\nbnVsbDsKICAgICAgICBwdWJsaWMgT2JqZWN0IHN0b3JlS2V5ID0gbnVsbDsK\nCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAg\naW50IHJzID0gMTc7CiAgICAgICAgICAgIHJzID0gMzcgKiBycyArICgocXVl\ncnlUeXBlID09IG51bGwpID8gMCA6IHF1ZXJ5VHlwZS5oYXNoQ29kZSgpKTsK\nICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChxdWVyeSA9PSBudWxsKSA/\nIDAgOiBxdWVyeS5oYXNoQ29kZSgpKTsKICAgICAgICAgICAgcnMgPSAzNyAq\nIHJzICsgKChsYW5ndWFnZSA9PSBudWxsKSA/IDAgOiBsYW5ndWFnZS5oYXNo\nQ29kZSgpKTsKICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChzdG9yZUtl\neSA9PSBudWxsKSA/IDAgOiBzdG9yZUtleS5oYXNoQ29kZSgpKTsKICAgICAg\nICAgICAgcmV0dXJuIHJzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgICAgICBpZiAo\nb3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBpZiAob3RoZXIgPT0gbnVsbCB8fCBvdGhlci5nZXRDbGFz\ncygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgICAgICBDb21waWxhdGlvbktleSBrZXkgPSAoQ29tcGls\nYXRpb25LZXkpIG90aGVyOwogICAgICAgICAgICBpZiAoa2V5LnF1ZXJ5VHlw\nZSAhPSBxdWVyeVR5cGUKICAgICAgICAgICAgICAgIHx8ICFTdHJpbmdVdGls\ncy5lcXVhbHMoa2V5LnF1ZXJ5LCBxdWVyeSkKICAgICAgICAgICAgICAgIHx8\nICFTdHJpbmdVdGlscy5lcXVhbHMoa2V5Lmxhbmd1YWdlLCBsYW5ndWFnZSkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICBp\nZiAoIU9iamVjdFV0aWxzLmVxdWFscyhrZXkuc3RvcmVLZXksIHN0b3JlS2V5\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAg\nIC8vIGFsbG93IGVpdGhlciBjYW5kaWRhdGUgdHlwZSB0byBiZSBudWxsIGJl\nY2F1c2UgaXQgbWlnaHQgYmUKICAgICAgICAgICAgLy8gZW5jb2RlZCBpbiB0\naGUgcXVlcnkgc3RyaW5nLCBidXQgaWYgYm90aCBhcmUgc2V0IHRoZW4gdGhl\neQogICAgICAgICAgICAvLyBtdXN0IGJlIGVxdWFsCiAgICAgICAgICAgIGlm\nIChjYW5kaWRhdGVUeXBlICE9IG51bGwgJiYga2V5LmNhbmRpZGF0ZVR5cGUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBjYW5kaWRhdGVUeXBl\nID09IGtleS5jYW5kaWRhdGVUeXBlCiAgICAgICAgICAgICAgICAgICAgJiYg\nc3ViY2xhc3NlcyA9PSBrZXkuc3ViY2xhc3NlczsKCiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEg\nbWVyZ2VkIGV4ZWN1dG9yIGV4ZWN1dGVzIG11bHRpcGxlIFF1ZXJpZXMgYW5k\nIHJldHVybnMKICAgICAqIGEgbWVyZ2VkIHJlc3VsdCBsaXN0IHdpdGggdGhl\nIGFwcHJvcHJpYXRlIG9yZGVyaW5nIChpZiBtb3JlIHRoYW4KICAgICAqIG9u\nZSBxdWVyeSBuZWVkcyB0byBiZSBleGVjdXRlZCkuIFRoaXMgZXhlY3V0b3Ig\naGFzIHRoZSBmb2xsb3dpbmcKICAgICAqIGxpbWl0YXRpb25zOgogICAgICog\nPHVsPgogICAgICogPGxpPkl0IGNhbm5vdCBjb21iaW5lIGFnZ3JlZ2F0ZXMu\nCiAgICAgKiA8bGk+SXQgY2Fubm90IGNvbGxhdGUgdGhlIHJlc3VsdCBsaXN0\ncyBpZiBvcmRlcmluZyBpcyBzcGVjaWZpZWQgYW5kCiAgICAgKiBhIHJlc3Vs\ndCBzdHJpbmcgaXMgZ2l2ZW4sIGJ1dCBkb2VzIG5vdCBpbmNsdWRlIHRoZSBv\ncmRlcmluZwogICAgICogY3JpdGVyaWEuPC9saT4KICAgICAqIDxsaT5JdCBj\nYW5ub3QgZmlsdGVyIGR1cGxpY2F0ZSByZXN1bHRzIGZyb20gZGlmZmVyZW50\nIHJlc3VsdCBsaXN0cyBpZgogICAgICogdGhlIHJlc3VsdCBpcyBtYXJrZWQg\nZGlzdGluY3QuIFRoaXMgd291bGQgcmVxdWlyZSB0cmFja2luZyBhbGwKICAg\nICAqIHByZXZpb3VzIHJlc3VsdHMsIHdoaWNoIHdvdWxkIGludGVyZmVyZSB3\naXRoIGxhcmdlIHJlc3VsdCBzZXQKICAgICAqIGhhbmRsaW5nLjwvbGk+CiAg\nICAgKiA8L3VsPgogICAgICoKICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hv\nbW1lYXV4CiAgICAgKiBAbm9qYXZhZG9jCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIE1lcmdlZEV4ZWN1dG9yCiAgICAgICAgaW1wbGVtZW50\ncyBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yW10gX2V4ZWN1dG9yczsKCiAgICAgICAg\ncHVibGljIE1lcmdlZEV4ZWN1dG9yKFN0b3JlUXVlcnkuRXhlY3V0b3JbXSBl\neGVjdXRvcnMpIHsKICAgICAgICAgICAgX2V4ZWN1dG9ycyA9IGV4ZWN1dG9y\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92\naWRlciBleGVjdXRlUXVlcnkoU3RvcmVRdWVyeSBxLAogICAgICAgICAgICBP\nYmplY3RbXSBwYXJhbXMsIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UpIHsKICAg\nICAgICAgICAgaWYgKF9leGVjdXRvcnMubGVuZ3RoID09IDEpCiAgICAgICAg\nICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5leGVjdXRlUXVlcnkocSwg\ncGFyYW1zLCByYW5nZSk7CgogICAgICAgICAgICAvLyB1c2UgbHJzIHNldHRp\nbmdzIGlmIHdlIGNvdWxkbid0IHRha2UgYWR2YW50YWdlIG9mIHRoZSBzdGFy\ndCBpbmRleAogICAgICAgICAgICAvLyBzbyB0aGF0IGhvcGVmdWxseSB0aGUg\nc2tpcCB0byB0aGUgc3RhcnQgd2lsbCBiZSBlZmZpY2llbnQKICAgICAgICAg\nICAgU3RvcmVRdWVyeS5SYW5nZSByb3BSYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5\nLlJhbmdlKDAsIHJhbmdlLmVuZCk7CiAgICAgICAgICAgIHJvcFJhbmdlLmxy\ncyA9IHJhbmdlLmxycyB8fCAocmFuZ2Uuc3RhcnQgPiAwICYmIHEuZ2V0Q29u\ndGV4dCgpLgogICAgICAgICAgICAgICAgZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCkuZ2V0RmV0Y2hCYXRjaFNpemUoKSA+PSAwKTsKCiAgICAgICAgICAgIC8v\nIGV4ZWN1dGUgdGhlIHF1ZXJ5OyB3ZSBjYW5ub3QgdXNlIHRoZSBsb3dlciBi\nb3VuZCBvZiB0aGUgcmVzdWx0CiAgICAgICAgICAgIC8vIHJhbmdlLCBidXQg\nd2UgY2FuIHRha2UgYWR2YW50YWdlIG9mIHRoZSB1cHBlciBib3VuZAogICAg\nICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlcltdIHJvcHMgPQogICAgICAg\nICAgICAgICAgbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW19leGVjdXRvcnMu\nbGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhl\nY3V0b3JzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgcm9wc1tpXSA9\nIF9leGVjdXRvcnNbaV0uZXhlY3V0ZVF1ZXJ5KHEsIHBhcmFtcywgcm9wUmFu\nZ2UpOwoKICAgICAgICAgICAgYm9vbGVhbltdIGFzYyA9IF9leGVjdXRvcnNb\nMF0uZ2V0QXNjZW5kaW5nKHEpOwogICAgICAgICAgICBSZXN1bHRPYmplY3RQ\ncm92aWRlciByb3A7CiAgICAgICAgICAgIGlmIChhc2MubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgTWVyZ2VkUmVzdWx0T2JqZWN0\nUHJvdmlkZXIocm9wcyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHJvcCA9IG5ldyBPcmRlcmluZ01lcmdlZFJlc3VsdE9iamVjdFByb3Zp\nZGVyKHJvcHMsIGFzYywKICAgICAgICAgICAgICAgICAgICBfZXhlY3V0b3Jz\nLCBxLCBwYXJhbXMpOwoKICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSBs\nb3dlciBib3VuZCwgd3JhcCBpbiByYW5nZSByb3AKICAgICAgICAgICAgaWYg\nKHJhbmdlLnN0YXJ0ICE9IDApCiAgICAgICAgICAgICAgICByb3AgPSBuZXcg\nUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIHJhbmdlLnN0YXJ0LCAK\nICAgICAgICAgICAgICAgICAgICByYW5nZS5lbmQpOwogICAgICAgICAgICBy\nZXR1cm4gcm9wOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE51bWJlciBl\neGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7\nCiAgICAgICAgICAgIGxvbmcgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZURlbGV0ZShx\nLCBwYXJhbXMpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICByZXR1cm4gTnVt\nYmVycy52YWx1ZU9mKG51bSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nTnVtYmVyIGV4ZWN1dGVVcGRhdGUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBw\nYXJhbXMpIHsKICAgICAgICAgICAgbG9uZyBudW0gPSAwOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBudW0gKz0gX2V4ZWN1dG9yc1tpXS5leGVjdXRl\nVXBkYXRlKHEsIHBhcmFtcykubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgIHJl\ndHVybiBOdW1iZXJzLnZhbHVlT2YobnVtKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKFN0b3JlUXVl\ncnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBTdG9yZVF1ZXJ5\nLlJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIGlmIChfZXhlY3V0b3JzLmxl\nbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNb\nMF0uZ2V0RGF0YVN0b3JlQWN0aW9ucyhxLCBwYXJhbXMsIHJhbmdlKTsKCiAg\nICAgICAgICAgIExpc3QgcmVzdWx0cyA9IG5ldyBBcnJheUxpc3QoX2V4ZWN1\ndG9ycy5sZW5ndGgpOwogICAgICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJv\ncFJhbmdlID0gbmV3IFN0b3JlUXVlcnkuUmFuZ2UoMEwsIHJhbmdlLmVuZCk7\nCiAgICAgICAgICAgIFN0cmluZ1tdIGFjdGlvbnM7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgYWN0aW9ucyA9IF9leGVjdXRvcnNbaV0uZ2V0RGF0\nYVN0b3JlQWN0aW9ucyhxLCBwYXJhbXMscm9wUmFuZ2UpOwogICAgICAgICAg\nICAgICAgaWYgKGFjdGlvbnMgIT0gbnVsbCAmJiBhY3Rpb25zLmxlbmd0aCA+\nIDApCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChhY3Rpb25zKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIChTdHJpbmdbXSkgcmVzdWx0cy50b0FycmF5KG5ldyBTdHJpbmdb\ncmVzdWx0cy5zaXplKCldKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHZhbGlkYXRlKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBfZXhl\nY3V0b3JzWzBdLnZhbGlkYXRlKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgZ2V0UmFuZ2UoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJh\nbXMsIAogICAgICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKSB7CiAg\nICAgICAgICAgIF9leGVjdXRvcnNbMF0uZ2V0UmFuZ2UocSwgcGFyYW1zLCBy\nYW5nZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldE9y\nZGVyaW5nVmFsdWUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMsCiAg\nICAgICAgICAgIE9iamVjdCByZXN1bHRPYmplY3QsIGludCBpZHgpIHsKICAg\nICAgICAgICAgLy8gdW5mb3J0dW5hdGVseSwgYXQgdGhpcyBwb2ludCAobXVz\ndCBiZSBhIG1lcmdlZCByb3AgY29udGFpbmluZwogICAgICAgICAgICAvLyBv\ndGhlciBtZXJnZWQgcm9wcykgd2UgaGF2ZSBubyBpZGVhIHdoaWNoIGV4ZWN1\ndG9yIHRvIGV4dHJhY3QKICAgICAgICAgICAgLy8gdGhlIHZhbHVlIGZyb20K\nICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0T3JkZXJpbmdW\nYWx1ZShxLCBwYXJhbXMsIHJlc3VsdE9iamVjdCwgaWR4KTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuW10gZ2V0QXNjZW5kaW5nKFN0b3Jl\nUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5n\nZXRBc2NlbmRpbmcocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nIGdldEFsaWFzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1\ncm4gX2V4ZWN1dG9yc1swXS5nZXRBbGlhcyhxKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRQcm9qZWN0aW9uQWxpYXNlcyhTdG9y\nZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0u\nZ2V0UHJvamVjdGlvbkFsaWFzZXMocSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgQ2xhc3MgZ2V0UmVzdWx0Q2xhc3MoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFJlc3VsdENsYXNz\nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENsYXNzW10gZ2V0UHJv\namVjdGlvblR5cGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1\ncm4gX2V4ZWN1dG9yc1swXS5nZXRQcm9qZWN0aW9uVHlwZXMocSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1BhY2tpbmcoU3RvcmVR\ndWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmlz\nUGFja2luZyhxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDbGFzc01l\ndGFEYXRhW10gZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhTdG9yZVF1ZXJ5IHEp\nIHsKICAgICAgICAgICAgaWYgKF9leGVjdXRvcnMubGVuZ3RoID09IDEpCiAg\nICAgICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRBY2Nlc3NQ\nYXRoTWV0YURhdGFzKHEpOwoKICAgICAgICAgICAgLy8gY3JlYXRlIHNldCBv\nZiBiYXNlIGNsYXNzIG1ldGFkYXRhcyBpbiBhY2Nlc3MgcGF0aAogICAgICAg\nICAgICBMaXN0IG1ldGFzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgbWV0YXMgPSBGaWx0ZXJzLmFkZEFjY2Vzc1BhdGhNZXRhRGF0YXMo\nbWV0YXMsIF9leGVjdXRvcnNbaV0uCiAgICAgICAgICAgICAgICAgICAgZ2V0\nQWNjZXNzUGF0aE1ldGFEYXRhcyhxKSk7CiAgICAgICAgICAgIGlmIChtZXRh\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIFN0b3JlUXVlcnku\nRU1QVFlfTUVUQVM7CiAgICAgICAgICAgIHJldHVybiAoQ2xhc3NNZXRhRGF0\nYVtdKSBtZXRhcy50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IENsYXNz\nTWV0YURhdGFbbWV0YXMuc2l6ZSgpXSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZShTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgaWYgKCFfZXhlY3V0b3JzWzBdLmlzQWdncmVnYXRlKHEpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgLy8g\nd2UgY2FuJ3QgbWVyZ2UgYWdncmVnYXRlcwogICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoIm1lcmdlZC1hZ2dy\nZWdhdGUiLAogICAgICAgICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0Q2Fu\nZGlkYXRlVHlwZSgpLAogICAgICAgICAgICAgICAgcS5nZXRDb250ZXh0KCku\nZ2V0UXVlcnlTdHJpbmcoKSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBnZXRPcGVyYXRpb24oU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAg\nIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldE9wZXJhdGlvbihxKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc0dyb3VwaW5nKFN0b3Jl\nUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5o\nYXNHcm91cGluZyhxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBMaW5r\nZWRNYXAgZ2V0UGFyYW1ldGVyVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAg\nICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFBhcmFtZXRlclR5cGVz\nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE1hcCBnZXRVcGRhdGVz\nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9y\nc1swXS5nZXRVcGRhdGVzKHEpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJlc3VsdCBvYmplY3QgcHJvdmlkZXIgdGhhdCBwYWNrcyByZXN1\nbHRzIGJlZm9yZSByZXR1cm5pbmcgdGhlbS4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgY2xhc3MgUGFja2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyCiAg\nICAgICAgaW1wbGVtZW50cyBSZXN1bHRPYmplY3RQcm92aWRlciB7CgogICAg\nICAgIHByaXZhdGUgZmluYWwgUmVzdWx0T2JqZWN0UHJvdmlkZXIgX2RlbGVn\nYXRlOwogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0UGFja2VyIF9wYWNr\nZXI7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2xlbjsKCiAgICAgICAg\ncHVibGljIFBhY2tpbmdSZXN1bHRPYmplY3RQcm92aWRlcihSZXN1bHRPYmpl\nY3RQcm92aWRlciBkZWxlZ2F0ZSwKICAgICAgICAgICAgUmVzdWx0UGFja2Vy\nIHBhY2tlciwgaW50IHJlc3VsdExlbmd0aCkgewogICAgICAgICAgICBfZGVs\nZWdhdGUgPSBkZWxlZ2F0ZTsKICAgICAgICAgICAgX3BhY2tlciA9IHBhY2tl\ncjsKICAgICAgICAgICAgX2xlbiA9IHJlc3VsdExlbmd0aDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNjZXNz\nKCkgewogICAgICAgICAgICByZXR1cm4gX2RlbGVnYXRlLnN1cHBvcnRzUmFu\nZG9tQWNjZXNzKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVuKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIF9kZWxlZ2F0ZS5vcGVuKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgT2JqZWN0IGdldFJlc3VsdE9iamVjdCgpCiAgICAgICAgICAgIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgICAgICBPYmplY3Qgb2IgPSBfZGVsZWdh\ndGUuZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAgICAgICAgIGlmIChfcGFja2Vy\nID09IG51bGwgJiYgX2xlbiA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJu\nICgoT2JqZWN0W10pIG9iKVswXTsKICAgICAgICAgICAgaWYgKF9wYWNrZXIg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBvYjsKICAgICAgICAg\nICAgaWYgKF9sZW4gPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBfcGFj\na2VyLnBhY2sob2IpOwogICAgICAgICAgICByZXR1cm4gX3BhY2tlci5wYWNr\nKChPYmplY3RbXSkgb2IpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gbmV4dCgpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gX2RlbGVnYXRlLm5leHQoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGFic29sdXRlKGludCBwb3MpCiAg\nICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICByZXR1\ncm4gX2RlbGVnYXRlLmFic29sdXRlKHBvcyk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IHNpemUoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5zaXplKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByZXNldCgpCiAgICAgICAg\nICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBfZGVsZWdhdGUu\ncmVzZXQoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3Nl\nKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIF9kZWxlZ2F0ZS5jbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgaGFuZGxlQ2hlY2tlZEV4Y2VwdGlvbihFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBfZGVsZWdhdGUuaGFuZGxlQ2hlY2tlZEV4Y2VwdGlvbihl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXN1bHQgbGlz\ndCB0aGF0IHJlbW92ZXMgaXRzZWxmIGZyb20gdGhlIHF1ZXJ5J3Mgb3BlbiBy\nZXN1bHQgbGlzdAogICAgICogd2hlbiBpdCBpcyBjbG9zZWQuIFB1YmxpYyBm\nb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGljIGNsYXNzIFJlbW92ZU9u\nQ2xvc2VSZXN1bHRMaXN0CiAgICAgICAgaW1wbGVtZW50cyBSZXN1bHRMaXN0\nIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBSZXN1bHRMaXN0IF9yZXM7Cgog\nICAgICAgIHB1YmxpYyBSZW1vdmVPbkNsb3NlUmVzdWx0TGlzdChSZXN1bHRM\naXN0IHJlcykgewogICAgICAgICAgICBfcmVzID0gcmVzOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFJlc3VsdExpc3QgZ2V0RGVsZWdhdGUoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gaXNQcm92aWRlck9wZW4oKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfcmVzLmlzUHJvdmlkZXJPcGVuKCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9yZXMuaXNDbG9zZWQoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlKCkgewogICAgICAgICAgICBjbG9zZSh0cnVlKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKGJvb2xlYW4gcmVt\nb3ZlKSB7CiAgICAgICAgICAgIGlmIChpc0Nsb3NlZCgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX3Jlcy5jbG9zZSgpOwogICAg\nICAgICAgICBpZiAoIXJlbW92ZSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIGxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIC8vIGRvbid0IHVzZSBzdGFuZGFyZCBfcmVzdWx0TGlzdHMu\ncmVtb3ZlIG1ldGhvZCBiL2MgcmVsaWVzIG9uCiAgICAgICAgICAgICAgICAv\nLyBjb2xsZWN0aW9uIGVxdWFsaXR5LCB3aGljaCByZWxpZXMgb24gZWxlbWVu\ndCBlcXVhbGl0eSwgd2hpY2gKICAgICAgICAgICAgICAgIC8vIG1lYW5zIHdl\nIGVuZCB1cCB0cmF2ZXJzaW5nIGVudGlyZSByZXN1bHQgbGlzdHMhCiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9yZXN1bHRMaXN0cy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIGlmIChpdHIubmV4dCgpID09IHRoaXMpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBzaXplKCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5zaXpl\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5\nKCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5pc0VtcHR5KCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3Qg\nbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5jb250YWlucyhvKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXRlcmF0b3IoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KCkgewogICAgICAg\nICAgICByZXR1cm4gX3Jlcy50b0FycmF5KCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheShPYmplY3RbXSBhKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcmVzLnRvQXJyYXkoYSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0IG8pIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMuYWRkKG8pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfcmVzLnJlbW92ZShvKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbGxlY3Rpb24gYykgewogICAgICAg\nICAgICByZXR1cm4gX3Jlcy5jb250YWluc0FsbChjKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChDb2xsZWN0aW9uIGMpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9yZXMuYWRkQWxsKGMpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKGludCBpZHgsIENvbGxl\nY3Rpb24gYykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5hZGRBbGwoaWR4\nLCBjKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92\nZUFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMu\ncmVtb3ZlQWxsKGMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gcmV0YWluQWxsKENvbGxlY3Rpb24gYykgewogICAgICAgICAgICByZXR1\ncm4gX3Jlcy5yZXRhaW5BbGwoYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBjbGVhcigpIHsKICAgICAgICAgICAgX3Jlcy5jbGVhcigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXQoaW50IGlkeCkg\newogICAgICAgICAgICByZXR1cm4gX3Jlcy5nZXQoaWR4KTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3Qgc2V0KGludCBpZHgsIE9iamVjdCBv\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnNldChpZHgsIG8pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgYWRkKGludCBpZHgsIE9iamVj\ndCBvKSB7CiAgICAgICAgICAgIF9yZXMuYWRkKGlkeCwgbyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHJlbW92ZShpbnQgaWR4KSB7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzLnJlbW92ZShpZHgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBpbmRleE9mKE9iamVjdCBvKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcmVzLmluZGV4T2Yobyk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgaW50IGxhc3RJbmRleE9mKE9iamVjdCBvKSB7CiAgICAg\nICAgICAgIHJldHVybiBfcmVzLmxhc3RJbmRleE9mKG8pOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIExpc3RJdGVyYXRvciBsaXN0SXRlcmF0b3IoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLmxpc3RJdGVyYXRvcigpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIExpc3RJdGVyYXRvciBsaXN0SXRlcmF0\nb3IoaW50IGlkeCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5saXN0SXRl\ncmF0b3IoaWR4KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBMaXN0IHN1\nYkxpc3QoaW50IHN0YXJ0LCBpbnQgZW5kKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmVzLnN1Ykxpc3Qoc3RhcnQsIGVuZCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMuZXF1YWxzKG8pOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9y\nZXMuaGFzaENvZGUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiBfcmVzLnRvU3RyaW5nICgp\nOwoJCX0KCgkJcHVibGljIE9iamVjdCB3cml0ZVJlcGxhY2UgKCkKCQl7CgkJ\nCXJldHVybiBfcmVzOwoJCX0KCX0KfQo=\n","encoding":"base64"}

