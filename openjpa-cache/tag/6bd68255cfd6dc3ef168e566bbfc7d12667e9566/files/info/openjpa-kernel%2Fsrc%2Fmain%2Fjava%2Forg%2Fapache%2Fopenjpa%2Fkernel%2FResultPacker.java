{"sha":"28f2abee3f625913fda5d9e5b569c0109b1b02f3","node_id":"MDQ6QmxvYjIwNjM2NDoyOGYyYWJlZTNmNjI1OTEzZmRhNWQ5ZTViNTY5YzAxMDliMWIwMmYz","size":13340,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/28f2abee3f625913fda5d9e5b569c0109b1b02f3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkNvbnN0cnVjdG9yOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZW1i\nZXI7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBq\nYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEubWF0aC5CaWdJbnRl\nZ2VyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOwpp\nbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5D\nYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51\ndGlsLkdyZWdvcmlhbkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoq\nCiAqIEhlbHBlciBjbGFzcyB0byBwYWNrIHJlc3VsdHMgaW50byB0aGUgcmVz\ndWx0IGNsYXNzIHNldCBvbiB0aGUgcXVlcnkuCiAqCiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBub2phdmFk\nb2MKICovCnB1YmxpYyBjbGFzcyBSZXN1bHRQYWNrZXIgewoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZv\nclBhY2thZ2UKICAgICAgICAoUmVzdWx0UGFja2VyLmNsYXNzKTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFNldCBfc3RkVHlwZXMgPSBuZXcgSGFzaFNl\ndCgpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChPYmpl\nY3RbXS5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChPYmplY3QuY2xh\nc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoTWFwLmNsYXNzKTsKICAgICAg\nICBfc3RkVHlwZXMuYWRkKEhhc2hNYXAuY2xhc3MpOwogICAgICAgIF9zdGRU\neXBlcy5hZGQoQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMu\nYWRkKEJvb2xlYW4uY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoQnl0\nZS5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChTaG9ydC5jbGFzcyk7\nCiAgICAgICAgX3N0ZFR5cGVzLmFkZChJbnRlZ2VyLmNsYXNzKTsKICAgICAg\nICBfc3RkVHlwZXMuYWRkKExvbmcuY2xhc3MpOwogICAgICAgIF9zdGRUeXBl\ncy5hZGQoRmxvYXQuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoRG91\nYmxlLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMuYWRkKFN0cmluZy5jbGFz\ncyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChCaWdJbnRlZ2VyLmNsYXNzKTsK\nICAgICAgICBfc3RkVHlwZXMuYWRkKEJpZ0RlY2ltYWwuY2xhc3MpOwogICAg\nICAgIF9zdGRUeXBlcy5hZGQoRGF0ZS5jbGFzcyk7CiAgICAgICAgX3N0ZFR5\ncGVzLmFkZChqYXZhLnNxbC5EYXRlLmNsYXNzKTsKICAgICAgICBfc3RkVHlw\nZXMuYWRkKGphdmEuc3FsLlRpbWUuY2xhc3MpOwogICAgICAgIF9zdGRUeXBl\ncy5hZGQoamF2YS5zcWwuVGltZXN0YW1wLmNsYXNzKTsKICAgICAgICBfc3Rk\nVHlwZXMuYWRkKENhbGVuZGFyLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMu\nYWRkKEdyZWdvcmlhbkNhbGVuZGFyLmNsYXNzKTsKICAgIH0KCiAgICBwcml2\nYXRlIGZpbmFsIENsYXNzIF9yZXN1bHRDbGFzczsKICAgIHByaXZhdGUgZmlu\nYWwgU3RyaW5nW10gX2FsaWFzZXM7CiAgICBwcml2YXRlIGZpbmFsIE1lbWJl\ncltdIF9zZXRzOwogICAgcHJpdmF0ZSBmaW5hbCBNZXRob2QgX3B1dDsKICAg\nIHByaXZhdGUgZmluYWwgQ29uc3RydWN0b3IgX2NvbnN0cnVjdG9yOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IgZm9yIHJlc3VsdCBjbGFzcyB3aXRo\nb3V0IGEgcHJvamVjdGlvbi4KICAgICAqLwogICAgcHVibGljIFJlc3VsdFBh\nY2tlcihDbGFzcyBjYW5kaWRhdGUsIFN0cmluZyBhbGlhcywgQ2xhc3MgcmVz\ndWx0Q2xhc3MpIHsKICAgICAgICB0aGlzKGNhbmRpZGF0ZSwgbnVsbCwgbmV3\nIFN0cmluZ1tdeyBhbGlhcyB9LCByZXN1bHRDbGFzcyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBmb3Igc3RhbmRhcmQgcHJvamVjdGlv\nbi4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlwZXMgdGhlIHByb2plY3Rpb24g\ndmFsdWUgdHlwZXMKICAgICAqIEBwYXJhbSBhbGlhc2VzIHRoZSBhbGlhcyBm\nb3IgZWFjaCBwcm9qZWN0aW9uIHZhbHVlCiAgICAgKiBAcGFyYW0gcmVzdWx0\nQ2xhc3MgdGhlIGNsYXNzIHRvIHBhY2sgaW50bwogICAgICovCiAgICBwdWJs\naWMgUmVzdWx0UGFja2VyKENsYXNzW10gdHlwZXMsIFN0cmluZ1tdIGFsaWFz\nZXMsIENsYXNzIHJlc3VsdENsYXNzKSB7CiAgICAgICAgdGhpcyhudWxsLCB0\neXBlcywgYWxpYXNlcywgcmVzdWx0Q2xhc3MpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgY29uc3RydWN0b3IuCiAgICAgKi8KICAgIHByaXZh\ndGUgUmVzdWx0UGFja2VyKENsYXNzIGNhbmRpZGF0ZSwgQ2xhc3NbXSB0eXBl\ncywgU3RyaW5nW10gYWxpYXNlcywKICAgICAgICBDbGFzcyByZXN1bHRDbGFz\ncykgewogICAgICAgIF9hbGlhc2VzID0gYWxpYXNlczsKICAgICAgICBpZiAo\ncmVzdWx0Q2xhc3MuaXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBhc3Nl\ncnRDb252ZXJ0YWJsZShjYW5kaWRhdGUsIHR5cGVzLCByZXN1bHRDbGFzcyk7\nCiAgICAgICAgICAgIF9yZXN1bHRDbGFzcyA9IEZpbHRlcnMud3JhcChyZXN1\nbHRDbGFzcyk7CiAgICAgICAgICAgIF9zZXRzID0gbnVsbDsKICAgICAgICAg\nICAgX3B1dCA9IG51bGw7CiAgICAgICAgICAgIF9jb25zdHJ1Y3RvciA9IG51\nbGw7CiAgICAgICAgfSBlbHNlIGlmICghX3N0ZFR5cGVzLmNvbnRhaW5zKF9y\nZXN1bHRDbGFzcyA9IHJlc3VsdENsYXNzKSkgewogICAgICAgICAgICAvLyBj\naGVjayBmb3IgYSBjb25zdHJ1Y3RvciB0aGF0IG1hdGNoZXMgdGhlIHByb2pl\nY3Rpb24gdHlwZXMKICAgICAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IG51\nbGw7CiAgICAgICAgICAgIGlmICh0eXBlcyAhPSBudWxsICYmIHR5cGVzLmxl\nbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgY29ucyA9IF9yZXN1bHRDbGFzcy5nZXRDb25zdHJ1Y3Rvcih0\neXBlcyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RF\neGNlcHRpb24gbnNtZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIF9jb25zdHJ1Y3RvciA9IGNvbnM7CgogICAgICAg\nICAgICBpZiAoY29ucyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBNZXRo\nb2RbXSBtZXRob2RzID0gX3Jlc3VsdENsYXNzLmdldE1ldGhvZHMoKTsKICAg\nICAgICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gX3Jlc3VsdENsYXNzLmdl\ndEZpZWxkcygpOwogICAgICAgICAgICAgICAgX3B1dCA9IGZpbmRQdXQobWV0\naG9kcyk7CiAgICAgICAgICAgICAgICBfc2V0cyA9IG5ldyBNZW1iZXJbYWxp\nYXNlcy5sZW5ndGhdOwoKICAgICAgICAgICAgICAgIENsYXNzIHR5cGU7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9zZXRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICh0eXBlcyA9\nPSBudWxsKSA/IGNhbmRpZGF0ZSA6IHR5cGVzW2ldOwogICAgICAgICAgICAg\nICAgICAgIF9zZXRzW2ldID0gZmluZFNldChhbGlhc2VzW2ldLCB0eXBlLCBm\naWVsZHMsIG1ldGhvZHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChfc2V0\nc1tpXSA9PSBudWxsICYmIF9wdXQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImNh\nbnQtc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENs\nYXNzLCBhbGlhc2VzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndHlwZXMgPT0gbnVsbCA/IG51bGwgOiBBcnJheXMuYXNMaXN0KHR5cGVzKSkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgX3NldHMgPSBudWxsOwogICAgICAgICAgICAgICAgX3B1\ndCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBpZiAocmVzdWx0Q2xhc3MgIT0gTWFwLmNsYXNzICYmIHJlc3Vs\ndENsYXNzICE9IEhhc2hNYXAuY2xhc3MKICAgICAgICAgICAgICAgICYmIHJl\nc3VsdENsYXNzICE9IE9iamVjdFtdLmNsYXNzKQogICAgICAgICAgICAgICAg\nYXNzZXJ0Q29udmVydGFibGUoY2FuZGlkYXRlLCB0eXBlcywgcmVzdWx0Q2xh\nc3MpOwogICAgICAgICAgICBfc2V0cyA9IG51bGw7CiAgICAgICAgICAgIF9w\ndXQgPSBudWxsOwogICAgICAgICAgICBfY29uc3RydWN0b3IgPSBudWxsOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0IGNv\nbnZlcnNpb24gaXMgcG9zc2libGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhc3NlcnRDb252ZXJ0YWJsZShDbGFzcyBjYW5kaWRhdGUsIENsYXNzW10g\ndHlwZXMsCiAgICAgICAgQ2xhc3MgcmVzdWx0Q2xhc3MpIHsKICAgICAgICBD\nbGFzcyBjID0gKHR5cGVzID09IG51bGwpID8gY2FuZGlkYXRlIDogdHlwZXNb\nMF07CiAgICAgICAgaWYgKCh0eXBlcyAhPSBudWxsICYmIHR5cGVzLmxlbmd0\naCAhPSAxKSB8fCAoYyAhPSBudWxsCiAgICAgICAgICAgICYmIGMgIT0gT2Jq\nZWN0LmNsYXNzICYmICFGaWx0ZXJzLmNhbkNvbnZlcnQoYywgcmVzdWx0Q2xh\nc3MsIHRydWUpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImNhbnQtY29udmVydC1yZXN1bHQiLAogICAgICAgICAg\nICAgICAgYywgcmVzdWx0Q2xhc3MpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhY2sgdGhlIGdpdmVuIG9iamVjdCBpbnRvIGFuIGluc3RhbmNlIG9mIHRo\nZSBxdWVyeSdzIHJlc3VsdCBjbGFzcy4KICAgICAqLwogICAgcHVibGljIE9i\namVjdCBwYWNrKE9iamVjdCByZXN1bHQpIHsKICAgICAgICAvLyBzcGVjaWFs\nIGNhc2VzIGZvciBlZmZpY2llbnQgYmFzaWMgdHlwZXMgd2hlcmUgd2Ugd2Fu\ndCB0byBhdm9pZAogICAgICAgIC8vIGNyZWF0aW5nIGFuIGFycmF5IGZvciBj\nYWxsIHRvIGdlbmVyYWwgcGFjayBtZXRob2QgYmVsb3cKICAgICAgICBpZiAo\nX3Jlc3VsdENsYXNzID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIHJlc3VsdDsKICAgICAgICBpZiAoX3Jlc3VsdENsYXNzID09IE9iamVj\ndFtdLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdFtdeyBy\nZXN1bHQgfTsKICAgICAgICBpZiAoX3Jlc3VsdENsYXNzID09IEhhc2hNYXAu\nY2xhc3MgfHwgX3Jlc3VsdENsYXNzID09IE1hcC5jbGFzcykgewogICAgICAg\nICAgICBIYXNoTWFwIG1hcCA9IG5ldyBIYXNoTWFwKDEsIDFGKTsKICAgICAg\nICAgICAgbWFwLnB1dChfYWxpYXNlc1swXSwgcmVzdWx0KTsKICAgICAgICAg\nICAgcmV0dXJuIG1hcDsKICAgICAgICB9CgogICAgICAgIC8vIHByaW1pdGl2\nZSBvciBzaW1wbGUgdHlwZT8KICAgICAgICBpZiAoX2NvbnN0cnVjdG9yID09\nIG51bGwgJiYgX3NldHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEZp\nbHRlcnMuY29udmVydChyZXN1bHQsIF9yZXN1bHRDbGFzcyk7CgogICAgICAg\nIC8vIHRoaXMgaXMgc29tZSBjb21wbGV4IGNhc2UsIHNvIHdvcnRoIGl0IHRv\nIGNyZWF0ZSB0aGUgYXJyYXkgYW5kCiAgICAgICAgLy8gdXNlIHRoZSBnZW5l\ncmFsIHBhY2sgbWV0aG9kCiAgICAgICAgcmV0dXJuIHBhY2tVc2VyVHlwZShu\nZXcgT2JqZWN0W117IHJlc3VsdCB9KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhY2sgdGhlIGdpdmVuIGFycmF5IGludG8gYW4gaW5zdGFuY2Ugb2YgdGhl\nIHF1ZXJ5J3MgcmVzdWx0IGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgT2Jq\nZWN0IHBhY2soT2JqZWN0W10gcmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3Vs\ndCA9PSBudWxsIHx8IHJlc3VsdC5sZW5ndGggPT0gMCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIC8vIHNwZWNpYWwgY2FzZXMgZm9yIG9i\namVjdCBhcnJheXMgYW5kIG1hcHMKICAgICAgICBpZiAoX3Jlc3VsdENsYXNz\nID09IE9iamVjdFtdLmNsYXNzKSB7CiAgICAgICAgICAgIC8vIHRoZSByZXN1\nbHQgbWlnaHQgY29udGFpbiBleHRyYSBkYXRhIGF0IHRoZSBlbmQKICAgICAg\nICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiBfYWxpYXNlcy5sZW5ndGgpIHsK\nICAgICAgICAgICAgICAgIE9iamVjdFtdIHRyaW0gPSBuZXcgT2JqZWN0W19h\nbGlhc2VzLmxlbmd0aF07CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXlj\nb3B5KHJlc3VsdCwgMCwgdHJpbSwgMCwgdHJpbS5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRyaW07CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgaWYgKF9yZXN1\nbHRDbGFzcyA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBy\nZXN1bHRbMF07CiAgICAgICAgaWYgKF9yZXN1bHRDbGFzcyA9PSBIYXNoTWFw\nLmNsYXNzIHx8IF9yZXN1bHRDbGFzcyA9PSBNYXAuY2xhc3MpIHsKICAgICAg\nICAgICAgTWFwIG1hcCA9IG5ldyBIYXNoTWFwKHJlc3VsdC5sZW5ndGgpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hbGlhc2VzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgbWFwLnB1dChfYWxpYXNlc1tpXSwg\ncmVzdWx0W2ldKTsKICAgICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICB9\nCgogICAgICAgIC8vIHByaW1pdGl2ZSBvciBzaW1wbGUgdHlwZT8KICAgICAg\nICBpZiAoX3NldHMgPT0gbnVsbCAmJiBfY29uc3RydWN0b3IgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIEZpbHRlcnMuY29udmVydChyZXN1bHRbMF0s\nIF9yZXN1bHRDbGFzcyk7CgogICAgICAgIC8vIG11c3QgYmUgYSB1c2VyLWRl\nZmluZWQgdHlwZQogICAgICAgIHJldHVybiBwYWNrVXNlclR5cGUocmVzdWx0\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhY2sgdGhlIGdpdmVuIHJlc3Vs\ndCBpbnRvIHRoZSB1c2VyLWRlZmluZWQgcmVzdWx0IGNsYXNzLgogICAgICov\nCiAgICBwcml2YXRlIE9iamVjdCBwYWNrVXNlclR5cGUoT2JqZWN0W10gcmVz\ndWx0KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdXNlIHRoZSBj\nb25zdHJ1Y3RvciBmaXJzdCwgaWYgd2UgaGF2ZSBvbmUKICAgICAgICAgICAg\naWYgKF9jb25zdHJ1Y3RvciAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIF9jb25zdHJ1Y3Rvci5uZXdJbnN0YW5jZShyZXN1bHQpOwoKICAgICAg\nICAgICAgT2JqZWN0IHVzZXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3Rh\nbmNlQWN0aW9uKF9yZXN1bHRDbGFzcykpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9hbGlhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBpZiAoX3NldHNbaV0gaW5zdGFuY2VvZiBNZXRob2QpIHsKICAg\nICAgICAgICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIF9zZXRz\nW2ldOwogICAgICAgICAgICAgICAgICAgIG1ldGguaW52b2tlKHVzZXIsIG5l\ndyBPYmplY3RbXXsgRmlsdGVycy5jb252ZXJ0CiAgICAgICAgICAgICAgICAg\nICAgICAgIChyZXN1bHRbaV0sIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKVsw\nXSkgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9zZXRzW2ldIGlu\nc3RhbmNlb2YgRmllbGQpIHsKICAgICAgICAgICAgICAgICAgICBGaWVsZCBm\naWVsZCA9IChGaWVsZCkgX3NldHNbaV07CiAgICAgICAgICAgICAgICAgICAg\nZmllbGQuc2V0KHVzZXIsIEZpbHRlcnMuY29udmVydChyZXN1bHRbaV0sCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldFR5cGUoKSkpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChfcHV0ICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICBfcHV0Lmludm9rZSh1c2VyLCBuZXcgT2JqZWN0W117\nIF9hbGlhc2VzW2ldLCByZXN1bHRbaV0gfSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVzZXI7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgicGFjay1pbnN0YW50aWF0aW9uLWVyciIsCiAg\nICAgICAgICAgICAgICBfcmVzdWx0Q2xhc3MpLCBwYWUuZ2V0RXhjZXB0aW9u\nKCkpOwogICAgICAgIH0gY2F0Y2ggKEluc3RhbnRpYXRpb25FeGNlcHRpb24g\naWUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoInBhY2staW5zdGFudGlhdGlvbi1lcnIiLAogICAgICAgICAgICAg\nICAgX3Jlc3VsdENsYXNzKSwgaWUpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJwYWNrLWVyciIsIF9yZXN1bHRDbGFzcyksIGUpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc2V0IG1l\ndGhvZCBmb3IgdGhlIGdpdmVuIHByb3BlcnR5LgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBNZW1iZXIgZmluZFNldChTdHJpbmcgYWxpYXMsIENsYXNz\nIHR5cGUsIEZpZWxkW10gZmllbGRzLAogICAgICAgIE1ldGhvZFtdIG1ldGhv\nZHMpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShhbGlhcykp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICh0eXBlID09\nIE9iamVjdC5jbGFzcykKICAgICAgICAgICAgdHlwZSA9IG51bGw7CgogICAg\nICAgIC8vIGNoZWNrIHB1YmxpYyBmaWVsZHMgZmlyc3QKICAgICAgICBGaWVs\nZCBmaWVsZCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\naWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gaWYgd2UgZmlu\nZCBhIGZpZWxkIHdpdGggdGhlIGV4YWN0IG5hbWUsIGVpdGhlciByZXR1cm4g\naXQKICAgICAgICAgICAgLy8gaWYgaXQncyB0aGUgcmlnaHQgdHlwZSBvciBn\naXZlIHVwIGlmIGl0J3Mgbm90CiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0u\nZ2V0TmFtZSgpLmVxdWFscyhhbGlhcykpIHsKICAgICAgICAgICAgICAgIGlm\nICh0eXBlID09IG51bGwKICAgICAgICAgICAgICAgICAgICB8fCBGaWx0ZXJz\nLmNhbkNvbnZlcnQodHlwZSwgZmllbGRzW2ldLmdldFR5cGUoKSwgdHJ1ZSkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkc1tpXTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBvdGhlcndpc2UgaWYgd2UgZmluZCBhIGZpZWxkIHdpdGggdGhlIHJpZ2h0\nIG5hbWUgYnV0IHRoZQogICAgICAgICAgICAvLyB3cm9uZyBjYXNlLCByZWNv\ncmQgaXQgYW5kIGlmIHdlIGRvbid0IGZpbmQgYW4gZXhhY3QgbWF0Y2gKICAg\nICAgICAgICAgLy8gZm9yIGEgZmllbGQgb3Igc2V0dGVyIHdlJ2xsIHVzZSBp\ndAogICAgICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCAmJiBmaWVsZHNbaV0u\nZ2V0TmFtZSgpLmVxdWFsc0lnbm9yZUNhc2UoYWxpYXMpCiAgICAgICAgICAg\nICAgICAmJiAodHlwZSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBGaWx0\nZXJzLmNhbkNvbnZlcnQodHlwZSwgZmllbGRzW2ldLmdldFR5cGUoKSwgdHJ1\nZSkpKQogICAgICAgICAgICAgICAgZmllbGQgPSBmaWVsZHNbaV07CiAgICAg\nICAgfQoKICAgICAgICAvLyBjaGVjayBzZXR0ZXIgbWV0aG9kcwogICAgICAg\nIFN0cmluZyBzZXROYW1lID0gInNldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFs\naXplKGFsaWFzKTsKICAgICAgICBNZXRob2QgbWV0aG9kID0gbnVsbDsKICAg\nICAgICBib29sZWFuIGVxTmFtZSA9IGZhbHNlOwogICAgICAgIENsYXNzW10g\ncGFyYW1zOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIW1ldGhvZHNbaV0uZ2V0\nTmFtZSgpLmVxdWFsc0lnbm9yZUNhc2Uoc2V0TmFtZSkpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgcGFyYW1zID0gbWV0aG9kc1tp\nXS5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAgICBpZiAocGFyYW1z\nLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICBpZiAodHlwZSAhPSBudWxsICYmIHBhcmFtc1swXSA9PSBPYmpl\nY3QuY2xhc3MpIHsKICAgICAgICAgICAgICAgIC8vIHdlIGZvdW5kIGEgZ2Vu\nZXJpYyBvYmplY3Qgc2V0dGVyOyBub3cgc2VlIGlmIHRoZSBuYW1lCiAgICAg\nICAgICAgICAgICAvLyBpcyBhbiBleGFjdCBtYXRjaCwgYW5kIGlmIHNvIHJl\nY29yZCB0aGlzIHNldHRlci4gIGlmIHdlCiAgICAgICAgICAgICAgICAvLyBk\nb24ndCBmaW5kIGFuIGV4YWN0IHR5cGUgbWF0Y2ggbGF0ZXIsIHdlJ2xsIHVz\nZSBpdC4gIGlmCiAgICAgICAgICAgICAgICAvLyB0aGUgbmFtZXMgYXJlIG5v\ndCBhbiBleGFjdCBtYXRjaCwgb25seSByZWNvcmQgdGhpcyBzZXR0ZXIKICAg\nICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmVuJ3QgZm91bmQgYW55IG90aGVy\ncyB0aGF0IG1hdGNoIGF0IGFsbAogICAgICAgICAgICAgICAgaWYgKG1ldGhv\nZHNbaV0uZ2V0TmFtZSgpLmVxdWFscyhzZXROYW1lKSkgewogICAgICAgICAg\nICAgICAgICAgIGVxTmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAg\nbWV0aG9kID0gbWV0aG9kc1tpXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAobWV0aG9kID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbWV0aG9k\nID0gbWV0aG9kc1tpXTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nIGlmICh0eXBlID09IG51bGwgfHwgRmlsdGVycy5jYW5Db252ZXJ0KHR5cGUs\nIHBhcmFtc1swXSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIHdlIGZv\ndW5kIGEgc2V0dGVyIHdpdGggdGhlIHJpZ2h0IHR5cGU7IG5vdyBzZWUgaWYg\ndGhlIG5hbWUKICAgICAgICAgICAgICAgIC8vIGlzIGFuIGV4YWN0IG1hdGNo\nLiAgaWYgc28sIHJldHVybiB0aGUgc2V0dGVyLiAgaWYgbm90LAogICAgICAg\nICAgICAgICAgLy8gcmVjb3JkIHRoZSBzZXR0ZXIgb25seSBpZiB3ZSBoYXZl\nbid0IGZvdW5kIGEgZ2VuZXJpYyBvbmUKICAgICAgICAgICAgICAgIC8vIHdp\ndGggYW4gZXhhY3QgbmFtZSBtYXRjaAogICAgICAgICAgICAgICAgaWYgKG1l\ndGhvZHNbaV0uZ2V0TmFtZSgpLmVxdWFscyhzZXROYW1lKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbWV0aG9kc1tpXTsKICAgICAgICAgICAgICAg\nIGlmIChtZXRob2QgPT0gbnVsbCB8fCAhZXFOYW1lKQogICAgICAgICAgICAg\nICAgICAgIG1ldGhvZCA9IG1ldGhvZHNbaV07CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHdlIGhhdmUgYW4gZXhhY3QgbWV0aG9k\nIG5hbWUgbWF0Y2gsIHJldHVybiBpdDsgb3RoZXJ3aXNlIGZhdm9yCiAgICAg\nICAgLy8gYW4gaW5leGFjdCBmaWVsZCB0byBhbiBpbmV4YWN0IG1ldGhvZAog\nICAgICAgIGlmIChlcU5hbWUgfHwgZmllbGQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG1ldGhvZDsKICAgICAgICByZXR1cm4gZmllbGQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHB1dCBtZXRob2QgaWYgb25l\nIGV4aXN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgTWV0aG9kIGZp\nbmRQdXQoTWV0aG9kW10gbWV0aG9kcykgewogICAgICAgIENsYXNzW10gcGFy\nYW1zOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIW1ldGhvZHNbaV0uZ2V0TmFt\nZSgpLmVxdWFscygicHV0IikpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIHBhcmFtcyA9IG1ldGhvZHNbaV0uZ2V0UGFyYW1ldGVy\nVHlwZXMoKTsKICAgICAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMgog\nICAgICAgICAgICAgICAgJiYgcGFyYW1zWzBdID09IE9iamVjdC5jbGFzcwog\nICAgICAgICAgICAgICAgJiYgcGFyYW1zWzFdID09IE9iamVjdC5jbGFzcykK\nICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzW2ldOwogICAgICAgIH0K\nCQlyZXR1cm4gbnVsbDsKCX0KfQo=\n","encoding":"base64"}

