{"sha":"d32c0737ee763b658ca51af1b79e41cc4d11ac06","node_id":"MDQ6QmxvYjIwNjM2NDpkMzJjMDczN2VlNzYzYjY1OGNhNTFhZjFiNzllNDFjYzRkMTFhYzA2","size":31975,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d32c0737ee763b658ca51af1b79e41cc4d11ac06","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEuc3FsLlRpbWVzdGFtcDsKaW1wb3J0IGphdmEudXRp\nbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBq\nYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFuZ2VUcmFj\na2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0aW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1h\ncENoYW5nZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlBy\nb3hpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5TWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247\nCgovKioKICogRmllbGRNYW5hZ2VyIHR5cGUgdXNlZCB0byBob2xkIG9udG8g\nYSBzaW5nbGUgZmllbGQgdmFsdWUgYW5kIHRoZW4KICogZGlzcGVuc2UgaXQg\ndmlhIHRoZSBmZXRjaCBtZXRob2RzLiBUaGUgbWFuYWdlciBjYW4gYWxzbyBw\nZXJmb3JtIGFjdGlvbnMKICogb24gdGhlIGhlbGQgZmllbGQuCiAqCiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqLwpjbGFzcyBTaW5nbGVGaWVsZE1hbmFnZXIK\nICAgIGV4dGVuZHMgVHJhbnNmZXJGaWVsZE1hbmFnZXIgewoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZv\nclBhY2thZ2UKICAgICAgICAoU2luZ2xlRmllbGRNYW5hZ2VyLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0YXRlTWFuYWdlckltcGwgX3NtOwogICAg\ncHJpdmF0ZSBmaW5hbCBCcm9rZXJJbXBsIF9icm9rZXI7CgogICAgcHVibGlj\nIFNpbmdsZUZpZWxkTWFuYWdlcihTdGF0ZU1hbmFnZXJJbXBsIHNtLCBCcm9r\nZXJJbXBsIGJyb2tlcikgewogICAgICAgIF9zbSA9IHNtOwogICAgICAgIF9i\ncm9rZXIgPSBicm9rZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm94eSB0\naGUgaGVsZCBmaWVsZCBpZiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIHRoZSBm\naWVsZCBuZWVkcyB0bwogICAgICogYmUgcmVwbGFjZWQgd2l0aCB0aGUgbm93\nLXByb3hpZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIHByb3h5KGJvb2xlYW4gcmVzZXQsIGJvb2xlYW4gcmVwbGFjZU51bGwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9zbS5nZXRNZXRhRGF0YSgp\nLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBQcm94eSBwcm94eSA9IG51bGw7\nCiAgICAgICAgYm9vbGVhbiByZXQgPSBmYWxzZTsKICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGlmIChvYmp2YWwg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgICAgICBwcm94eSA9IGNoZWNrUHJveHkoKTsKICAgICAgICAg\nICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgcHJveHkgPSAoUHJveHkpIF9zbS5uZXdGaWVsZFByb3h5KGZpZWxkKTsK\nICAgICAgICAgICAgICAgICAgICAoKERhdGUpIHByb3h5KS5zZXRUaW1lKCgo\nRGF0ZSkgb2JqdmFsKS5nZXRUaW1lKCkpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChwcm94eSBpbnN0YW5jZW9mIFRpbWVzdGFtcCAKICAgICAgICAgICAg\nICAgICAgICAgICAgJiYgb2JqdmFsIGluc3RhbmNlb2YgVGltZXN0YW1wKQog\nICAgICAgICAgICAgICAgICAgICAgICAoKFRpbWVzdGFtcCkgcHJveHkpLnNl\ndE5hbm9zKCgoVGltZXN0YW1wKSBvYmp2YWwpLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZ2V0TmFub3MoKSk7CiAgICAgICAgICAgICAgICAgICAg\ncmV0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoK\nICAgICAgICAgICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBwcm94\neSA9IGNoZWNrUHJveHkoKTsKICAgICAgICAgICAgICAgIGlmIChwcm94eSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcHJveHkgPSAoUHJveHkp\nIF9zbS5uZXdGaWVsZFByb3h5KGZpZWxkKTsKICAgICAgICAgICAgICAgICAg\nICBDYWxlbmRhciBwY2FsID0gKENhbGVuZGFyKSBwcm94eTsKICAgICAgICAg\nICAgICAgICAgICBDYWxlbmRhciBvY2FsID0gKENhbGVuZGFyKSBvYmp2YWw7\nCiAgICAgICAgICAgICAgICAgICAgcGNhbC5zZXRUaW1lIChvY2FsLmdldFRp\nbWUgKCkpOwogICAgICAgICAgICAgICAgICAgIHBjYWwuc2V0VGltZVpvbmUg\nKG9jYWwuZ2V0VGltZVpvbmUgKCkpOwogICAgICAgICAgICAgICAgICAgIHJl\ndCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCAmJiAhcmVwbGFj\nZU51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICAgICAgcHJveHkgPSBjaGVja1Byb3h5KCk7CiAgICAgICAgICAg\nICAgICBpZiAocHJveHkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIHByb3h5ID0gKFByb3h5KSBfc20ubmV3RmllbGRQcm94eShmaWVsZCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKG9ianZhbCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIHByb3h5KS5hZGRBbGwo\nKENvbGxlY3Rpb24pIG9ianZhbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAg\nICAgICAgICBpZiAob2JqdmFsID09IG51bGwgJiYgIXJlcGxhY2VOdWxsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nICAgIHByb3h5ID0gY2hlY2tQcm94eSgpOwogICAgICAgICAgICAgICAgaWYg\nKHByb3h5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwcm94eSA9\nIChQcm94eSkgX3NtLm5ld0ZpZWxkUHJveHkoZmllbGQpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChvYmp2YWwgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgKChNYXApIHByb3h5KS5wdXRBbGwoKE1hcCkgb2JqdmFsKTsK\nICAgICAgICAgICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGlmIChvYmp2YWwg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgICAgICBwcm94eSA9IGNoZWNrUHJveHkoKTsKICAgICAgICAg\nICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgcHJveHkgPSBnZXRQcm94eU1hbmFnZXIoKS5uZXdDdXN0b21Qcm94eShv\nYmp2YWwpOwogICAgICAgICAgICAgICAgICAgIHJldCA9IHByb3h5ICE9IG51\nbGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICB9CgogICAgICAgIGlmIChwcm94eSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIHByb3h5LnNldE93bmVyKF9zbSwgZmllbGQpOwogICAgICAgICAg\nICBDaGFuZ2VUcmFja2VyIHRyYWNrZXIgPSBwcm94eS5nZXRDaGFuZ2VUcmFj\na2VyKCk7CiAgICAgICAgICAgIGlmIChyZXNldCAmJiB0cmFja2VyICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5NQVApIHsKICAgICAgICAgICAgICAgICAg\nICAvLyB0cmFjayB2YWx1ZXMgaWYga2V5IGlzIGRlcml2ZWQgZnJvbSB2YWx1\nZSwgZWxzZSBrZXlzCiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBrZXlz\nID0gZm1kLmdldEtleSgpLmdldFZhbHVlTWFwcGVkQnkoKSA9PSBudWxsOwog\nICAgICAgICAgICAgICAgICAgICgoTWFwQ2hhbmdlVHJhY2tlcikgdHJhY2tl\ncikuc2V0VHJhY2tLZXlzKGtleXMpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgdHJhY2tlci5zdGFydFRyYWNraW5nKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgb2JqdmFsID0gcHJveHk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0\naGUgY3VycmVudCBmaWVsZCBpcyBhIHVzYWJsZSBwcm94eSwgcmV0dXJuIGl0\nOyBlbHNlIHJldHVybiBudWxsLgogICAgICovCiAgICBwcml2YXRlIFByb3h5\nIGNoZWNrUHJveHkoKSB7CiAgICAgICAgaWYgKCEob2JqdmFsIGluc3RhbmNl\nb2YgUHJveHkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nUHJveHkgcHJveHkgPSAoUHJveHkpIG9ianZhbDsKICAgICAgICBpZiAocHJv\neHkuZ2V0T3duZXIoKSA9PSBudWxsIHx8IFByb3hpZXMuaXNPd25lcihwcm94\neSwgX3NtLCBmaWVsZCkpCiAgICAgICAgICAgIHJldHVybiBwcm94eTsKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFVucHJv\neGllcyB0aGUgY3VycmVudCBmaWVsZCBpZiBuZWVkZWQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHVucHJveHkoKSB7CiAgICAgICAgaWYgKG9ianZhbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX3NtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9C\nSkVDVDoKICAgICAgICAgICAgICAgIGlmIChvYmp2YWwgaW5zdGFuY2VvZiBQ\ncm94eSkgewogICAgICAgICAgICAgICAgICAgIFByb3h5IHByb3h5ID0gKFBy\nb3h5KSBvYmp2YWw7CiAgICAgICAgICAgICAgICAgICAgcHJveHkuc2V0T3du\nZXIobnVsbCwgLTEpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcm94eS5n\nZXRDaGFuZ2VUcmFja2VyKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgcHJveHkuZ2V0Q2hhbmdlVHJhY2tlcigpLnN0b3BUcmFja2luZygp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbGVhc2UgdGhlIGN1cnJlbnRseSBlbWJlZGRlZCBmaWVsZCAo\nbWFrZSBpdCB0cmFuc2llbnQpLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBy\nZWxlYXNlRW1iZWRkZWQoKSB7CiAgICAgICAgaWYgKG9ianZhbCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX3NtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGlm\nIChmbWQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVs\nZWFzZUVtYmVkZGVkKGZtZCwgb2JqdmFsKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQQygp\nKQogICAgICAgICAgICAgICAgICAgIHJlbGVhc2VFbWJlZGRlZChmbWQuZ2V0\nRWxlbWVudCgpLCAoT2JqZWN0W10pIG9ianZhbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmlzRW1i\nZWRkZWRQQygpKQogICAgICAgICAgICAgICAgICAgIHJlbGVhc2VFbWJlZGRl\nZChmbWQuZ2V0RWxlbWVudCgpLCAoQ29sbGVjdGlvbikgb2JqdmFsKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldEtleSgpLmlzRW1i\nZWRkZWRQQygpKQogICAgICAgICAgICAgICAgICAgIHJlbGVhc2VFbWJlZGRl\nZChmbWQuZ2V0S2V5KCksICgoTWFwKSBvYmp2YWwpLmtleVNldCgpKTsKICAg\nICAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQ\nQygpKQogICAgICAgICAgICAgICAgICAgIHJlbGVhc2VFbWJlZGRlZChmbWQu\nZ2V0RWxlbWVudCgpLCAoKE1hcCkgb2JqdmFsKS52YWx1ZXMoKSk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWxlYXNlIHRoZSBnaXZlbiBlbWJlZGRlZCBvYmplY3RzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcmVsZWFzZUVtYmVkZGVkKFZhbHVlTWV0\nYURhdGEgdm1kLCBPYmplY3RbXSBvYmpzKSB7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZWxl\nYXNlRW1iZWRkZWQodm1kLCBvYmpzW2ldKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbGVhc2UgdGhlIGdpdmVuIGVtYmVkZGVkIG9iamVjdHMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCByZWxlYXNlRW1iZWRkZWQoVmFsdWVNZXRh\nRGF0YSB2bWQsIENvbGxlY3Rpb24gb2JqcykgewogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykK\nICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVkKHZtZCwgaXRyLm5leHQoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIHRoZSBnaXZlbiBlbWJl\nZGQgb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVsZWFzZUVt\nYmVkZGVkKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3Qgb2JqKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFu\nYWdlckltcGwob2JqLCBmYWxzZSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwg\nJiYgc20uZ2V0T3duZXIoKSA9PSBfc20KICAgICAgICAgICAgJiYgc20uZ2V0\nT3duZXJNZXRhRGF0YSgpID09IHZtZCkKICAgICAgICAgICAgc20ucmVsZWFz\nZSh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIHN0\nb3JlZCBmaWVsZCBzYWZlbHksIHByZXZlbnRpbmcgaW5maW5pdGUgcmVjdXJz\naW9uIHVzaW5nCiAgICAgKiB0aGUgZ2l2ZW4gc2V0IG9mIGFscmVhZHktcGVy\nc2lzdGVkIG9iamVjdHMuIFRoaXMgbWV0aG9kIGlzIG9ubHkgY2FsbGVkCiAg\nICAgKiBmb3IgZmllbGRzIHRoYXQgd2Uga25vdyBoYXZlIGNhc2NhZGUtaW1t\nZWRpYXRlIHNldHRpbmdzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwZXJz\naXN0KE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqdmFsID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgaWYg\nKCFfYnJva2VyLmlzRGV0YWNoZWROZXcoKSAmJiBfYnJva2VyLmlzRGV0YWNo\nZWQob2JqdmFsKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGFs\nbG93IGJ1dCBpZ25vcmUKICAgICAgICAgICAgICAgIF9icm9rZXIucGVyc2lz\ndChvYmp2YWwsIHRydWUsIGNhbGwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAg\nICAgICAgX2Jyb2tlci5wZXJzaXN0QWxsKEFycmF5cy5hc0xpc3QoKE9iamVj\ndFtdKSBvYmp2YWwpLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBjYWxs\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgX2Jyb2tlci5w\nZXJzaXN0QWxsKChDb2xsZWN0aW9uKSBvYmp2YWwsIHRydWUsIGNhbGwpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk1BUDoKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0S2V5KCkuZ2V0\nQ2FzY2FkZVBlcnNpc3QoKQogICAgICAgICAgICAgICAgICAgID09IFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpCiAgICAgICAgICAgICAgICAg\nICAgX2Jyb2tlci5wZXJzaXN0QWxsKCgoTWFwKSBvYmp2YWwpLmtleVNldCgp\nLCB0cnVlLCBjYWxsKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxl\nbWVudCgpLmdldENhc2NhZGVQZXJzaXN0KCkKICAgICAgICAgICAgICAgICAg\nICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKQogICAgICAg\nICAgICAgICAgICAgIF9icm9rZXIucGVyc2lzdEFsbCgoKE1hcCkgb2JqdmFs\nKS52YWx1ZXMoKSwgdHJ1ZSwgY2FsbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgYW5k\nL29yIGRlcmVmZXJlbmNlIGZpZWxkIHZhbHVlcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgZGVsZXRlKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBk\nZWxldGUodHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXJl\nZmVyZW5jZSBmaWVsZCB2YWx1ZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGRlcmVmZXJlbmNlRGVwZW5kZW50KCkgewogICAgICAgIGRlbGV0ZShmYWxz\nZSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgb3IgZGVy\nZWZlcmVuY2UgdGhlIHN0b3JlZCBmaWVsZCBhcyBuZWNlc3NhcnkuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBkZWxldGUoYm9vbGVhbiBpbW1lZGlhdGUs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqdmFsID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKGZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgIT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX05PTkUpIHsKICAgICAgICAgICAgLy8gaW1tZWRpYXRl\nIGNhc2NhZGUgd29ya3Mgb24gZmllbGQgdmFsdWU7IGRlcGVuZGVudCBkZXJl\nZgogICAgICAgICAgICAvLyB3b3JrcyBvbiBleHRlcm5hbCB2YWx1ZQogICAg\nICAgICAgICBpZiAoKGltbWVkaWF0ZSB8fCBmbWQuaXNFbWJlZGRlZFBDKCkp\nCiAgICAgICAgICAgICAgICAmJiBmbWQuZ2V0Q2FzY2FkZURlbGV0ZSgpID09\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpCiAgICAgICAgICAg\nICAgICBkZWxldGUoZm1kLCBvYmp2YWwsIGNhbGwpOwogICAgICAgICAgICBl\nbHNlIGlmIChmbWQuZ2V0Q2FzY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURh\ndGEuQ0FTQ0FERV9BVVRPKQogICAgICAgICAgICAgICAgZGVyZWZlcmVuY2VE\nZXBlbmRlbnQoZm1kLmdldEV4dGVybmFsVmFsdWUob2JqdmFsLCBfYnJva2Vy\nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE9i\namVjdCBleHRlcm5hbCA9IG51bGw7CiAgICAgICAgVmFsdWVNZXRhRGF0YSB2\nbWQgPSBmbWQuZ2V0S2V5KCk7CiAgICAgICAgaWYgKChpbW1lZGlhdGUgfHwg\ndm1kLmlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICAmJiB2bWQuZ2V0Q2Fz\nY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElB\nVEUpCiAgICAgICAgICAgIGRlbGV0ZSh2bWQsICgoTWFwKSBvYmp2YWwpLmtl\neVNldCgpLCBjYWxsKTsKICAgICAgICBlbHNlIGlmICh2bWQuZ2V0Q2FzY2Fk\nZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKSB7CiAg\nICAgICAgICAgIGV4dGVybmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUob2Jq\ndmFsLCBfYnJva2VyKTsKICAgICAgICAgICAgaWYgKGV4dGVybmFsID09IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGRlcmVm\nZXJlbmNlRGVwZW5kZW50KCgoTWFwKSBleHRlcm5hbCkua2V5U2V0KCkpOwog\nICAgICAgIH0KCiAgICAgICAgdm1kID0gZm1kLmdldEVsZW1lbnQoKTsKICAg\nICAgICBpZiAoKGltbWVkaWF0ZSB8fCB2bWQuaXNFbWJlZGRlZFBDKCkpCiAg\nICAgICAgICAgICYmIHZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVN\nZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAgICBzd2l0\nY2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAg\nICAgICAgZGVsZXRlKHZtZCwgKENvbGxlY3Rpb24pIG9ianZhbCwgY2FsbCk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgICAgICBkZWxl\ndGUodm1kLCAoT2JqZWN0W10pIG9ianZhbCwgY2FsbCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5NQVA6CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlKHZtZCwgKChNYXAp\nIG9ianZhbCkudmFsdWVzKCksIGNhbGwpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh2bWQu\nZ2V0Q2FzY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9B\nVVRPKSB7CiAgICAgICAgICAgIGlmIChleHRlcm5hbCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBleHRlcm5hbCA9IGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKG9ianZhbCwgX2Jyb2tlcik7CiAgICAgICAgICAgICAgICBpZiAoZXh0ZXJu\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJ\nT046CiAgICAgICAgICAgICAgICAgICAgZGVyZWZlcmVuY2VEZXBlbmRlbnQo\nKENvbGxlY3Rpb24pIGV4dGVybmFsKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgICAgIGRlcmVmZXJlbmNlRGVwZW5kZW50KChPYmpl\nY3RbXSkgZXh0ZXJuYWwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAg\nICAgICAgICAgIGRlcmVmZXJlbmNlRGVwZW5kZW50KCgoTWFwKSBleHRlcm5h\nbCkudmFsdWVzKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGVs\nZXRlIHRoZSBvYmplY3RzIGluIHRoZSBnaXZlbiB2YWx1ZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGRlbGV0ZShWYWx1ZU1ldGFEYXRhIHZtZCwgT2Jq\nZWN0W10gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgb2Jqcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nZGVsZXRlKHZtZCwgb2Jqc1tpXSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZWxldGUgdGhlIG9iamVjdHMgZW1iZWRkZWQgaW4gdGhlIGdpdmVu\nIHZhbHVlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZGVsZXRlKFZhbHVl\nTWV0YURhdGEgdm1kLCBDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGRlbGV0ZSh2bWQs\nIGl0ci5uZXh0KCksIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogRGVs\nZXRlIGFuIG9iamVjdCBlbWJlZGRlZCBpbiB0aGUgZ2l2ZW4gdmFsdWUuCiAg\nICAgKi8KICAgIHZvaWQgZGVsZXRlKFZhbHVlTWV0YURhdGEgdm1kLCBPYmpl\nY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGRlbGV0\nZSBpZiB1bmtub3duZWQgb3IgdGhpcyBpc24ndCBhbiBlbWJlZGRlZCBmaWVs\nZCBvciBpZiBvd25lZCBieSB1cwogICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdlckltcGwob2JqLCBmYWxzZSk7\nCiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgKHNtLmdldE93bmVyKCkgPT0g\nbnVsbCB8fCAhdm1kLmlzRW1iZWRkZWRQQygpCiAgICAgICAgICAgIHx8IChz\nbS5nZXRPd25lcigpID09IF9zbSAmJiBzbS5nZXRPd25lck1ldGFEYXRhKCkg\nPT0gdm1kKSkpCiAgICAgICAgICAgIF9icm9rZXIuZGVsZXRlKHNtLmdldE1h\nbmFnZWRJbnN0YW5jZSgpLCBzbSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZXJlZmVyZW5jZSBhbGwgdmFsaWQgcGVyc2lzdGVudCBvYmplY3Rz\nIGluIHRoZSBnaXZlbiBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZGVyZWZlcmVuY2VEZXBlbmRlbnQoT2JqZWN0W10gb2Jqcykgewog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgb2Jqcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgZGVyZWZlcmVuY2VEZXBlbmRlbnQob2Jqc1tpXSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZXJlZmVyZW5jZSBhbGwgdmFsaWQgcGVy\nc2lzdGVudCBvYmplY3RzIGluIHRoZSBnaXZlbiBjb2xsZWN0aW9uLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgZGVyZWZlcmVuY2VEZXBlbmRlbnQoQ29s\nbGVjdGlvbiBvYmpzKSB7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBv\nYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICBk\nZXJlZmVyZW5jZURlcGVuZGVudChpdHIubmV4dCgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIERlcmVmZXJlbmNlIHRoZSBnaXZlbiBvYmplY3QuCiAgICAg\nKi8KICAgIHZvaWQgZGVyZWZlcmVuY2VEZXBlbmRlbnQoT2JqZWN0IG9iaikg\newogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0\nYXRlTWFuYWdlckltcGwob2JqLCBmYWxzZSk7CiAgICAgICAgaWYgKHNtICE9\nIG51bGwpCiAgICAgICAgICAgIHNtLnNldERlcmVmZXJlbmNlZERlcGVuZGVu\ndCh0cnVlLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2\nZWx5IGludm9rZSB0aGUgYnJva2VyIHRvIGdhdGhlciBjYXNjYWRlLXJlZnJl\nc2ggb2JqZWN0cyBpbgogICAgICogdGhlIGN1cnJlbnQgZmllbGQgaW50byB0\naGUgZ2l2ZW4gc2V0LiBUaGlzIG1ldGhvZCBpcyBvbmx5IGNhbGxlZAogICAg\nICogZm9yIGZpZWxkcyB0aGF0IHdlIGtub3cgaGF2ZSBjYXNjYWRlLXJlZnJl\nc2ggc2V0dGluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdhdGhlckNh\nc2NhZGVSZWZyZXNoKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqdmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAg\nICAgICAgX2Jyb2tlci5nYXRoZXJDYXNjYWRlUmVmcmVzaChvYmp2YWwsIGNh\nbGwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgZ2F0aGVyQ2FzY2Fk\nZVJlZnJlc2goKE9iamVjdFtdKSBvYmp2YWwsIGNhbGwpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICBnYXRoZXJDYXNjYWRlUmVmcmVzaCgo\nQ29sbGVjdGlvbikgb2JqdmFsLCBjYWxsKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldEtleSgpLmdldENhc2NhZGVSZWZyZXNoKCkK\nICAgICAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFKQogICAgICAgICAgICAgICAgICAgIGdhdGhlckNhc2NhZGVS\nZWZyZXNoKCgoTWFwKSBvYmp2YWwpLmtleVNldCgpLCBjYWxsKTsKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmdldENhc2NhZGVSZWZy\nZXNoKCkKICAgICAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfSU1NRURJQVRFKQogICAgICAgICAgICAgICAgICAgIGdhdGhlckNh\nc2NhZGVSZWZyZXNoKCgoTWFwKSBvYmp2YWwpLnZhbHVlcygpLCBjYWxsKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEdhdGhlciBlYWNoIGVsZW1lbnQuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBnYXRoZXJDYXNjYWRlUmVmcmVzaChPYmplY3RbXSBhcnIs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgX2Jyb2tlci5nYXRo\nZXJDYXNjYWRlUmVmcmVzaChhcnJbaV0sIGNhbGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogR2F0aGVyIGVhY2ggZWxlbWVudC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGdhdGhlckNhc2NhZGVSZWZyZXNoKENvbGxlY3Rpb24gY29s\nbCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gY29sbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgX2Jyb2tlci5nYXRoZXJDYXNjYWRlUmVmcmVzaChpdHIubmV4dCgp\nLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gcHJlLWZs\ndXNoIHRhc2tzIG9uIHRoZSBjdXJyZW50IGZpZWxkLiBUaGlzIGluY2x1ZGVz\nIGNoZWNraW5nCiAgICAgKiBmb3IgbnVsbHMsIHBlcnNpc3RpbmcgcGNzLCBl\nbWJlZGRpbmcgZW1iZWRkZWQgZmllbGRzLCBhbmQgcmVmJ2luZwogICAgICog\ncGMgZmllbGRzLiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgbmVlZHMgdG8g\nYmUgcmVwbGFjZWQgd2l0aCB0aGUKICAgICAqIG5ldyB2YWx1ZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gcHJlRmx1c2goYm9vbGVhbiBsb2dpY2Fs\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgLy8gb25seSBjYXJlIGFi\nb3V0IG9iamVjdCBmaWVsZHMKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9zbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA8IEphdmFUeXBlcy5PQkpF\nQ1QpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gcGVy\nZm9ybSBwZXJzLWJ5LXJlYWNoIGFuZCBkZXBlbmRlbnQgcmVmcwogICAgICAg\nIGJvb2xlYW4gcmV0ID0gcHJlRmx1c2goZm1kLCBsb2dpY2FsLCBjYWxsKTsK\nCiAgICAgICAgLy8gbWFuYWdlIGludmVyc2VzCiAgICAgICAgSW52ZXJzZU1h\nbmFnZXIgbWFuYWdlciA9IF9icm9rZXIuZ2V0SW52ZXJzZU1hbmFnZXIoKTsK\nICAgICAgICBpZiAobWFuYWdlciAhPSBudWxsKQogICAgICAgICAgICBtYW5h\nZ2VyLmNvcnJlY3RSZWxhdGlvbnMoX3NtLCBmbWQsIG9ianZhbCk7CiAgICAg\nICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\ncnVlIGlmIHRoZSBsYXN0LXByb3ZpZGVkIGZpZWxkIGhhcyBhIGRlZmF1bHQg\ndmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRGVmYXVsdFZh\nbHVlKCkgewogICAgICAgIHJldHVybiBkYmx2YWwgPT0gMCAmJiBsb25ndmFs\nID09IDAKICAgICAgICAgICAgJiYgKG9ianZhbCA9PSBudWxsIHx8ICIiLmVx\ndWFscyhvYmp2YWwpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRo\nZSBzdG9yZWQgZmllbGQgb3IgaXRzIGRlZmF1bHQgdmFsdWUgdG8gdGhlIGdp\ndmVuIHN0cmVhbS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2VyaWFsaXpl\nKE9iamVjdE91dHB1dCBvdXQsIGJvb2xlYW4gZGVmKQogICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgc3dp\ndGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBvdXQu\nd3JpdGVCb29sZWFuKCFkZWYgJiYgbG9uZ3ZhbCA9PSAxKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRF\nOgogICAgICAgICAgICAgICAgb3V0LndyaXRlQnl0ZSgoZGVmKSA/IChieXRl\nKSAwIDogKGJ5dGUpIGxvbmd2YWwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAg\nICAgICBvdXQud3JpdGVDaGFyKChkZWYpID8gKGNoYXIpIDAgOiAoY2hhcikg\nbG9uZ3ZhbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgb3V0Lndy\naXRlRG91YmxlKChkZWYpID8gMEQgOiBkYmx2YWwpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgog\nICAgICAgICAgICAgICAgb3V0LndyaXRlRmxvYXQoKGRlZikgPyAwRiA6IChm\nbG9hdCkgZGJsdmFsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBvdXQu\nd3JpdGVJbnQoKGRlZikgPyAwIDogKGludCkgbG9uZ3ZhbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nRzoKICAgICAgICAgICAgICAgIG91dC53cml0ZUxvbmcoKGRlZikgPyAwTCA6\nIGxvbmd2YWwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgb3V0Lndy\naXRlU2hvcnQoKGRlZikgPyAoc2hvcnQpIDAgOiAoc2hvcnQpIGxvbmd2YWwp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICBvdXQud3JpdGVPYmplY3QoKGRlZikgPyBudWxs\nIDogb2JqdmFsKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRvIHBlcmZvcm0gcHJlIGZsdXNoIGFjdGlvbnMgb24g\ndGhlIGN1cnJlbnQgb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gcHJlRmx1c2goRmllbGRNZXRhRGF0YSBmbWQsIGJvb2xlYW4gbG9naWNh\nbCwgCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIC8vIGNo\nZWNrIGZvciBpbGxlZ2FsIG51bGxzCiAgICAgICAgaWYgKG9ianZhbCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0TnVsbFZhbHVlKCkgPT0g\nRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTgogICAgICAgICAgICAgICAg\nfHwgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lE\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgibnVsbC12YWx1ZSIsCiAgICAgICAgICAgICAgICAg\nICAgZm1kLmdldE5hbWUoKSwgX3NtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSku\nCiAgICAgICAgICAgICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIG5vdGhp\nbmcgZWxzZSB0byBkbyBmb3Igbm9uLXBlcnNpc3RlbnQKICAgICAgICBpZiAo\nZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9Q\nRVJTSVNURU5UKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nIC8vIGRvbid0IGFsbG93IG1hbmFnZWQgb2JqZWN0aWQgZmllbGQgdmFsdWUK\nICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZh\nVHlwZXMuT0lEKSB7CiAgICAgICAgICAgIF9zbS5hc3NlcnROb3RNYW5hZ2Vk\nT2JqZWN0SWQob2JqdmFsKTsKICAgICAgICAgICAgaWYgKF9zbS5nZXRPYmpl\nY3RJZCgpICE9IG51bGwKICAgICAgICAgICAgICAgICYmICFvYmp2YWwuZXF1\nYWxzKCgoT2JqZWN0SWQpIF9zbS5nZXRPYmplY3RJZCgpKS5nZXRJZCgpKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoImNoYW5nZWQtb2lkIiwKICAgICAgICAgICAgICAgICAg\nICBfc20uZ2V0T2JqZWN0SWQoKSwgb2JqdmFsLAogICAgICAgICAgICAgICAg\nICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoX3NtLmdldE1hbmFnZWRJbnN0YW5j\nZSgpKSkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhdGFsKHRydWUpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9yIHBjcyBpbiBmaWVsZCB2\nYWx1ZQogICAgICAgIGlmIChwcmVGbHVzaChmbWQsIGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCksCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCksCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCku\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpLCBmYWxzZSwgbG9naWNhbCwgY2FsbCkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBhbHNvIGNo\nZWNrIGZvciBwY3MgaW4gZXh0ZXJuYWxpemVkIHZhbHVlcwogICAgICAgIGlm\nIChmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcHJlRmx1c2go\nZm1kLCBmbWQuZ2V0VHlwZUNvZGUoKSwgZm1kLmdldEtleSgpLmdldFR5cGVD\nb2RlKCksCiAgICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmdldFR5\ncGVDb2RlKCksIHRydWUsIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgbmV3IG9iamVj\ndHMgcGVyc2lzdGVudCBhbmQgcmVmIG90aGVyIG9iamVjdHMgc28gcmVmZXJl\nbmNlZAogICAgICogZGVwZW5kZW50IG9iamVjdHMgd29uJ3QgYmUgZGVsZXRl\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHByZUZsdXNoKEZpZWxk\nTWV0YURhdGEgZm1kLCBpbnQgdHlwZSwgaW50IGtleVR5cGUsCiAgICAgICAg\naW50IGVsZW1UeXBlLCBib29sZWFuIGV4dGVybmFsLCBib29sZWFuIGxvZ2lj\nYWwsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBPYmplY3QgdmFsID0g\nb2JqdmFsOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICBib29sZWFuIGNvcHkgPSBmYWxzZTsK\nICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoZm1kLmlzRW1iZWRkZWRQ\nQygpKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqdmFsID0gZW1iZWQoZm1k\nLCB2YWwpOwogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB0cnVlOwogICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nZXh0ZXJuYWwpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGZtZC5n\nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBwcmVGbHVzaFBDKGZtZCwgdmFsLCBsb2dpY2FsLCBjYWxsKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAg\naWYgKGV4dGVybmFsKQogICAgICAgICAgICAgICAgICAgIHZhbCA9IGZtZC5n\nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICAgICAgICAgICAg\nICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcHJlRmx1\nc2hQQyhmbWQsIHZhbCwgbG9naWNhbCwgY2FsbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAg\nICAgICAgICAgICAgICBpZiAoZm1kLmdldEVsZW1lbnQoKS5pc0VtYmVkZGVk\nUEMoKSkKICAgICAgICAgICAgICAgICAgICBlbWJlZChmbWQuZ2V0RWxlbWVu\ndCgpLCAoT2JqZWN0W10pIHZhbCk7CiAgICAgICAgICAgICAgICBlbHNlIGlm\nIChlbGVtVHlwZSA9PSBKYXZhVHlwZXMuUEMKICAgICAgICAgICAgICAgICAg\nICB8fCBlbGVtVHlwZSA9PSBKYXZhVHlwZXMuUENfVU5UWVBFRCkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChleHRlcm5hbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgdmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJv\na2VyKTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNoUENzKGZtZC5nZXRFbGVt\nZW50KCksIChPYmplY3RbXSkgdmFsLCBsb2dpY2FsLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldEVsZW1l\nbnQoKS5pc0VtYmVkZGVkUEMoKSkgewogICAgICAgICAgICAgICAgICAgIG9i\nanZhbCA9IGVtYmVkKGZtZC5nZXRFbGVtZW50KCksIChDb2xsZWN0aW9uKSB2\nYWwpOwogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB0cnVlOwogICAgICAg\nICAgICAgICAgfSBlbHNlIGlmIChlbGVtVHlwZSA9PSBKYXZhVHlwZXMuUEMK\nICAgICAgICAgICAgICAgICAgICB8fCBlbGVtVHlwZSA9PSBKYXZhVHlwZXMu\nUENfVU5UWVBFRCkgewogICAgICAgICAgICAgICAgICAgIGJvb2xlYW4gZmx1\nc2hlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmIChleHRlcm5h\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4dGVy\nbmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBzaG9ydGN1dCBjaGFuZ2UgdHJhY2tlcnM7IGFsc28g\nZW5zdXJlcyB3ZSBkb24ndCAKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\naXRlcmF0ZSBscnMgZmllbGRzCiAgICAgICAgICAgICAgICAgICAgICAgIENo\nYW5nZVRyYWNrZXIgY3QgPSAoKFByb3h5KSB2YWwpLmdldENoYW5nZVRyYWNr\nZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN0ICE9IG51bGwg\nJiYgY3QuaXNUcmFja2luZygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxlbWVudCgpLCBjdC5nZXRBZGRl\nZCgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpY2Fs\nLCBjYWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNo\nUENzKGZtZC5nZXRFbGVtZW50KCksIGN0LmdldENoYW5nZWQoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpY2FsLCBjYWxsKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoZWQgPSB0cnVlOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGlmICghZmx1c2hlZCAmJiB2YWwgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJlRmx1c2hQQ3MoZm1kLmdl\ndEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIHZhbCwgbG9naWNhbCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNhbGwpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGJvb2xlYW4ga2V5RW1iZWQg\nPSBmbWQuZ2V0S2V5KCkuaXNFbWJlZGRlZFBDKCk7CiAgICAgICAgICAgICAg\nICBib29sZWFuIHZhbEVtYmVkID0gZm1kLmdldEVsZW1lbnQoKS5pc0VtYmVk\nZGVkUEMoKTsKICAgICAgICAgICAgICAgIGlmIChrZXlFbWJlZCB8fCB2YWxF\nbWJlZCkgewogICAgICAgICAgICAgICAgICAgIG9ianZhbCA9IGVtYmVkKGZt\nZCwgKE1hcCkgdmFsLCBrZXlFbWJlZCwgdmFsRW1iZWQpOwogICAgICAgICAg\nICAgICAgICAgIGNvcHkgPSBrZXlFbWJlZDsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBpZiAoIWtleUVtYmVkICYmIChrZXlUeXBlID09\nIEphdmFUeXBlcy5QQwogICAgICAgICAgICAgICAgICAgIHx8IGtleVR5cGUg\nPT0gSmF2YVR5cGVzLlBDX1VOVFlQRUQpKSB7CiAgICAgICAgICAgICAgICAg\nICAgYm9vbGVhbiBmbHVzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGV4dGVybmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZh\nbCA9IGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGV4dGVybmFsID0gZmFsc2U7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBQcm94eSkg\newogICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG9ydGN1dCBjaGFuZ2Ug\ndHJhY2tlcnM7IGFsc28gZW5zdXJlcyB3ZSBkb24ndCAKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gaXRlcmF0ZSBscnMgZmllbGRzCiAgICAgICAgICAg\nICAgICAgICAgICAgIE1hcENoYW5nZVRyYWNrZXIgY3QgPSAoTWFwQ2hhbmdl\nVHJhY2tlcikgKChQcm94eSkgdmFsKS4KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGdldENoYW5nZVRyYWNrZXIoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGN0ICE9IG51bGwgJiYgY3QuaXNUcmFja2luZygpICYmIGN0\nLmdldFRyYWNrS2V5cygpKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0\nS2V5KCksIGN0LmdldEFkZGVkKCksIGxvZ2ljYWwsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2FsbCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0S2V5KCksIGN0LmdldENoYW5n\nZWQoKSwgbG9naWNhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjYWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoZWQg\nPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghZmx1c2hlZCAm\nJiB2YWwgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJlRmx1\nc2hQQ3MoZm1kLmdldEtleSgpLCAoKE1hcCkgdmFsKS5rZXlTZXQoKSwgbG9n\naWNhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGwpOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghdmFsRW1iZWQg\nJiYgKGVsZW1UeXBlID09IEphdmFUeXBlcy5QQwogICAgICAgICAgICAgICAg\nICAgIHx8IGVsZW1UeXBlID09IEphdmFUeXBlcy5QQ19VTlRZUEVEKSkgewog\nICAgICAgICAgICAgICAgICAgIGJvb2xlYW4gZmx1c2hlZCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgICAgIGlmIChleHRlcm5hbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBf\nYnJva2VyKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWwgaW5z\ndGFuY2VvZiBQcm94eSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBz\naG9ydGN1dCBjaGFuZ2UgdHJhY2tlcnM7IGFsc28gZW5zdXJlcyB3ZSBkb24n\ndCAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBscnMgZmll\nbGRzCiAgICAgICAgICAgICAgICAgICAgICAgIE1hcENoYW5nZVRyYWNrZXIg\nY3QgPSAoTWFwQ2hhbmdlVHJhY2tlcikgKChQcm94eSkgdmFsKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGdldENoYW5nZVRyYWNrZXIoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGN0ICE9IG51bGwgJiYgY3QuaXNU\ncmFja2luZygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nY3QuZ2V0VHJhY2tLZXlzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxlbWVudCgpLCBjdC5nZXRB\nZGRlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAo\nTWFwKSB2YWwsIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHByZUZsdXNoUENzKGZtZC5nZXRFbGVtZW50KCksIGN0\nLmdldENoYW5nZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKE1hcCkgdmFsLCBsb2dpY2FsLCBjYWxsKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcHJlRmx1c2hQQ3MoZm1kLmdldEVsZW1lbnQoKSwgY3Qu\nZ2V0QWRkZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbG9naWNhbCwgY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgcHJlRmx1c2hQQ3MoZm1kLmdldEVsZW1lbnQoKSwgY3QuZ2V0Q2hh\nbmdlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nb2dpY2FsLCBjYWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoZWQgPSB0cnVlOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGlmICghZmx1c2hlZCAmJiB2YWwgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJlRmx1c2hQQ3MoZm1k\nLmdldEVsZW1lbnQoKSwgKChNYXApIHZhbCkudmFsdWVzKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2dpY2FsLCBjYWxsKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nbmV3IG9iamVjdHMgcGVyc2lzdGVudCBhbmQgcmVmIGFsbCB2YWxpZCBwZXJz\naXN0ZW50IG9iamVjdHMgZm9yCiAgICAgKiB0aGUgZ2l2ZW4ga2V5cy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHByZUZsdXNoUENzKFZhbHVlTWV0YURh\ndGEgdm1kLCBDb2xsZWN0aW9uIGtleXMsIE1hcCBtYXAsCiAgICAgICAgYm9v\nbGVhbiBsb2dpY2FsLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBrZXlzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KQogICAgICAgICAgICBwcmVGbHVzaFBDKHZtZCwgbWFwLmdldChpdHIu\nbmV4dCgpKSwgbG9naWNhbCwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYWtlIG5ldyBvYmplY3RzIHBlcnNpc3RlbnQgYW5kIHJlZiBhbGwgdmFs\naWQgcGVyc2lzdGVudCBvYmplY3RzIGluCiAgICAgKiB0aGUgZ2l2ZW4gYXJy\nYXkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcmVGbHVzaFBDcyhWYWx1\nZU1ldGFEYXRhIHZtZCwgT2JqZWN0W10gb2JqcywKICAgICAgICBib29sZWFu\nIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IG9ianMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHBy\nZUZsdXNoUEModm1kLCBvYmpzW2ldLCBsb2dpY2FsLCBjYWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2UgbmV3IG9iamVjdHMgcGVyc2lzdGVudCBh\nbmQgcmVmIGFsbCB2YWxpZCBwZXJzaXN0ZW50IG9iamVjdHMgaW4KICAgICAq\nIHRoZSBnaXZlbiBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcHJlRmx1c2hQQ3MoVmFsdWVNZXRhRGF0YSB2bWQsIENvbGxlY3Rpb24g\nb2JqcywKICAgICAgICBib29sZWFuIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIHByZUZsdXNoUEMo\ndm1kLCBpdHIubmV4dCgpLCBsb2dpY2FsLCBjYWxsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBlcmZvcm0gcHJlIGZsdXNoIG9wZXJhdGlvbnMgb24gdGhl\nIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByZUZs\ndXNoUEMoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBvYmosIGJvb2xlYW4g\nbG9naWNhbCwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207CiAgICAgICAgaWYgKHZtZC5nZXRD\nYXNjYWRlUGVyc2lzdCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05F\nKSB7CiAgICAgICAgICAgIGlmICghX2Jyb2tlci5pc0RldGFjaGVkTmV3KCkg\nJiYgX2Jyb2tlci5pc0RldGFjaGVkKG9iaikpCiAgICAgICAgICAgICAgICBy\nZXR1cm47IC8vIGFsbG93IGJ1dCBpZ25vcmUKCiAgICAgICAgICAgIHNtID0g\nX2Jyb2tlci5nZXRTdGF0ZU1hbmFnZXIob2JqKTsKICAgICAgICAgICAgaWYg\nKHNtID09IG51bGwgfHwgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgiY2FudC1jYXNjYWRlLXBlcnNpc3QiLAogICAgICAgICAgICAgICAgICAg\nIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSwgdm1kLAogICAgICAgICAgICAg\nICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoX3NtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKSkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVj\ndChvYmopOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNtID0gX2Jy\nb2tlci5nZXRTdGF0ZU1hbmFnZXIob2JqKTsKICAgICAgICAgICAgaWYgKHNt\nID09IG51bGwgfHwgIXNtLmlzUHJvdmlzaW9uYWwoKSkKICAgICAgICAgICAg\nICAgIHNtID0gX2Jyb2tlci5wZXJzaXN0KG9iaiwgbnVsbCwgdHJ1ZSwgY2Fs\nbCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBpZiBkZWxldGVkIGFuZCBub3QgbWFuYWdlZCBpbnZlcnNl\nLCBkaWUKICAgICAgICAgICAgaWYgKHNtLmlzRGVsZXRlZCgpICYmIChfYnJv\na2VyLmdldEludmVyc2VNYW5hZ2VyKCkgPT0gbnVsbAogICAgICAgICAgICAg\nICAgfHwgdm1kLmdldEZpZWxkTWV0YURhdGEoKS5nZXRJbnZlcnNlTWV0YURh\ndGFzKCkubGVuZ3RoID09IDApKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInJlZi10by1kZWxldGVkIiwKICAg\nICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaiksIHZt\nZCwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKF9z\nbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4KICAgICAgICAgICAgICAgICAg\nICBzZXRGYWlsZWRPYmplY3Qob2JqKTsKCiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc21pbXBsID0gKFN0YXRlTWFuYWdlckltcGwpIHNtOwogICAg\nICAgICAgICBzbWltcGwubm9ucHJvdmlzaW9uYWwobG9naWNhbCwgY2FsbCk7\nCiAgICAgICAgICAgIHNtaW1wbC5zZXREZXJlZmVyZW5jZWREZXBlbmRlbnQo\nZmFsc2UsIHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2UgYWxsIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBhcnJheSBlbWJlZGRl\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGVtYmVkKFZhbHVlTWV0YURh\ndGEgdm1kLCBPYmplY3RbXSBhcnIpIHsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgYXJyW2ldID0g\nZW1iZWQodm1kLCBhcnJbaV0pOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgY29weSBvZiB0aGUgZ2l2ZW4gY29sbGVjdGlvbiBjb250YWluaW5n\nIGVtYmVkZGVkIGVsZW1lbnRzLgogICAgICovCiAgICBwcml2YXRlIENvbGxl\nY3Rpb24gZW1iZWQoVmFsdWVNZXRhRGF0YSB2bWQsIENvbGxlY3Rpb24gb3Jp\nZykgewogICAgICAgIC8vIHdlIGhhdmUgdG8gY29weSB0byBnZXQgYSBjb2xs\nZWN0aW9uIG9mIHRoZSByaWdodCB0eXBlIGFuZCBzaXplLAogICAgICAgIC8v\nIHRob3VnaCB3ZSBpbW1lZGlhdGVseSBjbGVhciBpdAogICAgICAgIENvbGxl\nY3Rpb24gY29sbCA9IGdldFByb3h5TWFuYWdlcigpLmNvcHlDb2xsZWN0aW9u\nKG9yaWcpOwogICAgICAgIGlmIChjb2xsID09IG51bGwpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtY29weWFi\nbGUiLAogICAgICAgICAgICAgICAgdm1kLmdldEZpZWxkTWV0YURhdGEoKSkp\nOwoKICAgICAgICBjb2xsLmNsZWFyKCk7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBvcmlnLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICBjb2xsLmFkZChlbWJlZCh2bWQsIGl0ci5uZXh0KCkpKTsKICAg\nICAgICByZXR1cm4gY29sbDsKICAgIH0KCiAgICAvKioKICAgICAqIEVtYmVk\nIHRoZSBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gbWFwLgogICAgICovCiAgICBw\ncml2YXRlIE1hcCBlbWJlZChGaWVsZE1ldGFEYXRhIGZtZCwgTWFwIG9yaWcs\nIGJvb2xlYW4ga2V5RW1iZWQsCiAgICAgICAgYm9vbGVhbiB2YWxFbWJlZCkg\newogICAgICAgIE1hcCBtYXA7CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwoK\nICAgICAgICAvLyBpZiB3ZSBoYXZlIHRvIHJlcGxhY2Uga2V5cywgd2UgbmVl\nZCB0byBjb3B5IHRoZSBtYXA7IG90aGVyd2lzZQogICAgICAgIC8vIHdlIGNh\nbiBtdXRhdGUgdGhlIHZhbHVlcyBkaXJlY3RseQogICAgICAgIGlmIChrZXlF\nbWJlZCkgewogICAgICAgICAgICAvLyB3ZSBoYXZlIHRvIGNvcHkgdG8gZ2V0\nIGEgY29sbGVjdGlvbiBvZiB0aGUgcmlnaHQgdHlwZSBhbmQgc2l6ZSwKICAg\nICAgICAgICAgLy8gdGhvdWdoIHdlIGltbWVkaWF0ZWx5IGNsZWFyIGl0CiAg\nICAgICAgICAgIG1hcCA9IGdldFByb3h5TWFuYWdlcigpLmNvcHlNYXAob3Jp\nZyk7CiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtY29w\neWFibGUiLCBmbWQpKTsKCiAgICAgICAgICAgIG1hcC5jbGVhcigpOwogICAg\nICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gb3JpZy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50\ncnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBrZXkgPSBlbWJlZChm\nbWQuZ2V0S2V5KCksIGVudHJ5LmdldEtleSgpKTsKICAgICAgICAgICAgICAg\nIHZhbCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAo\ndmFsRW1iZWQpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gZW1iZWQoZm1k\nLmdldEVsZW1lbnQoKSwgdmFsKTsKICAgICAgICAgICAgICAgIG1hcC5wdXQo\na2V5LCB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgbWFwID0gb3JpZzsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgZW50cnkuc2V0VmFsdWUoZW1i\nZWQoZm1kLmdldEVsZW1lbnQoKSwKICAgICAgICAgICAgICAgICAgICBlbnRy\neS5nZXRWYWx1ZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG1hcDsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhl\nIGdpdmVuIG9iamVjdCBlbWJlZGRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBP\nYmplY3QgZW1iZWQoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBvYmopIHsK\nICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIHJldHVybiBfYnJva2VyLmVtYmVkKG9iaiwgbnVsbCwg\nX3NtLCB2bWQpLmdldE1hbmFnZWRJbnN0YW5jZSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBwcm94eSBtYW5hZ2VyLgogICAgICovCiAg\nICBwcml2YXRlIFByb3h5TWFuYWdlciBnZXRQcm94eU1hbmFnZXIgKCkKCXsK\nCQlyZXR1cm4gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uICgpLmdldFByb3h5\nTWFuYWdlckluc3RhbmNlICgpOwoJfQp9Cg==\n","encoding":"base64"}

