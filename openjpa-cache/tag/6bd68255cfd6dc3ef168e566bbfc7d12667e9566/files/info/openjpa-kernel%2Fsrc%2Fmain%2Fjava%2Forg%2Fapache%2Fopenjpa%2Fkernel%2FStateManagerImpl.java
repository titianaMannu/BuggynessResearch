{"sha":"6d7486bb250f5c2fcf177f2ddf8fa7b811f85c49","node_id":"MDQ6QmxvYjIwNjM2NDo2ZDc0ODZiYjI1MGY1YzJmY2YxNzdmMmRkZjhmYTdiODExZjg1YzQ5","size":105639,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6d7486bb250f5c2fcf177f2ddf8fa7b811f85c49","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQg\namF2YS51dGlsLio7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5NYW5hZ2VkSW5zdGFuY2VQcm92\naWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkR5bmFt\naWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUge0Bs\naW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXJ9IGludGVyZmFjZSBmb3IgdXNlCiAq\nIHdpdGggdGhpcyBydW50aW1lLiBFYWNoIHN0YXRlIG1hbmFnZXIgbWFuYWdl\ncyB0aGUgc3RhdGUgb2YgYSBzaW5nbGUKICogcGVyc2lzdGVuY2UgY2FwYWJs\nZSBpbnN0YW5jZS4gVGhlIHN0YXRlIG1hbmFnZXIgaXMgYWxzbyByZXNwb25z\naWJsZSBmb3IKICogYWxsIGNvbW11bmljYXRpb25zIGFib3V0IHRoZSBpbnN0\nYW5jZSB0byB0aGUge0BsaW5rIFN0b3JlTWFuYWdlcn0uCiAqICBUaGUgc3Rh\ndGUgbWFuYWdlciB1c2VzIHRoZSBTdGF0ZSBwYXR0ZXJuIGluIGJvdGggaXRz\nIGludGVyYWN0aW9uIHdpdGgKICogdGhlIGdvdmVybmVkIGluc3RhbmNlIGFu\nZCBpdHMgaW50ZXJhY3Rpb24gd2l0aCB0aGUgYnJva2VyLgogKiBJbiBpdHMg\naW50ZXJhY3Rpb25zIHdpdGggdGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgaW5z\ndGFuY2UsIGl0IHVzZXMgdGhlCiAqIHtAbGluayBGaWVsZE1hbmFnZXJ9IGlu\ndGVyZmFjZS4gU2ltaWxhcmx5LCB3aGVuIGludGVyYWN0aW5nIHdpdGggdGhl\nCiAqIGJyb2tlciwgaXQgdXNlcyB0aGUge0BsaW5rIFBDU3RhdGV9IHNpbmds\nZXRvbiB0aGF0IHJlcHJlc2VudHMKICogdGhlIGN1cnJlbnQgbGlmZWN5Y2xl\nIHN0YXRlIG9mIHRoZSBpbnN0YW5jZS4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICovCnB1YmxpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJbXBsCiAgICBpbXBs\nZW1lbnRzIE9wZW5KUEFTdGF0ZU1hbmFnZXIgewoKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IExPQURfRkdTID0gMDsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IExPQURfQUxMID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IExPQURfU0VSSUFMSVpFID0gMjsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19TQVZFID0gMiA8PCAwOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEZMQUdfREVSRUYgPSAyIDw8IDE7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19MT0FERUQgPSAyIDw8IDI7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19SRUFEX0xPQ0tFRCA9\nIDIgPDwgMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1dS\nSVRFX0xPQ0tFRCA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX09JRF9BU1NJR05FRCA9IDIgPDwgNTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0xPQURJTkcgPSAyIDw8IDY7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19QUkVfREVMRVRJTkcgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVT\nSEVEID0gMiA8PCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFX0ZMVVNIRUQgPSAyIDw8IDk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRkxBR19GTFVTSEVEX0RJUlRZID0gMiA8PCAxMDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0lNUExfQ0FDSEUgPSAyIDw8\nIDExOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfSU5WRVJT\nRVMgPSAyIDw8IDEyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfTk9fVU5QUk9YWSA9IDIgPDwgMTM7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRkxBR19WRVJTSU9OX0NIRUNLID0gMiA8PCAxNDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1ZFUlNJT05fVVBEQVRFID0g\nMiA8PCAxNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RF\nVEFDSElORyA9IDIgPDwgMTY7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAg\nIChTdGF0ZU1hbmFnZXJJbXBsLmNsYXNzKTsKCiAgICAvLyBpbmZvcm1hdGlv\nbiBhYm91dCB0aGUgaW5zdGFuY2UKICAgIHByaXZhdGUgUGVyc2lzdGVuY2VD\nYXBhYmxlIF9wYyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEg\nX21ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51\nbGw7CiAgICBwcml2YXRlIEJpdFNldCBfZGlydHkgPSBudWxsOwogICAgcHJp\ndmF0ZSBCaXRTZXQgX2ZsdXNoID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9m\nbGFncyA9IDA7CgogICAgLy8gaWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRl\nbnRpdHk7IG9pZCBpcyB0aGUgcGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAog\nICAgLy8gbWF5IGJlIG51bGwgZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQt\ndHJhbnNhY3Rpb25hbCBvYmplY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2Vz\nIHRoYXQgaGF2ZW4ndCBiZWVuIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJl\nYXNzaWduZWQgdG8gb2lkCiAgICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3Np\nZ25tZW50IChvciBmbHVzaCBjb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMK\nICAgIC8vIGR1cmluZyBmbHVzaCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9\nIG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAv\nLyB0aGUgbWFuYWdpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5\nY2xlIHN0YXRlCiAgICBwcml2YXRlIGZpbmFsIEJyb2tlckltcGwgX2Jyb2tl\ncjsKICAgIHByaXZhdGUgUENTdGF0ZSBfc3RhdGUgPSBQQ1N0YXRlLlRSQU5T\nSUVOVDsKCiAgICAvLyB0aGUgY3VycmVudCBhbmQgbGFzdCBsb2FkZWQgdmVy\nc2lvbiBpbmRpY2F0b3JzLCBhbmQgdGhlIGxvY2sgb2JqZWN0CiAgICBwcml2\nYXRlIE9iamVjdCBfdmVyc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVj\ndCBfbG9hZFZlcnNpb24gPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xv\nY2sgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX3JlYWRMb2NrTGV2ZWwgPSAt\nMTsKICAgIHByaXZhdGUgaW50IF93cml0ZUxvY2tMZXZlbCA9IC0xOwoKICAg\nIC8vIGRlbGVnYXRlcyB3aGVuIHByb3ZpZGluZy9yZXBsYWNpbmcgaW5zdGFu\nY2UgZGF0YQogICAgcHJpdmF0ZSBTaW5nbGVGaWVsZE1hbmFnZXIgX3Npbmds\nZSA9IG51bGw7CiAgICBwcml2YXRlIFNhdmVGaWVsZE1hbmFnZXIgX3NhdmVk\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNYW5hZ2VyIF9mbSA9IG51bGw7\nCgogICAgLy8gaW1wbGRhdGE7IGZpZWxkIGltcGxkYXRhIGFuZCBpbnRlcm1l\nZGlhdGUgZGF0YSBzaGFyZSB0aGUgc2FtZSBhcnJheQogICAgcHJpdmF0ZSBP\nYmplY3QgX2ltcGwgPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZmll\nbGRJbXBsID0gbnVsbDsKCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUg\nb3duZXIgb2YgdGhpcyBpbnN0YW5jZSwgaWYgaXQgaXMgZW1iZWRkZWQKICAg\nIHByaXZhdGUgU3RhdGVNYW5hZ2VySW1wbCBfb3duZXIgPSBudWxsOwogICAg\ncHJpdmF0ZSBWYWx1ZU1ldGFEYXRhIF9vd25lck1ldGEgPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBpZCwgdHlwZSBtZXRh\nZGF0YSwgYW5kIG93bmluZyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbChPYmplY3QgaWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwgCiAgICAgICAgQnJva2VySW1wbCBicm9rZXIp\nIHsKICAgICAgICBfaWQgPSBpZDsKICAgICAgICBfbWV0YSA9IG1ldGE7CiAg\nICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBfc2luZ2xlID0gbmV3\nIFNpbmdsZUZpZWxkTWFuYWdlcih0aGlzLCBicm9rZXIpOwoKICAgICAgICBp\nZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9VTktOT1dOKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBfbWV0YSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBvd25pbmcgc3RhdGUgYW5kIGZpZWxk\nIGlmIHRoaXMgaXMgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHZvaWQgc2V0T3duZXIoU3RhdGVNYW5hZ2VySW1wbCBvd25lciwgVmFsdWVN\nZXRhRGF0YSBvd25lck1ldGEpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsK\nICAgICAgICBfb3duZXJNZXRhID0gb3duZXJNZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGlzIHN0YXRlIG1hbmFnZXIgaXMgaW4gdGhl\nIG1pZGRsZSBvZiBhIGxvYWQuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNMb2Fk\naW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19MT0FESU5H\nKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3Rh\ndGUgbWFuYWdlciBpcyBpbiB0aGUgbWlkZGxlIG9mIGEgbG9hZCBpbml0aWF0\nZWQKICAgICAqIGJ5IG91dHNpZGUgY29kZTsgZm9yIGFueSBpbnRlcm5hbCBt\nZXRob2RzIHRoYXQgY2F1c2UgbG9hZGluZywgdGhlCiAgICAgKiBsb2FkaW5n\nIGZsYWcgaXMgc2V0IGF1dG9tYXRpY2FsbHkuCiAgICAgKi8KICAgIHZvaWQg\nc2V0TG9hZGluZyhib29sZWFuIGxvYWRpbmcpIHsKICAgICAgICBpZiAobG9h\nZGluZykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BRElORzsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19MT0FESU5H\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9yIHJlc2V0IHRoZSBsaWZl\nY3ljbGUgc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5zdGFuY2UuIElmIHRoZQog\nICAgICogdHJhbnNhY3Rpb25hbCBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UgY2hh\nbmdlcywgaXQgd2lsbCBiZSBlbmxpc3RlZC8KICAgICAqIGRlbGlzdGVkIGZy\nb20gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMgbmVjZXNzYXJ5LiBUaGUg\nZ2l2ZW4KICAgICAqIHN0YXRlIHdpbGwgYmUgaW5pdGlhbGl6ZWQgYWZ0ZXIg\nYmVpbmcgc2V0LiBJZiB0aGUgZ2l2ZW4gc3RhdGUKICAgICAqIGlzIHRoZSBz\nYW1lIGFzIHRoZSBjdXJyZW50IHN0YXRlLCB0aGlzIG1ldGhvZCB3aWxsIGhh\ndmUgbm8gZWZmZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0UENT\ndGF0ZShQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgaWYgKF9zdGF0ZSA9PSBz\ndGF0ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbm90aWZ5IHRoZSBzdG9yZSBt\nYW5hZ2VyIHRoYXQgd2UncmUgY2hhbmdpbmcgc3RhdGVzOyBjYW4gdmV0bwog\nICAgICAgICAgICBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmJlZm9yZVN0\nYXRlQ2hhbmdlKHRoaXMsIF9zdGF0ZSwgc3RhdGUpOwoKICAgICAgICAgICAg\nLy8gcmVwbGFjZSBzdGF0ZQogICAgICAgICAgICBib29sZWFuIHdhc0RlbGV0\nZWQgPSBfc3RhdGUuaXNEZWxldGVkKCk7CiAgICAgICAgICAgIGJvb2xlYW4g\nd2FzRGlydHkgPSBfc3RhdGUuaXNEaXJ0eSgpOwogICAgICAgICAgICBib29s\nZWFuIHdhc1BlbmRpbmcgPSBfc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICBfc3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgICAg\nIC8vIGVubGlzdC9kZWxpc3QgZnJvbSB0cmFuc2FjdGlvbgogICAgICAgICAg\nICBpZiAoX3N0YXRlLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAgICAg\nICAgICBfYnJva2VyLmFkZFRvVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAg\nICAgICAgICBpZiAoX3N0YXRlLmlzRGVsZXRlZCgpICE9IHdhc0RlbGV0ZWQp\nCiAgICAgICAgICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCAh\nd2FzRGlydHkgfHwgaXNGbHVzaGVkKCkpOwogICAgICAgICAgICAgICAgZWxz\nZSBpZiAoX3N0YXRlLmlzRGlydHkoKSAmJiAhd2FzRGlydHkpCiAgICAgICAg\nICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCB0cnVlKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmICghd2FzUGVuZGluZyAmJiBfc3RhdGUuaXNQ\nZW5kaW5nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tl\nci5hZGRUb1BlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAg\nZWxzZSBpZiAod2FzUGVuZGluZyAmJiAhX3N0YXRlLmlzUGVuZGluZ1RyYW5z\nYWN0aW9uYWwoKSkKICAgICAgICAgICAgICAgIF9icm9rZXIucmVtb3ZlRnJv\nbVBlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1vdmVGcm9tVHJhbnNhY3Rpb24o\ndGhpcyk7CgogICAgICAgICAgICAvLyBpbml0aWFsaXplCiAgICAgICAgICAg\nIF9zdGF0ZS5pbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgICBpZiAoX3N0\nYXRlLmlzRGVsZXRlZCgpICYmICF3YXNEZWxldGVkKQogICAgICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RF\nTEVURSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoQ2xh\nc3MgY2xzLCBQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgLy8gY2hlY2sgdG8g\nc2VlIGlmIG91ciBjdXJyZW50IG9iamVjdCBpZCBpbnN0YW5jZSBpcyB0aGUK\nICAgICAgICAvLyBjb3JyZWN0IGlkIHR5cGUgZm9yIHRoZSBzcGVjaWZpZWQg\nY2xhc3M7IHRoaXMgaXMgZm9yIGNhc2VzCiAgICAgICAgLy8gd2hlbiB3ZSBo\nYXZlIGFuIGFwcGxpY2F0aW9uIGlkIGhpZXJhcmNoeSBhbmQgd2UgaGFkIHNl\ndCB0aGUKICAgICAgICAvLyBtZXRhZGF0YSB0byBhIHN1cGVyY2xhc3MgaWQg\nLS0gdGhlIHN1YmNsYXNzJyBpZCBtYXkgYmUgYQogICAgICAgIC8vIGRpZmZl\ncmVudCBjbGFzcywgc28gd2UgbmVlZCB0byByZXNldCBpdAogICAgICAgIGlm\nIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkgIT0gY2xzKSB7CiAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgc3ViID0gX21ldGEuZ2V0UmVwb3NpdG9yeSgp\nLmdldE1ldGFEYXRhCiAgICAgICAgICAgICAgICAoY2xzLCBfYnJva2VyLmdl\ndENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgICAgICBpZiAoX29pZCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAg\nICAgICAgICAgICAgICAgX29pZCA9IF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2Vy\nKCkuY29weURhdGFTdG9yZUlkKF9vaWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgIHN1Yik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChfbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBB\ncHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIHN1Yik7CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChzdWIuZ2V0T2JqZWN0SWRUeXBlKCkgIT0gX21ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Rb\nXSBwa0ZpZWxkcyA9IEFwcGxpY2F0aW9uSWRzLnRvUEtWYWx1ZXMoX29pZCwg\nX21ldGEpOwogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXMocGtGaWVsZHMsIHN1Yik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX21ldGEgPSBzdWI7\nCiAgICAgICAgfQogICAgICAgIGlmIChjbHMuaXNJbnRlcmZhY2UoKSkKICAg\nICAgICAgICAgY2xzID0gX21ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwoKICAg\nICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdCA9IFBDUmVnaXN0cnkubmV3\nSW5zdGFuY2UoY2xzLCB0aGlzLCBfb2lkLCB0cnVlKTsKICAgICAgICBpZiAo\naW5zdCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRoZSBpbnN0YW5jZSB3\nYXMgbnVsbDogY2hlY2sgdG8gc2VlIGlmIHRoZSBpbnN0YW5jZSBpcwogICAg\nICAgICAgICAvLyBhYnN0cmFjdCAoYXMgY2FuIHNvbWV0aW1lcyBiZSB0aGUg\nY2FzZSB3aGVuIHRoZQogICAgICAgICAgICAvLyBjbGFzcyBkaXNjcmltaW5h\ndG9yIHN0cmF0ZWd5IGlzIG5vdCBjb25maWd1cmVkIGNvcnJlY3RseSkKICAg\nICAgICAgICAgaWYgKE1vZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJpbnN0YW50aWF0ZS1hYnN0cmFjdCIsCiAgICAgICAg\nICAgICAgICAgICAgY2xzLmdldE5hbWUoKSwgX29pZCkpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9Cgog\nICAgICAgIGluaXRpYWxpemUoaW5zdCwgc3RhdGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW5pdGlhbGl6ZSB3aXRoIHRoZSBnaXZlbiBpbnN0YW5jZSBh\nbmQgc3RhdGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGluaXRpYWxp\nemUoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBQQ1N0YXRlIHN0YXRlKSB7CiAg\nICAgICAgaWYgKHBjID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbml0LW51bGwtcGMiLCBfbWV0YSkp\nOwogICAgICAgIGlmIChwYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwg\nJiYgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKSAhPSB0aGlzKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaW5pdC1zbS1w\nYyIsCiAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHBjKSkp\nLnNldEZhaWxlZE9iamVjdChwYyk7CiAgICAgICAgcGMucGNSZXBsYWNlU3Rh\ndGVNYW5hZ2VyKHRoaXMpOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIF9sb2FkZWQgPSBuZXcg\nQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICBfZmx1c2ggPSBuZXcgQml0\nU2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICBfZGlydHkgPSBuZXcgQml0U2V0\nKGZtZHMubGVuZ3RoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIG1hcmsgcHJpbWFy\neSBrZXkgYW5kIG5vbi1wZXJzaXN0ZW50IGZpZWxkcyBhcyBsb2FkZWQKICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uaXNQcmltYXJ5S2V5KCkKICAgICAgICAg\nICAgICAgIHx8IGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IGZtZHNbaV0u\nTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBfbG9hZGVkLnNl\ndChpKTsKCiAgICAgICAgICAgIC8vIHJlY29yZCB3aGV0aGVyIHRoZXJlIGFy\nZSBhbnkgbWFuYWdlZCBpbnZlcnNlIGZpZWxkcwogICAgICAgICAgICBpZiAo\nX2Jyb2tlci5nZXRJbnZlcnNlTWFuYWdlcigpICE9IG51bGwKICAgICAgICAg\nICAgICAgICYmIGZtZHNbaV0uZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0\naCA+IDApCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19JTlZFUlNF\nUzsKICAgICAgICB9CgogICAgICAgIHBjLnBjU2V0RGV0YWNoZWRTdGF0ZShu\ndWxsKTsKICAgICAgICBfcGMgPSBwYzsKCiAgICAgICAgaWYgKF9vaWQgaW5z\ndGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQQUlkKSBf\nb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSk7CgogICAgICAgIC8vIGluaXRpYWxpemUgb3VyIHN0YXRlIGFu\nZCBhZGQgb3Vyc2VsdmVzIHRvIHRoZSBicm9rZXIncyBjYWNoZQogICAgICAg\nIHNldFBDU3RhdGUoc3RhdGUpOwogICAgICAgIF9icm9rZXIuc2V0U3RhdGVN\nYW5hZ2VyKF9pZCwgdGhpcywgQnJva2VySW1wbC5TVEFUVVNfSU5JVCk7CiAg\nICAgICAgaWYgKHN0YXRlID09IFBDU3RhdGUuUE5FVykKICAgICAgICAgICAg\nZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJ\nU1QpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgbm9uLXRyYWNraW5nIFBD\nLCBhZGQgYSBoYXJkIHJlZiB0byB0aGUgYXBwcm9wcmlhdGUgZGF0YQogICAg\nICAgIC8vIHNldHMgYW5kIGdpdmUgaXQgYW4gb3Bwb3J0dW5pdHkgdG8gbWFr\nZSBhIHN0YXRlIHNuYXBzaG90LgogICAgICAgIGlmICghaXNJbnRlcmNlcHRp\nbmcoKSkKICAgICAgICAgICAgc2F2ZUZpZWxkcyh0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90IGRhdGEgYWNjZXNzIGluIHRo\naXMgaW5zdGFuY2UgaXMgaW50ZXJjZXB0ZWQuIFRoaXMgZGlmZmVycwogICAg\nICogZnJvbSB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNpc0ludGVyY2VwdGluZygp\nfSBpbiB0aGF0IGl0IGNoZWNrcyBmb3IKICAgICAqIHByb3BlcnR5IGFjY2Vz\ncyArIHN1YmNsYXNzaW5nIGluIGFkZGl0aW9uIHRvIHRoZSByZWRlZmluaXRp\nb24gLwogICAgICogZW5oYW5jZW1lbnQgY2hlY2tzLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAgICBpZiAo\nZ2V0TWV0YURhdGEoKS5pc0ludGVyY2VwdGluZygpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZ2V0TWV0YURhdGEoKS5nZXRBY2Nl\nc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQKICAgICAg\nICAgICAgJiYgX3BjIGluc3RhbmNlb2YgRHluYW1pY1BlcnNpc3RlbmNlQ2Fw\nYWJsZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgdGhlIGdpdmVu\nIGxpZmVjeWNsZSBldmVudCB0byBhbGwgbGlzdGVuZXJzLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2ZW50KGludCB0eXBl\nKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50\nKGdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICBfbWV0\nYSwgdHlwZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZChGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBsb2FkKGZldGNoLCBMT0FE\nX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgc3RhdGUgb2YgdGhpcyBpbnN0YW5jZSBiYXNlZCBvbiB0\naGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICogYW5kIGxvYWQg\nbW9kZS4gUmV0dXJuIHRydWUgaWYgYW55IGRhdGEgd2FzIGxvYWRlZCwgZmFs\nc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBs\nb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvYWRNb2RlLAog\nICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3Qgc2RhdGEsIGJvb2xlYW4g\nZm9yV3JpdGUpIHsKICAgICAgICBpZiAoIWZvcldyaXRlICYmICghaXNQZXJz\naXN0ZW50KCkgfHwgaXNOZXcoKSB8fCBpc0RlbGV0ZWQoKSkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gaWYgYW55IGZpZWxkcyBi\nZWluZyBsb2FkZWQsIGRvIHN0YXRlIHRyYW5zaXRpb25zIGZvciByZWFkCiAg\nICAgICAgQml0U2V0IGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0\nY2gsIGxvYWRNb2RlLCBleGNsdWRlKTsKICAgICAgICBib29sZWFuIGFjdGl2\nZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsKICAgICAgICBpZiAoIWZvcldyaXRl\nICYmIGZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICBiZWZvcmVSZWFkKC0x\nKTsKCiAgICAgICAgLy8gY2FsbCBsb2FkIGV2ZW4gaWYgbm8gZmllbGRzIGFy\nZSBiZWluZyBsb2FkZWQsIGJlY2F1c2UgaXQgdGFrZXMKICAgICAgICAvLyBj\nYXJlIG9mIGNoZWNraW5nIGlmIHRoZSBERkcgaXMgbG9hZGVkLCBtYWtpbmcg\nc3VyZSB2ZXJzaW9uIGluZm8KICAgICAgICAvLyBpcyBsb2FkZWQsIGV0Ywog\nICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2ZWwoYWN0\naXZlLCBmb3JXcml0ZSwgZmV0Y2gpOwogICAgICAgIGJvb2xlYW4gcmV0ID0g\nbG9hZEZpZWxkcyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIHNkYXRhLCBm\nb3JXcml0ZSk7CiAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCBmb3JXcml0\nZSwgbG9ja0xldmVsLCBmZXRjaCwgc2RhdGEpOwogICAgICAgIHJldHVybiBy\nZXQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKSB7CiAgICAgICAgaWYgKF9wYyBpbnN0YW5jZW9mIE1hbmFnZWRJbnN0\nYW5jZVByb3ZpZGVyKQogICAgICAgICAgICByZXR1cm4gKChNYW5hZ2VkSW5z\ndGFuY2VQcm92aWRlcikgX3BjKS5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAg\ncHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIF9wYzsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX21ldGE7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZ2V0T3duZXIoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0KCiAg\nICBwdWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRPd25lck1ldGFEYXRhKCkgewog\nICAgICAgIHJldHVybiBfb3duZXJNZXRhOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRW1iZWRkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lciAh\nPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZCgp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgPiAw\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZERpcnR5KCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZ\nKSA+IDA7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXRMb2FkZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9sb2FkZWQ7CiAgICB9CgogICAgcHVibGljIEJp\ndFNldCBnZXRGbHVzaGVkKCkgewogICAgICAgIHJldHVybiBfZmx1c2g7CiAg\nICB9CgogICAgcHVibGljIEJpdFNldCBnZXREaXJ0eSgpIHsKICAgICAgICBy\nZXR1cm4gX2RpcnR5OwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0VW5s\nb2FkZWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgLy8g\nY29sbGVjdCBmaWVsZHMgdG8gbG9hZCBmcm9tIGRhdGEgc3RvcmUgYmFzZWQg\nb24gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIEJpdFNldCBmaWVsZHMg\nPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7\nCiAgICAgICAgcmV0dXJuIChmaWVsZHMgPT0gbnVsbCkgPyBuZXcgQml0U2V0\nKDApIDogZmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwg\ndmVyc2lvbiBvZiB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlciNnZXRVbmxv\nYWRlZH0gdGhhdCBhdm9pZHMKICAgICAqIGNyZWF0aW5nIGFuIGVtcHR5IGJp\ndCBzZXQgYnkgcmV0dXJuaW5nIG51bGwgd2hlbiB0aGVyZSBhcmUgbm8gdW5s\nb2FkZWQKICAgICAqIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRT\nZXQgZ2V0VW5sb2FkZWRJbnRlcm5hbChGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGludCBtb2RlLAogICAgICAgIEJpdFNldCBleGNsdWRlKSB7CiAgICAg\nICAgaWYgKGV4Y2x1ZGUgPT0gU3RvcmVDb250ZXh0LkVYQ0xVREVfQUxMKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQml0U2V0IGZpZWxk\ncyA9IG51bGw7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIGxvYWQ7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChfbG9hZGVkLmdldChpKSB8fCAoZXhjbHVkZSAhPSBudWxs\nICYmIGV4Y2x1ZGUuZ2V0KGkpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIExPQURfU0VSSUFMSVpFOgogICAgICAgICAgICAgICAgICAgIGxv\nYWQgPSAhZm1kc1tpXS5pc1RyYW5zaWVudCgpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMT0FEX0ZHUzoKICAg\nICAgICAgICAgICAgICAgICBsb2FkID0gZmV0Y2ggPT0gbnVsbCB8fCBmZXRj\naC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAgICAgICAgICAg\nICAgICAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nIC8vIExPQURfQUxMCiAgICAgICAgICAgICAgICAgICAgbG9hZCA9IHRydWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2FkKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAg\nICAgICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9CgogICAgcHVibGlj\nIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIC8qKgogICAgICogTWFuYWdpbmcgYnJva2Vy\nLgogICAgICovCiAgICBCcm9rZXJJbXBsIGdldEJyb2tlcigpIHsKICAgICAg\nICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndElkKCkgewogICAgICAgIHJldHVybiBfaWQ7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRPYmplY3RJZCgpIHsKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20uZ2V0T3duZXIoKSAh\nPSBudWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBz\nbS5nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbS5fb2lkOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldE9iamVjdElkKE9iamVjdCBvaWQpIHsKICAg\nICAgICBfb2lkID0gb2lkOwogICAgICAgIGlmIChfcGMgIT0gbnVsbCAmJiBv\naWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQ\nQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3Np\nZ25PYmplY3RJZChib29sZWFuIGZsdXNoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJ\nZChmbHVzaCwgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFzayBzdG9yZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIgb2lkLCBvcHRpb25h\nbGx5IGZsdXNoaW5nIGFuZAogICAgICogb3B0aW9uYWxseSByZWNhY2hpbmcg\nb24gdGhlIG5ldyBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBh\nc3NpZ25PYmplY3RJZChib29sZWFuIGZsdXNoLCBib29sZWFuIHByZUZsdXNo\naW5nKSB7CiAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCB8fCBpc0VtYmVkZGVk\nKCkgfHwgIWlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYXNz\naWduT2JqZWN0SWQodGhpcywgcHJlRmx1c2hpbmcpKSB7CiAgICAgICAgICAg\nIGlmICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgICAgICBhc3NlcnRPYmpl\nY3RJZEFzc2lnbmVkKHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAoZmx1c2gp\nCiAgICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSB3ZXJlIGFzc2ln\nbmVkIGFuIG9pZCwgYW5kIHBlcmZvcm0gYWN0aW9ucyB0byBtYWtlIGl0CiAg\nICAgKiBwZXJtYW5lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHJlY2FjaGUg\nd2hldGhlciB0byByZWNhY2hlIG91cnNlbGYgb24gdGhlIG5ldyBvaWQKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE9iamVjdElkQXNzaWduZWQo\nYm9vbGVhbiByZWNhY2hlKSB7CiAgICAgICAgaWYgKCFpc05ldygpIHx8IGlz\nRGVsZXRlZCgpIHx8IGlzUHJvdmlzaW9uYWwoKSAKICAgICAgICAgICAgfHwg\nKF9mbGFncyAmIEZMQUdfT0lEX0FTU0lHTkVEKSAhPSAwKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAg\nICAgICAgICAgICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgICAg\nICAgICBfb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKF9wYywgX21ldGEp\nOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG9yaWcgPSBfaWQ7CiAgICAg\nICAgX2lkID0gX29pZDsKICAgICAgICBpZiAocmVjYWNoZSkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgX2Jyb2tlci5zZXRTdGF0ZU1h\nbmFnZXIob3JpZywgdGhpcywKICAgICAgICAgICAgICAgICAgICBCcm9rZXJJ\nbXBsLlNUQVRVU19PSURfQVNTSUdOKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgX2lkID0g\nb3JpZzsKICAgICAgICAgICAgICAgIF9vaWQgPSBudWxsOwogICAgICAgICAg\nICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfT0lEX0FTU0lHTkVEOwogICAgfQoKICAgIC8q\nKgogICAgICogQXNzaWduIHRoZSBwcm9wZXIgZ2VuZXJhdGVkIHZhbHVlIHRv\nIHRoZSBnaXZlbiBmaWVsZCBiYXNlZCBvbiBpdHMKICAgICAqIHZhbHVlLXN0\ncmF0ZWd5LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gYXNzaWduRmll\nbGQoaW50IGZpZWxkLCBib29sZWFuIHByZUZsdXNoaW5nKSB7CiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IHRoaXM7CiAgICAgICAgd2hpbGUg\nKHNtLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgc20gPSBzbS5nZXRPd25l\ncigpOwogICAgICAgIGlmICghc20uaXNOZXcoKSB8fCBzbS5pc0ZsdXNoZWQo\nKSB8fCBzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICAvLyBzcGVjaWFsLWNhc2Ugb2lkIGZpZWxkcywgd2hpY2gg\ncmVxdWlyZSB1cyB0byBsb29rIGluc2lkZSB0aGUgb2lkCiAgICAgICAgLy8g\nb2JqZWN0CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICAvLyB0cnkg\ndG8gc2hvcnRjdXQgaWYgcG9zc2libGUKICAgICAgICAgICAgaWYgKF9vaWQg\nIT0gbnVsbCB8fCBpc0VtYmVkZGVkKCkgfHwgIWlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAvLyBj\naGVjayBlbWJlZGRlZCBmaWVsZHMgb2Ygb2lkIGZvciB2YWx1ZSBzdHJhdGVn\neSArIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIHBrcyA9IGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBudWxs\nOwogICAgICAgICAgICBib29sZWFuIGFzc2lnbiA9IGZhbHNlOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgIWFzc2lnbiAmJiBpIDwgcGtzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldFZhbHVl\nU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChvaWRz\nbSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIG9pZHNtID0gbmV3IE9i\namVjdElkU3RhdGVNYW5hZ2VyKGZldGNoT2JqZWN0RmllbGQoZmllbGQpLAog\nICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBmbWQpOwogICAgICAgICAg\nICAgICAgYXNzaWduID0gb2lkc20uaXNEZWZhdWx0VmFsdWUoaSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFzc2lnbiAmJiBhc3NpZ25P\nYmplY3RJZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKICAgICAgICB9\nCgogICAgICAgIC8vIEp1c3QgcmV0dXJuIGlmIHRoZXJlJ3Mgbm8gdmFsdWUg\nZ2VuZXJhdGlvbiBzdHJhdGVneQogICAgICAgIGlmIChmbWQuZ2V0VmFsdWVT\ndHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgLy8gVGhyb3cgZXhj\nZXB0aW9uIGlmIGZpZWxkIGFscmVhZHkgaGFzIGEgdmFsdWUgYXNzaWduZWQu\nCiAgICAgICAgLy8gQEdlbmVyYXRlZFZhbHVlIG92ZXJyaWRlcyBQT0pPIGlu\naXRpYWwgdmFsdWVzIGFuZCBzZXR0ZXIgbWV0aG9kcwogICAgICAgIGlmICgh\naXNEZWZhdWx0VmFsdWUoZmllbGQpICYmICFmbWQuaXNWYWx1ZUdlbmVyYXRl\nZCgpKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgICAgICJleGlzdGluZy12\nYWx1ZS1vdmVycmlkZS1leGNlcCIsIGZtZC5nZXRGdWxsTmFtZShmYWxzZSkp\nKTsKCiAgICAgICAgLy8gZm9yIHByaW1hcnkga2V5IGZpZWxkcywgYXNzaWdu\nIHRoZSBvYmplY3QgaWQgYW5kIHJlY2FjaGUgc28gdGhhdAogICAgICAgIC8v\nIHRvIHRoZSB1c2VyLCBzbyBpdCBsb29rcyBsaWtlIHRoZSBvaWQgYWx3YXlz\nIG1hdGNoZXMgdGhlIHBrIGZpZWxkcwogICAgICAgIGlmIChmbWQuaXNQcmlt\nYXJ5S2V5KCkgJiYgIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGFzc2lnbk9iamVjdElkKCFwcmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwoK\nICAgICAgICAvLyBmb3Igb3RoZXIgZmllbGRzIGp1c3QgYXNzaWduIHRoZSBm\naWVsZCBvciBmbHVzaCBpZiBuZWVkZWQKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRTdG9yZU1hbmFnZXIoKS5hc3NpZ25GaWVsZCh0aGlzLCBmaWVsZCwgcHJl\nRmx1c2hpbmcpKSB7CiAgICAgICAgICAgIGZtZC5zZXRWYWx1ZUdlbmVyYXRl\nZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQog\nICAgICAgIGlmICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgIF9icm9rZXIu\nZmx1c2goKTsKICAgICAgICByZXR1cm4gIXByZUZsdXNoaW5nOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0TG9jaygpIHsKICAgICAgICByZXR1cm4g\nX2xvY2s7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TG9jayhPYmplY3Qg\nbG9jaykgewogICAgICAgIF9sb2NrID0gbG9jazsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF92ZXJz\naW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb24oT2JqZWN0\nIHZlcnNpb24pIHsKICAgICAgICBfbG9hZFZlcnNpb24gPSB2ZXJzaW9uOwog\nICAgICAgIGFzc2lnblZlcnNpb25GaWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAg\nICBPYmplY3QgZ2V0TG9hZFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2FkVmVyc2lvbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROZXh0VmVy\nc2lvbihPYmplY3QgdmVyc2lvbikgewogICAgICAgIGFzc2lnblZlcnNpb25G\naWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzaWdu\nVmVyc2lvbkZpZWxkKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAgICAgX3ZlcnNp\nb24gPSB2ZXJzaW9uOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmZpZWxkID0g\nX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHZmaWVsZCAh\nPSBudWxsKQogICAgICAgICAgICBzdG9yZSh2ZmllbGQuZ2V0SW5kZXgoKSwg\nSmF2YVR5cGVzLmNvbnZlcnQodmVyc2lvbiwKICAgICAgICAgICAgICAgIHZm\naWVsZC5nZXRUeXBlQ29kZSgpKSk7CiAgICB9CgogICAgcHVibGljIFBDU3Rh\ndGUgZ2V0UENTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlOwogICAg\nfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEltcGxEYXRh\nKCkgewogICAgICAgIHJldHVybiBfaW1wbDsKICAgIH0KCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIE9iamVjdCBzZXRJbXBsRGF0YShPYmplY3QgZGF0YSwg\nYm9vbGVhbiBjYWNoZWFibGUpIHsKICAgICAgICBPYmplY3Qgb2xkID0gX2lt\ncGw7CiAgICAgICAgX2ltcGwgPSBkYXRhOwogICAgICAgIGlmIChjYWNoZWFi\nbGUgJiYgZGF0YSAhPSBudWxsKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19JTVBMX0NBQ0hFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX0lNUExfQ0FDSEU7CiAgICAgICAgcmV0dXJuIG9sZDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19JTVBMX0NBQ0hFKSAh\nPSAwOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW1wbERhdGEoaW50\nIGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZp\nZWxkLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHNldEltcGxE\nYXRhKGludCBmaWVsZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICByZXR1cm4g\nc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRhdGEsIHRydWUpOwogICAgfQoK\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiBpc0ltcGxEYXRhQ2Fj\naGVhYmxlKGludCBmaWVsZCkgewogICAgICAgIGlmIChfZmllbGRJbXBsID09\nIG51bGwgfHwgIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIGlmIChfbWV0YS5nZXRGaWVsZChmaWVsZCku\ndXNlc0ltcGxEYXRhKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxkRGF0\nYUluZGV4KGZpZWxkKTsKICAgICAgICByZXR1cm4gaWR4ICE9IC0xICYmIF9m\naWVsZEltcGxbaWR4XSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0SW50ZXJtZWRpYXRlKGludCBmaWVsZCkgewogICAgICAgIHJldHVy\nbiBnZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEludGVybWVkaWF0ZShpbnQgZmllbGQsIE9iamVj\ndCBkYXRhKSB7CiAgICAgICAgc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRh\ndGEsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGF0YSBmcm9tIHRoZSBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxk\nIGRhdGEgYXJyYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVk\nIE9iamVjdCBnZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIGJvb2xlYW4g\naXNMb2FkZWQpIHsKICAgICAgICAvLyBvbmx5IHJldHVybiB0aGUgZmllbGQg\nZGF0YSBpZiB0aGUgZmllbGQgaXMgaW4gdGhlIHJpZ2h0IGxvYWRlZAogICAg\nICAgIC8vIHN0YXRlOyBvdGhlcndpc2Ugd2UgbWlnaHQgcmV0dXJuIGludGVy\nbWVkaWF0ZSBmb3IgaW1wbCBkYXRhIG9yCiAgICAgICAgLy8gdmljZSB2ZXJz\nYQogICAgICAgIGlmIChfZmllbGRJbXBsID09IG51bGwgfHwgX2xvYWRlZC5n\nZXQoZmllbGQpICE9IGlzTG9hZGVkKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJ\nbmRleChmaWVsZCk7CiAgICAgICAgcmV0dXJuIChpZHggPT0gLTEpID8gbnVs\nbCA6IF9maWVsZEltcGxbaWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZGF0YSBmcm9tIHRvIHByb3BlciBpbmRleCBvZiB0aGUgZXh0cmEg\nZmllbGQgZGF0YSBhcnJheS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJv\nbml6ZWQgT2JqZWN0IHNldEV4dHJhRmllbGREYXRhKGludCBmaWVsZCwgT2Jq\nZWN0IGRhdGEsCiAgICAgICAgYm9vbGVhbiBsb2FkZWQpIHsKICAgICAgICBp\nbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7\nCiAgICAgICAgaWYgKGlkeCA9PSAtMSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRhLmdldEZp\nZWxkKGZpZWxkKSkpOwoKICAgICAgICBPYmplY3Qgb2xkID0gKF9maWVsZElt\ncGwgPT0gbnVsbCkgPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgICAg\nIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gY2Fubm90IHNl\ndCBpZiBmaWVsZCBpbiB3cm9uZyBsb2FkZWQgc3RhdGUKICAgICAgICAgICAg\naWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSAhPSBsb2FkZWQpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVl\nT2YoX21ldGEuZ2V0RmllbGQKICAgICAgICAgICAgICAgICAgICAoZmllbGQp\nKSk7CgogICAgICAgICAgICAvLyBzZXQgZGF0YQogICAgICAgICAgICBpZiAo\nX2ZpZWxkSW1wbCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1w\nbCA9IG5ldyBPYmplY3RbX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgo\nKV07CiAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IGRhdGE7CiAgICAg\nICAgfSBlbHNlIGlmIChfZmllbGRJbXBsICE9IG51bGwgJiYgX2xvYWRlZC5n\nZXQoZmllbGQpID09IGxvYWRlZCkKICAgICAgICAgICAgX2ZpZWxkSW1wbFtp\nZHhdID0gbnVsbDsKICAgICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZmV0Y2goaW50IGZpZWxkKSB7CiAgICAgICAgT2JqZWN0\nIHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1\ncm4gX21ldGEuZ2V0RmllbGQoZmllbGQpLmdldEV4dGVybmFsVmFsdWUodmFs\nLCBfYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoRmll\nbGQoaW50IGZpZWxkLCBib29sZWFuIHRyYW5zaXRpb25zKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tZmllbGQiLAogICAgICAgICAg\nICAgICAgU3RyaW5nLnZhbHVlT2YoZmllbGQpLCBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKS5nZXRDbGFzcygpKSkuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRP\nYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICAvLyBkbyBu\nb3JtYWwgc3RhdGUgdHJhbnNpdGlvbnMKICAgICAgICBpZiAoIWZtZC5pc1By\naW1hcnlLZXkoKSAmJiB0cmFuc2l0aW9ucykKICAgICAgICAgICAgYWNjZXNz\naW5nRmllbGQoZmllbGQpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmll\nbGQoZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgICAgICByZXR1cm4gKGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoZmV0Y2hCeXRlRmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFjdGVyKGZldGNoQ2hhckZpZWxk\nKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKGZldGNoRG91Ymxl\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZldGNoRmxv\nYXRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZl\ndGNoSW50RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVl\nT2YoZmV0Y2hMb25nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNo\nb3J0KGZldGNoU2hvcnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQo\nZmllbGQpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9y\nZShpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICB2YWwgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCkuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIp\nOwogICAgICAgIHN0b3JlRmllbGQoZmllbGQsIHZhbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwp\nIHsKICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCB2YWwsIHRoaXMpOwogICAg\nfQoKICAgIC8qKgogICAgICogPHA+Q2hlY2tzIHdoZXRoZXIgb3Igbm90IDxj\nb2RlPl9wYzwvY29kZT4gaXMgZGlydHkuIEluIHRoZSBjYXNlcyB3aGVyZQog\nICAgICogZmllbGQgdHJhY2tpbmcgaXMgbm90IGhhcHBlbmluZyAoc2VlIGJl\nbG93KSwgdGhpcyBtZXRob2Qgd2lsbCBkbyBhCiAgICAgKiBzdGF0ZSBjb21w\nYXJpc29uIHRvIGZpbmQgd2hldGhlciA8Y29kZT5fcGM8L2NvZGU+IGlzIGRp\ncnR5LCBhbmQgd2lsbAogICAgICogdXBkYXRlIHRoaXMgaW5zdGFuY2Ugd2l0\naCB0aGlzIGluZm9ybWF0aW9uLiBJbiB0aGUgY2FzZXMgd2hlcmUgZmllbGQK\nICAgICAqIHRyYWNraW5nIGlzIGhhcHBlbmluZywgdGhpcyBtZXRob2QgaXMg\nYSBuby1vcC48L3A+CiAgICAgKgogICAgICogPHA+RmllbGRzIGFyZSB0cmFj\na2VkIGZvciBhbGwgY2xhc3NlcyB0aGF0IGFyZSBydW4gdGhyb3VnaCB0aGUg\nT3BlbkpQQQogICAgICogZW5oYW5jZXIgcHJpb3IgdG8gb3IgZHVyaW5nIGRl\ncGxveW1lbnQsIGFuZCBhbGwgY2xhc3NlcyAoZW5oYW5jZWQgb3IKICAgICAq\nIHVuZW5oYW5jZWQpIGluIGEgSmF2YSA2IGVudmlyb25tZW50IG9yIG5ld2Vy\nLjwvcD4KICAgICAqCiAgICAgKiA8cD5JbiBhIEphdmEgNSBWTSBvciBvbGRl\ncjoKICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNz\nZXMgdGhhdCB1c2UKICAgICAqIHByb3BlcnR5IGFjY2VzcyBhbmQgb2JleSB0\naGUgcHJvcGVydHkgYWNjZXNzIGxpbWl0YXRpb25zIGFyZSB0cmFja2VkCiAg\nICAgKiB3aGVuIHRoZSBpbnN0YW5jZXMgYXJlIGxvYWRlZCBmcm9tIHRoZSBk\nYXRhYmFzZSBieSBPcGVuSlBBLCBhbmQgYXJlCiAgICAgKiBub3QgdHJhY2tl\nZCB3aGVuIHRoZSBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYnkgYXBwbGljYXRp\nb24gY29kZS4KICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2Vk\nIGNsYXNzZXMgdGhhdCB1c2UgZmllbGQgYWNjZXNzIGFyZQogICAgICogbmV2\nZXIgdHJhY2tlZC48L3A+CiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGRpcnR5Q2hlY2soKSB7CiAgICAgICAg\naWYgKCFuZWVkc0RpcnR5Q2hlY2soKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBTYXZlRmllbGRNYW5hZ2VyIHNhdmVkID0gZ2V0U2F2ZUZpZWxk\nTWFuYWdlcigpOwogICAgICAgIGlmIChzYXZlZCA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXNhdmVkLWZpZWxkcyIpKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBnZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAvLyBwayBhbmQgdmVyc2lvbiBmaWVsZHMgY2Fubm90IGJlIG11dGF0ZWQ7\nIGRvbid0IG1hcmsgdGhlbQogICAgICAgICAgICAvLyBhcyBzdWNoLiAjIyMj\nIyB2YWxpZGF0ZT8KICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFy\neUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigpCiAgICAgICAgICAgICAg\nICAmJiBfbG9hZGVkLmdldChpKSkgewogICAgICAgICAgICAgICAgaWYgKCFz\nYXZlZC5pc0ZpZWxkRXF1YWwoaSwgZmV0Y2goaSkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgZGlydHkoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIG5l\nZWRzRGlydHlDaGVjaygpIHsKICAgICAgICBpZiAoaXNJbnRlcmNlcHRpbmco\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc0Rl\nbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChpc05ldygpICYmICFpc0ZsdXNoZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZmV0Y2hJbml0aWFsRmllbGQoaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0gUmVz\ndG9yZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAoKF9mbGFn\ncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgfHwgZm1kLmdl\ndEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJl\nc3RvcmUtdW5zZXQiKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgbm90IHNhdmluZyBtdXRh\nYmxlIHR5cGVzLCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICAgICAgICAg\nIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0\nZS5SRVNUT1JFX0FMTAogICAgICAgICAgICAgICAgICAgICYmICgoX2ZsYWdz\nICYgRkxBR19JTlZFUlNFUykgPT0gMAogICAgICAgICAgICAgICAgICAgIHx8\nIGZtZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJtdXRhYmxl\nLXJlc3RvcmUtdW5zZXQiKSk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxs\nIHx8ICFfbG9hZGVkLmdldChmaWVsZCkgfHwgIV9kaXJ0eS5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoRmllbGQoZmllbGQsIGZh\nbHNlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBpcyBkaXJ0eSBi\ndXQgd2UgbmV2ZXIgbG9hZGVkIGl0LCB3ZSBjYW4ndCByZXN0b3JlIGl0CiAg\nICAgICAgICAgIGlmIChfc2F2ZWQuZ2V0VW5sb2FkZWQoKS5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiaW5pdGlhbC11bmxvYWRlZCIsCiAgICAgICAgICAg\nICAgICAgICAgZm1kKSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3Nh\ndmVkLmdldFN0YXRlKCksIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncmV0dXJuIGZldGNoRmllbGQoX3NpbmdsZSwgZm1kKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGZXRjaCB0aGUgc3BlY2lmaWVkIGZpZWxkIGZy\nb20gdGhlIHNwZWNpZmllZCBmaWVsZCBtYW5hZ2VyLCB3cmFwcGluZyBpdAog\nICAgICogaW4gYW4gb2JqZWN0IGlmIGl0J3MgYSBwcmltaXRpdmUuIEEgZmll\nbGQgc2hvdWxkIGJlIHByb3ZpZGVkIHRvIHRoZQogICAgICogZmllbGQgbWFu\nYWdlciBiZWZvcmUgdGhpcyBjYWxsIGlzIG1hZGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIE9iamVjdCBmZXRjaEZpZWxkKEZpZWxkTWFuYWdlciBm\nbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgZmllbGQgPSBm\nbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZm0uZmV0Y2hCb29sZWFu\nRmllbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAg\nICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZShmbS5m\nZXRjaEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0\nZXIoZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBEb3VibGUoZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCkpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgRmxvYXQoZm0uZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAg\nIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hJbnRGaWVsZChmaWVs\nZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmbS5mZXRjaExvbmdG\naWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQoZm0uZmV0Y2hT\naG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaFN0cmlu\nZ0ZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVtb3RlKGludCBm\naWVsZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxk\nLCBCb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAgICAgICAgIHN0b3JlRmll\nbGQoZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0\nRGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9wZXJhdGlvbnMKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogTm90aWZp\nY2F0aW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91dCB0byBiZSBhY2Nlc3Nl\nZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxkIG51bWJl\nciBiZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBzaW5nbGUKICAgICAqIGZp\nZWxkIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZvcmVSZWFkKGludCBmaWVs\nZCkgewogICAgICAgIC8vIGFsbG93IHVubWVkaWF0ZWQgcmVhZHMgb2YgcHJp\nbWFyeSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZpZWxkICE9IC0xICYmIF9t\nZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tlci5pc0FjdGl2ZSgpICYm\nICFfYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmcoKSkgewogICAgICAgICAg\nICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAg\nICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGljUmVhZCh0aGlz\nLCBmaWVsZCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRoaXMsIGZpZWxkKSk7CiAg\nICAgICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxS\nZWFkKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU5v\nbnRyYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4KICAgICAgICAgICAgICAg\nIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3Rh\ndGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2JlZm9yZUZsdXNoCiAg\nICAgKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50IHJlYXNvbiwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5iZWZvcmVGbHVzaCh0aGlz\nLCByZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMLCBjYWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVu\ndCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZmx1c2gKICAg\nICAqLwogICAgdm9pZCBhZnRlckZsdXNoKGludCByZWFzb24pIHsKICAgICAg\nICAvLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBmbHVzaCBub24tcGVyc2lz\ndGVudCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChyZWFzb24gIT0gQnJva2Vy\nSW1wbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAgICAmJiByZWFzb24gIT0g\nQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAgICAgIC8vIGFs\nbCBkaXJ0eSBmaWVsZHMgd2VyZSBmbHVzaGVkCiAgICAgICAgICAgIF9mbHVz\naC5vcihfZGlydHkpOwoKICAgICAgICAgICAgLy8gaW1wb3J0YW50IHRvIHNl\ndCBmbHVzaGVkIGJpdCBhZnRlciBjYWxsaW5nIF9zdGF0ZS5mbHVzaCBzbwog\nICAgICAgICAgICAvLyB0aGF0IHRoZSBzdGF0ZSBjYW4gdGVsbCB3aGV0aGVy\nIHRoaXMgaXMgdGhlIGZpcnN0IGZsdXNoCiAgICAgICAgICAgIHNldFBDU3Rh\ndGUoX3N0YXRlLmZsdXNoKHRoaXMpKTsKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZM\nVVNIRURfRElSVFk7CgogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVS\nU0lPTl9DSEVDSzsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJ\nT05fVVBEQVRFOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyB3YXMgYW4gaW5j\nIGZsdXNoIGR1cmluZyB3aGljaCB3ZSBoYWQgb3VyIGlkZW50aXR5CiAgICAg\nICAgICAgIC8vIGFzc2lnbmVkLCB0ZWxsIHRoZSBicm9rZXIgdG8gY2FjaGUg\ndXMgdW5kZXIgb3VyIGZpbmFsIG9pZAogICAgICAgICAgICBpZiAocmVhc29u\nID09IEJyb2tlckltcGwuRkxVU0hfSU5DKQogICAgICAgICAgICAgICAgYXNz\nZXJ0T2JqZWN0SWRBc3NpZ25lZCh0cnVlKTsKCiAgICAgICAgICAgIC8vIGlm\nIHRoaXMgb2JqZWN0IHdhcyBzdG9yZWQgd2l0aCBwcmVGbHVzaCwgZG8gcG9z\ndC1zdG9yZSBjYWxsYmFjawogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfUFJFX0ZMVVNIRUQpID4gMCkKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9TVE9SRSk7CiAgICAg\nICAgfSBlbHNlIGlmIChyZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9ST0xM\nQkFDSykgewogICAgICAgICAgICAvLyByZXZlcnQgdG8gbGFzdCBsb2FkZWQg\ndmVyc2lvbiBhbmQgb3JpZ2luYWwgb2lkCiAgICAgICAgICAgIGFzc2lnblZl\ncnNpb25GaWVsZChfbG9hZFZlcnNpb24pOwogICAgICAgICAgICBpZiAoaXNO\nZXcoKSAmJiAoX2ZsYWdzICYgRkxBR19PSURfQVNTSUdORUQpID09IDApCiAg\nICAgICAgICAgICAgICBfb2lkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX1BSRV9GTFVTSEVEOwogICAgfQoKICAgIC8qKgog\nICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVyIGNo\nZWNraW5nIHRoZSB2YWx1ZQogICAgICogb2YgdGhlIFJldGFpblN0YXRlIGZs\nYWcuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2NvbW1pdAogICAgICog\nQHNlZSBQQ1N0YXRlI2NvbW1pdFJldGFpbgogICAgICovCiAgICB2b2lkIGNv\nbW1pdCgpIHsKICAgICAgICAvLyByZWxlYXNlIGxvY2tzIGJlZm9yZSBvaWQg\ndXBkYXRlZAogICAgICAgIHJlbGVhc2VMb2NrcygpOwoKICAgICAgICAvLyB1\ncGRhdGUgdmVyc2lvbiBhbmQgb2lkIGluZm9ybWF0aW9uCiAgICAgICAgc2V0\nVmVyc2lvbihfdmVyc2lvbik7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZM\nVVNIRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7\nCgogICAgICAgIE9iamVjdCBvcmlnID0gX2lkOwogICAgICAgIGFzc2VydE9i\namVjdElkQXNzaWduZWQoZmFsc2UpOwoKICAgICAgICBib29sZWFuIHdhc05l\ndyA9IGlzTmV3KCkgJiYgIWlzRGVsZXRlZCgpICYmICFpc1Byb3Zpc2lvbmFs\nKCk7CiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmV0YWluU3RhdGUoKSkKICAg\nICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuY29tbWl0UmV0YWluKHRoaXMp\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRl\nLmNvbW1pdCh0aGlzKSk7CgogICAgICAgIC8vIGFzayB0aGUgYnJva2VyIHRv\nIHJlLWNhY2hlIHVzIGlmIHdlIHdlcmUgbmV3IHByZXZpb3VzbHkKICAgICAg\nICBpZiAod2FzTmV3KQogICAgICAgICAgICBfYnJva2VyLnNldFN0YXRlTWFu\nYWdlcihvcmlnLCB0aGlzLCBCcm9rZXJJbXBsLlNUQVRVU19DT01NSVRfTkVX\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3Vy\ncmVudCBzdGF0ZSBhZnRlciBjaGVja2luZyB0aGUgdmFsdWUKICAgICAqIG9m\nIHRoZSBSZXRhaW5TdGF0ZSBmbGFnLgogICAgICoKICAgICAqIEBzZWUgUENT\ndGF0ZSNyb2xsYmFjawogICAgICogQHNlZSBQQ1N0YXRlI3JvbGxiYWNrUmVz\ndG9yZQogICAgICovCiAgICB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIC8v\nIHJlbGVhc2UgbG9ja3MKICAgICAgICByZWxlYXNlTG9ja3MoKTsKICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRF9ESVJUWTsKICAgICAgICBhZnRlckZsdXNoKEJyb2tl\nckltcGwuRkxVU0hfUk9MTEJBQ0spOwoKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRSZXN0b3JlU3RhdGUoKSAhPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05F\nKQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFja1Jlc3Rv\ncmUodGhpcykpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUucm9sbGJhY2sodGhpcykpOwogICAgfQoKICAgIC8qKgogICAg\nICogUm9sbGJhY2sgc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5zdGFuY2UgdG8g\ndGhlIGdpdmVuIHNhdmVwb2ludC4KICAgICAqLwogICAgdm9pZCByb2xsYmFj\na1RvU2F2ZXBvaW50KFNhdmVwb2ludEZpZWxkTWFuYWdlciBzYXZlcG9pbnQp\nIHsKICAgICAgICBfc3RhdGUgPSBzYXZlcG9pbnQuZ2V0UENTdGF0ZSgpOwog\nICAgICAgIEJpdFNldCBsb2FkZWQgPSBzYXZlcG9pbnQuZ2V0TG9hZGVkKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IGxvYWRlZC5sZW5ndGgo\nKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGlmIChsb2FkZWQuZ2V0\nKGkpICYmIHNhdmVwb2ludC5yZXN0b3JlRmllbGQoaSkpIHsKICAgICAgICAg\nICAgICAgIHByb3ZpZGVGaWVsZChzYXZlcG9pbnQuZ2V0Q29weSgpLCBzYXZl\ncG9pbnQsIGkpOwogICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywg\nc2F2ZXBvaW50LCBpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBfbG9hZGVkID0gbG9hZGVkOwogICAgICAgIF9kaXJ0eSA9IHNhdmVwb2lu\ndC5nZXREaXJ0eSgpOwogICAgICAgIF9mbHVzaCA9IHNhdmVwb2ludC5nZXRG\nbHVzaGVkKCk7CiAgICAgICAgX3ZlcnNpb24gPSBzYXZlcG9pbnQuZ2V0VmVy\nc2lvbigpOwogICAgICAgIF9sb2FkVmVyc2lvbiA9IHNhdmVwb2ludC5nZXRM\nb2FkVmVyc2lvbigpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVz\nIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENT\ndGF0ZSNwZXJzaXN0CiAgICAgKiBAc2VlIEJyb2tlciNwZXJzaXN0CiAgICAg\nKi8KICAgIHZvaWQgcGVyc2lzdCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9z\ndGF0ZS5wZXJzaXN0KHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERl\nbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBA\nc2VlIFBDU3RhdGUjZGVsZXRlCiAgICAgKiBAc2VlIEJyb2tlciNkZWxldGUK\nICAgICAqLwogICAgdm9pZCBkZWxldGUoKSB7CiAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUuZGVsZXRlKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAg\nKiBAc2VlIFBDU3RhdGUjbm9udHJhbnNhY3Rpb25hbAogICAgICogQHNlZSBC\ncm9rZXIjbm9udHJhbnNhY3Rpb25hbAogICAgICovCiAgICB2b2lkIG5vbnRy\nYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUubm9u\ndHJhbnNhY3Rpb25hbCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\nZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICog\nQHNlZSBQQ1N0YXRlI3RyYW5zYWN0aW9uYWwKICAgICAqIEBzZWUgQnJva2Vy\nI3RyYW5zYWN0aW9uYWwKICAgICAqLwogICAgdm9pZCB0cmFuc2FjdGlvbmFs\nKCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnRyYW5zYWN0aW9uYWwo\ndGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRo\nZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNu\nb25wcm92aXNpb25hbAogICAgICovCiAgICB2b2lkIG5vbnByb3Zpc2lvbmFs\nKGJvb2xlYW4gbG9naWNhbCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIHNldFBDU3RhdGUoX3N0YXRlLm5vbnByb3Zpc2lvbmFsKHRoaXMsIGxvZ2lj\nYWwsIGNhbGwpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0\nbyB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3Rh\ndGUjcmVsZWFzZQogICAgICogQHNlZSBCcm9rZXIjcmVsZWFzZQogICAgICov\nCiAgICB2b2lkIHJlbGVhc2UoYm9vbGVhbiB1bnByb3h5KSB7CiAgICAgICAg\ncmVsZWFzZSh1bnByb3h5LCBmYWxzZSk7CiAgICB9CgogICAgdm9pZCByZWxl\nYXNlKGJvb2xlYW4gdW5wcm94eSwgYm9vbGVhbiBmb3JjZSkgewogICAgICAg\nIC8vIG9wdGltaXphdGlvbiBmb3IgZGV0YWNoLWluLXBsYWNlIHNwZWNpYWwg\nY2FzZSB3aGVuIGZpZWxkcyBhcmUKICAgICAgICAvLyBhbHJlYWR5ICh1bilw\ncm94aWVkIGNvcnJlY3RseQogICAgICAgIGlmICghdW5wcm94eSkKICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfTk9fVU5QUk9YWTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoZm9yY2UpCiAgICAgICAgICAgICAgICBzZXRQ\nQ1N0YXRlKFBDU3RhdGUuVFJBTlNJRU5UKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUucmVsZWFzZSh0aGlz\nKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX05PX1VOUFJPWFk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoK\nICAgICAqIEBzZWUgUENTdGF0ZSNldmljdAogICAgICogQHNlZSBCcm9rZXIj\nZXZpY3QKICAgICAqLwogICAgdm9pZCBldmljdCgpIHsKICAgICAgICBzZXRQ\nQ1N0YXRlKF9zdGF0ZS5ldmljdCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHYXRoZXIgcmVsYXRpb25zIHJlYWNoYWJsZSBmcm9tIHZhbHVlcyB1\nc2luZwogICAgICoge0BsaW5rIFZhbHVlTWV0YURhdGEjQ0FTQ0FERV9JTU1F\nRElBVEV9LgogICAgICovCiAgICB2b2lkIGdhdGhlckNhc2NhZGVSZWZyZXNo\nKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nIV9sb2FkZWQuZ2V0KGkpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRlUmVmcmVzaCgpID09\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUKICAgICAgICAgICAg\nICAgIHx8IGZtZHNbaV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZVJlZnJlc2goKQog\nICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVE\nSUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCku\nZ2V0Q2FzY2FkZVJlZnJlc2goKQogICAgICAgICAgICAgICAgPT0gVmFsdWVN\nZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAgICAgICAgICAg\nX3NpbmdsZS5zdG9yZU9iamVjdEZpZWxkKGksIGZldGNoRmllbGQoaSwgZmFs\nc2UpKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuZ2F0aGVyQ2FzY2FkZVJl\nZnJlc2goY2FsbCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gYmVmb3JlUmVmcmVzaChib29sZWFuIHJlZnJlc2hBbGwpIHsKICAg\nICAgICAvLyBub3RlOiBhbGwgbG9naWMgcGxhY2VkIGhlcmUgcmF0aGVyIHRo\nYW4gaW4gdGhlIHN0YXRlcyBmb3IKICAgICAgICAvLyBvcHRpbWl6YXRpb247\nIHRoaXMgbWV0aG9kIHB1YmxpYyBiL2MgdXNlZCBieSByZW1vdGUgcGFja2Fn\nZQoKICAgICAgICAvLyBub3RoaW5nIHRvIGRvIGZvciBub24gcGVyc2lzdGVu\ndCBvciBuZXcgdW5mbHVzaGVkIGluc3RhbmNlcwogICAgICAgIGlmICghaXNQ\nZXJzaXN0ZW50KCkgfHwgKGlzTmV3KCkgJiYgIWlzRmx1c2hlZCgpKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgZGlydHkgbmVlZCB0byBjbGVh\nciBmaWVsZHMKICAgICAgICAgICAgaWYgKGlzRGlydHkoKSkgewogICAgICAg\nICAgICAgICAgY2xlYXJGaWVsZHMoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBzb21l\nIGZpZWxkcyBoYXZlIGJlZW4gbG9hZGVkIGJ1dCB0aGUgaW5zdGFuY2UgaXMg\nb3V0IG9mCiAgICAgICAgICAgIC8vIGRhdGUgb3IgdGhpcyBpcyBwYXJ0IG9m\nIGEgcmVmcmVzaEFsbCgpIGFuZCB3ZSBkb24ndCB3YW50IHRvCiAgICAgICAg\nICAgIC8vIHRha2UgdGhlIGV4dHJhIGhpdCB0byBzZWUgaWYgdGhlIGluc3Rh\nbmNlIGlzIG91dCBvZiBkYXRlLCBjbGVhcgogICAgICAgICAgICBpZiAoX2xv\nYWRlZC5sZW5ndGgoKSA+IDAgJiYgKHJlZnJlc2hBbGwgfHwgaXNFbWJlZGRl\nZCgpCiAgICAgICAgICAgICAgICB8fCAhc3luY1ZlcnNpb24obnVsbCkpKSB7\nCiAgICAgICAgICAgICAgICBPYmplY3QgdmVyc2lvbiA9IF92ZXJzaW9uOwog\nICAgICAgICAgICAgICAgY2xlYXJGaWVsZHMoKTsKCiAgICAgICAgICAgICAg\nICAvLyBpZiBzeW5jVmVyc2lvbiBqdXN0IHJlcGxhY2VkIHRoZSB2ZXJzaW9u\nLCByZXNldCBpdAogICAgICAgICAgICAgICAgaWYgKCFyZWZyZXNoQWxsICYm\nICFpc0VtYmVkZGVkKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0VmVyc2lv\nbih2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHN0YXRlIHRyYW5zaXRpb25z\nIGFmdGVyIHJlZnJlc2guIFRoaXMgbWV0aG9kIGlzIG9ubHkKICAgICAqIGNh\nbGxlZCBpZiB7QGxpbmsgI2JlZm9yZVJlZnJlc2h9IHJldHVybnMgdHJ1ZS4K\nICAgICAqLwogICAgdm9pZCBhZnRlclJlZnJlc2goKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHRyYW5zaXRpb24g\ndG8gY2xlYW4gb3Igbm9udHJhbnNhY3Rpb25hbCBkZXBlbmRpbmcgb24gdHJh\nbnMgc3RhdHVzCiAgICAgICAgICAgIGlmICghX2Jyb2tlci5pc0FjdGl2ZSgp\nKQogICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYWZ0ZXJOb250\ncmFuc2FjdGlvbmFsUmVmcmVzaCgpKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICBzZXRQ\nQ1N0YXRlKF9zdGF0ZS5hZnRlck9wdGltaXN0aWNSZWZyZXNoKCkpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0\nZS5hZnRlclJlZnJlc2goKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogTWFyayB0aGlzIG9iamVjdCBhcyBhIGRlcmVmZXJlbmNlZCBkZXBlbmRl\nbnQgb2JqZWN0LgogICAgICovCiAgICB2b2lkIHNldERlcmVmZXJlbmNlZERl\ncGVuZGVudChib29sZWFuIGRlcmVmLCBib29sZWFuIG5vdGlmeSkgewogICAg\nICAgIGlmICghZGVyZWYgJiYgKF9mbGFncyAmIEZMQUdfREVSRUYpID4gMCkg\newogICAgICAgICAgICBpZiAobm90aWZ5KQogICAgICAgICAgICAgICAgX2Jy\nb2tlci5yZW1vdmVEZXJlZmVyZW5jZWREZXBlbmRlbnQodGhpcyk7CiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19ERVJFRjsKICAgICAgICB9IGVsc2Ug\naWYgKGRlcmVmICYmIChfZmxhZ3MgJiBGTEFHX0RFUkVGKSA9PSAwKSB7CiAg\nICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0RFUkVGOwogICAgICAgICAgICBp\nZiAobm90aWZ5KQogICAgICAgICAgICAgICAgX2Jyb2tlci5hZGREZXJlZmVy\nZW5jZWREZXBlbmRlbnQodGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nLy8vLy8vLy8vCiAgICAvLyBMb2NraW5nCiAgICAvLy8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQgd2UndmUgYmVlbiByZWFk\nLWxvY2tlZC4gUGFzcyBpbiB0aGUgbGV2ZWwgYXQgd2hpY2gKICAgICAqIHdl\nIHdlcmUgbG9ja2VkIGFuZCB0aGUgbGV2ZWwgYXQgd2hpY2ggd2Ugc2hvdWxk\nIHdyaXRlIGxvY2sgb3Vyc2VsdmVzCiAgICAgKiBvbiBkaXJ0eS4KICAgICAq\nLwogICAgdm9pZCByZWFkTG9ja2VkKGludCByZWFkTG9ja0xldmVsLCBpbnQg\nd3JpdGVMb2NrTGV2ZWwpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0\nIGlzIGFkZGVkIHRvIHRyYW5zYWN0aW9uIHNvIGxvY2sgd2lsbCBnZXQKICAg\nICAgICAvLyBjbGVhcmVkIG9uIGNvbW1pdC9yb2xsYmFjawogICAgICAgIGlm\nIChyZWFkTG9ja0xldmVsICE9IExvY2tMZXZlbHMuTE9DS19OT05FKQogICAg\nICAgICAgICB0cmFuc2FjdGlvbmFsKCk7CgogICAgICAgIF9yZWFkTG9ja0xl\ndmVsID0gcmVhZExvY2tMZXZlbDsKICAgICAgICBfd3JpdGVMb2NrTGV2ZWwg\nPSB3cml0ZUxvY2tMZXZlbDsKICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRUFE\nX0xPQ0tFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfV1JJVEVfTE9DS0VE\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsb2NrIGxldmVs\nIHRvIHVzZSB3aGVuIGxvYWRpbmcgc3RhdGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgaW50IGNhbGN1bGF0ZUxvY2tMZXZlbChib29sZWFuIGFjdGl2ZSwgYm9v\nbGVhbiBmb3JXcml0ZSwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICBpZiAoIWFjdGl2ZSkKICAgICAgICAgICAgcmV0dXJu\nIExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgICAgIGlmIChmZXRjaCA9PSBu\ndWxsKQogICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25m\naWd1cmF0aW9uKCk7CgogICAgICAgIGlmIChfcmVhZExvY2tMZXZlbCA9PSAt\nMSkKICAgICAgICAgICAgX3JlYWRMb2NrTGV2ZWwgPSBmZXRjaC5nZXRSZWFk\nTG9ja0xldmVsKCk7CiAgICAgICAgaWYgKF93cml0ZUxvY2tMZXZlbCA9PSAt\nMSkKICAgICAgICAgICAgX3dyaXRlTG9ja0xldmVsID0gZmV0Y2guZ2V0V3Jp\ndGVMb2NrTGV2ZWwoKTsKICAgICAgICByZXR1cm4gKGZvcldyaXRlKSA/IF93\ncml0ZUxvY2tMZXZlbCA6IF9yZWFkTG9ja0xldmVsOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBzdXJlIHdlJ3JlIGxvY2tlZCBhdCB0aGUgZ2l2ZW4g\nbGV2ZWwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBvYnRhaW5Mb2Nrcyhi\nb29sZWFuIGFjdGl2ZSwgYm9vbGVhbiBmb3JXcml0ZSwgaW50IGxvY2tMZXZl\nbCwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBz\nZGF0YSkgewogICAgICAgIGlmICghYWN0aXZlKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGlmIHdlIGhhdmVuJ3QgYmVlbiBsb2NrZWQgeWV0\nLCBsb2NrIG5vdyBhdCB0aGUgZ2l2ZW4gbGV2ZWwKICAgICAgICBpbnQgZmxh\nZyA9IChmb3JXcml0ZSkgPyBGTEFHX1dSSVRFX0xPQ0tFRCA6IEZMQUdfUkVB\nRF9MT0NLRUQ7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBmbGFnKSA9PSAwKSB7\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBvYmplY3QgaXMgYWRkZWQgdG8g\ndHJhbnNhY3Rpb24gc28gbG9jayB3aWxsIGdldAogICAgICAgICAgICAvLyBj\nbGVhcmVkIG9uIGNvbW1pdC9yb2xsYmFjawogICAgICAgICAgICBpZiAobG9j\na0xldmVsICE9IExvY2tMZXZlbHMuTE9DS19OT05FKQogICAgICAgICAgICAg\nICAgdHJhbnNhY3Rpb25hbCgpOwoKICAgICAgICAgICAgaWYgKGZldGNoID09\nIG51bGwpCiAgICAgICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0\nY2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIF9icm9rZXIuZ2V0TG9j\na01hbmFnZXIoKS5sb2NrKHRoaXMsIGxvY2tMZXZlbCwKICAgICAgICAgICAg\nICAgIGZldGNoLmdldExvY2tUaW1lb3V0KCksIHNkYXRhKTsKICAgICAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgICAgIF9m\nbGFncyB8PSBmbGFnOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbGVhc2UgbG9ja3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWxl\nYXNlTG9ja3MoKSB7CiAgICAgICAgaWYgKF9sb2NrICE9IG51bGwpCiAgICAg\nICAgICAgIF9icm9rZXIuZ2V0TG9ja01hbmFnZXIoKS5yZWxlYXNlKHRoaXMp\nOwogICAgICAgIF9yZWFkTG9ja0xldmVsID0gLTE7CiAgICAgICAgX3dyaXRl\nTG9ja0xldmVsID0gLTE7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFQURf\nTE9DS0VEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19XUklURV9MT0NLRUQ7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIFN0YXRlTWFu\nYWdlciBpbnRlcmZhY2UKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gc2VyaWFs\naXppbmcoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9tZXRh\nLmlzRGV0YWNoYWJsZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIERldGFj\naE1hbmFnZXIucHJlU2VyaWFsaXplKHRoaXMpOwoKICAgICAgICAgICAgbG9h\nZChfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpLCBMT0FEX1NFUklB\nTElaRSwgbnVsbCwgbnVsbCwgCiAgICAgICAgICAgICAgICBmYWxzZSk7CiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZShyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHdy\naXRlRGV0YWNoZWQoT2JqZWN0T3V0cHV0IG91dCkKICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIEJpdFNldCBpZHhzID0gbmV3IEJpdFNl\ndChfbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGgpOwogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIGRldHNtID0gRGV0\nYWNoTWFuYWdlci53cml0ZURldGFjaGVkU3RhdGUodGhpcywgb3V0LCBpZHhz\nKTsKICAgICAgICAgICAgaWYgKGRldHNtKQogICAgICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfREVUQUNISU5HOwoKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgcHJvdmlk\nZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICBfc2lu\nZ2xlLnNlcmlhbGl6ZShvdXQsICFpZHhzLmdldChpKSk7CiAgICAgICAgICAg\nICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19ERVRBQ0hJTkc7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm94eURldGFjaGVkRGVzZXJpYWxp\nemVkKGludCBpZHgpIHsKICAgICAgICAvLyB3ZSBkb24ndCBzZXJpYWxpemUg\nc3RhdGUgbWFuYWdlciBpbXBscwogICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVHJh\nbnNhY3Rpb25hbCgpIHsKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIFRD\nTEVBTiwgd2hpY2ggd2Ugd2FudCB0byBhcHBlYXIgbm9uLXRyYW5zIHRvCiAg\nICAgICAgLy8gaW50ZXJuYWwgY29kZSwgYnV0IHdoaWNoIHB1YmxpY2x5IHNo\nb3VsZCBiZSB0cmFuc2FjdGlvbmFsCiAgICAgICAgcmV0dXJuIF9zdGF0ZSA9\nPSBQQ1N0YXRlLlRDTEVBTiB8fCBfc3RhdGUuaXNUcmFuc2FjdGlvbmFsKCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZW5kaW5nVHJhbnNhY3Rp\nb25hbCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzUGVuZGluZ1RyYW5z\nYWN0aW9uYWwoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1Byb3Zp\nc2lvbmFsKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNQcm92aXNpb25h\nbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUGVyc2lzdGVudCgp\nIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzUGVyc2lzdGVudCgpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTmV3KCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUuaXNOZXcoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0RlbGV0ZWQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc0RlbGV0ZWQo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAg\nICAgIHJldHVybiBfc3RhdGUuaXNEaXJ0eSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzRGV0YWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBGTEFHX0RFVEFDSElORykgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGdldEdlbmVyaWNDb250ZXh0KCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3RJ\nZCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NpZ25PYmplY3RJ\nZCh0cnVlKTsKICAgICAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCB8fCAhX2Jy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICBnZXRD\nb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRDb3B5T2JqZWN0SWRzKCkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gX29pZDsKCiAgICAgICAgICAgIGlmIChf\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RB\nVEFTVE9SRSkKICAgICAgICAgICAgICAgIHJldHVybiBfYnJva2VyLmdldFN0\nb3JlTWFuYWdlcigpLmNvcHlEYXRhU3RvcmVJZChfb2lkLCBfbWV0YSk7CiAg\nICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIF9t\nZXRhKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0UENQcmltYXJ5S2V5KE9iamVj\ndCBvaWQsIGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIE9iamVjdCBwayA9\nIEFwcGxpY2F0aW9uSWRzLmdldChvaWQsIGZtZCk7CiAgICAgICAgaWYgKHBr\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBD\nbGFzc01ldGFEYXRhIHJlbG1ldGEgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlTWV0\nYURhdGEoKTsKICAgICAgICBpZiAocmVsbWV0YS5nZXRJZGVudGl0eVR5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRQogICAgICAgICAgICAm\nJiBmbWQuZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLkxPTkcpCiAgICAgICAgICAgIHBrID0gX2Jyb2tlci5nZXRTdG9yZU1hbmFn\nZXIoKS5uZXdEYXRhU3RvcmVJZChwaywgcmVsbWV0YSk7CiAgICAgICAgZWxz\nZSBpZiAocmVsbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLklEX0FQUExJQ0FUSU9OIAogICAgICAgICAgICAmJiBmbWQuZ2V0T2Jq\nZWN0SWRGaWVsZFR5cGUoKSAhPSByZWxtZXRhLmdldE9iamVjdElkVHlwZSgp\nKQogICAgICAgICAgICBwayA9IEFwcGxpY2F0aW9uSWRzLmZyb21QS1ZhbHVl\ncyhuZXcgT2JqZWN0W10geyBwayB9LCByZWxtZXRhKTsKICAgICAgICByZXR1\ncm4gX2Jyb2tlci5maW5kKHBrLCBmYWxzZSwgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIGJ5dGUgcmVwbGFjZUZsYWdzKCkgewogICAgICAgIC8vIHdlIGFs\nd2F5cyB1c2UgbG9hZCByZXF1aXJlZCBzbyB0aGF0IHdlIGNhbiBkZXRlY3Qg\nd2hlbiBvYmplY3RzCiAgICAgICAgLy8gYXJlIHRvdWNoZWQgZm9yIGxvY2tp\nbmcgb3IgbWFraW5nIHRyYW5zYWN0aW9uYWwKICAgICAgICByZXR1cm4gUGVy\nc2lzdGVuY2VDYXBhYmxlLkxPQURfUkVRVUlSRUQ7CiAgICB9CgogICAgcHVi\nbGljIFN0YXRlTWFuYWdlciByZXBsYWNlU3RhdGVNYW5hZ2VyKFN0YXRlTWFu\nYWdlciBzbSkgewogICAgICAgIHJldHVybiBzbTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBhY2Nlc3NpbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAv\nLyBwb3NzaWJseSBjaGFuZ2Ugc3RhdGUKICAgICAgICB0cnkgewogICAgICAg\nICAgICBiZWZvcmVSZWFkKGZpZWxkKTsKICAgICAgICAgICAgYmVmb3JlQWNj\nZXNzRmllbGQoZmllbGQpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZl\nbiBmaWVsZCBiZWZvcmUgYWNjZXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBiZWZvcmVBY2Nlc3NGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiBhY3Rp\ndmUgPSBfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgICAgIGludCBsb2Nr\nTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2ZWwoYWN0aXZlLCBmYWxzZSwgbnVs\nbCk7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAg\nICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBsb2NrTGV2ZWwsIGZhbHNl\nLCB0cnVlKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYXNz\naWduRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICAgICAgb2J0YWluTG9j\na3MoYWN0aXZlLCBmYWxzZSwgbG9ja0xldmVsLCBudWxsLCBudWxsKTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGRpcnR5KFN0cmluZyBmaWVsZCkgewogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAg\nIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRl\nKG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1maWVsZCIsIGZpZWxk\nLAogICAgICAgICAgICAgICAgSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFu\nY2UoX3BjKS5nZXRDbGFzcygpKSkKICAgICAgICAgICAgICAgIC5zZXRGYWls\nZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKCiAgICAgICAgZGly\ndHkoZm1kLmdldEluZGV4KCksIG51bGwsIHRydWUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGRpcnR5KGludCBmaWVsZCkgewogICAgICAgIGRpcnR5KGZp\nZWxkLCBudWxsLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\ndGhlIGdpdmVuIGZpZWxkIGRpcnR5LgogICAgICoKICAgICAqIEBwYXJhbSBt\ndXRhdGUgaWYgbnVsbCwgbWF5IGJlIGFuIFNDTyBtdXRhdGlvbjsgaWYgdHJ1\nZSwgaXMgY2VydGFpbmx5CiAgICAgKiBhIG11dGF0aW9uIChvciBhdCBsZWFz\ndCB0cmVhdCBhcyBvbmUpCiAgICAgKiBAcmV0dXJuIHtAbGluayBCb29sZWFu\nI0ZBTFNFfSBpZiB0aGlzIGluc3RhbmNlIHdhcyBhbHJlYWR5IGRpcnR5LAog\nICAgICogPGNvZGU+bnVsbDwvY29kZT4gaWYgaXQgd2FzIGRpcnR5IGJ1dCBu\nb3Qgc2luY2UgZmx1c2gsIGFuZAogICAgICoge0BsaW5rIEJvb2xlYW4jVFJV\nRX0gaWYgaXQgd2FzIG5vdCBkaXJ0eQogICAgICovCiAgICBwcml2YXRlIEJv\nb2xlYW4gZGlydHkoaW50IGZpZWxkLCBCb29sZWFuIG11dGF0ZSwgYm9vbGVh\nbiBsb2FkRmV0Y2hHcm91cCkgewogICAgICAgIGJvb2xlYW4gbG9ja2VkID0g\nZmFsc2U7CiAgICAgICAgYm9vbGVhbiBuZXdGbHVzaCA9IGZhbHNlOwogICAg\nICAgIGJvb2xlYW4gY2xlYW4gPSBmYWxzZTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICAgICAgaWYgKCFpc05ldygpIHx8IGlzRmx1c2hlZCgp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldFVwZGF0ZVN0cmF0ZWd5\nKCkgPT0gVXBkYXRlU3RyYXRlZ2llcy5SRVNUUklDVCkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgidXBkYXRlLXJlc3RyaWN0\nIiwgZm1kKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldFVwZGF0ZVN0\ncmF0ZWd5KCkgPT0gVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChpc0VtYmVkZGVkKCkpIHsKICAgICAgICAg\nICAgICAgIC8vIG5vdGlmeSBvd25lciBvZiBjaGFuZ2UKICAgICAgICAgICAg\nICAgIF9vd25lci5kaXJ0eShfb3duZXJNZXRhLmdldEZpZWxkTWV0YURhdGEo\nKS5nZXRJbmRleCgpLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uVFJV\nRSwgbG9hZEZldGNoR3JvdXApOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBpcyB0aGlzIGEgZGlyZWN0IG11dGF0aW9uIG9mIGFuIHNjbyBmaWVs\nZD8KICAgICAgICAgICAgaWYgKG11dGF0ZSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9O\nOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAg\nICAgICAgICAgICAgbXV0YXRlID0gQm9vbGVhbi5UUlVFOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRl\nID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmbWQuaXNFbWJlZGRl\nZCgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZSA9IEJvb2xl\nYW4uRkFMU0U7IC8vIG5vdCBzY28KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gcG9zc2libHkgY2hhbmdlIHN0YXRl\nCiAgICAgICAgICAgIGJvb2xlYW4gYWN0aXZlID0gX2Jyb2tlci5pc0FjdGl2\nZSgpOwogICAgICAgICAgICBjbGVhbiA9ICFfc3RhdGUuaXNEaXJ0eSgpOyAv\nLyBpbnRlbnRpb25hbCBkaXJlY3QgYWNjZXNzCgogICAgICAgICAgICAvLyBm\naXJlIGV2ZW50IGZhc3QgYmVmb3JlIHN0YXRlIGNoYW5nZS4KICAgICAgICAg\nICAgaWYgKGNsZWFuKQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2\nZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ESVJUWSk7CiAgICAgICAgICAg\nIGlmIChhY3RpdmUpIHsKICAgICAgICAgICAgICAgIGlmIChfYnJva2VyLmdl\ndE9wdGltaXN0aWMoKSkKICAgICAgICAgICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGljV3JpdGUodGhpcywgZmllbGQsCiAg\nICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29sZWFuVmFsdWUoKSkp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNl\ndFBDU3RhdGUoX3N0YXRlLmJlZm9yZVdyaXRlKHRoaXMsIGZpZWxkLAogICAg\nICAgICAgICAgICAgICAgICAgICBtdXRhdGUuYm9vbGVhblZhbHVlKCkpKTsK\nICAgICAgICAgICAgfSBlbHNlIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09\nIEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpIHsKICAgICAgICAg\nICAgICAgIGlmIChpc1BlcnNpc3RlbnQoKSAmJiAhX2Jyb2tlci5nZXROb250\ncmFuc2FjdGlvbmFsV3JpdGUoKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAgICAgICAgICgibm9uLXRyYW5zLXdyaXRlIikpLnNldEZhaWxl\nZE9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAoZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpOwoKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRl\nLmJlZm9yZU5vbnRyYW5zYWN0aW9uYWxXcml0ZSh0aGlzLCBmaWVsZCwKICAg\nICAgICAgICAgICAgICAgICBtdXRhdGUuYm9vbGVhblZhbHVlKCkpKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIRUQpICE9IDApIHsKICAgICAgICAgICAgICAgIG5ld0ZsdXNoID0gKF9m\nbGFncyAmIEZMQUdfRkxVU0hFRF9ESVJUWSkgPT0gMDsKICAgICAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNIRURfRElSVFk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGxvY2soKTsKICAgICAgICAgICAgbG9ja2VkID0g\ndHJ1ZTsKCiAgICAgICAgICAgIC8vIG5vdGUgdGhhdCB0aGUgZmllbGQgaXMg\naW4gbmVlZCBvZiBmbHVzaGluZyBhZ2FpbiwgYW5kIHRlbGwgdGhlCiAgICAg\nICAgICAgIC8vIGJyb2tlciB0b28KICAgICAgICAgICAgX2ZsdXNoLmNsZWFy\nKGZpZWxkKTsKICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCBu\nZXdGbHVzaCAmJiAhY2xlYW4pOwoKICAgICAgICAgICAgLy8gc2F2ZSB0aGUg\nZmllbGQgZm9yIHJvbGxiYWNrIGlmIG5lZWRlZAogICAgICAgICAgICBzYXZl\nRmllbGQoZmllbGQpOwoKICAgICAgICAgICAgLy8gZGlydHkgdGhlIGZpZWxk\nIGFuZCBtYXJrIGxvYWRlZDsgbG9hZCBmZXRjaCBncm91cCBpZiBuZWVkZWQK\nICAgICAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNhbGN1bGF0ZUxvY2tMZXZl\nbChhY3RpdmUsIHRydWUsIG51bGwpOwogICAgICAgICAgICBpZiAoIV9kaXJ0\neS5nZXQoZmllbGQpKSB7CiAgICAgICAgICAgICAgICBzZXRMb2FkZWQoZmll\nbGQsIHRydWUpOwogICAgICAgICAgICAgICAgX2RpcnR5LnNldChmaWVsZCk7\nCgogICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBmaWVsZCdzIGZl\ndGNoIGdyb3VwIGlzIGxvYWRlZAogICAgICAgICAgICAgICAgaWYgKGxvYWRG\nZXRjaEdyb3VwICYmIGlzUGVyc2lzdGVudCgpCiAgICAgICAgICAgICAgICAg\nICAgJiYgZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBmbWQuTUFOQUdFX1BFUlNJ\nU1RFTlQpCiAgICAgICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBs\nb2NrTGV2ZWwsIHRydWUsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIG9idGFpbkxvY2tzKGFjdGl2ZSwgdHJ1ZSwgbG9ja0xldmVsLCBudWxs\nLCBudWxsKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGxvY2tlZCkKICAgICAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNsZWFu\nKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIGlm\nIChuZXdGbHVzaCkgewogICAgICAgICAgICAvLyB0aGlzIGV2ZW50IGNhbiBi\nZSBmaXJlZCBsYXRlciBjYXVzZSB3ZSdyZSBhbHJlYWR5IGRpcnR5LgogICAg\nICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVG\nT1JFX0RJUlRZX0ZMVVNIRUQpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaXJlIHBvc3QtZGlydHkgZXZlbnRzIGFmdGVy\nIGZpZWxkIHZhbHVlIGNoYW5nZXMuCiAgICAgKgogICAgICogQHBhcmFtIHN0\nYXR1cyByZXR1cm4gdmFsdWUgZnJvbSB7QGxpbmsgI2RpcnR5KGludCwgQm9v\nbGVhbiwgYm9vbGVhbil9CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwb3N0\nRGlydHkoQm9vbGVhbiBzdGF0dXMpIHsKICAgICAgICBpZiAoQm9vbGVhbi5U\nUlVFLmVxdWFscyhzdGF0dXMpKQogICAgICAgICAgICBmaXJlTGlmZWN5Y2xl\nRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfRElSVFkpOwogICAgICAgIGVs\nc2UgaWYgKHN0YXR1cyA9PSBudWxsKQogICAgICAgICAgICBmaXJlTGlmZWN5\nY2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfRElSVFlfRkxVU0hFRCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlZChpbnQgZmllbGQsIE9i\namVjdCByZW1vdmVkLCBib29sZWFuIGtleSkgewogICAgICAgIGlmIChyZW1v\ndmVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gZGVyZWZlcmVuY2UgZGVwZW5kZW50IGZpZWxk\ncywgZGVsZXRlIGVtYmVkZGVkCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICBWYWx1\nZU1ldGFEYXRhIHZtZCA9IChrZXkpID8gZm1kLmdldEtleSgpIDogZm1kLmdl\ndEVsZW1lbnQoKTsKICAgICAgICAgICAgaWYgKHZtZC5pc0VtYmVkZGVkUEMo\nKSkKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVsZXRlKHZtZCwgcmVtb3Zl\nZCwgbnVsbCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHZtZC5nZXRDYXNjYWRl\nRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pCiAgICAg\nICAgICAgICAgICBfc2luZ2xlLmRlcmVmZXJlbmNlRGVwZW5kZW50KHJlbW92\nZWQpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBuZXdQcm94eShpbnQgZmllbGQpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICByZXR1cm4gbmV3RmllbGRQcm94eShmaWVsZCk7CgogICAgICAg\nIHN3aXRjaCAoZm1kLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCkgPT0gamF2YS5zcWwuRGF0ZS5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IGphdmEuc3FsLkRhdGUoU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCkpOwogICAgICAgICAgICAgICAgaWYgKGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNxbC5UaW1lc3RhbXAuY2xh\nc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5U\naW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpOwogICAgICAg\nICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNx\nbC5UaW1lLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\namF2YS5zcWwuVGltZShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgICAgICByZXR1\ncm4gQ2FsZW5kYXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1B\nUDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSGFzaE1hcCgpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IG5ld0ZpZWxkUHJveHkoaW50IGZpZWxkKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgUHJveHlNYW5hZ2VyIG1nciA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlv\nbigpLgogICAgICAgICAgICBnZXRQcm94eU1hbmFnZXJJbnN0YW5jZSgpOwog\nICAgICAgIE9iamVjdCBpbml0ID0gZm1kLmdldEluaXRpYWxpemVyKCk7Cgog\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG1nci5uZXdEYXRlUHJveHkoZm1kLmdldERlY2xhcmVkVHlw\nZSgpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0NhbGVuZGFyUHJveHkoZm1k\nLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGluaXQg\naW5zdGFuY2VvZiBUaW1lWm9uZSA/IChUaW1lWm9uZSkgaW5pdCA6IG51bGwp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdDb2xsZWN0aW9uUHJveHkoZm1k\nLmdldFByb3h5VHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAg\nICAgaW5pdCBpbnN0YW5jZW9mIENvbXBhcmF0b3IgPyAoQ29tcGFyYXRvcikg\naW5pdCA6IG51bGwpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld01hcFByb3h5KGZtZC5n\nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5\nKCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgZm1k\nLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAg\nICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRvciA/IChDb21wYXJh\ndG9yKSBpbml0IDogbnVsbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGVmYXVsdFZhbHVl\nKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgYm9v\nbGVhbiByZXQgPSBfc2luZ2xlLmlzRGVmYXVsdFZhbHVlKCk7CiAgICAgICAg\nICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgcmV0dXJuIHJldDsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZWNvcmQg\ndGhhdCB0aGUgZmllbGQgaXMgZGlydHkgKHdoaWNoIG1pZ2h0IGxvYWQgREZH\nKQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0dGluZ0Jv\nb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBib29sZWFuIGN1clZhbCwgYm9vbGVhbiBuZXdWYWwsIGludCBz\nZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAg\nICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3Nl\ncnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4g\nc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VU\nX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlQm9vbGVhbkZpZWxk\nKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMs\nIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nQnl0ZUZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIGJ5dGUgY3VyVmFsLCBieXRlIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAg\nIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3\nVmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtl\neUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHko\nZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAg\nICAgICAgIF9zaW5nbGUuc3RvcmVCeXRlRmllbGQoZmllbGQsIG5ld1ZhbCk7\nCiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldHRpbmdDaGFyRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgY2hhciBjdXJWYWwsIGNo\nYXIgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRf\nUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYm\nIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5G\nQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZUNoYXJGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVw\nbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBv\nc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0dGluZ0RvdWJsZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkLAogICAgICAgIGRvdWJsZSBjdXJWYWwsIGRvdWJsZSBuZXdWYWws\nIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsK\nICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5n\nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0K\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJv\nb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQg\nPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlRG91Ymxl\nRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVs\nZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHko\nc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdG\nbG9hdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIGZsb2F0IGN1clZhbCwgZmxvYXQgbmV3VmFsLCBpbnQgc2V0KSB7\nCiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAg\nIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9Q\ncmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQg\nPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VS\nKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUZsb2F0RmllbGQoZmllbGQs\nIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3Npbmds\nZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdJbnRGaWVsZChQZXJz\naXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBpbnQgY3Vy\nVmFsLCBpbnQgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAh\nPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3Vy\nVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZp\nZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9v\nbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3Np\nbmdsZS5zdG9yZUludEZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAg\nICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXR0aW5nTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIGxvbmcgY3VyVmFsLCBsb25nIG5ld1ZhbCwg\naW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewog\nICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdl\ndChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9v\nbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9\nPSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVMb25nRmll\nbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChw\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3Rh\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdPYmpl\nY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAg\nICAgICBPYmplY3QgY3VyVmFsLCBPYmplY3QgbmV3VmFsLCBpbnQgc2V0KSB7\nCiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpKSB7CiAgICAgICAg\nICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gb25seSBjb21wYXJl\nIG5ldyB0byBvbGQgdmFsdWVzIGlmIHRoZSBjb21wYXJpc29uIGlzIGdvaW5n\nIHRvCiAgICAgICAgICAgICAgICAvLyBiZSBjaGVhcCAtLSBkb24ndCBjb21w\nYXJlIGNvbGxlY3Rpb25zLCBtYXBzLCBVRFRzCiAgICAgICAgICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsICE9IG51bGwgJiYgbmV3\nVmFsLmVxdWFscyhjdXJWYWwpKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGRlcGVuZGVu\ndCB1bmxvYWRlZCBmaWVsZCwgbWFrZSBzdXJlIHRvIGxvYWQKICAgICAgICAg\nICAgICAgIC8vIGl0IG5vdwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRD\nYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8K\nICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0S2V5KCkuZ2V0Q2FzY2Fk\nZURlbGV0ZSgpCiAgICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0FVVE8KICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0\nRWxlbWVudCgpLmdldENhc2NhZGVEZWxldGUoKQogICAgICAgICAgICAgICAg\nICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKQogICAgICAgICAg\nICAgICAgICAgIGN1clZhbCA9IGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlD\naGFuZ2UoZmllbGQpOwogICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICAgICAg\nYXNzZXJ0Tm90TWFuYWdlZE9iamVjdElkKG5ld1ZhbCk7CiAgICAgICAgfQoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9v\nbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9\nPSBTRVRfVVNFUik7CiAgICAgICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9U\nRSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVjdEZpZWxk\nKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICAgICAgX3NpbmdsZS51bnBy\nb3h5KCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlcmVmZXJlbmNlRGVw\nZW5kZW50KCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVjdEZp\nZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQo\ncGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0\nYXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nU2hv\ncnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAg\nICAgICBzaG9ydCBjdXJWYWwsIHNob3J0IG5ld1ZhbCwgaW50IHNldCkgewog\nICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBp\nZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJp\nbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0g\nZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7\nCiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBu\nZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nU3RyaW5nRmllbGQoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgU3RyaW5n\nIGN1clZhbCwgU3RyaW5nIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlm\nIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuZXF1YWxzKG5ld1ZhbCwgY3VyVmFsKSAmJiBfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVh\nbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBT\nRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTdHJpbmdGaWVs\nZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNhbGxvd3MgY2hh\nbmdpbmcgcHJpbWFyeSBrZXkgZmllbGRzIGZvciBpbnN0YW5jZXMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2Uo\naW50IGZpZWxkKSB7CiAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCAmJiBfbWV0\nYS5nZXRGaWVsZChmaWVsZCkuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAg\nIHRocm93IHRyYW5zbGF0ZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAoImNoYW5nZS1pZGVudGl0eSIpKS5z\nZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIERpc2FsbG93cyBzZXR0aW5nIGFuIG9iamVjdCBp\nZCBmaWVsZCB0byBhIG1hbmFnZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHZv\naWQgYXNzZXJ0Tm90TWFuYWdlZE9iamVjdElkKE9iamVjdCB2YWwpIHsKICAg\nICAgICBpZiAodmFsICE9IG51bGwKICAgICAgICAgICAgJiYgKEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodmFsLAogICAgICAgICAgICAgICAg\nIGdldENvbnRleHQoKS5nZXRDb25maWd1cmF0aW9uKCkpKS5wY0dldEdlbmVy\naWNDb250ZXh0KCkhPSBudWxsKQogICAgICAgICAgICB0aHJvdyB0cmFuc2xh\ndGUobmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAg\nICAgICAgICAgKCJtYW5hZ2VkLW9pZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmco\ndmFsKSwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5n\nKGdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAgICAgc2V0\nRmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGVsZWdh\ndGUgdG8gRmllbGRNYW5hZ2VyCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRCb29sZWFuRmllbGQo\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgYm9v\nbGVhbiBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVCb29sZWFuRmllbGQo\nZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlk\nZWRCeXRlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQs\nCiAgICAgICAgYnl0ZSBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVCeXRl\nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncHJvdmlkZWRDaGFyRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgY2hhciBjdXJWYWwpIHsKICAgICAgICBfZm0uc3Rv\ncmVDaGFyRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcHJvdmlkZWREb3VibGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIGludCBmaWVsZCwKICAgICAgICBkb3VibGUgY3VyVmFsKSB7CiAgICAg\nICAgX2ZtLnN0b3JlRG91YmxlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRGbG9hdEZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGZsb2F0IGN1clZh\nbCkgewogICAgICAgIF9mbS5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRJbnRGaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBpbnQg\nY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlSW50RmllbGQoZmllbGQsIGN1\nclZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRMb25nRmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAg\nbG9uZyBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVMb25nRmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvdmlkZWRP\nYmplY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBPYmplY3QgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlT2Jq\nZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgcHJvdmlkZWRTaG9ydEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIHNob3J0IGN1clZhbCkgewogICAgICAgIF9m\nbS5zdG9yZVNob3J0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcHJvdmlkZWRTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBTdHJpbmcgY3VyVmFsKSB7\nCiAgICAgICAgX2ZtLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gcmVwbGFjZUJvb2xlYW5GaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAg\nIHJldHVybiBfZm0uZmV0Y2hCb29sZWFuRmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBieXRlIHJlcGxhY2VCeXRlRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZl\ndGNoQnl0ZUZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgY2hhciBy\nZXBsYWNlQ2hhckZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaENoYXJGaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIGRvdWJsZSByZXBsYWNlRG91YmxlRmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAg\nICByZXR1cm4gX2ZtLmZldGNoRG91YmxlRmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBmbG9hdCByZXBsYWNlRmxvYXRGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0u\nZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIHJlcGxhY2VJbnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hJbnRGaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIGxvbmcgcmVwbGFjZUxvbmdGaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJl\ndHVybiBfZm0uZmV0Y2hMb25nRmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgcmVwbGFjZU9iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRj\naE9iamVjdEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgc2hvcnQg\ncmVwbGFjZVNob3J0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoU2hvcnRGaWVsZChm\naWVsZCk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyByZXBsYWNlU3RyaW5n\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAg\nICAgICByZXR1cm4gX2ZtLmZldGNoU3RyaW5nRmllbGQoZmllbGQpOwogICAg\nfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIEltcGxlbWVudGF0aW9uIG9mIEZpZWxkTWFuYWdlcgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29s\nZWFuIGZldGNoQm9vbGVhbihpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4g\nZmV0Y2hCb29sZWFuRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFs\nID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAo\nKEJvb2xlYW4pIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikp\nLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGZl\ndGNoQm9vbGVhbkZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZp\nZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xl\ndmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBw\ncm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHJldHVybiBfc2luZ2xlLmZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGJ5dGUgZmV0Y2hCeXRlKGludCBmaWVs\nZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBmZXRjaEJ5dGVGaWVsZChmaWVsZCk7Cgog\nICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7\nCiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1\nZSh2YWwsIF9icm9rZXIpKS5ieXRlVmFsdWUoKTsKICAgIH0KCiAgICBwdWJs\naWMgYnl0ZSBmZXRjaEJ5dGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQs\nIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEJ5dGVGaWVsZChmaWVsZCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBjaGFyIGZldGNoQ2hhcihpbnQg\nZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXpl\nZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hDaGFyRmllbGQoZmllbGQp\nOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFs\nc2UpOwogICAgICAgIHJldHVybiAoKENoYXJhY3RlcikgZm1kLmdldEV4dGVy\nbmFsVmFsdWUodmFsLCBfYnJva2VyKSkuY2hhclZhbHVlKCk7CiAgICB9Cgog\nICAgcHVibGljIGNoYXIgZmV0Y2hDaGFyRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hDaGFyRmllbGQo\nZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIGZldGNo\nRG91YmxlKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlz\nRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaERvdWJs\nZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmRvdWJsZVZhbHVl\nKCk7CiAgICB9CgogICAgcHVibGljIGRvdWJsZSBmZXRjaERvdWJsZUZpZWxk\nKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAg\nICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUs\nIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3Bj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xl\nLmZldGNoRG91YmxlRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgZmxvYXQgZmV0Y2hGbG9hdChpbnQgZmllbGQpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAg\nICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBy\nZXR1cm4gZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0\nIHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1\ncm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tl\ncikpLmZsb2F0VmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgZmxvYXQgZmV0\nY2hGbG9hdEZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVs\ncy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92\naWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJl\ndHVybiBfc2luZ2xlLmZldGNoRmxvYXRGaWVsZChmaWVsZCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZmV0Y2hJbnQoaW50IGZpZWxkKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAg\nICAgICAgcmV0dXJuIGZldGNoSW50RmllbGQoZmllbGQpOwoKICAgICAgICBP\nYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAg\nIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBf\nYnJva2VyKSkuaW50VmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGZl\ndGNoSW50RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxz\nLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0\ndXJuIF9zaW5nbGUuZmV0Y2hJbnRGaWVsZChmaWVsZCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBsb25nIGZldGNoTG9uZyhpbnQgZmllbGQpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICByZXR1cm4gZmV0Y2hMb25nRmllbGQoZmllbGQpOwoKICAgICAgICBP\nYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAg\nIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBf\nYnJva2VyKSkubG9uZ1ZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGxvbmcg\nZmV0Y2hMb25nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2\nZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHBy\nb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncmV0dXJuIF9zaW5nbGUuZmV0Y2hMb25nRmllbGQoZmllbGQpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0KGludCBmaWVs\nZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBmZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsK\nCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNl\nKTsKICAgICAgICByZXR1cm4gZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBf\nYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0\nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAg\nICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tf\nTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVs\nZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9z\naW5nbGUuZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBzaG9ydCBmZXRjaFNob3J0KGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmZXRjaFNob3J0RmllbGQoZmllbGQpOwoKICAgICAgICBP\nYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAg\nIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBf\nYnJva2VyKSkuc2hvcnRWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBzaG9y\ndCBmZXRjaFNob3J0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZyBmZXRjaFN0cmluZyhpbnQg\nZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXpl\nZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hTdHJpbmdGaWVsZChmaWVs\nZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuIChTdHJpbmcpIGZtZC5nZXRFeHRlcm5h\nbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBmZXRjaFN0cmluZ0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9j\na0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAg\nICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHJldHVybiBfc2luZ2xlLmZldGNoU3RyaW5nRmllbGQoZmllbGQpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJvb2xlYW4oaW50\nIGZpZWxkLCBib29sZWFuIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\naWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVC\nb29sZWFuRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IChleHRlcm5hbFZhbCkgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIp\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVCb29s\nZWFuRmllbGQoaW50IGZpZWxkLCBib29sZWFuIGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVCeXRlKGludCBmaWVsZCwgYnl0ZSBleHRlcm5hbFZhbCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0\nRmllbGRWYWx1ZShuZXcgQnl0ZShleHRlcm5hbFZhbCksCiAgICAgICAgICAg\nICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVC\neXRlRmllbGQoaW50IGZpZWxkLCBieXRlIGN1clZhbCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBsYWNl\nRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExv\nYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxk\nLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVD\naGFyKGludCBmaWVsZCwgY2hhciBleHRlcm5hbFZhbCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0\nb3JlQ2hhckZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRW\nYWx1ZShuZXcgQ2hhcmFjdGVyKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAg\nICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUNo\nYXJGaWVsZChpbnQgZmllbGQsIGNoYXIgY3VyVmFsKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVD\naGFyRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9h\nZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQs\nIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZURv\ndWJsZShpbnQgZmllbGQsIGRvdWJsZSBleHRlcm5hbFZhbCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAg\nIHN0b3JlRG91YmxlRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRG\naWVsZFZhbHVlKG5ldyBEb3VibGUoZXh0ZXJuYWxWYWwpLAogICAgICAgICAg\nICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3Jl\nRG91YmxlRmllbGQoaW50IGZpZWxkLCBkb3VibGUgY3VyVmFsKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9h\nZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlRmxvYXQoaW50IGZpZWxkLCBmbG9hdCBleHRlcm5hbFZhbCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAg\nICAgICAgIHN0b3JlRmxvYXRGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1k\nLmdldEZpZWxkVmFsdWUobmV3IEZsb2F0KGV4dGVybmFsVmFsKSwKICAgICAg\nICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZUZsb2F0RmllbGQoaW50IGZpZWxkLCBmbG9hdCBjdXJWYWwpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAg\nIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExv\nYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdG9yZUludChpbnQgZmllbGQsIGludCBleHRlcm5hbFZhbCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHN0b3JlSW50RmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRG\naWVsZFZhbHVlKE51bWJlcnMudmFsdWVPZihleHRlcm5hbFZhbCksCiAgICAg\nICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVJbnRGaWVsZChpbnQgZmllbGQsIGludCBjdXJWYWwpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZUludEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBs\nYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNl\ndExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZp\nZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVMb25nKGludCBmaWVsZCwgbG9uZyBleHRlcm5hbFZhbCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAg\nIHN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0Rmll\nbGRWYWx1ZShOdW1iZXJzLnZhbHVlT2YoZXh0ZXJuYWxWYWwpLAogICAgICAg\nICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlTG9uZ0ZpZWxkKGludCBmaWVsZCwgbG9uZyBjdXJWYWwpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZUxvbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVw\nbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBz\nZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChm\naWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlT2JqZWN0KGludCBmaWVsZCwgT2JqZWN0IGV4dGVybmFsVmFsKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgZXh0ZXJuYWxWYWwgPSBmbWQub3JkZXIoZXh0ZXJuYWxW\nYWwpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAg\nICAgICAgIHN0b3JlT2JqZWN0RmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZt\nZC5nZXRGaWVsZFZhbHVlKGV4dGVybmFsVmFsLCBfYnJva2VyKSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVPYmplY3RGaWVsZChpbnQgZmllbGQs\nIE9iamVjdCBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVjdEZpZWxkKGZpZWxk\nLCBjdXJWYWwpOwogICAgICAgICAgICBfc2luZ2xlLnByb3h5KHRydWUsIGZh\nbHNlKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnQoaW50IGZpZWxkLCBzaG9y\ndCBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0\nZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlU2hvcnRGaWVsZChmaWVs\nZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rv\ncmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IFNob3J0KGV4\ndGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0RmllbGQoaW50IGZpZWxkLCBz\naG9ydCBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNob3J0RmllbGQoZmllbGQsIGN1\nclZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsK\nICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZVN0cmluZyhpbnQgZmllbGQsIFN0\ncmluZyBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlz\nRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlU3RyaW5nRmllbGQo\nZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKGV4dGVybmFs\nVmFsLCBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVT\ndHJpbmdGaWVsZChpbnQgZmllbGQsIFN0cmluZyBjdXJWYWwpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\ndG9yZSB0aGUgZ2l2ZW4gZmllbGQgdmFsdWUgaW50byB0aGUgZ2l2ZW4gZmll\nbGQgbWFuYWdlci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHN0b3JlRmll\nbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsLCBGaWVsZE1hbmFnZXIgZm0pIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1maWVsZC1pbmRl\neCIsCiAgICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihmaWVsZCksIF9t\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpLgogICAgICAgICAgICAgICAgc2V0\nRmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0YW5jZSgpKTsKCiAgICAgICAg\nc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBi\nb29sZWFuIGJvb2wgPSB2YWwgIT0gbnVsbCAmJiAoKEJvb2xlYW4pIHZhbCku\nYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZUJvb2xl\nYW5GaWVsZChmaWVsZCwgYm9vbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\nICAgIGJ5dGUgYiA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZh\nbCkuYnl0ZVZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZUJ5dGVG\naWVsZChmaWVsZCwgYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNo\nYXIgYyA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChDaGFyYWN0ZXIpIHZhbCku\nY2hhclZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZUNoYXJGaWVs\nZChmaWVsZCwgYyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgZG91\nYmxlIGQgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmRv\ndWJsZVZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZURvdWJsZUZp\nZWxkKGZpZWxkLCBkKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGZs\nb2F0IGYgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmZs\nb2F0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlRmxvYXRGaWVs\nZChmaWVsZCwgZik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgaW50IGkg\nPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmludFZhbHVl\nKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZUludEZpZWxkKGZpZWxkLCBp\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgbG9uZyBsID0gKHZhbCA9\nPSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKTsKICAg\nICAgICAgICAgICAgIGZtLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBsKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgIHNob3J0IHMgPSAodmFsID09IG51\nbGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLnNob3J0VmFsdWUoKTsKICAgICAg\nICAgICAgICAgIGZtLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgcyk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgZm0uc3RvcmVTdHJpbmdGaWVsZChm\naWVsZCwgKFN0cmluZykgdmFsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZm0uc3RvcmVP\nYmplY3RGaWVsZChmaWVsZCwgdmFsKTsKICAgICAgICB9CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBFcmFzZSB0aGUgZmFjdCB0aGF0IHRoaXMg\naW5zdGFuY2UgaGFzIGJlZW4gZmx1c2hlZC4KICAgICAqLwogICAgdm9pZCBl\ncmFzZUZsdXNoKCkgewogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVE\nOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEX0RJUlRZOwoKICAg\nICAgICBpbnQgZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpLmxlbmd0aDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHM7IGkrKykKICAgICAgICAg\nICAgX2ZsdXNoLmNsZWFyKGkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVj\nb3JkcyB0aGF0IGFsbCBpbnN0YW5jZSBmaWVsZHMgYXJlL2FyZSBub3QgbG9h\nZGVkLgogICAgICogUHJpbWFyeSBrZXkgYW5kIG5vbi1wZXJzaXN0ZW50IGZp\nZWxkcyBhcmUgbm90IGFmZmVjdGVkLgogICAgICovCiAgICB2b2lkIHNldExv\nYWRlZChib29sZWFuIHZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgh\nZm1kc1tpXS5pc1ByaW1hcnlLZXkoKQogICAgICAgICAgICAgICAgJiYgZm1k\nc1tpXS5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kc1tpXS5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgICAgIHNldExvYWRlZChpLCB2YWwpOwogICAg\nICAgIH0KICAgICAgICBpZiAoIXZhbCkgewogICAgICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfTE9BREVEOwogICAgICAgICAgICBzZXREaXJ0eShmYWxzZSk7\nCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0xP\nQURFRDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZHMgdGhhdCBhbGwg\naW5zdGFuY2UgZmllbGRzIGFyZS9hcmUgbm90IGRpcnR5LAogICAgICogYW5k\nIGNoYW5nZXMgdGhlIGZsYWdzIG9mIHRoZSBpbnN0YW5jZSBhY2NvcmRpbmds\neS4KICAgICAqLwogICAgdm9pZCBzZXREaXJ0eShib29sZWFuIHZhbCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRz\nKCk7CiAgICAgICAgYm9vbGVhbiB1cGRhdGUgPSAhaXNOZXcoKSB8fCBpc0Zs\ndXNoZWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHZhbCAmJiAoIXVwZGF0ZQog\nICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRVcGRhdGVTdHJhdGVneSgp\nICE9IFVwZGF0ZVN0cmF0ZWdpZXMuSUdOT1JFKSkKICAgICAgICAgICAgICAg\nIF9kaXJ0eS5zZXQoaSk7CiAgICAgICAgICAgIGVsc2UgaWYgKCF2YWwpIHsK\nICAgICAgICAgICAgICAgIC8vIHdlIG5ldmVyIGNvbnNpZGVyIGNsZWFuIGZp\nZWxkcyBmbHVzaGVkOyB0aGlzIGFsc28gdGFrZXMKICAgICAgICAgICAgICAg\nIC8vIGNhcmUgb2YgY2xlYXJpbmcgdGhlIGZsdXNoZWQgZmllbGRzIG9uIGNv\nbW1pdC9yb2xsYmFjawogICAgICAgICAgICAgICAgX2ZsdXNoLmNsZWFyKGkp\nOwogICAgICAgICAgICAgICAgX2RpcnR5LmNsZWFyKGkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsKQogICAgICAgICAgICBf\nZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBF\neGVjdXRlcyBwcmUtY2xlYXIgY2FsbGJhY2tzLCBjbGVhcnMgYWxsIG1hbmFn\nZWQgZmllbGRzLCBhbmQgY2FsbHMgdGhlCiAgICAgKiB7QGxpbmsgI3NldExv\nYWRlZH0gbWV0aG9kIHdpdGggYSB2YWx1ZSBvZiBmYWxzZS4gUHJpbWFyeSBr\nZXkgZmllbGRzCiAgICAgKiBhcmUgbm90IGNsZWFyZWQuCiAgICAgKi8KICAg\nIHZvaWQgY2xlYXJGaWVsZHMoKSB7CiAgICAgICAgaWYgKCFpc0ludGVyY2Vw\ndGluZygpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfQ0xFQVIpOwoKICAg\nICAgICAvLyB1bnByb3h5IGFsbCBmaWVsZHMKICAgICAgICB1bnByb3h5Rmll\nbGRzKCk7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBjbGVhciBub24tcGsgZmllbGRzCiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpICYm\nIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpCiAgICAgICAgICAgICAgICAgICAg\nPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAg\nICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBDbGVhckZpZWxkTWFuYWdl\nci5nZXRJbnN0YW5jZSgpLCBpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gZm9yZ2V0IHZlcnNpb24gaW5mbyBhbmQgaW1wbCBkYXRhIHNvIHdl\nIHJlLXJlYWQgbmV4dCB0aW1lCiAgICAgICAgICAgIHNldExvYWRlZChmYWxz\nZSk7CiAgICAgICAgICAgIF92ZXJzaW9uID0gbnVsbDsKICAgICAgICAgICAg\nX2xvYWRWZXJzaW9uID0gbnVsbDsKICAgICAgICAgICAgaWYgKF9maWVsZElt\ncGwgIT0gbnVsbCkKICAgICAgICAgICAgICAgIEFycmF5cy5maWxsKF9maWVs\nZEltcGwsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KCiAgICAgICAgZmlyZUxpZmVjeWNsZUV2\nZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0NMRUFSKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlY29yZCB0aGF0IHdlIHNob3VsZCBzYXZlIGFueSBmaWVs\nZHMgdGhhdCBjaGFuZ2UgZnJvbSB0aGlzIHBvaW50CiAgICAgKiBmb3J3YXJk\nLgogICAgICovCiAgICB2b2lkIHNhdmVGaWVsZHMoYm9vbGVhbiBpbW1lZGlh\ndGUpIHsKICAgICAgICBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3RhdGUoKSA9\nPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05FCiAgICAgICAgICAgICYmIChf\nZmxhZ3MgJiBGTEFHX0lOVkVSU0VTKSA9PSAwKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIF9mbGFncyB8PSBGTEFHX1NBVkU7CiAgICAgICAgaWYg\nKGltbWVkaWF0ZSkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVu\nID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAg\nICAgICAgc2F2ZUZpZWxkKGkpOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfU0FWRTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0\naGUgZmllbGQgaXNuJ3QgYWxyZWFkeSBzYXZlZCwgc2F2ZXMgdGhlIGN1cnJl\nbnRseSBsb2FkZWQgZmllbGQKICAgICAqIHN0YXRlIG9mIHRoZSBpbnN0YW5j\nZS4gVGhlIHNhdmVkIHZhbHVlcyBjYW4gYWxsIGJlIHJlc3RvcmVkIHZpYQog\nICAgICoge0BsaW5rICNyZXN0b3JlRmllbGRzfS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHNhdmVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfU0FWRSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgbWFuYWdlZCBpbnZlcnNlIGZp\nZWxkLCBsb2FkIGl0IHNvIHdlJ3JlIHN1cmUgdG8gaGF2ZQogICAgICAgIC8v\nIHRoZSBvcmlnaW5hbCB2YWx1ZQogICAgICAgIGlmICghX2xvYWRlZC5nZXQo\nZmllbGQpICYmICgoX2ZsYWdzICYgRkxBR19JTlZFUlNFUykgIT0gMAogICAg\nICAgICAgICAmJiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuZ2V0SW52ZXJzZU1l\ndGFEYXRhcygpLmxlbmd0aCA+IDApKQogICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAvLyBkb24ndCBib3RoZXIgY3JlYXRpbmcgdGhlIHNhdmUgZmll\nbGQgbWFuYWdlciBpZiB3ZSdyZSBub3QgZ29pbmcgdG8KICAgICAgICAvLyBz\nYXZlIHRoZSBvbGQgZmllbGQgdmFsdWUgYW55d2F5CiAgICAgICAgaWYgKF9z\nYXZlZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICBfc2F2ZWQgPSBuZXcgU2F2ZUZpZWxk\nTWFuYWdlcih0aGlzLCBudWxsLCBfZGlydHkpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAv\nLyBjb3B5IHRoZSBmaWVsZCB0byBzYXZlIGZpZWxkIG1hbmFnZXI7IGlmIHRo\nZSBmaWVsZCBpcyBub3QgZGlyZWN0bHkKICAgICAgICAvLyBjb3B5YWJsZSwg\naW1tZWRpYXRlbHkgcHJvdmlkZSBhbmQgcmVwbGFjZSBpdCB2aWEgdGhlIHNh\ndmUgZmllbGQKICAgICAgICAvLyBtYW5hZ2VyLCB3aGljaCB3aWxsIGNvcHkg\ndGhlIG11dGFibGUgdmFsdWUgdG8gcHJldmVudCBieS1yZWYgbW9kcwogICAg\nICAgIGlmIChfc2F2ZWQuc2F2ZUZpZWxkKGZpZWxkKSkgewogICAgICAgICAg\nICBwcm92aWRlRmllbGQoX3BjLCBfc2F2ZWQsIGZpZWxkKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKF9zYXZlZC5nZXRTdGF0ZSgpLCBfc2F2ZWQsIGZp\nZWxkKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZmlj\nYXRpb24gdGhhdCB0aGUgc3RhdGUgd2lsbCBub3QgbmVlZCB0byBiZSByb2xs\nZWQgYmFjawogICAgICogdG8gdGhhdCBvZiB0aGUgbGFzdCBjYWxsIHRvIHtA\nbGluayAjc2F2ZUZpZWxkc30uCiAgICAgKi8KICAgIHZvaWQgY2xlYXJTYXZl\nZEZpZWxkcygpIHsKICAgICAgICBpZiAoaXNJbnRlcmNlcHRpbmcoKSkgewog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU0FWRTsKICAgICAgICAgICAg\nX3NhdmVkID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFNh\ndmVGaWVsZE1hbmFnZXIgZ2V0U2F2ZUZpZWxkTWFuYWdlcigpIHsKICAgICAg\nICByZXR1cm4gX3NhdmVkOwogICAgfQoKICAgIC8qKgogICAgICogUm9sbGJh\nY2sgdGhlIHN0YXRlIG9mIHRoZSBpbnN0YW5jZSB0byB0aGUgc2F2ZWQgc3Rh\ndGUgZnJvbSB0aGUKICAgICAqIGxhc3QgY2FsbCB0byB7QGxpbmsgI3NhdmVG\naWVsZHN9LCBvciB0byBkZWZhdWx0IHZhbHVlcyBpZiBuZXZlciBzYXZlZC4K\nICAgICAqLwogICAgdm9pZCByZXN0b3JlRmllbGRzKCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3NhdmVkID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19T\nQVZFKSA9PSAwKQogICAgICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7\nCiAgICAgICAgICAgICAgICBlbHNlIC8vIG9ubHkgdW5sb2FkZWQgZmllbGRz\nIHdlcmUgZGlydGllZAogICAgICAgICAgICAgICAgICAgIF9sb2FkZWQuYW5k\nTm90KF9sb2FkZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHdl\nIGRpcmVjdCBzdGF0ZSB0cmFuc2l0aW9ucyBiYXNlZCBvbiBvdXIgb3duIGdl\ndFJlc3RvcmVTdGF0ZQogICAgICAgICAgICAvLyBtZXRob2QsIGJ1dCB0byBk\nZWNpZGUgd2hldGhlciB0byBhY3R1YWxseSByb2xsYmFjayBmaWVsZAogICAg\nICAgICAgICAvLyB2YWx1ZXMsIHdlIGNvbnN1bHQgdGhlIGJyb2tlciBmb3Ig\ndGhlIHVzZXIncyBzZXR0aW5nCiAgICAgICAgICAgIGVsc2UgaWYgKF9icm9r\nZXIuZ2V0UmVzdG9yZVN0YXRlKCkgIT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVf\nTk9ORSkgewogICAgICAgICAgICAgICAgLy8gcm9sbGJhY2sgYWxsIGN1cnJl\nbnRseS1sb2FkZWQgZmllbGRzCiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMCwgbGVuID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQog\nICAgICAgICAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChpKSAmJiBfc2F2\nZWQucmVzdG9yZUZpZWxkKGkpKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2F2ZWQsIGkpOwoKICAgICAgICAgICAgICAg\nIC8vIHJvbGxiYWNrIGxvYWRlZCBzZXQKICAgICAgICAgICAgICAgIF9sb2Fk\nZWQuYW5kTm90KF9zYXZlZC5nZXRVbmxvYWRlZCgpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFj\nZXMgYWxsIHNlY29uZCBjbGFzcyBvYmplY3QgZmllbGRzIHdpdGggZnJlc2gg\ncHJveGllZCBpbnN0YW5jZXMKICAgICAqIGNvbnRhaW5pbmcgdGhlIHNhbWUg\naW5mb3JtYXRpb24gYXMgdGhlIG9yaWdpbmFscy4KICAgICAqLwogICAgdm9p\nZCBwcm94eUZpZWxkcyhib29sZWFuIHJlc2V0LCBib29sZWFuIHJlcGxhY2VO\ndWxsKSB7CiAgICAgICAgLy8gd2Ugb25seSByZXBsYWNlIG51bGxzIGlmIHRo\nZSBydW50aW1lIGNhbid0IGRpZmZlcmVudGlhdGUgYmV0d2VlbgogICAgICAg\nIC8vIG51bGwgYW5kIGVtcHR5IGNvbnRhaW5lcnMuICB3ZSByZXBsYWNlIG51\nbGxzIGluIHRoaXMgY2FzZSB0bwogICAgICAgIC8vIG1haW50YWluIGNvbnNp\nc3RlbmN5IHdoZXRoZXIgdmFsdWVzIGFyZSBiZWluZyByZXRhaW5lZCBvciBu\nb3QKICAgICAgICBpZiAocmVwbGFjZU51bGwpCiAgICAgICAgICAgIHJlcGxh\nY2VOdWxsID0gIV9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRl\nZE9wdGlvbnMoKS4KICAgICAgICAgICAgICAgIGNvbnRhaW5zKE9wZW5KUEFD\nb25maWd1cmF0aW9uLk9QVElPTl9OVUxMX0NPTlRBSU5FUik7CgogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKGludCBp\nID0gMCwgbGVuID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoaSkpIHsKICAgICAg\nICAgICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX3NpbmdsZS5wcm94eShyZXNldCwg\ncmVwbGFjZU51bGwpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNl\nRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFVucHJveHkgYWxsIGZpZWxkcy4KICAgICAqLwog\nICAgdm9pZCB1bnByb3h5RmllbGRzKCkgewogICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19OT19VTlBST1hZKSAhPSAwKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBm\nb3IgKGludCBpID0gMCwgbGVuID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxl\nbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBf\nc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUudW5wcm94eSgp\nOwogICAgICAgICAgICAgICAgX3NpbmdsZS5yZWxlYXNlRW1iZWRkZWQoKTsK\nICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2V0IHJl\nYWR5IGZvciBhIGZsdXNoLiBQZXJzaXN0cyBhbGwgcGVyc2lzdGVuY2UtY2Fw\nYWJsZSBvYmplY3QgZmllbGRzLAogICAgICogYW5kIGNoZWNrcyBmb3IgaWxs\nZWdhbCBudWxsIHZhbHVlcy4gQWxzbyBhc3NpZ25zIG9pZHMgYW5kIGZpZWxk\nIHZhbHVlcwogICAgICogZm9yIGFsbCBzdHJhdGVnaWVzIHRoYXQgZG9uJ3Qg\ncmVxdWlyZSBmbHVzaGluZy4KICAgICAqLwogICAgdm9pZCBwcmVGbHVzaChi\nb29sZWFuIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfUFJFX0ZMVVNIRUQpICE9IDApCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgaWYgKGlzUGVyc2lzdGVudCgpKSB7CiAg\nICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5C\nRUZPUkVfU1RPUkUpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVf\nRkxVU0hFRDsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoIWxvZ2ljYWwpCiAgICAgICAgICAgICAg\nICBhc3NpZ25PYmplY3RJZChmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwLCBsZW4gPSBfbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGg7\nIGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgaWYgKChsb2dpY2Fs\nIHx8ICFhc3NpZ25GaWVsZChpLCB0cnVlKSkgJiYgIV9mbHVzaC5nZXQoaSkK\nICAgICAgICAgICAgICAgICAgICAmJiBfZGlydHkuZ2V0KGkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKF9zaW5nbGUucHJlRmx1c2gobG9n\naWNhbCwgY2FsbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBk\naXJ0eUNoZWNrKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSBjYWxsYmFja3MgZm9yIGRlbGV0aW9uLgogICAgICovCiAgICB2b2lkIHBy\nZURlbGV0ZSgpIHsKICAgICAgICAvLyBzZXQgYSBmbGFnIHdoaWxlIGNhbGwg\ncHJlIGRlbGV0ZSBjYWxsYmFjayBzbyB0aGF0IHVzZXIgY2FuJ3QKICAgICAg\nICAvLyBnZXQgaW50byBpbmZpbml0ZSByZWN1cnNpb24gYnkgY2FsbGluZyBk\nZWxldGUodGhpcykKICAgICAgICAvLyB3aXRoaW4gaGlzIGNhbGxiYWNrIG1l\ndGhvZAogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVfREVMRVRJTkcp\nID09IDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0RFTEVU\nSU5HOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwog\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENhc2NhZGUgZGVsZXRlcyBhbmQg\nZGVyZWZlcmVuY2UgZGVwZW5kZW50IGZpZWxkcy4KICAgICAqLwogICAgdm9p\nZCBjYXNjYWRlRGVsZXRlKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRlRGVsZXRlKCkgIT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAgICAgICAgICAgIHx8\nIGZtZHNbaV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAg\nICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORQogICAgICAg\nICAgICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURl\nbGV0ZSgpCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfTk9ORSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVj\ndEZpZWxkKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUuZGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgX3Np\nbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ2FsbGVkIGFmdGVyIGFuIGluc3RhbmNlIGlzIHBl\ncnNpc3RlZCBieSBhIHVzZXIgdGhyb3VnaCB0aGUgYnJva2VyLgogICAgICog\nQ2FzY2FkZXMgdGhlIHBlcnNpc3Qgb3BlcmF0aW9uIHRvIGZpZWxkcyBtYXJr\nZWQKICAgICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NBU0NBREVfSU1NRURJ\nQVRFfS4KICAgICAqLwogICAgdm9pZCBjYXNjYWRlUGVyc2lzdChPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBf\nbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZVBlcnNpc3QoKSA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBm\nbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVQZXJzaXN0KCkKICAgICAgICAg\nICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUKICAg\nICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2Nh\nZGVQZXJzaXN0KCkKICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVPYmplY3RGaWVsZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7CiAg\nICAgICAgICAgICAgICBfc2luZ2xlLnBlcnNpc3QoY2FsbCk7CiAgICAgICAg\nICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBmaWVs\nZCBzZXQgZnJvbSB0aGUgZGF0YSBzdG9yZSBpbnRvIHRoZSBpbnN0YW5jZS4K\nICAgICAqIFJldHVybiB0cnVlIGlmIGFueSBkYXRhIGlzIGxvYWRlZCwgZmFs\nc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBib29sZWFuIGxvYWRGaWVsZHMo\nQml0U2V0IGZpZWxkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQg\nbG9ja0xldmVsLAogICAgICAgIE9iamVjdCBzZGF0YSwgYm9vbGVhbiBmb3JX\ncml0ZSkgewogICAgICAgIC8vIGNhbid0IGxvYWQgdmVyc2lvbiBmaWVsZCBm\ncm9tIHN0b3JlCiAgICAgICAgaWYgKGZpZWxkcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGEgdmZpZWxkID0gX21ldGEuZ2V0VmVyc2lv\nbkZpZWxkKCk7CiAgICAgICAgICAgIGlmICh2ZmllbGQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGZpZWxkcy5jbGVhcih2ZmllbGQuZ2V0SW5kZXgoKSk7\nCiAgICAgICAgfQoKICAgICAgICBib29sZWFuIHJldCA9IGZhbHNlOwogICAg\nICAgIHNldExvYWRpbmcodHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gaWYgYW55IGZpZWxkcyBnaXZlbiwgbG9hZCB0aGVtCiAgICAgICAg\nICAgIGludCBsZW4gPSAoZmllbGRzID09IG51bGwpID8gMCA6IGZpZWxkcy5s\nZW5ndGgoKTsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAg\nICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGZldGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICAgICAgICAgIGlmICghX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5s\nb2FkKHRoaXMsIGZpZWxkcywgZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAg\nbG9ja0xldmVsLCBzZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQoImRlbC1p\nbnN0YW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9tZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSwgX29pZCkpLgogICAgICAgICAgICAgICAgICAgICAg\nICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHZlcnNpb24g\naW5mb3JtYXRpb24gaGFzIGJlZW4gc2V0OyB2ZXJzaW9uIGluZm8gbXVzdAog\nICAgICAgICAgICAvLyBhbHdheXMgYmUgc2V0IGFmdGVyIHRoZSBmaXJzdCBz\ndGF0ZSBsb2FkIG9yIHNldCAod2hpY2ggaXMgd2h5CiAgICAgICAgICAgIC8v\nIHdlIGRvIHRoaXMgZXZlbiBpZiBubyBmaWVsZHMgd2VyZSBsb2FkZWQgLS0g\nY291bGQgYmUgdGhhdCB0aGlzCiAgICAgICAgICAgIC8vIG1ldGhvZCBpcyBi\nZWluZyBjYWxsZWQgYWZ0ZXIgYSBmaWVsZCBpcyBzZXQpLi4uIHNvbWUgaW5z\ndGFuY2VzCiAgICAgICAgICAgIC8vIG1pZ2h0IG5vdCBoYXZlIHZlcnNpb24g\naW5mbywgaW4gd2hpY2ggY2FzZSB0aGlzIGdldHMgY2FsbGVkCiAgICAgICAg\nICAgIC8vIG11dGlwbGUgdGltZXM7IHRoYXQgc2hvdWxkIGJlIG9rIHRvbwog\nICAgICAgICAgICBpZiAoX2xvYWRWZXJzaW9uID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHN5bmNWZXJzaW9uKHNkYXRhKTsKICAgICAgICAgICAgICAg\nIHJldCA9IHJldCB8fCBfbG9hZFZlcnNpb24gIT0gbnVsbDsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAg\nc2V0TG9hZGluZyhmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZWUg\naWYgdGhlIGRmZyBpcyBub3cgbG9hZGVkOyBkbyB0aGlzIHJlZ2FyZGxlc3Mg\nb2Ygd2hldGhlciB3ZQogICAgICAgIC8vIGxvYWRlZCBhbnkgZmllbGRzLCBj\nYXVzZSBtYXkgYWxyZWFkeSBoYXZlIGJlZW4gbG9hZGVkIGJ5CiAgICAgICAg\nLy8gU3RvcmVNYW5hZ2VyIGR1cmluZyBpbml0aWFsaXphdGlvbgogICAgICAg\nIHBvc3RMb2FkKC0xLCBmZXRjaCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkJ3MgZmV0\nY2ggZ3JvdXA7IHRoZSBmaWVsZCBpdHNlbGYgbWF5IGFscmVhZHkgYmUKICAg\nICAqIGxvYWRlZCBpZiBpdCBpcyBiZWluZyBzZXQgYnkgdGhlIHVzZXIuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGxvYWRGaWVsZChpbnQgZmllbGQs\nIGludCBsb2NrTGV2ZWwsIGJvb2xlYW4gZm9yV3JpdGUsCiAgICAgICAgYm9v\nbGVhbiBmZ3MpIHsKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gg\nPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIEJpdFNldCBmaWVsZHMgPSBudWxsOwoKICAgICAgICAvLyBpZiB0aGlz\nIGlzIGEgZGZnIGZpZWxkIG9yIHdlIG5lZWQgdG8gbG9hZCBvdXIgZGZnLCBk\nbyBzbwogICAgICAgIGlmIChmZ3MgJiYgKF9mbGFncyAmIEZMQUdfTE9BREVE\nKSA9PSAwKQogICAgICAgICAgICBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVy\nbmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7CiAgICAgICAgCiAgICAgICAg\nLy8gY2hlY2sgZm9yIGxvYWQgZmV0Y2ggZ3JvdXAKICAgICAgICBTdHJpbmcg\nbGZnID0gZm1kLmdldExvYWRGZXRjaEdyb3VwKCk7CiAgICAgICAgYm9vbGVh\nbiBsZmdBZGRlZCA9IGZhbHNlOwogICAgICAgIGlmIChsZmcgIT0gbnVsbCkg\neyAgCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEu\nZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKCFfbG9h\nZGVkLmdldChpKSAmJiAoaSA9PSBmaWVsZAogICAgICAgICAgICAgICAgICAg\nIHx8IGZtZHNbaV0uaXNJbkZldGNoR3JvdXAobGZnKSkpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZpZWxkcyA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgICAgIGZpZWxkcy5zZXQoaSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlbGF0aW9u\nIGZpZWxkIGlzIGxvYWRlZCB3aXRoIHRoZSBsb2FkLWZldGNoLWdyb3VwCiAg\nICAgICAgICAgIC8vIGJ1dCB0aGlzIGFkZGl0aW9uIG11c3QgYmUgcmV2ZXJ0\nZWQgb25jZSB0aGUgbG9hZCBpcyBvdmVyCiAgICAgICAgICAgIGlmICghZmV0\nY2guaGFzRmV0Y2hHcm91cChsZmcpKSB7CiAgICAgICAgICAgICAgICBmZXRj\naC5hZGRGZXRjaEdyb3VwKGxmZyk7CiAgICAgICAgICAgICAgICBsZmdBZGRl\nZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGZt\nZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAmJiBmaWVsZHMgPT0gbnVsbCkg\newogICAgICAgICAgICAvLyBubyBsb2FkIGdyb3VwIGJ1dCBkZmc6IGFkZCBk\nZmcgZmllbGRzIGlmIHdlIGhhdmVuJ3QgYWxyZWFkeQogICAgICAgICAgICBm\naWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywg\nbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmICghX2xvYWRlZC5nZXQoZm1kLmdl\ndEluZGV4KCkpKSB7CiAgICAgICAgICAgIC8vIG5vIGxvYWQgZ3JvdXAgb3Ig\nZGZnOiBsb2FkIGluZGl2aWR1YWwgZmllbGQKICAgICAgICAgICAgaWYgKGZp\nZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJp\ndFNldCgpOwogICAgICAgICAgICBmaWVsZHMuc2V0KGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGNhbGwgdGhpcyBtZXRob2QgZXZl\nbiBpZiB0aGVyZSBhcmUgbm8gdW5sb2FkZWQgZmllbGRzOyBsb2FkRmllbGRz\nCiAgICAgICAgLy8gdGFrZXMgY2FyZSBvZiB0aGluZ3MgbGlrZSBsb2FkaW5n\nIHZlcnNpb24gaW5mbyBhbmQgc2V0dGluZyBQQyBmbGFncwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGxvYWRGaWVsZHMoZmllbGRzLCBmZXRjaCwgbG9j\na0xldmVsLCBudWxsLCBmb3JXcml0ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKGxmZ0FkZGVkKQogICAgICAgICAgICAgICAgZmV0\nY2gucmVtb3ZlRmV0Y2hHcm91cChsZmcpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gcHJvdmlkZSB0aGUgZ2l2\nZW4gZmllbGQgbnVtYmVyIHRvIHRoZSBnaXZlbgogICAgICogZmllbGQgbWFu\nYWdlci4KICAgICAqLwogICAgdm9pZCBwcm92aWRlRmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBGaWVsZE1hbmFnZXIgc3RvcmUsIGludCBmaWVsZCkg\newogICAgICAgIEZpZWxkTWFuYWdlciBiZWZvcmVGTSA9IF9mbTsKICAgICAg\nICBfZm0gPSBzdG9yZTsKICAgICAgICBwYy5wY1Byb3ZpZGVGaWVsZChmaWVs\nZCk7CiAgICAgICAgLy8gUmV0YWluaW5nIG9yaWdpbmFsIEZNIGJlY2F1c2Ug\nb2YgdGhlIHBvc3NpYmlsaXR5IG9mIHJlZW50cmFudCBjYWxscwogICAgICAg\nIF9mbSA9IGJlZm9yZUZNOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVy\nIG1ldGhvZCB0byByZXBsYWNlIHRoZSBnaXZlbiBmaWVsZCBudW1iZXIgdG8g\ndGhlIGdpdmVuCiAgICAgKiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICB2\nb2lkIHJlcGxhY2VGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIEZpZWxk\nTWFuYWdlciBsb2FkLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1hbmFn\nZXIgYmVmb3JlRk0gPSBfZm07CiAgICAgICAgX2ZtID0gbG9hZDsKICAgICAg\nICBwYy5wY1JlcGxhY2VGaWVsZChmaWVsZCk7CiAgICAgICAgLy8gUmV0YWlu\naW5nIG9yaWdpbmFsIEZNIGJlY2F1c2Ugb2YgdGhlIHBvc3NpYmlsaXR5IG9m\nIHJlZW50cmFudCBjYWxscwogICAgICAgIF9mbSA9IGJlZm9yZUZNOwogICAg\nfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgZmllbGQgYXMgbG9hZGVkIG9y\nIHVubG9hZGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0TG9hZGVk\nKGludCBmaWVsZCwgYm9vbGVhbiBpc0xvYWRlZCkgewogICAgICAgIC8vIGRv\nbid0IGNvbnRpbnVlIGlmIGxvYWRlZCBzdGF0ZSBpcyBhbHJlYWR5IGNvcnJl\nY3Q7IG90aGVyd2lzZSB3ZQogICAgICAgIC8vIGNhbiBlbmQgdXAgY2xlYXJp\nbmcgX2ZpZWxkSW1wbCB3aGVuIHdlIHNob3VsZG4ndAogICAgICAgIGlmIChf\nbG9hZGVkLmdldChmaWVsZCkgPT0gaXNMb2FkZWQpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgLy8gaWYgbG9hZGluZywgY2xlYXIgaW50ZXJtZWRp\nYXRlIGRhdGE7IGlmIHVubG9hZGluZywgY2xlYXIgaW1wbCBkYXRhCiAgICAg\nICAgaWYgKF9maWVsZEltcGwgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQg\naWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7CiAg\nICAgICAgICAgIGlmIChpZHggIT0gLTEpCiAgICAgICAgICAgICAgICBfZmll\nbGRJbXBsW2lkeF0gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlz\nTG9hZGVkKQogICAgICAgICAgICBfbG9hZGVkLnNldChmaWVsZCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBfbG9hZGVkLmNsZWFyKGZpZWxkKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gcG9zdC1sb2FkIHN0ZXBzLCBp\nbmNsdWRpbmcgdGhlIHBvc3QgbG9hZCBjYWxsYmFjay4KICAgICAqIFdlIGhh\ndmUgdG8gY2hlY2sgdGhlIGRmZyBhZnRlciBhbGwgZmllbGQgbG9hZHMgYmVj\nYXVzZSBpdCBtaWdodCBiZQogICAgICogbG9hZGVkIGluIG11bHRpcGxlIHN0\nZXBzIHdoZW4gcGFnaW5nIGlzIGludm9sdmVkOyB0aGUgaW5pdGlhbCBsb2Fk\nCiAgICAgKiBtaWdodCBleGNsdWRlIHNvbWUgZmllbGRzIHdoaWNoIGFyZSB0\naGVuIGltbWVkaWF0ZWx5IGxvYWRlZCBpbiBhCiAgICAgKiBzZXBhcmF0ZSBz\ndGVwIGJlZm9yZSBiZWluZyByZXR1cm5lZCB0byB0aGUgdXNlci4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxkIGluZGV4IHRoYXQgd2Fz\nIGxvYWRlZCwgb3IgLTEgdG8gaW5kaWNhdGUKICAgICAqIHRoYXQgYSBncm91\ncCBvZiBwb3NzaWJseSB1bmtub3duIGZpZWxkcyB3YXMgbG9hZGVkCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwb3N0TG9hZChpbnQgZmllbGQsIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIC8vIG5vIG5lZWQgZm9y\nIHBvc3RMb2FkIGNhbGxiYWNrPwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19MT0FERUQpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gaW4gdGhlIG1pZGRsZSBvZiBhIGdyb3VwIGxvYWQsIGFmdGVyIHdoaWNo\nIHRoaXMgbWV0aG9kIHdpbGwgYmUKICAgICAgICAvLyBjYWxsZWQgYWdhaW4/\nCiAgICAgICAgaWYgKGZpZWxkICE9IC0xICYmIGlzTG9hZGluZygpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG5vIGxpc3RlbmVycz8KICAg\nICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIgbWdyID0gX2Jyb2tlci5nZXRM\naWZlY3ljbGVFdmVudE1hbmFnZXIoKTsKICAgICAgICBpZiAobWdyID09IG51\nbGwgfHwgIW1nci5oYXNMb2FkTGlzdGVuZXJzKGdldE1hbmFnZWRJbnN0YW5j\nZSgpLCBfbWV0YSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYg\nKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gX2Jyb2tlci5n\nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAvLyBpcyB0aGlzIGZp\nZWxkIGEgcG9zdC1sb2FkIGZpZWxkPwogICAgICAgIGlmIChmaWVsZCAhPSAt\nMSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgaWYgKGZtZC5pc0luRGVmYXVs\ndEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgICAgICYmIGZldGNoLmhhc0Zl\ndGNoR3JvdXAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQpCiAgICAgICAgICAg\nICAgICAmJiBwb3N0TG9hZChGZXRjaEdyb3VwLk5BTUVfREVGQVVMVCwgZmV0\nY2gpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBTdHJp\nbmdbXSBmZ3MgPSBmbWQuZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmZ3MubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICBpZiAoZmV0Y2guaGFzRmV0Y2hHcm91cChmZ3NbaV0p\nICYmIHBvc3RMb2FkKGZnc1tpXSwgZmV0Y2gpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IGZldGNoLmdldEZldGNoR3JvdXBzKCkuaXRlcmF0\nb3IoKTsgCiAgICAgICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgaWYgKHBvc3RMb2FkKChTdHJpbmcpIGl0ci5uZXh0KCks\nIGZldGNoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3Jt\nIHBvc3QtbG9hZCBhY3Rpb25zIGlmIHRoZSBnaXZlbiBmZXRjaCBncm91cCBp\ncyBhIHBvc3QtbG9hZCBncm91cAogICAgICogYW5kIGlzIGZ1bGx5IGxvYWRl\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHBvc3RMb2FkKFN0cmlu\nZyBmZ05hbWUsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIEZldGNoR3JvdXAgZmcgPSBfbWV0YS5nZXRGZXRjaEdyb3VwKGZnTmFtZSk7\nCiAgICAgICAgaWYgKGZnID09IG51bGwgfHwgIWZnLmlzUG9zdExvYWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKCFfbG9hZGVkLmdldChpKSAmJiBmbWRzW2ldLmlzSW5GZXRjaEdyb3Vw\nKGZnTmFtZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIF9mbGFncyB8PSBGTEFHX0xPQURFRDsKICAgICAgICBfYnJva2VyLmZp\ncmVMaWZlY3ljbGVFdmVudChnZXRNYW5hZ2VkSW5zdGFuY2UoKSwgZmV0Y2gs\nIF9tZXRhLCAKICAgICAgICAJTGlmZWN5Y2xlRXZlbnQuQUZURVJfTE9BRCk7\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\neW5jaHJvbml6ZSBvdXIgdmVyc2lvbiBvYmplY3Qgd2l0aCB0aGUgZGF0YXN0\nb3JlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3luY1ZlcnNpb24o\nT2JqZWN0IHNkYXRhKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZ2V0U3Rv\ncmVNYW5hZ2VyKCkuc3luY1ZlcnNpb24odGhpcywgc2RhdGEpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB3aGV0aGVyIHRoaXMgaW5zdGFuY2Ug\nbmVlZHMgYSB2ZXJzaW9uIGNoZWNrLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1ZlcnNpb25DaGVja1JlcXVpcmVkKCkgewogICAgICAgIC8vIGV4\ncGxpY2l0IGZsYWcgZm9yIHZlcnNpb24gY2hlY2sKICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfVkVSU0lPTl9DSEVDSykgIT0gMCkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CgogICAgICAgIGlmICghX2Jyb2tlci5nZXRPcHRpbWlz\ndGljKCkgJiYgIV9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAg\nICAgICBnZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXROb25PcHRpbWlz\ndGljVmVyc2lvbkNoZWNrKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gX3N0YXRlLmlzVmVyc2lvbkNoZWNrUmVxdWlyZWQo\ndGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgd2hldGhlciB0aGlz\nIGluc3RhbmNlIHJlcXVpcmVzIGEgdmVyc2lvbiBjaGVjayBvbiB0aGUgbmV4\ndCBmbHVzaC4KICAgICAqLwogICAgdm9pZCBzZXRDaGVja1ZlcnNpb24oYm9v\nbGVhbiB2ZXJzaW9uQ2hlY2spIHsKICAgICAgICBpZiAodmVyc2lvbkNoZWNr\nKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19WRVJTSU9OX0NIRUNLOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJ\nT05fQ0hFQ0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHdoZXRo\nZXIgdGhpcyBpbnN0YW5jZSBuZWVkcyBhIHZlcnNpb24gdXBkYXRlLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNpb25VcGRhdGVSZXF1aXJl\nZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfVkVSU0lPTl9V\nUERBVEUpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB3aGV0aGVy\nIHRoaXMgaW5zdGFuY2UgcmVxdWlyZXMgYSB2ZXJzaW9uIHVwZGF0ZSBvbiB0\naGUgbmV4dCBmbHVzaC4KICAgICAqLwogICAgdm9pZCBzZXRVcGRhdGVWZXJz\naW9uKGJvb2xlYW4gdmVyc2lvblVwZGF0ZSkgewogICAgICAgIGlmICh2ZXJz\naW9uVXBkYXRlKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19WRVJTSU9O\nX1VQREFURTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19WRVJTSU9OX1VQREFURTsKICAgIH0KCiAgICAvKioKICAgICAqIFRy\nYW5zbGF0ZSB0aGUgZ2l2ZW4gZXhjZXB0aW9uIGJhc2VkIG9uIHRoZSBicm9r\nZXIncyBpbXBsaWNpdCBiZWhhdmlvci4KICAgICAqIFRyYW5zbGF0aW9uIG9u\nbHkgb2NjdXJzIGlmIHRoZSBleGNlcHRpb24gaXMgaW5pdGlhdGVkIGJ5IGEg\ndXNlciBhY3Rpb24KICAgICAqIG9uIGFuIGluc3RhbmNlLCBhbmQgdGhlcmVm\nb3JlIHdpbGwgbm90IGJlIGNhdWdodCBhbmQgdHJhbnNsYXRlZCBieSB0aGUK\nICAgICAqIGJyb2tlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFJ1bnRpbWVF\neGNlcHRpb24gdHJhbnNsYXRlKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciB0cmFucyA9IF9icm9r\nZXIuCiAgICAgICAgICAgIGdldEluc3RhbmNlRXhjZXB0aW9uVHJhbnNsYXRv\ncigpOwogICAgICAgIHJldHVybiAodHJhbnMgPT0gbnVsbCkgPyByZSA6IHRy\nYW5zLnRyYW5zbGF0ZShyZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2Nr\nIHRoZSBzdGF0ZSBtYW5hZ2VyIGlmIHRoZSBtdWx0aXRocmVhZGVkIG9wdGlv\nbiBpcyBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGxvY2soKSB7\nCiAgICAgICAgLy8gdXNlIGJyb2tlci1sZXZlbCBsb2NrIHRvIGF2b2lkIGRl\nYWRsb2NrIHNpdHVhdGlvbnMgd2l0aCB0aGUgc3RhdGUKICAgICAgICAvLyBt\nYW5hZ2VyIGxvY2sgYW5kIGJyb2tlciBsb2NrIGJlaW5nIG9idGFpbmVkIGlu\nIGRpZmZlcmVudCBvcmRlcnMKICAgICAgICBfYnJva2VyLmxvY2soKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVubG9jayB0aGUgc3RhdGUgbWFuYWdlci4K\nICAgICAqLwoJcHJvdGVjdGVkIHZvaWQgdW5sb2NrICgpCgl7CgkJLy8gdXNl\nIGJyb2tlci1sZXZlbCBsb2NrIHRvIGF2b2lkIGRlYWRsb2NrIHNpdHVhdGlv\nbnMgd2l0aCB0aGUgc3RhdGUgCgkJLy8gbWFuYWdlciBsb2NrIGFuZCBicm9r\nZXIgbG9jayBiZWluZyBvYnRhaW5lZCBpbiBkaWZmZXJlbnQgb3JkZXJzCgkJ\nX2Jyb2tlci51bmxvY2sgKCk7Cgl9Cn0K\n","encoding":"base64"}

