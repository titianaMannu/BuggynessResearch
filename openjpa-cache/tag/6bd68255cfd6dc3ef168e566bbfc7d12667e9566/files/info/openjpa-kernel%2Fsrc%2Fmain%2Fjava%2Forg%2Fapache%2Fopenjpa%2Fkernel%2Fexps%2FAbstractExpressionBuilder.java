{"sha":"4e0571350f75b0855f76caf731b2b997a3a7c0d6","node_id":"MDQ6QmxvYjIwNjM2NDo0ZTA1NzEzNTBmNzViMDg1NWY3NmNhZjczMWIyYjk5N2EzYTdjMGQ2","size":17903,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4e0571350f75b0855f76caf731b2b997a3a7c0d6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHM7CgppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51\ndGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5GaWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXIuTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuWE1MTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBz\nZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNsYXNz\nIHRvIGhlbHAgYnVpbGQgZXhwcmVzc2lvbnMuIFByb3ZpZGVzCiAqIGdlbmVy\naWMgbGFuZ3VhZ2UtaW5kZXBlbmRlbnQgc3VwcG9ydCBmb3IgdmFyaWFibGUg\ncmVzb2x1dGlvbiwKICogcGF0aCB0cmF2ZXJzYWwsIGFuZCBlcnJvciBtZXNz\nYWdlcy4KICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQG5v\namF2YWRvYwogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEFic3RyYWN0RXhw\ncmVzc2lvbkJ1aWxkZXIgewoKICAgIC8vIHVzZWQgZm9yIGVycm9yIG1lc3Nh\nZ2VzCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBFWF9VU0VSID0g\nMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEVYX0ZBVEFMID0g\nMTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEVYX1VOU1VQUE9S\nVEVEID0gMjsKCiAgICAvLyBjb21tb24gaW1wbGljaXQgdHlwZSBzZXR0aW5n\ncwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBDbGFzcyBUWVBFX09CSkVD\nVCA9IE9iamVjdC5jbGFzczsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\nQ2xhc3MgVFlQRV9TVFJJTkcgPSBTdHJpbmcuY2xhc3M7CiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIENsYXNzIFRZUEVfQ0hBUl9PQkogPSBDaGFyYWN0\nZXIuY2xhc3M7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzIFRZ\nUEVfTlVNQkVSID0gTnVtYmVyLmNsYXNzOwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBmaW5hbCBDbGFzcyBUWVBFX0NPTExFQ1RJT04gPSBDb2xsZWN0aW9uLmNs\nYXNzOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBDbGFzcyBUWVBFX01B\nUCA9IE1hcC5jbGFzczsKCiAgICAvLyBjb250YWlucyB0eXBlcyBmb3Igc2V0\nSW1wbGljaXRUeXBlcwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQg\nQ09OVEFJTlNfVFlQRV9FTEVNRU5UID0gMTsKICAgIHByb3RlY3RlZCBzdGF0\naWMgZmluYWwgaW50IENPTlRBSU5TX1RZUEVfS0VZID0gMjsKICAgIHByb3Rl\nY3RlZCBzdGF0aWMgZmluYWwgaW50IENPTlRBSU5TX1RZUEVfVkFMVUUgPSAz\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQWJzdHJhY3RFeHByZXNz\naW9uQnVpbGRlci5jbGFzcyk7CgogICAgcHJvdGVjdGVkIGZpbmFsIFJlc29s\ndmVyIHJlc29sdmVyOwogICAgcHJvdGVjdGVkIEV4cHJlc3Npb25GYWN0b3J5\nIGZhY3Rvcnk7CgogICAgcHJpdmF0ZSBmaW5hbCBTZXQgX2FjY2Vzc1BhdGgg\nPSBuZXcgSGFzaFNldCgpOwogICAgcHJpdmF0ZSBNYXAgX3NlZW5WYXJzID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9ib3VuZFZhcnMgPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFt\nIGZhY3RvcnkgdGhlIGV4cHJlc3Npb24gZmFjdG9yeSB0byB1c2UKICAgICAq\nIEBwYXJhbSByZXNvbHZlciB1c2VkIHRvIHJlc29sdmUgdmFyaWFibGVzLCBw\nYXJhbWV0ZXJzLCBhbmQgY2xhc3MKICAgICAqIG5hbWVzIHVzZWQgaW4gdGhl\nIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBBYnN0cmFjdEV4cHJlc3Npb25C\ndWlsZGVyKEV4cHJlc3Npb25GYWN0b3J5IGZhY3RvcnksCiAgICAgICAgUmVz\nb2x2ZXIgcmVzb2x2ZXIpIHsKICAgICAgICB0aGlzLmZhY3RvcnkgPSBmYWN0\nb3J5OwogICAgICAgIHRoaXMucmVzb2x2ZXIgPSByZXNvbHZlcjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNzIGxvYWRlciB0aGF0\nIHNob3VsZCBiZSB1c2VkIGZvciByZXNvbHZpbmcKICAgICAqIGNsYXNzIG5h\nbWVzIChpbiBhZGRpdGlvbiB0byB0aGUgcmVzb2x2ZXIgaW4gdGhlIHF1ZXJ5\nKS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IENsYXNzTG9hZGVy\nIGdldENsYXNzTG9hZGVyKCk7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBw\ncm9wZXIgcGFyc2UgZXhjZXB0aW9uIGZvciB0aGUgZ2l2ZW4gcmVhc29uLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgT3BlbkpQQUV4Y2VwdGlvbiBwYXJzZUV4\nY2VwdGlvbihpbnQgZSwgU3RyaW5nIHRva2VuLAogICAgICAgIE9iamVjdFtd\nIGFyZ3MsCiAgICAgICAgRXhjZXB0aW9uIG5lc3QpIHsKICAgICAgICBTdHJp\nbmcgYXJnU3RyOwogICAgICAgIGlmIChhcmdzID09IG51bGwpCiAgICAgICAg\nICAgIGFyZ1N0ciA9IGdldExvY2FsaXplcigpLmdldCh0b2tlbikuZ2V0TWVz\nc2FnZSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYXJnU3RyID0gZ2V0\nTG9jYWxpemVyKCkuZ2V0KHRva2VuLCBhcmdzKS5nZXRNZXNzYWdlKCk7Cgog\nICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInBhcnNlLWVycm9yIiwg\nYXJnU3RyLCBjdXJyZW50UXVlcnkoKSk7CgogICAgICAgIHN3aXRjaCAoZSkg\newogICAgICAgICAgICBjYXNlIEVYX0ZBVEFMOgogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKG1zZywgbmVzdCk7CiAgICAg\nICAgICAgIGNhc2UgRVhfVU5TVVBQT1JURUQ6CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24obXNnLCBuZXN0KTsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKG1zZywgbmVzdCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmVnaXN0ZXIgdGhlIHNwZWNpZmllZCBtZXRhZGF0YSBh\ncyBiZWluZyBpbiB0aGUgcXVlcnkncyBhY2Nlc3MgcGF0aC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgYWRkQWNjZXNzUGF0aChDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBfYWNjZXNzUGF0aC5hZGQobWV0\nYSk7CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHJlY29yZGVkIHF1ZXJ5IGFjY2VzcyBwYXRoLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1Bh\ndGgoKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01ldGFEYXRhW10pIF9hY2Nl\nc3NQYXRoLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBDbGFzc01ldGFEYXRh\nW19hY2Nlc3NQYXRoLnNpemUoKV0pOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHZhcmlhYmxlIGhhcyBiZWVuIGJv\ndW5kLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc0JvdW5kKFZh\nbHVlIHZhcikgewogICAgICAgIHJldHVybiBfYm91bmRWYXJzICE9IG51bGwg\nJiYgX2JvdW5kVmFycy5jb250YWlucyh2YXIpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVjb3JkIHRoYXQgdGhlIGdpdmVuIHZhcmlhYmxlIGlzIGJvdW5k\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBiaW5kKFZhbHVlIHZhcikg\newogICAgICAgIGlmIChfYm91bmRWYXJzID09IG51bGwpCiAgICAgICAgICAg\nIF9ib3VuZFZhcnMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgIF9ib3VuZFZh\ncnMuYWRkKHZhcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEg\ndmFsdWUgZm9yIHRoZSBnaXZlbiBpZC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFZhbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCwgYm9vbGVhbiBiaW5kKSB7\nCiAgICAgICAgLy8gY2hlY2sgZm9yIGFscmVhZHkgY29uc3RydWN0ZWQgdmFy\nCiAgICAgICAgaWYgKGlzU2VlblZhcmlhYmxlKGlkKSkKICAgICAgICAgICAg\ncmV0dXJuIChWYWx1ZSkgX3NlZW5WYXJzLmdldChpZCk7CgogICAgICAgIC8v\nIGNyZWF0ZSBhbmQgY2FjaGUgdmFyCiAgICAgICAgQ2xhc3MgdHlwZSA9IGdl\ndERlY2xhcmVkVmFyaWFibGVUeXBlKGlkKTsKCiAgICAgICAgLy8gYWRkIHRo\naXMgdHlwZSB0byB0aGUgc2V0IG9mIGNsYXNzZXMgaW4gdGhlIGZpbHRlcidz\nIGFjY2VzcyBwYXRoCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbnVs\nbDsKICAgICAgICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICB0eXBl\nID0gVFlQRV9PQkpFQ1Q7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtZXRh\nID0gZ2V0TWV0YURhdGEodHlwZSwgZmFsc2UpOwogICAgICAgIGlmIChtZXRh\nICE9IG51bGwpCiAgICAgICAgICAgIF9hY2Nlc3NQYXRoLmFkZChtZXRhKTsK\nCiAgICAgICAgVmFsdWUgdmFyOwogICAgICAgIGlmIChiaW5kKQogICAgICAg\nICAgICB2YXIgPSBmYWN0b3J5Lm5ld0JvdW5kVmFyaWFibGUoaWQsIHR5cGUp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFyID0gZmFjdG9yeS5uZXdV\nbmJvdW5kVmFyaWFibGUoaWQsIHR5cGUpOwogICAgICAgIHZhci5zZXRNZXRh\nRGF0YShtZXRhKTsKCiAgICAgICAgaWYgKF9zZWVuVmFycyA9PSBudWxsKQog\nICAgICAgICAgICBfc2VlblZhcnMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nIF9zZWVuVmFycy5wdXQoaWQsIHZhcik7CiAgICAgICAgcmV0dXJuIHZhcjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgYWxsIHVuYm91\nbmQgdmFyaWFibGVzIGFyZSBvZiBhIFBDIHR5cGUuIElmIG5vdCwgYXNzdW1l\nCiAgICAgKiB0aGF0IHRoZSB1c2VyIGFjdHVhbGx5IG1hZGUgYSB0eXBvIHRo\nYXQgd2UgdG9vayBmb3IgYW4gaW1wbGljaXQKICAgICAqIHVuYm91bmQgdmFy\naWFibGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydFVuYm91\nbmRWYXJpYWJsZXNWYWxpZCgpIHsKICAgICAgICBpZiAoX3NlZW5WYXJzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWFwLkVudHJ5\nIGVudHJ5OwogICAgICAgIFZhbHVlIHZhcjsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IF9zZWVuVmFycy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRy\neSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgdmFyID0gKFZhbHVlKSBlbnRy\neS5nZXRWYWx1ZSgpOwogICAgICAgICAgICBpZiAodmFyLmdldE1ldGFEYXRh\nKCkgPT0gbnVsbCAmJiAhaXNCb3VuZCh2YXIpCiAgICAgICAgICAgICAgICAm\nJiAhaXNEZWNsYXJlZFZhcmlhYmxlKChTdHJpbmcpIGVudHJ5LmdldEtleSgp\nKSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhf\nVVNFUiwgIm5vdC11bmJvdW5kLXZhciIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBlbnRyeS5nZXRLZXkoKSB9LCBudWxsKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgd2hldGhlciB0aGUgc3BlY2lmaWVkIHZhcmlhYmxlIG5hbWUgaGFzIGJl\nZW4gZXhwbGljaXRseQogICAgICogZGVjbGFyZWQuIE5vdGUgYWxsIHF1ZXJ5\nIGxhbmd1YWdlcyBuZWNlc3NhcmlseSBzdXBwb3J0IGRlY2xhcmluZwogICAg\nICogdmFyaWFibGVzLgogICAgICoKICAgICAqIEBwYXJhbSBpZCB0aGUgdmFy\naWFibGUgdG8gY2hlY2sKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdmFy\naWFiZSBoYXMgYmVlbiBleHBsaWNpdGVseSBkZWNsYXJlZAogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3QgYm9vbGVhbiBpc0RlY2xhcmVkVmFyaWFi\nbGUoU3RyaW5nIGlkKTsKCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBpZCBoYXMgYmVlbiB1c2VkIGFzIGEgdmFyaWFibGUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzU2VlblZhcmlhYmxlKFN0\ncmluZyBpZCkgewogICAgICAgIHJldHVybiBfc2VlblZhcnMgIT0gbnVsbCAm\nJiBfc2VlblZhcnMuY29udGFpbnNLZXkoaWQpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIGdldCBtZXRhZGF0YSBmb3Ig\ndGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhKENsYXNzIGMsIGJvb2xlYW4gcmVxdWlyZWQp\nIHsKICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGEoYywgcmVxdWlyZWQsIGdl\ndENsYXNzTG9hZGVyKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVu\naWVuY2UgbWV0aG9kIHRvIGdldCBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldE1l\ndGFEYXRhKENsYXNzIGMsIGJvb2xlYW4gcmVxdWlyZWQsCiAgICAgICAgQ2xh\nc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgcmV0dXJuIHJlc29sdmVyLmdl\ndENvbmZpZ3VyYXRpb24oKS5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5j\nZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YShjLCBsb2FkZXIsIHJlcXVp\ncmVkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYXZlcnNlIHRoZSBnaXZl\nbiBmaWVsZCBpbiB0aGUgZ2l2ZW4gcGF0aC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFZhbHVlIHRyYXZlcnNlUGF0aChQYXRoIHBhdGgsIFN0cmluZyBmaWVs\nZCkgewogICAgICAgIHJldHVybiB0cmF2ZXJzZVBhdGgocGF0aCwgZmllbGQs\nIGZhbHNlLCBmYWxzZSk7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBWYWx1\nZSB0cmF2ZXJzZVhQYXRoKFBhdGggcGF0aCwgU3RyaW5nIGZpZWxkKSB7CiAg\nICAgICAgWE1MTWV0YURhdGEgbWV0YSA9IHBhdGguZ2V0WG1sTWFwcGluZygp\nOwogICAgICAgIGlmIChtZXRhLmdldEZpZWxkTWFwcGluZyhmaWVsZCkgPT0g\nbnVsbCkgewogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm8tZmllbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmpl\nY3RbXXsgbWV0YS5nZXRUeXBlKCksIGZpZWxkIH0sIG51bGwpOwogICAgICAg\nIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gY29sbGVjdGlvbi12\nYWx1ZWQgeHBhdGggaXMgbm90IGFsbG93ZWQKICAgICAgICAgICAgaW50IHR5\ncGUgPSBtZXRhLmdldEZpZWxkTWFwcGluZyhmaWVsZCkuZ2V0VHlwZUNvZGUo\nKTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoImNvbGxlY3Rpb24tdmFsdWVkLXBhdGgi\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBwYXRoLmdldChtZXRhLCBmaWVs\nZCk7CiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUcmF2ZXJzZSB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIHBhdGgu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZSB0cmF2ZXJzZVBhdGgoUGF0\naCBwYXRoLCBTdHJpbmcgZmllbGQsIGJvb2xlYW4gcGNPbmx5LAogICAgICAg\nIGJvb2xlYW4gYWxsb3dOdWxsKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gcGF0aC5nZXRNZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VT\nRVIsICJwYXRoLW5vLW1ldGEiLAogICAgICAgICAgICAgICAgbmV3IE9iamVj\ndFtdeyBmaWVsZCwgcGF0aC5nZXRUeXBlKCkgfSwgbnVsbCk7CgogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKGZtZCA9PSBudWxsKSB7CiAgICAgICAgICAgIE9iamVjdCB2\nYWwgPSB0cmF2ZXJzZVN0YXRpY0ZpZWxkKG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpLCBmaWVsZCk7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJu\nby1maWVsZCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBt\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgZmllbGQgfSwgbnVsbCk7CgogICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKHZhbCwgTGl0ZXJh\nbC5UWVBFX1VOS05PV04pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZtZC5p\nc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIG1ldGEgPSBmbWQuZ2V0RW1iZWRk\nZWRNZXRhRGF0YSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0YSA9\nIGZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGlmICht\nZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgYWRkQWNjZXNzUGF0aChtZXRh\nKTsKICAgICAgICAgICAgcGF0aC5zZXRNZXRhRGF0YShtZXRhKTsKICAgICAg\nICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHhtbHN1cHBvcnQg\neHBhdGgKICAgICAgICAgICAgWE1MTWV0YURhdGEgeG1sbWV0YSA9IGZtZC5n\nZXRSZXBvc2l0b3J5KCkuZ2V0WE1MTWV0YURhdGEoZm1kKTsKICAgICAgICAg\nICAgaWYgKHhtbG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcGF0\naC5nZXQoZm1kLCB4bWxtZXRhKTsKICAgICAgICAgICAgICAgIHJldHVybiBw\nYXRoOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobWV0\nYSAhPSBudWxsIHx8ICFwY09ubHkpCiAgICAgICAgICAgIHBhdGguZ2V0KGZt\nZCwgYWxsb3dOdWxsKTsKCiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjb25zdGFudCBjb250YWluaW5nIHRo\nZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gc3RhdGljIGZpZWxkLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgT2JqZWN0IHRyYXZlcnNlU3RhdGljRmllbGQoQ2xhc3Mg\nY2xzLCBTdHJpbmcgZmllbGQpIHsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gY2xzLmdldEZpZWxkKGZpZWxkKS5nZXQobnVsbCk7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY291\nbnQgbm90IGxvY2F0ZSB0aGUgZmllbGQ6IHJldHVybiBudWxsCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIHR5cGUgb2YgdGhlIG5hbWVkIHZhcmlhYmUgaWYg\naXQgaGFzIGJlZW4gZGVjbGFyZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBh\nYnN0cmFjdCBDbGFzcyBnZXREZWNsYXJlZFZhcmlhYmxlVHlwZShTdHJpbmcg\nbmFtZSk7CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGltcGxpY2l0IHR5cGVz\nIG9mIHRoZSBnaXZlbiB2YWx1ZXMgYmFzZWQgb24gdGhlIGZhY3QgdGhhdAog\nICAgICogdGhleSdyZSB1c2VkIHRvZ2V0aGVyLCBhbmQgYmFzZWQgb24gdGhl\nIG9wZXJhdG9yIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNl\ndEltcGxpY2l0VHlwZXMoVmFsdWUgdmFsMSwgVmFsdWUgdmFsMiwKICAgICAg\nICBDbGFzcyBleHBlY3RlZCkgewogICAgICAgIENsYXNzIGMxID0gdmFsMS5n\nZXRUeXBlKCk7CiAgICAgICAgQ2xhc3MgYzIgPSB2YWwyLmdldFR5cGUoKTsK\nICAgICAgICBib29sZWFuIG8xID0gYzEgPT0gVFlQRV9PQkpFQ1Q7CiAgICAg\nICAgYm9vbGVhbiBvMiA9IGMyID09IFRZUEVfT0JKRUNUOwoKICAgICAgICBp\nZiAobzEgJiYgIW8yKSB7CiAgICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRU\neXBlKGMyKTsKICAgICAgICAgICAgaWYgKHZhbDEuZ2V0TWV0YURhdGEoKSA9\nPSBudWxsICYmICF2YWwxLmlzWFBhdGgoKSkKICAgICAgICAgICAgICAgIHZh\nbDEuc2V0TWV0YURhdGEodmFsMi5nZXRNZXRhRGF0YSgpKTsKICAgICAgICB9\nIGVsc2UgaWYgKCFvMSAmJiBvMikgewogICAgICAgICAgICB2YWwyLnNldElt\ncGxpY2l0VHlwZShjMSk7CiAgICAgICAgICAgIGlmICh2YWwyLmdldE1ldGFE\nYXRhKCkgPT0gbnVsbCAmJiAhdmFsMS5pc1hQYXRoKCkpCiAgICAgICAgICAg\nICAgICB2YWwyLnNldE1ldGFEYXRhKHZhbDEuZ2V0TWV0YURhdGEoKSk7CiAg\nICAgICAgfSBlbHNlIGlmIChvMSAmJiBvMiAmJiBleHBlY3RlZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIHdlIG5ldmVyIGV4cGVjdCBhIHBjIHR5cGUs\nIHNvIGRvbid0IGJvdGhlciB3aXRoIG1ldGFkYXRhCiAgICAgICAgICAgIHZh\nbDEuc2V0SW1wbGljaXRUeXBlKGV4cGVjdGVkKTsKICAgICAgICAgICAgdmFs\nMi5zZXRJbXBsaWNpdFR5cGUoZXhwZWN0ZWQpOwogICAgICAgIH0gZWxzZSBp\nZiAoaXNOdW1lcmljKHZhbDEuZ2V0VHlwZSgpKSAhPSBpc051bWVyaWModmFs\nMi5nZXRUeXBlKCkpKSB7CiAgICAgICAgICAgIGlmIChyZXNvbHZlci5nZXRD\nb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuCiAg\nICAgICAgICAgICAgICBnZXRRdW90ZWROdW1iZXJzSW5RdWVyaWVzKCkpCiAg\nICAgICAgICAgICAgICBjb252ZXJ0VHlwZXNRdW90ZWROdW1iZXJzKHZhbDEs\nIHZhbDIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb252\nZXJ0VHlwZXModmFsMSwgdmFsMik7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUGVyZm9ybSBjb252ZXJzaW9ucyB0byBtYWtlIHZhbHVlcyBj\nb21wYXRpYmxlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29udmVydFR5\ncGVzKFZhbHVlIHZhbDEsIFZhbHVlIHZhbDIpIHsKICAgICAgICBDbGFzcyB0\nMSA9IHZhbDEuZ2V0VHlwZSgpOwogICAgICAgIENsYXNzIHQyID0gdmFsMi5n\nZXRUeXBlKCk7CgogICAgICAgIC8vIGFsbG93IHN0cmluZy10by1jaGFyIGNv\nbnZlcnNpb25zCiAgICAgICAgaWYgKHQxID09IFRZUEVfU1RSSU5HICYmIChG\naWx0ZXJzLndyYXAodDIpID09IFRZUEVfQ0hBUl9PQkoKICAgICAgICAgICAg\nJiYgISh2YWwyIGluc3RhbmNlb2YgUGF0aCkpKSB7CiAgICAgICAgICAgIHZh\nbDIuc2V0SW1wbGljaXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHQyID09IFRZUEVfU1RS\nSU5HICYmIChGaWx0ZXJzLndyYXAodDEpID09IFRZUEVfQ0hBUl9PQkopCiAg\nICAgICAgICAgICYmICEodmFsMSBpbnN0YW5jZW9mIFBhdGgpKSB7CiAgICAg\nICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKFN0cmluZy5jbGFzcyk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRo\nZSBub24tbnVtZXJpYyBzaWRlIGlzIGEgc3RyaW5nIG9mIGxlbmd0aCAxLCBj\nYXN0IGl0CiAgICAgICAgLy8gdG8gYSBjaGFyYWN0ZXIKICAgICAgICBpZiAo\ndDEgPT0gVFlQRV9TVFJJTkcgJiYgdmFsMSBpbnN0YW5jZW9mIExpdGVyYWwK\nICAgICAgICAgICAgJiYgKChTdHJpbmcpICgoTGl0ZXJhbCkgdmFsMSkuZ2V0\nVmFsdWUoKSkubGVuZ3RoKCkgPT0gMSkgewogICAgICAgICAgICB2YWwxLnNl\ndEltcGxpY2l0VHlwZShDaGFyYWN0ZXIuY2xhc3MpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0MiA9PSBUWVBFX1NUUklO\nRyAmJiB2YWwyIGluc3RhbmNlb2YgTGl0ZXJhbAogICAgICAgICAgICAmJiAo\nKFN0cmluZykgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgpKS5sZW5ndGgo\nKSA9PSAxKSB7CiAgICAgICAgICAgIHZhbDIuc2V0SW1wbGljaXRUeXBlKENo\nYXJhY3Rlci5jbGFzcyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIGVycm9yCiAgICAgICAgU3RyaW5nIGxlZnQ7CiAgICAg\nICAgU3RyaW5nIHJpZ2h0OwogICAgICAgIGlmICh2YWwxIGluc3RhbmNlb2Yg\nUGF0aCAmJiAoKFBhdGgpIHZhbDEpLmxhc3QoKSAhPSBudWxsKQogICAgICAg\nICAgICBsZWZ0ID0gX2xvYy5nZXQoIm5vbi1udW1lcmljLXBhdGgiLCAoKFBh\ndGgpIHZhbDEpLmxhc3QoKS4KICAgICAgICAgICAgICAgIGdldE5hbWUoKSwg\ndDEuZ2V0TmFtZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBsZWZ0ID0gX2xvYy5nZXQoIm5vbi1udW1lcmljLXZhbHVlIiwg\ndDEuZ2V0TmFtZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgaWYgKHZhbDIg\naW5zdGFuY2VvZiBQYXRoICYmICgoUGF0aCkgdmFsMikubGFzdCgpICE9IG51\nbGwpCiAgICAgICAgICAgIHJpZ2h0ID0gX2xvYy5nZXQoIm5vbi1udW1lcmlj\nLXBhdGgiLCAoKFBhdGgpIHZhbDIpLmxhc3QoKS4KICAgICAgICAgICAgICAg\nIGdldE5hbWUoKSwgdDIuZ2V0TmFtZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICByaWdodCA9IF9sb2MuZ2V0KCJub24tbnVt\nZXJpYy12YWx1ZSIsIHQyLmdldE5hbWUoKSkuZ2V0TWVzc2FnZSgpOwogICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tbnVt\nZXJpYy1jb21wYXJpc29uIiwKICAgICAgICAgICAgbGVmdCwgcmlnaHQpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gY29udmVyc2lvbnMgdG8g\nbWFrZSB2YWx1ZXMgY29tcGF0aWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGNvbnZlcnRUeXBlc1F1b3RlZE51bWJlcnMoVmFsdWUgdmFsMSwgVmFs\ndWUgdmFsMikgewogICAgICAgIENsYXNzIHQxID0gdmFsMS5nZXRUeXBlKCk7\nCiAgICAgICAgQ2xhc3MgdDIgPSB2YWwyLmdldFR5cGUoKTsKCiAgICAgICAg\nLy8gaWYgd2UncmUgY29tcGFyaW5nIHRvIGEgc2luZ2xlLXF1b3RlZCBzdHJp\nbmcsIGNvbnZlcnQKICAgICAgICAvLyB0aGUgdmFsdWUgYWNjb3JkaW5nIHRv\nIHRoZSAzLjEgcnVsZXMuCiAgICAgICAgaWYgKHQxID09IFRZUEVfU1RSSU5H\nICYmIHZhbDEgaW5zdGFuY2VvZiBMaXRlcmFsCiAgICAgICAgICAgICYmICgo\nTGl0ZXJhbCkgdmFsMSkuZ2V0UGFyc2VUeXBlKCkgPT0gTGl0ZXJhbC5UWVBF\nX1NRX1NUUklORykgewogICAgICAgICAgICBTdHJpbmcgcyA9IChTdHJpbmcp\nICgoTGl0ZXJhbCkgdmFsMSkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYg\nKHMubGVuZ3RoKCkgPiAxKSB7CiAgICAgICAgICAgICAgICAoKExpdGVyYWwp\nIHZhbDEpLnNldFZhbHVlKHMuc3Vic3RyaW5nKDAsIDEpKTsKICAgICAgICAg\nICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKENoYXJhY3Rlci5UWVBFKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodDIgPT0gVFlQ\nRV9TVFJJTkcgJiYgdmFsMiBpbnN0YW5jZW9mIExpdGVyYWwKICAgICAgICAg\nICAgJiYgKChMaXRlcmFsKSB2YWwyKS5nZXRQYXJzZVR5cGUoKSA9PSBMaXRl\ncmFsLlRZUEVfU1FfU1RSSU5HKSB7CiAgICAgICAgICAgIFN0cmluZyBzID0g\nKFN0cmluZykgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgpOwogICAgICAg\nICAgICBpZiAocy5sZW5ndGgoKSA+IDEpIHsKICAgICAgICAgICAgICAgICgo\nTGl0ZXJhbCkgdmFsMikuc2V0VmFsdWUocy5zdWJzdHJpbmcoMCwgMSkpOwog\nICAgICAgICAgICAgICAgdmFsMi5zZXRJbXBsaWNpdFR5cGUoQ2hhcmFjdGVy\nLlRZUEUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZiB3ZSdyZSBjb21wYXJpbmcgdG8gYSBkb3VibGUtcXVvdGVkIHN0cmluZywg\nY29udmVydCB0aGUKICAgICAgICAvLyB2YWx1ZSBkaXJlY3RseSB0byBhIG51\nbWJlcgogICAgICAgIGlmICh0MSA9PSBUWVBFX1NUUklORyAmJiB2YWwxIGlu\nc3RhbmNlb2YgTGl0ZXJhbAogICAgICAgICAgICAmJiAoKExpdGVyYWwpIHZh\nbDEpLmdldFBhcnNlVHlwZSgpID09IExpdGVyYWwuVFlQRV9TVFJJTkcpIHsK\nICAgICAgICAgICAgU3RyaW5nIHMgPSAoU3RyaW5nKSAoKExpdGVyYWwpIHZh\nbDEpLmdldFZhbHVlKCk7CiAgICAgICAgICAgICgoTGl0ZXJhbCkgdmFsMSku\nc2V0VmFsdWUoU3RyaW5ncy5wYXJzZShzLCBGaWx0ZXJzLndyYXAodDIpKSk7\nCiAgICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKHQyKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKHQyID09IFRZUEVfU1RSSU5HICYmIHZhbDIgaW5z\ndGFuY2VvZiBMaXRlcmFsCiAgICAgICAgICAgICYmICgoTGl0ZXJhbCkgdmFs\nMikuZ2V0UGFyc2VUeXBlKCkgPT0gTGl0ZXJhbC5UWVBFX1NUUklORykgewog\nICAgICAgICAgICBTdHJpbmcgcyA9IChTdHJpbmcpICgoTGl0ZXJhbCkgdmFs\nMikuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgKChMaXRlcmFsKSB2YWwyKS5z\nZXRWYWx1ZShTdHJpbmdzLnBhcnNlKHMsIEZpbHRlcnMud3JhcCh0MSkpKTsK\nICAgICAgICAgICAgdmFsMi5zZXRJbXBsaWNpdFR5cGUodDEpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIGdpdmVu\nIGNsYXNzIGNhbiBiZSB1c2VkIGFzIGEgbnVtYmVyLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBib29sZWFuIGlzTnVtZXJpYyhDbGFzcyB0eXBlKSB7\nCiAgICAgICAgdHlwZSA9IEZpbHRlcnMud3JhcCh0eXBlKTsKICAgICAgICBy\nZXR1cm4gTnVtYmVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkKICAg\nICAgICAgICAgfHwgdHlwZSA9PSBDaGFyYWN0ZXIuVFlQRSB8fCB0eXBlID09\nIFRZUEVfQ0hBUl9PQko7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGltcGxpY2l0IHR5cGVzIG9mIHRoZSBnaXZlbiB2YWx1ZXMgYmFzZWQgb24g\ndGhlIGZhY3QgdGhhdAogICAgICogdGhlIGZpcnN0IGlzIHN1cHBvc2VkIHRv\nIGNvbnRhaW4gdGhlIHNlY29uZC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc2V0SW1wbGljaXRDb250YWluc1R5cGVzKFZhbHVlIHZhbDEsIFZhbHVl\nIHZhbDIsIGludCBvcCkgewogICAgICAgIGlmICh2YWwxLmdldFR5cGUoKSA9\nPSBUWVBFX09CSkVDVCkgewogICAgICAgICAgICBpZiAob3AgPT0gQ09OVEFJ\nTlNfVFlQRV9FTEVNRU5UKQogICAgICAgICAgICAgICAgdmFsMS5zZXRJbXBs\naWNpdFR5cGUoQ29sbGVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKE1hcC5jbGFz\ncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsMi5nZXRUeXBlKCkgPT0g\nVFlQRV9PQkpFQ1QgJiYgdmFsMSBpbnN0YW5jZW9mIFBhdGgpIHsKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSAoKFBhdGgpIHZhbDEpLmxhc3Qo\nKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAg\nICBpZiAoZm1kICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChvcCA9\nPSBDT05UQUlOU19UWVBFX0VMRU1FTlQgfHwgb3AgPT0gQ09OVEFJTlNfVFlQ\nRV9WQUxVRSkgewogICAgICAgICAgICAgICAgICAgIHZhbDIuc2V0SW1wbGlj\naXRUeXBlKGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpOwog\nICAgICAgICAgICAgICAgICAgIG1ldGEgPSBmbWQuZ2V0RWxlbWVudCgpLmdl\ndERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB2\nYWwyLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICAgICAgICAgICAg\nICBhZGRBY2Nlc3NQYXRoKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\ndmFsMi5zZXRJbXBsaWNpdFR5cGUoZm1kLmdldEtleSgpLmdldERlY2xhcmVk\nVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICBtZXRhID0gZm1kLmdldEtl\neSgpLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICB2YWwyLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICAgICAg\nICAgICAgICBhZGRBY2Nlc3NQYXRoKG1ldGEpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgaW1wbGljaXQgdHlw\nZSBvZiB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhlIGdpdmVuIGNsYXNzLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIHZvaWQgc2V0SW1wbGljaXRUeXBl\nKFZhbHVlIHZhbCwgQ2xhc3MgZXhwZWN0ZWQpIHsKICAgICAgICAvLyB3ZSBu\nZXZlciBleHBlY3QgYSBwYyB0eXBlLCBzbyBubyBuZWVkIHRvIHdvcnJ5IGFi\nb3V0IG1ldGFkYXRhCiAgICAgICAgaWYgKHZhbC5nZXRUeXBlKCkgPT0gVFlQ\nRV9PQkpFQ1QpCiAgICAgICAgICAgIHZhbC5zZXRJbXBsaWNpdFR5cGUoZXhw\nZWN0ZWQpOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBmb3Igb2J0YWlu\naW5nIHRoZSB7QGxpbmsgTG9jYWxpemVyfSB0byB1c2UgZm9yIHRyYW5zbGF0\naW5nCiAgICAgKiBlcnJvciBtZXNzYWdlcy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIGFic3RyYWN0IExvY2FsaXplciBnZXRMb2NhbGl6ZXIoKTsKCiAgICAv\nKioKICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgc3RyaW5nIGJlaW5nIHBh\ncnNlZDsgdXNlZCBmb3IgZXJyb3IgbWVzc2FnZXMuCgkgKi8KCXByb3RlY3Rl\nZCBhYnN0cmFjdCBTdHJpbmcgY3VycmVudFF1ZXJ5ICgpOwp9Cgo=\n","encoding":"base64"}

