{"sha":"06df6348c0825fd41b7f963cf705f11adb6e7d17","node_id":"MDQ6QmxvYjIwNjM2NDowNmRmNjM0OGMwODI1ZmQ0MWI3Zjk2M2NmNzA1ZjExYWRiNmU3ZDE3","size":59303,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/06df6348c0825fd41b7f963cf705f11adb6e7d17","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGph\ndmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlDb250ZXh0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWJzdHJhY3RF\neHByZXNzaW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuZXhwcy5FeHByZXNzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25GYWN0b3J5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkxpdGVyYWw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGFyYW1ldGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNz\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5T\ndWJxdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5K\nMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBCdWlsZGVyIGZvciBKUFFMIGV4cHJlc3Np\nb25zLiBUaGlzIGNsYXNzIHRha2VzIHRoZSBxdWVyeSBwYXJzZWQKICogaW4g\ne0BsaW5rIEpQUUx9IGFuZCBjb252ZXJ0cyBpdCB0byBhbiBleHByZXNzaW9u\nIHRyZWUgdXNpbmcKICogYW4ge0BsaW5rIEV4cHJlc3Npb25GYWN0b3J5fS4g\nUHVibGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAqCiAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgUGF0cmljayBMaW5z\na2V5CiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXIKICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNzaW9uQnVp\nbGRlcgogICAgaW1wbGVtZW50cyBKUFFMVHJlZUNvbnN0YW50cyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFZBUl9QQVRIID0gMTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBWQVJfRVJST1IgPSAyOwoKICAgIHBy\naXZhdGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoSlBRTEV4cHJlc3Npb25CdWlsZGVyLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0YWNrIGNvbnRleHRzID0gbmV3IFN0YWNr\nKCk7CiAgICBwcml2YXRlIExpbmtlZE1hcCBwYXJhbWV0ZXJUeXBlczsKICAg\nIHByaXZhdGUgaW50IGFsaWFzQ291bnQgPSAwOwoKICAgIC8qKgogICAgICog\nQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhl\nIGV4cHJlc3Npb24gZmFjdG9yeSB0byB1c2UKICAgICAqIEBwYXJhbSBxdWVy\neSB1c2VkIHRvIHJlc29sdmUgdmFyaWFibGVzLCBwYXJhbWV0ZXJzLAogICAg\nICogYW5kIGNsYXNzIG5hbWVzIHVzZWQgaW4gdGhlIHF1ZXJ5CiAgICAgKiBA\ncGFyYW0gcGFyc2VkUXVlcnkgdGhlIHBhcnNlZCBxdWVyeQogICAgICovCiAg\nICBwdWJsaWMgSlBRTEV4cHJlc3Npb25CdWlsZGVyKEV4cHJlc3Npb25GYWN0\nb3J5IGZhY3RvcnksCiAgICAgICAgRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVl\ncnksIE9iamVjdCBwYXJzZWRRdWVyeSkgewogICAgICAgIHN1cGVyKGZhY3Rv\ncnksIHF1ZXJ5LmdldFJlc29sdmVyKCkpOwoKICAgICAgICBjb250ZXh0cy5w\ndXNoKG5ldyBDb250ZXh0KHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgUGFyc2Vk\nSlBRTAogICAgICAgICAgICA/IChQYXJzZWRKUFFMKSBwYXJzZWRRdWVyeQog\nICAgICAgICAgICA6IHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5nCiAg\nICAgICAgICAgID8gZ2V0UGFyc2VkUXVlcnkoKFN0cmluZykgcGFyc2VkUXVl\ncnkpCiAgICAgICAgICAgIDogbnVsbCwgbnVsbCkpOwoKICAgICAgICBpZiAo\nY3R4KCkucGFyc2VkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbihwYXJzZWRRdWVyeSArICIiKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgTG9jYWxpemVyIGdldExvY2FsaXplcigpIHsKICAgICAg\nICByZXR1cm4gX2xvYzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NMb2Fk\nZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgcmVz\nb2x2ZSBpbiB0aGUgY29udGV4dCBvZiBhbnl0aGluZyBidXQgb3Vyc2VsdmVz\nCiAgICAgICAgcmV0dXJuIGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgUGFyc2VkSlBRTCBnZXRQYXJzZWRRdWVy\neSgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFyc2VkOwogICAgfQoKICAg\nIHByb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KFN0cmluZyBq\ncHFsKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZWRKUFFMKGpwcWwpOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRDYW5kaWRhdGUoQ2xhc3NNZXRh\nRGF0YSBjbWQsIFN0cmluZyBzY2hlbWFBbGlhcykgewogICAgICAgIGFkZEFj\nY2Vzc1BhdGgoY21kKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICBjdHgoKS5tZXRhID0gY21kOwoKICAgICAgICBpZiAoc2NoZW1h\nQWxpYXMgIT0gbnVsbCkKICAgICAgICAgICAgY3R4KCkuc2NoZW1hQWxpYXMg\nPSBzY2hlbWFBbGlhczsKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBuZXh0\nQWxpYXMoKSB7CiAgICAgICAgcmV0dXJuICJqcHFsYWxpYXMiICsgKCsrYWxp\nYXNDb3VudCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEg\ncmVzb2x2ZUNsYXNzTWV0YURhdGEoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIC8vIGhhbmRsZSBsb29raW5nIHVwIGFsaWFzIG5hbWVzCiAgICAgICAgU3Ry\naW5nIHNjaGVtYU5hbWUgPSBhc3NlcnRTY2hlbWFOYW1lKG5vZGUpOwogICAg\nICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0Q2xhc3NNZXRhRGF0YShzY2hl\nbWFOYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyB3ZSBtaWdodCBiZSBy\nZWZlcmVuY2luZyBhIGNvbGxlY3Rpb24gZmllbGQgb2YgYSBzdWJxdWVyeSdz\nIHBhcmVudAogICAgICAgIGlmIChpc1BhdGgobm9kZSkpIHsKICAgICAgICAg\nICAgUGF0aCBwYXRoID0gZ2V0UGF0aChub2RlKTsKICAgICAgICAgICAgcmV0\ndXJuIGdldEZpZWxkVHlwZShwYXRoLmxhc3QoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBub3cgcnVuIGFnYWluIHRvIHRocm93IHRoZSBjb3JyZWN0IGV4\nY2VwdGlvbgogICAgICAgIHJldHVybiBnZXRDbGFzc01ldGFEYXRhKHNjaGVt\nYU5hbWUsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYSBnZXRDbGFzc01ldGFEYXRhKFN0cmluZyBhbGlhcywgYm9vbGVhbiBhc3Nl\ncnRWYWxpZCkgewogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGdldENs\nYXNzTG9hZGVyKCk7CiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nID0gcmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBn\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwoKICAgICAgICAvLyBm\naXJzdCBjaGVjayBmb3IgdGhlIGFsaWFzCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9hZGVyLCBmYWxz\nZSk7CgogICAgICAgIGlmIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGNtZDsKCiAgICAgICAgLy8gbm93IGNoZWNrIGZvciB0aGUgY2xhc3Mg\nbmFtZTsgdGhpcyBpcyBub3QgdGVjaG5pY2FsbHkgcGVybWl0dGVkCiAgICAg\nICAgLy8gYnkgdGhlIEpQQSBzcGVjLCBidXQgaXMgcmVxdWlyZWQgaW4gb3Jk\nZXIgdG8gYmUgYWJsZSB0byBleGVjdXRlCiAgICAgICAgLy8gSlBRTCBxdWVy\naWVzIGZyb20gb3RoZXIgZmFjYWRlcyAobGlrZSBKRE8pIHRoYXQgZG8gbm90\nIGhhdmUKICAgICAgICAvLyB0aGUgY29uY2VwdCBvZiBlbnRpdHkgbmFtZXMg\nb3IgYWxpYXNlcwogICAgICAgIENsYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUoYWxpYXMsIG51bGwpOwogICAgICAgIGlmIChjICE9IG51bGwpCiAg\nICAgICAgICAgIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRhKGMsIGxvYWRlciwg\nYXNzZXJ0VmFsaWQpOwogICAgICAgIGVsc2UgaWYgKGFzc2VydFZhbGlkKQog\nICAgICAgICAgICBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9h\nZGVyLCB0cnVlKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGFzc2Vy\ndFZhbGlkKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgYWxpYXMgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBjbWQ7\nCiAgICB9CgogICAgcHJpdmF0ZSBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkg\newogICAgICAgIHJldHVybiBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKGN0eCgp\nLm1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGN0eCgpLm1ldGE7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgY2xzID0gZ2V0Q2FuZGlkYXRlTWV0\nYURhdGEocm9vdCgpKTsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2No\nZW1hLW5hbWUiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290\nKCkgfSwgbnVsbCk7CgogICAgICAgIHNldENhbmRpZGF0ZShjbHMsIG51bGwp\nOwogICAgICAgIHJldHVybiBjbHM7CiAgICB9CgogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIC8vIGV4YW1pbmcgdGhlIG5vZGUgdG8gZmluZCB0aGUg\nY2FuZGlkYXRlIHF1ZXJ5CiAgICAgICAgLy8gIyMjIHRoaXMgc2hvdWxkIGFj\ndHVhbGx5IGJlIHRoZSBwcmltYXJ5IFNFTEVDVCBpbnN0YW5jZQogICAgICAg\nIC8vIHJlc29sdmVkIGFnYWluc3QgdGhlIGZyb20gdmFyaWFibGUgZGVjbGFy\nYXRpb25zCiAgICAgICAgSlBRTE5vZGUgZnJvbSA9IG5vZGUuZmluZENoaWxk\nQnlJRChKSlRGUk9NSVRFTSwgdHJ1ZSk7CiAgICAgICAgaWYgKGZyb20gPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBPUEVOSlBBLTE1IGFsbG93IHN1YnF1\nZXJ5IHdpdGhvdXQgYSBGUk9NSVRFTQogICAgICAgICAgICBpZiAobm9kZS5p\nZCA9PSBKSlRTVUJTRUxFQ1QpIHsgCiAgICAgICAgICAgICAgICBmcm9tID0g\nbm9kZS5maW5kQ2hpbGRCeUlEKEpKVEZST00sIHRydWUpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZyb20tY2xhdXNlIiwgbnVs\nbCwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZnJvbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBKUFFMTm9kZSBuID0gZnJvbS5jaGlsZHJlbltpXTsK\nCiAgICAgICAgICAgIGlmIChuLmlkID09IEpKVEFCU1RSQUNUU0NIRU1BTkFN\nRSkgewogICAgICAgICAgICAgICAgLy8gd2Ugc2ltcGx5IHJldHVybiB0aGUg\nZmlyc3QgYWJzdHJhY3Qgc2NoZW1hIGNoaWxkCiAgICAgICAgICAgICAgICAv\nLyBhcyByZXNvbHZlZCBpbnRvIGEgY2xhc3MKICAgICAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgY21kID0gcmVzb2x2ZUNsYXNzTWV0YURhdGEobik7Cgog\nICAgICAgICAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgICAgICAgICAgLy8gbm90IGEg\nc2NoZW1hOiB0cmVhdCBpdCBhcyBhIGNsYXNzCiAgICAgICAgICAgICAgICBT\ndHJpbmcgY2xzID0gYXNzZXJ0U2NoZW1hTmFtZShuKTsKICAgICAgICAgICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290KCkg\nfSwgbnVsbCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGdldENsYXNzTWV0\nYURhdGEoY2xzLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBPUEVOSlBBLTE1IHN1cHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBk\nbyBub3Qgc3RhcnQgd2l0aCAKICAgICAgICAgICAgLy8gaWRlbnRpZmljYXRp\nb25fdmFyaWFibGVfZGVjbGFyYXRpb24oKQogICAgICAgICAgICBpZiAobm9k\nZS5pZCA9PSBKSlRTVUJTRUxFQ1QpIHsKICAgICAgICAgICAgICAgIGlmIChu\nLmlkID09IEpKVElOTkVSSk9JTikgewogICAgICAgICAgICAgICAgICAgIG4g\nPSBuLmdldENoaWxkKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKG4uaWQgPT0gSkpUUEFUSCkgewogICAgICAgICAgICAgICAg\nICAgIFBhdGggcGF0aCA9IGdldFBhdGgobik7CiAgICAgICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRGaWVsZFR5cGUocGF0aC5sYXN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChjbWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21kOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNF\nUiwgIm5vLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBuIH0sIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAgICAg\nICAgCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIGN1cnJlbnRRdWVyeSgpIHsKICAgICAgICBy\nZXR1cm4gY3R4KCkucGFyc2VkID09IG51bGwgfHwgcm9vdCgpLnBhcnNlciA9\nPSBudWxsID8gbnVsbAogICAgICAgICAgICA6IHJvb3QoKS5wYXJzZXIuanBx\nbDsKICAgIH0KCiAgICBRdWVyeUV4cHJlc3Npb25zIGdldFF1ZXJ5RXhwcmVz\nc2lvbnMoKSB7CiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBzID0gbmV3\nIFF1ZXJ5RXhwcmVzc2lvbnMoKTsKCiAgICAgICAgZXZhbFF1ZXJ5T3BlcmF0\naW9uKGV4cHMpOwoKICAgICAgICBFeHByZXNzaW9uIGZpbHRlciA9IG51bGw7\nCiAgICAgICAgZmlsdGVyID0gYW5kKGV2YWxGcm9tQ2xhdXNlKHJvb3QoKS5p\nZCA9PSBKSlRTRUxFQ1QpLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFu\nZChldmFsV2hlcmVDbGF1c2UoZXhwcyksIGZpbHRlcik7CiAgICAgICAgZmls\ndGVyID0gYW5kKGV2YWxTZWxlY3RDbGF1c2UoZXhwcyksIGZpbHRlcik7Cgog\nICAgICAgIGV4cHMuZmlsdGVyID0gZmlsdGVyID09IG51bGwgPyBmYWN0b3J5\nLmVtcHR5RXhwcmVzc2lvbigpIDogZmlsdGVyOwoKICAgICAgICBldmFsR3Jv\ndXBpbmdDbGF1c2UoZXhwcyk7CiAgICAgICAgZXZhbEhhdmluZ0NsYXVzZShl\neHBzKTsKICAgICAgICBldmFsRmV0Y2hKb2lucyhleHBzKTsKICAgICAgICBl\ndmFsU2V0Q2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxPcmRlcmluZ0NsYXVz\nZXMoZXhwcyk7CgogICAgICAgIGlmIChwYXJhbWV0ZXJUeXBlcyAhPSBudWxs\nKQogICAgICAgICAgICBleHBzLnBhcmFtZXRlclR5cGVzID0gcGFyYW1ldGVy\nVHlwZXM7CgogICAgICAgIGV4cHMuYWNjZXNzUGF0aCA9IGdldEFjY2Vzc1Bh\ndGgoKTsKCiAgICAgICAgcmV0dXJuIGV4cHM7CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGFuZChFeHByZXNzaW9uIGUxLCBFeHByZXNzaW9uIGUy\nKSB7CiAgICAgICAgcmV0dXJuIGUxID09IG51bGwgPyBlMiA6IGUyID09IG51\nbGwgPyBlMSA6IGZhY3RvcnkuYW5kKGUxLCBlMik7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUpIHsK\nICAgICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSwgIi4iLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBjaGlsZHJlbiBvZiB0aGUg\nc3BlY2lmaWMgbm9kZSBieSBhcHBlbmRpbmcgZWFjaAogICAgICogY2hpbGQs\nIHNlcGFyYXRlZCBieSB0aGUgZGVsaW1pdGVyLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBTdHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSwgU3Ry\naW5nIGRlbGltaXRlciwgaW50IGxhc3QpIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIEpQUUxO\nb2RlW10gcGFydHMgPSBub2RlLmNoaWxkcmVuOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBwYXJ0cyAhPSBudWxsICYmIGkgPCBwYXJ0cy5sZW5ndGggLSBs\nYXN0OyBpKyspCiAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQocmVzdWx0Lmxl\nbmd0aCgpID4gMCA/IGRlbGltaXRlciA6ICIiKS4KICAgICAgICAgICAgICAg\nIGFwcGVuZChwYXJ0c1tpXS50ZXh0KTsKCiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC50b1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBh\nc3NpZ25Qcm9qZWN0aW9ucyhKUFFMTm9kZSBwYXJhbWV0ZXJzTm9kZSwKICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBpbnQgY291\nbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9ucyA9IG5ldyBWYWx1ZVtjb3VudF07CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9uQ2xhdXNlcyA9IG5ldyBTdHJpbmdbY291bnRdOwog\nICAgICAgIGV4cHMucHJvamVjdGlvbkFsaWFzZXMgPSBuZXcgU3RyaW5nW2Nv\ndW50XTsKCiAgICAgICAgRXhwcmVzc2lvbiBleHAgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAg\nICBKUFFMTm9kZSBwYXJlbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZChp\nKTsKICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9ubHlDaGlsZChwYXJl\nbnQpOwogICAgICAgICAgICBWYWx1ZSBwcm9qID0gZ2V0VmFsdWUobm9kZSk7\nCiAgICAgICAgICAgIGV4cHMucHJvamVjdGlvbnNbaV0gPSBwcm9qOwogICAg\nICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzW2ldID0gbmV4dEFsaWFz\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlvbihRdWVyeUV4cHJlc3Np\nb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSB3\nYW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRhdGUKICAgICAgICBpZiAo\ncm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290KCkuaWQgPT0gSkpUU1VC\nU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxzZSBpZiAocm9vdCgpLmlk\nID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhwcy5vcGVyYXRpb24gPSBR\ndWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAgICAgIGVsc2UgaWYgKHJv\nb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAgICAgIGV4cHMub3BlcmF0\naW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQUE9S\nVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lv\nbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1c2Vz\nCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUgPSByb290KCkuZmluZENo\naWxkQnlJRChKSlRHUk9VUEJZLCB0cnVlKTsKCiAgICAgICAgaWYgKGdyb3Vw\nQnlOb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naW50IGdyb3VwQnlDb3VudCA9IGdyb3VwQnlOb2RlLmdldENoaWxkQ291bnQo\nKTsKCiAgICAgICAgZXhwcy5ncm91cGluZyA9IG5ldyBWYWx1ZVtncm91cEJ5\nQ291bnRdOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdyb3VwQnlD\nb3VudDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBncm91\ncEJ5Tm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgZXhwcy5ncm91cGlu\nZ1tpXSA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEhhdmluZ0NsYXVzZShRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgSEFWSU5HIGNsYXVzZXMKICAg\nICAgICBKUFFMTm9kZSBoYXZpbmdOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5\nSUQoSkpUSEFWSU5HLCB0cnVlKTsKCiAgICAgICAgaWYgKGhhdmluZ05vZGUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBleHBzLmhh\ndmluZyA9IGdldEV4cHJlc3Npb24ob25seUNoaWxkKGhhdmluZ05vZGUpKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbE9yZGVyaW5nQ2xhdXNlcyhR\ndWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgT1JE\nRVIgQlkgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIG9yZGVyYnkgPSByb290\nKCkuZmluZENoaWxkQnlJRChKSlRPUkRFUkJZLCBmYWxzZSk7CiAgICAgICAg\naWYgKG9yZGVyYnkgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgb3JkZXJj\nb3VudCA9IG9yZGVyYnkuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBl\neHBzLm9yZGVyaW5nID0gbmV3IFZhbHVlW29yZGVyY291bnRdOwogICAgICAg\nICAgICBleHBzLmFzY2VuZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRd\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7\nIGkrKykgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVy\nYnkuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5n\nW2ldID0gZ2V0VmFsdWUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAg\nICAgICAvLyBvbW1pc3Npb24gb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBh\nc2NlbmRpbmcKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0g\nbm9kZS5nZXRDaGlsZENvdW50KCkgPD0gMSB8fAogICAgICAgICAgICAgICAg\nICAgIGxhc3RDaGlsZChub2RlKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVl\nIDogZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxTZWxlY3RDbGF1c2UoUXVlcnlFeHBy\nZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaWYgKGV4cHMub3BlcmF0aW9uICE9\nIFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3ROb2RlID0gcm9vdCgp\nOwoKICAgICAgICBKUFFMTm9kZSBjb25zdHJ1Y3RvciA9IHNlbGVjdE5vZGUu\nZmluZENoaWxkQnlJRChKSlRDT05TVFJVQ1RPUiwgdHJ1ZSk7CiAgICAgICAg\naWYgKGNvbnN0cnVjdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gYnVp\nbGQgdXAgdGhlIGZ1bGx5LXF1YWxpZmllZCByZXN1bHQgY2xhc3MgbmFtZSBi\neQogICAgICAgICAgICAvLyBhcHBlbmRpbmcgdG9nZXRoZXIgdGhlIGNvbXBv\nbmVudHMgb2YgdGhlIGNoaWxkcmVuCiAgICAgICAgICAgIFN0cmluZyByZXN1\nbHRDbGFzc05hbWUgPSBhc3NlbWJsZShsZWZ0KGNvbnN0cnVjdG9yKSk7CiAg\nICAgICAgICAgIGV4cHMucmVzdWx0Q2xhc3MgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUocmVzdWx0Q2xhc3NOYW1lLCBudWxsKTsKCiAgICAgICAgICAgIC8v\nIG5vdyBhc3NpZ24gdGhlIGFyZ3VtZW50cyB0byB0aGUgc2VsZWN0IGNsYXVz\nZSBhcyB0aGUgcHJvamVjdGlvbnMKICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IGV4cHMuRElTVElOQ1RfRkFMU0U7CiAgICAgICAgICAgIHJldHVybiBh\nc3NpZ25Qcm9qZWN0aW9ucyhyaWdodChjb25zdHJ1Y3RvciksIGV4cHMpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpQUUxOb2RlIHNlbGVjdENs\nYXVzZSA9IHNlbGVjdE5vZGUuCiAgICAgICAgICAgICAgICBmaW5kQ2hpbGRC\neUlEKEpKVFNFTEVDVENMQVVTRSwgZmFsc2UpOwogICAgICAgICAgICBpZiAo\nc2VsZWN0Q2xhdXNlICE9IG51bGwgJiYgc2VsZWN0Q2xhdXNlLmhhc0NoaWxk\nSUQoSkpURElTVElOQ1QpKQogICAgICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IGV4cHMuRElTVElOQ1RfVFJVRSB8IGV4cHMuRElTVElOQ1RfQVVUTzsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZXhwcy5kaXN0aW5j\ndCA9IGV4cHMuRElTVElOQ1RfRkFMU0U7CgogICAgICAgICAgICAvLyBoYW5k\nbGUgU0VMRUNUIGNsYXVzZXMKICAgICAgICAgICAgSlBRTE5vZGUgZXhwTm9k\nZSA9IHNlbGVjdE5vZGUuCiAgICAgICAgICAgICAgICBmaW5kQ2hpbGRCeUlE\nKEpKVFNFTEVDVEVYUFJFU1NJT05TLCB0cnVlKTsKICAgICAgICAgICAgaWYg\nKGV4cE5vZGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAgICAgaW50IHNlbGVjdENvdW50ID0gZXhwTm9kZS5nZXRD\naGlsZENvdW50KCk7CiAgICAgICAgICAgIEpQUUxOb2RlIHNlbGVjdENoaWxk\nID0gZmlyc3RDaGlsZChleHBOb2RlKTsKCiAgICAgICAgICAgIC8vIGlmIHdl\nIGFyZSBzZWxlY3RpbmcganVzdCBvbmUgdGhpbmcgYW5kIHRoYXQgdGhpbmcg\naXMgdGhlCiAgICAgICAgICAgIC8vIHNjaGVtYSdzIGFsaWFzLCB0aGVuIGRv\nIG5vdCB0cmVhdCBpdCBhcyBhIHByb2plY3Rpb24KICAgICAgICAgICAgaWYg\nKHNlbGVjdENvdW50ID09IDEgJiYgc2VsZWN0Q2hpbGQgIT0gbnVsbCAmJgog\nICAgICAgICAgICAgICAgc2VsZWN0Q2hpbGQuZ2V0Q2hpbGRDb3VudCgpID09\nIDEgJiYKICAgICAgICAgICAgICAgIG9ubHlDaGlsZChzZWxlY3RDaGlsZCkg\nIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgYXNzZXJ0U2NoZW1hQWxpYXMo\nKS4KICAgICAgICAgICAgICAgICAgICBlcXVhbHNJZ25vcmVDYXNlKG9ubHlD\naGlsZChzZWxlY3RDaGlsZCkudGV4dCkpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgLy8gSlBRTCBkb2VzIG5vdCBmaWx0ZXIgcmVsYXRpb25hbCBqb2lucyBm\nb3IgcHJvamVjdGlvbnMKICAgICAgICAgICAgICAgIGV4cHMuZGlzdGluY3Qg\nJj0gfmV4cHMuRElTVElOQ1RfQVVUTzsKICAgICAgICAgICAgICAgIHJldHVy\nbiBhc3NpZ25Qcm9qZWN0aW9ucyhleHBOb2RlLCBleHBzKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBhc3Nl\ncnRTY2hlbWFBbGlhcygpIHsKICAgICAgICBTdHJpbmcgYWxpYXMgPSBjdHgo\nKS5zY2hlbWFBbGlhczsKCiAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJhbGlh\ncy1yZXF1aXJlZCIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGN0\neCgpLm1ldGEgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBhbGlhczsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgRXhwcmVzc2lvbiBldmFsRmV0Y2hKb2lucyhR\ndWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBFeHByZXNzaW9uIGZp\nbHRlciA9IG51bGw7CgogICAgICAgIC8vIGhhbmRsZSBKT0lOIEZFVENICiAg\nICAgICAgU2V0IGpvaW5zID0gbnVsbDsKCiAgICAgICAgSlBRTE5vZGVbXSBv\ndXRlcnMgPSByb290KCkuZmluZENoaWxkcmVuQnlJRChKSlRPVVRFUkZFVENI\nSk9JTik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IG91dGVycyAhPSBudWxs\nICYmIGkgPCBvdXRlcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIChqb2lu\ncyA9PSBudWxsID8gam9pbnMgPSBuZXcgVHJlZVNldCgpIDogam9pbnMpLgog\nICAgICAgICAgICAgICAgYWRkKGdldFBhdGgob25seUNoaWxkKG91dGVyc1tp\nXSkpLmxhc3QoKS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICBKUFFM\nTm9kZVtdIGlubmVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpKVElO\nTkVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW5uZXJz\nICE9IG51bGwgJiYgaSA8IGlubmVycy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5ldyBUcmVlU2V0KCkgOiBq\nb2lucykuCiAgICAgICAgICAgICAgICBhZGQoZ2V0UGF0aChvbmx5Q2hpbGQo\naW5uZXJzW2ldKSkubGFzdCgpLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAg\nICAgIGlmIChqb2lucyAhPSBudWxsKQogICAgICAgICAgICBleHBzLmZldGNo\nUGF0aHMgPSAoU3RyaW5nW10pIGpvaW5zLgogICAgICAgICAgICAgICAgdG9B\ncnJheShuZXcgU3RyaW5nW2pvaW5zLnNpemUoKV0pOwoKICAgICAgICByZXR1\ncm4gZmlsdGVyOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGV2YWxTZXRD\nbGF1c2UoUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFu\nZGxlIFNFVCBmaWVsZCA9IHZhbHVlCiAgICAgICAgSlBRTE5vZGVbXSBub2Rl\ncyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpKVFVQREFURUlURU0pOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBub2RlcyAhPSBudWxsICYmIGkgPCBu\nb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZpZWxkID0gZ2V0UGF0aChmaXJzdENoaWxkKG5vZGVzW2ldKSkubGFzdCgp\nOwogICAgICAgICAgICBWYWx1ZSB2YWwgPSBnZXRWYWx1ZShvbmx5Q2hpbGQo\nbGFzdENoaWxkKG5vZGVzW2ldKSkpOwogICAgICAgICAgICBleHBzLnB1dFVw\nZGF0ZShmaWVsZCwgdmFsKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGV2YWxXaGVyZUNsYXVzZShRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBldmFsdWF0ZSB0aGUgV0hFUkUgY2xhdXNl\nCiAgICAgICAgSlBRTE5vZGUgd2hlcmVOb2RlID0gcm9vdCgpLmZpbmRDaGls\nZEJ5SUQoSkpUV0hFUkUsIGZhbHNlKTsKICAgICAgICBpZiAod2hlcmVOb2Rl\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJl\ndHVybiAoRXhwcmVzc2lvbikgZXZhbCh3aGVyZU5vZGUpOwogICAgfQoKICAg\nIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsRnJvbUNsYXVzZShib29sZWFuIG5l\nZWRzQWxpYXMpIHsKICAgICAgICBFeHByZXNzaW9uIGV4cCA9IG51bGw7Cgog\nICAgICAgIC8vIGJ1aWxkIHVwIHRoZSBhbGlhcyBtYXAgaW4gdGhlIEZST00g\nY2xhdXNlCiAgICAgICAgSlBRTE5vZGUgZnJvbSA9IHJvb3QoKS5maW5kQ2hp\nbGRCeUlEKEpKVEZST00sIGZhbHNlKTsKICAgICAgICBpZiAoZnJvbSA9PSBu\ndWxsKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm8tZnJvbS1jbGF1c2UiLCBudWxsLCBudWxsKTsKCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmcm9tLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBmcm9tLmNoaWxkcmVuW2ld\nOwoKICAgICAgICAgICAgaWYgKG5vZGUuaWQgPT0gSkpURlJPTUlURU0pCiAg\nICAgICAgICAgICAgICBleHAgPSBldmFsRnJvbUl0ZW0oZXhwLCBub2RlLCBu\nZWVkc0FsaWFzKTsKICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5pZCA9PSBK\nSlRPVVRFUkpPSU4pCiAgICAgICAgICAgICAgICBleHAgPSBhZGRKb2luKG5v\nZGUsIGZhbHNlLCBleHApOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlk\nID09IEpKVElOTkVSSk9JTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpv\naW4obm9kZSwgdHJ1ZSwgZXhwKTsKICAgICAgICAgICAgZWxzZSBpZiAobm9k\nZS5pZCA9PSBKSlRJTk5FUkZFVENISk9JTikKICAgICAgICAgICAgICAgIGV4\ncCA9IGFkZEpvaW4obm9kZSwgdHJ1ZSwgZXhwKTsKICAgICAgICAgICAgZWxz\nZSBpZiAobm9kZS5pZCA9PSBKSlRPVVRFUkZFVENISk9JTikKICAgICAgICAg\nICAgICAgIDsgLy8gd2UgaGFuZGxlIG91dGVyIGZldGNoIGpvaW5zIGluIHRo\nZSBldmFsRmV0Y2hKb2lucygpIG1ldGhvZAogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nbm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IG5vZGUgfSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gZXhwOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGpvaW4gY29u\nZGl0aW9uIHRvIHRoZSBnaXZlbiBleHByZXNzaW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSBub2RlIHRoZSBub2RlIHRvIGNoZWNrCiAgICAgKiBAcGFyYW0g\naW5uZXIgd2hldGhlciBvciBub3QgdGhlIGpvaW4gc2hvdWxkIGJlIGFuIGlu\nbmVyIGpvaW4KICAgICAqIEBwYXJhbSBleHAgYW4gZXhpc3RpbmcgZXhwcmVz\nc2lvbiB0byBBTkQsIG9yIG51bGwgaWYgbm9uZQogICAgICogQHJldHVybiB0\naGUgRXhwcmVzc2lvbiB3aXRoIHRoZSBqb2luIGNvbmRpdGlvbiBhZGRlZAog\nICAgICovCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYWRkSm9pbihKUFFMTm9k\nZSBub2RlLCBib29sZWFuIGlubmVyLCBFeHByZXNzaW9uIGV4cCkgewogICAg\nICAgIC8vIHRoZSB0eXBlIHdpbGwgYmUgdGhlIGRlY2xhcmVkIHR5cGUgZm9y\nIHRoZSBmaWVsZAogICAgICAgIFBhdGggcGF0aCA9IGdldFBhdGgoZmlyc3RD\naGlsZChub2RlKSwgZmFsc2UsIGlubmVyKTsKCiAgICAgICAgSlBRTE5vZGUg\nYWxpYXMgPSBub2RlLmdldENoaWxkQ291bnQoKSA+PSAyID8gcmlnaHQobm9k\nZSkgOiBudWxsOwogICAgICAgIC8vIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJx\ndWVyeSdzIGZyb20gY2xhdXNlIGRvIG5vdCBzdGFydCB3aXRoIAogICAgICAg\nIC8vIGlkZW50aWZpY2F0aW9uX3ZhcmlhYmxlX2RlY2xhcmF0aW9uKCkKICAg\nICAgICBpZiAoaW5uZXIgJiYgY3R4KCkuc3VicXVlcnkgIT0gbnVsbCAmJiBj\ndHgoKS5zY2hlbWFBbGlhcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHNldENh\nbmRpZGF0ZShnZXRGaWVsZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcy50ZXh0\nKTsKCiAgICAgICAgICAgIFBhdGggc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0\naChjdHgoKS5zdWJxdWVyeSk7CiAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0\nYURhdGEoY3R4KCkuc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAg\nICAgIGV4cCA9ICBhbmQoZXhwLCBmYWN0b3J5LmVxdWFsKHBhdGgsIHN1YnBh\ndGgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhZGRKb2luKHBhdGgs\nIGFsaWFzLCBpbm5lciwgZXhwKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJl\nc3Npb24gYWRkSm9pbihQYXRoIHBhdGgsIEpQUUxOb2RlIGFsaWFzTm9kZSwg\nYm9vbGVhbiBpbm5lciwKICAgICAgICBFeHByZXNzaW9uIGV4cCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0KCk7CgogICAgICAg\nIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgInBhdGgtbm8tbWV0YSIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHBhdGgsIG51bGwgfSwgbnVsbCk7CgogICAgICAg\nIFN0cmluZyBhbGlhcyA9IGFsaWFzTm9kZSAhPSBudWxsID8gYWxpYXNOb2Rl\nLnRleHQgOiBuZXh0QWxpYXMoKTsKCiAgICAgICAgVmFsdWUgdmFyID0gZ2V0\nVmFyaWFibGUoYWxpYXMsIHRydWUpOwogICAgICAgIHZhci5zZXRNZXRhRGF0\nYShnZXRGaWVsZFR5cGUoZm1kKSk7CgogICAgICAgIEV4cHJlc3Npb24gam9p\nbiA9IG51bGw7CgogICAgICAgIC8vIGlmIHRoZSB2YXJpYWJsZSBpcyBhbHJl\nYWR5IGJvdW5kLCBnZXQgdGhlIHZhcidzIHZhbHVlIGFuZAogICAgICAgIC8v\nIGRvIGEgcmVndWxhciBjb250YWlucyB3aXRoIHRoYXQKICAgICAgICBib29s\nZWFuIGJvdW5kID0gaXNCb3VuZCh2YXIpOwogICAgICAgIGlmIChib3VuZCkg\newogICAgICAgICAgICB2YXIgPSBnZXRWYWx1ZShhbGlhc05vZGUsIFZBUl9Q\nQVRIKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaW5kKHZhcik7\nCiAgICAgICAgICAgIGpvaW4gPSBhbmQoam9pbiwgZmFjdG9yeS5iaW5kVmFy\naWFibGUodmFyLCBwYXRoKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWZt\nZC5pc1R5cGVQQygpKSAvLyBtdWx0aS12YWx1ZWQgcmVsYXRpb24KICAgICAg\nICB7CiAgICAgICAgICAgIGlmIChib3VuZCkKICAgICAgICAgICAgICAgIGpv\naW4gPSBhbmQoam9pbiwgZmFjdG9yeS5jb250YWlucyhwYXRoLCB2YXIpKTsK\nCiAgICAgICAgICAgIHNldEltcGxpY2l0Q29udGFpbnNUeXBlcyhwYXRoLCB2\nYXIsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gYW5kKGV4cCwgam9pbik7CiAgICB9CgogICAgcHJpdmF0ZSBF\neHByZXNzaW9uIGV2YWxGcm9tSXRlbShFeHByZXNzaW9uIGV4cCwgSlBRTE5v\nZGUgbm9kZSwKICAgICAgICBib29sZWFuIG5lZWRzQWxpYXMpIHsKICAgICAg\nICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlc29sdmVDbGFzc01ldGFEYXRhKGZp\ncnN0Q2hpbGQobm9kZSkpOwoKICAgICAgICBTdHJpbmcgYWxpYXMgPSBudWxs\nOwoKICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPCAyKSB7CiAg\nICAgICAgICAgIGlmIChuZWVkc0FsaWFzKQogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGNtZCB9LCBudWxs\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGlhcyA9IHJpZ2h0\nKG5vZGUpLnRleHQ7CiAgICAgICAgICAgIEpQUUxOb2RlIGxlZnQgPSBsZWZ0\nKG5vZGUpOwoKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3\nZSBhcmUgcmVmZXJyaW5nIHRvIGEgcGF0aCBpbiB0aGUgZnJvbQogICAgICAg\nICAgICAvLyBjbGF1c2UsIHNpbmNlIHdlIG1pZ2h0IGJlIGluIGEgc3VicXVl\ncnkgYWdhaW5zdCBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKGlzUGF0\naChsZWZ0KSkgewogICAgICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0\naChsZWZ0KTsKICAgICAgICAgICAgICAgIHNldENhbmRpZGF0ZShnZXRGaWVs\nZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcyk7CgogICAgICAgICAgICAgICAg\nUGF0aCBzdWJwYXRoID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5\nKTsKICAgICAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY3R4KCku\nc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYW5kKGV4cCwgZmFjdG9yeS5lcXVhbChwYXRoLCBzdWJwYXRoKSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZl\nIGFuIGFsaWFzOiBiaW5kIGl0IGFzIGEgdmFyaWFibGUKICAgICAgICAgICAg\nICAgIFZhbHVlIHZhciA9IGdldFZhcmlhYmxlKGFsaWFzLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIHZhci5zZXRNZXRhRGF0YShjbWQpOwogICAgICAgICAg\nICAgICAgYmluZCh2YXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyAjIyMgd2UgYXNzaWduIHRoZSBmaXJzdCBGUk9NSVRFTSBpbnN0\nYW5jZSB3ZSBzZWUgYXMKICAgICAgICAvLyB0aGUgZ2xvYmFsIGNhbmRpZGF0\nZSwgd2hpY2ggaXMgaW5jb3JyZWN0OiB3ZSBzaG91bGQKICAgICAgICAvLyBp\nbnN0ZWFkIGJlIG1hcHBpbmcgdGhpcyB0byB0aGUgU0VMRUNUSVRFTSB0byBz\nZWUKICAgICAgICAvLyB3aGljaCBpcyB0aGUgZGVzaXJlZCBjYW5kaWRhdGUK\nICAgICAgICBpZiAoY3R4KCkuc2NoZW1hQWxpYXMgPT0gbnVsbCkKICAgICAg\nICAgICAgc2V0Q2FuZGlkYXRlKGNtZCwgYWxpYXMpOwoKICAgICAgICByZXR1\ncm4gZXhwOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzRGVjbGFy\nZWRWYXJpYWJsZShTdHJpbmcgbmFtZSkgewogICAgICAgIC8vIEpQUUwgZG9l\nc24ndCBzdXBwb3J0IGRlY2xhcmluZyB2YXJpYWJsZXMKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0byBzZWUg\naWYgdGhlIHNwZWNpZmljIG5vZGUgaXMgYSBwYXRoICh2cy4gYSBzY2hlbWEg\nbmFtZSkKICAgICAqLwogICAgYm9vbGVhbiBpc1BhdGgoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA8IDIpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgU3RyaW5n\nIG5hbWUgPSBmaXJzdENoaWxkKG5vZGUpLnRleHQ7CiAgICAgICAgaWYgKG5h\nbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMg\ndGhlIGFsaWFzCiAgICAgICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRv\nbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAgICAgICAgaWYgKGdldE1l\ndGFEYXRhRm9yQWxpYXMobmFtZSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CgogICAgICAgIGlmICghaXNTZWVuVmFyaWFibGUobmFtZSkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgVmFs\ndWUgdmFyID0gZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBp\nZiAodmFyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBpc0JvdW5kKHZh\ncik7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBDbGFzc01ldGFEYXRhIGdldEZpZWxkVHlwZShGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0g\nbnVsbDsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZDsKCiAgICAgICAgaWYg\nKCh2bWQgPSBmbWQuZ2V0RWxlbWVudCgpKSAhPSBudWxsKQogICAgICAgICAg\nICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBlbHNlIGlmICgodm1kID0gZm1kLmdldEtleSgpKSAhPSBudWxsKQogICAg\nICAgICAgICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsK\nICAgICAgICBlbHNlIGlmICgodm1kID0gZm1kLmdldFZhbHVlKCkpICE9IG51\nbGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpOwoKICAgICAgICBpZiAoY21kID09IG51bGwgfHwgY21kLmdldERl\nc2NyaWJlZFR5cGUoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNt\nZCA9IGZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwoKICAgICAgICBy\nZXR1cm4gY21kOwogICAgfQoKICAgIC8qKgogICAgICogSWRlbnRpZmljYXRp\nb24gdmFyaWFibGVzIGluIEpQUUwgYXJlIGNhc2UgaW5zZW5zaXRpdmUsIHNv\nIGxvd2VyLWNhc2UKICAgICAqIGFsbCB2YXJpYWJsZXMgd2UgYXJlIGdvaW5n\nIHRvIGJpbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZSBnZXRWYXJp\nYWJsZShTdHJpbmcgaWQsIGJvb2xlYW4gYmluZCkgewogICAgICAgIGlmIChp\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldFZhcmlhYmxlKGlkLnRvTG93ZXJDYXNlKCksIGJp\nbmQpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzU2VlbmRWYXJp\nYWJsZShTdHJpbmcgaWQpIHsKICAgICAgICByZXR1cm4gaWQgIT0gbnVsbCAm\nJiBzdXBlci5pc1NlZW5WYXJpYWJsZShpZC50b0xvd2VyQ2FzZSgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNzIG5hbWUgdXNp\nbmcgdGhlIGNoaWxkcmVuIG9mIHRoZSBKUFFMTm9kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgYXNzZXJ0U2NoZW1hTmFtZShKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgaWYgKG5vZGUuaWQgIT0gSkpUQUJTVFJBQ1RTQ0hFTUFO\nQU1FKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm90LWlkZW50aWZlciIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IG5vZGUgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBhc3NlbWJsZShu\nb2RlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIg\nbWV0aG9kIHRvIGV2YWx1YXRlIHRoZSBnaXZlbiBub2RlLgogICAgICovCiAg\nICBwcml2YXRlIE9iamVjdCBldmFsKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICBWYWx1ZSB2YWwxID0gbnVsbDsKICAgICAgICBWYWx1ZSB2YWwyID0gbnVs\nbDsKICAgICAgICBWYWx1ZSB2YWwzID0gbnVsbDsKCiAgICAgICAgYm9vbGVh\nbiBub3QgPSBub2RlLm5vdDsKCiAgICAgICAgc3dpdGNoIChub2RlLmlkKSB7\nCiAgICAgICAgICAgIGNhc2UgSkpUV0hFUkU6IC8vIHRvcC1sZXZlbCBXSEVS\nRSBjbGF1c2UKICAgICAgICAgICAgICAgIHJldHVybiBnZXRFeHByZXNzaW9u\nKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVEJPT0xF\nQU5MSVRFUkFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3\nTGl0ZXJhbCgidHJ1ZSIuZXF1YWxzSWdub3JlQ2FzZQogICAgICAgICAgICAg\nICAgICAgIChub2RlLnRleHQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRSwKICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfQk9PTEVB\nTik7CgogICAgICAgICAgICBjYXNlIEpKVElOVEVHRVJMSVRFUkFMOgogICAg\nICAgICAgICAgICAgLy8gdXNlIEJpZ0RlY2ltYWwgYmVjYXVzZSBpdCBjYW4g\naGFuZGxlIHBhcnNpbmcgZXhwb25lbnRzCiAgICAgICAgICAgICAgICBCaWdE\nZWNpbWFsIGludGxpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAg\nICAgICAgKG5vZGUudGV4dC5lbmRzV2l0aCgibCIpIHx8IG5vZGUudGV4dC5l\nbmRzV2l0aCgiTCIpCiAgICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50\nZXh0LnN1YnN0cmluZygwLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAg\nICAgICAgICAgICAgICAgICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAg\nICAgICAgICAgbXVsdGlwbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9k\nZSkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVy\nYWwobmV3IExvbmcoaW50bGl0LmxvbmdWYWx1ZSgpKSwKICAgICAgICAgICAg\nICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUREVDSU1BTExJVEVSQUw6CiAgICAgICAgICAgICAgICBCaWdEZWNp\nbWFsIGRlY2xpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAgICAg\nICAgKG5vZGUudGV4dC5lbmRzV2l0aCgiZCIpIHx8IG5vZGUudGV4dC5lbmRz\nV2l0aCgiRCIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudGV4\ndC5lbmRzV2l0aCgiZiIpIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiRiIpCiAg\nICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50ZXh0LnN1YnN0cmluZygw\nLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAg\nICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAgICAgICAgICAgbXVsdGlw\nbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9kZSkpKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwoZGVjbGl0LCBMaXRl\ncmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1RSSU5H\nTElURVJBTDoKICAgICAgICAgICAgY2FzZSBKSlRUUklNQ0hBUkFDVEVSOgog\nICAgICAgICAgICBjYXNlIEpKVEVTQ0FQRUNIQVJBQ1RFUjoKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwodHJpbVF1b3Rlcyhu\nb2RlLnRleHQpLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9T\nUV9TVFJJTkcpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRURVJOVkFMVUU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChmaXJzdENoaWxkKG5vZGUp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTkFNRURJTlBVVFBBUkFNRVRFUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0ZXIobm9kZS50ZXh0\nLCBmYWxzZSk7CgogICAgICAgICAgICBjYXNlIEpKVFBPU0lUSU9OQUxJTlBV\nVFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0\nZXIobm9kZS50ZXh0LCB0cnVlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUT1I6\nIC8vIHggT1IgeQogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkub3Io\nZ2V0RXhwcmVzc2lvbihsZWZ0KG5vZGUpKSwKICAgICAgICAgICAgICAgICAg\nICBnZXRFeHByZXNzaW9uKHJpZ2h0KG5vZGUpKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVEFORDogLy8geCBBTkQgeQogICAgICAgICAgICAgICAgcmV0dXJu\nIGFuZChnZXRFeHByZXNzaW9uKGxlZnQobm9kZSkpLAogICAgICAgICAgICAg\nICAgICAgIGdldEV4cHJlc3Npb24ocmlnaHQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURVFVQUxTOiAvLyB4ID0geQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUTk9URVFVQUxTOiAvLyB4IDw+IHkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwodmFs\nMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVExFU1NUSEFOOiAvLyB4\nIDwgeQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwg\ndmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5s\nZXNzVGhhbih2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTEVT\nU09SRVFVQUw6IC8vIHggPD0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdl\ndFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdl\ndFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxp\nY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5sZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDIpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRHUkVBVEVSVEhBTjogLy8geCA+IHkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRlclRoYW4o\ndmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEdSRUFURVJPUkVR\nVUFMOiAvLyB4ID49IHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1\nZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1\nZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuZ3JlYXRlclRoYW5FcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUQUREOiAvLyB4ICsgeQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWRkKHZhbDEsIHZhbDIp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJUUkFDVDogLy8geCAtIHkKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZ\nUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1\nYnRyYWN0KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRNVUxU\nSVBMWTogLy8geCAqIHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1\nZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1\nZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm11bHRpcGx5KHZhbDEsIHZhbDIpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRESVZJREU6IC8vIHggLyB5CiAgICAgICAgICAgICAg\nICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAg\nICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5kaXZpZGUodmFsMSwg\ndmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEJFVFdFRU46IC8vIHguZmll\nbGQgW05PVF0gQkVUV0VFTiA1IEFORCAxMAogICAgICAgICAgICAgICAgdmFs\nMSA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAgICAgICAg\nICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7CiAgICAg\nICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMiwgMykp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBudWxsKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFs\nMSwgdmFsMywgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5v\ndChub3QsIGFuZChmYWN0b3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFs\nMiksCiAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5sZXNzVGhhbkVxdWFs\nKHZhbDEsIHZhbDMpKSk7CgogICAgICAgICAgICBjYXNlIEpKVElOOiAvLyB4\nLmZpZWxkIFtOT1RdIElOICgnYScsICdiJywgJ2MnKQoKICAgICAgICAgICAg\nICAgIEV4cHJlc3Npb24gaW5FeHAgPSBudWxsOwogICAgICAgICAgICAgICAg\nSXRlcmF0b3IgaW5JdGVyYXRvciA9IG5vZGUuaXRlcmF0b3IoKTsKICAgICAg\nICAgICAgICAgIC8vIHRoZSBmaXJzdCBjaGlsZCBpcyB0aGUgcGF0aAogICAg\nICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKChKUFFMTm9kZSkgaW5JdGVy\nYXRvci5uZXh0KCkpOwoKICAgICAgICAgICAgICAgIHdoaWxlIChpbkl0ZXJh\ndG9yLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZSgoSlBRTE5vZGUpIGluSXRlcmF0b3IubmV4dCgpKTsKCiAgICAg\nICAgICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciA8dmFsdWU+IElO\nICg8c3VicXVlcnk+KSBvcgogICAgICAgICAgICAgICAgICAgIC8vIDx2YWx1\nZT4gSU4gKDxzaW5nbGUgdmFsdWU+KQogICAgICAgICAgICAgICAgICAgIGlm\nICghKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsKSAmJiBub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAyKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZXZhbE5vdChub3QsIGZhY3RvcnkuY29udGFpbnModmFsMiwgdmFsMSkpOyAK\nCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBjdXJyZW50bHkgYSBz\nZXF1ZW5jZSBvZiBPUiBleHByZXNzaW9ucywgc2luY2Ugd2UKICAgICAgICAg\nICAgICAgICAgICAvLyBkbyBub3QgaGF2ZSBzdXBwb3J0IGZvciBJTiBleHBy\nZXNzaW9ucwogICAgICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXMo\ndmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlu\nRXhwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGluRXhwID0g\nZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGluRXhwID0gZmFjdG9y\neS5vcihpbkV4cCwgZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKSk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gd2UgYWRkaXRpb25h\nbGx5IG5lZWQgdG8gYWRkIGluIGEgIk5PVCBOVUxMIiBjbGF1c2UsIHNpbmNl\nCiAgICAgICAgICAgICAgICAvLyB0aGUgSU4gYmVoYXZpb3IgdGhhdCBpcyBl\neHBlY3RlZCBieSB0aGUgQ1RTIGFsc28gZXhwZWN0cwogICAgICAgICAgICAg\nICAgLy8gdG8gZmlsdGVyIG91ciBOVUxMcwogICAgICAgICAgICAgICAgcmV0\ndXJuIGFuZChldmFsTm90KG5vdCwgaW5FeHApLAogICAgICAgICAgICAgICAg\nICAgIGZhY3Rvcnkubm90RXF1YWwodmFsMSwgZmFjdG9yeS5nZXROdWxsKCkp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSVNOVUxMOiAvLyB4LmZpZWxkIElT\nIFtOT1RdIE5VTEwKICAgICAgICAgICAgICAgIGlmIChub3QpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwKICAgICAgICAg\nICAgICAgICAgICAgICAgKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSksIGZh\nY3RvcnkuZ2V0TnVsbCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbAogICAgICAgICAg\nICAgICAgICAgICAgICAoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKSwgZmFj\ndG9yeS5nZXROdWxsKCkpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRIOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFBhdGhPckNvbnN0YW50KG5vZGUp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRJREVOVElGSUVSOgogICAgICAgICAg\nICBjYXNlIEpKVElERU5USUZJQ0FUSU9OVkFSSUFCTEU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0SWRlbnRpZmllcihub2RlKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUTk9UOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbm90KGdldEV4cHJlc3Npb24ob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAg\nICAgICBjYXNlIEpKVExJS0U6IC8vIGZpZWxkIExJS0UgJyVzb21ldmFsJScK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCgogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVf\nU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwy\nLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgLy8gbG9vayBmb3Ig\nYW4gZXNjYXBlIGNoYXJhY3RlciBiZW5lYXRoIHRoZSBub2RlCiAgICAgICAg\nICAgICAgICBTdHJpbmcgZXNjYXBlID0gbnVsbDsKICAgICAgICAgICAgICAg\nIEpQUUxOb2RlIGVzY2FwZU5vZGUgPSByaWdodChub2RlKS4KICAgICAgICAg\nICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVEVTQ0FQRUNIQVJBQ1RFUiwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZXNjYXBlTm9kZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGVzY2FwZSA9IHRyaW1RdW90ZXMob25s\neUNoaWxkKGVzY2FwZU5vZGUpLnRleHQpOwoKICAgICAgICAgICAgICAgIGlm\nIChub3QpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90\nTWF0Y2hlcyh2YWwxLCB2YWwyLCAiXyIsICIlIiwgZXNjYXBlKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5tYXRjaGVzKHZhbDEsIHZhbDIsICJfIiwgIiUiLCBlc2NhcGUpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRJU0VNUFRZOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGV2YWxOb3Qobm90LAogICAgICAgICAgICAgICAgICAgIGZhY3Rv\ncnkuaXNFbXB0eShnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVFNJWkU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5zaXplKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRVUFBFUjoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5LnRvVXBwZXJDYXNlKHZhbDEpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRMT1dFUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LnRvTG93ZXJDYXNlKGdldFN0cmluZ1ZhbHVlKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRMRU5HVEg6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdHJpbmdMZW5ndGgoZ2V0U3Ry\naW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVEFCUzoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFicyhn\nZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUU1FSVDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLnNxcnQoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVE1PRDoKICAgICAgICAgICAgICAgIHZhbDEgPSBn\nZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm1vZCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUVFJJTTogLy8gVFJJTShbW3doZXJlXSBbY2hhcl0g\nRlJPTV0gZmllbGQpCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGFzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgQm9v\nbGVhbiB0cmltV2hlcmUgPSBudWxsOwoKICAgICAgICAgICAgICAgIEpQUUxO\nb2RlIGZpcnN0VHJpbUNoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAg\nICAgICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPiAxKSB7CiAg\nICAgICAgICAgICAgICAgICAgdHJpbVdoZXJlID0KICAgICAgICAgICAgICAg\nICAgICAgICAgZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTUxFQURJTkcg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpbUNoaWxkLmlk\nID09IEpKVFRSSU1UUkFJTElORyA/IEJvb2xlYW4uRkFMU0UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICA6IG51bGw7CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgVmFsdWUgdHJpbUNoYXI7CgogICAgICAg\nICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIDMgY2hpbGRyZW4sIHRoZW4gd2Ug\na25vdyB0aGUgdHJpbQogICAgICAgICAgICAgICAgLy8gY2hhciBpcyB0aGUg\nc2Vjb25kIG5vZGUKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAzKQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0g\nZ2V0VmFsdWUoc2Vjb25kQ2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZXJlIGFyZSB0d28gY2hpbGRyZW4sIHRoZW4gd2UgbmVl\nZCB0byBjaGVjayB0byBzZWUKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0\naGUgZmlyc3QgY2hpbGQgaXMgYSBsZWFkaW5nL3RyYWlsaW5nL2JvdGggbm9k\nZSwKICAgICAgICAgICAgICAgICAgICAvLyBvciB0aGUgdHJpbSBjaGFyYWN0\nZXIgbm9kZQogICAgICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5nZXRDaGls\nZENvdW50KCkgPT0gMgogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0VHJp\nbUNoaWxkLmlkICE9IEpKVFRSSU1MRUFESU5HCiAgICAgICAgICAgICAgICAg\nICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTVRSQUlMSU5HCiAg\nICAgICAgICAgICAgICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpU\nVFJJTUJPVEgpCiAgICAgICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBnZXRW\nYWx1ZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgICAgICAv\nLyBvdGh3ZXJ3aXNlLCB3ZSBkZWZhdWx0IHRvIHRyaW1taW5nIHRoZSBzcGFj\nZSBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICB0cmltQ2hhciA9IGZhY3RvcnkubmV3TGl0ZXJhbCgiICIsIExp\ndGVyYWwuVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LnRyaW0odmFsMSwgdHJpbUNoYXIsIHRyaW1XaGVyZSk7CgogICAg\nICAgICAgICBjYXNlIEpKVENPTkNBVDoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LmNvbmNhdCh2YWwxLCB2YWwyKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUU1VCU1RSSU5HOgogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7\nCiAgICAgICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwg\nMiwgMykpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEs\nIFRZUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZSh2YWwyLCBJbnRlZ2VyLlRZUEUpOwogICAgICAgICAgICAgICAgc2V0SW1w\nbGljaXRUeXBlKHZhbDMsIEludGVnZXIuVFlQRSk7CgogICAgICAgICAgICAg\nICAgLy8gdGhlIHNlbWFudGljcyBvZiB0aGUgSlBRTCBzdWJzdHJpbmcoKSBm\ndW5jdGlvbgogICAgICAgICAgICAgICAgLy8gYXJlIHRoYXQgYXJnMiBpcyB0\naGUgMS1iYXNlZCBzdGFydCBpbmRleCwgYW5kIGFyZzMgaXMKICAgICAgICAg\nICAgICAgIC8vIHRoZSBsZW5ndGggb2YgdGhlIHN0cmluZyB0byBiZSByZXR1\ncm47IHRoaXMgaXMgZGlmZmVyZW50CiAgICAgICAgICAgICAgICAvLyB0aGFu\nIHRoZSBzZW1hbnRpY3Mgb2YgdGhlIEV4cHJlc3Npb25GYWN0b3J5J3Mgc3Vi\nc3RyaW5nLAogICAgICAgICAgICAgICAgLy8gd2hpY2ggbWF0Y2hlcyB0aGUg\nSmF2YSBsYW5ndWFnZSAoMC1iYXNlZCBzdGFydCBpbmRleCwKICAgICAgICAg\nICAgICAgIC8vIGFyZzIgaXMgdGhlIGVuZCBpbmRleCk6IHdlIHBlcmZvcm0g\ndGhlIHRyYW5zbGF0aW9uIGJ5CiAgICAgICAgICAgICAgICAvLyBhZGRpbmcg\nb25lIHRvIHRoZSBmaXJzdCBhcmd1bWVudCwgYW5kIHRoZW4gYWRkaW5nIHRo\nZQogICAgICAgICAgICAgICAgLy8gZmlyc3QgYXJndW1lbnQgdG8gdGhlIHNl\nY29uZCBhcmd1bWVudCB0byBnZXQgdGhlIGVuZEluZGV4CiAgICAgICAgICAg\nICAgICAvLwogICAgICAgICAgICAgICAgLy8gIyMjIHdlIGNvdWxkIGdldCBy\naWQgb2Ygc29tZSBtZXNzeSBleHByZXNzaW9ucyBieSBjaGVja2luZyBmb3IK\nICAgICAgICAgICAgICAgIC8vIHRoZSBjb21tb24gY2FzZSB3aGVyZSB0aGUg\nYXJndW1lbnRzIGFyZSBzcGVjaWZpZWQgYXMKICAgICAgICAgICAgICAgIC8v\nIGEgbGl0ZXJhbCwgaW4gd2hpY2ggY2FzZSB3ZSBjb3VsZCBqdXN0IGRvIHRo\nZSBjYWxjdWxhdGlvbnMKICAgICAgICAgICAgICAgIC8vIGluIG1lbW9yeTsg\nb3RoZXJ3aXNlIHdlIHdpbmQgdXAgd2l0aCB1Z2x5IGxvb2tpbmcgU1FMIGxp\na2U6CiAgICAgICAgICAgICAgICAvLyBTRUxFQ1QgLi4uIEZST00gLi4uIHQx\nCiAgICAgICAgICAgICAgICAvLyAoU1VCU1RSSU5HKHQxLkFTVFIsICg/IC0g\nPykgKyAxLCAoPyArICg/IC0gPykpIC0gKCg/IC0gPykpKSA9ID8pCiAgICAg\nICAgICAgICAgICAvLyBbcGFyYW1zPShsb25nKSAyLCAoaW50KSAxLCAobG9u\nZykgMiwgKGxvbmcpIDIsIChpbnQpIDEsCiAgICAgICAgICAgICAgICAvLyAo\nbG9uZykgMiwgKGludCkgMSwgKFN0cmluZykgb28KICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LnN1YnN0cmluZyh2YWwxLCBmYWN0b3J5Lm5ld0Fy\nZ3VtZW50TGlzdAogICAgICAgICAgICAgICAgICAgIChmYWN0b3J5LnN1YnRy\nYWN0KHZhbDIsIGZhY3RvcnkubmV3TGl0ZXJhbAogICAgICAgICAgICAgICAg\nICAgICAgICAoTnVtYmVycy52YWx1ZU9mKDEpLCBMaXRlcmFsLlRZUEVfTlVN\nQkVSKSksCiAgICAgICAgICAgICAgICAgICAgICAgIChmYWN0b3J5LmFkZCh2\nYWwzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZhY3Rvcnkuc3Vi\ndHJhY3QodmFsMiwgZmFjdG9yeS5uZXdMaXRlcmFsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKE51bWJlcnMudmFsdWVPZigxKSwgTGl0ZXJh\nbC5UWVBFX05VTUJFUikpKSkpKSk7CgogICAgICAgICAgICBjYXNlIEpKVExP\nQ0FURToKICAgICAgICAgICAgICAgIC8vIGFzIHdpdGggU1VCU1RSSU5HIChh\nYm92ZSksIHRoZSBzZW1hbnRpY3MgZm9yIExPQ0FURSBkaWZmZXIKICAgICAg\nICAgICAgICAgIC8vIGZyb20gRXhwcmVzc2lvbkZhY3RvcnkuaW5kZXhPZiBp\nbiB0aGF0IExPQ0FURSB1c2VzIGEKICAgICAgICAgICAgICAgIC8vIDAtYmFz\nZWQgaW5kZXgsIGFuZCBpbmRleE9mIHVzZXMgYSAxLWJhc2VkIGluZGV4CiAg\nICAgICAgICAgICAgICBWYWx1ZSBsb2NhdGVQYXRoID0gZ2V0VmFsdWUoZmly\nc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAgICAgICBWYWx1ZSBsb2NhdGVT\nZWFyY2ggPSBnZXRWYWx1ZShzZWNvbmRDaGlsZChub2RlKSk7CiAgICAgICAg\nICAgICAgICBWYWx1ZSBsb2NhdGVGcm9tSW5kZXggPSBudWxsOwogICAgICAg\nICAgICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID4gMikgLy8gb3B0\naW9uYWwgc3RhcnQgaW5kZXggYXJnCiAgICAgICAgICAgICAgICAgICAgbG9j\nYXRlRnJvbUluZGV4ID0gZ2V0VmFsdWUodGhpcmRDaGlsZChub2RlKSk7Cgog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZVBhdGgsIFRZ\nUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShs\nb2NhdGVTZWFyY2gsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAgICBp\nZiAobG9jYXRlRnJvbUluZGV4ICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZUZyb21JbmRleCwgVFlQRV9TVFJJ\nTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFkZChmYWN0\nb3J5LmluZGV4T2YobG9jYXRlU2VhcmNoLAogICAgICAgICAgICAgICAgICAg\nIGxvY2F0ZUZyb21JbmRleCA9PSBudWxsID8gbG9jYXRlUGF0aAogICAgICAg\nICAgICAgICAgICAgICAgICA6IGZhY3RvcnkubmV3QXJndW1lbnRMaXN0KGxv\nY2F0ZVBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGZhY3Rvcnkuc3Vi\ndHJhY3QobG9jYXRlRnJvbUluZGV4LAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmFjdG9yeS5uZXdMaXRlcmFsKE51bWJlcnMudmFsdWVPZigxKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVf\nTlVNQkVSKSkpKSwKICAgICAgICAgICAgICAgICAgICBmYWN0b3J5Lm5ld0xp\ndGVyYWwoTnVtYmVycy52YWx1ZU9mKDEpLAogICAgICAgICAgICAgICAgICAg\nICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVEFHR1JFR0FURToKICAgICAgICAgICAgICAgIC8vIHNpbXBseSBwYXNz\nLXRocm91Z2ggd2hpbGUgYXNzZXJ0aW5nIGEgc2luZ2xlIGNoaWxkCiAgICAg\nICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRDT1VOVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LmNvdW50KGdldFZhbHVlKGxhc3RDaGlsZChub2RlKSkpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRNQVg6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5tYXgoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVE1JTjoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm1pbihnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1VNOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc3VtKGdldE51bWJlclZhbHVlKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBVkVSQUdFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYXZnKGdldE51bWJlclZh\nbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRE\nSVNUSU5DVFBBVEg6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5k\naXN0aW5jdChnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURVhJU1RTOgogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3RvcnkuaXNOb3RFbXB0eSgoVmFsdWUpIGV2YWwob25seUNoaWxkKG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFOWToKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LmFueSgoVmFsdWUpIGV2YWwob25seUNoaWxkKG5v\nZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFMTDoKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWN0b3J5LmFsbCgoVmFsdWUpIGV2YWwob25seUNoaWxk\nKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNVQlNFTEVDVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRTdWJxdWVyeShub2RlKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUTUVNQkVST0Y6CiAgICAgICAgICAgICAgICB2YWwx\nID0gZ2V0VmFsdWUobGVmdChub2RlKSwgVkFSX1BBVEgpOwogICAgICAgICAg\nICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpLCBWQVJfUEFUSCk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdENvbnRhaW5zVHlwZXModmFs\nMiwgdmFsMSwgQ09OVEFJTlNfVFlQRV9FTEVNRU5UKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBldmFsTm90KG5vdCwgZmFjdG9yeS5jb250YWlucyh2YWwy\nLCB2YWwxKSk7CgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlREQVRFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudERhdGUo\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVFRJTUU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5nZXRDdXJyZW50VGltZSgpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRDVVJSRU5UVElNRVNUQU1QOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudFRpbWVzdGFtcCgpOwoK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX0ZBVEFMLCAiYmFkLXRyZWUiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgc2V0SW1wbGljaXRUeXBl\ncyhWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLCBDbGFzcyBleHBlY3RlZCkgewog\nICAgICAgIHN1cGVyLnNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgZXhw\nZWN0ZWQpOwoKICAgICAgICAvLyBhcyB3ZWxsIGFzIHNldHRpbmcgdGhlIHR5\ncGVzIGZvciBjb252ZXJzaW9ucywgd2UgYWxzbyBuZWVkIHRvCiAgICAgICAg\nLy8gZW5zdXJlIHRoYXQgYW55IHBhcmFtZXRlcnMgYXJlIGRlY2xhcmVkIHdp\ndGggdGhlIGNvcnJlY3QgdHlwZSwKICAgICAgICAvLyBzaW5jZSB0aGUgSlBB\nIHNwZWMgZXhwZWN0cyB0aGF0IHRoZXNlIHdpbGwgYmUgdmFsaWRhdGVkCiAg\nICAgICAgUGFyYW1ldGVyIHBhcmFtID0gdmFsMSBpbnN0YW5jZW9mIFBhcmFt\nZXRlciA/IChQYXJhbWV0ZXIpIHZhbDEKICAgICAgICAgICAgOiB2YWwyIGlu\nc3RhbmNlb2YgUGFyYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMiA6IG51bGw7\nCiAgICAgICAgUGF0aCBwYXRoID0gdmFsMSBpbnN0YW5jZW9mIFBhdGggPyAo\nUGF0aCkgdmFsMQogICAgICAgICAgICA6IHZhbDIgaW5zdGFuY2VvZiBQYXRo\nID8gKFBhdGgpIHZhbDIgOiBudWxsOwoKICAgICAgICAvLyB3ZSBvbmx5IGNo\nZWNrIGZvciBwYXJhbWV0ZXItdG8tcGF0aCBjb21wYXJpc29ucwogICAgICAg\nIGlmIChwYXJhbSA9PSBudWxsIHx8IHBhdGggPT0gbnVsbCB8fCBwYXJhbWV0\nZXJUeXBlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0KCk7CiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENs\nYXNzIHR5cGUgPSBwYXRoLmlzWFBhdGgoKSA/IHBhdGguZ2V0VHlwZSgpIDog\nZm1kLmdldFR5cGUoKTsKICAgICAgICBpZiAodHlwZSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIFN0cmluZyBwYXJhbU5hbWUgPSBw\nYXJhbS5nZXRQYXJhbWV0ZXJOYW1lKCk7CiAgICAgICAgaWYgKHBhcmFtTmFt\nZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1h\na2Ugc3VyZSB3ZSBoYXZlIGFscmVhZHkgZGVjbGFyZWQgdGhlIHBhcmFtZXRl\ncgogICAgICAgIGlmIChwYXJhbWV0ZXJUeXBlcy5jb250YWluc0tleShwYXJh\nbU5hbWUpKQogICAgICAgICAgICBwYXJhbWV0ZXJUeXBlcy5wdXQocGFyYW1O\nYW1lLCB0eXBlKTsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFN0cmlu\nZ1ZhbHVlKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gZ2V0VHlw\nZVZhbHVlKG5vZGUsIFRZUEVfU1RSSU5HKTsKICAgIH0KCiAgICBwcml2YXRl\nIFZhbHVlIGdldE51bWJlclZhbHVlKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICByZXR1cm4gZ2V0VHlwZVZhbHVlKG5vZGUsIFRZUEVfTlVNQkVSKTsKICAg\nIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFR5cGVWYWx1ZShKUFFMTm9kZSBu\nb2RlLCBDbGFzcyBpbXBsaWNpdFR5cGUpIHsKICAgICAgICBWYWx1ZSB2YWwg\nPSBnZXRWYWx1ZShub2RlKTsKICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFs\nLCBpbXBsaWNpdFR5cGUpOwogICAgICAgIHJldHVybiB2YWw7CiAgICB9Cgog\nICAgcHJpdmF0ZSBWYWx1ZSBnZXRTdWJxdWVyeShKUFFMTm9kZSBub2RlKSB7\nCiAgICAgICAgZmluYWwgYm9vbGVhbiBzdWJjbGFzc2VzID0gdHJ1ZTsKICAg\nICAgICBTdHJpbmcgYWxpYXMgPSBuZXh0QWxpYXMoKTsKCiAgICAgICAgLy8g\ncGFyc2UgdGhlIHN1YnF1ZXJ5CiAgICAgICAgUGFyc2VkSlBRTCBwYXJzZWQg\nPSBuZXcgUGFyc2VkSlBRTChub2RlLnBhcnNlci5qcHFsLCBub2RlKTsKCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBjYW5kaWRhdGUgPSBnZXRDYW5kaWRhdGVN\nZXRhRGF0YShub2RlKTsKICAgICAgICBTdWJxdWVyeSBzdWJxID0gZmFjdG9y\neS5uZXdTdWJxdWVyeShjYW5kaWRhdGUsIHN1YmNsYXNzZXMsIGFsaWFzKTsK\nICAgICAgICBzdWJxLnNldE1ldGFEYXRhKGNhbmRpZGF0ZSk7CgogICAgICAg\nIGNvbnRleHRzLnB1c2gobmV3IENvbnRleHQocGFyc2VkLCBzdWJxKSk7Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnMgc3Vi\nZXhwID0gZ2V0UXVlcnlFeHByZXNzaW9ucygpOwogICAgICAgICAgICBzdWJx\nLnNldFF1ZXJ5RXhwcmVzc2lvbnMoc3ViZXhwKTsKICAgICAgICAgICAgcmV0\ndXJuIHN1YnE7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8g\ncmVtb3ZlIHRoZSBzdWJxdWVyeSBwYXJzZSBjb250ZXh0CiAgICAgICAgICAg\nIGNvbnRleHRzLnBvcCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJlY29yZCB0aGUgbmFtZXMgYW5kIG9yZGVyIG9mIGltcGxpY2l0IHBh\ncmFtZXRlcnMuCiAgICAgKi8KICAgIHByaXZhdGUgUGFyYW1ldGVyIGdldFBh\ncmFtZXRlcihTdHJpbmcgaWQsIGJvb2xlYW4gcG9zaXRpb25hbCkgewogICAg\nICAgIGlmIChwYXJhbWV0ZXJUeXBlcyA9PSBudWxsKQogICAgICAgICAgICBw\nYXJhbWV0ZXJUeXBlcyA9IG5ldyBMaW5rZWRNYXAoNik7CiAgICAgICAgaWYg\nKCFwYXJhbWV0ZXJUeXBlcy5jb250YWluc0tleShpZCkpCiAgICAgICAgICAg\nIHBhcmFtZXRlclR5cGVzLnB1dChpZCwgVFlQRV9PQkpFQ1QpOwoKICAgICAg\nICBDbGFzcyB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IG51bGw7CiAgICAgICAgaW50IGluZGV4OwoKICAgICAg\nICBpZiAocG9zaXRpb25hbCkgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgLy8gaW5kZXhlcyBpbiBKUFFMIGFyZSAxLWJhc2VkLCBhcyBv\ncHBvc2VkIHRvIDAtYmFzZWQgaW4KICAgICAgICAgICAgICAgIC8vIHRoZSBj\nb3JlIEV4cHJlc3Npb25GYWN0b3J5CiAgICAgICAgICAgICAgICBpbmRleCA9\nIEludGVnZXIucGFyc2VJbnQoaWQpIC0gMTsKICAgICAgICAgICAgfSBjYXRj\naCAoTnVtYmVyRm9ybWF0RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJiYWQtcG9zaXRpb25h\nbC1wYXJhbWV0ZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgaWQgfSwgZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChp\nbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAiYmFkLXBvc2l0aW9uYWwtcGFyYW1ldGVyIiwKICAgICAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGlkIH0sIG51bGwpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB0aGUgaW5k\nZXggaXMganVzdCB0aGUgY3VycmVudCBzaXplIG9mIHRoZSBwYXJhbXMKICAg\nICAgICAgICAgaW5kZXggPSBwYXJhbWV0ZXJUeXBlcy5pbmRleE9mKGlkKTsK\nICAgICAgICB9CgogICAgICAgIFBhcmFtZXRlciBwYXJhbSA9IGZhY3Rvcnku\nbmV3UGFyYW1ldGVyKGlkLCB0eXBlKTsKICAgICAgICBwYXJhbS5zZXRNZXRh\nRGF0YShtZXRhKTsKICAgICAgICBwYXJhbS5zZXRJbmRleChpbmRleCk7Cgog\nICAgICAgIHJldHVybiBwYXJhbTsKICAgIH0KCiAgICAvKioKICAgICAqIENo\nZWNrcyB0byBzZWUgaWYgd2Ugc2hvdWxkIGV2YWx1YXRlIGZvciBhIE5PVCBl\neHByZXNzaW9uLgogICAgICovCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZh\nbE5vdChib29sZWFuIG5vdCwgRXhwcmVzc2lvbiBleHApIHsKICAgICAgICBy\nZXR1cm4gbm90ID8gZmFjdG9yeS5ub3QoZXhwKSA6IGV4cDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRyaW0gb2ZmIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNp\nbmdsZS1xdW90ZXMsIGFuZCB0aGVuCiAgICAgKiByZXBsYWNlIGFueSBpbnRl\ncm5hbCAnJyBpbnN0YW5jZXMgd2l0aCAnIChzaW5jZSByZXBlYXRpbmcgdGhl\nCiAgICAgKiBxdW90ZSBpcyB0aGUgSlBRTCBtZWNoYW5pc20gb2YgZXNjYXBp\nbmcgYSBzaW5nbGUgcXVvdGUpLgogICAgICovCiAgICBwcml2YXRlIFN0cmlu\nZyB0cmltUXVvdGVzKFN0cmluZyBzdHIpIHsKICAgICAgICBpZiAoc3RyID09\nIG51bGwgfHwgc3RyLmxlbmd0aCgpIDw9IDEpCiAgICAgICAgICAgIHJldHVy\nbiBzdHI7CgogICAgICAgIGlmIChzdHIuc3RhcnRzV2l0aCgiJyIpICYmIHN0\nci5lbmRzV2l0aCgiJyIpKQogICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3Ry\naW5nKDEsIHN0ci5sZW5ndGgoKSAtIDEpOwoKICAgICAgICBpbnQgaW5kZXgg\nPSAtMTsKCiAgICAgICAgd2hpbGUgKChpbmRleCA9IHN0ci5pbmRleE9mKCIn\nJyIsIGluZGV4ICsgMSkpICE9IC0xKQogICAgICAgICAgICBzdHIgPSBzdHIu\nc3Vic3RyaW5nKDAsIGluZGV4ICsgMSkgKyBzdHIuc3Vic3RyaW5nKGluZGV4\nICsgMik7CgogICAgICAgIHJldHVybiBzdHI7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBbiBJbnRlZ2VyTGl0ZXJhbCBhbmQgRGVjaW1hbExpdGVyYWwgbm9k\nZSB3aWxsCiAgICAgKiBoYXZlIGEgY2hpbGQgbm9kZSBvZiBOZWdhdGl2ZSBp\nZiBpdCBpcyBuZWdhdGl2ZToKICAgICAqIGlmIHNvLCB0aGlzIG1ldGhvZCBy\nZXR1cm5zIC0xLCBlbHNlIGl0IHJldHVybnMgMS4KICAgICAqLwogICAgcHJp\ndmF0ZSBzaG9ydCBuZWdhdGl2ZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAg\naWYgKG5vZGUuY2hpbGRyZW4gIT0gbnVsbCAmJiBub2RlLmNoaWxkcmVuLmxl\nbmd0aCA9PSAxCiAgICAgICAgICAgICYmIGZpcnN0Q2hpbGQobm9kZSkuaWQg\nPT0gSkpUTkVHQVRJVkUpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHJldHVybiAxOwogICAgfQoKICAgIHByaXZh\ndGUgVmFsdWUgZ2V0SWRlbnRpZmllcihKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgZmluYWwgU3RyaW5nIG5hbWUgPSBub2RlLnRleHQ7CiAgICAgICAgZmlu\nYWwgVmFsdWUgdmFsID0gZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAg\nICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdldE1ldGFEYXRhRm9yQWxpYXMo\nbmFtZSk7CgogICAgICAgIGlmIChjbWQgIT0gbnVsbCkgewogICAgICAgICAg\nICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMg\ndGhlIGFsaWFzCiAgICAgICAgICAgIC8vIGZvciB0aGUgY2FuZGlkYXRlICh3\nZSBkb24ndCB1c2UgdmFyaWFibGVzIGZvciB0aGlzKQogICAgICAgICAgICBW\nYWx1ZSB0aGl6ID0gZmFjdG9yeS5nZXRUaGlzKCk7CiAgICAgICAgICAgIHRo\naXouc2V0TWV0YURhdGEoY21kKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXo7\nCiAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBQYXRoKSB7CiAg\nICAgICAgICAgIHJldHVybiAoUGF0aCkgdmFsOwogICAgICAgIH0gZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgVmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJu\nIChWYWx1ZSkgdmFsOwogICAgICAgIH0KCiAgICAgICAgdGhyb3cgcGFyc2VF\neGNlcHRpb24oRVhfVVNFUiwgInVua25vd24taWRlbnRpZmllciIsCiAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgbmFtZSB9LCBudWxsKTsKICAgIH0KCiAg\nICBwcml2YXRlIFZhbHVlIGdldFBhdGhPckNvbnN0YW50KEpQUUxOb2RlIG5v\nZGUpIHsKICAgICAgICAvLyBmaXJzdCBjaGVjayB0byBzZWUgaWYgdGhlIHBh\ndGggaXMgYW4gZW51bSBvciBzdGF0aWMgZmllbGQsIGFuZAogICAgICAgIC8v\nIGlmIHNvLCBsb2FkIGl0CiAgICAgICAgU3RyaW5nIGNsYXNzTmFtZSA9IGFz\nc2VtYmxlKG5vZGUsICIuIiwgMSk7CiAgICAgICAgQ2xhc3MgYyA9IHJlc29s\ndmVyLmNsYXNzRm9yTmFtZShjbGFzc05hbWUsIG51bGwpOwogICAgICAgIGlm\nIChjICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9\nIGxhc3RDaGlsZChub2RlKS50ZXh0OwoKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIEZpZWxkIGZpZWxkID0gYy5nZXRGaWVsZChmaWVsZE5h\nbWUpOwogICAgICAgICAgICAgICAgT2JqZWN0IHZhbHVlID0gZmllbGQuZ2V0\nKG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0\nZXJhbCh2YWx1ZSwgTGl0ZXJhbC5UWVBFX1VOS05PV04pOwogICAgICAgICAg\nICB9IGNhdGNoIChOb1N1Y2hGaWVsZEV4Y2VwdGlvbiBuc2ZlKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8t\nZmllbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgY2xh\nc3NOYW1lLCBmaWVsZE5hbWUgfSwgbnNmZSk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBwYXJz\nZUV4Y2VwdGlvbihFWF9VU0VSLCAidW5hY2Nlc3NpYmxlLWZpZWxkIiwKICAg\nICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGNsYXNzTmFtZSwgZmll\nbGROYW1lIH0sIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgcmV0dXJuIGdldFBhdGgobm9kZSwgZmFsc2UsIHRydWUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFBhdGggZ2V0UGF0aChK\nUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGdldFBhdGgobm9kZSwg\nZmFsc2UsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgUGF0aCBnZXRQYXRo\nKEpQUUxOb2RlIG5vZGUsIGJvb2xlYW4gcGNPbmx5LCBib29sZWFuIGlubmVy\nKSB7CiAgICAgICAgLy8gcmVzb2x2ZSB0aGUgZmlyc3QgZWxlbWVudCBhZ2Fp\nbnN0IHRoZSBhbGlhc2VzIG1hcCAuLi4KICAgICAgICAvLyBpLmUuLCB0aGUg\ncGF0aCAiU0VMRUNUIHguaWQgRlJPTSBTb21lQ2xhc3MgeCB3aGVyZSB4Lmlk\nID4gMTAiCiAgICAgICAgLy8gd2lsbCBuZWVkIHRvIGhhdmUgIngiIGluIHRo\nZSBhbGlhcyBtYXAgaW4gb3JkZXIgdG8gcmVzb2x2ZQogICAgICAgIFBhdGgg\ncGF0aDsKCiAgICAgICAgZmluYWwgU3RyaW5nIG5hbWUgPSBmaXJzdENoaWxk\nKG5vZGUpLnRleHQ7CiAgICAgICAgZmluYWwgVmFsdWUgdmFsID0gZ2V0VmFy\naWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICAvLyBoYW5kbGUgdGhlIGNh\nc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMgdGhlIGFsaWFzCiAgICAgICAg\nLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJsZXMg\nZm9yIHRoaXMpCiAgICAgICAgaWYgKG5hbWUuZXF1YWxzSWdub3JlQ2FzZShj\ndHgoKS5zY2hlbWFBbGlhcykpIHsKICAgICAgICAgICAgaWYgKGN0eCgpLnN1\nYnF1ZXJ5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHBhdGggPSBmYWN0\nb3J5Lm5ld1BhdGgoY3R4KCkuc3VicXVlcnkpOwogICAgICAgICAgICAgICAg\ncGF0aC5zZXRNZXRhRGF0YShjdHgoKS5zdWJxdWVyeS5nZXRNZXRhRGF0YSgp\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhdGgg\nPSBmYWN0b3J5Lm5ld1BhdGgoKTsKICAgICAgICAgICAgICAgIHBhdGguc2V0\nTWV0YURhdGEoY3R4KCkubWV0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGVsc2UgaWYgKGdldE1ldGFEYXRhRm9yQWxpYXMobmFtZSkgIT0gbnVsbCkK\nICAgICAgICAgICAgcGF0aCA9IG5ld1BhdGgobnVsbCwgZ2V0TWV0YURhdGFG\nb3JBbGlhcyhuYW1lKSk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNl\nb2YgUGF0aCkKICAgICAgICAgICAgcGF0aCA9IChQYXRoKSB2YWw7CiAgICAg\nICAgZWxzZSBpZiAodmFsLmdldE1ldGFEYXRhKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgcGF0aCA9IG5ld1BhdGgodmFsLCB2YWwuZ2V0TWV0YURhdGEoKSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAicGF0aC1uby1tZXRhIiwKICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXsgYXNzZW1ibGUobm9kZSksIG51bGwgfSwgbnVsbCk7Cgog\nICAgICAgIC8vIHdhbGsgdGhyb3VnaCB0aGUgY2hpbGRyZW4gYW5kIGFzc2Vt\nYmxlIHRoZSBwYXRoCiAgICAgICAgYm9vbGVhbiBhbGxvd051bGwgPSAhaW5u\nZXI7CiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBub2RlLmNoaWxkcmVu\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwYXRoLmlzWFBhdGgo\nKSkgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IGk7IGogPG5vZGUu\nY2hpbGRyZW4ubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICAgICAgcGF0\naCA9IChQYXRoKSB0cmF2ZXJzZVhQYXRoKHBhdGgsIG5vZGUuY2hpbGRyZW5b\nal0udGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aDsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBwYXRoID0gKFBhdGgpIHRyYXZlcnNlUGF0\naChwYXRoLCBub2RlLmNoaWxkcmVuW2ldLnRleHQsIHBjT25seSwKICAgICAg\nICAgICAgICAgIGFsbG93TnVsbCk7CgogICAgICAgICAgICAvLyBhbGwgdHJh\ndmVyc2FscyBidXQgdGhlIGZpcnN0IG9uZSB3aWxsIGFsd2F5cyBiZSBpbm5l\nciBqb2lucwogICAgICAgICAgICBhbGxvd051bGwgPSBmYWxzZTsKICAgICAg\nICB9CgogICAgICAgIHJldHVybiBwYXRoOwogICAgfQoKICAgIHByb3RlY3Rl\nZCBDbGFzcyBnZXREZWNsYXJlZFZhcmlhYmxlVHlwZShTdHJpbmcgbmFtZSkg\newogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0TWV0YURhdGFGb3JB\nbGlhcyhuYW1lKTsKICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBjbWQuZ2V0RGVzY3JpYmVkVHlwZSgpOwoKICAgICAgICBp\nZiAobmFtZSAhPSBudWxsICYmIG5hbWUuZXF1YWxzKGN0eCgpLnNjaGVtYUFs\naWFzKSkKICAgICAgICAgICAgcmV0dXJuIGdldENhbmRpZGF0ZVR5cGUoKTsK\nCiAgICAgICAgLy8gSlBRTCBoYXMgbm8gZGVjbGFyZWQgdmFyaWFibGVzCiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIGFuIEV4cHJlc3Npb24gZm9yIHRoZSBnaXZlbiBub2RlIGJ5IGV2YWwn\naW5nIGl0LgogICAgICovCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZ2V0RXhw\ncmVzc2lvbihKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgT2JqZWN0IGV4cCA9\nIGV2YWwobm9kZSk7CgogICAgICAgIC8vIGNoZWNrIGZvciBib29sZWFuIHZh\nbHVlcyB1c2VkIGFzIGV4cHJlc3Npb25zCiAgICAgICAgaWYgKCEoZXhwIGlu\nc3RhbmNlb2YgRXhwcmVzc2lvbikpCiAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5LmFzRXhwcmVzc2lvbigoVmFsdWUpIGV4cCk7CiAgICAgICAgcmV0dXJu\nIChFeHByZXNzaW9uKSBleHA7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBn\nZXRWYWx1ZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGdldFZh\nbHVlKG5vZGUsIFZBUl9QQVRIKTsKICAgIH0KCiAgICBwcml2YXRlIFBhdGgg\nbmV3UGF0aChWYWx1ZSB2YWwsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIFBhdGggcGF0aCA9IHZhbCA9PSBudWxsID8gZmFjdG9yeS5uZXdQYXRo\nKCkgOiBmYWN0b3J5Lm5ld1BhdGgodmFsKTsKICAgICAgICBpZiAobWV0YSAh\nPSBudWxsKQogICAgICAgICAgICBwYXRoLnNldE1ldGFEYXRhKG1ldGEpOwog\nICAgICAgIHJldHVybiBwYXRoOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyBhIFZhbHVlIGZvciB0aGUgZ2l2ZW4gbm9kZSBieSBldmFsJ2luZyBp\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBWYWx1ZSBnZXRWYWx1ZShKUFFMTm9k\nZSBub2RlLCBpbnQgaGFuZGxlVmFyKSB7CiAgICAgICAgVmFsdWUgdmFsID0g\nKFZhbHVlKSBldmFsKG5vZGUpOwoKICAgICAgICAvLyBkZXRlcm1pbmQgaG93\nIHRvIGV2YXVhdGUgYSB2YXJpYWJlCiAgICAgICAgaWYgKCF2YWwuaXNWYXJp\nYWJsZSgpKQogICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIGVsc2Ug\naWYgKGhhbmRsZVZhciA9PSBWQVJfUEFUSCAmJiAhKHZhbCBpbnN0YW5jZW9m\nIFBhdGgpKQogICAgICAgICAgICByZXR1cm4gbmV3UGF0aCh2YWwsIHZhbC5n\nZXRNZXRhRGF0YSgpKTsKICAgICAgICBlbHNlIGlmIChoYW5kbGVWYXIgPT0g\nVkFSX0VSUk9SKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihF\nWF9VU0VSLCAidW5leHBlY3RlZC12YXIiLAogICAgICAgICAgICAgICAgbmV3\nIE9iamVjdFtdeyBub2RlLnRleHQgfSwgbnVsbCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICByZXR1cm4gdmFsOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFBhcnNlIENvbnRleHQgTWFuYWdl\nbWVudAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHBy\naXZhdGUgQ29udGV4dCBjdHgoKSB7CiAgICAgICAgcmV0dXJuIChDb250ZXh0\nKSBjb250ZXh0cy5wZWVrKCk7CiAgICB9CgogICAgcHJpdmF0ZSBKUFFMTm9k\nZSByb290KCkgewogICAgICAgIHJldHVybiBjdHgoKS5wYXJzZWQucm9vdDsK\nICAgIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGFG\nb3JBbGlhcyhTdHJpbmcgYWxpYXMpIHsKICAgICAgICBmb3IgKGludCBpID0g\nY29udGV4dHMuc2l6ZSgpIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAg\nICAgQ29udGV4dCBjb250ZXh0ID0gKENvbnRleHQpIGNvbnRleHRzLmdldChp\nKTsKICAgICAgICAgICAgaWYgKGFsaWFzLmVxdWFsc0lnbm9yZUNhc2UoY29u\ndGV4dC5zY2hlbWFBbGlhcykpCiAgICAgICAgICAgICAgICByZXR1cm4gY29u\ndGV4dC5tZXRhOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHJpdmF0ZSBjbGFzcyBDb250ZXh0IHsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBQYXJzZWRKUFFMIHBhcnNlZDsKICAgICAgICBwcml2YXRl\nIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBwcml2YXRlIFN0cmluZyBz\nY2hlbWFBbGlhczsKICAgICAgICBwcml2YXRlIFN1YnF1ZXJ5IHN1YnF1ZXJ5\nOwoKICAgICAgICBDb250ZXh0KFBhcnNlZEpQUUwgcGFyc2VkLCBTdWJxdWVy\neSBzdWJxdWVyeSkgewogICAgICAgICAgICB0aGlzLnBhcnNlZCA9IHBhcnNl\nZDsKICAgICAgICAgICAgdGhpcy5zdWJxdWVyeSA9IHN1YnF1ZXJ5OwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBOb2RlIHRyYXZlcnNhbCB1dGlsaXRpZXMKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwcml2YXRlIEpQUUxOb2RlIG9u\nbHlDaGlsZChKUFFMTm9kZSBub2RlKQogICAgICAgIHRocm93cyBVc2VyRXhj\nZXB0aW9uIHsKICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IGZpcnN0Q2hpbGQo\nbm9kZSk7CgogICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDEp\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJt\ndWx0aS1jaGlsZHJlbiIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIG5vZGUsIEFycmF5cy5hc0xpc3Qobm9kZS5jaGlsZHJlbikgfSwgbnVsbCk7\nCgogICAgICAgIHJldHVybiBjaGlsZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgdGhlIGxlZnQgbm9kZSAodGhlIGZpcnN0IG9mIHRoZSBjaGls\nZHJlbiksIGFuZCBhc3NlcnRzCiAgICAgKiB0aGF0IHRoZXJlIGFyZSBleGFj\ndGx5IHR3byBjaGlsZHJlbi4KICAgICAqLwogICAgcHJpdmF0ZSBKUFFMTm9k\nZSBsZWZ0KEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gY2hpbGQo\nbm9kZSwgMCwgMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRo\nZSByaWdodCBub2RlICh0aGUgc2Vjb25kIG9mIHRoZSBjaGlsZHJlbiksIGFu\nZCBhc3NlcnRzCiAgICAgKiB0aGF0IHRoZXJlIGFyZSBleGFjdGx5IHR3byBj\naGlsZHJlbi4KICAgICAqLwogICAgcHJpdmF0ZSBKUFFMTm9kZSByaWdodChK\nUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkKG5vZGUsIDEs\nIDIpOwogICAgfQoKICAgIHByaXZhdGUgSlBRTE5vZGUgY2hpbGQoSlBRTE5v\nZGUgbm9kZSwgaW50IGNoaWxkTnVtLCBpbnQgYXNzZXJ0Q291bnQpIHsKICAg\nICAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggIT0gYXNzZXJ0Q291bnQp\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ3\ncm9uZy1jaGlsZC1jb3VudCIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IG5ldyBJbnRlZ2VyKGFzc2VydENvdW50KSwgbm9kZSwKICAgICAgICAg\nICAgICAgICAgICBBcnJheXMuYXNMaXN0KG5vZGUuY2hpbGRyZW4pIH0sIG51\nbGwpOwoKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbltjaGlsZE51bV07\nCiAgICB9CgogICAgcHJpdmF0ZSBKUFFMTm9kZSBmaXJzdENoaWxkKEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiA9PSBudWxs\nIHx8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1jaGlsZHJlbiIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUgfSwgbnVsbCk7CiAg\nICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bMF07CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgSlBRTE5vZGUgc2Vjb25kQ2hpbGQoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVuWzFdOwogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIHRoaXJkQ2hpbGQoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVuWzJdOwog\nICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIGxhc3RDaGlsZChK\nUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGxhc3RDaGlsZChub2Rl\nLCAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBOdGggZnJvbSB0aGUg\nbGFzdCBjaGlsZC4gRS5nLiwKICAgICAqIGxhc3RDaGlsZCgxKSB3aWxsIHJl\ndHVybiB0aGUgc2Vjb25kLXRvLXRoZS1sYXN0IGNoaWxkLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSBsYXN0Q2hpbGQoSlBRTE5vZGUg\nbm9kZSwgaW50IGZyb21MYXN0KSB7CiAgICAgICAgcmV0dXJuIG5vZGUuY2hp\nbGRyZW5bbm9kZS5jaGlsZHJlbi5sZW5ndGggLSAoMSArIGZyb21MYXN0KV07\nCiAgICB9CgogICAgLyoqCiAgICAgKiBCYXNlIG5vZGUgdGhhdCB3aWxsIGJl\nIGdlbmVyYXRlZCBieSB0aGUgSlBRTEV4cHJlc3Npb25CdWlsZGVyOyBiYXNl\nCiAgICAgKiBjbGFzcyBvZiB0aGUge0BsaW5rIFNpbXBsZU5vZGV9IHRoYXQg\naXMgdXNlZCBieSB7QGxpbmsgSlBRTH0uCiAgICAgKgogICAgICogQGF1dGhv\nciBNYXJjIFBydWQnaG9tbWVhdXgKICAgICAqIEBzZWUgTm9kZQogICAgICog\nQHNlZSBTaW1wbGVOb2RlCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCBzdGF0aWMgY2xhc3MgSlBRTE5vZGUKICAgICAgICBpbXBsZW1lbnRzIE5v\nZGUsIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIGZpbmFsIGludCBpZDsKICAg\nICAgICBmaW5hbCBKUFFMIHBhcnNlcjsKICAgICAgICBKUFFMTm9kZSBwYXJl\nbnQ7CiAgICAgICAgSlBRTE5vZGVbXSBjaGlsZHJlbjsKICAgICAgICBTdHJp\nbmcgdGV4dDsKICAgICAgICBib29sZWFuIG5vdCA9IGZhbHNlOwoKICAgICAg\nICBwdWJsaWMgSlBRTE5vZGUoSlBRTCBwYXJzZXIsIGludCBpZCkgewogICAg\nICAgICAgICB0aGlzLmlkID0gaWQ7CiAgICAgICAgICAgIHRoaXMucGFyc2Vy\nID0gcGFyc2VyOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgamp0\nT3BlbigpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGpqdENs\nb3NlKCkgewogICAgICAgIH0KCiAgICAgICAgSlBRTE5vZGVbXSBmaW5kQ2hp\nbGRyZW5CeUlEKGludCBpZCkgewogICAgICAgICAgICBDb2xsZWN0aW9uIHNl\ndCA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIGZpbmRDaGlsZHJlbkJ5\nSUQoaWQsIHNldCk7CiAgICAgICAgICAgIHJldHVybiAoSlBRTE5vZGVbXSkg\nc2V0LnRvQXJyYXkobmV3IEpQUUxOb2RlW3NldC5zaXplKCldKTsKICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBmaW5kQ2hpbGRyZW5CeUlEKGlu\ndCBpZCwgQ29sbGVjdGlvbiBzZXQpIHsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGNoaWxkcmVuICE9IG51bGwgJiYgaSA8IGNoaWxkcmVuLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoY2hpbGRyZW5baV0uaWQg\nPT0gaWQpCiAgICAgICAgICAgICAgICAgICAgc2V0LmFkZChjaGlsZHJlbltp\nXSk7CgogICAgICAgICAgICAgICAgY2hpbGRyZW5baV0uZmluZENoaWxkcmVu\nQnlJRChpZCwgc2V0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgYm9vbGVhbiBoYXNDaGlsZElEKGludCBpZCkgewogICAgICAgICAgICBy\nZXR1cm4gZmluZENoaWxkQnlJRChpZCwgZmFsc2UpICE9IG51bGw7CiAgICAg\nICAgfQoKICAgICAgICBKUFFMTm9kZSBmaW5kQ2hpbGRCeUlEKGludCBpZCwg\nYm9vbGVhbiByZWN1cnNlKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBjaGlsZHJlbiAhPSBudWxsICYmIGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgY2hpbGQgPSBjaGlsZHJl\nbltpXTsKCiAgICAgICAgICAgICAgICBpZiAoY2hpbGQuaWQgPT0gaWQpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuW2ldOwoKICAgICAg\nICAgICAgICAgIGlmIChyZWN1cnNlKSB7CiAgICAgICAgICAgICAgICAgICAg\nSlBRTE5vZGUgZm91bmQgPSBjaGlsZC5maW5kQ2hpbGRCeUlEKGlkLCByZWN1\ncnNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvdW5kOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBub3Qg\nZm91bmQKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBqanRTZXRQYXJlbnQoTm9kZSBwYXJlbnQpIHsK\nICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSAoSlBRTE5vZGUpIHBhcmVudDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOb2RlIGpqdEdldFBhcmVudCgp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50OwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgamp0QWRkQ2hpbGQoTm9kZSBuLCBpbnQg\naSkgewogICAgICAgICAgICBpZiAoY2hpbGRyZW4gPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgY2hpbGRyZW4gPSBuZXcgSlBRTE5vZGVbaSArIDFdOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKGkgPj0gY2hpbGRyZW4ubGVuZ3RoKSB7\nCiAgICAgICAgICAgICAgICBKUFFMTm9kZSBjW10gPSBuZXcgSlBRTE5vZGVb\naSArIDFdOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShjaGls\nZHJlbiwgMCwgYywgMCwgY2hpbGRyZW4ubGVuZ3RoKTsKICAgICAgICAgICAg\nICAgIGNoaWxkcmVuID0gYzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nY2hpbGRyZW5baV0gPSAoSlBRTE5vZGUpIG47CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgTm9kZSBqanRHZXRDaGlsZChpbnQgaSkgewogICAgICAgICAg\nICByZXR1cm4gY2hpbGRyZW5baV07CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGdldENoaWxkQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiBq\nanRHZXROdW1DaGlsZHJlbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIEpQUUxOb2RlIGdldENoaWxkKGludCBpbmRleCkgewogICAgICAgICAgICBy\nZXR1cm4gKEpQUUxOb2RlKSBqanRHZXRDaGlsZChpbmRleCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAgICAg\nICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KGNoaWxkcmVuKS5pdGVyYXRv\ncigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBqanRHZXROdW1D\naGlsZHJlbigpIHsKICAgICAgICAgICAgcmV0dXJuIChjaGlsZHJlbiA9PSBu\ndWxsKSA/IDAgOiBjaGlsZHJlbi5sZW5ndGg7CiAgICAgICAgfQoKICAgICAg\nICB2b2lkIHNldFRleHQoU3RyaW5nIHRleHQpIHsKICAgICAgICAgICAgdGhp\ncy50ZXh0ID0gdGV4dDsKICAgICAgICB9CgogICAgICAgIHZvaWQgc2V0VG9r\nZW4oVG9rZW4gdCkgewogICAgICAgICAgICBzZXRUZXh0KHQuaW1hZ2UpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsK\nICAgICAgICAgICAgcmV0dXJuIEpQUUxUcmVlQ29uc3RhbnRzLmpqdE5vZGVO\nYW1lW3RoaXMuaWRdOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZyhTdHJpbmcgcHJlZml4KSB7CiAgICAgICAgICAgIHJldHVy\nbiBwcmVmaXggKyB0b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogRGVidWdnaW5nIG1ldGhvZC4KICAgICAgICAgKgogICAg\nICAgICAqIEBzZWUgI2R1bXAoamF2YS5pby5QcmludFN0cmVhbSxTdHJpbmcp\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZHVtcChTdHJpbmcg\ncHJlZml4KSB7CiAgICAgICAgICAgIGR1bXAoU3lzdGVtLm91dCwgcHJlZml4\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGR1bXAoKSB7CiAg\nICAgICAgICAgIGR1bXAoIiAiKTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIERlYnVnZ2luZyBtZXRob2QgdG8gb3V0cHV0IGEgcGFyc2Ug\ndHJlZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdXQgdGhlIHN0\ncmVhbSB0byB3aGljaCB0byB3cml0ZSB0aGUgZGVidWdnaW5nIGluZm8KICAg\nICAgICAgKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggdG8gd3JpdGUgb3V0\nIGJlZm9yZSBsaW5lcwogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIGR1bXAoUHJpbnRTdHJlYW0gb3V0LCBTdHJpbmcgcHJlZml4KSB7CiAgICAg\nICAgICAgIGR1bXAob3V0LCBwcmVmaXgsIGZhbHNlKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIGR1bXAoUHJpbnRTdHJlYW0gb3V0LCBTdHJp\nbmcgcHJlZml4LCBib29sZWFuIHRleHQpIHsKICAgICAgICAgICAgb3V0LnBy\naW50bG4odG9TdHJpbmcocHJlZml4KQogICAgICAgICAgICAgICAgKyAodGV4\ndCAmJiB0aGlzLnRleHQgIT0gbnVsbCA/ICIgWyIgKyB0aGlzLnRleHQgKyAi\nXSIgOiAiIikpOwogICAgICAgICAgICBpZiAoY2hpbGRyZW4gIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaGlsZHJl\nbi5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgIEpQUUxOb2Rl\nIG4gPSAoSlBRTE5vZGUpIGNoaWxkcmVuW2ldOwogICAgICAgICAgICAgICAg\nICAgIGlmIChuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbi5kdW1wKG91dCwgcHJlZml4ICsgIiAiLCB0ZXh0KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQdWJsaWMgZm9yIHVuaXQg\ndGVzdGluZyBwdXJwb3Nlcy4KICAgICAqIEBub2phdmFkb2MKICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBjbGFzcyBQYXJzZWRKUFFMCiAgICAgICAgaW1w\nbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwcm90ZWN0ZWQgZmlu\nYWwgSlBRTE5vZGUgcm9vdDsKICAgICAgICBwcm90ZWN0ZWQgZmluYWwgU3Ry\naW5nIHF1ZXJ5OwogICAgICAgIAogICAgICAgIC8vIGNhY2hlIG9mIGNhbmRp\nZGF0ZSB0eXBlIGRhdGEuIFRoaXMgaXMgc3RvcmVkIGhlcmUgaW4gY2FzZSB0\naGlzICAKICAgICAgICAvLyBwYXJzZSB0cmVlIGlzIHJldXNlZCBpbiBhIGNv\nbnRleHQgdGhhdCBkb2VzIG5vdCBrbm93IHdoYXQgdGhlIAogICAgICAgIC8v\nIGNhbmRpZGF0ZSB0eXBlIGlzIGFscmVhZHkuIAogICAgICAgIHByaXZhdGUg\nQ2xhc3MgX2NhbmRpZGF0ZVR5cGU7CgogICAgICAgIFBhcnNlZEpQUUwoU3Ry\naW5nIGpwcWwpIHsKICAgICAgICAgICAgdGhpcyhqcHFsLCBwYXJzZShqcHFs\nKSk7CiAgICAgICAgfQoKICAgICAgICBQYXJzZWRKUFFMKFN0cmluZyBxdWVy\neSwgSlBRTE5vZGUgcm9vdCkgewogICAgICAgICAgICB0aGlzLnJvb3QgPSBy\nb290OwogICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBKUFFMTm9kZSBwYXJz\nZShTdHJpbmcganBxbCkgewogICAgICAgICAgICBpZiAoanBxbCA9PSBudWxs\nKQogICAgICAgICAgICAgICAganBxbCA9ICIiOwoKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHJldHVybiAoSlBRTE5vZGUpIG5ldyBKUFFM\nKGpwcWwpLnBhcnNlUXVlcnkoKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXJy\nb3IgZSkgewogICAgICAgICAgICAgICAgLy8gc3BlY2lhbCBoYW5kbGluZyBm\nb3IgRXJyb3Igc3ViY2xhc3Nlcywgd2hpY2ggdGhlCiAgICAgICAgICAgICAg\nICAvLyBwYXJzZXIgbWF5IHNvbWV0aW1lcyAodW5mb3J0dW5hdGVseSkgdGhy\nb3cKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYXJzZS1lcnJvciIsCiAgICAgICAgICAgICAgICAgICAgbmV3\nIE9iamVjdFtdeyBlLnRvU3RyaW5nKCksIGpwcWwgfSkpOwogICAgICAgICAg\nICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicGFyc2UtZXJy\nb3IiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZS50b1N0\ncmluZygpLCBqcHFsIH0pLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgdm9pZCBwb3B1bGF0ZShFeHByZXNzaW9uU3RvcmVRdWVyeSBx\ndWVyeSkgewogICAgICAgICAgICBRdWVyeUNvbnRleHQgY3R4ID0gcXVlcnku\nZ2V0Q29udGV4dCgpOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG93bmluZyBx\ndWVyeSdzIGNvbnRleHQgZG9lcyBub3QgaGF2ZQogICAgICAgICAgICAvLyBh\nbnkgY2FuZGlkYXRlIGNsYXNzLCB0aGVuIHNldCBpdCBoZXJlCiAgICAgICAg\nICAgIGlmIChjdHguZ2V0Q2FuZGlkYXRlVHlwZSgpID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGlmIChfY2FuZGlkYXRlVHlwZSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9jYW5kaWRhdGVUeXBlID0gbmV3IEpQUUxFeHBy\nZXNzaW9uQnVpbGRlcgogICAgICAgICAgICAgICAgICAgICAgICAobnVsbCwg\ncXVlcnksIHRoaXMpLmdldENhbmRpZGF0ZVR5cGUoKTsKICAgICAgICAgICAg\nICAgIGN0eC5zZXRDYW5kaWRhdGVUeXBlKF9jYW5kaWRhdGVUeXBlLCB0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAv\nKioKICAgICAgICAgKiBQdWJsaWMgZm9yIHVuaXQgdGVzdGluZyBwdXJwb3Nl\ncy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ2xhc3MgZ2V0Q2FuZGlk\nYXRlVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGVUeXBl\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZyAo\nKQoJCXsKCQkJcmV0dXJuIHRoaXMucXVlcnk7CgkJfQoJfQp9Cgo=\n","encoding":"base64"}

