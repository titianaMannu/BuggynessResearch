{"sha":"0d879a67257d5d740f393bbc375927722f368c77","node_id":"MDQ6QmxvYjIwNjM2NDowZDg3OWE2NzI1N2Q1ZDc0MGYzOTNiYmMzNzU5Mjc3MjJmMzY4Yzc3","size":67553,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0d879a67257d5d740f393bbc375927722f368c77","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNl\ndDsKaW1wb3J0IGphdmEudXRpbC5Tb3J0ZWRTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuVHJlZVNldDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5T\ndHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLlBDUmVnaXN0cnkuUmVnaXN0ZXJDbGFzc0xpc3RlbmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VD\nYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuRHlu\nYW1pY1BlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xvc2VhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVu\nSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVs\ncGVyOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogUmVwb3Np\ndG9yeSBvZiBhbmQgZmFjdG9yeSBmb3IgcGVyc2lzdGVudCBtZXRhZGF0YS4K\nICoKICogQHNpbmNlIDAuMy4wCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBh\ndXRob3IgU3RldmUgS2ltIChxdWVyeSBtZXRhZGF0YSkKICovCnB1YmxpYyBj\nbGFzcyBNZXRhRGF0YVJlcG9zaXRvcnkKICAgIGltcGxlbWVudHMgUENSZWdp\nc3RyeS5SZWdpc3RlckNsYXNzTGlzdGVuZXIsIENvbmZpZ3VyYWJsZSwgQ2xv\nc2VhYmxlLCAKICAgIE1ldGFEYXRhTW9kZXMsIFNlcmlhbGl6YWJsZSB7Cgog\nICAgLyoqCiAgICAgKiBDb25zdGFudCB0byBub3QgdmFsaWRhdGUgYW55IG1l\ndGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBW\nQUxJREFURV9OT05FID0gMDsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRv\nIHZhbGlkYXRlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBWQUxJREFURV9NRVRBID0gMTsKCiAgICAvKioKICAgICAq\nIEJpdCBmbGFnIHRvIHZhbGlkYXRlIG1hcHBpbmdzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9NQVBQSU5HID0gMjsK\nCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlkYXRlIHVuZW5oYW5j\nZWQgbWV0YWRhdGEgb25seS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgVkFMSURBVEVfVU5FTkhBTkNFRCA9IDQ7CgogICAgLyoqCiAg\nICAgKiBCaXQgZmxhZyBmb3IgcnVudGltZSB2YWxpZGF0aW9uLiBSZXF1aXJl\ncyB0aGF0IGFsbCBjbGFzc2VzIGFyZQogICAgICogZW5oYW5jZWQsIGFuZCBw\nZXJmb3JtcyBleHRyYSBmaWVsZCByZXNvbHV0aW9uIHN0ZXBzLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9SVU5USU1F\nID0gODsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzW10gRU1Q\nVFlfQ0xBU1NFUyA9IG5ldyBDbGFzc1swXTsKICAgIHByb3RlY3RlZCBzdGF0\naWMgZmluYWwgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gRU1QVFlfTk9OX1BF\nUlNJU1RFTlQgPSAKICAgIAluZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhWzBd\nOwogICAgcHJvdGVjdGVkIGZpbmFsIENsYXNzTWV0YURhdGFbXSBFTVBUWV9N\nRVRBUzsKICAgIHByb3RlY3RlZCBmaW5hbCBGaWVsZE1ldGFEYXRhW10gRU1Q\nVFlfRklFTERTOwogICAgcHJvdGVjdGVkIGZpbmFsIE9yZGVyW10gRU1QVFlf\nT1JERVJTOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoTWV0YURhdGFS\nZXBvc2l0b3J5LmNsYXNzKTsKCiAgICAvLyBzeXN0ZW0gc2VxdWVuY2UKICAg\nIHByaXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBfc3lzU2VxID0gbnVsbDsKCiAg\nICAvLyBjYWNoZSBvZiBwYXJzZWQgbWV0YWRhdGEsIG9pZCBjbGFzcyB0byBj\nbGFzcywgYW5kIGludGVyZmFjZSBjbGFzcwogICAgLy8gdG8gbWV0YWRhdGFz\nCiAgICBwcml2YXRlIGZpbmFsIE1hcCBfbWV0YXMgPSBuZXcgSGFzaE1hcCgp\nOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX29pZHMgPSBDb2xsZWN0aW9ucy5z\neW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXAoKSk7CiAgICBwcml2YXRlIGZp\nbmFsIE1hcCBfaW1wbHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAo\nbmV3IEhhc2hNYXAoKSk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfaWZhY2Vz\nID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkp\nOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX3F1ZXJpZXMgPSBuZXcgSGFzaE1h\ncCgpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX3NlcXMgPSBuZXcgSGFzaE1h\ncCgpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2FsaWFzZXMgPSBDb2xsZWN0\naW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXAoKSk7CiAgICBwcml2\nYXRlIGZpbmFsIE1hcCBfcGF3YXJlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9u\naXplZE1hcChuZXcgSGFzaE1hcCgpKTsKICAgIHByaXZhdGUgZmluYWwgTWFw\nIF9ub25NYXBwZWQgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3\nIEhhc2hNYXAoKSk7CiAgICAKICAgIC8vIG1hcCBvZiBjbGFzc2VzIHRvIGxp\nc3RzIG9mIHRoZWlyIHN1YmNsYXNzZXMKICAgIHByaXZhdGUgZmluYWwgTWFw\nIF9zdWJzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNo\nTWFwKCkpOwoKICAgIC8vIHhtbCBtYXBwaW5nCiAgICBwcm90ZWN0ZWQgZmlu\nYWwgWE1MTWV0YURhdGFbXSBFTVBUWV9YTUxNRVRBUzsKICAgIHByaXZhdGUg\nZmluYWwgTWFwIF94bWxtZXRhcyA9IG5ldyBIYXNoTWFwKCk7CgogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmYgPSBu\ndWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBf\naW1wbEdlbiA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBNZXRhRGF0\nYUZhY3RvcnkgX2ZhY3RvcnkgPSBudWxsOwoKICAgIHByaXZhdGUgaW50IF9y\nZXNNb2RlID0gTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HOwogICAgcHJpdmF0\nZSBpbnQgX3NvdXJjZU1vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcg\nfCBNT0RFX1FVRVJZOwogICAgcHJpdmF0ZSBpbnQgX3ZhbGlkYXRlID0gVkFM\nSURBVEVfTUVUQSB8IFZBTElEQVRFX1VORU5IQU5DRUQ7CgogICAgLy8gd2Ug\nYnVmZmVyIHVwIGFueSBjbGFzc2VzIHRoYXQgcmVnaXN0ZXIgdGhlbXNlbHZl\ncyB0byBwcmV2ZW50CiAgICAvLyByZWVudHJhbmN5IGVycm9ycyBpZiBjbGFz\nc2VzIHJlZ2lzdGVyIGR1cmluZyBhIGN1cnJlbnQgcGFyc2UgKGNvbW1vbikK\nICAgIHByaXZhdGUgZmluYWwgQ29sbGVjdGlvbiBfcmVnaXN0ZXJlZCA9IG5l\ndyBBcnJheUxpc3QoKTsKCiAgICAvLyBzZXQgb2YgbWV0YWRhdGFzIHdlJ3Jl\nIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAgcHJpdmF0ZSBmaW5h\nbCBTb3J0ZWRTZXQgX3Jlc29sdmluZyA9IG5ldyBUcmVlU2V0CiAgICAgICAg\nKG5ldyBNZXRhRGF0YUluaGVyaXRhbmNlQ29tcGFyYXRvcigpKTsKICAgIHBy\naXZhdGUgZmluYWwgU29ydGVkU2V0IF9tYXBwaW5nID0gbmV3IFRyZWVTZXQK\nICAgICAgICAobmV3IE1ldGFEYXRhSW5oZXJpdGFuY2VDb21wYXJhdG9yKCkp\nOwogICAgcHJpdmF0ZSBmaW5hbCBMaXN0IF9lcnJzID0gbmV3IExpbmtlZExp\nc3QoKTsKCiAgICAvLyBzeXN0ZW0gbGlzdGVuZXJzCiAgICBwcml2YXRlIExp\nZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgX2xpc3RlbmVycyA9\nCiAgICAgICAgbmV3IExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxp\nc3QoMyk7CgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLiAg\nQ29uZmlndXJlIHZpYSB7QGxpbmsgQ29uZmlndXJhYmxlfS4KICAgICAqLwog\nICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSgpIHsKICAgICAgICBFTVBU\nWV9NRVRBUyA9IG5ld0NsYXNzTWV0YURhdGFBcnJheSgwKTsKICAgICAgICBF\nTVBUWV9GSUVMRFMgPSBuZXdGaWVsZE1ldGFEYXRhQXJyYXkoMCk7CiAgICAg\nICAgRU1QVFlfT1JERVJTID0gbmV3T3JkZXJBcnJheSgwKTsKICAgICAgICBF\nTVBUWV9YTUxNRVRBUyA9IG5ld1hNTENsYXNzTWV0YURhdGFBcnJheSgwKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29uZmlndXJhdGlv\nbiBmb3IgdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIHJldHVybiBfY29uZjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbWV0YWRhdGEgbG9nLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExv\nZygpIHsKICAgICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBJL08gdXNlZCB0byBsb2FkIG1ldGFkYXRhLgogICAgICovCiAg\nICBwdWJsaWMgTWV0YURhdGFGYWN0b3J5IGdldE1ldGFEYXRhRmFjdG9yeSgp\nIHsKICAgICAgICByZXR1cm4gX2ZhY3Rvcnk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgSS9PIHVzZWQgdG8gbG9hZCBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGFGYWN0b3J5KE1ldGFEYXRhRmFj\ndG9yeSBmYWN0b3J5KSB7CiAgICAgICAgZmFjdG9yeS5zZXRSZXBvc2l0b3J5\nKHRoaXMpOwogICAgICAgIF9mYWN0b3J5ID0gZmFjdG9yeTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSB2YWxpZGF0aW9uIGxldmVsLiBE\nZWZhdWx0cyB0bwogICAgICogPGNvZGU+VkFMSURBVEVfTUVUQSB8IFZBTElE\nQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFZhbGlkYXRlKCkgewogICAgICAgIHJldHVybiBfdmFsaWRhdGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgdmFsaWRhdGlvbiBs\nZXZlbC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPlZBTElEQVRFX01FVEEg\nfCBWQUxJREFURV9VTkVOSEFOQ0VEPC9jb2RlPi4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0VmFsaWRhdGUoaW50IHZhbGlkYXRlKSB7CiAgICAgICAg\nX3ZhbGlkYXRlID0gdmFsaWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgbWV0YWRhdGEgdmFsaWRhdGlvbiBsZXZlbC4gRGVmYXVsdHMgdG8KICAg\nICAqIDxjb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9NQVBQSU5HIHwg\nVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4uCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFZhbGlkYXRlKGludCB2YWxpZGF0ZSwgYm9vbGVhbiBvbikg\newogICAgICAgIGlmICh2YWxpZGF0ZSA9PSBWQUxJREFURV9OT05FKQogICAg\nICAgICAgICBfdmFsaWRhdGUgPSB2YWxpZGF0ZTsKICAgICAgICBlbHNlIGlm\nIChvbikKICAgICAgICAgICAgX3ZhbGlkYXRlIHw9IHZhbGlkYXRlOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgX3ZhbGlkYXRlICY9IH52YWxpZGF0ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9u\nIG1vZGUuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5NT0RFX01FVEEgfCBN\nT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRpb24gbW9kZS4g\nRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQ\nUElORzwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29s\ndmUoaW50IG1vZGUpIHsKICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgcmVzb2x1dGlvbiBtb2Rl\nLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9N\nQVBQSU5HPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVz\nb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2Rl\nID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX3Jlc01vZGUgPSBtb2RlOwog\nICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBfcmVzTW9kZSB8PSBt\nb2RlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3Jlc01vZGUgJj0gfm1v\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0\nZXJtaW5pbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwog\nICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9R\nVUVSWTwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0U291cmNl\nTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3NvdXJjZU1vZGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0ZXJtaW5pbmcgd2hh\ndCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+\nTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVSWTwvY29kZT4u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1vZGUoaW50IG1v\nZGUpIHsKICAgICAgICBfc291cmNlTW9kZSA9IG1vZGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZGV0ZXJtaW5pbmcgd2hhdCBt\nZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+TU9E\nRV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVSWTwvY29kZT4uCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1vZGUoaW50IG1vZGUs\nIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05PTkUp\nCiAgICAgICAgICAgIF9zb3VyY2VNb2RlID0gbW9kZTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgX3NvdXJjZU1vZGUgfD0gbW9kZTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIF9zb3VyY2VNb2RlICY9IH5tb2RlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLgogICAgICoKICAgICAqIEBwYXJhbSBjbHMgdGhl\nIGNsYXNzIHRvIHJldHJpZXZlIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFt\nIGVudkxvYWRlciB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlm\nIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0aHJvd3Mg\nYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259CiAgICAgKiBpZiBubyBtZXRh\nZGF0YSBpcyBmb3VuZAogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVk\nIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoQ2xhc3MgY2xzLAogICAgICAg\nIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsK\nICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYKICAgICAgICAgICAgRHluYW1p\nY1BlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNs\ncykpCiAgICAgICAgICAgIGNscyA9IGNscy5nZXRTdXBlcmNsYXNzKCk7Cgog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGdldE1ldGFEYXRhSW50ZXJu\nYWwoY2xzLCBlbnZMb2FkZXIpOwogICAgICAgIGlmIChtZXRhID09IG51bGwg\nJiYgbXVzdEV4aXN0KSB7CiAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCAm\nJgogICAgICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShf\nY29uZiwgY2xzKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YS1ub3RwYyIsIGNscykpLgog\nICAgICAgICAgICAgICAgICAgIHNldEZhdGFsKGZhbHNlKTsKCiAgICAgICAg\nICAgIFNldCBwY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxz\nZSwgZW52TG9hZGVyKTsKICAgICAgICAgICAgaWYgKHBjTmFtZXMgIT0gbnVs\nbCAmJiBwY05hbWVzLnNpemUoKSA+IDApCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEtdHlw\nZXMiLAogICAgICAgICAgICAgICAgICAgIGNscywgcGNOYW1lcykpOwoKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1tZXRhIiwgY2xzKSk7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUo\nbWV0YSk7CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gYWxpYXMg\nbmFtZS4KICAgICAqCiAgICAgKiBAcGFyYW0gYWxpYXMgdGhlIGFsaWFzIHRv\nIGNsYXNzIHRvIHJldHJpZXZlIG1ldGFkYXRhIGZvcgogICAgICogQHBhcmFt\nIGVudkxvYWRlciB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIsIGlm\nIGFueQogICAgICogQHBhcmFtIG11c3RFeGlzdCBpZiB0cnVlLCB0aHJvd3Mg\nYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259CiAgICAgKiBpZiBubyBtZXRh\nZGF0YSBpcyBmb3VuZAogICAgICogQHNlZSBDbGFzc01ldGFEYXRhI2dldFR5\ncGVBbGlhcwogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YShTdHJpbmcgYWxpYXMsIENsYXNzTG9hZGVyIGVudkxvYWRlciwK\nICAgICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlmIChhbGlh\ncyA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwg\nYWxpYXMsCiAgICAgICAgICAgICAgICBfYWxpYXNlcykpOwogICAgICAgIGlm\nIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgICBwcm9jZXNzUmVnaXN0ZXJl\nZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAgICBMaXN0IGNsYXNzTGlzdCA9\nIChMaXN0KSBfYWxpYXNlcy5nZXQoYWxpYXMpOwoKICAgICAgICAvLyBtdWx0\naXBsZSBjbGFzc2VzIG1heSBoYXZlIGJlZW4gZGVmaW5lZCB3aXRoIHRoZSBz\nYW1lIGFsaWFzOiB3ZQogICAgICAgIC8vIHdpbGwgZmlsdGVyIGJ5IGNoZWNr\naW5nIGFnYWluc3QgdGhlIGN1cnJlbnQgbGlzdCBvZiB0aGUKICAgICAgICAv\nLyBwZXJzaXN0ZW50IHR5cGVzIGFuZCBmaWx0ZXIgYmFzZWQgb24gd2hpY2gg\nY2xhc3NlcyBhcmUgbG9hZGFibGUKICAgICAgICAvLyB2aWEgdGhlIGN1cnJl\nbnQgZW52aXJvbm1lbnQncyBDbGFzc0xvYWRlcgogICAgICAgIFNldCBwY05h\nbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVy\nKTsKICAgICAgICBDbGFzcyBjbHMgPSBudWxsOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBjbGFzc0xpc3QgIT0gbnVsbCAmJiBpIDwgY2xhc3NMaXN0LnNp\nemUoKTsgaSsrKSB7CiAgICAgICAgICAgIENsYXNzIGMgPSAoQ2xhc3MpIGNs\nYXNzTGlzdC5nZXQoaSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAvLyByZS1sb2FkIHRoZSBjbGFzcyBpbiB0aGUgY3VycmVudCBlbnZp\ncm9ubWVudCBsb2FkZXIgc28KICAgICAgICAgICAgICAgIC8vIHRoYXQgd2Ug\nY2FuIGhhbmRsZSByZWRlcGxveW1lbnQgb2YgdGhlIHNhbWUgY2xhc3MgbmFt\nZQogICAgICAgICAgICAgICAgQ2xhc3MgbmMgPSBDbGFzcy5mb3JOYW1lKGMu\nZ2V0TmFtZSgpLCBmYWxzZSwgZW52TG9hZGVyKTsKCiAgICAgICAgICAgICAg\nICAvLyBpZiB3ZSBoYXZlIHNwZWNpZmllZCBhIGxpc3Qgb2YgcGVyc2lzdGVu\ndCBjbGFzZXMsCiAgICAgICAgICAgICAgICAvLyBhbHNvIGNoZWNrIHRvIGVu\nc3VyZSB0aGF0IHRoZSBjbGFzcyBpcyBpbiB0aGF0IGxpc3QKICAgICAgICAg\nICAgICAgIGlmIChwY05hbWVzID09IG51bGwgfHwgcGNOYW1lcy5zaXplKCkg\nPT0gMCAKICAgICAgICAgICAgICAgICAgICB8fCBwY05hbWVzLmNvbnRhaW5z\nKG5jLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAgICAgICBjbHMgPSBu\nYzsKICAgICAgICAgICAgICAgICAgICBpZiAoIWNsYXNzTGlzdC5jb250YWlu\ncyhjbHMpKQogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0xpc3QuYWRk\nKGNscyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAg\nICAgICAgICAgICAgICAvLyB0aGlzIGhhcHBlbnMgd2hlbiB0aGUgY2xhc3Mg\naXMgbm90IGxvYWRhYmxlIGJ5CiAgICAgICAgICAgICAgICAvLyB0aGUgZW52\naXJvbm1lbnQgY2xhc3MgbG9hZGVyLCBzbyBpdCB3YXMgcHJvYmFibHkKICAg\nICAgICAgICAgICAgIC8vIGxpc3RlZCBlbHNld2hlcmU7IGFsc28gaWdub3Jl\nIGxpbmthZ2UgZmFpbHVyZXMgYW5kCiAgICAgICAgICAgICAgICAvLyBvdGhl\nciBjbGFzcyBsb2FkaW5nIHByb2JsZW1zCiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgaWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7Cgog\nICAgICAgIC8vIG1heWJlIHRoaXMgaXMgc29tZSB0eXBlIHdlJ3ZlIHNlZW4g\nYnV0IGp1c3QgaXNuJ3QgdmFsaWQKICAgICAgICBpZiAoX2FsaWFzZXMuY29u\ndGFpbnNLZXkoYWxpYXMpKSB7CiAgICAgICAgICAgIGlmIChtdXN0RXhpc3Qp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLWFsaWFzLW1ldGEiLCBhbGlhcywKICAgICAgICAgICAg\nICAgICAgICBfYWxpYXNlcy50b1N0cmluZygpKSk7CiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVjb3JkIHRoYXQg\ndGhpcyBpcyBhbiBpbnZhbGlkIHR5cGUKICAgICAgICBfYWxpYXNlcy5wdXQo\nYWxpYXMsIG51bGwpOwoKICAgICAgICBpZiAoIW11c3RFeGlzdCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsIF9h\nbGlhc2VzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBtZXRo\nb2QgdG8gZ2V0IHRoZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLCB3\naXRob3V0CiAgICAgKiByZXNvbHZpbmcgaXQuCiAgICAgKi8KICAgIHByaXZh\ndGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YUludGVybmFsKENsYXNzIGNs\ncywKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBp\nZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICAvLyBjaGVjayBjYWNoZSBmb3IgZXhpc3RpbmcgbWV0YWRhdGEsIG9y\nIGdpdmUgdXAgaWYgbm8gbWV0YWRhdGEgYW5kCiAgICAgICAgLy8gb3VyIGxp\nc3Qgb2YgY29uZmlndXJlZCBwZXJzaXN0ZW50IHR5cGVzIGRvZXNuJ3QgaW5j\nbHVkZSB0aGUgY2xhc3MKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSAo\nQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChjbHMpOwogICAgICAgIGlmICht\nZXRhICE9IG51bGwgJiYgKChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVf\nTUVUQSkgIT0gMAogICAgICAgICAgICB8fCAoX3NvdXJjZU1vZGUgJiBNT0RF\nX01FVEEpID09IDApKQogICAgICAgICAgICByZXR1cm4gbWV0YTsKCiAgICAg\nICAgLy8gaWYgcnVudGltZSwgY3V0IG9mZiBzZWFyY2ggaWYgbm90IGluIHBj\nIGxpc3QuICB3ZSBkb24ndCBkbyB0aGlzIGF0CiAgICAgICAgLy8gZGV2IHRp\nbWUgc28gdGhhdCB1c2VyIGNhbiBtYW5pcHVsYXRlIHBlcnNpc3RlbnQgY2xh\nc3NlcyBoZSdzIHdyaXRpbmcKICAgICAgICAvLyBiZWZvcmUgYWRkaW5nIHRo\nZW0gdG8gdGhlIGxpc3QKICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElE\nQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgU2V0IHBjTmFtZXMg\nPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBlbnZMb2FkZXIpOwog\nICAgICAgICAgICBpZiAocGNOYW1lcyAhPSBudWxsICYmICFwY05hbWVzLmNv\nbnRhaW5zKGNscy5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG1ldGE7CiAgICAgICAgfQoKICAgICAgICBpZiAobWV0YSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiBtYXliZSB3ZSBrbm93\nIHRoaXMgY2xhc3MgaGFzIG5vIG1ldGFkYXRhCiAgICAgICAgICAgIGlmIChf\nbWV0YXMuY29udGFpbnNLZXkoY2xzKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoaXMgaXNuJ3Qg\nYW4gb2J2aW91c2x5IGJhZCBjbGFzcwogICAgICAgICAgICBpZiAoY2xzLmlz\nUHJpbWl0aXZlKCkgfHwgY2xzLmdldE5hbWUoKS5zdGFydHNXaXRoKCJqYXZh\nLiIpCiAgICAgICAgICAgICAgICB8fCBjbHMgPT0gUGVyc2lzdGVuY2VDYXBh\nYmxlLmNsYXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgICAgICAvLyBkZXNpZ25lZCB0byBnZXQgYXJvdW5kIGppa2VzIDEuMTcg\nLyBKREsxLjUgaXNzdWUgd2hlcmUgc3RhdGljCiAgICAgICAgICAgIC8vIGlu\naXRpYWxpemVycyBhcmUgbm90IGludm9rZWQgd2hlbiBhIGNsYXNzIGlzIHJl\nZmVyZW5jZWQsIHNvIHRoZQogICAgICAgICAgICAvLyBjbGFzcyBuZXZlciBy\nZWdpc3RlcnMgaXRzZWxmIHdpdGggdGhlIHN5c3RlbQogICAgICAgICAgICBp\nZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3Mu\nZm9yTmFtZShjbHMuZ2V0TmFtZSgpLCB0cnVlLAogICAgICAgICAgICAgICAg\nICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY2xzKSkpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90IGlu\nIGNhY2hlOiBsb2FkIG1ldGFkYXRhIG9yIG1hcHBpbmdzIGRlcGVuZGluZyBv\nbiBzb3VyY2UgbW9kZS4KICAgICAgICAvLyBsb2FkaW5nIG1ldGFkYXRhIG1p\nZ2h0IGFsc28gbG9hZCBtYXBwaW5ncywgYnV0IGRvZXNuJ3QgaGF2ZSB0bwog\nICAgICAgIGludCBtb2RlID0gMDsKICAgICAgICBpZiAoKF9zb3VyY2VNb2Rl\nICYgTU9ERV9NRVRBKSAhPSAwKQogICAgICAgICAgICBtb2RlID0gX3NvdXJj\nZU1vZGUgJiB+TU9ERV9NQVBQSU5HOwogICAgICAgIGVsc2UgaWYgKChfc291\ncmNlTW9kZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAgICAgICAgICAgbW9k\nZSA9IF9zb3VyY2VNb2RlOwogICAgICAgIGlmIChtb2RlICE9IE1PREVfTk9O\nRSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgibG9hZC1jbHMi\nLCBjbHMsIHRvTW9kZVN0cmluZyhtb2RlKSkpOwogICAgICAgICAgICBfZmFj\ndG9yeS5sb2FkKGNscywgbW9kZSwgZW52TG9hZGVyKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGNoZWNrIGNhY2hlIGFnYWluCiAgICAgICAgaWYgKG1ldGEg\nPT0gbnVsbCkKICAgICAgICAgICAgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBf\nbWV0YXMuZ2V0KGNscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCAmJiAo\nKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAhPSAwCiAgICAg\nICAgICAgIHx8IChfc291cmNlTW9kZSAmIE1PREVfTUVUQSkgPT0gMCkpCiAg\nICAgICAgICAgIHJldHVybiBtZXRhOwoKICAgICAgICAvLyByZWNvcmQgdGhh\ndCB0aGlzIGNsYXNzIGhhcyBubyBtZXRhZGF0YTsgY2hlY2tpbmcgZm9yIHRo\naXMgbGF0ZXIKICAgICAgICAvLyBzcGVlZHMgdGhpbmdzIHVwIGluIGVudmly\nb25tZW50cyB3aXRoIHNsb3cgY2xhc3MgbG9hZGluZwogICAgICAgIC8vIGxp\na2UgYXBwc2VydmVycwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAg\nICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgIF9tZXRhcy5w\ndXQoY2xzLCBudWxsKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBv\nZiB0aGUgZ2l2ZW4gbW9kZSBmbGFncy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgU3RyaW5nIHRvTW9kZVN0cmluZyhpbnQgbW9kZSkgewogICAgICAg\nIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKDMxKTsKICAg\nICAgICBpZiAoKG1vZGUgJiBNT0RFX01FVEEpICE9IDApCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIltNRVRBXSIpOwogICAgICAgIGlmICgobW9kZSAmIE1P\nREVfUVVFUlkpICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltRVUVS\nWV0iKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkcpICE9IDAp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltNQVBQSU5HXSIpOwogICAgICAg\nIGlmICgobW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCJbTUFQUElOR19JTklUXSIpOwogICAgICAgIHJl\ndHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBy\nZXBhcmUgbWV0YWRhdGEgZm9yIG1hcHBpbmcgcmVzb2x1dGlvbi4gVGhpcyBt\nZXRob2QgbWlnaHQgbWFwIHBhcnRzCiAgICAgKiBvZiB0aGUgbWV0YWRhdGEg\ndGhhdCBkb24ndCByZWx5IG9uIG90aGVyIGNsYXNzZXMgYmVpbmcgbWFwcGVk\nLCBidXQgdGhhdAogICAgICogb3RoZXIgY2xhc3NlcyBtaWdodCByZWx5IG9u\nIGR1cmluZyB0aGVpciBvd24gbWFwcGluZyAoZm9yIGV4YW1wbGUsCiAgICAg\nKiBwcmltYXJ5IGtleSBmaWVsZHMpLiBCeSBkZWZhdWx0LCB0aGlzIG1ldGhv\nZCBvbmx5IGNhbGxzCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNkZWZp\nbmVTdXBlcmNsYXNzRmllbGRzfS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgcHJlcGFyZU1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgbWV0YS5kZWZpbmVTdXBlcmNsYXNzRmllbGRzKGZhbHNlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc29sdmUgdGhlIGdpdmVuIG1ldGFkYXRhIGlm\nIG5lZWRlZC4gVGhlcmUgYXJlIHRocmVlIGdvYWxzOgogICAgICogPG9sPgog\nICAgICogPGxpPk1ha2Ugc3VyZSBubyB1bnJlc29sdmVkIG1ldGFkYXRhIGdl\ndHMgYmFjayB0byB0aGUgY2xpZW50LjwvbGk+CiAgICAgKiA8bGk+QXZvaWQg\naW5maW5pdGUgcmVlbnRyYW50IGNhbGxzIGZvciBtdXR1YWxseS1kZXBlbmRl\nbnQgbWV0YWRhdGFzIGJ5CiAgICAgKiBhbGxvd2luZyB1bnJlc29sdmVkIG1l\ndGFkYXRhIHRvIGJlIHJldHVybmVkIHRvIG90aGVyIG1ldGFkYXRhcy48L2xp\nPgogICAgICogPGxpPkFsd2F5cyBtYWtlIHN1cmUgdGhlIHN1cGVyY2xhc3Mg\nbWV0YWRhdGEgaXMgcmVzb2x2ZWQgYmVmb3JlIHRoZQogICAgICogc3ViY2xh\nc3MgbWV0YWRhdGEgc28gdGhhdCB0aGUgc3ViY2xhc3MgY2FuIGFjY2VzcyB0\naGUgc3VwZXIncyBsaXN0CiAgICAgKiBvZiBmaWVsZHMuPC9saT4KICAgICAq\nIDwvb2w+IE5vdGUgdGhhdCB0aGUgY29kZSBjYWxsaW5nIHRoaXMgbWV0aG9k\nIGlzIHN5bmNocm9uaXplZCwgc28gdGhpcwogICAgICogbWV0aG9kIGRvZXNu\nJ3QgaGF2ZSB0byBiZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29s\ndmUoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgLy8gcmV0dXJuIGFu\neXRoaW5nIHRoYXQgaGFzIGl0cyBtZXRhZGF0YSByZXNvbHZlZCwgYmVjYXVz\nZSB0aGF0IG1lYW5zCiAgICAgICAgLy8gaXQgaXMgZWl0aGVyIGZ1bGx5IHJl\nc29sdmVkIG9yIG11c3QgYXQgbGVhc3QgYmUgaW4gdGhlIHByb2Nlc3Mgb2YK\nICAgICAgICAvLyByZXNvbHZpbmcgbWFwcGluZywgZXRjIHNpbmNlIHdlIGRv\nIHRoYXQgcmlnaHQgYWZ0ZXIgbWV0YSByZXNvbHZlCiAgICAgICAgaWYgKG1l\ndGEgPT0gbnVsbCB8fCBfcmVzTW9kZSA9PSBNT0RFX05PTkUKICAgICAgICAg\nICAgfHwgKG1ldGEuZ2V0UmVzb2x2ZSgpICYgTU9ERV9NRVRBKSAhPSAwKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHJlc29sdmUgbWV0YWRh\ndGEKICAgICAgICBMaXN0IHJlc29sdmVkID0gcmVzb2x2ZU1ldGEobWV0YSk7\nCiAgICAgICAgaWYgKHJlc29sdmVkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgLy8gbG9hZCBtYXBwaW5nIGRhdGEKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVkLnNpemUoKTsgaSsrKQogICAg\nICAgICAgICBsb2FkTWFwcGluZygoQ2xhc3NNZXRhRGF0YSkgcmVzb2x2ZWQu\nZ2V0KGkpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVk\nLnNpemUoKTsgaSsrKQogICAgICAgICAgICBwcmVNYXBwaW5nKChDbGFzc01l\ndGFEYXRhKSByZXNvbHZlZC5nZXQoaSkpOwoKICAgICAgICAvLyByZXNvbHZl\nIG1hcHBpbmdzCiAgICAgICAgYm9vbGVhbiBlcnIgPSB0cnVlOwogICAgICAg\nIGlmICgoX3Jlc01vZGUgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVzb2x2ZWQuc2l6ZSgpOyBpKysp\nCiAgICAgICAgICAgICAgICBlcnIgJj0gcmVzb2x2ZU1hcHBpbmcoKENsYXNz\nTWV0YURhdGEpIHJlc29sdmVkLmdldChpKSk7CgogICAgICAgIC8vIHRocm93\nIGVycm9ycyBlbmNvdW50ZXJlZAogICAgICAgIGlmIChlcnIgJiYgIV9lcnJz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBSdW50aW1lRXhjZXB0aW9uIHJl\nOwogICAgICAgICAgICBpZiAoX2VycnMuc2l6ZSgpID09IDEpCiAgICAgICAg\nICAgICAgICByZSA9IChSdW50aW1lRXhjZXB0aW9uKSBfZXJycy5nZXQoMCk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJlID0gbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZXNvbHZlLWVycnMiKSkuCiAg\nICAgICAgICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dh\nYmxlW10pIF9lcnJzLnRvQXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAg\nKG5ldyBFeGNlcHRpb25bX2VycnMuc2l6ZSgpXSkpOwogICAgICAgICAgICBf\nZXJycy5jbGVhcigpOwogICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIG1ldGFkYXRhIG1vZGUs\nIHJldHVybmluZyBsaXN0IG9mIHByb2Nlc3NlZCBtZXRhZGFkYXRhcywgb3Ig\nbnVsbAogICAgICogaWYgd2UncmUgc3RpbGwgaW4gdGhlIHByb2Nlc3Mgb2Yg\ncmVzb2x2aW5nIG90aGVyIG1ldGFkYXRhcy4KICAgICAqLwogICAgcHJpdmF0\nZSBMaXN0IHJlc29sdmVNZXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIGlmIChtZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwpIHsKICAg\nICAgICAgICAgLy8gc2V0IHN1cGVyY2xhc3MKICAgICAgICAgICAgQ2xhc3Mg\nc3VwID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cE1ldGE7CiAgICAgICAg\nICAgIHdoaWxlIChzdXAgIT0gbnVsbCAmJiBzdXAgIT0gT2JqZWN0LmNsYXNz\nKSB7CiAgICAgICAgICAgICAgICBzdXBNZXRhID0gZ2V0TWV0YURhdGEoc3Vw\nLCBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGlmIChzdXBNZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBtZXRhLnNldFBDU3VwZXJjbGFzcyhzdXApOwogICAgICAgICAgICAg\nICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNzTWV0YURhdGEoc3VwTWV0YSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBzdXAgPSBzdXAuZ2V0U3VwZXJj\nbGFzcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAg\nICAgICBDbGFzc1tdIHN1cHMgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5n\nZXRJbnRlcmZhY2VzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHN1cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAg\nICBzdXBNZXRhID0gZ2V0TWV0YURhdGEoc3Vwc1tpXSwgbWV0YS5nZXRFbnZD\nbGFzc0xvYWRlcigpLCAKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2Up\nOwogICAgICAgICAgICAgICAgICAgIGlmIChzdXBNZXRhICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Mo\nc3VwKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJhc3NpZ25lZC1zdXAiLCBtZXRhLAogICAgICAgICAgICAgICAgICAg\nIG1ldGEuZ2V0UENTdXBlcmNsYXNzKCkpKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHJlc29sdmUgcmVsYXRpb24gcHJpbWFyeSBrZXkgZmllbGRzIGZvciBt\nYXBwaW5nIGRlcGVuZGVuY2llcwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKGZtZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBn\nZXRNZXRhRGF0YShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAKICAgICAg\nICAgICAgICAgICAgICBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIGZhbHNl\nKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBtZXRhZGF0YTsgaWYgd2UncmUgbm90\nIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZwogICAgICAgIC8vIG90aGVy\ncywgdGhpcyB3aWxsIHJldHVybiB0aGUgc2V0IG9mIGludGVycmVsYXRlZCBt\nZXRhcyB0aGF0CiAgICAgICAgLy8gcmVzb2x2ZWQKICAgICAgICByZXR1cm4g\ncHJvY2Vzc0J1ZmZlcihtZXRhLCBfcmVzb2x2aW5nLCBNT0RFX01FVEEpOwog\nICAgfQoKICAgIC8qKgogICAgICogTG9hZCBtYXBwaW5nIGluZm9ybWF0aW9u\nIGZvciB0aGUgZ2l2ZW4gbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBsb2FkTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBpZiAoKG1ldGEuZ2V0UmVzb2x2ZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAw\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGxvYWQgbWFwcGlu\nZyBpbmZvcm1hdGlvbgogICAgICAgIGlmICgobWV0YS5nZXRTb3VyY2VNb2Rl\nKCkgJiBNT0RFX01BUFBJTkcpID09IDAKICAgICAgICAgICAgJiYgKF9zb3Vy\nY2VNb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwKSB7CiAgICAgICAgICAgIC8v\nIGVtYmVkZGVkLW9ubHkgbWV0YWRhdGEgZG9lc24ndCBoYXZlIG1hcHBpbmcs\nIHNvIGFsd2F5cyBsb2FkZWQKICAgICAgICAgICAgaWYgKG1ldGEuaXNFbWJl\nZGRlZE9ubHkoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9k\nZShNT0RFX01BUFBJTkcsIHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIC8vIGxvYWQgbWFwcGluZyBkYXRhCiAgICAgICAgICAg\nICAgICBpbnQgbW9kZSA9IF9zb3VyY2VNb2RlICYgfk1PREVfTUVUQTsKICAg\nICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgibG9hZC1tYXBw\naW5nIiwgbWV0YSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9Nb2RlU3Ry\naW5nKG1vZGUpKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIF9mYWN0b3J5LmxvYWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIG1vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0RW52\nQ2xhc3NMb2FkZXIoKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3Zl\nTWV0YURhdGEobWV0YSk7CiAgICAgICAgICAgICAgICAgICAgX2VycnMuYWRk\nKHJlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFByZS1tYXBwaW5nIHByZXBhcmF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJlTWFwcGluZyhDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoKG1ldGEuZ2V0UmVzb2x2\nZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIHByZXBhcmUgbWFwcGluZ3MgZm9yIHJlc29sdmU7IGlm\nIG5vdCByZXNvbHZpbmcgbWFwcGluZ3MsIHRoZW4KICAgICAgICAvLyBtYWtl\nIHN1cmUgYW55IHN1cGVyY2xhc3MgZmllbGRzIGRlZmluZWQgaW4gbWV0YWRh\ndGEgYXJlIHJlc29sdmVkCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKChfcmVzTW9kZSAmIE1PREVfTUFQUElORykgIT0gMCkgewogICAgICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcmVwLW1hcHBpbmciLCBt\nZXRhKSk7CiAgICAgICAgICAgICAgICBwcmVwYXJlTWFwcGluZyhtZXRhKTsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBtZXRhLmRlZmlu\nZVN1cGVyY2xhc3NGaWVsZHMoZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgcmVtb3ZlTWV0YURh\ndGEobWV0YSk7CiAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBhbmQgaW5pdGlhbGl6\nZSBtYXBwaW5nLgogICAgICoKICAgICAqIEByZXR1cm4gZmFsc2UgaWYgd2Un\ncmUgc3RpbGwgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5nIG1hcHBpbmdz\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiByZXNvbHZlTWFwcGluZyhD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBMaXN0IG1hcHBlZCA9IHBy\nb2Nlc3NCdWZmZXIobWV0YSwgX21hcHBpbmcsIE1PREVfTUFQUElORyk7CiAg\nICAgICAgaWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIGluaXRpYWxpemUgbWFwcGluZyBmb3IgcnVu\ndGltZSB1c2UKICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5H\nX0lOSVQpICE9IDApIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBtYXBwZWQuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIG1ldGEg\nPSAoQ2xhc3NNZXRhRGF0YSkgbWFwcGVkLmdldChpKTsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5yZXNvbHZlKE1P\nREVfTUFQUElOR19JTklUKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICByZW1v\ndmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBfZXJycy5h\nZGQocmUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAg\nICogUHJvY2VzcyB0aGUgZ2l2ZW4gbWV0YWRhdGEgYW5kIHRoZSBhc3NvY2lh\ndGVkIGJ1ZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0IHByb2Nlc3NC\ndWZmZXIoQ2xhc3NNZXRhRGF0YSBtZXRhLCBTb3J0ZWRTZXQgYnVmZmVyLCBp\nbnQgbW9kZSkgewogICAgICAgIC8vIGlmIHdlJ3JlIGFscmVhZHkgcHJvY2Vz\nc2luZyBhIG1ldGFkYXRhLCBqdXN0IGJ1ZmZlciB0aGlzIG9uZTsgd2hlbgog\nICAgICAgIC8vIHRoZSBpbml0aWFsIG1ldGFkYXRhIGZpbmlzaGVzIHByb2Nl\nc3NpbmcsIHdlIHRyYXZlcnNlIHRoZSBidWZmZXIKICAgICAgICAvLyBhbmQg\ncHJvY2VzcyBhbGwgdGhlIG90aGVycyB0aGF0IHdlcmUgaW50cm9kdWNlZCBk\ndXJpbmcgcmVlbnRyYW50CiAgICAgICAgLy8gY2FsbHMKICAgICAgICBpZiAo\nIWJ1ZmZlci5hZGQobWV0YSkgfHwgYnVmZmVyLnNpemUoKSAhPSAxKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY29udGludWFsbHkg\ncG9wIGEgbWV0YWRhdGEgYW5kIHByb2Nlc3MgaXQgdW50aWwgd2UgcnVuIG91\ndDsgbm90ZQogICAgICAgIC8vIHRoYXQgZWFjaCBwcm9jZXNzaW5nIGNhbGwg\nbWlnaHQgcGxhY2UgbW9yZSBtZXRhcyBpbiB0aGUgYnVmZmVyIGFzCiAgICAg\nICAgLy8gb25lIGNsYXNzIHRyaWVzIHRvIGFjY2VzcyBtZXRhZGF0YSBmb3Ig\nYW5vdGhlcjsgYWxzbyBub3RlIHRoYXQgdGhlCiAgICAgICAgLy8gYnVmZmVy\nIG9yZGVycyBpdHNlbGYgZnJvbSBsZWFzdCB0byBtb3N0IGRlcml2ZWQKICAg\nICAgICBDbGFzc01ldGFEYXRhIGJ1ZmZlcmVkOwogICAgICAgIExpc3QgcHJv\nY2Vzc2VkID0gbmV3IEFycmF5TGlzdCg1KTsKICAgICAgICB3aGlsZSAoIWJ1\nZmZlci5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYnVmZmVyZWQgPSAoQ2xh\nc3NNZXRhRGF0YSkgYnVmZmVyLmZpcnN0KCk7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBidWZmZXJlZC5yZXNvbHZlKG1vZGUpOwogICAg\nICAgICAgICAgICAgcHJvY2Vzc2VkLmFkZChidWZmZXJlZCk7CiAgICAgICAg\nICAgICAgICBidWZmZXIucmVtb3ZlKGJ1ZmZlcmVkKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgX2VycnMuYWRkKHJlKTsKCiAgICAgICAgICAgICAgICAvLyBhbnkgZXhj\nZXB0aW9uIGR1cmluZyByZXNvbHV0aW9uIG9mIG9uZSB0eXBlIG1lYW5zIHdl\nIGNhbid0CiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGFueSBvZiB0aGUg\ncmVsYXRlZCB0eXBlcywgc28gY2xlYXIgYnVmZmVyLiAgdGhpcyBhbHNvCiAg\nICAgICAgICAgICAgICAvLyBlbnN1cmVzIHRoYXQgaWYgdHdvIHR5cGVzIHJl\nbGF0ZSB0byBlYWNoIG90aGVyIGFuZCBvbmUKICAgICAgICAgICAgICAgIC8v\nIGRpZXMsIHdlIGRvbid0IGdldCBpbnRvIGluZmluaXRlIGN5Y2xlcwogICAg\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBidWZmZXIuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBt\nZXRhID0gKENsYXNzTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICAgICAgcmVtb3ZlTWV0YURhdGEobWV0YSk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKG1ldGEgIT0gYnVmZmVyZWQpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgX2VycnMuYWRkKG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJwcmV2LWVycnMi\nLCBtZXRhLCBidWZmZXJlZCkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBidWZmZXIuY2xlYXIo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJv\nY2Vzc2VkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCB0aGUg\nbWV0YWRhdGEgaW5zdGFuY2VzIGN1cnJlbnRseSBpbiB0aGUgcmVwb3NpdG9y\neS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBDbGFzc01ldGFE\nYXRhW10gZ2V0TWV0YURhdGFzKCkgewogICAgICAgIC8vIHByZXZlbnQgY29u\nY3VycmVudCBtb2QgZXJyb3JzIHdoZW4gcmVzb2x2aW5nIG9uZSBtZXRhZGF0\nYQogICAgICAgIC8vIGludHJvZHVjZXMgb3RoZXJzCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YVtdIG1ldGFzID0gKENsYXNzTWV0YURhdGFbXSkgX21ldGFzLnZh\nbHVlcygpLgogICAgICAgICAgICB0b0FycmF5KG5ldyBDbGFzc01ldGFEYXRh\nW19tZXRhcy5zaXplKCldKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAobWV0YXNbaV0g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG1ldGFzW2ld\nLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBtZXRh\nc1tpXS5nZXRFbnZDbGFzc0xvYWRlcigpLCB0cnVlKTsKCiAgICAgICAgTGlz\ndCByZXNvbHZlZCA9IG5ldyBBcnJheUxpc3QoX21ldGFzLnNpemUoKSk7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX21ldGFzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJlc29sdmVkLmFkZChtZXRhKTsKICAgICAgICB9CiAg\nICAgICAgbWV0YXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSByZXNvbHZlZC50b0Fy\ncmF5CiAgICAgICAgICAgIChuZXdDbGFzc01ldGFEYXRhQXJyYXkocmVzb2x2\nZWQuc2l6ZSgpKSk7CiAgICAgICAgQXJyYXlzLnNvcnQobWV0YXMpOwogICAg\nICAgIHJldHVybiBtZXRhczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY2FjaGVkIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIHdp\ndGhvdXQgYW55IHJlc29sdXRpb24uCiAgICAgKiBSZXR1cm4gbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRDYWNo\nZWRNZXRhRGF0YShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gKENsYXNz\nTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdp\ndGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvCiAgICAgKiB0aGUg\ncmVwb3NpdG9yeSwgYW5kIHJldHVybiBpdC4gVXNlIHRoZSBkZWZhdWx0IGFj\nY2VzcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBh\nZGRNZXRhRGF0YShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gYWRkTWV0\nYURhdGEoY2xzLCBDbGFzc01ldGFEYXRhLkFDQ0VTU19VTktOT1dOKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9w\ndWxhdGUgaXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8K\nICAgICAqIHRoZSByZXBvc2l0b3J5LCBhbmQgcmV0dXJuIGl0LgogICAgICoK\nICAgICAqIEBwYXJhbSBhY2Nlc3MgdGhlIGFjY2VzcyB0eXBlIHRvIHVzZSBp\nbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzIGNscywgaW50IGFjY2Vzcykg\newogICAgICAgIGlmIChjbHMgPT0gbnVsbCB8fCBjbHMuaXNQcmltaXRpdmUo\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IG5ld0NsYXNzTWV0YURhdGEoY2xzKTsKICAgICAgICBf\nZmFjdG9yeS5nZXREZWZhdWx0cygpLnBvcHVsYXRlKG1ldGEsIGFjY2Vzcyk7\nCgogICAgICAgIC8vIHN5bmNocm9uaXplIG9uIHRoaXMgcmF0aGVyIHRoYW4g\ndGhlIG1hcCwgYmVjYXVzZSBhbGwgb3RoZXIgbWV0aG9kcwogICAgICAgIC8v\nIHRoYXQgYWNjZXNzIF9tZXRhcyBhcmUgc3luY2hyb25pemVkIG9uIHRoaXMK\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYg\nKF9wYXdhcmVzLmNvbnRhaW5zS2V5KGNscykpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInBjLWFuZC1h\nd2FyZSIsIGNscykpOwogICAgICAgICAgICBfbWV0YXMucHV0KGNscywgbWV0\nYSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjbGFzcyBtZXRhZGF0YSBp\nbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEg\nbmV3Q2xhc3NNZXRhRGF0YShDbGFzcyB0eXBlKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBDbGFzc01ldGFEYXRhKHR5cGUsIHRoaXMpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IGFycmF5IG9mIHRoZSBwcm9wZXIgY2xh\nc3MgbWV0YWRhdGEgc3ViY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBD\nbGFzc01ldGFEYXRhW10gbmV3Q2xhc3NNZXRhRGF0YUFycmF5KGludCBsZW5n\ndGgpIHsKICAgICAgICByZXR1cm4gbmV3IENsYXNzTWV0YURhdGFbbGVuZ3Ro\nXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBmaWVsZCBt\nZXRhZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxk\nTWV0YURhdGEgbmV3RmllbGRNZXRhRGF0YShTdHJpbmcgbmFtZSwgQ2xhc3Mg\ndHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG93bmVyKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBGaWVsZE1ldGFEYXRhKG5hbWUsIHR5cGUsIG93bmVyKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0\naGUgcHJvcGVyIGZpZWxkIG1ldGFkYXRhIHN1YmNsYXNzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgRmllbGRNZXRhRGF0YVtdIG5ld0ZpZWxkTWV0YURhdGFB\ncnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZE1l\ndGFEYXRhW2xlbmd0aF07CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBuZXcgYXJyYXkgb2YgdGhlIHByb3BlciB4bWwgY2xhc3MgbWV0YWRhdGEg\nc3ViY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBYTUxNZXRhRGF0YVtd\nIG5ld1hNTENsYXNzTWV0YURhdGFBcnJheShpbnQgbGVuZ3RoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBYTUxDbGFzc01ldGFEYXRhW2xlbmd0aF07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgZW1iZWRkZWQgY2xhc3Mg\nbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhIG5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShWYWx1ZU1ldGFE\nYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01ldGFEYXRh\nKG93bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB2\nYWx1ZSBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFZhbHVlTWV0YURhdGEgbmV3VmFsdWVNZXRhRGF0YShGaWVsZE1ldGFEYXRh\nIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1ldGFEYXRhSW1w\nbChvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4ge0Bs\naW5rIE9yZGVyfSBmb3IgdGhlIGdpdmVuIGZpZWxkIGFuZCBkZWNsYXJhdGlv\nbi4gVGhpcwogICAgICogbWV0aG9kIGRlbGVnYXRlcyB0byB7QGxpbmsgI25l\nd1JlbGF0ZWRGaWVsZE9yZGVyfSBhbmQKICAgICAqIHtAbGluayAjbmV3VmFs\ndWVGaWVsZE9yZGVyfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0\nZWQgT3JkZXIgbmV3T3JkZXIoRmllbGRNZXRhRGF0YSBvd25lciwgU3RyaW5n\nIG5hbWUsIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgLy8gcGF0aHMgY2FuIHN0\nYXJ0IHdpdGggKG9yIGVxdWFsKSAnI2VsZW1lbnQnCiAgICAgICAgaWYgKG5h\nbWUuc3RhcnRzV2l0aChPcmRlci5FTEVNRU5UKSkKICAgICAgICAgICAgbmFt\nZSA9IG5hbWUuc3Vic3RyaW5nKE9yZGVyLkVMRU1FTlQubGVuZ3RoKCkpOwog\nICAgICAgIGlmIChuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJl\ndHVybiBuZXdWYWx1ZU9yZGVyKG93bmVyLCBhc2MpOwoKICAgICAgICAvLyBu\nZXh0IHRva2VuIHNob3VsZCBiZSAnLicKICAgICAgICBpZiAobmFtZS5jaGFy\nQXQoMCkgPT0gJy4nKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoMSk7CgogICAgICAgIC8vIHJlbGF0ZWQgZmllbGQKICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGEgPSBvd25lci5nZXRFbGVtZW50KCkuZ2V0VHlwZU1l\ndGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub25w\nYy1maWVsZC1vcmRlcmFibGUiLAogICAgICAgICAgICAgICAgb3duZXIsIG5h\nbWUpKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIHJlbCA9IG1ldGEuZ2V0Rmll\nbGQobmFtZSk7CiAgICAgICAgaWYgKHJlbCA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1m\naWVsZC1vcmRlcmFibGUiLAogICAgICAgICAgICAgICAgb3duZXIsIG5hbWUp\nKTsKICAgICAgICByZXR1cm4gbmV3UmVsYXRlZEZpZWxkT3JkZXIob3duZXIs\nIHJlbCwgYXNjKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9yZGVyIGJ5IHRo\nZSBmaWVsZCB2YWx1ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVyIG5l\nd1ZhbHVlT3JkZXIoRmllbGRNZXRhRGF0YSBvd25lciwgYm9vbGVhbiBhc2Mp\nIHsKICAgICAgICByZXR1cm4gbmV3IEluTWVtb3J5VmFsdWVPcmRlcihhc2Ms\nIGdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBP\ncmRlciBieSBhIGZpZWxkIG9mIHRoZSByZWxhdGVkIHR5cGUuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBPcmRlciBuZXdSZWxhdGVkRmllbGRPcmRlcihGaWVs\nZE1ldGFEYXRhIG93bmVyLAogICAgICAgIEZpZWxkTWV0YURhdGEgcmVsLCBi\nb29sZWFuIGFzYykgewogICAgICAgIHJldHVybiBuZXcgSW5NZW1vcnlSZWxh\ndGVkRmllbGRPcmRlcihyZWwsIGFzYywgZ2V0Q29uZmlndXJhdGlvbigpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiBhcnJheSBvZiBvcmRl\ncnMgb2YgdGhlIGdpdmVuIHNpemUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBP\ncmRlcltdIG5ld09yZGVyQXJyYXkoaW50IHNpemUpIHsKICAgICAgICByZXR1\ncm4gbmV3IE9yZGVyW3NpemVdOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIGEgbWV0YWRhdGEgaW5zdGFuY2UgZnJvbSB0aGUgcmVwb3NpdG9yeS4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2Ug\naWYgbm90IGluIHRoaXMgcmVwb3NpdG9yeQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhKG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSBhIG1ldGFkYXRhIGluc3RhbmNlIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAg\nICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQsIGZhbHNlIGlm\nIG5vdCBpbiB0aGlzIHJlcG9zaXRvcnkKICAgICAqLwogICAgcHVibGljIHN5\nbmNocm9uaXplZCBib29sZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNzIGNscykg\newogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGlmIChfbWV0YXMucmVtb3ZlKGNscykgIT0gbnVs\nbCkgewogICAgICAgICAgICBDbGFzcyBpbXBsID0gKENsYXNzKSBfaWZhY2Vz\nLnJlbW92ZShjbHMpOwogICAgICAgICAgICBpZiAoaW1wbCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX21ldGFzLnJlbW92ZShpbXBsKTsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gbWV0YWRh\ndGEgYXMgZGVjbGFyZWQgaW50ZXJmYWNlIGltcGxlbWVudGF0aW9uLgogICAg\nICovCiAgICB2b2lkIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1wbChDbGFzc01l\ndGFEYXRhIG1ldGEsIENsYXNzIGlmYWNlKSB7CiAgICAgICAgc3luY2hyb25p\nemVkIChfaW1wbHMpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiB2YWxzID0g\nKENvbGxlY3Rpb24pIF9pbXBscy5nZXQoaWZhY2UpOwogICAgICAgICAgICAK\nICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBzdXBlcmNsYXNz\nIGFscmVhZHkgZGVjbGFyZXMgdG8gYXZvaWQgZHVwcwogICAgICAgICAgICBp\nZiAodmFscyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIHN1cCA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgIGZvciAoOyBzdXAgIT0gbnVsbDsgc3VwID0gc3VwLmdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpCiAgICAgICAgICAgICAgICAgICAg\naWYgKHZhbHMuY29udGFpbnMoc3VwLmdldERlc2NyaWJlZFR5cGUoKSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2ltcGxzLCBpZmFjZSwgbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksIGZhbHNlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGltcGxlbWVudGF0aW9uIGZvciB0\naGUgZ2l2ZW4gbWFuYWdlZCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHN5bmNo\ncm9uaXplZCB2b2lkIHNldEludGVyZmFjZUltcGwoQ2xhc3NNZXRhRGF0YSBt\nZXRhLCBDbGFzcyBpbXBsKSB7CiAgICAgICAgaWYgKCFtZXRhLmlzTWFuYWdl\nZEludGVyZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2VkLWludGVyZmFjZSIsIAog\nICAgICAgICAgICAgICAgbWV0YSwgaW1wbCkpOwogICAgICAgIF9pZmFjZXMu\ncHV0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBpbXBsKTsKICAgICAgICBf\nbWV0YXMucHV0KGltcGwsIG1ldGEpOwogICAgICAgIGFkZERlY2xhcmVkSW50\nZXJmYWNlSW1wbChtZXRhLCBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIHJlY29yZCBzdXBlcmNsYXNzIGludGVyZmFjZSBpbmZv\nIHdoaWxlIHdlIGNhbiBhcyB3ZWxsIGFzIHdlCiAgICAgICAgICAgIC8vIHdp\nbGwgb25seSByZWdpc3RlciBjb25jcmV0ZSBzdXBlcmNsYXNzIGluIFBDUmVn\naXN0cnkKICAgICAgICAgICAgc3VwLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwog\nICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIHN1cC5nZXREZXNj\ncmliZWRUeXBlKCksIGltcGwsIHRydWUpOwogICAgICAgICAgICBzdXAgPSAo\nQ2xhc3NNZXRhRGF0YSkgc3VwLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICBzeW5jaHJvbml6ZWQgSW50ZXJm\nYWNlSW1wbEdlbmVyYXRvciBnZXRJbXBsR2VuZXJhdG9yKCkgewogICAgICAg\nIGlmIChfaW1wbEdlbiA9PSBudWxsKQogICAgICAgICAgICBfaW1wbEdlbiA9\nIG5ldyBJbnRlcmZhY2VJbXBsR2VuZXJhdG9yKHRoaXMpOwogICAgICAgIHJl\ndHVybiBfaW1wbEdlbjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbGVhc3QtZGVyaXZlZCBjbGFzcyBtZXRhZGF0YSBmb3IgdGhlIGdpdmVu\nIGFwcGxpY2F0aW9uCiAgICAgKiBpZGVudGl0eSBvYmplY3QuCiAgICAgKgog\nICAgICogQHBhcmFtIG9pZCB0aGUgb2lkIHRvIGdldCB0aGUgbWV0YWRhdGEg\nZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRoZSBlbnZpcm9ubWVudGFs\nIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVzdEV4aXN0\nIGlmIHRydWUsIHRocm93cyBhIHtAbGluayBNZXRhRGF0YUV4Y2VwdGlvbn0K\nICAgICAqIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKE9iamVjdCBvaWQsIENs\nYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tb2lkLW1ldGEiLCBvaWQsICI/IiwKICAgICAgICAgICAgICAgIF9v\naWRzLnRvU3RyaW5nKCkpKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAob2lkIGluc3Rh\nbmNlb2YgT3BlbkpQQUlkKSB7CiAgICAgICAgICAgIENsYXNzIGNscyA9ICgo\nT3BlbkpQQUlkKSBvaWQpLmdldFR5cGUoKTsKICAgICAgICAgICAgcmV0dXJu\nIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgICBwcm9jZXNz\nUmVnaXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAgICBDbGFzcyBj\nbHMgPSAoQ2xhc3MpIF9vaWRzLmdldChvaWQuZ2V0Q2xhc3MoKSk7CiAgICAg\nICAgaWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0TWV0\nYURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CgogICAgICAgIC8v\nIG1heWJlIHRoaXMgaXMgc29tZSB0eXBlIHdlJ3ZlIHNlZW4gYnV0IGp1c3Qg\naXNuJ3QgdmFsaWQKICAgICAgICBpZiAoX29pZHMuY29udGFpbnNLZXkob2lk\nLmdldENsYXNzKCkpKSB7CiAgICAgICAgICAgIGlmIChtdXN0RXhpc3QpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLW9pZC1tZXRhIiwgb2lkLAogICAgICAgICAgICAgICAgICAg\nIG9pZC5nZXRDbGFzcygpLCBfb2lkcykpOwogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHN0aWxsIG5vdCBtYXRj\naCwgcmVnaXN0ZXIgYW55IGNsYXNzZXMgdGhhdCBsb29rIHNpbWlsYXIgdG8g\ndGhlCiAgICAgICAgLy8gb2lkIGNsYXNzIGFuZCBjaGVjayBhZ2FpbgogICAg\nICAgIHJlc29sdmVJZGVudGl0eUNsYXNzKG9pZCk7CiAgICAgICAgaWYgKHBy\nb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpLmxlbmd0aCA+IDAp\nIHsKICAgICAgICAgICAgY2xzID0gKENsYXNzKSBfb2lkcy5nZXQob2lkLmdl\ndENsYXNzKCkpOwogICAgICAgICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIs\nIG11c3RFeGlzdCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWNvcmQgdGhh\ndCB0aGlzIGlzIGFuIGludmFsaWQgdHlwZQogICAgICAgIF9vaWRzLnB1dChv\naWQuZ2V0Q2xhc3MoKSwgbnVsbCk7CgogICAgICAgIGlmICghbXVzdEV4aXN0\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW9pZC1tZXRhIiwgb2lk\nLAogICAgICAgICAgICBvaWQuZ2V0Q2xhc3MoKSwgX29pZHMpKS5zZXRGYWls\nZWRPYmplY3Qob2lkKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc29t\nZSBndWVzc2VzIGFib3V0IHRoZSBuYW1lIG9mIGEgdGFyZ2V0IGNsYXNzIGZv\nciBhbgogICAgICogdW5rbm93biBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVJZGVudGl0eUNs\nYXNzKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3Mgb2lkQ2xhc3MgPSBv\naWQuZ2V0Q2xhc3MoKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJyZXNvbHZl\nLWlkZW50aXR5Iiwgb2lkQ2xhc3MpKTsKCiAgICAgICAgQ2xhc3NMb2FkZXIg\nY2wgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRl\nckFjdGlvbihvaWRDbGFzcykpOyAKICAgICAgICBTdHJpbmcgY2xhc3NOYW1l\nOwogICAgICAgIHdoaWxlIChvaWRDbGFzcyAhPSBudWxsICYmIG9pZENsYXNz\nICE9IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICBjbGFzc05hbWUgPSBv\naWRDbGFzcy5nZXROYW1lKCk7CgogICAgICAgICAgICAvLyB3ZSB0YWtlIGEg\nYnJ1dGUtZm9yY2UgYXBwcm9hY2g6IHRyeSB0byBsb2FkIGFsbCB0aGUgY2xh\nc3MnCiAgICAgICAgICAgIC8vIHN1YnN0cmluZ3MuIHRoaXMgd2lsbCBoYW5k\nbGUgdGhlIGZvbGxvd2luZyBjb21tb24gbmFtaW5nIGNhc2VzOgogICAgICAg\nICAgICAvLwogICAgICAgICAgICAvLyAgIGNvbS5jb21wYW55Lk15Q2xhc3Mk\nSUQJLT4gY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAvLyAgIGNv\nbS5jb21wYW55Lk15Q2xhc3NJZAktPiBjb20uY29tcGFueS5NeUNsYXNzCiAg\nICAgICAgICAgIC8vICAgY29tLmNvbXBhbnkuTXlDbGFzc09pZAktPiBjb20u\nY29tcGFueS5NeUNsYXNzCiAgICAgICAgICAgIC8vICAgY29tLmNvbXBhbnku\nTXlDbGFzc1BLCS0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAgICAg\nLy8KICAgICAgICAgICAgLy8gdGhpcyBpc24ndCB0aGUgZmFzdGVzdCB0aGlu\nZyBwb3NzaWJsZSwgYnV0IHRoaXMgbWV0aG9kIHdpbGwKICAgICAgICAgICAg\nLy8gb25seSBiZSBjYWxsZWQgb25jZSBwZXIgSlZNIHBlciB1bmtub3duIGFw\ncCBpZCBjbGFzcwogICAgICAgICAgICBmb3IgKGludCBpID0gY2xhc3NOYW1l\nLmxlbmd0aCgpOyBpID4gMTsgaS0tKSB7CiAgICAgICAgICAgICAgICBpZiAo\nY2xhc3NOYW1lLmNoYXJBdChpIC0gMSkgPT0gJy4nKQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShjbGFzc05hbWUuc3Vic3RyaW5n\nKDAsIGkpLCB0cnVlLCBjbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfSAvLyBjb25zdW1lIGFs\nbCBleGNlcHRpb25zCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1v\ndmUgdXAgdGhlIE9JRCBoaWVyYXJjaHkKICAgICAgICAgICAgb2lkQ2xhc3Mg\nPSBvaWRDbGFzcy5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBsZWFzdC1kZXJpdmVkIG1ldGFk\nYXRhcyB3aXRoIHNvbWUgbWFwcGVkIGFzc2lnbmFibGUgdHlwZSB0aGF0CiAg\nICAgKiBpbXBsZW1lbnQgdGhlIGdpdmVuIGNsYXNzLgogICAgICoKICAgICAq\nIEBwYXJhbSBjbHMgdGhlIGNsYXNzIG9yIGludGVyZmFjZSB0byByZXRyaWV2\nZSBpbXBsZW1lbnRvcnMgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRo\nZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBA\ncGFyYW0gbXVzdEV4aXN0IGlmIHRydWUsIHRocm93cyBhIHtAbGluayBNZXRh\nRGF0YUV4Y2VwdGlvbn0KICAgICAqIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5k\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0SW1wbGVt\nZW50b3JNZXRhRGF0YXMoQ2xhc3MgY2xzLAogICAgICAgIENsYXNzTG9hZGVy\nIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBpZiAo\nY2xzID09IG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEiLCBjbHMp\nKTsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBFTVBUWV9NRVRBUzsKCiAgICAgICAgLy8gZ2V0IGltcGxzIG9mIGdpdmVu\nIGludGVyZmFjZSAvIGFic3RyYWN0IGNsYXNzCiAgICAgICAgbG9hZFJlZ2lz\ndGVyZWRDbGFzc01ldGFEYXRhKGVudkxvYWRlcik7CiAgICAgICAgQ29sbGVj\ndGlvbiB2YWxzID0gKENvbGxlY3Rpb24pIF9pbXBscy5nZXQoY2xzKTsKICAg\nICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgQ29sbGVjdGlvbiBt\nYXBwZWQgPSBudWxsOwogICAgICAgIGlmICh2YWxzICE9IG51bGwpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh2YWxzKSB7CiAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHZhbHMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBtZXRhID0gZ2V0TWV0\nYURhdGEoKENsYXNzKSBpdHIubmV4dCgpLCBlbnZMb2FkZXIsIHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChtZXRhLmlzTWFwcGVkKCkKICAgICAg\nICAgICAgICAgICAgICAgICAgfHwgbWV0YS5nZXRNYXBwZWRQQ1N1YmNsYXNz\nTWV0YURhdGFzKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAobWFwcGVkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBtYXBwZWQgPSBuZXcgQXJyYXlMaXN0KHZhbHMuc2l6ZSgpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGVkLmFkZChtZXRhKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChtYXBwZWQgPT0gbnVsbCAm\nJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm8tbWV0YSIsIGNscykpOwogICAgICAgIGlm\nIChtYXBwZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX01F\nVEFTOwogICAgICAgIHJldHVybiAoQ2xhc3NNZXRhRGF0YVtdKSBtYXBwZWQu\ndG9BcnJheShuZXdDbGFzc01ldGFEYXRhQXJyYXkKICAgICAgICAgICAgKG1h\ncHBlZC5zaXplKCkpKTsKICAgIH0KICAgICAKICAgIC8qKgogICAgICogR2V0\ncyB0aGUgbWV0YWRhdGEgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gcGVy\nc2lzdGVuY2UtYXdhcmUgY2xhc3MuIAogICAgICogUmV0dXJucyBudWxsLCBp\nZiB0aGUgZ2l2ZW4gY2xhc3MgaXMgbm90IHJlZ2lzdGVyZWQgYXMgCiAgICAg\nKiBwZXJzaXN0ZW5jZS1hd2FyZS4KICAgICAqLwogICAgcHVibGljIE5vblBl\ncnNpc3RlbnRNZXRhRGF0YSBnZXRQZXJzaXN0ZW5jZUF3YXJlKENsYXNzIGNs\ncykgewogICAgCXJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKV9wYXdh\ncmVzLmdldChjbHMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldHMg\nYWxsIHRoZSBtZXRhZGF0YXMgZm9yIHBlcnNpc3RlbmNlLWF3YXJlIGNsYXNz\nZXMKICAgICAqIAogICAgICogQHJldHVybiBlbXB0eSBhcnJheSBpZiBubyBj\nbGFzcyBoYXMgYmVlbiByZWdpc3RlcmVkIGFzIHBlcnMtYXdhcmUKICAgICAq\nLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdIGdldFBlcnNp\nc3RlbmNlQXdhcmVzKCkgewogICAgICAgIHN5bmNocm9uaXplZCAoX3Bhd2Fy\nZXMpIHsKICAgICAgICAgICAgaWYgKF9wYXdhcmVzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBFTVBUWV9OT05fUEVSU0lTVEVOVDsKICAg\nICAgICAgICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGFbXSlfcGF3\nYXJlcy52YWx1ZXMoKS50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IE5v\nblBlcnNpc3RlbnRNZXRhRGF0YVtfcGF3YXJlcy5zaXplKCldKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNsYXNz\nIGFzIHBlcnNpc3RlbmNlLWF3YXJlLgogICAgICogCiAgICAgKiBAcGFyYW0g\nY2xzIG5vbi1udWxsIGFuZCBtdXN0IG5vdCBhbHJlYWRkeSBiZSBhZGRlZCBh\ncyBwZXJzaXRlbmNlLWNhcGFibGUKICAgICAqLwogICAgcHVibGljIE5vblBl\ncnNpc3RlbnRNZXRhRGF0YSBhZGRQZXJzaXN0ZW5jZUF3YXJlKENsYXNzIGNs\ncykgewogICAgCWlmIChjbHMgPT0gbnVsbCkKICAgIAkJcmV0dXJuIG51bGw7\nCiAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAgICAgaWYg\nKF9wYXdhcmVzLmNvbnRhaW5zS2V5KGNscykpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSlfcGF3YXJlcy5nZXQoY2xz\nKTsKICAgICAgICAgICAgaWYgKGdldENhY2hlZE1ldGFEYXRhKGNscykgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgicGMtYW5kLWF3YXJlIiwgY2xzKSk7CiAgICAgICAg\nICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBtZXRhID0gbmV3IE5vblBlcnNp\nc3RlbnRNZXRhRGF0YShjbHMsIHRoaXMsCiAgICAgICAgICAgICAgICBOb25Q\nZXJzaXN0ZW50TWV0YURhdGEuVFlQRV9QRVJTSVNURU5DRV9BV0FSRSk7CiAg\nICAgICAgICAgIF9wYXdhcmVzLnB1dChjbHMsIG1ldGEpOwogICAgICAgICAg\nICByZXR1cm4gbWV0YTsKICAgIAl9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYSBwZXJzaXRlbmNlLWF3YXJlIGNsYXNzIGZyb20gdGhlIHJlcG9z\naXRvcnkKICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQK\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlUGVyc2lzdGVuY2VB\nd2FyZShDbGFzcyBjbHMpIHsKICAgIAlyZXR1cm4gX3Bhd2FyZXMucmVtb3Zl\nKGNscykgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhl\nIG1ldGFkYXRhIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIG5vbi1tYXBw\nZWQgaW50ZXJmYWNlLgogICAgICogUmV0dXJucyBudWxsLCBpZiB0aGUgZ2l2\nZW4gaW50ZXJmYWNlIGlzIG5vdCByZWdpc3RlcmVkIGFzIAogICAgICogcGVy\nc2lzdGVuY2UtYXdhcmUuCiAgICAgKi8KICAgIHB1YmxpYyBOb25QZXJzaXN0\nZW50TWV0YURhdGEgZ2V0Tm9uTWFwcGVkSW50ZXJmYWNlKENsYXNzIGlmYWNl\nKSB7CiAgICAJcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGEpX25vbk1h\ncHBlZC5nZXQoaWZhY2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdl\ndHMgdGhlIGNvcnJlc3BvbmRpbmcgbWV0YWRhdGFzIGZvciBhbGwgcmVnaXN0\nZXJlZCwgbm9uLW1hcHBlZAogICAgICogaW50ZXJmYWNlcwogICAgICogCiAg\nICAgKiBAcmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIG5vbi1tYXBwZWQgaW50\nZXJmYWNlIGhhcyBiZWVuIHJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBOb25QZXJzaXN0ZW50TWV0YURhdGFbXSBnZXROb25NYXBwZWRJbnRlcmZh\nY2VzKCkgewogICAgICAgIHN5bmNocm9uaXplZCAoX25vbk1hcHBlZCkgewog\nICAgICAgICAgICBpZiAoX25vbk1hcHBlZC5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gRU1QVFlfTk9OX1BFUlNJU1RFTlQ7CiAgICAgICAg\nICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhW10pX25vbk1hcHBl\nZC52YWx1ZXMoKS50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IE5vblBl\ncnNpc3RlbnRNZXRhRGF0YVtfbm9uTWFwcGVkLnNpemUoKV0pOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gbm9uLW1h\ncHBlZCBpbnRlcmZhY2UgdG8gdGhlIHJlcG9zaXRvcnkuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBpZmFjZSB0aGUgbm9uLW1hcHBlZCBpbnRlcmZhY2UKICAg\nICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBhZGROb25N\nYXBwZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgIAlpZiAoaWZhY2Ug\nPT0gbnVsbCkKICAgIAkJcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFpZmFj\nZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1ub24tbWFwcGVkIiwgaWZhY2Up\nKTsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICBp\nZiAoX25vbk1hcHBlZC5jb250YWluc0tleShpZmFjZSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSlfbm9uTWFwcGVk\nLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChnZXRDYWNoZWRNZXRhRGF0\nYShpZmFjZSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm9uLW1hcHBlZC1wYyIsIGlm\nYWNlKSk7CiAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBtZXRh\nID0gbmV3IE5vblBlcnNpc3RlbnRNZXRhRGF0YShpZmFjZSwgdGhpcywKICAg\nICAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YS5UWVBFX05PTl9N\nQVBQRURfSU5URVJGQUNFKTsKICAgICAgICAgICAgX25vbk1hcHBlZC5wdXQo\naWZhY2UsIG1ldGEpOwogICAgICAgICAgICByZXR1cm4gbWV0YTsKICAgIAl9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBub24tbWFwcGVkIGlu\ndGVyZmFjZSBmcm9tIHRoZSByZXBvc2l0b3J5CiAgICAgKiAKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiByZW1vdmVkCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIHJlbW92ZU5vbk1hcHBlZEludGVyZmFjZShDbGFzcyBpZmFjZSkgewog\nICAgCXJldHVybiBfbm9uTWFwcGVkLnJlbW92ZShpZmFjZSkgIT0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIHRoZSBjYWNoZSBvZiBwYXJz\nZWQgbWV0YWRhdGEuIFRoaXMgbWV0aG9kIGFsc28gY2xlYXJzIHRoZQogICAg\nICogaW50ZXJuYWwge0BsaW5rIE1ldGFEYXRhRmFjdG9yeSBNZXRhRGF0YUZh\nY3Rvcnl9J3MgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6\nZWQgdm9pZCBjbGVhcigpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJjbGVh\nci1yZXBvcyIsIHRoaXMpKTsKCiAgICAgICAgX21ldGFzLmNsZWFyKCk7CiAg\nICAgICAgX29pZHMuY2xlYXIoKTsKICAgICAgICBfc3Vicy5jbGVhcigpOwog\nICAgICAgIF9pbXBscy5jbGVhcigpOwogICAgICAgIF9xdWVyaWVzLmNsZWFy\nKCk7CiAgICAgICAgX3NlcXMuY2xlYXIoKTsKICAgICAgICBfcmVnaXN0ZXJl\nZC5jbGVhcigpOwogICAgICAgIF9mYWN0b3J5LmNsZWFyKCk7CiAgICAgICAg\nX2FsaWFzZXMuY2xlYXIoKTsKICAgICAgICBfcGF3YXJlcy5jbGVhcigpOwog\nICAgICAgIF9ub25NYXBwZWQuY2xlYXIoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgc2V0IG9mIGNvbmZpZ3VyZWQgcGVyc2lzdGVudCBj\nbGFzc2VzLCBvciBudWxsIGlmIHRoZSB1c2VyCiAgICAgKiBkaWQgbm90IGNv\nbmZpZ3VyZSBhbnkuCiAgICAgKgogICAgICogQHBhcmFtIGRldnBhdGggaWYg\ndHJ1ZSwgc2VhcmNoIGZvciBtZXRhZGF0YSBmaWxlcyBpbiBkaXJlY3Rvcmll\ncwogICAgICogaW4gdGhlIGNsYXNzcGF0aCBpZiBubyBjbGFzc2VzIGFyZSBj\nb25maWd1cmVkIGV4cGxpY2l0bHkKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIg\ndGhlIGNsYXNzIGxvYWRlciB0byB1c2UsIG9yIG51bGwgZm9yIGRlZmF1bHQK\nICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBTZXQgZ2V0UGVyc2lz\ndGVudFR5cGVOYW1lcyhib29sZWFuIGRldnBhdGgsCiAgICAgICAgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5Lmdl\ndFBlcnNpc3RlbnRUeXBlTmFtZXMoZGV2cGF0aCwgZW52TG9hZGVyKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIHBlcnNpc3RlbnQgY2xhc3Nl\ncyBuYW1lZCBpbiBjb25maWd1cmF0aW9uLgogICAgICogVGhpcyBlbnN1cmVz\nIHRoYXQgYWxsIHN1YmNsYXNzZXMgYW5kIGFwcGxpY2F0aW9uIGlkZW50aXR5\nIGNsYXNzZXMgb2YKICAgICAqIGVhY2ggdHlwZSBhcmUga25vd24gaW4gYWR2\nYW5jZSwgd2l0aG91dCBoYXZpbmcgdG8gcmVseSBvbiB0aGUKICAgICAqIGFw\ncGxpY2F0aW9uIGxvYWRpbmcgdGhlIGNsYXNzZXMgYmVmb3JlIHBlcmZvcm1p\nbmcgb3BlcmF0aW9ucyB0aGF0CiAgICAgKiBtaWdodCBpbnZvbHZlIHRoZW0u\nCiAgICAgKgogICAgICogQHBhcmFtIGRldnBhdGggaWYgdHJ1ZSwgc2VhcmNo\nIGZvciBtZXRhZGF0YSBmaWxlcyBpbiBkaXJlY3RvcmllcwogICAgICogaW4g\ndGhlIGNsYXNzcGF0aCBpZiB0aGUgbm8gY2xhc3NlcyBhcmUgY29uZmlndXJl\nZCBleHBsaWNpdGx5CiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRoZSBjbGFz\ncyBsb2FkZXIgdG8gdXNlLCBvciBudWxsIGZvciBkZWZhdWx0CiAgICAgKiBA\ncmV0dXJuIHRoZSBsb2FkZWQgY2xhc3Nlcywgb3IgZW1wdHkgY29sbGVjdGlv\nbiBpZiBub25lCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgQ29s\nbGVjdGlvbiBsb2FkUGVyc2lzdGVudFR5cGVzKGJvb2xlYW4gZGV2cGF0aCwK\nICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBTZXQg\nbmFtZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGRldnBhdGgsIGVudkxv\nYWRlcik7CiAgICAgICAgaWYgKG5hbWVzID09IG51bGwgfHwgbmFtZXMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlf\nTElTVDsKCiAgICAgICAgLy8gYXR0ZW1wdCB0byBsb2FkIGNsYXNzZXMgc28g\ndGhhdCB0aGV5IGdldCBwcm9jZXNzZWQKICAgICAgICBDbGFzc0xvYWRlciBj\nbHNMb2FkZXIgPSBfY29uZi5nZXRDbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4K\nICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoZ2V0Q2xhc3MoKSwgZW52TG9h\nZGVyKTsKICAgICAgICBMaXN0IGNsYXNzZXMgPSBuZXcgQXJyYXlMaXN0KG5h\nbWVzLnNpemUoKSk7CiAgICAgICAgQ2xhc3MgY2xzOwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gbmFtZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgY2xzID0gY2xhc3NGb3JOYW1lKChTdHJpbmcp\nIGl0ci5uZXh0KCksIGNsc0xvYWRlcik7CiAgICAgICAgICAgIGlmIChjbHMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNsYXNzZXMuYWRkKGNscyk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBjbGFzc2VzOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBjbGFzcyBmb3IgdGhlIGdpdmVuIG5hbWUs\nIG9yIG51bGwgaWYgbm90IGxvYWRhYmxlLgogICAgICovCiAgICBwcml2YXRl\nIENsYXNzIGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIg\nbG9hZGVyKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENs\nYXNzLmZvck5hbWUobmFtZSwgdHJ1ZSwgbG9hZGVyKTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoKF92YWxpZGF0\nZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5h\nbWUpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfbG9nLmlzSW5mb0VuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgiYmFk\nLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSkpOwogICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFj\nZShlKTsKICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFcnJvciBuc21l\nKSB7CiAgICAgICAgICAgIGlmIChuc21lLmdldE1lc3NhZ2UoKS5pbmRleE9m\nKCIucGMiKSA9PSAtMSkKICAgICAgICAgICAgICAgIHRocm93IG5zbWU7Cgog\nICAgICAgICAgICAvLyBpZiB0aGUgZXJyb3IgaXMgYWJvdXQgYSBtZXRob2Qg\ndGhhdCB1c2VzIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICAgICAg\nLy8gJ3BjJyBtZXRob2QgcHJlZml4LCBwZXJmb3JtIHNvbWUgbG9nZ2luZyBh\nbmQgY29udGludWUuIFRoaXMKICAgICAgICAgICAgLy8gcHJvYmFibHkganVz\ndCBtZWFucyB0aGF0IHRoZSBjbGFzcyBpcyBub3QgeWV0IGVuaGFuY2VkLgog\nICAgICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUp\nICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQo\nImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5hbWUpKTsKICAgICAgICAgICAgfSBl\nbHNlIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIF9sb2cuaW5mbyhfbG9jLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFt\nZSkpOwogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShuc21lKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYWxsIGtub3duIHN1YmNsYXNzZXMgZm9yIHRoZSBnaXZlbiBjbGFzcyBt\nYXBwaW5nLiBOb3RlCiAgICAgKiB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgd29y\na3MgZHVyaW5nIHJ1bnRpbWUgd2hlbiB0aGUgcmVwb3NpdG9yeSBpcwogICAg\nICogcmVnaXN0ZXJlZCBhcyBhIHtAbGluayBSZWdpc3RlckNsYXNzTGlzdGVu\nZXJ9LgogICAgICovCiAgICBDb2xsZWN0aW9uIGdldFBDU3ViY2xhc3NlcyhD\nbGFzcyBjbHMpIHsKICAgICAgICBDb2xsZWN0aW9uIHN1YnMgPSAoQ29sbGVj\ndGlvbikgX3N1YnMuZ2V0KGNscyk7CiAgICAgICAgaWYgKHN1YnMgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nCiAgICAgICAgcmV0dXJuIHN1YnM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVnaXN0ZXJD\nbGFzc0xpc3RlbmVyIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQg\ncmVnaXN0ZXIoQ2xhc3MgY2xzKSB7CiAgICAgICAgLy8gYnVmZmVyIHJlZ2lz\ndGVyZWQgY2xhc3NlcyB1bnRpbCBhbiBvaWQgbWV0YWRhdGEgcmVxdWVzdCBp\ncyBtYWRlLAogICAgICAgIC8vIGF0IHdoaWNoIHBvaW50IHdlJ2xsIHBhcnNl\nIGV2ZXJ5dGhpbmcgaW4gdGhlIGJ1ZmZlcgogICAgICAgIHN5bmNocm9uaXpl\nZCAoX3JlZ2lzdGVyZWQpIHsKICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRk\nKGNscyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Vz\nIHRoZSBtZXRhZGF0YSBmb3IgYWxsIHJlZ2lzdGVyZWQgY2xhc3Nlcy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRh\nRGF0YShDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBDbGFzc1td\nIHJlZyA9IHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0\nYShyZWdbaV0sIGVudkxvYWRlciwgZmFsc2UpOwogICAgICAgICAgICB9IGNh\ndGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBtZSkgewogICAgICAgICAgICAgICAg\naWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nIF9sb2cud2FybihtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVcGRhdGVzIG91ciBkYXRhc3RydWN0dXJlcyB3\naXRoIHRoZSBsYXRlc3QgcmVnaXN0ZXJlZCBjbGFzc2VzLgogICAgICovCiAg\nICBDbGFzc1tdIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAoX3JlZ2lzdGVyZWQuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfQ0xBU1NFUzsKCiAgICAg\nICAgLy8gY29weSBpbnRvIG5ldyBjb2xsZWN0aW9uIHRvIGF2b2lkIGNvbmN1\ncnJlbnQgbW9kIGVycm9ycyBvbiByZWVudHJhbnQKICAgICAgICAvLyByZWdp\nc3RyYXRpb25zCiAgICAgICAgQ2xhc3NbXSByZWc7CiAgICAgICAgc3luY2hy\nb25pemVkIChfcmVnaXN0ZXJlZCkgewogICAgICAgICAgICByZWcgPSAoQ2xh\nc3NbXSkgX3JlZ2lzdGVyZWQudG9BcnJheShuZXcgQ2xhc3NbX3JlZ2lzdGVy\nZWQuc2l6ZSgpXSk7CiAgICAgICAgICAgIF9yZWdpc3RlcmVkLmNsZWFyKCk7\nCiAgICAgICAgfQoKICAgICAgICBDb2xsZWN0aW9uIHBjTmFtZXMgPSBnZXRQ\nZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBlbnZMb2FkZXIpOwogICAgICAg\nIENvbGxlY3Rpb24gZmFpbGVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHJlZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBk\nb24ndCBwcm9jZXNzIHR5cGVzIHRoYXQgYXJlbid0IGxpc3RlZCBieSB0aGUg\ndXNlcjsgbWF5IGJlbG9uZwogICAgICAgICAgICAvLyB0byBhIGRpZmZlcmVu\ndCBwZXJzaXN0ZW5jZSB1bml0CiAgICAgICAgICAgIGlmIChwY05hbWVzICE9\nIG51bGwgJiYgIXBjTmFtZXMuaXNFbXB0eSgpCiAgICAgICAgICAgICAgICAm\nJiAhcGNOYW1lcy5jb250YWlucyhyZWdbaV0uZ2V0TmFtZSgpKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3MocmVnW2ldKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAg\nICAgIGlmICghX2NvbmYuZ2V0UmV0cnlDbGFzc1JlZ2lzdHJhdGlvbigpKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiZXJyb3ItcmVnaXN0ZXJlZCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJlZ1tpXSksIHQpOwoKICAgICAgICAgICAgICAgIGlmIChf\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoImZhaWxlZC1yZWdpc3RlcmVkIiwgcmVnW2ldKSwg\ndCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgZmFpbGVkID0gbmV3IEFycmF5TGlzdCgpOwogICAg\nICAgICAgICAgICAgZmFpbGVkLmFkZChyZWdbaV0pOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCkgewogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKF9yZWdpc3RlcmVkKSB7CiAgICAgICAg\nICAgICAgICBfcmVnaXN0ZXJlZC5hZGRBbGwoZmFpbGVkKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVnOwogICAgfQoKICAg\nIC8qKgogICAgICogVXBkYXRlcyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0\naGUgZ2l2ZW4gcmVnaXN0ZXJlZCBjbGFzcy4KICAgICAqIFJlbGllcyBvbiB0\naGUgZmFjdCB0aGF0IGEgY2hpbGQgY2xhc3MgY2Fubm90IHJlZ2lzdGVyIGl0\nc2VsZiB3aXRob3V0CiAgICAgKiBhbHNvIHJlZ2lzdGVyaW5nIGl0cyBwYXJl\nbnQgY2xhc3MgYnkgc3BlY2lmeWluZyBpdHMgcGVyc2lzdGVuY2UKICAgICAq\nIGNhcGFibGUgc3VwZXJjbGFzcyBpbiB0aGUgcmVnaXN0cmF0aW9uIGV2ZW50\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1JlZ2lzdGVyZWRD\nbGFzcyhDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcm9j\nZXNzLXJlZ2lzdGVyZWQiLCBjbHMpKTsKCiAgICAgICAgLy8gdXBkYXRlIHN1\nYmNsYXNzIGxpc3RzOyBzeW5jaHJvbml6ZSBvbiB0aGlzIGJlY2F1c2UgYWNj\nZXNzaW5nIF9tZXRhcwogICAgICAgIC8vIHJlcXVpcmVzIGl0CiAgICAgICAg\nQ2xhc3MgbGVhc3REZXJpdmVkID0gY2xzOwogICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAg\nICAgICAgICAgIGZvciAoQ2xhc3MgYW5jID0gY2xzOwogICAgICAgICAgICAg\nICAgKGFuYyA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3Mo\nYW5jKSkgIT0gbnVsbDspIHsKICAgICAgICAgICAgICAgIGFkZFRvQ29sbGVj\ndGlvbihfc3VicywgYW5jLCBjbHMsIHRydWUpOwogICAgICAgICAgICAgICAg\nbWV0YSA9IChDbGFzc01ldGFEYXRhKSBfbWV0YXMuZ2V0KGFuYyk7CiAgICAg\nICAgICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIG1ldGEuY2xlYXJTdWJjbGFzc0NhY2hlKCk7CiAgICAgICAgICAgICAg\nICBsZWFzdERlcml2ZWQgPSBhbmM7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIHVwZGF0ZSBvaWQgbWFwcGluZ3MgaWYgdGhpcyBpcyBh\nIGJhc2UgY29uY3JldGUgY2xhc3MKICAgICAgICBPYmplY3Qgb2lkID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBvaWQgPSBQQ1JlZ2lzdHJ5\nLm5ld09iamVjdElkKGNscyk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJuYWxF\neGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgLy8gdGhyb3duIGZvciBzaW5n\nbGUgZmllbGQgaWRlbnRpdHkgd2l0aCBudWxsIHBrIGZpZWxkIHZhbHVlCiAg\nICAgICAgfQogICAgICAgIGlmIChvaWQgIT0gbnVsbCkgewogICAgICAgICAg\nICBDbGFzcyBleGlzdGluZyA9IChDbGFzcykgX29pZHMuZ2V0KG9pZC5nZXRD\nbGFzcygpKTsKICAgICAgICAgICAgaWYgKGV4aXN0aW5nICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBjbGFz\ncyBmb3IgdGhpcyBPSUQsIHRoZW4gd2Uga25vdwogICAgICAgICAgICAgICAg\nLy8gdGhhdCBtdWx0aXBsZSBjbGFzc2VzIGFyZSB1c2luZyB0aGUgc2FtZSBP\nSUQ6IHRoZXJlZm9yZSwKICAgICAgICAgICAgICAgIC8vIHB1dCB0aGUgbGVh\nc3QgZGVyaXZlZCBQQyBzdXBlcmNsYXNzIGludG8gdGhlIG1hcC4gVGhpcwog\nICAgICAgICAgICAgICAgLy8gZ2V0cyBhcm91bmQgdGhlIHByb2JsZW0gb2Yg\nYW4gYWJzdHJhY3QgUEMgc3VwZXJjbGFzcwogICAgICAgICAgICAgICAgLy8g\ndXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkgKHNpbmNlIG5ld09iamVjdElk\nCiAgICAgICAgICAgICAgICAvLyB3aWxsIHJldHVybiBudWxsIGZvciBhYnN0\ncmFjdCBjbGFzc2VzKS4KICAgICAgICAgICAgICAgIENsYXNzIHN1cCA9IGNs\nczsKICAgICAgICAgICAgICAgIHdoaWxlIChQQ1JlZ2lzdHJ5LmdldFBlcnNp\nc3RlbnRTdXBlcmNsYXNzKHN1cCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBzdXAgPSBQQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNz\nKHN1cCk7CgogICAgICAgICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFz\ncygpLCBzdXApOwogICAgICAgICAgICB9IGVsc2UgaWYgKGV4aXN0aW5nID09\nIG51bGwgfHwgY2xzLmlzQXNzaWduYWJsZUZyb20oZXhpc3RpbmcpKQogICAg\nICAgICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBjbHMpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gdXBkYXRlIG1hcHBpbmdzIGZyb20gaW50\nZXJmYWNlcyBhbmQgbm9uLXBjIHN1cGVyY2xhc3NlcyB0bwogICAgICAgIC8v\nIHBjIGltcGxlbWVudGluZyB0eXBlcwogICAgICAgIHN5bmNocm9uaXplZCAo\nX2ltcGxzKSB7CiAgICAgICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVhc3RE\nZXJpdmVkLCBjbHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gc2V0IGFsaWFz\nIGZvciBjbGFzcwogICAgICAgIFN0cmluZyBhbGlhcyA9IFBDUmVnaXN0cnku\nZ2V0VHlwZUFsaWFzKGNscyk7CiAgICAgICAgaWYgKGFsaWFzICE9IG51bGwp\nIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIChfYWxpYXNlcykgewogICAg\nICAgICAgICAgICAgTGlzdCBjbGFzc0xpc3QgPSAoTGlzdCkgX2FsaWFzZXMu\nZ2V0KGFsaWFzKTsKICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTGlzdCA9IG5ldyBB\ncnJheUxpc3QoMyk7CiAgICAgICAgICAgICAgICAgICAgX2FsaWFzZXMucHV0\nKGFsaWFzLCBjbGFzc0xpc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaWYgKCFjbGFzc0xpc3QuY29udGFpbnMoY2xzKSkKICAgICAg\nICAgICAgICAgICAgICBjbGFzc0xpc3QuYWRkKGNscyk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhl\nIGxpc3Qgb2YgaW1wbGVtZW50YXRpb25zIG9mIGJhc2UgY2xhc3NlcyBhbmQg\naW50ZXJmYWNlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUlt\ncGxzKENsYXNzIGNscywgQ2xhc3MgbGVhc3REZXJpdmVkLCBDbGFzcyBjaGVj\naykgewogICAgICAgIC8vIGFsbG93IHVzZXJzIHRvIHF1ZXJ5IG9uIGNvbW1v\nbiBub24tcGMgc3VwZXJjbGFzc2VzCiAgICAgICAgQ2xhc3Mgc3VwID0gY2hl\nY2suZ2V0U3VwZXJjbGFzcygpOwogICAgICAgIGlmIChsZWFzdERlcml2ZWQg\nPT0gY2xzICYmIHN1cCAhPSBudWxsICYmIHN1cCAhPSBPYmplY3QuY2xhc3Mp\nIHsKICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9uKF9pbXBscywgc3VwLCBj\nbHMsIGZhbHNlKTsKICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFz\ndERlcml2ZWQsIHN1cCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhbGxvdyB1\nc2VycyB0byBxdWVyeSBvbiBhbnkgaW1wbGVtZW50ZWQgaW50ZXJmYWNlcyB1\nbmxlc3MgZGVmYXVsdHMgCiAgICAgICAgLy8gc2F5IHRoZSB1c2VyIG11c3Qg\naW1wbGVtZW50IHBlcnNpc3RlbnQgaW50ZXJmYWNlcyBleHBsaWNpdGx5IGlu\nIG1ldGEKICAgICAgICBpZiAoIV9mYWN0b3J5LmdldERlZmF1bHRzKCkuaXNE\nZWNsYXJlZEludGVyZmFjZVBlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIENsYXNzW10gaW50cyA9IGNoZWNrLmdldEludGVyZmFj\nZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGludHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbWFwIGphdmEtc3RhbmRh\ncmQgaW50ZXJmYWNlcwogICAgICAgICAgICBpZiAoaW50c1tpXS5nZXROYW1l\nKCkuc3RhcnRzV2l0aCgiamF2YS4iKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgLy8gb25seSBtYXAgbGVhc3QtZGVyaXZlZCBp\nbnRlcmZhY2UgaW1wbGVtZW50b3JzCiAgICAgICAgICAgIGlmIChsZWFzdERl\ncml2ZWQgPT0gY2xzIHx8IGlzTGVhc3REZXJpdmVkSW1wbChpbnRzW2ldLCBj\nbHMpKSB7CiAgICAgICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2ltcGxz\nLCBpbnRzW2ldLCBjbHMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHVwZGF0\nZUltcGxzKGNscywgbGVhc3REZXJpdmVkLCBpbnRzW2ldKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\ncnVlIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyB0aGUgbGVhc3QtZGVyaXZlZCBw\nZXJzaXN0ZW50CiAgICAgKiBpbXBsZW1lbnRvciBvZiB0aGUgZ2l2ZW4gaW50\nZXJmYWNlLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBpc0xlYXN0RGVyaXZlZEltcGwoQ2xhc3MgaW50ZXIsIENsYXNz\nIGNscykgewogICAgICAgIENsYXNzIHBhcmVudCA9IFBDUmVnaXN0cnkuZ2V0\nUGVyc2lzdGVudFN1cGVyY2xhc3MoY2xzKTsKICAgICAgICB3aGlsZSAocGFy\nZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKEFycmF5cy5hc0xpc3Qo\ncGFyZW50LmdldEludGVyZmFjZXMoKSkuY29udGFpbnMoaW50ZXIpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBwYXJlbnQg\nPSBQQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHBhcmVudCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgY29sbGVjdGlv\nbiBjYWNoZWQgaW4gdGhlIGdpdmVuIG1hcCB1bmRlcgogICAgICogdGhlIGdp\ndmVuIGtleS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFRvQ29sbGVj\ndGlvbihNYXAgbWFwLCBDbGFzcyBrZXksIENsYXNzIHZhbHVlLAogICAgICAg\nIGJvb2xlYW4gaW5oZXJpdGFuY2UpIHsKICAgICAgICBzeW5jaHJvbml6ZWQg\nKG1hcCkgewogICAgICAgICAgICBDb2xsZWN0aW9uIGNvbGwgPSAoQ29sbGVj\ndGlvbikgbWFwLmdldChrZXkpOwogICAgICAgICAgICBpZiAoY29sbCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5oZXJpdGFuY2UpIHsKICAg\nICAgICAgICAgICAgICAgICBJbmhlcml0YW5jZUNvbXBhcmF0b3IgY29tcCA9\nIG5ldyBJbmhlcml0YW5jZUNvbXBhcmF0b3IoKTsKICAgICAgICAgICAgICAg\nICAgICBjb21wLnNldEJhc2Uoa2V5KTsKICAgICAgICAgICAgICAgICAgICBj\nb2xsID0gbmV3IFRyZWVTZXQoY29tcCk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICBjb2xsID0gbmV3IExpbmtlZExpc3Qo\nKTsKICAgICAgICAgICAgICAgIG1hcC5wdXQoa2V5LCBjb2xsKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBjb2xsLmFkZCh2YWx1ZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIENvbmZpZ3VyYWJsZSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNl\ndENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\nX2NvbmYgPSAoT3BlbkpQQUNvbmZpZ3VyYXRpb24pIGNvbmY7CiAgICAgICAg\nX2xvZyA9IF9jb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0df\nTUVUQURBVEEpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmln\ndXJhdGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIGluaXRpYWxpemVNZXRhRGF0YUZhY3Rvcnko\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5pdGlhbGl6ZU1ldGFEYXRh\nRmFjdG9yeSgpIHsKICAgICAgICBpZiAoX2ZhY3RvcnkgPT0gbnVsbCkgewog\nICAgICAgICAgICBNZXRhRGF0YUZhY3RvcnkgbWRmID0gX2NvbmYubmV3TWV0\nYURhdGFGYWN0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKG1kZiA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhZGF0YWZhY3RvcnkiKSk7CiAgICAg\nICAgICAgIHNldE1ldGFEYXRhRmFjdG9yeShtZGYpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFF1ZXJ5IG1ldGFk\nYXRhCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJl\ndHVybiBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLCBuYW1l\nLCBhbmQgY2xhc3Nsb2FkZXIuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJv\nbml6ZWQgUXVlcnlNZXRhRGF0YSBnZXRRdWVyeU1ldGFEYXRhKENsYXNzIGNs\ncywgU3RyaW5nIG5hbWUsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVy\nLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIFF1ZXJ5TWV0YURhdGEg\nbWV0YSA9IGdldFF1ZXJ5TWV0YURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVu\ndkxvYWRlcik7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBsb2FkIGFsbCB0aGUgbWV0YWRhdGFzIGZvciBhbGwgdGhlIGtu\nb3duIGNsYXNzZXMgc28gdGhhdAogICAgICAgICAgICAvLyBxdWVyeSBuYW1l\ncyBhcmUgc2VlbiBhbmQgcmVnaXN0ZXJlZAogICAgICAgICAgICByZXNvbHZl\nQWxsKGVudkxvYWRlcik7CiAgICAgICAgICAgIG1ldGEgPSBnZXRRdWVyeU1l\ndGFEYXRhSW50ZXJuYWwoY2xzLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpIHsK\nICAgICAgICAgICAgaWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQKICAgICAg\nICAgICAgICAgICAgICAoIm5vLW5hbWVkLXF1ZXJ5LW51bGwtY2xhc3MiLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyhmYWxzZSwgZW52TG9hZGVyKSwgbmFtZSkpOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1xdWVyeSIsCiAgICAgICAgICAgICAg\nICAgICAgY2xzLCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKiAKICAgICAqIFJl\nc29sdmUgYWxsIGtub3duIG1ldGFkYXRhIGNsYXNzZXMuIAogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcmVzb2x2ZUFsbChDbGFzc0xvYWRlciBlbnZMb2Fk\nZXIpIHsKICAgICAgICBDb2xsZWN0aW9uIHR5cGVzID0gbG9hZFBlcnNpc3Rl\nbnRUeXBlcyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGkgPSB0eXBlcy5pdGVyYXRvcigpOyBpLmhhc05leHQoKTsgKSB7CiAg\nICAgICAgICAgIENsYXNzIGMgPSAoQ2xhc3MpIGkubmV4dCgpOwogICAgICAg\nICAgICBnZXRNZXRhRGF0YShjLCBlbnZMb2FkZXIsIGZhbHNlKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gcXVlcnkgbWV0YWRh\ndGEgZm9yIHRoZSBnaXZlbiBjbGFzcywgbmFtZSwgYW5kIGNsYXNzbG9hZGVy\nLgogICAgICovCiAgICBwcml2YXRlIFF1ZXJ5TWV0YURhdGEgZ2V0UXVlcnlN\nZXRhRGF0YUludGVybmFsKENsYXNzIGNscywgU3RyaW5nIG5hbWUsCiAgICAg\nICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKG5hbWUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8v\nIGNoZWNrIGNhY2hlCiAgICAgICAgT2JqZWN0IGtleSA9IGdldFF1ZXJ5S2V5\nKGNscywgbmFtZSk7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBxbSA9IChRdWVy\neU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoa2V5KTsKICAgICAgICBpZiAocW0g\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHFtOwoKICAgICAgICAvLyBn\nZXQgbWV0YWRhdGEgZm9yIGNsYXNzLCB3aGljaCB3aWxsIGZpbmQgcXVlcmll\ncyBpbiBtZXRhZGF0YSBmaWxlCiAgICAgICAgaWYgKGNscyAhPSBudWxsICYm\nIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBmYWxzZSkgIT0gbnVsbCkg\newogICAgICAgICAgICBxbSA9IChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5n\nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKHFtICE9IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gcW07CiAgICAgICAgfQogICAgICAgIGlmICgoX3Nv\ndXJjZU1vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgLy8gc2VlIGlmIGZhY3RvcnkgY2FuIGZpZ3Vy\nZSBvdXQgYSBzY29wZSBmb3IgdGhpcyBxdWVyeQogICAgICAgIGlmIChjbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gX2ZhY3RvcnkuZ2V0UXVlcnlT\nY29wZShuYW1lLCBlbnZMb2FkZXIpOwoKICAgICAgICAvLyBub3QgaW4gY2Fj\naGU7IGxvYWQKICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywgTU9ERV9RVUVS\nWSwgZW52TG9hZGVyKTsKICAgICAgICByZXR1cm4gKFF1ZXJ5TWV0YURhdGEp\nIF9xdWVyaWVzLmdldChrZXkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBjYWNoZWQgcXVlcnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1\nYmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlNZXRhRGF0YVtdIGdldFF1ZXJ5TWV0\nYURhdGFzKCkgewogICAgICAgIHJldHVybiAoUXVlcnlNZXRhRGF0YVtdKSBf\ncXVlcmllcy52YWx1ZXMoKS50b0FycmF5CiAgICAgICAgICAgIChuZXcgUXVl\ncnlNZXRhRGF0YVtfcXVlcmllcy5zaXplKCldKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhIGZvciB0\naGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXpl\nZCBRdWVyeU1ldGFEYXRhIGdldENhY2hlZFF1ZXJ5TWV0YURhdGEoQ2xhc3Mg\nY2xzLAogICAgICAgIFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChR\ndWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoZ2V0UXVlcnlLZXkoY2xzLCBu\nYW1lKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgcXVlcnkg\nbWV0YWRhdGEgdG8gdGhlIHJlcG9zaXRvcnkgYW5kIHJldHVybiBpdC4KICAg\nICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBRdWVyeU1ldGFEYXRhIGFk\nZFF1ZXJ5TWV0YURhdGEoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSkgewogICAg\nICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IG5ld1F1ZXJ5TWV0YURhdGEoY2xz\nLCBuYW1lKTsKICAgICAgICBfcXVlcmllcy5wdXQoZ2V0UXVlcnlLZXkobWV0\nYSksIG1ldGEpOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IHF1ZXJ5IG1ldGFkYXRhIGluc3RhbmNl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgUXVlcnlNZXRhRGF0YSBuZXdRdWVy\neU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBR\ndWVyeU1ldGFEYXRhIG1ldGEgPSBuZXcgUXVlcnlNZXRhRGF0YShuYW1lKTsK\nICAgICAgICBtZXRhLnNldERlZmluaW5nVHlwZShjbHMpOwogICAgICAgIHJl\ndHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBn\naXZlbiBxdWVyeSBtZXRhZGF0YSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAg\nICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlUXVl\ncnlNZXRhRGF0YShRdWVyeU1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAo\nbWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShtZXRhKSkg\nIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBxdWVyeSBt\nZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzIG5hbWUgaWYgaW4gdGhlIHJl\ncG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9v\nbGVhbiByZW1vdmVRdWVyeU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShn\nZXRRdWVyeUtleShjbHMsIG5hbWUpKSAhPSBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgdW5pcXVlIGtleSBmb3IgYSBnaXZlbiBRdWVy\neU1ldGFEYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qg\nZ2V0UXVlcnlLZXkoUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYg\nKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIGdldFF1ZXJ5S2V5KG1ldGEuZ2V0RGVmaW5pbmdUeXBlKCks\nIG1ldGEuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHVuaXF1ZSBrZXkgZm9yIGEgZ2l2ZW4gY2xhc3MgLyBuYW1lLiBUaGUg\nY2xhc3MKICAgICAqIGFyZ3VtZW50IGNhbiBiZSBudWxsLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgc3RhdGljIE9iamVjdCBnZXRRdWVyeUtleShDbGFzcyBj\nbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICBRdWVyeUtleSBrZXkg\nPSBuZXcgUXVlcnlLZXkoKTsKICAgICAgICBrZXkuY2xzTmFtZSA9IGNscy5n\nZXROYW1lKCk7CiAgICAgICAga2V5Lm5hbWUgPSBuYW1lOwogICAgICAgIHJl\ndHVybiBrZXk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBTZXF1ZW5jZSBtZXRhZGF0YQogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gc2VxdWVuY2UgbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBuYW1lIGFuZCBjbGFzc2xvYWRlci4KICAgICAqLwog\nICAgcHVibGljIHN5bmNocm9uaXplZCBTZXF1ZW5jZU1ldGFEYXRhIGdldFNl\ncXVlbmNlTWV0YURhdGEoU3RyaW5nIG5hbWUsCiAgICAgICAgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIFNl\ncXVlbmNlTWV0YURhdGEgbWV0YSA9IGdldFNlcXVlbmNlTWV0YURhdGFJbnRl\ncm5hbChuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIGlmIChtZXRhID09IG51\nbGwgJiYgU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTS5lcXVhbHMobmFt\nZSkpIHsKICAgICAgICAgICAgaWYgKF9zeXNTZXEgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9zeXNTZXEgPSBuZXdTZXF1ZW5jZU1ldGFEYXRhKG5hbWUp\nOwogICAgICAgICAgICByZXR1cm4gX3N5c1NlcTsKICAgICAgICB9CiAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFt\nZWQtc2VxdWVuY2UiLCBuYW1lKSk7CiAgICAgICAgcmV0dXJuIG1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBVc2VkIGludGVybmFsbHkgYnkgbWV0YWRh\ndGEgdG8gcmV0cmlldmUgc2VxdWVuY2UgbWV0YWRhdGFzIGJhc2VkIG9uCiAg\nICAgKiBwb3NzaWJseS11bnF1YWxpZmllZCBzZXF1ZW5jZSBuYW1lLgogICAg\nICovCiAgICBTZXF1ZW5jZU1ldGFEYXRhIGdldFNlcXVlbmNlTWV0YURhdGEo\nQ2xhc3NNZXRhRGF0YSBjb250ZXh0LCBTdHJpbmcgbmFtZSwKICAgICAgICBi\nb29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIC8vIHRyeSB3aXRoIGdpdmVu\nIG5hbWUKICAgICAgICBNZXRhRGF0YUV4Y2VwdGlvbiBlID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIHNlcSA9\nIGdldFNlcXVlbmNlTWV0YURhdGEobmFtZSwKICAgICAgICAgICAgICAgIGNv\nbnRleHQuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgbXVzdEV4aXN0KTsKICAgICAg\nICAgICAgaWYgKHNlcSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHNlcTsKICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBtZGUp\nIHsKICAgICAgICAgICAgZSA9IG1kZTsKICAgICAgICB9CgogICAgICAgIC8v\nIGlmIGdpdmVuIG5hbWUgYWxyZWFkeSBmdWxseSBxdWFsaWZpZWQsIGdpdmUg\ndXAKICAgICAgICBpZiAobmFtZS5pbmRleE9mKCcuJykgIT0gLTEpIHsKICAg\nICAgICAgICAgaWYgKGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIGU7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgLy8gdHJ5IHdpdGggcXVhbGlmaWVkIG5hbWUKICAgICAgICBuYW1lID0g\nU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShjb250ZXh0LmdldERlc2NyaWJlZFR5\ncGUoKSkKICAgICAgICAgICAgKyAiLiIgKyBuYW1lOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUs\nIGNvbnRleHQuZ2V0RW52Q2xhc3NMb2FkZXIoKSwKICAgICAgICAgICAgICAg\nIG11c3RFeGlzdCk7CiAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFFeGNlcHRp\nb24gbWRlKSB7CiAgICAgICAgICAgIC8vIHRocm93IG9yaWdpbmFsIGV4Y2Vw\ndGlvbgogICAgICAgICAgICBpZiAoZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgZTsKICAgICAgICAgICAgdGhyb3cgbWRlOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBzZXF1ZW5jZSBtZXRhZGF0\nYSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIGNsYXNzbG9hZGVyLgogICAgICov\nCiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgZ2V0U2VxdWVuY2VNZXRh\nRGF0YUludGVybmFsKFN0cmluZyBuYW1lLAogICAgICAgIENsYXNzTG9hZGVy\nIGVudkxvYWRlcikgewogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVjayBjYWNoZQog\nICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IChTZXF1ZW5jZU1ldGFE\nYXRhKSBfc2Vxcy5nZXQobmFtZSk7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVs\nbCkgewogICAgICAgICAgICAvLyBsb2FkIG1ldGFkYXRhIGZvciByZWdpc3Rl\ncmVkIGNsYXNzZXMgdG8gaG9wZWZ1bGx5IGZpbmQgc2VxdWVuY2UKICAgICAg\nICAgICAgLy8gZGVmaW5pdGlvbgogICAgICAgICAgICBsb2FkUmVnaXN0ZXJl\nZENsYXNzTWV0YURhdGEoZW52TG9hZGVyKTsKICAgICAgICAgICAgbWV0YSA9\nIChTZXF1ZW5jZU1ldGFEYXRhKSBfc2Vxcy5nZXQobmFtZSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBjYWNoZWQgc2VxdWVuY2UgbWV0YWRhdGEuCiAgICAgKi8K\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgU2VxdWVuY2VNZXRhRGF0YVtdIGdl\ndFNlcXVlbmNlTWV0YURhdGFzKCkgewogICAgICAgIHJldHVybiAoU2VxdWVu\nY2VNZXRhRGF0YVtdKSBfc2Vxcy52YWx1ZXMoKS50b0FycmF5CiAgICAgICAg\nICAgIChuZXcgU2VxdWVuY2VNZXRhRGF0YVtfc2Vxcy5zaXplKCldKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIGEgc2VxdWVu\nY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgICovCiAgICBw\ndWJsaWMgc3luY2hyb25pemVkIFNlcXVlbmNlTWV0YURhdGEgZ2V0Q2FjaGVk\nU2VxdWVuY2VNZXRhRGF0YSgKICAgICAgICBTdHJpbmcgbmFtZSkgewogICAg\nICAgIHJldHVybiAoU2VxdWVuY2VNZXRhRGF0YSkgX3NlcXMuZ2V0KG5hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IHNlcXVlbmNlIG1l\ndGFkYXRhIHRvIHRoZSByZXBvc2l0b3J5IGFuZCByZXR1cm4gaXQuCiAgICAg\nKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgU2VxdWVuY2VNZXRhRGF0YSBh\nZGRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgU2Vx\ndWVuY2VNZXRhRGF0YSBtZXRhID0gbmV3U2VxdWVuY2VNZXRhRGF0YShuYW1l\nKTsKICAgICAgICBfc2Vxcy5wdXQobmFtZSwgbWV0YSk7CiAgICAgICAgcmV0\ndXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc2VxdWVuY2UgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBTZXF1ZW5jZU1ldGFEYXRhIG5ld1NlcXVlbmNlTWV0YURhdGEoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFNlcXVlbmNlTWV0YURh\ndGEobmFtZSwgdGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUg\ndGhlIGdpdmVuIHNlcXVlbmNlIG1ldGFkYXRhIGZyb20gdGhlIHJlcG9zaXRv\ncnkuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiBy\nZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICByZXR1cm4gX3NlcXMucmVtb3ZlKG1ldGEuZ2V0\nTmFtZSgpKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3Zl\nIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUgbmFtZSBpZiBpbiB0aGUgcmVw\nb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBib29s\nZWFuIHJlbW92ZVNlcXVlbmNlTWV0YURhdGEoU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgcmV0dXJuIF9zZXFzLnJlbW92ZShuYW1lKSAhPSBudWxs\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBzeXN0ZW0g\nbGlmZWN5Y2xlIGxpc3RlbmVyLgogICAgICovCiAgICBwdWJsaWMgc3luY2hy\nb25pemVkIHZvaWQgYWRkU3lzdGVtTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVy\nKSB7CiAgICAgICAgLy8gY29weSB0byBhdm9pZCBpc3N1ZXMgd2l0aCBMaXN0\nZW5lckxpc3QgYW5kIGF2b2lkIHVubmNlc3NhcnkKICAgICAgICAvLyBsb2Nr\naW5nIG9uIHRoZSBsaXN0IGR1cmluZyBydW50aW1lCiAgICAgICAgTGlmZWN5\nY2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcK\nICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlz\ndChfbGlzdGVuZXJzKTsKICAgICAgICBsaXN0ZW5lcnMuYWRkKGxpc3RlbmVy\nKTsKICAgICAgICBfbGlzdGVuZXJzID0gbGlzdGVuZXJzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzeXN0ZW0gbGlmZWN5Y2xl\nIGxpc3RlbmVyLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJv\nb2xlYW4gcmVtb3ZlU3lzdGVtTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7\nCiAgICAgICAgaWYgKCFfbGlzdGVuZXJzLmNvbnRhaW5zKGxpc3RlbmVyKSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBjb3B5IHRv\nIGF2b2lkIGlzc3VlcyB3aXRoIExpc3RlbmVyTGlzdCBhbmQgYXZvaWQgdW5u\nY2Vzc2FyeQogICAgICAgIC8vIGxvY2tpbmcgb24gdGhlIGxpc3QgZHVyaW5n\nIHJ1bnRpbWUKICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVu\nZXJMaXN0IGxpc3RlbmVycyA9IG5ldwogICAgICAgICAgICBMaWZlY3ljbGVF\ndmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KF9saXN0ZW5lcnMpOwogICAgICAg\nIGxpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIpOwogICAgICAgIF9saXN0ZW5l\ncnMgPSBsaXN0ZW5lcnM7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN5c3RlbSBsaWZlY3ljbGUgbGlz\ndGVuZXJzCiAgICAgKi8KICAgIHB1YmxpYyBMaWZlY3ljbGVFdmVudE1hbmFn\nZXIuTGlzdGVuZXJMaXN0IGdldFN5c3RlbUxpc3RlbmVycygpIHsKICAgICAg\nICByZXR1cm4gX2xpc3RlbmVyczsKICAgIH0KCiAgICAvKioKICAgICAqIEZy\nZWUgdGhlIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgcmVwb3NpdG9yeS4gQ2xv\nc2VzIGFsbCB1c2VyIHNlcXVlbmNlcy4KICAgICAqLwogICAgcHVibGljIHN5\nbmNocm9uaXplZCB2b2lkIGNsb3NlKCkgewogICAgICAgIFNlcXVlbmNlTWV0\nYURhdGFbXSBzbWRzID0gZ2V0U2VxdWVuY2VNZXRhRGF0YXMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNtZHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgIHNtZHNbaV0uY2xvc2UoKTsKICAgICAgICBjbGVhcigpOwogICAg\nfQoKICAgIC8qKgogICAgICogUXVlcnkga2V5IHN0cnVjdC4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUXVlcnlLZXkKICAgICAgICBpbXBs\nZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1YmxpYyBTdHJpbmcg\nY2xzTmFtZTsKICAgICAgICBwdWJsaWMgU3RyaW5nIG5hbWU7CgogICAgICAg\nIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIGludCBjbHNI\nYXNoID0gKGNsc05hbWUgPT0gbnVsbCkgPyAwIDogY2xzTmFtZS5oYXNoQ29k\nZSgpOwogICAgICAgICAgICBpbnQgbmFtZUhhc2ggPSAobmFtZSA9PSBudWxs\nKSA/IDAgOiBuYW1lLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBj\nbHNIYXNoICsgbmFtZUhhc2g7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG9iaikKCQl7CgkJCWlmIChvYmogPT0g\ndGhpcykKCQkJCXJldHVybiB0cnVlOwoJCQlpZiAoIShvYmogaW5zdGFuY2Vv\nZiBRdWVyeUtleSkpCgkJCQlyZXR1cm4gZmFsc2U7CgkJCgkJCVF1ZXJ5S2V5\nIHFrID0gKFF1ZXJ5S2V5KSBvYmo7CgkJCXJldHVybiBTdHJpbmdVdGlscy5l\ncXVhbHMgKGNsc05hbWUsIHFrLmNsc05hbWUpCgkJCQkmJiBTdHJpbmdVdGls\ncy5lcXVhbHMgKG5hbWUsIHFrLm5hbWUpOwkKCQl9Cgl9CiAgICAKICAgIC8q\nKgogICAgICogUmV0dXJuIFhNTCBtZXRhZGF0YSBmb3IgYSBnaXZlbiBmaWVs\nZCBtZXRhZGF0YQogICAgICogQHBhcmFtIGZtZAogICAgICogQHJldHVybiBY\nTUwgbWV0YWRhdGEKICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBY\nTUxNZXRhRGF0YSBnZXRYTUxNZXRhRGF0YShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIENsYXNzIGNscyA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgICAgICAvLyBjaGVjayBpZiBjYWNoZWQgYmVmb3JlCiAgICAgICAgWE1M\nTWV0YURhdGEgeG1sbWV0YSA9IChYTUxDbGFzc01ldGFEYXRhKSBfeG1sbWV0\nYXMuZ2V0KGNscyk7CiAgICAgICAgaWYgKHhtbG1ldGEgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIHhtbG1ldGE7CiAgICAgICAgCiAgICAgICAgLy8g\nbG9hZCBKQVhCIFhNTCBtZXRhZGF0YQogICAgICAgIF9mYWN0b3J5LmxvYWRY\nTUxNZXRhRGF0YShmbWQpOwogICAgICAgIAogICAgICAgIHhtbG1ldGEgPSAo\nWE1MQ2xhc3NNZXRhRGF0YSkgX3htbG1ldGFzLmdldChjbHMpOwoKICAgICAg\nICByZXR1cm4geG1sbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBtZXRhZGF0YSwgcG9wdWxhdGUgaXQgd2l0aCBkZWZhdWx0IGlu\nZm9ybWF0aW9uLCBhZGQgaXQgdG8KICAgICAqIHRoZSByZXBvc2l0b3J5LCBh\nbmQgcmV0dXJuIGl0LgogICAgICoKICAgICAqIEBwYXJhbSBhY2Nlc3MgdGhl\nIGFjY2VzcyB0eXBlIHRvIHVzZSBpbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAg\nICAgKi8KICAgIHB1YmxpYyBYTUxDbGFzc01ldGFEYXRhIGFkZFhNTE1ldGFE\nYXRhKENsYXNzIHR5cGUsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgWE1MQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gbmV3WE1MQ2xhc3NNZXRhRGF0YSh0eXBlLCBu\nYW1lKTsKICAgICAgICAKICAgICAgICAvLyBzeW5jaHJvbml6ZSBvbiB0aGlz\nIHJhdGhlciB0aGFuIHRoZSBtYXAsIGJlY2F1c2UgYWxsIG90aGVyIG1ldGhv\nZHMKICAgICAgICAvLyB0aGF0IGFjY2VzcyBfeG1sbWV0YXMgYXJlIHN5bmNo\ncm9uaXplZCBvbiB0aGlzCiAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7\nCiAgICAgICAgICAgIF94bWxtZXRhcy5wdXQodHlwZSwgbWV0YSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBjYWNoZWQgWE1MQ2xhc3NNZXRhRGF0YSBmb3IgdGhl\nIGdpdmVuIGNsYXNzCiAgICAgKiBSZXR1cm4gbnVsbCBpZiBub25lLgogICAg\nICovCiAgICBwdWJsaWMgWE1MTWV0YURhdGEgZ2V0Q2FjaGVkWE1MTWV0YURh\ndGEoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJuIChYTUxNZXRhRGF0YSkg\nX3htbG1ldGFzLmdldChjbHMpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyB4bWwgY2xhc3MgbWV0YWRhdGEKICAgICAqIEBwYXJh\nbSB0eXBlCiAgICAgKiBAcGFyYW0gbmFtZQogICAgICogQHJldHVybiBhIFhN\nTENsYXNzTWV0YURhdGEKICAgICAqLwogICAgcHJvdGVjdGVkIFhNTENsYXNz\nTWV0YURhdGEgbmV3WE1MQ2xhc3NNZXRhRGF0YShDbGFzcyB0eXBlLCBTdHJp\nbmcgbmFtZSkgewogICAgICAgIHJldHVybiBuZXcgWE1MQ2xhc3NNZXRhRGF0\nYSh0eXBlLCBuYW1lKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBuZXcgeG1sIGZpZWxkIG1ldGEsIGFkZCBpdCB0byB0aGUgZmllbGRN\nYXAgaW4gdGhlIGdpdmVuIAogICAgICogICAgIHhtbCBjbGFzcyBtZXRhZGF0\nYQogICAgICogQHBhcmFtIHR5cGUKICAgICAqIEBwYXJhbSBuYW1lCiAgICAg\nKiBAcGFyYW0gbWV0YQogICAgICogQHJldHVybiBhIFhNTEZpZWxkTWV0YURh\ndGEKICAgICAqLwogICAgcHVibGljIFhNTEZpZWxkTWV0YURhdGEgbmV3WE1M\nRmllbGRNZXRhRGF0YShDbGFzcyB0eXBlLCBTdHJpbmcgbmFtZSkgewogICAg\nICAgIHJldHVybiBuZXcgWE1MRmllbGRNZXRhRGF0YSh0eXBlLCBuYW1lKTsK\nICAgIH0KfQo=\n","encoding":"base64"}

