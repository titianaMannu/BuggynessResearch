{"sha":"f0776424f2cadc98c40914d01f811c4dc2d59f72","node_id":"MDQ6QmxvYjIwNjM2NDpmMDc3NjQyNGYyY2FkYzk4YzQwOTE0ZDAxZjgxMWM0ZGMyZDU5Zjcy","size":22506,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f0776424f2cadc98c40914d01f811c4dc2d59f72","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9s\nbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuRmllbGRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9iamVjdElkU3Rh\ndGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5P\ncGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5TdGF0ZU1hbmFnZXJJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBz\nZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBVdGlsaXR5IGNsYXNzIGZvciBt\nYW5pcHVsYXRpbmcgYXBwbGljYXRpb24gb2JqZWN0IGlkcy4KICoKICogQGF1\ndGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNz\nIEFwcGxpY2F0aW9uSWRzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAg\nKEFwcGxpY2F0aW9uSWRzLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExvY2FsaXplciBfbG9jMiA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAg\nICAgICAgKFN0YXRlTWFuYWdlckltcGwuY2xhc3MpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBwcmltYXJ5IGtleSB2YWx1ZXMgZm9yIHRoZSBnaXZl\nbiBvYmplY3QgaWQuIFRoZSB2YWx1ZXMKICAgICAqIHdpbGwgYmUgcmV0dXJu\nZWQgaW4gdGhlIHNhbWUgb3JkZXIgYXMgdGhlIG1ldGFkYXRhIHByaW1hcnkg\na2V5IGZpZWxkcy4KICAgICAqIFZhbHVlcyBmb3IgUEMgcHJpbWFyeSBrZXkg\nZmllbGRzIHdpbGwgYmUgdGhlIHByaW1hcmt5IGtleSB2YWx1ZSBvcgogICAg\nICogb2lkIHZhbHVlIG9mIHRoZSByZWxhdGVkIGluc3RhbmNlIChkZXBlbmRp\nbmcgb24gCiAgICAgKiB7QGxpbmsgRmllbGRNZXRhRGF0YSNpc09iamVjdElk\nRmllbGRJZE9mUEN9KS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmpl\nY3RbXSB0b1BLVmFsdWVzKE9iamVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBPYmplY3RbXSBwa3M7CiAgICAgICAgaWYg\nKG1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICBwa3Mg\nPSBuZXcgT2JqZWN0WzFdOwogICAgICAgICAgICBpZiAob2lkICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBwa3NbMF0gPSAoKE9wZW5KUEFJZCkgb2lkKS5n\nZXRJZE9iamVjdCgpOwogICAgICAgICAgICByZXR1cm4gcGtzOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVzZXQgb3duaW5nICdtZXRhJyB0byB0aGUgb3du\nZXIgb2YgdGhlIHByaW1hcnkga2V5IGZpZWxkcywgYmVjYXVzZQogICAgICAg\nIC8vIHRoZSBvbmUgcGFzc2VkIGluIG1pZ2h0IGJlIGEgcHJveHksIGxpa2Ug\nZm9yIGVtYmVkZGVkIG1hcHBpbmdzOwogICAgICAgIC8vIHNpbmNlIGdldFBy\naW1hcnlLZXlGaWVsZHMgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gdGhlIHBy\naW1hcnkKICAgICAgICAvLyBrZXlzIGluIHRoZSBvcmRlciBvZiBpbmhlcml0\nYW5jZSwgd2UgYXJlIGd1YXJhbnRlZWQgdGhhdAogICAgICAgIC8vIHRoZSBs\nYXN0IGVsZW1lbnQgd2lsbCBiZSB0aGUgbW9zdC1kZXJpdmVkIGNsYXNzLgog\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gbWV0YS5nZXRQcmltYXJ5\nS2V5RmllbGRzKCk7CiAgICAgICAgbWV0YSA9IGZtZHNbZm1kcy5sZW5ndGgg\nLSAxXS5nZXREZWNsYXJpbmdNZXRhRGF0YSgpOwogICAgICAgIHBrcyA9IG5l\ndyBPYmplY3RbZm1kcy5sZW5ndGhdOwogICAgICAgIGlmIChvaWQgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIHBrczsKCiAgICAgICAgaWYgKCFNb2Rp\nZmllci5pc0Fic3RyYWN0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1v\nZGlmaWVycygpKSkgewogICAgICAgICAgICAvLyBjb3B5IGZpZWxkcyBmcm9t\nIHRoZSBvaWQKICAgICAgICAgICAgUHJpbWFyeUtleUZpZWxkTWFuYWdlciBj\nb25zdW1lciA9IG5ldyBQcmltYXJ5S2V5RmllbGRNYW5hZ2VyKCk7CiAgICAg\nICAgICAgIGNvbnN1bWVyLnNldFN0b3JlKHBrcyk7CiAgICAgICAgICAgIFBD\nUmVnaXN0cnkuY29weUtleUZpZWxkc0Zyb21PYmplY3RJZChtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbnN1bWVyLCBvaWQp\nOwogICAgICAgICAgICByZXR1cm4gY29uc3VtZXIuZ2V0U3RvcmUoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGRlZmF1bHQgdG8gcmVmbGVjdGlvbgogICAg\nICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAg\nICAgIG9pZCA9ICgoT2JqZWN0SWQpIG9pZCkuZ2V0SWQoKTsKICAgICAgICBD\nbGFzcyBvaWRUeXBlID0gb2lkLmdldENsYXNzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFD\nQ0VTU19GSUVMRCkKICAgICAgICAgICAgICAgIHBrc1tpXSA9IFJlZmxlY3Rp\nb24uZ2V0KG9pZCwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHRydWUpKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGtzW2ldID0gUmVm\nbGVjdGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlw\nZSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE5hbWUoKSwgdHJ1\nZSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGtzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgbmV3IG9iamVjdCBpZCBjb25zdHJ1Y3Rl\nZCBmcm9tIHRoZSBnaXZlbiBwcmltYXJ5IGtleSB2YWx1ZXMuCiAgICAgKiBW\nYWx1ZXMgZm9yIFBDIHByaW1hcnkga2V5IGZpZWxkcyBzaG91bGQgYmUgdGhl\nIHByaW1hcmt5IGtleSB2YWx1ZSBvcgogICAgICogb2lkIHZhbHVlIG9mIHRo\nZSByZWxhdGVkIGluc3RhbmNlIChkZXBlbmRpbmcgb24gCiAgICAgKiB7QGxp\nbmsgRmllbGRNZXRhRGF0YSNpc09iamVjdElkRmllbGRJZE9mUEN9KS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZnJvbVBLVmFsdWVzKE9i\namVjdFtdIHBrcywgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYg\nKG1ldGEgPT0gbnVsbCB8fCBwa3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGJvb2xlYW4gY29udmVydCA9ICFtZXRhLmdl\ndFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAg\nIGdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdldFN0cmljdElkZW50aXR5\nVmFsdWVzKCk7CiAgICAgICAgaWYgKG1ldGEuaXNPcGVuSlBBSWRlbnRpdHko\nKSkgewogICAgICAgICAgICBpbnQgdHlwZSA9IG1ldGEuZ2V0UHJpbWFyeUtl\neUZpZWxkcygpWzBdLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpOwogICAg\nICAgICAgICBPYmplY3QgdmFsID0gKGNvbnZlcnQpID8gSmF2YVR5cGVzLmNv\nbnZlcnQocGtzWzBdLCB0eXBlKSA6IHBrc1swXTsKICAgICAgICAgICAgc3dp\ndGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGlu\nc3RhbmNlb2YgQnl0ZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIEJ5dGUp\nIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCeXRlSWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgp\nKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IENoYXJJZChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwg\nPyAwIDogKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAg\nICAgICBpZiAoIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBEb3VibGUp\nKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0\nRXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBEb3VibGUpIik7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGVJZChtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51\nbGwgPyAwIDogKChOdW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgICAg\nICAgICBpZiAoIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBGbG9hdCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RF\neGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIEZsb2F0KSIpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgRmxvYXRJZChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwg\nPyAwIDogKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1ZSgpKTsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNlb2YgSW50ZWdlcikpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRp\nb24oIiEoeCBpbnN0YW5jZW9mIEludGVnZXIpIik7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBJbnRJZChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDog\nKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSk7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb252\nZXJ0ICYmICEodmFsIGluc3RhbmNlb2YgTG9uZykpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBp\nbnN0YW5jZW9mIExvbmcpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBMb25nSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2\nYWwpLmxvbmdWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlRfT0JKOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAh\nKHZhbCBpbnN0YW5jZW9mIFNob3J0KSkKICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNl\nb2YgU2hvcnQpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBT\naG9ydElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5z\naG9ydFZhbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIChTdHJpbmcpIHZhbCk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgRGF0ZUlkKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLCAoRGF0ZSkgdmFsKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9C\nSkVDVDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElk\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB2YWwpOwogICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gY29weSBwa3MgdG8gb2lkCiAgICAgICAgaWYgKCFNb2RpZmll\nci5pc0Fic3RyYWN0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlm\naWVycygpKSkgewogICAgICAgICAgICBPYmplY3Qgb2lkID0gUENSZWdpc3Ry\neS5uZXdPYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAg\nICAgICAgIFByaW1hcnlLZXlGaWVsZE1hbmFnZXIgcHJvZHVjZXIgPSBuZXcg\nUHJpbWFyeUtleUZpZWxkTWFuYWdlcigpOwogICAgICAgICAgICBwcm9kdWNl\nci5zZXRTdG9yZShwa3MpOwogICAgICAgICAgICBpZiAoY29udmVydCkKICAg\nICAgICAgICAgICAgIHByb2R1Y2VyLnNldE1ldGFEYXRhKG1ldGEpOwogICAg\nICAgICAgICBQQ1JlZ2lzdHJ5LmNvcHlLZXlGaWVsZHNUb09iamVjdElkKG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcHJvZHVj\nZXIsIG9pZCk7CiAgICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoK\nICAgICAgICAvLyBkZWZhdWx0IHRvIHJlZmxlY3Rpb24KICAgICAgICBDbGFz\ncyBvaWRUeXBlID0gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBp\nZiAoTW9kaWZpZXIuaXNBYnN0cmFjdChvaWRUeXBlLmdldE1vZGlmaWVycygp\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm9iamVjdGlkLWFic3RyYWN0IiwgbWV0YSkpOwogICAgICAgIE9iamVj\ndCBjb3B5ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb3B5\nID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihvaWRUeXBl\nKSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgaWYgKHQgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9u\nKQogICAgICAgICAgICAgICAgdCA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikgdCkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAgICAgIH0KCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMo\nKTsKICAgICAgICBPYmplY3QgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSAo\nY29udmVydCkgPyBKYXZhVHlwZXMuY29udmVydChwa3NbaV0sCiAgICAgICAg\nICAgICAgICBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpKSA6\nIHBrc1tpXTsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgp\nID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAg\nICAgUmVmbGVjdGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kRmllbGQo\nb2lkVHlwZSwgCiAgICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1l\nKCksIHRydWUpLCB2YWwpOyAKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgUmVmbGVjdGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0\ndGVyKG9pZFR5cGUsIAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0\nTmFtZSgpLCBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCB0cnVlKSwgdmFs\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBl\nU2hhcmVkKCkpCiAgICAgICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksIGNvcHkpOwogICAgICAgIHJldHVybiBj\nb3B5OwogICAgfQoKICAgIC8qKgogICAgICogQ29weSB0aGUgZ2l2ZW4gb2lk\nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjb3B5\nKE9iamVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlm\nIChtZXRhID09IG51bGwgfHwgb2lkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpKSB7CiAgICAgICAgICAgIC8vIHVzZSBtZXRhIHR5cGUgaW5zdGVhZCBv\nZiBvaWQgdHlwZSBpbiBjYXNlIGl0J3MgYSBzdWJjbGFzcwogICAgICAgICAg\nICBDbGFzcyBjbHMgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAg\nICAgICAgT3BlbkpQQUlkIGtvaWQgPSAoT3BlbkpQQUlkKSBvaWQ7CiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGEgcGsgPSBtZXRhLmdldFByaW1hcnlLZXlG\naWVsZHMoKVswXTsKICAgICAgICAgICAgc3dpdGNoIChway5nZXRPYmplY3RJ\nZEZpZWxkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZUlk\nKGNscywgKChCeXRlSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgQ2hhcklkKGNscywgKChDaGFySWQpIG9pZCkuZ2V0SWQoKSwKICAg\nICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZUlkKGNscywgKChEb3VibGVJ\nZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBrb2lk\nLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0\nSWQoY2xzLCAoKEZsb2F0SWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEludElkKGNscywgKChJbnRJZCkgb2lkKS5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBMb25nSWQoY2xzLCAoKExvbmdJZCkgb2lkKS5n\nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNs\nYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0SWQoY2xzLCAo\nKFNob3J0SWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nSWQoY2xzLCBvaWQudG9TdHJpbmcoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFE\nYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGlubmVyID0ga29p\nZC5nZXRJZE9iamVjdCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbWJl\nZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBpbm5lciA9IGNv\ncHkoaW5uZXIsIGVtYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIGlubmVyLCBr\nb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBPYmplY3RJZChjbHMsIGtvaWQuZ2V0SWRPYmplY3QoKSwgCiAgICAgICAg\nICAgICAgICAgICAgICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBEYXRlSWQoY2xzLCAoKERhdGVJZCkgb2lkKS5n\nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNs\nYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYSBuZXcg\ncGMgaW5zdGFuY2Ugb2YgdGhlIHJpZ2h0IHR5cGUsIHNldCBpdHMga2V5IGZp\nZWxkcwogICAgICAgIC8vIHRvIHRoZSBvcmlnaW5hbCBvaWQgdmFsdWVzLCB0\naGVuIGNvcHkgaXRzIGtleSBmaWVsZHMgdG8gYSBuZXcKICAgICAgICAvLyBv\naWQgaW5zdGFuY2UKICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3Qo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpCiAgICAg\nICAgICAgICYmICFoYXNQQ1ByaW1hcnlLZXlGaWVsZHMobWV0YSkpIHsKICAg\nICAgICAgICAgQ2xhc3MgdHlwZSA9IG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgp\nOwogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdHlwZSA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3Rh\nbmNlKHR5cGUsIG51bGwsIG9pZCwgCiAgICAgICAgICAgICAgICAgZmFsc2Up\nOwogICAgICAgICAgICBPYmplY3QgY29weSA9IHBjLnBjTmV3T2JqZWN0SWRJ\nbnN0YW5jZSgpOwogICAgICAgICAgICBwYy5wY0NvcHlLZXlGaWVsZHNUb09i\namVjdElkKGNvcHkpOwogICAgICAgICAgICByZXR1cm4gY29weTsKICAgICAg\nICB9CgogICAgICAgIE9iamVjdCBjb3B5ID0gKCFtZXRhLmlzT2JqZWN0SWRU\neXBlU2hhcmVkKCkpID8gb2lkCiAgICAgICAgICAgIDogKChPYmplY3RJZCkg\nb2lkKS5nZXRJZCgpOwogICAgICAgIGNvcHkgPSBjb3B5KGNvcHksIG1ldGEs\nIG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpKTsKICAgICAgICBpZiAobWV0\nYS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQogICAgICAgICAgICBjb3B5ID0g\nbmV3IE9iamVjdElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBjb3B5LAog\nICAgICAgICAgICAgICAgKChPcGVuSlBBSWQpIG9pZCkuaGFzU3ViY2xhc3Nl\ncygpKTsKICAgICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0cnVlIGlmIGFueSBvZiB0aGUgZ2l2ZW4gdHlwZSdzIHBy\naW1hcnkga2V5IGZpZWxkcyBhcmUgCiAgICAgKiBwZXJzaXN0ZW50IG9iamVj\ndHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaGFzUENQ\ncmltYXJ5S2V5RmllbGRzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gbWV0YS5nZXRQcmltYXJ5S2V5Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29weSB0aGUgZ2l2ZW4gaWRlbnRpdHkgb2JqZWN0IHVzaW5n\nIHJlZmxlY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVj\ndCBjb3B5KE9iamVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcykgewogICAgICAgIGlmIChvaWQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNz\nIG9pZFR5cGUgPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICBPYmplY3QgY29w\neSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29weSA9IEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24ob2lkVHlwZSkpOwog\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIGlm\nICh0IGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAg\nICAgICAgICAgICAgIHQgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24p\nIHQpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbih0KTsKICAgICAgICB9CgogICAgICAgIEZpZWxkIGZp\nZWxkOwogICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChm\nbWRzW2ldLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFH\nRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAgICAgICAgICBmaWVs\nZCA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIGZtZHNbaV0uZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBSZWZsZWN0aW9uLnNldChjb3B5LCBmaWVsZCwgUmVm\nbGVjdGlvbi5nZXQob2lkLCBmaWVsZCkpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsgLy8gcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICB2YWwgPSBS\nZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRU\neXBlLAogICAgICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE5hbWUo\nKSwgdHJ1ZSkpOwogICAgICAgICAgICAgICAgICAgIFJlZmxlY3Rpb24uc2V0\nKGNvcHksIFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWRUeXBlLCBmbWRzW2ld\nLgogICAgICAgICAgICAgICAgICAgICAgICBnZXROYW1lKCksIGZtZHNbaV0u\nZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSwgdHJ1ZSksIHZhbCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNv\ncHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGdpdmVuIHBy\naW1hcnkga2V5IGZpZWxkIHZhbHVlIGZyb20gdGhlIGdpdmVuIG9pZC4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2V0KE9iamVjdCBvaWQs\nIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob2lkIGlu\nc3RhbmNlb2YgT3BlbkpQQUlkKQogICAgICAgICAgICByZXR1cm4gKChPcGVu\nSlBBSWQpIG9pZCkuZ2V0SWRPYmplY3QoKTsKCiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhID0gZm1kLmdldERlZmluaW5nTWV0YURhdGEoKTsKICAgICAg\nICBDbGFzcyBvaWRUeXBlID0gb2lkLmdldENsYXNzKCk7CiAgICAgICAgaWYg\nKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNT\nX0ZJRUxEKQogICAgICAgICAgICByZXR1cm4gUmVmbGVjdGlvbi5nZXQob2lk\nLCBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCAKICAgICAgICAgICAg\nICAgIGZtZC5nZXROYW1lKCksIHRydWUpKTsKICAgICAgICByZXR1cm4gUmVm\nbGVjdGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlw\nZSwgZm1kLmdldE5hbWUoKSwKICAgICAgICAgICAgdHJ1ZSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogR2VuZXJhdGUgYW4gYXBwbGljYXRpb24gaWQgYmFz\nZWQgb24gdGhlIGN1cnJlbnQgcHJpbWFyeSBrZXkgZmllbGQgc3RhdGUKICAg\nICAqIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBPYmplY3QgY3JlYXRlKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\nQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKHBjID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBPYmplY3Qgb2lk\nID0gcGMucGNOZXdPYmplY3RJZEluc3RhbmNlKCk7CiAgICAgICAgaWYgKG9p\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\naWYgKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAg\ncGMucGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZChvaWQpOwogICAgICAgICAg\nICByZXR1cm4gb2lkOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0\nYSBwayA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpWzBdOwogICAgICAg\nIGlmIChway5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLk9J\nRCkKICAgICAgICAgICAgcmV0dXJuIG9pZDsKCiAgICAgICAgLy8gYWx3YXlz\nIGNvcHkgb2lkIG9iamVjdCBpbiBjYXNlIGZpZWxkIHZhbHVlIG11dGF0ZXMg\nb3IgYmVjb21lcwogICAgICAgIC8vIG1hbmFnZWQKICAgICAgICBPYmplY3RJ\nZCBvYmppZCA9IChPYmplY3RJZCkgb2lkOwogICAgICAgIENsYXNzTWV0YURh\ndGEgZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\nb2JqaWQuc2V0SWQoY29weShvYmppZC5nZXRJZCgpLCBlbWJlZCwgZW1iZWQu\nZ2V0RmllbGRzKCkpKTsKICAgICAgICByZXR1cm4gb2JqaWQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBc3NpZ24gYW4gYXBwbGljYXRpb24gaWRlbnRpdHkg\nb2JqZWN0IHRvIHRoZSBnaXZlbiBzdGF0ZSwgb3IgcmV0dXJuCiAgICAgKiBm\nYWxzZSBpZiBkZXRlcm1pbmluZyB0aGUgYXBwbGljYXRpb24gaWRlbnRpdHkg\ncmVxdWlyZXMgYSBmbHVzaC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBi\nb29sZWFuIGFzc2lnbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBTdG9yZU1h\nbmFnZXIgc3RvcmUsCiAgICAgICAgYm9vbGVhbiBwcmVGbHVzaCkgewogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAg\nICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gQ2xhc3NNZXRh\nRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CgogICAgICAgIGJvb2xlYW4gcmV0OwogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBtZXRhLmdldFByaW1hcnlLZXlG\naWVsZHMoKTsKICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgp\nCiAgICAgICAgICAgICYmIHBrc1swXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkg\nPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIG9pZHNtID0gbmV3IE9iamVjdElkU3RhdGVNYW5hZ2VyCiAgICAg\nICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVsZChwa3NbMF0uZ2V0SW5k\nZXgoKSksIHNtLCBwa3NbMF0pOwogICAgICAgICAgICByZXQgPSBhc3NpZ24o\nb2lkc20sIHN0b3JlLCBwa3NbMF0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLgog\nICAgICAgICAgICAgICAgZ2V0RmllbGRzKCksIHByZUZsdXNoKTsKICAgICAg\nICAgICAgc20uc3RvcmVPYmplY3RGaWVsZChwa3NbMF0uZ2V0SW5kZXgoKSwK\nICAgICAgICAgICAgICAgIG9pZHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsK\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0ID0gYXNzaWduKHNtLCBz\ndG9yZSwgbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCksIHByZUZsdXNoKTsK\nICAgICAgICBpZiAoIXJldCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICAvLyBiYXNlIG9pZCBvbiBmaWVsZCB2YWx1ZXMKICAgICAgICBz\nbS5zZXRPYmplY3RJZChjcmVhdGUoc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxl\nKCksIG1ldGEpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFzc2lnbiBnZW5lcmF0ZWQgdmFsdWVzIHRvIGdpdmVuIHBy\naW1hcnkga2V5IGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiBhc3NpZ24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgU3RvcmVN\nYW5hZ2VyIHN0b3JlLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MsIGJv\nb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHBrcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgLy8gSWYgd2UgYXJlIGdl\nbmVyYXRpbmcgdmFsdWVzLi4uCiAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0\nVmFsdWVTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5OT05FKSB7CiAg\nICAgICAgICAgICAgICAvLyBJZiBhIHZhbHVlIGFscmVhZHkgZXhpc3RzIG9u\nIHRoaXMgZmllbGQsIHRocm93IGV4Y2VwdGlvbi4KICAgICAgICAgICAgICAg\nIC8vIFRoaXMgaXMgY29uc2lkZXJlZCBhbiBhcHBsaWNhdGlvbiBjb2Rpbmcg\nZXJyb3IuCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzRGVmYXVsdFZhbHVl\nKHBrc1tpXS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MyLmdldCgKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICJleGlzdGluZy12YWx1ZS1vdmVycmlk\nZS1leGNlcCIsIHBrc1tpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAuZ2V0RnVsbE5hbWUoZmFsc2UpKSk7CiAgICAgICAgICAgICAg\nICAvLyBBc3NpZ24gdGhlIGdlbmVyYXRlZCB2YWx1ZQogICAgICAgICAgICAg\nICAgaWYgKHN0b3JlLmFzc2lnbkZpZWxkKHNtLCBwa3NbaV0uZ2V0SW5kZXgo\nKSwgcHJlRmx1c2gpKQogICAgICAgICAgICAgICAgICAgIHBrc1tpXS5zZXRW\nYWx1ZUdlbmVyYXRlZCh0cnVlKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0K\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBjbGFzcyB1c2VkIHRvIHRyYW5zZmVyIHBrIHZhbHVlcyB0by9mcm9t\nIGFwcGxpY2F0aW9uIG9pZHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIFByaW1hcnlLZXlGaWVsZE1hbmFnZXIKICAgICAgICBpbXBsZW1l\nbnRzIEZpZWxkTWFuYWdlciB7CgogICAgICAgIHByaXZhdGUgT2JqZWN0W10g\nX3N0b3JlID0gbnVsbDsKICAgICAgICBwcml2YXRlIGludCBfaW5kZXggPSAw\nOwogICAgICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBfbWV0YSA9IG51bGw7\nCgogICAgICAgIHB1YmxpYyB2b2lkIHNldE1ldGFEYXRhKENsYXNzTWV0YURh\ndGEgbWV0YSkgewogICAgICAgICAgICBfbWV0YSA9IG1ldGE7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gZ2V0U3RvcmUoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfc3RvcmU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzZXRTdG9yZShPYmplY3RbXSBzdG9yZSkgewogICAgICAgICAg\nICBfc3RvcmUgPSBzdG9yZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0b3JlQm9vbGVhbkZpZWxkKGludCBmaWVsZCwgYm9vbGVhbiB2YWwp\nIHsKICAgICAgICAgICAgc3RvcmUoKHZhbCkgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHN0b3JlQnl0ZUZpZWxkKGludCBmaWVsZCwgYnl0ZSB2YWwpIHsKICAgICAg\nICAgICAgc3RvcmUobmV3IEJ5dGUodmFsKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBzdG9yZUNoYXJGaWVsZChpbnQgZmllbGQsIGNoYXIg\ndmFsKSB7CiAgICAgICAgICAgIHN0b3JlKG5ldyBDaGFyYWN0ZXIodmFsKSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0Rmll\nbGQoaW50IGZpZWxkLCBzaG9ydCB2YWwpIHsKICAgICAgICAgICAgc3RvcmUo\nbmV3IFNob3J0KHZhbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgc3RvcmVJbnRGaWVsZChpbnQgZmllbGQsIGludCB2YWwpIHsKICAgICAg\nICAgICAgc3RvcmUoTnVtYmVycy52YWx1ZU9mKHZhbCkpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVMb25nRmllbGQoaW50IGZpZWxk\nLCBsb25nIHZhbCkgewogICAgICAgICAgICBzdG9yZShOdW1iZXJzLnZhbHVl\nT2YodmFsKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9y\nZUZsb2F0RmllbGQoaW50IGZpZWxkLCBmbG9hdCB2YWwpIHsKICAgICAgICAg\nICAgc3RvcmUobmV3IEZsb2F0KHZhbCkpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgc3RvcmVEb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJs\nZSB2YWwpIHsKICAgICAgICAgICAgc3RvcmUobmV3IERvdWJsZSh2YWwpKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nRmll\nbGQoaW50IGZpZWxkLCBTdHJpbmcgdmFsKSB7CiAgICAgICAgICAgIHN0b3Jl\nKHZhbCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZU9i\namVjdEZpZWxkKGludCBmaWVsZCwgT2JqZWN0IHZhbCkgewogICAgICAgICAg\nICBzdG9yZSh2YWwpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gZmV0Y2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAg\nIHJldHVybiAocmV0cmlldmUoZmllbGQpID09IEJvb2xlYW4uVFJVRSkgPyB0\ncnVlIDogZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgY2hhciBm\nZXRjaENoYXJGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJu\nICgoQ2hhcmFjdGVyKSByZXRyaWV2ZShmaWVsZCkpLmNoYXJWYWx1ZSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJ5dGUgZmV0Y2hCeXRlRmllbGQo\naW50IGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiAoKE51bWJlcikgcmV0\ncmlldmUoZmllbGQpKS5ieXRlVmFsdWUoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBzaG9ydCBmZXRjaFNob3J0RmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgICAgIHJldHVybiAoKE51bWJlcikgcmV0cmlldmUoZmllbGQpKS5z\naG9ydFZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGZl\ndGNoSW50RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiAo\nKE51bWJlcikgcmV0cmlldmUoZmllbGQpKS5pbnRWYWx1ZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGxvbmcgZmV0Y2hMb25nRmllbGQoaW50IGZp\nZWxkKSB7CiAgICAgICAgICAgIHJldHVybiAoKE51bWJlcikgcmV0cmlldmUo\nZmllbGQpKS5sb25nVmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBmbG9hdCBmZXRjaEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nICAgIHJldHVybiAoKE51bWJlcikgcmV0cmlldmUoZmllbGQpKS5mbG9hdFZh\nbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZG91YmxlIGZldGNo\nRG91YmxlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiAo\nKE51bWJlcikgcmV0cmlldmUoZmllbGQpKS5kb3VibGVWYWx1ZSgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBmZXRjaFN0cmluZ0ZpZWxk\nKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gKFN0cmluZykgcmV0\ncmlldmUoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVj\ndCBmZXRjaE9iamVjdEZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICBy\nZXR1cm4gcmV0cmlldmUoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgcHJp\ndmF0ZSB2b2lkIHN0b3JlKE9iamVjdCB2YWwpIHsKICAgICAgICAgICAgX3N0\nb3JlW19pbmRleCsrXSA9IHZhbDsKICAgICAgICB9CgogICAgICAgIHByaXZh\ndGUgT2JqZWN0IHJldHJpZXZlKGludCBmaWVsZCkgewogICAgICAgICAgICBP\nYmplY3QgdmFsID0gX3N0b3JlW19pbmRleCsrXTsKICAgICAgICAgICAgaWYg\nKF9tZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICAg\nICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVz\nLlBDKQogICAgICAgICAgICAgICAgICAgIHZhbCA9IEphdmFUeXBlcy5jb252\nZXJ0KHZhbCwgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdmFsID0gSmF2YVR5\ncGVzLmNvbnZlcnQodmFsLCBKYXZhVHlwZXMuZ2V0VHlwZUNvZGUoZm1kLgog\nICAgICAgICAgICAgICAgICAgICAgICBnZXRPYmplY3RJZEZpZWxkVHlwZSgp\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbDsKCQl9\nCgl9Cn0K\n","encoding":"base64"}

