{"sha":"d67ceb649ebc3b29b326f31e2ba8bf914420ee81","node_id":"MDQ6QmxvYjIwNjM2NDpkNjdjZWI2NDllYmMzYjI5YjMyNmYzMWUyYmE4YmY5MTQ0MjBlZTgx","size":9262,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d67ceb649ebc3b29b326f31e2ba8bf914420ee81","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmlvLk9iamVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT3V0cHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGph\ndmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJs\nZTsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkl0ZXJhdG9yOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFWZXJzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkphdmFWZXJzaW9uczsKCi8qKgogKiBV\ndGlsaXR5IG1ldGhvZHMgZm9yIGV4dGVybmFsaXppbmcgYW5kIGhhbmRsaW5n\nIGV4Y2VwdGlvbnMuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4\nCiAqIEBzaW5jZSAwLjIuNQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xh\nc3MgRXhjZXB0aW9ucyB7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBUaHJv\nd2FibGVbXSBFTVBUWV9USFJPV0FCTEVTID0gbmV3IFRocm93YWJsZVswXTsK\nCiAgICBzdGF0aWMgZmluYWwgU3RyaW5nIFNFUCA9IEoyRG9Qcml2SGVscGVy\nLmdldExpbmVTZXBhcmF0b3IoKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBPdXRwdXRTdHJlYW0gREVWX05VTEwgPSBuZXcgT3V0cHV0U3RyZWFtKCkg\newogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlKGludCBiKSB7CiAgICAgICAg\nfQogICAgfTsKCiAgICAvKioKICAgICAqIFRlc3QgdG8gc2VlIGlmIHRoZSBz\ncGVjaWZpZWQgb2JqZWN0IHdpbGwgYmUgYWJsZSB0byBiZSBzZXJpYWxpemVk\nLiBUaGlzCiAgICAgKiB3aWxsIGNoZWNrIGlmIHRoZSBvYmplY3QgaW1wbGVt\nZW50cyB7QGxpbmsgU2VyaWFsaXphYmxlfSwgYW5kIGlmIHNvLAogICAgICog\nd2lsbCB0cnkgdG8gcGVyZm9ybSBhbiBhY3R1YWwgc2VyaWFsaXphdGlvbi4g\nVGhpcyBpcyBpbiBjYXNlIHRoZSBvYmplY3QKICAgICAqIGhhcyBmaWVsZHMg\nd2hpY2gsIGluIHR1cm4sIGFyZSBub3Qgc2VyaWFsaXphYmxlLgogICAgICoK\nICAgICAqIEBwYXJhbSBvYiB0aGUgb2JqZWN0IHRvIHRlc3QKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiB0aGUgb2JqZWN0IHdpbGwgYmUgYWJsZSB0byBiZSBz\nZXJpYWxpemVkCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4g\naXNTZXJpYWxpemFibGUoT2JqZWN0IG9iKSB7CiAgICAgICAgaWYgKCEob2Ig\naW5zdGFuY2VvZiBTZXJpYWxpemFibGUpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIGRvbid0IHNlcmlhbGl6ZSBwZXJzaXN0ZW50\nIG9iamVjdHMgZXhjZXB0aW9ucyB0byBwcmV2ZW50CiAgICAgICAgLy8gcmVh\nZGluZyBpbiBhbGwgdGhlIHN0YXRlCiAgICAgICAgaWYgKCFJbXBsSGVscGVy\nLmlzTWFuYWdlZFR5cGUobnVsbCwgb2IuZ2V0Q2xhc3MoKSkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gbm93IGRvIGFuIGFjdHVh\nbCB0ZXN0IHRvIHNlZSBpZiB3ZSB3aWxsIGJlCiAgICAgICAgLy8gYWJsZSB0\nbyBwZXJmb3JtIHRoZSBzZXJpYWxpemF0aW9uCiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgbmV3IE9iamVjdE91dHB1dFN0cmVhbShERVZfTlVMTCkud3Jp\ndGVPYmplY3Qob2IpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2FmZWx5\nIHN0cmluZ2lmeSB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIFN0cmluZyB0b1N0cmluZyhPYmplY3Qgb2IpIHsKICAgICAg\nICBpZiAob2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuICJudWxsIjsK\nCiAgICAgICAgLy8gZG9uJ3QgdGFrZSBvaWQgb2YgbmV3IG9iamVjdHMgc2lu\nY2UgaXQgY2FuIGNhdXNlIGEgZmx1c2ggaWYgYXV0by1pbmMKICAgICAgICAv\nLyBhbmQgdGhlIGlkIGlzIG1lYW5pbmdsZXNzIGFueXdheQogICAgICAgIE9i\namVjdCBvaWQgPSBnZXRPYmplY3RJZChvYik7CgogICAgICAgIGlmIChvaWQg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAob2lkIGluc3RhbmNlb2YgSWQp\nCiAgICAgICAgICAgICAgICByZXR1cm4gb2lkLnRvU3RyaW5nKCk7CiAgICAg\nICAgICAgIHJldHVybiBvYi5nZXRDbGFzcygpLmdldE5hbWUoKSArICItIiAr\nIG9pZC50b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKEltcGxI\nZWxwZXIuaXNNYW5hZ2VkVHlwZShudWxsLCBvYi5nZXRDbGFzcygpKSkgewog\nICAgICAgICAgICAvLyBuZXZlciBjYWxsIHRvU3RyaW5nKCkgb24gYSBQZXJz\naXN0ZW5jZUNhcGFibGUsIHNpbmNlCiAgICAgICAgICAgIC8vIGl0IG1heSBh\nY2Nlc3MgcGVyc2lzdGVudCBmaWVsZHM7IGZhbGwtYmFjayB0byB1c2luZwog\nICAgICAgICAgICAvLyB0aGUgc3RhbmRhcmQgb2JqZWN0IHN0cmluZ2lmaWNh\ndGlvbiBtZWNoYW5pc20uIE5ldwogICAgICAgICAgICAvLyBpbnN0YW5jZXMg\ndGhhdCB1c2UgcHJveHlpbmcgKHByb3BlcnR5LWFjY2VzcyBpbnN0YW5jZXMs\nCiAgICAgICAgICAgIC8vIGZvciBleGFtcGxlKSB0aGF0IHdlcmUgY3JlYXRl\nZCB3aXRoIHRoZSAnbmV3JyBrZXl3b3JkCiAgICAgICAgICAgIC8vIHdpbGwg\nbm90IGVuZCB1cCBpbiB0aGlzIGNvZGUsIHdoaWNoIGlzIG9rIHNpbmNlIHRo\nZXkKICAgICAgICAgICAgLy8gZG9uJ3QgZG8gbGF6eSBsb2FkaW5nIGFueXdh\neXMsIHNvIHRoZXkgd2lsbCBzdHJpbmdpZnkKICAgICAgICAgICAgLy8gc2Fm\nZWx5LgogICAgICAgICAgICByZXR1cm4gb2IuZ2V0Q2xhc3MoKS5nZXROYW1l\nKCkgKyAiQCIKICAgICAgICAgICAgICAgICsgSW50ZWdlci50b0hleFN0cmlu\nZyhTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZShvYikpOwogICAgICAgIH0KCiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5nIHMgPSBvYi50b1N0cmlu\nZygpOwogICAgICAgICAgICBpZiAocy5pbmRleE9mKG9iLmdldENsYXNzKCku\nZ2V0TmFtZSgpKSA9PSAtMSkKICAgICAgICAgICAgICAgIHMgKz0gIiBbIiAr\nIG9iLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIl0iOwogICAgICAgICAgICBy\nZXR1cm4gczsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgICAgICByZXR1cm4gb2IuZ2V0Q2xhc3MoKS5nZXROYW1lKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2FmZWx5IHN0cmluZ2lmeSB0\naGUgZ2l2ZW4gb2JqZWN0cy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBT\ndHJpbmcgdG9TdHJpbmcoQ29sbGVjdGlvbiBmYWlsZWQpIHsKICAgICAgICBT\ndHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAg\nIGJ1Zi5hcHBlbmQoIlsiKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGZhaWxlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBidWYuYXBwZW5kKEV4Y2VwdGlvbnMudG9TdHJpbmcoaXRyLm5leHQo\nKSkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgfQogICAgICAgIGJ1\nZi5hcHBlbmQoIl0iKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJpbmdpZnkgdGhlIGdpdmVuIGV4\nY2VwdGlvbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdG9T\ndHJpbmcoRXhjZXB0aW9uSW5mbyBlKSB7CiAgICAgICAgaW50IHR5cGUgPSBl\nLmdldFR5cGUoKTsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0\ncmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIjwiKS4KICAgICAg\nICAgICAgYXBwZW5kKE9wZW5KUEFWZXJzaW9uLlZFUlNJT05fSUQpLgogICAg\nICAgICAgICBhcHBlbmQoJyAnKS4KICAgICAgICAgICAgYXBwZW5kKGUuaXNG\nYXRhbCgpID8gImZhdGFsICIgOiAibm9uZmF0YWwgIikuCiAgICAgICAgICAg\nIGFwcGVuZCAodHlwZSA9PSBFeGNlcHRpb25JbmZvLkdFTkVSQUwgPyAiZ2Vu\nZXJhbCBlcnJvciIgOgogICAgICAgICAgICAgICAgdHlwZSA9PSBFeGNlcHRp\nb25JbmZvLklOVEVSTkFMID8gImludGVybmFsIGVycm9yIiA6CiAgICAgICAg\nICAgICAgICB0eXBlID09IEV4Y2VwdGlvbkluZm8uU1RPUkUgPyAic3RvcmUg\nZXJyb3IiIDoKICAgICAgICAgICAgICAgIHR5cGUgPT0gRXhjZXB0aW9uSW5m\nby5VTlNVUFBPUlRFRCA/ICJ1bnN1cHBvcnRlZCBlcnJvciIgOgogICAgICAg\nICAgICAgICAgdHlwZSA9PSBFeGNlcHRpb25JbmZvLlVTRVIgPyAidXNlciBl\ncnJvciIgOgogICAgICAgICAgICAgICAgKHR5cGUgKyAiIGVycm9yIikpLgog\nICAgICAgICAgICBhcHBlbmQoIj4gIik7CiAgICAgICAgYnVmLmFwcGVuZChl\nLmdldENsYXNzKCkuZ2V0TmFtZSgpKS5hcHBlbmQoIjogIikuCiAgICAgICAg\nICAgIGFwcGVuZChlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgT2JqZWN0IGZh\naWxlZCA9IGUuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAgaWYgKGZhaWxl\nZCAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKFNFUCkuYXBwZW5k\nKCJGYWlsZWRPYmplY3Q6ICIpLgogICAgICAgICAgICAgICAgYXBwZW5kKHRv\nU3RyaW5nKGZhaWxlZCkpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByaW50IHRoZSBzdGFjayB0cmFj\nZSBvZiB0aGUgZXhjZXB0aW9uJ3MgbmVzdGVkIHRocm93YWJsZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBwcmludE5lc3RlZFRocm93YWJs\nZXMoRXhjZXB0aW9uSW5mbyBlLCBQcmludFN0cmVhbSBvdXQpIHsKICAgICAg\nICAvLyBpZiB0aGlzIGlzIEphdmEgMS40IGFuZCB0aGVyZSBpcyBleGFjdGx5\nIGEgc2luZ2xlCiAgICAgICAgLy8gZXhjZXB0aW9uLCB0aGVuIGRlZmVyIHRv\nIDEuNCdzIGJlaGF2aW9yIG9mIHByaW50aW5nCiAgICAgICAgLy8gb3V0IHRo\nZSByZXN1bHQgb2YgZ2V0Q2F1c2UoKS4gVGhpcyBkZWZlcnJhbCBoYXBwZW5z\nIGluCiAgICAgICAgLy8gdGhlIGNhbGxpbmcgY29kZS4KICAgICAgICBUaHJv\nd2FibGVbXSBuZXN0ZWQgPSBlLmdldE5lc3RlZFRocm93YWJsZXMoKTsKICAg\nICAgICBpbnQgaSA9IChKYXZhVmVyc2lvbnMuVkVSU0lPTiA+PSA0KSA/IDEg\nOiAwOwogICAgICAgIGlmIChpIDwgbmVzdGVkLmxlbmd0aCkgewogICAgICAg\nICAgICBvdXQucHJpbnRsbigiTmVzdGVkVGhyb3dhYmxlczoiKTsKICAgICAg\nICAgICAgZm9yICg7IGkgPCBuZXN0ZWQubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBuZXN0ZWRbaV0ucHJpbnRTdGFja1RyYWNlKG91dCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHJpbnQgdGhlIHN0YWNrIHRy\nYWNlIG9mIHRoZSBleGNlcHRpb24ncyBuZXN0ZWQgdGhyb3dhYmxlcy4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHByaW50TmVzdGVkVGhyb3dh\nYmxlcyhFeGNlcHRpb25JbmZvIGUsIFByaW50V3JpdGVyIG91dCkgewogICAg\nICAgIC8vIGlmIHRoaXMgaXMgSmF2YSAxLjQgYW5kIHRoZXJlIGlzIGV4YWN0\nbHkgYSBzaW5nbGUKICAgICAgICAvLyBleGNlcHRpb24sIHRoZW4gZGVmZXIg\ndG8gMS40J3MgYmVoYXZpb3Igb2YgcHJpbnRpbmcKICAgICAgICAvLyBvdXQg\ndGhlIHJlc3VsdCBvZiBnZXRDYXVzZSgpLiBUaGlzIGRlZmVycmFsIGhhcHBl\nbnMgaW4KICAgICAgICAvLyB0aGUgY2FsbGluZyBjb2RlLgogICAgICAgIFRo\ncm93YWJsZVtdIG5lc3RlZCA9IGUuZ2V0TmVzdGVkVGhyb3dhYmxlcygpOwog\nICAgICAgIGludCBpID0gKEphdmFWZXJzaW9ucy5WRVJTSU9OID49IDQpID8g\nMSA6IDA7CiAgICAgICAgaWYgKGkgPCBuZXN0ZWQubGVuZ3RoKSB7CiAgICAg\nICAgICAgIG91dC5wcmludGxuKCJOZXN0ZWRUaHJvd2FibGVzOiIpOwogICAg\nICAgICAgICBmb3IgKDsgaSA8IG5lc3RlZC5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIG5lc3RlZFtpXS5wcmludFN0YWNrVHJhY2Uob3V0KTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgZmFpbGVkIG9iamVjdCBpbnRvIGEgc2VyaWFsaXphYmxlCiAgICAg\nKiBvYmplY3QgZm9yIHdoZW4gd2UgYXJlIHNlcmlhbGl6aW5nIGFuIEV4Y2Vw\ndGlvbi4gSXQgd2lsbAogICAgICogdHJ5IHRoZSBmb2xsb3dpbmc6CiAgICAg\nKiA8dWw+CiAgICAgKiA8bGk+aWYgdGhlIG9iamVjdCBjYW4gYmUgc2VyaWFs\naXplZCwgcmV0dXJuIHRoZSBvYmplY3QgaXRzZWxmPC9saT4KICAgICAqIDxs\naT5pZiB0aGUgb2JqZWN0IGhhcyBhIHNlcmlhbGl6YWJsZSBvaWQsIHJldHVy\nbiB0aGUgb2lkPC9saT4KICAgICAqIDxsaT5pZiB0aGUgb2JqZWN0IGhhcyBh\nIG5vbi1zZXJpYWxpemFibGUgb2lkLCByZXR1cm4gdGhlIG9pZCdzCiAgICAg\nKiB0b1N0cmluZyBhbmQgdGhlIG9iamVjdCBjbGFzczwvbGk+CiAgICAgKiA8\nbGk+cmV0dXJuIHRoZSBvYmplY3QncyB0b1N0cmluZzwvbGk+CiAgICAgKiA8\nL3VsPgogICAgICoKICAgICAqIEBwYXJhbSBvYiB0aGUgb2JqZWN0IHRvIGNv\nbnZlcnQKICAgICAqIEByZXR1cm4gc29tZSBzZXJpYWxpemVkIHJlcHJlc2Vu\ndGF0aW9uIG9mIHRoZSBvYmplY3QKICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBPYmplY3QgcmVwbGFjZUZhaWxlZE9iamVjdChPYmplY3Qgb2IpIHsKICAg\nICAgICBpZiAob2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgaWYgKGlzU2VyaWFsaXphYmxlKG9iKSkKICAgICAgICAgICAg\ncmV0dXJuIG9iOwoKICAgICAgICAvLyBkb24ndCB0YWtlIG9pZCBvZiBuZXcg\nb2JqZWN0cyBzaW5jZSBpdCBjYW4gY2F1c2UgYSBmbHVzaCBpZiBhdXRvLWlu\nYwogICAgICAgIC8vIGFuZCB0aGUgaWQgaXMgbWVhbmluZ2xlc3MgYW55d2F5\nCiAgICAgICAgT2JqZWN0IG9pZCA9IGdldE9iamVjdElkKG9iKTsKICAgICAg\nICBpZiAob2lkICE9IG51bGwgJiYgaXNTZXJpYWxpemFibGUob2lkKSkKICAg\nICAgICAgICAgcmV0dXJuIG9pZDsKCiAgICAgICAgLy8gbGFzdCBkaXRjaDog\nc3RyaW5naWZ5IHRoZSBvYmplY3QKICAgICAgICByZXR1cm4gdG9TdHJpbmco\nb2IpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIHRocm93YWJsZXMgaW50byBhIHNlcmlhbHphYmxlIGFycmF5LiBJZgog\nICAgICogYW55IG9mIHRoZSBuZXN0ZWQgdGhyb3dhYmxlcyBjYW5ub3QgYmUg\nc2VyaWFsaXplZCwgdGhleSB3aWxsCiAgICAgKiBiZSBjb252ZXJ0ZWQgaW50\nbyBhIEV4Y2VwdGlvbiB3aXRoIHRoZSBvcmlnaW5hbCBtZXNzYWdlLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIFRocm93YWJsZVtdIHJlcGxhY2VOZXN0\nZWRUaHJvd2FibGVzKFRocm93YWJsZVtdIG5lc3RlZCkgewogICAgICAgIGlm\nIChuZXN0ZWQgPT0gbnVsbCB8fCBuZXN0ZWQubGVuZ3RoID09IDApCiAgICAg\nICAgICAgIHJldHVybiBuZXN0ZWQ7CiAgICAgICAgaWYgKGlzU2VyaWFsaXph\nYmxlKG5lc3RlZCkpCiAgICAgICAgICAgIHJldHVybiBuZXN0ZWQ7CgogICAg\nICAgIFRocm93YWJsZVtdIG5ld05lc3RlZCA9IG5ldyBUaHJvd2FibGVbbmVz\ndGVkLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBuZXN0\nZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGlzU2VyaWFsaXph\nYmxlKG5lc3RlZFtpXSkpCiAgICAgICAgICAgICAgICBuZXdOZXN0ZWRbaV0g\nPSBuZXN0ZWRbaV07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIG5ld05lc3RlZFtpXSA9IG5ldyBFeGNlcHRpb24obmVzdGVkW2ldLnRvU3Ry\naW5nKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3TmVzdGVkOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBvYmplY3QgaWQgZm9y\nIDxjb2RlPm9iPC9jb2RlPiBpZiBpdCBoYXMgb25lLCBvcgogICAgICogPGNv\nZGU+bnVsbDwvY29kZT4gb3RoZXJ3aXNlLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBPYmplY3QgZ2V0T2JqZWN0SWQoT2JqZWN0IG9iKSB7CiAgICAg\nICAgaWYgKCFJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYikpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMgPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iLCBudWxs\nKTsKICAgICAgICBpZiAocGMgPT0gbnVsbCB8fCBwYy5wY0lzTmV3KCkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgcmV0dXJuIHBjLnBjRmV0Y2hPYmplY3RJZCgpOwoJfQp9Cg==\n","encoding":"base64"}

