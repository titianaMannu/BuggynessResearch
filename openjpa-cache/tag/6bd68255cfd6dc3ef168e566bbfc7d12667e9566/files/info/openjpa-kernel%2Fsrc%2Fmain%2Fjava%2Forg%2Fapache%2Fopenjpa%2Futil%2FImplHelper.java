{"sha":"3a416da3df129bab4ae7991af0a8c8f4620ec690","node_id":"MDQ6QmxvYjIwNjM2NDozYTQxNmRhM2RmMTI5YmFiNGFlNzk5MWFmMGE4YzhmNDYyMGVjNjkw","size":11938,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3a416da3df129bab4ae7991af0a8c8f4620ec690","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5o\nYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmVuaGFuY2UuU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmVuaGFuY2UuTWFuYWdlZEluc3RhbmNlUHJvdmlkZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5SZWZsZWN0aW5nUGVy\nc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuUnVudGltZVVuZW5oYW5jZWRDbGFzc3Nlc01vZGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3Rh\ndGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Q\nQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9y\nZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5DbG9zZWFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuUmVmZXJlbmNlTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLlVVSURHZW5lcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50UmVmZXJlbmNlSGFz\naE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5\ncGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVl\nU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9w\nZW5KUEFDb25maWd1cmF0aW9uOwoKLyoqCiAqIEhlbHBlciBmb3IgT3BlbkpQ\nQSBiYWNrLWVuZHMuCiAqCiAqIEBzaW5jZSAwLjMuMAogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgSW1wbEhl\nbHBlciB7CgogICAgLy8gQ2FjaGUgZm9yIGZyb20vdG8gdHlwZSBhc3NpZ25t\nZW50cwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF9hc3NpZ25hYmxl\nVHlwZXMgPQogICAgICAgIG5ldyBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1h\ncChSZWZlcmVuY2VNYXAuV0VBSywgUmVmZXJlbmNlTWFwLkhBUkQpOwoKICAg\nIC8vIG1hcCBvZiBhbGwgbmV3IHVuZW5oYW5jZWQgaW5zdGFuY2VzIGFjdGl2\nZSBpbiB0aGlzIGNsYXNzbG9hZGVyCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIE1hcCBfdW5lbmhhbmNlZEluc3RhbmNlTWFwID0KICAgICAgICBuZXcgQ29u\nY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoUmVmZXJlbmNlTWFwLldFQUssIFJl\nZmVyZW5jZU1hcC5IQVJEKSB7CgogICAgICAgICAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBlcShPYmplY3QgeCwgT2JqZWN0IHkpIHsKICAgICAgICAgICAgICAg\nIC8vIHRoZSBFbnRyaWVzIGluIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFw\nIGRlbGVnYXRlIGJhY2sgdG8KICAgICAgICAgICAgICAgIC8vIGVxKCkgaW4g\ndGhlaXIgZXF1YWxzKCkgaW1wbHMKICAgICAgICAgICAgICAgIGlmICh4IGlu\nc3RhbmNlb2YgTWFwLkVudHJ5KQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBzdXBlci5lcSh4LCB5KTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4geCA9PSB5OwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwcm90ZWN0ZWQgaW50IGhjKE9iamVjdCBvKSB7CiAgICAg\nICAgICAgICAgICAvLyB0aGUgRW50cmllcyBpbiBDb25jdXJyZW50UmVmZXJl\nbmNlSGFzaE1hcCBkZWxlZ2F0ZSBiYWNrIHRvCiAgICAgICAgICAgICAgICAv\nLyBoYygpIGluIHRoZWlyIGhhc2hDb2RlKCkgaW1wbHMKICAgICAgICAgICAg\nICAgIGlmIChvIGluc3RhbmNlb2YgTWFwLkVudHJ5KQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBlci5oYyhvKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3lzdGVtLmlkZW50aXR5\nSGFzaENvZGUobyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgIC8q\nKgogICAgICogSGVscGVyIGZvciBzdG9yZSBtYW5hZ2VyIGltcGxlbWVudGF0\naW9ucy4gVGhpcyBtZXRob2Qgc2ltcGx5IGRlbGVnYXRlcwogICAgICogdG8g\ndGhlIHByb3BlciBzaW5ndWxhciBtZXRob2QgZm9yIGVhY2ggc3RhdGUgbWFu\nYWdlci4KICAgICAqCiAgICAgKiBAc2VlIFN0b3JlTWFuYWdlciNsb2FkQWxs\nCiAgICAgKiBAc2luY2UgMC40LjAKICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBDb2xsZWN0aW9uIGxvYWRBbGwoQ29sbGVjdGlvbiBzbXMsIFN0b3JlTWFu\nYWdlciBzdG9yZSwKICAgICAgICBQQ1N0YXRlIHN0YXRlLCBpbnQgbG9hZCwg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4dCkgewog\nICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gbnVsbDsKICAgICAgICBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtOwogICAgICAgIExvY2tNYW5hZ2VyIGxtOwog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoIXN0b3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgY29udGV4\ndCkpCiAgICAgICAgICAgICAgICAgICAgZmFpbGVkID0gYWRkRmFpbGVkSWQo\nc20sIGZhaWxlZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobG9hZCAhPSBT\ndG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FCiAgICAgICAgICAgICAgICB8\nfCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAgICAg\nICAgICAgICAgIGxtID0gc20uZ2V0Q29udGV4dCgpLmdldExvY2tNYW5hZ2Vy\nKCk7CiAgICAgICAgICAgICAgICBpZiAoIXN0b3JlLmxvYWQoc20sIHNtLmdl\ndFVubG9hZGVkKGZldGNoKSwgZmV0Y2gsIAogICAgICAgICAgICAgICAgICAg\nIGxtLmdldExvY2tMZXZlbChzbSksIGNvbnRleHQpKQogICAgICAgICAgICAg\nICAgICAgIGZhaWxlZCA9IGFkZEZhaWxlZElkKHNtLCBmYWlsZWQpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKCFzdG9yZS5leGlzdHMoc20sIGNvbnRleHQp\nKQogICAgICAgICAgICAgICAgZmFpbGVkID0gYWRkRmFpbGVkSWQoc20sIGZh\naWxlZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoZmFpbGVkID09IG51\nbGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IGZhaWxlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBpZGVudGl0eSBvZiBnaXZlbiBpbnN0YW5j\nZSB0byBjb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBD\nb2xsZWN0aW9uIGFkZEZhaWxlZElkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nCiAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQpIHsKICAgICAgICBpZiAoZmFp\nbGVkID09IG51bGwpCiAgICAgICAgICAgIGZhaWxlZCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICBmYWlsZWQuYWRkKHNtLmdldElkKCkpOwogICAgICAg\nIHJldHVybiBmYWlsZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gbWV0YWRhdGEsIG9yIHJldHVybiBu\ndWxsLiBHZW5lcmF0ZXMKICAgICAqIHZhbHVlcyBmb3IgaHRlIGZvbGxvd2lu\nZyBzdHJhdGVnaWVzOiB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzI1NFUVVFTkNF\nfSwKICAgICAqIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXMjVVVJRF9TVFJJTkd9\nLCB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzI1VVSURfSEVYfQogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZW5lcmF0ZUlkZW50aXR5VmFsdWUo\nU3RvcmVDb250ZXh0IGN0eCwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEs\nIGludCB0eXBlQ29kZSkgewogICAgICAgIHJldHVybiBnZW5lcmF0ZVZhbHVl\nKGN0eCwgbWV0YSwgbnVsbCwgdHlwZUNvZGUpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2VuZXJhdGUgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIG1ldGFkYXRh\nLCBvciByZXR1cm4gbnVsbC4gR2VuZXJhdGVzCiAgICAgKiB2YWx1ZXMgZm9y\nIGh0ZSBmb2xsb3dpbmcgc3RyYXRlZ2llczoge0BsaW5rIFZhbHVlU3RyYXRl\nZ2llcyNTRVFVRU5DRX0sCiAgICAgKiB7QGxpbmsgVmFsdWVTdHJhdGVnaWVz\nI1VVSURfU1RSSU5HfSwge0BsaW5rIFZhbHVlU3RyYXRlZ2llcyNVVUlEX0hF\nWH0KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2VuZXJhdGVG\naWVsZFZhbHVlKFN0b3JlQ29udGV4dCBjdHgsCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gZ2VuZXJhdGVWYWx1ZShjdHgs\nIGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCksIGZtZCwgCiAgICAgICAgICAg\nIGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2VuZXJhdGUgYSB2YWx1ZSBmb3IgdGhlIGdpdmVuIG1ldGFkYWEu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZW5lcmF0ZVZh\nbHVlKFN0b3JlQ29udGV4dCBjdHgsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhLCBGaWVsZE1ldGFEYXRhIGZtZCwgaW50IHR5cGVDb2RlKSB7CiAgICAg\nICAgaW50IHN0cmF0ZWd5ID0gKGZtZCA9PSBudWxsKSA/IG1ldGEuZ2V0SWRl\nbnRpdHlTdHJhdGVneSgpCiAgICAgICAgICAgIDogZm1kLmdldFZhbHVlU3Ry\nYXRlZ3koKTsKICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7CiAgICAgICAg\nICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFOgogICAgICAgICAg\nICAgICAgU2VxdWVuY2VNZXRhRGF0YSBzbWQgPSAoZm1kID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgPyBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VN\nZXRhRGF0YSgpCiAgICAgICAgICAgICAgICAgICAgOiBmbWQuZ2V0VmFsdWVT\nZXF1ZW5jZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gSmF2\nYVR5cGVzLmNvbnZlcnQoc21kLmdldEluc3RhbmNlKGN0eC5nZXRDbGFzc0xv\nYWRlcigpKS4KICAgICAgICAgICAgICAgICAgICBuZXh0KGN0eCwgbWV0YSks\nIHR5cGVDb2RlKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMu\nVVVJRF9TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJREdlbmVy\nYXRvci5uZXh0U3RyaW5nKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJh\ndGVnaWVzLlVVSURfSEVYOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURH\nZW5lcmF0b3IubmV4dEhleCgpOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKiAKICAgICAqIFJldHVybnMgdGhlIGZpZWxkcyBvZiB0aGUgc3RhdGUg\ndGhhdCByZXF1aXJlIGFuIHVwZGF0ZS4gCiAgICAgKiAgCiAgICAgKiBAcGFy\nYW0gIHNtICB0aGUgc3RhdGUgdG8gY2hlY2sKICAgICAqIEByZXR1cm4gdGhl\nIEJpdFNldCBvZiBmaWVsZHMgdGhhdCBuZWVkIHVwZGF0ZSwgb3IgbnVsbCBp\nZiBub25lCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQml0U2V0IGdldFVw\nZGF0ZUZpZWxkcyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAg\naWYgKChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QRElSVFkKICAgICAg\nICAgICAgJiYgKCFzbS5pc0ZsdXNoZWQoKSB8fCBzbS5pc0ZsdXNoZWREaXJ0\neSgpKSkKICAgICAgICAgICAgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLlBORVcgJiYgc20uaXNGbHVzaGVkRGlydHkoKSkpIHsKICAgICAgICAg\nICAgQml0U2V0IGRpcnR5ID0gc20uZ2V0RGlydHkoKTsKICAgICAgICAgICAg\naWYgKHNtLmlzRmx1c2hlZCgpKSB7CiAgICAgICAgICAgICAgICBkaXJ0eSA9\nIChCaXRTZXQpIGRpcnR5LmNsb25lKCk7CiAgICAgICAgICAgICAgICBkaXJ0\neS5hbmROb3Qoc20uZ2V0Rmx1c2hlZCgpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoZGlydHkubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGRpcnR5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBnaXZlbiByZXNv\ndXJjZS4gVGhlIHJlc291cmNlIGNhbiBiZSBhbiBleHRlbnQgaXRlcmF0b3Is\nCiAgICAgKiBxdWVyeSByZXN1bHQsIGxhcmdlIHJlc3VsdCBzZXQgcmVsYXRp\nb24sIG9yIGFueSBjbG9zZWFibGUgT3BlbkpQQQogICAgICogY29tcG9uZW50\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY2xvc2UoT2JqZWN0\nIG8pIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobyBpbnN0YW5j\nZW9mIENsb3NlYWJsZSkKICAgICAgICAgICAgICAgICgoQ2xvc2VhYmxlKSBv\nKS5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB0cnVlIGlmIHRoZSBzcGVjaWZpZWQgY2xhc3MgaXMgYSB0eXBl\nIHRoYXQgY2FuIGJlIG1hbmFnZWQgYnkKICAgICAqIE9wZW5KUEEuCiAgICAg\nKgogICAgICogQHBhcmFtIHR5cGUgdGhlIGNsYXNzIHRvIHRlc3QKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY2xhc3MgaXMgbWFuYWdlYWJsZS4KICAg\nICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBib29sZWFuIGlzTWFuYWdlZFR5cGUoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQ2xhc3MgdHlwZSkgewogICAgICAgIHJldHVybiAoUGVyc2lz\ndGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkKICAg\nICAgICAgICAgfHwgKHR5cGUgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYg\nKGNvbmYgPT0gbnVsbCB8fCBjb25mLmdldFJ1bnRpbWVVbmVuaGFuY2VkQ2xh\nc3Nlc0NvbnN0YW50KCkKICAgICAgICAgICAgICAgICAgICA9PSBSdW50aW1l\nVW5lbmhhbmNlZENsYXNzc2VzTW9kZXMuU1VQUE9SVEVEKQogICAgICAgICAg\nICAgICAgJiYgUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQodHlwZSkpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgc3BlY2lm\naWVkIGluc3RhbmNlIGlzIG1hbmFnZWFibGUuCiAgICAgKgogICAgICogQHBh\ncmFtIGluc3RhbmNlIHRoZSBvYmplY3QgdG8gY2hlY2sKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiB0aGUgaW5zdGFuY2UgaXMgYSBwZXJzaXN0ZW50IHR5cGUs\nIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJv\nb2xlYW4gaXNNYW5hZ2VhYmxlKE9iamVjdCBpbnN0YW5jZSkgewogICAgICAg\nIHJldHVybiBpbnN0YW5jZSBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJs\nZQogICAgICAgICAgICB8fCBpbnN0YW5jZSAhPSBudWxsICYmIFBDUmVnaXN0\ncnkuaXNSZWdpc3RlcmVkKGluc3RhbmNlLmdldENsYXNzKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSByZWZlcmVuY2Vk\nICJ0byIgY2xhc3MgaXMgYXNzaWduYWJsZSB0byB0aGUgImZyb20iCiAgICAg\nKiBjbGFzcy4gIFRoaXMgaGVscGVyIG1ldGhvZCB1dGlsaXplcyBhIGNhY2hl\nIHRvIGhlbHAgYXZvaWQgdGhlIG92ZXJoZWFkCiAgICAgKiBvZiB0aGUgQ2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbSgpIG1ldGhvZC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZnJvbSB0YXJnZXQgY2xhc3MgaW5zdGFuY2UgdG8gYmUgY2hlY2tl\nZCBmb3IgYXNzaWduYWJpbGl0eQogICAgICogQHBhcmFtIHRvIHNlY29uZCBj\nbGFzcyBpbnN0YW5jZSB0byBiZSBjaGVja2VkIGZvciBhc3NpZ25hYmlsaXR5\nCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlICJ0byIgY2xhc3MgaXMgYXNz\naWduYWJsZSB0byB0aGUgImZyb20iIGNsYXNzCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgYm9vbGVhbiBpc0Fzc2lnbmFibGUoQ2xhc3MgZnJvbSwgQ2xh\nc3MgdG8pIHsKICAgICAgICBpZiAoZnJvbSA9PSBudWxsIHx8IHRvID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgQm9vbGVh\nbiBpc0Fzc2lnbmFibGUgPSBudWxsOwogICAgICAgIE1hcCBhc3NpZ25hYmxl\nVG8gPSAoTWFwKSBfYXNzaWduYWJsZVR5cGVzLmdldChmcm9tKTsKICAgICAg\nICBpZiAoYXNzaWduYWJsZVRvID09IG51bGwpIHsgLy8gInRvIiBjYWNoZSBk\nb2Vzbid0IGV4aXN0LCBzbyBjcmVhdGUgaXQuLi4KICAgICAgICAgICAgYXNz\naWduYWJsZVRvID0gbmV3IENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwKFJl\nZmVyZW5jZU1hcC5XRUFLLAogICAgICAgICAgICAgICAgICAgIFJlZmVyZW5j\nZU1hcC5IQVJEKTsKICAgICAgICAgICAgX2Fzc2lnbmFibGVUeXBlcy5wdXQo\nZnJvbSwgYXNzaWduYWJsZVRvKTsKICAgICAgICB9IGVsc2UgeyAvLyAidG8i\nIGNhY2hlIGV4aXN0cy4uLgogICAgICAgICAgICBpc0Fzc2lnbmFibGUgPSAo\nQm9vbGVhbikgYXNzaWduYWJsZVRvLmdldCh0byk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoaXNBc3NpZ25hYmxlID09IG51bGwpIHsvLyB3ZSBkb24ndCBo\nYXZlIGEgcmVjb3JkIG9mIHRoaXMgcGFpci4uLgogICAgICAgICAgICBpc0Fz\nc2lnbmFibGUgPSBCb29sZWFuLnZhbHVlT2YoZnJvbS5pc0Fzc2lnbmFibGVG\ncm9tKHRvKSk7CiAgICAgICAgICAgIGFzc2lnbmFibGVUby5wdXQodG8sIGlz\nQXNzaWduYWJsZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaXNBc3Np\nZ25hYmxlLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nQHJldHVybiB0aGUgcGVyc2lzdGVuY2UtY2FwYWJsZSBpbnN0YW5jZSByZXNw\nb25zaWJsZSBmb3IgbWFuYWdpbmcKICAgICAqIDxjb2RlPm88L2NvZGU+LCBv\nciA8Y29kZT5udWxsPC9jb2RlPiBpZiA8Y29kZT5vPC9jb2RlPiBpcyBub3Qg\nbWFuYWdlYWJsZS4KICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIFBlcnNpc3RlbmNlQ2FwYWJsZSB0b1BlcnNpc3RlbmNl\nQ2FwYWJsZShPYmplY3QgbywgT2JqZWN0IGN0eCl7CiAgICAgICAgaWYgKG8g\naW5zdGFuY2VvZiBQZXJzaXN0ZW5jZUNhcGFibGUpCiAgICAgICAgICAgIHJl\ndHVybiAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvOwoKICAgICAgICBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAgICAgICBpZiAoY3R4IGlu\nc3RhbmNlb2YgT3BlbkpQQUNvbmZpZ3VyYXRpb24pCiAgICAgICAgICAgIGNv\nbmYgPSAoT3BlbkpQQUNvbmZpZ3VyYXRpb24pIGN0eDsKICAgICAgICBlbHNl\nIGlmIChjdHggaW5zdGFuY2VvZiBTdGF0ZU1hbmFnZXIKICAgICAgICAgICAg\nJiYgKChTdGF0ZU1hbmFnZXIpIGN0eCkuZ2V0R2VuZXJpY0NvbnRleHQoKSBp\nbnN0YW5jZW9mIFN0b3JlQ29udGV4dCkKICAgICAgICAgICAgY29uZiA9ICgo\nU3RvcmVDb250ZXh0KSAoKFN0YXRlTWFuYWdlcikgY3R4KS5nZXRHZW5lcmlj\nQ29udGV4dCgpKQogICAgICAgICAgICAgICAgLmdldENvbmZpZ3VyYXRpb24o\nKTsKCiAgICAgICAgaWYgKCFpc01hbmFnZWFibGUobykpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAvLyBpZiB3ZSBoYWQgYSBwdXRJZkFi\nc2VudCgpIG1ldGhvZCwgd2Ugd291bGRuJ3QgbmVlZCB0byBzeW5jIGhlcmUK\nICAgICAgICBzeW5jaHJvbml6ZWQgKG8pIHsKICAgICAgICAgICAgUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjID0gKFBlcnNpc3RlbmNlQ2FwYWJsZSkKICAgICAg\nICAgICAgICAgIF91bmVuaGFuY2VkSW5zdGFuY2VNYXAuZ2V0KG8pOwoKICAg\nICAgICAgICAgaWYgKHBjICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gcGM7CgogICAgICAgICAgICAvLyBpZiB3ZSBkb24ndCBoYXZlIGEgY29u\nZiBwYXNzZWQgaW4sIHRoZW4gd2UgY2FuJ3QgY3JlYXRlIGEgbmV3CiAgICAg\nICAgICAgIC8vIFJlZmxlY3RpbmdQQzsgdGhpcyB3aWxsIG9ubHkgYmUgdGhl\nIGNhc2Ugd2hlbiBpbnZva2VkIGZyb20gYQogICAgICAgICAgICAvLyBjb250\nZXh0IG91dHNpZGUgb2YgT3BlbkpQQS4KICAgICAgICAgICAgaWYgKGNvbmYg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAgICAgcGMgPSBuZXcgUmVmbGVjdGluZ1BlcnNpc3RlbmNlQ2FwYWJsZShv\nLCBjb25mKTsKICAgICAgICAgICAgX3VuZW5oYW5jZWRJbnN0YW5jZU1hcC5w\ndXQobywgcGMpOwogICAgICAgICAgICByZXR1cm4gcGM7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQHJldHVybiB0aGUgdXNlci12aXNpYmxl\nIHJlcHJlc2VudGF0aW9uIG9mIDxjb2RlPm88L2NvZGU+LgogICAgICogQHNp\nbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGdl\ndE1hbmFnZWRJbnN0YW5jZShPYmplY3QgbykgewogICAgICAgIGlmIChvIGlu\nc3RhbmNlb2YgTWFuYWdlZEluc3RhbmNlUHJvdmlkZXIpCiAgICAgICAgICAg\nIHJldHVybiAoKE1hbmFnZWRJbnN0YW5jZVByb3ZpZGVyKSBvKS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVy\nbiBvOwogICAgfQp9Cg==\n","encoding":"base64"}

