{"sha":"9e325dab52b4f967b4cbd5b5640cb435c52ab5c5","node_id":"MDQ6QmxvYjIwNjM2NDo5ZTMyNWRhYjUyYjRmOTY3YjRjYmQ1YjU2NDBjYjQzNWM1MmFiNWM1","size":59817,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9e325dab52b4f967b4cbd5b5640cb435c52ab5c5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQg\namF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb247CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkNv\nbnN0cnVjdG9yOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZh\nLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNlY3Vy\naXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZhLnNx\nbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBv\ncnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRh\ncjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0\nIGphdmEudXRpbC5HcmVnb3JpYW5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0Owpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQgamF2YS51dGlsLlNv\ncnRlZFNldDsKaW1wb3J0IGphdmEudXRpbC5UaW1lWm9uZTsKaW1wb3J0IGph\ndmEudXRpbC5UcmVlTWFwOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmls\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1By\naXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSmF2YVZlcnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBzZXJw\nLmJ5dGVjb2RlLkJDQ2xhc3M7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDRmll\nbGQ7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDTWV0aG9kOwppbXBvcnQgc2Vy\ncC5ieXRlY29kZS5Db2RlOwppbXBvcnQgc2VycC5ieXRlY29kZS5KdW1wSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9y\ndCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBEZWZhdWx0IGltcGxlbWVu\ndGF0aW9uIG9mIHRoZSB7QGxpbmsgUHJveHlNYW5hZ2VyfSBpbnRlcmZhY2Uu\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgUHJv\neHlNYW5hZ2VySW1wbAogICAgaW1wbGVtZW50cyBQcm94eU1hbmFnZXIgewoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBQUk9YWV9TVUZGSVgg\nPSAiJHByb3h5IjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFByb3h5\nTWFuYWdlckltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGljIGxvbmcg\nX3Byb3h5SWQgPSAwTDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1hcCBf\nc3RkQ29sbGVjdGlvbnMgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTWFwIF9zdGRNYXBzID0gbmV3IEhhc2hNYXAoKTsKICAg\nIHN0YXRpYyB7CiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChDb2xsZWN0\naW9uLmNsYXNzLCBBcnJheUxpc3QuY2xhc3MpOwogICAgICAgIF9zdGRDb2xs\nZWN0aW9ucy5wdXQoU2V0LmNsYXNzLCBIYXNoU2V0LmNsYXNzKTsKICAgICAg\nICBfc3RkQ29sbGVjdGlvbnMucHV0KFNvcnRlZFNldC5jbGFzcywgVHJlZVNl\ndC5jbGFzcyk7CiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChMaXN0LmNs\nYXNzLCBBcnJheUxpc3QuY2xhc3MpOwogICAgICAgIGlmIChKYXZhVmVyc2lv\nbnMuVkVSU0lPTiA+PSA1KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBDbGFzcyBxdWV1ZSA9IChDbGFzcykgQWNjZXNzQ29udHJvbGxl\ncgogICAgICAgICAgICAgICAgICAgIC5kb1ByaXZpbGVnZWQoSjJEb1ByaXZI\nZWxwZXIuZ2V0Rm9yTmFtZUFjdGlvbigKICAgICAgICAgICAgICAgICAgICAg\nICAgImphdmEudXRpbC5RdWV1ZSIsIGZhbHNlLAogICAgICAgICAgICAgICAg\nICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC5kb1ByaXZpbGVnZWQoSjJEb1ByaXZI\nZWxwZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q2xh\nc3NMb2FkZXJBY3Rpb24oQ29sbGVjdGlvbi5jbGFzcykpKSk7CiAgICAgICAg\nICAgICAgICBfc3RkQ29sbGVjdGlvbnMucHV0KHF1ZXVlLCBMaW5rZWRMaXN0\nLmNsYXNzKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICAgICAgICAgIC8vIG5vdCByZWFsbHkgamF2YSA1IGFmdGVyIGFs\nbD8KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3N0ZE1hcHMu\ncHV0KE1hcC5jbGFzcywgSGFzaE1hcC5jbGFzcyk7CiAgICAgICAgX3N0ZE1h\ncHMucHV0KFNvcnRlZE1hcC5jbGFzcywgVHJlZU1hcC5jbGFzcyk7CiAgICB9\nCgogICAgcHJpdmF0ZSBmaW5hbCBTZXQgX3VucHJveHlhYmxlID0gbmV3IEhh\nc2hTZXQoKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9wcm94aWVzID0gbmV3\nIENvbmN1cnJlbnRIYXNoTWFwKCk7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Ry\nYWNrQ2hhbmdlcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Fzc2Vy\ndFR5cGUgPSBmYWxzZTsKCiAgICBwdWJsaWMgUHJveHlNYW5hZ2VySW1wbCgp\nIHsKICAgICAgICBfdW5wcm94eWFibGUuYWRkKFRpbWVab25lLmNsYXNzLmdl\ndE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByb3hp\nZXMgcHJvZHVjZWQgYnkgdGhpcyBmYWN0b3J5IHdpbGwgdXNlIHtAbGluayBD\naGFuZ2VUcmFja2VyfXMKICAgICAqIHRvIHRyeSB0byBjdXQgZG93biBvbiBk\nYXRhIHN0b3JlIG9wZXJhdGlvbnMgYXQgdGhlIGNvc3Qgb2Ygc29tZSBleHRy\nYQogICAgICogYm9va2tlZXBpbmcgb3ZlcmhlYWQuIERlZmF1bHRzIHRvIHRy\ndWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFRyYWNrQ2hhbmdl\ncygpIHsKICAgICAgICByZXR1cm4gX3RyYWNrQ2hhbmdlczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgcHJveGllcyBwcm9kdWNlZCBieSB0aGlz\nIGZhY3Rvcnkgd2lsbCB1c2Uge0BsaW5rIENoYW5nZVRyYWNrZXJ9cwogICAg\nICogdG8gdHJ5IHRvIGN1dCBkb3duIG9uIGRhdGEgc3RvcmUgb3BlcmF0aW9u\ncyBhdCB0aGUgY29zdCBvZiBzb21lIGV4dHJhCiAgICAgKiBib29ra2VlcGlu\nZyBvdmVyaGVhZC4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0VHJhY2tDaGFuZ2VzKGJvb2xlYW4gdHJhY2spIHsKICAg\nICAgICBfdHJhY2tDaGFuZ2VzID0gdHJhY2s7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHRvIHBlcmZvcm0gcnVudGltZSBjaGVja3MgdG8gZW5z\ndXJlIHRoYXQgYWxsIGVsZW1lbnRzCiAgICAgKiBhZGRlZCB0byBjb2xsZWN0\naW9uIGFuZCBtYXAgcHJveGllcyBhcmUgdGhlIHByb3BlciBlbGVtZW50L2tl\neS92YWx1ZQogICAgICogdHlwZSBhcyBkZWZpbmVkIGJ5IHRoZSBtZXRhZGF0\nYS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGdldEFzc2VydEFsbG93ZWRUeXBlKCkgewogICAgICAgIHJldHVybiBf\nYXNzZXJ0VHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8g\ncGVyZm9ybSBydW50aW1lIGNoZWNrcyB0byBlbnN1cmUgdGhhdCBhbGwgZWxl\nbWVudHMKICAgICAqIGFkZGVkIHRvIGNvbGxlY3Rpb24gYW5kIG1hcCBwcm94\naWVzIGFyZSB0aGUgcHJvcGVyIGVsZW1lbnQva2V5L3ZhbHVlCiAgICAgKiB0\neXBlIGFzIGRlZmluZWQgYnkgdGhlIG1ldGFkYXRhLiBEZWZhdWx0cyB0byBm\nYWxzZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXNzZXJ0QWxsb3dl\nZFR5cGUoYm9vbGVhbiBhc3NlcnRUeXBlKSB7CiAgICAgICAgX2Fzc2VydFR5\ncGUgPSBhc3NlcnRUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgbXV0YWJsZSB2aWV3IG9mIGNsYXNzIG5hbWVzIHdlIGtub3cgY2Fubm90\nIGJlIHByb3hpZWQgIAogICAgICogY29ycmVjdGx5IGJ5IHRoaXMgbWFuYWdl\nci4KICAgICAqLwogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VW5wcm94eWFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIF91bnByb3h5YWJsZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFByb3ZpZGVkIGZvciBhdXRvLWNvbmZpZ3VyYXRpb24u\nICBBZGQgdGhlIGdpdmVuIHNlbWljb2xvbi1zZXBhcmF0ZWQKICAgICAqIGNs\nYXNzIG5hbWVzIHRvIHRoZSBzZXQgb2YgY2xhc3MgbmFtZXMgd2Uga25vdyBj\nYW5ub3QgYmUgcHJveGllZCBjb3JyZWN0bHkKICAgICAqIGJ5IHRoaXMgbWFu\nYWdlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VW5wcm94eWFibGUo\nU3RyaW5nIGNsc05hbWVzKSB7CiAgICAgICAgaWYgKGNsc05hbWVzICE9IG51\nbGwpCiAgICAgICAgICAgIF91bnByb3h5YWJsZS5hZGRBbGwoQXJyYXlzLmFz\nTGlzdChTdHJpbmdzLnNwbGl0KGNsc05hbWVzLCAiOyIsIDApKSk7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBjb3B5QXJyYXkoT2JqZWN0IG9yaWcpIHsK\nICAgICAgICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGxlbmd0aCA9\nIEFycmF5LmdldExlbmd0aChvcmlnKTsKICAgICAgICAgICAgT2JqZWN0IGFy\ncmF5ID0gQXJyYXkubmV3SW5zdGFuY2Uob3JpZy5nZXRDbGFzcygpLgogICAg\nICAgICAgICAgICAgZ2V0Q29tcG9uZW50VHlwZSgpLCBsZW5ndGgpOwoKICAg\nICAgICAgICAgU3lzdGVtLmFycmF5Y29weShvcmlnLCAwLCBhcnJheSwgMCwg\nbGVuZ3RoKTsKICAgICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWFycmF5IiwKICAg\nICAgICAgICAgICAgIGUuZ2V0TWVzc2FnZSgpKSwgZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHlDb2xsZWN0aW9uKENv\nbGxlY3Rpb24gb3JpZykgewogICAgICAgIGlmIChvcmlnID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3Rh\nbmNlb2YgUHJveHkpCiAgICAgICAgICAgIHJldHVybiAoQ29sbGVjdGlvbikg\nKChQcm94eSkgb3JpZykuY29weShvcmlnKTsKCiAgICAgICAgUHJveHlDb2xs\nZWN0aW9uIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5Q29sbGVjdGlvbihvcmln\nLmdldENsYXNzKCkpOwogICAgICAgIHJldHVybiAoQ29sbGVjdGlvbikgcHJv\neHkuY29weShvcmlnKTsKICAgIH0KCiAgICBwdWJsaWMgUHJveHkgbmV3Q29s\nbGVjdGlvblByb3h5KENsYXNzIHR5cGUsIENsYXNzIGVsZW1lbnRUeXBlLAog\nICAgICAgIENvbXBhcmF0b3IgY29tcGFyZSkgewogICAgICAgIHR5cGUgPSB0\nb1Byb3h5YWJsZUNvbGxlY3Rpb25UeXBlKHR5cGUpOwogICAgICAgIFByb3h5\nQ29sbGVjdGlvbiBwcm94eSA9IGdldEZhY3RvcnlQcm94eUNvbGxlY3Rpb24o\ndHlwZSk7CiAgICAgICAgcmV0dXJuIHByb3h5Lm5ld0luc3RhbmNlKChfYXNz\nZXJ0VHlwZSkgPyBlbGVtZW50VHlwZSA6IG51bGwsIGNvbXBhcmUsCiAgICAg\nICAgICAgIF90cmFja0NoYW5nZXMpOwogICAgfQoKICAgIHB1YmxpYyBNYXAg\nY29weU1hcChNYXAgb3JpZykgewogICAgICAgIGlmIChvcmlnID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGlu\nc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAgIHJldHVybiAoTWFwKSAoKFBy\nb3h5KSBvcmlnKS5jb3B5KG9yaWcpOwoKICAgICAgICBQcm94eU1hcCBwcm94\neSA9IGdldEZhY3RvcnlQcm94eU1hcChvcmlnLmdldENsYXNzKCkpOwogICAg\nICAgIHJldHVybiAoTWFwKSBwcm94eS5jb3B5KG9yaWcpOwogICAgfQoKICAg\nIHB1YmxpYyBQcm94eSBuZXdNYXBQcm94eShDbGFzcyB0eXBlLCBDbGFzcyBr\nZXlUeXBlLCAKICAgICAgICBDbGFzcyBlbGVtZW50VHlwZSwgQ29tcGFyYXRv\nciBjb21wYXJlKSB7CiAgICAgICAgdHlwZSA9IHRvUHJveHlhYmxlTWFwVHlw\nZSh0eXBlKTsKICAgICAgICBQcm94eU1hcCBwcm94eSA9IGdldEZhY3RvcnlQ\ncm94eU1hcCh0eXBlKTsKICAgICAgICByZXR1cm4gcHJveHkubmV3SW5zdGFu\nY2UoKF9hc3NlcnRUeXBlKSA/IGtleVR5cGUgOiBudWxsLCAKICAgICAgICAg\nICAgKF9hc3NlcnRUeXBlKSA/IGVsZW1lbnRUeXBlIDogbnVsbCwgY29tcGFy\nZSwgX3RyYWNrQ2hhbmdlcyk7CiAgICB9CgogICAgcHVibGljIERhdGUgY29w\neURhdGUoRGF0ZSBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5z\ndGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuIChEYXRlKSAoKFBy\nb3h5KSBvcmlnKS5jb3B5KG9yaWcpOwoKICAgICAgICBQcm94eURhdGUgcHJv\neHkgPSBnZXRGYWN0b3J5UHJveHlEYXRlKG9yaWcuZ2V0Q2xhc3MoKSk7CiAg\nICAgICAgcmV0dXJuIChEYXRlKSBwcm94eS5jb3B5KG9yaWcpOwogICAgfQoK\nICAgIHB1YmxpYyBQcm94eSBuZXdEYXRlUHJveHkoQ2xhc3MgdHlwZSkgewog\nICAgICAgIFByb3h5RGF0ZSBwcm94eSA9IGdldEZhY3RvcnlQcm94eURhdGUo\ndHlwZSk7CiAgICAgICAgcmV0dXJuIHByb3h5Lm5ld0luc3RhbmNlKCk7CiAg\nICB9CgogICAgcHVibGljIENhbGVuZGFyIGNvcHlDYWxlbmRhcihDYWxlbmRh\nciBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBQ\ncm94eSkKICAgICAgICAgICAgcmV0dXJuIChDYWxlbmRhcikgKChQcm94eSkg\nb3JpZykuY29weShvcmlnKTsKCiAgICAgICAgUHJveHlDYWxlbmRhciBwcm94\neSA9IGdldEZhY3RvcnlQcm94eUNhbGVuZGFyKG9yaWcuZ2V0Q2xhc3MoKSk7\nCiAgICAgICAgcmV0dXJuIChDYWxlbmRhcikgcHJveHkuY29weShvcmlnKTsK\nICAgIH0KCiAgICBwdWJsaWMgUHJveHkgbmV3Q2FsZW5kYXJQcm94eShDbGFz\ncyB0eXBlLCBUaW1lWm9uZSB6b25lKSB7CiAgICAgICAgaWYgKHR5cGUgPT0g\nQ2FsZW5kYXIuY2xhc3MpCiAgICAgICAgICAgIHR5cGUgPSBHcmVnb3JpYW5D\nYWxlbmRhci5jbGFzczsKICAgICAgICBQcm94eUNhbGVuZGFyIHByb3h5ID0g\nZ2V0RmFjdG9yeVByb3h5Q2FsZW5kYXIodHlwZSk7CiAgICAgICAgUHJveHlD\nYWxlbmRhciBjYWwgPSBwcm94eS5uZXdJbnN0YW5jZSgpOwogICAgICAgIGlm\nICh6b25lICE9IG51bGwpCiAgICAgICAgICAgICgoQ2FsZW5kYXIpIGNhbCku\nc2V0VGltZVpvbmUoem9uZSk7CiAgICAgICAgcmV0dXJuIGNhbDsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGNvcHlDdXN0b20oT2JqZWN0IG9yaWcpIHsK\nICAgICAgICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIFByb3h5KQogICAg\nICAgICAgICByZXR1cm4gKChQcm94eSkgb3JpZykuY29weShvcmlnKTsKICAg\nICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob3JpZykpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNl\nb2YgQ29sbGVjdGlvbikKICAgICAgICAgICAgcmV0dXJuIGNvcHlDb2xsZWN0\naW9uKChDb2xsZWN0aW9uKSBvcmlnKTsKICAgICAgICBpZiAob3JpZyBpbnN0\nYW5jZW9mIE1hcCkKICAgICAgICAgICAgcmV0dXJuIGNvcHlNYXAoKE1hcCkg\nb3JpZyk7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBEYXRlKQogICAg\nICAgICAgICByZXR1cm4gY29weURhdGUoKERhdGUpIG9yaWcpOwogICAgICAg\nIGlmIChvcmlnIGluc3RhbmNlb2YgQ2FsZW5kYXIpCiAgICAgICAgICAgIHJl\ndHVybiBjb3B5Q2FsZW5kYXIoKENhbGVuZGFyKSBvcmlnKTsKICAgICAgICBQ\ncm94eUJlYW4gcHJveHkgPSBnZXRGYWN0b3J5UHJveHlCZWFuKG9yaWcpOwog\nICAgICAgIHJldHVybiAocHJveHkgPT0gbnVsbCkgPyBudWxsIDogcHJveHku\nY29weShvcmlnKTsgCiAgICB9CgogICAgcHVibGljIFByb3h5IG5ld0N1c3Rv\nbVByb3h5KE9iamVjdCBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcg\naW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuIChQcm94eSkg\nb3JpZzsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob3Jp\nZykpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmln\nIGluc3RhbmNlb2YgQ29sbGVjdGlvbikgewogICAgICAgICAgICBDb21wYXJh\ndG9yIGNvbXAgPSAob3JpZyBpbnN0YW5jZW9mIFNvcnRlZFNldCkgCiAgICAg\nICAgICAgICAgICA/ICgoU29ydGVkU2V0KSBvcmlnKS5jb21wYXJhdG9yKCkg\nOiBudWxsOwogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSAoQ29sbGVjdGlv\nbikgbmV3Q29sbGVjdGlvblByb3h5KG9yaWcuZ2V0Q2xhc3MoKSwgCiAgICAg\nICAgICAgICAgICBudWxsLCBjb21wKTsgCiAgICAgICAgICAgIGMuYWRkQWxs\nKChDb2xsZWN0aW9uKSBvcmlnKTsKICAgICAgICAgICAgcmV0dXJuIChQcm94\neSkgYzsKICAgICAgICB9CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBN\nYXApIHsKICAgICAgICAgICAgQ29tcGFyYXRvciBjb21wID0gKG9yaWcgaW5z\ndGFuY2VvZiBTb3J0ZWRNYXApIAogICAgICAgICAgICAgICAgPyAoKFNvcnRl\nZE1hcCkgb3JpZykuY29tcGFyYXRvcigpIDogbnVsbDsKICAgICAgICAgICAg\nTWFwIG0gPSAoTWFwKSBuZXdNYXBQcm94eShvcmlnLmdldENsYXNzKCksIG51\nbGwsIG51bGwsIGNvbXApOwogICAgICAgICAgICBtLnB1dEFsbCgoTWFwKSBv\ncmlnKTsKICAgICAgICAgICAgcmV0dXJuIChQcm94eSkgbTsKICAgICAgICB9\nCiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAg\nICAgIERhdGUgZCA9IChEYXRlKSBuZXdEYXRlUHJveHkob3JpZy5nZXRDbGFz\ncygpKTsKICAgICAgICAgICAgZC5zZXRUaW1lKCgoRGF0ZSkgb3JpZykuZ2V0\nVGltZSgpKTsKICAgICAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBUaW1l\nc3RhbXApCiAgICAgICAgICAgICAgICAoKFRpbWVzdGFtcCkgZCkuc2V0TmFu\nb3MoKChUaW1lc3RhbXApIG9yaWcpLmdldE5hbm9zKCkpOwogICAgICAgICAg\nICByZXR1cm4gKFByb3h5KSBkOwogICAgICAgIH0KICAgICAgICBpZiAob3Jp\nZyBpbnN0YW5jZW9mIENhbGVuZGFyKSB7CiAgICAgICAgICAgIENhbGVuZGFy\nIGMgPSAoQ2FsZW5kYXIpIG5ld0NhbGVuZGFyUHJveHkob3JpZy5nZXRDbGFz\ncygpLAogICAgICAgICAgICAgICAgKChDYWxlbmRhcikgb3JpZykuZ2V0VGlt\nZVpvbmUoKSk7CiAgICAgICAgICAgIGMuc2V0VGltZUluTWlsbGlzKCgoQ2Fs\nZW5kYXIpIG9yaWcpLmdldFRpbWVJbk1pbGxpcygpKTsKICAgICAgICAgICAg\ncmV0dXJuIChQcm94eSkgYzsKICAgICAgICB9CgogICAgICAgIFByb3h5QmVh\nbiBwcm94eSA9IGdldEZhY3RvcnlQcm94eUJlYW4ob3JpZyk7CiAgICAgICAg\ncmV0dXJuIChwcm94eSA9PSBudWxsKSA/IG51bGwgOiBwcm94eS5uZXdJbnN0\nYW5jZShvcmlnKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY29uY3JldGUgdHlwZSBmb3IgcHJveHlpbmcuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBDbGFzcyB0b1Byb3h5YWJsZUNvbGxlY3Rpb25UeXBlKENsYXNzIHR5\ncGUpIHsKICAgICAgICBpZiAodHlwZS5nZXROYW1lKCkuZW5kc1dpdGgoUFJP\nWFlfU1VGRklYKSkKICAgICAgICAgICAgdHlwZSA9IHR5cGUuZ2V0U3VwZXJj\nbGFzcygpOwogICAgICAgIGVsc2UgaWYgKHR5cGUuaXNJbnRlcmZhY2UoKSkg\newogICAgICAgICAgICB0eXBlID0gdG9Db25jcmV0ZVR5cGUodHlwZSwgX3N0\nZENvbGxlY3Rpb25zKTsKICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tcHJveHktaW50ZiIsIHR5cGUpKTsKICAgICAgICB9\nIGVsc2UgaWYgKE1vZGlmaWVyLmlzQWJzdHJhY3QodHlwZS5nZXRNb2RpZmll\ncnMoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tcHJveHktYWJzdHJhY3QiLCB0eXBlKSk7CiAg\nICAgICAgcmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGNvbmNyZXRlIHR5cGUgZm9yIHByb3h5aW5nLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ2xhc3MgdG9Qcm94eWFibGVNYXBUeXBlKENsYXNzIHR5\ncGUpIHsKICAgICAgICBpZiAodHlwZS5nZXROYW1lKCkuZW5kc1dpdGgoUFJP\nWFlfU1VGRklYKSkKICAgICAgICAgICAgdHlwZSA9IHR5cGUuZ2V0U3VwZXJj\nbGFzcygpOwogICAgICAgIGVsc2UgaWYgKHR5cGUuaXNJbnRlcmZhY2UoKSkg\newogICAgICAgICAgICB0eXBlID0gdG9Db25jcmV0ZVR5cGUodHlwZSwgX3N0\nZE1hcHMpOwogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1wcm94eS1pbnRmIiwgdHlwZSkpOwogICAgICAgIH0gZWxzZSBp\nZiAoTW9kaWZpZXIuaXNBYnN0cmFjdCh0eXBlLmdldE1vZGlmaWVycygpKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1wcm94eS1hYnN0cmFjdCIsIHR5cGUpKTsKICAgICAgICBy\nZXR1cm4gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIExvY2F0ZSBhIGNv\nbmNyZXRlIHR5cGUgdG8gcHJveHkgZm9yIHRoZSBnaXZlbiBjb2xsZWN0aW9u\nIGludGVyZmFjZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3Mg\ndG9Db25jcmV0ZVR5cGUoQ2xhc3MgaW50ZiwgTWFwIGNvbmNyZXRlcykgewog\nICAgICAgIENsYXNzIGNvbmNyZXRlID0gKENsYXNzKSBjb25jcmV0ZXMuZ2V0\nKGludGYpOwogICAgICAgIGlmIChjb25jcmV0ZSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gY29uY3JldGU7CiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9\nIGludGYuZ2V0SW50ZXJmYWNlcygpOyAgICAgICAgIAogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgY29uY3JldGUgPSB0b0NvbmNyZXRlVHlwZShpbnRmc1tpXSwgY29uY3Jl\ndGVzKTsKICAgICAgICAgICAgaWYgKGNvbmNyZXRlICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gY29uY3JldGU7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBudWxsOyAKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgY2FjaGVkIGZhY3RvcnkgcHJveHkgZm9yIHRoZSBnaXZlbiBjb2xsZWN0\naW9uIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgUHJveHlDb2xsZWN0aW9u\nIGdldEZhY3RvcnlQcm94eUNvbGxlY3Rpb24oQ2xhc3MgdHlwZSkgewogICAg\nICAgIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYgdHdvIHByb3hpZXMg\nZ2V0IGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBlCiAgICAgICAgUHJveHlDb2xs\nZWN0aW9uIHByb3h5ID0gKFByb3h5Q29sbGVjdGlvbikgX3Byb3hpZXMuZ2V0\nKHR5cGUpOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIENsYXNzTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3RE\nZXJpdmVkTG9hZGVyKHR5cGUsCiAgICAgICAgICAgICAgICBQcm94eUNvbGxl\nY3Rpb24uY2xhc3MpOwogICAgICAgICAgICBDbGFzcyBwY2xzID0gbG9hZEJ1\naWxkVGltZVByb3h5KHR5cGUsIGwpOwogICAgICAgICAgICBpZiAocGNscyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcGNscyA9IEdlbmVyYXRlZENsYXNz\nZXMubG9hZEJDQ2xhc3MoCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVQ\ncm94eUNvbGxlY3Rpb25CeXRlY29kZSh0eXBlLCB0cnVlKSwgbCk7CiAgICAg\nICAgICAgIHByb3h5ID0gKFByb3h5Q29sbGVjdGlvbikgaW5zdGFudGlhdGVQ\ncm94eShwY2xzLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgX3Byb3hpZXMu\ncHV0KHR5cGUsIHByb3h5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBy\nb3h5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQg\nZmFjdG9yeSBwcm94eSBmb3IgdGhlIGdpdmVuIG1hcCB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIFByb3h5TWFwIGdldEZhY3RvcnlQcm94eU1hcChDbGFz\ncyB0eXBlKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgbG9jayBoZXJlOyBvayBp\nZiB0d28gcHJveGllcyBnZXQgZ2VuZXJhdGVkIGZvciBzYW1lIHR5cGUKICAg\nICAgICBQcm94eU1hcCBwcm94eSA9IChQcm94eU1hcCkgX3Byb3hpZXMuZ2V0\nKHR5cGUpOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIENsYXNzTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3RE\nZXJpdmVkTG9hZGVyKHR5cGUsCiAgICAgICAgICAgICAgICBQcm94eU1hcC5j\nbGFzcyk7CiAgICAgICAgICAgIENsYXNzIHBjbHMgPSBsb2FkQnVpbGRUaW1l\nUHJveHkodHlwZSwgbCk7CiAgICAgICAgICAgIGlmIChwY2xzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBwY2xzID0gR2VuZXJhdGVkQ2xhc3Nlcy5sb2Fk\nQkNDbGFzcygKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVByb3h5TWFw\nQnl0ZWNvZGUodHlwZSwgdHJ1ZSksIGwpOwogICAgICAgICAgICBwcm94eSA9\nIChQcm94eU1hcCkgaW5zdGFudGlhdGVQcm94eShwY2xzLCBudWxsLCBudWxs\nKTsKICAgICAgICAgICAgX3Byb3hpZXMucHV0KHR5cGUsIHByb3h5KTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjYWNoZWQgZmFjdG9yeSBwcm94eSBmb3IgdGhl\nIGdpdmVuIGRhdGUgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBQcm94eURh\ndGUgZ2V0RmFjdG9yeVByb3h5RGF0ZShDbGFzcyB0eXBlKSB7CiAgICAgICAg\nLy8gd2UgZG9uJ3QgbG9jayBoZXJlOyBvayBpZiB0d28gcHJveGllcyBnZXQg\nZ2VuZXJhdGVkIGZvciBzYW1lIHR5cGUKICAgICAgICBQcm94eURhdGUgcHJv\neHkgPSAoUHJveHlEYXRlKSBfcHJveGllcy5nZXQodHlwZSk7CiAgICAgICAg\naWYgKHByb3h5ID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3NMb2FkZXIg\nbCA9IEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRMb2FkZXIodHlw\nZSwKICAgICAgICAgICAgICAgIFByb3h5RGF0ZS5jbGFzcyk7CiAgICAgICAg\nICAgIENsYXNzIHBjbHMgPSBsb2FkQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7\nCiAgICAgICAgICAgIGlmIChwY2xzID09IG51bGwpCiAgICAgICAgICAgICAg\nICBwY2xzID0gR2VuZXJhdGVkQ2xhc3Nlcy5sb2FkQkNDbGFzcygKICAgICAg\nICAgICAgICAgICAgICBnZW5lcmF0ZVByb3h5RGF0ZUJ5dGVjb2RlKHR5cGUs\nIHRydWUpLCBsKTsKICAgICAgICAgICAgcHJveHkgPSAoUHJveHlEYXRlKSBp\nbnN0YW50aWF0ZVByb3h5KHBjbHMsIG51bGwsIG51bGwpOwogICAgICAgICAg\nICBfcHJveGllcy5wdXQodHlwZSwgcHJveHkpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gcHJveHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGNhY2hlZCBmYWN0b3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4gY2FsZW5k\nYXIgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBQcm94eUNhbGVuZGFyIGdl\ndEZhY3RvcnlQcm94eUNhbGVuZGFyKENsYXNzIHR5cGUpIHsKICAgICAgICAv\nLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3byBwcm94aWVzIGdldCBn\nZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQogICAgICAgIFByb3h5Q2FsZW5kYXIg\ncHJveHkgPSAoUHJveHlDYWxlbmRhcikgX3Byb3hpZXMuZ2V0KHR5cGUpOwog\nICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNz\nTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3REZXJpdmVkTG9h\nZGVyKHR5cGUsCiAgICAgICAgICAgICAgICBQcm94eUNhbGVuZGFyLmNsYXNz\nKTsKICAgICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQcm94\neSh0eXBlLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHBjbHMgPSBHZW5lcmF0ZWRDbGFzc2VzLmxvYWRCQ0Ns\nYXNzKAogICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlUHJveHlDYWxlbmRh\nckJ5dGVjb2RlKHR5cGUsIHRydWUpLCBsKTsKICAgICAgICAgICAgcHJveHkg\nPSAoUHJveHlDYWxlbmRhcikgaW5zdGFudGlhdGVQcm94eShwY2xzLCBudWxs\nLCBudWxsKTsKICAgICAgICAgICAgX3Byb3hpZXMucHV0KHR5cGUsIHByb3h5\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQgZmFjdG9yeSBwcm94eSBm\nb3IgdGhlIGdpdmVuIGJlYW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBQ\ncm94eUJlYW4gZ2V0RmFjdG9yeVByb3h5QmVhbihPYmplY3Qgb3JpZykgewog\nICAgICAgIENsYXNzIHR5cGUgPSBvcmlnLmdldENsYXNzKCk7CiAgICAgICAg\naWYgKGlzVW5wcm94eWFibGUodHlwZSkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICAvLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3\nbyBwcm94aWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQogICAgICAg\nIFByb3h5QmVhbiBwcm94eSA9IChQcm94eUJlYW4pIF9wcm94aWVzLmdldCh0\neXBlKTsKICAgICAgICBpZiAocHJveHkgPT0gbnVsbCAmJiAhX3Byb3hpZXMu\nY29udGFpbnNLZXkodHlwZSkpIHsKICAgICAgICAgICAgQ2xhc3NMb2FkZXIg\nbCA9IEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRMb2FkZXIodHlw\nZSwKICAgICAgICAgICAgICAgIFByb3h5QmVhbi5jbGFzcyk7CiAgICAgICAg\nICAgIENsYXNzIHBjbHMgPSBsb2FkQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7\nCiAgICAgICAgICAgIGlmIChwY2xzID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIEJDQ2xhc3MgYmMgPSBnZW5lcmF0ZVByb3h5QmVhbkJ5dGVjb2RlKHR5\ncGUsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGJjICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgcGNscyA9IEdlbmVyYXRlZENsYXNzZXMubG9h\nZEJDQ2xhc3MoYmMsIGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChwY2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICBwcm94eSA9IChQcm94\neUJlYW4pIGluc3RhbnRpYXRlUHJveHkocGNscywKICAgICAgICAgICAgICAg\nICAgICBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpLCBuZXcgT2JqZWN0W10g\ne29yaWd9KTsKICAgICAgICAgICAgX3Byb3hpZXMucHV0KHR5cGUsIHByb3h5\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHR5cGUgaXMg\na25vd24gdG8gYmUgdW5wcm94eWFibGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzVW5wcm94eWFibGUoQ2xhc3MgdHlwZSkgewogICAgICAg\nIGZvciAoOyB0eXBlICE9IG51bGwgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3M7\nIAogICAgICAgICAgICB0eXBlID0gdHlwZS5nZXRTdXBlcmNsYXNzKCkpIHsK\nICAgICAgICAgICAgaWYgKF91bnByb3h5YWJsZS5jb250YWlucyh0eXBlLmdl\ndE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgcHJveHkgY2xhc3MgZ2VuZXJhdGVkIGF0IGJ1aWxkIHRp\nbWUgZm9yIHRoZSBnaXZlbiB0eXBlLAogICAgICogcmV0dXJuaW5nIG51bGwg\naWYgbm9uZSBleGlzdHMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzcyBs\nb2FkQnVpbGRUaW1lUHJveHkoQ2xhc3MgdHlwZSwgQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNz\nLmZvck5hbWUoZ2V0UHJveHlDbGFzc05hbWUodHlwZSwgZmFsc2UpLCB0cnVl\nLCBsb2FkZXIpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBnaXZlbiBwcm94eSBjbGFzcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBQcm94eSBpbnN0YW50aWF0ZVByb3h5KENs\nYXNzIGNscywgQ29uc3RydWN0b3IgY29ucywgT2JqZWN0W10gYXJncykgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb25zICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gKFByb3h5KSBjbHMuZ2V0Q29uc3RydWN0\nb3IoY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpKS4KICAgICAgICAgICAgICAg\nICAgICBuZXdJbnN0YW5jZShhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIChQ\ncm94eSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjbHMp\nKTsKICAgICAgICB9IGNhdGNoIChJbnN0YW50aWF0aW9uRXhjZXB0aW9uIGll\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldCgiY2FudC1uZXdpbnN0YW5jZSIsCiAgICAgICAgICAgICAg\nICBjbHMuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpOwogICAgICAgIH0g\nY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAg\nICAgICAgIEV4Y2VwdGlvbiBlID0gcGFlLmdldEV4Y2VwdGlvbigpOwogICAg\nICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEluc3RhbnRpYXRpb25FeGNlcHRp\nb24pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNl\ncHRpb24oX2xvYy5nZXQoImNhbnQtbmV3aW5zdGFuY2UiLAogICAgICAgICAg\nICAgICAgICAgIGNscy5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGNscy5nZXROYW1lKCkpLnNldENhdXNlKGUpOwogICAg\nICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGNscy5nZXROYW1lKCkpLnNldENhdXNl\nKHQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRl\nIHRoZSBieXRlY29kZSBmb3IgYSBjb2xsZWN0aW9uIHByb3h5IGZvciB0aGUg\nZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEJDQ2xhc3MgZ2Vu\nZXJhdGVQcm94eUNvbGxlY3Rpb25CeXRlY29kZShDbGFzcyB0eXBlLCAKICAg\nICAgICBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBhc3NlcnROb3RGaW5h\nbCh0eXBlKTsKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVj\ndCgpOyAKICAgICAgICBCQ0NsYXNzIGJjID0gcHJvamVjdC5sb2FkQ2xhc3Mo\nZ2V0UHJveHlDbGFzc05hbWUodHlwZSwgcnVudGltZSkpOwogICAgICAgIGJj\nLnNldFN1cGVyY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFyZUludGVy\nZmFjZShQcm94eUNvbGxlY3Rpb24uY2xhc3MpOwogCiAgICAgICAgZGVsZWdh\ndGVDb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0\naG9kcyhiYywgZmFsc2UpOwogICAgICAgIGFkZFByb3h5Q29sbGVjdGlvbk1l\ndGhvZHMoYmMsIHR5cGUpOwogICAgICAgIHByb3h5UmVjb2duaXplZE1ldGhv\nZHMoYmMsIHR5cGUsIFByb3h5Q29sbGVjdGlvbnMuY2xhc3MsIAogICAgICAg\nICAgICBQcm94eUNvbGxlY3Rpb24uY2xhc3MpOwogICAgICAgIHByb3h5U2V0\ndGVycyhiYywgdHlwZSk7CiAgICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9k\nKGJjLCBydW50aW1lKTsKICAgICAgICByZXR1cm4gYmM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHByb3h5IGNsYXNz\nIHRvIGdlbmVyYXRlIGZvciB0aGUgZ2l2ZW4gdHlwZS4gICAKICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFByb3h5Q2xhc3NOYW1lKENs\nYXNzIHR5cGUsIGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIFN0cmluZyBp\nZCA9IChydW50aW1lKSA/ICIkIiArIG5leHRQcm94eUlkKCkgOiAiIjsKICAg\nICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShQcm94eU1hbmFn\nZXJJbXBsLmNsYXNzKSArICIuIiAKICAgICAgICAgICAgKyB0eXBlLmdldE5h\nbWUoKS5yZXBsYWNlKCcuJywgJyQnKSArIGlkICsgUFJPWFlfU1VGRklYOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYXBwcm9wcmlhdGUgZXhjZXB0\naW9uIGlmIHRoZSBnaXZlbiB0eXBlIGlzIGZpbmFsLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyB2b2lkIGFzc2VydE5vdEZpbmFsKENsYXNzIHR5cGUp\nIHsKICAgICAgICBpZiAoTW9kaWZpZXIuaXNGaW5hbCh0eXBlLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1wcm94eS1maW5hbCIsIHR5cGUpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3Ig\nYSBtYXAgcHJveHkgZm9yIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQkNDbGFzcyBnZW5lcmF0ZVByb3h5TWFwQnl0ZWNvZGUoQ2xh\nc3MgdHlwZSwgYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgYXNzZXJ0Tm90\nRmluYWwodHlwZSk7CiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFBy\nb2plY3QoKTsgCiAgICAgICAgQkNDbGFzcyBiYyA9IHByb2plY3QubG9hZENs\nYXNzKGdldFByb3h5Q2xhc3NOYW1lKHR5cGUsIHJ1bnRpbWUpKTsKICAgICAg\nICBiYy5zZXRTdXBlcmNsYXNzKHR5cGUpOwogICAgICAgIGJjLmRlY2xhcmVJ\nbnRlcmZhY2UoUHJveHlNYXAuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVD\nb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9k\ncyhiYywgZmFsc2UpOwogICAgICAgIGFkZFByb3h5TWFwTWV0aG9kcyhiYywg\ndHlwZSk7CiAgICAgICAgcHJveHlSZWNvZ25pemVkTWV0aG9kcyhiYywgdHlw\nZSwgUHJveHlNYXBzLmNsYXNzLCBQcm94eU1hcC5jbGFzcyk7CiAgICAgICAg\ncHJveHlTZXR0ZXJzKGJjLCB0eXBlKTsKICAgICAgICBhZGRXcml0ZVJlcGxh\nY2VNZXRob2QoYmMsIHJ1bnRpbWUpOwogICAgICAgIHJldHVybiBiYzsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBieXRlY29kZSBmb3Ig\nYSBkYXRlIHByb3h5IGZvciB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEJDQ2xhc3MgZ2VuZXJhdGVQcm94eURhdGVCeXRlY29kZShD\nbGFzcyB0eXBlLCBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBhc3NlcnRO\nb3RGaW5hbCh0eXBlKTsKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcg\nUHJvamVjdCgpOyAKICAgICAgICBCQ0NsYXNzIGJjID0gcHJvamVjdC5sb2Fk\nQ2xhc3MoZ2V0UHJveHlDbGFzc05hbWUodHlwZSwgcnVudGltZSkpOwogICAg\nICAgIGJjLnNldFN1cGVyY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFy\nZUludGVyZmFjZShQcm94eURhdGUuY2xhc3MpOwogCiAgICAgICAgZGVsZWdh\ndGVDb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0\naG9kcyhiYywgdHJ1ZSk7CiAgICAgICAgYWRkUHJveHlEYXRlTWV0aG9kcyhi\nYywgdHlwZSk7CiAgICAgICAgcHJveHlTZXR0ZXJzKGJjLCB0eXBlKTsKICAg\nICAgICBhZGRXcml0ZVJlcGxhY2VNZXRob2QoYmMsIHJ1bnRpbWUpOwogICAg\nICAgIHJldHVybiBiYzsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRl\nIHRoZSBieXRlY29kZSBmb3IgYSBjYWxlbmRhciBwcm94eSBmb3IgdGhlIGdp\ndmVuIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVy\nYXRlUHJveHlDYWxlbmRhckJ5dGVjb2RlKENsYXNzIHR5cGUsIAogICAgICAg\nIGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIGFzc2VydE5vdEZpbmFsKHR5\ncGUpOwogICAgICAgIFByb2plY3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7\nIAogICAgICAgIEJDQ2xhc3MgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcyhnZXRQ\ncm94eUNsYXNzTmFtZSh0eXBlLCBydW50aW1lKSk7CiAgICAgICAgYmMuc2V0\nU3VwZXJjbGFzcyh0eXBlKTsKICAgICAgICBiYy5kZWNsYXJlSW50ZXJmYWNl\nKFByb3h5Q2FsZW5kYXIuY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25z\ndHJ1Y3RvcnMoYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhi\nYywgdHJ1ZSk7CiAgICAgICAgYWRkUHJveHlDYWxlbmRhck1ldGhvZHMoYmMs\nIHR5cGUpOwogICAgICAgIHByb3h5U2V0dGVycyhiYywgdHlwZSk7CiAgICAg\nICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKGJjLCBydW50aW1lKTsKICAgICAg\nICByZXR1cm4gYmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0\naGUgYnl0ZWNvZGUgZm9yIGEgYmVhbiBwcm94eSBmb3IgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVyYXRlUHJv\neHlCZWFuQnl0ZWNvZGUoQ2xhc3MgdHlwZSwgYm9vbGVhbiBydW50aW1lKSB7\nCiAgICAgICAgaWYgKE1vZGlmaWVyLmlzRmluYWwodHlwZS5nZXRNb2RpZmll\ncnMoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChJ\nbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUobnVsbCwgdHlwZSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyB3ZSBjYW4gb25seSBnZW5l\ncmF0ZSBhIHZhbGlkIHByb3h5IGlmIHRoZXJlIGlzIGEgY29weSBjb25zdHJ1\nY3RvcgogICAgICAgIC8vIG9yIGEgZGVmYXVsdCBjb25zdHJ1Y3RvcgogICAg\nICAgIENvbnN0cnVjdG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5\ncGUpOwogICAgICAgIGlmIChjb25zID09IG51bGwpIHsKICAgICAgICAgICAg\nQ29uc3RydWN0b3JbXSBjcyA9IHR5cGUuZ2V0Q29uc3RydWN0b3JzKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBjb25zID09IG51bGwgJiYgaSA8\nIGNzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICBpZiAoY3NbaV0uZ2V0\nUGFyYW1ldGVyVHlwZXMoKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAg\nICAgICBjb25zID0gY3NbaV07IAogICAgICAgICAgICBpZiAoY29ucyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgpOyAKICAg\nICAgICBCQ0NsYXNzIGJjID0gcHJvamVjdC5sb2FkQ2xhc3MoZ2V0UHJveHlD\nbGFzc05hbWUodHlwZSwgcnVudGltZSkpOwogICAgICAgIGJjLnNldFN1cGVy\nY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFjZShQcm94\neUJlYW4uY2xhc3MpOwogCiAgICAgICAgZGVsZWdhdGVDb25zdHJ1Y3RvcnMo\nYmMsIHR5cGUpOwogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHJ1ZSk7\nCiAgICAgICAgYWRkUHJveHlCZWFuTWV0aG9kcyhiYywgdHlwZSwgY29ucyk7\nCiAgICAgICAgaWYgKCFwcm94eVNldHRlcnMoYmMsIHR5cGUpKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBhZGRXcml0ZVJlcGxhY2VNZXRo\nb2QoYmMsIHJ1bnRpbWUpOwogICAgICAgIHJldHVybiBiYzsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBwYXNzLXRocm91Z2ggY29uc3RydWN0b3Jz\nIHRvIGJhc2UgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRlbGVn\nYXRlQ29uc3RydWN0b3JzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsKICAg\nICAgICBDb25zdHJ1Y3RvcltdIGNvbnMgPSB0eXBlLmdldENvbnN0cnVjdG9y\ncygpOwogICAgICAgIENsYXNzW10gcGFyYW1zOwogICAgICAgIEJDTWV0aG9k\nIG07CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwYXJhbXMg\nPSBjb25zW2ldLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgICAgIG0g\nPSBiYy5kZWNsYXJlTWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJh\nbXMpOyAKICAgICAgICAgICAgbS5tYWtlUHVibGljKCk7CgogICAgICAgICAg\nICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsg\naiA8IHBhcmFtcy5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIGNvZGUu\neGxvYWQoKS5zZXRQYXJhbShqKS5zZXRUeXBlKHBhcmFtc1tqXSk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChjb25zW2ld\nKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbXBsZW1lbnQgdGhlIG1ldGhvZHMgaW4gdGhlIHtAbGluayBQcm94\neX0gaW50ZXJmYWNlLCB3aXRoIHRoZSBleGNlcHRpb24KICAgICAqIG9mIHtA\nbGluayBQcm94eSNjb3B5fS4KICAgICAqCiAgICAgKiBAcGFyYW0gY2hhbmdl\nVHJhY2tlciB3aGV0aGVyIHRvIGltcGxlbWVudCBhIG51bGwgY2hhbmdlIHRy\nYWNrZXI7IGlmIGZhbHNlCiAgICAgKiB0aGUgY2hhbmdlIHRyYWNrZXIgbWV0\naG9kIGlzIGxlZnQgdW5pbXBsZW1lbnRlZAogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkUHJveHlNZXRob2RzKEJDQ2xhc3MgYmMsIGJvb2xlYW4gY2hh\nbmdlVHJhY2tlcikgewogICAgICAgIEJDRmllbGQgc20gPSBiYy5kZWNsYXJl\nRmllbGQoInNtIiwgT3BlbkpQQVN0YXRlTWFuYWdlci5jbGFzcyk7CiAgICAg\nICAgc20uc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAgIEJDRmllbGQgZmll\nbGQgPSBiYy5kZWNsYXJlRmllbGQoImZpZWxkIiwgaW50LmNsYXNzKTsKICAg\nICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CgogICAgICAgIEJDTWV0\naG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJzZXRPd25lciIsIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlci5jbGFzcywgaW50LmNsYXNzIH0pOwogICAgICAgIG0ubWFrZVB1Ymxp\nYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0\nRmllbGQoc20pOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAgIGNvZGUu\ncHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIG0gPSBi\nYy5kZWNsYXJlTWV0aG9kKCJnZXRPd25lciIsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIuY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAg\nICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoc20pOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwoKICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0\nT3duZXJGaWVsZCIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbS5tYWtl\nUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgY29kZS5pcmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGlmIChjaGFu\nZ2VUcmFja2VyKSB7CiAgICAgICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9k\nKCJnZXRDaGFuZ2VUcmFja2VyIiwgQ2hhbmdlVHJhY2tlci5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgICAgICBj\nb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0TnVsbCgpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudCB0aGUgbWV0aG9kcyBpbiB0\naGUge0BsaW5rIFByb3h5Q29sbGVjdGlvbn0gaW50ZXJmYWNlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkUHJveHlDb2xsZWN0aW9uTWV0aG9kcyhC\nQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7CiAgICAgICAgLy8gY2hhbmdlIHRy\nYWNrZXIKICAgICAgICBCQ0ZpZWxkIGNoYW5nZVRyYWNrZXIgPSBiYy5kZWNs\nYXJlRmllbGQoImNoYW5nZVRyYWNrZXIiLCAKICAgICAgICAgICAgQ29sbGVj\ndGlvbkNoYW5nZVRyYWNrZXIuY2xhc3MpOwogICAgICAgIGNoYW5nZVRyYWNr\nZXIuc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAgIEJDTWV0aG9kIG0gPSBi\nYy5kZWNsYXJlTWV0aG9kKCJnZXRDaGFuZ2VUcmFja2VyIiwgQ2hhbmdlVHJh\nY2tlci5jbGFzcywgCiAgICAgICAgICAgIG51bGwpOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChjaGFuZ2VUcmFja2VyKTsKICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAg\nICAgICAgLy8gY29sbGVjdGlvbiBjb3B5CiAgICAgICAgQ29uc3RydWN0b3Ig\nY29ucyA9IGZpbmRDb3B5Q29uc3RydWN0b3IodHlwZSk7CiAgICAgICAgaWYg\nKGNvbnMgPT0gbnVsbCAmJiBTb3J0ZWRTZXQuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbSh0eXBlKSkKICAgICAgICAgICAgY29ucyA9IGZpbmRDb21wYXJhdG9y\nQ29uc3RydWN0b3IodHlwZSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAo\nY29ucyA9PSBudWxsKSA/IG5ldyBDbGFzc1swXSAKICAgICAgICAgICAgOiBj\nb25zLmdldFBhcmFtZXRlclR5cGVzKCk7CgogICAgICAgIG0gPSBiYy5kZWNs\nYXJlTWV0aG9kKCJjb3B5IiwgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nT2JqZWN0LmNsYXNzfSk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAg\nICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgY29kZS5hbmV3\nKCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAg\nIGlmIChwYXJhbXMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBpZiAocGFyYW1zWzBd\nID09IENvbXBhcmF0b3IuY2xhc3MpIHsKICAgICAgICAgICAgICAgIGNvZGUu\nY2hlY2tjYXN0KCkuc2V0VHlwZShTb3J0ZWRTZXQuY2xhc3MpOwogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU29y\ndGVkU2V0LmNsYXNzLCAiY29tcGFyYXRvciIsIAogICAgICAgICAgICAgICAg\nICAgIENvbXBhcmF0b3IuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShw\nYXJhbXNbMF0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBh\ncmFtcyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMCB8fCBwYXJh\nbXNbMF0gPT0gQ29tcGFyYXRvci5jbGFzcykgewogICAgICAgICAgICBjb2Rl\nLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDb2xsZWN0\naW9uLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKHR5cGUsICJhZGRBbGwiLCBib29sZWFuLmNsYXNzLCAKICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgQ29sbGVjdGlvbi5jbGFzcyB9\nKTsKICAgICAgICAgICAgY29kZS5wb3AoKTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIC8vIGVsZW1lbnQgdHlwZQogICAgICAgIEJDRmllbGQgZWxlbWVudFR5\ncGUgPSBiYy5kZWNsYXJlRmllbGQoImVsZW1lbnRUeXBlIiwgQ2xhc3MuY2xh\nc3MpOwogICAgICAgIGVsZW1lbnRUeXBlLnNldFRyYW5zaWVudCh0cnVlKTsK\nICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0RWxlbWVudFR5cGUi\nLCBDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7\nCiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChlbGVtZW50VHlwZSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIG5ldyBpbnN0\nYW5jZSBmYWN0b3J5CiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoIm5l\nd0luc3RhbmNlIiwgUHJveHlDb2xsZWN0aW9uLmNsYXNzLCAKICAgICAgICAg\nICAgbmV3IENsYXNzW10geyBDbGFzcy5jbGFzcywgQ29tcGFyYXRvci5jbGFz\ncywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsK\nICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKGJjKTsgCiAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICBjb25zID0gZmluZENvbXBhcmF0b3JDb25zdHJ1Y3Rvcih0eXBlKTsK\nICAgICAgICBwYXJhbXMgPSAoY29ucyA9PSBudWxsKSA/IG5ldyBDbGFzc1sw\nXSA6IGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICBpZiAocGFy\nYW1zLmxlbmd0aCA9PSAxKQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMSk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAgICAgIGlu\ndCByZXQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNv\nZGUuYXN0b3JlKCkuc2V0TG9jYWwocmV0KTsKCiAgICAgICAgLy8gc2V0IGVs\nZW1lbnQgdHlwZQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQp\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoZWxlbWVudFR5cGUpOwoKICAgICAg\nICAvLyBjcmVhdGUgY2hhbmdlIHRyYWNrZXIgYW5kIHNldCBpdAogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgyKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZpbnMgPSBjb2RlLmlmZXEoKTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwocmV0KTsKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKENvbGxlY3Rpb25DaGFuZ2VUcmFja2VySW1wbC5jbGFzcyk7CiAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoYWxsb3dzRHVw\nbGljYXRlcyh0eXBlKSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGlzT3JkZXJlZCh0eXBlKSk7CiAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKENvbGxlY3Rpb25DaGFuZ2VUcmFja2VySW1wbC5j\nbGFzcywgCiAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXSB7IENvbGxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICBib29s\nZWFuLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgIGNvZGUucHV0\nZmllbGQoKS5zZXRGaWVsZChjaGFuZ2VUcmFja2VyKTsKCiAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpKTsKICAg\nICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZl\nbiBjb2xsZWN0aW9uIHR5cGUgYWxsb3dzIGR1cGxpY2F0ZXMuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBib29sZWFuIGFsbG93c0R1cGxpY2F0ZXMoQ2xhc3Mg\ndHlwZSkgewogICAgICAgIHJldHVybiAhU2V0LmNsYXNzLmlzQXNzaWduYWJs\nZUZyb20odHlwZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGUgZ2l2ZW4gY29sbGVjdGlvbiB0eXBlIG1haW50YWlucyBhbiBh\ncnRpZmljaWFsIAogICAgICogb3JkZXJpbmcuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBib29sZWFuIGlzT3JkZXJlZChDbGFzcyB0eXBlKSB7CiAgICAgICAg\ncmV0dXJuIExpc3QuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKQogICAg\nICAgICAgICB8fCAiamF2YS51dGlsLkxpbmtlZEhhc2hTZXQiLmVxdWFscyh0\neXBlLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1l\nbnQgdGhlIG1ldGhvZHMgaW4gdGhlIHtAbGluayBQcm94eU1hcH0gaW50ZXJm\nYWNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJveHlNYXBNZXRo\nb2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsKICAgICAgICAvLyBjaGFu\nZ2UgdHJhY2tlcgogICAgICAgIEJDRmllbGQgY2hhbmdlVHJhY2tlciA9IGJj\nLmRlY2xhcmVGaWVsZCgiY2hhbmdlVHJhY2tlciIsIAogICAgICAgICAgICBN\nYXBDaGFuZ2VUcmFja2VyLmNsYXNzKTsKICAgICAgICBjaGFuZ2VUcmFja2Vy\nLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICBCQ01ldGhvZCBtID0gYmMu\nZGVjbGFyZU1ldGhvZCgiZ2V0Q2hhbmdlVHJhY2tlciIsIENoYW5nZVRyYWNr\nZXIuY2xhc3MsIAogICAgICAgICAgICBudWxsKTsKICAgICAgICBtLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7\nCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoY2hhbmdlVHJhY2tlcik7CiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIC8vIG1hcCBjb3B5CiAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZp\nbmRDb3B5Q29uc3RydWN0b3IodHlwZSk7CiAgICAgICAgaWYgKGNvbnMgPT0g\nbnVsbCAmJiBTb3J0ZWRNYXAuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBl\nKSkKICAgICAgICAgICAgY29ucyA9IGZpbmRDb21wYXJhdG9yQ29uc3RydWN0\nb3IodHlwZSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAoY29ucyA9PSBu\ndWxsKSA/IG5ldyBDbGFzc1swXSAKICAgICAgICAgICAgOiBjb25zLmdldFBh\ncmFtZXRlclR5cGVzKCk7CgogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9k\nKCJjb3B5IiwgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXSB7T2JqZWN0LmNs\nYXNzfSk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9\nIG0uZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGlmIChwYXJh\nbXMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBpZiAocGFyYW1zWzBdID09IENvbXBh\ncmF0b3IuY2xhc3MpIHsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShTb3J0ZWRNYXAuY2xhc3MpOwogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU29ydGVkTWFwLmNs\nYXNzLCAiY29tcGFyYXRvciIsIAogICAgICAgICAgICAgICAgICAgIENvbXBh\ncmF0b3IuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgCiAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBd\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKHR5cGUsICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwog\nICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDAgfHwgcGFyYW1zWzBdID09\nIENvbXBhcmF0b3IuY2xhc3MpIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoTWFwLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUs\nICJwdXRBbGwiLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIG5ldyBD\nbGFzc1tdIHsgTWFwLmNsYXNzIH0pOwogICAgICAgIH0KICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAg\nLy8ga2V5IHR5cGUKICAgICAgICBCQ0ZpZWxkIGtleVR5cGUgPSBiYy5kZWNs\nYXJlRmllbGQoImtleVR5cGUiLCBDbGFzcy5jbGFzcyk7CiAgICAgICAga2V5\nVHlwZS5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgbSA9IGJjLmRlY2xh\ncmVNZXRob2QoImdldEtleVR5cGUiLCBDbGFzcy5jbGFzcywgbnVsbCk7CiAg\nICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0Q29k\nZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChrZXlUeXBlKTsKICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAg\nICAgICAgLy8gdmFsdWUgdHlwZQogICAgICAgIEJDRmllbGQgdmFsdWVUeXBl\nID0gYmMuZGVjbGFyZUZpZWxkKCJ2YWx1ZVR5cGUiLCBDbGFzcy5jbGFzcyk7\nCiAgICAgICAgdmFsdWVUeXBlLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAg\nICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0VmFsdWVUeXBlIiwgQ2xhc3Mu\nY2xhc3MsIG51bGwpOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAg\nIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\ndmFsdWVUeXBlKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gbmV3IGluc3RhbmNlIGZhY3Rv\ncnkKICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgibmV3SW5zdGFuY2Ui\nLCBQcm94eU1hcC5jbGFzcywgCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsg\nQ2xhc3MuY2xhc3MsIENsYXNzLmNsYXNzLCBDb21wYXJhdG9yLmNsYXNzLCAK\nICAgICAgICAgICAgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICBtLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKGJjKTsgCiAgICAgICAgY29kZS5k\ndXAoKTsKICAgICAgICBjb25zID0gZmluZENvbXBhcmF0b3JDb25zdHJ1Y3Rv\ncih0eXBlKTsKICAgICAgICBwYXJhbXMgPSAoY29ucyA9PSBudWxsKSA/IG5l\ndyBDbGFzc1swXSA6IGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAg\nICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMik7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwog\nICAgICAgIGludCByZXQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwog\nICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwocmV0KTsKCiAgICAgICAg\nLy8gc2V0IGtleSBhbmQgdmFsdWUgdHlwZXMKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwocmV0KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGtleVR5\ncGUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBjb2RlLnB1\ndGZpZWxkKCkuc2V0RmllbGQodmFsdWVUeXBlKTsKCiAgICAgICAgLy8gY3Jl\nYXRlIGNoYW5nZSB0cmFja2VyIGFuZCBzZXQgaXQKICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0UGFyYW0oMyk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\naW5zID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKHJldCk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShNYXBDaGFu\nZ2VUcmFja2VySW1wbC5jbGFzcyk7CiAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0KTsKICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoTWFwQ2hhbmdlVHJhY2tlcklt\ncGwuY2xhc3MsIAogICAgICAgICAgICAiPGluaXQ+Iiwgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW10geyBNYXAuY2xhc3MgfSk7CiAgICAgICAgY29kZS5wdXRm\naWVsZCgpLnNldEZpZWxkKGNoYW5nZVRyYWNrZXIpOwoKICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldExvY2FsKHJldCkpOwogICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoZSBtZXRob2RzIGlu\nIHRoZSB7QGxpbmsgUHJveHlEYXRlfSBpbnRlcmZhY2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRQcm94eURhdGVNZXRob2RzKEJDQ2xhc3MgYmMs\nIENsYXNzIHR5cGUpIHsKICAgICAgICBib29sZWFuIGhhc0RlZmF1bHRDb25z\nID0gYmMuZ2V0RGVjbGFyZWRNZXRob2QoIjxpbml0PiIsIAogICAgICAgICAg\nICAoQ2xhc3NbXSkgbnVsbCkgIT0gbnVsbDsKICAgICAgICBib29sZWFuIGhh\nc01pbGxpc0NvbnMgPSBiYy5nZXREZWNsYXJlZE1ldGhvZCgiPGluaXQ+Iiwg\nCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgbG9uZy5jbGFzcyB9KSAhPSBu\ndWxsOwogICAgICAgIGlmICghaGFzRGVmYXVsdENvbnMgJiYgIWhhc01pbGxp\nc0NvbnMpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tZGF0ZS1jb25zIiwgdHlwZSkpOwoKICAgICAg\nICAvLyBhZGQgYSBkZWZhdWx0IGNvbnN0cnVjdG9yIHRoYXQgZGVsZWdhdGVz\nIHRvIHRoZSBtaWxsaXMgY29uc3RydWN0b3IKICAgICAgICBCQ01ldGhvZCBt\nOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBpZiAoIWhhc0RlZmF1bHRD\nb25zKSB7CiAgICAgICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCI8aW5p\ndD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgbS5tYWtlUHVi\nbGljKCk7CiAgICAgICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFN5c3RlbS5jbGFzcywg\nImN1cnJlbnRUaW1lTWlsbGlzIiwKICAgICAgICAgICAgICAgIGxvbmcuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsCiAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXSB7IGxvbmcuY2xhc3MgfSk7CiAgICAgICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7ICAgICAgICAgICAKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIGRhdGUg\nY29weQogICAgICAgIENvbnN0cnVjdG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0\ncnVjdG9yKHR5cGUpOwogICAgICAgIENsYXNzW10gcGFyYW1zOwogICAgICAg\nIGlmIChjb25zICE9IG51bGwpCiAgICAgICAgICAgIHBhcmFtcyA9IGNvbnMu\nZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICBlbHNlIGlmIChoYXNNaWxs\naXNDb25zKQogICAgICAgICAgICBwYXJhbXMgPSBuZXcgQ2xhc3NbXSB7IGxv\nbmcuY2xhc3MgfTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHBhcmFtcyA9\nIG5ldyBDbGFzc1swXTsKCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2Qo\nImNvcHkiLCBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1tdIHtPYmplY3QuY2xh\nc3N9KTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBjb2RlID0g\nbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKHR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgaWYgKHBhcmFt\ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBpZiAocGFyYW1zWzBdID09\nIGxvbmcuY2xhc3MpIHsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShEYXRlLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChEYXRlLmNsYXNzLCAiZ2V0VGltZSIs\nIAogICAgICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKHBhcmFtc1swXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUs\nICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAgICAgIGlmIChw\nYXJhbXMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRGF0ZS5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChEYXRl\nLmNsYXNzLCAiZ2V0VGltZSIsIGxvbmcuY2xhc3MsIAogICAgICAgICAgICAg\nICAgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZCh0eXBlLCAic2V0VGltZSIsIHZvaWQuY2xhc3MsCiAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXSB7IGxvbmcuY2xhc3MgfSk7CiAgICAgICAg\nfQogICAgICAgIGlmICgocGFyYW1zLmxlbmd0aCA9PSAwIHx8IHBhcmFtc1sw\nXSA9PSBsb25nLmNsYXNzKSAKICAgICAgICAgICAgJiYgVGltZXN0YW1wLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpIHsKICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoVGltZXN0\nYW1wLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKFRpbWVzdGFtcC5jbGFzcywgImdldE5hbm9zIiwgCiAgICAg\nICAgICAgICAgICBpbnQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlwZSwgInNldE5hbm9zIiwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgaW50\nLmNsYXNzIH0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gbmV3IGluc3Rh\nbmNlIGZhY3RvcnkKICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgibmV3\nSW5zdGFuY2UiLCBQcm94eURhdGUuY2xhc3MsIG51bGwpOyAKICAgICAgICBt\nLm1ha2VQdWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUp\nOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoYmMpOyAKICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIG1ldGhvZHMgaW4gdGhlIHtA\nbGluayBQcm94eUNhbGVuZGFyfSBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRQcm94eUNhbGVuZGFyTWV0aG9kcyhCQ0NsYXNzIGJj\nLCBDbGFzcyB0eXBlKSB7CiAgICAgICAgLy8gY2FsZW5kYXIgY29weQogICAg\nICAgIENvbnN0cnVjdG9yIGNvbnMgPSBmaW5kQ29weUNvbnN0cnVjdG9yKHR5\ncGUpOwogICAgICAgIENsYXNzW10gcGFyYW1zID0gKGNvbnMgPT0gbnVsbCkg\nPyBuZXcgQ2xhc3NbMF0gCiAgICAgICAgICAgIDogY29ucy5nZXRQYXJhbWV0\nZXJUeXBlcygpOwoKICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1l\ndGhvZCgiY29weSIsIE9iamVjdC5jbGFzcywgCiAgICAgICAgICAgIG5ldyBD\nbGFzc1tdIHtPYmplY3QuY2xhc3N9KTsKICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5k\ndXAoKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHBhcmFtc1swXSk7CiAgICAgICAg\nfQogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBl\nLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgcGFyYW1zKTsKICAgICAgICBpZiAo\ncGFyYW1zLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENhbGVuZGFyLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKENhbGVuZGFyLmNsYXNzLCAiZ2V0VGltZUluTWlsbGlzIiwgCiAgICAgICAg\nICAgICAgICBsb25nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRUaW1lSW5NaWxs\naXMiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10g\neyBsb25nLmNsYXNzIH0pOwoKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2FsZW5kYXIuY2xhc3MpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQ2Fs\nZW5kYXIuY2xhc3MsICJpc0xlbmllbnQiLCAKICAgICAgICAgICAgICAgIGJv\nb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QodHlwZSwgInNldExlbmllbnQiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBib29sZWFuLmNs\nYXNzIH0pOwoKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoQ2FsZW5kYXIuY2xhc3MpOwogICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQ2FsZW5kYXIuY2xh\nc3MsICJnZXRGaXJzdERheU9mV2VlayIsIAogICAgICAgICAgICAgICAgaW50\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRGaXJzdERheU9mV2VlayIsIAogICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBpbnQuY2xh\nc3MgfSk7CgogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShDYWxlbmRhci5jbGFzcyk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDYWxlbmRhci5jbGFz\ncywgCiAgICAgICAgICAgICAgICAiZ2V0TWluaW1hbERheXNJbkZpcnN0V2Vl\nayIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0TWluaW1hbERheXNJbkZp\ncnN0V2VlayIsIAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW10geyBpbnQuY2xhc3MgfSk7CgogICAgICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDYWxlbmRhci5jbGFz\ncyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChDYWxlbmRhci5jbGFzcywgImdldFRpbWVab25lIiwgCiAgICAgICAgICAg\nICAgICBUaW1lWm9uZS5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0VGltZVpvbmUi\nLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBU\naW1lWm9uZS5jbGFzcyB9KTsKICAgICAgICB9CiAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIG5l\ndyBpbnN0YW5jZSBmYWN0b3J5CiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRo\nb2QoIm5ld0luc3RhbmNlIiwgUHJveHlDYWxlbmRhci5jbGFzcywgbnVsbCk7\nIAogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdl\ndENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShiYyk7\nIAogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKCiAgICAgICAgLy8gcHJveHkgdGhlIHByb3RlY3RlZCBjb21wdXRlRmll\nbGRzIG1ldGhvZCBiL2MgaXQgaXMgY2FsbGVkIG9uCiAgICAgICAgLy8gbXV0\nYXRlLCBhbmQgc29tZSBzZXR0ZXJzIGFyZSBmaW5hbCBhbmQgdGhlcmVmb3Jl\nIG5vdCBwcm94eWFibGUKICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgi\nY29tcHV0ZUZpZWxkcyIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIG0u\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgY29kZS5p\nbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUHJveGllcy5jbGFzcywgImRpcnR5\nIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW10geyBQcm94\neS5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZCh0eXBlLCAiY29tcHV0ZUZpZWxkcyIsIHZvaWQuY2xhc3MsIG51\nbGwpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoZSBt\nZXRob2RzIGluIHRoZSB7QGxpbmsgUHJveHlCZWFufSBpbnRlcmZhY2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94eUJlYW5NZXRob2RzKEJD\nQ2xhc3MgYmMsIENsYXNzIHR5cGUsIENvbnN0cnVjdG9yIGNvbnMpIHsKICAg\nICAgICAvLyBiZWFuIGNvcHkKICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVj\nbGFyZU1ldGhvZCgiY29weSIsIE9iamVjdC5jbGFzcywgCiAgICAgICAgICAg\nIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgIENsYXNzW10gcGFyYW1zID0gY29ucy5n\nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3Ro\nID09IDEpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGFyYW1z\nWzBdKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKGNvbnMpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09\nIDApCiAgICAgICAgICAgIGNvcHlQcm9wZXJ0aWVzKHR5cGUsIGNvZGUpOwog\nICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwoKICAgICAgICAvLyBuZXcgaW5zdGFuY2UgZmFjdG9yeQogICAgICAgIG0g\nPSBiYy5kZWNsYXJlTWV0aG9kKCJuZXdJbnN0YW5jZSIsIFByb3h5QmVhbi5j\nbGFzcywgCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNz\nIH0pOyAKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBjb2RlID0g\nbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nYmMpOyAKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGlmIChwYXJhbXMu\nbGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\ncGFyYW1zWzBdKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMp\nOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIGNvcHlQcm9wZXJ0aWVzKHR5cGUsIGNvZGUpOwogICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29weSBiZWFuIHByb3BlcnRpZXMuICBDYWxsZWQgd2l0aCB0\naGUgY29weSBvYmplY3Qgb24gdGhlIHN0YWNrLiAgTXVzdAogICAgICogcmV0\ndXJuIHdpdGggdGhlIGNvcHkgb2JqZWN0IG9uIHRoZSBzdGFjay4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGNvcHlQcm9wZXJ0aWVzKENsYXNzIHR5cGUs\nIENvZGUgY29kZSkgewogICAgICAgIGludCBjb3B5ID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2Fs\nKGNvcHkpOwogICAgICAgIAogICAgICAgIE1ldGhvZFtdIG1ldGhzID0gdHlw\nZS5nZXRNZXRob2RzKCk7CiAgICAgICAgTWV0aG9kIGdldHRlcjsKICAgICAg\nICBpbnQgbW9kczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1vZHMgPSBtZXRoc1tpXS5n\nZXRNb2RpZmllcnMoKTsgCiAgICAgICAgICAgIGlmICghTW9kaWZpZXIuaXNQ\ndWJsaWMobW9kcykgfHwgTW9kaWZpZXIuaXNTdGF0aWMobW9kcykpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKCFzdGFydHNX\naXRoKG1ldGhzW2ldLmdldE5hbWUoKSwgInNldCIpCiAgICAgICAgICAgICAg\nICB8fCBtZXRoc1tpXS5nZXRQYXJhbWV0ZXJUeXBlcygpLmxlbmd0aCAhPSAx\nKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGdldHRl\nciA9IGZpbmRHZXR0ZXIodHlwZSwgbWV0aHNbaV0pOwogICAgICAgICAgICBp\nZiAoZ2V0dGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIC8vIGNvcHkuc2V0WFhYKG9yaWcuZ2V0WFhYKCkpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoY29weSk7CiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0dGVyKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG1ldGhzW2ld\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGNv\ncHkpOwogICAgfQoKICAgIC8qKgogICAgICogUHJveHkgcmVjb2duaXplZCBt\nZXRob2RzIHRvIGludm9rZSBoZWxwZXJzIGluIGdpdmVuIGhlbHBlciBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb3h5UmVjb2duaXplZE1l\ndGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSwgQ2xhc3MgaGVscGVyLAog\nICAgICAgIENsYXNzIHByb3h5VHlwZSkgewogICAgICAgIE1ldGhvZFtdIG1l\ndGhzID0gdHlwZS5nZXRNZXRob2RzKCk7CiAgICAgICAgQ2xhc3NbXSBwYXJh\nbXM7CiAgICAgICAgQ2xhc3NbXSBhZnRlclBhcmFtczsKICAgICAgICBNZXRo\nb2QgbWF0Y2g7CiAgICAgICAgTWV0aG9kIGFmdGVyOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgbWV0aHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgcGFyYW1zID0gdG9IZWxwZXJQYXJhbWV0ZXJzKG1ldGhzW2ldLmdldFBh\ncmFtZXRlclR5cGVzKCksIAogICAgICAgICAgICAgICAgcHJveHlUeXBlKTsK\nCiAgICAgICAgICAgIC8vIGZpcnN0IGNoZWNrIGZvciBvdmVycmlkaW5nIG1l\ndGhvZCAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG1hdGNo\nID0gaGVscGVyLmdldE1ldGhvZChtZXRoc1tpXS5nZXROYW1lKCksIHBhcmFt\ncyk7IAogICAgICAgICAgICAgICAgcHJveHlPdmVycmlkZU1ldGhvZChiYywg\nbWV0aHNbaV0sIG1hdGNoLCBwYXJhbXMpOwogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiBuc21lKSB7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2hlY2sgZm9y\nIGJlZm9yZSBhbmQgYWZ0ZXIgbWV0aG9kcywgZWl0aGVyIG9mIHdoaWNoIG1h\neSBub3QKICAgICAgICAgICAgLy8gZXhpc3QKICAgICAgICAgICAgbWF0Y2gg\nPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbWF0\nY2ggPSBoZWxwZXIuZ2V0TWV0aG9kKCJiZWZvcmUiIAogICAgICAgICAgICAg\nICAgICAgICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShtZXRoc1tpXS5nZXRO\nYW1lKCkpLCBwYXJhbXMpOwogICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hN\nZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWZ0\nZXIgPSBudWxsOwogICAgICAgICAgICBhZnRlclBhcmFtcyA9IG51bGw7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhZnRlclBhcmFtcyA9\nIHRvSGVscGVyQWZ0ZXJQYXJhbWV0ZXJzKHBhcmFtcywgCiAgICAgICAgICAg\nICAgICAgICAgbWV0aHNbaV0uZ2V0UmV0dXJuVHlwZSgpLCAobWF0Y2ggPT0g\nbnVsbCkgCiAgICAgICAgICAgICAgICAgICAgPyB2b2lkLmNsYXNzIDogbWF0\nY2guZ2V0UmV0dXJuVHlwZSgpKTsKICAgICAgICAgICAgICAgIGFmdGVyID0g\naGVscGVyLmdldE1ldGhvZCgiYWZ0ZXIiIAogICAgICAgICAgICAgICAgICAg\nICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShtZXRoc1tpXS5nZXROYW1lKCkp\nLCBhZnRlclBhcmFtcyk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAo\nbWF0Y2ggIT0gbnVsbCB8fCBhZnRlciAhPSBudWxsKQogICAgICAgICAgICAg\nICAgcHJveHlCZWZvcmVBZnRlck1ldGhvZChiYywgdHlwZSwgbWV0aHNbaV0s\nIG1hdGNoLCBwYXJhbXMsIGFmdGVyLAogICAgICAgICAgICAgICAgICAgIGFm\ndGVyUGFyYW1zKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHBhcmFtZXRlciB0eXBlcyB0byB0aGUgY29ycmVzcG9uZGlu\nZyBoZWxwZXIgY2xhc3MgbWV0aG9kLgogICAgICovIAogICAgcHJpdmF0ZSBz\ndGF0aWMgQ2xhc3NbXSB0b0hlbHBlclBhcmFtZXRlcnMoQ2xhc3NbXSBjbHMs\nIENsYXNzIGhlbHBlcikgewogICAgICAgIENsYXNzW10gcGFyYW1zID0gbmV3\nIENsYXNzW2Nscy5sZW5ndGggKyAxXTsKICAgICAgICBwYXJhbXNbMF0gPSBo\nZWxwZXI7CiAgICAgICAgU3lzdGVtLmFycmF5Y29weShjbHMsIDAsIHBhcmFt\ncywgMSwgY2xzLmxlbmd0aCk7IAogICAgICAgIHJldHVybiBwYXJhbXM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBhcmFtZXRlciB0eXBl\ncyB0byB0aGUgY29ycmVzcG9uZGluZyBoZWxwZXIgY2xhc3MgImFmdGVyIiAg\nICAgCiAgICAgKiBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIENsYXNzW10gdG9IZWxwZXJBZnRlclBhcmFtZXRlcnMoQ2xhc3NbXSBjbHMs\nIENsYXNzIHJldCwKICAgICAgICBDbGFzcyBiZWZvcmVSZXQpIHsKICAgICAg\nICBpZiAocmV0ID09IHZvaWQuY2xhc3MgJiYgYmVmb3JlUmV0ID09IHZvaWQu\nY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBjbHM7CiAgICAgICAgaW50IGxl\nbiA9IGNscy5sZW5ndGg7CiAgICAgICAgaWYgKHJldCAhPSB2b2lkLmNsYXNz\nKQogICAgICAgICAgICBsZW4rKzsKICAgICAgICBpZiAoYmVmb3JlUmV0ICE9\nIHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGxlbisrOwogICAgICAgIENsYXNz\nW10gcGFyYW1zID0gbmV3IENsYXNzW2xlbl07CiAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShjbHMsIDAsIHBhcmFtcywgMCwgY2xzLmxlbmd0aCk7CiAgICAg\nICAgaW50IHBvcyA9IGNscy5sZW5ndGg7CiAgICAgICAgaWYgKHJldCAhPSB2\nb2lkLmNsYXNzKQogICAgICAgICAgICBwYXJhbXNbcG9zKytdID0gcmV0Owog\nICAgICAgIGlmIChiZWZvcmVSZXQgIT0gdm9pZC5jbGFzcykKICAgICAgICAg\nICAgcGFyYW1zW3BvcysrXSA9IGJlZm9yZVJldDsKICAgICAgICByZXR1cm4g\ncGFyYW1zOwogICAgfQoKICAgIC8qKgogICAgICogUHJveHkgc2V0dGVyIG1l\ndGhvZHMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKiAKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiB3ZSBmaW5kIGFueSBzZXR0ZXJzLCBmYWxzZSBvdGhlcndp\nc2UKICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHByb3h5U2V0dGVycyhC\nQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7CiAgICAgICAgTWV0aG9kW10gbWV0\naHMgPSB0eXBlLmdldE1ldGhvZHMoKTsKICAgICAgICBpbnQgc2V0dGVycyA9\nIDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRocy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoaXNTZXR0ZXIobWV0aHNbaV0pICYm\nICFNb2RpZmllci5pc0ZpbmFsKG1ldGhzW2ldLmdldE1vZGlmaWVycygpKQog\nICAgICAgICAgICAgICAgJiYgYmMuZ2V0RGVjbGFyZWRNZXRob2QobWV0aHNb\naV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgbWV0aHNbaV0uZ2V0UGFy\nYW1ldGVyVHlwZXMoKSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2V0\ndGVycysrOwogICAgICAgICAgICAgICAgcHJveHlTZXR0ZXIoYmMsIHR5cGUs\nIG1ldGhzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0gCiAgICAgICAg\ncmV0dXJuIHNldHRlcnMgPiAwOwogICAgfQoKICAgIC8qKgogICAgICogUHJv\neHkgdGhlIGdpdmVuIG1ldGhvZCB3aXRoIG9uZSB0aGF0IG92ZXJyaWRlcyBp\ndCBieSBjYWxsaW5nIGludG8gdGhlCiAgICAgKiBnaXZlbiBoZWxwZXIuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm94eU92ZXJyaWRlTWV0aG9kKEJD\nQ2xhc3MgYmMsIE1ldGhvZCBtZXRoLCAKICAgICAgICBNZXRob2QgaGVscGVy\nLCBDbGFzc1tdIHBhcmFtcykgewogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5k\nZWNsYXJlTWV0aG9kKG1ldGguZ2V0TmFtZSgpLCBtZXRoLmdldFJldHVyblR5\ncGUoKSwKICAgICAgICAgICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsK\nICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBwYXJhbXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShpIC0g\nMSkuc2V0VHlwZShwYXJhbXNbaV0pOwogICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKGhlbHBlcik7CiAgICAgICAgY29kZS54cmV0dXJu\nKCkuc2V0VHlwZShtZXRoLmdldFJldHVyblR5cGUoKSk7CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUHJveHkgdGhl\nIGdpdmVuIG1ldGhvZCB3aXRoIG9uZSB0aGF0IG92ZXJyaWRlcyBpdCBieSBj\nYWxsaW5nIGludG8gdGhlCiAgICAgKiBnaXZlbiBoZWxwZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwcm94eUJlZm9yZUFmdGVyTWV0aG9kKEJDQ2xh\nc3MgYmMsIENsYXNzIHR5cGUsIE1ldGhvZCBtZXRoLCAKICAgICAgICBNZXRo\nb2QgYmVmb3JlLCBDbGFzc1tdIHBhcmFtcywgTWV0aG9kIGFmdGVyLCBDbGFz\nc1tdIGFmdGVyUGFyYW1zKSB7CiAgICAgICAgQkNNZXRob2QgbSA9IGJjLmRl\nY2xhcmVNZXRob2QobWV0aC5nZXROYW1lKCksIG1ldGguZ2V0UmV0dXJuVHlw\nZSgpLAogICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwog\nICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0u\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaW52b2tlIGJlZm9yZQogICAg\nICAgIGludCBiZWZvcmVSZXQgPSAtMTsKICAgICAgICBpZiAoYmVmb3JlICE9\nIG51bGwpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCBwYXJhbXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0o\naSAtIDEpLnNldFR5cGUocGFyYW1zW2ldKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoYmVmb3JlKTsKICAgICAgICAgICAg\naWYgKGFmdGVyICE9IG51bGwgJiYgYmVmb3JlLmdldFJldHVyblR5cGUoKSAh\nPSB2b2lkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICBiZWZvcmVSZXQgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29k\nZS54c3RvcmUoKS5zZXRMb2NhbChiZWZvcmVSZXQpLgogICAgICAgICAgICAg\nICAgICAgIHNldFR5cGUoYmVmb3JlLmdldFJldHVyblR5cGUoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGludm9rZSBzdXBlcgog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDE7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGNvZGUueGxvYWQoKS5zZXRQYXJhbShpIC0gMSkuc2V0VHlwZShwYXJhbXNb\naV0pOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0\neXBlLCBtZXRoLmdldE5hbWUoKSwgCiAgICAgICAgICAgIG1ldGguZ2V0UmV0\ndXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwoKICAgICAg\nICAvLyBpbnZva2UgYWZ0ZXIgCiAgICAgICAgaWYgKGFmdGVyICE9IG51bGwp\nIHsKICAgICAgICAgICAgaW50IHJldCA9IC0xOwogICAgICAgICAgICBpZiAo\nbWV0aC5nZXRSZXR1cm5UeXBlKCkgIT0gdm9pZC5jbGFzcykgewogICAgICAg\nICAgICAgICAgcmV0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICAgICAgICAgIGNvZGUueHN0b3JlKCkuc2V0TG9jYWwocmV0KS5zZXRU\neXBlKG1ldGguZ2V0UmV0dXJuVHlwZSgpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMTsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShpIC0gMSkuc2V0VHlw\nZShwYXJhbXNbaV0pOwogICAgICAgICAgICBpZiAocmV0ICE9IC0xKQogICAg\nICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldExvY2FsKHJldCkuc2V0VHlw\nZShtZXRoLmdldFJldHVyblR5cGUoKSk7CiAgICAgICAgICAgIGlmIChiZWZv\ncmVSZXQgIT0gLTEpCiAgICAgICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0\nTG9jYWwoYmVmb3JlUmV0KS4KICAgICAgICAgICAgICAgICAgICBzZXRUeXBl\nKGJlZm9yZS5nZXRSZXR1cm5UeXBlKCkpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChhZnRlcik7CiAgICAgICAgfQogICAg\nICAgIGNvZGUueHJldHVybigpLnNldFR5cGUobWV0aC5nZXRSZXR1cm5UeXBl\nKCkpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBtZXRob2QgaXMgYSBz\nZXR0ZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzU2V0dGVy\nKE1ldGhvZCBtZXRoKSB7CiAgICAgICAgcmV0dXJuIHN0YXJ0c1dpdGgobWV0\naC5nZXROYW1lKCksICJzZXQiKQogICAgICAgICAgICB8fCBzdGFydHNXaXRo\nKG1ldGguZ2V0TmFtZSgpLCAiYWRkIikKICAgICAgICAgICAgfHwgc3RhcnRz\nV2l0aChtZXRoLmdldE5hbWUoKSwgInJlbW92ZSIpCiAgICAgICAgICAgIHx8\nIHN0YXJ0c1dpdGgobWV0aC5nZXROYW1lKCksICJpbnNlcnQiKQogICAgICAg\nICAgICB8fCBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAiY2xlYXIiKQog\nICAgICAgICAgICB8fCBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAicm9s\nbCIpOyAvLyB1c2VkIGJ5IENhbGVuZGFyCiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGdldHRlciBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZl\nbiBzZXR0ZXIsIG9yIG51bGwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBNZXRo\nb2QgZmluZEdldHRlcihDbGFzcyB0eXBlLCBNZXRob2Qgc2V0dGVyKSB7CiAg\nICAgICAgU3RyaW5nIG5hbWUgPSBzZXR0ZXIuZ2V0TmFtZSgpLnN1YnN0cmlu\nZygzKTsKICAgICAgICBDbGFzcyBwYXJhbSA9IHNldHRlci5nZXRQYXJhbWV0\nZXJUeXBlcygpWzBdOwogICAgICAgIE1ldGhvZCBnZXR0ZXI7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZ2V0dGVyID0gdHlwZS5nZXRNZXRob2QoImdl\ndCIgKyBuYW1lLCAoQ2xhc3NbXSkgbnVsbCk7ICAgCiAgICAgICAgICAgIGlm\nIChnZXR0ZXIuZ2V0UmV0dXJuVHlwZSgpLmlzQXNzaWduYWJsZUZyb20ocGFy\nYW0pCiAgICAgICAgICAgICAgICB8fCBwYXJhbS5pc0Fzc2lnbmFibGVGcm9t\nKGdldHRlci5nZXRSZXR1cm5UeXBlKCkpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldHRlcjsKICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gbnNtZSkgewogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwog\nICAgICAgIH0KCiAgICAgICAgaWYgKHBhcmFtID09IGJvb2xlYW4uY2xhc3Mg\nfHwgcGFyYW0gPT0gQm9vbGVhbi5jbGFzcykgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgZ2V0dGVyID0gdHlwZS5nZXRNZXRob2QoImlz\nIiArIG5hbWUsIChDbGFzc1tdKSBudWxsKTsgICAKICAgICAgICAgICAgICAg\nIGlmIChnZXR0ZXIuZ2V0UmV0dXJuVHlwZSgpLmlzQXNzaWduYWJsZUZyb20o\ncGFyYW0pCiAgICAgICAgICAgICAgICAgICAgfHwgcGFyYW0uaXNBc3NpZ25h\nYmxlRnJvbShnZXR0ZXIuZ2V0UmV0dXJuVHlwZSgpKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0dGVyOwogICAgICAgICAgICB9IGNhdGNoIChO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gd2hldGhlciB0aGUgdGFyZ2V0IHN0cmluZyBzdGFycyB3aXRoIHRo\nZSBnaXZlbiB0b2tlbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiBzdGFydHNXaXRoKFN0cmluZyBzdHIsIFN0cmluZyB0b2tlbikgewog\nICAgICAgIHJldHVybiBzdHIuc3RhcnRzV2l0aCh0b2tlbikKICAgICAgICAg\nICAgJiYgKHN0ci5sZW5ndGgoKSA9PSB0b2tlbi5sZW5ndGgoKSAKICAgICAg\nICAgICAgfHwgQ2hhcmFjdGVyLmlzVXBwZXJDYXNlKHN0ci5jaGFyQXQodG9r\nZW4ubGVuZ3RoKCkpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm94eSB0\naGUgZ2l2ZW4gc2V0dGVyIG1ldGhvZCB0byBkaXJ0eSB0aGUgcHJveHkgb3du\nZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm94eVNldHRlcihCQ0Ns\nYXNzIGJjLCBDbGFzcyB0eXBlLCBNZXRob2QgbWV0aCkgewogICAgICAgIENs\nYXNzW10gcGFyYW1zID0gbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAg\nICAgIENsYXNzIHJldCA9IG1ldGguZ2V0UmV0dXJuVHlwZSgpOwogICAgICAg\nIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKG1ldGguZ2V0TmFtZSgp\nLCByZXQsIHBhcmFtcyk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKHRydWUpOwogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKFByb3hpZXMuY2xhc3MsICJkaXJ0eSIsIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgIG5ldyBDbGFzc1tdIHsgUHJveHkuY2xhc3MsIGJvb2xlYW4u\nY2xhc3MgfSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGkpLnNldFR5cGUo\ncGFyYW1zW2ldKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QodHlwZSwgbWV0aC5nZXROYW1lKCksIHJldCwgcGFyYW1zKTsKICAg\nICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKHJldCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSB3cml0\nZVJlcGxhY2UgaW1wbGVtZW50YXRpb24gdGhhdCBzZXJpYWxpemVzIHRvIGEg\nbm9uLXByb3h5IHR5cGUKICAgICAqIHVubGVzcyBkZXRhY2hlZCBhbmQgdGhp\ncyBpcyBhIGJ1aWxkLXRpbWUgZ2VuZXJhdGVkIGNsYXNzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKEJDQ2xhc3Mg\nYmMsIGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIEJDTWV0aG9kIG0gPSBi\nYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZVJlcGxhY2UiLCBPYmplY3QuY2xhc3Ms\nIG51bGwpOwogICAgICAgIG0ubWFrZVByb3RlY3RlZCgpOwogICAgICAgIG0u\nZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oT2JqZWN0U3RyZWFt\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoIXJ1bnRpbWUpOwogICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFByb3hpZXMuY2xh\nc3MsICJ3cml0ZVJlcGxhY2UiLCAKICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7IFByb3h5LmNsYXNzLCBib29sZWFuLmNsYXNzIH0p\nOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgdW5pcXVlIGlk\nIHRvIGF2b2lkIHByb3h5IGNsYXNzIG5hbWUgY29uZmxpY3RzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBzeW5jaHJvbml6ZWQgbG9uZyBuZXh0UHJv\neHlJZCgpIHsKICAgICAgICByZXR1cm4gX3Byb3h5SWQrKzsKICAgIH0KCiAg\nICAvKioKICAgICAqIEZpbmQgYW4gYXBwcm9wcmlhdGUgY29weSBjb25zdHJ1\nY3RvciBmb3IgdGhlIGdpdmVuIHR5cGUsIG9yIHJldHVybiBudWxsCiAgICAg\nKiBpZiBub25lLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29uc3RydWN0b3Ig\nZmluZENvcHlDb25zdHJ1Y3RvcihDbGFzcyBjbHMpIHsKICAgICAgICBDb25z\ndHJ1Y3RvcltdIGNvbnMgPSBjbHMuZ2V0Q29uc3RydWN0b3JzKCk7CiAgICAg\nICAgQ29uc3RydWN0b3IgbWF0Y2ggPSBudWxsOwogICAgICAgIENsYXNzIG1h\ndGNoUGFyYW0gPSBudWxsOwogICAgICAgIENsYXNzW10gcGFyYW1zOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29ucy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBwYXJhbXMgPSBjb25zW2ldLmdldFBhcmFtZXRlclR5cGVz\nKCk7CiAgICAgICAgICAgIGlmIChwYXJhbXMubGVuZ3RoICE9IDEpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIHF1aXQgaW1t\nZWRpYXRlbHkgb24gZXhhY3QgbWF0Y2gKICAgICAgICAgICAgaWYgKHBhcmFt\nc1swXSA9PSBjbHMpCiAgICAgICAgICAgICAgICByZXR1cm4gY29uc1tpXTsK\nCiAgICAgICAgICAgIGlmIChwYXJhbXNbMF0uaXNBc3NpZ25hYmxlRnJvbShj\nbHMpICYmIChtYXRjaFBhcmFtID09IG51bGwKICAgICAgICAgICAgICAgIHx8\nIG1hdGNoUGFyYW0uaXNBc3NpZ25hYmxlRnJvbShwYXJhbXNbMF0pKSkgewog\nICAgICAgICAgICAgICAgIC8vIHRyYWNrIG1vc3QgZGVyaXZlZCBjb2xsZWN0\naW9uIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICBtYXRjaCA9IGNvbnNb\naV07CiAgICAgICAgICAgICAgICBtYXRjaFBhcmFtID0gcGFyYW1zWzBdOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBtYXRjaDsg\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbnN0cnVjdG9y\nIHRoYXQgdGFrZXMgYSBjb21wYXJhdG9yIGZvciB0aGUgZ2l2ZW4gdHlwZSwg\nb3IKICAgICAqIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgQ29uc3RydWN0b3IgZmluZENvbXBhcmF0b3JDb25zdHJ1Y3RvcihD\nbGFzcyBjbHMpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nY2xzLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdIHsgQ29tcGFyYXRvci5j\nbGFzcyB9KTsKICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gbnNtZSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5w\ncm94eS5Qcm94eU1hbmFnZXJJbXBsIFtvcHRpb25dKgogICAgICogJmx0O2Ns\nYXNzIG5hbWUmZ3Q7KzxiciAvPgogICAgICogV2hlcmUgdGhlIGZvbGxvd2lu\nZyBvcHRpb25zIGFyZSByZWNvZ25pemVkOgogICAgICogPHVsPiAKICAgICAq\nIDxsaT48aT4tdXRpbHMvLXUgJmx0O251bWJlciZndDs8L2k+OiBHZW5lcmF0\nZSBwcm94aWVzIGZvciB0aGUgc3RhbmRhcmQKICAgICAqIGphdmEudXRpbCBj\nb2xsZWN0aW9uLCBtYXAsIGRhdGUsIGFuZCBjYWxlbmRhciBjbGFzc2VzIG9m\nIHRoZSBnaXZlbiBKYXZhCiAgICAgKiB2ZXJzaW9uLiAgVXNlIDQgZm9yIEph\ndmEgMS40LCA1IGZvciBKYXZhIDUsIGV0Yy48L2xpPgogICAgICogPC91bD4K\nICAgICAqCiAgICAgKiBUaGUgbWFpbiBtZXRob2QgZ2VuZXJhdGVzIC5jbGFz\ncyBmaWxlcyBmb3IgdGhlIHByb3hpZXMgdG8gdGhlIGNsYXNzZXMgICAgCiAg\nICAgKiBnaXZlbiBvbiB0aGUgY29tbWFuZCBsaW5lLiAgSXQgd3JpdGVzIHRo\nZSBnZW5lcmF0ZWQgY2xhc3NlcyB0byBiZXNpZGUgdGhlCiAgICAgKiBQcm94\neU1hbmFnZXJJbXBsLmNsYXNzIGZpbGUgaWYgcG9zc2libGU7IG90aGVyd2lz\nZSBpdCB3cml0ZXMgdG8gdGhlIAogICAgICogY3VycmVudCBkaXJlY3Rvcnku\nICBUaGUgcHJveHkgbWFuYWdlciBsb29rcyBmb3IgdGhlc2UgY2xhc3NlcyAK\nICAgICAqIGJlZm9yZSBnZW5lcmF0aW5nIGl0cyBvd24gcHJveGllcyBhdCBy\ndW50aW1lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihT\ndHJpbmdbXSBhcmdzKSAKICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4\nY2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGUgZGlyID0gRmls\nZXMuZ2V0Q2xhc3NGaWxlKFByb3h5TWFuYWdlckltcGwuY2xhc3MpOwogICAg\nICAgIGRpciA9IChkaXIgPT0gbnVsbCkgPyBuZXcgRmlsZSgoU3RyaW5nKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0UHJvcGVydHlBY3Rpb24oInVzZXIuZGlyIikpKQog\nICAgICAgICAgICA6IGRpci5nZXRQYXJlbnRGaWxlKCk7CgogICAgICAgIE9w\ndGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgYXJncyA9IG9w\ndHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CgogICAgICAgIExpc3QgdHlwZXMg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgdHlwZXMuYWRkQWxsKEFycmF5\ncy5hc0xpc3QoYXJncykpOwogICAgICAgIGludCB1dGlscyA9IG9wdHMucmVt\nb3ZlSW50UHJvcGVydHkoInV0aWxzIiwgInUiLCAwKTsKICAgICAgICBpZiAo\ndXRpbHMgPj0gNCkgewogICAgICAgICAgICB0eXBlcy5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChuZXcgU3RyaW5nW10gewogICAgICAgICAgICAgICAgamF2YS5z\ncWwuRGF0ZS5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZh\nLnNxbC5UaW1lLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGph\ndmEuc3FsLlRpbWVzdGFtcC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAg\nICAgICBqYXZhLnV0aWwuQXJyYXlMaXN0LmNsYXNzLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgIGphdmEudXRpbC5EYXRlLmNsYXNzLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgIGphdmEudXRpbC5HcmVnb3JpYW5DYWxlbmRhci5j\nbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZhLnV0aWwuSGFz\naE1hcC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBqYXZhLnV0\naWwuSGFzaFNldC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBq\nYXZhLnV0aWwuSGFzaHRhYmxlLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgIGphdmEudXRpbC5MaW5rZWRMaXN0LmNsYXNzLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgIGphdmEudXRpbC5Qcm9wZXJ0aWVzLmNsYXNzLmdl\ndE5hbWUoKSwKICAgICAgICAgICAgICAgIGphdmEudXRpbC5UcmVlTWFwLmNs\nYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGphdmEudXRpbC5UcmVl\nU2V0LmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGphdmEudXRp\nbC5WZWN0b3IuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICB9KSk7IAog\nICAgICAgIH0KICAgICAgICBpZiAodXRpbHMgPj0gNSkgewogICAgICAgICAg\nICB0eXBlcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW10gewog\nICAgICAgICAgICAgICAgImphdmEudXRpbC5FbnVtTWFwIiwKICAgICAgICAg\nICAgICAgICJqYXZhLnV0aWwuSWRlbnRpdHlIYXNoTWFwIiwKICAgICAgICAg\nICAgICAgICJqYXZhLnV0aWwuTGlua2VkSGFzaE1hcCIsCiAgICAgICAgICAg\nICAgICAiamF2YS51dGlsLkxpbmtlZEhhc2hTZXQiLAogICAgICAgICAgICAg\nICAgImphdmEudXRpbC5Qcmlvcml0eVF1ZXVlIiwKICAgICAgICAgICAgfSkp\nOyAKICAgICAgICB9CgogICAgICAgIFByb3h5TWFuYWdlckltcGwgbWdyID0g\nbmV3IFByb3h5TWFuYWdlckltcGwoKTsKICAgICAgICBDbGFzcyBjbHM7CiAg\nICAgICAgQkNDbGFzcyBiYzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHR5cGVzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGNscyA9IENsYXNz\nLmZvck5hbWUoKFN0cmluZykgdHlwZXMuZ2V0KGkpKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGlmIChDbGFzcy5mb3JOYW1lKGdldFBy\nb3h5Q2xhc3NOYW1lKGNscywgZmFsc2UpLCB0cnVlLAogICAgICAgICAgICAg\nICAgICAgIEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRMb2FkZXIo\nY2xzLCBQcm94eS5jbGFzcykpCiAgICAgICAgICAgICAgICAgICAgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGV4\ncGVjdGVkIGlmIHRoZSBjbGFzcyBoYXNuJ3QgYmVlbiBnZW5lcmF0ZWQKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKENvbGxlY3Rpb24uY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICAgICAgYmMgPSBt\nZ3IuZ2VuZXJhdGVQcm94eUNvbGxlY3Rpb25CeXRlY29kZShjbHMsIGZhbHNl\nKTsgICAgICAgICAKICAgICAgICAgICAgZWxzZSBpZiAoTWFwLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAgICAgIGJjID0gbWdy\nLmdlbmVyYXRlUHJveHlNYXBCeXRlY29kZShjbHMsIGZhbHNlKTsgICAgICAg\nICAKICAgICAgICAgICAgZWxzZSBpZiAoRGF0ZS5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKGNscykpCiAgICAgICAgICAgICAgICBiYyA9IG1nci5nZW5lcmF0\nZVByb3h5RGF0ZUJ5dGVjb2RlKGNscywgZmFsc2UpOwogICAgICAgICAgICBl\nbHNlIGlmIChDYWxlbmRhci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykp\nCiAgICAgICAgICAgICAgICBiYyA9IG1nci5nZW5lcmF0ZVByb3h5Q2FsZW5k\nYXJCeXRlY29kZShjbHMsIGZhbHNlKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYmMgPSBtZ3IuZ2VuZXJhdGVQcm94eUJlYW5CeXRlY29k\nZShjbHMsIGZhbHNlKTsKCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRs\nbihiYy5nZXROYW1lKCkpOwogICAgICAgICAgICBiYy53cml0ZShuZXcgRmls\nZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsgIi5jbGFzcyIpKTsKICAgICAg\nICB9CiAgICB9Cn0K\n","encoding":"base64"}

