{"sha":"22f07d8876fd9e5e52079f40a59e04fa7dc2e39e","node_id":"MDQ6QmxvYjIwNjM2NDoyMmYwN2Q4ODc2ZmQ5ZTVlNTIwNzlmNDBhNTllMDRmYTdkYzJlMzll","size":23623,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/22f07d8876fd9e5e52079f40a59e04fa7dc2e39e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5NaXNz\naW5nUmVzb3VyY2VFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVy\ndGllczsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IGphdmF4\nLm5hbWluZy5Db250ZXh0OwppbXBvcnQgamF2YXgubmFtaW5nLkluaXRpYWxD\nb250ZXh0OwppbXBvcnQgamF2YXgubmFtaW5nLk5hbWluZ0V4Y2VwdGlvbjsK\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsK\naW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0\nYWJsZVJ1bnRpbWVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuUGFyc2VFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5j\nb25jdXJyZW50LkNvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwOwoKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFV0aWxpdHkgbWV0aG9kcyBk\nZWFsaW5nIHdpdGggY29uZmlndXJhdGlvbi4KICoKICogQGF1dGhvciBBYmUg\nV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIENvbmZpZ3Vy\nYXRpb25zIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKENvbmZpZ3Vy\nYXRpb25zLmNsYXNzKTsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgQ29uY3Vy\ncmVudFJlZmVyZW5jZUhhc2hNYXAgX2xvYWRlcnMgPSBuZXcgCiAgICAgICAg\nQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoQ29uY3VycmVudFJlZmVyZW5j\nZUhhc2hNYXAuV0VBSywgCiAgICAgICAgICAgICAgICBDb25jdXJyZW50UmVm\nZXJlbmNlSGFzaE1hcC5IQVJEKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBPYmplY3QgTlVMTF9MT0FERVIgPSAibnVsbC1sb2FkZXIiOwoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBjbGFzcyBuYW1lIGZyb20gdGhlIGdpdmVu\nIHBsdWdpbiBzdHJpbmcsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0Q2xhc3NOYW1lKFN0cmluZyBwbHVn\naW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdp\nbiwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBy\nb3BlcnRpZXMgcGFydCBvZiB0aGUgZ2l2ZW4gcGx1Z2luIHN0cmluZywgb3Ig\nbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmlu\nZyBnZXRQcm9wZXJ0aWVzKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1\ncm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdpbiwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGVpdGhlciB0aGUgY2xhc3MgbmFtZSBv\nciBwcm9wZXJ0aWVzIHN0cmluZyBmcm9tIGEgcGx1Z2luIHN0cmluZy4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFBsdWdpbkNvbXBv\nbmVudChTdHJpbmcgcGx1Z2luLCBib29sZWFuIGNsc05hbWUpIHsKICAgICAg\nICBpZiAocGx1Z2luICE9IG51bGwpCiAgICAgICAgICAgIHBsdWdpbiA9IHBs\ndWdpbi50cmltKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\ncGx1Z2luKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlu\ndCBvcGVuUGFyZW4gPSAtMTsKICAgICAgICBpZiAocGx1Z2luLmNoYXJBdChw\nbHVnaW4ubGVuZ3RoKCkgLSAxKSA9PSAnKScpCiAgICAgICAgICAgIG9wZW5Q\nYXJlbiA9IHBsdWdpbi5pbmRleE9mKCcoJyk7CiAgICAgICAgaWYgKG9wZW5Q\nYXJlbiA9PSAtMSkgewogICAgICAgICAgICBpbnQgZXEgPSBwbHVnaW4uaW5k\nZXhPZignPScpOwogICAgICAgICAgICBpZiAoZXEgPT0gLTEpCiAgICAgICAg\nICAgICAgICByZXR1cm4gKGNsc05hbWUpID8gcGx1Z2luIDogbnVsbDsKICAg\nICAgICAgICAgcmV0dXJuIChjbHNOYW1lKSA/IG51bGwgOiBwbHVnaW47CiAg\nICAgICAgfQoKICAgICAgICAvLyBjbHNOYW1lKHByb3BzKSBmb3JtCiAgICAg\nICAgaWYgKGNsc05hbWUpCiAgICAgICAgICAgIHJldHVybiBwbHVnaW4uc3Vi\nc3RyaW5nKDAsIG9wZW5QYXJlbikudHJpbSgpOwogICAgICAgIFN0cmluZyBw\ncm9wID0gcGx1Z2luLnN1YnN0cmluZyhvcGVuUGFyZW4gKyAxLAogICAgICAg\nICAgICBwbHVnaW4ubGVuZ3RoKCkgLSAxKS50cmltKCk7CiAgICAgICAgcmV0\ndXJuIChwcm9wLmxlbmd0aCgpID09IDApID8gbnVsbCA6IHByb3A7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjbGFzcyBuYW1l\nIGFuZCBwcm9wZXJ0aWVzIGludG8gYSBwbHVnaW4gc3RyaW5nLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRQbHVnaW4oU3RyaW5nIGNs\nc05hbWUsIFN0cmluZyBwcm9wcykgewogICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KGNsc05hbWUpKQogICAgICAgICAgICByZXR1cm4gcHJvcHM7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcHMpKQogICAg\nICAgICAgICByZXR1cm4gY2xzTmFtZTsKICAgICAgICByZXR1cm4gY2xzTmFt\nZSArICIoIiArIHByb3BzICsgIikiOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEgcGx1Z2luIHN0cmluZyB0aGF0IGNvbWJpbmVzIHRoZSBwcm9w\nZXJ0aWVzIG9mIHRoZSBnaXZlbiBwbHVnaW4KICAgICAqIHN0cmluZ3MsIHdo\nZXJlIHByb3BlcnRpZXMgb2YgPGNvZGU+b3ZlcnJpZGU8L2NvZGU+IHdpbGwg\nb3ZlcnJpZGUgdGhlCiAgICAgKiBzYW1lIHByb3BlcnRpZXMgb2YgPGNvZGU+\nb3JpZzwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5n\nIGNvbWJpbmVQbHVnaW5zKFN0cmluZyBvcmlnLCBTdHJpbmcgb3ZlcnJpZGUp\nIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnKSkKICAg\nICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOwogICAgICAgIGlmIChTdHJpbmdV\ndGlscy5pc0VtcHR5KG92ZXJyaWRlKSkKICAgICAgICAgICAgcmV0dXJuIG9y\naWc7CgogICAgICAgIFN0cmluZyBvcmlnQ2xzID0gZ2V0Q2xhc3NOYW1lKG9y\naWcpOwogICAgICAgIFN0cmluZyBvdmVycmlkZUNscyA9IGdldENsYXNzTmFt\nZShvdmVycmlkZSk7CiAgICAgICAgU3RyaW5nIGNsczsKICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnQ2xzKSkKICAgICAgICAgICAgY2xz\nID0gb3ZlcnJpZGVDbHM7CiAgICAgICAgZWxzZSBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShvdmVycmlkZUNscykpCiAgICAgICAgICAgIGNscyA9IG9yaWdD\nbHM7CiAgICAgICAgZWxzZSBpZiAoIW9yaWdDbHMuZXF1YWxzKG92ZXJyaWRl\nQ2xzKSkKICAgICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOyAvLyBjb21wbGV0\nZWx5IGRpZmZlcmVudCBwbHVnaW4KICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGNscyA9IG9yaWdDbHM7CgogICAgICAgIFN0cmluZyBvcmlnUHJvcHMgPSBn\nZXRQcm9wZXJ0aWVzKG9yaWcpOwogICAgICAgIFN0cmluZyBvdmVycmlkZVBy\nb3BzID0gZ2V0UHJvcGVydGllcyhvdmVycmlkZSk7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkob3JpZ1Byb3BzKSkKICAgICAgICAgICAgcmV0\ndXJuIGdldFBsdWdpbihjbHMsIG92ZXJyaWRlUHJvcHMpOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJyaWRlUHJvcHMpKQogICAgICAg\nICAgICByZXR1cm4gZ2V0UGx1Z2luKGNscywgb3JpZ1Byb3BzKTsKCiAgICAg\nICAgUHJvcGVydGllcyBwcm9wcyA9IHBhcnNlUHJvcGVydGllcyhvcmlnUHJv\ncHMpOwogICAgICAgIHByb3BzLnB1dEFsbChwYXJzZVByb3BlcnRpZXMob3Zl\ncnJpZGVQcm9wcykpOwogICAgICAgIHJldHVybiBnZXRQbHVnaW4oY2xzLCBz\nZXJpYWxpemVQcm9wZXJ0aWVzKHByb3BzKSk7IAogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIHRoZSBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiBjbGFz\ncyBuYW1lLCB1c2luZyB0aGUgZ2l2ZW4KICAgICAqIGNsYXNzIGxvYWRlci4g\nTm8gY29uZmlndXJhdGlvbiBvZiB0aGUgaW5zdGFuY2UgaXMgcGVyZm9ybWVk\nIGJ5CiAgICAgKiB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgbmV3SW5zdGFuY2UoU3RyaW5nIGNsc05hbWUsIENsYXNz\nTG9hZGVyIGxvYWRlcikgewogICAgICAgIHJldHVybiBuZXdJbnN0YW5jZShj\nbHNOYW1lLCBudWxsLCBudWxsLCBsb2FkZXIsIHRydWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGFuZCBjb25maWd1cmUgYW4gaW5zdGFuY2Ug\nd2l0aCB0aGUgZ2l2ZW4gY2xhc3MgbmFtZSBhbmQKICAgICAqIHByb3BlcnRp\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG5ld0luc3Rh\nbmNlKFN0cmluZyBjbHNOYW1lLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAg\nICAgU3RyaW5nIHByb3BzLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAg\nICBPYmplY3Qgb2JqID0gbmV3SW5zdGFuY2UoY2xzTmFtZSwgbnVsbCwgY29u\nZiwgbG9hZGVyLCB0cnVlKTsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShv\nYmosIGNvbmYsIHByb3BzKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB1c2VkIGJ5IG1lbWJlcnMg\nb2YgdGhpcyBwYWNrYWdlIHRvIGluc3RhbnRpYXRlIHBsdWdpbgogICAgICog\ndmFsdWVzLgogICAgICovCiAgICBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNl\nKFN0cmluZyBjbHNOYW1lLCBWYWx1ZSB2YWwsIENvbmZpZ3VyYXRpb24gY29u\nZiwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZmF0YWwp\nIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjbHNOYW1lKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzIGNscyA9\nIG51bGw7IAoKICAgICAgICAvLyBjYW4ndCBoYXZlIGEgbnVsbCByZWZlcmVu\nY2UgaW4gdGhlIG1hcCwgc28gdXNlIHN5bWJvbGljIAogICAgICAgIC8vIGNv\nbnN0YW50IGFzIGtleQogICAgICAgIE9iamVjdCBrZXkgPSBsb2FkZXIgPT0g\nbnVsbCA/IE5VTExfTE9BREVSIDogbG9hZGVyOwogICAgICAgIE1hcCBsb2Fk\nZXJDYWNoZSA9IChNYXApIF9sb2FkZXJzLmdldChrZXkpOwogICAgICAgIGlm\nIChsb2FkZXJDYWNoZSA9PSBudWxsKSB7IC8vIFdlIGRvbid0IGhhdmUgYSBj\nYWNoZSBmb3IgdGhpcyBsb2FkZXIuCiAgICAgICAgICAgIGxvYWRlckNhY2hl\nID0gbmV3IENvbmN1cnJlbnRIYXNoTWFwKCk7CiAgICAgICAgICAgIF9sb2Fk\nZXJzLnB1dChrZXksIGxvYWRlckNhY2hlKTsKICAgICAgICB9IGVsc2UgeyAg\nLy8gV2UgaGF2ZSBhIGNhY2hlIGZvciB0aGlzIGxvYWRlci4KICAgICAgICAg\nICAgY2xzID0gKENsYXNzKSBsb2FkZXJDYWNoZS5nZXQoY2xzTmFtZSk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoY2xzID09IG51bGwpIHsgLy8gd2UgaGF2\nZW4ndCBjYWNoZWQgdGhpcy4KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGNscyA9IFN0cmluZ3MudG9DbGFzcyhjbHNOYW1lLCBmaW5kRGVy\naXZlZExvYWRlcihjb25mLCBsb2FkZXIpKTsKICAgICAgICAgICAgICAgIGxv\nYWRlckNhY2hlLnB1dChjbHNOYW1lLCBjbHMpOwogICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBp\nZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmUgPSBnZXRD\ncmVhdGVFeGNlcHRpb24oY2xzTmFtZSwgdmFsLCByZSk7CiAgICAgICAgICAg\nICAgICBpZiAoZmF0YWwpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgcmU7\nCiAgICAgICAgICAgICAgICBMb2cgbG9nID0gKGNvbmYgPT0gbnVsbCkgPyBu\ndWxsIDogY29uZi5nZXRDb25maWd1cmF0aW9uTG9nKCk7CiAgICAgICAgICAg\nICAgICBpZiAobG9nICE9IG51bGwgJiYgbG9nLmlzRXJyb3JFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKF9sb2MuZ2V0KCJwbHVn\naW4tY3JlYXRpb24tZXhjZXB0aW9uIiwgdmFsKSwgcmUpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLm5ld0luc3RhbmNlQWN0aW9uKGNscykpOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2Yg\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAg\nZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0\naW9uKCk7ICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUnVudGltZUV4\nY2VwdGlvbiByZSA9IG5ldyBOZXN0YWJsZVJ1bnRpbWVFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICgib2JqLWNyZWF0ZSIsIGNscykuZ2V0\nTWVzc2FnZSgpLCBlKTsKICAgICAgICAgICAgaWYgKGZhdGFsKQogICAgICAg\nICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIExvZyBsb2cgPSAoY29u\nZiA9PSBudWxsKSA/IG51bGwgOiBjb25mLmdldENvbmZpZ3VyYXRpb25Mb2co\nKTsKICAgICAgICAgICAgaWYgKGxvZyAhPSBudWxsICYmIGxvZy5pc0Vycm9y\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLmVycm9yKF9sb2MuZ2V0\nKCJwbHVnaW4tY3JlYXRpb24tZXhjZXB0aW9uIiwgdmFsKSwgcmUpOwogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBdHRlbXB0IHRvIGZpbmQgYSBkZXJpdmVkIGxvYWRlciB0aGF0\nIGRlbGVnYXRlcyB0byBvdXIgdGFyZ2V0IGxvYWRlci4KICAgICAqIFRoaXMg\nYWxsb3dzIGFwcGxpY2F0aW9uIGxvYWRlcnMgdGhhdCBkZWxlZ2F0ZSBhcHBy\nb3ByaWF0ZWx5IGZvciBrbm93bgogICAgICogY2xhc3NlcyBmaXJzdCBjcmFj\nayBhdCBjbGFzcyBuYW1lcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nQ2xhc3NMb2FkZXIgZmluZERlcml2ZWRMb2FkZXIoQ29uZmlndXJhdGlvbiBj\nb25mLAogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIC8v\nIHdlIGFsd2F5cyBwcmVmZXIgdGhlIHRocmVhZCBsb2FkZXIsIGJlY2F1c2Ug\naXQncyB0aGUgb25seSB0aGluZyB3ZQogICAgICAgIC8vIGNhbiBhY2Nlc3Mg\ndGhhdCBpc24ndCBib3VuZCB0byB0aGUgT3BlbkpQQSBjbGFzc2xvYWRlciwg\ndW5sZXNzCiAgICAgICAgLy8gdGhlIGNvbmYgb2JqZWN0IGlzIG9mIGEgY3Vz\ndG9tIGNsYXNzCiAgICAgICAgQ2xhc3NMb2FkZXIgY3R4TG9hZGVyID0gKENs\nYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q29udGV4dENsYXNzTG9hZGVy\nQWN0aW9uKCkpOwogICAgICAgIGlmIChsb2FkZXIgPT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoY3R4TG9hZGVyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gY3R4TG9hZGVyOwogICAgICAgICAgICBpZiAoY29uZiAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIChDbGFzc0xvYWRlcikgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5n\nZXRDbGFzcygpKSk7IAogICAgICAgICAgICByZXR1cm4gQ29uZmlndXJhdGlv\nbnMuY2xhc3MuZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICB9CgogICAgICAg\nIGZvciAoQ2xhc3NMb2FkZXIgcGFyZW50ID0gY3R4TG9hZGVyOyBwYXJlbnQg\nIT0gbnVsbDsgCiAgICAgICAgICAgIHBhcmVudCA9IChDbGFzc0xvYWRlcikg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXRQYXJlbnRBY3Rpb24ocGFyZW50KSkpIHsK\nICAgICAgICAgICAgaWYgKHBhcmVudCA9PSBsb2FkZXIpCiAgICAgICAgICAg\nICAgICByZXR1cm4gY3R4TG9hZGVyOwogICAgICAgIH0KICAgICAgICBpZiAo\nY29uZiAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoQ2xhc3NMb2FkZXIg\ncGFyZW50ID0gKENsYXNzTG9hZGVyKQogICAgICAgICAgICAgICAgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRD\nbGFzcygpKSk7IAogICAgICAgICAgICAgICAgcGFyZW50ICE9IG51bGw7IAog\nICAgICAgICAgICAgICAgcGFyZW50ID0gKENsYXNzTG9hZGVyKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXRQYXJlbnRBY3Rpb24ocGFyZW50KSkpIHsKICAg\nICAgICAgICAgICAgIGlmIChwYXJlbnQgPT0gbG9hZGVyKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihjb25mLmdldENsYXNz\nKCkpKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ne0BsaW5rIENvbmZpZ3VyYXRpb259IGluc3RhbmNlIGZyb20gdGhlIGNvbW1h\nbmQgbGluZQogICAgICogb3B0aW9ucyBwcm92aWRlZC4gQWxsIHByb3BlcnR5\nIG5hbWVzIG9mIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGFyZQogICAgICog\ncmVjb2duaXplZDsgYWRkaXRpb25hbGx5LCBpZiBhIDxjb2RlPnByb3BlcnRp\nZXM8L2NvZGU+IG9yCiAgICAgKiA8Y29kZT5wPC9jb2RlPiBhcmd1bWVudCBl\neGlzdHMsIHRoZSByZXNvdXJjZSBpdAogICAgICogcG9pbnRzIHRvIHdpbGwg\nYmUgbG9hZGVkIGFuZCBzZXQgaW50byB0aGUgZ2l2ZW4gY29uZmlndXJhdGlv\nbiBpbnN0YW5jZS4KICAgICAqIEl0IGNhbiBwb2ludCB0byBlaXRoZXIgYSBm\naWxlIG9yIGEgcmVzb3VyY2UgbmFtZS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyB2b2lkIHBvcHVsYXRlQ29uZmlndXJhdGlvbihDb25maWd1cmF0aW9u\nIGNvbmYsIE9wdGlvbnMgb3B0cykgewogICAgICAgIFN0cmluZyBwcm9wcyA9\nIG9wdHMucmVtb3ZlUHJvcGVydHkoInByb3BlcnRpZXMiLCAicCIsIG51bGwp\nOwogICAgICAgIENvbmZpZ3VyYXRpb25Qcm92aWRlciBwcm92aWRlcjsKICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcHMpKSB7CiAgICAg\nICAgICAgIFN0cmluZyBwYXRoID0gcHJvcHM7CiAgICAgICAgICAgIFN0cmlu\nZyBhbmNob3IgPSBudWxsOwogICAgICAgICAgICBpbnQgaWR4ID0gcGF0aC5s\nYXN0SW5kZXhPZignIycpOwogICAgICAgICAgICBpZiAoaWR4ICE9IC0xKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaWR4IDwgcGF0aC5sZW5ndGgoKSAtIDEp\nCiAgICAgICAgICAgICAgICAgICAgYW5jaG9yID0gcGF0aC5zdWJzdHJpbmco\naWR4ICsgMSk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJp\nbmcoMCwgaWR4KTsKICAgICAgICAgICAgICAgIGlmIChwYXRoLmxlbmd0aCgp\nID09IDApCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdS\nZXNvdXJjZUV4Y2VwdGlvbihfbG9jLmdldCgiYW5jaG9yLW9ubHkiLAogICAg\nICAgICAgICAgICAgICAgICAgICBwcm9wcykuZ2V0TWVzc2FnZSgpLCBDb25m\naWd1cmF0aW9ucy5jbGFzcy5nZXROYW1lKCksIAogICAgICAgICAgICAgICAg\nICAgICAgICBwcm9wcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZp\nbGUgZmlsZSA9IG5ldyBGaWxlKHBhdGgpOwogICAgICAgICAgICBpZiAoKChC\nb29sZWFuKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJp\ndkhlbHBlcgogICAgICAgICAgICAgICAgLmlzRmlsZUFjdGlvbihmaWxlKSkp\nLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICAgICAgcHJvdmlkZXIgPSBQ\ncm9kdWN0RGVyaXZhdGlvbnMubG9hZChmaWxlLCBhbmNob3IsIG51bGwpOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcg\nRmlsZSgiTUVUQS1JTkYiICsgRmlsZS5zZXBhcmF0b3JDaGFyICsgcGF0aCk7\nCiAgICAgICAgICAgICAgICBpZiAoKChCb29sZWFuKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAg\nICAgICAgIC5pc0ZpbGVBY3Rpb24oZmlsZSkpKS5ib29sZWFuVmFsdWUoKSkK\nICAgICAgICAgICAgICAgICAgICBwcm92aWRlciA9IFByb2R1Y3REZXJpdmF0\naW9ucy5sb2FkKGZpbGUsIGFuY2hvciwgbnVsbCk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIgPSBQcm9kdWN0\nRGVyaXZhdGlvbnMubG9hZChwYXRoLCBhbmNob3IsIG51bGwpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChwcm92aWRlciAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhjb25mKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdSZXNv\ndXJjZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcHJvdmlkZXIiLAogICAgICAg\nICAgICAgICAgICAgIHByb3BzKS5nZXRNZXNzYWdlKCksIENvbmZpZ3VyYXRp\nb25zLmNsYXNzLmdldE5hbWUoKSwgCiAgICAgICAgICAgICAgICAgICAgcHJv\ncHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByb3ZpZGVyID0g\nUHJvZHVjdERlcml2YXRpb25zLmxvYWREZWZhdWx0cyhudWxsKTsKICAgICAg\nICAgICAgaWYgKHByb3ZpZGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBw\ncm92aWRlci5zZXRJbnRvKGNvbmYpOwogICAgICAgIH0KICAgICAgICBvcHRz\nLnNldEludG8oY29uZik7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIHRocm93IGFuIGluZm9ybWF0aXZlIGRlc2NyaXB0aW9uIG9u\nIGluc3RhbnRpYXRpb24gZXJyb3IuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIFJ1bnRpbWVFeGNlcHRpb24gZ2V0Q3JlYXRlRXhjZXB0aW9uKFN0cmlu\nZyBjbHNOYW1lLAogICAgICAgIFZhbHVlIHZhbCwgRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAvLyByZS10aHJvdyB0aGUgZXhjZXB0aW9uIHdpdGggc29tZSBi\nZXR0ZXIgaW5mb3JtYXRpb24KICAgICAgICBmaW5hbCBTdHJpbmcgbXNnOwog\nICAgICAgIGZpbmFsIE9iamVjdFtdIHBhcmFtczsKCiAgICAgICAgU3RyaW5n\nIGFsaWFzID0gdmFsLmFsaWFzKGNsc05hbWUpOwogICAgICAgIFN0cmluZ1td\nIGFsaWFzZXMgPSB2YWwuZ2V0QWxpYXNlcygpOwogICAgICAgIFN0cmluZ1td\nIGtleXM7CiAgICAgICAgaWYgKGFsaWFzZXMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgIGtleXMgPSBhbGlhc2VzOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICBrZXlzID0gbmV3IFN0cmluZ1thbGlhc2VzLmxlbmd0aCAvIDJdOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMubGVuZ3Ro\nOyBpICs9IDIpCiAgICAgICAgICAgICAgICBrZXlzW2kgLyAyXSA9IGFsaWFz\nZXNbaV07CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgY2xvc2VzdDsKICAg\nICAgICBpZiAoa2V5cy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBtc2cg\nPSAiaW52YWxpZC1wbHVnaW4iOwogICAgICAgICAgICBwYXJhbXMgPSBuZXcg\nT2JqZWN0W117IHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmlu\nZygpLCB9OwogICAgICAgIH0gZWxzZSBpZiAoKGNsb3Nlc3QgPSBTdHJpbmdE\naXN0YW5jZS5nZXRDbG9zZXN0TGV2ZW5zaHRlaW5EaXN0YW5jZQogICAgICAg\nICAgICAoYWxpYXMsIGtleXMsIDAuNWYpKSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIG1zZyA9ICJpbnZhbGlkLXBsdWdpbi1hbGlhc2VzIjsKICAgICAgICAg\nICAgcGFyYW1zID0gbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgdmFs\nLmdldFByb3BlcnR5KCksIGFsaWFzLCBlLnRvU3RyaW5nKCksCiAgICAgICAg\nICAgICAgICBuZXcgVHJlZVNldChBcnJheXMuYXNMaXN0KGtleXMpKSwgfTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtc2cgPSAiaW52YWxpZC1w\nbHVnaW4tYWxpYXNlcy1oaW50IjsKICAgICAgICAgICAgcGFyYW1zID0gbmV3\nIE9iamVjdFtdewogICAgICAgICAgICAgICAgdmFsLmdldFByb3BlcnR5KCks\nIGFsaWFzLCBlLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICBuZXcgVHJl\nZVNldChBcnJheXMuYXNMaXN0KGtleXMpKSwgY2xvc2VzdCwgfTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZUV4Y2VwdGlvbihfbG9jLmdl\ndChtc2csIHBhcmFtcyksIGUpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3Bl\ncnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmlu\nZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBtZXRob2RzLiBUaGUg\ncHJvcGVydGllcyBzdHJpbmcgc2hvdWxkIGJlIGluIHRoZSBmb3JtCiAgICAg\nKiAicHJvcDE9dmFsMSwgcHJvcDI9dmFsMiAuLi4iLiBEb2VzIG5vdCB2YWxp\nZGF0ZSB0aGF0IHNldHRlcgogICAgICogbWV0aG9kcyBleGlzdCBmb3IgdGhl\nIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogQHRocm93cyBSdW50aW1lRXhj\nZXB0aW9uIG9uIGNvbmZpZ3VyYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIGNvbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmos\nIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBTdHJpbmcgcHJvcGVydGll\ncykgewogICAgICAgIGNvbmZpZ3VyZUluc3RhbmNlKG9iaiwgY29uZiwgcHJv\ncGVydGllcywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1\ncmVzIHRoZSBnaXZlbiBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gcHJvcGVydGll\ncyBieQogICAgICogbWF0Y2hpbmcgdGhlIHByb3BlcnRpZXMgc3RyaW5nIHRv\nIHRoZSBvYmplY3QncyBzZXR0ZXIKICAgICAqIG1ldGhvZHMuIFRoZSBwcm9w\nZXJ0aWVzIHN0cmluZyBzaG91bGQgYmUgaW4gdGhlIGZvcm0KICAgICAqICJw\ncm9wMT12YWwxLCBwcm9wMj12YWwyIC4uLiIuIFZhbGlkYXRlcyB0aGF0IHNl\ndHRlciBtZXRob2RzCiAgICAgKiBleGlzdCBmb3IgdGhlIHByb3BlcnRpZXMu\nCiAgICAgKgogICAgICogQHRocm93cyBSdW50aW1lRXhjZXB0aW9uIG9uIGNv\nbmZpZ3VyYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2\nb2lkIGNvbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmosIENvbmZpZ3VyYXRp\nb24gY29uZiwKICAgICAgICBTdHJpbmcgcHJvcGVydGllcywgU3RyaW5nIGNv\nbmZpZ3VyYXRpb25OYW1lKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIFByb3BlcnRpZXMgcHJvcHMg\nPSBudWxsOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShwcm9w\nZXJ0aWVzKSkKICAgICAgICAgICAgcHJvcHMgPSBwYXJzZVByb3BlcnRpZXMo\ncHJvcGVydGllcyk7CiAgICAgICAgY29uZmlndXJlSW5zdGFuY2Uob2JqLCBj\nb25mLCBwcm9wcywgY29uZmlndXJhdGlvbk5hbWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhl\nIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9w\nZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBt\nZXRob2RzLiBEb2VzIG5vdCB2YWxpZGF0ZSB0aGF0IHNldHRlciBtZXRob2Rz\nIGV4aXN0IGZvciB0aGUgcHJvcGVydGllcy4KICAgICAqCiAgICAgKiBAdGhy\nb3dzIFJ1bnRpbWVFeGNlcHRpb24gb24gY29uZmlndXJhdGlvbiBlcnJvcgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmlndXJlSW5zdGFu\nY2UoT2JqZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIFBy\nb3BlcnRpZXMgcHJvcGVydGllcykgewogICAgICAgIGNvbmZpZ3VyZUluc3Rh\nbmNlKG9iaiwgY29uZiwgcHJvcGVydGllcywgbnVsbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25maWd1cmVzIHRoZSBnaXZlbiBvYmplY3Qgd2l0aCB0\naGUgZ2l2ZW4gcHJvcGVydGllcyBieQogICAgICogbWF0Y2hpbmcgdGhlIHBy\nb3BlcnRpZXMgc3RyaW5nIHRvIHRoZSBvYmplY3QncyBzZXR0ZXIKICAgICAq\nIG1ldGhvZHMuIElmIDxjb2RlPmNvbmZpZ3VyYXRpb25OYW1lPC9jb2RlPiBp\ncwogICAgICogbm9uLTxjb2RlPm51bGw8L2NvZGU+LCB2YWxpZGF0ZXMgdGhh\ndCBzZXR0ZXIgbWV0aG9kcyBleGlzdCBmb3IKICAgICAqIHRoZSBwcm9wZXJ0\naWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBv\nbiBjb25maWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgdm9pZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1\ncmF0aW9uIGNvbmYsCiAgICAgICAgUHJvcGVydGllcyBwcm9wZXJ0aWVzLCBT\ndHJpbmcgY29uZmlndXJhdGlvbk5hbWUpIHsKICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT3B0aW9ucyBv\ncHRzOwogICAgICAgIGlmIChwcm9wZXJ0aWVzIGluc3RhbmNlb2YgT3B0aW9u\ncykKICAgICAgICAgICAgb3B0cyA9IChPcHRpb25zKSBwcm9wZXJ0aWVzOwog\nICAgICAgIGVsc2UgeyAKICAgICAgICAgICAgb3B0cyA9IG5ldyBPcHRpb25z\nKCk7CiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBvcHRzLnB1dEFsbChwcm9wZXJ0aWVzKTsKICAgICAgICB9\nCgogICAgICAgIENvbmZpZ3VyYWJsZSBjb25maWd1cmFibGUgPSBudWxsOwog\nICAgICAgIGlmIChjb25mICE9IG51bGwgJiYgb2JqIGluc3RhbmNlb2YgQ29u\nZmlndXJhYmxlKQogICAgICAgICAgICBjb25maWd1cmFibGUgPSAoQ29uZmln\ndXJhYmxlKSBvYmo7CgogICAgICAgIGlmIChjb25maWd1cmFibGUgIT0gbnVs\nbCkgewogICAgICAgICAgICBjb25maWd1cmFibGUuc2V0Q29uZmlndXJhdGlv\nbihjb25mKTsKICAgICAgICAgICAgY29uZmlndXJhYmxlLnN0YXJ0Q29uZmln\ndXJhdGlvbigpOwogICAgICAgIH0KICAgICAgICBPcHRpb25zIGludmFsaWRF\nbnRyaWVzID0gb3B0cy5zZXRJbnRvKG9iaik7CiAgICAgICAgaWYgKG9iaiBp\nbnN0YW5jZW9mIEdlbmVyaWNDb25maWd1cmFibGUpCiAgICAgICAgICAgICgo\nR2VuZXJpY0NvbmZpZ3VyYWJsZSkgb2JqKS5zZXRJbnRvKGludmFsaWRFbnRy\naWVzKTsKCgkJaWYgKCFpbnZhbGlkRW50cmllcy5pc0VtcHR5KCkgJiYgY29u\nZmlndXJhdGlvbk5hbWUgIT0gbnVsbCkgewoJCQlMb2NhbGl6ZXIuTWVzc2Fn\nZSBtc2cgPSBudWxsOwoJCQlTdHJpbmcgZmlyc3QgPSAoU3RyaW5nKSBpbnZh\nbGlkRW50cmllcy5rZXlTZXQoKS5pdGVyYXRvcigpLm5leHQoKTsKCQkJaWYg\nKGludmFsaWRFbnRyaWVzLmtleVNldCgpLnNpemUoKSA9PSAxICYmCgkJCQlm\naXJzdC5pbmRleE9mKCcuJykgPT0gLTEpIHsKCQkJCS8vIGlmIHRoZXJlJ3Mg\nanVzdCBvbmUgbWlzc3BlbGxpbmcgYW5kIHRoaXMgaXMgbm90IGEKCQkJCS8v\nIHBhdGggdHJhdmVyc2FsLCBjaGVjayBmb3IgbmVhciBtaXNzZXMuCgkJCQlD\nb2xsZWN0aW9uIG9wdGlvbnMgPSBmaW5kT3B0aW9uc0ZvcihvYmouZ2V0Q2xh\nc3MoKSk7CgkJCQlTdHJpbmcgY2xvc2UgPSBTdHJpbmdEaXN0YW5jZS5nZXRD\nbG9zZXN0TGV2ZW5zaHRlaW5EaXN0YW5jZQoJCQkJCShmaXJzdCwgb3B0aW9u\ncywgMC43NWYpOwoJCQkJaWYgKGNsb3NlICE9IG51bGwpCgkJCQkJbXNnID0g\nX2xvYy5nZXQoImludmFsaWQtY29uZmlnLXBhcmFtLWhpbnQiLCBuZXcgT2Jq\nZWN0W117CgkJCQkJCWNvbmZpZ3VyYXRpb25OYW1lLCBvYmouZ2V0Q2xhc3Mo\nKSwgZmlyc3QsIGNsb3NlLAoJCQkJCQlvcHRpb25zLCB9KTsKCQkJfQoKICAg\nICAgICAgICAgaWYgKG1zZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBt\nc2cgPSBfbG9jLmdldCgiaW52YWxpZC1jb25maWctcGFyYW1zIiwgbmV3IFN0\ncmluZ1tdewogICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25OYW1l\nLCBvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgaW52YWxpZEVudHJpZXMua2V5U2V0KCkudG9TdHJpbmcoKSwKICAgICAg\nICAgICAgICAgICAgICBmaW5kT3B0aW9uc0ZvcihvYmouZ2V0Q2xhc3MoKSku\ndG9TdHJpbmcoKSwgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhy\nb3cgbmV3IFBhcnNlRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgfQogICAgICAg\nIGlmIChjb25maWd1cmFibGUgIT0gbnVsbCkKICAgICAgICAgICAgY29uZmln\ndXJhYmxlLmVuZENvbmZpZ3VyYXRpb24oKTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBDb2xsZWN0aW9uIGZpbmRPcHRpb25zRm9yKENsYXNzIGNscykg\newogICAgICAgIENvbGxlY3Rpb24gYyA9IE9wdGlvbnMuZmluZE9wdGlvbnNG\nb3IoY2xzKTsKICAgICAgICAKICAgICAgICAvLyByZW1vdmUgQ29uZmlndXJh\nYmxlLnNldENvbmZpZ3VyYXRpb24oKSBhbmQgCiAgICAgICAgLy8gR2VuZXJp\nY0NvbmZpZ3VyYWJsZS5zZXRJbnRvKCkgZnJvbSB0aGUgc2V0LCBpZiBhcHBs\naWNhYmxlLgogICAgICAgIGlmIChDb25maWd1cmFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICBjLnJlbW92ZSgiQ29uZmln\ndXJhdGlvbiIpOwogICAgICAgIGlmIChHZW5lcmljQ29uZmlndXJhYmxlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAgYy5yZW1v\ndmUoIkludG8iKTsKICAgICAgICAKICAgICAgICByZXR1cm4gYzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFR1cm4gYSBzZXQgb2YgcHJvcGVydGllcyBpbnRv\nIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZy4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBTdHJpbmcgc2VyaWFsaXplUHJvcGVydGllcyhNYXAgbWFwKSB7\nCiAgICAgICAgaWYgKG1hcCA9PSBudWxsIHx8IG1hcC5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmdCdWZmZXIg\nYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIE1hcC5FbnRyeSBl\nbnRyeTsKICAgICAgICBTdHJpbmcgdmFsOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gbWFwLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICBpZiAoYnVmLmxlbmd0aCgpID4gMCkKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoZW50cnkuZ2V0S2V5KCkpLmFwcGVuZCgnPScpOwogICAgICAg\nICAgICB2YWwgPSBTdHJpbmcudmFsdWVPZihlbnRyeS5nZXRWYWx1ZSgpKTsK\nICAgICAgICAgICAgaWYgKHZhbC5pbmRleE9mKCcsJykgIT0gLTEpCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCciJykuYXBwZW5kKHZhbCkuYXBwZW5k\nKCciJyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQodmFsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgYSBzZXQgb2Yg\ncHJvcGVydGllcyBmcm9tIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZy4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBPcHRpb25zIHBhcnNlUHJvcGVydGll\ncyhTdHJpbmcgcHJvcGVydGllcykgewogICAgICAgIE9wdGlvbnMgb3B0cyA9\nIG5ldyBPcHRpb25zKCk7CiAgICAgICAgcHJvcGVydGllcyA9IFN0cmluZ1V0\naWxzLnRyaW1Ub051bGwocHJvcGVydGllcyk7CiAgICAgICAgaWYgKHByb3Bl\ncnRpZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG9wdHM7CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZ1tdIHByb3BzID0gU3RyaW5n\ncy5zcGxpdChwcm9wZXJ0aWVzLCAiLCIsIDApOwogICAgICAgICAgICBpbnQg\naWR4OwogICAgICAgICAgICBjaGFyIHF1b3RlOwogICAgICAgICAgICBTdHJp\nbmcgcHJvcDsKICAgICAgICAgICAgU3RyaW5nIHZhbDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWR4ID0gcHJvcHNbaV0uaW5kZXhPZignPScpOwogICAg\nICAgICAgICAgICAgaWYgKGlkeCA9PSAtMSkgewogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZSBrZXkgaXMgbm90IGFzc2lnbmVkIHRvIGFueSB2YWx1\nZSwgc2V0IHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIHRvIHRo\nZSBzYW1lIHRoaW5nIGFzIHRoZSBrZXksIGFuZCBjb250aW51ZS4KICAgICAg\nICAgICAgICAgICAgICAvLyBUaGlzIHBlcm1pdHMgR2VuZXJpY0NvbmZpZ3Vy\nYWJsZSBpbnN0YW5jZXMgdG8KICAgICAgICAgICAgICAgICAgICAvLyBiZWhh\ndmUgbWVhbmluZ2Z1bGx5LiBXZSBtaWdodCBjb25zaWRlciBzZXR0aW5nIHRo\nZQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIHRvIHNvbWUgd2VsbC1r\nbm93biAidmFsdWUgd2FzIG5vdCBzZXQsIGJ1dAogICAgICAgICAgICAgICAg\nICAgIC8vIGtleSBpcyBwcmVzZW50IiBzdHJpbmcgc28gdGhhdCBpbnN0YW5j\nZXMgZ2V0dGluZwogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlcyBpbmpl\nY3RlZCBjYW4gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGEgbWVudGlvbmVkCiAg\nICAgICAgICAgICAgICAgICAgLy8gcHJvcGVydHkgYW5kIG9uZSBzZXQgdG8g\nYSBwYXJ0aWN1bGFyIHZhbHVlLgogICAgICAgICAgICAgICAgICAgIHByb3Ag\nPSBwcm9wc1tpXTsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBwcm9wOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBw\ncm9wID0gcHJvcHNbaV0uc3Vic3RyaW5nKDAsIGlkeCkudHJpbSgpOwogICAg\nICAgICAgICAgICAgICAgIHZhbCA9IHByb3BzW2ldLnN1YnN0cmluZyhpZHgg\nKyAxKS50cmltKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgLy8gaWYgdGhlIHZhbHVlIGlzIHF1b3RlZCwgcmVhZCB1bnRpbCB0aGUg\nZW5kIHF1b3RlCiAgICAgICAgICAgICAgICBpZiAoKCh2YWwuc3RhcnRzV2l0\naCgiXCIiKSAmJiB2YWwuZW5kc1dpdGgoIlwiIikpCiAgICAgICAgICAgICAg\nICAgICAgfHwgKHZhbC5zdGFydHNXaXRoKCInIikgJiYgdmFsLmVuZHNXaXRo\nKCInIikpKQogICAgICAgICAgICAgICAgICAgICYmIHZhbC5sZW5ndGgoKSA+\nIDEpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsLnN1YnN0cmluZygx\nLCB2YWwubGVuZ3RoKCkgLSAxKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKHZhbC5zdGFydHNXaXRoKCJcIiIpIHx8IHZhbC5zdGFydHNXaXRoKCInIikp\nIHsKICAgICAgICAgICAgICAgICAgICBxdW90ZSA9IHZhbC5jaGFyQXQoMCk7\nCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIodmFsLnN1YnN0cmluZygxKSk7CiAgICAgICAgICAgICAg\nICAgICAgaW50IHF1b3RJZHg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUg\nKCsraSA8IHByb3BzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIsIik7CgogICAgICAgICAgICAgICAgICAgICAgICBx\ndW90SWR4ID0gcHJvcHNbaV0uaW5kZXhPZihxdW90ZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChxdW90SWR4ICE9IC0xKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKHByb3BzW2ldLnN1YnN0cmlu\nZygwLCBxdW90SWR4KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAocXVvdElkeCArIDEgPCBwcm9wc1tpXS5sZW5ndGgoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKHByb3BzW2ldLnN1\nYnN0cmluZyhxdW90SWR4ICsgMSkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChwcm9wc1tp\nXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIHZhbCA9IGJ1Zi50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgb3B0cy5wdXQocHJvcCwgdmFsKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gb3B0czsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQ\nYXJzZUV4Y2VwdGlvbihfbG9jLmdldCgicHJvcC1wYXJzZSIsIHByb3BlcnRp\nZXMpLCByZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9v\na3MgdXAgdGhlIGdpdmVuIG5hbWUgaW4gSk5ESS4gSWYgdGhlIG5hbWUgaXMg\nbnVsbCwgbnVsbCBpcyByZXR1cm5lZC4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgbG9va3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBDb250ZXh0IGN0eCA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgY3R4ID0gbmV3IEluaXRpYWxDb250ZXh0KCk7\nCiAgICAgICAgICAgIHJldHVybiBjdHgubG9va3VwKG5hbWUpOwogICAgICAg\nIH0gY2F0Y2ggKE5hbWluZ0V4Y2VwdGlvbiBuZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKAogICAgICAgICAg\nICAgICAgX2xvYy5nZXQoIm5hbWluZy1lcnIiLCBuYW1lKS5nZXRNZXNzYWdl\nKCksIG5lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nY3R4ICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBjdHguY2xvc2Uo\nKTsgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCB3aGV0aGVyIHRoZSBtYXAgY29udGFpbnMg\ndGhlIGdpdmVuIHBhcnRpYWwga2V5LCBwcmVmaXhlZCB3aXRoIGFueQogICAg\nICogcG9zc2libGUgY29uZmlndXJhdGlvbiBwcmVmaXguCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBjb250YWluc1Byb3BlcnR5KFN0cmlu\nZyBwYXJ0aWFsS2V5LCBNYXAgcHJvcHMpIHsKICAgICAgICBpZiAocGFydGlh\nbEtleSA9PSBudWxsIHx8IHByb3BzID09IG51bGwgfHwgcHJvcHMuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICByZXR1cm4gcHJvcHMuY29udGFpbnNLZXkoCiAgICAgICAg\nICAgICAgICBQcm9kdWN0RGVyaXZhdGlvbnMuZ2V0Q29uZmlndXJhdGlvbktl\neShwYXJ0aWFsS2V5LCBwcm9wcykpOwogICAgfQoKICAgIC8qKgogICAgICog\nR2V0IHRoZSBwcm9wZXJ0eSB1bmRlciB0aGUgZ2l2ZW4gcGFydGlhbCBrZXks\nIHByZWZpeGVkIHdpdGggYW55IHBvc3NpYmxlCiAgICAgKiBjb25maWd1cmF0\naW9uIHByZWZpeC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3Qg\nZ2V0UHJvcGVydHkoU3RyaW5nIHBhcnRpYWxLZXksIE1hcCBtKSB7CiAgICAg\nICAgaWYgKHBhcnRpYWxLZXkgPT0gbnVsbCB8fCBtID09IG51bGwgfHwgbS5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGVs\nc2UgCiAgICAgICAgICAgIHJldHVybiBtLmdldChQcm9kdWN0RGVyaXZhdGlv\nbnMuZ2V0Q29uZmlndXJhdGlvbktleShwYXJ0aWFsS2V5LCBtKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHByb3BlcnR5IHVuZGVyIHRo\nZSBnaXZlbiBwYXJ0aWFsIGtleSwgcHJlZml4ZWQgd2l0aCBhbnkKICAgICAq\nIHBvc3NpYmxlIGNvbmZpZ3VyYXRpb24gcHJlZml4LgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIE9iamVjdCByZW1vdmVQcm9wZXJ0eShTdHJpbmcgcGFy\ndGlhbEtleSwgTWFwIHByb3BzKSB7CiAgICAgICAgaWYgKHBhcnRpYWxLZXkg\nPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxsIHx8IHByb3BzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIHByb3Bz\nLnJlbW92ZShQcm9kdWN0RGVyaXZhdGlvbnMuZ2V0Q29uZmlndXJhdGlvbktl\neShwYXJ0aWFsS2V5LAogICAgICAgICAgICBwcm9wcykpOwogICAgfQp9Cg==\n","encoding":"base64"}

