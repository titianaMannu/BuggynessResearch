{"sha":"0f4693b7da474ddff4439c1213684c4f5d23afac","node_id":"MDQ6QmxvYjIwNjM2NDowZjQ2OTNiN2RhNDc0ZGRmZjQ0MzljMTIxMzY4NGM0ZjVkMjNhZmFj","size":13004,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0f4693b7da474ddff4439c1213684c4f5d23afac","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nZ3JhcGg7DQoNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOw0KDQppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0TGlzdDsN\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Ow0KaW1wb3J0IGphdmEudXRp\nbC5BcnJheXM7DQppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247DQppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOw0KaW1wb3J0IGphdmEudXRpbC5D\nb21wYXJhdG9yOw0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOw0KaW1wb3J0\nIGphdmEudXRpbC5JdGVyYXRvcjsNCmltcG9ydCBqYXZhLnV0aWwuTGlua2Vk\nTGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsNCmltcG9ydCBqYXZhLnV0\naWwuTWFwOw0KDQovKioNCiAqIDxwPlBlcmZvcm1zIGEgZGVwdGgtZmlyc3Qg\nYW5hbHlzaXMgb2YgYSBnaXZlbiB7QGxpbmsgR3JhcGh9LCBjYWNoaW5nDQog\nKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgZ3JhcGgncyBub2RlcyBhbmQgZWRn\nZXMuICBTZWUgdGhlIERGUyBhbGdvcml0aG0NCiAqIGluIHRoZSBib29rICdJ\nbnRyb2R1Y3Rpb24gdG8gQWxnb3JpdGhtcycgYnkgQ29ybWVuLCBMZWlzZXJz\nb24sIGFuZA0KICogUml2ZXN0LiAgVGhlIGFsZ29yaXRobSBoYXMgYmVlbiBt\nb2RpZmllZCB0byBncm91cCBzaWJsaW5nIG5vZGVzIHdpdGhvdXQNCiAqIGNv\nbm5lY3Rpb25zIHRvZ2V0aGVyIGR1cmluZyB0aGUgdG9wb2xvZ2ljYWwgc29y\ndC48L3A+DQogKg0KICogQGF1dGhvciBBYmUgV2hpdGUNCiAqIEBzaW5jZSAx\nLjAuMA0KICogQG5vamF2YWRvYw0KICovDQpwdWJsaWMgY2xhc3MgRGVwdGhG\naXJzdEFuYWx5c2lzIHsNCg0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UNCiAgICAgICAg\nKERlcHRoRmlyc3RBbmFseXNpcy5jbGFzcyk7DQoNCiAgICBwcml2YXRlIGZp\nbmFsIEdyYXBoIF9ncmFwaDsNCiAgICBwcml2YXRlIGZpbmFsIE1hcCBfbm9k\nZUluZm8gPSBuZXcgSGFzaE1hcCgpOw0KICAgIHByaXZhdGUgQ29tcGFyYXRv\nciBfY29tcDsNCg0KICAgIC8qKg0KICAgICAqIENvbnN0cnVjdG9yLiAgUGVy\nZm9ybXMgdGhlIGFuYWx5c2lzIG9uIHRoZSBnaXZlbiBncmFwaCBhbmQgY2Fj\naGVzDQogICAgICogdGhlIHJlc3VsdGluZyBpbmZvcm1hdGlvbi4NCiAgICAg\nKi8NCiAgICBwdWJsaWMgRGVwdGhGaXJzdEFuYWx5c2lzKEdyYXBoIGdyYXBo\nKSB7DQogICAgICAgIF9ncmFwaCA9IGdyYXBoOw0KDQogICAgICAgIC8vIGlu\naXRpYWxpemUgbm9kZSBpbmZvcw0KICAgICAgICBDb2xsZWN0aW9uIG5vZGVz\nID0gZ3JhcGguZ2V0Tm9kZXMoKTsNCiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBub2Rlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykNCiAgICAg\nICAgICAgIF9ub2RlSW5mby5wdXQoaXRyLm5leHQoKSwgbmV3IE5vZGVJbmZv\nKCkpOw0KDQogICAgICAgIC8vIHZpc2l0IGFsbCBub2RlcyAtLSBzZWUgaW50\ncm8gdG8gYWxnbydzIGJvb2sNCiAgICAgICAgTm9kZUluZm8gaW5mbzsNCiAg\nICAgICAgT2JqZWN0IG5vZGU7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gbm9kZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAg\nICAgICAgIG5vZGUgPSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgaW5mbyA9\nIChOb2RlSW5mbykgX25vZGVJbmZvLmdldChub2RlKTsNCiAgICAgICAgICAg\nIGlmIChpbmZvLmNvbG9yID09IE5vZGVJbmZvLkNPTE9SX1dISVRFKQ0KICAg\nICAgICAgICAgICAgIHZpc2l0KGdyYXBoLCBub2RlLCBpbmZvLCAwLCBuZXcg\nTGlua2VkTGlzdCgpKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIFZpc2l0IGEgbm9kZS4gIFNlZSBJbnRyb2R1Y3Rpb24gdG8gQWxn\nb3JpdGhtcyBib29rIGZvciBkZXRhaWxzLg0KICAgICAqLw0KICAgIHByaXZh\ndGUgaW50IHZpc2l0KEdyYXBoIGdyYXBoLCBPYmplY3Qgbm9kZSwgTm9kZUlu\nZm8gaW5mbywgaW50IHRpbWUsIA0KICAgICAgICBMaXN0IHBhdGgpIHsNCiAg\nICAgICAgLy8gZGlzY292ZXIgbm9kZQ0KICAgICAgICBpbmZvLmNvbG9yID0g\nTm9kZUluZm8uQ09MT1JfR1JBWTsNCg0KICAgICAgICAvLyBleHBsb3JlIGFs\nbCB2ZXJ0aWNlcyBmcm9tIHRoYXQgbm9kZSBkZXB0aCBmaXJzdA0KICAgICAg\nICBDb2xsZWN0aW9uIGVkZ2VzID0gZ3JhcGguZ2V0RWRnZXNGcm9tKG5vZGUp\nOw0KICAgICAgICBFZGdlIGVkZ2U7DQogICAgICAgIE9iamVjdCBvdGhlcjsN\nCiAgICAgICAgTm9kZUluZm8gb3RoZXJJbmZvOw0KICAgICAgICBpbnQgbWF4\nQ2hpbGRUaW1lID0gdGltZSAtIDE7DQogICAgICAgIGludCBjaGlsZFRpbWU7\nDQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZWRnZXMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgIGVkZ2UgPSAoRWRn\nZSkgaXRyLm5leHQoKTsNCiAgICAgICAgICAgIG90aGVyID0gZWRnZS5nZXRP\ndGhlcihub2RlKTsNCiAgICAgICAgICAgIG90aGVySW5mbyA9IChOb2RlSW5m\nbykgX25vZGVJbmZvLmdldChvdGhlcik7DQogICAgICAgICAgICBpZiAob3Ro\nZXJJbmZvLmNvbG9yID09IE5vZGVJbmZvLkNPTE9SX1dISVRFKSB7DQogICAg\nICAgICAgICAgICAgLy8gdW5kaXNjb3ZlcmVkIG5vZGU7IHJlY3Vyc2UgaW50\nbyBpdA0KICAgICAgICAgICAgICAgIHBhdGguYWRkKGVkZ2UpOw0KICAgICAg\nICAgICAgICAgIGNoaWxkVGltZSA9IHZpc2l0KGdyYXBoLCBvdGhlciwgb3Ro\nZXJJbmZvLCB0aW1lLCBwYXRoKTsNCiAgICAgICAgICAgICAgICBwYXRoLnJl\nbW92ZShlZGdlKTsNCiAgICAgICAgICAgICAgICBlZGdlLnNldFR5cGUoRWRn\nZS5UWVBFX1RSRUUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChvdGhlcklu\nZm8uY29sb3IgPT0gTm9kZUluZm8uQ09MT1JfR1JBWSkgew0KICAgICAgICAg\nICAgICAgIGNoaWxkVGltZSA9IC0xOw0KICAgICAgICAgICAgICAgIGVkZ2Uu\nc2V0VHlwZShFZGdlLlRZUEVfQkFDSyk7DQogICAgICAgICAgICAgICAgLy8g\nY2FsY3VsYXRlIHRoZSBjeWNsZSBpbmNsdWRpbmcgdGhpcyBlZGdlDQogICAg\nICAgICAgICAgICAgZWRnZS5zZXRDeWNsZShjeWNsZUZvckJhY2tFZGdlKGVk\nZ2UsIHBhdGgpKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAg\nICAgICAgY2hpbGRUaW1lID0gb3RoZXJJbmZvLmZpbmlzaGVkOw0KICAgICAg\nICAgICAgICAgIGVkZ2Uuc2V0VHlwZShFZGdlLlRZUEVfRk9SV0FSRCk7DQog\nICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgY3ljbGUgaW5jbHVkaW5nIHRo\naXMgZWRnZQ0KICAgICAgICAgICAgICAgIExpc3QgY3ljbGUgPSBuZXcgTGlu\na2VkTGlzdCgpOw0KICAgICAgICAgICAgICAgIGN5Y2xlLmFkZChlZGdlKTsN\nCiAgICAgICAgICAgICAgICBpZiAoY3ljbGVGb3JGb3J3YXJkRWRnZShncmFw\naCwgb3RoZXIsIG5vZGUsIGN5Y2xlKSkgew0KICAgICAgICAgICAgICAgICAg\nICBlZGdlLnNldEN5Y2xlKGN5Y2xlKTsNCiAgICAgICAgICAgICAgICB9DQog\nICAgICAgICAgICB9DQogICAgICAgICAgICBtYXhDaGlsZFRpbWUgPSBNYXRo\nLm1heChtYXhDaGlsZFRpbWUsIGNoaWxkVGltZSk7DQogICAgICAgIH0NCg0K\nICAgICAgICAvLyBmaW5pc2hlZCB3aXRoIG5vZGUNCiAgICAgICAgaW5mby5j\nb2xvciA9IE5vZGVJbmZvLkNPTE9SX0JMQUNLOw0KICAgICAgICBpbmZvLmZp\nbmlzaGVkID0gbWF4Q2hpbGRUaW1lICsgMTsNCiAgICAgICAgcmV0dXJuIGlu\nZm8uZmluaXNoZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IHRo\nZSBjb21wYXJhdG9yIHRoYXQgc2hvdWxkIGJlIHVzZWQgZm9yIG9yZGVyaW5n\nIGdyb3VwcyBvZiBub2Rlcw0KICAgICAqIHdpdGggdGhlIHNhbWUgZGVwZW5k\nZW5jaWVzLg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHNldE5vZGVDb21w\nYXJhdG9yKENvbXBhcmF0b3IgY29tcCkgew0KICAgICAgICBfY29tcCA9IGNv\nbXA7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIHRoZSBub2Rl\ncyBpbiB0b3BvbG9naWNhbGx5LXNvcnRlZCBvcmRlci4gIFRoaXMgaXMgb2Z0\nZW4gdXNlZA0KICAgICAqIHRvIG9yZGVyIGRlcGVuZGVuY2llcy4gIElmIGVh\nY2ggZ3JhcGggZWRnZSAodSwgdikgcmVwcmVzZW50cyBhDQogICAgICogZGVw\nZW5kZW5jeSBvZiB2IG9uIHUsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCByZXR1\ncm4gdGhlIG5vZGVzIGluIHRoZQ0KICAgICAqIG9yZGVyIHRoYXQgdGhleSBz\naG91bGQgYmUgZXZhbHVhdGVkIHRvIHNhdGlzZnkgYWxsIGRlcGVuZGVuY2ll\ncy4gIE9mDQogICAgICogY291cnNlLCBpZiB0aGUgZ3JhcGggaXMgY3ljbGlj\nIChoYXMgYmFjayBlZGdlcyksIHRoZW4gbm8gc3VjaCBvcmRlcmluZw0KICAg\nICAqIGlzIHBvc3NpYmxlLCB0aG91Z2ggdGhpcyBtZXRob2Qgd2lsbCBzdGls\nbCByZXR1cm4gdGhlIGNvcnJlY3Qgb3JkZXINCiAgICAgKiBhcyBpZiBlZGdl\ncyBjcmVhdGluZyB0aGUgY3ljbGVzIGRpZCBub3QgZXhpc3QuDQogICAgICov\nDQogICAgcHVibGljIExpc3QgZ2V0U29ydGVkTm9kZXMoKSB7DQogICAgICAg\nIE1hcC5FbnRyeVtdIGVudHJpZXMgPSAoTWFwLkVudHJ5W10pIF9ub2RlSW5m\nby5lbnRyeVNldCgpLg0KICAgICAgICAgICAgdG9BcnJheShuZXcgTWFwLkVu\ndHJ5W19ub2RlSW5mby5zaXplKCldKTsNCiAgICAgICAgQXJyYXlzLnNvcnQo\nZW50cmllcywgbmV3IE5vZGVJbmZvQ29tcGFyYXRvcihfY29tcCkpOw0KICAg\nICAgICByZXR1cm4gbmV3IE5vZGVMaXN0KGVudHJpZXMpOw0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIFJldHVybiBhbGwgZWRnZXMgb2YgdGhlIGdpdmVu\nIHR5cGUuICBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0bw0KICAgICAqIGRp\nc2NvdmVyIGFsbCBlZGdlcyB0aGF0IGNhdXNlIGN5Y2xlcyBpbiB0aGUgZ3Jh\ncGggYnkgcGFzc2luZyBpdA0KICAgICAqIHRoZSB7QGxpbmsgRWRnZSNUWVBF\nX0JBQ0t9IG9yIHtAbGluayBFZGdlI1RZUEVfRk9SV0FSRH0gZWRnZSB0eXBl\nLg0KICAgICAqLw0KICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldEVkZ2VzKGlu\ndCB0eXBlKSB7DQogICAgICAgIENvbGxlY3Rpb24gdHlwZWQgPSBudWxsOw0K\nICAgICAgICBFZGdlIGVkZ2U7DQogICAgICAgIE9iamVjdCBub2RlOw0KICAg\nICAgICBmb3IgKEl0ZXJhdG9yIG5vZGVzID0gX2dyYXBoLmdldE5vZGVzKCku\naXRlcmF0b3IoKTsgbm9kZXMuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAg\nbm9kZSA9IG5vZGVzLm5leHQoKTsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX2dyYXBoLmdldEVkZ2VzRnJvbShub2RlKS5pdGVyYXRvcigp\nOw0KICAgICAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAg\nICAgICAgICAgZWRnZSA9IChFZGdlKSBpdHIubmV4dCgpOw0KICAgICAgICAg\nICAgICAgIGlmIChlZGdlLmdldFR5cGUoKSA9PSB0eXBlKSB7DQogICAgICAg\nICAgICAgICAgICAgIGlmICh0eXBlZCA9PSBudWxsKQ0KICAgICAgICAgICAg\nICAgICAgICAgICAgdHlwZWQgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAg\nICAgICAgICAgICAgIHR5cGVkLmFkZChlZGdlKTsNCiAgICAgICAgICAgICAg\nICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJu\nICh0eXBlZCA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QgOiB0\neXBlZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gdGhlIGxv\nZ2ljYWwgdGltZSB0aGF0IHRoZSBnaXZlbiBub2RlIHdhcyBmaW5pc2hlZCBp\nbg0KICAgICAqIHRoZSBncmFwaCB3YWxrLCBvciAtMSBpZiB0aGUgbm9kZSBp\ncyBub3QgcGFydCBvZiB0aGUgZ3JhcGguDQogICAgICovDQogICAgcHVibGlj\nIGludCBnZXRGaW5pc2hlZFRpbWUoT2JqZWN0IG5vZGUpIHsNCiAgICAgICAg\nTm9kZUluZm8gaW5mbyA9IChOb2RlSW5mbykgX25vZGVJbmZvLmdldChub2Rl\nKTsNCiAgICAgICAgaWYgKGluZm8gPT0gbnVsbCkNCiAgICAgICAgICAgIHJl\ndHVybiAtMTsNCiAgICAgICAgcmV0dXJuIGluZm8uZmluaXNoZWQ7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJucyBhIGxpc3Qgb2YgZ3JhcGgg\nZWRnZXMgZm9ybWluZyBhIGN5Y2xlLiBUaGUgY3ljbGUgYmVnaW5zIA0KICAg\nICAqIHdpdGggYSB0eXBlIHtAbGluayBFZGdlI1RZUEVfQkFDS30gZWRnZS4N\nCiAgICAgKiBAcGFyYW0gYmFja0VkZ2UgIlN0YXJ0aW5nIiBlZGdlIG9mIHRo\nZSBjeWNsZQ0KICAgICAqIEBwYXJhbSBwYXRoIENvbnRpbnVvdXMgbGlzdCBv\nZiBncmFwaCBlZGdlcywgbWF5IGJlIG51bGwNCiAgICAgKiBAcGFyYW0gcG9z\nIEluZGV4IG9mIHRoZSBmaXJzdCBlZGdlIGluIHBhdGggY29udGludWluZyB0\naGUgY3ljbGUNCiAgICAgKiBAcmV0dXJuIEN5Y2xlIHN0YXJ0aW5nIHdpdGgg\nYSB0eXBlIHtAbGluayBFZGdlI1RZUEVfQkFDS30gZWRnZQ0KICAgICAqLw0K\nICAgIHByaXZhdGUgTGlzdCBidWlsZEN5Y2xlKEVkZ2UgYmFja0VkZ2UsIExp\nc3QgcGF0aCwgaW50IHBvcykgew0KICAgICAgICBpbnQgbGVuZ3RoID0gcGF0\naCAhPSBudWxsID8gcGF0aC5zaXplKCkgLSBwb3MgOiAwOw0KICAgICAgICBM\naXN0IGN5Y2xlID0gbmV3IEFycmF5TGlzdChsZW5ndGggKyAxKTsNCiAgICAg\nICAgY3ljbGUuYWRkKDAsIGJhY2tFZGdlKTsNCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgY3ljbGUu\nYWRkKGkgKyAxLCBwYXRoLmdldChwb3MgKyBpKSk7DQogICAgICAgIH0NCiAg\nICAgICAgcmV0dXJuIGN5Y2xlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIENvbXB1dGVzIHRoZSBsaXN0IG9mIGVkZ2VzIGZvcm1pbmcgYSBjeWNsZS4g\nVGhlIGN5Y2xlIGFsd2F5cyBleGlzdHMgZm9yDQogICAgICogYSB0eXBlIHtA\nbGluayBFZGdlI1RZUEVfQkFDS30gZWRnZS4gVGhpcyBtZXRob2Qgc2hvdWxk\nIG9ubHkgYmUgY2FsbGVkIA0KICAgICAqIGZvciB0eXBlIHtAbGluayBFZGdl\nI1RZUEVfQkFDS30gZWRnZXMuIA0KICAgICAqIEBwYXJhbSBlZGdlIEVkZ2Ug\nd2hlcmUgdGhlIGN5Y2xlIHdhcyBkZXRlY3RlZA0KICAgICAqIEBwYXJhbSBw\nYXRoIFBhdGggY29uc2lzdGluZyBvZiBlZGdlcyB0byB0aGUgZWRnZSdzIHN0\nYXJ0aW5nIG5vZGUNCiAgICAgKiBAcmV0dXJuIEN5Y2xlIHN0YXJ0aW5nIHdp\ndGggYSB0eXBlIHtAbGluayBFZGdlI1RZUEVfQkFDS30gZWRnZQ0KICAgICAq\nLw0KICAgIHByaXZhdGUgTGlzdCBjeWNsZUZvckJhY2tFZGdlKEVkZ2UgZWRn\nZSwgTGlzdCBwYXRoKSB7DQogICAgICAgIGlmIChlZGdlLmdldFR5cGUoKSAh\nPSBFZGdlLlRZUEVfQkFDSykgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7\nDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIExpc3QgY3ljbGU7DQog\nICAgICAgIGludCBwb3MgPSAwOw0KICAgICAgICBpZiAocGF0aCAhPSBudWxs\nICYmICFlZGdlLmdldEZyb20oKS5lcXVhbHMoZWRnZS5nZXRUbygpKSkgew0K\nICAgICAgICAgICAgLy8gTm90IGEgc2luZ2xlIGVkZ2UgbG9vcA0KICAgICAg\nICAgICAgcG9zID0gZmluZE5vZGVJblBhdGgoZWRnZS5nZXRUbygpLCBwYXRo\nKTsNCiAgICAgICAgICAgIGFzc2VydCAocG9zID49IDApOiBfbG9jLmdldCgi\nbm9kZS1ub3Qtb24tcGF0aCIsIGVkZ2UsIGVkZ2UuZ2V0VG8oKSk7IA0KICAg\nICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0IChlZGdlLmdldEZy\nb20oKS5lcXVhbHMoZWRnZS5nZXRUbygpKSk6IA0KICAgICAgICAgICAgICAg\nIF9sb2MuZ2V0KCJlZGdlLW5vLWxvb3AiLCBlZGdlKS5nZXRNZXNzYWdlKCk7\nDQogICAgICAgICAgICBwYXRoID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAg\nICBjeWNsZSA9IGJ1aWxkQ3ljbGUoZWRnZSwgcGF0aCwgcG9zKTsgDQogICAg\nICAgIGFzc2VydCAoY3ljbGUgIT0gbnVsbCk6IF9sb2MuZ2V0KCJjeWNsZS1u\ndWxsIiwgZWRnZSkuZ2V0TWVzc2FnZSgpOw0KICAgICAgICByZXR1cm4gY3lj\nbGU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29tcHV0ZXMgdGhlIGN5\nY2xlIG9mIGVkZ2VzIGluY2x1ZGluZyBub2RlIGN5Y2xlVG8uIFRoZSBjeWNs\nZSBtdXN0IG5vdCANCiAgICAgKiBuZWNlc3NhcmlseSBleGlzdC4gVGhpcyBt\nZXRob2Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZvciB0eXBlIA0KICAgICAq\nIHtAbGluayBFZGdlI1RZUEVfRk9SV0FSRH0gZWRnZXMuDQogICAgICogQHBh\ncmFtIGdyYXBoIEdyYXBoDQogICAgICogQHBhcmFtIG5vZGUgQ3VycmVudCBu\nb2RlDQogICAgICogQHBhcmFtIGN5Y2xlVG8gRW5kIG5vZGUgZm9yIGxvb3AN\nCiAgICAgKiBAcGFyYW0gcGF0aCBQYXRoIGZyb20gbG9vcCBlbmQgbm9kZSB0\nbyBjdXJyZW50IG5vZGUNCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYSBjeWNs\nZSBoYXMgYmVlbiBmb3VuZC4gVGhlIGN5Y2xlIHdpbGwgYmUgY29udGFpbmVk\nIGluDQogICAgICogdGhlIDxjb2RlPnBhdGg8L2NvZGU+IHBhcmFtZXRlci4N\nCiAgICAgKi8NCiAgICBwcml2YXRlIGJvb2xlYW4gY3ljbGVGb3JGb3J3YXJk\nRWRnZShHcmFwaCBncmFwaCwgT2JqZWN0IG5vZGUsDQogICAgICAgIE9iamVj\ndCBjeWNsZVRvLCBMaXN0IHBhdGgpIHsgICAgICAgICAgICAgICAgICAgDQog\nICAgICAgIGJvb2xlYW4gZm91bmQgPSBmYWxzZTsNCiAgICAgICAgQ29sbGVj\ndGlvbiBlZGdlcyA9IGdyYXBoLmdldEVkZ2VzRnJvbShub2RlKTsNCiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBlZGdlcy5pdGVyYXRvcigpOyAhZm91\nbmQgJiYgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgIEVkZ2UgZWRn\nZSA9IChFZGdlKSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgT2JqZWN0IG90\naGVyID0gZWRnZS5nZXRPdGhlcihub2RlKTsNCiAgICAgICAgICAgIC8vIFNp\nbmdsZSBlZGdlIGxvb3BzIGFyZSBpZ25vcmVkDQogICAgICAgICAgICBpZiAo\nIW5vZGUuZXF1YWxzKG90aGVyKSkgew0KICAgICAgICAgICAgICAgIGlmIChv\ndGhlci5lcXVhbHMoY3ljbGVUbykpIHsNCiAgICAgICAgICAgICAgICAgICAg\nLy8gQ3ljbGUgY29tcGxldGUNCiAgICAgICAgICAgICAgICAgICAgcGF0aC5h\nZGQoZWRnZSk7DQogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsN\nCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFwYXRoLmNvbnRhaW5zKGVk\nZ2UpKXsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2FsayB0aGlzIGVkZ2UN\nCiAgICAgICAgICAgICAgICAgICAgcGF0aC5hZGQoZWRnZSk7DQogICAgICAg\nICAgICAgICAgICAgIGZvdW5kID0gY3ljbGVGb3JGb3J3YXJkRWRnZShncmFw\naCwgb3RoZXIsIGN5Y2xlVG8sIHBhdGgpOw0KICAgICAgICAgICAgICAgICAg\nICBpZiAoIWZvdW5kKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBS\nZW1vdmUgZWRnZSBhZ2Fpbg0KICAgICAgICAgICAgICAgICAgICAgICAgcGF0\naC5yZW1vdmUoZWRnZSk7ICAgICAgICAgICAgICAgICAgICANCiAgICAgICAg\nICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg\nIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZm91bmQ7DQogICAgfQ0K\nICAgIA0KICAgIC8qKg0KICAgICAqIEZpbmRzIHRoZSBwb3NpdGlvbiBvZiB0\naGUgZWRnZSBzdGFydGluZyBmcm9tIGEgcGFydGljdWxhciBub2RlIGluIHRo\nZSANCiAgICAgKiBjb250aW51b3VzIGxpc3Qgb2YgZWRnZXMuDQogICAgICog\nQHBhcmFtIG5vZGUgTm9kZSBvbiB0aGUgY3ljbGUuDQogICAgICogQHBhcmFt\nIHBhdGggQ29udGludW91cyBsaXN0IG9mIGdyYXBoIGVkZ2VzLg0KICAgICAq\nIEByZXR1cm4gRWRnZSBpbmRleCBpZiBmb3VuZCwgLTEgb3RoZXJ3aXNlLg0K\nICAgICAqLw0KICAgIHByaXZhdGUgaW50IGZpbmROb2RlSW5QYXRoKE9iamVj\ndCBub2RlLCBMaXN0IHBhdGgpIHsNCiAgICAgICAgaW50IHBvcyA9IC0xOw0K\nICAgICAgICBpZiAocGF0aCAhPSBudWxsKSB7DQogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHBhdGguc2l6ZSgpOyBpKyspIHsNCiAgICAgICAg\nICAgICAgICBpZiAoKChFZGdlKXBhdGguZ2V0KGkpKS5nZXRGcm9tKCkuZXF1\nYWxzKG5vZGUpKSB7DQogICAgICAgICAgICAgICAgICAgIHBvcyA9IGk7DQog\nICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQog\nICAgICAgIHJldHVybiBwb3M7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nVGVzdCwgaWYgdGhlIGFuYWx5c2lzIGRpZG4ndCBmaW5kIGN5Y2xlcy4NCiAg\nICAgKi8NCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNOb0N5Y2xlcygpIHsNCiAg\nICAgICAgLy8gYSkgdGhlcmUgbXVzdCBub3QgYmUgYW55IGJhY2sgZWRnZXMN\nCiAgICAgICAgaWYgKCFnZXRFZGdlcyhFZGdlLlRZUEVfQkFDSykuaXNFbXB0\neSgpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0N\nCiAgICAgICAgLy8gYikgdGhlcmUgbWlnaHQgYmUgZm9yd2FyZCBlZGdlcw0K\nICAgICAgICAvLyBtYWtlIHN1cmUgdGhlc2UgZG9uJ3QgaW5kaWNhdGUgY3lj\nbGVzDQogICAgICAgIENvbGxlY3Rpb24gZWRnZXMgPSBnZXRFZGdlcyhFZGdl\nLlRZUEVfRk9SV0FSRCk7DQogICAgICAgIGlmICghZWRnZXMuaXNFbXB0eSgp\nKSB7DQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGVkZ2VzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAg\nRWRnZSBlZGdlID0gKEVkZ2UpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICAg\nICAgaWYgKGVkZ2UuZ2V0Q3ljbGUoKSAhPSBudWxsKSAgew0KICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0K\nICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVl\nOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBDb21wYXJhdG9yIGZv\nciB0b3Bsb2dpY2FsbHkgc29ydGluZyBlbnRyaWVzIGluIHRoZSBub2RlIGlu\nZm8gbWFwLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE5v\nZGVJbmZvQ29tcGFyYXRvcg0KICAgICAgICBpbXBsZW1lbnRzIENvbXBhcmF0\nb3Igew0KDQogICAgICAgIHByaXZhdGUgZmluYWwgQ29tcGFyYXRvciBfc3Vi\nQ29tcDsNCg0KICAgICAgICBwdWJsaWMgTm9kZUluZm9Db21wYXJhdG9yKENv\nbXBhcmF0b3Igc3ViQ29tcCkgew0KICAgICAgICAgICAgX3N1YkNvbXAgPSBz\ndWJDb21wOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBjb21w\nYXJlKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7DQogICAgICAgICAgICBNYXAu\nRW50cnkgZTEgPSAoTWFwLkVudHJ5KSBvMTsNCiAgICAgICAgICAgIE1hcC5F\nbnRyeSBlMiA9IChNYXAuRW50cnkpIG8yOw0KICAgICAgICAgICAgTm9kZUlu\nZm8gbjEgPSAoTm9kZUluZm8pIGUxLmdldFZhbHVlKCk7DQogICAgICAgICAg\nICBOb2RlSW5mbyBuMiA9IChOb2RlSW5mbykgZTIuZ2V0VmFsdWUoKTsNCg0K\nICAgICAgICAgICAgLy8gc29ydCBieSBmaW5pc2hlZCBvcmRlcg0KICAgICAg\nICAgICAgaW50IHJldCA9IG4xLmZpbmlzaGVkIC0gbjIuZmluaXNoZWQ7DQog\nICAgICAgICAgICBpZiAocmV0ID09IDAgJiYgX3N1YkNvbXAgIT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICByZXQgPSBfc3ViQ29tcC5jb21wYXJlKGUxLmdl\ndEtleSgpLCBlMi5nZXRLZXkoKSk7DQogICAgICAgICAgICByZXR1cm4gcmV0\nOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICoJTGlzdCBv\nZiBub2RlLXRvLW5vZGVpbmZvIGVudHJpZXMgdGhhdCBleHBvc2VzIGp1c3Qg\ndGhlIG5vZGVzLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIE5vZGVMaXN0DQogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RMaXN0IHsNCg0K\nICAgICAgICBwcml2YXRlIGZpbmFsIE1hcC5FbnRyeVtdIF9lbnRyaWVzOw0K\nDQogICAgICAgIHB1YmxpYyBOb2RlTGlzdChNYXAuRW50cnlbXSBlbnRyaWVz\nKSB7DQogICAgICAgICAgICBfZW50cmllcyA9IGVudHJpZXM7DQogICAgICAg\nIH0NCg0KICAgICAgICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaWR4KSB7DQog\nICAgICAgICAgICByZXR1cm4gX2VudHJpZXNbaWR4XS5nZXRLZXkoKTsNCiAg\nICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsNCiAgICAg\nICAgICAgIHJldHVybiBfZW50cmllcy5sZW5ndGg7DQoJCX0NCgl9DQp9DQo=\n","encoding":"base64"}

