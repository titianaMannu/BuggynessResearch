{"sha":"9b37a3ea5d549ecf246ca17de9f160757ba47088","node_id":"MDQ6QmxvYjIwNjM2NDo5YjM3YTNlYTVkNTQ5ZWNmMjQ2Y2ExN2RlOWYxNjA3NTdiYTQ3MDg4","size":47472,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9b37a3ea5d549ecf246ca17de9f160757ba47088","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmM7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLnNxbC5B\ncnJheTsKaW1wb3J0IGphdmEuc3FsLkJhdGNoVXBkYXRlRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7Cmlt\ncG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRGF0\nYWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3FsLkRhdGU7CmltcG9ydCBq\nYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlJl\nZjsKaW1wb3J0IGphdmEuc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldE1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0\naW9uOwppbXBvcnQgamF2YS5zcWwuU1FMV2FybmluZzsKaW1wb3J0IGphdmEu\nc3FsLlNhdmVwb2ludDsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1w\nb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRhcjsKaW1wb3J0IGph\ndmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKCi8q\nKgogKiBBIHtAbGluayBDb25uZWN0aW9uRGVjb3JhdG9yfSB0aGF0IGNyZWF0\nZXMgbG9nZ2luZyBjb25uZWN0aW9ucyBhbmQKICoge0BsaW5rIFJlcG9ydGlu\nZ1NRTEV4Y2VwdGlvbn1zLgogKgogKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21t\nZWF1eAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgTG9nZ2luZ0Nv\nbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVtZW50cyBDb25uZWN0aW9uRGVjb3Jh\ndG9yIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0VQID0g\nSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRvcigpOwoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBXQVJOX0lHTk9SRSA9IDA7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgV0FSTl9MT0dfVFJBQ0UgPSAxOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFdBUk5fTE9HX0lORk8gPSAyOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFdBUk5fTE9HX1dBUk4gPSAz\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFdBUk5fTE9HX0VSUk9S\nID0gNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBXQVJOX1RIUk9X\nID0gNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBXQVJOX0hBTkRM\nRSA9IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBXQVJO\nSU5HX0FDVElPTlMgPSBuZXcgU3RyaW5nWzddOwoKICAgIHN0YXRpYyB7CiAg\nICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5fSUdOT1JFXSA9ICJpZ25vcmUi\nOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX0xPR19UUkFDRV0gPSAi\ndHJhY2UiOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX0xPR19JTkZP\nXSA9ICJpbmZvIjsKICAgICAgICBXQVJOSU5HX0FDVElPTlNbV0FSTl9MT0df\nV0FSTl0gPSAid2FybiI7CiAgICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5f\nTE9HX0VSUk9SXSA9ICJlcnJvciI7CiAgICAgICAgV0FSTklOR19BQ1RJT05T\nW1dBUk5fVEhST1ddID0gInRocm93IjsKICAgICAgICBXQVJOSU5HX0FDVElP\nTlNbV0FSTl9IQU5ETEVdID0gImhhbmRsZSI7CiAgICB9CgogICAgcHJpdmF0\nZSBmaW5hbCBEYXRhU291cmNlTG9ncyBfbG9ncyA9IG5ldyBEYXRhU291cmNl\nTG9ncygpOwogICAgcHJpdmF0ZSBTUUxGb3JtYXR0ZXIgX2Zvcm1hdHRlcjsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfcHJldHR5UHJpbnQ7CiAgICBwcml2YXRl\nIGludCBfcHJldHR5UHJpbnRMaW5lTGVuZ3RoID0gNjA7CiAgICBwcml2YXRl\nIGludCBfd2FybmluZ0FjdGlvbiA9IFdBUk5fSUdOT1JFOwogICAgcHJpdmF0\nZSBTUUxXYXJuaW5nSGFuZGxlciBfd2FybmluZ0hhbmRsZXI7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX3RyYWNrUGFyYW1ldGVycyA9IHRydWU7CgogICAgLyoq\nCiAgICAgKiBJZiBzZXQgdG8gPGNvZGU+dHJ1ZTwvY29kZT4sIHByZXR0eS1w\ncmludCBTUUwgYnkgcnVubmluZyBpdAogICAgICogdGhyb3VnaCB7QGxpbmsg\nU1FMRm9ybWF0dGVyI3ByZXR0eVByaW50fS4gSWYKICAgICAqIDxjb2RlPmZh\nbHNlPC9jb2RlPiwgZG9uJ3QgcHJldHR5LXByaW50LCBhbmQgb3V0cHV0IFNR\nTCBsb2dzIGluCiAgICAgKiBhIHNpbmdsZSBsaW5lLiBQcmV0dHktcHJpbnRl\nZCBTUUwgY2FuIGJlIGVhc2llciBmb3IgYSBodW1hbiB0bwogICAgICogcmVh\nZCwgYnV0IGlzIGhhcmRlciB0byBwYXJzZSB3aXRoIHRvb2xzIGxpa2UgZ3Jl\ncC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJldHR5UHJpbnQoYm9v\nbGVhbiBwcmV0dHlQcmludCkgewogICAgICAgIF9wcmV0dHlQcmludCA9IHBy\nZXR0eVByaW50OwogICAgICAgIGlmIChfZm9ybWF0dGVyID09IG51bGwgJiYg\nX3ByZXR0eVByaW50KSB7CiAgICAgICAgICAgIF9mb3JtYXR0ZXIgPSBuZXcg\nU1FMRm9ybWF0dGVyKCk7CiAgICAgICAgICAgIF9mb3JtYXR0ZXIuc2V0TGlu\nZUxlbmd0aChfcHJldHR5UHJpbnRMaW5lTGVuZ3RoKTsKICAgICAgICB9IGVs\nc2UgaWYgKCFfcHJldHR5UHJpbnQpCiAgICAgICAgICAgIF9mb3JtYXR0ZXIg\nPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjc2V0UHJldHR5\nUHJpbnQKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UHJldHR5UHJp\nbnQoKSB7CiAgICAgICAgcmV0dXJuIF9wcmV0dHlQcmludDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyB0byBwcmlu\ndCBwZXIgbGluZSB3aGVuCiAgICAgKiBwcmV0dHktcHJpbnRpbmcgb2YgU1FM\nIGlzIGVuYWJsZWQuIERlZmF1bHRzIHRvIDYwIHRvIHByb3ZpZGUKICAgICAq\nIHNvbWUgc3BhY2UgZm9yIGFueSBhbnQtcmVsYXRlZCBjaGFyYWN0ZXJzIG9u\nIHRoZSBsZWZ0IG9mIGEKICAgICAqIHN0YW5kYXJkIDgwLWNoYXJhY3RlciBk\naXNwbGF5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmV0dHlQcmlu\ndExpbmVMZW5ndGgoaW50IGxlbmd0aCkgewogICAgICAgIF9wcmV0dHlQcmlu\ndExpbmVMZW5ndGggPSBsZW5ndGg7CiAgICAgICAgaWYgKF9mb3JtYXR0ZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgX2Zvcm1hdHRlci5zZXRMaW5lTGVuZ3Ro\nKGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAc2VlICNzZXRQcmV0\ndHlQcmludExpbmVMZW5ndGgKICAgICAqLwogICAgcHVibGljIGludCBnZXRQ\ncmV0dHlQcmludExpbmVMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIF9wcmV0\ndHlQcmludExpbmVMZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHRvIHRyYWNrIHBhcmFtZXRlcnMgZm9yIHRoZSBwdXJwb3NlcyBvZiBy\nZXBvcnRpbmcgZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0VHJhY2tQYXJhbWV0ZXJzKGJvb2xlYW4gdHJhY2tQYXJhbWV0ZXJzKSB7\nCiAgICAgICAgX3RyYWNrUGFyYW1ldGVycyA9IHRyYWNrUGFyYW1ldGVyczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdHJhY2sgcGFyYW1l\ndGVycyBmb3IgdGhlIHB1cnBvc2VzIG9mIHJlcG9ydGluZyBleGNlcHRpb25z\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRUcmFja1BhcmFtZXRl\ncnMoKSB7CiAgICAgICAgcmV0dXJuIF90cmFja1BhcmFtZXRlcnM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGF0IHRvIGRvIHdpdGggU1FMIHdhcm5pbmdz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRXYXJuaW5nQWN0aW9uKFN0\ncmluZyB3YXJuaW5nQWN0aW9uKSB7CiAgICAgICAgaW50IGluZGV4ID0gQXJy\nYXlzLmFzTGlzdChXQVJOSU5HX0FDVElPTlMpLmluZGV4T2Yod2FybmluZ0Fj\ndGlvbik7CiAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgaW5k\nZXggPSBXQVJOX0lHTk9SRTsKICAgICAgICBfd2FybmluZ0FjdGlvbiA9IGlu\nZGV4OwogICAgfQoKICAgIC8qKgogICAgICogV2hhdCB0byBkbyB3aXRoIFNR\nTCB3YXJuaW5ncy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRXYXJu\naW5nQWN0aW9uKCkgewogICAgICAgIHJldHVybiBXQVJOSU5HX0FDVElPTlNb\nX3dhcm5pbmdBY3Rpb25dOwogICAgfQoKICAgIC8qKgogICAgICogV2hhdCB0\nbyBkbyB3aXRoIFNRTCB3YXJuaW5ncy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0V2FybmluZ0hhbmRsZXIoU1FMV2FybmluZ0hhbmRsZXIgd2Fybmlu\nZ0hhbmRsZXIpIHsKICAgICAgICBfd2FybmluZ0hhbmRsZXIgPSB3YXJuaW5n\nSGFuZGxlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoYXQgdG8gZG8gd2l0\naCBTUUwgd2FybmluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxXYXJuaW5n\nSGFuZGxlciBnZXRXYXJuaW5nSGFuZGxlcigpIHsKICAgICAgICByZXR1cm4g\nX3dhcm5pbmdIYW5kbGVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGxv\nZyB0byB3cml0ZSB0by4KICAgICAqLwogICAgcHVibGljIERhdGFTb3VyY2VM\nb2dzIGdldExvZ3MoKSB7CiAgICAgICAgcmV0dXJuIF9sb2dzOwogICAgfQoK\nICAgIHB1YmxpYyBDb25uZWN0aW9uIGRlY29yYXRlKENvbm5lY3Rpb24gY29u\nbikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ldyBM\nb2dnaW5nQ29ubmVjdGlvbihjb25uKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEluY2x1ZGUgU1FMIGluIGV4Y2VwdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3FsZSwgU3RhdGVt\nZW50IHN0bW50KSB7CiAgICAgICAgaWYgKHNxbGUgaW5zdGFuY2VvZiBSZXBv\ncnRpbmdTUUxFeGNlcHRpb24pCiAgICAgICAgICAgIHJldHVybiAoUmVwb3J0\naW5nU1FMRXhjZXB0aW9uKSBzcWxlOwogICAgICAgIHJldHVybiBuZXcgUmVw\nb3J0aW5nU1FMRXhjZXB0aW9uKHNxbGUsIHN0bW50KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEluY2x1ZGUgU1FMIGluIGV4Y2VwdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3Fs\nZSwgU3RyaW5nIHNxbCkgewogICAgICAgIGlmIChzcWxlIGluc3RhbmNlb2Yg\nUmVwb3J0aW5nU1FMRXhjZXB0aW9uKQogICAgICAgICAgICByZXR1cm4gKFJl\ncG9ydGluZ1NRTEV4Y2VwdGlvbikgc3FsZTsKICAgICAgICByZXR1cm4gbmV3\nIFJlcG9ydGluZ1NRTEV4Y2VwdGlvbihzcWxlLCBzcWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogSW50ZXJmYWNlIHRoYXQgYWxsb3dzIGN1c3RvbWl6YXRp\nb24gb2Ygd2hhdCB0byBkbyB3aGVuCiAgICAgKiB7QGxpbmsgU1FMV2Fybmlu\nZ31zIG9jY3VyLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFj\nZSBTUUxXYXJuaW5nSGFuZGxlciB7CgogICAgICAgIHB1YmxpYyB2b2lkIGhh\nbmRsZVdhcm5pbmcoU1FMV2FybmluZyB3YXJuaW5nKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogTG9nZ2luZyBjb25uZWN0\naW9uLgogICAgICovCiAgICBwcml2YXRlIGNsYXNzIExvZ2dpbmdDb25uZWN0\naW9uIGV4dGVuZHMgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBw\ndWJsaWMgTG9nZ2luZ0Nvbm5lY3Rpb24oQ29ubmVjdGlvbiBjb25uKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAg\nICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQg\ncHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAg\nICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQg\nPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQo\nc3RtbnQsIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgc3FsKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFBy\nZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwg\naW50IHJzVHlwZSwKICAgICAgICAgICAgaW50IHJzQ29uY3VyLCBib29sZWFu\nIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBz\ndXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAgICAgICAgICAgICAgKHNx\nbCwgcnNUeXBlLCByc0NvbmN1ciwgZmFsc2UpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQoc3RtbnQsIHNx\nbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgc3FsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlbWVudCBj\ncmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgU3RhdGVtZW50IHN0bW50ID0gc3VwZXIuY3Jl\nYXRlU3RhdGVtZW50KGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBM\nb2dnaW5nU3RhdGVtZW50KHN0bW50KTsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCB0eXBlLCBp\nbnQgY29uY3VycmVuY3ksCiAgICAgICAgICAgIGJvb2xlYW4gd3JhcCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIFN0YXRlbWVudCBzdG1u\ndCA9IHN1cGVyLmNyZWF0ZVN0YXRlbWVudCh0eXBlLCBjb25jdXJyZW5jeSwg\nZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdTdGF0ZW1l\nbnQoc3RtbnQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY29t\nbWl0KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcg\nc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN1cGVyLmNvbW1pdCgpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dz\nLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5s\nb2dKREJDKCJjb21taXQiLCBzdGFydCwgdGhpcyk7CiAgICAgICAgICAgICAg\nICBoYW5kbGVTUUxXYXJuaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHN1cGVyLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoInJvbGxiYWNr\nIiwgc3RhcnQsIHRoaXMpOwogICAgICAgICAgICAgICAgaGFuZGxlU1FMV2Fy\nbmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBjbG9zZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdXBlci5jbG9z\nZSgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\naWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9ncy5sb2dKREJDKCJjbG9zZSIsIHN0YXJ0LCB0aGlzKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNhdmVwb2ludCBz\nZXRTYXZlcG9pbnQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLnNldFNhdmVwb2ludCgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJzYXZlcG9pbnQiLCBzdGFy\ndCwgdGhpcyk7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTYXZl\ncG9pbnQgc2V0U2F2ZXBvaW50KFN0cmluZyBuYW1lKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLnNldFNhdmVwb2ludChuYW1lKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5p\nc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9n\nSkRCQygic2F2ZXBvaW50OiAiICsgbmFtZSwgc3RhcnQsIHRoaXMpOwogICAg\nICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZygpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByb2xsYmFjayhTYXZl\ncG9pbnQgc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3VwZXIucm9s\nbGJhY2soc2F2ZXBvaW50KTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFt\nZSA9IHNhdmVwb2ludC5nZXRTYXZlcG9pbnROYW1lKCk7CiAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBuYW1lID0gU3RyaW5nLnZhbHVlT2Yoc2F2ZXBv\naW50LmdldFNhdmVwb2ludElkKCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJyb2xsYmFjazog\nIiArIG5hbWUsIHN0YXJ0LCB0aGlzKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVsZWFzZVNhdmVw\nb2ludChTYXZlcG9pbnQgc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nc3VwZXIucmVsZWFzZVNhdmVwb2ludChzYXZlcG9pbnQpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRC\nQ0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBuYW1l\nID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICBuYW1lID0gc2F2ZXBvaW50LmdldFNhdmVwb2ludE5h\nbWUoKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc3FlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBTdHJp\nbmcudmFsdWVPZihzYXZlcG9pbnQuZ2V0U2F2ZXBvaW50SWQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxv\nZ0pEQkMoInJlbGVhc2U6ICIgKyBuYW1lLCBzdGFydCwgdGhpcyk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5n\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCByZXN1bHRTZXRUeXBl\nLAogICAgICAgICAgICBpbnQgcmVzdWx0U2V0Q29uY3VycmVuY3ksIGludCBy\nZXN1bHRTZXRIb2xkYWJpbGl0eSwgYm9vbGVhbiB3cmFwKQogICAgICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgU3RhdGVtZW50\nIHN0bW50ID0gc3VwZXIuY3JlYXRlU3RhdGVtZW50KHJlc3VsdFNldFR5cGUs\nCiAgICAgICAgICAgICAgICByZXN1bHRTZXRDb25jdXJyZW5jeSwgcmVzdWx0\nU2V0SG9sZGFiaWxpdHksIGZhbHNlKTsKICAgICAgICAgICAgaGFuZGxlU1FM\nV2FybmluZygpOwogICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdTdGF0\nZW1lbnQoc3RtbnQpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFBy\nZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwK\nICAgICAgICAgICAgaW50IHJlc3VsdFNldFR5cGUsIGludCByZXN1bHRTZXRD\nb25jdXJyZW5jeSwKICAgICAgICAgICAgaW50IHJlc3VsdFNldEhvbGRhYmls\naXR5LCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAgICAg\nICAgICAgICAgKHNxbCwgcmVzdWx0U2V0VHlwZSwgcmVzdWx0U2V0Q29uY3Vy\ncmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFNldEhvbGRh\nYmlsaXR5LCBmYWxzZSk7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJu\naW5nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdQcmVw\nYXJlZFN0YXRlbWVudChzdG1udCwgc3FsKTsKICAgICAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB3\ncmFwKHNlLCBzcWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVu\ndChTdHJpbmcgc3FsLAogICAgICAgICAgICBpbnQgYXV0b0dlbmVyYXRlZEtl\neXMsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCA9IHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQKICAgICAgICAgICAg\nICAgICAgICAoc3FsLCBhdXRvR2VuZXJhdGVkS2V5cywgZmFsc2UpOwogICAg\nICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZygpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQoc3RtbnQs\nIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgc3FsKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVk\nU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwKICAgICAg\nICAgICAgaW50W10gY29sdW1uSW5kZXhlcywgYm9vbGVhbiB3cmFwKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gc3VwZXIucHJlcGFy\nZVN0YXRlbWVudAogICAgICAgICAgICAgICAgICAgIChzcWwsIGNvbHVtbklu\nZGV4ZXMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5p\nbmcoKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9nZ2luZ1ByZXBh\ncmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIHRocm93IHdy\nYXAoc2UsIHNxbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50\nKFN0cmluZyBzcWwsCiAgICAgICAgICAgIFN0cmluZ1tdIGNvbHVtbk5hbWVz\nLCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAgICAgICAg\nICAgICAgKHNxbCwgY29sdW1uTmFtZXMsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGhhbmRsZVNRTFdhcm5pbmcoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwog\nICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IHdyYXAoc2UsIHNxbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBEYXRhYmFzZU1ldGFEYXRh\nIGdldE1ldGFEYXRhKGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTG9nZ2lu\nZ0RhdGFiYXNlTWV0YURhdGEoc3VwZXIuZ2V0TWV0YURhdGEoZmFsc2UpKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIExvZyB0aW1lIGVs\nYXBzZWQgc2luY2UgZ2l2ZW4gc3RhcnQuCiAgICAgICAgICovCiAgICAgICAg\ncHJpdmF0ZSB2b2lkIGxvZ1RpbWUobG9uZyBzdGFydFRpbWUpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoX2xvZ3MuaXNTUUxFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBfbG9ncy5sb2dTUUwoInNwZW50Iiwg\nc3RhcnRUaW1lLCB0aGlzKTsgCiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBMb2cgdGltZSBlbGFwc2VkIHNpbmNlIGdpdmVuIHN0YXJ0Lgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBsb2dTUUwoU3RhdGVt\nZW50IHN0bW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\naWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZ3MubG9nU1FMKCJleGVjdXRpbmcgIiArIHN0bW50LCB0aGlzKTsgCiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBIYW5kbGUgYW55IHtAbGlu\nayBTUUxXYXJuaW5nfXMgb24gdGhlIGN1cnJlbnQge0BsaW5rIENvbm5lY3Rp\nb259LgogICAgICAgICAqCiAgICAgICAgICogQHNlZSAjaGFuZGxlU1FMV2Fy\nbmluZyhTUUxXYXJuaW5nKQogICAgICAgICAqLwogICAgICAgIHByaXZhdGUg\ndm9pZCBoYW5kbGVTUUxXYXJuaW5nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGlmIChfd2FybmluZ0FjdGlvbiA9PSBXQVJOX0lHTk9S\nRSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKGdldFdhcm5pbmdz\nKCkpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\nY2xlYXJXYXJuaW5ncygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBIYW5kbGUgYW55IHtAbGluayBTUUxXYXJu\naW5nfXMgb24gdGhlIHNwZWNpZmllZCB7QGxpbmsgU3RhdGVtZW50fS4KICAg\nICAgICAgKgogICAgICAgICAqIEBzZWUgI2hhbmRsZVNRTFdhcm5pbmcoU1FM\nV2FybmluZykKICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgaGFu\nZGxlU1FMV2FybmluZyhTdGF0ZW1lbnQgc3RtbnQpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICBpZiAoX3dhcm5pbmdBY3Rpb24gPT0gV0FS\nTl9JR05PUkUpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhzdG1u\ndC5nZXRXYXJuaW5ncygpKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIHN0bW50LmNsZWFyV2FybmluZ3MoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSGFuZGxl\nIGFueSB7QGxpbmsgU1FMV2FybmluZ31zIG9uIHRoZSBzcGVjaWZpZWQge0Bs\naW5rIFJlc3VsdFNldH0uCiAgICAgICAgICoKICAgICAgICAgKiBAc2VlICNo\nYW5kbGVTUUxXYXJuaW5nKFNRTFdhcm5pbmcpCiAgICAgICAgICovCiAgICAg\nICAgcHJpdmF0ZSB2b2lkIGhhbmRsZVNRTFdhcm5pbmcoUmVzdWx0U2V0IHJz\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF93YXJu\naW5nQWN0aW9uID09IFdBUk5fSUdOT1JFKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGhhbmRs\nZVNRTFdhcm5pbmcocnMuZ2V0V2FybmluZ3MoKSk7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBycy5jbGVhcldhcm5pbmdzKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIEhhbmRsZSB0aGUgc3BlY2lmaWVkIHtAbGluayBTUUxXYXJuaW5nfSBk\nZXBlbmRpbmcgb24gdGhlCiAgICAgICAgICogc2V0dGluZyBvZiB0aGUge0Bs\naW5rICNzZXRXYXJuaW5nQWN0aW9ufSBhdHRyaWJ1dGUuCiAgICAgICAgICoK\nICAgICAgICAgKiBAcGFyYW0gd2FybmluZyB0aGUgd2FybmluZyB0byBoYW5k\nbGUKICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgaGFuZGxlU1FM\nV2FybmluZyhTUUxXYXJuaW5nIHdhcm5pbmcpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICBpZiAod2FybmluZyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoX3dhcm5pbmdBY3Rp\nb24gPT0gV0FSTl9JR05PUkUpCiAgICAgICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgICAgICBMb2cgbG9nID0gX2xvZ3MuZ2V0SkRCQ0xvZygpOwogICAg\nICAgICAgICBmb3IgKDsgd2FybmluZyAhPSBudWxsOyB3YXJuaW5nID0gd2Fy\nbmluZy5nZXROZXh0V2FybmluZygpKSB7CiAgICAgICAgICAgICAgICBzd2l0\nY2ggKF93YXJuaW5nQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSBXQVJOX0xPR19UUkFDRToKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKHdhcm5pbmcpOwogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFdBUk5fTE9H\nX0lORk86CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNJbmZv\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmlu\nZm8od2FybmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIGNhc2UgV0FSTl9MT0dfV0FSTjoKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cud2Fybih3YXJuaW5nKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBXQVJOX0xPR19FUlJPUjoKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGxvZy5pc0Vycm9yRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nLmVycm9yKHdhcm5pbmcpOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNl\nIFdBUk5fVEhST1c6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGp1c3Qg\ndGhyb3cgaXQgYXMgaWYgaXQgd2VyZSBhIFNRTEV4Y2VwdGlvbgogICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvdyB3YXJuaW5nOwogICAgICAgICAgICAg\nICAgICAgIGNhc2UgV0FSTl9IQU5ETEU6CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChfd2FybmluZ0hhbmRsZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIF93YXJuaW5nSGFuZGxlci5oYW5kbGVXYXJuaW5n\nKHdhcm5pbmcpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBpZ25vcmUKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIE1ldGFkYXRhIHdyYXBwZXIgdGhhdCBs\nb2dzIGFjdGlvbnMuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBjbGFz\ncyBMb2dnaW5nRGF0YWJhc2VNZXRhRGF0YQogICAgICAgICAgICBleHRlbmRz\nIERlbGVnYXRpbmdEYXRhYmFzZU1ldGFEYXRhIHsKCiAgICAgICAgICAgIHB1\nYmxpYyBMb2dnaW5nRGF0YWJhc2VNZXRhRGF0YShEYXRhYmFzZU1ldGFEYXRh\nIG1ldGEpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG1ldGEsIExvZ2dpbmdD\nb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgUmVzdWx0U2V0IGdldEJlc3RSb3dJZGVudGlmaWVyKFN0cmluZyBj\nYXRhbG9nLAogICAgICAgICAgICAgICAgU3RyaW5nIHNjaGVtYSwgU3RyaW5n\nIHRhYmxlLCBpbnQgc2NvcGUsIGJvb2xlYW4gbnVsbGFibGUpCiAgICAgICAg\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgX2xvZ3MubG9nSkRCQygiZ2V0QmVzdFJvd0lkZW50aWZpZXI6ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVt\nYSArICIsICIgKyB0YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgTG9n\nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZ2V0QmVzdFJvd0lkZW50aWZpZXIoY2F0YWxvZywgc2NoZW1hLAog\nICAgICAgICAgICAgICAgICAgIHRhYmxlLCBzY29wZSwgbnVsbGFibGUpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdl\ndENhdGFsb2dzKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldENhdGFsb2dzIiwgTG9nZ2luZ0Nv\nbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nZ2V0Q2F0YWxvZ3MoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIFJlc3VsdFNldCBnZXRDb2x1bW5Qcml2aWxlZ2VzKFN0cmluZyBjYXRh\nbG9nLCBTdHJpbmcgc2NoZW1hLAogICAgICAgICAgICAgICAgU3RyaW5nIHRh\nYmxlLCBTdHJpbmcgY29sdW1uTmFtZVBhdHRlcm4pIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRD\nb2x1bW5Qcml2aWxlZ2VzOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nY2F0YWxvZyArICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAg\nICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENvbHVtblByaXZpbGVn\nZXMoY2F0YWxvZywgc2NoZW1hLAogICAgICAgICAgICAgICAgICAgIHRhYmxl\nLCBjb2x1bW5OYW1lUGF0dGVybik7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0Q29sdW1ucyhTdHJpbmcgY2F0YWxv\nZywgU3RyaW5nIHNjaGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAgICBTdHJp\nbmcgdGFibGVOYW1lUGF0dGVybiwgU3RyaW5nIGNvbHVtbk5hbWVQYXR0ZXJu\nKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldENvbHVtbnM6ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVt\nYVBhdHRlcm4gKyAiLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgdGFi\nbGVOYW1lUGF0dGVybiArICIsICIgKyBjb2x1bW5OYW1lUGF0dGVybiwKICAg\nICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q29sdW1ucyhjYXRh\nbG9nLCBzY2hlbWFQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAgIHRhYmxl\nTmFtZVBhdHRlcm4sIGNvbHVtbk5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRDcm9zc1JlZmVy\nZW5jZShTdHJpbmcgcHJpbWFyeUNhdGFsb2csCiAgICAgICAgICAgICAgICBT\ndHJpbmcgcHJpbWFyeVNjaGVtYSwgU3RyaW5nIHByaW1hcnlUYWJsZSwKICAg\nICAgICAgICAgICAgIFN0cmluZyBmb3JlaWduQ2F0YWxvZywgU3RyaW5nIGZv\ncmVpZ25TY2hlbWEsCiAgICAgICAgICAgICAgICBTdHJpbmcgZm9yZWlnblRh\nYmxlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlm\nIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nX2xvZ3MubG9nSkRCQygiZ2V0Q3Jvc3NSZWZlcmVuY2U6ICIKICAgICAgICAg\nICAgICAgICAgICAgICAgKyBwcmltYXJ5Q2F0YWxvZyArICIsICIgKyBwcmlt\nYXJ5U2NoZW1hICsgIiwgIgogICAgICAgICAgICAgICAgICAgICAgICArIHBy\naW1hcnlUYWJsZSArICIsICIgKyBmb3JlaWduQ2F0YWxvZyArICIsICIKICAg\nICAgICAgICAgICAgICAgICAgICAgKyBmb3JlaWduU2NoZW1hICsgIiwgIiAr\nIGZvcmVpZ25TY2hlbWEsCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dp\nbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmdldENyb3NzUmVmZXJlbmNlKHByaW1hcnlDYXRhbG9nLCBwcmltYXJ5\nU2NoZW1hLAogICAgICAgICAgICAgICAgICAgIHByaW1hcnlUYWJsZSwgZm9y\nZWlnbkNhdGFsb2csIGZvcmVpZ25TY2hlbWEsIGZvcmVpZ25UYWJsZSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0\nRXhwb3J0ZWRLZXlzKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hLAog\nICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxlKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0RXhw\nb3J0ZWRLZXlzOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxv\nZyArICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAg\nICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmdldEV4cG9ydGVkS2V5cyhjYXRhbG9n\nLCBzY2hlbWEsIHRhYmxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIFJlc3VsdFNldCBnZXRJbXBvcnRlZEtleXMoU3RyaW5nIGNhdGFs\nb2csIFN0cmluZyBzY2hlbWEsCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFi\nbGUpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYg\nKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBf\nbG9ncy5sb2dKREJDKCJnZXRJbXBvcnRlZEtleXM6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYSArICIsICIg\nKyB0YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5l\nY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0\nSW1wb3J0ZWRLZXlzKGNhdGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldEluZGV4\nSW5mbyhTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYSwKICAgICAgICAg\nICAgICAgIFN0cmluZyB0YWJsZSwgYm9vbGVhbiB1bmlxdWUsIGJvb2xlYW4g\nYXBwcm94aW1hdGUpCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0SW5k\nZXhJbmZvOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyAr\nICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAg\nICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmdldEluZGV4SW5mbyhjYXRhbG9nLCBzY2hl\nbWEsIHRhYmxlLCB1bmlxdWUsCiAgICAgICAgICAgICAgICAgICAgYXBwcm94\naW1hdGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVz\ndWx0U2V0IGdldFByaW1hcnlLZXlzKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcg\nc2NoZW1hLAogICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxlKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pE\nQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRC\nQygiZ2V0UHJpbWFyeUtleXM6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYSArICIsICIgKyB0YWJsZSwKICAg\nICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJpbWFyeUtleXMo\nY2F0YWxvZywgc2NoZW1hLCB0YWJsZSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0UHJvY2VkdXJlQ29sdW1ucyhT\ndHJpbmcgY2F0YWxvZywKICAgICAgICAgICAgICAgIFN0cmluZyBzY2hlbWFQ\nYXR0ZXJuLCBTdHJpbmcgcHJvY2VkdXJlTmFtZVBhdHRlcm4sCiAgICAgICAg\nICAgICAgICBTdHJpbmcgY29sdW1uTmFtZVBhdHRlcm4pIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJn\nZXRQcm9jZWR1cmVDb2x1bW5zOiAiCiAgICAgICAgICAgICAgICAgICAgICAg\nICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWFQYXR0ZXJuICsgIiwgIgogICAg\nICAgICAgICAgICAgICAgICAgICArIHByb2NlZHVyZU5hbWVQYXR0ZXJuICsg\nIiwgIiArIGNvbHVtbk5hbWVQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAg\nICAgICBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBlci5nZXRQcm9jZWR1cmVDb2x1bW5zKGNhdGFsb2csIHNj\naGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFt\nZVBhdHRlcm4sIGNvbHVtbk5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRQcm9jZWR1cmVzKFN0\ncmluZyBjYXRhbG9nLAogICAgICAgICAgICAgICAgU3RyaW5nIHNjaGVtYVBh\ndHRlcm4sIFN0cmluZyBwcm9jZWR1cmVOYW1lUGF0dGVybikKICAgICAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\naWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9ncy5sb2dKREJDKCJnZXRQcm9jZWR1cmVzOiAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWFQYXR0ZXJu\nICsgIiwgIgogICAgICAgICAgICAgICAgICAgICAgICArIHByb2NlZHVyZU5h\nbWVQYXR0ZXJuLCBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBlci5nZXRQcm9jZWR1cmVzKGNhdGFsb2csIHNj\naGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFt\nZVBhdHRlcm4pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nUmVzdWx0U2V0IGdldFNjaGVtYXMoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0U2NoZW1hcyIs\nIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmdldFNjaGVtYXMoKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRUYWJsZVByaXZpbGVnZXMoU3Ry\naW5nIGNhdGFsb2csCiAgICAgICAgICAgICAgICBTdHJpbmcgc2NoZW1hUGF0\ndGVybiwgU3RyaW5nIHRhYmxlTmFtZVBhdHRlcm4pCiAgICAgICAgICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChf\nbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xv\nZ3MubG9nSkRCQygiZ2V0VGFibGVQcml2aWxlZ2VzIiwgTG9nZ2luZ0Nvbm5l\nY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0\nVGFibGVQcml2aWxlZ2VzKGNhdGFsb2csIHNjaGVtYVBhdHRlcm4sCiAgICAg\nICAgICAgICAgICAgICAgdGFibGVOYW1lUGF0dGVybik7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VGFibGVzKFN0\ncmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hUGF0dGVybiwKICAgICAgICAg\nICAgICAgIFN0cmluZyB0YWJsZU5hbWVQYXR0ZXJuLCBTdHJpbmdbXSB0eXBl\ncykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2dzLmxvZ0pEQkMoImdldFRhYmxlczogIgogICAgICAgICAgICAgICAgICAg\nICAgICArIGNhdGFsb2cgKyAiLCAiICsgc2NoZW1hUGF0dGVybiArICIsICIK\nICAgICAgICAgICAgICAgICAgICAgICAgKyB0YWJsZU5hbWVQYXR0ZXJuLCBM\nb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBzdXBlci5nZXRUYWJsZXMoY2F0YWxvZywgc2NoZW1hUGF0dGVybiwKICAg\nICAgICAgICAgICAgICAgICB0YWJsZU5hbWVQYXR0ZXJuLCB0eXBlcyk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0\nVGFibGVUeXBlcygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRUYWJsZVR5cGVzIiwgTG9nZ2lu\nZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuZ2V0VGFibGVUeXBlcygpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgUmVzdWx0U2V0IGdldFR5cGVJbmZvKCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdl\ndFR5cGVJbmZvIiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VHlwZUluZm8oKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBnZXRVRFRzKFN0\ncmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hUGF0dGVybiwKICAgICAgICAg\nICAgICAgIFN0cmluZyB0eXBlTmFtZVBhdHRlcm4sIGludFtdIHR5cGVzKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9n\ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3Mu\nbG9nSkRCQygiZ2V0VURUcyIsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFVEVHMoY2F0YWxvZywg\nc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZVBh\ndHRlcm4sIHR5cGVzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIFJlc3VsdFNldCBnZXRWZXJzaW9uQ29sdW1ucyhTdHJpbmcgY2F0YWxv\nZywKICAgICAgICAgICAgICAgIFN0cmluZyBzY2hlbWEsIFN0cmluZyB0YWJs\nZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2dzLmxvZ0pEQkMoImdldFZlcnNpb25Db2x1bW5zOiAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWEgKyAiLCAi\nICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25u\nZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdl\ndFZlcnNpb25Db2x1bW5zKGNhdGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBT\ndGF0ZW1lbnQgd3JhcHBlciB0aGF0IGxvZ3MgU1FMIHRvIHRoZSBwYXJlbnQg\nZGF0YSBzb3VyY2UgYW5kCiAgICAgICAgICogcmVtZW1iZXJzIHRoZSBsYXN0\nIHBpZWNlIG9mIFNRTCB0byBiZSBleGVjdXRlZCBvbiBpdC4KICAgICAgICAg\nKi8KICAgICAgICBwcml2YXRlIGNsYXNzIExvZ2dpbmdTdGF0ZW1lbnQgZXh0\nZW5kcyBEZWxlZ2F0aW5nU3RhdGVtZW50IHsKCiAgICAgICAgICAgIHByaXZh\ndGUgU3RyaW5nIF9zcWwgPSBudWxsOwoKICAgICAgICAgICAgcHVibGljIExv\nZ2dpbmdTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIHN1cGVyKHN0bW50LCBMb2dnaW5n\nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgYXBwZW5kSW5mbyhTdHJpbmdCdWZmZXIgYnVmKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX3NxbCAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChfZm9ybWF0dGVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZChTRVApOwogICAgICAgICAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKF9mb3JtYXR0ZXIucHJldHR5UHJpbnQoX3NxbCkpOwog\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoX3NxbCk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwcm90ZWN0ZWQgUmVzdWx0U2V0IHdyYXBSZXN1bHQoUmVzdWx0U2V0IHJz\nLCBib29sZWFuIHdyYXApIHsKICAgICAgICAgICAgICAgIGlmICghd3JhcCB8\nfCBycyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBl\nci53cmFwUmVzdWx0KHJzLCB3cmFwKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgTG9nZ2luZ1Jlc3VsdFNldChycywgdGhpcyk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNhbmNlbCgpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRC\nQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJD\nKCJjYW5jZWwgIiArIHRoaXMsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwog\nICAgICAgICAgICAgICAgc3VwZXIuY2FuY2VsKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5\nKFN0cmluZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgX3NxbCA9IHNx\nbDsKICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAg\nICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmV4ZWN1dGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgd3JhcChzZSwgTG9nZ2luZ1N0YXRlbWVudC50aGlz\nKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAgaGFu\nZGxlU1FMV2FybmluZyhMb2dnaW5nU3RhdGVtZW50LnRoaXMpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\naW50IGV4ZWN1dGVVcGRhdGUoU3RyaW5nIHNxbCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBfc3FsID0gc3FsOwogICAgICAgICAg\nICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFy\ndCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhl\nY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgd3Jh\ncChzZSwgTG9nZ2luZ1N0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFy\ndCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhMb2dn\naW5nU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBleGVjdXRlKFN0\ncmluZyBzcWwpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgX3NxbCA9IHNxbDsKICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsK\nICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRp\nbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGUoc3FsKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICAgICAgICAgIHRocm93IHdyYXAoc2UsIExvZ2dpbmdTdGF0ZW1lbnQudGhp\ncyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGhh\nbmRsZVNRTFdhcm5pbmcoTG9nZ2luZ1N0YXRlbWVudC50aGlzKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\ncHJpdmF0ZSBjbGFzcyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQKICAgICAg\nICAgICAgZXh0ZW5kcyBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQgewoK\nICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX3NxbDsKICAgICAg\nICAgICAgcHJpdmF0ZSBMaXN0IF9wYXJhbXMgPSBudWxsOwogICAgICAgICAg\nICBwcml2YXRlIExpc3QgX3BhcmFtQmF0Y2ggPSBudWxsOwoKICAgICAgICAg\nICAgcHVibGljIExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudChQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgU3RyaW5nIHNxbCkKICAgICAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc3VwZXIoc3Rt\nbnQsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAg\nX3NxbCA9IHNxbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJvdGVj\ndGVkIFJlc3VsdFNldCB3cmFwUmVzdWx0KFJlc3VsdFNldCBycywgYm9vbGVh\nbiB3cmFwKSB7CiAgICAgICAgICAgICAgICBpZiAoIXdyYXAgfHwgcnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIud3JhcFJl\nc3VsdChycywgd3JhcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExv\nZ2dpbmdSZXN1bHRTZXQocnMsIHRoaXMpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJp\nbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsK\nICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRp\nbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeShzcWwsIHdyYXAp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgTG9nZ2luZ1By\nZXBhcmVkU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAg\nICAgICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5nUHJl\ncGFyZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0\nZShTdHJpbmcgc3FsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3Rh\ncnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4\nZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IHdy\nYXAoc2UsIExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzKTsKICAgICAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9n\nVGltZShzdGFydCk7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJh\nbWV0ZXJzKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdh\ncm5pbmcoTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBleGVjdXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAgICAg\nICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gc3VwZXIuZXhlY3V0ZShzcWwpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgd3JhcChzZSwgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMp\nOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBjbGVh\nckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaGFu\nZGxlU1FMV2FybmluZyhMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcyk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KGJvb2xlYW4gd3Jh\ncCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dT\nUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnko\nd3JhcCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyB3cmFwKHNlLCBMb2dn\naW5nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQp\nOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dp\nbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGludCBleGVjdXRl\nVXBkYXRlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBsb2dTUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRl\nVXBkYXRlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyB3cmFwKHNlLCBM\nb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3Rh\ncnQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExv\nZ2dpbmdQcmVwYXJlZFN0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGludFtdIGV4\nZWN1dGVCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFy\ndCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhl\nY3V0ZUJhdGNoKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZXhj\nZXB0aW9uIGlzIGEgQmF0Y2hVcGRhdGVFeGNlcHRpb24sIGFuZAogICAgICAg\nICAgICAgICAgICAgIC8vIHdlIGFyZSB0cmFja2luZyBwYXJhbWV0ZXJzLCB0\naGVuIHNldCB0aGUgY3VycmVudAogICAgICAgICAgICAgICAgICAgIC8vIHBh\ncmFtZXRlciBzZXQgdG8gYmUgdGhlIGluZGV4IG9mIHRoZSBmYWlsZWQKICAg\nICAgICAgICAgICAgICAgICAvLyBzdGF0ZW1lbnQgc28gdGhhdCB0aGUgUmVw\nb3J0aW5nU1FMRXhjZXB0aW9uIHdpbGwKICAgICAgICAgICAgICAgICAgICAv\nLyBzaG93IHRoZSBjb3JyZWN0IHBhcmFtCiAgICAgICAgICAgICAgICAgICAg\naWYgKHNlIGluc3RhbmNlb2YgQmF0Y2hVcGRhdGVFeGNlcHRpb24KICAgICAg\nICAgICAgICAgICAgICAgICAgJiYgX3BhcmFtQmF0Y2ggIT0gbnVsbCAmJiBz\naG91bGRUcmFja1BhcmFtZXRlcnMoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpbnRbXSBjb3VudCA9ICgoQmF0Y2hVcGRhdGVFeGNlcHRpb24pIHNl\nKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldFVwZGF0ZUNvdW50\ncygpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgIT0gbnVs\nbCAmJiBjb3VudC5sZW5ndGggPD0gX3BhcmFtQmF0Y2guc2l6ZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpbnQgaW5kZXggPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY291bnQubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtMyBpcyBTdGF0\nZW1lbnQuU1RBVEVNRU5UX0ZBSUxFRCwgYnV0IGlzCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gb25seSBhdmFpbGFibGUgaW4gSkRLIDEu\nNCsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRb\naV0gPT0gLTMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaW5kZXggPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gLTMgZWxlbWVudDogaXQgbWF5IGJlIHRo\nYXQgdGhlIHNlcnZlciBzdG9wcGVkCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBwcm9jZXNzaW5nLCBzbyB0aGUgc2l6ZSBvZiB0aGUgY291bnQg\nd2lsbCBiZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGlu\nZGV4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0g\nLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBj\nb3VudC5sZW5ndGggKyAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIHNldCB0aGUgY3VycmVudCBwYXJhbXMgdG8gdGhlIHNhdmVkIHZhbHVl\ncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgX3Bh\ncmFtQmF0Y2guc2l6ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIF9wYXJhbXMgPSAoTGlzdCkgX3BhcmFtQmF0Y2guZ2V0KGluZGV4KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB0aHJvdyB3cmFwKHNlLCBMb2dnaW5n\nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwog\nICAgICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdQ\ncmVwYXJlZFN0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gZXhlY3V0\nZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9n\nU1FMKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3Rl\nbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZSgpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgTG9nZ2luZ1ByZXBh\ncmVkU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAg\nICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAg\nICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5nUHJlcGFy\nZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNhbmNlbCgpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlz\nSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dK\nREJDKCJjYW5jZWwgIiArIHRoaXMgKyAiOiAiICsgX3NxbCwKICAgICAgICAg\nICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CgogICAg\nICAgICAgICAgICAgc3VwZXIuY2FuY2VsKCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNldE51bGwoaW50IGkxLCBpbnQgaTIp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGkxLCAibnVsbCIsIG51bGwpOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0TnVsbChpMSwgaTIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzZXRCb29sZWFuKGludCBpLCBib29sZWFuIGIp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGksIGIpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0Qm9v\nbGVhbihpLCBiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgc2V0Qnl0ZShpbnQgaSwgYnl0ZSBiKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBiKTsK\nICAgICAgICAgICAgICAgIHN1cGVyLnNldEJ5dGUoaSwgYik7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldFNob3J0KGludCBp\nLCBzaG9ydCBzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpLCBzKTsKICAgICAgICAgICAgICAgIHN1\ncGVyLnNldFNob3J0KGksIHMpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXRJbnQoaW50IGkxLCBpbnQgaTIpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGkxLCBpMik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRJbnQoaTEsIGky\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0\nTG9uZyhpbnQgaSwgbG9uZyBsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBsKTsKICAgICAgICAg\nICAgICAgIHN1cGVyLnNldExvbmcoaSwgbCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNldEZsb2F0KGludCBpLCBmbG9hdCBm\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExv\nZ1BhcmFtZXRlcihpLCBmKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldEZs\nb2F0KGksIGYpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzZXREb3VibGUoaW50IGksIGRvdWJsZSBkKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCBk\nKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldERvdWJsZShpLCBkKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0QmlnRGVj\naW1hbChpbnQgaSwgQmlnRGVjaW1hbCBiZCkKICAgICAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFy\nYW1ldGVyKGksICJCaWdEZWNpbWFsIiwgYmQpOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0QmlnRGVjaW1hbChpLCBiZCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNldFN0cmluZyhpbnQgaSwgU3RyaW5n\nIHMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGksICJTdHJpbmciLCBzKTsKICAgICAgICAgICAgICAg\nIHN1cGVyLnNldFN0cmluZyhpLCBzKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2V0Qnl0ZXMoaW50IGksIGJ5dGVbXSBiKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1Bh\ncmFtZXRlcihpLCAiYnl0ZVtdIiwgYik7CiAgICAgICAgICAgICAgICBzdXBl\nci5zZXRCeXRlcyhpLCBiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2V0RGF0ZShpbnQgaSwgRGF0ZSBkKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihp\nLCAiRGF0ZSIsIGQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0RGF0ZShp\nLCBkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2V0VGltZShpbnQgaSwgVGltZSB0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZSIsIHQp\nOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0VGltZShpLCB0KTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1w\nKGludCBpLCBUaW1lc3RhbXAgdCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIlRpbWVzdGFtcCIs\nIHQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0VGltZXN0YW1wKGksIHQp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRB\nc2NpaVN0cmVhbShpbnQgaTEsIElucHV0U3RyZWFtIGlzLCBpbnQgaTIpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIklucHV0U3RyZWFtIiwgaXMp\nOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0QXNjaWlTdHJlYW0oaTEsIGlz\nLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHNldFVuaWNvZGVTdHJlYW0oaW50IGkxLCBJbnB1dFN0cmVhbSBpcywgaW50\nIGkyKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJJbnB1dFN0cmVh\nbSIsIGlzKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldFVuaWNvZGVTdHJl\nYW0oaTIsIGlzLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNldEJpbmFyeVN0cmVhbShpbnQgaTEsIElucHV0U3RyZWFt\nIGlzLCBpbnQgaTIpCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIklu\ncHV0U3RyZWFtIiwgaXMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0Qmlu\nYXJ5U3RyZWFtKGkxLCBpcywgaTIpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBjbGVhclBhcmFtZXRlcnMoKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVy\ncyhmYWxzZSk7CiAgICAgICAgICAgICAgICBzdXBlci5jbGVhclBhcmFtZXRl\ncnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2V0T2JqZWN0KGludCBpMSwgT2JqZWN0IG8sIGludCBpMiwgaW50IGkzKQog\nICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsICJPYmplY3QiLCBvKTsKICAg\nICAgICAgICAgICAgIHN1cGVyLnNldE9iamVjdChpMSwgbywgaTIsIGkzKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0T2Jq\nZWN0KGludCBpMSwgT2JqZWN0IG8sIGludCBpMikKICAgICAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGkxLCAiT2JqZWN0Iiwgbyk7CiAgICAgICAgICAgICAgICBz\ndXBlci5zZXRPYmplY3QoaTEsIG8sIGkyKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0T2JqZWN0KGludCBpLCBPYmplY3Qg\nbykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRM\nb2dQYXJhbWV0ZXIoaSwgIk9iamVjdCIsIG8pOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0T2JqZWN0KGksIG8pOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBhZGRCYXRjaCgpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ1NRTCgiYmF0Y2hpbmcg\nIiArIHRoaXMsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAg\nICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBz\ndXBlci5hZGRCYXRjaCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChzaG91\nbGRUcmFja1BhcmFtZXRlcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgb3VyIGxpc3QgaXMgaW5pdGlhbGl6ZWQKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKF9wYXJhbUJhdGNoID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyYW1CYXRjaCA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29weSBw\nYXJhbWV0ZXJzIHNpbmNlIHRoZXkgd2lsbCBiZSByZS11c2VkCiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChfcGFyYW1zICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBfcGFyYW1CYXRjaC5hZGQobmV3IEFycmF5\nTGlzdChfcGFyYW1zKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmFkZChu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAg\nICBsb2dUaW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0Q2hhcmFjdGVyU3Ry\nZWFtKGludCBpMSwgUmVhZGVyIHIsIGludCBpMikKICAgICAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGkxLCAiUmVhZGVyIiwgcik7CiAgICAgICAgICAgICAgICBz\ndXBlci5zZXRDaGFyYWN0ZXJTdHJlYW0oaTEsIHIsIGkyKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0UmVmKGludCBpLCBS\nZWYgcikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBz\nZXRMb2dQYXJhbWV0ZXIoaSwgIlJlZiIsIHIpOwogICAgICAgICAgICAgICAg\nc3VwZXIuc2V0UmVmKGksIHIpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXRCbG9iKGludCBpLCBCbG9iIGIpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGksICJCbG9iIiwgYik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRCbG9i\nKGksIGIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzZXRDbG9iKGludCBpLCBDbG9iIGMpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJDbG9iIiwg\nYyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRDbG9iKGksIGMpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRBcnJheShp\nbnQgaSwgQXJyYXkgYSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIkFycmF5IiwgYSk7CiAgICAg\nICAgICAgICAgICBzdXBlci5zZXRBcnJheShpLCBhKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldE1ldGFEYXRhIGdldE1l\ndGFEYXRhKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3VwZXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0RGF0ZShpbnQgaSwgRGF0ZSBk\nLCBDYWxlbmRhciBjKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiRGF0ZSIsIGQpOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0RGF0ZShpLCBkLCBjKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZShpbnQgaSwgVGlt\nZSB0LCBDYWxlbmRhciBjKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZSIsIHQpOwogICAg\nICAgICAgICAgICAgc3VwZXIuc2V0VGltZShpLCB0LCBjKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1wKGlu\ndCBpLCBUaW1lc3RhbXAgdCwgQ2FsZW5kYXIgYykKICAgICAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGksICJUaW1lc3RhbXAiLCB0KTsKICAgICAgICAgICAgICAg\nIHN1cGVyLnNldFRpbWVzdGFtcChpLCB0LCBjKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0TnVsbChpbnQgaTEsIGludCBp\nMiwgU3RyaW5nIHMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAibnVsbCIsIG51bGwpOwogICAg\nICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChpMSwgaTIsIHMpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRJbmZv\nKFN0cmluZ0J1ZmZlciBidWYpIHsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiAiKTsKICAgICAgICAgICAgICAgIGlmIChfZm9ybWF0dGVyICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKFNFUCk7CiAg\nICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfZm9ybWF0dGVyLnByZXR0\neVByaW50KF9zcWwpKTsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKFNFUCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoX3NxbCk7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgU3RyaW5nQnVmZmVyIHBhcmFtQnVmID0gbnVsbDsK\nICAgICAgICAgICAgICAgIGlmIChfcGFyYW1zICE9IG51bGwgJiYgIV9wYXJh\nbXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1CdWYg\nPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBfcGFyYW1zLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtQnVmLmFw\ncGVuZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBw\nYXJhbUJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChwYXJhbUJ1\nZiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfcHJldHR5\nUHJpbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAi\nKTsKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCJbcGFyYW1zPSIp\nLgogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQocGFyYW1CdWYudG9T\ndHJpbmcoKSkuYXBwZW5kKCJdIik7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBzdXBlci5hcHBlbmRJbmZvKGJ1Zik7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBjbGVhckxvZ1BhcmFtZXRl\ncnMoYm9vbGVhbiBiYXRjaCkgewogICAgICAgICAgICAgICAgaWYgKF9wYXJh\nbXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcGFyYW1zLmNsZWFy\nKCk7CiAgICAgICAgICAgICAgICBpZiAoYmF0Y2ggJiYgX3BhcmFtQmF0Y2gg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcGFyYW1CYXRjaC5jbGVh\ncigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIGJvb2xl\nYW4gc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIF90cmFja1BhcmFtZXRlcnMgfHwgX2xvZ3MuaXNTUUxFbmFibGVk\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBz\nZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBib29sZWFuIHZhbCkgewogICAg\nICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFyYW1ldGVycygpKQogICAg\nICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRlcihpbmRleCwgIihib29s\nZWFuKSAiICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJp\ndmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIGJ5dGUgdmFs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJz\nKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4\nLCAiKGJ5dGUpICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwgZG91\nYmxlIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFy\nYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRl\ncihpbmRleCwgIihkb3VibGUpICIgKyB2YWwpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBp\nbmRleCwgZmxvYXQgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxk\nVHJhY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGluZGV4LCAiKGZsb2F0KSAiICsgdmFsKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRl\ncihpbnQgaW5kZXgsIGludCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChz\naG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBz\nZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoaW50KSAiICsgdmFsKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFt\nZXRlcihpbnQgaW5kZXgsIGxvbmcgdmFsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAg\nICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAiKGxvbmcpICIgKyB2YWwpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9n\nUGFyYW1ldGVyKGludCBpbmRleCwgc2hvcnQgdmFsKSB7CiAgICAgICAgICAg\nICAgICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAg\nICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAiKHNob3J0KSAiICsg\ndmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lk\nIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgsIFN0cmluZyB0eXBlLCBPYmpl\nY3QgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJh\nbWV0ZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGluZGV4LCAiKCIgKyB0eXBlICsgIikgIiArIHZhbCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIo\naW50IGluZGV4LCBTdHJpbmcgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX3BhcmFtcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9wYXJhbXMg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoX3Bh\ncmFtcy5zaXplKCkgPCBpbmRleCkKICAgICAgICAgICAgICAgICAgICBfcGFy\nYW1zLmFkZChudWxsKTsKICAgICAgICAgICAgICAgIGlmICh2YWwubGVuZ3Ro\nKCkgPiA4MCkKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3Ry\naW5nKDAsIDc3KSArICIuLi4iOwogICAgICAgICAgICAgICAgX3BhcmFtcy5z\nZXQoaW5kZXggLSAxLCB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBXYXJuaW5nLWhhbmRsaW5nIHJlc3Vs\ndCBzZXQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBjbGFzcyBMb2dn\naW5nUmVzdWx0U2V0IGV4dGVuZHMgRGVsZWdhdGluZ1Jlc3VsdFNldCB7Cgog\nICAgICAgICAgICBwdWJsaWMgTG9nZ2luZ1Jlc3VsdFNldChSZXN1bHRTZXQg\ncnMsIFN0YXRlbWVudCBzdG1udCkgewogICAgICAgICAgICAgICAgc3VwZXIo\ncnMsIHN0bW50KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIGJvb2xlYW4gbmV4dCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\nZXIubmV4dCgpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdSZXN1bHRT\nZXQudGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHN1cGVyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2lu\nZ1Jlc3VsdFNldC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgYmVmb3JlRmlyc3QoKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgc3VwZXIuYmVmb3JlRmlyc3QoKTsKICAgICAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgaGFu\nZGxlU1FMV2FybmluZyhMb2dnaW5nUmVzdWx0U2V0LnRoaXMpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBhZnRlckxhc3QoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc3VwZXIuYWZ0\nZXJMYXN0KCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2luZ1Jlc3VsdFNl\ndC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIGJvb2xlYW4gZmlyc3QoKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLmZpcnN0KCk7CiAgICAgICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5p\nbmcoTG9nZ2luZ1Jlc3VsdFNldC50aGlzKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gbGFz\ndCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIubGFzdCgpOwog\nICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAg\nICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdSZXN1bHRTZXQudGhpcyk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGFic29sdXRlKGludCBhKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmFic29sdXRlKGEpOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJu\naW5nKExvZ2dpbmdSZXN1bHRTZXQudGhpcyk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIHJl\nbGF0aXZlKGludCBhKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLnJlbGF0aXZlKGEpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdSZXN1\nbHRTZXQudGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIHByZXZpb3VzKCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBlci5wcmV2aW91cygpOwogICAgICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBoYW5k\nbGVTUUxXYXJuaW5nKExvZ2dpbmdSZXN1bHRTZXQudGhpcyk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

