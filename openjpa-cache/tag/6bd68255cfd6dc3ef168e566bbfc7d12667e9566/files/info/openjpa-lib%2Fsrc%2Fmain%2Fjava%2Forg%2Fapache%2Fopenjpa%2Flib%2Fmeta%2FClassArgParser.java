{"sha":"4c9526c6822a0bbd41fadc2605ed2fe672871fed","node_id":"MDQ6QmxvYjIwNjM2NDo0Yzk1MjZjNjgyMmEwYmJkNDFmYWRjMjYwNWVkMmZlNjcyODcxZmVk","size":21547,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4c9526c6822a0bbd41fadc2605ed2fe672871fed","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGE7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uRmlsZTsK\naW1wb3J0IGphdmEuaW8uRmlsZUlucHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5GaWxlTm90Rm91bmRFeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLkZpbGVS\nZWFkZXI7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1S\nZWFkZXI7CmltcG9ydCBqYXZhLmlvLlJlYWRlcjsKaW1wb3J0IGphdmEuc2Vj\ndXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJsZVJ1bnRpbWVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJE\nb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgc2VycC5ieXRlY29kZS5sb3dsZXZlbC5D\nb25zdGFudFBvb2xUYWJsZTsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoK\nLyoqCiAqIFBhcnNlciB1c2VkIHRvIHJlc29sdmUgYXJndW1lbnRzIGludG8g\namF2YSBjbGFzc2VzLgogKiBJbnRlcnByZXRzIGNvbW1hbmQtbGluZSBhcmdz\nIGFzIGVpdGhlciBjbGFzcyBuYW1lcywgLmNsYXNzIGZpbGVzIG9yCiAqIHJl\nc291cmNlcywgLmphdmEgZmlsZXMgb3IgcmVzb3VyY2VzLCBvciBtZXRhZGF0\nYSBmaWxlcyBvciByZXNvdXJjZXMKICogY29uZm9ybWluZyB0byB0aGUgY29t\nbW9uIGZvcm1hdCBkZWZpbmVkIGJ5IHtAbGluayBDRk1ldGFEYXRhUGFyc2Vy\nfS4KICogVHJhbnNmb3JtcyB0aGUgaW5mb3JtYXRpb24gaW4gdGhlc2UgYXJn\ncyBpbnRvIHtAbGluayBDbGFzc30gaW5zdGFuY2VzLgogKiBOb3RlIHRoYXQg\nd2hlbiBwYXJzaW5nIC5qYXZhIGZpbGVzLCBvbmx5IHRoZSBtYWluIGNsYXNz\nIGluIHRoZSBmaWxlCiAqIGlzIGRldGVjdGVkLiBPdGhlciBjbGFzc2VzIGRl\nZmluZWQgaW4gdGhlIGZpbGUsIHN1Y2ggYXMgaW5uZXIgY2xhc3NlcywKICog\nYXJlIG5vdCBhZGRlZCB0byB0aGUgcmV0dXJuZWQgY2xhc3NlcyBsaXN0Lgog\nKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgQ2xhc3NBcmdQYXJzZXIgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBUT0tFTl9FT0YgPSAtMTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBUT0tFTl9OT05FID0gMDsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBUT0tFTl9QQUNLQUdFID0gMTsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBUT0tFTl9DTEFTUyA9IDI7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgVE9LRU5fUEFDS0FHRV9OT0FUVFIgPSAzOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFRPS0VOX0NMQVNTX05PQVRUUiA9\nIDQ7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChDbGFzc0FyZ1BhcnNl\nci5jbGFzcyk7CgogICAgcHJpdmF0ZSBDbGFzc0xvYWRlciBfbG9hZGVyID0g\nbnVsbDsKICAgIHByaXZhdGUgY2hhcltdIF9wYWNrYWdlQXR0ciA9ICJuYW1l\nIi50b0NoYXJBcnJheSgpOwogICAgcHJpdmF0ZSBjaGFyW10gX2NsYXNzQXR0\nciA9ICJuYW1lIi50b0NoYXJBcnJheSgpOwogICAgcHJpdmF0ZSBjaGFyW11b\nXSBfYmVnaW5FbGVtZW50cyA9IHsgeyAncCcgfSwgeyAnYycgfSB9OwogICAg\ncHJpdmF0ZSBjaGFyW11bXSBfZW5kRWxlbWVudHMgPSB7ICJhY2thZ2UiLnRv\nQ2hhckFycmF5KCksCiAgICAgICAgImxhc3MiLnRvQ2hhckFycmF5KCkgfTsK\nCiAgICAvKioKICAgICAqIFRoZSBjbGFzcyBsb2FkZXIgd2l0aCB3aGljaCB0\nbyBsb2FkIHBhcnNlZCBjbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NMb2FkZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgbG9hZGVy\nIHdpdGggd2hpY2ggdG8gbG9hZCBwYXJzZWQgY2xhc3Nlcy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgX2xvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgdGhlIHJlbGV2YW50IG1ldGFkYXRhIGZpbGUg\nc3RydWN0dXJlIHNvIHRoYXQgbWV0YWRhdGEgZmlsZXMKICAgICAqIGNvbnRh\naW5pbmcgY2xhc3MgbmFtZXMgY2FuIGJlIHBhcnNlZC4gTnVsbCBhdHRyaWJ1\ndGUgbmFtZXMgaW5kaWNhdGUKICAgICAqIHRoYXQgdGhlIHRleHQgY29udGVu\ndCBvZiB0aGUgZWxlbWVudCBjb250YWlucyB0aGUgZGF0YS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGFTdHJ1Y3R1cmUoU3RyaW5nIHBh\nY2thZ2VFbGVtZW50TmFtZSwKICAgICAgICBTdHJpbmcgcGFja2FnZUF0dHJp\nYnV0ZU5hbWUsIFN0cmluZ1tdIGNsYXNzRWxlbWVudE5hbWVzLAogICAgICAg\nIFN0cmluZyBjbGFzc0F0dHJpYnV0ZU5hbWUpIHsKICAgICAgICAvLyBjYWxj\ndWxhdGUgaG93IG1hbnkgY2hhcnMgZGVlcCB3ZSBoYXZlIHRvIGdvIHRvIGlk\nZW50aWZ5IGVhY2ggZWxlbWVudAogICAgICAgIC8vIG5hbWUgYXMgdW5pcXVl\nLiAgdGhpcyBpcyBleHRyZW1lbHkgaW5lZmZpY2llbnQgZm9yIGxhcmdlIE4s\nIGJ1dAogICAgICAgIC8vIHNob3VsZCBuZXZlciBiZSBjYWxsZWQgZm9yIG1v\ncmUgdGhhbiBhIGZldyBlbGVtZW50cwogICAgICAgIGNoYXJbXSBidWYgPSBu\nZXcgY2hhcltjbGFzc0VsZW1lbnROYW1lcy5sZW5ndGggKyAxXTsKICAgICAg\nICBpbnQgY2hhcklkeCA9IDA7CiAgICAgICAgZm9yICg7IHRydWU7IGNoYXJJ\nZHgrKykgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJ1Zi5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGkgPT0gMCkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChjaGFySWR4ID09IHBhY2thZ2VFbGVt\nZW50TmFtZS5sZW5ndGgoKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoImNhbnQtZGlmZi1lbGVt\ncyIpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAgYnVmW2ld\nID0gcGFja2FnZUVsZW1lbnROYW1lLmNoYXJBdChjaGFySWR4KTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNo\nYXJJZHggPT0gY2xhc3NFbGVtZW50TmFtZXNbaSAtIDFdLmxlbmd0aCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRP\ncGVyYXRpb25FeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICgiY2FudC1kaWZmLWVsZW1zIikuZ2V0TWVzc2FnZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBidWZbaV0gPSBjbGFzc0VsZW1lbnROYW1l\nc1tpIC0gMV0uY2hhckF0KGNoYXJJZHgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGFyc1VuaXF1ZShidWYp\nKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBf\ncGFja2FnZUF0dHIgPSAocGFja2FnZUF0dHJpYnV0ZU5hbWUgPT0gbnVsbCkg\nPyBudWxsCiAgICAgICAgICAgIDogcGFja2FnZUF0dHJpYnV0ZU5hbWUudG9D\naGFyQXJyYXkoKTsKICAgICAgICBfY2xhc3NBdHRyID0gKGNsYXNzQXR0cmli\ndXRlTmFtZSA9PSBudWxsKSA/IG51bGwKICAgICAgICAgICAgOiBjbGFzc0F0\ndHJpYnV0ZU5hbWUudG9DaGFyQXJyYXkoKTsKICAgICAgICBfYmVnaW5FbGVt\nZW50cyA9IG5ldyBjaGFyW2NsYXNzRWxlbWVudE5hbWVzLmxlbmd0aCArIDFd\nW107CiAgICAgICAgX2VuZEVsZW1lbnRzID0gbmV3IGNoYXJbY2xhc3NFbGVt\nZW50TmFtZXMubGVuZ3RoICsgMV1bXTsKICAgICAgICBfYmVnaW5FbGVtZW50\nc1swXSA9IHBhY2thZ2VFbGVtZW50TmFtZS5zdWJzdHJpbmcoMCwgY2hhcklk\neCArIDEpLgogICAgICAgICAgICB0b0NoYXJBcnJheSgpOwogICAgICAgIF9l\nbmRFbGVtZW50c1swXSA9IHBhY2thZ2VFbGVtZW50TmFtZS5zdWJzdHJpbmco\nY2hhcklkeCArIDEpLgogICAgICAgICAgICB0b0NoYXJBcnJheSgpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2xhc3NFbGVtZW50TmFtZXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgX2JlZ2luRWxlbWVudHNbaSArIDFd\nID0gY2xhc3NFbGVtZW50TmFtZXNbaV0uCiAgICAgICAgICAgICAgICBzdWJz\ndHJpbmcoMCwgY2hhcklkeCArIDEpLnRvQ2hhckFycmF5KCk7CiAgICAgICAg\nICAgIF9lbmRFbGVtZW50c1tpICsgMV0gPSBjbGFzc0VsZW1lbnROYW1lc1tp\nXS4KICAgICAgICAgICAgICAgIHN1YnN0cmluZyhjaGFySWR4ICsgMSkudG9D\naGFyQXJyYXkoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiBhbGwgY2hhcmFjdGVycyBpbiBnaXZlbiBidWZmZXIg\nYXJlIHVuaXF1ZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVh\nbiBjaGFyc1VuaXF1ZShjaGFyW10gYnVmKSB7CiAgICAgICAgZm9yIChpbnQg\naSA9IGJ1Zi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCBpOyBqKyspCiAgICAgICAgICAgICAgICBp\nZiAoYnVmW2pdID09IGJ1ZltpXSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBDbGFzc30gcmVwcmVzZW50YXRp\nb24gb2YgdGhlIGNsYXNzKGVzKSBuYW1lZCBpbiB0aGUKICAgICAqIGdpdmVu\nIGFyZy4KICAgICAqCiAgICAgKiBAcGFyYW0gYXJnIGEgY2xhc3MgbmFtZSwg\nLmphdmEgZmlsZSwgLmNsYXNzIGZpbGUsIG9yIG1ldGFkYXRhCiAgICAgKiBm\naWxlIG5hbWluZyB0aGUgdHlwZShzKSB0byBhY3Qgb24KICAgICAqLwogICAg\ncHVibGljIENsYXNzW10gcGFyc2VUeXBlcyhTdHJpbmcgYXJnKSB7CiAgICAg\nICAgU3RyaW5nW10gbmFtZXMgPSBwYXJzZVR5cGVOYW1lcyhhcmcpOwogICAg\nICAgIENsYXNzW10gb2JqcyA9IG5ldyBDbGFzc1tuYW1lcy5sZW5ndGhdOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIG9ianNbaV0gPSBTdHJpbmdzLnRvQ2xhc3MobmFtZXNb\naV0sIF9sb2FkZXIpOwogICAgICAgIHJldHVybiBvYmpzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSB7QGxpbmsgQ2xhc3N9IHJlcHJlc2Vu\ndGF0aW9uIG9mIHRoZSBjbGFzcyhlcykgbmFtZWQgaW4gdGhlCiAgICAgKiBn\naXZlbiBtZXRhZGF0YXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1tdIHBh\ncnNlVHlwZXMoTWV0YURhdGFJdGVyYXRvciBpdHIpIHsKICAgICAgICBTdHJp\nbmdbXSBuYW1lcyA9IHBhcnNlVHlwZU5hbWVzKGl0cik7CiAgICAgICAgQ2xh\nc3NbXSBvYmpzID0gbmV3IENsYXNzW25hbWVzLmxlbmd0aF07CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgb2Jqc1tpXSA9IFN0cmluZ3MudG9DbGFzcyhuYW1lc1tpXSwgX2xv\nYWRlcik7CiAgICAgICAgcmV0dXJuIG9ianM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBtYXBwaW5nIG9mIGVhY2ggbWV0YWRhdGEgcmVzb3Vy\nY2UgdG8gYW4gYXJyYXkgb2YgaXRzCiAgICAgKiBjb250YWluZWQgY2xhc3Nl\ncy4KICAgICAqLwogICAgcHVibGljIE1hcCBtYXBUeXBlcyhNZXRhRGF0YUl0\nZXJhdG9yIGl0cikgewogICAgICAgIE1hcCBtYXAgPSBtYXBUeXBlTmFtZXMo\naXRyKTsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgU3RyaW5n\nW10gbmFtZXM7CiAgICAgICAgQ2xhc3NbXSBvYmpzOwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaSA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGkuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGku\nbmV4dCgpOwogICAgICAgICAgICBuYW1lcyA9IChTdHJpbmdbXSkgZW50cnku\nZ2V0VmFsdWUoKTsKICAgICAgICAgICAgb2JqcyA9IG5ldyBDbGFzc1tuYW1l\ncy5sZW5ndGhdOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IG5h\nbWVzLmxlbmd0aDsgaisrKQogICAgICAgICAgICAgICAgb2Jqc1tqXSA9IFN0\ncmluZ3MudG9DbGFzcyhuYW1lc1tqXSwgX2xvYWRlcik7CiAgICAgICAgICAg\nIGVudHJ5LnNldFZhbHVlKG9ianMpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbWFwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuYW1l\ncyBvZiB0aGUgY2xhc3MoZXMpIGZyb20gdGhlIGdpdmVuIGFyZy4KICAgICAq\nCiAgICAgKiBAcGFyYW0gYXJnIGEgY2xhc3MgbmFtZSwgLmphdmEgZmlsZSwg\nLmNsYXNzIGZpbGUsIG9yIG1ldGFkYXRhCiAgICAgKiBmaWxlIG5hbWluZyB0\naGUgdHlwZShzKSB0byBhY3Qgb24KICAgICAqIEB0aHJvd3MgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uIHdpdGggYXBwcm9wcmlhdGUgbWVzc2FnZSBvbiBl\ncnJvcgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gcGFyc2VUeXBlTmFt\nZXMoU3RyaW5nIGFyZykgewogICAgICAgIGlmIChhcmcgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CgogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIEZpbGUgZmlsZSA9IEZpbGVzLmdldEZpbGUoYXJnLCBf\nbG9hZGVyKTsKICAgICAgICAgICAgaWYgKGFyZy5lbmRzV2l0aCgiLmNsYXNz\nIikpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBnZXRG\ncm9tQ2xhc3NGaWxlKGZpbGUpIH07CiAgICAgICAgICAgIGlmIChhcmcuZW5k\nc1dpdGgoIi5qYXZhIikpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0\ncmluZ1tdeyBnZXRGcm9tSmF2YUZpbGUoZmlsZSkgfTsKICAgICAgICAgICAg\naWYgKCgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5leGlzdHNBY3Rpb24o\nZmlsZSkpKS5ib29sZWFuVmFsdWUoKSkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbiBjb2wgPSBnZXRGcm9tTWV0YURhdGFGaWxlKGZpbGUpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIChTdHJpbmdbXSkgY29sLnRvQXJyYXkobmV3\nIFN0cmluZ1tjb2wuc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgX2xv\nYy5nZXQoImNsYXNzLWFyZyIsIGFyZykuZ2V0TWVzc2FnZSgpLCBlKTsKICAg\nICAgICB9CgogICAgICAgIC8vIG11c3QgYmUgYSBjbGFzcyBuYW1lCiAgICAg\nICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYXJnIH07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIG5hbWVzIG9mIHRoZSBjbGFzcyhlcykgZnJv\nbSB0aGUgZ2l2ZW4gbWV0YWRhdGFzLgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nW10gcGFyc2VUeXBlTmFtZXMoTWV0YURhdGFJdGVyYXRvciBpdHIpIHsK\nICAgICAgICBpZiAoaXRyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgU3RyaW5nWzBdOwoKICAgICAgICBMaXN0IG5hbWVzID0gbmV3IEFycmF5\nTGlzdCgpOwogICAgICAgIE9iamVjdCBzb3VyY2UgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAg\nICAgICAgICAgICAgICBzb3VyY2UgPSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgYXBwZW5kVHlwZU5hbWVzKHNvdXJjZSwgaXRyLmdldElucHV0U3Ry\nZWFtKCksIG5hbWVzKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOZXN0YWJs\nZVJ1bnRpbWVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICBfbG9jLmdldCgi\nY2xhc3MtYXJnIiwgc291cmNlKS5nZXRNZXNzYWdlKCksIGUpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gKFN0cmluZ1tdKSBuYW1lcy50b0FycmF5KG5l\ndyBTdHJpbmdbbmFtZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSB0aGUgbmFtZXMgaW4gdGhlIGdpdmVuIG1ldGFkYXRhIGl0ZXJh\ndG9yIHN0cmVhbSwgY2xvc2luZyB0aGUKICAgICAqIHN0cmVhbSBvbiBjb21w\nbGV0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kVHlwZU5h\nbWVzKE9iamVjdCBzb3VyY2UsIElucHV0U3RyZWFtIGluLCBMaXN0IG5hbWVz\nKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKHNvdXJjZS50b1N0cmluZygpLmVuZHNXaXRoKCIu\nY2xhc3MiKSkKICAgICAgICAgICAgICAgIG5hbWVzLmFkZChnZXRGcm9tQ2xh\nc3MoaW4pKTsKICAgICAgICAgICAgbmFtZXMuYWRkQWxsKGdldEZyb21NZXRh\nRGF0YShuZXcgSW5wdXRTdHJlYW1SZWFkZXIoaW4pKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlu\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlv\nZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgbWFwcGluZyBvZiBlYWNoIG1ldGFkYXRhIHJlc291\ncmNlIHRvIGFuIGFycmF5IG9mIGl0cyBjb250YWluZWQKICAgICAqIGNsYXNz\nIG5hbWVzLgogICAgICovCiAgICBwdWJsaWMgTWFwIG1hcFR5cGVOYW1lcyhN\nZXRhRGF0YUl0ZXJhdG9yIGl0cikgewogICAgICAgIGlmIChpdHIgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX01BUDsK\nCiAgICAgICAgTWFwIG1hcCA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgT2Jq\nZWN0IHNvdXJjZSA9IG51bGw7CiAgICAgICAgTGlzdCBuYW1lcyA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAo\naXRyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgc291cmNlID0gaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGFwcGVuZFR5cGVOYW1lcyhzb3Vy\nY2UsIGl0ci5nZXRJbnB1dFN0cmVhbSgpLCBuYW1lcyk7CiAgICAgICAgICAg\nICAgICBpZiAoIW5hbWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAg\nICBtYXAucHV0KHNvdXJjZSwgKFN0cmluZ1tdKSBuYW1lcy50b0FycmF5CiAg\nICAgICAgICAgICAgICAgICAgICAgIChuZXcgU3RyaW5nW25hbWVzLnNpemUo\nKV0pKTsKICAgICAgICAgICAgICAgIG5hbWVzLmNsZWFyKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgX2xvYy5nZXQoImNsYXNzLWFyZyIsIHNvdXJjZSkuZ2V0\nTWVzc2FnZSgpLCBlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1hcDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNzIG5hbWVk\nIGluIHRoZSBnaXZlbiAuY2xhc3MgZmlsZS4KICAgICAqLwogICAgcHJpdmF0\nZSBTdHJpbmcgZ2V0RnJvbUNsYXNzRmlsZShGaWxlIGZpbGUpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZUlucHV0U3RyZWFtIGZpbiA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluID0gKEZpbGVJbnB1\ndFN0cmVhbSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdGaWxlSW5wdXRTdHJlYW1B\nY3Rpb24oZmlsZSkpOwogICAgICAgICAgICByZXR1cm4gZ2V0RnJvbUNsYXNz\nKGZpbik7CiAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbiBwYWUpIHsKICAgICAgICAgICAgdGhyb3cgKEZpbGVOb3RGb3VuZEV4\nY2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChmaW4gIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZmluLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBjbGFzcyBuYW1lIGluIHRoZSBnaXZlbiAuY2xhc3Mg\nYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEZyb21D\nbGFzcyhJbnB1dFN0cmVhbSBpbikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBDb25zdGFudFBvb2xUYWJsZSB0YWJsZSA9IG5ldyBDb25zdGFudFBv\nb2xUYWJsZShpbik7CiAgICAgICAgaW50IGlkeCA9IHRhYmxlLmdldEVuZElu\nZGV4KCk7CiAgICAgICAgaWR4ICs9IDI7IC8vIGFjY2VzcyBmbGFncwogICAg\nICAgIGludCBjbHNFbnRyeSA9IHRhYmxlLnJlYWRVbnNpZ25lZFNob3J0KGlk\neCk7CiAgICAgICAgaW50IHV0ZkVudHJ5ID0gdGFibGUucmVhZFVuc2lnbmVk\nU2hvcnQodGFibGUuZ2V0KGNsc0VudHJ5KSk7CiAgICAgICAgcmV0dXJuIHRh\nYmxlLnJlYWRTdHJpbmcodGFibGUuZ2V0KHV0ZkVudHJ5KSkucmVwbGFjZSgn\nLycsICcuJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBj\nbGFzcyBuYW1lZCBpbiB0aGUgZ2l2ZW4gLmphdmEgZmlsZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBTdHJpbmcgZ2V0RnJvbUphdmFGaWxlKEZpbGUgZmlsZSkg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBCdWZmZXJlZFJlYWRlciBp\nbiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gZmluZCB0\naGUgbGluZSB3aXRoIHRoZSBwYWNrYWdlIGRlY2xhcmF0aW9uCiAgICAgICAg\nICAgIGluID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBGaWxlUmVhZGVyKGZp\nbGUpKTsKICAgICAgICAgICAgU3RyaW5nIGxpbmU7CiAgICAgICAgICAgIFN0\ncmluZ0J1ZmZlciBwYWNrID0gbnVsbDsKICAgICAgICAgICAgd2hpbGUgKChs\naW5lID0gaW4ucmVhZExpbmUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgbGluZSA9IGxpbmUudHJpbSgpOwogICAgICAgICAgICAgICAgaWYgKGxp\nbmUuc3RhcnRzV2l0aCgicGFja2FnZSAiKSkgewogICAgICAgICAgICAgICAg\nICAgIGxpbmUgPSBsaW5lLnN1YnN0cmluZyg4KS50cmltKCk7CgogICAgICAg\nICAgICAgICAgICAgIC8vIHN0cmlwIG9mZiBhbnl0aGluZyBiZXlvbmQgdGhl\nIHBhY2thZ2UgZGVjbGFyYXRpb24KICAgICAgICAgICAgICAgICAgICBwYWNr\nID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbGluZS5sZW5ndGgoKTsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChDaGFyYWN0ZXIuaXNKYXZhSWRlbnRp\nZmllclBhcnQobGluZS5jaGFyQXQoaSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB8fCBsaW5lLmNoYXJBdChpKSA9PSAnLicpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwYWNrLmFwcGVuZChsaW5lLmNoYXJBdChpKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gc3RyaXAgJy5qYXZhJwogICAg\nICAgICAgICBTdHJpbmcgY2xzTmFtZSA9IGZpbGUuZ2V0TmFtZSgpOwogICAg\nICAgICAgICBjbHNOYW1lID0gY2xzTmFtZS5zdWJzdHJpbmcoMCwgY2xzTmFt\nZS5sZW5ndGgoKSAtIDUpOwoKICAgICAgICAgICAgLy8gcHJlZml4IHdpdGgg\ncGFja2FnZQogICAgICAgICAgICBpZiAocGFjayAhPSBudWxsICYmIHBhY2su\nbGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAgY2xzTmFtZSA9IHBhY2sg\nKyAiLiIgKyBjbHNOYW1lOwoKICAgICAgICAgICAgcmV0dXJuIGNsc05hbWU7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGluICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgeyBpbi5jbG9zZSgpOyB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBpb2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0aGUgY2xhc3NlcyBuYW1lZCBpbiB0aGUgZ2l2\nZW4gY29tbW9uIGZvcm1hdCBtZXRhZGF0YSBmaWxlLgogICAgICovCiAgICBw\ncml2YXRlIENvbGxlY3Rpb24gZ2V0RnJvbU1ldGFEYXRhRmlsZShGaWxlIGZp\nbGUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZVJlYWRlciBp\nbiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW4gPSBuZXcg\nRmlsZVJlYWRlcihmaWxlKTsKICAgICAgICAgICAgcmV0dXJuIGdldEZyb21N\nZXRhRGF0YShpbik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKGluICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIGluLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjbGFz\nc2VzIG5hbWVkIGluIHRoZSBnaXZlbiBjb21tb24gZm9ybWF0IG1ldGFkYXRh\nIHN0cmVhbS4KICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIGdldEZy\nb21NZXRhRGF0YShSZWFkZXIgeG1sKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIENvbGxlY3Rpb24gbmFtZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAg\nICAgICAgQnVmZmVyZWRSZWFkZXIgaW4gPSBuZXcgQnVmZmVyZWRSZWFkZXIo\neG1sKTsKCiAgICAgICAgYm9vbGVhbiBjb21tZW50ID0gZmFsc2U7CiAgICAg\nICAgaW50IHRva2VuID0gVE9LRU5fTk9ORTsKICAgICAgICBTdHJpbmcgcGtn\nID0gIiI7CiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgcmVhZDoKICAg\nICAgICBmb3IgKGludCBjaCA9IDAsIGxhc3QgPSAwLCBsYXN0MiA9IDA7CiAg\nICAgICAgICAgIGNoID09ICc8JyB8fCAoY2ggPSBpbi5yZWFkKCkpICE9IC0x\nOyBsYXN0MiA9IGxhc3QsIGxhc3QgPSBjaCkgewogICAgICAgICAgICAvLyBo\nYW5kbGUgY29tbWVudHMKICAgICAgICAgICAgaWYgKGNvbW1lbnQgJiYgbGFz\ndDIgPT0gJy0nICYmIGxhc3QgPT0gJy0nICYmIGNoID09ICc+JykgewogICAg\nICAgICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvbW1l\nbnQpIHsKICAgICAgICAgICAgICAgIGlmIChjaCA9PSAnPCcpIHsKICAgICAg\nICAgICAgICAgICAgICBjaCA9IGluLnJlYWQoKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrIHJlYWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGFzdDIg\nPT0gJzwnICYmIGxhc3QgPT0gJyEnICYmIGNoID09ICctJykgewogICAgICAg\nICAgICAgICAgY29tbWVudCA9IHRydWU7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbm90IGFu\nIGVsZW1lbnQgc3RhcnQsIHNraXAgaXQKICAgICAgICAgICAgaWYgKGNoICE9\nICc8JykKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB0\nb2tlbiA9IFRPS0VOX05PTkU7IC8vIHJlc2V0IHRva2VuCiAgICAgICAgICAg\nIGxhc3QgPSBjaDsgLy8gdXBkYXRlIG5lZWRlZCBmb3IgY29tbWVudCBkZXRl\nY3Rpb24KICAgICAgICAgICAgY2ggPSByZWFkVGhyb3VnaFdoaXRlc3BhY2Uo\naW4pOwogICAgICAgICAgICBpZiAoY2ggPT0gJy8nIHx8IGNoID09ICchJyB8\nfCBjaCA9PSAnPycpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIC8vIHJlYWQgZWxlbWVudCBuYW1lOyBsb29rIGZvciBwYWNrYWdl\ncyBhbmQgY2xhc3NlcwogICAgICAgICAgICB0b2tlbiA9IHJlYWRFbGVtZW50\nVG9rZW4oY2gsIGluKTsKICAgICAgICAgICAgc3dpdGNoICh0b2tlbikgewog\nICAgICAgICAgICAgICAgY2FzZSBUT0tFTl9FT0Y6CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWsgcmVhZDsKICAgICAgICAgICAgICAgIGNhc2UgVE9LRU5f\nUEFDS0FHRToKICAgICAgICAgICAgICAgICAgICBwa2cgPSByZWFkQXR0cmli\ndXRlKGluLCBfcGFja2FnZUF0dHIpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsg\ncmVhZDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgVE9LRU5fUEFDS0FHRV9OT0FUVFI6CiAgICAgICAgICAgICAg\nICAgICAgcGtnID0gcmVhZEVsZW1lbnRUZXh0KGluKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAocGtnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrIHJlYWQ7CiAgICAgICAgICAgICAgICAgICAgY2ggPSAnPCc7\nIC8vIHJlYWRpbmcgZWxlbWVudCB0ZXh0IHJlYWRzIHRvIG5leHQgJzwnCiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFRPS0VOX0NMQVNTOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSByZWFk\nQXR0cmlidXRlKGluLCBfY2xhc3NBdHRyKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBi\ncmVhayByZWFkOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2cubGVuZ3Ro\nKCkgPiAwICYmIG5hbWUuaW5kZXhPZignLicpID09IC0xKQogICAgICAgICAg\nICAgICAgICAgICAgICBuYW1lcy5hZGQocGtnICsgIi4iICsgbmFtZSk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICBuYW1lcy5hZGQobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFRPS0VOX0NMQVNTX05PQVRUUjoKICAg\nICAgICAgICAgICAgICAgICBuYW1lID0gcmVhZEVsZW1lbnRUZXh0KGluKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhayByZWFkOwogICAgICAgICAgICAgICAg\nICAgIGNoID0gJzwnOyAvLyByZWFkaW5nIGVsZW1lbnQgdGV4dCByZWFkcyB0\nbyBuZXh0ICc8JwogICAgICAgICAgICAgICAgICAgIGlmIChwa2cubGVuZ3Ro\nKCkgPiAwICYmIG5hbWUuaW5kZXhPZignLicpID09IC0xKQogICAgICAgICAg\nICAgICAgICAgICAgICBuYW1lcy5hZGQocGtnICsgIi4iICsgbmFtZSk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICBuYW1lcy5hZGQobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hbWVz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCB0aGUgbmFtZSBvZiB0aGUg\nY3VycmVudCBYTUwgZWxlbWVudCBhbmQgcmV0dXJuIHRoZSBtYXRjaGluZyB0\nb2tlbi4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgcmVhZEVsZW1lbnRUb2tl\nbihpbnQgY2gsIFJlYWRlciBpbikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBsb29rIHRocm91Z2ggdGhlIGJlZ2lubmluZyBlbGVtZW50IG5h\nbWVzIHRvIGZpbmQgd2hhdCBlbGVtZW50IHRoaXMKICAgICAgICAvLyBtaWdo\ndCBiZShpZiBhbnkpCiAgICAgICAgaW50IG1hdGNoSWR4ID0gLTE7CiAgICAg\nICAgaW50IG1hdGNoZWQgPSAwOwogICAgICAgIGludCBkcSA9IDA7CiAgICAg\nICAgZm9yIChpbnQgYmVnaW5JZHggPSAwOyBiZWdpbklkeCA8IF9iZWdpbkVs\nZW1lbnRzWzBdLmxlbmd0aDsgYmVnaW5JZHgrKykKICAgICAgICB7CiAgICAg\nICAgICAgIGlmIChiZWdpbklkeCAhPSAwKQogICAgICAgICAgICAgICAgY2gg\nPSBpbi5yZWFkKCk7CiAgICAgICAgICAgIGlmIChjaCA9PSAtMSkKICAgICAg\nICAgICAgICAgIHJldHVybiBUT0tFTl9FT0Y7CgogICAgICAgICAgICBtYXRj\naGVkID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfYmVn\naW5FbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKChkcSAmICgyIDw8IGkpKSAhPSAwKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlmIChjaCA9PSBfYmVnaW5FbGVt\nZW50c1tpXVtiZWdpbklkeF0pIHsKICAgICAgICAgICAgICAgICAgICBtYXRj\naElkeCA9IGk7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZCsrOwogICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgZHEgfD0g\nMiA8PCBpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobWF0Y2hl\nZCA9PSAwKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAg\nICAgIGlmIChtYXRjaGVkICE9IDEpCiAgICAgICAgICAgIHJldHVybiBUT0tF\nTl9OT05FOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJlc3Qgb2YgdGhl\nIGVsZW1lbnQgbmFtZSBtYXRjaGVzCiAgICAgICAgY2hhcltdIG1hdGNoID0g\nX2VuZEVsZW1lbnRzW21hdGNoSWR4XTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1hdGNoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNoID0g\naW4ucmVhZCgpOwogICAgICAgICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAg\nICAgICAgICByZXR1cm4gVE9LRU5fRU9GOwogICAgICAgICAgICBpZiAoY2gg\nIT0gbWF0Y2hbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gVE9LRU5fTk9O\nRTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgdGhlIG5leHQgY2hhciB0\nbyBtYWtlIHN1cmUgd2UgZmluaXNoZWQgdGhlIGVsZW1lbnQgbmFtZQogICAg\nICAgIGNoID0gaW4ucmVhZCgpOwogICAgICAgIGlmIChjaCA9PSAtMSkKICAg\nICAgICAgICAgcmV0dXJuIFRPS0VOX0VPRjsKICAgICAgICBpZiAoY2ggPT0g\nJz4nKSB7CiAgICAgICAgICAgIGlmIChtYXRjaElkeCA9PSAwICYmIF9wYWNr\nYWdlQXR0ciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIFRPS0VO\nX1BBQ0tBR0VfTk9BVFRSOwogICAgICAgICAgICBpZiAobWF0Y2hJZHggIT0g\nMCAmJiBfY2xhc3NBdHRyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gVE9LRU5fQ0xBU1NfTk9BVFRSOwogICAgICAgIH0gZWxzZSBpZiAoQ2hh\ncmFjdGVyLmlzV2hpdGVzcGFjZSgoY2hhcikgY2gpKSB7CiAgICAgICAgICAg\nIGlmIChtYXRjaElkeCA9PSAwICYmIF9wYWNrYWdlQXR0ciAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIFRPS0VOX1BBQ0tBR0U7CiAgICAgICAg\nICAgIGlmIChtYXRjaElkeCAhPSAwICYmIF9jbGFzc0F0dHIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBUT0tFTl9DTEFTUzsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIFRPS0VOX05PTkU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWFkIHRoZSBhdHRyaWJ1dGUgd2l0aCB0aGUgZ2l2ZW4gbmFtZSBp\nbiBjaGFycyBvZiB0aGUgY3VycmVudCBYTUwKICAgICAqIGVsZW1lbnQuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIHJlYWRBdHRyaWJ1dGUoUmVhZGVy\nIGluLCBjaGFyW10gbmFtZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBpbnQgZXhwZWN0ZWQgPSAwOwogICAgICAgIGZvciAoaW50IGNoLCBsYXN0\nID0gMDsgdHJ1ZTsgbGFzdCA9IGNoKSB7CiAgICAgICAgICAgIGNoID0gaW4u\ncmVhZCgpOwogICAgICAgICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKGNoID09ICc+JykK\nICAgICAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAgICAgICAgIC8vIGlm\nIG5vdCBleHBlY3RlZCBjaGFyIG9yIHN0aWxsIGxvb2tpbmcgZm9yICduJyBh\nbmQgcHJldmlvdXMKICAgICAgICAgICAgLy8gY2hhciBpcyBub3Qgd2hpdGVz\ncGFjZSwga2VlcCBsb29raW5nCiAgICAgICAgICAgIGlmIChjaCAhPSBuYW1l\nW2V4cGVjdGVkXSB8fCAoZXhwZWN0ZWQgPT0gMCAmJiBsYXN0ICE9IDAKICAg\nICAgICAgICAgICAgICYmICFDaGFyYWN0ZXIuaXNXaGl0ZXNwYWNlKChjaGFy\nKSBsYXN0KSkpIHsKICAgICAgICAgICAgICAgIGV4cGVjdGVkID0gMDsKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBmb3VuZCBleHBlY3RlZCBjaGFyOyBoYXZlIHdlIGZvdW5kIHRo\nZSB3aG9sZSAibmFtZSI/CiAgICAgICAgICAgIGV4cGVjdGVkKys7CiAgICAg\nICAgICAgIGlmIChleHBlY3RlZCA9PSBuYW1lLmxlbmd0aCkgewogICAgICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBuZXh0IGNoYXIgaXMgJz0nCiAg\nICAgICAgICAgICAgICBjaCA9IHJlYWRUaHJvdWdoV2hpdGVzcGFjZShpbik7\nCiAgICAgICAgICAgICAgICBpZiAoY2ggPT0gLTEpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoY2ggIT0g\nJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSAwOwogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIC8vIHRvc3Mgb3V0IGFueSBzdWJzZXF1ZW50IHdo\naXRlc3BhY2UgYW5kIHRoZSBuZXh0IGNoYXIsIHdoaWNoCiAgICAgICAgICAg\nICAgICAvLyBpcyB0aGUgb3BlbmluZyBxdW90ZSBmb3IgdGhlIGF0dHIgdmFs\ndWUsIHRoZW4gcmVhZCB1bnRpbCB0aGUKICAgICAgICAgICAgICAgIC8vIGNs\nb3NpbmcgcXVvdGUKICAgICAgICAgICAgICAgIHJlYWRUaHJvdWdoV2hpdGVz\ncGFjZShpbik7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVhZEF0dHJpYnV0\nZVZhbHVlKGluKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlYWQgdGhlIGN1cnJlbnQgdGV4dCB2YWx1ZSB1bnRp\nbCB0aGUgbmV4dCBlbGVtZW50LgogICAgICovCiAgICBwcml2YXRlIFN0cmlu\nZyByZWFkRWxlbWVudFRleHQoUmVhZGVyIGluKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBudWxsOwogICAgICAg\nIGludCBjaDsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBj\naCA9IGluLnJlYWQoKTsKICAgICAgICAgICAgaWYgKGNoID09IC0xKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmIChjaCA9\nPSAnPCcpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgaWYg\nKENoYXJhY3Rlci5pc1doaXRlc3BhY2UoKGNoYXIpIGNoKSkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoYnVmID09IG51bGwp\nCiAgICAgICAgICAgICAgICBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoKGNoYXIpIGNoKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIChidWYgPT0gbnVsbCkgPyAiIiA6IGJ1Zi50b1N0cmlu\nZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCB1bnRpbCB0aGUgbmV4\ndCBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXIuCiAgICAgKi8KICAgIHByaXZh\ndGUgaW50IHJlYWRUaHJvdWdoV2hpdGVzcGFjZShSZWFkZXIgaW4pIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaW50IGNoOwogICAgICAgIHdoaWxl\nICh0cnVlKSB7CiAgICAgICAgICAgIGNoID0gaW4ucmVhZCgpOwogICAgICAg\nICAgICBpZiAoY2ggPT0gLTEgfHwgIUNoYXJhY3Rlci5pc1doaXRlc3BhY2Uo\nKGNoYXIpIGNoKSkKICAgICAgICAgICAgICAgIHJldHVybiBjaDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGN1cnJlbnQg\nYXR0cmlidXRlIHZhbHVlLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBy\nZWFkQXR0cmlidXRlVmFsdWUoUmVhZGVyIGluKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKCk7CiAgICAgICAgaW50IGNoOwogICAgICAgIHdoaWxlICh0cnVlKSB7\nCiAgICAgICAgICAgIGNoID0gaW4ucmVhZCgpOwogICAgICAgICAgICBpZiAo\nY2ggPT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICAgICAgaWYgKGNoID09ICdcJycgfHwgY2ggPT0gJyInKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKChjaGFyKSBjaCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

