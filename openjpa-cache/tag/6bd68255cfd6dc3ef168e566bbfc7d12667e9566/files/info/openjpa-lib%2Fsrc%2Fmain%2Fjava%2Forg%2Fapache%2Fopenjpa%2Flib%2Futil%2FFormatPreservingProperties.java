{"sha":"901408cbd3f48a5755cb41fd530adbd6e49e8351","node_id":"MDQ6QmxvYjIwNjM2NDo5MDE0MDhjYmQzZjQ4YTU3NTVjYjQxZmQ1MzBhZGJkNmU0OWU4MzUx","size":23570,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/901408cbd3f48a5755cb41fd530adbd6e49e8351","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uRmlsdGVy\nSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5wdXRT\ndHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFt\nOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07CmltcG9ydCBq\nYXZhLmlvLk91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3Ry\nZWFtV3JpdGVyOwppbXBvcnQgamF2YS5pby5QcmludFdyaXRlcjsKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkNhbGVu\nZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkxpbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVydGllczsKaW1w\nb3J0IGphdmEudXRpbC5TZXQ7CgovKgogKiAjIyMgdGhpbmdzIHRvIGFkZDog\nLSBzaG91bGQgcHJvYmFibHkgYmUgYSBTb3VyY2VUcmFja2VyCiAqIC0gaWYg\nYW4gZW50cnkgaXMgcmVtb3ZlZCwgc2hvdWxkIHRoZXJlIGJlIGFuIG9wdGlv\nbiB0byByZW1vdmUgY29tbWVudHMKICoganVzdCBiZWZvcmUgdGhlIGVudHJ5\nKGEgbGEgamF2YWRvYyk/CiAqIC0gc2hvdWxkIHdlIGhhdmUgYW4gb3B0aW9u\nIHRvIGNsZWFuIHVwIHdoaXRlc3BhY2U/CiAqIC0gcG90ZW50aWFsbHkgd291\nbGQgYmUgaW50ZXJlc3RpbmcgdG8gYWRkIGNvbW1lbnRzIGFib3V0IGVhY2gK\nICogcHJvcGVydHkgdGhhdCBPcGVuSlBBIGFkZHMgdG8gdGhpcyBvYmplY3Qu\nIFdlJ2Qgd2FudCB0byBtYWtlIHRoZQogKiBhdXRvbWF0aWMgY29tbWVudC1y\nZW1vdmluZyBjb2RlIHdvcmsgZmlyc3QsIHRob3VnaCwgc28gdGhhdCBpZgog\nKiBzb21lb25lIHRoZW4gcmVtb3ZlZCB0aGUgcHJvcGVydHksIHRoZSBjb21t\nZW50cyB3b3VsZCBnbyBhd2F5LgogKiAtIHdvdWxkIGJlIG5lYXQgaWYgRHVw\nbGljYXRlS2V5RXhjZXB0aW9uIGNvdWxkIHJlcG9ydCBsaW5lIG51bWJlcnMg\nb2YKICogb2ZmZW5kaW5nIGVudHJpZXMuCiAqIC0gcHV0QWxsKCkgd2l0aCBh\nbm90aGVyIEZvcm1hdFByZXNlcnZpbmdQcm9wZXJ0aWVzIHNob3VsZCBiZSBz\nbWFydGVyCiAqLwoKLyoqCiAqIEEgc3BlY2lhbGl6YXRpb24gb2Yge0BsaW5r\nIFByb3BlcnRpZXN9IHRoYXQgc3RvcmVzIGl0cyBjb250ZW50cwogKiBpbiB0\naGUgc2FtZSBvcmRlciBhbmQgd2l0aCB0aGUgc2FtZSBmb3JtYXR0aW5nIGFz\nIHdhcyB1c2VkIHRvIHJlYWQKICogdGhlIGNvbnRlbnRzIGZyb20gYW4gaW5w\ndXQgc3RyZWFtLiBUaGlzIGlzIHVzZWZ1bCBiZWNhdXNlIGl0IG1lYW5zCiAq\nIHRoYXQgYSBwcm9wZXJ0aWVzIGZpbGUgbG9hZGVkIHZpYSB0aGlzIG9iamVj\ndCBhbmQgdGhlbiB3cml0dGVuCiAqIGJhY2sgb3V0IGxhdGVyIG9uIHdpbGwg\nb25seSBiZSBkaWZmZXJlbnQgd2hlcmUgY2hhbmdlcyBvcgogKiBhZGRpdGlv\nbnMgd2VyZSBtYWRlLgogKiBCeSBkZWZhdWx0LCB0aGUge0BsaW5rICNzdG9y\nZX0gbWV0aG9kIGluIHRoaXMgY2xhc3MgZG9lcyBub3QKICogYmVoYXZlIHRo\nZSBzYW1lIGFzIHtAbGluayBQcm9wZXJ0aWVzI3N0b3JlfS4gWW91IGNhbiBj\nYXVzZSBhbgogKiBpbnN0YW5jZSB0byBhcHByb3hpbWF0ZSB0aGUgYmVoYXZp\nb3Igb2Yge0BsaW5rIFByb3BlcnRpZXMjc3RvcmV9CiAqIGJ5IGludm9raW5n\nIHtAbGluayAjc2V0RGVmYXVsdEVudHJ5RGVsaW1pdGVyfSB3aXRoIDxjb2Rl\nPj08L2NvZGU+LAogKiB7QGxpbmsgI3NldEFkZFdoaXRlc3BhY2VBZnRlckRl\nbGltaXRlcn0gd2l0aCA8Y29kZT5mYWxzZTwvY29kZT4sIGFuZAogKiB7QGxp\nbmsgI3NldEFsbG93RHVwbGljYXRlc30gd2l0aCA8Y29kZT50cnVlPC9jb2Rl\nPi4gSG93ZXZlciwgdGhpcwogKiB3aWxsIG9ubHkgaW5mbHVlbmNlIGhvdyB0\naGUgaW5zdGFuY2Ugd2lsbCB3cml0ZSBuZXcgdmFsdWVzLCBub3QgaG93CiAq\nIGl0IHdpbGwgd3JpdGUgZXhpc3Rpbmcga2V5LXZhbHVlIHBhaXJzIHRoYXQg\nYXJlIG1vZGlmaWVkLgogKiBJbiBjb25qdW5jdGlvbiB3aXRoIGEgY29uc2Vy\ndmF0aXZlIG91dHB1dCB3cml0ZXIsIGl0IGlzCiAqIHBvc3NpYmxlIHRvIG9u\nbHkgd3JpdGUgdG8gZGlzayBjaGFuZ2VzIC8gYWRkaXRpb25zLgogKiBUaGlz\nIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IHBlcm1pdCBlc2NhcGVkICcgJywg\nJz0nLCAnOicKICogY2hhcmFjdGVycyBpbiBrZXkgbmFtZXMuCiAqCiAqIEBz\naW5jZSAwLjMuMwogKi8KcHVibGljIGNsYXNzIEZvcm1hdFByZXNlcnZpbmdQ\ncm9wZXJ0aWVzIGV4dGVuZHMgUHJvcGVydGllcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChGb3JtYXRQcmVzZXJ2aW5nUHJvcGVydGllcy5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBjaGFyIGRlZmF1bHRFbnRyeURlbGltaXRlciA9ICc6JzsK\nICAgIHByaXZhdGUgYm9vbGVhbiBhZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxpbWl0\nZXIgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIGFsbG93RHVwbGljYXRl\ncyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIGluc2VydFRpbWVzdGFt\ncCA9IGZhbHNlOwoKICAgIHByaXZhdGUgUHJvcGVydHlTb3VyY2Ugc291cmNl\nOwogICAgcHJpdmF0ZSBMaW5rZWRIYXNoU2V0IG5ld0tleXMgPSBuZXcgTGlu\na2VkSGFzaFNldCgpOwogICAgcHJpdmF0ZSBIYXNoU2V0IG1vZGlmaWVkS2V5\ncyA9IG5ldyBIYXNoU2V0KCk7CgogICAgLy8gbWFya2VyIHRoYXQgaW5kaWNh\ndGVzIHRoYXQgd2UncmUgbm90IGRlc2VyaWFsaXppbmcKICAgIHByaXZhdGUg\ndHJhbnNpZW50IGJvb2xlYW4gaXNOb3REZXNlcmlhbGl6aW5nID0gdHJ1ZTsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gaXNMb2FkaW5nID0gZmFs\nc2U7CgogICAgcHVibGljIEZvcm1hdFByZXNlcnZpbmdQcm9wZXJ0aWVzKCkg\newogICAgICAgIHRoaXMobnVsbCk7CiAgICB9CgogICAgcHVibGljIEZvcm1h\ndFByZXNlcnZpbmdQcm9wZXJ0aWVzKFByb3BlcnRpZXMgZGVmYXVsdHMpIHsK\nICAgICAgICBzdXBlcihkZWZhdWx0cyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgY2hhcmFjdGVyIHRvIHVzZSBhcyBhIGRlbGltaXRlciBiZXR3ZWVu\nIHByb3BlcnR5IGtleXMgYW5kIHZhbHVlcy4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZGVmYXVsdEVudHJ5RGVsaW1pdGVyIGVpdGhlciAnOicgb3IgJz0nCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRFbnRyeURlbGltaXRl\ncihjaGFyIGRlZmF1bHRFbnRyeURlbGltaXRlcikgewogICAgICAgIHRoaXMu\nZGVmYXVsdEVudHJ5RGVsaW1pdGVyID0gZGVmYXVsdEVudHJ5RGVsaW1pdGVy\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VlIHtAbGluayAjc2V0RGVmYXVs\ndEVudHJ5RGVsaW1pdGVyfQogICAgICovCiAgICBwdWJsaWMgY2hhciBnZXRE\nZWZhdWx0RW50cnlEZWxpbWl0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMu\nZGVmYXVsdEVudHJ5RGVsaW1pdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+LCB0aGlzIHByb3BlcnRpZXMg\nb2JqZWN0IHdpbGwgYWRkIGEKICAgICAqIHNwYWNlIGFmdGVyIHRoZSBkZWxp\nbWl0ZXIgY2hhcmFjdGVyKGlmIHRoZSBkZWxpbWl0ZXIgaXMgbm90CiAgICAg\nKiB0aGUgc3BhY2UgY2hhcmFjdGVyKS4gRWxzZSwgdGhpcyB3aWxsIG5vdCBh\nZGQgYSBzcGFjZS4KICAgICAqIERlZmF1bHQgdmFsdWU6IDxjb2RlPnRydWU8\nL2NvZGU+LiBOb3RlIHRoYXQge0BsaW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0\nb3JlfSBuZXZlciB3cml0ZXMgd2hpdGVzcGFjZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0QWRkV2hpdGVzcGFjZUFmdGVyRGVsaW1pdGVyKGJvb2xl\nYW4gYWRkKSB7CiAgICAgICAgdGhpcy5hZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxp\nbWl0ZXIgPSBhZGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8g\nPGNvZGU+dHJ1ZTwvY29kZT4sIHRoaXMgcHJvcGVydGllcyBvYmplY3Qgd2ls\nbCBhZGQgYQogICAgICogc3BhY2UgYWZ0ZXIgdGhlIGRlbGltaXRlciBjaGFy\nYWN0ZXIoaWYgdGhlIGRlbGltaXRlciBpcyBub3QKICAgICAqIHRoZSBzcGFj\nZSBjaGFyYWN0ZXIpLiBFbHNlLCB0aGlzIHdpbGwgbm90IGFkZCBhIHNwYWNl\nLgogICAgICogRGVmYXVsdCB2YWx1ZTogPGNvZGU+dHJ1ZTwvY29kZT4uIE5v\ndGUgdGhhdCB7QGxpbmsKICAgICAqIFByb3BlcnRpZXMjc3RvcmV9IG5ldmVy\nIHdyaXRlcyB3aGl0ZXNwYWNlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRBZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxpbWl0ZXIoKSB7CiAgICAgICAg\ncmV0dXJuIHRoaXMuYWRkV2hpdGVzcGFjZUFmdGVyRGVsaW1pdGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+\nLCB0aGlzIHByb3BlcnRpZXMgb2JqZWN0IHdpbGwgYWRkIGEKICAgICAqIHRp\nbWVzdGFtcCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmaWxlLCBqdXN0IGFm\ndGVyIHRoZSBoZWFkZXIKICAgICAqIChpZiBhbnkpIGlzIHByaW50ZWQuIEVs\nc2UsIHRoaXMgd2lsbCBub3QgYWRkIGEgdGltZXN0YW1wLgogICAgICogRGVm\nYXVsdCB2YWx1ZTogPGNvZGU+ZmFsc2U8L2NvZGU+LiBOb3RlIHRoYXQge0Bs\naW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0b3JlfSBhbHdheXMgd3JpdGVzIGEg\ndGltZXN0YW1wLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnNlcnRU\naW1lc3RhbXAoYm9vbGVhbiBpbnNlcnRUaW1lc3RhbXApIHsKICAgICAgICB0\naGlzLmluc2VydFRpbWVzdGFtcCA9IGluc2VydFRpbWVzdGFtcDsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPiwg\ndGhpcyBwcm9wZXJ0aWVzIG9iamVjdCB3aWxsIGFkZCBhCiAgICAgKiB0aW1l\nc3RhbXAgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgZmlsZSwganVzdCBhZnRl\nciB0aGUgaGVhZGVyCiAgICAgKiAoaWYgYW55KSBpcyBwcmludGVkLiBFbHNl\nLCB0aGlzIHdpbGwgbm90IGFkZCBhIHRpbWVzdGFtcC4KICAgICAqIERlZmF1\nbHQgdmFsdWU6IDxjb2RlPmZhbHNlPC9jb2RlPi4gTm90ZSB0aGF0IHtAbGlu\nawogICAgICogUHJvcGVydGllcyNzdG9yZX0gYWx3YXlzIHdyaXRlcyBhIHRp\nbWVzdGFtcC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0SW5zZXJ0\nVGltZXN0YW1wKCkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydFRpbWVz\ndGFtcDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHNldCB0byA8Y29kZT50\ncnVlPC9jb2RlPiwgZHVwbGljYXRlIHByb3BlcnRpZXMgYXJlIGFsbG93ZWQs\nIGFuZAogICAgICogdGhlIGxhc3QgcHJvcGVydHkgc2V0dGluZyBpbiB0aGUg\naW5wdXQgd2lsbCBvdmVyd3JpdGUgYW55IHByZXZpb3VzCiAgICAgKiBzZXR0\naW5ncy4gSWYgc2V0IHRvIDxjb2RlPmZhbHNlPC9jb2RlPiwgZHVwbGljYXRl\nIHByb3BlcnR5IGRlZmluaXRpb25zCiAgICAgKiBpbiB0aGUgaW5wdXQgd2ls\nbCBjYXVzZSBhbiBleGNlcHRpb24gdG8gYmUgdGhyb3duIGR1cmluZyB7QGxp\nbmsgI2xvYWR9LgogICAgICogRGVmYXVsdCB2YWx1ZTogPGNvZGU+ZmFsc2U8\nL2NvZGU+LiBOb3RlIHRoYXQge0BsaW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0\nb3JlfSBhbHdheXMgYWxsb3dzIGR1cGxpY2F0ZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEFsbG93RHVwbGljYXRlcyhib29sZWFuIGFsbG93RHVw\nbGljYXRlcykgewogICAgICAgIHRoaXMuYWxsb3dEdXBsaWNhdGVzID0gYWxs\nb3dEdXBsaWNhdGVzOwogICAgfQoKICAgIC8qKgogICAgICogSWYgc2V0IHRv\nIDxjb2RlPnRydWU8L2NvZGU+LCBkdXBsaWNhdGUgcHJvcGVydGllcyBhcmUg\nYWxsb3dlZCwgYW5kCiAgICAgKiB0aGUgbGFzdCBwcm9wZXJ0eSBzZXR0aW5n\nIGluIHRoZSBpbnB1dCB3aWxsIG92ZXJ3cml0ZSBhbnkgcHJldmlvdXMKICAg\nICAqIHNldHRpbmdzLiBJZiBzZXQgdG8gPGNvZGU+ZmFsc2U8L2NvZGU+LCBk\ndXBsaWNhdGUgcHJvcGVydHkgZGVmaW5pdGlvbnMKICAgICAqIGluIHRoZSBp\nbnB1dCB3aWxsIGNhdXNlIGFuIGV4Y2VwdGlvbiB0byBiZSB0aHJvd24gZHVy\naW5nIHtAbGluayAjbG9hZH0uCiAgICAgKiBEZWZhdWx0IHZhbHVlOiA8Y29k\nZT5mYWxzZTwvY29kZT4uIE5vdGUgdGhhdCB7QGxpbmsKICAgICAqIFByb3Bl\ncnRpZXMjc3RvcmV9IGFsd2F5cyBhbGxvd3MgZHVwbGljYXRlcy4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gZ2V0QWxsb3dEdXBsaWNhdGVzKCkgewog\nICAgICAgIHJldHVybiB0aGlzLmFsbG93RHVwbGljYXRlczsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFByb3BlcnR5KFN0cmluZyBrZXkpIHsKICAg\nICAgICByZXR1cm4gc3VwZXIuZ2V0UHJvcGVydHkoa2V5KTsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFByb3BlcnR5KFN0cmluZyBrZXksIFN0cmlu\nZyBkZWZhdWx0VmFsdWUpIHsKICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJv\ncGVydHkoa2V5LCBkZWZhdWx0VmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3Qgc2V0UHJvcGVydHkoU3RyaW5nIGtleSwgU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgcmV0dXJuIHB1dChrZXksIHZhbHVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENpcmN1bXZlbnRzIHRoZSBzdXBlcmNsYXNzIHtAbGluayAj\ncHV0QWxsfSBpbXBsZW1lbnRhdGlvbiwKICAgICAqIHB1dHRpbmcgYWxsIHRo\nZSBrZXktdmFsdWUgcGFpcnMgdmlhIHtAbGluayAjcHV0fS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgcHV0QWxsKE1hcCBtKSB7CiAgICAgICAgTWFwLkVu\ndHJ5IGU7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0gbS5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBlID0gKE1hcC5FbnRyeSkgaXRlci5uZXh0KCk7CiAgICAgICAgICAgIHB1\ndChlLmdldEtleSgpLCBlLmdldFZhbHVlKCkpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZXMgdGhlIGtleSBmcm9tIHRoZSBib29r\na2VlcGluZyBjb2xsZWN0aW90bnMgYXMgd2VsbC4KICAgICAqLwogICAgcHVi\nbGljIE9iamVjdCByZW1vdmUoT2JqZWN0IGtleSkgewogICAgICAgIG5ld0tl\neXMucmVtb3ZlKGtleSk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnJlbW92ZShr\nZXkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAg\nIHN1cGVyLmNsZWFyKCk7CgogICAgICAgIGlmIChzb3VyY2UgIT0gbnVsbCkK\nICAgICAgICAgICAgc291cmNlLmNsZWFyKCk7CgogICAgICAgIG5ld0tleXMu\nY2xlYXIoKTsKICAgICAgICBtb2RpZmllZEtleXMuY2xlYXIoKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewogICAgICAgIEZvcm1hdFBy\nZXNlcnZpbmdQcm9wZXJ0aWVzIGMgPSAoRm9ybWF0UHJlc2VydmluZ1Byb3Bl\ncnRpZXMpCiAgICAgICAgICAgIHN1cGVyLmNsb25lKCk7CgogICAgICAgIGlm\nIChzb3VyY2UgIT0gbnVsbCkKICAgICAgICAgICAgYy5zb3VyY2UgPSAoUHJv\ncGVydHlTb3VyY2UpIHNvdXJjZS5jbG9uZSgpOwoKICAgICAgICBpZiAobW9k\naWZpZWRLZXlzICE9IG51bGwpCiAgICAgICAgICAgIGMubW9kaWZpZWRLZXlz\nID0gKEhhc2hTZXQpIG1vZGlmaWVkS2V5cy5jbG9uZSgpOwoKICAgICAgICBp\nZiAobmV3S2V5cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGMubmV3S2V5cyA9\nIG5ldyBMaW5rZWRIYXNoU2V0KCk7CiAgICAgICAgICAgIGMubmV3S2V5cy5h\nZGRBbGwobmV3S2V5cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYzsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVPYmplY3QoT2JqZWN0T3V0\ncHV0U3RyZWFtIG91dCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBv\ndXQuZGVmYXVsdFdyaXRlT2JqZWN0KCk7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHJlYWRPYmplY3QoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsK\nICAgICAgICBpbi5kZWZhdWx0UmVhZE9iamVjdCgpOwoKICAgICAgICBpc05v\ndERlc2VyaWFsaXppbmcgPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgcHV0KE9iamVjdCBrZXksIE9iamVjdCB2YWwpIHsKICAgICAgICBPYmpl\nY3QgbyA9IHN1cGVyLnB1dChrZXksIHZhbCk7CgogICAgICAgIC8vIGlmIHdl\nJ3JlIG5vIGxvbmdlciBsb2FkaW5nIGZyb20gcHJvcGVydGllcyBhbmQgdGhp\ncyBwdXQKICAgICAgICAvLyByZXByZXNlbnRzIGFuIGFjdHVhbCBjaGFuZ2Ug\naW4gdmFsdWUsIG1hcmsgdGhlIG1vZGlmaWNhdGlvbgogICAgICAgIC8vIG9y\nIGFkZGl0aW9uIGluIHRoZSBib29ra2VlcGluZyBjb2xsZWN0aW9ucy4KICAg\nICAgICBpZiAoIWlzTG9hZGluZyAmJiBpc05vdERlc2VyaWFsaXppbmcgJiYg\nIXZhbC5lcXVhbHMobykpIHsKICAgICAgICAgICAgaWYgKG8gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIG1vZGlmaWVkS2V5cy5hZGQoa2V5KTsKICAgICAg\nICAgICAgZWxzZSBpZiAoIW5ld0tleXMuY29udGFpbnMoa2V5KSkKICAgICAg\nICAgICAgICAgIG5ld0tleXMuYWRkKGtleSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBvOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZHMgdGhlIHBy\nb3BlcnRpZXMgaW4gPGNvZGU+aW48L2NvZGU+LCBhY2NvcmRpbmcgdG8gdGhl\nIHJ1bGVzCiAgICAgKiBkZXNjcmliZWQgaW4ge0BsaW5rIFByb3BlcnRpZXMj\nbG9hZH0uIElmIHtAbGluayAjZ2V0QWxsb3dEdXBsaWNhdGVzfQogICAgICog\ncmV0dXJucyA8Y29kZT50cnVlPC9jb2RlPiwgdGhpcyB3aWxsIHRocm93IGEg\ne0BsaW5rCiAgICAgKiBEdXBsaWNhdGVLZXlFeGNlcHRpb259IGlmIGR1cGxp\nY2F0ZSBwcm9wZXJ0eSBkZWNsYXJhdGlvbnMgYXJlCiAgICAgKiBlbmNvdW50\nZXJlZC4KICAgICAqCiAgICAgKiBAc2VlIFByb3BlcnRpZXMjbG9hZAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBsb2FkKElucHV0U3RyZWFtIGluKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlzTG9hZGluZyA9IHRydWU7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9hZFByb3BlcnRpZXMoaW4pOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlzTG9hZGluZyA9IGZh\nbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbG9hZFBy\nb3BlcnRpZXMoSW5wdXRTdHJlYW0gaW4pIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgc291cmNlID0gbmV3IFByb3BlcnR5U291cmNlKCk7CgogICAg\nICAgIFByb3BlcnR5TGluZVJlYWRlciByZWFkZXIgPSBuZXcgUHJvcGVydHlM\naW5lUmVhZGVyKGluLCBzb3VyY2UpOwoKICAgICAgICBTZXQgbG9hZGVkS2V5\ncyA9IG5ldyBIYXNoU2V0KCk7CgogICAgICAgIGZvciAoUHJvcGVydHlMaW5l\nIGw7CiAgICAgICAgICAgIChsID0gcmVhZGVyLnJlYWRQcm9wZXJ0eUxpbmUo\nKSkgIT0gbnVsbCAmJiBzb3VyY2UuYWRkKGwpOykgewogICAgICAgICAgICBT\ndHJpbmcgbGluZSA9IGwubGluZS50b1N0cmluZygpOwoKICAgICAgICAgICAg\nY2hhciBjID0gMDsKICAgICAgICAgICAgaW50IHBvcyA9IDA7CgogICAgICAg\nICAgICB3aGlsZSAocG9zIDwgbGluZS5sZW5ndGgoKSAmJiBpc1NwYWNlKGMg\nPSBsaW5lLmNoYXJBdChwb3MpKSkKICAgICAgICAgICAgICAgIHBvcysrOwoK\nICAgICAgICAgICAgaWYgKChsaW5lLmxlbmd0aCgpIC0gcG9zKSA9PSAwCiAg\nICAgICAgICAgICAgICB8fCBsaW5lLmNoYXJBdChwb3MpID09ICcjJyB8fCBs\naW5lLmNoYXJBdChwb3MpID09ICchJykKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgU3RyaW5nQnVmZmVyIGtleSA9IG5ldyBTdHJp\nbmdCdWZmZXIoKTsKICAgICAgICAgICAgd2hpbGUgKHBvcyA8IGxpbmUubGVu\nZ3RoKCkgJiYgIWlzU3BhY2UoYyA9IGxpbmUuY2hhckF0KHBvcysrKSkKICAg\nICAgICAgICAgICAgICYmIGMgIT0gJz0nICYmIGMgIT0gJzonKSB7CiAgICAg\nICAgICAgICAgICBpZiAoYyA9PSAnXFwnKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKHBvcyA9PSBsaW5lLmxlbmd0aCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGwuYXBwZW5kKGxpbmUgPSByZWFkZXIucmVhZExpbmUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHdoaWxlIChwb3MgPCBsaW5lLmxlbmd0aCgpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAmJiBpc1NwYWNlKGMgPSBsaW5lLmNo\nYXJBdChwb3MpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcysr\nOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHBvcyA9IHJlYWRFc2NhcGUobGluZSwgcG9zLCBrZXkpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAga2V5LmFwcGVuZChjKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgYm9vbGVhbiBp\nc0RlbGltID0gKGMgPT0gJzonIHx8IGMgPT0gJz0nKTsKCiAgICAgICAgICAg\nIGZvciAoOyBwb3MgPCBsaW5lLmxlbmd0aCgpCiAgICAgICAgICAgICAgICAm\nJiBpc1NwYWNlKGMgPSBsaW5lLmNoYXJBdChwb3MpKTsgcG9zKyspCiAgICAg\nICAgICAgICAgICA7CgogICAgICAgICAgICBpZiAoIWlzRGVsaW0gJiYgKGMg\nPT0gJzonIHx8IGMgPT0gJz0nKSkgewogICAgICAgICAgICAgICAgcG9zKys7\nCiAgICAgICAgICAgICAgICB3aGlsZSAocG9zIDwgbGluZS5sZW5ndGgoKSAm\nJiBpc1NwYWNlKGMgPSBsaW5lLmNoYXJBdChwb3MpKSkKICAgICAgICAgICAg\nICAgICAgICBwb3MrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgU3Ry\naW5nQnVmZmVyIGVsZW1lbnQgPSBuZXcgU3RyaW5nQnVmZmVyKGxpbmUubGVu\nZ3RoKCkgLSBwb3MpOwoKICAgICAgICAgICAgd2hpbGUgKHBvcyA8IGxpbmUu\nbGVuZ3RoKCkpIHsKICAgICAgICAgICAgICAgIGMgPSBsaW5lLmNoYXJBdChw\nb3MrKyk7CiAgICAgICAgICAgICAgICBpZiAoYyA9PSAnXFwnKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHBvcyA9PSBsaW5lLmxlbmd0aCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGwuYXBwZW5kKGxpbmUgPSByZWFkZXIu\ncmVhZExpbmUoKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlu\nZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSAwOwogICAgICAgICAg\nICAgICAgICAgICAgICB3aGlsZSAocG9zIDwgbGluZS5sZW5ndGgoKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgJiYgaXNTcGFjZShjID0gbGluZS5j\naGFyQXQocG9zKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3Mr\nKzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5lbnN1cmVDYXBh\nY2l0eShsaW5lLmxlbmd0aCgpIC0gcG9zICsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGVsZW1lbnQubGVuZ3RoKCkpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHJl\nYWRFc2NhcGUobGluZSwgcG9zLCBlbGVtZW50KTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nICAgICBlbGVtZW50LmFwcGVuZChjKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKCFsb2FkZWRLZXlzLmFkZChrZXkudG9TdHJpbmcoKSkgJiYg\nIWFsbG93RHVwbGljYXRlcykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBE\ndXBsaWNhdGVLZXlFeGNlcHRpb24oa2V5LnRvU3RyaW5nKCksCiAgICAgICAg\nICAgICAgICAgICAgZ2V0UHJvcGVydHkoa2V5LnRvU3RyaW5nKCkpLCBlbGVt\nZW50LnRvU3RyaW5nKCkpOwoKICAgICAgICAgICAgbC5zZXRQcm9wZXJ0eUtl\neShrZXkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGwuc2V0UHJvcGVydHlW\nYWx1ZShlbGVtZW50LnRvU3RyaW5nKCkpOwogICAgICAgICAgICBwdXQoa2V5\nLnRvU3RyaW5nKCksIGVsZW1lbnQudG9TdHJpbmcoKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmVhZCB0aGUgbmV4dCBlc2NhcGVkIGNo\nYXJhY3RlcjogaGFuZGxlIG5ld2xpbmVzLCB0YWJzLCByZXR1cm5zLCBhbmQK\nICAgICAqIGZvcm0gZmVlZHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUgZXNjYXBl\nZCBjaGFyYWN0ZXIsIHRoZW4gdHJ5IHRvCiAgICAgKiBkZWNvZGUgdW5pY29k\nZSBjaGFyYWN0ZXJzLiBGaW5hbGx5LCBqdXN0IGFkZCB0aGUgY2hhcmFjdGVy\nIGV4cGxpY2l0bHkuCiAgICAgKgogICAgICogQHBhcmFtIHNvdXJjZSB0aGUg\nc291cmNlIG9mIHRoZSBjaGFyYWN0ZXJzCiAgICAgKiBAcGFyYW0gcG9zIHRo\nZSBwb3NpdGlvbiBhdCB3aGljaCB0byBzdGFydCByZWFkaW5nCiAgICAgKiBA\ncGFyYW0gdmFsdWUgdGhlIHZhbHVlIHdlIGFyZSBhcHBlbmRpbmcgdG8KICAg\nICAqIEByZXR1cm4gdGhlIHBvc2l0aW9uIGFmdGVyIHRoZSByZWFkaW5nIGlz\nIGRvbmUKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHJlYWRFc2Nh\ncGUoU3RyaW5nIHNvdXJjZSwgaW50IHBvcywgU3RyaW5nQnVmZmVyIHZhbHVl\nKSB7CiAgICAgICAgY2hhciBjID0gc291cmNlLmNoYXJBdChwb3MrKyk7CiAg\nICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgIGNhc2UgJ24nOgogICAg\nICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCdcbicpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgICAg\nICAgdmFsdWUuYXBwZW5kKCdcdCcpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgJ2YnOgogICAgICAgICAgICAgICAgdmFsdWUu\nYXBwZW5kKCdcZicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgJ3InOgogICAgICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCdc\ncicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nJ3UnOgogICAgICAgICAgICAgICAgaWYgKHBvcyArIDQgPD0gc291cmNlLmxl\nbmd0aCgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2hhciB1bmkgPSAoY2hh\ncikgSW50ZWdlci5wYXJzZUludAogICAgICAgICAgICAgICAgICAgICAgICAo\nc291cmNlLnN1YnN0cmluZyhwb3MsIHBvcyArIDQpLCAxNik7CiAgICAgICAg\nICAgICAgICAgICAgdmFsdWUuYXBwZW5kKHVuaSk7CiAgICAgICAgICAgICAg\nICAgICAgcG9zICs9IDQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHZhbHVlLmFwcGVuZChjKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBvczsKICAgIH0KCiAgICBwcml2\nYXRlIHN0YXRpYyBib29sZWFuIGlzU3BhY2UoY2hhciBjaCkgewogICAgICAg\nIHJldHVybiBDaGFyYWN0ZXIuaXNXaGl0ZXNwYWNlKGNoKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzYXZlKE91dHB1dFN0cmVhbSBvdXQsIFN0cmluZyBo\nZWFkZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdG9yZShvdXQs\nIGhlYWRlcik7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZXgpIHsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmUoT3V0cHV0\nU3RyZWFtIG91dCwgU3RyaW5nIGhlYWRlcikgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBib29sZWFuIGVuZFdpdGhOZXdsaW5lID0gc291cmNlICE9\nIG51bGwgJiYgc291cmNlLmVuZHNJbk5ld2xpbmU7CgogICAgICAgIC8vIE11\nc3QgYmUgSVNPLTg4NTktMSBlY29kaW5nIGFjY29yZGluZyB0byBQcm9wZXJ0\naWVzLmxvYWQgamF2YWRvYwogICAgICAgIFByaW50V3JpdGVyIHdyaXRlciA9\nIG5ldyBQcmludFdyaXRlcgogICAgICAgICAgICAobmV3IE91dHB1dFN0cmVh\nbVdyaXRlcihvdXQsICJJU08tODg1OS0xIiksIGZhbHNlKTsKCiAgICAgICAg\naWYgKGhlYWRlciAhPSBudWxsKQogICAgICAgICAgICB3cml0ZXIucHJpbnRs\nbigiIyIgKyBoZWFkZXIpOwoKICAgICAgICBpZiAoaW5zZXJ0VGltZXN0YW1w\nKQogICAgICAgICAgICB3cml0ZXIucHJpbnRsbigiIyIgKyBDYWxlbmRhci5n\nZXRJbnN0YW5jZSgpLmdldFRpbWUoKSk7CgogICAgICAgIExpc3QgbGluZXMg\nPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgIC8vIGZpcnN0IHdyaXRlIGFs\nbCB0aGUgZXhpc3RpbmcgcHJvcHMgYXMgdGhleSB3ZXJlIGluaXRpYWxseSBy\nZWFkCiAgICAgICAgaWYgKHNvdXJjZSAhPSBudWxsKQogICAgICAgICAgICBs\naW5lcy5hZGRBbGwoc291cmNlKTsKCiAgICAgICAgLy8gbmV4dCB3cml0ZSBv\ndXQgbmV3IGtleXMsIHRoZW4gdGhlIHJlc3Qgb2YgdGhlIGtleXMKICAgICAg\nICBMaW5rZWRIYXNoU2V0IGtleXMgPSBuZXcgTGlua2VkSGFzaFNldCgpOwog\nICAgICAgIGtleXMuYWRkQWxsKG5ld0tleXMpOwogICAgICAgIGtleXMuYWRk\nQWxsKGtleVNldCgpKTsKCiAgICAgICAgbGluZXMuYWRkQWxsKGtleXMpOwoK\nICAgICAgICBrZXlzLnJlbW92ZShudWxsKTsKCiAgICAgICAgYm9vbGVhbiBu\nZWVkc05ld2xpbmUgPSBmYWxzZTsKCiAgICAgICAgZm9yIChJdGVyYXRvciBp\nID0gbGluZXMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIE9iamVjdCBuZXh0ID0gaS5uZXh0KCk7CgogICAgICAgICAgICBpZiAo\nbmV4dCBpbnN0YW5jZW9mIFByb3BlcnR5TGluZSkgewogICAgICAgICAgICAg\nICAgaWYgKCgoUHJvcGVydHlMaW5lKSBuZXh0KS53cml0ZSh3cml0ZXIsIGtl\neXMsIG5lZWRzTmV3bGluZSkpCiAgICAgICAgICAgICAgICAgICAgbmVlZHNO\nZXdsaW5lID0gaS5oYXNOZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\nbmV4dCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICAgICAgU3Ry\naW5nIGtleSA9IChTdHJpbmcpIG5leHQ7CiAgICAgICAgICAgICAgICBpZiAo\na2V5cy5yZW1vdmUoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIGlmICh3\ncml0ZVByb3BlcnR5KGtleSwgd3JpdGVyLCBuZWVkc05ld2xpbmUpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIG5lZWRzTmV3bGluZSA9IGkuaGFzTmV4\ndCgpICYmIGtleXMuc2l6ZSgpID4gMDsKCiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGFueSBuZXcgb3IgbW9kaWZpZWQgcHJvcGVydGllcyB3aWxsIGNh\ndXNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBmaWxlIHRvIGVu\nZCB3aXRoIGEgbmV3bGluZQogICAgICAgICAgICAgICAgICAgICAgICBlbmRX\naXRoTmV3bGluZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBtYWtlIHN1cmUgd2UgZW5kIGluIGEgbmV3bGluZSBpZiB0aGUgc291\ncmNlIGVuZGVkIGluIGl0CiAgICAgICAgaWYgKGVuZFdpdGhOZXdsaW5lKQog\nICAgICAgICAgICB3cml0ZXIucHJpbnRsbigpOwoKICAgICAgICB3cml0ZXIu\nZmx1c2goKTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gd3JpdGVQcm9w\nZXJ0eShTdHJpbmcga2V5LCBQcmludFdyaXRlciB3cml0ZXIsCiAgICAgICAg\nYm9vbGVhbiBuZWVkc05ld2xpbmUpIHsKICAgICAgICBTdHJpbmdCdWZmZXIg\ncyA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKCiAgICAgICAgaWYgKGtleSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFN0cmlu\nZyB2YWwgPSBnZXRQcm9wZXJ0eShrZXkpOwogICAgICAgIGlmICh2YWwgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBmb3Jt\nYXRWYWx1ZShrZXksIHMsIHRydWUpOwogICAgICAgIHMuYXBwZW5kKGRlZmF1\nbHRFbnRyeURlbGltaXRlcik7CiAgICAgICAgaWYgKGFkZFdoaXRlc3BhY2VB\nZnRlckRlbGltaXRlcikKICAgICAgICAgICAgcy5hcHBlbmQoJyAnKTsKICAg\nICAgICBmb3JtYXRWYWx1ZSh2YWwsIHMsIGZhbHNlKTsKCiAgICAgICAgaWYg\nKG5lZWRzTmV3bGluZSkKICAgICAgICAgICAgd3JpdGVyLnByaW50bG4oKTsK\nCiAgICAgICAgd3JpdGVyLnByaW50KHMpOwoKICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCB0aGUgZ2l2ZW4gc3Ry\naW5nIGFzIGFuIGVuY29kZWQgdmFsdWUgZm9yIHN0b3JhZ2UuIFRoaXMgd2ls\nbAogICAgICogcGVyZm9ybSBhbnkgbmVjZXNzYXJ5IGVzY2FwaW5nIG9mIHNw\nZWNpYWwgY2hhcmFjdGVycy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyIHRo\nZSB2YWx1ZSB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBidWYgdGhlIGJ1ZmZl\nciB0byB3aGljaCB0byBhcHBlbmQgdGhlIGVuY29kZWQgdmFsdWUKICAgICAq\nIEBwYXJhbSBpc0tleSBpZiB0cnVlLCB0aGVuIHRoZSBzdHJpbmcgaXMgYSBQ\ncm9wZXJ0eSBrZXksIG90aGVyd2lzZQogICAgICogaXQgaXMgYSB2YWx1ZQog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGZvcm1hdFZhbHVlKFN0\ncmluZyBzdHIsIFN0cmluZ0J1ZmZlciBidWYsCiAgICAgICAgYm9vbGVhbiBp\nc0tleSkgewogICAgICAgIGlmIChpc0tleSkgewogICAgICAgICAgICBidWYu\nc2V0TGVuZ3RoKDApOwogICAgICAgICAgICBidWYuZW5zdXJlQ2FwYWNpdHko\nc3RyLmxlbmd0aCgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBi\ndWYuZW5zdXJlQ2FwYWNpdHkoYnVmLmxlbmd0aCgpICsgc3RyLmxlbmd0aCgp\nKTsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gZXNjYXBlU3BhY2UgPSB0\ncnVlOwogICAgICAgIGludCBzaXplID0gc3RyLmxlbmd0aCgpOwoKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAg\nICBjaGFyIGMgPSBzdHIuY2hhckF0KGkpOwoKICAgICAgICAgICAgaWYgKGMg\nPT0gJ1xuJykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxcbiIpOwog\nICAgICAgICAgICBlbHNlIGlmIChjID09ICdccicpCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCJcXHIiKTsKICAgICAgICAgICAgZWxzZSBpZiAoYyA9\nPSAnXHQnKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiXFx0Iik7CiAg\nICAgICAgICAgIGVsc2UgaWYgKGMgPT0gJ1xmJykKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIlxcZiIpOwogICAgICAgICAgICBlbHNlIGlmIChjID09\nICcgJykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZXNjYXBlU3BhY2Ug\nPyAiXFwgIiA6ICIgIik7CiAgICAgICAgICAgIGVsc2UgaWYgKGMgPT0gJ1xc\nJyB8fCBjID09ICchJyB8fCBjID09ICcjJyB8fCBjID09ICc9JyB8fCBjID09\nICc6JykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoJ1xcJykuYXBwZW5k\nKGMpOwogICAgICAgICAgICBlbHNlIGlmIChjIDwgJyAnIHx8IGMgPiAnficp\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCJcXHUwMDAwIi5zdWJzdHJp\nbmcoMCwgNiAtIEludGVnZXIudG9IZXhTdHJpbmcoYykuCiAgICAgICAgICAg\nICAgICAgICAgbGVuZ3RoKCkpKS5hcHBlbmQoSW50ZWdlci50b0hleFN0cmlu\nZyhjKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoYyk7CgogICAgICAgICAgICBpZiAoYyAhPSAnICcpCiAgICAgICAg\nICAgICAgICBlc2NhcGVTcGFjZSA9IGlzS2V5OwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIER1cGxpY2F0ZUtleUV4Y2VwdGlv\nbiBleHRlbmRzIFJ1bnRpbWVFeGNlcHRpb24gewoKICAgICAgICBwdWJsaWMg\nRHVwbGljYXRlS2V5RXhjZXB0aW9uKFN0cmluZyBrZXksIE9iamVjdCBmaXJz\ndFZhbCwKICAgICAgICAgICAgU3RyaW5nIHNlY29uZFZhbCkgewogICAgICAg\nICAgICBzdXBlcihfbG9jLmdldCgiZHVwLWtleSIsIGtleSwgZmlyc3RWYWws\nIHNlY29uZFZhbCkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb250YWlucyB0aGUgb3JpZ2luYWwgbGluZSBvZiB0\naGUgcHJvcGVydGllcyBmaWxlOiBjYW4gYmUgYQogICAgICogcHJvcGVyIGtl\neS92YWx1ZSBwYWlyLCBvciBhIGNvbW1lbnQsIG9yIGp1c3Qgd2hpdGVzcGFj\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBQcm9wZXJ0eUxpbmUgaW1w\nbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFs\nIFN0cmluZ0J1ZmZlciBsaW5lID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAg\nICAgIHByaXZhdGUgU3RyaW5nIHByb3BlcnR5S2V5OwogICAgICAgIHByaXZh\ndGUgU3RyaW5nIHByb3BlcnR5VmFsdWU7CgogICAgICAgIHB1YmxpYyBQcm9w\nZXJ0eUxpbmUoU3RyaW5nIGxpbmUpIHsKICAgICAgICAgICAgdGhpcy5saW5l\nLmFwcGVuZChsaW5lKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIGFwcGVuZChTdHJpbmcgbmV3bGluZSkgewogICAgICAgICAgICBsaW5lLmFw\ncGVuZChKMkRvUHJpdkhlbHBlci5nZXRMaW5lU2VwYXJhdG9yKCkpOwogICAg\nICAgICAgICBsaW5lLmFwcGVuZChuZXdsaW5lKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHNldFByb3BlcnR5S2V5KFN0cmluZyBwcm9wZXJ0\neUtleSkgewogICAgICAgICAgICB0aGlzLnByb3BlcnR5S2V5ID0gcHJvcGVy\ndHlLZXk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFBy\nb3BlcnR5S2V5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0\neUtleTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldFByb3Bl\ncnR5VmFsdWUoU3RyaW5nIHByb3BlcnR5VmFsdWUpIHsKICAgICAgICAgICAg\ndGhpcy5wcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0UHJvcGVydHlWYWx1ZSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydHlWYWx1ZTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFdyaXRlIHRoZSBnaXZlbiBs\naW5lLiBJdCB3aWxsIG9ubHkgYmUgd3JpdHRlbiBpZiB0aGUgbGluZSBpcyBh\nCiAgICAgICAgICogY29tbWVudCwgb3IgaWYgaXQgaXMgYSBwcm9wZXJ0eSBh\nbmQgaXRzIHZhbHVlIGlzIHVuY2hhbmdlZAogICAgICAgICAqIGZyb20gdGhl\nIG9yaWdpbmFsLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHB3IHRo\nZSBQcmludFdyaXRlciB0byB3aGljaCB0aGUgd3JpdGUKICAgICAgICAgKiBA\ncmV0dXJuIHdoZXRoZXIgb3Igbm90IHRoaXMgd2FzIGEga25vd24ga2V5CiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIGJvb2xlYW4gd3JpdGUoUHJpbnRX\ncml0ZXIgcHcsIENvbGxlY3Rpb24ga2V5cywKICAgICAgICAgICAgYm9vbGVh\nbiBuZWVkc05ld2xpbmUpIHsKICAgICAgICAgICAgLy8gbm8gcHJvcGVydHk/\nIEl0IG1heSBiZSBhIGNvbW1lbnQgb3IganVzdCB3aGl0ZXNwYWNlCiAgICAg\nICAgICAgIGlmIChwcm9wZXJ0eUtleSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAobmVlZHNOZXdsaW5lKQogICAgICAgICAgICAgICAgICAgIHB3\nLnByaW50bG4oKTsKICAgICAgICAgICAgICAgIHB3LnByaW50KGxpbmUudG9T\ndHJpbmcoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHdlIGFy\nZSB0aGUgc2FtZSB2YWx1ZSB3ZSBpbml0aWFsbHkgcmVhZDoKICAgICAgICAg\nICAgLy8gaWYgc28sIHRoZW4ganVzdCB3cml0ZSBpdCBiYWNrIGV4YWN0bHkg\nYXMgaXQgd2FzIHJlYWQKICAgICAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUg\nIT0gbnVsbCAmJiBjb250YWluc0tleShwcm9wZXJ0eUtleSkgJiYKICAgICAg\nICAgICAgICAgIChwcm9wZXJ0eVZhbHVlLmVxdWFscyhnZXRQcm9wZXJ0eShw\ncm9wZXJ0eUtleSkpIHx8CiAgICAgICAgICAgICAgICAgICAgKCFuZXdLZXlz\nLmNvbnRhaW5zKHByb3BlcnR5S2V5KSAmJgogICAgICAgICAgICAgICAgICAg\nICAgICAhbW9kaWZpZWRLZXlzLmNvbnRhaW5zKHByb3BlcnR5S2V5KSkpKSB7\nCiAgICAgICAgICAgICAgICBpZiAobmVlZHNOZXdsaW5lKQogICAgICAgICAg\nICAgICAgICAgIHB3LnByaW50bG4oKTsKICAgICAgICAgICAgICAgIHB3LnBy\naW50KGxpbmUudG9TdHJpbmcoKSk7CgogICAgICAgICAgICAgICAga2V5cy5y\nZW1vdmUocHJvcGVydHlLZXkpOwoKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB3ZSBoYXZl\nIG1vZGlmaWVkIG9yIGFkZGVkIHRoZSBzcGVjaWZpZWQga2V5LCB0aGVuIHdy\naXRlCiAgICAgICAgICAgIC8vIGl0IGJhY2sgdG8gdGhlIHNhbWUgbG9jYXRp\nb24gaW4gdGhlIGZpbGUgZnJvbSB3aGljaCBpdAogICAgICAgICAgICAvLyB3\nYXMgb3JpZ2luYWxseSByZWFkLCBzbyB0aGF0IGl0IHdpbGwgYmUgaW4gdGhl\nIHByb3hpbWl0eQogICAgICAgICAgICAvLyB0byB0aGUgY29tbWVudAogICAg\nICAgICAgICBpZiAoY29udGFpbnNLZXkocHJvcGVydHlLZXkpICYmCiAgICAg\nICAgICAgICAgICAobW9kaWZpZWRLZXlzLmNvbnRhaW5zKHByb3BlcnR5S2V5\nKSB8fAogICAgICAgICAgICAgICAgICAgIG5ld0tleXMuY29udGFpbnMocHJv\ncGVydHlLZXkpKSkgewogICAgICAgICAgICAgICAgd2hpbGUgKGtleXMucmVt\nb3ZlKHByb3BlcnR5S2V5KSkgOwogICAgICAgICAgICAgICAgcmV0dXJuIHdy\naXRlUHJvcGVydHkocHJvcGVydHlLZXksIHB3LCBuZWVkc05ld2xpbmUpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB0aGlzIGlzIGEgbmV3IG9y\nIGNoYW5nZWQgcHJvcGVydHk6IGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBjbGFzcyBQcm9wZXJ0eUxpbmVSZWFkZXIgZXh0ZW5kcyBCdWZmZXJlZFJl\nYWRlciB7CgogICAgICAgIHB1YmxpYyBQcm9wZXJ0eUxpbmVSZWFkZXIoSW5w\ndXRTdHJlYW0gaW4sIFByb3BlcnR5U291cmNlIHNvdXJjZSkKICAgICAgICAg\nICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gTXVzdCBi\nZSBJU08tODg1OS0xIGVjb2RpbmcgYWNjb3JkaW5nIHRvIFByb3BlcnRpZXMu\nbG9hZCBqYXZhZG9jCiAgICAgICAgICAgIHN1cGVyKG5ldyBJbnB1dFN0cmVh\nbVJlYWRlcihuZXcgTGluZUVuZGluZ1N0cmVhbShpbiwgc291cmNlKSwKICAg\nICAgICAgICAgICAgICJJU08tODg1OS0xIikpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIFByb3BlcnR5TGluZSByZWFkUHJvcGVydHlMaW5lKCkgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgU3RyaW5nIGwgPSByZWFk\nTGluZSgpOwogICAgICAgICAgICBpZiAobCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBQcm9wZXJ0eUxpbmUg\ncGwgPSBuZXcgUHJvcGVydHlMaW5lKGwpOwogICAgICAgICAgICByZXR1cm4g\ncGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2ltcGxlIEZp\nbHRlcklucHV0U3RyZWFtIHRoYXQgbWVyZWx5IHJlbWVtYmVycyBpZiB0aGUg\nbGFzdAogICAgICogY2hhcmFjdGVyIHRoYXQgaXQgcmVhZCB3YXMgYSBuZXds\naW5lIG9yIG5vdC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nTGluZUVuZGluZ1N0cmVhbSBleHRlbmRzIEZpbHRlcklucHV0U3RyZWFtIHsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBQcm9wZXJ0eVNvdXJjZSBzb3VyY2U7\nCgogICAgICAgIExpbmVFbmRpbmdTdHJlYW0oSW5wdXRTdHJlYW0gaW4sIFBy\nb3BlcnR5U291cmNlIHNvdXJjZSkgewogICAgICAgICAgICBzdXBlcihpbik7\nCgogICAgICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgcmVhZCgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIGludCBjID0gc3VwZXIucmVhZCgpOwogICAgICAg\nICAgICBzb3VyY2UuZW5kc0luTmV3bGluZSA9IChjID09ICdcbicgfHwgYyA9\nPSAnXHInKTsKICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgaW50IHJlYWQoYnl0ZVtdIGIsIGludCBvZmYsIGludCBs\nZW4pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIGludCBuID0g\nc3VwZXIucmVhZChiLCBvZmYsIGxlbik7CiAgICAgICAgICAgIGlmIChuID4g\nMCkKICAgICAgICAgICAgICAgIHNvdXJjZS5lbmRzSW5OZXdsaW5lID0KICAg\nICAgICAgICAgICAgICAgICAoYltuICsgb2ZmIC0gMV0gPT0gJ1xuJyB8fCBi\nW24gKyBvZmYgLSAxXSA9PSAnXHInKTsKICAgICAgICAgICAgcmV0dXJuIG47\nCiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBjbGFzcyBQcm9wZXJ0eVNv\ndXJjZSBleHRlbmRzIExpbmtlZExpc3QKICAgICAgICBpbXBsZW1lbnRzIENs\nb25lYWJsZSwgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHJpdmF0ZSBib29s\nZWFuIGVuZHNJbk5ld2xpbmUgPSBmYWxzZTsKICAgIH0KfQo=\n","encoding":"base64"}

