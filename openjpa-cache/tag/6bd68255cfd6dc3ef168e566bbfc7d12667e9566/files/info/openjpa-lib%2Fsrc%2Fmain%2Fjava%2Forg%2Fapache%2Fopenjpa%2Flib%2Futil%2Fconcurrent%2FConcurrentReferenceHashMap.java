{"sha":"0c6a8ddac5d1e560ba5762cbc23d75281f94d8c2","node_id":"MDQ6QmxvYjIwNjM2NDowYzZhOGRkYWM1ZDFlNTYwYmE1NzYyY2JjMjNkNzUyODFmOTRkOGMy","size":34020,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0c6a8ddac5d1e560ba5762cbc23d75281f94d8c2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVu\ndDsKCmltcG9ydCBqYXZhLmxhbmcucmVmLlJlZmVyZW5jZVF1ZXVlOwppbXBv\ncnQgamF2YS5sYW5nLnJlZi5Tb2Z0UmVmZXJlbmNlOwppbXBvcnQgamF2YS5s\nYW5nLnJlZi5XZWFrUmVmZXJlbmNlOwppbXBvcnQgamF2YS51dGlsLkFic3Ry\nYWN0TWFwOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBq\nYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBv\ncnQgamF2YS51dGlsLk5vU3VjaEVsZW1lbnRFeGNlcHRpb247CmltcG9ydCBq\nYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlTWFwOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlNpemVkTWFwOwoK\nLyoqCiAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIEhhc2hNYXAgd2hpY2gg\naGFzIGxpbWl0ZWQgc3luY2hyb25pemF0aW9uCiAqIGFuZCByZWZlcmVuY2Ug\na2V5cyBvciB2YWx1ZXMoYnV0IG5vdCBib3RoKS4gSW4gcGFydGljdWxhciBt\ndXRhdG9ycyBhcmUKICogZ2VuZXJhbGx5IHN5bmNocm9uaXplZCB3aGlsZSBh\nY2Nlc3NvcnMgYXJlIGdlbmVyYWxseSBub3QuIEFkZGl0aW9uYWxseSB0aGUK\nICogSXRlcmF0b3JzIHJldHVybmVkIGJ5IHRoaXMgY2xhc3MgYXJlIG5vdCAi\nZmFpbC1mYXN0IiwgYnV0IGluc3RlYWQgdHJ5IHRvCiAqIGNvbnRpbnVlIHRv\nIGl0ZXJhdGUgb3ZlciB0aGUgZGF0YSBzdHJ1Y3R1cmUgYWZ0ZXIgY2hhbmdl\ncyBoYXZlIGJlZW4KICogbWFkZS4gRmluYWxseSBwdXJnaW5nIG9mIHRoZSBy\nZWZlcmVuY2UgcXVldWUgaXMgb25seSBkb25lIGluc2lkZSBtdXRhdG9ycy4K\nICogTnVsbCBrZXlzIGFyZSBub3Qgc3VwcG9ydGVkIGlmIGtleXMgdXNlIHJl\nZmVyZW5jZXMuIE51bGwgdmFsdWVzIGFyZSBub3QKICogc3VwcG9ydGVkIGlm\nIHZhbHVlcyB1c2UgcmVmZXJlbmNlcy4KICogVGhpcyBjbGFzcyBpcyBiYXNl\nZCBoZWF2aWx5IG9uIHRoZSBXZWFrSGFzaE1hcCBjbGFzcyBpbiB0aGUgSmF2\nYQogKiBjb2xsZWN0aW9ucyBwYWNrYWdlLgogKi8KcHVibGljIGNsYXNzIENv\nbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwIGV4dGVuZHMgQWJzdHJhY3RNYXAK\nICAgIGltcGxlbWVudHMgQ29uY3VycmVudE1hcCwgUmVmZXJlbmNlTWFwLCBT\naXplZE1hcCwgQ2xvbmVhYmxlIHsKCiAgICAvKioKICAgICAqIENhY2hlIG9m\nIHJhbmRvbSBudW1iZXJzIHVzZWQgaW4gInJhbmRvbSIgbWV0aG9kcywgc2lu\nY2UgZ2VuZXJhdGluZyB0aGVtCiAgICAgKiBpcyBleHBlbnNpdmUuIFdlIGhv\ncGUgZWFjaCBtYXAgY2hhbmdlcyBlbm91Z2ggYmV0d2VlbiBjeWNsaW5nIHRo\ncm91Z2gKICAgICAqIHRoaXMgbGlzdCB0aGF0IHRoZSBvdmVyYWxsIGVmZmVj\ndCBpcyByYW5kb20gZW5vdWdoLgogICAgICovCiAgICBzdGF0aWMgZmluYWwg\nZG91YmxlW10gUkFORE9NUyA9IG5ldyBkb3VibGVbMTAwMF07CgogICAgc3Rh\ndGljIHsKICAgICAgICBSYW5kb20gcmFuZG9tID0gbmV3IFJhbmRvbSgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUkFORE9NUy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgUkFORE9NU1tpXSA9IHJhbmRvbS5uZXh0RG91Ymxl\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaGFzaCB0YWJsZSBkYXRh\nLgogICAgICovCiAgICBwcml2YXRlIHRyYW5zaWVudCBFbnRyeVtdIHRhYmxl\nOwoKICAgIC8qKgogICAgICogVGhlIHRvdGFsIG51bWJlciBvZiBlbnRyaWVz\nIGluIHRoZSBoYXNoIHRhYmxlLgogICAgICovCiAgICBwcml2YXRlIHRyYW5z\naWVudCBpbnQgY291bnQ7CgogICAgLyoqCiAgICAgKiBSZWhhc2hlcyB0aGUg\ndGFibGUgd2hlbiBjb3VudCBleGNlZWRzIHRoaXMgdGhyZXNob2xkLgogICAg\nICovCiAgICBwcml2YXRlIGludCB0aHJlc2hvbGQ7CgogICAgLyoqCiAgICAg\nKiBUaGUgbG9hZCBmYWN0b3IgZm9yIHRoZSBIYXNoTWFwLgogICAgICovCiAg\nICBwcml2YXRlIGZsb2F0IGxvYWRGYWN0b3I7CgogICAgLyoqCiAgICAgKiBU\naGUga2V5IHJlZmVyZW5jZSB0eXBlLgogICAgICovCiAgICBwcml2YXRlIGlu\ndCBrZXlUeXBlOwoKICAgIC8qKgogICAgICogVGhlIHZhbHVlIHJlZmVyZW5j\nZSB0eXBlLgogICAgICovCiAgICBwcml2YXRlIGludCB2YWx1ZVR5cGU7Cgog\nICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgcXVldWUgZm9yIGNsZWFyZWQgRW50\ncmllcwogICAgICovCiAgICBwcml2YXRlIGZpbmFsIFJlZmVyZW5jZVF1ZXVl\nIHF1ZXVlID0gbmV3IFJlZmVyZW5jZVF1ZXVlKCk7CgogICAgLyoqCiAgICAg\nKiBTcHJlYWQgInJhbmRvbSIgcmVtb3ZlcyBhbmQgaXRlcmF0aW9uLgogICAg\nICovCiAgICBwcml2YXRlIGludCByYW5kb21FbnRyeSA9IDA7CgogICAgLyoq\nCiAgICAgKiBNYXhpbXVtIGVudHJpZXMuCiAgICAgKi8KICAgIHByaXZhdGUg\naW50IG1heFNpemUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKCiAgICAvKioKICAg\nICAqIENvbXBhcmUgdHdvIG9iamVjdHMuIFRoZXNlIG1pZ2h0IGJlIGtleXMs\nIHZhbHVlcywgb3IgRW50cnkgaW5zdGFuY2VzLgogICAgICogVGhpcyBpbXBs\nZW1lbnRhdGlvbiB1c2VzIGEgbm9ybWFsIG51bGwtc2FmZSBvYmplY3QgZXF1\nYWxpdHkgYWxnb3JpdGhtLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBlcShPYmplY3QgeCwgT2Jq\nZWN0IHkpIHsKICAgICAgICByZXR1cm4geCA9PSB5IHx8ICh4ICE9IG51bGwg\nJiYgeC5lcXVhbHMoeSkpOwogICAgfQoKICAgIC8qKgogICAgICogT2J0YWlu\nIHRoZSBoYXNoY29kZSBvZiBhbiBvYmplY3QuIFRoZSBvYmplY3QgbWlnaHQg\nYmUgYSBrZXksIGEgdmFsdWUsCiAgICAgKiBvciBhbiBFbnRyeS4gVGhpcyBp\nbXBsZW1lbnRhdGlvbiBqdXN0IGRlbGVnYXRlcyB0bwogICAgICoge0BsaW5r\nIE9iamVjdCNoYXNoQ29kZX0KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAK\nICAgICAqLwogICAgcHJvdGVjdGVkIGludCBoYyhPYmplY3QgbykgewogICAg\nICAgIHJldHVybiBvID09IG51bGwgPyAwIDogby5oYXNoQ29kZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0cyBhIG5ldywgZW1wdHkgSGFz\naE1hcCB3aXRoIHRoZSBzcGVjaWZpZWQgaW5pdGlhbAogICAgICogY2FwYWNp\ndHkgYW5kIHRoZSBzcGVjaWZpZWQgbG9hZCBmYWN0b3IuCiAgICAgKgogICAg\nICogQHBhcmFtIGtleVR5cGUgdGhlIHJlZmVyZW5jZSB0eXBlIG9mIG1hcCBr\nZXlzCiAgICAgKiBAcGFyYW0gdmFsdWVUeXBlIHRoZSByZWZlcmVuY2UgdHlw\nZSBvZiBtYXAgdmFsdWVzCiAgICAgKiBAcGFyYW0gaW5pdGlhbENhcGFjaXR5\nIHRoZSBpbml0aWFsIGNhcGFjaXR5IG9mIHRoZSBIYXNoTWFwLgogICAgICog\nQHBhcmFtIGxvYWRGYWN0b3IgYSBudW1iZXIgYmV0d2VlbiAwLjAgYW5kIDEu\nMC4KICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlm\nIG5laXRoZXIga2V5cyBub3IgdmFsdWVzIHVzZSBoYXJkCiAgICAgKiByZWZl\ncmVuY2VzLCBpZiB0aGUgaW5pdGlhbCBjYXBhY2l0eSBpcyBsZXNzIHRoYW4g\nb3IgZXF1YWwgdG8gemVybywgb3IgaWYKICAgICAqIHRoZSBsb2FkIGZhY3Rv\nciBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gemVybwogICAgICovCiAgICBw\ndWJsaWMgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoaW50IGtleVR5cGUs\nIGludCB2YWx1ZVR5cGUsCiAgICAgICAgaW50IGluaXRpYWxDYXBhY2l0eSwg\nZmxvYXQgbG9hZEZhY3RvcikgewogICAgICAgIGlmIChpbml0aWFsQ2FwYWNp\ndHkgPCAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24oIklsbGVnYWwgSW5pdGlhbCBDYXBhY2l0eTogIiArCiAg\nICAgICAgICAgICAgICBpbml0aWFsQ2FwYWNpdHkpOwogICAgICAgIH0KICAg\nICAgICBpZiAoKGxvYWRGYWN0b3IgPiAxKSB8fCAobG9hZEZhY3RvciA8PSAw\nKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uKCJJbGxlZ2FsIExvYWQgZmFjdG9yOiAiICsKICAgICAgICAgICAg\nICAgIGxvYWRGYWN0b3IpOwogICAgICAgIH0KICAgICAgICBpZiAoa2V5VHlw\nZSAhPSBIQVJEICYmIHZhbHVlVHlwZSAhPSBIQVJEKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIkVpdGhlciBr\nZXlzIG9yIHZhbHVlcyBtdXN0ICIgKwogICAgICAgICAgICAgICAgInVzZSBo\nYXJkIHJlZmVyZW5jZXMuIik7CiAgICAgICAgfQogICAgICAgIHRoaXMua2V5\nVHlwZSA9IGtleVR5cGU7CiAgICAgICAgdGhpcy52YWx1ZVR5cGUgPSB2YWx1\nZVR5cGU7CiAgICAgICAgdGhpcy5sb2FkRmFjdG9yID0gbG9hZEZhY3RvcjsK\nICAgICAgICB0YWJsZSA9IG5ldyBFbnRyeVtpbml0aWFsQ2FwYWNpdHldOwog\nICAgICAgIHRocmVzaG9sZCA9IChpbnQpIChpbml0aWFsQ2FwYWNpdHkgKiBs\nb2FkRmFjdG9yKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdHMg\nYSBuZXcsIGVtcHR5IEhhc2hNYXAgd2l0aCB0aGUgc3BlY2lmaWVkIGluaXRp\nYWwgY2FwYWNpdHkKICAgICAqIGFuZCBkZWZhdWx0IGxvYWQgZmFjdG9yLgog\nICAgICoKICAgICAqIEBwYXJhbSBrZXlUeXBlIHRoZSByZWZlcmVuY2UgdHlw\nZSBvZiBtYXAga2V5cwogICAgICogQHBhcmFtIHZhbHVlVHlwZSB0aGUgcmVm\nZXJlbmNlIHR5cGUgb2YgbWFwIHZhbHVlcwogICAgICogQHBhcmFtIGluaXRp\nYWxDYXBhY2l0eSB0aGUgaW5pdGlhbCBjYXBhY2l0eSBvZiB0aGUgSGFzaE1h\ncC4KICAgICAqLwogICAgcHVibGljIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNo\nTWFwKGludCBrZXlUeXBlLCBpbnQgdmFsdWVUeXBlLAogICAgICAgIGludCBp\nbml0aWFsQ2FwYWNpdHkpIHsKICAgICAgICB0aGlzKGtleVR5cGUsIHZhbHVl\nVHlwZSwgaW5pdGlhbENhcGFjaXR5LCAwLjc1Zik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3LCBlbXB0eSBIYXNoTWFwIHdpdGgg\nYSBkZWZhdWx0IGNhcGFjaXR5IGFuZCBsb2FkIGZhY3Rvci4KICAgICAqCiAg\nICAgKiBAcGFyYW0ga2V5VHlwZSB0aGUgcmVmZXJlbmNlIHR5cGUgb2YgbWFw\nIGtleXMKICAgICAqIEBwYXJhbSB2YWx1ZVR5cGUgdGhlIHJlZmVyZW5jZSB0\neXBlIG9mIG1hcCB2YWx1ZXMKICAgICAqLwogICAgcHVibGljIENvbmN1cnJl\nbnRSZWZlcmVuY2VIYXNoTWFwKGludCBrZXlUeXBlLCBpbnQgdmFsdWVUeXBl\nKSB7CiAgICAgICAgdGhpcyhrZXlUeXBlLCB2YWx1ZVR5cGUsIDExLCAwLjc1\nZik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IEhh\nc2hNYXAgd2l0aCB0aGUgc2FtZSBtYXBwaW5ncyBhcyB0aGUgZ2l2ZW4KICAg\nICAqIE1hcC4gVGhlIEhhc2hNYXAgaXMgY3JlYXRlZCB3aXRoIGEgY2FwYWNp\ndHkgb2YgdGhyaWNlIHRoZSBudW1iZXIKICAgICAqIG9mIGVudHJpZXMgaW4g\ndGhlIGdpdmVuIE1hcCBvciAxMSAod2hpY2hldmVyIGlzIGdyZWF0ZXIpLCBh\nbmQgYQogICAgICogZGVmYXVsdCBsb2FkIGZhY3Rvci4KICAgICAqCiAgICAg\nKiBAcGFyYW0ga2V5VHlwZSB0aGUgcmVmZXJlbmNlIHR5cGUgb2YgbWFwIGtl\neXMKICAgICAqIEBwYXJhbSB2YWx1ZVR5cGUgdGhlIHJlZmVyZW5jZSB0eXBl\nIG9mIG1hcCB2YWx1ZXMKICAgICAqLwogICAgcHVibGljIENvbmN1cnJlbnRS\nZWZlcmVuY2VIYXNoTWFwKGludCBrZXlUeXBlLCBpbnQgdmFsdWVUeXBlLCBN\nYXAgdCkgewogICAgICAgIHRoaXMoa2V5VHlwZSwgdmFsdWVUeXBlLCBNYXRo\nLm1heCgzICogdC5zaXplKCksIDExKSwgMC43NWYpOwogICAgICAgIHB1dEFs\nbCh0KTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldE1heFNpemUoKSB7CiAg\nICAgICAgcmV0dXJuIG1heFNpemU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0TWF4U2l6ZShpbnQgbWF4U2l6ZSkgewogICAgICAgIHRoaXMubWF4U2l6\nZSA9IChtYXhTaXplIDwgMCkgPyBJbnRlZ2VyLk1BWF9WQUxVRSA6IG1heFNp\nemU7CiAgICAgICAgaWYgKHRoaXMubWF4U2l6ZSAhPSBJbnRlZ2VyLk1BWF9W\nQUxVRSkKICAgICAgICAgICAgcmVtb3ZlT3ZlcmZsb3codGhpcy5tYXhTaXpl\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Z1bGwoKSB7CiAgICAg\nICAgcmV0dXJuIG1heFNpemUgIT0gSW50ZWdlci5NQVhfVkFMVUUgJiYgc2l6\nZSgpID49IG1heFNpemU7CiAgICB9CgogICAgcHVibGljIHZvaWQgb3ZlcmZs\nb3dSZW1vdmVkKE9iamVjdCBrZXksIE9iamVjdCB2YWx1ZSkgewogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGtleS12YWx1\nZSBtYXBwaW5ncyBpbiB0aGlzIE1hcC4gVGhpcwogICAgICogcmVzdWx0IGlz\nIGEgc25hcHNob3QsIGFuZCBtYXkgbm90IHJlZmxlY3QgdW5wcm9jZXNzZWQg\nZW50cmllcwogICAgICogdGhhdCB3aWxsIGJlIHJlbW92ZWQgYmVmb3JlIG5l\neHQgYXR0ZW1wdGVkIGFjY2VzcyBiZWNhdXNlIHRoZXkKICAgICAqIGFyZSBu\nbyBsb25nZXIgcmVmZXJlbmNlZC4KICAgICAqLwogICAgcHVibGljIGludCBz\naXplKCkgewogICAgICAgIHJldHVybiBjb3VudDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIE1hcCBjb250YWlucyBubyBr\nZXktdmFsdWUgbWFwcGluZ3MuIFRoaXMKICAgICAqIHJlc3VsdCBpcyBhIHNu\nYXBzaG90LCBhbmQgbWF5IG5vdCByZWZsZWN0IHVucHJvY2Vzc2VkIGVudHJp\nZXMKICAgICAqIHRoYXQgd2lsbCBiZSByZW1vdmVkIGJlZm9yZSBuZXh0IGF0\ndGVtcHRlZCBhY2Nlc3MgYmVjYXVzZSB0aGV5CiAgICAgKiBhcmUgbm8gbG9u\nZ2VyIHJlZmVyZW5jZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlz\nRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIGNvdW50ID09IDA7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBIYXNoTWFwIG1h\ncHMgb25lIG9yIG1vcmUga2V5cyB0byB0aGUgc3BlY2lmaWVkCiAgICAgKiB2\nYWx1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWUgd2hvc2Ug\ncHJlc2VuY2UgaW4gdGhpcyBNYXAgaXMgdG8gYmUgdGVzdGVkLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBjb250YWluc1ZhbHVlKE9iamVjdCB2YWx1\nZSkgewogICAgICAgIEVudHJ5W10gdGFiID0gdGFibGU7CgogICAgICAgIGlm\nICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZVR5cGUg\nIT0gSEFSRCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IHRhYi5sZW5ndGg7IGktLSA+IDA7KQogICAg\nICAgICAgICAgICAgZm9yIChFbnRyeSBlID0gdGFiW2ldOyBlICE9IG51bGw7\nIGUgPSBlLmdldE5leHQoKSkKICAgICAgICAgICAgICAgICAgICBpZiAoZS5n\nZXRWYWx1ZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSB0YWIubGVuZ3RoOyBpLS0gPiAwOykKICAgICAgICAgICAgICAg\nIGZvciAoRW50cnkgZSA9IHRhYltpXTsgZSAhPSBudWxsOyBlID0gZS5nZXRO\nZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKGVxKHZhbHVlLCBlLmdl\ndFZhbHVlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgSGFzaE1hcCBjb250\nYWlucyBhIG1hcHBpbmcgZm9yIHRoZSBzcGVjaWZpZWQga2V5LgogICAgICoK\nICAgICAqIEBwYXJhbSBrZXkga2V5IHdob3NlIHByZXNlbmNlIGluIHRoaXMg\nTWFwIGlzIHRvIGJlIHRlc3RlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gY29udGFpbnNLZXkoT2JqZWN0IGtleSkgewogICAgICAgIGlmIChrZXkg\nPT0gbnVsbCAmJiBrZXlUeXBlICE9IEhBUkQpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgRW50cnlbXSB0YWIgPSB0YWJsZTsKICAgICAg\nICBpbnQgaGFzaCA9IGhjKGtleSk7CiAgICAgICAgaW50IGluZGV4ID0gKGhh\nc2ggJiAweDdGRkZGRkZGKSAlIHRhYi5sZW5ndGg7CiAgICAgICAgZm9yIChF\nbnRyeSBlID0gdGFiW2luZGV4XTsgZSAhPSBudWxsOyBlID0gZS5nZXROZXh0\nKCkpCiAgICAgICAgICAgIGlmIChlLmdldEhhc2goKSA9PSBoYXNoICYmIGVx\nKGtleSwgZS5nZXRLZXkoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSB2YWx1ZSB0byB3aGljaCB0aGlzIEhhc2hNYXAgbWFw\ncyB0aGUgc3BlY2lmaWVkIGtleS4KICAgICAqIFJldHVybnMgbnVsbCBpZiB0\naGUgSGFzaE1hcCBjb250YWlucyBubyBtYXBwaW5nIGZvciB0aGlzIGtleS4K\nICAgICAqCiAgICAgKiBAcGFyYW0ga2V5IGtleSB3aG9zZSBhc3NvY2lhdGVk\nIHZhbHVlIGlzIHRvIGJlIHJldHVybmVkLgogICAgICovCiAgICBwdWJsaWMg\nT2JqZWN0IGdldChPYmplY3Qga2V5KSB7CiAgICAgICAgaWYgKGtleSA9PSBu\ndWxsICYmIGtleVR5cGUgIT0gSEFSRCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIEVudHJ5W10gdGFiID0gdGFibGU7CiAgICAgICAgaW50\nIGhhc2ggPSBoYyhrZXkpOwogICAgICAgIGludCBpbmRleCA9IChoYXNoICYg\nMHg3RkZGRkZGRikgJSB0YWIubGVuZ3RoOwogICAgICAgIGZvciAoRW50cnkg\nZSA9IHRhYltpbmRleF07IGUgIT0gbnVsbDsgZSA9IGUuZ2V0TmV4dCgpKQog\nICAgICAgICAgICBpZiAoKGUuZ2V0SGFzaCgpID09IGhhc2gpICYmIGVxKGtl\neSwgZS5nZXRLZXkoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZS5nZXRW\nYWx1ZSgpOwoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlaGFzaGVzIHRoZSBjb250ZW50cyBvZiB0aGUgSGFzaE1hcCBp\nbnRvIGEgSGFzaE1hcCB3aXRoIGEKICAgICAqIGxhcmdlciBjYXBhY2l0eS4g\nVGhpcyBtZXRob2QgaXMgY2FsbGVkIGF1dG9tYXRpY2FsbHkgd2hlbiB0aGUK\nICAgICAqIG51bWJlciBvZiBrZXlzIGluIHRoZSBIYXNoTWFwIGV4Y2VlZHMg\ndGhpcyBIYXNoTWFwJ3MgY2FwYWNpdHkKICAgICAqIGFuZCBsb2FkIGZhY3Rv\nci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlaGFzaCgpIHsKICAgICAg\nICBpbnQgb2xkQ2FwYWNpdHkgPSB0YWJsZS5sZW5ndGg7CiAgICAgICAgRW50\ncnkgb2xkTWFwW10gPSB0YWJsZTsKCiAgICAgICAgaW50IG5ld0NhcGFjaXR5\nID0gb2xkQ2FwYWNpdHkgKiAyICsgMTsKICAgICAgICBFbnRyeSBuZXdNYXBb\nXSA9IG5ldyBFbnRyeVtuZXdDYXBhY2l0eV07CgogICAgICAgIGZvciAoaW50\nIGkgPSBvbGRDYXBhY2l0eTsgaS0tID4gMDspIHsKICAgICAgICAgICAgZm9y\nIChFbnRyeSBvbGQgPSBvbGRNYXBbaV07IG9sZCAhPSBudWxsOykgewogICAg\nICAgICAgICAgICAgaWYgKChrZXlUeXBlICE9IEhBUkQgJiYgb2xkLmdldEtl\neSgpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgfHwgdmFsdWVUeXBl\nICE9IEhBUkQgJiYgb2xkLmdldFZhbHVlKCkgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIEVudHJ5IGUgPSBvbGQ7CiAgICAgICAgICAgICAgICAg\nICAgb2xkID0gb2xkLmdldE5leHQoKTsKICAgICAgICAgICAgICAgICAgICBl\nLnNldE5leHQobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgY291bnQtLTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nRW50cnkgZSA9IChFbnRyeSkgb2xkLmNsb25lKHF1ZXVlKTsKICAgICAgICAg\nICAgICAgICAgICBvbGQgPSBvbGQuZ2V0TmV4dCgpOwoKICAgICAgICAgICAg\nICAgICAgICBpbnQgaW5kZXggPSAoZS5nZXRIYXNoKCkgJiAweDdGRkZGRkZG\nKSAlIG5ld0NhcGFjaXR5OwogICAgICAgICAgICAgICAgICAgIGUuc2V0TmV4\ndChuZXdNYXBbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgICBuZXdNYXBb\naW5kZXhdID0gZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgdGhyZXNob2xkID0gKGludCkgKG5ld0NhcGFj\naXR5ICogbG9hZEZhY3Rvcik7CiAgICAgICAgdGFibGUgPSBuZXdNYXA7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBc3NvY2lhdGVzIHRoZSBzcGVjaWZpZWQg\ndmFsdWUgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBpbiB0aGlzIEhhc2hNYXAu\nCiAgICAgKiBJZiB0aGUgSGFzaE1hcCBwcmV2aW91c2x5IGNvbnRhaW5lZCBh\nIG1hcHBpbmcgZm9yIHRoaXMga2V5LCB0aGUgb2xkCiAgICAgKiB2YWx1ZSBp\ncyByZXBsYWNlZC4KICAgICAqCiAgICAgKiBAcGFyYW0ga2V5IGtleSB3aXRo\nIHdoaWNoIHRoZSBzcGVjaWZpZWQgdmFsdWUgaXMgdG8gYmUgYXNzb2NpYXRl\nZC4KICAgICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZSB0byBiZSBhc3NvY2lhdGVk\nIHdpdGggdGhlIHNwZWNpZmllZCBrZXkuCiAgICAgKiBAcmV0dXJuIHByZXZp\nb3VzIHZhbHVlIGFzc29jaWF0ZWQgd2l0aCBzcGVjaWZpZWQga2V5LCBvciBu\ndWxsIGlmIHRoZXJlCiAgICAgKiB3YXMgbm8gbWFwcGluZyBmb3Iga2V5LiBB\nIG51bGwgcmV0dXJuIGNhbiBhbHNvIGluZGljYXRlIHRoYXQKICAgICAqIHRo\nZSBIYXNoTWFwIHByZXZpb3VzbHkgYXNzb2NpYXRlZCBudWxsIHdpdGggdGhl\nIHNwZWNpZmllZCBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgcHV0\nKE9iamVjdCBrZXksIE9iamVjdCB2YWx1ZSkgewogICAgICAgIGlmICgoa2V5\nID09IG51bGwgJiYga2V5VHlwZSAhPSBIQVJEKQogICAgICAgICAgICB8fCAo\ndmFsdWUgPT0gbnVsbCAmJiB2YWx1ZVR5cGUgIT0gSEFSRCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIk51bGwg\ncmVmZXJlbmNlcyBub3Qgc3VwcG9ydGVkIik7CgogICAgICAgIGludCBoYXNo\nID0gaGMoa2V5KTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAg\nICAgICAgICAgZXhwdW5nZVN0YWxlRW50cmllcygpOwoKICAgICAgICAgICAg\nRW50cnlbXSB0YWIgPSB0YWJsZTsKICAgICAgICAgICAgaW50IGluZGV4ID0g\nMDsKCiAgICAgICAgICAgIGluZGV4ID0gKGhhc2ggJiAweDdGRkZGRkZGKSAl\nIHRhYi5sZW5ndGg7CiAgICAgICAgICAgIGZvciAoRW50cnkgZSA9IHRhYltp\nbmRleF0sIHByZXYgPSBudWxsOyBlICE9IG51bGw7IHByZXYgPSBlLAogICAg\nICAgICAgICAgICAgZSA9IGUuZ2V0TmV4dCgpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoKGUuZ2V0SGFzaCgpID09IGhhc2gpICYmIGVxKGtleSwgZS5nZXRL\nZXkoKSkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qgb2xkID0gZS5n\nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVR5cGUg\nPT0gSEFSRCkKICAgICAgICAgICAgICAgICAgICAgICAgZS5zZXRWYWx1ZSh2\nYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGUgPSBuZXdFbnRyeShoYXNoLCBlLmdldEtleSgpLCB2\nYWx1ZSwgZS5nZXROZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAocHJldiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndGFiW2luZGV4XSA9IGU7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXYuc2V0TmV4dChlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG9sZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKGNvdW50ID49IHRocmVzaG9sZCkgewogICAgICAgICAg\nICAgICAgLy8gUmVoYXNoIHRoZSB0YWJsZSBpZiB0aGUgdGhyZXNob2xkIGlz\nIGV4Y2VlZGVkCiAgICAgICAgICAgICAgICByZWhhc2goKTsKCiAgICAgICAg\nICAgICAgICB0YWIgPSB0YWJsZTsKICAgICAgICAgICAgICAgIGluZGV4ID0g\nKGhhc2ggJiAweDdGRkZGRkZGKSAlIHRhYi5sZW5ndGg7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChtYXhTaXplICE9IEludGVnZXIuTUFYX1ZB\nTFVFKQogICAgICAgICAgICAgICAgcmVtb3ZlT3ZlcmZsb3cobWF4U2l6ZSAt\nIDEpOwogICAgICAgICAgICB0YWJbaW5kZXhdID0gbmV3RW50cnkoaGFzaCwg\na2V5LCB2YWx1ZSwgdGFiW2luZGV4XSk7CiAgICAgICAgICAgIGNvdW50Kys7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlcyBhIG5ldyBlbnRyeS4KICAgICAqLwogICAgcHJp\ndmF0ZSBFbnRyeSBuZXdFbnRyeShpbnQgaGFzaCwgT2JqZWN0IGtleSwgT2Jq\nZWN0IHZhbHVlLCBFbnRyeSBuZXh0KSB7CiAgICAgICAgaW50IHJlZlR5cGUg\nPSAoa2V5VHlwZSAhPSBIQVJEKSA/IGtleVR5cGUgOiB2YWx1ZVR5cGU7CiAg\nICAgICAgc3dpdGNoIChyZWZUeXBlKSB7CiAgICAgICAgICAgIGNhc2UgV0VB\nSzoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgV2Vha0VudHJ5KGhhc2gs\nIGtleSwgdmFsdWUsIHJlZlR5cGUgPT0ga2V5VHlwZSwgbmV4dCwKICAgICAg\nICAgICAgICAgICAgICBxdWV1ZSk7CiAgICAgICAgICAgIGNhc2UgU09GVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU29mdEVudHJ5KGhhc2gsIGtl\neSwgdmFsdWUsIHJlZlR5cGUgPT0ga2V5VHlwZSwgbmV4dCwKICAgICAgICAg\nICAgICAgICAgICBxdWV1ZSk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEhhcmRFbnRyeShoYXNoLCBrZXksIHZh\nbHVlLCBuZXh0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYW55IGVudHJpZXMgZXF1YWwgdG8gb3Igb3ZlciB0aGUgbWF4IHNp\nemUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZW1vdmVPdmVyZmxvdyhp\nbnQgbWF4U2l6ZSkgewogICAgICAgIHdoaWxlIChjb3VudCA+IG1heFNpemUp\nIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5ID0gcmVtb3ZlUmFuZG9t\nKCk7CiAgICAgICAgICAgIGlmIChlbnRyeSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIG92ZXJmbG93UmVtb3ZlZChlbnRy\neS5nZXRLZXkoKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyB0aGUgbWFwcGluZyBmb3IgdGhp\ncyBrZXkgZnJvbSB0aGlzIEhhc2hNYXAgaWYgcHJlc2VudC4KICAgICAqCiAg\nICAgKiBAcGFyYW0ga2V5IGtleSB3aG9zZSBtYXBwaW5nIGlzIHRvIGJlIHJl\nbW92ZWQgZnJvbSB0aGUgTWFwLgogICAgICogQHJldHVybiBwcmV2aW91cyB2\nYWx1ZSBhc3NvY2lhdGVkIHdpdGggc3BlY2lmaWVkIGtleSwgb3IgbnVsbCBp\nZiB0aGVyZQogICAgICogd2FzIG5vIG1hcHBpbmcgZm9yIGtleS4gQSBudWxs\nIHJldHVybiBjYW4gYWxzbyBpbmRpY2F0ZSB0aGF0CiAgICAgKiB0aGUgSGFz\naE1hcCBwcmV2aW91c2x5IGFzc29jaWF0ZWQgbnVsbCB3aXRoIHRoZSBzcGVj\naWZpZWQga2V5LgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IHJlbW92ZShP\nYmplY3Qga2V5KSB7CiAgICAgICAgaWYgKGtleSA9PSBudWxsICYmIGtleVR5\ncGUgIT0gSEFSRCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIGludCBoYXNoID0gaGMoa2V5KTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgZXhwdW5nZVN0YWxlRW50cmllcygpOwoKICAg\nICAgICAgICAgRW50cnlbXSB0YWIgPSB0YWJsZTsKCiAgICAgICAgICAgIGlu\ndCBpbmRleCA9IChoYXNoICYgMHg3RkZGRkZGRikgJSB0YWIubGVuZ3RoOwog\nICAgICAgICAgICBmb3IgKEVudHJ5IGUgPSB0YWJbaW5kZXhdLCBwcmV2ID0g\nbnVsbDsgZSAhPSBudWxsOwogICAgICAgICAgICAgICAgcHJldiA9IGUsIGUg\nPSBlLmdldE5leHQoKSkgewogICAgICAgICAgICAgICAgaWYgKChlLmdldEhh\nc2goKSA9PSBoYXNoKSAmJiBlcShrZXksIGUuZ2V0S2V5KCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHByZXYgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcHJldi5zZXROZXh0KGUuZ2V0TmV4dCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHB1dCB0aGUgYnVja2V0\nIGFmdGVyIHVzCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICB0YWJbaW5kZXhdID0gZS5nZXROZXh0KCk7CgogICAg\nICAgICAgICAgICAgICAgIGNvdW50LS07CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGUuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCByZW1vdmVFeHBpcmVkKCkgewogICAgICAgIHN5\nbmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBleHB1bmdlU3RhbGVF\nbnRyaWVzKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGtl\neUV4cGlyZWQoT2JqZWN0IHZhbHVlKSB7CiAgICB9CgogICAgcHVibGljIHZv\naWQgdmFsdWVFeHBpcmVkKE9iamVjdCBrZXkpIHsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhbiBhcmJpdHJhcnkgZW50cnkgaW5kZXguCiAgICAg\nKi8KICAgIHByaXZhdGUgaW50IHJhbmRvbUVudHJ5SW5kZXgoKSB7CiAgICAg\nICAgaWYgKHJhbmRvbUVudHJ5ID09IFJBTkRPTVMubGVuZ3RoKQogICAgICAg\nICAgICByYW5kb21FbnRyeSA9IDA7CiAgICAgICAgcmV0dXJuIChpbnQpIChS\nQU5ET01TW3JhbmRvbUVudHJ5KytdICogdGFibGUubGVuZ3RoKTsKICAgIH0K\nCiAgICBwdWJsaWMgTWFwLkVudHJ5IHJlbW92ZVJhbmRvbSgpIHsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgZXhwdW5nZVN0\nYWxlRW50cmllcygpOwogICAgICAgICAgICBpZiAoY291bnQgPT0gMCkKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgaW50IHJh\nbmRvbSA9IHJhbmRvbUVudHJ5SW5kZXgoKTsKICAgICAgICAgICAgaW50IGlu\nZGV4ID0gZmluZEVudHJ5KHJhbmRvbSwgcmFuZG9tICUgMiA9PSAwLCBmYWxz\nZSk7CiAgICAgICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBFbnRyeSByZW0gPSB0YWJs\nZVtpbmRleF07CiAgICAgICAgICAgIHRhYmxlW2luZGV4XSA9IHJlbS5nZXRO\nZXh0KCk7CiAgICAgICAgICAgIGNvdW50LS07CiAgICAgICAgICAgIHJldHVy\nbiByZW07CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0\naGUgaW5kZXggb2YgdGhlIGVudHJ5IG5lYXJlc3QgdGhlIGdpdmVuIGluZGV4\nLCBzdGFydGluZyBpbiB0aGUKICAgICAqIGdpdmVuIGRpcmVjdGlvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBpbnQgZmluZEVudHJ5KGludCBzdGFydCwgYm9v\nbGVhbiBmb3J3YXJkLCBib29sZWFuIHNlYXJjaGVkT3RoZXIpIHsKICAgICAg\nICBpZiAoZm9yd2FyZCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gc3Rh\ncnQ7IGkgPCB0YWJsZS5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlm\nICh0YWJsZVtpXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBpOwogICAgICAgICAgICByZXR1cm4gKHNlYXJjaGVkT3RoZXIgfHwgc3Rh\ncnQgPT0gMCkgPyAtMQogICAgICAgICAgICAgICAgOiBmaW5kRW50cnkoc3Rh\ncnQgLSAxLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0OyBpID49IDA7IGktLSkKICAgICAg\nICAgICAgICAgIGlmICh0YWJsZVtpXSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBpOwogICAgICAgICAgICByZXR1cm4gKHNlYXJjaGVk\nT3RoZXIgfHwgc3RhcnQgPT0gdGFibGUubGVuZ3RoIC0gMSkgPyAtMQogICAg\nICAgICAgICAgICAgOiBmaW5kRW50cnkoc3RhcnQgKyAxLCB0cnVlLCB0cnVl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEl0ZXJhdG9yIHJhbmRv\nbUVudHJ5SXRlcmF0b3IoKSB7CiAgICAgICAgLy8gcGFzcyBpbmRleCBzbyBj\nYWxjdWxhdGVkIGJlZm9yZSBpdGVyYXRvciByZWZzIHRhYmxlLCBpbiBjYXNl\nIHRhYmxlCiAgICAgICAgLy8gZ2V0cyByZXBsYWNlIHdpdGggYSBsYXJnZXIg\nb25lCiAgICAgICAgcmV0dXJuIG5ldyBIYXNoSXRlcmF0b3IoRU5UUklFUywg\ncmFuZG9tRW50cnlJbmRleCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\ncGllcyBhbGwgb2YgdGhlIG1hcHBpbmdzIGZyb20gdGhlIHNwZWNpZmllZCBN\nYXAgdG8gdGhpcyBIYXNoTWFwCiAgICAgKiBUaGVzZSBtYXBwaW5ncyB3aWxs\nIHJlcGxhY2UgYW55IG1hcHBpbmdzIHRoYXQgdGhpcyBIYXNoTWFwIGhhZCBm\nb3IgYW55CiAgICAgKiBvZiB0aGUga2V5cyBjdXJyZW50bHkgaW4gdGhlIHNw\nZWNpZmllZCBNYXAuCiAgICAgKgogICAgICogQHBhcmFtIHQgTWFwcGluZ3Mg\ndG8gYmUgc3RvcmVkIGluIHRoaXMgTWFwLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBwdXRBbGwoTWFwIHQpIHsKICAgICAgICBJdGVyYXRvciBpID0gdC5l\nbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgd2hpbGUgKGkuaGFzTmV4\ndCgpKSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlID0gKE1hcC5FbnRyeSkg\naS5uZXh0KCk7CiAgICAgICAgICAgIHB1dChlLmdldEtleSgpLCBlLmdldFZh\nbHVlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZXMgYWxsIG1hcHBpbmdzIGZyb20gdGhpcyBIYXNoTWFwLgogICAgICovCiAg\nICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgY2xlYXIoKSB7CiAgICAgICAg\nLy8gY2xlYXIgb3V0IHJlZiBxdWV1ZS4gV2UgZG9uJ3QgbmVlZCB0byBleHB1\nbmdlIGVudHJpZXMKICAgICAgICAvLyBzaW5jZSB0YWJsZSBpcyBnZXR0aW5n\nIGNsZWFyZWQuCiAgICAgICAgd2hpbGUgKHF1ZXVlLnBvbGwoKSAhPSBudWxs\nKQogICAgICAgICAgICA7CiAgICAgICAgdGFibGUgPSBuZXcgRW50cnlbdGFi\nbGUubGVuZ3RoXTsKICAgICAgICBjb3VudCA9IDA7CiAgICAgICAgLy8gQWxs\nb2NhdGlvbiBvZiBhcnJheSBtYXkgaGF2ZSBjYXVzZWQgR0MsIHdoaWNoIG1h\neSBoYXZlIGNhdXNlZAogICAgICAgIC8vIGFkZGl0aW9uYWwgZW50cmllcyB0\nbyBnbyBzdGFsZS4gICAgUmVtb3ZpbmcgdGhlc2UgZW50cmllcyBmcm9tCiAg\nICAgICAgLy8gdGhlIHJlZmVyZW5jZSBxdWV1ZSB3aWxsIG1ha2UgdGhlbSBl\nbGlnaWJsZSBmb3IgcmVjbGFtYXRpb24uCiAgICAgICAgd2hpbGUgKHF1ZXVl\nLnBvbGwoKSAhPSBudWxsKQogICAgICAgICAgICA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIGEgc2hhbGxvdyBjb3B5IG9mIHRoaXMgSGFzaE1h\ncC4gVGhlIGtleXMgYW5kIHZhbHVlcwogICAgICogdGhlbXNlbHZlcyBhcmUg\nbm90IGNsb25lZC4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBP\nYmplY3QgY2xvbmUoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZXhw\ndW5nZVN0YWxlRW50cmllcygpOwoKICAgICAgICAgICAgQ29uY3VycmVudFJl\nZmVyZW5jZUhhc2hNYXAgdCA9IChDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1h\ncCkKICAgICAgICAgICAgICAgIHN1cGVyLmNsb25lKCk7CiAgICAgICAgICAg\nIHQudGFibGUgPSBuZXcgRW50cnlbdGFibGUubGVuZ3RoXTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IHRhYmxlLmxlbmd0aDsgaS0tID4gMDspIHsKICAg\nICAgICAgICAgICAgIEVudHJ5IGUgPSB0YWJsZVtpXTsKICAgICAgICAgICAg\nICAgIGlmIChlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0LnRh\nYmxlW2ldID0gKEVudHJ5KSBlLmNsb25lKHQucXVldWUpOwogICAgICAgICAg\nICAgICAgICAgIGUgPSBlLmdldE5leHQoKTsKICAgICAgICAgICAgICAgICAg\nICBmb3IgKEVudHJ5IGsgPSB0LnRhYmxlW2ldOyBlICE9IG51bGw7IGUgPSBl\nLmdldE5leHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBrLnNldE5l\neHQoKEVudHJ5KSBlLmNsb25lKHQucXVldWUpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgayA9IGsuZ2V0TmV4dCgpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAg\nICB0LmtleVNldCA9IG51bGw7CiAgICAgICAgICAgIHQuZW50cnlTZXQgPSBu\ndWxsOwogICAgICAgICAgICB0LnZhbHVlcyA9IG51bGw7CiAgICAgICAgICAg\nIHJldHVybiB0OwogICAgICAgIH0gY2F0Y2ggKENsb25lTm90U3VwcG9ydGVk\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gdGhpcyBzaG91bGRuJ3Qg\naGFwcGVuLCBzaW5jZSB3ZSBhcmUgQ2xvbmVhYmxlCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnRlcm5hbEVycm9yKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8vIFZpZXdzCgogICAgcHJpdmF0ZSB0cmFuc2llbnQgU2V0IGtleVNldCA9\nIG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBTZXQgZW50cnlTZXQgPSBu\ndWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29sbGVjdGlvbiB2YWx1ZXMg\nPSBudWxsOwoKICAgIC8qKgogICAgICogUmV0dXJucyBhIFNldCB2aWV3IG9m\nIHRoZSBrZXlzIGNvbnRhaW5lZCBpbiB0aGlzIEhhc2hNYXAuIFRoZSBTZXQg\naXMKICAgICAqIGJhY2tlZCBieSB0aGUgSGFzaE1hcCwgc28gY2hhbmdlcyB0\nbyB0aGUgSGFzaE1hcCBhcmUgcmVmbGVjdGVkIGluIHRoZQogICAgICogU2V0\nLCBhbmQgdmljZS12ZXJzYS4gVGhlIFNldCBzdXBwb3J0cyBlbGVtZW50IHJl\nbW92YWwsIHdoaWNoIHJlbW92ZXMKICAgICAqIHRoZSBjb3JyZXNwb25kaW5n\nIG1hcHBpbmcgZnJvbSB0aGUgSGFzaE1hcCwgdmlhIHRoZSBJdGVyYXRvci5y\nZW1vdmUsCiAgICAgKiBTZXQucmVtb3ZlLCByZW1vdmVBbGwgcmV0YWluQWxs\nLCBhbmQgY2xlYXIgb3BlcmF0aW9ucy4gSXQgZG9lcyBub3QKICAgICAqIHN1\ncHBvcnQgdGhlIGFkZCBvciBhZGRBbGwgb3BlcmF0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIFNldCBrZXlTZXQoKSB7CiAgICAgICAgaWYgKGtleVNldCA9\nPSBudWxsKSB7CiAgICAgICAgICAgIGtleVNldCA9IG5ldyBqYXZhLnV0aWwu\nQWJzdHJhY3RTZXQoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgSXRlcmF0\nb3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBIYXNoSXRlcmF0b3IoS0VZUywgdGFibGUubGVuZ3RoIC0gMSk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVibGljIGludCBzaXpl\nKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBj\nb250YWlucyhPYmplY3QgbykgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBjb250YWluc0tleShvKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoT2JqZWN0IG8pIHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gQ29uY3VycmVudFJlZmVyZW5jZUhh\nc2hNYXAudGhpcy5yZW1vdmUobykgIT0gbnVsbDsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAg\nICAgICAgICAgICAgICAgICBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1hcC50\naGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBrZXlTZXQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIGEgQ29sbGVjdGlvbiB2aWV3IG9mIHRoZSB2\nYWx1ZXMgY29udGFpbmVkIGluIHRoaXMgSGFzaE1hcC4KICAgICAqIFRoZSBD\nb2xsZWN0aW9uIGlzIGJhY2tlZCBieSB0aGUgSGFzaE1hcCwgc28gY2hhbmdl\ncyB0byB0aGUgSGFzaE1hcCBhcmUKICAgICAqIHJlZmxlY3RlZCBpbiB0aGUg\nQ29sbGVjdGlvbiwgYW5kIHZpY2UtdmVyc2EuIFRoZSBDb2xsZWN0aW9uIHN1\ncHBvcnRzCiAgICAgKiBlbGVtZW50IHJlbW92YWwsIHdoaWNoIHJlbW92ZXMg\ndGhlIGNvcnJlc3BvbmRpbmcgbWFwcGluZyBmcm9tIHRoZQogICAgICogSGFz\naE1hcCwgdmlhIHRoZSBJdGVyYXRvci5yZW1vdmUsIENvbGxlY3Rpb24ucmVt\nb3ZlLCByZW1vdmVBbGwsCiAgICAgKiByZXRhaW5BbGwgYW5kIGNsZWFyIG9w\nZXJhdGlvbnMuIEl0IGRvZXMgbm90IHN1cHBvcnQgdGhlIGFkZCBvciBhZGRB\nbGwKICAgICAqIG9wZXJhdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIHZhbHVlcygpIHsKICAgICAgICBpZiAodmFsdWVzID09IG51bGwp\nIHsKICAgICAgICAgICAgdmFsdWVzID0gbmV3IGphdmEudXRpbC5BYnN0cmFj\ndENvbGxlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgSXRlcmF0\nb3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBIYXNoSXRlcmF0b3IoVkFMVUVTLCB0YWJsZS5sZW5ndGggLSAxKTsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgaW50IHNp\nemUoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50OwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFu\nIGNvbnRhaW5zKE9iamVjdCBvKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGNvbnRhaW5zVmFsdWUobyk7CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAg\nICAgICAgICAgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAudGhpcy5jbGVh\ncigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdmFsdWVzOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJucyBhIENvbGxlY3Rpb24gdmlldyBvZiB0aGUgbWFwcGluZ3Mg\nY29udGFpbmVkIGluIHRoaXMgSGFzaE1hcC4KICAgICAqIEVhY2ggZWxlbWVu\ndCBpbiB0aGUgcmV0dXJuZWQgY29sbGVjdGlvbiBpcyBhIE1hcC5FbnRyeS4g\nVGhlIENvbGxlY3Rpb24KICAgICAqIGlzIGJhY2tlZCBieSB0aGUgSGFzaE1h\ncCwgc28gY2hhbmdlcyB0byB0aGUgSGFzaE1hcCBhcmUgcmVmbGVjdGVkIGlu\nIHRoZQogICAgICogQ29sbGVjdGlvbiwgYW5kIHZpY2UtdmVyc2EuIFRoZSBD\nb2xsZWN0aW9uIHN1cHBvcnRzIGVsZW1lbnQgcmVtb3ZhbCwKICAgICAqIHdo\naWNoIHJlbW92ZXMgdGhlIGNvcnJlc3BvbmRpbmcgbWFwcGluZyBmcm9tIHRo\nZSBIYXNoTWFwLCB2aWEgdGhlCiAgICAgKiBJdGVyYXRvci5yZW1vdmUsIENv\nbGxlY3Rpb24ucmVtb3ZlLCByZW1vdmVBbGwsIHJldGFpbkFsbCBhbmQgY2xl\nYXIKICAgICAqIG9wZXJhdGlvbnMuIEl0IGRvZXMgbm90IHN1cHBvcnQgdGhl\nIGFkZCBvciBhZGRBbGwgb3BlcmF0aW9ucy4KICAgICAqCiAgICAgKiBAc2Vl\nIE1hcC5FbnRyeQogICAgICovCiAgICBwdWJsaWMgU2V0IGVudHJ5U2V0KCkg\newogICAgICAgIGlmIChlbnRyeVNldCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGVudHJ5U2V0ID0gbmV3IGphdmEudXRpbC5BYnN0cmFjdFNldCgpIHsKICAg\nICAgICAgICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hJdGVyYXRvcihFTlRS\nSUVTLCB0YWJsZS5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3Qg\nbykgewogICAgICAgICAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBN\nYXAuRW50cnkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5ID0gKE1h\ncC5FbnRyeSkgbzsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qga2V5ID0g\nZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICAgICAgRW50cnlbXSB0\nYWIgPSB0YWJsZTsKICAgICAgICAgICAgICAgICAgICBpbnQgaGFzaCA9IGhj\nKGtleSk7CiAgICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gKGhhc2gg\nJiAweDdGRkZGRkZGKSAlIHRhYi5sZW5ndGg7CgogICAgICAgICAgICAgICAg\nICAgIGZvciAoRW50cnkgZSA9IHRhYltpbmRleF07IGUgIT0gbnVsbDsgZSA9\nIGUuZ2V0TmV4dCgpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5n\nZXRIYXNoKCkgPT0gaGFzaCAmJiBlcShlLCBlbnRyeSkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIE1hcC5FbnRy\neSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgICAgICBNYXAuRW50cnkgZW50cnkgPSAoTWFwLkVudHJ5\nKSBvOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCBrZXkgPSBlbnRyeS5n\nZXRLZXkoKTsKICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKENv\nbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwLnRoaXMpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgRW50cnlbXSB0YWIgPSB0YWJsZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaW50IGhhc2ggPSBoYyhrZXkpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpbnQgaW5kZXggPSAoaGFzaCAmIDB4N0ZGRkZGRkYpICUg\ndGFiLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoRW50\ncnkgZSA9IHRhYltpbmRleF0sIHByZXYgPSBudWxsOyBlICE9IG51bGw7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2ID0gZSwgZSA9IGUuZ2V0\nTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5n\nZXRIYXNoKCkgPT0gaGFzaCAmJiBlcShlLCBlbnRyeSkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJldiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LnNldE5leHQo\nZS5nZXROZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFi\nW2luZGV4XSA9IGUuZ2V0TmV4dCgpOwoKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb3VudC0tOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVibGljIGlu\ndCBzaXplKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb3VudDsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBjbGVhcigpIHsKICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW50UmVm\nZXJlbmNlSGFzaE1hcC50aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZW50\ncnlTZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHB1bmdlIHN0YWxlIGVu\ndHJpZXMgZnJvbSB0aGUgdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBleHB1bmdlU3RhbGVFbnRyaWVzKCkgewogICAgICAgIE9iamVjdCByOwog\nICAgICAgIHdoaWxlICgociA9IHF1ZXVlLnBvbGwoKSkgIT0gbnVsbCkgewog\nICAgICAgICAgICBFbnRyeSBlbnRyeSA9IChFbnRyeSkgcjsKICAgICAgICAg\nICAgaW50IGhhc2ggPSBlbnRyeS5nZXRIYXNoKCk7CiAgICAgICAgICAgIEVu\ndHJ5W10gdGFiID0gdGFibGU7CiAgICAgICAgICAgIGludCBpbmRleCA9ICho\nYXNoICYgMHg3RkZGRkZGRikgJSB0YWIubGVuZ3RoOwoKICAgICAgICAgICAg\nZm9yIChFbnRyeSBlID0gdGFiW2luZGV4XSwgcHJldiA9IG51bGw7IGUgIT0g\nbnVsbDsKICAgICAgICAgICAgICAgIHByZXYgPSBlLCBlID0gZS5nZXROZXh0\nKCkpIHsKICAgICAgICAgICAgICAgIGlmIChlID09IGVudHJ5KSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHByZXYgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcHJldi5zZXROZXh0KGUuZ2V0TmV4dCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHB1dCB0aGUgYnVja2V0\nIGFmdGVyIHVzCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICB0YWJbaW5kZXhdID0gZS5nZXROZXh0KCk7CgogICAg\nICAgICAgICAgICAgICAgIGNvdW50LS07CiAgICAgICAgICAgICAgICAgICAg\naWYgKGtleVR5cGUgPT0gSEFSRCkKICAgICAgICAgICAgICAgICAgICAgICAg\ndmFsdWVFeHBpcmVkKGUuZ2V0S2V5KCkpOwogICAgICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAga2V5RXhwaXJlZChlLmdl\ndFZhbHVlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGFzaE1hcCBjb2xsaXNp\nb24gbGlzdCBlbnRyeS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50\nZXJmYWNlIEVudHJ5IGV4dGVuZHMgTWFwLkVudHJ5IHsKCiAgICAgICAgcHVi\nbGljIGludCBnZXRIYXNoKCk7CgogICAgICAgIHB1YmxpYyBFbnRyeSBnZXRO\nZXh0KCk7CgogICAgICAgIHB1YmxpYyB2b2lkIHNldE5leHQoRW50cnkgbmV4\ndCk7CgogICAgICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoUmVmZXJlbmNlUXVl\ndWUgcXVldWUpOwogICAgfQoKICAgIC8qKgogICAgICogSGFyZCBlbnRyeS4K\nICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBIYXJkRW50cnkgaW1wbGVtZW50\ncyBFbnRyeSB7CgogICAgICAgIHByaXZhdGUgaW50IGhhc2g7CiAgICAgICAg\ncHJpdmF0ZSBPYmplY3Qga2V5OwogICAgICAgIHByaXZhdGUgT2JqZWN0IHZh\nbHVlOwogICAgICAgIHByaXZhdGUgRW50cnkgbmV4dDsKCiAgICAgICAgSGFy\nZEVudHJ5KGludCBoYXNoLCBPYmplY3Qga2V5LCBPYmplY3QgdmFsdWUsIEVu\ndHJ5IG5leHQpIHsKICAgICAgICAgICAgdGhpcy5oYXNoID0gaGFzaDsKICAg\nICAgICAgICAgdGhpcy5rZXkgPSBrZXk7CiAgICAgICAgICAgIHRoaXMudmFs\ndWUgPSB2YWx1ZTsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gbmV4dDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0SGFzaCgpIHsKICAgICAg\nICAgICAgcmV0dXJuIGhhc2g7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nRW50cnkgZ2V0TmV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXROZXh0KEVudHJ5IG5l\neHQpIHsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gbmV4dDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoUmVmZXJlbmNlUXVldWUg\ncXVldWUpIHsKICAgICAgICAgICAgLy8gSXQgaXMgdGhlIGNhbGxlcnMgcmVz\ncG9uc2liaWxpdHkgdG8gc2V0IHRoZSBuZXh0IGZpZWxkCiAgICAgICAgICAg\nIC8vIGNvcnJlY3RseS4KICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXJkRW50\ncnkoaGFzaCwga2V5LCB2YWx1ZSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBNYXAuRW50cnkgT3BzCgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0\nS2V5KCkgewogICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE9iamVjdCBnZXRWYWx1ZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIHZhbHVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVj\ndCBzZXRWYWx1ZShPYmplY3QgdmFsdWUpIHsKICAgICAgICAgICAgT2JqZWN0\nIG9sZFZhbHVlID0gdGhpcy52YWx1ZTsKICAgICAgICAgICAgdGhpcy52YWx1\nZSA9IHZhbHVlOwogICAgICAgICAgICByZXR1cm4gb2xkVmFsdWU7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8p\nIHsKICAgICAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIE1hcC5FbnRyeSkp\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgTWFwLkVudHJ5IGUgPSAoTWFw\nLkVudHJ5KSBvOwoKICAgICAgICAgICAgT2JqZWN0IGsxID0ga2V5OwogICAg\nICAgICAgICBPYmplY3QgazIgPSBlLmdldEtleSgpOwoKICAgICAgICAgICAg\ncmV0dXJuIChrMSA9PSBudWxsID8gazIgPT0gbnVsbCA6IGVxKGsxLCBrMikp\nICYmCiAgICAgICAgICAgICAgICAodmFsdWUgPT0gbnVsbCA/IGUuZ2V0VmFs\ndWUoKSA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgOiBlcSh2YWx1ZSwg\nZS5nZXRWYWx1ZSgpKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIGhhc2hDb2RlKCkgewogICAgICAgICAgICByZXR1cm4gaGFzaCBeICh2YWx1\nZSA9PSBudWxsID8gMCA6IHZhbHVlLmhhc2hDb2RlKCkpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAg\nICAgcmV0dXJuIGtleSArICI9IiArIHZhbHVlLnRvU3RyaW5nKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2VhayBlbnRyeS4KICAgICAq\nLwogICAgcHJpdmF0ZSBjbGFzcyBXZWFrRW50cnkgZXh0ZW5kcyBXZWFrUmVm\nZXJlbmNlIGltcGxlbWVudHMgRW50cnkgewoKICAgICAgICBwcml2YXRlIGlu\ndCBoYXNoOwogICAgICAgIHByaXZhdGUgT2JqZWN0IGhhcmQ7CiAgICAgICAg\ncHJpdmF0ZSBib29sZWFuIGtleVJlZjsKICAgICAgICBwcml2YXRlIEVudHJ5\nIG5leHQ7CgogICAgICAgIFdlYWtFbnRyeShpbnQgaGFzaCwgT2JqZWN0IGtl\neSwgT2JqZWN0IHZhbHVlLCBib29sZWFuIGtleVJlZiwKICAgICAgICAgICAg\nRW50cnkgbmV4dCwgUmVmZXJlbmNlUXVldWUgcXVldWUpIHsKICAgICAgICAg\nICAgc3VwZXIoKGtleVJlZikgPyBrZXkgOiB2YWx1ZSwgcXVldWUpOwogICAg\nICAgICAgICB0aGlzLmhhc2ggPSBoYXNoOwogICAgICAgICAgICB0aGlzLmhh\ncmQgPSAoa2V5UmVmKSA/IHZhbHVlIDoga2V5OwogICAgICAgICAgICB0aGlz\nLmtleVJlZiA9IGtleVJlZjsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gbmV4\ndDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0SGFzaCgpIHsK\nICAgICAgICAgICAgcmV0dXJuIGhhc2g7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgRW50cnkgZ2V0TmV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\neHQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXROZXh0KEVu\ndHJ5IG5leHQpIHsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gbmV4dDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoUmVmZXJlbmNl\nUXVldWUgcXVldWUpIHsKICAgICAgICAgICAgLy8gSXQgaXMgdGhlIGNhbGxl\ncnMgcmVzcG9uc2liaWxpdHkgdG8gc2V0IHRoZSBuZXh0IGZpZWxkCiAgICAg\nICAgICAgIC8vIGNvcnJlY3RseS4KICAgICAgICAgICAgcmV0dXJuIG5ldyBX\nZWFrRW50cnkoaGFzaCwgZ2V0S2V5KCksIGdldFZhbHVlKCksIGtleVJlZiwg\nbnVsbCwKICAgICAgICAgICAgICAgIHF1ZXVlKTsKICAgICAgICB9CgogICAg\nICAgIC8vIE1hcC5FbnRyeSBPcHMKCiAgICAgICAgcHVibGljIE9iamVjdCBn\nZXRLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiAoa2V5UmVmKSA/IHN1cGVy\nLmdldCgpIDogaGFyZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0VmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiAoa2V5UmVmKSA/\nIGhhcmQgOiBzdXBlci5nZXQoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBPYmplY3Qgc2V0VmFsdWUoT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgICAg\nIGlmICgha2V5UmVmKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9y\nKCJBdHRlbXB0IHRvIHJlc2V0IHJlZmVyZW5jZSB2YWx1ZS4iKTsKCiAgICAg\nICAgICAgIE9iamVjdCBvbGRWYWx1ZSA9IGhhcmQ7CiAgICAgICAgICAgIGhh\ncmQgPSB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIG9sZFZhbHVlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\nKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNYXAuRW50cnkp\nKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlID0gKE1h\ncC5FbnRyeSkgbzsKICAgICAgICAgICAgcmV0dXJuIGVxKGdldEtleSgpLCBl\nLmdldEtleSgpKSAmJiBlcShnZXRWYWx1ZSgpLCBlLmdldFZhbHVlKCkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICAgICAgT2JqZWN0IHZhbCA9IGdldFZhbHVlKCk7CiAgICAgICAgICAg\nIHJldHVybiBoYXNoIF4gKHZhbCA9PSBudWxsID8gMCA6IHZhbC5oYXNoQ29k\nZSgpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJp\nbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRLZXkoKSArICI9IiArIGdl\ndFZhbHVlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU29m\ndCBlbnRyeS4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBTb2Z0RW50cnkg\nZXh0ZW5kcyBTb2Z0UmVmZXJlbmNlIGltcGxlbWVudHMgRW50cnkgewoKICAg\nICAgICBwcml2YXRlIGludCBoYXNoOwogICAgICAgIHByaXZhdGUgT2JqZWN0\nIGhhcmQ7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGtleVJlZjsKICAgICAg\nICBwcml2YXRlIEVudHJ5IG5leHQ7CgogICAgICAgIFNvZnRFbnRyeShpbnQg\naGFzaCwgT2JqZWN0IGtleSwgT2JqZWN0IHZhbHVlLCBib29sZWFuIGtleVJl\nZiwKICAgICAgICAgICAgRW50cnkgbmV4dCwgUmVmZXJlbmNlUXVldWUgcXVl\ndWUpIHsKICAgICAgICAgICAgc3VwZXIoKGtleVJlZikgPyBrZXkgOiB2YWx1\nZSwgcXVldWUpOwogICAgICAgICAgICB0aGlzLmhhc2ggPSBoYXNoOwogICAg\nICAgICAgICB0aGlzLmhhcmQgPSAoa2V5UmVmKSA/IHZhbHVlIDoga2V5Owog\nICAgICAgICAgICB0aGlzLmtleVJlZiA9IGtleVJlZjsKICAgICAgICAgICAg\ndGhpcy5uZXh0ID0gbmV4dDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgZ2V0SGFzaCgpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc2g7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgRW50cnkgZ2V0TmV4dCgpIHsKICAgICAg\nICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBzZXROZXh0KEVudHJ5IG5leHQpIHsKICAgICAgICAgICAgdGhpcy5u\nZXh0ID0gbmV4dDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qg\nY2xvbmUoUmVmZXJlbmNlUXVldWUgcXVldWUpIHsKICAgICAgICAgICAgLy8g\nSXQgaXMgdGhlIGNhbGxlcnMgcmVzcG9uc2liaWxpdHkgdG8gc2V0IHRoZSBu\nZXh0IGZpZWxkCiAgICAgICAgICAgIC8vIGNvcnJlY3RseS4KICAgICAgICAg\nICAgcmV0dXJuIG5ldyBTb2Z0RW50cnkoaGFzaCwgZ2V0S2V5KCksIGdldFZh\nbHVlKCksIGtleVJlZiwgbnVsbCwKICAgICAgICAgICAgICAgIHF1ZXVlKTsK\nICAgICAgICB9CgogICAgICAgIC8vIE1hcC5FbnRyeSBPcHMKCiAgICAgICAg\ncHVibGljIE9iamVjdCBnZXRLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiAo\na2V5UmVmKSA/IHN1cGVyLmdldCgpIDogaGFyZDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBPYmplY3QgZ2V0VmFsdWUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiAoa2V5UmVmKSA/IGhhcmQgOiBzdXBlci5nZXQoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3Qgc2V0VmFsdWUoT2JqZWN0IHZhbHVl\nKSB7CiAgICAgICAgICAgIGlmICgha2V5UmVmKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEVycm9yKCJBdHRlbXB0IHRvIHJlc2V0IHJlZmVyZW5jZSB2\nYWx1ZS4iKTsKCiAgICAgICAgICAgIE9iamVjdCBvbGRWYWx1ZSA9IGhhcmQ7\nCiAgICAgICAgICAgIGhhcmQgPSB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJu\nIG9sZFZhbHVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFu\nY2VvZiBNYXAuRW50cnkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIE1h\ncC5FbnRyeSBlID0gKE1hcC5FbnRyeSkgbzsKICAgICAgICAgICAgcmV0dXJu\nIGVxKGdldEtleSgpLCBlLmdldEtleSgpKSAmJiBlcShnZXRWYWx1ZSgpLCBl\nLmdldFZhbHVlKCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBo\nYXNoQ29kZSgpIHsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IGdldFZhbHVl\nKCk7CiAgICAgICAgICAgIHJldHVybiBoYXNoIF4gKHZhbCA9PSBudWxsID8g\nMCA6IHZhbC5oYXNoQ29kZSgpKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRL\nZXkoKSArICI9IiArIGdldFZhbHVlKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8vIFR5cGVzIG9mIEVudW1lcmF0aW9ucy9JdGVyYXRpb25zCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgS0VZUyA9IDA7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgVkFMVUVTID0gMTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBFTlRSSUVTID0gMjsKCiAgICAvKioKICAgICAqIE1hcCBp\ndGVyYXRvci4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBIYXNoSXRlcmF0\nb3IgaW1wbGVtZW50cyBJdGVyYXRvciB7CgogICAgICAgIGZpbmFsIEVudHJ5\nW10gdGFibGUgPSBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1hcC50aGlzLnRh\nYmxlOwogICAgICAgIGZpbmFsIGludCB0eXBlOwogICAgICAgIGludCBzdGFy\ndEluZGV4OwogICAgICAgIGludCBzdG9wSW5kZXggPSAwOwogICAgICAgIGlu\ndCBpbmRleDsKICAgICAgICBFbnRyeSBlbnRyeSA9IG51bGw7CiAgICAgICAg\nRW50cnkgbGFzdFJldHVybmVkID0gbnVsbDsKCiAgICAgICAgSGFzaEl0ZXJh\ndG9yKGludCB0eXBlLCBpbnQgc3RhcnRJbmRleCkgewogICAgICAgICAgICB0\naGlzLnR5cGUgPSB0eXBlOwogICAgICAgICAgICB0aGlzLnN0YXJ0SW5kZXgg\nPSBzdGFydEluZGV4OwogICAgICAgICAgICBpbmRleCA9IHN0YXJ0SW5kZXg7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0KCkg\newogICAgICAgICAgICBpZiAoZW50cnkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nd2hpbGUgKGluZGV4ID49IHN0b3BJbmRleCkgewogICAgICAgICAgICAgICAg\naWYgKChlbnRyeSA9IHRhYmxlW2luZGV4LS1dKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0b3BJbmRleCA9PSAw\nKSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IHRhYmxlLmxlbmd0aCAtIDE7\nCiAgICAgICAgICAgICAgICBzdG9wSW5kZXggPSBzdGFydEluZGV4ICsgMTsK\nICAgICAgICAgICAgICAgIHdoaWxlIChpbmRleCA+PSBzdG9wSW5kZXgpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoKGVudHJ5ID0gdGFibGVbaW5kZXgt\nLV0pICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAgICAg\nICAgICAgaWYgKCFoYXNOZXh0KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTm9TdWNoRWxlbWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICBFbnRy\neSBlID0gbGFzdFJldHVybmVkID0gZW50cnk7CiAgICAgICAgICAgIGVudHJ5\nID0gZS5nZXROZXh0KCk7CiAgICAgICAgICAgIHJldHVybiB0eXBlID09IEtF\nWVMgPyBlLmdldEtleSgpCiAgICAgICAgICAgICAgICA6ICh0eXBlID09IFZB\nTFVFUyA/IGUuZ2V0VmFsdWUoKSA6IGUpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAgICAgICAgICBpZiAobGFzdFJl\ndHVybmVkID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAoQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAudGhpcykgewogICAgICAg\nICAgICAgICAgRW50cnlbXSB0YWIgPSBDb25jdXJyZW50UmVmZXJlbmNlSGFz\naE1hcC50aGlzLnRhYmxlOwogICAgICAgICAgICAgICAgaW50IGluZGV4ID0g\nKGxhc3RSZXR1cm5lZC5nZXRIYXNoKCkgJiAweDdGRkZGRkZGKSAlIHRhYi5s\nZW5ndGg7CgogICAgICAgICAgICAgICAgZm9yIChFbnRyeSBlID0gdGFiW2lu\nZGV4XSwgcHJldiA9IG51bGw7IGUgIT0gbnVsbDsKICAgICAgICAgICAgICAg\nICAgICBwcmV2ID0gZSwgZSA9IGUuZ2V0TmV4dCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGUgPT0gbGFzdFJldHVybmVkKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChwcmV2ID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0YWJbaW5kZXhdID0gZS5nZXROZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHByZXYuc2V0TmV4dChlLmdldE5leHQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvdW50LS07CiAgICAgICAgICAgICAgICAgICAgICAg\nIGxhc3RSZXR1cm5lZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkl0ZXJhdGVk\nIG9mZiB0YWJsZSB3aGVuIGRvaW5nIHJlbW92ZSIpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIGludCBjYXBhY2l0eSgpIHsKICAgICAg\nICByZXR1cm4gdGFibGUubGVuZ3RoOwogICAgfQoKICAgIGZsb2F0IGxvYWRG\nYWN0b3IoKSB7CiAgICAgICAgcmV0dXJuIGxvYWRGYWN0b3I7CiAgICB9Cn0K\n","encoding":"base64"}

