{"sha":"e549bc430be5855aef4a38710fbb50527b2bcbb6","node_id":"MDQ6QmxvYjIwNjM2NDplNTQ5YmM0MzBiZTU4NTVhZWY0YTM4NzEwZmJiNTA1MjdiMmJjYmI2","size":60575,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e549bc430be5855aef4a38710fbb50527b2bcbb6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBq\nYXZhLm5ldC5VUklTeW50YXhFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5V\nUkw7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJl\nZVNldDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkJhc2ljOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRl\nZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVuZXJzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVy\nczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZldGNoVHlwZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwppbXBvcnQgc3RhdGljIGphdmF4\nLnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFVVE87CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLklk\nQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTWFwS2V5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwcGVkU3VwZXJj\nbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJpZXM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJ5OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PcmRl\nckJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdExvYWQ7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UGVyc2lzdDsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlBvc3RSZW1vdmU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5Qb3N0VXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJl\nUGVyc2lzdDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVJlbW92ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVVwZGF0ZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVmVyc2lvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkJlYW5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lk1ldGhvZExpZmVjeWNs\nZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5MaWZlY3ljbGVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhTW9k\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJl\ncG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5PcmRl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlF1ZXJ5TWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVXBkYXRl\nU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZh\nbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5NZXRhRGF0YURlZmF1bHRzOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy4qOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2Vw\ndGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51\ndGlsLlN0cmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlvbiBt\nZXRhZGF0YSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQogKiBk\nZXBsb3ltZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIK\nICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBh\ncnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENs\nYXNzLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNoTWFw\nPENsYXNzLCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAgICAg\nIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJFRERFRF9JRCk7CiAg\nICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5jbGFzcywgRU5USVRZ\nX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVEZWZhdWx0\nTGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJTKTsK\nICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5lcnMu\nY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNURU5F\nUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVUeXBlLmNsYXNzLCBG\nTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2VuZXJhdGVkVmFsdWUu\nY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAgX3RhZ3MucHV0KElk\nLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElkQ2xhc3MuY2xhc3Ms\nIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5LmNsYXNzLCBN\nQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVyaWVz\nLmNsYXNzLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0KE5h\nbWVkTmF0aXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAgICAg\nX3RhZ3MucHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAgICAg\nICAgX3RhZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAgICAg\nICBfdGFncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAgICAg\nIF90YWdzLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAgICAg\nICBfdGFncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lTVCk7\nCiAgICAgICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1RfUkVN\nT1ZFKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywgUE9T\nVF9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNsYXNz\nLCBQUkVfUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92ZS5j\nbGFzcywgUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVwZGF0\nZS5jbGFzcywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNlcXVl\nbmNlR2VuZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAgICBf\ndGFncy5wdXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAgX3Rh\nZ3MucHV0KERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAgICAg\nX3RhZ3MucHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQpOwog\nICAgICAgIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVOVCk7\nCiAgICAgICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERFVEFD\nSEVEX1NUQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVuZGVu\ndC5jbGFzcywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1dChF\nbGVtZW50VHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFncy5w\ndXQoRXh0ZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwogICAg\nICAgIF90YWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFMSVpF\nUik7CiAgICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RPUlkp\nOwogICAgICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRDSF9H\nUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNzLCBG\nRVRDSF9HUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9naWNh\nbC5jbGFzcywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5wdXQo\nS2V5RGVwZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAgICBf\ndGFncy5wdXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAgIF90\nYWdzLnB1dChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9HUk9V\nUCk7CiAgICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAgICAg\nICBfdGFncy5wdXQoUmVhZE9ubHkuY2xhc3MsIFJFQURfT05MWSk7CiAgICAg\nICAgX3RhZ3MucHV0KFR5cGUuY2xhc3MsIFRZUEUpOwogICAgfQoKICAgIHBy\naXZhdGUgZmluYWwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBw\ncml2YXRlIGZpbmFsIExvZyBfbG9nOwogICAgcHJpdmF0ZSBNZXRhRGF0YVJl\ncG9zaXRvcnkgX3JlcG9zID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NMb2Fk\nZXIgX2VudkxvYWRlciA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX292\nZXJyaWRlID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1PREVf\nTk9ORTsKCiAgICAvLyBwYWNrYWdlcyBhbmQgdGhlaXIgcGFyc2UgbW9kZXMK\nICAgIHByaXZhdGUgZmluYWwgTWFwPFBhY2thZ2UsIEludGVnZXI+IF9wa2dz\nID0gbmV3IEhhc2hNYXA8UGFja2FnZSwgSW50ZWdlcj4oKTsKCiAgICAvLyB0\naGUgY2xhc3Mgd2Ugd2VyZSBpbnZva2VkIHRvIHBhcnNlCiAgICBwcml2YXRl\nIENsYXNzIF9jbHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWxlIF9maWxlID0g\nbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgY29u\nZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25QZXJz\naXN0ZW5jZU1ldGFEYXRhUGFyc2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNv\nbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2xvZyA9IGNv\nbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRBREFUQSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uIHN1cHBsaWVk\nIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFD\nb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogTWV0YWRhdGEgbG9n\nLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAgICBy\nZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhl\nIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLiBJZiBub25lIGhhcyBiZWVu\nIHNldCwKICAgICAqIGNyZWF0ZSBhIG5ldyByZXBvc2l0b3J5IGFuZCBzZXRz\nIGl0LgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5IGdl\ndFJlcG9zaXRvcnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9jb25m\nLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAg\nIE1ldGFEYXRhRmFjdG9yeSBtZGYgPSByZXBvcy5nZXRNZXRhRGF0YUZhY3Rv\ncnkoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIERlbGVnYXRp\nbmdNZXRhRGF0YUZhY3RvcnkpCiAgICAgICAgICAgICAgICBtZGYgPSAoKERl\nbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpIG1kZikuZ2V0SW5uZXJtb3N0RGVs\nZWdhdGUoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIFBlcnNp\nc3RlbmNlTWV0YURhdGFGYWN0b3J5KQogICAgICAgICAgICAgICAgKChQZXJz\naXN0ZW5jZU1ldGFEYXRhRmFjdG9yeSkgbWRmKS5zZXRBbm5vdGF0aW9uUGFy\nc2VyKHRoaXMpOwogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgbWV0YWRhdGEgcmVwb3NpdG9yeSBmb3IgdGhpcyBwYXJz\nZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcG9zaXRvcnkoTWV0\nYURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9zID0gcmVw\nb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVudmlyb25t\nZW50YWwgY2xhc3MgbG9hZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2VkCiAgICAg\nKiBtZXRhZGF0YSBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1cm4g\nX2VudkxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZW52\naXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFzcyBvbiB0byBwYXJzZWQK\nICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7\nCiAgICAgICAgX2VudkxvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBp\nbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5m\nb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxz\nZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xh\nc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAq\nIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBh\ncmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNYXBwaW5nT3ZlcnJpZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9vdmVycmlkZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBpbmcgaW5m\nb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5mb3JtYXRp\nb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxzZS4gVXNl\nZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xhc3MsIHNv\nIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGluZm9y\nbWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUgc3Rv\ncmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRNYXBwaW5nT3ZlcnJpZGUoYm9vbGVhbiBvdmVycmlk\nZSkgewogICAgICAgIF9vdmVycmlkZSA9IG92ZXJyaWRlOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBpbnQgZ2V0TW9kZSgpIHsKICAgICAgICByZXR1cm4gX21vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9kZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewog\nICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAgX21v\nZGUgPSBNT0RFX05PTkU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAg\nICAgIF9tb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nbW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwYXJz\nZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBt\nb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcge0Bs\naW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\naXNNZXRhRGF0YU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9kZSAmIE1P\nREVfTUVUQSkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmll\nbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzUXVlcnlNb2RlKCkg\newogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX1FVRVJZKSAhPSAwOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBp\nbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgpIHsKICAgICAgICByZXR1\ncm4gKF9tb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0cnVlIGlmIHdlJ3JlIGluIG1hcHBpbmcgbW9k\nZSBvciBpbiBtZXRhZGF0YSBtb2RlIHdpdGgKICAgICAqIG1hcHBpbmcgb3Zl\ncmlkZSBlbmFibGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIGlzTWFw\ncGluZ01vZGUoKSB8fCAoX292ZXJyaWRlICYmIGlzTWV0YURhdGFNb2RlKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVzLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBfY2xzID0gbnVs\nbDsKICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgX3BrZ3MuY2xlYXIo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBlcnNpc3RlbmNlIG1l\ndGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHBhcnNlKENsYXNzIGNscykgewogICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoInBhcnNlLWNsYXNzIiwgY2xzLmdldE5hbWUoKSkpOwoKICAgICAgICBf\nY2xzID0gY2xzOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcnNlUGFj\na2FnZUFubm90YXRpb25zKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IHBhcnNlQ2xhc3NBbm5vdGF0aW9ucygpOwogICAgICAgICAgICB1\ncGRhdGVTb3VyY2VNb2RlKG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgICAgICBfZmlsZSA9IG51\nbGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRo\nZSBzb3VyY2UgbW9kZSB0byB0aGUgY2xhc3MgcGFja2FnZSBhbmQgY2xhc3Mg\ndG8gaW5kaWNhdGUgdGhhdAogICAgICogd2UndmUgZnVsbHkgcGFyc2VkIHRo\nZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVTb3VyY2VNb2Rl\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfY2xzLmdldFBh\nY2thZ2UoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRTb3VyY2VNb2RlKF9j\nbHMuZ2V0UGFja2FnZSgpLCBfbW9kZSk7CiAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKF9tb2RlLCB0\ncnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGluZm9ybWF0aW9u\nIGluIHBhY2thZ2UtbGV2ZWwgY2xhc3MgYW5ub3RhdGlvbnMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZVBhY2thZ2VBbm5vdGF0aW9ucygpIHsK\nICAgICAgICBQYWNrYWdlIHBrZyA9IF9jbHMuZ2V0UGFja2FnZSgpOwogICAg\nICAgIGlmIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpbnQgcGtnTW9kZSA9IGdldFNvdXJjZU1vZGUocGtnKTsKICAgICAg\nICBpZiAocGtnTW9kZSA9PSAwICYmIF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtcGFja2Fn\nZSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgaWYgKChwa2dNb2RlICYg\nX21vZGUpID09IF9tb2RlKSAvLyBhbHJlYWR5IHZpc2l0ZWQKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAgICAg\nZm9yIChBbm5vdGF0aW9uIGFubm8gOiBwa2cuZ2V0RGVjbGFyZWRBbm5vdGF0\naW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFu\nbm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25QYWNrYWdlQW5ub3Rh\ndGlvbihwa2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9R\nVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1l\nZE5hdGl2ZVF1ZXJpZXMocGtnLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBO\nQVRJVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlN\nb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAg\nICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhwa2cs\nIChOYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAm\nIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlTmFtZWRRdWVyaWVzKHBrZywgKChOYW1lZFF1ZXJpZXMpIGFubm8pLnZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNR\ndWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywg\nKE5hbWVkUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJgog\nICAgICAgICAgICAgICAgICAgICAgICAocGtnTW9kZSAmIE1PREVfTUFQUElO\nRykgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5j\nZUdlbmVyYXRvcihwa2csIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBwa2csCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhbHdheXMgcGFyc2UgbWFw\ncGluZyBzdHVmZiBhZnRlciBtZXRhZGF0YSBzdHVmZiwgaW4gY2FzZSB0aGVy\nZSBhcmUKICAgICAgICAvLyBkZXBlbmRlbmNpZXMgb24gbWV0YWRhdGEKICAg\nICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgKHBrZ01vZGUg\nJiBNT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIHBhcnNlUGFja2Fn\nZU1hcHBpbmdBbm5vdGF0aW9ucyhwa2cpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgcGFja2FnZSBtYXBwaW5nIGFubm90YXRpb25zLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3Rh\ndGlvbnMoUGFja2FnZSBwa2cpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEFs\nbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25Q\nYWNrYWdlQW5ub3RhdGlvbihQYWNrYWdlIHBrZywKICAgICAgICBBbm5vdGF0\naW9uIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZlbiBwYWNr\nYWdlLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRTb3VyY2VNb2RlKFBh\nY2thZ2UgcGtnKSB7CiAgICAgICAgTnVtYmVyIG51bSA9IF9wa2dzLmdldChw\na2cpOwogICAgICAgIHJldHVybiAobnVtID09IG51bGwpID8gMCA6IG51bS5p\nbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRvIHRoZSBz\nb3VyY2UgbW9kZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGRTb3VyY2VNb2RlKFBhY2thZ2UgcGtnLCBpbnQg\nbW9kZSkgewogICAgICAgIEludGVnZXIgbnVtID0gX3BrZ3MuZ2V0KHBrZyk7\nCiAgICAgICAgaWYgKG51bSA9PSBudWxsKQogICAgICAgICAgICBudW0gPSBO\ndW1iZXJzLnZhbHVlT2YobW9kZSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBudW0gPSBOdW1iZXJzLnZhbHVlT2YobnVtLmludFZhbHVlKCkgfCBtb2Rl\nKTsKICAgICAgICBfcGtncy5wdXQocGtnLCBudW0pOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVhZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGN1cnJlbnQgdHlw\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIHBhcnNlQ2xh\nc3NBbm5vdGF0aW9ucygpIHsKICAgICAgICAvLyBjaGVjayBpbW1lZGlhdGVs\neSB3aGV0aGVyIHRoZSB1c2VyIGlzIHVzaW5nIGFueSBhbm5vdGF0aW9ucywK\nICAgICAgICAvLyByZWdhcmRsZXNzIG9mIG1vZGUuICB0aGlzIHByZXZlbnRz\nIGFkZGluZyBub24tZW50aXR5IGNsYXNzZXMgdG8KICAgICAgICAvLyByZXBv\nc2l0b3J5IGlmIHdlJ3JlIGlnbm9yaW5nIHRoZXNlIGFubm90YXRpb25zIGlu\nIG1hcHBpbmcgbW9kZQogICAgICAgIGlmICghX2Nscy5pc0Fubm90YXRpb25Q\ncmVzZW50KEVudGl0eS5jbGFzcykKICAgICAgICAgICAgJiYgIV9jbHMuaXNB\nbm5vdGF0aW9uUHJlc2VudChFbWJlZGRhYmxlLmNsYXNzKQogICAgICAgICAg\nICAmJiAhX2Nscy5pc0Fubm90YXRpb25QcmVzZW50KE1hcHBlZFN1cGVyY2xh\nc3MuY2xhc3MpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nLy8gZmluZCAvIGNyZWF0ZSBtZXRhZGF0YQogICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YSA9IGdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEVudGl0\neSBlbnRpdHkgPSAoRW50aXR5KSBfY2xzLmdldEFubm90YXRpb24oRW50aXR5\nLmNsYXNzKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAg\nICAgICAgICAvLyB3aGlsZSB0aGUgc3BlYyBvbmx5IHByb3ZpZGVzIGZvciBl\nbWJlZGRlZCBleGNsdXNpdmUsIGl0IGRvZXNuJ3QKICAgICAgICAgICAgLy8g\nc2VlbSBoYXJkIHRvIHN1cHBvcnQgb3RoZXJ3aXNlCiAgICAgICAgICAgIGlm\nIChlbnRpdHkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1i\nZWRkZWRPbmx5KHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIG1ldGEuc2V0RW1iZWRkZWRPbmx5KGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShlbnRpdHkubmFtZSgp\nKSkKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFR5cGVBbGlhcyhlbnRp\ndHkubmFtZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gdHJhY2sgZmV0Y2ggZ3JvdXBzIHRvIHBhcnNlIHRoZW0gYWZ0ZXIgZmll\nbGRzLCBzaW5jZSB0aGV5CiAgICAgICAgLy8gcmVseSBvbiBmaWVsZCBtZXRh\nZGF0YQogICAgICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBudWxsOwogICAgICAg\nIERldGFjaGVkU3RhdGUgZGV0YWNoZWQgPSBudWxsOwoKICAgICAgICAvLyB0\ncmFjayBsaXN0ZW5lcnMgc2luY2Ugd2UgbmVlZCB0byBtZXJnZSB0aGVtIHdp\ndGggZW50aXR5IGNhbGxiYWNrcwogICAgICAgIENvbGxlY3Rpb248TGlmZWN5\nY2xlQ2FsbGJhY2tzPltdIGxpc3RlbmVycyA9IG51bGw7CiAgICAgICAgTWV0\nYURhdGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDog\nX2Nscy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAg\ndGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAg\nICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFu\nZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihtZXRhLCBhbm5vKTsKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBFTlRJVFlf\nTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMgPSBw\nYXJzZUVudGl0eUxpc3RlbmVycyhtZXRhLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKEVudGl0eUxpc3RlbmVycykgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYQ0xVREVf\nREVGQVVMVF9MSVNURU5FUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEu\nZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLnNldElnbm9yZVN5c3RlbUxpc3RlbmVycyh0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhD\nTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpLnNldElnbm9yZVN1cGVy\nY2xhc3NDYWxsYmFja3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChM\naWZlY3ljbGVNZXRhRGF0YS5JR05PUkVfSElHSCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUobWV0YSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIElEX0NMQVNTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhLnNldE9iamVj\ndElkVHlwZSgoKElkQ2xhc3MpIGFubm8pLnZhbHVlKCksIHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBO\nQVRJVkVfUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVy\neU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZE5h\ndGl2ZVF1ZXJpZXMoX2NscywKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICgoTmFtZWROYXRpdmVRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTkFU\nSVZFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZl\nUXVlcmllcyhfY2xzLCAoTmFtZWROYXRpdmVRdWVyeSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFV\nRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKF9j\nbHMsICgoTmFtZWRRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUlk6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKF9jbHMsIChO\nYW1lZFF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVSQVRPUjoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoX2Ns\ncywgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREFUQV9DQUNIRToK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhQ2FjaGUobWV0YSwgKERh\ndGFDYWNoZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIERBVEFTVE9SRV9JRDoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgcGFyc2VEYXRhU3RvcmVJZChtZXRhLCAoRGF0YVN0b3JlSWQp\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBERVRBQ0hFRF9TVEFURToKICAgICAgICAgICAgICAgICAg\nICBkZXRhY2hlZCA9IChEZXRhY2hlZFN0YXRlKSBhbm5vOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRVRDSF9H\nUk9VUDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZmdzID0gbmV3IEZldGNoR3Jv\ndXBbXXsgKEZldGNoR3JvdXApIGFubm8gfTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkVUQ0hfR1JPVVBTOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBmZ3MgPSAoKEZldGNoR3JvdXBzKSBhbm5v\nKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVk\nIiwgX2NscywKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmlu\nZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNlRGV0YWNoZWRT\ndGF0ZShtZXRhLCBkZXRhY2hlZCk7CgogICAgICAgICAgICAvLyBtZXJnZSBj\nYWxsYmFjayBtZXRob2RzIHdpdGggZGVjbGFyZWQgbGlzdGVuZXJzCiAgICAg\nICAgICAgIGludFtdIGhpZ2hzID0gbnVsbDsKICAgICAgICAgICAgaWYgKGxp\nc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBoaWdocyA9IG5l\ndyBpbnRbbGlzdGVuZXJzLmxlbmd0aF07CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGhpZ2hzW2ldID0gbGlzdGVuZXJzW2ldLnNp\nemUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWNvcmRDYWxsYmFj\na3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2NscywgbGlzdGVuZXJz\nLCBmYWxzZSwKICAgICAgICAgICAgICAgIGZhbHNlLCBnZXRSZXBvc2l0b3J5\nKCkpLCBoaWdocywgZmFsc2UpOwoKICAgICAgICAgICAgLy8gc2NhbiBwb3Nz\naWJseSBub24tUEMgaGllcmFyY2h5IGZvciBjYWxsYmFja3MuCiAgICAgICAg\nICAgIC8vIHJlZHVuZGFudCBmb3IgUEMgc3VwZXJjbGFzcyBidXQgd2UgZG9u\nJ3Qga25vdyB0aGF0IHlldAogICAgICAgICAgICAvLyBzbyBsZXQgTGlmZWN5\nY2xlTWV0YURhdGEgZGV0ZXJtaW5lIHRoYXQKICAgICAgICAgICAgaWYgKCFP\nYmplY3QuY2xhc3MuZXF1YWxzKF9jbHMuZ2V0U3VwZXJjbGFzcygpKSkgewog\nICAgICAgICAgICAgICAgcmVjb3JkQ2FsbGJhY2tzKG1ldGEsIHBhcnNlQ2Fs\nbGJhY2tNZXRob2RzKF9jbHMuZ2V0U3VwZXJjbGFzcygpLAogICAgICAgICAg\nICAgICAgICAgIG51bGwsIHRydWUsIGZhbHNlLCBnZXRSZXBvc2l0b3J5KCkp\nLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKSkKICAgICAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkg\nPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAg\nICAgICAgIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoZm1kKTsKICAgICAgICAv\nLyBwYXJzZSBmZXRjaCBncm91cHMgYWZ0ZXIgZmllbGRzCiAgICAgICAgaWYg\nKGZncyAhPSBudWxsKQogICAgICAgICAgICBwYXJzZUZldGNoR3JvdXBzKG1l\ndGEsIGZncyk7CgogICAgICAgIC8vIGFsd2F5cyBwYXJzZSBtYXBwaW5nIGFm\ndGVyIG1ldGFkYXRhIGluIGNhc2UgdGhlcmUgYXJlIGRlcGVuZGVuY2llcwog\nICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkgewogICAgICAg\nICAgICBwYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRpb25zKG1ldGEpOwogICAg\nICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogbWV0YS5nZXREZWNs\nYXJlZEZpZWxkcygpKQogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRNYW5h\nZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkK\nICAgICAgICAgICAgICAgICAgICBwYXJzZU1lbWJlck1hcHBpbmdBbm5vdGF0\naW9ucyhmbWQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNsYXNzIG1hcHBpbmcgYW5ub3Rh\ndGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlQ2xhc3NN\nYXBwaW5nQW5ub3RhdGlvbnMoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1\nbmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NBbm5vdGF0aW9uKENsYXNzTWV0YURh\ndGEgbWV0YSwKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIG9yIGNy\nZWF0ZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuIE1heSByZXR1cm4g\nbnVsbCBpZgogICAgICogdGhpcyBjbGFzcyBoYXMgYWxyZWFkeSBiZWVuIHBh\ncnNlZCBmdWxseS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRh\nIGdldE1ldGFEYXRhKCkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRNZXRhRGF0YShfY2xzKTsKICAg\nICAgICBpZiAobWV0YSAhPSBudWxsICYmCiAgICAgICAgICAgICgoaXNNZXRh\nRGF0YU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01F\nVEEpICE9IDApIHx8CiAgICAgICAgICAgICAgICAoaXNNYXBwaW5nTW9kZSgp\nICYmCiAgICAgICAgICAgICAgICAgICAgKG1ldGEuZ2V0U291cmNlTW9kZSgp\nICYgTU9ERV9NQVBQSU5HKSAhPSAwKSkpIHsKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJu\nKF9sb2MuZ2V0KCJkdXAtbWV0YWRhdGEiLCBfY2xzLmdldE5hbWUoKSkpOwog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlm\nIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9z\naXRvcnkoKS5hZGRNZXRhRGF0YShfY2xzKTsKICAgICAgICAgICAgbWV0YS5z\nZXRFbnZDbGFzc0xvYWRlcihfZW52TG9hZGVyKTsKICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKE1PREVfTk9ORSk7CiAgICAgICAgICAgIG1ldGEu\nc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgbWV0YS5TUkNfQU5OT1RBVElP\nTlMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERldGVybWluZSB0aGUgc291cmNlIGZpbGUgd2UncmUg\ncGFyc2luZy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpbGUgZ2V0U291cmNl\nRmlsZSgpIHsKICAgICAgICBpZiAoX2ZpbGUgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9maWxlOwoKICAgICAgICBDbGFzcyBjbHMgPSBfY2xzOwog\nICAgICAgIHdoaWxlIChjbHMuZ2V0RW5jbG9zaW5nQ2xhc3MoKSAhPSBudWxs\nKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0RW5jbG9zaW5nQ2xhc3MoKTsK\nCiAgICAgICAgU3RyaW5nIHJzcmMgPSBTdHJpbmdVdGlscy5yZXBsYWNlKGNs\ncy5nZXROYW1lKCksICIuIiwgIi8iKTsKICAgICAgICBDbGFzc0xvYWRlciBs\nb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xv\nYWRlckFjdGlvbihjbHMpKTsgCiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxs\nKQogICAgICAgICAgICBsb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0U3lzdGVtQ2xhc3NMb2FkZXJBY3Rpb24oKSk7IAogICAg\nICAgIGlmIChsb2FkZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgVVJMIHVybCA9IChVUkwpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRS\nZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJzcmMgKyAiLmphdmEiKSk7IAogICAg\nICAgIGlmICh1cmwgPT0gbnVsbCkgewogICAgICAgICAgICB1cmwgPSAoVVJM\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldFJlc291cmNlQWN0aW9uKGxvYWRlciwg\ncnNyYyArICIuY2xhc3MiKSk7IAogICAgICAgICAgICBpZiAodXJsID09IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgX2ZpbGUgPSBuZXcgRmlsZSh1cmwu\ndG9VUkkoKSk7CiAgICAgICAgfSBjYXRjaCAoVVJJU3ludGF4RXhjZXB0aW9u\nIGUpIHsKICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24gaWFlKSB7CiAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhyb3duIHdoZW4g\ndGhlIFVSSSBpcyBub24taGllcmFyY2hpY2FsIChha2EgSkJvc3MpCiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfZmlsZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBEYXRhU3RvcmVJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBhcnNlRGF0YVN0b3JlSWQoQ2xhc3NNZXRhRGF0YSBtZXRhLCBEYXRh\nU3RvcmVJZCBpZCkgewogICAgICAgIG1ldGEuc2V0SWRlbnRpdHlUeXBlKENs\nYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKTsKCiAgICAgICAgaW50IHN0cmF0\nID0gZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShtZXRhLCBpZC5zdHJhdGVn\neSgpLAogICAgICAgICAgICBpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgaWYg\nKHN0cmF0ICE9IC0xKQogICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3Ry\nYXRlZ3koc3RyYXQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0\nY2ggKGlkLnN0cmF0ZWd5KCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFC\nTEU6CiAgICAgICAgICAgICAgICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAg\nICAgICAgICAgIC8vIHRlY2huaWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFy\nYXRlIHN5c3RlbSB0YWJsZSBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBz\nZXF1ZW5jZSBnZW5lcmF0b3JzLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCBy\nZWx5IG9uCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcu\nYXBhY2hlLm9wZW5qcGEuU2VxdWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAg\nICAgICAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGlkLmdl\nbmVyYXRvcigpKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJ\nZGVudGl0eVNlcXVlbmNlTmFtZSgKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIFNlcXVlbmNlTWV0YURhdGEuTkFNRV9TWVNURU0pOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5z\nZXRJZGVudGl0eVNlcXVlbmNlTmFtZShpZC5nZW5lcmF0b3IoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFV\nVE86CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0\nZWd5KFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJREVOVElUWToKICAg\nICAgICAgICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3koVmFs\ndWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oaWQuc3Ry\nYXRlZ3koKS50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhhdCBARmx1c2hNb2RlIGlz\nIG5vdCBzdXBwb3J0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3YXJu\nRmx1c2hNb2RlKE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgaWYgKF9sb2cu\naXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoInVuc3VwcG9ydGVkIiwgIkZsdXNoTW9kZSIsIGNvbnRleHQpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBEYXRhQ2FjaGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZURhdGFDYWNoZShDbGFzc01ldGFEYXRh\nIG1ldGEsIERhdGFDYWNoZSBjYWNoZSkgewogICAgICAgIGlmIChjYWNoZS50\naW1lb3V0KCkgIT0gSW50ZWdlci5NSU5fVkFMVUUpCiAgICAgICAgICAgIG1l\ndGEuc2V0RGF0YUNhY2hlVGltZW91dChjYWNoZS50aW1lb3V0KCkpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShjYWNoZS5uYW1lKCkpKQog\nICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUoY2FjaGUubmFtZSgp\nKTsKICAgICAgICBlbHNlIGlmIChjYWNoZS5lbmFibGVkKCkpCiAgICAgICAg\nICAgIG1ldGEuc2V0RGF0YUNhY2hlTmFtZSgKICAgICAgICAgICAgICAgIG9y\nZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlLk5BTUVfREVG\nQVVMVCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtZXRhLnNldERhdGFD\nYWNoZU5hbWUobnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBA\nRGV0YWNoZWRTdGF0ZS4gVGhlIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZURldGFjaGVkU3RhdGUoQ2xh\nc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIERldGFjaGVkU3RhdGUgZGV0YWNo\nZWQpIHsKICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoIWRldGFjaGVkLmVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShudWxsKTsKICAgICAgICAgICAgZWxz\nZSBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShkZXRhY2hlZC5maWVsZE5hbWUo\nKSkpCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3RhdGUoQ2xh\nc3NNZXRhRGF0YS5TWU5USEVUSUMpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3RhdGUoZGV0YWNoZWQuZmll\nbGROYW1lKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEZpZWxk\nW10gZmllbGRzID0gKEZpZWxkW10pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVj\nbGFyZWRGaWVsZHNBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpKTsgCiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\naWYgKGZpZWxkc1tpXS5pc0Fubm90YXRpb25QcmVzZW50KERldGFjaGVkU3Rh\ndGUuY2xhc3MpKQogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNo\nZWRTdGF0ZShmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBARW50aXR5TGlzdGVuZXJzCiAgICAg\nKi8KICAgIHByaXZhdGUgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+\nW10gcGFyc2VFbnRpdHlMaXN0ZW5lcnMKICAgICAgICAoQ2xhc3NNZXRhRGF0\nYSBtZXRhLCBFbnRpdHlMaXN0ZW5lcnMgbGlzdGVuZXJzKSB7CiAgICAgICAg\nQ2xhc3NbXSBjbGFzc2VzID0gbGlzdGVuZXJzLnZhbHVlKCk7CiAgICAgICAg\nQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VkID0gbnVs\nbDsKICAgICAgICBmb3IgKENsYXNzIGNscyA6IGNsYXNzZXMpCiAgICAgICAg\nICAgIHBhcnNlZCA9IHBhcnNlQ2FsbGJhY2tNZXRob2RzKGNscywgcGFyc2Vk\nLCB0cnVlLCB0cnVlLCAKICAgICAgICAgICAgICAgIGdldFJlcG9zaXRvcnko\nKSk7CiAgICAgICAgcmV0dXJuIHBhcnNlZDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIGNhbGxiYWNrIG1ldGhvZHMgaW50byB0aGUgZ2l2ZW4gYXJy\nYXksIGFuZCByZXR1cm4gdGhhdCBhcnJheSwKICAgICAqIGNyZWF0aW5nIG9u\nZSBpZiBudWxsLiBFYWNoIGluZGV4IGludG8gdGhlIGFycmF5IGlzIGEgY29s\nbGVjdGlvbiBvZgogICAgICogY2FsbGJhY2sgYWRhcHRlcnMgZm9yIHRoYXQg\nbnVtZXJpYyBldmVudCB0eXBlLgogICAgICoKICAgICAqIEBwYXJhbSBzdXBz\nIHdoZXRoZXIgdG8gc2NhbiBzdXBlcmNsYXNzZXMKICAgICAqIEBwYXJhbSBs\naXN0ZW5lciB3aGV0aGVyIHRoaXMgaXMgYSBsaXN0ZW5lciBvciBub3QKICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBDb2xsZWN0aW9uPExpZmVjeWNsZUNh\nbGxiYWNrcz5bXSBwYXJzZUNhbGxiYWNrTWV0aG9kcwogICAgICAgIChDbGFz\ncyBjbHMsIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGNhbGxi\nYWNrcywgYm9vbGVhbiBzdXBzLAogICAgICAgIGJvb2xlYW4gbGlzdGVuZXIs\nIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcykgewogICAgICAgIC8vIGZpcnN0\nIHNvcnQgLyBmaWx0ZXIgYmFzZWQgb24gaW5oZXJpdGFuY2UKICAgICAgICBT\nZXQ8TWV0aG9kPiBtZXRob2RzID0gbmV3IFRyZWVTZXQ8TWV0aG9kPihNZXRo\nb2RDb21wYXJhdG9yLgogICAgICAgICAgICBnZXRJbnN0YW5jZSgpKTsKCiAg\nICAgICAgaW50IG1vZHM7CiAgICAgICAgQ2xhc3Mgc3VwID0gY2xzOwogICAg\nICAgIE1ldGhvZEtleSBrZXk7CiAgICAgICAgU2V0PE1ldGhvZEtleT4gc2Vl\nbiA9IG5ldyBIYXNoU2V0PE1ldGhvZEtleT4oKTsKICAgICAgICBkbyB7CiAg\nICAgICAgICAgIGZvciAoTWV0aG9kIG0gOiAoTWV0aG9kW10pIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RzQWN0aW9uKHN1cCkpKSB7CiAg\nICAgICAgICAgICAgICBtb2RzID0gbS5nZXRNb2RpZmllcnMoKTsKICAgICAg\nICAgICAgICAgIGlmIChNb2RpZmllci5pc1N0YXRpYyhtb2RzKSB8fCBNb2Rp\nZmllci5pc0ZpbmFsKG1vZHMpIHx8CiAgICAgICAgICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLmVxdWFscyhtLmdldERlY2xhcmluZ0NsYXNzKCkpKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGtl\neSA9IG5ldyBNZXRob2RLZXkobSk7CiAgICAgICAgICAgICAgICBpZiAoIXNl\nZW4uY29udGFpbnMoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIG1ldGhv\nZHMuYWRkKG0pOwogICAgICAgICAgICAgICAgICAgIHNlZW4uYWRkKGtleSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICB9IHdoaWxlIChz\ndXBzICYmICFPYmplY3QuY2xhc3MuZXF1YWxzKHN1cCkpOwoKICAgICAgICBN\nZXRhRGF0YURlZmF1bHRzIGRlZiA9IHJlcG9zLmdldE1ldGFEYXRhRmFjdG9y\neSgpLmdldERlZmF1bHRzKCk7CiAgICAgICAgZm9yIChNZXRob2QgbSA6IG1l\ndGhvZHMpIHsKICAgICAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBt\nLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICAgICAg\nTWV0YURhdGFUYWcgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5\ncGUoKSk7CiAgICAgICAgICAgICAgICBpZiAodGFnID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpbnRb\nXSBldmVudHMgPSBNZXRhRGF0YVBhcnNlcnMuZ2V0RXZlbnRUeXBlcyh0YWcp\nOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50cyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlmIChj\nYWxsYmFja3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjYWxsYmFj\na3MgPSAoQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10pCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBDb2xsZWN0aW9uW0xpZmVjeWNsZUV2\nZW50LkFMTF9FVkVOVFMubGVuZ3RoXTsKCiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgICAgIGludCBlID0gZXZlbnRzW2ldOwogICAgICAgICAgICAg\nICAgICAgIGlmIChjYWxsYmFja3NbZV0gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgY2FsbGJhY2tzW2VdID0gbmV3IEFycmF5TGlzdCgzKTsK\nICAgICAgICAgICAgICAgICAgICBNZXRhRGF0YVBhcnNlcnMudmFsaWRhdGVN\nZXRob2RzRm9yU2FtZUNhbGxiYWNrKGNscywgCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNhbGxiYWNrc1tlXSwgbSwgdGFnLCBkZWYsIHJlcG9zLmdldExv\nZygpKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLmFkZChuZXcgQmVh\nbkxpZmVjeWNsZUNhbGxiYWNrcyhjbHMsIG0sCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmYWxzZSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tlXS5hZGQo\nbmV3IE1ldGhvZExpZmVjeWNsZUNhbGxiYWNrcyhtLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZmFsc2UpKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGNhbGxiYWNrczsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBTdG9yZSBsaWZlY3ljbGUgbWV0YWRhdGEuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCByZWNvcmRDYWxsYmFja3MoQ2xhc3NNZXRhRGF0YSBjbHMs\nCiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gY2Fs\nbGJhY2tzLCBpbnRbXSBoaWdocywKICAgICAgICBib29sZWFuIHN1cGVyQ2xh\nc3MpIHsKICAgICAgICBpZiAoY2FsbGJhY2tzID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBMaWZlY3ljbGVNZXRhRGF0YSBtZXRhID0g\nY2xzLmdldExpZmVjeWNsZU1ldGFEYXRhKCk7CiAgICAgICAgTGlmZWN5Y2xl\nQ2FsbGJhY2tzW10gYXJyYXk7CiAgICAgICAgZm9yIChpbnQgZXZlbnQgOiBM\naWZlY3ljbGVFdmVudC5BTExfRVZFTlRTKSB7CiAgICAgICAgICAgIGlmIChj\nYWxsYmFja3NbZXZlbnRdID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgYXJyYXkgPSBjYWxsYmFja3NbZXZlbnRdLnRv\nQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgTGlmZWN5Y2xlQ2FsbGJhY2tz\nW2NhbGxiYWNrc1tldmVudF0uc2l6ZSgpXSk7CgogICAgICAgICAgICBpZiAo\nc3VwZXJDbGFzcykgewogICAgICAgICAgICAgICAgbWV0YS5zZXROb25QQ1N1\ncGVyY2xhc3NDYWxsYmFja3MoZXZlbnQsIGFycmF5LAogICAgICAgICAgICAg\nICAgICAgIChoaWdocyA9PSBudWxsKSA/IDAgOiBoaWdoc1tldmVudF0pOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWV0YS5zZXRE\nZWNsYXJlZENhbGxiYWNrcyhldmVudCwgYXJyYXksCiAgICAgICAgICAgICAg\nICAgICAgKGhpZ2hzID09IG51bGwpID8gMCA6IGhpZ2hzW2V2ZW50XSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgZmV0Y2ggZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VGZXRjaEdyb3VwcyhDbGFzc01ldGFEYXRhIG1ldGEsIEZldGNoR3Jv\ndXAuLi4gZ3JvdXBzKSB7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmV0Y2hHcm91cCBmZzsKICAgICAgICBmb3IgKEZldGNoR3JvdXAgZ3Jv\ndXAgOiBncm91cHMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkoZ3JvdXAubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5uYW1lZC1mZyIsIG1l\ndGEpKTsKCiAgICAgICAgICAgIGZnID0gbWV0YS5hZGREZWNsYXJlZEZldGNo\nR3JvdXAoZ3JvdXAubmFtZSgpKTsKICAgICAgICAgICAgaWYgKGdyb3VwLnBv\nc3RMb2FkKCkpCiAgICAgICAgICAgICAgICBmZy5zZXRQb3N0TG9hZCh0cnVl\nKTsgCiAgICAgICAgICAgIGZvciAoU3RyaW5nIHMgOiBncm91cC5mZXRjaEdy\nb3VwcygpKQogICAgICAgICAgICAgICAgZmcuYWRkRGVjbGFyZWRJbmNsdWRl\nKHMpOwogICAgICAgICAgICBmb3IgKEZldGNoQXR0cmlidXRlIGF0dHIgOiBn\ncm91cC5hdHRyaWJ1dGVzKCkpCiAgICAgICAgICAgICAgICBwYXJzZUZldGNo\nQXR0cmlidXRlKG1ldGEsIGZnLCBhdHRyKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgYSBmaWVsZCdzIGZldGNoIGdyb3VwLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VGZXRjaEF0dHJpYnV0ZShDbGFz\nc01ldGFEYXRhIG1ldGEsIAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkZldGNoR3JvdXAgZmcsIEZldGNoQXR0cmlidXRlIGF0dHIpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gbWV0YS5nZXREZWNsYXJlZEZp\nZWxkKGF0dHIubmFtZSgpKTsKICAgICAgICBpZiAoZmllbGQgPT0gbnVsbAog\nICAgICAgICAgICB8fCBmaWVsZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRN\nZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmctZmllbGQi\nLCBmZy5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBtZXRhLCBhdHRyLm5h\nbWUoKSkpOwoKICAgICAgICBmaWVsZC5zZXRJbkZldGNoR3JvdXAoZmcuZ2V0\nTmFtZSgpLCB0cnVlKTsKICAgICAgICBpZiAoYXR0ci5yZWN1cnNpb25EZXB0\naCgpICE9IEludGVnZXIuTUlOX1ZBTFVFKQogICAgICAgICAgICBmZy5zZXRS\nZWN1cnNpb25EZXB0aChmaWVsZCwgYXR0ci5yZWN1cnNpb25EZXB0aCgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgYW5ub3RhdGlvbnMgZm9yIHRo\nZSBnaXZlbiBtZW1iZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZU1lbWJlckFubm90YXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgLy8gbG9vayBmb3IgcGVyc2lzdGVuY2Ugc3RyYXRlZ3kgaW4gYW5ub3Rh\ndGlvbiB0YWJsZQogICAgICAgIE1lbWJlciBtZW1iZXIgPSBnZXRSZXBvc2l0\nb3J5KCkuZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS4KICAg\nICAgICAgICAgZ2V0QmFja2luZ01lbWJlcihmbWQpOwogICAgICAgIFBlcnNp\nc3RlbmNlU3RyYXRlZ3kgcHN0cmF0ID0gUGVyc2lzdGVuY2VNZXRhRGF0YURl\nZmF1bHRzLgogICAgICAgICAgICBnZXRQZXJzaXN0ZW5jZVN0cmF0ZWd5KGZt\nZCwgbWVtYmVyKTsKICAgICAgICBpZiAocHN0cmF0ID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBmbWQuc2V0RXhwbGljaXQodHJ1ZSk7\nCgogICAgICAgIEFubm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxl\nbWVudCkgbWVtYmVyOwogICAgICAgIGJvb2xlYW4gbG9iID0gZWwuaXNBbm5v\ndGF0aW9uUHJlc2VudChMb2IuY2xhc3MpOwogICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIHN3aXRjaCAocHN0cmF0KSB7CiAg\nICAgICAgICAgICAgICBjYXNlIEJBU0lDOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlQmFzaWMoZm1kLCAoQmFzaWMpIGVsLmdldEFubm90YXRpb24oQmFz\naWMuY2xhc3MpLCBsb2IpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBNQU5ZX09ORToKICAgICAgICAgICAgICAg\nICAgICBwYXJzZU1hbnlUb09uZShmbWQsIChNYW55VG9PbmUpIGVsLmdldEFu\nbm90YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgKE1hbnlUb09uZS5j\nbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBPTkVfT05FOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nT25lVG9PbmUoZm1kLCAoT25lVG9PbmUpIGVsLmdldEFubm90YXRpb24KICAg\nICAgICAgICAgICAgICAgICAgICAgKE9uZVRvT25lLmNsYXNzKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVN\nQkVEREVEOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRW1iZWRkZWQoZm1k\nLCAoRW1iZWRkZWQpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAg\nICAgICAgICAgKEVtYmVkZGVkLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9ORV9NQU5ZOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlT25lVG9NYW55KGZtZCwgKE9uZVRvTWFu\neSkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAo\nT25lVG9NYW55LmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIE1BTllfTUFOWToKICAgICAgICAgICAg\nICAgICAgICBwYXJzZU1hbnlUb01hbnkoZm1kLCAoTWFueVRvTWFueSkgZWwu\nZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoTWFueVRv\nTWFueS5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBQRVJTOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlUGVyc2lzdGVudChmbWQsIChQZXJzaXN0ZW50KSBlbC5nZXRBbm5vdGF0\naW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChQZXJzaXN0ZW50LmNsYXNz\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIFBFUlNfQ09MTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVBl\ncnNpc3RlbnRDb2xsZWN0aW9uKGZtZCwgKFBlcnNpc3RlbnRDb2xsZWN0aW9u\nKQogICAgICAgICAgICAgICAgICAgICAgICBlbC5nZXRBbm5vdGF0aW9uKFBl\ncnNpc3RlbnRDb2xsZWN0aW9uLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBFUlNfTUFQOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlUGVyc2lzdGVudE1hcChmbWQsIChQZXJz\naXN0ZW50TWFwKQogICAgICAgICAgICAgICAgICAgICAgICBlbC5nZXRBbm5v\ndGF0aW9uKFBlcnNpc3RlbnRNYXAuY2xhc3MpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFJBTlNJRU5UOgog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpICYmIGxvYikKICAgICAgICAg\nICAgcGFyc2VMb2JNYXBwaW5nKGZtZCk7CgogICAgICAgIC8vIGV4dGVuc2lv\nbnMKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAgICAgZm9yIChBbm5v\ndGF0aW9uIGFubm8gOiBlbC5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsK\nICAgICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5\ncGUoKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaGFuZGxlVW5rbm93bk1lbWJlckFubm90YXRpb24oZm1kLCBh\nbm5vKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAg\nY2FzZSBGTFVTSF9NT0RFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01l\ndGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuRmx1\nc2hNb2RlKGZtZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEdFTkVSQVRFRF9WQUxVRToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcnNlR2VuZXJhdGVkVmFsdWUoZm1kLCAoR2Vu\nZXJhdGVkVmFsdWUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBJRDoKICAgICAgICAgICAgICAgIGNh\nc2UgRU1CRURERURfSUQ6CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldFBy\naW1hcnlLZXkodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE1BUF9LRVk6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZU1hcEtleShmbWQsIChNYXBLZXkpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBPUkRFUl9CWToKICAgICAgICAgICAgICAgICAgICBwYXJzZU9yZGVyQnko\nZm1kLAogICAgICAgICAgICAgICAgICAgICAgICAoT3JkZXJCeSkgZWwuZ2V0\nQW5ub3RhdGlvbihPcmRlckJ5LmNsYXNzKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNFUV9HRU5FUkFUT1I6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVNlcXVlbmNlR2Vu\nZXJhdG9yKGVsLCAoU2VxdWVuY2VHZW5lcmF0b3IpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBWRVJT\nSU9OOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWZXJzaW9uKHRydWUp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBERVBFTkRFTlQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkgJiYgKChEZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRDYXNjYWRlRGVsZXRlKFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9ERVBFTkRFTlQ6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkgJiYg\nKChFbGVtZW50RGVwZW5kZW50KSBhbm5vKS52YWx1ZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldENhc2NhZGVEZWxl\ndGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfQVVUTyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEVMRU1fVFlQRToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRUeXBlT3ZlcnJpZGUodG9PdmVy\ncmlkZVR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoKEVsZW1l\nbnRUeXBlKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYVEVSTkFMX1ZBTFM6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZtZC5zZXRFeHRlcm5hbFZhbHVlcyhTdHJp\nbmdzLmpvaW4oKChFeHRlcm5hbFZhbHVlcykKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGFubm8pLnZhbHVlKCksICIsIikpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWFRFUk5BTEla\nRVI6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRFeHRlcm5hbGl6ZXIo\nKChFeHRlcm5hbGl6ZXIpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGQUNUT1JZOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RmFjdG9yeSgoKEZhY3Rvcnkp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBJTlZFUlNFX0xPR0lDQUw6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZtZC5zZXRJbnZlcnNlKCgoSW52ZXJzZUxvZ2ljYWwp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBLRVlfREVQRU5ERU5UOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpICYmICgoS2V5RGVwZW5k\nZW50KSBhbm5vKS52YWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBm\nbWQuZ2V0S2V5KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRD\nYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nS0VZX1RZUEU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5z\nZXRUeXBlT3ZlcnJpZGUodG9PdmVycmlkZVR5cGUoKChLZXlUeXBlKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYW5ubykudmFsdWUoKSkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBM\nT0FEX0ZFVENIX0dST1VQOgogICAgICAgICAgICAgICAgCWlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgCQlmbWQuc2V0TG9hZEZldGNo\nR3JvdXAoKChMb2FkRmV0Y2hHcm91cCkgYW5ubykudmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAJYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIExSUzoK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgZm1kLnNldExSUygoKExSUykgYW5ubyku\ndmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFJFQURfT05MWToKICAgICAgICAgICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFyc2VSZWFkT25seShmbWQsIChSZWFkT25seSkgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEU6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRUeXBlT3ZlcnJpZGUodG9P\ndmVycmlkZVR5cGUoKChUeXBlKSBhbm5vKS4KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHZhbHVlKCkpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1\nbnN1cHBvcnRlZCIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAgICAgYW5u\nby50b1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBtZW1iZXIgbWFwcGluZyBjb21wb25l\nbnRzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU1lbWJlck1h\ncHBpbmdBbm5vdGF0aW9ucyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgfQoK\nICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5r\nbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaGFuZGxlVW5rbm93bk1lbWJlckFubm90YXRpb24oRmllbGRNZXRhRGF0\nYSBmbWQsCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nZ2l2ZW4gY2xhc3MgdG8gaXRzIE9wZW5KUEEgdHlwZSBvdmVycmlkZSBlcXVp\ndmFsZW50LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzcyB0b092\nZXJyaWRlVHlwZShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gKGNscyA9\nPSBFbnRpdHkuY2xhc3MpCiAgICAgICAgICAgID8gb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzIDogY2xzOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFJlYWRPbmx5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VSZWFkT25seShGaWVsZE1ldGFEYXRh\nIGZtZCwgUmVhZE9ubHkgcm8pIHsKICAgICAgICBpZiAocm8udmFsdWUoKSA9\nPSBVcGRhdGVBY3Rpb24uUkVTVFJJQ1QpCiAgICAgICAgICAgIGZtZC5zZXRV\ncGRhdGVTdHJhdGVneShVcGRhdGVTdHJhdGVnaWVzLlJFU1RSSUNUKTsKICAg\nICAgICBlbHNlIGlmIChyby52YWx1ZSgpID09IFVwZGF0ZUFjdGlvbi5JR05P\nUkUpCiAgICAgICAgICAgIGZtZC5zZXRVcGRhdGVTdHJhdGVneShVcGRhdGVT\ndHJhdGVnaWVzLklHTk9SRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3Ig\ndGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VHZW5lcmF0ZWRWYWx1ZShGaWVsZE1ldGFEYXRhIGZtZCwgR2VuZXJhdGVk\nVmFsdWUgZ2VuKSB7CiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3kg\nPSBnZW4uc3RyYXRlZ3koKTsKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yID0g\nZ2VuLmdlbmVyYXRvcigpOwogICAgICAgIHBhcnNlR2VuZXJhdGVkVmFsdWUo\nZm1kLCBzdHJhdGVneSwgZ2VuZXJhdG9yKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldHMgdmFsdWUgZ2VuZXJhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhl\nIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBzdGF0aWMgdm9pZCBwYXJzZUdl\nbmVyYXRlZFZhbHVlKEZpZWxkTWV0YURhdGEgZm1kLCBHZW5lcmF0aW9uVHlw\nZSBzdHJhdGVneSwKICAgICAgICBTdHJpbmcgZ2VuZXJhdG9yKSB7CiAgICAg\nICAgaW50IHN0cmF0ID0gZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShmbWQs\nIHN0cmF0ZWd5LCBnZW5lcmF0b3IpOwogICAgICAgIGlmIChzdHJhdCAhPSAt\nMSkKICAgICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koc3RyYXQpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7\nCiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAg\nY2FzZSBTRVFVRU5DRToKICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmlj\nYWxseSB3ZSBzaG91bGQgaGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5k\nCiAgICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywg\nYnV0IGl0J3MgZWFzaWVyIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAg\nICAgICAgIC8vIHRoZSBzeXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVl\nbmNlIHNldHRpbmcgZm9yIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAgICAgICAg\nICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VN\nZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFsdWVTZXF1ZW5j\nZU5hbWUoZ2VuZXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQVVUTzoKICAgICAgICAgICAgICAgICAg\nICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5O\nQU1FX1NZU1RFTSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIElERU5USVRZOgogICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRWYWx1ZVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNT\nSUdOKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKHN0cmF0ZWd5LnRvU3RyaW5nKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB2YWx1ZSBzdHJhdGVneSBmb3IgdGhlIGdpdmVuIGdlbmVyYXRv\nciwgb3IgLTEgaWYgdGhlCiAgICAgKiBzdHJhdGVneSBkZXBlbmRzIG9uIHRo\nZSA8Y29kZT5HZW5lcmF0aW9uVHlwZTwvY29kZT4gcmF0aGVyIHRoYW4gdGhl\nCiAgICAgKiBnZW5lcmF0b3IgbmFtZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgaW50IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koT2JqZWN0IGNv\nbnRleHQsCiAgICAgICAgR2VuZXJhdGlvblR5cGUgc3RyYXRlZ3ksIFN0cmlu\nZyBnZW5lcmF0b3IpIHsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0gQVVUTyB8\nfCBTdHJpbmdVdGlscy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAgICAgICAg\nIHJldHVybiAtMTsKCiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX0hFWC5l\ncXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVlU3Ry\nYXRlZ2llcy5VVUlEX0hFWDsKICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURf\nU1RSSU5HLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1cm4g\nVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RSSU5HOwogICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZ2VuZXJhdG9yLWJhZC1z\ndHJhdGVneSIsCiAgICAgICAgICAgIGNvbnRleHQsIGdlbmVyYXRvcikpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEJhc2ljLiBHaXZlbiBhbm5v\ndGF0aW9uIG1heSBiZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VCYXNpYyhGaWVsZE1ldGFEYXRhIGZtZCwgQmFzaWMgYW5ubywgYm9v\nbGVhbiBsb2IpIHsKICAgICAgICBDbGFzcyB0eXBlID0gZm1kLmdldERlY2xh\ncmVkVHlwZSgpOwogICAgICAgIGlmIChsb2IgJiYgdHlwZSAhPSBTdHJpbmcu\nY2xhc3MKICAgICAgICAgICAgJiYgdHlwZSAhPSBjaGFyW10uY2xhc3MgJiYg\ndHlwZSAhPSBDaGFyYWN0ZXJbXS5jbGFzcwogICAgICAgICAgICAmJiB0eXBl\nICE9IGJ5dGVbXS5jbGFzcyAmJiB0eXBlICE9IEJ5dGVbXS5jbGFzcykKICAg\nICAgICAgICAgZm1kLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAgICAgICAgZWxz\nZSBpZiAoIWxvYikgewogICAgICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgICAgICBpZiAoRW51bS5jbGFz\ncy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJy\nZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9O\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgICAg\nIGlmIChTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBl\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldFNlcmlhbGl6ZWQo\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLCAiQmFzaWMiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgICAgICAgICBpZiAodHlwZSA9PSBjaGFyW10uY2xhc3MgfHwgdHlw\nZSA9PSBDaGFyYWN0ZXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAg\nICB8fCB0eXBlID09IGJ5dGVbXS5jbGFzcyB8fCB0eXBlID09IEJ5dGVbXS5j\nbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tCiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlLmdldENvbXBv\nbmVudFR5cGUoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRT\nZXJpYWxpemVkKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZtZCwgIkJhc2ljIikpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBp\nZiAoYW5ubyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZl\ndGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkp\nCiAgICAgICAgICAgIGZtZC5zZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5O\nVUxMX0VYQ0VQVElPTik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBA\nTWFueVRvT25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYW55\nVG9PbmUoRmllbGRNZXRhRGF0YSBmbWQsIE1hbnlUb09uZSBhbm5vKSB7CiAg\nICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJN\nYW55VG9PbmUiKSk7CgogICAgICAgIC8vIGRvbid0IHNwZWNpZmljYWxseSBl\neGNsdWRlIHJlbGF0aW9uIGZyb20gREZHIGIvYyB0aGF0IHdpbGwgcHJldmVu\ndAogICAgICAgIC8vIHVzIGZyb20gZXZlbiByZWFkaW5nIHRoZSBmayB3aGVu\nIHJlYWRpbmcgZnJvbSB0aGUgcHJpbWFyeSB0YWJsZSwKICAgICAgICAvLyB3\naGljaCBpcyBub3Qgd2hhdCBtb3N0IHVzZXJzIHdpbGwgd2FudAogICAgICAg\nIGlmIChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKQogICAgICAg\nICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAg\nICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51\nbGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9OKTsKICAgICAg\nICBpZiAoYW5uby50YXJnZXRFbnRpdHkoKSAhPSB2b2lkLmNsYXNzKQogICAg\nICAgICAgICBmbWQuc2V0VHlwZU92ZXJyaWRlKGFubm8udGFyZ2V0RW50aXR5\nKCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZCwgYW5uby5jYXNjYWRlKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9uZVRvT25lLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPbmVUb09uZShGaWVsZE1ldGFE\nYXRhIGZtZCwgT25lVG9PbmUgYW5ubykgewogICAgICAgIGlmICghSmF2YVR5\ncGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFu\nbm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiT25lVG9PbmUiKSk7CgogICAg\nICAgIC8vIGRvbid0IHNwZWNpZmljYWxseSBleGNsdWRlIHJlbGF0aW9uIGZy\nb20gREZHIGIvYyB0aGF0IHdpbGwgcHJldmVudAogICAgICAgIC8vIHVzIGZy\nb20gZXZlbiByZWFkaW5nIHRoZSBmayB3aGVuIHJlYWRpbmcgZnJvbSB0aGUg\ncHJpbWFyeSB0YWJsZSwKICAgICAgICAvLyB3aGljaCBpcyBub3Qgd2hhdCBt\nb3N0IHVzZXJzIHdpbGwgd2FudAogICAgICAgIGlmIChhbm5vLmZldGNoKCkg\nPT0gRmV0Y2hUeXBlLkVBR0VSKQogICAgICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9u\nYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFE\nYXRhLk5VTExfRVhDRVBUSU9OKTsKCiAgICAgICAgaWYgKGlzTWFwcGluZ092\nZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFw\ncGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1h\ncHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9\nIHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5zZXRUeXBlT3ZlcnJpZGUo\nYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1k\nLCBhbm5vLmNhc2NhZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBARW1iZWRkZWQuIEdpdmVuIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVkKEZpZWxkTWV0\nYURhdGEgZm1kLCBFbWJlZGRlZCBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZh\nVHlwZXMubWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEt\nYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJFbWJlZGRlZCIpKTsKCiAg\nICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAg\nICAgZm1kLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgIGlmIChmbWQuZ2V0\nRW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgIGZtZC5h\nZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBAT25lVG9NYW55LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VPbmVUb01hbnkoRmllbGRNZXRhRGF0YSBmbWQsIE9uZVRvTWFueSBhbm5v\nKSB7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoSmF2YVR5\ncGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1k\nLAogICAgICAgICAgICAgICAgICAgICJPbmVUb01hbnkiKSk7CiAgICAgICAg\nfQoKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZl\ndGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5u\nby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFu\nbm8ubWFwcGVkQnkoKSk7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5\nKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXREZWNsYXJlZFR5cGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5jYXNjYWRl\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hbnlUb01hbnku\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1hbnlUb01hbnkoRmll\nbGRNZXRhRGF0YSBmbWQsIE1hbnlUb01hbnkgYW5ubykgewogICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBDKGZt\nZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAg\nICAgICAgICAiT25lVG9NYW55IikpOwogICAgICAgIH0KCiAgICAgICAgZm1k\nLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNo\nVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9k\nZSgpICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkp\nCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkp\nOwogICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xh\nc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRU\neXBlKGFubm8udGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVz\nKGZtZC5nZXRFbGVtZW50KCksIGFubm8uY2FzY2FkZSgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIEBNYXBLZXkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZU1hcEtleShGaWVsZE1ldGFEYXRhIGZtZCwgTWFwS2V5\nIGFubm8pIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGFubm8ubmFtZSgpOwog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAg\nICAgICBmbWQuZ2V0S2V5KCkuc2V0VmFsdWVNYXBwZWRCeShWYWx1ZU1ldGFE\nYXRhLk1BUFBFRF9CWV9QSyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBm\nbWQuZ2V0S2V5KCkuc2V0VmFsdWVNYXBwZWRCeShuYW1lKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldHVwIHRoZSBmaWVsZCBhcyBhIExPQiBtYXBwaW5n\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUxvYk1hcHBpbmco\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBPcmRlckJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VP\ncmRlckJ5KEZpZWxkTWV0YURhdGEgZm1kLCBPcmRlckJ5IGFubm8pIHsKICAg\nICAgICBTdHJpbmcgZGVjID0gYW5uby52YWx1ZSgpOwogICAgICAgIGlmIChk\nZWMubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgZGVjID0gT3JkZXIuRUxF\nTUVOVCArICIgYXNjIjsKICAgICAgICBmbWQuc2V0T3JkZXJEZWNsYXJhdGlv\nbihkZWMpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFBlcnNpc3Rl\nbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNpc3RlbnQo\nRmllbGRNZXRhRGF0YSBmbWQsIFBlcnNpc3RlbnQgYW5ubykgewogICAgICAg\nIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGlm\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAg\nICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgpID09IEJ5\ndGVbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgICAgICAg\nICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xh\nc3MpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAgICAg\nIlBlcnNpc3RlbnQiKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIVN0cmlu\nZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAg\nZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAgZm1k\nLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09IEZldGNo\nVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkpCiAg\nICAgICAgICAgIGZtZC5zZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxM\nX0VYQ0VQVElPTik7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNh\nc2NhZGUoKSk7CiAgICAgICAgaWYgKGFubm8uZW1iZWRkZWQoKSkgewogICAg\nICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgp\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAg\nICAgICAgICAiUGVyc2lzdGVudChlbWJlZGRlZD10cnVlKSIpKTsKICAgICAg\nICAgICAgZm1kLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAo\nZm1kLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgZm1kLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudENvbGxlY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNpc3RlbnRD\nb2xsZWN0aW9uKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIFBlcnNpc3Rl\nbnRDb2xsZWN0aW9uIGFubm8pIHsKICAgICAgICBpZiAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQVJSQVkKICAgICAgICAgICAg\nJiYgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQ09M\nTEVDVElPTikKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAg\nICAgICAgIlBlcnNpc3RlbnRDb2xsZWN0aW9uIikpOwoKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAg\nICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAg\nICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgpID09\nIEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudFR5\ncGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVu\ndCgpLnNldERlY2xhcmVkVHlwZShhbm5vLmVsZW1lbnRUeXBlKCkpOwogICAg\nICAgIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8uZWxlbWVu\ndENhc2NhZGUoKSk7CiAgICAgICAgaWYgKGFubm8uZWxlbWVudEVtYmVkZGVk\nKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQu\nZ2V0RWxlbWVudCgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwK\nICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVudENvbGxlY3Rpb24oZW1i\nZWRkZWRFbGVtZW50PXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0RWxl\nbWVudCgpLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1k\nLmdldEVsZW1lbnQoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuYWRkRW1iZWRkZWRN\nZXRhRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBQZXJzaXN0ZW50TWFwLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VQZXJzaXN0ZW50TWFwKEZpZWxkTWV0YURhdGEgZm1kLCBQZXJzaXN0\nZW50TWFwIGFubm8pIHsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSAhPSBKYXZhVHlwZXMuTUFQKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8i\nLCBmbWQsCiAgICAgICAgICAgICAgICAiUGVyc2lzdGVudE1hcCIpKTsKCiAg\nICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgp\nID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGFubm8ua2V5VHlw\nZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5z\nZXREZWNsYXJlZFR5cGUoYW5uby5rZXlUeXBlKCkpOwogICAgICAgIGlmIChh\nbm5vLmVsZW1lbnRUeXBlKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAg\nZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5uby5lbGVtZW50\nVHlwZSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0S2V5KCksIGFu\nbm8ua2V5Q2FzY2FkZSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0\nRWxlbWVudCgpLCBhbm5vLmVsZW1lbnRDYXNjYWRlKCkpOwogICAgICAgIGlm\nIChhbm5vLmtleUVtYmVkZGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFKYXZh\nVHlwZXMubWF5YmVQQyhmbWQuZ2V0S2V5KCkpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0\nYS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50\nTWFwKGVtYmVkZGVkS2V5PXRydWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0\nS2V5KCkuc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQu\nZ2V0S2V5KCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmbWQuZ2V0S2V5KCkuYWRkRW1iZWRkZWRNZXRhRGF0YSgp\nOwogICAgICAgIH0KICAgICAgICBpZiAoYW5uby5lbGVtZW50RW1iZWRkZWQo\nKSkgewogICAgICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5n\nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAog\nICAgICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50TWFwKGVtYmVkZGVkVmFs\ndWU9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0\nRW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVu\ndCgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IGNhc2NhZGVz\nIG9uIHJlbGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Q2Fz\nY2FkZXMoVmFsdWVNZXRhRGF0YSB2bWQsIENhc2NhZGVUeXBlW10gY2FzY2Fk\nZXMpIHsKICAgICAgICBmb3IgKENhc2NhZGVUeXBlIGNhc2NhZGUgOiBjYXNj\nYWRlcykgewogICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlw\nZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5SRU1PVkUpCiAgICAg\nICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUg\nPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUu\nUEVSU0lTVCkKICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlUGVyc2lz\ndChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAgICAg\nICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxMIHx8IGNhc2NhZGUg\nPT0gQ2FzY2FkZVR5cGUuTUVSR0UpCiAgICAgICAgICAgICAgICB2bWQuc2V0\nQ2FzY2FkZUF0dGFjaChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRF\nKTsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxM\nIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUkVGUkVTSCkKICAgICAgICAg\nICAgICAgIHZtZC5zZXRDYXNjYWRlUmVmcmVzaChWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfSU1NRURJQVRFKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZSBAU2VxdWVuY2VHZW5lcmF0b3IuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKEFubm90YXRlZEVs\nZW1lbnQgZWwsCiAgICAgICAgU2VxdWVuY2VHZW5lcmF0b3IgZ2VuKSB7CiAg\nICAgICAgU3RyaW5nIG5hbWUgPSBnZW4ubmFtZSgpOwogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNlcS1uYW1lIiwg\nZWwpKTsKCiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2Utc2VxdWVuY2Ui\nLCBuYW1lKSk7CgogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IGdl\ndFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRTZXF1ZW5jZU1ldGFEYXRhCiAgICAg\nICAgICAgIChuYW1lKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHVwLXNlcXVlbmNlIiwgbmFt\nZSwgZWwpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gY3JlYXRlIG5ldyBzZXF1ZW5jZQogICAgICAgIG1ldGEgPSBnZXRS\nZXBvc2l0b3J5KCkuYWRkU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAg\nICBTdHJpbmcgc2VxID0gZ2VuLnNlcXVlbmNlTmFtZSgpOwogICAgICAgIGlu\ndCBpbml0aWFsID0gZ2VuLmluaXRpYWxWYWx1ZSgpOwogICAgICAgIGludCBh\nbGxvY2F0ZSA9IGdlbi5hbGxvY2F0aW9uU2l6ZSgpOwogICAgICAgIC8vIGRv\nbid0IGFsbG93IGluaXRpYWwgb2YgMCBiL2MgbG9va3MgbGlrZSBkZWYgdmFs\ndWUKICAgICAgICBpZiAoaW5pdGlhbCA9PSAwKQogICAgICAgICAgICBpbml0\naWFsID0gMTsKCiAgICAgICAgLy8gY3JlYXRlIHBsdWdpbiBzdHJpbmcgZnJv\nbSBpbmZvCiAgICAgICAgU3RyaW5nIGNsc05hbWUsIHByb3BzOwogICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNlcSkpIHsKICAgICAgICAgICAg\nY2xzTmFtZSA9IFNlcXVlbmNlTWV0YURhdGEuSU1QTF9OQVRJVkU7CiAgICAg\nICAgICAgIHByb3BzID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKHNlcS5p\nbmRleE9mKCcoJykgIT0gLTEpIC8vIHBsdWdpbgogICAgICAgIHsKICAgICAg\nICAgICAgY2xzTmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShz\nZXEpOwogICAgICAgICAgICBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFBy\nb3BlcnRpZXMoc2VxKTsKICAgICAgICAgICAgc2VxID0gbnVsbDsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBjbHNOYW1lID0gU2VxdWVuY2VNZXRh\nRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJvcHMgPSBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgbWV0YS5zZXRTZXF1ZW5jZVBsdWdpbihDb25m\naWd1cmF0aW9ucy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJvcHMpKTsKICAgICAg\nICBtZXRhLnNldFNlcXVlbmNlKHNlcSk7CiAgICAgICAgbWV0YS5zZXRJbml0\naWFsVmFsdWUoaW5pdGlhbCk7CiAgICAgICAgbWV0YS5zZXRBbGxvY2F0ZShh\nbGxvY2F0ZSk7CiAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNlRmls\nZSgpLCAoZWwgaW5zdGFuY2VvZiBDbGFzcykgPyBlbCA6IG51bGwsCiAgICAg\nICAgICAgIG1ldGEuU1JDX0FOTk9UQVRJT05TKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIEBOYW1lZFF1ZXJ5LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VOYW1lZFF1ZXJpZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwg\nTmFtZWRRdWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0\nYSBtZXRhOwogICAgICAgIGZvciAoTmFtZWRRdWVyeSBxdWVyeSA6IHF1ZXJp\nZXMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVl\ncnkubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tcXVlcnktbmFtZSIsIGVsKSk7CiAg\nICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAg\nICAgICAgIHF1ZXJ5Lm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJwYXJzZS1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSkpOwoK\nICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRR\ndWVyeU1ldGFEYXRhKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAg\nIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9n\nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImR1cC1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSwgZWwpKTsK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRh\nKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0UXVl\ncnlTdHJpbmcocXVlcnkucXVlcnkoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0\nTGFuZ3VhZ2UoSlBRTFBhcnNlci5MQU5HX0pQUUwpOwogICAgICAgICAgICBm\nb3IgKFF1ZXJ5SGludCBoaW50IDogcXVlcnkuaGludHMoKSkKICAgICAgICAg\nICAgICAgIG1ldGEuYWRkSGludChoaW50Lm5hbWUoKSwgaGludC52YWx1ZSgp\nKTsKCiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUo\nKSwgKGVsIGluc3RhbmNlb2YgQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAg\nICAgICAgICAgbWV0YS5TUkNfQU5OT1RBVElPTlMpOwogICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0\nU291cmNlTW9kZShNT0RFX01FVEEpOwogICAgICAgICAgICBlbHNlIGlmIChp\nc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJj\nZU1vZGUoTU9ERV9NQVBQSU5HKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfUVVFUlkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBOYW1lZE5hdGl2\nZVF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VOYW1lZE5h\ndGl2ZVF1ZXJpZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwKICAgICAgICBOYW1l\nZE5hdGl2ZVF1ZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFE\nYXRhIG1ldGE7CiAgICAgICAgZm9yIChOYW1lZE5hdGl2ZVF1ZXJ5IHF1ZXJ5\nIDogcXVlcmllcykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShxdWVyeS5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnkt\nbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZWwpKTsKICAgICAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLW5hdGl2ZS1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAgICAg\nICAgIHF1ZXJ5Lm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJwYXJzZS1uYXRpdmUtcXVlcnkiLCBxdWVyeS5uYW1lKCkp\nKTsKCiAgICAgICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2Fj\naGVkUXVlcnlNZXRhRGF0YShudWxsLCBxdWVyeS5uYW1lKCkpOwogICAgICAg\nICAgICBpZiAobWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkdXAtcXVlcnkiLCBxdWVyeS5uYW1lKCksIGVs\nKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRh\nRGF0YShudWxsLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNl\ndFF1ZXJ5U3RyaW5nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRh\nLnNldExhbmd1YWdlKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMKTsKICAgICAg\nICAgICAgQ2xhc3MgcmVzID0gcXVlcnkucmVzdWx0Q2xhc3MoKTsKICAgICAg\nICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRDb25maWd1\ncmF0aW9uKCksIHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldENhbmRp\nZGF0ZVR5cGUocmVzKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXZvaWQuY2xh\nc3MuZXF1YWxzKHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldFJlc3Vs\ndFR5cGUocmVzKTsKCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShxdWVyeS5yZXN1bHRTZXRNYXBwaW5nKCkpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRSZXN1bHRTZXRNYXBwaW5nTmFtZShxdWVyeS5yZXN1bHRT\nZXRNYXBwaW5nKCkpOwoKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0\nU291cmNlRmlsZSgpLCAoZWwgaW5zdGFuY2VvZiBDbGFzcykgPyBlbCA6IG51\nbGwsCiAgICAgICAgICAgICAgICBtZXRhLlNSQ19BTk5PVEFUSU9OUyk7CiAg\nICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUVUQSk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgIG1l\ndGEuc2V0U291cmNlTW9kZShNT0RFX01BUFBJTkcpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9R\nVUVSWSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIE1ldGhvZEtleSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWV0aG9k\nIF9tZXRob2Q7CgogICAgICAgIHB1YmxpYyBNZXRob2RLZXkoTWV0aG9kIG0p\nIHsKICAgICAgICAgICAgX21ldGhvZCA9IG07CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQgY29k\nZSA9IDQ2ICogMTIgKyBfbWV0aG9kLmdldE5hbWUoKS5oYXNoQ29kZSgpOwog\nICAgICAgICAgICBmb3IgKENsYXNzIHBhcmFtIDogX21ldGhvZC5nZXRQYXJh\nbWV0ZXJUeXBlcygpKQogICAgICAgICAgICAgICAgY29kZSA9IDQ2ICogY29k\nZSArIHBhcmFtLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBjb2Rl\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9i\namVjdCBvKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNZXRo\nb2RLZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBNZXRob2Qgb3RoZXIgPSAoKE1ldGhvZEtleSkgbykuX21ldGhvZDsK\nICAgICAgICAgICAgaWYgKCFfbWV0aG9kLmdldE5hbWUoKS5lcXVhbHMob3Ro\nZXIuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5lcXVhbHMoX21ldGhvZC5nZXRQ\nYXJhbWV0ZXJUeXBlcygpLAogICAgICAgICAgICAgICAgb3RoZXIuZ2V0UGFy\nYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIE1ldGhvZENvbXBhcmF0b3IgaW1wbGVtZW50cyBDb21w\nYXJhdG9yIHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgTWV0aG9kQ29tcGFy\nYXRvciBJTlNUQU5DRSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBzdGF0aWMg\nTWV0aG9kQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsKICAgICAgICAgICAg\naWYgKElOU1RBTkNFID09IG51bGwpCiAgICAgICAgICAgICAgICBJTlNUQU5D\nRSA9IG5ldyBNZXRob2RDb21wYXJhdG9yKCk7CiAgICAgICAgICAgIHJldHVy\nbiBJTlNUQU5DRTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgY29t\ncGFyZShPYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBNZXRo\nb2QgbTEgPSAoTWV0aG9kKSBvMTsKICAgICAgICAgICAgTWV0aG9kIG0yID0g\nKE1ldGhvZCkgbzI7CgogICAgICAgICAgICBDbGFzcyBjMSA9IG0xLmdldERl\nY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgICAgIENsYXNzIGMyID0gbTIuZ2V0\nRGVjbGFyaW5nQ2xhc3MoKTsKICAgICAgICAgICAgaWYgKCFjMS5lcXVhbHMo\nYzIpKSB7CiAgICAgICAgICAgICAgICBpZiAoYzEuaXNBc3NpZ25hYmxlRnJv\nbShjMikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAg\nICAgICAgICAgZWxzZQoJCQkJCXJldHVybiAxOwoJCQl9CgkJCWludCBjb21w\nYXJlID0gbTEuZ2V0TmFtZSAoKS5jb21wYXJlVG8gKG0yLmdldE5hbWUgKCkp\nOwoJCQlpZiAoY29tcGFyZSA9PSAwKQoJCQkJcmV0dXJuIG0xLmhhc2hDb2Rl\nICgpIC0gbTIuaGFzaENvZGUgKCk7CgkJCXJldHVybiBjb21wYXJlOwoJCX0K\nCX0KfQo=\n","encoding":"base64"}

