{"sha":"9a716d8b6bda96cc44ca21d6caaf0f9f45d4bfdc","node_id":"MDQ6QmxvYjIwNjM2NDo5YTcxNmQ4YjZiZGE5NmNjNDRjYTIxZDZjYWFmMGY5ZjQ1ZDRiZmRj","size":11478,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9a716d8b6bda96cc44ca21d6caaf0f9f45d4bfdc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5JbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Qcm9w\nZXJ0aWVzOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkVudGl0eU1hbmFnZXJGYWN0b3J5OwoKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQXV0b0RldGFjaDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQnJva2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXJGYWN0b3J5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5EZWxlZ2F0aW5nQnJva2Vy\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVs\nZWdhdGluZ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLlByb2R1Y3REZXJpdmF0\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xvc2Vh\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4\nY2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIElt\ncGxlbWVudGF0aW9uIG9mIHtAbGluayBFbnRpdHlNYW5hZ2VyRmFjdG9yeX0g\ndGhhdCBhY3RzIGFzIGEKICogZmFjYWRlIHRvIGEge0BsaW5rIEJyb2tlckZh\nY3Rvcnl9LgogKgogKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBA\nbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRW50aXR5TWFuYWdlckZhY3Rv\ncnlJbXBsCiAgICBpbXBsZW1lbnRzIE9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFj\ndG9yeSwgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5U1BJLAogICAgQ2xv\nc2VhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEVudGl0eU1h\nbmFnZXJGYWN0b3J5SW1wbC5jbGFzcyk7CgogICAgcHJpdmF0ZSBEZWxlZ2F0\naW5nQnJva2VyRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBDb25zdHJ1Y3RvcjxGZXRjaFBsYW4+IF9wbGFuID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFN0b3JlQ2FjaGUgX2NhY2hlID0g\nbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFF1ZXJ5UmVzdWx0Q2FjaGUg\nX3F1ZXJ5Q2FjaGUgPSBudWxsOwoKICAgIC8qKgogICAgICogRGVmYXVsdCBj\nb25zdHJ1Y3RvciBwcm92aWRlZCBmb3IgYXV0by1pbnN0YW50aWF0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgRW50aXR5TWFuYWdlckZhY3RvcnlJbXBsKCkg\newogICAgfQoKICAgIC8qKgogICAgICogU3VwcGx5IGRlbGVnYXRlIG9uIGNv\nbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIEVudGl0eU1hbmFnZXJG\nYWN0b3J5SW1wbChCcm9rZXJGYWN0b3J5IGZhY3RvcnkpIHsKICAgICAgICBz\nZXRCcm9rZXJGYWN0b3J5KGZhY3RvcnkpOwogICAgfQoKICAgIC8qKgogICAg\nICogRGVsZWdhdGUuCiAgICAgKi8KICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5\nIGdldEJyb2tlckZhY3RvcnkoKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5\nLmdldERlbGVnYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0\nZSBtdXN0IGJlIHByb3ZpZGVkIGJlZm9yZSB1c2UuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEJyb2tlckZhY3RvcnkoQnJva2VyRmFjdG9yeSBmYWN0\nb3J5KSB7CiAgICAgICAgX2ZhY3RvcnkgPSBuZXcgRGVsZWdhdGluZ0Jyb2tl\nckZhY3RvcnkoZmFjdG9yeSwKICAgICAgICAgICAgUGVyc2lzdGVuY2VFeGNl\ncHRpb25zLlRSQU5TTEFUT1IpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJl\ndHVybiBfZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICB9CgogICAg\ncHVibGljIFByb3BlcnRpZXMgZ2V0UHJvcGVydGllcygpIHsKICAgICAgICBy\nZXR1cm4gX2ZhY3RvcnkuZ2V0UHJvcGVydGllcygpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgcHV0VXNlck9iamVjdChPYmplY3Qga2V5LCBPYmplY3Qg\ndmFsKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5LnB1dFVzZXJPYmplY3Qo\na2V5LCB2YWwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VXNlck9i\namVjdChPYmplY3Qga2V5KSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5Lmdl\ndFVzZXJPYmplY3Qoa2V5KTsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVDYWNo\nZSBnZXRTdG9yZUNhY2hlKCkgewogICAgICAgIF9mYWN0b3J5LmxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX2NhY2hlID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYg\nPSBfZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgICAg\nICBfY2FjaGUgPSBuZXcgU3RvcmVDYWNoZUltcGwodGhpcywKICAgICAgICAg\nICAgICAgICAgICBjb25mLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgp\nLmdldFN5c3RlbURhdGFDYWNoZSgpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gX2NhY2hlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9mYWN0b3J5LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgU3RvcmVDYWNoZSBnZXRTdG9yZUNhY2hlKFN0cmluZyBjYWNo\nZU5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFN0b3JlQ2FjaGVJbXBsKHRo\naXMsIF9mYWN0b3J5LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAg\nZ2V0RGF0YUNhY2hlTWFuYWdlckluc3RhbmNlKCkuZ2V0RGF0YUNhY2hlKGNh\nY2hlTmFtZSkpOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeVJlc3VsdENhY2hl\nIGdldFF1ZXJ5UmVzdWx0Q2FjaGUoKSB7CiAgICAgICAgX2ZhY3RvcnkubG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfcXVlcnlDYWNo\nZSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3F1ZXJ5Q2FjaGUgPSBuZXcg\nUXVlcnlSZXN1bHRDYWNoZUltcGwoX2ZhY3RvcnkuCiAgICAgICAgICAgICAg\nICAgICAgZ2V0Q29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1hbmFnZXJJ\nbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgIGdldFN5c3RlbVF1ZXJ5\nQ2FjaGUoKSk7CiAgICAgICAgICAgIHJldHVybiBfcXVlcnlDYWNoZTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmFjdG9yeS51bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyU1BJIGNyZWF0ZUVudGl0eU1hbmFnZXIoKSB7CiAgICAgICAgcmV0\ndXJuIGNyZWF0ZUVudGl0eU1hbmFnZXIobnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIE9wZW5KUEFFbnRpdHlNYW5hZ2VyU1BJIGNyZWF0ZUVudGl0eU1hbmFn\nZXIoTWFwIHByb3BzKSB7CiAgICAgICAgaWYgKHByb3BzID09IG51bGwpCiAg\nICAgICAgICAgIHByb3BzID0gQ29sbGVjdGlvbnMuRU1QVFlfTUFQOwogICAg\nICAgIGVsc2UgaWYgKCFwcm9wcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHBy\nb3BzID0gbmV3IEhhc2hNYXAocHJvcHMpOwoKICAgICAgICBPcGVuSlBBQ29u\nZmlndXJhdGlvbiBjb25mID0gZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAg\nIFN0cmluZyB1c2VyID0gKFN0cmluZykgQ29uZmlndXJhdGlvbnMucmVtb3Zl\nUHJvcGVydHkKICAgICAgICAgICAgKCJDb25uZWN0aW9uVXNlck5hbWUiLCBw\ncm9wcyk7CiAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCkKICAgICAgICAgICAg\ndXNlciA9IGNvbmYuZ2V0Q29ubmVjdGlvblVzZXJOYW1lKCk7CiAgICAgICAg\nU3RyaW5nIHBhc3MgPSAoU3RyaW5nKSBDb25maWd1cmF0aW9ucy5yZW1vdmVQ\ncm9wZXJ0eQogICAgICAgICAgICAoIkNvbm5lY3Rpb25QYXNzd29yZCIsIHBy\nb3BzKTsKICAgICAgICBpZiAocGFzcyA9PSBudWxsKQogICAgICAgICAgICBw\nYXNzID0gY29uZi5nZXRDb25uZWN0aW9uUGFzc3dvcmQoKTsKCiAgICAgICAg\nU3RyaW5nIHN0ciA9IChTdHJpbmcpIENvbmZpZ3VyYXRpb25zLnJlbW92ZVBy\nb3BlcnR5CiAgICAgICAgICAgICgiVHJhbnNhY3Rpb25Nb2RlIiwgcHJvcHMp\nOwogICAgICAgIGJvb2xlYW4gbWFuYWdlZDsKICAgICAgICBpZiAoc3RyID09\nIG51bGwpCiAgICAgICAgICAgIG1hbmFnZWQgPSBjb25mLmlzVHJhbnNhY3Rp\nb25Nb2RlTWFuYWdlZCgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBW\nYWx1ZSB2YWwgPSBjb25mLmdldFZhbHVlKCJUcmFuc2FjdGlvbk1vZGUiKTsK\nICAgICAgICAgICAgbWFuYWdlZCA9IEJvb2xlYW4ucGFyc2VCb29sZWFuKHZh\nbC51bmFsaWFzKHN0cikpOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG9i\naiA9IENvbmZpZ3VyYXRpb25zLnJlbW92ZVByb3BlcnR5KCJDb25uZWN0aW9u\nUmV0YWluTW9kZSIsIAogICAgICAgICAgICBwcm9wcyk7CiAgICAgICAgaW50\nIHJldGFpbk1vZGU7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE51bWJl\ncikKICAgICAgICAgICAgcmV0YWluTW9kZSA9ICgoTnVtYmVyKSBvYmopLmlu\ndFZhbHVlKCk7CiAgICAgICAgZWxzZSBpZiAob2JqID09IG51bGwpCiAgICAg\nICAgICAgIHJldGFpbk1vZGUgPSBjb25mLmdldENvbm5lY3Rpb25SZXRhaW5N\nb2RlQ29uc3RhbnQoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgVmFs\ndWUgdmFsID0gY29uZi5nZXRWYWx1ZSgiQ29ubmVjdGlvblJldGFpbk1vZGUi\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldGFpbk1v\nZGUgPSBJbnRlZ2VyLnBhcnNlSW50KHZhbC51bmFsaWFzKChTdHJpbmcpIG9i\naikpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZW0tcHJvcCIsCiAgICAgICAgICAgICAgICAgICAgIm9wZW5q\ncGEuQ29ubmVjdGlvblJldGFpbk1vZGUiLCBvYmopLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBUaHJvd2FibGVbXXsgZSB9LCBvYmosIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBCcm9rZXIgYnJva2VyID0g\nX2ZhY3RvcnkubmV3QnJva2VyKHVzZXIsIHBhc3MsIG1hbmFnZWQsIHJldGFp\nbk1vZGUsCiAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgCiAgICAg\nICAgLy8gYWRkIGF1dG9kZXRhY2ggZm9yIGNsb3NlIGFuZCByb2xsYmFjayBj\nb25kaXRpb25zIHRvIHRoZSBjb25maWd1cmF0aW9uCiAgICAgICAgYnJva2Vy\nLnNldEF1dG9EZXRhY2goQXV0b0RldGFjaC5ERVRBQ0hfQ0xPU0UsIHRydWUp\nOwogICAgICAgIGJyb2tlci5zZXRBdXRvRGV0YWNoKEF1dG9EZXRhY2guREVU\nQUNIX1JPTExCQUNLLCB0cnVlKTsKICAgICAgICAKICAgICAgICBicm9rZXIu\nc2V0RGV0YWNoZWROZXcoZmFsc2UpOwogICAgICAgIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyU1BJIGVtID0gbmV3RW50aXR5TWFuYWdlckltcGwoYnJva2VyKTsK\nCiAgICAgICAgLy8gYWxsb3cgc2V0dGluZyBvZiBvdGhlciBiZWFuIHByb3Bl\ncnRpZXMgb2YgRU0KICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9IFByb2R1\nY3REZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uUHJlZml4ZXMoKTsKICAg\nICAgICBMaXN0PFJ1bnRpbWVFeGNlcHRpb24+IGVycnMgPSBudWxsOwogICAg\nICAgIE1ldGhvZCBzZXR0ZXI7CiAgICAgICAgU3RyaW5nIHByb3AsIHByZWZp\neDsKICAgICAgICBPYmplY3QgdmFsOwogICAgICAgIGZvciAoTWFwLkVudHJ5\nIGVudHJ5IDogKFNldDxNYXAuRW50cnk+KSBwcm9wcy5lbnRyeVNldCgpKSB7\nCiAgICAgICAgICAgIHByb3AgPSAoU3RyaW5nKSBlbnRyeS5nZXRLZXkoKTsK\nICAgICAgICAgICAgcHJlZml4ID0gbnVsbDsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgcHJlZml4ID0gcHJlZml4ZXNbaV0gKyAiLiI7CiAgICAgICAg\nICAgICAgICBpZiAocHJvcC5zdGFydHNXaXRoKHByZWZpeCkpCiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBwcmVmaXggPSBu\ndWxsOyAKICAgICAgICAgICAgfSAKICAgICAgICAgICAgaWYgKHByZWZpeCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7IAogICAgICAgICAg\nICBwcm9wID0gcHJvcC5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCgpKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHNldHRlciA9IFJlZmxl\nY3Rpb24uZmluZFNldHRlcihlbS5nZXRDbGFzcygpLCBwcm9wLCB0cnVlKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICAgICAgaWYgKGVycnMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBlcnJzID0gbmV3IExpbmtlZExpc3Q8UnVudGltZUV4Y2VwdGlv\nbj4oKTsKICAgICAgICAgICAgICAgIGVycnMuYWRkKFBlcnNpc3RlbmNlRXhj\nZXB0aW9ucy50b1BlcnNpc3RlbmNlRXhjZXB0aW9uKGtlKSk7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ndmFsID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoIm51bGwiLmVxdWFscyh2YWwpKQogICAg\nICAgICAgICAgICAgICAgICAgICB2YWwgPSBudWxsOwogICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gU3Ry\naW5ncy5wYXJzZSgoU3RyaW5nKSB2YWwsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBzZXR0ZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKVswXSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBSZWZsZWN0aW9uLnNldChl\nbSwgc2V0dGVyLCB2YWwpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2Fi\nbGUgdCkgewogICAgICAgICAgICAgICAgd2hpbGUgKHQuZ2V0Q2F1c2UoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHQgPSB0LmdldENhdXNlKCk7\nCiAgICAgICAgICAgICAgICBBcmd1bWVudEV4Y2VwdGlvbiBlcnIgPSBuZXcg\nQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAoImJhZC1lbS1wcm9wIiwgcHJvcCwgZW50cnkuZ2V0VmFsdWUoKSksCiAg\nICAgICAgICAgICAgICAgICAgbmV3IFRocm93YWJsZVtdeyB0IH0sIG51bGws\nIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGVycnMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBlcnJzID0gbmV3IExpbmtlZExpc3Q8UnVudGlt\nZUV4Y2VwdGlvbj4oKTsKICAgICAgICAgICAgICAgIGVycnMuYWRkKGVycik7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcnJzICE9\nIG51bGwpIHsKICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAg\naWYgKGVycnMuc2l6ZSgpID09IDEpCiAgICAgICAgICAgICAgICB0aHJvdyBl\ncnJzLmdldCgwKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZW0tcHJvcHMiKSwKICAgICAgICAgICAg\nICAgIGVycnMudG9BcnJheShuZXcgVGhyb3dhYmxlW2VycnMuc2l6ZSgpXSks\nCiAgICAgICAgICAgICAgICBudWxsLCB0cnVlKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGVtOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IGVudGl0eSBtYW5hZ2VyIGFyb3VuZCB0aGUgZ2l2ZW4gYnJva2VyLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgRW50aXR5TWFuYWdlckltcGwgbmV3RW50\naXR5TWFuYWdlckltcGwoQnJva2VyIGJyb2tlcikgewogICAgICAgIHJldHVy\nbiBuZXcgRW50aXR5TWFuYWdlckltcGwodGhpcywgYnJva2VyKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBhZGRMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3Qg\nbGlzdGVuZXIsIENsYXNzLi4uIGNsYXNzZXMpIHsKICAgICAgICBfZmFjdG9y\neS5hZGRMaWZlY3ljbGVMaXN0ZW5lcihsaXN0ZW5lciwgY2xhc3Nlcyk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlTGlmZWN5Y2xlTGlzdGVuZXIo\nT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgX2ZhY3RvcnkucmVtb3ZlTGlm\nZWN5Y2xlTGlzdGVuZXIobGlzdGVuZXIpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGFkZFRyYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7\nCiAgICAgICAgX2ZhY3RvcnkuYWRkVHJhbnNhY3Rpb25MaXN0ZW5lcihsaXN0\nZW5lcik7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlVHJhbnNhY3Rp\nb25MaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAgICBfZmFjdG9y\neS5yZW1vdmVUcmFuc2FjdGlvbkxpc3RlbmVyKGxpc3RlbmVyKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBfZmFjdG9yeS5j\nbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzT3BlbigpIHsK\nICAgICAgICByZXR1cm4gIV9mYWN0b3J5LmlzQ2xvc2VkKCk7CiAgICB9Cgog\nICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gX2Zh\nY3RvcnkuaGFzaENvZGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IHRo\naXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICghKG90\naGVyIGluc3RhbmNlb2YgRW50aXR5TWFuYWdlckZhY3RvcnlJbXBsKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfZmFjdG9y\neS5lcXVhbHMoKChFbnRpdHlNYW5hZ2VyRmFjdG9yeUltcGwpIG90aGVyKS5f\nZmFjdG9yeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBzdG9y\nZS1zcGVjaWZpYyBmYWNhZGUgZm9yIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1\ncmF0aW9uLgoJICogSWYgbm8gZmFjYWRlIGNsYXNzIGV4aXN0cywgd2UgdXNl\nIHRoZSBkZWZhdWx0IHtAbGluayBGZXRjaFBsYW59LgogICAgICovCiAgICBG\nZXRjaFBsYW4gdG9GZXRjaFBsYW4oQnJva2VyIGJyb2tlciwgRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAoZmV0Y2gg\naW5zdGFuY2VvZiBEZWxlZ2F0aW5nRmV0Y2hDb25maWd1cmF0aW9uKQogICAg\nICAgICAgICBmZXRjaCA9ICgoRGVsZWdhdGluZ0ZldGNoQ29uZmlndXJhdGlv\nbikgZmV0Y2gpLgogICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdh\ndGUoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9wbGFuID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIENsYXNzIHN0b3JlVHlwZSA9IChi\ncm9rZXIgPT0gbnVsbCkgPyBudWxsIDogYnJva2VyLgogICAgICAgICAgICAg\nICAgICAgIGdldFN0b3JlTWFuYWdlcigpLmdldElubmVybW9zdERlbGVnYXRl\nKCkuZ2V0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIENsYXNzIGNscyA9IF9m\nYWN0b3J5LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgICAg\nICBnZXRTdG9yZUZhY2FkZVR5cGVSZWdpc3RyeSgpLgogICAgICAgICAgICAg\nICAgICAgIGdldEltcGxlbWVudGF0aW9uKEZldGNoUGxhbi5jbGFzcywgc3Rv\ncmVUeXBlLCAKICAgICAgICAgICAgICAgICAgICAJCUZldGNoUGxhbkltcGwu\nY2xhc3MpOwogICAgICAgICAgICAgICAgX3BsYW4gPSBjbHMuZ2V0Q29uc3Ry\ndWN0b3IoRmV0Y2hDb25maWd1cmF0aW9uLmNsYXNzKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gX3BsYW4ubmV3SW5zdGFuY2UoZmV0Y2gp\nOwogICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24g\naXRlKSB7CiAgICAgICAgICAgIHRocm93IFBlcnNpc3RlbmNlRXhjZXB0aW9u\ncy50b1BlcnNpc3RlbmNlRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoaXRl\nLmdldFRhcmdldEV4Y2VwdGlvbigpKTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBQZXJzaXN0ZW5jZUV4Y2Vw\ndGlvbnMudG9QZXJzaXN0ZW5jZUV4Y2VwdGlvbihlKTsKICAgICAgICB9Cgl9\nCn0K\n","encoding":"base64"}

