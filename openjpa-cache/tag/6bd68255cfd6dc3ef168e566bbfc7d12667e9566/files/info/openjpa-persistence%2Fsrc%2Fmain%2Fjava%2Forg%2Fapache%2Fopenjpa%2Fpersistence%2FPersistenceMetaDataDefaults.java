{"sha":"052ba83b69b9ebadf87ff7dc028092995ccce21c","node_id":"MDQ6QmxvYjIwNjM2NDowNTJiYTgzYjY5YjllYmFkZjg3ZmY3ZGMwMjgwOTI5OTVjY2NlMjFj","size":12174,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/052ba83b69b9ebadf87ff7dc028092995ccce21c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcuYW5u\nb3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZp\nZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWVtYmVyOwppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0Nv\nbnRyb2xsZXI7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0\nIGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5CYXNp\nYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGFibGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRlZDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkVtYmVkZGVkSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFueVRv\nT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5Qb3N0TG9hZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLlBvc3RQZXJzaXN0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFJl\nbW92ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBvc3RVcGRhdGU7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmVQZXJzaXN0OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuUHJlUmVtb3ZlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuUHJlVXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVHJh\nbnNpZW50OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoy\nRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFic3Ry\nYWN0TWV0YURhdGFEZWZhdWx0czsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lzdGVuY2VTdHJhdGVneS4qOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29u\nZmlndXJhdGlvbjsKCi8qKgogKiBKUEEtYmFzZWQgbWV0YWRhdGEgZGVmYXVs\ndHMuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBQZXJz\naXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMKICAgIGV4dGVuZHMgQWJzdHJhY3RN\nZXRhRGF0YURlZmF1bHRzIHsKCiAgICBwcml2YXRlIGJvb2xlYW4gX2FsbG93\nc011bHRpcGxlTWV0aG9kc0ZvclNhbWVDYWxsYmFjayA9IGZhbHNlOwoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UKICAgICAgICAoUGVyc2lzdGVuY2VNZXRhRGF0YURl\nZmF1bHRzLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBNYXA8\nQ2xhc3MsIFBlcnNpc3RlbmNlU3RyYXRlZ3k+IF9zdHJhdHMgPQogICAgICAg\nIG5ldyBIYXNoTWFwPENsYXNzLCBQZXJzaXN0ZW5jZVN0cmF0ZWd5PigpOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU2V0PFN0cmluZz4gX2lnbm9yZWRB\nbm5vcyA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKCiAgICBzdGF0aWMgewog\nICAgICAgIF9zdHJhdHMucHV0KEJhc2ljLmNsYXNzLCBCQVNJQyk7CiAgICAg\nICAgX3N0cmF0cy5wdXQoTWFueVRvT25lLmNsYXNzLCBNQU5ZX09ORSk7CiAg\nICAgICAgX3N0cmF0cy5wdXQoT25lVG9PbmUuY2xhc3MsIE9ORV9PTkUpOwog\nICAgICAgIF9zdHJhdHMucHV0KEVtYmVkZGVkLmNsYXNzLCBFTUJFRERFRCk7\nCiAgICAgICAgX3N0cmF0cy5wdXQoRW1iZWRkZWRJZC5jbGFzcywgRU1CRURE\nRUQpOwogICAgICAgIF9zdHJhdHMucHV0KE9uZVRvTWFueS5jbGFzcywgT05F\nX01BTlkpOwogICAgICAgIF9zdHJhdHMucHV0KE1hbnlUb01hbnkuY2xhc3Ms\nIE1BTllfTUFOWSk7CiAgICAgICAgX3N0cmF0cy5wdXQoUGVyc2lzdGVudC5j\nbGFzcywgUEVSUyk7CiAgICAgICAgX3N0cmF0cy5wdXQoUGVyc2lzdGVudENv\nbGxlY3Rpb24uY2xhc3MsIFBFUlNfQ09MTCk7CiAgICAgICAgX3N0cmF0cy5w\ndXQoUGVyc2lzdGVudE1hcC5jbGFzcywgUEVSU19NQVApOwoKICAgICAgICBf\naWdub3JlZEFubm9zLmFkZChEZXRhY2hlZFN0YXRlLmNsYXNzLmdldE5hbWUo\nKSk7CiAgICAgICAgX2lnbm9yZWRBbm5vcy5hZGQoUG9zdExvYWQuY2xhc3Mu\nZ2V0TmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9zLmFkZChQb3N0UGVy\nc2lzdC5jbGFzcy5nZXROYW1lKCkpOwogICAgICAgIF9pZ25vcmVkQW5ub3Mu\nYWRkKFBvc3RSZW1vdmUuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBfaWdu\nb3JlZEFubm9zLmFkZChQb3N0VXBkYXRlLmNsYXNzLmdldE5hbWUoKSk7CiAg\nICAgICAgX2lnbm9yZWRBbm5vcy5hZGQoUHJlUGVyc2lzdC5jbGFzcy5nZXRO\nYW1lKCkpOwogICAgICAgIF9pZ25vcmVkQW5ub3MuYWRkKFByZVJlbW92ZS5j\nbGFzcy5nZXROYW1lKCkpOwogICAgICAgIF9pZ25vcmVkQW5ub3MuYWRkKFBy\nZVVwZGF0ZS5jbGFzcy5nZXROYW1lKCkpOwogICAgfQoKICAgIHB1YmxpYyBQ\nZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMoKSB7CiAgICAgICAgc2V0Q2Fs\nbGJhY2tNb2RlKENBTExCQUNLX1JFVEhST1cgfCBDQUxMQkFDS19ST0xMQkFD\nSyB8CiAgICAgICAgICAgIENBTExCQUNLX0ZBSUxfRkFTVCk7CiAgICAgICAg\nc2V0RGF0YVN0b3JlT2JqZWN0SWRGaWVsZFVud3JhcHBlZCh0cnVlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29kZSBmb3IgdGhlIHN0\ncmF0ZWd5IG9mIHRoZSBnaXZlbiBtZW1iZXIuIFJldHVybiBudWxsIGlmCiAg\nICAgKiBubyBzdHJhdGVneS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBQ\nZXJzaXN0ZW5jZVN0cmF0ZWd5IGdldFBlcnNpc3RlbmNlU3RyYXRlZ3kKICAg\nICAgICAoRmllbGRNZXRhRGF0YSBmbWQsIE1lbWJlciBtZW1iZXIpIHsKICAg\nICAgICBpZiAobWVtYmVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIEFubm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVk\nRWxlbWVudCkgbWVtYmVyOwogICAgICAgIGlmIChlbC5pc0Fubm90YXRpb25Q\ncmVzZW50KFRyYW5zaWVudC5jbGFzcykpCiAgICAgICAgICAgIHJldHVybiBU\nUkFOU0lFTlQ7CiAgICAgICAgaWYgKGZtZCAhPSBudWxsCiAgICAgICAgICAg\nICYmIGZtZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5B\nR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIC8vIGxvb2sgZm9yIHBlcnNpc3RlbmNlIHN0cmF0ZWd5IGluIGFubm90\nYXRpb24gdGFibGUKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHBzdHJh\ndCA9IG51bGw7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBlbC5n\nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgaWYgKHBz\ndHJhdCAhPSBudWxsICYmIF9zdHJhdHMuY29udGFpbnNLZXkoYW5uby5hbm5v\ndGF0aW9uVHlwZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYWxyZWFkeS1wZXJzIiwgbWVtYmVy\nKSk7CiAgICAgICAgICAgIGlmIChwc3RyYXQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHBzdHJhdCA9IF9zdHJhdHMuZ2V0KGFubm8uYW5ub3RhdGlvblR5\ncGUoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChwc3RyYXQgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHBzdHJhdDsKCiAgICAgICAgQ2xhc3MgdHlw\nZTsKICAgICAgICBpbnQgY29kZTsKICAgICAgICBpZiAoZm1kICE9IG51bGwp\nIHsKICAgICAgICAgICAgdHlwZSA9IGZtZC5nZXRUeXBlKCk7CiAgICAgICAg\nICAgIGNvZGUgPSBmbWQuZ2V0VHlwZUNvZGUoKTsKICAgICAgICB9IGVsc2Ug\naWYgKG1lbWJlciBpbnN0YW5jZW9mIEZpZWxkKSB7CiAgICAgICAgICAgIHR5\ncGUgPSAoKEZpZWxkKSBtZW1iZXIpLmdldFR5cGUoKTsKICAgICAgICAgICAg\nY29kZSA9IEphdmFUeXBlcy5nZXRUeXBlQ29kZSh0eXBlKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICB0eXBlID0gKChNZXRob2QpIG1lbWJlciku\nZ2V0UmV0dXJuVHlwZSgpOwogICAgICAgICAgICBjb2RlID0gSmF2YVR5cGVz\nLmdldFR5cGVDb2RlKHR5cGUpOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNo\nIChjb2RlKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gYnl0ZVtdLmNsYXNzCiAgICAg\nICAgICAgICAgICAgICAgfHwgdHlwZSA9PSBjaGFyW10uY2xhc3MKICAgICAg\nICAgICAgICAgICAgICB8fCB0eXBlID09IEJ5dGVbXS5jbGFzcwogICAgICAg\nICAgICAgICAgICAgIHx8IHR5cGUgPT0gQ2hhcmFjdGVyW10uY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIEJBU0lDOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5MT05HX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIEJBU0lDOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBp\nZiAoRW51bS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBCQVNJQzsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgIH0KCiAgICAgICAgLy8jIyMgRUpCMzogd2hhdCBpZiBk\nZWZpbmVkIGluIFhNTD8KICAgICAgICBpZiAodHlwZS5pc0Fubm90YXRpb25Q\ncmVzZW50KEVtYmVkZGFibGUuY2xhc3MpKQogICAgICAgICAgICByZXR1cm4g\nRU1CRURERUQ7CiAgICAgICAgaWYgKFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICByZXR1cm4gQkFTSUM7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAKICAgIC8qKiAKICAg\nICAqIEZsYWdzIGlmIG11bHRpcGxlIG1ldGhvZHMgb2YgdGhlIHNhbWUgY2xh\nc3MgY2FuIGhhbmRsZSB0aGUgc2FtZSAKICAgICAqIGNhbGxiYWNrIGV2ZW50\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBbGxvd3NNdWx0aXBs\nZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2soKSB7CiAgICAgICAgcmV0dXJuIF9h\nbGxvd3NNdWx0aXBsZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2s7CiAgICB9CiAg\nICAKICAgIC8qKiAKICAgICAqIEZsYWdzIGlmIG11bHRpcGxlIG1ldGhvZHMg\nb2YgdGhlIHNhbWUgY2xhc3MgY2FuIGhhbmRsZSB0aGUgc2FtZSAKICAgICAq\nIGNhbGxiYWNrIGV2ZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRB\nbGxvd3NNdWx0aXBsZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2soYm9vbGVhbiBm\nbGFnKSB7CiAgICAgICAgX2FsbG93c011bHRpcGxlTWV0aG9kc0ZvclNhbWVD\nYWxsYmFjayA9IGZsYWc7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdXRvLWNv\nbmZpZ3VyYXRpb24gbWV0aG9kIGZvciB0aGUgZGVmYXVsdCBhY2Nlc3MgdHlw\nZSBvZiBiYXNlIGNsYXNzZXMgCiAgICAgKiB3aXRoIEFDQ0VTU19VTktOT1dO\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRBY2Nlc3NUeXBl\nKFN0cmluZyB0eXBlKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICgiUFJPUEVSVFkiLmVxdWFs\ncyh0eXBlLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICBzZXREZWZhdWx0\nQWNjZXNzVHlwZShDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzZXREZWZhdWx0QWNjZXNzVHlwZShD\nbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShDbGFzc01ldGFEYXRhIG1l\ndGEsIGludCBhY2Nlc3MpIHsKICAgICAgICBzdXBlci5wb3B1bGF0ZShtZXRh\nLCBhY2Nlc3MpOwogICAgICAgIG1ldGEuc2V0RGV0YWNoYWJsZSh0cnVlKTsK\nICAgICAgICAvLyBkbyBub3QgY2FsbCBnZXQqRmllbGRzIGFzIGl0IHdpbGwg\nbG9jayBkb3duIHRoZSBmaWVsZHMuCiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgdm9pZCBwb3B1bGF0ZShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIHNldENhc2NhZGVOb25lKGZtZCk7CiAgICAgICAgc2V0Q2Fz\nY2FkZU5vbmUoZm1kLmdldEtleSgpKTsKICAgICAgICBzZXRDYXNjYWRlTm9u\nZShmbWQuZ2V0RWxlbWVudCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFR1\ncm5zIG9mZiBhdXRvIGNhc2NhZGluZyBvZiBwZXJzaXN0LCByZWZyZXNoLCBh\ndHRhY2guCiAgICAgKi8KICAgIHN0YXRpYyB2b2lkIHNldENhc2NhZGVOb25l\nKFZhbHVlTWV0YURhdGEgdm1kKSB7CiAgICAgICAgdm1kLnNldENhc2NhZGVQ\nZXJzaXN0KFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKTsKICAgICAgICB2\nbWQuc2V0Q2FzY2FkZVJlZnJlc2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX05P\nTkUpOwogICAgICAgIHZtZC5zZXRDYXNjYWRlQXR0YWNoKFZhbHVlTWV0YURh\ndGEuQ0FTQ0FERV9OT05FKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCBpbnQgZ2V0QWNjZXNzVHlwZShDbGFzc01ldGFEYXRhIG1ldGEp\nIHsKICAgICAgICByZXR1cm4gZ2V0QWNjZXNzVHlwZShtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUg\naGVscGVyIHRvIGRldGVybWluZSBhY2Nlc3MgdHlwZSBiYXNlZCBvbiBhbm5v\ndGF0aW9uIHBsYWNlbWVudC4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0\nQWNjZXNzVHlwZShDbGFzcyBjbHMpIHsKICAgICAgICAvLyB0cmF2ZXJzZWQg\nZW50aXJlIGhpZXJhcmNoeSB3aXRob3V0IGZpbmRpbmcgYW5ub3RhdGlvbnMK\nICAgICAgICBpZiAoY2xzID09IG51bGwgfHwgY2xzID09IE9iamVjdC5jbGFz\ncykKICAgICAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEuQUNDRVNTX1VO\nS05PV047CgogICAgICAgIGludCBhY2Nlc3MgPSAwOwogICAgICAgIGlmICh1\nc2VzQWNjZXNzKChGaWVsZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRG\naWVsZHNBY3Rpb24oY2xzKSkpKQogICAgICAgICAgICBhY2Nlc3MgfD0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQ7CiAgICAgICAgaWYgKHVzZXNBY2Nl\nc3MoKE1ldGhvZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2Rz\nQWN0aW9uKGNscykpKSkKICAgICAgICAgICAgYWNjZXNzIHw9IENsYXNzTWV0\nYURhdGEuQUNDRVNTX1BST1BFUlRZOwogICAgICAgIHJldHVybiAoYWNjZXNz\nID09IDApID8gZ2V0QWNjZXNzVHlwZShjbHMuZ2V0U3VwZXJjbGFzcygpKSA6\nIGFjY2VzczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBtZW1iZXJzIGhhdmUgcGVyc2lzdGVuY2UgYW5ub3RhdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gdXNlc0Fj\nY2VzcyhBbm5vdGF0ZWRFbGVtZW50W10gbWVtYmVycykgewogICAgICAgIEFu\nbm90YXRpb25bXSBhbm5vczsKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG1lbWJlcnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgYW5ub3MgPSBtZW1iZXJzW2ldLmdldEFubm90YXRpb25z\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgYW5ub3MubGVu\nZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBhbm5vc1tqXS5h\nbm5vdGF0aW9uVHlwZSgpLmdldE5hbWUoKTsKICAgICAgICAgICAgICAgIGlm\nICgobmFtZS5zdGFydHNXaXRoKCJqYXZheC5wZXJzaXN0ZW5jZS4iKQogICAg\nICAgICAgICAgICAgICAgIHx8IG5hbWUuc3RhcnRzV2l0aCgib3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLiIpKQogICAgICAgICAgICAgICAgICAg\nICYmICFfaWdub3JlZEFubm9zLmNvbnRhaW5zKG5hbWUpKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpc0RlZmF1bHRQZXJzaXN0ZW50KENsYXNzTWV0YURhdGEgbWV0\nYSwgTWVtYmVyIG1lbWJlciwKICAgICAgICBTdHJpbmcgbmFtZSkgewogICAg\nICAgIGludCBtb2RzID0gbWVtYmVyLmdldE1vZGlmaWVycygpOwogICAgICAg\nIGlmIChNb2RpZmllci5pc1RyYW5zaWVudChtb2RzKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAobWVtYmVyIGluc3RhbmNlb2Yg\nTWV0aG9kKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAv\nLyBjaGVjayBmb3Igc2V0dGVycyBmb3IgbWV0aG9kcwogICAgICAgICAgICAg\nICAgTWV0aG9kIHNldHRlciA9IChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgInNldCIgKwogICAg\nICAgICAgICAgICAgICAgICAgICBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG5h\nbWUpLCBuZXcgQ2xhc3NbXSB7IAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKChNZXRob2QpIG1lbWJlcikuZ2V0UmV0dXJuVHlwZSgpIH0pKTsKICAg\nICAgICAgICAgICAgIGlmIChzZXR0ZXIgPT0gbnVsbCAmJiAhaXNBbm5vdGF0\nZWRUcmFuc2llbnQobWVtYmVyKSkgewogICAgICAgICAgICAgICAgICAgIGxv\nZ05vU2V0dGVyKG1ldGEsIG5hbWUsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIGUuZy4sIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICAgICAgICAgICAg\naWYgKCFpc0Fubm90YXRlZFRyYW5zaWVudChtZW1iZXIpKQogICAgICAgICAg\nICAgICAgICAgIGxvZ05vU2V0dGVyKG1ldGEsIG5hbWUsIGUpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0ID0gZ2V0UGVy\nc2lzdGVuY2VTdHJhdGVneShudWxsLCBtZW1iZXIpOwogICAgICAgIGlmIChz\ndHJhdCA9PSBudWxsIHx8IHN0cmF0ID09IFBlcnNpc3RlbmNlU3RyYXRlZ3ku\nVFJBTlNJRU5UKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\ncmV0dXJuIHRydWU7Cgl9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzQW5ub3Rh\ndGVkVHJhbnNpZW50KE1lbWJlciBtZW1iZXIpIHsKICAgICAgICByZXR1cm4g\nbWVtYmVyIGluc3RhbmNlb2YgQW5ub3RhdGVkRWxlbWVudAogICAgICAgICAg\nICAmJiAoKEFubm90YXRlZEVsZW1lbnQpIG1lbWJlcikuaXNBbm5vdGF0aW9u\nUHJlc2VudChUcmFuc2llbnQuY2xhc3MpOwogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBsb2dOb1NldHRlcihDbGFzc01ldGFEYXRhIG1ldGEsIFN0cmluZyBu\nYW1lLCBFeGNlcHRpb24gZSkgewogICAgICAgIExvZyBsb2cgPSBtZXRhLmdl\ndFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAg\nLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfTUVUQURBVEEpOwog\nICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgibm8tc2V0dGVyLWZvci1nZXR0ZXIiLCBuYW1l\nLAogICAgICAgICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0\nTmFtZSgpKSk7CiAgICAgICAgZWxzZSBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgIC8vIGxvZyB0aGUgZXhjZXB0aW9uLCBpZiBhbnks\nIGlmIHdlJ3JlIGluIHRyYWNlLWxldmVsIGRlYnVnZ2luZwogICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgibm8tc2V0dGVyLWZvci1nZXR0ZXIiLCBu\nYW1lLAogICAgICAgICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCku\nZ2V0TmFtZSgpKSwgZSk7CiAgICB9Cn0K\n","encoding":"base64"}

