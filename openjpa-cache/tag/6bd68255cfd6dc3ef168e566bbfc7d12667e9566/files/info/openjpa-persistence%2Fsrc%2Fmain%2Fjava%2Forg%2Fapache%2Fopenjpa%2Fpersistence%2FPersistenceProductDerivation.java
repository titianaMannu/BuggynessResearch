{"sha":"630162b7e86ff7e53e83a352fb0e3ea9f08b4e84","node_id":"MDQ6QmxvYjIwNjM2NDo2MzAxNjJiN2U4NmZmN2U1M2U4M2EzNTJmYjBlM2VhOWYwOGI0ZTg0","size":20360,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/630162b7e86ff7e53e83a352fb0e3ea9f08b4e84","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNj\nZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdl\nZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0\naWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuTWlzc2luZ1Jlc291\ncmNlRXhjZXB0aW9uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uuc3BpLlBl\ncnNpc3RlbmNlVW5pdEluZm87CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5z\ncGkuUGVyc2lzdGVuY2VVbml0VHJhbnNhY3Rpb25UeXBlOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJh\ndGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBUHJvZHVjdERlcml2YXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmNvbmYuQWJzdHJhY3RQcm9kdWN0RGVyaXZhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRp\nb25Qcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29u\nZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuY29uZi5NYXBDb25maWd1cmF0aW9uUHJvdmlkZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuUHJvZHVjdERlcml2YXRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlhNTE1ldGFEYXRhUGFyc2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy54bWwuc2F4LkF0dHJpYnV0ZXM7CmltcG9y\ndCBvcmcueG1sLnNheC5TQVhFeGNlcHRpb247CgovKioKICogU2V0cyBKUEEg\nc3BlY2lmaWNhdGlvbiBkZWZhdWx0cyBhbmQgcGFyc2VzIEpQQSBzcGVjaWZp\nY2F0aW9uIFhNTCBmaWxlcy4KICogCiAqIEZvciBnbG9iYWxzLCBsb29rcyBp\nbiA8Y29kZT5vcGVuanBhLnByb3BlcnRpZXM8L2NvZGU+IHN5c3RlbSBwcm9w\nZXJ0eSBmb3IKICogdGhlIGxvY2F0aW9uIG9mIGEgZmlsZSB0byBwYXJzZS4g\nSWYgbm8gc3lzdGVtIHByb3BlcnR5IGlzIGRlZmluZWQsIHRoZQogKiBkZWZh\ndWx0IHJlc291cmNlIGxvY2F0aW9uIG9mIDxjb2RlPk1FVEEtSU5GL29wZW5q\ncGEueG1sPC9jb2RlPiBpcyB1c2VkLgogKgogKiBGb3IgZGVmYXVsdHMsIGxv\nb2tzIGZvciA8Y29kZT5NRVRBLUlORi9wZXJzaXN0ZW5jZS54bWw8L2NvZGU+\nLgogKiBXaXRoaW4gPGNvZGU+cGVyc2lzdGVuY2UueG1sPC9jb2RlPiwgbG9v\nayBmb3IgdGhlIG5hbWVkIHBlcnNpc3RlbmNlIHVuaXQsIG9yCiAqIGlmIG5v\nIG5hbWUgZ2l2ZW4sIGFuIE9wZW5KUEEgdW5pdCAocHJlZmVycmluZyBhbiB1\nbm5hbWVkIE9wZW5KUEEgdW5pdCB0byAKICogYSBuYW1lZCBvbmUpLgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMg\nY2xhc3MgUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbiAKICAgIGV4dGVu\nZHMgQWJzdHJhY3RQcm9kdWN0RGVyaXZhdGlvbgogICAgaW1wbGVtZW50cyBP\ncGVuSlBBUHJvZHVjdERlcml2YXRpb24gewoKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgU3RyaW5nIFNQRUNfSlBBID0gImpwYSI7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIFN0cmluZyBBTElBU19FSkIgPSAiZWpiIjsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgU3RyaW5nIFJTUkNfR0xPQkFMID0gIk1FVEEtSU5G\nL29wZW5qcGEueG1sIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5n\nIFJTUkNfREVGQVVMVCA9ICJNRVRBLUlORi9wZXJzaXN0ZW5jZS54bWwiOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9j\nYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoUGVyc2lzdGVuY2VQcm9kdWN0\nRGVyaXZhdGlvbi5jbGFzcyk7CgogICAgcHVibGljIHZvaWQgcHV0QnJva2Vy\nRmFjdG9yeUFsaWFzZXMoTWFwIG0pIHsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIGdldFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIFRZUEVfU1BFQzsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHZhbGlkYXRlKCkKICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBtYWtlIHN1cmUg\nSlBBIGlzIGF2YWlsYWJsZQogICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9u\nKAogICAgICAgICAgICBqYXZheC5wZXJzaXN0ZW5jZS5FbnRpdHlNYW5hZ2Vy\nRmFjdG9yeS5jbGFzcykpOwogICAgfQogICAgCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBib29sZWFuIGJlZm9yZUNvbmZpZ3VyYXRpb25Mb2FkKENvbmZp\nZ3VyYXRpb24gYykgewogICAgICAgIGlmICghKGMgaW5zdGFuY2VvZiBPcGVu\nSlBBQ29uZmlndXJhdGlvbkltcGwpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgCiAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBs\nIGNvbmYgPSAoT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsKSBjOwogICAgICAg\nIGNvbmYubWV0YUZhY3RvcnlQbHVnaW4uc2V0QWxpYXMoQUxJQVNfRUpCLAog\nICAgICAgICAgICBQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeS5jbGFzcy5n\nZXROYW1lKCkpOwogICAgICAgIGNvbmYubWV0YUZhY3RvcnlQbHVnaW4uc2V0\nQWxpYXMoU1BFQ19KUEEsCiAgICAgICAgICAgIFBlcnNpc3RlbmNlTWV0YURh\ndGFGYWN0b3J5LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgCiAgICAgICAg\nY29uZi5hZGRWYWx1ZShuZXcgRW50aXR5TWFuYWdlckZhY3RvcnlWYWx1ZSgp\nKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyBib29sZWFuIGFmdGVyU3BlY2lmaWNhdGlvblNldChDb25m\naWd1cmF0aW9uIGMpIHsKICAgICAgaWYgKCEoYyBpbnN0YW5jZW9mIE9wZW5K\nUEFDb25maWd1cmF0aW9uSW1wbCkKICAgICAgICAgfHwgIVNQRUNfSlBBLmVx\ndWFscygoKE9wZW5KUEFDb25maWd1cmF0aW9uKSBjKS5nZXRTcGVjaWZpY2F0\naW9uKCkpKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogCiAgICAgICAgT3Bl\nbkpQQUNvbmZpZ3VyYXRpb25JbXBsIGNvbmYgPSAoT3BlbkpQQUNvbmZpZ3Vy\nYXRpb25JbXBsKSBjOwogICAgICAgIGNvbmYubWV0YUZhY3RvcnlQbHVnaW4u\nc2V0RGVmYXVsdChTUEVDX0pQQSk7CiAgICAgICAgY29uZi5tZXRhRmFjdG9y\neVBsdWdpbi5zZXRTdHJpbmcoU1BFQ19KUEEpOwogICAgICAgIGNvbmYubG9j\na01hbmFnZXJQbHVnaW4uc2V0RGVmYXVsdCgidmVyc2lvbiIpOwogICAgICAg\nIGNvbmYubG9ja01hbmFnZXJQbHVnaW4uc2V0U3RyaW5nKCJ2ZXJzaW9uIik7\nCiAgICAgICAgY29uZi5ub250cmFuc2FjdGlvbmFsV3JpdGUuc2V0RGVmYXVs\ndCgidHJ1ZSIpOwogICAgICAgIGNvbmYubm9udHJhbnNhY3Rpb25hbFdyaXRl\nLnNldCh0cnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIExvYWQgY29uZmlndXJhdGlvbiBmcm9tIHRoZSBnaXZlbiBw\nZXJzaXN0ZW5jZSB1bml0IHdpdGggdGhlIHNwZWNpZmllZAogICAgICogdXNl\nciBwcm9wZXJ0aWVzLgogICAgICovCiAgICBwdWJsaWMgQ29uZmlndXJhdGlv\nblByb3ZpZGVyIGxvYWQoUGVyc2lzdGVuY2VVbml0SW5mbyBwaW5mbywgTWFw\nIG0pCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\ncGluZm8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKCFpc09wZW5KUEFQZXJzaXN0ZW5jZVByb3ZpZGVyKHBpbmZvLCBu\ndWxsKSkgewogICAgICAgICAgICB3YXJuVW5rbm93blByb3ZpZGVyKHBpbmZv\nKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAg\nICBDb25maWd1cmF0aW9uUHJvdmlkZXJJbXBsIGNwID0gbmV3IENvbmZpZ3Vy\nYXRpb25Qcm92aWRlckltcGwoKTsKICAgICAgICBjcC5hZGRQcm9wZXJ0aWVz\nKFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsLnRvT3BlbkpQQVByb3BlcnRpZXMo\ncGluZm8pKTsKICAgICAgICBjcC5hZGRQcm9wZXJ0aWVzKG0pOwogICAgICAg\nIGlmIChwaW5mbyBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlVW5pdEluZm9JbXBs\nKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsIGltcGwg\nPSAoUGVyc2lzdGVuY2VVbml0SW5mb0ltcGwpIHBpbmZvOwogICAgICAgICAg\nICBpZiAoaW1wbC5nZXRQZXJzaXN0ZW5jZVhtbEZpbGVVcmwoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgY3Auc2V0U291cmNlKGltcGwuZ2V0UGVyc2lz\ndGVuY2VYbWxGaWxlVXJsKCkudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjcDsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgY29u\nZmlndXJhdGlvbiBmcm9tIHRoZSBnaXZlbiByZXNvdXJjZSBhbmQgdW5pdCBu\nYW1lcywgd2hpY2ggbWF5CiAgICAgKiBiZSBudWxsLgogICAgICovCiAgICBw\ndWJsaWMgQ29uZmlndXJhdGlvblByb3ZpZGVyIGxvYWQoU3RyaW5nIHJzcmMs\nIFN0cmluZyBuYW1lLCBNYXAgbSkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGJvb2xlYW4gZXhwbGljaXQgPSAhU3RyaW5nVXRpbHMu\naXNFbXB0eShyc3JjKTsKICAgICAgICBpZiAoIWV4cGxpY2l0KQogICAgICAg\nICAgICByc3JjID0gUlNSQ19ERUZBVUxUOwogICAgICAgIAogICAgICAgIENv\nbmZpZ3VyYXRpb25Qcm92aWRlckltcGwgY3AgPSBuZXcgQ29uZmlndXJhdGlv\nblByb3ZpZGVySW1wbCgpOwogICAgICAgIEJvb2xlYW4gcmV0ID0gbG9hZChj\ncCwgcnNyYywgbmFtZSwgbSwgbnVsbCwgZXhwbGljaXQpOwogICAgICAgIGlm\nIChyZXQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChyZXQuYm9vbGVh\nblZhbHVlKCkpID8gY3AgOiBudWxsOwogICAgICAgIGlmIChleHBsaWNpdCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHBlcnNpc3Rl\nbmNlLnhtbCBkb2VzIG5vdCBleGlzdDsganVzdCBsb2FkIG1hcAogICAgICAg\nIFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsIHBpbmZvID0gbmV3IFBlcnNpc3Rl\nbmNlVW5pdEluZm9JbXBsKCk7CiAgICAgICAgcGluZm8uZnJvbVVzZXJQcm9w\nZXJ0aWVzKG0pOwogICAgICAgIGlmICghaXNPcGVuSlBBUGVyc2lzdGVuY2VQ\ncm92aWRlcihwaW5mbywgbnVsbCkpIHsKICAgICAgICAgICAgd2FyblVua25v\nd25Qcm92aWRlcihwaW5mbyk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KICAgICAgICBjcC5hZGRQcm9wZXJ0aWVzKHBpbmZvLnRvT3Bl\nbkpQQVByb3BlcnRpZXMoKSk7CiAgICAgICAgcmV0dXJuIGNwOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIENvbmZpZ3VyYXRpb25Qcm92aWRl\nciBsb2FkKFN0cmluZyByc3JjLCBTdHJpbmcgYW5jaG9yLCAKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAocnNyYyAhPSBudWxsICYmICFyc3JjLmVuZHNXaXRo\nKCIueG1sIikpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIENv\nbmZpZ3VyYXRpb25Qcm92aWRlckltcGwgY3AgPSBuZXcgQ29uZmlndXJhdGlv\nblByb3ZpZGVySW1wbCgpOwogICAgICAgIGlmIChsb2FkKGNwLCByc3JjLCBh\nbmNob3IsIG51bGwsIGxvYWRlciwgdHJ1ZSkgPT0gQm9vbGVhbi5UUlVFKQog\nICAgICAgICAgICByZXR1cm4gY3A7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQ29uZmlndXJhdGlvblBy\nb3ZpZGVyIGxvYWQoRmlsZSBmaWxlLCBTdHJpbmcgYW5jaG9yKSAKICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICghZmlsZS5nZXRO\nYW1lKCkuZW5kc1dpdGgoIi54bWwiKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIENvbmZpZ3VyYXRpb25QYXJzZXIgcGFyc2VyID0gbmV3\nIENvbmZpZ3VyYXRpb25QYXJzZXIobnVsbCk7CiAgICAgICAgcGFyc2VyLnBh\ncnNlKGZpbGUpOwogICAgICAgIHJldHVybiBsb2FkKGZpbmRVbml0KChMaXN0\nPFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsPikgCiAgICAgICAgICAgIHBhcnNl\nci5nZXRSZXN1bHRzKCksIGFuY2hvciwgbnVsbCksIG51bGwpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIENvbmZpZ3VyYXRpb25Qcm92aWRl\nciBsb2FkR2xvYmFscyhDbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9\nIFByb2R1Y3REZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uUHJlZml4ZXMo\nKTsKICAgICAgICBTdHJpbmcgcnNyYyA9IG51bGw7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGggJiYgU3RyaW5nVXRpbHMu\naXNFbXB0eShyc3JjKTsgaSsrKQogICAgICAgICAgIHJzcmMgPSAoU3RyaW5n\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgLmdldFByb3BlcnR5QWN0aW9uKHByZWZpeGVz\nW2ldICsgIi5wcm9wZXJ0aWVzIikpOyAKICAgICAgICBib29sZWFuIGV4cGxp\nY2l0ID0gIVN0cmluZ1V0aWxzLmlzRW1wdHkocnNyYyk7CiAgICAgICAgU3Ry\naW5nIGFuY2hvciA9IG51bGw7CiAgICAgICAgaW50IGlkeCA9ICghZXhwbGlj\naXQpID8gLTEgOiByc3JjLmxhc3RJbmRleE9mKCcjJyk7CiAgICAgICAgaWYg\nKGlkeCAhPSAtMSkgewogICAgICAgICAgICAvLyBzZXBhcmF0ZSBuYW1lIGZy\nb20gPHJlc3JvdWNlPiM8bmFtZT4gc3RyaW5nCiAgICAgICAgICAgIGlmIChp\nZHggPCByc3JjLmxlbmd0aCgpIC0gMSkKICAgICAgICAgICAgICAgIGFuY2hv\nciA9IHJzcmMuc3Vic3RyaW5nKGlkeCArIDEpOwogICAgICAgICAgICByc3Jj\nID0gcnNyYy5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICB9CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocnNyYykpCiAgICAgICAgICAgIHJz\ncmMgPSBSU1JDX0dMT0JBTDsKICAgICAgICBlbHNlIGlmICghcnNyYy5lbmRz\nV2l0aCgiLnhtbCIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgQ29uZmlndXJhdGlvblByb3ZpZGVySW1wbCBjcCA9IG5ldyBDb25maWd1\ncmF0aW9uUHJvdmlkZXJJbXBsKCk7CiAgICAgICAgaWYgKGxvYWQoY3AsIHJz\ncmMsIGFuY2hvciwgbnVsbCwgbG9hZGVyLCBleHBsaWNpdCkgPT0gQm9vbGVh\nbi5UUlVFKQogICAgICAgICAgICByZXR1cm4gY3A7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQ29uZmln\ndXJhdGlvblByb3ZpZGVyIGxvYWREZWZhdWx0cyhDbGFzc0xvYWRlciBsb2Fk\nZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBDb25m\naWd1cmF0aW9uUHJvdmlkZXJJbXBsIGNwID0gbmV3IENvbmZpZ3VyYXRpb25Q\ncm92aWRlckltcGwoKTsKICAgICAgICBpZiAobG9hZChjcCwgUlNSQ19ERUZB\nVUxULCBudWxsLCBudWxsLCBsb2FkZXIsIGZhbHNlKSA9PSBCb29sZWFuLlRS\nVUUpCiAgICAgICAgICAgIHJldHVybiBjcDsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIExvb2tzIHRocm91Z2ggdGhlIHJl\nc291cmNlcyBhdCA8Y29kZT5yc3JjPC9jb2RlPiBmb3IgYSBjb25maWd1cmF0\naW9uCiAgICAgKiBmaWxlIHRoYXQgbWF0Y2hlcyA8Y29kZT5uYW1lPC9jb2Rl\nPiAob3IgYW4gdW5uYW1lZCBvbmUgaWYKICAgICAqIDxjb2RlPm5hbWU8L2Nv\nZGU+IGlzIDxjb2RlPm51bGw8L2NvZGU+KSwgYW5kIGxvYWRzIHRoZSBYTUwg\naW4gdGhlCiAgICAgKiByZXNvdXJjZSBpbnRvIGEgbmV3IHtAbGluayBQZXJz\naXN0ZW5jZVVuaXRJbmZvfS4gVGhlbiwgYXBwbGllcyB0aGUKICAgICAqIG92\nZXJyaWRlcyBpbiA8Y29kZT5tPC9jb2RlPi4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHtAbGluayBCb29sZWFuI1RSVUV9IGlmIHRoZSByZXNvdXJjZSB3YXMg\nbG9hZGVkLCBudWxsIGlmIGl0CiAgICAgKiBkb2VzIG5vdCBleGlzdCwgb3Ig\ne0BsaW5rIEJvb2xlYW4jRkFMU0V9IGlmIGl0IGlzIG5vdCBmb3IgT3BlbkpQ\nQQogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gbG9hZChDb25maWd1cmF0\naW9uUHJvdmlkZXJJbXBsIGNwLCBTdHJpbmcgcnNyYywgCiAgICAgICAgU3Ry\naW5nIG5hbWUsIE1hcCBtLCBDbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4g\nZXhwbGljaXQpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAobG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIGxvYWRlciA9IChD\nbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xhc3NM\nb2FkZXJBY3Rpb24oKSk7CgogICAgICAgIEVudW1lcmF0aW9uPFVSTD4gdXJs\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdXJscyA9IChF\nbnVtZXJhdGlvbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRSZXNvdXJjZXNBY3Rp\nb24obG9hZGVyLCByc3JjKSk7IAogICAgICAgICAgICBpZiAoIXVybHMuaGFz\nTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIGlmICghcnNyYy5z\ndGFydHNXaXRoKCJNRVRBLUlORiIpKQogICAgICAgICAgICAgICAgICAgIHVy\nbHMgPSAoRW51bWVyYXRpb24pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXRSZXNvdXJjZXNBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2FkZXIsICJNRVRBLUlORi8iICsgcnNyYykpOyAKICAgICAgICAgICAg\nICAgIGlmICghdXJscy5oYXNNb3JlRWxlbWVudHMoKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0g\nY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAg\nICAgICAgIHRocm93IChJT0V4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigp\nOwogICAgICAgIH0KCiAgICAgICAgQ29uZmlndXJhdGlvblBhcnNlciBwYXJz\nZXIgPSBuZXcgQ29uZmlndXJhdGlvblBhcnNlcihtKTsKICAgICAgICBQZXJz\naXN0ZW5jZVVuaXRJbmZvSW1wbCBwaW5mbyA9IHBhcnNlUmVzb3VyY2VzKHBh\ncnNlciwgdXJscywgbmFtZSwgCiAgICAgICAgICAgIGxvYWRlcik7CiAgICAg\nICAgaWYgKHBpbmZvID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKCFleHBs\naWNpdCkKICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jlc291cmNlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJtaXNzaW5nLXhtbC1jb25maWciLCAKICAgICAgICAgICAg\nICAgIHJzcmMsIFN0cmluZy52YWx1ZU9mKG5hbWUpKS5nZXRNZXNzYWdlKCks\nIGdldENsYXNzKCkuZ2V0TmFtZSgpLCAKICAgICAgICAgICAgICAgIHJzcmMp\nOwogICAgICAgIH0gZWxzZSBpZiAoIWlzT3BlbkpQQVBlcnNpc3RlbmNlUHJv\ndmlkZXIocGluZm8sIGxvYWRlcikpIHsKICAgICAgICAgICAgaWYgKCFleHBs\naWNpdCkgewogICAgICAgICAgICAgICAgd2FyblVua25vd25Qcm92aWRlcihw\naW5mbyk7CiAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jl\nc291cmNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bmtub3duLXByb3ZpZGVyIiwg\nCiAgICAgICAgICAgICAgICByc3JjLCBuYW1lLCBwaW5mby5nZXRQZXJzaXN0\nZW5jZVByb3ZpZGVyQ2xhc3NOYW1lKCkpLgogICAgICAgICAgICAgICAgZ2V0\nTWVzc2FnZSgpLCBnZXRDbGFzcygpLmdldE5hbWUoKSwgcnNyYyk7CiAgICAg\nICAgfQogICAgICAgIGNwLmFkZFByb3BlcnRpZXMocGluZm8udG9PcGVuSlBB\nUHJvcGVydGllcygpKTsKICAgICAgICBjcC5zZXRTb3VyY2UocGluZm8uZ2V0\nUGVyc2lzdGVuY2VYbWxGaWxlVXJsKCkudG9TdHJpbmcoKSk7CiAgICAgICAg\ncmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIHJlc291cmNlcyBhdCB0aGUgZ2l2ZW4gbG9jYXRpb24uIFNlYXJjaGVz\nIGZvciBhCiAgICAgKiBQZXJzaXN0ZW5jZVVuaXRJbmZvIHdpdGggdGhlIHJl\ncXVlc3RlZCBuYW1lLCBvciBhbiBPcGVuSlBBIHVuaXQgaWYKICAgICAqIG5v\nIG5hbWUgZ2l2ZW4gKHByZWZlcnJpbmcgYW4gdW5uYW1lZCBPcGVuSlBBIHVu\naXQgdG8gYSBuYW1lZCBvbmUpLgogICAgICovCiAgICBwcml2YXRlIFBlcnNp\nc3RlbmNlVW5pdEluZm9JbXBsIHBhcnNlUmVzb3VyY2VzKENvbmZpZ3VyYXRp\nb25QYXJzZXIgcGFyc2VyLAogICAgICAgIEVudW1lcmF0aW9uPFVSTD4gdXJs\ncywgU3RyaW5nIG5hbWUsIENsYXNzTG9hZGVyIGxvYWRlcikKICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIExpc3Q8UGVyc2lzdGVuY2VV\nbml0SW5mb0ltcGw+IHBpbmZvcyA9IAogICAgICAgICAgICBuZXcgQXJyYXlM\naXN0PFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsPigpOwogICAgICAgIGZvciAo\nVVJMIHVybCA6IENvbGxlY3Rpb25zLmxpc3QodXJscykpIHsKICAgICAgICAg\nICAgcGFyc2VyLnBhcnNlKHVybCk7CiAgICAgICAgICAgIHBpbmZvcy5hZGRB\nbGwoKExpc3Q8UGVyc2lzdGVuY2VVbml0SW5mb0ltcGw+KSBwYXJzZXIuZ2V0\nUmVzdWx0cygpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpbmRVbml0\nKHBpbmZvcywgbmFtZSwgbG9hZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZpbmQgdGhlIHVuaXQgd2l0aCB0aGUgZ2l2ZW4gbmFtZSwgb3IgYW4gT3Bl\nbkpQQSB1bml0IGlmIG5vIG5hbWUgaXMKICAgICAqIGdpdmVuIChwcmVmZXJy\naW5nIGFuIHVubmFtZWQgT3BlbkpQQSB1bml0IHRvIGEgbmFtZWQgb25lKS4K\nICAgICAqLwogICAgcHJpdmF0ZSBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCBm\naW5kVW5pdChMaXN0PFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsPiAKICAgICAg\nICBwaW5mb3MsIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsK\nICAgICAgICBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCBvanBhID0gbnVsbDsK\nICAgICAgICBmb3IgKFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsIHBpbmZvIDog\ncGluZm9zKSB7CiAgICAgICAgICAgIC8vIGZvdW5kIG5hbWVkIHVuaXQ/CiAg\nICAgICAgICAgIGlmIChuYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChuYW1lLmVxdWFscyhwaW5mby5nZXRQZXJzaXN0ZW5jZVVuaXROYW1l\nKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwaW5mbzsKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoaXNPcGVuSlBBUGVyc2lzdGVuY2VQcm92aWRlcihwaW5mbywgbG9h\nZGVyKSkgewogICAgICAgICAgICAgICAgLy8gaWYgbm8gbmFtZSBnaXZlbiBh\nbmQgZm91bmQgdW5uYW1lZCB1bml0LCByZXR1cm4gaXQuICAKICAgICAgICAg\nICAgICAgIC8vIG90aGVyd2lzZSByZWNvcmQgYXMgZGVmYXVsdCB1bml0IHVu\nbGVzcyB3ZSBmaW5kIGEgCiAgICAgICAgICAgICAgICAvLyBiZXR0ZXIgbWF0\nY2ggbGF0ZXIKICAgICAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KHBpbmZvLmdldFBlcnNpc3RlbmNlVW5pdE5hbWUoKSkpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHBpbmZvOwogICAgICAgICAgICAgICAgaWYg\nKG9qcGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBvanBhID0gcGlu\nZm87CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9q\ncGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUg\nZ2l2ZW4gcGVyc2lzdGVuY2UgdW5pdCB1c2VzIGFuIE9wZW5KUEEgcHJvdmlk\nZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNPcGVu\nSlBBUGVyc2lzdGVuY2VQcm92aWRlcgogICAgICAgIChQZXJzaXN0ZW5jZVVu\naXRJbmZvIHBpbmZvLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBT\ndHJpbmcgcHJvdmlkZXIgPSBwaW5mby5nZXRQZXJzaXN0ZW5jZVByb3ZpZGVy\nQ2xhc3NOYW1lKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\ncHJvdmlkZXIpIAogICAgICAgICAgICB8fCBQZXJzaXN0ZW5jZVByb3ZpZGVy\nSW1wbC5jbGFzcy5nZXROYW1lKCkuZXF1YWxzKHByb3ZpZGVyKSkKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIGlmIChsb2FkZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgbG9hZGVyID0gKENsYXNzTG9hZGVyKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoUGVyc2lzdGVuY2VQcm92aWRl\nckltcGwuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbQogICAgICAgICAgICAgICAg\nKENsYXNzLmZvck5hbWUocHJvdmlkZXIsIGZhbHNlLCBsb2FkZXIpKSkKICAg\nICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKFRo\ncm93YWJsZSB0KSB7CiAgICAgICAgICAgIGxvZyhfbG9jLmdldCgidW5sb2Fk\nYWJsZS1wcm92aWRlciIsIHByb3ZpZGVyLCB0KS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhlIHVz\nZXIgdGhhdCB3ZSBjb3VsZCBvbmx5IGZpbmQgYW4gdW5yZWNvZ25pemVkIHBl\ncnNpc3RlbmNlIAogICAgICogcHJvdmlkZXIuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIHZvaWQgd2FyblVua25vd25Qcm92aWRlcihQZXJzaXN0ZW5j\nZVVuaXRJbmZvIHBpbmZvKSB7CiAgICAgICAgbG9nKF9sb2MuZ2V0KCJ1bnJl\nY29nbml6ZWQtcHJvdmlkZXIiLCAKICAgICAgICAgICAgcGluZm8uZ2V0UGVy\nc2lzdGVuY2VQcm92aWRlckNsYXNzTmFtZSgpKS5nZXRNZXNzYWdlKCkpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIExvZyBhIG1lc3NhZ2UuICAgCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgbG9nKFN0cmluZyBtc2cp\nIHsKICAgICAgICAvLyBhdCB0aGlzIHBvaW50IGxvZ2dpbmcgaXNuJ3QgY29u\nZmlndXJlZCB5ZXQKICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4obXNnKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEN1c3RvbSBjb25maWd1cmF0aW9uIHBy\nb3ZpZGVyLiAgIAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIENv\nbmZpZ3VyYXRpb25Qcm92aWRlckltcGwKICAgICAgICBleHRlbmRzIE1hcENv\nbmZpZ3VyYXRpb25Qcm92aWRlciB7CgogICAgICAgIHByaXZhdGUgU3RyaW5n\nIF9zb3VyY2U7CgogICAgICAgIHB1YmxpYyBDb25maWd1cmF0aW9uUHJvdmlk\nZXJJbXBsKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbmZpZ3Vy\nYXRpb25Qcm92aWRlckltcGwoTWFwIHByb3BzKSB7CiAgICAgICAgICAgIHN1\ncGVyKHByb3BzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFNldCB0aGUgc291cmNlIG9mIGluZm9ybWF0aW9uIGluIHRoaXMgcHJvdmlk\nZXIuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0U291cmNl\nKFN0cmluZyBzb3VyY2UpIHsKICAgICAgICAgICAgX3NvdXJjZSA9IHNvdXJj\nZTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIHNldEludG8oQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\nICAgIGlmIChjb25mIGluc3RhbmNlb2YgT3BlbkpQQUNvbmZpZ3VyYXRpb24p\nIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIG9jb25m\nID0gKE9wZW5KUEFDb25maWd1cmF0aW9uKSBjb25mOwogICAgICAgICAgICAg\nICAgb2NvbmYuc2V0U3BlY2lmaWNhdGlvbihTUEVDX0pQQSk7CgogICAgICAg\nICAgICAgICAgLy8gd2UgbWVyZ2Ugc2V2ZXJhbCBwZXJzaXN0ZW5jZS54bWwg\nZWxlbWVudHMgaW50byB0aGUgCiAgICAgICAgICAgICAgICAvLyBNZXRhRGF0\nYUZhY3RvcnkgcHJvcGVydHkgaW1wbGljaXRseS4gIGlmIHRoZSB1c2VyIGhh\ncyBhCiAgICAgICAgICAgICAgICAvLyBnbG9iYWwgb3BlbmpwYS54bWwgd2l0\naCB0aGlzIHByb3BlcnR5IHNldCwgaXRzIHZhbHVlIHdpbGwKICAgICAgICAg\nICAgICAgIC8vIGdldCBvdmVyd3JpdHRlbiBieSBvdXIgaW1wbGljaXQgc2V0\ndGluZy4gIHNvIGluc3RlYWQsIGNvbWJpbmUKICAgICAgICAgICAgICAgIC8v\nIHRoZSBnbG9iYWwgdmFsdWUgd2l0aCBvdXIgc2V0dGluZ3MKICAgICAgICAg\nICAgICAgIFN0cmluZyBvcmlnID0gb2NvbmYuZ2V0TWV0YURhdGFGYWN0b3J5\nKCk7CiAgICAgICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\nb3JpZykpIHsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcga2V5ID0gUHJv\nZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXkKICAgICAgICAg\nICAgICAgICAgICAgICAgKCJNZXRhRGF0YUZhY3RvcnkiLCBnZXRQcm9wZXJ0\naWVzKCkpOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCBvdmVycmlkZSA9\nIGdldFByb3BlcnRpZXMoKS5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAg\nICBpZiAob3ZlcnJpZGUgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGFkZFByb3BlcnR5KGtleSwgQ29uZmlndXJhdGlvbnMu\nY29tYmluZVBsdWdpbnMob3JpZywgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAoU3RyaW5nKSBvdmVycmlkZSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICBzdXBlci5zZXRJbnRvKGNvbmYs\nIG51bGwpOwogICAgICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRDb25maWd1\ncmF0aW9uTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIHNyYyA9IChfc291cmNl\nID09IG51bGwpID8gIj8iIDogX3NvdXJjZTsKICAgICAgICAgICAgICAgIGxv\nZy50cmFjZShfbG9jLmdldCgiY29uZi1sb2FkIiwgc3JjLCBnZXRQcm9wZXJ0\naWVzKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFNBWCBoYW5kbGVyIGNhcGFibGUgb2YgcGFyc2luZyBhbiBK\nUEEgcGVyc2lzdGVuY2UueG1sIGZpbGUuCiAgICAgKiBQYWNrYWdlLXByb3Rl\nY3RlZCBmb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBj\nbGFzcyBDb25maWd1cmF0aW9uUGFyc2VyCiAgICAgICAgZXh0ZW5kcyBYTUxN\nZXRhRGF0YVBhcnNlciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWFwIF9t\nYXA7CiAgICAgICAgcHJpdmF0ZSBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCBf\naW5mbyA9IG51bGw7CiAgICAgICAgcHJpdmF0ZSBVUkwgX3NvdXJjZSA9IG51\nbGw7CgogICAgICAgIHB1YmxpYyBDb25maWd1cmF0aW9uUGFyc2VyKE1hcCBt\nYXApIHsKICAgICAgICAgICAgX21hcCA9IG1hcDsKICAgICAgICAgICAgc2V0\nQ2FjaGluZyhmYWxzZSk7CiAgICAgICAgICAgIHNldFZhbGlkYXRpbmcodHJ1\nZSk7CiAgICAgICAgICAgIHNldFBhcnNlVGV4dCh0cnVlKTsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHBhcnNl\nKFVSTCB1cmwpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIF9zb3VyY2UgPSB1cmw7CiAgICAgICAgICAgIHN1cGVyLnBh\ncnNlKHVybCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgdm9pZCBwYXJzZShGaWxlIGZpbGUpCiAgICAgICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9zb3VyY2UgPSBmaWxl\nLnRvVVJMKCk7CiAgICAgICAgICAgIHN1cGVyLnBhcnNlKGZpbGUpOwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHJvdGVjdGVkIE9i\namVjdCBnZXRTY2hlbWFTb3VyY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBn\nZXRDbGFzcygpLmdldFJlc291cmNlQXNTdHJlYW0oInBlcnNpc3RlbmNlLXhz\nZC5yc3JjIik7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwcm90ZWN0ZWQgdm9pZCByZXNldCgpIHsKICAgICAgICAgICAgc3VwZXIu\ncmVzZXQoKTsKICAgICAgICAgICAgX2luZm8gPSBudWxsOwogICAgICAgICAg\nICBfc291cmNlID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBib29sZWFuIHN0YXJ0RWxlbWVudChTdHJpbmcgbmFtZSwgQXR0cmlidXRl\ncyBhdHRycykKICAgICAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGlmIChjdXJyZW50RGVwdGgoKSA9PSAxKQogICAgICAgICAg\nICAgICAgc3RhcnRQZXJzaXN0ZW5jZVVuaXQoYXR0cnMpOwogICAgICAgICAg\nICBlbHNlIGlmIChjdXJyZW50RGVwdGgoKSA9PSAzICYmICJwcm9wZXJ0eSIu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICAgICAgX2luZm8uc2V0UHJvcGVy\ndHkoYXR0cnMuZ2V0VmFsdWUoIm5hbWUiKSwKICAgICAgICAgICAgICAgICAg\nICBhdHRycy5nZXRWYWx1ZSgidmFsdWUiKSk7CiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZW5k\nRWxlbWVudChTdHJpbmcgbmFtZSkKICAgICAgICAgICAgdGhyb3dzIFNBWEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChjdXJyZW50RGVwdGgoKSA9PSAx\nKSB7CiAgICAgICAgICAgICAgICBfaW5mby5mcm9tVXNlclByb3BlcnRpZXMo\nX21hcCk7CiAgICAgICAgICAgICAgICBhZGRSZXN1bHQoX2luZm8pOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChjdXJyZW50RGVwdGgoKSAhPSAy\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgc3dpdGNo\nIChuYW1lLmNoYXJBdCgwKSkgewogICAgICAgICAgICAgICAgY2FzZSAnYyc6\nIC8vIGNsYXNzCiAgICAgICAgICAgICAgICAgICAgX2luZm8uYWRkTWFuYWdl\nZENsYXNzTmFtZShjdXJyZW50VGV4dCgpKTsKICAgICAgICAgICAgICAgIGNh\nc2UgJ2UnOiAvLyBleGNsdWRlLXVubGlzdGVkLWNsYXNzZXMKICAgICAgICAg\nICAgICAgICAgICBfaW5mby5zZXRFeGNsdWRlVW5saXN0ZWRDbGFzc2VzKCJ0\ncnVlIi5lcXVhbHNJZ25vcmVDYXNlCiAgICAgICAgICAgICAgICAgICAgICAg\nIChjdXJyZW50VGV4dCgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlICdqJzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoImp0YS1kYXRhLXNvdXJjZSIuZXF1YWxzKG5hbWUpKQogICAgICAg\nICAgICAgICAgICAgICAgICBfaW5mby5zZXRKdGFEYXRhU291cmNlTmFtZShj\ndXJyZW50VGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIC8vIGph\nci1maWxlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2lu\nZm8uYWRkSmFyRmlsZU5hbWUoY3VycmVudFRleHQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbiBpYWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGdl\ndEV4Y2VwdGlvbihpYWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ20nOiAvLyBt\nYXBwaW5nLWZpbGUKICAgICAgICAgICAgICAgICAgICBfaW5mby5hZGRNYXBw\naW5nRmlsZU5hbWUoY3VycmVudFRleHQoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICduJzogLy8gbm9uLWp0\nYS1kYXRhLXNvdXJjZQogICAgICAgICAgICAgICAgICAgIF9pbmZvLnNldE5v\nbkp0YURhdGFTb3VyY2VOYW1lKGN1cnJlbnRUZXh0KCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAncCc6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCJwcm92aWRlciIuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICAgICAgICAgICAgICBfaW5mby5zZXRQZXJzaXN0ZW5j\nZVByb3ZpZGVyQ2xhc3NOYW1lKGN1cnJlbnRUZXh0KCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBQYXJzZSBwZXJzaXN0ZW5jZS11bml0IGVs\nZW1lbnQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIHN0YXJ0\nUGVyc2lzdGVuY2VVbml0KEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgICAg\nIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgICAgICBfaW5mbyA9IG5l\ndyBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCgpOwogICAgICAgICAgICBfaW5m\nby5zZXRQZXJzaXN0ZW5jZVVuaXROYW1lKGF0dHJzLmdldFZhbHVlKCJuYW1l\nIikpOwoKICAgICAgICAgICAgLy8gd2Ugb25seSBwYXJzZSB0aGlzIG91cnNl\nbHZlcyBvdXRzaWRlIGEgY29udGFpbmVyLCBzbyBkZWZhdWx0CiAgICAgICAg\nICAgIC8vIHRyYW5zYWN0aW9uIHR5cGUgdG8gbG9jYWwKICAgICAgICAgICAg\nU3RyaW5nIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJ0cmFuc2FjdGlvbi10eXBl\nIik7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9pbmZvLnNldFRyYW5zYWN0aW9uVHlwZQogICAgICAgICAgICAgICAg\nICAgIChQZXJzaXN0ZW5jZVVuaXRUcmFuc2FjdGlvblR5cGUuUkVTT1VSQ0Vf\nTE9DQUwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfaW5m\nby5zZXRUcmFuc2FjdGlvblR5cGUoRW51bS52YWx1ZU9mCiAgICAgICAgICAg\nICAgICAgICAgKFBlcnNpc3RlbmNlVW5pdFRyYW5zYWN0aW9uVHlwZS5jbGFz\ncywgdmFsKSk7CgogICAgICAgICAgICBpZiAoX3NvdXJjZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2luZm8uc2V0UGVyc2lzdGVuY2VYbWxGaWxlVXJs\nKF9zb3VyY2UpOwoJCX0KCX0KfQo=\n","encoding":"base64"}

