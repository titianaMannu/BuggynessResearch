{"sha":"8e59a84ae95b21d5b8133977fd139be3a4ccb6bc","node_id":"MDQ6QmxvYjIwNjM2NDo4ZTU5YTg0YWU5NWIyMWQ1YjgxMzM5NzdmZDEzOWJlM2E0Y2NiNmJj","size":18721,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8e59a84ae95b21d5b8133977fd139be3a4ccb6bc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVm\nbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBv\ncnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlRlbXBvcmFsVHlwZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGluZ1Jlc3VsdExpc3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5T3BlcmF0aW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BZ2dy\nZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIucm9wLlJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKCi8qKgogKiBJbXBsZW1lbnRhdGlv\nbiBvZiB7QGxpbmsgUXVlcnl9IGludGVyZmFjZS4KICoKICogQGF1dGhvciBN\nYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5v\namF2YWRvYwogKi8KcHVibGljIGNsYXNzIFF1ZXJ5SW1wbAogICAgaW1wbGVt\nZW50cyBPcGVuSlBBUXVlcnlTUEksIFNlcmlhbGl6YWJsZSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfQVJSQVkgPSBuZXcg\nT2JqZWN0WzBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoUXVlcnlJ\nbXBsLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIERlbGVnYXRpbmdRdWVy\neSBfcXVlcnk7CiAgICBwcml2YXRlIHRyYW5zaWVudCBFbnRpdHlNYW5hZ2Vy\nSW1wbCBfZW07CiAgICBwcml2YXRlIHRyYW5zaWVudCBGZXRjaFBsYW4gX2Zl\ndGNoOwoKICAgIHByaXZhdGUgTWFwIF9uYW1lZDsKICAgIHByaXZhdGUgTGlz\ndCBfcG9zaXRpb25hbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBz\ndXBwbHkgZmFjdG9yeSBhbmQgZGVsZWdhdGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sCiAgICAgICAgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeSBxdWVyeSkgewogICAgICAg\nIF9lbSA9IGVtOwogICAgICAgIF9xdWVyeSA9IG5ldyBEZWxlZ2F0aW5nUXVl\ncnkocXVlcnksCiAgICAgICAgICAgIFBlcnNpc3RlbmNlRXhjZXB0aW9ucy5n\nZXRSb2xsYmFja1RyYW5zbGF0b3IoZW0pKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIERlbGVnYXRlLgogICAgICovCiAgICBwdWJsaWMgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeSBnZXREZWxlZ2F0ZSgpIHsKICAgICAgICBy\nZXR1cm4gX3F1ZXJ5LmdldERlbGVnYXRlKCk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGdldEVudGl0eU1hbmFnZXIoKSB7CiAg\nICAgICAgcmV0dXJuIF9lbTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndExhbmd1YWdlKCkgewogICAgICAgIHJldHVybiBfcXVlcnkuZ2V0TGFuZ3Vh\nZ2UoKTsKICAgIH0KCiAgICBwdWJsaWMgUXVlcnlPcGVyYXRpb25UeXBlIGdl\ndE9wZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gUXVlcnlPcGVyYXRpb25U\neXBlLmZyb21LZXJuZWxDb25zdGFudChfcXVlcnkuZ2V0T3BlcmF0aW9uKCkp\nOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaFBsYW4gZ2V0RmV0Y2hQbGFuKCkg\newogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAg\nICBfcXVlcnkuYXNzZXJ0Tm90U2VyaWFsaXplZCgpOwogICAgICAgIF9xdWVy\neS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9mZXRj\naCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZldGNoID0gKChFbnRpdHlN\nYW5hZ2VyRmFjdG9yeUltcGwpIF9lbS4KICAgICAgICAgICAgICAgICAgICBn\nZXRFbnRpdHlNYW5hZ2VyRmFjdG9yeSgpKS50b0ZldGNoUGxhbihfcXVlcnku\nZ2V0QnJva2VyKCksCiAgICAgICAgICAgICAgICAgICAgX3F1ZXJ5LmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpKTsKICAgICAgICAgICAgcmV0dXJuIF9mZXRj\naDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nUXVlcnlTdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXRRdWVy\neVN0cmluZygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldElnbm9y\nZUNoYW5nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXRJZ25vcmVD\naGFuZ2VzKCk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRJ\nZ25vcmVDaGFuZ2VzKGJvb2xlYW4gaWdub3JlKSB7CiAgICAgICAgX2VtLmFz\nc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5zZXRJZ25v\ncmVDaGFuZ2VzKGlnbm9yZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBhZGRGaWx0ZXJMaXN0ZW5lcihG\naWx0ZXJMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIF9lbS5hc3NlcnRO\nb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkuYWRkRmlsdGVyTGlz\ndGVuZXIobGlzdGVuZXIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgcmVtb3ZlRmlsdGVyTGlzdGVuZXIo\nRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LnJlbW92ZUZpbHRl\nckxpc3RlbmVyKGxpc3RlbmVyKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IGFkZEFnZ3JlZ2F0ZUxpc3Rl\nbmVyKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgX2Vt\nLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5hZGRB\nZ2dyZWdhdGVMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSByZW1vdmVBZ2dy\nZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0ZW5lcikgewog\nICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBf\ncXVlcnkucmVtb3ZlQWdncmVnYXRlTGlzdGVuZXIobGlzdGVuZXIpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9u\nIGdldENhbmRpZGF0ZUNvbGxlY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF9x\ndWVyeS5nZXRDYW5kaWRhdGVDb2xsZWN0aW9uKCk7CiAgICB9CgogICAgcHVi\nbGljIE9wZW5KUEFRdWVyeSBzZXRDYW5kaWRhdGVDb2xsZWN0aW9uKENvbGxl\nY3Rpb24gY29sbCkgewogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9r\nZWQoKTsKICAgICAgICBfcXVlcnkuc2V0Q2FuZGlkYXRlQ29sbGVjdGlvbihj\nb2xsKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3MgZ2V0UmVzdWx0Q2xhc3MoKSB7CiAgICAgICAgQ2xhc3MgcmVzID0g\nX3F1ZXJ5LmdldFJlc3VsdFR5cGUoKTsKICAgICAgICBpZiAocmVzICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgcmV0dXJuIF9x\ndWVyeS5nZXRDYW5kaWRhdGVUeXBlKCk7CiAgICB9CgogICAgcHVibGljIE9w\nZW5KUEFRdWVyeSBzZXRSZXN1bHRDbGFzcyhDbGFzcyBjbHMpIHsKICAgICAg\nICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgaWYgKElt\ncGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShfZW0uZ2V0Q29uZmlndXJhdGlvbigp\nLCBjbHMpKQogICAgICAgICAgICBfcXVlcnkuc2V0Q2FuZGlkYXRlVHlwZShj\nbHMsIHRydWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3F1ZXJ5LnNl\ndFJlc3VsdFR5cGUoY2xzKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJjbGFzc2VzKCkgewogICAgICAg\nIHJldHVybiBfcXVlcnkuaGFzU3ViY2xhc3NlcygpOwogICAgfQoKICAgIHB1\nYmxpYyBPcGVuSlBBUXVlcnkgc2V0U3ViY2xhc3Nlcyhib29sZWFuIHN1YnMp\nIHsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAg\nICAgQ2xhc3MgY2xzID0gX3F1ZXJ5LmdldENhbmRpZGF0ZVR5cGUoKTsKICAg\nICAgICBfcXVlcnkuc2V0Q2FuZGlkYXRlRXh0ZW50KF9xdWVyeS5nZXRCcm9r\nZXIoKS5uZXdFeHRlbnQoY2xzLCBzdWJzKSk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRGaXJzdFJlc3VsdCgpIHsK\nICAgICAgICByZXR1cm4gYXNJbnQoX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRGaXJzdFJlc3Vs\ndChpbnQgc3RhcnRQb3NpdGlvbikgewogICAgICAgIF9lbS5hc3NlcnROb3RD\nbG9zZUludm9rZWQoKTsKICAgICAgICBsb25nIGVuZDsKICAgICAgICBpZiAo\nX3F1ZXJ5LmdldEVuZFJhbmdlKCkgPT0gTG9uZy5NQVhfVkFMVUUpCiAgICAg\nICAgICAgIGVuZCA9IExvbmcuTUFYX1ZBTFVFOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgZW5kID0gc3RhcnRQb3NpdGlvbiArCiAgICAgICAgICAgICAg\nICAoX3F1ZXJ5LmdldEVuZFJhbmdlKCkgLSBfcXVlcnkuZ2V0U3RhcnRSYW5n\nZSgpKTsKICAgICAgICBfcXVlcnkuc2V0UmFuZ2Uoc3RhcnRQb3NpdGlvbiwg\nZW5kKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldE1heFJlc3VsdHMoKSB7CiAgICAgICAgcmV0dXJuIGFzSW50KF9x\ndWVyeS5nZXRFbmRSYW5nZSgpIC0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRNYXhSZXN1bHRz\nKGludCBtYXgpIHsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2Vk\nKCk7CiAgICAgICAgbG9uZyBzdGFydCA9IF9xdWVyeS5nZXRTdGFydFJhbmdl\nKCk7CiAgICAgICAgaWYgKG1heCA9PSBJbnRlZ2VyLk1BWF9WQUxVRSkKICAg\nICAgICAgICAgX3F1ZXJ5LnNldFJhbmdlKHN0YXJ0LCBMb25nLk1BWF9WQUxV\nRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfcXVlcnkuc2V0UmFuZ2Uo\nc3RhcnQsIHN0YXJ0ICsgbWF4KTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IGNvbXBpbGUoKSB7CiAgICAg\nICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVy\neS5jb21waWxlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHJpdmF0ZSBPYmplY3QgZXhlY3V0ZSgpIHsKICAgICAgICBpZiAoX3F1ZXJ5\nLmdldE9wZXJhdGlvbigpICE9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1Qp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vdC1zZWxlY3QtcXVlcnkiLAogICAgICAgICAgICAgICAg\nX3F1ZXJ5LmdldFF1ZXJ5U3RyaW5nKCkpLCBudWxsLCBudWxsLCBmYWxzZSk7\nCgogICAgICAgIHZhbGlkYXRlUGFyYW1ldGVycygpOwoKICAgICAgICAvLyBo\nYW5kbGUgd2hpY2ggdHlwZXMgb2YgcGFyYW1ldGVycyB3ZSBhcmUgdXNpbmcs\nIGlmIGFueQogICAgICAgIGlmIChfcG9zaXRpb25hbCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX3F1ZXJ5LmV4ZWN1dGUoX3Bvc2l0aW9uYWwudG9B\ncnJheSgpKTsKICAgICAgICBpZiAoX25hbWVkICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBfcXVlcnkuZXhlY3V0ZShfbmFtZWQpOwogICAgICAgIHJl\ndHVybiBfcXVlcnkuZXhlY3V0ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nVmFsaWRhdGUgdGhhdCB0aGUgdHlwZXMgb2YgdGhlIHBhcmFtZXRlcnMgYXJl\nIGNvcnJlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZVBh\ncmFtZXRlcnMoKSB7CiAgICAgICAgaWYgKF9wb3NpdGlvbmFsICE9IG51bGwp\nIHsKICAgICAgICAgICAgTGlua2VkTWFwIHR5cGVzID0gX3F1ZXJ5LmdldFBh\ncmFtZXRlclR5cGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLAog\nICAgICAgICAgICAgICAgc2l6ZSA9IE1hdGgubWluKF9wb3NpdGlvbmFsLnNp\nemUoKSwgdHlwZXMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgIGkgPCBzaXpl\nOyBpKyspCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVBhcmFtZXRlcihTdHJp\nbmcudmFsdWVPZihpKSwKICAgICAgICAgICAgICAgICAgICAoQ2xhc3MpIHR5\ncGVzLmdldFZhbHVlKGkpLCBfcG9zaXRpb25hbC5nZXQoaSkpOwogICAgICAg\nIH0gZWxzZSBpZiAoX25hbWVkICE9IG51bGwpIHsKICAgICAgICAgICAgTWFw\nIHR5cGVzID0gX3F1ZXJ5LmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaSA9IF9uYW1lZC5lbnRyeVNldCgpLml0ZXJh\ndG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgTWFwLkVu\ndHJ5IGVudHJ5ID0gKE1hcC5FbnRyeSkgaS5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgbmFtZSA9IChTdHJpbmcpIGVudHJ5LmdldEtleSgpOwog\nICAgICAgICAgICAgICAgdmFsaWRhdGVQYXJhbWV0ZXIobmFtZSwgKENsYXNz\nKSB0eXBlcy5nZXQobmFtZSksCiAgICAgICAgICAgICAgICAgICAgZW50cnku\nZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlUGFyYW1ldGVyKFN0cmluZyBwYXJh\nbURlc2MsIENsYXNzIHR5cGUsIE9iamVjdCBwYXJhbSkgewogICAgICAgIC8v\nIG51bGwgcGFyYW1ldGVycyBhcmUgYWxsb3dlZCwgc28gYXJlIG5vdCB2YWxp\nZGF0ZWQKICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCB8fCB0eXBlID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gY2hlY2sgdGhl\nIHBhcmFtZXRlciBhZ2FpbnN0IHRoZSB3cmFwcGVkIHR5cGUKICAgICAgICBp\nZiAoIUZpbHRlcnMud3JhcCh0eXBlKS5pc0luc3RhbmNlKHBhcmFtKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtcGFyYW0tdHlwZSIsCiAgICAgICAgICAgICAgICBwYXJhbURlc2Ms\nIHBhcmFtLmdldENsYXNzKCkuZ2V0TmFtZSgpLCB0eXBlLmdldE5hbWUoKSks\nCiAgICAgICAgICAgICAgICBudWxsLCBudWxsLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIExpc3QgZ2V0UmVzdWx0TGlzdCgpIHsKICAgICAgICBfZW0u\nYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgT2JqZWN0IG9iID0g\nZXhlY3V0ZSgpOwogICAgICAgIGlmIChvYiBpbnN0YW5jZW9mIExpc3QpIHsK\nICAgICAgICAgICAgTGlzdCByZXQgPSAoTGlzdCkgb2I7CiAgICAgICAgICAg\nIGlmIChyZXQgaW5zdGFuY2VvZiBSZXN1bHRMaXN0KQogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBEZWxlZ2F0aW5nUmVzdWx0TGlzdCgoUmVzdWx0TGlz\ndCkgcmV0LAogICAgICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlRXhjZXB0\naW9ucy5nZXRSb2xsYmFja1RyYW5zbGF0b3IoX2VtKSk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQoK\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuc2luZ2xldG9uTGlzdChvYik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIGEgcXVlcnkgdGhhdCBy\nZXR1cm5zIGEgc2luZ2xlIHJlc3VsdC4KICAgICAqLwogICAgcHVibGljIE9i\namVjdCBnZXRTaW5nbGVSZXN1bHQoKSB7CiAgICAgICAgX2VtLmFzc2VydE5v\ndENsb3NlSW52b2tlZCgpOwogICAgICAgIC8vIHRlbXBvcmFyaWx5IHNldCBx\ndWVyeSB0byB1bmlxdWUgc28gdGhhdCBhIHNpbmdsZSByZXN1bHQgaXMgdmFs\naWRhdGVkCiAgICAgICAgLy8gYW5kIHJldHVybmVkOyB1bnNldCBhZ2FpbiBp\nbiBjYXNlIHRoZSB1c2VyIGV4ZWN1dGVzIHF1ZXJ5IGFnYWluCiAgICAgICAg\nLy8gdmlhIGdldFJlc3VsdExpc3QKICAgICAgICBfcXVlcnkuc2V0VW5pcXVl\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBleGVj\ndXRlKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5\nLnNldFVuaXF1ZShmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHsKICAgICAgICBfZW0uYXNzZXJ0Tm90\nQ2xvc2VJbnZva2VkKCk7CiAgICAgICAgaWYgKF9xdWVyeS5nZXRPcGVyYXRp\nb24oKSA9PSBRdWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFKSB7CiAgICAgICAg\nICAgIC8vIGhhbmRsZSB3aGljaCB0eXBlcyBvZiBwYXJhbWV0ZXJzIHdlIGFy\nZSB1c2luZywgaWYgYW55CiAgICAgICAgICAgIGlmIChfcG9zaXRpb25hbCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGFzSW50KF9xdWVyeS5k\nZWxldGVBbGwoX3Bvc2l0aW9uYWwudG9BcnJheSgpKSk7CiAgICAgICAgICAg\nIGlmIChfbmFtZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBh\nc0ludChfcXVlcnkuZGVsZXRlQWxsKF9uYW1lZCkpOwogICAgICAgICAgICBy\nZXR1cm4gYXNJbnQoX3F1ZXJ5LmRlbGV0ZUFsbCgpKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKF9xdWVyeS5nZXRPcGVyYXRpb24oKSA9PSBRdWVyeU9wZXJh\ndGlvbnMuT1BfVVBEQVRFKSB7CiAgICAgICAgICAgIC8vIGhhbmRsZSB3aGlj\naCB0eXBlcyBvZiBwYXJhbWV0ZXJzIHdlIGFyZSB1c2luZywgaWYgYW55CiAg\nICAgICAgICAgIGlmIChfcG9zaXRpb25hbCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGFzSW50KF9xdWVyeS51cGRhdGVBbGwoX3Bvc2l0aW9u\nYWwudG9BcnJheSgpKSk7CiAgICAgICAgICAgIGlmIChfbmFtZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBhc0ludChfcXVlcnkudXBkYXRl\nQWxsKF9uYW1lZCkpOwogICAgICAgICAgICByZXR1cm4gYXNJbnQoX3F1ZXJ5\nLnVwZGF0ZUFsbCgpKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90LXVwZGF0ZS1kZWxl\ndGUtcXVlcnkiLAogICAgICAgICAgICBfcXVlcnkuZ2V0UXVlcnlTdHJpbmco\nKSksIG51bGwsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENhc3QgdGhlIHNwZWNpZmllZCBsb25nIGRvd24gdG8gYW4gaW50LCBmaXJz\ndCBjaGVja2luZyBmb3Igb3ZlcmZsb3cuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGludCBhc0ludChsb25nIGwpIHsKICAgICAgICBpZiAobCA+IElu\ndGVnZXIuTUFYX1ZBTFVFKQogICAgICAgICAgICByZXR1cm4gSW50ZWdlci5N\nQVhfVkFMVUU7CiAgICAgICAgaWYgKGwgPCBJbnRlZ2VyLk1JTl9WQUxVRSkg\nLy8gdW5saWtlbHksIGJ1dCB3ZSBtaWdodCBhcyB3ZWxsIGNoZWNrCiAgICAg\nICAgICAgIHJldHVybiBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgICAgICByZXR1\ncm4gKGludCkgbDsKICAgIH0KCiAgICBwdWJsaWMgRmx1c2hNb2RlVHlwZSBn\nZXRGbHVzaE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIEVudGl0eU1hbmFnZXJJ\nbXBsLmZyb21GbHVzaEJlZm9yZVF1ZXJpZXMoX3F1ZXJ5LgogICAgICAgICAg\nICBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKS5nZXRGbHVzaEJlZm9yZVF1ZXJp\nZXMoKSk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRGbHVz\naE1vZGUoRmx1c2hNb2RlVHlwZSBmbHVzaE1vZGUpIHsKICAgICAgICBfZW0u\nYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpLnNldEZsdXNoQmVmb3JlUXVlcmllcwogICAg\nICAgICAgICAoRW50aXR5TWFuYWdlckltcGwudG9GbHVzaEJlZm9yZVF1ZXJp\nZXMoZmx1c2hNb2RlKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cgog\nICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRIaW50KFN0cmluZyBrZXksIE9i\namVjdCB2YWx1ZSkgewogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9r\nZWQoKTsKICAgICAgICBpZiAoa2V5ID09IG51bGwgfHwgIWtleS5zdGFydHNX\naXRoKCJvcGVuanBhLiIpKQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICBTdHJpbmcgayA9IGtleS5zdWJzdHJpbmcoIm9wZW5qcGEuIi5sZW5n\ndGgoKSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgiU3ViY2xh\nc3NlcyIuZXF1YWxzKGspKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUg\naW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgdmFsdWUg\nPSBCb29sZWFuLnZhbHVlT2YoKFN0cmluZykgdmFsdWUpOwogICAgICAgICAg\nICAgICAgc2V0U3ViY2xhc3NlcygoKEJvb2xlYW4pIHZhbHVlKS5ib29sZWFu\nVmFsdWUoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIkZpbHRlckxpc3Rl\nbmVyIi5lcXVhbHMoaykpCiAgICAgICAgICAgICAgICBhZGRGaWx0ZXJMaXN0\nZW5lcihGaWx0ZXJzLmhpbnRUb0ZpbHRlckxpc3RlbmVyKHZhbHVlLAogICAg\nICAgICAgICAgICAgICAgIF9xdWVyeS5nZXRCcm9rZXIoKS5nZXRDbGFzc0xv\nYWRlcigpKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKCJGaWx0ZXJMaXN0ZW5l\ncnMiLmVxdWFscyhrKSkgewogICAgICAgICAgICAgICAgRmlsdGVyTGlzdGVu\nZXJbXSBhcnIgPSBGaWx0ZXJzLmhpbnRUb0ZpbHRlckxpc3RlbmVycyh2YWx1\nZSwKICAgICAgICAgICAgICAgICAgICBfcXVlcnkuZ2V0QnJva2VyKCkuZ2V0\nQ2xhc3NMb2FkZXIoKSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBh\nZGRGaWx0ZXJMaXN0ZW5lcihhcnJbaV0pOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKCJBZ2dyZWdhdGVMaXN0ZW5lciIuZXF1YWxzKGspKQogICAgICAgICAg\nICAgICAgYWRkQWdncmVnYXRlTGlzdGVuZXIoRmlsdGVycy5oaW50VG9BZ2dy\nZWdhdGVMaXN0ZW5lcih2YWx1ZSwKICAgICAgICAgICAgICAgICAgICBfcXVl\ncnkuZ2V0QnJva2VyKCkuZ2V0Q2xhc3NMb2FkZXIoKSkpOwogICAgICAgICAg\nICBlbHNlIGlmICgiRmlsdGVyTGlzdGVuZXJzIi5lcXVhbHMoaykpIHsKICAg\nICAgICAgICAgICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyW10gYXJyID0gRmlsdGVy\ncy5oaW50VG9BZ2dyZWdhdGVMaXN0ZW5lcnMKICAgICAgICAgICAgICAgICAg\nICAodmFsdWUsIF9xdWVyeS5nZXRCcm9rZXIoKS5nZXRDbGFzc0xvYWRlcigp\nKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGFkZEFnZ3JlZ2F0ZUxp\nc3RlbmVyKGFycltpXSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoay5zdGFy\ndHNXaXRoKCJGZXRjaFBsYW4uIikpIHsKICAgICAgICAgICAgICAgIGsgPSBr\nLnN1YnN0cmluZygiRmV0Y2hQbGFuLiIubGVuZ3RoKCkpOwogICAgICAgICAg\nICAgICAgaGludFRvU2V0dGVyKGdldEZldGNoUGxhbigpLCBrLCB2YWx1ZSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoay5zdGFydHNXaXRoKCJoaW50LiIp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoImhpbnQuT3B0aW1pemVSZXN1bHRD\nb3VudCIuZXF1YWxzKGspKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZh\nbHVlIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9\nIG5ldyBJbnRlZ2VyKChTdHJpbmcpIHZhbHVlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0aW9uIG5mZSkg\newogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghKHZhbHVlIGluc3RhbmNl\nb2YgTnVtYmVyKSAKICAgICAgICAgICAgICAgICAgICAgICAgfHwgKChOdW1i\nZXIpIHZhbHVlKS5pbnRWYWx1ZSgpIDwgMCkKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAoImJhZC1xdWVyeS1oaW50LXZh\nbHVlIiwga2V5LCB2YWx1ZSksIG51bGwsIG51bGwsIAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgX3F1ZXJ5LmdldEZldGNoQ29uZmlndXJhdGlvbigpLnNl\ndEhpbnQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtcXVlcnktaGludCIsIGtleSksCiAgICAgICAg\nICAgICAgICAgICAgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0aHJvdyBQZXJzaXN0ZW5jZUV4Y2VwdGlvbnMudG9QZXJz\naXN0ZW5jZUV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGhpbnRUb1NldHRlcihGZXRjaFBsYW4gZmV0Y2hQbGFuLCBT\ndHJpbmcgaywgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgaWYgKGZldGNoUGxh\nbiA9PSBudWxsIHx8IGsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBNZXRob2Qgc2V0dGVyID0gUmVmbGVjdGlvbi5maW5kU2V0dGVy\nKGZldGNoUGxhbi5nZXRDbGFzcygpLCBrLCB0cnVlKTsKICAgICAgICBDbGFz\ncyBwYXJhbVR5cGUgPSBzZXR0ZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKVswXTsK\nICAgICAgICBpZiAoRW51bS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHBhcmFt\nVHlwZSkgJiYgdmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAg\nIHZhbHVlID0gRW51bS52YWx1ZU9mKHBhcmFtVHlwZSwgKFN0cmluZykgdmFs\ndWUpOwogICAgICAgIAogICAgICAgIEZpbHRlcnMuaGludFRvU2V0dGVyKGZl\ndGNoUGxhbiwgaywgdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBB\nUXVlcnkgc2V0UGFyYW1ldGVyKGludCBwb3NpdGlvbiwgQ2FsZW5kYXIgdmFs\ndWUsCiAgICAgICAgVGVtcG9yYWxUeXBlIHQpIHsKICAgICAgICByZXR1cm4g\nc2V0UGFyYW1ldGVyKHBvc2l0aW9uLCB2YWx1ZSk7CiAgICB9CgogICAgcHVi\nbGljIE9wZW5KUEFRdWVyeSBzZXRQYXJhbWV0ZXIoaW50IHBvc2l0aW9uLCBE\nYXRlIHZhbHVlLAogICAgICAgIFRlbXBvcmFsVHlwZSB0eXBlKSB7CiAgICAg\nICAgcmV0dXJuIHNldFBhcmFtZXRlcihwb3NpdGlvbiwgdmFsdWUpOwogICAg\nfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgc2V0UGFyYW1ldGVyKGludCBw\nb3NpdGlvbiwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgX3F1ZXJ5LmFzc2Vy\ndE9wZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7\nCiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBub3QgYWxsb3dlZCB0byBtaXggcG9zaXRpb25hbCBhbmQgbmFt\nZWQgcGFyYW1ldGVycyAoRURSMiAzLjYuNCkKICAgICAgICAgICAgaWYgKF9u\nYW1lZCAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICgibm8tcG9zLW5hbWVkLXBhcmFtcy1taXgiLCBfcXVlcnkuZ2V0UXVlcnlT\ndHJpbmcoKSksCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCwgZmFs\nc2UpOwoKICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICAgICAoImlsbGVnYWwtaW5kZXgiLCBwb3Np\ndGlvbiksIG51bGwsIG51bGwsIGZhbHNlKTsKCiAgICAgICAgICAgIGlmIChf\ncG9zaXRpb25hbCA9PSBudWxsKQogICAgICAgICAgICAgICAgX3Bvc2l0aW9u\nYWwgPSBuZXcgQXJyYXlMaXN0KCk7CgogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgaXQgaXMgYXQgbGVhc3QgdGhlIHJlcXVlc3RlZCBzaXplCiAgICAgICAg\nICAgIHdoaWxlIChfcG9zaXRpb25hbC5zaXplKCkgPCBwb3NpdGlvbikKICAg\nICAgICAgICAgICAgIF9wb3NpdGlvbmFsLmFkZChudWxsKTsKCiAgICAgICAg\nICAgIC8vIG5vdGUgdGhhdCB3ZSBhZGQgaXQgdG8gcG9zaXRpb24gLSAxLCBz\naW5jZSBzZXRQb3NpdGlvbgogICAgICAgICAgICAvLyBzdGFydHMgYXQgMSwg\nd2hpbGUgTGlzdCBzdGFydHMgYXQgMAogICAgICAgICAgICBfcG9zaXRpb25h\nbC5zZXQocG9zaXRpb24gLSAxLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVy\neS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9wZW5K\nUEFRdWVyeSBzZXRQYXJhbWV0ZXIoU3RyaW5nIG5hbWUsIENhbGVuZGFyIHZh\nbHVlLAogICAgICAgIFRlbXBvcmFsVHlwZSB0KSB7CiAgICAgICAgcmV0dXJu\nIHNldFBhcmFtZXRlcihuYW1lLCB2YWx1ZSk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFRdWVyeSBzZXRQYXJhbWV0ZXIoU3RyaW5nIG5hbWUsIERhdGUg\ndmFsdWUsCiAgICAgICAgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICBy\nZXR1cm4gc2V0UGFyYW1ldGVyKG5hbWUsIHZhbHVlKTsKICAgIH0KCiAgICBw\ndWJsaWMgT3BlbkpQQVF1ZXJ5IHNldFBhcmFtZXRlcihTdHJpbmcgbmFtZSwg\nT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgX3F1ZXJ5LmFzc2VydE9wZW4oKTsK\nICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAg\nX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBu\nb3QgYWxsb3dlZCB0byBtaXggcG9zaXRpb25hbCBhbmQgbmFtZWQgcGFyYW1l\ndGVycyAoRURSMiAzLjYuNCkKICAgICAgICAgICAgaWYgKF9wb3NpdGlvbmFs\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJu\nby1wb3MtbmFtZWQtcGFyYW1zLW1peCIsIF9xdWVyeS5nZXRRdWVyeVN0cmlu\nZygpKSwKICAgICAgICAgICAgICAgICAgICBudWxsLCBudWxsLCBmYWxzZSk7\nCgogICAgICAgICAgICBpZiAoX25hbWVkID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfbmFtZWQgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBfbmFt\nZWQucHV0KG5hbWUsIHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQ\nb3NpdGlvbmFsUGFyYW1ldGVycygpIHsKICAgICAgICByZXR1cm4gX3Bvc2l0\naW9uYWwgIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZ2V0\nUG9zaXRpb25hbFBhcmFtZXRlcnMoKSB7CiAgICAgICAgX3F1ZXJ5LmxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9wb3NpdGlv\nbmFsID09IG51bGwpID8gRU1QVFlfQVJSQVkgOiBfcG9zaXRpb25hbC50b0Fy\ncmF5KCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5\nLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQ\nQVF1ZXJ5IHNldFBhcmFtZXRlcnMoT2JqZWN0Li4uIHBhcmFtcykgewogICAg\nICAgIF9xdWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2VtLmFzc2VydE5v\ndENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgX3Bvc2l0aW9uYWwgPSBudWxsOwogICAg\nICAgICAgICBfbmFtZWQgPSBudWxsOwogICAgICAgICAgICBpZiAocGFyYW1z\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBzZXRQ\nYXJhbWV0ZXIoaSArIDEsIHBhcmFtc1tpXSk7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVy\neS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE1hcCBn\nZXROYW1lZFBhcmFtZXRlcnMoKSB7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9uYW1lZCA9PSBu\ndWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX01BUAogICAgICAgICAgICAgICAg\nOiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVNYXAoX25hbWVkKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgc2V0UGFy\nYW1ldGVycyhNYXAgcGFyYW1zKSB7CiAgICAgICAgX3F1ZXJ5LmFzc2VydE9w\nZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAg\nICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBfcG9zaXRpb25hbCA9IG51bGw7CiAgICAgICAgICAgIF9uYW1lZCA9IG51\nbGw7CiAgICAgICAgICAgIGlmIChwYXJhbXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGZvciAoTWFwLkVudHJ5IGUgOiAoU2V0PE1hcC5FbnRyeT4pIHBh\ncmFtcy5lbnRyeVNldCgpKQogICAgICAgICAgICAgICAgICAgIHNldFBhcmFt\nZXRlcigoU3RyaW5nKSBlLmdldEtleSgpLCBlLmdldFZhbHVlKCkpOwogICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBPcGVuSlBBUXVlcnkgY2xvc2VBbGwoKSB7CiAgICAgICAgX3F1\nZXJ5LmNsb3NlQWxsKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlvbnMoTWFwIHBh\ncmFtcykgewogICAgICAgIHJldHVybiBfcXVlcnkuZ2V0RGF0YVN0b3JlQWN0\naW9ucyhwYXJhbXMpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgaGFzaENvZGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5oYXNoQ29kZSgpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAg\nICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBRdWVyeUltcGwp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9x\ndWVyeS5lcXVhbHMoKChRdWVyeUltcGwpIG90aGVyKS5fcXVlcnkpOwoJfQp9\nCg==\n","encoding":"base64"}

