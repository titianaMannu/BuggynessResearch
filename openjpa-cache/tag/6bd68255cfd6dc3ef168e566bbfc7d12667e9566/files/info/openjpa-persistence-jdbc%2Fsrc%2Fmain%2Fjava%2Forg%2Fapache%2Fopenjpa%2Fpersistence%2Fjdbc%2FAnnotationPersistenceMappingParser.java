{"sha":"8c29b2c2111dbe9f4bb99bdf3430a9747ebe63f6","node_id":"MDQ6QmxvYjIwNjM2NDo4YzI5YjJjMjExMWRiZTlmNGJiOTliZGYzNDMwYTk3NDdlYmU2M2Y2","size":52581,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8c29b2c2111dbe9f4bb99bdf3430a9747ebe63f6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zcWwu\nVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuQXNzb2NpYXRpb25PdmVycmlkZTsKaW1w\nb3J0IGphdmF4LnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3ZlcnJpZGVzOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3ZlcnJpZGU7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5BdHRyaWJ1dGVPdmVycmlkZXM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRGlzY3JpbWluYXRvclZhbHVlOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW50aXR5UmVzdWx0OwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5FbnVtZXJhdGVkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRS\nZXN1bHQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5jZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkpvaW5Db2x1bW47CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Kb2luQ29sdW1uczsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkpvaW5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLlByaW1hcnlLZXlKb2luQ29sdW1uOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuUHJpbWFyeUtleUpvaW5Db2x1bW5zOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuU2Vjb25kYXJ5VGFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5TZWNvbmRhcnlUYWJsZXM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5T\ncWxSZXN1bHRTZXRNYXBwaW5nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nU3FsUmVzdWx0U2V0TWFwcGluZ3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlRhYmxlR2VuZXJh\ndG9yOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWw7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5VbmlxdWVDb25zdHJhaW50OwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5FYWdl\nckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuQ2xhc3NNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9z\naXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1\nZXJ5UmVzdWx0TWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuU2VxdWVuY2VNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5FbnVtVmFs\ndWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuRmxhdENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5GdWxsQ2xhc3NTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZl\ncnRpY2FsQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5Bbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBh\ncnNlcjsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lz\ndGVuY2UuamRiYy5NYXBwaW5nVGFnLio7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoK\nLyoqCiAqIFBlcnNpc3RlbmNlIGFubm90YXRpb24gbWFwcGluZyBwYXJzZXIu\nCiAqCiAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgogKiBAYXV0aG9yIFN0ZXZl\nIEtpbQogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWFwcGluZ1BhcnNl\ncgogICAgZXh0ZW5kcyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBh\ncnNlciB7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFJVRSA9\nIDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGQUxTRSA9IDI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lz\ndGVuY2VNYXBwaW5nUGFyc2VyLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBNYXA8Q2xhc3MsIE1hcHBpbmdUYWc+IF90YWdzID0KICAgICAg\nICBuZXcgSGFzaE1hcDxDbGFzcywgTWFwcGluZ1RhZz4oKTsKCiAgICBzdGF0\naWMgewogICAgICAgIF90YWdzLnB1dChBc3NvY2lhdGlvbk92ZXJyaWRlLmNs\nYXNzLCBBU1NPQ19PVkVSUklERSk7CiAgICAgICAgX3RhZ3MucHV0KEFzc29j\naWF0aW9uT3ZlcnJpZGVzLmNsYXNzLCBBU1NPQ19PVkVSUklERVMpOwogICAg\nICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlkZS5jbGFzcywgQVRUUl9P\nVkVSUklERSk7CiAgICAgICAgX3RhZ3MucHV0KEF0dHJpYnV0ZU92ZXJyaWRl\ncy5jbGFzcywgQVRUUl9PVkVSUklERVMpOwogICAgICAgIF90YWdzLnB1dChq\nYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4uY2xhc3MsIENPTCk7CiAgICAgICAg\nX3RhZ3MucHV0KENvbHVtblJlc3VsdC5jbGFzcywgQ09MVU1OX1JFU1VMVCk7\nCiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0b3JDb2x1bW4uY2xhc3Ms\nIERJU0NSSU1fQ09MKTsKICAgICAgICBfdGFncy5wdXQoRGlzY3JpbWluYXRv\nclZhbHVlLmNsYXNzLCBESVNDUklNX1ZBTCk7CiAgICAgICAgX3RhZ3MucHV0\nKEVudGl0eVJlc3VsdC5jbGFzcywgRU5USVRZX1JFU1VMVCk7CiAgICAgICAg\nX3RhZ3MucHV0KEVudW1lcmF0ZWQuY2xhc3MsIEVOVU1FUkFURUQpOwogICAg\nICAgIF90YWdzLnB1dChGaWVsZFJlc3VsdC5jbGFzcywgRklFTERfUkVTVUxU\nKTsKICAgICAgICBfdGFncy5wdXQoSW5oZXJpdGFuY2UuY2xhc3MsIElOSEVS\nSVRBTkNFKTsKICAgICAgICBfdGFncy5wdXQoSm9pbkNvbHVtbi5jbGFzcywg\nSk9JTl9DT0wpOwogICAgICAgIF90YWdzLnB1dChKb2luQ29sdW1ucy5jbGFz\ncywgSk9JTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQoSm9pblRhYmxlLmNs\nYXNzLCBKT0lOX1RBQkxFKTsKICAgICAgICBfdGFncy5wdXQoUHJpbWFyeUtl\neUpvaW5Db2x1bW4uY2xhc3MsIFBLX0pPSU5fQ09MKTsKICAgICAgICBfdGFn\ncy5wdXQoUHJpbWFyeUtleUpvaW5Db2x1bW5zLmNsYXNzLCBQS19KT0lOX0NP\nTFMpOwogICAgICAgIF90YWdzLnB1dChTZWNvbmRhcnlUYWJsZS5jbGFzcywg\nU0VDT05EQVJZX1RBQkxFKTsKICAgICAgICBfdGFncy5wdXQoU2Vjb25kYXJ5\nVGFibGVzLmNsYXNzLCBTRUNPTkRBUllfVEFCTEVTKTsKICAgICAgICBfdGFn\ncy5wdXQoU3FsUmVzdWx0U2V0TWFwcGluZy5jbGFzcywgU1FMX1JFU1VMVF9T\nRVRfTUFQUElORyk7CiAgICAgICAgX3RhZ3MucHV0KFNxbFJlc3VsdFNldE1h\ncHBpbmdzLmNsYXNzLCBTUUxfUkVTVUxUX1NFVF9NQVBQSU5HUyk7CiAgICAg\nICAgX3RhZ3MucHV0KFRhYmxlLmNsYXNzLCBUQUJMRSk7CiAgICAgICAgX3Rh\nZ3MucHV0KFRlbXBvcmFsLmNsYXNzLCBURU1QT1JBTCk7CiAgICAgICAgX3Rh\nZ3MucHV0KFRhYmxlR2VuZXJhdG9yLmNsYXNzLCBUQUJMRV9HRU4pOwogICAg\nICAgIF90YWdzLnB1dChDbGFzc0NyaXRlcmlhLmNsYXNzLCBDTEFTU19DUklU\nKTsKICAgICAgICBfdGFncy5wdXQoQ29sdW1ucy5jbGFzcywgQ09MUyk7CiAg\nICAgICAgX3RhZ3MucHV0KENvbnRhaW5lclRhYmxlLmNsYXNzLCBDT05UQUlO\nRVJfVEFCTEUpOwogICAgICAgIF90YWdzLnB1dChEYXRhU3RvcmVJZENvbHVt\nbi5jbGFzcywgREFUQVNUT1JFX0lEX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0\nKERpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzcywgRElTQ1JJTV9TVFJBVCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVhZ2VyRmV0Y2hNb2RlLmNsYXNzLCBFQUdF\nUl9GRVRDSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudENsYXNz\nQ3JpdGVyaWEuY2xhc3MsIEVMRU1fQ0xBU1NfQ1JJVCk7CiAgICAgICAgX3Rh\nZ3MucHV0KEVsZW1lbnRGb3JlaWduS2V5LmNsYXNzLCBFTEVNX0ZLKTsKICAg\nICAgICBfdGFncy5wdXQoRWxlbWVudEluZGV4LmNsYXNzLCBFTEVNX0lOREVY\nKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEpvaW5Db2x1bW4uY2xhc3Ms\nIEVMRU1fSk9JTl9DT0wpOwogICAgICAgIF90YWdzLnB1dChFbGVtZW50Sm9p\nbkNvbHVtbnMuY2xhc3MsIEVMRU1fSk9JTl9DT0xTKTsKICAgICAgICBfdGFn\ncy5wdXQoRWxlbWVudE5vbnBvbHltb3JwaGljLmNsYXNzLCBFTEVNX05PTlBP\nTFkpOwogICAgICAgIF90YWdzLnB1dChFbWJlZGRlZE1hcHBpbmcuY2xhc3Ms\nIEVNQkVEREVEX01BUFBJTkcpOwogICAgICAgIF90YWdzLnB1dChGb3JlaWdu\nS2V5LmNsYXNzLCBGSyk7CiAgICAgICAgX3RhZ3MucHV0KEluZGV4LmNsYXNz\nLCBJTkRFWCk7CiAgICAgICAgX3RhZ3MucHV0KE1hcHBpbmdPdmVycmlkZS5j\nbGFzcywgTUFQUElOR19PVkVSUklERSk7CiAgICAgICAgX3RhZ3MucHV0KE1h\ncHBpbmdPdmVycmlkZXMuY2xhc3MsIE1BUFBJTkdfT1ZFUlJJREVTKTsKICAg\nICAgICBfdGFncy5wdXQoTm9ucG9seW1vcnBoaWMuY2xhc3MsIE5PTlBPTFkp\nOwogICAgICAgIF90YWdzLnB1dChPcmRlckNvbHVtbi5jbGFzcywgT1JERVJf\nQ09MKTsKICAgICAgICBfdGFncy5wdXQoU3RyYXRlZ3kuY2xhc3MsIFNUUkFU\nKTsKICAgICAgICBfdGFncy5wdXQoU3ViY2xhc3NGZXRjaE1vZGUuY2xhc3Ms\nIFNVQkNMQVNTX0ZFVENIX01PREUpOwogICAgICAgIF90YWdzLnB1dChVbmlx\ndWUuY2xhc3MsIFVOSVFVRSk7CiAgICAgICAgX3RhZ3MucHV0KFZlcnNpb25D\nb2x1bW4uY2xhc3MsIFZFUlNJT05fQ09MKTsKICAgICAgICBfdGFncy5wdXQo\nVmVyc2lvbkNvbHVtbnMuY2xhc3MsIFZFUlNJT05fQ09MUyk7CiAgICAgICAg\nX3RhZ3MucHV0KFZlcnNpb25TdHJhdGVneS5jbGFzcywgVkVSU0lPTl9TVFJB\nVCk7CiAgICAgICAgX3RhZ3MucHV0KFhKb2luQ29sdW1uLmNsYXNzLCBYX0pP\nSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoWEpvaW5Db2x1bW5zLmNsYXNz\nLCBYX0pPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KFhTZWNvbmRhcnlU\nYWJsZS5jbGFzcywgWF9TRUNPTkRBUllfVEFCTEUpOwogICAgICAgIF90YWdz\nLnB1dChYU2Vjb25kYXJ5VGFibGVzLmNsYXNzLCBYX1NFQ09OREFSWV9UQUJM\nRVMpOwogICAgICAgIF90YWdzLnB1dChYVGFibGUuY2xhc3MsIFhfVEFCTEUp\nOwogICAgfQoKICAgIHB1YmxpYyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNYXBw\naW5nUGFyc2VyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICBz\ndXBlcihjb25mKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCB2b2lkIHBhcnNlUGFja2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhQYWNrYWdl\nIHBrZykgewogICAgICAgIE1hcHBpbmdUYWcgdGFnOwogICAgICAgIGZvciAo\nQW5ub3RhdGlvbiBhbm5vIDogcGtnLmdldERlY2xhcmVkQW5ub3RhdGlvbnMo\nKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0\naW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBoYW5kbGVVbmtub3duUGFja2FnZU1hcHBpbmdBbm5v\ndGF0aW9uKHBrZywgYW5ubyk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgVEFCTEVfR0VOOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlVGFibGVHZW5lcmF0b3IocGtnLCAoVGFibGVHZW5lcmF0b3Ip\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVkIiwg\ncGtnLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3Rh\ndGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVu\na25vd25QYWNrYWdlTWFwcGluZ0Fubm90YXRpb24oUGFja2FnZSBwa2csCiAg\nICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFRhYmxlR2VuZXJhdG9y\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VUYWJsZUdlbmVyYXRv\ncihBbm5vdGF0ZWRFbGVtZW50IGVsLCBUYWJsZUdlbmVyYXRvciBnZW4pIHsK\nICAgICAgICBTdHJpbmcgbmFtZSA9IGdlbi5uYW1lKCk7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tZ2VuLW5hbWUi\nLCBlbCkpOwoKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJh\nY2UoX2xvYy5nZXQoInBhcnNlLWdlbiIsIG5hbWUpKTsKCiAgICAgICAgU2Vx\ndWVuY2VNYXBwaW5nIG1ldGEgPSAoU2VxdWVuY2VNYXBwaW5nKSBnZXRSZXBv\nc2l0b3J5KCkuCiAgICAgICAgICAgIGdldENhY2hlZFNlcXVlbmNlTWV0YURh\ndGEobmFtZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KCJkdXAtZ2VuIiwgbmFtZSwgZWwpKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbWV0YSA9IChT\nZXF1ZW5jZU1hcHBpbmcpIGdldFJlcG9zaXRvcnkoKS5hZGRTZXF1ZW5jZU1l\ndGFEYXRhKG5hbWUpOwogICAgICAgIG1ldGEuc2V0U2VxdWVuY2VQbHVnaW4o\nU2VxdWVuY2VNYXBwaW5nLklNUExfVkFMVUVfVEFCTEUpOwogICAgICAgIG1l\ndGEuc2V0VGFibGUodG9UYWJsZU5hbWUoZ2VuLnNjaGVtYSgpLCBnZW4udGFi\nbGUoKSkpOwogICAgICAgIG1ldGEuc2V0UHJpbWFyeUtleUNvbHVtbihnZW4u\ncGtDb2x1bW5OYW1lKCkpOwogICAgICAgIG1ldGEuc2V0U2VxdWVuY2VDb2x1\nbW4oZ2VuLnZhbHVlQ29sdW1uTmFtZSgpKTsKICAgICAgICBtZXRhLnNldFBy\naW1hcnlLZXlWYWx1ZShnZW4ucGtDb2x1bW5WYWx1ZSgpKTsKICAgICAgICBt\nZXRhLnNldEluaXRpYWxWYWx1ZShnZW4uaW5pdGlhbFZhbHVlKCkpOwogICAg\nICAgIG1ldGEuc2V0QWxsb2NhdGUoZ2VuLmFsbG9jYXRpb25TaXplKCkpOwog\nICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGlu\nc3RhbmNlb2YgQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICBtZXRh\nLlNSQ19BTk5PVEFUSU9OUyk7CgogICAgICAgIC8vIyMjIEVKQjMKICAgICAg\nICBpZiAoZ2VuLnVuaXF1ZUNvbnN0cmFpbnRzKCkubGVuZ3RoID4gMCAmJiBs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldCgidW5pcXVlLWNvbnN0cmFpbnRzIiwgbmFtZSkpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VDbGFzc01hcHBp\nbmdBbm5vdGF0aW9ucyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgY20gPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgICAg\nIENsYXNzIGNscyA9IGNtLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAg\nTWFwcGluZ1RhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8g\nOiBjbHMuZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAg\nIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAg\nICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGhh\nbmRsZVVua25vd25DbGFzc01hcHBpbmdBbm5vdGF0aW9uKGNtLCBhbm5vKTsK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBB\nU1NPQ19PVkVSUklERToKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29j\naWF0aW9uT3ZlcnJpZGVzKGNtLCAoQXNzb2NpYXRpb25PdmVycmlkZSkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEFTU09DX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBw\nYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKGNtLCAoKEFzc29jaWF0aW9uT3Zl\ncnJpZGVzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEFUVFJfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VBdHRyaWJ1dGVPdmVycmlkZXMoY20sIChBdHRyaWJ1dGVPdmVycmlkZSkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEFUVFJfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKGNtLCAoKEF0dHJpYnV0ZU92ZXJy\naWRlcykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBESVNDUklNX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZURp\nc2NyaW1pbmF0b3JDb2x1bW4oY20sIChEaXNjcmltaW5hdG9yQ29sdW1uKSBh\nbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgRElTQ1JJTV9WQUw6CiAgICAgICAgICAgICAgICAgICAgY20u\nZ2V0RGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJbmZvKCkuc2V0VmFsdWUK\nICAgICAgICAgICAgICAgICAgICAgICAgKCgoRGlzY3JpbWluYXRvclZhbHVl\nKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9k\naWZpZXIuaXNBYnN0cmFjdChjbS5nZXREZXNjcmliZWRUeXBlKCkuCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBnZXRNb2RpZmllcnMoKSkgJiYgZ2V0\nTG9nKCkuaXNJbmZvRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGdldExvZygpLmluZm8oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBfbG9jLmdldCgiZGlzY3JpbWluYXRvci1vbi1hYnN0cmFjdC1jbGFzcyIs\nIGNtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRE\nZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBJTkhFUklUQU5DRToKICAgICAgICAgICAgICAgICAgICBwYXJz\nZUluaGVyaXRhbmNlKGNtLCAoSW5oZXJpdGFuY2UpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQS19K\nT0lOX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVByaW1hcnlLZXlK\nb2luQ29sdW1ucyhjbSwgKFByaW1hcnlLZXlKb2luQ29sdW1uKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgUEtfSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUHJp\nbWFyeUtleUpvaW5Db2x1bW5zKGNtLAogICAgICAgICAgICAgICAgICAgICAg\nICAoKFByaW1hcnlLZXlKb2luQ29sdW1ucykgYW5ubykuCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VDT05EQVJZX1RBQkxF\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU2Vjb25kYXJ5VGFibGVzKGNt\nLCAoU2Vjb25kYXJ5VGFibGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRUNPTkRBUllfVEFCTEVT\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU2Vjb25kYXJ5VGFibGVzKGNt\nLCAoKFNlY29uZGFyeVRhYmxlcykgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNRTF9S\nRVNVTFRfU0VUX01BUFBJTkc6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VT\nUUxSZXN1bHRTZXRNYXBwaW5ncyhjbSwgKFNxbFJlc3VsdFNldE1hcHBpbmcp\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBTUUxfUkVTVUxUX1NFVF9NQVBQSU5HUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZVNRTFJlc3VsdFNldE1hcHBpbmdzKGNtLCAoKFNx\nbFJlc3VsdFNldE1hcHBpbmdzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAg\nICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlVGFibGUoY20sIChUYWJsZSkgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFX0dFTjoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZVRhYmxlR2VuZXJhdG9yKGNscywg\nKFRhYmxlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREFUQVNUT1JFX0lEX0NPTDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZURhdGFTdG9yZUlkQ29sdW1uKGNt\nLCAoRGF0YVN0b3JlSWRDb2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBESVNDUklNX1NUUkFU\nOgogICAgICAgICAgICAgICAgICAgIGNtLmdldERpc2NyaW1pbmF0b3IoKS5n\nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5CiAgICAgICAgICAgICAgICAg\nICAgICAgICgoKERpc2NyaW1pbmF0b3JTdHJhdGVneSkgYW5ubykudmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEZLOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRm9yZWlnbktl\neShjbS5nZXRNYXBwaW5nSW5mbygpLCAoRm9yZWlnbktleSkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIE1BUFBJTkdfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VN\nYXBwaW5nT3ZlcnJpZGVzKGNtLCAoTWFwcGluZ092ZXJyaWRlKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgTUFQUElOR19PVkVSUklERVM6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLAogICAgICAgICAgICAgICAgICAgICAg\nICAoKE1hcHBpbmdPdmVycmlkZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVFJB\nVDoKICAgICAgICAgICAgICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNl\ndFN0cmF0ZWd5KCgoU3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVUJD\nTEFTU19GRVRDSF9NT0RFOgogICAgICAgICAgICAgICAgICAgIGNtLnNldFN1\nYmNsYXNzRmV0Y2hNb2RlKHRvRWFnZXJGZXRjaE1vZGVDb25zdGFudAogICAg\nICAgICAgICAgICAgICAgICAgICAoKChTdWJjbGFzc0ZldGNoTW9kZSkgYW5u\nbykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBWRVJTSU9OX0NPTDoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZVZlcnNpb25Db2x1bW5zKGNtLCAoVmVyc2lvbkNvbHVtbikg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFZFUlNJT05fQ09MUzoKICAgICAgICAgICAgICAgICAgICBw\nYXJzZVZlcnNpb25Db2x1bW5zKGNtLCAoKFZlcnNpb25Db2x1bW5zKSBhbm5v\nKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgVkVSU0lPTl9TVFJBVDoKICAgICAgICAgICAgICAg\nICAgICBjbS5nZXRWZXJzaW9uKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRTdHJh\ndGVneQogICAgICAgICAgICAgICAgICAgICAgICAoKChWZXJzaW9uU3RyYXRl\nZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBYX1RBQkxFOgogICAgICAgICAgICAg\nICAgY2FzZSBYX1NFQ09OREFSWV9UQUJMRToKICAgICAgICAgICAgICAgIGNh\nc2UgWF9TRUNPTkRBUllfVEFCTEVTOgogICAgICAgICAgICAgICAgICAgIC8v\nIG5vIGJyZWFrOyBub3Qgc3VwcG9ydGVkIHlldAogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBw\nb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVkIiwgY20sCiAg\nICAgICAgICAgICAgICAgICAgICAgIGFubm8pKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHN1YmNsYXNz\nZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25DbGFzc01hcHBpbmdB\nbm5vdGF0aW9uKENsYXNzTWFwcGluZyBjbHMsCiAgICAgICAgQW5ub3RhdGlv\nbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgQEFzc29jaWF0aW9uT3ZlcnJpZGUocykuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVz\nKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBBc3NvY2lhdGlvbk92ZXJyaWRl\nLi4uIGFzc29jcykgewogICAgICAgIEZpZWxkTWFwcGluZyBzdXA7CiAgICAg\nICAgSm9pbkNvbHVtbltdIHNjb2xzOwogICAgICAgIGludCB1bmlxdWU7CiAg\nICAgICAgTGlzdDxDb2x1bW4+IGpjb2xzOwogICAgICAgIGZvciAoQXNzb2Np\nYXRpb25PdmVycmlkZSBhc3NvYyA6IGFzc29jcykgewogICAgICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShhc3NvYy5uYW1lKCkpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1vdmVycmlkZS1uYW1lIiwgY20pKTsKICAgICAgICAgICAgc3VwID0g\nKEZpZWxkTWFwcGluZykgY20uZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChh\nc3NvYy5uYW1lKCkpOwogICAgICAgICAgICBpZiAoc3VwID09IG51bGwpCiAg\nICAgICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5hZGREZWZp\nbmVkU3VwZXJjbGFzc0ZpZWxkCiAgICAgICAgICAgICAgICAgICAgKGFzc29j\nLm5hbWUoKSwgT2JqZWN0LmNsYXNzLCBPYmplY3QuY2xhc3MpOwogICAgICAg\nICAgICBzY29scyA9IGFzc29jLmpvaW5Db2x1bW5zKCk7CiAgICAgICAgICAg\nIGlmIChzY29scyA9PSBudWxsIHx8IHNjb2xzLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBqY29scyA9IG5l\ndyBBcnJheUxpc3Q8Q29sdW1uPihzY29scy5sZW5ndGgpOwogICAgICAgICAg\nICB1bmlxdWUgPSAwOwogICAgICAgICAgICBmb3IgKEpvaW5Db2x1bW4gc2Nv\nbCA6IHNjb2xzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWUgfD0gKHNjb2wu\ndW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgICAgICAgICAgamNv\nbHMuYWRkKG5ld0NvbHVtbihzY29sKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgc2V0Q29sdW1ucyhzdXAsIHN1cC5nZXRWYWx1ZUluZm8oKSwgamNv\nbHMsIHVuaXF1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgQEF0dHJpYnV0ZU92ZXJyaWRlKHMpLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoQ2xhc3NNYXBwaW5n\nIGNtLAogICAgICAgIEF0dHJpYnV0ZU92ZXJyaWRlLi4uIGF0dHJzKSB7CiAg\nICAgICAgRmllbGRNYXBwaW5nIHN1cDsKICAgICAgICBmb3IgKEF0dHJpYnV0\nZU92ZXJyaWRlIGF0dHIgOiBhdHRycykgewogICAgICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuaXNFbXB0eShhdHRyLm5hbWUoKSkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW92\nZXJyaWRlLW5hbWUiLCBjbSkpOwogICAgICAgICAgICBzdXAgPSAoRmllbGRN\nYXBwaW5nKSBjbS5nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKGF0dHIubmFt\nZSgpKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uYWRkRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZChhdHRyLm5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIGlmIChh\ndHRyLmNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBwYXJzZUNv\nbHVtbnMoc3VwLCBhdHRyLmNvbHVtbigpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBpbmhlcml0YW5jZSBAUHJpbWFyeUtleUpv\naW5Db2x1bW4ocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBy\naW1hcnlLZXlKb2luQ29sdW1ucyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAg\nUHJpbWFyeUtleUpvaW5Db2x1bW4uLi4gam9pbnMpIHsKICAgICAgICBMaXN0\nPENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5s\nZW5ndGgpOwogICAgICAgIGZvciAoUHJpbWFyeUtleUpvaW5Db2x1bW4gam9p\nbiA6IGpvaW5zKQogICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9p\nbikpOwogICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhj\nb2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzY2hl\nbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5u\nb3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29sdW1uIG5l\nd0NvbHVtbihQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2luKSB7CiAgICAgICAg\nQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBjb2wuc2V0Rmxh\nZyhDb2x1bW4uRkxBR19QS19KT0lOLCB0cnVlKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoam9pbi5uYW1lKCkpKQogICAgICAgICAgICBj\nb2wuc2V0TmFtZShqb2luLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAg\nICAgICAgY29sLnNldE5hbWUoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVyZW5j\nZWRDb2x1bW5OYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFyZ2V0KGpv\naW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSk7CiAgICAgICAgcmV0dXJuIGNv\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBTZWNvbmRhcnlUYWJs\nZShzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlU2Vjb25kYXJ5\nVGFibGVzKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBTZWNvbmRhcnlUYWJs\nZS4uLiB0YWJsZXMpIHsKICAgICAgICBDbGFzc01hcHBpbmdJbmZvIGluZm8g\nPSBjbS5nZXRNYXBwaW5nSW5mbygpOwogICAgICAgIExvZyBsb2cgPSBnZXRM\nb2coKTsKCiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgTGlzdDxDb2x1\nbW4+IGpvaW5zOwogICAgICAgIGJvb2xlYW4gd2FyblVuaXF1ZSA9IGZhbHNl\nOwogICAgICAgIGZvciAoU2Vjb25kYXJ5VGFibGUgdGFibGUgOiB0YWJsZXMp\nIHsKICAgICAgICAgICAgbmFtZSA9IHRhYmxlLm5hbWUoKTsKICAgICAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInNl\nY29uZC1uYW1lIiwgY20pKTsKICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KHRhYmxlLnNjaGVtYSgpKSkKICAgICAgICAgICAgICAgIG5h\nbWUgPSB0YWJsZS5zY2hlbWEoKSArICIuIiArIG5hbWU7CiAgICAgICAgICAg\nIGlmICh0YWJsZS5wa0pvaW5Db2x1bW5zKCkubGVuZ3RoID4gMCkgewogICAg\nICAgICAgICAgICAgam9pbnMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4odGFi\nbGUucGtKb2luQ29sdW1ucygpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBm\nb3IgKFByaW1hcnlLZXlKb2luQ29sdW1uIGpvaW4gOiB0YWJsZS5wa0pvaW5D\nb2x1bW5zKCkpCiAgICAgICAgICAgICAgICAgICAgam9pbnMuYWRkKG5ld0Nv\nbHVtbihqb2luKSk7CiAgICAgICAgICAgICAgICBpbmZvLnNldFNlY29uZGFy\neVRhYmxlSm9pbkNvbHVtbnMobmFtZSwgam9pbnMpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHdhcm5VbmlxdWUgfD0gdGFibGUudW5pcXVlQ29uc3Ry\nYWludHMoKS5sZW5ndGggPiAwOwogICAgICAgIH0KCiAgICAgICAgLy8jIyMg\nRUpCMwogICAgICAgIGlmICh3YXJuVW5pcXVlICYmIGxvZy5pc1dhcm5FbmFi\nbGVkKCkpCiAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJ1bmlxdWUt\nY29uc3RyYWludHMiLCBjbSkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIGNsYXNzIHRhYmxlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VU\nYWJsZShDbGFzc01hcHBpbmcgY20sIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\nU3RyaW5nIHRhYmxlTmFtZSA9IHRvVGFibGVOYW1lKHRhYmxlLnNjaGVtYSgp\nLCB0YWJsZS5uYW1lKCkpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVs\nbCkKICAgICAgICAgICAgY20uZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZU5h\nbWUodGFibGVOYW1lKTsKCiAgICAgICAgZm9yIChVbmlxdWVDb25zdHJhaW50\nIHVuaXF1ZUNvbnN0cmFpbnQ6dGFibGUudW5pcXVlQ29uc3RyYWludHMoKSkg\newogICAgICAgICAgICBVbmlxdWUgdW5pcXVlID0gbmV3VW5pcXVlKGNtLCBu\ndWxsLCB1bmlxdWVDb25zdHJhaW50LmNvbHVtbk5hbWVzKCkpOwogICAgICAg\nICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLmFkZFVuaXF1ZSh1bmlxdWUpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZvcm0gYSBxdWFsaWZp\nZWQgdGFibGUgbmFtZSBmcm9tIGEgc2NoZW1hIGFuZCB0YWJsZSBuYW1lLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgdG9UYWJsZU5hbWUo\nU3RyaW5nIHNjaGVtYSwgU3RyaW5nIHRhYmxlKSB7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkodGFibGUpKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzY2hlbWEp\nKQogICAgICAgICAgICByZXR1cm4gdGFibGU7CiAgICAgICAgcmV0dXJuIHNj\naGVtYSArICIuIiArIHRhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2VzIHRoZSBnaXZlbiBhbm5vdGF0aW9uIHRvIGNyZWF0ZSBhbmQgY2FjaGUg\nYQogICAgICoge0BsaW5rIFNRTFJlc3VsdFNldE1hcHBpbmdNZXRhRGF0YX0u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVNRTFJlc3VsdFNldE1h\ncHBpbmdzKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBTcWxSZXN1bHRTZXRN\nYXBwaW5nLi4uIGFubm9zKSB7CiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkg\ncmVwb3MgPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGdldFJlcG9zaXRvcnkoKTsK\nICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgZm9yIChTcWxS\nZXN1bHRTZXRNYXBwaW5nIGFubm8gOiBhbm5vcykgewogICAgICAgICAgICBp\nZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cu\ndHJhY2UoX2xvYy5nZXQoInBhcnNlLXNxbHJzbWFwcGluZyIsIGFubm8ubmFt\nZSgpKSk7CgogICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcgcmVzdWx0\nID0gcmVwb3MuZ2V0Q2FjaGVkUXVlcnlSZXN1bHRNYXBwaW5nCiAgICAgICAg\nICAgICAgICAobnVsbCwgYW5uby5uYW1lKCkpOwogICAgICAgICAgICBpZiAo\ncmVzdWx0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNX\nYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9s\nb2MuZ2V0KCJkdXAtc3FscnNtYXBwaW5nIiwgYW5uby5uYW1lKCksIGNtKSk7\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcmVzdWx0ID0gcmVwb3MuYWRkUXVlcnlSZXN1bHRNYXBwaW5n\nKG51bGwsIGFubm8ubmFtZSgpKTsKICAgICAgICAgICAgcmVzdWx0LnNldFNv\ndXJjZShnZXRTb3VyY2VGaWxlKCksIGNtLmdldERlc2NyaWJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgIHJlc3VsdC5TUkNfQU5OT1RBVElPTlMpOwoKICAg\nICAgICAgICAgZm9yIChFbnRpdHlSZXN1bHQgZW50aXR5IDogYW5uby5lbnRp\ndGllcygpKSB7CiAgICAgICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcu\nUENSZXN1bHQgZW50aXR5UmVzdWx0ID0gcmVzdWx0LmFkZFBDUmVzdWx0CiAg\nICAgICAgICAgICAgICAgICAgKGVudGl0eS5lbnRpdHlDbGFzcygpKTsKICAg\nICAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShlbnRpdHku\nZGlzY3JpbWluYXRvckNvbHVtbigpKSkKICAgICAgICAgICAgICAgICAgICBl\nbnRpdHlSZXN1bHQuYWRkTWFwcGluZyhlbnRpdHlSZXN1bHQuRElTQ1JJTUlO\nQVRPUiwKICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5LmRpc2NyaW1p\nbmF0b3JDb2x1bW4oKSk7CgogICAgICAgICAgICAgICAgZm9yIChGaWVsZFJl\nc3VsdCBmaWVsZCA6IGVudGl0eS5maWVsZHMoKSkKICAgICAgICAgICAgICAg\nICAgICBlbnRpdHlSZXN1bHQuYWRkTWFwcGluZyhmaWVsZC5uYW1lKCksIGZp\nZWxkLmNvbHVtbigpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3Ig\nKENvbHVtblJlc3VsdCBjb2x1bW4gOiBhbm5vLmNvbHVtbnMoKSkKICAgICAg\nICAgICAgICAgIHJlc3VsdC5hZGRDb2x1bW5SZXN1bHQoY29sdW1uLm5hbWUo\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQERp\nc2NyaW1pbmF0b3JDb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZURpc2NyaW1pbmF0b3JDb2x1bW4oQ2xhc3NNYXBwaW5nIGNtLAogICAg\nICAgIERpc2NyaW1pbmF0b3JDb2x1bW4gZGNvbCkgewogICAgICAgIENvbHVt\nbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGRjb2wubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5h\nbWUoZGNvbC5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShkY29sLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNv\nbC5zZXRUeXBlTmFtZShkY29sLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAg\nICAgRGlzY3JpbWluYXRvciBkaXNjcmltID0gY20uZ2V0RGlzY3JpbWluYXRv\ncigpOwogICAgICAgIHN3aXRjaCAoZGNvbC5kaXNjcmltaW5hdG9yVHlwZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgQ0hBUjoKICAgICAgICAgICAgICAgIGNv\nbC5zZXRKYXZhVHlwZShKYXZhVHlwZXMuQ0hBUik7CiAgICAgICAgICAgICAg\nICBkaXNjcmltLnNldEphdmFUeXBlKEphdmFUeXBlcy5DSEFSKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIElOVEVHRVI6CiAg\nICAgICAgICAgICAgICBjb2wuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLklOVCk7\nCiAgICAgICAgICAgICAgICBpZiAoZGNvbC5sZW5ndGgoKSAhPSAzMSkKICAg\nICAgICAgICAgICAgICAgICBjb2wuc2V0U2l6ZShkY29sLmxlbmd0aCgpKTsK\nICAgICAgICAgICAgICAgIGRpc2NyaW0uc2V0SmF2YVR5cGUoSmF2YVR5cGVz\nLklOVCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShKYXZhVHlw\nZXMuU1RSSU5HKTsKICAgICAgICAgICAgICAgIGNvbC5zZXRTaXplKGRjb2wu\nbGVuZ3RoKCkpOwogICAgICAgICAgICAgICAgZGlzY3JpbS5zZXRKYXZhVHlw\nZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAgICB9CiAgICAgICAgY20uZ2V0\nRGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucwog\nICAgICAgICAgICAoQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1uW117IGNvbCB9\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBASW5oZXJpdGFuY2Uu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUluaGVyaXRhbmNlKENs\nYXNzTWFwcGluZyBjbSwgSW5oZXJpdGFuY2UgaW5oZXJpdCkgewogICAgICAg\nIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9IGNtLmdldE1hcHBpbmdJbmZvKCk7\nCiAgICAgICAgc3dpdGNoIChpbmhlcml0LnN0cmF0ZWd5KCkpIHsKICAgICAg\nICAgICAgY2FzZSBTSU5HTEVfVEFCTEU6CiAgICAgICAgICAgICAgICBpbmZv\nLnNldEhpZXJhcmNoeVN0cmF0ZWd5KEZsYXRDbGFzc1N0cmF0ZWd5LkFMSUFT\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEpP\nSU5FRDoKICAgICAgICAgICAgICAgIGluZm8uc2V0SGllcmFyY2h5U3RyYXRl\nZ3koVmVydGljYWxDbGFzc1N0cmF0ZWd5LkFMSUFTKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFRBQkxFX1BFUl9DTEFTUzoK\nICAgICAgICAgICAgICAgIGluZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koRnVs\nbENsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBjbGFzcy1sZXZlbCBATWFwcGluZ092ZXJyaWRl\nKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYXBwaW5nT3Zl\ncnJpZGVzKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBNYXBwaW5nT3ZlcnJp\nZGUuLi4gb3ZlcnMpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgc3VwOwogICAg\nICAgIGZvciAoTWFwcGluZ092ZXJyaWRlIG92ZXIgOiBvdmVycykgewogICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvdmVyLm5hbWUoKSkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLW92ZXJyaWRlLW5hbWUiLCBjbSkpOwogICAgICAgICAg\nICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5nZXREZWZpbmVkU3VwZXJjbGFz\nc0ZpZWxkKG92ZXIubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20u\nYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChvdmVyLm5hbWUoKSwKICAgICAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyk7CiAg\nICAgICAgICAgIHBvcHVsYXRlKHN1cCwgb3Zlcik7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUG9wdWxhdGUgdGhlIGdpdmVuIGZpZWxkIGZy\nb20gb3ZlcnJpZGUgZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBv\ncHVsYXRlKEZpZWxkTWFwcGluZyBmbSwgTWFwcGluZ092ZXJyaWRlIG92ZXIp\nIHsKICAgICAgICBpZiAob3Zlci5jb250YWluZXJUYWJsZSgpLnNwZWNpZmll\nZCgpKQogICAgICAgICAgICBwYXJzZUNvbnRhaW5lclRhYmxlKGZtLCBvdmVy\nLmNvbnRhaW5lclRhYmxlKCkpOwogICAgICAgIHBhcnNlQ29sdW1ucyhmbSwg\nb3Zlci5jb2x1bW5zKCkpOwogICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZt\nLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwgb3Zlci5qb2luQ29sdW1ucygp\nKTsKICAgICAgICBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhmbSwgb3Zlci5l\nbGVtZW50Sm9pbkNvbHVtbnMoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBkYXRhc3RvcmUgaWRlbnRpdHkgaW5mb3JtYXRpb24gaW4gQERhdGFT\ndG9yZUlkQ29sdW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VE\nYXRhU3RvcmVJZENvbHVtbihDbGFzc01hcHBpbmcgY20sIERhdGFTdG9yZUlk\nQ29sdW1uIGlkKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4o\nKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaWQubmFtZSgp\nKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoaWQubmFtZSgpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaWQuY29sdW1uRGVmaW5pdGlv\nbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKGlkLmNvbHVtbkRl\nZmluaXRpb24oKSk7CiAgICAgICAgaWYgKGlkLnByZWNpc2lvbigpICE9IDAp\nCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGlkLnByZWNpc2lvbigpKTsKICAg\nICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFp\nZC5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5G\nTEFHX1VOVVBEQVRBQkxFLCAhaWQudXBkYXRhYmxlKCkpOwogICAgICAgIGNt\nLmdldE1hcHBpbmdJbmZvKCkuc2V0Q29sdW1ucyhBcnJheXMuYXNMaXN0KG5l\ndyBDb2x1bW5bXXsgY29sIH0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIHRoZSBnaXZlbiBmb3JlaWduIGtleS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBhcnNlRm9yZWlnbktleShNYXBwaW5nSW5mbyBpbmZvLCBGb3Jl\naWduS2V5IGZrKSB7CiAgICAgICAgcGFyc2VGb3JlaWduS2V5KGluZm8sIGZr\nLm5hbWUoKSwgZmsuZW5hYmxlZCgpLCBmay5kZWZlcnJlZCgpLAogICAgICAg\nICAgICBmay5kZWxldGVBY3Rpb24oKSwgZmsudXBkYXRlQWN0aW9uKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IGZvcmVpZ24ga2V5IGRhdGEgb24g\ndGhlIGdpdmVuIG1hcHBpbmcgaW5mby4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgcGFyc2VGb3JlaWduS2V5KE1hcHBpbmdJbmZvIGluZm8sIFN0cmlu\nZyBuYW1lLAogICAgICAgIGJvb2xlYW4gZW5hYmxlZCwgYm9vbGVhbiBkZWZl\ncnJlZCwgRm9yZWlnbktleUFjdGlvbiBkZWxldGVBY3Rpb24sCiAgICAgICAg\nRm9yZWlnbktleUFjdGlvbiB1cGRhdGVBY3Rpb24pIHsKICAgICAgICBpZiAo\nIWVuYWJsZWQpIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5Gb3JlaWduS2V5\nKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkg\nZmsgPQogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZrLnNldE5hbWUobmFtZSk7\nCiAgICAgICAgZmsuc2V0RGVmZXJyZWQoZGVmZXJyZWQpOwogICAgICAgIGZr\nLnNldERlbGV0ZUFjdGlvbih0b0ZvcmVpZ25LZXlBY3Rpb24oZGVsZXRlQWN0\naW9uKSk7CiAgICAgICAgZmsuc2V0VXBkYXRlQWN0aW9uKHRvRm9yZWlnbktl\neUFjdGlvbih1cGRhdGVBY3Rpb24pKTsKICAgICAgICBpbmZvLnNldEZvcmVp\nZ25LZXkoZmspOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCBvdXIg\nRksgYWN0aW9uIGVudW0gdG8gYW4gaW50ZXJuYWwgT3BlbkpQQSBhY3Rpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHRvRm9yZWlnbktleUFjdGlvbihG\nb3JlaWduS2V5QWN0aW9uIGFjdGlvbikgewogICAgICAgIHN3aXRjaCAoYWN0\naW9uKSB7CiAgICAgICAgICAgIGNhc2UgUkVTVFJJQ1Q6CiAgICAgICAgICAg\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZv\ncmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUOwogICAgICAgICAgICBjYXNlIENB\nU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuQUNUSU9OX0NBU0NBREU7CiAg\nICAgICAgICAgIGNhc2UgTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleS5BQ1RJ\nT05fTlVMTDsKICAgICAgICAgICAgY2FzZSBERUZBVUxUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5G\nb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgdGhl\nIGdpdmVuIGluZGV4LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VJ\nbmRleChNYXBwaW5nSW5mbyBpbmZvLCBJbmRleCBpZHgpIHsKICAgICAgICBw\nYXJzZUluZGV4KGluZm8sIGlkeC5uYW1lKCksIGlkeC5lbmFibGVkKCksIGlk\neC51bmlxdWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgaW5kZXgg\nZGF0YSBvbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZvLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBwYXJzZUluZGV4KE1hcHBpbmdJbmZvIGluZm8sIFN0\ncmluZyBuYW1lLAogICAgICAgIGJvb2xlYW4gZW5hYmxlZCwgYm9vbGVhbiB1\nbmlxdWUpIHsKICAgICAgICBpZiAoIWVuYWJsZWQpIHsKICAgICAgICAgICAg\naW5mby5zZXRDYW5JbmRleChmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5JbmRleCBpZHggPQogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLkluZGV4KCk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBpZHguc2V0TmFt\nZShuYW1lKTsKICAgICAgICBpZHguc2V0VW5pcXVlKHVuaXF1ZSk7CiAgICAg\nICAgaW5mby5zZXRJbmRleChpZHgpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHVuaXF1ZSBkYXRhIG9uIHRoZSBnaXZlbiBtYXBwaW5nIGluZm8uCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVVuaXF1ZShGaWVsZE1hcHBp\nbmcgZm0sIAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5qZGJjLlVuaXF1ZSBhbm5vKSB7CiAgICAgICAgVmFsdWVNYXBwaW5nSW5m\nbyBpbmZvID0gZm0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgaWYgKCFhbm5v\nLmVuYWJsZWQoKSkgewogICAgICAgICAgICBpbmZvLnNldENhblVuaXF1ZShm\nYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWUgdW5xID0g\nCiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hl\nbWEuVW5pcXVlKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGFubm8ubmFtZSgpKSkKICAgICAgICAgICAgdW5xLnNldE5hbWUoYW5uby5u\nYW1lKCkpOwogICAgICAgIHVucS5zZXREZWZlcnJlZChhbm5vLmRlZmVycmVk\nKCkpOwogICAgICAgIGluZm8uc2V0VW5pcXVlKHVucSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAVmVyc2lvbkNvbHVtbihzKS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlVmVyc2lvbkNvbHVtbnMoQ2xhc3NNYXBw\naW5nIGNtLCBWZXJzaW9uQ29sdW1uLi4uIHZjb2xzKSB7CiAgICAgICAgaWYg\nKHZjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+\nKHZjb2xzLmxlbmd0aCk7CiAgICAgICAgZm9yIChWZXJzaW9uQ29sdW1uIHZj\nb2wgOiB2Y29scykKICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKHZj\nb2wpKTsKICAgICAgICBjbS5nZXRWZXJzaW9uKCkuZ2V0TWFwcGluZ0luZm8o\nKS5zZXRDb2x1bW5zKGNvbHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9t\nIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBDb2x1bW4gbmV3Q29sdW1uKFZlcnNpb25Db2x1bW4gYW5ubykgewog\nICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYg\nKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubmFtZSgpKSkKICAgICAgICAg\nICAgY29sLnNldE5hbWUoYW5uby5uYW1lKCkpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShhbm5vLmNvbHVtbkRlZmluaXRpb24oKSkpCiAg\nICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShhbm5vLmNvbHVtbkRlZmluaXRp\nb24oKSk7CiAgICAgICAgaWYgKGFubm8ucHJlY2lzaW9uKCkgIT0gMCkKICAg\nICAgICAgICAgY29sLnNldFNpemUoYW5uby5wcmVjaXNpb24oKSk7CiAgICAg\nICAgZWxzZSBpZiAoYW5uby5sZW5ndGgoKSAhPSAyNTUpCiAgICAgICAgICAg\nIGNvbC5zZXRTaXplKGFubm8ubGVuZ3RoKCkpOwogICAgICAgIGNvbC5zZXRO\nb3ROdWxsKCFhbm5vLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXREZWNp\nbWFsRGlnaXRzKGFubm8uc2NhbGUoKSk7CiAgICAgICAgY29sLnNldEZsYWco\nQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhYW5uby5pbnNlcnRhYmxlKCkp\nOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxF\nLCAhYW5uby51cGRhdGFibGUoKSk7CiAgICAgICAgcmV0dXJuIGNvbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRyYW5zbGF0ZSB0aGUgZmV0Y2ggbW9kZSBl\nbnVtIHZhbHVlIHRvIHRoZSBpbnRlcm5hbCBPcGVuSlBBIGNvbnN0YW50Lgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBpbnQgdG9FYWdlckZldGNoTW9k\nZUNvbnN0YW50KEZldGNoTW9kZSBtb2RlKSB7CiAgICAgICAgc3dpdGNoICht\nb2RlKSB7CiAgICAgICAgICAgIGNhc2UgTk9ORToKICAgICAgICAgICAgICAg\nIHJldHVybiBFYWdlckZldGNoTW9kZXMuRUFHRVJfTk9ORTsKICAgICAgICAg\nICAgY2FzZSBKT0lOOgogICAgICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0\nY2hNb2Rlcy5FQUdFUl9KT0lOOwogICAgICAgICAgICBjYXNlIFBBUkFMTEVM\nOgogICAgICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdF\nUl9QQVJBTExFTDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nTG9iTWFwcGluZyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIENvbHVt\nbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlNUUklORwogICAgICAgICAg\nICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAg\nICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0\nZXJbXS5jbGFzcykKICAgICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMuQ0xP\nQik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBl\ncy5CTE9CKTsKICAgICAgICAoKEZpZWxkTWFwcGluZykgZm1kKS5nZXRWYWx1\nZUluZm8oKS5zZXRDb2x1bW5zKEFycmF5cy5hc0xpc3QKICAgICAgICAgICAg\nKG5ldyBDb2x1bW5bXXsgY29sIH0pKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRp\nb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgRmllbGRNYXBwaW5n\nIGZtID0gKEZpZWxkTWFwcGluZykgZm1kOwogICAgICAgIEFubm90YXRlZEVs\nZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxlbWVudCkgZ2V0UmVwb3NpdG9yeSgp\nLgogICAgICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0\ncygpLmdldEJhY2tpbmdNZW1iZXIoZm1kKTsKCiAgICAgICAgTWFwcGluZ1Rh\nZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBlbC5nZXRE\nZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFnID0gX3Rh\nZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlm\nICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93\nbk1lbWJlck1hcHBpbmdBbm5vdGF0aW9uKGZtLCBhbm5vKTsKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBz\nd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBBU1NPQ19PVkVS\nUklERToKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0aW9uT3Zl\ncnJpZGVzKGZtLCAoQXNzb2NpYXRpb25PdmVycmlkZSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFT\nU09DX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29j\naWF0aW9uT3ZlcnJpZGVzKGZtLCAoKEFzc29jaWF0aW9uT3ZlcnJpZGVzKSBh\nbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFU\nVFJfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBdHRyaWJ1\ndGVPdmVycmlkZXMoZm0sIChBdHRyaWJ1dGVPdmVycmlkZSkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEFUVFJfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQXR0\ncmlidXRlT3ZlcnJpZGVzKGZtLCAoKEF0dHJpYnV0ZU92ZXJyaWRlcykgYW5u\nbykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDT0w6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VDb2x1bW5zKGZtLCAoamF2YXgu\ncGVyc2lzdGVuY2UuQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ09MUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUNvbHVtbnMoZm0sICgoQ29sdW1ucykgYW5ubyku\ndmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEVOVU1FUkFURUQ6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VFbnVtZXJhdGVkKGZtLCAoRW51bWVyYXRlZCkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpP\nSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlSm9pbkNvbHVtbnMo\nZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAgICAgICAg\nICAgICAgICAoSm9pbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fQ09MUzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRW\nYWx1ZUluZm8oKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgKChK\nb2luQ29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fVEFCTEU6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VKb2luVGFibGUoZm0sIChKb2luVGFi\nbGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBQS19KT0lOX0NPTDoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhmbSwgKFByaW1hcnlLZXlK\nb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgUEtfSk9JTl9DT0xTOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5zKGZtLAogICAg\nICAgICAgICAgICAgICAgICAgICAoKFByaW1hcnlLZXlKb2luQ29sdW1ucykg\nYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgVEFCTEVfR0VOOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVGFibGVH\nZW5lcmF0b3IoZWwsIChUYWJsZUdlbmVyYXRvcikgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRFTVBP\nUkFMOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVGVtcG9yYWwoZm0sIChU\nZW1wb3JhbCkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIENMQVNTX0NSSVQ6CiAgICAgICAgICAgICAg\nICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0ZXJpYQog\nICAgICAgICAgICAgICAgICAgICAgICAoKChDbGFzc0NyaXRlcmlhKSBhbm5v\nKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgQ09OVEFJTkVSX1RBQkxFOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlQ29udGFpbmVyVGFibGUoZm0sIChDb250YWluZXJUYWJs\nZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEVBR0VSX0ZFVENIX01PREU6CiAgICAgICAgICAgICAg\nICAgICAgZm0uc2V0RWFnZXJGZXRjaE1vZGUodG9FYWdlckZldGNoTW9kZUNv\nbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgoKEVhZ2VyRmV0Y2hN\nb2RlKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fQ0xBU1NfQ1JJVDoKICAg\nICAgICAgICAgICAgICAgICBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLnNldFVzZUNsYXNzQ3JpdGVyaWEKICAgICAgICAgICAgICAg\nICAgICAgICAgKCgoRWxlbWVudENsYXNzQ3JpdGVyaWEpIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBFTEVNX0ZLOgogICAgICAgICAgICAgICAgICAgIEVsZW1lbnRG\nb3JlaWduS2V5IGVmayA9IChFbGVtZW50Rm9yZWlnbktleSkgYW5ubzsKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUZvcmVpZ25LZXkoZm0uZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgZWZrLm5hbWUoKSwgZWZrLmVuYWJsZWQoKSwgZWZrLmRlZmVycmVk\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGVmay5kZWxldGVBY3Rpb24o\nKSwgZWZrLnVwZGF0ZUFjdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9JTkRFWDoKICAgICAg\nICAgICAgICAgICAgICBFbGVtZW50SW5kZXggZWlkeCA9IChFbGVtZW50SW5k\nZXgpIGFubm87CiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbmRleChmbS5n\nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLAogICAgICAgICAg\nICAgICAgICAgICAgICBlaWR4Lm5hbWUoKSwgZWlkeC5lbmFibGVkKCksIGVp\nZHgudW5pcXVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBFTEVNX0pPSU5fQ09MOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKGZtLCAoRWxlbWVudEpv\naW5Db2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBFTEVNX0pPSU5fQ09MUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhmbSwgKChFbGVt\nZW50Sm9pbkNvbHVtbnMpIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAg\nICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgRUxFTV9OT05QT0xZOgogICAgICAgICAgICAgICAg\nICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuc2V0UG9seW1vcnBoaWModG9Q\nb2x5bW9ycGhpY0NvbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgo\nKEVsZW1lbnROb25wb2x5bW9ycGhpYykgYW5ubykudmFsdWUoKSkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBF\nTUJFRERFRF9NQVBQSU5HOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRW1i\nZWRkZWRNYXBwaW5nKGZtLCAoRW1iZWRkZWRNYXBwaW5nKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRks6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5KGZtLmdl\ndFZhbHVlSW5mbygpLCAoRm9yZWlnbktleSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOREVYOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlSW5kZXgoZm0uZ2V0VmFsdWVJbmZv\nKCksIChJbmRleCkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIE5PTlBPTFk6CiAgICAgICAgICAgICAg\nICAgICAgZm0uc2V0UG9seW1vcnBoaWModG9Qb2x5bW9ycGhpY0NvbnN0YW50\nCiAgICAgICAgICAgICAgICAgICAgICAgICgoKE5vbnBvbHltb3JwaGljKSBh\nbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE9SREVSX0NPTDoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZU9yZGVyQ29sdW1uKGZtLCAoT3JkZXJDb2x1bW4pIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBTVFJBVDoKICAgICAgICAgICAgICAgICAgICBmbS5nZXRWYWx1ZUlu\nZm8oKS5zZXRTdHJhdGVneSgoKFN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgVU5JUVVFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVW5pcXVlKGZt\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgKG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5qZGJjLlVuaXF1ZSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFhfSk9JTl9D\nT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VYSm9pbkNvbHVtbnMoZm0s\nIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAgICAgICAgICAg\nICAgICAoWEpvaW5Db2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBYX0pPSU5fQ09MUzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZVhKb2luQ29sdW1ucyhmbSwgZm0uZ2V0\nVmFsdWVJbmZvKCksIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICgo\nWEpvaW5Db2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGZtLAogICAgICAgICAgICAgICAgICAg\nICAgICBhbm5vLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8g\naGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25NZW1iZXJNYXBwaW5nQW5ub3Rh\ndGlvbihGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgQW5ub3RhdGlvbiBhbm5v\nKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSB7QGxpbmsgVmFsdWVNYXBwaW5nfSA8Y29kZT5QT0xZ\nXyo8L2NvZGU+IGNvbnN0YW50IGZvcgogICAgICogdGhlIGdpdmVuIGVudW0g\ndmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgaW50IHRvUG9s\neW1vcnBoaWNDb25zdGFudChOb25wb2x5bW9ycGhpY1R5cGUgdmFsKSB7CiAg\nICAgICAgc3dpdGNoICh2YWwpIHsKICAgICAgICAgICAgY2FzZSBFWEFDVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBWYWx1ZU1hcHBpbmcuUE9MWV9GQUxT\nRTsKICAgICAgICAgICAgY2FzZSBKT0lOQUJMRToKICAgICAgICAgICAgICAg\nIHJldHVybiBWYWx1ZU1hcHBpbmcuUE9MWV9KT0lOQUJMRTsKICAgICAgICAg\nICAgY2FzZSBGQUxTRToKICAgICAgICAgICAgICAgIHJldHVybiBWYWx1ZU1h\ncHBpbmcuUE9MWV9UUlVFOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZ2l2ZW4gQEFzc29j\naWF0aW9uT3ZlcnJpZGUgYW5ub3RhdGlvbnMgb24gYW4gZW1iZWRkZWQgbWFw\ncGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlQXNzb2NpYXRp\nb25PdmVycmlkZXMoRmllbGRNYXBwaW5nIGZtLAogICAgICAgIEFzc29jaWF0\naW9uT3ZlcnJpZGUuLi4gYXNzb2NzKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIGVtYmVkID0gZm0uZ2V0RW1iZWRkZWRNYXBwaW5nKCk7CiAgICAgICAgaWYg\nKGVtYmVkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVtYmVkZGVkIiwgZm0pKTsKCiAg\nICAgICAgRmllbGRNYXBwaW5nIGVmbTsKICAgICAgICBKb2luQ29sdW1uW10g\nZWNvbHM7CiAgICAgICAgaW50IHVuaXF1ZTsKICAgICAgICBMaXN0PENvbHVt\nbj4gamNvbHM7CiAgICAgICAgZm9yIChBc3NvY2lhdGlvbk92ZXJyaWRlIGFz\nc29jIDogYXNzb2NzKSB7CiAgICAgICAgICAgIGVmbSA9IGVtYmVkLmdldEZp\nZWxkTWFwcGluZyhhc3NvYy5uYW1lKCkpOwogICAgICAgICAgICBpZiAoZWZt\nID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRlLW5hbWUiLAogICAg\nICAgICAgICAgICAgICAgIGZtLCBhc3NvYy5uYW1lKCkpKTsKICAgICAgICAg\nICAgZWNvbHMgPSBhc3NvYy5qb2luQ29sdW1ucygpOwogICAgICAgICAgICBp\nZiAoZWNvbHMgPT0gbnVsbCB8fCBlY29scy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgdW5pcXVlID0gMDsK\nICAgICAgICAgICAgamNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oZWNv\nbHMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChKb2luQ29sdW1uIGVjb2wg\nOiBlY29scykgewogICAgICAgICAgICAgICAgdW5pcXVlIHw9IChlY29sLnVu\naXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgICAgIGpjb2xz\nLmFkZChuZXdDb2x1bW4oZWNvbCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHNldENvbHVtbnMoZWZtLCBlZm0uZ2V0VmFsdWVJbmZvKCksIGpjb2xz\nLCB1bmlxdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIGdpdmVuIEBBdHRyaWJ1dGVPdmVycmlkZSBhbm5vdGF0aW9ucyBvbiBh\nbiBlbWJlZGRlZCBtYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoRmllbGRNYXBwaW5nIGZtLAogICAg\nICAgIEF0dHJpYnV0ZU92ZXJyaWRlLi4uIGF0dHJzKSB7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nIGVtYmVkID0gZm0uZ2V0RW1iZWRkZWRNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKGVtYmVkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVtYmVkZGVkIiwg\nZm0pKTsKCiAgICAgICAgRmllbGRNYXBwaW5nIGVmbTsKICAgICAgICBmb3Ig\nKEF0dHJpYnV0ZU92ZXJyaWRlIGF0dHIgOiBhdHRycykgewogICAgICAgICAg\nICBlZm0gPSBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoYXR0ci5uYW1lKCkpOwog\nICAgICAgICAgICBpZiAoZWZtID09IG51bGwpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVtYmVkLW92\nZXJyaWRlLW5hbWUiLAogICAgICAgICAgICAgICAgICAgIGZtLCBhdHRyLm5h\nbWUoKSkpOwogICAgICAgICAgICBpZiAoYXR0ci5jb2x1bW4oKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgcGFyc2VDb2x1bW5zKGVmbSwgYXR0ci5jb2x1\nbW4oKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQEVudW1lcmF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUVu\ndW1lcmF0ZWQoRmllbGRNYXBwaW5nIGZtLCBFbnVtZXJhdGVkIGFubm8pIHsK\nICAgICAgICBTdHJpbmcgc3RyYXQgPSBFbnVtVmFsdWVIYW5kbGVyLmNsYXNz\nLmdldE5hbWUoKSArICIoU3RvcmVPcmRpbmFsPSIKICAgICAgICAgICAgKyBT\ndHJpbmcudmFsdWVPZihhbm5vLnZhbHVlKCkgPT0gRW51bVR5cGUuT1JESU5B\nTCkgKyAiKSI7CiAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0U3RyYXRl\nZ3koc3RyYXQpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFRlbXBv\ncmFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VUZW1wb3JhbChG\naWVsZE1hcHBpbmcgZm0sIFRlbXBvcmFsIGFubm8pIHsKICAgICAgICBMaXN0\nIGNvbHMgPSBmbS5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgaWYgKCFjb2xzLmlzRW1wdHkoKSAmJiBjb2xzLnNpemUoKSAhPSAxKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm51bS1jb2xzLW1pc21hdGNoIiwgZm0sCiAgICAgICAgICAgICAgICBT\ndHJpbmcudmFsdWVPZihjb2xzLnNpemUoKSksICIxIikpOwogICAgICAgIGlm\nIChjb2xzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBjb2xzID0gQXJyYXlz\nLmFzTGlzdChuZXcgQ29sdW1uW117IG5ldyBDb2x1bW4oKSB9KTsKICAgICAg\nICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0Q29sdW1ucyhjb2xzKTsKICAg\nICAgICB9CgogICAgICAgIENvbHVtbiBjb2wgPSAoQ29sdW1uKSBjb2xzLmdl\ndCgwKTsKICAgICAgICBzd2l0Y2ggKGFubm8udmFsdWUoKSkgewogICAgICAg\nICAgICBjYXNlIERBVEU6CiAgICAgICAgICAgICAgICBjb2wuc2V0VHlwZShU\neXBlcy5EQVRFKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIFRJTUU6CiAgICAgICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBl\ncy5USU1FKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIFRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5\ncGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAQ29sdW1uKHMpLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUNvbHVtbnMoRmllbGRN\nYXBwaW5nIGZtLAogICAgICAgIGphdmF4LnBlcnNpc3RlbmNlLkNvbHVtbi4u\nLiBwY29scykgewogICAgICAgIGlmIChwY29scy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBtaWdodCBhbHJlYWR5IGhh\ndmUgc29tZSBjb2x1bW4gaW5mb3JtYXRpb24gZnJvbSBtYXBwaW5nIGFubm90\nYXRpb24KICAgICAgICBMaXN0IGNvbHMgPSBmbS5nZXRWYWx1ZUluZm8oKS5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKCFjb2xzLmlzRW1wdHkoKSAmJiBj\nb2xzLnNpemUoKSAhPSBwY29scy5sZW5ndGgpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibnVtLWNvbHMtbWlz\nbWF0Y2giLCBmbSwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKGNv\nbHMuc2l6ZSgpKSwgU3RyaW5nLnZhbHVlT2YocGNvbHMubGVuZ3RoKSkpOwoK\nICAgICAgICAvLyBjYWNoZSB0aGUgSkFYQiBYbWxUeXBlIGNsYXNzIGlmIGl0\nIGlzIHByZXNlbnQgc28gd2UgZG8gbm90CiAgICAgICAgLy8gaGF2ZSBhIGhh\ncmQtd2lyZWQgZGVwZW5kZW5jeSBvbiBKQVhCIGhlcmUKICAgICAgICBDbGFz\ncyB4bWxUeXBlQ2xhc3MgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHhtbFR5cGVDbGFzcyA9IENsYXNzLmZvck5hbWUoImphdmF4LnhtbC5i\naW5kLmFubm90YXRpb24uWG1sVHlwZSIpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgfQoKICAgICAgICBpbnQgdW5pcXVlID0g\nMDsKICAgICAgICBTdHJpbmcgc2Vjb25kYXJ5ID0gbnVsbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChjb2xzLnNpemUoKSA+IGkpCiAgICAgICAgICAgICAgICBz\nZXR1cENvbHVtbigoQ29sdW1uKSBjb2xzLmdldChpKSwgcGNvbHNbaV0pOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChjb2xzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBjb2xzID0gbmV3IEFycmF5\nTGlzdDxDb2x1bW4+KHBjb2xzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBj\nb2xzLmFkZChuZXdDb2x1bW4ocGNvbHNbaV0pKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHhtbFR5cGVDbGFzcyAhPSBu\ndWxsCiAgICAgICAgICAgICAgICAmJiBTdHJpbmdVdGlscy5pc0VtcHR5KHBj\nb2xzW2ldLmNvbHVtbkRlZmluaXRpb24oKSkKICAgICAgICAgICAgICAgICYm\nIGZtLmdldERlY2xhcmVkVHlwZSgpLmlzQW5ub3RhdGlvblByZXNlbnQoeG1s\nVHlwZUNsYXNzKSkgewogICAgICAgICAgICAgICAgREJEaWN0aW9uYXJ5IGRp\nY3QgPSAoKE1hcHBpbmdSZXBvc2l0b3J5KSBnZXRSZXBvc2l0b3J5KCkpCiAg\nICAgICAgICAgICAgICAgICAgLmdldERCRGljdGlvbmFyeSgpOwogICAgICAg\nICAgICAgICAgaWYgKGRpY3Quc3VwcG9ydHNYTUxDb2x1bW4pCiAgICAgICAg\nICAgICAgICAgICAgLy8gY29sdW1uIG1hcHMgdG8geG1sIHR5cGUKICAgICAg\nICAgICAgICAgICAgICAoKENvbHVtbikgY29scy5nZXQoaSkpLnNldFR5cGVO\nYW1lKGRpY3QueG1sVHlwZU5hbWUpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICB1bmlxdWUgfD0gKHBjb2xzW2ldLnVuaXF1ZSgpKSA/IFRSVUUgOiBG\nQUxTRTsKICAgICAgICAgICAgc2Vjb25kYXJ5ID0gdHJhY2tTZWNvbmRhcnlU\nYWJsZShmbSwgc2Vjb25kYXJ5LAogICAgICAgICAgICAgICAgcGNvbHNbaV0u\ndGFibGUoKSwgaSk7CiAgICAgICAgfQoKICAgICAgICBzZXRDb2x1bW5zKGZt\nLCBmbS5nZXRWYWx1ZUluZm8oKSwgY29scywgdW5pcXVlKTsKICAgICAgICBp\nZiAoc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgIGZtLmdldE1hcHBp\nbmdJbmZvKCkuc2V0VGFibGVOYW1lKHNlY29uZGFyeSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGlu\nZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oamF2YXgucGVy\nc2lzdGVuY2UuQ29sdW1uIGFubm8pIHsKICAgICAgICBDb2x1bW4gY29sID0g\nbmV3IENvbHVtbigpOwogICAgICAgIHNldHVwQ29sdW1uKGNvbCwgYW5ubyk7\nCiAgICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndHVwIHRoZSBnaXZlbiBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRo\nZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyB2b2lkIHNldHVwQ29sdW1uKENvbHVtbiBjb2wsIGphdmF4LnBlcnNpc3Rl\nbmNlLkNvbHVtbiBhbm5vKSB7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5p\nc0VtcHR5KGFubm8ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUo\nYW5uby5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShhbm5vLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlTmFtZShhbm5vLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAg\naWYgKGFubm8ucHJlY2lzaW9uKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNl\ndFNpemUoYW5uby5wcmVjaXNpb24oKSk7CiAgICAgICAgZWxzZSBpZiAoYW5u\nby5sZW5ndGgoKSAhPSAyNTUpCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFu\nbm8ubGVuZ3RoKCkpOwogICAgICAgIGNvbC5zZXROb3ROdWxsKCFhbm5vLm51\nbGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXREZWNpbWFsRGlnaXRzKGFubm8u\nc2NhbGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5J\nTlNFUlRBQkxFLCAhYW5uby5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5z\nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAhYW5uby51cGRhdGFi\nbGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIGNv\nbHVtbnMgYXMgdGhlIGNvbHVtbnMgZm9yIDxjb2RlPmZtPC9jb2RlPi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gdW5pcXVlIGJpdHdpc2UgY29tYmluYXRpb24g\nb2YgVFJVRSBhbmQgRkFMU0UgZm9yIHRoZQogICAgICogdW5pcXVlIGF0dHJp\nYnV0ZSBvZiBlYWNoIGNvbHVtbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBzZXRDb2x1bW5zKEZpZWxkTWFwcGluZyBmbSwgTWFwcGluZ0luZm8gaW5m\nbywKICAgICAgICBMaXN0PENvbHVtbj4gY29scywgaW50IHVuaXF1ZSkgewog\nICAgICAgIGluZm8uc2V0Q29sdW1ucyhjb2xzKTsKICAgICAgICBpZiAodW5p\ncXVlID09IFRSVUUpCiAgICAgICAgICAgIGluZm8uc2V0VW5pcXVlKG5ldyBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlKCkpOwoKICAg\nICAgICAvLyMjIyBFSkIzCiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwog\nICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpICYmIHVuaXF1ZSA9PSAo\nVFJVRSB8IEZBTFNFKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQo\nImluY29uc2lzdC1jb2wtYXR0cnMiLCBmbSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogSGVscGVyIHRvIHRyYWNrIHRoZSBzZWNvbmRhcnkgdGFibGUgZm9y\nIGEgc2V0IG9mIGNvbHVtbnMuCiAgICAgKgogICAgICogQHBhcmFtIHNlY29u\nZGFyeSBzZWNvbmRhcnkgdGFibGUgZm9yIGxhc3QgY29sdW1uCiAgICAgKiBA\ncGFyYW0gY29sU2Vjb25kYXJ5IHNlY29uZGFyeSB0YWJsZSBmb3IgY3VycmVu\ndCBjb2x1bW4KICAgICAqIEByZXR1cm4gc2Vjb25kYXJ5IHRhYmxlIGZvciBm\naWVsZAogICAgICovCiAgICBwcml2YXRlIFN0cmluZyB0cmFja1NlY29uZGFy\neVRhYmxlKEZpZWxkTWFwcGluZyBmbSwgU3RyaW5nIHNlY29uZGFyeSwKICAg\nICAgICBTdHJpbmcgY29sU2Vjb25kYXJ5LCBpbnQgY29sKSB7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoY29sU2Vjb25kYXJ5KSkKICAgICAg\nICAgICAgY29sU2Vjb25kYXJ5ID0gbnVsbDsKICAgICAgICBpZiAoY29sID09\nIDApCiAgICAgICAgICAgIHJldHVybiBjb2xTZWNvbmRhcnk7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5lcXVhbHNJZ25vcmVDYXNlKHNlY29uZGFyeSwg\nY29sU2Vjb25kYXJ5KSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJzZWNvbmQtaW5jb25zaXN0IiwgZm0pKTsK\nICAgICAgICByZXR1cm4gc2Vjb25kYXJ5OwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQEpvaW5UYWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlSm9pblRhYmxlKEZpZWxkTWFwcGluZyBmbSwgSm9pblRhYmxlIGpv\naW4pIHsKICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFt\nZSh0b1RhYmxlTmFtZShqb2luLnNjaGVtYSgpLAogICAgICAgICAgICBqb2lu\nLm5hbWUoKSkpOwogICAgICAgIHBhcnNlSm9pbkNvbHVtbnMoZm0sIGZtLmdl\ndE1hcHBpbmdJbmZvKCksIGZhbHNlLCBqb2luLmpvaW5Db2x1bW5zKCkpOwog\nICAgICAgIHBhcnNlSm9pbkNvbHVtbnMoZm0sIGZtLmdldEVsZW1lbnRNYXBw\naW5nKCkuZ2V0VmFsdWVJbmZvKCksIGZhbHNlLAogICAgICAgICAgICBqb2lu\nLmludmVyc2VKb2luQ29sdW1ucygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGdpdmVuIEBKb2luQ29sdW1uIGFubm90YXRpb25zLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VKb2luQ29sdW1ucyhGaWVsZE1hcHBp\nbmcgZm0sIE1hcHBpbmdJbmZvIGluZm8sCiAgICAgICAgYm9vbGVhbiBzZWNv\nbmRhcnlBbGxvd2VkLCBKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAg\naWYgKGpvaW5zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1\nbW4+KGpvaW5zLmxlbmd0aCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAg\nICAgICAgU3RyaW5nIHNlY29uZGFyeSA9IG51bGw7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0pKTsKICAgICAgICAgICAg\ndW5pcXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7\nCiAgICAgICAgICAgIHNlY29uZGFyeSA9IHRyYWNrU2Vjb25kYXJ5VGFibGUo\nZm0sIHNlY29uZGFyeSwKICAgICAgICAgICAgICAgIGpvaW5zW2ldLnRhYmxl\nKCksIGkpOwogICAgICAgICAgICBpZiAoIXNlY29uZGFyeUFsbG93ZWQgJiYg\nc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1zZWNvbmQiLCBmbSkp\nOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29sdW1ucyhmbSwgaW5mbywgY29s\ncywgdW5pcXVlKTsKICAgICAgICBpZiAoc2Vjb25kYXJ5ICE9IG51bGwpCiAg\nICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKHNl\nY29uZGFyeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVu\nIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVt\nbiBuZXdDb2x1bW4oSm9pbkNvbHVtbiBqb2luKSB7CiAgICAgICAgQ29sdW1u\nIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoam9pbi5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFt\nZShqb2luLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29s\nLnNldE5hbWUoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVyZW5jZWRDb2x1bW5O\nYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFyZ2V0KGpvaW4ucmVmZXJl\nbmNlZENvbHVtbk5hbWUoKSk7CiAgICAgICAgY29sLnNldE5vdE51bGwoIWpv\naW4ubnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZM\nQUdfVU5JTlNFUlRBQkxFLCAham9pbi5pbnNlcnRhYmxlKCkpOwogICAgICAg\nIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAham9pbi51\ncGRhdGFibGUoKSk7CiAgICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIGdpdmVuIEBQcmltYXJ5S2V5Sm9pbkNvbHVtbiBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUHJp\nbWFyeUtleUpvaW5Db2x1bW5zKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBQ\ncmltYXJ5S2V5Sm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIExpc3Q8\nQ29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGpvaW5zLmxl\nbmd0aCk7CiAgICAgICAgZm9yIChQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2lu\nIDogam9pbnMpCiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbihqb2lu\nKSk7CiAgICAgICAgc2V0Q29sdW1ucyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCks\nIGNvbHMsIDApOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZ2l2ZW4g\nQFhKb2luQ29sdW1uIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBwYXJzZVhKb2luQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1h\ncHBpbmdJbmZvIGluZm8sCiAgICAgICAgYm9vbGVhbiBzZWNvbmRhcnlBbGxv\nd2VkLCBYSm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIGlmIChqb2lu\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBM\naXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lu\ncy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAgIFN0\ncmluZyBzZWNvbmRhcnkgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5h\nZGQobmV3Q29sdW1uKGpvaW5zW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8\nPSAoam9pbnNbaV0udW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAg\nICAgICBzZWNvbmRhcnkgPSB0cmFja1NlY29uZGFyeVRhYmxlKGZtLCBzZWNv\nbmRhcnksCiAgICAgICAgICAgICAgICBqb2luc1tpXS50YWJsZSgpLCBpKTsK\nICAgICAgICAgICAgaWYgKCFzZWNvbmRhcnlBbGxvd2VkICYmIHNlY29uZGFy\neSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtc2Vjb25kIiwgZm0pKTsKICAgICAg\nICB9CgogICAgICAgIHNldENvbHVtbnMoZm0sIGluZm8sIGNvbHMsIHVuaXF1\nZSk7CiAgICAgICAgaWYgKHNlY29uZGFyeSAhPSBudWxsKQogICAgICAgICAg\nICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFtZShzZWNvbmRhcnkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBj\nb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29s\ndW1uKFhKb2luQ29sdW1uIGpvaW4pIHsKICAgICAgICBDb2x1bW4gY29sID0g\nbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShqb2luLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGpvaW4u\nbmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9p\nbi5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFt\nZShqb2luLmNvbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXRUYXJnZXQoam9pbi5yZWZlcmVuY2VkQ29s\ndW1uTmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\nam9pbi5yZWZlcmVuY2VkQXR0cmlidXRlTmFtZSgpKSkKICAgICAgICAgICAg\nY29sLnNldFRhcmdldEZpZWxkKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5h\nbWUoKSk7CiAgICAgICAgY29sLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUo\nKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRB\nQkxFLCAham9pbi5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFn\nKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFLCAham9pbi51cGRhdGFibGUoKSk7\nCiAgICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIGVtYmVkZGVkIGluZm8gZm9yIHRoZSBnaXZlbiBtYXBwaW5nLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VFbWJlZGRlZE1hcHBpbmcoRmll\nbGRNYXBwaW5nIGZtLCBFbWJlZGRlZE1hcHBpbmcgYW5ubykgewogICAgICAg\nIENsYXNzTWFwcGluZyBlbWJlZCA9IGZtLmdldEVtYmVkZGVkTWFwcGluZygp\nOwogICAgICAgIGlmIChlbWJlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbWJlZGRl\nZCIsIGZtKSk7CgogICAgICAgIEZpZWxkTWFwcGluZyBlZm07CiAgICAgICAg\nZm9yIChNYXBwaW5nT3ZlcnJpZGUgb3ZlciA6IGFubm8ub3ZlcnJpZGVzKCkp\nIHsKICAgICAgICAgICAgZWZtID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5nKG92\nZXIubmFtZSgpKTsKICAgICAgICAgICAgaWYgKGVmbSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAgICAg\nICBmbSwgb3Zlci5uYW1lKCkpKTsKICAgICAgICAgICAgcG9wdWxhdGUoZWZt\nLCBvdmVyKTsKICAgICAgICB9CgogICAgICAgIFN0cmluZyBudWxsSW5kID0g\nbnVsbDsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5u\ndWxsSW5kaWNhdG9yQXR0cmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgbnVs\nbEluZCA9IGFubm8ubnVsbEluZGljYXRvckF0dHJpYnV0ZU5hbWUoKTsKICAg\nICAgICBlbHNlIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm51bGxJ\nbmRpY2F0b3JDb2x1bW5OYW1lKCkpKQogICAgICAgICAgICBudWxsSW5kID0g\nYW5uby5udWxsSW5kaWNhdG9yQ29sdW1uTmFtZSgpOwogICAgICAgIGlmIChu\ndWxsSW5kID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nVmFsdWVNYXBwaW5nSW5mbyBpbmZvID0gZm0uZ2V0VmFsdWVJbmZvKCk7CiAg\nICAgICAgaWYgKCJmYWxzZSIuZXF1YWxzKG51bGxJbmQpKQogICAgICAgICAg\nICBpbmZvLnNldENhbkluZGljYXRlTnVsbChmYWxzZSk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAg\nICAgICAgICAgIGlmICghInRydWUiLmVxdWFscyhudWxsSW5kKSkKICAgICAg\nICAgICAgICAgIGNvbC5zZXROYW1lKG51bGxJbmQpOwogICAgICAgICAgICBp\nbmZvLnNldENvbHVtbnMoQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1uW117IGNv\nbCB9KSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQENvbnRhaW5lclRhYmxlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBw\nYXJzZUNvbnRhaW5lclRhYmxlKEZpZWxkTWFwcGluZyBmbSwgQ29udGFpbmVy\nVGFibGUgY3RibCkgewogICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0\nVGFibGVOYW1lKHRvVGFibGVOYW1lKGN0Ymwuc2NoZW1hKCksCiAgICAgICAg\nICAgIGN0YmwubmFtZSgpKSk7CiAgICAgICAgcGFyc2VYSm9pbkNvbHVtbnMo\nZm0sIGZtLmdldE1hcHBpbmdJbmZvKCksIGZhbHNlLCBjdGJsLmpvaW5Db2x1\nbW5zKCkpOwogICAgICAgIGlmIChjdGJsLmpvaW5Gb3JlaWduS2V5KCkuc3Bl\nY2lmaWVkKCkpCiAgICAgICAgICAgIHBhcnNlRm9yZWlnbktleShmbS5nZXRN\nYXBwaW5nSW5mbygpLCBjdGJsLmpvaW5Gb3JlaWduS2V5KCkpOwogICAgICAg\nIGlmIChjdGJsLmpvaW5JbmRleCgpLnNwZWNpZmllZCgpKQogICAgICAgICAg\nICBwYXJzZUluZGV4KGZtLmdldE1hcHBpbmdJbmZvKCksIGN0Ymwuam9pbklu\nZGV4KCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9yZGVyQ29s\ndW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPcmRlckNvbHVt\nbihGaWVsZE1hcHBpbmcgZm0sIE9yZGVyQ29sdW1uIG9yZGVyKSB7CiAgICAg\nICAgaWYgKCFvcmRlci5lbmFibGVkKCkpIHsKICAgICAgICAgICAgZm0uZ2V0\nTWFwcGluZ0luZm8oKS5zZXRDYW5PcmRlckNvbHVtbihmYWxzZSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIENvbHVtbiBjb2wg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KG9yZGVyLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKG9y\nZGVyLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKG9yZGVyLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlTmFtZShvcmRlci5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAg\nIGlmIChvcmRlci5wcmVjaXNpb24oKSAhPSAwKQogICAgICAgICAgICBjb2wu\nc2V0U2l6ZShvcmRlci5wcmVjaXNpb24oKSk7CiAgICAgICAgY29sLnNldEZs\nYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhb3JkZXIuaW5zZXJ0YWJs\nZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFU\nQUJMRSwgIW9yZGVyLnVwZGF0YWJsZSgpKTsKICAgICAgICBmbS5nZXRNYXBw\naW5nSW5mbygpLnNldE9yZGVyQ29sdW1uKGNvbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBARWxlbWVudEpvaW5Db2x1bW4ocykuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKEZp\nZWxkTWFwcGluZyBmbSwKICAgICAgICBFbGVtZW50Sm9pbkNvbHVtbi4uLiBq\nb2lucykgewogICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5l\ndyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAgIGlu\ndCB1bmlxdWUgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9p\nbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5hZGQobmV3Q29s\ndW1uKGpvaW5zW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8PSAoam9pbnNb\naV0udW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgIH0KICAgICAg\nICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlv\nbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKEVsZW1lbnRKb2luQ29sdW1u\nIGpvaW4pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0\naW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLmNvbHVtbkRl\nZmluaXRpb24oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNv\nbC5zZXRUYXJnZXQoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2Vk\nQXR0cmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldEZp\nZWxkKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSk7CiAgICAgICAg\nY29sLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAgICAgICAgY29s\nLnNldEZsYWcgKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWpvaW4uaW5z\nZXJ0YWJsZSAoKSk7CgkJY29sLnNldEZsYWcgKENvbHVtbi5GTEFHX1VOVVBE\nQVRBQkxFLCAham9pbi51cGRhdGFibGUgKCkpOwoJCXJldHVybiBjb2w7Cgl9\nCiAgICAKICAgIHByaXZhdGUgc3RhdGljIFVuaXF1ZSBuZXdVbmlxdWUoQ2xh\nc3NNYXBwaW5nIGNtLCBTdHJpbmcgbmFtZSwgCiAgICAgICAgU3RyaW5nW10g\nY29sdW1uTmFtZXMpIHsKICAgICAgICBpZiAoY29sdW1uTmFtZXMgPT0gbnVs\nbCB8fCBjb2x1bW5OYW1lcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgVW5pcXVlIHVuaXF1ZUNvbnN0cmFpbnQgPSBu\nZXcgVW5pcXVlKCk7CiAgICAgICAgdW5pcXVlQ29uc3RyYWludC5zZXROYW1l\nKG5hbWUpOwogICAgICAgIGZvciAoaW50IGk9MDsgaTxjb2x1bW5OYW1lcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShjb2x1bW5OYW1lc1tpXSkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZW1wdHktdW5pcXVlLWNvbHVt\nbiIsIAogICAgICAgICAgICAgICAgICAgIEFycmF5cy50b1N0cmluZyhjb2x1\nbW5OYW1lcyksIGNtKSk7CiAgICAgICAgICAgIENvbHVtbiBjb2x1bW4gPSBu\nZXcgQ29sdW1uKCk7CiAgICAgICAgICAgIGNvbHVtbi5zZXROYW1lKGNvbHVt\nbk5hbWVzW2ldKTsKICAgICAgICAgICAgdW5pcXVlQ29uc3RyYWludC5hZGRD\nb2x1bW4oY29sdW1uKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuaXF1\nZUNvbnN0cmFpbnQ7CiAgICB9Cn0K\n","encoding":"base64"}

