{"sha":"594f4faecba1578959fa2b6319f70876500769e3","node_id":"MDQ6QmxvYjIwNjM2NDo1OTRmNGZhZWNiYTE1Nzg5NTlmYTJiNjMxOWY3MDg3NjUwMDc2OWUz","size":29852,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/594f4faecba1578959fa2b6319f70876500769e3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjOwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5Bbm5vdGF0aW9u\nUGVyc2lzdGVuY2VNZXRhRGF0YVNlcmlhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lzdGVuY2VTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5Bbm5vdGF0\naW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuUXVlcnlSZXN1bHRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGlu\nZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRp\nc2NyaW1pbmF0b3JNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLlNlcXVlbmNlTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZs\nYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNz\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5FbnVtVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS4qOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCgppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBq\nYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnNxbC5UeXBl\nczsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkFubm90YXRpb247Cgpp\nbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVGVtcG9yYWxUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5j\nZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJsZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlNlY29uZGFyeVRhYmxlOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuSW5oZXJpdGFuY2U7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yVmFsdWU7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuSm9pblRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTG9iOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWw7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVtZXJhdGVkOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuVW5pcXVlQ29uc3RyYWludDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuSm9pbkNvbHVtbnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5K\nb2luQ29sdW1uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJpbWFyeUtl\neUpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmltYXJ5\nS2V5Sm9pbkNvbHVtbnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxS\nZXN1bHRTZXRNYXBwaW5nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50\naXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1\nbHQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7Cgov\nL0B0b2RvOiBqYXZhZG9jcwoKLyoqCiAqIFNlcmlhbGl6ZXMgcGVyc2lzdGVu\nY2UgbWFwcGluZ3MgYXMgYW5ub3RhdGlvbnMuCiAqCiAqIEBzaW5jZSAxLjAu\nMAogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAYXV0aG9yIEdva2hhbiBFcmd1\nbAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgQW5ub3RhdGlvblBl\ncnNpc3RlbmNlTWFwcGluZ1NlcmlhbGl6ZXIKICAgIGV4dGVuZHMgQW5ub3Rh\ndGlvblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9SRVNVTFRNQVAgPSBUWVBFX1FV\nRVJZICsgMTsKCiAgICBwcml2YXRlIExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5n\nPiBfcmVzdWx0cyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N5bmMg\nPSBmYWxzZTsKCiAgICBwcml2YXRlIE1hcDxRdWVyeVJlc3VsdE1hcHBpbmcs\nIExpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+PiBfcnNtQW5ub3MgPSBudWxsOwog\nICAgCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25QZXJzaXN0\nZW5jZU1hcHBpbmdTZXJpYWxpemVyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBzdXBlcihjb25mKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdG8gYXV0b21hdGljYWxseSBzeW5jaHJvbml6ZSBtYXBwaW5n\nIGluZm8gd2l0aCBkYXRhIGF2YWlsYWJsZQogICAgICogZnJvbSBtYXBwZWQg\nY29tcG9uZW50cyBiZWZvcmUgc2VyaWFsaXphdGlvbi4gRGVmYXVsdHMgdG8g\nZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN5bmNNYXBw\naW5nSW5mbygpIHsKICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgc3luY2hyb25p\nemUgbWFwcGluZyBpbmZvIHdpdGggZGF0YSBhdmFpbGFibGUKICAgICAqIGZy\nb20gbWFwcGVkIGNvbXBvbmVudHMgYmVmb3JlIHNlcmlhbGl6YXRpb24uIERl\nZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRT\neW5jTWFwcGluZ0luZm8oYm9vbGVhbiBzeW5jKSB7CiAgICAgICAgX3N5bmMg\nPSBzeW5jOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgZ2l2ZW4g\ncmVzdWx0IHNldCBtYXBwaW5nIHRvIGxvY2FsIGNhY2hlLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoUXVlcnlSZXN1\nbHRNYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3Jlc3VsdHMgPT0gbnVs\nbCkKICAgICAgICAgICAgX3Jlc3VsdHMgPSBuZXcgQXJyYXlMaXN0PFF1ZXJ5\nUmVzdWx0TWFwcGluZz4oKTsKICAgICAgICBfcmVzdWx0cy5hZGQobWV0YSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGdpdmVuIHJlc3VsdCBz\nZXQgbWFwcGluZyBmcm9tIHRoZSBsb2NhbCBjYWNoZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKFF1ZXJ5\nUmVzdWx0TWFwcGluZyBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRz\nICE9IG51bGwgJiYgX3Jlc3VsdHMucmVtb3ZlKG1ldGEpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgYWRkQWxsKE1ldGFEYXRhUmVw\nb3NpdG9yeSByZXBvcykgewogICAgICAgIHN1cGVyLmFkZEFsbChyZXBvcyk7\nCiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChNYXBw\naW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVyeVJl\nc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5UmVzdWx0TWFw\ncGluZyhyZXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJv\nb2xlYW4gcmVtb3ZlQWxsKE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcykgewog\nICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IHN1cGVyLnJlbW92ZUFsbChyZXBv\ncyk7CiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChN\nYXBwaW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVy\neVJlc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIHJlbW92ZWQgfD0gcmVt\nb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKHJlcyk7CiAgICAgICAgcmV0dXJuIHJl\nbW92ZWQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBj\nbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIGlmIChf\ncmVzdWx0cyAhPSBudWxsKQogICAgICAgICAgICBfcmVzdWx0cy5jbGVhcigp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFubm90YXRpb24gYnVp\nbGRlciB0byBsaXN0IG9mIGJ1aWxkZXJzIGZvciB0aGUgc3BlY2lmaWVkCiAg\nICAgKiBjbGFzcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgYWRkQW5ub3RhdGlvbihBbm5vdGF0aW9uQnVpbGRlciBhYiwgUXVlcnlS\nZXN1bHRNYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3JzbUFubm9zID09\nIG51bGwpCiAgICAgICAgICAgIF9yc21Bbm5vcyA9IG5ldyBIYXNoTWFwPFF1\nZXJ5UmVzdWx0TWFwcGluZywgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+KCk7\nCiAgICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4gbGlzdCA9IF9yc21B\nbm5vcy5nZXQobWV0YSk7CiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCkgewog\nICAgICAgICAgICBsaXN0ID0gbmV3IEFycmF5TGlzdDxBbm5vdGF0aW9uQnVp\nbGRlcj4oKTsKICAgICAgICAgICAgX3JzbUFubm9zLnB1dChtZXRhLCBsaXN0\nKTsKICAgICAgICB9CiAgICAgICAgbGlzdC5hZGQoYWIpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlcyBhbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIg\nZm9yIHRoZSBzcGVjaWZpZWQgY2xhc3MgbWV0YWRhdGEKICAgICAqIGFuZCBh\nZGRzIGl0IHRvIGxpc3Qgb2YgYnVpbGRlcnMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBBbm5vdGF0aW9uQnVpbGRlciBhZGRBbm5vdGF0aW9uKAogICAgICAg\nIENsYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm5UeXBlLCBRdWVyeVJl\nc3VsdE1hcHBpbmcgbWV0YSkgewogICAgICAgIEFubm90YXRpb25CdWlsZGVy\nIGFiID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlwZSk7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFiOwogICAg\nICAgIGFkZEFubm90YXRpb24oYWIsIG1ldGEpOwogICAgICAgIHJldHVybiBh\nYjsKICAgIH0KCgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBz\nZXJpYWxpemVDbGFzcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBp\nZiAoX3N5bmMgJiYgaXNNYXBwaW5nTW9kZSgpICYmIG1ldGEgaW5zdGFuY2Vv\nZiBDbGFzc01hcHBpbmcpIHsKICAgICAgICAgICAgLy8gc3luYyBpZiByZXNv\nbHZlZCBhbmQgbWFwcGVkCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBjbHMg\nPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgICAgICAgICBpZiAoKGNscy5n\nZXRSZXNvbHZlKCkgJiBNZXRhRGF0YU1vZGVzLk1PREVfTUFQUElORykgIT0g\nMCAmJgogICAgICAgICAgICAgICAgY2xzLmlzTWFwcGVkKCkpIHsKICAgICAg\nICAgICAgICAgIGNscy5zeW5jTWFwcGluZ0luZm8oKTsKICAgICAgICAgICAg\nICAgIGNscy5nZXREaXNjcmltaW5hdG9yKCkuc3luY01hcHBpbmdJbmZvKCk7\nCiAgICAgICAgICAgICAgICBjbHMuZ2V0VmVyc2lvbigpLnN5bmNNYXBwaW5n\nSW5mbygpOwogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRz\nOwogICAgICAgICAgICAgICAgaWYgKGNscy5nZXRFbWJlZGRpbmdNZXRhRGF0\nYSgpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gY2xz\nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gY2xzLmdldEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGZvciAoRmllbGRNYXBwaW5n\nIGYgOiBmaWVsZHMpCiAgICAgICAgICAgICAgICAgICAgZi5zeW5jTWFwcGlu\nZ0luZm8oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdXBl\nci5zZXJpYWxpemVDbGFzcyhtZXRhKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZUNsYXNzTWFwcGluZ0NvbnRl\nbnQoQ2xhc3NNZXRhRGF0YSBtYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NNYXBw\naW5nIGNscyA9IChDbGFzc01hcHBpbmcpIG1hcHBpbmc7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nSW5mbyBpbmZvID0gY2xzLmdldE1hcHBpbmdJbmZvKCk7CiAg\nICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJUYWJsZSA9IGFkZEFubm90YXRp\nb24oVGFibGUuY2xhc3MsIG1hcHBpbmcpOwogICAgICAgIHNlcmlhbGl6ZVRh\nYmxlKGluZm8uZ2V0VGFibGVOYW1lKCksIFN0cmluZ3MKICAgICAgICAgICAg\nLmdldENsYXNzTmFtZShtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSksIG51\nbGwsCiAgICAgICAgICAgIGluZm8uZ2V0VW5pcXVlcygpLCBhYlRhYmxlKTsK\nICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGluZm8sIENvbFR5cGUuUEtfSk9J\nTiwgbnVsbCwgYWJUYWJsZSwgY2xzKTsKICAgICAgICBmb3IgKFN0cmluZyBz\nZWNvbmQgOiBpbmZvLmdldFNlY29uZGFyeVRhYmxlTmFtZXMoKSkgewogICAg\nICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYlNlY1RhYmxlID0KICAgICAg\nICAgICAgICAgIGFkZEFubm90YXRpb24oU2Vjb25kYXJ5VGFibGUuY2xhc3Ms\nIG1hcHBpbmcpOwogICAgICAgICAgICBzZXJpYWxpemVUYWJsZShzZWNvbmQs\nIG51bGwsIGluZm8sIG51bGwsIGFiU2VjVGFibGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6\nZUluaGVyaXRhbmNlQ29udGVudChDbGFzc01ldGFEYXRhIG1hcHBpbmcpIHsK\nICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gKENsYXNzTWFwcGluZykgbWFw\ncGluZzsKICAgICAgICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBjbHMuZ2V0\nTWFwcGluZ0luZm8oKTsKICAgICAgICBEaXNjcmltaW5hdG9yTWFwcGluZ0lu\nZm8gZGluZm8gPSBjbHMuZ2V0RGlzY3JpbWluYXRvcigpCiAgICAgICAgICAg\nIC5nZXRNYXBwaW5nSW5mbygpOwogICAgICAgIFN0cmluZyBzdHJhdCA9IGlu\nZm8uZ2V0SGllcmFyY2h5U3RyYXRlZ3koKTsKICAgICAgICBpZiAobnVsbCA9\nPSBzdHJhdCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIFN0cmluZyBp\ndHlwZWNscyA9IFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKEluaGVyaXRhbmNlVHlw\nZS5jbGFzcyk7CiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJJbmhlcml0\nYW5jZSA9CiAgICAgICAgICAgIGFkZEFubm90YXRpb24oSW5oZXJpdGFuY2Uu\nY2xhc3MsIG1hcHBpbmcpOwogICAgICAgIGlmIChGbGF0Q2xhc3NTdHJhdGVn\neS5BTElBUy5lcXVhbHMoc3RyYXQpKQogICAgICAgICAgICBhYkluaGVyaXRh\nbmNlLmFkZCgic3RyYXRlZ3kiLCBpdHlwZWNscyArICIuU0lOR0xFX1RBQkxF\nIik7CiAgICAgICAgZWxzZSBpZiAoVmVydGljYWxDbGFzc1N0cmF0ZWd5LkFM\nSUFTLmVxdWFscyhzdHJhdCkpCiAgICAgICAgICAgIGFiSW5oZXJpdGFuY2Uu\nYWRkKCJzdHJhdGVneSIsIGl0eXBlY2xzICsgIi5KT0lORUQiKTsKICAgICAg\nICBlbHNlIGlmIChGdWxsQ2xhc3NTdHJhdGVneS5BTElBUy5lcXVhbHMoc3Ry\nYXQpKQogICAgICAgICAgICBhYkluaGVyaXRhbmNlLmFkZCgic3RyYXRlZ3ki\nLCBpdHlwZWNscyArICIuVEFCTEVfUEVSX0NMQVNTIik7CiAgICAgICAgaWYg\nKGRpbmZvLmdldFZhbHVlKCkgIT0gbnVsbCkgewogICAgICAgICAgICBBbm5v\ndGF0aW9uQnVpbGRlciBhYkRpc2NWYWwgPQogICAgICAgICAgICAgICAgYWRk\nQW5ub3RhdGlvbihEaXNjcmltaW5hdG9yVmFsdWUuY2xhc3MsIG1hcHBpbmcp\nOwogICAgICAgICAgICBhYkRpc2NWYWwuYWRkKG51bGwsIGRpbmZvLmdldFZh\nbHVlKCkpOwogICAgICAgIH0KICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBh\nYkRpc2NDb2wgPQogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKERpc2NyaW1p\nbmF0b3JDb2x1bW4uY2xhc3MsIG1hcHBpbmcpOwogICAgICAgIHNlcmlhbGl6\nZUNvbHVtbnMoZGluZm8sIENvbFR5cGUuRElTQywgbnVsbCwgYWJEaXNjQ29s\nLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSB0YWJs\nZSBvcHRpb25hbGx5IGxpc3RpbmcgcHJpbWFyeS1rZXktam9pbnMgc3RvcmVk\nCiAgICAgKiBpbiB0aGUgZ2l2ZW4ge0BsaW5rIG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nSW5mb30uCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBzZXJpYWxpemVUYWJsZShTdHJpbmcgdGFibGUsIFN0cmlu\nZyBkZWZhdWx0TmFtZSwKICAgICAgICBDbGFzc01hcHBpbmdJbmZvIHNlY29u\nZGFyeUluZm8sIFVuaXF1ZVtdIHVuaXF1ZXMsCiAgICAgICAgQW5ub3RhdGlv\nbkJ1aWxkZXIgYWIpIHsKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG51\nbGw7CiAgICAgICAgaWYgKHNlY29uZGFyeUluZm8gIT0gbnVsbCkKICAgICAg\nICAgICAgY29scyA9IChMaXN0PENvbHVtbj4pIHNlY29uZGFyeUluZm8uZ2V0\nU2Vjb25kYXJ5VGFibGVKb2luQ29sdW1ucwogICAgICAgICAgICAgICAgKHRh\nYmxlKTsKCiAgICAgICAgYm9vbGVhbiBwcmludCA9IChjb2xzICE9IG51bGwg\nJiYgY29scy5zaXplKCkgPiAwKSB8fAogICAgICAgICAgICAodW5pcXVlcyAh\nPSBudWxsICYmIHVuaXF1ZXMubGVuZ3RoID4gMCk7CiAgICAgICAgaWYgKHRh\nYmxlICE9IG51bGwKICAgICAgICAgICAgJiYgKGRlZmF1bHROYW1lID09IG51\nbGwgfHwgIWRlZmF1bHROYW1lLmVxdWFscyh0YWJsZSkpKSB7CiAgICAgICAg\nICAgIHByaW50ID0gdHJ1ZTsKICAgICAgICAgICAgaW50IGluZGV4ID0gdGFi\nbGUuaW5kZXhPZignLicpOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwKQog\nICAgICAgICAgICAgICAgYWIuYWRkKCJuYW1lIiwgdGFibGUpOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFiLmFkZCgic2NoZW1hIiwg\ndGFibGUuc3Vic3RyaW5nKDAsIGluZGV4KSk7CiAgICAgICAgICAgICAgICBh\nYi5hZGQoIm5hbWUiLCB0YWJsZS5zdWJzdHJpbmcoaW5kZXggKyAxKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHByaW50KSB7CiAg\nICAgICAgICAgIGlmIChjb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGZvciAoQ29sdW1uIGNvbCA6IGNvbHMpCiAgICAgICAgICAgICAgICAgICAg\nc2VyaWFsaXplQ29sdW1uKGNvbCwgQ29sVHlwZS5QS19KT0lOLAogICAgICAg\nICAgICAgICAgICAgICAgICBudWxsLCBmYWxzZSwgYWIsIG51bGwpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmICh1bmlxdWVzICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGZvciAoVW5pcXVlIHVuaXF1ZTogdW5pcXVlcykg\newogICAgICAgICAgICAgICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiVW5p\ncXVlQ29uc3QgPQogICAgICAgICAgICAgICAgICAgICAgICBuZXdBbm5vdGF0\naW9uQnVpbGRlcihVbmlxdWVDb25zdHJhaW50LmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBzZXJpYWxpemVVbmlxdWVDb25zdHJhaW50KHVuaXF1ZSwg\nYWJVbmlxdWVDb25zdCk7CiAgICAgICAgICAgICAgICAgICAgYWIuYWRkKCJ1\nbmlxdWVDb25zdHJhaW50cyIsIGFiVW5pcXVlQ29uc3QpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHJvdGVjdGVkIGJvb2xlYW4gc2VyaWFsaXplQXR0cmli\ndXRlT3ZlcnJpZGUoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgRmllbGRN\nZXRhRGF0YSBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCB8fCBm\nbWQgPT0gb3JpZykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICBGaWVsZE1hcHBpbmcgZmllbGQgPSAoRmllbGRNYXBwaW5nKSBmbWQ7CiAg\nICAgICAgRmllbGRNYXBwaW5nIGZpZWxkMiA9IChGaWVsZE1hcHBpbmcpIG9y\naWc7CiAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuaGFzU2No\nZW1hQ29tcG9uZW50cygpCiAgICAgICAgICAgIHx8IGZpZWxkMi5nZXRNYXBw\naW5nSW5mbygpLmhhc1NjaGVtYUNvbXBvbmVudHMoKSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CgogICAgICAgIFZhbHVlTWFwcGluZ0luZm8gaW5mbyA9\nIGZpZWxkLmdldFZhbHVlSW5mbygpOwogICAgICAgIExpc3Q8Q29sdW1uPiBj\nb2xzID0gKExpc3Q8Q29sdW1uPikgaW5mby5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLnNpemUoKSA9PSAwKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgVmFsdWVNYXBwaW5nSW5m\nbyBpbmZvMiA9IGZpZWxkMi5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBMaXN0\nPENvbHVtbj4gY29sczIgPSAoTGlzdDxDb2x1bW4+KSBpbmZvMi5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgaWYgKGNvbHMyID09IG51bGwgfHwgY29sczIuc2l6\nZSgpICE9IGNvbHMuc2l6ZSgpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICBpZiAoY29scy5zaXplKCkgIT0gMSkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CgogICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgQ29sdW1u\nIGNvbDI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLnNpemUo\nKTsgaSsrKSB7CiAgICAgICAgICAgIGNvbCA9IGNvbHMuZ2V0KGkpOwogICAg\nICAgICAgICBjb2wyID0gY29sczIuZ2V0KGkpOwogICAgICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmVxdWFscyhjb2wuZ2V0TmFtZSgpLCBjb2wyLmdldE5h\nbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHMoY29sLmdldFR5cGVOYW1lKCks\nIGNvbDIuZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgaWYgKGNvbC5nZXRTaXplKCkgIT0gY29sMi5n\nZXRTaXplKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICAgICAgaWYgKGNvbC5nZXREZWNpbWFsRGlnaXRzKCkgIT0gY29sMi5nZXRE\nZWNpbWFsRGlnaXRzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKGNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5T\nRVJUQUJMRSkKICAgICAgICAgICAgICAgICE9IGNvbDIuZ2V0RmxhZyhDb2x1\nbW4uRkxBR19VTklOU0VSVEFCTEUpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RmxhZyhDb2x1bW4uRkxB\nR19VTlVQREFUQUJMRSkKICAgICAgICAgICAgICAgICE9IGNvbDIuZ2V0Rmxh\nZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFs\naXplQXR0cmlidXRlT3ZlcnJpZGVNYXBwaW5nQ29udGVudChGaWVsZE1ldGFE\nYXRhIGZtZCwKICAgICAgICBGaWVsZE1ldGFEYXRhIG9yaWcsIEFubm90YXRp\nb25CdWlsZGVyIGFiKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZp\nZWxkTWFwcGluZykgZm1kOwogICAgICAgIHNlcmlhbGl6ZUNvbHVtbnMoZm0u\nZ2V0VmFsdWVJbmZvKCksIENvbFR5cGUuQ09MLCBmbS5nZXRNYXBwaW5nSW5m\nbygpCiAgICAgICAgICAgIC5nZXRUYWJsZU5hbWUoKSwgYWIsIGZtZCk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VT\ndHJhdGVneSBnZXRTdHJhdGVneShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXQgPSBzdXBlci5nZXRTdHJh\ndGVneShmbWQpOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZCA9IChGaWVs\nZE1hcHBpbmcpIGZtZDsKICAgICAgICBzd2l0Y2ggKHN0cmF0KSB7CiAgICAg\nICAgICAgIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgLy8gd2Ug\nY2FuIGRpZmZlcmVudGlhdGUgYSBvbmUtbWFueSBieSB0aGUgZmFjdCB0aGF0\nIHRoZXJlIGlzIG5vCiAgICAgICAgICAgICAgICAvLyBzZWNvbmRhcnkgdGFi\nbGUgam9pbiwgb3IgdGhlIGZrIGlzIHVuaXF1ZQogICAgICAgICAgICAgICAg\naWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgPT0gbnVsbAogICAgICAgICAgICAg\nICAgICAgICYmIChmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldEpvaW5EaXJl\nY3Rpb24oKQogICAgICAgICAgICAgICAgICAgID09IE1hcHBpbmdJbmZvLkpP\nSU5fTk9ORQogICAgICAgICAgICAgICAgICAgIHx8IGZpZWxkLmdldEVsZW1l\nbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuZ2V0VW5pcXVlKCkKICAgICAg\nICAgICAgICAgICAgICAhPSBudWxsKSkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5PTkVfTUFOWTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE1BTllfT05FOgogICAg\nICAgICAgICAgICAgLy8gaW52ZXJzZSBqb2luIGNvbHMgb3IgdW5pcXVlIGZr\nPwogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdldFZhbHVlSW5mbygpLmdl\ndEpvaW5EaXJlY3Rpb24oKQogICAgICAgICAgICAgICAgICAgID09IE1hcHBp\nbmdJbmZvLkpPSU5fSU5WRVJTRQogICAgICAgICAgICAgICAgICAgIHx8IGZp\nZWxkLmdldFZhbHVlSW5mbygpLmdldFVuaXF1ZSgpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuT05F\nX09ORTsKCiAgICAgICAgICAgICAgICAvLyBzY2FuIGZvciBwcmltYXJ5LWtl\neS1qb2luLWNvbHVtbgogICAgICAgICAgICAgICAgTGlzdDxDb2x1bW4+IGNv\nbHMgPSBmaWVsZC5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgICAgICAgICBib29sZWFuIHBrSm9pbiA9IGNvbHMgIT0gbnVsbCAmJiBj\nb2xzLnNpemUoKSA+IDA7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgcGtKb2luICYmIGkgPCBjb2xzLnNpemUoKTsgaSsrKQogICAgICAgICAg\nICAgICAgICAgIHBrSm9pbiA9IGNvbHMuZ2V0KGkpLmdldEZsYWcoQ29sdW1u\nLkZMQUdfUEtfSk9JTik7CiAgICAgICAgICAgICAgICBpZiAocGtKb2luKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5\nLk9ORV9PTkU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHN0cmF0OwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplRmllbGRNYXBwaW5nQ29udGVudChG\naWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5\nIHN0cmF0ZWd5LCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIGlm\nIChmbWQuZ2V0TWFwcGVkQnkoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIHdoaWxlIEknZCBsaWtlIHRvIGRvIGF1dG8gZGV0\nZWN0aW9uIGJhc2VkIG9uIGpvaW4gZGlyZWN0aW9ucywgZXRjLgogICAgICAg\nIC8vIHRoZSBkaXN0aW5ndWlzaGVkIGNvbHVtbiAvIHRhYmxlIC8gZXRjIG5h\nbWVzIGZvcmNlcyBvdXIgaGFuZAogICAgICAgIC8vIGVzcCBmb3IgT3BlbkpQ\nQSBjdXN0b20gbWFwcGluZ3MuCiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxk\nID0gKEZpZWxkTWFwcGluZykgZm1kOwogICAgICAgIHN3aXRjaCAoc3RyYXRl\nZ3kpIHsKICAgICAgICAgICAgY2FzZSBPTkVfT05FOgogICAgICAgICAgICBj\nYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAgc2VyaWFsaXplQ29sdW1u\ncyhmaWVsZC5nZXRWYWx1ZUluZm8oKSwgQ29sVHlwZS5KT0lOLAogICAgICAg\nICAgICAgICAgICAgIGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0VGFibGVO\nYW1lKCksIG51bGwsIGZtZCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAgICAgICBpZiAo\nZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRKb2luRGlyZWN0aW9uKCkgPT0K\nICAgICAgICAgICAgICAgICAgICBNYXBwaW5nSW5mby5KT0lOX05PTkUpIHsK\nICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIENvbFR5cGUuSk9JTiwgbnVsbCwgbnVsbCwgZm1kKTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAvLyBlbHNlIG5vIGJyZWFrCiAgICAgICAgICAg\nIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdl\ndE1hcHBpbmdJbmZvKCkuaGFzU2NoZW1hQ29tcG9uZW50cygpCiAgICAgICAg\nICAgICAgICAgICAgfHwgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKQogICAgICAgICAgICAgICAgICAgIC5oYXNTY2hlbWFDb21w\nb25lbnRzKCkpIHsKICAgICAgICAgICAgICAgICAgICBBbm5vdGF0aW9uQnVp\nbGRlciBhYkpvaW5UYmwgPQogICAgICAgICAgICAgICAgICAgICAgICBhZGRB\nbm5vdGF0aW9uKEpvaW5UYWJsZS5jbGFzcywgZm1kKTsKICAgICAgICAgICAg\nICAgICAgICBTdHJpbmcgdGFibGUgPSBmaWVsZC5nZXRNYXBwaW5nSW5mbygp\nLmdldFRhYmxlTmFtZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0YWJs\nZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpbmRl\neCA9IHRhYmxlLmluZGV4T2YoJy4nKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGFiSm9pblRibC5hZGQoIm5hbWUiLCB0YWJsZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nYWJKb2luVGJsLmFkZCgic2NoZW1hIiwgdGFibGUuc3Vic3RyaW5nKDAsIGlu\nZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYkpvaW5UYmwu\nYWRkKCJuYW1lIiwgdGFibGUuc3Vic3RyaW5nKGluZGV4ICsgMSkpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUNvbHVtbnMoZmllbGQuZ2V0\nTWFwcGluZ0luZm8oKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ29sVHlw\nZS5KT0lOLCBudWxsLCBhYkpvaW5UYmwsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIHNlcmlhbGl6ZUNvbHVtbnMoZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nQ29sVHlwZS5JTlZFUlNFLCBudWxsLCBhYkpvaW5UYmwsIG51bGwpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhmaWVsZC5nZXRWYWx1ZUlu\nZm8oKSwgQ29sVHlwZS5DT0wsCiAgICAgICAgICAgIGZpZWxkLmdldE1hcHBp\nbmdJbmZvKCkuZ2V0VGFibGVOYW1lKCksIG51bGwsIGZtZCk7CiAgICAgICAg\naWYgKHN0cmF0ZWd5ID09IFBlcnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUMgJiYg\naXNMb2IoZmllbGQpKSB7CiAgICAgICAgICAgIGFkZEFubm90YXRpb24oTG9i\nLmNsYXNzLCBmbWQpOwogICAgICAgIH0KICAgICAgICBUZW1wb3JhbFR5cGUg\ndGVtcG9yYWwgPSBnZXRUZW1wb3JhbChmaWVsZCk7CiAgICAgICAgaWYgKHRl\nbXBvcmFsICE9IG51bGwpIHsKICAgICAgICAgICAgYWRkQW5ub3RhdGlvbihU\nZW1wb3JhbC5jbGFzcywgZm1kKS4KICAgICAgICAgICAgICAgIGFkZChudWxs\nLCB0ZW1wb3JhbCk7CiAgICAgICAgfQoKICAgICAgICBFbnVtVHlwZSBlbnVt\nVHlwZSA9IGdldEVudW1UeXBlKGZpZWxkKTsKICAgICAgICBpZiAoZW51bVR5\ncGUgIT0gbnVsbCAmJiBlbnVtVHlwZSAhPSBFbnVtVHlwZS5PUkRJTkFMKSB7\nCiAgICAgICAgICAgIGFkZEFubm90YXRpb24oRW51bWVyYXRlZC5jbGFzcywg\nZm1kKS4KICAgICAgICAgICAgICAgIGFkZChudWxsLCBlbnVtVHlwZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRo\nZSBmaWVsZCBpcyBhIGxvYi4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGlzTG9iKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIGZvciAoQ29s\ndW1uIGNvbCA6IChMaXN0PENvbHVtbj4pIGZpZWxkLmdldFZhbHVlSW5mbygp\nLmdldENvbHVtbnMoKSkKICAgICAgICAgICAgaWYgKGNvbC5nZXRUeXBlKCkg\nPT0gVHlwZXMuQkxPQiB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkNMT0Ip\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gZmllbGQncyB0\nZW1wb3JhbCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIFRlbXBvcmFsVHlw\nZSBnZXRUZW1wb3JhbChGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAgICAgICBp\nZiAoZmllbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5E\nQVRFCiAgICAgICAgICAgICYmIGZpZWxkLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSAhPSBKYXZhVHlwZXMuQ0FMRU5EQVIpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9ICgoSkRCQ0NvbmZp\nZ3VyYXRpb24pIGdldENvbmZpZ3VyYXRpb24oKSkKICAgICAgICAgICAgLmdl\ndERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgaW50IGRlZiA9IGRp\nY3QuZ2V0SkRCQ1R5cGUoZmllbGQuZ2V0VHlwZUNvZGUoKSwgZmFsc2UpOwog\nICAgICAgIGZvciAoQ29sdW1uIGNvbCA6IChMaXN0PENvbHVtbj4pIGZpZWxk\nLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKSkgewogICAgICAgICAgICBp\nZiAoY29sLmdldFR5cGUoKSA9PSBkZWYpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgc3dpdGNoIChjb2wuZ2V0VHlwZSgpKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIFR5cGVzLkRBVEU6CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFRlbXBvcmFsVHlwZS5EQVRFOwogICAgICAgICAgICAg\nICAgY2FzZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBUZW1wb3JhbFR5cGUuVElNRTsKICAgICAgICAgICAgICAgIGNhc2UgVHlw\nZXMuVElNRVNUQU1QOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUZW1w\nb3JhbFR5cGUuVElNRVNUQU1QOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGVudW0gdHlwZSBmb3IgdGhlIGZpZWxkLgogICAgICovCiAgICBwcm90\nZWN0ZWQgRW51bVR5cGUgZ2V0RW51bVR5cGUoRmllbGRNYXBwaW5nIGZpZWxk\nKSB7CiAgICAgICAgaWYgKGZpZWxkLmdldERlY2xhcmVkVHlwZUNvZGUoKSAh\nPSBKYXZhVHlwZXMuT0JKRUNUKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoIShmaWVsZC5nZXRIYW5kbGVyKCkgaW5zdGFuY2VvZiBF\nbnVtVmFsdWVIYW5kbGVyKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgcmV0dXJuICgoRW51bVZhbHVlSGFuZGxlcikgZmllbGQuZ2V0SGFu\nZGxlcigpKS5nZXRTdG9yZU9yZGluYWwoKQogICAgICAgICAgICA/IEVudW1U\neXBlLk9SRElOQUwgOiBFbnVtVHlwZS5TVFJJTkc7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXJpYWxpemUgdGhlIGNvbHVtbnMgaW4gdGhlIGdpdmVuIG1h\ncHBpbmcgaW5mby4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6\nZUNvbHVtbnMoTWFwcGluZ0luZm8gaW5mbywgQ29sVHlwZSB0eXBlLAogICAg\nICAgIFN0cmluZyBzZWNvbmRhcnksIEFubm90YXRpb25CdWlsZGVyIGFiLCBP\nYmplY3QgbWV0YSkgewogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gKExp\nc3Q8Q29sdW1uPikgaW5mby5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNv\nbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIEFubm90\nYXRpb25CdWlsZGVyIGFiQ29udGFpbmVyID0gYWI7CiAgICAgICAgaWYgKGNv\nbHMuc2l6ZSgpID4gMSkgewogICAgICAgICAgICBDbGFzcyBncnBUeXBlID0g\ndHlwZS5nZXRDb2x1bW5Hcm91cEFubm90YXRpb25UeXBlKCk7CiAgICAgICAg\nICAgIGlmIChudWxsICE9IGdycFR5cGUpIHsKICAgICAgICAgICAgICAgIEFu\nbm90YXRpb25CdWlsZGVyIGFiR3JwID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIo\nZ3JwVHlwZSk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBhYikKICAg\nICAgICAgICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiR3JwLCBtZXRhKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBhYi5h\nZGQobnVsbCwgYWJHcnApOwogICAgICAgICAgICAgICAgYWJDb250YWluZXIg\nPSBhYkdycDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3Ig\nKENvbHVtbiBjb2wgOiBjb2xzKQogICAgICAgICAgICBzZXJpYWxpemVDb2x1\nbW4oY29sLCB0eXBlLCBzZWNvbmRhcnksCiAgICAgICAgICAgICAgICBpbmZv\nLmdldFVuaXF1ZSgpICE9IG51bGwsIGFiQ29udGFpbmVyLCBtZXRhKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBhIHNpbmdsZSBjb2x1bW4u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxpemVDb2x1bW4oQ29s\ndW1uIGNvbCwgQ29sVHlwZSB0eXBlLCBTdHJpbmcgc2Vjb25kYXJ5LAogICAg\nICAgIGJvb2xlYW4gdW5pcXVlLCBBbm5vdGF0aW9uQnVpbGRlciBhYiwgT2Jq\nZWN0IG1ldGEpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IG1ldGEg\naW5zdGFuY2VvZiBGaWVsZE1ldGFEYXRhID8KICAgICAgICAgICAgKEZpZWxk\nTWV0YURhdGEpIG1ldGEgOiBudWxsOwogICAgICAgIEFubm90YXRpb25CdWls\nZGVyIGFiQ29sID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIoCiAgICAgICAgICAg\nIHR5cGUuZ2V0Q29sdW1uQW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgaWYg\nKGNvbC5nZXROYW1lKCkgIT0gbnVsbCAmJiAobnVsbCA9PSBmbWQgfHwKICAg\nICAgICAgICAgIWNvbC5nZXROYW1lKCkuZXF1YWxzSWdub3JlQ2FzZShmbWQu\nZ2V0TmFtZSgpKSkpCiAgICAgICAgICAgIGFiQ29sLmFkZCgibmFtZSIsIGNv\nbC5nZXROYW1lKCkpOwogICAgICAgIGlmIChjb2wuZ2V0VHlwZU5hbWUoKSAh\nPSBudWxsKQogICAgICAgICAgICBhYkNvbC5hZGQoImNvbHVtbkRlZmluaXRp\nb24iLCBjb2wuZ2V0VHlwZU5hbWUoKSk7CiAgICAgICAgaWYgKGNvbC5nZXRU\nYXJnZXQoKSAhPSBudWxsCiAgICAgICAgICAgICYmICh0eXBlID09IENvbFR5\ncGUuSk9JTiB8fCB0eXBlID09IENvbFR5cGUuSU5WRVJTRQogICAgICAgICAg\nICB8fCB0eXBlID09IENvbFR5cGUuUEtfSk9JTikpCiAgICAgICAgICAgIGFi\nQ29sLmFkZCgicmVmZXJlbmNlZENvbHVtbk5hbWUiLCBjb2wuZ2V0VGFyZ2V0\nKCkpOwogICAgICAgIGlmICh0eXBlID09IENvbFR5cGUuQ09MIHx8IHR5cGUg\nPT0gQ29sVHlwZS5KT0lOCiAgICAgICAgICAgIHx8IHR5cGUgPT0gQ29sVHlw\nZS5QS19KT0lOKSB7CiAgICAgICAgICAgIGlmICh1bmlxdWUpCiAgICAgICAg\nICAgICAgICBhYkNvbC5hZGQoInVuaXF1ZSIsIHRydWUpOwogICAgICAgICAg\nICBpZiAoY29sLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAgYWJDb2wu\nYWRkKCJudWxsYWJsZSIsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKGNvbC5n\nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkpCiAgICAgICAgICAg\nICAgICBhYkNvbC5hZGQoImluc2VydGFibGUiLCBmYWxzZSk7CiAgICAgICAg\nICAgIGlmIChjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkp\nCiAgICAgICAgICAgICAgICBhYkNvbC5hZGQoInVwZGF0YWJsZSIsIGZhbHNl\nKTsKICAgICAgICAgICAgaWYgKHNlY29uZGFyeSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgYWJDb2wuYWRkKCJ0YWJsZSIsIHNlY29uZGFyeSk7CgogICAg\nICAgICAgICBpZiAodHlwZSA9PSBDb2xUeXBlLkNPTCkgewogICAgICAgICAg\nICAgICAgaWYgKGNvbC5nZXRTaXplKCkgPiAwICYmIGNvbC5nZXRTaXplKCkg\nIT0gMjU1KQogICAgICAgICAgICAgICAgICAgIGFiQ29sLmFkZCgibGVuZ3Ro\nIiwgY29sLmdldFNpemUoKSk7CiAgICAgICAgICAgICAgICBpZiAoY29sLmdl\ndERlY2ltYWxEaWdpdHMoKSAhPSAwKQogICAgICAgICAgICAgICAgICAgIGFi\nQ29sLmFkZCgic2NhbGUiLCBjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGUgIT0gQ29s\nVHlwZS5DT0wgfHwgYWJDb2wuaGFzQ29tcG9uZW50cygpKSB7CiAgICAgICAg\nICAgIGlmIChudWxsICE9IGFiKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcg\na2V5ID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChhYi5nZXRUeXBlKCkg\nPT0gSm9pblRhYmxlLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgc3dp\ndGNoKHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBKT0lO\nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gImpvaW5Db2x1\nbW5zIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgICAgICBjYXNlIElOVkVSU0U6CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBrZXkgPSAiaW52ZXJzZUpvaW5Db2x1bW5zIjsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGFiLmFkZChrZXksIGFiQ29sKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGFkZEFubm90YXRpb24oYWJDb2wsIG1ldGEpOwogICAg\nICAgICAgICB9ICAgICAgICAgICAgICAgIAogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgc2VyaWFsaXplVW5pcXVlQ29uc3RyYWludChVbmlx\ndWUgdW5pcXVlLAogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAg\nICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7\nCiAgICAgICAgQ29sdW1uW10gY29sdW1ucyA9IHVuaXF1ZS5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgZm9yIChDb2x1bW4gY29sdW1uOmNvbHVtbnMpIHsKICAg\nICAgICAgICAgaWYgKHNiLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAg\nIHNiLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgc2IuYXBwZW5kKGNvbHVt\nbi5nZXROYW1lKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoY29sdW1ucy5s\nZW5ndGggPiAxKQogICAgICAgICAgICBzYi5pbnNlcnQoMCwgInsiKS5hcHBl\nbmQoIn0iKTsKICAgICAgICBhYi5hZGQoImNvbHVtbk5hbWVzIiwgc2IudG9T\ndHJpbmcoKSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQg\nU2VyaWFsaXphdGlvbkNvbXBhcmF0b3IgbmV3U2VyaWFsaXphdGlvbkNvbXBh\ncmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbm5vdGF0aW9uUGVyc2lz\ndGVuY2VNYXBwaW5nU2VyaWFsaXplci4KICAgICAgICAgICAgTWFwcGluZ1Nl\ncmlhbGl6YXRpb25Db21wYXJhdG9yKCk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRTeXN0ZW1NYXBwaW5nRWxlbWVudHMo\nQ29sbGVjdGlvbiB0b1NlcmlhbGl6ZSkgewogICAgICAgIGlmIChpc1F1ZXJ5\nTW9kZSgpKQogICAgICAgICAgICB0b1NlcmlhbGl6ZS5hZGRBbGwoZ2V0UXVl\ncnlSZXN1bHRNYXBwaW5ncyhudWxsKSk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgaW50IHR5cGUoT2JqZWN0IG8pIHsKICAgICAgICBp\nbnQgdHlwZSA9IHN1cGVyLnR5cGUobyk7CiAgICAgICAgaWYgKHR5cGUgPT0g\nLTEgJiYgbyBpbnN0YW5jZW9mIFF1ZXJ5UmVzdWx0TWFwcGluZykKICAgICAg\nICAgICAgcmV0dXJuIFRZUEVfUkVTVUxUTUFQOwogICAgICAgIHJldHVybiB0\neXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZXN1bHQg\nc2V0IG1hcHBpbmdzIGZvciB0aGUgZ2l2ZW4gc2NvcGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+IGdldFF1ZXJ5UmVz\ndWx0TWFwcGluZ3MoQ2xhc3NNZXRhRGF0YSBjbSkgewogICAgICAgIGlmIChf\ncmVzdWx0cyA9PSBudWxsIHx8IF9yZXN1bHRzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgcmV0dXJuIChMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4pIENvbGxl\nY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAgICAgIExpc3Q8UXVlcnlSZXN1bHRN\nYXBwaW5nPiByZXN1bHQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgX3Jlc3VsdHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgUXVl\ncnlSZXN1bHRNYXBwaW5nIGVsZW1lbnQgPSBfcmVzdWx0cy5nZXQoaSk7CiAg\nICAgICAgICAgIGlmICgoY20gPT0gbnVsbCAmJiBlbGVtZW50LmdldFNvdXJj\nZVNjb3BlKCkgIT0gbnVsbCkgfHwgKGNtICE9IG51bGwKICAgICAgICAgICAg\nICAgICYmIGVsZW1lbnQuZ2V0U291cmNlU2NvcGUoKSAhPSBjbS5nZXREZXNj\ncmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXN1bHQgPSBuZXcgQXJyYXlMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4oX3Jl\nc3VsdHMuc2l6ZSgpIC0gaSk7CiAgICAgICAgICAgIHJlc3VsdC5hZGQoZWxl\nbWVudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAocmVzdWx0ID09IG51\nbGwpCiAgICAgICAgICAgID8gKExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPikg\nQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IHJlc3VsdDsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVN5c3RlbU1h\ncHBpbmdFbGVtZW50KE9iamVjdCBvYmopIHsKICAgICAgICBpZiAob2JqIGlu\nc3RhbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKQogICAgICAgICAgICBzZXJp\nYWxpemVRdWVyeVJlc3VsdE1hcHBpbmcoKFF1ZXJ5UmVzdWx0TWFwcGluZykg\nb2JqLCBudWxsKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCB2b2lkIHNlcmlhbGl6ZVF1ZXJ5TWFwcGluZ3MoQ2xhc3NNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDog\nZ2V0UXVlcnlSZXN1bHRNYXBwaW5ncyhtZXRhKSkKICAgICAgICAgICAgc2Vy\naWFsaXplUXVlcnlSZXN1bHRNYXBwaW5nKHJlcywgbWV0YSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXJpYWxpemUgZ2l2ZW4gcmVzdWx0IHNldCBtYXBw\naW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplUXVlcnlS\nZXN1bHRNYXBwaW5nKFF1ZXJ5UmVzdWx0TWFwcGluZyBtZXRhLAogICAgICAg\nIENsYXNzTWV0YURhdGEgY2xzbWV0YSkgewogICAgICAgIEFubm90YXRpb25C\ndWlsZGVyIGFiID0gYWRkQW5ub3RhdGlvbihTcWxSZXN1bHRTZXRNYXBwaW5n\nLmNsYXNzLCBtZXRhKTsKICAgICAgICBpZiAobnVsbCAhPSBjbHNtZXRhKQog\nICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCBjbHNtZXRhKTsKICAgICAg\nICBhYi5hZGQoIm5hbWUiLCBtZXRhLmdldE5hbWUoKSk7CiAgICAgICAgZm9y\nIChRdWVyeVJlc3VsdE1hcHBpbmcuUENSZXN1bHQgcGMgOiBtZXRhLmdldFBD\nUmVzdWx0cygpKSB7CiAgICAgICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFi\nRW50UmVzID0KICAgICAgICAgICAgICAgIG5ld0Fubm90YXRpb25CdWlsZGVy\nKEVudGl0eVJlc3VsdC5jbGFzcyk7CiAgICAgICAgICAgIGFiLmFkZCgiZW50\naXRpZXMiLCBhYkVudFJlcyk7CiAgICAgICAgICAgIGFiRW50UmVzLmFkZCgi\nZW50aXR5Q2xhc3MiLCBwYy5nZXRDYW5kaWRhdGVUeXBlKCkpOwogICAgICAg\nICAgICBPYmplY3QgZGlzY3JpbSA9IHBjLmdldE1hcHBpbmcocGMuRElTQ1JJ\nTUlOQVRPUik7CiAgICAgICAgICAgIGlmIChkaXNjcmltICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBhYkVudFJlcy5hZGQoImRpc2NyaW1pbmF0b3JDb2x1\nbW4iLCBkaXNjcmltLnRvU3RyaW5nKCkpOwoKICAgICAgICAgICAgZm9yIChT\ndHJpbmcgcGF0aCA6IHBjLmdldE1hcHBpbmdQYXRocygpKSB7CiAgICAgICAg\nICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYkZsZFJlcyA9CiAgICAgICAg\nICAgICAgICAgICAgbmV3QW5ub3RhdGlvbkJ1aWxkZXIoRmllbGRSZXN1bHQu\nY2xhc3MpOwogICAgICAgICAgICAgICAgYWJFbnRSZXMuYWRkKCJmaWVsZHMi\nLCBhYkZsZFJlcyk7CiAgICAgICAgICAgICAgICBhYkZsZFJlcy5hZGQoIm5h\nbWUiLCBwYXRoKTsKICAgICAgICAgICAgICAgIGFiRmxkUmVzLmFkZCgiY29s\ndW1uIiwgcGMuZ2V0TWFwcGluZyhwYXRoKS50b1N0cmluZygpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKE9iamVjdCBjb2wgOiBt\nZXRhLmdldENvbHVtblJlc3VsdHMoKSkgewogICAgICAgICAgICBBbm5vdGF0\naW9uQnVpbGRlciBhYkNvbFJlcyA9CiAgICAgICAgICAgICAgICBuZXdBbm5v\ndGF0aW9uQnVpbGRlcihDb2x1bW5SZXN1bHQuY2xhc3MpOwogICAgICAgICAg\nICBhYkNvbFJlcy5hZGQoIm5hbWUiLCBjb2wudG9TdHJpbmcoKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQg\nc2VyaWFsaXplU2VxdWVuY2UoU2VxdWVuY2VNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKFNlcXVlbmNlTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxFLmVx\ndWFscyhtZXRhLmdldFNlcXVlbmNlUGx1Z2luKCkpKSB7CiAgICAgICAgICAg\nIHN1cGVyLnNlcmlhbGl6ZVNlcXVlbmNlKG1ldGEpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBh\nYlRibEdlbiA9IGFkZEFubm90YXRpb24oVGFibGVHZW5lcmF0b3IuY2xhc3Ms\nIG1ldGEpOwogICAgICAgIFNlcXVlbmNlTWFwcGluZyBzZXEgPSAoU2VxdWVu\nY2VNYXBwaW5nKSBtZXRhOwogICAgICAgIGFiVGJsR2VuLmFkZCgibmFtZSIs\nIHNlcS5nZXROYW1lKCkpOwogICAgICAgIFN0cmluZyB0YWJsZSA9IHNlcS5n\nZXRUYWJsZSgpOwogICAgICAgIGlmICh0YWJsZSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGludCBkb3RJZHggPSB0YWJsZS5pbmRleE9mKCcuJyk7CiAgICAg\nICAgICAgIGlmIChkb3RJZHggPT0gLTEpCiAgICAgICAgICAgICAgICBhYlRi\nbEdlbi5hZGQoInRhYmxlIiwgdGFibGUpOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIGFiVGJsR2VuLmFkZCgidGFibGUiLCB0YWJsZS5z\ndWJzdHJpbmcoZG90SWR4ICsgMSkpOwogICAgICAgICAgICAgICAgYWJUYmxH\nZW4uYWRkKCJzY2hlbWEiLCB0YWJsZS5zdWJzdHJpbmcoMCwgZG90SWR4KSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KHNlcS5nZXRQcmltYXJ5S2V5Q29sdW1uKCkpKQogICAg\nICAgICAgICBhYlRibEdlbi5hZGQoInBrQ29sdW1uTmFtZSIsIHNlcS5nZXRQ\ncmltYXJ5S2V5Q29sdW1uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShzZXEuZ2V0U2VxdWVuY2VDb2x1bW4oKSkpCiAgICAgICAgICAg\nIGFiVGJsR2VuLmFkZCgidmFsdWVDb2x1bW5OYW1lIiwgc2VxLmdldFNlcXVl\nbmNlQ29sdW1uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShzZXEuZ2V0UHJpbWFyeUtleVZhbHVlKCkpKQogICAgICAgICAgICBhYlRi\nbEdlbi5hZGQoInBrQ29sdW1uVmFsdWUiLCBzZXEuZ2V0UHJpbWFyeUtleVZh\nbHVlKCkpOwogICAgICAgIGlmIChzZXEuZ2V0QWxsb2NhdGUoKSAhPSA1MCAm\nJiBzZXEuZ2V0QWxsb2NhdGUoKSAhPSAtMSkKICAgICAgICAgICAgYWJUYmxH\nZW4uYWRkKCJhbGxvY2F0aW9uU2l6ZSIsIHNlcS5nZXRBbGxvY2F0ZSgpICsg\nIiIpOwogICAgICAgIGlmIChzZXEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gMCAm\nJiBzZXEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gLTEpCiAgICAgICAgICAgIGFi\nVGJsR2VuLmFkZCgiaW5pdGlhbFZhbHVlIiwgc2VxLmdldEluaXRpYWxWYWx1\nZSgpICsgIiIpOwogICAgfQoKICAgIC8qKgogICAgICogQ29sdW1uIHR5cGVz\nIHNlcmlhbGl6ZWQgdW5kZXIgZGlmZmVyZW50IG5hbWVzLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBlbnVtIENvbFR5cGUgewoKICAgICAgICBDT0ws\nCiAgICAgICAgSk9JTiwKICAgICAgICBJTlZFUlNFLAogICAgICAgIFBLX0pP\nSU4sCiAgICAgICAgRElTQzsKCiAgICAgICAgcHJpdmF0ZSBDbGFzczw/IGV4\ndGVuZHMgQW5ub3RhdGlvbj4gZ2V0Q29sdW1uQW5ub3RhdGlvblR5cGUoKSB7\nCiAgICAgICAgICAgIHN3aXRjaCh0aGlzKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIENPTDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gamF2YXgucGVy\nc2lzdGVuY2UuQ29sdW1uLmNsYXNzOwogICAgICAgICAgICAgICAgY2FzZSBK\nT0lOOgogICAgICAgICAgICAgICAgY2FzZSBJTlZFUlNFOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBKb2luQ29sdW1uLmNsYXNzOwogICAgICAgICAg\nICAgICAgY2FzZSBQS19KT0lOOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBQcmltYXJ5S2V5Sm9pbkNvbHVtbi5jbGFzczsKICAgICAgICAgICAgICAg\nIGNhc2UgRElTQzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGlzY3Jp\nbWluYXRvckNvbHVtbi5jbGFzczsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgQ2xh\nc3M8PyBleHRlbmRzIEFubm90YXRpb24+IGdldENvbHVtbkdyb3VwQW5ub3Rh\ndGlvblR5cGUoKSB7CiAgICAgICAgICAgIHN3aXRjaCh0aGlzKSB7CiAgICAg\nICAgICAgICAgICBjYXNlIEpPSU46CiAgICAgICAgICAgICAgICBjYXNlIElO\nVkVSU0U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpvaW5Db2x1bW5z\nLmNsYXNzOwogICAgICAgICAgICAgICAgY2FzZSBQS19KT0lOOgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBQcmltYXJ5S2V5Sm9pbkNvbHVtbnMuY2xh\nc3M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQoKICAgIH0KCiAgICAvKioKICAgICAqIEV4dGVuZHMge0BsaW5r\nIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yfSBmb3Igc3RvcmUtc3BlY2lmaWMg\ndGFncyBzdWNoCiAgICAgKiBhcyAmbHQ7c3FsLXJlc3VsdC1zZXQtbWFwcGlu\nZyZndDsuCiAgICAgKgogICAgICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBjbGFzcyBNYXBwaW5nU2VyaWFsaXphdGlv\nbkNvbXBhcmF0b3IKICAgICAgICBleHRlbmRzIFNlcmlhbGl6YXRpb25Db21w\nYXJhdG9yIHsKCiAgICAgICAgcHJvdGVjdGVkIGludCBjb21wYXJlVW5rbm93\nbihPYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBpZiAoIShv\nMSBpbnN0YW5jZW9mIFF1ZXJ5UmVzdWx0TWFwcGluZykpCiAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwZXIuY29tcGFyZVVua25vd24obzEsIG8yKTsKCiAg\nICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMxID0gKFF1ZXJ5UmVz\ndWx0TWFwcGluZykgbzE7CiAgICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGlu\nZyByZXMyID0gKFF1ZXJ5UmVzdWx0TWFwcGluZykgbzI7CgogICAgICAgICAg\nICAvLyBzeXN0ZW0gc2NvcGUgYmVmb3JlIGNsYXNzIHNjb3BlCiAgICAgICAg\nICAgIE9iamVjdCBzY29wZTEgPSByZXMxLmdldFNvdXJjZVNjb3BlKCk7CiAg\nICAgICAgICAgIE9iamVjdCBzY29wZTIgPSByZXMyLmdldFNvdXJjZVNjb3Bl\nKCk7CiAgICAgICAgICAgIGlmIChzY29wZTEgPT0gbnVsbCAmJiBzY29wZTIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAg\nICAgaWYgKHNjb3BlMSAhPSBudWxsICYmIHNjb3BlMiA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIDE7CgogICAgICAgICAgICAvLyBjb21wYXJl\nIG9uIGxpc3RpbmcgaW5kZXgsIG9yIGlmIG5vbmUvc2FtZSwgdXNlIG5hbWUK\nICAgICAgICAgICAgaW50IGxpc3RpbmdJbmRleDEgPSByZXMxLmdldExpc3Rp\nbmdJbmRleCgpOwogICAgICAgICAgICBpbnQgbGlzdGluZ0luZGV4MiA9IHJl\nczIuZ2V0TGlzdGluZ0luZGV4KCk7CiAgICAgICAgICAgIGlmIChsaXN0aW5n\nSW5kZXgxICE9IGxpc3RpbmdJbmRleDIpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbGlzdGluZ0luZGV4MSAtIGxpc3RpbmdJbmRleDI7CiAgICAgICAgICAg\nIHJldHVybiByZXMxLmdldE5hbWUgKCkuY29tcGFyZVRvIChyZXMyLmdldE5h\nbWUgKCkpOwoJCX0KCX0KfQo=\n","encoding":"base64"}

