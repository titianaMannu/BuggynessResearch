{"sha":"da61175c741603a6141ffba46ef37188630b3bda","node_id":"MDQ6QmxvYjIwNjM2NDpkYTYxMTc1Yzc0MTYwM2E2MTQxZmZiYTQ2ZWYzNzE4ODYzMGIzYmRh","size":22321,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/da61175c741603a6141ffba46ef37188630b3bda","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlOw0KDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCmltcG9ydCBq\nYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbTsNCmltcG9ydCBqYXZhLmlv\nLk9iamVjdE91dHB1dFN0cmVhbTsNCmltcG9ydCBqYXZhLmlvLk9iamVjdElu\ncHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8uQnl0ZUFycmF5SW5wdXRTdHJl\nYW07DQppbXBvcnQgamF2YS51dGlsLkxpc3Q7DQppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOw0KaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZpZWxk\nOw0KDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLnRl\nc3QuU2luZ2xlRU1GVGVzdENhc2U7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2VyOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5KUEFGYWNhZGVIZWxw\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBB\nU3RhdGVNYW5hZ2VyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkNsYXNzTWV0YURhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW1wbEhlbHBlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZl\nbnQuQWJzdHJhY3RMaWZlY3ljbGVMaXN0ZW5lcjsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7DQoNCnB1YmxpYyBh\nYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFVuZW5oYW5jZWRDbGFzc1Rlc3QNCiAg\nICBleHRlbmRzIFNpbmdsZUVNRlRlc3RDYXNlIHsNCg0KICAgIC8vICMjIyMj\nIFRvIGRvOg0KICAgIC8vIC0gY2xlYXJpbmcgaW4gcG5ldyBwcm9wZXJ0eS1h\nY2Nlc3Mgd2l0aG91dCByZWRlZmluaXRpb24NCiAgICAvLyAtIGZpZ3VyZSBv\ndXQgaG93IHRvIGF1dG8tdGVzdCB0aGUgcmVkZWZpbml0aW9uIGNvZGUsIGVp\ndGhlciBpbiBKYXZhIDUNCiAgICAvLyAgIG9yIGluIEphdmEgNg0KICAgIC8v\nIC0gcnVuIENUUyBpbiB0aGUgZm9sbG93aW5nIGNvbWJpbmF0aW9uczoNCiAg\nICAvLyAgICogSmF2YSA2DQogICAgLy8gICAqIEphdmEgNSB3aXRoIGphdmFh\nZ2VudA0KICAgIC8vICAgKiBKYXZhIDUgd2l0aG91dCBqYXZhYWdlbnQNCg0K\nICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgew0KICAgICAgICBzZXRVcChnZXRV\nbmVuaGFuY2VkQ2xhc3MoKSwgZ2V0VW5lbmhhbmNlZFN1YmNsYXNzKCksIENM\nRUFSX1RBQkxFUyk7DQogICAgICAgIC8vIHRyaWdnZXIgY2xhc3MgcmVkZWZp\nbml0aW9uDQogICAgICAgIGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCkuY2xv\nc2UoKTsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgQ2xhc3M8\nPyBleHRlbmRzIFVuZW5oYW5jZWRUeXBlPiBnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKTsNCg0KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBVbmVuaGFuY2VkVHlwZSBu\nZXdVbmVuaGFuY2VkSW5zdGFuY2UoKTsNCg0KICAgIHByb3RlY3RlZCBhYnN0\ncmFjdCBDbGFzczw/IGV4dGVuZHMgVW5lbmhhbmNlZFN1YnR5cGU+IGdldFVu\nZW5oYW5jZWRTdWJjbGFzcygpOw0KDQogICAgcHJvdGVjdGVkIGFic3RyYWN0\nIFVuZW5oYW5jZWRTdWJ0eXBlIG5ld1VuZW5oYW5jZWRTdWJjbGFzc0luc3Rh\nbmNlKCk7DQoNCiAgICBwcml2YXRlIFVuZW5oYW5jZWRUeXBlIG5ld0luc3Rh\nbmNlKGJvb2xlYW4gc3ViKSB7DQogICAgICAgIHJldHVybiBzdWIgPyBuZXdV\nbmVuaGFuY2VkU3ViY2xhc3NJbnN0YW5jZSgpDQogICAgICAgICAgICA6IG5l\nd1VuZW5oYW5jZWRJbnN0YW5jZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHRlc3RNZXRhRGF0YSgpIHsNCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gSlBBRmFjYWRlSGVscGVyLmdldE1ldGFEYXRhKGVtZiwNCiAgICAg\nICAgICAgIGdldFVuZW5oYW5jZWRDbGFzcygpKTsNCiAgICAgICAgYXNzZXJ0\nRXF1YWxzKENsYXNzUmVkZWZpbmVyLmNhblJlZGVmaW5lQ2xhc3NlcygpLA0K\nICAgICAgICAgICAgbWV0YS5pc0ludGVyY2VwdGluZygpKTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0SW1wbEhlbHBlckNhbGxzKCkgew0KICAg\nICAgICBhc3NlcnRUcnVlKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShudWxs\nLCBnZXRVbmVuaGFuY2VkQ2xhc3MoKSkpOw0KDQogICAgICAgIFVuZW5oYW5j\nZWRUeXBlIHVuID0gbmV3VW5lbmhhbmNlZEluc3RhbmNlKCk7DQogICAgICAg\nIGFzc2VydEZhbHNlKHVuIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxl\nKTsNCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh1biwNCiAgICAgICAgICAgIGVtZi5n\nZXRDb25maWd1cmF0aW9uKCkpOw0KICAgICAgICBhc3NlcnROb3ROdWxsKHBj\nKTsNCiAgICAgICAgYXNzZXJ0VHJ1ZShJbXBsSGVscGVyLmlzTWFuYWdlYWJs\nZSh1bikpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RCYXNpY1Bl\ncnNpc3RlbmNlQ2FwYWJsZUJlaGF2aW9yKCkgew0KICAgICAgICBVbmVuaGFu\nY2VkVHlwZSB1biA9IG5ld1VuZW5oYW5jZWRJbnN0YW5jZSgpOw0KICAgICAg\nICB1bi5zZXRTdHJpbmdGaWVsZCgiYmFyIik7DQogICAgICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFi\nbGUodW4sDQogICAgICAgICAgICBlbWYuZ2V0Q29uZmlndXJhdGlvbigpKTsN\nCiAgICAgICAgYXNzZXJ0RmFsc2UocGMucGNJc0RlbGV0ZWQoKSk7DQogICAg\nICAgIGFzc2VydEZhbHNlKHBjLnBjSXNEaXJ0eSgpKTsNCiAgICAgICAgYXNz\nZXJ0RmFsc2UocGMucGNJc05ldygpKTsNCiAgICAgICAgYXNzZXJ0RmFsc2Uo\ncGMucGNJc1BlcnNpc3RlbnQoKSk7DQogICAgICAgIGFzc2VydEZhbHNlKHBj\nLnBjSXNUcmFuc2FjdGlvbmFsKCkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHRlc3RQQ1JlZ2lzdHJ5KCkgew0KICAgICAgICBhc3NlcnRUcnVlKFBD\nUmVnaXN0cnkuaXNSZWdpc3RlcmVkKGdldFVuZW5oYW5jZWRDbGFzcygpKSk7\nDQogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IFBDUmVnaXN0cnku\nbmV3SW5zdGFuY2UoDQogICAgICAgICAgICBnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKSwgbnVsbCwgZmFsc2UpOw0KICAgICAgICBhc3NlcnROb3ROdWxsKHBjKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2xlYXJpbmdPblN1YnR5\ncGVJbnN0YW5jZSgpIHsNCiAgICAgICAgLy8gdGhlIGJvb2xlYW4gYXQgdGhl\nIGVuZCBvZiBuZXdJbnN0YW5jZSB3aWxsIGNhdXNlIGNsZWFyIHRvIGJlIGlu\ndm9rZWQNCiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4gPSAoVW5lbmhhbmNl\nZFR5cGUpDQogICAgICAgICAgICBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKGdl\ndFVuZW5oYW5jZWRDbGFzcygpLCBudWxsLCB0cnVlKTsNCiAgICAgICAgYXNz\nZXJ0RXF1YWxzKG51bGwsIHVuLmdldFN0cmluZ0ZpZWxkKCkpOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RHZXRPYmplY3RJZE9uT3BlbkpQQVR5\ncGUoKSB7DQogICAgICAgIGdldE9iamVjdElkSGVscGVyKHRydWUsIGZhbHNl\nKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0T2JqZWN0SWRP\nbk9wZW5KUEFUeXBlU3ViY2xhc3MoKSB7DQogICAgICAgIGdldE9iamVjdElk\nSGVscGVyKGZhbHNlLCBmYWxzZSk7DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgdGVzdEdldE9iamVjdElkT25Vc2VyRGVmaW5lZCgpIHsNCiAgICAgICAg\nZ2V0T2JqZWN0SWRIZWxwZXIodHJ1ZSwgdHJ1ZSk7DQogICAgfQ0KDQogICAg\ncHVibGljIHZvaWQgdGVzdEdldE9iamVjdElkT25Vc2VyRGVmaW5lZFN1YmNs\nYXNzKCkgew0KICAgICAgICBnZXRPYmplY3RJZEhlbHBlcihmYWxzZSwgdHJ1\nZSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGdldE9iamVjdElkSGVs\ncGVyKGJvb2xlYW4gc3ViLCBib29sZWFuIHVzZXJEZWZpbmVkKSB7DQogICAg\nICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsNCiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdp\nbigpOw0KICAgICAgICBVbmVuaGFuY2VkVHlwZSB1biA9IG5ld0luc3RhbmNl\nKHN1Yik7DQogICAgICAgIGVtLnBlcnNpc3QodW4pOw0KICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOw0KDQogICAgICAgIGlmICghdXNl\nckRlZmluZWQpIHsNCiAgICAgICAgICAgIGVtLmNsb3NlKCk7DQogICAgICAg\nICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAg\nICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhhbmNlZENsYXNzKCksIHVuLmdl\ndElkKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgYXNzZXJ0Tm90TnVsbChl\nbS5nZXRPYmplY3RJZCh1bikpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lk\nIHRlc3RPcGVyYXRpb25zT25Vc2VyRGVmaW5lZCgpIHsNCiAgICAgICAgb3Bz\nSGVscGVyKGZhbHNlLCB0cnVlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U3ViY2xhc3NPcGVyYXRpb25zT25Vc2VyRGVmaW5lZCgpIHsNCiAg\nICAgICAgb3BzSGVscGVyKHRydWUsIHRydWUpOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyB2b2lkIHRlc3RPcGVyYXRpb25zT25PcGVuSlBBRGVmaW5lZCgpIHsN\nCiAgICAgICAgb3BzSGVscGVyKGZhbHNlLCBmYWxzZSk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgdGVzdFN1YmNsYXNzT3BlcmF0aW9uc09uT3BlbkpQ\nQURlZmluZWQoKSB7DQogICAgICAgIG9wc0hlbHBlcih0cnVlLCBmYWxzZSk7\nDQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIG9wc0hlbHBlcihib29sZWFu\nIHN1YiwgYm9vbGVhbiB1c2VyRGVmaW5lZCkgew0KICAgICAgICBPcGVuSlBB\nRW50aXR5TWFuYWdlciBlbSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBVbmVuaGFuY2VkVHlwZSB1biA9IG5ld0luc3RhbmNlKHN1Yik7\nDQogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nDQoNCiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsN\nCiAgICAgICAgICAgIGVtLnBlcnNpc3QodW4pOw0KICAgICAgICAgICAgdW4u\nc2V0U3RyaW5nRmllbGQoImJhciIpOw0KICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJiYXIiLCB1bi5nZXRTdHJpbmdGaWVsZCgpKTsNCiAgICAgICAgICAg\nIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4dChlbSwgdW4sIHRydWUsIHRydWUs\nIHN1Yik7DQogICAgICAgICAgICBlbS5mbHVzaCgpOw0KICAgICAgICAgICAg\nYXNzZXJ0UGVyc2lzdGVuY2VDb250ZXh0KGVtLCB1biwgdHJ1ZSwgdHJ1ZSwg\nc3ViKTsNCiAgICAgICAgICAgIGFzc2VydFRydWUodW4uZ2V0SWQoKSAhPSAw\nKTsNCiAgICAgICAgICAgIFVuZW5oYW5jZWRUeXBlIHVuMiA9IGVtLmZpbmQo\nZ2V0VW5lbmhhbmNlZENsYXNzKCksIHVuLmdldElkKCkpOw0KICAgICAgICAg\nICAgYXNzZXJ0U2FtZSh1biwgdW4yKTsNCiAgICAgICAgICAgIGVtLmdldFRy\nYW5zYWN0aW9uKCkuY29tbWl0KCk7DQogICAgICAgICAgICBhc3NlcnRQZXJz\naXN0ZW5jZUNvbnRleHQoZW0sIHVuLCBmYWxzZSwgZmFsc2UsIHN1Yik7DQog\nICAgICAgICAgICB1bjIgPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFzcygp\nLCB1bi5nZXRJZCgpKTsNCiAgICAgICAgICAgIGFzc2VydFNhbWUodW4sIHVu\nMik7DQoNCiAgICAgICAgICAgIGlmICghdXNlckRlZmluZWQpIHsNCiAgICAg\nICAgICAgICAgICBlbS5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIGVtID0g\nZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAgICAgIH0NCg0K\nICAgICAgICAgICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFzcygp\nLCB1bi5nZXRJZCgpKTsNCiAgICAgICAgICAgIGFzc2VydE5vdE51bGwodW4p\nOw0KICAgICAgICAgICAgaWYgKCF1c2VyRGVmaW5lZCkNCiAgICAgICAgICAg\nICAgICBhc3NlcnRUcnVlKHVuIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBh\nYmxlKTsNCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiYmFyIiwgdW4uZ2V0\nU3RyaW5nRmllbGQoKSk7DQogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7DQogICAgICAgICAgICB1bi5zZXRTdHJpbmdGaWVsZCgi\nYmF6Iik7DQogICAgICAgICAgICBhc3NlcnRQZXJzaXN0ZW5jZUNvbnRleHQo\nZW0sIHVuLCB0cnVlLCB0cnVlLCBzdWIpOw0KICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJiYXoiLCB1bi5nZXRTdHJpbmdGaWVsZCgpKTsNCg0KICAgICAg\nICAgICAgaWYgKHN1YikNCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRT\ndWJ0eXBlKSB1bikuc2V0SW50RmllbGQoMTcpOw0KDQogICAgICAgICAgICBh\nc3NlcnRUcnVlKGVtLmlzRGlydHkodW4pKTsNCiAgICAgICAgICAgIA0KICAg\nICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsNCg0KICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHZhbHVlcyBhcmUgc3Rp\nbGwgdXAtdG8tZGF0ZSBhZnRlcg0KICAgICAgICAgICAgLy8gdGhlIGNvbW1p\ndCBoYXBwZW5zDQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoImJheiIsIHVu\nLmdldFN0cmluZ0ZpZWxkKCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAg\nICBlbS5jbG9zZSgpOw0KDQogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgICAgICB1biA9IGVtLmZpbmQoZ2V0\nVW5lbmhhbmNlZENsYXNzKCksIHVuLmdldElkKCkpOw0KICAgICAgICAgICAg\nYXNzZXJ0Tm90TnVsbCh1bik7DQogICAgICAgICAgICBhc3NlcnRUcnVlKHVu\nIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKTsNCiAgICAgICAgICAg\nIGFzc2VydEVxdWFscygiYmF6IiwgdW4uZ2V0U3RyaW5nRmllbGQoKSk7DQog\nICAgICAgICAgICBpZiAoc3ViKQ0KICAgICAgICAgICAgICAgIGFzc2VydEVx\ndWFscygxNywgKChVbmVuaGFuY2VkU3VidHlwZSkgdW4pLmdldEludEZpZWxk\nKCkpOw0KICAgICAgICAgICAgZW0uY2xvc2UoKTsNCiAgICAgICAgfSBmaW5h\nbGx5IHsNCiAgICAgICAgICAgIGlmIChlbSAhPSBudWxsICYmIGVtLmdldFRy\nYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkNCiAgICAgICAgICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7DQogICAgICAgICAgICBpZiAo\nZW0gIT0gbnVsbCAmJiBlbS5pc09wZW4oKSkNCiAgICAgICAgICAgICAgICBl\nbS5jbG9zZSgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2\nb2lkIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4dChPcGVuSlBBRW50aXR5TWFu\nYWdlciBlbSwNCiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4sIGJvb2xlYW4g\ndHJhbnNhY3Rpb25hbCwgYm9vbGVhbiBkaXJ0eSwgYm9vbGVhbiBzdWIpIHsN\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKHRyYW5zYWN0aW9uYWwsIGVtLmdldFRy\nYW5zYWN0aW9uYWxPYmplY3RzKCkuY29udGFpbnModW4pKTsNCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKGRpcnR5LCBlbS5nZXREaXJ0eU9iamVjdHMoKS5jb250\nYWlucyh1bikpOw0KICAgICAgICBpZiAoZGlydHkpIHsNCiAgICAgICAgICAg\nIENsYXNzIGNscyA9IHN1YiA/IGdldFVuZW5oYW5jZWRTdWJjbGFzcygpIDog\nZ2V0VW5lbmhhbmNlZENsYXNzKCk7DQogICAgICAgICAgICBhc3NlcnRUcnVl\nKGVtLmdldFVwZGF0ZWRDbGFzc2VzKCkuY29udGFpbnMoY2xzKQ0KICAgICAg\nICAgICAgICAgIHx8IGVtLmdldFBlcnNpc3RlZENsYXNzZXMoKS5jb250YWlu\ncyhjbHMpKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lk\nIHRlc3RSZWxhdGlvbnMoKSB7DQogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5h\nZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAg\nZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOw0KICAgICAgICBVbmVuaGFu\nY2VkU3VidHlwZSB1biA9IG5ld1VuZW5oYW5jZWRTdWJjbGFzc0luc3RhbmNl\nKCk7DQogICAgICAgIGVtLnBlcnNpc3QodW4pOw0KICAgICAgICB1bi5zZXRT\ndHJpbmdGaWVsZCgiYW9ldSIpOw0KICAgICAgICBVbmVuaGFuY2VkU3VidHlw\nZSByZWxhdGVkID0gbmV3VW5lbmhhbmNlZFN1YmNsYXNzSW5zdGFuY2UoKTsN\nCiAgICAgICAgdW4uc2V0UmVsYXRlZChyZWxhdGVkKTsNCiAgICAgICAgcmVs\nYXRlZC5zZXRTdHJpbmdGaWVsZCgic250aCIpOw0KICAgICAgICBlbS5nZXRU\ncmFuc2FjdGlvbigpLmNvbW1pdCgpOw0KICAgICAgICBlbS5jbG9zZSgpOw0K\nDQogICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAg\nICAgICAgdW4gPSAoVW5lbmhhbmNlZFN1YnR5cGUpIGVtLmZpbmQoZ2V0VW5l\nbmhhbmNlZENsYXNzKCksIHVuLmdldElkKCkpOw0KICAgICAgICBhc3NlcnRF\ncXVhbHMoImFvZXUiLCB1bi5nZXRTdHJpbmdGaWVsZCgpKTsNCiAgICAgICAg\nYXNzZXJ0Tm90TnVsbCh1bi5nZXRSZWxhdGVkKCkpOw0KICAgICAgICBhc3Nl\ncnRFcXVhbHMoInNudGgiLCB1bi5nZXRSZWxhdGVkKCkuZ2V0U3RyaW5nRmll\nbGQoKSk7DQogICAgICAgIGVtLmNsb3NlKCk7DQogICAgfQ0KDQogICAgcHVi\nbGljIHZvaWQgdGVzdEVuaGFuY2VyKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsN\nCiAgICAgICAgTGlzdDxDbGFzcz4gc3VicyA9ICBNYW5hZ2VkQ2xhc3NTdWJj\nbGFzc2VyLnByZXBhcmVVbmVuaGFuY2VkQ2xhc3NlcygNCiAgICAgICAgICAg\nIGVtZi5nZXRDb25maWd1cmF0aW9uKCksDQogICAgICAgICAgICBDb2xsZWN0\naW9ucy5zaW5nbGV0b24oZ2V0VW5lbmhhbmNlZENsYXNzKCkpLCBudWxsKTsN\nCiAgICAgICAgQ2xhc3Mgc3ViID0gc3Vicy5nZXQoMCk7DQogICAgICAgIGFz\nc2VydE5vdE51bGwoc3ViKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS4iDQogICAgICAgICAgICArIGdldFVu\nZW5oYW5jZWRDbGFzcygpLmdldE5hbWUoKS5yZXBsYWNlKCcuJywgJyQnKSAr\nICIkcGNzdWJjbGFzcyIsDQogICAgICAgICAgICBzdWIuZ2V0TmFtZSgpKTsN\nCiAgICAgICAgYXNzZXJ0VHJ1ZShQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbShzdWIpKTsNCiAgICAgICAgYXNzZXJ0VHJ1ZShn\nZXRVbmVuaGFuY2VkQ2xhc3MoKS5pc0Fzc2lnbmFibGVGcm9tKHN1YikpOw0K\nICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RQQ1N1YmNsYXNzTmFtZSgp\nIHsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS4iDQogICAgICAgICAgICArIGdldFVuZW5oYW5jZWRDbGFzcygp\nLmdldE5hbWUoKS5yZXBsYWNlKCcuJywgJyQnKSArICIkcGNzdWJjbGFzcyIs\nDQogICAgICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoZ2V0\nVW5lbmhhbmNlZENsYXNzKCkpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0RXZpY3Rpb25JblVzZXJDcmVhdGVkSW5zdGFuY2UoKQ0KICAgICAg\nICB0aHJvd3MgTm9TdWNoRmllbGRFeGNlcHRpb24sIElsbGVnYWxBY2Nlc3NF\neGNlcHRpb24gew0KICAgICAgICBldmljdGlvbkhlbHBlcih0cnVlKTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0RXZpY3Rpb25Jbk9wZW5KUEFD\ncmVhdGVkSW5zdGFuY2UoKQ0KICAgICAgICB0aHJvd3MgTm9TdWNoRmllbGRF\neGNlcHRpb24sIElsbGVnYWxBY2Nlc3NFeGNlcHRpb24gew0KICAgICAgICBl\ndmljdGlvbkhlbHBlcihmYWxzZSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2\nb2lkIGV2aWN0aW9uSGVscGVyKGJvb2xlYW4gdXNlckRlZmluZWQpDQogICAg\nICAgIHRocm93cyBOb1N1Y2hGaWVsZEV4Y2VwdGlvbiwgSWxsZWdhbEFjY2Vz\nc0V4Y2VwdGlvbiB7DQogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVt\nID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAgVW5lbmhh\nbmNlZFR5cGUgdW4gPSBuZXdVbmVuaGFuY2VkSW5zdGFuY2UoKTsNCiAgICAg\nICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOw0KICAgICAgICBlbS5w\nZXJzaXN0KHVuKTsNCiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21t\naXQoKTsNCg0KICAgICAgICBpZiAoIXVzZXJEZWZpbmVkKSB7DQogICAgICAg\nICAgICBlbS5jbG9zZSgpOw0KICAgICAgICAgICAgZW0gPSBlbWYuY3JlYXRl\nRW50aXR5TWFuYWdlcigpOw0KICAgICAgICAgICAgdW4gPSBlbS5maW5kKGdl\ndFVuZW5oYW5jZWRDbGFzcygpLCB1bi5nZXRJZCgpKTsNCiAgICAgICAgICAg\nIGFzc2VydFRydWUoZ2V0VW5lbmhhbmNlZENsYXNzKCkgIT0gdW4uZ2V0Q2xh\nc3MoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBlbS5ldmljdCh1bik7DQog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSAoT3BlbkpQQVN0YXRl\nTWFuYWdlcikNCiAgICAgICAgICAgIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5j\nZUNhcGFibGUodW4sIG51bGwpLnBjR2V0U3RhdGVNYW5hZ2VyKCk7DQoNCiAg\nICAgICAgLy8gd2Ugb25seSBleHBlY3QgbGF6eSBsb2FkaW5nIHRvIHdvcmsg\nd2hlbiB3ZSBjYW4gcmVkZWZpbmUgY2xhc3Nlcw0KICAgICAgICAvLyBvciB3\naGVuIGFjY2Vzc2luZyBhIHByb3BlcnR5LWFjY2VzcyByZWNvcmQgdGhhdCBP\ncGVuSlBBIGNyZWF0ZWQuDQogICAgICAgIGlmIChDbGFzc1JlZGVmaW5lci5j\nYW5SZWRlZmluZUNsYXNzZXMoKQ0KICAgICAgICAgICAgfHwgKCF1c2VyRGVm\naW5lZCAmJiBzbS5nZXRNZXRhRGF0YSgpLmdldEFjY2Vzc1R5cGUoKQ0KICAg\nICAgICAgICAgICAgICE9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSkg\new0KDQogICAgICAgICAgICBhc3NlcnRGYWxzZShzbS5nZXRMb2FkZWQoKQ0K\nICAgICAgICAgICAgICAgIC5nZXQoc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVs\nZCgic3RyaW5nRmllbGQiKS5nZXRJbmRleCgpKSk7DQoNCiAgICAgICAgICAg\nIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSB2YWx1ZSB3YXMgY2xlYXJlZC4uLg0K\nICAgICAgICAgICAgRmllbGQgZmllbGQgPSBnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKS5nZXREZWNsYXJlZEZpZWxkKA0KICAgICAgICAgICAgICAgIGlzRmllbGRB\nY2Nlc3NUZXN0KCkgPyAic3RyaW5nRmllbGQiIDogInNmIik7DQogICAgICAg\nICAgICBmaWVsZC5zZXRBY2Nlc3NpYmxlKHRydWUpOw0KICAgICAgICAgICAg\nYXNzZXJ0RXF1YWxzKG51bGwsIGZpZWxkLmdldCh1bikpOw0KDQogICAgICAg\nICAgICAvLyAuLi4gYW5kIHRoYXQgaXQgZ2V0cyByZWxvYWRlZCBwcm9wZXJs\neQ0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJmb28iLCB1bi5nZXRTdHJp\nbmdGaWVsZCgpKTsNCiAgICAgICAgICAgIGFzc2VydFRydWUoc20uZ2V0TG9h\nZGVkKCkNCiAgICAgICAgICAgICAgICAuZ2V0KHNtLmdldE1ldGFEYXRhKCku\nZ2V0RmllbGQoInN0cmluZ0ZpZWxkIikuZ2V0SW5kZXgoKSkpOw0KICAgICAg\nICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gdW5yZWRlZmluZWQgcHJvcGVy\ndGllcyB3aXRoIHVzZXItZGVmaW5lZCBpbnN0YW5jZSwgb3IgYW55DQogICAg\nICAgICAgICAvLyB1bnJlZGVmaW5lZCBmaWVsZCBhY2Nlc3MNCiAgICAgICAg\nICAgIGFzc2VydFRydWUoc20uZ2V0TG9hZGVkKCkNCiAgICAgICAgICAgICAg\nICAuZ2V0KHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoInN0cmluZ0ZpZWxk\nIikuZ2V0SW5kZXgoKSkpOw0KDQogICAgICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhhdCB0aGUgdmFsdWUgd2FzIG5vdCBjbGVhcmVkDQogICAgICAgICAgICBG\naWVsZCBmaWVsZCA9IGdldFVuZW5oYW5jZWRDbGFzcygpLmdldERlY2xhcmVk\nRmllbGQoDQogICAgICAgICAgICAgICAgaXNGaWVsZEFjY2Vzc1Rlc3QoKSA/\nICJzdHJpbmdGaWVsZCIgOiAic2YiKTsNCiAgICAgICAgICAgIGZpZWxkLnNl\ndEFjY2Vzc2libGUodHJ1ZSk7DQogICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nImZvbyIsIGZpZWxkLmdldCh1bikpOw0KICAgICAgICB9DQoNCiAgICAgICAg\nZW0uY2xvc2UoKTsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qg\nYm9vbGVhbiBpc0ZpZWxkQWNjZXNzVGVzdCgpOw0KDQogICAgcHVibGljIHZv\naWQgdGVzdExhenlMb2FkaW5nKCkNCiAgICAgICAgdGhyb3dzIE5vU3VjaEZp\nZWxkRXhjZXB0aW9uLCBJbGxlZ2FsQWNjZXNzRXhjZXB0aW9uIHsNCiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5\nTWFuYWdlcigpOw0KICAgICAgICBVbmVuaGFuY2VkVHlwZSB1biA9IG5ld1Vu\nZW5oYW5jZWRJbnN0YW5jZSgpOw0KICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7DQogICAgICAgIGVtLnBlcnNpc3QodW4pOw0KICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOw0KICAgICAgICBlbS5j\nbG9zZSgpOw0KDQogICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFn\nZXIoKTsNCiAgICAgICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFz\ncygpLCB1bi5nZXRJZCgpKTsNCiAgICAgICAgYXNzZXJ0VHJ1ZShnZXRVbmVu\naGFuY2VkQ2xhc3MoKSAhPSB1bi5nZXRDbGFzcygpKTsNCiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKQ0K\nICAgICAgICAgICAgSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh1\nbiwgbnVsbCkucGNHZXRTdGF0ZU1hbmFnZXIoKTsNCg0KICAgICAgICAvLyB3\nZSBvbmx5IGV4cGVjdCBsYXp5IGxvYWRpbmcgdG8gd29yayB3aGVuIHdlIGNh\nbiByZWRlZmluZSBjbGFzc2VzDQogICAgICAgIC8vIG9yIHdoZW4gYWNjZXNz\naW5nIGEgcHJvcGVydHktYWNjZXNzIHJlY29yZCB0aGF0IE9wZW5KUEEgY3Jl\nYXRlZC4NCiAgICAgICAgaWYgKENsYXNzUmVkZWZpbmVyLmNhblJlZGVmaW5l\nQ2xhc3NlcygpDQogICAgICAgICAgICB8fCAoc20uZ2V0TWV0YURhdGEoKS5n\nZXRBY2Nlc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQp\nKQ0KICAgICAgICB7DQogICAgICAgICAgICBhc3NlcnRGYWxzZShzbS5nZXRM\nb2FkZWQoKQ0KICAgICAgICAgICAgICAgIC5nZXQoc20uZ2V0TWV0YURhdGEo\nKS5nZXRGaWVsZCgibGF6eUZpZWxkIikuZ2V0SW5kZXgoKSkpOw0KDQogICAg\nICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgdmFsdWUgd2FzIGNsZWFy\nZWQNCiAgICAgICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0VW5lbmhhbmNlZENs\nYXNzKCkuZ2V0RGVjbGFyZWRGaWVsZCgibGF6eUZpZWxkIik7DQogICAgICAg\nICAgICBmaWVsZC5zZXRBY2Nlc3NpYmxlKHRydWUpOw0KICAgICAgICAgICAg\nYXNzZXJ0RXF1YWxzKG51bGwsIGZpZWxkLmdldCh1bikpOw0KICAgICAgICB9\nIGVsc2Ugew0KICAgICAgICAgICAgLy8gdW5yZWRlZmluZWQgZmllbGQgYWNj\nZXNzDQogICAgICAgICAgICBhc3NlcnRUcnVlKHNtLmdldExvYWRlZCgpDQog\nICAgICAgICAgICAgICAgLmdldChzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxk\nKCJsYXp5RmllbGQiKS5nZXRJbmRleCgpKSk7DQoNCiAgICAgICAgICAgIC8v\nIG1ha2Ugc3VyZSB0aGF0IHRoZSB2YWx1ZSB3YXMgbG9hZGVkIGFscmVhZHkN\nCiAgICAgICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0VW5lbmhhbmNlZENsYXNz\nKCkuZ2V0RGVjbGFyZWRGaWVsZCgibGF6eUZpZWxkIik7DQogICAgICAgICAg\nICBmaWVsZC5zZXRBY2Nlc3NpYmxlKHRydWUpOw0KICAgICAgICAgICAgYXNz\nZXJ0RXF1YWxzKCJsYXp5IiwgZmllbGQuZ2V0KHVuKSk7DQogICAgICAgIH0N\nCg0KICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgdmFsdWUgaXMgYXZh\naWxhYmxlLCBvbmUgd2F5IG9yIGFub3RoZXINCiAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJsYXp5IiwgdW4uZ2V0TGF6eUZpZWxkKCkpOw0KICAgICAgICBhc3Nl\ncnRUcnVlKHNtLmdldExvYWRlZCgpDQogICAgICAgICAgICAuZ2V0KHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RmllbGQoImxhenlGaWVsZCIpLmdldEluZGV4KCkp\nKTsNCg0KICAgICAgICBlbS5jbG9zZSgpOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIHRlc3RTZXJpYWxpemF0aW9uT2ZVc2VyRGVmaW5lZEluc3RhbmNl\nKCkNCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uIHsNCiAgICAgICAgc2VyaWFsaXphdGlvbkhlbHBlcih0cnVl\nLCBmYWxzZSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdFNlcmlh\nbGl6YXRpb25PZlVzZXJEZWZpbmVkU3ViY2xhc3NJbnN0YW5jZSgpDQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlv\nbiB7DQogICAgICAgIHNlcmlhbGl6YXRpb25IZWxwZXIodHJ1ZSwgdHJ1ZSk7\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdFNlcmlhbGl6YXRpb25P\nZk9wZW5KUEFEZWZpbmVkSW5zdGFuY2UoKQ0KICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gew0KICAgICAgICBz\nZXJpYWxpemF0aW9uSGVscGVyKGZhbHNlLCBmYWxzZSk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgdGVzdFNlcmlhbGl6YXRpb25PZk9wZW5KUEFEZWZp\nbmVkU3ViY2xhc3NJbnN0YW5jZSgpDQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7DQogICAgICAgIHNlcmlh\nbGl6YXRpb25IZWxwZXIoZmFsc2UsIHRydWUpOw0KICAgIH0NCg0KICAgIHBy\naXZhdGUgdm9pZCBzZXJpYWxpemF0aW9uSGVscGVyKGJvb2xlYW4gdXNlckRl\nZmluZWQsIGJvb2xlYW4gc3ViKQ0KICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gew0KICAgICAgICBPcGVuSlBB\nRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nDQogICAgICAgIFVuZW5oYW5jZWRUeXBlIHVuID0gbmV3SW5zdGFuY2Uoc3Vi\nKTsNCiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOw0KICAg\nICAgICBlbS5wZXJzaXN0KHVuKTsNCg0KICAgICAgICBpZiAoc3ViKSB7DQog\nICAgICAgICAgICBVbmVuaGFuY2VkVHlwZSByZWxhdGVkID0gbmV3SW5zdGFu\nY2UoZmFsc2UpOw0KICAgICAgICAgICAgcmVsYXRlZC5zZXRTdHJpbmdGaWVs\nZCgicmVsYXRlZCIpOw0KICAgICAgICAgICAgKChVbmVuaGFuY2VkU3VidHlw\nZSkgdW4pLnNldFJlbGF0ZWQocmVsYXRlZCk7DQogICAgICAgIH0NCg0KICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOw0KDQogICAgICAg\nIGlmICghdXNlckRlZmluZWQpIHsNCiAgICAgICAgICAgIGVtLmNsb3NlKCk7\nDQogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nDQogICAgICAgIH0NCg0KICAgICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhh\nbmNlZENsYXNzKCksIHVuLmdldElkKCkpOw0KICAgICAgICBCeXRlQXJyYXlP\ndXRwdXRTdHJlYW0gb3V0ID0gbmV3IEJ5dGVBcnJheU91dHB1dFN0cmVhbSgp\nOw0KICAgICAgICBPYmplY3RPdXRwdXRTdHJlYW0gb291dCA9IG5ldyBPYmpl\nY3RPdXRwdXRTdHJlYW0ob3V0KTsNCiAgICAgICAgb291dC53cml0ZU9iamVj\ndCh1bik7DQogICAgICAgIG9vdXQuZmx1c2goKTsNCiAgICAgICAgYnl0ZVtd\nIGJ5dGVzID0gb3V0LnRvQnl0ZUFycmF5KCk7DQoNCiAgICAgICAgT2JqZWN0\nSW5wdXRTdHJlYW0gb2luID0gbmV3IE9iamVjdElucHV0U3RyZWFtKA0KICAg\nICAgICAgICAgbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFtKGJ5dGVzKSk7DQog\nICAgICAgIFVuZW5oYW5jZWRUeXBlIGRlc2VyaWFsaXplZCA9IChVbmVuaGFu\nY2VkVHlwZSkgb2luLnJlYWRPYmplY3QoKTsNCg0KICAgICAgICBjb3BpZWRJ\nbnN0YW5jZUhlbHBlcihzdWIsIGVtLCB1biwgZGVzZXJpYWxpemVkLCBmYWxz\nZSk7DQogICAgICAgIGVtLmNsb3NlKCk7DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgdGVzdENsb25pbmdPZlVzZXJEZWZpbmVkSW5zdGFuY2UoKQ0KICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRp\nb24sIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsNCiAgICAgICAgY2xv\nbmVIZWxwZXIodHJ1ZSwgZmFsc2UpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHRlc3RDbG9uaW5nT2ZVc2VyRGVmaW5lZFN1YmNsYXNzSW5zdGFuY2Uo\nKQ0KICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRF\neGNlcHRpb24sIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsNCiAgICAg\nICAgY2xvbmVIZWxwZXIodHJ1ZSwgdHJ1ZSk7DQogICAgfQ0KDQogICAgcHVi\nbGljIHZvaWQgdGVzdENsb25pbmdPZk9wZW5KUEFEZWZpbmVkSW5zdGFuY2Uo\nKQ0KICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRF\neGNlcHRpb24sIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsNCiAgICAg\nICAgY2xvbmVIZWxwZXIoZmFsc2UsIGZhbHNlKTsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0Q2xvbmluZ09mT3BlbkpQQURlZmluZWRTdWJjbGFz\nc0luc3RhbmNlKCkNCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uLCBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlv\nbiB7DQogICAgICAgIGNsb25lSGVscGVyKGZhbHNlLCB0cnVlKTsNCiAgICB9\nDQoNCiAgICBwcml2YXRlIHZvaWQgY2xvbmVIZWxwZXIoYm9vbGVhbiB1c2Vy\nRGVmaW5lZCwgYm9vbGVhbiBzdWIpDQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RTdXBwb3J0\nZWRFeGNlcHRpb24gew0KICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBl\nbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIFVuZW5o\nYW5jZWRUeXBlIHVuID0gbmV3SW5zdGFuY2Uoc3ViKTsNCiAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOw0KICAgICAgICBlbS5wZXJzaXN0\nKHVuKTsNCg0KICAgICAgICBpZiAoc3ViKSB7DQogICAgICAgICAgICBVbmVu\naGFuY2VkVHlwZSByZWxhdGVkID0gbmV3SW5zdGFuY2UoZmFsc2UpOw0KICAg\nICAgICAgICAgcmVsYXRlZC5zZXRTdHJpbmdGaWVsZCgicmVsYXRlZCIpOw0K\nICAgICAgICAgICAgKChVbmVuaGFuY2VkU3VidHlwZSkgdW4pLnNldFJlbGF0\nZWQocmVsYXRlZCk7DQogICAgICAgIH0NCg0KICAgICAgICBlbS5nZXRUcmFu\nc2FjdGlvbigpLmNvbW1pdCgpOw0KDQogICAgICAgIGlmICghdXNlckRlZmlu\nZWQpIHsNCiAgICAgICAgICAgIGVtLmNsb3NlKCk7DQogICAgICAgICAgICBl\nbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIH0NCg0K\nICAgICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhhbmNlZENsYXNzKCksIHVu\nLmdldElkKCkpOw0KICAgICAgICBVbmVuaGFuY2VkVHlwZSBjbG9uZWQgPSAo\nVW5lbmhhbmNlZFR5cGUpIHVuLmNsb25lKCk7DQoNCiAgICAgICAgY29waWVk\nSW5zdGFuY2VIZWxwZXIoc3ViLCBlbSwgdW4sIGNsb25lZCwgdHJ1ZSk7DQog\nICAgICAgIGVtLmNsb3NlKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lk\nIGNvcGllZEluc3RhbmNlSGVscGVyKGJvb2xlYW4gc3ViLCBPcGVuSlBBRW50\naXR5TWFuYWdlciBlbSwNCiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4sIFVu\nZW5oYW5jZWRUeXBlIGNvcHksIGJvb2xlYW4gdmlhQ2xvbmUpIHsNCiAgICAg\nICAgYXNzZXJ0Tm90U2FtZSh1biwgY29weSk7DQogICAgICAgIGlmICghdmlh\nQ2xvbmUpDQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoc3ViID8gZ2V0VW5l\nbmhhbmNlZFN1YmNsYXNzKCkgOiBnZXRVbmVuaGFuY2VkQ2xhc3MoKSwNCiAg\nICAgICAgICAgICAgICBjb3B5LmdldENsYXNzKCkpOw0KICAgICAgICBhc3Nl\ncnRFcXVhbHModW4uZ2V0SWQoKSwgY29weS5nZXRJZCgpKTsNCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKHVuLmdldFN0cmluZ0ZpZWxkKCksIGNvcHkuZ2V0U3Ry\naW5nRmllbGQoKSk7DQogICAgICAgIGlmIChzdWIpIHsNCiAgICAgICAgICAg\nIGFzc2VydEVxdWFscygNCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRT\ndWJ0eXBlKSB1bikuZ2V0SW50RmllbGQoKSwNCiAgICAgICAgICAgICAgICAo\nKFVuZW5oYW5jZWRTdWJ0eXBlKSBjb3B5KS5nZXRJbnRGaWVsZCgpKTsNCiAg\nICAgICAgICAgIGFzc2VydE5vdFNhbWUoDQogICAgICAgICAgICAgICAgKChV\nbmVuaGFuY2VkU3VidHlwZSkgdW4pLmdldFJlbGF0ZWQoKSwNCiAgICAgICAg\nICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSBjb3B5KS5nZXRSZWxhdGVk\nKCkpOw0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKA0KICAgICAgICAgICAg\nICAgICgoVW5lbmhhbmNlZFN1YnR5cGUpIHVuKS5nZXRSZWxhdGVkKCkuZ2V0\nSWQoKSwNCiAgICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSBj\nb3B5KS5nZXRSZWxhdGVkKCkuZ2V0SWQoKSk7DQogICAgICAgIH0NCg0KICAg\nICAgICBhc3NlcnRGYWxzZShlbS5pc0RldGFjaGVkKHVuKSk7DQogICAgICAg\nIGFzc2VydFRydWUoZW0uaXNEZXRhY2hlZChjb3B5KSk7DQogICAgICAgIGNv\ncHkuc2V0U3RyaW5nRmllbGQoIm9mZmxpbmUgdXBkYXRlIik7DQoNCiAgICAg\nICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOw0KICAgICAgICBhc3Nl\ncnRTYW1lKHVuLCBlbS5tZXJnZShjb3B5KSk7DQogICAgICAgIGFzc2VydFRy\ndWUoZW0uaXNEaXJ0eSh1bikpOw0KICAgICAgICBhc3NlcnRFcXVhbHMoIm9m\nZmxpbmUgdXBkYXRlIiwgdW4uZ2V0U3RyaW5nRmllbGQoKSk7DQogICAgICAg\nIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7DQogICAgfQ0KDQogICAg\ncHVibGljIHZvaWQgdGVzdExpc3RlbmVyc09uVXNlckRlZmluZWRJbnN0YW5j\nZSgpDQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3Vu\nZEV4Y2VwdGlvbiwgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gew0KICAg\nICAgICBsaXN0ZW5lckhlbHBlcih0cnVlLCBmYWxzZSk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgdGVzdExpc3RlbmVyc09uVXNlckRlZmluZWRTdWJj\nbGFzc0luc3RhbmNlKCkNCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBD\nbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBDbG9uZU5vdFN1cHBvcnRlZEV4Y2Vw\ndGlvbiB7DQogICAgICAgIGxpc3RlbmVySGVscGVyKHRydWUsIHRydWUpOw0K\nICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RMaXN0ZW5lcnNPbk9wZW5K\nUEFEZWZpbmVkSW5zdGFuY2UoKQ0KICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIENsb25lTm90U3VwcG9ydGVk\nRXhjZXB0aW9uIHsNCiAgICAgICAgbGlzdGVuZXJIZWxwZXIoZmFsc2UsIGZh\nbHNlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGlzdGVuZXJz\nT25PcGVuSlBBRGVmaW5lZFN1YmNsYXNzSW5zdGFuY2UoKQ0KICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIENs\nb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsNCiAgICAgICAgbGlzdGVuZXJI\nZWxwZXIoZmFsc2UsIHRydWUpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9p\nZCBsaXN0ZW5lckhlbHBlcihib29sZWFuIHVzZXJEZWZpbmVkLCBib29sZWFu\nIHN1YikNCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uLCBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7DQog\nICAgICAgIExpc3RlbmVySW1wbCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcklt\ncGwoKTsNCiAgICAgICAgZW1mLmFkZExpZmVjeWNsZUxpc3RlbmVyKGxpc3Rl\nbmVyLCAoQ2xhc3NbXSkgbnVsbCk7DQogICAgICAgIE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAg\nICAgVW5lbmhhbmNlZFR5cGUgdW4gPSBuZXdJbnN0YW5jZShzdWIpOw0KICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7DQogICAgICAgIGVt\nLnBlcnNpc3QodW4pOw0KICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNv\nbW1pdCgpOw0KDQogICAgICAgIGlmICghdXNlckRlZmluZWQpIHsNCiAgICAg\nICAgICAgIGVtLmNsb3NlKCk7DQogICAgICAgICAgICBlbSA9IGVtZi5jcmVh\ndGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIH0NCg0KICAgICAgICBsaXN0\nZW5lci5pbnZva2VkID0gZmFsc2U7DQoNCiAgICAgICAgdW4gPSBlbS5maW5k\nKGdldFVuZW5oYW5jZWRDbGFzcygpLCB1bi5nZXRJZCgpKTsNCiAgICAgICAg\nZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOw0KICAgICAgICB1bi5zZXRT\ndHJpbmdGaWVsZCgidXBkYXRlZCIpOw0KICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLmNvbW1pdCgpOw0KICAgICAgICBhc3NlcnRUcnVlKGxpc3RlbmVy\nLmludm9rZWQpOw0KICAgICAgICBlbS5jbG9zZSgpOw0KDQogICAgICAgIGFz\nc2VydEVxdWFscygidXBkYXRlZCIsIGxpc3RlbmVyLnN0cmluZ0ZpZWxkKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0TWV0YURhdGFPZlN1\nYnR5cGUoKSB7DQogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IEpQQUZh\nY2FkZUhlbHBlci5nZXRNZXRhRGF0YShlbWYsDQogICAgICAgICAgICBnZXRV\nbmVuaGFuY2VkQ2xhc3MoKSk7DQogICAgICAgIExpc3Q8Q2xhc3M+IHN1YnMg\nPSAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci5wcmVwYXJlVW5lbmhhbmNlZENs\nYXNzZXMoDQogICAgICAgICAgICBlbWYuZ2V0Q29uZmlndXJhdGlvbigpLA0K\nICAgICAgICAgICAgQ29sbGVjdGlvbnMuc2luZ2xldG9uKGdldFVuZW5oYW5j\nZWRDbGFzcygpKSwgbnVsbCk7DQogICAgICAgIGFzc2VydFNhbWUobWV0YSwg\nSlBBRmFjYWRlSGVscGVyLmdldE1ldGFEYXRhKGVtZiwgc3Vicy5nZXQoMCkp\nKTsNCg0KICAgICAgICBtZXRhID0gSlBBRmFjYWRlSGVscGVyLmdldE1ldGFE\nYXRhKGVtZiwgZ2V0VW5lbmhhbmNlZFN1YmNsYXNzKCkpOw0KICAgICAgICBz\ndWJzID0gIE1hbmFnZWRDbGFzc1N1YmNsYXNzZXIucHJlcGFyZVVuZW5oYW5j\nZWRDbGFzc2VzKA0KICAgICAgICAgICAgZW1mLmdldENvbmZpZ3VyYXRpb24o\nKSwNCiAgICAgICAgICAgIENvbGxlY3Rpb25zLnNpbmdsZXRvbihnZXRVbmVu\naGFuY2VkU3ViY2xhc3MoKSksIG51bGwpOw0KICAgICAgICBhc3NlcnRTYW1l\nKG1ldGEsIEpQQUZhY2FkZUhlbHBlci5nZXRNZXRhRGF0YShlbWYsIHN1YnMu\nZ2V0KDApKSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBjbGFzcyBMaXN0ZW5l\nckltcGwNCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdExpZmVjeWNsZUxpc3Rl\nbmVyIHsNCg0KICAgICAgICBTdHJpbmcgc3RyaW5nRmllbGQ7DQogICAgICAg\nIGJvb2xlYW4gaW52b2tlZDsNCg0KICAgICAgICBAT3ZlcnJpZGUNCiAgICAg\nICAgcHVibGljIHZvaWQgYWZ0ZXJTdG9yZShMaWZlY3ljbGVFdmVudCBldmVu\ndCkgew0KICAgICAgICAgICAgaW52b2tlZCA9IHRydWU7DQogICAgICAgICAg\nICBzdHJpbmdGaWVsZCA9ICgoVW5lbmhhbmNlZFR5cGUpIGV2ZW50LmdldFNv\ndXJjZSgpKS5nZXRTdHJpbmdGaWVsZCgpOw0KICAgICAgICB9DQogICAgfQ0K\nfQ==\n","encoding":"base64"}

