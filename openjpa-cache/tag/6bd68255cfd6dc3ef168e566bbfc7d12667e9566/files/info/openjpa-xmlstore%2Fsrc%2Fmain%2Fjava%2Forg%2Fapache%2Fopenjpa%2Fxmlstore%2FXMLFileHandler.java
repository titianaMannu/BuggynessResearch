{"sha":"247c8d12ad12e9c0a0a7ed45356d76fb7f8f4e12","node_id":"MDQ6QmxvYjIwNjM2NDoyNDdjOGQxMmFkMTJlOWMwYTBhN2VkNDUzNTZkNzZmYjdmOGY0ZTEy","size":24551,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/247c8d12ad12e9c0a0a7ed45356d76fb7f8f4e12","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEueG1sc3RvcmU7CgppbXBvcnQg\namF2YS5pby5CeXRlQXJyYXlJbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8u\nQnl0ZUFycmF5T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5GaWxlV3JpdGVyOwppbXBvcnQgamF2YS5pby5JT0V4\nY2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEu\naW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5pby5Xcml0ZXI7CmltcG9y\ndCBqYXZhLmxhbmcucmVmbGVjdC5Db25zdHJ1Y3RvcjsKaW1wb3J0IGphdmEu\nbWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7\nCmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9y\ndCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxvY2Fs\nZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZheC54bWwucGFy\nc2Vycy5TQVhQYXJzZXI7CgppbXBvcnQgb3JnLnhtbC5zYXguQXR0cmlidXRl\nczsKaW1wb3J0IG9yZy54bWwuc2F4LlNBWEV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy54bWwuc2F4LmhlbHBlcnMuRGVmYXVsdEhhbmRsZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkJhc2UxNkVuY29kZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnhtbC5YTUxGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwuWE1MV3JpdGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRF\neGNlcHRpb247CgovKioKICogU3RvcmVzIHtAbGluayBPYmplY3REYXRhfSBv\nYmplY3RzIGJ5IHNlcmlhbGl6aW5nIGEgY29sbGVjdGlvbgogKiBvZiB0aGVt\nIGludG8gYW5kIG91dCBvZiBhbiBYTUwgZmlsZS4KICovCnB1YmxpYyBjbGFz\ncyBYTUxGaWxlSGFuZGxlciB7CgogICAgcHJpdmF0ZSBmaW5hbCBYTUxDb25m\naWd1cmF0aW9uIF9jb25mOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3I7\nIHN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgWE1M\nRmlsZUhhbmRsZXIoWE1MQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\nX2NvbmYgPSBjb25mOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZHMgYWxs\nIGluc3RhbmNlcyBvZiA8Y29kZT5tZXRhPC9jb2RlPiBpbnRvIGEgbGlzdCBv\nZiBvYmplY3RzLgogICAgICogVGhlIGdpdmVuIDxjb2RlPm1ldGE8L2NvZGU+\nIG11c3QgcmVwcmVzZW50IGEgbGVhc3QtZGVyaXZlZAogICAgICogcGVyc2lz\ndGVuY2UtY2FwYWJsZSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBsb2FkKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIEZpbGUg\nZiA9IGdldEZpbGUobWV0YSk7CiAgICAgICAgaWYgKCEoKEJvb2xlYW4pIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5leGlzdHNBY3Rpb24oZikpKS5ib29sZWFuVmFsdWUoKSB8\nfCAKICAgICAgICAgICAgKChMb25nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubGVuZ3RoQWN0\naW9uKGYpKSkubG9uZ1ZhbHVlKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gcmVhZChmKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWFkIGEgY29sbGVjdGlvbiBvZiB7QGxpbmsgT2JqZWN0RGF0\nYX1zIGZyb20gdGhlIGNvbnRlbnRzIG9mIHRoZQogICAgICogZ2l2ZW4gZmls\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIHJlYWQoRmlsZSBm\nKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIHBhcnNl\nIHRoZSBmaWxlIGFuZCByZXR1cm4gdGhlIG9iamVjdHMgaXQgY29udGFpbnMK\nICAgICAgICBTQVhQYXJzZXIgcGFyc2VyID0gWE1MRmFjdG9yeS5nZXRTQVhQ\nYXJzZXIoZmFsc2UsIGZhbHNlKTsKICAgICAgICBPYmplY3REYXRhSGFuZGxl\nciBoYW5kbGVyID0gbmV3IE9iamVjdERhdGFIYW5kbGVyKF9jb25mKTsKICAg\nICAgICBwYXJzZXIucGFyc2UoZiwgaGFuZGxlcik7CiAgICAgICAgcmV0dXJu\nIGhhbmRsZXIuZ2V0RXh0ZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIGEge0BsaW5rIEZpbGV9IG9iamVjdCB0aGF0IDxjb2RlPm1ldGE8\nL2NvZGU+IGxpdmVzCiAgICAgKiBpbi4gVGhpcyBpbXBsZW1lbnRhdGlvbiBj\ncmVhdGVzIGEgZmlsZW5hbWUgZnJvbSB0aGUgZnVsbCBjbGFzcwogICAgICog\nbmFtZSBvZiB0aGUgdHlwZSBpZGVudGlmaWVkIGJ5IDxjb2RlPm1ldGE8L2Nv\nZGU+LCBhbmQgcmV0dXJucwogICAgICogYSB7QGxpbmsgRmlsZX0gb2JqZWN0\nIHRoYXQgaGFzIHRoaXMgZmlsZW5hbWUgYW5kIHdob3NlIGJhc2UKICAgICAq\nIGRpcmVjdG9yeSBpcyB0aGUgVVJMIGlkZW50aWZpZWQgYnkgdGhlIDxjb2Rl\nPkNvbm5lY3Rpb25VUkw8L2NvZGU+CiAgICAgKiBjb25maWd1cmF0aW9uIHBy\nb3BlcnR5LgogICAgICovCiAgICBwcml2YXRlIEZpbGUgZ2V0RmlsZShDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBGaWxlIGJhc2VEaXIgPSBuZXcg\nRmlsZShfY29uZi5nZXRDb25uZWN0aW9uVVJMKCkpOwogICAgICAgIHJldHVy\nbiBuZXcgRmlsZShiYXNlRGlyLCBtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5n\nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmVzIGFsbCBp\nbnN0YW5jZXMgaW4gPGNvZGU+ZGF0YXM8L2NvZGU+IGludG8gdGhlIGFwcHJv\ncHJpYXRlIGZpbGUsCiAgICAgKiBhcyBkaWN0YXRlZCBieSA8Y29kZT5tZXRh\nPC9jb2RlPi4KICAgICAqCiAgICAgKiBAcGFyYW0gbWV0YSB0aGUgbGVhc3Qt\nZGVyaXZlZCB0eXBlIG9mIHRoZSBpbnN0YW5jZXMgYmVpbmcgc3RvcmVkCiAg\nICAgKiBAcGFyYW0gZGF0YXMgYSBjb2xsZWN0aW9uIG9mIHtAbGluayBPYmpl\nY3REYXRhfSBpbnN0YW5jZXMsIGVhY2gKICAgICAqIG9mIHdoaWNoIHJlcHJl\nc2VudHMgYW4gb2JqZWN0IG9mIHR5cGUgPGNvZGU+bWV0YTwvY29kZT4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc3RvcmUoQ2xhc3NNZXRhRGF0YSBtZXRh\nLCBDb2xsZWN0aW9uIGRhdGFzKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0UENT\ndXBlcmNsYXNzKCkgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CgogICAgICAgIEZpbGUgZiA9IGdldEZpbGUo\nbWV0YSk7CiAgICAgICAgaWYgKCEoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5l\neGlzdHNBY3Rpb24oZi5nZXRQYXJlbnRGaWxlKCkpKSkuYm9vbGVhblZhbHVl\nKCkpCiAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubWtkaXJzQWN0aW9u\nKGYuZ2V0UGFyZW50RmlsZSgpKSk7CgogICAgICAgIEZpbGVXcml0ZXIgZncg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZ3ID0gbmV3IEZp\nbGVXcml0ZXIoZik7CiAgICAgICAgICAgIHdyaXRlKGRhdGFzLCBmdyk7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGZ3ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGZ3\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpb2UpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2l2ZW4gY29sbGVjdGlvbiBvZiB7\nQGxpbmsgT2JqZWN0RGF0YX1zIHRvIHRoZSBnaXZlbiBmaWxlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgd3JpdGUoQ29sbGVjdGlvbiBkYXRhcywgRmls\nZVdyaXRlciBmdykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBjcmVhdGUgYW4gWE1MIHByZXR0eSBwcmludGVyIHRvIHdyaXRlIG91\ndCB0aGUgb2JqZWN0cwogICAgICAgIFdyaXRlciBvdXQgPSBuZXcgWE1MV3Jp\ndGVyKGZ3KTsKCiAgICAgICAgLy8gc3RhcnQgdGhlIGZpbGU7IHRoZSByb290\nIG5vZGUgaXMgYW4gImV4dGVudCIKICAgICAgICBvdXQud3JpdGUoIjw/eG1s\nIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cIlVURi04XCI/PiIpOwogICAg\nICAgIG91dC53cml0ZSgiPGV4dGVudD4iKTsKCiAgICAgICAgLy8gcnVuIHRo\ncm91Z2ggZWFjaCBvYmplY3QgaW4gdGhlIGNvbGxlY3Rpb24KICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGRhdGFzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIE9iamVjdERhdGEgb2JqID0gKE9iamVj\ndERhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IG9iai5nZXRNZXRhRGF0YSgpOwoKICAgICAgICAgICAgLy8gd3Jp\ndGUgb3V0IHRoZSAib2JqZWN0IiBlbGVtZW50IHN0YXJ0CiAgICAgICAgICAg\nIG91dC53cml0ZSgiPG9iamVjdCBjbGFzcz1cIiIpOwogICAgICAgICAgICBv\ndXQud3JpdGUobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgb3V0LndyaXRlKCJcIiBvaWQ9XCIiKTsKICAgICAgICAg\nICAgb3V0LndyaXRlKG9iai5nZXRJZCgpLnRvU3RyaW5nKCkpOwogICAgICAg\nICAgICBvdXQud3JpdGUoIlwiIHZlcnNpb249XCIiKTsKICAgICAgICAgICAg\nb3V0LndyaXRlKG9iai5nZXRWZXJzaW9uKCkudG9TdHJpbmcoKSk7CiAgICAg\nICAgICAgIG91dC53cml0ZSgiXCI+Iik7CgogICAgICAgICAgICAvLyBydW4g\ndGhyb3VnaCBlYWNoIGZpZWxkIHdyaXRpbmcgb3V0IHRoZSB2YWx1ZQogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RmllbGRz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFu\nYWdlbWVudCgpICE9IGZtZHNbaV0uTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgb3V0\nLndyaXRlKCI8ZmllbGQgbmFtZT1cIiIpOwogICAgICAgICAgICAgICAgb3V0\nLndyaXRlKGZtZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIG91\ndC53cml0ZSgiXCI+Iik7CgogICAgICAgICAgICAgICAgLy8gd3JpdGUgb3V0\nIHRoZSBmaWVsZCBkYXRhIGRlcGVuZGluZyB1cG9uIHR5cGUKICAgICAgICAg\nICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gKENvbGxlY3Rpb24p\nIG9iai5nZXRGaWVsZChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd3JpdGUgb3V0IGVhY2gg\nb2YgdGhlIGVsZW1lbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIGludCBl\nbGVtVHlwZSA9IGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldFR5cGVDb2RlKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgY2kgPSBj\nLml0ZXJhdG9yKCk7IGNpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG91dC53cml0ZSgiPGVsZW1lbnQ+Iik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB3cml0ZURhdGFWYWx1ZShvdXQsIGVsZW1U\neXBlLCBjaS5uZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nb3V0LndyaXRlKCI8L2VsZW1lbnQ+Iik7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgICAgICAgICAgTWFwIG0gPSAoTWFwKSBvYmouZ2V0RmllbGQoaSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChtID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHdyaXRlIG91dCBlYWNoIG9mIHRoZSBtYXAgZW50cmllcwog\nICAgICAgICAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGVudHJpZXMgPSBt\nLmVudHJ5U2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBrZXlU\neXBlID0gZm1kc1tpXS5nZXRLZXkoKS5nZXRUeXBlQ29kZSgpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpbnQgdmFsdWVUeXBlID0gZm1kc1tpXS5nZXRF\nbGVtZW50KCkuZ2V0VHlwZUNvZGUoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBlaSA9IGVudHJpZXMuaXRlcmF0b3IoKTsgZWku\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWFw\nLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBlaS5uZXh0KCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBvdXQud3JpdGUoIjxrZXk+Iik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB3cml0ZURhdGFWYWx1ZShvdXQsIGtleVR5\ncGUsIGUuZ2V0S2V5KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nb3V0LndyaXRlKCI8L2tleT4iKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG91dC53cml0ZSgiPHZhbHVlPiIpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgd3JpdGVEYXRhVmFsdWUob3V0LCB2YWx1ZVR5cGUsIGUuZ2V0\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQud3Jp\ndGUoIjwvdmFsdWU+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlRGF0\nYVZhbHVlKG91dCwgZm1kc1tpXS5nZXRUeXBlQ29kZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgb2JqLmdldEZpZWxkKGkpKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIG91dC53cml0ZSgiPC9maWVsZD4i\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXQud3JpdGUoIjwvb2Jq\nZWN0PiIpOwogICAgICAgIH0KICAgICAgICBvdXQud3JpdGUoIjwvZXh0ZW50\nPiIpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgb3V0IHRoZSBkYXRh\nIHZhbHVlLiBUaGlzIG1ldGhvZCB3cml0ZXMgbnVsbHMgYXMgIm51bGwiLAog\nICAgICogc2VyaWFsaXplcyAodXNpbmcgSmF2YSBzZXJpYWxpemF0aW9uIGFu\nZCBiYXNlMTYgZW5jb2RpbmcpIG91dCBub24tCiAgICAgKiBwcmltaXRpdmVz\nL2JveGVkIHByaW1pdGl2ZXMgYW5kIG5vbi1wZXJzaXN0ZW50IHR5cGVzLCBh\nbmQgd3JpdGVzCiAgICAgKiBwcmltaXRpdmVzL2JveGVkIHByaW1pdGl2ZXMg\nYW5kIG9pZHMgdXNpbmcgdGhlaXIgdG9TdHJpbmcuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHdyaXRlRGF0YVZhbHVlKFdyaXRlciBvdXQsIGludCB0eXBl\nLCBPYmplY3QgdmFsKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gd3JpdGUgbnVsbHMgYXMgIm51bGwiCiAgICAgICAgaWYgKHZh\nbCA9PSBudWxsKSB7CiAgICAgICAgICAgIG91dC53cml0ZSgibnVsbCIpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2gg\nKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAg\nICBpZiAoISh2YWwgaW5zdGFuY2VvZiBTZXJpYWxpemFibGUpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgIkNhbm5vdCBzdG9yZSBub24tc2Vy\naWFsaXphYmxlLCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBu\nb24tcGVyc2lzdGVuY2UtY2FwYWJsZSB2YWx1ZTogIiArIHZhbCk7CgogICAg\nICAgICAgICAgICAgLy8gc2VyaWFsaXplIG91dCB0aGUgb2JqZWN0IGFuZCBl\nbmNvZGUgdGhlIHJlc3VsdCB3aXRoIGJhc2UxNgogICAgICAgICAgICAgICAg\nQnl0ZUFycmF5T3V0cHV0U3RyZWFtIGJhb3MgPSBuZXcgQnl0ZUFycmF5T3V0\ncHV0U3RyZWFtKDgxOTIpOwogICAgICAgICAgICAgICAgT2JqZWN0T3V0cHV0\nU3RyZWFtIG9vcyA9IG5ldyBPYmplY3RPdXRwdXRTdHJlYW0oYmFvcyk7CiAg\nICAgICAgICAgICAgICBvb3Mud3JpdGVPYmplY3QodmFsKTsKICAgICAgICAg\nICAgICAgIG9vcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgb3V0LndyaXRl\nKEJhc2UxNkVuY29kZXIuZW5jb2RlKGJhb3MudG9CeXRlQXJyYXkoKSkpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09C\nSjoKICAgICAgICAgICAgICAgIC8vIHF1b3RlIGNoYXJzIHNvIHdlIGNhbiBk\naXN0aW5ndWlzaCB3aGl0ZXNwYWNlIGNoYXJzOyBzcGVjaWFsCiAgICAgICAg\nICAgICAgICAvLyBjYXNlIGZvciBcMAogICAgICAgICAgICAgICAgY2hhciBj\nID0gKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCk7CiAgICAgICAgICAg\nICAgICBvdXQud3JpdGUoIiciKTsKICAgICAgICAgICAgICAgIGlmIChjID09\nICdcMCcpCiAgICAgICAgICAgICAgICAgICAgb3V0LndyaXRlKCIweDAiKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBvdXQu\nd3JpdGUoWE1MRW5jb2Rlci5lbmNvZGUodmFsLnRvU3RyaW5nKCkpKTsKICAg\nICAgICAgICAgICAgIG91dC53cml0ZSgiJyIpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAg\nICAgICAgICAgICAgICAvLyBxdW90ZSBzdHJpbmdzIHNvIHdlIGNhbiBkaXN0\naW5ndWlzaCBsZWFkaW5nIGFuZCB0cmFpbGluZwogICAgICAgICAgICAgICAg\nLy8gd2hpdGVzcGFjZQogICAgICAgICAgICAgICAgb3V0LndyaXRlKCJcIiIp\nOwogICAgICAgICAgICAgICAgb3V0LndyaXRlKFhNTEVuY29kZXIuZW5jb2Rl\nKHZhbC50b1N0cmluZygpKSk7CiAgICAgICAgICAgICAgICBvdXQud3JpdGUo\nIlwiIik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5Q\nQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgLy8gd3JpdGUgdGhlIHR5cGUg\nb2Ygb2lkIG9iamVjdCArICc6JyArIG9pZCBzdHJpbmcKICAgICAgICAgICAg\nICAgIG91dC53cml0ZSh2YWwuZ2V0Q2xhc3MoKS5nZXROYW1lKCkpOwogICAg\nICAgICAgICAgICAgb3V0LndyaXRlKCc6Jyk7CiAgICAgICAgICAgICAgICBv\ndXQud3JpdGUoWE1MRW5jb2Rlci5lbmNvZGUodmFsLnRvU3RyaW5nKCkpKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIC8vIG11c3QgYmUgYSBudW1iZXIgb2Ygc2ltcGxl\nIHR5cGU7IG5vIG5lZWQgdG8gZW5jb2RlCiAgICAgICAgICAgICAgICBvdXQu\nd3JpdGUodmFsLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFVzZWQgdG8gcmVjb25zdHJ1Y3Qge0BsaW5rIE9iamVjdERh\ndGF9IGluc3RhbmNlcyBmcm9tIFNBWCBldmVudHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIE9iamVjdERhdGFIYW5kbGVyCiAgICAgICAg\nZXh0ZW5kcyBEZWZhdWx0SGFuZGxlciB7CgogICAgICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzW10gQVJHUyA9IG5ldyBDbGFzc1tdeyBTdHJpbmcu\nY2xhc3MgfTsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBYTUxDb25maWd1cmF0\naW9uIF9jb25mOwogICAgICAgIHByaXZhdGUgZmluYWwgQ29sbGVjdGlvbiBf\nZXh0ZW50ID0gbmV3IEFycmF5TGlzdCgpOwoKICAgICAgICAvLyBwYXJzZSBz\ndGF0ZQogICAgICAgIHByaXZhdGUgT2JqZWN0RGF0YSBfb2JqZWN0OwogICAg\nICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YSBfZm1kOwogICAgICAgIHByaXZh\ndGUgT2JqZWN0IF9maWVsZFZhbDsKICAgICAgICBwcml2YXRlIE9iamVjdCBf\na2V5VmFsOwogICAgICAgIHByaXZhdGUgU3RyaW5nQnVmZmVyIF9idWY7Cgog\nICAgICAgIC8qKgogICAgICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgY29u\nZmlndXJhdGlvbi4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgT2JqZWN0\nRGF0YUhhbmRsZXIoWE1MQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\nICAgIF9jb25mID0gY29uZjsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJldHVybiB0aGUgcmVzdWx0cyBvZiB0aGUgcGFyc2luZy4KICAg\nICAgICAgKi8KICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRFeHRlbnQo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfZXh0ZW50OwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgc3RhcnRFbGVtZW50KFN0cmluZyB1cmksIFN0\ncmluZyBsb2NhbE5hbWUsIFN0cmluZyBxTmFtZSwKICAgICAgICAgICAgQXR0\ncmlidXRlcyBhdHRycykKICAgICAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdGFydEVs\nZW1lbnQocU5hbWUsIGF0dHJzKTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcmU7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFNBWEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU0FYRXhj\nZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ncml2YXRlIHZvaWQgc3RhcnRFbGVtZW50KFN0cmluZyBxTmFtZSwgQXR0cmli\ndXRlcyBhdHRycykKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIHN3aXRjaCAocU5hbWUuY2hhckF0KDApKSB7CiAgICAgICAg\nICAgICAgICBjYXNlICdvJzogLy8gb2JqZWN0CiAgICAgICAgICAgICAgICAg\nICAgLy8gZ2V0IHRoZSBtZXRhZGF0YSBmb3IgdGhlIHR5cGUgd2UncmUgcmVh\nZGluZwogICAgICAgICAgICAgICAgICAgIFN0cmluZyB0eXBlID0gYXR0cnMu\nZ2V0VmFsdWUoImNsYXNzIik7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEo\nY2xhc3NGb3JOYW1lKHR5cGUpLCBudWxsLCB0cnVlKTsKCiAgICAgICAgICAg\nICAgICAgICAgLy8gY29uc3RydWN0IHRoZSBvaWQgb2JqZWN0CiAgICAgICAg\nICAgICAgICAgICAgT2JqZWN0IG9pZDsKICAgICAgICAgICAgICAgICAgICBp\nZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBtZXRhLklEX0RBVEFTVE9S\nRSkKICAgICAgICAgICAgICAgICAgICAgICAgb2lkID0gbmV3IElkKGF0dHJz\nLmdldFZhbHVlKCJvaWQiKSwgX2NvbmYsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgb2lkID0gUENS\nZWdpc3RyeS5uZXdPYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmdldFZhbHVlKCJv\naWQiKSk7CgogICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhbiBPYmpl\nY3REYXRhIHRoYXQgd2lsbCBjb250YWluIHRoZSBpbmZvcm1hdGlvbgogICAg\nICAgICAgICAgICAgICAgIC8vIGZvciB0aGlzIGluc3RhbmNlLCBhbmQgc2V0\nIHRoZSB2ZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgX29iamVjdCA9IG5l\ndyBPYmplY3REYXRhKG9pZCwgbWV0YSk7CiAgICAgICAgICAgICAgICAgICAg\nX29iamVjdC5zZXRWZXJzaW9uKG5ldyBMb25nKGF0dHJzLmdldFZhbHVlKCJ2\nZXJzaW9uIikpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAg\nICAgICAgICAgICBjYXNlICdmJzogLy8gZmllbGQKICAgICAgICAgICAgICAg\nICAgICAvLyBzdGFydCBwYXJzaW5nIGEgZmllbGQgZWxlbWVudDogZm9yIGNv\nbnRhaW5lciB0eXBlcywKICAgICAgICAgICAgICAgICAgICAvLyBpbml0aWFs\naXplIHRoZSBjb250YWluZXI7IGZvciBvdGhlciB0eXBlcywgaW5pdGlhbGl6\nZSBhCiAgICAgICAgICAgICAgICAgICAgLy8gYnVmZmVyCiAgICAgICAgICAg\nICAgICAgICAgX2ZtZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIF9vYmpl\nY3QuZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChhdHRycy5nZXRWYWx1ZSgibmFt\nZSIpKTsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9mbWQuZ2V0VHlw\nZUNvZGUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9maWVsZFZhbCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBfZmllbGRWYWwgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYnVmID0gbmV3\nIFN0cmluZ0J1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICdl\nJzogLy8gZWxlbWVudAogICAgICAgICAgICAgICAgY2FzZSAnayc6IC8vIGtl\neQogICAgICAgICAgICAgICAgY2FzZSAndic6IC8vIHZhbHVlCiAgICAgICAg\nICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBhIGJ1ZmZlciBmb3IgdGhlIGVs\nZW1lbnQgdmFsdWUKICAgICAgICAgICAgICAgICAgICBfYnVmID0gbmV3IFN0\ncmluZ0J1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBlbmRF\nbGVtZW50KFN0cmluZyB1cmksIFN0cmluZyBsb2NhbE5hbWUsIFN0cmluZyBx\nTmFtZSkKICAgICAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBlbmRFbGVtZW50KHFOYW1l\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFNBWEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nc2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgU0FYRXhjZXB0aW9uKGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgZW5kRWxl\nbWVudChTdHJpbmcgcU5hbWUpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBPYmplY3QgdmFsOwogICAgICAgICAgICBzd2l0\nY2ggKHFOYW1lLmNoYXJBdCgwKSkgewogICAgICAgICAgICAgICAgY2FzZSAn\nbyc6IC8vIG9iamVjdAogICAgICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUg\nb2JqZWN0IHRvIG91ciByZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgX2V4\ndGVudC5hZGQoX29iamVjdCk7CgogICAgICAgICAgICAgICAgY2FzZSAnZic6\nIC8vIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfZm1kLmdl\ndFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGZpZWxkIHZhbHVlIGFscmVhZHkgY29uc3RydWN0ZWQKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gY29uc3RydWN0IHRoZSBmaWVsZCB2YWx1ZSBmcm9tIHRleHQgd2l0aGlu\nIHRoZSBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZmll\nbGRWYWwgPSBmcm9tWE1MU3RyaW5nKF9mbWQuZ2V0VHlwZUNvZGUoKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZm1kLmdldFR5cGVNZXRh\nRGF0YSgpLCBfYnVmLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBmaWVsZCB2YWx1\nZSBpbnRvIHRoZSBvYmplY3QgYmVpbmcgcGFyc2VkCiAgICAgICAgICAgICAg\nICAgICAgX29iamVjdC5zZXRGaWVsZChfZm1kLmdldEluZGV4KCksIF9maWVs\nZFZhbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAg\nICAgICAgY2FzZSAnZSc6IC8vIGVsZW1lbnQKICAgICAgICAgICAgICAgICAg\nICAvLyBjYWNoZSBlbGVtZW50IHZhbHVlCiAgICAgICAgICAgICAgICAgICAg\ndmFsID0gZnJvbVhNTFN0cmluZyhfZm1kLmdldEVsZW1lbnQoKS5nZXRUeXBl\nQ29kZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBfZm1kLmdldEVsZW1l\nbnQoKS5nZXRUeXBlTWV0YURhdGEoKSwgX2J1Zi50b1N0cmluZygpKTsKICAg\nICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIF9maWVsZFZhbCkuYWRk\nKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAg\nICAgICAgY2FzZSAnayc6IC8vIGtleQogICAgICAgICAgICAgICAgICAgIC8v\nIGNhY2hlIGtleSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIF9rZXlWYWwg\nPSBmcm9tWE1MU3RyaW5nKF9mbWQuZ2V0S2V5KCkuZ2V0VHlwZUNvZGUoKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgX2ZtZC5nZXRLZXkoKS5nZXRUeXBl\nTWV0YURhdGEoKSwgX2J1Zi50b1N0cmluZygpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICd2JzogLy8gdmFs\ndWUKICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdmFsdWUgYW5kIHB1\ndCBjYWNoZWQga2V5IGFuZCB2YWx1ZSBpbnRvIG1hcAogICAgICAgICAgICAg\nICAgICAgIHZhbCA9IGZyb21YTUxTdHJpbmcoX2ZtZC5nZXRFbGVtZW50KCku\nZ2V0VHlwZUNvZGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgX2ZtZC5n\nZXRFbGVtZW50KCkuZ2V0VHlwZU1ldGFEYXRhKCksIF9idWYudG9TdHJpbmco\nKSk7CiAgICAgICAgICAgICAgICAgICAgTWFwIG1hcCA9IChNYXApIF9maWVs\nZFZhbDsKICAgICAgICAgICAgICAgICAgICBtYXAucHV0KF9rZXlWYWwsIHZh\nbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGRvbid0IGNhY2hlIHRleHQgYmV0d2VlbiBlbGVt\nZW50cwogICAgICAgICAgICBfYnVmID0gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGNoYXJhY3RlcnMoY2hhcltdIGNoLCBpbnQgc3Rh\ncnQsIGludCBsZW5ndGgpIHsKICAgICAgICAgICAgaWYgKF9idWYgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9idWYuYXBwZW5kKGNoLCBzdGFydCwgbGVu\nZ3RoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlY3Jl\nYXRlIGEgZmllbGQgdmFsdWUgZnJvbSBpdHMgWE1MIHN0cmluZy4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgT2JqZWN0IGZyb21YTUxTdHJpbmcoaW50\nIHR5cGUsIENsYXNzTWV0YURhdGEgcmVsLCBTdHJpbmcgc3RyKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgc3RyID0gc3Ry\nLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHN0ci5lcXVhbHMoIm51bGwiKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgc3dp\ndGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVB\nTl9PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4udmFs\ndWVPZihzdHIpOwoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoc3RyKTsKCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAg\nICAgICAgLy8gc3RyaXAgcXVvdGVzOyBzcGVjaWFsIGNhc2UgZm9yIDB4MAog\nICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMSwgc3Ry\nLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ci5l\ncXVhbHMoIjB4MCIpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IENoYXJhY3RlcignXDAnKTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IENoYXJhY3RlcihYTUxFbmNvZGVyLmRlY29kZShzdHIpLmNoYXJB\ndCgwKSk7CgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxF\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShzdHIpOwoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQoc3RyKTsKCiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgSW50ZWdlcihzdHIpOwoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT05HX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvbmco\nc3RyKTsKCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KHN0cik7CgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IEJpZ0RlY2ltYWwoc3RyKTsKCiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgQmlnSW50ZWdlcihzdHIpOwoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAg\nICAgICAgICAvLyBzdHJpcCBxdW90ZXMKICAgICAgICAgICAgICAgICAgICBz\ndHIgPSBzdHIuc3Vic3RyaW5nKDEsIHN0ci5sZW5ndGgoKSAtIDEpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBYTUxFbmNvZGVyLmRlY29kZShzdHIp\nOwoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAg\nICAgICAgICAvLyBjb252ZXJ0IHRoZSBjaGFycyBpbnRvIGJ5dGVzLCBhbmQg\ncnVuIHRoZW0gdGhyb3VnaCBhbiAKICAgICAgICAgICAgICAgICAgICAvLyBP\nYmplY3RJbnB1dFN0cmVhbSBpbiBvcmRlciB0byBnZXQgdGhlIHNlcmlhbGl6\nZWQgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGJ5dGVzID0g\nQmFzZTE2RW5jb2Rlci5kZWNvZGUoc3RyKTsKICAgICAgICAgICAgICAgICAg\nICBCeXRlQXJyYXlJbnB1dFN0cmVhbSBiYWlzID0gbmV3IEJ5dGVBcnJheUlu\ncHV0U3RyZWFtKGJ5dGVzKTsKICAgICAgICAgICAgICAgICAgICBPYmplY3RJ\nbnB1dFN0cmVhbSBvaXMgPSBuZXcgT2JqZWN0SW5wdXRTdHJlYW0oYmFpcyk7\nCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGRhdGEgPSBvaXMucmVhZE9i\namVjdCgpOwogICAgICAgICAgICAgICAgICAgIG9pcy5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBEYXRlKHN0cik7CgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19V\nTlRZUEVEOgogICAgICAgICAgICAgICAgICAgIC8vIHBhcnNlIG91dCBvaWQg\nY2xhc3MgbmFtZSBhbmQgdmFsdWUKICAgICAgICAgICAgICAgICAgICBpbnQg\naWR4ID0gc3RyLmluZGV4T2YoJzonKTsKICAgICAgICAgICAgICAgICAgICBD\nbGFzcyBpZENsYXNzID0gY2xhc3NGb3JOYW1lKHN0ci5zdWJzdHJpbmcoMCwg\naWR4KSk7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGlkU3RyID0gWE1M\nRW5jb2Rlci5kZWNvZGUoc3RyLnN1YnN0cmluZyhpZHggKyAxKSk7CiAgICAg\nICAgICAgICAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGlkQ2xhc3MuZ2V0\nQ29uc3RydWN0b3IoQVJHUyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGNvbnMubmV3SW5zdGFuY2UobmV3IE9iamVjdFtdeyBpZFN0ciB9KTsKCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAg\nICAgICAgICAgICAgaW50IHVuZGVyMSA9IHN0ci5pbmRleE9mKCdfJyk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHVuZGVyMSA9PSAtMSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIChuZXcgTG9jYWxlKHN0ciwgIiIpKTsK\nCiAgICAgICAgICAgICAgICAgICAgaW50IHVuZGVyMiA9IHN0ci5pbmRleE9m\nKCdfJywgdW5kZXIxICsgMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVu\nZGVyMiA9PSAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBMb2NhbGUoc3RyLnN1YnN0cmluZygwLCB1bmRlcjEpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgc3RyLnN1YnN0cmluZyh1bmRlcjEgKyAxKSk7\nCgogICAgICAgICAgICAgICAgICAgIFN0cmluZyBsYW5nID0gc3RyLnN1YnN0\ncmluZygwLCB1bmRlcjEpOwogICAgICAgICAgICAgICAgICAgIFN0cmluZyBj\nb3VudHJ5ID0gc3RyLnN1YnN0cmluZyh1bmRlcjEgKyAxLCB1bmRlcjIpOwog\nICAgICAgICAgICAgICAgICAgIFN0cmluZyB2YXJpYW50ID0gc3RyLnN1YnN0\ncmluZyh1bmRlcjIgKyAxKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IExvY2FsZShsYW5nLCBjb3VudHJ5LCB2YXJpYW50KTsKCiAgICAgICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGNsYXNzIGZv\nciB0aGUgc3BlY2lmaWVkIG5hbWUuCiAgICAgICAgICovCiAgICAgICAgcHJp\ndmF0ZSBDbGFzcyBjbGFzc0Zvck5hbWUoU3RyaW5nIG5hbWUpCiAgICAgICAg\nICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBDbGFzc0xvYWRl\nciBsb2FkZXIgPSBfY29uZi5nZXRDbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4K\nICAgICAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKGdldENsYXNzKCksIG51\nbGwpOwogICAgICAgICAgICByZXR1cm4gQ2xhc3MuZm9yTmFtZShuYW1lLCB0\ncnVlLCBsb2FkZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFV0aWxpdHkgbWV0aG9kcyBmb3IgZW5jb2RpbmcgYW5kIGRlY29kaW5nIFhN\nTCBzdHJpbmdzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBY\nTUxFbmNvZGVyIHsKCiAgICAgICAgLyoqCiAgICAgICAgICogRW5jb2RlIHRo\nZSBnaXZlbiBzdHJpbmcgYXMgWE1MIHRleHQuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZW5jb2RlKFN0cmluZyBzKSB7CiAg\nICAgICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBudWxsOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHMubGVuZ3RoKCk7IGkrKykgewogICAg\nICAgICAgICAgICAgc3dpdGNoIChzLmNoYXJBdChpKSkgewogICAgICAgICAg\nICAgICAgICAgIGNhc2UgJzwnOgogICAgICAgICAgICAgICAgICAgICAgICBi\ndWYgPSBpbml0aWFsaXplQnVmZmVyKGJ1ZiwgcywgaSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiZsdDsiKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAn\nPic6CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGluaXRpYWxpemVC\ndWZmZXIoYnVmLCBzLCBpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiJmd0OyIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICBjYXNlICcmJzoKICAgICAgICAgICAg\nICAgICAgICAgICAgYnVmID0gaW5pdGlhbGl6ZUJ1ZmZlcihidWYsIHMsIGkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCImYW1wOyIp\nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nYnVmICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKHMuY2hhckF0KGkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoYnVmICE9IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIHJl\ndHVybiBzOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVj\nb2RlIHRoZSBnaXZlbiBYTUwgc3RyaW5nLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGRlY29kZShTdHJpbmcgcykgewogICAg\nICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbnVsbDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzLmxlbmd0aCgpOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGNoYXIgYyA9IHMuY2hhckF0KGkpOwogICAgICAgICAgICAg\nICAgaWYgKGMgPT0gJyYnICYmIHMubGVuZ3RoKCkgPiBpICsgMykgewogICAg\nICAgICAgICAgICAgICAgIGlmICgocy5jaGFyQXQoaSArIDEpID09ICdsJyB8\nfCBzLmNoYXJBdChpICsgMSkgPT0gJ2cnKQogICAgICAgICAgICAgICAgICAg\nICAgICAmJiBzLmNoYXJBdChpICsgMikgPT0gJ3QnICYmIHMuY2hhckF0KGkg\nKyAzKSA9PSAnOycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gJmx0\nOyBvciAmZ3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGluaXRp\nYWxpemVCdWZmZXIoYnVmLCBzLCBpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgYyA9IChzLmNoYXJBdChpKSA9PSAnbCcpID8gJzwnIDogJz4nOwogICAg\nICAgICAgICAgICAgICAgICAgICBpICs9IDM7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIGlmIChzLmxlbmd0aCgpID4gaSArIDQgJiYgcy5jaGFyQXQo\naSArIDEpID09ICdhJwogICAgICAgICAgICAgICAgICAgICAgICAmJiBzLmNo\nYXJBdChpICsgMikgPT0gJ20nICYmIHMuY2hhckF0KGkgKyAzKSA9PSAncCcK\nICAgICAgICAgICAgICAgICAgICAgICAgJiYgcy5jaGFyQXQoaSArIDQpID09\nICc7JykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAmYW1wOwogICAg\nICAgICAgICAgICAgICAgICAgICBidWYgPSBpbml0aWFsaXplQnVmZmVyKGJ1\nZiwgcywgaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAnJic7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGkgKz0gNDsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAo\nYnVmICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChj\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYnVmICE9IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICAg\nICAgICAgIHJldHVybiBzOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogQ3JlYXRlIGFuZCBpbml0aWFsaXplIGEgYnVmZmVyIGZvciB0aGUg\nZW5jb2RlZC9kZWNvZGVkIHN0cmluZyBpZgogICAgICAgICAqIG5lZWRlZC4K\nICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmdCdWZm\nZXIgaW5pdGlhbGl6ZUJ1ZmZlcihTdHJpbmdCdWZmZXIgYnVmLAogICAgICAg\nICAgICBTdHJpbmcgcywgaW50IGkpIHsKICAgICAgICAgICAgaWYgKGJ1ZiA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKCk7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCAocy5zdWJzdHJpbmcgKDAsIGkpKTsKCQkJ\nfQoJCQlyZXR1cm4gYnVmOwoJCX0KCX0KfQo=\n","encoding":"base64"}

