{"sha":"79e1bb661d7a23ddd63ae2c16bcd88e850bfa45f","node_id":"MDQ6QmxvYjIwNjM2NDo3OWUxYmI2NjFkN2EyM2RkZDYzYWUyYzE2YmNkODhlODUwYmZhNDVm","size":14327,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/79e1bb661d7a23ddd63ae2c16bcd88e850bfa45f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFz\nc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNRTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4\ncHMuQWJzdHJhY3RFeHByZXNzaW9uVmlzaXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFs\ndWU7CgovKioKICogVHVybnMgcGFyc2VkIHF1ZXJpZXMgaW50byBzZWxlY3Rz\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgU2VsZWN0Q29uc3RydWN0b3IgewoKICAgIHByaXZhdGUg\nYm9vbGVhbiBfZXh0ZW50ID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdHJ1ZSBpZiB3ZSBrbm93IHRoZSBzZWxlY3QgdG8gaGF2ZSBvbiBjcml0\nZXJpYTsgdG8gYmUgYW4gZXh0ZW50LgogICAgICogTm90ZSB0aGF0IGV2ZW4g\naWYgdGhpcyBtZXRob2QgcmV0dXJucyBmYWxzZSwge0BsaW5rICNldmFsdWF0\nZX0gbWF5IHN0aWxsCiAgICAgKiByZXR1cm4gbnVsbCBpZiB3ZSBoYXZlbid0\nIGNhY2hlZCB3aGV0aGVyIHRoZSBxdWVyeSBpcyBhbiBleHRlbnQgeWV0Lgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0V4dGVudCgpIHsKICAgICAg\nICByZXR1cm4gX2V4dGVudDsKICAgIH0KCiAgICAvKioKICAgICAqIEV2YWx1\nYXRlIHRoZSBleHByZXNzaW9uLCByZXR1cm5pbmcgYSBuZXcgc2VsZWN0IGFu\nZCBmaWxsaW5nIGluIGFueQogICAgICogYXNzb2NpYXRlZCBleHByZXNzaW9u\nIHN0YXRlLiBVc2Uge0BsaW5rICNzZWxlY3R9IHRvIHRoZW4gc2VsZWN0IHRo\nZSBkYXRhLgogICAgICogCiAgICAgKiBAcGFyYW0gY3R4IGZpbGwgd2l0aCBl\neGVjdXRpb24gY29udGV4dAogICAgICogQHBhcmFtIHN0YXRlIHdpbGwgYmUg\nZmlsbGVkIHdpdGggZXhwcmVzc2lvbiBzdGF0ZQogICAgICovCiAgICBwdWJs\naWMgU2VsZWN0IGV2YWx1YXRlKEV4cENvbnRleHQgY3R4LCBTZWxlY3QgcGFy\nZW50LCBTdHJpbmcgYWxpYXMsIAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnMg\nZXhwcywgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7CiAgICAgICAg\nLy8gYWxyZWFkeSBrbm93IHRoYXQgdGhpcyBxdWVyeSBpcyBlcXVpdmFsZW50\nIHRvIGFuIGV4dGVudD8KICAgICAgICBTZWxlY3Qgc2VsOwogICAgICAgIGlm\nIChfZXh0ZW50KSB7CiAgICAgICAgICAgIHNlbCA9IGN0eC5zdG9yZS5nZXRT\nUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIHNlbC5zZXRB\ndXRvRGlzdGluY3QoKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX0FV\nVE8pICE9IDApOwogICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAgIH0K\nCiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IHNlbGVjdCBhbmQgaW5pdGlhbGl6\nZSBpdCB3aXRoIHRoZSBqb2lucyBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhl\nIGNyaXRlcmlhIG9mIHRoaXMgcXVlcnkKICAgICAgICBzZWwgPSBuZXdTZWxl\nY3QoY3R4LCBwYXJlbnQsIGFsaWFzLCBleHBzLCBzdGF0ZSk7CgogICAgICAg\nIC8vIGNyZWF0ZSB3aGVyZSBjbGF1c2U7IGlmIHRoZXJlIGFyZSBubyB3aGVy\nZSBjb25kaXRpb25zIGFuZAogICAgICAgIC8vIG5vIG9yZGVyaW5nIG9yIHBy\nb2plY3Rpb25zLCB3ZSByZXR1cm4gbnVsbCB0byBzaWduaWZ5IHRoYXQgdGhp\ncwogICAgICAgIC8vIHF1ZXJ5IHNob3VsZCBiZSB0cmVhdGVkIGxpa2UgYW4g\nZXh0ZW50CiAgICAgICAgU2VsZWN0IGlubmVyID0gc2VsLmdldEZyb21TZWxl\nY3QoKTsKICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBidWlsZFdoZXJlKChp\nbm5lciAhPSBudWxsKSA/IGlubmVyIDogc2VsLCBjdHgsIAogICAgICAgICAg\nICBzdGF0ZS5maWx0ZXIsIGV4cHMuZmlsdGVyKTsKICAgICAgICBpZiAod2hl\ncmUgPT0gbnVsbCAmJiBleHBzLnByb2plY3Rpb25zLmxlbmd0aCA9PSAwCiAg\nICAgICAgICAgICYmIGV4cHMub3JkZXJpbmcubGVuZ3RoID09IDAKICAgICAg\nICAgICAgJiYgKHNlbC5nZXRKb2lucygpID09IG51bGwgfHwgc2VsLmdldEpv\naW5zKCkuaXNFbXB0eSgpKSkgewogICAgICAgICAgICBfZXh0ZW50ID0gdHJ1\nZTsKICAgICAgICAgICAgc2VsLnNldEF1dG9EaXN0aW5jdCgoZXhwcy5kaXN0\naW5jdCAmIGV4cHMuRElTVElOQ1RfQVVUTykgIT0gMCk7CiAgICAgICAgICAg\nIHJldHVybiBzZWw7CiAgICAgICAgfQoKICAgICAgICAvLyBub3cgc2V0IHNx\nbCBjcml0ZXJpYTsgaXQgZ29lcyBvbiB0aGUgaW5uZXIgc2VsZWN0IGlmIHBy\nZXNlbnQKICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAgICAgICAgICAg\naW5uZXIud2hlcmUod2hlcmUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc2VsLndoZXJlKHdoZXJlKTsKCiAgICAgICAgLy8gYXBwbHkgZ3JvdXBpbmcg\nYW5kIGhhdmluZy4gIHRoaXMgZG9lcyBub3Qgc2VsZWN0IHRoZSBncm91cGlu\nZwogICAgICAgIC8vIGNvbHVtbnMsIGp1c3QgYnVpbGRzIHRoZSBHUk9VUCBC\nWSBjbGF1c2VzLiAgd2UgZG9uJ3QgYnVpbGQgdGhlCiAgICAgICAgLy8gT1JE\nRVIgQlkgY2xhdXNlcyB5ZXQgYmVjYXVzZSBpZiB3ZSBkZWNpZGUgdG8gYWRk\nIHRoaXMgc2VsZWN0CiAgICAgICAgLy8gdG8gYSB1bmlvbiwgdGhlIE9SREVS\nIEJZIHZhbHVlcyBnZXQgYWxpYXNlZCBkaWZmZXJlbnRseQogICAgICAgIGlm\nIChleHBzLmhhdmluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIEV4cCBoYXZp\nbmdFeHAgPSAoRXhwKSBleHBzLmhhdmluZzsKICAgICAgICAgICAgU1FMQnVm\nZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoY3R4LnN0b3JlLmdldERCRGljdGlv\nbmFyeSgpKTsKICAgICAgICAgICAgaGF2aW5nRXhwLmFwcGVuZFRvKHNlbCwg\nY3R4LCBzdGF0ZS5oYXZpbmcsIGJ1Zik7CiAgICAgICAgICAgIHNlbC5oYXZp\nbmcoYnVmKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBleHBzLmdyb3VwaW5nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAoKFZh\nbCkgZXhwcy5ncm91cGluZ1tpXSkuZ3JvdXBCeShzZWwsIGN0eCwgc3RhdGUu\nZ3JvdXBpbmdbaV0pOwogICAgICAgIHJldHVybiBzZWw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgc2VsZWN0IHdpdGggZXhwcmVzc2lv\nbnMgaW5pdGlhbGl6ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgU2VsZWN0IG5l\nd1NlbGVjdChFeHBDb250ZXh0IGN0eCwgU2VsZWN0IHBhcmVudCwKICAgICAg\nICBTdHJpbmcgYWxpYXMsIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcywgUXVlcnlF\neHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7CiAgICAgICAgU2VsZWN0IHNlbCA9\nIGN0eC5zdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAg\nICAgc2VsLnNldEF1dG9EaXN0aW5jdCgoZXhwcy5kaXN0aW5jdCAmIGV4cHMu\nRElTVElOQ1RfQVVUTykgIT0gMCk7CiAgICAgICAgc2VsLnNldEpvaW5TeW50\nYXgoY3R4LmZldGNoLmdldEpvaW5TeW50YXgoKSk7CiAgICAgICAgc2VsLnNl\ndFBhcmVudChwYXJlbnQsIGFsaWFzKTsKICAgICAgICBpbml0aWFsaXplKHNl\nbCwgY3R4LCBleHBzLCBzdGF0ZSk7CgogICAgICAgIGlmICghc2VsLmdldEF1\ndG9EaXN0aW5jdCgpKSB7CiAgICAgICAgICAgIGlmICgoZXhwcy5kaXN0aW5j\ndCAmIGV4cHMuRElTVElOQ1RfVFJVRSkgIT0gMCkKICAgICAgICAgICAgICAg\nIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX0ZBTFNFKSAhPSAwKQog\nICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KGZhbHNlKTsKICAgICAg\nICB9IGVsc2UgaWYgKGV4cHMucHJvamVjdGlvbnMubGVuZ3RoID4gMCkgewog\nICAgICAgICAgICBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkgJiYgKGV4cHMuZGlz\ndGluY3QgJiBleHBzLkRJU1RJTkNUX1RSVUUpICE9IDApewogICAgICAgICAg\nICAgICAgLy8gaWYgdGhlIHNlbGVjdCBpcyBub3QgZGlzdGluY3QgYnV0IHRo\nZSBxdWVyeSBpcywgZm9yY2UKICAgICAgICAgICAgICAgIC8vIHRoZSBzZWxl\nY3QgdG8gYmUgZGlzdGluY3QKICAgICAgICAgICAgICAgIHNlbC5zZXREaXN0\naW5jdCh0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzZWwuaXNEaXN0\naW5jdCgpKSB7CiAgICAgICAgICAgICAgICAvLyB3aGVuIGFnZ3JlZ2F0aW5n\nIGRhdGEgb3IgbWFraW5nIGEgbm9uLWRpc3RpbmN0IHByb2plY3Rpb24KICAg\nICAgICAgICAgICAgIC8vIGZyb20gYSBkaXN0aW5jdCBzZWxlY3QsIHdlIGhh\ndmUgdG8gc2VsZWN0IGZyb20gYSB0bXAKICAgICAgICAgICAgICAgIC8vIHRh\nYmxlIGZvcm1lZCBieSBhIGRpc3RpbmN0IHN1YnNlbGVjdCBpbiB0aGUgZnJv\nbSBjbGF1c2U7CiAgICAgICAgICAgICAgICAvLyB0aGlzIHN1YnNlbGVjdCBz\nZWxlY3RzIHRoZSBwa3Mgb2YgdGhlIGNhbmRpZGF0ZSAodG8KICAgICAgICAg\nICAgICAgIC8vIGdldCB1bmlxdWUgY2FuZGlkYXRlIHZhbHVlcykgYW5kIG5l\nZWRlZCBmaWVsZCB2YWx1ZXMgYW5kCiAgICAgICAgICAgICAgICAvLyBhcHBs\naWVzIHRoZSB3aGVyZSBjb25kaXRpb25zOyB0aGUgb3V0ZXIgc2VsZWN0IGFw\ncGxpZXMKICAgICAgICAgICAgICAgIC8vIG9yZGVyaW5nLCBncm91cGluZywg\nZXRjCiAgICAgICAgICAgICAgICBib29sZWFuIGFnZyA9IGV4cHMuaXNBZ2dy\nZWdhdGUoKTsKICAgICAgICAgICAgICAgIGJvb2xlYW4gY2FuZGlkYXRlID0g\nUHJvamVjdGlvbkV4cHJlc3Npb25WaXNpdG9yLgogICAgICAgICAgICAgICAg\nICAgIGhhc0NhbmRpZGF0ZVByb2plY3Rpb25zKGV4cHMucHJvamVjdGlvbnMp\nOwogICAgICAgICAgICAgICAgaWYgKGFnZyB8fCAoY2FuZGlkYXRlIAogICAg\nICAgICAgICAgICAgICAgICYmIChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNU\nSU5DVF9UUlVFKSA9PSAwKSkgewogICAgICAgICAgICAgICAgICAgIERCRGlj\ndGlvbmFyeSBkaWN0ID0gY3R4LnN0b3JlLmdldERCRGljdGlvbmFyeSgpOwog\nICAgICAgICAgICAgICAgICAgIGRpY3QuYXNzZXJ0U3VwcG9ydChkaWN0LnN1\ncHBvcnRzU3Vic2VsZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAiU3Vw\ncG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0\nIGlubmVyID0gc2VsOwogICAgICAgICAgICAgICAgICAgIHNlbCA9IGN0eC5z\ndG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAg\nICAgICAgICAgc2VsLnNldFBhcmVudChwYXJlbnQsIGFsaWFzKTsKICAgICAg\nICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoYWdnCiAgICAgICAgICAg\nICAgICAgICAgICAgICYmIChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5D\nVF9UUlVFKSAhPSAwKTsKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0RnJv\nbVNlbGVjdChpbm5lcik7CgogICAgICAgICAgICAgICAgLy8gYXV0by1kaXN0\naW5jdGluZyBoYXBwZW5zIHRvIGdldCB1bmlxdWUgY2FuZGlkYXRlIGluc3Rh\nbmNlcwogICAgICAgICAgICAgICAgLy8gYmFjazsgZG9uJ3QgYXV0by1kaXN0\naW5jdCBpZiB0aGUgdXNlciBpc24ndCBzZWxlY3RpbmcgCiAgICAgICAgICAg\nICAgICAvLyBjYW5kaWRhdGUgZGF0YQogICAgICAgICAgICAgICAgfSBlbHNl\nIGlmICghY2FuZGlkYXRlIAogICAgICAgICAgICAgICAgICAgICYmIChleHBz\nLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9UUlVFKSA9PSAwKSAKICAgICAg\nICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFsc2UpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGFsbCBleHByZXNzaW9ucy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemUoU2VsZWN0IHNlbCwg\nRXhwQ29udGV4dCBjdHgsIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcywgCiAgICAg\nICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7CiAgICAgICAgTWFw\nIGNvbnRhaW5zID0gbnVsbDsKICAgICAgICBpZiAoSGFzQ29udGFpbnNFeHBy\nZXNzaW9uVmlzaXRvci5oYXNDb250YWlucyhleHBzLmZpbHRlcikKICAgICAg\nICAgICAgfHwgSGFzQ29udGFpbnNFeHByZXNzaW9uVmlzaXRvci5oYXNDb250\nYWlucyhleHBzLmhhdmluZykpCiAgICAgICAgICAgIGNvbnRhaW5zID0gbmV3\nIEhhc2hNYXAoNyk7CgogICAgICAgIC8vIGluaXRpYWxpemUgZmlsdGVyIGFu\nZCBoYXZpbmcgZXhwcmVzc2lvbnMKICAgICAgICBFeHAgZmlsdGVyRXhwID0g\nKEV4cCkgZXhwcy5maWx0ZXI7CiAgICAgICAgc3RhdGUuZmlsdGVyID0gZmls\ndGVyRXhwLmluaXRpYWxpemUoc2VsLCBjdHgsIGNvbnRhaW5zKTsKICAgICAg\nICBFeHAgaGF2aW5nRXhwID0gKEV4cCkgZXhwcy5oYXZpbmc7CiAgICAgICAg\naWYgKGhhdmluZ0V4cCAhPSBudWxsKQogICAgICAgICAgICBzdGF0ZS5oYXZp\nbmcgPSBoYXZpbmdFeHAuaW5pdGlhbGl6ZShzZWwsIGN0eCwgY29udGFpbnMp\nOwoKICAgICAgICAvLyBnZXQgdGhlIHRvcC1sZXZlbCBqb2lucyBhbmQgbnVs\nbCB0aGUgZXhwcmVzc2lvbidzIGpvaW5zCiAgICAgICAgLy8gYXQgdGhlIHNh\nbWUgdGltZSBzbyB0aGV5IGFyZW4ndCBpbmNsdWRlZCBpbiB0aGUgd2hlcmUv\naGF2aW5nIFNRTAogICAgICAgIEpvaW5zIGZpbHRlckpvaW5zID0gc3RhdGUu\nZmlsdGVyLmpvaW5zOwogICAgICAgIEpvaW5zIGhhdmluZ0pvaW5zID0gKHN0\nYXRlLmhhdmluZyA9PSBudWxsKSA/IG51bGwgOiBzdGF0ZS5oYXZpbmcuam9p\nbnM7CiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwuYW5kKGZpbHRlckpvaW5z\nLCBoYXZpbmdKb2lucyk7CgogICAgICAgIC8vIGluaXRpYWxpemUgcmVzdWx0\nIHZhbHVlcwogICAgICAgIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA+\nIDApIHsKICAgICAgICAgICAgc3RhdGUucHJvamVjdGlvbnMgPSBuZXcgRXhw\nU3RhdGVbZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGhdOwogICAgICAgICAgICBW\nYWwgcmVzdWx0VmFsOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGV4cHMucHJvamVjdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIHJlc3VsdFZhbCA9IChWYWwpIGV4cHMucHJvamVjdGlvbnNbaV07CiAg\nICAgICAgICAgICAgICAvLyBoYXZlIHRvIGpvaW4gdGhyb3VnaCB0byByZWxh\ndGVkIHR5cGUgZm9yIHBjIG9iamVjdCAKICAgICAgICAgICAgICAgIC8vIHBy\nb2plY3Rpb25zOyB0aGlzIGVuc3VyZXMgdGhhdCB3ZSBoYXZlIGFsbCBvdXIg\nam9pbnMgY2FjaGVkCiAgICAgICAgICAgICAgICBzdGF0ZS5wcm9qZWN0aW9u\nc1tpXSA9IHJlc3VsdFZhbC5pbml0aWFsaXplKHNlbCwgY3R4LCAKICAgICAg\nICAgICAgICAgICAgICBWYWwuSk9JTl9SRUwgfCBWYWwuRk9SQ0VfT1VURVIp\nOwogICAgICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5zLCBzdGF0\nZS5wcm9qZWN0aW9uc1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIGluaXRpYWxpemUgZ3JvdXBpbmcKICAgICAgICBp\nZiAoZXhwcy5ncm91cGluZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHN0\nYXRlLmdyb3VwaW5nID0gbmV3IEV4cFN0YXRlW2V4cHMuZ3JvdXBpbmcubGVu\nZ3RoXTsKICAgICAgICAgICAgVmFsIGdyb3VwVmFsOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGV4cHMuZ3JvdXBpbmcubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGdyb3VwVmFsID0gKFZhbCkgZXhwcy5ncm91\ncGluZ1tpXTsKICAgICAgICAgICAgICAgIC8vIGhhdmUgdG8gam9pbiB0aHJv\ndWdoIHRvIHJlbGF0ZWQgdHlwZSBmb3IgcGMgb2JqZWN0IGdyb3VwaW5nczsK\nICAgICAgICAgICAgICAgIC8vIHRoaXMgZW5zdXJlcyB0aGF0IHdlIGhhdmUg\nYWxsIG91ciBqb2lucyBjYWNoZWQKICAgICAgICAgICAgICAgIHN0YXRlLmdy\nb3VwaW5nW2ldID0gZ3JvdXBWYWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwgVmFs\nLkpPSU5fUkVMKTsKICAgICAgICAgICAgICAgIGpvaW5zID0gc2VsLmFuZChq\nb2lucywgc3RhdGUuZ3JvdXBpbmdbaV0uam9pbnMpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBpbml0aWFsaXplIG9yZGVyaW5nCiAg\nICAgICAgaWYgKGV4cHMub3JkZXJpbmcubGVuZ3RoID4gMCkgewogICAgICAg\nICAgICBzdGF0ZS5vcmRlcmluZyA9IG5ldyBFeHBTdGF0ZVtleHBzLm9yZGVy\naW5nLmxlbmd0aF07CiAgICAgICAgICAgIFZhbCBvcmRlclZhbDsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLm9yZGVyaW5nLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBvcmRlclZhbCA9IChWYWwpIGV4\ncHMub3JkZXJpbmdbaV07CiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlcmlu\nZ1tpXSA9IG9yZGVyVmFsLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwogICAg\nICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5zLCBzdGF0ZS5vcmRl\ncmluZ1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgc2VsLndoZXJlKGpvaW5zKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSB0aGUgd2hlcmUgc3FsLgogICAgICovCiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBidWlsZFdoZXJlKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBF\neHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgRXhwcmVzc2lvbiBmaWx0ZXIpIHsK\nICAgICAgICAvLyBjcmVhdGUgd2hlcmUgYnVmZmVyCiAgICAgICAgU1FMQnVm\nZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcihjdHguc3RvcmUuZ2V0REJEaWN0\naW9uYXJ5KCkpOwogICAgICAgIHdoZXJlLmFwcGVuZCgiKCIpOwogICAgICAg\nIEV4cCBmaWx0ZXJFeHAgPSAoRXhwKSBmaWx0ZXI7CiAgICAgICAgZmlsdGVy\nRXhwLmFwcGVuZFRvKHNlbCwgY3R4LCBzdGF0ZSwgd2hlcmUpOwoKICAgICAg\nICBpZiAod2hlcmUuc3FsRXF1YWxzKCIoIikgfHwgd2hlcmUuc3FsRXF1YWxz\nKCIoMSA9IDEiKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\ncmV0dXJuIHdoZXJlLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2VsZWN0IHRoZSBkYXRhIGZvciB0aGlzIHF1ZXJ5LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBj\ndHgsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIGJvb2xlYW4gc3Vi\nY2xhc3NlcywgUXVlcnlFeHByZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJlc3Np\nb25zU3RhdGUgc3RhdGUsCiAgICAgICAgaW50IGVhZ2VyKSB7CiAgICAgICAg\nU2VsZWN0IGlubmVyID0gc2VsLmdldEZyb21TZWxlY3QoKTsKICAgICAgICBW\nYWwgdmFsOwogICAgICAgIEpvaW5zIGpvaW5zID0gbnVsbDsKICAgICAgICBp\nZiAoc2VsLmdldFN1YnNlbGVjdFBhdGgoKSAhPSBudWxsKQogICAgICAgICAg\nICBqb2lucyA9IHNlbC5uZXdKb2lucygpLnNldFN1YnNlbGVjdChzZWwuZ2V0\nU3Vic2VsZWN0UGF0aCgpKTsKCiAgICAgICAgLy8gYnVpbGQgb3JkZXJpbmcg\nY2xhdXNlcyBiZWZvcmUgc2VsZWN0IHNvIHRoYXQgYW55IGVhZ2VyIGpvaW4K\nICAgICAgICAvLyBvcmRlcmluZyBnZXRzIGFwcGxpZWQgYWZ0ZXIgcXVlcnkg\nb3JkZXJpbmcKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMub3Jk\nZXJpbmcubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICgoVmFsKSBleHBzLm9y\nZGVyaW5nW2ldKS5vcmRlckJ5KHNlbCwgY3R4LCBzdGF0ZS5vcmRlcmluZ1tp\nXSwKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldKTsKCiAgICAg\nICAgLy8gaWYgbm8gcmVzdWx0IHN0cmluZyBzZXQsIHNlbGVjdCBtYXRjaGlu\nZyBvYmplY3RzIGxpa2Ugbm9ybWFsCiAgICAgICAgaWYgKGV4cHMucHJvamVj\ndGlvbnMubGVuZ3RoID09IDAgJiYgc2VsLmdldFBhcmVudCgpID09IG51bGwp\nIHsKICAgICAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3NlcykgPyBTZWxl\nY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7CiAgICAgICAg\nICAgIHNlbC5zZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIGN0eC5z\ndG9yZSwgY3R4LmZldGNoLCBlYWdlcik7CiAgICAgICAgfSBlbHNlIGlmIChl\neHBzLnByb2plY3Rpb25zLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIC8v\nIHN1YnNlbGVjdCBmb3Igb2JqZWN0czsgd2UgcmVhbGx5IGp1c3QgbmVlZCB0\naGUgcHJpbWFyeSBrZXkgdmFsdWVzCiAgICAgICAgICAgIHNlbC5zZWxlY3Qo\nbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBqb2lucyk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBhbiBpbm5l\nciBzZWxlY3QsIHdlIG5lZWQgdG8gc2VsZWN0IHRoZSBjYW5kaWRhdGUKICAg\nICAgICAgICAgLy8gY2xhc3MnIHBrIGNvbHVtbnMgdG8gZ3VhcmFudGVlIHVu\naXF1ZSBpbnN0YW5jZXMKICAgICAgICAgICAgaWYgKGlubmVyICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBpbm5lci5zZWxlY3QobWFwcGluZy5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpLCBqb2lucyk7CgogICAgICAgICAgICAvLyBzZWxl\nY3QgZWFjaCByZXN1bHQgdmFsdWU7IG5vIG5lZWQgdG8gcGFzcyBvbiB0aGUg\nZWFnZXIgbW9kZSBzaW5jZQogICAgICAgICAgICAvLyB1bmRlciBwcm9qZWN0\naW9ucyB3ZSBhbHdheXMgdXNlIEVBR0VSX05PTkUKICAgICAgICAgICAgYm9v\nbGVhbiBwa3MgPSBzZWwuZ2V0UGFyZW50KCkgIT0gbnVsbDsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLnByb2plY3Rpb25zLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YWwgPSAoVmFsKSBleHBzLnBy\nb2plY3Rpb25zW2ldOwogICAgICAgICAgICAgICAgaWYgKGlubmVyICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgdmFsLnNlbGVjdENvbHVtbnMoaW5u\nZXIsIGN0eCwgc3RhdGUucHJvamVjdGlvbnNbaV0sIHBrcyk7CiAgICAgICAg\nICAgICAgICB2YWwuc2VsZWN0KHNlbCwgY3R4LCBzdGF0ZS5wcm9qZWN0aW9u\nc1tpXSwgcGtzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFr\nZSBzdXJlIGhhdmluZyBjb2x1bW5zIGFyZSBzZWxlY3RlZCBzaW5jZSBpdCBp\ncyByZXF1aXJlZCBieSAKICAgICAgICAgICAgLy8gc29tZSBEQnMuICBwdXQg\ndGhlbSBsYXN0IHNvIHRoZXkgZG9uJ3QgYWZmZWN0IHJlc3VsdCBwcm9jZXNz\naW5nCiAgICAgICAgICAgIGlmIChleHBzLmhhdmluZyAhPSBudWxsICYmIGlu\nbmVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAoKEV4cCkgZXhwcy5oYXZp\nbmcpLnNlbGVjdENvbHVtbnMoaW5uZXIsIGN0eCwgc3RhdGUuaGF2aW5nLCAK\nICAgICAgICAgICAgICAgICAgICB0cnVlKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHNlbGVjdCBvcmRlcmluZyBjb2x1bW5zLCBzaW5jZSBpdCBpcyByZXF1\naXJlZCBieSBzb21lIERCcy4gIHB1dCB0aGVtCiAgICAgICAgLy8gbGFzdCBz\nbyB0aGV5IGRvbid0IGFmZmVjdCByZXN1bHQgcHJvY2Vzc2luZwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZXhwcy5vcmRlcmluZy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB2YWwgPSAoVmFsKSBleHBzLm9yZGVyaW5nW2ld\nOwogICAgICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHZhbC5zZWxlY3RDb2x1bW5zKGlubmVyLCBjdHgsIHN0YXRlLm9yZGVy\naW5nW2ldLCB0cnVlKTsKICAgICAgICAgICAgdmFsLnNlbGVjdChzZWwsIGN0\neCwgc3RhdGUub3JkZXJpbmdbaV0sIHRydWUpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gYWRkIGNvbmRpdGlvbnMgbGltaXRpbmcgdGhlIHByb2plY3Rpb25z\nIHRvIHRoZSBwcm9wZXIgY2xhc3NlczsgaWYKICAgICAgICAvLyB0aGlzIGlz\nbid0IGEgcHJvamVjdGlvbiBvciBhIHN1YnEgdGhlbiB0aGV5IHdpbGwgYWxy\nZWFkeSBiZSBhZGRlZAogICAgICAgIGlmIChleHBzLnByb2plY3Rpb25zLmxl\nbmd0aCA+IDAgfHwgc2VsLmdldFBhcmVudCgpICE9IG51bGwpIHsKICAgICAg\nICAgICAgY3R4LnN0b3JlLmxvYWRTdWJjbGFzc2VzKG1hcHBpbmcpOwogICAg\nICAgICAgICBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRDbGFzc0Nv\nbmRpdGlvbnMoKGlubmVyICE9IG51bGwpIAogICAgICAgICAgICAgICAgPyBp\nbm5lciA6IHNlbCwgc3ViY2xhc3Nlcywgam9pbnMpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFVzZWQgdG8gY2hlY2sgd2hldGhlciBhIHF1\nZXJ5J3MgcmVzdWx0IHByb2plY3Rpb25zIGFyZSBvbiB0aGUgY2FuZGlkYXRl\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQcm9qZWN0aW9u\nRXhwcmVzc2lvblZpc2l0b3IKICAgICAgICBleHRlbmRzIEFic3RyYWN0RXhw\ncmVzc2lvblZpc2l0b3IgewoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX2Nh\nbmRpZGF0ZSA9IGZhbHNlOwogICAgICAgIHByaXZhdGUgaW50IF9sZXZlbCA9\nIDA7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBoYXNDYW5kaWRh\ndGVQcm9qZWN0aW9ucyhWYWx1ZVtdIHByb2pzKSB7CiAgICAgICAgICAgIFBy\nb2plY3Rpb25FeHByZXNzaW9uVmlzaXRvciB2ID0gbmV3IFByb2plY3Rpb25F\neHByZXNzaW9uVmlzaXRvcigpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHByb2pzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBw\ncm9qc1tpXS5hY2NlcHRWaXNpdCh2KTsKICAgICAgICAgICAgICAgIGlmICh2\nLl9jYW5kaWRhdGUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZW50ZXIoVmFsdWUgdmFsKSB7\nCiAgICAgICAgICAgIGlmICghX2NhbmRpZGF0ZSkgewogICAgICAgICAgICAg\nICAgX2NhbmRpZGF0ZSA9IChfbGV2ZWwgPT0gMCAmJiB2YWwgaW5zdGFuY2Vv\nZiBDb25zdGFudCkKICAgICAgICAgICAgICAgICAgICB8fCAodmFsIGluc3Rh\nbmNlb2YgUENQYXRoIAogICAgICAgICAgICAgICAgICAgICYmICEoKFBDUGF0\naCkgdmFsKS5pc1ZhcmlhYmxlUGF0aCgpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBfbGV2ZWwrKzsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGV4aXQoVmFsdWUgdmFsKSB7CiAgICAgICAgICAgIF9sZXZlbC0tOwog\nICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

