{"sha":"fc8d7560548aa13637f45bbda8da6ab189a29cdd","node_id":"MDQ6QmxvYjIwNjM2NDpmYzhkNzU2MDU0OGFhMTM2MzdmNDViYmRhOGRhNmFiMTg5YTI5Y2Rk","size":11165,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fc8d7560548aa13637f45bbda8da6ab189a29cdd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0\nIGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwu\nU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlzOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmhzcWxkYi5UcmFjZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkZpbHRl\nclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5SZWZlcmVudGlhbEludGVncml0eUV4Y2VwdGlvbjsKCi8qKgogKiBEaWN0\naW9uYXJ5IGZvciBIeXBlcnNvbmljIFNRTCBkYXRhYmFzZS4KICovCnB1Ymxp\nYyBjbGFzcyBIU1FMRGljdGlvbmFyeQogICAgZXh0ZW5kcyBEQkRpY3Rpb25h\ncnkgewoKICAgIC8qKgogICAgICogU2V0cyB3aGV0aGVyIEhTUUwgc2hvdWxk\nIHVzZSAiQ1JFQVRFRCBDQUNIRUQgVEFCTEUiIHJhdGhlciB0aGFuCiAgICAg\nKiAiQ1JFQVRFIFRBQkxFIiwgd2hpY2ggYWxsb3dzIGRpc2stYmFzZWQgZGF0\nYWJhc2Ugb3BlcmF0aW9ucy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nY2FjaGVUYWJsZXMgPSBmYWxzZTsKCiAgICBwcml2YXRlIFNRTEJ1ZmZlciBf\nb25lQnVmZmVyID0gbmV3IFNRTEJ1ZmZlcih0aGlzKS5hcHBlbmQoIjEiKTsK\nCiAgICBwdWJsaWMgSFNRTERpY3Rpb25hcnkoKSB7CiAgICAgICAgcGxhdGZv\ncm0gPSAiSFNRTCI7CiAgICAgICAgdmFsaWRhdGlvblNRTCA9ICJDQUxMIDEi\nOwogICAgICAgIGNsb3NlUG9vbFNRTCA9ICJTSFVURE9XTiI7CgogICAgICAg\nIHN1cHBvcnRzQXV0b0Fzc2lnbiA9IHRydWU7CiAgICAgICAgbGFzdEdlbmVy\nYXRlZEtleVF1ZXJ5ID0gIkNBTEwgSURFTlRJVFkoKSI7CiAgICAgICAgYXV0\nb0Fzc2lnbkNsYXVzZSA9ICJJREVOVElUWSI7CiAgICAgICAgYXV0b0Fzc2ln\nblR5cGVOYW1lID0gIklOVEVHRVIiOwogICAgICAgIG5leHRTZXF1ZW5jZVF1\nZXJ5ID0gIlNFTEVDVCBORVhUIFZBTFVFIEZPUiB7MH0gRlJPTSIKICAgICAg\nICAgICAgKyAiIElORk9STUFUSU9OX1NDSEVNQS5TWVNURU1fU0VRVUVOQ0VT\nIjsKICAgICAgICBjcm9zc0pvaW5DbGF1c2UgPSAiSk9JTiI7CiAgICAgICAg\ncmVxdWlyZXNDb25kaXRpb25Gb3JDcm9zc0pvaW4gPSB0cnVlOwogICAgICAg\nIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkxFTkdUSCh7MH0pIjsKICAgICAg\nICB0cmltTGVhZGluZ0Z1bmN0aW9uID0gIkxUUklNKHswfSkiOwogICAgICAg\nIHRyaW1UcmFpbGluZ0Z1bmN0aW9uID0gIlJUUklNKHswfSkiOwogICAgICAg\nIHRyaW1Cb3RoRnVuY3Rpb24gPSAiTFRSSU0oUlRSSU0oezB9KSkiOwoKICAg\nICAgICAvLyBIU1FMIDEuOC4wIGRvZXMgc3VwcG9ydCBzY2hlbWEgbmFtZXMg\naW4gdGhlIHRhYmxlICgic2NoZW1hLnRhYmxlIiksCiAgICAgICAgLy8gYnV0\nIGRvZXNuJ3Qgc3VwcG9ydCBpdCBmb3IgY29sdW1ucyByZWZlcmVuY2VzICgi\nc2NoZW1hLnRhYmxlLmNvbHVtbiIpCiAgICAgICAgdXNlU2NoZW1hTmFtZSA9\nIGZhbHNlOwogICAgICAgIHN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlID0gZmFs\nc2U7CiAgICAgICAgc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0gdHJ1ZTsK\nICAgICAgICBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gdHJ1ZTsKICAgICAg\nICByYW5nZVBvc2l0aW9uID0gUkFOR0VfUFJFX0RJU1RJTkNUOwogICAgICAg\nIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IGZhbHNlOwoKICAgICAg\nICB1c2VHZXRPYmplY3RGb3JCbG9icyA9IHRydWU7CiAgICAgICAgYmxvYlR5\ncGVOYW1lID0gIlZBUkJJTkFSWSI7CiAgICAgICAgZG91YmxlVHlwZU5hbWUg\nPSAiTlVNRVJJQyI7CgogICAgICAgIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0\nUHJpbWFyeUtleXMgPSB0cnVlOwogICAgICAgIHN1cHBvcnRzTnVsbFRhYmxl\nRm9yR2V0SW5kZXhJbmZvID0gdHJ1ZTsKCiAgICAgICAgcmVxdWlyZXNDYXN0\nRm9yTWF0aEZ1bmN0aW9ucyA9IHRydWU7CiAgICAgICAgcmVxdWlyZXNDYXN0\nRm9yQ29tcGFyaXNvbnMgPSB0cnVlOwoKICAgICAgICByZXNlcnZlZFdvcmRT\nZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAg\nICAgICAiQkVGT1JFIiwgIkJJR0lOVCIsICJCSU5BUlkiLCAiQ0FDSEVEIiwg\nIkRBVEVUSU1FIiwgIkxJTUlUIiwKICAgICAgICAgICAgIkxPTkdWQVJCSU5B\nUlkiLCAiTE9OR1ZBUkNIQVIiLCAiT0JKRUNUIiwgIk9USEVSIiwKICAgICAg\nICAgICAgIlNBVkVQT0lOVCIsICJURU1QIiwgIlRFWFQiLCAiVFJJR0dFUiIs\nICJUSU5ZSU5UIiwKICAgICAgICAgICAgIlZBUkJJTkFSWSIsICJWQVJDSEFS\nX0lHTk9SRUNBU0UiLAogICAgICAgIH0pKTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4gbG9i\nKSB7CiAgICAgICAgaW50IHR5cGUgPSBzdXBlci5nZXRKREJDVHlwZShtZXRh\nVHlwZUNvZGUsIGxvYik7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuQklHSU5UOgogICAgICAgICAgICAgICAgaWYg\nKG1ldGFUeXBlQ29kZSA9PSBKYXZhVHlwZXMuQklHSU5URUdFUikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gVHlwZXMuTlVNRVJJQzsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHlwZTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFByZWZlcnJlZFR5cGUoaW50IHR5\ncGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIFR5cGVzLlZB\nUkNIQVI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQkxPQjoKICAgICAgICAg\nICAgICAgIHJldHVybiBUeXBlcy5WQVJCSU5BUlk7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0UHJlZmVy\ncmVkVHlwZSh0eXBlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0\ncmluZ1tdIGdldEFkZFByaW1hcnlLZXlTUUwoUHJpbWFyeUtleSBwaykgewog\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXREcm9wUHJpbWFyeUtleVNRTChQcmltYXJ5S2V5IHBr\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICB9CgogICAg\ncHVibGljIFN0cmluZ1tdIGdldEFkZENvbHVtblNRTChDb2x1bW4gY29sdW1u\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxF\nICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFibGUo\nKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBBREQgQ09MVU1OICIgKyBnZXRE\nZWNsYXJlQ29sdW1uU1FMKGNvbHVtbiwgdHJ1ZSkgfTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUgdGFibGUp\nIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZl\ncigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSAiKTsKICAgICAgICBp\nZiAoY2FjaGVUYWJsZXMpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNBQ0hF\nRCAiKTsKICAgICAgICBidWYuYXBwZW5kKCJUQUJMRSAiKS5hcHBlbmQoZ2V0\nRnVsbE5hbWUodGFibGUsIGZhbHNlKSkuYXBwZW5kKCIgKCIpOwoKICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIsICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGdldERlY2xhcmVDb2x1\nbW5TUUwoY29sc1tpXSwgZmFsc2UpKTsKICAgICAgICB9CgogICAgICAgIFBy\naW1hcnlLZXkgcGsgPSB0YWJsZS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAg\nU3RyaW5nIHBrU3RyOwogICAgICAgIGlmIChwayAhPSBudWxsKSB7CiAgICAg\nICAgICAgIHBrU3RyID0gZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRTUUwocGsp\nOwogICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkocGtTdHIp\nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKS5hcHBlbmQocGtT\ndHIpOwogICAgICAgIH0KCiAgICAgICAgVW5pcXVlW10gdW5xcyA9IHRhYmxl\nLmdldFVuaXF1ZXMoKTsKICAgICAgICBTdHJpbmcgdW5xU3RyOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgdW5xcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICB1bnFTdHIgPSBnZXRVbmlxdWVDb25zdHJhaW50U1FMKHVucXNb\naV0pOwogICAgICAgICAgICBpZiAodW5xU3RyICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZCh1bnFTdHIpOwogICAg\nICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9CgogICAg\ncHJvdGVjdGVkIFN0cmluZyBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChQ\ncmltYXJ5S2V5IHBrKSB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHBrLmdl\ndENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMSAmJiBj\nb2xzWzBdLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIHJldHVybiBzdXBlci5nZXRQcmltYXJ5S2V5Q29uc3Ry\nYWludFNRTChwayk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0\nZW1JbmRleChTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICBy\nZXR1cm4gbmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIlNZU18iKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNlcXVlbmNlc1NRTChT\ndHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSkgewogICAg\nICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIFNFUVVFTkNFX1NDSEVNQSwgU0VR\nVUVOQ0VfTkFNRSBGUk9NICIpLgogICAgICAgICAgICBhcHBlbmQoIklORk9S\nTUFUSU9OX1NDSEVNQS5TWVNURU1fU0VRVUVOQ0VTIik7CiAgICAgICAgaWYg\nKHNjaGVtYU5hbWUgIT0gbnVsbCB8fCBzZXF1ZW5jZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIFdIRVJFICIpOwogICAgICAgIGlm\nIChzY2hlbWFOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiU0VRVUVOQ0VfU0NIRU1BID0gPyIpOwogICAgICAgICAgICBpZiAoc2Vx\ndWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VxdWVuY2VOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX05B\nTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9w\nLCBTUUxCdWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwg\nU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBo\nYXZpbmcsCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3Rp\nbmN0LCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9y\nVXBkYXRlQ2xhdXNlKSB7CiAgICAgICAgLy8gaHNxbCByZXF1aXJlcyBvcmRl\ncmluZyB3aGVuIGxpbWl0IGlzIHVzZWQKICAgICAgICBpZiAoKHN0YXJ0ICE9\nIDAgfHwgZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICAmJiAo\nb3JkZXIgPT0gbnVsbCB8fCBvcmRlci5pc0VtcHR5KCkpKQogICAgICAgICAg\nICBvcmRlciA9IF9vbmVCdWZmZXI7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRv\nT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwgZ3JvdXAsIGhh\ndmluZywKICAgICAgICAgICAgb3JkZXIsIGRpc3RpbmN0LCBzdGFydCwgZW5k\nLCBmb3JVcGRhdGVDbGF1c2UpOwogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5b\nXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNh\ndGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJs\nZU5hbWUsIFN0cmluZyBjb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uW10g\nY29scyA9IHN1cGVyLmdldENvbHVtbnMobWV0YSwgY2F0YWxvZywgc2NoZW1h\nTmFtZSwgdGFibGVOYW1lLAogICAgICAgICAgICBjb2x1bW5OYW1lLCBjb25u\nKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbHMgIT0gbnVsbCAmJiBp\nIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCJCT09MRUFO\nIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAg\nICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQklUKTsKICAg\nICAgICByZXR1cm4gY29sczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRE\nb3VibGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGRvdWJs\nZSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAvLyBIU1FMIGhhcyBhIGJ1ZyB3aGVyZSBp\ndCBjYW5ub3Qgc3RvcmUgYSBkb3VibGUgaWYgaXQgaXMKICAgICAgICAvLyBl\neGFjdGx5IHRoZSBzYW1lIGFzIExvbmcuTUFYX1ZBTFVFIG9yIE1JTl9WQUxV\nRQogICAgICAgIGlmICh2YWwgPT0gTG9uZy5NQVhfVkFMVUUgfHwgdmFsID09\nIExvbmcuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIHN0bW50LnNldExvbmco\naWR4LCAobG9uZykgdmFsKTsKICAgICAgICB9IGVsc2UgIHsKICAgICAgICAg\nICAgc3VwZXIuc2V0RG91YmxlKHN0bW50LCBpZHgsIHZhbCwgY29sKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQmlnRGVjaW1hbCB2\nYWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBoc3FsIGNhbid0IGNvbXBhcmUgYSBCaWdE\nZWNpbWFsIGVxdWFsIHRvIGFueSBvdGhlciB0eXBlLCBzbyB0cnkKICAgICAg\nICAvLyB0byBzZXQgdHlwZSBiYXNlZCBvbiBjb2x1bW4KICAgICAgICBpbnQg\ndHlwZSA9ICh2YWwgPT0gbnVsbCB8fCBjb2wgPT0gbnVsbCkgPyBKYXZhVHlw\nZXMuQklHREVDSU1BTAogICAgICAgICAgICA6IGNvbC5nZXRKYXZhVHlwZSgp\nOwogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRP\nVUJMRV9PQko6CiAgICAgICAgICAgICAgICBzZXREb3VibGUoc3RtbnQsIGlk\neCwgdmFsLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAg\nICAgIHNldERvdWJsZShzdG1udCwgaWR4LCB2YWwuZmxvYXRWYWx1ZSgpLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICBzdXBlci5zZXRCaWdEZWNpbWFsKHN0bW50\nLCBpZHgsIHZhbCwgY29sKTsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVj\ndGVkIHZvaWQgYXBwZW5kU2VsZWN0UmFuZ2UoU1FMQnVmZmVyIGJ1ZiwgbG9u\nZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3Qp\nIHsKICAgICAgICAvLyBIU1FMIGRvZXNuJ3QgcGFyYW1ldGVycyBpbiByYW5n\nZQogICAgICAgIGJ1Zi5hcHBlbmQoIiBMSU1JVCAiKS5hcHBlbmQoU3RyaW5n\nLnZhbHVlT2Yoc3RhcnQpKS5hcHBlbmQoIiAiKTsKICAgICAgICBpZiAoZW5k\nID09IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICBidWYuYXBwZW5kKFN0\ncmluZy52YWx1ZU9mKDApKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoU3RyaW5nLnZhbHVlT2YoZW5kIC0gc3RhcnQpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdWJzdHJpbmcoU1FMQnVmZmVyIGJ1ZiwgRmls\ndGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBzdGFydCwKICAgICAgICBGaWx0\nZXJWYWx1ZSBlbmQpIHsKICAgICAgICBidWYuYXBwZW5kKHN1YnN0cmluZ0Z1\nbmN0aW9uTmFtZSkuYXBwZW5kKCIoKCIpOwogICAgICAgIHN0ci5hcHBlbmRU\nbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiksICgiKTsKICAgICAgICBz\ndGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiArIDEp\nIik7CiAgICAgICAgaWYgKGVuZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiwgKCIpOwogICAgICAgICAgICBhcHBlbmROdW1lcmljQ2Fz\ndChidWYsIGVuZCk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAtICgiKTsK\nICAgICAgICAgICAgYXBwZW5kTnVtZXJpY0Nhc3QoYnVmLCBzdGFydCk7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIikpIik7CiAgICAgICAgfQogICAgICAg\nIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbmRl\neE9mKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHN0ciwgRmlsdGVyVmFs\ndWUgZmluZCwKICAgICAgICBGaWx0ZXJWYWx1ZSBzdGFydCkgewogICAgICAg\nIGJ1Zi5hcHBlbmQoIihMT0NBVEUoIik7CiAgICAgICAgZmluZC5hcHBlbmRU\nbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgc3Ry\nLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgaWYgKHN0YXJ0ICE9IG51bGwpIHsK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAoIik7CiAgICAgICAgICAgIHN0\nYXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAr\nIDEpIik7CiAgICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQoIikgLSAxKSIp\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UGxhY2Vob2xkZXJWYWx1\nZVN0cmluZyhDb2x1bW4gY29sKSB7CiAgICAgICAgU3RyaW5nIHR5cGUgPSBn\nZXRUeXBlTmFtZShjb2wuZ2V0VHlwZSgpKTsKICAgICAgICBpbnQgaWR4ID0g\ndHlwZS5pbmRleE9mKCJ7MH0iKTsKICAgICAgICBpZiAoaWR4ICE9IC0xKSB7\nCiAgICAgICAgICAgIFN0cmluZyBwcmUgPSB0eXBlLnN1YnN0cmluZygwLCBp\nZHgpOwogICAgICAgICAgICBpZiAodHlwZS5sZW5ndGgoKSA+IGlkeCArIDMp\nCiAgICAgICAgICAgICAgICB0eXBlID0gcHJlICsgdHlwZS5zdWJzdHJpbmco\naWR4ICsgMyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHR5\ncGUgPSBwcmU7CiAgICAgICAgfQogICAgICAgIHJldHVybiAiTlVMTCBBUyAi\nICsgdHlwZTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQUV4Y2VwdGlvbiBu\nZXdTdG9yZUV4Y2VwdGlvbihTdHJpbmcgbXNnLCBTUUxFeGNlcHRpb25bXSBj\nYXVzZXMsCiAgICAgICAgT2JqZWN0IGZhaWxlZCkgewogICAgICAgIE9wZW5K\nUEFFeGNlcHRpb24ga2UgPSBzdXBlci5uZXdTdG9yZUV4Y2VwdGlvbihtc2cs\nIGNhdXNlcywgZmFpbGVkKTsKICAgICAgICBpZiAoa2UgaW5zdGFuY2VvZiBS\nZWZlcmVudGlhbEludGVncml0eUV4Y2VwdGlvbgogICAgICAgICAgICAmJiBj\nYXVzZXNbMF0uZ2V0RXJyb3JDb2RlKCkgPT0gLVRyYWNlLlZJT0xBVElPTl9P\nRl9VTklRVUVfSU5ERVgpIHsKICAgICAgICAgICAgKChSZWZlcmVudGlhbElu\ndGVncml0eUV4Y2VwdGlvbikga2UpLnNldEludGVncml0eVZpb2xhdGlvbgog\nICAgICAgICAgICAgICAgKFJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9u\nLklWX1VOSVFVRSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBrZTsKICAg\nIH0KfQo=\n","encoding":"base64"}

