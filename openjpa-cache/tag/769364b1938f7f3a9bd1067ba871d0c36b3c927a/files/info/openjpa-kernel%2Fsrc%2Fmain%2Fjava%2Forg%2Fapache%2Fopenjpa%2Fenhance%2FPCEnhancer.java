{"sha":"40dae8b91e0282c9a88ade6cf0899f430e7b6775","node_id":"MDQ6QmxvYjIwNjM2NDo0MGRhZThiOTFlMDI4MmM5YTg4YWRlNmNmMDg5OWY0MzBlN2I2Nzc1","size":174320,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/40dae8b91e0282c9a88ade6cf0899f430e7b6775","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQnl0ZWNvZGVXcml0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9w\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU2Vy\ndmljZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkRvdWJsZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFz\nczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmll\nbGRJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJ\nbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0\nZWNvZGUuTG9hZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5N\nZXRob2RJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVj\ndDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ2xhc3NJbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51dGlsLlN0cmlu\nZ3M7CgovKioKICogQnl0ZWNvZGUgZW5oYW5jZXIgdXNlZCB0byBlbmhhbmNl\nIHBlcnNpc3RlbnQgY2xhc3NlcyBmcm9tIG1ldGFkYXRhLiBUaGUKICogZW5o\nYW5jZXIgbXVzdCBiZSBpbnZva2VkIG9uIGFsbCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIGFuZCBwZXJzaXN0ZW5jZSBhd2FyZQogKiBjbGFzc2VzLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFBDRW5oYW5jZXIg\newogICAgLy8gRGVzaWduYXRlcyBhIHZlcnNpb24gZm9yIG1haW50YWluaW5n\nIGNvbXBhdGJpbGl0eSB3aGVuIFBDRW5oYW5jZXIKICAgIC8vIG1vZGlmaWVz\nIGVuaGFuY2VtZW50IHRoYXQgY2FuIGJyZWFrIHNlcmlhbGl6YXRpb24gb3Ig\nb3RoZXIgY29udHJhY3RzCiAgICAvLyBFYWNoIGVuaGFuY2VkIGNsYXNzIHdp\nbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIHZpYQogICAgLy8g\ncHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFUl9WRVJTSU9OID0g\nMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX05PTkUg\nPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9BV0FS\nRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFO\nQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUFJFID0gInBjIjsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIENsYXNzIFBDVFlQRSA9IFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFz\nczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBTTSA9IFBSRSAr\nICJTdGF0ZU1hbmFnZXIiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xh\nc3MgU01UWVBFID0gU3RhdGVNYW5hZ2VyLmNsYXNzOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgU3RyaW5nIElOSEVSSVQgPSBQUkUgKyAiSW5oZXJpdGVk\nRmllbGRDb3VudCI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nQ09OVEVYVE5BTUUgPSAiR2VuZXJpY0NvbnRleHQiOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ2xhc3MgVVNFUkVYQ0VQID0gVXNlckV4Y2VwdGlvbi5j\nbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIElOVEVSTkVY\nQ0VQID0gSW50ZXJuYWxFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBDbGFzcyBIRUxQRVJUWVBFID0gUENSZWdpc3RyeS5jbGFz\nczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBTVVBFUiA9IFBS\nRSArICJQQ1N1cGVyY2xhc3MiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nQ2xhc3MgT0lERlNUWVBFID0gRmllbGRTdXBwbGllci5jbGFzczsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIE9JREZDVFlQRSA9IEZpZWxkQ29u\nc3VtZXIuY2xhc3M7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChQQ0Vu\naGFuY2VyLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmlu\nZyBSRURFRklORURfQVRUUklCVVRFCiAgICAgICAgPSBQQ0VuaGFuY2VyLmNs\nYXNzLmdldE5hbWUoKSArICIjcmVkZWZpbmVkLXR5cGUiOwogICAgCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBBdXhpbGlhcnlFbmhhbmNlcltdIF9hdXhF\nbmhhbmNlcnM7CiAgICBzdGF0aWMgewogICAgICAgIENsYXNzW10gY2xhc3Nl\ncyA9IFNlcnZpY2VzLmdldEltcGxlbWVudG9yQ2xhc3NlcygKICAgICAgICAg\nICAgQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MsCiAgICAgICAgICAgIChDbGFz\nc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlv\nbihBdXhpbGlhcnlFbmhhbmNlci5jbGFzcykpKTsKICAgICAgICBMaXN0IGF1\neEVuaGFuY2VycyA9IG5ldyBBcnJheUxpc3QoY2xhc3Nlcy5sZW5ndGgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2xhc3Nlcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXV4RW5o\nYW5jZXJzLmFkZChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFj\ndGlvbihjbGFzc2VzW2ldKSkpOwoJCSAgICB9IGNhdGNoIChUaHJvd2FibGUg\ndCkgewogICAgICAgICAgICAgICAgLy8gYXV4IGVuaGFuY2VyIG1heSByZWx5\nIG9uIG5vbi1leGlzdGFudCBzcGVjIGNsYXNzZXMsIGV0YwoJCSAgICB9CgkJ\nfQogICAgCV9hdXhFbmhhbmNlcnMgPSAoQXV4aWxpYXJ5RW5oYW5jZXJbXSkg\nYXV4RW5oYW5jZXJzLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBBdXhpbGlh\ncnlFbmhhbmNlclthdXhFbmhhbmNlcnMuc2l6ZSgpXSk7CiAgICB9CgogICAg\ncHJpdmF0ZSBCQ0NsYXNzIF9wYzsKICAgIHByaXZhdGUgZmluYWwgQkNDbGFz\ncyBfbWFuYWdlZFR5cGU7CiAgICBwcml2YXRlIGZpbmFsIE1ldGFEYXRhUmVw\nb3NpdG9yeSBfcmVwb3M7CiAgICBwcml2YXRlIGZpbmFsIENsYXNzTWV0YURh\ndGEgX21ldGE7CiAgICBwcml2YXRlIGZpbmFsIExvZyBfbG9nOwogICAgcHJp\ndmF0ZSBDb2xsZWN0aW9uIF9vaWRzID0gbnVsbDsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfZGVmQ29ucyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Jl\nZGVmaW5lID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N1YmNsYXNz\nID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZhaWwgPSBmYWxzZTsK\nICAgIHByaXZhdGUgU2V0IF92aW9sYXRpb25zID0gbnVsbDsKICAgIHByaXZh\ndGUgRmlsZSBfZGlyID0gbnVsbDsKICAgIHByaXZhdGUgQnl0ZWNvZGVXcml0\nZXIgX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfYmFja2luZ0Zp\nZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBzZXQgLyBnZXQgbmFtZXMgPT4gZmll\nbGQgbmFtZXMKICAgIHByaXZhdGUgTWFwIF9hdHRyc1RvRmllbGRzID0gbnVs\nbDsgLy8gbWFwIG9mIGF0dHIgbmFtZXMgPT4gZmllbGQgbmFtZXMKICAgIHBy\naXZhdGUgTWFwIF9maWVsZHNUb0F0dHJzID0gbnVsbDsgLy8gbWFwIG9mIGZp\nZWxkIG5hbWVzID0+IGF0dHIgbmFtZXMKICAgIHByaXZhdGUgYm9vbGVhbiBf\naXNBbHJlYWR5UmVkZWZpbmVkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX2lzQWxyZWFkeVN1YmNsYXNzZWQgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfYmNzQ29uZmlndXJlZCA9IGZhbHNlOwoKICAgIC8qKgogICAg\nICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uIGFuZCB0eXBl\nIHRvIGVuaGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9w\nZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIENsYXNzIHR5cGUpIHsKICAgICAg\nICB0aGlzKGNvbmYsIChCQ0NsYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAubG9hZFByb2pl\nY3RDbGFzc0FjdGlvbihuZXcgUHJvamVjdCgpLCB0eXBlKSksCiAgICAgICAg\nICAgIChNZXRhRGF0YVJlcG9zaXRvcnkpIG51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uIGFu\nZCB0eXBlIHRvIGVuaGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFu\nY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIENsYXNzTWV0YURhdGEg\ndHlwZSkgewogICAgICAgIHRoaXMoY29uZiwgKEJDQ2xhc3MpIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAg\nICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKG5ldyBQcm9qZWN0KCksIHR5\ncGUuZ2V0RGVzY3JpYmVkVHlwZSgpKSksCiAgICAgICAgICAgIHR5cGUuZ2V0\nUmVwb3NpdG9yeSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVj\ndG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqCiAgICAgKiBAcGFy\nYW0gdHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gZm8gdGhlIHR5\ncGUgdG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJlIGNyZWF0ZWQgZnJv\nbSBhbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJhbSByZXBvcyBhIG1l\ndGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nlc3Ms\nCiAgICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5OyB0\naGUgcmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4gY29uZmlndXJh\ndGlvbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1c2UgdGhl\nIGNvbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGltcGxlbWVudGF0\naW9uLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRhCiAgICAgKiBy\nZXF1aXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZpbGVzCiAg\nICAgKiBAZGVwcmVjYXRlZCB1c2Uge0BsaW5rICNQQ0VuaGFuY2VyKE9wZW5K\nUEFDb25maWd1cmF0aW9uLCBCQ0NsYXNzLAogICAgICAgIE1ldGFEYXRhUmVw\nb3NpdG9yeSwgQ2xhc3NMb2FkZXIpfSBpbnN0ZWFkLiAKICAgICAqLwogICAg\ncHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwg\nQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncykgewogICAgICAgIHRoaXMoY29uZiwgdHlwZSwgcmVwb3MsIG51bGwpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25m\naWd1cmF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBieXRl\nY29kZSByZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICogZW5o\nYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0gb3Ig\nZmlsZQogICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9y\neSB0byB1c2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9yIG51bGwg\ndG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0b3J5CiAg\nICAgKiBmcm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0IHVzZWQg\nYnkgZGVmYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJhdGlvbiBt\naWdodCBiZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgc3Vi\nY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1vcmUgdGhh\nbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqIEBwYXJhbSBsb2Fk\nZXIgdGhlIGVudmlyb25tZW50IGNsYXNzbG9hZGVyIHRvIHVzZSBmb3IgbG9h\nZGluZwogICAgICogY2xhc3NlcyBhbmQgcmVzb3VyY2VzLgogICAgICovCiAg\nICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25m\nLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJl\ncG9zLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfbWFuYWdlZFR5\ncGUgPSB0eXBlOwogICAgICAgIF9wYyA9IHR5cGU7CgogICAgICAgIF9sb2cg\nPSBjb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfRU5IQU5D\nRSk7CgogICAgICAgIGlmIChyZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIF9yZXBvcyA9IGNvbmYubmV3TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgX3JlcG9zLnNldFNvdXJjZU1vZGUoTWV0YURhdGFS\nZXBvc2l0b3J5Lk1PREVfTUVUQSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIF9tZXRhID0gX3JlcG9zLmdl\ndE1ldGFEYXRhKHR5cGUuZ2V0VHlwZSgpLCBsb2FkZXIsIGZhbHNlKTsKICAg\nIH0KCiAgICBzdGF0aWMgU3RyaW5nIHRvUENTdWJjbGFzc05hbWUoQ2xhc3Mg\nY2xzKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUo\nUENFbmhhbmNlci5jbGFzcykgKyAiLiIKICAgICAgICAgICAgKyBjbHMuZ2V0\nTmFtZSgpLnJlcGxhY2UoJy4nLCAnJCcpICsgIiRwY3N1YmNsYXNzIjsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbiwgdHlwZSwgYW5kIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBCQ0Ns\nYXNzIHR5cGUsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgdGhpcyhjb25mLCB0eXBlLCBtZXRhLmdldFJlcG9zaXRvcnkoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ5dGVjb2RlIHJlcHJl\nc2VudGF0aW9uIG9mIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGNsYXNzCiAg\nICAgKiBiZWluZyBtYW5pcHVsYXRlZC4KICAgICAqLwogICAgcHVibGljIEJD\nQ2xhc3MgZ2V0UENCeXRlY29kZSgpIHsKICAgICAgICByZXR1cm4gX3BjOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBieXRlY29kZSByZXBy\nZXNlbnRhdGlvbiBvZiB0aGUgbWFuYWdlZCBjbGFzcyBiZWluZwogICAgICog\nbWFuaXB1bGF0ZWQuIFRoaXMgaXMgdXN1YWxseSB0aGUgc2FtZSBhcyB7QGxp\nbmsgI2dldFBDQnl0ZWNvZGV9LAogICAgICogZXhjZXB0IHdoZW4gcnVubmlu\nZyB0aGUgZW5oYW5jZXIgdG8gcmVkZWZpbmUgYW5kIHN1YmNsYXNzCiAgICAg\nKiBleGlzdGluZyBwZXJzaXN0ZW50IHR5cGVzLgogICAgICovCiAgICBwdWJs\naWMgQkNDbGFzcyBnZXRNYW5hZ2VkVHlwZUJ5dGVjb2RlKCkgewogICAgICAg\nIHJldHVybiBfbWFuYWdlZFR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgY2xhc3MgYmVpbmcgbWFuaXB1\nbGF0ZWQsIG9yIG51bGwgaWYgbm90CiAgICAgKiBhIHBlcnNpc3RlbnQgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURh\ndGEoKSB7CiAgICAgICAgcmV0dXJuIF9tZXRhOwogICAgfQoKICAgIC8qKgog\nICAgICogQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW5oYW5j\nZXIgc2hvdWxkIGFkZCBhIG5vLWFyZ3MKICAgICAqIGNvbnN0cnVjdG9yIGlm\nIG9uZSBpcyBub3QgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBjbGFzcy4gT3Bl\nbkpQQQogICAgICogcmVxdWlyZXMgdGhhdCBhIG5vLWFyZyBjb25zdHJ1Y3Rv\nciAod2hldGhlciBjcmVhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgICogb3Ig\nYnkgdGhlIHVzZXIpIGJlIHByZXNlbnQgaW4gYSBQQy4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKCkgewog\nICAgICAgIHJldHVybiBfZGVmQ29uczsKICAgIH0KCiAgICAvKioKICAgICAq\nIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGVuaGFuY2VyIHNo\nb3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBjb25zdHJ1Y3RvciBpZiBvbmUg\naXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0aGUgY2xhc3MuIE9wZW5KUEEK\nICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1hcmcgY29uc3RydWN0b3IgKHdo\nZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGlsZXIKICAgICAqIG9yIGJ5IHRo\nZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEFkZERlZmF1bHRDb25zdHJ1Y3Rvcihib29sZWFuIGFkZERl\nZmF1bHRDb25zdHJ1Y3RvcikgewogICAgICAgIF9kZWZDb25zID0gYWRkRGVm\nYXVsdENvbnN0cnVjdG9yOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgZW5oYW5jZXIgc2hvdWxkIG11dGF0ZSBpdHMgYXJndW1lbnRzLCBv\nciBqdXN0IHJ1biB2YWxpZGF0aW9uCiAgICAgKiBhbmQgb3B0aW9uYWwgc3Vi\nY2xhc3NpbmcgbG9naWMgb24gdGhlbS4gVXN1YWxseSB1c2VkIGluIGNvbmp1\nbmN0aW9uIHdpdGgKICAgICAqIDxjb2RlPnNldENyZWF0ZVN1YmNsYXNzKHRy\ndWUpPC9jb2RlPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UmVkZWZpbmUoKSB7CiAgICAgICAg\ncmV0dXJuIF9yZWRlZmluZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRzIGFyZ3VtZW50cywg\nb3IganVzdCBydW4gdmFsaWRhdGlvbgogICAgICogYW5kIG9wdGlvbmFsIHN1\nYmNsYXNzaW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkgdXNlZCBpbiBjb25q\ndW5jdGlvbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVhdGVTdWJjbGFzcyh0\ncnVlKTwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlZGVmaW5lKGJvb2xlYW4gcmVkZWZp\nbmUpIHsKICAgICAgICBfcmVkZWZpbmUgPSByZWRlZmluZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgdGhhdCB0aGlzIGluc3Rh\nbmNlIGlzIGVuaGFuY2luZyBoYXMgYWxyZWFkeSBiZWVuCiAgICAgKiByZWRl\nZmluZWQuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzQWxyZWFkeVJlZGVmaW5lZCgpIHsKICAgICAg\nICByZXR1cm4gX2lzQWxyZWFkeVJlZGVmaW5lZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgdGhhdCB0aGlzIGluc3RhbmNlIGlz\nIGVuaGFuY2luZyBoYXMgYWxyZWFkeSBiZWVuCiAgICAgKiBzdWJjbGFzc2Vk\nIGluIHRoaXMgaW5zdGFuY2UncyBlbnZpcm9ubWVudCBjbGFzc2xvYWRlci4K\nICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gaXNBbHJlYWR5U3ViY2xhc3NlZCgpIHsKICAgICAgICByZXR1\ncm4gX2lzQWxyZWFkeVN1YmNsYXNzZWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbWFrZSBpdHMgYXJndW1l\nbnRzIHBlcnNpc3RlbmNlLWNhcGFibGUsCiAgICAgKiBvciBnZW5lcmF0ZSBh\nIHBlcnNpc3RlbmNlLWNhcGFibGUgc3ViY2xhc3MuCiAgICAgKgogICAgICog\nQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldENy\nZWF0ZVN1YmNsYXNzKCkgewogICAgICAgIHJldHVybiBfc3ViY2xhc3M7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91\nbGQgbWFrZSBpdHMgYXJndW1lbnRzIHBlcnNpc3RlbmNlLWNhcGFibGUsCiAg\nICAgKiBvciBnZW5lcmF0ZSBhIHBlcnNpc3RlbmNlLWNhcGFibGUgc3ViY2xh\nc3MuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldENyZWF0ZVN1YmNsYXNzKGJvb2xlYW4gc3ViY2xhc3Mp\nIHsKICAgICAgICBfc3ViY2xhc3MgPSBzdWJjbGFzczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdG8gZmFpbCBpZiB0aGUgcGVyc2lzdGVudCB0\neXBlIHVzZXMgcHJvcGVydHkgYWNjZXNzIGFuZAogICAgICogYnl0ZWNvZGUg\nYW5hbHlzaXMgc2hvd3MgdGhhdCBpdCBtYXkgYmUgdmlvbGF0aW5nIE9wZW5K\nUEEncyBwcm9wZXJ0eQogICAgICogYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0RW5mb3JjZVByb3BlcnR5UmVz\ndHJpY3Rpb25zKCkgewogICAgICAgIHJldHVybiBfZmFpbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdG8gZmFpbCBpZiB0aGUgcGVyc2lzdGVu\ndCB0eXBlIHVzZXMgcHJvcGVydHkgYWNjZXNzIGFuZAogICAgICogYnl0ZWNv\nZGUgYW5hbHlzaXMgc2hvd3MgdGhhdCBpdCBtYXkgYmUgdmlvbGF0aW5nIE9w\nZW5KUEEncyBwcm9wZXJ0eQogICAgICogYWNjZXNzIHJlc3RyaWN0aW9ucy4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RW5mb3JjZVByb3BlcnR5UmVz\ndHJpY3Rpb25zKGJvb2xlYW4gZmFpbCkgewogICAgICAgIF9mYWlsID0gZmFp\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBiYXNlIGJ1aWxkIGRpcmVj\ndG9yeSB0byBnZW5lcmF0ZSBjb2RlIHRvLiBUaGUgcHJvcGVyIHBhY2thZ2UK\nICAgICAqIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aCB0aGlz\nIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92ZXJ3cml0aW5nIHRo\nZSBleGlzdGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAgICAgKi8KICAgIHB1\nYmxpYyBGaWxlIGdldERpcmVjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2Rp\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBiYXNlIGJ1aWxkIGRpcmVj\ndG9yeSB0byBnZW5lcmF0ZSBjb2RlIHRvLiBUaGUgcHJvcGVyIHBhY2thZ2UK\nICAgICAqIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWFlZCBiZW5lYXRoIHRoaXMg\nZGlyZWN0b3J5LiBEZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRpbmcgdGhl\nIGV4aXN0aW5nIGNsYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RGlyZWN0b3J5KEZpbGUgZGlyKSB7CiAgICAgICAgX2Rp\nciA9IGRpcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY3Vy\ncmVudCB7QGxpbmsgQnl0ZWNvZGVXcml0ZXJ9IHRvIHdyaXRlIHRvIG9yIG51\nbGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEJ5dGVjb2RlV3JpdGVy\nIGdldEJ5dGVjb2RlV3JpdGVyKCkgewogICAgICAgIHJldHVybiBfd3JpdGVy\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB7QGxpbmsgQnl0ZWNv\nZGVXcml0ZXJ9IHRvIHdyaXRlIHRoZSBieXRlY29kZSB0byBvciBudWxsIGlm\nIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVjb2RlV3Jp\ndGVyKEJ5dGVjb2RlV3JpdGVyIHdyaXRlcikgewogICAgICAgIF93cml0ZXIg\nPSB3cml0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGJ5dGVj\nb2RlIGVuaGFuY2VtZW50cy4KICAgICAqCiAgICAgKiBAcmV0dXJuIDxjb2Rl\nPkVOSEFOQ0VfKjwvY29kZT4gY29uc3RhbnQKICAgICAqLwogICAgcHVibGlj\nIGludCBydW4oKSB7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1z\ndGFydCIsIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gaWYgbWFuYWdlZCBpbnRlcmZhY2UsIHNraXAK\nICAgICAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5pc0ludGVyZmFjZSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfSU5URVJGQUNFOwoKICAg\nICAgICAgICAgLy8gY2hlY2sgaWYgYWxyZWFkeSBlbmhhbmNlZAogICAgICAg\nICAgICBDbGFzc1tdIGludGVyZmFjZXMgPSBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRJbnRlcmZhY2VUeXBlcygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGludGVyZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChpbnRlcmZhY2VzW2ldLmdldE5hbWUoKS5lcXVhbHMoUENU\nWVBFLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYy10eXBlIiwgX21hbmFnZWRUeXBlLmdl\ndFR5cGUoKSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNF\nX05PTkU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGNvbmZpZ3VyZUJDcygpOwoKICAgICAgICAgICAgLy8gdmFsaWRh\ndGUgcHJvcGVydGllcyBiZWZvcmUgcmVwbGFjaW5nIGZpZWxkIGFjY2VzcyBz\nbyB0aGF0CiAgICAgICAgICAgIC8vIHdlIGJ1aWxkIHVwIGEgcmVjb3JkIG9m\nIGJhY2tpbmcgZmllbGRzLCBldGMKICAgICAgICAgICAgaWYgKF9tZXRhICE9\nIG51bGwKICAgICAgICAgICAgICAgICYmIF9tZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkgewogICAgICAg\nICAgICAgICAgdmFsaWRhdGVQcm9wZXJ0aWVzKCk7CiAgICAgICAgICAgICAg\nICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgICAgICAg\nICBhZGRBdHRyaWJ1dGVUcmFuc2xhdGlvbigpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKCk7CiAg\nICAgICAgICAgIHByb2Nlc3NWaW9sYXRpb25zKCk7CgogICAgICAgICAgICBp\nZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZW5oYW5jZUNs\nYXNzKCk7CiAgICAgICAgICAgICAgICBhZGRGaWVsZHMoKTsKICAgICAgICAg\nICAgICAgIGFkZFN0YXRpY0luaXRpYWxpemVyKCk7CiAgICAgICAgICAgICAg\nICBhZGRQQ01ldGhvZHMoKTsKICAgICAgICAgICAgICAgIGFkZEFjY2Vzc29y\ncygpOwogICAgICAgICAgICAgICAgYWRkQXR0YWNoRGV0YWNoQ29kZSgpOwog\nICAgICAgICAgICAgICAgYWRkU2VyaWFsaXphdGlvbkNvZGUoKTsKICAgICAg\nICAgICAgICAgIGFkZENsb25pbmdDb2RlKCk7CiAgICAgICAgICAgICAgICBy\ndW5BdXhpbGlhcnlFbmhhbmNlcnMoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBFTkhBTkNFX1BDOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoInBlcnMtYXdhcmUiLCBfbWFuYWdlZFR5cGUuZ2V0VHlw\nZSgpKSk7CiAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX0FXQVJFOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oX2xvYy5n\nZXQoImVuaGFuY2UtZXJyb3IiLAogICAgICAgICAgICAgICAgX21hbmFnZWRU\neXBlLmdldFR5cGUoKS5nZXROYW1lKCksIGUuZ2V0TWVzc2FnZSgpKSwgZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBjb25maWd1cmVC\nQ3MoKSB7CiAgICAgICAgaWYgKCFfYmNzQ29uZmlndXJlZCkgewogICAgICAg\nICAgICBpZiAoZ2V0UmVkZWZpbmUoKSkgewogICAgICAgICAgICAgICAgaWYg\nKF9tYW5hZ2VkVHlwZS5nZXRBdHRyaWJ1dGUoUkVERUZJTkVEX0FUVFJJQlVU\nRSkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUu\nYWRkQXR0cmlidXRlKFJFREVGSU5FRF9BVFRSSUJVVEUpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9pc0FscmVhZHlSZWRl\nZmluZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAgUENTdWJj\nbGFzc1ZhbGlkYXRvciB2YWwgPSBuZXcgUENTdWJjbGFzc1ZhbGlkYXRvcigK\nICAgICAgICAgICAgICAgICAgICBfbWV0YSwgX21hbmFnZWRUeXBlLCBfbG9n\nLCBfZmFpbCk7CiAgICAgICAgICAgICAgICB2YWwuYXNzZXJ0Q2FuU3ViY2xh\nc3MoKTsKCiAgICAgICAgICAgICAgICBfcGMgPSBfbWFuYWdlZFR5cGUuZ2V0\nUHJvamVjdCgpLmxvYWRDbGFzcygKICAgICAgICAgICAgICAgICAgICB0b1BD\nU3ViY2xhc3NOYW1lKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsKICAgICAg\nICAgICAgICAgIGlmIChfcGMuZ2V0U3VwZXJjbGFzc0JDKCkgIT0gX21hbmFn\nZWRUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgX3BjLnNldFN1cGVyY2xh\nc3MoX21hbmFnZWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBfcGMuc2V0\nQWJzdHJhY3QoX21hbmFnZWRUeXBlLmlzQWJzdHJhY3QoKSk7CiAgICAgICAg\nICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoRHluYW1pY1BlcnNp\nc3RlbmNlQ2FwYWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIF9pc0FscmVhZHlTdWJjbGFzc2VkID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIF9wYyA9IF9tYW5hZ2VkVHlwZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgX2Jjc0NvbmZpZ3VyZWQgPSB0cnVlOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBnZW5lcmF0\nZWQgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlY29yZCgp\nCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX21h\nbmFnZWRUeXBlICE9IF9wYyAmJiBnZXRSZWRlZmluZSgpKQogICAgICAgICAg\nICByZWNvcmQoX21hbmFnZWRUeXBlKTsKICAgICAgICByZWNvcmQoX3BjKTsK\nICAgICAgICBpZiAoX29pZHMgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgICAgIHJlY29yZCgoQkNDbGFzcykgaXRyLm5leHQo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2l2ZW4gY2xh\nc3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWNvcmQoQkNDbGFzcyBi\nYykKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChf\nd3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgIF93cml0ZXIud3JpdGUoYmMp\nOwogICAgICAgIGVsc2UgaWYgKF9kaXIgPT0gbnVsbCkKICAgICAgICAgICAg\nYmMud3JpdGUoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgRmlsZSBk\naXIgPSBGaWxlcy5nZXRQYWNrYWdlRmlsZShfZGlyLCBiYy5nZXRQYWNrYWdl\nTmFtZSgpLCB0cnVlKTsKICAgICAgICAgICAgYmMud3JpdGUobmV3IEZpbGUo\nZGlyLCBiYy5nZXRDbGFzc05hbWUoKSArICIuY2xhc3MiKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgbWV0\naG9kcyBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBpbnN0YW5jZSBhcmUKICAg\nICAqIHdyaXR0ZW4gY29ycmVjdGx5LiBUaGlzIG1ldGhvZCBhbHNvIGdhdGhl\ncnMgaW5mb3JtYXRpb24gb24gZWFjaAogICAgICogcHJvcGVydHkncyBiYWNr\naW5nIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVQ\ncm9wZXJ0aWVzKCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzOwog\nICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICBm\nbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAg\nICBNZXRob2QgbWV0aDsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIsIHNldHRl\ncjsKICAgICAgICBCQ0ZpZWxkIHJldHVybmVkLCBhc3NpZ25lZCA9IG51bGw7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmICghKGZtZHNbaV0uZ2V0QmFja2luZ01lbWJl\ncigpIGluc3RhbmNlb2YgTWV0aG9kKSkgewogICAgICAgICAgICAgICAgYWRk\nVmlvbGF0aW9uKCJwcm9wZXJ0eS1iYWQtbWVtYmVyIiwKICAgICAgICAgICAg\nICAgICAgICBuZXcgT2JqZWN0W117IGZtZHNbaV0sIGZtZHNbaV0uZ2V0QmFj\na2luZ01lbWJlcigpIH0sCiAgICAgICAgICAgICAgICAgICAgdHJ1ZSk7CiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgbWV0aCA9IChNZXRob2QpIGZtZHNbaV0uZ2V0QmFja2luZ01lbWJl\ncigpOwogICAgICAgICAgICAvLyAjIyMjIyB0aGlzIHdpbGwgZmFpbCBpZiB3\nZSBvdmVycmlkZSBhbmQgZG9uJ3QgY2FsbCBzdXBlci4KICAgICAgICAgICAg\nQkNDbGFzcyBkZWNsYXJpbmdUeXBlID0gX21hbmFnZWRUeXBlLmdldFByb2pl\nY3QoKQogICAgICAgICAgICAgICAgLmxvYWRDbGFzcyhmbWRzW2ldLmdldERl\nY2xhcmluZ1R5cGUoKSk7CiAgICAgICAgICAgIGdldHRlciA9IGRlY2xhcmlu\nZ1R5cGUuZ2V0RGVjbGFyZWRNZXRob2QobWV0aC5nZXROYW1lKCksCiAgICAg\nICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAg\nICAgICBpZiAoZ2V0dGVyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGFk\nZFZpb2xhdGlvbigicHJvcGVydHktbm8tZ2V0dGVyIiwgbmV3IE9iamVjdFtd\neyBmbWRzW2ldIH0sCiAgICAgICAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm5lZCA9IGdldFJldHVybmVkRmllbGQoZ2V0dGVyKTsKICAgICAg\nICAgICAgaWYgKHJldHVybmVkICE9IG51bGwpCiAgICAgICAgICAgICAgICBy\nZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oZm1kc1tpXSwgZ2V0dGVyLCByZXR1\ncm5lZCk7CgogICAgICAgICAgICBzZXR0ZXIgPSBkZWNsYXJpbmdUeXBlLmdl\ndERlY2xhcmVkTWV0aG9kKGdldFNldHRlck5hbWUoZm1kc1tpXSksCiAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZm1kc1tpXS5nZXREZWNsYXJlZFR5\ncGUoKSB9KTsKICAgICAgICAgICAgaWYgKHNldHRlciA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAocmV0dXJuZWQgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktbm8tc2V0dGVy\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBmbWRz\nW2ldIH0sIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0UmVkZWZpbmUoKSkgewog\nICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBzeW50aGV0aWMgc2V0dGVy\nCiAgICAgICAgICAgICAgICAgICAgc2V0dGVyID0gX21hbmFnZWRUeXBlLmRl\nY2xhcmVNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWRzW2ldKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgICAgICAgICAgICAg\nc2V0dGVyLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgICAgICAgICAgQ29k\nZSBjb2RlID0gc2V0dGVyLmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKHJldHVybmVkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNldHRl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgYXNzaWduZWQgPSBnZXRBc3Np\nZ25lZEZpZWxkKHNldHRlcik7CgogICAgICAgICAgICBpZiAoYXNzaWduZWQg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNldHRlciAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyQmFja2luZ0ZpZWxkSW5m\nbyhmbWRzW2ldLCBzZXR0ZXIsIGFzc2lnbmVkKTsKCiAgICAgICAgICAgICAg\nICBpZiAoYXNzaWduZWQgIT0gcmV0dXJuZWQpCiAgICAgICAgICAgICAgICAg\nICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1zZXR0ZXItZ2V0dGVyLW1pc21h\ndGNoIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAgICAgICAgICAgICAgIHsg\nZm1kc1tpXSwgYXNzaWduZWQuZ2V0TmFtZSgpLCAocmV0dXJuZWQgPT0gbnVs\nbCkgCiAgICAgICAgICAgICAgICAgICAgICAgID8gbnVsbCA6IHJldHVybmVk\nLmdldE5hbWUoKSB9LCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlZ2lzdGVyQmFja2luZ0ZpZWxk\nSW5mbyhGaWVsZE1ldGFEYXRhIGZtZCwgQkNNZXRob2QgbWV0aG9kLAogICAg\nICAgIEJDRmllbGQgZmllbGQpIHsKICAgICAgICBpZiAoX2JhY2tpbmdGaWVs\nZHMgPT0gbnVsbCkKICAgICAgICAgICAgX2JhY2tpbmdGaWVsZHMgPSBuZXcg\nSGFzaE1hcCgpOwogICAgICAgIF9iYWNraW5nRmllbGRzLnB1dChtZXRob2Qu\nZ2V0TmFtZSgpLCBmaWVsZC5nZXROYW1lKCkpOwoKICAgICAgICBpZiAoX2F0\ndHJzVG9GaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgX2F0dHJzVG9GaWVs\nZHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9hdHRyc1RvRmllbGRzLnB1\ndChmbWQuZ2V0TmFtZSgpLCBmaWVsZC5nZXROYW1lKCkpOwoKICAgICAgICBp\nZiAoX2ZpZWxkc1RvQXR0cnMgPT0gbnVsbCkKICAgICAgICAgICAgX2ZpZWxk\nc1RvQXR0cnMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9maWVsZHNUb0F0\ndHJzLnB1dChmaWVsZC5nZXROYW1lKCksIGZtZC5nZXROYW1lKCkpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBhZGRBdHRyaWJ1dGVUcmFuc2xhdGlvbigp\nIHsKICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShBdHRyaWJ1dGVUcmFu\nc2xhdG9yLmNsYXNzKTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiQXR0cmlidXRlSW5kZXhUb0ZpZWxkTmFt\nZSIsCiAgICAgICAgICAgIFN0cmluZy5jbGFzcywgbmV3IENsYXNzW10geyBp\nbnQuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsK\nCiAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgY29kZS5pbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24g\ndGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgpOwogICAgICAgIHRhYmlucy5z\nZXRMb3coMCk7CiAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGgg\nLSAxKTsKCiAgICAgICAgLy8gY2FzZSBpOgogICAgICAgIC8vICAgICByZXR1\ncm4gPF9hdHRyc1RvRmllbGRzLmdldChmbWRzW2ldLmdldE5hbWUoKSk+CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQoY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKAogICAgICAgICAgICAgICAgX2F0dHJzVG9GaWVsZHMuZ2V0\nKGZtZHNbaV0uZ2V0TmFtZSgpKSkpOwogICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICB9CgogICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5l\ndyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICB0YWJpbnMu\nc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAo\nY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CgogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBuYW1lIG9mIHRoZSBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2\nZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyBn\nZXRTZXR0ZXJOYW1lKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgcmV0\ndXJuICJzZXQiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0TmFt\nZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQg\ncmV0dXJuZWQgYnkgdGhlIGdpdmVuIG1ldGhvZCwgb3IgbnVsbCBpZiBub25l\nLgogICAgICogUGFja2FnZS1wcm90ZWN0ZWQgYW5kIHN0YXRpYyBmb3IgdGVz\ndGluZy4KICAgICAqLwogICAgc3RhdGljIEJDRmllbGQgZ2V0UmV0dXJuZWRG\naWVsZChCQ01ldGhvZCBtZXRoKSB7CiAgICAgICAgcmV0dXJuIGZpbmRGaWVs\nZChtZXRoLCAoKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkp\nKS54cmV0dXJuKCkKICAgICAgICAgICAgLnNldFR5cGUobWV0aC5nZXRSZXR1\ncm5UeXBlKCkpLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGZpZWxkIGFzc2lnbmVkIGluIHRoZSBnaXZlbiBtZXRob2QsIG9y\nIG51bGwgaWYgbm9uZS4KICAgICAqIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBz\ndGF0aWMgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxk\nIGdldEFzc2lnbmVkRmllbGQoQkNNZXRob2QgbWV0aCkgewogICAgICAgIHJl\ndHVybiBmaW5kRmllbGQobWV0aCwgKChDb2RlKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3\nQ29kZUFjdGlvbigpKSkucHV0ZmllbGQoKSwgdHJ1ZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZpZWxkIHJldHVybmVkIC8gYXNzaWdu\nZWQgYnkgPGNvZGU+bWV0aDwvY29kZT4uIFJldHVybnMKICAgICAqIG51bGwg\naWYgbm9uLWZpZWxkcyAobWV0aG9kcywgbGl0ZXJhbHMsIHBhcmFtZXRlcnMs\nIHZhcmlhYmxlcykgYXJlCiAgICAgKiByZXR1cm5lZCwgb3IgaWYgbm9uLXBh\ncmFtZXRlcnMgYXJlIGFzc2lnbmVkIHRvIGZpZWxkcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgQkNGaWVsZCBmaW5kRmllbGQoQkNNZXRob2QgbWV0\naCwgSW5zdHJ1Y3Rpb24gdGVtcGxhdGUsCiAgICAgICAgYm9vbGVhbiBmaW5k\nQWNjZXNzZWQpIHsKICAgICAgICAvLyBpZ25vcmUgYW55IHN0YXRpYyBtZXRo\nb2RzLiBPcGVuSlBBIG9ubHkgY3VycmVudGx5IHN1cHBvcnRzCiAgICAgICAg\nLy8gbm9uLXN0YXRpYyBzZXR0ZXJzIGFuZCBnZXR0ZXJzCiAgICAgICAgaWYg\nKG1ldGguaXNTdGF0aWMoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZShmYWxzZSk7CiAgICAg\nICAgaWYgKGNvZGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICBCQ0ZpZWxk\nIGZpZWxkID0gbnVsbCwgY3VyOwogICAgICAgIEluc3RydWN0aW9uIHRlbXBs\nYXRlSW5zLCBwcmV2SW5zLCBlYXJsaWVySW5zOwogICAgICAgIHdoaWxlIChj\nb2RlLnNlYXJjaEZvcndhcmQodGVtcGxhdGUpKSB7CiAgICAgICAgICAgIGlu\ndCBiYWNrdXBDb3VudCA9IDM7CiAgICAgICAgICAgIHRlbXBsYXRlSW5zID0g\nY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBpZiAoIWNvZGUuaGFzUHJl\ndmlvdXMoKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nICAgICBwcmV2SW5zID0gY29kZS5wcmV2aW91cygpOwoKICAgICAgICAgICAg\naWYgKHByZXZJbnMgaW5zdGFuY2VvZiBDbGFzc0luc3RydWN0aW9uCiAgICAg\nICAgICAgICAgICAmJiBjb2RlLmhhc1ByZXZpb3VzKCkpIHsKICAgICAgICAg\nICAgICAgIHByZXZJbnMgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAg\nICAgICBiYWNrdXBDb3VudCsrOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoIWNvZGUuaGFzUHJldmlvdXMoKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICBlYXJsaWVySW5zID0gY29kZS5wcmV2\naW91cygpOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG9wY29kZSB0d28gYmVm\nb3JlIHRoZSB0ZW1wbGF0ZSB3YXMgYW4gYWxvYWRfMCwgY2hlY2sKICAgICAg\nICAgICAgLy8gYWdhaW5zdCB0aGUgbWlkZGxlIGluc3RydWN0aW9uIGJhc2Vk\nIG9uIHdoYXQgdHlwZSBvZiBmaW5kCiAgICAgICAgICAgIC8vIHdlJ3JlIGRv\naW5nCiAgICAgICAgICAgIGlmICghKGVhcmxpZXJJbnMgaW5zdGFuY2VvZiBM\nb2FkSW5zdHJ1Y3Rpb24pCiAgICAgICAgICAgICAgICB8fCAhKChMb2FkSW5z\ndHJ1Y3Rpb24pIGVhcmxpZXJJbnMpLmlzVGhpcygpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICAvLyBpZiB0aGUgbWlkZGxl\nIGluc3RydWN0aW9uIHdhcyBhIGdldGZpZWxkLCB0aGVuIGl0J3MgdGhlCiAg\nICAgICAgICAgIC8vIGZpZWxkIHRoYXQncyBiZWluZyBhY2Nlc3NlZAogICAg\nICAgICAgICBpZiAoIWZpbmRBY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3RhbmNl\nb2YgR2V0RmllbGRJbnN0cnVjdGlvbikgewogICAgICAgICAgICAgICAgZmlu\nYWwgRmllbGRJbnN0cnVjdGlvbiBmUHJldklucyA9IChGaWVsZEluc3RydWN0\naW9uKSBwcmV2SW5zOwogICAgICAgICAgICAgICAgY3VyID0gKEJDRmllbGQp\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVs\nZEFjdGlvbihmUHJldklucykpOwogICAgICAgICAgICAgICAgLy8gaWYgdGhl\nIG1pZGRsZSBpbnN0cnVjdGlvbiB3YXMgYW4geGxvYWRfMSwgdGhlbiB0aGUK\nICAgICAgICAgICAgICAgIC8vIG1hdGNoZWQgaW5zdHJ1Y3Rpb24gaXMgdGhl\nIGZpZWxkIHRoYXQncyBiZWluZyBzZXQuCiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoZmluZEFjY2Vzc2VkICYmIHByZXZJbnMgaW5zdGFuY2VvZiBMb2FkSW5z\ndHJ1Y3Rpb24KICAgICAgICAgICAgICAgICYmICgoTG9hZEluc3RydWN0aW9u\nKSBwcmV2SW5zKS5nZXRQYXJhbSgpID09IDApIHsKICAgICAgICAgICAgICAg\nIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZlRlbXBsYXRlSW5zID0KICAgICAg\nICAgICAgICAgICAgICAoRmllbGRJbnN0cnVjdGlvbikgdGVtcGxhdGVJbnM7\nCiAgICAgICAgICAgICAgICBjdXIgPSAoQkNGaWVsZCkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAg\nICAgICAgICAuZ2V0RmllbGRJbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZUZW1w\nbGF0ZUlucykpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAgICAgaWYgKGZpZWxkICE9IG51bGwg\nJiYgY3VyICE9IGZpZWxkKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgIGZpZWxkID0gY3VyOwoKICAgICAgICAgICAgLy8gcmVh\nZHkgZm9yIG5leHQgc2VhcmNoIGl0ZXJhdGlvbgogICAgICAgICAgICB3aGls\nZSAoYmFja3VwQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBjb2RlLm5l\neHQoKTsKICAgICAgICAgICAgICAgIGJhY2t1cENvdW50LS07CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVjb3JkIGEgdmlvbGF0aW9uIG9mIHRoZSBwcm9w\nZXJ0eSBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkVmlvbGF0aW9uKFN0cmluZyBrZXksIE9iamVjdFtdIGFyZ3Ms\nIGJvb2xlYW4gZmF0YWwpIHsKICAgICAgICBpZiAoX3Zpb2xhdGlvbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgX3Zpb2xhdGlvbnMgPSBuZXcgSGFzaFNldCgp\nOwogICAgICAgIF92aW9sYXRpb25zLmFkZChfbG9jLmdldChrZXksIGFyZ3Mp\nKTsKICAgICAgICBfZmFpbCB8PSBmYXRhbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIExvZyAvIHRocm93IHJlY29yZGVkIHByb3BlcnR5IGFjY2VzcyB2aW9s\nYXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1Zpb2xh\ndGlvbnMoKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25zID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHNlcCA9IEoyRG9Q\ncml2SGVscGVyLmdldExpbmVTZXBhcmF0b3IoKTsKICAgICAgICBTdHJpbmdC\ndWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX3Zpb2xhdGlvbnMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChpdHIubmV4dCgp\nKTsKICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKHNlcCk7CiAgICAgICAgfQogICAgICAgIE1lc3Nh\nZ2UgbXNnID0gX2xvYy5nZXQoInByb3BlcnR5LXZpb2xhdGlvbnMiLCBidWYp\nOwoKICAgICAgICBpZiAoX2ZhaWwpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICBfbG9nLndhcm4obXNnKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlcGxhY2VkIGFsbCBkaXJlY3QgYWNjZXNzIHRvIG1h\nbmFnZWQgZmllbGRzIHdpdGggdGhlIGFwcHJvcHJpYXRlCiAgICAgKiBwY0dl\ndC9wY1NldCBtZXRob2QuIE5vdGUgdGhhdCB0aGlzIGluY2x1ZGVzIGFjY2Vz\ncyB0byBmaWVsZHMKICAgICAqIG93bmVkIGJ5IFBlcnNpc3RlbmNlQ2FwYWJs\nZSBjbGFzc2VzIG90aGVyIHRoYW4gdGhpcyBvbmUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2VzcygpIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGNyZWF0\nZSB0ZW1wbGF0ZSBwdXRmaWVsZC9nZXRmaWVsZCBpbnN0cnVjdGlvbnMgdG8g\nc2VhcmNoIGZvcgogICAgICAgIENvZGUgdGVtcGxhdGUgPSAoQ29kZSkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSk7CiAgICAgICAgSW5zdHJ1Y3Rp\nb24gcHV0ID0gdGVtcGxhdGUucHV0ZmllbGQoKTsKICAgICAgICBJbnN0cnVj\ndGlvbiBnZXQgPSB0ZW1wbGF0ZS5nZXRmaWVsZCgpOwogICAgICAgIEluc3Ry\ndWN0aW9uIHN0YXQgPSB0ZW1wbGF0ZS5pbnZva2VzdGF0aWMoKTsKCiAgICAg\nICAgLy8gbG9vayB0aHJvdWdoIGFsbCBtZXRob2RzOyB0aGlzIGlzIGRvbmUg\nYmVmb3JlIGFueSBtZXRob2RzIGFyZSBhZGRlZAogICAgICAgIC8vIHNvIHdl\nIGRvbid0IG5lZWQgdG8gd29ycnkgYWJvdXQgZXhjbHVkaW5nIHN5bnRoZXRp\nYyBtZXRob2RzLgogICAgICAgIEJDTWV0aG9kW10gbWV0aG9kcyA9IF9tYW5h\nZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhvZHMoKTsKICAgICAgICBDb2RlIGNv\nZGU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRob2RzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUgPSBtZXRob2RzW2ldLmdldENv\nZGUoZmFsc2UpOwoKICAgICAgICAgICAgLy8gZG9uJ3QgbW9kaWZ5IHRoZSBt\nZXRob2RzIHNwZWNpZmllZCBieSB0aGUgYXV4aWxpYXJ5IGVuaGFuY2Vycwog\nICAgICAgICAgICBpZiAoY29kZSAhPSBudWxsICYmICFza2lwRW5oYW5jZSht\nZXRob2RzW2ldKSkgewogICAgICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlk\nYXRlRmllbGRBY2Nlc3MoY29kZSwgZ2V0LCB0cnVlLCBzdGF0KTsKICAgICAg\nICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKGNvZGUs\nIHB1dCwgZmFsc2UsIHN0YXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZXMgYWxsIGluc3RydWN0aW9u\ncyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGVtcGxhdGUgaW4gdGhlIGdpdmVuCiAg\nICAgKiBjb2RlIGJsb2NrIHdpdGggY2FsbHMgdG8gdGhlIGFwcHJvcHJpYXRl\nIGdlbmVyYXRlZCBnZXR0ZXIvc2V0dGVyLgogICAgICoKICAgICAqIEBwYXJh\nbSBjb2RlIHRoZSBjb2RlIGJsb2NrIHRvIG1vZGlmeTsgdGhlIGNvZGUgaXRl\ncmF0b3Igd2lsbAogICAgICogYmUgcGxhY2VkIGJlZm9yZSB0aGUgZmlyc3Qg\naW5zdHJ1Y3Rpb24gb24gbWV0aG9kIHN0YXJ0LAogICAgICogYW5kIHdpbGwg\nYmUgYWZ0ZXIgdGhlIGxhc3QgaW5zdHJ1Y3Rpb24gb24gbWV0aG9kIGNvbXBs\nZXRpb24KICAgICAqIEBwYXJhbSBpbnMgdGhlIHRlbXBsYXRlIGluc3RydWN0\naW9uIHRvIHNlYXJjaCBmb3I7IGVpdGhlciBhCiAgICAgKiBnZXRmaWVsZCBv\nciBwdXRmaWVsZCBpbnN0cnVjdGlvbgogICAgICogQHBhcmFtIGdldCBib29s\nZWFuIGluZGljYXRpbmcgaWYgdGhpcyBpcyBhIGdldCBpbnN0cnVjdGlvbgog\nICAgICogQHBhcmFtIHN0YXQgdGVtcGxhdGUgaW52b2tlc3RhdGljIGluc3Ry\ndWN0aW9uIHRvIHJlcGxhY2Ugd2l0aAogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoQ29kZSBjb2RlLCBJ\nbnN0cnVjdGlvbiBpbnMsCiAgICAgICAgYm9vbGVhbiBnZXQsIEluc3RydWN0\naW9uIHN0YXQpIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgRmllbGRJbnN0cnVj\ndGlvbiBmaTsKICAgICAgICBNZXRob2RJbnN0cnVjdGlvbiBtaTsKICAgICAg\nICBDbGFzc01ldGFEYXRhIG93bmVyOwogICAgICAgIFN0cmluZyBuYW1lLCB0\neXBlTmFtZSwgbWV0aG9kTmFtZTsKICAgICAgICB3aGlsZSAoY29kZS5zZWFy\nY2hGb3J3YXJkKGlucykpIHsKICAgICAgICAgICAgLy8gYmFjayB1cCB0byB0\naGUgbWF0Y2hlZCBpbnN0cnVjdGlvbgogICAgICAgICAgICBmaSA9IChGaWVs\nZEluc3RydWN0aW9uKSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAgIG5h\nbWUgPSBmaS5nZXRGaWVsZE5hbWUoKTsKICAgICAgICAgICAgdHlwZU5hbWUg\nPSBmaS5nZXRGaWVsZFR5cGVOYW1lKCk7CiAgICAgICAgICAgIG93bmVyID0g\nZ2V0UGVyc2lzdGVuY2VDYXBhYmxlT3duZXIobmFtZSwgZmkuZ2V0RmllbGRE\nZWNsYXJlclR5cGUoKSk7CgogICAgICAgICAgICBpZiAob3duZXIgIT0gbnVs\nbAogICAgICAgICAgICAgICAgJiYgb3duZXIuZ2V0QWNjZXNzVHlwZSgpID09\nIENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZKSB7CiAgICAgICAgICAg\nICAgICAvLyBpZiB3ZSdyZSBkaXJlY3RseSBhY2Nlc3NpbmcgYSBmaWVsZCBp\nbiBhbm90aGVyIGNsYXNzCiAgICAgICAgICAgICAgICAvLyBoaWVyYXJjaHkg\ndGhhdCB1c2VzIHByb3BlcnR5IGFjY2Vzcywgc29tZXRoaW5nIGlzIHdyb25n\nCiAgICAgICAgICAgICAgICBpZiAob3duZXIgIT0gX21ldGEgJiYgb3duZXIu\nZ2V0RGVjbGFyZWRGaWVsZChuYW1lKSAhPSBudWxsICYmCiAgICAgICAgICAg\nICAgICAgICAgX21ldGEgIT0gbnVsbCAmJiAhb3duZXIuZ2V0RGVzY3JpYmVk\nVHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5pc0Fzc2lnbmFibGVG\ncm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInByb3Bl\ncnR5LWZpZWxkLWFjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXsgX21ldGEsIG93bmVyLCBuYW1lLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCkgfSkp\nOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVjdGx5IGFjY2Vz\nc2luZyBhIHByb3BlcnR5LWJhY2tpbmcgZmllbGQgb3V0c2lkZQogICAgICAg\nICAgICAgICAgLy8gdGhlIHByb3BlcnR5IGluIG91ciBvd24gY2xhc3MsIG5v\ndGlmeSB1c2VyCiAgICAgICAgICAgICAgICBpZiAoaXNCYWNraW5nRmllbGRP\nZkFub3RoZXJQcm9wZXJ0eShuYW1lLCBjb2RlKSkKICAgICAgICAgICAgICAg\nICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWZpZWxkLWFjY2VzcyIsIG5l\ndyBPYmplY3RbXXsgX21ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgIG93\nbmVyLCBuYW1lLCBjb2RlLmdldE1ldGhvZCgpLmdldE5hbWUoKSB9LCBmYWxz\nZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvd25lciA9PSBu\ndWxsIHx8CiAgICAgICAgICAgICAgICBvd25lci5nZXREZWNsYXJlZEZpZWxk\nKGZyb21CYWNraW5nRmllbGROYW1lKG5hbWUpKSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAvLyBub3QgcGVyc2lzdGVudCBmaWVsZD8KICAgICAgICAg\nICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdldFJlZGVmaW5lKCkgJiYgIWdl\ndENyZWF0ZVN1YmNsYXNzKCkKICAgICAgICAgICAgICAgICYmIG93bmVyLmdl\ndEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkg\newogICAgICAgICAgICAgICAgLy8gcmVwbGFjZSB0aGUgaW5zdHJ1Y3Rpb24g\nd2l0aCBhIGNhbGwgdG8gdGhlIGdlbmVyYXRlZCBhY2Nlc3MKICAgICAgICAg\nICAgICAgIC8vIG1ldGhvZAogICAgICAgICAgICAgICAgbWkgPSAoTWV0aG9k\nSW5zdHJ1Y3Rpb24pIGNvZGUuc2V0KHN0YXQpOwoKICAgICAgICAgICAgICAg\nIC8vIGludm9rZSB0aGUgcHJvcGVyIGFjY2VzcyBtZXRob2QsIHdoZXRoZXIg\nZ2V0dGVyIG9yIHNldHRlcgogICAgICAgICAgICAgICAgU3RyaW5nIHByZWZp\neCA9IChnZXQpID8gUFJFICsgIkdldCIgOiBQUkUgKyAiU2V0IjsKICAgICAg\nICAgICAgICAgIG1ldGhvZE5hbWUgPSBwcmVmaXggKyBuYW1lOwogICAgICAg\nICAgICAgICAgaWYgKGdldCkgewogICAgICAgICAgICAgICAgICAgIG1pLnNl\ndE1ldGhvZChnZXRUeXBlKG93bmVyKS5nZXROYW1lKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIG1ldGhvZE5hbWUsIHR5cGVOYW1lLCBuZXcgU3RyaW5n\nW10KICAgICAgICAgICAgICAgICAgICAgICAgeyBnZXRUeXBlKG93bmVyKS5n\nZXROYW1lKCkgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgIG1pLnNldE1ldGhvZChnZXRUeXBlKG93bmVyKS5nZXRO\nYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZE5hbWUsICJ2\nb2lkIiwgbmV3IFN0cmluZ1tdCiAgICAgICAgICAgICAgICAgICAgICAgIHsg\nZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLCB0eXBlTmFtZSB9KTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGdldFJlZGVmaW5lKCkpIHsKICAgICAgICAg\nICAgICAgIG5hbWUgPSBmcm9tQmFja2luZ0ZpZWxkTmFtZShuYW1lKTsKICAg\nICAgICAgICAgICAgIGlmIChnZXQpIHsKICAgICAgICAgICAgICAgICAgICBh\nZGROb3RpZnlBY2Nlc3MoY29kZSwgb3duZXIuZ2V0RmllbGQobmFtZSkpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgdGhl\nIHNldCBvcGVyYXRpb25zIGFmdGVyIHRoZSBmaWVsZCBtdXRhdGlvbiwgYnV0\nCiAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3QgbG9hZCB0aGUgb2xkIHZh\nbHVlIGZvciB1c2UgaW4gdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gU3Rh\ndGVNYW5hZ2VyLnNldHRpbmdYWFggbWV0aG9kLgogICAgICAgICAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgICAgIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZkZpID0gZmk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKAogICAgICAgICAgICAgICAgICAgICAgICAoQkNGaWVsZCkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRB\nY3Rpb24oZkZpKSkpOwogICAgICAgICAgICAgICAgICAgIGludCB2YWwgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUueHN0b3JlKCkuc2V0TG9jYWwodmFsKS5zZXRUeXBlKGZpLmdldEZp\nZWxkVHlwZSgpKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gbW92ZSBwYXN0\nIHRoZSBwdXRmaWVsZAogICAgICAgICAgICAgICAgICAgIGNvZGUubmV4dCgp\nOwogICAgICAgICAgICAgICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNvZGUs\nIG93bmVyLmdldEZpZWxkKG5hbWUpLCB2YWwsIC0xKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNv\nZGUubmV4dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGFkZE5vdGlmeUFjY2VzcyhDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgLy8gUENIZWxwZXIuYWNjZXNzaW5nRmllbGQodGhpcywg\nPGFic29sdXRlLWluZGV4Pik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRo\naXMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywKICAgICAgICAgICAgImFj\nY2Vzc2luZ0ZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENs\nYXNzW10geyBPYmplY3QuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgc2V0dGlu\nZyB0aGUgdmFsdWUgaW4gdGhlIG9iamVjdC4KICAgICAqIAogICAgICogQHBh\ncmFtIGNvZGUKICAgICAqIEBwYXJhbSB2YWwgdGhlIHBvc2l0aW9uIGluIHRo\nZSBsb2NhbCB2YXJpYWJsZSB0YWJsZSB3aGVyZSB0aGUKICAgICAqIG9sZCB2\nYWx1ZSBpcyBzdG9yZWQKICAgICAqIEBwYXJhbSBwYXJhbSB0aGUgcGFyYW1l\ndGVyIHBvc2l0aW9uIGNvbnRhaW5pbmcgdGhlIG5ldyB2YWx1ZSwgb3IKICAg\nICAqIC0xIGlmIHRoZSBuZXcgdmFsdWUgaXMgdW5hdmFpbGFibGUgYW5kIHNo\nb3VsZCB0aGVyZWZvcmUgYmUgbG9va2VkCiAgICAgKiB1cC4KICAgICAqIEB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGROb3RpZnlNdXRhdGlvbihDb2RlIGNvZGUsIEZpZWxkTWV0\nYURhdGEgZm1kLCBpbnQgdmFsLAogICAgICAgIGludCBwYXJhbSkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBQ\nQ0hlbHBlci5zZXR0aW5nRmllbGQodGhpcywgPGFic29sdXRlLWluZGV4Piwg\nb2xkLCBuZXcpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICBDbGFzcyB0eXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgp\nOwogICAgICAgIC8vIHdlIG9ubHkgaGF2ZSBzcGVjaWFsIHNpZ25hdHVyZXMg\nZm9yIHByaW1pdGl2ZXMgYW5kIFN0cmluZ3MKICAgICAgICBpZiAoIXR5cGUu\naXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IFN0cmluZy5jbGFzcykKICAgICAg\nICAgICAgdHlwZSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2RlLnhsb2Fk\nKCkuc2V0TG9jYWwodmFsKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGlmIChw\nYXJhbSA9PSAtMSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBmbWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGNvZGUueGxvYWQoKS5zZXRQYXJhbShwYXJhbSkuc2V0VHlwZSh0eXBlKTsK\nICAgICAgICB9CiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLCAic2V0dGluZ0ZpZWxkIiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MsIHR5cGUsIHR5cGUK\nICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVl\nIGlmIHRoZSBnaXZlbiBpbnN0cnVjdGlvbiBhY2Nlc3NlcyBhIGZpZWxkIHRo\nYXQgaXMgYSBiYWNraW5nCiAgICAgKiBmaWVsZCBvZiBhbm90aGVyIHByb3Bl\ncnR5IGluIHRoaXMgcHJvcGVydHktYWNjZXNzIGNsYXNzLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNCYWNraW5nRmllbGRPZkFub3RoZXJQcm9w\nZXJ0eShTdHJpbmcgbmFtZSwgQ29kZSBjb2RlKSB7CiAgICAgICAgU3RyaW5n\nIG1ldGhOYW1lID0gY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCk7CiAgICAg\nICAgcmV0dXJuICEiPGluaXQ+Ii5lcXVhbHMobWV0aE5hbWUpCiAgICAgICAg\nICAgICYmIF9iYWNraW5nRmllbGRzICE9IG51bGwKICAgICAgICAgICAgJiYg\nIW5hbWUuZXF1YWxzKF9iYWNraW5nRmllbGRzLmdldChtZXRoTmFtZSkpCiAg\nICAgICAgICAgICYmIF9iYWNraW5nRmllbGRzLmNvbnRhaW5zVmFsdWUobmFt\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHJl\ndHVybiB0aGUgZGVjbGFyaW5nIFBlcnNpc3RlbmNlQ2FwYWJsZSBjbGFzcyBv\nZgogICAgICogdGhlIGdpdmVuIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJh\nbSBmaWVsZE5hbWUgdGhlIG5hbWUgb2YgdGhlIGZpZWxkCiAgICAgKiBAcGFy\nYW0gb3duZXIgdGhlIG5vbWluYWwgb3duZXIgb2YgdGhlIGZpZWxkCiAgICAg\nKiBAcmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSB0eXBlIHRoYXQKICAgICAqIGRlY2xhcmVzIHRoZSBmaWVsZCAoYW5k\nIHRoZXJlZm9yZSBoYXMgdGhlIHN0YXRpYyBtZXRob2QpLCBvciBudWxsIGlm\nIG5vbmUKICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIGdldFBl\ncnNpc3RlbmNlQ2FwYWJsZU93bmVyKFN0cmluZyBmaWVsZE5hbWUsCiAgICAg\nICAgQ2xhc3Mgb3duZXIpIHsKICAgICAgICAvLyBmaW5kIHRoZSBhY3R1YWwg\nYW5jZXN0b3IgY2xhc3MgdGhhdCBkZWNsYXJlcyB0aGUgZmllbGQsIHRoZW4K\nICAgICAgICAvLyBjaGVjayBpZiB0aGUgY2xhc3MgaXMgcGVyc2lzdGVudCwg\nYW5kIGlmIHRoZSBmaWVsZCBpcyBtYW5hZ2VkCiAgICAgICAgRmllbGQgZiA9\nIFJlZmxlY3Rpb24uZmluZEZpZWxkKG93bmVyLCBmaWVsZE5hbWUsIGZhbHNl\nKTsKICAgICAgICBpZiAoZiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgLy8gbWFuYWdlZCBpbnRlcmZhY2UKICAgICAgICBp\nZiAoX21ldGEgIT0gbnVsbCAmJiBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCku\naXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgcmV0dXJuIF9tZXRhOwoKICAg\nICAgICByZXR1cm4gX3JlcG9zLmdldE1ldGFEYXRhKGYuZ2V0RGVjbGFyaW5n\nQ2xhc3MoKSwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyBhbGwgc3ludGhldGljIG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2RlIGJ5\nIGRlbGVnYXRpbmcgdG8KICAgICAqIHRoZSB2YXJpb3VzIGFkZFhYWE1ldGhv\nZHMgKCkgZnVuY3Rpb25zIGluIHRoaXMgY2xhc3MuIEluY2x1ZGVzCiAgICAg\nKiBhbGwgc3RhdGljIGZpZWxkIGFjY2VzcyBtZXRob2RzLgogICAgICogTm90\nZSB0aGF0IHRoZSAnc3RvY2snIG1ldGhvZHMgbGlrZSA8Y29kZT5wY0lzVHJh\nbnNhY3Rpb25hbDwvY29kZT4sCiAgICAgKiA8Y29kZT5wY0ZldGNoT2JqZWN0\nSWQ8L2NvZGU+LCBldGMgYXJlIGRlZmluZWQgb25seSBpbiB0aGUKICAgICAq\nIGxlYXN0LWRlcml2ZWQgUGVyc2lzdGVuY2VDYXBhYmxlIHR5cGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQQ01ldGhvZHMoKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZENsZWFy\nRmllbGRzTWV0aG9kKCk7CiAgICAgICAgYWRkTmV3SW5zdGFuY2VNZXRob2Qo\ndHJ1ZSk7CiAgICAgICAgYWRkTmV3SW5zdGFuY2VNZXRob2QoZmFsc2UpOwog\nICAgICAgIGFkZE1hbmFnZWRGaWVsZENvdW50TWV0aG9kKCk7CiAgICAgICAg\nYWRkUmVwbGFjZUZpZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRQcm92aWRl\nRmllbGRzTWV0aG9kcygpOwogICAgICAgIGFkZENvcHlGaWVsZHNNZXRob2Qo\nKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51\nbGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBhZGRT\ndG9ja01ldGhvZHMoKTsKICAgICAgICAgICAgYWRkR2V0VmVyc2lvbk1ldGhv\nZCgpOwogICAgICAgICAgICBhZGRSZXBsYWNlU3RhdGVNYW5hZ2VyTWV0aG9k\nKCk7CgogICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkg\nIT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAg\nICAgIGFkZE5vT3BBcHBsaWNhdGlvbklkZW50aXR5TWV0aG9kcygpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gYWRkIHRoZSBhcHAgaWQgbWV0aG9kcyB0byBl\nYWNoIHN1YmNsYXNzIHJhdGhlcgogICAgICAgIC8vIHRoYW4ganVzdCB0aGUg\nc3VwZXJjbGFzcywgc2luY2UgaXQgaXMgcG9zc2libGUgdG8gaGF2ZQogICAg\nICAgIC8vIGEgc3ViY2xhc3Mgd2l0aCBhbiBhcHAgaWQgaGllcmFyY2h5IHRo\nYXQgbWF0Y2hlcyB0aGUKICAgICAgICAvLyBwZXJzaXN0ZW50IGNsYXNzIGlu\naGVyaXRhbmNlIGhpZXJhcmNoeQogICAgICAgIGlmIChfbWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OCiAg\nICAgICAgICAgICYmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxs\nIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkgfHwKICAgICAgICAgICAgICAgIF9t\nZXRhLmdldE9iamVjdElkVHlwZSgpICE9CiAgICAgICAgICAgICAgICAgICAg\nX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRPYmplY3RJZFR5\ncGUoKSkpIHsKICAgICAgICAgICAgYWRkQ29weUtleUZpZWxkc1RvT2JqZWN0\nSWRNZXRob2QodHJ1ZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNU\nb09iamVjdElkTWV0aG9kKGZhbHNlKTsKICAgICAgICAgICAgYWRkQ29weUtl\neUZpZWxkc0Zyb21PYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAg\nYWRkQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAg\nICAgICAgICAgIGFkZE5ld09iamVjdElkSW5zdGFuY2VNZXRob2QodHJ1ZSk7\nCiAgICAgICAgICAgIGFkZE5ld09iamVjdElkSW5zdGFuY2VNZXRob2QoZmFs\nc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG1l\ndGhvZCB0byBjbGVhciBhbGwgcGVyc2lzdGVudCBmaWVsZHM7IHdlJ2xsIGNh\nbGwgdGhpcyBmcm9tCiAgICAgKiB0aGUgbmV3IGluc3RhbmNlIG1ldGhvZCB0\nbyBlbnN1cmUgdGhhdCB1bmxvYWRlZCBmaWVsZHMgaGF2ZQogICAgICogZGVm\nYXVsdCB2YWx1ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDbGVh\nckZpZWxkc01ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHZvaWQgcGNDbGVhckZp\nZWxkcyAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJDbGVhckZpZWxkcyIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIHN1cGVyLnBjQ2xlYXJGaWVsZHMgKCkKICAgICAgICBpZiAo\nX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCAmJiAhZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgfQoKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldE1hbmFnZW1l\nbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgc3dpdGNoIChm\nbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5U\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDApOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZSgwRCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMEYpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEwpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAg\nICAgIH0KCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29k\nZT5wY05ld0luc3RhbmNlPC9jb2RlPiBtZXRob2QgdG8gdGhlIGJ5dGVjb2Rl\nLgogICAgICogVGhlc2UgbWV0aG9kcyBhcmUgdXNlZCBieSB0aGUgaW1wbCBo\nZWxwZXIgdG8gY3JlYXRlIG5ldwogICAgICogbWFuYWdlZCBpbnN0YW5jZXMg\nZWZmaWNpZW50bHkgd2l0aG91dCByZWZsZWN0aW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSBvaWQgc2V0IHRvIHRydWUgdG8gbWltaWMgdGhlIG1ldGhvZCB2\nZXJzaW9uIHRoYXQgdGFrZXMKICAgICAqIGFuIG9pZCB2YWx1ZSBhcyB3ZWxs\nIGFzIGEgc3RhdGUgbWFuYWdlcgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkTmV3SW5zdGFuY2VNZXRob2QoYm9vbGVhbiBvaWQpIHsKICAgICAgICAv\nLyBwdWJsaWMgUGVyc2lzdGVuY2VDYXBhYmxlIHBjTmV3SW5zdGFuY2UgKC4u\nLikKICAgICAgICBDbGFzc1tdIGFyZ3MgPQogICAgICAgICAgICAob2lkKSA/\nIG5ldyBDbGFzc1tdeyBTTVRZUEUsIE9iamVjdC5jbGFzcywgYm9vbGVhbi5j\nbGFzcyB9CiAgICAgICAgICAgICAgICA6IG5ldyBDbGFzc1tdeyBTTVRZUEUs\nIGJvb2xlYW4uY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3SW5zdGFuY2UiLCBQQ1RZUEUs\nIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwoKICAgICAgICAvLyBpZiB0aGUgdHlwZSBpcyBhYnN0cmFjdCwgdGhy\nb3cgYSBVc2VyRXhjZXB0aW9uCiAgICAgICAgaWYgKF9wYy5pc0Fic3RyYWN0\nKCkpIHsKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgVVNFUkVY\nQ0VQKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIC8vIFhYWCBwYyA9IG5ldyBYWFggKCk7CiAgICAg\nICAgY29kZS5hbmV3KCkuc2V0VHlwZShfcGMpOwogICAgICAgIGNvZGUuZHVw\nKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8\naW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICBpbnQgaW5zdCA9\nIGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5hc3Rv\ncmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAgLy8gaWYgKGNsZWFyKQog\nICAgICAgIC8vICAgcGMucGNDbGVhckZpZWxkcyAoKTsKICAgICAgICBjb2Rl\nLmlsb2FkKCkuc2V0UGFyYW0oKG9pZCkgPyAyIDogMSk7CiAgICAgICAgSnVt\ncEluc3RydWN0aW9uIG5vY2xlYXIgPSBjb2RlLmlmZXEoKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJDbGVhckZpZWxkcyIsIHZv\naWQuY2xhc3MsIG51bGwpOwoKICAgICAgICAvLyBwYy5wY1N0YXRlTWFuYWdl\nciA9IHNtOwogICAgICAgIG5vY2xlYXIuc2V0VGFyZ2V0KGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChpbnN0KSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKCiAgICAgICAgLy8gY29weSBrZXkgZmllbGRzIGZyb20gb2lk\nCiAgICAgICAgaWYgKG9pZCkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgxKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXR1cm4gcGM7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgIGNv\nZGUuYXJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnByb3RlY3RlZCBzdGF0\naWMgaW50IHBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCk8L2NvZGU+CiAgICAg\nKiBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLCByZXR1cm5pbmcgdGhlIGluaGVy\naXRlZCBmaWVsZCBjb3VudCBhZGRlZAogICAgICogdG8gdGhlIG51bWJlciBv\nZiBtYW5hZ2VkIGZpZWxkcyBpbiB0aGUgY3VycmVudCBQZXJzaXN0ZW5jZUNh\ncGFibGUgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRNYW5h\nZ2VkRmllbGRDb3VudE1ldGhvZCgpIHsKICAgICAgICAvLyBwcm90ZWN0ZWQg\nc3RhdGljIGludCBwY0dldE1hbmFnZWRGaWVsZENvdW50ICgpCiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdl\ndE1hbmFnZWRGaWVsZENvdW50IiwKICAgICAgICAgICAgaW50LmNsYXNzLCBu\ndWxsKTsKICAgICAgICBtZXRob2Quc2V0U3RhdGljKHRydWUpOwogICAgICAg\nIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHJldHVybiA8Zmll\nbGRzPiArIHBjSW5oZXJpdGVkRmllbGRDb3VudAogICAgICAgIC8vIGF3aGl0\nZTogdGhlIGFib3ZlIHNob3VsZCB3b3JrLCBidXQgSSdtIHNlZWluZyBhIG1l\nc3NlZCB1cCBzaXR1YXRpb24KICAgICAgICAvLyBhbGwgb2YgYSBzdWRkZW4g\nd2hlcmUgd2hlbiBhIHN1YmNsYXNzIGNhbGxzIHRoaXMgbWV0aG9kLCBpdCBz\nb21laG93CiAgICAgICAgLy8gaGFwcGVucyBiZWZvcmUgPGNsaW5pdD4gaXMg\nZXZlciBpbnZva2VkLCBhbmQgc28gb3VyCiAgICAgICAgLy8gcGNJbmhlcml0\nZWRGaWVsZENvdW50IGZpZWxkIGlzbid0IGluaXRpYWxpemVkISAgc28gaW5z\ndGVhZCwKICAgICAgICAvLyByZXR1cm4gPGZpZWxkcz4gKyA8c3VwZXJjbGFz\ncz4ucGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpLmxl\nbmd0aCk7CiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9\nIG51bGwpIHsKICAgICAgICAgICAgQ2xhc3Mgc3VwZXJDbGFzcyA9IGdldFR5\ncGUoX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSk7CiAgICAgICAg\nICAgIFN0cmluZyBzdXBlck5hbWUgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8K\nICAgICAgICAgICAgICAgIFBDRW5oYW5jZXIudG9QQ1N1YmNsYXNzTmFtZShz\ndXBlckNsYXNzKSA6CiAgICAgICAgICAgICAgICBzdXBlckNsYXNzLmdldE5h\nbWUoKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2Qoc3VwZXJOYW1lLAogICAgICAgICAgICAgICAgUFJFICsgIkdldE1hbmFn\nZWRGaWVsZENvdW50IiwgaW50LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7CiAg\nICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIH0KICAgICAgICBjb2Rl\nLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lz\ndGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkfSBhbmQKICAgICAqIHtAbGlu\nayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNQcm92aWRlRmllbGRzfSBtZXRob2Rz\nIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFByb3ZpZGVGaWVsZHNNZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY1By\nb3ZpZGVGaWVsZCAoaW50IGZpZWxkTnVtYmVyKQogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJQcm92aWRlRmll\nbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50\nLmNsYXNzIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhyb3VnaCB0\naGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVnaW5Td2l0\nY2hNZXRob2QoUFJFICsgIlByb3ZpZGVGaWVsZCIsIGNvZGUpOwoKICAgICAg\nICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRocm93IGV4\nY2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAg\nIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1k\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29k\nZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAg\nIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3\naXRjaCgpOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAg\nICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAg\nICAgICAgLy8gPGZpZWxkPiA9IHBjU3RhdGVNYW5hZ2VyLnByb3ZpZGVkPHR5\ncGU+RmllbGQKICAgICAgICAgICAgLy8gICAgICh0aGlzLCBmaWVsZE51bWJl\ncik7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShj\nb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAg\nICAgICAgICAgICAgICAgIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAi\ncHJvdmlkZWQiLCBmYWxzZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBk\nZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgp\nCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhj\nZXB0aW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJz\naW9uKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7\nQGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkfSBhbmQK\nICAgICAqIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmll\nbGRzfSBtZXRob2RzIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZFJlcGxhY2VGaWVsZHNNZXRob2RzKCkKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJs\naWMgdm9pZCBwY1JlcGxhY2VGaWVsZCAoaW50IGZpZWxkTnVtYmVyKQogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJSZXBsYWNlRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1l\ndGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhp\nbmcgdGhyb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2Fs\nID0gYmVnaW5Td2l0Y2hNZXRob2QoUFJFICsgIlJlcGxhY2VGaWVsZCIsIGNv\nZGUpOwoKICAgICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBq\ndXN0IHRocm93IGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygp\nCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAg\nICAgICBpZiAoZm1kcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dF\neGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNz\nKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwp\nCiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7\nCiAgICAgICAgICAgIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0g\nY29kZS50YWJsZXN3aXRjaCgpOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93\nKDApOwogICAgICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAt\nIDEpOwoKICAgICAgICAgICAgLy8gPGZpZWxkPiA9IHBjU3RhdGVNYW5hZ2Vy\nLnJlcGxhY2U8dHlwZT5GaWVsZAogICAgICAgICAgICAvLyAgKHRoaXMsIGZp\nZWxkTnVtYmVyKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGhl\nIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUgY2FsbCBiZWxvdy4KICAgICAgICAg\nICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSkpOwoKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1h\nbmFnZXJNZXRob2QKICAgICAgICAgICAgICAgICAgICAoZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKSwgInJlcGxhY2UiLCB0cnVlLCBmYWxzZSkpOwogICAg\nICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLmlz\nUHJpbWl0aXZlKCkpCiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAg\nICAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3IEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0YWJpbnMu\nc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAg\nICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwog\nICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGFk\nZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSNwY0NvcHlGaWVsZHN9IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5RmllbGRzTWV0aG9kKCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlGaWVsZCAoT2JqZWN0IHBjLCBpbnQg\nZmllbGQpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgIkNvcHlGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xh\nc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICBuZXcgU3RyaW5nW117IF9tYW5h\nZ2VkVHlwZS5nZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfSk7CiAg\nICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBl\ndmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCBy\nZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJDb3B5RmllbGQi\nLCBjb2RlKTsKCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5z\ndCwganVzdCB0aHJvdyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVs\nZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7\nCiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRo\ncm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5j\nbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAo\ndmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9j\nYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlu\ncyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNl\ndExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5n\ndGggLSAxKTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgLy8gPGZpZWxkPiA9\nIG90aGVyLjxmaWVsZD47CiAgICAgICAgICAgICAgICAvLyBvciBzZXQ8Zmll\nbGQ+IChvdGhlci5nZXQ8ZmllbGQ+KTsKICAgICAgICAgICAgICAgIHRhYmlu\ncy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBm\nbWRzW2ldLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRTZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwoKICAgICAgICAgICAgICAgIC8v\nIGJyZWFrOwogICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5z\nLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAg\nICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsK\nICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBh\nZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBjb2Rl\nIGNvbW1vbiB0byB0aGUgYmVnaW5uaW5nIG9mIGJvdGggdGhlCiAgICAgKiBw\nY1JlcGxhY2VGaWVsZCBtZXRob2QgYW5kIHRoZSBwY1Byb3ZpZGVGaWVsZCBt\nZXRob2QuIFRoaXMgaW5jbHVkZXMKICAgICAqIGNhbGN1bGF0aW5nIHRoZSBy\nZWxhdGl2ZSBmaWVsZCBudW1iZXIgb2YgdGhlIGRlc2lyZWQgZmllbGQgYW5k\nIGNhbGxpbmcKICAgICAqIHRoZSBzdXBlcmNsYXNzIGlmIG5lY2Vzc2FyeS4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBpbmRleCBpbiB3aGljaCB0aGUg\nbG9jYWwgdmFyaWFibGUgaG9sZGluZyB0aGUgcmVsYXRpdmUKICAgICAqIGZp\nZWxkIG51bWJlciBpcyBzdG9yZWQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQg\nYmVnaW5Td2l0Y2hNZXRob2QoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewog\nICAgICAgIGJvb2xlYW4gY29weSA9IChQUkUgKyAiQ29weUZpZWxkIikuZXF1\nYWxzKG5hbWUpOwogICAgICAgIGludCBmaWVsZE51bWJlciA9IChjb3B5KSA/\nIDEgOiAwOwoKICAgICAgICBpbnQgcmVsTG9jYWwgPSBjb2RlLmdldE5leHRM\nb2NhbHNJbmRleCgpOwogICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVsZE51\nbWJlcik7CiAgICAgICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwocmVs\nTG9jYWwpOwogICAgICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpbnQgcmVsID0gZmllbGROdW1iZXIgLSBwY0luaGVy\naXRlZEZpZWxkQ291bnQKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0o\nZmllbGROdW1iZXIpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2RlLmlzdWIoKTsK\nICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKHJlbExvY2FsKTsKICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwoKICAgICAg\nICAvLyBzdXBlcjogaWYgKHJlbCA8IDApIHN1cGVyLnBjUmVwbGFjZUZpZWxk\nIChmaWVsZE51bWJlcik7IHJldHVybjsKICAgICAgICAvLyBubyBzdXBlcjog\naWYgKHJlbCA8IDApIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24gKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZmdlKCk7CiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9\nIG51bGwpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIFN0cmluZ1tdIGFyZ3M7CiAgICAgICAg\nICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0\ncmluZ1tdeyBnZXRUeXBlKF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCkpLgogICAgICAgICAgICAgICAgICAgIGdldE5hbWUoKSwgaW50LmNsYXNz\nLmdldE5hbWUoKSB9OwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nIGFyZ3MgPSBuZXcgU3RyaW5nW117IGludC5jbGFzcy5nZXROYW1lKCkgfTsK\nICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVy\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksIG5hbWUsIAogICAgICAgICAgICAg\nICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgdGhy\nb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNs\nYXNzKTsKCiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwog\nICAgICAgIHJldHVybiByZWxMb2NhbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoaXMgaGVscGVyIG1ldGhvZCwgZ2l2ZW4gdGhlIHBjUmVwbGFjZUZpZWxk\nIG9yIHBjUHJvdmlkZUZpZWxkCiAgICAgKiBtZXRob2QsIGFkZHMgdGhlIGJ5\ndGVjb2RlIGZvciB0aGUgY29ycmVzcG9uZGluZyAncGx1cmFsJyB2ZXJzaW9u\nCiAgICAgKiBvZiB0aGUgbWV0aG9kIC0tIHRoZSB2ZXJzaW9uIHRoYXQgdGFr\nZXMgYW4gaW50W10gb2YgZmllbGRzIHRvCiAgICAgKiB0byBhY2Nlc3MgcmF0\naGVyIHRoYW4gYSBzaW5nbGUgZmllbGQuIFRoZSBtdWx0aXBsZSBmaWVsZHMg\ndmVyc2lvbgogICAgICogc2ltcGx5IGxvb3BzIHRocm91Z2ggdGhlIHByb3Zp\nZGVkIGluZGV4ZXMgYW5kIGRlbGVnYXRlcyB0byB0aGUKICAgICAqIHNpbmd1\nbGFyIHZlcnNpb24gZm9yIGVhY2ggb25lLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKEJDTWV0aG9k\nIHNpbmdsZSkgewogICAgICAgIGJvb2xlYW4gY29weSA9IChQUkUgKyAiQ29w\neUZpZWxkIikuZXF1YWxzKHNpbmdsZS5nZXROYW1lKCkpOwoKICAgICAgICAv\nLyBwdWJsaWMgdm9pZCA8bWV0aG9kPnMgKGludFtdIGZpZWxkcykKICAgICAg\nICBDbGFzc1tdIGFyZ3MgPSAoY29weSkgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0\nLmNsYXNzLCBpbnRbXS5jbGFzcyB9CiAgICAgICAgICAgIDogbmV3IENsYXNz\nW117IGludFtdLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2Qoc2luZ2xlLmdldE5hbWUoKSArICJzIiwKICAg\nICAgICAgICAgdm9pZC5jbGFzcywgYXJncyk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGludCBmaWVsZE51\nbWJlcnMgPSAwOwogICAgICAgIGludCBpbnN0ID0gMDsKICAgICAgICBpZiAo\nY29weSkgewogICAgICAgICAgICBmaWVsZE51bWJlcnMgPSAxOwoKICAgICAg\nICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAg\nICAgIC8vIGdldCB0aGUgbWFuYWdlZCBpbnN0YW5jZSBpbnRvIHRoZSBsb2Nh\nbCB2YXJpYWJsZSB0YWJsZQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoSW1wbEhlbHBlci5jbGFzcywKICAgICAgICAgICAg\nICAgICAgICAiZ2V0TWFuYWdlZEluc3RhbmNlIiwgT2JqZWN0LmNsYXNzLAog\nICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAgICBpbnN0ID0gY29kZS5n\nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgIGNvZGUuYXN0\nb3JlKCkuc2V0TG9jYWwoaW5zdCk7CgogICAgICAgICAgICAgICAgLy8gdGhl\ncmUgbWlnaHQgYmUgYSBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGNsYXNzZXMg\nb2YgJ3RoaXMnCiAgICAgICAgICAgICAgICAvLyB2cyAnb3RoZXInIGluIHRo\naXMgY29udGV4dDsgdXNlIHRoZSBQQyBtZXRob2RzIHRvIGdldCB0aGUgU00K\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAg\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChJbXBsSGVscGVyLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICJ0b1Bl\ncnNpc3RlbmNlQ2FwYWJsZSIsIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywK\nICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFz\ncywgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoUGVyc2lzdGVuY2VDYXBhYmxlLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgICJwY0dldFN0YXRlTWFuYWdlciIs\nIFN0YXRlTWFuYWdlci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAvLyBYWFggb3RoZXIgPSAoWFhYKSBwYzsK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfcGMpOwog\nICAgICAgICAgICAgICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGlu\nc3QpOwoKICAgICAgICAgICAgICAgIC8vIGFjY2VzcyB0aGUgb3RoZXIncyBz\nbSBmaWVsZCBkaXJlY3RseQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKGluc3QpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBpZiAob3RoZXIucGNTdGF0ZU1hbmFnZXIgIT0gcGNTdGF0\nZU1hbmFnZXIpCiAgICAgICAgICAgIC8vCXRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24KCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZhY21wZXEoKTsKICAgICAgICAgICAgdGhy\nb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNs\nYXNzKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkp\nOwoKICAgICAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwp\nCiAgICAgICAgICAgIC8vICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00s\nIFNNVFlQRSk7CiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm5vbm51bGwo\nKTsKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbFN0\nYXRlRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFy\nZ2V0KGNvZGUubm9wKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gZm9yIChp\nbnQgaSA9IDA7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDAp\nOwogICAgICAgIGludCBpZHggPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgp\nOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoaWR4KTsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gdGVzdGlucyA9IGNvZGUuZ28yKCk7CgogICAg\nICAgIC8vIDxtZXRob2Q+IChmaWVsZHNbaV0pOwogICAgICAgIEluc3RydWN0\naW9uIGJvZHlpbnMgPSBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICBpZiAoY29weSkKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKGluc3QpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbShmaWVsZE51bWJlcnMpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2Nh\nbChpZHgpOwogICAgICAgIGNvZGUuaWFsb2FkKCk7CiAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHNpbmdsZSk7CgogICAgICAgIC8v\nIGkrKzsKICAgICAgICBjb2RlLmlpbmMoKS5zZXRJbmNyZW1lbnQoMSkuc2V0\nTG9jYWwoaWR4KTsKCiAgICAgICAgLy8gaSA8IGZpZWxkcy5sZW5ndGgKICAg\nICAgICB0ZXN0aW5zLnNldFRhcmdldChjb2RlLmlsb2FkKCkuc2V0TG9jYWwo\naWR4KSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVt\nYmVycyk7CiAgICAgICAgY29kZS5hcnJheWxlbmd0aCgpOwogICAgICAgIGNv\nZGUuaWZpY21wbHQoKS5zZXRUYXJnZXQoYm9keWlucyk7CiAgICAgICAgY29k\nZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUgJ3N0b2NrJyBtZXRob2RzIHRvIHRo\nZSBieXRlY29kZTsgdGhlc2UgaW5jbHVkZSBtZXRob2RzCiAgICAgKiBsaWtl\nIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNGZXRjaE9iamVjdElkfQog\nICAgICogYW5kIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNJc1RyYW5z\nYWN0aW9uYWx9LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3RvY2tN\nZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBwY0dldEdlbmVyaWND\nb250ZXh0CiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJN\nZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgU01UWVBFLCAiZ2V0IiArIENPTlRFWFROQU1FLCAoQ2xh\nc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNG\nZXRjaE9iamVjdElkCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1h\nbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgU01UWVBFLCAiZmV0Y2hPYmplY3RJZCIsIChD\nbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBw\nY0lzRGVsZXRlZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5h\nZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzRGVsZXRlZCIsIChDbGFzc1td\nKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzRGly\ndHkKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhv\nZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBTTVRZUEUsICJpc0RpcnR5IiwgKENsYXNzW10pIG51bGwpKSwg\ndHJ1ZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc05ldwogICAgICAgICAg\nICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAg\nICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFy\nZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQ\nRSwgImlzTmV3IiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAg\nICAgICAgICAgIC8vIHBjSXNQZXJzaXN0ZW50CiAgICAgICAgICAgIHRyYW5z\nbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAo\nTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhv\nZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNQ\nZXJzaXN0ZW50IiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAg\nICAgICAgICAgIC8vIHBjSXNUcmFuc2FjdGlvbmFsCiAgICAgICAgICAgIHRy\nYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAg\nICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1l\ndGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAi\naXNUcmFuc2FjdGlvbmFsIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwog\nICAgCiAgICAgICAgICAgIC8vIHBjU2VyaWFsaXppbmcKICAgICAgICAgICAg\ndHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAg\nICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVk\nTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUs\nICJzZXJpYWxpemluZyIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAg\nIAogICAgICAgICAgICAvLyBwY0RpcnR5CiAgICAgICAgICAgIHRyYW5zbGF0\nZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0\naG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFj\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiZGlydHki\nLCBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH0pKSwgZmFsc2UpOwogICAg\nCiAgICAgICAgICAgIC8vIHBjR2V0U3RhdGVNYW5hZ2VyCiAgICAgICAgICAg\nIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0\nU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlci5j\nbGFzcywgbnVsbCk7CiAgICAgICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZChTTSwgU3RhdGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBh\nZSkgewogICAgICAgICAgICAgdGhyb3cgKE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIGEgc3RvY2sgbWV0aG9k\nIHRvIHRoZSBieXRlY29kZS4gRWFjaAogICAgICogc3RvY2sgbWV0aG9kIHNp\nbXBseSBkZWxlZ2F0ZXMgdG8gYSBjb3JyZXNwb25kaW5nIFN0YXRlTWFuYWdl\nciBtZXRob2QuCiAgICAgKiBHaXZlbiB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhv\nZCwgdGhlbiwgdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGl0IGludG8KICAg\nICAqIHRoZSB3cmFwcGVyIG1ldGhvZCB0aGF0IHNob3VsZCBiZSBhZGRlZCB0\nbyB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0cmFu\nc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKE1ldGhvZCBtLAogICAgICAg\nIGJvb2xlYW4gaXNEaXJ0eUNoZWNrTWV0aG9kKSB7CiAgICAgICAgLy8gZm9y\nbSB0aGUgbmFtZSBvZiB0aGUgbWV0aG9kIGJ5IHByZXBlbmRpbmcgJ3BjJyB0\nbyB0aGUgc20gbWV0aG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBQUkUgKyBT\ndHJpbmdVdGlscy5jYXBpdGFsaXplKG0uZ2V0TmFtZSgpKTsKICAgICAgICBD\nbGFzc1tdIHBhcmFtcyA9IG0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAg\nICBDbGFzcyByZXR1cm5UeXBlID0gbS5nZXRSZXR1cm5UeXBlKCk7CgogICAg\nICAgIC8vIGFkZCB0aGUgbWV0aG9kIHRvIHRoZSBwYwogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKG5hbWUsIHJldHVyblR5\ncGUsIHBhcmFtcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBu\ndWxsKSByZXR1cm4gPGRlZmF1bHQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24g\naWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGlmIChyZXR1cm5U\neXBlLmVxdWFscyhib29sZWFuLmNsYXNzKSkKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICBlbHNlIGlmICgh\ncmV0dXJuVHlwZS5lcXVhbHModm9pZC5jbGFzcykpCiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS54cmV0dXJu\nKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsKCiAgICAgICAgLy8gaWYgdGhpcyBp\ncyB0aGUgZGlydHktY2hlY2sgbWV0aG9kIGFuZCB3ZSdyZSBzdWJjbGFzc2lu\nZyBidXQgbm90CiAgICAgICAgLy8gcmVkZWZpbmluZywgaG9vayBpbnRvIFBD\nSGVscGVyIHRvIGRvIHRoZSBkaXJ0eSBjaGVjawogICAgICAgIGlmIChpc0Rp\ncnR5Q2hlY2tNZXRob2QgJiYgIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAg\nICAgLy8gUmVkZWZpbml0aW9uSGVscGVyLmRpcnR5Q2hlY2soc20pOwogICAg\nICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSkpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7IC8v\nIGZvciB0aGUgcmV0dXJuIHN0YXRlbWVudCBiZWxvdwogICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxw\nZXIuY2xhc3MsIAogICAgICAgICAgICAgICAgImRpcnR5Q2hlY2siLCB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IFNNVFlQRSB9KTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIC8vIHJldHVybiBwY1N0YXRlTWFuYWdlci48bWV0aG9kPiAo\nPGFyZ3M+KTsKICAgICAgICAvLyBtYW5hZ2VkIGluc3RhbmNlIGxvYWRlZCBh\nYm92ZSBpbiBpZi1lbHNlIGJsb2NrCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNvZGUueGxv\nYWQoKS5zZXRQYXJhbShpKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChtKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRU\neXBlKHJldHVyblR5cGUpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5j\nZUNhcGFibGUjcGNHZXRWZXJzaW9ufSBtZXRob2QgdG8gdGhlIGJ5dGVjb2Rl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0VmVyc2lvbk1ldGhv\nZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkdldFZlcnNpb24iLCBPYmplY3QuY2xhc3MsCiAgICAgICAgICAgIG51\nbGwpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIHZlcnNpb25GaWVsZCA9IF9tZXRhLmdl\ndFZlcnNpb25GaWVsZCgpOwoKICAgICAgICBpZiAodmVyc2lvbkZpZWxkID09\nIG51bGwpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nIC8vIHJldHVybiBudWxsOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAv\nLyByZXR1cm4gPHZlcnNpb25GaWVsZD47CiAgICAgICAgICAgIENsYXNzIHdy\nYXBwZXIgPSB0b1ByaW1pdGl2ZVdyYXBwZXIodmVyc2lvbkZpZWxkKTsKICAg\nICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZpZWxkLmdldERlY2xh\ncmVkVHlwZSgpKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRU\neXBlKHdyYXBwZXIpOwogICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShjb2RlLCB2ZXJzaW9uRmllbGQpOwogICAgICAgICAgICBpZiAod3JhcHBl\nciAhPSB2ZXJzaW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkpCiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qod3JhcHBl\nciwgIjxpbml0PiIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IENsYXNzW117IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSB9\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAg\nIC8vIHJldHVybiBwY1N0YXRlTWFuYWdlci5nZXRWZXJzaW9uICgpOwogICAg\nICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKFNNVFlQRSwgImdldFZlcnNpb24iLCBPYmplY3QuY2xhc3MsCiAg\nICAgICAgICAgIG51bGwpOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgdmVyc2lvbiBmaWVsZCB0eXBlIGFzIGEgcHJpbWl0aXZlIHdy\nYXBwZXIsIG9yIG51bGwgaWYKICAgICAqIHRoZSB2ZXJzaW9uIGZpZWxkIGlz\nIG5vdCBwcmltaXRpdmUuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgdG9Q\ncmltaXRpdmVXcmFwcGVyKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVybiBCeXRlLmNsYXNzOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAg\nICAgcmV0dXJuIENoYXJhY3Rlci5jbGFzczsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIERvdWJs\nZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gRmxvYXQuY2xhc3M7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHJldHVybiBJ\nbnRlZ2VyLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05H\nOgogICAgICAgICAgICAgICAgcmV0dXJuIExvbmcuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIFNob3J0LmNsYXNzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZm1k\nLmdldERlY2xhcmVkVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VTdGF0\nZU1hbmFnZXJ9CiAgICAgKiBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1l\ndGhvZCgpIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY1JlcGxhY2VTdGF0\nZU1hbmFnZXIgKFN0YXRlTWFuYWdlciBzbSkKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFjZVN0YXRl\nTWFuYWdlciIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBTTVRZUEUgfSk7CiAgICAgICAgbWV0aG9kLnNldFN5bmNocm9uaXplZCh0\ncnVlKTsKICAgICAgICBtZXRob2QuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRF\neGNlcHRpb24oU2VjdXJpdHlFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBp\nZiAocGNTdGF0ZU1hbmFnZXIgIT0gbnVsbCkKICAgICAgICAvLwlwY1N0YXRl\nTWFuYWdlciA9IHBjU3RhdGVNYW5hZ2VyLnJlcGxhY2VTdGF0ZU1hbmFnZXIo\nc20pOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVs\nbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBFLCAicmVwbGFj\nZVN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgIFNNVFlQRSwgbmV3IENsYXNz\nW117IFNNVFlQRSB9KTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAg\nICAgIC8vIFNlY3VyaXR5TWFuYWdlciBzZWMgPSBTeXN0ZW0uZ2V0U2VjdXJp\ndHlNYW5hZ2VyICgpOwogICAgICAgIC8vIGlmIChzZWMgIT0gbnVsbCkKICAg\nICAgICAvLwkJc2VjLmNoZWNrUGVybWlzc2lvbiAoUGVybWlzc2lvbi5TRVRf\nU1RBVEVfTUFOQUdFUik7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFN5c3RlbS5jbGFzcywKICAgICAg\nICAgICAgImdldFNlY3VyaXR5TWFuYWdlciIsIFNlY3VyaXR5TWFuYWdlci5j\nbGFzcywgbnVsbCkpOwoKICAgICAgICAvLyBwY1N0YXRlTWFuYWdlciA9IHNt\nOwogICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgbWV0aG9kcyBkZWFsaW5nIHdpdGggYXBwbGlj\nYXRpb24KICAgICAqIGlkZW50aXR5IGFuZCBnaXZlcyB0aGVtIG5vLW9wIGlt\ncGxlbWVudGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5v\nT3BBcHBsaWNhdGlvbklkZW50aXR5TWV0aG9kcygpIHsKICAgICAgICAvLyBw\ndWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElkIChPYmplY3RJ\nZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAgICAgLy8gCU9iamVjdCBvaWQpCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW117IE9JREZTVFlQRSwgT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29w\neUtleUZpZWxkc1RvT2JqZWN0SWQgKE9iamVjdCBvaWQpCiAgICAgICAgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNU\nb09iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGlj\nIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIChPYmplY3RJZEZp\nZWxkQ29uc3VtZXIgZmMsCiAgICAgICAgLy8JT2JqZWN0IG9pZCkKICAgICAg\nICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5l\ndyBDbGFzc1tdeyBPSURGQ1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAg\nICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJvbU9i\namVjdElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5j\nbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7\nCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBwY05l\nd09iamVjdElkSW5zdGFuY2UgKCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZSA9IG1l\ndGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdP\nYmplY3RJZEluc3RhbmNlIChPYmplY3Qgb2JqKQogICAgICAgIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNl\nIiwKICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNDb3B5S2V5\nRmllbGRzVG9PYmplY3RJZDwvY29kZT4gbWV0aG9kcwogICAgICogdG8gY2xh\nc3NlcyB1c2luZyBhcHBsaWNhdGlvbiBpZGVudGl0eS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElkTWV0aG9k\nKGJvb2xlYW4gZmllbGRNYW5hZ2VyKQogICAgICAgIHRocm93cyBOb1N1Y2hN\nZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29w\neUtleUZpZWxkc1RvT2JqZWN0SWQgKE9iamVjdElkRmllbGRTdXBwbGllciBm\ncywKICAgICAgICAvLwlPYmplY3Qgb2lkKQogICAgICAgIFN0cmluZ1tdIGFy\nZ3MgPSAoZmllbGRNYW5hZ2VyKSA/CiAgICAgICAgICAgIG5ldyBTdHJpbmdb\nXXsgT0lERlNUWVBFLmdldE5hbWUoKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUo\nKSB9CiAgICAgICAgICAgIDogbmV3IFN0cmluZ1tdeyBPYmplY3QuY2xhc3Mu\nZ2V0TmFtZSgpIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwK\nICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBzaW5nbGUgZmllbGQgaWRlbnRpdHkgYWx3YXlzIHRocm93cyBleGNl\ncHRpb24KICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkg\newogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJTlRFUk5FWENF\nUCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAg\nICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdl\ndENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbShpKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAg\nICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCks\nCiAgICAgICAgICAgICAgICBQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0\nSWQiLCB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBPYmplY3QgaWQgPSBvaWQ7CiAgICAgICAgaWYgKGZpZWxk\nTWFuYWdlcikKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwoKICAgICAgICBpZiAoX21ldGEuaXNPYmplY3RJZFR5cGVTaGFy\nZWQoKSkgewogICAgICAgICAgICAvLyBvaWQgPSAoKE9iamVjdElkKSBpZCku\nZ2V0SWQgKCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShPYmplY3RJZC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgfQoK\nICAgICAgICAvLyA8b2lkIHR5cGU+IGlkID0gKDxvaWQgdHlwZT4pIG9pZDsK\nICAgICAgICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwog\nICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUo\nKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7\nCiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7CgogICAgICAg\nIC8vIGludCBpbmhlcml0ZWQgPSBwY0luaGVyaXRlZEZpZWxkQ291bnQ7CiAg\nICAgICAgaW50IGluaGVyaXRlZCA9IDA7CiAgICAgICAgaWYgKGZpZWxkTWFu\nYWdlcikgewogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgIGluaGVyaXRlZCA9\nIGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNvZGUu\naXN0b3JlKCkuc2V0TG9jYWwoaW5oZXJpdGVkKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGlkLjxmaWVsZD4gPSBmcy5mZXRjaDx0eXBlPkZpZWxkICg8aW5k\nZXg+KTsgb3IuLi4KICAgICAgICAvLyBpZC48ZmllbGQ+ID0gcGMuPGZpZWxk\nPjsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1\nYmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9t\nZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgQ2xhc3MgdHlwZTsK\nICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBGaWVsZCBmaWVsZDsKICAg\nICAgICBNZXRob2Qgc2V0dGVyOwogICAgICAgIGJvb2xlYW4gcmVmbGVjdDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpKQog\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChpZCk7CgogICAgICAgICAgICBuYW1lID0gZm1kc1tp\nXS5nZXROYW1lKCk7CiAgICAgICAgICAgIHR5cGUgPSBmbWRzW2ldLmdldE9i\namVjdElkRmllbGRUeXBlKCk7CiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRB\nY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsK\nICAgICAgICAgICAgICAgIHNldHRlciA9IG51bGw7CiAgICAgICAgICAgICAg\nICBmaWVsZCA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUs\nIHRydWUpOwogICAgICAgICAgICAgICAgcmVmbGVjdCA9ICFNb2RpZmllci5p\nc1B1YmxpYyhmaWVsZC5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgICAgICAg\nICBpZiAocmVmbGVjdCkgewogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xh\nc3Njb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAg\nICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10geyBD\nbGFzcy5jbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmNs\nYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZmllbGQgPSBudWxs\nOwogICAgICAgICAgICAgICAgc2V0dGVyID0gUmVmbGVjdGlvbi5maW5kU2V0\ndGVyKG9pZFR5cGUsIG5hbWUsIHR5cGUsIHRydWUpOwogICAgICAgICAgICAg\nICAgcmVmbGVjdCA9ICFNb2RpZmllci5pc1B1YmxpYyhzZXR0ZXIuZ2V0TW9k\naWZpZXJzKCkpOwogICAgICAgICAgICAgICAgaWYgKHJlZmxlY3QpIHsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFz\ncyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\nbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3ModHlwZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJl\nZmxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAiZmlu\nZFNldHRlciIsIE1ldGhvZC5jbGFzcywgbmV3IENsYXNzW10geyBDbGFzcy5j\nbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBD\nbGFzcy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpZWxkTWFuYWdl\ncikgewogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkp\nOwogICAgICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGluaGVy\naXRlZCk7CiAgICAgICAgICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kCiAgICAg\nICAgICAgICAgICAgICAgKGdldEZpZWxkU3VwcGxpZXJNZXRob2QodHlwZSkp\nOwoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB0eXBlIG9mIHRoaXMgZmll\nbGQgbWV0YSBkYXRhIGlzCiAgICAgICAgICAgICAgICAvLyBub24tcHJpbWl0\naXZlIGFuZCBub24tc3RyaW5nLCBiZSBzdXJlIHRvIGNhc3QKICAgICAgICAg\nICAgICAgIC8vIHRvIHRoZSBhcHByb3ByaWF0ZSB0eXBlLgogICAgICAgICAg\nICAgICAgaWYgKCFyZWZsZWN0ICYmICF0eXBlLmlzUHJpbWl0aXZlKCkKICAg\nICAgICAgICAgICAgICAgICAmJiAhdHlwZS5nZXROYW1lKCkuZXF1YWxzKFN0\ncmluZy5jbGFzcy5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBmbWRzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBnZXQg\naWQvcGsgZnJvbSBwYyBpbnN0YW5jZQogICAgICAgICAgICAgICAgaWYgKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykK\nICAgICAgICAgICAgICAgICAgICBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKHJlZmxlY3QgJiYgZmllbGQgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVj\ndGlvbi5jbGFzcywgInNldCIsIAogICAgICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBGaWVsZC5jbGFz\ncywKICAgICAgICAgICAgICAgICAgICAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/\nIHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAocmVmbGVjdCkgeyAKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJzZXQiLCAKICAg\nICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IE9i\namVjdC5jbGFzcywgTWV0aG9kLmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVjdC5jbGFzcyB9\nKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGZpZWxkKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKHNldHRlcik7CiAgICAgICAgfQogICAgICAg\nIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCBjb2RlIHRvIGV4dHJhY3QgdGhlIGlk\nIG9mIHRoZSBnaXZlbiBwcmltYXJ5IGtleSByZWxhdGlvbiBmaWVsZCBmb3IK\nICAgICAqIHNldHRpbmcgaW50byBhbiBvYmplY3RpZCBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEV4dHJhY3RPYmplY3RJZEZpZWxk\nVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBwaykgewogICAg\nICAgIC8vIGlmICh2YWwgIT0gbnVsbCkgCiAgICAgICAgLy8gIHZhbCA9ICgo\nUGVyc2lzdGVuY2VDYXBhYmxlKSB2YWwpLnBjRmV0Y2hPYmplY3RJZCgpOwog\nICAgICAgIGludCBwYyA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChwYyk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKHBjKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gaWZudWxsMSA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKHBjKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzKTsgCiAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoUGVyc2lzdGVuY2VDYXBh\nYmxlLmNsYXNzLAogICAgICAgICAgICBQUkUgKyAiRmV0Y2hPYmplY3RJZCIs\nIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IG9pZCA9IGNvZGUu\nZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZm51bGwyID0gY29kZS5p\nZm51bGwoKTsgCgogICAgICAgIC8vIGZvciBkYXRhc3RvcmUgLyBzaW5nbGUt\nZmllbGQgaWRlbnRpdHk6CiAgICAgICAgLy8gaWYgKHZhbCAhPSBudWxsKQog\nICAgICAgIC8vICAgdmFsID0gKChPcGVuSlBBSWQpIHZhbCkuZ2V0SWQoKTsK\nICAgICAgICBDbGFzc01ldGFEYXRhIHBrbWV0YSA9IHBrLmdldERlY2xhcmVk\nVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaW50IHBrY29kZSA9IHBrLmdldE9i\namVjdElkRmllbGRUeXBlQ29kZSgpOwogICAgICAgIENsYXNzIHBrdHlwZSA9\nIHBrLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAgICAgICAgaWYgKHBrbWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFT\nVE9SRSAKICAgICAgICAgICAgJiYgcGtjb2RlID09IEphdmFUeXBlcy5MT05H\nKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoSWQuY2xhc3Mp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nSWQuY2xhc3MsICJnZXRJZCIsIAogICAgICAgICAgICAgICAgbG9uZy5jbGFz\ncywgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmIChwa21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpIHsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAg\nfSBlbHNlIGlmIChwa21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAg\nICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZShCeXRlLmNsYXNzKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShC\neXRlSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChCeXRlSWQuY2xhc3MsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGJ5dGUuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkJZVEVf\nT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoQnl0ZS5jbGFzcywgIjxpbml0PiIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nYnl0ZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShDaGFyYWN0ZXIuY2xh\nc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAg\nICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKENoYXJJZC5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKENoYXJJ\nZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2hh\nci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29k\nZSA9PSBKYXZhVHlwZXMuQ0hBUl9PQkopCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChDaGFyYWN0ZXIu\nY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIjxpbml0PiIs\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtjaGFyLmNsYXNzfSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoRG91YmxlLmNsYXNzKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKERvdWJsZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRG91YmxlSWQuY2xhc3MsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvdWJsZS5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlw\nZXMuRE9VQkxFX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKERvdWJsZS5jbGFzcywgIjxpbml0\nPiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW117ZG91YmxlLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9B\nVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZShGbG9hdC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEZsb2F0SWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChGbG9hdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAg\nICAgICAgICAgICBmbG9hdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuRkxPQVRfT0JKKQogICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoRmxvYXQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2Zsb2F0LmNs\nYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUoSW50ZWdlci5jbGFzcyk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAg\nICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShJbnRJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEludElkLmNsYXNzLCAiZ2V0\nSWQiLAogICAgICAgICAgICAgICAgICAgICAgICBpbnQuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVz\nLklOVF9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChJbnRlZ2VyLmNsYXNzLCAiPGluaXQ+IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHtpbnQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoTG9uZy5j\nbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUoTG9uZ0lkLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoTG9u\nZ0lkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBs\nb25nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtj\nb2RlID09IEphdmFUeXBlcy5MT05HX09CSikKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKExvbmcuY2xh\nc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW10ge2xvbmcuY2xhc3N9KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXco\nKS5zZXRUeXBlKFNob3J0LmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU2hvcnRJ\nZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFNob3J0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIHNob3J0LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5TSE9SVF9P\nQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChTaG9ydC5jbGFzcywgIjxpbml0PiIsIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117\nc2hvcnQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKERhdGVJZC5j\nbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKERhdGVJZC5jbGFzcywgImdldElkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgRGF0ZS5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TVFJJTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKFN0cmluZ0lkLmNsYXNzKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoU3RyaW5nSWQu\nY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmlu\nZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShC\naWdEZWNpbWFsSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaWdEZWNpbWFsSWQuY2xhc3Ms\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJpZ0RlY2ltYWxJ\nZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShC\naWdJbnRlZ2VySWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaWdJbnRlZ2VySWQuY2xhc3Ms\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJpZ0ludGVnZXJJ\nZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBlbHNlIGlmIChwa21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgIT0g\nbnVsbCkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHBrdHlw\nZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBnbzIgPSBj\nb2RlLmdvMigpOwoKICAgICAgICAvLyBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgLy8gICB2YWwgPSA8ZGVmYXVsdD47CiAgICAgICAgSW5zdHJ1Y3Rpb24g\nZGVmOwogICAgICAgIHN3aXRjaCAocGtjb2RlKSB7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBkZWYgPSBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAg\nICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nKGJ5dGUpIDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBkZWYgPSBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKGNoYXIpIDApOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSgwRCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBkZWYgPSBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEYpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5MT05HOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAg\nIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoc2hvcnQpIDApOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgp\nOwogICAgICAgIH0KICAgICAgICBpZm51bGwxLnNldFRhcmdldChkZWYpOwog\nICAgICAgIGlmbnVsbDIuc2V0VGFyZ2V0KGRlZik7CiAgICAgICAgZ28yLnNl\ndFRhcmdldChjb2RlLm5vcCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZDwvY29k\nZT4gbWV0aG9kcwogICAgICogdG8gY2xhc3NlcyB1c2luZyBhcHBsaWNhdGlv\nbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENvcHlL\nZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoYm9vbGVhbiBmaWVsZE1hbmFn\nZXIpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJvbU9iamVj\ndElkIChPYmplY3RJZEZpZWxkQ29uc3VtZXIgZmMsCiAgICAgICAgLy8JT2Jq\nZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFuYWdl\ncikgCiAgICAgICAgICAgID8gIG5ldyBTdHJpbmdbXXsgT0lERkNUWVBFLmdl\ndE5hbWUoKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9CiAgICAgICAgICAg\nIDogbmV3IFN0cmluZ1tdeyBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpIH07CiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICB2\nb2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGNhbGwgc3Vw\nZXJjbGFzcyBtZXRob2QKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGkpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0\nVHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCkpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIFBSRSArICJD\nb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwgdm9pZC5jbGFzcy5nZXROYW1l\nKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxkTWFuYWdl\ncikKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwoKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYg\nX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAgICAgICAv\nLyBvaWQgPSAoKE9iamVjdElkKSBpZCkuZ2V0SWQgKCk7CiAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmpl\nY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgIE9iamVjdC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICAvLyA8b2lkIHR5cGU+\nIGNhc3QgPSAoPG9pZCB0eXBlPikgb2lkOwogICAgICAgIGludCBpZCA9IGNv\nZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlw\nZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmFzdG9y\nZSgpLnNldExvY2FsKGlkKTsKCiAgICAgICAgLy8gZnMuc3RvcmU8dHlwZT5G\naWVsZCAoPGluZGV4PiwgaWQuPGZpZWxkPik7IG9yLi4uCiAgICAgICAgLy8g\ndGhpcy48ZmllbGQ+ID0gaWQuPGZpZWxkPgogICAgICAgIC8vIG9yIGZvciBz\naW5nbGUgZmllbGQgaWRlbnRpdHk6IGlkLmdldElkICgpCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21l\ndGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIENsYXNz\nIHR5cGU7CiAgICAgICAgQ2xhc3MgdW53cmFwcGVkOwogICAgICAgIEZpZWxk\nIGZpZWxkOwogICAgICAgIE1ldGhvZCBnZXR0ZXI7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFt\nZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZp\nZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoIWZpZWxkTWFuYWdlciAKICAg\nICAgICAgICAgICAgICYmIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAgLy8gc20uZ2V0\nUENQcmltYXJ5S2V5KG9pZCwgaSArIHBjSW5oZXJpdGVkRmllbGRDb3VudCk7\nIAogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBsZWF2ZSBv\ncmlnIG9uIHN0YWNrIHRvIHNldCB2YWx1ZSBpbnRvCiAgICAgICAgICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwogICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBp\nbnQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChT\ndGF0ZU1hbmFnZXIuY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICJnZXRQ\nQ1ByaW1hcnlLZXkiLCBPYmplY3QuY2xhc3MsIAogICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nIAogICAgICAgICAgICAgICAgdW53cmFwcGVkID0gKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgCiAgICAgICAgICAg\nICAgICAgICAgPyB0eXBlIDogdW53cmFwU2luZ2xlRmllbGRJZGVudGl0eShm\nbWRzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKGkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwoKICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlwZSkgewog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUodHlwZSk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChp\nZCk7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChvaWRUeXBlID09IE9i\namVjdElkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxs\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFnZXIg\nJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlm\nIChvaWRUeXBlID09IERhdGVJZC5jbGFzcykgewogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlw\nZSwgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGUu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZp\nZWxkTWFuYWdlciAmJiB0eXBlICE9IERhdGUuY2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdW53cmFwcGVkLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcHBlZCAhPSB0eXBlKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyB1bndyYXBw\nZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5BQ0NFU1NfRklFTEQpewogICAgICAgICAgICAgICAgICAgIGZpZWxk\nID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgbmFtZSwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzUHVibGljKGZp\nZWxkLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVm\nbGVjdGlvbi5nZXRYWFgob2lkLCBSZWZsZWN0aW9uLmZpbmRGaWVsZCguLi4p\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50\nKCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3Ms\nIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIChnZXRSZWZsZWN0aW9uR2V0dGVy\nTWV0aG9kKHR5cGUsIEZpZWxkLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gT2Jq\nZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgZ2V0dGVyID0gUmVmbGVjdGlvbi5maW5kR2V0dGVyKG9pZFR5cGUsIG5h\nbWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5p\nc1B1YmxpYyhnZXR0ZXIuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0\ndGVyKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5nZXRYWFgob2lkLCBSZWZsZWN0\naW9uLmZpbmRHZXR0ZXIoLi4uKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmaW5kR2V0dGVyIiwgTWV0\naG9kLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNs\nYXNzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgTWV0aG9kLmNsYXNz\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHlwZS5pc1ByaW1p\ndGl2ZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9k\nKGdldEZpZWxkQ29uc3VtZXJNZXRob2QodHlwZSkpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIGZtZHNbaV0pOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gaWYgdGhlIGNsYXNzIHVzZXMgdGhlIENsYXNzL1N0cmlu\nZyBjb25zdHJ1Y3RvcgogICAgICogaW5zdGVhZCBvZiBqdXN0IFN0cmluZy4K\nICAgICAqLwogICAgcHJpdmF0ZSBCb29sZWFuIHVzZXNDbGFzc1N0cmluZ0lk\nQ29uc3RydWN0b3IoKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5\nVHlwZSgpICE9IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAg\nICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICBpZiAoX21l\ndGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICBpZiAoX21l\ndGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2JqZWN0SWQuY2xhc3MpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIEJv\nb2xlYW4uVFJVRTsKICAgICAgICB9CgogICAgICAgIENsYXNzIG9pZFR5cGUg\nPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBvaWRUeXBlLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBD\nbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAgICByZXR1\ncm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0\nKSB7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9pZFR5\ncGUuZ2V0Q29uc3RydWN0b3IobmV3IENsYXNzW117IFN0cmluZy5jbGFzcyB9\nKTsKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgZ2l2ZW4g\nZmllbGQgaXMgYSB3cmFwcGVyLXR5cGUgc2luZ2xlIGZpZWxkIGlkZW50aXR5\nIHByaW1hcnkga2V5LAogICAgICogcmV0dXJuIGl0cyBjb3JyZXNwb25kaW5n\nIHByaW1pdGl2ZSBjbGFzcy4gRWxzZSByZXR1cm4gdGhlIGZpZWxkIHR5cGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgdW53cmFwU2luZ2xlRmllbGRJ\nZGVudGl0eShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmICghZm1k\nLmdldERlZmluaW5nTWV0YURhdGEoKS5pc09wZW5KUEFJZGVudGl0eSgpKQog\nICAgICAgICAgICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwoKICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAg\nICAgICByZXR1cm4gYnl0ZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gY2hhci5j\nbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoK\nICAgICAgICAgICAgICAgIHJldHVybiBkb3VibGUuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBmbG9hdC5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBpbnQuY2xhc3M7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAg\nICAgICAgICAgIHJldHVybiBzaG9ydC5jbGFzczsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICByZXR1cm4g\nbG9uZy5jbGFzczsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHJldHVybiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIgZ2V0dGVy\nIG1ldGhvZCBvZiB0aGUge0BsaW5rIFJlZmxlY3Rpb259IGhlbHBlciBmb3IK\nICAgICAqIGEgZmllbGQgb3IgZ2V0dGVyIG1ldGhvZCBvZiB0aGUgZ2l2ZW4g\ndHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0UmVmbGVjdGlv\nbkdldHRlck1ldGhvZChDbGFzcyB0eXBlLCBDbGFzcyBhcmdUeXBlKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0\ncmluZyBuYW1lID0gImdldCI7CiAgICAgICAgaWYgKHR5cGUuaXNQcmltaXRp\ndmUoKSkKICAgICAgICAgICAgbmFtZSArPSBTdHJpbmdVdGlscy5jYXBpdGFs\naXplKHR5cGUuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4gUmVmbGVjdGlv\nbi5jbGFzcy5nZXRNZXRob2QobmFtZSwgbmV3IENsYXNzW10geyBPYmplY3Qu\nY2xhc3MsIAogICAgICAgICAgICBhcmdUeXBlIH0pOyAKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGZldGNoIG1ldGhvZCBvZiB0\naGUgT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZvcgogICAgICogYSBmaWVsZCBv\nZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2Qg\nZ2V0RmllbGRTdXBwbGllck1ldGhvZChDbGFzcyB0eXBlKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIHJldHVybiBn\nZXRNZXRob2QoT0lERlNUWVBFLCB0eXBlLCAiZmV0Y2giLCB0cnVlLCBmYWxz\nZSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBw\ncm9wZXIgZmV0Y2ggbWV0aG9kIG9mIHRoZSBPYmplY3RJZEZpZWxkQ29uc3Vt\nZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9mIHRoZSBnaXZlbiB0eXBlLgogICAg\nICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRGaWVsZENvbnN1bWVyTWV0aG9k\nKENsYXNzIHR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChPSURGQ1RZUEUsIHR5\ncGUsICJzdG9yZSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyB0aGUgcGNOZXdPYmplY3RJZEluc3RhbmNlIG1l\ndGhvZCB0byBjbGFzc2VzIHVzaW5nCiAgICAgKiBhcHBsaWNhdGlvbiBpZGVu\ndGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld09iamVjdElk\nSW5zdGFuY2VNZXRob2QoYm9vbGVhbiBvYmopCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIE9iamVj\ndCBwY05ld09iamVjdElkSW5zdGFuY2UgKCkKICAgICAgICBDbGFzc1tdIGFy\nZ3MgPSAob2JqKSA/IG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSA6IG51\nbGw7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBCb29sZWFuIHVzZXNDbHNTdHJp\nbmcgPSB1c2VzQ2xhc3NTdHJpbmdJZENvbnN0cnVjdG9yKCk7CiAgICAgICAg\nQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAg\nICAgIGlmIChvYmogJiYgdXNlc0Nsc1N0cmluZyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24g\nKC4uLik7CiAgICAgICAgICAgIFN0cmluZyBtc2cgPSBfbG9jLmdldCgic3Ry\nLWNvbnMiLCBvaWRUeXBlLAogICAgICAgICAgICAgICAgX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKG1zZyk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MsCiAgICAgICAgICAgICAgICAiPGluaXQ+Iiwgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAg\nY29kZS5hdGhyb3coKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7Cgog\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghX21ldGEuaXNPcGVuSlBB\nSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgpKSB7\nCiAgICAgICAgICAgIC8vIG5ldyBPYmplY3RJZCAoY2xzLCBvaWQpCiAgICAg\nICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwog\nICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNsYXNz\nY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9tZXRhKSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBuZXcgPG9pZCBjbGFzcz4gKCk7CiAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpIHx8IChv\nYmogJiYgdXNlc0Nsc1N0cmluZyA9PSBCb29sZWFuLlRSVUUpKQogICAgICAg\nICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9t\nZXRhKSk7CiAgICAgICAgaWYgKG9iaikgewogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAgICAgICAgICBpZiAodXNl\nc0Nsc1N0cmluZyA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICBh\ncmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3Mg\nfTsKICAgICAgICAgICAgZWxzZSBpZiAodXNlc0Nsc1N0cmluZyA9PSBCb29s\nZWFuLkZBTFNFKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1td\neyBTdHJpbmcuY2xhc3MgfTsKICAgICAgICB9IGVsc2UgaWYgKF9tZXRhLmlz\nT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgLy8gbmV3IDx0eXBl\nPklkZW50aXR5IChYWFguY2xhc3MsIDxwaz4pOwogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YSBwayA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVsw\nXTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBw\nayk7CiAgICAgICAgICAgIGlmIChway5nZXREZWNsYXJlZFR5cGVDb2RlKCkg\nPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgYWRkRXh0cmFjdE9i\namVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwgcGspOwogICAgICAgICAgICBp\nZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2JqZWN0SWQuY2xhc3Mp\nCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNs\nYXNzLCBPYmplY3QuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZSBpZiAoX21l\ndGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gRGF0ZS5jbGFzcykKICAgICAgICAg\nICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIERhdGUu\nY2xhc3MgfTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYXJn\ncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgcGsuZ2V0T2JqZWN0SWRG\naWVsZFR5cGUoKSB9OwogICAgICAgIH0KCiAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICI8aW5pdD4iLCB2b2lkLmNs\nYXNzLCBhcmdzKTsKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50\naXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKE9iamVjdElk\nLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgT2JqZWN0LmNsYXNzIH0pOwog\nICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZW4gY29tbXVuaWNhdGluZyB3\naXRoIHRoZSBTdGF0ZU1hbmFnZXIsIG1hbnkgbWV0aG9kcyBhcmUgdXNlZAog\nICAgICogZGVwZW5kaW5nIG9uIHRoZSBjbGFzcyBvZiBzdGF0ZSBiZWluZyBw\nYXNzZWQuIFRoaXMgbWV0aG9kLAogICAgICogZ2l2ZW4gdGhlIHR5cGUgb2Yg\naW5mb3JtYXRpb24gYmVpbmcgcGFzc2VkIGFuZCB0aGUgcHJlZml4CiAgICAg\nKiAoJ3Byb3ZpZGVkJywgJ3JlcGxhY2UnLCBldGMpIG9mIHRoZSBtZXRob2Qg\ndG8KICAgICAqIGNhbGwsIHJldHVybnMgdGhlIFN0YXRlTWFuYWdlciBtZXRo\nb2QgdGhhdCBzaG91bGQgYmUgdXNlZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\ndHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAgICAqIEBw\nYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRvIGNhbGw7\nIGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBlXUZpZWxk\nJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFtIGdldCB0\ncnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQogICAgICog\nU3RhdGVNYW5hZ2VyLCBmYWxzZSBpZiBwYXNzaW5nIGl0IHRvIHRoZSBTTQog\nICAgICogQHBhcmFtIGN1clZhbHVlIHRydWUgaWYgdGhlIGN1cnJlbnQgc3Rh\ndGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAgICAgKiB0aGUgU3RhdGVNYW5hZ2Vy\nIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8KICAgIHByaXZhdGUgTWV0\naG9kIGdldFN0YXRlTWFuYWdlck1ldGhvZChDbGFzcyB0eXBlLCBTdHJpbmcg\ncHJlZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBib29sZWFuIGN1clZhbHVl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBnZXRNZXRob2QoU01UWVBFLCB0eXBlLCBwcmVmaXgsIGdl\ndCwgdHJ1ZSwgY3VyVmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBtZXRob2Qgb2YgdGhlIGdpdmVuIG93bmVyIHR5cGUgbWF0Y2hp\nbmcgdGhlIGdpdmVuIGNyaXRlcmlhLgogICAgICoKICAgICAqIEBwYXJhbSB0\neXBlIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAogICAgICogQHBh\ncmFtIHByZWZpeCB0aGUgcHJlZml4IG9mIHRoZSBtZXRob2QgdG8gY2FsbDsg\nYWxsIG1ldGhvZHMKICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5cGVdRmllbGQn\nOyBvbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAgICAgKiBAcGFyYW0gZ2V0IHRy\ndWUgaWYgcmVjZWl2aW5nIGluZm9ybWF0aW9uIGZyb20gdGhlCiAgICAgKiBv\nd25lciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0aGUgb3duZXIKICAgICAq\nIEBwYXJhbSBoYXNwYyB0cnVlIGlmIHRoZSBwYyBpcyBwYXNzZWQgYXMgYW4g\nZXh0cmEgYXJndW1lbnQKICAgICAqIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlm\nIHRoZSBjdXJyZW50IHN0YXRlIHZhbHVlIGlzIHBhc3NlZCB0bwogICAgICog\ndGhlIG93bmVyIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8KICAgIHBy\naXZhdGUgTWV0aG9kIGdldE1ldGhvZChDbGFzcyBvd25lciwgQ2xhc3MgdHlw\nZSwgU3RyaW5nIHByZWZpeCwKICAgICAgICBib29sZWFuIGdldCwgYm9vbGVh\nbiBoYXNwYywgYm9vbGVhbiBjdXJWYWx1ZSkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBhbGwgbWV0aG9kcyBl\nbmQgaW4gW2ZpZWxkIHR5cGVdRmllbGQsIHdoZXJlIHRoZSBmaWVsZCB0eXBl\nCiAgICAgICAgLy8gY2FuIGJlIGFueSBvZiB0aGUgcHJpbWl0dmUgdHlwZXMg\nKGJ1dCBjYXBpdGFsaXplZCksICdTdHJpbmcnLAogICAgICAgIC8vIG9yICdP\nYmplY3QnOyBmaWd1cmUgb3V0IHdoYXQgdHlwZSB0byB1c2UKICAgICAgICBT\ndHJpbmcgdHlwZU5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICBpZiAo\ndHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICB0eXBlTmFtZSA9IHR5\ncGVOYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpCiAgICAgICAg\nICAgICAgICArIHR5cGVOYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBlbHNl\nIGlmICh0eXBlLmVxdWFscyhTdHJpbmcuY2xhc3MpKQogICAgICAgICAgICB0\neXBlTmFtZSA9ICJTdHJpbmciOwogICAgICAgIGVsc2UgewogICAgICAgICAg\nICB0eXBlTmFtZSA9ICJPYmplY3QiOwogICAgICAgICAgICB0eXBlID0gT2Jq\nZWN0LmNsYXNzOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhlIGZpZWxkIGlu\nZGV4IGlzIGFsd2F5cyBwYXNzZWQgYXMgYW4gYXJnOyB0aGUgcGMgaW5zdGFu\nY2UgYW5kCiAgICAgICAgLy8gdGhlIGN1cnJlbnQgdmFsdWUgbWF5IGJlIHBh\nc3NlZDsgaWYgc2V0dGluZyB0aGUgbmV3IHZhbHVlIGlzCiAgICAgICAgLy8g\nYWxzbyBwYXNzZWQKICAgICAgICBMaXN0IHBsaXN0ID0gbmV3IEFycmF5TGlz\ndCg0KTsKICAgICAgICBpZiAoaGFzcGMpCiAgICAgICAgICAgIHBsaXN0LmFk\nZChQQ1RZUEUpOwogICAgICAgIHBsaXN0LmFkZChpbnQuY2xhc3MpOwogICAg\nICAgIGlmICghZ2V0IHx8IGN1clZhbHVlKQogICAgICAgICAgICBwbGlzdC5h\nZGQodHlwZSk7CiAgICAgICAgaWYgKCFnZXQgJiYgY3VyVmFsdWUpIHsKICAg\nICAgICAgICAgcGxpc3QuYWRkKHR5cGUpOwogICAgICAgICAgICBwbGlzdC5h\nZGQoaW50LmNsYXNzKTsKICAgICAgICB9CgogICAgICAgIC8vIHVzZSByZWZs\nZWN0aW9uIHRvIHJldHVybiB0aGUgcmlnaHQgbWV0aG9kCiAgICAgICAgU3Ry\naW5nIG5hbWUgPSBwcmVmaXggKyB0eXBlTmFtZSArICJGaWVsZCI7CiAgICAg\nICAgQ2xhc3NbXSBwYXJhbXMgPSAoQ2xhc3NbXSkgcGxpc3QudG9BcnJheShu\nZXcgQ2xhc3NbcGxpc3Quc2l6ZSgpXSk7CiAgICAgICAgCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxw\nZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24ob3duZXIsIG5hbWUsIHBhcmFt\ncykpOwogICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24gcGFlKSB7CiAgICAgICAgICAgICB0aHJvdyAoTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uKSBwYWUuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQgdGhlIGNvZGUg\nbmVjZXNzYXJ5IHRvIHRocm93IHRoZSBnaXZlbgogICAgICogZXhjZXB0aW9u\nIHR5cGUsIHNhbnMgbWVzc2FnZS4KICAgICAqLwogICAgcHJpdmF0ZSBJbnN0\ncnVjdGlvbiB0aHJvd0V4Y2VwdGlvbihDb2RlIGNvZGUsIENsYXNzIHR5cGUp\nIHsKICAgICAgICBJbnN0cnVjdGlvbiBpbnMgPSBjb2RlLmFuZXcoKS5zZXRU\neXBlKHR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLCBudWxsKTsKICAgICAgICBjb2RlLmF0aHJvdygpOwogICAgICAg\nIHJldHVybiBpbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgaW50ZXJmYWNlIHRvIHRoZSBjbGFzcyBiZWlu\nZwogICAgICogZW5oYW5jZWQsIGFuZCBhZGRzIGEgZGVmYXVsdCBjb25zdHJ1\nY3RvciBmb3IgdXNlIGJ5IE9wZW5KUEEKICAgICAqIGlmIGl0IGlzIG5vdCBh\nbHJlYWR5IHByZXNlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBlbmhh\nbmNlQ2xhc3MoKSB7CiAgICAgICAgLy8gbWFrZSB0aGUgY2xhc3MgaW1wbGVt\nZW50IFBlcnNpc3RlbmNlQ2FwYWJsZQogICAgICAgIF9wYy5kZWNsYXJlSW50\nZXJmYWNlKFBDVFlQRSk7CgogICAgICAgIC8vIGFkZCBhIHZlcnNpb24gc3Rh\nbXAKICAgICAgICBhZGRHZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1l\ndGhvZCgpOwoKICAgICAgICAvLyBmaW5kIHRoZSBkZWZhdWx0IGNvbnN0cnVj\ndG9yCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmdldERlY2xhcmVk\nTWV0aG9kKCI8aW5pdD4iLCAoU3RyaW5nW10pIG51bGwpOwoKICAgICAgICAv\nLyBhIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcmVxdWlyZWQKICAgICAgICBp\nZiAobWV0aG9kID09IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIG5hbWUg\nPSBfcGMuZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAoIV9kZWZDb25zKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoImVuaGFuY2UtZGVmYXVsdGNvbnN0IiwgbmFtZSkpOwoKICAgICAgICAg\nICAgbWV0aG9kID0gX3BjLmFkZERlZmF1bHRDb25zdHJ1Y3RvcigpOwogICAg\nICAgICAgICBTdHJpbmcgYWNjZXNzOwogICAgICAgICAgICBpZiAoX21ldGEu\naXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgICAgIC8vIGV4dGVybmFs\naXphYmxlIHJlcXVpcmVzIHRoYXQgdGhlIGNvbnN0cnVjdG9yCiAgICAgICAg\nICAgICAgICAvLyBiZSBwdWJsaWMsIHNvIG1ha2UgdGhlIGFkZGVkIGNvbnN0\ncnVjdG9yIHB1YmxpYwogICAgICAgICAgICAgICAgbWV0aG9kLm1ha2VQdWJs\naWMoKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJwdWJsaWMiOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKF9wYy5pc0ZpbmFsKCkpIHsKICAgICAgICAg\nICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAg\nYWNjZXNzID0gInByaXZhdGUiOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICAg\nICAgICAgIGFjY2VzcyA9ICJwcm90ZWN0ZWQiOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmICghKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKS5pc0lu\ndGVyZmFjZSgpIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAg\nICAgICAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS1hZGRkZWZhdWx0Y29uc3Qi\nLCBuYW1lLCBhY2Nlc3MpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIHRoZSBmb2xsb3dpbmcgZmllbGRzIHRvIHRoZSBQZXJzaXN0\nZW5jZUNhcGFibGUgaW5zdGFuY2U6CiAgICAgKiA8dWw+CiAgICAgKiA8bGk+\nPGNvZGU+cHJpdmF0ZSBzdGF0aWMgaW50IHBjSW5oZXJpdGVkRmllbGRDb3Vu\ndDwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGlj\nIENsYXNzIHBjUENTdXBlcmNsYXNzPC9jb2RlPgogICAgICogPC9saT4KICAg\nICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBTdHJpbmdbXSBwY0ZpZWxk\nTmFtZXM8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0\nYXRpYyBDbGFzc1tdIHBjRmllbGRUeXBlczwvY29kZT48L2xpPgogICAgICog\nPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIGJ5dGVbXSBwY0ZpZWxkRmxhZ3M8\nL2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5wcm90ZWN0ZWQgdHJhbnNp\nZW50IFN0YXRlTWFuYWdlciBwY1N0YXRlTWFuYWdlcjwvY29kZT4KICAgICAq\nIGlmIG5vIFBlcnNpc3RlbmNlQ2FwYWJsZSBzdXBlcmNsYXNzIHByZXNlbnQp\nPC9saT4KICAgICAqIDwvdWw+CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRGaWVsZHMoKSB7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChJTkhFUklU\nLCBpbnQuY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBfcGMuZGVj\nbGFyZUZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3Mp\nLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFBS\nRSArICJGaWVsZFR5cGVzIiwgQ2xhc3NbXS5jbGFzcykuc2V0U3RhdGljKHRy\ndWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkRmxh\nZ3MiLCBieXRlW10uY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBf\ncGMuZGVjbGFyZUZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcykuc2V0U3RhdGlj\nKHRydWUpOwoKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkg\nPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIEJDRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICBmaWVsZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAg\nICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNb2RpZmllcyB0aGUgY2xhc3MgaW5pdGlhbGl6\nYXRpb24gbWV0aG9kIChjcmVhdGluZyBvbmUgaWYgbmVjZXNzYXJ5KQogICAg\nICogdG8gaW5pdGlhbGl6ZSB0aGUgc3RhdGljIGZpZWxkcyBvZiB0aGUgUGVy\nc2lzdGVuY2VDYXBhYmxlIGluc3RhbmNlIGFuZAogICAgICogdG8gcmVnaXN0\nZXIgaXQgd2l0aCB0aGUgaW1wbCBoZWxwZXIuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRTdGF0aWNJbml0aWFsaXplcigpIHsKICAgICAgICBDb2Rl\nIGNvZGUgPSBnZXRPckNyZWF0ZUNsYXNzSW5pdENvZGUodHJ1ZSk7CiAgICAg\nICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICAg\nICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50\nLmNsYXNzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIC8vIHBjSW5oZXJpdGVkRmllbGRDb3VudCA9IDxzdXBlckNsYXNzPi5wY0dl\ndE1hbmFnZWRGaWVsZENvdW50KCkKICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3RhdGljKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmll\nbGRDb3VudCIsIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAg\nICAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBp\nbnQuY2xhc3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBwY1BD\nU3VwZXJjbGFzcyA9IDxzdXBlckNsYXNzPjsKICAgICAgICAgICAgY29kZS5j\nbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YS4KICAgICAg\nICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpKTsKICAgICAg\nICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3Mu\nY2xhc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gcGNGaWVsZE5hbWVzID0g\nbmV3IFN0cmluZ1tdIHsgIjxuYW1lMT4iLCAiPG5hbWUyPiIsIC4uLiB9Owog\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlw\nZShTdHJpbmcuY2xhc3MpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlLmR1cCgpOwog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzW2ldLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVs\nZE5hbWVzIiwgU3RyaW5nW10uY2xhc3MpOwoKICAgICAgICAvLyBwY0ZpZWxk\nVHlwZXMgPSBuZXcgQ2xhc3NbXSB7IDx0eXBlMT4uY2xhc3MsIDx0eXBlMj4u\nY2xhc3MsIC4uLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShmbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5hbmV3YXJyYXkoKS5zZXRU\neXBlKENsYXNzLmNsYXNzKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAg\nICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgY29kZS5hYXN0b3Jl\nKCk7CiAgICAgICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0Rmll\nbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKCiAgICAg\nICAgLy8gcGNGaWVsZEZsYWdzID0gbmV3IGJ5dGVbXSB7IDxmbGFnMT4sIDxm\nbGFnMj4sIC4uLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShmbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5uZXdhcnJheSgpLnNldFR5\ncGUoYnl0ZS5jbGFzcyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGdldEZpZWxkRmxhZyhm\nbWRzW2ldKSk7CiAgICAgICAgICAgIGNvZGUuYmFzdG9yZSgpOwogICAgICAg\nIH0KICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJG\naWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKCiAgICAgICAgLy8gUENSZWdp\nc3RyeS5yZWdpc3RlciAoY2xzLAogICAgICAgIC8vCXBjRmllbGROYW1lcywg\ncGNGaWVsZFR5cGVzLCBwY0ZpZWxkRmxhZ3MsCiAgICAgICAgLy8gIHBjUENT\ndXBlcmNsYXNzLCBhbGlhcywgbmV3IFhYWCAoKSk7CiAgICAgICAgY29kZS5j\nbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoX21hbmFnZWRUeXBlKTsKICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVz\nIiwgU3RyaW5nW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCku\nc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsK\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVs\nZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAgICAgICAgCiAg\nICAgICAgaWYgKF9tZXRhLmlzTWFwcGVkKCkpCiAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZShfbWV0YS5nZXRUeXBlQWxpYXMoKSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVs\nbCgpOwoKICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfcGMpOwogICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwog\nICAgICAgIH0KCiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoSEVMUEVSVFlQRSwgInJlZ2lzdGVyIiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmdbXS5jbGFz\ncywgQ2xhc3NbXS5jbGFzcywKICAgICAgICAgICAgICAgIGJ5dGVbXS5jbGFz\ncywgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgUENUWVBFIH0pOwoKICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZs\nYWcgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYnl0ZSBnZXRGaWVsZEZsYWcoRmllbGRNZXRhRGF0YSBmbWQpIHsK\nICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFE\nYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICByZXR1cm4gLTE7CgogICAg\nICAgIGJ5dGUgZmxhZ3MgPSAwOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkuaXNQcmltaXRpdmUoKQogICAgICAgICAgICB8fCBTZXJpYWxp\nemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkpKQogICAgICAgICAgICBmbGFncyA9IFBlcnNpc3RlbmNlQ2FwYWJs\nZS5TRVJJQUxJWkFCTEU7CgogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVu\ndCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX1RSQU5TQUNUSU9OQUwpCiAg\nICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19X\nUklURTsKICAgICAgICBlbHNlIGlmICghZm1kLmlzUHJpbWFyeUtleSgpICYm\nICFmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGZs\nYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURQogICAgICAg\nICAgICAgICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfUkVBRDsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5NRURJQVRFX1dSSVRFCiAgICAgICAgICAgICAgICB8IFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5NRURJQVRFX1JFQUQ7CiAgICAgICAgcmV0dXJuIGZsYWdz\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgY29kZSB0byBwcm9w\nZXJseSBoYW5kbGUgUGVyc2lzdGVuY2VDYXBhYmxlIHNlcmlhbGl6YXRpb24K\nICAgICAqIHRvIHRoZSBieXRlY29kZS4gVGhpcyBpbmNsdWRlcyBjcmVhdGlu\nZyBhbmQgaW5pdGlhbGl6aW5nIHRoZQogICAgICogc3RhdGljIDxjb2RlPnNl\ncmlhbFZlcnNpb25VSUQ8L2NvZGU+IGNvbnN0YW50IGlmIG5vdCBhbHJlYWR5\nIGRlZmluZWQsCiAgICAgKiBhcyB3ZWxsIGFzIGNyZWF0aW5nIGEgY3VzdG9t\nIDxjb2RlPndyaXRlT2JqZWN0PC9jb2RlPiBtZXRob2QgaWYgdGhlCiAgICAg\nKiBjbGFzcyBpcyBTZXJpYWxpemFibGUgYW5kIGRvZXMgbm90IGRlZmluZSB0\naGVtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2VyaWFsaXphdGlv\nbkNvZGUoKSB7CiAgICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNoZWQoKQog\nICAgICAgICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJs\nZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewog\nICAgICAgICAgICBpZiAoIUV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWdu\nYWJsZUZyb20oCiAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkpKQogICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NTZXJpYWxpemF0\naW9uQ29kZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiBub3QgYWxyZWFkeSBwcmVzZW50LCBhZGQgYSBzZXJpYWxW\nZXJzaW9uVUlEIGZpZWxkOyBpZiB0aGUgaW5zdGFuY2UKICAgICAgICAvLyBp\ncyBkZXRhY2hhYmxlIGFuZCB1c2VzIGRldGFjaGVkIHN0YXRlIHdpdGhvdXQg\nYSBkZWNsYXJlZCBmaWVsZCwKICAgICAgICAvLyBjYW4ndCBhZGQgYSBzZXJp\nYWwgdmVyc2lvbiBVSUQgYmVjYXVzZSB3ZSdsbCBiZSBhZGRpbmcgZXh0cmEg\nZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIGVuaGFuY2VkIHZlcnNpb24KICAg\nICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVkRmllbGQoInNl\ncmlhbFZlcnNpb25VSUQiKTsKICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkg\newogICAgICAgICAgICBMb25nIHVpZCA9IG51bGw7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICB1aWQgPSBOdW1iZXJzLnZhbHVlT2YoT2Jq\nZWN0U3RyZWFtQ2xhc3MubG9va3VwCiAgICAgICAgICAgICAgICAgICAgKF9t\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSkuZ2V0U2VyaWFsVmVyc2lvblVJRCgp\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgICAgIC8vIGxhc3QtY2hhbmNlIGNhdGNoIGZvciBidWcgIzI4MyAo\nd2hpY2ggY2FuIGhhcHBlbgogICAgICAgICAgICAgICAgLy8gaW4gYSB2YXJp\nZXR5IG9mIENsYXNzTG9hZGluZyBlbnZpcm9ubWVudHMpCiAgICAgICAgICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS11aWQtYWNjZXNz\nIiwgX21ldGEpLCB0KTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2UtdWlkLWFj\nY2VzcyIsIF9tZXRhKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGlmIHdlIGNvdWxkbid0IGFjY2VzcyB0aGUgc2VyaWFsVmVyc2lvblVJRCwg\nd2Ugd2lsbCBoYXZlIHRvCiAgICAgICAgICAgIC8vIHNraXAgdGhlIG92ZXJy\naWRlIG9mIHRoYXQgZmllbGQgYW5kIG5vdCBiZSBzZXJpYWxpemF0aW9uCiAg\nICAgICAgICAgIC8vIGNvbXBhdGlibGUgd2l0aCBub24tZW5oYW5jZWQgY2xh\nc3NlcwogICAgICAgICAgICBpZiAodWlkICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZCgic2VyaWFsVmVyc2lv\nblVJRCIsIGxvbmcuY2xhc3MpOwogICAgICAgICAgICAgICAgZmllbGQubWFr\nZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNldFN0YXRpYyh0\ncnVlKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNldEZpbmFsKHRydWUpOwoK\nICAgICAgICAgICAgICAgIENvZGUgY29kZSA9IGdldE9yQ3JlYXRlQ2xhc3NJ\nbml0Q29kZShmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmJlZm9yZUZp\ncnN0KCk7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUodWlkLmxvbmdWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNvZGUucHV0\nc3RhdGljKCkuc2V0RmllbGQoZmllbGQpOwoKICAgICAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gYWRkIHdyaXRlIG9iamVjdCBtZXRob2QKICAgICAg\nICBCQ01ldGhvZCB3cml0ZSA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgid3Jp\ndGVPYmplY3QiLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0\ncHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgIGJvb2xlYW4gZnVsbCA9IHdy\naXRlID09IG51bGw7CiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAgICAgICAg\nLy8gcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0IChPYmplY3RPdXRwdXRTdHJl\nYW0gb3V0KQogICAgICAgICAgICB3cml0ZSA9IF9wYy5kZWNsYXJlTWV0aG9k\nKCJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0pOwogICAg\nICAgICAgICB3cml0ZS5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2VwdGlv\nbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHdyaXRlLm1ha2VQ\ncml2YXRlKCk7CiAgICAgICAgfQogICAgICAgIG1vZGlmeVdyaXRlT2JqZWN0\nTWV0aG9kKHdyaXRlLCBmdWxsKTsKCiAgICAgICAgLy8gYW5kIHJlYWQgb2Jq\nZWN0CiAgICAgICAgQkNNZXRob2QgcmVhZCA9IF9wYy5nZXREZWNsYXJlZE1l\ndGhvZCgicmVhZE9iamVjdCIsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBP\nYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICBmdWxsID0gcmVh\nZCA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7CiAgICAgICAgICAgIC8v\nIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0IChPYmplY3RJbnB1dFN0cmVhbSBp\nbikKICAgICAgICAgICAgcmVhZCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJyZWFk\nT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICAgICAg\ncmVhZC5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbihJT0V4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0\ncnVlKS5hZGRFeGNlcHRpb24KICAgICAgICAgICAgICAgIChDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgcmVhZC5tYWtlUHJp\ndmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2RpZnlSZWFkT2JqZWN0TWV0\naG9kKHJlYWQsIGZ1bGwpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRT\ndWJjbGFzc1NlcmlhbGl6YXRpb25Db2RlKCkgewogICAgICAgIC8vIGZvciBn\nZW5lcmF0ZWQgc3ViY2xhc3Nlcywgc2VyaWFsaXphdGlvbiBtdXN0IHdyaXRl\nIGFuIGluc3RhbmNlIG9mCiAgICAgICAgLy8gdGhlIHN1cGVyY2xhc3MgaW5z\ndGVhZCBvZiB0aGUgc3ViY2xhc3MsIHNvIHRoYXQgdGhlIGNsaWVudCBWTSBj\nYW4KICAgICAgICAvLyBkZXNlcmlhbGl6ZSBzdWNjZXNzZnVsbHkuCgogICAg\nICAgIC8vIHByaXZhdGUgT2JqZWN0IHdyaXRlUmVwbGFjZSgpIHRocm93cyBP\nYmplY3RTdHJlYW1FeGNlcHRpb24KICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVSZXBsYWNlIiwgT2JqZWN0LmNs\nYXNzLCBudWxsKTsKICAgICAgICBtZXRob2QuZ2V0RXhjZXB0aW9ucyh0cnVl\nKS5hZGRFeGNlcHRpb24oT2JqZWN0U3RyZWFtRXhjZXB0aW9uLmNsYXNzKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgLy8gT2JqZWN0IG8gPSBuZXcgPG1hbmFnZWQtdHlwZT4oKQogICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX21hbmFnZWRUeXBlKTsgLy8gZm9y\nIHJldHVybgogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciBwb3N0LTxpbml0\nPiB3b3JrCiAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9yIDxpbml0PgogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5\ncGUuZ2V0VHlwZSgpLCAiPGluaXQ+IiwKICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbnVsbCk7CgogICAgICAgIC8vIGNvcHkgYWxsIHRoZSBmaWVsZHMuCiAg\nICAgICAgLy8gIyMjIyMgbGltaXRpbmcgdG8gSlBBIEBUcmFuc2llbnQgbGlt\naXRhdGlvbnMKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRh\nLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1Ry\nYW5zaWVudCgpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIC8vIG8uPGZpZWxkPiA9IHRoaXMuPGZpZWxkPiAob3IgcmVmbGVjdGl2\nZSBhbmFsb2cpCiAgICAgICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciBwdXRm\naWVsZAogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOyAvLyBm\nb3IgZ2V0ZmllbGQKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21hbmFn\nZWRUeXBlLCBmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHB1dGZp\nZWxkKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAg\nICAgICB9CgogICAgICAgIGNvZGUuYXJldHVybigpLnNldFR5cGUoT2JqZWN0\nLmNsYXNzKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBjbGFzcyBiZWluZyBlbmhhbmNlZCBz\naG91bGQgZXh0ZXJuYWxpemUgdG8gYSBkZXRhY2hlZAogICAgICogaW5zdGFu\nY2UgcmF0aGVyIHRoYW4gc2VyaWFsaXplLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gZXh0ZXJuYWxpemVEZXRhY2hlZCgpIHsKICAgICAgICByZXR1\ncm4gQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERl\ndGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAgJiYgU2VyaWFsaXphYmxlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nKQogICAgICAgICAgICAmJiAhX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5n\nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuCiAgICAgICAgICAgIGlzRGV0YWNo\nZWRTdGF0ZVRyYW5zaWVudCgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyBhIGN1c3RvbSB3cml0ZU9iamVjdCBtZXRob2QgdGhhdCBkZWxlZ2F0ZXMg\ndG8gdGhlCiAgICAgKiB7QGxpbmsgT2JqZWN0T3V0cHV0U3RyZWFtI2RlZmF1\nbHRXcml0ZU9iamVjdH0gbWV0aG9kLAogICAgICogYnV0IG9ubHkgYWZ0ZXIg\nY2FsbGluZyB0aGUgaW50ZXJuYWwgPGNvZGU+cGNTZXJpYWxpemluZzwvY29k\nZT4gbWV0aG9kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbW9kaWZ5V3Jp\ndGVPYmplY3RNZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFuIGZ1bGwp\nIHsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8vIGJvb2wg\nY2xlYXIgPSBwY1NlcmlhbGl6aW5nICgpOwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2VyaWFsaXppbmciLAogICAgICAg\nICAgICBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBpbnQgY2xlYXIg\nPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuaXN0\nb3JlKCkuc2V0TG9jYWwoY2xlYXIpOwoKICAgICAgICBpZiAoZnVsbCkgewog\nICAgICAgICAgICAvLyBvdXQuZGVmYXVsdFdyaXRlT2JqZWN0ICgpOwogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RPdXRwdXRT\ndHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAiZGVmYXVsdFdyaXRlT2Jq\nZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIH0KCiAgICAgICAgSW5zdHJ1Y3Rpb24gdG1wbGF0\nZSA9ICgoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLnZy\nZXR1cm4oKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gdG9yZXQ7CiAgICAg\nICAgSW5zdHJ1Y3Rpb24gcmV0OwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3Qo\nKTsKICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRtcGxhdGUp\nKSB7CiAgICAgICAgICAgIHJldCA9IGNvZGUucHJldmlvdXMoKTsKICAgICAg\nICAgICAgLy8gaWYgKGNsZWFyKSBwY1NldERldGFjaGVkU3RhdGUgKG51bGwp\nOwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoY2xlYXIpOwog\nICAgICAgICAgICB0b3JldCA9IGNvZGUuaWZlcSgpOwogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0\nYXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIHRvcmV0LnNldFRhcmdl\ndChyZXQpOwogICAgICAgICAgICBjb2RlLm5leHQoKTsgLy8ganVtcCBvdmVy\nIHJldHVybgogICAgICAgIH0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBjdXN0b20gcmVhZE9iamVjdCBt\nZXRob2QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxpbmsgT2Jq\nZWN0SW5wdXRTdHJlYW0jcmVhZE9iamVjdH0gbWV0aG9kLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgbW9kaWZ5UmVhZE9iamVjdE1ldGhvZChCQ01ldGhv\nZCBtZXRob2QsIGJvb2xlYW4gZnVsbCkgewogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYmVmb3JlRmly\nc3QoKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpbnN0YW5jZSB1c2VzIHN5bnRo\nZXRpYyBkZXRhY2hlZCBzdGF0ZSwgbm90ZSB0aGF0IGl0IGhhcwogICAgICAg\nIC8vIGJlZW4gZGVzZXJpYWxpemVkCiAgICAgICAgaWYgKENsYXNzTWV0YURh\ndGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkp\nKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICJERVNF\nUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3Rh\ndGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChmdWxs\nKSB7CiAgICAgICAgICAgIC8vIGluLmRlZmF1bHRSZWFkT2JqZWN0ICgpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJbnB1\ndFN0cmVhbS5jbGFzcywKICAgICAgICAgICAgICAgICJkZWZhdWx0UmVhZE9i\namVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgcGNJc0RldGFjaGVk\nKCkgbWV0aG9kIHRvIGRldGVybWluZSBpZiBhbiBpbnN0YW5jZQogICAgICog\naXMgZGV0YWNoZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRJc0Rl\ndGFjaGVkTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgYm9vbGVhbiBwY0lzRGV0YWNo\nZWQgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAiSXNEZXRhY2hlZCIsCiAgICAgICAgICAgIEJvb2xlYW4u\nY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAg\nICAgd3JpdGVJc0RldGFjaGVkTWV0aG9kKGNvZGUpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUg\nYm9keSBvZiB0aGUgcGNJc0RldGFjaGVkKCkgbWV0aG9kIHRvIGRldGVybWlu\nZSBpZiBhbgogICAgICogaW5zdGFuY2UgaXMgZGV0YWNoZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCB3cml0ZUlzRGV0YWNoZWRNZXRob2QoQ29kZSBj\nb2RlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIC8vIG5vdCBkZXRhY2hhYmxlOiByZXR1cm4gQm9vbGVhbi5GQUxT\nRQogICAgICAgIGlmICghX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNz\nLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAgIC8vCQlyZXR1cm4gKHNt\nLmlzRGV0YWNoZWQgKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwo\nKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01U\nWVBFLCAiaXNEZXRhY2hlZCIsCiAgICAgICAgICAgIGJvb2xlYW4uY2xhc3Ms\nIG51bGwpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmZhbHNlID0gY29k\nZS5pZmVxKCk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChC\nb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIGlmZmFsc2Uuc2V0VGFyZ2V0KGNv\nZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNF\nIiwKICAgICAgICAgICAgQm9vbGVhbi5jbGFzcykpOwogICAgICAgIGNvZGUu\nYXJldHVybigpOwoKICAgICAgICAvLyBpZiB3ZSB1c2UgZGV0YWNoZWQgc3Rh\ndGU6CiAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSAhPSBu\ndWxsCiAgICAgICAgLy8gICAgICYmIHBjR2V0RGV0YWNoZWRTdGF0ZSAhPSBE\nRVNFUklBTElaRUQpCiAgICAgICAgLy8gICAgIHJldHVybiBCb29sZWFuLlRS\nVUU7CiAgICAgICAgQm9vbGVhbiBzdGF0ZSA9IF9tZXRhLnVzZXNEZXRhY2hl\nZFN0YXRlKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIG5vdGRlc2VyID0g\nbnVsbDsKICAgICAgICBJbnN0cnVjdGlvbiB0YXJnZXQ7CiAgICAgICAgaWYg\nKHN0YXRlICE9IEJvb2xlYW4uRkFMU0UpIHsKICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBS\nRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm51\nbGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAg\nICAgICAgICAgICAgICJERVNFUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwog\nICAgICAgICAgICBub3RkZXNlciA9IGNvZGUuaWZhY21wZXEoKTsKICAgICAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNz\nLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBCb29sZWFuLlRS\nVUUpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgdG8gdXNlIGRl\ndGFjaGVkIHN0YXRlOgogICAgICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAg\nICAgICAgICAgICAgICAgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgICAg\nICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIG5v\ndGRlc2VyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBhcnRpZmljaWFs\nIHRhcmdldCB0byBzaW1wbGlmeQogICAgICAgIHRhcmdldCA9IGNvZGUubm9w\nKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAg\naWYgKG5vdGRlc2VyICE9IG51bGwpCiAgICAgICAgICAgIG5vdGRlc2VyLnNl\ndFRhcmdldCh0YXJnZXQpOwoKICAgICAgICAvLyBhbGxvdyB1c2VycyB3aXRo\nIHZlcnNpb24gZmllbGRzIHRvIG1hbnVhbGx5IGNvbnN0cnVjdCBhICJkZXRh\nY2hlZCIKICAgICAgICAvLyBpbnN0YW5jZSwgc28gY2hlY2sgdmVyc2lvbiBi\nZWZvcmUgdGFraW5nIGludG8gYWNjb3VudCBub24tZXhpc3RlbnQKICAgICAg\nICAvLyBkZXRhY2hlZCBzdGF0ZQoKICAgICAgICAvLyBjb25zaWRlciBkZXRh\nY2hlZCBpZiB2ZXJzaW9uIGlzIG5vbi1kZWZhdWx0CiAgICAgICAgRmllbGRN\nZXRhRGF0YSB2ZXJzaW9uID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAg\nICAgICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uVFJVRSAmJiB2ZXJzaW9uICE9\nIG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgKDx2ZXJzaW9uPiAhPSA8ZGVm\nYXVsdD4pCiAgICAgICAgICAgIC8vCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbik7CiAg\nICAgICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgdmVyc2lv\nbik7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9v\nbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJG\nQUxTRSIsCiAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAgICAg\nICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICAvLyBubyBkZXRhY2hlZCBzdGF0ZTogaWYgaW5z\ndGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSBhbmQgaXQncyBub3QKICAgICAg\nICAvLyBzeW50aGV0aWMgb3IgdGhlIGluc3RhbmNlIGlzIG5vdCBzZXJpYWxp\nemFibGUgb3IgdGhlIHN0YXRlIGlzbid0CiAgICAgICAgLy8gdHJhbnNpZW50\nLCBtdXN0IG5vdCBiZSBkZXRhY2hlZAogICAgICAgIGlmIChzdGF0ZSA9PSBu\ndWxsCiAgICAgICAgICAgICYmICghQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMu\nZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAg\nfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgfHwgIV9yZXBvcy5n\nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgog\nICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKSkpIHsKICAg\nICAgICAgICAgLy8gcmV0dXJuIEJvb2xlYW4uRkFMU0UKICAgICAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFM\nU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8v\nIG5vIGRldGFjaGVkIHN0YXRlOiBpZiBpbnN0YW5jZSB1c2VzIGRldGFjaGVk\nIHN0YXRlIChhbmQgbXVzdCBiZQogICAgICAgIC8vIHN5bnRoZXRpYyBhbmQg\ndHJhbnNpZW50IGluIHNlcmlhbGl6YWJsZSBpbnN0YW5jZSBhdCB0aGlzIHBv\naW50KSwKICAgICAgICAvLyBub3QgZGV0YWNoZWQgaWYgc3RhdGUgbm90IHNl\ndCB0byBERVNFUklBTElaRUQKICAgICAgICBpZiAoc3RhdGUgPT0gbnVsbCkg\newogICAgICAgICAgICAvLyBpZiAocGNHZXREZXRhY2hlZFN0YXRlICgpID09\nIG51bGwpIC8vIGluc3RlYWQgb2YgREVTRVJJQUxJWkVECiAgICAgICAgICAg\nIC8vICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNo\nZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAg\nICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFz\ncywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5u\nb3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hl\nZCBpZiBhdXRvLWdlbm5lZCBwcmltYXJ5IGtleXMgYXJlIG5vbi1kZWZhdWx0\nCiAgICAgICAgaWZpbnMgPSBudWxsOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmluczIgPSBudWxsOwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFu\nLlRSVUUKICAgICAgICAgICAgJiYgX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikgewogICAgICAgICAg\nICAvLyBmb3IgZWFjaCBwayBmaWVsZDoKICAgICAgICAgICAgLy8gaWYgKDxw\naz4gIT0gPGRlZmF1bHQ+IFsmJiAhIiIuZXF1YWxzICg8cGs+KV0pCiAgICAg\nICAgICAgIC8vCQlyZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gcGtzID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxk\ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1\nZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdGFyZ2V0\nID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICBpZiAoaWZpbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlm\nIChpZmluczIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpZmluczIu\nc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZmluczIgPSBu\ndWxsOwoKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAgIGlmaW5zID0gaWZEZWZh\ndWx0VmFsdWUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChw\na3NbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5TVFJJ\nTkcpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoIiIpOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoU3RyaW5n\nLmNsYXNzLCAiZXF1YWxzIiwKICAgICAgICAgICAgICAgICAgICAgICAgYm9v\nbGVhbi5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICAgICAgICAgICAgICBpZmluczIgPSBjb2RlLmlmbmUoKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCku\nc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLAogICAgICAgICAgICAg\nICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8v\nIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qga25vdwogICAgICAgIHRhcmdldCA9\nIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgaWYgKGlmaW5z\nICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQp\nOwogICAgICAgIGlmIChpZmluczIgIT0gbnVsbCkKICAgICAgICAgICAgaWZp\nbnMyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyZSB0aGUgZ2l2ZW4gZmll\nbGQgdG8gaXRzIEphdmEgZGVmYXVsdCwgcmV0dXJuaW5nIHRoZQogICAgICog\nY29tcGFyaXNvbiBpbnN0cnVjdGlvbi4gVGhlIGZpZWxkIHZhbHVlIHdpbGwg\nYWxyZWFkeSBiZSBvbiB0aGUgc3RhY2suCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIEp1bXBJbnN0cnVjdGlvbiBpZkRlZmF1bHRWYWx1ZShDb2RlIGNv\nZGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBzd2l0\nY2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBj\nb2RlLmlmZXEoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxF\nOgogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBE\nKTsKICAgICAgICAgICAgICAgIGNvZGUuZGNtcGwoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoMEYpOwogICAgICAgICAgICAgICAgY29kZS5mY21wbCgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgIGNvZGUu\nbGNtcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGNv\nZGUuaWZudWxsKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nSGVscGVyIG1ldGhvZCB0byBnZXQgdGhlIGNvZGUgZm9yIHRoZSBjbGFzcyBp\nbml0aWFsaXplciBtZXRob2QsCiAgICAgKiBjcmVhdGluZyB0aGUgbWV0aG9k\nIGlmIGl0IGRvZXMgbm90IGFscmVhZHkgZXhpc3QuCiAgICAgKi8KICAgIHBy\naXZhdGUgQ29kZSBnZXRPckNyZWF0ZUNsYXNzSW5pdENvZGUoYm9vbGVhbiBy\nZXBsYWNlTGFzdCkgewogICAgICAgIEJDTWV0aG9kIGNsaW5pdCA9IF9wYy5n\nZXREZWNsYXJlZE1ldGhvZCgiPGNsaW5pdD4iKTsKICAgICAgICBDb2RlIGNv\nZGU7CiAgICAgICAgaWYgKGNsaW5pdCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVlKTsKICAgICAgICAgICAgaWYg\nKHJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgICAgICBDb2RlIHRlbXBsYXRl\nID0gKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24o\nKSk7CiAgICAgICAgICAgICAgICBjb2RlLnNlYXJjaEZvcndhcmQodGVtcGxh\ndGUudnJldHVybigpKTsKICAgICAgICAgICAgICAgIGNvZGUucHJldmlvdXMo\nKTsKICAgICAgICAgICAgICAgIGNvZGUuc2V0KHRlbXBsYXRlLm5vcCgpKTsK\nICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBjb2RlOwogICAgICAgIH0KCiAgICAgICAgLy8g\nYWRkIHN0YXRpYyBpbml0aWFsaXplciBtZXRob2QgaWYgbm9uIGV4aXN0cwog\nICAgICAgIGNsaW5pdCA9IF9wYy5kZWNsYXJlTWV0aG9kKCI8Y2xpbml0PiIs\nIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNsaW5pdC5tYWtlUGFja2Fn\nZSgpOwogICAgICAgIGNsaW5pdC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAg\nY2xpbml0LnNldEZpbmFsKHRydWUpOwoKICAgICAgICBjb2RlID0gY2xpbml0\nLmdldENvZGUodHJ1ZSk7CiAgICAgICAgaWYgKCFyZXBsYWNlTGFzdCkgewog\nICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgY29kZS5w\ncmV2aW91cygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29kZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgYnl0ZWNvZGUgbW9kaWZ5aW5nIHRo\nZSBjbG9uaW5nIGJlaGF2aW9yIG9mIHRoZSBjbGFzcyBiZWluZwogICAgICog\nZW5oYW5jZWQgdG8gY29ycmVjdGx5IHJlcGxhY2UgdGhlIDxjb2RlPnBjU3Rh\ndGVNYW5hZ2VyPC9jb2RlPiAKICAgICAqIGluc3RhbmNlIGZpZWxkcyBvZiBh\nbnkgY2xvbmUgY3JlYXRlZCB3aXRoIHRoZWlyIGRlZmF1bHQgdmFsdWVzLiAK\nICAgICAqIEFsc28sIGlmIHRoaXMgY2xhc3MgaXMgdGhlIGJhc2UgUEMgdHlw\nZSBhbmQgZG9lcyBub3QgZGVjbGFyZWQgCiAgICAgKiBhIGNsb25lIG1ldGhv\nZCwgb25lIHdpbGwgYmUgYWRkZWQuIEFsc28sIGlmIF9wYyBpcyBhIHN5bnRo\nZXRpYwogICAgICogc3ViY2xhc3MsIGNyZWF0ZSB0aGUgY2xvbmUoKSBtZXRo\nb2QgdGhhdCBjbGVhcnMgdGhlIHN0YXRlIG1hbmFnZXIKICAgICAqIHRoYXQg\nbWF5IGhhdmUgYmVlbiBpbml0aWFsaXplZCBpbiBhIHN1cGVyJ3MgY2xvbmUo\nKSBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDbG9uaW5n\nQ29kZSgpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkg\nIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICAvLyBhZGQgdGhlIGNsb25lIG1ldGhvZCBpZiBu\nZWNlc3NhcnkKICAgICAgICBCQ01ldGhvZCBjbG9uZSA9IF9wYy5nZXREZWNs\nYXJlZE1ldGhvZCgiY2xvbmUiLCAKICAgICAgICAgICAgKFN0cmluZ1tdKSBu\ndWxsKTsKICAgICAgICBTdHJpbmcgc3VwZXJOYW1lID0gX21hbmFnZWRUeXBl\nLmdldFN1cGVyY2xhc3NOYW1lKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbnVs\nbDsKICAgICAgICBpZiAoY2xvbmUgPT0gbnVsbCkgewogICAgICAgICAgICAv\nLyBhZGQgY2xvbmUgc3VwcG9ydCBmb3IgYmFzZSBjbGFzc2VzCiAgICAgICAg\nICAgIC8vIHdoaWNoIGFsc28gaW1wbGVtZW50IGNsb25lYWJsZQogICAgICAg\nICAgICBib29sZWFuIGlzQ2xvbmVhYmxlID0gQ2xvbmVhYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUu\nZ2V0VHlwZSgpKTsKICAgICAgICAgICAgYm9vbGVhbiBleHRlbmRzT2JqZWN0\nID0KICAgICAgICAgICAgICAgIHN1cGVyTmFtZS5lcXVhbHMoT2JqZWN0LmNs\nYXNzLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmICghaXNDbG9uZWFibGUg\nfHwgKCFleHRlbmRzT2JqZWN0ICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSkK\nICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmICghZ2V0\nQ3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy50cmFj\nZSgKICAgICAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoImVuaGFuY2Ut\nY2xvbmVhYmxlIiwgX21hbmFnZWRUeXBlLmdldE5hbWUoKSkpOwoKICAgICAg\nICAgICAgLy8gYWRkIGNsb25lIG1ldGhvZAogICAgICAgICAgICAvLyBwcm90\nZWN0ZWQgT2JqZWN0IGNsb25lICgpIHRocm93cyBDbG9uZU5vdFN1cHBvcnRl\nZEV4Y2VwdGlvbgogICAgICAgICAgICBjbG9uZSA9IF9wYy5kZWNsYXJlTWV0\naG9kKCJjbG9uZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIGlmICghc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2QoY2xvbmUpKQogICAg\nICAgICAgICAgICAgY2xvbmUubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAg\nICBjbG9uZS5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbgogICAg\nICAgICAgICAgICAgKENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZSA9IGNsb25lLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgICAgICAvLyByZXR1cm4gc3VwZXIuY2xvbmUgKCk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3VwZXJOYW1l\nLCAiY2xvbmUiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLmdldE5h\nbWUoKSwgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUgY2xvbmUgbWV0\naG9kIGNvZGUKICAgICAgICAgICAgY29kZSA9IGNsb25lLmdldENvZGUoZmFs\nc2UpOwogICAgICAgICAgICBpZiAoY29kZSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIHRl\nbXBsYXRlIHN1cGVyLmNsb25lICgpIGluc3RydWN0aW9uIHRvIG1hdGNoIGFn\nYWluc3QKICAgICAgICBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSA9ICgoQ29kZSkg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLmludm9rZXNwZWNpYWwo\nKQogICAgICAgICAgICAuc2V0TWV0aG9kKHN1cGVyTmFtZSwgImNsb25lIiwg\nT2JqZWN0LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7CgogICAgICAgIC8vIGZp\nbmQgY2FsbHMgdG8gdGhlIHRlbXBsYXRlIGluc3RydWN0aW9uOyBvbiBtYXRj\naAogICAgICAgIC8vIGNsb25lIHdpbGwgYmUgb24gc3RhY2sKICAgICAgICBj\nb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgaWYgKGNvZGUuc2VhcmNoRm9y\nd2FyZCh0ZW1wbGF0ZSkpIHsKICAgICAgICAgICAgLy8gKCg8dHlwZT4pIGNs\nb25lKS5wY1N0YXRlTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShf\ncGMpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwog\nICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CgogICAgICAgICAgICAvLyBpZiBtb2RpZmllZCwgaW5jcmVhc2Ugc3Rh\nY2sKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIGF1eGlsaWFyeSBlbmhh\nbmNlcnMgcmVnaXN0ZXJlZCBhcyB7QGxpbmsgU2VydmljZXMgc2VydmljZXN9\nLgogICAgICovCiAgICBwdWJsaWMgQXV4aWxpYXJ5RW5oYW5jZXJbXSBnZXRB\ndXhpbGlhcnlFbmhhbmNlcnMoKSB7CgkJcmV0dXJuIF9hdXhFbmhhbmNlcnM7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWxsb3cgYW55IHJlZ2lzdGVy\nZWQgYXV4aWxpYXJ5IGNvZGUgZ2VuZXJhdG9ycyB0byBydW4uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBydW5BdXhpbGlhcnlFbmhhbmNlcnMoKSB7CiAg\nICAJZm9yIChpbnQgaSA9IDA7IGkgPCBfYXV4RW5oYW5jZXJzLmxlbmd0aDsg\naSsrKQogICAgCQlfYXV4RW5oYW5jZXJzW2ldLnJ1bihfcGMsIF9tZXRhKTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRoZSBnaXZl\nbiBtZXRob2QgYmUgc2tpcHBlZC4KICAgICAqIAogICAgICogQHBhcmFtIG1l\ndGhvZCBtZXRob2QgdG8gYmUgc2tpcHBlZCBvciBub3QKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiBhbnkgb2YgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMgc2tp\ncHMgdGhlIGdpdmVuIG1ldGhvZCwKICAgICAqIG9yIGlmIHRoZSBtZXRob2Qg\naXMgYSBjb25zdHJ1Y3RvcgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\nc2tpcEVuaGFuY2UoQkNNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgaWYgKCI8\naW5pdD4iLmVxdWFscyhtZXRob2QuZ2V0TmFtZSgpKSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfYXV4RW5oYW5jZXJzLmxlbmd0aDsgaSsrKQogICAgCQlpZiAoX2F1\neEVuaGFuY2Vyc1tpXS5za2lwRW5oYW5jZShtZXRob2QpKQogICAgCQkJcmV0\ndXJuIHRydWU7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyBzeW50aGV0aWMgZmllbGQgYWNjZXNz\nIG1ldGhvZHMgdGhhdCB3aWxsIHJlcGxhY2UgYWxsIGRpcmVjdAogICAgICog\nZmllbGQgYWNjZXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRB\nY2Nlc3NvcnMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDog\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIGlmICgh\nZ2V0UmVkZWZpbmUoKQogICAgICAgICAgICAgICAgICAgICYmIF9tZXRhLmdl\ndEFjY2Vzc1R5cGUoKSAhPSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkg\newogICAgICAgICAgICAgICAgICAgIGFkZFN1YmNsYXNzU2V0TWV0aG9kKGZt\nZHNbaV0pOwogICAgICAgICAgICAgICAgICAgIGFkZFN1YmNsYXNzR2V0TWV0\naG9kKGZtZHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgYWRkR2V0TWV0aG9kKGksIGZtZHNb\naV0pOwogICAgICAgICAgICAgICAgYWRkU2V0TWV0aG9kKGksIGZtZHNbaV0p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyBhIG5vbi1zdGF0aWMgc2V0dGVyIHRoYXQgZGVsZWdhdGVzIHRv\nIHRoZSBzdXBlciBtZXRob2RzLCBhbmQKICAgICAqIHBlcmZvcm1zIGFueSBu\nZWNlc3NhcnkgZmllbGQgdHJhY2tpbmcuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRTdWJjbGFzc1NldE1ldGhvZChGaWVsZE1ldGFEYXRhIGZtZCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICBDbGFzcyBwcm9wVHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAg\nICAgICBTdHJpbmcgc2V0dGVyTmFtZSA9IGdldFNldHRlck5hbWUoZm1kKTsK\nICAgICAgICBCQ01ldGhvZCBzZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChz\nZXR0ZXJOYW1lLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXSB7IHByb3BUeXBlIH0pOwogICAgICAgIHNldFZpc2liaWxpdHlUb1N1cGVy\nTWV0aG9kKHNldHRlcik7CiAgICAgICAgQ29kZSBjb2RlID0gc2V0dGVyLmdl\ndENvZGUodHJ1ZSk7CgogICAgICAgIC8vIG5vdCBuZWNlc3NhcnkgaWYgd2Un\ncmUgYWxyZWFkeSB0cmFja2luZyBhY2Nlc3MgdmlhIHJlZGVmaW5pdGlvbgog\nICAgICAgIGlmICghZ2V0UmVkZWZpbmUoKSkgewogICAgICAgICAgICAvLyBn\nZXQgdGhlIG9yaWcgdmFsdWUgb250byBzdGFjawogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIGludCB2YWwgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLnhz\ndG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkpOwogICAgICAgICAgICBhZGROb3RpZnlNdXRhdGlvbihjb2RlLCBm\nbWQsIHZhbCwgMCk7CiAgICAgICAgfQoKICAgICAgICAvLyAjIyMjIyB0ZXN0\nIGNhc2U6IEIgZXh0ZW5kcyBBLiBNZXRob2RzIGRlZmluZWQgaW4gQS4gV2hh\ndAogICAgICAgIC8vICMjIyMjIGhhcHBlbnM/CiAgICAgICAgLy8gc3VwZXIu\nc2V0WFhYKC4uLikKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgwKS5zZXRUeXBlKHByb3BU\neXBlKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nX21hbmFnZWRUeXBlLmdldFR5cGUoKSwKICAgICAgICAgICAgc2V0dGVyTmFt\nZSwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBwcm9wVHlwZSB9KTsKCiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIHNldFZpc2liaWxpdHlUb1N1\ncGVyTWV0aG9kKEJDTWV0aG9kIG1ldGhvZCkgewogICAgICAgIEJDTWV0aG9k\nW10gbWV0aG9kcyA9IF9tYW5hZ2VkVHlwZS5nZXRNZXRob2RzKG1ldGhvZC5n\nZXROYW1lKCksCiAgICAgICAgICAgIG1ldGhvZC5nZXRQYXJhbVR5cGVzKCkp\nOwogICAgICAgIGlmIChtZXRob2RzLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tYWNjZXNz\nb3IiLAogICAgICAgICAgICAgICAgX21hbmFnZWRUeXBlLmdldE5hbWUoKSwg\nbWV0aG9kLmdldE5hbWUoKSkpOwogICAgICAgIEJDTWV0aG9kIHN1cGVyTWV0\naCA9IG1ldGhvZHNbMF07CiAgICAgICAgaWYgKHN1cGVyTWV0aC5pc1ByaXZh\ndGUoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChzdXBl\nck1ldGguaXNQYWNrYWdlKCkpIHsKICAgICAgICAgICAgbWV0aG9kLm1ha2VQ\nYWNrYWdlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0g\nZWxzZSBpZiAoc3VwZXJNZXRoLmlzUHJvdGVjdGVkKCkpIHsKICAgICAgICAg\nICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChzdXBlck1ldGguaXNQdWJsaWMo\nKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIG5vbi1zdGF0aWMg\nZ2V0dGVyIHRoYXQgZGVsZWdhdGVzIHRvIHRoZSBzdXBlciBtZXRob2RzLCBh\nbmQKICAgICAqIHBlcmZvcm1zIGFueSBuZWNlc3NhcnkgZmllbGQgdHJhY2tp\nbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTdWJjbGFzc0dldE1l\ndGhvZChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIFN0cmluZyBtZXRo\nTmFtZSA9ICJnZXQiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0\nTmFtZSgpKTsKICAgICAgICBpZiAoX21hbmFnZWRUeXBlLmdldE1ldGhvZHMo\nbWV0aE5hbWUsIG5ldyBDbGFzc1swXSkubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIG1ldGhOYW1lID0gImlzIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUo\nZm1kLmdldE5hbWUoKSk7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVyID0gX3Bj\nLmRlY2xhcmVNZXRob2QobWV0aE5hbWUsIGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSwKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgc2V0VmlzaWJpbGl0eVRv\nU3VwZXJNZXRob2QoZ2V0dGVyKTsKICAgICAgICBnZXR0ZXIubWFrZVB1Ymxp\nYygpOwogICAgICAgIENvZGUgY29kZSA9IGdldHRlci5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBpZiB3ZSdyZSBub3QgYWxyZWFkeSB0cmFja2luZyBm\naWVsZCBhY2Nlc3MgdmlhIHJlZmxlY3Rpb24sIHRoZW4gd2UKICAgICAgICAv\nLyBtdXN0IG1ha2UgdGhlIGdldHRlciBob29rIGluIGxhenkgbG9hZGluZyBi\nZWZvcmUgYWNjZXNzaW5nIHRoZSBzdXBlcgogICAgICAgIC8vIG1ldGhvZC4K\nICAgICAgICBpZiAoIWdldFJlZGVmaW5lKCkpCiAgICAgICAgICAgIGFkZE5v\ndGlmeUFjY2Vzcyhjb2RlLCBmbWQpOwoKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLCBtZXRoTmFtZSwKICAgICAg\nICAgICAgZm1kLmdldERlY2xhcmVkVHlwZSgpLCBudWxsKTsKICAgICAgICBj\nb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgc3RhdGljIGdldHRlciBtZXRob2QgZm9yIHRoZSBnaXZlbiBm\naWVsZC4KICAgICAqIFRoZSBnZW5lcmF0ZWQgbWV0aG9kIGludGVyYWN0cyB3\naXRoIHRoZSBpbnN0YW5jZSBzdGF0ZSBhbmQgdGhlCiAgICAgKiBTdGF0ZU1h\nbmFnZXIgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuCiAgICAgKgog\nICAgICogQHBhcmFtIGluZGV4IHRoZSByZWxhdGl2ZSBudW1iZXIgb2YgdGhl\nIGZpZWxkCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRhIGFib3V0IHRoZSBm\naWVsZCB0byBnZXQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldE1l\ndGhvZChpbnQgaW5kZXgsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IGNyZWF0ZUdldE1ldGhvZChmbWQpOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiBy\nZWFkcyBhcmUgbm90IGNoZWNrZWQsIGp1c3QgcmV0dXJuIHRoZSB2YWx1ZQog\nICAgICAgIGJ5dGUgZmllbGRGbGFnID0gZ2V0RmllbGRGbGFnKGZtZCk7CiAg\nICAgICAgaWYgKChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hF\nQ0tfUkVBRCkgPT0gMAogICAgICAgICAgICAmJiAoZmllbGRGbGFnICYgUGVy\nc2lzdGVuY2VDYXBhYmxlLk1FRElBVEVfUkVBRCkgPT0gMCkgewogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAg\nICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAg\nICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVk\nVHlwZSgpKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgKGlu\nc3QucGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJuIGluc3QuPGZpZWxk\nPjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVs\nbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwog\nICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVk\nVHlwZSgpKTsKCiAgICAgICAgLy8gaW50IGZpZWxkID0gcGNJbmhlcml0ZWRG\naWVsZENvdW50ICsgPGZpZWxkaW5kZXg+OwogICAgICAgIGludCBmaWVsZExv\nY2FsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQoY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklU\nLCBpbnQuY2xhc3MpKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoaW5kZXgpOwogICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIGNvZGUu\naXN0b3JlKCkuc2V0TG9jYWwoZmllbGRMb2NhbCk7CgogICAgICAgIC8vIGlu\nc3QucGNTdGF0ZU1hbmFnZXIuYWNjZXNzaW5nRmllbGQgKGZpZWxkKTsKICAg\nICAgICAvLyByZXR1cm4gaW5zdC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaWxvYWQo\nKS5zZXRMb2NhbChmaWVsZExvY2FsKTsKICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJhY2Nlc3NpbmdGaWVsZCIs\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xh\nc3MgfSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nKTsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7\nCiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgYSBzdGF0aWMgc2V0dGVyIG1ldGhvZCBmb3Ig\ndGhlIGdpdmVuIGZpZWxkLgogICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2Qg\naW50ZXJhY3RzIHdpdGggdGhlIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAg\nICAqIFN0YXRlTWFuYWdlciB0byBzZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVs\nZC4KICAgICAqCiAgICAgKiBAcGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51\nbWJlciBvZiB0aGUgZmllbGQKICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEg\nYWJvdXQgdGhlIGZpZWxkIHRvIHNldAogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkU2V0TWV0aG9kKGludCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gY3JlYXRlU2V0TWV0aG9kKGZtZCk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIC8vIFBDRW5oYW5jZXIgdXNlcyBzdGF0aWMgbWV0aG9kczsgUENTdWJj\nbGFzc2VyIGRvZXMgbm90LgogICAgICAgIGludCBmaXJzdFBhcmFtT2Zmc2V0\nID0gZ2V0QWNjZXNzb3JQYXJhbWV0ZXJPZmZzZXQoKTsKCiAgICAgICAgLy8g\naWYgKGluc3QucGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgaW5zdC48ZmllbGQ+\nID0gdmFsdWU7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0\ncnVlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZm5vbm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIHRydWUpOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBh\ncmFtT2Zmc2V0KTsKICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIGZtZCk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8v\nIGluc3QucGNTdGF0ZU1hbmFnZXIuc2V0dGluZzxmaWVsZFR5cGU+RmllbGQg\nKGluc3QsCiAgICAgICAgLy8gICAgIHBjSW5oZXJpdGVkRmllbGRDb3VudCAr\nIDxpbmRleD4sIGluc3QuPGZpZWxkPiwgdmFsdWUsIDApOwogICAgICAgIGlm\naW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUp\nKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsK\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGlu\ndC5jbGFzcyk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGlu\nZGV4KTsKICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGFkZEdldE1hbmFnZWRW\nYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnhsb2FkKCkuc2V0\nUGFyYW0oZmlyc3RQYXJhbU9mZnNldCk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDApOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAgICAgICAg\nICAoZm1kLmdldERlY2xhcmVkVHlwZSgpLCAic2V0dGluZyIsIGZhbHNlLCB0\ncnVlKSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyB3\naGljaCBhdHRhY2ggLyBkZXRhY2ggbWV0aG9kcyB0byB1c2UuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRBdHRhY2hEZXRhY2hDb2RlKCkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBz\nZWUgaWYgYW55IHN1cGVyY2xhc3NlcyBhcmUgZGV0YWNoYWJsZQogICAgICAg\nIGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSA9IGZhbHNlOwogICAgICAgIGZv\nciAoQ2xhc3NNZXRhRGF0YSBwYXJlbnQgPSBfbWV0YS5nZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBwYXJlbnQgIT0gbnVsbDsgcGFy\nZW50ID0gcGFyZW50LmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpIHsKICAg\nICAgICAgICAgaWYgKHBhcmVudC5pc0RldGFjaGFibGUoKSkgewogICAgICAg\nICAgICAgICAgcGFyZW50RGV0YWNoYWJsZSA9IHRydWU7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gaWYgcGFyZW50IG5vdCBkZXRhY2hhYmxlLCB3ZSBuZWVkIHRvIGFkZCB0\naGUgZGV0YWNoIHN0YXRlIGZpZWxkcyBhbmQKICAgICAgICAvLyBhY2Nlc3Nv\nciBtZXRob2RzCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygp\nID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKQogICAgICAgICAgICB8\nfCBwYXJlbnREZXRhY2hhYmxlICE9IF9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7\nCiAgICAgICAgICAgIGFkZElzRGV0YWNoZWRNZXRob2QoKTsKICAgICAgICAg\nICAgYWRkRGV0YWNoZWRTdGF0ZU1ldGhvZHMoX21ldGEudXNlc0RldGFjaGVk\nU3RhdGUoKQogICAgICAgICAgICAgICAgIT0gQm9vbGVhbi5GQUxTRSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiB3ZSBkZXRhY2ggb24gc2VyaWFsaXpl\nLCB3ZSBhbHNvIG5lZWQgdG8gaW1wbGVtZW50IHRoZQogICAgICAgIC8vIGV4\ndGVybmFsaXphYmxlIGludGVyZmFjZSB0byB3cml0ZSBqdXN0IHRoZSBzdGF0\nZSBmb3IgdGhlIGZpZWxkcwogICAgICAgIC8vIGJlaW5nIGRldGFjaGVkCiAg\nICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNoZWQoKSkgewogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgYWRkRGV0YWNoRXh0ZXJuYWxpemUo\ncGFyZW50RGV0YWNoYWJsZSwKICAgICAgICAgICAgICAgICAgICBfbWV0YS51\nc2VzRGV0YWNoZWRTdGF0ZSgpICE9IEJvb2xlYW4uRkFMU0UpOwogICAgICAg\nICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24obnNt\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGZpZWxkcyB0byBob2xkIGRldGFjaGVkIHN0YXRlIGFu\nZCB0aGVpciBhY2Nlc3NvciBtZXRob2RzLgogICAgICoKICAgICAqIEBwYXJh\nbSBpbXBsIHdoZXRoZXIgdG8gZnVsbHkgaW1wbGVtZW50IGRldGFjaCBzdGF0\nZSBmdW5jdGlvbmFsaXR5CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRE\nZXRhY2hlZFN0YXRlTWV0aG9kcyhib29sZWFuIGltcGwpIHsKICAgICAgICBG\naWVsZCBkZXRhY2hGaWVsZCA9IF9tZXRhLmdldERldGFjaGVkU3RhdGVGaWVs\nZCgpOwogICAgICAgIFN0cmluZyBuYW1lID0gbnVsbDsKICAgICAgICBTdHJp\nbmcgZGVjbGFyZXIgPSBudWxsOwogICAgICAgIGlmIChpbXBsICYmIGRldGFj\naEZpZWxkID09IG51bGwpIHsKICAgICAgICAgICAgbmFtZSA9IFBSRSArICJE\nZXRhY2hlZFN0YXRlIjsKICAgICAgICAgICAgZGVjbGFyZXIgPSBfcGMuZ2V0\nTmFtZSgpOwogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xh\ncmVGaWVsZChuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBmaWVs\nZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICBmaWVsZC5zZXRUcmFuc2ll\nbnQodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChpbXBsKSB7CiAgICAgICAg\nICAgIG5hbWUgPSBkZXRhY2hGaWVsZC5nZXROYW1lKCk7CiAgICAgICAgICAg\nIGRlY2xhcmVyID0gZGV0YWNoRmllbGQuZ2V0RGVjbGFyaW5nQ2xhc3MoKS5n\nZXROYW1lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0\nIHBjR2V0RGV0YWNoZWRTdGF0ZSAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBt\nZXRob2Quc2V0U3RhdGljKGZhbHNlKTsKICAgICAgICBtZXRob2QubWFrZVB1\nYmxpYygpOwogICAgICAgIGludCBhY2Nlc3MgPSBtZXRob2QuZ2V0QWNjZXNz\nRmxhZ3MoKTsKCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgaWYgKGltcGwpIHsKICAgICAgICAgICAgLy8gcmV0\ndXJuIHBjRGV0YWNoZWRTdGF0ZTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGdldGZpZWxkKGNv\nZGUsIF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9hZENsYXNzKGRlY2xh\ncmVyKSwKICAgICAgICAgICAgICAgIG5hbWUpOwogICAgICAgIH0gZWxzZQog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwoKICAg\nICAgICAvLyBwdWJsaWMgdm9pZCBwY1NldERldGFjaGVkU3RhdGUgKE9iamVj\ndCBzdGF0ZSkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzcyBbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIG1l\ndGhvZC5zZXRBY2Nlc3NGbGFncyhhY2Nlc3MpOwogICAgICAgIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1wbCkgewogICAg\nICAgICAgICAvLyBwY0RldGFjaGVkU3RhdGUgPSBzdGF0ZTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgcHV0\nZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFByb2plY3QoKS5sb2FkQ2xh\nc3MoZGVjbGFyZXIpLAogICAgICAgICAgICAgICAgbmFtZSwgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHRvIDxjb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gZ2V0\nIGZpZWxkCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQg\naW4gdHlwZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIG9udG8gdGhl\nIHRvcCBvZiB0aGUgc3RhY2suCiAgICAgKgogICAgICogVGhlIGluc3RhbmNl\nIHRvIGFjY2VzcyBtdXN0IGFscmVhZHkgYmUgb24gdGhlIHRvcCBvZiB0aGUK\nICAgICAqIHN0YWNrIHdoZW4gdGhpcyBpcyBpbnZva2VkLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgZ2V0ZmllbGQoQ29kZSBjb2RlLCBCQ0NsYXNzIGRl\nY2xhcmVyLCBTdHJpbmcgYXR0ck5hbWUpIHsKICAgICAgICBpZiAoZGVjbGFy\nZXIgPT0gbnVsbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBfbWFuYWdlZFR5\ncGU7CgogICAgICAgIC8vIGZpcnN0LCBzZWUgaWYgd2UgY2FuIGNvbnZlcnQg\ndGhlIGF0dHJpYnV0ZSBuYW1lIHRvIGEgZmllbGQgbmFtZQogICAgICAgIFN0\ncmluZyBmaWVsZE5hbWUgPSB0b0JhY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUp\nOwoKICAgICAgICAvLyBuZXh0LCBmaW5kIHRoZSBmaWVsZCBpbiB0aGUgbWFu\nYWdlZCB0eXBlLgogICAgICAgIEJDRmllbGRbXSBmaWVsZHMgPSAoQkNGaWVs\nZFtdKSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAgICAgIC5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIuZ2V0QkNDbGFzc0ZpZWxkc0FjdGlvbihfbWFu\nYWdlZFR5cGUsCiAgICAgICAgICAgICAgICBmaWVsZE5hbWUpKTsgCiAgICAg\nICAgQkNGaWVsZCBmaWVsZCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmll\nbGQgPSBmaWVsZHNbaV07CiAgICAgICAgICAgIC8vIGlmIHdlIHJlYWNoIGEg\nZmllbGQgZGVjbGFyZWQgaW4gdGhpcyB0eXBlLCB0aGVuIHRoaXMgaXMgdGhl\nCiAgICAgICAgICAgIC8vIG1vc3QtbWFza2luZyBmaWVsZCwgYW5kIGlzIHRo\nZSBvbmUgdGhhdCB3ZSB3YW50LgogICAgICAgICAgICAvLyAjIyMjIyBwcm9i\nYWJseSBzaG91bGQgd2FsayB1cCB0aGUgaGllcmFyY2h5LCBvciBjaGVjayB0\naGF0CiAgICAgICAgICAgIC8vICMjIyMjIHNlcnAgZG9lcyB0aGF0LgogICAg\nICAgICAgICBpZiAoZmllbGRzW2ldLmdldERlY2xhcmVyKCkgPT0gZGVjbGFy\nZXIpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSAmJiBj\nb2RlLmdldE1ldGhvZCgpLmdldERlY2xhcmVyKCkgPT0gX3BjCiAgICAgICAg\nICAgICYmIChmaWVsZCA9PSBudWxsIHx8ICFmaWVsZC5pc1B1YmxpYygpKSkg\newogICAgICAgICAgICAvLyB3ZSdyZSBjcmVhdGluZyB0aGUgc3ViY2xhc3Ms\nIG5vdCByZWRlZmluaW5nIHRoZSB1c2VyIHR5cGUuCgogICAgICAgICAgICAv\nLyBSZWZsZWN0aW9uLmdldFhYWCh0aGlzLCBSZWZsZWN0aW9uLmZpbmRGaWVs\nZCguLi4pKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0\nQ2xhc3MoZGVjbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAg\nICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nCiAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBi\nb29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICBDbGFzcyB0eXBlID0gX21l\ndGEuZ2V0RmllbGQoYXR0ck5hbWUpLmdldERlY2xhcmVkVHlwZSgpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoCiAgICAgICAgICAgICAgICAgICAgZ2V0UmVmbGVj\ndGlvbkdldHRlck1ldGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAg\nICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgLy8gc2hvdWxkIG5ldmVyIGhhcHBlbgogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYm\nIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChkZWNsYXJlci5n\nZXROYW1lKCksIGZpZWxkTmFtZSwKICAgICAgICAgICAgICAgIGZpZWxkLmdl\ndFR5cGUoKS5nZXROYW1lKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4gdGhlIGluc3RydWN0\naW9ucyB0byBzZXQgZmllbGQKICAgICAqIDxjb2RlPmF0dHJOYW1lPC9jb2Rl\nPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVyPC9jb2RlPgogICAg\nICogdG8gdGhlIHZhbHVlIG9mIHR5cGUgPGNvZGU+ZmllbGRUeXBlPC9jb2Rl\nPiBvbiB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBXaGVu\nIHRoaXMgbWV0aG9kIGlzIGludm9rZWQsIHRoZSB2YWx1ZSB0byBsb2FkIG11\nc3QKICAgICAqIGFscmVhZHkgYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sg\naW4gPGNvZGU+Y29kZTwvY29kZT4sCiAgICAgKiBhbmQgdGhlIGluc3RhbmNl\nIHRvIGxvYWQgaW50byBtdXN0IGJlIHNlY29uZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHB1dGZpZWxkKENvZGUgY29kZSwgQkNDbGFzcyBkZWNsYXJl\nciwgU3RyaW5nIGF0dHJOYW1lLAogICAgICAgIENsYXNzIGZpZWxkVHlwZSkg\newogICAgICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAgICBk\nZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgU3RyaW5nIGZpZWxk\nTmFtZSA9IHRvQmFja2luZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAg\nIGlmIChnZXRSZWRlZmluZSgpIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsK\nICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5zZXQodGhpcywgUmVmbGVjdGlv\nbi5maW5kRmllbGQoLi4uKSwgdmFsdWUpOwogICAgICAgICAgICBjb2RlLmNs\nYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhkZWNsYXJlcik7CiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmaWVsZE5hbWUpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24u\nY2xhc3MsCiAgICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQuY2xh\nc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAgIENsYXNzLmNsYXNz\nLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xh\nc3MsICJzZXQiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAgICAgICBP\nYmplY3QuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgZmllbGRUeXBlLmlz\nUHJpbWl0aXZlKCkgPyBmaWVsZFR5cGUgOiBPYmplY3QuY2xhc3MsIAogICAg\nICAgICAgICAgICAgICAgIEZpZWxkLmNsYXNzIH0pOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKQogICAgICAgICAgICAg\nICAgLnNldEZpZWxkKGRlY2xhcmVyLmdldE5hbWUoKSwgZmllbGROYW1lLCBm\naWVsZFR5cGUuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJZiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVy\nZSBpcyBhIGRpZmZlcmVudCBiYWNraW5nIGZpZWxkCiAgICAgKiBuYW1lIGZv\nciB0aGUgcGVyc2lzdGVudCBhdHRyaWJ1dGUgPGNvZGU+bmFtZTwvY29kZT4u\nCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIHRvQmFja2luZ0ZpZWxkTmFt\nZShTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkKICAgICAg\nICAgICAgJiYgX2F0dHJzVG9GaWVsZHMuY29udGFpbnNLZXkobmFtZSkpCiAg\nICAgICAgICAgIG5hbWUgPSAoU3RyaW5nKSBfYXR0cnNUb0ZpZWxkcy5nZXQo\nbmFtZSk7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBp\ncyBhIGRpZmZlcmVudCBwZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFt\nZSBmb3IgdGhlIGJhY2tpbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1l\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4g\nZG9pbmcgcGVyc2lzdGVuY2UtYXdhcmUgZW5oYW5jZW1lbnQKICAgICAgICBp\nZiAoX21ldGEgIT0gbnVsbAogICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkKICAg\nICAgICAgICAgJiYgX2ZpZWxkc1RvQXR0cnMuY29udGFpbnNLZXkobmFtZSkp\nCiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKSBfZmllbGRzVG9BdHRycy5n\nZXQobmFtZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gbmFt\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudCB0aGUgZXh0ZXJu\nYWxpemFibGUgaW50ZXJmYWNlIHRvIGRldGFjaCBvbiBzZXJpYWxpemUuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGREZXRhY2hFeHRlcm5hbGl6ZShi\nb29sZWFuIHBhcmVudERldGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRh\nY2hlZFN0YXRlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSBkZWNsYXJlZCBkZWZh\ndWx0IGNvbnN0cnVjdG9yIGlzIHB1YmxpYyAKICAgICAgICAvLyBmb3IgZXh0\nZXJuYWxpemF0aW9uCiAgICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5nZXRE\nZWNsYXJlZE1ldGhvZCgiPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKICAg\nICAgICBpZiAoIW1ldGguaXNQdWJsaWMoKSkgewogICAgICAgICAgICBpZiAo\nX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImVuaGFuY2UtZGVmY29ucy1leHRlcm4iLCAKICAgICAg\nICAgICAgICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSk7CiAgICAg\nICAgICAgIG1ldGgubWFrZVB1YmxpYygpOwogICAgICAgIH0KICAgICAgICAv\nLyBkZWNsYXJlIGV4dGVybmFsaXphYmxlIGludGVyZmFjZQogICAgICAgIGlm\nICghRXh0ZXJuYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICBfcGMuZGVjbGFy\nZUludGVyZmFjZShFeHRlcm5hbGl6YWJsZS5jbGFzcyk7CgogICAgICAgIC8v\nIG1ha2Ugc3VyZSB0aGUgdXNlciBkb2Vzbid0IGFscmVhZHkgaGF2ZSBjdXN0\nb20gZXh0ZXJuYWxpemF0aW9uIG9yCiAgICAgICAgLy8gc2VyaWFsaXphdGlv\nbiBtZXRob2RzCiAgICAgICAgQ2xhc3NbXSBpbnB1dCA9IG5ldyBDbGFzc1td\neyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9OwogICAgICAgIENsYXNzW10g\nb3V0cHV0ID0gbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFz\ncyB9OwogICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRo\nb2QoInJlYWRPYmplY3QiLCBpbnB1dCkgIT0gbnVsbAogICAgICAgICAgICB8\nfCBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoIndyaXRlT2JqZWN0\nIiwgb3V0cHV0KSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiZGV0YWNoLWN1c3RvbS1zZXIiLCBfbWV0\nYSkpOwogICAgICAgIGlucHV0WzBdID0gT2JqZWN0SW5wdXQuY2xhc3M7CiAg\nICAgICAgb3V0cHV0WzBdID0gT2JqZWN0T3V0cHV0LmNsYXNzOwogICAgICAg\nIGlmIChfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRFeHRl\ncm5hbCIsIGlucHV0KSAhPSBudWxsCiAgICAgICAgICAgIHx8IF9tYW5hZ2Vk\nVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgid3JpdGVFeHRlcm5hbCIsIG91dHB1\ndCkgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImRldGFjaC1jdXN0b20tZXh0ZXJuIiwgX21ldGEpKTsK\nCiAgICAgICAgLy8gY3JlYXRlIGxpc3Qgb2YgYWxsIHVubWFuYWdlZCBzZXJp\nYWxpemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZFtdIGZpZWxkcyA9IF9t\nYW5hZ2VkVHlwZS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIENvbGxl\nY3Rpb24gdW5tZ2QgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmICghZmllbGRzW2ldLmlzVHJhbnNpZW50KCkg\nJiYgIWZpZWxkc1tpXS5pc1N0YXRpYygpCiAgICAgICAgICAgICAgICAmJiAh\nZmllbGRzW2ldLmlzRmluYWwoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxk\nc1tpXS5nZXROYW1lKCkuc3RhcnRzV2l0aChQUkUpCiAgICAgICAgICAgICAg\nICAmJiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1l\nKCkpID09IG51bGwpCiAgICAgICAgICAgICAgICB1bm1nZC5hZGQoZmllbGRz\nW2ldKTsKICAgICAgICB9CgogICAgICAgIGFkZFJlYWRFeHRlcm5hbChwYXJl\nbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAgICBhZGRSZWFk\nVW5tYW5hZ2VkKHVubWdkLCBwYXJlbnREZXRhY2hhYmxlKTsKICAgICAgICBh\nZGRXcml0ZUV4dGVybmFsKHBhcmVudERldGFjaGFibGUsIGRldGFjaGVkU3Rh\ndGUpOwogICAgICAgIGFkZFdyaXRlVW5tYW5hZ2VkKHVubWdkLCBwYXJlbnRE\nZXRhY2hhYmxlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBjdXN0b20g\ncmVhZEV4dGVybmFsIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFJlYWRFeHRlcm5hbChib29sZWFuIHBhcmVudERldGFjaGFibGUsCiAg\nICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRlKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzW10gaW5hcmdz\nID0gbmV3IENsYXNzW117IE9iamVjdElucHV0LmNsYXNzIH07CiAgICAgICAg\nQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJyZWFkRXh0ZXJu\nYWwiLCB2b2lkLmNsYXNzLCBpbmFyZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMg\nZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4\nY2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAg\nIGV4Y2Vwcy5hZGRFeGNlcHRpb24oQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5j\nbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBzdXBlci5yZWFkRXh0ZXJuYWwgKGluKTsKICAgICAg\nICBDbGFzcyBzdXAgPSBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0U3Vw\nZXJjbGFzcygpOwogICAgICAgIGlmICghcGFyZW50RGV0YWNoYWJsZSAmJiBF\neHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cCwgInJl\nYWRFeHRlcm5hbCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBpbmFy\nZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVhZFVubWFuYWdlZCAoaW4p\nOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YSksCiAg\nICAgICAgICAgIFBSRSArICJSZWFkVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywg\naW5hcmdzKTsKCiAgICAgICAgaWYgKGRldGFjaGVkU3RhdGUpIHsKICAgICAg\nICAgICAgLy8gcGNTZXREZXRhY2hlZFN0YXRlIChpbi5yZWFkT2JqZWN0ICgp\nKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2Jq\nZWN0SW5wdXQuY2xhc3MsICJyZWFkT2JqZWN0IiwKICAgICAgICAgICAgICAg\nIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIs\nCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0LmNsYXNzIH0pOwoKICAgICAgICAgICAgLy8gcGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyICgoU3RhdGVNYW5hZ2VyKSBpbi5yZWFkT2JqZWN0ICgpKTsKICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5w\ndXQuY2xhc3MsICJyZWFkT2JqZWN0IiwKICAgICAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShTdGF0ZU1hbmFnZXIuY2xhc3MpOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0\nZU1hbmFnZXIiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IFN0YXRlTWFuYWdlci5jbGFzcyB9KTsKICAgICAgICB9CgogICAg\nICAgIC8vIHJlYWQgbWFuYWdlZCBmaWVsZHMKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKCFmbWRzW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICBy\nZWFkRXh0ZXJuYWwoY29kZSwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgZm1kc1tp\nXSk7CgogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCB1bm1hbmFnZWQg\nZmllbGRzIGZyb20gdGhlIHN0cmVhbSAocGNSZWFkVW5tYW5hZ2VkKS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFJlYWRVbm1hbmFnZWQoQ29sbGVj\ndGlvbiB1bm1nZCwgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNz\nW10gaW5hcmdzID0gbmV3IENsYXNzW117IE9iamVjdElucHV0LmNsYXNzIH07\nCiAgICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJSZWFkVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\naW5hcmdzKTsKICAgICAgICBtZXRoLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAg\nICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0aW9ucyh0cnVl\nKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhjZXB0aW9uLmNs\nYXNzKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKENsYXNzTm90Rm91\nbmRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGgu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIucmVhZFVubWFuYWdl\nZCAoaW4pOwogICAgICAgIGlmIChwYXJlbnREZXRhY2hhYmxlKSB7CiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRh\nLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSks\nIFBSRSArICJSZWFkVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgCiAgICAgICAg\nICAgICAgICBpbmFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVhZCBk\nZWNsYXJlZCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxkcwogICAgICAg\nIEJDRmllbGQgZmllbGQ7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB1\nbm1nZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBmaWVsZCA9IChCQ0ZpZWxkKSBpdHIubmV4dCgpOwogICAgICAgICAgICBy\nZWFkRXh0ZXJuYWwoY29kZSwgZmllbGQuZ2V0TmFtZSgpLCBmaWVsZC5nZXRU\neXBlKCksIG51bGwpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gcmVhZCBhIGZpZWxkIGZyb20gYW4gZXh0\nZXJuYWxpemF0aW9uIGlucHV0IHN0cmVhbS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHJlYWRFeHRlcm5hbChDb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5h\nbWUsIENsYXNzIHR5cGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nU3RyaW5nIG1ldGhOYW1lOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZl\nKCkpIHsKICAgICAgICAgICAgbWV0aE5hbWUgPSB0eXBlLmdldE5hbWUoKTsK\nICAgICAgICAgICAgbWV0aE5hbWUgPSBDaGFyYWN0ZXIudG9VcHBlckNhc2Uo\nbWV0aE5hbWUuY2hhckF0KDApKQogICAgICAgICAgICAgICAgKyBtZXRoTmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gInJlYWQi\nICsgbWV0aE5hbWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIG1ldGhO\nYW1lID0gInJlYWRPYmplY3QiOwoKICAgICAgICAvLyA8ZmllbGQ+ID0gaW4u\ncmVhZDx0eXBlPiAoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgQ2xhc3MgcmV0ID0gKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0\neXBlIDogT2JqZWN0LmNsYXNzOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCBtZXRoTmFtZSwK\nICAgICAgICAgICAgcmV0LCBudWxsKTsKICAgICAgICBpZiAoIXR5cGUuaXNQ\ncmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVs\nbCwgZmllbGROYW1lLCB0eXBlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxF\nTkRBUjoKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAvLyAgIHNtLnByb3h5RGV0YWNoZWREZXNl\ncmlhbGl6ZWQgKDxpbmRleD4pOwogICAgICAgICAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZm51bGwoKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChTTVRZUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICJw\ncm94eURldGFjaGVkRGVzZXJpYWxpemVkIiwgdm9pZC5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsK\nICAgICAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgY3VzdG9tIHdyaXRlRXh0ZXJuYWwgbWV0aG9kLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVFeHRlcm5hbChib29sZWFuIHBh\ncmVudERldGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRw\ndXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xh\ncmVNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCB2b2lkLmNsYXNzLCBvdXRhcmdz\nKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0\naW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhj\nZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlRXh0ZXJuYWwgKG91\ndCk7CiAgICAgICAgQ2xhc3Mgc3VwID0gZ2V0VHlwZShfbWV0YSkuZ2V0U3Vw\nZXJjbGFzcygpOwogICAgICAgIGlmICghcGFyZW50RGV0YWNoYWJsZSAmJiBF\neHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cCwgIndy\naXRlRXh0ZXJuYWwiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgb3V0\nYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyB3cml0ZVVubWFuYWdlZCAo\nb3V0KTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEp\nLAogICAgICAgICAgICBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNs\nYXNzLCBvdXRhcmdzKTsKCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdvMiA9\nIG51bGw7CiAgICAgICAgaWYgKGRldGFjaGVkU3RhdGUpIHsKICAgICAgICAg\nICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgIC8vICAgaWYgKHNt\nLndyaXRlRGV0YWNoZWQgKG91dCkpCiAgICAgICAgICAgIC8vICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmbnVsbCA9\nIGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoU01UWVBFLCAid3JpdGVEZXRhY2hlZCIsCiAgICAg\nICAgICAgICAgICBib29sZWFuLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICAg\nICAgZ28yID0gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwoKICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAvLyAgIG91\ndC53cml0ZU9iamVjdCAocGNHZXREZXRhY2hlZFN0YXRlICgpKTsKICAgICAg\nICAgICAgQ2xhc3NbXSBvYmphcmdzID0gbmV3IENsYXNzW117IE9iamVjdC5j\nbGFzcyB9OwogICAgICAgICAgICBpZm51bGwuc2V0VGFyZ2V0KGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0\ncHV0LmNsYXNzLAogICAgICAgICAgICAgICAgIndyaXRlT2JqZWN0Iiwgdm9p\nZC5jbGFzcywgb2JqYXJncyk7CiAgICAgICAgICAgIC8vICAgIG91dC53cml0\nZU9iamVjdCAobnVsbCkgLy8gU3RhdGVNYW5hZ2VyCiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKChPYmplY3QpIG51bGwpOwogICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQu\nY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNs\nYXNzLCBvYmphcmdzKTsKICAgICAgICB9CiAgICAgICAgaWYgKGdvMiAhPSBu\ndWxsKQogICAgICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoK\nICAgICAgICAvLyB3cml0ZSBtYW5hZ2VkIGZpZWxkcwogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAg\nICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZm1kc1tpXS5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwg\nZm1kc1tpXSk7CgogICAgICAgIC8vIHJldHVybgogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogV3JpdGUgdW5tYW5hZ2VkIGZpZWxkcyB0byB0aGUgc3RyZWFt\nIChwY1dyaXRlVW5tYW5hZ2VkKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFdyaXRlVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIG91dGFyZ3MgPSBuZXcgQ2xh\nc3NbXXsgT2JqZWN0T3V0cHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2Qg\nbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJXcml0ZVVubWFuYWdl\nZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAg\nIG1ldGgubWFrZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhj\nZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vw\ncy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3Vw\nZXIud3JpdGVVbm1hbmFnZWQgKG91dCk7CiAgICAgICAgaWYgKHBhcmVudERl\ndGFjaGFibGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9p\nZC5jbGFzcywgCiAgICAgICAgICAgICAgICBvdXRhcmdzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHdyaXRlIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxp\nemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZmllbGQu\nZ2V0TmFtZSgpLCBmaWVsZC5nZXRUeXBlKCksIG51bGwpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gd3Jp\ndGUgYSBmaWVsZCB0byBhbiBleHRlcm5hbGl6YXRpb24gb3V0cHV0IHN0cmVh\nbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRXh0ZXJuYWwoQ29k\nZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsKICAgICAg\nICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAgIG1ldGhO\nYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhOYW1lID0g\nQ2hhcmFjdGVyLnRvVXBwZXJDYXNlKG1ldGhOYW1lLmNoYXJBdCgwKSkKICAg\nICAgICAgICAgICAgICsgbWV0aE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAg\nICAgICBtZXRoTmFtZSA9ICJ3cml0ZSIgKyBtZXRoTmFtZTsKICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgbWV0aE5hbWUgPSAid3JpdGVPYmplY3QiOwoK\nICAgICAgICAvLyBvdXQud3JpdGU8dHlwZT4gKDxmaWVsZD4pOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBpZiAoZm1kID09IG51\nbGwpCiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZpZWxkTmFt\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFs\ndWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgQ2xhc3NbXSBhcmdzID0gbmV3\nIENsYXNzW117IHR5cGUgfTsKICAgICAgICBpZiAodHlwZSA9PSBieXRlLmNs\nYXNzIHx8IHR5cGUgPT0gY2hhci5jbGFzcyB8fCB0eXBlID09IHNob3J0LmNs\nYXNzKQogICAgICAgICAgICBhcmdzWzBdID0gaW50LmNsYXNzOwogICAgICAg\nIGVsc2UgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIGFy\nZ3NbMF0gPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5pbnZva2VpbnRl\ncmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNzLCBtZXRoTmFt\nZSwKICAgICAgICAgICAgdm9pZC5jbGFzcywgYXJncyk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2Rl\nLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2Rl\nKGNvZGUsIGZtZCwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2Fk\nIHRoZSBmaWVsZCB2YWx1ZSBzcGVjaWZpZWQgYnkgPGNvZGU+Zm1kPC9jb2Rl\nPiBvbnRvIHRoZSBzdGFjay4KICAgICAqIEJlZm9yZSB0aGlzIG1ldGhvZCBp\ncyBjYWxsZWQsIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUg\nbG9hZGVkCiAgICAgKiBmcm9tIHdpbGwgYmUgb24gdGhlIHRvcCBvZiB0aGUg\nc3RhY2suCiAgICAgKgogICAgICogQHBhcmFtIGZyb21TYW1lQ2xhc3MgaWYg\nPGNvZGU+dHJ1ZTwvY29kZT4sIHRoZW4gPGNvZGU+Zm1kPC9jb2RlPiBpcwog\nICAgICogYmVpbmcgbG9hZGVkIGZyb20gYW4gaW5zdGFuY2Ugb2YgdGhlIHNh\nbWUgY2xhc3MgYXMgdGhlIGN1cnJlbnQgZXhlY3V0aW9uCiAgICAgKiBjb250\nZXh0LiBJZiA8Y29kZT5mYWxzZTwvY29kZT4sIHRoZW4gdGhlIGluc3RhbmNl\nIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrCiAgICAgKiBtaWdodCBiZSBhIHN1\ncGVyY2xhc3Mgb2YgdGhlIGN1cnJlbnQgZXhlY3V0aW9uIGNvbnRleHQncyAn\ndGhpcycgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBm\nbWQsCiAgICAgICAgYm9vbGVhbiBmcm9tU2FtZUNsYXNzKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGlmIHJl\nZGVmaW5pbmcsIHRoZW4gd2UgbXVzdCBhbHdheXMgcmVmbGVjdCAob3IgYWNj\nZXNzIHRoZSBmaWVsZAogICAgICAgIC8vIGRpcmVjdGx5IGlmIGFjY2Vzc2li\nbGUpLCBzaW5jZSB0aGUgcmVkZWZpbmVkIG1ldGhvZHMgd2lsbCBhbHdheXMK\nICAgICAgICAvLyB0cmlnZ2VyIG1ldGhvZCBjYWxscyB0byBTdGF0ZU1hbmFn\nZXIsIGV2ZW4gZnJvbSBpbnRlcm5hbCBkaXJlY3QtCiAgICAgICAgLy8gYWNj\nZXNzIHVzYWdlLiBXZSBjb3VsZCB3b3JrIGFyb3VuZCB0aGlzIGJ5IG5vdCBy\nZWRlZmluaW5nLCBhbmQKICAgICAgICAvLyBqdXN0IGRvIGEgc3ViY2xhc3Mg\nYXBwcm9hY2ggaW5zdGVhZC4gQnV0IHRoaXMgaXMgbm90IGEgZ29vZCBvcHRp\nb24sCiAgICAgICAgLy8gc2luY2UgaXQgd291bGQgc2FjcmlmaWNlIGxhenkg\nbG9hZGluZyBhbmQgZWZmaWNpZW50IGRpcnR5IHRyYWNraW5nLgoKICAgICAg\nICBpZiAoZ2V0UmVkZWZpbmUoKQogICAgICAgICAgICB8fCBfbWV0YS5nZXRB\nY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsK\nICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZm1kLmdldE5hbWUo\nKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7\nCiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFjY2VzcywgYW5kIHdlJ3JlIG5v\ndCByZWRlZmluaW5nLiBJZiB3ZSdyZSBvcGVyYXRpbmcKICAgICAgICAgICAg\nLy8gb24gYW4gaW5zdGFuY2UgdGhhdCBpcyBkZWZpbml0ZWx5IHRoZSBzYW1l\nIHR5cGUgYXMgJ3RoaXMnLCB0aGVuCiAgICAgICAgICAgIC8vIGNhbGwgc3Vw\nZXJjbGFzcyBtZXRob2QgdG8gYnlwYXNzIHRyYWNraW5nLiBPdGhlcndpc2Us\nIHJlZmxlY3QKICAgICAgICAgICAgLy8gdG8gYm90aCBieXBhc3MgdHJhY2tp\nbmcgYW5kIGF2b2lkIGNsYXNzIHZlcmlmaWNhdGlvbiBlcnJvcnMuCiAgICAg\nICAgICAgIGlmIChmcm9tU2FtZUNsYXNzKSB7CiAgICAgICAgICAgICAgICBN\nZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QobWV0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBnZXRmaWVsZChjb2RlLCBudWxsLCBmbWQuZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHJlZ3Vs\nYXIgZW5oYW5jZW1lbnQgKyBwcm9wZXJ0eSBhY2Nlc3MKICAgICAgICAgICAg\nTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0QmFja2luZ01lbWJlcigp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgbWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBtZXRoLmdl\ndFJldHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSB0aGUgdmFsdWUg\nYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2sgaW50byB0aGUgZmllbGQgdmFsdWUg\nc3BlY2lmaWVkCiAgICAgKiBieSA8Y29kZT5mbWQ8L2NvZGU+LiBCZWZvcmUg\ndGhpcyBtZXRob2QgaXMgY2FsbGVkLCB0aGUgZGF0YSB0byBsb2FkIHdpbGwK\nICAgICAqIGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGFuZCB0aGUgb2Jq\nZWN0IHRoYXQgdGhlIGRhdGEgc2hvdWxkIGJlIGxvYWRlZAogICAgICogaW50\nbyB3aWxsIGJlIHNlY29uZCBpbiB0aGUgc3RhY2suCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwg\nRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3\nZSBtdXN0IGFsd2F5cyByZWZsZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAg\nICAgICAgLy8gZGlyZWN0bHkgaWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSBy\nZWRlZmluZWQgbWV0aG9kcyB3aWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdn\nZXIgbWV0aG9kIGNhbGxzIHRvIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGlu\ndGVybmFsIGRpcmVjdC0KICAgICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNv\ndWxkIHdvcmsgYXJvdW5kIHRoaXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAog\nICAgICAgIC8vIGp1c3QgZG8gYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFk\nLiBCdXQgdGhpcyBpcyBub3QgYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBz\naW5jZSBpdCB3b3VsZCBzYWNyaWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZp\nY2llbnQgZGlydHkgdHJhY2tpbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmlu\nZSgpCiAgICAgICAgICAgIHx8IF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBD\nbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICBwdXRm\naWVsZChjb2RlLCBudWxsLCBmbWQuZ2V0TmFtZSgpLCBmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkpOwogICAgICAgIH0gZWxzZSBpZiAoZ2V0Q3JlYXRlU3ViY2xh\nc3MoKSkgewogICAgICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3MsIGFuZCB3\nZSdyZSBub3QgcmVkZWZpbmluZy4gaW52b2tlIHRoZQogICAgICAgICAgICAv\nLyBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcuCiAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdl\nZFR5cGUuZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgZ2V0U2V0dGVyTmFt\nZShmbWQpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHByb3Bl\ncnR5IGFjY2VzcwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoUFJFICsgZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBvZmZzZXQgdGhhdCB0aGUgZmlyc3QgbWVhbmluZ2Z1bCBh\nY2Nlc3NvciBwYXJhbWV0ZXIgaXMgYXQuCiAgICAgKi8KICAgIHByaXZhdGUg\naW50IGdldEFjY2Vzc29yUGFyYW1ldGVyT2Zmc2V0KCkgewogICAgICAgIHJl\ndHVybiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEu\nQUNDRVNTX0ZJRUxEKSA/IDEgOiAwOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIHRoZSB7QGxpbmsgSW5zdHJ1Y3Rpb259cyB0byBsb2FkIHRoZSBpbnN0\nYW5jZSB0byBtb2RpZnkgb250byB0aGUKICAgICAqIHN0YWNrLCBhbmQgcmV0\ndXJuIGl0LiBJZiA8Y29kZT5mb3JTdGF0aWM8L2NvZGU+IGlzIHNldCwgdGhl\nbgogICAgICogPGNvZGU+Y29kZTwvY29kZT4gaXMgaW4gYW4gYWNjZXNzb3Ig\nbWV0aG9kIG9yIGFub3RoZXIgc3RhdGljIG1ldGhvZDsKICAgICAqIG90aGVy\nd2lzZSwgaXQgaXMgaW4gb25lIG9mIHRoZSBQQy1zcGVjaWZpZWQgbWV0aG9k\ncy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaXJzdCBpbnN0cnVjdGlv\nbiBhZGRlZCB0byA8Y29kZT5jb2RlPC9jb2RlPi4KICAgICAqLwogICAgcHJp\ndmF0ZSBJbnN0cnVjdGlvbiBsb2FkTWFuYWdlZEluc3RhbmNlKENvZGUgY29k\nZSwgYm9vbGVhbiBmb3JTdGF0aWMpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0\nQWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEICYm\nIGZvclN0YXRpYykKICAgICAgICAgICAgcmV0dXJuIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9hZCgpLnNldFRo\naXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgZ2VuZXJh\ndGVkIGdldHRlciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8L2Nv\nZGU+LiBUaGUKICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0aGVu\nIHBvcHVsYXRlIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAgICAqLwog\nICAgcHJpdmF0ZSBCQ01ldGhvZCBjcmVhdGVHZXRNZXRob2QoRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXI7CiAgICAgICAg\naWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFD\nQ0VTU19GSUVMRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgPGZpZWxkdHlw\nZT4gcGNHZXQ8ZmllbGQ+IChYWFggaW5zdCkKICAgICAgICAgICAgQkNGaWVs\nZCBmaWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXROYW1lKCkp\nOwogICAgICAgICAgICBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUg\nKyAiR2V0IiArIGZtZC5nZXROYW1lKCksIGZtZC4KICAgICAgICAgICAgICAg\nIGdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSwgbmV3IFN0cmluZ1tdeyBf\ncGMuZ2V0TmFtZSgpIH0pOwogICAgICAgICAgICBnZXR0ZXIuc2V0QWNjZXNz\nRmxhZ3MoZmllbGQuZ2V0QWNjZXNzRmxhZ3MoKQogICAgICAgICAgICAgICAg\nJiB+Q29uc3RhbnRzLkFDQ0VTU19UUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFD\nQ0VTU19WT0xBVElMRSk7CiAgICAgICAgICAgIGdldHRlci5zZXRTdGF0aWMo\ndHJ1ZSk7CiAgICAgICAgICAgIGdldHRlci5zZXRGaW5hbCh0cnVlKTsKICAg\nICAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgICAgICB9CgogICAgICAgIC8v\nIHByb3BlcnR5IGFjY2VzczoKICAgICAgICAvLyBjb3B5IHRoZSB1c2VyJ3Mg\nZ2V0dGVyIG1ldGhvZCB0byBhIG5ldyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJl\nc2V0CiAgICAgICAgLy8gdGhlIG5hbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFs\nc28gcmVzZXQgYWxsIGNhbGxzIHRvIHRoZSBtZXRob2QKICAgICAgICBNZXRo\nb2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAg\nICAgICAgZ2V0dGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0\nTmFtZSgpLAogICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkp\nOwogICAgICAgIEJDTWV0aG9kIG5ld2dldHRlciA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArIG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICBtZXRoLmdl\ndFJldHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAg\nICAgICBuZXdnZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZ2V0dGVyLmdldEFjY2Vz\nc0ZsYWdzKCkpOwogICAgICAgIG5ld2dldHRlci5tYWtlUHJvdGVjdGVkKCk7\nIAogICAgICAgIHRyYW5zZmVyQ29kZUF0dHJpYnV0ZXMoZ2V0dGVyLCBuZXdn\nZXR0ZXIpOwogICAgICAgIHJldHVybiBnZXR0ZXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgdGhlIGdlbmVyYXRlZCBzZXR0ZXIge0BsaW5rIEJD\nTWV0aG9kfSBmb3IgPGNvZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxs\naW5nIGVudmlyb25tZW50IHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhv\nZCdzIGNvZGUgYmxvY2suCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRob2Qg\nY3JlYXRlU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nQkNNZXRob2Qgc2V0dGVyOwogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAg\nICAgICAgLy8gc3RhdGljIHZvaWQgcGNTZXQ8ZmllbGQ+IChYWFggaW5zdCwg\nPGZpZWxkdHlwZT4gdmFsdWUpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQg\nPSBfcGMuZ2V0RGVjbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgc2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNldCIg\nKyBmbWQuZ2V0TmFtZSgpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAg\nbmV3IENsYXNzW117IGdldFR5cGUoX21ldGEpLCBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkgfSk7CiAgICAgICAgICAgIHNldHRlci5zZXRBY2Nlc3NGbGFncyhm\naWVsZC5nZXRBY2Nlc3NGbGFncygpCiAgICAgICAgICAgICAgICAmIH5Db25z\ndGFudHMuQUNDRVNTX1RSQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNTX1ZP\nTEFUSUxFKTsKICAgICAgICAgICAgc2V0dGVyLnNldFN0YXRpYyh0cnVlKTsK\nICAgICAgICAgICAgc2V0dGVyLnNldEZpbmFsKHRydWUpOwogICAgICAgICAg\nICByZXR1cm4gc2V0dGVyOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvcGVy\ndHkgYWNjZXNzOgogICAgICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0ZXIg\nbWV0aG9kIHRvIGEgbmV3IG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQKICAg\nICAgICAvLyB0aGUgbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyByZXNl\ndCBhbGwgY2FsbHMgdG8gdGhlIG1ldGhvZAogICAgICAgIHNldHRlciA9IF9w\nYy5nZXREZWNsYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7\nCiAgICAgICAgQkNNZXRob2QgbmV3c2V0dGVyID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgc2V0dGVyLmdldE5hbWUoKSwKICAgICAgICAgICAgc2V0dGVy\nLmdldFJldHVybk5hbWUoKSwgc2V0dGVyLmdldFBhcmFtTmFtZXMoKSk7CiAg\nICAgICAgbmV3c2V0dGVyLnNldEFjY2Vzc0ZsYWdzKHNldHRlci5nZXRBY2Nl\nc3NGbGFncygpKTsKICAgICAgICBuZXdzZXR0ZXIubWFrZVByb3RlY3RlZCgp\nOwogICAgICAgIHRyYW5zZmVyQ29kZUF0dHJpYnV0ZXMoc2V0dGVyLCBuZXdz\nZXR0ZXIpOwogICAgICAgIHJldHVybiBzZXR0ZXI7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGFkZEdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9uTWV0\naG9kKCkgewogICAgICAgIC8vIHB1YmxpYyBpbnQgZ2V0RW5oYW5jZW1lbnRD\nb250cmFjdFZlcnNpb24oKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArIAogICAgICAgICAgICAgICAgIkdldEVu\naGFuY2VtZW50Q29udHJhY3RWZXJzaW9uIiwgaW50LmNsYXNzLCBudWxsKTsK\nICAgICAgICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShFTkhBTkNFUl9WRVJTSU9OKTsKICAgICAgICBjb2Rl\nLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY29uY3JldGUgdHlwZSBmb3IgdGhl\nIGdpdmVuIGNsYXNzLCBpLmUuIGltcGwgZm9yIG1hbmFnZWQKICAgICAqIGlu\ndGVyZmFjZXMKICAgICAqLwogICAgcHVibGljIENsYXNzIGdldFR5cGUoQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SW50ZXJm\nYWNlSW1wbCgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtZXRhLmdl\ndEludGVyZmFjZUltcGwoKTsKICAgICAgICByZXR1cm4gbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNb3ZlIGNvZGUt\ncmVsYXRlZCBhdHRyaWJ1dGVzIGZyb20gb25lIG1ldGhvZCB0byBhbm90aGVy\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHRyYW5zZmVyQ29k\nZUF0dHJpYnV0ZXMoQkNNZXRob2QgZnJvbSwgQkNNZXRob2QgdG8pIHsKICAg\nICAgICBDb2RlIGNvZGUgPSBmcm9tLmdldENvZGUoZmFsc2UpOwogICAgICAg\nIGlmIChjb2RlICE9IG51bGwpIHsKICAgICAgICAgICAgdG8uYWRkQXR0cmli\ndXRlKGNvZGUpOwogICAgICAgICAgICBmcm9tLnJlbW92ZUNvZGUoKTsKICAg\nICAgICB9CgogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gZnJvbS5nZXRF\neGNlcHRpb25zKGZhbHNlKTsKICAgICAgICBpZiAoZXhjZXBzICE9IG51bGwp\nCiAgICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShleGNlcHMpOwogICAgfQoK\nICAgIC8qKgogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNoZS5vcGVuanBh\nLmVuaGFuY2UuUENFbmhhbmNlciBbb3B0aW9uXSoKICAgICAqICZsdDtjbGFz\ncyBuYW1lIHwgLmphdmEgZmlsZSB8IC5jbGFzcyBmaWxlIHwgLmpkbyBmaWxl\nJmd0OysKICAgICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJl\nIHJlY29nbml6ZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3Bl\ncnRpZXMvLXAgJmx0O3Byb3BlcnRpZXMgZmlsZSZndDs8L2k+OiBUaGUgcGF0\naCB0byBhIE9wZW5KUEEKICAgICAqIHByb3BlcnRpZXMgZmlsZSBjb250YWlu\naW5nIGluZm9ybWF0aW9uIGFzIG91dGxpbmVkIGluCiAgICAgKiB7QGxpbmsg\nQ29uZmlndXJhdGlvbn07IG9wdGlvbmFsLjwvbGk+CiAgICAgKiA8bGk+PGk+\nLSZsdDtwcm9wZXJ0eSBuYW1lJmd0OyAmbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7\nPC9pPjogQWxsIGJlYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIHN0YW5k\nYXJkIE9wZW5KUEEge0BsaW5rIE9wZW5KUEFDb25maWd1cmF0aW9ufSBjYW4g\nYmUKICAgICAqIHNldCBieSB1c2luZyB0aGVpciBuYW1lcyBhbmQgc3VwcGx5\naW5nIGEgdmFsdWU7IGZvciBleGFtcGxlOgogICAgICogPGxpPjxpPi1kaXJl\nY3RvcnkvLWQgJmx0O2J1aWxkIGRpcmVjdG9yeSZndDs8L2k+OiBUaGUgcGF0\naCB0byB0aGUgYmFzZQogICAgICogZGlyZWN0b3J5IHdoZXJlIGVuaGFuY2Vk\nIGNsYXNzZXMgYXJlIHN0b3JlZC4gQnkgZGVmYXVsdCwgdGhlCiAgICAgKiBl\nbmhhbmNlciBvdmVyd3JpdGVzIHRoZSBvcmlnaW5hbCAuY2xhc3MgZmlsZSB3\naXRoIHRoZSBlbmhhbmNlZAogICAgICogdmVyc2lvbi4gVXNlIHRoaXMgb3B0\naW9uIHRvIHN0b3JlIHRoZSBnZW5lcmF0ZWQgLmNsYXNzIGZpbGUgaW4KICAg\nICAqIGFub3RoZXIgZGlyZWN0b3J5LiBUaGUgcGFja2FnZSBzdHJ1Y3R1cmUg\nd2lsbCBiZSBjcmVhdGVkIGJlbmVhdGgKICAgICAqIHRoZSBnaXZlbiBkaXJl\nY3RvcnkuPC9saT4KICAgICAqIDxsaT48aT4tYWRkRGVmYXVsdENvbnN0cnVj\ndG9yLy1hZGMgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwog\nICAgICogYWRkIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciB0byBwZXJzaXN0ZW50\nIGNsYXNzZXMgbWlzc2luZyBvbmUsIGFzCiAgICAgKiBvcHBvc2VkIHRvIHRo\ncm93aW5nIGFuIGV4Y2VwdGlvbi4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgog\nICAgICogPGxpPjxpPi10bXBDbGFzc0xvYWRlci8tdGNsIFt0cnVlL3QgfCBm\nYWxzZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGxvYWQgdGhlIHByZS1l\nbmhhbmNlZCBjbGFzc2VzIHVzaW5nIGEgdGVtcG9yYXJ5IGNsYXNzIGxvYWRl\nci4KICAgICAqIERlZmF1bHRzIHRvIHRydWUuIFNldCB0aGlzIHRvIGZhbHNl\nIHdoZW4gYXR0ZW1wdGluZyB0byBkZWJ1ZwogICAgICogY2xhc3MgbG9hZGlu\nZyBlcnJvcnMuPC9saT4KICAgICAqIDxsaT48aT4tZW5mb3JjZVByb3BlcnR5\nUmVzdHJpY3Rpb25zLy1lcHIgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjoKICAg\nICAqIFdoZXRoZXIgdG8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgUFJPUEVS\nVFkgYWNjZXNzIGVudGl0eSBhcHBlYXJzCiAgICAgKiB0byBiZSB2aW9sYXRp\nbmcgc3RhbmRhcmQgcHJvcGVydHkgcmVzdHJpY3Rpb25zLiBEZWZhdWx0cyB0\nbyBmYWxzZS48L2xpPgogICAgICogPC91bD4KICAgICAqICBFYWNoIGFkZGl0\naW9uYWwgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgZnVsbCBjbGFzcyBu\nYW1lIG9mIHRoZQogICAgICogdHlwZSB0byBlbmhhbmNlLCB0aGUgcGF0aCB0\nbyB0aGUgLmphdmEgZmlsZSBmb3IgdGhlIHR5cGUsIHRoZSBwYXRoIHRvCiAg\nICAgKiB0aGUgLmNsYXNzIGZpbGUgZm9yIHRoZSB0eXBlLCBvciB0aGUgcGF0\naCB0byBhIC5qZG8gZmlsZSBsaXN0aW5nIG9uZQogICAgICogb3IgbW9yZSB0\neXBlcyB0byBlbmhhbmNlLgogICAgICogSWYgdGhlIHR5cGUgYmVpbmcgZW5o\nYW5jZWQgaGFzIG1ldGFkYXRhLCBpdCB3aWxsIGJlIGVuaGFuY2VkIGFzIGEK\nICAgICAqIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3MuIElmIG5vdCwgaXQg\nd2lsbCBiZSBjb25zaWRlcmVkIGEgcGVyc2lzdGVuY2UKICAgICAqIGF3YXJl\nIGNsYXNzLCBhbmQgYWxsIGFjY2VzcyB0byBmaWVsZHMgb2YgcGVyc2lzdGVu\nY2UgY2FwYWJsZSBjbGFzc2VzCiAgICAgKiB3aWxsIGJlIHJlcGxhY2VkIGJ5\nIHRoZSBhcHByb3ByaWF0ZQlnZXQvc2V0IG1ldGhvZC4gSWYgdGhlIHR5cGUK\nICAgICAqIGV4cGxpY2l0bHkgZGVjbGFyZXMgdGhlIHBlcnNpc3RlbmNlLWNh\ncGFibGUgaW50ZXJmYWNlLCBpdCB3aWxsCiAgICAgKiBub3QgYmUgZW5oYW5j\nZWQuIFRodXMsIGl0IGlzIHNhZmUgdG8gaW52b2tlIHRoZSBlbmhhbmNlciBv\nbiBjbGFzc2VzCiAgICAgKiB0aGF0IGFyZSBhbHJlYWR5IGVuaGFuY2VkLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBh\ncmdzKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgT3B0\naW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBhcmdzID0gb3B0\ncy5zZXRGcm9tQ21kTGluZShhcmdzKTsKICAgICAgICBPcGVuSlBBQ29uZmln\ndXJhdGlvbiBjb25mID0gbmV3IE9wZW5KUEFDb25maWd1cmF0aW9uSW1wbCgp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghcnVuKGNvbmYsIGFy\nZ3MsIG9wdHMpKQogICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxu\nKF9sb2MuZ2V0KCJlbmhhbmNlLXVzYWdlIikpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFsc2Ug\naWYgaW52YWxpZCBvcHRpb25zIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRzKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9wdHMuY29udGFp\nbnNLZXkoImhlbHAiKSB8fCBvcHRzLmNvbnRhaW5zS2V5KCItaGVscCIpKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEZsYWdzIGZsYWdz\nID0gbmV3IEZsYWdzKCk7CiAgICAgICAgZmxhZ3MuZGlyZWN0b3J5ID0gRmls\nZXMuZ2V0RmlsZShvcHRzLnJlbW92ZVByb3BlcnR5KCJkaXJlY3RvcnkiLCAi\nZCIsCiAgICAgICAgICAgIG51bGwpLCBudWxsKTsKICAgICAgICBmbGFncy5h\nZGREZWZhdWx0Q29uc3RydWN0b3IgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9w\nZXJ0eQogICAgICAgICAgICAoImFkZERlZmF1bHRDb25zdHJ1Y3RvciIsICJh\nZGMiLCBmbGFncy5hZGREZWZhdWx0Q29uc3RydWN0b3IpOwogICAgICAgIGZs\nYWdzLnRtcENsYXNzTG9hZGVyID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVy\ndHkKICAgICAgICAgICAgKCJ0bXBDbGFzc0xvYWRlciIsICJ0Y2wiLCBmbGFn\ncy50bXBDbGFzc0xvYWRlcik7CiAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3Bl\ncnR5UmVzdHJpY3Rpb25zID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkK\nICAgICAgICAgICAgKCJlbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMiLCAi\nZXByIiwKICAgICAgICAgICAgICAgIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJl\nc3RyaWN0aW9ucyk7CgogICAgICAgIENvbmZpZ3VyYXRpb25zLnBvcHVsYXRl\nQ29uZmlndXJhdGlvbihjb25mLCBvcHRzKTsKICAgICAgICByZXR1cm4gcnVu\nKGNvbmYsIGFyZ3MsIGZsYWdzLCBudWxsLCBudWxsLCBudWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEVuaGFuY2UgdGhlIGdpdmVuIGNsYXNzZXMuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQQUNv\nbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBGbGFn\ncyBmbGFncywgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zLCBCeXRlY29kZVdy\naXRlciB3cml0ZXIsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxvYWRlciA9\nPSBudWxsKQogICAgICAgICAgICBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVz\nb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0Q2xhc3NMb2Fk\nZXIoUENFbmhhbmNlci5jbGFzcywgbnVsbCk7CiAgICAgICAgaWYgKGZsYWdz\nLnRtcENsYXNzTG9hZGVyKQogICAgICAgICAgICBsb2FkZXIgPSAoQ2xhc3NM\nb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2\nSGVscGVyCiAgICAgICAgICAgICAgICAubmV3VGVtcG9yYXJ5Q2xhc3NMb2Fk\nZXJBY3Rpb24obG9hZGVyKSk7CgogICAgICAgIGlmIChyZXBvcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIHJlcG9zID0gY29uZi5uZXdNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICByZXBvcy5zZXRTb3VyY2VN\nb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01FVEEpOwogICAgICAgIH0K\nCiAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19UT09MKTsKICAgICAgICBDb2xsZWN0aW9uIGNsYXNzZXM7\nCiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDApIHsKICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoInJ1bm5pbmctYWxsLWNsYXNzZXMiKSk7CiAg\nICAgICAgICAgIGNsYXNzZXMgPSByZXBvcy5nZXRQZXJzaXN0ZW50VHlwZU5h\nbWVzKHRydWUsIGxvYWRlcik7CiAgICAgICAgICAgIGlmIChjbGFzc2VzID09\nIG51bGwpIHsKICAgICAgICAgICAgCWxvZy53YXJuKF9sb2MuZ2V0KCJuby1j\nbGFzcy10by1lbmhhbmNlIikpOwogICAgICAgICAgICAJcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nQ2xhc3NBcmdQYXJzZXIgY2FwID0gY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0\nb3J5KCkubmV3Q2xhc3NBcmdQYXJzZXIoKTsKICAgICAgICAgICAgY2FwLnNl\ndENsYXNzTG9hZGVyKGxvYWRlcik7CiAgICAgICAgICAgIGNsYXNzZXMgPSBu\nZXcgSGFzaFNldCgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjbGFzc2VzLmFk\nZEFsbChBcnJheXMuYXNMaXN0KGNhcC5wYXJzZVR5cGVzKGFyZ3NbaV0pKSk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIFByb2plY3QgcHJvamVjdCA9\nIG5ldyBQcm9qZWN0KCk7CiAgICAgICAgQkNDbGFzcyBiYzsKICAgICAgICBQ\nQ0VuaGFuY2VyIGVuaGFuY2VyOwogICAgICAgIGludCBzdGF0dXM7CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBjbGFzc2VzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE9iamVjdCBvID0gaXRyLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLXJ1\nbm5pbmciLCBvKSk7CgogICAgICAgICAgICBpZiAobyBpbnN0YW5jZW9mIFN0\ncmluZykKICAgICAgICAgICAgICAgIGJjID0gcHJvamVjdC5sb2FkQ2xhc3Mo\nKFN0cmluZykgbywgbG9hZGVyKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoQ2xhc3MpIG8pOwog\nICAgICAgICAgICBlbmhhbmNlciA9IG5ldyBQQ0VuaGFuY2VyKGNvbmYsIGJj\nLCByZXBvcywgbG9hZGVyKTsKICAgICAgICAgICAgaWYgKHdyaXRlciAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgZW5oYW5jZXIuc2V0Qnl0ZWNvZGVXcml0\nZXIod3JpdGVyKTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0RGlyZWN0b3J5\nKGZsYWdzLmRpcmVjdG9yeSk7CiAgICAgICAgICAgIGVuaGFuY2VyLnNldEFk\nZERlZmF1bHRDb25zdHJ1Y3RvcihmbGFncy5hZGREZWZhdWx0Q29uc3RydWN0\nb3IpOwogICAgICAgICAgICBzdGF0dXMgPSBlbmhhbmNlci5ydW4oKTsKICAg\nICAgICAgICAgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX05PTkUpIHsKICAgICAg\nICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2Utbm9ydW4i\nKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09IEVOSEFOQ0Vf\nSU5URVJGQUNFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJlbmhhbmNlLWludGVyZmFjZSIpKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9BV0FSRSkgewogICAgICAgICAgICAg\nICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1hd2FyZSIpKTsKICAg\nICAgICAgICAgICAgIGVuaGFuY2VyLnJlY29yZCgpOwogICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgIGVuaGFuY2VyLnJlY29yZCgpOwogICAg\nICAgICAgICBwcm9qZWN0LmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUnVuIGZsYWdzLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEZsYWdzIHsKCiAgICAg\nICAgcHVibGljIEZpbGUgZGlyZWN0b3J5ID0gbnVsbDsKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IgPSB0cnVlOwogICAg\nICAgIHB1YmxpYyBib29sZWFuIHRtcENsYXNzTG9hZGVyID0gdHJ1ZTsKCQlw\ndWJsaWMgYm9vbGVhbiBlbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMgPSBm\nYWxzZTsKCX0KCgkvKioKIAkgKiBQbHVnaW4gaW50ZXJmYWNlIGZvciBhZGRp\ndGlvbmFsIGVuaGFuY2VtZW50LgoJICovCglwdWJsaWMgc3RhdGljIGludGVy\nZmFjZSBBdXhpbGlhcnlFbmhhbmNlcgoJewoJCXB1YmxpYyB2b2lkIHJ1biAo\nQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRhKTsKCQlwdWJsaWMgYm9v\nbGVhbiBza2lwRW5oYW5jZShCQ01ldGhvZCBtKTsKCX0KfQo=\n","encoding":"base64"}

