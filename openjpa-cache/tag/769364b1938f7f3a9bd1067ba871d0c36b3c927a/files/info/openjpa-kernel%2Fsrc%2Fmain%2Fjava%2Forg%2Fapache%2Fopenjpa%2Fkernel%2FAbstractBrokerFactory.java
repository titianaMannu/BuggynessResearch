{"sha":"aff638325b17173df75256f8049ba284e12524ce","node_id":"MDQ6QmxvYjIwNjM2NDphZmY2MzgzMjViMTcxNzNkZjc1MjU2ZjgwNDliYTI4NGUxMjUyNGNl","size":28380,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/aff638325b17173df75256f8049ba284e12524ce","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlByb3BlcnRpZXM7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN0YXR1czsKaW1w\nb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN5bmNocm9uaXphdGlvbjsKaW1wb3J0\nIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uOwppbXBvcnQgamF2YXgu\ndHJhbnNhY3Rpb24uVHJhbnNhY3Rpb25NYW5hZ2VyOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBVmVyc2lvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlU3Rv\ncmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVlLk1hbmFn\nZWRSdW50aW1lOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2Uu\nUENSZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNl\nLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5ldmVudC5SZW1vdGVDb21taXRFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuQnJva2VyRmFjdG9yeUV2ZW50OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KYXZhVmVyc2lvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVu\ndC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRSZWZlcmVuY2VIYXNo\nU2V0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1\ncnJlbnQuUmVlbnRyYW50TG9jazsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0\naW9uOwoKLyoqCiAqIEFic3RyYWN0IGltcGxlbWVudGF0aW9uIG9mIHRoZSB7\nQGxpbmsgQnJva2VyRmFjdG9yeX0KICogdGhhdCBtdXN0IGJlIHN1YmNsYXNz\nZWQgZm9yIGEgc3BlY2lmaWMgcnVudGltZS4KICoKICogQGF1dGhvciBBYmUg\nV2hpdGUKICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdEJyb2tl\nckZhY3RvcnkKICAgIGltcGxlbWVudHMgQnJva2VyRmFjdG9yeSB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZQogICAgICAgIChBYnN0cmFjdEJyb2tlckZhY3Rvcnku\nY2xhc3MpOwoKICAgIC8vIHN0YXRpYyBtYXBwaW5nIG9mIGNvbmZpZ3VyYXRp\nb25zIHRvIHBvb2xlZCBicm9rZXIgZmFjdG9yaWVzCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBNYXAgX3Bvb2wgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6\nZWRNYXAobmV3IEhhc2hNYXAoKSk7CgogICAgLy8gY29uZmlndXJhdGlvbgog\nICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZjsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX3JlYWRPbmx5ID0gZmFs\nc2U7CiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9jbG9zZWQgPSBm\nYWxzZTsKICAgIHByaXZhdGUgdHJhbnNpZW50IFJ1bnRpbWVFeGNlcHRpb24g\nX2Nsb3NlZEV4Y2VwdGlvbiA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfdXNl\nck9iamVjdHMgPSBudWxsOwoKICAgIC8vIGludGVybmFsIGxvY2s6IHNwZWMg\nZm9yYmlkcyBzeW5jaHJvbml6YXRpb24gb24gdGhpcyBvYmplY3QKICAgIHBy\naXZhdGUgZmluYWwgUmVlbnRyYW50TG9jayBfbG9jayA9IG5ldyBSZWVudHJh\nbnRMb2NrKCk7CgogICAgLy8gbWFwcyBnbG9iYWwgdHJhbnNhY3Rpb25zIHRv\nIGFzc29jaWF0ZWQgYnJva2VycwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29u\nY3VycmVudEhhc2hNYXAgX3RyYW5zYWN0aW9uYWwKICAgICAgICA9IG5ldyBD\nb25jdXJyZW50SGFzaE1hcCgpOwoKICAgIC8vIHdlYWstcmVmIHRyYWNraW5n\nIG9mIG9wZW4gYnJva2VycwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29sbGVj\ndGlvbiBfYnJva2VycyA9IG5ldyBDb25jdXJyZW50UmVmZXJlbmNlSGFzaFNl\ndAogICAgICAgIChDb25jdXJyZW50UmVmZXJlbmNlSGFzaFNldC5XRUFLKTsK\nCiAgICAvLyBjYWNoZSB0aGUgY2xhc3MgbmFtZXMgbG9hZGVkIGZyb20gdGhl\nIHBlcnNpc3RlbnQgY2xhc3NlcyBwcm9wZXJ0eSBzbwogICAgLy8gdGhhdCB3\nZSBjYW4gcmUtbG9hZCB0aGVtIGZvciBlYWNoIG5ldyBicm9rZXIKICAgIHBy\naXZhdGUgdHJhbnNpZW50IENvbGxlY3Rpb24gX3BjQ2xhc3NOYW1lcyA9IG51\nbGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBDb2xsZWN0aW9uIF9wY0NsYXNz\nTG9hZGVycyA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFu\nIF9wZXJzaXN0ZW50VHlwZXNMb2FkZWQgPSBmYWxzZTsKCiAgICAvLyBsaWZl\nY3ljbGUgbGlzdGVuZXJzIHRvIHBhc3MgdG8gZWFjaCBicm9rZXIKICAgIHBy\naXZhdGUgdHJhbnNpZW50IE1hcCBfbGlmZWN5Y2xlTGlzdGVuZXJzID0gbnVs\nbDsKCiAgICAvLyB0cmFuc2FjdGlvbiBsaXN0ZW5lcnMgdG8gcGFzcyB0byBl\nYWNoIGJyb2tlcgogICAgcHJpdmF0ZSB0cmFuc2llbnQgTGlzdCBfdHJhbnNh\nY3Rpb25MaXN0ZW5lcnMgPSBudWxsOwoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBwb29sZWQgZmFjdG9yeSBtYXRjaGluZyB0aGUgZ2l2ZW4gY29uZmln\ndXJhdGlvbiwgb3IgbnVsbAogICAgICogaWYgbm9uZS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBBYnN0cmFjdEJyb2tlckZhY3RvcnkgZ2V0UG9vbGVk\nRmFjdG9yeSgKICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mKSB7\nCiAgICAgICAgcmV0dXJuIChBYnN0cmFjdEJyb2tlckZhY3RvcnkpIF9wb29s\nLmdldCh0b1Bvb2xLZXkoY29uZikpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGFuIGludGVybmFsIGZhY3RvcnkgcG9vbCBrZXkgZm9yIHRoZSBn\naXZlbiBjb25maWd1cmF0aW9uLgogICAgICogV2UgdXNlIHRoZSBjb25mIHBy\nb3BlcnRpZXMgYXMgZ2l2ZW4gYnkgdGhlIHVzZXIgYmVjYXVzZSB0aGF0IGlz\nIHdoYXQncwogICAgICogcGFzc2VkIHRvIHtAbGluayAjZ2V0UG9vbGVkRmFj\ndG9yeX0gd2hlbiBsb29raW5nIGZvciBhbiBleGlzdGluZyBmYWN0b3J5Lgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBNYXAgdG9Qb29sS2V5KE9wZW5K\nUEFDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICByZXR1cm4gY29uZi50\nb1Byb3BlcnRpZXMoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBwb29sZWQgZmFjdG9yeSBtYXRjaGluZyB0aGUgZ2l2ZW4gY29u\nZmlndXJhdGlvbiBkYXRhLCBvciBudWxsCiAgICAgKiBpZiBub25lLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIEFic3RyYWN0QnJva2VyRmFjdG9y\neSBnZXRQb29sZWRGYWN0b3J5KE1hcCBtYXApIHsKICAgICAgICByZXR1cm4g\nKEFic3RyYWN0QnJva2VyRmFjdG9yeSkgX3Bvb2wuZ2V0KG1hcCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gQ29uZmlndXJhdGlvbiBt\ndXN0IGJlIHByb3ZpZGVkIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEFic3RyYWN0QnJva2VyRmFjdG9yeShPcGVuSlBBQ29uZmln\ndXJhdGlvbiBjb25maWcpIHsKICAgICAgICBfY29uZiA9IGNvbmZpZzsKICAg\nICAgICBfcGNDbGFzc0xvYWRlcnMgPSBuZXcgQ29uY3VycmVudFJlZmVyZW5j\nZUhhc2hTZXQoCiAgICAgICAgICAgIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNo\nU2V0LldFQUspOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBj\nb25maWd1cmF0aW9uIGZvciB0aGlzIGZhY3RvcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkg\newogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgQnJv\na2VyIG5ld0Jyb2tlcigpIHsKICAgICAgICByZXR1cm4gbmV3QnJva2VyKF9j\nb25mLmdldENvbm5lY3Rpb25Vc2VyTmFtZSgpLAogICAgICAgICAgICBfY29u\nZi5nZXRDb25uZWN0aW9uUGFzc3dvcmQoKSk7CiAgICB9CgogICAgcHVibGlj\nIEJyb2tlciBuZXdCcm9rZXIoU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7\nCiAgICAgICAgcmV0dXJuIG5ld0Jyb2tlcih1c2VyLCBwYXNzLCBfY29uZi5p\nc1RyYW5zYWN0aW9uTW9kZU1hbmFnZWQoKSwKICAgICAgICAgICAgX2NvbmYu\nZ2V0Q29ubmVjdGlvblJldGFpbk1vZGVDb25zdGFudCgpKTsKICAgIH0KCiAg\nICBwdWJsaWMgQnJva2VyIG5ld0Jyb2tlcihib29sZWFuIG1hbmFnZWQsIGlu\ndCBjb25uUmV0YWluTW9kZSkgewogICAgICAgIHJldHVybiBuZXdCcm9rZXIo\nX2NvbmYuZ2V0Q29ubmVjdGlvblVzZXJOYW1lKCksCiAgICAgICAgICAgIF9j\nb25mLmdldENvbm5lY3Rpb25QYXNzd29yZCgpLCBtYW5hZ2VkLCBjb25uUmV0\nYWluTW9kZSk7CiAgICB9CgogICAgcHVibGljIEJyb2tlciBuZXdCcm9rZXIo\nU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzLCBib29sZWFuIG1hbmFnZWQsCiAg\nICAgICAgaW50IGNvbm5SZXRhaW5Nb2RlKSB7CiAgICAgICAgcmV0dXJuIG5l\nd0Jyb2tlcih1c2VyLCBwYXNzLCBtYW5hZ2VkLCBjb25uUmV0YWluTW9kZSwg\ndHJ1ZSk7CiAgICB9CgogICAgcHVibGljIEJyb2tlciBuZXdCcm9rZXIoU3Ry\naW5nIHVzZXIsIFN0cmluZyBwYXNzLCBib29sZWFuIG1hbmFnZWQsCiAgICAg\nICAgaW50IGNvbm5SZXRhaW5Nb2RlLCBib29sZWFuIGZpbmRFeGlzdGluZykg\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgbWFrZVJlYWRPbmx5KCk7CgogICAgICAgICAgICBCcm9rZXJJ\nbXBsIGJyb2tlciA9IG51bGw7CiAgICAgICAgICAgIGlmIChmaW5kRXhpc3Rp\nbmcpCiAgICAgICAgICAgICAgICBicm9rZXIgPSBmaW5kQnJva2VyKHVzZXIs\nIHBhc3MsIG1hbmFnZWQpOwogICAgICAgICAgICBpZiAoYnJva2VyID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIC8vIGRlY29yYXRlIHRoZSBzdG9yZSBt\nYW5hZ2VyIGZvciBkYXRhIGNhY2hpbmcgYW5kIGN1c3RvbQogICAgICAgICAg\nICAgICAgLy8gcmVzdWx0IG9iamVjdCBwcm92aWRlcnM7IGFsd2F5cyBtYWtl\nIHN1cmUgaXQncyBhIGRlbGVnYXRpbmcKICAgICAgICAgICAgICAgIC8vIHN0\nb3JlIG1hbmFnZXIsIGJlY2F1c2UgaXQncyBlYXNpZXIgZm9yIHVzZXJzIHRv\nIGRlYWwgd2l0aAogICAgICAgICAgICAgICAgLy8gdGhhdCB3YXkKICAgICAg\nICAgICAgICAgIFN0b3JlTWFuYWdlciBzbSA9IG5ld1N0b3JlTWFuYWdlcigp\nOwogICAgICAgICAgICAgICAgRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBkc20g\nPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKF9jb25mLmdldERhdGFDYWNo\nZU1hbmFnZXJJbnN0YW5jZSgpLmdldFN5c3RlbURhdGFDYWNoZSgpCiAgICAg\nICAgICAgICAgICAgICAgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBk\nc20gPSBuZXcgRGF0YUNhY2hlU3RvcmVNYW5hZ2VyKHNtKTsKICAgICAgICAg\nICAgICAgIGRzbSA9IG5ldyBST1BTdG9yZU1hbmFnZXIoKGRzbSA9PSBudWxs\nKSA/IHNtIDogZHNtKTsKCiAgICAgICAgICAgICAgICBicm9rZXIgPSBuZXdC\ncm9rZXJJbXBsKHVzZXIsIHBhc3MpOwogICAgICAgICAgICAgICAgYnJva2Vy\nLmluaXRpYWxpemUodGhpcywgZHNtLCBtYW5hZ2VkLCBjb25uUmV0YWluTW9k\nZSk7CiAgICAgICAgICAgICAgICBhZGRMaXN0ZW5lcnMoYnJva2VyKTsKCiAg\nICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSB1c2luZyByZW1vdGUgZXZlbnRz\nLCByZWdpc3RlciB0aGUgZXZlbnQgbWFuYWdlciBzbwogICAgICAgICAgICAg\nICAgLy8gdGhhdCBpdCBjYW4gYnJvYWRjYXN0IGNvbW1pdCBub3RpZmljYXRp\nb25zIGZyb20gdGhlIGJyb2tlcgogICAgICAgICAgICAgICAgUmVtb3RlQ29t\nbWl0RXZlbnRNYW5hZ2VyIHJlbW90ZSA9IF9jb25mLgogICAgICAgICAgICAg\nICAgICAgIGdldFJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcigpOwogICAgICAg\nICAgICAgICAgaWYgKHJlbW90ZS5hcmVSZW1vdGVFdmVudHNFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgYnJva2VyLmFkZFRyYW5zYWN0aW9uTGlz\ndGVuZXIocmVtb3RlKTsKCiAgICAgICAgICAgICAgICBsb2FkUGVyc2lzdGVu\ndFR5cGVzKGJyb2tlci5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBfYnJva2Vycy5hZGQoYnJva2VyKTsKCiAgICAgICAg\nICAgIHJldHVybiBicm9rZXI7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgZmFjdG9yeS1yZWdpc3RlcmVkIGxpZmVj\neWNsZSBsaXN0ZW5lcnMgdG8gdGhlIGJyb2tlci4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgYWRkTGlzdGVuZXJzKEJyb2tlckltcGwgYnJva2VyKSB7\nCiAgICAgICAgaWYgKF9saWZlY3ljbGVMaXN0ZW5lcnMgIT0gbnVsbCAmJiAh\nX2xpZmVjeWNsZUxpc3RlbmVycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nTWFwLkVudHJ5IGVudHJ5OwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IF9saWZlY3ljbGVMaXN0ZW5lcnMuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOwogICAgICAgICAgICAgICAgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGJyb2tlci5hZGRMaWZlY3ljbGVMaXN0ZW5lcihlbnRyeS5n\nZXRLZXkoKSwgKENsYXNzW10pCiAgICAgICAgICAgICAgICAgICAgZW50cnku\nZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIGlmIChfdHJhbnNhY3Rpb25MaXN0ZW5lcnMgIT0gbnVsbCAmJiAhX3RyYW5z\nYWN0aW9uTGlzdGVuZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IF90cmFuc2FjdGlvbkxpc3RlbmVycy5pdGVyYXRv\ncigpOwogICAgICAgICAgICAgICAgaXRyLmhhc05leHQoKTsgKSB7CiAgICAg\nICAgICAgICAgICBicm9rZXIuYWRkVHJhbnNhY3Rpb25MaXN0ZW5lcihpdHIu\nbmV4dCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIExvYWQgdGhlIGNvbmZpZ3VyZWQgcGVyc2lzdGVudCBjbGFz\nc2VzIGxpc3QuIFBlcmZvcm1lZCBhdXRvbWF0aWNhbGx5CiAgICAgKiB3aGVu\nZXZlciBhIGJyb2tlciBpcyBjcmVhdGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgbG9hZFBlcnNpc3RlbnRUeXBlcyhDbGFzc0xvYWRlciBlbnZMb2Fk\nZXIpIHsKICAgICAgICAvLyBpZiB3ZSd2ZSBsb2FkZWQgdGhlIHBlcnNpc3Rl\nbnQgdHlwZXMgYW5kIHRoZSBjbGFzcyBuYW1lIGxpc3QKICAgICAgICAvLyBp\ncyBlbXB0eSwgdGhlbiB3ZSBjYW4gc2ltcGx5IHJldHVybi4gTm90ZSB0aGF0\nIHRoZXJlIGlzIGEKICAgICAgICAvLyBwb3RlbnRpYWwgdGhyZWFkaW5nIHNj\nZW5hcmlvIGluIHdoaWNoIF9wZXJzaXN0ZW50VHlwZXNMb2FkZWQgaXMKICAg\nICAgICAvLyBmYWxzZSB3aGVuIHJlYWQsIGJ1dCB0aGUgd29yayB0byBwb3B1\nbGF0ZSBfcGNDbGFzc05hbWVzIGhhcwogICAgICAgIC8vIGFscmVhZHkgYmVl\nbiBkb25lLiBUaGlzIGlzIG9rOyBfcGNDbGFzc05hbWVzIGNhbiB0b2xlcmF0\nZQogICAgICAgIC8vIGNvbmN1cnJlbnQgYWNjZXNzLCBzbyB0aGUgd29yc3Qg\nY2FzZSBpcyB0aGF0IHRoZSBsaXN0IGlzCiAgICAgICAgLy8gcGVyc2lzdGVu\ndCB0eXBlIGRhdGEgaXMgcHJvY2Vzc2VkIG11bHRpcGxlIHRpbWVzLCB3aGlj\naCB0aGlzCiAgICAgICAgLy8gYWxnb3JpdGhtIHRha2VzIGludG8gYWNjb3Vu\ndC4KICAgICAgICBpZiAoX3BlcnNpc3RlbnRUeXBlc0xvYWRlZCAmJiBfcGND\nbGFzc05hbWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBjYWNoZSBwZXJzaXN0ZW50IHR5cGUgbmFtZXMgaWYgbm90IGFs\ncmVhZHkKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSBfY29uZi5nZXRD\nbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0Q2xhc3NM\nb2FkZXIoZ2V0Q2xhc3MoKSwgZW52TG9hZGVyKTsKICAgICAgICBDb2xsZWN0\naW9uIHRvUmVkZWZpbmUgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgaWYg\nKCFfcGVyc2lzdGVudFR5cGVzTG9hZGVkKSB7CiAgICAgICAgICAgIENvbGxl\nY3Rpb24gY2xzcyA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCkuCiAgICAgICAgICAgICAgICBsb2FkUGVyc2lzdGVudFR5cGVzKGZh\nbHNlLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAoY2xzcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICBfcGNDbGFzc05hbWVzID0gQ29sbGVjdGlvbnMu\nRU1QVFlfU0VUOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAg\nIENvbGxlY3Rpb24gYyA9IG5ldyBBcnJheUxpc3QoY2xzcy5zaXplKCkpOwog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjbHNzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAg\nQ2xhc3MgY2xzID0gKENsYXNzKSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgICAgIGMuYWRkKGNscy5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChuZWVkc1N1YihjbHMpKQogICAgICAgICAgICAgICAgICAgICAg\nICB0b1JlZGVmaW5lLmFkZChjbHMpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgX3BjQ2xhc3NMb2FkZXJzLmFkZChsb2FkZXIpOwogICAg\nICAgICAgICAgICAgX3BjQ2xhc3NOYW1lcyA9IGM7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgX3BlcnNpc3RlbnRUeXBlc0xvYWRlZCA9IHRydWU7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVsb2FkIHdpdGggdGhp\ncyBsb2FkZXIKICAgICAgICAgICAgaWYgKF9wY0NsYXNzTG9hZGVycy5hZGQo\nbG9hZGVyKSkgewogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBfcGNDbGFzc05hbWVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgQ2xhc3MgY2xzID0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIENsYXNzLmZvck5hbWUoKFN0cmluZykgaXRyLm5leHQoKSwgdHJ1ZSwgbG9h\nZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZWRzU3ViKGNs\ncykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1JlZGVmaW5lLmFk\nZChjbHMpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb25mLmdldExvZyhP\ncGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC53YXJuKG51bGwsIHQpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgaWYgKEphdmFWZXJzaW9ucy5WRVJTSU9OID49IDUp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFRoaXMg\naXMgSmF2YSA1IC8gNiBjb2RlLiBUaGVyZSBtaWdodCBiZSBhIG1vcmUgZWxl\nZ2FudAogICAgICAgICAgICAgICAgLy8gd2F5IHRvIGJvb3RzdHJhcCB0aGlz\nIGludG8gdGhlIHN5c3RlbSwgYnV0IHJlZmxlY3Rpb24KICAgICAgICAgICAg\nICAgIC8vIHdpbGwgZ2V0IHRoaW5ncyB3b3JraW5nIGZvciBub3cuIFdlIGNv\ndWxkIHBvdGVudGlhbGx5CiAgICAgICAgICAgICAgICAvLyBkbyB0aGlzIGJ5\nIGNyZWF0aW5nIGEgbmV3IEJyb2tlckZhY3RvcnlFdmVudCB0eXBlIGZvcgog\nICAgICAgICAgICAgICAgLy8gQnJva2VyIGNyZWF0aW9uLCBhdCB3aGljaCBw\nb2ludCB3ZSBoYXZlIGFuIGFwcHJvcHJpYXRlCiAgICAgICAgICAgICAgICAv\nLyBjbGFzc2xvYWRlciB0byB1c2UuCiAgICAgICAgICAgICAgICBDbGFzcyBj\nbHMgPSBDbGFzcy5mb3JOYW1lKAogICAgICAgICAgICAgICAgICAgICJvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5NYW5hZ2VkQ2xhc3NTdWJjbGFzc2Vy\nIik7CiAgICAgICAgICAgICAgICBjbHMuZ2V0TWV0aG9kKCJwcmVwYXJlVW5l\nbmhhbmNlZENsYXNzZXMiLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uLmNsYXNzLCBDb2xsZWN0\naW9uLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBDbGFzc0xvYWRl\nci5jbGFzcwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAg\nICAgICAgLmludm9rZShudWxsLCBuZXcgT2JqZWN0W117IF9jb25mLCB0b1Jl\nZGVmaW5lLCBlbnZMb2FkZXIgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBz\naG91bGQgbmV2ZXIgaGFwcGVuIGluIGEgcHJvcGVybHktYnVpbHQgaW5zdGFs\nbGF0aW9uCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVnYWxBY2Nlc3NF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgLy8gc2hvdWxkIG5ldmVy\nIGhhcHBlbiBpbiBhIHByb3Blcmx5LWJ1aWx0IGluc3RhbGxhdGlvbgogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUpOwog\nICAgICAgICAgICB9IGNhdGNoIChJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIFRocm93YWJsZSBjYXVzZSA9IGUuZ2V0\nQ2F1c2UoKTsKICAgICAgICAgICAgICAgIGlmIChjYXVzZSBpbnN0YW5jZW9m\nIE9wZW5KUEFFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nKE9wZW5KUEFFeGNlcHRpb24pIGNhdXNlOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbihjYXVzZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91\nbmRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgLy8gc2hvdWxkIG5l\ndmVyIGhhcHBlbiBpbiBhIHByb3Blcmx5LWJ1aWx0IGluc3RhbGxhdGlvbgog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nYm9vbGVhbiBuZWVkc1N1YihDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4g\nIWNscy5pc0ludGVyZmFjZSgpCiAgICAgICAgICAgICYmICFQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGFkZExpZmVjeWNsZUxpc3RlbmVyKE9iamVjdCBs\naXN0ZW5lciwgQ2xhc3NbXSBjbGFzc2VzKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgaWYgKF9saWZlY3ljbGVMaXN0ZW5lcnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9saWZlY3ljbGVMaXN0ZW5lcnMgPSBuZXcgSGFzaE1hcCg3\nKTsKICAgICAgICAgICAgX2xpZmVjeWNsZUxpc3RlbmVycy5wdXQobGlzdGVu\nZXIsIGNsYXNzZXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBy\nZW1vdmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgICAgICBpZiAoX2xpZmVjeWNsZUxpc3RlbmVycyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2xpZmVjeWNsZUxpc3RlbmVycy5y\nZW1vdmUobGlzdGVuZXIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBhZGRUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lcikgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfdHJhbnNhY3Rpb25MaXN0ZW5l\ncnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF90cmFuc2FjdGlvbkxpc3Rl\nbmVycyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgICAgIF90cmFuc2Fj\ndGlvbkxpc3RlbmVycy5hZGQobGlzdGVuZXIpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByZW1vdmVUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVj\ndCBsaXN0ZW5lcikgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfdHJh\nbnNhY3Rpb25MaXN0ZW5lcnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF90\ncmFuc2FjdGlvbkxpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGJy\nb2tlciBmYWN0b3J5IGlzIGNsb3NlZC4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZWQ7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgYXNzZXJ0Tm9BY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAg\nICAgICAgLy8gcmVtb3ZlIGZyb20gZmFjdG9yeSBwb29sCiAgICAgICAgICAg\nIE1hcCBtYXAgPSB0b1Bvb2xLZXkoX2NvbmYpOwogICAgICAgICAgICBzeW5j\naHJvbml6ZWQgKF9wb29sKSB7CiAgICAgICAgICAgICAgICBpZiAoX3Bvb2wu\nZ2V0KG1hcCkgPT0gdGhpcykKICAgICAgICAgICAgICAgICAgICBfcG9vbC5y\nZW1vdmUobWFwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2xv\nc2UgYWxsIGJyb2tlcnMKICAgICAgICAgICAgQnJva2VyIGJyb2tlcjsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfYnJva2Vycy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgYnJva2Vy\nID0gKEJyb2tlcikgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIC8vIENo\nZWNrIGZvciBudWxsIGJlY2F1c2UgX2Jyb2tlcnMgY29udGFpbnMgd2VhayBy\nZWZlcmVuY2VzCiAgICAgICAgICAgICAgICBpZiAoKGJyb2tlciAhPSBudWxs\nKSAmJiAoIWJyb2tlci5pc0Nsb3NlZCgpKSkKICAgICAgICAgICAgICAgICAg\nICBicm9rZXIuY2xvc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYoX2NvbmYubWV0YURhdGFSZXBvc2l0b3J5QXZhaWxhYmxlKCkpIHsKICAg\nICAgICAgICAgICAgIC8vIHJlbW92ZSBtZXRhZGF0YSByZXBvc2l0b3J5IGZy\nb20gbGlzdGVuZXIgbGlzdAogICAgICAgICAgICAgICAgUENSZWdpc3RyeS5y\nZW1vdmVSZWdpc3RlckNsYXNzTGlzdGVuZXIKICAgICAgICAgICAgICAgICAg\nICAoX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb25mLmNsb3NlKCk7CiAgICAg\nICAgICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBMb2cgbG9nID0g\nX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19SVU5USU1F\nKTsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2Nsb3NlZEV4Y2VwdGlvbiA9IG5ldyBJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\ndWJjbGFzc2VzIHNob3VsZCBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBhZGQg\nYSA8Y29kZT5QbGF0Zm9ybTwvY29kZT4KICAgICAqIHByb3BlcnR5IGxpc3Rp\nbmcgdGhlIHJ1bnRpbWUgcGxhdGZvcm0sIHN1Y2ggYXM6CiAgICAgKiA8Y29k\nZT5PcGVuSlBBIEpEQkMgRWRpdGlvbjogT3JhY2xlIERhdGFiYXNlPC9jb2Rl\nPgogICAgICovCiAgICBwdWJsaWMgUHJvcGVydGllcyBnZXRQcm9wZXJ0aWVz\nKCkgewogICAgICAgIC8vIHJlcXVpcmVkIHByb3BzIGFyZSBWZW5kb3JOYW1l\nIGFuZCBWZXJzaW9uTnVtYmVyCiAgICAgICAgUHJvcGVydGllcyBwcm9wcyA9\nIG5ldyBQcm9wZXJ0aWVzKCk7CiAgICAgICAgcHJvcHMuc2V0UHJvcGVydHko\nIlZlbmRvck5hbWUiLCBPcGVuSlBBVmVyc2lvbi5WRU5ET1JfTkFNRSk7CiAg\nICAgICAgcHJvcHMuc2V0UHJvcGVydHkoIlZlcnNpb25OdW1iZXIiLCBPcGVu\nSlBBVmVyc2lvbi5WRVJTSU9OX05VTUJFUik7CiAgICAgICAgcHJvcHMuc2V0\nUHJvcGVydHkoIlZlcnNpb25JZCIsIE9wZW5KUEFWZXJzaW9uLlZFUlNJT05f\nSUQpOwogICAgICAgIHJldHVybiBwcm9wczsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGdldFVzZXJPYmplY3QoT2JqZWN0IGtleSkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgICAgIHJldHVybiAoX3VzZXJPYmplY3RzID09IG51bGwpID8g\nbnVsbCA6IF91c2VyT2JqZWN0cy5nZXQoa2V5KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBwdXRVc2VyT2JqZWN0KE9iamVjdCBrZXksIE9i\namVjdCB2YWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBpZiAodmFsID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9\nPSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMucmVtb3ZlKGtleSk7Cgog\nICAgICAgICAgICBpZiAoX3VzZXJPYmplY3RzID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfdXNlck9iamVjdHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nICAgICByZXR1cm4gX3VzZXJPYmplY3RzLnB1dChrZXksIHZhbCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgX2xv\nY2subG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygpIHsK\nICAgICAgICBfbG9jay51bmxvY2soKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlcGxhY2VzIHRoZSBmYWN0b3J5IHdpdGggdGhpcyBKVk1zIHBvb2xlZCB2\nZXJzaW9uIGlmIGl0IGV4aXN0cy4gQWxzbwogICAgICogZnJlZXplcyB0aGUg\nZmFjdG9yeS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCByZWFkUmVz\nb2x2ZSgpCiAgICAgICAgdGhyb3dzIE9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7\nCiAgICAgICAgQWJzdHJhY3RCcm9rZXJGYWN0b3J5IGZhY3RvcnkgPSBnZXRQ\nb29sZWRGYWN0b3J5KF9jb25mKTsKICAgICAgICBpZiAoZmFjdG9yeSAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFjdG9yeTsKCiAgICAgICAgLy8g\ncmVzZXQgdGhlc2UgdHJhbnNpZW50IGZpZWxkcyB0byBlbXB0eSB2YWx1ZXMK\nICAgICAgICBfdHJhbnNhY3Rpb25hbCA9IG5ldyBDb25jdXJyZW50SGFzaE1h\ncCgpOwogICAgICAgIF9icm9rZXJzID0gbmV3IENvbmN1cnJlbnRSZWZlcmVu\nY2VIYXNoU2V0KAogICAgICAgICAgICAgICAgQ29uY3VycmVudFJlZmVyZW5j\nZUhhc2hTZXQuV0VBSyk7CgogICAgICAgIG1ha2VSZWFkT25seSgpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gTWV0aG9kcyBmb3IgT3ZlcnJpZGUKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nbmV3IFN0b3JlTWFuYWdlciBmb3IgdGhpcyBydW50aW1lLiBOb3RlIHRoYXQg\ndGhlIGluc3RhbmNlCiAgICAgKiByZXR1cm5lZCBoZXJlIG1heSBiZSB3cmFw\ncGVkIGJlZm9yZSBiZWluZyBwYXNzZWQgdG8gdGhlCiAgICAgKiB7QGxpbmsg\nI25ld0Jyb2tlcn0gbWV0aG9kLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3QgU3RvcmVNYW5hZ2VyIG5ld1N0b3JlTWFuYWdlcigpOwoKICAgIC8q\nKgogICAgICogRmluZCBhIHBvb2xlZCBicm9rZXIsIG9yIHJldHVybiBudWxs\nIGlmIG5vbmUuIElmIHVzaW5nCiAgICAgKiBtYW5hZ2VkIHRyYW5zYWN0aW9u\ncywgbG9va3MgZm9yIGEgdHJhbnNhY3Rpb25hbCBicm9rZXI7CiAgICAgKiBv\ndGhlcndpc2UgcmV0dXJucyBudWxsIGJ5IGRlZmF1bHQuIFRoaXMgbWV0aG9k\nIHdpbGwgYmUgY2FsbGVkIGJlZm9yZQogICAgICoge0BsaW5rICNuZXdTdG9y\nZU1hbmFnZXJ9IHNvIHRoYXQgZmFjdG9yeSBzdWJjbGFzc2VzIGltcGxlbWVu\ndGluZwogICAgICogcG9vbGluZyBjYW4gcmV0dXJuIGEgbWF0Y2hpbmcgbWFu\nYWdlciBiZWZvcmUgYSBuZXcge0BsaW5rIFN0b3JlTWFuYWdlcn0KICAgICAq\nIGlzIGNyZWF0ZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCcm9rZXJJbXBs\nIGZpbmRCcm9rZXIoU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzLCBib29sZWFu\nIG1hbmFnZWQpIHsKICAgICAgICBpZiAobWFuYWdlZCkKICAgICAgICAgICAg\ncmV0dXJuIGZpbmRUcmFuc2FjdGlvbmFsQnJva2VyKHVzZXIsIHBhc3MpOwog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgYnJva2VyIGNvbmZpZ3VyZWQgd2l0aCB0aGUgcHJvcGVyIHNldHRp\nbmdzLgogICAgICogQnkgZGVmYXVsdCwgdGhpcyBtZXRob2QgY29uc3RydWN0\ncyBhIG5ldwogICAgICogQnJva2VySW1wbCBvZiB0aGUgY2xhc3Mgc2V0IGZv\nciB0aGlzIGZhY3RvcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCcm9rZXJJ\nbXBsIG5ld0Jyb2tlckltcGwoU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7\nCiAgICAgICAgQnJva2VySW1wbCBicm9rZXIgPSBfY29uZi5uZXdCcm9rZXJJ\nbnN0YW5jZSh1c2VyLCBwYXNzKTsKICAgICAgICBpZiAoYnJva2VyID09IG51\nbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1icm9rZXItY2xhc3MiLAogICAgICAgICAgICAgICAgX2NvbmYu\nZ2V0QnJva2VySW1wbCgpKSk7CgogICAgICAgIHJldHVybiBicm9rZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXR1cCB0cmFuc2llbnQgc3RhdGUgdXNl\nZCBieSB0aGlzIGZhY3RvcnkgYmFzZWQgb24gdGhlCiAgICAgKiBjdXJyZW50\nIGNvbmZpZ3VyYXRpb24sIHdoaWNoIHdpbGwgc3Vic2VxdWVudGx5IGJlIGxv\nY2tlZCBkb3duLiBUaGlzCiAgICAgKiBtZXRob2Qgd2lsbCBiZSBjYWxsZWQg\nYmVmb3JlIHRoZSBmaXJzdCBicm9rZXIgaXMgcmVxdWVzdGVkLAogICAgICog\nYW5kIHdpbGwgYmUgcmUtY2FsbGVkIGVhY2ggdGltZSB0aGUgZmFjdG9yeSBp\ncyBkZXNlcmlhbGl6ZWQgaW50byBhIEpWTQogICAgICogdGhhdCBoYXMgbm8g\nY29uZmlndXJhdGlvbiBmb3IgdGhpcyBkYXRhIHN0b3JlLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBzZXR1cCgpIHsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIEZpbmQgYSBtYW5hZ2VkIHJ1bnRpbWUgYnJva2VyIGFz\nc29jaWF0ZWQgd2l0aCB0aGUKICAgICAqIGN1cnJlbnQgdHJhbnNhY3Rpb24s\nIG9yIHJldHVybnMgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwcm90ZWN0\nZWQgQnJva2VySW1wbCBmaW5kVHJhbnNhY3Rpb25hbEJyb2tlcihTdHJpbmcg\ndXNlciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBUcmFuc2FjdGlvbiB0cmFu\nczsKICAgICAgICBNYW5hZ2VkUnVudGltZSBtciA9IF9jb25mLmdldE1hbmFn\nZWRSdW50aW1lSW5zdGFuY2UoKTsKICAgICAgICBPYmplY3QgdHhLZXk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgdHJhbnMgPSBtci5nZXRUcmFuc2Fj\ndGlvbk1hbmFnZXIoKS4KICAgICAgICAgICAgICAgIGdldFRyYW5zYWN0aW9u\nKCk7CiAgICAgICAgICAgIHR4S2V5ID0gbXIuZ2V0VHJhbnNhY3Rpb25LZXko\nKTsKCiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsCiAgICAgICAgICAg\nICAgICB8fCB0cmFucy5nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX05P\nX1RSQU5TQUNUSU9OCiAgICAgICAgICAgICAgICB8fCB0cmFucy5nZXRTdGF0\ndXMoKSA9PSBTdGF0dXMuU1RBVFVTX1VOS05PV04pCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0KCiAgICAgICAgQ29sbGVjdGlv\nbiBicm9rZXJzID0gKENvbGxlY3Rpb24pIF90cmFuc2FjdGlvbmFsLmdldCh0\neEtleSk7CiAgICAgICAgaWYgKGJyb2tlcnMgIT0gbnVsbCkgewogICAgICAg\nICAgICAvLyB3ZSBkb24ndCBuZWVkIHRvIHN5bmNocm9uaXplIG9uIGJyb2tl\ncnMgc2luY2Ugb25lIEpUQSB0cmFuc2FjdGlvbgogICAgICAgICAgICAvLyBj\nYW4gbmV2ZXIgYmUgYWN0aXZlIG9uIG11bHRpcGxlIGNvbmN1cnJlbnQgdGhy\nZWFkcy4KICAgICAgICAgICAgQnJva2VySW1wbCBicm9rZXI7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYnJva2Vycy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgYnJva2VyID0gKEJy\nb2tlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuZXF1YWxzKGJyb2tlci5nZXRDb25uZWN0aW9uVXNlck5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICB1c2VyKSAmJiBTdHJpbmdVdGlscy5l\ncXVhbHMKICAgICAgICAgICAgICAgICAgICAoYnJva2VyLmdldENvbm5lY3Rp\nb25QYXNzd29yZCgpLCBwYXNzKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gYnJva2VyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0\naGUgZ2l2ZW4gYnJva2VyIHdpdGggdGhlIGN1cnJlbnQgZmFjdG9yeSBvcHRp\nb24gc2V0dGluZ3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNvbmZp\nZ3VyZUJyb2tlcihCcm9rZXJJbXBsIGJyb2tlcikgewogICAgICAgIGJyb2tl\nci5zZXRPcHRpbWlzdGljKF9jb25mLmdldE9wdGltaXN0aWMoKSk7CiAgICAg\nICAgYnJva2VyLnNldE5vbnRyYW5zYWN0aW9uYWxSZWFkKF9jb25mLmdldE5v\nbnRyYW5zYWN0aW9uYWxSZWFkKCkpOwogICAgICAgIGJyb2tlci5zZXROb250\ncmFuc2FjdGlvbmFsV3JpdGUoX2NvbmYuZ2V0Tm9udHJhbnNhY3Rpb25hbFdy\naXRlKCkpOwogICAgICAgIGJyb2tlci5zZXRSZXRhaW5TdGF0ZShfY29uZi5n\nZXRSZXRhaW5TdGF0ZSgpKTsKICAgICAgICBicm9rZXIuc2V0UmVzdG9yZVN0\nYXRlKF9jb25mLmdldFJlc3RvcmVTdGF0ZUNvbnN0YW50KCkpOwogICAgICAg\nIGJyb2tlci5zZXRBdXRvQ2xlYXIoX2NvbmYuZ2V0QXV0b0NsZWFyQ29uc3Rh\nbnQoKSk7CiAgICAgICAgYnJva2VyLnNldElnbm9yZUNoYW5nZXMoX2NvbmYu\nZ2V0SWdub3JlQ2hhbmdlcygpKTsKICAgICAgICBicm9rZXIuc2V0TXVsdGl0\naHJlYWRlZChfY29uZi5nZXRNdWx0aXRocmVhZGVkKCkpOwogICAgICAgIGJy\nb2tlci5zZXRBdXRvRGV0YWNoKF9jb25mLmdldEF1dG9EZXRhY2hDb25zdGFu\ndCgpKTsKICAgICAgICBicm9rZXIuc2V0RGV0YWNoU3RhdGUoX2NvbmYuZ2V0\nRGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXREZXRhY2hT\ndGF0ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZmFjdG9y\neSB0byB0aGUgcG9vbC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcG9v\nbCgpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9wb29sKSB7CiAgICAgICAg\nICAgIF9wb29sLnB1dCh0b1Bvb2xLZXkoX2NvbmYpLCB0aGlzKTsKICAgICAg\nICAgICAgbWFrZVJlYWRPbmx5KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogRnJlZXplcyB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGlzIGZh\nY3RvcnkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG1ha2VSZWFkT25seSgp\nIHsKICAgICAgICBpZiAoX3JlYWRPbmx5KQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBjaGVjayBhZ2FpbgogICAgICAgICAgICBpZiAoX3JlYWRPbmx5KQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBfcmVhZE9ubHkgPSB0\ncnVlOwoKICAgICAgICAgICAgTG9nIGxvZyA9IF9jb25mLmdldExvZyhPcGVu\nSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSk7CiAgICAgICAgICAgIGlm\nIChsb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLmlu\nZm8oZ2V0RmFjdG9yeUluaXRpYWxpemF0aW9uQmFubmVyKCkpOwogICAgICAg\nICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgIE1hcCBwcm9wcyA9IF9jb25mLnRvUHJvcGVydGllcyh0cnVlKTsKICAg\nICAgICAgICAgICAgIFN0cmluZyBsaW5lU2VwID0gSjJEb1ByaXZIZWxwZXIu\nZ2V0TGluZVNlcGFyYXRvcigpOwogICAgICAgICAgICAgICAgU3RyaW5nQnVm\nZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICAgICAgICAg\nIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gcHJvcHMuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAg\nICAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZW50cnkuZ2V0S2V5KCkpLmFwcGVu\nZCgiOiAiKS4KICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGVudHJ5\nLmdldFZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChpdHIuaGFz\nTmV4dCgpKQogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGxp\nbmVTZXApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJmYWN0b3J5LXByb3BlcnRpZXMiLCBidWYudG9T\ndHJpbmcoKSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzZXR1\ncCB0cmFuc2llbnQgc3RhdGUKICAgICAgICAgICAgc2V0dXAoKTsKCiAgICAg\nICAgICAgIC8vIHJlZ2lzdGVyIHRoZSBtZXRkYXRhIHJlcG9zaXRvcnkgdG8g\nYXV0by1sb2FkIHBlcnNpc3RlbnQgdHlwZXMKICAgICAgICAgICAgLy8gYW5k\nIG1ha2Ugc3VyZSB0eXBlcyBhcmUgZW5oYW5jZWQKICAgICAgICAgICAgTWV0\nYURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBv\nc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmVwb3Muc2V0VmFsaWRh\ndGUocmVwb3MuVkFMSURBVEVfUlVOVElNRSwgdHJ1ZSk7CiAgICAgICAgICAg\nIHJlcG9zLnNldFJlc29sdmUocmVwb3MuTU9ERV9NQVBQSU5HX0lOSVQsIHRy\ndWUpOwogICAgICAgICAgICBQQ1JlZ2lzdHJ5LmFkZFJlZ2lzdGVyQ2xhc3NM\naXN0ZW5lcihyZXBvcyk7CgogICAgICAgICAgICAvLyBmcmVlemUgdW5kZXJs\neWluZyBjb25maWd1cmF0aW9uIGFuZCBlYWdlcmx5IGluaXRpYWxpemUgdG8K\nICAgICAgICAgICAgLy8gYXZvaWQgc3luY2hyb25pemF0aW9uCiAgICAgICAg\nICAgIF9jb25mLnNldFJlYWRPbmx5KHRydWUpOwogICAgICAgICAgICBfY29u\nZi5pbnN0YW50aWF0ZUFsbCgpOwoKICAgICAgICAgICAgLy8gZmlyZSBhbiBl\ndmVudCBmb3IgYWxsIHRoZSBicm9rZXIgZmFjdG9yeSBsaXN0ZW5lcnMKICAg\nICAgICAgICAgLy8gcmVnaXN0ZXJlZCBvbiB0aGUgY29uZmlndXJhdGlvbi4K\nICAgICAgICAgICAgX2NvbmYuZ2V0QnJva2VyRmFjdG9yeUV2ZW50TWFuYWdl\ncigpLmZpcmVFdmVudCgKICAgICAgICAgICAgICAgIG5ldyBCcm9rZXJGYWN0\nb3J5RXZlbnQodGhpcywKICAgICAgICAgICAgICAgICAgICBCcm9rZXJGYWN0\nb3J5RXZlbnQuQlJPS0VSX0ZBQ1RPUllfQ1JFQVRFRCkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBvYmplY3QgdG8gYmUgd3Jp\ndHRlbiB0byB0aGUgbG9nIHdoZW4gdGhpcyBicm9rZXIgZmFjdG9yeQogICAg\nICogaW5pdGlhbGl6ZXMuIFRoaXMgaGFwcGVucyBhZnRlciB0aGUgY29uZmln\ndXJhdGlvbiBpcyBmdWxseSBsb2FkZWQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBPYmplY3QgZ2V0RmFjdG9yeUluaXRpYWxpemF0aW9uQmFubmVyKCkgewog\nICAgICAgIHJldHVybiBfbG9jLmdldCgiZmFjdG9yeS1pbml0IiwgT3BlbkpQ\nQVZlcnNpb24uVkVSU0lPTl9OVU1CRVIpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBmYWN0b3J5IGlzIGNsb3Nl\nZC4gIFRoZSBleGFjdCBtZXNzYWdlIGFuZAogICAgICogY29udGVudCBvZiB0\naGUgZXhjZXB0aW9uIHZhcmllcyB3aGV0aGVyIFRSQUNFIGlzIGVuYWJsZWQg\nb3Igbm90LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0T3Blbigp\nIHsKICAgICAgICBpZiAoX2Nsb3NlZCkgewogICAgICAgICAgICBpZiAoX2Ns\nb3NlZEV4Y2VwdGlvbiA9PSBudWxsKSAgLy8gVFJBQ0Ugbm90IGVuYWJsZWQK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYwogICAgICAgICAgICAgICAgICAgICAgICAuZ2V0KCJjbG9zZWQt\nZmFjdG9yeS1ub3RyYWNlIikpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJjbG9zZWQtZmFjdG9yeSIpKQogICAgICAgICAgICAgICAgICAgICAg\nICAuc2V0Q2F1c2UoX2Nsb3NlZEV4Y2VwdGlvbik7CiAgICAgICAgfQogICAg\nfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBCcm9rZXIgdXRp\nbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAg\nICogVGhyb3dzIGEge0BsaW5rIFVzZXJFeGNlcHRpb259IGlmIGEgdHJhbnNh\nY3Rpb24gaXMgYWN0aXZlLiBUaGUgdGhyb3duCiAgICAgKiBleGNlcHRpb24g\nd2lsbCBjb250YWluIGFsbCB0aGUgQnJva2VycyB3aXRoIGFjdGl2ZSB0cmFu\nc2FjdGlvbnMgYXMKICAgICAqIGZhaWxlZCBvYmplY3RzIGluIHRoZSBuZXN0\nZWQgZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2Vy\ndE5vQWN0aXZlVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgQ29sbGVjdGlvbiBl\neGNzOwogICAgICAgIGlmIChfdHJhbnNhY3Rpb25hbC5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgZXhjcyA9IG5ldyBBcnJheUxp\nc3QoX3RyYW5zYWN0aW9uYWwuc2l6ZSgpKTsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIHRyYW5zID0gX3RyYW5zYWN0aW9uYWwudmFsdWVzKCkuaXRlcmF0b3Io\nKTsKICAgICAgICAgICAgdHJhbnMuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBDb2xsZWN0aW9uIGJyb2tlcnMgPSAoQ29sbGVjdGlvbikgdHJhbnMubmV4\ndCgpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGJyb2tlcnMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIGV4Y3MuYWRkKG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nImFjdGl2ZSIpKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmpl\nY3QoaXRyLm5leHQoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBpZiAoIWV4Y3MuaXNFbXB0eSgpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhj\nZXBzIikpLgogICAgICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcygo\nVGhyb3dhYmxlW10pIGV4Y3MudG9BcnJheQogICAgICAgICAgICAgICAgICAg\nIChuZXcgVGhyb3dhYmxlW2V4Y3Muc2l6ZSgpXSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3luY2hyb25pemUgdGhlIGdpdmVuIGJyb2tlciB3aXRoIGEg\nbWFuYWdlZCB0cmFuc2FjdGlvbiwKICAgICAqIG9wdGlvbmFsbHkgc3RhcnRp\nbmcgb25lIGlmIG5vbmUgaXMgaW4gcHJvZ3Jlc3MuCiAgICAgKgogICAgICog\nQHJldHVybiB0cnVlIGlmIHN5bmNoZWQgd2l0aCB0cmFuc2FjdGlvbiwgZmFs\nc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIGJvb2xlYW4gc3luY1dpdGhNYW5h\nZ2VkVHJhbnNhY3Rpb24oQnJva2VySW1wbCBicm9rZXIsIGJvb2xlYW4gYmVn\naW4pIHsKICAgICAgICBUcmFuc2FjdGlvbiB0cmFuczsKICAgICAgICB0cnkg\newogICAgICAgICAgICBNYW5hZ2VkUnVudGltZSBtciA9IGJyb2tlci5nZXRN\nYW5hZ2VkUnVudGltZSgpOwogICAgICAgICAgICBUcmFuc2FjdGlvbk1hbmFn\nZXIgdG0gPSBtci5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKTsKICAgICAgICAg\nICAgdHJhbnMgPSB0bS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBp\nZiAodHJhbnMgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgKHRyYW5zLmdl\ndFN0YXR1cygpID09IFN0YXR1cy5TVEFUVVNfTk9fVFJBTlNBQ1RJT04KICAg\nICAgICAgICAgICAgIHx8IHRyYW5zLmdldFN0YXR1cygpID09IFN0YXR1cy5T\nVEFUVVNfVU5LTk9XTikpCiAgICAgICAgICAgICAgICB0cmFucyA9IG51bGw7\nCgogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCAmJiBiZWdpbikgewog\nICAgICAgICAgICAgICAgdG0uYmVnaW4oKTsKICAgICAgICAgICAgICAgIHRy\nYW5zID0gdG0uZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICAgICAgLy8gc3luY2ggYnJva2VyIGFuZCB0cmFucwog\nICAgICAgICAgICB0cmFucy5yZWdpc3RlclN5bmNocm9uaXphdGlvbihicm9r\nZXIpOwoKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0byBzeW5jaHJv\nbml6ZSBvbiBicm9rZXJzIG9yIGd1YXJkIGFnYWluc3QgbXVsdGlwbGUKICAg\nICAgICAgICAgLy8gdGhyZWFkcyB1c2luZyB0aGUgc2FtZSB0cmFucyBzaW5j\nZSBvbmUgSlRBIHRyYW5zYWN0aW9uIGNhbiBuZXZlcgogICAgICAgICAgICAv\nLyBiZSBhY3RpdmUgb24gbXVsdGlwbGUgY29uY3VycmVudCB0aHJlYWRzLgog\nICAgICAgICAgICBPYmplY3QgdHhLZXkgPSBtci5nZXRUcmFuc2FjdGlvbktl\neSgpOwogICAgICAgICAgICBDb2xsZWN0aW9uIGJyb2tlcnMgPSAoQ29sbGVj\ndGlvbikgX3RyYW5zYWN0aW9uYWwuZ2V0KHR4S2V5KTsKICAgICAgICAgICAg\nCiAgICAgICAgICAgIGlmIChicm9rZXJzID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGJyb2tlcnMgPSBuZXcgQXJyYXlMaXN0KDIpOwogICAgICAgICAg\nICAgICAgX3RyYW5zYWN0aW9uYWwucHV0KHR4S2V5LCBicm9rZXJzKTsKICAg\nICAgICAgICAgICAgIHRyYW5zLnJlZ2lzdGVyU3luY2hyb25pemF0aW9uKG5l\ndyBSZW1vdmVUcmFuc2FjdGlvblN5bmModHhLZXkpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBicm9rZXJzLmFkZChicm9rZXIpOwogICAgICAgICAg\nICAKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgc2V0IG9mIGFsbCB0aGUgb3Bl\nbiBicm9rZXJzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGZhY3RvcnkuIFRoZQog\nICAgICogcmV0dXJuZWQgc2V0IGlzIHVubW9kaWZpYWJsZSwgYW5kIG1heSBj\nb250YWluIG51bGwgcmVmZXJlbmNlcy4KICAgICAqLwogICAgcHVibGljIENv\nbGxlY3Rpb24gZ2V0T3BlbkJyb2tlcnMoKSB7CiAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX2Jyb2tlcnMpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2ltcGxlIHN5bmNocm9uaXphdGlvbiBs\naXN0ZW5lciB0byByZW1vdmUgY29tcGxldGVkIHRyYW5zYWN0aW9ucwogICAg\nICogZnJvbSBvdXIgY2FjaGUuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3Mg\nUmVtb3ZlVHJhbnNhY3Rpb25TeW5jCiAgICAgICAgaW1wbGVtZW50cyBTeW5j\naHJvbml6YXRpb24gewoKICAgICAgICBwcml2YXRlIGZpbmFsIE9iamVjdCBf\ndHJhbnM7CgogICAgICAgIHB1YmxpYyBSZW1vdmVUcmFuc2FjdGlvblN5bmMo\nT2JqZWN0IHRyYW5zKSB7CiAgICAgICAgICAgIF90cmFucyA9IHRyYW5zOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgYmVmb3JlQ29tcGxldGlv\nbigpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29t\ncGxldGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgICAgIF90cmFuc2FjdGlv\nbmFsLnJlbW92ZSAoX3RyYW5zKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

