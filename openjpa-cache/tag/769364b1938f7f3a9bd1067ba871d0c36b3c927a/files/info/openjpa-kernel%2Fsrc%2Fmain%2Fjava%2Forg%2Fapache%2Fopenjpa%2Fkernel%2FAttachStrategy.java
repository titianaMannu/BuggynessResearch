{"sha":"028f43a1c4078deca94d84d1a418ddd026da1667","node_id":"MDQ6QmxvYjIwNjM2NDowMjhmNDNhMWM0MDc4ZGVjYTk0ZDg0ZDFhNDE4ZGRkMDI2ZGExNjY3","size":20370,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/028f43a1c4078deca94d84d1a418ddd026da1667","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwoKLyoqCiAqIFN0cmF0ZWd5IGZvciBhdHRhY2hpbmcgb2JqZWN0cy4K\nICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBT\ndGV2ZSBLaW0KICogQG5vamF2YWRvYwogKi8KYWJzdHJhY3QgY2xhc3MgQXR0\nYWNoU3RyYXRlZ3kKICAgIGV4dGVuZHMgVHJhbnNmZXJGaWVsZE1hbmFnZXIg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQXR0YWNoU3RyYXRlZ3ku\nY2xhc3MpOwoKICAgIC8qKgogICAgICogQXR0YWNoLgogICAgICoKICAgICAq\nIEBwYXJhbSBtYW5hZ2VyIG1hbmFnZXIgaG9sZGluZyBjYWNoZSBvZiBhdHRh\nY2hlZCBpbnN0YW5jZXMKICAgICAqIEBwYXJhbSB0b0F0dGFjaCBkZXRhY2hl\nZCBpbnN0YW5jZQogICAgICogQHBhcmFtIG1ldGEgbWV0YWRhdGEgZm9yIHRo\nZSBpbnN0YW5jZSBiZWluZyBhdHRhY2hlZAogICAgICogQHBhcmFtIGludG8g\naW5zdGFuY2Ugd2UncmUgYXR0YWNoaW5nIGludG8KICAgICAqIEBwYXJhbSBv\nd25lciBzdGF0ZSBtYW5hZ2VyIGZvciA8Y29kZT5pbnRvPC9jb2RlPgogICAg\nICogQHBhcmFtIG93bmVyTWV0YSBmaWVsZCB3ZSB0cmF2ZXJzZWQgdG8gZmlu\nZCA8Y29kZT50b0F0dGFjaDwvY29kZT4KICAgICAqIEBwYXJhbSBleHBsaWNp\ndCB3aGV0aGVyIHRvIG1ha2UgbmV3IGluc3RhbmNlcyBleHBsaWNpdGx5IHBl\ncnNpc3RlbnQKICAgICAqLwogICAgcHVibGljIGFic3RyYWN0IE9iamVjdCBh\ndHRhY2goQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIE9iamVjdCB0\nb0F0dGFjaCwgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFi\nbGUgaW50bywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBW\nYWx1ZU1ldGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCk7Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGlkZW50aXR5IG9mIHRoZSBnaXZl\nbiBkZXRhY2hlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFi\nc3RyYWN0IE9iamVjdCBnZXREZXRhY2hlZE9iamVjdElkKEF0dGFjaE1hbmFn\nZXIgbWFuYWdlciwKICAgICAgICBPYmplY3QgdG9BdHRhY2gpOwoKICAgIC8q\nKgogICAgICogUHJvdmlkZSB0aGUgZ2l2ZW4gZmllbGQgaW50byB0aGlzIGZp\nZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2\nb2lkIHByb3ZpZGVGaWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdl\nckltcGwgc20sCiAgICAgICAgaW50IGZpZWxkKTsKCiAgICAvKioKICAgICAq\nIFJldHVybiBhIFBOZXcvUE5ld1Byb3Zpc2lvbmFsIG1hbmFnZWQgb2JqZWN0\nIGZvciB0aGUgZ2l2ZW4gZGV0YWNoZWQgCiAgICAgKiBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgcGVyc2lzdChB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEsIE9iamVjdCBhcHBJZCwgCiAg\nICAgICAgYm9vbGVhbiBleHBsaWNpdCkgewogICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBuZXdJbnN0YW5jZTsKICAgICAgICBpZiAoIW1hbmFnZXIuZ2V0\nQ29weU5ldygpKQogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjOwogICAg\nICAgIGVsc2UgaWYgKGFwcElkID09IG51bGwpIC8vIGRhdGFzdG9yZSBpZGVu\ndGl0eQogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjLnBjTmV3SW5zdGFu\nY2UobnVsbCwgZmFsc2UpOwogICAgICAgIGVsc2UgLy8gYXBwbGljYXRpb24g\naWRlbnRpdHk6IHVzZSBleGlzdGluZyBmaWVsZHMKICAgICAgICAgICAgbmV3\nSW5zdGFuY2UgPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIGFwcElkLCBmYWxz\nZSk7CgogICAgICAgIHJldHVybiAoU3RhdGVNYW5hZ2VySW1wbCkgbWFuYWdl\nci5nZXRCcm9rZXIoKS5wZXJzaXN0CiAgICAgICAgICAgIChuZXdJbnN0YW5j\nZSwgYXBwSWQsIGV4cGxpY2l0LCBtYW5hZ2VyLmdldEJlaGF2aW9yKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBmaWVsZCBp\nbnRvIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\ndG9BdHRhY2ggdGhlIGRldGFjaGVkIHBlcnNpc3RlbnQgaW5zdGFuY2UKICAg\nICAqIEBwYXJhbSBzbSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgbWFuYWdlZCBp\nbnN0YW5jZSB3ZSdyZSBjb3B5aW5nCiAgICAgKiBpbnRvOyA8Y29kZT50b0F0\ndGFjaDwvY29kZT4gYWxzbyB1c2VzIHRoaXMgc3RhdGUgbWFuYWdlcgogICAg\nICogQHBhcmFtIGZtZCBtZXRhZGF0YSBvbiB0aGUgZmllbGQgd2UncmUgY29w\neWluZwogICAgICogQHBhcmFtIG51bGxMb2FkZWQgaWYgZmFsc2UsIG51bGxz\nIHdpbGwgYmUgY29uc2lkZXJlZCB1bmxvYWRlZCBhbmQgd2lsbAogICAgICog\nbm90IGJlIGF0dGFjaGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFu\nIGF0dGFjaEZpZWxkKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0IHRv\nQXR0YWNoLAogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20sIEZpZWxkTWV0\nYURhdGEgZm1kLCBib29sZWFuIG51bGxMb2FkZWQpIHsKICAgICAgICBpZiAo\nZm1kLmlzVmVyc2lvbigpCiAgICAgICAgICAgIHx8IGZtZC5nZXRNYW5hZ2Vt\nZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQZXJzaXN0ZW5jZUNh\ncGFibGUgaW50byA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAg\nICAgIGludCBpID0gZm1kLmdldEluZGV4KCk7CiAgICAgICAgcHJvdmlkZUZp\nZWxkKHRvQXR0YWNoLCBzbSwgaSk7CgogICAgICAgIGludCBzZXQgPSBTdGF0\nZU1hbmFnZXIuU0VUX0FUVEFDSDsKICAgICAgICBPYmplY3QgdmFsOwogICAg\nICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAg\nICAgc20uc2V0dGluZ0Jvb2xlYW5GaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJv\nb2xlYW5GaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaEJvb2xl\nYW5GaWVsZChpKSwgc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAg\nc20uc2V0dGluZ0J5dGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJ5dGVGaWVs\nZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaEJ5dGVGaWVsZChpKSwg\nc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ0No\nYXJGaWVsZChpbnRvLCBpLCBzbS5mZXRjaENoYXJGaWVsZChpKSwKICAgICAg\nICAgICAgICAgICAgICBmZXRjaENoYXJGaWVsZChpKSwgc2V0KTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEU6CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nRG91YmxlRmllbGQo\naW50bywgaSwgc20uZmV0Y2hEb3VibGVGaWVsZChpKSwKICAgICAgICAgICAg\nICAgICAgICBmZXRjaERvdWJsZUZpZWxkKGkpLCBzZXQpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ0Zsb2F0RmllbGQoaW50bywg\naSwgc20uZmV0Y2hGbG9hdEZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAg\nIGZldGNoRmxvYXRGaWVsZChpKSwgc2V0KTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgICAgICBzbS5zZXR0aW5nSW50RmllbGQoaW50bywgaSwgc20uZmV0Y2hJ\nbnRGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaEludEZpZWxk\nKGkpLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBzbS5zZXR0\naW5nTG9uZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoTG9uZ0ZpZWxkKGkpLAog\nICAgICAgICAgICAgICAgICAgIGZldGNoTG9uZ0ZpZWxkKGkpLCBzZXQpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ1Nob3J0Rmll\nbGQoaW50bywgaSwgc20uZmV0Y2hTaG9ydEZpZWxkKGkpLAogICAgICAgICAg\nICAgICAgICAgIGZldGNoU2hvcnRGaWVsZChpKSwgc2V0KTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJ\nTkc6CiAgICAgICAgICAgICAgICBTdHJpbmcgc3ZhbCA9IGZldGNoU3RyaW5n\nRmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAoc3ZhbCA9PSBudWxsICYm\nICFudWxsTG9hZGVkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTdHJpbmdGaWVsZChpbnRv\nLCBpLCBzbS5mZXRjaFN0cmluZ0ZpZWxkKGkpLCBzdmFsLAogICAgICAgICAg\nICAgICAgICAgIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk5VTUJFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9P\nQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09C\nSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9CSkVDVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAg\nICAgICAgICAgICAgdmFsID0gZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAg\nICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAg\nICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgc20uZmV0Y2hPYmpl\nY3RGaWVsZChpKSwgdmFsLAogICAgICAgICAgICAgICAgICAgIHNldCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUEM6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6\nCiAgICAgICAgICAgICAgICBPYmplY3QgZnJtcGMgPSBmZXRjaE9iamVjdEZp\nZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKGZybXBjID09IG51bGwgJiYg\nIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciB0b3NtID0g\nbWFuYWdlci5nZXRCcm9rZXIoKS5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAg\nICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVsZChpKSk7CiAgICAgICAg\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgdG9wYyA9ICh0b3NtID09IG51\nbGwpID8gbnVsbAogICAgICAgICAgICAgICAgICAgIDogdG9zbS5nZXRQZXJz\naXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICAgICAgICAgIGlmIChmcm1wYyAh\nPSBudWxsIHx8IHRvcGMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChmbWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgICAgICAgICBmcm1wYyA9\nIGdldFJlZmVyZW5jZShtYW5hZ2VyLCBmcm1wYywgc20sIGZtZCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvcGMgPSB0b3BjOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIWZtZC5pc0VtYmVkZGVkUEMoKSAmJiBmcm1w\nYyAhPSBudWxsICYmIHRvcGMgIT0gbnVsbAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgIU9iamVjdFV0aWxzLmVxdWFscyh0b3BjLnBjRmV0Y2hP\nYmplY3RJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdl\nci5nZXREZXRhY2hlZE9iamVjdElkKGZybXBjKSkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGludG9wYyA9IG51bGw7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZnJtcGMgPSBt\nYW5hZ2VyLmF0dGFjaChmcm1wYywgaW50b3BjLCBzbSwgZm1kLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlm\nIChmcm1wYyAhPSB0b3BjKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5z\nZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgdG9wYywgZnJtcGMsIHNldCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgIENvbGxlY3Rpb24gZnJtYyA9IChDb2xsZWN0aW9uKSBmZXRjaE9i\namVjdEZpZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKGZybWMgPT0gbnVs\nbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIHRvYyA9IChDb2xs\nZWN0aW9uKSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAg\nICAgaWYgKCh0b2MgIT0gbnVsbCAmJiAhdG9jLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgICAgICB8fCBmcm1jICE9IG51bGwgJiYgIWZybWMuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZybWMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxk\nKGludG8sIGksIHRvYywgbnVsbCwgc2V0KTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlIGlmICh0b2MgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgbnVsbCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaENvbGxlY3Rpb24obWFu\nYWdlciwgZnJtYywgc20sIGZtZCksIHNldCk7CiAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIGlmICh0b2MgaW5zdGFuY2VvZiBTZXQgJiYgZnJtYyBpbnN0\nYW5jZW9mIFNldCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUNv\nbGxlY3Rpb24obWFuYWdlciwgZnJtYywgdG9jLCBzbSwgZm1kKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvYywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJlcGxhY2VMaXN0KG1hbmFnZXIsIGZybWMs\nIHRvYywgc20sIGZtZCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIE1h\ncCBmcm1tID0gKE1hcCkgZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAg\nICAgICAgIGlmIChmcm1tID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nTWFwIHRvbSA9IChNYXApIHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAg\nICAgICAgICAgICBpZiAoKHRvbSAhPSBudWxsICYmICF0b20uaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgICAgIHx8IChmcm1tICE9IG51bGwgJiYgIWZy\nbW0uaXNFbXB0eSgpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmcm1t\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdP\nYmplY3RGaWVsZChpbnRvLCBpLCB0b20sIG51bGwsIHNldCk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZSBpZiAodG9tID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCBu\ndWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoTWFwKG1h\nbmFnZXIsIGZybW0sIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZU1hcCht\nYW5hZ2VyLCBmcm1tLCB0b20sIHNtLCBmbWQpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgT2JqZWN0IGZybWEgPSBm\nZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKGZybWEg\nPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBPYmplY3QgdG9hID0gc20u\nZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmICgodG9h\nICE9IG51bGwgJiYgQXJyYXkuZ2V0TGVuZ3RoKHRvYSkgPiAwKQogICAgICAg\nICAgICAgICAgICAgIHx8IChmcm1hICE9IG51bGwgJiYgQXJyYXkuZ2V0TGVu\nZ3RoKGZybWEpID4gMCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJt\nYSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nT2JqZWN0RmllbGQoaW50bywgaSwgdG9hLCBudWxsLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc20u\nc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvYSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcGxhY2VBcnJheShtYW5hZ2VyLCBmcm1hLCB0\nb2EsIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oZm1kLnRvU3Ry\naW5nKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIG1hbmFnZWQsIHBvc3NpYmx5IGhv\nbGxvdyByZWZlcmVuY2UgZm9yIHRoZSBnaXZlbiBkZXRhY2hlZAogICAgICog\nb2JqZWN0LgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGdldFJlZmVy\nZW5jZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIE9iamVjdCB0b0F0dGFjaCwK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBWYWx1ZU1ldGFEYXRh\nIHZtZCkgewogICAgICAgIGlmICh0b0F0dGFjaCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKG1hbmFnZXIuZ2V0QnJv\na2VyKCkuaXNQZXJzaXN0ZW50KHRvQXR0YWNoKSkgewogICAgICAgICAgICBy\nZXR1cm4gdG9BdHRhY2g7CiAgICAgICAgfSBlbHNlIGlmIChtYW5hZ2VyLmdl\ndEJyb2tlcigpLmlzRGV0YWNoZWQodG9BdHRhY2gpKSB7CiAgICAgICAgICAg\nIE9iamVjdCBvaWQgPSBtYW5hZ2VyLmdldERldGFjaGVkT2JqZWN0SWQodG9B\ndHRhY2gpOwogICAgICAgICAgICBpZiAob2lkICE9IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gbWFuYWdlci5nZXRCcm9rZXIoKS5maW5kKG9pZCwg\nZmFsc2UsIG51bGwpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1jYXNjYWRlLWF0dGFjaCIsCiAg\nICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcodG9BdHRhY2gpLCB2bWQs\nCiAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoc20uZ2V0TWFuYWdl\nZEluc3RhbmNlKCkpKSkuCiAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdCh0\nb0F0dGFjaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIHRoZSBj\nb250ZW50cyBvZiA8Y29kZT50b2M8L2NvZGU+IHdpdGggdGhlIGNvbnRlbnRz\nIG9mCiAgICAgKiA8Y29kZT5mcm1jPC9jb2RlPi4gTmVpdGhlciBjb2xsZWN0\naW9uIGlzIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNl\nQ29sbGVjdGlvbihBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIENvbGxlY3Rpb24g\nZnJtYywKICAgICAgICBDb2xsZWN0aW9uIHRvYywgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBpZiBm\ncm1jIGNvbGxlY3Rpb24gaXMgZW1wdHksIGp1c3QgY2xlYXIgdG9jCiAgICAg\nICAgaWYgKGZybWMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlmICghdG9j\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRvYy5jbGVhcigpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlz\nIGlzIGEgcGMgY29sbGVjdGlvbiwgYXR0YWNoIGFsbCBpbnN0YW5jZXMKICAg\nICAgICBib29sZWFuIHBjID0gZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVk\nVHlwZVBDKCk7CiAgICAgICAgaWYgKHBjKQogICAgICAgICAgICBmcm1jID0g\nYXR0YWNoQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCBzbSwgZm1kKTsKCiAg\nICAgICAgLy8gcmVtb3ZlIGFsbCBlbGVtZW50cyBmcm9tIHRoZSB0b2MgY29s\nbGVjdGlvbiB0aGF0IGFyZW4ndCBpbiBmcm1jCiAgICAgICAgdG9jLnJldGFp\nbkFsbChmcm1jKTsKCiAgICAgICAgLy8gbm93IGFkZCBhbGwgZWxlbWVudHMg\ndGhhdCBhcmUgaW4gZnJtYyBidXQgbm90IHRvYwogICAgICAgIGlmIChmcm1j\nLnNpemUoKSAhPSB0b2Muc2l6ZSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaSA9IGZybWMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBPYmplY3Qgb2IgPSBpLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGlmICghdG9jLmNvbnRhaW5zKG9iKSkKICAgICAgICAgICAgICAg\nICAgICB0b2MuYWRkKG9iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBjb2xsZWN0aW9uIHdp\ndGggdGhlIGF0dGFjaGVkIGNvbnRlbnRzIG9mIHRoZSBnaXZlbiBvbmUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGF0dGFjaENvbGxlY3Rp\nb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIENvbGxlY3Rpb24g\nb3JpZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBm\nbWQpIHsKICAgICAgICBDb2xsZWN0aW9uIGNvbGwgPSBjb3B5Q29sbGVjdGlv\nbihtYW5hZ2VyLCBvcmlnLCBmbWQpOwogICAgICAgIFZhbHVlTWV0YURhdGEg\ndm1kID0gZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICBpZiAoIXZtZC5pc0Rl\nY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBjb2xsOwoKICAg\nICAgICAvLyB1bmZvcnR1bmF0ZWx5IHdlIGhhdmUgdG8gY2xlYXIgdGhlIG9y\naWdpbmFsIGFuZCByZS1hZGQKICAgICAgICBjb2xsLmNsZWFyKCk7CiAgICAg\nICAgT2JqZWN0IGVsZW07CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBv\ncmlnLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nIGlmICh2bWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgZWxlbSA9IGdldFJlZmVy\nZW5jZShtYW5hZ2VyLCBpdHIubmV4dCgpLCBzbSwgdm1kKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgZWxlbSA9IG1hbmFnZXIuYXR0YWNo\nKGl0ci5uZXh0KCksIG51bGwsIHNtLCB2bWQsIGZhbHNlKTsKICAgICAgICAg\nICAgY29sbC5hZGQoZWxlbSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBj\nb2xsOwogICAgfQoKICAgIC8qKgogICAgICogQ29waWVzIHRoZSBnaXZlbiBj\nb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb24gY29w\neUNvbGxlY3Rpb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBDb2xsZWN0aW9u\nIG9yaWcsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBD\nb2xsZWN0aW9uIGNvbGwgPSBtYW5hZ2VyLmdldFByb3h5TWFuYWdlcigpLmNv\ncHlDb2xsZWN0aW9uKG9yaWcpOwogICAgICAgIGlmIChjb2xsID09IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICByZXR1cm4gY29sbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXR0YWNoZWQgdmVy\nc2lvbiBvZiB0aGUgPGNvZGU+ZnJtbDwvY29kZT4KICAgICAqIGxpc3QgaWYg\naXQgaXMgZGlmZmVyZW50IHRoYW4gPGNvZGU+dG9sPC9jb2RlPi4gSWYgdGhl\nIGxpc3RzCiAgICAgKiB3aWxsIGJlIGlkZW50aWNhbCwgcmV0dXJucyA8Y29k\nZT50b2w8L2NvZGU+LiBOZWl0aGVyIGxpc3QgaXMgbnVsbC4KICAgICAqLwog\nICAgcHJpdmF0ZSBDb2xsZWN0aW9uIHJlcGxhY2VMaXN0KEF0dGFjaE1hbmFn\nZXIgbWFuYWdlciwgQ29sbGVjdGlvbiBmcm1sLAogICAgICAgIENvbGxlY3Rp\nb24gdG9sLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRh\nIGZtZCkgewogICAgICAgIGJvb2xlYW4gcGMgPSBmbWQuZ2V0RWxlbWVudCgp\nLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAgICBpZiAocGMpCiAgICAgICAg\nICAgIGZybWwgPSBhdHRhY2hDb2xsZWN0aW9uKG1hbmFnZXIsIGZybWwsIHNt\nLCBmbWQpOwoKICAgICAgICAvLyBpZiB0aGUgb25seSBkaWZmIGJldHdlZW4g\nZnJtbCBhbmQgdG9sIGlzIHNvbWUgYWRkZWQgZWxlbWVudHMgYXQKICAgICAg\nICAvLyB0aGUgZW5kLCBtYWtlIHRoZSBjaGFuZ2VzIGRpcmVjdGx5IGluIHRv\nbAogICAgICAgIGlmIChmcm1sLnNpemUoKSA+PSB0b2wuc2l6ZSgpKSB7CiAg\nICAgICAgICAgIEl0ZXJhdG9yIGZybWkgPSBmcm1sLml0ZXJhdG9yKCk7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgdG9pID0gdG9sLml0ZXJhdG9yKCk7\nIHRvaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGVy\nZSdzIGFuIGluY29tcGF0aWJpbGl0eSwganVzdCByZXR1cm4gYSBjb3B5IG9m\nIGZybWwKICAgICAgICAgICAgICAgIC8vIChpdCdzIGFscmVhZHkgY29waWVk\nIGlmIHdlIGF0dGFjaGVkIGl0KQogICAgICAgICAgICAgICAgaWYgKCFlcXVh\nbHMoZnJtaS5uZXh0KCksIHRvaS5uZXh0KCksIHBjKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gKHBjKSA/IGZybWwgOiBjb3B5Q29sbGVjdGlvbiht\nYW5hZ2VyLCBmcm1sLCBmbWQpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBqdXN0IGFkZCB0aGUgZXh0cmEgZWxlbWVudHMgaW4gZnJtbCB0byB0\nb2wgYW5kIHJldHVybiB0b2wKICAgICAgICAgICAgd2hpbGUgKGZybWkuaGFz\nTmV4dCgpKQogICAgICAgICAgICAgICAgdG9sLmFkZChmcm1pLm5leHQoKSk7\nCiAgICAgICAgICAgIHJldHVybiB0b2w7CiAgICAgICAgfQoKICAgICAgICAv\nLyB0aGUgbGlzdHMgYXJlIGRpZmZlcmVudDsganVzdCBtYWtlIHN1cmUgZnJt\nbCBpcyBjb3BpZWQgYW5kIHJldHVybiBpdAogICAgICAgIHJldHVybiAocGMp\nID8gZnJtbCA6IGNvcHlDb2xsZWN0aW9uKG1hbmFnZXIsIGZybWwsIGZtZCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIHRoZSBjb250ZW50cyBv\nZiA8Y29kZT50b208L2NvZGU+IHdpdGggdGhlIGNvbnRlbnRzIG9mCiAgICAg\nKiA8Y29kZT5mcm1tPC9jb2RlPi4gTmVpdGhlciBtYXAgaXMgbnVsbC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VNYXAoQXR0YWNoTWFuYWdl\nciBtYW5hZ2VyLCBNYXAgZnJtbSwgTWFwIHRvbSwKICAgICAgICBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAg\nIGlmIChmcm1tLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoIXRvbS5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0b20uY2xlYXIoKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBp\ncyBhIHBjIG1hcCwgYXR0YWNoIGFsbCBpbnN0YW5jZXMKICAgICAgICBib29s\nZWFuIGtleVBDID0gZm1kLmdldEtleSgpLmlzRGVjbGFyZWRUeXBlUEMoKTsK\nICAgICAgICBib29sZWFuIHZhbFBDID0gZm1kLmdldEVsZW1lbnQoKS5pc0Rl\nY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgaWYgKGtleVBDIHx8IHZhbFBDKQog\nICAgICAgICAgICBmcm1tID0gYXR0YWNoTWFwKG1hbmFnZXIsIGZybW0sIHNt\nLCBmbWQpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgYWxsIHRoZSBrZXlzIGlu\nIHRoZSBmcm9tIG1hcCBhcmUgaW4gdGhlIHR3byBtYXAsIGFuZAogICAgICAg\nIC8vIHRoYXQgdGhleSBoYXZlIHRoZSBzYW1lIHZhbHVlcwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaSA9IGZybW0uZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5ID0g\nKE1hcC5FbnRyeSkgaS5uZXh0KCk7CiAgICAgICAgICAgIGlmICghdG9tLmNv\nbnRhaW5zS2V5KGVudHJ5LmdldEtleSgpKQogICAgICAgICAgICAgICAgfHwg\nIWVxdWFscyh0b20uZ2V0KGVudHJ5LmdldEtleSgpKSwgZW50cnkuZ2V0VmFs\ndWUoKSwgdmFsUEMpKSB7CiAgICAgICAgICAgICAgICB0b20ucHV0KGVudHJ5\nLmdldEtleSgpLCBlbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGFueSBrZXlzIGluIHRoZSB0\nbyBtYXAgdGhhdCBhcmVuJ3QgaW4gdGhlIGZyb20gbWFwCiAgICAgICAgaWYg\nKHRvbS5zaXplKCkgIT0gZnJtbS5zaXplKCkpIHsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpID0gdG9tLmtleVNldCgpLml0ZXJhdG9yKCk7IGkuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKCEoZnJtbS5jb250YWlu\nc0tleShpLm5leHQoKSkpKQogICAgICAgICAgICAgICAgICAgIGkucmVtb3Zl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIG1h\ncCBhcmUgYXR0YWNoZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBNYXAgYXR0\nYWNoTWFwKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgTWFwIG9yaWcsCiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBNYXAgbWFwID0gbWFuYWdlci5nZXRQcm94eU1hbmFnZXIo\nKS5jb3B5TWFwKG9yaWcpOwogICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5v\ndC1jb3B5YWJsZSIsIGZtZCkpOwoKICAgICAgICBWYWx1ZU1ldGFEYXRhIGtl\neW1kID0gZm1kLmdldEtleSgpOwogICAgICAgIFZhbHVlTWV0YURhdGEgdmFs\nbWQgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgIGlmICgha2V5bWQuaXNE\nZWNsYXJlZFR5cGVQQygpICYmICF2YWxtZC5pc0RlY2xhcmVkVHlwZVBDKCkp\nCiAgICAgICAgICAgIHJldHVybiBtYXA7CgogICAgICAgIC8vIGlmIHdlIGhh\ndmUgdG8gcmVwbGFjZSBrZXlzLCBqdXN0IGNsZWFyIGFuZCByZS1hZGQ7IG90\naGVyd2lzZQogICAgICAgIC8vIHdlIGNhbiB1c2UgdGhlIGVudHJ5IHNldCB0\nbyByZXNldCB0aGUgdmFsdWVzIG9ubHkKICAgICAgICBNYXAuRW50cnkgZW50\ncnk7CiAgICAgICAgaWYgKGtleW1kLmlzRGVjbGFyZWRUeXBlUEMoKSkgewog\nICAgICAgICAgICBtYXAuY2xlYXIoKTsKICAgICAgICAgICAgT2JqZWN0IGtl\neSwgdmFsOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9yaWcu\nZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAg\nICAgICAgICBpZiAoa2V5bWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgICAgIGtl\neSA9IGdldFJlZmVyZW5jZShtYW5hZ2VyLCBrZXksIHNtLCBrZXltZCk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAga2V5ID0g\nbWFuYWdlci5hdHRhY2goa2V5LCBudWxsLCBzbSwga2V5bWQsIGZhbHNlKTsK\nICAgICAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAg\nICAgICAgICAgICBpZiAodmFsbWQuaXNEZWNsYXJlZFR5cGVQQygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHZhbG1kLmdldENhc2NhZGVBdHRhY2go\nKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAg\nICAgICAgICAgICAgdmFsID0gZ2V0UmVmZXJlbmNlKG1hbmFnZXIsIHZhbCwg\nc20sIHZhbG1kKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIHZhbCA9IG1hbmFnZXIuYXR0YWNoKHZhbCwgbnVs\nbCwgc20sIHZhbG1kLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBtYXAucHV0KGtleSwgdmFsKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIE9iamVjdCB2YWw7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbWFwLmVudHJ5U2V0KCkuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGVu\ndHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmICh2YWxtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gZ2V0\nUmVmZXJlbmNlKG1hbmFnZXIsIGVudHJ5LmdldFZhbHVlKCksIHNtLCB2YWxt\nZCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\ndmFsID0gbWFuYWdlci5hdHRhY2goZW50cnkuZ2V0VmFsdWUoKSwgbnVsbCwg\nc20sIHZhbG1kLCAKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwog\nICAgICAgICAgICAgICAgZW50cnkuc2V0VmFsdWUodmFsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbWFwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyBhbiBhdHRhY2hlZCB2ZXJzaW9uIG9mIHRo\nZSA8Y29kZT5mcm1hPC9jb2RlPgogICAgICogYXJyYXkgaWYgaXQgaXMgZGlm\nZmVyZW50IHRoYW4gPGNvZGU+dG9hPC9jb2RlPi4gSWYgdGhlIGFycmF5cwog\nICAgICogd2lsbCBiZSBpZGVudGljYWwsIHJldHVybnMgPGNvZGU+dG9hPC9j\nb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgcmVwbGFjZUFycmF5\nKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgT2JqZWN0IGZybWEsCiAgICAgICAg\nT2JqZWN0IHRvYSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgICAgICBpbnQgbGVuID0gQXJyYXkuZ2V0TGVuZ3Ro\nKGZybWEpOwogICAgICAgIGJvb2xlYW4gZGlmZiA9IHRvYSA9PSBudWxsIHx8\nIGxlbiAhPSBBcnJheS5nZXRMZW5ndGgodG9hKTsKCiAgICAgICAgLy8gcG9w\ndWxhdGUgYW4gYXJyYXkgY29weSBvbiB0aGUgaW5pdGlhbCBhc3N1bXB0aW9u\nIHRoYXQgdGhlIGFycmF5CiAgICAgICAgLy8gaXMgZGlydHkKICAgICAgICBP\nYmplY3QgbmV3YSA9IEFycmF5Lm5ld0luc3RhbmNlKGZtZC5nZXRFbGVtZW50\nKCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgIGxlbik7CiAgICAg\nICAgVmFsdWVNZXRhRGF0YSB2bWQgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAg\nICAgIGJvb2xlYW4gcGMgPSB2bWQuaXNEZWNsYXJlZFR5cGVQQygpOwogICAg\nICAgIE9iamVjdCBlbGVtOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbGVuOyBpKyspIHsKICAgICAgICAgICAgZWxlbSA9IEFycmF5LmdldChmcm1h\nLCBpKTsKICAgICAgICAgICAgaWYgKHBjKSB7CiAgICAgICAgICAgICAgICBp\nZiAodm1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfTk9ORSkKICAgICAgICAgICAgICAgICAgICBlbGVtID0gZ2V0UmVm\nZXJlbmNlKG1hbmFnZXIsIGVsZW0sIHNtLCB2bWQpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGVsZW0gPSBtYW5hZ2VyLmF0\ndGFjaChlbGVtLCBudWxsLCBzbSwgdm1kLCBmYWxzZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgZGlmZiA9IGRpZmYgfHwgIWVxdWFscyhlbGVtLCBB\ncnJheS5nZXQodG9hLCBpKSwgcGMpOwogICAgICAgICAgICBBcnJheS5zZXQo\nbmV3YSwgaSwgZWxlbSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoZGlm\nZikgPyBuZXdhIDogdG9hOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIGdpdmVuIG9iamVjdHMgYXJlIGVxdWFsLiBQQ3MgYXJl\nIGNvbXBhcmVkIGZvcgogICAgICogb24gSlZNIGlkZW50aXR5LgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGVxdWFscyhPYmplY3QgYSwg\nT2JqZWN0IGIsIGJvb2xlYW4gcGMpIHsKICAgICAgICBpZiAoYSA9PSBiKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAocGMgfHwgYSA9\nPSBudWxsIHx8IGIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoJCXJldHVybiBhLmVxdWFscyAoYik7Cgl9Cn0K\n","encoding":"base64"}

