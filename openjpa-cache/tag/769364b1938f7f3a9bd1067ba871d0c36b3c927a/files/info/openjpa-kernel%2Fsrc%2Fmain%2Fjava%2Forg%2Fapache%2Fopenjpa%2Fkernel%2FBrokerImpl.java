{"sha":"a690b7a3e1981ec17595ac5c74597ef59f362cf6","node_id":"MDQ6QmxvYjIwNjM2NDphNjkwYjdhM2UxOTgxZWMxNzU5NWFjNWM3NDU5N2VmNTlmMzYyY2Y2","size":166364,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a690b7a3e1981ec17595ac5c74597ef59f362cf6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xs\nZXI7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7\nCmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TeW5jaHJvbml6YXRpb247Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9y\ncy5JdGVyYXRvckNoYWluOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNv\nbGxlY3Rpb25zLm1hcC5JZGVudGl0eU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5Db21wYXRpYmlsaXR5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkRhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5h\nZ2VkUnVudGltZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNl\nLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlv\nbkV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5z\nYWN0aW9uRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNl\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVu\nY2VNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29u\nY3VycmVudC5SZWVudHJhbnRMb2NrOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRT\ndGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk5vVHJhbnNhY3Rpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5PYmplY3RFeGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1l\nRXhjZXB0aW9uVHJhbnNsYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIENvbmNy\nZXRlIHtAbGluayBCcm9rZXJ9LiBUaGUgYnJva2VyIGhhbmRsZXMgb2JqZWN0\nLWxldmVsIGJlaGF2aW9yLAogKiBidXQgbGVhdmVzIGFsbCBpbnRlcmFjdGlv\nbiB3aXRoIHRoZSBkYXRhIHN0b3JlIHRvIGEge0BsaW5rIFN0b3JlTWFuYWdl\ncn0KICogdGhhdCBtdXN0IGJlIHN1cHBsaWVkIGF0IGluaXRpYWxpemF0aW9u\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIEJy\nb2tlckltcGwKICAgIGltcGxlbWVudHMgQnJva2VyLCBGaW5kQ2FsbGJhY2tz\nLCBDbG9uZWFibGUgewoKICAgIC8qKgogICAgICogSW5jcmVtZW50YWwgZmx1\nc2guCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZM\nVVNIX0lOQyA9IDA7CgogICAgLyoqCiAgICAgKiBGbHVzaCBpbiBwcmVwYXJh\ndGlvbiBvZiBjb21taXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgaW50IEZMVVNIX0NPTU1JVCA9IDE7CgogICAgLyoqCiAgICAgKiBG\nbHVzaCB0byBjaGVjayBjb25zaXN0ZW5jeSBvZiBjYWNoZSwgdGhlbiBpbW1l\nZGlhdGVseSByb2xsYmFjayBjaGFuZ2VzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9ST0xMQkFDSyA9IDI7CgogICAg\nLyoqCiAgICAgKiBSdW4gcGVyc2lzdGVuY2UtYnktcmVhY2hhYmlsaXR5IGFu\nZCBvdGhlciBmbHVzaC10aW1lIG9wZXJhdGlvbnMgd2l0aG91dAogICAgICog\nYWNjZXNzaW5nIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfTE9HSUNBTCA9IDM7CgogICAgc3Rh\ndGljIGZpbmFsIGludCBTVEFUVVNfSU5JVCA9IDA7CiAgICBzdGF0aWMgZmlu\nYWwgaW50IFNUQVRVU19UUkFOU0lFTlQgPSAxOwogICAgc3RhdGljIGZpbmFs\nIGludCBTVEFUVVNfT0lEX0FTU0lHTiA9IDI7CiAgICBzdGF0aWMgZmluYWwg\naW50IFNUQVRVU19DT01NSVRfTkVXID0gMzsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19BQ1RJVkUgPSAyIDw8IDA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9BQ1RJVkUgPSAyIDw8IDE7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19DTE9TRV9JTlZP\nS0VEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFU1RPUklORyA9IDIgPDwgMzsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0RFUkVGREVMRVRJTkcgPSAyIDw8IDQ7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSElORyA9IDIgPDwgNTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0ZMVVNI\nSU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfRkxVU0hFRCA9IDIgPDwgNzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8PCA4OwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVNT1RFX0xJU1RFTkVSID0gMiA8\nPCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVUQUlO\nRURfQ09OTiA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDExOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBMb2NhbGl6\nZXIuZm9yUGFja2FnZShCcm9rZXJJbXBsLmNsYXNzKTsKCiAgICAvLwl0aGUg\nc3RvcmUgbWFuYWdlciBpbiB1c2U7IHRoaXMgbWF5IGJlIGEgZGVjb3JhdG9y\nIHN1Y2ggYXMgYQogICAgLy8JZGF0YSBjYWNoZSBzdG9yZSBtYW5hZ2VyIGFy\nb3VuZCB0aGUgbmF0aXZlIHN0b3JlIG1hbmFnZXIKICAgIHByaXZhdGUgRGVs\nZWdhdGluZ1N0b3JlTWFuYWdlciBfc3RvcmUgPSBudWxsOwoKICAgIC8vIHJl\nZiB0byBwcm9kdWNpbmcgZmFjdG9yeSBhbmQgY29uZmlndXJhdGlvbgogICAg\ncHJpdmF0ZSBBYnN0cmFjdEJyb2tlckZhY3RvcnkgX2ZhY3RvcnkgPSBudWxs\nOwogICAgcHJpdmF0ZSBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9IG51\nbGw7CiAgICBwcml2YXRlIENvbXBhdGliaWxpdHkgX2NvbXBhdCA9IG51bGw7\nCiAgICBwcml2YXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMgPSBudWxsOwog\nICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CiAgICBwcml2YXRlIFN0cmlu\nZyBfdXNlciA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFzcyA9IG51\nbGw7CiAgICBwcml2YXRlIE1hbmFnZWRSdW50aW1lIF9ydW50aW1lID0gbnVs\nbDsKICAgIHByaXZhdGUgTG9ja01hbmFnZXIgX2xtID0gbnVsbDsKICAgIHBy\naXZhdGUgSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsKICAgIHByaXZhdGUg\nUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7CiAgICBwcml2YXRlIE9wQ2Fs\nbGJhY2tzIF9jYWxsID0gbnVsbDsKICAgIHByaXZhdGUgUnVudGltZUV4Y2Vw\ndGlvblRyYW5zbGF0b3IgX2V4dHJhbnMgPSBudWxsOwoKICAgIC8vIGNhY2hl\nIGNsYXNzIGxvYWRlciBhc3NvY2lhdGVkIHdpdGggdGhlIGJyb2tlcgogICAg\ncHJpdmF0ZSBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsKCiAgICAvLyB1\nc2VyIHN0YXRlCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlvbiBfc3luYyA9\nIG51bGw7CiAgICBwcml2YXRlIE1hcCBfdXNlck9iamVjdHMgPSBudWxsOwoK\nICAgIC8vIG1hbmFnZWQgb2JqZWN0IGNhY2hlcwogICAgcHJpdmF0ZSBNYW5h\nZ2VkQ2FjaGUgX2NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgVHJhbnNhY3Rp\nb25hbENhY2hlIF90cmFuc0NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0\nIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVy\nZWZDYWNoZSA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVyZWZBZGRpdGlv\nbnMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2xvYWRpbmcgPSBudWxsOwog\nICAgcHJpdmF0ZSBTZXQgX29wZXJhdGluZyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldCBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBf\ndXBkYXRlZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX2RlbGV0ZWRD\nbHNzID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZW5kaW5nID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAgLy8gdHJh\nY2sgaW5zdGFuY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwgYWZ0ZXIg\ndGhlIGZpcnN0IHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRo\nZSB0cmFuc2FjdGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQgX3NhdmVw\nb2ludENhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2VkTWFwIF9zYXZl\ncG9pbnRzID0gbnVsbDsKICAgIHByaXZhdGUgU2F2ZXBvaW50TWFuYWdlciBf\nc3BtID0gbnVsbDsKCiAgICAvLyB0cmFjayBvcGVuIHF1ZXJpZXMgYW5kIGV4\ndGVudHMgc28gd2UgY2FuIGZyZWUgdGhlaXIgcmVzb3VyY2VzIG9uIGNsb3Nl\nCiAgICBwcml2YXRlIFJlZmVyZW5jZUhhc2hTZXQgX3F1ZXJpZXMgPSBudWxs\nOwogICAgcHJpdmF0ZSBSZWZlcmVuY2VIYXNoU2V0IF9leHRlbnRzID0gbnVs\nbDsKCiAgICAvLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVwdGgKICAgIHBy\naXZhdGUgaW50IF9vcGVyYXRpb25Db3VudCA9IDA7CgogICAgLy8gb3B0aW9u\ncwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1JlYWQgPSBmYWxzZTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfbm9udHJhbnNXcml0ZSA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9yZXRhaW5TdGF0ZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBpbnQgX2F1dG9DbGVhciA9IENMRUFSX0RBVEFTVE9SRTsKICAg\nIHByaXZhdGUgaW50IF9yZXN0b3JlU3RhdGUgPSBSRVNUT1JFX0lNTVVUQUJM\nRTsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3B0aW1pc3RpYyA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9pZ25vcmVDaGFuZ2VzID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX211bHRpdGhyZWFkZWQgPSBmYWxzZTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfbWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zeW5jTWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBp\nbnQgX2Nvbm5SZXRhaW5Nb2RlID0gQ09OTl9SRVRBSU5fREVNQU5EOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9ldmljdERhdGFDYWNoZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9wb3B1bGF0ZURhdGFDYWNoZSA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2xhcmdlVHJhbnNhY3Rpb24gPSBmYWxzZTsK\nICAgIHByaXZhdGUgaW50IF9hdXRvRGV0YWNoID0gMDsKICAgIHByaXZhdGUg\naW50IF9kZXRhY2hTdGF0ZSA9IERFVEFDSF9MT0FERUQ7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2RldGFjaGVkTmV3ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfb3JkZXJEaXJ0eSA9IGZhbHNlOwoKICAgIC8vIHN0YXR1cwogICAg\ncHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nY2xvc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIFJ1bnRpbWVFeGNlcHRpb24g\nX2Nsb3NlZEV4Y2VwdGlvbiA9IG51bGw7CgogICAgLy8gZXZlbnQgbWFuYWdl\ncnMKICAgIHByaXZhdGUgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIgX3RyYW5z\nRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF90cmFuc0Nh\nbGxiYWNrTW9kZSA9IDA7CiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFu\nYWdlciBfbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfbGlmZUNhbGxiYWNrTW9kZSA9IDA7CgogICAgcHJpdmF0ZSBib29sZWFu\nIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNUUyA9IG5ldyBPYmpl\nY3RbMF07CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHBlcnNpc3RlbmNlIG1h\nbmFnZXIncyBhdXRoZW50aWNhdGlvbi4gVGhpcyBpcyB0aGUgZmlyc3QKICAg\nICAqIG1ldGhvZCBjYWxsZWQgYWZ0ZXIgY29uc3RydWN0aW9uLgogICAgICoK\nICAgICAqIEBwYXJhbSB1c2VyIHRoZSB1c2VybmFtZSB0aGlzIGJyb2tlciBy\nZXByZXNlbnRzOyB1c2VkIHdoZW4gcG9vbGluZwogICAgICogYnJva2VycyB0\nbyBtYWtlIHN1cmUgdGhhdCBhIHJlcXVlc3QgdG8gdGhlIGZhY3RvcnkgZm9y\nCiAgICAgKiBhIGNvbm5lY3Rpb24gd2l0aCBhbiBleHBsaWNpdCB1c2VyIGlz\nIGRlbGVnYXRlZCB0byBhIHN1aXRhYmxlIGJyb2tlcgogICAgICogQHBhcmFt\nIHBhc3MgdGhlIHBhc3N3b3JkIGZvciB0aGUgYWJvdmUgdXNlcgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRoZW50aWNhdGlvbihTdHJpbmcgdXNl\nciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBfdXNlciA9IHVzZXI7CiAgICAg\nICAgX3Bhc3MgPSBwYXNzOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlh\nbGl6ZSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlci4gVGhpcyBtZXRob2QgaXMg\nY2FsbGVkCiAgICAgKiBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBmYWN0b3J5IGJl\nZm9yZSB1c2UuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhlIGZh\nY3RvcnkgdXNlZCB0byBjcmVhdGUgdGhpcyBicm9rZXIKICAgICAqIEBwYXJh\nbSBzbSBhIGNvbmNyZXRlIFN0b3JlTWFuYWdlciBpbXBsZW1lbnRhdGlvbiB0\nbwogICAgICogaGFuZGxlIGludGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3Rv\ncmUKICAgICAqIEBwYXJhbSBtYW5hZ2VkIHRoZSB0cmFuc2FjdGlvbiBtb2Rl\nCiAgICAgKiBAcGFyYW0gY29ubk1vZGUgdGhlIGNvbm5lY3Rpb24gcmV0YWlu\nIG1vZGUKICAgICAqLwogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZShBYnN0\ncmFjdEJyb2tlckZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBEZWxlZ2F0aW5n\nU3RvcmVNYW5hZ2VyIHNtLCBib29sZWFuIG1hbmFnZWQsIGludCBjb25uTW9k\nZSkgewogICAgICAgIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IHRydWU7CiAg\nICAgICAgX2xvYWRlciA9IChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdl\ndENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKTsKICAgICAgICBfY29uZiA9\nIGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIF9jb21wYXQg\nPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKTsKICAgICAgICBf\nZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAgICAgX2xvZyA9IF9jb25mLmdldExv\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSk7CiAgICAgICAg\nX2NhY2hlID0gbmV3IE1hbmFnZWRDYWNoZShuZXdNYW5hZ2VkT2JqZWN0Q2Fj\naGUoKSk7CiAgICAgICAgX29wZXJhdGluZyA9IE1hcEJhY2tlZFNldC5kZWNv\ncmF0ZShuZXcgSWRlbnRpdHlNYXAoKSk7CiAgICAgICAgX2Nvbm5SZXRhaW5N\nb2RlID0gY29ubk1vZGU7CiAgICAgICAgX21hbmFnZWQgPSBtYW5hZ2VkOwog\nICAgICAgIGlmIChtYW5hZ2VkKQogICAgICAgICAgICBfcnVudGltZSA9IF9j\nb25mLmdldE1hbmFnZWRSdW50aW1lSW5zdGFuY2UoKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9ydW50aW1lID0gbmV3IExvY2FsTWFuYWdlZFJ1bnRp\nbWUodGhpcyk7CgogICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbmV3IExp\nZmVjeWNsZUV2ZW50TWFuYWdlcigKICAgICAgICAgICAgX2NvbmYuZ2V0TG9n\nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19SVU5USU1FKSk7CiAgICAgICAg\nX3RyYW5zRXZlbnRNYW5hZ2VyID0gbmV3IFRyYW5zYWN0aW9uRXZlbnRNYW5h\nZ2VyKCk7CiAgICAgICAgaW50IGNtb2RlID0gX2NvbmYuZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFG\nYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS5nZXRDYWxsYmFja01vZGUoKTsKICAg\nICAgICBzZXRMaWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZShjbW9kZSk7\nCiAgICAgICAgc2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZShj\nbW9kZSk7CgogICAgICAgIC8vIHNldHVwIGRlZmF1bHQgb3B0aW9ucwogICAg\nICAgIF9mYWN0b3J5LmNvbmZpZ3VyZUJyb2tlcih0aGlzKTsKCiAgICAgICAg\nLy8gbWFrZSBzdXJlIHRvIGRvIHRoaXMgYWZ0ZXIgY29uZmlndXJpbmcgYnJv\na2VyIHNvIHRoYXQgc3RvcmUgbWFuYWdlcgogICAgICAgIC8vIGNhbiBsb29r\nIHRvIGJyb2tlciBjb25maWd1cmF0aW9uOyB3ZSBzZXQgYm90aCBzdG9yZSBh\nbmQgbG9jayBtYW5hZ2VycwogICAgICAgIC8vIGJlZm9yZSBpbml0aWFsaXpp\nbmcgdGhlbSBiZWNhdXNlIHRoZXkgbWF5IGVhY2ggdHJ5IHRvIGFjY2VzcyB0\naGUKICAgICAgICAvLyBvdGhlciBpbiB0aGllciBpbml0aWFsaXphdGlvbgog\nICAgICAgIF9zdG9yZSA9IHNtOwogICAgICAgIF9sbSA9IF9jb25mLm5ld0xv\nY2tNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfaW0gPSBfY29uZi5uZXdJ\nbnZlcnNlTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX3NwbSA9IF9jb25m\nLmdldFNhdmVwb2ludE1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9zdG9y\nZS5zZXRDb250ZXh0KHRoaXMpOwogICAgICAgIF9sbS5zZXRDb250ZXh0KHRo\naXMpOwoKICAgICAgICBpZiAoX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVU\nQUlOX0FMV0FZUykKICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlvbigpOwog\nICAgICAgIF9mYyA9IF9zdG9yZS5uZXdGZXRjaENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBfZmMuc2V0Q29udGV4dCh0aGlzKTsKCiAgICAgICAgLy8gc3lu\nY2ggd2l0aCB0aGUgZ2xvYmFsIHRyYW5zYWN0aW9uIGluIHByb2dyZXNzLCBp\nZiBhbnkKICAgICAgICBpZiAoX2ZhY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJh\nbnNhY3Rpb24odGhpcywgZmFsc2UpKQogICAgICAgICAgICBiZWdpbkludGVy\nbmFsKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBjbG9uZSgpCiAgICAg\nICAgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoX2luaXRpYWxpemVXYXNJbnZva2VkKQogICAgICAgICAgICB0aHJv\ndyBuZXcgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEge0BsaW5rIE1h\ncH0gdG8gYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkgbWFuYWdlZCBvYmplY3Qg\nY2FjaGUuCiAgICAgKiBNYXBzIG9pZHMgdG8gc3RhdGUgbWFuYWdlcnMuIEJ5\nIGRlZmF1bHQsIHRoaXMgY3JlYXRlcyBhCiAgICAgKiB7QGxpbmsgUmVmZXJl\nbmNlTWFwfSB3aXRoIHNvZnQgdmFsdWVzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgTWFwIG5ld01hbmFnZWRPYmplY3RDYWNoZSgpIHsKICAgICAgICByZXR1\ncm4gbmV3IFJlZmVyZW5jZUhhc2hNYXAoUmVmZXJlbmNlTWFwLkhBUkQsIFJl\nZmVyZW5jZU1hcC5TT0ZUKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBT\ndG9yZUNvbnRleHQKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgQnJva2VyIGdldEJyb2tlcigpIHsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLwogICAg\nLy8gUHJvcGVydGllcwogICAgLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMg\ndm9pZCBzZXRJbXBsaWNpdEJlaGF2aW9yKE9wQ2FsbGJhY2tzIGNhbGwsCiAg\nICAgICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgZXgpIHsKICAgICAg\nICBpZiAoX2NhbGwgPT0gbnVsbCkKICAgICAgICAgICAgX2NhbGwgPSBjYWxs\nOwogICAgICAgIGlmIChfZXh0cmFucyA9PSBudWxsKQogICAgICAgICAgICBf\nZXh0cmFucyA9IGV4OwogICAgfQoKICAgIFJ1bnRpbWVFeGNlcHRpb25UcmFu\nc2xhdG9yIGdldEluc3RhbmNlRXhjZXB0aW9uVHJhbnNsYXRvcigpIHsKICAg\nICAgICByZXR1cm4gKF9vcGVyYXRpb25Db3VudCA9PSAwKSA/IF9leHRyYW5z\nIDogbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgQnJva2VyRmFjdG9yeSBnZXRC\ncm9rZXJGYWN0b3J5KCkgewogICAgICAgIHJldHVybiBfZmFjdG9yeTsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmln\ndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAg\ncHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKSB7CiAgICAgICAgcmV0dXJuIF9mYzsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldENvbm5lY3Rpb25SZXRhaW5Nb2RlKCkgewogICAgICAgIHJldHVy\nbiBfY29ublJldGFpbk1vZGU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNNYW5hZ2VkKCkgewogICAgICAgIHJldHVybiBfbWFuYWdlZDsKICAgIH0K\nCiAgICBwdWJsaWMgTWFuYWdlZFJ1bnRpbWUgZ2V0TWFuYWdlZFJ1bnRpbWUo\nKSB7CiAgICAgICAgcmV0dXJuIF9ydW50aW1lOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzc0xvYWRlciBnZXRDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1\ncm4gX2xvYWRlcjsKICAgIH0KCiAgICBwdWJsaWMgRGVsZWdhdGluZ1N0b3Jl\nTWFuYWdlciBnZXRTdG9yZU1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9z\ndG9yZTsKICAgIH0KCiAgICBwdWJsaWMgTG9ja01hbmFnZXIgZ2V0TG9ja01h\nbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sbTsKICAgIH0KCiAgICBwdWJs\naWMgSW52ZXJzZU1hbmFnZXIgZ2V0SW52ZXJzZU1hbmFnZXIoKSB7CiAgICAg\nICAgcmV0dXJuIF9pbTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENv\nbm5lY3Rpb25Vc2VyTmFtZSgpIHsKICAgICAgICByZXR1cm4gX3VzZXI7CiAg\nICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uUGFzc3dvcmQo\nKSB7CiAgICAgICAgcmV0dXJuIF9wYXNzOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldE11bHRpdGhyZWFkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9t\ndWx0aXRocmVhZGVkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE11bHRp\ndGhyZWFkZWQoYm9vbGVhbiBtdWx0aXRocmVhZGVkKSB7CiAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgIF9tdWx0aXRocmVhZGVkID0gbXVsdGl0aHJl\nYWRlZDsKICAgICAgICBpZiAobXVsdGl0aHJlYWRlZCAmJiBfbG9jayA9PSBu\ndWxsKQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVudHJhbnRMb2NrKCk7\nCiAgICAgICAgZWxzZSBpZiAoIW11bHRpdGhyZWFkZWQpCiAgICAgICAgICAg\nIF9sb2NrID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJ\nZ25vcmVDaGFuZ2VzKCkgewogICAgICAgIHJldHVybiBfaWdub3JlQ2hhbmdl\nczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25vcmVDaGFuZ2VzKGJv\nb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9p\nZ25vcmVDaGFuZ2VzID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGdldE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkgewogICAgICAgIHJldHVybiBf\nbm9udHJhbnNSZWFkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE5vbnRy\nYW5zYWN0aW9uYWxSZWFkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5H\nKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsKCiAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAgICAgICAg\naWYgKHZhbCAmJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5z\nCiAgICAgICAgICAgIChfY29uZi5PUFRJT05fTk9OVFJBTlNfUkVBRCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9j\nLmdldAogICAgICAgICAgICAgICAgKCJub250cmFucy1yZWFkLW5vdC1zdXBw\nb3J0ZWQiKSk7CgogICAgICAgIF9ub250cmFuc1JlYWQgPSB2YWw7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRl\nKCkgewogICAgICAgIHJldHVybiBfbm9udHJhbnNXcml0ZTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsV3JpdGUoYm9vbGVh\nbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxlZ2FsLW9wLWlu\nLXByZXN0b3JlIikpOwoKICAgICAgICBfbm9udHJhbnNXcml0ZSA9IHZhbDsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcHRpbWlzdGljKCkgewog\nICAgICAgIHJldHVybiBfb3B0aW1pc3RpYzsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRPcHRpbWlzdGljKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUp\nICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIsCiAgICAgICAgICAgICAg\nICAiT3B0aW1pc3RpYyIpKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBy\ndW50aW1lIHN1cHBvcnRzIGl0CiAgICAgICAgaWYgKHZhbCAmJiAhX2NvbmYu\nc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9PUFRJ\nTUlTVElDKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoIm9wdGltaXN0aWMt\nbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgX29wdGltaXN0aWMgPSB2YWw7\nCiAgICB9CgogICAgcHVibGljIGludCBnZXRSZXN0b3JlU3RhdGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9yZXN0b3JlU3RhdGU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0UmVzdG9yZVN0YXRlKGludCB2YWwpIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkg\nIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgidHJhbnMtYWN0aXZlIiwKICAgICAgICAgICAgICAg\nICJSZXN0b3JlIikpOwoKICAgICAgICBfcmVzdG9yZVN0YXRlID0gdmFsOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFpblN0YXRlKCkgewog\nICAgICAgIHJldHVybiBfcmV0YWluU3RhdGU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0UmV0YWluU3RhdGUoYm9vbGVhbiB2YWwpIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNU\nT1JJTkcpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJpbGxlZ2FsLW9wLWluLXByZXN0b3JlIikpOwogICAg\nICAgIF9yZXRhaW5TdGF0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIGdldEF1dG9DbGVhcigpIHsKICAgICAgICByZXR1cm4gX2F1dG9DbGVhcjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQ2xlYXIoaW50IHZhbCkg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfYXV0b0NsZWFyID0g\ndmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QXV0b0RldGFjaCgpIHsK\nICAgICAgICByZXR1cm4gX2F1dG9EZXRhY2g7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0QXV0b0RldGFjaChpbnQgZGV0YWNoRmxhZ3MpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2F1dG9EZXRhY2ggPSBkZXRhY2hG\nbGFnczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvRGV0YWNoKGlu\ndCBkZXRhY2hGbGFnLCBib29sZWFuIG9uKSB7CiAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgIGlmIChvbikKICAgICAgICAgICAgX2F1dG9EZXRhY2gg\nfD0gZGV0YWNoRmxhZzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9hdXRv\nRGV0YWNoICY9IH5kZXRhY2hGbGFnOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0RGV0YWNoU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9kZXRhY2hTdGF0\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hTdGF0ZShpbnQg\nbW9kZSkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfZGV0YWNo\nU3RhdGUgPSBtb2RlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGV0\nYWNoZWROZXcoKSB7CiAgICAgICAgcmV0dXJuIF9kZXRhY2hlZE5ldzsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hlZE5ldyhib29sZWFuIGlz\nTmV3KSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9kZXRhY2hl\nZE5ldyA9IGlzTmV3OwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFN5\nbmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9ucygpIHsKICAgICAgICByZXR1cm4g\nX3N5bmNNYW5hZ2VkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFN5bmNX\naXRoTWFuYWdlZFRyYW5zYWN0aW9ucyhib29sZWFuIHN5bmMpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX3N5bmNNYW5hZ2VkID0gc3luYzsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRFdmljdEZyb21EYXRhQ2Fj\naGUoKSB7CiAgICAgICAgcmV0dXJuIF9ldmljdERhdGFDYWNoZTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRFdmljdEZyb21EYXRhQ2FjaGUoYm9vbGVh\nbiBldmljdCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfZXZp\nY3REYXRhQ2FjaGUgPSBldmljdDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRQb3B1bGF0ZURhdGFDYWNoZSgpIHsKICAgICAgICByZXR1cm4gX3Bv\ncHVsYXRlRGF0YUNhY2hlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFBv\ncHVsYXRlRGF0YUNhY2hlKGJvb2xlYW4gY2FjaGUpIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgX3BvcHVsYXRlRGF0YUNhY2hlID0gY2FjaGU7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFja0NoYW5nZXNCeVR5\ncGUoKSB7CiAgICAgICAgcmV0dXJuIF9sYXJnZVRyYW5zYWN0aW9uOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFRyYWNrQ2hhbmdlc0J5VHlwZShib29s\nZWFuIGxhcmdlVHJhbnNhY3Rpb24pIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgX2xhcmdlVHJhbnNhY3Rpb24gPSBsYXJnZVRyYW5zYWN0aW9u\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VXNlck9iamVjdChPYmpl\nY3Qga2V5KSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX3VzZXJPYmplY3RzID09\nIG51bGwpID8gbnVsbCA6IF91c2VyT2JqZWN0cy5nZXQoa2V5KTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBwdXRVc2VyT2JqZWN0\nKE9iamVjdCBrZXksIE9iamVjdCB2YWwpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHZh\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIChfdXNlck9iamVj\ndHMgPT0gbnVsbCkgPyBudWxsIDogX3VzZXJPYmplY3RzLnJlbW92ZShrZXkp\nOwoKICAgICAgICAgICAgaWYgKF91c2VyT2JqZWN0cyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgX3VzZXJPYmplY3RzID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5wdXQoa2V5LCB2YWwpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vCiAgICAvLyBFdmVu\ndHMKICAgIC8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBhZGRMaWZlY3lj\nbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIsIENsYXNzW10gY2xhc3Nlcykg\newogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBfbGlmZUV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcihs\naXN0ZW5lciwgY2xhc3Nlcyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJlbW92ZUxpZmVjeWNsZUxpc3RlbmVyKE9iamVjdCBsaXN0\nZW5lcikgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBfbGlmZUV2ZW50TWFuYWdlci5yZW1vdmVM\naXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01vZGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9saWZlQ2FsbGJhY2tNb2RlOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldExpZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2Rl\nKGludCBtb2RlKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlQ2FsbGJhY2tNb2RlID0g\nbW9kZTsKICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFnZXIuc2V0RmFpbEZh\nc3QoKG1vZGUgJiBDQUxMQkFDS19GQUlMX0ZBU1QpICE9IDApOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdpdmUgc3RhdGUgbWFuYWdl\ncnMgYWNjZXNzIHRvIHRoZSBsaWZlY3ljbGUgZXZlbnQgbWFuYWdlci4KICAg\nICAqLwogICAgcHVibGljIExpZmVjeWNsZUV2ZW50TWFuYWdlciBnZXRMaWZl\nY3ljbGVFdmVudE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9saWZlRXZl\nbnRNYW5hZ2VyOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBnaXZlbiBs\naWZlY3ljbGUgZXZlbnQsIGhhbmRsaW5nIGFueSBleGNlcHRpb25zIGFwcHJv\ncHJpYXRlbHkuCiAgICAgKgogICAgICogQHJldHVybiB3aGV0aGVyIGV2ZW50\ncyBhcmUgYmVpbmcgcHJvY2Vzc2VkIGF0IHRoaXMgdGltZQogICAgICovCiAg\nICBib29sZWFuIGZpcmVMaWZlY3ljbGVFdmVudChPYmplY3Qgc3JjLCBPYmpl\nY3QgcmVsYXRlZCwgQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIGludCBl\ndmVudFR5cGUpIHsKICAgICAgICBpZiAoX2xpZmVFdmVudE1hbmFnZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGhhbmRs\nZUNhbGxiYWNrRXhjZXB0aW9ucyhfbGlmZUV2ZW50TWFuYWdlci5maXJlRXZl\nbnQoc3JjLCByZWxhdGVkLCAKICAgICAgICAgICAgbWV0YSwgZXZlbnRUeXBl\nKSwgX2xpZmVDYWxsYmFja01vZGUpOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogVGFrZSBhY3Rpb25zIG9uIGNhbGxiYWNr\nIGV4Y2VwdGlvbnMgZGVwZW5kaW5nIG9uIGNhbGxiYWNrIG1vZGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBoYW5kbGVDYWxsYmFja0V4Y2VwdGlvbnMo\nRXhjZXB0aW9uW10gZXhjZXBzLCBpbnQgbW9kZSkgewogICAgICAgIGlmIChl\neGNlcHMubGVuZ3RoID09IDAgfHwgKG1vZGUgJiBDQUxMQkFDS19JR05PUkUp\nICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT3BlbkpQQUV4\nY2VwdGlvbiBjZTsKICAgICAgICBpZiAoZXhjZXBzLmxlbmd0aCA9PSAxKQog\nICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihleGNlcHNb\nMF0pOwogICAgICAgIGVsc2UgCiAgICAgICAgICAgIGNlID0gbmV3IENhbGxi\nYWNrRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWxsYmFjay1lcnIiKSkuCiAgICAg\nICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGV4Y2Vwcyk7CiAgICAg\nICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUk9MTEJBQ0spICE9IDAgJiYgKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgIGNlLnNl\ndEZhdGFsKHRydWUpOwogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRl\ncm5hbChjZSk7CiAgICAgICAgfQogICAgICAgIGlmICgobW9kZSAmIENBTExC\nQUNLX0xPRykgIT0gMCAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAg\nICAgICAgX2xvZy53YXJuKGNlKTsKICAgICAgICBpZiAoKG1vZGUgJiBDQUxM\nQkFDS19SRVRIUk9XKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBjZTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRUcmFuc2FjdGlvbkxpc3RlbmVyKE9i\namVjdCB0bCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIuYWRk\nTGlzdGVuZXIodGwpOwogICAgICAgICAgICBpZiAodGwgaW5zdGFuY2VvZiBS\nZW1vdGVDb21taXRFdmVudE1hbmFnZXIpCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19SRU1PVEVfTElTVEVORVI7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRyYW5zYWN0aW9uTGlzdGVuZXIo\nT2JqZWN0IHRsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFn\nZXIucmVtb3ZlTGlzdGVuZXIodGwpCiAgICAgICAgICAgICAgICAmJiAodGwg\naW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpKQogICAgICAg\nICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFTU9URV9MSVNURU5FUjsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRUcmFuc2FjdGlv\nbkxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJldHVybiBfdHJh\nbnNDYWxsYmFja01vZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJh\nbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfdHJhbnNDYWxsYmFja01vZGUgPSBtb2RlOwogICAgICAgICAg\nICBfdHJhbnNFdmVudE1hbmFnZXIuc2V0RmFpbEZhc3QoKG1vZGUgJiBDQUxM\nQkFDS19GQUlMX0ZBU1QpICE9IDApOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gdHJhbnNhY3Rpb24gZXZlbnQsIGhh\nbmRsaW5nIGFueSBleGNlcHRpb25zIGFwcHJvcHJpYXRlbHkuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBmaXJlVHJhbnNhY3Rpb25FdmVudChUcmFuc2Fj\ndGlvbkV2ZW50IHRyYW5zKSB7CiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFu\nYWdlciAhPSBudWxsKQogICAgICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2Vw\ndGlvbnMoX3RyYW5zRXZlbnRNYW5hZ2VyLmZpcmVFdmVudCh0cmFucyksCiAg\nICAgICAgICAgICAgICBfdHJhbnNDYWxsYmFja01vZGUpOwogICAgfQoKICAg\nIC8vLy8vLy8vLy8vCiAgICAvLyBMb29rdXBzCiAgICAvLy8vLy8vLy8vLwoK\nICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lkLCBib29sZWFuIHZh\nbGlkYXRlLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpbnQgZmxh\nZ3MgPSBPSURfQ09QWSB8IE9JRF9BTExPV19ORVcgfCBPSURfTk9ERUxFVEVE\nOwogICAgICAgIGlmICghdmFsaWRhdGUpCiAgICAgICAgICAgIGZsYWdzIHw9\nIE9JRF9OT1ZBTElEQVRFOwogICAgICAgIHJldHVybiBmaW5kKG9pZCwgX2Zj\nLCBudWxsLCBudWxsLCBmbGFncywgY2FsbCk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgQml0U2V0IGV4Y2x1ZGUsCiAgICAgICAgT2JqZWN0IGVkYXRhLCBp\nbnQgZmxhZ3MpIHsKICAgICAgICByZXR1cm4gZmluZChvaWQsIGZldGNoLCBl\neGNsdWRlLCBlZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgZmluZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nT2JqZWN0IGZpbmQoT2JqZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBCaXRTZXQgZXhjbHVkZSwKICAgICAgICBPYmplY3QgZWRhdGEsIGlu\ndCBmbGFncywgRmluZENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKGNh\nbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IHRoaXM7CiAgICAgICAg\nb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2lkKTsKICAgICAgICBpZiAo\nb2lkID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9O\nT1ZBTElEQVRFKSA9PSAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLW9pZCIpKTsK\nICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51\nbGwpOwogICAgICAgIH0KICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAg\nICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vbnRy\nYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAvLyBjYWNoZWQgaW5z\ndGFuY2U/CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRT\ndGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsCiAgICAgICAgICAgICAgICAoZmxh\nZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwIHx8IChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIRUQpICE9IDApOwogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKCFyZXF1aXJlc0xvYWQoc20sIHRydWUsIGZl\ndGNoLCBlZGF0YSwgZmxhZ3MpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CgogICAgICAgICAgICAg\nICAgaWYgKCFzbS5pc0xvYWRpbmcoKSkgewogICAgICAgICAgICAgICAgICAg\nIC8vIG1ha2Ugc3VyZSBhbGwgdGhlIGNvbmZpZ3VyZWQgZmllbGRzIGFyZSBs\nb2FkZWQ7IGRvIHRoaXMKICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciBt\nYWtpbmcgaW5zdGFuY2UgdHJhbnNhY3Rpb25hbCBmb3IgbG9ja2luZwogICAg\nICAgICAgICAgICAgICAgIGlmICghc20uaXNUcmFuc2FjdGlvbmFsKCkgJiYg\ndXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAg\nICAgIGJvb2xlYW4gbG9hZGVkOwogICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZCA9IHNtLmxvYWQoZmV0\nY2gsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZXhjbHVkZSwgZWRhdGEsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbiBvbmZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3Mg\nJiBPSURfTk9ERUxFVEVEKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIG5vIGRhdGEgbmVlZGVkIHRvIGJlIGxvYWRlZCBhbmQgdGhl\nIHVzZXIgd2FudHMgdG8KICAgICAgICAgICAgICAgICAgICAvLyB2YWxpZGF0\nZSwganVzdCBtYWtlIHN1cmUgdGhlIG9iamVjdCBleGlzdHMKICAgICAgICAg\nICAgICAgICAgICBpZiAoIWxvYWRlZCAmJiAoZmxhZ3MgJiBPSURfTk9WQUxJ\nREFURSkgPT0gMAogICAgICAgICAgICAgICAgICAgICAgICAmJiBfY29tcGF0\nLmdldFZhbGlkYXRlVHJ1ZUNoZWNrc1N0b3JlKCkKICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgIXNtLmlzVHJhbnNhY3Rpb25hbCgpCiAgICAgICAgICAg\nICAgICAgICAgICAgICYmICFfc3RvcmUuZXhpc3RzKHNtLCBlZGF0YSkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RF\nTEVURUQpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJkZWwt\naW5zdGFuY2UiLCBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgb2lkKSkuCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBzaW5jZSB0\naGUgb2JqZWN0IHdhcyBjYWNoZWQsIHdlIG1heSBuZWVkIHRvIHVwZ3JhZGUg\nbG9jawogICAgICAgICAgICAgICAgLy8gaWYgY3VycmVudCBsZXZlbCBpcyBo\naWdoZXIgdGhhbiBsZXZlbCBvZiBpbml0aWFsIGxvYWQKICAgICAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApIHsKICAgICAg\nICAgICAgICAgICAgICBpbnQgbGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xl\ndmVsKCk7CiAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVs\nLCBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBlZGF0YSk7CiAgICAgICAgICAg\nICAgICAgICAgc20ucmVhZExvY2tlZChsZXZlbCwgZmV0Y2guZ2V0V3JpdGVM\nb2NrTGV2ZWwoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG5vIGNhY2hlZCBz\nbSBmb3IgYSBuZXcvdHJhbnNpZW50IGlkIHR5cGUsIHdlCiAgICAgICAgICAg\nIC8vIGl0IGRlZmluaXRlbHkgZG9lc24ndCBleGlzdAogICAgICAgICAgICBp\nZiAob2lkIGluc3RhbmNlb2YgU3RhdGVNYW5hZ2VySWQpCiAgICAgICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7Cgog\nICAgICAgICAgICAvLyBpbml0aWFsaXplIGEgbmV3IHN0YXRlIG1hbmFnZXIg\nZm9yIHRoZSBkYXRhc3RvcmUgaW5zdGFuY2UKICAgICAgICAgICAgc20gPSBu\nZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NPUFkpICE9\nIDApOwogICAgICAgICAgICBib29sZWFuIGxvYWQgPSByZXF1aXJlc0xvYWQo\nc20sIGZhbHNlLCBmZXRjaCwgZWRhdGEsIGZsYWdzKTsKICAgICAgICAgICAg\nc20gPSBpbml0aWFsaXplKHNtLCBsb2FkLCBmZXRjaCwgZWRhdGEpOwogICAg\nICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihvaWQp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihv\naWQsIG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBtYWtl\nIHN1cmUgYWxsIGNvbmZpZ3VyZWQgZmllbGRzIHdlcmUgbG9hZGVkCiAgICAg\nICAgICAgIGlmIChsb2FkKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFuYWdlcklt\ncGwuTE9BRF9GR1MsIGV4Y2x1ZGUsCiAgICAgICAgICAgICAgICAgICAgICAg\nIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbiBvbmZlKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVURUQpICE9IDAKICAgICAgICAg\nICAgICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9\nIDApCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQs\nIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nbml0aWFsaXplIGEgbmV3bHktY29uc3RydWN0ZWQgc3RhdGUgbWFuYWdlci4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgaW5pdGlh\nbGl6ZShTdGF0ZU1hbmFnZXJJbXBsIHNtLCBib29sZWFuIGxvYWQsCiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgZWRhdGEpIHsK\nICAgICAgICBpZiAoIWxvYWQpIHsKICAgICAgICAgICAgc20uaW5pdGlhbGl6\nZShzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAg\nICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBQQ1N0YXRlIHN0YXRlID0gKHVzZVRyYW5zYWN0aW9uYWxT\ndGF0ZShmZXRjaCkpCiAgICAgICAgICAgICAgICA/IFBDU3RhdGUuUENMRUFO\nIDogUENTdGF0ZS5QTk9OVFJBTlM7CiAgICAgICAgICAgIHNtLnNldExvYWRp\nbmcodHJ1ZSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nZiAoIV9zdG9yZS5pbml0aWFsaXplKHNtLCBzdGF0ZSwgZmV0Y2gsIGVkYXRh\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHNtLnNldExvYWRpbmco\nZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBzbTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZmluZEFsbChDb2xs\nZWN0aW9uIG9pZHMsIGJvb2xlYW4gdmFsaWRhdGUsCiAgICAgICAgRmluZENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaW50IGZsYWdzID0gT0lEX0NPUFkg\nfCBPSURfQUxMT1dfTkVXIHwgT0lEX05PREVMRVRFRDsKICAgICAgICBpZiAo\nIXZhbGlkYXRlKQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9WQUxJREFU\nRTsKICAgICAgICByZXR1cm4gZmluZEFsbChvaWRzLCBfZmMsIG51bGwsIG51\nbGwsIGZsYWdzLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10g\nZmluZEFsbChDb2xsZWN0aW9uIG9pZHMsIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IGVkYXRhLCBp\nbnQgZmxhZ3MpIHsKICAgICAgICByZXR1cm4gZmluZEFsbChvaWRzLCBmZXRj\naCwgZXhjbHVkZSwgZWRhdGEsIGZsYWdzLCBudWxsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEludGVybmFsIGZpbmRlci4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUsIE9i\namVjdCBlZGF0YSwgaW50IGZsYWdzLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBmaW5kQWxsRGVwdGggKys7CgogICAgICAgIC8vIHRocm93IGFu\neSBleGNlcHRpb25zIGZvciBudWxsIG9pZHMgdXAgaW1tZWRpYXRlbHkKICAg\nICAgICBpZiAob2lkcyA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTnVsbFBvaW50ZXJFeGNlcHRpb24oIm9pZHMgPT0gbnVsbCIpOwogICAgICAg\nIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCAmJiBvaWRzLmNv\nbnRhaW5zKG51bGwpKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibnVsbC1vaWRzIikpOwoKICAgICAgICAvLyB3ZSBo\nYXZlIHRvIHVzZSBhIG1hcCBvZiBvaWQtPnNtIHJhdGhlciB0aGFuIGEgc2lt\ncGxlCiAgICAgICAgLy8gYXJyYXksIHNvIHRoYXQgd2UgbWFrZSBzdXJlIG5v\ndCB0byBjcmVhdGUgbXVsdGlwbGUgc21zIGZvciBlcXVpdmFsZW50CiAgICAg\nICAgLy8gb2lkcyBpZiB0aGUgdXNlciBoYXMgZHVwbGljYXRlcyBpbiB0aGUg\nZ2l2ZW4gYXJyYXkKICAgICAgICBpZiAoX2xvYWRpbmcgPT0gbnVsbCkKICAg\nICAgICAgICAgX2xvYWRpbmcgPSBuZXcgSGFzaE1hcCgoaW50KSAob2lkcy5z\naXplKCkgKiAxLjMzICsgMSkpOwoKICAgICAgICBpZiAoY2FsbCA9PSBudWxs\nKQogICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBpZiAoZmV0Y2gg\nPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAv\nLyBjb2xsZWN0aW9uIG9mIHN0YXRlIG1hbmFnZXJzIHRvIHBhc3MgdG8gc3Rv\ncmUgbWFuYWdlcgogICAgICAgICAgICBMaXN0IGxvYWQgPSBudWxsOwogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBib29s\nZWFuIGluaXRpYWxpemVkOwogICAgICAgICAgICBib29sZWFuIHRyYW5zU3Rh\ndGUgPSB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpOwogICAgICAgICAg\nICBPYmplY3Qgb2JqLCBvaWQ7CiAgICAgICAgICAgIGludCBpZHggPSAwOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9pZHMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTsgaWR4KyspIHsKICAgICAgICAgICAgICAgIC8v\nIGlmIHdlJ3ZlIGFscmVhZHkgc2VlbiB0aGlzIG9pZCwgc2tpcCByZXBlYXRz\nCiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2JqKTsKICAgICAg\nICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCB8fCBfbG9hZGluZy5jb250YWlu\nc0tleShvYmopKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgYSBjYWNoZWQgaW5z\ndGFuY2Ugb3IgaXQgaXMgbm90IHRyYW5zYWN0aW9uYWwKICAgICAgICAgICAg\nICAgIC8vIGFuZCBpcyBob2xsb3cgb3Igd2UgbmVlZCB0byB2YWxpZGF0ZSwg\nbG9hZCBpdAogICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsQnlJZChvaWQsIChmbGFncyAmIE9JRF9BTExPV19ORVcpICE9IDAKICAg\nICAgICAgICAgICAgICAgICB8fCAoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAh\nPSAwKTsKICAgICAgICAgICAgICAgIGluaXRpYWxpemVkID0gc20gIT0gbnVs\nbDsKICAgICAgICAgICAgICAgIGlmICghaW5pdGlhbGl6ZWQpCiAgICAgICAg\nICAgICAgICAgICAgc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZs\nYWdzICYgT0lEX0NPUFkpICE9IDApOwoKICAgICAgICAgICAgICAgIF9sb2Fk\naW5nLnB1dChvYmosIHNtKTsKICAgICAgICAgICAgICAgIGlmIChyZXF1aXJl\nc0xvYWQoc20sIGluaXRpYWxpemVkLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkg\newogICAgICAgICAgICAgICAgICAgIHRyYW5zU3RhdGUgPSB0cmFuc1N0YXRl\nIHx8IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGluaXRpYWxpemVkICYmICFzbS5pc1RyYW5zYWN0aW9u\nYWwoKSAmJiB0cmFuc1N0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICBz\nbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxv\nYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5l\ndyBBcnJheUxpc3Qob2lkcy5zaXplKCkgLSBpZHgpOwogICAgICAgICAgICAg\nICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRp\nYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCksCiAg\nICAgICAgICAgICAgICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gcGFzcyBhbGwgc3RhdGUgbWFuYWdl\ncnMgaW4gbmVlZCBvZiBsb2FkaW5nIG9yIHZhbGlkYXRpb24gdG8gdGhlCiAg\nICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAgaWYgKGxv\nYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZSA9\nICh0cmFuc1N0YXRlKSA/IFBDU3RhdGUuUENMRUFOCiAgICAgICAgICAgICAg\nICAgICAgOiBQQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgICAgIENv\nbGxlY3Rpb24gZmFpbGVkID0gX3N0b3JlLmxvYWRBbGwobG9hZCwgc3RhdGUs\nCiAgICAgICAgICAgICAgICAgICAgU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURf\nTk9ORSwgZmV0Y2gsIGVkYXRhKTsKCiAgICAgICAgICAgICAgICAvLyBzZXQg\nZmFpbGVkIGluc3RhbmNlcyB0byBudWxsCiAgICAgICAgICAgICAgICBpZiAo\nZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9\nIDApCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld09iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uKGZhaWxlZCk7CiAgICAgICAgICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1\ndChpdHIubmV4dCgpLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gY3JlYXRlIHJlc3VsdHMgYXJyYXk7\nIG1ha2Ugc3VyZSBhbGwgY29uZmlndXJlZCBmaWVsZHMgYXJlCiAgICAgICAg\nICAgIC8vIGxvYWRlZCBpbiBlYWNoIGluc3RhbmNlCiAgICAgICAgICAgIE9i\namVjdFtdIHJlc3VsdHMgPSBuZXcgT2JqZWN0W29pZHMuc2l6ZSgpXTsKICAg\nICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSAoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDA7CiAgICAgICAgICAgIGludCBsZXZlbCA9IGZldGNoLmdldFJl\nYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAgaWR4ID0gMDsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICBvaWQgPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1w\nbCkgX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCAmJiByZXF1aXJlc0xvYWQoc20sIHRydWUsIGZldGNoLCBlZGF0\nYSwgZmxhZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2Vy\nSW1wbC5MT0FEX0ZHUywKICAgICAgICAgICAgICAgICAgICAgICAgCWV4Y2x1\nZGUsIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChhY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sbS5s\nb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRhdGEp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20ucmVhZExvY2tlZChs\nZXZlbCwgZmV0Y2guZ2V0V3JpdGVMb2NrTGV2ZWwoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9u\nZmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9J\nRF9OT0RFTEVURUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgc20gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdHNbaWR4XSA9\nIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGZpbmRBbGxEZXB0aC0tOwogICAg\nICAgICAgICBpZiAoZmluZEFsbERlcHRoID09IDApCiAgICAgICAgICAgICAg\nICBfbG9hZGluZyA9IG51bGw7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHRoZSBnaXZlbiBpbnN0YW5jZSBuZWVkcyBsb2FkaW5nIGJlZm9yZSBi\nZWluZyByZXR1cm5lZAogICAgICogdG8gdGhlIHVzZXIuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiByZXF1aXJlc0xvYWQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgYm9vbGVhbiBpbml0aWFsaXplZCwKICAgICAgICBGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7\nCiAgICAgICAgaWYgKCFmZXRjaC5yZXF1aXJlc0xvYWQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9W\nQUxJREFURSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKGVkYXRhICE9IG51bGwpIC8vIHRha2UgYWR2YW50YWdlIG9mIGV4\naXN0aW5nIHJlc3VsdAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICBpZiAoaW5pdGlhbGl6ZWQgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3Rh\ndGUuSE9MTE9XKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\naWYgKCFpbml0aWFsaXplZCAmJiBzbS5nZXRNZXRhRGF0YSgpLmdldFBDU3Vi\nY2xhc3NlcygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIHJldHVybiAhX2NvbXBhdC5nZXRWYWxpZGF0ZUZhbHNlUmV0\ndXJuc0hvbGxvdygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgdG8gdXNlIGEgdHJhbnNhY3Rpb25hbCBzdGF0ZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwICYmICghX29wdGltaXN0aWMKICAgICAg\nICAgICAgfHwgX2F1dG9DbGVhciA9PSBDTEVBUl9BTEwKICAgICAgICAgICAg\nfHwgZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpICE9IExPQ0tfTk9ORSk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBmaW5kQ2FjaGVkKE9iamVjdCBvaWQs\nIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsID09IG51\nbGwpCiAgICAgICAgICAgIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9IGNh\nbGwucHJvY2Vzc0FyZ3VtZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9p\nZCwgbnVsbCk7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsIHRydWUpOwogICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0T2JqZWN0SWRUeXBl\nKENsYXNzIGNscykgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgp\nLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9hZGVyLCBm\nYWxzZSk7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwKICAgICAgICAg\nICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9VTktOT1dOKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENs\nYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKCiAgICAgICAgICAgIHJl\ndHVybiBfc3RvcmUuZ2V0RGF0YVN0b3JlSWRUeXBlKG1ldGEpOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihy\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3\nT2JqZWN0SWQoQ2xhc3MgY2xzLCBPYmplY3QgdmFsKSB7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRh\nRGF0YShjbHMsIF9sb2FkZXIsIHRydWUpOwogICAgICAgICAgICBzd2l0Y2gg\nKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSBD\nbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRToKICAgICAgICAgICAgICAgIC8v\nIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIgZm9yIGRhdGFzdG9yZSBpZHMK\nICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcKICAg\nICAgICAgICAgICAgICAgICAmJiAoKFN0cmluZykgdmFsKS5zdGFydHNXaXRo\nKFN0YXRlTWFuYWdlcklkLlNUUklOR19QUkVGSVgpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySWQoKFN0cmluZykgdmFs\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUubmV3RGF0YVN0b3Jl\nSWQodmFsLCBtZXRhKTsKICAgICAgICAgICAgY2FzZSBDbGFzc01ldGFEYXRh\nLklEX0FQUExJQ0FUSU9OOgogICAgICAgICAgICAgICAgaWYgKEltcGxIZWxw\nZXIuaXNBc3NpZ25hYmxlKG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCksIAogICAg\nICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpKSkgewogICAgICAgICAg\nICAgICAgICAgIGlmICghbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpIAogICAg\nICAgICAgICAgICAgICAgICAgICAmJiBtZXRhLmlzT2JqZWN0SWRUeXBlU2hh\ncmVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT2Jq\nZWN0SWQoY2xzLCB2YWwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2\nYWw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3Ry\naW5naWZpZWQgYXBwIGlkPwogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0\nYW5jZW9mIFN0cmluZyAKICAgICAgICAgICAgICAgICAgICAmJiAhX2NvbmYu\nZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICAg\nICAgICAgIGdldFN0cmljdElkZW50aXR5VmFsdWVzKCkKICAgICAgICAgICAg\nICAgICAgICAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZp\nZXJzKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQQ1JlZ2lzdHJ5\nLm5ld09iamVjdElkKGNscywgKFN0cmluZykgdmFsKTsKCiAgICAgICAgICAg\nICAgICBPYmplY3RbXSBhcnIgPSAodmFsIGluc3RhbmNlb2YgT2JqZWN0W10p\nID8gKE9iamVjdFtdKSB2YWwKICAgICAgICAgICAgICAgICAgICA6IG5ldyBP\nYmplY3RbXXsgdmFsIH07CiAgICAgICAgICAgICAgICByZXR1cm4gQXBwbGlj\nYXRpb25JZHMuZnJvbVBLVmFsdWVzKGFyciwgbWV0YSk7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBjbHMpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoQ2xh\nc3NDYXN0RXhjZXB0aW9uIGNjZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWlkLXZhbHVlIiwgdmFsLAog\nICAgICAgICAgICAgICAgdmFsLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBjbHMp\nKS5zZXRDYXVzZShjY2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gb2lk\nLgogICAgICovCiAgICBwcml2YXRlIFN0YXRlTWFuYWdlckltcGwgbmV3U3Rh\ndGVNYW5hZ2VySW1wbChPYmplY3Qgb2lkLCBib29sZWFuIGNvcHkpIHsKICAg\nICAgICAvLyBzZWUgaWYgd2UncmUgaW4gdGhlIHByb2Nlc3Mgb2YgbG9hZGlu\nZyB0aGlzIG9pZCBpbiBhIGxvYWRBbGwgY2FsbAogICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207CiAgICAgICAgaWYgKF9sb2FkaW5nICE9IG51bGwpIHsK\nICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgX2xvYWRpbmcu\nZ2V0KG9pZCk7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmdl\ndFBlcnNpc3RlbmNlQ2FwYWJsZSgpID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gc207CiAgICAgICAgfQoKICAgICAgICAvLyBmaW5kIG1ldGFk\nYXRhIGZvciB0aGUgb2lkCiAgICAgICAgQ2xhc3MgcGNUeXBlID0gX3N0b3Jl\nLmdldE1hbmFnZWRUeXBlKG9pZCk7CiAgICAgICAgTWV0YURhdGFSZXBvc2l0\nb3J5IHJlcG9zID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgaWYg\nKHBjVHlwZSAhPSBudWxsKQogICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0\nTWV0YURhdGEocGNUeXBlLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShvaWQsIF9s\nb2FkZXIsIHRydWUpOwoKICAgICAgICAvLyBjb3B5IHRoZSBvaWQgaWYgbmVl\nZGVkCiAgICAgICAgaWYgKGNvcHkgJiYgX2NvbXBhdC5nZXRDb3B5T2JqZWN0\nSWRzKCkpIHsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAg\nICAgICAgIG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHkob2lkLCBtZXRhKTsK\nICAgICAgICAgICAgZWxzZSBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9\nPSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3du\naWQiLCBtZXRhKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIG9pZCA9IF9zdG9yZS5jb3B5RGF0YVN0b3JlSWQob2lkLCBtZXRhKTsKICAg\nICAgICB9CgogICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQs\nIG1ldGEpOwogICAgICAgIHNtLnNldE9iamVjdElkKG9pZCk7CiAgICAgICAg\ncmV0dXJuIHNtOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgc3Rh\ndGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZCBhbmQgbWV0YWRhdGEuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIG5ld1N0YXRl\nTWFuYWdlckltcGwoT2JqZWN0IG9pZCwKICAgICAgICBDbGFzc01ldGFEYXRh\nIG1ldGEpIHsKICAgICAgICByZXR1cm4gbmV3IFN0YXRlTWFuYWdlckltcGwo\nb2lkLCBtZXRhLCB0aGlzKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIFRyYW5zYWN0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiYWN0aXZlIikpOwog\nICAgICAgICAgICBfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlv\nbih0aGlzLCB0cnVlKTsKICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUg\nc3RvcmUgbWFuYWdlciBvZiBhIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYmVnaW5JbnRlcm5hbCgpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKF9vcHRp\nbWlzdGljKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfQUNUSVZFOwoK\nICAgICAgICAgICAgLy8gc3RhcnQgbG9ja2luZwogICAgICAgICAgICBpZiAo\nIV9vcHRpbWlzdGljKSB7CiAgICAgICAgICAgICAgICBfZmMuc2V0UmVhZExv\nY2tMZXZlbChfY29uZi5nZXRSZWFkTG9ja0xldmVsQ29uc3RhbnQoKSk7CiAg\nICAgICAgICAgICAgICBfZmMuc2V0V3JpdGVMb2NrTGV2ZWwoX2NvbmYuZ2V0\nV3JpdGVMb2NrTGV2ZWxDb25zdGFudCgpKTsKICAgICAgICAgICAgICAgIF9m\nYy5zZXRMb2NrVGltZW91dChfY29uZi5nZXRMb2NrVGltZW91dCgpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBfbG0uYmVnaW5UcmFuc2FjdGlvbigp\nOwoKICAgICAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNCZWdp\nbkxpc3RlbmVycygpKQogICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9u\nRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywKICAgICAgICAgICAg\nICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0JFR0lOLCBudWxsLCBu\ndWxsLCBudWxsLCBudWxsKSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5IHN0\nYXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBkb24ndCBsZXQgaXQgY29tbWl0CiAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAg\nICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChrZSk7CiAg\nICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgLy8g\naWYgd2UgYWxyZWFkeSBzdGFydGVkIHRoZSB0cmFuc2FjdGlvbiwgZG9uJ3Qg\nbGV0IGl0IGNvbW1pdAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5\nSW50ZXJuYWwocmUpOwogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24ocmUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKF9wZW5kaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdCA9IF9w\nZW5kaW5nLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0Lm5leHQoKTsKICAg\nICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAg\nICAgIGlmIChzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAgICAgICAgc2V0\nRGlydHkoc20sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9w\nZW5kaW5nID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgYmVnaW5TdG9yZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlv\nbk9wZXJhdGlvbigpOwogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nU1RPUkVfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAgICAgYmVnaW5TdG9y\nZU1hbmFnZXJUcmFuc2FjdGlvbihmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQmVnaW4gYSBzdG9yZSBtYW5h\nZ2VyIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVn\naW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihib29sZWFuIG9wdGltaXN0aWMp\nIHsKICAgICAgICBpZiAoIW9wdGltaXN0aWMpIHsKICAgICAgICAgICAgcmV0\nYWluQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfc3RvcmUuYmVnaW4oKTsK\nICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfQUNUSVZFOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChfY29ublJldGFpbk1vZGUg\nPT0gQ09OTl9SRVRBSU5fVFJBTlMpCiAgICAgICAgICAgICAgICByZXRhaW5D\nb25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9zdG9yZS5iZWdpbk9wdGltaXN0\naWMoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGhl\nIGN1cnJlbnQgc3RvcmUgbWFuYWdlciB0cmFuc2FjdGlvbi4gVGhyb3dzIGFu\nCiAgICAgKiBleGNlcHRpb24gdG8gc2lnbmFsIGEgZm9yY2VkIHJvbGxiYWNr\nIGFmdGVyIGZhaWxlZCBjb21taXQsIG90aGVyd2lzZQogICAgICogcmV0dXJu\ncyBhbnkgZXhjZXB0aW9uIGVuY291bnRlcmVkIGR1cmluZyB0aGUgZW5kIHBy\nb2Nlc3MuCiAgICAgKi8KICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiBl\nbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihib29sZWFuIHJvbGxiYWNrKSB7\nCiAgICAgICAgYm9vbGVhbiBmb3JjZWRSb2xsYmFjayA9IGZhbHNlOwogICAg\nICAgIGJvb2xlYW4gcmVsZWFzZUNvbm4gPSBmYWxzZTsKICAgICAgICBSdW50\naW1lRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMCkg\newogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm4gPSBfY29ublJldGFpbk1v\nZGUgIT0gQ09OTl9SRVRBSU5fQUxXQVlTOwogICAgICAgICAgICAgICAgaWYg\nKHJvbGxiYWNrKQogICAgICAgICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFj\naygpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIF9zdG9yZS5jb21taXQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIHJlbGVhc2VDb25uID0gX2Nvbm5SZXRhaW5Nb2RlID09IENP\nTk5fUkVUQUlOX1RSQU5TOwogICAgICAgICAgICAgICAgX3N0b3JlLnJvbGxi\nYWNrT3B0aW1pc3RpYygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIGlmICghcm9sbGJhY2spIHsKICAgICAgICAgICAgICAgIGZvcmNlZFJvbGxi\nYWNrID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRyeSB7IF9zdG9yZS5yb2xs\nYmFjaygpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlMikge30KICAg\nICAgICAgICAgfQogICAgICAgICAgICBlcnIgPSByZTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVfQUNU\nSVZFOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlbGVhc2VDb25uKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZWxlYXNlQ29ubmVj\ndGlvbigpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIGlmIChmb3JjZWRSb2xsYmFjaykKICAgICAgICAgICAg\ndGhyb3cgZXJyOwogICAgICAgIHJldHVybiBlcnI7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2Fj\ndGlvbk9wZXJhdGlvbigpOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rp\nb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRp\nbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsK\nICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\ndWxsLXRyYW5zIikpOwoKICAgICAgICAgICAgLy8gdGhpcyBjb21taXQgb24g\ndGhlIHRyYW5zYWN0aW9uIHdpbGwgY2F1c2Ugb3VyCiAgICAgICAgICAgIC8v\nIGJlZm9yZUNvbXBsZXRpb24gbWV0aG9kIHRvIGJlIGludm9rZWQKICAgICAg\nICAgICAgdHJhbnMuY29tbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdl\ndCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsKCiAg\nICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5z\nID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFu\nYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFu\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJhbnMucm9sbGJhY2soKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwg\na2UpOwogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgi\nZW5kLXRyYW5zLWVycm9yIiksIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIHN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKCkgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkg\nIT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICBpZiAoIV9tYW5hZ2VkKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidHJhbnMtbm90LW1hbmFn\nZWQiKSk7CiAgICAgICAgICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFn\nZWRUcmFuc2FjdGlvbih0aGlzLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAg\nIGJlZ2luSW50ZXJuYWwoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0QW5kUmVzdW1lKCkg\newogICAgICAgIGVuZEFuZFJlc3VtZSh0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByb2xsYmFja0FuZFJlc3VtZSgpIHsKICAgICAgICBlbmRBbmRS\nZXN1bWUoZmFsc2UpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBlbmRBbmRS\nZXN1bWUoYm9vbGVhbiBjb21taXQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvbW1p\ndCkKICAgICAgICAgICAgICAgIGNvbW1pdCgpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICByb2xsYmFjaygpOwogICAgICAgICAgICBiZWdp\nbigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRSb2xsYmFja09ubHkoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9u\nIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0\naW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICByZXR1cm4gdHJhbnMuZ2V0U3RhdHVzKCkgPT0gU3Rh\ndHVzLlNUQVRVU19NQVJLRURfUk9MTEJBQ0s7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIFRocm93YWJsZSBnZXRSb2xsYmFja0NhdXNlKCkg\newogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGph\ndmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAg\nICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRy\nYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmICh0\ncmFucy5nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xM\nQkFDSykKICAgICAgICAgICAgICAgIHJldHVybiBfcnVudGltZS5nZXRSb2xs\nYmFja0NhdXNlKCk7CgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFja09u\nbHkoKSB7CiAgICAgICAgc2V0Um9sbGJhY2tPbmx5KG5ldyBVc2VyRXhjZXB0\naW9uKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNrT25s\neShUaHJvd2FibGUgY2F1c2UpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2Fj\ndGlvbk9wZXJhdGlvbigpOwogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJ\nbnRlcm5hbChjYXVzZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogTWFyayB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyByb2xsYmFj\nay1vbmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Um9sbGJhY2tP\nbmx5SW50ZXJuYWwoVGhyb3dhYmxlIGNhdXNlKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJh\nbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25N\nYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRy\nYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOwogICAg\nICAgICAgICAvLyBlbnN1cmUgdHJhbiBpcyBpbiBhIHZhbGlkIHN0YXRlIHRv\nIGFjY2VwdCB0aGUgc2V0Um9sbGJhY2tPbmx5CiAgICAgICAgICAgIGludCB0\ncmFuU3RhdHVzID0gdHJhbnMuZ2V0U3RhdHVzKCk7CiAgICAgICAgICAgIGlm\nICgodHJhblN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX05PX1RSQU5TQUNUSU9O\nKQogICAgICAgICAgICAgICAgICAgICYmICh0cmFuU3RhdHVzICE9IFN0YXR1\ncy5TVEFUVVNfUk9MTEVEQkFDSykKICAgICAgICAgICAgICAgICAgICAmJiAo\ndHJhblN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRCkpCiAgICAg\nICAgICAgICAgICBfcnVudGltZS5zZXRSb2xsYmFja09ubHkoY2F1c2UpOwog\nICAgICAgICAgICBlbHNlIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbnZhbGlkLXRy\nYW4tc3RhdHVzIiwgbmV3IEludGVnZXIoCiAgICAgICAgICAgICAgICAgICAg\nICAgIHRyYW5TdGF0dXMpLCAic2V0Um9sbGJhY2tPbmx5IikpOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNhdmVwb2ludChTdHJp\nbmcgbmFtZSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9u\nKCk7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmIF9z\nYXZlcG9pbnRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInNhdmVwb2ludC1l\neGlzdHMiLCBuYW1lKSk7CgogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfRkxVU0hFRCkgIT0gMAogICAgICAgICAgICAgICAgJiYgIV9zcG0uc3Vw\ncG9ydHNJbmNyZW1lbnRhbEZsdXNoKCkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICAgICAoInNhdmVwb2ludC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikp\nOwoKICAgICAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlID0gX3NwbS5u\nZXdTYXZlcG9pbnQobmFtZSwgdGhpcyk7CiAgICAgICAgICAgIGlmIChfc2F2\nZXBvaW50cyA9PSBudWxsIHx8IF9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewog\nICAgICAgICAgICAgICAgc2F2ZS5zYXZlKGdldFRyYW5zYWN0aW9uYWxTdGF0\nZXMoKSk7CiAgICAgICAgICAgICAgICBfc2F2ZXBvaW50cyA9IG5ldyBMaW5r\nZWRNYXAoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGlmIChfc2F2ZXBvaW50Q2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBzYXZlLnNhdmUoQ29sbGVjdGlvbnMuRU1QVFlfTElTVCk7CiAgICAg\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzYXZlLnNh\ndmUoX3NhdmVwb2ludENhY2hlKTsKICAgICAgICAgICAgICAgICAgICBfc2F2\nZXBvaW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBfc2F2ZXBvaW50cy5wdXQobmFtZSwgc2F2\nZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVs\nZWFzZVNhdmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxz\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRz\nID09IG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxh\nc3RzYXZlcG9pbnQiKSk7CiAgICAgICAgICAgIHJlbGVhc2VTYXZlcG9pbnQo\nKFN0cmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3Nh\ndmVwb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9p\nbnQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsK\nCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxs\nKSA/IC0xCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yo\nc2F2ZXBvaW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNs\nZWFyIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9p\nbnQgc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUo\nKSA+IGluZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVu\nSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAg\nICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAg\nICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRz\nLnJlbW92ZShpbmRleCk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZSh0cnVl\nKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tUb1Nh\ndmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51\nbGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3RzYXZl\ncG9pbnQiKSk7CiAgICAgICAgICAgIHJvbGxiYWNrVG9TYXZlcG9pbnQoKFN0\ncmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3NhdmVw\nb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9p\nbnQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsK\nCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxs\nKSA/IC0xCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yo\nc2F2ZXBvaW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNs\nZWFyIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9p\nbnQgc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUo\nKSA+IGluZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVu\nSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAg\nICAgICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAg\nICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRz\nLnJlbW92ZShpbmRleCk7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc2F2ZWQg\nPSBzYXZlLnJvbGxiYWNrKF9zYXZlcG9pbnRzLnZhbHVlcygpKTsKICAgICAg\nICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAgICAgICAgIGlm\nIChoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKSB7CiAgICAgICAgICAgICAg\nICAvLyBidWlsZCB1cCBhIG5ldyBjb2xsZWN0aW9uIG9mIHN0YXRlcwogICAg\nICAgICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG9sZFRyYW5zQ2FjaGUg\nPSBfdHJhbnNDYWNoZTsKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uYWxD\nYWNoZSBuZXdUcmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZQog\nICAgICAgICAgICAgICAgICAgIChfb3JkZXJEaXJ0eSk7CiAgICAgICAgICAg\nICAgICBfdHJhbnNDYWNoZSA9IG51bGw7CgogICAgICAgICAgICAgICAgLy8g\nY3VycmVudGx5IHRoZXJlIGlzIHRoZSBhc3N1bXB0aW9uIHRoYXQgaW5jcmVt\nZW50YWwKICAgICAgICAgICAgICAgIC8vIGZsdXNoIGlzIGVpdGhlciBhKSBu\nb3QgYWxsb3dlZCwgb3IgYikgcmVxdWlyZWQKICAgICAgICAgICAgICAgIC8v\nIHByZS1zYXZlcG9pbnQuICB0aGlzIHNvbHZlcyBhIG51bWJlciBvZiBpc3N1\nZXMgaW5jbHVkaW5nCiAgICAgICAgICAgICAgICAvLyBzdG9yaW5nIGZsdXNo\nZWQgc3RhdGVzIGFzIHdlbGwgYXMgT0lEIGhhbmRsaW5nLgogICAgICAgICAg\nICAgICAgLy8gaWYgZnV0dXJlIHBsdWdpbnMgZG8gbm90IGZvbGxvdyB0aGlz\nLCB3ZSBuZWVkIHRvIGNhY2hlCiAgICAgICAgICAgICAgICAvLyBtb3JlIGlu\nZm8gcGVyIHN0YXRlCiAgICAgICAgICAgICAgICBTYXZlcG9pbnRGaWVsZE1h\nbmFnZXIgZm07CiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzYXZlZC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIGZtID0gKFNhdmVwb2ludEZpZWxkTWFuYWdlcikgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgICAgICBzbSA9IGZtLmdldFN0YXRlTWFuYWdlcigp\nOwogICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrVG9TYXZlcG9pbnQo\nZm0pOwogICAgICAgICAgICAgICAgICAgIG9sZFRyYW5zQ2FjaGUucmVtb3Zl\nKHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFkZERpcnR5\nKHNtKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgIG5ld1RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBvbGRUcmFuc0NhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBzbS5yb2xsYmFjaygp\nOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21UcmFuc2FjdGlvbihz\nbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvbGRUcmFu\nc0NhY2hlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9\nIG5ld1RyYW5zQ2FjaGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGZsdXNoKCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIHJldHVybiBzaWxlbnRseSBpZiBubyB0cmFucyBpcyBhY3Rp\ndmUsIG9yIGlmIHRoaXMgaXMgYSByZWVudHJhbnQKICAgICAgICAgICAgLy8g\nY2FsbCwgd2hpY2ggY2FuIGhhcHBlbiBpZiB0aGUgc3RvcmUgbWFuYWdlciB0\ncmllcyB0byBnZXQgYW4KICAgICAgICAgICAgLy8gYXV0by1pbmMgb2lkIGR1\ncmluZyBmbHVzaAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSA9PSAwCiAgICAgICAgICAgICAgICB8fCAoX2ZsYWdzICYgRkxBR19T\nVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0\ncyBpdAogICAgICAgICAgICBpZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMo\nKS5jb250YWlucyhfY29uZi5PUFRJT05fSU5DX0ZMVVNIKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgICAgICgiaW5jcmVtZW50YWwtZmx1c2gtbm90\nLXN1cHBvcnRlZCIpKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9\nIG51bGwgJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKQogICAgICAgICAgICAg\nICAgJiYgIV9zcG0uc3VwcG9ydHNJbmNyZW1lbnRhbEZsdXNoKCkpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICAgICAoInNhdmVwb2ludC1mbHVzaC1u\nb3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGZsdXNoU2FmZShGTFVTSF9JTkMpOwogICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgLy8gcm9s\nbGJhY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5IGJlIGluIGluY29u\nc2lzdGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5\nKGtlKTsKICAgICAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUp\nOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsg\nb2JqZWN0cyBtYXkgYmUgaW4gaW5jb25zaXN0ZW50IHN0YXRlCiAgICAgICAg\nICAgICAgICBzZXRSb2xsYmFja09ubHkocmUpOwogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHByZUZsdXNoKCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBmbHVz\naFNhZmUoRkxVU0hfTE9HSUNBTCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHZhbGlkYXRlQ2hhbmdlcygpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBpZiBubyB0cmFucywganVzdCByZXR1cm47IGlmIGFjdGl2ZSBkYXRhc3Rv\ncmUgdHJhbnMsIGZsdXNoCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDAp\nIHsKICAgICAgICAgICAgICAgIGZsdXNoKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3Vy\nZSB0aGUgcnVudGltZSBzdXBwb3J0cyBpbmMgZmx1c2gKICAgICAgICAgICAg\naWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoX2NvbmYu\nT1BUSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZM\nVVNIX1JPTExCQUNLKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0FjdGl2ZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N0b3JlQWN0aXZlKCkgewogICAgICAg\nIC8vIHdlIG5lZWQgdG8gbG9jayBoZXJlLCBiZWNhdXNlIHdlIG1pZ2h0IGJl\nIGluIHRoZSBtaWRkbGUgb2YgYW4KICAgICAgICAvLyBhdG9taWMgdHJhbnNh\nY3Rpb24gcHJvY2VzcyAoZS5nLiwgY29tbWl0QW5kUmVzdW1lKQogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDA7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gaXMgZW5kaW5nLCBpLmUu\nIGluIHRoZSAybmQgcGhhc2UKICAgICAqIG9mIGEgY29tbWl0IG9yIHJvbGxi\nYWNrCiAgICAgKi8KICAgIGJvb2xlYW4gaXNUcmFuc2FjdGlvbkVuZGluZygp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfVFJBTlNfRU5ESU5H\nKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGJlZ2luT3BlcmF0\naW9uKGJvb2xlYW4gc3luY1RyYW5zKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAg\nICAgIGlmIChzeW5jVHJhbnMgJiYgX29wZXJhdGlvbkNvdW50ID09IDAgJiYg\nX3N5bmNNYW5hZ2VkCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBzeW5jV2l0aE1hbmFn\nZWRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX29wZXJhdGlv\nbkNvdW50KysgPT0gMTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTWFyayB0aGUgb3BlcmF0aW9uIG92ZXIuIElmIG91dGVy\nbW9zdCBjYWxsZXIgb2Ygc3RhY2ssIHJldHVybnMgdHJ1ZQogICAgICogYW5k\nIHdpbGwgZGV0YWNoIG1hbmFnZWQgaW5zdGFuY2VzIGlmIG5lY2Vzc2FyeS4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZW5kT3BlcmF0aW9uKCkgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQg\nPT0gMSAmJiAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAhPSAw\nCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApIHsKICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291\nbnQgPCAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJtdWx0aS10aHJlYWRlZC1hY2Nlc3MiKSk7CiAg\nICAgICAgICAgIHJldHVybiBfb3BlcmF0aW9uQ291bnQgPT0gMTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9vcGVyYXRp\nb25Db3VudC0tOwogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09\nIDApCiAgICAgICAgICAgICAgICBfb3BlcmF0aW5nLmNsZWFyKCk7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nU3luY2hyb25pemF0aW9uIGdldFN5bmNocm9uaXphdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3lu\nY2hyb25pemF0aW9uKFN5bmNocm9uaXphdGlvbiBzeW5jKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5jID0gc3luYzsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3luY2hyb25pemF0aW9u\nIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWZvcmVDb21w\nbGV0aW9uKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyB1c2VyLXN1cHBsaWVkIHN5bmNo\ncm9uaXphdGlvbgogICAgICAgICAgICBpZiAoX3N5bmMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zeW5jLmJlZm9yZUNvbXBsZXRpb24oKTsKCiAgICAg\nICAgICAgIGZsdXNoU2FmZShGTFVTSF9DT01NSVQpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAg\nICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9u\nKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJy\nb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2Vk\nQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYWZ0ZXJDb21w\nbGV0aW9uKGludCBzdGF0dXMpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1RS\nQU5TX0VORElORzsKICAgICAgICAgICAgZW5kVHJhbnNhY3Rpb24oc3RhdHVz\nKTsKICAgICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24oc3RhdHVzKTsKCiAgICAgICAg\nICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRBQ0hfQ09NTUlUKSAhPSAwKQog\nICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBTdGF0dXMuU1RBVFVTX1JPTExF\nREJBQ0sgCiAgICAgICAgICAgICAgICAmJiAoX2F1dG9EZXRhY2ggJiBERVRB\nQ0hfUk9MTEJBQ0spICE9IDApIHsKICAgICAgICAgICAgICAgIGRldGFjaEFs\nbEludGVybmFsKG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBpbiBhbiBlZSBjb250ZXh0LCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHVz\nZXIgdHJpZWQgdG8gY2xvc2UKICAgICAgICAgICAgLy8gdXMgYnV0IHdlIGRp\nZG4ndCBhY3R1YWxseSBjbG9zZSBiZWNhdXNlIHdlIHdlcmUgd2FpdGluZyBv\nbiB0aGlzCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uOyBpZiB0aGF0J3Mg\ndHJ1ZSwgdGhlbiBjbG9zZSBub3cKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0NMT1NFX0lOVk9LRUQpICE9IDAKICAgICAgICAgICAgICAgICYm\nIF9jb21wYXQuZ2V0Q2xvc2VPbk1hbmFnZWRDb21taXQoKSkKICAgICAgICAg\nICAgICAgIGZyZWUoKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQt\ndHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xh\ndGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihrZSk7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIHJlKTsKICAgICAg\nICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRp\nb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0FDVElWRTsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAgICAgIF9m\nbGFncyAmPSB+RkxBR19UUkFOU19FTkRJTkc7CgogICAgICAgICAgICAvLyBl\ndmVudCBtYW5hZ2VyIG51bGxlZCBpZiBmcmVlZCBicm9rZXIKICAgICAgICAg\nICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlciAhPSBudWxsIAogICAgICAgICAg\nICAgICAgJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygp\nKSB7CiAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcg\nVHJhbnNhY3Rpb25FdmVudCh0aGlzLAogICAgICAgICAgICAgICAgICAgIHN0\nYXR1cyA9PSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRAogICAgICAgICAgICAg\nICAgICAgICAgICA/IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlUX0NP\nTVBMRVRFCiAgICAgICAgICAgICAgICAgICAgICAgIDogVHJhbnNhY3Rpb25F\ndmVudC5BRlRFUl9ST0xMQkFDS19DT01QTEVURSwKICAgICAgICAgICAgICAg\nICAgICBudWxsLCBudWxsLCBudWxsLCBudWxsKSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHdlJ3JlIGluIGEgbWFuYWdlZCB0cmFuc2Fj\ndGlvbiwgdXNlIG91ciBpbXBsaWNpdCBiZWhhdmlvciBleGNlcHRpb24KICAg\nICAqIHRyYW5zbGF0b3IgdG8gdHJhbnNsYXRlIGJlZm9yZS9hZnRlckNvbXBs\nZXRpb24gY2FsbGJhY2sgZXJyb3JzLgogICAgICovCiAgICBwcml2YXRlIFJ1\nbnRpbWVFeGNlcHRpb24gdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNl\ncHRpb24KICAgICAgICAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nIHJldHVybiAoIV9tYW5hZ2VkIHx8IF9leHRyYW5zID09IG51bGwpID8gcmUg\nOiBfZXh0cmFucy50cmFuc2xhdGUocmUpOwogICAgfQoKICAgIC8qKgogICAg\nICogRmx1c2ggc2FmZWx5LCBjYXRjaGluZyByZWVudHJhbnQgY2FsbHMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBmbHVzaFNhZmUoaW50IHJlYXNvbikg\newogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19GTFVTSElORykgIT0gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgicmVlbnRyYW50LWZsdXNoIikpOwoKICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19GTFVTSElORzsKICAgICAgICB0cnkgewogICAgICAgICAgICBm\nbHVzaChyZWFzb24pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19GTFVTSElORzsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBGbHVzaCB0aGUgdHJhbnNhY3Rpb25hbCBzdGF0ZSB0\nbyB0aGUgZGF0YSBzdG9yZS4gU3ViY2xhc3NlcyB0aGF0CiAgICAgKiBjdXN0\nb21pemUgY29tbWl0IGJlaGF2aW9yIHNob3VsZCBvdmVycmlkZSB0aGlzIG1l\ndGhvZC4gVGhlIG1ldGhvZAogICAgICogYXNzdW1lcyB0aGF0IHRoZSBwZXJz\naXN0ZW5jZSBtYW5hZ2VyIGlzIGxvY2tlZCwgaXMgbm90IGNsb3NlZCwKICAg\nICAqIGFuZCBoYXMgYW4gYWN0aXZlIHRyYW5zYWN0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSByZWFzb24gb25lIG9mIHtAbGluayAjRkxVU0hfSU5DfSwg\ne0BsaW5rICNGTFVTSF9DT01NSVR9LAogICAgICoge0BsaW5rICNGTFVTSF9S\nT0xMQkFDS30sIG9yIHtAbGluayAjRkxVU0hfTE9HSUNBTH0KICAgICAqIEBz\naW5jZSAwLjIuNQogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBmbHVzaChp\nbnQgcmVhc29uKSB7CiAgICAgICAgLy8gdGhpcyB3aWxsIGVubGlzdCBwcm94\naWVkIHN0YXRlcyBhcyBuZWNlc3Nhcnkgc28gd2Uga25vdyB3aGV0aGVyIHdl\nCiAgICAgICAgLy8gaGF2ZSBhbnl0aGluZyB0byBmbHVzaAogICAgICAgIENv\nbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCA9IGdldFRyYW5zYWN0aW9uYWxTdGF0\nZXMoKTsKCiAgICAgICAgLy8gZG8gd2UgYWN0dWFsbHkgaGF2ZSB0byBmbHVz\naD8gIG9ubHkgaWYgb3VyIGZsYWdzIHNheSBzbywgb3IgaWYKICAgICAgICAv\nLyB3ZSBoYXZlIHRyYW5zYWN0aW9uIGxpc3RlbmVycyB0aGF0IG5lZWQgdG8g\nYmUgaW52b2tlZCBmb3IgY29tbWl0CiAgICAgICAgLy8gKG5vIG5lZWQgdG8g\naW52b2tlIHRoZW0gb24gaW5jIGZsdXNoIGlmIG5vdGhpbmcgaXMgZGlydHkp\nLiAgd2UKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgdGhlIHJlbW90ZSBjb21t\naXQgbGlzdGVuZXIgdXNlZCBieSB0aGUgZGF0YWNhY2hlIGNhdXNlCiAgICAg\nICAgLy8gd2Uga25vdyBpdCBkb2Vzbid0IHJlcXVpcmUgdGhlIGNvbW1pdCBl\ndmVudCB3aGVuIG5vdGhpbmcgY2hhbmdlcwogICAgICAgIGJvb2xlYW4gZmx1\nc2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0gMDsKICAg\nICAgICBib29sZWFuIGxpc3RlbmVycyA9IChfdHJhbnNFdmVudE1hbmFnZXIu\naGFzRmx1c2hMaXN0ZW5lcnMoKQogICAgICAgICAgICB8fCBfdHJhbnNFdmVu\ndE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAgICAgICYmICgo\nX2ZsYWdzICYgRkxBR19SRU1PVEVfTElTVEVORVIpID09IDAKICAgICAgICAg\nICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmdldExpc3RlbmVycygpLnNpemUo\nKSA+IDEpOwogICAgICAgIGlmICghZmx1c2ggJiYgKHJlYXNvbiAhPSBGTFVT\nSF9DT01NSVQgfHwgIWxpc3RlbmVycykpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7CiAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfUFJFU1RPUklORzsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoZmx1c2gpIHsKICAgICAgICAgICAgICAgIC8vIGNhbGwgcHJl\nIHN0b3JlIG9uIGFsbCBjdXJyZW50bHkgdHJhbnNhY3Rpb25hbCBvYmpzCiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zYWN0aW9u\nYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAg\nICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpKS5iZWZvcmVG\nbHVzaChyZWFzb24sIF9jYWxsKTsKICAgICAgICAgICAgICAgIGZsdXNoQWRk\naXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGhvcGVmdWxseSBub3cgYWxsIGRlcGVuZGVudCBp\nbnN0YW5jZXMgdGhhdCBhcmUgZ29pbmcgdG8gZW5kCiAgICAgICAgICAgIC8v\nIHVwIHJlZmVyZW5jZWQgaGF2ZSBiZWVuIG1hcmtlZCBhcyBzdWNoOyBkZWxl\ndGUgdW5yZWZlZAogICAgICAgICAgICAvLyBkZXBlbmRlbnRzCiAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX0RFUkVGREVMRVRJTkc7CiAgICAgICAgICAg\nIGlmIChmbHVzaCAmJiBfZGVyZWZDYWNoZSAhPSBudWxsICYmICFfZGVyZWZD\nYWNoZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX2RlcmVmQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlRGVyZWYoKFN0YXRlTWFu\nYWdlckltcGwpIGl0ci5uZXh0KCkpOwogICAgICAgICAgICAgICAgZmx1c2hB\nZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMKSB7\nCiAgICAgICAgICAgICAgICAvLyBpZiBubyBkYXRhc3RvcmUgdHJhbnNhY3Rp\nb24sIHN0YXJ0IG9uZTsgZXZlbiBpZiB3ZSBkb24ndAogICAgICAgICAgICAg\nICAgLy8gdGhpbmsgd2UnbGwgbmVlZCB0byBmbHVzaCBhdCB0aGlzIHBvaW50\nLCBvdXIgdHJhbnNhY3Rpb24KICAgICAgICAgICAgICAgIC8vIGxpc3RlbmVy\ncyBtaWdodCBpbnRyb2R1Y2Ugc29tZSBkaXJ0eSBvYmplY3RzIG9yIGludGVy\nYWN0CiAgICAgICAgICAgICAgICAvLyBkaXJlY3RseSB3aXRoIHRoZSBkYXRh\nYmFzZQogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JF\nX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICBiZWdpblN0b3Jl\nTWFuYWdlclRyYW5zYWN0aW9uKGZhbHNlKTsKCiAgICAgICAgICAgICAgICBp\nZiAoKF90cmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpCiAg\nICAgICAgICAgICAgICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0Vu\nZExpc3RlbmVycygpKQogICAgICAgICAgICAgICAgICAgICYmIChmbHVzaCB8\nfCByZWFzb24gPT0gRkxVU0hfQ09NTUlUKSkgewogICAgICAgICAgICAgICAg\nICAgIC8vIGZpcmUgZXZlbnRzCiAgICAgICAgICAgICAgICAgICAgbW9ianMg\nPSBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24odHJhbnNhY3Rpb25hbCk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9DT01N\nSVQKICAgICAgICAgICAgICAgICAgICAgICAgJiYgX3RyYW5zRXZlbnRNYW5h\nZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50\nKHRoaXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNhY3Rp\nb25FdmVudC5CRUZPUkVfQ09NTUlULCBtb2JqcywKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9k\nZWxldGVkQ2xzcykpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hB\nZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSF9SRVFV\nSVJFRCkgIT0gMDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgICAgIGlmIChmbHVzaCAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFz\nRmx1c2hMaXN0ZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBm\naXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlz\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZl\nbnQuQkVGT1JFX0ZMVVNILCBtb2JqcywKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9kZWxldGVk\nQ2xzcykpOwogICAgICAgICAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9u\ncyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFH\nX1BSRVNUT1JJTkc7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19ERVJF\nRkRFTEVUSU5HOwogICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMgPSBudWxs\nOwogICAgICAgICAgICBfZGVyZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgICAg\nICAgICAgLy8gYWxzbyBjbGVhciBkZXJlZmVkIHNldDsgdGhlIGRlbGV0ZXMg\naGF2ZSBiZWVuIHJlY29yZGVkCiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNo\nZSAhPSBudWxsKQogICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUuY2xlYXIo\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGZsdXNoIHRvIHN0b3JlIG1hbmFn\nZXIKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKGZsdXNoICYmIHJlYXNvbiAhPSBGTFVTSF9MT0dJ\nQ0FMKSB7CiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19TVE9SRV9G\nTFVTSElORzsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nCiAgICAgICAgICAgICAgICAgICAgbmV3Rmx1c2hFeGNlcHRpb24oX3N0b3Jl\nLmZsdXNoKHRyYW5zYWN0aW9uYWwpKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RP\nUkVfRkxVU0hJTkc7CgogICAgICAgICAgICBpZiAocmVhc29uID09IEZMVVNI\nX1JPTExCQUNLKQogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgZW5kU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24odHJ1ZSkpOwogICAgICAg\nICAgICBlbHNlIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkKICAgICAg\nICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSF9SRVFVSVJFRDsKCiAg\nICAgICAgICAgIC8vIG1hcmsgc3RhdGVzIGFzIGZsdXNoZWQKICAgICAgICAg\nICAgaWYgKGZsdXNoKSB7CiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0\ncmFuc2FjdGlvbmFsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICAvLyB0aGUgc3RhdGUgbWF5IGhhdmUgYmVjb21lIHRy\nYW5zaWVudCwgc3VjaCBhcyBpZgogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBpdCBpcyBlbWJlZGRlZCBhbmQgdGhlIG93bmVyIGhhcyBiZWVuIGRlbGV0\nZWQgZHVyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgZmx1\nc2ggcHJvY2VzczsgYnVnICMxMTAwCiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5UUkFOU0lFTlQpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLmFmdGVyRmx1c2gocmVhc29uKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9JTkMpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG5vdCBhYm91dCB0\nbyBjbGVhciB0cmFucyBjYWNoZSBmb3IgY29tbWl0IAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gYW55d2F5LCByZS1jYWNoZSBkaXJ0eSBvYmpl\nY3RzIHdpdGggZGVmYXVsdCBzb2Z0CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyByZWZzOyB3ZSBkb24ndCBuZWVkIGhhcmQgcmVmcyBub3cgdGhh\ndCB0aGUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2Vz\nIGhhdmUgYmVlbiBmbHVzaGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzbS5wcm94eUZpZWxkcyh0cnVlLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfdHJhbnNDYWNoZS5mbHVzaGVkKHNtKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4\nY2VwcyA9IGFkZChleGNlcHMsIGUpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gdGhyb3cgYW55IGV4Y2VwdGlvbnMgdG8gc2hvcnRjdXQgbGlz\ndGVuZXJzIG9uIGZhaWwKICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMo\nZXhjZXBzLCB0cnVlKTsKCiAgICAgICAgaWYgKGZsdXNoICYmIHJlYXNvbiAh\nPSBGTFVTSF9ST0xMQkFDSyAmJiByZWFzb24gIT0gRkxVU0hfTE9HSUNBTAog\nICAgICAgICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0\nZW5lcnMoKSkgewogICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChu\nZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLAogICAgICAgICAgICAgICAgVHJh\nbnNhY3Rpb25FdmVudC5BRlRFUl9GTFVTSCwgbW9ianMsIF9wZXJzaXN0ZWRD\nbHNzLAogICAgICAgICAgICAgICAgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENs\nc3MpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBu\nZXdseS10cmFuc2FjdGlvbmFsIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBmbHVzaEFkZGl0aW9ucyhDb2xsZWN0aW9uIHRyYW5zYWN0aW9u\nYWwsIGludCByZWFzb24pIHsKICAgICAgICBib29sZWFuIGxvb3A7CiAgICAg\nICAgZG8gewogICAgICAgICAgICAvLyBmbHVzaCBuZXcgdHJhbnNhY3Rpb25h\nbCBpbnN0YW5jZXM7IG5vdGUgbG9naWNhbCBvcgogICAgICAgICAgICBsb29w\nID0gZmx1c2hUcmFuc0FkZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24p\nCiAgICAgICAgICAgICAgICB8IGRlbGV0ZURlcmVmQWRkaXRpb25zKF9kZXJl\nZkNhY2hlKTsKICAgICAgICB9IHdoaWxlIChsb29wKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEZsdXNoIHRyYW5zYWN0aW9uYWwgYWRkaXRpb25zLgogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gZmx1c2hUcmFuc0FkZGl0aW9ucyhD\nb2xsZWN0aW9uIHRyYW5zYWN0aW9uYWwsIGludCByZWFzb24pIHsKICAgICAg\nICBpZiAoX3RyYW5zQWRkaXRpb25zID09IG51bGwgfHwgX3RyYW5zQWRkaXRp\nb25zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAg\nICAgICAvLyBrZWVwIGxvY2FsIHRyYW5zYWN0aW9uYWwgbGlzdCBjb3B5IHVw\nIHRvIGRhdGUKICAgICAgICB0cmFuc2FjdGlvbmFsLmFkZEFsbChfdHJhbnNB\nZGRpdGlvbnMpOwoKICAgICAgICAvLyBjb3B5IHRoZSBjaGFuZ2Ugc2V0LCB0\naGVuIGNsZWFyIGl0IGZvciB0aGUgbmV4dCBpdGVyYXRpb24KICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsW10gc3RhdGVzID0gKFN0YXRlTWFuYWdlckltcGxb\nXSkgX3RyYW5zQWRkaXRpb25zLgogICAgICAgICAgICB0b0FycmF5KG5ldyBT\ndGF0ZU1hbmFnZXJJbXBsW190cmFuc0FkZGl0aW9ucy5zaXplKCldKTsKICAg\nICAgICBfdHJhbnNBZGRpdGlvbnMuY2xlYXIoKTsKCiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIHN0YXRlc1tpXS5iZWZvcmVGbHVzaChyZWFzb24sIF9jYWxsKTsKICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBu\nZXcgZGVyZWZlcmVuY2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBkZWxldGVEZXJlZkFkZGl0aW9ucyhDb2xsZWN0aW9uIGRlcmVm\ncykgewogICAgICAgIGlmIChfZGVyZWZBZGRpdGlvbnMgPT0gbnVsbCB8fCBf\nZGVyZWZBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIHJlbWVtYmVyIHRoZXNlIGFkZGl0aW9ucyBp\nbiBjYXNlIG9uZSBiZWNvbWVzIGRlcmVmZWQgYWdhaW4gbGF0ZXIKICAgICAg\nICBkZXJlZnMuYWRkQWxsKF9kZXJlZkFkZGl0aW9ucyk7CgogICAgICAgIFN0\nYXRlTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3RhdGVNYW5hZ2VySW1wbFtd\nKSBfZGVyZWZBZGRpdGlvbnMuCiAgICAgICAgICAgIHRvQXJyYXkobmV3IFN0\nYXRlTWFuYWdlckltcGxbX2RlcmVmQWRkaXRpb25zLnNpemUoKV0pOwogICAg\nICAgIF9kZXJlZkFkZGl0aW9ucy5jbGVhcigpOwoKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nZGVsZXRlRGVyZWYoc3RhdGVzW2ldKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGRlcmVmZXJlbmNlZCBk\nZXBlbmRlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkZWxldGVEZXJl\nZihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaW50IGFjdGlvbiA9\nIHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9ERUxFVEUsCiAgICAg\nICAgICAgIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBzbSwgbnVsbCk7CiAg\nICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSAhPSAw\nKQogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICBpZiAoKGFjdGlv\nbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAgICAgICAg\nICBzbS5jYXNjYWRlRGVsZXRlKF9jYWxsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIERldGVybWluZSB0aGUgYWN0aW9uIHRvIHRha2UgYmFzZWQgb24gdGhl\nIHVzZXIncyBnaXZlbiBjYWxsYmFja3MgYW5kCiAgICAgKiBvdXIgaW1wbGlj\naXQgYmVoYXZpb3IuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHByb2Nlc3NB\ncmd1bWVudChpbnQgb3AsIE9iamVjdCBvYmosIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nIChjYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nl\nc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7CiAgICAgICAgaWYgKF9jYWxsICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FsbC5wcm9jZXNzQXJndW1l\nbnQob3AsIG9iaiwgc20pOwogICAgICAgIHJldHVybiBPcENhbGxiYWNrcy5B\nQ1RfUlVOIHwgT3BDYWxsYmFja3MuQUNUX0NBU0NBREU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlvbiBiYXNlZCBv\nbiB0aGUgZ2l2ZW4gc2V0IG9mIGZsdXNoIGVycm9ycywgb3IKICAgICAqIGRv\nIG5vdGhpbmcgaWYgbm8gZXJyb3JzIG9jY3VycmVkLgogICAgICovCiAgICBw\ncml2YXRlIE9wZW5KUEFFeGNlcHRpb24gbmV3Rmx1c2hFeGNlcHRpb24oQ29s\nbGVjdGlvbiBleGNlcHMpIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51bGwg\nfHwgZXhjZXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIFRocm93YWJsZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4Y2Vw\ncy50b0FycmF5CiAgICAgICAgICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5z\naXplKCldKTsKICAgICAgICBMaXN0IGZhaWxlZCA9IG5ldyBBcnJheUxpc3Qo\ndC5sZW5ndGgpOwoKICAgICAgICAvLyBjcmVhdGUgZmF0YWwgZXhjZXB0aW9u\nIHdpdGggbmVzdGVkIGV4Y2VwdGlvbnMgZm9yIGFsbCB0aGUgZmFpbGVkCiAg\nICAgICAgLy8gb2JqZWN0czsgaWYgYWxsIE9MIGV4Y2VwdGlvbnMsIHRocm93\nIGEgdG9wLWxldmVsIE9MIGV4Y2VwdGlvbgogICAgICAgIGJvb2xlYW4gb3B0\nID0gdHJ1ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgb3B0ICYmIGkgPCB0\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG9wdCA9IHRbaV0gaW5zdGFu\nY2VvZiBPcHRpbWlzdGljRXhjZXB0aW9uOwogICAgICAgICAgICBpZiAob3B0\nKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgZiA9ICgoT3B0aW1pc3RpY0V4\nY2VwdGlvbikgdFtpXSkuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAgICAg\nICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZhaWxl\nZC5hZGQoZik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKG9wdCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBPcHRpbWlzdGljRXhjZXB0aW9uKGZhaWxlZCwgdCk7CiAgICAgICAg\naWYgKG9wdCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBPcHRpbWlzdGljRXhj\nZXB0aW9uKHQpOwogICAgICAgIHJldHVybiBuZXcgU3RvcmVFeGNlcHRpb24o\nX2xvYy5nZXQoInJvbGxlZC1iYWNrIikpLgogICAgICAgICAgICBzZXROZXN0\nZWRUaHJvd2FibGVzKHQpLnNldEZhdGFsKHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogRW5kIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLCBtYWtpbmcg\nYXBwcm9wcmlhdGUgc3RhdGUgdHJhbnNpdGlvbnMuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGVuZFRyYW5zYWN0aW9uKGludCBzdGF0dXMpIHsKICAg\nICAgICAvLyBpZiBhIGRhdGEgc3RvcmUgdHJhbnNhY3Rpb24gd2FzIGluIHBy\nb2dyZXNzLCBkbyB0aGUKICAgICAgICAvLyBhcHByb3ByaWF0ZSB0cmFuc2Fj\ndGlvbiBjaGFuZ2UKICAgICAgICBib29sZWFuIHJvbGxiYWNrID0gc3RhdHVz\nICE9IFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVEOwogICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2VwcywgZW5kU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24ocm9s\nbGJhY2spKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHJvbGxiYWNrID0gdHJ1ZTsKICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gZ28gYmFjayB0byBkZWZhdWx0IG5vbmUgbG9jayBsZXZlbAogICAgICAg\nIF9mYy5zZXRSZWFkTG9ja0xldmVsKExPQ0tfTk9ORSk7CiAgICAgICAgX2Zj\nLnNldFdyaXRlTG9ja0xldmVsKExPQ0tfTk9ORSk7CiAgICAgICAgX2ZjLnNl\ndExvY2tUaW1lb3V0KC0xKTsKCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc1N0\nYXRlczsKICAgICAgICBpZiAoaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkK\nICAgICAgICAgICAgdHJhbnNTdGF0ZXMgPSBfdHJhbnNDYWNoZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHRyYW5zU3RhdGVzID0gQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVDsKCiAgICAgICAgLy8gZmlyZSBhZnRlciByb2xsYmFjay9j\nb21taXQgZXZlbnQKICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsK\nICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVy\ncygpKSB7CiAgICAgICAgICAgIG1vYmpzID0gbmV3IE1hbmFnZWRPYmplY3RD\nb2xsZWN0aW9uKHRyYW5zU3RhdGVzKTsKICAgICAgICAgICAgaW50IGV2ZW50\nVHlwZSA9IChyb2xsYmFjaykgPyBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX1JP\nTExCQUNLCiAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZU\nRVJfQ09NTUlUOwogICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChu\nZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCBldmVudFR5cGUsIG1vYmpzLCAK\nICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3Ms\nIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCB0\ncmFuc2FjdGlvbmFsIGNhY2hlcyBub3cgc28gdGhhdCBhbGwgdGhlIHJlbW92\nZUZyb21UcmFuc2FjdGlvbgogICAgICAgIC8vIGNhbGxzIGFzIHdlIHRyYW5z\naXRpb24gZWFjaCBvYmplY3QgZG9uJ3QgaGF2ZSB0byBkbyBhbnkgd29yazsg\nZG9uJ3QKICAgICAgICAvLyBjbGVhciB0cmFucyBjYWNoZSBvYmplY3QgYmVj\nYXVzZSB3ZSBzdGlsbCBuZWVkIHRoZSB0cmFuc1N0YXRlcwogICAgICAgIC8v\nIHJlZmVyZW5jZSB0byBpdCBiZWxvdwogICAgICAgIF90cmFuc0NhY2hlID0g\nbnVsbDsKICAgICAgICBpZiAoX3BlcnNpc3RlZENsc3MgIT0gbnVsbCkKICAg\nICAgICAgICAgX3BlcnNpc3RlZENsc3MuY2xlYXIoKTsKICAgICAgICBpZiAo\nX3VwZGF0ZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAgIF91cGRhdGVkQ2xz\ncy5jbGVhcigpOwogICAgICAgIGlmIChfZGVsZXRlZENsc3MgIT0gbnVsbCkK\nICAgICAgICAgICAgX2RlbGV0ZWRDbHNzLmNsZWFyKCk7CgogICAgICAgIC8v\nIG5ldyBjYWNoZSB3b3VsZCBnZXQgY2xlYXJlZCBhbnl3YXkgZHVyaW5nIHRy\nYW5zaXRpb25zLCBidXQgZG9pbmcgc28KICAgICAgICAvLyBpbW1lZGlhdGVs\neSBzYXZlcyB1cyBzb21lIGxvb2t1cHMKICAgICAgICBfY2FjaGUuY2xlYXJO\nZXcoKTsKCiAgICAgICAgLy8gdGVsbCBhbGwgZGVyZWZlZCBpbnN0YW5jZXMg\ndGhleSdyZSBubyBsb25nZXIgZGVyZWZlZDsgd2UgY2FuJ3QKICAgICAgICAv\nLyByZWx5IG9uIHJvbGxiYWNrIGFuZCBjb21taXQgY2FsbHMgYmVsb3cgY2F1\nc2Ugc29tZSBpbnN0YW5jZXMgbWlnaHQKICAgICAgICAvLyBub3QgYmUgdHJh\nbnNhY3Rpb25hbAogICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYm\nICFfZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkg\naXRyLm5leHQoKSkuc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50CiAgICAgICAg\nICAgICAgICAgICAgKGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIF9kZXJl\nZkNhY2hlLmNsZWFyKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBwZWZvcm0g\nY29tbWl0IG9yIHJvbGxiYWNrIHN0YXRlIHRyYW5zaXRpb25zIG9uIGVhY2gg\naW5zdGFuY2UKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNTdGF0ZXMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5h\nZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGlmIChyb2xsYmFjaykgewogICAgICAgICAgICAgICAgICAg\nIC8vIHRlbGwgb2JqZWN0cyB0aGF0IG1heSBoYXZlIGJlZW4gZGVyZWZlZCB0\naGVuIGZsdXNoZWQKICAgICAgICAgICAgICAgICAgICAvLyAoYW5kIHRoZXJl\nZm9yZSBkZWxldGVkKSB0byB1bi1kZXJlZgogICAgICAgICAgICAgICAgICAg\nIHNtLnNldERlcmVmZXJlbmNlZERlcGVuZGVudChmYWxzZSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrKCk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBzbS5jb21taXQoKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3RpZnkgdGhlIGxv\nY2sgbWFuYWdlciB0byBjbGVhbiB1cCBhbmQgcmVsZWFzZSByZW1haW5pbmcg\nbG9ja3MKICAgICAgICBfbG0uZW5kVHJhbnNhY3Rpb24oKTsKCiAgICAgICAg\nLy8gY2xlYXIgb2xkIHNhdmVwb2ludHMgaW4gcmV2ZXJzZQogICAgICAgIE9w\nZW5KUEFTYXZlcG9pbnQgc2F2ZTsKICAgICAgICB3aGlsZSAoX3NhdmVwb2lu\ndHMgIT0gbnVsbCAmJiBfc2F2ZXBvaW50cy5zaXplKCkgPiAwKSB7CiAgICAg\nICAgICAgIHNhdmUgPQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9p\nbnQpIF9zYXZlcG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAx\nKTsKICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAgICAgICB9\nCiAgICAgICAgX3NhdmVwb2ludHMgPSBudWxsOwogICAgICAgIF9zYXZlcG9p\nbnRDYWNoZSA9IG51bGw7CgogICAgICAgIC8vIGZpcmUgYWZ0ZXIgc3RhdGUg\nY2hhbmdlIGV2ZW50CiAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5o\nYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9u\nRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywgVHJhbnNhY3Rpb25F\ndmVudC4KICAgICAgICAgICAgICAgIEFGVEVSX1NUQVRFX1RSQU5TSVRJT05T\nLCBtb2JqcywgbnVsbCwgbnVsbCwgbnVsbCkpOwoKICAgICAgICAvLyBub3cg\nY2xlYXIgdHJhbnMgY2FjaGU7IGtlZXAgY2xlYXJlZCB2ZXJzaW9uIHJhdGhl\nciB0aGFuCiAgICAgICAgLy8gbnVsbCB0byBhdm9pZCBoYXZpbmcgdG8gcmUt\nY3JlYXRlIHRoZSBzZXQgbGF0ZXI7IG1vcmUgZWZmaWNpZW50CiAgICAgICAg\naWYgKHRyYW5zU3RhdGVzICE9IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QpIHsK\nICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSAoVHJhbnNhY3Rpb25hbENhY2hl\nKSB0cmFuc1N0YXRlczsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUuY2xlYXIo\nKTsKICAgICAgICB9CgogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhl\neGNlcHMsIHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBPYmplY3QgbGlmZWN5Y2xlCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT2JqZWN0IG9iaiwgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIHBlcnNpc3Qob2JqLCBudWxsLCB0\ncnVlLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFu\nYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBpZCwKICAgICAgICBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcmV0dXJuIHBlcnNpc3Qob2Jq\nLCBpZCwgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcGVy\nc2lzdEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBwZXJzaXN0QWxsKG9ianMsIHRydWUsIGNhbGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0cy4gIElu\nZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdAog\nICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJP\nVklTSU9OQUwpLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0QWxs\nKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBleHBsaWNpdCwgCiAgICAgICAg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKCiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBwZXJzaXN0KGl0ci5uZXh0KCksIGV4cGxpY2l0\nLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRp\nb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2Vw\ncywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGdpdmVu\nIGVsZW1lbnQgaXMgbm90IG51bGwsIGFkZCBpdCB0byB0aGUgZ2l2ZW4gbGlz\ndCwKICAgICAqIGNyZWF0aW5nIHRoZSBsaXN0IGlmIG5lY2Vzc2FyeS4KICAg\nICAqLwogICAgcHJpdmF0ZSBMaXN0IGFkZChMaXN0IGwsIE9iamVjdCBvKSB7\nCiAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGw7\nCiAgICAgICAgaWYgKGwgPT0gbnVsbCkKICAgICAgICAgICAgbCA9IG5ldyBM\naW5rZWRMaXN0KCk7CiAgICAgICAgbC5hZGQobyk7CiAgICAgICAgcmV0dXJu\nIGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24g\nd3JhcHBpbmcgdGhlIGdpdmVuIG5lc3RlZCBleGNlcHRpb25zLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKExpc3Qg\nZXhjZXBzLCBib29sZWFuIGRhdGFzdG9yZSkgewogICAgICAgIGlmIChleGNl\ncHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgaWYgKGRhdGFzdG9yZSAmJiBleGNlcHMuc2l6ZSgp\nID09IDEpCiAgICAgICAgICAgIHRocm93IChSdW50aW1lRXhjZXB0aW9uKSBl\neGNlcHMuZ2V0KDApOwoKICAgICAgICBib29sZWFuIGZhdGFsID0gZmFsc2U7\nCiAgICAgICAgVGhyb3dhYmxlW10gdCA9IChUaHJvd2FibGVbXSkgZXhjZXBz\nLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBUaHJvd2FibGVbZXhjZXBzLnNp\nemUoKV0pOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdC5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAodFtpXSBpbnN0YW5jZW9mIE9wZW5K\nUEFFeGNlcHRpb24KICAgICAgICAgICAgICAgICYmICgoT3BlbkpQQUV4Y2Vw\ndGlvbikgdFtpXSkuaXNGYXRhbCgpKQogICAgICAgICAgICAgICAgZmF0YWwg\nPSB0cnVlOwogICAgICAgIH0KICAgICAgICBPcGVuSlBBRXhjZXB0aW9uIGVy\ncjsKICAgICAgICBpZiAoZGF0YXN0b3JlKQogICAgICAgICAgICBlcnIgPSBu\nZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBlcnIgPSBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKTsKICAgICAgICB0aHJv\ndyBlcnIuc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRhbChmYXRhbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmpl\nY3QuICBJbmRpY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBl\ncnNpc3QKICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAo\nUE5FV1BST1ZJU0lPTkFMKQogICAgICovCiAgICBwdWJsaWMgdm9pZCBwZXJz\naXN0KE9iamVjdCBvYmosIGJvb2xlYW4gZXhwbGljaXQsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBwZXJzaXN0KG9iaiwgbnVsbCwgZXhwbGljaXQs\nIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2\nZW4gb2JqZWN0LiAgSW5kaWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBs\naWNpdCBwZXJzaXN0CiAgICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBl\ncnNpc3QgKFBORVdQUk9WSVNJT05BTCkuCiAgICAgKiBTZWUge0BsaW5rIEJy\nb2tlcn0gZm9yIGRldGFpbHMgb24gdGhpcyBtZXRob2QuCiAgICAgKi8KICAg\nIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHBlcnNpc3QoT2JqZWN0IG9i\naiwgT2JqZWN0IGlkLCBib29sZWFuIGV4cGxpY2l0LAogICAgICAgIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0ZU9w\nZXJhdGlvbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAg\naWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHNtOwoKICAgICAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1\nbWVudChPcENhbGxiYWNrcy5PUF9QRVJTSVNULCBvYmosIHNtLCBjYWxsKTsK\nICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9O\nRSkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsKCiAgICAgICAgICAgIC8v\nIEFDVF9DQVNDQURFCiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxs\nYmFja3MuQUNUX1JVTikgPT0gMCkgewogICAgICAgICAgICAgICAgaWYgKHNt\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNp\nc3QoY2FsbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5PUF9QRVJTSVNU\nLCBvYmosIGNhbGwsCiAgICAgICAgICAgICAgICAgICAgICAgICJwZXJzaXN0\nIik7CiAgICAgICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIEFDVF9SVU4KICAgICAgICAgICAgUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjOwogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgicGVyc2lzdC1kZXRh\nY2hlZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLgogICAgICAgICAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qob2JqKTsKCiAgICAgICAg\nICAgICAgICBpZiAoIXNtLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAg\nICAgICAgIHNtLnBlcnNpc3QoKTsKICAgICAgICAgICAgICAgICAgICBfY2Fj\naGUucGVyc2lzdChzbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChhY3Rp\nb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0gMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIC8vIGFuIGVtYmVkZGVkIGZpZWxkOyBub3RpZnkg\ndGhlIG93bmVyIHRoYXQgdGhlIHZhbHVlIGhhcwogICAgICAgICAgICAgICAg\nLy8gY2hhbmdlZCBieSBiZWNvbWluZyBpbmRlcGVuZGVudGx5IHBlcnNpc3Rl\nbnQKICAgICAgICAgICAgICAgIHNtLmdldE93bmVyKCkuZGlydHkoc20uZ2V0\nT3duZXJNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEZpZWxk\nTWV0YURhdGEoKS5nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAgIF9jYWNo\nZS5wZXJzaXN0KHNtKTsKICAgICAgICAgICAgICAgIHBjID0gc20uZ2V0UGVy\nc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBwYyA9IGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nOwogICAgICAgICAgICAgICAgaWYgKHBjLnBjSXNEZXRhY2hlZCgpID09IEJv\nb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2Jq\nZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAg\nICAgICAgICgicGVyc2lzdC1kZXRhY2hlZCIsIEV4Y2VwdGlvbnMudG9TdHJp\nbmcob2JqKSkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRP\nYmplY3Qob2JqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRD\nbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KG9iaiwgbnVsbCwgbWV0YSwgTGlmZWN5Y2xlRXZlbnQuQkVG\nT1JFX1BFUlNJU1QpOwoKICAgICAgICAgICAgLy8gY3JlYXRlIGlkIGZvciBp\nbnN0YW5jZQogICAgICAgICAgICBpZiAoaWQgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgICAgICAgICBp\nZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywgbWV0YSk7CiAgICAgICAg\nICAgICAgICBlbHNlIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENs\nYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3du\naWQiLCBtZXRhKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlz\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdl\nIGRvbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5zdGFuY2UgY2FjaGVkCiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3RoZXIgPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsQnlJZChpZCwgZmFsc2UpOwogICAgICAgICAgICBpZiAob3RoZXIg\nIT0gbnVsbCAmJiAhb3RoZXIuaXNEZWxldGVkKCkgJiYgIW90aGVyLmlzTmV3\nKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJjYWNoZS1leGlzdHMiLAogICAgICAgICAgICAg\nICAgICAgIG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSwgaWQpKS5zZXRGYWls\nZWRPYmplY3Qob2JqKTsKCiAgICAgICAgICAgIC8vIGlmIGhhZCBlbWJlZGRl\nZCBzbSwgbnVsbCBpdAogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsK\nCiAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc20KICAgICAgICAgICAgc20g\nPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhpcyk7CiAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApIHsKICAg\nICAgICAgICAgICAgIGlmIChleHBsaWNpdCkKICAgICAgICAgICAgICAgICAg\nICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBORVcpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUo\ncGMsIFBDU3RhdGUuUE5FV1BST1ZJU0lPTkFMKTsKICAgICAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRl\nLlBOT05UUkFOU05FVyk7CiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BD\nYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAgICAgICAgICBz\nbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAgICAgICAgICAgcmV0dXJuIHNt\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVGVtcG9yYXJpbHkgbWFuYWdlIHRoZSBnaXZlbiBpbnN0YW5jZSBpbiBv\ncmRlciB0byBjYXNjYWRlIHRoZSBnaXZlbgogICAgICogb3BlcmF0aW9uIHRo\ncm91Z2ggaXQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjYXNjYWRlVHJh\nbnNpZW50KGludCBvcCwgT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCwK\nICAgICAgICBTdHJpbmcgZXJyT3ApIHsKICAgICAgICBQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsKCiAg\nICAgICAgLy8gaWYgdXNpbmcgZGV0YWNoZWQgc3RhdGUgbWFuYWdlciwgZG9u\nJ3QgcmVwbGFjZQogICAgICAgIGlmIChwYy5wY0dldFN0YXRlTWFuYWdlcigp\nICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0\naW9uKG9iaiwgZXJyT3ApOwoKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAg\nICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwg\ndHJ1ZSk7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0\nZU1hbmFnZXJJbXBsKFN0YXRlTWFuYWdlcklkLgogICAgICAgICAgICBuZXdJ\nbnN0YW5jZSh0aGlzKSwgbWV0YSwgdGhpcyk7CiAgICAgICAgc20uaW5pdGlh\nbGl6ZShwYywgUENTdGF0ZS5UTE9BREVEKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgICAgICBjYXNlIE9w\nQ2FsbGJhY2tzLk9QX1BFUlNJU1Q6CiAgICAgICAgICAgICAgICAgICAgc20u\nY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX0RFTEVU\nRToKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBPcENhbGxiYWNrcy5PUF9SRUZSRVNIOgogICAgICAgICAgICAgICAg\nICAgIHNtLmdhdGhlckNhc2NhZGVSZWZyZXNoKGNhbGwpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24o\nU3RyaW5nLnZhbHVlT2Yob3ApKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgc20ucmVsZWFzZSh0cnVl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlQWxs\nKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBMaXN0\nIGV4Y2VwcyA9IG51bGw7CiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChvYmogIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgZGVsZXRlKG9iaiwgZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUp\nLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRp\nb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2Up\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGUo\nT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChv\nYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAgICAgICBkZWxldGUob2Jq\nLCBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSksIGNhbGwpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW50\nZXJuYWwgZGVsZXRlLgogICAgICovCiAgICB2b2lkIGRlbGV0ZShPYmplY3Qg\nb2JqLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLCBvYmosIHNtLCBjYWxsKTsKICAg\nICAgICBpZiAoYWN0aW9uID09IE9wQ2FsbGJhY2tzLkFDVF9OT05FKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIEFDVF9DQVNDQURFCiAgICAg\nICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKSB7\nCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5PUF9E\nRUxFVEUsIG9iaiwgY2FsbCwgImRlbGV0ZSIpOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQoKICAgICAgICAvLyBBQ1RfUlVOCiAgICAgICAgaWYg\nKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQo\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgImRlbGV0ZSIpOwogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9w\nQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAgICAgICAgICAgICAg\nc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAgICAgICAgICAgc20uZGVsZXRl\nKCk7CiAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqKS5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpCiAgICAg\nICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgImRlbGV0\nZSIpOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9u\nIGluZGljYXRpbmcgdGhhdCB0aGUgY3VycmVudCBhY3Rpb24gY2FuJ3QgYmUK\nICAgICAqIHBlcmZvcm1lZCBvbiBhIGRldGFjaGVkIG9iamVjdC4KICAgICAq\nLwogICAgcHJpdmF0ZSBPcGVuSlBBRXhjZXB0aW9uIG5ld0RldGFjaGVkRXhj\nZXB0aW9uKE9iamVjdCBvYmosCiAgICAgICAgU3RyaW5nIG9wZXJhdGlvbikg\newogICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtZGV0YWNoZWQtb3AiLCBvcGVyYXRpb24sCiAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VBbGwoQ29sbGVjdGlvbiBv\nYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBv\nYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJlbGVhc2UoaXRyLm5l\neHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhj\nZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZh\nbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVs\nZWFzZShPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpOwogICAgICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vz\nc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFTEVBU0UsIG9iaiwgc20sIGNh\nbGwpOwoKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxs\nYmFja3MuQUNUX1JVTikgIT0gMCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewog\nICAgICAgICAgICAgICAgYm9vbGVhbiBwZW5kaW5nID0gc20uaXNQZW5kaW5n\nVHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAgc20ucmVsZWFzZSh0\ncnVlKTsKICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nKQogICAgICAgICAg\nICAgICAgICAgIHJlbW92ZUZyb21QZW5kaW5nVHJhbnNhY3Rpb24oc20pOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBlbWJlZChP\nYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBvd25lciwgVmFsdWVNZXRhRGF0YSBvd25lck1ldGEpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcgPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIGFscmVhZHkgZW1iZWRkZWQsIG5v\ndGhpbmcgdG8gZG8KICAgICAgICAgICAgICAgIGlmIChvcmlnLmdldE93bmVy\nKCkgPT0gb3duZXIgJiYgb3JpZy5nZXRNZXRhRGF0YSgpLgogICAgICAgICAg\nICAgICAgICAgIGdldEVtYmVkZGluZ01ldGFEYXRhKCkgPT0gb3duZXJNZXRh\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnOwoKICAgICAgICAg\nICAgICAgIC8vIG90aGVyd2lzZSBtYWtlIHN1cmUgcGMgaXMgZnVsbHkgbG9h\nZGVkIGZvciB3aGVuIHdlIGNvcHkgaXRzCiAgICAgICAgICAgICAgICAvLyBk\nYXRhIGJlbG93CiAgICAgICAgICAgICAgICBvcmlnLmxvYWQoX2ZjLCBTdGF0\nZU1hbmFnZXJJbXBsLkxPQURfQUxMLCBudWxsLCBudWxsLCBmYWxzZSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3RhdGUg\nbWFuYWdlciB3aXRoIGVtYmVkZGVkIG1ldGFkYXRhCiAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IG93bmVyTWV0YS5nZXRFbWJlZGRlZE1ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1lbWJlZCIsIG93bmVyTWV0YSkpOwoKICAgICAgICAgICAgaWYgKGlk\nID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IFN0YXRlTWFuYWdlcklk\nLm5ld0luc3RhbmNlKHRoaXMpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKGlkLCBtZXRhLCB0aGlz\nKTsKICAgICAgICAgICAgc20uc2V0T3duZXIoKFN0YXRlTWFuYWdlckltcGwp\nIG93bmVyLCBvd25lck1ldGEpOwoKICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIGNvcHk7CiAgICAgICAgICAgIFBDU3RhdGUgc3RhdGU7CiAgICAg\nICAgICAgIENsYXNzIHR5cGUgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsK\nICAgICAgICAgICAgaWYgKHR5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAg\nICAgICAgIHR5cGUgPSBtZXRhLmdldEludGVyZmFjZUltcGwoKTsKICAgICAg\nICAgICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBn\naXZlIGNvcHkgYW5kIHRoZSBvcmlnaW5hbCBpbnN0YW5jZSB0aGUgc2FtZSBz\ndGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IHdlIGNh\nbiBjb3B5IGZpZWxkcyBmcm9tIG9uZSB0byB0aGUgb3RoZXIKICAgICAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgY29weVNNOwogICAgICAgICAgICAg\nICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjOwogICAgICAgICAgICAgICAgaWYg\nKG9yaWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNvcHlTTSA9\nIHNtOwogICAgICAgICAgICAgICAgICAgIHBjID0gYXNzZXJ0UGVyc2lzdGVu\nY2VDYXBhYmxlKG9iaik7CiAgICAgICAgICAgICAgICAgICAgcGMucGNSZXBs\nYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgY29weVNNID0gb3JpZzsKICAgICAgICAg\nICAgICAgICAgICBwYyA9IG9yaWcuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAvLyBjb3B5IHRoZSBpbnN0YW5jZS4gIHdlIGRv\nIHRoaXMgZXZlbiBpZiBpdCBkb2Vzbid0IGFscmVhZHkKICAgICAgICAgICAg\nICAgICAgICAvLyBoYXZlIGEgc3RhdGUgbWFuYWdlciBpbiBjYXNlIGl0IGlz\nIGxhdGVyIGFzc2lnbmVkIHRvIGEKICAgICAgICAgICAgICAgICAgICAvLyBQ\nQyBmaWVsZDsgYXQgdGhhdCBwb2ludCBpdCdzIHRvbyBsYXRlIHRvIGNvcHkK\nICAgICAgICAgICAgICAgICAgICBjb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0\nYW5jZSh0eXBlLCBjb3B5U00sIGZhbHNlKTsKICAgICAgICAgICAgICAgICAg\nICBpbnRbXSBmaWVsZHMgPSBuZXcgaW50W21ldGEuZ2V0RmllbGRzKCkubGVu\nZ3RoXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICAgICAg\nZmllbGRzW2ldID0gaTsKICAgICAgICAgICAgICAgICAgICBjb3B5LnBjQ29w\neUZpZWxkcyhwYywgZmllbGRzKTsKICAgICAgICAgICAgICAgICAgICBzdGF0\nZSA9IFBDU3RhdGUuRUNPUFk7CiAgICAgICAgICAgICAgICAgICAgY29weS5w\nY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7CiAgICAgICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0\nYW5jZSBkaWRuJ3QgaGF2ZSBhIHN0YXRlIG1hbmFnZXIgdG8gc3RhcnQsCiAg\nICAgICAgICAgICAgICAgICAgLy8gcmV2ZXJ0IGl0IHRvIGJlaW5nIHRyYW5z\naWVudAogICAgICAgICAgICAgICAgICAgIGlmIChvcmlnID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdl\ncihudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3Rh\nbmNlKHR5cGUsIHNtLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwICYmICFfb3B0aW1pc3RpYykKICAg\nICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRUNMRUFOOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0g\nUENTdGF0ZS5FTk9OVFJBTlM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHNtLmluaXRpYWxpemUoY29weSwgc3RhdGUpOwogICAgICAgICAgICByZXR1\ncm4gc207CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJZiBub3QgYWxyZWFkeSBjYWNoZWQsIGNyZWF0ZSBhbiBlbXB0\neSBjb3B5IG9mIHRoZSBnaXZlbiBzdGF0ZQogICAgICogbWFuYWdlciBpbiB0\naGUgZ2l2ZW4gc3RhdGUuCiAgICAgKi8KICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgY29weShPcGVuSlBBU3RhdGVNYW5hZ2VyIGNvcHksIFBDU3RhdGUgc3Rh\ndGUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIE9i\namVjdCBvaWQgPSBjb3B5LmZldGNoT2JqZWN0SWQoKTsKICAgICAgICAgICAg\nQ2xhc3MgdHlwZSA9IGNvcHkuZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xh\nc3MoKTsKICAgICAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgIC8vIGNhY2hlZCBpbnN0YW5jZT8KICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IG51bGw7CiAgICAgICAgICAgIGlmICghY29weS5pc0Vt\nYmVkZGVkKCkpCiAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGxCeUlkKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChzbSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nb3MgPSBfY29uZi4KICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YVJl\ncG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEodHlwZSwgX2xvYWRlciwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAvLyBjb25zdHJ1Y3QgYSBuZXcgc3Rh\ndGUgbWFuYWdlciB3aXRoIGFsbCBpbmZvIGtub3duCiAgICAgICAgICAgICAg\nICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7\nCiAgICAgICAgICAgICAgICBzbS5zZXRPYmplY3RJZChvaWQpOwogICAgICAg\nICAgICAgICAgc20uaW5pdGlhbGl6ZShzbS5nZXRNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKSwgc3RhdGUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiBzbTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVmcmVzaEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoKTsKCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jq\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nIGdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCksIGNhbGwpOwogICAg\nICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLnNpemUo\nKSA9PSAxKQogICAgICAgICAgICAgICAgcmVmcmVzaEludGVybmFsKF9vcGVy\nYXRpbmcuaXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICByZWZyZXNoSW50ZXJuYWwoX29wZXJhdGlu\nZywgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAg\nICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2gob2JqLCBjYWxsKTsKICAgICAg\nICAgICAgaWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXplKCkg\nPT0gMSkKICAgICAgICAgICAgICAgIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0\naW5nLml0ZXJhdG9yKCkubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcs\nIGNhbGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdh\ndGhlcnMgYWxsIG9iamVjdHMgcmVhY2hhYmxlIHRocm91Z2ggY2FzY2FkZS1y\nZWZyZXNoIHJlbGF0aW9ucwogICAgICogaW50byB0aGUgb3BlcmF0aW5nIHNl\ndC4KICAgICAqLwogICAgdm9pZCBnYXRoZXJDYXNjYWRlUmVmcmVzaChPYmpl\nY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKCFfb3Bl\ncmF0aW5nLmFkZChvYmopKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9i\naiwgZmFsc2UpOwogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCk7CiAg\nICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkg\nPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoc20gIT0g\nbnVsbCkKICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2Fs\nbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjYXNjYWRlVHJhbnNpZW50\nKE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgY2FsbCwgInJlZnJlc2gi\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxl\nZCB3aXRoIHRoZSBmdWxsIHNldCBvZiBvYmplY3RzIHJlYWNoYWJsZSB2aWEK\nICAgICAqIGNhc2NhZGUtcmVmcmVzaCByZWxhdGlvbnMgZnJvbSB0aGUgdXNl\nci1naXZlbiBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHJlZnJlc2hJbnRlcm5hbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBpbnN0YW5jZXMgdGhhdCBu\nZWVkIGEgcmVmcmVzaAogICAgICAgICAgICBDb2xsZWN0aW9uIGxvYWQgPSBu\ndWxsOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAg\nICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBz\nbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5P\nUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBp\nZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwog\nICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzbS5iZWZvcmVSZWZy\nZXNoKHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbG9hZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxvYWQgPSBuZXcgQXJyYXlMaXN0KG9ianMuc2l6ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo\nYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkK\nICAgICAgICAgICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlv\nbihvYmosICJyZWZyZXNoIik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhj\nZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyByZWZyZXNoIGFsbAogICAgICAg\nICAgICBpZiAobG9hZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDb2xs\nZWN0aW9uIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsCiAg\nICAgICAgICAgICAgICAgICAgU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfUkVG\nUkVTSCwgX2ZjLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChmYWlsZWQg\nIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbihmYWlsZWQpKTsKCiAgICAgICAgICAgICAgICAvLyBwZXJmb3Jt\nIHBvc3QtcmVmcmVzaCB0cmFuc2l0aW9ucyBhbmQgbWFrZSBzdXJlIGFsbCBm\nZXRjaAogICAgICAgICAgICAgICAgLy8gZ3JvdXAgZmllbGRzIGFyZSBsb2Fk\nZWQKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbG9hZC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5j\nb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgpOwogICAgICAgICAg\nICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5M\nT0FEX0ZHUywgbnVsbCwgbnVsbCwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgICAgICBl\neGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBub3cgaW52b2tlIHBvc3RSZWZyZXNoIG9uIGFsbCB0aGUgaW5zdGFu\nY2VzCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGwoaXRyLm5leHQoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgIXNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNtLmdldE1hbmFnZWRJ\nbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfUkVGUkVT\nSCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywga2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25z\nKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogT3B0aW1p\nemF0aW9uIGZvciBzaW5nbGUtb2JqZWN0IHJlZnJlc2guCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5hbChPYmplY3Qgb2JqLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCkKICAgICAgICAg\nICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwg\nInJlZnJlc2giKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNtLmJlZm9y\nZVJlZnJlc2goZmFsc2UpKSB7CiAgICAgICAgICAgICAgICAgICAgc20ubG9h\nZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGws\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzbS5hZnRlclJlZnJlc2go\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVsbCwKICAg\nICAgICAgICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVF\ndmVudC5BRlRFUl9SRUZSRVNIKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChh\nc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQog\nICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJldHJpZXZlQWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBkZmdPbmx5\nLAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jq\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAo\nb2Jqcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICByZXRyaWV2ZShvYmpz\nLml0ZXJhdG9yKCkubmV4dCgpLCBkZmdPbmx5LCBjYWxsKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTGlzdCBleGNlcHMgPSBu\ndWxsOwogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNz\nZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIC8vIGNv\nbGxlY3QgYWxsIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQKICAgICAgICAg\nICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2FkID0g\nbnVsbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgQXJyYXlMaXN0KG9ianMuc2l6\nZSgpKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBv\nYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVUUklFVkUs\nIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAgICAgICAgICYgT3BD\nYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFj\naGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdE\nZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHNtcy5hZGQoc20pOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0\nYXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChsb2FkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0\nZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQogICAgICAgICAgICAg\nICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJldHJp\nZXZlIik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9u\nIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBsb2FkIGFsbCBob2xsb3cgaW5zdGFuY2VzCiAgICAgICAg\nICAgIENvbGxlY3Rpb24gZmFpbGVkID0gbnVsbDsKICAgICAgICAgICAgaWYg\nKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaW50IG1vZGUgPSAo\nZGZnT25seSkgPyBfc3RvcmUuRk9SQ0VfTE9BRF9ERkcKICAgICAgICAgICAg\nICAgICAgICA6IF9zdG9yZS5GT1JDRV9MT0FEX0FMTDsKICAgICAgICAgICAg\nICAgIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIG1vZGUs\nIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51\nbGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRp\nb24oZmFpbGVkKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJl\ndHJpZXZlIGFsbCBub24tZmFpbGVkIGluc3RhbmNlcwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1w\nbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0g\nbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgaW50IG1v\nZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTCiAg\nICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxM\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBz\nbS5iZWZvcmVSZWFkKC0xKTsKICAgICAgICAgICAgICAgICAgICBzbS5sb2Fk\nKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNl\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXRyaWV2ZShPYmplY3Qgb2Jq\nLCBib29sZWFuIGRmZ09ubHksIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAg\nICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb250cmFu\nc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAg\nICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVU\nUklFVkUsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47\nCgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOwog\nICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTCiAgICAgICAgICAgICAgICAgICAgICAgIDog\nU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICAgICAgICAgICAg\nICBzbS5iZWZvcmVSZWFkKC0xKTsKICAgICAgICAgICAgICAgICAgICBzbS5s\nb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAg\nICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXdE\nZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxs\nKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gZXZpY3QgYWxs\nIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9iamVjdHMKICAgICAgICAgICAgQ29s\nbGVjdGlvbiBjID0gZ2V0TWFuYWdlZFN0YXRlcygpOwogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkgJiYgIXNt\nLmlzRGlydHkoKSkKICAgICAgICAgICAgICAgICAgICBldmljdChzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSwgY2FsbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdEFs\nbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAg\nICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBldmlj\ndChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNl\ncHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGV2aWN0QWxsKEV4dGVudCBleHRlbnQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBpZiAoZXh0ZW50ID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIGV2aWN0IGFsbCBQQ2xlYW4gYW5kIFBOb25U\ncmFucyBvYmplY3RzIGluIGV4dGVudAogICAgICAgICAgICBDb2xsZWN0aW9u\nIGMgPSBnZXRNYW5hZ2VkU3RhdGVzKCk7CiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207CiAgICAgICAgICAgIENsYXNzIGNsczsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVy\nc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBjbHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUo\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2xzID09IGV4dGVudC5nZXRF\nbGVtZW50VHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChleHRl\nbnQuaGFzU3ViY2xhc3NlcygpCiAgICAgICAgICAgICAgICAgICAgICAgICYm\nIGV4dGVudC5nZXRFbGVtZW50VHlwZSgpLmlzQXNzaWduYWJsZUZyb20oY2xz\nKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGV2aWN0KHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBl\ndmljdChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVu\ndChPcENhbGxiYWNrcy5PUF9FVklDVCwgb2JqLCBzbSwgY2FsbCkKICAgICAg\nICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBzbS5ldmlj\ndCgpOwogICAgICAgICAgICBpZiAoX2V2aWN0RGF0YUNhY2hlICYmIHNtLmdl\ndE9iamVjdElkKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgRGF0YUNh\nY2hlIGNhY2hlID0gc20uZ2V0TWV0YURhdGEoKS5nZXREYXRhQ2FjaGUoKTsK\nICAgICAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIGNhY2hlLnJlbW92ZShzbS5nZXRPYmplY3RJZCgpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2JqZWN0IG9iaiwgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVs\nbCkKICAgICAgICAgICAgY2FsbCA9IF9jYWxsOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gbmV3IERldGFjaE1hbmFnZXIodGhpcywgZmFsc2UsIGNhbGwpLmRldGFj\naChvYmopOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3RbXSBkZXRhY2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfT0JKRUNUUzsKICAgICAg\nICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBjYWxsID0gX2NhbGw7\nCgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoTWFuYWdlcih0aGlzLCBm\nYWxzZSwgY2FsbCkuZGV0YWNoQWxsKG9ianMpOwogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRldGFjaEFsbChPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZGV0YWNoQWxsKGNhbGwsIHRydWUp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRldGFjaEFsbChPcENhbGxiYWNr\ncyBjYWxsLCBib29sZWFuIGZsdXNoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gSWYgYSBm\nbHVzaCBpcyBkZXNpcmVkIChiYXNlZCBvbiBpbnB1dCBwYXJtKSwgdGhlbiBj\naGVjayBpZiB0aGUKICAgICAgICAgICAgLy8gICAiZGlydHkiIGZsYWcgaXMg\nc2V0IGJlZm9yZSBjYWxsaW5nIGZsdXNoKCkuCiAgICAgICAgICAgIGlmICgo\nZmx1c2gpICYmICgoX2ZsYWdzICYgRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0g\nMCkpCiAgICAgICAgICAgICAgICBmbHVzaCgpOwogICAgICAgICAgICBkZXRh\nY2hBbGxJbnRlcm5hbChjYWxsKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZGV0YWNoQWxsSW50ZXJuYWwoT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIENvbGxlY3Rpb24gc3RhdGVzID0g\nZ2V0TWFuYWdlZFN0YXRlcygpOwogICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzdGF0ZXMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgc20gPSAoU3Rh\ndGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKCFz\nbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUo\nKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXNtLmdldE1ldGFEYXRhKCkuaXNE\nZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgICAgIHNtLnJlbGVhc2UodHJ1\nZSk7CiAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlcy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkK\nICAgICAgICAgICAgY2FsbCA9IF9jYWxsOwogICAgICAgIG5ldyBEZXRhY2hN\nYW5hZ2VyKHRoaXMsIHRydWUsIGNhbGwpLmRldGFjaEFsbAogICAgICAgICAg\nICAobmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHN0YXRlcykpOwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgYXR0YWNoKE9iamVjdCBvYmosIGJvb2xl\nYW4gY29weU5ldywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChv\nYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIG1ha2Ugc3VyZSBub3QgdG8gdHJ5IHRvIHNldCByb2xsYmFjayBv\nbmx5IGlmIHRoaXMgZmFpbHMKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVy\nYXRpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgQXR0YWNoTWFuYWdlcih0aGlzLCBjb3B5TmV3LCBjYWxsKS5h\ndHRhY2gob2JqKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3B0aW1pc3RpY0V4\nY2VwdGlvbiBvZSkgewogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5\nKG9lKTsKICAgICAgICAgICAgICAgIHRocm93IG9lLnNldEZhdGFsKHRydWUp\nOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdFtd\nIGF0dGFjaEFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gY29weU5ldywK\nICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gRU1QVFlfT0JK\nRUNUUzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8g\nc2V0IHJvbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWlscwogICAgICAgICAgICBh\nc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2hNYW5hZ2VyKHRoaXMsIGNv\ncHlOZXcsIGNhbGwpLmF0dGFjaEFsbChvYmpzKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkgewogICAgICAgICAgICAg\nICAgc2V0Um9sbGJhY2tPbmx5KG9lKTsKICAgICAgICAgICAgICAgIHRocm93\nIG9lLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgbm9udHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9u\nIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBMaXN0IGV4\nY2VwcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBub250cmFuc2FjdGlv\nbmFsKGl0ci5uZXh0KCksIGNhbGwpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGV4\nY2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMo\nZXhjZXBzLCBmYWxzZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIG5vbnRyYW5zYWN0aW9uYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0g\nZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBp\nZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9OT05UUkFOU0FD\nVElPTkFMLCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHNtLm5vbnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVuIGluc3Rh\nbmNlcyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0\ncmFuc2FjdGlvbmFsQWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiB1cGRh\ndGVWZXJzaW9uLAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAg\nICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICB0cmFu\nc2FjdGlvbmFsKG9ianMuaXRlcmF0b3IoKS5uZXh0KCksIHVwZGF0ZVZlcnNp\nb24sIGNhbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xsb3cgaW5zdGFuY2VzIGZvciBs\nb2FkLCBhbmQgbWFrZSB1bm1hbmFuZ2VkCiAgICAgICAgICAgIC8vIGluc3Rh\nbmNlcyB0cmFuc2llbnQtdHJhbnNhY3Rpb25hbAogICAgICAgICAgICBDb2xs\nZWN0aW9uIGxvYWQgPSBudWxsOwogICAgICAgICAgICBPYmplY3Qgb2JqOwog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc21z\nID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAgICAgIExp\nc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfVFJBTlNBQ1RJT05BTCwgb2JqLCBzbSwKICAgICAgICAgICAgICAgICAg\nICAgICAgY2FsbCkgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICAgICAgaWYgKHNtID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gbWFuYWdlIHRyYW5zaWVudCBpbnN0YW5jZQogICAgICAgICAgICAg\nICAgICAgICAgICBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5\nSW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldE1l\ndGFEYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAg\nICAgICAgICAgICAgICAgICAgIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIChTdGF0ZU1hbmFnZXJJZC5u\nZXdJbnN0YW5jZSh0aGlzKSwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBh\nYmxlKG9iaiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ1N0YXRl\nLlRDTEVBTik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5p\nc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBhc3Nl\ncnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAg\nICBzbXMuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNt\nLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20pOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nICAgICBzbS5zZXRDaGVja1ZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICh1cGRhdGVWZXJzaW9uKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc20uc2V0VXBkYXRlVmVyc2lvbih0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlS\nRUQ7IC8vIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoVXNl\nckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gbG9hZCBhbGwgaG9sbG93IGluc3RhbmNl\ncwogICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51bGw7CiAgICAg\nICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZh\naWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JD\nRV9MT0FEX05PTkUsCiAgICAgICAgICAgICAgICAgICAgX2ZjLCBudWxsKTsK\nICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVk\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLAogICAgICAgICAgICAgICAgICAgICAgICBuZXdPYmplY3ROb3RG\nb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgdHJhbnNhY3Rpb25hbFN0YXRlc0FsbChzbXMsIGZhaWxlZCwgZXhj\nZXBzKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgdGhlIGdpdmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFs\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlvbmFsKE9iamVj\ndCBvYmosIGJvb2xlYW4gdXBkYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAg\nIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNU\nSU9OQUwsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47\nCgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3Rl\nbnQoKSkgewogICAgICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rp\nb24oKTsKICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAg\nICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxP\nQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBz\nbS5zZXRDaGVja1ZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAo\ndXBkYXRlVmVyc2lvbikKICAgICAgICAgICAgICAgICAgICBzbS5zZXRVcGRh\ndGVWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hlY2svdXAKICAgICAg\nICAgICAgfSBlbHNlIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAvLyBtYW5hZ2UgdHJhbnNpZW50IGluc3RhbmNlCiAgICAgICAgICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGFE\nYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgICAgIE9iamVjdCBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNl\nKHRoaXMpOwogICAgICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2Vy\nSW1wbChpZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICBzbS5pbml0\naWFsaXplKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLAogICAgICAg\nICAgICAgICAgICAgIFBDU3RhdGUuVENMRUFOKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUcmFuc2l0aW9uIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0\nbyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJh\nbnNhY3Rpb25hbFN0YXRlc0FsbChDb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlv\nbiBmYWlsZWQsCiAgICAgICAgTGlzdCBleGNlcHMpIHsKICAgICAgICAvLyBt\nYWtlIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsIGFuZCBtYWtlIHN1cmUgdGhl\neSBhcmUgbG9hZGVkCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51\nbGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNtLmdldElkKCkpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgc20udHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAgc20u\nbG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51\nbGwsIGZhbHNlKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywga2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93\nTmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRXh0ZW50LCBRdWVyeQogICAgLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgRXh0ZW50IG5ld0V4dGVudChD\nbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMpIHsKICAgICAgICByZXR1\ncm4gbmV3RXh0ZW50KHR5cGUsIHN1YmNsYXNzZXMsIG51bGwpOwogICAgfQoK\nICAgIHByaXZhdGUgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29s\nZWFuIHN1YmNsYXNzZXMsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgRXh0ZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0\nZW50SW1wbCh0aGlzLCB0eXBlLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAg\nICAgICAgIGlmIChfZXh0ZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nX2V4dGVudHMgPSBuZXcgUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNo\nU2V0LldFQUspOwogICAgICAgICAgICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsK\nCiAgICAgICAgICAgIHJldHVybiBleHRlbnQ7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJh\ndG9yKENsYXNzIHR5cGUsIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJvb2xlYW4gaWdub3JlQ2hhbmdl\ncykgewogICAgICAgIEV4dGVudCBleHRlbnQgPSBuZXdFeHRlbnQodHlwZSwg\nc3ViY2xhc3NlcywgZmV0Y2gpOwogICAgICAgIGV4dGVudC5zZXRJZ25vcmVD\naGFuZ2VzKGlnbm9yZUNoYW5nZXMpOwogICAgICAgIHJldHVybiBleHRlbnQu\naXRlcmF0b3IoKTsKICAgIH0KCiAgICBwdWJsaWMgUXVlcnkgbmV3UXVlcnko\nU3RyaW5nIGxhbmcsIENsYXNzIGNscywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAg\nICAgUXVlcnkgcSA9IG5ld1F1ZXJ5KGxhbmcsIHF1ZXJ5KTsKICAgICAgICBx\nLnNldENhbmRpZGF0ZVR5cGUoY2xzLCB0cnVlKTsKICAgICAgICByZXR1cm4g\ncTsKICAgIH0KCiAgICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxh\nbmcsIE9iamVjdCBxdWVyeSkgewogICAgICAgIC8vIGNvbW1vbiBtaXN0YWtl\ncwogICAgICAgIGlmIChxdWVyeSBpbnN0YW5jZW9mIEV4dGVudCB8fCBxdWVy\neSBpbnN0YW5jZW9mIENsYXNzKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW5ldy1xdWVyeSIpKTsKCiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFN0b3JlUXVlcnkgc3EgPSBfc3RvcmUubmV3UXVlcnkobGFuZyk7\nCiAgICAgICAgICAgIGlmIChzcSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBFeHByZXNzaW9uUGFyc2VyIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2Vy\nRm9yTGFuZ3VhZ2UobGFuZyk7CiAgICAgICAgICAgICAgICBpZiAoZXAgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBzcSA9IG5ldyBFeHByZXNzaW9u\nU3RvcmVRdWVyeShlcCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChRdWVy\neUxhbmd1YWdlcy5MQU5HX01FVEhPRFFMLmVxdWFscyhsYW5nKSkKICAgICAg\nICAgICAgICAgICAgICBzcSA9IG5ldyBNZXRob2RTdG9yZVF1ZXJ5KCk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKGxhbmcpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBRdWVyeSBxID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNx\nKTsKICAgICAgICAgICAgcS5zZXRJZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFu\nZ2VzKTsKICAgICAgICAgICAgaWYgKHF1ZXJ5ICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBxLnNldFF1ZXJ5KHF1ZXJ5KTsKCiAgICAgICAgICAgIC8vIHRy\nYWNrIHF1ZXJpZXMKICAgICAgICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBfcXVlcmllcyA9IG5ldyBSZWZlcmVuY2VIYXNo\nU2V0KFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7CiAgICAgICAgICAgIF9xdWVy\naWVzLmFkZChxKTsKICAgICAgICAgICAgcmV0dXJuIHE7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBu\nZXcgcXVlcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBRdWVyeUltcGwgbmV3\nUXVlcnlJbXBsKFN0cmluZyBsYW5nLCBTdG9yZVF1ZXJ5IHNxKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBRdWVyeUltcGwodGhpcywgbGFuZywgc3EpOwogICAg\nfQoKICAgIHB1YmxpYyBTZXEgZ2V0SWRlbnRpdHlTZXF1ZW5jZShDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVu\nY2UobWV0YSwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFNlcSBnZXRWYWx1\nZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBy\nZXR1cm4gZ2V0U2VxdWVuY2UoZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSwg\nZm1kKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcXVlbmNl\nIGZvciB0aGUgZ2l2ZW4gY2xhc3MgYW5kIG9wdGlvbmFsIGZpZWxkLgogICAg\nICovCiAgICBwcml2YXRlIFNlcSBnZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRh\nIG1ldGEsIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgLy8gZ2V0IHNl\ncXVlbmNlIHN0cmF0ZWd5IGZyb20gbWV0YWRhdGEKICAgICAgICBpbnQgc3Ry\nYXRlZ3k7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBz\ndHJhdGVneSA9IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RyYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJh\ndGVneSgpOwoKICAgICAgICAvLyB3ZSBjYW4gaGFuZGxlIG5vbi1uYXRpdmUg\nc3RyYXRlZ2llcyB3aXRob3V0IHRoZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAg\nc3dpdGNoIChzdHJhdGVneSkgewogICAgICAgICAgICBjYXNlIFZhbHVlU3Ry\nYXRlZ2llcy5VVUlEX0hFWDoKICAgICAgICAgICAgICAgIHJldHVybiBVVUlE\nSGV4U2VxLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVT\ndHJhdGVnaWVzLlVVSURfU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJu\nIFVVSURTdHJpbmdTZXEuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2Fz\nZSBWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0U6CiAgICAgICAgICAgICAgICBT\nZXF1ZW5jZU1ldGFEYXRhIHNtZCA9IChmbWQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICA/IG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRh\nKCkKICAgICAgICAgICAgICAgICAgICA6IGZtZC5nZXRWYWx1ZVNlcXVlbmNl\nTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHJldHVybiBzbWQuZ2V0SW5z\ndGFuY2UoX2xvYWRlcik7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICAvLyB1c2Ugc3RvcmUgbWFuYWdlciBmb3IgbmF0aXZlIHNlcXVl\nbmNlCiAgICAgICAgICAgICAgICBpZiAoZm1kID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgcmV0dXJuIGEgc2VxdWVuY2Ug\nZXZlbiBmb3IgYXBwIGlkIGNsYXNzZXMsCiAgICAgICAgICAgICAgICAgICAg\nLy8gd2hpY2ggaXMgd2hhdCB3ZSB3YW50IGZvciBiYWNrd2FyZHMtY29tcGF0\naWJpbGl0eQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0\nRGF0YVN0b3JlSWRTZXF1ZW5jZShtZXRhKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0VmFsdWVTZXF1ZW5j\nZShmbWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAg\nLy8gTG9ja2luZwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBs\nb2NrKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2Nr\nIGxldmVsIGFsd2F5cyBOT05FCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nbG9jayhvYmosIF9mYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9j\na1RpbWVvdXQoKSwgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGxvY2soT2JqZWN0IG9iaiwgaW50IGxldmVsLCBpbnQgdGlt\nZW91dCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRB\nY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAg\nICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1Bf\nTE9DSywgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxs\nYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgaWYgKHNtID09IG51bGwgfHwgIXNtLmlzUGVyc2lzdGVu\ndCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX2xt\nLmxvY2soc20sIGxldmVsLCB0aW1lb3V0LCBudWxsKTsKICAgICAgICAgICAg\nc20ucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOyAvLyB1c2Ugc2FtZSBsZXZl\nbCBmb3IgZnV0dXJlIHdyaXRlCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVsIGFsd2F5\ncyBOT05FCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9ja0FsbChvYmpz\nLCBfZmMuZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0\nKCksCiAgICAgICAgICAgICAgICBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIGlu\ndCBsZXZlbCwgaW50IHRpbWVvdXQsCiAgICAgICAgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAg\nICAgICAgIGxvY2sob2Jqcy5pdGVyYXRvcigpLm5leHQoKSwgbGV2ZWwsIHRp\nbWVvdXQsIGNhbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAg\nICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgQXJyYXlMaXN0KG9ianMuc2l6\nZSgpKTsKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChv\nYmosIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfTE9DSywgb2JqLCBzbSwgY2FsbCkKICAgICAg\nICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBp\nZiAoc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAg\nICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgX2xtLmxvY2tBbGwoc21zLCBsZXZlbCwgdGltZW91dCwgbnVsbCk7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc21zLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgKChTdGF0ZU1h\nbmFnZXJJbXBsKSBpdHIubmV4dCgpKS5yZWFkTG9ja2VkKGxldmVsLCBsZXZl\nbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIENvbm5lY3Rpb24KICAgIC8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxsKCkgewogICAgICAgIC8v\nIHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2ssIHNpbmNlIHdlIHdhbnQgdG8g\nYWxsb3cgYSBkaWZmZXJlbnQKICAgICAgICAvLyB0aHJlYWQgdG8gYmUgYWJs\nZSB0byBjYW5jZWwgb24gYSBsb2NrZWQtdXAgcGVyc2lzdGVuY2UgbWFuYWdl\ncgoKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gaWYgd2UncmUgZmx1c2hpbmcsIGhhdmUgdG8gc2V0IHJvbGxi\nYWNrIG9ubHkgLS0gZG8gdGhpcyBiZWZvcmUgd2UKICAgICAgICAgICAgLy8g\nYXR0ZW1wdCB0byBjYW5jZWwsIGJlY2F1c2Ugb3RoZXJ3aXNlIHRoZSBjYW5j\nZWwgbWlnaHQgY2FzZSB0aGUKICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb24g\ndG8gY29tcGxldGUgYmVmb3JlIHdlIGhhdmUgYSBjaGFuY2UgdG8gc2V0IHRo\nZQogICAgICAgICAgICAvLyByb2xsYmFjayBvbmx5IGZsYWcKICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0ZMVVNISU5HKSAhPSAwKQog\nICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwobmV3IFVz\nZXJFeGNlcHRpb24oKSk7CiAgICAgICAgICAgIHJldHVybiBfc3RvcmUuY2Fu\nY2VsQWxsKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29u\ndGFpbnMKICAgICAgICAgICAgKF9jb25mLk9QVElPTl9EQVRBU1RPUkVfQ09O\nTkVDVElPTikpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldCgiY29ubi1ub3Qtc3VwcG9ydGVkIikpOwoKICAg\nICAgICByZXR1cm4gX3N0b3JlLmdldENsaWVudENvbm5lY3Rpb24oKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNDb25uZWN0aW9uKCkgewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZM\nQUdfUkVUQUlORURfQ09OTikgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRlbGwgc3RvcmUgdG8gcmV0YWluIGNvbm5lY3Rpb24gaWYgd2UgaGF2ZW4n\ndCBhbHJlYWR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmV0YWluQ29u\nbmVjdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUkVUQUlO\nRURfQ09OTikgPT0gMCkgewogICAgICAgICAgICBfc3RvcmUucmV0YWluQ29u\nbmVjdGlvbigpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRVRBSU5F\nRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlbGwg\nc3RvcmUgdG8gcmVsZWFzZSBjb25uZWN0aW9uIGlmIHdlIGhhdmUgcmV0YWlu\nZWQgb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVsZWFzZUNvbm5l\nY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVE\nX0NPTk4pICE9IDApIHsKICAgICAgICAgICAgX3N0b3JlLnJlbGVhc2VDb25u\nZWN0aW9uKCk7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19SRVRBSU5F\nRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8KICAgIC8v\nIENhY2hlCiAgICAvLy8vLy8vLy8KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBn\nZXRNYW5hZ2VkT2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBN\nYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRNYW5hZ2VkU3RhdGVzKCkpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRU\ncmFuc2FjdGlvbmFsT2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRUcmFuc2FjdGlvbmFsU3Rh\ndGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbE9iamVjdHMoKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24KICAg\nICAgICAgICAgICAgIChnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbFN0YXRlcygp\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24g\nZ2V0RGlydHlPYmplY3RzKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1h\nbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdldERpcnR5U3RhdGVzKCkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcmRlckRp\ncnR5T2JqZWN0cygpIHsKICAgICAgICByZXR1cm4gX29yZGVyRGlydHk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0T3JkZXJEaXJ0eU9iamVjdHMoYm9v\nbGVhbiBvcmRlcikgewogICAgICAgIF9vcmRlckRpcnR5ID0gb3JkZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBtYW5h\nZ2VkIHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29s\nbGVjdGlvbiBnZXRNYW5hZ2VkU3RhdGVzKCkgewogICAgICAgIHJldHVybiBf\nY2FjaGUuY29weSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0ZSBtYW5hZ2Vycy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0VHJhbnNhY3Rpb25h\nbFN0YXRlcygpIHsKICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmpl\nY3RzKCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9M\nSVNUOwogICAgICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5KCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0aGVyZSBhcmUgYW55\nIHRyYW5zYWN0aW9uYWwgb2JqZWN0cyBpbiB0aGUgY3VycmVudAogICAgICog\ncGVyc2lzdGVuY2UgY29udGV4dC4gSWYgdGhlcmUgYXJlIGFueSBpbnN0YW5j\nZXMgd2l0aCB1bnRyYWNrZWQgc3RhdGUsCiAgICAgKiB0aGlzIG1ldGhvZCB3\naWxsIGNhdXNlIHRob3NlIGluc3RhbmNlcyB0byBiZSBzY2FubmVkLgogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzVHJhbnNhY3Rpb25hbE9iamVj\ndHMoKSB7CiAgICAgICAgX2NhY2hlLmRpcnR5Q2hlY2soKTsKICAgICAgICBy\nZXR1cm4gX3RyYW5zQ2FjaGUgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJz\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXREaXJ0eVN0\nYXRlcygpIHsKICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3Rz\nKCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNU\nOwoKICAgICAgICByZXR1cm4gX3RyYW5zQ2FjaGUuY29weURpcnR5KCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBzdGF0\nZSBtYW5hZ2VycyB3aGljaCB3aWxsIGJlY29tZQogICAgICogdHJhbnNhY3Rp\nb25hbCB1cG9uIHRoZSBuZXh0IHRyYW5zYWN0aW9uLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbFN0\nYXRlcygpIHsKICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAg\ncmV0dXJuIG5ldyBBcnJheUxpc3QoX3BlbmRpbmcpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBjYWNoZWQgU3RhdGVNYW5hZ2VyIGZvciB0aGUg\naW5zdGFuY2UgdGhhdCBoYWQgdGhlIGdpdmVuIG9pZC4KICAgICAqIFRoaXMg\nbWV0aG9kIG11c3Qgbm90IGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBmb3Ig\nbmV3IGluc3RhbmNlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gaWQgdGhlIGlk\nIHByZXZpb3VzbHkgdXNlZCBieSB0aGUgaW5zdGFuY2UKICAgICAqIEBwYXJh\nbSBzbSB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGluc3RhbmNlOyBpZiB0\naGUgc3RhdGUKICAgICAqIG1hbmFnZXIgaXMgdHJhbnNpZW50LCB3ZSdsbCBz\ndG9wIG1hbmFnaW5nIHRoZSBpbnN0YW5jZTsKICAgICAqIGlmIGl0IGhhcyB1\ncGRhdGVkIGl0cyBvaWQsIHdlJ2xsIHJlLWNhY2hlIHVuZGVyIHRoZSBuZXcg\nb2lkCiAgICAgKiBAcGFyYW0gc3RhdHVzIG9uZSBvZiBvdXIgU1RBVFVTIGNv\nbnN0YW50cyBkZXNjcmliaW5nIHdoeSB3ZSdyZQogICAgICogc2V0dGluZyB0\naGUgc3RhdGUgbWFuYWdlcgogICAgICovCiAgICB2b2lkIHNldFN0YXRlTWFu\nYWdlcihPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20sIGludCBzdGF0\ndXMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICAgICAgICAgIGNhc2UgU1RB\nVFVTX0lOSVQ6CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLmFkZChzbSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFNUQVRVU19UUkFOU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgX2Nh\nY2hlLnJlbW92ZShpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfT0lEX0FTU0lHTjoKICAg\nICAgICAgICAgICAgICAgICBfY2FjaGUuYXNzaWduT2JqZWN0SWQoaWQsIHNt\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgU1RBVFVTX0NPTU1JVF9ORVc6CiAgICAgICAgICAgICAgICAgICAg\nX2NhY2hlLmNvbW1pdE5ldyhpZCwgc20pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTm90aWZ5IHRoZSBicm9rZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdl\nciBzaG91bGQKICAgICAqIGJlIGFkZGVkIHRvIHRoZSBzZXQgb2YgaW5zdGFu\nY2VzIGludm9sdmVkIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLgogICAg\nICovCiAgICB2b2lkIGFkZFRvVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgIC8vIHdlIG9ubHkgYWRkIGNsZWFuIGluc3RhbmNl\ncyBub3c7IGRpcnR5IGluc3RhbmNlcyBhcmUgYWRkZWQgaW4KICAgICAgICAv\nLyB0aGUgc2V0RGlydHkgY2FsbGJhY2sKICAgICAgICBpZiAoc20uaXNEaXJ0\neSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxP\nYmplY3RzKCkpCiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5ldyBU\ncmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOwogICAgICAgICAgICBf\ndHJhbnNDYWNoZS5hZGRDbGVhbihzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIHRoYXQg\ndGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSByZW1v\ndmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4gdGhl\nIGN1cnJlbnQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgcmVtb3Zl\nRnJvbVRyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF90cmFu\nc0NhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICAvLyBpbnRlbnRpb25h\nbCBkaXJlY3QgYWNjZXNzOyB3ZSBkb24ndCB3YW50IHRvIHJlY29tcHV0ZQog\nICAgICAgICAgICAgICAgLy8gZGlydGluZXNzIHdoaWxlIHJlbW92aW5nIGlu\nc3RhbmNlcyBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9kZXJl\nZkNhY2hlICE9IG51bGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAg\nICAgICAgICAgX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgZ2l2ZW4g\naW5zdGFuY2UgaGFzIGJlZW4gZGlydGllZC4gVGhpcwogICAgICogbm90aWZp\nY2F0aW9uIGlzIGdpdmVuIHdoZW4gYW4gb2JqZWN0IGZpcnN0IHRyYW5zaXRp\nb25zIHRvIGEgZGlydHkgc3RhdGUsCiAgICAgKiBhbmQgZXZlcnkgdGltZSB0\naGUgb2JqZWN0IGlzIG1vZGlmaWVkIGJ5IHRoZSB1c2VyIHRoZXJlYWZ0ZXIu\nCiAgICAgKi8KICAgIHZvaWQgc2V0RGlydHkoU3RhdGVNYW5hZ2VySW1wbCBz\nbSwgYm9vbGVhbiBmaXJzdERpcnR5KSB7CiAgICAgICAgaWYgKHNtLmlzUGVy\nc2lzdGVudCgpKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9S\nRVFVSVJFRDsKCiAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYg\nIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoX3Nh\ndmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUuYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaXJz\ndERpcnR5ICYmIHNtLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAgICAg\nIGxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8v\nIGNhY2hlIGRpcnR5IGluc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAoIWhh\nc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRp\ncnR5KTsKICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmFkZERpcnR5KHNt\nKTsKCiAgICAgICAgICAgICAgICAvLyBhbHNvIHJlY29yZCB0aGF0IHRoZSBj\nbGFzcyBpcyBkaXJ0eQogICAgICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3BlcnNpc3RlZENsc3MgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3Mg\nPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0\nZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNtLmlzRGVsZXRlZCgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MgPSBu\nZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF9kZWxldGVkQ2xz\ncy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoX3VwZGF0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF91cGRhdGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAg\nICAgICAgICAgX3VwZGF0ZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0YSgpLmdl\ndERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgLy8gaWYgdHJhY2tpbmcgY2hhbmdlcyBhbmQgdGhpcyBpbnN0\nYW5jZSB3YXNuJ3QgYWxyZWFkeSBkaXJ0eSwKICAgICAgICAgICAgICAgIC8v\nIGFkZCB0byBjaGFuZ2VkIHNldDsgd2UgdXNlIHRoaXMgZm9yIGRldGVjdGlu\nZyBpbnN0YW5jZXMgdGhhdAogICAgICAgICAgICAgICAgLy8gZW50ZXIgdGhl\nIHRyYW5zYWN0aW9uIGR1cmluZyBwcmUgc3RvcmUKICAgICAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAwKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKF90cmFuc0FkZGl0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMgPSBuZXcg\nSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF90cmFuc0FkZGl0aW9u\ncy5hZGQoc20pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhl\nIGJyb2tlciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAog\nICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBvZiBpbnN0YW5jZXMgdGhhdCB3\naWxsIGJlY29tZSB0cmFuc2FjdGlvbmFsCiAgICAgKiBvbiB0aGUgbmV4dCB0\ncmFuc2FjdGlvbgogICAgICovCiAgICB2b2lkIGFkZFRvUGVuZGluZ1RyYW5z\nYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9wZW5kaW5nID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfcGVuZGluZyA9IG5ldyBIYXNoU2V0KCk7\nCiAgICAgICAgICAgIF9wZW5kaW5nLmFkZChzbSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2Vy\nIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBi\nZSByZW1vdmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQg\naW4gdGhlIG5leHQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgcmVt\nb3ZlRnJvbVBlbmRpbmdUcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChfcGVuZGluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3BlbmRp\nbmcucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9\nIG51bGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAg\nX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgYSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdCB0\nbyB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlcidzIGNhY2hlLgogICAgICogT24g\nZmx1c2gsIHRoZXNlIG9iamVjdHMgd2lsbCBiZSBkZWxldGVkLgogICAgICov\nCiAgICB2b2lkIGFkZERlcmVmZXJlbmNlZERlcGVuZGVudChTdGF0ZU1hbmFn\nZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIGlmIHdlJ3JlIGluIHRoZSBtaWRkbGUgb2YgZmx1c2gg\nYW5kIGludHJvZHVjaW5nIG1vcmUgZGVyZWZzCiAgICAgICAgICAgIC8vIHZp\nYSBpbnN0YW5jZSBjYWxsYmFja3MsIGFkZCB0aGVtIHRvIHRoZSBzcGVjaWFs\nIGFkZGl0aW9ucyBzZXQKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0RFUkVGREVMRVRJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChf\nZGVyZWZBZGRpdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nZGVyZWZBZGRpdGlvbnMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAg\nICAgX2RlcmVmQWRkaXRpb25zLmFkZChzbSk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZSA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5hZGQoc20pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgdGhlIGdpdmVuIHByZXZpb3VzbHkgZGVyZWZlcmVuY2VkIGRl\ncGVuZGVudCBvYmplY3QgZnJvbSB0aGUKICAgICAqIGNhY2hlLiBJdCBpcyBu\nb3cgcmVmZXJlbmNlZC4KICAgICAqLwogICAgdm9pZCByZW1vdmVEZXJlZmVy\nZW5jZWREZXBlbmRlbnQoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIHJl\nbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKF9kZXJlZkFkZGl0aW9u\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmVtb3ZlZCA9IF9kZXJlZkFk\nZGl0aW9ucy5yZW1vdmUoc20pOwogICAgICAgICAgICBpZiAoIXJlbW92ZWQg\nJiYgKF9kZXJlZkNhY2hlID09IG51bGwgfHwgIV9kZXJlZkNhY2hlLnJlbW92\nZShzbSkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWRlcmVmZWQiLAogICAgICAgICAg\nICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2Jq\nZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKS4KICAgICAgICAgICAgICAg\nICAgICBzZXRGYXRhbCh0cnVlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgZGlydHlUeXBlKENsYXNzIGNscykgewogICAgICAgIGlmIChjbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKF91cGRhdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3VwZGF0\nZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3VwZGF0ZWRD\nbHNzLmFkZChjbHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbiBnZXRQZXJzaXN0ZWRUeXBlcygpIHsKICAgICAgICBpZiAo\nX3BlcnNpc3RlZENsc3MgPT0gbnVsbCB8fCBfcGVyc2lzdGVkQ2xzcy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9M\nSVNUOwogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVD\nb2xsZWN0aW9uKF9wZXJzaXN0ZWRDbHNzKTsKICAgIH0KCiAgICBwdWJsaWMg\nQ29sbGVjdGlvbiBnZXRVcGRhdGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF91\ncGRhdGVkQ2xzcyA9PSBudWxsIHx8IF91cGRhdGVkQ2xzcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwog\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0\naW9uKF91cGRhdGVkQ2xzcyk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rp\nb24gZ2V0RGVsZXRlZFR5cGVzKCkgewogICAgICAgIGlmIChfZGVsZXRlZENs\nc3MgPT0gbnVsbCB8fCBfZGVsZXRlZENsc3MuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAgICBy\nZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfZGVs\nZXRlZENsc3MpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBDbG9z\naW5nCiAgICAvLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFuIGlzQ2xv\nc2VkKCkgewogICAgICAgIHJldHVybiBfY2xvc2VkOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzQ2xvc2VJbnZva2VkKCkgewogICAgICAgIHJldHVy\nbiBfY2xvc2VkIHx8IChfZmxhZ3MgJiBGTEFHX0NMT1NFX0lOVk9LRUQpICE9\nIDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBjbG9zaW5nIGluIGFuIGFj\ndGl2ZSBsb2NhbCB0cmFucwogICAgICAgICAgICBpZiAoIV9tYW5hZ2VkICYm\nIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImFj\ndGl2ZSIpKTsKCiAgICAgICAgICAgIC8vIG9ubHkgY2xvc2UgaWYgbm90IGFj\ndGl2ZTsgaWYgYWN0aXZlIG1hbmFnZWQgdHJhbnMgd2FpdAogICAgICAgICAg\nICAvLyBmb3IgY29tcGxldGlvbgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19DTE9TRV9JTlZPS0VEOwoKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIGZyZWUoKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGcmVlIHRoZSByZXNv\ndXJjZXMgdXNlZCBieSB0aGlzIHBlcnNpc3RlbmNlIG1hbmFnZXIuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGZyZWUoKSB7CiAgICAgICAgUnVudGlt\nZUV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgIGlmICgoX2F1dG9EZXRh\nY2ggJiBERVRBQ0hfQ0xPU0UpICE9IDApIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKF9jYWxsKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIF9zeW5jID0gbnVsbDsKICAgICAgICBfdXNlck9iamVjdHMg\nPSBudWxsOwogICAgICAgIF9jYWNoZS5jbGVhcigpOwogICAgICAgIF90cmFu\nc0NhY2hlID0gbnVsbDsKICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7\nCiAgICAgICAgX3VwZGF0ZWRDbHNzID0gbnVsbDsKICAgICAgICBfZGVsZXRl\nZENsc3MgPSBudWxsOwogICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsKICAg\nICAgICBfcGVuZGluZyA9IG51bGw7CiAgICAgICAgX2xvYWRlciA9IG51bGw7\nCiAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgICAgICBf\nbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CgogICAgICAgIE9wZW5KUEFTYXZl\ncG9pbnQgc2F2ZTsKICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMgIT0gbnVs\nbCAmJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHNh\ndmUgPQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZl\ncG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAg\nICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAg\nX3NhdmVwb2ludHMgPSBudWxsOwogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9\nIG51bGw7CgogICAgICAgIGlmIChfcXVlcmllcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3F1ZXJpZXMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgKChRdWVyeSkgaXRyLm5leHQoKSkuY2xvc2VS\nZXNvdXJjZXMoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBfcXVlcmllcyA9IG51bGw7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoX2V4dGVudHMgIT0gbnVsbCkgewogICAgICAgICAgICBFeHRl\nbnQgZTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZXh0ZW50\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgZSA9IChFeHRlbnQpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGUuY2xvc2VBbGwoKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfZXh0\nZW50cyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB0cnkgeyByZWxlYXNl\nQ29ubmVjdGlvbigpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nfQoKICAgICAgICBfbG0uY2xvc2UoKTsKICAgICAgICBfc3RvcmUuY2xvc2Uo\nKTsKICAgICAgICBfZmxhZ3MgPSAwOwogICAgICAgIF9jbG9zZWQgPSB0cnVl\nOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgIF9jbG9zZWRFeGNlcHRpb24gPSBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKCk7CgogICAgICAgIGlmIChlcnIgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgZXJyOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIFN5bmNocm9uaXphdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9\nIG51bGwpCiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB1bmxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9IG51\nbGwpCiAgICAgICAgICAgIF9sb2NrLnVubG9jaygpOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBtYW5hZ2VtZW50CiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBPYmplY3QgbmV3\nSW5zdGFuY2UoQ2xhc3MgY2xzKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwoK\nICAgICAgICBpZiAoY2xzLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNs\ncywgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIGNscyA9IG1ldGEuZ2V0\nSW50ZXJmYWNlSW1wbCgpOwogICAgICAgIH0gZWxzZSBpZiAoTW9kaWZpZXIu\naXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICgibmV3LWFic3RyYWN0IiwgY2xzKS5nZXRN\nZXNzYWdlKCkpOwoKICAgICAgICAvLyAxLjUgZG9lc24ndCBpbml0aWFsaXpl\nIGNsYXNzZXMgd2l0aG91dCBhIHRydWUgQ2xhc3MuZm9yTmFtZQogICAgICAg\nIGlmICghUENSZWdpc3RyeS5pc1JlZ2lzdGVyZWQoY2xzKSkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZShjbHMu\nZ2V0TmFtZSgpLCB0cnVlLCAKICAgICAgICAgICAgICAgICAgICAoQ2xhc3NM\nb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRl\nckFjdGlvbihjbHMpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoY2xzLCBudWxsLCBmYWxzZSk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3RJZChPYmplY3Qgb2Jq\nKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVs\ncGVyLmlzTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpCiAg\nICAgICAgICAgICAgICAucGNGZXRjaE9iamVjdElkKCk7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRMb2NrTGV2ZWwo\nT2JqZWN0IG8pIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYg\nKG8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMuTE9D\nS19OT05FOwoKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gZ2V0\nU3RhdGVNYW5hZ2VyKG8pOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gTG9ja0xldmVscy5MT0NLX05PTkU7CiAgICAgICAg\ncmV0dXJuIGdldExvY2tNYW5hZ2VyKCkuZ2V0TG9ja0xldmVsKHNtKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFZlcnNpb24oT2JqZWN0IG9iaikg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBl\nci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBs\nSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0dl\ndFZlcnNpb24oKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0RpcnR5KE9iamVjdCBvYmopIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2Vh\nYmxlKG9iaikpIHsKICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25m\nKTsKICAgICAgICAgICAgcmV0dXJuIHBjLnBjSXNEaXJ0eSgpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNUcmFuc2FjdGlvbmFsKE9iamVjdCBvYmopIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2Vh\nYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1Bl\ncnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkKICAgICAgICAgICAgICAg\nIC5wY0lzVHJhbnNhY3Rpb25hbCgpOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlcnNpc3RlbnQoT2JqZWN0\nIG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1w\nbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJu\nIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYp\nKS5wY0lzUGVyc2lzdGVudCgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc05ldyhPYmplY3Qgb2JqKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlz\nTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNOZXco\nKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNEZWxldGVkKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9i\naikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNJc0RlbGV0ZWQoKTsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNE\nZXRhY2hlZChPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYgKCEoSW1wbEhlbHBl\nci5pc01hbmFnZWFibGUob2JqKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsKICAgICAgICBC\nb29sZWFuIGRldGFjaGVkID0gcGMucGNJc0RldGFjaGVkKCk7CiAgICAgICAg\naWYgKGRldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBkZXRh\nY2hlZC5ib29sZWFuVmFsdWUoKTsKCiAgICAgICAgLy8gbGFzdCByZXNvcnQ6\nIGluc3RhbmNlIGlzIGRldGFjaGVkIGlmIGl0IGhhcyBhIHN0b3JlIHJlY29y\nZAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhKEltcGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKHBjKS5nZXRDbGFz\ncygpLAogICAgICAgICAgICAgICAgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAg\nT2JqZWN0IG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywgbWV0YSk7\nCiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgcmV0dXJuIGZpbmQob2lkLCBudWxsLCBFWENMVURF\nX0FMTCwgbnVsbCwgMCkgIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBnZXRTdGF0ZU1hbmFnZXIoT2JqZWN0IG9iaikg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIGlu\nc3RhbmNlLCBvciBudWxsLgogICAgICoKICAgICAqIEBwYXJhbSBhc3NlcnRU\naGlzQ29udGV4dCBpZiB0cnVlLCB0aG93IGFuIGV4Y2VwdGlvbiBpZiB0aGUg\nZ2l2ZW4KICAgICAqIG9iamVjdCBpcyBtYW5hZ2VkIGJ5IGFub3RoZXIgYnJv\na2VyCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGdl\ndFN0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9iaiwKICAgICAgICBib29sZWFu\nIGFzc2VydFRoaXNDb250ZXh0KSB7CiAgICAgICAgaWYgKEltcGxIZWxwZXIu\naXNNYW5hZ2VhYmxlKG9iaikpIHsKICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShv\nYmosIF9jb25mKTsKICAgICAgICAgICAgaWYgKHBjLnBjR2V0R2VuZXJpY0Nv\nbnRleHQoKSA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIChTdGF0\nZU1hbmFnZXJJbXBsKSBwYy5wY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAg\nICAgICBpZiAoYXNzZXJ0VGhpc0NvbnRleHQgJiYgcGMucGNHZXRHZW5lcmlj\nQ29udGV4dCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1hbmFnZWQiLAogICAgICAg\nICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZh\naWxlZE9iamVjdChvYmopOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3RhdGUgbWFu\nYWdlciBmb3IgdGhlIGdpdmVuIG9pZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nYWxsb3dOZXcgaWYgdHJ1ZSwgb2JqZWN0cyBtYWRlIHBlcnNpc3RlbnQgaW4g\ndGhlIGN1cnJlbnQKICAgICAqIHRyYW5zYWN0aW9uIHdpbGwgYmUgaW5jbHVk\nZWQgaW4gdGhlIHNlYXJjaDsgaWYKICAgICAqIG11bHRpcGxlIG5ldyBvYmpl\nY3RzIG1hdGNoIHRoZSBnaXZlbiBvaWQsIGl0IGlzCiAgICAgKiB1bmRlZmlu\nZWQgd2hpY2ggd2lsbCBiZSByZXR1cm5lZAogICAgICovCiAgICBwcm90ZWN0\nZWQgU3RhdGVNYW5hZ2VySW1wbCBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChP\nYmplY3Qgb2lkLAogICAgICAgIGJvb2xlYW4gYWxsb3dOZXcpIHsKICAgICAg\nICByZXR1cm4gX2NhY2hlLmdldEJ5SWQob2lkLCBhbGxvd05ldyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGdpdmVuIGluc3RhbmNlIGFz\nIGEge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZX0uCiAgICAgKiBJZiB0aGUg\naW5zdGFuY2UgaXMgbm90IG1hbmFnZWFibGUgdGhyb3cgdGhlIHByb3BlciBl\neGNlcHRpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNh\ncGFibGUgYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKE9iamVjdCBvYmopIHsK\nICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmop\nKQogICAgICAgICAgICByZXR1cm4gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNl\nQ2FwYWJsZShvYmosIF9jb25mKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIGRp\nZmZlcmVudCBpbnN0YW5jZXMgb2YgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBp\nbnRlcmZhY2UKICAgICAgICAvLyBhbmQgdGhyb3cgYSBiZXR0ZXIgZXJyb3Ig\ndGhhdCBtZW50aW9ucyB0aGUgY2xhc3MgbG9hZGVycwogICAgICAgIENsYXNz\nW10gaW50ZnMgPSBvYmouZ2V0Q2xhc3MoKS5nZXRJbnRlcmZhY2VzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGludGZzICE9IG51bGwgJiYgaSA8IGlu\ndGZzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpbnRmc1tpXS5n\nZXROYW1lKCkuZXF1YWxzKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5nZXRO\nYW1lKCkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgicGMtbG9hZGVyLWRpZmZlcmVudCIsCiAgICAgICAg\nICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopLAogICAgICAg\nICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzKSksCiAgICAg\nICAgICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oaW50ZnNbaV0pKSkpCiAg\nICAgICAgICAgICAgICAgICAgLnNldEZhaWxlZE9iamVjdChvYmopOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3QgZW5oYW5jZWQK\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicGMt\nY2FzdCIsCiAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkp\nLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQoKICAgIC8vLy8vLy8vLwog\nICAgLy8gVXRpbHMKICAgIC8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBUaHJv\ndyBhbiBleGNlcHRpb24gaWYgdGhlIGNvbnRleHQgaXMgY2xvc2VkLiAgVGhl\nIGV4YWN0IG1lc3NhZ2UgYW5kCiAgICAgKiBjb250ZW50IG9mIHRoZSBleGNl\ncHRpb24gdmFyaWVzIHdoZXRoZXIgVFJBQ0UgaXMgZW5hYmxlZCBvciBub3Qu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzc2VydE9wZW4oKSB7CiAgICAg\nICAgaWYgKF9jbG9zZWQpIHsKICAgICAgICAgICAgaWYgKF9jbG9zZWRFeGNl\ncHRpb24gPT0gbnVsbCkgIC8vIFRSQUNFIG5vdCBlbmFibGVkCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJjbG9zZWQtbm90cmFjZSIpKQogICAgICAgICAgICAgICAgICAgICAg\nICAuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoImNsb3NlZCIpLAogICAgICAgICAgICAgICAgICAgICAgICBfY2xvc2Vk\nRXhjZXB0aW9uKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKSB7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rpb25FeGNlcHRpb24oX2xvYy5n\nZXQoIm5vdC1hY3RpdmUiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJv\ndyBleGNlcHRpb24gaWYgYSB0cmFuc2FjdGlvbi1yZWxhdGVkIG9wZXJhdGlv\nbiBpcyBhdHRlbXB0ZWQgYW5kCiAgICAgKiBubyB0cmFuc2FjdGlvbiBpcyBh\nY3RpdmUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRUcmFuc2Fj\ndGlvbk9wZXJhdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nQUNUSVZFKSA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkg\newogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAgJiYg\nIV9ub250cmFuc1JlYWQpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlk\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vbi10cmFucy1yZWFkIikpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydFdyaXRlT3BlcmF0aW9uKCkg\newogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAgJiYg\nKCFfbm9udHJhbnNXcml0ZQogICAgICAgICAgICB8fCAoX2F1dG9EZXRhY2gg\nJiBERVRBQ0hfTk9OVFhSRUFEKSAhPSAwKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE5vVHJhbnNhY3Rpb25FeGNlcHRpb24oX2xvYy5nZXQoIndyaXRlLW9w\nZXJhdGlvbiIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBv\nYmplY3Qgbm90IGZvdW5kIGV4Y2VwdGlvbiBjb250YWluaW5nIG5lc3RlZCBl\neGNlcHRpb25zCiAgICAgKiBmb3IgYWxsIG9mIHRoZSBnaXZlbiBmYWlsZWQg\nb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0Tm90\nRm91bmRFeGNlcHRpb24gbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24KICAg\nICAgICAoQ29sbGVjdGlvbiBmYWlsZWQpIHsKICAgICAgICBUaHJvd2FibGVb\nXSB0ID0gbmV3IFRocm93YWJsZVtmYWlsZWQuc2l6ZSgpXTsKICAgICAgICBp\nbnQgaWR4ID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZhaWxl\nZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykKICAgICAgICAg\nICAgdFtpZHhdID0gbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGl0ci5u\nZXh0KCkpOwogICAgICAgIHJldHVybiBuZXcgT2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb24oZmFpbGVkLCB0KTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRmluZENhbGxiYWNrcyBpbXBsZW1l\nbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NBcmd1bWVudChPYmplY3Qgb2lk\nKSB7CiAgICAgICAgcmV0dXJuIG9pZDsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IHByb2Nlc3NSZXR1cm4oT2JqZWN0IG9pZCwgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSkgewogICAgICAgIHJldHVybiAoc20gPT0gbnVsbCkgPyBudWxs\nIDogc20uZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDYWNoZSBvZiBtYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIE1hbmFnZWRDYWNoZSB7CgogICAgICAgIHBy\naXZhdGUgZmluYWwgTWFwIF9tYWluOyAvLyBvaWQgLT4gc20KICAgICAgICBw\ncml2YXRlIE1hcCBfY29uZmxpY3RzID0gbnVsbDsgLy8gY29uZmxpY3Qgb2lk\nIC0+IG5ldyBzbQogICAgICAgIHByaXZhdGUgTWFwIF9uZXdzID0gbnVsbDsg\nLy8gdG1wIGlkIC0+IG5ldyBzbQogICAgICAgIHByaXZhdGUgQ29sbGVjdGlv\nbiBfZW1iZWRzID0gbnVsbDsgLy8gZW1iZWRkZWQvbm9uLXBlcnNpc3RlbnQg\nc21zCiAgICAgICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF91bnRyYWNrZWQgPSBu\ndWxsOyAvLyBoYXJkIHJlZnMgdG8gdW50cmFja2VkIHNtcwoKICAgICAgICAv\nKioKICAgICAgICAgKiBDb25zdHJ1Y3Rvcjsgc3VwcGx5IHByaW1hcnkgY2Fj\naGUgbWFwLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBNYW5hZ2VkQ2Fj\naGUoTWFwIGNhY2hlKSB7CiAgICAgICAgICAgIF9tYWluID0gY2FjaGU7CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGlu\nc3RhbmNlIGZvciB0aGUgZ2l2ZW4gb2lkLCBvcHRpb25hbGx5IGFsbG93aW5n\nCiAgICAgICAgICogbmV3IGluc3RhbmNlcy4KICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgU3RhdGVNYW5hZ2VySW1wbCBnZXRCeUlkKE9iamVjdCBvaWQs\nIGJvb2xlYW4gYWxsb3dOZXcpIHsKICAgICAgICAgICAgaWYgKG9pZCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAg\nICAvLyBjaGVjayBtYWluIGNhY2hlIGZvciBvaWQKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbWFpbi5n\nZXQob2lkKTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTI7CiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAv\nLyBpZiBpdCdzIGEgbmV3IGluc3RhbmNlLCB3ZSBrbm93IGl0J3MgdGhlIG9u\nbHkgbWF0Y2gsIGJlY2F1c2UKICAgICAgICAgICAgICAgIC8vIG90aGVyIHBl\ncnMgaW5zdGFuY2VzIG92ZXJyaWRlIG5ldyBpbnN0YW5jZXMgaW4gX2NhY2hl\nCiAgICAgICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gKGFsbG93TmV3KSA/IHNtIDogbnVsbDsKICAgICAg\nICAgICAgICAgIGlmICghYWxsb3dOZXcgfHwgIXNtLmlzRGVsZXRlZCgpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBzbTsKCiAgICAgICAgICAgICAg\nICAvLyBzbSBpcyBkZWxldGVkOyBjaGVjayBjb25mbGljdCBjYWNoZQogICAg\nICAgICAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHNtMiA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfY29uZmxp\nY3RzLmdldChvaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChzbTIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtMjsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nYXQgdGhpcyBwb2ludCBzbSBpcyBudWxsIG9yIGRlbGV0ZWQ7IGNoZWNrIHRo\nZSBuZXcgY2FjaGUgZm9yCiAgICAgICAgICAgIC8vIGFueSBtYXRjaGVzLiB0\naGlzIGFsbG93cyB1cyB0byBtYXRjaCBhcHAgaWQgb2JqZWN0cyB0byBuZXcK\nICAgICAgICAgICAgLy8gaW5zdGFuY2VzIHdpdGhvdXQgcGVybWFuYW50IG9p\nZHMKICAgICAgICAgICAgaWYgKGFsbG93TmV3ICYmIF9uZXdzICE9IG51bGwg\nJiYgIV9uZXdzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgc20yID0g\nKFN0YXRlTWFuYWdlckltcGwpIF9uZXdzLmdldChvaWQpOwogICAgICAgICAg\nICAgICAgaWYgKHNtMiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBzbTI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNt\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsbCB0aGlz\nIG1ldGhvZCB3aGVuIGEgbmV3IHN0YXRlIG1hbmFnZXIgaW5pdGlhbGl6ZXMg\naXRzZWxmLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZChT\ndGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmICghc20uaXNJ\nbnRlcmNlcHRpbmcoKSkgewogICAgICAgICAgICAgICAgaWYgKF91bnRyYWNr\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfdW50cmFja2VkID0g\nbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIF91bnRyYWNrZWQuYWRk\nKHNtKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFzbS5pc1Bl\ncnNpc3RlbnQoKSB8fCBzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChfZW1iZWRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nX2VtYmVkcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hT\nZXQuV0VBSyk7CiAgICAgICAgICAgICAgICBfZW1iZWRzLmFkZChzbSk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGluaXRpYWxpemluZyBuZXcgaW5zdGFuY2U7IHB1dCBpbiBuZXcg\nY2FjaGUgYmVjYXVzZSB3b24ndCBoYXZlCiAgICAgICAgICAgIC8vIHBlcm1h\nbmVudCBvaWQgeWV0CiAgICAgICAgICAgIGlmIChzbS5pc05ldygpKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX25ld3MgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBfbmV3cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAg\nICBfbmV3cy5wdXQoc20uZ2V0SWQoKSwgc20pOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFs\naXppbmcgcGVyc2lzdGVudCBpbnN0YW5jZTsgcHV0IGluIG1haW4gY2FjaGUK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvcmlnID0gKFN0YXRlTWFu\nYWdlckltcGwpIF9tYWluLnB1dAogICAgICAgICAgICAgICAgKHNtLmdldE9i\namVjdElkKCksIHNtKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCks\nIG9yaWcpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImR1cC1sb2FkIiwKICAgICAgICAgICAgICAgICAgICBz\nbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRpb25zLnRvU3RyaW5nCiAgICAgICAg\nICAgICAgICAgICAgKG9yaWcuZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAg\nICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzdGF0ZSBtYW5h\nZ2VyIGZyb20gdGhlIGNhY2hlIHdoZW4gaXQgdHJhbnNpdGlvbnMKICAgICAg\nICAgKiB0byB0cmFuc2llbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIHZvaWQgcmVtb3ZlKE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgICAgICAvLyBpZiBpdCBoYXMgYSBwZXJtYW5lbnQgb2lkLCBy\nZW1vdmUgZnJvbSBtYWluIC8gY29uZmxpY3QgY2FjaGUsCiAgICAgICAgICAg\nIC8vIGVsc2UgcmVtb3ZlIGZyb20gZW1iZWRkZWQvbm9udHJhbnMgY2FjaGUs\nIGFuZCBpZiBub3QgdGhlcmUKICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20g\nbmV3IGNhY2hlCiAgICAgICAgICAgIE9iamVjdCBvcmlnOwogICAgICAgICAg\nICBpZiAoc20uZ2V0T2JqZWN0SWQoKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBvcmlnID0gX21haW4ucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAg\nIGlmIChvcmlnICE9IHNtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9y\naWcgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX21haW4ucHV0\nKGlkLCBvcmlnKTsgLy8gcHV0IGJhY2sKICAgICAgICAgICAgICAgICAgICBp\nZiAoX2NvbmZsaWN0cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIG9yaWcgPSBfY29uZmxpY3RzLnJlbW92ZShpZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwgJiYgb3JpZyAhPSBzbSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb25mbGljdHMucHV0KGlk\nLCBvcmlnKTsgLy8gcHV0IGJhY2sKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoKF9lbWJl\nZHMgPT0gbnVsbCB8fCAhX2VtYmVkcy5yZW1vdmUoc20pKQogICAgICAgICAg\nICAgICAgJiYgX25ld3MgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgb3Jp\nZyA9IF9uZXdzLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICBpZiAob3Jp\nZyAhPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAgICAgICAgICAgICAg\nX25ld3MucHV0KGlkLCBvcmlnKTsgLy8gcHV0IGJhY2sKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKF91bnRyYWNrZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF91bnRyYWNrZWQucmVtb3ZlKHNtKTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIEFuIGVtYmVkZGVkIG9yIG5vbnBlcnNp\nc3RlbnQgbWFuYWdlZCBpbnN0YW5jZSBoYXMgYmVlbiBwZXJzaXN0ZWQuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgcGVyc2lzdChTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChfZW1iZWRzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfZW1iZWRzLnJlbW92ZShzbSk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBBIG5ldyBpbnN0YW5jZSBo\nYXMganVzdCBiZWVuIGFzc2lnbmVkIGEgcGVybWFuZW50IG9pZC4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhc3NpZ25PYmplY3RJZChPYmpl\nY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgLy8g\naWYgYXNzaWduaW5nIG9pZCwgcmVtb3ZlIGZyb20gbmV3IGNhY2hlIGFuZCBw\ndXQgaW4gcHJpbWFyeTsgbWF5CiAgICAgICAgICAgIC8vIG5vdCBiZSBpbiBu\nZXcgY2FjaGUgaWYgYW5vdGhlciBuZXcgaW5zdGFuY2UgaGFkIHNhbWUgaWQK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvcmlnID0gKFN0YXRlTWFu\nYWdlckltcGwpIF9uZXdzLnJlbW92ZShpZCk7CiAgICAgICAgICAgIGlmIChv\ncmlnICE9IG51bGwgJiYgb3JpZyAhPSBzbSkKICAgICAgICAgICAgICAgIF9u\nZXdzLnB1dChpZCwgb3JpZyk7IC8vIHB1dCBiYWNrCgogICAgICAgICAgICAv\nLyBwdXQgaW4gbWFpbiBjYWNoZSwgYnV0IG1ha2Ugc3VyZSB3ZSBkb24ndCBy\nZXBsYWNlIGFub3RoZXIKICAgICAgICAgICAgLy8gaW5zdGFuY2Ugd2l0aCB0\naGUgc2FtZSBvaWQKICAgICAgICAgICAgb3JpZyA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwgc20pOwogICAgICAg\nICAgICBpZiAob3JpZyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfbWFp\nbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwgb3JpZyk7CiAgICAgICAgICAgICAg\nICBpZiAoIW9yaWcuaXNEZWxldGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImR1cC1vaWQtYXNz\naWduIiwKICAgICAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQo\nKSwgRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAgICAgICAgICAgICAgICAg\nICAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSk7CgogICAgICAgICAgICAgICAgLy8gc2FtZSBvaWQgYXMgZGVsZXRl\nZCBpbnN0YW5jZTsgcHV0IGluIGNvbmZsaWN0IGNhY2hlCiAgICAgICAgICAg\nICAgICBpZiAoX2NvbmZsaWN0cyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIF9jb25mbGljdHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAg\nICAgX2NvbmZsaWN0cy5wdXQoc20uZ2V0T2JqZWN0SWQoKSwgc20pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBB\nIG5ldyBpbnN0YW5jZSBoYXMgY29tbWl0dGVkOyByZWNhY2hlIHVuZGVyIHBl\ncm1hbmVudCBvaWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQg\nY29tbWl0TmV3KE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSkgewog\nICAgICAgICAgICAvLyBpZiB0aGUgaWQgZGlkbid0IGNoYW5nZSwgdGhlIGlu\nc3RhbmNlIHdhcyBhbHJlYWR5IGFzc2lnbmVkIGFuCiAgICAgICAgICAgIC8v\nIGlkLCBidXQgaXQgY291bGQgaGF2ZSBiZWVuIGluIGNvbmZsaWN0IGNhY2hl\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3JpZzsKICAgICAgICAg\nICAgaWYgKHNtLmdldE9iamVjdElkKCkgPT0gaWQpIHsKICAgICAgICAgICAg\nICAgIG9yaWcgPSAoX2NvbmZsaWN0cyA9PSBudWxsKSA/IG51bGwKICAgICAg\nICAgICAgICAgICAgICA6IChTdGF0ZU1hbmFnZXJJbXBsKSBfY29uZmxpY3Rz\nLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICBpZiAob3JpZyA9PSBzbSkg\newogICAgICAgICAgICAgICAgICAgIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1w\nbCkgX21haW4ucHV0KGlkLCBzbSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG9yaWcgIT0gbnVsbCAmJiAhb3JpZy5pc0RlbGV0ZWQoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwg\nb3JpZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRp\nb25zLnRvU3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuc2V0RmFpbGVkT2JqZWN0CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gb2lkIGNoYW5nZWQsIHNvIGl0IG11\nc3QgcHJldmlvdXNseSBoYXZlIGJlZW4gYSBuZXcgaW5zdGFuY2UKICAgICAg\nICAgICAgLy8gd2l0aG91dCBhbiBhc3NpZ25lZCBvaWQuICByZW1vdmUgaXQg\nZnJvbSB0aGUgbmV3IGNhY2hlOyBvayBpZgogICAgICAgICAgICAvLyB3ZSBl\nbmQgdXAgcmVtb3ZpbmcgYW5vdGhlciBpbnN0YW5jZSB3aXRoIHNhbWUgaWQK\nICAgICAgICAgICAgaWYgKF9uZXdzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfbmV3cy5yZW1vdmUoaWQpOwoKICAgICAgICAgICAgLy8gYW5kIHB1dCBp\nbnRvIG1haW4gY2FjaGUgbm93IHRoYXQgaWQgaXMgYXNzc2lnbmVkCiAgICAg\nICAgICAgIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX21haW4ucHV0KHNt\nLmdldE9iamVjdElkKCksIHNtKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0g\nbnVsbCAmJiBvcmlnICE9IHNtICYmICFvcmlnLmlzRGVsZXRlZCgpKSB7CiAg\nICAgICAgICAgICAgICAvLyBwdXQgYmFjayBvcmlnIGFuZCB0aHJvdyBlcnJv\ncgogICAgICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCks\nIG9yaWcpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImR1cC1vaWQtYXNzaWduIiwKICAgICAgICAgICAgICAg\nICAgICBzbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRpb25zLnRvU3RyaW5nCiAg\nICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkp\nLnNldEZhaWxlZE9iamVjdAogICAgICAgICAgICAgICAgICAgIChzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiBh\nIGNvcHkgb2YgYWxsIGNhY2hlZCBwZXJzaXN0ZW50IG9iamVjdHMuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gY29weSgpIHsKICAg\nICAgICAgICAgLy8gcHJveGllcyBub3QgaW5jbHVkZWQgaGVyZSBiZWNhdXNl\nIHRoZSBzdGF0ZSBtYW5hZ2VyIGlzIGFsd2F5cwogICAgICAgICAgICAvLyBw\ncmVzZW50IGluIG90aGVyIGNhY2hlcyB0b28KCiAgICAgICAgICAgIGludCBz\naXplID0gX21haW4uc2l6ZSgpOwogICAgICAgICAgICBpZiAoX2NvbmZsaWN0\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfY29uZmxpY3Rz\nLnNpemUoKTsKICAgICAgICAgICAgaWYgKF9uZXdzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBzaXplICs9IF9uZXdzLnNpemUoKTsKICAgICAgICAgICAg\naWYgKF9lbWJlZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0g\nX2VtYmVkcy5zaXplKCk7CiAgICAgICAgICAgIGlmIChzaXplID09IDApCiAg\nICAgICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsK\nCiAgICAgICAgICAgIExpc3QgY29weSA9IG5ldyBBcnJheUxpc3Qoc2l6ZSk7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX21haW4udmFsdWVz\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAg\nICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgaWYgKF9jb25m\nbGljdHMgIT0gbnVsbCAmJiAhX2NvbmZsaWN0cy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9jb25mbGljdHMudmFs\ndWVzKCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgICAgICBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4\ndCgpKTsKICAgICAgICAgICAgaWYgKF9uZXdzICE9IG51bGwgJiYgIV9uZXdz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gX25ld3MudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAg\nICAgICAgICAgIGlmIChfZW1iZWRzICE9IG51bGwgJiYgIV9lbWJlZHMuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBf\nZW1iZWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBy\nZXR1cm4gY29weTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIENsZWFyIHRoZSBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBjbGVhcigpIHsKICAgICAgICAgICAgX21haW4uY2xlYXIoKTsKICAg\nICAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9jb25mbGljdHMuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKF9uZXdz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfbmV3cy5jbGVhcigpOwogICAg\nICAgICAgICBpZiAoX2VtYmVkcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2VtYmVkcy5jbGVhcigpOwogICAgICAgICAgICBpZiAoX3VudHJhY2tlZCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX3VudHJhY2tlZC5jbGVhcigpOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXIgbmV3IGlu\nc3RhbmNlcyB3aXRob3V0IHBlcm1hbmVudCBvaWRzLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyTmV3KCkgewogICAgICAgICAgICBp\nZiAoX25ld3MgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9uZXdzLmNsZWFy\nKCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgZGlydHlDaGVj\naygpIHsKICAgICAgICAgICAgaWYgKF91bnRyYWNrZWQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRlciA9IF91bnRyYWNrZWQuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0\nKCk7ICkKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRl\nci5uZXh0KCkpLmRpcnR5Q2hlY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUcmFuc2FjdGlvbmFsIGNhY2hlIHRoYXQgaG9sZHMgc29m\ndCByZWZzIHRvIGNsZWFuIGluc3RhbmNlcy4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgY2xhc3MgVHJhbnNhY3Rpb25hbENhY2hlCiAgICAgICAgaW1w\nbGVtZW50cyBTZXQgewoKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4g\nX29yZGVyRGlydHk7CiAgICAgICAgcHJpdmF0ZSBTZXQgX2RpcnR5ID0gbnVs\nbDsKICAgICAgICBwcml2YXRlIFNldCBfY2xlYW4gPSBudWxsOwoKICAgICAg\nICBwdWJsaWMgVHJhbnNhY3Rpb25hbENhY2hlKGJvb2xlYW4gb3JkZXJEaXJ0\neSkgewogICAgICAgICAgICBfb3JkZXJEaXJ0eSA9IG9yZGVyRGlydHk7CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBjb3B5\nIG9mIGFsbCB0cmFuc2FjdGlvbmFsIHN0YXRlIG1hbmFnZXJzLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHkoKSB7CiAgICAg\nICAgICAgIGlmIChpc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAgICAgICAgIC8vIHNpemUg\nbWF5IG5vdCBiZSBlbnRpcmVseSBhY2N1cmF0ZSBkdWUgdG8gcmVmcyBleHBp\ncmluZywgc28KICAgICAgICAgICAgLy8gbWFudWFsbHkgY29weSBlYWNoIG9i\namVjdDsgZG9lc24ndCBtYXR0ZXIgdGhpcyB3YXkgaWYgc2l6ZSB0b28KICAg\nICAgICAgICAgLy8gYmlnIGJ5IHNvbWUKICAgICAgICAgICAgTGlzdCBjb3B5\nID0gbmV3IEFycmF5TGlzdChzaXplKCkpOwogICAgICAgICAgICBpZiAoX2Rp\ncnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IF9kaXJ0eS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAg\nICAgaWYgKF9jbGVhbiAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfY2xlYW4uaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7\nCiAgICAgICAgICAgIHJldHVybiBjb3B5OwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgZGlydHkgc3Rh\ndGUgbWFuYWdlcnMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENvbGxl\nY3Rpb24gY29weURpcnR5KCkgewogICAgICAgICAgICBpZiAoX2RpcnR5ID09\nIG51bGwgfHwgX2RpcnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgICAgICAgICByZXR1\ncm4gbmV3IEFycmF5TGlzdChfZGlydHkpOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogVHJhbnNmZXIgdGhlIGdpdmVuIGluc3RhbmNlIGZy\nb20gdGhlIGRpcnR5IGNhY2hlIHRvIHRoZSBjbGVhbiBjYWNoZS4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBmbHVzaGVkKFN0YXRlTWFuYWdl\nckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSAmJiBf\nZGlydHkgIT0gbnVsbCAmJiBfZGlydHkucmVtb3ZlKHNtKSkKICAgICAgICAg\nICAgICAgIGFkZENsZWFuSW50ZXJuYWwoc20pOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogQWRkIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0\naGUgY2xlYW4gY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZv\naWQgYWRkQ2xlYW4oU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAg\nICBpZiAoYWRkQ2xlYW5JbnRlcm5hbChzbSkgJiYgX2RpcnR5ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfZGlydHkucmVtb3ZlKHNtKTsKICAgICAgICB9\nCgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBhZGRDbGVhbkludGVybmFsKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKF9jbGVhbiA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2NsZWFuID0gbmV3IFJlZmVyZW5j\nZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5TT0ZUKTsKICAgICAgICAgICAg\ncmV0dXJuIF9jbGVhbi5hZGQoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogQWRkIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgZGly\ndHkgY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRk\nRGlydHkoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAo\nX2RpcnR5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfb3JkZXJE\naXJ0eSkKICAgICAgICAgICAgICAgICAgICBfZGlydHkgPSBNYXBCYWNrZWRT\nZXQuZGVjb3JhdGUobmV3IExpbmtlZE1hcCgpKTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBfZGlydHkgPSBuZXcgSGFzaFNl\ndCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfZGlydHkuYWRk\nKHNtKSkKICAgICAgICAgICAgICAgIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20p\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlIHRo\nZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHRoZSBjYWNoZS4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgICAgICByZXR1cm4gcmVtb3ZlQ2xlYW5JbnRlcm5h\nbChzbSkKICAgICAgICAgICAgICAgIHx8IChfZGlydHkgIT0gbnVsbCAmJiBf\nZGlydHkucmVtb3ZlKHNtKSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRl\nIGJvb2xlYW4gcmVtb3ZlQ2xlYW5JbnRlcm5hbChTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgICAgIHJldHVybiBfY2xlYW4gIT0gbnVsbCAmJiBf\nY2xlYW4ucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJ\ndGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICAgICAgSXRlcmF0b3JDaGFp\nbiBjaGFpbiA9IG5ldyBJdGVyYXRvckNoYWluKCk7CiAgICAgICAgICAgIGlm\nIChfZGlydHkgIT0gbnVsbCAmJiAhX2RpcnR5LmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9yKF9kaXJ0eS5pdGVyYXRvcigp\nKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsICYmICFfY2xlYW4u\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgY2hhaW4uYWRkSXRlcmF0b3Io\nX2NsZWFuLml0ZXJhdG9yKCkpOwogICAgICAgICAgICByZXR1cm4gY2hhaW47\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhP\nYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHJldHVybiAoX2RpcnR5ICE9IG51\nbGwgJiYgX2RpcnR5LmNvbnRhaW5zKG9iaikpCiAgICAgICAgICAgICAgICB8\nfCAoX2NsZWFuICE9IG51bGwgJiYgX2NsZWFuLmNvbnRhaW5zKG9iaikpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNBbGwo\nQ29sbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gY29sbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgIGlmICghY29udGFpbnMoaXRyLm5leHQoKSkpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkg\newogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZGlydHkuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2NsZWFuLmNsZWFyKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAg\nICAgICAgICByZXR1cm4gKF9kaXJ0eSA9PSBudWxsIHx8IF9kaXJ0eS5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICAmJiAoX2NsZWFuID09IG51bGwgfHwg\nX2NsZWFuLmlzRW1wdHkoKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\naW50IHNpemUoKSB7CiAgICAgICAgICAgIGludCBzaXplID0gMDsKICAgICAg\nICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAgICAgICAgc2l6\nZSArPSBfZGlydHkuc2l6ZSgpOwogICAgICAgICAgICBpZiAoX2NsZWFuICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzaXplICs9IF9jbGVhbi5zaXplKCk7\nCiAgICAgICAgICAgIHJldHVybiBzaXplOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gYWRkKE9iamVjdCBvYmopIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwoQ29sbGVj\ndGlvbiBjb2xsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvYmopIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVBbGwoQ29s\nbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gcmV0YWluQWxsKENvbGxlY3Rpb24gYykgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0Fy\ncmF5KCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVy\nYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBP\nYmplY3RbXSB0b0FycmF5KE9iamVjdFtdIGFycikgewogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVbmlxdWUgaWQgZm9yIHN0\nYXRlIG1hbmFnZXJzIG9mIG5ldyBkYXRhc3RvcmUgaW5zdGFuY2VzIHdpdGhv\ndXQgYXNzaWduZWQKICAgICAqIG9iamVjdCBpZHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIFN0YXRlTWFuYWdlcklkCiAgICAgICAgaW1w\nbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTVFJJTkdfUFJFRklYID0gIm9wZW5qcGFzbToiOwoK\nICAgICAgICBwcml2YXRlIHN0YXRpYyBsb25nIF9nZW5lcmF0b3IgPSAwOwoK\nICAgICAgICBwcml2YXRlIGZpbmFsIGludCBfYmhhc2g7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBsb25nIF9pZDsKCiAgICAgICAgcHVibGljIHN0YXRpYyBT\ndGF0ZU1hbmFnZXJJZCBuZXdJbnN0YW5jZShCcm9rZXIgYikgewogICAgICAg\nICAgICByZXR1cm4gbmV3IFN0YXRlTWFuYWdlcklkKFN5c3RlbS5pZGVudGl0\neUhhc2hDb2RlKGIpLCBfZ2VuZXJhdG9yKyspOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBTdGF0ZU1hbmFnZXJJZChpbnQgYmhhc2gsIGxvbmcgaWQp\nIHsKICAgICAgICAgICAgX2JoYXNoID0gYmhhc2g7CiAgICAgICAgICAgIF9p\nZCA9IGlkOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0YXRlTWFuYWdl\ncklkKFN0cmluZyBzdHIpIHsKICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0\ncmluZyhTVFJJTkdfUFJFRklYLmxlbmd0aCgpKTsKICAgICAgICAgICAgaW50\nIGlkeCA9IHN0ci5pbmRleE9mKCc6Jyk7CiAgICAgICAgICAgIF9iaGFzaCA9\nIEludGVnZXIucGFyc2VJbnQoc3RyLnN1YnN0cmluZygwLCBpZHgpKTsKICAg\nICAgICAgICAgX2lkID0gTG9uZy5wYXJzZUxvbmcoc3RyLnN1YnN0cmluZyhp\nZHggKyAxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9\nPSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgU3RhdGVNYW5hZ2VySWQpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBTdGF0\nZU1hbmFnZXJJZCBzaWQgPSAoU3RhdGVNYW5hZ2VySWQpIG90aGVyOwogICAg\nICAgICAgICByZXR1cm4gX2JoYXNoID09IHNpZC5fYmhhc2ggJiYgX2lkID09\nIHNpZC5faWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hD\nb2RlKCkgewogICAgICAgICAgICByZXR1cm4gKGludCkgKF9pZCBeIChfaWQg\nPj4+IDMyKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRv\nU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gU1RSSU5HX1BSRUZJWCAr\nIF9iaGFzaCArICI6IiArIF9pZDsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb2xsZWN0aW9uIHR5cGUgdGhhdCBob2xkcyBzdGF0ZSBtYW5h\nZ2VycyBidXQgd2hvc2UgaW50ZXJmYWNlIGRlYWxzCiAgICAgKiB3aXRoIHRo\nZSBjb3JyZXNwb25kaW5nIG1hbmFnZWQgb2JqZWN0cy4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24K\nICAgICAgICBleHRlbmRzIEFic3RyYWN0Q29sbGVjdGlvbiB7CgogICAgICAg\nIHByaXZhdGUgZmluYWwgQ29sbGVjdGlvbiBfc3RhdGVzOwoKICAgICAgICBw\ndWJsaWMgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oQ29sbGVjdGlvbiBzdGF0\nZXMpIHsKICAgICAgICAgICAgX3N0YXRlcyA9IHN0YXRlczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFN0YXRlTWFuYWdlcnMo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfc3RhdGVzOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICByZXR1cm4g\nX3N0YXRlcy5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSXRl\ncmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSXRl\ncmF0b3IoKSB7CiAgICAgICAgICAgICAgICBwcml2YXRlIGZpbmFsIEl0ZXJh\ndG9yIF9pdHIgPSBfc3RhdGVzLml0ZXJhdG9yKCk7CgogICAgICAgICAgICAg\nICAgcHVibGljIGJvb2xlYW4gaGFzTmV4dCgpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gX2l0ci5oYXNOZXh0KCk7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgcHVibGljIE9iamVjdCBuZXh0KCkgewogICAg\nICAgICAgICAgICAgICAgIHJldHVybiAoKE9wZW5KUEFTdGF0ZU1hbmFnZXIp\nIF9pdHIubmV4dCgpKS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWFu\nYWdlZEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

