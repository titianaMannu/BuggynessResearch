{"sha":"4e264dd678a241be58f912e257a079c005c59316","node_id":"MDQ6QmxvYjIwNjM2NDo0ZTI2NGRkNjc4YTI0MWJlNThmOTEyZTI1N2EwNzljMDA1YzU5MzE2","size":106522,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4e264dd678a241be58f912e257a079c005c59316","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQg\namF2YS51dGlsLio7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5NYW5hZ2VkSW5zdGFuY2VQcm92\naWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkR5bmFt\naWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUge0Bs\naW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXJ9IGludGVyZmFjZSBmb3IgdXNlCiAq\nIHdpdGggdGhpcyBydW50aW1lLiBFYWNoIHN0YXRlIG1hbmFnZXIgbWFuYWdl\ncyB0aGUgc3RhdGUgb2YgYSBzaW5nbGUKICogcGVyc2lzdGVuY2UgY2FwYWJs\nZSBpbnN0YW5jZS4gVGhlIHN0YXRlIG1hbmFnZXIgaXMgYWxzbyByZXNwb25z\naWJsZSBmb3IKICogYWxsIGNvbW11bmljYXRpb25zIGFib3V0IHRoZSBpbnN0\nYW5jZSB0byB0aGUge0BsaW5rIFN0b3JlTWFuYWdlcn0uCiAqICBUaGUgc3Rh\ndGUgbWFuYWdlciB1c2VzIHRoZSBTdGF0ZSBwYXR0ZXJuIGluIGJvdGggaXRz\nIGludGVyYWN0aW9uIHdpdGgKICogdGhlIGdvdmVybmVkIGluc3RhbmNlIGFu\nZCBpdHMgaW50ZXJhY3Rpb24gd2l0aCB0aGUgYnJva2VyLgogKiBJbiBpdHMg\naW50ZXJhY3Rpb25zIHdpdGggdGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgaW5z\ndGFuY2UsIGl0IHVzZXMgdGhlCiAqIHtAbGluayBGaWVsZE1hbmFnZXJ9IGlu\ndGVyZmFjZS4gU2ltaWxhcmx5LCB3aGVuIGludGVyYWN0aW5nIHdpdGggdGhl\nCiAqIGJyb2tlciwgaXQgdXNlcyB0aGUge0BsaW5rIFBDU3RhdGV9IHNpbmds\nZXRvbiB0aGF0IHJlcHJlc2VudHMKICogdGhlIGN1cnJlbnQgbGlmZWN5Y2xl\nIHN0YXRlIG9mIHRoZSBpbnN0YW5jZS4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICovCnB1YmxpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJbXBsCiAgICBpbXBs\nZW1lbnRzIE9wZW5KUEFTdGF0ZU1hbmFnZXIgewoKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IExPQURfRkdTID0gMDsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IExPQURfQUxMID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IExPQURfU0VSSUFMSVpFID0gMjsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19TQVZFID0gMiA8PCAwOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEZMQUdfREVSRUYgPSAyIDw8IDE7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19MT0FERUQgPSAyIDw8IDI7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19SRUFEX0xPQ0tFRCA9\nIDIgPDwgMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1dS\nSVRFX0xPQ0tFRCA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX09JRF9BU1NJR05FRCA9IDIgPDwgNTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0xPQURJTkcgPSAyIDw8IDY7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19QUkVfREVMRVRJTkcgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVT\nSEVEID0gMiA8PCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFX0ZMVVNIRUQgPSAyIDw8IDk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRkxBR19GTFVTSEVEX0RJUlRZID0gMiA8PCAxMDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0lNUExfQ0FDSEUgPSAyIDw8\nIDExOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfSU5WRVJT\nRVMgPSAyIDw8IDEyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfTk9fVU5QUk9YWSA9IDIgPDwgMTM7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRkxBR19WRVJTSU9OX0NIRUNLID0gMiA8PCAxNDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1ZFUlNJT05fVVBEQVRFID0g\nMiA8PCAxNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RF\nVEFDSElORyA9IDIgPDwgMTY7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAg\nIChTdGF0ZU1hbmFnZXJJbXBsLmNsYXNzKTsKCiAgICAvLyBpbmZvcm1hdGlv\nbiBhYm91dCB0aGUgaW5zdGFuY2UKICAgIHByaXZhdGUgUGVyc2lzdGVuY2VD\nYXBhYmxlIF9wYyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEg\nX21ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51\nbGw7CiAgICBwcml2YXRlIEJpdFNldCBfZGlydHkgPSBudWxsOwogICAgcHJp\ndmF0ZSBCaXRTZXQgX2ZsdXNoID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9m\nbGFncyA9IDA7CgogICAgLy8gaWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRl\nbnRpdHk7IG9pZCBpcyB0aGUgcGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAog\nICAgLy8gbWF5IGJlIG51bGwgZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQt\ndHJhbnNhY3Rpb25hbCBvYmplY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2Vz\nIHRoYXQgaGF2ZW4ndCBiZWVuIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJl\nYXNzaWduZWQgdG8gb2lkCiAgICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3Np\nZ25tZW50IChvciBmbHVzaCBjb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMK\nICAgIC8vIGR1cmluZyBmbHVzaCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9\nIG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAv\nLyB0aGUgbWFuYWdpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5\nY2xlIHN0YXRlCiAgICBwcml2YXRlIGZpbmFsIEJyb2tlckltcGwgX2Jyb2tl\ncjsKICAgIHByaXZhdGUgUENTdGF0ZSBfc3RhdGUgPSBQQ1N0YXRlLlRSQU5T\nSUVOVDsKCiAgICAvLyB0aGUgY3VycmVudCBhbmQgbGFzdCBsb2FkZWQgdmVy\nc2lvbiBpbmRpY2F0b3JzLCBhbmQgdGhlIGxvY2sgb2JqZWN0CiAgICBwcml2\nYXRlIE9iamVjdCBfdmVyc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVj\ndCBfbG9hZFZlcnNpb24gPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xv\nY2sgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX3JlYWRMb2NrTGV2ZWwgPSAt\nMTsKICAgIHByaXZhdGUgaW50IF93cml0ZUxvY2tMZXZlbCA9IC0xOwoKICAg\nIC8vIGRlbGVnYXRlcyB3aGVuIHByb3ZpZGluZy9yZXBsYWNpbmcgaW5zdGFu\nY2UgZGF0YQogICAgcHJpdmF0ZSBTaW5nbGVGaWVsZE1hbmFnZXIgX3Npbmds\nZSA9IG51bGw7CiAgICBwcml2YXRlIFNhdmVGaWVsZE1hbmFnZXIgX3NhdmVk\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNYW5hZ2VyIF9mbSA9IG51bGw7\nCgogICAgLy8gaW1wbGRhdGE7IGZpZWxkIGltcGxkYXRhIGFuZCBpbnRlcm1l\nZGlhdGUgZGF0YSBzaGFyZSB0aGUgc2FtZSBhcnJheQogICAgcHJpdmF0ZSBP\nYmplY3QgX2ltcGwgPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZmll\nbGRJbXBsID0gbnVsbDsKCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUg\nb3duZXIgb2YgdGhpcyBpbnN0YW5jZSwgaWYgaXQgaXMgZW1iZWRkZWQKICAg\nIHByaXZhdGUgU3RhdGVNYW5hZ2VySW1wbCBfb3duZXIgPSBudWxsOwogICAg\ncHJpdmF0ZSBWYWx1ZU1ldGFEYXRhIF9vd25lck1ldGEgPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBpZCwgdHlwZSBtZXRh\nZGF0YSwgYW5kIG93bmluZyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbChPYmplY3QgaWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwgCiAgICAgICAgQnJva2VySW1wbCBicm9rZXIp\nIHsKICAgICAgICBfaWQgPSBpZDsKICAgICAgICBfbWV0YSA9IG1ldGE7CiAg\nICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBfc2luZ2xlID0gbmV3\nIFNpbmdsZUZpZWxkTWFuYWdlcih0aGlzLCBicm9rZXIpOwoKICAgICAgICBp\nZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9VTktOT1dOKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBfbWV0YSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBvd25pbmcgc3RhdGUgYW5kIGZpZWxk\nIGlmIHRoaXMgaXMgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHZvaWQgc2V0T3duZXIoU3RhdGVNYW5hZ2VySW1wbCBvd25lciwgVmFsdWVN\nZXRhRGF0YSBvd25lck1ldGEpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsK\nICAgICAgICBfb3duZXJNZXRhID0gb3duZXJNZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGlzIHN0YXRlIG1hbmFnZXIgaXMgaW4gdGhl\nIG1pZGRsZSBvZiBhIGxvYWQuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNMb2Fk\naW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19MT0FESU5H\nKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3Rh\ndGUgbWFuYWdlciBpcyBpbiB0aGUgbWlkZGxlIG9mIGEgbG9hZCBpbml0aWF0\nZWQKICAgICAqIGJ5IG91dHNpZGUgY29kZTsgZm9yIGFueSBpbnRlcm5hbCBt\nZXRob2RzIHRoYXQgY2F1c2UgbG9hZGluZywgdGhlCiAgICAgKiBsb2FkaW5n\nIGZsYWcgaXMgc2V0IGF1dG9tYXRpY2FsbHkuCiAgICAgKi8KICAgIHZvaWQg\nc2V0TG9hZGluZyhib29sZWFuIGxvYWRpbmcpIHsKICAgICAgICBpZiAobG9h\nZGluZykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BRElORzsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19MT0FESU5H\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9yIHJlc2V0IHRoZSBsaWZl\nY3ljbGUgc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5zdGFuY2UuIElmIHRoZQog\nICAgICogdHJhbnNhY3Rpb25hbCBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UgY2hh\nbmdlcywgaXQgd2lsbCBiZSBlbmxpc3RlZC8KICAgICAqIGRlbGlzdGVkIGZy\nb20gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMgbmVjZXNzYXJ5LiBUaGUg\nZ2l2ZW4KICAgICAqIHN0YXRlIHdpbGwgYmUgaW5pdGlhbGl6ZWQgYWZ0ZXIg\nYmVpbmcgc2V0LiBJZiB0aGUgZ2l2ZW4gc3RhdGUKICAgICAqIGlzIHRoZSBz\nYW1lIGFzIHRoZSBjdXJyZW50IHN0YXRlLCB0aGlzIG1ldGhvZCB3aWxsIGhh\ndmUgbm8gZWZmZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0UENT\ndGF0ZShQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgaWYgKF9zdGF0ZSA9PSBz\ndGF0ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbm90aWZ5IHRoZSBzdG9yZSBt\nYW5hZ2VyIHRoYXQgd2UncmUgY2hhbmdpbmcgc3RhdGVzOyBjYW4gdmV0bwog\nICAgICAgICAgICBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmJlZm9yZVN0\nYXRlQ2hhbmdlKHRoaXMsIF9zdGF0ZSwgc3RhdGUpOwoKICAgICAgICAgICAg\nLy8gcmVwbGFjZSBzdGF0ZQogICAgICAgICAgICBib29sZWFuIHdhc0RlbGV0\nZWQgPSBfc3RhdGUuaXNEZWxldGVkKCk7CiAgICAgICAgICAgIGJvb2xlYW4g\nd2FzRGlydHkgPSBfc3RhdGUuaXNEaXJ0eSgpOwogICAgICAgICAgICBib29s\nZWFuIHdhc1BlbmRpbmcgPSBfc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICBfc3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgICAg\nIC8vIGVubGlzdC9kZWxpc3QgZnJvbSB0cmFuc2FjdGlvbgogICAgICAgICAg\nICBpZiAoX3N0YXRlLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAgICAg\nICAgICBfYnJva2VyLmFkZFRvVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAg\nICAgICAgICBpZiAoX3N0YXRlLmlzRGVsZXRlZCgpICE9IHdhc0RlbGV0ZWQp\nCiAgICAgICAgICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCAh\nd2FzRGlydHkgfHwgaXNGbHVzaGVkKCkpOwogICAgICAgICAgICAgICAgZWxz\nZSBpZiAoX3N0YXRlLmlzRGlydHkoKSAmJiAhd2FzRGlydHkpCiAgICAgICAg\nICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCB0cnVlKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmICghd2FzUGVuZGluZyAmJiBfc3RhdGUuaXNQ\nZW5kaW5nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tl\nci5hZGRUb1BlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAg\nZWxzZSBpZiAod2FzUGVuZGluZyAmJiAhX3N0YXRlLmlzUGVuZGluZ1RyYW5z\nYWN0aW9uYWwoKSkKICAgICAgICAgICAgICAgIF9icm9rZXIucmVtb3ZlRnJv\nbVBlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1vdmVGcm9tVHJhbnNhY3Rpb24o\ndGhpcyk7CgogICAgICAgICAgICAvLyBpbml0aWFsaXplCiAgICAgICAgICAg\nIF9zdGF0ZS5pbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgICBpZiAoX3N0\nYXRlLmlzRGVsZXRlZCgpICYmICF3YXNEZWxldGVkKQogICAgICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RF\nTEVURSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoQ2xh\nc3MgY2xzLCBQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgLy8gY2hlY2sgdG8g\nc2VlIGlmIG91ciBjdXJyZW50IG9iamVjdCBpZCBpbnN0YW5jZSBpcyB0aGUK\nICAgICAgICAvLyBjb3JyZWN0IGlkIHR5cGUgZm9yIHRoZSBzcGVjaWZpZWQg\nY2xhc3M7IHRoaXMgaXMgZm9yIGNhc2VzCiAgICAgICAgLy8gd2hlbiB3ZSBo\nYXZlIGFuIGFwcGxpY2F0aW9uIGlkIGhpZXJhcmNoeSBhbmQgd2UgaGFkIHNl\ndCB0aGUKICAgICAgICAvLyBtZXRhZGF0YSB0byBhIHN1cGVyY2xhc3MgaWQg\nLS0gdGhlIHN1YmNsYXNzJyBpZCBtYXkgYmUgYQogICAgICAgIC8vIGRpZmZl\ncmVudCBjbGFzcywgc28gd2UgbmVlZCB0byByZXNldCBpdAogICAgICAgIGlm\nIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkgIT0gY2xzKSB7CiAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgc3ViID0gX21ldGEuZ2V0UmVwb3NpdG9yeSgp\nLmdldE1ldGFEYXRhCiAgICAgICAgICAgICAgICAoY2xzLCBfYnJva2VyLmdl\ndENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgICAgICBpZiAoX29pZCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAg\nICAgICAgICAgICAgICAgX29pZCA9IF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2Vy\nKCkuY29weURhdGFTdG9yZUlkKF9vaWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgIHN1Yik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChfbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBB\ncHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIHN1Yik7CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChzdWIuZ2V0T2JqZWN0SWRUeXBlKCkgIT0gX21ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Rb\nXSBwa0ZpZWxkcyA9IEFwcGxpY2F0aW9uSWRzLnRvUEtWYWx1ZXMoX29pZCwg\nX21ldGEpOwogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXMocGtGaWVsZHMsIHN1Yik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX21ldGEgPSBzdWI7\nCiAgICAgICAgfQogICAgICAgIGlmIChjbHMuaXNJbnRlcmZhY2UoKSkKICAg\nICAgICAgICAgY2xzID0gX21ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwoKICAg\nICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdCA9IFBDUmVnaXN0cnkubmV3\nSW5zdGFuY2UoY2xzLCB0aGlzLCBfb2lkLCB0cnVlKTsKICAgICAgICBpZiAo\naW5zdCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRoZSBpbnN0YW5jZSB3\nYXMgbnVsbDogY2hlY2sgdG8gc2VlIGlmIHRoZSBpbnN0YW5jZSBpcwogICAg\nICAgICAgICAvLyBhYnN0cmFjdCAoYXMgY2FuIHNvbWV0aW1lcyBiZSB0aGUg\nY2FzZSB3aGVuIHRoZQogICAgICAgICAgICAvLyBjbGFzcyBkaXNjcmltaW5h\ndG9yIHN0cmF0ZWd5IGlzIG5vdCBjb25maWd1cmVkIGNvcnJlY3RseSkKICAg\nICAgICAgICAgaWYgKE1vZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJpbnN0YW50aWF0ZS1hYnN0cmFjdCIsCiAgICAgICAg\nICAgICAgICAgICAgY2xzLmdldE5hbWUoKSwgX29pZCkpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9Cgog\nICAgICAgIGluaXRpYWxpemUoaW5zdCwgc3RhdGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW5pdGlhbGl6ZSB3aXRoIHRoZSBnaXZlbiBpbnN0YW5jZSBh\nbmQgc3RhdGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGluaXRpYWxp\nemUoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBQQ1N0YXRlIHN0YXRlKSB7CiAg\nICAgICAgaWYgKHBjID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbml0LW51bGwtcGMiLCBfbWV0YSkp\nOwogICAgICAgIGlmIChwYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwg\nJiYgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKSAhPSB0aGlzKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaW5pdC1zbS1w\nYyIsCiAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHBjKSkp\nLnNldEZhaWxlZE9iamVjdChwYyk7CiAgICAgICAgcGMucGNSZXBsYWNlU3Rh\ndGVNYW5hZ2VyKHRoaXMpOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIF9sb2FkZWQgPSBuZXcg\nQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICBfZmx1c2ggPSBuZXcgQml0\nU2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICBfZGlydHkgPSBuZXcgQml0U2V0\nKGZtZHMubGVuZ3RoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIG1hcmsgcHJpbWFy\neSBrZXkgYW5kIG5vbi1wZXJzaXN0ZW50IGZpZWxkcyBhcyBsb2FkZWQKICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uaXNQcmltYXJ5S2V5KCkKICAgICAgICAg\nICAgICAgIHx8IGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IGZtZHNbaV0u\nTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBfbG9hZGVkLnNl\ndChpKTsKCiAgICAgICAgICAgIC8vIHJlY29yZCB3aGV0aGVyIHRoZXJlIGFy\nZSBhbnkgbWFuYWdlZCBpbnZlcnNlIGZpZWxkcwogICAgICAgICAgICBpZiAo\nX2Jyb2tlci5nZXRJbnZlcnNlTWFuYWdlcigpICE9IG51bGwKICAgICAgICAg\nICAgICAgICYmIGZtZHNbaV0uZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0\naCA+IDApCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19JTlZFUlNF\nUzsKICAgICAgICB9CgogICAgICAgIHBjLnBjU2V0RGV0YWNoZWRTdGF0ZShu\ndWxsKTsKICAgICAgICBfcGMgPSBwYzsKCiAgICAgICAgaWYgKF9vaWQgaW5z\ndGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQQUlkKSBf\nb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSk7CgogICAgICAgIC8vIGluaXRpYWxpemUgb3VyIHN0YXRlIGFu\nZCBhZGQgb3Vyc2VsdmVzIHRvIHRoZSBicm9rZXIncyBjYWNoZQogICAgICAg\nIHNldFBDU3RhdGUoc3RhdGUpOwogICAgICAgIF9icm9rZXIuc2V0U3RhdGVN\nYW5hZ2VyKF9pZCwgdGhpcywgQnJva2VySW1wbC5TVEFUVVNfSU5JVCk7CiAg\nICAgICAgaWYgKHN0YXRlID09IFBDU3RhdGUuUE5FVykKICAgICAgICAgICAg\nZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJ\nU1QpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgbm9uLXRyYWNraW5nIFBD\nLCBhZGQgYSBoYXJkIHJlZiB0byB0aGUgYXBwcm9wcmlhdGUgZGF0YQogICAg\nICAgIC8vIHNldHMgYW5kIGdpdmUgaXQgYW4gb3Bwb3J0dW5pdHkgdG8gbWFr\nZSBhIHN0YXRlIHNuYXBzaG90LgogICAgICAgIGlmICghaXNJbnRlcmNlcHRp\nbmcoKSkKICAgICAgICAgICAgc2F2ZUZpZWxkcyh0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90IGRhdGEgYWNjZXNzIGluIHRo\naXMgaW5zdGFuY2UgaXMgaW50ZXJjZXB0ZWQuIFRoaXMgZGlmZmVycwogICAg\nICogZnJvbSB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNpc0ludGVyY2VwdGluZygp\nfSBpbiB0aGF0IGl0IGNoZWNrcyBmb3IKICAgICAqIHByb3BlcnR5IGFjY2Vz\ncyArIHN1YmNsYXNzaW5nIGluIGFkZGl0aW9uIHRvIHRoZSByZWRlZmluaXRp\nb24gLwogICAgICogZW5oYW5jZW1lbnQgY2hlY2tzLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAgICBpZiAo\nZ2V0TWV0YURhdGEoKS5pc0ludGVyY2VwdGluZygpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZ2V0TWV0YURhdGEoKS5nZXRBY2Nl\nc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQKICAgICAg\nICAgICAgJiYgX3BjIGluc3RhbmNlb2YgRHluYW1pY1BlcnNpc3RlbmNlQ2Fw\nYWJsZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgdGhlIGdpdmVu\nIGxpZmVjeWNsZSBldmVudCB0byBhbGwgbGlzdGVuZXJzLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2ZW50KGludCB0eXBl\nKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50\nKGdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICBfbWV0\nYSwgdHlwZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZChGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBsb2FkKGZldGNoLCBMT0FE\nX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgc3RhdGUgb2YgdGhpcyBpbnN0YW5jZSBiYXNlZCBvbiB0\naGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICogYW5kIGxvYWQg\nbW9kZS4gUmV0dXJuIHRydWUgaWYgYW55IGRhdGEgd2FzIGxvYWRlZCwgZmFs\nc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBs\nb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvYWRNb2RlLAog\nICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3Qgc2RhdGEsIGJvb2xlYW4g\nZm9yV3JpdGUpIHsKICAgICAgICBpZiAoIWZvcldyaXRlICYmICghaXNQZXJz\naXN0ZW50KCkgfHwgaXNOZXcoKSB8fCBpc0RlbGV0ZWQoKSkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gaWYgYW55IGZpZWxkcyBi\nZWluZyBsb2FkZWQsIGRvIHN0YXRlIHRyYW5zaXRpb25zIGZvciByZWFkCiAg\nICAgICAgQml0U2V0IGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0\nY2gsIGxvYWRNb2RlLCBleGNsdWRlKTsKICAgICAgICBib29sZWFuIGFjdGl2\nZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsKICAgICAgICBpZiAoIWZvcldyaXRl\nICYmIGZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICBiZWZvcmVSZWFkKC0x\nKTsKCiAgICAgICAgLy8gY2FsbCBsb2FkIGV2ZW4gaWYgbm8gZmllbGRzIGFy\nZSBiZWluZyBsb2FkZWQsIGJlY2F1c2UgaXQgdGFrZXMKICAgICAgICAvLyBj\nYXJlIG9mIGNoZWNraW5nIGlmIHRoZSBERkcgaXMgbG9hZGVkLCBtYWtpbmcg\nc3VyZSB2ZXJzaW9uIGluZm8KICAgICAgICAvLyBpcyBsb2FkZWQsIGV0Ywog\nICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2ZWwoYWN0\naXZlLCBmb3JXcml0ZSwgZmV0Y2gpOwogICAgICAgIGJvb2xlYW4gcmV0ID0g\nbG9hZEZpZWxkcyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIHNkYXRhLCBm\nb3JXcml0ZSk7CiAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCBmb3JXcml0\nZSwgbG9ja0xldmVsLCBmZXRjaCwgc2RhdGEpOwogICAgICAgIHJldHVybiBy\nZXQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKSB7CiAgICAgICAgaWYgKF9wYyBpbnN0YW5jZW9mIE1hbmFnZWRJbnN0\nYW5jZVByb3ZpZGVyKQogICAgICAgICAgICByZXR1cm4gKChNYW5hZ2VkSW5z\ndGFuY2VQcm92aWRlcikgX3BjKS5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAg\ncHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIF9wYzsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX21ldGE7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZ2V0T3duZXIoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0KCiAg\nICBwdWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRPd25lck1ldGFEYXRhKCkgewog\nICAgICAgIHJldHVybiBfb3duZXJNZXRhOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRW1iZWRkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lciAh\nPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZCgp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgPiAw\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZERpcnR5KCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZ\nKSA+IDA7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXRMb2FkZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9sb2FkZWQ7CiAgICB9CgogICAgcHVibGljIEJp\ndFNldCBnZXRGbHVzaGVkKCkgewogICAgICAgIHJldHVybiBfZmx1c2g7CiAg\nICB9CgogICAgcHVibGljIEJpdFNldCBnZXREaXJ0eSgpIHsKICAgICAgICBy\nZXR1cm4gX2RpcnR5OwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0VW5s\nb2FkZWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgLy8g\nY29sbGVjdCBmaWVsZHMgdG8gbG9hZCBmcm9tIGRhdGEgc3RvcmUgYmFzZWQg\nb24gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIEJpdFNldCBmaWVsZHMg\nPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7\nCiAgICAgICAgcmV0dXJuIChmaWVsZHMgPT0gbnVsbCkgPyBuZXcgQml0U2V0\nKDApIDogZmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwg\ndmVyc2lvbiBvZiB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlciNnZXRVbmxv\nYWRlZH0gdGhhdCBhdm9pZHMKICAgICAqIGNyZWF0aW5nIGFuIGVtcHR5IGJp\ndCBzZXQgYnkgcmV0dXJuaW5nIG51bGwgd2hlbiB0aGVyZSBhcmUgbm8gdW5s\nb2FkZWQKICAgICAqIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRT\nZXQgZ2V0VW5sb2FkZWRJbnRlcm5hbChGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGludCBtb2RlLAogICAgICAgIEJpdFNldCBleGNsdWRlKSB7CiAgICAg\nICAgaWYgKGV4Y2x1ZGUgPT0gU3RvcmVDb250ZXh0LkVYQ0xVREVfQUxMKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQml0U2V0IGZpZWxk\ncyA9IG51bGw7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIGxvYWQ7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChfbG9hZGVkLmdldChpKSB8fCAoZXhjbHVkZSAhPSBudWxs\nICYmIGV4Y2x1ZGUuZ2V0KGkpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIExPQURfU0VSSUFMSVpFOgogICAgICAgICAgICAgICAgICAgIGxv\nYWQgPSAhZm1kc1tpXS5pc1RyYW5zaWVudCgpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMT0FEX0ZHUzoKICAg\nICAgICAgICAgICAgICAgICBsb2FkID0gZmV0Y2ggPT0gbnVsbCB8fCBmZXRj\naC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAgICAgICAgICAg\nICAgICAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nIC8vIExPQURfQUxMCiAgICAgICAgICAgICAgICAgICAgbG9hZCA9IHRydWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2FkKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAg\nICAgICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9CgogICAgcHVibGlj\nIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIC8qKgogICAgICogTWFuYWdpbmcgYnJva2Vy\nLgogICAgICovCiAgICBCcm9rZXJJbXBsIGdldEJyb2tlcigpIHsKICAgICAg\nICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndElkKCkgewogICAgICAgIHJldHVybiBfaWQ7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRPYmplY3RJZCgpIHsKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20uZ2V0T3duZXIoKSAh\nPSBudWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBz\nbS5nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbS5fb2lkOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldE9iamVjdElkKE9iamVjdCBvaWQpIHsKICAg\nICAgICBfb2lkID0gb2lkOwogICAgICAgIGlmIChfcGMgIT0gbnVsbCAmJiBv\naWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQ\nQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3Np\nZ25PYmplY3RJZChib29sZWFuIGZsdXNoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJ\nZChmbHVzaCwgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFzayBzdG9yZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIgb2lkLCBvcHRpb25h\nbGx5IGZsdXNoaW5nIGFuZAogICAgICogb3B0aW9uYWxseSByZWNhY2hpbmcg\nb24gdGhlIG5ldyBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBh\nc3NpZ25PYmplY3RJZChib29sZWFuIGZsdXNoLCBib29sZWFuIHByZUZsdXNo\naW5nKSB7CiAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCB8fCBpc0VtYmVkZGVk\nKCkgfHwgIWlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYXNz\naWduT2JqZWN0SWQodGhpcywgcHJlRmx1c2hpbmcpKSB7CiAgICAgICAgICAg\nIGlmICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgICAgICBhc3NlcnRPYmpl\nY3RJZEFzc2lnbmVkKHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAoZmx1c2gp\nCiAgICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSB3ZXJlIGFzc2ln\nbmVkIGFuIG9pZCwgYW5kIHBlcmZvcm0gYWN0aW9ucyB0byBtYWtlIGl0CiAg\nICAgKiBwZXJtYW5lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHJlY2FjaGUg\nd2hldGhlciB0byByZWNhY2hlIG91cnNlbGYgb24gdGhlIG5ldyBvaWQKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE9iamVjdElkQXNzaWduZWQo\nYm9vbGVhbiByZWNhY2hlKSB7CiAgICAgICAgaWYgKCFpc05ldygpIHx8IGlz\nRGVsZXRlZCgpIHx8IGlzUHJvdmlzaW9uYWwoKSAKICAgICAgICAgICAgfHwg\nKF9mbGFncyAmIEZMQUdfT0lEX0FTU0lHTkVEKSAhPSAwKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAg\nICAgICAgICAgICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgICAg\nICAgICBfb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKF9wYywgX21ldGEp\nOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG9yaWcgPSBfaWQ7CiAgICAg\nICAgX2lkID0gX29pZDsKICAgICAgICBpZiAocmVjYWNoZSkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgX2Jyb2tlci5zZXRTdGF0ZU1h\nbmFnZXIob3JpZywgdGhpcywKICAgICAgICAgICAgICAgICAgICBCcm9rZXJJ\nbXBsLlNUQVRVU19PSURfQVNTSUdOKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgX2lkID0g\nb3JpZzsKICAgICAgICAgICAgICAgIF9vaWQgPSBudWxsOwogICAgICAgICAg\nICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfT0lEX0FTU0lHTkVEOwogICAgfQoKICAgIC8q\nKgogICAgICogQXNzaWduIHRoZSBwcm9wZXIgZ2VuZXJhdGVkIHZhbHVlIHRv\nIHRoZSBnaXZlbiBmaWVsZCBiYXNlZCBvbiBpdHMKICAgICAqIHZhbHVlLXN0\ncmF0ZWd5LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gYXNzaWduRmll\nbGQoaW50IGZpZWxkLCBib29sZWFuIHByZUZsdXNoaW5nKSB7CiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IHRoaXM7CiAgICAgICAgd2hpbGUg\nKHNtLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgc20gPSBzbS5nZXRPd25l\ncigpOwogICAgICAgIGlmICghc20uaXNOZXcoKSB8fCBzbS5pc0ZsdXNoZWQo\nKSB8fCBzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICAvLyBzcGVjaWFsLWNhc2Ugb2lkIGZpZWxkcywgd2hpY2gg\ncmVxdWlyZSB1cyB0byBsb29rIGluc2lkZSB0aGUgb2lkCiAgICAgICAgLy8g\nb2JqZWN0CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICAvLyB0cnkg\ndG8gc2hvcnRjdXQgaWYgcG9zc2libGUKICAgICAgICAgICAgaWYgKF9vaWQg\nIT0gbnVsbCB8fCBpc0VtYmVkZGVkKCkgfHwgIWlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAvLyBj\naGVjayBlbWJlZGRlZCBmaWVsZHMgb2Ygb2lkIGZvciB2YWx1ZSBzdHJhdGVn\neSArIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIHBrcyA9IGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBudWxs\nOwogICAgICAgICAgICBib29sZWFuIGFzc2lnbiA9IGZhbHNlOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgIWFzc2lnbiAmJiBpIDwgcGtzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldFZhbHVl\nU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChvaWRz\nbSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIG9pZHNtID0gbmV3IE9i\namVjdElkU3RhdGVNYW5hZ2VyKGZldGNoT2JqZWN0RmllbGQoZmllbGQpLAog\nICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBmbWQpOwogICAgICAgICAg\nICAgICAgYXNzaWduID0gb2lkc20uaXNEZWZhdWx0VmFsdWUoaSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFzc2lnbiAmJiBhc3NpZ25P\nYmplY3RJZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKICAgICAgICB9\nCgogICAgICAgIC8vIEp1c3QgcmV0dXJuIGlmIHRoZXJlJ3Mgbm8gdmFsdWUg\nZ2VuZXJhdGlvbiBzdHJhdGVneQogICAgICAgIGlmIChmbWQuZ2V0VmFsdWVT\ndHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgLy8gVGhyb3cgZXhj\nZXB0aW9uIGlmIGZpZWxkIGFscmVhZHkgaGFzIGEgdmFsdWUgYXNzaWduZWQu\nCiAgICAgICAgLy8gQEdlbmVyYXRlZFZhbHVlIG92ZXJyaWRlcyBQT0pPIGlu\naXRpYWwgdmFsdWVzIGFuZCBzZXR0ZXIgbWV0aG9kcwogICAgICAgIGlmICgh\naXNEZWZhdWx0VmFsdWUoZmllbGQpICYmICFmbWQuaXNWYWx1ZUdlbmVyYXRl\nZCgpKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgICAgICJleGlzdGluZy12\nYWx1ZS1vdmVycmlkZS1leGNlcCIsIGZtZC5nZXRGdWxsTmFtZShmYWxzZSkp\nKTsKCiAgICAgICAgLy8gZm9yIHByaW1hcnkga2V5IGZpZWxkcywgYXNzaWdu\nIHRoZSBvYmplY3QgaWQgYW5kIHJlY2FjaGUgc28gdGhhdAogICAgICAgIC8v\nIHRvIHRoZSB1c2VyLCBzbyBpdCBsb29rcyBsaWtlIHRoZSBvaWQgYWx3YXlz\nIG1hdGNoZXMgdGhlIHBrIGZpZWxkcwogICAgICAgIGlmIChmbWQuaXNQcmlt\nYXJ5S2V5KCkgJiYgIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGFzc2lnbk9iamVjdElkKCFwcmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwoK\nICAgICAgICAvLyBmb3Igb3RoZXIgZmllbGRzIGp1c3QgYXNzaWduIHRoZSBm\naWVsZCBvciBmbHVzaCBpZiBuZWVkZWQKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRTdG9yZU1hbmFnZXIoKS5hc3NpZ25GaWVsZCh0aGlzLCBmaWVsZCwgcHJl\nRmx1c2hpbmcpKSB7CiAgICAgICAgICAgIGZtZC5zZXRWYWx1ZUdlbmVyYXRl\nZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQog\nICAgICAgIGlmICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgIF9icm9rZXIu\nZmx1c2goKTsKICAgICAgICByZXR1cm4gIXByZUZsdXNoaW5nOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0TG9jaygpIHsKICAgICAgICByZXR1cm4g\nX2xvY2s7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TG9jayhPYmplY3Qg\nbG9jaykgewogICAgICAgIF9sb2NrID0gbG9jazsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF92ZXJz\naW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb24oT2JqZWN0\nIHZlcnNpb24pIHsKICAgICAgICBfbG9hZFZlcnNpb24gPSB2ZXJzaW9uOwog\nICAgICAgIGFzc2lnblZlcnNpb25GaWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAg\nICBPYmplY3QgZ2V0TG9hZFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2FkVmVyc2lvbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROZXh0VmVy\nc2lvbihPYmplY3QgdmVyc2lvbikgewogICAgICAgIGFzc2lnblZlcnNpb25G\naWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzaWdu\nVmVyc2lvbkZpZWxkKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAgICAgX3ZlcnNp\nb24gPSB2ZXJzaW9uOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmZpZWxkID0g\nX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHZmaWVsZCAh\nPSBudWxsKQogICAgICAgICAgICBzdG9yZSh2ZmllbGQuZ2V0SW5kZXgoKSwg\nSmF2YVR5cGVzLmNvbnZlcnQodmVyc2lvbiwKICAgICAgICAgICAgICAgIHZm\naWVsZC5nZXRUeXBlQ29kZSgpKSk7CiAgICB9CgogICAgcHVibGljIFBDU3Rh\ndGUgZ2V0UENTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlOwogICAg\nfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEltcGxEYXRh\nKCkgewogICAgICAgIHJldHVybiBfaW1wbDsKICAgIH0KCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIE9iamVjdCBzZXRJbXBsRGF0YShPYmplY3QgZGF0YSwg\nYm9vbGVhbiBjYWNoZWFibGUpIHsKICAgICAgICBPYmplY3Qgb2xkID0gX2lt\ncGw7CiAgICAgICAgX2ltcGwgPSBkYXRhOwogICAgICAgIGlmIChjYWNoZWFi\nbGUgJiYgZGF0YSAhPSBudWxsKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19JTVBMX0NBQ0hFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX0lNUExfQ0FDSEU7CiAgICAgICAgcmV0dXJuIG9sZDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19JTVBMX0NBQ0hFKSAh\nPSAwOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW1wbERhdGEoaW50\nIGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZp\nZWxkLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHNldEltcGxE\nYXRhKGludCBmaWVsZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICByZXR1cm4g\nc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRhdGEsIHRydWUpOwogICAgfQoK\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiBpc0ltcGxEYXRhQ2Fj\naGVhYmxlKGludCBmaWVsZCkgewogICAgICAgIGlmIChfZmllbGRJbXBsID09\nIG51bGwgfHwgIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIGlmIChfbWV0YS5nZXRGaWVsZChmaWVsZCku\ndXNlc0ltcGxEYXRhKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxkRGF0\nYUluZGV4KGZpZWxkKTsKICAgICAgICByZXR1cm4gaWR4ICE9IC0xICYmIF9m\naWVsZEltcGxbaWR4XSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0SW50ZXJtZWRpYXRlKGludCBmaWVsZCkgewogICAgICAgIHJldHVy\nbiBnZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEludGVybWVkaWF0ZShpbnQgZmllbGQsIE9iamVj\ndCBkYXRhKSB7CiAgICAgICAgc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRh\ndGEsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGF0YSBmcm9tIHRoZSBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxk\nIGRhdGEgYXJyYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVk\nIE9iamVjdCBnZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIGJvb2xlYW4g\naXNMb2FkZWQpIHsKICAgICAgICAvLyBvbmx5IHJldHVybiB0aGUgZmllbGQg\nZGF0YSBpZiB0aGUgZmllbGQgaXMgaW4gdGhlIHJpZ2h0IGxvYWRlZAogICAg\nICAgIC8vIHN0YXRlOyBvdGhlcndpc2Ugd2UgbWlnaHQgcmV0dXJuIGludGVy\nbWVkaWF0ZSBmb3IgaW1wbCBkYXRhIG9yCiAgICAgICAgLy8gdmljZSB2ZXJz\nYQogICAgICAgIGlmIChfZmllbGRJbXBsID09IG51bGwgfHwgX2xvYWRlZC5n\nZXQoZmllbGQpICE9IGlzTG9hZGVkKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJ\nbmRleChmaWVsZCk7CiAgICAgICAgcmV0dXJuIChpZHggPT0gLTEpID8gbnVs\nbCA6IF9maWVsZEltcGxbaWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZGF0YSBmcm9tIHRvIHByb3BlciBpbmRleCBvZiB0aGUgZXh0cmEg\nZmllbGQgZGF0YSBhcnJheS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJv\nbml6ZWQgT2JqZWN0IHNldEV4dHJhRmllbGREYXRhKGludCBmaWVsZCwgT2Jq\nZWN0IGRhdGEsCiAgICAgICAgYm9vbGVhbiBsb2FkZWQpIHsKICAgICAgICBp\nbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7\nCiAgICAgICAgaWYgKGlkeCA9PSAtMSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRhLmdldEZp\nZWxkKGZpZWxkKSkpOwoKICAgICAgICBPYmplY3Qgb2xkID0gKF9maWVsZElt\ncGwgPT0gbnVsbCkgPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgICAg\nIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gY2Fubm90IHNl\ndCBpZiBmaWVsZCBpbiB3cm9uZyBsb2FkZWQgc3RhdGUKICAgICAgICAgICAg\naWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSAhPSBsb2FkZWQpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVl\nT2YoX21ldGEuZ2V0RmllbGQKICAgICAgICAgICAgICAgICAgICAoZmllbGQp\nKSk7CgogICAgICAgICAgICAvLyBzZXQgZGF0YQogICAgICAgICAgICBpZiAo\nX2ZpZWxkSW1wbCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1w\nbCA9IG5ldyBPYmplY3RbX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgo\nKV07CiAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IGRhdGE7CiAgICAg\nICAgfSBlbHNlIGlmIChfZmllbGRJbXBsICE9IG51bGwgJiYgX2xvYWRlZC5n\nZXQoZmllbGQpID09IGxvYWRlZCkKICAgICAgICAgICAgX2ZpZWxkSW1wbFtp\nZHhdID0gbnVsbDsKICAgICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZmV0Y2goaW50IGZpZWxkKSB7CiAgICAgICAgT2JqZWN0\nIHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1\ncm4gX21ldGEuZ2V0RmllbGQoZmllbGQpLmdldEV4dGVybmFsVmFsdWUodmFs\nLCBfYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoRmll\nbGQoaW50IGZpZWxkLCBib29sZWFuIHRyYW5zaXRpb25zKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tZmllbGQiLAogICAgICAgICAg\nICAgICAgU3RyaW5nLnZhbHVlT2YoZmllbGQpLCBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKS5nZXRDbGFzcygpKSkuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRP\nYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICAvLyBkbyBu\nb3JtYWwgc3RhdGUgdHJhbnNpdGlvbnMKICAgICAgICBpZiAoIWZtZC5pc1By\naW1hcnlLZXkoKSAmJiB0cmFuc2l0aW9ucykKICAgICAgICAgICAgYWNjZXNz\naW5nRmllbGQoZmllbGQpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmll\nbGQoZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgICAgICByZXR1cm4gKGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoZmV0Y2hCeXRlRmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFjdGVyKGZldGNoQ2hhckZpZWxk\nKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKGZldGNoRG91Ymxl\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZldGNoRmxv\nYXRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZl\ndGNoSW50RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVl\nT2YoZmV0Y2hMb25nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNo\nb3J0KGZldGNoU2hvcnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQo\nZmllbGQpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9y\nZShpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICB2YWwgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCkuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIp\nOwogICAgICAgIHN0b3JlRmllbGQoZmllbGQsIHZhbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwp\nIHsKICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCB2YWwsIHRoaXMpOwogICAg\nfQoKICAgIC8qKgogICAgICogPHA+Q2hlY2tzIHdoZXRoZXIgb3Igbm90IDxj\nb2RlPl9wYzwvY29kZT4gaXMgZGlydHkuIEluIHRoZSBjYXNlcyB3aGVyZQog\nICAgICogZmllbGQgdHJhY2tpbmcgaXMgbm90IGhhcHBlbmluZyAoc2VlIGJl\nbG93KSwgdGhpcyBtZXRob2Qgd2lsbCBkbyBhCiAgICAgKiBzdGF0ZSBjb21w\nYXJpc29uIHRvIGZpbmQgd2hldGhlciA8Y29kZT5fcGM8L2NvZGU+IGlzIGRp\ncnR5LCBhbmQgd2lsbAogICAgICogdXBkYXRlIHRoaXMgaW5zdGFuY2Ugd2l0\naCB0aGlzIGluZm9ybWF0aW9uLiBJbiB0aGUgY2FzZXMgd2hlcmUgZmllbGQK\nICAgICAqIHRyYWNraW5nIGlzIGhhcHBlbmluZywgdGhpcyBtZXRob2QgaXMg\nYSBuby1vcC48L3A+CiAgICAgKgogICAgICogPHA+RmllbGRzIGFyZSB0cmFj\na2VkIGZvciBhbGwgY2xhc3NlcyB0aGF0IGFyZSBydW4gdGhyb3VnaCB0aGUg\nT3BlbkpQQQogICAgICogZW5oYW5jZXIgcHJpb3IgdG8gb3IgZHVyaW5nIGRl\ncGxveW1lbnQsIGFuZCBhbGwgY2xhc3NlcyAoZW5oYW5jZWQgb3IKICAgICAq\nIHVuZW5oYW5jZWQpIGluIGEgSmF2YSA2IGVudmlyb25tZW50IG9yIG5ld2Vy\nLjwvcD4KICAgICAqCiAgICAgKiA8cD5JbiBhIEphdmEgNSBWTSBvciBvbGRl\ncjoKICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNz\nZXMgdGhhdCB1c2UKICAgICAqIHByb3BlcnR5IGFjY2VzcyBhbmQgb2JleSB0\naGUgcHJvcGVydHkgYWNjZXNzIGxpbWl0YXRpb25zIGFyZSB0cmFja2VkCiAg\nICAgKiB3aGVuIHRoZSBpbnN0YW5jZXMgYXJlIGxvYWRlZCBmcm9tIHRoZSBk\nYXRhYmFzZSBieSBPcGVuSlBBLCBhbmQgYXJlCiAgICAgKiBub3QgdHJhY2tl\nZCB3aGVuIHRoZSBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYnkgYXBwbGljYXRp\nb24gY29kZS4KICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2Vk\nIGNsYXNzZXMgdGhhdCB1c2UgZmllbGQgYWNjZXNzIGFyZQogICAgICogbmV2\nZXIgdHJhY2tlZC48L3A+CiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGRpcnR5Q2hlY2soKSB7CiAgICAgICAg\naWYgKCFuZWVkc0RpcnR5Q2hlY2soKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBTYXZlRmllbGRNYW5hZ2VyIHNhdmVkID0gZ2V0U2F2ZUZpZWxk\nTWFuYWdlcigpOwogICAgICAgIGlmIChzYXZlZCA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXNhdmVkLWZpZWxkcyIpKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBnZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAvLyBwayBhbmQgdmVyc2lvbiBmaWVsZHMgY2Fubm90IGJlIG11dGF0ZWQ7\nIGRvbid0IG1hcmsgdGhlbQogICAgICAgICAgICAvLyBhcyBzdWNoLiAjIyMj\nIyB2YWxpZGF0ZT8KICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFy\neUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigpCiAgICAgICAgICAgICAg\nICAmJiBfbG9hZGVkLmdldChpKSkgewogICAgICAgICAgICAgICAgaWYgKCFz\nYXZlZC5pc0ZpZWxkRXF1YWwoaSwgZmV0Y2goaSkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgZGlydHkoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIG5l\nZWRzRGlydHlDaGVjaygpIHsKICAgICAgICBpZiAoaXNJbnRlcmNlcHRpbmco\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc0Rl\nbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChpc05ldygpICYmICFpc0ZsdXNoZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZmV0Y2hJbml0aWFsRmllbGQoaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0gUmVz\ndG9yZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAoKF9mbGFn\ncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgfHwgZm1kLmdl\ndEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJl\nc3RvcmUtdW5zZXQiKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgbm90IHNhdmluZyBtdXRh\nYmxlIHR5cGVzLCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICAgICAgICAg\nIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0\nZS5SRVNUT1JFX0FMTAogICAgICAgICAgICAgICAgICAgICYmICgoX2ZsYWdz\nICYgRkxBR19JTlZFUlNFUykgPT0gMAogICAgICAgICAgICAgICAgICAgIHx8\nIGZtZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJtdXRhYmxl\nLXJlc3RvcmUtdW5zZXQiKSk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxs\nIHx8ICFfbG9hZGVkLmdldChmaWVsZCkgfHwgIV9kaXJ0eS5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoRmllbGQoZmllbGQsIGZh\nbHNlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBpcyBkaXJ0eSBi\ndXQgd2UgbmV2ZXIgbG9hZGVkIGl0LCB3ZSBjYW4ndCByZXN0b3JlIGl0CiAg\nICAgICAgICAgIGlmIChfc2F2ZWQuZ2V0VW5sb2FkZWQoKS5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiaW5pdGlhbC11bmxvYWRlZCIsCiAgICAgICAgICAg\nICAgICAgICAgZm1kKSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3Nh\ndmVkLmdldFN0YXRlKCksIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncmV0dXJuIGZldGNoRmllbGQoX3NpbmdsZSwgZm1kKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGZXRjaCB0aGUgc3BlY2lmaWVkIGZpZWxkIGZy\nb20gdGhlIHNwZWNpZmllZCBmaWVsZCBtYW5hZ2VyLCB3cmFwcGluZyBpdAog\nICAgICogaW4gYW4gb2JqZWN0IGlmIGl0J3MgYSBwcmltaXRpdmUuIEEgZmll\nbGQgc2hvdWxkIGJlIHByb3ZpZGVkIHRvIHRoZQogICAgICogZmllbGQgbWFu\nYWdlciBiZWZvcmUgdGhpcyBjYWxsIGlzIG1hZGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIE9iamVjdCBmZXRjaEZpZWxkKEZpZWxkTWFuYWdlciBm\nbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgZmllbGQgPSBm\nbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZm0uZmV0Y2hCb29sZWFu\nRmllbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAg\nICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZShmbS5m\nZXRjaEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0\nZXIoZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBEb3VibGUoZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCkpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgRmxvYXQoZm0uZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAg\nIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hJbnRGaWVsZChmaWVs\nZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmbS5mZXRjaExvbmdG\naWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQoZm0uZmV0Y2hT\naG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaFN0cmlu\nZ0ZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVtb3RlKGludCBm\naWVsZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxk\nLCBCb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAgICAgICAgIHN0b3JlRmll\nbGQoZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0\nRGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9wZXJhdGlvbnMKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogTm90aWZp\nY2F0aW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91dCB0byBiZSBhY2Nlc3Nl\nZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxkIG51bWJl\nciBiZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBzaW5nbGUKICAgICAqIGZp\nZWxkIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZvcmVSZWFkKGludCBmaWVs\nZCkgewogICAgICAgIC8vIGFsbG93IHVubWVkaWF0ZWQgcmVhZHMgb2YgcHJp\nbWFyeSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZpZWxkICE9IC0xICYmIF9t\nZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tlci5pc0FjdGl2ZSgpICYm\nICFfYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmcoKSkgewogICAgICAgICAg\nICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAg\nICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGljUmVhZCh0aGlz\nLCBmaWVsZCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRoaXMsIGZpZWxkKSk7CiAg\nICAgICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxS\nZWFkKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU5v\nbnRyYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4KICAgICAgICAgICAgICAg\nIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3Rh\ndGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2JlZm9yZUZsdXNoCiAg\nICAgKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50IHJlYXNvbiwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5iZWZvcmVGbHVzaCh0aGlz\nLCByZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMLCBjYWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVu\ndCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZmx1c2gKICAg\nICAqLwogICAgdm9pZCBhZnRlckZsdXNoKGludCByZWFzb24pIHsKICAgICAg\nICAvLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBmbHVzaCBub24tcGVyc2lz\ndGVudCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChyZWFzb24gIT0gQnJva2Vy\nSW1wbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAgICAmJiByZWFzb24gIT0g\nQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAgICAgIC8vIGFu\nYWx5emUgcHJldmlvdXMgc3RhdGUgZm9yIGxhdGVyCiAgICAgICAgICAgIGJv\nb2xlYW4gd2FzTmV3ID0gaXNOZXcoKTsKICAgICAgICAgICAgYm9vbGVhbiB3\nYXNGbHVzaGVkID0gaXNGbHVzaGVkKCk7CiAgICAgICAgICAgIGJvb2xlYW4g\nd2FzRGVsZXRlZCA9IGlzRGVsZXRlZCgpOwoKICAgICAgICAgICAgLy8gYWxs\nIGRpcnR5IGZpZWxkcyB3ZXJlIGZsdXNoZWQKICAgICAgICAgICAgX2ZsdXNo\nLm9yKF9kaXJ0eSk7CgogICAgICAgICAgICAvLyBpbXBvcnRhbnQgdG8gc2V0\nIGZsdXNoZWQgYml0IGFmdGVyIGNhbGxpbmcgX3N0YXRlLmZsdXNoIHNvCiAg\nICAgICAgICAgIC8vIHRoYXQgdGhlIHN0YXRlIGNhbiB0ZWxsIHdoZXRoZXIg\ndGhpcyBpcyB0aGUgZmlyc3QgZmx1c2gKICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUuZmx1c2godGhpcykpOwogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxV\nU0hFRF9ESVJUWTsKCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19WRVJT\nSU9OX0NIRUNLOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lP\nTl9VUERBVEU7CgogICAgICAgICAgICAvLyBpZiB0aGlzIHdhcyBhbiBpbmMg\nZmx1c2ggZHVyaW5nIHdoaWNoIHdlIGhhZCBvdXIgaWRlbnRpdHkKICAgICAg\nICAgICAgLy8gYXNzaWduZWQsIHRlbGwgdGhlIGJyb2tlciB0byBjYWNoZSB1\ncyB1bmRlciBvdXIgZmluYWwgb2lkCiAgICAgICAgICAgIGlmIChyZWFzb24g\nPT0gQnJva2VySW1wbC5GTFVTSF9JTkMpCiAgICAgICAgICAgICAgICBhc3Nl\ncnRPYmplY3RJZEFzc2lnbmVkKHRydWUpOwoKICAgICAgICAgICAgLy8gaWYg\ndGhpcyBvYmplY3Qgd2FzIHN0b3JlZCB3aXRoIHByZUZsdXNoLCBkbyBwb3N0\nLXN0b3JlIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19QUkVfRkxVU0hFRCkgPiAwKQogICAgICAgICAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1NUT1JFKTsKCiAgICAg\nICAgICAgIC8vIGRvIHBvc3QtdXBkYXRlIGFzIG5lZWRlZAogICAgICAgICAg\nICBpZiAod2FzTmV3ICYmICF3YXNGbHVzaGVkKQogICAgICAgICAgICAgICAg\nZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJ\nU1RfUEVSRk9STUVEKTsKICAgICAgICAgICAgZWxzZSBpZiAod2FzRGVsZXRl\nZCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3lj\nbGVFdmVudC5BRlRFUl9ERUxFVEVfUEVSRk9STUVEKTsKICAgICAgICAgICAg\nZWxzZSAKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZXMgYW5kIG5ldy1mbHVz\naGVkIHdpdGggY2hhbmdlcwogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNs\nZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1VQREFURV9QRVJGT1JNRUQp\nOwogICAgICAgIH0gZWxzZSBpZiAocmVhc29uID09IEJyb2tlckltcGwuRkxV\nU0hfUk9MTEJBQ0spIHsKICAgICAgICAgICAgLy8gcmV2ZXJ0IHRvIGxhc3Qg\nbG9hZGVkIHZlcnNpb24gYW5kIG9yaWdpbmFsIG9pZAogICAgICAgICAgICBh\nc3NpZ25WZXJzaW9uRmllbGQoX2xvYWRWZXJzaW9uKTsKICAgICAgICAgICAg\naWYgKGlzTmV3KCkgJiYgKF9mbGFncyAmIEZMQUdfT0lEX0FTU0lHTkVEKSA9\nPSAwKQogICAgICAgICAgICAgICAgX29pZCA9IG51bGw7CiAgICAgICAgfQog\nICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVfRkxVU0hFRDsKICAgIH0KCiAg\nICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZSBh\nZnRlciBjaGVja2luZyB0aGUgdmFsdWUKICAgICAqIG9mIHRoZSBSZXRhaW5T\ndGF0ZSBmbGFnLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNjb21taXQK\nICAgICAqIEBzZWUgUENTdGF0ZSNjb21taXRSZXRhaW4KICAgICAqLwogICAg\ndm9pZCBjb21taXQoKSB7CiAgICAgICAgLy8gcmVsZWFzZSBsb2NrcyBiZWZv\ncmUgb2lkIHVwZGF0ZWQKICAgICAgICByZWxlYXNlTG9ja3MoKTsKCiAgICAg\nICAgLy8gdXBkYXRlIHZlcnNpb24gYW5kIG9pZCBpbmZvcm1hdGlvbgogICAg\nICAgIHNldFZlcnNpb24oX3ZlcnNpb24pOwogICAgICAgIF9mbGFncyAmPSB+\nRkxBR19GTFVTSEVEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVE\nX0RJUlRZOwoKICAgICAgICBPYmplY3Qgb3JpZyA9IF9pZDsKICAgICAgICBh\nc3NlcnRPYmplY3RJZEFzc2lnbmVkKGZhbHNlKTsKCiAgICAgICAgYm9vbGVh\nbiB3YXNOZXcgPSBpc05ldygpICYmICFpc0RlbGV0ZWQoKSAmJiAhaXNQcm92\naXNpb25hbCgpOwogICAgICAgIGlmIChfYnJva2VyLmdldFJldGFpblN0YXRl\nKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmNvbW1pdFJldGFp\nbih0aGlzKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5jb21taXQodGhpcykpOwoKICAgICAgICAvLyBhc2sgdGhlIGJy\nb2tlciB0byByZS1jYWNoZSB1cyBpZiB3ZSB3ZXJlIG5ldyBwcmV2aW91c2x5\nCiAgICAgICAgaWYgKHdhc05ldykKICAgICAgICAgICAgX2Jyb2tlci5zZXRT\ndGF0ZU1hbmFnZXIob3JpZywgdGhpcywgQnJva2VySW1wbC5TVEFUVVNfQ09N\nTUlUX05FVyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8g\ndGhlIGN1cnJlbnQgc3RhdGUgYWZ0ZXIgY2hlY2tpbmcgdGhlIHZhbHVlCiAg\nICAgKiBvZiB0aGUgUmV0YWluU3RhdGUgZmxhZy4KICAgICAqCiAgICAgKiBA\nc2VlIFBDU3RhdGUjcm9sbGJhY2sKICAgICAqIEBzZWUgUENTdGF0ZSNyb2xs\nYmFja1Jlc3RvcmUKICAgICAqLwogICAgdm9pZCByb2xsYmFjaygpIHsKICAg\nICAgICAvLyByZWxlYXNlIGxvY2tzCiAgICAgICAgcmVsZWFzZUxvY2tzKCk7\nCiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAgX2Zs\nYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CiAgICAgICAgYWZ0ZXJGbHVz\naChCcm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLKTsKCiAgICAgICAgaWYgKF9i\ncm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgIT0gUmVzdG9yZVN0YXRlLlJFU1RP\nUkVfTk9ORSkKICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUucm9sbGJh\nY2tSZXN0b3JlKHRoaXMpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNl\ndFBDU3RhdGUoX3N0YXRlLnJvbGxiYWNrKHRoaXMpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJvbGxiYWNrIHN0YXRlIG9mIHRoZSBtYW5hZ2VkIGluc3Rh\nbmNlIHRvIHRoZSBnaXZlbiBzYXZlcG9pbnQuCiAgICAgKi8KICAgIHZvaWQg\ncm9sbGJhY2tUb1NhdmVwb2ludChTYXZlcG9pbnRGaWVsZE1hbmFnZXIgc2F2\nZXBvaW50KSB7CiAgICAgICAgX3N0YXRlID0gc2F2ZXBvaW50LmdldFBDU3Rh\ndGUoKTsKICAgICAgICBCaXRTZXQgbG9hZGVkID0gc2F2ZXBvaW50LmdldExv\nYWRlZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBsb2FkZWQu\nbGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAobG9h\nZGVkLmdldChpKSAmJiBzYXZlcG9pbnQucmVzdG9yZUZpZWxkKGkpKSB7CiAg\nICAgICAgICAgICAgICBwcm92aWRlRmllbGQoc2F2ZXBvaW50LmdldENvcHko\nKSwgc2F2ZXBvaW50LCBpKTsKICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVs\nZChfcGMsIHNhdmVwb2ludCwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgX2xvYWRlZCA9IGxvYWRlZDsKICAgICAgICBfZGlydHkgPSBz\nYXZlcG9pbnQuZ2V0RGlydHkoKTsKICAgICAgICBfZmx1c2ggPSBzYXZlcG9p\nbnQuZ2V0Rmx1c2hlZCgpOwogICAgICAgIF92ZXJzaW9uID0gc2F2ZXBvaW50\nLmdldFZlcnNpb24oKTsKICAgICAgICBfbG9hZFZlcnNpb24gPSBzYXZlcG9p\nbnQuZ2V0TG9hZFZlcnNpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIERl\nbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBA\nc2VlIFBDU3RhdGUjcGVyc2lzdAogICAgICogQHNlZSBCcm9rZXIjcGVyc2lz\ndAogICAgICovCiAgICB2b2lkIHBlcnNpc3QoKSB7CiAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUucGVyc2lzdCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgog\nICAgICogQHNlZSBQQ1N0YXRlI2RlbGV0ZQogICAgICogQHNlZSBCcm9rZXIj\nZGVsZXRlCiAgICAgKi8KICAgIHZvaWQgZGVsZXRlKCkgewogICAgICAgIHNl\ndFBDU3RhdGUoX3N0YXRlLmRlbGV0ZSh0aGlzKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAg\nKgogICAgICogQHNlZSBQQ1N0YXRlI25vbnRyYW5zYWN0aW9uYWwKICAgICAq\nIEBzZWUgQnJva2VyI25vbnRyYW5zYWN0aW9uYWwKICAgICAqLwogICAgdm9p\nZCBub250cmFuc2FjdGlvbmFsKCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0\nYXRlLm5vbnRyYW5zYWN0aW9uYWwodGhpcykpOwogICAgfQoKICAgIC8qKgog\nICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoK\nICAgICAqIEBzZWUgUENTdGF0ZSN0cmFuc2FjdGlvbmFsCiAgICAgKiBAc2Vl\nIEJyb2tlciN0cmFuc2FjdGlvbmFsCiAgICAgKi8KICAgIHZvaWQgdHJhbnNh\nY3Rpb25hbCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS50cmFuc2Fj\ndGlvbmFsKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRl\ncyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBD\nU3RhdGUjbm9ucHJvdmlzaW9uYWwKICAgICAqLwogICAgdm9pZCBub25wcm92\naXNpb25hbChib29sZWFuIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub25wcm92aXNpb25hbCh0aGlz\nLCBsb2dpY2FsLCBjYWxsKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxl\nZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNl\nZSBQQ1N0YXRlI3JlbGVhc2UKICAgICAqIEBzZWUgQnJva2VyI3JlbGVhc2UK\nICAgICAqLwogICAgdm9pZCByZWxlYXNlKGJvb2xlYW4gdW5wcm94eSkgewog\nICAgICAgIHJlbGVhc2UodW5wcm94eSwgZmFsc2UpOwogICAgfQoKICAgIHZv\naWQgcmVsZWFzZShib29sZWFuIHVucHJveHksIGJvb2xlYW4gZm9yY2UpIHsK\nICAgICAgICAvLyBvcHRpbWl6YXRpb24gZm9yIGRldGFjaC1pbi1wbGFjZSBz\ncGVjaWFsIGNhc2Ugd2hlbiBmaWVsZHMgYXJlCiAgICAgICAgLy8gYWxyZWFk\neSAodW4pcHJveGllZCBjb3JyZWN0bHkKICAgICAgICBpZiAoIXVucHJveHkp\nCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX05PX1VOUFJPWFk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGZvcmNlKQogICAgICAgICAgICAg\nICAgc2V0UENTdGF0ZShQQ1N0YXRlLlRSQU5TSUVOVCk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnJlbGVh\nc2UodGhpcykpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9m\nbGFncyAmPSB+RkxBR19OT19VTlBST1hZOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4K\nICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZXZpY3QKICAgICAqIEBzZWUg\nQnJva2VyI2V2aWN0CiAgICAgKi8KICAgIHZvaWQgZXZpY3QoKSB7CiAgICAg\nICAgc2V0UENTdGF0ZShfc3RhdGUuZXZpY3QodGhpcykpOwogICAgfQoKICAg\nIC8qKgogICAgICogR2F0aGVyIHJlbGF0aW9ucyByZWFjaGFibGUgZnJvbSB2\nYWx1ZXMgdXNpbmcKICAgICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NBU0NB\nREVfSU1NRURJQVRFfS4KICAgICAqLwogICAgdm9pZCBnYXRoZXJDYXNjYWRl\nUmVmcmVzaChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgaWYgKCFfbG9hZGVkLmdldChpKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZVJlZnJl\nc2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAg\nICAgICAgICAgICB8fCBmbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVSZWZy\nZXNoKCkKICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9JTU1FRElBVEUKICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxl\nbWVudCgpLmdldENhc2NhZGVSZWZyZXNoKCkKICAgICAgICAgICAgICAgID09\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAg\nICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChpLCBmZXRjaEZpZWxk\nKGksIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmdhdGhlckNh\nc2NhZGVSZWZyZXNoKGNhbGwpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5j\nbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGJlZm9yZVJlZnJlc2goYm9vbGVhbiByZWZyZXNoQWxs\nKSB7CiAgICAgICAgLy8gbm90ZTogYWxsIGxvZ2ljIHBsYWNlZCBoZXJlIHJh\ndGhlciB0aGFuIGluIHRoZSBzdGF0ZXMgZm9yCiAgICAgICAgLy8gb3B0aW1p\nemF0aW9uOyB0aGlzIG1ldGhvZCBwdWJsaWMgYi9jIHVzZWQgYnkgcmVtb3Rl\nIHBhY2thZ2UKCiAgICAgICAgLy8gbm90aGluZyB0byBkbyBmb3Igbm9uIHBl\ncnNpc3RlbnQgb3IgbmV3IHVuZmx1c2hlZCBpbnN0YW5jZXMKICAgICAgICBp\nZiAoIWlzUGVyc2lzdGVudCgpIHx8IChpc05ldygpICYmICFpc0ZsdXNoZWQo\nKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIGRpcnR5IG5lZWQg\ndG8gY2xlYXIgZmllbGRzCiAgICAgICAgICAgIGlmIChpc0RpcnR5KCkpIHsK\nICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\naWYgc29tZSBmaWVsZHMgaGF2ZSBiZWVuIGxvYWRlZCBidXQgdGhlIGluc3Rh\nbmNlIGlzIG91dCBvZgogICAgICAgICAgICAvLyBkYXRlIG9yIHRoaXMgaXMg\ncGFydCBvZiBhIHJlZnJlc2hBbGwoKSBhbmQgd2UgZG9uJ3Qgd2FudCB0bwog\nICAgICAgICAgICAvLyB0YWtlIHRoZSBleHRyYSBoaXQgdG8gc2VlIGlmIHRo\nZSBpbnN0YW5jZSBpcyBvdXQgb2YgZGF0ZSwgY2xlYXIKICAgICAgICAgICAg\naWYgKF9sb2FkZWQubGVuZ3RoKCkgPiAwICYmIChyZWZyZXNoQWxsIHx8IGlz\nRW1iZWRkZWQoKQogICAgICAgICAgICAgICAgfHwgIXN5bmNWZXJzaW9uKG51\nbGwpKSkgewogICAgICAgICAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBfdmVy\nc2lvbjsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CgogICAgICAg\nICAgICAgICAgLy8gaWYgc3luY1ZlcnNpb24ganVzdCByZXBsYWNlZCB0aGUg\ndmVyc2lvbiwgcmVzZXQgaXQKICAgICAgICAgICAgICAgIGlmICghcmVmcmVz\naEFsbCAmJiAhaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgICAgIHNl\ndFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBzdGF0ZSB0cmFu\nc2l0aW9ucyBhZnRlciByZWZyZXNoLiBUaGlzIG1ldGhvZCBpcyBvbmx5CiAg\nICAgKiBjYWxsZWQgaWYge0BsaW5rICNiZWZvcmVSZWZyZXNofSByZXR1cm5z\nIHRydWUuCiAgICAgKi8KICAgIHZvaWQgYWZ0ZXJSZWZyZXNoKCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB0cmFu\nc2l0aW9uIHRvIGNsZWFuIG9yIG5vbnRyYW5zYWN0aW9uYWwgZGVwZW5kaW5n\nIG9uIHRyYW5zIHN0YXR1cwogICAgICAgICAgICBpZiAoIV9icm9rZXIuaXNB\nY3RpdmUoKSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFm\ndGVyTm9udHJhbnNhY3Rpb25hbFJlZnJlc2goKSk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAg\nICAgc2V0UENTdGF0ZShfc3RhdGUuYWZ0ZXJPcHRpbWlzdGljUmVmcmVzaCgp\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUuYWZ0ZXJSZWZyZXNoKCkpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE1hcmsgdGhpcyBvYmplY3QgYXMgYSBkZXJlZmVyZW5jZWQg\nZGVwZW5kZW50IG9iamVjdC4KICAgICAqLwogICAgdm9pZCBzZXREZXJlZmVy\nZW5jZWREZXBlbmRlbnQoYm9vbGVhbiBkZXJlZiwgYm9vbGVhbiBub3RpZnkp\nIHsKICAgICAgICBpZiAoIWRlcmVmICYmIChfZmxhZ3MgJiBGTEFHX0RFUkVG\nKSA+IDApIHsKICAgICAgICAgICAgaWYgKG5vdGlmeSkKICAgICAgICAgICAg\nICAgIF9icm9rZXIucmVtb3ZlRGVyZWZlcmVuY2VkRGVwZW5kZW50KHRoaXMp\nOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVSRUY7CiAgICAgICAg\nfSBlbHNlIGlmIChkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19ERVJFRikgPT0g\nMCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19ERVJFRjsKICAgICAg\nICAgICAgaWYgKG5vdGlmeSkKICAgICAgICAgICAgICAgIF9icm9rZXIuYWRk\nRGVyZWZlcmVuY2VkRGVwZW5kZW50KHRoaXMpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9ja2luZwogICAgLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHdlJ3ZlIGJl\nZW4gcmVhZC1sb2NrZWQuIFBhc3MgaW4gdGhlIGxldmVsIGF0IHdoaWNoCiAg\nICAgKiB3ZSB3ZXJlIGxvY2tlZCBhbmQgdGhlIGxldmVsIGF0IHdoaWNoIHdl\nIHNob3VsZCB3cml0ZSBsb2NrIG91cnNlbHZlcwogICAgICogb24gZGlydHku\nCiAgICAgKi8KICAgIHZvaWQgcmVhZExvY2tlZChpbnQgcmVhZExvY2tMZXZl\nbCwgaW50IHdyaXRlTG9ja0xldmVsKSB7CiAgICAgICAgLy8gbWFrZSBzdXJl\nIG9iamVjdCBpcyBhZGRlZCB0byB0cmFuc2FjdGlvbiBzbyBsb2NrIHdpbGwg\nZ2V0CiAgICAgICAgLy8gY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sKICAg\nICAgICBpZiAocmVhZExvY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tfTk9O\nRSkKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbCgpOwoKICAgICAgICBfcmVh\nZExvY2tMZXZlbCA9IHJlYWRMb2NrTGV2ZWw7CiAgICAgICAgX3dyaXRlTG9j\na0xldmVsID0gd3JpdGVMb2NrTGV2ZWw7CiAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1dSSVRF\nX0xPQ0tFRDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbG9j\nayBsZXZlbCB0byB1c2Ugd2hlbiBsb2FkaW5nIHN0YXRlLgogICAgICovCiAg\nICBwcml2YXRlIGludCBjYWxjdWxhdGVMb2NrTGV2ZWwoYm9vbGVhbiBhY3Rp\ndmUsIGJvb2xlYW4gZm9yV3JpdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKSB7CiAgICAgICAgaWYgKCFhY3RpdmUpCiAgICAgICAgICAg\nIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKICAgICAgICBpZiAoZmV0\nY2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwoKICAgICAgICBpZiAoX3JlYWRMb2NrTGV2\nZWwgPT0gLTEpCiAgICAgICAgICAgIF9yZWFkTG9ja0xldmVsID0gZmV0Y2gu\nZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAgIGlmIChfd3JpdGVMb2NrTGV2\nZWwgPT0gLTEpCiAgICAgICAgICAgIF93cml0ZUxvY2tMZXZlbCA9IGZldGNo\nLmdldFdyaXRlTG9ja0xldmVsKCk7CiAgICAgICAgcmV0dXJuIChmb3JXcml0\nZSkgPyBfd3JpdGVMb2NrTGV2ZWwgOiBfcmVhZExvY2tMZXZlbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSdyZSBsb2NrZWQgYXQgdGhl\nIGdpdmVuIGxldmVsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgb2J0YWlu\nTG9ja3MoYm9vbGVhbiBhY3RpdmUsIGJvb2xlYW4gZm9yV3JpdGUsIGludCBs\nb2NrTGV2ZWwsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3Qgc2RhdGEpIHsKICAgICAgICBpZiAoIWFjdGl2ZSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlbid0IGJlZW4gbG9j\na2VkIHlldCwgbG9jayBub3cgYXQgdGhlIGdpdmVuIGxldmVsCiAgICAgICAg\naW50IGZsYWcgPSAoZm9yV3JpdGUpID8gRkxBR19XUklURV9MT0NLRUQgOiBG\nTEFHX1JFQURfTE9DS0VEOwogICAgICAgIGlmICgoX2ZsYWdzICYgZmxhZykg\nPT0gMCkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0IGlzIGFk\nZGVkIHRvIHRyYW5zYWN0aW9uIHNvIGxvY2sgd2lsbCBnZXQKICAgICAgICAg\nICAgLy8gY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sKICAgICAgICAgICAg\naWYgKGxvY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAg\nICAgICAgICAgIHRyYW5zYWN0aW9uYWwoKTsKCiAgICAgICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2Vy\nLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBfYnJva2Vy\nLmdldExvY2tNYW5hZ2VyKCkubG9jayh0aGlzLCBsb2NrTGV2ZWwsCiAgICAg\nICAgICAgICAgICBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBzZGF0YSk7CiAg\nICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1JFQURfTE9DS0VEOwogICAgICAg\nICAgICBfZmxhZ3MgfD0gZmxhZzsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWxlYXNlIGxvY2tzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVsZWFzZUxvY2tzKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxs\nKQogICAgICAgICAgICBfYnJva2VyLmdldExvY2tNYW5hZ2VyKCkucmVsZWFz\nZSh0aGlzKTsKICAgICAgICBfcmVhZExvY2tMZXZlbCA9IC0xOwogICAgICAg\nIF93cml0ZUxvY2tMZXZlbCA9IC0xOwogICAgICAgIF9mbGFncyAmPSB+RkxB\nR19SRUFEX0xPQ0tFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfV1JJVEVf\nTE9DS0VEOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBT\ndGF0ZU1hbmFnZXIgaW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFu\nIHNlcmlhbGl6aW5nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfbWV0YS5pc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBEZXRhY2hNYW5hZ2VyLnByZVNlcmlhbGl6ZSh0aGlzKTsKCiAgICAgICAg\nICAgIGxvYWQoX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwgTE9B\nRF9TRVJJQUxJWkUsIG51bGwsIG51bGwsIAogICAgICAgICAgICAgICAgZmFs\nc2UpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0\ncmFuc2xhdGUocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiB3cml0ZURldGFjaGVkKE9iamVjdE91dHB1dCBvdXQpCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBCaXRTZXQgaWR4cyA9IG5l\ndyBCaXRTZXQoX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoKTsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiBkZXRz\nbSA9IERldGFjaE1hbmFnZXIud3JpdGVEZXRhY2hlZFN0YXRlKHRoaXMsIG91\ndCwgaWR4cyk7CiAgICAgICAgICAgIGlmIChkZXRzbSkKICAgICAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX0RFVEFDSElORzsKCiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0uaXNUcmFuc2llbnQoKSkK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAg\nICAgX3NpbmdsZS5zZXJpYWxpemUob3V0LCAhaWR4cy5nZXQoaSkpOwogICAg\nICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRl\nKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfREVUQUNISU5HOwogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJveHlEZXRhY2hlZERl\nc2VyaWFsaXplZChpbnQgaWR4KSB7CiAgICAgICAgLy8gd2UgZG9uJ3Qgc2Vy\naWFsaXplIHN0YXRlIG1hbmFnZXIgaW1wbHMKICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc1RyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgLy8gc3BlY2lhbCBjYXNl\nIGZvciBUQ0xFQU4sIHdoaWNoIHdlIHdhbnQgdG8gYXBwZWFyIG5vbi10cmFu\ncyB0bwogICAgICAgIC8vIGludGVybmFsIGNvZGUsIGJ1dCB3aGljaCBwdWJs\naWNseSBzaG91bGQgYmUgdHJhbnNhY3Rpb25hbAogICAgICAgIHJldHVybiBf\nc3RhdGUgPT0gUENTdGF0ZS5UQ0xFQU4gfHwgX3N0YXRlLmlzVHJhbnNhY3Rp\nb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUGVuZGluZ1Ry\nYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1BlbmRp\nbmdUcmFuc2FjdGlvbmFsKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNQcm92aXNpb25hbCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzUHJv\ndmlzaW9uYWwoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlcnNp\nc3RlbnQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1BlcnNpc3RlbnQo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc05ldygpIHsKICAgICAg\nICByZXR1cm4gX3N0YXRlLmlzTmV3KCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNEZWxldGVkKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNE\nZWxldGVkKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgp\nIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzRGlydHkoKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGVkKCkgewogICAgICAgIHJldHVy\nbiAoX2ZsYWdzICYgRkxBR19ERVRBQ0hJTkcpICE9IDA7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBnZXRHZW5lcmljQ29udGV4dCgpIHsKICAgICAgICBy\nZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNo\nT2JqZWN0SWQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzaWdu\nT2JqZWN0SWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChfb2lkID09IG51bGwg\nfHwgIV9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAg\nICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuZ2V0Q29weU9iamVjdElk\ncygpKQogICAgICAgICAgICAgICAgcmV0dXJuIF9vaWQ7CgogICAgICAgICAg\nICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICByZXR1cm4gX2Jyb2tl\nci5nZXRTdG9yZU1hbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQoX29pZCwgX21l\ndGEpOwogICAgICAgICAgICByZXR1cm4gQXBwbGljYXRpb25JZHMuY29weShf\nb2lkLCBfbWV0YSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFBDUHJpbWFyeUtl\neShPYmplY3Qgb2lkLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBPYmpl\nY3QgcGsgPSBBcHBsaWNhdGlvbklkcy5nZXQob2lkLCBmbWQpOwogICAgICAg\nIGlmIChwayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSByZWxtZXRhID0gZm1kLmdldERlY2xhcmVk\nVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKHJlbG1ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUKICAgICAg\nICAgICAgJiYgZm1kLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpID09IEph\ndmFUeXBlcy5MT05HKQogICAgICAgICAgICBwayA9IF9icm9rZXIuZ2V0U3Rv\ncmVNYW5hZ2VyKCkubmV3RGF0YVN0b3JlSWQocGssIHJlbG1ldGEpOwogICAg\nICAgIGVsc2UgaWYgKHJlbG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTiAKICAgICAgICAgICAgJiYgZm1k\nLmdldE9iamVjdElkRmllbGRUeXBlKCkgIT0gcmVsbWV0YS5nZXRPYmplY3RJ\nZFR5cGUoKSkKICAgICAgICAgICAgcGsgPSBBcHBsaWNhdGlvbklkcy5mcm9t\nUEtWYWx1ZXMobmV3IE9iamVjdFtdIHsgcGsgfSwgcmVsbWV0YSk7CiAgICAg\nICAgcmV0dXJuIF9icm9rZXIuZmluZChwaywgZmFsc2UsIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyBieXRlIHJlcGxhY2VGbGFncygpIHsKICAgICAgICAv\nLyB3ZSBhbHdheXMgdXNlIGxvYWQgcmVxdWlyZWQgc28gdGhhdCB3ZSBjYW4g\nZGV0ZWN0IHdoZW4gb2JqZWN0cwogICAgICAgIC8vIGFyZSB0b3VjaGVkIGZv\nciBsb2NraW5nIG9yIG1ha2luZyB0cmFuc2FjdGlvbmFsCiAgICAgICAgcmV0\ndXJuIFBlcnNpc3RlbmNlQ2FwYWJsZS5MT0FEX1JFUVVJUkVEOwogICAgfQoK\nICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXIgcmVwbGFjZVN0YXRlTWFuYWdlcihT\ndGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICByZXR1cm4gc207CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYWNjZXNzaW5nRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgLy8gcG9zc2libHkgY2hhbmdlIHN0YXRlCiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYmVmb3JlUmVhZChmaWVsZCk7CiAgICAgICAgICAgIGJl\nZm9yZUFjY2Vzc0ZpZWxkKGZpZWxkKTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZShyZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0\naGUgZ2l2ZW4gZmllbGQgYmVmb3JlIGFjY2Vzcy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgYmVmb3JlQWNjZXNzRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xl\nYW4gYWN0aXZlID0gX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAgICAgICBp\nbnQgbG9ja0xldmVsID0gY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgZmFs\nc2UsIG51bGwpOwogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgbG9ja0xldmVs\nLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGFzc2lnbkZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgICAgIG9i\ndGFpbkxvY2tzKGFjdGl2ZSwgZmFsc2UsIGxvY2tMZXZlbCwgbnVsbCwgbnVs\nbCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBkaXJ0eShTdHJpbmcgZmllbGQpIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsK\nICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHRy\nYW5zbGF0ZShuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tZmllbGQi\nLCBmaWVsZCwKICAgICAgICAgICAgICAgIEltcGxIZWxwZXIuZ2V0TWFuYWdl\nZEluc3RhbmNlKF9wYykuZ2V0Q2xhc3MoKSkpCiAgICAgICAgICAgICAgICAu\nc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7CgogICAg\nICAgIGRpcnR5KGZtZC5nZXRJbmRleCgpLCBudWxsLCB0cnVlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBkaXJ0eShpbnQgZmllbGQpIHsKICAgICAgICBk\naXJ0eShmaWVsZCwgbnVsbCwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYWtlIHRoZSBnaXZlbiBmaWVsZCBkaXJ0eS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gbXV0YXRlIGlmIG51bGwsIG1heSBiZSBhbiBTQ08gbXV0YXRpb247\nIGlmIHRydWUsIGlzIGNlcnRhaW5seQogICAgICogYSBtdXRhdGlvbiAob3Ig\nYXQgbGVhc3QgdHJlYXQgYXMgb25lKQogICAgICogQHJldHVybiB7QGxpbmsg\nQm9vbGVhbiNGQUxTRX0gaWYgdGhpcyBpbnN0YW5jZSB3YXMgYWxyZWFkeSBk\naXJ0eSwKICAgICAqIDxjb2RlPm51bGw8L2NvZGU+IGlmIGl0IHdhcyBkaXJ0\neSBidXQgbm90IHNpbmNlIGZsdXNoLCBhbmQKICAgICAqIHtAbGluayBCb29s\nZWFuI1RSVUV9IGlmIGl0IHdhcyBub3QgZGlydHkKICAgICAqLwogICAgcHJp\ndmF0ZSBCb29sZWFuIGRpcnR5KGludCBmaWVsZCwgQm9vbGVhbiBtdXRhdGUs\nIGJvb2xlYW4gbG9hZEZldGNoR3JvdXApIHsKICAgICAgICBib29sZWFuIGxv\nY2tlZCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gbmV3Rmx1c2ggPSBmYWxz\nZTsKICAgICAgICBib29sZWFuIGNsZWFuID0gZmFsc2U7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmICghaXNOZXcoKSB8fCBpc0Zs\ndXNoZWQoKSkgewogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRVcGRhdGVT\ndHJhdGVneSgpID09IFVwZGF0ZVN0cmF0ZWdpZXMuUkVTVFJJQ1QpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoInVwZGF0ZS1y\nZXN0cmljdCIsIGZtZCkpOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRV\ncGRhdGVTdHJhdGVneSgpID09IFVwZGF0ZVN0cmF0ZWdpZXMuSUdOT1JFKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNFbWJlZGRlZCgpKSB7CiAg\nICAgICAgICAgICAgICAvLyBub3RpZnkgb3duZXIgb2YgY2hhbmdlCiAgICAg\nICAgICAgICAgICBfb3duZXIuZGlydHkoX293bmVyTWV0YS5nZXRGaWVsZE1l\ndGFEYXRhKCkuZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICBCb29s\nZWFuLlRSVUUsIGxvYWRGZXRjaEdyb3VwKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gaXMgdGhpcyBhIGRpcmVjdCBtdXRhdGlvbiBvZiBhbiBz\nY28gZmllbGQ/CiAgICAgICAgICAgIGlmIChtdXRhdGUgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5N\nQVA6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAg\nICAgICAgICAgICAgICAgICAgIG11dGF0ZSA9IEJvb2xlYW4uVFJVRTsKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgICAg\nIG11dGF0ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZm1kLmlz\nRW1iZWRkZWQoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUg\nPSBCb29sZWFuLkZBTFNFOyAvLyBub3Qgc2NvCiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBvc3NpYmx5IGNoYW5n\nZSBzdGF0ZQogICAgICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9rZXIu\naXNBY3RpdmUoKTsKICAgICAgICAgICAgY2xlYW4gPSAhX3N0YXRlLmlzRGly\ndHkoKTsgLy8gaW50ZW50aW9uYWwgZGlyZWN0IGFjY2VzcwoKICAgICAgICAg\nICAgLy8gZmlyZSBldmVudCBmYXN0IGJlZm9yZSBzdGF0ZSBjaGFuZ2UuCiAg\nICAgICAgICAgIGlmIChjbGVhbikKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFkpOwogICAg\nICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgICBpZiAoX2Jy\nb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuYmVmb3JlT3B0aW1pc3RpY1dyaXRlKHRoaXMsIGZp\nZWxkLAogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUuYm9vbGVhblZh\nbHVlKCkpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVXcml0ZSh0aGlzLCBmaWVs\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1\nZSgpKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm1kLmdldE1hbmFnZW1l\nbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKSB7CiAg\nICAgICAgICAgICAgICBpZiAoaXNQZXJzaXN0ZW50KCkgJiYgIV9icm9rZXIu\nZ2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKCkpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICAgICAoIm5vbi10cmFucy13cml0ZSIpKS5z\nZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgKGdldE1h\nbmFnZWRJbnN0YW5jZSgpKTsKCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5iZWZvcmVOb250cmFuc2FjdGlvbmFsV3JpdGUodGhpcywgZmll\nbGQsCiAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgp\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19GTFVTSEVEKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBuZXdGbHVz\naCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIRURfRElSVFkpID09IDA7CiAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEX0RJUlRZOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBsb2NrKCk7CiAgICAgICAgICAgIGxv\nY2tlZCA9IHRydWU7CgogICAgICAgICAgICAvLyBub3RlIHRoYXQgdGhlIGZp\nZWxkIGlzIGluIG5lZWQgb2YgZmx1c2hpbmcgYWdhaW4sIGFuZCB0ZWxsIHRo\nZQogICAgICAgICAgICAvLyBicm9rZXIgdG9vCiAgICAgICAgICAgIF9mbHVz\naC5jbGVhcihmaWVsZCk7CiAgICAgICAgICAgIF9icm9rZXIuc2V0RGlydHko\ndGhpcywgbmV3Rmx1c2ggJiYgIWNsZWFuKTsKCiAgICAgICAgICAgIC8vIHNh\ndmUgdGhlIGZpZWxkIGZvciByb2xsYmFjayBpZiBuZWVkZWQKICAgICAgICAg\nICAgc2F2ZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgICAgIC8vIGRpcnR5IHRo\nZSBmaWVsZCBhbmQgbWFyayBsb2FkZWQ7IGxvYWQgZmV0Y2ggZ3JvdXAgaWYg\nbmVlZGVkCiAgICAgICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVM\nb2NrTGV2ZWwoYWN0aXZlLCB0cnVlLCBudWxsKTsKICAgICAgICAgICAgaWYg\nKCFfZGlydHkuZ2V0KGZpZWxkKSkgewogICAgICAgICAgICAgICAgc2V0TG9h\nZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kaXJ0eS5zZXQo\nZmllbGQpOwoKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZmll\nbGQncyBmZXRjaCBncm91cCBpcyBsb2FkZWQKICAgICAgICAgICAgICAgIGlm\nIChsb2FkRmV0Y2hHcm91cCAmJiBpc1BlcnNpc3RlbnQoKQogICAgICAgICAg\nICAgICAgICAgICYmIGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kLk1BTkFH\nRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgICAgIGxvYWRGaWVsZChm\naWVsZCwgbG9ja0xldmVsLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUsIHRydWUsIGxvY2tMZXZl\nbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsb2NrZWQpCiAg\nICAgICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CgogICAgICAgIGlm\nIChjbGVhbikKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAg\nICAgICBpZiAobmV3Rmx1c2gpIHsKICAgICAgICAgICAgLy8gdGhpcyBldmVu\ndCBjYW4gYmUgZmlyZWQgbGF0ZXIgY2F1c2Ugd2UncmUgYWxyZWFkeSBkaXJ0\neS4KICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2\nZW50LkJFRk9SRV9ESVJUWV9GTFVTSEVEKTsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNF\nOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBwb3N0LWRpcnR5IGV2ZW50\ncyBhZnRlciBmaWVsZCB2YWx1ZSBjaGFuZ2VzLgogICAgICoKICAgICAqIEBw\nYXJhbSBzdGF0dXMgcmV0dXJuIHZhbHVlIGZyb20ge0BsaW5rICNkaXJ0eShp\nbnQsIEJvb2xlYW4sIGJvb2xlYW4pfQogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcG9zdERpcnR5KEJvb2xlYW4gc3RhdHVzKSB7CiAgICAgICAgaWYgKEJv\nb2xlYW4uVFJVRS5lcXVhbHMoc3RhdHVzKSkKICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZKTsKICAg\nICAgICBlbHNlIGlmIChzdGF0dXMgPT0gbnVsbCkKICAgICAgICAgICAgZmly\nZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZX0ZM\nVVNIRUQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZWQoaW50IGZp\nZWxkLCBPYmplY3QgcmVtb3ZlZCwgYm9vbGVhbiBrZXkpIHsKICAgICAgICBp\nZiAocmVtb3ZlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGRlcmVmZXJlbmNlIGRlcGVuZGVu\ndCBmaWVsZHMsIGRlbGV0ZSBlbWJlZGRlZAogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAg\nICAgVmFsdWVNZXRhRGF0YSB2bWQgPSAoa2V5KSA/IGZtZC5nZXRLZXkoKSA6\nIGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgICAgIGlmICh2bWQuaXNFbWJl\nZGRlZFBDKCkpCiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlbGV0ZSh2bWQs\nIHJlbW92ZWQsIG51bGwpOwogICAgICAgICAgICBlbHNlIGlmICh2bWQuZ2V0\nQ2FzY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRP\nKQogICAgICAgICAgICAgICAgX3NpbmdsZS5kZXJlZmVyZW5jZURlcGVuZGVu\ndChyZW1vdmVkKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3UHJveHkoaW50IGZp\nZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgcmV0dXJuIG5ld0ZpZWxkUHJveHkoZmllbGQpOwoK\nICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBpZiAo\nZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3FsLkRhdGUuY2xhc3Mp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5EYXRl\nKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAgICAgICAgICAg\nIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gamF2YS5zcWwuVGltZXN0\nYW1wLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgamF2\nYS5zcWwuVGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsK\nICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0g\namF2YS5zcWwuVGltZS5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IGphdmEuc3FsLlRpbWUoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAg\nICAgcmV0dXJuIENhbGVuZGFyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBuZXdGaWVsZFByb3h5KGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIFByb3h5TWFuYWdlciBtZ3IgPSBfYnJva2VyLmdldENvbmZp\nZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0UHJveHlNYW5hZ2VySW5zdGFu\nY2UoKTsKICAgICAgICBPYmplY3QgaW5pdCA9IGZtZC5nZXRJbml0aWFsaXpl\ncigpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAg\nICAgICAgICAgIHJldHVybiBtZ3IubmV3RGF0ZVByb3h5KGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVO\nREFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdDYWxlbmRhclBy\nb3h5KGZtZC5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICBpbml0IGluc3RhbmNlb2YgVGltZVpvbmUgPyAoVGltZVpvbmUpIGluaXQg\nOiBudWxsKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3Q29sbGVjdGlvblBy\nb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBm\nbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgICAgIGluaXQgaW5zdGFuY2VvZiBDb21wYXJhdG9yID8gKENvbXBh\ncmF0b3IpIGluaXQgOiBudWxsKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdNYXBQcm94\neShmbWQuZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgZm1k\nLmdldEtleSgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAg\nICAgICAgICAgICAgICAgaW5pdCBpbnN0YW5jZW9mIENvbXBhcmF0b3IgPyAo\nQ29tcGFyYXRvcikgaW5pdCA6IG51bGwpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlZmF1\nbHRWYWx1ZShpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAg\nICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIGJvb2xlYW4gcmV0ID0gX3NpbmdsZS5pc0RlZmF1bHRWYWx1ZSgpOwog\nICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIHJldHVy\nbiByZXQ7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nUmVjb3JkIHRoYXQgdGhlIGZpZWxkIGlzIGRpcnR5ICh3aGljaCBtaWdodCBs\nb2FkIERGRykKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNl\ndHRpbmdCb29sZWFuRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgYm9vbGVhbiBjdXJWYWwsIGJvb2xlYW4gbmV3VmFs\nLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7\nCiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQu\nZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9\nCgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBC\nb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0\nID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJvb2xl\nYW5GaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0\neShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGlu\nZ0J5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBieXRlIGN1clZhbCwgYnl0ZSBuZXdWYWwsIGludCBzZXQpIHsK\nICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAg\naWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1By\naW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9\nIGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIp\nOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBu\nZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nQ2hhckZpZWxkKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGNoYXIgY3Vy\nVmFsLCBjaGFyIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQg\nIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1\nclZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShm\naWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJv\nb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVDaGFyRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldHRpbmdEb3VibGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIGludCBmaWVsZCwKICAgICAgICBkb3VibGUgY3VyVmFsLCBkb3VibGUg\nbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVN\nT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9s\nb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAg\nICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxT\nRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9y\nZURvdWJsZUZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBs\nYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9z\ndERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXR0aW5nRmxvYXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBmbG9hdCBjdXJWYWwsIGZsb2F0IG5ld1ZhbCwgaW50\nIHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAg\nICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVh\nbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBT\nRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVGbG9hdEZpZWxk\nKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMs\nIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nSW50Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAg\naW50IGN1clZhbCwgaW50IG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlm\nIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFs\nID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNo\nYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmll\nbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAg\nICAgIF9zaW5nbGUuc3RvcmVJbnRGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAg\nICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAg\nICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0dGluZ0xvbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBsb25nIGN1clZhbCwgbG9uZyBu\nZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1P\nVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAg\nICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNF\nLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nTG9uZ0ZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNl\nRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERp\ncnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0\naW5nT2JqZWN0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQsCiAgICAgICAgT2JqZWN0IGN1clZhbCwgT2JqZWN0IG5ld1ZhbCwgaW50\nIHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSkgewog\nICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgIC8vIG9ubHkg\nY29tcGFyZSBuZXcgdG8gb2xkIHZhbHVlcyBpZiB0aGUgY29tcGFyaXNvbiBp\ncyBnb2luZyB0bwogICAgICAgICAgICAgICAgLy8gYmUgY2hlYXAgLS0gZG9u\nJ3QgY29tcGFyZSBjb2xsZWN0aW9ucywgbWFwcywgVURUcwogICAgICAgICAg\nICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAg\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCAhPSBudWxs\nICYmIG5ld1ZhbC5lcXVhbHMoY3VyVmFsKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBk\nZXBlbmRlbnQgdW5sb2FkZWQgZmllbGQsIG1ha2Ugc3VyZSB0byBsb2FkCiAg\nICAgICAgICAgICAgICAvLyBpdCBub3cKICAgICAgICAgICAgICAgIGlmIChm\nbWQuZ2V0Q2FzY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9BVVRPCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldEtleSgpLmdl\ndENhc2NhZGVEZWxldGUoKQogICAgICAgICAgICAgICAgICAgID09IFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9BVVRPCiAgICAgICAgICAgICAgICAgICAgfHwg\nZm1kLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAg\nICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTykKICAg\nICAgICAgICAgICAgICAgICBjdXJWYWwgPSBmZXRjaE9iamVjdEZpZWxkKGZp\nZWxkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXNzZXJ0Tm9Qcmlt\nYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkKICAgICAgICAg\nICAgICAgIGFzc2VydE5vdE1hbmFnZWRPYmplY3RJZChuZXdWYWwpOwogICAg\nICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNF\nLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBpZiAoc2V0ICE9IFNF\nVF9SRU1PVEUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmpl\nY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUudW5wcm94eSgpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5kZXJlZmVy\nZW5jZURlcGVuZGVudCgpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVh\ncigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVP\nYmplY3RGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3RE\naXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\ndGluZ1Nob3J0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQsCiAgICAgICAgc2hvcnQgY3VyVmFsLCBzaG9ydCBuZXdWYWwsIGludCBz\nZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAg\nICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3Nl\ncnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4g\nc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VU\nX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlU2hvcnRGaWVsZChm\naWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ1N0cmluZ0Zp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIFN0cmluZyBjdXJWYWwsIFN0cmluZyBuZXdWYWwsIGludCBzZXQpIHsKICAg\nICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmVxdWFscyhuZXdWYWwsIGN1clZhbCkgJiYgX2xvYWRl\nZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAg\nIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBz\nZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlU3Ry\naW5nRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGly\ndHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzYWxs\nb3dzIGNoYW5naW5nIHByaW1hcnkga2V5IGZpZWxkcyBmb3IgaW5zdGFuY2Vz\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0Tm9QcmltYXJ5S2V5\nQ2hhbmdlKGludCBmaWVsZCkgewogICAgICAgIGlmIChfb2lkICE9IG51bGwg\nJiYgX21ldGEuZ2V0RmllbGQoZmllbGQpLmlzUHJpbWFyeUtleSgpKQogICAg\nICAgICAgICB0aHJvdyB0cmFuc2xhdGUobmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJjaGFuZ2UtaWRlbnRp\ndHkiKSkuc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNhbGxvd3Mgc2V0dGluZyBhbiBv\nYmplY3QgaWQgZmllbGQgdG8gYSBtYW5hZ2VkIGluc3RhbmNlLgogICAgICov\nCiAgICB2b2lkIGFzc2VydE5vdE1hbmFnZWRPYmplY3RJZChPYmplY3QgdmFs\nKSB7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsCiAgICAgICAgICAgICYmIChJ\nbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKHZhbCwKICAgICAgICAg\nICAgICAgICBnZXRDb250ZXh0KCkuZ2V0Q29uZmlndXJhdGlvbigpKSkucGNH\nZXRHZW5lcmljQ29udGV4dCgpIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\ndHJhbnNsYXRlKG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQK\nICAgICAgICAgICAgICAgICgibWFuYWdlZC1vaWQiLCBFeGNlcHRpb25zLnRv\nU3RyaW5nKHZhbCksCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50\nb1N0cmluZyhnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4KICAgICAgICAgICAg\nICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8v\nIERlbGVnYXRlIHRvIEZpZWxkTWFuYWdlcgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkQm9vbGVh\nbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAg\nICAgIGJvb2xlYW4gY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlQm9vbGVh\nbkZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHByb3ZpZGVkQnl0ZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkLAogICAgICAgIGJ5dGUgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0\nb3JlQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHByb3ZpZGVkQ2hhckZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIGNoYXIgY3VyVmFsKSB7CiAgICAgICAg\nX2ZtLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHByb3ZpZGVkRG91YmxlRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZG91YmxlIGN1clZhbCkg\newogICAgICAgIF9mbS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkRmxvYXRGaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBmbG9h\ndCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVGbG9hdEZpZWxkKGZpZWxk\nLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkSW50\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAg\nICAgaW50IGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUludEZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVk\nTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlTG9uZ0Zp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBy\nb3ZpZGVkT2JqZWN0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgT2JqZWN0IGN1clZhbCkgewogICAgICAgIF9mbS5z\ndG9yZU9iamVjdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHByb3ZpZGVkU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBzaG9ydCBjdXJWYWwpIHsKICAg\nICAgICBfZm0uc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkU3RyaW5nRmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgU3RyaW5nIGN1\nclZhbCkgewogICAgICAgIF9mbS5zdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBj\ndXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcGxhY2VCb29s\nZWFuRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsK\nICAgICAgICByZXR1cm4gX2ZtLmZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKTsK\nICAgIH0KCiAgICBwdWJsaWMgYnl0ZSByZXBsYWNlQnl0ZUZpZWxkKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJu\nIF9mbS5mZXRjaEJ5dGVGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVibGlj\nIGNoYXIgcmVwbGFjZUNoYXJGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hDaGFyRmll\nbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBkb3VibGUgcmVwbGFjZURv\ndWJsZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7\nCiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaERvdWJsZUZpZWxkKGZpZWxkKTsK\nICAgIH0KCiAgICBwdWJsaWMgZmxvYXQgcmVwbGFjZUZsb2F0RmllbGQoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1\ncm4gX2ZtLmZldGNoRmxvYXRGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVi\nbGljIGludCByZXBsYWNlSW50RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoSW50Rmll\nbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIHJlcGxhY2VMb25n\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAg\nICAgICByZXR1cm4gX2ZtLmZldGNoTG9uZ0ZpZWxkKGZpZWxkKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IHJlcGxhY2VPYmplY3RGaWVsZChQZXJzaXN0\nZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBf\nZm0uZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVibGlj\nIHNob3J0IHJlcGxhY2VTaG9ydEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaFNob3J0\nRmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgcmVwbGFj\nZVN0cmluZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaFN0cmluZ0ZpZWxkKGZpZWxk\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBGaWVsZE1hbmFnZXIKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgYm9vbGVhbiBmZXRjaEJvb2xlYW4oaW50IGZpZWxkKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2Jq\nZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICBy\nZXR1cm4gKChCb29sZWFuKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBmZXRjaEJvb2xlYW5GaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQs\nIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEJvb2xlYW5GaWVsZChmaWVs\nZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBieXRlIGZldGNoQnl0ZShp\nbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRh\nLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFs\naXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hCeXRlRmllbGQoZmll\nbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwg\nZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVy\nbmFsVmFsdWUodmFsLCBfYnJva2VyKSkuYnl0ZVZhbHVlKCk7CiAgICB9Cgog\nICAgcHVibGljIGJ5dGUgZmV0Y2hCeXRlRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hCeXRlRmllbGQo\nZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgY2hhciBmZXRjaENo\nYXIoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQ2hhckZpZWxk\nKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmll\nbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChDaGFyYWN0ZXIpIGZtZC5n\nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmNoYXJWYWx1ZSgpOwog\nICAgfQoKICAgIHB1YmxpYyBjaGFyIGZldGNoQ2hhckZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxv\nYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBm\nYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xl\nLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoQ2hh\nckZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGRvdWJs\nZSBmZXRjaERvdWJsZShpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0\nY2hEb3VibGVGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBm\nZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVt\nYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5kb3Vi\nbGVWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBkb3VibGUgZmV0Y2hEb3Vi\nbGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAg\nICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9D\nS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4g\nX3NpbmdsZS5mZXRjaERvdWJsZUZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXQoaW50IGZpZWxkKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAg\nICAgICAgcmV0dXJuIGZldGNoRmxvYXRGaWVsZChmaWVsZCk7CgogICAgICAg\nIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAg\nICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWws\nIF9icm9rZXIpKS5mbG9hdFZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGZs\nb2F0IGZldGNoRmxvYXRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdl\ndChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExv\nY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAg\nICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEZsb2F0RmllbGQoZmllbGQpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGZldGNoSW50KGludCBmaWVs\nZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBmZXRjaEludEZpZWxkKGZpZWxkKTsKCiAg\nICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKHZhbCwgX2Jyb2tlcikpLmludFZhbHVlKCk7CiAgICB9CgogICAgcHVibGlj\nIGludCBmZXRjaEludEZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9j\na0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAg\nICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHJldHVybiBfc2luZ2xlLmZldGNoSW50RmllbGQoZmllbGQpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgbG9uZyBmZXRjaExvbmcoaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZldGNoTG9uZ0ZpZWxkKGZpZWxkKTsKCiAg\nICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKHZhbCwgX2Jyb2tlcikpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBsb25nIGZldGNoTG9uZ0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQu\nZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwg\nTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAg\nICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoTG9uZ0ZpZWxkKGZpZWxkKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaE9iamVjdChp\nbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRh\nLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFs\naXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKHZhbCwgX2Jyb2tlcik7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRj\naE9iamVjdEZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVs\ncy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92\naWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJl\ndHVybiBfc2luZ2xlLmZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgc2hvcnQgZmV0Y2hTaG9ydChpbnQgZmllbGQp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICByZXR1cm4gZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKTsKCiAg\nICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKHZhbCwgX2Jyb2tlcikpLnNob3J0VmFsdWUoKTsKICAgIH0KCiAgICBwdWJs\naWMgc2hvcnQgZmV0Y2hTaG9ydEZpZWxkKGludCBmaWVsZCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2Fk\nZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVs\nZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAg\nICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAg\nICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoU2hvcnRGaWVsZChmaWVs\nZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZmV0Y2hTdHJp\nbmcoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmll\nbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChm\naWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoU3RyaW5nKSBmbWQuZ2V0\nRXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZmV0Y2hTdHJpbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmll\nbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaFN0cmluZ0ZpZWxkKGZp\nZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVCb29s\nZWFuKGludCBmaWVsZCwgYm9vbGVhbiBleHRlcm5hbFZhbCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAg\nIHN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSAoZXh0ZXJuYWxW\nYWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUodmFsLCBf\nYnJva2VyKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlQm9vbGVhbkZpZWxkKGludCBmaWVsZCwgYm9vbGVhbiBjdXJWYWwpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3Np\nbmdsZS5zdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBw\nb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlQnl0ZShpbnQgZmllbGQsIGJ5dGUgZXh0ZXJuYWxWYWwp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICBzdG9yZUJ5dGVGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwg\nZm1kLmdldEZpZWxkVmFsdWUobmV3IEJ5dGUoZXh0ZXJuYWxWYWwpLAogICAg\nICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlQnl0ZUZpZWxkKGludCBmaWVsZCwgYnl0ZSBjdXJWYWwpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9h\nZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlQ2hhcihpbnQgZmllbGQsIGNoYXIgZXh0ZXJuYWxWYWwpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICBzdG9yZUNoYXJGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdl\ndEZpZWxkVmFsdWUobmV3IENoYXJhY3RlcihleHRlcm5hbFZhbCksCiAgICAg\nICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVDaGFyRmllbGQoaW50IGZpZWxkLCBjaGFyIGN1clZhbCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVEb3VibGUoaW50IGZpZWxkLCBkb3VibGUgZXh0ZXJuYWxWYWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICBzdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBm\nbWQuZ2V0RmllbGRWYWx1ZShuZXcgRG91YmxlKGV4dGVybmFsVmFsKSwKICAg\nICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdG9yZURvdWJsZUZpZWxkKGludCBmaWVsZCwgZG91YmxlIGN1clZhbCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBf\nc2luZ2xlLnN0b3JlRG91YmxlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAg\nICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAg\ncG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZUZsb2F0KGludCBmaWVsZCwgZmxvYXQgZXh0ZXJuYWxW\nYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZp\nZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgp\nKQogICAgICAgICAgICBzdG9yZUZsb2F0RmllbGQoZmllbGQsIGV4dGVybmFs\nVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmll\nbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBGbG9hdChleHRlcm5hbFZhbCks\nCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc3RvcmVGbG9hdEZpZWxkKGludCBmaWVsZCwgZmxvYXQgY3VyVmFs\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIF9zaW5nbGUuc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAg\nICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAg\nIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RvcmVJbnQoaW50IGZpZWxkLCBpbnQgZXh0ZXJuYWxWYWwp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICBzdG9yZUludEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBm\nbWQuZ2V0RmllbGRWYWx1ZShOdW1iZXJzLnZhbHVlT2YoZXh0ZXJuYWxWYWwp\nLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlSW50RmllbGQoaW50IGZpZWxkLCBpbnQgY3VyVmFsKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVJbnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0\nTG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0b3JlTG9uZyhpbnQgZmllbGQsIGxvbmcgZXh0ZXJuYWxWYWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICBzdG9yZUxvbmdGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1k\nLmdldEZpZWxkVmFsdWUoTnVtYmVycy52YWx1ZU9mKGV4dGVybmFsVmFsKSwK\nICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZUxvbmdGaWVsZChpbnQgZmllbGQsIGxvbmcgY3VyVmFsKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVMb25nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAg\nICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9z\ndExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZU9iamVjdChpbnQgZmllbGQsIE9iamVjdCBleHRlcm5hbFZh\nbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpOwogICAgICAgIGV4dGVybmFsVmFsID0gZm1kLm9yZGVyKGV4\ndGVybmFsVmFsKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgp\nKQogICAgICAgICAgICBzdG9yZU9iamVjdEZpZWxkKGZpZWxkLCBleHRlcm5h\nbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZp\nZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShleHRlcm5hbFZhbCwgX2Jyb2tlcikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlT2JqZWN0RmllbGQoaW50\nIGZpZWxkLCBPYmplY3QgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgX3NpbmdsZS5wcm94eSh0\ncnVlLCBmYWxzZSk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9z\naW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0\ncnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0KGludCBmaWVs\nZCwgc2hvcnQgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZVNob3J0Rmll\nbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBT\naG9ydChleHRlcm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVTaG9ydEZpZWxkKGludCBm\naWVsZCwgc2hvcnQgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTaG9ydEZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwg\ndHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVTdHJpbmcoaW50IGZp\nZWxkLCBTdHJpbmcgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZVN0cmlu\nZ0ZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShl\neHRlcm5hbFZhbCwgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlU3RyaW5nRmllbGQoaW50IGZpZWxkLCBTdHJpbmcgY3VyVmFsKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBw\nb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogU3RvcmUgdGhlIGdpdmVuIGZpZWxkIHZhbHVlIGludG8gdGhlIGdp\ndmVuIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\ndG9yZUZpZWxkKGludCBmaWVsZCwgT2JqZWN0IHZhbCwgRmllbGRNYW5hZ2Vy\nIGZtKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tZmll\nbGQtaW5kZXgiLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoZmll\nbGQpLCBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKS4KICAgICAgICAgICAg\nICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7Cgog\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAg\nICAgICAgYm9vbGVhbiBib29sID0gdmFsICE9IG51bGwgJiYgKChCb29sZWFu\nKSB2YWwpLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3Rv\ncmVCb29sZWFuRmllbGQoZmllbGQsIGJvb2wpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICBieXRlIGIgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVt\nYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3Rv\ncmVCeXRlRmllbGQoZmllbGQsIGIpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAg\nICAgICBjaGFyIGMgPSAodmFsID09IG51bGwpID8gMCA6ICgoQ2hhcmFjdGVy\nKSB2YWwpLmNoYXJWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVD\naGFyRmllbGQoZmllbGQsIGMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAg\nICAgIGRvdWJsZSBkID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikg\ndmFsKS5kb3VibGVWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVE\nb3VibGVGaWVsZChmaWVsZCwgZCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAg\nICAgICBmbG9hdCBmID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikg\ndmFsKS5mbG9hdFZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZUZs\nb2F0RmllbGQoZmllbGQsIGYpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAg\nIGludCBpID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFsKS5p\nbnRWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVJbnRGaWVsZChm\naWVsZCwgaSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGxvbmcgbCA9\nICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVl\nKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZUxvbmdGaWVsZChmaWVsZCwg\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBzaG9ydCBzID0gKHZh\nbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFsKS5zaG9ydFZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBmbS5zdG9yZVNob3J0RmllbGQoZmllbGQsIHMp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIGZtLnN0b3JlU3RyaW5n\nRmllbGQoZmllbGQsIChTdHJpbmcpIHZhbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGZt\nLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIHZhbCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8vLy8vLy8vLy8vLy8KICAgIC8vIFV0aWxpdGllcwogICAgLy8v\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogRXJhc2UgdGhlIGZhY3QgdGhh\ndCB0aGlzIGluc3RhbmNlIGhhcyBiZWVuIGZsdXNoZWQuCiAgICAgKi8KICAg\nIHZvaWQgZXJhc2VGbHVzaCgpIHsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJU\nWTsKCiAgICAgICAgaW50IGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKS5sZW5n\ndGg7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzOyBpKyspCiAg\nICAgICAgICAgIF9mbHVzaC5jbGVhcihpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlY29yZHMgdGhhdCBhbGwgaW5zdGFuY2UgZmllbGRzIGFyZS9hcmUg\nbm90IGxvYWRlZC4KICAgICAqIFByaW1hcnkga2V5IGFuZCBub24tcGVyc2lz\ndGVudCBmaWVsZHMgYXJlIG5vdCBhZmZlY3RlZC4KICAgICAqLwogICAgdm9p\nZCBzZXRMb2FkZWQoYm9vbGVhbiB2YWwpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkKICAgICAgICAgICAgICAg\nICYmIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpID09IGZtZHNbaV0uTUFOQUdF\nX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBzZXRMb2FkZWQoaSwgdmFs\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF2YWwpIHsKICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX0xPQURFRDsKICAgICAgICAgICAgc2V0RGlydHko\nZmFsc2UpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19MT0FERUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmRzIHRo\nYXQgYWxsIGluc3RhbmNlIGZpZWxkcyBhcmUvYXJlIG5vdCBkaXJ0eSwKICAg\nICAqIGFuZCBjaGFuZ2VzIHRoZSBmbGFncyBvZiB0aGUgaW5zdGFuY2UgYWNj\nb3JkaW5nbHkuCiAgICAgKi8KICAgIHZvaWQgc2V0RGlydHkoYm9vbGVhbiB2\nYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndEZpZWxkcygpOwogICAgICAgIGJvb2xlYW4gdXBkYXRlID0gIWlzTmV3KCkg\nfHwgaXNGbHVzaGVkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh2YWwgJiYgKCF1\ncGRhdGUKICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0VXBkYXRlU3Ry\nYXRlZ3koKSAhPSBVcGRhdGVTdHJhdGVnaWVzLklHTk9SRSkpCiAgICAgICAg\nICAgICAgICBfZGlydHkuc2V0KGkpOwogICAgICAgICAgICBlbHNlIGlmICgh\ndmFsKSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBuZXZlciBjb25zaWRlciBj\nbGVhbiBmaWVsZHMgZmx1c2hlZDsgdGhpcyBhbHNvIHRha2VzCiAgICAgICAg\nICAgICAgICAvLyBjYXJlIG9mIGNsZWFyaW5nIHRoZSBmbHVzaGVkIGZpZWxk\ncyBvbiBjb21taXQvcm9sbGJhY2sKICAgICAgICAgICAgICAgIF9mbHVzaC5j\nbGVhcihpKTsKICAgICAgICAgICAgICAgIF9kaXJ0eS5jbGVhcihpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCkKICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BREVEOwogICAgfQoKICAgIC8qKgog\nICAgICogRXhlY3V0ZXMgcHJlLWNsZWFyIGNhbGxiYWNrcywgY2xlYXJzIGFs\nbCBtYW5hZ2VkIGZpZWxkcywgYW5kIGNhbGxzIHRoZQogICAgICoge0BsaW5r\nICNzZXRMb2FkZWR9IG1ldGhvZCB3aXRoIGEgdmFsdWUgb2YgZmFsc2UuIFBy\naW1hcnkga2V5IGZpZWxkcwogICAgICogYXJlIG5vdCBjbGVhcmVkLgogICAg\nICovCiAgICB2b2lkIGNsZWFyRmllbGRzKCkgewogICAgICAgIGlmICghaXNJ\nbnRlcmNlcHRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBm\naXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFS\nKTsKCiAgICAgICAgLy8gdW5wcm94eSBhbGwgZmllbGRzCiAgICAgICAgdW5w\ncm94eUZpZWxkcygpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gY2xlYXIgbm9uLXBrIGZpZWxkcwogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlL\nZXkoKSAmJiBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKQogICAgICAgICAgICAg\nICAgICAgID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAg\nICAgICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgQ2xlYXJGaWVs\nZE1hbmFnZXIuZ2V0SW5zdGFuY2UoKSwgaSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIGZvcmdldCB2ZXJzaW9uIGluZm8gYW5kIGltcGwgZGF0\nYSBzbyB3ZSByZS1yZWFkIG5leHQgdGltZQogICAgICAgICAgICBzZXRMb2Fk\nZWQoZmFsc2UpOwogICAgICAgICAgICBfdmVyc2lvbiA9IG51bGw7CiAgICAg\nICAgICAgIF9sb2FkVmVyc2lvbiA9IG51bGw7CiAgICAgICAgICAgIGlmIChf\nZmllbGRJbXBsICE9IG51bGwpCiAgICAgICAgICAgICAgICBBcnJheXMuZmls\nbChfZmllbGRJbXBsLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CgogICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9DTEVBUik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhhdCB3ZSBzaG91bGQgc2F2ZSBh\nbnkgZmllbGRzIHRoYXQgY2hhbmdlIGZyb20gdGhpcyBwb2ludAogICAgICog\nZm9yd2FyZC4KICAgICAqLwogICAgdm9pZCBzYXZlRmllbGRzKGJvb2xlYW4g\naW1tZWRpYXRlKSB7CiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0\nYXRlKCkgPT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAg\nICAmJiAoX2ZsYWdzICYgRkxBR19JTlZFUlNFUykgPT0gMCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBfZmxhZ3MgfD0gRkxBR19TQVZFOwogICAg\nICAgIGlmIChpbW1lZGlhdGUpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykKICAg\nICAgICAgICAgICAgIHNhdmVGaWVsZChpKTsKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX1NBVkU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogSWYgdGhlIGZpZWxkIGlzbid0IGFscmVhZHkgc2F2ZWQsIHNhdmVzIHRo\nZSBjdXJyZW50bHkgbG9hZGVkIGZpZWxkCiAgICAgKiBzdGF0ZSBvZiB0aGUg\naW5zdGFuY2UuIFRoZSBzYXZlZCB2YWx1ZXMgY2FuIGFsbCBiZSByZXN0b3Jl\nZCB2aWEKICAgICAqIHtAbGluayAjcmVzdG9yZUZpZWxkc30uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBzYXZlRmllbGQoaW50IGZpZWxkKSB7CiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NBVkUpID09IDApCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIG1hbmFnZWQgaW52\nZXJzZSBmaWVsZCwgbG9hZCBpdCBzbyB3ZSdyZSBzdXJlIHRvIGhhdmUKICAg\nICAgICAvLyB0aGUgb3JpZ2luYWwgdmFsdWUKICAgICAgICBpZiAoIV9sb2Fk\nZWQuZ2V0KGZpZWxkKSAmJiAoKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpICE9\nIDAKICAgICAgICAgICAgJiYgX21ldGEuZ2V0RmllbGQoZmllbGQpLmdldElu\ndmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSkKICAgICAgICAgICAgbG9h\nZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZh\nbHNlKTsKCiAgICAgICAgLy8gZG9uJ3QgYm90aGVyIGNyZWF0aW5nIHRoZSBz\nYXZlIGZpZWxkIG1hbmFnZXIgaWYgd2UncmUgbm90IGdvaW5nIHRvCiAgICAg\nICAgLy8gc2F2ZSB0aGUgb2xkIGZpZWxkIHZhbHVlIGFueXdheQogICAgICAg\nIGlmIChfc2F2ZWQgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2xvYWRl\nZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgX3NhdmVkID0gbmV3IFNh\ndmVGaWVsZE1hbmFnZXIodGhpcywgbnVsbCwgX2RpcnR5KTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gY29weSB0aGUgZmllbGQgdG8gc2F2ZSBmaWVsZCBtYW5hZ2Vy\nOyBpZiB0aGUgZmllbGQgaXMgbm90IGRpcmVjdGx5CiAgICAgICAgLy8gY29w\neWFibGUsIGltbWVkaWF0ZWx5IHByb3ZpZGUgYW5kIHJlcGxhY2UgaXQgdmlh\nIHRoZSBzYXZlIGZpZWxkCiAgICAgICAgLy8gbWFuYWdlciwgd2hpY2ggd2ls\nbCBjb3B5IHRoZSBtdXRhYmxlIHZhbHVlIHRvIHByZXZlbnQgYnktcmVmIG1v\nZHMKICAgICAgICBpZiAoX3NhdmVkLnNhdmVGaWVsZChmaWVsZCkpIHsKICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NhdmVkLCBmaWVsZCk7CiAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfc2F2ZWQuZ2V0U3RhdGUoKSwgX3Nh\ndmVkLCBmaWVsZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTm90aWZpY2F0aW9uIHRoYXQgdGhlIHN0YXRlIHdpbGwgbm90IG5lZWQgdG8g\nYmUgcm9sbGVkIGJhY2sKICAgICAqIHRvIHRoYXQgb2YgdGhlIGxhc3QgY2Fs\nbCB0byB7QGxpbmsgI3NhdmVGaWVsZHN9LgogICAgICovCiAgICB2b2lkIGNs\nZWFyU2F2ZWRGaWVsZHMoKSB7CiAgICAgICAgaWYgKGlzSW50ZXJjZXB0aW5n\nKCkpIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NBVkU7CiAgICAg\nICAgICAgIF9zYXZlZCA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBTYXZlRmllbGRNYW5hZ2VyIGdldFNhdmVGaWVsZE1hbmFnZXIoKSB7\nCiAgICAgICAgcmV0dXJuIF9zYXZlZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJvbGxiYWNrIHRoZSBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UgdG8gdGhlIHNh\ndmVkIHN0YXRlIGZyb20gdGhlCiAgICAgKiBsYXN0IGNhbGwgdG8ge0BsaW5r\nICNzYXZlRmllbGRzfSwgb3IgdG8gZGVmYXVsdCB2YWx1ZXMgaWYgbmV2ZXIg\nc2F2ZWQuCiAgICAgKi8KICAgIHZvaWQgcmVzdG9yZUZpZWxkcygpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9z\nYXZlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfU0FWRSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICBjbGVhckZp\nZWxkcygpOwogICAgICAgICAgICAgICAgZWxzZSAvLyBvbmx5IHVubG9hZGVk\nIGZpZWxkcyB3ZXJlIGRpcnRpZWQKICAgICAgICAgICAgICAgICAgICBfbG9h\nZGVkLmFuZE5vdChfbG9hZGVkKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICAvLyB3ZSBkaXJlY3Qgc3RhdGUgdHJhbnNpdGlvbnMgYmFzZWQgb24gb3Vy\nIG93biBnZXRSZXN0b3JlU3RhdGUKICAgICAgICAgICAgLy8gbWV0aG9kLCBi\ndXQgdG8gZGVjaWRlIHdoZXRoZXIgdG8gYWN0dWFsbHkgcm9sbGJhY2sgZmll\nbGQKICAgICAgICAgICAgLy8gdmFsdWVzLCB3ZSBjb25zdWx0IHRoZSBicm9r\nZXIgZm9yIHRoZSB1c2VyJ3Mgc2V0dGluZwogICAgICAgICAgICBlbHNlIGlm\nIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0ZS5S\nRVNUT1JFX05PTkUpIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIGFs\nbCBjdXJyZW50bHktbG9hZGVkIGZpZWxkcwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47\nIGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoaSkg\nJiYgX3NhdmVkLnJlc3RvcmVGaWVsZChpKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NhdmVkLCBpKTsKCiAgICAgICAg\nICAgICAgICAvLyByb2xsYmFjayBsb2FkZWQgc2V0CiAgICAgICAgICAgICAg\nICBfbG9hZGVkLmFuZE5vdChfc2F2ZWQuZ2V0VW5sb2FkZWQoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlcGxhY2VzIGFsbCBzZWNvbmQgY2xhc3Mgb2JqZWN0IGZpZWxkcyB3aXRo\nIGZyZXNoIHByb3hpZWQgaW5zdGFuY2VzCiAgICAgKiBjb250YWluaW5nIHRo\nZSBzYW1lIGluZm9ybWF0aW9uIGFzIHRoZSBvcmlnaW5hbHMuCiAgICAgKi8K\nICAgIHZvaWQgcHJveHlGaWVsZHMoYm9vbGVhbiByZXNldCwgYm9vbGVhbiBy\nZXBsYWNlTnVsbCkgewogICAgICAgIC8vIHdlIG9ubHkgcmVwbGFjZSBudWxs\ncyBpZiB0aGUgcnVudGltZSBjYW4ndCBkaWZmZXJlbnRpYXRlIGJldHdlZW4K\nICAgICAgICAvLyBudWxsIGFuZCBlbXB0eSBjb250YWluZXJzLiAgd2UgcmVw\nbGFjZSBudWxscyBpbiB0aGlzIGNhc2UgdG8KICAgICAgICAvLyBtYWludGFp\nbiBjb25zaXN0ZW5jeSB3aGV0aGVyIHZhbHVlcyBhcmUgYmVpbmcgcmV0YWlu\nZWQgb3Igbm90CiAgICAgICAgaWYgKHJlcGxhY2VOdWxsKQogICAgICAgICAg\nICByZXBsYWNlTnVsbCA9ICFfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5z\ndXBwb3J0ZWRPcHRpb25zKCkuCiAgICAgICAgICAgICAgICBjb250YWlucyhP\ncGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fTlVMTF9DT05UQUlORVIpOwoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGkpKSB7\nCiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Npbmds\nZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9zaW5nbGUucHJveHko\ncmVzZXQsIHJlcGxhY2VOdWxsKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBfc2luZ2xlLmNs\nZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVbnByb3h5IGFsbCBmaWVsZHMuCiAg\nICAgKi8KICAgIHZvaWQgdW5wcm94eUZpZWxkcygpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfTk9fVU5QUk9YWSkgIT0gMCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7\nIGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxk\nKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnVu\ncHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUucmVsZWFzZUVtYmVk\nZGVkKCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEdldCByZWFkeSBmb3IgYSBmbHVzaC4gUGVyc2lzdHMgYWxsIHBlcnNpc3Rl\nbmNlLWNhcGFibGUgb2JqZWN0IGZpZWxkcywKICAgICAqIGFuZCBjaGVja3Mg\nZm9yIGlsbGVnYWwgbnVsbCB2YWx1ZXMuIEFsc28gYXNzaWducyBvaWRzIGFu\nZCBmaWVsZCB2YWx1ZXMKICAgICAqIGZvciBhbGwgc3RyYXRlZ2llcyB0aGF0\nIGRvbid0IHJlcXVpcmUgZmx1c2hpbmcuCiAgICAgKi8KICAgIHZvaWQgcHJl\nRmx1c2goYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRV9GTFVTSEVEKSAhPSAwKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChpc1BlcnNpc3RlbnQo\nKSkgewogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xl\nRXZlbnQuQkVGT1JFX1NUT1JFKTsKICAgICAgICAgICAgLy8gQkVGT1JFX1BF\nUlNJU1QgaXMgaGFuZGxlZCBkdXJpbmcgQnJva2VyLnBlcnNpc3QgYW5kIEJy\nb2tlci5hdHRhY2gKICAgICAgICAgICAgaWYgKGlzRGVsZXRlZCgpKQogICAg\nICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50\nLkJFRk9SRV9ERUxFVEUpOwogICAgICAgICAgICBlbHNlIGlmICghKGlzTmV3\nKCkgJiYgIWlzRmx1c2hlZCgpKSkKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfVVBEQVRFKTsKICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0ZMVVNIRUQ7CiAgICAgICAg\nfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKCFsb2dpY2FsKQogICAgICAgICAgICAgICAgYXNzaWduT2JqZWN0SWQo\nZmFsc2UsIHRydWUpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVu\nID0gX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmICgobG9naWNhbCB8fCAhYXNzaWduRmllbGQo\naSwgdHJ1ZSkpICYmICFfZmx1c2guZ2V0KGkpCiAgICAgICAgICAgICAgICAg\nICAgJiYgX2RpcnR5LmdldChpKSkgewogICAgICAgICAgICAgICAgICAgIHBy\nb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChfc2luZ2xlLnByZUZsdXNoKGxvZ2ljYWwsIGNhbGwpKQogICAg\nICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xl\nLCBpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGlydHlDaGVjaygpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgY2FsbGJhY2tzIGZvciBk\nZWxldGlvbi4KICAgICAqLwogICAgdm9pZCBwcmVEZWxldGUoKSB7CiAgICAg\nICAgLy8gc2V0IGEgZmxhZyB3aGlsZSBjYWxsIHByZSBkZWxldGUgY2FsbGJh\nY2sgc28gdGhhdCB1c2VyIGNhbid0CiAgICAgICAgLy8gZ2V0IGludG8gaW5m\naW5pdGUgcmVjdXJzaW9uIGJ5IGNhbGxpbmcgZGVsZXRlKHRoaXMpCiAgICAg\nICAgLy8gd2l0aGluIGhpcyBjYWxsYmFjayBtZXRob2QKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfUFJFX0RFTEVUSU5HKSA9PSAwKSB7CiAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZl\nY3ljbGVFdmVudC5CRUZPUkVfREVMRVRFKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVfREVM\nRVRJTkc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDYXNjYWRlIGRlbGV0ZXMgYW5kIGRlcmVmZXJlbmNlIGRlcGVu\nZGVudCBmaWVsZHMuCiAgICAgKi8KICAgIHZvaWQgY2FzY2FkZURlbGV0ZShP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZt\nZHNbaV0uZ2V0Q2FzY2FkZURlbGV0ZSgpICE9IFZhbHVlTWV0YURhdGEuQ0FT\nQ0FERV9OT05FCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEtleSgp\nLmdldENhc2NhZGVEZWxldGUoKQogICAgICAgICAgICAgICAgIT0gVmFsdWVN\nZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAgICAgICAgICAgIHx8IGZtZHNb\naV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVEZWxldGUoKQogICAgICAgICAg\nICAgICAgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpIHsKICAgICAg\nICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChpLCBmZXRjaEZp\nZWxkKGksIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlbGV0\nZShjYWxsKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENh\nbGxlZCBhZnRlciBhbiBpbnN0YW5jZSBpcyBwZXJzaXN0ZWQgYnkgYSB1c2Vy\nIHRocm91Z2ggdGhlIGJyb2tlci4KICAgICAqIENhc2NhZGVzIHRoZSBwZXJz\naXN0IG9wZXJhdGlvbiB0byBmaWVsZHMgbWFya2VkCiAgICAgKiB7QGxpbmsg\nVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lNTUVESUFURX0uCiAgICAgKi8KICAg\nIHZvaWQgY2FzY2FkZVBlcnNpc3QoT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdl\ndENhc2NhZGVQZXJzaXN0KCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lN\nTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRLZXkoKS5n\nZXRDYXNjYWRlUGVyc2lzdCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBm\nbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlUGVyc2lzdCgpCiAgICAg\nICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRF\nKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQo\naSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgX3Np\nbmdsZS5wZXJzaXN0KGNhbGwpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5j\nbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gZmllbGQgc2V0IGZyb20gdGhlIGRh\ndGEgc3RvcmUgaW50byB0aGUgaW5zdGFuY2UuCiAgICAgKiBSZXR1cm4gdHJ1\nZSBpZiBhbnkgZGF0YSBpcyBsb2FkZWQsIGZhbHNlIG90aGVyd2lzZS4KICAg\nICAqLwogICAgYm9vbGVhbiBsb2FkRmllbGRzKEJpdFNldCBmaWVsZHMsIEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwKICAgICAg\nICBPYmplY3Qgc2RhdGEsIGJvb2xlYW4gZm9yV3JpdGUpIHsKICAgICAgICAv\nLyBjYW4ndCBsb2FkIHZlcnNpb24gZmllbGQgZnJvbSBzdG9yZQogICAgICAg\nIGlmIChmaWVsZHMgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhIHZmaWVsZCA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAg\nICAgICBpZiAodmZpZWxkICE9IG51bGwpCiAgICAgICAgICAgICAgICBmaWVs\nZHMuY2xlYXIodmZpZWxkLmdldEluZGV4KCkpOwogICAgICAgIH0KCiAgICAg\nICAgYm9vbGVhbiByZXQgPSBmYWxzZTsKICAgICAgICBzZXRMb2FkaW5nKHRy\ndWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIGFueSBmaWVs\nZHMgZ2l2ZW4sIGxvYWQgdGhlbQogICAgICAgICAgICBpbnQgbGVuID0gKGZp\nZWxkcyA9PSBudWxsKSA/IDAgOiBmaWVsZHMubGVuZ3RoKCk7CiAgICAgICAg\nICAgIGlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2gg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIu\nZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAo\nIV9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkubG9hZCh0aGlzLCBmaWVsZHMs\nIGZldGNoLAogICAgICAgICAgICAgICAgICAgIGxvY2tMZXZlbCwgc2RhdGEp\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZv\ndW5kRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZWwtaW5zdGFuY2UiLAogICAgICAg\nICAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIF9v\naWQpKS4KICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0\nKGdldE1hbmFnZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIG1ha2Ugc3VyZSB2ZXJzaW9uIGluZm9ybWF0aW9uIGhhcyBi\nZWVuIHNldDsgdmVyc2lvbiBpbmZvIG11c3QKICAgICAgICAgICAgLy8gYWx3\nYXlzIGJlIHNldCBhZnRlciB0aGUgZmlyc3Qgc3RhdGUgbG9hZCBvciBzZXQg\nKHdoaWNoIGlzIHdoeQogICAgICAgICAgICAvLyB3ZSBkbyB0aGlzIGV2ZW4g\naWYgbm8gZmllbGRzIHdlcmUgbG9hZGVkIC0tIGNvdWxkIGJlIHRoYXQgdGhp\ncwogICAgICAgICAgICAvLyBtZXRob2QgaXMgYmVpbmcgY2FsbGVkIGFmdGVy\nIGEgZmllbGQgaXMgc2V0KS4uLiBzb21lIGluc3RhbmNlcwogICAgICAgICAg\nICAvLyBtaWdodCBub3QgaGF2ZSB2ZXJzaW9uIGluZm8sIGluIHdoaWNoIGNh\nc2UgdGhpcyBnZXRzIGNhbGxlZAogICAgICAgICAgICAvLyBtdXRpcGxlIHRp\nbWVzOyB0aGF0IHNob3VsZCBiZSBvayB0b28KICAgICAgICAgICAgaWYgKF9s\nb2FkVmVyc2lvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzeW5jVmVy\nc2lvbihzZGF0YSk7CiAgICAgICAgICAgICAgICByZXQgPSByZXQgfHwgX2xv\nYWRWZXJzaW9uICE9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2Up\nOwogICAgICAgIH0KCiAgICAgICAgLy8gc2VlIGlmIHRoZSBkZmcgaXMgbm93\nIGxvYWRlZDsgZG8gdGhpcyByZWdhcmRsZXNzIG9mIHdoZXRoZXIgd2UKICAg\nICAgICAvLyBsb2FkZWQgYW55IGZpZWxkcywgY2F1c2UgbWF5IGFscmVhZHkg\naGF2ZSBiZWVuIGxvYWRlZCBieQogICAgICAgIC8vIFN0b3JlTWFuYWdlciBk\ndXJpbmcgaW5pdGlhbGl6YXRpb24KICAgICAgICBwb3N0TG9hZCgtMSwgZmV0\nY2gpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBMb2FkIHRoZSBnaXZlbiBmaWVsZCdzIGZldGNoIGdyb3VwOyB0aGUgZmll\nbGQgaXRzZWxmIG1heSBhbHJlYWR5IGJlCiAgICAgKiBsb2FkZWQgaWYgaXQg\naXMgYmVpbmcgc2V0IGJ5IHRoZSB1c2VyLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBsb2FkRmllbGQoaW50IGZpZWxkLCBpbnQgbG9ja0xldmVsLCBi\nb29sZWFuIGZvcldyaXRlLAogICAgICAgIGJvb2xlYW4gZmdzKSB7CiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0gX2Jyb2tlci5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBCaXRTZXQgZmllbGRz\nID0gbnVsbDsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGRmZyBmaWVsZCBv\nciB3ZSBuZWVkIHRvIGxvYWQgb3VyIGRmZywgZG8gc28KICAgICAgICBpZiAo\nZmdzICYmIChfZmxhZ3MgJiBGTEFHX0xPQURFRCkgPT0gMCkKICAgICAgICAg\nICAgZmllbGRzID0gZ2V0VW5sb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9G\nR1MsIG51bGwpOwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGZvciBsb2Fk\nIGZldGNoIGdyb3VwCiAgICAgICAgU3RyaW5nIGxmZyA9IGZtZC5nZXRMb2Fk\nRmV0Y2hHcm91cCgpOwogICAgICAgIGJvb2xlYW4gbGZnQWRkZWQgPSBmYWxz\nZTsKICAgICAgICBpZiAobGZnICE9IG51bGwpIHsgIAogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkgJiYgKGkg\nPT0gZmllbGQKICAgICAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmlzSW5G\nZXRjaEdyb3VwKGxmZykpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZp\nZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMg\nPSBuZXcgQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAg\nICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyByZWxhdGlvbiBmaWVsZCBpcyBsb2FkZWQg\nd2l0aCB0aGUgbG9hZC1mZXRjaC1ncm91cAogICAgICAgICAgICAvLyBidXQg\ndGhpcyBhZGRpdGlvbiBtdXN0IGJlIHJldmVydGVkIG9uY2UgdGhlIGxvYWQg\naXMgb3ZlcgogICAgICAgICAgICBpZiAoIWZldGNoLmhhc0ZldGNoR3JvdXAo\nbGZnKSkgewogICAgICAgICAgICAgICAgZmV0Y2guYWRkRmV0Y2hHcm91cChs\nZmcpOwogICAgICAgICAgICAgICAgbGZnQWRkZWQgPSB0cnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChmbWQuaXNJbkRlZmF1bHRGZXRj\naEdyb3VwKCkgJiYgZmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgLy8g\nbm8gbG9hZCBncm91cCBidXQgZGZnOiBhZGQgZGZnIGZpZWxkcyBpZiB3ZSBo\nYXZlbid0IGFscmVhZHkKICAgICAgICAgICAgZmllbGRzID0gZ2V0VW5sb2Fk\nZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9GR1MsIG51bGwpOwogICAgICAgIH0g\nZWxzZSBpZiAoIV9sb2FkZWQuZ2V0KGZtZC5nZXRJbmRleCgpKSkgewogICAg\nICAgICAgICAvLyBubyBsb2FkIGdyb3VwIG9yIGRmZzogbG9hZCBpbmRpdmlk\ndWFsIGZpZWxkCiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGZpZWxkcyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICAg\nICAgZmllbGRzLnNldChmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBjYWxsIHRoaXMgbWV0aG9kIGV2ZW4gaWYgdGhlcmUgYXJlIG5v\nIHVubG9hZGVkIGZpZWxkczsgbG9hZEZpZWxkcwogICAgICAgIC8vIHRha2Vz\nIGNhcmUgb2YgdGhpbmdzIGxpa2UgbG9hZGluZyB2ZXJzaW9uIGluZm8gYW5k\nIHNldHRpbmcgUEMgZmxhZ3MKICAgICAgICB0cnkgewogICAgICAgICAgICBs\nb2FkRmllbGRzKGZpZWxkcywgZmV0Y2gsIGxvY2tMZXZlbCwgbnVsbCwgZm9y\nV3JpdGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChs\nZmdBZGRlZCkKICAgICAgICAgICAgICAgIGZldGNoLnJlbW92ZUZldGNoR3Jv\ndXAobGZnKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHByb3ZpZGUgdGhlIGdpdmVuIGZpZWxkIG51bWJlciB0\nbyB0aGUgZ2l2ZW4KICAgICAqIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAg\nIHZvaWQgcHJvdmlkZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgRmll\nbGRNYW5hZ2VyIHN0b3JlLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1h\nbmFnZXIgYmVmb3JlRk0gPSBfZm07CiAgICAgICAgX2ZtID0gc3RvcmU7CiAg\nICAgICAgcGMucGNQcm92aWRlRmllbGQoZmllbGQpOwogICAgICAgIC8vIFJl\ndGFpbmluZyBvcmlnaW5hbCBGTSBiZWNhdXNlIG9mIHRoZSBwb3NzaWJpbGl0\neSBvZiByZWVudHJhbnQgY2FsbHMKICAgICAgICBfZm0gPSBiZWZvcmVGTTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmVwbGFj\nZSB0aGUgZ2l2ZW4gZmllbGQgbnVtYmVyIHRvIHRoZSBnaXZlbgogICAgICog\nZmllbGQgbWFuYWdlci4KICAgICAqLwogICAgdm9pZCByZXBsYWNlRmllbGQo\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBGaWVsZE1hbmFnZXIgbG9hZCwgaW50\nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNYW5hZ2VyIGJlZm9yZUZNID0gX2Zt\nOwogICAgICAgIF9mbSA9IGxvYWQ7CiAgICAgICAgcGMucGNSZXBsYWNlRmll\nbGQoZmllbGQpOwogICAgICAgIC8vIFJldGFpbmluZyBvcmlnaW5hbCBGTSBi\nZWNhdXNlIG9mIHRoZSBwb3NzaWJpbGl0eSBvZiByZWVudHJhbnQgY2FsbHMK\nICAgICAgICBfZm0gPSBiZWZvcmVGTTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1hcmsgdGhlIGZpZWxkIGFzIGxvYWRlZCBvciB1bmxvYWRlZC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNldExvYWRlZChpbnQgZmllbGQsIGJvb2xl\nYW4gaXNMb2FkZWQpIHsKICAgICAgICAvLyBkb24ndCBjb250aW51ZSBpZiBs\nb2FkZWQgc3RhdGUgaXMgYWxyZWFkeSBjb3JyZWN0OyBvdGhlcndpc2Ugd2UK\nICAgICAgICAvLyBjYW4gZW5kIHVwIGNsZWFyaW5nIF9maWVsZEltcGwgd2hl\nbiB3ZSBzaG91bGRuJ3QKICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQp\nID09IGlzTG9hZGVkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8v\nIGlmIGxvYWRpbmcsIGNsZWFyIGludGVybWVkaWF0ZSBkYXRhOyBpZiB1bmxv\nYWRpbmcsIGNsZWFyIGltcGwgZGF0YQogICAgICAgIGlmIChfZmllbGRJbXBs\nICE9IG51bGwpIHsKICAgICAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4\ndHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwogICAgICAgICAgICBpZiAoaWR4\nICE9IC0xKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIGlmIChpc0xvYWRlZCkKICAgICAgICAg\nICAgX2xvYWRlZC5zZXQoZmllbGQpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2xvYWRlZC5jbGVhcihmaWVsZCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQZXJmb3JtIHBvc3QtbG9hZCBzdGVwcywgaW5jbHVkaW5nIHRoZSBwb3N0\nIGxvYWQgY2FsbGJhY2suCiAgICAgKiBXZSBoYXZlIHRvIGNoZWNrIHRoZSBk\nZmcgYWZ0ZXIgYWxsIGZpZWxkIGxvYWRzIGJlY2F1c2UgaXQgbWlnaHQgYmUK\nICAgICAqIGxvYWRlZCBpbiBtdWx0aXBsZSBzdGVwcyB3aGVuIHBhZ2luZyBp\ncyBpbnZvbHZlZDsgdGhlIGluaXRpYWwgbG9hZAogICAgICogbWlnaHQgZXhj\nbHVkZSBzb21lIGZpZWxkcyB3aGljaCBhcmUgdGhlbiBpbW1lZGlhdGVseSBs\nb2FkZWQgaW4gYQogICAgICogc2VwYXJhdGUgc3RlcCBiZWZvcmUgYmVpbmcg\ncmV0dXJuZWQgdG8gdGhlIHVzZXIuCiAgICAgKgogICAgICogQHBhcmFtIGZp\nZWxkIHRoZSBmaWVsZCBpbmRleCB0aGF0IHdhcyBsb2FkZWQsIG9yIC0xIHRv\nIGluZGljYXRlCiAgICAgKiB0aGF0IGEgZ3JvdXAgb2YgcG9zc2libHkgdW5r\nbm93biBmaWVsZHMgd2FzIGxvYWRlZAogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcG9zdExvYWQoaW50IGZpZWxkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICAvLyBubyBuZWVkIGZvciBwb3N0TG9hZCBjYWxsYmFj\naz8KICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfTE9BREVEKSAhPSAwKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGluIHRoZSBtaWRkbGUg\nb2YgYSBncm91cCBsb2FkLCBhZnRlciB3aGljaCB0aGlzIG1ldGhvZCB3aWxs\nIGJlCiAgICAgICAgLy8gY2FsbGVkIGFnYWluPwogICAgICAgIGlmIChmaWVs\nZCAhPSAtMSAmJiBpc0xvYWRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAvLyBubyBsaXN0ZW5lcnM/CiAgICAgICAgTGlmZWN5Y2xlRXZl\nbnRNYW5hZ2VyIG1nciA9IF9icm9rZXIuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyKCk7CiAgICAgICAgaWYgKG1nciA9PSBudWxsIHx8ICFtZ3IuaGFzTG9h\nZExpc3RlbmVycyhnZXRNYW5hZ2VkSW5zdGFuY2UoKSwgX21ldGEpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQog\nICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgLy8gaXMgdGhpcyBmaWVsZCBhIHBvc3QtbG9hZCBm\naWVsZD8KICAgICAgICBpZiAoZmllbGQgIT0gLTEpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgIGlmIChmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAg\nICAgICAgICAgICAgICAmJiBmZXRjaC5oYXNGZXRjaEdyb3VwKEZldGNoR3Jv\ndXAuTkFNRV9ERUZBVUxUKQogICAgICAgICAgICAgICAgJiYgcG9zdExvYWQo\nRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQsIGZldGNoKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgU3RyaW5nW10gZmdzID0gZm1kLmdl\ndEN1c3RvbUZldGNoR3JvdXBzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKGZldGNoLmhhc0ZldGNoR3JvdXAoZmdzW2ldKSAmJiBwb3N0TG9hZChmZ3Nb\naV0sIGZldGNoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBm\nZXRjaC5nZXRGZXRjaEdyb3VwcygpLml0ZXJhdG9yKCk7IAogICAgICAgICAg\nICAgICAgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGlmIChw\nb3N0TG9hZCgoU3RyaW5nKSBpdHIubmV4dCgpLCBmZXRjaCkpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBwb3N0LWxvYWQgYWN0aW9u\ncyBpZiB0aGUgZ2l2ZW4gZmV0Y2ggZ3JvdXAgaXMgYSBwb3N0LWxvYWQgZ3Jv\ndXAKICAgICAqIGFuZCBpcyBmdWxseSBsb2FkZWQuCiAgICAgKi8KICAgIHBy\naXZhdGUgYm9vbGVhbiBwb3N0TG9hZChTdHJpbmcgZmdOYW1lLCBGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBGZXRjaEdyb3VwIGZnID0g\nX21ldGEuZ2V0RmV0Y2hHcm91cChmZ05hbWUpOwogICAgICAgIGlmIChmZyA9\nPSBudWxsIHx8ICFmZy5pc1Bvc3RMb2FkKCkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQo\naSkgJiYgZm1kc1tpXS5pc0luRmV0Y2hHcm91cChmZ05hbWUpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19MT0FERUQ7CiAgICAgICAgX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQo\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIGZldGNoLCBfbWV0YSwgCiAgICAgICAg\nCUxpZmVjeWNsZUV2ZW50LkFGVEVSX0xPQUQpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogU3luY2hyb25pemUgb3VyIHZl\ncnNpb24gb2JqZWN0IHdpdGggdGhlIGRhdGFzdG9yZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIHN5bmNWZXJzaW9uKE9iamVjdCBzZGF0YSkgewog\nICAgICAgIHJldHVybiBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLnN5bmNW\nZXJzaW9uKHRoaXMsIHNkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgd2hldGhlciB0aGlzIGluc3RhbmNlIG5lZWRzIGEgdmVyc2lvbiBj\naGVjay4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uQ2hl\nY2tSZXF1aXJlZCgpIHsKICAgICAgICAvLyBleHBsaWNpdCBmbGFnIGZvciB2\nZXJzaW9uIGNoZWNrCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1ZFUlNJ\nT05fQ0hFQ0spICE9IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAg\nICAgICBpZiAoIV9icm9rZXIuZ2V0T3B0aW1pc3RpYygpICYmICFfYnJva2Vy\nLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0Q29tcGF0aWJp\nbGl0eUluc3RhbmNlKCkuZ2V0Tm9uT3B0aW1pc3RpY1ZlcnNpb25DaGVjaygp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9z\ndGF0ZS5pc1ZlcnNpb25DaGVja1JlcXVpcmVkKHRoaXMpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHdoZXRoZXIgdGhpcyBpbnN0YW5jZSByZXF1aXJl\ncyBhIHZlcnNpb24gY2hlY2sgb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8K\nICAgIHZvaWQgc2V0Q2hlY2tWZXJzaW9uKGJvb2xlYW4gdmVyc2lvbkNoZWNr\nKSB7CiAgICAgICAgaWYgKHZlcnNpb25DaGVjaykKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfVkVSU0lPTl9DSEVDSzsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19WRVJTSU9OX0NIRUNLOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB3aGV0aGVyIHRoaXMgaW5zdGFuY2Ug\nbmVlZHMgYSB2ZXJzaW9uIHVwZGF0ZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaXNWZXJzaW9uVXBkYXRlUmVxdWlyZWQoKSB7CiAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBGTEFHX1ZFUlNJT05fVVBEQVRFKSA+IDA7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJl\ncXVpcmVzIGEgdmVyc2lvbiB1cGRhdGUgb24gdGhlIG5leHQgZmx1c2guCiAg\nICAgKi8KICAgIHZvaWQgc2V0VXBkYXRlVmVyc2lvbihib29sZWFuIHZlcnNp\nb25VcGRhdGUpIHsKICAgICAgICBpZiAodmVyc2lvblVwZGF0ZSkKICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfVkVSU0lPTl9VUERBVEU7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9VUERB\nVEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2xhdGUgdGhlIGdpdmVu\nIGV4Y2VwdGlvbiBiYXNlZCBvbiB0aGUgYnJva2VyJ3MgaW1wbGljaXQgYmVo\nYXZpb3IuCiAgICAgKiBUcmFuc2xhdGlvbiBvbmx5IG9jY3VycyBpZiB0aGUg\nZXhjZXB0aW9uIGlzIGluaXRpYXRlZCBieSBhIHVzZXIgYWN0aW9uCiAgICAg\nKiBvbiBhbiBpbnN0YW5jZSwgYW5kIHRoZXJlZm9yZSB3aWxsIG5vdCBiZSBj\nYXVnaHQgYW5kIHRyYW5zbGF0ZWQgYnkgdGhlCiAgICAgKiBicm9rZXIuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBSdW50aW1lRXhjZXB0aW9uIHRyYW5zbGF0\nZShSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgUnVudGltZUV4Y2Vw\ndGlvblRyYW5zbGF0b3IgdHJhbnMgPSBfYnJva2VyLgogICAgICAgICAgICBn\nZXRJbnN0YW5jZUV4Y2VwdGlvblRyYW5zbGF0b3IoKTsKICAgICAgICByZXR1\ncm4gKHRyYW5zID09IG51bGwpID8gcmUgOiB0cmFucy50cmFuc2xhdGUocmUp\nOwogICAgfQoKICAgIC8qKgogICAgICogTG9jayB0aGUgc3RhdGUgbWFuYWdl\nciBpZiB0aGUgbXVsdGl0aHJlYWRlZCBvcHRpb24gaXMgc2V0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBsb2NrKCkgewogICAgICAgIC8vIHVzZSBi\ncm9rZXItbGV2ZWwgbG9jayB0byBhdm9pZCBkZWFkbG9jayBzaXR1YXRpb25z\nIHdpdGggdGhlIHN0YXRlCiAgICAgICAgLy8gbWFuYWdlciBsb2NrIGFuZCBi\ncm9rZXIgbG9jayBiZWluZyBvYnRhaW5lZCBpbiBkaWZmZXJlbnQgb3JkZXJz\nCiAgICAgICAgX2Jyb2tlci5sb2NrKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBVbmxvY2sgdGhlIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KCXByb3RlY3Rl\nZCB2b2lkIHVubG9jayAoKQoJewoJCS8vIHVzZSBicm9rZXItbGV2ZWwgbG9j\nayB0byBhdm9pZCBkZWFkbG9jayBzaXR1YXRpb25zIHdpdGggdGhlIHN0YXRl\nIAoJCS8vIG1hbmFnZXIgbG9jayBhbmQgYnJva2VyIGxvY2sgYmVpbmcgb2J0\nYWluZWQgaW4gZGlmZmVyZW50IG9yZGVycwoJCV9icm9rZXIudW5sb2NrICgp\nOwoJfQp9Cg==\n","encoding":"base64"}

