{"sha":"7fa741f7b5d2a19b50f590ef56cfda581c2c6794","node_id":"MDQ6QmxvYjIwNjM2NDo3ZmE3NDFmN2I1ZDJhMTliNTBmNTkwZWY1NmNmZGE1ODFjMmM2Nzk0","size":14990,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7fa741f7b5d2a19b50f590ef56cfda581c2c6794","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0\naWNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lkxp\nZmVjeWNsZUV2ZW50OwoKLyoqCiAqIEhhbmRsZXMgYXR0YWNoaW5nIGluc3Rh\nbmNlcyB1c2luZyB2ZXJzaW9uIGFuZCBwcmltYXJ5IGtleSBmaWVsZHMuCiAq\nCiAqIEBub2phdmFkb2MKICogQGF1dGhvciBTdGV2ZSBLaW0KICovCmNsYXNz\nIFZlcnNpb25BdHRhY2hTdHJhdGVneQogICAgZXh0ZW5kcyBBdHRhY2hTdHJh\ndGVneQogICAgaW1wbGVtZW50cyBEZXRhY2hTdGF0ZSB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChWZXJzaW9uQXR0YWNoU3RyYXRlZ3kuY2xhc3Mp\nOwoKICAgIHByb3RlY3RlZCBPYmplY3QgZ2V0RGV0YWNoZWRPYmplY3RJZChB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgT2JqZWN0IHRvQXR0YWNo\nKSB7CiAgICAgICAgQnJva2VyIGJyb2tlciA9IG1hbmFnZXIuZ2V0QnJva2Vy\nKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKS5nZXRNZXRhRGF0YSgKICAgICAgICAgICAgICAgIElt\ncGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKHRvQXR0YWNoKS5nZXRDbGFz\ncygpLAogICAgICAgICAgICAgICAgYnJva2VyLmdldENsYXNzTG9hZGVyKCks\nIHRydWUpOwogICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5jcmVhdGUo\nSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh0b0F0dGFjaCwKICAg\nICAgICAgICAgYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKSksCiAgICAgICAg\nICAgIG1ldGEpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHByb3ZpZGVG\naWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdlckltcGwgc20sCiAg\nICAgICAgaW50IGZpZWxkKSB7CiAgICAgICAgc20ucHJvdmlkZUZpZWxkKElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodG9BdHRhY2gsCiAgICAg\nICAgICAgIHNtLmdldENvbnRleHQoKS5nZXRDb25maWd1cmF0aW9uKCkpLCB0\naGlzLCBmaWVsZCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBhdHRhY2go\nQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gsCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFibGUgaW50\nbywgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwKICAgICAgICBWYWx1ZU1l\ndGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCkgewoKICAgICAg\nICAvLyBWZXJzaW9uQXR0YWNoU3RyYXRlZ3kgaXMgaW52b2tlZCBpbiB0aGUg\nY2FzZSB3aGVyZSBubyBtb3JlCiAgICAgICAgLy8gaW50ZWxsaWdlbnQgc3Ry\nYXRlZ3kgY291bGQgYmUgZm91bmQ7IGxldCdzIGJlIG1vcmUgbGVuaWVudAog\nICAgICAgIC8vIGFib3V0IG5ldyB2cy4gZGV0YWNoZWQgcmVjb3JkIGRldGVy\nbWluYXRpb24uCiAgICAgICAgaWYgKGludG8gPT0gbnVsbCkKICAgICAgICAg\nICAgaW50byA9IGZpbmRGcm9tRGF0YWJhc2UobWFuYWdlciwgdG9BdHRhY2gp\nOwoKICAgICAgICBCcm9rZXJJbXBsIGJyb2tlciA9IG1hbmFnZXIuZ2V0QnJv\na2VyKCk7CiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhl\nbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh0b0F0dGFjaCwKICAgICAgICAg\nICAgbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpKTsK\nCiAgICAgICAgYm9vbGVhbiBlbWJlZGRlZCA9IG93bmVyTWV0YSAhPSBudWxs\nICYmIG93bmVyTWV0YS5pc0VtYmVkZGVkUEMoKTsKICAgICAgICBib29sZWFu\nIGlzTmV3ID0gIWJyb2tlci5pc0RldGFjaGVkKHBjKSAmJiBpbnRvID09IG51\nbGw7CiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBudWxsOwogICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc207CgogICAgICAgIC8vIGlmIHRoZSBzdGF0ZSBt\nYW5hZ2VyIGZvciB0aGUgZW1iZWRkZWQgaW5zdGFuY2UgaXMgbnVsbCwgdGhl\nbgogICAgICAgIC8vIGl0IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbmV3IGlu\nc3RhbmNlIChzaW5jZSB0aGUKICAgICAgICAvLyBuZXdseSBwZXJzaXN0ZWQg\nb3duZXIgbWF5IGNyZWF0ZSBhIG5ldyBlbWJlZGRlZCBpbnN0YW5jZQogICAg\nICAgIC8vIGluIHRoZSBjb25zdHJ1Y3Rvcik7IGZpeGVkIGJ1ZyAjMTA3NS4K\nICAgICAgICAvLyBhbHNvLCBpZiB0aGUgdXNlciBoYXMgYXR0YWNoZWQgYSBk\nZXRhY2hlZCBvYmogZnJvbSBzb21ld2hlcmUKICAgICAgICAvLyBlbHNlIGlu\nIHRoZSBncmFwaCB0byBhbiBlbWJlZGRlZCBmaWVsZCB0aGF0IHdhcyBwcmV2\naW91c2x5IG51bGwsCiAgICAgICAgLy8gY29weSBpbnRvIGEgbmV3IGVtYmVk\nZGVkIGluc3RhbmNlCiAgICAgICAgaWYgKGVtYmVkZGVkICYmIChpc05ldyB8\nfCBpbnRvID09IG51bGwKICAgICAgICAgICAgfHwgYnJva2VyLmdldFN0YXRl\nTWFuYWdlcihpbnRvKSA9PSBudWxsKSkgewogICAgICAgICAgICBpZiAoaW50\nbyA9PSBudWxsKQogICAgICAgICAgICAgICAgaW50byA9IHBjLnBjTmV3SW5z\ndGFuY2UobnVsbCwgZmFsc2UpOwogICAgICAgICAgICBzbSA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBicm9rZXIuZW1iZWQoaW50bywgbnVsbCwgb3duZXIsIG93\nbmVyTWV0YSk7CiAgICAgICAgICAgIGludG8gPSBzbS5nZXRQZXJzaXN0ZW5j\nZUNhcGFibGUoKTsKICAgICAgICB9IGVsc2UgaWYgKGlzTmV3KSB7CiAgICAg\nICAgICAgIHNtID0gcGVyc2lzdChtYW5hZ2VyLCBwYywgbWV0YSwgQXBwbGlj\nYXRpb25JZHMuY3JlYXRlKHBjLCBtZXRhKSwKICAgICAgICAgICAgICAgIGV4\ncGxpY2l0KTsKICAgICAgICAgICAgaW50byA9IHNtLmdldFBlcnNpc3RlbmNl\nQ2FwYWJsZSgpOwogICAgICAgIH0gZWxzZSBpZiAoIWVtYmVkZGVkICYmIGlu\ndG8gPT0gbnVsbCkgewogICAgICAgICAgICBPYmplY3QgaWQgPSBnZXREZXRh\nY2hlZE9iamVjdElkKG1hbmFnZXIsIHRvQXR0YWNoKTsKICAgICAgICAgICAg\naWYgKGlkICE9IG51bGwpCiAgICAgICAgICAgICAgICBpbnRvID0KICAgICAg\nICAgICAgICAgICAgICBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxl\nKGJyb2tlci5maW5kKGlkLCB0cnVlLCBudWxsKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAg\nICAgIGlmIChpbnRvID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihfbG9jLmdldCgiYXR0YWNoLXZlcnNp\nb24tZGVsIiwKICAgICAgICAgICAgICAgICAgICBJbXBsSGVscGVyLmdldE1h\nbmFnZWRJbnN0YW5jZShwYykuZ2V0Q2xhc3MoKSwgaWQsIHZlcnNpb24pKQog\nICAgICAgICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3QodG9BdHRhY2gp\nOwoKICAgICAgICAgICAgc20gPSBtYW5hZ2VyLmFzc2VydE1hbmFnZWQoaW50\nbyk7CiAgICAgICAgICAgIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKQog\nICAgICAgICAgICAgICAgIT0gc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmli\nZWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3RO\nb3RGb3VuZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICgiYXR0YWNoLXdyb25nY2xhc3MiLCBpZCwgdG9BdHRhY2guZ2V0Q2xhc3Mo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKS5n\nZXREZXNjcmliZWRUeXBlKCkpKS4KICAgICAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QodG9BdHRhY2gpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgIHNtID0gbWFuYWdlci5hc3NlcnRNYW5hZ2Vk\nKGludG8pOwoKICAgICAgICAvLyBtYXJrIHRoYXQgd2UgYXR0YWNoZWQgdGhl\nIGluc3RhbmNlICpiZWZvcmUqIHdlCiAgICAgICAgLy8gZmlsbCBpbiB2YWx1\nZXMgdG8gYXZvaWQgZW5kbGVzcyByZWN1cnNpb24KICAgICAgICBtYW5hZ2Vy\nLnNldEF0dGFjaGVkQ29weSh0b0F0dGFjaCwgaW50byk7CgogICAgICAgIC8v\nIGlmIHBlcnNpc3RpbmcgaW4gcGxhY2UsIGp1c3QgYXR0YWNoIGZpZWxkIHZh\nbHVlcwogICAgICAgIGlmIChwYyA9PSBpbnRvKSB7CiAgICAgICAgICAgIGF0\ndGFjaEZpZWxkc0luUGxhY2UobWFuYWdlciwgc20pOwogICAgICAgICAgICBy\nZXR1cm4gaW50bzsKICAgICAgICB9CgogICAgICAgIGlmIChpc05ldykgewog\nICAgICAgICAgICBicm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50KHRvQXR0YWNo\nLCBudWxsLCBtZXRhLAogICAgICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQu\nQkVGT1JFX1BFUlNJU1QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIC8vIGludm9rZSBhbnkgcHJlQXR0YWNoIG9uIHRoZSBkZXRhY2hlZCBpbnN0\nYW5jZQogICAgICAgICAgICBtYW5hZ2VyLmZpcmVCZWZvcmVBdHRhY2godG9B\ndHRhY2gsIG1ldGEpOwogICAgICAgIH0KCiAgICAgICAgLy8gYXNzaWduIHRo\nZSBkZXRhY2hlZCBwYyB0aGUgc2FtZSBzdGF0ZSBtYW5hZ2VyIGFzIHRoZSBv\nYmplY3Qgd2UncmUKICAgICAgICAvLyBjb3B5aW5nIGludG8gZHVyaW5nIHRo\nZSBhdHRhY2ggcHJvY2VzcwogICAgICAgIFN0YXRlTWFuYWdlciBzbUJlZm9y\nZSA9IHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgcGMucGNSZXBs\nYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICBpbnQgZGV0YWNoID0gKGlz\nTmV3KSA/IERFVEFDSF9BTEwgOiBicm9rZXIuZ2V0RGV0YWNoU3RhdGUoKTsK\nICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBicm9rZXIuZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldEZpZWxkcygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZGV0YWNoKSB7CiAgICAg\nICAgICAgICAgICAgICAgY2FzZSBERVRBQ0hfQUxMOgogICAgICAgICAgICAg\nICAgICAgICAgICBhdHRhY2hGaWVsZChtYW5hZ2VyLCB0b0F0dGFjaCwgc20s\nIGZtZHNbaV0sIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICBjYXNlIERFVEFDSF9GRVRDSF9HUk9V\nUFM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaC5yZXF1aXJl\nc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX05PTkUpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBhdHRhY2hGaWVsZChtYW5hZ2VyLCB0b0F0dGFj\naCwgc20sIGZtZHNbaV0sIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIERFVEFDSF9MT0FE\nRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaEZpZWxkKG1hbmFn\nZXIsIHRvQXR0YWNoLCBzbSwgZm1kc1tpXSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHBjLnBj\nUmVwbGFjZVN0YXRlTWFuYWdlcihzbUJlZm9yZSk7CiAgICAgICAgfQogICAg\nICAgIGlmICghZW1iZWRkZWQgJiYgIWlzTmV3KQogICAgICAgICAgICBjb21w\nYXJlVmVyc2lvbihzbSwgcGMpOwogICAgICAgIHJldHVybiBJbXBsSGVscGVy\nLmdldE1hbmFnZWRJbnN0YW5jZShpbnRvKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE1ha2Ugc3VyZSB0aGUgdmVyc2lvbiBpbmZvcm1hdGlvbiBpcyBjb3Jy\nZWN0IGluIHRoZSBkZXRhY2hlZCBvYmplY3QuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBjb21wYXJlVmVyc2lvbihTdGF0ZU1hbmFnZXJJbXBsIHNtLCBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMpIHsKICAgICAgICBPYmplY3QgdmVyc2lv\nbiA9IHBjLnBjR2V0VmVyc2lvbigpOwogICAgICAgIGlmICh2ZXJzaW9uID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZG9uJ3Qg\nbmVlZCB0byBsb2FkIHVubG9hZGVkIGZpZWxkcyBzaW5jZSBpdHMgaW1wbGlj\naXRseQogICAgICAgIC8vIGEgc2luZ2xlIGZpZWxkIHZhbHVlCiAgICAgICAg\nU3RvcmVNYW5hZ2VyIHN0b3JlID0gc20uZ2V0QnJva2VyKCkuZ2V0U3RvcmVN\nYW5hZ2VyKCk7CiAgICAgICAgc3dpdGNoIChzdG9yZS5jb21wYXJlVmVyc2lv\nbihzbSwgdmVyc2lvbiwgc20uZ2V0VmVyc2lvbigpKSkgewogICAgICAgICAg\nICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0xBVEVSOgogICAgICAgICAg\nICAgICAgLy8gd2UgaGF2ZSBhIGxhdGVyIHZlcnNpb246IHNldCBpdCBpbnRv\nIHRoZSBvYmplY3QuCiAgICAgICAgICAgICAgICAvLyBsb2NrIHZhbGlkYXRp\nb24gd2lsbCBvY2N1ciBhdCBjb21taXQgdGltZQogICAgICAgICAgICAgICAg\nc20uc2V0VmVyc2lvbih2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0VBUkxJ\nRVI6CiAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJT05fRElG\nRkVSRU5UOgogICAgICAgICAgICAgICAgc20uc2V0VmVyc2lvbih2ZXJzaW9u\nKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPcHRpbWlzdGljRXhjZXB0\naW9uKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgY2Fz\nZSBTdG9yZU1hbmFnZXIuVkVSU0lPTl9TQU1FOgogICAgICAgICAgICAgICAg\nLy8gbm8gYWN0aW9uIHJlcXVpcmVkCiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGZp\nZWxkcyBvZiBhbiBpbi1wbGFjZSBwZXJzaXN0ZWQgaW5zdGFuY2UuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhdHRhY2hGaWVsZHNJblBsYWNlKEF0dGFj\naE1hbmFnZXIgbWFuYWdlciwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRh\nRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tp\nXS5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVS\nU0lTVEVOVCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgT2JqZWN0IGN1ciwgYXR0YWNoZWQ7CiAgICAgICAgICAgIHN3aXRjaCAo\nZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICBjdXIg\nPSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAgICAgICAg\nIGF0dGFjaGVkID0gYXR0YWNoSW5QbGFjZShtYW5hZ2VyLCBzbSwgZm1kc1tp\nXSwgY3VyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAg\nICAgIGlmICghZm1kc1tpXS5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQ\nQygpKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgICAgICAgICBjdXIgPSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwog\nICAgICAgICAgICAgICAgICAgIGF0dGFjaGVkID0KICAgICAgICAgICAgICAg\nICAgICAgICAgYXR0YWNoSW5QbGFjZShtYW5hZ2VyLCBzbSwgZm1kc1tpXSwg\nKE9iamVjdFtdKSBjdXIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAg\nICAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0RWxlbWVudCgpLmlz\nRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgY3VyID0gc20uZmV0Y2hPYmpl\nY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgICAgICBhdHRhY2hlZCA9IGF0\ndGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZHNbaV0sCiAgICAgICAgICAg\nICAgICAgICAgICAgIChDb2xsZWN0aW9uKSBjdXIpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgICAgIGlmICghZm1kc1tpXS5nZXRFbGVt\nZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpCiAgICAgICAgICAgICAgICAgICAg\nICAgICYmICFmbWRzW2ldLmdldEtleSgpLmlzRGVjbGFyZWRUeXBlUEMoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg\nICAgICAgICAgY3VyID0gc20uZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAg\nICAgICAgICAgICAgICBhdHRhY2hlZCA9IGF0dGFjaEluUGxhY2UobWFuYWdl\nciwgc20sIGZtZHNbaV0sIChNYXApIGN1cik7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoY3VyICE9IGF0dGFjaGVkKQogICAgICAgICAgICAgICAgc20uc2V0\ndGluZ09iamVjdEZpZWxkKHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpLCBp\nLAogICAgICAgICAgICAgICAgICAgIGN1ciwgYXR0YWNoZWQsIFN0YXRlTWFu\nYWdlci5TRVRfUkVNT1RFKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBdHRhY2ggdGhlIGdpdmVuIHBjLgogICAgICovCiAgICBwcml2YXRl\nIE9iamVjdCBhdHRhY2hJblBsYWNlKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwg\nU3RhdGVNYW5hZ2VySW1wbCBzbSwKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZt\nZCwgT2JqZWN0IHBjKSB7CiAgICAgICAgaWYgKHBjID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIE9iamVjdCBhdHRhY2hlZCA9\nIG1hbmFnZXIuZ2V0QXR0YWNoZWRDb3B5KHBjKTsKICAgICAgICBpZiAoYXR0\nYWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGF0dGFjaGVkOwoK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGludG8gPSBtYW5hZ2VyLmdl\ndEJyb2tlcigpLmdldFN0YXRlTWFuYWdlcihwYyk7CiAgICAgICAgUGVyc2lz\ndGVuY2VDYXBhYmxlIGludG9QQyA9IChpbnRvID09IG51bGwpID8gbnVsbAog\nICAgICAgICAgICA6IGludG8uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAg\nICAgICAgaWYgKHZtZC5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIHJldHVy\nbiBtYW5hZ2VyLmF0dGFjaChwYywgaW50b1BDLCBzbSwgdm1kLCBmYWxzZSk7\nCiAgICAgICAgcmV0dXJuIG1hbmFnZXIuYXR0YWNoKHBjLCBpbnRvUEMsIG51\nbGwsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEF0dGFj\naCB0aGUgZ2l2ZW4gYXJyYXkuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0\nW10gYXR0YWNoSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIFN0YXRl\nTWFuYWdlckltcGwgc20sCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQsIE9i\namVjdFtdIGFycikgewogICAgICAgIGlmIChhcnIgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYXJyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBhcnJbaV0gPSBhdHRh\nY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWQuZ2V0RWxlbWVudCgpLCBhcnJb\naV0pOwogICAgICAgIHJldHVybiBhcnI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBdHRhY2ggdGhlIGdpdmVuIGNvbGxlY3Rpb24uCiAgICAgKi8KICAgIHBy\naXZhdGUgQ29sbGVjdGlvbiBhdHRhY2hJblBsYWNlKEF0dGFjaE1hbmFnZXIg\nbWFuYWdlciwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBGaWVsZE1l\ndGFEYXRhIGZtZCwgQ29sbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgaWYgKGNv\nbGwgPT0gbnVsbCB8fCBjb2xsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0\ndXJuIGNvbGw7CgogICAgICAgIC8vIGNvcHkgaWYgZWxlbWVudHMgZW1iZWRk\nZWQgb3IgY29udGFpbnMgZGV0YWNoZWQsIHdoaWNoIHdpbGwgbWVhbgogICAg\nICAgIC8vIHdlJ2xsIGhhdmUgdG8gY29weSB0aGUgZXhpc3RpbmcgZWxlbWVu\ndHMKICAgICAgICBDb2xsZWN0aW9uIGNvcHkgPSBudWxsOwogICAgICAgIGlm\nIChmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAg\nY29weSA9IChDb2xsZWN0aW9uKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJ\nbmRleCgpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBjb2xsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICBpZiAobWFuYWdlci5nZXRCcm9rZXIoKS5pc0Rl\ndGFjaGVkKGl0ci5uZXh0KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29w\neSA9IChDb2xsZWN0aW9uKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJbmRl\neCgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgT2JqZWN0\nIGF0dGFjaGVkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBhdHRh\nY2hlZCA9IGF0dGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZC5nZXRFbGVt\nZW50KCksCiAgICAgICAgICAgICAgICBpdHIubmV4dCgpKTsKICAgICAgICAg\nICAgaWYgKGNvcHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvcHkuYWRk\nKGF0dGFjaGVkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChjb3B5ID09\nIG51bGwpID8gY29sbCA6IGNvcHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ndHRhY2ggdGhlIGdpdmVuIG1hcC4KICAgICAqLwogICAgcHJpdmF0ZSBNYXAg\nYXR0YWNoSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIFN0YXRlTWFu\nYWdlckltcGwgc20sCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQsIE1hcCBt\nYXApIHsKICAgICAgICBpZiAobWFwID09IG51bGwgfHwgbWFwLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIG1hcDsKCiAgICAgICAgTWFwIGNvcHkg\nPSBudWxsOwogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICBib29s\nZWFuIGtleVBDID0gZm1kLmdldEtleSgpLmlzRGVjbGFyZWRUeXBlUEMoKTsK\nICAgICAgICBib29sZWFuIHZhbFBDID0gZm1kLmdldEVsZW1lbnQoKS5pc0Rl\nY2xhcmVkVHlwZVBDKCk7CgogICAgICAgIC8vIGNvcHkgaWYgZW1iZWRkZWQg\ncGNzIG9yIGRldGFjaGVkIHBjcywgd2hpY2ggd2lsbCByZXF1aXJlIHVzIHRv\nCiAgICAgICAgLy8gY29weSBlbGVtZW50cwogICAgICAgIGlmIChmbWQuZ2V0\nS2V5KCkuaXNFbWJlZGRlZFBDKCkgfHwgZm1kLmdldEVsZW1lbnQoKS5pc0Vt\nYmVkZGVkUEMoKSkKICAgICAgICAgICAgY29weSA9IChNYXApIHNtLm5ld0Zp\nZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBl\nbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICBpZiAoKGtleVBDICYmIG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hl\nZChlbnRyeS5nZXRLZXkoKSkpCiAgICAgICAgICAgICAgICAgICAgfHwgKHZh\nbFBDICYmIG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZAogICAgICAg\nICAgICAgICAgICAgIChlbnRyeS5nZXRWYWx1ZSgpKSkpIHsKICAgICAgICAg\nICAgICAgICAgICBjb3B5ID0gKE1hcCkgc20ubmV3RmllbGRQcm94eShmbWQu\nZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIE9iamVjdCBrZXksIHZhbDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAg\nIGlmIChrZXlQQykKICAgICAgICAgICAgICAgIGtleSA9IGF0dGFjaEluUGxh\nY2UobWFuYWdlciwgc20sIGZtZC5nZXRLZXkoKSwga2V5KTsKICAgICAgICAg\nICAgdmFsID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKHZh\nbFBDKQogICAgICAgICAgICAgICAgdmFsID0gYXR0YWNoSW5QbGFjZShtYW5h\nZ2VyLCBzbSwgZm1kLmdldEVsZW1lbnQoKSwgdmFsKTsKICAgICAgICAgICAg\naWYgKGNvcHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvcHkucHV0KGtl\neSwgdmFsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChjb3B5ID09IG51\nbGwpID8gbWFwIDogY29weTsKCX0KCiAgICAvKioKICAgICAqIEZpbmQgYSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2Ugb2YgYW4gT2JqZWN0IGlmIGl0\nIGV4aXN0cyBpbiB0aGUKICAgICAqIGRhdGFiYXNlLiBJZiB0aGUgb2JqZWN0\nIGlzIG51bGwgb3IgY2FuJ3QgYmUgZm91bmQgaW4gdGhlIGRhdGFiYXNlLgog\nICAgICoKICAgICAqIEBwYXJhbSBwYyBBbiBvYmplY3Qgd2hpY2ggd2lsbCBi\nZSBhdHRhY2hlZCBpbnRvIHRoZSBjdXJyZW50IGNvbnRleHQuIFRoZQogICAg\nICogb2JqZWN0IG1heSBvciBtYXkgbm90IGNvcnJlc3BvbmQgdG8gYSByb3cg\naW4gdGhlIGRhdGFiYXNlLgogICAgICoKICAgICAqIEByZXR1cm4gSWYgdGhl\nIG9iamVjdCBpcyBudWxsIG9yIGNhbid0IGJlIGZvdW5kIGluIHRoZSBkYXRh\nYmFzZSB0aGlzCiAgICAgKiBtZXRob2QgcmV0dXJucyBudWxsLiBPdGhlcndp\nc2UgYSBQZXJzaXN0ZW5jZUNhcGFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhl\nCiAgICAgKiBvYmplY3QgaXMgcmV0dXJuZWQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgZmluZEZyb21EYXRhYmFzZShBdHRh\nY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgT2JqZWN0IHBjKSB7CiAgICAg\nICAgT2JqZWN0IG9pZCA9IG1hbmFnZXIuZ2V0QnJva2VyKCkubmV3T2JqZWN0\nSWQocGMuZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgbWFuYWdlci5nZXREZXRh\nY2hlZE9iamVjdElkKHBjKSk7CgogICAgICAgIGlmIChvaWQgIT0gbnVsbCkg\newogICAgICAgICAgICByZXR1cm4gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNl\nQ2FwYWJsZSgKICAgICAgICAgICAgICAgIG1hbmFnZXIuZ2V0QnJva2VyKCku\nZmluZChvaWQsIHRydWUsIG51bGwpLAogICAgICAgICAgICAgICAgbWFuYWdl\nci5nZXRCcm9rZXIoKS5nZXRDb25maWd1cmF0aW9uKCkpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAg\nIH0KfQo=\n","encoding":"base64"}

