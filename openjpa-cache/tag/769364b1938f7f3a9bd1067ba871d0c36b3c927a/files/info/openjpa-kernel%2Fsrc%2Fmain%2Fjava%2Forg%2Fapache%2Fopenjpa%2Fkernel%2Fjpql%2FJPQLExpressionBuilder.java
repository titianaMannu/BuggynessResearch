{"sha":"629e886a6d812be95957b79f71a1fd8becce0bde","node_id":"MDQ6QmxvYjIwNjM2NDo2MjllODg2YTZkODEyYmU5NTk1N2I3OWY3MWExZmQ4YmVjY2UwYmRl","size":59230,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/629e886a6d812be95957b79f71a1fd8becce0bde","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGph\ndmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlDb250ZXh0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWJzdHJhY3RF\neHByZXNzaW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuZXhwcy5FeHByZXNzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25GYWN0b3J5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkxpdGVyYWw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGFyYW1ldGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNz\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5T\ndWJxdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5K\nMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBCdWlsZGVyIGZvciBKUFFMIGV4cHJlc3Np\nb25zLiBUaGlzIGNsYXNzIHRha2VzIHRoZSBxdWVyeSBwYXJzZWQKICogaW4g\ne0BsaW5rIEpQUUx9IGFuZCBjb252ZXJ0cyBpdCB0byBhbiBleHByZXNzaW9u\nIHRyZWUgdXNpbmcKICogYW4ge0BsaW5rIEV4cHJlc3Npb25GYWN0b3J5fS4g\nUHVibGljIGZvciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAqCiAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgUGF0cmljayBMaW5z\na2V5CiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXIKICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNzaW9uQnVp\nbGRlcgogICAgaW1wbGVtZW50cyBKUFFMVHJlZUNvbnN0YW50cyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFZBUl9QQVRIID0gMTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBWQVJfRVJST1IgPSAyOwoKICAgIHBy\naXZhdGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoSlBRTEV4cHJlc3Npb25CdWlsZGVyLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0YWNrIGNvbnRleHRzID0gbmV3IFN0YWNr\nKCk7CiAgICBwcml2YXRlIExpbmtlZE1hcCBwYXJhbWV0ZXJUeXBlczsKICAg\nIHByaXZhdGUgaW50IGFsaWFzQ291bnQgPSAwOwoKICAgIC8qKgogICAgICog\nQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhl\nIGV4cHJlc3Npb24gZmFjdG9yeSB0byB1c2UKICAgICAqIEBwYXJhbSBxdWVy\neSB1c2VkIHRvIHJlc29sdmUgdmFyaWFibGVzLCBwYXJhbWV0ZXJzLAogICAg\nICogYW5kIGNsYXNzIG5hbWVzIHVzZWQgaW4gdGhlIHF1ZXJ5CiAgICAgKiBA\ncGFyYW0gcGFyc2VkUXVlcnkgdGhlIHBhcnNlZCBxdWVyeQogICAgICovCiAg\nICBwdWJsaWMgSlBRTEV4cHJlc3Npb25CdWlsZGVyKEV4cHJlc3Npb25GYWN0\nb3J5IGZhY3RvcnksCiAgICAgICAgRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVl\ncnksIE9iamVjdCBwYXJzZWRRdWVyeSkgewogICAgICAgIHN1cGVyKGZhY3Rv\ncnksIHF1ZXJ5LmdldFJlc29sdmVyKCkpOwoKICAgICAgICBjb250ZXh0cy5w\ndXNoKG5ldyBDb250ZXh0KHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgUGFyc2Vk\nSlBRTAogICAgICAgICAgICA/IChQYXJzZWRKUFFMKSBwYXJzZWRRdWVyeQog\nICAgICAgICAgICA6IHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5nCiAg\nICAgICAgICAgID8gZ2V0UGFyc2VkUXVlcnkoKFN0cmluZykgcGFyc2VkUXVl\ncnkpCiAgICAgICAgICAgIDogbnVsbCwgbnVsbCkpOwoKICAgICAgICBpZiAo\nY3R4KCkucGFyc2VkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbihwYXJzZWRRdWVyeSArICIiKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgTG9jYWxpemVyIGdldExvY2FsaXplcigpIHsKICAgICAg\nICByZXR1cm4gX2xvYzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NMb2Fk\nZXIgZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgcmVz\nb2x2ZSBpbiB0aGUgY29udGV4dCBvZiBhbnl0aGluZyBidXQgb3Vyc2VsdmVz\nCiAgICAgICAgcmV0dXJuIGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgUGFyc2VkSlBRTCBnZXRQYXJzZWRRdWVy\neSgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFyc2VkOwogICAgfQoKICAg\nIHByb3RlY3RlZCBQYXJzZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KFN0cmluZyBq\ncHFsKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZWRKUFFMKGpwcWwpOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRDYW5kaWRhdGUoQ2xhc3NNZXRh\nRGF0YSBjbWQsIFN0cmluZyBzY2hlbWFBbGlhcykgewogICAgICAgIGFkZEFj\nY2Vzc1BhdGgoY21kKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICBjdHgoKS5tZXRhID0gY21kOwoKICAgICAgICBpZiAoc2NoZW1h\nQWxpYXMgIT0gbnVsbCkKICAgICAgICAgICAgY3R4KCkuc2NoZW1hQWxpYXMg\nPSBzY2hlbWFBbGlhczsKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBuZXh0\nQWxpYXMoKSB7CiAgICAgICAgcmV0dXJuICJqcHFsYWxpYXMiICsgKCsrYWxp\nYXNDb3VudCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEg\ncmVzb2x2ZUNsYXNzTWV0YURhdGEoSlBRTE5vZGUgbm9kZSkgewogICAgICAg\nIC8vIGhhbmRsZSBsb29raW5nIHVwIGFsaWFzIG5hbWVzCiAgICAgICAgU3Ry\naW5nIHNjaGVtYU5hbWUgPSBhc3NlcnRTY2hlbWFOYW1lKG5vZGUpOwogICAg\nICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0Q2xhc3NNZXRhRGF0YShzY2hl\nbWFOYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyB3ZSBtaWdodCBiZSBy\nZWZlcmVuY2luZyBhIGNvbGxlY3Rpb24gZmllbGQgb2YgYSBzdWJxdWVyeSdz\nIHBhcmVudAogICAgICAgIGlmIChpc1BhdGgobm9kZSkpIHsKICAgICAgICAg\nICAgUGF0aCBwYXRoID0gZ2V0UGF0aChub2RlKTsKICAgICAgICAgICAgcmV0\ndXJuIGdldEZpZWxkVHlwZShwYXRoLmxhc3QoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBub3cgcnVuIGFnYWluIHRvIHRocm93IHRoZSBjb3JyZWN0IGV4\nY2VwdGlvbgogICAgICAgIHJldHVybiBnZXRDbGFzc01ldGFEYXRhKHNjaGVt\nYU5hbWUsIHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYSBnZXRDbGFzc01ldGFEYXRhKFN0cmluZyBhbGlhcywgYm9vbGVhbiBhc3Nl\ncnRWYWxpZCkgewogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGdldENs\nYXNzTG9hZGVyKCk7CiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nID0gcmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBn\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwoKICAgICAgICAvLyBm\naXJzdCBjaGVjayBmb3IgdGhlIGFsaWFzCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9hZGVyLCBmYWxz\nZSk7CgogICAgICAgIGlmIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGNtZDsKCiAgICAgICAgLy8gbm93IGNoZWNrIGZvciB0aGUgY2xhc3Mg\nbmFtZTsgdGhpcyBpcyBub3QgdGVjaG5pY2FsbHkgcGVybWl0dGVkCiAgICAg\nICAgLy8gYnkgdGhlIEpQQSBzcGVjLCBidXQgaXMgcmVxdWlyZWQgaW4gb3Jk\nZXIgdG8gYmUgYWJsZSB0byBleGVjdXRlCiAgICAgICAgLy8gSlBRTCBxdWVy\naWVzIGZyb20gb3RoZXIgZmFjYWRlcyAobGlrZSBKRE8pIHRoYXQgZG8gbm90\nIGhhdmUKICAgICAgICAvLyB0aGUgY29uY2VwdCBvZiBlbnRpdHkgbmFtZXMg\nb3IgYWxpYXNlcwogICAgICAgIENsYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zv\nck5hbWUoYWxpYXMsIG51bGwpOwogICAgICAgIGlmIChjICE9IG51bGwpCiAg\nICAgICAgICAgIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRhKGMsIGxvYWRlciwg\nYXNzZXJ0VmFsaWQpOwogICAgICAgIGVsc2UgaWYgKGFzc2VydFZhbGlkKQog\nICAgICAgICAgICBjbWQgPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9h\nZGVyLCB0cnVlKTsKCiAgICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGFzc2Vy\ndFZhbGlkKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgYWxpYXMgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBjbWQ7\nCiAgICB9CgogICAgcHJpdmF0ZSBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkg\newogICAgICAgIHJldHVybiBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKGN0eCgp\nLm1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGN0eCgpLm1ldGE7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgY2xzID0gZ2V0Q2FuZGlkYXRlTWV0\nYURhdGEocm9vdCgpKTsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2No\nZW1hLW5hbWUiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290\nKCkgfSwgbnVsbCk7CgogICAgICAgIHNldENhbmRpZGF0ZShjbHMsIG51bGwp\nOwogICAgICAgIHJldHVybiBjbHM7CiAgICB9CgogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGEgZ2V0Q2FuZGlkYXRlTWV0YURhdGEoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIC8vIGV4YW1pbmcgdGhlIG5vZGUgdG8gZmluZCB0aGUg\nY2FuZGlkYXRlIHF1ZXJ5CiAgICAgICAgLy8gIyMjIHRoaXMgc2hvdWxkIGFj\ndHVhbGx5IGJlIHRoZSBwcmltYXJ5IFNFTEVDVCBpbnN0YW5jZQogICAgICAg\nIC8vIHJlc29sdmVkIGFnYWluc3QgdGhlIGZyb20gdmFyaWFibGUgZGVjbGFy\nYXRpb25zCiAgICAgICAgSlBRTE5vZGUgZnJvbSA9IG5vZGUuZmluZENoaWxk\nQnlJRChKSlRGUk9NSVRFTSwgdHJ1ZSk7CiAgICAgICAgaWYgKGZyb20gPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBPUEVOSlBBLTE1IGFsbG93IHN1YnF1\nZXJ5IHdpdGhvdXQgYSBGUk9NSVRFTQogICAgICAgICAgICBpZiAobm9kZS5p\nZCA9PSBKSlRTVUJTRUxFQ1QpIHsgCiAgICAgICAgICAgICAgICBmcm9tID0g\nbm9kZS5maW5kQ2hpbGRCeUlEKEpKVEZST00sIHRydWUpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cg\ncGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZyb20tY2xhdXNlIiwgbnVs\nbCwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZnJvbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBKUFFMTm9kZSBuID0gZnJvbS5jaGlsZHJlbltpXTsK\nCiAgICAgICAgICAgIGlmIChuLmlkID09IEpKVEFCU1RSQUNUU0NIRU1BTkFN\nRSkgewogICAgICAgICAgICAgICAgLy8gd2Ugc2ltcGx5IHJldHVybiB0aGUg\nZmlyc3QgYWJzdHJhY3Qgc2NoZW1hIGNoaWxkCiAgICAgICAgICAgICAgICAv\nLyBhcyByZXNvbHZlZCBpbnRvIGEgY2xhc3MKICAgICAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgY21kID0gcmVzb2x2ZUNsYXNzTWV0YURhdGEobik7Cgog\nICAgICAgICAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgICAgICAgICAgLy8gbm90IGEg\nc2NoZW1hOiB0cmVhdCBpdCBhcyBhIGNsYXNzCiAgICAgICAgICAgICAgICBT\ndHJpbmcgY2xzID0gYXNzZXJ0U2NoZW1hTmFtZShuKTsKICAgICAgICAgICAg\nICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290KCkg\nfSwgbnVsbCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGdldENsYXNzTWV0\nYURhdGEoY2xzLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBPUEVOSlBBLTE1IHN1cHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBk\nbyBub3Qgc3RhcnQgd2l0aCAKICAgICAgICAgICAgLy8gaWRlbnRpZmljYXRp\nb25fdmFyaWFibGVfZGVjbGFyYXRpb24oKQogICAgICAgICAgICBpZiAobm9k\nZS5pZCA9PSBKSlRTVUJTRUxFQ1QpIHsKICAgICAgICAgICAgICAgIGlmIChu\nLmlkID09IEpKVElOTkVSSk9JTikgewogICAgICAgICAgICAgICAgICAgIG4g\nPSBuLmdldENoaWxkKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKG4uaWQgPT0gSkpUUEFUSCkgewogICAgICAgICAgICAgICAg\nICAgIFBhdGggcGF0aCA9IGdldFBhdGgobik7CiAgICAgICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRGaWVsZFR5cGUocGF0aC5sYXN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChjbWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY21kOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNF\nUiwgIm5vLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBuIH0sIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAgICAg\nICAgCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIGN1cnJlbnRRdWVyeSgpIHsKICAgICAgICBy\nZXR1cm4gY3R4KCkucGFyc2VkID09IG51bGwgfHwgcm9vdCgpLnBhcnNlciA9\nPSBudWxsID8gbnVsbAogICAgICAgICAgICA6IHJvb3QoKS5wYXJzZXIuanBx\nbDsKICAgIH0KCiAgICBRdWVyeUV4cHJlc3Npb25zIGdldFF1ZXJ5RXhwcmVz\nc2lvbnMoKSB7CiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBzID0gbmV3\nIFF1ZXJ5RXhwcmVzc2lvbnMoKTsKCiAgICAgICAgZXZhbFF1ZXJ5T3BlcmF0\naW9uKGV4cHMpOwoKICAgICAgICBFeHByZXNzaW9uIGZpbHRlciA9IG51bGw7\nCiAgICAgICAgZmlsdGVyID0gYW5kKGV2YWxGcm9tQ2xhdXNlKHJvb3QoKS5p\nZCA9PSBKSlRTRUxFQ1QpLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFu\nZChldmFsV2hlcmVDbGF1c2UoZXhwcyksIGZpbHRlcik7CiAgICAgICAgZmls\ndGVyID0gYW5kKGV2YWxTZWxlY3RDbGF1c2UoZXhwcyksIGZpbHRlcik7Cgog\nICAgICAgIGV4cHMuZmlsdGVyID0gZmlsdGVyID09IG51bGwgPyBmYWN0b3J5\nLmVtcHR5RXhwcmVzc2lvbigpIDogZmlsdGVyOwoKICAgICAgICBldmFsR3Jv\ndXBpbmdDbGF1c2UoZXhwcyk7CiAgICAgICAgZXZhbEhhdmluZ0NsYXVzZShl\neHBzKTsKICAgICAgICBldmFsRmV0Y2hKb2lucyhleHBzKTsKICAgICAgICBl\ndmFsU2V0Q2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxPcmRlcmluZ0NsYXVz\nZXMoZXhwcyk7CgogICAgICAgIGlmIChwYXJhbWV0ZXJUeXBlcyAhPSBudWxs\nKQogICAgICAgICAgICBleHBzLnBhcmFtZXRlclR5cGVzID0gcGFyYW1ldGVy\nVHlwZXM7CgogICAgICAgIGV4cHMuYWNjZXNzUGF0aCA9IGdldEFjY2Vzc1Bh\ndGgoKTsKCiAgICAgICAgcmV0dXJuIGV4cHM7CiAgICB9CgogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGFuZChFeHByZXNzaW9uIGUxLCBFeHByZXNzaW9uIGUy\nKSB7CiAgICAgICAgcmV0dXJuIGUxID09IG51bGwgPyBlMiA6IGUyID09IG51\nbGwgPyBlMSA6IGZhY3RvcnkuYW5kKGUxLCBlMik7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUpIHsK\nICAgICAgICByZXR1cm4gYXNzZW1ibGUobm9kZSwgIi4iLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBjaGlsZHJlbiBvZiB0aGUg\nc3BlY2lmaWMgbm9kZSBieSBhcHBlbmRpbmcgZWFjaAogICAgICogY2hpbGQs\nIHNlcGFyYXRlZCBieSB0aGUgZGVsaW1pdGVyLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBTdHJpbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSwgU3Ry\naW5nIGRlbGltaXRlciwgaW50IGxhc3QpIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIEpQUUxO\nb2RlW10gcGFydHMgPSBub2RlLmNoaWxkcmVuOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBwYXJ0cyAhPSBudWxsICYmIGkgPCBwYXJ0cy5sZW5ndGggLSBs\nYXN0OyBpKyspCiAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQocmVzdWx0Lmxl\nbmd0aCgpID4gMCA/IGRlbGltaXRlciA6ICIiKS4KICAgICAgICAgICAgICAg\nIGFwcGVuZChwYXJ0c1tpXS50ZXh0KTsKCiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC50b1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBh\nc3NpZ25Qcm9qZWN0aW9ucyhKUFFMTm9kZSBwYXJhbWV0ZXJzTm9kZSwKICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBpbnQgY291\nbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9ucyA9IG5ldyBWYWx1ZVtjb3VudF07CiAgICAgICAg\nZXhwcy5wcm9qZWN0aW9uQ2xhdXNlcyA9IG5ldyBTdHJpbmdbY291bnRdOwog\nICAgICAgIGV4cHMucHJvamVjdGlvbkFsaWFzZXMgPSBuZXcgU3RyaW5nW2Nv\ndW50XTsKCiAgICAgICAgRXhwcmVzc2lvbiBleHAgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAg\nICBKUFFMTm9kZSBwYXJlbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZChp\nKTsKICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9ubHlDaGlsZChwYXJl\nbnQpOwogICAgICAgICAgICBWYWx1ZSBwcm9qID0gZ2V0VmFsdWUobm9kZSk7\nCiAgICAgICAgICAgIGV4cHMucHJvamVjdGlvbnNbaV0gPSBwcm9qOwogICAg\nICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzW2ldID0gbmV4dEFsaWFz\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlvbihRdWVyeUV4cHJlc3Np\nb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSB3\nYW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRhdGUKICAgICAgICBpZiAo\ncm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290KCkuaWQgPT0gSkpUU1VC\nU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5T3Bl\ncmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxzZSBpZiAocm9vdCgpLmlk\nID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhwcy5vcGVyYXRpb24gPSBR\ndWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAgICAgIGVsc2UgaWYgKHJv\nb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAgICAgIGV4cHMub3BlcmF0\naW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQUE9S\nVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lv\nbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1c2Vz\nCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUgPSByb290KCkuZmluZENo\naWxkQnlJRChKSlRHUk9VUEJZLCB0cnVlKTsKCiAgICAgICAgaWYgKGdyb3Vw\nQnlOb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naW50IGdyb3VwQnlDb3VudCA9IGdyb3VwQnlOb2RlLmdldENoaWxkQ291bnQo\nKTsKCiAgICAgICAgZXhwcy5ncm91cGluZyA9IG5ldyBWYWx1ZVtncm91cEJ5\nQ291bnRdOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdyb3VwQnlD\nb3VudDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBncm91\ncEJ5Tm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgZXhwcy5ncm91cGlu\nZ1tpXSA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZXZhbEhhdmluZ0NsYXVzZShRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgSEFWSU5HIGNsYXVzZXMKICAg\nICAgICBKUFFMTm9kZSBoYXZpbmdOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5\nSUQoSkpUSEFWSU5HLCB0cnVlKTsKCiAgICAgICAgaWYgKGhhdmluZ05vZGUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBleHBzLmhh\ndmluZyA9IGdldEV4cHJlc3Npb24ob25seUNoaWxkKGhhdmluZ05vZGUpKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbE9yZGVyaW5nQ2xhdXNlcyhR\ndWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgT1JE\nRVIgQlkgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIG9yZGVyYnkgPSByb290\nKCkuZmluZENoaWxkQnlJRChKSlRPUkRFUkJZLCBmYWxzZSk7CiAgICAgICAg\naWYgKG9yZGVyYnkgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgb3JkZXJj\nb3VudCA9IG9yZGVyYnkuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBl\neHBzLm9yZGVyaW5nID0gbmV3IFZhbHVlW29yZGVyY291bnRdOwogICAgICAg\nICAgICBleHBzLmFzY2VuZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRd\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7\nIGkrKykgewogICAgICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVy\nYnkuZ2V0Q2hpbGQoaSk7CiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5n\nW2ldID0gZ2V0VmFsdWUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAg\nICAgICAvLyBvbW1pc3Npb24gb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBh\nc2NlbmRpbmcKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0g\nbm9kZS5nZXRDaGlsZENvdW50KCkgPD0gMSB8fAogICAgICAgICAgICAgICAg\nICAgIGxhc3RDaGlsZChub2RlKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVl\nIDogZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxTZWxlY3RDbGF1c2UoUXVlcnlFeHBy\nZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaWYgKGV4cHMub3BlcmF0aW9uICE9\nIFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3ROb2RlID0gcm9vdCgp\nOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3RDbGF1c2UgPSBzZWxlY3ROb2Rl\nLgogICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVFNFTEVDVENMQVVTRSwg\nZmFsc2UpOwogICAgICAgIGlmIChzZWxlY3RDbGF1c2UgIT0gbnVsbCAmJiBz\nZWxlY3RDbGF1c2UuaGFzQ2hpbGRJRChKSlRESVNUSU5DVCkpCiAgICAgICAg\nICAgIGV4cHMuZGlzdGluY3QgPSBleHBzLkRJU1RJTkNUX1RSVUUgfCBleHBz\nLkRJU1RJTkNUX0FVVE87CiAgICAgICAgZWxzZQogICAgICAgICAgICBleHBz\nLmRpc3RpbmN0ID0gZXhwcy5ESVNUSU5DVF9GQUxTRTsKCiAgICAgICAgSlBR\nTE5vZGUgY29uc3RydWN0b3IgPSBzZWxlY3ROb2RlLmZpbmRDaGlsZEJ5SUQo\nSkpUQ09OU1RSVUNUT1IsIHRydWUpOwogICAgICAgIGlmIChjb25zdHJ1Y3Rv\nciAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGJ1aWxkIHVwIHRoZSBmdWxs\neS1xdWFsaWZpZWQgcmVzdWx0IGNsYXNzIG5hbWUgYnkKICAgICAgICAgICAg\nLy8gYXBwZW5kaW5nIHRvZ2V0aGVyIHRoZSBjb21wb25lbnRzIG9mIHRoZSBj\naGlsZHJlbgogICAgICAgICAgICBTdHJpbmcgcmVzdWx0Q2xhc3NOYW1lID0g\nYXNzZW1ibGUobGVmdChjb25zdHJ1Y3RvcikpOwogICAgICAgICAgICBleHBz\nLnJlc3VsdENsYXNzID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKHJlc3VsdENs\nYXNzTmFtZSwgbnVsbCk7CgogICAgICAgICAgICAvLyBub3cgYXNzaWduIHRo\nZSBhcmd1bWVudHMgdG8gdGhlIHNlbGVjdCBjbGF1c2UgYXMgdGhlIHByb2pl\nY3Rpb25zCiAgICAgICAgICAgIHJldHVybiBhc3NpZ25Qcm9qZWN0aW9ucyhy\naWdodChjb25zdHJ1Y3RvciksIGV4cHMpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIC8vIGhhbmRsZSBTRUxFQ1QgY2xhdXNlcwogICAgICAgICAg\nICBKUFFMTm9kZSBleHBOb2RlID0gc2VsZWN0Tm9kZS4KICAgICAgICAgICAg\nICAgIGZpbmRDaGlsZEJ5SUQoSkpUU0VMRUNURVhQUkVTU0lPTlMsIHRydWUp\nOwogICAgICAgICAgICBpZiAoZXhwTm9kZSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBpbnQgc2VsZWN0Q291\nbnQgPSBleHBOb2RlLmdldENoaWxkQ291bnQoKTsKICAgICAgICAgICAgSlBR\nTE5vZGUgc2VsZWN0Q2hpbGQgPSBmaXJzdENoaWxkKGV4cE5vZGUpOwoKICAg\nICAgICAgICAgLy8gaWYgd2UgYXJlIHNlbGVjdGluZyBqdXN0IG9uZSB0aGlu\nZyBhbmQgdGhhdCB0aGluZyBpcyB0aGUKICAgICAgICAgICAgLy8gc2NoZW1h\nJ3MgYWxpYXMsIHRoZW4gZG8gbm90IHRyZWF0IGl0IGFzIGEgcHJvamVjdGlv\nbgogICAgICAgICAgICBpZiAoc2VsZWN0Q291bnQgPT0gMSAmJiBzZWxlY3RD\naGlsZCAhPSBudWxsICYmCiAgICAgICAgICAgICAgICBzZWxlY3RDaGlsZC5n\nZXRDaGlsZENvdW50KCkgPT0gMSAmJgogICAgICAgICAgICAgICAgb25seUNo\naWxkKHNlbGVjdENoaWxkKSAhPSBudWxsICYmCiAgICAgICAgICAgICAgICBh\nc3NlcnRTY2hlbWFBbGlhcygpLgogICAgICAgICAgICAgICAgICAgIGVxdWFs\nc0lnbm9yZUNhc2Uob25seUNoaWxkKHNlbGVjdENoaWxkKS50ZXh0KSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAvLyBKUFFMIGRvZXMgbm90IGZpbHRlciBy\nZWxhdGlvbmFsIGpvaW5zIGZvciBwcm9qZWN0aW9ucwogICAgICAgICAgICAg\nICAgZXhwcy5kaXN0aW5jdCAmPSB+ZXhwcy5ESVNUSU5DVF9BVVRPOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGFzc2lnblByb2plY3Rpb25zKGV4cE5vZGUs\nIGV4cHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgU3RyaW5nIGFzc2VydFNjaGVtYUFsaWFzKCkgewogICAgICAgIFN0\ncmluZyBhbGlhcyA9IGN0eCgpLnNjaGVtYUFsaWFzOwoKICAgICAgICBpZiAo\nYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRp\nb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwKICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgY3R4KCkubWV0YSB9LCBudWxsKTsKCiAgICAgICAg\ncmV0dXJuIGFsaWFzOwogICAgfQoKICAgIHByb3RlY3RlZCBFeHByZXNzaW9u\nIGV2YWxGZXRjaEpvaW5zKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAg\nICAgIEV4cHJlc3Npb24gZmlsdGVyID0gbnVsbDsKCiAgICAgICAgLy8gaGFu\nZGxlIEpPSU4gRkVUQ0gKICAgICAgICBTZXQgam9pbnMgPSBudWxsOwoKICAg\nICAgICBKUFFMTm9kZVtdIG91dGVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5C\neUlEKEpKVE9VVEVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgb3V0ZXJzICE9IG51bGwgJiYgaSA8IG91dGVycy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5ldyBUcmVl\nU2V0KCkgOiBqb2lucykuCiAgICAgICAgICAgICAgICBhZGQoZ2V0UGF0aChv\nbmx5Q2hpbGQob3V0ZXJzW2ldKSkubGFzdCgpLmdldEZ1bGxOYW1lKGZhbHNl\nKSk7CgogICAgICAgIEpQUUxOb2RlW10gaW5uZXJzID0gcm9vdCgpLmZpbmRD\naGlsZHJlbkJ5SUQoSkpUSU5ORVJGRVRDSEpPSU4pOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpbm5lcnMgIT0gbnVsbCAmJiBpIDwgaW5uZXJzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAoam9pbnMgPT0gbnVsbCA/IGpvaW5zID0g\nbmV3IFRyZWVTZXQoKSA6IGpvaW5zKS4KICAgICAgICAgICAgICAgIGFkZChn\nZXRQYXRoKG9ubHlDaGlsZChpbm5lcnNbaV0pKS5sYXN0KCkuZ2V0RnVsbE5h\nbWUoZmFsc2UpKTsKCiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAg\nICAgICAgIGV4cHMuZmV0Y2hQYXRocyA9IChTdHJpbmdbXSkgam9pbnMuCiAg\nICAgICAgICAgICAgICB0b0FycmF5KG5ldyBTdHJpbmdbam9pbnMuc2l6ZSgp\nXSk7CgogICAgICAgIHJldHVybiBmaWx0ZXI7CiAgICB9CgogICAgcHJvdGVj\ndGVkIHZvaWQgZXZhbFNldENsYXVzZShRdWVyeUV4cHJlc3Npb25zIGV4cHMp\nIHsKICAgICAgICAvLyBoYW5kbGUgU0VUIGZpZWxkID0gdmFsdWUKICAgICAg\nICBKUFFMTm9kZVtdIG5vZGVzID0gcm9vdCgpLmZpbmRDaGlsZHJlbkJ5SUQo\nSkpUVVBEQVRFSVRFTSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IG5vZGVz\nICE9IG51bGwgJiYgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGEgZmllbGQgPSBnZXRQYXRoKGZpcnN0Q2hpbGQo\nbm9kZXNbaV0pKS5sYXN0KCk7CiAgICAgICAgICAgIFZhbHVlIHZhbCA9IGdl\ndFZhbHVlKG9ubHlDaGlsZChsYXN0Q2hpbGQobm9kZXNbaV0pKSk7CiAgICAg\nICAgICAgIGV4cHMucHV0VXBkYXRlKGZpZWxkLCB2YWwpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbFdoZXJlQ2xhdXNl\nKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGV2YWx1YXRl\nIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICBKUFFMTm9kZSB3aGVyZU5vZGUg\nPSByb290KCkuZmluZENoaWxkQnlJRChKSlRXSEVSRSwgZmFsc2UpOwogICAg\nICAgIGlmICh3aGVyZU5vZGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgcmV0dXJuIChFeHByZXNzaW9uKSBldmFsKHdoZXJl\nTm9kZSk7CiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxGcm9t\nQ2xhdXNlKGJvb2xlYW4gbmVlZHNBbGlhcykgewogICAgICAgIEV4cHJlc3Np\nb24gZXhwID0gbnVsbDsKCiAgICAgICAgLy8gYnVpbGQgdXAgdGhlIGFsaWFz\nIG1hcCBpbiB0aGUgRlJPTSBjbGF1c2UKICAgICAgICBKUFFMTm9kZSBmcm9t\nID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpURlJPTSwgZmFsc2UpOwogICAg\nICAgIGlmIChmcm9tID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHBhcnNl\nRXhjZXB0aW9uKEVYX1VTRVIsICJuby1mcm9tLWNsYXVzZSIsIG51bGwsIG51\nbGwpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZyb20uY2hpbGRy\nZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgSlBRTE5vZGUgbm9kZSA9\nIGZyb20uY2hpbGRyZW5baV07CgogICAgICAgICAgICBpZiAobm9kZS5pZCA9\nPSBKSlRGUk9NSVRFTSkKICAgICAgICAgICAgICAgIGV4cCA9IGV2YWxGcm9t\nSXRlbShleHAsIG5vZGUsIG5lZWRzQWxpYXMpOwogICAgICAgICAgICBlbHNl\nIGlmIChub2RlLmlkID09IEpKVE9VVEVSSk9JTikKICAgICAgICAgICAgICAg\nIGV4cCA9IGFkZEpvaW4obm9kZSwgZmFsc2UsIGV4cCk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUSU5ORVJKT0lOKQogICAgICAgICAg\nICAgICAgZXhwID0gYWRkSm9pbihub2RlLCB0cnVlLCBleHApOwogICAgICAg\nICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVElOTkVSRkVUQ0hKT0lOKQog\nICAgICAgICAgICAgICAgZXhwID0gYWRkSm9pbihub2RlLCB0cnVlLCBleHAp\nOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVE9VVEVSRkVU\nQ0hKT0lOKQogICAgICAgICAgICAgICAgOyAvLyB3ZSBoYW5kbGUgb3V0ZXIg\nZmV0Y2ggam9pbnMgaW4gdGhlIGV2YWxGZXRjaEpvaW5zKCkgbWV0aG9kCiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhj\nZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1hLW5hbWUiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsKICAgICAg\nICB9CgogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgam9pbiBjb25kaXRpb24gdG8gdGhlIGdpdmVuIGV4cHJlc3Np\nb24uCiAgICAgKgogICAgICogQHBhcmFtIG5vZGUgdGhlIG5vZGUgdG8gY2hl\nY2sKICAgICAqIEBwYXJhbSBpbm5lciB3aGV0aGVyIG9yIG5vdCB0aGUgam9p\nbiBzaG91bGQgYmUgYW4gaW5uZXIgam9pbgogICAgICogQHBhcmFtIGV4cCBh\nbiBleGlzdGluZyBleHByZXNzaW9uIHRvIEFORCwgb3IgbnVsbCBpZiBub25l\nCiAgICAgKiBAcmV0dXJuIHRoZSBFeHByZXNzaW9uIHdpdGggdGhlIGpvaW4g\nY29uZGl0aW9uIGFkZGVkCiAgICAgKi8KICAgIHByaXZhdGUgRXhwcmVzc2lv\nbiBhZGRKb2luKEpQUUxOb2RlIG5vZGUsIGJvb2xlYW4gaW5uZXIsIEV4cHJl\nc3Npb24gZXhwKSB7CiAgICAgICAgLy8gdGhlIHR5cGUgd2lsbCBiZSB0aGUg\nZGVjbGFyZWQgdHlwZSBmb3IgdGhlIGZpZWxkCiAgICAgICAgUGF0aCBwYXRo\nID0gZ2V0UGF0aChmaXJzdENoaWxkKG5vZGUpLCBmYWxzZSwgaW5uZXIpOwoK\nICAgICAgICBKUFFMTm9kZSBhbGlhcyA9IG5vZGUuZ2V0Q2hpbGRDb3VudCgp\nID49IDIgPyByaWdodChub2RlKSA6IG51bGw7CiAgICAgICAgLy8gT1BFTkpQ\nQS0xNSBzdXBwb3J0IHN1YnF1ZXJ5J3MgZnJvbSBjbGF1c2UgZG8gbm90IHN0\nYXJ0IHdpdGggCiAgICAgICAgLy8gaWRlbnRpZmljYXRpb25fdmFyaWFibGVf\nZGVjbGFyYXRpb24oKQogICAgICAgIGlmIChpbm5lciAmJiBjdHgoKS5zdWJx\ndWVyeSAhPSBudWxsICYmIGN0eCgpLnNjaGVtYUFsaWFzID09IG51bGwpIHsK\nICAgICAgICAgICAgc2V0Q2FuZGlkYXRlKGdldEZpZWxkVHlwZShwYXRoLmxh\nc3QoKSksIGFsaWFzLnRleHQpOwoKICAgICAgICAgICAgUGF0aCBzdWJwYXRo\nID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5KTsKICAgICAgICAg\nICAgc3VicGF0aC5zZXRNZXRhRGF0YShjdHgoKS5zdWJxdWVyeS5nZXRNZXRh\nRGF0YSgpKTsKICAgICAgICAgICAgZXhwID0gIGFuZChleHAsIGZhY3Rvcnku\nZXF1YWwocGF0aCwgc3VicGF0aCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuIGFkZEpvaW4ocGF0aCwgYWxpYXMsIGlubmVyLCBleHApOwogICAgfQoK\nICAgIHByaXZhdGUgRXhwcmVzc2lvbiBhZGRKb2luKFBhdGggcGF0aCwgSlBR\nTE5vZGUgYWxpYXNOb2RlLCBib29sZWFuIGlubmVyLAogICAgICAgIEV4cHJl\nc3Npb24gZXhwKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRo\nLmxhc3QoKTsKCiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAicGF0aC1uby1tZXRh\nIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgcGF0aCwgbnVsbCB9\nLCBudWxsKTsKCiAgICAgICAgU3RyaW5nIGFsaWFzID0gYWxpYXNOb2RlICE9\nIG51bGwgPyBhbGlhc05vZGUudGV4dCA6IG5leHRBbGlhcygpOwoKICAgICAg\nICBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShhbGlhcywgdHJ1ZSk7CiAgICAg\nICAgdmFyLnNldE1ldGFEYXRhKGdldEZpZWxkVHlwZShmbWQpKTsKCiAgICAg\nICAgRXhwcmVzc2lvbiBqb2luID0gbnVsbDsKCiAgICAgICAgLy8gaWYgdGhl\nIHZhcmlhYmxlIGlzIGFscmVhZHkgYm91bmQsIGdldCB0aGUgdmFyJ3MgdmFs\ndWUgYW5kCiAgICAgICAgLy8gZG8gYSByZWd1bGFyIGNvbnRhaW5zIHdpdGgg\ndGhhdAogICAgICAgIGJvb2xlYW4gYm91bmQgPSBpc0JvdW5kKHZhcik7CiAg\nICAgICAgaWYgKGJvdW5kKSB7CiAgICAgICAgICAgIHZhciA9IGdldFZhbHVl\nKGFsaWFzTm9kZSwgVkFSX1BBVEgpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIGJpbmQodmFyKTsKICAgICAgICAgICAgam9pbiA9IGFuZChqb2lu\nLCBmYWN0b3J5LmJpbmRWYXJpYWJsZSh2YXIsIHBhdGgpKTsKICAgICAgICB9\nCgogICAgICAgIGlmICghZm1kLmlzVHlwZVBDKCkpIC8vIG11bHRpLXZhbHVl\nZCByZWxhdGlvbgogICAgICAgIHsKICAgICAgICAgICAgaWYgKGJvdW5kKQog\nICAgICAgICAgICAgICAgam9pbiA9IGFuZChqb2luLCBmYWN0b3J5LmNvbnRh\naW5zKHBhdGgsIHZhcikpOwoKICAgICAgICAgICAgc2V0SW1wbGljaXRDb250\nYWluc1R5cGVzKHBhdGgsIHZhciwgQ09OVEFJTlNfVFlQRV9FTEVNRU5UKTsK\nICAgICAgICB9CgogICAgICAgIHJldHVybiBhbmQoZXhwLCBqb2luKTsKICAg\nIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21JdGVtKEV4cHJl\nc3Npb24gZXhwLCBKUFFMTm9kZSBub2RlLAogICAgICAgIGJvb2xlYW4gbmVl\nZHNBbGlhcykgewogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gcmVzb2x2\nZUNsYXNzTWV0YURhdGEoZmlyc3RDaGlsZChub2RlKSk7CgogICAgICAgIFN0\ncmluZyBhbGlhcyA9IG51bGw7CgogICAgICAgIGlmIChub2RlLmdldENoaWxk\nQ291bnQoKSA8IDIpIHsKICAgICAgICAgICAgaWYgKG5lZWRzQWxpYXMpCiAg\nICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nYWxpYXMtcmVxdWlyZWQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmpl\nY3RbXXsgY21kIH0sIG51bGwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIGFsaWFzID0gcmlnaHQobm9kZSkudGV4dDsKICAgICAgICAgICAgSlBR\nTE5vZGUgbGVmdCA9IGxlZnQobm9kZSk7CgogICAgICAgICAgICAvLyBjaGVj\nayB0byBzZWUgaWYgdGhlIHdlIGFyZSByZWZlcnJpbmcgdG8gYSBwYXRoIGlu\nIHRoZSBmcm9tCiAgICAgICAgICAgIC8vIGNsYXVzZSwgc2luY2Ugd2UgbWln\naHQgYmUgaW4gYSBzdWJxdWVyeSBhZ2FpbnN0IGEgY29sbGVjdGlvbgogICAg\nICAgICAgICBpZiAoaXNQYXRoKGxlZnQpKSB7CiAgICAgICAgICAgICAgICBQ\nYXRoIHBhdGggPSBnZXRQYXRoKGxlZnQpOwogICAgICAgICAgICAgICAgc2V0\nQ2FuZGlkYXRlKGdldEZpZWxkVHlwZShwYXRoLmxhc3QoKSksIGFsaWFzKTsK\nCiAgICAgICAgICAgICAgICBQYXRoIHN1YnBhdGggPSBmYWN0b3J5Lm5ld1Bh\ndGgoY3R4KCkuc3VicXVlcnkpOwogICAgICAgICAgICAgICAgc3VicGF0aC5z\nZXRNZXRhRGF0YShjdHgoKS5zdWJxdWVyeS5nZXRNZXRhRGF0YSgpKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBhbmQoZXhwLCBmYWN0b3J5LmVxdWFsKHBh\ndGgsIHN1YnBhdGgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIC8vIHdlIGhhdmUgYW4gYWxpYXM6IGJpbmQgaXQgYXMgYSB2YXJp\nYWJsZQogICAgICAgICAgICAgICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUo\nYWxpYXMsIHRydWUpOwogICAgICAgICAgICAgICAgdmFyLnNldE1ldGFEYXRh\nKGNtZCk7CiAgICAgICAgICAgICAgICBiaW5kKHZhcik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vICMjIyB3ZSBhc3NpZ24gdGhlIGZp\ncnN0IEZST01JVEVNIGluc3RhbmNlIHdlIHNlZSBhcwogICAgICAgIC8vIHRo\nZSBnbG9iYWwgY2FuZGlkYXRlLCB3aGljaCBpcyBpbmNvcnJlY3Q6IHdlIHNo\nb3VsZAogICAgICAgIC8vIGluc3RlYWQgYmUgbWFwcGluZyB0aGlzIHRvIHRo\nZSBTRUxFQ1RJVEVNIHRvIHNlZQogICAgICAgIC8vIHdoaWNoIGlzIHRoZSBk\nZXNpcmVkIGNhbmRpZGF0ZQogICAgICAgIGlmIChjdHgoKS5zY2hlbWFBbGlh\ncyA9PSBudWxsKQogICAgICAgICAgICBzZXRDYW5kaWRhdGUoY21kLCBhbGlh\ncyk7CgogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAgcHJvdGVjdGVk\nIGJvb2xlYW4gaXNEZWNsYXJlZFZhcmlhYmxlKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgLy8gSlBRTCBkb2Vzbid0IHN1cHBvcnQgZGVjbGFyaW5nIHZhcmlh\nYmxlcwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENoZWNrIHRvIHNlZSBpZiB0aGUgc3BlY2lmaWMgbm9kZSBpcyBhIHBh\ndGggKHZzLiBhIHNjaGVtYSBuYW1lKQogICAgICovCiAgICBib29sZWFuIGlz\nUGF0aChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuZ2V0Q2hp\nbGRDb3VudCgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAg\nICAgICBmaW5hbCBTdHJpbmcgbmFtZSA9IGZpcnN0Q2hpbGQobm9kZSkudGV4\ndDsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0\naGUgY2xhc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAvLyBmb3IgdGhl\nIGNhbmRpZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhpcykK\nICAgICAgICBpZiAoZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1lKSAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgaWYgKCFpc1Nl\nZW5WYXJpYWJsZShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICBmaW5hbCBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShuYW1lLCBm\nYWxzZSk7CgogICAgICAgIGlmICh2YXIgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGlzQm91bmQodmFyKTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIHByaXZhdGUgc3RhdGljIENsYXNzTWV0YURhdGEgZ2V0Rmll\nbGRUeXBlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBjbWQgPSBudWxsOwogICAgICAgIFZhbHVlTWV0YURhdGEg\ndm1kOwoKICAgICAgICBpZiAoKHZtZCA9IGZtZC5nZXRFbGVtZW50KCkpICE9\nIG51bGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVN\nZXRhRGF0YSgpOwogICAgICAgIGVsc2UgaWYgKCh2bWQgPSBmbWQuZ2V0S2V5\nKCkpICE9IG51bGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJl\nZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGVsc2UgaWYgKCh2bWQgPSBmbWQu\nZ2V0VmFsdWUoKSkgIT0gbnVsbCkKICAgICAgICAgICAgY21kID0gdm1kLmdl\ndERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CgogICAgICAgIGlmIChjbWQgPT0g\nbnVsbCB8fCBjbWQuZ2V0RGVzY3JpYmVkVHlwZSgpID09IE9iamVjdC5jbGFz\ncykKICAgICAgICAgICAgY21kID0gZm1kLmdldERlY2xhcmVkVHlwZU1ldGFE\nYXRhKCk7CgogICAgICAgIHJldHVybiBjbWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZGVudGlmaWNhdGlvbiB2YXJpYWJsZXMgaW4gSlBRTCBhcmUgY2Fz\nZSBpbnNlbnNpdGl2ZSwgc28gbG93ZXItY2FzZQogICAgICogYWxsIHZhcmlh\nYmxlcyB3ZSBhcmUgZ29pbmcgdG8gYmluZC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFZhbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCwgYm9vbGVhbiBiaW5k\nKSB7CiAgICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VmFyaWFibGUoaWQu\ndG9Mb3dlckNhc2UoKSwgYmluZCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaXNTZWVuZFZhcmlhYmxlKFN0cmluZyBpZCkgewogICAgICAgIHJl\ndHVybiBpZCAhPSBudWxsICYmIHN1cGVyLmlzU2VlblZhcmlhYmxlKGlkLnRv\nTG93ZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0\naGUgY2xhc3MgbmFtZSB1c2luZyB0aGUgY2hpbGRyZW4gb2YgdGhlIEpQUUxO\nb2RlLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBhc3NlcnRTY2hlbWFO\nYW1lKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5pZCAhPSBK\nSlRBQlNUUkFDVFNDSEVNQU5BTUUpCiAgICAgICAgICAgIHRocm93IHBhcnNl\nRXhjZXB0aW9uKEVYX1VTRVIsICJub3QtaWRlbnRpZmVyIiwKICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsKCiAgICAgICAg\ncmV0dXJuIGFzc2VtYmxlKG5vZGUpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVjdXJzaXZlIGhlbHBlciBtZXRob2QgdG8gZXZhbHVhdGUgdGhlIGdpdmVu\nIG5vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGV2YWwoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIFZhbHVlIHZhbDEgPSBudWxsOwogICAgICAg\nIFZhbHVlIHZhbDIgPSBudWxsOwogICAgICAgIFZhbHVlIHZhbDMgPSBudWxs\nOwoKICAgICAgICBib29sZWFuIG5vdCA9IG5vZGUubm90OwoKICAgICAgICBz\nd2l0Y2ggKG5vZGUuaWQpIHsKICAgICAgICAgICAgY2FzZSBKSlRXSEVSRTog\nLy8gdG9wLWxldmVsIFdIRVJFIGNsYXVzZQogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldEV4cHJlc3Npb24ob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpUQk9PTEVBTkxJVEVSQUw6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKCJ0cnVlIi5lcXVhbHNJZ25vcmVD\nYXNlCiAgICAgICAgICAgICAgICAgICAgKG5vZGUudGV4dCkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFLAogICAgICAgICAgICAgICAgICAgIExp\ndGVyYWwuVFlQRV9CT09MRUFOKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSU5U\nRUdFUkxJVEVSQUw6CiAgICAgICAgICAgICAgICAvLyB1c2UgQmlnRGVjaW1h\nbCBiZWNhdXNlIGl0IGNhbiBoYW5kbGUgcGFyc2luZyBleHBvbmVudHMKICAg\nICAgICAgICAgICAgIEJpZ0RlY2ltYWwgaW50bGl0ID0gbmV3IEJpZ0RlY2lt\nYWwKICAgICAgICAgICAgICAgICAgICAobm9kZS50ZXh0LmVuZHNXaXRoKCJs\nIikgfHwgbm9kZS50ZXh0LmVuZHNXaXRoKCJMIikKICAgICAgICAgICAgICAg\nICAgICAgICAgPyBub2RlLnRleHQuc3Vic3RyaW5nKDAsIG5vZGUudGV4dC5s\nZW5ndGgoKSAtIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIDogbm9kZS50\nZXh0KS4KICAgICAgICAgICAgICAgICAgICBtdWx0aXBseShuZXcgQmlnRGVj\naW1hbChuZWdhdGl2ZShub2RlKSkpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkubmV3TGl0ZXJhbChuZXcgTG9uZyhpbnRsaXQubG9uZ1ZhbHVl\nKCkpLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRERUNJTUFMTElURVJBTDoKICAgICAg\nICAgICAgICAgIEJpZ0RlY2ltYWwgZGVjbGl0ID0gbmV3IEJpZ0RlY2ltYWwK\nICAgICAgICAgICAgICAgICAgICAobm9kZS50ZXh0LmVuZHNXaXRoKCJkIikg\nfHwgbm9kZS50ZXh0LmVuZHNXaXRoKCJEIikgfHwKICAgICAgICAgICAgICAg\nICAgICAgICAgbm9kZS50ZXh0LmVuZHNXaXRoKCJmIikgfHwgbm9kZS50ZXh0\nLmVuZHNXaXRoKCJGIikKICAgICAgICAgICAgICAgICAgICAgICAgPyBub2Rl\nLnRleHQuc3Vic3RyaW5nKDAsIG5vZGUudGV4dC5sZW5ndGgoKSAtIDEpCiAg\nICAgICAgICAgICAgICAgICAgICAgIDogbm9kZS50ZXh0KS4KICAgICAgICAg\nICAgICAgICAgICBtdWx0aXBseShuZXcgQmlnRGVjaW1hbChuZWdhdGl2ZShu\nb2RlKSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0\nZXJhbChkZWNsaXQsIExpdGVyYWwuVFlQRV9OVU1CRVIpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRTVFJJTkdMSVRFUkFMOgogICAgICAgICAgICBjYXNlIEpK\nVFRSSU1DSEFSQUNURVI6CiAgICAgICAgICAgIGNhc2UgSkpURVNDQVBFQ0hB\nUkFDVEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0\nZXJhbCh0cmltUXVvdGVzKG5vZGUudGV4dCksCiAgICAgICAgICAgICAgICAg\nICAgTGl0ZXJhbC5UWVBFX1NRX1NUUklORyk7CgogICAgICAgICAgICBjYXNl\nIEpKVFBBVFRFUk5WQUxVRToKICAgICAgICAgICAgICAgIHJldHVybiBldmFs\nKGZpcnN0Q2hpbGQobm9kZSkpOwoKICAgICAgICAgICAgY2FzZSBKSlROQU1F\nRElOUFVUUEFSQU1FVEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFBh\ncmFtZXRlcihub2RlLnRleHQsIGZhbHNlKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUUE9TSVRJT05BTElOUFVUUEFSQU1FVEVSOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGdldFBhcmFtZXRlcihub2RlLnRleHQsIHRydWUpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRPUjogLy8geCBPUiB5CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5vcihnZXRFeHByZXNzaW9uKGxlZnQobm9kZSkpLAog\nICAgICAgICAgICAgICAgICAgIGdldEV4cHJlc3Npb24ocmlnaHQobm9kZSkp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQU5EOiAvLyB4IEFORCB5CiAgICAg\nICAgICAgICAgICByZXR1cm4gYW5kKGdldEV4cHJlc3Npb24obGVmdChub2Rl\nKSksCiAgICAgICAgICAgICAgICAgICAgZ2V0RXhwcmVzc2lvbihyaWdodChu\nb2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRFUVVBTFM6IC8vIHggPSB5\nCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7\nCiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmVxdWFs\nKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlROT1RFUVVBTFM6\nIC8vIHggPD4geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxl\nZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJp\nZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXMo\ndmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5ub3RFcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUTEVTU1RIQU46IC8vIHggPCB5CiAgICAgICAgICAgICAgICB2YWwxID0g\nZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0g\nZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1w\nbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lmxlc3NUaGFuKHZhbDEsIHZhbDIpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRMRVNTT1JFUVVBTDogLy8geCA8PSB5CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAg\nICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAg\nICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lmxlc3NUaGFuRXF1YWwo\ndmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEdSRUFURVJUSEFO\nOiAvLyB4ID4geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxl\nZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJp\nZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXMo\ndmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5ncmVhdGVyVGhhbih2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUR1JFQVRFUk9SRVFVQUw6IC8vIHggPj0geQogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAg\nICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAg\nICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5ncmVhdGVyVGhhbkVxdWFsKHZh\nbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRBREQ6IC8vIHggKyB5\nCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7\nCiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5hZGQodmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVFNVQlRS\nQUNUOiAvLyB4IC0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVl\nKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVl\nKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhY3Rvcnkuc3VidHJhY3QodmFsMSwgdmFsMik7CgogICAgICAg\nICAgICBjYXNlIEpKVE1VTFRJUExZOiAvLyB4ICogeQogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAg\nICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAg\nICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubXVsdGlwbHkodmFs\nMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVERJVklERTogLy8geCAv\nIHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUp\nKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2Rl\nKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZh\nbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5LmRpdmlkZSh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nQkVUV0VFTjogLy8geC5maWVsZCBbTk9UXSBCRVRXRUVOIDUgQU5EIDEwCiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMCwg\nMykpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKGNoaWxkKG5v\nZGUsIDEsIDMpKTsKICAgICAgICAgICAgICAgIHZhbDMgPSBnZXRWYWx1ZShj\naGlsZChub2RlLCAyLCAzKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNp\ndFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgc2V0\nSW1wbGljaXRUeXBlcyh2YWwxLCB2YWwzLCBudWxsKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBldmFsTm90KG5vdCwgYW5kKGZhY3RvcnkuZ3JlYXRlclRo\nYW5FcXVhbCh2YWwxLCB2YWwyKSwKICAgICAgICAgICAgICAgICAgICBmYWN0\nb3J5Lmxlc3NUaGFuRXF1YWwodmFsMSwgdmFsMykpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUSU46IC8vIHguZmllbGQgW05PVF0gSU4gKCdhJywgJ2InLCAn\nYycpCgogICAgICAgICAgICAgICAgRXhwcmVzc2lvbiBpbkV4cCA9IG51bGw7\nCiAgICAgICAgICAgICAgICBJdGVyYXRvciBpbkl0ZXJhdG9yID0gbm9kZS5p\ndGVyYXRvcigpOwogICAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0IGNoaWxk\nIGlzIHRoZSBwYXRoCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nKEpQUUxOb2RlKSBpbkl0ZXJhdG9yLm5leHQoKSk7CgogICAgICAgICAgICAg\nICAgd2hpbGUgKGluSXRlcmF0b3IuaGFzTmV4dCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgdmFsMiA9IGdldFZhbHVlKChKUFFMTm9kZSkgaW5JdGVyYXRv\nci5uZXh0KCkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGNh\nc2UgZm9yIDx2YWx1ZT4gSU4gKDxzdWJxdWVyeT4pIG9yCiAgICAgICAgICAg\nICAgICAgICAgLy8gPHZhbHVlPiBJTiAoPHNpbmdsZSB2YWx1ZT4pCiAgICAg\nICAgICAgICAgICAgICAgaWYgKCEodmFsMiBpbnN0YW5jZW9mIExpdGVyYWwp\nICYmIG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDIpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBldmFsTm90KG5vdCwgZmFjdG9yeS5jb250YWlu\ncyh2YWwyLCB2YWwxKSk7IAoKICAgICAgICAgICAgICAgICAgICAvLyB0aGlz\nIGlzIGN1cnJlbnRseSBhIHNlcXVlbmNlIG9mIE9SIGV4cHJlc3Npb25zLCBz\naW5jZSB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBoYXZlIHN1\ncHBvcnQgZm9yIElOIGV4cHJlc3Npb25zCiAgICAgICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoaW5FeHAgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgaW5FeHAgPSBmYWN0b3J5LmVxdWFsKHZhbDEsIHZhbDIpOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgaW5FeHAgPSBmYWN0b3J5Lm9yKGluRXhwLCBmYWN0b3J5LmVxdWFsKHZh\nbDEsIHZhbDIpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAvLyB3ZSBhZGRpdGlvbmFsbHkgbmVlZCB0byBhZGQgaW4gYSAiTk9UIE5V\nTEwiIGNsYXVzZSwgc2luY2UKICAgICAgICAgICAgICAgIC8vIHRoZSBJTiBi\nZWhhdmlvciB0aGF0IGlzIGV4cGVjdGVkIGJ5IHRoZSBDVFMgYWxzbyBleHBl\nY3RzCiAgICAgICAgICAgICAgICAvLyB0byBmaWx0ZXIgb3VyIE5VTExzCiAg\nICAgICAgICAgICAgICByZXR1cm4gYW5kKGV2YWxOb3Qobm90LCBpbkV4cCks\nCiAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5ub3RFcXVhbCh2YWwxLCBm\nYWN0b3J5LmdldE51bGwoKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRJU05V\nTEw6IC8vIHguZmllbGQgSVMgW05PVF0gTlVMTAogICAgICAgICAgICAgICAg\naWYgKG5vdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5u\nb3RFcXVhbAogICAgICAgICAgICAgICAgICAgICAgICAoZ2V0VmFsdWUob25s\neUNoaWxkKG5vZGUpKSwgZmFjdG9yeS5nZXROdWxsKCkpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLmVxdWFsCiAgICAgICAgICAgICAgICAgICAgICAgIChnZXRWYWx1ZShvbmx5\nQ2hpbGQobm9kZSkpLCBmYWN0b3J5LmdldE51bGwoKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVFBBVEg6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGF0\naE9yQ29uc3RhbnQobm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVElERU5U\nSUZJRVI6CiAgICAgICAgICAgIGNhc2UgSkpUSURFTlRJRklDQVRJT05WQVJJ\nQUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRJZGVudGlmaWVyKG5v\nZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlROT1Q6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5ub3QoZ2V0RXhwcmVzc2lvbihvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTElLRTogLy8gZmllbGQg\nTElLRSAnJXNvbWV2YWwlJwogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZh\nbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZh\nbHVlKHJpZ2h0KG5vZGUpKTsKCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNp\ndFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgc2V0\nSW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAg\nICAgICAvLyBsb29rIGZvciBhbiBlc2NhcGUgY2hhcmFjdGVyIGJlbmVhdGgg\ndGhlIG5vZGUKICAgICAgICAgICAgICAgIFN0cmluZyBlc2NhcGUgPSBudWxs\nOwogICAgICAgICAgICAgICAgSlBRTE5vZGUgZXNjYXBlTm9kZSA9IHJpZ2h0\nKG5vZGUpLgogICAgICAgICAgICAgICAgICAgIGZpbmRDaGlsZEJ5SUQoSkpU\nRVNDQVBFQ0hBUkFDVEVSLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChl\nc2NhcGVOb2RlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZXNjYXBl\nID0gdHJpbVF1b3Rlcyhvbmx5Q2hpbGQoZXNjYXBlTm9kZSkudGV4dCk7Cgog\nICAgICAgICAgICAgICAgaWYgKG5vdCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5ub3RNYXRjaGVzKHZhbDEsIHZhbDIsICJfIiwgIiUi\nLCBlc2NhcGUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm1hdGNoZXModmFsMSwgdmFsMiwgIl8i\nLCAiJSIsIGVzY2FwZSk7CgogICAgICAgICAgICBjYXNlIEpKVElTRU1QVFk6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsCiAgICAgICAg\nICAgICAgICAgICAgZmFjdG9yeS5pc0VtcHR5KGdldFZhbHVlKG9ubHlDaGls\nZChub2RlKSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU0laRToKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LnNpemUoZ2V0VmFsdWUob25seUNo\naWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFVQUEVSOgogICAg\nICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9T\nVFJJTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudG9VcHBl\nckNhc2UodmFsMSk7CgogICAgICAgICAgICBjYXNlIEpKVExPV0VSOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudG9Mb3dlckNhc2UoZ2V0U3Ry\naW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVExFTkdUSDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN0\ncmluZ0xlbmd0aChnZXRTdHJpbmdWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUQUJTOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3RvcnkuYWJzKGdldE51bWJlclZhbHVlKG9ubHlDaGlsZChub2Rl\nKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTUVJUOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3Rvcnkuc3FydChnZXROdW1iZXJWYWx1ZShvbmx5Q2hp\nbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTU9EOgogICAgICAg\nICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAg\nICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9O\nVU1CRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubW9kKHZh\nbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRUUklNOiAvLyBUUklN\nKFtbd2hlcmVdIFtjaGFyXSBGUk9NXSBmaWVsZCkKICAgICAgICAgICAgICAg\nIHZhbDEgPSBnZXRWYWx1ZShsYXN0Q2hpbGQobm9kZSkpOwogICAgICAgICAg\nICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsKCiAg\nICAgICAgICAgICAgICBCb29sZWFuIHRyaW1XaGVyZSA9IG51bGw7CgogICAg\nICAgICAgICAgICAgSlBRTE5vZGUgZmlyc3RUcmltQ2hpbGQgPSBmaXJzdENo\naWxkKG5vZGUpOwoKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxk\nQ291bnQoKSA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0cmltV2hlcmUg\nPQogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdFRyaW1DaGlsZC5pZCA9\nPSBKSlRUUklNTEVBRElORyA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTVRSQUlMSU5HID8gQm9vbGVh\nbi5GQUxTRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbnVs\nbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBWYWx1ZSB0\ncmltQ2hhcjsKCiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgMyBj\naGlsZHJlbiwgdGhlbiB3ZSBrbm93IHRoZSB0cmltCiAgICAgICAgICAgICAg\nICAvLyBjaGFyIGlzIHRoZSBzZWNvbmQgbm9kZQogICAgICAgICAgICAgICAg\naWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDMpCiAgICAgICAgICAgICAg\nICAgICAgdHJpbUNoYXIgPSBnZXRWYWx1ZShzZWNvbmRDaGlsZChub2RlKSk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHR3byBjaGls\nZHJlbiwgdGhlbiB3ZSBuZWVkIHRvIGNoZWNrIHRvIHNlZQogICAgICAgICAg\nICAgICAgICAgIC8vIGlmIHRoZSBmaXJzdCBjaGlsZCBpcyBhIGxlYWRpbmcv\ndHJhaWxpbmcvYm90aCBub2RlLAogICAgICAgICAgICAgICAgICAgIC8vIG9y\nIHRoZSB0cmltIGNoYXJhY3RlciBub2RlCiAgICAgICAgICAgICAgICBlbHNl\nIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA9PSAyCiAgICAgICAgICAgICAg\nICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTUxFQURJTkcK\nICAgICAgICAgICAgICAgICAgICAmJiBmaXJzdFRyaW1DaGlsZC5pZCAhPSBK\nSlRUUklNVFJBSUxJTkcKICAgICAgICAgICAgICAgICAgICAmJiBmaXJzdFRy\naW1DaGlsZC5pZCAhPSBKSlRUUklNQk9USCkKICAgICAgICAgICAgICAgICAg\nICB0cmltQ2hhciA9IGdldFZhbHVlKGZpcnN0Q2hpbGQobm9kZSkpOwogICAg\nICAgICAgICAgICAgICAgIC8vIG90aHdlcndpc2UsIHdlIGRlZmF1bHQgdG8g\ndHJpbW1pbmcgdGhlIHNwYWNlIGNoYXJhY3RlcgogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0gZmFjdG9yeS5u\nZXdMaXRlcmFsKCIgIiwgTGl0ZXJhbC5UWVBFX1NUUklORyk7CgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkudHJpbSh2YWwxLCB0cmltQ2hhciwg\ndHJpbVdoZXJlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09OQ0FUOgogICAg\nICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAg\nICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwxLCBUWVBFX1NUUklO\nRyk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMiwgVFlQ\nRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY29u\nY2F0KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJTVFJJ\nTkc6CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUoY2hpbGQobm9k\nZSwgMCwgMykpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKGNo\naWxkKG5vZGUsIDEsIDMpKTsKICAgICAgICAgICAgICAgIHZhbDMgPSBnZXRW\nYWx1ZShjaGlsZChub2RlLCAyLCAzKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIEludGVnZXIuVFlQRSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMywgSW50ZWdlci5UWVBF\nKTsKCiAgICAgICAgICAgICAgICAvLyB0aGUgc2VtYW50aWNzIG9mIHRoZSBK\nUFFMIHN1YnN0cmluZygpIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAvLyBh\ncmUgdGhhdCBhcmcyIGlzIHRoZSAxLWJhc2VkIHN0YXJ0IGluZGV4LCBhbmQg\nYXJnMyBpcwogICAgICAgICAgICAgICAgLy8gdGhlIGxlbmd0aCBvZiB0aGUg\nc3RyaW5nIHRvIGJlIHJldHVybjsgdGhpcyBpcyBkaWZmZXJlbnQKICAgICAg\nICAgICAgICAgIC8vIHRoYW4gdGhlIHNlbWFudGljcyBvZiB0aGUgRXhwcmVz\nc2lvbkZhY3RvcnkncyBzdWJzdHJpbmcsCiAgICAgICAgICAgICAgICAvLyB3\naGljaCBtYXRjaGVzIHRoZSBKYXZhIGxhbmd1YWdlICgwLWJhc2VkIHN0YXJ0\nIGluZGV4LAogICAgICAgICAgICAgICAgLy8gYXJnMiBpcyB0aGUgZW5kIGlu\nZGV4KTogd2UgcGVyZm9ybSB0aGUgdHJhbnNsYXRpb24gYnkKICAgICAgICAg\nICAgICAgIC8vIGFkZGluZyBvbmUgdG8gdGhlIGZpcnN0IGFyZ3VtZW50LCBh\nbmQgdGhlbiBhZGRpbmcgdGhlCiAgICAgICAgICAgICAgICAvLyBmaXJzdCBh\ncmd1bWVudCB0byB0aGUgc2Vjb25kIGFyZ3VtZW50IHRvIGdldCB0aGUgZW5k\nSW5kZXgKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAj\nIyMgd2UgY291bGQgZ2V0IHJpZCBvZiBzb21lIG1lc3N5IGV4cHJlc3Npb25z\nIGJ5IGNoZWNraW5nIGZvcgogICAgICAgICAgICAgICAgLy8gdGhlIGNvbW1v\nbiBjYXNlIHdoZXJlIHRoZSBhcmd1bWVudHMgYXJlIHNwZWNpZmllZCBhcwog\nICAgICAgICAgICAgICAgLy8gYSBsaXRlcmFsLCBpbiB3aGljaCBjYXNlIHdl\nIGNvdWxkIGp1c3QgZG8gdGhlIGNhbGN1bGF0aW9ucwogICAgICAgICAgICAg\nICAgLy8gaW4gbWVtb3J5OyBvdGhlcndpc2Ugd2Ugd2luZCB1cCB3aXRoIHVn\nbHkgbG9va2luZyBTUUwgbGlrZToKICAgICAgICAgICAgICAgIC8vIFNFTEVD\nVCAuLi4gRlJPTSAuLi4gdDEKICAgICAgICAgICAgICAgIC8vIChTVUJTVFJJ\nTkcodDEuQVNUUiwgKD8gLSA/KSArIDEsICg/ICsgKD8gLSA/KSkgLSAoKD8g\nLSA/KSkpID0gPykKICAgICAgICAgICAgICAgIC8vIFtwYXJhbXM9KGxvbmcp\nIDIsIChpbnQpIDEsIChsb25nKSAyLCAobG9uZykgMiwgKGludCkgMSwKICAg\nICAgICAgICAgICAgIC8vIChsb25nKSAyLCAoaW50KSAxLCAoU3RyaW5nKSBv\nbwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc3Vic3RyaW5nKHZh\nbDEsIGZhY3RvcnkubmV3QXJndW1lbnRMaXN0CiAgICAgICAgICAgICAgICAg\nICAgKGZhY3Rvcnkuc3VidHJhY3QodmFsMiwgZmFjdG9yeS5uZXdMaXRlcmFs\nCiAgICAgICAgICAgICAgICAgICAgICAgIChOdW1iZXJzLnZhbHVlT2YoMSks\nIExpdGVyYWwuVFlQRV9OVU1CRVIpKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgKGZhY3RvcnkuYWRkKHZhbDMsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAoZmFjdG9yeS5zdWJ0cmFjdCh2YWwyLCBmYWN0b3J5Lm5ld0xpdGVy\nYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoTnVtYmVycy52\nYWx1ZU9mKDEpLCBMaXRlcmFsLlRZUEVfTlVNQkVSKSkpKSkpKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUTE9DQVRFOgogICAgICAgICAgICAgICAgLy8gYXMg\nd2l0aCBTVUJTVFJJTkcgKGFib3ZlKSwgdGhlIHNlbWFudGljcyBmb3IgTE9D\nQVRFIGRpZmZlcgogICAgICAgICAgICAgICAgLy8gZnJvbSBFeHByZXNzaW9u\nRmFjdG9yeS5pbmRleE9mIGluIHRoYXQgTE9DQVRFIHVzZXMgYQogICAgICAg\nICAgICAgICAgLy8gMC1iYXNlZCBpbmRleCwgYW5kIGluZGV4T2YgdXNlcyBh\nIDEtYmFzZWQgaW5kZXgKICAgICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZVBh\ndGggPSBnZXRWYWx1ZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAg\nICAgIFZhbHVlIGxvY2F0ZVNlYXJjaCA9IGdldFZhbHVlKHNlY29uZENoaWxk\nKG5vZGUpKTsKICAgICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZUZyb21JbmRl\neCA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENv\ndW50KCkgPiAyKSAvLyBvcHRpb25hbCBzdGFydCBpbmRleCBhcmcKICAgICAg\nICAgICAgICAgICAgICBsb2NhdGVGcm9tSW5kZXggPSBnZXRWYWx1ZSh0aGly\nZENoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGUobG9jYXRlUGF0aCwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlKGxvY2F0ZVNlYXJjaCwgVFlQRV9TVFJJTkcpOwoK\nICAgICAgICAgICAgICAgIGlmIChsb2NhdGVGcm9tSW5kZXggIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlRnJv\nbUluZGV4LCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuYWRkKGZhY3RvcnkuaW5kZXhPZihsb2NhdGVTZWFyY2gsCiAg\nICAgICAgICAgICAgICAgICAgbG9jYXRlRnJvbUluZGV4ID09IG51bGwgPyBs\nb2NhdGVQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgIDogZmFjdG9yeS5u\nZXdBcmd1bWVudExpc3QobG9jYXRlUGF0aCwKICAgICAgICAgICAgICAgICAg\nICAgICAgZmFjdG9yeS5zdWJ0cmFjdChsb2NhdGVGcm9tSW5kZXgsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmYWN0b3J5Lm5ld0xpdGVyYWwoTnVt\nYmVycy52YWx1ZU9mKDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpKSkpLAogICAgICAgICAgICAgICAg\nICAgIGZhY3RvcnkubmV3TGl0ZXJhbChOdW1iZXJzLnZhbHVlT2YoMSksCiAg\nICAgICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUQUdHUkVHQVRFOgogICAgICAgICAgICAg\nICAgLy8gc2ltcGx5IHBhc3MtdGhyb3VnaCB3aGlsZSBhc3NlcnRpbmcgYSBz\naW5nbGUgY2hpbGQKICAgICAgICAgICAgICAgIHJldHVybiBldmFsKG9ubHlD\naGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVENPVU5UOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY291bnQoZ2V0VmFsdWUobGFz\ndENoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVE1BWDoKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm1heChnZXROdW1iZXJWYWx1\nZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTUlO\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubWluKGdldE51bWJl\nclZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRTVU06CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdW0oZ2V0\nTnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVEFWRVJBR0U6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5hdmcoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVERJU1RJTkNUUEFUSDoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LmRpc3RpbmN0KGdldFZhbHVlKG9ubHlDaGlsZChu\nb2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRFWElTVFM6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5pc05vdEVtcHR5KChWYWx1ZSkgZXZh\nbChvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQU5Z\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYW55KChWYWx1ZSkg\nZXZhbChvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nQUxMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWxsKChWYWx1\nZSkgZXZhbChvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUU1VCU0VMRUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFN1YnF1\nZXJ5KG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlRNRU1CRVJPRjoKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpLCBWQVJf\nUEFUSCk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQo\nbm9kZSksIFZBUl9QQVRIKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nQ29udGFpbnNUeXBlcyh2YWwyLCB2YWwxLCBDT05UQUlOU19UWVBFX0VMRU1F\nTlQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWxOb3Qobm90LCBmYWN0\nb3J5LmNvbnRhaW5zKHZhbDIsIHZhbDEpKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUQ1VSUkVOVERBVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5nZXRDdXJyZW50RGF0ZSgpOwoKICAgICAgICAgICAgY2FzZSBKSlRDVVJS\nRU5UVElNRToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1\ncnJlbnRUaW1lKCk7CgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlRUSU1F\nU1RBTVA6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5nZXRDdXJy\nZW50VGltZXN0YW1wKCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfRkFUQUwsICJiYWQt\ndHJlZSIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2Rl\nIH0sIG51bGwpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9p\nZCBzZXRJbXBsaWNpdFR5cGVzKFZhbHVlIHZhbDEsIFZhbHVlIHZhbDIsIENs\nYXNzIGV4cGVjdGVkKSB7CiAgICAgICAgc3VwZXIuc2V0SW1wbGljaXRUeXBl\ncyh2YWwxLCB2YWwyLCBleHBlY3RlZCk7CgogICAgICAgIC8vIGFzIHdlbGwg\nYXMgc2V0dGluZyB0aGUgdHlwZXMgZm9yIGNvbnZlcnNpb25zLCB3ZSBhbHNv\nIG5lZWQgdG8KICAgICAgICAvLyBlbnN1cmUgdGhhdCBhbnkgcGFyYW1ldGVy\ncyBhcmUgZGVjbGFyZWQgd2l0aCB0aGUgY29ycmVjdCB0eXBlLAogICAgICAg\nIC8vIHNpbmNlIHRoZSBKUEEgc3BlYyBleHBlY3RzIHRoYXQgdGhlc2Ugd2ls\nbCBiZSB2YWxpZGF0ZWQKICAgICAgICBQYXJhbWV0ZXIgcGFyYW0gPSB2YWwx\nIGluc3RhbmNlb2YgUGFyYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMQogICAg\nICAgICAgICA6IHZhbDIgaW5zdGFuY2VvZiBQYXJhbWV0ZXIgPyAoUGFyYW1l\ndGVyKSB2YWwyIDogbnVsbDsKICAgICAgICBQYXRoIHBhdGggPSB2YWwxIGlu\nc3RhbmNlb2YgUGF0aCA/IChQYXRoKSB2YWwxCiAgICAgICAgICAgIDogdmFs\nMiBpbnN0YW5jZW9mIFBhdGggPyAoUGF0aCkgdmFsMiA6IG51bGw7CgogICAg\nICAgIC8vIHdlIG9ubHkgY2hlY2sgZm9yIHBhcmFtZXRlci10by1wYXRoIGNv\nbXBhcmlzb25zCiAgICAgICAgaWYgKHBhcmFtID09IG51bGwgfHwgcGF0aCA9\nPSBudWxsIHx8IHBhcmFtZXRlclR5cGVzID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRoLmxh\nc3QoKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgQ2xhc3MgdHlwZSA9IHBhdGguaXNYUGF0aCgpID8g\ncGF0aC5nZXRUeXBlKCkgOiBmbWQuZ2V0VHlwZSgpOwogICAgICAgIGlmICh0\neXBlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3Ry\naW5nIHBhcmFtTmFtZSA9IHBhcmFtLmdldFBhcmFtZXRlck5hbWUoKTsKICAg\nICAgICBpZiAocGFyYW1OYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgYWxyZWFkeSBkZWNs\nYXJlZCB0aGUgcGFyYW1ldGVyCiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVz\nLmNvbnRhaW5zS2V5KHBhcmFtTmFtZSkpCiAgICAgICAgICAgIHBhcmFtZXRl\nclR5cGVzLnB1dChwYXJhbU5hbWUsIHR5cGUpOwogICAgfQoKICAgIHByaXZh\ndGUgVmFsdWUgZ2V0U3RyaW5nVmFsdWUoSlBRTE5vZGUgbm9kZSkgewogICAg\nICAgIHJldHVybiBnZXRUeXBlVmFsdWUobm9kZSwgVFlQRV9TVFJJTkcpOwog\nICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0TnVtYmVyVmFsdWUoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIHJldHVybiBnZXRUeXBlVmFsdWUobm9kZSwg\nVFlQRV9OVU1CRVIpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0VHlw\nZVZhbHVlKEpQUUxOb2RlIG5vZGUsIENsYXNzIGltcGxpY2l0VHlwZSkgewog\nICAgICAgIFZhbHVlIHZhbCA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIHNl\ndEltcGxpY2l0VHlwZSh2YWwsIGltcGxpY2l0VHlwZSk7CiAgICAgICAgcmV0\ndXJuIHZhbDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFN1YnF1ZXJ5\nKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBmaW5hbCBib29sZWFuIHN1YmNs\nYXNzZXMgPSB0cnVlOwogICAgICAgIFN0cmluZyBhbGlhcyA9IG5leHRBbGlh\ncygpOwoKICAgICAgICAvLyBwYXJzZSB0aGUgc3VicXVlcnkKICAgICAgICBQ\nYXJzZWRKUFFMIHBhcnNlZCA9IG5ldyBQYXJzZWRKUFFMKG5vZGUucGFyc2Vy\nLmpwcWwsIG5vZGUpOwoKICAgICAgICBDbGFzc01ldGFEYXRhIGNhbmRpZGF0\nZSA9IGdldENhbmRpZGF0ZU1ldGFEYXRhKG5vZGUpOwogICAgICAgIFN1YnF1\nZXJ5IHN1YnEgPSBmYWN0b3J5Lm5ld1N1YnF1ZXJ5KGNhbmRpZGF0ZSwgc3Vi\nY2xhc3NlcywgYWxpYXMpOwogICAgICAgIHN1YnEuc2V0TWV0YURhdGEoY2Fu\nZGlkYXRlKTsKCiAgICAgICAgY29udGV4dHMucHVzaChuZXcgQ29udGV4dChw\nYXJzZWQsIHN1YnEpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgUXVl\ncnlFeHByZXNzaW9ucyBzdWJleHAgPSBnZXRRdWVyeUV4cHJlc3Npb25zKCk7\nCiAgICAgICAgICAgIHN1YnEuc2V0UXVlcnlFeHByZXNzaW9ucyhzdWJleHAp\nOwogICAgICAgICAgICByZXR1cm4gc3VicTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAvLyByZW1vdmUgdGhlIHN1YnF1ZXJ5IHBhcnNlIGNv\nbnRleHQKICAgICAgICAgICAgY29udGV4dHMucG9wKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBuYW1lcyBhbmQgb3Jk\nZXIgb2YgaW1wbGljaXQgcGFyYW1ldGVycy4KICAgICAqLwogICAgcHJpdmF0\nZSBQYXJhbWV0ZXIgZ2V0UGFyYW1ldGVyKFN0cmluZyBpZCwgYm9vbGVhbiBw\nb3NpdGlvbmFsKSB7CiAgICAgICAgaWYgKHBhcmFtZXRlclR5cGVzID09IG51\nbGwpCiAgICAgICAgICAgIHBhcmFtZXRlclR5cGVzID0gbmV3IExpbmtlZE1h\ncCg2KTsKICAgICAgICBpZiAoIXBhcmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5\nKGlkKSkKICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXMucHV0KGlkLCBUWVBF\nX09CSkVDVCk7CgogICAgICAgIENsYXNzIHR5cGUgPSBPYmplY3QuY2xhc3M7\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbnVsbDsKICAgICAgICBp\nbnQgaW5kZXg7CgogICAgICAgIGlmIChwb3NpdGlvbmFsKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBpbmRleGVzIGluIEpQUUwg\nYXJlIDEtYmFzZWQsIGFzIG9wcG9zZWQgdG8gMC1iYXNlZCBpbgogICAgICAg\nICAgICAgICAgLy8gdGhlIGNvcmUgRXhwcmVzc2lvbkZhY3RvcnkKICAgICAg\nICAgICAgICAgIGluZGV4ID0gSW50ZWdlci5wYXJzZUludChpZCkgLSAxOwog\nICAgICAgICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNF\nUiwgImJhZC1wb3NpdGlvbmFsLXBhcmFtZXRlciIsCiAgICAgICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdeyBpZCB9LCBlKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJiYWQtcG9zaXRpb25hbC1w\nYXJhbWV0ZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsg\naWQgfSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g\nb3RoZXJ3aXNlIHRoZSBpbmRleCBpcyBqdXN0IHRoZSBjdXJyZW50IHNpemUg\nb2YgdGhlIHBhcmFtcwogICAgICAgICAgICBpbmRleCA9IHBhcmFtZXRlclR5\ncGVzLmluZGV4T2YoaWQpOwogICAgICAgIH0KCiAgICAgICAgUGFyYW1ldGVy\nIHBhcmFtID0gZmFjdG9yeS5uZXdQYXJhbWV0ZXIoaWQsIHR5cGUpOwogICAg\nICAgIHBhcmFtLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgIHBhcmFtLnNl\ndEluZGV4KGluZGV4KTsKCiAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgfQoK\nICAgIC8qKgogICAgICogQ2hlY2tzIHRvIHNlZSBpZiB3ZSBzaG91bGQgZXZh\nbHVhdGUgZm9yIGEgTk9UIGV4cHJlc3Npb24uCiAgICAgKi8KICAgIHByaXZh\ndGUgRXhwcmVzc2lvbiBldmFsTm90KGJvb2xlYW4gbm90LCBFeHByZXNzaW9u\nIGV4cCkgewogICAgICAgIHJldHVybiBub3QgPyBmYWN0b3J5Lm5vdChleHAp\nIDogZXhwOwogICAgfQoKICAgIC8qKgogICAgICogVHJpbSBvZmYgbGVhZGlu\nZyBhbmQgdHJhaWxpbmcgc2luZ2xlLXF1b3RlcywgYW5kIHRoZW4KICAgICAq\nIHJlcGxhY2UgYW55IGludGVybmFsICcnIGluc3RhbmNlcyB3aXRoICcgKHNp\nbmNlIHJlcGVhdGluZyB0aGUKICAgICAqIHF1b3RlIGlzIHRoZSBKUFFMIG1l\nY2hhbmlzbSBvZiBlc2NhcGluZyBhIHNpbmdsZSBxdW90ZSkuCiAgICAgKi8K\nICAgIHByaXZhdGUgU3RyaW5nIHRyaW1RdW90ZXMoU3RyaW5nIHN0cikgewog\nICAgICAgIGlmIChzdHIgPT0gbnVsbCB8fCBzdHIubGVuZ3RoKCkgPD0gMSkK\nICAgICAgICAgICAgcmV0dXJuIHN0cjsKCiAgICAgICAgaWYgKHN0ci5zdGFy\ndHNXaXRoKCInIikgJiYgc3RyLmVuZHNXaXRoKCInIikpCiAgICAgICAgICAg\nIHN0ciA9IHN0ci5zdWJzdHJpbmcoMSwgc3RyLmxlbmd0aCgpIC0gMSk7Cgog\nICAgICAgIGludCBpbmRleCA9IC0xOwoKICAgICAgICB3aGlsZSAoKGluZGV4\nID0gc3RyLmluZGV4T2YoIicnIiwgaW5kZXggKyAxKSkgIT0gLTEpCiAgICAg\nICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgaW5kZXggKyAxKSArIHN0\nci5zdWJzdHJpbmcoaW5kZXggKyAyKTsKCiAgICAgICAgcmV0dXJuIHN0cjsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFuIEludGVnZXJMaXRlcmFsIGFuZCBE\nZWNpbWFsTGl0ZXJhbCBub2RlIHdpbGwKICAgICAqIGhhdmUgYSBjaGlsZCBu\nb2RlIG9mIE5lZ2F0aXZlIGlmIGl0IGlzIG5lZ2F0aXZlOgogICAgICogaWYg\nc28sIHRoaXMgbWV0aG9kIHJldHVybnMgLTEsIGVsc2UgaXQgcmV0dXJucyAx\nLgogICAgICovCiAgICBwcml2YXRlIHNob3J0IG5lZ2F0aXZlKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAhPSBudWxsICYm\nIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09IDEKICAgICAgICAgICAgJiYgZmly\nc3RDaGlsZChub2RlKS5pZCA9PSBKSlRORUdBVElWRSkKICAgICAgICAgICAg\ncmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDE7\nCiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRJZGVudGlmaWVyKEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICBmaW5hbCBTdHJpbmcgbmFtZSA9IG5vZGUu\ndGV4dDsKICAgICAgICBmaW5hbCBWYWx1ZSB2YWwgPSBnZXRWYXJpYWJsZShu\nYW1lLCBmYWxzZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gZ2V0\nTWV0YURhdGFGb3JBbGlhcyhuYW1lKTsKCiAgICAgICAgaWYgKGNtZCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0\naGUgY2xhc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAgICAgLy8gZm9y\nIHRoZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRo\naXMpCiAgICAgICAgICAgIFZhbHVlIHRoaXogPSBmYWN0b3J5LmdldFRoaXMo\nKTsKICAgICAgICAgICAgdGhpei5zZXRNZXRhRGF0YShjbWQpOwogICAgICAg\nICAgICByZXR1cm4gdGhpejsKICAgICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0\nYW5jZW9mIFBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuIChQYXRoKSB2YWw7\nCiAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBWYWx1ZSkgewog\nICAgICAgICAgICByZXR1cm4gKFZhbHVlKSB2YWw7CiAgICAgICAgfQoKICAg\nICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAidW5rbm93bi1p\nZGVudGlmaWVyIiwKICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBuYW1lIH0s\nIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0UGF0aE9yQ29u\nc3RhbnQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIC8vIGZpcnN0IGNoZWNr\nIHRvIHNlZSBpZiB0aGUgcGF0aCBpcyBhbiBlbnVtIG9yIHN0YXRpYyBmaWVs\nZCwgYW5kCiAgICAgICAgLy8gaWYgc28sIGxvYWQgaXQKICAgICAgICBTdHJp\nbmcgY2xhc3NOYW1lID0gYXNzZW1ibGUobm9kZSwgIi4iLCAxKTsKICAgICAg\nICBDbGFzcyBjID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKGNsYXNzTmFtZSwg\nbnVsbCk7CiAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICBT\ndHJpbmcgZmllbGROYW1lID0gbGFzdENoaWxkKG5vZGUpLnRleHQ7CgogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgRmllbGQgZmllbGQgPSBj\nLmdldEZpZWxkKGZpZWxkTmFtZSk7CiAgICAgICAgICAgICAgICBPYmplY3Qg\ndmFsdWUgPSBmaWVsZC5nZXQobnVsbCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5uZXdMaXRlcmFsKHZhbHVlLCBMaXRlcmFsLlRZUEVfVU5L\nTk9XTik7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaEZpZWxkRXhjZXB0\naW9uIG5zZmUpIHsKICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0\naW9uKEVYX1VTRVIsICJuby1maWVsZCIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBjbGFzc05hbWUsIGZpZWxkTmFtZSB9LCBuc2ZlKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmFjY2Vz\nc2libGUtZmllbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgY2xhc3NOYW1lLCBmaWVsZE5hbWUgfSwgZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0UGF0aChu\nb2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgUGF0aCBnZXRQYXRoKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1\ncm4gZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJp\ndmF0ZSBQYXRoIGdldFBhdGgoSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiBwY09u\nbHksIGJvb2xlYW4gaW5uZXIpIHsKICAgICAgICAvLyByZXNvbHZlIHRoZSBm\naXJzdCBlbGVtZW50IGFnYWluc3QgdGhlIGFsaWFzZXMgbWFwIC4uLgogICAg\nICAgIC8vIGkuZS4sIHRoZSBwYXRoICJTRUxFQ1QgeC5pZCBGUk9NIFNvbWVD\nbGFzcyB4IHdoZXJlIHguaWQgPiAxMCIKICAgICAgICAvLyB3aWxsIG5lZWQg\ndG8gaGF2ZSAieCIgaW4gdGhlIGFsaWFzIG1hcCBpbiBvcmRlciB0byByZXNv\nbHZlCiAgICAgICAgUGF0aCBwYXRoOwoKICAgICAgICBmaW5hbCBTdHJpbmcg\nbmFtZSA9IGZpcnN0Q2hpbGQobm9kZSkudGV4dDsKICAgICAgICBmaW5hbCBW\nYWx1ZSB2YWwgPSBnZXRWYXJpYWJsZShuYW1lLCBmYWxzZSk7CgogICAgICAg\nIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xhc3MgbmFtZSBpcyB0\naGUgYWxpYXMKICAgICAgICAvLyBmb3IgdGhlIGNhbmRpZGF0ZSAod2UgZG9u\nJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhpcykKICAgICAgICBpZiAobmFtZS5l\ncXVhbHNJZ25vcmVDYXNlKGN0eCgpLnNjaGVtYUFsaWFzKSkgewogICAgICAg\nICAgICBpZiAoY3R4KCkuc3VicXVlcnkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0aChjdHgoKS5zdWJxdWVyeSk7\nCiAgICAgICAgICAgICAgICBwYXRoLnNldE1ldGFEYXRhKGN0eCgpLnN1YnF1\nZXJ5LmdldE1ldGFEYXRhKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0aCgpOwogICAgICAg\nICAgICAgICAgcGF0aC5zZXRNZXRhRGF0YShjdHgoKS5tZXRhKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZ2V0TWV0YURhdGFGb3JBbGlh\ncyhuYW1lKSAhPSBudWxsKQogICAgICAgICAgICBwYXRoID0gbmV3UGF0aChu\ndWxsLCBnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBQYXRoKQogICAgICAgICAgICBwYXRoID0g\nKFBhdGgpIHZhbDsKICAgICAgICBlbHNlIGlmICh2YWwuZ2V0TWV0YURhdGEo\nKSAhPSBudWxsKQogICAgICAgICAgICBwYXRoID0gbmV3UGF0aCh2YWwsIHZh\nbC5nZXRNZXRhRGF0YSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRoLW5vLW1ldGEiLAog\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhc3NlbWJsZShub2RlKSwg\nbnVsbCB9LCBudWxsKTsKCiAgICAgICAgLy8gd2FsayB0aHJvdWdoIHRoZSBj\naGlsZHJlbiBhbmQgYXNzZW1ibGUgdGhlIHBhdGgKICAgICAgICBib29sZWFu\nIGFsbG93TnVsbCA9ICFpbm5lcjsKICAgICAgICBmb3IgKGludCBpID0gMTsg\naSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\naWYgKHBhdGguaXNYUGF0aCgpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBqID0gaTsgaiA8bm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykKICAgICAg\nICAgICAgICAgICAgICBwYXRoID0gKFBhdGgpIHRyYXZlcnNlWFBhdGgocGF0\naCwgbm9kZS5jaGlsZHJlbltqXS50ZXh0KTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBwYXRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhdGggPSAo\nUGF0aCkgdHJhdmVyc2VQYXRoKHBhdGgsIG5vZGUuY2hpbGRyZW5baV0udGV4\ndCwgcGNPbmx5LAogICAgICAgICAgICAgICAgYWxsb3dOdWxsKTsKCiAgICAg\nICAgICAgIC8vIGFsbCB0cmF2ZXJzYWxzIGJ1dCB0aGUgZmlyc3Qgb25lIHdp\nbGwgYWx3YXlzIGJlIGlubmVyIGpvaW5zCiAgICAgICAgICAgIGFsbG93TnVs\nbCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBhdGg7CiAg\nICB9CgogICAgcHJvdGVjdGVkIENsYXNzIGdldERlY2xhcmVkVmFyaWFibGVU\neXBlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQg\nPSBnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpOwogICAgICAgIGlmIChjbWQg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNtZC5nZXREZXNjcmliZWRU\neXBlKCk7CgogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgbmFtZS5lcXVh\nbHMoY3R4KCkuc2NoZW1hQWxpYXMpKQogICAgICAgICAgICByZXR1cm4gZ2V0\nQ2FuZGlkYXRlVHlwZSgpOwoKICAgICAgICAvLyBKUFFMIGhhcyBubyBkZWNs\nYXJlZCB2YXJpYWJsZXMKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgYW4gRXhwcmVzc2lvbiBmb3IgdGhlIGdp\ndmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8KICAgIHByaXZhdGUg\nRXhwcmVzc2lvbiBnZXRFeHByZXNzaW9uKEpQUUxOb2RlIG5vZGUpIHsKICAg\nICAgICBPYmplY3QgZXhwID0gZXZhbChub2RlKTsKCiAgICAgICAgLy8gY2hl\nY2sgZm9yIGJvb2xlYW4gdmFsdWVzIHVzZWQgYXMgZXhwcmVzc2lvbnMKICAg\nICAgICBpZiAoIShleHAgaW5zdGFuY2VvZiBFeHByZXNzaW9uKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuYXNFeHByZXNzaW9uKChWYWx1ZSkgZXhw\nKTsKICAgICAgICByZXR1cm4gKEV4cHJlc3Npb24pIGV4cDsKICAgIH0KCiAg\nICBwcml2YXRlIFZhbHVlIGdldFZhbHVlKEpQUUxOb2RlIG5vZGUpIHsKICAg\nICAgICByZXR1cm4gZ2V0VmFsdWUobm9kZSwgVkFSX1BBVEgpOwogICAgfQoK\nICAgIHByaXZhdGUgUGF0aCBuZXdQYXRoKFZhbHVlIHZhbCwgQ2xhc3NNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgUGF0aCBwYXRoID0gdmFsID09IG51bGwg\nPyBmYWN0b3J5Lm5ld1BhdGgoKSA6IGZhY3RvcnkubmV3UGF0aCh2YWwpOwog\nICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgIHBhdGguc2V0\nTWV0YURhdGEobWV0YSk7CiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgVmFsdWUgZm9yIHRoZSBnaXZlbiBu\nb2RlIGJ5IGV2YWwnaW5nIGl0LgogICAgICovCiAgICBwcml2YXRlIFZhbHVl\nIGdldFZhbHVlKEpQUUxOb2RlIG5vZGUsIGludCBoYW5kbGVWYXIpIHsKICAg\nICAgICBWYWx1ZSB2YWwgPSAoVmFsdWUpIGV2YWwobm9kZSk7CgogICAgICAg\nIC8vIGRldGVybWluZCBob3cgdG8gZXZhdWF0ZSBhIHZhcmlhYmUKICAgICAg\nICBpZiAoIXZhbC5pc1ZhcmlhYmxlKCkpCiAgICAgICAgICAgIHJldHVybiB2\nYWw7CiAgICAgICAgZWxzZSBpZiAoaGFuZGxlVmFyID09IFZBUl9QQVRIICYm\nICEodmFsIGluc3RhbmNlb2YgUGF0aCkpCiAgICAgICAgICAgIHJldHVybiBu\nZXdQYXRoKHZhbCwgdmFsLmdldE1ldGFEYXRhKCkpOwogICAgICAgIGVsc2Ug\naWYgKGhhbmRsZVZhciA9PSBWQVJfRVJST1IpCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmV4cGVjdGVkLXZhciIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUudGV4dCB9LCBudWxs\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUGFy\nc2UgQ29udGV4dCBNYW5hZ2VtZW50CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgcHJpdmF0ZSBDb250ZXh0IGN0eCgpIHsKICAgICAg\nICByZXR1cm4gKENvbnRleHQpIGNvbnRleHRzLnBlZWsoKTsKICAgIH0KCiAg\nICBwcml2YXRlIEpQUUxOb2RlIHJvb3QoKSB7CiAgICAgICAgcmV0dXJuIGN0\neCgpLnBhcnNlZC5yb290OwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRh\nRGF0YSBnZXRNZXRhRGF0YUZvckFsaWFzKFN0cmluZyBhbGlhcykgewogICAg\nICAgIGZvciAoaW50IGkgPSBjb250ZXh0cy5zaXplKCkgLSAxOyBpID49IDA7\nIGktLSkgewogICAgICAgICAgICBDb250ZXh0IGNvbnRleHQgPSAoQ29udGV4\ndCkgY29udGV4dHMuZ2V0KGkpOwogICAgICAgICAgICBpZiAoYWxpYXMuZXF1\nYWxzSWdub3JlQ2FzZShjb250ZXh0LnNjaGVtYUFsaWFzKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBjb250ZXh0Lm1ldGE7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIENvbnRl\neHQgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFBhcnNlZEpQUUwgcGFyc2Vk\nOwogICAgICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAg\nIHByaXZhdGUgU3RyaW5nIHNjaGVtYUFsaWFzOwogICAgICAgIHByaXZhdGUg\nU3VicXVlcnkgc3VicXVlcnk7CgogICAgICAgIENvbnRleHQoUGFyc2VkSlBR\nTCBwYXJzZWQsIFN1YnF1ZXJ5IHN1YnF1ZXJ5KSB7CiAgICAgICAgICAgIHRo\naXMucGFyc2VkID0gcGFyc2VkOwogICAgICAgICAgICB0aGlzLnN1YnF1ZXJ5\nID0gc3VicXVlcnk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vZGUgdHJhdmVyc2FsIHV0aWxp\ndGllcwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHBy\naXZhdGUgSlBRTE5vZGUgb25seUNoaWxkKEpQUUxOb2RlIG5vZGUpCiAgICAg\nICAgdGhyb3dzIFVzZXJFeGNlcHRpb24gewogICAgICAgIEpQUUxOb2RlIGNo\naWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAgICAgaWYgKG5vZGUuY2hp\nbGRyZW4ubGVuZ3RoID4gMSkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgIm11bHRpLWNoaWxkcmVuIiwKICAgICAgICAgICAg\nICAgIG5ldyBPYmplY3RbXXsgbm9kZSwgQXJyYXlzLmFzTGlzdChub2RlLmNo\naWxkcmVuKSB9LCBudWxsKTsKCiAgICAgICAgcmV0dXJuIGNoaWxkOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgbGVmdCBub2RlICh0aGUg\nZmlyc3Qgb2YgdGhlIGNoaWxkcmVuKSwgYW5kIGFzc2VydHMKICAgICAqIHRo\nYXQgdGhlcmUgYXJlIGV4YWN0bHkgdHdvIGNoaWxkcmVuLgogICAgICovCiAg\nICBwcml2YXRlIEpQUUxOb2RlIGxlZnQoSlBRTE5vZGUgbm9kZSkgewogICAg\nICAgIHJldHVybiBjaGlsZChub2RlLCAwLCAyKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIHJpZ2h0IG5vZGUgKHRoZSBzZWNvbmQgb2Yg\ndGhlIGNoaWxkcmVuKSwgYW5kIGFzc2VydHMKICAgICAqIHRoYXQgdGhlcmUg\nYXJlIGV4YWN0bHkgdHdvIGNoaWxkcmVuLgogICAgICovCiAgICBwcml2YXRl\nIEpQUUxOb2RlIHJpZ2h0KEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1\ncm4gY2hpbGQobm9kZSwgMSwgMik7CiAgICB9CgogICAgcHJpdmF0ZSBKUFFM\nTm9kZSBjaGlsZChKUFFMTm9kZSBub2RlLCBpbnQgY2hpbGROdW0sIGludCBh\nc3NlcnRDb3VudCkgewogICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0\naCAhPSBhc3NlcnRDb3VudCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgIndyb25nLWNoaWxkLWNvdW50IiwKICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgbmV3IEludGVnZXIoYXNzZXJ0Q291bnQp\nLCBub2RlLAogICAgICAgICAgICAgICAgICAgIEFycmF5cy5hc0xpc3Qobm9k\nZS5jaGlsZHJlbikgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBub2RlLmNo\naWxkcmVuW2NoaWxkTnVtXTsKICAgIH0KCiAgICBwcml2YXRlIEpQUUxOb2Rl\nIGZpcnN0Q2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGlmIChub2Rl\nLmNoaWxkcmVuID09IG51bGwgfHwgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwg\nIm5vLWNoaWxkcmVuIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsg\nbm9kZSB9LCBudWxsKTsKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlblsw\nXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSBzZWNvbmRD\naGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIG5vZGUuY2hp\nbGRyZW5bMV07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUg\ndGhpcmRDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIG5v\nZGUuY2hpbGRyZW5bMl07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgSlBR\nTE5vZGUgbGFzdENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1\ncm4gbGFzdENoaWxkKG5vZGUsIDApOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIE50aCBmcm9tIHRoZSBsYXN0IGNoaWxkLiBFLmcuLAogICAgICogbGFz\ndENoaWxkKDEpIHdpbGwgcmV0dXJuIHRoZSBzZWNvbmQtdG8tdGhlLWxhc3Qg\nY2hpbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIGxh\nc3RDaGlsZChKUFFMTm9kZSBub2RlLCBpbnQgZnJvbUxhc3QpIHsKICAgICAg\nICByZXR1cm4gbm9kZS5jaGlsZHJlbltub2RlLmNoaWxkcmVuLmxlbmd0aCAt\nICgxICsgZnJvbUxhc3QpXTsKICAgIH0KCiAgICAvKioKICAgICAqIEJhc2Ug\nbm9kZSB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkIGJ5IHRoZSBKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXI7IGJhc2UKICAgICAqIGNsYXNzIG9mIHRoZSB7QGxpbmsg\nU2ltcGxlTm9kZX0gdGhhdCBpcyB1c2VkIGJ5IHtAbGluayBKUFFMfS4KICAg\nICAqCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogICAgICog\nQHNlZSBOb2RlCiAgICAgKiBAc2VlIFNpbXBsZU5vZGUKICAgICAqLwogICAg\ncHJvdGVjdGVkIGFic3RyYWN0IHN0YXRpYyBjbGFzcyBKUFFMTm9kZQogICAg\nICAgIGltcGxlbWVudHMgTm9kZSwgU2VyaWFsaXphYmxlIHsKCiAgICAgICAg\nZmluYWwgaW50IGlkOwogICAgICAgIGZpbmFsIEpQUUwgcGFyc2VyOwogICAg\nICAgIEpQUUxOb2RlIHBhcmVudDsKICAgICAgICBKUFFMTm9kZVtdIGNoaWxk\ncmVuOwogICAgICAgIFN0cmluZyB0ZXh0OwogICAgICAgIGJvb2xlYW4gbm90\nID0gZmFsc2U7CgogICAgICAgIHB1YmxpYyBKUFFMTm9kZShKUFFMIHBhcnNl\nciwgaW50IGlkKSB7CiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsKICAgICAg\nICAgICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBqanRPcGVuKCkgewogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgamp0Q2xvc2UoKSB7CiAgICAgICAgfQoKICAgICAgICBK\nUFFMTm9kZVtdIGZpbmRDaGlsZHJlbkJ5SUQoaW50IGlkKSB7CiAgICAgICAg\nICAgIENvbGxlY3Rpb24gc2V0ID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAg\nICAgZmluZENoaWxkcmVuQnlJRChpZCwgc2V0KTsKICAgICAgICAgICAgcmV0\ndXJuIChKUFFMTm9kZVtdKSBzZXQudG9BcnJheShuZXcgSlBRTE5vZGVbc2V0\nLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGZp\nbmRDaGlsZHJlbkJ5SUQoaW50IGlkLCBDb2xsZWN0aW9uIHNldCkgewogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgY2hpbGRyZW4gIT0gbnVsbCAmJiBp\nIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlm\nIChjaGlsZHJlbltpXS5pZCA9PSBpZCkKICAgICAgICAgICAgICAgICAgICBz\nZXQuYWRkKGNoaWxkcmVuW2ldKTsKCiAgICAgICAgICAgICAgICBjaGlsZHJl\nbltpXS5maW5kQ2hpbGRyZW5CeUlEKGlkLCBzZXQpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGhhc0NoaWxkSUQoaW50IGlk\nKSB7CiAgICAgICAgICAgIHJldHVybiBmaW5kQ2hpbGRCeUlEKGlkLCBmYWxz\nZSkgIT0gbnVsbDsKICAgICAgICB9CgogICAgICAgIEpQUUxOb2RlIGZpbmRD\naGlsZEJ5SUQoaW50IGlkLCBib29sZWFuIHJlY3Vyc2UpIHsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGNoaWxkcmVuICE9IG51bGwgJiYgaSA8IGNo\naWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBKUFFMTm9k\nZSBjaGlsZCA9IGNoaWxkcmVuW2ldOwoKICAgICAgICAgICAgICAgIGlmIChj\naGlsZC5pZCA9PSBpZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hp\nbGRyZW5baV07CgogICAgICAgICAgICAgICAgaWYgKHJlY3Vyc2UpIHsKICAg\nICAgICAgICAgICAgICAgICBKUFFMTm9kZSBmb3VuZCA9IGNoaWxkLmZpbmRD\naGlsZEJ5SUQoaWQsIHJlY3Vyc2UpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChmb3VuZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZm91bmQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIG5vdCBmb3VuZAogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGpqdFNldFBhcmVu\ndChOb2RlIHBhcmVudCkgewogICAgICAgICAgICB0aGlzLnBhcmVudCA9IChK\nUFFMTm9kZSkgcGFyZW50OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5v\nZGUgamp0R2V0UGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5w\nYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBqanRBZGRD\naGlsZChOb2RlIG4sIGludCBpKSB7CiAgICAgICAgICAgIGlmIChjaGlsZHJl\nbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IG5ldyBK\nUFFMTm9kZVtpICsgMV07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+PSBj\naGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIEpQUUxOb2RlIGNb\nXSA9IG5ldyBKUFFMTm9kZVtpICsgMV07CiAgICAgICAgICAgICAgICBTeXN0\nZW0uYXJyYXljb3B5KGNoaWxkcmVuLCAwLCBjLCAwLCBjaGlsZHJlbi5sZW5n\ndGgpOwogICAgICAgICAgICAgICAgY2hpbGRyZW4gPSBjOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBjaGlsZHJlbltpXSA9IChKUFFMTm9kZSkgbjsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOb2RlIGpqdEdldENoaWxkKGlu\ndCBpKSB7CiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbltpXTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0Q2hpbGRDb3VudCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGpqdEdldE51bUNoaWxkcmVuKCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSlBRTE5vZGUgZ2V0Q2hpbGQoaW50IGluZGV4\nKSB7CiAgICAgICAgICAgIHJldHVybiAoSlBRTE5vZGUpIGpqdEdldENoaWxk\nKGluZGV4KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBp\ndGVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3Qo\nY2hpbGRyZW4pLml0ZXJhdG9yKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGpqdEdldE51bUNoaWxkcmVuKCkgewogICAgICAgICAgICByZXR1\ncm4gKGNoaWxkcmVuID09IG51bGwpID8gMCA6IGNoaWxkcmVuLmxlbmd0aDsK\nICAgICAgICB9CgogICAgICAgIHZvaWQgc2V0VGV4dChTdHJpbmcgdGV4dCkg\newogICAgICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBzZXRUb2tlbihUb2tlbiB0KSB7CiAgICAgICAgICAgIHNl\ndFRleHQodC5pbWFnZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gSlBRTFRyZWVD\nb25zdGFudHMuamp0Tm9kZU5hbWVbdGhpcy5pZF07CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKFN0cmluZyBwcmVmaXgpIHsK\nICAgICAgICAgICAgcmV0dXJuIHByZWZpeCArIHRvU3RyaW5nKCk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBEZWJ1Z2dpbmcgbWV0aG9k\nLgogICAgICAgICAqCiAgICAgICAgICogQHNlZSAjZHVtcChqYXZhLmlvLlBy\naW50U3RyZWFtLFN0cmluZykKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBkdW1wKFN0cmluZyBwcmVmaXgpIHsKICAgICAgICAgICAgZHVtcChT\neXN0ZW0ub3V0LCBwcmVmaXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgZHVtcCgpIHsKICAgICAgICAgICAgZHVtcCgiICIpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVidWdnaW5nIG1ldGhvZCB0\nbyBvdXRwdXQgYSBwYXJzZSB0cmVlLgogICAgICAgICAqCiAgICAgICAgICog\nQHBhcmFtIG91dCB0aGUgc3RyZWFtIHRvIHdoaWNoIHRvIHdyaXRlIHRoZSBk\nZWJ1Z2dpbmcgaW5mbwogICAgICAgICAqIEBwYXJhbSBwcmVmaXggdGhlIHBy\nZWZpeCB0byB3cml0ZSBvdXQgYmVmb3JlIGxpbmVzCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIHZvaWQgZHVtcChQcmludFN0cmVhbSBvdXQsIFN0cmlu\nZyBwcmVmaXgpIHsKICAgICAgICAgICAgZHVtcChvdXQsIHByZWZpeCwgZmFs\nc2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZHVtcChQcmlu\ndFN0cmVhbSBvdXQsIFN0cmluZyBwcmVmaXgsIGJvb2xlYW4gdGV4dCkgewog\nICAgICAgICAgICBvdXQucHJpbnRsbih0b1N0cmluZyhwcmVmaXgpCiAgICAg\nICAgICAgICAgICArICh0ZXh0ICYmIHRoaXMudGV4dCAhPSBudWxsID8gIiBb\nIiArIHRoaXMudGV4dCArICJdIiA6ICIiKSk7CiAgICAgICAgICAgIGlmIChj\naGlsZHJlbiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAg\nICAgICAgICAgSlBRTE5vZGUgbiA9IChKUFFMTm9kZSkgY2hpbGRyZW5baV07\nCiAgICAgICAgICAgICAgICAgICAgaWYgKG4gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBuLmR1bXAob3V0LCBwcmVmaXggKyAiICIsIHRl\neHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFB1YmxpYyBmb3IgdW5pdCB0ZXN0aW5nIHB1cnBvc2VzLgogICAgICogQG5v\namF2YWRvYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFBhcnNl\nZEpQUUwKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAg\nICAgIHByb3RlY3RlZCBmaW5hbCBKUFFMTm9kZSByb290OwogICAgICAgIHBy\nb3RlY3RlZCBmaW5hbCBTdHJpbmcgcXVlcnk7CiAgICAgICAgCiAgICAgICAg\nLy8gY2FjaGUgb2YgY2FuZGlkYXRlIHR5cGUgZGF0YS4gVGhpcyBpcyBzdG9y\nZWQgaGVyZSBpbiBjYXNlIHRoaXMgIAogICAgICAgIC8vIHBhcnNlIHRyZWUg\naXMgcmV1c2VkIGluIGEgY29udGV4dCB0aGF0IGRvZXMgbm90IGtub3cgd2hh\ndCB0aGUgCiAgICAgICAgLy8gY2FuZGlkYXRlIHR5cGUgaXMgYWxyZWFkeS4g\nCiAgICAgICAgcHJpdmF0ZSBDbGFzcyBfY2FuZGlkYXRlVHlwZTsKCiAgICAg\nICAgUGFyc2VkSlBRTChTdHJpbmcganBxbCkgewogICAgICAgICAgICB0aGlz\nKGpwcWwsIHBhcnNlKGpwcWwpKTsKICAgICAgICB9CgogICAgICAgIFBhcnNl\nZEpQUUwoU3RyaW5nIHF1ZXJ5LCBKUFFMTm9kZSByb290KSB7CiAgICAgICAg\nICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICAgICAgICAgIHRoaXMucXVlcnkg\nPSBxdWVyeTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIEpQUUxOb2RlIHBhcnNlKFN0cmluZyBqcHFsKSB7CiAgICAgICAgICAg\nIGlmIChqcHFsID09IG51bGwpCiAgICAgICAgICAgICAgICBqcHFsID0gIiI7\nCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIChK\nUFFMTm9kZSkgbmV3IEpQUUwoanBxbCkucGFyc2VRdWVyeSgpOwogICAgICAg\nICAgICB9IGNhdGNoIChFcnJvciBlKSB7CiAgICAgICAgICAgICAgICAvLyBz\ncGVjaWFsIGhhbmRsaW5nIGZvciBFcnJvciBzdWJjbGFzc2VzLCB3aGljaCB0\naGUKICAgICAgICAgICAgICAgIC8vIHBhcnNlciBtYXkgc29tZXRpbWVzICh1\nbmZvcnR1bmF0ZWx5KSB0aHJvdwogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBhcnNlLWVycm9yIiwKICAgICAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGUudG9TdHJpbmcoKSwganBx\nbCB9KSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFBhcnNlRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYXJzZS1lcnJvciIsCiAgICAgICAgICAgICAgICAgICAgbmV3\nIE9iamVjdFtdeyBlLnRvU3RyaW5nKCksIGpwcWwgfSksIGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICB2b2lkIHBvcHVsYXRlKEV4cHJl\nc3Npb25TdG9yZVF1ZXJ5IHF1ZXJ5KSB7CiAgICAgICAgICAgIFF1ZXJ5Q29u\ndGV4dCBjdHggPSBxdWVyeS5nZXRDb250ZXh0KCk7CgogICAgICAgICAgICAv\nLyBpZiB0aGUgb3duaW5nIHF1ZXJ5J3MgY29udGV4dCBkb2VzIG5vdCBoYXZl\nCiAgICAgICAgICAgIC8vIGFueSBjYW5kaWRhdGUgY2xhc3MsIHRoZW4gc2V0\nIGl0IGhlcmUKICAgICAgICAgICAgaWYgKGN0eC5nZXRDYW5kaWRhdGVUeXBl\nKCkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9jYW5kaWRhdGVU\neXBlID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2NhbmRpZGF0ZVR5\ncGUgPSBuZXcgSlBRTEV4cHJlc3Npb25CdWlsZGVyCiAgICAgICAgICAgICAg\nICAgICAgICAgIChudWxsLCBxdWVyeSwgdGhpcykuZ2V0Q2FuZGlkYXRlVHlw\nZSgpOwogICAgICAgICAgICAgICAgY3R4LnNldENhbmRpZGF0ZVR5cGUoX2Nh\nbmRpZGF0ZVR5cGUsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFB1YmxpYyBmb3IgdW5p\ndCB0ZXN0aW5nIHB1cnBvc2VzLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkgewogICAgICAgICAgICByZXR1\ncm4gX2NhbmRpZGF0ZVR5cGU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nICgpCgkJewoJCQlyZXR1cm4gdGhpcy5xdWVyeTsK\nCQl9Cgl9Cn0KCg==\n","encoding":"base64"}

