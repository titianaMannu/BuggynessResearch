{"sha":"b746af8c07a892408d68d0e758543f38bc197301","node_id":"MDQ6QmxvYjIwNjM2NDpiNzQ2YWY4YzA3YTg5MjQwOGQ2OGQwZTc1ODU0M2YzOGJjMTk3MzAx","size":79068,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b746af8c07a892408d68d0e758543f38bc197301","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5Tb3VyY2VUcmFja2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIueG1sLkNv\nbW1lbnRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQmln\nRGVjaW1hbElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQmln\nSW50ZWdlcklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQnl0\nZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhcklkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRGF0ZUlkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRG91YmxlSWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5GbG9hdElkOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuU2hvcnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlN0cmluZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7\nCgovKioKICogQ29udGFpbnMgbWV0YWRhdGEgYWJvdXQgYSBwZXJzaXN0ZW50\nIHR5cGUuCiAqIFRoaXMgbWV0YWRhdGEgaXMgYXZhaWxhYmxlIGJvdGggYXQg\nZW5oYW5jZW1lbnQgdGltZSBhbmQgcnVudGltZS4KICogIE5vdGUgdGhhdCB0\naGlzIGNsYXNzIGVtcGxveXMgYWdncmVzc2l2ZSBjYWNoaW5nLCBhbmQgdGhl\ncmVmb3JlIGl0IGlzCiAqIGltcG9ydGFudCB0byBmaW5hbGl6ZSB0aGUgY29u\nZmlndXJhdGlvbiBvZiBmaWVsZCBtZXRhZGF0YXMgYmVmb3JlIGludm9raW5n\nCiAqIG1ldGhvZHMgdGhhdCBkZXBlbmQgb24gdGhhdCBjb25maWd1cmF0aW9u\nLCBzdWNoIGFzCiAqIHtAbGluayAjZ2V0UHJpbWFyeUtleUZpZWxkc30uCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgQ2xhc3NN\nZXRhRGF0YQogICAgZXh0ZW5kcyBFeHRlbnNpb25zCiAgICBpbXBsZW1lbnRz\nIENvbXBhcmFibGUsIFNvdXJjZVRyYWNrZXIsIE1ldGFEYXRhQ29udGV4dCwg\nTWV0YURhdGFNb2RlcywKICAgIENvbW1lbnRhYmxlIHsKCiAgICAvKioKICAg\nICAqIFVua29ud24gaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgSURfVU5LTk9XTiA9IDA7CgogICAgLyoqCiAg\nICAgKiBEYXRhc3RvcmUgaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgSURfREFUQVNUT1JFID0gMTsKCiAgICAv\nKioKICAgICAqIEFwcGxpY2F0aW9uIGlkZW50aXR5IHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElEX0FQUExJQ0FUSU9OID0g\nMjsKCiAgICAvKioKICAgICAqIFVua25vd24gYWNjZXNzIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19VTktOT1dO\nID0gMDsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBh\ncmUgYWNjZXNzZWQgdmlhIGRpcmVjdCBmaWVsZCBhY2Nlc3MuIEJpdCBmbGFn\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1Nf\nRklFTEQgPSAyIDw8IDA7CgogICAgLyoqCiAgICAgKiBQZXJzaXN0ZW50IGF0\ndHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBzZXR0ZXJzIGFuZCBnZXR0ZXJz\nLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQUNDRVNTX1BST1BFUlRZID0gMiA8PCAxOwoKICAgIC8qKgogICAgICog\nVmFsdWUgZm9yIHVzaW5nIGEgc3ludGhldGljIGRldGFjaGVkIHN0YXRlIGZp\nZWxkLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1lOVEhFVElDID0gImBzeW4iOwoKICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIERFRkFVTFRfU1RSSU5H\nID0gImAiOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQ2xhc3NNZXRh\nRGF0YS5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgRmV0Y2hH\ncm91cFtdIEVNUFRZX0ZFVENIX0dST1VQX0FSUkFZCiAgICAgICAgPSBuZXcg\nRmV0Y2hHcm91cFswXTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmlu\nZ1tdIEVNUFRZX1NUUklOR19BUlJBWSA9IG5ldyBTdHJpbmdbMF07CgogICAg\ncHJpdmF0ZSBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAg\ncHJpdmF0ZSBmaW5hbCBWYWx1ZU1ldGFEYXRhIF9vd25lcjsKICAgIHByaXZh\ndGUgZmluYWwgTGlmZWN5Y2xlTWV0YURhdGEgX2xpZmVNZXRhID0gbmV3IExp\nZmVjeWNsZU1ldGFEYXRhKHRoaXMpOwogICAgcHJpdmF0ZSBGaWxlIF9zcmNG\naWxlID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9zcmNUeXBlID0gU1JDX09U\nSEVSOwogICAgcHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVudHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBpbnQgX2xpc3RJbmRleCA9IC0xOwogICAgcHJpdmF0ZSBp\nbnQgX3NyY01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkc7CiAgICBw\ncml2YXRlIGludCBfcmVzTW9kZSA9IE1PREVfTk9ORTsKCiAgICBwcml2YXRl\nIENsYXNzIF90eXBlID0gT2JqZWN0LmNsYXNzOwogICAgcHJpdmF0ZSBmaW5h\nbCBNYXAgX2ZpZWxkTWFwID0gbmV3IFRyZWVNYXAoKTsKICAgIHByaXZhdGUg\nTWFwIF9zdXBGaWVsZE1hcCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDb2xsZWN0aW9u\nIF9zdGF0aWNGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBpbnRbXSBfZmll\nbGREYXRhVGFibGUgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2ZnTWFwID0g\nbnVsbDsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTm90\nZTogaWYgeW91IGFkZCBhZGRpdGlvbmFsIHN0YXRlLCBtYWtlIHN1cmUgdG8g\nYWRkIGl0IHRvIGNvcHkoKQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwcml2YXRlIENsYXNzIF9vYmplY3RJZCA9IG51bGw7CiAgICBwcml2\nYXRlIEJvb2xlYW4gX29iamVjdElkU2hhcmVkID0gbnVsbDsKICAgIHByaXZh\ndGUgQm9vbGVhbiBfb3BlbmpwYUlkID0gbnVsbDsKICAgIHByaXZhdGUgQm9v\nbGVhbiBfZXh0ZW50ID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfZW1i\nZWRkZWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9pbnRlcmZhY2Ug\nPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfaW1wbCA9IG51bGw7CiAgICBw\ncml2YXRlIExpc3QgX2ludGVyZmFjZXMgPSBudWxsOwogICAgcHJpdmF0ZSBm\naW5hbCBNYXAgX2lmYWNlTWFwID0gbmV3IEhhc2hNYXAoKTsKICAgIHByaXZh\ndGUgaW50IF9pZGVudGl0eSA9IElEX1VOS05PV047CiAgICBwcml2YXRlIGlu\ndCBfaWRTdHJhdGVneSA9IFZhbHVlU3RyYXRlZ2llcy5OT05FOwogICAgcHJp\ndmF0ZSBpbnQgX2FjY2Vzc1R5cGUgPSBBQ0NFU1NfVU5LTk9XTjsKCiAgICBw\ncml2YXRlIFN0cmluZyBfc2VxTmFtZSA9IERFRkFVTFRfU1RSSU5HOwogICAg\ncHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIF9zZXFNZXRhID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RyaW5nIF9jYWNoZU5hbWUgPSBERUZBVUxUX1NUUklORzsK\nICAgIHByaXZhdGUgaW50IF9jYWNoZVRpbWVvdXQgPSBJbnRlZ2VyLk1JTl9W\nQUxVRTsKICAgIHByaXZhdGUgQm9vbGVhbiBfZGV0YWNoYWJsZSA9IG51bGw7\nCiAgICBwcml2YXRlIFN0cmluZyBfZGV0YWNoU3RhdGUgPSBERUZBVUxUX1NU\nUklORzsKICAgIHByaXZhdGUgU3RyaW5nIF9hbGlhcyA9IG51bGw7CiAgICBw\ncml2YXRlIGludCBfdmVyc2lvbklkeCA9IEludGVnZXIuTUlOX1ZBTFVFOwoK\nICAgIHByaXZhdGUgQ2xhc3MgX3N1cGVyID0gbnVsbDsKICAgIHByaXZhdGUg\nQ2xhc3NNZXRhRGF0YSBfc3VwZXJNZXRhID0gbnVsbDsKICAgIHByaXZhdGUg\nQ2xhc3NbXSBfc3VicyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGFbXSBfc3ViTWV0YXMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFE\nYXRhW10gX21hcFN1Yk1ldGFzID0gbnVsbDsKCiAgICBwcml2YXRlIEZpZWxk\nTWV0YURhdGFbXSBfZmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRN\nZXRhRGF0YVtdIF91bm1nZEZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZp\nZWxkTWV0YURhdGFbXSBfYWxsRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUg\nRmllbGRNZXRhRGF0YVtdIF9hbGxQS0ZpZWxkcyA9IG51bGw7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsREZHRmllbGRzID0gbnVsbDsKICAg\nIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9kZWZpbmVkRmllbGRzID0gbnVs\nbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9saXN0aW5nRmllbGRz\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxMaXN0\naW5nRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmV0Y2hHcm91cFtdIF9m\nZ3MgPSBudWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3VwW10gX2N1c3RvbUZH\ncyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ludGVyY2VwdGluZyA9\nIGZhbHNlOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBk\nZXNjcmliZWQgdHlwZSBhbmQgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENsYXNzTWV0YURhdGEoQ2xhc3MgdHlwZSwgTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAg\nICAgX293bmVyID0gbnVsbDsKICAgICAgICBzZXREZXNjcmliZWRUeXBlKHR5\ncGUpOwogICAgfQoKICAgIC8qKgogICAgICogRW1iZWRkZWQgY29uc3RydWN0\nb3IuIFN1cHBseSBlbWJlZGRpbmcgdmFsdWUuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBDbGFzc01ldGFEYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAg\nICAgICBfb3duZXIgPSBvd25lcjsKICAgICAgICBfcmVwb3MgPSBvd25lci5n\nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgc2V0RW52Q2xhc3NMb2FkZXIob3du\nZXIuZ2V0RmllbGRNZXRhRGF0YSgpLmdldERlZmluaW5nTWV0YURhdGEoKS4K\nICAgICAgICAgICAgZ2V0RW52Q2xhc3NMb2FkZXIoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG93bmluZyByZXBvc2l0b3J5LgogICAg\nICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5IGdldFJlcG9zaXRv\ncnkoKSB7CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAvKioK\nICAgICAqIElmIHRoaXMgbWV0YWRhdGEgaXMgZm9yIGFuIGVtYmVkZGVkIG9i\namVjdCwgcmV0dXJuaW5nIHRoZSBvd25pbmcgdmFsdWUuCiAgICAgKi8KICAg\nIHB1YmxpYyBWYWx1ZU1ldGFEYXRhIGdldEVtYmVkZGluZ01ldGFEYXRhKCkg\newogICAgICAgIHJldHVybiBfb3duZXI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBjbGFzcyBkZXNjcmliZWQgYnkg\ndGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIENsYXNzIGdldERl\nc2NyaWJlZFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBjbGFzcyBkZXNjaWJlZCBieSB0aGlz\nIG1ldGFkYXRhLiBUaGUgdHlwZSBtYXkgYmUgcmVzZXQgd2hlbgogICAgICog\nYW4gZW1iZWRkZWQgdmFsdWUgY2hhbmdlcyBpdHMgZGVjbGFyZWQgdHlwZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0RGVzY3JpYmVkVHlwZShD\nbGFzcyB0eXBlKSB7CiAgICAgICAgaWYgKHR5cGUuZ2V0U3VwZXJjbGFzcygp\nICE9IG51bGwgJiYgImphdmEubGFuZy5FbnVtIi5lcXVhbHMKICAgICAgICAg\nICAgKHR5cGUuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW51\nbSIsIHR5cGUpKTsKICAgICAgICBfdHlwZSA9IHR5cGU7CiAgICAgICAgaWYg\nKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5\ncGUpKQogICAgICAgICAgICBzZXRJbnRlcmNlcHRpbmcodHJ1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgZW52aXJvbm1lbnRhbCBsb2FkZXIgdXNl\nZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRhZGF0YS4KICAgICAqIFRoZSBjbGFz\ncyBtZXRhZGF0YSBzaG91bGQgdXNlIHRoaXMgbG9hZGVyIHdoZW4gbG9hZGlu\nZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0cyBzdXBlcmNsYXNzIGFuZCBmaWVs\nZCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIENsYXNzTG9hZGVyIGdldEVu\ndkNsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfbG9hZGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGNsYXNzIGVudmlyb25tZW50YWwgbG9h\nZGVyIHVzZWQgd2hlbiBsb2FkaW5nIHRoaXMgbWV0YWRhdGEuCiAgICAgKiBU\naGUgY2xhc3MgbWV0YWRhdGEgc2hvdWxkIHVzZSB0aGlzIGxvYWRlciB3aGVu\nIGxvYWRpbmcgbWV0YWRhdGEgZm9yCiAgICAgKiBpdHMgc3VwZXJjbGFzcyBh\nbmQgZmllbGQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVu\ndkNsYXNzTG9hZGVyKENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIF9s\nb2FkZXIgPSBsb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGVy\nc2lzdGVuY2UgY2FwYWJsZSBzdXBlcmNsYXNzIG9mIHRoZSBkZXNjcmliZWQg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIENsYXNzIGdldFBDU3VwZXJjbGFz\ncygpIHsKICAgICAgICByZXR1cm4gX3N1cGVyOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgc3VwZXJjbGFzcyBvZiB0\naGUgZGVzY3JpYmVkIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFBDU3VwZXJjbGFzcyhDbGFzcyBwYykgewogICAgICAgIGNsZWFyQWxsRmll\nbGRDYWNoZSgpOwogICAgICAgIF9zdXBlciA9IHBjOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhIGZvciB0aGlzIGNsYXNzJyBzdXBlcmNs\nYXNzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpIHsKICAgICAgICBpZiAoX3N1cGVyTWV0YSA9\nPSBudWxsICYmIF9zdXBlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChf\nb3duZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX3N1cGVyTWV0YSA9\nIF9yZXBvcy5uZXdFbWJlZGRlZENsYXNzTWV0YURhdGEoX293bmVyKTsKICAg\nICAgICAgICAgICAgIF9zdXBlck1ldGEuc2V0RGVzY3JpYmVkVHlwZShfc3Vw\nZXIpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIF9zdXBl\nck1ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEoX3N1cGVyLCBfbG9hZGVyLCB0\ncnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdXBlck1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9yIHRoaXMgY2xh\nc3MnIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgIF9zdXBlck1ldGEg\nPSBtZXRhOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAg\nIHNldFBDU3VwZXJjbGFzcyhtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgY2xhc3MgaXMgbWFw\ncGVkIHRvIHRoZSBkYXRhc3RvcmUuIEJ5IGRlZmF1bHQsIG9ubHkKICAgICAq\nIHJldHVybnMgZmFsc2UgaWYgY2xhc3MgaXMgZW1iZWRkZWQtb25seSwgYnV0\nIHN1YmNsYXNzZXMgbWlnaHQgb3ZlcnJpZGUKICAgICAqIHRvIGFsbG93IHVu\nbWFwcGVkIG90aGVyIHR5cGVzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc01hcHBlZCgpIHsKICAgICAgICByZXR1cm4gX2VtYmVkZGVkICE9IEJv\nb2xlYW4uVFJVRTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY2xvc2VzdCBtYXBwZWQgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzTWV0YURhdGEgZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWV0YURhdGEo\nKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCB8fCBzdXAu\naXNNYXBwZWQoKSkKICAgICAgICAgICAgcmV0dXJuIHN1cDsKICAgICAgICBy\nZXR1cm4gc3VwLmdldE1hcHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGtub3duIHBlcnNpc3Rl\nbmNlIGNhcGFibGUgc3ViY2xhc3NlcyBvZiB0aGUgZGVzY3JpYmVkIHR5cGUs\nCiAgICAgKiBvciBlbXB0eSBhcnJheSBpZiBub25lIG9yIGlmIHRoaXMgaXMg\nZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1td\nIGdldFBDU3ViY2xhc3NlcygpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1QVFlfQ0xBU1NFUzsK\nCiAgICAgICAgX3JlcG9zLnByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhfbG9h\nZGVyKTsKICAgICAgICBpZiAoX3N1YnMgPT0gbnVsbCkgewogICAgICAgICAg\nICBDb2xsZWN0aW9uIHN1YnMgPSBfcmVwb3MuZ2V0UENTdWJjbGFzc2VzKF90\neXBlKTsKICAgICAgICAgICAgX3N1YnMgPSAoQ2xhc3NbXSkgc3Vicy50b0Fy\ncmF5KG5ldyBDbGFzc1tzdWJzLnNpemUoKV0pOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX3N1YnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIG1ldGFkYXRhIGZvciB0aGUga25vd24gcGVyc2lzdGVuY2UgY2FwYWJs\nZSBzdWJjbGFzc2VzIG9mCiAgICAgKiB0aGUgZGVzY3JpYmVkIHR5cGUsIG9y\nIGVtcHR5IGFycmF5IGlmIG5vbmUgb3IgaWYgdGhpcyBpcyBlbWJlZGRlZAog\nICAgICogbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhW10gZ2V0UENTdWJjbGFzc01ldGFEYXRhcygpIHsKICAgICAgICBpZiAo\nX293bmVyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1Q\nVFlfTUVUQVM7CgogICAgICAgIENsYXNzW10gc3VicyA9IGdldFBDU3ViY2xh\nc3NlcygpOyAvLyBjaGVja3MgZm9yIG5ldwogICAgICAgIGlmIChfc3ViTWV0\nYXMgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgICAgIF9zdWJNZXRhcyA9IF9yZXBvcy5FTVBUWV9N\nRVRBUzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFz\nc01ldGFEYXRhW10gbWV0YXMgPSBfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFy\ncmF5CiAgICAgICAgICAgICAgICAgICAgKHN1YnMubGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBtZXRhc1tpXSA9IF9yZXBvcy5nZXRN\nZXRhRGF0YShzdWJzW2ldLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAg\nICAgIF9zdWJNZXRhcyA9IG1ldGFzOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfc3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYWxsIG1hcHBlZCBzdWJjbGFzc2VzLgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldE1hcHBlZFBDU3ViY2xhc3NN\nZXRhRGF0YXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX3JlcG9zLkVNUFRZX01FVEFTOwoKICAgICAgICBD\nbGFzc01ldGFEYXRhW10gc3VicyA9IGdldFBDU3ViY2xhc3NNZXRhRGF0YXMo\nKTsgLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX21hcFN1Yk1ldGFz\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgICAgICBfbWFwU3ViTWV0YXMgPSBzdWJzOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIExpc3QgbWFwcGVkID0gbmV3\nIEFycmF5TGlzdChzdWJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICAgICAgaWYgKHN1YnNbaV0uaXNNYXBwZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGVkLmFkZChzdWJzW2ldKTsKICAgICAgICAgICAg\nICAgIF9tYXBTdWJNZXRhcyA9IChDbGFzc01ldGFEYXRhW10pIG1hcHBlZC50\nb0FycmF5CiAgICAgICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdDbGFzc01l\ndGFEYXRhQXJyYXkobWFwcGVkLnNpemUoKSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfbWFwU3ViTWV0YXM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2Vk\nLiBUaGlzIHdpbGwgYmUgb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxp\nPntAbGluayAjSURfVU5LTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwv\nbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0\neSBtYW5hZ2VkIGJ5IHRoZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBl\nbmRlbnQJb2YgdGhlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAg\nICogPGxpPntAbGluayAjSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5h\nZ2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkg\nb25lIG9yIG1vcmUgZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAg\nKiA8L3VsPiBJZiB1bnNwZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJ\nRF9EQVRBU1RPUkV9IGlmIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBr\nZXkgZmllbGRzLCBhbmQge0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3\naXNlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElkZW50aXR5VHlwZSgp\nIHsKICAgICAgICBpZiAoX2lkZW50aXR5ID09IElEX1VOS05PV04pIHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3Vw\nLmdldElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAg\nICAgICBfaWRlbnRpdHkgPSBzdXAuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKGdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGgg\nPiAwKQogICAgICAgICAgICAgICAgX2lkZW50aXR5ID0gSURfQVBQTElDQVRJ\nT047CiAgICAgICAgICAgIGVsc2UgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAg\nICAgICAgICBfaWRlbnRpdHkgPSBJRF9EQVRBU1RPUkU7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IF9yZXBvcy5nZXRN\nZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICAg\nICAgICAgIGdldERlZmF1bHRJZGVudGl0eVR5cGUoKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9pZGVudGl0eTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSB0eXBlIG9mIGlkZW50aXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBi\nZSBvbmUgb2Y6CiAgICAgKiA8dWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9V\nTktOT1dOfTogdW5rbm93biBpZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxs\naT57QGxpbmsgI0lEX0RBVEFTVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkg\ndGhlIGRhdGEgc3RvcmUgYW5kCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUg\nZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5r\nICNJRF9BUFBMSUNBVElPTn06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFw\ncGxpY2F0aW9uIGFuZAogICAgICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBm\naWVsZHMgb2YgdGhlIGluc3RhbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVu\nc3BlY2lmaWVkLCBkZWZhdWx0cyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0g\naWYgdGhlcmUgYXJlIG5vCiAgICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFu\nZCB7QGxpbmsgI0lEX0FQUExJQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldElkZW50aXR5VHlwZShpbnQgdHlwZSkgewog\nICAgICAgIF9pZGVudGl0eSA9IHR5cGU7CiAgICAgICAgaWYgKHR5cGUgIT0g\nSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgX29iamVjdElkID0gbnVs\nbDsKICAgICAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBj\nbGFzcyB0byB1c2UgZm9yIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoKSB7CiAgICAgICAgaWYgKF9v\nYmplY3RJZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElk\nOwogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9BUFBMSUNB\nVElPTikKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkg\nIT0gSURfVU5LTk9XTikgewogICAgICAgICAgICBfb2JqZWN0SWQgPSBzdXAu\nZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0\nSWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBmaWd1cmUgb3V0IG9wZW5qcGEg\naWRlbnRpdHkgdHlwZSBiYXNlZCBvbiBwcmltYXJ5IGtleSBmaWVsZAogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBnZXRQcmltYXJ5S2V5RmllbGRz\nKCk7CiAgICAgICAgaWYgKHBrcy5sZW5ndGggIT0gMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgc3dpdGNoIChwa3NbMF0uZ2V0T2JqZWN0\nSWRGaWVsZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6\nCiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBCeXRlSWQuY2xhc3M7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBDaGFySWQuY2xhc3M7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVf\nT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gRG91YmxlSWQuY2xh\nc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEZsb2F0SWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlRfT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gSW50SWQuY2xh\nc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nR19PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBMb25nSWQuY2xh\nc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IFNob3J0SWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgX29iamVjdElk\nID0gU3RyaW5nSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAg\nIF9vYmplY3RJZCA9IERhdGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIF9v\nYmplY3RJZCA9IE9iamVjdElkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAg\nICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBCaWdEZWNpbWFsSWQuY2xhc3M7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9\nIEJpZ0ludGVnZXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX29iamVjdElkOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBjbGFzcyB0byB1\nc2UgZm9yIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE9iamVjdElkVHlwZShDbGFzcyBjbHMsIGJvb2xlYW4gc2hhcmVkKSB7\nCiAgICAgICAgX29iamVjdElkID0gbnVsbDsKICAgICAgICBfb3BlbmpwYUlk\nID0gbnVsbDsKICAgICAgICBfb2JqZWN0SWRTaGFyZWQgPSBudWxsOwogICAg\nICAgIGlmIChjbHMgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBkb24ndCBs\nZXQgcGVvcGxlIGFzc2lnbiBPcGVuSlBBSWQgdHlwZXM7IHNhZmVyIHRvIGNh\nbGN1bGF0ZSBpdAogICAgICAgICAgICAvLyBvdXJzZWx2ZXMKICAgICAgICAg\nICAgc2V0SWRlbnRpdHlUeXBlKElEX0FQUExJQ0FUSU9OKTsKICAgICAgICAg\nICAgaWYgKCFPcGVuSlBBSWQuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMp\nKSB7CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBjbHM7CiAgICAgICAg\nICAgICAgICBfb2JqZWN0SWRTaGFyZWQgPSAoc2hhcmVkKSA/IEJvb2xlYW4u\nVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgdHlwZSB1c2Vz\nIGFuIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIHRoYXQgaXMgc2hhcmVk\nCiAgICAgKiB3aXRoIG90aGVyIGNsYXNzZXMsIGFuZCBpcyB0aGVyZWZvcmUg\nd3JhcHBlZCBpbiBhbiB7QGxpbmsgT2JqZWN0SWR9LgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc09iamVjdElkVHlwZVNoYXJlZCgpIHsKICAgICAg\nICBpZiAoX29iamVjdElkU2hhcmVkICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfb2JqZWN0SWRTaGFyZWQuYm9vbGVhblZhbHVlKCk7CiAgICAgICAg\naWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKS5pc09iamVjdElkVHlwZVNoYXJlZCgpOwog\nICAgICAgIHJldHVybiBpc09wZW5KUEFJZGVudGl0eSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0aGlzIHR5cGUgdXNlcyBPcGVuSlBBIGlk\nZW50aXR5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc09wZW5KUEFJ\nZGVudGl0eSgpIHsKICAgICAgICBpZiAoX29wZW5qcGFJZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzIGNscyA9IGdldE9iamVjdElkVHlwZSgpOwog\nICAgICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIF9vcGVuanBhSWQgPSAoT3BlbkpQ\nQUlkLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkgPyBCb29sZWFuLlRS\nVUUKICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIF9vcGVuanBhSWQuYm9vbGVhblZhbHVlKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdG8gdXNlIGZvciBk\nYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4KICAgICAqIE9uZSBvZiB0\naGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVlU3RyYXRlZ2llc30uCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0SWRlbnRpdHlTdHJhdGVneSgpIHsK\nICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkgPT0gSURfREFUQVNUT1JF\nCiAgICAgICAgICAgICYmIF9pZFN0cmF0ZWd5ID09IFZhbHVlU3RyYXRlZ2ll\ncy5OT05FKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAh\nPSBudWxsICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dO\nKQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBzdXAuZ2V0SWRlbnRp\ndHlTdHJhdGVneSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfaWRTdHJhdGVneSA9IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkU7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfaWRTdHJhdGVneTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBzdHJhdGVneSB0byB1c2UgZm9yIGRhdGFzdG9yZSBp\nZGVudGl0eSBnZW5lcmF0aW9uLgogICAgICogT25lIG9mIHRoZSBjb25zdGFu\ndHMgZnJvbSB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzfS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0SWRlbnRpdHlTdHJhdGVneShpbnQgc3RyYXRlZ3kp\nIHsKICAgICAgICBfaWRTdHJhdGVneSA9IHN0cmF0ZWd5OwogICAgICAgIGlm\nIChzdHJhdGVneSAhPSBWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0UpCiAgICAg\nICAgICAgIHNldElkZW50aXR5U2VxdWVuY2VOYW1lKG51bGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5j\nZSBuYW1lLCBvciBudWxsIGZvciBub25lLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldElkZW50aXR5U2VxdWVuY2VOYW1lKCkgewogICAgICAgIGlm\nIChERUZBVUxUX1NUUklORy5lcXVhbHMoX3NlcU5hbWUpKSB7CiAgICAgICAg\nICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zZXFO\nYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfc2VxTmFtZSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nc2VxTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkYXRhc3RvcmUg\naWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Igbm9uZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUo\nU3RyaW5nIHNlcU5hbWUpIHsKICAgICAgICBfc2VxTmFtZSA9IHNlcU5hbWU7\nCiAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAgICAgIGlmIChzZXFOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIHNldElkZW50aXR5U3RyYXRlZ3koVmFs\ndWVTdHJhdGVnaWVzLlNFUVVFTkNFKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1ldGFkYXRhIGZvciB0aGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNl\nLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBnZXRJZGVu\ndGl0eVNlcXVlbmNlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKF9zZXFNZXRh\nID09IG51bGwgJiYgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSAhPSBudWxs\nKQogICAgICAgICAgICBfc2VxTWV0YSA9IF9yZXBvcy5nZXRTZXF1ZW5jZU1l\ndGFEYXRhKHRoaXMsCiAgICAgICAgICAgICAgICBnZXRJZGVudGl0eVNlcXVl\nbmNlTmFtZSgpLCB0cnVlKTsKICAgICAgICByZXR1cm4gX3NlcU1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbmZvcm1hdGlvbiBhYm91dCBsaWZlY3lj\nbGUgY2FsbGJhY2tzIGZvciB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgTGlmZWN5Y2xlTWV0YURhdGEgZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKSB7\nCiAgICAgICAgcmV0dXJuIF9saWZlTWV0YTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIGFsaWFzIGZvciB0aGUgZGVzY3JpYmVkIHR5cGUs\nIG9yIDxjb2RlPm51bGw8L2NvZGU+IGlmIG5vbmUKICAgICAqIGhhcyBiZWVu\nIHNldC4KICAgICAqIAogICAgICogQHNlZSAjc2V0VHlwZUFsaWFzCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZUFsaWFzKCkgewogICAgICAg\nIGlmIChfYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgX2FsaWFzID0gU3Ry\naW5ncy5nZXRDbGFzc05hbWUoX3R5cGUpOwogICAgICAgIHJldHVybiBfYWxp\nYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBhbGlhcyBmb3Ig\ndGhlIGRlc2NyaWJlZCB0eXBlLiBUaGUgYWxpYXMgY2FuIGJlCiAgICAgKiBh\nbnkgYXJiaXRyYXJ5IHN0cmluZyB0aGF0IHRoZSBpbXBsZW1lbnRhdGlvbiBj\nYW4gbGF0ZXIgdXNlIHRvCiAgICAgKiByZWZlciB0byB0aGUgY2xhc3MuIE5v\ndGUgdGhhdCBhdCBydW50aW1lLCBvbmx5IHRoZSBhbGlhcwogICAgICogY29t\ncHV0ZWQgd2hlbiB0aGUgcGVyc2lzdGVudCB0eXBlIHdhcyBlbmhhbmNlZCBp\ncyB1c2VkLgogICAgICoKICAgICAqIEBwYXJhbSBhbGlhcyB0aGUgYWxpYXMg\nbmFtZSB0byBhcHBseSB0byB0aGUgZGVzY3JpYmVkIHR5cGUKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0VHlwZUFsaWFzKFN0cmluZyBhbGlhcykgewog\nICAgICAgIF9hbGlhcyA9IGFsaWFzOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGFjY2VzcyB0eXBlIHVzZWQgYnkgdGhpcyBjbGFzcy4gRWl0aGVyIHtA\nbGluayAjQUNDRVNTX0ZJRUxEfQogICAgICogb3Ige0BsaW5rICNBQ0NFU1Nf\nUFJPUEVSVFl9LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEFjY2Vzc1R5\ncGUoKSB7CiAgICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFDQ0VTU19VTktO\nT1dOKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHN1cC5nZXRBY2Nlc3NUeXBl\nKCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAg\nICAgICAgICAgICAgICBnZXREZWZhdWx0cygpLmdldERlZmF1bHRBY2Nlc3NU\neXBlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9hY2Nlc3NUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFjY2Vz\ncyB0eXBlIHVzZWQgYnkgdGhpcyBjbGFzcy4gTXVzdCBiZSBlaXRoZXIKICAg\nICAqIHtAbGluayAjQUNDRVNTX0ZJRUxEfSBvciB7QGxpbmsgI0FDQ0VTU19Q\nUk9QRVJUWX0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEFjY2Vzc1R5\ncGUoaW50IHR5cGUpIHsKICAgICAgICBfYWNjZXNzVHlwZSA9IHR5cGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHJlcXVpcmVz\nIGV4dGVudCBtYW5hZ2VtZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRSZXF1aXJlc0V4dGVudCgpIHsKICAgICAgICBpZiAoX293bmVyICE9\nIG51bGwgfHwgaXNFbWJlZGRlZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBpZiAoX2V4dGVudCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2V4dGVudCA9IChzdXAuZ2V0UmVxdWlyZXNFeHRlbnQoKSkg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9leHRl\nbnQgPSBCb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nZXh0ZW50LmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSByZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVxdWlyZXNFeHRlbnQoYm9v\nbGVhbiByZXEpIHsKICAgICAgICBfZXh0ZW50ID0gKHJlcSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSBjYW4gb25seSBiZSB1c2VkIGFzIGFuIGVtYmVk\nZGVkIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNFbWJl\nZGRlZE9ubHkoKSB7CiAgICAgICAgaWYgKF9lbWJlZGRlZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2VtYmVkZGVkID0gKHN1cC5pc0VtYmVkZGVkT25s\neSgpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAgIDogQm9v\nbGVhbi5GQUxTRTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nX2VtYmVkZGVkID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9lbWJlZGRlZC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBh\ncyBhbiBlbWJlZGRlZCBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEVtYmVkZGVkT25seShib29sZWFuIGVtYmVkKSB7CiAgICAgICAgX2Vt\nYmVkZGVkID0gKGVtYmVkKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFM\nU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlJ3Mg\nZmllbGRzIGFyZSBhY3RpdmVseSBpbnRlcmNlcHRlZCwgZWl0aGVyIGJ5CiAg\nICAgKiByZWRlZmluaXRpb24gb3IgZW5oYW5jZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzSW50ZXJjZXB0aW5nKCkgewogICAgICAgIHJl\ndHVybiBfaW50ZXJjZXB0aW5nOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0aGUgdHlwZSdzIGZpZWxkcyBhcmUgYWN0aXZlbHkgaW50ZXJjZXB0\nZWQsIGVpdGhlciBieQogICAgICogcmVkZWZpbml0aW9uIG9yIGVuaGFuY2Vt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmNlcHRpbmco\nYm9vbGVhbiBpbnRlcmNlcHRpbmcpIHsKICAgICAgICBfaW50ZXJjZXB0aW5n\nID0gaW50ZXJjZXB0aW5nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgdHlwZSBpcyBhIG1hbmFnZWQgaW50ZXJmYWNlLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWRJbnRlcmZhY2UoKSB7CiAgICAg\nICAgaWYgKCFfdHlwZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZhY2UgPT0gbnVsbCA/\nIGZhbHNlIDogX2ludGVyZmFjZS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgaXMgYSBtYW5hZ2VkIGlu\ndGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYW5hZ2VkSW50\nZXJmYWNlKGJvb2xlYW4gbWFuYWdlZEludGVyZmFjZSkgewogICAgICAgIGlm\nICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtaW50ZXJmYWNlIiwg\nX3R5cGUpKTsKICAgICAgICBfaW50ZXJmYWNlID0gbWFuYWdlZEludGVyZmFj\nZSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1hbmFnZWQgaW50ZXJmYWNlIGltcGxl\nbWVudG9yIGlmIGFueS4KICAgICAqLwogICAgcHVibGljIENsYXNzIGdldElu\ndGVyZmFjZUltcGwoKSB7CiAgICAgICAgcmV0dXJuIF9pbXBsOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBtYW5hZ2VkIGludGVyZmFjZSBpbXBs\nZW1lbnRvciBjbGFzcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50\nZXJmYWNlSW1wbChDbGFzcyBpbXBsKSB7CiAgICAgICAgX2ltcGwgPSBpbXBs\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBleHBsaWNpdGx5\nIGRlY2xhcmVkIGludGVyZmFjZXMgdGhpcyBjbGFzcyBpbXBsZW1lbnRzLgog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3NbXSBnZXREZWNsYXJlZEludGVyZmFj\nZXMoKSB7CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBNZXRhRGF0YVJlcG9zaXRvcnkuRU1QVFlfQ0xBU1NF\nUzsKICAgICAgICByZXR1cm4gKENsYXNzW10pIF9pbnRlcmZhY2VzLnRvQXJy\nYXkobmV3IENsYXNzW19pbnRlcmZhY2VzLnNpemUoKV0pOwogICAgfQoKICAg\nIC8qKgogICAgICogRXhwbGljaXRseSBkZWNsYXJlIHRoZSBnaXZlbiBpbnRl\ncmZhY2UgYW1vbmcgdGhlIG9uZXMgdGhpcwogICAgICogY2xhc3MgaW1wbGVt\nZW50cy4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkRGVjbGFyZWRJbnRl\ncmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgICAgICBpZiAoaWZhY2UgPT0gbnVs\nbCB8fCAhaWZhY2UuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZWNsYXJlLW5vbi1p\nbnRlcmZhY2UiLAogICAgICAgICAgICAgICAgdGhpcywgaWZhY2UpKTsKICAg\nICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAgX2lu\ndGVyZmFjZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgX2ludGVyZmFj\nZXMuYWRkKGlmYWNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0\naGUgZ2l2ZW4gaW50ZXJmYWNlIGZyb20gdGhlIGRlY2xhcmVkIGxpc3QuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xhcmVkSW50ZXJm\nYWNlKENsYXNzIGlmYWNlKSB7CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1\ncm4gX2ludGVyZmFjZXMucmVtb3ZlKGlmYWNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsaWFzIHByb3BlcnRpZXMgZnJvbSB0aGUgZ2l2ZW4gaW50ZXJm\nYWNlIGR1cmluZyAgcXVlcmllcyB0bwogICAgICogdGhlIGxvY2FsIGZpZWxk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmZhY2VQcm9wZXJ0\neUFsaWFzKENsYXNzIGlmYWNlLCBTdHJpbmcgb3JpZywgCiAgICAgICAgU3Ry\naW5nIGxvY2FsKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfaWZhY2VNYXAp\nIHsKICAgICAgICAgICAgTWFwIGZpZWxkcyA9IChNYXApIF9pZmFjZU1hcC5n\nZXQoaWZhY2UpOwogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAg\nICAgICAgICAgICBfaWZhY2VNYXAucHV0KGlmYWNlLCBmaWVsZHMpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaWVsZHMuY29udGFpbnNLZXko\nb3JpZykpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImR1cGxpY2F0ZS1pZmFjZS1hbGlhcyIsIAogICAg\nICAgICAgICAgICAgICAgIHRoaXMsIG9yaWcsIGxvY2FsKSk7CiAgICAgICAg\nICAgIGZpZWxkcy5wdXQob3JpZywgbG9jYWwpOwogICAgICAgIH0KICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBHZXQgbG9jYWwgZmllbGQgYWxpYXMgZm9y\nIHRoZSBnaXZlbiBpbnRlcmZhY2UgcHJvcGVydHkuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0SW50ZXJmYWNlUHJvcGVydHlBbGlhcyhDbGFzcyBp\nZmFjZSwgU3RyaW5nIG9yaWcpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9p\nZmFjZU1hcCkgewogICAgICAgICAgICBNYXAgZmllbGRzID0gKE1hcCkgX2lm\nYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICByZXR1cm4gKFN0cmluZykgZmllbGRzLmdldChvcmlnKTsKICAgICAgICB9\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBhbGlhc2Vz\nIHByb3BlcnR5IG5hbWVkIGZvciB0aGUgZ2l2ZW4gaW50ZXJmYWNlLgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0SW50ZXJmYWNlQWxpYXNlZFBy\nb3BlcnRpZXMoQ2xhc3MgaWZhY2UpIHsKICAgICAgICBzeW5jaHJvbml6ZWQg\nKF9pZmFjZU1hcCkgewogICAgICAgICAgICBNYXAgZmllbGRzID0gKE1hcCkg\nX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVsZHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBUWV9TVFJJTkdf\nQVJSQVk7CiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nW10pIGZpZWxkcy5r\nZXlTZXQoKS50b0FycmF5KAogICAgICAgICAgICAgICAgbmV3IFN0cmluZ1tm\naWVsZHMuc2l6ZSgpXSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIGZpZWxkcyB0aGF0IHVzZSBp\nbXBsIG9yIGludGVybWVkaWF0ZSBkYXRhLCBpbgogICAgICogb3JkZXIgdG8g\nY3JlYXRlIGEgY29tcGFjdGVkIGFycmF5IGZvciBzdG9yYWdlIG9mIHNhaWQg\nZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRFeHRyYUZpZWxkRGF0\nYUxlbmd0aCgpIHsKICAgICAgICBpbnRbXSB0YWJsZSA9IGdldEV4dHJhRmll\nbGREYXRhVGFibGUoKTsKICAgICAgICBmb3IgKGludCBpID0gdGFibGUubGVu\nZ3RoIC0gMTsgaSA+PSAwOyBpLS0pCiAgICAgICAgICAgIGlmICh0YWJsZVtp\nXSAhPSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiB0YWJsZVtpXSArIDE7\nCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGltcGwgLyBpbnRlcm1lZGlhdGUgZmllbGQgZGF0YSBpbmRleCBv\nZiB0aGUgZ2l2ZW4gZmllbGQKICAgICAqIGluIHRoZSBjb21wYWN0ZWQgYXJy\nYXksIG9yIC0xIGlmIHRoZSBmaWVsZCBkb2VzIG5vdCB1c2UgZXh0cmEgZGF0\nYS4KICAgICAqCiAgICAgKiBAc2VlICNnZXRFeHRyYUZpZWxkRGF0YUxlbmd0\naAogICAgICovCiAgICBwdWJsaWMgaW50IGdldEV4dHJhRmllbGREYXRhSW5k\nZXgoaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGRE\nYXRhVGFibGUoKVtmaWVsZF07CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGVzIGEgdGFibGUgbWFwcGluZyBlYWNoIGZpZWxkIGluZGV4IHRvIGl0cyBl\neHRyYSBkYXRhIGluZGV4LgogICAgICovCiAgICBwcml2YXRlIGludFtdIGdl\ndEV4dHJhRmllbGREYXRhVGFibGUoKSB7CiAgICAgICAgaWYgKF9maWVsZERh\ndGFUYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludFtdIHRhYmxl\nID0gbmV3IGludFtmbWRzLmxlbmd0aF07CiAgICAgICAgICAgIGludCBpZHgg\nPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLnVzZXNJ\nbnRlcm1lZGlhdGUoKQogICAgICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0u\ndXNlc0ltcGxEYXRhKCkgIT0gQm9vbGVhbi5GQUxTRSkKICAgICAgICAgICAg\nICAgICAgICB0YWJsZVtpXSA9IGlkeCsrOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIHRhYmxlW2ldID0gLTE7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gdGFibGU7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfZmllbGREYXRhVGFibGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gbmFt\nZSByZXByZXNlbnRzIGEgbWFuYWdlZCBvciBzdGF0aWMgZmllbGQgb2YKICAg\nICAqIHRoaXMgY2xhc3MsIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNBY2Nlc3NpYmxlRmllbGQo\nU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGdldERlY2xhcmVkRmllbGQo\nZmllbGQpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIGlmIChfc3RhdGljRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAg\nRmllbGRbXSBmaWVsZHMgPSAoRmllbGRbXSkgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXREZWNsYXJlZEZpZWxkc0FjdGlvbihfdHlwZSkpOyAKICAgICAgICAgICAg\nU2V0IG5hbWVzID0gbmV3IEhhc2hTZXQoKGludCkgKGZpZWxkcy5sZW5ndGgg\nKiAxLjMzICsgMSkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChNb2Rp\nZmllci5pc1N0YXRpYyhmaWVsZHNbaV0uZ2V0TW9kaWZpZXJzKCkpKQogICAg\nICAgICAgICAgICAgICAgIG5hbWVzLmFkZChmaWVsZHNbaV0uZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgX3N0YXRpY0ZpZWxkcyA9IG5hbWVzOwogICAgICAg\nIH0KICAgICAgICBpZiAoX3N0YXRpY0ZpZWxkcy5jb250YWlucyhmaWVsZCkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChfc3VwZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCkuaXNBY2Nlc3NpYmxlRmllbGQoZmllbGQpOwogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwg\nZmllbGQgbWV0YWRhdGFzLCBpbmNsdWRpbmcgc3VwZXJjbGFzcyBmaWVsZHMu\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RmllbGRz\nKCkgewogICAgICAgIGlmIChfYWxsRmllbGRzID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKF9zdXBlciA9PSBudWxsKQogICAgICAgICAgICAgICAgX2Fs\nbEZpZWxkcyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9\nIGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gc3VwRmllbGRzID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKS4KICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZHMoKTsKCiAgICAgICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gYWxsRmllbGRzID0gX3JlcG9zLm5l\nd0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAgICAgICAgICAgICAgIChmaWVs\nZHMubGVuZ3RoICsgc3VwRmllbGRzLmxlbmd0aCk7CiAgICAgICAgICAgICAg\nICBTeXN0ZW0uYXJyYXljb3B5KHN1cEZpZWxkcywgMCwgYWxsRmllbGRzLCAw\nLCBzdXBGaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJlcGxhY2VE\nZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcyhhbGxGaWVsZHMsIHN1cEZpZWxkcy5s\nZW5ndGgpOwoKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZmll\nbGRzW2ldLnNldEluZGV4KHN1cEZpZWxkcy5sZW5ndGggKyBpKTsKICAgICAg\nICAgICAgICAgICAgICBhbGxGaWVsZHNbc3VwRmllbGRzLmxlbmd0aCArIGld\nID0gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgX2FsbEZpZWxkcyA9IGFsbEZpZWxkczsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2FsbEZpZWxkczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlcGxhY2Ugc3VwZXJjbGFzcyBmaWVsZHMgdGhhdCB3ZSBk\nZWZpbmUgd2l0aCBvdXIgdmVyc2lvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHJlcGxhY2VEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcyhGaWVsZE1ldGFE\nYXRhW10gZmllbGRzLAogICAgICAgIGludCBsZW4pIHsKICAgICAgICBpZiAo\nX3N1cEZpZWxkTWFwID09IG51bGwgfHwgIV9kZWZTdXBGaWVsZHMpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZG9uJ3QgYXNzdW1lIGZpZWxk\ncyBhcmUgaW4gb3JkZXI7IHRoaXMgbWV0aG9kIGlzIHVzZWQgZm9yCiAgICAg\nICAgLy8gbGlzdGluZyBvcmRlciBhcyB3ZWxsCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBzdXBGaWVsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxl\nbjsgaSsrKSB7CiAgICAgICAgICAgIHN1cEZpZWxkID0gKEZpZWxkTWV0YURh\ndGEpIF9zdXBGaWVsZE1hcC5nZXQoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAg\nICAgICAgICAgIGlmIChzdXBGaWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBmaWVsZHNbaV0gPSBzdXBGaWVsZDsKICAgICAgICAgICAgICAgIHN1\ncEZpZWxkLnNldEluZGV4KGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdXBlcmNsYXNzIGNv\ncHkgb2YgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nRmllbGRNZXRhRGF0YSBnZXRTdXBlcmNsYXNzRmllbGQoRmllbGRNZXRhRGF0\nYSBzdXBGaWVsZCkgewogICAgICAgIENsYXNzTWV0YURhdGEgc20gPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gc20gPT0gbnVsbCA/IG51bGwgOiBzbS5nZXRGaWVsZChzdXBGaWVs\nZC5nZXROYW1lKCkpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCB8fCBmbWQu\nZ2V0TWFuYWdlbWVudCgpICE9IGZtZC5NQU5BR0VfUEVSU0lTVEVOVCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ1bm1hbmFnZWQtc3VwLWZpZWxkIiwKICAgICAgICAgICAgICAgIHN1cEZp\nZWxkLCB0aGlzKSk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBvbmx5IHRoZSBmaWVsZHMgZm9yIHRoaXMgY2xh\nc3MsIHdpdGhvdXQgc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAgKi8KICAgIHB1\nYmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVjbGFyZWRGaWVsZHMoKSB7CiAg\nICAgICAgaWYgKF9maWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBMaXN0\nIGZpZWxkcyA9IG5ldyBBcnJheUxpc3QoX2ZpZWxkTWFwLnNpemUoKSk7CiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IF9maWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZm1kID0gKEZp\nZWxkTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9O\nT05FKSB7CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldERlY2xhcmVkSW5k\nZXgoZmllbGRzLnNpemUoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZt\nZC5nZXRJbmRleCgpID09IC0xKQogICAgICAgICAgICAgICAgICAgICAgICBm\nbWQuc2V0SW5kZXgoZm1kLmdldERlY2xhcmVkSW5kZXgoKSk7CiAgICAgICAg\nICAgICAgICAgICAgZmllbGRzLmFkZChmbWQpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZHMgPSAoRmllbGRN\nZXRhRGF0YVtdKSBmaWVsZHMudG9BcnJheQogICAgICAgICAgICAgICAgKF9y\nZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkoZmllbGRzLnNpemUoKSkpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpZWxkczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBwcmltYXJ5IGtleSBmaWVsZHMsIG9yIGVtcHR5\nIGFycmF5IGlmIG5vbmUuIFRoZSBvcmRlcgogICAgICogaW4gd2hpY2ggdGhl\nIGtleXMgYXJlIHJldHVybmVkIHdpbGwgYmUgdGhlIG9yZGVyIGluIHdoaWNo\nCiAgICAgKiB0aGUgZmllbGRzIGFyZSBkZWNsYXJlZCwgc3RhcnRpbmcgYXQg\ndGhlIGxlYXN0LWRlcml2ZWQgc3VwZXJjbGFzcwogICAgICogYW5kIGVuZGlu\nZyB3aXRoIHRoZSBwcmltYXJ5IGtleSBmaWVsZHMgb2YgdGhlIG1vc3QtZGVy\naXZlZCBzdWJjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURh\ndGFbXSBnZXRQcmltYXJ5S2V5RmllbGRzKCkgewogICAgICAgIC8vIGNoZWNr\nIGZvciBwayBmaWVsZHMgZXZlbiBpZiBub3Qgc2V0IHRvIElEX0FQUExJQ0FU\nSU9OIHNvIHRoYXQKICAgICAgICAvLyBhcHAgaWQgdG9vbCBzZWVzIHRoZW0g\nZXZlbiB3aGVuIHVzZXIgZG9lc24ndCBkZWNsYXJlIGFwcCBpZAogICAgICAg\nIGlmIChfYWxsUEtGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nIGludCBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVs\nZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICAgICAgbnVt\nKys7CgogICAgICAgICAgICBpZiAobnVtID09IDApCiAgICAgICAgICAgICAg\nICBfYWxsUEtGaWVsZHMgPSBfcmVwb3MuRU1QVFlfRklFTERTOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBw\na3MgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAgICAg\nICAgICAgICAgICBudW0gPSAwOwogICAgICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5zZXRQcmltYXJ5S2V5SW5k\nZXgobnVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGtzW251bV0gPSBm\naWVsZHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIG51bSsrOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIF9hbGxQS0ZpZWxkcyA9IHBrczsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2FsbFBLRmllbGRzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBsaXN0IG9mIGZpZWxkcyBpbiB0aGUg\nZGVmYXVsdCBmZXRjaCBncm91cCwKICAgICAqIGluY2x1ZGluZyBzdXBlcmNs\nYXNzIGZpZWxkcywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZhdWx0RmV0Y2hH\ncm91cEZpZWxkcygpIHsKICAgICAgICBpZiAoX2FsbERGR0ZpZWxkcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBn\nZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc0luRGVmYXVsdEZldGNo\nR3JvdXAoKSkKICAgICAgICAgICAgICAgICAgICBudW0rKzsKCiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBkZmdzID0gX3JlcG9zLm5ld0ZpZWxkTWV0\nYURhdGFBcnJheShudW0pOwogICAgICAgICAgICBudW0gPSAwOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNJbkRlZmF1bHRGZXRj\naEdyb3VwKCkpCiAgICAgICAgICAgICAgICAgICAgZGZnc1tudW0rK10gPSBm\naWVsZHNbaV07CiAgICAgICAgICAgIF9hbGxERkdGaWVsZHMgPSBkZmdzOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbERGR0ZpZWxkczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmVyc2lvbiBmaWVsZCBmb3Ig\ndGhpcyBjbGFzcywgaWYgYW55LgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YSBnZXRWZXJzaW9uRmllbGQoKSB7CiAgICAgICAgaWYgKF92ZXJz\naW9uSWR4ID09IEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgaW50IGlkeCA9IC0xOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5pc1ZlcnNpb24oKSkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChpZHggIT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKCJtdWx0LXZlcnMtZmllbGRzIiwgdGhpcywgZmll\nbGRzW2lkeF0sIGZpZWxkc1tpXSkpOwogICAgICAgICAgICAgICAgICAgIGlk\neCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgX3ZlcnNpb25JZHggPSBpZHg7CiAgICAgICAgfQogICAgICAgIGlm\nIChfdmVyc2lvbklkeCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgcmV0dXJuIGdldEZpZWxkcygpW192ZXJzaW9uSWR4XTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRo\nZSBwZXJzaXN0ZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0aAogICAg\nICogdGhlIGdpdmVuIGFic29sdXRlIGluZGV4LgogICAgICoKICAgICAqIEBy\nZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZv\ndW5kCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZpZWxk\nKGludCBpbmRleCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMg\nPSBnZXRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4\nID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQg\nb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4g\ncmVsYXRpdmUgaW5kZXguCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmll\nbGQncyBtZXRhZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwog\nICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVjbGFyZWRGaWVsZChpbnQg\naW5kZXgpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGlu\nZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3Rl\nbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2\nZW4gbmFtZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1l\ndGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YSBnZXRGaWVsZChTdHJpbmcgbmFtZSkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gZ2V0RGVjbGFyZWRGaWVsZChuYW1l\nKTsKICAgICAgICBpZiAoZm1kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmbWQ7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCAhPSBudWxsICYmIF9k\nZWZTdXBGaWVsZHMpIHsKICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0YURh\ndGEpIF9zdXBGaWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAgICAgIGlmIChm\nbWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmbWQ7CiAgICAg\nICAgfQogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGQobmFt\nZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0\ncmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBuYW1l\nLCB3aXRob3V0IGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxs\nIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYSBnZXREZWNsYXJlZEZpZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfZmllbGRNYXAu\nZ2V0KG5hbWUpOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsIHx8IGZpZWxk\nLmdldE1hbmFnZW1lbnQoKSA9PSBmaWVsZC5NQU5BR0VfTk9ORSkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFueSBmaWVsZHMgdGhhdCB3ZXJl\nIGFkZGVkIGFzIG5vbi1tYW5hZ2VkLgogICAgICogQWxsIG90aGVyIG1ldGhv\nZHMgdG8gZ2V0IGZpZWxkcyByZXR1cm4gb25seSB0aG9zZSB0aGF0IGFyZSBt\nYW5hZ2VkLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdl\ndERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCkgewogICAgICAgIGlmIChfdW5t\nZ2RGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBDb2xsZWN0aW9uIHVu\nbWFuYWdlZCA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZmllbGQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IChGaWVsZE1ldGFEYXRh\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdldE1h\nbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAg\nICAgICAgICAgICAgICAgIHVubWFuYWdlZC5hZGQoZmllbGQpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF91bm1nZEZpZWxkcyA9IChGaWVsZE1ldGFE\nYXRhW10pIHVubWFuYWdlZC50b0FycmF5CiAgICAgICAgICAgICAgICAoX3Jl\ncG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheSh1bm1hbmFnZWQuc2l6ZSgpKSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfdW5tZ2RGaWVsZHM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgZmllbGQgbWV0YWRhdGEgdG8g\ndGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEg\nYWRkRGVjbGFyZWRGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxkTWV0\nYURhdGEobmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgY2xlYXJGaWVsZENh\nY2hlKCk7CiAgICAgICAgX2ZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAg\nICAgIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUg\ndGhlIGdpdmVuIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxz\nZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3Zl\nRGVjbGFyZWRGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAg\naWYgKGZpZWxkICE9IG51bGwgJiYgX2ZpZWxkTWFwLnJlbW92ZShmaWVsZC5n\nZXROYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJGaWVsZENh\nY2hlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGRlZmluZWQgc3VwZXJjbGFzcyBmaWVsZCB3aXRoIHRoZSBnaXZl\nbiBuYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1ldGFEYXRhIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5n\nIG5hbWUpIHsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRmllbGRN\nZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBhIG5ldyBkZWZpbmVkIHN1cGVyY2xhc3MgZmllbGQg\nbWV0YWRhdGEgdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWV0YURhdGEgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChTdHJpbmcg\nbmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzcyBzdXApIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRh\nKG5hbWUsIHR5cGUsIHRoaXMpOwogICAgICAgIGZtZC5zZXREZWNsYXJpbmdU\neXBlKHN1cCk7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAg\nICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgICAgIGlmIChfc3VwRmll\nbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX3N1cEZpZWxkTWFwID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfc3VwRmllbGRNYXAucHV0KG5hbWUsIGZt\nZCk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50LgogICAg\nICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2FzIHJlbW92\nZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZW1vdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEg\nZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfc3VwRmll\nbGRNYXAgIT0gbnVsbAogICAgICAgICAgICAmJiBfc3VwRmllbGRNYXAucmVt\nb3ZlKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBj\nbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgX2RlZlN1cEZpZWxk\ncyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nSW5jb3Jwb3JhdGUgc3VwZXJjbGFzcyBmaWVsZHMgcmVkZWZpbmVkIGluIHRo\naXMgc3ViY2xhc3MgaW50byB0aGlzCiAgICAgKiBtZXRhZGF0YS4gVGhpcyBt\nZXRob2QgaXMgZ2VuZXJhbGx5IGNhbGxlZCBhZnRlciBtZXRhZGF0YSBpcyBy\nZXNvbHZlZAogICAgICogYW5kIG1hcHBpbmcgaW5mb3JtYXRpb24gaXMgbG9h\nZGVkLCBidXQgYmVmb3JlIG1hcHBpbmcgcmVzb2x2ZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZm9yY2Ugd2hldGhlciB0byBmb3JjZSByZS1tYXBwaW5nIG9m\nIGV2ZW4gbWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGRlZmluZVN1cGVyY2xhc3NGaWVsZHMoYm9vbGVhbiBmb3Jj\nZSkgewogICAgICAgIGlmIChfZGVmU3VwRmllbGRzKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoaXNNYXBwZWQoKSAmJiBz\ndXAgIT0gbnVsbCkgewogICAgICAgICAgICAvLyByZWRlZmluZSBhbGwgdW5t\nYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIHN1cHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKChmb3JjZSB8fCAhc3Vwc1tpXS5nZXREZWZpbmluZ01l\ndGFEYXRhKCkuaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAmJiBn\nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkRGVmaW5lZFN1cGVy\nY2xhc3NGaWVsZChzdXBzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgc3Vwc1tpXS5n\nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJj\nbGFzc0ZpZWxkcygpOwoKICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhhdCBh\nbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRzIGFyZSBjYWNo\nZWQuCiAgICAgICAgLy8gSSBkb24ndCBsaWtlIGRvaW5nIHRoaXMgdHdpY2Ug\nKGl0J3MgYWxzbyBkb25lIGluIHJlc29sdmVNZXRhKSwgYnV0CiAgICAgICAg\nLy8gd2UgaGF2ZSB0byByZS1jYWNoZSBpbiBjYXNlIHRoaXMgY2xhc3Mgb3Ig\nYW55IHN1cGVyY2xhc3MgcmVwbGFjZWQKICAgICAgICAvLyBzb21lIGZpZWxk\ncyB3aXRoIHJlZGVmaW5lZCB2ZXJzaW9ucywgYW5kIEkgZG9uJ3Qgd2FudCBv\ndXRzaWRlIGNvZGUKICAgICAgICAvLyB0byBoYXZlIHRvIGNhbGwgdGhpcyBt\nZXRob2QgYWZ0ZXIgcmVzb2x2ZSBqdXN0IHRvIGdldCBmaWVsZCBpbmRleGVz\nLAogICAgICAgIC8vIGV0YyBzZXQgY29ycmVjdGx5CiAgICAgICAgY2xlYXJB\nbGxGaWVsZENhY2hlKCk7CiAgICAgICAgY2FjaGVGaWVsZHMoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc29sdmUgc3VwZXJjbGFzcyBmaWVsZHMgd2Un\ndmUgcmVkZWZpbmVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2\nZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCkgewogICAgICAgIF9kZWZTdXBG\naWVsZHMgPSB0cnVlOwogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZDsKICAgICAgICBGaWVsZE1ldGFEYXRhIHN1cDsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IF9zdXBGaWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBmbWQgPSAoRmll\nbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgc3VwID0gZ2V0\nU3VwZXJjbGFzc0ZpZWxkKGZtZCk7CgogICAgICAgICAgICAvLyBqcGEgbWV0\nYWRhdGEgZG9lc24ndCBxdWFsaWZ5IHN1cGVyY2xhc3MgZmllbGQgbmFtZXMs\nIHNvIHdlCiAgICAgICAgICAgIC8vIG1pZ2h0IG5vdCBrbm93IHRoZSBkZWNs\nYXJpbmcgdHlwZSB1bnRpbCBub3cKICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJpbmdUeXBlKCkgPT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAgICAg\nICAgICBmbWQuc2V0RGVjbGFyaW5nVHlwZShzdXAuZ2V0RGVjbGFyaW5nVHlw\nZSgpKTsKICAgICAgICAgICAgICAgIGZtZC5iYWNraW5nTWVtYmVyKGdldFJl\ncG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAgICAgICAg\nICAgICAgICBnZXREZWZhdWx0cygpLmdldEJhY2tpbmdNZW1iZXIoZm1kKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm1kLmNvcHkoc3VwKTsKICAg\nICAgICAgICAgZm1kLnJlc29sdmUoTU9ERV9NRVRBKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGFsbCB0\naGUgZmllbGRzIGRlZmluZWQgYnkgdGhpcyBjbGFzcy4KICAgICAqIFRoaXMg\naW5jbHVkZXMgbWFwcGVkIGRlY2xhcmVkIGZpZWxkcyBhbmQgYW55IGNvbmNy\nZXRlIG1hcHBpbmcgb2YKICAgICAqIHVubWFwcGVkIHN1cGVyY2xhc3MgZmll\nbGRzIHBlcmZvcm1lZCBieSB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YVtdIGdldERlZmluZWRGaWVsZHMoKSB7CiAgICAg\nICAgaWYgKF9kZWZpbmVkRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAg\nICAgICBMaXN0IGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5n\ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5p\nc01hcHBlZCgpCiAgICAgICAgICAgICAgICAgICAgJiYgZmllbGRzW2ldLmdl\ndERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKQogICAgICAgICAgICAgICAg\nICAgIGRlZmluZWQuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX2RlZmluZWRGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSBk\nZWZpbmVkLnRvQXJyYXkKICAgICAgICAgICAgICAgIChfcmVwb3MubmV3Rmll\nbGRNZXRhRGF0YUFycmF5KGRlZmluZWQuc2l6ZSgpKSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfZGVmaW5lZEZpZWxkczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgYWxsIGZpZWxkcyBpbiB0aGUgb3JkZXIgdGhleSBh\ncmUgbGlzdGVkIGluIHRoZSBtZXRhZGF0YQogICAgICogZmlsZS4gVW5saXN0\nZWQgZmllbGRzIGFyZSBwbGFjZWQgYWZ0ZXIgbGlzdGVkIG9uZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RmllbGRzSW5MaXN0\naW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9hbGxMaXN0aW5nRmllbGRzID09\nIG51bGwpIHsKICAgICAgICAgICAgLy8gY29tYmluZSBkZWNsYXJlZCBhbmQg\ndW5tYW5hZ2VkIGZpZWxkcyBpbnRvIGxpc3Rpbmcgb3JkZXIgYXJyYXkKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRlYyA9IGdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdl\ndERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBkZWNMaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURh\ndGFBcnJheQogICAgICAgICAgICAgICAgKGRlYy5sZW5ndGggKyB1bm1nZC5s\nZW5ndGgpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGRlYywgMCwg\nZGVjTGlzdGluZywgMCwgZGVjLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3Rl\nbS5hcnJheWNvcHkodW5tZ2QsIDAsIGRlY0xpc3RpbmcsIGRlYy5sZW5ndGgs\nIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGRlY0xp\nc3RpbmcsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7\nCgogICAgICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfYWxsTGlzdGluZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7CiAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gcGxhY2Ugc3VwZXJjbGFz\ncyBmaWVsZHMgaW4gbGlzdGluZyBvcmRlciBiZWZvcmUgb3VyCiAgICAgICAg\nICAgICAgICAvLyBsaXN0aW5nLW9yZGVyIGRlY2xhcmVkIGZpZWxkcwogICAg\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRz\nSW5MaXN0aW5nT3JkZXIoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBsaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQog\nICAgICAgICAgICAgICAgICAgIChzdXAubGVuZ3RoICsgZGVjTGlzdGluZy5s\nZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShzdXAs\nIDAsIGxpc3RpbmcsIDAsIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAgICAg\ncmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKGxpc3RpbmcsIHN1cC5s\nZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWNM\naXN0aW5nLCAwLCBsaXN0aW5nLCBzdXAubGVuZ3RoLAogICAgICAgICAgICAg\nICAgICAgIGRlY0xpc3RpbmcubGVuZ3RoKTsKICAgICAgICAgICAgICAgIF9h\nbGxMaXN0aW5nRmllbGRzID0gbGlzdGluZzsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2FsbExpc3RpbmdGaWVsZHM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBmaWVsZHMgZGVmaW5lZCBi\neSB0aGlzIGNsYXNzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQKICAg\nICAqIGluIHRoZSBtZXRhZGF0YSBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJl\nIHBsYWNlZCBhZnRlciBsaXN0ZWQgb25lcy4KICAgICAqIFRoaXMgYXJyYXkg\naW5jbHVkZXMgZGVjbGFyZWQgdHJhbnNhY3Rpb25hbCBhbmQgdW5tYW5hZ2Vk\nIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBn\nZXREZWZpbmVkRmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYg\nKF9saXN0aW5nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBM\naXN0IGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0RGVmaW5p\nbmdNZXRhRGF0YSgpID09IHRoaXMpCiAgICAgICAgICAgICAgICAgICAgZGVm\naW5lZC5hZGQoZmllbGRzW2ldKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIHVubWdkID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3\nRmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVmaW5lZC5z\naXplKCkgKyB1bm1nZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGRlZmluZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAg\nICBsaXN0aW5nW2ldID0gKEZpZWxkTWV0YURhdGEpIGRlZmluZWQuZ2V0KGkp\nOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KHVubWdkLCAwLCBsaXN0\naW5nLCBkZWZpbmVkLnNpemUoKSwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAg\nICAgQXJyYXlzLnNvcnQobGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRv\nci5nZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgX2xpc3RpbmdGaWVsZHMg\nPSBsaXN0aW5nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2xpc3RpbmdG\naWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUg\nZGF0YWNhY2hlIHRvIHVzZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERhdGFDYWNoZU5h\nbWUoKSB7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFscyhfY2Fj\naGVOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfY2FjaGVOYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKS5nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBEYXRhQ2FjaGUuTkFNRV9E\nRUZBVUxUOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NhY2hlTmFtZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGUgbmFtZSBmb3Ig\ndGhpcyBjbGFzcy4gU2V0IHRvIG51bGwgdG8gZGlzYWJsZSBjYWNoaW5nLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVOYW1lKFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgX2NhY2hlTmFtZSA9IG5hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgY2FjaGUgdGltZW91dCBmb3IgdGhpcyBjbGFz\ncy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBpbnQgZ2V0RGF0YUNhY2hlVGltZW91dCgpIHsKICAgICAgICBpZiAoX2Nh\nY2hlVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAg\nICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY2FjaGVU\naW1lb3V0ID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAg\nICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQgPSBfcmVwb3Mu\nZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAgICAgIGdldERh\ndGFDYWNoZVRpbWVvdXQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9j\nYWNoZVRpbWVvdXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2FjaGUg\ndGltZW91dCBmb3IgdGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVv\ndXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGFDYWNoZVRpbWVv\ndXQoaW50IHRpbWVvdXQpIHsKICAgICAgICBfY2FjaGVUaW1lb3V0ID0gdGlt\nZW91dDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGF0YSBj\nYWNoZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBpZiBpdCBpcyBub3QgY2Fj\naGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBEYXRhQ2FjaGUgZ2V0RGF0YUNh\nY2hlKCkgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RGF0YUNhY2hlTmFt\nZSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0Q29uZmlndXJh\ndGlvbigpLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLgogICAgICAg\nICAgICBnZXREYXRhQ2FjaGUobmFtZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hhYmxlKCkgewogICAg\nICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlm\nIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hhYmxl\nID0gKGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNEZXRhY2hhYmxlKCkp\nCiAgICAgICAgICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZGV0\nYWNoYWJsZSA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfZGV0YWNoYWJsZS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hhYmxlLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hhYmxlKGJvb2xlYW4g\nZGV0YWNoYWJsZSkgewogICAgICAgIF9kZXRhY2hhYmxlID0gKGRldGFjaGFi\nbGUpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmll\nbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXREZXRhY2hlZFN0YXRlKCkgewogICAgICAgIGlmIChERUZBVUxUX1NU\nUklORy5lcXVhbHMoX2RldGFjaFN0YXRlKSkgewogICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNEZXRhY2hhYmxl\nKCkgPT0gaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICBfZGV0YWNo\nU3RhdGUgPSBzdXAuZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gdXNlID0gdXNlc0RldGFj\naGVkU3RhdGUoU1lOVEhFVElDLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9k\nZXRhY2hTdGF0ZSA9IChCb29sZWFuLkZBTFNFLmVxdWFscyh1c2UpKSA/IG51\nbGwgOiBTWU5USEVUSUM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwg\naWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoZWRT\ndGF0ZShTdHJpbmcgZmllbGQpIHsKICAgICAgICBfZGV0YWNoU3RhdGUgPSBm\naWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGV0YWNo\nIHN0YXRlIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1\nYmxpYyBGaWVsZCBnZXREZXRhY2hlZFN0YXRlRmllbGQoKSB7CiAgICAgICAg\nLy8gbm8gY2FjaGluZzsgb25seSB1c2VkIGF0IGVuaGFuY2VtZW50CiAgICAg\nICAgU3RyaW5nIGZpZWxkTmFtZSA9IGdldERldGFjaGVkU3RhdGUoKTsKICAg\nICAgICBpZiAoZmllbGROYW1lID09IG51bGwgfHwgU1lOVEhFVElDLmVxdWFs\ncyhmaWVsZE5hbWUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgRmllbGQgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKF90eXBlLCBmaWVs\nZE5hbWUsIGZhbHNlKTsKICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2Mu\nZ2V0KCJuby1kZXRhY2gtc3RhdGUiLCBmaWVsZE5hbWUsIF90eXBlKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGFuIGluc3RhbmNlIG9mIHRo\naXMgdHlwZSBoYXMgZGV0YWNoZWQgc3RhdGUuCiAgICAgKgogICAgICogQHJl\ndHVybiB0cnVlIGlmIGEgZGV0YWNoZWQgaW5zdGFuY2UgbXVzdCBoYXZlIGRl\ndGFjaGVkIHN0YXRlLCBmYWxzZQogICAgICogaWYgaXQgZG9lcyBub3QsIGFu\nZCBudWxsIGlmIGl0IG1heSB1c2UgYQogICAgICogbWFudWFsbHktY29uc3Ry\ndWN0ZWQgaW5zdGFuY2Ugd2l0aG91dCBkZXRhY2hlZCBzdGF0ZQogICAgICov\nCiAgICBwdWJsaWMgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZSgpIHsKICAg\nICAgICAvLyBubyBuZWVkIHRvIGxldCBjb25mIGRpc2FsbG93IGJlY2F1c2Ug\naXQncyB0YWtlbiBpbnRvIGFjY291bnQgaW4KICAgICAgICAvLyBnZXREZXRh\nY2hlZFN0YXRlKCkgY2FsbAogICAgICAgIHJldHVybiB1c2VzRGV0YWNoZWRT\ndGF0ZShnZXREZXRhY2hlZFN0YXRlKCksIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0eXBlIGhh\ncyBkZXRhY2hlZCBzdGF0ZSwgYXNzdW1pbmcgdGhlIGdpdmVuCiAgICAgKiBk\nZXRhY2hlZCBzdGF0ZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgYSBkZXRhY2hlZCBpbnN0YW5jZSBtdXN0IGhhdmUgZGV0YWNoZWQg\nc3RhdGUsIGZhbHNlCiAgICAgKiBpZiBpdCBkb2VzIG5vdCwgYW5kIG51bGwg\naWYgaXQgbWF5IHVzZSBhCiAgICAgKiBtYW51YWxseS1jb25zdHJ1Y3RlZCBp\nbnN0YW5jZSB3aXRob3V0IGRldGFjaGVkIHN0YXRlCiAgICAgKi8KICAgIHBy\naXZhdGUgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZShTdHJpbmcgZGV0YWNo\nZWRGaWVsZCwKICAgICAgICBib29sZWFuIGNvbmZEaXNhbGxvd3MpIHsKICAg\nICAgICBpZiAoIWlzRGV0YWNoYWJsZSgpKQogICAgICAgICAgICByZXR1cm4g\nQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgLy8gaWYgd2UgZGVjbGFyZSBhIGRl\ndGFjaGVkIHN0YXRlIGZpZWxkLCBoYXZlIHRvIHVzZSBpdAogICAgICAgIGlm\nIChkZXRhY2hlZEZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBC\nb29sZWFuLkZBTFNFOwogICAgICAgIGlmICghU1lOVEhFVElDLmVxdWFscyhk\nZXRhY2hlZEZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJV\nRTsKCiAgICAgICAgLy8gYWxsb3cgY29uZiB0byBkaXNhbGxvdwogICAgICAg\nIGlmIChjb25mRGlzYWxsb3dzICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlv\nbigpLgogICAgICAgICAgICBnZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuZ2V0\nRGV0YWNoZWRTdGF0ZUZpZWxkKCkpCiAgICAgICAgICAgIHJldHVybiBCb29s\nZWFuLkZBTFNFOwoKICAgICAgICAvLyBoYXZlIHRvIHVzZSBkZXRhY2hlZCBz\ndGF0ZSB0byBzdG9yZSBkYXRhc3RvcmUgaWQKICAgICAgICBpZiAoZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gSURfREFUQVNUT1JFKQogICAgICAgICAgICByZXR1\ncm4gQm9vbGVhbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBkZXRhY2hlZCBz\ndGF0ZSB1c2UsIGJ1dCBkb24ndCByZXF1aXJlCiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgZmllbGQg\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJBbGxGaWVs\nZENhY2hlKCkgewogICAgICAgIF9hbGxGaWVsZHMgPSBudWxsOwogICAgICAg\nIF9hbGxERkdGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxQS0ZpZWxkcyA9\nIG51bGw7CiAgICAgICAgX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgICAg\nIF9saXN0aW5nRmllbGRzID0gbnVsbDsKICAgICAgICBfYWxsTGlzdGluZ0Zp\nZWxkcyA9IG51bGw7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGRlZmluZWQgZmllbGQgZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZpbmVkRmll\nbGRDYWNoZSgpIHsKICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IG51bGw7CiAg\nICAgICAgX2xpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2xlYXIgY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGNsZWFyRmllbGRDYWNoZSgpIHsKICAgICAgICBjbGVh\nckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRzID0gbnVsbDsKICAg\nICAgICBfdW5tZ2RGaWVsZHMgPSBudWxsOwogICAgICAgIF92ZXJzaW9uSWR4\nID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nbGVhciBjYWNoZWQgc3ViY2xhc3MgZGF0YS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgY2xlYXJTdWJjbGFzc0NhY2hlKCkgewogICAgICAgIF9zdWJz\nID0gbnVsbDsKICAgICAgICBfc3ViTWV0YXMgPSBudWxsOwogICAgICAgIF9t\nYXBTdWJNZXRhcyA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVh\nciBpbXBsIGRhdGEgYW5kIGludGVybWVkaWF0ZSBkYXRhIHRhYmxlLgogICAg\nICovCiAgICB2b2lkIGNsZWFyRXh0cmFGaWVsZERhdGFUYWJsZSgpIHsKICAg\nICAgICBfZmllbGREYXRhVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2FjaGUgZmllbGQgYXJyYXlzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgY2FjaGVGaWVsZHMoKSB7CiAgICAgICAgZ2V0RmllbGRzKCk7CiAg\nICAgICAgZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5h\nbWUoKS5oYXNoQ29kZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVx\ndWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhp\ncykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3Ro\nZXIgaW5zdGFuY2VvZiBDbGFzc01ldGFEYXRhKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfdHlwZSA9PSAoKENsYXNzTWV0\nYURhdGEpIG90aGVyKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9CgogICAg\ncHVibGljIGludCBjb21wYXJlVG8oT2JqZWN0IG90aGVyKSB7CiAgICAgICAg\naWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiAwOwogICAg\nICAgIHJldHVybiBfdHlwZS5nZXROYW1lKCkuY29tcGFyZVRvKCgoQ2xhc3NN\nZXRhRGF0YSkgb3RoZXIpLgogICAgICAgICAgICBnZXREZXNjcmliZWRUeXBl\nKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3Ry\naW5nKCkgewogICAgICAgIHJldHVybiBnZXREZXNjcmliZWRUeXBlKCkuZ2V0\nTmFtZSgpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gUmVzb2x2ZSBhbmQgdmFsaWRhdGUKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUgbW9kZSBm\nb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRS\nZXNvbHZlKCkgewogICAgICAgIHJldHVybiBfcmVzTW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1v\nZGUpIHsKICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlLCBi\nb29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQog\nICAgICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAo\nb24pCiAgICAgICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfcmVzTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc29sdmUgYW5kIHZhbGlkYXRlIG1ldGFkYXRhLiBSZXR1\ncm4gdHJ1ZSBpZiBhbHJlYWR5IHJlc29sdmVkLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgaWYgKChf\ncmVzTW9kZSAmIG1vZGUpID09IG1vZGUpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGludCBjdXIgPSBfcmVzTW9kZTsKICAgICAgICBfcmVz\nTW9kZSB8PSBtb2RlOwoKICAgICAgICBpbnQgdmFsID0gX3JlcG9zLmdldFZh\nbGlkYXRlKCk7CiAgICAgICAgYm9vbGVhbiBydW50aW1lID0gKHZhbCAmIF9y\nZXBvcy5WQUxJREFURV9SVU5USU1FKSAhPSAwOwogICAgICAgIGJvb2xlYW4g\ndmFsaWRhdGUgPQogICAgICAgICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRU\neXBlKGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCksIF90eXBl\nKQogICAgICAgICAgICB8fCAodmFsICYgTWV0YURhdGFSZXBvc2l0b3J5LlZB\nTElEQVRFX1VORU5IQU5DRUQpID09IDA7CgogICAgICAgIC8vIHdlIG9ubHkg\nZG8gYW55IGFjdGlvbnMgZm9yIG1ldGFkYXRhIG1vZGUKICAgICAgICBpZiAo\nKG1vZGUgJiBNT0RFX01FVEEpICE9IDAgJiYgKGN1ciAmIE1PREVfTUVUQSkg\nPT0gMCkgewogICAgICAgICAgICByZXNvbHZlTWV0YShydW50aW1lKTsKICAg\nICAgICAgICAgaWYgKHZhbGlkYXRlICYmICh2YWwgJiBfcmVwb3MuVkFMSURB\nVEVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgICAgIHZhbGlkYXRlTWV0YShy\ndW50aW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9N\nQVBQSU5HKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkcpID09IDApIHsK\nICAgICAgICAgICAgcmVzb2x2ZU1hcHBpbmcocnVudGltZSk7CiAgICAgICAg\nICAgIGlmICh2YWxpZGF0ZSAmJiAodmFsICYgX3JlcG9zLlZBTElEQVRFX01B\nUFBJTkcpICE9IDApCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU1hcHBpbmco\ncnVudGltZSk7CiAgICAgICAgfQogICAgICAgIGlmICgobW9kZSAmIE1PREVf\nTUFQUElOR19JTklUKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkdfSU5J\nVCkgPT0gMCkKICAgICAgICAgICAgaW5pdGlhbGl6ZU1hcHBpbmcoKTsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNv\nbHZlIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNv\nbHZlTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBib29sZWFuIGVt\nYmVkID0gX293bmVyICE9IG51bGwgJiYgX293bmVyLmdldERlY2xhcmVkVHlw\nZSgpID09IF90eXBlOwogICAgICAgIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9n\nKCk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBsb2cudHJhY2UoX2xvYy5nZXQoKGVtYmVkKSA/ICJyZXNvbHZlLWVt\nYmVkLW1ldGEiIDogInJlc29sdmUtbWV0YSIsCiAgICAgICAgICAgICAgICB0\naGlzICsgIkAiICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpKTsK\nCiAgICAgICAgaWYgKHJ1bnRpbWUgJiYgIV90eXBlLmlzSW50ZXJmYWNlKCkg\nJiYKICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRS\nZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLF90eXBlKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb3QtZW5oYW5jZWQiLCBfdHlwZSkpOwoKICAgICAgICAvLyBhcmUgd2UgdGhl\nIHRhcmdldCBvZiBhbiBlbWJlZGRlZCB2YWx1ZT8KICAgICAgICBpZiAoZW1i\nZWQpIHsKICAgICAgICAgICAgaWYgKF9vd25lci5nZXRGaWVsZE1ldGFEYXRh\nKCkuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgZ2V0\nRGVzY3JpYmVkVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX3R5cGUpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJyZWN1cnNlLWVtYmVkIiwgX293bmVyKSk7CgogICAgICAgICAgICAv\nLyBjb3B5IGluZm8gZnJvbSB0aGUgInJlYWwiIG1ldGFkYXRhIGZvciB0aGlz\nIHR5cGUKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX3JlcG9z\nLmdldE1ldGFEYXRhKF90eXBlLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgbWV0YS5yZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGNvcHko\ndGhpcywgbWV0YSk7CiAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4u\nRkFMU0U7IC8vIGVtYmVkZGVkIGluc3RhbmNlIGlzbid0IGVtYmVkZGVkLW9u\nbHkKICAgICAgICB9CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNz\nIGlzIHJlc29sdmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVs\nbCkgewogICAgICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01FVEEpOwogICAg\nICAgICAgICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgICAgIC8vIGVtYmVk\nZGVkIGluc3RhbmNlIGFsd2F5cyByZWRlZmluZSBhbGwgc3VwZXJjbGFzcyBm\naWVsZHMKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBzID0g\nc3VwLmdldEZpZWxkcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8ICFfc3VwRmllbGRNYXAuY29udGFpbnNLZXkoc3Vwc1tpXS5n\nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERlZmlu\nZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdldERlY2xhcmVkVHlwZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNs\nYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\ncmVzb2x2ZSBmaWVsZHMgYW5kIHJlbW92ZSBpbnZhbGlkcwogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIC8vIG9ubHkgcGFzcyBvbiBtZXRhZGF0YSByZXNv\nbHZlIG1vZGUgc28gdGhhdCBtZXRhZGF0YSBpcyBhbHdheXMKICAgICAgICAg\nICAgLy8gcmVzb2x2ZWQgYmVmb3JlIGFueSBvdGhlciByZXNvbHZlIG1vZGVz\nIG91ciBzdWJjbGFzc2VzIHBhc3MgYWxvbmcKICAgICAgICAgICAgZm1kID0g\nKEZpZWxkTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGZtZC5y\nZXNvbHZlKE1PREVfTUVUQSk7CgogICAgICAgICAgICBpZiAoIWZtZC5pc0V4\ncGxpY2l0KCkKICAgICAgICAgICAgICAgICYmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5PQkpFQ1QKICAgICAgICAgICAgICAg\nIHx8IGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBD\nX1VOVFlQRUQKICAgICAgICAgICAgICAgIHx8IChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWQogICAgICAgICAgICAgICAg\nJiYgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2RlKCkKICAg\nICAgICAgICAgICAgID09IEphdmFUeXBlcy5PQkpFQ1QpKSkgewogICAgICAg\nICAgICAgICAgX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5nZXQoInJtLWZp\nZWxkIiwgZm1kKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldExpc3Rp\nbmdJbmRleCgpICE9IC0xKQogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRN\nYW5hZ2VtZW50KGZtZC5NQU5BR0VfTk9ORSk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAg\nICAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGVtYmVkZGVkIGluc3RhbmNlcyBtdXN0IGVt\nYmVkIGFsbCBzdXBlcmNsYXNzIGZpZWxkcyB0b28KICAgICAgICBpZiAoZW1i\nZWQpIHsKICAgICAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAg\nICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcygpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQgYWxsIGZpZWxk\nIGluZGV4ZXMgZ2V0IHNldCB3aGVuIGZpZWxkcyBhcmUgY2FjaGVkCiAgICAg\nICAgY2FjaGVGaWVsZHMoKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBsaWZlY3lj\nbGUgbWV0YWRhdGEgbm93IHRvIHByZXZlbnQgbGF6eSB0aHJlYWRpbmcgcHJv\nYmxlbXMKICAgICAgICBfbGlmZU1ldGEucmVzb2x2ZSgpOwoKICAgICAgICAv\nLyByZWNvcmQgaW1wbGVtZW50cyBpbiB0aGUgcmVwb3NpdG9yeQogICAgICAg\nIGlmIChfaW50ZXJmYWNlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXQgPSBfaW50ZXJmYWNlcy5pdGVyYXRvcigpOyBpdC5oYXNO\nZXh0KCk7KQogICAgICAgICAgICAgICAgX3JlcG9zLmFkZERlY2xhcmVkSW50\nZXJmYWNlSW1wbCh0aGlzLCAoQ2xhc3MpIGl0Lm5leHQoKSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyByZXNvbHZlIGZldGNoIGdyb3VwcwogICAgICAgIGlm\nIChfZmdNYXAgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfZmdNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspCiAgICAgICAgICAgICAgICAoKEZldGNoR3JvdXApIGl0ci5uZXh0KCkp\nLnJlc29sdmUoKTsKCiAgICAgICAgaWYgKCFlbWJlZCAmJiBfdHlwZS5pc0lu\ndGVyZmFjZSgpKSB7CiAgICAgICAgICAgIGlmIChfaW50ZXJmYWNlICE9IEJv\nb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiaW50ZXJmYWNlIiwgX3R5cGUpKTsKCiAg\nICAgICAgICAgIGlmIChydW50aW1lKSB7CiAgICAgICAgICAgICAgICBfaW1w\nbCA9IF9yZXBvcy5nZXRJbXBsR2VuZXJhdG9yKCkuY3JlYXRlSW1wbCh0aGlz\nKTsKICAgICAgICAgICAgICAgIF9yZXBvcy5zZXRJbnRlcmZhY2VJbXBsKHRo\naXMsIF9pbXBsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gaWYgdGhpcyBpcyBydW50aW1lLCBjcmVhdGUgYSBwYyBpbnN0YW5jZSBh\nbmQgc2NhbiBpdCBmb3IgY29tcGFyYXRvcnMKICAgICAgICBpZiAocnVudGlt\nZSAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChfdHlwZS5nZXRNb2RpZmllcnMo\nKSkpIHsKICAgICAgICAgICAgUHJveHlTZXR1cFN0YXRlTWFuYWdlciBzbSA9\nIG5ldyBQcm94eVNldHVwU3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIHNt\nLnNldFByb3h5RGF0YShQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKF90eXBlLCBz\nbSwgZmFsc2UpLCB0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBWYWxpZGF0ZSByZXNvbHZlZCBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNZXRhKGJvb2xlYW4gcnVudGltZSkg\newogICAgICAgIHZhbGlkYXRlRGF0YUNhY2hlKCk7CiAgICAgICAgdmFsaWRh\ndGVEZXRhY2hhYmxlKCk7CiAgICAgICAgdmFsaWRhdGVFeHRlbnNpb25LZXlz\nKCk7CiAgICAgICAgdmFsaWRhdGVJZGVudGl0eSgpOwogICAgICAgIHZhbGlk\nYXRlQWNjZXNzVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2\nZSBtYXBwaW5nIGRhdGEuIExvZ3MgcmVzb2x2ZSBtZXNzYWdlIGFuZCByZXNv\nbHZlcyBzdXBlciBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCByZXNvbHZlTWFwcGluZyhib29sZWFuIHJ1bnRpbWUpIHsKICAgICAg\nICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJyZXNvbHZlLW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAg\nICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAg\nICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29sdmVkIGZpcnN0\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAg\nICAgc3VwLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFZhbGlkYXRlIG1hcHBpbmcgZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgdmFsaWRhdGVNYXBwaW5nKGJvb2xlYW4gcnVudGltZSkg\newogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBtYXBwaW5nLiBM\nb2dzIGluaXQgbWVzc2FnZSBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFwcGluZygpIHsKICAgICAgICBMb2cg\nbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJp\nbml0LW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAgICAgICArIFN5\nc3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBWYWxpZGF0ZSBkYXRhIGNhY2hlIHNldHRpbmdzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVEYXRhQ2FjaGUoKSB7CiAgICAg\nICAgaW50IHRpbWVvdXQgPSBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAg\nICAgaWYgKHRpbWVvdXQgPCAtMSB8fCB0aW1lb3V0ID09IDApCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2Fj\naGUtdGltZW91dC1pbnZhbGlkIiwKICAgICAgICAgICAgICAgIF90eXBlLCBT\ndHJpbmcudmFsdWVPZih0aW1lb3V0KSkpOwoKICAgICAgICBpZiAoX3N1cGVy\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBTdHJpbmcg\nY2FjaGUgPSBnZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgaWYgKGNhY2hl\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5n\nIHN1cGVyQ2FjaGUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldERh\ndGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFs\ncyhjYWNoZSwgc3VwZXJDYWNoZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtbmFtZXMiLCBuZXcg\nT2JqZWN0W10KICAgICAgICAgICAgICAgIHsgX3R5cGUsIGNhY2hlLCBfc3Vw\nZXIsIHN1cGVyQ2FjaGUgfSkpOwogICAgfQoKICAgIC8qKgogICAgICogQXNz\nZXJ0IHRoYXQgdGhlIGlkZW50aXR5IGhhbmRsaW5nIGZvciB0aGlzIGNsYXNz\nIGlzIHZhbGlkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVJ\nZGVudGl0eSgpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgaWRlbnRpdHkgdHlw\nZXMgYXJlIGNvbnNpc3RlbnQKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaW50IGlkID0g\nZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYm\nIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOCiAgICAgICAg\nICAgICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC10\neXBlcyIsIF90eXBlKSk7CgogICAgICAgIC8vIGNoZWNrIGZvciB0aGluZ3Mg\ndGhlIGRhdGEgc3RvcmUgZG9lc24ndCBzdXBwb3J0CiAgICAgICAgQ29sbGVj\ndGlvbiBvcHRzID0gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5zdXBwb3J0\nZWRPcHRpb25zKCk7CiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9O\nCiAgICAgICAgICAgICYmICFvcHRzLmNvbnRhaW5zKE9wZW5KUEFDb25maWd1\ncmF0aW9uLk9QVElPTl9JRF9BUFBMSUNBVElPTikpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJhcHBp\nZC1ub3Qtc3VwcG9ydGVkIiwKICAgICAgICAgICAgICAgIF90eXBlKSk7CiAg\nICAgICAgfQogICAgICAgIGlmIChpZCA9PSBJRF9EQVRBU1RPUkUKICAgICAg\nICAgICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nT1BUSU9OX0lEX0RBVEFTVE9SRSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAoImRhdGFzdG9yZWlkLW5vdC1zdXBwb3J0ZWQiLCBfdHlwZSkpOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9OKSB7CiAg\nICAgICAgICAgIGlmIChfaWRTdHJhdGVneSAhPSBWYWx1ZVN0cmF0ZWdpZXMu\nTk9ORSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYXBwaWQtc3RyYXRlZ3kiLCBfdHlwZSkpOwogICAg\nICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3MoKTsKICAgICAgICB9IGVsc2Ug\naWYgKGlkICE9IElEX1VOS05PV04pCiAgICAgICAgICAgIHZhbGlkYXRlTm9Q\nS0ZpZWxkcygpOwoKICAgICAgICBpbnQgc3RyYXRlZ3kgPSBnZXRJZGVudGl0\neVN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09IFZhbHVlU3Ry\nYXRlZ2llcy5TRVFVRU5DRQogICAgICAgICAgICAmJiBnZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCBfdHlw\nZSkpOwoKICAgICAgICBWYWx1ZVN0cmF0ZWdpZXMuYXNzZXJ0U3VwcG9ydGVk\nKHN0cmF0ZWd5LCB0aGlzLAogICAgICAgICAgICAiZGF0YXN0b3JlIGlkZW50\naXR5IHN0cmF0ZWd5Iik7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1\ncmUgdGhlIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIGlzIHZhbGlkLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzKCkg\newogICAgICAgIC8vIGJhc2UgdHlwZXMgbXVzdCBkZWNsYXJlIGFuIG9pZCBj\nbGFzcyBpZiBub3Qgc2luZ2xlLWZpZWxkIGlkZW50aXR5CiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHBrcyA9IGdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAg\nICAgICBpZiAoZ2V0T2JqZWN0SWRUeXBlKCkgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAocGtzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRl\nZC1pZC10eXBlIiwKICAgICAgICAgICAgICAgICAgICBfdHlwZSwgcGtzWzBd\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBwa3NbMF0uZ2V0RGVj\nbGFyZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8taWQtY2xhc3MiLCBf\ndHlwZSkpOwogICAgICAgIH0KICAgICAgICBpZiAoX29iamVjdElkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGlzT3BlbkpQ\nQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKHBrc1swXS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrc1swXS5nZXRFbWJlZGRl\nZE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xh\nc3NNZXRob2RzKGVtYmVkLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAg\nICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NQS3MoZW1iZWQsIGVtYmVkLmdl\ndEZpZWxkcygpLAogICAgICAgICAgICAgICAgICAgIGVtYmVkLmdldERlc2Ny\naWJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIGNvbmNyZXRlIHN1cGVyY2xhc3Mgb2lkcyBtdXN0IG1h\ndGNoIG9yIGJlIHBhcmVudCBvZiBvdXJzCiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICAgICAgaWYgKCFzdXAuZ2V0T2JqZWN0SWRUeXBlKCkuaXNBc3NpZ25hYmxl\nRnJvbShfb2JqZWN0SWQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC1jbGFzc2VzIiwKICAgICAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IF90eXBlLCBfb2JqZWN0SWQs\nIF9zdXBlciwKICAgICAgICAgICAgICAgICAgICAgICAgc3VwLmdldE9iamVj\ndElkVHlwZSgpIH0pKTsKCiAgICAgICAgICAgIC8vIHZhbGlkYXRlIHRoYXQg\nbm8gb3RoZXIgcGtzIGFyZSBkZWNsYXJlZCBpZiB3ZSBoYXZlIGEKICAgICAg\nICAgICAgLy8gY29uY3JldGUgUEMgc3VwZXJjbGFzcwogICAgICAgICAgICBp\nZiAoaGFzQ29uY3JldGVQQ1N1cGVyY2xhc3MoKSkKICAgICAgICAgICAgICAg\nIHZhbGlkYXRlTm9QS0ZpZWxkcygpOwogICAgICAgIH0KCiAgICAgICAgLy8g\naWYgdGhpcyBjbGFzcyBoYXMgaXRzIG93biBvaWQgY2xhc3MsIGRvIHNvbWUg\nbW9yZSB2YWxpZGF0aW9uCiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsCiAg\nICAgICAgICAgIHx8IF9vYmplY3RJZCAhPSBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpLmdldE9iamVjdElkVHlwZSgpKSB7CiAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSBub24tYWJzdHJhY3Qgb2lkIGNsYXNzZXMgb3ZlcnJpZGUgdGhl\nIHByb3BlciBtZXRob2RzCiAgICAgICAgICAgIGlmICghTW9kaWZpZXIuaXNB\nYnN0cmFjdChfb2JqZWN0SWQuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAg\nICAgICAgdmFsaWRhdGVBcHBJZENsYXNzTWV0aG9kcyhfb2JqZWN0SWQpOwoK\nICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBhcHAgaWQgY2xhc3MgaGFz\nIGFsbCBwayBmaWVsZHMKICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNz\nUEtzKHRoaXMsIHBrcywgX29iamVjdElkKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGNsYXNzIGhhcyBh\nIGNvbmNyZXRlIHBlcnNpc3RlbnQgc3VwZXJjbGFzcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkgewog\nICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChfc3Vw\nZXIuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5oYXND\nb25jcmV0ZVBDU3VwZXJjbGFzcygpOwogICAgfQoKICAgIC8qKgogICAgICog\nRW5zdXJlIHRoYXQgdGhlIHVzZXIgaGFzIG92ZXJyaWRkZW4gdGhlIGVxdWFs\ncyBhbmQgaGFzaENvZGUgbWV0aG9kcywKICAgICAqIGFuZCBoYXMgdGhlIHBy\nb3BlciBjb25zdHJ1Y3RvcnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2\nYWxpZGF0ZUFwcElkQ2xhc3NNZXRob2RzKENsYXNzIG9pZCkgewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIG9pZC5nZXRDb25zdHJ1Y3RvcigoQ2xhc3Nb\nXSkgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJudWxsLWNvbnMiLCBfdHlwZSkpLgogICAgICAgICAgICAgICAgc2V0Q2F1\nc2UoZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBmb3IgZXF1YWxz\nIGFuZCBoYXNoY29kZSBvdmVycmlkZXM7IGRvbid0IGVuZm9yY2UgaXQKICAg\nICAgICAvLyBmb3IgYWJzdHJhY3QgYXBwIGlkIGNsYXNzZXMsIHNpbmNlIHRo\nZXkgbWF5IG5vdCBuZWNlc3NhcmlseQogICAgICAgIC8vIGRlY2xhcmUgcHJp\nbWFyeSBrZXkgZmllbGRzCiAgICAgICAgTWV0aG9kIG1ldGhvZDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBtZXRob2QgPSBvaWQuZ2V0TWV0aG9kKCJl\ncXVhbHMiLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAg\nIH0KCiAgICAgICAgYm9vbGVhbiBhYnMgPSBNb2RpZmllci5pc0Fic3RyYWN0\nKF90eXBlLmdldE1vZGlmaWVycygpKTsKICAgICAgICBpZiAoIWFicyAmJiBt\nZXRob2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiZXEtbWV0aG9kIiwgX3R5cGUpKTsKCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgbWV0aG9kID0gb2lkLmdldE1ldGhvZCgiaGFzaENvZGUiLCAoQ2xh\nc3NbXSkgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSkuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmICghYWJzICYmIG1l\ndGhvZC5nZXREZWNsYXJpbmdDbGFzcygpID09IE9iamVjdC5jbGFzcykKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJoYy1tZXRob2QiLCBfdHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nVmFsaWRhdGUgdGhhdCB0aGUgcHJpbWFyeSBrZXkgY2xhc3MgaGFzIGFsbCBw\nayBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFw\ncElkQ2xhc3NQS3MoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzLCBDbGFzcyBvaWQpIHsKICAgICAgICBpZiAoZm1k\ncy5sZW5ndGggPT0gMCAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9kaWZpZXJzKCkp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLXBrIiwgX3R5cGUpKTsKCiAgICAgICAgLy8gY2hlY2sgdGhh\ndCB0aGUgb2lkIHR5cGUgY29udGFpbnMgYWxsIHBrIGZpZWxkcwogICAgICAg\nIEZpZWxkIGY7CiAgICAgICAgTWV0aG9kIG07CiAgICAgICAgQ2xhc3MgYzsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJS\nQVk6CiAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFy\nZWRUeXBlKCkuZ2V0Q29tcG9uZW50VHlwZSgpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChjID09IGJ5dGUuY2xhc3MgfHwgYyA9PSBCeXRlLmNsYXNzCiAg\nICAgICAgICAgICAgICAgICAgICAgIHx8IGMgPT0gY2hhci5jbGFzcyB8fCBj\nID09IENoYXJhY3Rlci5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAg\nICBjID0gZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuT0lEOiAvLyB3ZSdyZSB2YWxpZGF0aW5nIGVtYmVkZGVkIGZpZWxk\ncwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYmFkLXBrLXR5cGUiLAogICAgICAgICAgICAgICAg\nICAgICAgICBmbWRzW2ldKSk7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIGMgPSBmbWRzW2ldLmdldE9iamVjdElkRmll\nbGRUeXBlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBBQ0NFU1NfRklFTEQpIHsKICAgICAgICAg\nICAgICAgIGYgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWQsIGZtZHNbaV0u\nZ2V0TmFtZSgpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoZiA9PSBu\ndWxsIHx8ICFmLmdldFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGMpKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAg\nIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAgICAgICB9IGVs\nc2UgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IEFDQ0VTU19QUk9QRVJU\nWSkgewogICAgICAgICAgICAgICAgbSA9IFJlZmxlY3Rpb24uZmluZEdldHRl\ncihvaWQsIGZtZHNbaV0uZ2V0TmFtZSgpLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICBpZiAobSA9PSBudWxsIHx8ICFtLmdldFJldHVyblR5cGUoKS5pc0Fz\nc2lnbmFibGVGcm9tKGMpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1pZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ldLmdldE5hbWUo\nKSkpOwogICAgICAgICAgICAgICAgbSA9IFJlZmxlY3Rpb24uZmluZFNldHRl\ncihvaWQsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nIGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCB8fCBtLmdldFJldHVyblR5cGUo\nKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1pZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ldLmdldE5hbWUo\nKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVmFsaWRhdGUgdGhhdCB0aGlzIGNsYXNzIGRvZXNuJ3QgZGVjbGFy\nZSBhbnkgcHJpbWFyeSBrZXkgZmllbGRzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgdmFsaWRhdGVOb1BLRmllbGRzKCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtcGsiLCBmaWVsZHNbaV0pKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2VydCB0aGF0IHRoaXMgY2xhc3MnIGFjY2VzcyB0eXBlIGlzIGFsbG93\nZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFjY2Vzc1R5\ncGUoKSB7CiAgICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFDQ0VTU19VTktO\nT1dOKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlm\nIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0QWNjZXNzVHlwZSgpICE9IEFDQ0VT\nU19VTktOT1dOCiAgICAgICAgICAgICYmIHN1cC5nZXRBY2Nlc3NUeXBlKCkg\nIT0gX2FjY2Vzc1R5cGUgJiYKICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKS5nZXRGaWVsZHMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW5j\nb25zaXN0ZW50LWFjY2VzcyIsCiAgICAgICAgICAgICAgICB0aGlzLCBzdXAp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhh\ndCBkZXRhY2htZW50IGNvbmZpZ3VyYXRpb24gaXMgdmFsaWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZURldGFjaGFibGUoKSB7CiAgICAg\nICAgYm9vbGVhbiBmaXJzdCA9IHRydWU7CiAgICAgICAgZm9yIChDbGFzc01l\ndGFEYXRhIHBhcmVudCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICAgICAgICAgIGZpcnN0ICYmIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBw\nYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICB7CiAg\nICAgICAgICAgIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAg\nICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRmll\nbGQgZmllbGQgPSBnZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAgICBp\nZiAoZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWZpcnN0KQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYXJlbnQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAg\nICAgICBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZ2V0RmllbGQoZmllbGQu\nZ2V0TmFtZSgpKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYW5hZ2VkLWRldGFjaC1z\ndGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBf\ndHlwZSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZSgpICE9IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaC1zdGF0ZSIsCiAgICAg\nICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlwZSkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZldGNo\nIEdyb3VwCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgZmV0Y2ggZ3JvdXBzIGRlY2xhcmVkIGV4cGxpY2l0bHkgaW4g\ndGhpcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdl\ndERlY2xhcmVkRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9mZ3MgPT0g\nbnVsbCkKICAgICAgICAgICAgX2ZncyA9IChfZmdNYXAgPT0gbnVsbCkgPyBF\nTVBUWV9GRVRDSF9HUk9VUF9BUlJBWSA6IChGZXRjaEdyb3VwW10pCiAgICAg\nICAgICAgICAgICBfZmdNYXAudmFsdWVzKCkudG9BcnJheShuZXcgRmV0Y2hH\ncm91cFtfZmdNYXAuc2l6ZSgpXSk7IAogICAgICAgIHJldHVybiBfZmdzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmZXRjaCBncm91cHMg\nZm9yIHRoaXMgdHlwZSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZ3JvdXBzLgog\nICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldEN1c3RvbUZldGNo\nR3JvdXBzKCkgewogICAgICAgIGlmIChfY3VzdG9tRkdzID09IG51bGwpIHsK\nICAgICAgICAgICAgLy8gbWFwIGZncyB0byBuYW1lcywgYWxsb3dpbmcgb3Vy\nIGZncyB0byBvdmVycmlkZSBzdXBlcnMKICAgICAgICAgICAgTWFwIGZncyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3Vw\nID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYg\nKHN1cCAhPSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBG\nZXRjaEdyb3VwW10gc3VwRkdzID0gc3VwLmdldEN1c3RvbUZldGNoR3JvdXBz\nKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1cEZH\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBmZ3MucHV0KHN1\ncEZHc1tpXS5nZXROYW1lKCksIHN1cEZHc1tpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgRmV0Y2hHcm91cFtdIGRlY3MgPSBnZXREZWNsYXJlZEZl\ndGNoR3JvdXBzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZGVjcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZncy5wdXQoZGVj\nc1tpXS5nZXROYW1lKCksIGRlY3NbaV0pOwogICAgICAgICAgICAKICAgICAg\nICAgICAgLy8gcmVtb3ZlIHN0ZCBncm91cHMKICAgICAgICAgICAgZmdzLnJl\nbW92ZShGZXRjaEdyb3VwLk5BTUVfREVGQVVMVCk7CiAgICAgICAgICAgIGZn\ncy5yZW1vdmUoRmV0Y2hHcm91cC5OQU1FX0FMTCk7CgogICAgICAgICAgICBf\nY3VzdG9tRkdzID0gKEZldGNoR3JvdXBbXSkgZmdzLnZhbHVlcygpLnRvQXJy\nYXkKICAgICAgICAgICAgICAgIChuZXcgRmV0Y2hHcm91cFtmZ3Muc2l6ZSgp\nXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY3VzdG9tRkdzOwogICAg\nfQoKICAgIC8qKgogICAgICogR2V0cyBhIG5hbWVkIGZlY3RoIGdyb3VwLiBJ\nZiBub3QgYXZhaWxhYmxlIGluIHRoaXMgcmVjZWl2ZXIgdGhlbiBsb29rcwog\nICAgICogdXAgdGhlIGluaGVyaXRlbmNlIGhpZXJhcmNoeS4gCiAgICAgKgog\nICAgICogQHBhcmFtIG5hbWUgbmFtZSBvZiBhIGZldGNoIGdyb3VwLgogICAg\nICogQHJldHVybiBhbiBleGlzdGluZyBmZWN0aCBncm91cCBvZiB0aGUgZ2l2\nZW4gbmFtZSBpZiBrbm93biB0byB0aGlzIAogICAgICogcmVjZWl2ZXIgb3Ig\nYW55IG9mIGl0cyBzdXBlcmNsYXNzZXMuIE90aGVyd2lzZSBudWxsLgogICAg\nICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBnZXRGZXRjaEdyb3VwKFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IChfZmdNYXAgPT0g\nbnVsbCkgPyBudWxsIDogKEZldGNoR3JvdXApIF9mZ01hcC5nZXQobmFtZSk7\nCiAgICAgICAgaWYgKGZnICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBm\nZzsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gc3VwLmdldEZldGNoR3JvdXAobmFtZSk7CiAgICAgICAg\naWYgKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxULmVxdWFscyhuYW1lKSkKICAg\nICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuREVGQVVMVDsKICAgICAgICBp\nZiAoRmV0Y2hHcm91cC5OQU1FX0FMTC5lcXVhbHMobmFtZSkpCiAgICAgICAg\nICAgIHJldHVybiBGZXRjaEdyb3VwLkFMTDsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgZmV0Y2ggZ3JvdXAgb2Yg\ndGhlIGdpdmVuIG5hbWUsIG9yIHJldHVybnMgZXhpc3RpbmcgaW5zdGFuY2Uu\nCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgYSBub24tbnVsbCwgbm9uLWVt\ncHR5IG5hbWUuIE11c3QgYmUgdW5pcXVlIHdpdGhpbiB0aGlzCiAgICAgKiBy\nZWNlaXZlcidzIHNjb3BlLiBUaGUgc3VwZXIgY2xhc3MgPGVtPm1heTwvZW0+\nIGhhdmUgYSBncm91cCB3aXRoCiAgICAgKiB0aGUgc2FtZSBuYW1lLgogICAg\nICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBhZGREZWNsYXJlZEZldGNoR3Jv\ndXAoU3RyaW5nIG5hbWUpIHsKICAgIAlpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShuYW1lKSkKICAgIAkJdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlbXB0eS1mZy1uYW1lIiwgdGhpcykpOwogICAgICAgIGlmIChf\nZmdNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX2ZnTWFwID0gbmV3IEhhc2hN\nYXAoKTsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gKEZldGNoR3JvdXApIF9m\nZ01hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51bGwpIHsKICAg\nICAgICAJZmcgPSBuZXcgRmV0Y2hHcm91cCh0aGlzLCBuYW1lKTsKICAgICAg\nICAJX2ZnTWFwLnB1dChuYW1lLCBmZyk7CiAgICAgICAgICAgIF9mZ3MgPSBu\ndWxsOwogICAgICAgICAgICBfY3VzdG9tRkdzID0gbnVsbDsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZnOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIGEgZGVjbGFyZWQgZmV0Y2ggZ3JvdXAuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIHJlbW92ZURlY2xhcmVkRmV0Y2hHcm91cChGZXRjaEdyb3Vw\nIGZnKSB7CiAgICAgICAgaWYgKGZnID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBpZiAoX2ZnTWFwLnJlbW92ZShmZy5nZXRO\nYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgX2ZncyA9IG51bGw7CiAg\nICAgICAgICAgIF9jdXN0b21GR3MgPSBudWxsOwogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTb3VyY2VUcmFja2Vy\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBGaWxlIGdldFNv\ndXJjZUZpbGUoKSB7CiAgICAgICAgcmV0dXJuIF9zcmNGaWxlOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRTb3VyY2VU\neXBlKCkgewogICAgICAgIHJldHVybiBfc3JjVHlwZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRTb3VyY2UoRmlsZSBmaWxlLCBpbnQgc3JjVHlwZSkg\newogICAgICAgIF9zcmNGaWxlID0gZmlsZTsKICAgICAgICBfc3JjVHlwZSA9\nIHNyY1R5cGU7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRSZXNvdXJj\nZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFk\nYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRTb3VyY2VNb2RlKCkgewogICAgICAgIHJldHVybiBfc3JjTW9k\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlz\nIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkgewogICAgICAg\nIF9zcmNNb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBz\nb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRl\nci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQg\nbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVf\nTk9ORSkKICAgICAgICAgICAgX3NyY01vZGUgPSBtb2RlOwogICAgICAgIGVs\nc2UgaWYgKG9uKQogICAgICAgICAgICBfc3JjTW9kZSB8PSBtb2RlOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgX3NyY01vZGUgJj0gfm1vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhpcyBjbGFz\ncyB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAg\nICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlz\ndGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBn\nZXRMaXN0aW5nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9saXN0SW5kZXg7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhp\ncyBmaWVsZCB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMg\ndG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBu\nb3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0TGlzdGluZ0luZGV4KGludCBpbmRleCkgewogICAgICAgIF9s\naXN0SW5kZXggPSBpbmRleDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIENvbW1lbnRhYmxlCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0Q29tbWVudHMoKSB7CiAgICAgICAgcmV0dXJu\nIChfY29tbWVudHMgPT0gbnVsbCkgPyBFTVBUWV9DT01NRU5UUyA6IF9jb21t\nZW50czsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb21tZW50cyhTdHJp\nbmdbXSBjb21tZW50cykgewogICAgICAgIF9jb21tZW50cyA9IGNvbW1lbnRz\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBjb3B5\nCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29weSB0aGUg\nbWV0YWRhdGEgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhpcyBvbmUu\nIERvIG5vdAogICAgICogY29weSBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBfdHlw\nZSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7\nCiAgICAgICAgc3VwZXIuY29weShtZXRhKTsKCiAgICAgICAgLy8gY29weSBj\nbGFzcy1sZXZlbCBpbmZvOyB1c2UgZ2V0IG1ldGhvZHMgdG8gZm9yY2UgcmVz\nb2x1dGlvbiBvZgogICAgICAgIC8vIGxhenkgZGF0YQogICAgICAgIF9zdXBl\nciA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzKCk7CiAgICAgICAgX29iamVjdElk\nID0gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBfZXh0ZW50ID0g\nKG1ldGEuZ2V0UmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFOwogICAgICAgIF9lbWJlZGRlZCA9IChtZXRhLmlzRW1i\nZWRkZWRPbmx5KCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsK\nICAgICAgICBfaW50ZXJmYWNlID0gKG1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNl\nKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBf\naW1wbCA9IG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIF9pZGVu\ndGl0eSA9IG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgX2lkU3Ry\nYXRlZ3kgPSBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBf\nc2VxTmFtZSA9IG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAg\nICAgICBfc2VxTWV0YSA9IG51bGw7CiAgICAgICAgX2FsaWFzID0gbWV0YS5n\nZXRUeXBlQWxpYXMoKTsKICAgICAgICBfYWNjZXNzVHlwZSA9IG1ldGEuZ2V0\nQWNjZXNzVHlwZSgpOwoKICAgICAgICAvLyBvbmx5IGNvcHkgdGhpcyBpbmZv\ncm1hdGlvbiBpZiBpdCB3YXNuJ3Qgc2V0IGV4cGxpY2l0bHkgZm9yIHRoaXMK\nICAgICAgICAvLyBpbnN0YW5jZQogICAgICAgIGlmIChERUZBVUxUX1NUUklO\nRy5lcXVhbHMoX2NhY2hlTmFtZSkpCiAgICAgICAgICAgIF9jYWNoZU5hbWUg\nPSBtZXRhLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoX2NhY2hl\nVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkKICAgICAgICAgICAgX2Nh\nY2hlVGltZW91dCA9IG1ldGEuZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAg\nICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxsKQogICAgICAgICAgICBfZGV0\nYWNoYWJsZSA9IG1ldGEuX2RldGFjaGFibGU7CiAgICAgICAgaWYgKERFRkFV\nTFRfU1RSSU5HLmVxdWFscyhfZGV0YWNoU3RhdGUpKQogICAgICAgICAgICBf\nZGV0YWNoU3RhdGUgPSBtZXRhLmdldERldGFjaGVkU3RhdGUoKTsKCiAgICAg\nICAgLy8gc3luY2ggZmllbGQgaW5mb3JtYXRpb247IGZpcnN0IHJlbW92ZSBl\neHRyYSBmaWVsZHMKICAgICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAg\nICBfZmllbGRNYXAua2V5U2V0KCkucmV0YWluQWxsKG1ldGEuX2ZpZWxkTWFw\nLmtleVNldCgpKTsKCiAgICAgICAgLy8gYWRkIGNvcGllcyBvZiBkZWNsYXJl\nZCBmaWVsZHM7IG90aGVyIGRlZmluZWQgZmllbGRzIGFscmVhZHkgY29waWVk\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0RGVj\nbGFyZWRGaWVsZHMoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGZpZWxkID0gZ2V0RGVjbGFyZWRGaWVsZChmaWVs\nZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKGZpZWxkID09IG51\nbGwpCiAgICAgICAgICAgICAgICBmaWVsZCA9IGFkZERlY2xhcmVkRmllbGQo\nZmllbGRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmaWVs\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBmaWVsZC5z\nZXREZWNsYXJlZEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQuc2V0SW5k\nZXgoLTEpOwogICAgICAgICAgICBmaWVsZC5jb3B5KGZpZWxkc1tpXSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBjb3B5IGZldGNoIGdyb3VwcwogICAgICAg\nIEZldGNoR3JvdXBbXSBmZ3MgPSBtZXRhLmdldERlY2xhcmVkRmV0Y2hHcm91\ncHMoKTsKICAgICAgICBGZXRjaEdyb3VwIGZnOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZn\nID0gYWRkRGVjbGFyZWRGZXRjaEdyb3VwKGZnc1tpXS5nZXROYW1lKCkpOwog\nICAgICAgICAgICBmZy5jb3B5KGZnc1tpXSk7IAogICAgICAgIH0KCiAgICAg\nICAgLy8gY29weSBpZmFjZSByZS1tYXBwaW5nCiAgICAgICAgX2lmYWNlTWFw\nLmNsZWFyKCk7CiAgICAgICAgX2lmYWNlTWFwLnB1dEFsbChtZXRhLl9pZmFj\nZU1hcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVy\nIHRvIGNvcHkgZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIHZvaWQgY29weShDbGFzc01ldGFEYXRhIGVtYmVkLCBDbGFz\nc01ldGFEYXRhIGRlYykgewogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0g\nZGVjLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1\ncCAhPSBudWxsKSB7CiAgICAgICAgICAgIGVtYmVkLnNldFBDU3VwZXJjbGFz\ncyhzdXAuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29weShl\nbWJlZC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLCBzdXApOwogICAgICAg\nIH0KICAgICAgICBlbWJlZC5jb3B5KGRlYyk7CiAgICB9CgogICAgcHJvdGVj\ndGVkIHZvaWQgYWRkRXh0ZW5zaW9uS2V5cyhDb2xsZWN0aW9uIGV4dHMpIHsK\nICAgICAgICBfcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCkuYWRkQ2xhc3NF\neHRlbnNpb25LZXlzKGV4dHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ29t\ncGFyYXRvciB1c2VkIHRvIHB1dCBmaWVsZCBtZXRhZGF0YXMgaW50byBsaXN0\naW5nIG9yZGVyLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBM\naXN0aW5nT3JkZXJDb21wYXJhdG9yCiAgICAgICAgaW1wbGVtZW50cyBDb21w\nYXJhdG9yIHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTGlzdGlu\nZ09yZGVyQ29tcGFyYXRvciBfaW5zdGFuY2UKICAgICAgICAgICAgPSBuZXcg\nTGlzdGluZ09yZGVyQ29tcGFyYXRvcigpOwoKICAgICAgICAvKioKICAgICAg\nICAgKiBBY2Nlc3Mgc2luZ2xldG9uIGluc3RhbmNlLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdGluZ09yZGVyQ29tcGFyYXRvciBn\nZXRJbnN0YW5jZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmplY3Qg\nbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBpZiAobzEgPT0gbzIpCiAg\nICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKG8xID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAg\naWYgKG8yID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7Cgog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGYxID0gKEZpZWxkTWV0YURhdGEp\nIG8xOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGYyID0gKEZpZWxkTWV0\nYURhdGEpIG8yOwogICAgICAgICAgICBpZiAoZjEuZ2V0TGlzdGluZ0luZGV4\nKCkgPT0gZjIuZ2V0TGlzdGluZ0luZGV4KCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChmMS5nZXRJbmRleCgpID09IGYyLmdldEluZGV4KCkpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGYxLmdldEZ1bGxOYW1lKGZhbHNlKS5jb21w\nYXJlVG8KICAgICAgICAgICAgICAgICAgICAgICAgKGYyLmdldEZ1bGxOYW1l\nKGZhbHNlKSk7CgkJCQlpZiAoZjEuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJ\ncmV0dXJuIDE7CgkJCQlpZiAoZjIuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJ\ncmV0dXJuIC0xOwoJCQkJcmV0dXJuIGYxLmdldEluZGV4ICgpIC0gZjIuZ2V0\nSW5kZXggKCk7CgkJCX0JCgkJCWlmIChmMS5nZXRMaXN0aW5nSW5kZXggKCkg\nPT0gLTEpCgkJCQlyZXR1cm4gMTsKCQkJaWYgKGYyLmdldExpc3RpbmdJbmRl\neCAoKSA9PSAtMSkKCQkJCXJldHVybiAtMTsKCQkJcmV0dXJuIGYxLmdldExp\nc3RpbmdJbmRleCAoKSAtIGYyLmdldExpc3RpbmdJbmRleCAoKTsKCQl9Cgl9\nCn0K\n","encoding":"base64"}

