{"sha":"b0314014da74381016d3fc66f4a80e804f8cd113","node_id":"MDQ6QmxvYjIwNjM2NDpiMDMxNDAxNGRhNzQzODEwMTZkM2ZjNjZmNGE4MGU4MDRmOGNkMTEz","size":23462,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b0314014da74381016d3fc66f4a80e804f8cd113","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1vZGlmaWVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9y\ndCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmls\nZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5PYmplY3RJZFN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuU3RhdGVNYW5hZ2VySW1wbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVn\naWVzOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogVXRpbGl0\neSBjbGFzcyBmb3IgbWFuaXB1bGF0aW5nIGFwcGxpY2F0aW9uIG9iamVjdCBp\nZHMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBBcHBsaWNhdGlvbklkcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBcHBsaWNhdGlvbklkcy5jbGFzcyk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYzIgPSBMb2NhbGl6ZXIu\nZm9yUGFja2FnZQogICAgICAgIChTdGF0ZU1hbmFnZXJJbXBsLmNsYXNzKTsK\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJpbWFyeSBrZXkgdmFsdWVz\nIGZvciB0aGUgZ2l2ZW4gb2JqZWN0IGlkLiBUaGUgdmFsdWVzCiAgICAgKiB3\naWxsIGJlIHJldHVybmVkIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSBtZXRh\nZGF0YSBwcmltYXJ5IGtleSBmaWVsZHMuCiAgICAgKiBWYWx1ZXMgZm9yIFBD\nIHByaW1hcnkga2V5IGZpZWxkcyB3aWxsIGJlIHRoZSBwcmltYXJreSBrZXkg\ndmFsdWUgb3IKICAgICAqIG9pZCB2YWx1ZSBvZiB0aGUgcmVsYXRlZCBpbnN0\nYW5jZSAoZGVwZW5kaW5nIG9uIAogICAgICoge0BsaW5rIEZpZWxkTWV0YURh\ndGEjaXNPYmplY3RJZEZpZWxkSWRPZlBDfSkuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgT2JqZWN0W10gdG9QS1ZhbHVlcyhPYmplY3Qgb2lkLCBDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgT2JqZWN0W10gcGtz\nOwogICAgICAgIGlmIChtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAg\nICAgICAgICAgcGtzID0gbmV3IE9iamVjdFsxXTsKICAgICAgICAgICAgaWYg\nKG9pZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcGtzWzBdID0gKChPcGVu\nSlBBSWQpIG9pZCkuZ2V0SWRPYmplY3QoKTsKICAgICAgICAgICAgcmV0dXJu\nIHBrczsKICAgICAgICB9CgogICAgICAgIC8vIHJlc2V0IG93bmluZyAnbWV0\nYScgdG8gdGhlIG93bmVyIG9mIHRoZSBwcmltYXJ5IGtleSBmaWVsZHMsIGJl\nY2F1c2UKICAgICAgICAvLyB0aGUgb25lIHBhc3NlZCBpbiBtaWdodCBiZSBh\nIHByb3h5LCBsaWtlIGZvciBlbWJlZGRlZCBtYXBwaW5nczsKICAgICAgICAv\nLyBzaW5jZSBnZXRQcmltYXJ5S2V5RmllbGRzIGlzIGd1YXJhbnRlZWQgdG8g\ncmV0dXJuIHRoZSBwcmltYXJ5CiAgICAgICAgLy8ga2V5cyBpbiB0aGUgb3Jk\nZXIgb2YgaW5oZXJpdGFuY2UsIHdlIGFyZSBndWFyYW50ZWVkIHRoYXQKICAg\nICAgICAvLyB0aGUgbGFzdCBlbGVtZW50IHdpbGwgYmUgdGhlIG1vc3QtZGVy\naXZlZCBjbGFzcy4KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1l\ndGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIG1ldGEgPSBmbWRz\nW2ZtZHMubGVuZ3RoIC0gMV0uZ2V0RGVjbGFyaW5nTWV0YURhdGEoKTsKICAg\nICAgICBwa3MgPSBuZXcgT2JqZWN0W2ZtZHMubGVuZ3RoXTsKICAgICAgICBp\nZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBwa3M7CgogICAg\nICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpIHsKICAgICAgICAgICAgLy8gY29w\neSBmaWVsZHMgZnJvbSB0aGUgb2lkCiAgICAgICAgICAgIFByaW1hcnlLZXlG\naWVsZE1hbmFnZXIgY29uc3VtZXIgPSBuZXcgUHJpbWFyeUtleUZpZWxkTWFu\nYWdlcigpOwogICAgICAgICAgICBjb25zdW1lci5zZXRTdG9yZShwa3MpOwog\nICAgICAgICAgICBQQ1JlZ2lzdHJ5LmNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0\nSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICBj\nb25zdW1lciwgb2lkKTsKICAgICAgICAgICAgcmV0dXJuIGNvbnN1bWVyLmdl\ndFN0b3JlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0IHRvIHJl\nZmxlY3Rpb24KICAgICAgICBpZiAobWV0YS5pc09iamVjdElkVHlwZVNoYXJl\nZCgpKQogICAgICAgICAgICBvaWQgPSAoKE9iamVjdElkKSBvaWQpLmdldElk\nKCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFzcygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgICAgICBwa3Nb\naV0gPSBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKG9pZFR5cGUsIAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFt\nZSgpLCB0cnVlKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIHBrc1tpXSA9IFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVmbGVjdGlvbi5maW5k\nR2V0dGVyKG9pZFR5cGUsCiAgICAgICAgICAgICAgICAgICAgZm1kc1tpXS5n\nZXROYW1lKCksIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBr\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBvYmplY3Qg\naWQgY29uc3RydWN0ZWQgZnJvbSB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgdmFs\ndWVzLgogICAgICogVmFsdWVzIGZvciBQQyBwcmltYXJ5IGtleSBmaWVsZHMg\nc2hvdWxkIGJlIHRoZSBwcmltYXJreSBrZXkgdmFsdWUgb3IKICAgICAqIG9p\nZCB2YWx1ZSBvZiB0aGUgcmVsYXRlZCBpbnN0YW5jZSAoZGVwZW5kaW5nIG9u\nIAogICAgICoge0BsaW5rIEZpZWxkTWV0YURhdGEjaXNPYmplY3RJZEZpZWxk\nSWRPZlBDfSkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGZy\nb21QS1ZhbHVlcyhPYmplY3RbXSBwa3MsIENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhID09IG51bGwgfHwgcGtzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGNvbnZl\ncnQgPSAhbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigp\nLgogICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRT\ndHJpY3RJZGVudGl0eVZhbHVlcygpOwogICAgICAgIGlmIChtZXRhLmlzT3Bl\nbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaW50IHR5cGUgPSBtZXRh\nLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXS5nZXRPYmplY3RJZEZpZWxkVHlw\nZUNvZGUoKTsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IChjb252ZXJ0KSA/\nIEphdmFUeXBlcy5jb252ZXJ0KHBrc1swXSwgdHlwZSkgOiBwa3NbMF07CiAg\nICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVy\ndCAmJiAhKHZhbCBpbnN0YW5jZW9mIEJ5dGUpKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5z\ndGFuY2VvZiBCeXRlKSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgQnl0ZUlkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFs\nKS5ieXRlVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9P\nQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFySWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1\nZSgpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgRG91YmxlKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgRG91Ymxl\nKSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlSWQo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgRmxvYXQpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBGbG9hdCki\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAg\nICAgICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIElu\ndGVnZXIpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xh\nc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBJbnRlZ2VyKSIpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW50SWQobWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9\nPSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmludFZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAg\nICAgIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIExvbmcpKQog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhj\nZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBMb25nKSIpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgTG9uZ0lkKG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAg\nOiAoKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBpZiAo\nIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBTaG9ydCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24o\nIiEoeCBpbnN0YW5jZW9mIFNob3J0KSIpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgU2hvcnRJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChO\ndW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IFN0cmluZ0lkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCAoU3Ry\naW5nKSB2YWwpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFU\nRToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGVJZChtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwgKERhdGUpIHZhbCk7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBPYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgdmFsKTsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgQmlnRGVjaW1hbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIEJp\nZ0RlY2ltYWwpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBC\naWdEZWNpbWFsSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIChCaWdEZWNp\nbWFsKXZhbCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJ\nTlRFR0VSOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAh\nKHZhbCBpbnN0YW5jZW9mIEJpZ0ludGVnZXIpKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5z\ndGFuY2VvZiBCaWdJbnRlZ2VyKSIpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgQmlnSW50ZWdlcklkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nLCAoQmlnSW50ZWdlcil2YWwpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY29w\neSBwa3MgdG8gb2lkCiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3RyYWN0\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlmaWVycygpKSkgewog\nICAgICAgICAgICBPYmplY3Qgb2lkID0gUENSZWdpc3RyeS5uZXdPYmplY3RJ\nZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIFByaW1h\ncnlLZXlGaWVsZE1hbmFnZXIgcHJvZHVjZXIgPSBuZXcgUHJpbWFyeUtleUZp\nZWxkTWFuYWdlcigpOwogICAgICAgICAgICBwcm9kdWNlci5zZXRTdG9yZShw\na3MpOwogICAgICAgICAgICBpZiAoY29udmVydCkKICAgICAgICAgICAgICAg\nIHByb2R1Y2VyLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICBQQ1Jl\nZ2lzdHJ5LmNvcHlLZXlGaWVsZHNUb09iamVjdElkKG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcHJvZHVjZXIsIG9pZCk7CiAg\nICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBk\nZWZhdWx0IHRvIHJlZmxlY3Rpb24KICAgICAgICBDbGFzcyBvaWRUeXBlID0g\nbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBpZiAoTW9kaWZpZXIu\naXNBYnN0cmFjdChvaWRUeXBlLmdldE1vZGlmaWVycygpKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm9iamVjdGlk\nLWFic3RyYWN0IiwgbWV0YSkpOwogICAgICAgIE9iamVjdCBjb3B5ID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb3B5ID0gQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihvaWRUeXBlKSk7CiAgICAgICAg\nfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgaWYgKHQgaW5z\ndGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAg\nICAgICAgdCA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgdCkuZ2V0\nRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKHQpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBP\nYmplY3QgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSAoY29udmVydCkgPyBK\nYXZhVHlwZXMuY29udmVydChwa3NbaV0sCiAgICAgICAgICAgICAgICBmbWRz\nW2ldLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpKSA6IHBrc1tpXTsKICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0\nYURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAgICAgUmVmbGVjdGlv\nbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHRydWUpLCB2\nYWwpOyAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUmVmbGVj\ndGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5cGUs\nIAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCBmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZSgpLCB0cnVlKSwgdmFsKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAg\nICAgICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmli\nZWRUeXBlKCksIGNvcHkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoK\nICAgIC8qKgogICAgICogQ29weSB0aGUgZ2l2ZW4gb2lkIHZhbHVlLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjb3B5KE9iamVjdCBvaWQs\nIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwgfHwgb2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAg\nICAgICAgIC8vIHVzZSBtZXRhIHR5cGUgaW5zdGVhZCBvZiBvaWQgdHlwZSBp\nbiBjYXNlIGl0J3MgYSBzdWJjbGFzcwogICAgICAgICAgICBDbGFzcyBjbHMg\nPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgT3BlbkpQ\nQUlkIGtvaWQgPSAoT3BlbkpQQUlkKSBvaWQ7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgcGsgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXTsK\nICAgICAgICAgICAgc3dpdGNoIChway5nZXRPYmplY3RJZEZpZWxkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZUlkKGNscywgKChCeXRl\nSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29p\nZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklk\nKGNscywgKChDaGFySWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IERvdWJsZUlkKGNscywgKChEb3VibGVJZCkgb2lkKS5nZXRJ\nZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNz\nZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQoY2xzLCAoKEZs\nb2F0SWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\na29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludElk\nKGNscywgKChJbnRJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAgICAg\nICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBMb25nSWQoY2xzLCAoKExvbmdJZCkgb2lkKS5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IFNob3J0SWQoY2xzLCAoKFNob3J0SWQpIG9p\nZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNT\ndWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nSWQoY2xzLCBvaWQudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0IGlubmVyID0ga29pZC5nZXRJZE9iamVj\ndCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBpbm5lciA9IGNvcHkoaW5uZXIsIGVt\nYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSk7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIGlubmVyLCBrb2lkLmhhc1N1YmNs\nYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpF\nQ1Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChj\nbHMsIGtvaWQuZ2V0SWRPYmplY3QoKSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBEYXRlSWQoY2xzLCAoKERhdGVJZCkgb2lkKS5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmlnRGVjaW1hbElkKGNscywg\nKChCaWdEZWNpbWFsSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IEJpZ0ludGVnZXJJZChjbHMsICgoQmlnSW50ZWdl\ncklkKSBvaWQpLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGtv\naWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNy\nZWF0ZSBhIG5ldyBwYyBpbnN0YW5jZSBvZiB0aGUgcmlnaHQgdHlwZSwgc2V0\nIGl0cyBrZXkgZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIG9yaWdpbmFsIG9p\nZCB2YWx1ZXMsIHRoZW4gY29weSBpdHMga2V5IGZpZWxkcyB0byBhIG5ldwog\nICAgICAgIC8vIG9pZCBpbnN0YW5jZQogICAgICAgIGlmICghTW9kaWZpZXIu\naXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmll\ncnMoKSkKICAgICAgICAgICAgJiYgIWhhc1BDUHJpbWFyeUtleUZpZWxkcyht\nZXRhKSkgewogICAgICAgICAgICBDbGFzcyB0eXBlID0gbWV0YS5nZXRJbnRl\ncmZhY2VJbXBsKCk7CiAgICAgICAgICAgIGlmICh0eXBlID09IG51bGwpCiAg\nICAgICAgICAgICAgICB0eXBlID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7\nCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IFBDUmVnaXN0\ncnkubmV3SW5zdGFuY2UodHlwZSwgbnVsbCwgb2lkLCAKICAgICAgICAgICAg\nICAgICBmYWxzZSk7CiAgICAgICAgICAgIE9iamVjdCBjb3B5ID0gcGMucGNO\nZXdPYmplY3RJZEluc3RhbmNlKCk7CiAgICAgICAgICAgIHBjLnBjQ29weUtl\neUZpZWxkc1RvT2JqZWN0SWQoY29weSk7CiAgICAgICAgICAgIHJldHVybiBj\nb3B5OwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGNvcHkgPSAoIW1ldGEu\naXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgPyBvaWQKICAgICAgICAgICAgOiAo\nKE9iamVjdElkKSBvaWQpLmdldElkKCk7CiAgICAgICAgY29weSA9IGNvcHko\nY29weSwgbWV0YSwgbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCkpOwogICAg\nICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAg\nICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIGNvcHksCiAgICAgICAgICAgICAgICAoKE9wZW5KUEFJZCkgb2lkKS5o\nYXNTdWJjbGFzc2VzKCkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgYW55IG9mIHRoZSBnaXZl\nbiB0eXBlJ3MgcHJpbWFyeSBrZXkgZmllbGRzIGFyZSAKICAgICAqIHBlcnNp\nc3RlbnQgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiBoYXNQQ1ByaW1hcnlLZXlGaWVsZHMoQ2xhc3NNZXRhRGF0YSBtZXRh\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldFBy\naW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb3B5IHRoZSBnaXZlbiBpZGVudGl0eSBv\nYmplY3QgdXNpbmcgcmVmbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0IGNvcHkoT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBt\nZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzKSB7CiAgICAgICAg\naWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFzcygpOwogICAgICAg\nIE9iamVjdCBjb3B5ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBjb3B5ID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihv\naWRUeXBlKSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAg\nICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgdCA9ICgoUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbikgdCkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAgICAgIH0KCiAgICAg\nICAgRmllbGQgZmllbGQ7CiAgICAgICAgT2JqZWN0IHZhbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0\nYURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9\nPSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAg\nICAgICAgIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwg\nZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgIFJlZmxlY3Rpb24uc2V0KGNvcHks\nIGZpZWxkLCBSZWZsZWN0aW9uLmdldChvaWQsIGZpZWxkKSk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgeyAvLyBwcm9wZXJ0eQogICAgICAgICAgICAgICAg\nICAgIHZhbCA9IFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVmbGVjdGlvbi5maW5k\nR2V0dGVyKG9pZFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZHNb\naV0uZ2V0TmFtZSgpLCB0cnVlKSk7CiAgICAgICAgICAgICAgICAgICAgUmVm\nbGVjdGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5\ncGUsIGZtZHNbaV0uCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE5hbWUo\nKSwgZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpLCB0cnVlKSwgdmFs\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZ2l2ZW4gcHJpbWFyeSBrZXkgZmllbGQgdmFsdWUgZnJvbSB0aGUgZ2l2\nZW4gb2lkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZXQo\nT2JqZWN0IG9pZCwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAo\nb2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgIHJl\ndHVybiAoKE9wZW5KUEFJZCkgb2lkKS5nZXRJZE9iamVjdCgpOwoKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSBmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0\nYSgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBvaWQuZ2V0Q2xhc3MoKTsK\nICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgIHJldHVybiBSZWZsZWN0\naW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIAog\nICAgICAgICAgICAgICAgZm1kLmdldE5hbWUoKSwgdHJ1ZSkpOwogICAgICAg\nIHJldHVybiBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEdl\ndHRlcihvaWRUeXBlLCBmbWQuZ2V0TmFtZSgpLAogICAgICAgICAgICB0cnVl\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbiBhcHBsaWNh\ndGlvbiBpZCBiYXNlZCBvbiB0aGUgY3VycmVudCBwcmltYXJ5IGtleSBmaWVs\nZCBzdGF0ZQogICAgICogb2YgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjcmVhdGUoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAo\ncGMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIE9iamVjdCBvaWQgPSBwYy5wY05ld09iamVjdElkSW5zdGFuY2UoKTsKICAg\nICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBpZiAoIW1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewog\nICAgICAgICAgICBwYy5wY0NvcHlLZXlGaWVsZHNUb09iamVjdElkKG9pZCk7\nCiAgICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoKICAgICAgICBG\naWVsZE1ldGFEYXRhIHBrID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClb\nMF07CiAgICAgICAgaWYgKHBrLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBK\nYXZhVHlwZXMuT0lEKQogICAgICAgICAgICByZXR1cm4gb2lkOwoKICAgICAg\nICAvLyBhbHdheXMgY29weSBvaWQgb2JqZWN0IGluIGNhc2UgZmllbGQgdmFs\ndWUgbXV0YXRlcyBvciBiZWNvbWVzCiAgICAgICAgLy8gbWFuYWdlZAogICAg\nICAgIE9iamVjdElkIG9iamlkID0gKE9iamVjdElkKSBvaWQ7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrLmdldEVtYmVkZGVkTWV0YURhdGEo\nKTsKICAgICAgICBvYmppZC5zZXRJZChjb3B5KG9iamlkLmdldElkKCksIGVt\nYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSkpOwogICAgICAgIHJldHVybiBvYmpp\nZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiBhbiBhcHBsaWNhdGlv\nbiBpZGVudGl0eSBvYmplY3QgdG8gdGhlIGdpdmVuIHN0YXRlLCBvciByZXR1\ncm4KICAgICAqIGZhbHNlIGlmIGRldGVybWluaW5nIHRoZSBhcHBsaWNhdGlv\nbiBpZGVudGl0eSByZXF1aXJlcyBhIGZsdXNoLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGJvb2xlYW4gYXNzaWduKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIFN0b3JlTWFuYWdlciBzdG9yZSwKICAgICAgICBib29sZWFuIHByZUZs\ndXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSAh\nPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAgICAgYm9vbGVh\nbiByZXQ7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IG1ldGEuZ2V0\nUHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGlmIChtZXRhLmlzT3BlbkpQ\nQUlkZW50aXR5KCkKICAgICAgICAgICAgJiYgcGtzWzBdLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKSB7CiAgICAgICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBuZXcgT2JqZWN0SWRTdGF0ZU1h\nbmFnZXIKICAgICAgICAgICAgICAgIChzbS5mZXRjaE9iamVjdEZpZWxkKHBr\nc1swXS5nZXRJbmRleCgpKSwgc20sIHBrc1swXSk7CiAgICAgICAgICAgIHJl\ndCA9IGFzc2lnbihvaWRzbSwgc3RvcmUsIHBrc1swXS5nZXRFbWJlZGRlZE1l\ndGFEYXRhKCkuCiAgICAgICAgICAgICAgICBnZXRGaWVsZHMoKSwgcHJlRmx1\nc2gpOwogICAgICAgICAgICBzbS5zdG9yZU9iamVjdEZpZWxkKHBrc1swXS5n\nZXRJbmRleCgpLAogICAgICAgICAgICAgICAgb2lkc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICByZXQgPSBh\nc3NpZ24oc20sIHN0b3JlLCBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKSwg\ncHJlRmx1c2gpOwogICAgICAgIGlmICghcmV0KQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgIC8vIGJhc2Ugb2lkIG9uIGZpZWxkIHZhbHVl\ncwogICAgICAgIHNtLnNldE9iamVjdElkKGNyZWF0ZShzbS5nZXRQZXJzaXN0\nZW5jZUNhcGFibGUoKSwgbWV0YSkpOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogQXNzaWduIGdlbmVyYXRlZCB2YWx1ZXMg\ndG8gZ2l2ZW4gcHJpbWFyeSBrZXkgZmllbGRzLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBib29sZWFuIGFzc2lnbihPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBTdG9yZU1hbmFnZXIgc3RvcmUsCiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIHBrcywgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgcGtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAvLyBJ\nZiB3ZSBhcmUgZ2VuZXJhdGluZyB2YWx1ZXMuLi4KICAgICAgICAgICAgaWYg\nKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgIT0gVmFsdWVTdHJhdGVnaWVz\nLk5PTkUpIHsKICAgICAgICAgICAgICAgIC8vIElmIGEgdmFsdWUgYWxyZWFk\neSBleGlzdHMgb24gdGhpcyBmaWVsZCwgdGhyb3cgZXhjZXB0aW9uLgogICAg\nICAgICAgICAgICAgLy8gVGhpcyBpcyBjb25zaWRlcmVkIGFuIGFwcGxpY2F0\naW9uIGNvZGluZyBlcnJvci4KICAgICAgICAgICAgICAgIGlmICghc20uaXNE\nZWZhdWx0VmFsdWUocGtzW2ldLmdldEluZGV4KCkpKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYzIu\nZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4aXN0aW5nLXZh\nbHVlLW92ZXJyaWRlLWV4Y2VwIiwgcGtzW2ldCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5nZXRGdWxsTmFtZShmYWxzZSkpKTsKICAg\nICAgICAgICAgICAgIC8vIEFzc2lnbiB0aGUgZ2VuZXJhdGVkIHZhbHVlCiAg\nICAgICAgICAgICAgICBpZiAoc3RvcmUuYXNzaWduRmllbGQoc20sIHBrc1tp\nXS5nZXRJbmRleCgpLCBwcmVGbHVzaCkpCiAgICAgICAgICAgICAgICAgICAg\ncGtzW2ldLnNldFZhbHVlR2VuZXJhdGVkKHRydWUpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIGNsYXNzIHVzZWQgdG8gdHJhbnNmZXIgcGsgdmFs\ndWVzIHRvL2Zyb20gYXBwbGljYXRpb24gb2lkcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgUHJpbWFyeUtleUZpZWxkTWFuYWdlcgogICAg\nICAgIGltcGxlbWVudHMgRmllbGRNYW5hZ2VyIHsKCiAgICAgICAgcHJpdmF0\nZSBPYmplY3RbXSBfc3RvcmUgPSBudWxsOwogICAgICAgIHByaXZhdGUgaW50\nIF9pbmRleCA9IDA7CiAgICAgICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9t\nZXRhID0gbnVsbDsKCiAgICAgICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGEo\nQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgICAgIF9tZXRhID0gbWV0\nYTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3RbXSBnZXRTdG9y\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHNldFN0b3JlKE9iamVjdFtdIHN0b3JlKSB7\nCiAgICAgICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgc3RvcmVCb29sZWFuRmllbGQoaW50IGZpZWxkLCBi\nb29sZWFuIHZhbCkgewogICAgICAgICAgICBzdG9yZSgodmFsKSA/IEJvb2xl\nYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgc3RvcmVCeXRlRmllbGQoaW50IGZpZWxkLCBieXRlIHZh\nbCkgewogICAgICAgICAgICBzdG9yZShuZXcgQnl0ZSh2YWwpKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGludCBm\naWVsZCwgY2hhciB2YWwpIHsKICAgICAgICAgICAgc3RvcmUobmV3IENoYXJh\nY3Rlcih2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNob3J0IHZhbCkgewogICAgICAg\nICAgICBzdG9yZShuZXcgU2hvcnQodmFsKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IHZh\nbCkgewogICAgICAgICAgICBzdG9yZShOdW1iZXJzLnZhbHVlT2YodmFsKSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUxvbmdGaWVs\nZChpbnQgZmllbGQsIGxvbmcgdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKE51\nbWJlcnMudmFsdWVPZih2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IHZhbCkg\newogICAgICAgICAgICBzdG9yZShuZXcgRmxvYXQodmFsKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxkKGludCBm\naWVsZCwgZG91YmxlIHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgRG91\nYmxlKHZhbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3Rv\ncmVTdHJpbmdGaWVsZChpbnQgZmllbGQsIFN0cmluZyB2YWwpIHsKICAgICAg\nICAgICAgc3RvcmUodmFsKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsKSB7\nCiAgICAgICAgICAgIHN0b3JlKHZhbCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW5GaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICAgICAgcmV0dXJuIChyZXRyaWV2ZShmaWVsZCkgPT0gQm9vbGVh\nbi5UUlVFKSA/IHRydWUgOiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBjaGFyIGZldGNoQ2hhckZpZWxkKGludCBmaWVsZCkgewogICAgICAg\nICAgICByZXR1cm4gKChDaGFyYWN0ZXIpIHJldHJpZXZlKGZpZWxkKSkuY2hh\nclZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYnl0ZSBmZXRj\naEJ5dGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgo\nTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmJ5dGVWYWx1ZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHNob3J0IGZldGNoU2hvcnRGaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2\nZShmaWVsZCkpLnNob3J0VmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAg\nICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmludFZhbHVl\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgbG9uZyBmZXRjaExvbmdG\naWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVy\nKSByZXRyaWV2ZShmaWVsZCkpLmxvbmdWYWx1ZSgpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXRGaWVsZChpbnQgZmllbGQp\nIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVs\nZCkpLmZsb2F0VmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBk\nb3VibGUgZmV0Y2hEb3VibGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAg\nICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmRvdWJsZVZh\nbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGZldGNo\nU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiAo\nU3RyaW5nKSByZXRyaWV2ZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0RmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgICAgIHJldHVybiByZXRyaWV2ZShmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBwcml2YXRlIHZvaWQgc3RvcmUoT2JqZWN0IHZhbCkgewogICAg\nICAgICAgICBfc3RvcmVbX2luZGV4KytdID0gdmFsOwogICAgICAgIH0KCiAg\nICAgICAgcHJpdmF0ZSBPYmplY3QgcmV0cmlldmUoaW50IGZpZWxkKSB7CiAg\nICAgICAgICAgIE9iamVjdCB2YWwgPSBfc3RvcmVbX2luZGV4KytdOwogICAg\nICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSAh\nPSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gSmF2\nYVR5cGVzLmNvbnZlcnQodmFsLCBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB2\nYWwgPSBKYXZhVHlwZXMuY29udmVydCh2YWwsIEphdmFUeXBlcy5nZXRUeXBl\nQ29kZShmbWQuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE9iamVjdElk\nRmllbGRUeXBlKCkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gdmFsOwoJCX0KCX0KfQo=\n","encoding":"base64"}

