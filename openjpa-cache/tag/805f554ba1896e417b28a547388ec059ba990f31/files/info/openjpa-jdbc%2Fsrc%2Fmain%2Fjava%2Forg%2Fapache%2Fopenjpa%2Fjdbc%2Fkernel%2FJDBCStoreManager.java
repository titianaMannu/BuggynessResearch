{"sha":"1cfd8a0a08e5e82239935ca1ed1f8a1a436535bb","node_id":"MDQ6QmxvYjIwNjM2NDoxY2ZkOGEwYTA4ZTVlODIyMzk5MzVjYTFlZDFmOGExYTQzNjUzNWJi","size":67016,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1cfd8a0a08e5e82239935ca1ed1f8a1a436535bb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0\naWwuU2V0OwoKaW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5RdWVyeUNhY2hlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5RdWVyeUNhY2hlU3Rv\ncmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBl\ncnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\ndmVudC5PcnBoYW5lZEtleUFjdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1\nZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5TdXBlcmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFTb3VyY2VG\nYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRC\nRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuU1FMRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLkJyb2tlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuRmluZGVyQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLkxvY2tNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uUGFyc2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRp\nbmdDb25uZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5q\nZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nU3RhdGVtZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nRmFjdG9yeUltcGwuTG9n\nSW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdl\nZFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVyYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRl\nZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0\naW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBTdG9yZU1hbmFnZXIgcGx1Z2luIHRoYXQgdXNlcyBKREJD\nIHRvIHN0b3JlIHBlcnNpc3RlbnQgZGF0YSBpbiBhCiAqIHJlbGF0aW9uYWwg\nZGF0YSBzdG9yZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2\nYWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZU1hbmFnZXIgCiAgICBp\nbXBsZW1lbnRzIFN0b3JlTWFuYWdlciwgSkRCQ1N0b3JlIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKEpEQkNTdG9yZU1hbmFnZXIuY2xhc3MpOwoK\nICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9jdHggPSBudWxsOwogICAgcHJp\ndmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CiAgICBwcml2\nYXRlIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CiAgICBwcml2YXRlIFNR\nTEZhY3RvcnkgX3NxbCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkNMb2NrTWFu\nYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhU291cmNlIF9kcyA9\nIG51bGw7CiAgICBwcml2YXRlIFJlZkNvdW50Q29ubmVjdGlvbiBfY29ubiA9\nIG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2FjdGl2ZSA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CgogICAgLy8gdHJhY2sgdGhl\nIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRoZW0KICAg\nIHByaXZhdGUgU2V0PFN0YXRlbWVudD4gX3N0bW50cyA9IENvbGxlY3Rpb25z\nLnN5bmNocm9uaXplZFNldChuZXcgSGFzaFNldDxTdGF0ZW1lbnQ+KCkpOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPENsaWVudENv\nbm5lY3Rpb24+IGNsaWVudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ29uc3RydWN0b3I8UmVmQ291bnRDb25uZWN0aW9uPiBy\nZWZDb3VudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgQ29uc3RydWN0b3I8Q2FuY2VsU3RhdGVtZW50PiBjYW5jZWxTdGF0ZW1l\nbnRJbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8\nQ2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQ+IGNhbmNlbFByZXBhcmVkU3RhdGVt\nZW50SW1wbDsKCiAgICBzdGF0aWMgewogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGNsaWVudENvbm5lY3Rpb25JbXBsID0gQ29uY3JldGVDbGFzc0dlbmVy\nYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENsaWVudENvbm5lY3Rpb24u\nY2xhc3MsIAogICAgICAgICAgICAgICAgQ29ubmVjdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIHJlZkNvdW50Q29ubmVjdGlvbkltcGwgPSBDb25jcmV0ZUNs\nYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoUmVmQ291bnRD\nb25uZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFu\nYWdlci5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGNh\nbmNlbFN0YXRlbWVudEltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLmdl\ndENvbmNyZXRlQ29uc3RydWN0b3IoQ2FuY2VsU3RhdGVtZW50LmNsYXNzLAog\nICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci5jbGFzcywgU3RhdGVt\nZW50LmNsYXNzLCBDb25uZWN0aW9uLmNsYXNzKTsKICAgICAgICAgICAgY2Fu\nY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsID0gQ29uY3JldGVDbGFzc0dlbmVy\nYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENhbmNlbFByZXBhcmVkU3Rh\ndGVtZW50LmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdl\nci5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIENvbm5lY3Rpb24u\nY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVyRXJyb3Io\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQg\nZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2N0eDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsK\nICAgICAgICBzZXRDb250ZXh0KGN0eCwgKEpEQkNDb25maWd1cmF0aW9uKSBj\ndHguZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4LCBKREJDQ29uZmln\ndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAgICAgICBf\nY29uZiA9IGNvbmY7CiAgICAgICAgX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rp\nb25hcnlJbnN0YW5jZSgpOwogICAgICAgIF9zcWwgPSBfY29uZi5nZXRTUUxG\nYWN0b3J5SW5zdGFuY2UoKTsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9n\nKEpEQkNDb25maWd1cmF0aW9uLkxPR19ESUFHKTsKCiAgICAgICAgTG9ja01h\nbmFnZXIgbG0gPSBjdHguZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICBpZiAo\nbG0gaW5zdGFuY2VvZiBKREJDTG9ja01hbmFnZXIpCiAgICAgICAgICAgIF9s\nbSA9IChKREJDTG9ja01hbmFnZXIpIGxtOwoKICAgICAgICBfZHMgPSBnZXRE\nYXRhU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRVcGRhdGVN\nYW5hZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAgICAgIGN0\neC5zZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgIH0KICAgICAgICAK\nICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiB1c2VDb25uZWN0aW9uRmFjdG9y\neTIoU3RvcmVDb250ZXh0IGN0eCkgeyAKICAgICAgICByZXR1cm4gKCFjdHgu\naXNNYW5hZ2VkKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVN\nYW5hZ2VkKCkpOyAgCiAgICB9CiAgICAgICAgCiAgICBwcml2YXRlIGZpbmFs\nIERhdGFTb3VyY2UgZ2V0RGF0YVNvdXJjZShTdG9yZUNvbnRleHQgY3R4KSB7\nCiAgICAgICAgRGF0YVNvdXJjZSBkczsKCiAgICAgICAgaWYodXNlQ29ubmVj\ndGlvbkZhY3RvcnkyKGN0eCkpIHsgCiAgICAgICAgICAgIGRzID0gX2NvbmYu\nZ2V0RGF0YVNvdXJjZTIoY3R4KTsgCiAgICAgICAgfQogICAgICAgIGVsc2Ug\newogICAgICAgICAgICBkcyA9IF9jb25mLmdldERhdGFTb3VyY2UoY3R4KTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRzOyAKICAgIH0KCiAgICBwdWJs\naWMgSkRCQ0NvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAg\nICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVibGljIERCRGljdGlv\nbmFyeSBnZXREQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0\nOwogICAgfQoKICAgIHB1YmxpYyBTUUxGYWN0b3J5IGdldFNRTEZhY3Rvcnko\nKSB7CiAgICAgICAgcmV0dXJuIF9zcWw7CiAgICB9CgogICAgcHVibGljIEpE\nQkNMb2NrTWFuYWdlciBnZXRMb2NrTWFuYWdlcigpIHsKICAgICAgICByZXR1\ncm4gX2xtOwogICAgfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4g\nKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIF9jdHguZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5PcHRpbWlz\ndGljKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrT3B0aW1p\nc3RpYygpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAg\nICAgICBfYWN0aXZlID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rp\nb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgICYmIF9j\nb25uLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgIF9jb25uLnNl\ndEF1dG9Db21taXQoZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAg\nICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0KCkg\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2N0eC5pc01hbmFn\nZWQoKSB8fCAhX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2Vk\nKCkpCiAgICAgICAgICAgICAgICBfY29ubi5jb21taXQoKTsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHsKICAgICAgICAgICAgfQog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBf\nZGljdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2\nZSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBy\nb2xsYmFjaygpIHsKICAgICAgICAvLyBhbHJlYWR5IHJvbGxlZCBiYWNrIG91\ncnNlbHZlcz8KICAgICAgICBpZiAoIV9hY3RpdmUpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9jb25uICE9\nIG51bGwKICAgICAgICAgICAgICAgICYmICghX2N0eC5pc01hbmFnZWQoKSB8\nfCAhX2NvbmYKICAgICAgICAgICAgICAgICAgICAuaXNDb25uZWN0aW9uRmFj\ndG9yeU1vZGVNYW5hZ2VkKCkpKQogICAgICAgICAgICAgICAgX2Nvbm4ucm9s\nbGJhY2soKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwg\nX2RpY3QpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3Rp\ndmUgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncmV0YWluQ29ubmVjdGlvbigpIHsKICAgICAgICBjb25uZWN0KGZhbHNlKTsK\nICAgICAgICBfY29ubi5zZXRSZXRhaW4odHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcmVsZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKF9j\nb25uICE9IG51bGwpCiAgICAgICAgICAgIF9jb25uLnNldFJldGFpbihmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRDbGllbnRDb25uZWN0\naW9uKCkgewogICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9y\nLm5ld0luc3RhbmNlKGNsaWVudENvbm5lY3Rpb25JbXBsLCBnZXRDb25uZWN0\naW9uKCkpOwogICAgfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGdldENvbm5l\nY3Rpb24oKSB7CiAgICAgICAgY29ubmVjdCh0cnVlKTsKICAgICAgICByZXR1\ncm4gX2Nvbm47CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBEYXRhU291cmNl\nIGdldERhdGFTb3VyY2UoKSB7CiAgICAJcmV0dXJuIF9kczsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29u\nZGl0aW9ucyBvbiBiYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNs\nYXNzCiAgICAgICAgLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIK\nICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcp\nIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIGV4aXN0cyhtYXBw\naW5nLCBzbS5nZXRPYmplY3RJZCgpLCBjb250ZXh0KTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0NhY2hlZChMaXN0PE9iamVjdD4gb2lkcywgQml0\nU2V0IGVkYXRhKSB7CiAgICAgICAgLy8gSkRCQ1N0b3JlTWFuYWdlciBkb2Vz\nbid0IHN0b3JlIG9pZHMgaW4gbWVtb3J5LgogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFuIGV4aXN0cyhDbGFz\nc01hcHBpbmcgbWFwcGluZywgT2JqZWN0IG9pZCwgT2JqZWN0IGNvbnRleHQp\nIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0aW9ucyBvbiBiYXNlIGNs\nYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNzCiAgICAgICAgLy8gZG9l\nc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAgICAgICBTZWxlY3Qgc2Vs\nID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICB3aGlsZSAobWFwcGluZy5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAg\nICAgICAgICBtYXBwaW5nID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKTsKCiAgICAgICAgc2VsLndoZXJlUHJpbWFyeUtleShv\naWQsIG1hcHBpbmcsIHRoaXMpOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgX2xvZy50cmFjZSgiZXhpc3RzOiBv\naWQ9IitvaWQrIiAiK21hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHNlbC5n\nZXRDb3VudCh0aGlzKSAhPSAwOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdl\ndFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIHN5bmNWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLmdldFZlcnNpb24o\nKS5jaGVja1ZlcnNpb24oc20sIHRoaXMsIHRydWUpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBpbnQgY29tcGFyZVZlcnNpb24oT3BlbkpQQVN0YXRl\nTWFuYWdlciBzdGF0ZSwgT2JqZWN0IHYxLCBPYmplY3QgdjIpIHsKICAgICAg\nICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHN0YXRl\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVy\nc2lvbigpLmNvbXBhcmVWZXJzaW9uKHYxLCB2Mik7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBQQ1N0YXRlIHN0YXRlLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBDb25uZWN0aW9uSW5m\nbyBpbmZvID0gKENvbm5lY3Rpb25JbmZvKSBjb250ZXh0OwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBpbml0aWFsaXplU3RhdGUoc20sIHN0\nYXRlLCAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgZmV0Y2gsIAogICAgICAg\nICAgICAgICAgaW5mbyk7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RGb3Vu\nZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0\nb3JlKHNlLCBFeGNlcHRpb25zLnRvU3RyaW5nKHNtLmdldFBlcnNpc3RlbmNl\nQ2FwYWJsZSgpKSwgCiAgICAgICAgICAgICAgICAgICAgX2RpY3QsIGZldGNo\nLmdldFJlYWRMb2NrTGV2ZWwoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSW5pdGlhbGl6ZSBhIG5ld2x5LWxvYWRlZCBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaW5pdGlhbGl6ZVN0YXRl\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3RhdGUgc3RhdGUsCiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgQ29ubmVjdGlvbklu\nZm8gaW5mbykKICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlv\nbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0\nT2JqZWN0SWQoKTsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChD\nbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgUmVzdWx0\nIHJlcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlu\nZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICByZXMgPSBpbmZvLnJlc3VsdDsKICAgICAgICAgICAgICAgIGlu\nZm8uc20gPSBzbTsKICAgICAgICAgICAgICAgIGlmIChpbmZvLm1hcHBpbmcg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpbmZvLm1hcHBpbmcgPSBt\nYXBwaW5nOwogICAgICAgICAgICAgICAgbWFwcGluZyA9IGluZm8ubWFwcGlu\nZzsKICAgICAgICAgICAgfSBlbHNlIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVu\nSlBBSWQKICAgICAgICAgICAgICAgICYmICEoKE9wZW5KUEFJZCkgb2lkKS5o\nYXNTdWJjbGFzc2VzKCkpIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gY3Vz\ndG9tID0gY3VzdG9tTG9hZChzbSwgbWFwcGluZywgc3RhdGUsIGZldGNoKTsK\nICAgICAgICAgICAgICAgIGlmIChjdXN0b20gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gY3VzdG9tLmJvb2xlYW5WYWx1ZSgpOwogICAg\nICAgICAgICAgICAgcmVzID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNt\nLCBtYXBwaW5nLCBmZXRjaCwKICAgICAgICAgICAgICAgICAgICBTZWxlY3Qu\nU1VCU19FWEFDVCk7CiAgICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwg\nJiYgIXNlbGVjdFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAg\nICBpZiAoaXNFbXB0eVJlc3VsdChyZXMpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0gbWFwcGluZy4KICAg\nICAgICAgICAgICAgICAgICBnZXRJbmRlcGVuZGVudEFzc2lnbmFibGVNYXBw\naW5ncygpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmdzLmxlbmd0aCA9\nPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmdz\nWzBdOwogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3Vz\ndG9tTG9hZChzbSwgbWFwcGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoY3VzdG9tICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBjdXN0b20uYm9vbGVhblZhbHVlKCk7CiAgICAg\nICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0\nKHNtLCBtYXBwaW5nLCBmZXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAg\nU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxFKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVjdFByaW1hcnlLZXkoc20sIG1h\ncHBpbmcsIGZldGNoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgcmVzID0gZ2V0SW5pdGlhbGl6ZVN0YXRlVW5pb25SZXN1bHQoc20s\nIG1hcHBpbmcsIG1hcHBpbmdzLAogICAgICAgICAgICAgICAgICAgICAgICBm\nZXRjaCk7CiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChyZXMp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gZmlndXJlIG91dCB3aGF0IHR5cGUgb2Yg\nb2JqZWN0IHRoaXMgaXM7IHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAgICAg\nIC8vIG9ubHkgZ3VhcmFudGVlcyB0byBwcm92aWRlIGEgYmFzZSBjbGFzcwog\nICAgICAgICAgICBDbGFzczw/PiB0eXBlOwogICAgICAgICAgICBpZiAoKHR5\ncGUgPSBnZXRUeXBlKHJlcywgbWFwcGluZykpID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmIChyZXMuZ2V0QmFzZU1hcHBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIG1hcHBpbmcgPSByZXMuZ2V0QmFzZU1hcHBp\nbmcoKTsKICAgICAgICAgICAgICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KG1h\ncHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG1hcHBpbmcuZ2V0RGlz\nY3JpbWluYXRvcigpLmdldENsYXNzKHRoaXMsIG1hcHBpbmcsCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcyk7CiAgICAgICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgICAgIHJlcy5lbmREYXRhUmVxdWVzdCgp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBpbml0aWFsaXplIHRoZSBzdGF0ZSBtYW5hZ2VyOyB0aGlzIG1heSBj\naGFuZ2UgdGhlIG1hcHBpbmcKICAgICAgICAgICAgLy8gYW5kIHRoZSBvYmpl\nY3QgaWQgaW5zdGFuY2UgaWYgdGhlIHR5cGUgYXMgZGV0ZXJtaW5lZAogICAg\nICAgICAgICAvLyBmcm9tIHRoZSBpbmRpY2F0b3IgaXMgYSBzdWJjbGFzcyBv\nZiBleHBlY3RlZCB0eXBlCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUodHlw\nZSwgc3RhdGUpOwoKICAgICAgICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBp\nbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1h\ncHBpbmcgbWFwcGVkQnlGaWVsZE1hcHBpbmcgPSBpbmZvLnJlc3VsdC4KICAg\nICAgICAgICAgICAgICAgICBnZXRNYXBwZWRCeUZpZWxkTWFwcGluZygpOwog\nICAgICAgICAgICAgICAgT2JqZWN0IG1hcHBlZEJ5T2JqZWN0ID0gaW5mby5y\nZXN1bHQuZ2V0TWFwcGVkQnlWYWx1ZSgpOwogICAgICAgICAgICAgICAgaWYg\nKG1hcHBlZEJ5RmllbGRNYXBwaW5nICE9IG51bGwgJiYgbWFwcGVkQnlPYmpl\nY3QgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpZiAobWFwcGVkQnlP\nYmplY3QgaW5zdGFuY2VvZiBPcGVuSlBBSWQgJiYKICAgICAgICAgICAgICAg\nICAgICAgICAgbWFwcGluZy5nZXRFeHRyYUZpZWxkRGF0YUluZGV4KG1hcHBl\nZEJ5RmllbGRNYXBwaW5nLmdldEluZGV4KCkpICE9IC0xKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIFRoZSBpbnZlcnNlIHJlbGF0aW9uIGNhbiBu\nb3QgYmUgc2V0IHNpbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdl\nIGFyZSBlYWdlcmx5IGxvYWRpbmcgdGhpcyBzbSBmb3IKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gYSBzbSBvd25lciB0aGF0IGlzIHN0aWxsIGluIHRo\nZSBwcm9jZXNzIG9mIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBpbml0\naWFsaXppbmcgaXRzZWxmLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBS\nZW1lbWJlciBvd25lciBvaWQgYnkgc2V0SW50ZXJtZWRpYXRlKCkuCiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIFRoZSBpbnZlcnNlIHJlbGF0aW9uIGlz\nIHNldCBsYXRlciBieQogICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXRJ\nbnZlcnNlUmVsYXRpb24oKSB3aGVuIHRoZSBzbSBvd25lciBpcyBmdWxseQog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplZC4KICAgICAg\nICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gbWFwcGVkQnlGaWVsZE1h\ncHBpbmcuZ2V0SW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHNtLmdldExvYWRlZCgpLmdldChpbmRleCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnNldEltcGxEYXRhKGluZGV4LCBtYXBwZWRCeU9i\namVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRJbnRlcm1lZGlhdGUoaW5k\nZXgsIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHNldE1hcHBlZEJ5KHNtLCBtYXBwZWRCeUZpZWxkTWFwcGlu\nZywgbWFwcGVkQnlPYmplY3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICAvLyBsb2FkIHRoZSBzZWxlY3RlZCBt\nYXBwaW5ncyBpbnRvIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyCiAgICAgICAg\nICAgIGlmIChyZXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gcmUt\nZ2V0IHRoZSBtYXBwaW5nIGluIGNhc2UgdGhlIGluc3RhbmNlIHdhcyBhIHN1\nYmNsYXNzCiAgICAgICAgICAgICAgICBtYXBwaW5nID0gKENsYXNzTWFwcGlu\nZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIGxvYWQobWFw\ncGluZywgc20sIGZldGNoLCByZXMpOwogICAgICAgICAgICAgICAgZ2V0VmVy\nc2lvbihtYXBwaW5nLCBzbSwgcmVzKTsKICAgICAgICAgICAgICAgIHNldElu\ndmVyc2VSZWxhdGlvbihzbSwgbWFwcGluZywgcmVzKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAocmVzICE9IG51bGwgJiYgKGluZm8gPT0gbnVs\nbCB8fCByZXMgIT0gaW5mby5yZXN1bHQpKQogICAgICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBz\nZXRJbnZlcnNlUmVsYXRpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwK\nICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgUmVzdWx0IHJlcykgewog\nICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRN\nYXBwaW5ncygpOwoKICAgICAgICAvLyBBdCB0aGlzIHBvaW50LCB0aGUgb3du\nZXIgaXMgZnVsbHkgaW5pdGlhbGl6ZWQuCiAgICAgICAgLy8gQ2hlY2sgaWYg\ndGhlIG93bmVyIGhhcyBlYWdlcmx5IGxvYWRlZCBUb01hbnkgcmVsYXRpb25z\nLgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChyZXMuZ2V0RWFnZXIoZm1zW2ldKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZtc1tpXS5nZXRFbGVtZW50\nKCkuaXNUeXBlUEMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgT2JqZWN0IGNv\nbGwgPSAgb3duZXIuZmV0Y2hPYmplY3QoZm1zW2ldLmdldEluZGV4KCkpOwog\nICAgICAgICAgICAgICAgaWYgKGNvbGwgaW5zdGFuY2VvZiBNYXApCiAgICAg\nICAgICAgICAgICAgICAgY29sbCA9ICgoTWFwKWNvbGwpLnZhbHVlcygpOwog\nICAgICAgICAgICAgICAgaWYgKGNvbGwgaW5zdGFuY2VvZiBDb2xsZWN0aW9u\nPD8+ICYmIAogICAgICAgICAgICAgICAgICAgICgoQ29sbGVjdGlvbjw/Pikg\nY29sbCkuc2l6ZSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIEZv\ndW5kIGVhZ2VybHkgbG9hZGVkIGNvbGxlY3Rpb24uCiAgICAgICAgICAgICAg\nICAgICAgLy8gUHVibGlzaGVyICgxKSA8PT0+ICAoTSkgTWFnYXppbmUKICAg\nICAgICAgICAgICAgICAgICAvLyAgICBwdWJsaXNoZXIgaGFzIGEgRUFHRVIg\nT25lVG9NYW55IHJlbGF0aW9uCiAgICAgICAgICAgICAgICAgICAgLy8gICAg\nbWFnYXppbmUgaGFzIGEgRUFHRVIgb3IgTEFaWSBNYW55VG9PbmUgcHVibGlz\naGVyCiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggbWVtYmVyIChN\nYWdhemluZSkgaW4gdGhlIGNvbGxlY3Rpb24sIAogICAgICAgICAgICAgICAg\nICAgIC8vIHNldCBpdHMgaW52ZXJzZSByZWxhdGlvbiAoUHVibGlzaGVyKS4K\nICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9ICgo\nQ29sbGVjdGlvbjw/PikgY29sbCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gKFBlcnNpc3RlbmNl\nQ2FwYWJsZSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHBjID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSAoT3Bl\nbkpQQVN0YXRlTWFuYWdlcikgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNtID0KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIChDbGFzc01hcHBpbmcpIF9jb25mLmdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0Q2FjaGVkTWV0YURh\ndGEocGMuZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGZtZCA9IGNtLmdldEZpZWxkTWFwcGluZ3MoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbWQu\nbGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGRvbid0IGNoZWNrIHRoZSBvaWRzIGZvciBiYXNpYyBmaWVsZHMuCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm1kW2pdLmlzVHlwZVBDKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qgb2lk\nID0gc20uZ2V0SW50ZXJtZWRpYXRlKGZtZFtqXS5nZXRJbmRleCgpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBvaWQgd2FzIHNl\ndEludGVybWVkaWF0ZSgpIHByZXZpb3VzbHkgYW5kIGl0IGlzIHRoZSBzYW1l\nIGFzIHRoZSBvd25lcixnZW5lcmF0ZQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIHRoZW4gc2V0IHRoZSBpbnZlcnNlIHJlbGF0aW9uCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9pZCAhPSBudWxs\nICYmIG9pZC5lcXVhbHMob3duZXIuZ2V0T2JqZWN0SWQoKSkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVPYmplY3Qo\nZm1kW2pdLmdldEluZGV4KCksIG93bmVyLmdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2\nb2lkIHNldE1hcHBlZEJ5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAg\nICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5RmllbGRNYXBwaW5nLCBPYmplY3Qg\nbWFwcGVkQnlPYmplY3QpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGlu\nZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAg\nRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKGZtc1tpXSA9PSBtYXBwZWRCeUZpZWxk\nTWFwcGluZykgewogICAgICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZm1z\nW2ldLmdldEluZGV4KCksIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGdldHRpbmcgdmVyc2lvbiBmcm9tIHRoZSByZXN1bHQgc2V0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBnZXRWZXJzaW9uKENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAg\nICAgIFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJv\ndmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAg\nICogaW1wbGVtZW50YXRpb24gb2YgY2hlY2tpbmcgd2hldGhlciB0aGUgcmVz\ndWx0IHNldCBpcyBlbXB0eSBvciBub3QuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzRW1wdHlSZXN1bHQoUmVzdWx0IHJlcykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmICFyZXMu\nbmV4dCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRo\nb2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRC\nQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB0eXBl\nIGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBD\nbGFzczw/PiBnZXRUeXBlKFJlc3VsdCByZXMsIENsYXNzTWFwcGluZyBtYXBw\naW5nKXsKICAgICAgICBpZiAocmVzID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHRoZSBtYXBw\naW5nIHRvIGN1c3RvbSBsb2FkIGRhdGEuIFJldHVybiBudWxsIGlmIHRoZSBt\nYXBwaW5nCiAgICAgKiBkb2VzIG5vdCB1c2UgY3VzdG9tIGxvYWRpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiBjdXN0b21Mb2FkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAg\nIFBDU3RhdGUgc3RhdGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gp\nCiAgICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBtYXBw\naW5nIHRha2VzIGNhcmUgb2YgaW5pdGlhbGl6YXRpb24KICAgICAgICBpZiAo\nIW1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgc3RhdGUsIGZldGNoKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHNtLmdldE1h\nbmFnZWRJbnN0YW5jZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgbWFwcGlu\nZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgICAgICAg\nICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxl\nY3QgdGhlIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBhbmQgcmV0dXJu\nIHRoZSByZXN1bHQuIFJldHVybgogICAgICogbnVsbCBpZiB0aGVyZSBpcyBu\nbyBkYXRhIGluIHRoZSBjdXJyZW50IGZldGNoIGdyb3VwcyB0byBzZWxlY3Qu\nCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxpemVTdGF0\nZVJlc3VsdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgc3VicykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBGaW5kZXJRdWVyeUltcGwgZnEgPSBnZXRGaW5kZXIobWFwcGluZywg\nZmV0Y2gpOwogICAgICAgIGlmIChmcSAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZnEuZXhlY3V0ZShzbSwgdGhpcywgZmV0Y2gpOwogICAgICAgIFNl\nbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgIGlmICghc2Vs\nZWN0KHNlbCwgbWFwcGluZywgc3Vicywgc20sIG51bGwsIGZldGNoLAogICAg\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIHRy\ndWUsIGZhbHNlKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5n\nLCB0aGlzKTsKICAgICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgx\nLCBmYWxzZSk7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkg\newogICAgICAgICAgICBfbG9nLnRyYWNlKCJnZXRJbml0aWFsaXplU3RhdGVS\nZXN1bHQ6IG9pZD0iK3NtLmdldE9iamVjdElkKCkrIiAiK21hcHBpbmcuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgUmVzdWx0IHJl\nc3VsdCA9IHNlbC5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICBjYWNo\nZUZpbmRlcihtYXBwaW5nLCBzZWwsIGZldGNoKTsKICAgICAgICByZXR1cm4g\ncmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGEgdW5pb24g\nb2YgdGhlIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHBvc3Np\nYmxlIGNvbmNyZXRlCiAgICAgKiBtYXBwaW5ncyBhbmQgcmV0dXJuIHRoZSBy\nZXN1bHQuCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxp\nemVTdGF0ZVVuaW9uUmVzdWx0KGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGZpbmFsIENsYXNz\nTWFwcGluZ1tdIG1hcHBpbmdzLAogICAgICAgIGZpbmFsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIEZpbmRlclF1ZXJ5SW1wbCBmcSA9IGdldEZpbmRlcihtYXBwaW5nLCBm\nZXRjaCk7CiAgICAgICAgaWYgKGZxICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmcS5leGVjdXRlKHNtLCB0aGlzLCBmZXRjaCk7CiAgICAgICAgZmlu\nYWwgSkRCQ1N0b3JlTWFuYWdlciBzdG9yZSA9IHRoaXM7CiAgICAgICAgZmlu\nYWwgaW50IGVhZ2VyID0gTWF0aC5taW4oZmV0Y2guZ2V0RWFnZXJGZXRjaE1v\nZGUoKSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdF\nUl9KT0lOKTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBfc3FsLm5ld1VuaW9u\nKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgdW5pb24uc2V0RXhwZWN0ZWRS\nZXN1bHRDb3VudCgxLCBmYWxzZSk7CiAgICAgICAgaWYgKGZldGNoLmdldFN1\nYmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGZldGNoLkVBR0VSX0pPSU4p\nCiAgICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICB1bmlv\nbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGkpIHsKICAgICAg\nICAgICAgICAgIHNlbC5zZWxlY3QobWFwcGluZ3NbaV0sIFNlbGVjdC5TVUJT\nX0FOWV9KT0lOQUJMRSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAgICAg\nICAgIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZVByaW1hcnlL\nZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZ3NbaV0sIHN0b3JlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIFJlc3VsdCByZXN1bHQg\nPSB1bmlvbi5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICBjYWNoZUZp\nbmRlcihtYXBwaW5nLCB1bmlvbiwgZmV0Y2gpOwogICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgcHJpbWFyeSBr\nZXkgZGF0YSB0byBtYWtlIHN1cmUgdGhlIGdpdmVuIGluc3RhbmNlIGV4aXN0\ncywgbG9ja2luZwogICAgICogaWYgbmVlZGVkLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gc2VsZWN0UHJpbWFyeUtleShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIC8vIHNlbGVjdCBwa3MgZnJvbSBiYXNlIGNsYXNz\nIHJlY29yZCB0byBlbnN1cmUgaXQgZXhpc3RzIGFuZCBsb2NrCiAgICAgICAg\nLy8gaXQgaWYgbmVlZGVkCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2UgPSBt\nYXBwaW5nOwogICAgICAgIHdoaWxlIChiYXNlLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIGJhc2UgPSBi\nYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAg\nICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBzZWwu\nc2VsZWN0KGJhc2UuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAgICAgICAg\nc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBiYXNlLCB0\naGlzKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgIF9sb2cudHJhY2UoInNlbGVjdFByaW1hcnlLZXk6IG9pZD0i\nK3NtLmdldE9iamVjdElkKCkrIiAiK21hcHBpbmcuZ2V0RGVzY3JpYmVkVHlw\nZSgpKTsKICAgICAgICB9CiAgICAgICAgUmVzdWx0IGV4aXN0cyA9IHNlbC5l\neGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoaXNFbXB0eVJlc3VsdChleGlzdHMpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgLy8gcmVjb3JkIGxvY2tlZD8K\nICAgICAgICAgICAgaWYgKF9hY3RpdmUgJiYgX2xtICE9IG51bGwgJiYgZXhp\nc3RzLmlzTG9ja2luZygpKQogICAgICAgICAgICAgICAgX2xtLmxvYWRlZEZv\nclVwZGF0ZShzbSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGV4aXN0cy5jbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBsb2FkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAgICAgICAgRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9ja0xldmVsLCBPYmplY3QgY29u\ndGV4dCkgewogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gamZldGNo\nID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZldGNoOwoKICAgICAgICAv\nLyBnZXQgYSBjb25uZWN0aW9uLCBvciByZXVzZSBjdXJyZW50IG9uZQogICAg\nICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSAoQ29ubmVjdGlvbkluZm8pIGNv\nbnRleHQ7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAgICAgICAgaWYg\nKGluZm8gIT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBpbml0aWFsaXpl\nKCkgZmFpbHMgdG8gbG9hZCByZXF1aXJlZCBmaWVsZHMsIHRoZW4gdGhpcyBt\nZXRob2QKICAgICAgICAgICAgLy8gaXMgY2FsbGVkOyBtYWtlIHN1cmUgbm90\nIHRvIHRyeSB0byB1c2UgdGhlIGdpdmVuIHJlc3VsdCBpZiBpdCdzCiAgICAg\nICAgICAgIC8vIHRoZSBzYW1lIG9uZSB3ZSBqdXN0IGZhaWxlZCB0byBjb21w\nbGV0ZWx5IGluaXRpYWxpemUoKSB3aXRoCiAgICAgICAgICAgIGlmIChpbmZv\nLnNtICE9IHNtKQogICAgICAgICAgICAgICAgcmVzID0gaW5mby5yZXN1bHQ7\nCiAgICAgICAgICAgIGluZm8uc20gPSBudWxsOwogICAgICAgIH0KICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGFuIGV4aXN0aW5n\nIHJlc3VsdCwgbG9hZCBhbGwgd2UgY2FuIGZyb20gaXQKICAgICAgICAgICAg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRN\nZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAocmVzICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRjaCwgcmVzKTsK\nICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwgZmllbGRz\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhlIGluc3Rh\nbmNlIGlzIGhvbGxvdyBhbmQgdGhlcmUncyBhIGN1c3RvbWl6ZWQKICAgICAg\nICAgICAgLy8gZ2V0IGJ5IGlkIG1ldGhvZCwgdXNlIGl0CiAgICAgICAgICAg\nIGlmIChzbS5nZXRMb2FkZWQoKS5sZW5ndGgoKSA9PSAwIAogICAgICAgICAg\nICAgICAgJiYgbWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBudWxsLCBq\nZmV0Y2gpKQogICAgICAgICAgICAgICAgcmVtb3ZlTG9hZGVkRmllbGRzKHNt\nLCBmaWVsZHMpOwoKICAgICAgICAgICAgLy8jIyMgc2VsZWN0IGlzIGtpbmQg\nb2YgYSBiaWcgb2JqZWN0LCBhbmQgaW4gc29tZSBjYXNlcyB3ZSBkb24ndAog\nICAgICAgICAgICAvLyMjIyB1c2UgaXQuLi4gd291bGQgaXQgYmUgd29ydGgg\naXQgdG8gaGF2ZSBhIHNtYWxsIHNoZWxsIHNlbGVjdAogICAgICAgICAgICAv\nLyMjIyBvYmplY3QgdGhhdCBvbmx5IGNyZWF0ZXMgYSByZWFsIHNlbGVjdCB3\naGVuIGFjdHVhbGx5IHVzZWQ/CgogICAgICAgICAgICBTZWxlY3Qgc2VsID0g\nX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgaWYgKHNlbGVjdChzZWws\nIG1hcHBpbmcsIFNlbGVjdC5TVUJTX0VYQUNULCBzbSwgZmllbGRzLCBqZmV0\nY2gsCiAgICAgICAgICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFHRVJfSk9J\nTiwgdHJ1ZSwgZmFsc2UpKSB7CiAgICAgICAgICAgICAgICBzZWwud2hlcmVQ\ncmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmcsIHRoaXMpOwog\nICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewog\nICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoImxvYWQ6ICIrbWFwcGlu\nZy5nZXREZXNjcmliZWRUeXBlKCkrIiBvaWQ6ICIrc20uZ2V0T2JqZWN0SWQo\nKSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzID0g\nc2VsLmV4ZWN1dGUodGhpcywgamZldGNoLCBsb2NrTGV2ZWwpOwogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAJaWYgKGlzRW1wdHlS\nZXN1bHQocmVzKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpm\nZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyBhbGxvdyB0aGUg\nZmllbGRzIHRvIGxvYWQgdGhlbXNlbHZlcyBpbmRpdmlkdWFsbHkgdG9vCiAg\nICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHMu\nZ2V0KGkpICYmICFzbS5nZXRMb2FkZWQoKS5nZXQoaSkpIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoImxvYWQgZmllbGQ6ICci\nKyBmbXNbaV0uZ2V0TmFtZSgpICsgIicgZm9yIG9pZD0iK3NtLmdldE9iamVj\ndElkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsiICIrbWFwcGlu\nZy5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9hZChzbSwgdGhpcywgamZl\ndGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNt\nLCB0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBj\nYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cg\nU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QsIGxvY2tMZXZlbCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbGlz\ndCBmb3JtZWQgYnkgcmVtb3ZpbmcgYWxsIGxvYWRlZCBmaWVsZHMgZnJvbSB0\naGUgZ2l2ZW4gb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3Zl\nTG9hZGVkRmllbGRzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBm\naWVsZHMpIHsKICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gZmllbGRz\nLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgIGlmIChmaWVs\nZHMuZ2V0KGkpICYmIHNtLmdldExvYWRlZCgpLmdldChpKSkKICAgICAgICAg\nICAgICAgIGZpZWxkcy5jbGVhcihpKTsKICAgIH0KCiAgICBwdWJsaWMgQ29s\nbGVjdGlvbiBsb2FkQWxsKENvbGxlY3Rpb24gc21zLCBQQ1N0YXRlIHN0YXRl\nLCBpbnQgbG9hZCwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIu\nbG9hZEFsbChzbXMsIHRoaXMsIHN0YXRlLCBsb2FkLCBmZXRjaCwgY29udGV4\ndCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVmb3JlU3RhdGVDaGFuZ2Uo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBmcm9tU3RhdGUsCiAg\nICAgICAgUENTdGF0ZSB0b1N0YXRlKSB7CiAgICB9CgogICAgcHVibGljIENv\nbGxlY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBzbXMpIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbCAmJiBfY29ubi5nZXRJ\nbm5lcm1vc3REZWxlZ2F0ZSgpLmlzUmVhZE9ubHkoKSkKICAgICAgICAgICAg\nICAgIF9jb25uLnNldFJlYWRPbmx5KGZhbHNlKTsKICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gZSkgewogICAgICAgIH0KICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbTogKENvbGxlY3Rpb248T3BlbkpQQVN0YXRlTWFu\nYWdlcj4pc21zKSB7CiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKCJmbHVz\naDogIitzbS5nZXRQQ1N0YXRlKCkuZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAi\nIGZvciBvaWQ9IitzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2NvbmYuZ2V0VXBkYXRlTWFuYWdl\nckluc3RhbmNlKCkuZmx1c2goc21zLCB0aGlzKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBjYW5jZWxBbGwoKSB7CiAgICAgICAgLy8gbm90ZSB0aGF0\nIHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2sgdGhlIGNvbnRleHQsIHNpbmNl\nCiAgICAgICAgLy8gd2Ugd2FudCB0byBhbGxvdyBhIGRpZmZlcmVudCB0aHJl\nYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgdGhlCiAgICAgICAgLy8gb3V0c3Rh\nbmRpbmcgc3RhdGVtZW50IG9uIGEgZGlmZmVyZW50IGNvbnRleHQKCiAgICAg\nICAgQ29sbGVjdGlvbjxTdGF0ZW1lbnQ+IHN0bW50czsKICAgICAgICBzeW5j\naHJvbml6ZWQgKF9zdG1udHMpIHsKICAgICAgICAgICAgaWYgKF9zdG1udHMu\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICBzdG1udHMgPSBuZXcgQXJyYXlMaXN0PFN0YXRlbWVudD4oX3N0\nbW50cyk7CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yPFN0YXRlbWVudD4gaXRyID0gc3RtbnRzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgKChTdGF0ZW1l\nbnQpIGl0ci5uZXh0KCkpLmNhbmNlbCgpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3Np\nZ25PYmplY3RJZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29sZWFuIHBy\nZUZsdXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0\nTWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAg\nICByZXR1cm4gQXBwbGljYXRpb25JZHMuYXNzaWduKHNtLCB0aGlzLCBwcmVG\nbHVzaCk7CgogICAgICAgIC8vIGRhdGFzdG9yZSBpZGVudGl0eQogICAgICAg\nIE9iamVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRlSWRlbnRpdHlWYWx1\nZShfY3R4LCBtZXRhLAogICAgICAgICAgICBKYXZhVHlwZXMuTE9ORyk7CiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsICYmIG1ldGEuZ2V0SWRlbnRpdHlTdHJh\ndGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgICAgIHZhbCA9IGdldERhdGFTdG9yZUlkU2VxdWVuY2UobWV0YSkubmV4\ndChfY3R4LCBtZXRhKTsKICAgICAgICBzbS5zZXRPYmplY3RJZChuZXdEYXRh\nU3RvcmVJZCh2YWwsIG1ldGEpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25GaWVsZChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBpbnQgZmllbGQsCiAgICAgICAgYm9vbGVhbiBwcmVG\nbHVzaCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gc20uZ2V0TWV0\nYURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgT2JqZWN0IHZhbCA9\nIEltcGxIZWxwZXIuZ2VuZXJhdGVGaWVsZFZhbHVlKF9jdHgsIGZtZCk7CiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgc20uc3RvcmUoZmllbGQsIHZhbCk7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIENsYXNzPD8+IGdldE1hbmFn\nZWRUeXBlKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAob2lkIGluc3RhbmNl\nb2YgSWQpCiAgICAgICAgICAgIHJldHVybiAoKElkKSBvaWQpLmdldFR5cGUo\nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgQ2xh\nc3M8Pz4gZ2V0RGF0YVN0b3JlSWRUeXBlKENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIHJldHVybiBJZC5jbGFzczsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGNvcHlEYXRhU3RvcmVJZChPYmplY3Qgb2lkLCBDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBJZCBpZCA9IChJZCkgb2lkOwogICAgICAg\nIHJldHVybiBuZXcgSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIGlkLmdl\ndElkKCksIGlkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBuZXdEYXRhU3RvcmVJZChPYmplY3QgdmFsLCBDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQubmV3SW5zdGFuY2UobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksIHZhbCk7CiAgICB9CgogICAgcHVibGlj\nIElkIG5ld0RhdGFTdG9yZUlkKGxvbmcgaWQsIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBib29sZWFuIHN1YnMpIHsKICAgICAgICByZXR1cm4gbmV3IElkKG1h\ncHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLCBpZCwgc3Vicyk7CiAgICB9Cgog\nICAgcHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVFeHRlbnQo\nQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIGZpbmFsIGJvb2xlYW4gc3Vi\nY2xhc3NlcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwog\nICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzOwogICAgICAg\nIGlmIChzdWJjbGFzc2VzKQogICAgICAgICAgICBtYXBwaW5ncyA9IG1hcHBp\nbmcuZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIG1hcHBpbmdzID0gbmV3IENsYXNzTWFwcGlu\nZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRl\ncltdIHJvcHMgPSBudWxsOwogICAgICAgIGZpbmFsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gamZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZl\ndGNoOwogICAgICAgIGlmIChqZmV0Y2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUo\nbWFwcGluZykgIT0gamZldGNoLkVBR0VSX0pPSU4pCiAgICAgICAgICAgIHJv\ncHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbbWFwcGluZ3MubGVuZ3Ro\nXTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGN1\nc3RvbSBsb2FkcwogICAgICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciBy\nb3A7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3Mu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHJvcCA9IG1hcHBpbmdz\nW2ldLmN1c3RvbUxvYWQodGhpcywgc3ViY2xhc3NlcywgamZldGNoLCAwLAog\nICAgICAgICAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAg\nICAgICAgIGlmIChyb3AgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChyb3BzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJv\ncHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbbWFwcGluZ3MubGVuZ3Ro\nXTsKICAgICAgICAgICAgICAgICAgICByb3BzW2ldID0gcm9wOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB3\nZSdyZSBzZWxlY3RpbmcgaW5kZXBlbmRlbnQgbWFwcGluZ3Mgc2VwYXJhdGVs\neSBvciBoYXZlCiAgICAgICAgICAgIC8vIGN1c3RvbSBsb2FkcywgZG8gaW5k\naXZpZHVhbCBzZWxlY3RzIGZvciBlYWNoIGNsYXNzCiAgICAgICAgICAgIHJv\ncCA9IG51bGw7CiAgICAgICAgICAgIGlmIChyb3BzICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAocm9wc1tpXSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0\nKCk7CiAgICAgICAgICAgICAgICAgICAgc2VsLnNldExSUyh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoImV4ZWN1dGVF\neHRlbnQ6ICIrbWFwcGluZ3NbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgc2VsLmxvZ0VhZ2VyUmVsYXRpb25zKCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEJp\ndFNldCBwYWdlZCA9IHNlbGVjdEV4dGVudChzZWwsIG1hcHBpbmdzW2ldLCBq\nZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmNsYXNzZXMpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwYWdlZCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICByb3BzW2ldID0gbmV3IEluc3RhbmNlUmVzdWx0\nT2JqZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCk7CiAgICAgICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByb3BzW2ldID0g\nbmV3IFBhZ2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHNlbCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzW2ldLCB0aGlzLCBqZmV0Y2gs\nIHBhZ2VkLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBpZiAocm9wcy5sZW5ndGggPT0gMSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gcm9wc1swXTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wcyk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBlcmZvcm0gYSB1bmlvbiBv\nbiBhbGwgaW5kZXBlbmRlbnQgY2xhc3NlcwogICAgICAgICAgICBVbmlvbiB1\nbmlvbiA9IF9zcWwubmV3VW5pb24obWFwcGluZ3MubGVuZ3RoKTsKICAgICAg\nICAgICAgdW5pb24uc2V0TFJTKHRydWUpOwogICAgICAgICAgICBmaW5hbCBC\naXRTZXRbXSBwYWdlZCA9IG5ldyBCaXRTZXRbbWFwcGluZ3MubGVuZ3RoXTsK\nICAgICAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3Rvcigp\nIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qg\nc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZWRbaWR4\nXSA9IHNlbGVjdEV4dGVudChzZWwsIG1hcHBpbmdzW2lkeF0sIGpmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gdXNp\nbmcgcGFnaW5nIHJvcCBpZiBhbnkgdW5pb24gZWxlbWVudCBoYXMgcGFnZWQg\nZmllbGRzCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFnZWQu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlZFtpXSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUGFnaW5n\nUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdzLAogICAgICAg\nICAgICAgICAgICAgICAgICBKREJDU3RvcmVNYW5hZ2VyLnRoaXMsIGpmZXRj\naCwgcGFnZWQsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gbmV3IEluc3RhbmNlUmVzdWx0T2JqZWN0UHJvdmlk\nZXIodW5pb24sIG1hcHBpbmdzWzBdLCB0aGlzLAogICAgICAgICAgICAgICAg\namZldGNoKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwg\nX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVj\ndCB0aGUgZ2l2ZW4gbWFwcGluZyBmb3IgdXNlIGluIGFuIGV4dGVudCwgcmV0\ndXJuaW5nIHBhZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRT\nZXQgc2VsZWN0RXh0ZW50KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBw\naW5nLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJv\nb2xlYW4gc3ViY2xhc3NlcykgewogICAgICAgIGludCBzdWJzID0gKHN1YmNs\nYXNzZXMpID8gU2VsZWN0LlNVQlNfSk9JTkFCTEUgOiBTZWxlY3QuU1VCU19O\nT05FOwogICAgICAgIC8vIGRlY2lkZSBiZXR3ZWVuIHBhZ2luZyBhbmQgc3Rh\nbmRhcmQgaXRlcmF0aW9uCiAgICAgICAgQml0U2V0IHBhZ2VkID0gUGFnaW5n\nUmVzdWx0T2JqZWN0UHJvdmlkZXIuZ2V0UGFnZWRGaWVsZHMoc2VsLCBtYXBw\naW5nLAogICAgICAgICAgICB0aGlzLCBmZXRjaCwgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbi5FQUdFUl9QQVJBTExFTCwKICAgICAgICAgICAgTG9uZy5NQVhf\nVkFMVUUpOwogICAgICAgIGlmIChwYWdlZCA9PSBudWxsKQogICAgICAgICAg\nICBzZWwuc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLCBzdWJzLCB0aGlzLCBm\nZXRjaCwKICAgICAgICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24u\nRUFHRVJfUEFSQUxMRUwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2Vs\nLnNlbGVjdElkZW50aWZpZXIobWFwcGluZywgc3VicywgdGhpcywgZmV0Y2gs\nCiAgICAgICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VS\nX0pPSU4pOwogICAgICAgIHJldHVybiBwYWdlZDsKICAgIH0KCiAgICBwcml2\nYXRlIFN0b3JlUXVlcnkgbmV3U3RvcmVRdWVyeShTdHJpbmcgbGFuZ3VhZ2Up\nIHsKICAgICAgICBFeHByZXNzaW9uUGFyc2VyIGVwID0gUXVlcnlMYW5ndWFn\nZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZ3VhZ2UpOwogICAgICAgIGlmIChl\ncCAhPSBudWxsKSB7IAogICAgICAgICAgICByZXR1cm4gbmV3IEpEQkNTdG9y\nZVF1ZXJ5KHRoaXMsIGVwKTsKICAgICAgICB9CiAgICAgICAgaWYgKFF1ZXJ5\nTGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhsYW5ndWFnZSkpIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTUUxTdG9yZVF1ZXJ5KHRoaXMpOwogICAgICAg\nIH0KICAgICAgICBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19QUkVQQVJFRF9T\nUUwuZXF1YWxzKGxhbmd1YWdlKSkgewogICAgICAgICAgICByZXR1cm4gbmV3\nIFByZXBhcmVkU1FMU3RvcmVRdWVyeSh0aGlzKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdG9yZVF1\nZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIFN0b3Jl\nUXVlcnkgc3EgPSBuZXdTdG9yZVF1ZXJ5KGxhbmd1YWdlKTsgCiAgICAgICAg\naWYgKHNxID09IG51bGwgfHwgUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFu\nZ3VhZ2UobGFuZ3VhZ2UpID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJu\nIHNxOwogICAgICAgIH0KCiAgICAgICAgUXVlcnlDYWNoZSBxdWVyeUNhY2hl\nID0gX2N0eC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGF0YUNhY2hlTWFuYWdl\nckluc3RhbmNlKCkuZ2V0U3lzdGVtUXVlcnlDYWNoZSgpOwogICAgICAgIGlm\nIChxdWVyeUNhY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHNx\nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5\nQ2FjaGVTdG9yZVF1ZXJ5KHNxLCBxdWVyeUNhY2hlKTsKICAgIH0KCiAgICBw\ndWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIG5ld0ZldGNoQ29uZmlndXJhdGlv\nbigpIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb25JbXBsKCk7CiAgICB9CgogICAgcHVibGljIFNlcSBnZXREYXRhU3RvcmVJ\nZFNlcXVlbmNlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICht\nZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMu\nTkFUSVZFCiAgICAgICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVn\neSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICByZXR1\ncm4gX2NvbmYuZ2V0U2VxdWVuY2VJbnN0YW5jZSgpOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5j\nZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGlmIChf\nY29ubiAhPSBudWxsKQogICAgICAgICAgICBfY29ubi5mcmVlKCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8v\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBDb25uZWN0IHRvIHRoZSBkYi4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNvbm5lY3QoYm9vbGVhbiByZWYp\nIHsKICAgICAgICBfY3R4LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBjb25uZWN0IGlmIHRoZSBjb25uZWN0aW9uIGlzIGN1cnJlbnRs\neSBudWxsLCBvciBpZgogICAgICAgICAgICAvLyB0aGUgY29ubmVjdGlvbiBo\nYXMgYmVlbiBjbG9zZWQgb3V0IGZyb20gdW5kZXIgdXMKICAgICAgICAgICAg\naWYgKF9jb25uID09IG51bGwpCiAgICAgICAgICAgICAgICBfY29ubiA9IGNv\nbm5lY3RJbnRlcm5hbCgpOwogICAgICAgICAgICBpZiAocmVmKQogICAgICAg\nICAgICAgICAgX2Nvbm4ucmVmKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBfY3R4LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENvbm5lY3QgdG8gdGhlIGRhdGFiYXNlLiBUaGlzIG1ldGhv\nZCBpcyBzZXBhcmF0ZWQgb3V0IHNvIHRoYXQgaXQKICAgICAqIGNhbiBiZSBv\ndmVycmlkZGVuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVmQ291bnRDb25u\nZWN0aW9uIGNvbm5lY3RJbnRlcm5hbCgpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0lu\nc3RhbmNlKHJlZkNvdW50Q29ubmVjdGlvbkltcGwsIEpEQkNTdG9yZU1hbmFn\nZXIudGhpcywgX2RzLmdldENvbm5lY3Rpb24oKSk7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBDb25uZWN0aW9uIGdldE5ld0Nvbm5lY3Rpb24oKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIF9kcy5nZXRDb25uZWN0aW9u\nKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShlLCBfZGljdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgb2Jq\nZWN0IHdpdGggdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAgcHVibGljIE9i\namVjdCBmaW5kKE9iamVjdCBvaWQsIFZhbHVlTWFwcGluZyB2bSwgCiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlm\nIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBf\nbG9nLnRyYWNlKCJmaW5kOiBvaWQ9IitvaWQrIiAiK3ZtLmdldERlY2xhcmVk\nVHlwZU1hcHBpbmcoKS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgIH0K\nICAgICAgICBPYmplY3QgcGMgPSBfY3R4LmZpbmQob2lkLCBmZXRjaCwgbnVs\nbCwgbnVsbCwgMCk7CiAgICAgICAgaWYgKHBjID09IG51bGwgJiYgdm0gIT0g\nbnVsbCkgewogICAgICAgICAgICBPcnBoYW5lZEtleUFjdGlvbiBhY3Rpb24g\nPSBfY29uZi5nZXRPcnBoYW5lZEtleUFjdGlvbkluc3RhbmNlKCk7CiAgICAg\nICAgICAgIHBjID0gYWN0aW9uLm9ycGhhbihvaWQsIG51bGwsIHZtKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHBjOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgb2JqZWN0IGluIHRoZSBjdXJyZW50IHJvdyBvZiB0aGUg\nZ2l2ZW4gcmVzdWx0LgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGxvYWQo\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUsIFJlc3VsdCByZXN1bHQp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghbWFwcGluZy5p\nc01hcHBlZCgpKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJ2aXJ0dWFsLW1hcHBpbmciLCAKICAgICAg\nICAgICAgICAgIG1hcHBpbmcpKTsKCiAgICAgICAgLy8gZ2V0IHRoZSBvYmpl\nY3QgaWQgZm9yIHRoZSByb3c7IGJhc2UgY2xhc3Mgc2VsZWN0cyBwayBjb2x1\nbW5zCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2UgPSBtYXBwaW5nOwogICAg\nICAgIHdoaWxlIChiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpICE9IG51bGwpCiAgICAgICAgICAgIGJhc2UgPSBiYXNlLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIE9iamVjdCBvaWQg\nPSBiYXNlLmdldE9iamVjdElkKHRoaXMsIHJlc3VsdCwgbnVsbCwgdHJ1ZSwg\nbnVsbCk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbyA9IG5l\ndyBDb25uZWN0aW9uSW5mbygpOwogICAgICAgIGluZm8ucmVzdWx0ID0gcmVz\ndWx0OwogICAgICAgIGluZm8ubWFwcGluZyA9IG1hcHBpbmc7CgogICAgICAg\nIC8vIGlmIGludmVyc2UgcmVsYXRpb24gaXMga25vd24sIGV4Y2x1ZGUgbG9h\nZGluZyBkdXJpbmcgZmluZAogICAgICAgIGV4Y2x1ZGUgPSBleGNsdWRlSW52\nZXJzZVJlbGF0aW9uKG1hcHBpbmcsIGluZm8sIGV4Y2x1ZGUpOwogICAgICAg\nIHJldHVybiBfY3R4LmZpbmQob2lkLCBmZXRjaCwgZXhjbHVkZSwgaW5mbywg\nMCk7CiAgICB9CgogICAgcHJpdmF0ZSBCaXRTZXQgZXhjbHVkZUludmVyc2VS\nZWxhdGlvbihDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBDb25uZWN0\naW9uSW5mbyBpbmZvLCBCaXRTZXQgZXhjbHVkZSkgewogICAgICAgIEZpZWxk\nTWFwcGluZyBpbnZlcnNlID0gaW5mby5yZXN1bHQuZ2V0TWFwcGVkQnlGaWVs\nZE1hcHBpbmcoKTsKICAgICAgICBpZiAoaW52ZXJzZSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVm\naW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgaWYgKGV4Y2x1ZGUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIGV4Y2x1ZGUgPSBuZXcgQml0U2V0\nKGZtcy5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZtc1tp\nXSA9PSBpbnZlcnNlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjbHVkZS5z\nZXQoZm1zW2ldLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBleGNsdWRlOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciB3aXRoIGRhdGEgZnJv\nbSB0aGUgcmVzdWx0IHNldC4gT25seQogICAgICogbWFwcGluZ3Mgb3JpZ2lu\nYWxseSBzZWxlY3RlZCB3aWxsIGJlIGxvYWRlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gbG9hZChtYXBwaW5n\nLCBzbSwgZmV0Y2gsIHJlcywgbnVsbCk7CiAgICAgICAgaWYgKGVhZ2VyVG9N\nYW55ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgX2xvZy50cmFjZSgiTG9hZGlu\nZyBlYWdlciB0b01hbnk6ICIrZWFnZXJUb01hbnkuZ2V0TmFtZSgpKyIgZm9y\nICIrbWFwcGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWFnZXJU\nb01hbnkubG9hZEVhZ2VySm9pbihzbSwgdGhpcywgZmV0Y2gudHJhdmVyc2VK\nREJDKGVhZ2VyVG9NYW55KSwKICAgICAgICAgICAgICAgIHJlcyk7CiAgICAg\nICAgfQogICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIHJl\ncy5pc0xvY2tpbmcoKSkKICAgICAgICAgICAgX2xtLmxvYWRlZEZvclVwZGF0\nZShzbSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBmaWVsZHMg\nb2YgdGhlIGdpdmVuIG1hcHBpbmcuIFJldHVybiBhbnkgdG8tbWFueSBlYWdl\nciBmaWVsZAogICAgICogd2l0aG91dCBsb2FkaW5nIGl0LgogICAgICovCiAg\nICBwcml2YXRlIEZpZWxkTWFwcGluZyBsb2FkKENsYXNzTWFwcGluZyBtYXBw\naW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEZpZWxkTWFwcGlu\nZyBlYWdlclRvTWFueSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAobWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBmZXRj\naCwgcmVzKSkKICAgICAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwoKICAg\nICAgICAvLyBsb2FkIHN1cGVyY2xhc3MgZGF0YTsgYmFzZSBjbGFzcyBsb2Fk\ncyB2ZXJzaW9uCiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\naWYgKHBhcmVudCAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueSA9\nIGxvYWQocGFyZW50LCBzbSwgZmV0Y2gsIHJlcywgZWFnZXJUb01hbnkpOwog\nICAgICAgIGVsc2UgaWYgKHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAg\nICAgICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5sb2FkKHNtLCB0aGlzLCBy\nZXMpOwoKICAgICAgICAvLyBsb2FkIHVubG9hZGVkIGZpZWxkcwogICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICBPYmplY3QgZXJlcywgcHJvY2Vzc2VkOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGlmIChmbXNbaV0uaXNQcmltYXJ5S2V5KCkgfHwgc20u\nZ2V0TG9hZGVkKCkuZ2V0KGZtc1tpXS5nZXRJbmRleCgpKSkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g\nY2hlY2sgZm9yIGVhZ2VyIHJlc3VsdCwgYW5kIGlmIG5vdCBwcmVzZW50IGRv\nIHN0YW5kYXJkIGxvYWQKICAgICAgICAgICAgZXJlcyA9IHJlcy5nZXRFYWdl\ncihmbXNbaV0pOwogICAgICAgICAgICByZXMuc3RhcnREYXRhUmVxdWVzdChm\nbXNbaV0pOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICBpZiAo\nZXJlcyA9PSByZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWFnZXJU\nb01hbnkgPT0gbnVsbCAmJiBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBlYWdlclRvTWFueSA9IGZtc1tp\nXTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZtc1tpXS5sb2FkRWFnZXJKb2luKHNtLCB0aGlzLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0p\nLCByZXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcmVzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQgPSBmbXNbaV0u\nbG9hZEVhZ2VyUGFyYWxsZWwoc20sIHRoaXMsIAogICAgICAgICAgICAgICAg\nICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZXJlcyk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZCAhPSBlcmVzKQogICAgICAg\nICAgICAgICAgICAgICAgICByZXMucHV0RWFnZXIoZm1zW2ldLCBwcm9jZXNz\nZWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBib29sZWFuIGxhenlFbWJlZGRhYmxlID0gZm1zW2ldLmdldFZhbHVl\nTWFwcGluZygpLmlzRW1iZWRkZWQoKSAmJgogICAgICAgICAgICAgICAgICAg\nICAgICBmbXNbaV0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpICE9IG51bGwgJiYg\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoLnJlcXVpcmVzRmV0Y2go\nZm1zW2ldKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoIWxhenlFbWJlZGRhYmxlKSAgICAKICAg\nICAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmxvYWQoc20sIHRoaXMsIGZl\ndGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCByZXMpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\ncmVzLmVuZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAgIC8qKgog\nICAgICogRm9yIGltcGxlbWVudGF0aW9uIHVzZSBvbmx5LgogICAgICogUmV0\ndXJuIGEgc2VsZWN0IGZvciB0aGUgcHJvcGVyIG1hcHBpbmdzLiBSZXR1cm4g\nbnVsbCBpZiBubyBzZWxlY3QgaXMKICAgICAqIG5lZWRlZC4gVGhlIG1ldGhv\nZCBpcyBkZXNpZ25lZCB0byBiZSBjb21wbGVtZW50YXJ5IHRvIHRoZSBsb2Fk\nIG1ldGhvZHMuCiAgICAgKgogICAgICogQHBhcmFtIHNlbCBzZWxlY3QgdG8g\nYnVpbGQgb24KICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtYXBwaW5nIGZv\nciB0aGUgYmFzZSB0eXBlIHRvIHNlbGVjdCBmb3IKICAgICAqIEBwYXJhbSBz\ndWJzIHdoZXRoZXIgdGhlIHNlbGVjdCBtaWdodCBpbmNsdWRlIHN1YmNsYXNz\nZXMgb2YgdGhlCiAgICAgKiBnaXZlbiBtYXBwaW5nCiAgICAgKiBAcGFyYW0g\nc20gc3RhdGUgbWFuYWdlciBpZiBhbiBpbnN0YW5jZSBpcyBiZWluZyBsb2Fk\nZWQgb3IKICAgICAqIGluaXRpYWxpemVkLCBlbHNlIG51bGwKICAgICAqIEBw\nYXJhbSBmaWVsZHMgaWYgYSBzdGF0ZSBtYW5hZ2VyIGlzIGJlaW5nIGxvYWRl\nZCwgdGhlIHNldCBvZgogICAgICogZmllbGRzIHRoYXQgbXVzdCBiZSBsb2Fk\nZWQgaW4gb3JkZXIsIGVsc2UgbnVsbAogICAgICogQHBhcmFtIGZldGNoIHRo\nZSBmZXRjaCBjb25maWd1cmF0aW9uOyB1c2VkIGlmIG5vIHNwZWNpZmljIGZp\nZWxkcwogICAgICogbXVzdCBiZSBsb2FkZWQsIGFuZCB1c2VkIHdoZW4gc2Vs\nZWN0aW5nIHJlbGF0aW9ucwogICAgICogQHBhcmFtIGVhZ2VyIGVhZ2VyIGZl\ndGNoIG1vZGUgdG8gdXNlCiAgICAgKiBAcGFyYW0gaWRlbnQgd2hldGhlciB0\nbyBzZWxlY3QgcHJpbWFyeSBrZXkgY29sdW1ucyBhcyBkaXN0aW5jdAogICAg\nICogaWRlbnRpZmllcnMKICAgICAqIEBwYXJhbSBvdXRlciB3aGV0aGVyIHdl\nJ3JlIG91dGVyLWpvaW5pbmcgdG8gdGhpcyB0eXBlCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgZmFsc2Ugb3RoZXJ3\naXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTZWxlY3Qg\nc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YnMsCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgZWFnZXIsIGJv\nb2xlYW4gaWRlbnQsIGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAvLyBhZGQg\nY2xhc3MgY29uZGl0aW9ucyBzbyB0aGF0IHRoZXkncmUgY2xvbmVkIGZvciBh\nbnkgYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAgYm9vbGVhbiBqb2luZWRTdXBl\ncnMgPSBmYWxzZTsgICAgCiAgICAgICAgaWYobmVlZENsYXNzQ29uZGl0aW9u\nKG1hcHBpbmcsIHN1YnMsIHNtKSkgewogICAgICAgICAgICBqb2luZWRTdXBl\ncnMgPSBnZXRKb2luZWRTdXBlcnMoc2VsLCBtYXBwaW5nLCBzdWJzLCBvdXRl\ncik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGNyZWF0ZSBhbGwg\nb3VyIGVhZ2VyIHNlbGVjdHMgc28gdGhhdCB0aG9zZSBmaWVsZHMgYXJlIHJl\nc2VydmVkCiAgICAgICAgLy8gYW5kIGNhbm5vdCBiZSByZXVzZWQgZHVyaW5n\nIHRoZSBhY3R1YWwgZWFnZXIgc2VsZWN0IHByb2Nlc3MsCiAgICAgICAgLy8g\ncHJldmVudGluZyBpbmZpbml0ZSByZWN1cnNpb24KICAgICAgICBlYWdlciA9\nIE1hdGgubWluKGVhZ2VyLCBmZXRjaC5nZXRFYWdlckZldGNoTW9kZSgpKTsK\nICAgICAgICBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkgPSBjcmVhdGVFYWdl\nclNlbGVjdHMoc2VsLCBtYXBwaW5nLCBzbSwgZmllbGRzLAogICAgICAgICAg\nICBmZXRjaCwgZWFnZXIpOwoKICAgICAgICAvLyBzZWxlY3QgYWxsIGJhc2Ug\nY2xhc3MgbWFwcGluZ3M7IGRvIHRoaXMgYWZ0ZXIgYmF0Y2hpbmcgc28gdGhh\ndAogICAgICAgIC8vIHRoZSBqb2lucyBuZWVkZWQgYnkgdGhlc2Ugc2VsZWN0\ncyBkb24ndCBnZXQgaW4gdGhlIFdIRVJFIGNsYXVzZQogICAgICAgIC8vIG9m\nIHRoZSBiYXRjaGVkIHNlbGVjdHMKICAgICAgICBpbnQgc2VsZCA9IHNlbGVj\ndEJhc2VNYXBwaW5ncyhzZWwsIG1hcHBpbmcsIG1hcHBpbmcsIHNtLCBmaWVs\nZHMsCiAgICAgICAgICAgIGZldGNoLCBlYWdlciwgZWFnZXJUb01hbnksIGlk\nZW50LCBqb2luZWRTdXBlcnMpOwoKICAgICAgICAvLyBzZWxlY3QgZWFnZXIg\ndG8tbWFueSByZWxhdGlvbnMgbGFzdCBiZWNhdXNlIGR1cmluZyBsb2FkIHRo\nZXkKICAgICAgICAvLyBhZHZhbmNlIHRoZSByZXN1bHQgc2V0IGFuZCBjb3Vs\nZCBleGhhdXN0IGl0LCBzbyBubyBvdGhlciBtYXBwaW5ncwogICAgICAgIC8v\nIGNhbiBsb2FkIGFmdGVyd29yZHMKICAgICAgICBpZiAoZWFnZXJUb01hbnkg\nIT0gbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01hbnkuc2VsZWN0RWFnZXJK\nb2luKHNlbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgZmV0Y2gudHJh\ndmVyc2VKREJDKGVhZ2VyVG9NYW55KSwgZWFnZXIpOwoKICAgICAgICAvLyBv\ncHRpb25hbGx5IHNlbGVjdCBzdWJjbGFzcyBtYXBwaW5ncwogICAgICAgIGlm\nIChzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFIHx8IHN1YnMgPT0gU2Vs\nZWN0LlNVQlNfQU5ZX0pPSU5BQkxFKQogICAgICAgICAgICBzZWxlY3RTdWJj\nbGFzc01hcHBpbmdzKHNlbCwgbWFwcGluZywgc20sIGZldGNoKTsKICAgICAg\nICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0\nKGZhbHNlKTsKICAgICAgICByZXR1cm4gc2VsZCA+IDA7CiAgICB9CgogICAg\ncHJpdmF0ZSBib29sZWFuIGdldEpvaW5lZFN1cGVycyhTZWxlY3Qgc2VsLCBD\nbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YnMsIGJvb2xlYW4gb3V0ZXIp\nIHsKICAgICAgICBsb2FkU3ViY2xhc3NlcyhtYXBwaW5nKTsgCiAgICAgICAg\nSm9pbnMgam9pbnMgPSAob3V0ZXIpID8gc2VsLm5ld091dGVySm9pbnMoKSA6\nIG51bGw7CiAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRv\ncigpLmFkZENsYXNzQ29uZGl0aW9ucyhzZWwsIHN1YnMgPT0gU2VsZWN0LlNV\nQlNfSk9JTkFCTEUsIGpvaW5zKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBi\nb29sZWFuIG5lZWRDbGFzc0NvbmRpdGlvbihDbGFzc01hcHBpbmcgbWFwcGlu\nZywgaW50IHN1YnMsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkg\newogICAgICAgIGJvb2xlYW4gcmV0VmFsID0gZmFsc2U7CiAgICAgICAgaWYo\nc20gPT0gbnVsbCB8fCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5UUkFO\nU0lFTlQpIHsKICAgICAgICAgICAgaWYoc3VicyA9PSBTZWxlY3QuU1VCU19K\nT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5TVUJTX05PTkUpIHsKICAgICAg\nICAgICAgICAgIHJldFZhbCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobWFwcGluZy5nZXRE\naXNjcmltaW5hdG9yKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICYm\nIFN1cGVyY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3kuY2xhc3MuaXNJbnN0\nYW5jZShtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5nZXRTdHJhdGVneSgp\nKQogICAgICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0TWFwcGluZ1Jl\ncG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0aWJpbGl0\neUluc3RhbmNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmdldFN1cGVy\nY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3lCeURlZmF1bHQoKSkgewogICAg\nICAgICAgICAgICAgICAgIHJldFZhbCA9IHRydWU7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJl\ndFZhbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBNYXJrIHRoZSBmaWVs\nZHMgb2YgdGhpcyBtYXBwaW5nIGFzIHJlc2VydmVkIHNvIHRoYXQgZWFnZXIg\nZmV0Y2hlcyBjYW4ndAogICAgICogZ2V0IGludG8gaW5maW5pdGUgcmVjdXJz\naXZlIHNpdHVhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgRmllbGRNYXBw\naW5nIGNyZWF0ZUVhZ2VyU2VsZWN0cyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBp\nbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBC\naXRTZXQgZmllbGRzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIGludCBlYWdlcikgewogICAgICAgIGlmIChtYXBwaW5nID09IG51\nbGwgfHwgZWFnZXIgPT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9O\nT05FKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRmllbGRN\nYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNlbCwg\nCiAgICAgICAgICAgIG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCksIHNtLCBmaWVsZHMsIGZldGNoLCBlYWdlcik7CgogICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICBib29sZWFuIGluRWFnZXJKb2luID0gc2Vs\nLmhhc0VhZ2VySm9pbihmYWxzZSk7CiAgICAgICAgaW50IHNlbHM7CiAgICAg\nICAgaW50IGp0eXBlOwogICAgICAgIGludCBtb2RlOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIG1vZGUgPSBmbXNbaV0uZ2V0RWFnZXJGZXRjaE1vZGUoKTsKICAgICAgICAg\nICAgaWYgKG1vZGUgPT0gZmV0Y2guRUFHRVJfTk9ORSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoIXJlcXVpcmVzU2VsZWN0\nKGZtc1tpXSwgc20sIGZpZWxkcywgZmV0Y2gpKQogICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAvLyB0cnkgdG8gc2VsZWN0IHdpdGgg\nam9pbiBmaXJzdAogICAgICAgICAgICBqdHlwZSA9IChmbXNbaV0uZ2V0TnVs\nbFZhbHVlKCkgPT0gZm1zW2ldLk5VTExfRVhDRVBUSU9OKSAKICAgICAgICAg\nICAgICAgID8gc2VsLkVBR0VSX0lOTkVSIDogc2VsLkVBR0VSX09VVEVSOwog\nICAgICAgICAgICBpZiAobW9kZSAhPSBmZXRjaC5FQUdFUl9QQVJBTExFTCAm\nJiAhZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKQogICAgICAgICAgICAg\nICAgJiYgZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwganR5cGUsIHNtLCB0\naGlzLCBmZXRjaCkgPiAwCiAgICAgICAgICAgICAgICAmJiBzZWwuZWFnZXJD\nbG9uZShmbXNbaV0sIGp0eXBlLCBmYWxzZSwgMSkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgYm9vbGVhbiBoYXNK\nb2luID0gZmV0Y2guaGFzSm9pbihmbXNbaV0uZ2V0RnVsbE5hbWUoZmFsc2Up\nKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBkZWNsYXJlcyBhIHBy\nZWZlcnJlZCBzZWxlY3QgbW9kZSBvZiBqb2luIG9yIGRvZXMgbm90CiAgICAg\nICAgICAgIC8vIGhhdmUgYSBwcmVmZXJyZWQgbW9kZSBhbmQgd2UncmUgZG9p\nbmcgYSBieS1pZCBsb29rdXAsIHRyeQogICAgICAgICAgICAvLyB0byB1c2Ug\nYSB0by1tYW55IGpvaW4gYWxzby4gIGN1cnJlbnRseSB3ZSBsaW1pdCBlYWdl\ncgogICAgICAgICAgICAvLyBvdXRlciBqb2lucyB0byBub24tTFJTLCBub24t\ncmFuZ2VkIHNlbGVjdHMgdGhhdCBkb24ndCBhbHJlYWR5CiAgICAgICAgICAg\nIC8vIGhhdmUgYW4gZWFnZXIgdG8tbWFueSBqb2luCiAgICAgICAgICAgIGlm\nICgoaGFzSm9pbiB8fCBtb2RlID09IGZldGNoLkVBR0VSX0pPSU4gCiAgICAg\nICAgICAgICAgICB8fCAobW9kZSA9PSBmZXRjaC5ERUZBVUxUICYmIHNtICE9\nIG51bGwpKQogICAgICAgICAgICAgICAgJiYgZm1zW2ldLmlzRWFnZXJTZWxl\nY3RUb01hbnkoKQogICAgICAgICAgICAgICAgJiYgIWluRWFnZXJKb2luCiAg\nICAgICAgICAgICAgICAmJiAhc2VsLmhhc0VhZ2VySm9pbih0cnVlKQogICAg\nICAgICAgICAgICAgJiYgKCFzZWwuZ2V0QXV0b0Rpc3RpbmN0KCkgfHwgKCFz\nZWwuaXNMUlMoKQogICAgICAgICAgICAgICAgJiYgc2VsLmdldFN0YXJ0SW5k\nZXgoKSA9PSAwIAogICAgICAgICAgICAgICAgJiYgc2VsLmdldEVuZEluZGV4\nKCkgPT0gTG9uZy5NQVhfVkFMVUUpKQogICAgICAgICAgICAgICAgJiYgZm1z\nW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwganR5cGUsIHNtLCB0aGlzLCBmZXRj\naCkgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsLmVhZ2VyQ2xvbmUo\nZm1zW2ldLCBqdHlwZSwgdHJ1ZSwgMSkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBlYWdlclRvTWFueSA9IGZtc1tpXTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gZmluYWxseSwgdHJ5IHBhcmFsbGVsCiAg\nICAgICAgICAgIGlmIChlYWdlciA9PSBmZXRjaC5FQUdFUl9QQVJBTExFTAog\nICAgICAgICAgICAgICAgJiYgKHNlbHMgPSBmbXNbaV0uc3VwcG9ydHNTZWxl\nY3Qoc2VsLCBzZWwuRUFHRVJfUEFSQUxMRUwsIHNtLAogICAgICAgICAgICAg\nICAgdGhpcywgZmV0Y2gpKSAhPSAwKQogICAgICAgICAgICAgICAgc2VsLmVh\nZ2VyQ2xvbmUoZm1zW2ldLCBTZWxlY3QuRUFHRVJfUEFSQUxMRUwsIAogICAg\nICAgICAgICAgICAgICAgIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCks\nIHNlbHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZWFnZXJUb01hbnk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGdpdmVu\nIGZpZWxkIG5lZWRzIHRvIGJlIHNlbGVjdGVkLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBib29sZWFuIHJlcXVpcmVzU2VsZWN0KEZpZWxkTWFwcGlu\nZyBmbSwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQg\nZmllbGRzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgaWYgKGZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmll\nbGRzLmdldChmbS5nZXRJbmRleCgpKTsKICAgICAgICBpZiAoc20gIT0gbnVs\nbCAmJiBzbS5nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5UUkFOU0lFTlQKICAg\nICAgICAgICAgJiYgc20uZ2V0TG9hZGVkKCkuZ2V0KGZtLmdldEluZGV4KCkp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIGZl\ndGNoLnJlcXVpcmVzRmV0Y2goZm0pID09IEZldGNoQ29uZmlndXJhdGlvbi5G\nRVRDSF9MT0FEOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBm\naWVsZCBtYXBwaW5ncyBvZiB0aGUgZ2l2ZW4gY2xhc3MgYW5kIGFsbCBpdHMg\nc3VwZXJjbGFzc2VzLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgdGhlIHNl\nbGVjdCB0byB1c2UKICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtb3N0LWRl\ncml2ZWQgdHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gb3JpZyB0\naGUgb3JpZ2luYWwgbWFwcGluZyB0eXBlIHNlbGVjdGVkCiAgICAgKiBAcGFy\nYW0gc20gdGhlIGluc3RhbmNlIGJlaW5nIHNlbGVjdGVkIGZvciwgb3IgbnVs\nbCBpZiBub25lCiAgICAgKiBAcGFyYW0gZmllbGRzIHRoZSBmaWVsZHMgdG8g\nbG9hZAogICAgICogQHBhcmFtIGZldGNoIGZldGNoIGNvbmZpZ3VyYXRpb24g\ndG8gdXNlIGZvciBsb2FkaW5nIHJlbGF0aW9ucwogICAgICogQHBhcmFtIGVh\nZ2VyIHRoZSBlYWdlciBmZXRjaCBtb2RlIHRvIHVzZQogICAgICogQHBhcmFt\nIGpvaW5lZCB3aGV0aGVyIHRoZSBjbGFzcyBoYXMgYWxyZWFkeSBiZWVuIGpv\naW5lZCBkb3duIHRvCiAgICAgKiBpdHMgYmFzZSBjbGFzcwogICAgICogQHJl\ndHVybiAmZ3Q7IDAgaWYgdGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgMCBpZiBk\nYXRhIHdhcwogICAgICogc2VsZWN0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZCwg\nYW5kICZsdDsgMCBpZiBub3RoaW5nIHdhcyBzZWxlY3RlZAogICAgICovCiAg\nICBwcml2YXRlIGludCBzZWxlY3RCYXNlTWFwcGluZ3MoU2VsZWN0IHNlbCwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG9y\naWcsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnksCiAgICAgICAgYm9vbGVhbiBp\nZGVudCwgYm9vbGVhbiBqb2luZWQpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\ncGFyZW50ID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKTsKICAgICAgICBpZiAocGFyZW50ID09IG51bGwgJiYgIW1hcHBpbmcu\naXNNYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgbWFwcGlu\nZy4KICAgICAgICAgICAgICAgIGdldERlc2NyaWJlZFR5cGUoKSkpOwoKICAg\nICAgICBpbnQgc2VsZCA9IC0xOwogICAgICAgIGludCBwc2VsZCA9IC0xOwoK\nICAgICAgICAvLyBiYXNlIGNsYXNzIHNlbGVjdHMgcGtzLCBldGMKICAgICAg\nICBpZiAocGFyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgbm8g\naW5zdGFuY2UsIHNlbGVjdCBwa3MKICAgICAgICAgICAgaWYgKHNtID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmIChpZGVudCkKICAgICAgICAgICAg\nICAgICAgICBzZWwuc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLmdldFByaW1h\ncnlLZXlDb2x1bW5zKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHNlbC5zZWxlY3QobWFwcGluZy5nZXRQcmltYXJ5S2V5\nQ29sdW1ucygpKTsKICAgICAgICAgICAgICAgIHNlbGQgPSAxOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSBvciBub3Qg\naW5pdGlhbGl6ZWQgYW5kIG5vdCBleGFjdCBvaWQsIHNlbGVjdCB0eXBlCiAg\nICAgICAgICAgIGlmICgoc20gPT0gbnVsbCB8fCAoc20uZ2V0UENTdGF0ZSgp\nID09IFBDU3RhdGUuVFJBTlNJRU5UIAogICAgICAgICAgICAgICAgJiYgKCEo\nc20uZ2V0T2JqZWN0SWQoKSBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgCiAgICAg\nICAgICAgICAgICB8fCAoKE9wZW5KUEFJZCkgc20uZ2V0T2JqZWN0SWQoKSku\naGFzU3ViY2xhc3NlcygpKSkpCiAgICAgICAgICAgICAgICAmJiBtYXBwaW5n\nLmdldERpc2NyaW1pbmF0b3IoKS5zZWxlY3Qoc2VsLCBvcmlnKSkKICAgICAg\nICAgICAgICAgIHNlbGQgPSAxOwoKICAgICAgICAgICAgLy8gaWYgbm8gaW5z\ndGFuY2Ugb3Igbm8gdmVyc2lvbiwgc2VsZWN0IHZlcnNpb24KICAgICAgICAg\nICAgaWYgKChzbSA9PSBudWxsIHx8IHNtLmdldFZlcnNpb24oKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXRWZXJzaW9uKCkuc2Vs\nZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWN1cnNlIG9uIHBhcmVu\ndAogICAgICAgICAgICBwc2VsZCA9IHNlbGVjdEJhc2VNYXBwaW5ncyhzZWws\nIHBhcmVudCwgb3JpZywgc20sIGZpZWxkcywKICAgICAgICAgICAgICAgIGZl\ndGNoLCBlYWdlciwgZWFnZXJUb01hbnksIGlkZW50LCBqb2luZWQpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gc2VsZWN0IHRoZSBtYXBwaW5ncyBpbiB0aGUg\nZ2l2ZW4gZmllbGRzIHNldCwgb3IgYmFzZWQgb24gZmV0Y2gKICAgICAgICAv\nLyBjb25maWd1cmF0aW9uIGlmIG5vIGZpZWxkcyBnaXZlbgogICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICBTZWxlY3RFeGVjdXRvciBlc2VsOwogICAgICAg\nIGludCBmc2VsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBza2lwIGVhZ2VyIHRvLW1h\nbnkgc2VsZWN0OyB3ZSBkbyB0aGF0IHNlcGFyYXRlbHkgaW4gY2FsbGluZwog\nICAgICAgICAgICAvLyBtZXRob2QKICAgICAgICAgICAgaWYgKGZtc1tpXSA9\nPSBlYWdlclRvTWFueSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgLy8gY2hlY2sgZm9yIGVhZ2VyIHNlbGVjdAogICAgICAgICAg\nICBlc2VsID0gc2VsLmdldEVhZ2VyKGZtc1tpXSk7CiAgICAgICAgICAgIGlm\nIChlc2VsICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChlc2VsID09\nIHNlbCkKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJK\nb2luKHNlbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRj\naC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5zZWxlY3RFYWdl\nclBhcmFsbGVsKGVzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAg\nICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAg\nICAgICAgICAgIHNlbGQgPSBNYXRoLm1heCgwLCBzZWxkKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChyZXF1aXJlc1NlbGVjdChmbXNbaV0sIHNtLCBmaWVs\nZHMsIGZldGNoKSkgewogICAgICAgICAgICAgICAgZnNlbGQgPSBmbXNbaV0u\nc2VsZWN0KHNlbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgCWZldGNo\nLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAg\nICBzZWxkID0gTWF0aC5tYXgoZnNlbGQsIHNlbGQpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKG9wdFNlbGVjdChmbXNbaV0sIHNlbCwgc20sIGZldGNoKSkg\newogICAgICAgICAgICAgICAgZnNlbGQgPSBmbXNbaV0uc2VsZWN0KHNlbCwg\nc20sIHRoaXMsIAogICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRC\nQyhmbXNbaV0pLCBmZXRjaC5FQUdFUl9OT05FKTsKCiAgICAgICAgICAgICAg\nICAvLyBkb24ndCB1cGdyYWRlIHNlbGQgdG8gPiAwIGJhc2VkIG9uIHRoZXNl\nIGZpZWxkcywgc2luY2UKICAgICAgICAgICAgICAgIC8vIHRoZXkncmUgbm90\nIGluIHRoZSBjYWxjdWxhdGVkIGZpZWxkIHNldAogICAgICAgICAgICAgICAg\naWYgKGZzZWxkID49IDAgJiYgc2VsZCA8IDApCiAgICAgICAgICAgICAgICAg\nICAgc2VsZCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIGluIGNlcnRhaW4gY2lyY3Vtc3RhbmNlcyBmb3JjZSBqb2luIHRvIHN1\ncGVyY2xhc3MgdGFibGUgdG8gYXZvaWQKICAgICAgICAvLyBTUUwgZ2VuZXJh\ndGlvbiBlcnJvci4KICAgICAgICBpZiAoIGVhZ2VyVG9NYW55ICE9IG51bGwg\nJiYgcHNlbGQgPCAwICYmIHNlbGQgPiAwICYmICFqb2luZWQKICAgICAgICAg\nICAgICAgICYmIHBhcmVudCAhPSBudWxsICkgewogICAgICAgICAgICBGaWVs\nZE1hcHBpbmdbXSBwZm1zID0gcGFyZW50LmdldERlZmluZWRGaWVsZE1hcHBp\nbmdzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGZtcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBmbXNbaV0gPT0g\nZWFnZXJUb01hbnkgKSB7CiAgICAgICAgICAgICAgICAgICAgcHNlbGQgPSAw\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8v\nIGpvaW4gdG8gcGFyZW50IHRhYmxlIGlmIHRoZSBwYXJlbnQgLyBhbnkgYW5j\nZXN0b3JzIGhhdmUgc2VsZWN0ZWQKICAgICAgICAvLyBhbnl0aGluZwogICAg\nICAgIGlmICgham9pbmVkICYmIHBzZWxkID49IDAgJiYgcGFyZW50LmdldFRh\nYmxlKCkgIT0gbWFwcGluZy5nZXRUYWJsZSgpKQogICAgICAgICAgICBzZWwu\nd2hlcmUobWFwcGluZy5qb2luU3VwZXJjbGFzcyhzZWwubmV3Sm9pbnMoKSwg\nZmFsc2UpKTsKCiAgICAgICAgLy8gcmV0dXJuIHRoZSBoaWdoZXN0IHZhbHVl\nCiAgICAgICAgcmV0dXJuIE1hdGgubWF4KHBzZWxkLCBzZWxkKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZW4gc2VsZWN0aW5nIGZpZWxkZXMsIGEgc3Bl\nY2lhbCBjYXNlIGlzIG1hZGUgZm9yIG1hcHBpbmdzIHRoYXQgdXNlCiAgICAg\nKiAyLXBhcnQgc2VsZWN0cyB0aGF0IGFyZW4ndCBleHBsaWNpdGx5ICpub3Qq\nIGluIHRoZSBkZmcgc28gdGhhdCB0aGV5CiAgICAgKiBjYW4gZ2V0IHRoZWly\nIHByaW1hcnkgdGFibGUgZGF0YS4gVGhpcyBtZXRob2QgdGVzdHMgZm9yIHRo\nYXQgc3BlY2lhbAogICAgICogY2FzZSBhcyBhbiBvcHRpbWl6YXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBvcHRTZWxlY3QoRmllbGRNYXBw\naW5nIGZtLCBTZWxlY3Qgc2VsLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAg\nICByZXR1cm4gIWZtLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAg\nICAgICAmJiAhZm0uaXNEZWZhdWx0RmV0Y2hHcm91cEV4cGxpY2l0KCkKICAg\nICAgICAgICAgJiYgKHNtID09IG51bGwgfHwgc20uZ2V0UENTdGF0ZSgpID09\nIFBDU3RhdGUuVFJBTlNJRU5UIAogICAgICAgICAgICB8fCAhc20uZ2V0TG9h\nZGVkKCkuZ2V0KGZtLmdldEluZGV4KCkpKQogICAgICAgICAgICAmJiBmbS5z\ndXBwb3J0c1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhp\ncywgZmV0Y2gpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBm\naWVsZCBtYXBwaW5ncyB0aGF0IG1hdGNoIHRoZSBnaXZlbiBmZXRjaCBjb25m\naWd1cmF0aW9uIGZvcgogICAgICogc3ViY2xhc3NlcyBvZiB0aGUgZ2l2ZW4g\ndHlwZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3QgdG8g\ndXNlCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgdHlwZSB3aG9zZSBzdWJj\nbGFzc2VzIHRvIHNlbGVjdAogICAgICogQHBhcmFtIHNtIHRoZSBpbnN0YW5j\nZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9uZQogICAgICog\nQHBhcmFtIGZldGNoIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBzZWxlY3RTdWJjbGFzc01hcHBpbmdzKFNlbGVj\ndCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gp\nIHsKICAgICAgICBsb2FkU3ViY2xhc3NlcyhtYXBwaW5nKTsKICAgICAgICBD\nbGFzc01hcHBpbmdbXSBzdWJNYXBwaW5ncyA9IG1hcHBpbmcuZ2V0Sm9pbmFi\nbGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsKICAgICAgICBpZiAoc3ViTWFwcGlu\nZ3MubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gc2VsZWN0IGFsbCBzdWJjbGFzcyBtYXBwaW5ncyB0aGF0IG1hdGNoIHRo\nZSBmZXRjaCBjb25maWd1cmF0aW9uCiAgICAgICAgLy8gYW5kIHdob3NlIHRh\nYmxlIGlzIGluIHRoZSBsaXN0IG9mIHRob3NlIHNlbGVjdGVkIHNvIGZhcjsg\ndGhpcwogICAgICAgIC8vIHdheSB3ZSBzZWxlY3QgdGhlIG1heCBwb3NzaWJs\nZSB3aXRob3V0IHNlbGVjdGluZyBhbnkgdGFibGVzIHRoYXQKICAgICAgICAv\nLyBhcmVuJ3QgcHJlc2VudCBpbiBhbGwgcG9zc2libGUgcXVlcnkgbWF0Y2hl\nczsgYSBzcGVjaWFsIGNhc2UKICAgICAgICAvLyBpcyBtYWRlIGZvciBtYXBw\naW5ncyB0aGF0IHVzZSAyLXBhcnQgc2VsZWN0cyB0aGF0IGFyZW4ndAogICAg\nICAgIC8vIGV4cGxpY2l0bHkgKm5vdCogaW4gdGhlIGRlZmF1bHQgc28gdGhh\ndCB0aGV5IGNhbiBnZXQgdGhlaXIKICAgICAgICAvLyBwcmltYXJ5IHRhYmxl\nIGRhdGEKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXM7CiAgICAgICAgYm9v\nbGVhbiBqb2luZWQ7CiAgICAgICAgYm9vbGVhbiBjYW5Kb2luID0gX2RpY3Qu\nam9pblN5bnRheCAhPSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFM\nCiAgICAgICAgICAgICYmIGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKG1h\ncHBpbmcpICE9IGZldGNoLkVBR0VSX05PTkU7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBzdWJNYXBwaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoIXN1Yk1hcHBpbmdzW2ldLnN1cHBvcnRzRWFnZXJTZWxlY3Qo\nc2VsLCBzbSwgdGhpcywgbWFwcGluZywKICAgICAgICAgICAgICAgIGZldGNo\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8g\naW5pdGlhbGl6ZSBzbyB0aGF0IGlmIHdlIGNhbid0IGpvaW4sIHdlIHByZXRl\nbmQgd2UgYWxyZWFkeSBoYXZlCiAgICAgICAgICAgIGpvaW5lZCA9ICFjYW5K\nb2luOwogICAgICAgICAgICBmbXMgPSBzdWJNYXBwaW5nc1tpXS5nZXREZWZp\nbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0g\nMDsgaiA8IGZtcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIGluIG9uZSBvZiBjb25maWd1cmVkIGZldGNoIGdyb3Vwcwog\nICAgICAgICAgICAJaWYgKGZldGNoLnJlcXVpcmVzRmV0Y2goZm1zW2pdKSAh\nPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9BRAogICAgICAgICAgICAg\nICAgICAgICYmICgoIWZtc1tqXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAK\nICAgICAgICAgICAgICAgICAgICAmJiBmbXNbal0uaXNEZWZhdWx0RmV0Y2hH\ncm91cEV4cGxpY2l0KCkpCiAgICAgICAgICAgICAgICAgICAgfHwgZm1zW2pd\nLnN1cHBvcnRzU2VsZWN0KHNlbCwgc2VsLlRZUEVfVFdPX1BBUlQsIHNtLCB0\naGlzLCAKICAgICAgICAgICAgICAgICAgICBmZXRjaCkgPD0gMCkpIAogICAg\nICAgICAgICAJCWNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdl\nIGNhbiBqb2luIHRvIHRoZSBzdWJjbGFzcywgZG8gc287IG11Y2ggYmV0dGVy\nIGNoYW5jZQogICAgICAgICAgICAgICAgLy8gdGhhdCB0aGUgZmllbGQgd2ls\nbCBiZSBhYmxlIHRvIHNlbGVjdCBpdHNlbGYgd2l0aG91dCBqb2lucwogICAg\nICAgICAgICAgICAgaWYgKCFqb2luZWQpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyBtYXJrIGpvaW5lZCB3aGV0aGVyIG9yIG5vdCB3ZSBqb2luLCBzbyB3\nZSBkb24ndCBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgLy8gdGVzdCBj\nb25kaXRpb25zIGFnYWluIGZvciB0aGlzIHN1YmNsYXNzCiAgICAgICAgICAg\nICAgICAgICAgam9pbmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBz\nZWwud2hlcmUoam9pblN1YmNsYXNzKHNlbCwgbWFwcGluZywgc3ViTWFwcGlu\nZ3NbaV0sIG51bGwpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAvLyBpZiBjYW4gc2VsZWN0IHdpdGggdGFibGVzIGFscmVhZHkgc2Vs\nZWN0ZWQsIGRvIGl0CiAgICAgICAgICAgICAgICBpZiAoZm1zW2pdLnN1cHBv\ncnRzU2VsZWN0KHNlbCwgc2VsLlRZUEVfSk9JTkxFU1MsIHNtLCB0aGlzLAog\nICAgICAgICAgICAgICAgICAgIGZldGNoKSA+IDApCiAgICAgICAgICAgICAg\nICAgICAgZm1zW2pdLnNlbGVjdChzZWwsIG51bGwsIHRoaXMsIGZldGNoLnRy\nYXZlcnNlSkRCQyhmbXNbal0pLAogICAgICAgICAgICAgICAgICAgICAgICBm\nZXRjaC5FQUdFUl9OT05FKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gam9pbiBmcm9t\nIGNsYXNzIHRvIGl0cyBzdWJjbGFzcy4gUmVjdXJzaXZlIHRvIGFsbG93CiAg\nICAgKiBmb3IgbXVsdGlwbGUgaG9wcywgc3RhcnRpbmcgZnJvbSB0aGUgYmFz\nZSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSm9pbnMgam9p\nblN1YmNsYXNzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBiYXNlLAogICAg\nICAgIENsYXNzTWFwcGluZyBzdWIsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\naWYgKHN1YiA9PSBiYXNlIHx8IHN1Yi5nZXRUYWJsZSgpID09IGJhc2UuZ2V0\nVGFibGUoKQogICAgICAgICAgICB8fCBzZWwuaXNTZWxlY3RlZChzdWIuZ2V0\nVGFibGUoKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAv\nLyByZWN1cnNlIGZpcnN0IHNvIHdlIGdvIGxlYXN0LT5tb3N0IGRlcml2ZWQK\nICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gc3ViLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGpvaW5zID0gam9pblN1YmNs\nYXNzKHNlbCwgYmFzZSwgc3VwLCBqb2lucyk7CiAgICAgICAgaWYgKGpvaW5z\nID09IG51bGwpCiAgICAgICAgICAgIGpvaW5zID0gc2VsLm5ld0pvaW5zKCk7\nCiAgICAgICAgcmV0dXJuIHN1Yi5qb2luU3VwZXJjbGFzcyhqb2lucywgdHJ1\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlcyBzdXJlIGFsbCBzdWJj\nbGFzc2VzIG9mIHRoZSBnaXZlbiB0eXBlIGFyZSBsb2FkZWQgaW4gdGhlIEpW\nTS4KICAgICAqIFRoaXMgaXMgdXN1YWxseSBkb25lIGF1dG9tYXRpY2FsbHku\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGxvYWRTdWJjbGFzc2VzKENsYXNz\nTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgRGlzY3JpbWluYXRvciBkc2Mg\nPSBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICBpZiAoZHNj\nLmdldFN1YmNsYXNzZXNMb2FkZWQoKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAvLyBpZiB0aGUgc3ViY2xhc3MgbGlzdCBpcyBzZXQsIG5vIG5l\nZWQgdG8gbG9hZCBzdWJzCiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0UmVwb3Np\ndG9yeSgpLmdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsCiAgICAgICAg\nICAgIF9jdHguZ2V0Q2xhc3NMb2FkZXIoKSkgIT0gbnVsbCkgewogICAgICAg\nICAgICBkc2Muc2V0U3ViY2xhc3Nlc0xvYWRlZCh0cnVlKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgZHNjLmxvYWRTdWJjbGFzc2VzKHRoaXMpOwogICAgICAgIH0gY2F0Y2gg\nKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNYWtlIHRoZSBzdGF0ZW1lbnQgYSBjYW5kaWRh\ndGUgZm9yIGNhbmNlbGxhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7CiAg\nICAgICAgX3N0bW50cy5hZGQoc3RtbnQpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIHRoZSBzdGF0ZW1lbnQgZnJvbSB0aGUgY2FuY2VsbGFibGUg\nc2V0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWZ0ZXJFeGVjdXRlU3Rh\ndGVtZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9zdG1udHMucmVt\nb3ZlKHN0bW50KTsKICAgIH0KICAgIAogICAgRmluZGVyUXVlcnlJbXBsIGdl\ndEZpbmRlcihDbGFzc01hcHBpbmcgbWFwcGluZywgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKSB7CiAgICAgICAgRmluZGVyQ2FjaGUgY2FjaGUgPSBnZXRG\naW5kZXJDYWNoZSgpOwogICAgICAgIHJldHVybiBjYWNoZSA9PSBudWxsIAog\nICAgICAgICAgICAgPyBudWxsIDogKEZpbmRlclF1ZXJ5SW1wbCljYWNoZS5n\nZXQobWFwcGluZywgZmV0Y2gpOwogICAgfQogICAgCiAgICBib29sZWFuIGNh\nY2hlRmluZGVyKENsYXNzTWFwcGluZyBtYXBwaW5nLCBTZWxlY3RFeGVjdXRv\nciBzZWxlY3QsIAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIEZpbmRlckNhY2hlIGNhY2hlID0gZ2V0RmluZGVyQ2FjaGUo\nKTsKICAgICAgICByZXR1cm4gY2FjaGUgIT0gbnVsbCAmJiBjYWNoZS5jYWNo\nZShtYXBwaW5nLCBzZWxlY3QsIGZldGNoKSAhPSBudWxsOwogICAgfQogICAg\nCiAgICBGaW5kZXJDYWNoZSBnZXRGaW5kZXJDYWNoZSgpIHsKICAgICAgICBy\nZXR1cm4gKCgoQnJva2VySW1wbClnZXRDb250ZXh0KCkpLmdldENhY2hlRmlu\nZGVyUXVlcnkoKSkKICAgICAgICAgICAgID8gZ2V0Q29uZmlndXJhdGlvbigp\nLmdldEZpbmRlckNhY2hlSW5zdGFuY2UoKSA6IG51bGw7CiAgICB9CgoKICAg\nIC8qKgogICAgICogQ29ubmVjdGlvbiByZXR1cm5lZCB0byBjbGllbnQgY29k\nZS4gTWFrZXMgc3VyZSBpdHMgd3JhcHBlZCBjb25uZWN0aW9uCiAgICAgKiBy\nZWYgY291bnQgaXMgZGVjcmVtZW50ZWQgb24gZmluYWxpemUuCiAgICAgKi8K\nICAgIHB1YmxpYyBhYnN0cmFjdCBzdGF0aWMgY2xhc3MgQ2xpZW50Q29ubmVj\ndGlvbiBleHRlbmRzCiAgICAgICAgICAgIERlbGVnYXRpbmdDb25uZWN0aW9u\nIHsKCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsK\nCiAgICAgICAgcHVibGljIENsaWVudENvbm5lY3Rpb24oQ29ubmVjdGlvbiBj\nb25uKSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgICAgIHN1\ncGVyLmNsb3NlKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9p\nZCBmaW5hbGl6ZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICBpZiAoIV9jbG9zZWQpCiAgICAgICAgICAgICAgICBjbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gd3JhcHBl\nciB0aGF0IGtlZXBzIGFuIGludGVybmFsIHJlZiBjb3VudCBzbyB0aGF0IGl0\nIGtub3dzCiAgICAgKiB3aGVuIHRvIHJlYWxseSBjbG9zZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGFic3RyYWN0IGNsYXNzIFJlZkNvdW50Q29ubmVjdGlv\nbiBleHRlbmRzIERlbGVnYXRpbmdDb25uZWN0aW9uIHsKCiAgICAgICAgcHJp\ndmF0ZSBib29sZWFuIF9yZXRhaW4gPSBmYWxzZTsKICAgICAgICBwcml2YXRl\nIGludCBfcmVmcyA9IDA7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9mcmVl\nZCA9IGZhbHNlOwoKICAgICAgICBwdWJsaWMgUmVmQ291bnRDb25uZWN0aW9u\nKENvbm5lY3Rpb24gY29ubikgewogICAgICAgICAgICBzdXBlcihjb25uKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFpbigp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXRhaW47CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzZXRSZXRhaW4oYm9vbGVhbiByZXRhaW4pIHsK\nICAgICAgICAgICAgaWYgKF9yZXRhaW4gJiYgIXJldGFpbiAmJiBfcmVmcyA8\nPSAwKQogICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAgICAgICBfcmV0\nYWluID0gcmV0YWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\ncmVmKCkgewogICAgICAgICAgICAvLyBkb24ndCBoYXZlIHRvIGxvY2s7IGNh\nbGxlZCBmcm9tIGNvbm5lY3QoKSwgd2hpY2ggaXMgbG9ja2VkCiAgICAgICAg\nICAgIF9yZWZzKys7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBj\nbG9zZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAvLyBs\nb2NrIGF0IGJyb2tlciBsZXZlbCB0byBhdm9pZCBkZWFkbG9ja3MKICAgICAg\nICAgICAgX2N0eC5sb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBfcmVmcy0tOwogICAgICAgICAgICAgICAgaWYgKF9yZWZzIDw9\nIDAgJiYgIV9yZXRhaW4pCiAgICAgICAgICAgICAgICAgICAgZnJlZSgpOwog\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2N0eC51\nbmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoK\nICAgICAgICAgKiBOb24tdGhyZWFkLXNhZmUgbWV0aG9kLiAgRW5zdXJlIHBy\nb3RlY3Rpb24gaW4gdGhlIGNhbGwgcGF0aC4uLgogICAgICAgICAqLwogICAg\nICAgIHB1YmxpYyB2b2lkIGZyZWUoKSB7CiAgICAgICAgICAgIC8vIGVuc3Vy\nZSB0aGF0IHdlIGRvIG5vdCBjbG9zZSB0aGUgdW5kZXJseWluZyBjb25uZWN0\naW9uCiAgICAgICAgICAgIC8vIG11bHRpcGxlIHRpbWVzOyB0aGlzIGNvdWxk\nIGhhcHBlbiBpZiBzb21lb25lIChlLmcuLCBhbgogICAgICAgICAgICAvLyBF\neHRlbnQpIGhvbGRzIGEgUmVmQ29ubmVjdGlvbiwgYW5kIHRoZW4gY2xvc2Vz\nIGl0IChlLmcuLCBpbgogICAgICAgICAgICAvLyB0aGUgZmluYWxpemVyKSBh\nZnRlciB0aGUgU3RvcmVNYW5hZ2VyIGhhcyBhbHJlYWR5IGJlZW4gY2xvc2Vk\nLgogICAgICAgICAgICBpZiAoX2ZyZWVkKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdldERl\nbGVnYXRlKCkuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2ZyZWVk\nID0gdHJ1ZTsKICAgICAgICAgICAgX2Nvbm4gPSBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQo\nYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2Uo\nY2FuY2VsU3RhdGVtZW50SW1wbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLAog\nICAgICAgICAgICAgICAgICAgIHN1cGVyLmNyZWF0ZVN0YXRlbWVudChmYWxz\nZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAg\nICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCBy\nc1R5cGUsIGludCByc0NvbmN1ciwKICAgICAgICAgICAgYm9vbGVhbiB3cmFw\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIENv\nbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UoY2FuY2VsU3RhdGVt\nZW50SW1wbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLAogICAgICAgICAgICAg\nICAgICAgIHN1cGVyLmNyZWF0ZVN0YXRlbWVudChyc1R5cGUsIHJzQ29uY3Vy\nLCBmYWxzZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJl\nU3RhdGVtZW50KFN0cmluZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBD\nb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFByZXBh\ncmVkU3RhdGVtZW50SW1wbCwKICAgICAgICAgICAgICAgICAgICBKREJDU3Rv\ncmVNYW5hZ2VyLnRoaXMsIHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLCBm\nYWxzZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9Cgog\nICAgICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3Rh\ndGVtZW50KFN0cmluZyBzcWwsIGludCByc1R5cGUsCiAgICAgICAgICAgIGlu\ndCByc0NvbmN1ciwgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3Iu\nbmV3SW5zdGFuY2UKICAgICAgICAgICAgICAgIChjYW5jZWxQcmVwYXJlZFN0\nYXRlbWVudEltcGwsCiAgICAgICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFu\nYWdlci50aGlzLCBzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgcnNUeXBl\nLCByc0NvbmN1ciwgZmFsc2UpLAogICAgICAgICAgICAgICAgICAgIFJlZkNv\ndW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJlbW92ZXMg\naXRzZWxmIGZyb20gdGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0YXRlbWVu\ndHMgc28gdGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBjbGFzcyBDYW5jZWxTdGF0ZW1lbnQgZXh0ZW5k\ncyBEZWxlZ2F0aW5nU3RhdGVtZW50IHsKCiAgICAgICAgcHVibGljIENhbmNl\nbFN0YXRlbWVudChTdGF0ZW1lbnQgc3RtbnQsIENvbm5lY3Rpb24gY29ubikg\newogICAgICAgICAgICBzdXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGV4ZWN1dGVVcGRhdGUoU3RyaW5nIHNxbCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1\ndGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVj\ndXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJp\nbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50\nKHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmV4ZWN1dGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3Rh\ndGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCBy\nZW1vdmVzIGl0c2VsZiBmcm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBz\ndGF0ZW1lbnRzIHNvIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgY2xhc3MgQ2FuY2VsUHJlcGFyZWRT\ndGF0ZW1lbnQgZXh0ZW5kcwogICAgICAgICAgICBEZWxlZ2F0aW5nUHJlcGFy\nZWRTdGF0ZW1lbnQgewoKICAgICAgICBwdWJsaWMgQ2FuY2VsUHJlcGFyZWRT\ndGF0ZW1lbnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgICAg\nICBDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoc3RtbnQs\nIGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBleGVjdXRl\nVXBkYXRlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJl\nZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZSgp\nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0\nZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVy\neShib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVR\ndWVyeSh3cmFwKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludFtdIGV4ZWN1dGVC\nYXRjaCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZv\ncmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVCYXRjaCgpOwog\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJF\neGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQp9Cgo=\n","encoding":"base64"}

