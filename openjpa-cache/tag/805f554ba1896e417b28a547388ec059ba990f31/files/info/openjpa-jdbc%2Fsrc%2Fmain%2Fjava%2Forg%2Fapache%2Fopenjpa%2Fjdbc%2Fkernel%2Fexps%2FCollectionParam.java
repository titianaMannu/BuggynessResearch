{"sha":"5bcaa41c2b619baef027d031390a49ba29b6fe8a","node_id":"MDQ6QmxvYjIwNjM2NDo1YmNhYTQxYzJiNjE5YmFlZjAyN2QwMzEzOTBhNDliYTI5YjZmZThh","size":7084,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5bcaa41c2b619baef027d031390a49ba29b6fe8a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5EaXNjcmltaW5hdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlNRTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuUGFyYW1ldGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CgovKioKICogQSBjb2xsZWN0aW9u\nLXZhbHVlZCBpbnB1dCBwYXJhbWV0ZXIgaW4gYW4gaW4tZXhwcmVzc2lvbi4K\nICoKICogQGF1dGhvciBDYXRhbGluYSBXZWkKICovCnB1YmxpYyBjbGFzcyBD\nb2xsZWN0aW9uUGFyYW0KICAgIGV4dGVuZHMgQ29uc3QKICAgIGltcGxlbWVu\ndHMgUGFyYW1ldGVyIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoCiAgICAgICAgQ29s\nbGVjdGlvblBhcmFtLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIE9iamVj\ndCBfa2V5OwogICAgcHJpdmF0ZSBDbGFzcyBfdHlwZSA9IG51bGw7CiAgICBw\ncml2YXRlIGludCBfaWR4ID0gLTE7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Nv\nbnRhaW5lciA9IGZhbHNlOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3Iu\nIFN1cHBseSBwYXJhbWV0ZXIgbmFtZSBhbmQgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIENvbGxlY3Rpb25QYXJhbShPYmplY3Qga2V5LCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgX2tleSA9IGtleTsKICAgICAgICBzZXRJbXBsaWNpdFR5\ncGUodHlwZSk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb25QYXJhbSBj\nbG9uZSgpIHsKICAgICAgICBDb2xsZWN0aW9uUGFyYW0gYyA9IG5ldyBDb2xs\nZWN0aW9uUGFyYW0odGhpcy5fa2V5LCB0aGlzLl90eXBlKTsKICAgICAgICBj\nLl9pZHggPSB0aGlzLl9pZHg7CiAgICAgICAgYy5fY29udGFpbmVyID0gdGhp\ncy5fY29udGFpbmVyOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZ2V0UGFyYW1ldGVyS2V5KCkgewogICAgICAgIHJldHVy\nbiBfa2V5OwogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKCkgewog\nICAgICAgIHJldHVybiBfdHlwZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRJbXBsaWNpdFR5cGUoQ2xhc3MgdHlwZSkgewogICAgICAgIF90eXBlID0g\ndHlwZTsKICAgICAgICBfY29udGFpbmVyID0gKGdldE1ldGFEYXRhKCkgPT0g\nbnVsbCB8fCAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKAogICAgICAgICAg\nICBnZXRNZXRhRGF0YSgpLmdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0\naW9uKCksIHR5cGUpKQogICAgICAgICAgICAmJiAoQ29sbGVjdGlvbi5jbGFz\ncy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpCiAgICAgICAgICAgIHx8IE1hcC5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKTsKICAgIH0KCiAgICBwdWJs\naWMgaW50IGdldEluZGV4KCkgewogICAgICAgIHJldHVybiBfaWR4OwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldEluZGV4KGludCBpZHgpIHsKICAgICAg\nICBfaWR4ID0gaWR4OwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VmFs\ndWUoT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIEZpbHRlcnMu\nY29udmVydChwYXJhbXNbX2lkeF0sIGdldFR5cGUoKSk7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBnZXRWYWx1ZShFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUpIHsKICAgICAgICBQYXJhbUV4cFN0YXRlIHBzdGF0ZSA9IChQ\nYXJhbUV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmRpc2NW\nYWx1ZVswXSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFz\nTGlzdChwc3RhdGUuZGlzY1ZhbHVlKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHJldHVybiBnZXRWYWx1ZShjdHgucGFyYW1zKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFNRTFZhbHVlKFNlbGVjdCBzZWwsIEV4cENvbnRl\neHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSkgewogICAgICAgIHJldHVybiAoKFBh\ncmFtRXhwU3RhdGUpIHN0YXRlKS5zcWxWYWx1ZTsKICAgIH0KCiAgICBwdWJs\naWMgRXhwU3RhdGUgaW5pdGlhbGl6ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0\nIGN0eCwgaW50IGZsYWdzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQYXJhbUV4\ncFN0YXRlKGN0eC5wYXJhbXNbX2lkeF0pOwogICAgfQoKICAgIC8qKgogICAg\nICogRXhwcmVzc2lvbiBzdGF0ZS4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBjbGFzcyBQYXJhbUV4cFN0YXRlCiAgICAgICAgZXh0ZW5kcyBDb25zdEV4\ncFN0YXRlIHsKCiAgICAgICAgcHVibGljIGludCBzaXplID0gMDsKICAgICAg\nICBwdWJsaWMgT2JqZWN0W10gc3FsVmFsdWUgPSBudWxsOwogICAgICAgIHB1\nYmxpYyBpbnRbXSBvdGhlckxlbmd0aDsKICAgICAgICBwdWJsaWMgQ2xhc3NN\nYXBwaW5nW10gbWFwcGluZyA9IG51bGw7CiAgICAgICAgcHVibGljIERpc2Ny\naW1pbmF0b3JbXSBkaXNjID0gbnVsbDsKICAgICAgICBwdWJsaWMgT2JqZWN0\nIGRpc2NWYWx1ZVtdID0gbnVsbDsKICAgICAgICAKICAgICAgICBQYXJhbUV4\ncFN0YXRlKE9iamVjdCBwYXJhbXMpIHsKICAgICAgICAgICAgaWYgKHBhcmFt\ncyBpbnN0YW5jZW9mIENvbGxlY3Rpb24pCiAgICAgICAgICAgICAgICBzaXpl\nID0gKChDb2xsZWN0aW9uKSBwYXJhbXMpLnNpemUoKTsKICAgICAgICAgICAg\nc3FsVmFsdWUgPSBuZXcgT2JqZWN0W3NpemVdOwogICAgICAgICAgICBvdGhl\nckxlbmd0aCA9IG5ldyBpbnRbc2l6ZV07CiAgICAgICAgICAgIG1hcHBpbmcg\nPSBuZXcgQ2xhc3NNYXBwaW5nW3NpemVdOwogICAgICAgICAgICBkaXNjID0g\nbmV3IERpc2NyaW1pbmF0b3Jbc2l6ZV07CiAgICAgICAgICAgIGRpc2NWYWx1\nZSA9IG5ldyBPYmplY3Rbc2l6ZV07CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBzcWxWYWx1\nZVtpXSA9IG51bGw7CiAgICAgICAgICAgICAgICBvdGhlckxlbmd0aFtpXSA9\nIDE7CiAgICAgICAgICAgICAgICBtYXBwaW5nW2ldID0gbnVsbDsKICAgICAg\nICAgICAgICAgIGRpc2NbaV0gPSBudWxsOwogICAgICAgICAgICAgICAgZGlz\nY1ZhbHVlW2ldID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0gCgogICAgcHVibGljIHZvaWQgY2FsY3VsYXRlVmFsdWUoU2VsZWN0IHNl\nbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBW\nYWwgb3RoZXIsIEV4cFN0YXRlIG90aGVyU3RhdGUpIHsKICAgICAgICBzdXBl\nci5jYWxjdWxhdGVWYWx1ZShzZWwsIGN0eCwgc3RhdGUsIG90aGVyLCBvdGhl\nclN0YXRlKTsKICAgICAgICBQYXJhbUV4cFN0YXRlIHBzdGF0ZSA9IChQYXJh\nbUV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBPYmplY3QgdmFsdWUgPSBnZXRW\nYWx1ZShjdHgucGFyYW1zKTsKCiAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFu\nY2VvZiBDb2xsZWN0aW9uKSkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAg\nICJub3QtY29sbGVjdGlvbi1wYXJtIiwgX2tleSkudG9TdHJpbmcoKSk7Cgog\nICAgICAgIGlmICgoKENvbGxlY3Rpb24pIHZhbHVlKS5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24o\nX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAiZW1wdHktY29sbGVjdGlvbi1w\nYXJtIiwgX2tleSkudG9TdHJpbmcoKSk7CgogICAgICAgIEl0ZXJhdG9yIGl0\nciA9ICgoQ29sbGVjdGlvbikgdmFsdWUpLml0ZXJhdG9yKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwc3RhdGUuc2l6ZSAmJiBpdHIuaGFzTmV4\ndCgpOyBpKyspIHsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgIGlmIChvdGhlciAhPSBudWxsICYmICFfY29udGFp\nbmVyKSB7CiAgICAgICAgICAgICAgICBwc3RhdGUuc3FsVmFsdWVbaV0gPSBv\ndGhlci50b0RhdGFTdG9yZVZhbHVlKHNlbCwgY3R4LAogICAgICAgICAgICAg\nICAgICAgIG90aGVyU3RhdGUsIHZhbCk7CiAgICAgICAgICAgICAgICBwc3Rh\ndGUub3RoZXJMZW5ndGhbaV0gPSBvdGhlci5sZW5ndGgoc2VsLCBjdHgsIG90\naGVyU3RhdGUpOwogICAgICAgICAgICAgICAgaWYgKG90aGVyIGluc3RhbmNl\nb2YgVHlwZSkgewogICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5tYXBwaW5n\nW2ldID0gY3R4LnN0b3JlLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAg\nICAgICAgICAgICBnZXRNYXBwaW5nUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0\nTWFwcGluZygoQ2xhc3MpIHZhbCwKICAgICAgICAgICAgICAgICAgICAgICAg\nY3R4LnN0b3JlLmdldENvbnRleHQoKS5nZXRDbGFzc0xvYWRlcigpLCB0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBwc3RhdGUuZGlzY1tpXSA9IHBzdGF0\nZS5tYXBwaW5nW2ldLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICAgICAg\nICAgICAgICBwc3RhdGUuZGlzY1ZhbHVlW2ldID0gcHN0YXRlLmRpc2MgIT0g\nbnVsbCA/CiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5kaXNjW2ld\nLmdldFZhbHVlKCkgOiBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9IGVsc2UgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKHZhbCkp\nIHsKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gY3R4\nLnN0b3JlLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgIGdl\ndE1hcHBpbmdSZXBvc2l0b3J5SW5zdGFuY2UoKS5nZXRNYXBwaW5nKHZhbC5n\nZXRDbGFzcygpLAogICAgICAgICAgICAgICAgICAgIGN0eC5zdG9yZS5nZXRD\nb250ZXh0KCkuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CiAgICAgICAgICAg\nICAgICBwc3RhdGUuc3FsVmFsdWVbaV0gPSBtYXBwaW5nLnRvRGF0YVN0b3Jl\nVmFsdWUodmFsLAogICAgICAgICAgICAgICAgICAgIG1hcHBpbmcuZ2V0UHJp\nbWFyeUtleUNvbHVtbnMoKSwgY3R4LnN0b3JlKTsKICAgICAgICAgICAgICAg\nIHBzdGF0ZS5vdGhlckxlbmd0aFtpXSA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKS5sZW5ndGg7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgcHN0YXRlLnNxbFZhbHVlW2ldID0gdmFsOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRUbyhTZWxlY3Qgc2VsLCBF\neHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1\nZmZlciBzcWwsIGludCBpbmRleCkgewogICAgICAgIFBhcmFtRXhwU3RhdGUg\ncHN0YXRlID0gKFBhcmFtRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgcHN0YXRlLnNpemU7IGkrKykgewogICAgICAgICAg\nICBpZiAocHN0YXRlLm90aGVyTGVuZ3RoW2ldID4gMSkKICAgICAgICAgICAg\nICAgIHNxbC5hcHBlbmRWYWx1ZSgoKE9iamVjdFtdKSBwc3RhdGUuc3FsVmFs\ndWVbaV0pW2luZGV4XSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0\nZS5nZXRDb2x1bW4oaW5kZXgpLCB0aGlzKTsKICAgICAgICAgICAgZWxzZSBp\nZiAocHN0YXRlLmNvbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNxbC5h\ncHBlbmRWYWx1ZShwc3RhdGUuc3FsVmFsdWVbaV0sIHBzdGF0ZS5nZXRDb2x1\nbW4oaW5kZXgpLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzKTsKICAg\nICAgICAgICAgZWxzZSBpZiAocHN0YXRlLmRpc2NWYWx1ZVtpXSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgc3FsLmFwcGVuZFZhbHVlKHBzdGF0ZS5kaXNj\nVmFsdWVbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\ncWwuYXBwZW5kVmFsdWUocHN0YXRlLnNxbFZhbHVlW2ldLCBwc3RhdGUuZ2V0\nQ29sdW1uKGluZGV4KSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyk7\nCiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

