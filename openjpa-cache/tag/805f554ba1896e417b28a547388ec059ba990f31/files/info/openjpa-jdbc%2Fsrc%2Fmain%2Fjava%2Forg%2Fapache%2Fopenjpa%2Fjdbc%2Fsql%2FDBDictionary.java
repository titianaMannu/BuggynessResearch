{"sha":"1bea4cd4cbe5d8cb6f94d38eed4168ca82687a15","node_id":"MDQ6QmxvYjIwNjM2NDoxYmVhNGNkNGNiZTVkOGNiNmY5NGQzOGVlZDQxNjhjYTgyNjg3YTE1","size":199042,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1bea4cd4cbe5d8cb6f94d38eed4168ca82687a15","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7\nCmltcG9ydCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc3Fs\nLkFycmF5OwppbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3Fs\nLkNsb2I7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2\nYS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVmOwppbXBvcnQgamF2\nYS5zcWwuUmVzdWx0U2V0OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5zcWwuU1FMV2FybmluZzsKaW1wb3J0IGphdmEuc3Fs\nLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZh\nLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0\nIGphdmEudGV4dC5NZXNzYWdlRm9ybWF0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkVudW1TZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtl\nZEhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5Mb2NhbGU7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlm\naWVyLkNvbHVtbkRlZklkZW50aWZpZXJSdWxlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5Ob3JtYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZp\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVy\nLkRCSWRlbnRpZmllclJ1bGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllclV0aWw7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllci5E\nQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhwQ29udGV4\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkV4cFN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2Vy\nbmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5OdWxsOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2YVNRTFR5cGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5EYXRhU291\ncmNlRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLk5hbWVTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuRktNYXBL\nZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0\nZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlNl\ncTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRo\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5pZGVu\ndGlmaWVyLklkZW50aWZpZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5pZGVudGlmaWVyLklkZW50aWZpZXJSdWxlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5pZGVudGlmaWVyLklkZW50\naWZpZXJVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJj\nLkNvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmpkYmMuTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbkluZm87\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZh\nbGlkU3RhdGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Mb2NrRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuT2JqZWN0RXhpc3RzRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlF1ZXJ5RXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUmVmZXJl\nbnRpYWxJbnRlZ3JpdHlFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5TZXJpYWxpemF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgppbXBvcnQg\nc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQ2xhc3Mgd2hpY2ggYWxsb3dz\nIHRoZSBjcmVhdGlvbiBvZiBTUUwgZHluYW1pY2FsbHksIGluIGEKICogZGF0\nYWJhc2UgYWdub3N0aWMgZmFzaGlvbi4gU3ViY2xhc3MgZm9yIHRoZSBudWFu\nY2VzIG9mIGRpZmZlcmVudCBkYXRhIHN0b3Jlcy4KICovCnB1YmxpYyBjbGFz\ncyBEQkRpY3Rpb25hcnkKICAgIGltcGxlbWVudHMgQ29uZmlndXJhYmxlLCBD\nb25uZWN0aW9uRGVjb3JhdG9yLCBKb2luU3ludGF4ZXMsCiAgICBMb2dnaW5n\nQ29ubmVjdGlvbkRlY29yYXRvci5TUUxXYXJuaW5nSGFuZGxlciwgSWRlbnRp\nZmllckNvbmZpZ3VyYXRpb24gewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIFZFTkRPUl9PVEhFUiA9ICJvdGhlciI7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIFN0cmluZyBWRU5ET1JfREFUQURJUkVDVCA9ICJkYXRhZGly\nZWN0IjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFf\nQ0FTRV9VUFBFUiA9IElkZW50aWZpZXJVdGlsLkNBU0VfVVBQRVI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9MT1dFUiA9\nIElkZW50aWZpZXJVdGlsLkNBU0VfTE9XRVI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9QUkVTRVJWRSA9IElkZW50aWZp\nZXJVdGlsLkNBU0VfUFJFU0VSVkU7CgogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgQ09OU19OQU1FX0JFRk9SRSA9ICJiZWZvcmUiOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX01JRCA9ICJtaWQi\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX0FG\nVEVSID0gImFmdGVyIjsKICAgIAogICAgcHVibGljIGludCBibG9iQnVmZmVy\nU2l6ZSA9IDUwMDAwOwogICAgcHVibGljIGludCBjbG9iQnVmZmVyU2l6ZSA9\nIDUwMDAwOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdF\nX1BPU1RfU0VMRUNUID0gMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BSRV9ESVNUSU5DVCA9IDE7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIGludCBSQU5HRV9QT1NUX0RJU1RJTkNUID0gMjsKICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BPU1RfTE9DSyA9IDM7\nCgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFOTyA9IDE7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBNSUNSTyA9IE5BTk8gKiAx\nMDAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTUlMTEkgPSBN\nSUNSTyAqIDEwMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBD\nRU5USSA9IE1JTExJICogMTA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBERUNJID0gTUlMTEkgKiAxMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBTRUMgPSBNSUxMSSAqIDEwMDA7CgogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgTkFNRV9BTlkgPSBEQklkZW50aWZpZXJVdGls\nLkFOWTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IE5BTUVfVEFC\nTEUgPSBEQklkZW50aWZpZXJVdGlsLlRBQkxFOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgTkFNRV9TRVFVRU5DRSA9IERCSWRlbnRpZmllclV0\naWwuU0VRVUVOQ0U7CiAgICAKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFVOTElNSVRFRCA9IC0xOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5h\nbCBpbnQgTk9fQkFUQ0ggPSAwOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0cmluZyBaRVJPX0RBVEVfU1RSID0KICAgICAgICAiJyIgKyBuZXcgamF2\nYS5zcWwuRGF0ZSgwKSArICInIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0cmluZyBaRVJPX1RJTUVfU1RSID0gIiciICsgbmV3IFRpbWUoMCkgKyAi\nJyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgWkVST19USU1F\nU1RBTVBfU1RSID0KICAgICAgICAiJyIgKyBuZXcgVGltZXN0YW1wKDApICsg\nIiciOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9j\nID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoREJEaWN0aW9uYXJ5\nLmNsYXNzKTsKCiAgICAvLyBzY2hlbWEgZGF0YQogICAgcHVibGljIFN0cmlu\nZyBwbGF0Zm9ybSA9ICJHZW5lcmljIjsKICAgIHB1YmxpYyBTdHJpbmcgZHJp\ndmVyVmVuZG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIGNyZWF0ZVBy\naW1hcnlLZXlzID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgY29uc3RyYWlu\ndE5hbWVNb2RlID0gQ09OU19OQU1FX0JFRk9SRTsKICAgIHB1YmxpYyBpbnQg\nbWF4VGFibGVOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhD\nb2x1bW5OYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhDb25z\ndHJhaW50TmFtZUxlbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQgbWF4SW5k\nZXhOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJbmRleGVz\nUGVyVGFibGUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzRm9yZWlnbktleXMgPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNQYXJhbWV0ZXJJblNlbGVjdCA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c0ZvcmVpZ25LZXlzQ29tcG9zaXRlID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzVW5pcXVlQ29uc3Ry\nYWludHMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWZl\ncnJlZENvbnN0cmFpbnRzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzUmVzdHJpY3REZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRlRGVsZXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbERlbGV0ZUFjdGlvbiA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RlZmF1bHREZWxl\ndGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNS\nZXN0cmljdFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0Nhc2NhZGVVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVXBkYXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmYXVsdFVwZGF0ZUFjdGlv\nbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFi\nbGVXaXRoQWRkQ29sdW1uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzQWx0ZXJUYWJsZVdpdGhEcm9wQ29sdW1uID0gdHJ1ZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzQ29tbWVudHMgPSBmYWxzZTsKICAgIHB1\nYmxpYyBCb29sZWFuIHN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cyA9IG51bGw7\nCiAgICBwdWJsaWMgU3RyaW5nIHJlc2VydmVkV29yZHMgPSBudWxsOwogICAg\ncHVibGljIFN0cmluZyBzeXN0ZW1TY2hlbWFzID0gbnVsbDsKICAgIHB1Ymxp\nYyBTdHJpbmcgc3lzdGVtVGFibGVzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJp\nbmcgc2VsZWN0V29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBmaXhl\nZFNpemVUeXBlTmFtZXMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzY2hl\nbWFDYXNlID0gU0NIRU1BX0NBU0VfVVBQRVI7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzZXRTdHJpbmdSaWdodFRydW5jYXRpb25PbiA9IHRydWU7CgogICAgLy8g\nc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZhbGlkYXRpb25TUUwgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBjbG9zZVBvb2xTUUwgPSBudWxsOwogICAgcHVi\nbGljIFN0cmluZyBpbml0aWFsaXphdGlvblNRTCA9IG51bGw7CiAgICBwdWJs\naWMgaW50IGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7CiAgICBwdWJsaWMg\nU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9ICJMRUZUIE9VVEVSIEpPSU4iOwog\nICAgcHVibGljIFN0cmluZyBpbm5lckpvaW5DbGF1c2UgPSAiSU5ORVIgSk9J\nTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNyb3NzSm9pbkNsYXVzZSA9ICJDUk9T\nUyBKT0lOIjsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ29uZGl0aW9u\nRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5nIGZvclVw\nZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcg\ndGFibGVGb3JVcGRhdGVDbGF1c2UgPSBudWxsOwogICAgcHVibGljIFN0cmlu\nZyBkaXN0aW5jdENvdW50Q29sdW1uU2VwYXJhdG9yID0gbnVsbDsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5j\ndENsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xv\nY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMgPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aE9yZGVyQ2xhdXNlID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhPdXRlckpv\naW4gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nV2l0aElubmVySm9pbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRpbWVvdXQgPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc2ltdWxhdGVMb2NraW5nID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNlbGVjdCA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJlbGF0ZWRTdWJzZWxlY3QgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNIYXZpbmcgPSB0cnVlOwog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0g\nZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1NlbGVjdEVuZElu\nZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgaW50IHJhbmdlUG9zaXRpb24gPSBS\nQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVz\nQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFu\nIHJlcXVpcmVzVGFyZ2V0Rm9yRGVsZXRlID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c011bHRpcGxlTm9udHJhbnNhY3Rpb25h\nbFJlc3VsdFNldHMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWly\nZXNTZWFyY2hTdHJpbmdFc2NhcGVGb3JMaWtlID0gdHJ1ZTsKICAgIHB1Ymxp\nYyBTdHJpbmcgc2VhcmNoU3RyaW5nRXNjYXBlID0gIlxcIjsKICAgIHB1Ymxp\nYyBib29sZWFuIHJlcXVpcmVzQ2FzdEZvck1hdGhGdW5jdGlvbnMgPSBmYWxz\nZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ2FzdEZvckNvbXBhcmlz\nb25zID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c01vZE9w\nZXJhdG9yID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1hN\nTENvbHVtbiA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHND\nYXNlQ29udmVyc2lvbkZvckxvYiA9IGZhbHNlOwogICAgcHVibGljIGJvb2xl\nYW4gcmVwb3J0c1N1Y2Nlc3NOb0luZm9PbkJhdGNoVXBkYXRlcyA9IGZhbHNl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTZWxlY3RGcm9tRmluYWxU\nYWJsZSA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTaW1w\nbGVDYXNlRXhwcmVzc2lvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0dlbmVyYWxDYXNlRXhwcmVzc2lvbiA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiB1c2VXaWxkQ2FyZEZvckNvdW50ID0gZmFsc2U7CiAgICAK\nICAgIC8qKgogICAgICogU29tZSBEYXRhYmFzZXMgYXBwZW5kIHdoaXRlc3Bh\nY2UgYWZ0ZXIgdGhlIHNjaGVtYSBuYW1lIAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiB0cmltU2NoZW1hTmFtZSA9IGZhbHNlOwoKICAgIC8vIGZ1bmN0\naW9ucwogICAgcHVibGljIFN0cmluZyBjYXN0RnVuY3Rpb24gPSAiQ0FTVCh7\nMH0gQVMgezF9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvTG93ZXJDYXNlRnVu\nY3Rpb24gPSAiTE9XRVIoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvVXBw\nZXJDYXNlRnVuY3Rpb24gPSAiVVBQRVIoezB9KSI7CiAgICBwdWJsaWMgU3Ry\naW5nIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkNIQVJfTEVOR1RIKHswfSki\nOwogICAgcHVibGljIFN0cmluZyBiaXRMZW5ndGhGdW5jdGlvbiA9ICIoT0NU\nRVRfTEVOR1RIKHswfSkgKiA4KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRyaW1M\nZWFkaW5nRnVuY3Rpb24gPSAiVFJJTShMRUFESU5HIHsxfSBGUk9NIHswfSki\nOwogICAgcHVibGljIFN0cmluZyB0cmltVHJhaWxpbmdGdW5jdGlvbiA9ICJU\nUklNKFRSQUlMSU5HIHsxfSBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmlu\nZyB0cmltQm90aEZ1bmN0aW9uID0gIlRSSU0oQk9USCB7MX0gRlJPTSB7MH0p\nIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVGdW5jdGlvbiA9ICIo\nezB9fHx7MX0pIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVEZWxp\nbWl0ZXIgPSAiJ09QRU5KUEFUT0tFTiciOwogICAgcHVibGljIFN0cmluZyBz\ndWJzdHJpbmdGdW5jdGlvbk5hbWUgPSAiU1VCU1RSSU5HIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgY3VycmVudERhdGVGdW5jdGlvbiA9ICJDVVJSRU5UX0RBVEUi\nOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50VGltZUZ1bmN0aW9uID0gIkNV\nUlJFTlRfVElNRSI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnRUaW1lc3Rh\nbXBGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUVTVEFNUCI7CiAgICBwdWJsaWMg\nU3RyaW5nIGRyb3BUYWJsZVNRTCA9ICJEUk9QIFRBQkxFIHswfSI7CgogICAg\nLy8gdHlwZXMKICAgIHB1YmxpYyBib29sZWFuIHN0b3JhZ2VMaW1pdGF0aW9u\nc0ZhdGFsID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yZUxhcmdl\nTnVtYmVyc0FzU3RyaW5ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\nc3RvcmVDaGFyc0FzTnVtYmVycyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VHZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9v\nbGVhbiB1c2VTZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiB1c2VHZXRPYmplY3RGb3JCbG9icyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gdXNlR2V0U3RyaW5nRm9yQ2xvYnMgPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHVzZVNldFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7\nCiAgICBwdWJsaWMgaW50IG1heEVtYmVkZGVkQmxvYlNpemUgPSAtMTsKICAg\nIHB1YmxpYyBpbnQgbWF4RW1iZWRkZWRDbG9iU2l6ZSA9IC0xOwogICAgcHVi\nbGljIGludCBpbkNsYXVzZUxpbWl0ID0gLTE7CiAgICBwdWJsaWMgaW50IGRh\ndGVQcmVjaXNpb24gPSBNSUxMSTsKICAgIHB1YmxpYyBpbnQgY2hhcmFjdGVy\nQ29sdW1uU2l6ZSA9IDI1NTsKICAgIHB1YmxpYyBTdHJpbmcgYXJyYXlUeXBl\nTmFtZSA9ICJBUlJBWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpZ2ludFR5cGVO\nYW1lID0gIkJJR0lOVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJpbmFyeVR5cGVO\nYW1lID0gIkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpdFR5cGVOYW1l\nID0gIkJJVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJsb2JUeXBlTmFtZSA9ICJC\nTE9CIjsKICAgIHB1YmxpYyBTdHJpbmcgYm9vbGVhblR5cGVOYW1lID0gIkJP\nT0xFQU4iOwogICAgcHVibGljIFN0cmluZyBjaGFyVHlwZU5hbWUgPSAiQ0hB\nUiI7CiAgICBwdWJsaWMgU3RyaW5nIGNsb2JUeXBlTmFtZSA9ICJDTE9CIjsK\nICAgIHB1YmxpYyBTdHJpbmcgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOwogICAg\ncHVibGljIFN0cmluZyBkZWNpbWFsVHlwZU5hbWUgPSAiREVDSU1BTCI7CiAg\nICBwdWJsaWMgU3RyaW5nIGRpc3RpbmN0VHlwZU5hbWUgPSAiRElTVElOQ1Qi\nOwogICAgcHVibGljIFN0cmluZyBkb3VibGVUeXBlTmFtZSA9ICJET1VCTEUi\nOwogICAgcHVibGljIFN0cmluZyBmbG9hdFR5cGVOYW1lID0gIkZMT0FUIjsK\nICAgIHB1YmxpYyBTdHJpbmcgaW50ZWdlclR5cGVOYW1lID0gIklOVEVHRVIi\nOwogICAgcHVibGljIFN0cmluZyBqYXZhT2JqZWN0VHlwZU5hbWUgPSAiSkFW\nQV9PQkpFQ1QiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyYmluYXJ5VHlw\nZU5hbWUgPSAiTE9OR1ZBUkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGxv\nbmdWYXJjaGFyVHlwZU5hbWUgPSAiTE9OR1ZBUkNIQVIiOwogICAgcHVibGlj\nIFN0cmluZyBudWxsVHlwZU5hbWUgPSAiTlVMTCI7CiAgICBwdWJsaWMgU3Ry\naW5nIG51bWVyaWNUeXBlTmFtZSA9ICJOVU1FUklDIjsKICAgIHB1YmxpYyBT\ndHJpbmcgb3RoZXJUeXBlTmFtZSA9ICJPVEhFUiI7CiAgICBwdWJsaWMgU3Ry\naW5nIHJlYWxUeXBlTmFtZSA9ICJSRUFMIjsKICAgIHB1YmxpYyBTdHJpbmcg\ncmVmVHlwZU5hbWUgPSAiUkVGIjsKICAgIHB1YmxpYyBTdHJpbmcgc21hbGxp\nbnRUeXBlTmFtZSA9ICJTTUFMTElOVCI7CiAgICBwdWJsaWMgU3RyaW5nIHN0\ncnVjdFR5cGVOYW1lID0gIlNUUlVDVCI7CiAgICBwdWJsaWMgU3RyaW5nIHRp\nbWVUeXBlTmFtZSA9ICJUSU1FIjsKICAgIHB1YmxpYyBTdHJpbmcgdGltZXN0\nYW1wVHlwZU5hbWUgPSAiVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcg\ndGlueWludFR5cGVOYW1lID0gIlRJTllJTlQiOwogICAgcHVibGljIFN0cmlu\nZyB2YXJiaW5hcnlUeXBlTmFtZSA9ICJWQVJCSU5BUlkiOwogICAgcHVibGlj\nIFN0cmluZyB2YXJjaGFyVHlwZU5hbWUgPSAiVkFSQ0hBUiI7CiAgICBwdWJs\naWMgU3RyaW5nIHhtbFR5cGVOYW1lID0gIlhNTCI7CiAgICBwdWJsaWMgU3Ry\naW5nIHhtbFR5cGVFbmNvZGluZyA9ICJVVEYtOCI7CiAgICBwdWJsaWMgU3Ry\naW5nIGdldFN0cmluZ1ZhbCA9ICIiOwoKICAgIC8vIHNjaGVtYSBtZXRhZGF0\nYQogICAgcHVibGljIGJvb2xlYW4gdXNlU2NoZW1hTmFtZSA9IHRydWU7CiAg\nICBwdWJsaWMgU3RyaW5nIHRhYmxlVHlwZXMgPSAiVEFCTEUiOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRUYWJsZXMgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRDb2x1\nbW5zID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRh\nYmxlRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c051bGxUYWJsZUZvckdldFByaW1hcnlLZXlzID0gZmFsc2U7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4\nSW5mbyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxs\nVGFibGVGb3JHZXRJbXBvcnRlZEtleXMgPSBmYWxzZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHVzZUdldEJlc3RSb3dJZGVudGlmaWVyRm9yUHJpbWFyeUtleXMg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQXV0b0NvbW1p\ndEZvck1ldGFEYXRhID0gZmFsc2U7CgogICAgLy8gYXV0by1pbmNyZW1lbnQK\nICAgIHB1YmxpYyBpbnQgbWF4QXV0b0Fzc2lnbk5hbWVMZW5ndGggPSAzMTsK\nICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fzc2lnbkNsYXVzZSA9IG51bGw7CiAg\nICBwdWJsaWMgU3RyaW5nIGF1dG9Bc3NpZ25UeXBlTmFtZSA9IG51bGw7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0F1dG9Bc3NpZ24gPSBmYWxzZTsK\nICAgIHB1YmxpYyBTdHJpbmcgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgbmV4dFNlcXVlbmNlUXVlcnkgPSBudWxs\nOwogICAgcHVibGljIFN0cmluZyBzZXF1ZW5jZVNRTCA9IG51bGw7CiAgICBw\ndWJsaWMgU3RyaW5nIHNlcXVlbmNlU2NoZW1hU1FMID0gbnVsbDsKICAgIHB1\nYmxpYyBTdHJpbmcgc2VxdWVuY2VOYW1lU1FMID0gbnVsbDsKICAgIC8vIG1v\nc3QgbmF0aXZlIHNlcXVlbmNlcyBjYW4gYmUgcnVuIGluc2lkZSB0aGUgYnVz\naW5lc3MgdHJhbnNhY3Rpb24KICAgIHB1YmxpYyBpbnQgbmF0aXZlU2VxdWVu\nY2VUeXBlPSBTZXEuVFlQRV9DT05USUdVT1VTOwoKICAgIHByb3RlY3RlZCBK\nREJDQ29uZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAgIHByb3RlY3RlZCBM\nb2cgbG9nID0gbnVsbDsKICAgIHByb3RlY3RlZCBib29sZWFuIGNvbm5lY3Rl\nZCA9IGZhbHNlOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNKREJDMyA9IGZh\nbHNlOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldDxTdHJpbmc+IHJlc2VydmVk\nV29yZFNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIC8vIHJlc2Vy\ndmVkV29yZFNldCBzdWJzZXQgdGhhdCBDQU5OT1QgYmUgdXNlZCBhcyB2YWxp\nZCBjb2x1bW4gbmFtZXMKICAgIC8vIChpLmUuLCB3aXRob3V0IHN1cnJvdW5k\naW5nIHRoZW0gd2l0aCBkb3VibGUtcXVvdGVzKQogICAgcHJvdGVjdGVkIFNl\ndDxTdHJpbmc+IGludmFsaWRDb2x1bW5Xb3JkU2V0ID0gbmV3IEhhc2hTZXQ8\nU3RyaW5nPigpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldDxTdHJpbmc+IHN5\nc3RlbVNjaGVtYVNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIHBy\nb3RlY3RlZCBmaW5hbCBTZXQ8U3RyaW5nPiBzeXN0ZW1UYWJsZVNldCA9IG5l\ndyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQ8\nU3RyaW5nPiBmaXhlZFNpemVUeXBlTmFtZVNldCA9IG5ldyBIYXNoU2V0PFN0\ncmluZz4oKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQ8U3RyaW5nPiB0eXBl\nTW9kaWZpZXJTZXQgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CgogICAgLy8g\nTmFtaW5nQ29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzCiAgICBwcml2YXRlIGJv\nb2xlYW4gZGVsaW1pdElkZW50aWZpZXJzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzID0gdHJ1ZTsK\nICAgIHB1YmxpYyBTdHJpbmcgbGVhZGluZ0RlbGltaXRlciA9ICJcIiI7CiAg\nICBwdWJsaWMgU3RyaW5nIHRyYWlsaW5nRGVsaW1pdGVyID0gIlwiIjsKICAg\nIHB1YmxpYyBTdHJpbmcgbmFtZUNvbmNhdGVuYXRvciA9ICJfIjsKICAgIHB1\nYmxpYyBTdHJpbmcgZGVsaW1pdGVkQ2FzZSA9IFNDSEVNQV9DQVNFX1BSRVNF\nUlZFOwogICAgcHVibGljIFN0cmluZyBjYXRhbG9nU2VwYXJhdG9yID0gIi4i\nOwogICAgcHJpdmF0ZSBTdHJpbmcgZGVmYXVsdFNjaGVtYU5hbWUgPSBudWxs\nOwogICAgcHJpdmF0ZSBTdHJpbmcgY29udmVyc2lvbktleSA9IG51bGw7CiAg\nICAgICAKICAgIC8vIE5hbWluZyB1dGlsaXR5IGFuZCBuYW1pbmcgcnVsZXMK\nICAgIHByaXZhdGUgREJJZGVudGlmaWVyVXRpbCBuYW1pbmdVdGlsID0gbnVs\nbDsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgSWRlbnRpZmllclJ1bGU+IG5h\nbWluZ1J1bGVzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBJZGVudGlmaWVyUnVs\nZT4oKTsKICAgIHByaXZhdGUgSWRlbnRpZmllclJ1bGUgZGVmYXVsdE5hbWlu\nZ1J1bGUgPSBudWxsOyAgLy8gY2FjaGVkIGZvciBwZXJmb3JtYW5jZQogICAg\nCiAgICAvKioKICAgICAqIElmIGEgbmF0aXZlIHF1ZXJ5IGJlZ2lucyB3aXRo\nIGFueSBvZiB0aGUgdmFsdWVzIGZvdW5kIGhlcmUgdGhlbiBpdCB3aWxsCiAg\nICAgKiBiZSB0cmVhdGVkIGFzIGEgc2VsZWN0IHN0YXRlbWVudC4gIAogICAg\nICovCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHNlbGVjdFdvcmRTZXQgPSBu\nZXcgSGFzaFNldCgpOwoKICAgIC8vIHdoZW4gd2Ugc3RvcmUgdmFsdWVzIHRo\nYXQgbG9zZSBwcmVjaXNpb24sIHRyYWNrIHRoZSB0eXBlcyBzbyB0aGF0IHRo\nZQogICAgLy8gZmlyc3QgdGltZSBpdCBoYXBwZW5zIHdlIGNhbiB3YXJuIHRo\nZSB1c2VyCiAgICBwcml2YXRlIFNldCBfcHJlY2lzaW9uV2FybmVkVHlwZXMg\nPSBudWxsOwoKICAgIC8vIGJhdGNoTGltaXQgdmFsdWU6CiAgICAvLyAtMSA9\nIHVubGltaXRlZAogICAgLy8gMCAgPSBubyBiYXRjaAogICAgLy8gYW55IHBv\nc2l0aXZlIG51bWJlciA9IGJhdGNoIGxpbWl0CiAgICBwdWJsaWMgaW50IGJh\ndGNoTGltaXQgPSBOT19CQVRDSDsKICAgIAogICAgcHVibGljIGZpbmFsIE1h\ncDxJbnRlZ2VyLFNldDxTdHJpbmc+PiBzcWxTdGF0ZUNvZGVzID0gCiAgICAg\nICAgbmV3IEhhc2hNYXA8SW50ZWdlciwgU2V0PFN0cmluZz4+KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAg\nIHB1YmxpYyBEQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgZml4ZWRTaXplVHlw\nZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewog\nICAgICAgICAgICAiQklHSU5UIiwgIkJJVCIsICJCTE9CIiwgIkNMT0IiLCAi\nREFURSIsICJERUNJTUFMIiwgIkRJU1RJTkNUIiwKICAgICAgICAgICAgIkRP\nVUJMRSIsICJGTE9BVCIsICJJTlRFR0VSIiwgIkpBVkFfT0JKRUNUIiwgIk5V\nTEwiLCAiTlVNRVJJQyIsIAogICAgICAgICAgICAiT1RIRVIiLCAiUkVBTCIs\nICJSRUYiLCAiU01BTExJTlQiLCAiU1RSVUNUIiwgIlRJTUUiLCAiVElNRVNU\nQU1QIiwKICAgICAgICAgICAgIlRJTllJTlQiLAogICAgICAgIH0pKTsKICAg\nICAgICAKICAgICAgICBzZWxlY3RXb3JkU2V0LmFkZCgiU0VMRUNUIik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hl\nbiB0aGUgZGljdGlvbmFyeSBmaXJzdCBzZWVzIGFueSBjb25uZWN0aW9uLgog\nICAgICogSXQgaXMgdXNlZCB0byBpbml0aWFsaXplIGRpY3Rpb25hcnkgbWV0\nYWRhdGEgaWYgbmVlZGVkLiBJZiB5b3UKICAgICAqIG92ZXJyaWRlIHRoaXMg\nbWV0aG9kLCBiZSBzdXJlIHRvIGNhbGwKICAgICAqIDxjb2RlPnN1cGVyLmNv\nbm5lY3RlZENvbmZpZ3VyYXRpb248L2NvZGU+LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjb25uZWN0ZWRDb25maWd1cmF0aW9uKENvbm5lY3Rpb24gY29u\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nIWNvbm5lY3RlZCkgewogICAgICAgICAgICBEYXRhYmFzZU1ldGFEYXRhIG1l\ndGFEYXRhID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIG1ldGFEYXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBKREJDMy1vbmx5\nIG1ldGhvZCwgc28gaXQgbWlnaHQgdGhyb3cgYSAKICAgICAgICAgICAgICAg\nICAgICAvLyBBYnN0cmFjdE1ldGhvZEVycm9yCiAgICAgICAgICAgICAgICAg\nICAgaXNKREJDMyA9IG1ldGFEYXRhLmdldEpEQkNNYWpvclZlcnNpb24oKSA+\nPSAzOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgaWYgbm90IEpEQkMzCiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKGUudG9TdHJpbmco\nKSwgZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkgeyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoREJEaWN0aW9uYXJ5RmFjdG9yeS50b1N0cmlu\nZyhtZXRhRGF0YSkpOwoKICAgICAgICAgICAgICAgIGlmIChpc0pEQkMzKQog\nICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiY29ubmVj\ndGlvbi1kZWZhdWx0cyIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAg\nICAgICAgICAgY29ubi5nZXRBdXRvQ29tbWl0KCksIGNvbm4uZ2V0SG9sZGFi\naWxpdHkoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5nZXRUcmFu\nc2FjdGlvbklzb2xhdGlvbigpfSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIAogICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIG5hbWluZyB1dGls\naXR5CiAgICAgICAgICAgIGNvbmZpZ3VyZU5hbWluZ1V0aWwobWV0YURhdGEp\nOwoKICAgICAgICAgICAgLy8gQXV0by1kZXRlY3QgZ2VuZXJhdGVkIGtleXMg\ncmV0cmlldmFsIHN1cHBvcnQKICAgICAgICAgICAgLy8gdW5sZXNzIHVzZXIg\nc3BlY2lmaWVkIGl0LgogICAgICAgICAgICBpZiAoc3VwcG9ydHNHZXRHZW5l\ncmF0ZWRLZXlzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChpc0pE\nQkMzKSB7CiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydHNHZXRHZW5lcmF0\nZWRLZXlzID0KICAgICAgICAgICAgICAgICAgICAgICAgbWV0YURhdGEuc3Vw\ncG9ydHNHZXRHZW5lcmF0ZWRLZXlzKCk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIHN1cHBvcnRzR2V0R2VuZXJhdGVk\nS2V5cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGNvbm5lY3RlZCA9IHRydWU7CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgdm9pZCBjb25maWd1cmVOYW1pbmdVdGlsKERhdGFi\nYXNlTWV0YURhdGEgbWV0YURhdGEpIHsKICAgICAgICAvLyBHZXQgdGhlIG5h\nbWluZyB1dGlsaXR5IGZyb20gdGhlIGNvbmZpZ3VyYXRpb24KICAgICAgICBz\nZXRTdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzKG1ldGFEYXRhKTsKICAg\nICAgICBzZXREZWxpbWl0ZWRDYXNlKG1ldGFEYXRhKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIG5hbWluZyBydWxlcyBmb3IgdGhp\ncyBkaWN0aW9uYXJ5LiAgU3ViY2xhc3NlcyBzaG91bGQgCiAgICAgKiBvdmVy\ncmlkZSB0aGlzIG1ldGhvZCwgcHJvdmlkaW5nIHRoZWlyIG93biBuYW1pbmcg\ncnVsZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNvbmZpZ3VyZU5h\nbWluZ1J1bGVzKCkgewogICAgICAgIC8vIEFkZCB0aGUgZGVmYXVsdCBuYW1p\nbmcgcnVsZQogICAgICAgIERCSWRlbnRpZmllclJ1bGUgZGVmUnVsZSA9IG5l\ndyBEQklkZW50aWZpZXJSdWxlKERCSWRlbnRpZmllclR5cGUuREVGQVVMVCwg\ncmVzZXJ2ZWRXb3JkU2V0KTsKICAgICAgICBuYW1pbmdSdWxlcy5wdXQoZGVm\nUnVsZS5nZXROYW1lKCksIGRlZlJ1bGUpOwogICAgICAgIC8vIERpc2FibGUg\nZGVsaW1pdGluZyBvZiBjb2x1bW4gZGVmaW5pdGlvbi4gIERCIHBsYXRmb3Jt\ncyBhcmUgdmVyeQogICAgICAgIC8vIHBpY2t5IGFib3V0IGRlbGltaXRlcnMg\naW4gY29sdW1uIGRlZmluaXRpb25zLiBCYXNlIGNvbHVtbiB0eXBlcwogICAg\nICAgIC8vIGRvIG5vdCByZXF1aXJlIGRlbGltaXRlcnMgYW5kIHdpbGwgY2F1\nc2UgZmFpbHVyZXMgaWYgZGVsaW1pdGVkLgogICAgICAgIERCSWRlbnRpZmll\nclJ1bGUgY2RSdWxlID0gbmV3IENvbHVtbkRlZklkZW50aWZpZXJSdWxlKCk7\nCiAgICAgICAgY2RSdWxlLnNldENhbkRlbGltaXQoZmFsc2UpOwogICAgICAg\nIG5hbWluZ1J1bGVzLnB1dChjZFJ1bGUuZ2V0TmFtZSgpLCBjZFJ1bGUpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlc3Vs\ndFNldCB3cmFwcGVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBBcnJheSBnZXRBcnJheShSZXN1bHRT\nZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEFycmF5KGNvbHVtbik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIElucHV0U3RyZWFtIGdldEFz\nY2lpU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QXNj\naWlTdHJlYW0oY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgQmlnRGVjaW1hbCBnZXRCaWdEZWNpbWFsKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpIHsKICAgICAg\nICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZyhycywgY29sdW1uKTsKICAg\nICAgICAgICAgcmV0dXJuIChzdHIgPT0gbnVsbCkgPyBudWxsIDogbmV3IEJp\nZ0RlY2ltYWwoc3RyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJzLmdl\ndEJpZ0RlY2ltYWwoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdGhlIHNwZWNpZmllZCBjb2x1bW4gdmFsdWUgYXMgYW4gdW5rbm93\nbiBudW1lcmljIHR5cGU7CiAgICAgKiB3ZSB0cnkgZnJvbSB0aGUgbW9zdCBn\nZW5lcmljIHRvIHRoZSBsZWFzdCBnZW5lcmljLgogICAgICovCiAgICBwdWJs\naWMgTnVtYmVyIGdldE51bWJlcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gdHJ5\nIGZyb20gdGhlIG1vc3QgZ2VuZXJpYywgYW5kIGlmIGVycm9ycyBvY2N1ciwg\ndHJ5CiAgICAgICAgLy8gbGVzcyBnZW5lcmljIHR5cGVzOyB0aGlzIGVuYWJs\nZXMgdXMgdG8gaGFuZGxlIHZhbHVlcwogICAgICAgIC8vIGxpa2UgRG91Ymxl\nLk5hTiB3aXRob3V0IGhhdmluZyB0byBpbnRyb3NwZWN0IG9uIHRoZQogICAg\nICAgIC8vIFJlc3VsdFNldE1ldGFEYXRhIChidWcgIzEwNTMpLiBOb3RlIHRo\nYXQgd2UgaGFuZGxlCiAgICAgICAgLy8gZ2VuZXJpYyBleGNlcHRpb25zLCBz\naW5jZSBzb21lIGRyaXZlcnMgbWF5IHRocm93CiAgICAgICAgLy8gTnVtYmVy\nRm9ybWF0RXhjZXB0aW9ucywgd2hlcmVhcyBvdGhlcnMgbWF5IHRocm93IFNR\nTEV4Y2VwdGlvbnMKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nZ2V0QmlnRGVjaW1hbChycywgY29sdW1uKTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZTEpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgRG91YmxlKGdldERvdWJsZShycywgY29sdW1uKSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMikgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIEZsb2F0KGdldEZsb2F0KHJzLCBjb2x1bW4pKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMykgewogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRMb25n\nKHJzLCBjb2x1bW4pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlNCkgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEludChycywg\nY29sdW1uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGU1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChlMSBpbnN0YW5jZW9mIFJ1bnRpbWVFeGNl\ncHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyhSdW50aW1lRXhjZXB0aW9u\nKSBlMTsKICAgICAgICAgICAgaWYgKGUxIGluc3RhbmNlb2YgU1FMRXhjZXB0\naW9uKQogICAgICAgICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSBlMTsK\nICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUg\nU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBCaWdJbnRlZ2VyIGdldEJpZ0ludGVnZXIo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3Ry\naW5ncykgewogICAgICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJz\nLCBjb2x1bW4pOwogICAgICAgICAgICByZXR1cm4gKHN0ciA9PSBudWxsKSA/\nIG51bGwgOiBuZXcgQmlnRGVjaW1hbChzdHIpLnRvQmlnSW50ZWdlcigpOwog\nICAgICAgIH0KICAgICAgICBCaWdEZWNpbWFsIGJkID0gZ2V0QmlnRGVjaW1h\nbChycywgY29sdW1uKTsKICAgICAgICByZXR1cm4gKGJkID09IG51bGwpID8g\nbnVsbCA6IGJkLnRvQmlnSW50ZWdlcigpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRCaW5hcnlTdHJlYW0oUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCaW5hcnlTdHJlYW0oY29s\ndW1uKTsKICAgIH0KCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0gZ2V0TE9CU3Ry\nZWFtKEpEQkNTdG9yZSBzdG9yZSwgUmVzdWx0U2V0IHJzLAogICAgICAgIGlu\ndCBjb2x1bW4pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBycy5nZXRCaW5hcnlTdHJlYW0oY29sdW1uKTsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIEJsb2IgZ2V0QmxvYihSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJsb2IoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldEJsb2JPYmplY3Qo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBKREJDU3RvcmUgc3RvcmUpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5wdXRTdHJl\nYW0gaW4gPSBudWxsOwogICAgICAgIGlmICh1c2VHZXRCeXRlc0ZvckJsb2Jz\nIHx8IHVzZUdldE9iamVjdEZvckJsb2JzKSB7CiAgICAgICAgICAgIGJ5dGVb\nXSBieXRlcyA9IGdldEJ5dGVzKHJzLCBjb2x1bW4pOwogICAgICAgICAgICBp\nZiAoYnl0ZXMgIT0gbnVsbCAmJiBieXRlcy5sZW5ndGggPiAwKQogICAgICAg\nICAgICAgICAgaW4gPSBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0oYnl0ZXMp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEJsb2IgYmxvYiA9IGdl\ndEJsb2IocnMsIGNvbHVtbik7CiAgICAgICAgICAgIGlmIChibG9iICE9IG51\nbGwgJiYgYmxvYi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBpbiA9\nIGJsb2IuZ2V0QmluYXJ5U3RyZWFtKCk7CiAgICAgICAgfQogICAgICAgIGlm\nIChpbiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHN0b3JlID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gU2VyaWFsaXphdGlvbi5kZXNlcmlhbGl6ZShp\nbiwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRl\nc2VyaWFsaXplKGluLCBzdG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nbi5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBp\nb2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRCb29sZWFuKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Qm9vbGVhbihjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlIGdldEJ5dGUoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCeXRlKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJ5dGVbXSBnZXRCeXRl\ncyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxvYnMp\nCiAgICAgICAgICAgIHJldHVybiBycy5nZXRCeXRlcyhjb2x1bW4pOwogICAg\nICAgIGlmICh1c2VHZXRPYmplY3RGb3JCbG9icykKICAgICAgICAgICAgcmV0\ndXJuIChieXRlW10pIHJzLmdldE9iamVjdChjb2x1bW4pOwoKICAgICAgICBC\nbG9iIGJsb2IgPSBnZXRCbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChi\nbG9iID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGludCBsZW5ndGggPSAoaW50KSBibG9iLmxlbmd0aCgpOwogICAgICAgIGlm\nIChsZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIGJsb2IuZ2V0Qnl0ZXMoMSwgbGVuZ3RoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLiBDb252ZXJ0cyB0aGUgZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFt\ncH0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIENhbGVuZGFyIGdl\ndENhbGVuZGFyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBEYXRlIGQgPSBnZXREYXRl\nKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBDYWxlbmRhciBjYWwgPSBDYWxl\nbmRhci5nZXRJbnN0YW5jZSgpOwogICAgICAgIGNhbC5zZXRUaW1lKGQpOwog\nICAgICAgIHJldHVybiBjYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIGNoYXIgZ2V0Q2hhcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0\nb3JlQ2hhcnNBc051bWJlcnMpCiAgICAgICAgICAgIHJldHVybiAoY2hhcikg\nZ2V0SW50KHJzLCBjb2x1bW4pOwoKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0\nU3RyaW5nKHJzLCBjb2x1bW4pOwogICAgICAgIHJldHVybiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShzdHIpKSA/IDAgOiBzdHIuY2hhckF0KDApOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBSZWFkZXIgZ2V0Q2hhcmFjdGVy\nU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Q2hhcmFj\ndGVyU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIENsb2IgZ2V0Q2xvYihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIHJzLmdldENsb2IoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRT\nZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENsb2JTdHJpbmcoUmVzdWx0U2V0IHJzLCBp\nbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICh1c2VHZXRTdHJpbmdGb3JDbG9icykKICAgICAgICAgICAgcmV0\ndXJuIHJzLmdldFN0cmluZyhjb2x1bW4pOwoKICAgICAgICBDbG9iIGNsb2Ig\nPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChjbG9iID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChjbG9i\nLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAg\nICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZlIHN0cmluZ3Mgb3ZlciBJ\nbnRlZ2VyLk1BWF9WQUxVRSBjaGFycwogICAgICAgIHJldHVybiBjbG9iLmdl\ndFN1YlN0cmluZygxLCAoaW50KSBjbG9iLmxlbmd0aCgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLiBDb252ZXJ0cyB0aGUgZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFt\ncH0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIERhdGUgZ2V0RGF0\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgVGltZXN0YW1wIHRzdGFtcCA9IGdldFRp\nbWVzdGFtcChycywgY29sdW1uLCBudWxsKTsKICAgICAgICBpZiAodHN0YW1w\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAv\nLyBnZXQgdGhlIGZyYWN0aW9uYWwgc2Vjb25kcyBjb21wb25lbnQsIHJvdW5k\naW5nIGF3YXkgYW55dGhpbmcgYmV5b25kCiAgICAgICAgLy8gbWlsbGlzZWNv\nbmRzCiAgICAgICAgaW50IGZyYWN0aW9uYWwgPSAoaW50KSBNYXRoLnJvdW5k\nKHRzdGFtcC5nZXROYW5vcygpIC8gKGRvdWJsZSkgTUlMTEkpOwoKICAgICAg\nICAvLyBnZXQgdGhlIG1pbGxpcyBjb21wb25lbnQ7IHNvbWUgSkRCQyBkcml2\nZXJzIHJvdW5kIHRoaXMgdG8gdGhlCiAgICAgICAgLy8gbmVhcmVzdCBzZWNv\nbmQsIHdoaWxlIG90aGVycyBkbyBub3QKICAgICAgICBsb25nIG1pbGxpcyA9\nICh0c3RhbXAuZ2V0VGltZSgpIC8gMTAwMEwpICogMTAwMEw7CiAgICAgICAg\ncmV0dXJuIG5ldyBEYXRlKG1pbGxpcyArIGZyYWN0aW9uYWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBqYXZhLnNxbC5EYXRlIGdldERh\ndGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0RGF0ZShjb2x1bW4p\nOwogICAgICAgIHJldHVybiBycy5nZXREYXRlKGNvbHVtbiwgY2FsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgZG91YmxlIGdldERvdWJs\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldERvdWJsZShjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCBn\nZXRGbG9hdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEZsb2F0\nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRJbnQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRJbnQo\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgTG9j\nYWxlIGdldExvY2FsZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIHN0ciA9\nIGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShzdHIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgU3RyaW5nW10gcGFyYW1zID0gU3RyaW5ncy5zcGxpdChzdHIsICJf\nIiwgMyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPCAzKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gbmV3IExvY2FsZShw\nYXJhbXNbMF0sIHBhcmFtc1sxXSwgcGFyYW1zWzJdKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgbG9uZyBnZXRMb25nKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcnMuZ2V0TG9uZyhjb2x1bW4pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0KFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAobWFwID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBycy5nZXRPYmplY3QoY29sdW1uKTsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0T2JqZWN0KGNvbHVtbiwgbWFwKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgUmVmIGdldFJlZihSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4sIE1hcCBtYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFJlZihjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzaG9ydCBnZXRTaG9ydChS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFNob3J0KGNvbHVtbik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRT\ndHJpbmcoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRTdHJpbmco\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgVGlt\nZSBnZXRUaW1lKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIg\nY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldFRpbWUo\nY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0VGltZShjb2x1bW4sIGNh\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFRpbWVzdGFt\ncCBnZXRUaW1lc3RhbXAoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxl\nbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0\nVGltZXN0YW1wKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldFRpbWVz\ndGFtcChjb2x1bW4sIGNhbCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcmVwYXJlZFN0YXRlbWVudCB3cmFw\ncGVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEFycmF5KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBBcnJh\neSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRBcnJheShpZHgsIHZhbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEFzY2lpU3RyZWFtKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LAogICAgICAgIElucHV0U3RyZWFtIHZhbCwgaW50IGxl\nbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzdG1udC5zZXRBc2NpaVN0cmVhbShpZHgsIHZhbCwgbGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgQmlnRGVjaW1hbCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoKGNvbCAhPSBudWxsICYmIGNvbC5pc0NvbXBhdGlibGUoVHlwZXMu\nVkFSQ0hBUiwgbnVsbCwgMCwgMCkpCiAgICAgICAgICAgIHx8IChjb2wgPT0g\nbnVsbCAmJiBzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykpCiAgICAgICAg\nICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29s\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNldEJpZ0RlY2lt\nYWwoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdJbnRlZ2VyKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCaWdJbnRlZ2VyIHZhbCwKICAg\nICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0aWJs\nZShUeXBlcy5WQVJDSEFSLCBudWxsLCAwLCAwKSkKICAgICAgICAgICAgfHwg\nKGNvbCA9PSBudWxsICYmIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSkK\nICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmlu\nZygpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0QmlnRGVj\naW1hbChzdG1udCwgaWR4LCBuZXcgQmlnRGVjaW1hbCh2YWwpLCBjb2wpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRCaW5hcnlTdHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsCiAgICAgICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVu\nZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldEJpbmFyeVN0cmVhbShpZHgsIHZhbCwgbGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QmxvYihQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgQmxvYiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgs\nIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuIFVzZXMgdGhl\nCiAgICAgKiB7QGxpbmsgI3NlcmlhbGl6ZX0gbWV0aG9kIHRvIHNlcmlhbGl6\nZSB0aGUgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2JP\nYmplY3QoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVj\ndCB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldEJ5dGVz\nKHN0bW50LCBpZHgsIHNlcmlhbGl6ZSh2YWwsIHN0b3JlKSwgY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Qm9vbGVhbihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgYm9vbGVhbiB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRJbnQo\naWR4LCAodmFsKSA/IDEgOiAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZShQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgYnl0ZSB2YWwsIENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3Rt\nbnQuc2V0Qnl0ZShpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVzKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBieXRlW10gdmFsLAogICAg\nICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHVzZVNldEJ5dGVzRm9yQmxvYnMpCiAgICAgICAgICAg\nIHN0bW50LnNldEJ5dGVzKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHNldEJpbmFyeVN0cmVhbShzdG1udCwgaWR4LCBuZXcgQnl0ZUFy\ncmF5SW5wdXRTdHJlYW0odmFsKSwKICAgICAgICAgICAgICAgIHZhbC5sZW5n\ndGgsIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldENoYXIoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIGNoYXIgdmFsLCBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICgoY29sICE9IG51\nbGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBlcy5JTlRFR0VSLCBudWxsLCAw\nLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9PSBudWxsICYmIHN0b3JlQ2hh\ncnNBc051bWJlcnMpKQogICAgICAgICAgICBzZXRJbnQoc3RtbnQsIGlkeCwg\nKGludCkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0\nU3RyaW5nKHN0bW50LCBpZHgsIFN0cmluZy52YWx1ZU9mKHZhbCksIGNvbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldENoYXJhY3RlclN0cmVhbShQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwKICAgICAgICBSZWFkZXIgdmFsLCBpbnQgbGVu\nZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldENoYXJhY3RlclN0cmVhbShpZHgsIHZhbCwg\nbGVuZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ndmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0Q2xvYihQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgQ2xvYiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0Q2xvYihp\nZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldENsb2JTdHJpbmcoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAodXNlU2V0U3RyaW5nRm9yQ2xvYnMpCiAgICAgICAgICAgIHN0bW50\nLnNldFN0cmluZyhpZHgsIHZhbCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHNldCByZWFkZXIgZnJvbSBzdHJpbmcKICAgICAgICAgICAgU3Ry\naW5nUmVhZGVyIGluID0gbmV3IFN0cmluZ1JlYWRlcih2YWwpOwogICAgICAg\nICAgICBzZXRDaGFyYWN0ZXJTdHJlYW0oc3RtbnQsIGlkeCwgaW4sIHZhbC5s\nZW5ndGgoKSwgY29sKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGUoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIERhdGUgdmFsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkRB\nVEUpCiAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgbmV3IGphdmEu\nc3FsLkRhdGUodmFsLmdldFRpbWUoKSksIG51bGwsIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5cGUoKSA9PSBUeXBl\ncy5USU1FKQogICAgICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIG5ldyBU\naW1lKHZhbC5nZXRUaW1lKCkpLCBudWxsLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIFRpbWVzdGFtcCkKICAgICAgICAgICAgc2V0\nVGltZXN0YW1wKHN0bW50LCBpZHgsKFRpbWVzdGFtcCkgdmFsLCBudWxsLCBj\nb2wpOyAgIAogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0VGltZXN0YW1w\nKHN0bW50LCBpZHgsIG5ldyBUaW1lc3RhbXAodmFsLmdldFRpbWUoKSksIG51\nbGwsIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGUoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIGphdmEuc3FsLkRhdGUgdmFsLAogICAgICAgIENh\nbGVuZGFyIGNhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAg\nIHN0bW50LnNldERhdGUoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3RtbnQuc2V0RGF0ZShpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0Q2FsZW5kYXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nIENhbGVuZGFyIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGJ5IGRlZmF1bHQgd2Ug\nbWVyZWx5IGRlbGVnYXRlIHRvIHRoZSBEYXRlIHBhcmFtZXRlcgogICAgICAg\nIHNldERhdGUoc3RtbnQsIGlkeCwgdmFsLmdldFRpbWUoKSwgY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RG91YmxlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBkb3VibGUgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0RG91Ymxl\nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RmxvYXQoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIGZsb2F0IHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldEZsb2F0KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50KFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQgdmFsLCBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldEludChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExvbmcoUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGxvbmcgdmFsLCBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldExvbmcoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIExvY2FsZSB2YWwsCiAg\nICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLmdldExhbmd1\nYWdlKCkgKyAiXyIgKyB2YWwuZ2V0Q291bnRyeSgpCiAgICAgICAgICAgICsg\nIl8iICsgdmFsLmdldFZhcmlhbnQoKSwgY29sKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCBudWxsIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1l\nbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZyb20ge0Bs\naW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TnVsbChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50IGNvbFR5cGUs\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXROdWxsKGlkeCwgY29sVHlwZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEg\ncGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldE51bWJlcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgTnVtYmVyIG51bSwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGNoZWNrIGZvciBr\nbm93biBmbG9hdGluZyBwb2ludCB0eXBlcyB0byBnaXZlIGRyaXZlciBhIGNo\nYW5jZSB0bwogICAgICAgIC8vIGhhbmRsZSBzcGVjaWFsIG51bWJlcnMgbGlr\nZSBOYU4gYW5kIGluZmluaXR5OyBidWcgIzEwNTMKICAgICAgICBpZiAobnVt\nIGluc3RhbmNlb2YgRG91YmxlKQogICAgICAgICAgICBzZXREb3VibGUoc3Rt\nbnQsIGlkeCwgKChEb3VibGUpIG51bSkuZG91YmxlVmFsdWUoKSwgY29sKTsK\nICAgICAgICBlbHNlIGlmIChudW0gaW5zdGFuY2VvZiBGbG9hdCkKICAgICAg\nICAgICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChGbG9hdCkgbnVtKS5mbG9h\ndFZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRC\naWdEZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKG51bS50b1N0\ncmluZygpKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4g\nVGhlIGNvbHVtbgogICAgICogdHlwZSB3aWxsIGNvbWUgZnJvbSB7QGxpbmsg\nVHlwZXN9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3QoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVjdCB2YWwsCiAg\nICAgICAgaW50IGNvbFR5cGUsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNvbFR5cGUgPT0gLTEgfHwg\nY29sVHlwZSA9PSBUeXBlcy5PVEhFUikKICAgICAgICAgICAgc3RtbnQuc2V0\nT2JqZWN0KGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0\nbW50LnNldE9iamVjdChpZHgsIHZhbCwgY29sVHlwZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFJlZihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgUmVmIHZh\nbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBzdG1udC5zZXRSZWYoaWR4LCB2YWwpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0\nbyB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRT\naG9ydChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgc2hvcnQg\ndmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0U2hvcnQoaWR4LCB2YWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRTdHJpbmcoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGlu\ndCBpZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRTdHJp\nbmcoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1lKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBUaW1lIHZhbCwKICAgICAgICBDYWxlbmRh\nciBjYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICBzdG1u\ndC5zZXRUaW1lKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHN0bW50LnNldFRpbWUoaWR4LCB2YWwsIGNhbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRv\nIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRp\nbWVzdGFtcChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwKICAg\nICAgICBUaW1lc3RhbXAgdmFsLCBDYWxlbmRhciBjYWwsIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZW5z\ndXJlIHRoYXQgd2UgZG8gbm90IGluc2VydCBkYXRlcyBhdCBhIGdyZWF0ZXIg\ncHJlY2lzaW9uIHRoYW4KICAgICAgICAvLyB0aGF0IGF0IHdoaWNoIHRoZXkg\nd2lsbCBiZSByZXR1cm5lZCBieSBhIFNFTEVDVAogICAgICAgIGludCByb3Vu\nZGVkID0gKGludCkgTWF0aC5yb3VuZCh2YWwuZ2V0TmFub3MoKSAvCiAgICAg\nICAgICAgIChkb3VibGUpIGRhdGVQcmVjaXNpb24pOwogICAgICAgIGludCBu\nYW5vcyA9IHJvdW5kZWQgKiBkYXRlUHJlY2lzaW9uOwogICAgICAgIGlmIChu\nYW5vcyA+IDk5OTk5OTk5OSkgewogICAgICAgICAgICAvLyByb2xsb3ZlciB0\nbyBuZXh0IHNlY29uZAogICAgICAgICAgICB2YWwuc2V0VGltZSh2YWwuZ2V0\nVGltZSgpICsgMTAwMCk7CiAgICAgICAgICAgIG5hbm9zID0gMDsKICAgICAg\nICB9CgogICAgICAgIHZhbC5zZXROYW5vcyhuYW5vcyk7CgogICAgICAgIGlm\nIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQuc2V0VGltZXN0YW1w\nKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNl\ndFRpbWVzdGFtcChpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCBhIGNvbHVtbiB2YWx1ZSBpbnRvIGEgcHJlcGFyZWQgc3RhdGVt\nZW50LgogICAgICoKICAgICAqIEBwYXJhbSBzdG1udCB0aGUgcHJlcGFyZWQg\nc3RhdGVtZW50IHRvIHBhcmFtZXRlcml6ZQogICAgICogQHBhcmFtIGlkeCB0\naGUgaW5kZXggb2YgdGhlIHBhcmFtZXRlciBpbiB0aGUgcHJlcGFyZWQgc3Rh\ndGVtZW50CiAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSBvZiB0aGUgY29s\ndW1uCiAgICAgKiBAcGFyYW0gY29sIHRoZSBjb2x1bW4gYmVpbmcgc2V0CiAg\nICAgKiBAcGFyYW0gdHlwZSB0aGUgZmllbGQgbWFwcGluZyB0eXBlIGNvZGUg\nZm9yIHRoZSB2YWx1ZQogICAgICogQHBhcmFtIHN0b3JlIHRoZSBzdG9yZSBt\nYW5hZ2VyIGZvciB0aGUgY3VycmVudCBjb250ZXh0CiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFR5cGVkKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wsIGludCB0\neXBlLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIHNldE51bGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9U\nSEVSIDogY29sLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNpemVkIHM7\nCiAgICAgICAgQ2FsZW5kYXJkIGM7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICAg\nICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJvb2xlYW4pIHZhbCkuYm9v\nbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBzZXRCeXRl\nKHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJf\nT0JKOgogICAgICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAoKENo\nYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAg\nICAgICAgICAgICBzZXREb3VibGUoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZh\nbCkuZG91YmxlVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAg\nc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1\nZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgIHNldEludChzdG1udCwgaWR4\nLCAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAg\nICAgICAgICAgc2V0TG9uZyhzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5s\nb25nVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgc2V0U2hv\ncnQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIGlmIChjb2wgIT0g\nbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CCiAgICAgICAg\nICAgICAgICAgICAgfHwgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5MT05HVkFS\nQ0hBUikpCiAgICAgICAgICAgICAgICAgICAgc2V0Q2xvYlN0cmluZyhzdG1u\ndCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgs\nIChTdHJpbmcpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAg\nICAgICBzZXRCbG9iT2JqZWN0KHN0bW50LCBpZHgsIHZhbCwgY29sLCBzdG9y\nZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHNldERhdGUoc3RtbnQs\nIGlkeCwgKERhdGUpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAg\nICAgICAgICAgIHNldENhbGVuZGFyKHN0bW50LCBpZHgsIChDYWxlbmRhcikg\ndmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICBz\nZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIChCaWdEZWNpbWFsKSB2YWwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIHNldEJpZ0lu\ndGVnZXIoc3RtbnQsIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5OVU1CRVI6CiAgICAgICAgICAgICAgICBzZXROdW1iZXIoc3RtbnQsIGlk\neCwgKE51bWJlcikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAg\nICAgICAgIHNldExvY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgogICAgICAgICAgICAgICAgc2V0QXJy\nYXkoc3RtbnQsIGlkeCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVND\nSUlfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXplZCkgdmFsOwog\nICAgICAgICAgICAgICAgc2V0QXNjaWlTdHJlYW0oc3RtbnQsIGlkeCwgKElu\ncHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQklO\nQVJZX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZhbDsK\nICAgICAgICAgICAgICAgIHNldEJpbmFyeVN0cmVhbShzdG1udCwgaWR4LCAo\nSW5wdXRTdHJlYW0pIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5C\nTE9COgogICAgICAgICAgICAgICAgc2V0QmxvYihzdG1udCwgaWR4LCAoQmxv\nYikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJZVEVTOgogICAgICAgICAgICAgICAg\nc2V0Qnl0ZXMoc3RtbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5\ncGVzLkNIQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXplZCkg\ndmFsOwogICAgICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50\nLCBpZHgsIChSZWFkZXIpIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5DTE9COgogICAgICAgICAgICAgICAgc2V0Q2xvYihzdG1udCwgaWR4LCAo\nQ2xvYikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAgICAg\nICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyZCkgewogICAgICAg\nICAgICAgICAgICAgIGMgPSAoQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAg\nICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0ZSkg\nYy52YWx1ZSwgYy5jYWxlbmRhciwKICAgICAgICAgICAgICAgICAgICAgICAg\nY29sKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZhbCwg\nbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFTUUxUeXBlcy5SRUY6CiAgICAgICAgICAgICAgICBzZXRS\nZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUU6\nCiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5kYXJk\nKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZhbDsK\nICAgICAgICAgICAgICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIChUaW1l\nKSBjLnZhbHVlLCBjLmNhbGVuZGFyLCBjb2wpOwogICAgICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4\nLCAoVGltZSkgdmFsLCBudWxsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUVTVEFNUDoK\nICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQp\nIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFsOwog\nICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAo\nVGltZXN0YW1wKSBjLnZhbHVlLCBjLmNhbGVuZGFyLAogICAgICAgICAgICAg\nICAgICAgICAgICBjb2wpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0bW50LCBpZHgsIChUaW1l\nc3RhbXApIHZhbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYgKGNv\nbCAhPSBudWxsICYmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IKICAg\nICAgICAgICAgICAgICAgICB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLlZB\nUkJJTkFSWSkpCiAgICAgICAgICAgICAgICAgICAgc2V0QmxvYk9iamVjdChz\ndG1udCwgaWR4LCB2YWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIHNldE9iamVjdChzdG1udCwgaWR4\nLCB2YWwsIGNvbC5nZXRUeXBlKCksIGNvbCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IGEgY29tcGxldGVseSB1bmtub3duIHBhcmFt\nZXRlciBpbnRvIGEgcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRVbmtub3duKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2l6ZWQgc2l6\nZWQgPSBudWxsOwogICAgICAgIENhbGVuZGFyZCBjYWxkID0gbnVsbDsKICAg\nICAgICBpZiAodmFsIGluc3RhbmNlb2YgU2l6ZWQpIHsKICAgICAgICAgICAg\nc2l6ZWQgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgdmFsID0gc2l6ZWQu\ndmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxl\nbmRhcmQpIHsKICAgICAgICAgICAgY2FsZCA9IChDYWxlbmRhcmQpIHZhbDsK\nICAgICAgICAgICAgdmFsID0gY2FsZC52YWx1ZTsKICAgICAgICB9CgogICAg\nICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgc2V0TnVsbChzdG1u\ndCwgaWR4LCAoY29sID09IG51bGwpID8gVHlwZXMuT1RIRVIgOiBjb2wuZ2V0\nVHlwZSgpLAogICAgICAgICAgICAgICAgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHNldFN0cmlu\nZyhzdG1udCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBJbnRlZ2VyKQogICAgICAgICAgICBz\nZXRJbnQoc3RtbnQsIGlkeCwgKChJbnRlZ2VyKSB2YWwpLmludFZhbHVlKCks\nIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQm9vbGVh\nbikKICAgICAgICAgICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJvb2xl\nYW4pIHZhbCkuYm9vbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgTG9uZykKICAgICAgICAgICAgc2V0TG9uZyhz\ndG1udCwgaWR4LCAoKExvbmcpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRmxvYXQpCiAgICAgICAg\nICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoRmxvYXQpIHZhbCkuZmxvYXRW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIERvdWJsZSkKICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsICgo\nRG91YmxlKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgQnl0ZSkKICAgICAgICAgICAgc2V0Qnl0\nZShzdG1udCwgaWR4LCAoKEJ5dGUpIHZhbCkuYnl0ZVZhbHVlKCksIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQ2hhcmFjdGVyKQog\nICAgICAgICAgICBzZXRDaGFyKHN0bW50LCBpZHgsICgoQ2hhcmFjdGVyKSB2\nYWwpLmNoYXJWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIFNob3J0KQogICAgICAgICAgICBzZXRTaG9ydChzdG1udCwg\naWR4LCAoKFNob3J0KSB2YWwpLnNob3J0VmFsdWUoKSwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBMb2NhbGUpCiAgICAgICAgICAg\nIHNldExvY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQmlnRGVjaW1hbCkKICAg\nICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVjaW1h\nbCkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIEJpZ0ludGVnZXIpCiAgICAgICAgICAgIHNldEJpZ0ludGVnZXIoc3RtbnQs\nIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICAgICAgc2V0QXJyYXko\nc3RtbnQsIGlkeCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgQmxvYikKICAgICAgICAgICAgc2V0QmxvYihz\ndG1udCwgaWR4LCAoQmxvYikgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIGJ5dGVbXSkKICAgICAgICAgICAgc2V0Qnl0ZXMo\nc3RtbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIENsb2IpCiAgICAgICAgICAgIHNldENsb2Io\nc3RtbnQsIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBSZWYpCiAgICAgICAgICAgIHNldFJlZihzdG1u\ndCwgaWR4LCAoUmVmKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFs\nIGluc3RhbmNlb2YgamF2YS5zcWwuRGF0ZSkKICAgICAgICAgICAgc2V0RGF0\nZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0ZSkgdmFsLAogICAgICAgICAg\nICAgICAgKGNhbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwg\nY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lc3Rh\nbXApCiAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAoVGlt\nZXN0YW1wKSB2YWwsCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBudWxsKSA/\nIG51bGwgOiBjYWxkLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIFRpbWUpCiAgICAgICAgICAgIHNldFRpbWUoc3Rt\nbnQsIGlkeCwgKFRpbWUpIHZhbCwKICAgICAgICAgICAgICAgIChjYWxkID09\nIG51bGwpID8gbnVsbCA6IGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICAgICAgc2V0\nRGF0ZShzdG1udCwgaWR4LCAoRGF0ZSkgdmFsLCBjb2wpOwogICAgICAgIGVs\nc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyKQogICAgICAgICAgICBz\nZXREYXRlKHN0bW50LCBpZHgsICgoQ2FsZW5kYXIpIHZhbCkuZ2V0VGltZSgp\nLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJlYWRl\ncikKICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBpZHgs\nIChSZWFkZXIpIHZhbCwKICAgICAgICAgICAgICAgIChzaXplZCA9PSBudWxs\nKSA/IDAgOiBzaXplZC5zaXplLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1w\nYXJhbSIsIHZhbC5nZXRDbGFzcygpKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHNlcmlhbGl6ZWQgYnl0ZXMgZm9yIHRoZSBnaXZlbiBv\nYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlW10gc2VyaWFsaXplKE9i\namVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBT\nZXJpYWxpemVkRGF0YSkKICAgICAgICAgICAgcmV0dXJuICgoU2VyaWFsaXpl\nZERhdGEpIHZhbCkuYnl0ZXM7CiAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRp\nb24uc2VyaWFsaXplKHZhbCwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRC\neXRlczwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVjdC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Qnl0ZXMoQmxvYiBibG9iLCBi\neXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBibG9iLnNldEJ5dGVzKDFMLCBkYXRhKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRTdHJpbmc8L2Nv\nZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICogb2JqZWN0Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRTdHJpbmcoQ2xvYiBjbG9iLCBT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBjbG9iLnNldFN0cmluZygxTCwgZGF0YSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbnZva2UgdGhlIEpESyAxLjQgPGNvZGU+c2V0Q2hhcmFjdGVy\nU3RyZWFtPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuCiAgICAgKiBDTE9C\nIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Q2hhcnMoQ2xv\nYiBjbG9iLCBjaGFyW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBXcml0ZXIgd3JpdGVyID0gY2xvYi5zZXRDaGFyYWN0\nZXJTdHJlYW0oMUwpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdyaXRl\nci53cml0ZShkYXRhKTsKICAgICAgICAgICAgd3JpdGVyLmZsdXNoKCk7CiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTUUxFeGNlcHRpb24oaW9lLnRvU3RyaW5nKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhhdCBhIHBhcnRp\nY3VsYXIgdmFsdWUgY291bGQgbm90IGJlIHN0b3JlZCBwcmVjaXNlbHkuCiAg\nICAgKiBBZnRlciB0aGUgZmlyc3Qgd2FybmluZyBmb3IgYSBwYXJ0aWN1bGFy\nIHR5cGUsIG1lc3NhZ2VzCiAgICAgKiB3aWxsIGJlIHR1cm5lZCBpbnRvIHRy\nYWNlIG1lc3NhZ2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9y\nYWdlV2FybmluZyhPYmplY3Qgb3JpZywgT2JqZWN0IGNvbnZlcnRlZCkgewog\nICAgICAgIGJvb2xlYW4gd2FybjsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgaWYgKF9wcmVjaXNpb25XYXJuZWRUeXBlcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3ByZWNpc2lvbldhcm5lZFR5cGVz\nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgd2FybiA9IF9wcmVjaXNp\nb25XYXJuZWRUeXBlcy5hZGQob3JpZy5nZXRDbGFzcygpKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChzdG9yYWdlTGltaXRhdGlvbnNGYXRhbCB8fCAod2Fy\nbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICB8fCAoIXdh\ncm4gJiYgbG9nLmlzVHJhY2VFbmFibGVkKCkpKSB7CiAgICAgICAgICAgIE1l\nc3NhZ2UgbXNnID0gX2xvYy5nZXQoInN0b3JhZ2UtcmVzdHJpY3Rpb24iLCBu\nZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICBwbGF0Zm9ybSwKICAgICAg\nICAgICAgICAgIG9yaWcsCiAgICAgICAgICAgICAgICBvcmlnLmdldENsYXNz\nKCkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgY29udmVydGVkLAogICAg\nICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzdG9yYWdlTGltaXRhdGlv\nbnNGYXRhbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2Vw\ndGlvbihtc2cpOwoKICAgICAgICAgICAgaWYgKHdhcm4pCiAgICAgICAgICAg\nICAgICBsb2cud2Fybihtc2cpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBsb2cudHJhY2UobXNnKTsKICAgICAgICB9CiAgICB9CgogICAg\nLy8vLy8vLy8vCiAgICAvLyBUeXBlcwogICAgLy8vLy8vLy8vCiAgICAKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVz\nfSBjb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5\ncGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAq\nLwogICAgcHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2Rl\nLCBib29sZWFuIGxvYikgewogICAgICAgIHJldHVybiBnZXRKREJDVHlwZSht\nZXRhVHlwZUNvZGUsIGxvYiwgMCwgMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9IGNvbnN0YW50\nIGZvciB0aGUgZ2l2ZW4KICAgICAqIHtAbGluayBKYXZhVHlwZXN9IG9yIHtA\nbGluayBKYXZhU1FMVHlwZXN9IGNvbnN0YW50LgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4g\nbG9iLCBpbnQgcHJlY2lzLCAKICAgICAgICBpbnQgc2NhbGUsIGJvb2xlYW4g\neG1sKSB7CiAgICAgICAgcmV0dXJuIGdldEpEQkNUeXBlKG1ldGFUeXBlQ29k\nZSwgbG9iLCBwcmVjaXMsIHNjYWxlKTsgICAgICAgIAogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVzfSBj\nb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5cGVz\nfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2RlLCBi\nb29sZWFuIGxvYiwgaW50IHByZWNpcywgCiAgICAgICAgaW50IHNjYWxlKSB7\nCiAgICAgICAgaWYgKGxvYikgewogICAgICAgICAgICBzd2l0Y2ggKG1ldGFU\neXBlQ29kZSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RS\nSU5HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVNDSUlf\nU1RSRUFNOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQ0hB\nUl9TVFJFQU06CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBl\nKFR5cGVzLkJMT0IpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBzd2l0Y2ggKG1ldGFUeXBlQ29kZSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLkJJVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nVElOWUlOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAg\nICAgICAgaWYgKHN0b3JlQ2hhcnNBc051bWJlcnMpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuSU5URUdFUik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5DSEFSKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAg\nICAgICAgICAgaWYocHJlY2lzID4gMCB8fCBzY2FsZSA+IDApIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5O\nVU1FUklDKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBpZihwcmVjaXMg\nPiAwIHx8IHNjYWxlID4gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuUkVBTCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLklOVEVH\nRVIpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJJR0lOVCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5TTUFMTElOVCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9DQUxFOgogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5B\nU0NJSV9TVFJFQU06CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNI\nQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJl\nZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJn\nZU51bWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CSUdJTlQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAg\nICAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVz\nLlZBUkNIQVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJl\nZFR5cGUoVHlwZXMuTlVNRVJJQyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk5VTUJFUjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUxhcmdlTnVt\nYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkFSUkFZKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQklOQVJZX1NUUkVBTToKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQkxPQjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQllURVM6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICBjYXNl\nIEphdmFTUUxUeXBlcy5TUUxfREFURToKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRBVEUpOwogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRSk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVNRTFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9\nIHR5cGUgZm9yIHRoZSBnaXZlbiBvbmUuIFJldHVybnMKICAgICAqIHRoZSBn\naXZlbiB0eXBlIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0UHJlZmVycmVkVHlwZShpbnQgdHlwZSkgewogICAgICAgIHJldHVybiB0\neXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJy\nZWQgZGF0YWJhc2UgdHlwZSBuYW1lIGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3Mg\ndHlwZQogICAgICogZnJvbSB7QGxpbmsgVHlwZXN9LgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nIGdldFR5cGVOYW1lKENvbHVtbiBjb2wpIHsKICAgICAg\nICBpZiAoIURCSWRlbnRpZmllci5pc0VtcHR5KGNvbC5nZXRUeXBlSWRlbnRp\nZmllcigpKSkKICAgICAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCB0\nb0RCTmFtZShjb2wuZ2V0VHlwZUlkZW50aWZpZXIoKSkpOwoKICAgICAgICBp\nZiAoY29sLmlzQXV0b0Fzc2lnbmVkKCkgJiYgYXV0b0Fzc2lnblR5cGVOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBhcHBlbmRTaXplKGNvbCwg\nYXV0b0Fzc2lnblR5cGVOYW1lKTsKCiAgICAgICAgcmV0dXJuIGFwcGVuZFNp\nemUoY29sLCBnZXRUeXBlTmFtZShjb2wuZ2V0VHlwZSgpKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB0eXBlIG5hbWUgZm9yIHRoZSBz\ncGVjaWZpYyBjb25zdGFudCBhcyBkZWZpbmVkCiAgICAgKiBieSB7QGxpbmsg\namF2YS5zcWwuVHlwZXN9LgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRo\nZSB0eXBlCiAgICAgKiBAcmV0dXJuIHRoZSBuYW1lIGZvciB0aGUgdHlwZQog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5cGVOYW1lKGludCB0eXBl\nKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXlUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSUdJTlQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gYmlnaW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuQklOQVJZOgogICAgICAgICAgICAgICAgcmV0dXJuIGJpbmFy\neVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJJVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBiaXRUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGJvb2xlYW5UeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXJU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAg\nICAgICAgICAgcmV0dXJuIGNsb2JUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ERUNJTUFMOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGRlY2ltYWxUeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5ESVNUSU5DVDoKICAgICAgICAgICAgICAgIHJldHVybiBk\naXN0aW5jdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgIHJldHVybiBkb3VibGVUeXBlTmFtZTsKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBmbG9hdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLklO\nVEVHRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50ZWdlclR5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkpBVkFfT0JKRUNUOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGphdmFPYmplY3RUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5MT05HVkFSQklOQVJZOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGxvbmdWYXJiaW5hcnlUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBs\nb25nVmFyY2hhclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk5V\nTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbFR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVtZXJpY1R5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLk9USEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIG90aGVyVHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVBTDoKICAgICAgICAgICAgICAg\nIHJldHVybiByZWFsVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nUkVGOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlZlR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHNtYWxsaW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuU1RSVUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN0cnVjdFR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGltZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lc3Rh\nbXBUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5USU5ZSU5UOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHRpbnlpbnRUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5WQVJCSU5BUlk6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdmFyYmluYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiB2YXJjaGFyVHlw\nZU5hbWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gb3RoZXJUeXBlTmFtZTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBzaXplIHByb3BlcnRpZXMg\ndG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICogSWYgcHJlc2VudCwgdGhl\nIHN0cmluZyAiezB9IiB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIHNpemUg\nZGVmaW5pdGlvbjsKICAgICAqIG90aGVyd2lzZSB0aGUgc2l6ZSBkZWZpbml0\naW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIHR5cGUgbmFtZS4KICAgICAq\nIElmIHlvdXIgZGF0YWJhc2UgaGFzIGNvbHVtbiB0eXBlcyB0aGF0IGRvbid0\nIGFsbG93IHNpemUgZGVmaW5pdGlvbnMsCiAgICAgKiBvdmVycmlkZSB0aGlz\nIG1ldGhvZCB0byByZXR1cm4gdGhlIHVuYWx0ZXJlZCB0eXBlIG5hbWUgZm9y\nIGNvbHVtbnMgb2YKICAgICAqIHRob3NlIHR5cGVzIChvciBhZGQgdGhlIHR5\ncGUgbmFtZXMgdG8gdGhlCiAgICAgKiA8Y29kZT5maXhlZFNpemVUeXBlTmFt\nZVNldDwvY29kZT4pLgogICAgICogCiAgICAgKiA8UD5Tb21lIGRhdGFiYXNl\ncyBzdXBwb3J0ICJ0eXBlIG1vZGlmaWVycyIsIGZvciBleGFtcGxlIHRoZSB1\nbnNpZ25lZAogICAgICogIm1vZGlmaWVyIiBpbiBNeVNRTC4gSW4gdGhlc2Ug\nY2FzZXMgdGhlIHNpemUgc2hvdWxkIGdvIGJldHdlZW4gdGhlIHR5cGUgCiAg\nICAgKiBhbmQgdGhlICJtb2RpZmllciIsIGluc3RlYWQgb2YgYWZ0ZXIgdGhl\nIG1vZGlmaWVyLiBGb3IgZXhhbXBsZSAKICAgICAqIENSRUFURSB0YWJsZSBG\nT08gKCBteWludCBJTlQgKDEwKSBVTlNJR05FRCAuIC4gLikgaW5zdGVhZCBv\nZiAKICAgICAqIENSRUFURSB0YWJsZSBGT08gKCBteWludCBJTlQgVU5TSUdO\nRUQgKDEwKSAuIC4gLikuCiAgICAgKiBUeXBlIG1vZGlmaWVycyBzaG91bGQg\nYmUgYWRkZWQgdG8gPGNvZGU+dHlwZU1vZGlmaWVyU2V0PC9jb2RlPiBpbiAK\nICAgICAqIHN1YmNsYXNzZXMuIAogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGFwcGVuZFNpemUoQ29sdW1uIGNvbCwgU3RyaW5nIHR5cGVOYW1lKSB7\nCiAgICAgICAgaWYgKGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmNvbnRhaW5zKHR5\ncGVOYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICByZXR1cm4gdHlw\nZU5hbWU7CiAgICAgICAgaWYgKHR5cGVOYW1lLmluZGV4T2YoJygnKSAhPSAt\nMSkKICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lOwoKICAgICAgICBTdHJp\nbmcgc2l6ZSA9IG51bGw7CiAgICAgICAgaWYgKGNvbC5nZXRTaXplKCkgPiAw\nKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1aWxkZXIoMTApOwogICAgICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBw\nZW5kKGNvbC5nZXRTaXplKCkpOwogICAgICAgICAgICBpZiAoY29sLmdldERl\nY2ltYWxEaWdpdHMoKSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIsICIpLmFwcGVuZChjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgICAgICAgICBzaXplID0gYnVm\nLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaW5zZXJ0\nU2l6ZSh0eXBlTmFtZSwgc2l6ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRoYXQgaW5zZXJ0cyBhIHNpemUgY2xhdXNlIGZvciBh\nIGdpdmVuIFNRTCB0eXBlLiAKICAgICAqIAogICAgICogQHNlZSBhcHBlbmRT\naXplCiAgICAgKiAKICAgICAqIEBwYXJhbSB0eXBlTmFtZSAgVGhlIFNRTCB0\neXBlIGUuZy4gSU5UCiAgICAgKiBAcGFyYW0gc2l6ZSAgICAgIFRoZSBzaXpl\nIGNsYXVzZSBlLmcuICgxMCkKICAgICAqIEByZXR1cm4gICAgICAgICAgVGhl\nIHR5cGVOYW1lICsgc2l6ZSBjbGF1c2UuIFVzdWFsbHkgdGhlIHNpemUgY2xh\ndXNlIHdpbGwKICAgICAqICAgICAgICAgICAgICAgICAgYmUgYXBwZW5kZWQg\ndG8gdHlwZU5hbWUuIElmIHRoZSB0eXBlTmFtZSBjb250YWlucyBhIAogICAg\nICogICAgICAgICAgICAgICAgICBtYXJrZXIgOiB7MH0gb3IgaWYgdHlwZU5h\nbWUgY29udGFpbnMgYSBtb2RpZmllciB0aGUgCiAgICAgKiAgICAgICAgICAg\nICAgICAgIHNpemUgY2xhdXNlIHdpbGwgYmUgaW5zZXJ0ZWQgYXBwcm9wcmlh\ndGVseS4gICAKICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBpbnNlcnRT\naXplKFN0cmluZyB0eXBlTmFtZSwgU3RyaW5nIHNpemUpIHsKICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzaXplKSkgewogICAgICAgICAgICBp\nbnQgaWR4ID0gdHlwZU5hbWUuaW5kZXhPZigiezB9Iik7CiAgICAgICAgICAg\nIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBl\nTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gdHlwZU5hbWU7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9mKCJ7MH0iKTsKICAgICAg\nICBpZiAoaWR4ICE9IC0xKSB7CiAgICAgICAgICAgIC8vIHJlcGxhY2UgJ3sw\nfScgd2l0aCBzaXplCiAgICAgICAgICAgIFN0cmluZyByZXQgPSB0eXBlTmFt\nZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAgaWYgKHNpemUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldCA9IHJldCArIHNpemU7CiAgICAg\nICAgICAgIGlmICh0eXBlTmFtZS5sZW5ndGgoKSA+IGlkeCArIDMpCiAgICAg\nICAgICAgICAgICByZXQgPSByZXQgKyB0eXBlTmFtZS5zdWJzdHJpbmcoaWR4\nICsgMyk7CiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQogICAg\nICAgIGlmICghdHlwZU1vZGlmaWVyU2V0LmlzRW1wdHkoKSkgewogICAgICAg\nICAgICBTdHJpbmcgczsKICAgICAgICAgICAgaWR4ID0gdHlwZU5hbWUubGVu\nZ3RoKCk7CiAgICAgICAgICAgIGludCBjdXJJZHggPSAtMTsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpID0gdHlwZU1vZGlmaWVyU2V0Lml0ZXJhdG9y\nKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgcyA9IChTdHJp\nbmcpIGkubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1lLnRv\nVXBwZXJDYXNlKCkuaW5kZXhPZihzKSAhPSAtMSkgewogICAgICAgICAgICAg\nICAgICAgIGN1cklkeCA9IHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkuaW5kZXhP\nZihzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VySWR4ICE9IC0xICYm\nIGN1cklkeCA8IGlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZHgg\nPSBjdXJJZHg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGlkeCAhPSB0eXBl\nTmFtZS5sZW5ndGgoKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIHJldCA9\nIHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAgICAgICAgICAgICAg\ncmV0ID0gcmV0ICsgc2l6ZTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCAr\nICcgJyArIHR5cGVOYW1lLnN1YnN0cmluZyhpZHgpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdHlwZU5hbWUgKyBzaXplOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vCiAgICAvLyBTZWxlY3RzCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBuYW1lIG9mIHRoZSBqb2luIHN5bnRheCB0byB1c2U6\nIHNxbDkyLCB0cmFkaXRpb25hbCwgZGF0YWJhc2UuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEpvaW5TeW50YXgoU3RyaW5nIHN5bnRheCkgewogICAg\nICAgIGlmICgic3FsOTIiLmVxdWFscyhzeW50YXgpKQogICAgICAgICAgICBq\nb2luU3ludGF4ID0gU1lOVEFYX1NRTDkyOwogICAgICAgIGVsc2UgaWYgKCJ0\ncmFkaXRpb25hbCIuZXF1YWxzKHN5bnRheCkpCiAgICAgICAgICAgIGpvaW5T\neW50YXggPSBTWU5UQVhfVFJBRElUSU9OQUw7CiAgICAgICAgZWxzZSBpZiAo\nImRhdGFiYXNlIi5lcXVhbHMoc3ludGF4KSkKICAgICAgICAgICAgam9pblN5\nbnRheCA9IFNZTlRBWF9EQVRBQkFTRTsKICAgICAgICBlbHNlIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShzeW50YXgpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHN5bnRheCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBTUUwgc3RyaW5nIHRvIGFjdCBhcyBh\nIHBsYWNlaG9sZGVyIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFBsYWNlaG9sZGVyVmFsdWVTdHJpbmcoQ29s\ndW1uIGNvbCkgewogICAgICAgIHN3aXRjaCAoY29sLmdldFR5cGUoKSkgewog\nICAgICAgICAgICBjYXNlIFR5cGVzLkJJR0lOVDoKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CSVQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuSU5URUdFUjoK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5OVU1FUklDOgogICAgICAgICAgICBj\nYXNlIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICBjYXNlIFR5cGVzLlRJ\nTllJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIjAiOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gKHN0\nb3JlQ2hhcnNBc051bWJlcnMpID8gIjAiIDogIicgJyI7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuQ0xPQjoKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05H\nVkFSQ0hBUjoKICAgICAgICAgICAgY2FzZSBUeXBlcy5WQVJDSEFSOgogICAg\nICAgICAgICAgICAgcmV0dXJuICInJyI7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX0RBVEVfU1RS\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRFQ0lNQUw6CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIFR5cGVzLkZM\nT0FUOgogICAgICAgICAgICBjYXNlIFR5cGVzLlJFQUw6CiAgICAgICAgICAg\nICAgICByZXR1cm4gIjAuMCI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElN\nRToKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX1RJTUVfU1RSOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAg\nIHJldHVybiBaRVJPX1RJTUVTVEFNUF9TVFI7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIk5VTEwiOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBDT1VOVCBz\ndGF0ZW1lbnQgaW4gdGhlIHByb3BlciBqb2luIHN5bnRheCBmb3IgdGhlCiAg\nICAgKiBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b1NlbGVjdENvdW50KFNlbGVjdCBzZWwpIHsKICAgICAgICBTUUxC\ndWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAg\nICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29u\nZGl0aW9ucygpOwogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9\nIG51bGwpCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwg\nZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZnJvbSA9IGdldEZy\nb20oc2VsLCBmYWxzZSk7CiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0\nV2hlcmUoc2VsLCBmYWxzZSk7CgogICAgICAgIC8vIGlmIG5vIGdyb3VwaW5n\nIGFuZCBubyByYW5nZSwgd2UgbWlnaHQgYmUgYWJsZSB0byBnZXQgYnkgd2l0\naG91dAogICAgICAgIC8vIGEgc3Vic2VsZWN0CiAgICAgICAgaWYgKHNlbC5n\nZXRHcm91cGluZygpID09IG51bGwgJiYgc2VsLmdldFN0YXJ0SW5kZXgoKSA9\nPSAwCiAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09IExvbmcu\nTUFYX1ZBTFVFKSB7CiAgICAgICAgICAgIC8vIGlmIHRoZSBzZWxlY3QgaGFz\nIG5vIGlkZW50aWZpZXIgY29scywgdXNlIENPVU5UKCopCiAgICAgICAgICAg\nIExpc3QgYWxpYXNlcyA9ICghc2VsLmlzRGlzdGluY3QoKSkgPyBDb2xsZWN0\naW9ucy5FTVBUWV9MSVNUCiAgICAgICAgICAgICAgICA6IHNlbC5nZXRJZGVu\ndGlmaWVyQWxpYXNlcygpOwogICAgICAgICAgICBpZiAodXNlV2lsZENhcmRG\nb3JDb3VudCB8fCBhbGlhc2VzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAg\nICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoKikiKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdo\nZXJlLCBudWxsLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZh\nbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIHNpbmdsZSBkaXN0aW5j\ndCBjb2wsIHVzZSBDT1VOVChESVNUSU5DVCBjb2wpCiAgICAgICAgICAgIGlm\nIChhbGlhc2VzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgICAgICBzZWxl\nY3RTUUwuYXBwZW5kKCJDT1VOVChESVNUSU5DVCAiKS4KICAgICAgICAgICAg\nICAgICAgICBhcHBlbmQoYWxpYXNlcy5nZXQoMCkudG9TdHJpbmcoKSkuYXBw\nZW5kKCIpIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2Vs\nZWN0U1FMLCBudWxsLCBmcm9tLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwK\nICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFY\nX1ZBTFVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2FuIHdl\nIGNvbWJpbmUgZGlzdGluY3QgY29scz8KICAgICAgICAgICAgaWYgKGRpc3Rp\nbmN0Q291bnRDb2x1bW5TZXBhcmF0b3IgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoRElTVElOQ1QgIik7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiICIp\nOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGRp\nc3RpbmN0Q291bnRDb2x1bW5TZXBhcmF0b3IpOwogICAgICAgICAgICAgICAg\nICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQo\nYWxpYXNlcy5nZXQoaSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIpIik7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBm\ncm9tLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAg\nICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2luY2Ugd2UgY2FuJ3Qg\nY29tYmluZSBkaXN0aW5jdCBjb2xzLCB3ZSBoYXZlIHRvIHBlcmZvcm0gYW4g\nb3V0ZXIKICAgICAgICAvLyBDT1VOVCgqKSBzZWxlY3QgdXNpbmcgdGhlIG9y\naWdpbmFsIHNlbGVjdCBhcyBhIHN1YnNlbGVjdCBpbiB0aGUKICAgICAgICAv\nLyBGUk9NIGNsYXVzZQogICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNT\ndWJzZWxlY3QsICJTdXBwb3J0c1N1YnNlbGVjdCIpOwoKICAgICAgICBTUUxC\ndWZmZXIgc3ViU2VsZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIHRydWUsIGZhbHNl\nKTsKICAgICAgICBTUUxCdWZmZXIgc3ViRnJvbSA9IGZyb207CiAgICAgICAg\nZnJvbSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgZnJvbS5hcHBl\nbmQoIigiKTsKICAgICAgICBmcm9tLmFwcGVuZCh0b1NlbGVjdChzdWJTZWxl\nY3QsIG51bGwsIHN1YkZyb20sIHdoZXJlLAogICAgICAgICAgICBzZWwuZ2V0\nR3JvdXBpbmcoKSwgc2VsLmdldEhhdmluZygpLCBudWxsLCBzZWwuaXNEaXN0\naW5jdCgpLAogICAgICAgICAgICBmYWxzZSwgc2VsLmdldFN0YXJ0SW5kZXgo\nKSwgc2VsLmdldEVuZEluZGV4KCksIHRydWUsIHNlbCkpOwogICAgICAgIGZy\nb20uYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKHJlcXVpcmVzQWxpYXNGb3JT\ndWJzZWxlY3QpCiAgICAgICAgICAgIGZyb20uYXBwZW5kKCIgIikuYXBwZW5k\nKFNlbGVjdC5GUk9NX1NFTEVDVF9BTElBUyk7CgogICAgICAgIHNlbGVjdFNR\nTC5hcHBlbmQoIkNPVU5UKCopIik7CiAgICAgICAgcmV0dXJuIHRvU2VsZWN0\nKHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwgbnVsbCwgbnVsbCwgbnVsbCwgbnVs\nbCwKICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxV\nRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBERUxFVEUgc3Rh\ndGVtZW50IGZvciB0aGUgc3BlY2lmaWVkIFNlbGVjdC4gSWYgdGhlCiAgICAg\nKiBkYXRhYmFzZSBkb2VzIG5vdCBzdXBwb3J0IHRoZSBidWxrIGRlbGV0ZSBz\ndGF0ZW1lbnQgKHN1Y2ggYXMKICAgICAqIGNhc2VzIHdoZXJlIGEgc3Vic2Vs\nZWN0IGlzIHJlcXVpcmVkIGFuZCB0aGUgZGF0YWJhc2UgZG9lc24ndCBzdXBw\nb3J0CiAgICAgKiBzdWJzZWxlY3RzKSwgdGhpcyBtZXRob2Qgc2hvdWxkIHJl\ndHVybiBudWxsLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvRGVs\nZXRlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLCAKICAgICAg\nICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gdG9CdWxrT3Bl\ncmF0aW9uKG1hcHBpbmcsIHNlbCwgbnVsbCwgcGFyYW1zLCBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvVXBkYXRlKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRlcykgewogICAgICAgIHJl\ndHVybiB0b0J1bGtPcGVyYXRpb24obWFwcGluZywgc2VsLCBzdG9yZSwgcGFy\nYW1zLCB1cGRhdGVzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndGhlIFNRTCBmb3IgYSBidWxrIG9wZXJhdGlvbiwgZWl0aGVyIGEgREVMRVRF\nIG9yIGFuIFVQREFURS4KICAgICAqCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0\naGUgbWFwcGluZyBhZ2FpbnN0IHdoaWNoIHdlIGFyZSBvcGVyYXRpbmcKICAg\nICAqIEBwYXJhbSBzZWwgdGhlIFNlbGVjdCB0aGF0IHdpbGwgY29uc3RpdHV0\nZSB0aGUgV0hFUkUgY2xhdXNlCiAgICAgKiBAcGFyYW0gc3RvcmUgdGhlIGN1\ncnJlbnQgc3RvcmUKICAgICAqIEBwYXJhbSB1cGRhdGVQYXJhbXMgdGhlIE1h\ncCB0aGF0IGhvbGRzIHRoZSB1cGRhdGUgcGFyYW1ldGVyczsgYSBudWxsCiAg\nICAgKiB2YWx1ZSBpbmRpY2F0ZXMgdGhhdCB0aGlzIGlzIGEgZGVsZXRlIG9w\nZXJhdGlvbgogICAgICogQHJldHVybiB0aGUgU1FMQnVmZmVyIGZvciB0aGUg\ndXBkYXRlLCBvciA8ZW0+bnVsbDwvZW0+IGlmIGl0IGlzIG5vdAogICAgICog\ncG9zc2libGUgdG8gcGVyZm9ybSB0aGUgYnVsayB1cGRhdGUKICAgICAqLwog\nICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciB0b0J1bGtPcGVyYXRpb24oQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIFNlbGVjdCBzZWwsCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVQYXJhbXMpIHsK\nICAgICAgICBTUUxCdWZmZXIgc3FsID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsK\nICAgICAgICBpZiAodXBkYXRlUGFyYW1zID09IG51bGwpIHsKICAgICAgICAg\nIGlmIChyZXF1aXJlc1RhcmdldEZvckRlbGV0ZSkgewogICAgICAgICAgICBz\ncWwuYXBwZW5kKCJERUxFVEUgIik7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBk\nZWxldGVUYXJnZXRzID0gZ2V0RGVsZXRlVGFyZ2V0cyhzZWwpOwogICAgICAg\nICAgICBzcWwuYXBwZW5kKGRlbGV0ZVRhcmdldHMpOwogICAgICAgICAgICBz\ncWwuYXBwZW5kKCIgRlJPTSAiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHNxbC5hcHBlbmQoIkRFTEVURSBGUk9NICIpOwogICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoIlVQREFURSAiKTsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0\naW9ucygpOwoKICAgICAgICAvLyBpZiB0aGVyZSBpcyBvbmx5IGEgc2luZ2xl\nIHRhYmxlIGluIHRoZSBzZWxlY3QsIHRoZW4gd2UgY2FuCiAgICAgICAgLy8g\nanVzdCBpc3N1ZSBhIHNpbmdsZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSA8\nY29uZGl0aW9ucz4KICAgICAgICAvLyBzdGF0ZW1lbnQ7IG90aGVyd2lzZSwg\nc2luY2UgU1FMIGRvZXNuJ3QgYWxsb3cgZGVsZXRpbmcKICAgICAgICAvLyBm\ncm9tIG9uZSBvZiBhIG11bHRpLXRhYmxlIHNlbGVjdCwgd2UgbmVlZCB0byBp\nc3N1ZSBhIHN1YnNlbGVjdAogICAgICAgIC8vIGxpa2UgREVMRVRFIEZST00g\nVEFCTEUgV0hFUkUgRVhJU1RTCiAgICAgICAgLy8gKFNFTEVDVCAxIEZST00g\nVEFCTEUgdDAgV0hFUkUgdDAuSUQgPSBUQUJMRS5JRCk7IGFsc28sIHNvbWUK\nICAgICAgICAvLyBkYXRhYmFzZXMgZG8gbm90IGFsbG93IGFsaWFzZXMgaW4g\nZGVsZXRlIHN0YXRlbWVudHMsIHdoaWNoCiAgICAgICAgLy8gYWxzbyBjYXVz\nZXMgdXMgdG8gdXNlIGEgc3Vic2VsZWN0CiAgICAgICAgQ29sbGVjdGlvbjxT\ndHJpbmc+IHNlbGVjdGVkVGFibGVzID0gZ2V0U2VsZWN0VGFibGVBbGlhc2Vz\nKHNlbCk7CiAgICAgICAgaWYgKHNlbGVjdGVkVGFibGVzLnNpemUoKSA9PSAx\nICYmIHN1cHBvcnRzU3Vic2VsZWN0CiAgICAgICAgICAgICYmIGFsbG93c0Fs\naWFzSW5CdWxrQ2xhdXNlKSB7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBmcm9t\nOwogICAgICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxlY3Qoc2VsLCBm\nYWxzZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZyb20g\nPSBnZXRGcm9tKHNlbCwgZmFsc2UpOwoKICAgICAgICAgICAgc3FsLmFwcGVu\nZChmcm9tKTsKICAgICAgICAgICAgYXBwZW5kVXBkYXRlcyhzZWwsIHN0b3Jl\nLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFyYW1zLAogICAgICAgICAgICAgICAg\nYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpOwoKICAgICAgICAgICAgU1FMQnVm\nZmVyIHdoZXJlID0gc2VsLmdldFdoZXJlKCk7CiAgICAgICAgICAgIGlmICh3\naGVyZSAhPSBudWxsICYmICF3aGVyZS5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgICAgIHNxbC5hcHBlbmQoIiBXSEVSRSAiKTsKICAgICAgICAgICAgICAg\nIHNxbC5hcHBlbmQod2hlcmUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBzcWw7CiAgICAgICAgfQoKICAgICAgICBUYWJsZSB0YWJsZSA9\nIG1hcHBpbmcuZ2V0VGFibGUoKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1l\nID0gZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKTsKCiAgICAgICAgLy8gb25s\neSB1c2UgYSAgc3Vic2VsZWN0IGlmIHRoZSB3aGVyZSBpcyBub3QgZW1wdHk7\nIG90aGVyd2lzZQogICAgICAgIC8vIGFuIHVucXVhbGlmaWVkIGRlbGV0ZSBv\nciB1cGRhdGUgd2lsbCB3b3JrCiAgICAgICAgaWYgKHNlbC5nZXRXaGVyZSgp\nID09IG51bGwgfHwgc2VsLmdldFdoZXJlKCkuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgIHNxbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICAgICAgYXBw\nZW5kVXBkYXRlcyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFy\nYW1zLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybiBzcWw7CiAgICAgICAg\nfQoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHVzZSBhIHN1YnNlbGVjdCBpZiB3\nZSBhcmUgdG8gYnVsayBkZWxldGUgd2hlcmUKICAgICAgICAvLyB0aGUgc2Vs\nZWN0IGluY2x1ZGVzIG11bHRpcGxlIHRhYmxlczsgaWYgdGhlIGRhdGFiYXNl\nCiAgICAgICAgLy8gZG9lc24ndCBzdXBwb3J0IGl0LCB0aGVuIHdlIG5lZWQg\ndG8gc2lnbmFsIHRoaXMgYnkgcmV0dXJuaW5nIG51bGwKICAgICAgICBpZiAo\nIXN1cHBvcnRzU3Vic2VsZWN0IHx8ICFzdXBwb3J0c0NvcnJlbGF0ZWRTdWJz\nZWxlY3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1\nbW5bXSBwa3MgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAg\nICAgICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAgIHNlbC5zZXREaXN0\naW5jdCh0cnVlKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBvbmx5IGEgc2lu\nZ2xlIFBLLCB3ZSBjYW4gdXNlIGEgbm9uLWNvcnJlbGF0ZWQKICAgICAgICAv\nLyBzdWJxdWVyeSAodXNpbmcgYW4gSU4gc3RhdGVtZW50KSwgd2hpY2ggaXMg\nbXVjaCBmYXN0ZXIgdGhhbgogICAgICAgIC8vIGEgY29ycmVsYXRlZCBzdWJx\ndWVyeSAoc2luY2UgYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5IG5lZWRzCiAgICAg\nICAgLy8gdG8gYmUgZXhlY3V0ZWQgb25jZSBmb3IgZWFjaCByb3cgaW4gdGhl\nIHRhYmxlKQogICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEpIHsKICAgICAg\nICAgICAgc2VsLnNlbGVjdChwa3NbMF0pOwogICAgICAgICAgICBzcWwuYXBw\nZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2Vs\nLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwog\nICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIikuCiAgICAgICAgICAg\nICAgICBhcHBlbmQocGtzWzBdKS5hcHBlbmQoIiBJTiAoIikuCiAgICAgICAg\nICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxsKSkuYXBw\nZW5kKCIpIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsLmNs\nZWFyU2VsZWN0cygpOwogICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFs\nc2UpOwoKICAgICAgICAgICAgLy8gc2luY2UgdGhlIHNlbGVjdCBpcyB1c2lu\nZyBhIGNvcnJlbGF0ZWQgc3VicXVlcnksIHdlCiAgICAgICAgICAgIC8vIG9u\nbHkgbmVlZCB0byBzZWxlY3QgYSBib2d1cyB2aXJ0dWFsIGNvbHVtbgogICAg\nICAgICAgICBzZWwuc2VsZWN0KCIxIiwgbnVsbCk7CgogICAgICAgICAgICAv\nLyBhZGQgaW4gdGhlIGpvaW5zIHRvIHRoZSB0YWJsZQogICAgICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0UHJpbWFyeUtleSgpLmdldENvbHVt\nbnMoKTsKICAgICAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZm\nZXIodGhpcyk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIigiKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKCiAgICAgICAgICAgICAgICAvLyBh\nZGQgaW4gInQwLlBLID0gTVlUQUJMRS5QSyIKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbaV0pKS5hcHBlbmQo\nIiA9ICIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZCh0YWJsZSkuYXBw\nZW5kKGNhdGFsb2dTZXBhcmF0b3IpLmFwcGVuZChjb2xzW2ldKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAg\nICAgIHNlbC53aGVyZShidWYsIG51bGwpOwoKICAgICAgICAgICAgc3FsLmFw\ncGVuZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNl\nbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsK\nICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFIEVYSVNUUyAoIikuCiAg\nICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxs\nKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzcWw7\nCiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uPFN0cmluZz4g\nZ2V0U2VsZWN0VGFibGVBbGlhc2VzKFNlbGVjdCBzZWwpIHsKICAgICAgICBy\nZXR1cm4gc2VsLmdldFRhYmxlQWxpYXNlcygpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBTUUxCdWZmZXIgZ2V0RGVsZXRlVGFyZ2V0cyhTZWxlY3Qgc2VsKSB7\nCiAgICAgIFNRTEJ1ZmZlciBkZWxldGVUYXJnZXRzID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IGFsaWFzZXMgPSBz\nZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAgICAgIC8vIEFzc3VtZXMgYWxpYXNl\ncyBhcmUgb2YgdGhlIGZvcm0gIlRBQkxFTkFNRSB0MCIKICAgICAgLy8gb3Ig\nIlwiVEFCTEUgTkFNRVwiIHQwIgogICAgICBmb3IgKEl0ZXJhdG9yPFN0cmlu\nZz4gaXRyID0gYWxpYXNlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgIFN0cmluZyB0YWJsZUFsaWFzID0gaXRyLm5leHQoKTsKICAg\nICAgICBTdHJpbmdbXSBuYW1lcyA9IE5vcm1hbGl6ZXIuc3BsaXROYW1lKHRh\nYmxlQWxpYXMsIElkZW50aWZpZXJVdGlsLlNQQUNFKTsKICAgICAgICBpZiAo\nbmFtZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgaWYgKGFsbG93c0FsaWFz\nSW5CdWxrQ2xhdXNlKSB7CiAgICAgICAgICAgIGRlbGV0ZVRhcmdldHMuYXBw\nZW5kKG5hbWVzWzFdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGRlbGV0ZVRhcmdldHMuYXBwZW5kKHRvREJOYW1lKERCSWRlbnRpZmllci5u\nZXdUYWJsZShuYW1lc1swXSkpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBlbmQodG9EQk5hbWUo\nREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlQWxpYXMpKSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgZGVsZXRl\nVGFyZ2V0cy5hcHBlbmQoIiwgIik7CiAgICAgIH0gICAgICAKICAgICAgcmV0\ndXJuIGRlbGV0ZVRhcmdldHM7ICAgICAgCiAgICB9CgogICAgcHJvdGVjdGVk\nIHZvaWQgYXBwZW5kVXBkYXRlcyhTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3Rv\ncmUsIFNRTEJ1ZmZlciBzcWwsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBN\nYXAgdXBkYXRlUGFyYW1zLCBib29sZWFuIGFsbG93QWxpYXMpIHsKICAgICAg\nICBpZiAodXBkYXRlUGFyYW1zID09IG51bGwgfHwgdXBkYXRlUGFyYW1zLnNp\nemUoKSA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1h\nbnVhbGx5IGJ1aWxkIHVwIHRoZSBTRVQgY2xhdXNlIGZvciB0aGUgVVBEQVRF\nIHN0YXRlbWVudAogICAgICAgIHNxbC5hcHBlbmQoIiBTRVQgIik7CiAgICAg\nICAgRXhwQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChzdG9yZSwgcGFy\nYW1zLCAKICAgICAgICAgICAgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCkpOwoKICAgICAgICAvLyBJZiB0aGUgdXBkYXRlcyBtYXAgY29udGFpbnMg\nYW55IHZlcnNpb24gZmllbGRzLCBhc3N1bWUgdGhhdCB0aGUKICAgICAgICAv\nLyBvcHRpbWlzdGljIGxvY2sgdmVyc2lvbiBkYXRhIGlzIGJlaW5nIGhhbmRs\nZWQgcHJvcGVybHkgYnkgdGhlCiAgICAgICAgLy8gY2FsbGVyLiBPdGhlcndp\nc2UsIGdpdmUgdGhlIHZlcnNpb24gaW5kaWNhdG9yIGFuIG9wcG9ydHVuaXR5\nIHRvCiAgICAgICAgLy8gYWRkIG1vcmUgdXBkYXRlIGNsYXVzZXMgYXMgbmVl\nZGVkLgogICAgICAgIGJvb2xlYW4gYXVnbWVudFVwZGF0ZXMgPSB0cnVlOwoK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB1cGRhdGVQYXJhbXMuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nTWFwLkVudHJ5IG5leHQgPSAoTWFwLkVudHJ5KSBpLm5leHQoKTsKICAgICAg\nICAgICAgUGF0aCBwYXRoID0gKFBhdGgpIG5leHQuZ2V0S2V5KCk7CiAgICAg\nICAgICAgIEZpZWxkTWFwcGluZyBmbWQgPSAoRmllbGRNYXBwaW5nKSBwYXRo\nLmxhc3QoKTsKCiAgICAgICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAg\nICAgICAgICAgICAgICBhdWdtZW50VXBkYXRlcyA9IGZhbHNlOwoKICAgICAg\nICAgICAgVmFsIHZhbCA9IChWYWwpIG5leHQuZ2V0VmFsdWUoKTsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgdmFsID0g\nbmV3IE51bGwoKTsKICAgICAgICAgICAgQ29sdW1uIGNvbCA9IGZtZC5nZXRD\nb2x1bW5zKClbMF07CiAgICAgICAgICAgIGlmIChhbGxvd0FsaWFzKSB7CiAg\nICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29s\nKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCh0b0RCTmFtZShjb2wuZ2V0SWRlbnRpZmllcigpKSk7CiAgICAgICAg\nICAgIH0gICAgICAgICAgICAKICAgICAgICAgICAgc3FsLmFwcGVuZCgiID0g\nIik7CgogICAgICAgICAgICBFeHBTdGF0ZSBzdGF0ZSA9IHZhbC5pbml0aWFs\naXplKHNlbCwgY3R4LCAwKTsKICAgICAgICAgICAgLy8gSkRCQyBQYXRocyBh\ncmUgYWx3YXlzIFBDUGF0aHM7IFBDUGF0aCBpbXBsZW1lbnRzIFZhbAogICAg\nICAgICAgICBFeHBTdGF0ZSBwYXRoU3RhdGUgPSAoKFZhbCkgcGF0aCkuaW5p\ndGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAgIGNhbGN1bGF0ZVZh\nbHVlKHZhbCwgc2VsLCBjdHgsIHN0YXRlLCBwYXRoLCBwYXRoU3RhdGUpOwoK\nICAgICAgICAgICAgLy8gYXBwZW5kIHRoZSB2YWx1ZSB3aXRoIGEgbnVsbCBm\nb3IgdGhlIFNlbGVjdDsgaQogICAgICAgICAgICAvLyBpbmRpY2F0ZXMgdGhh\ndCB0aGUKICAgICAgICAgICAgaW50IGxlbmd0aCA9IHZhbC5sZW5ndGgoc2Vs\nLCBjdHgsIHN0YXRlKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCBsZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIHZhbC5hcHBlbmRUbygo\nYWxsb3dBbGlhcykgPyBzZWwgOiBudWxsLCBjdHgsIHN0YXRlLCBzcWwsIGop\nOwoKICAgICAgICAgICAgaWYgKGkuaGFzTmV4dCgpKQogICAgICAgICAgICAg\nICAgc3FsLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CgogICAgICAgIGlmIChh\ndWdtZW50VXBkYXRlcykgewogICAgICAgICAgICBQYXRoIHBhdGggPSAoUGF0\naCkgdXBkYXRlUGFyYW1zLmtleVNldCgpLml0ZXJhdG9yKCkubmV4dCgpOwog\nICAgICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSAoRmllbGRNYXBwaW5nKSBw\nYXRoLmxhc3QoKTsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIG1ldGEgPSBm\nbS5nZXREZWNsYXJpbmdNYXBwaW5nKCk7CiAgICAgICAgICAgIE1hcDxDb2x1\nbW4sPz4gdXBkYXRlcyA9IG1ldGEuZ2V0VmVyc2lvbigpLmdldEJ1bGtVcGRh\ndGVWYWx1ZXMoKTsKICAgICAgICAgICAgZm9yIChNYXAuRW50cnkgZSA6IHVw\nZGF0ZXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICAgICAgQ29sdW1uIGNv\nbCA9IChDb2x1bW4pIGUuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICBPYmpl\nY3QgdmFsID0gZS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCgiLCAiKS5hcHBlbmQodG9EQk5hbWUoY29sLmdldElkZW50aWZpZXIo\nKSkpLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgICAgICAvLyBWZXJzaW9u\nIHVwZGF0ZSB2YWx1ZSBmb3IgTnVtZXJpYyB2ZXJzaW9uIGlzIGVuY29kZWQg\naW4gYSBTdHJpbmcKICAgICAgICAgICAgICAgIC8vIHRvIG1ha2UgU1FMIHN1\nY2ggYXMgdmVyc2lvbiA9IHZlcnNpb24rMSB3aGlsZSBUaW1lIHN0YW1wIHZl\ncnNpb24gaXMgcGFyYW1ldGVyaXplZAogICAgICAgICAgICAgICAgaWYgKHZh\nbCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICAgICAgICAgIHNx\nbC5hcHBlbmQoKFN0cmluZyl2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICBzcWwuYXBwZW5kVmFsdWUodmFsKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgU1FMIHRvIGRlbGV0ZSB0\naGUgY29udGVudHMgb2YgdGhlIHNwZWNpZmllZCB0YWJsZXMuIAogICAgICog\nVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZHJvcHMgYWxsIG5vbi1kZWZl\ncnJlZCBSRVNUUklDVCBmb3JlaWduIGtleSAKICAgICAqIGNvbnN0cmFpbnRz\nIGludm9sdmluZyB0aGUgc3BlY2lmaWVkIHRhYmxlcywgaXNzdWVzIERFTEVU\nRSBzdGF0ZW1lbnRzIAogICAgICogYWdhaW5zdCB0aGUgdGFibGVzLCBhbmQg\ndGhlbiBhZGRzIHRoZSBkcm9wcGVkIGNvbnN0cmFpbnRzIGJhY2sgaW4uIAog\nICAgICogRGF0YWJhc2VzIHdpdGggbW9yZSBvcHRpbWFsIHdheXMgb2YgZGVs\nZXRpbmcgdGhlIGNvbnRlbnRzIG9mIHNldmVyYWwgCiAgICAgKiB0YWJsZXMg\nc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTChUYWJsZVtd\nIHRhYmxlcyxDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICBDb2xsZWN0aW9u\nPFN0cmluZz4gc3FsID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAg\nICAgCiAgICAgICAgLy8gY29sbGVjdCBhbmQgZHJvcCBub24tZGVmZXJyZWQg\ncGh5c2ljYWwgcmVzdHJpY3QgY29uc3RyYWludHMsIGFuZAogICAgICAgIC8v\nIGNvbGxlY3QgdGhlIERFTEVURSBGUk9NIHN0YXRlbWVudHMKICAgICAgICBD\nb2xsZWN0aW9uPFN0cmluZz4gZGVsZXRlU1FMID0gbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KHRhYmxlcy5sZW5ndGgpOwogICAgICAgIENvbGxlY3Rpb248Rm9y\nZWlnbktleT4gcmVzdHJpY3RDb25zdHJhaW50cyA9CiAgICAgICAgICAgIG5l\ndyBMaW5rZWRIYXNoU2V0PEZvcmVpZ25LZXk+KCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCB0YWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlc1tpXS5nZXRGb3JlaWduS2V5\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGZrcy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFma3Nbal0uaXNMb2dp\nY2FsKCkgJiYgIWZrc1tqXS5pc0RlZmVycmVkKCkgCiAgICAgICAgICAgICAg\nICAgICAgJiYgZmtzW2pdLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25L\nZXkuQUNUSU9OX1JFU1RSSUNUKQogICAgICAgICAgICAgICAgcmVzdHJpY3RD\nb25zdHJhaW50cy5hZGQoZmtzW2pdKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAKICAgICAgICAgICAgZGVsZXRlU1FMLmFkZCgiREVMRVRFIEZST00g\nIiArIAogICAgICAgICAgICAgICAgdG9EQk5hbWUodGFibGVzW2ldLmdldEZ1\nbGxJZGVudGlmaWVyKCkpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\nZm9yKEZvcmVpZ25LZXkgZmsgOiByZXN0cmljdENvbnN0cmFpbnRzKSB7CiAg\nICAgICAgICAgIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSBnZXREcm9wRm9y\nZWlnbktleVNRTChmayxjb25uKTsKICAgICAgICAgICAgc3FsLmFkZEFsbChB\ncnJheXMuYXNMaXN0KGNvbnN0cmFpbnRTUUwpKTsKICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxldGUgc3RhdGVtZW50cyBhZnRl\nciBhbGwgdGhlIGNvbnN0cmFpbnQgbXV0YXRpb25zCiAgICAgICAgc3FsLmFk\nZEFsbChkZWxldGVTUUwpOwogICAgICAgIAogICAgICAgIC8vIGFkZCB0aGUg\nZGVsZXRlZCBjb25zdHJhaW50cyBiYWNrIHRvIHRoZSBzY2hlbWEKICAgICAg\nICBmb3IgKEZvcmVpZ25LZXkgZmsgOiByZXN0cmljdENvbnN0cmFpbnRzKSB7\nCiAgICAgICAgICAgIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSBnZXRBZGRG\nb3JlaWduS2V5U1FMKGZrKTsKICAgICAgICAgICAgc3FsLmFkZEFsbChBcnJh\neXMuYXNMaXN0KGNvbnN0cmFpbnRTUUwpKTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcmV0dXJuIChTdHJpbmdbXSkgc3FsLnRvQXJyYXkobmV3IFN0\ncmluZ1tzcWwuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBTRUxFQ1Qgc3RhdGVtZW50IGluIHRoZSBwcm9wZXIgam9pbiBzeW50\nYXggZm9yIHRoZSBnaXZlbgogICAgICogaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU2VsZWN0IHNlbCwgYm9vbGVh\nbiBmb3JVcGRhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIHNlbC5hZGRKb2luQ2xhc3NDb25kaXRpb25zKCk7\nCiAgICAgICAgYm9vbGVhbiB1cGRhdGUgPSBmb3JVcGRhdGUgJiYgc2VsLmdl\ndEZyb21TZWxlY3QoKSA9PSBudWxsOwogICAgICAgIFNRTEJ1ZmZlciBzZWxl\nY3QgPSBnZXRTZWxlY3RzKHNlbCwgZmFsc2UsIHVwZGF0ZSk7CiAgICAgICAg\nU1FMQnVmZmVyIG9yZGVyaW5nID0gbnVsbDsKICAgICAgICBpZiAoIXNlbC5p\nc0FnZ3JlZ2F0ZSgpIHx8IHNlbC5nZXRHcm91cGluZygpICE9IG51bGwpCiAg\nICAgICAgICAgIG9yZGVyaW5nID0gc2VsLmdldE9yZGVyaW5nKCk7CiAgICAg\nICAgU1FMQnVmZmVyIGZyb207CiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2Vs\nZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxl\nY3Qoc2VsLCBmb3JVcGRhdGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nZnJvbSA9IGdldEZyb20oc2VsLCB1cGRhdGUpOwogICAgICAgIFNRTEJ1ZmZl\nciB3aGVyZSA9IGdldFdoZXJlKHNlbCwgdXBkYXRlKTsKICAgICAgICByZXR1\ncm4gdG9TZWxlY3Qoc2VsZWN0LCBmZXRjaCwgZnJvbSwgd2hlcmUsIHNlbC5n\nZXRHcm91cGluZygpLAogICAgICAgICAgICBzZWwuZ2V0SGF2aW5nKCksIG9y\nZGVyaW5nLCBzZWwuaXNEaXN0aW5jdCgpLCBmb3JVcGRhdGUsCiAgICAgICAg\nICAgIHNlbC5nZXRTdGFydEluZGV4KCksIHNlbC5nZXRFbmRJbmRleCgpLCBz\nZWwpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwb3J0aW9u\nIG9mIHRoZSBzZWxlY3Qgc3RhdGVtZW50IGJldHdlZW4gdGhlIEZST00ga2V5\nd29yZAogICAgICogYW5kIHRoZSBXSEVSRSBrZXl3b3JkLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldEZyb20oU2VsZWN0IHNlbCwgYm9v\nbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICBTUUxCdWZmZXIgZnJvbVNRTCA9\nIG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgQ29sbGVjdGlvbiBhbGlh\nc2VzID0gc2VsLmdldFRhYmxlQWxpYXNlcygpOwogICAgICAgIGlmIChhbGlh\nc2VzLnNpemUoKSA8IDIgfHwgc2VsLmdldEpvaW5TeW50YXgoKSAhPSBTWU5U\nQVhfU1FMOTIpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBh\nbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICBmcm9tU1FMLmFwcGVuZChpdHIubmV4dCgpLnRvU3RyaW5nKCkp\nOwogICAgICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVw\nZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZyb21T\nUUwuYXBwZW5kKCIgIikuYXBwZW5kKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsK\nICAgICAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAg\nICAgICAgICAgIGZyb21TUUwuYXBwZW5kKCIsICIpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChhbGlhc2VzLnNpemUoKSA8IDIgJiYgc2VsLmdl\ndFBhcmVudCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHN1YnF1\nZXJ5IG1heSBjb250YWluIGNvcnJlbGF0ZWQgam9pbnMKICAgICAgICAgICAg\nICAgIEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsKICAg\nICAgICAgICAgICAgIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgSm9pbiBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgLy8gYXBwZW5kIHdoZXJlIGNsYXVzZQogICAg\nICAgICAgICAgICAgICAgIGlmIChqb2luLmlzQ29ycmVsYXRlZCgpICYmIGpv\naW4uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcih0aGlz\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUuYXBwZW5kKCIoIiku\nYXBwZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKS5hcHBlbmQoIikiKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgc2VsLndoZXJlKHdoZXJlLmdldFNR\nTCgpKTsKICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIAog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgSXRlcmF0b3IgaXRyID0gc2VsLmdldEpvaW5JdGVy\nYXRvcigpOwogICAgICAgICAgICBib29sZWFuIGZpcnN0ID0gdHJ1ZTsKICAg\nICAgICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAg\nICAgIEpvaW4gam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgaWYgKGNvcnJlbGF0ZWRKb2luQ29uZGl0aW9uKGpvaW4sIHNlbCkp\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAg\nICAgaWYgKGpvaW4uaXNDb3JyZWxhdGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgdG9Db3JyZWxhdGVkSm9pbihzZWwsIGpvaW4sIGZvclVwZGF0ZSwgZmly\nc3QpOyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNl\nICAgIAogICAgICAgICAgICAgICAgICAgIGZyb21TUUwuYXBwZW5kKHRvU1FM\nOTJKb2luKHNlbCwgam9pbiwgZm9yVXBkYXRlLAogICAgICAgICAgICAgICAg\nICAgICAgICBmaXJzdCkpOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxz\nZTsKICAgICAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpICYmIGpvaW4u\naXNDb3JyZWxhdGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJv\nbVNRTC5nZXRTUUwoKS5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZyb21TUUwuYXBwZW5kKCIsICIpOwogICAgICAgICAgICAgICAg\nICAgIGZpcnN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIyID0gYWxpYXNl\ncy5pdGVyYXRvcigpOyBpdHIyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIFN0cmluZyB0YWJsZUFsaWFzID0gaXRyMi5uZXh0KCkudG9TdHJpbmco\nKTsKICAgICAgICAgICAgICAgIGlmIChmcm9tU1FMLmdldFNRTCgpLmluZGV4\nT2YodGFibGVBbGlhcykgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoIWZpcnN0ICYmIGZyb21TUUwuZ2V0U1FMKCkubGVuZ3RoKCkgPiAwKQog\nICAgICAgICAgICAgICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCgiLCAiKTsK\nICAgICAgICAgICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCh0YWJsZUFsaWFz\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxl\nRm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZyb21TUUwuYXBwZW5kKCIgIikuYXBwZW5kKHRhYmxlRm9yVXBkYXRl\nQ2xhdXNlKTsKICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmcm9tU1FMOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVh\nbiBjb3JyZWxhdGVkSm9pbkNvbmRpdGlvbihKb2luIGpvaW4sIFNlbGVjdCBz\nZWwpIHsKICAgICAgICBpZiAoIWpvaW4uaXNDb3JyZWxhdGVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBJdGVyYXRvciBpdHIgPSBz\nZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAgYm9vbGVhbiBza2lwID0g\nZmFsc2U7CiAgICAgICAgLy9pZiB0YWJsZTEgaW4gam9pbiBpcyBpbiB0aGUg\nbWFpbiBxdWVyeSwgdGFibGUyIGlzIGluCiAgICAgICAgLy9zdWJxdWVyeSwg\nYW5kIHRhYmxlMiBwYXJ0aWNpcGF0ZXMgaW4gb3RoZXIgam9pbnMKICAgICAg\nICAvL2luIHN1YnF1ZXJ5LCB0aGUgam9pbiBjb25kaXRpb24gY2FuIG9ubHkg\nYmUgcGxhY2VkIGluIAogICAgICAgIC8vdGhlIHdoZXJlIGNsYXVzZSBpbiB0\naGUgc3VicXVlcnkKICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewog\nICAgICAgICAgICBKb2luIGpvaW4xID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgIGlmIChqb2luID09IGpvaW4xICYmICFqb2luLmlzRm9yZWln\nbktleUludmVyc2VkKCkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChqb2luLmdldEluZGV4Migp\nID09IGpvaW4xLmdldEluZGV4MSgpIHx8CiAgICAgICAgICAgICAgICBqb2lu\nLmdldEluZGV4MigpID09IGpvaW4xLmdldEluZGV4MigpKSB7CiAgICAgICAg\nICAgICAgICBza2lwID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChqb2lu\nLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKXsKICAgICAgICAgICAgICAgICAg\nICBTUUxCdWZmZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAg\nICAgICAgICAgICAgICAgIHdoZXJlLmFwcGVuZCgiKCIpLmFwcGVuZCh0b1Ry\nYWRpdGlvbmFsSm9pbihqb2luKSkuYXBwZW5kKCIpIik7CiAgICAgICAgICAg\nICAgICAgICAgc2VsLndoZXJlKHdoZXJlLmdldFNRTCgpKTsKICAgICAgICAg\nICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2tp\ncDsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nRlJPTSBjbGF1c2UgZm9yIGEgc2VsZWN0IHRoYXQgc2VsZWN0cyBmcm9tIGEg\ndG1wIHRhYmxlCiAgICAgKiBjcmVhdGVkIGJ5IGFuIGlubmVyIHNlbGVjdC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRGcm9tU2VsZWN0\nKFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgU1FM\nQnVmZmVyIGZyb21TUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAg\nIGZyb21TUUwuYXBwZW5kKCIoIik7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQo\ndG9TZWxlY3Qoc2VsLmdldEZyb21TZWxlY3QoKSwgZm9yVXBkYXRlLCBudWxs\nKSk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQoIikiKTsKICAgICAgICBpZiAo\ncmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAgZnJvbVNR\nTC5hcHBlbmQoIiAiKS5hcHBlbmQoU2VsZWN0LkZST01fU0VMRUNUX0FMSUFT\nKTsKICAgICAgICByZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgV0hFUkUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0\nYXRlbWVudCwgb3IgbnVsbCBpZiBubyB3aGVyZQogICAgICogY29uZGl0aW9u\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRXaGVyZShT\nZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIEpvaW5z\nIGpvaW5zID0gc2VsLmdldEpvaW5zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRK\nb2luU3ludGF4KCkgPT0gU1lOVEFYX1NRTDkyCiAgICAgICAgICAgIHx8IGpv\naW5zID09IG51bGwgfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gc2VsLmdldFdoZXJlKCk7CgogICAgICAgIFNRTEJ1ZmZlciB3aGVy\nZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKHNlbC5nZXRX\naGVyZSgpICE9IG51bGwpCiAgICAgICAgICAgIHdoZXJlLmFwcGVuZChzZWwu\nZ2V0V2hlcmUoKSk7CiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAg\nICAgICAgIHNlbC5hcHBlbmQod2hlcmUsIGpvaW5zKTsKICAgICAgICByZXR1\ncm4gd2hlcmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVu\nIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJs\nZXMgaW4KICAgICAqIHRoZSB0cmFkaXRpb25hbCBzdHlsZS4KICAgICAqLwog\nICAgcHVibGljIFNRTEJ1ZmZlciB0b1RyYWRpdGlvbmFsSm9pbihKb2luIGpv\naW4pIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0gam9pbi5nZXRGb3JlaWdu\nS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGludmVyc2UgPSBqb2luLmlz\nRm9yZWlnbktleUludmVyc2VkKCk7CiAgICAgICAgQ29sdW1uW10gZnJvbSA9\nIChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkKICAgICAg\nICAgICAgOiBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG8g\nPSAoaW52ZXJzZSkgPyBmay5nZXRDb2x1bW5zKCkKICAgICAgICAgICAgOiBm\nay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICAvLyBkbyBjb2x1\nbW4gam9pbnMKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZnJvbS5sZW5ndGg7IGkrKywgY291bnQrKykgewog\nICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2lu\nLmdldEFsaWFzMSgpKS5hcHBlbmQoIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0\nb1tpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBkbyBjb25zdGFudCBqb2lu\ncwogICAgICAgIENvbHVtbltdIGNvbnN0Q29scyA9IGZrLmdldENvbnN0YW50\nQ29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RD\nb2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChj\nb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmRWYWx1ZShmay5nZXRDb25zdGFudChjb25zdENvbHNbaV0pLCBj\nb25zdENvbHNbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLgog\nICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0pOwogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChp\nbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFs\naWFzMigpKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBl\nbmQoY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNvbnN0Q29s\nc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBDb2x1\nbW5bXSBjb25zdENvbHNQSyA9IGZrLmdldENvbnN0YW50UHJpbWFyeUtleUNv\nbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnN0Q29s\nc1BLLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChj\nb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIikuCiAgICAg\nICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0Q29sc1BLW2ldKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZr\nLmdldFByaW1hcnlLZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAg\nICAgICAgICAgICAgICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlL\nZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgi\nLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNQS1tp\nXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3Jl\nYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBTUUw5\nMiBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NRTDky\nSm9pbihTZWxlY3Qgc2VsLCBKb2luIGpvaW4sIGJvb2xlYW4gZm9yVXBkYXRl\nLAogICAgICAgIGJvb2xlYW4gZmlyc3QpIHsKICAgICAgICBTUUxCdWZmZXIg\nYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKCiAgICAgICAgaWYgKGZpcnN0\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTEoKSku\nYXBwZW5kKCIgIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoam9pbi5nZXRB\nbGlhczEoKSk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVG\nb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAg\nICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgIGlmIChq\nb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQob3V0ZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNlIGlm\nIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoaW5uZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNl\nIC8vIGNyb3NzCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoY3Jvc3NKb2luQ2xh\ndXNlKTsKICAgICAgICBidWYuYXBwZW5kKCIgIik7CgogICAgICAgIGJ1Zi5h\ncHBlbmQoam9pbi5nZXRUYWJsZTIoKSkuYXBwZW5kKCIgIikuYXBwZW5kKGpv\naW4uZ2V0QWxpYXMyKCkpOwogICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFi\nbGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CgogICAg\nICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKHRvVHJhZGl0aW9uYWxK\nb2luKGpvaW4pKTsKICAgICAgICBlbHNlIGlmIChyZXF1aXJlc0NvbmRpdGlv\nbkZvckNyb3NzSm9pbiAmJgogICAgICAgICAgICAgICAgam9pbi5nZXRUeXBl\nKCkgPT0gSm9pbi5UWVBFX0NST1NTKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgT04gKDEgPSAxKSIpOwogICAgICAgIAogICAgICAgIHJldHVybiBidWY7\nCiAgICB9CgogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9Db3JyZWxhdGVkSm9p\nbihTZWxlY3Qgc2VsLCBKb2luIGpvaW4sIGJvb2xlYW4gZm9yVXBkYXRlLAog\nICAgICAgIGJvb2xlYW4gZmlyc3QpIHsKICAgICAgICBpZiAoam9pbi5nZXRG\nb3JlaWduS2V5KCkgIT0gbnVsbCl7CiAgICAgICAgICAgIFNRTEJ1ZmZlciB3\naGVyZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgICAgIHdoZXJl\nLmFwcGVuZCgiKCIpLmFwcGVuZCh0b1RyYWRpdGlvbmFsSm9pbihqb2luKSku\nYXBwZW5kKCIpIik7CiAgICAgICAgICAgIHNlbC53aGVyZSh3aGVyZS5nZXRT\nUUwoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFVzZSB0aGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0\nbyBjcmVhdGUgU1FMIGpvaW5pbmcgaXRzIHRhYmxlcyBpbgogICAgICogdGhl\nIGRhdGFiYXNlJ3MgbmF0aXZlIHN5bnRheC4gVGhyb3dzIGFuIGV4Y2VwdGlv\nbiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRv\nTmF0aXZlSm9pbihKb2luIGpvaW4pIHsKICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgaWYgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGNhbiBiZSBlYWdlcmx5\nIGxvYWRlZCB1c2luZyBvdGhlciBqb2lucy4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gY2FuT3V0ZXJKb2luKGludCBzeW50YXgsIEZvcmVpZ25LZXkg\nZmspIHsKICAgICAgICByZXR1cm4gc3ludGF4ICE9IFNZTlRBWF9UUkFESVRJ\nT05BTDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbWJpbmUgdGhlIGdpdmVu\nIGNvbXBvbmVudHMgaW50byBhIFNFTEVDVCBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVj\ndHMsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgU1FM\nQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3Vw\nLAogICAgICAgIFNRTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwK\nICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwg\nbG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICByZXR1cm4gdG9PcGVy\nYXRpb24oZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJv\nbSwgd2hlcmUsCiAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBk\naXN0aW5jdCwgc3RhcnQsIGVuZCwKICAgICAgICAgICAgZ2V0Rm9yVXBkYXRl\nQ2xhdXNlKGZldGNoLCBmb3JVcGRhdGUsIG51bGwpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGNvbXBvbmVudHMgaW50byBh\nIFNFTEVDVCBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMsCiAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIg\nZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAg\nICAgU1FMQnVmZmVyIGhhdmluZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAg\nIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICBib29sZWFuIHN1YnNlbGVjdCwgU2Vs\nZWN0IHNlbCkgewogICAgICAgIHJldHVybiB0b09wZXJhdGlvbihnZXRTZWxl\nY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwKICAg\nICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIsIGRpc3RpbmN0LCBzdGFy\ndCwgZW5kLAogICAgICAgICAgICBnZXRGb3JVcGRhdGVDbGF1c2UoZmV0Y2gs\nIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCk7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgICAgIFNR\nTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91\ncCwKICAgICAgICAgICAgU1FMQnVmZmVyIGhhdmluZywgU1FMQnVmZmVyIG9y\nZGVyLAogICAgICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBib29sZWFuIGZv\nclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgICAgIGJv\nb2xlYW4gc3Vic2VsZWN0LCBib29sZWFuIGNoZWNrVGFibGVGb3JVcGRhdGUp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9w\nZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAogICAgICAg\nICAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwg\nc3RhcnQsIGVuZCwKICAgICAgICAgICAgICAgICAgICBnZXRGb3JVcGRhdGVD\nbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCwKICAg\nICAgICAgICAgICAgICAgICBjaGVja1RhYmxlRm9yVXBkYXRlKTsKICAgICAg\nICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjb21wb25l\nbnRzIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50LgogICAgICovCiAgICBwcm90\nZWN0ZWQgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RzLCAK\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAg\nIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBn\ncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3Jk\nZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JVcGRh\ndGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFNlbGVjdCBzZWwp\nIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24oZ2V0U2VsZWN0T3BlcmF0\naW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwgd2hlcmUsCiAgICAgICAgICAg\nIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwgc3RhcnQsIGVuZCwK\nICAgICAgICAgICAgZ2V0Rm9yVXBkYXRlQ2xhdXNlKGZldGNoLCBmb3JVcGRh\ndGUsIHNlbCkpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSB1cGRh\ndGUgY2xhdXNlIGZvciB0aGUgcXVlcnkgYmFzZWQgb24gdGhlCiAgICAgKiB1\ncGRhdGVDbGF1c2UgYW5kIGlzb2xhdGlvbkxldmVsIGhpbnRzCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Rm9yVXBkYXRlQ2xhdXNlKEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgYm9vbGVhbiBpc0Zv\nclVwZGF0ZSwgU2VsZWN0IHNlbCkgewogICAgICAgIGlmIChmZXRjaCAhPSBu\ndWxsICYmIGZldGNoLmdldElzb2xhdGlvbigpICE9IC0xKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nCiAgICAgICAgICAgICAgICAiaXNvbGF0aW9uLWxldmVsLWNvbmZpZy1ub3Qt\nc3VwcG9ydGVkIiwgZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKTsKICAgICAgICB9\nIGVsc2UgaWYgKGlzRm9yVXBkYXRlICYmICFzaW11bGF0ZUxvY2tpbmcpIHsK\nICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1NlbGVjdEZvclVw\nZGF0ZSwgIlN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlIik7CiAgICAgICAgICAg\nIHJldHVybiBmb3JVcGRhdGVDbGF1c2U7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGRpY3Rpb25hcnkgdXNlcyBp\nc29sYXRpb24gbGV2ZWwgdG8gY29tcHV0ZSB0aGUgCiAgICAgKiByZXR1cm5l\nZCBnZXRGb3JVcGRhdGVDbGF1c2UoKSBTUUwgY2xhdXNlLiAgCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzSXNvbGF0aW9uRm9yVXBkYXRl\nKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlICJTRUxFQ1QiIG9wZXJhdGlvbiBjbGF1c2Us\nIGFkZGluZyBhbnkgYXZhaWxhYmxlIGhpbnRzLCBldGMuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0U2VsZWN0T3BlcmF0aW9uKEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gIlNFTEVDVCI7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgdGhl\nIGdpdmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9wLCBTUUxCdWZmZXIg\nc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdo\nZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBoYXZpbmcsCiAgICAg\nICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3RpbmN0LCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9yVXBkYXRlQ2xhdXNl\nKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBm\ncm9tLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAgICAg\nIGRpc3RpbmN0LCBzdGFydCwgZW5kLCBmb3JVcGRhdGVDbGF1c2UsIGZhbHNl\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBm\nb3IgdGhlIGdpdmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9wLCBTUUxC\ndWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVm\nZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBoYXZpbmcs\nCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3RpbmN0LCBs\nb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9yVXBkYXRl\nQ2xhdXNlLCBib29sZWFuIHN1YnNlbGVjdCkgewogICAgICAgIHJldHVybiB0\nb09wZXJhdGlvbihvcCwgc2VsZWN0cywgZnJvbSwgd2hlcmUsIGdyb3VwLCBo\nYXZpbmcsIG9yZGVyLAogICAgICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0\nLCBlbmQsIGZvclVwZGF0ZUNsYXVzZSwgc3Vic2VsZWN0LCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgdGhlIGdp\ndmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nU1FMQnVmZmVyIHRvT3BlcmF0aW9uKFN0cmluZyBvcCwgU1FMQnVmZmVyIHNl\nbGVjdHMsIFNRTEJ1ZmZlciBmcm9tLAogICAgICAgICAgICBTUUxCdWZmZXIg\nd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVyIGhhdmluZywgU1FM\nQnVmZmVyIG9yZGVyLAogICAgICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBs\nb25nIHN0YXJ0LCBsb25nIGVuZCwgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSwK\nICAgICAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QsIGJvb2xlYW4gY2hlY2tU\nYWJsZUZvclVwZGF0ZSkgewogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcg\nU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGJ1Zi5hcHBlbmQob3ApOwoKICAg\nICAgICBib29sZWFuIHJhbmdlID0gc3RhcnQgIT0gMCB8fCBlbmQgIT0gTG9u\nZy5NQVhfVkFMVUU7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRp\nb24gPT0gUkFOR0VfUFJFX0RJU1RJTkNUKQogICAgICAgICAgICBhcHBlbmRT\nZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAg\nICAgaWYgKGRpc3RpbmN0KQogICAgICAgICAgICBidWYuYXBwZW5kKCIgRElT\nVElOQ1QiKTsKICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9\nPSBSQU5HRV9QT1NUX0RJU1RJTkNUKQogICAgICAgICAgICBhcHBlbmRTZWxl\nY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CgogICAgICAg\nIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQoc2VsZWN0cykuYXBwZW5kKCIgRlJP\nTSAiKS5hcHBlbmQoZnJvbSk7CgogICAgICAgIGlmIChjaGVja1RhYmxlRm9y\nVXBkYXRlCiAgICAgICAgICAgICAgICAmJiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShmb3JVcGRhdGVDbGF1c2UpICYmICFTdHJpbmdVdGlscwogICAgICAgICAg\nICAgICAgICAgICAgICAuaXNFbXB0eSh0YWJsZUZvclVwZGF0ZUNsYXVzZSkp\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVG\nb3JVcGRhdGVDbGF1c2UpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZXJl\nICE9IG51bGwgJiYgIXdoZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIFdIRVJFICIpLmFwcGVuZCh3aGVyZSk7CiAgICAgICAgaWYg\nKGdyb3VwICE9IG51bGwgJiYgIWdyb3VwLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEdST1VQIEJZICIpLmFwcGVuZChncm91cCk7CiAg\nICAgICAgaWYgKGhhdmluZyAhPSBudWxsICYmICFoYXZpbmcuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNIYXZpbmcs\nICJTdXBwb3J0c0hhdmluZyIpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nSEFWSU5HICIpLmFwcGVuZChoYXZpbmcpOwogICAgICAgIH0KICAgICAgICBp\nZiAob3JkZXIgIT0gbnVsbCAmJiAhb3JkZXIuaXNFbXB0eSgpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgT1JERVIgQlkgIikuYXBwZW5kKG9yZGVyKTsK\nICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9PSBSQU5HRV9Q\nT1NUX1NFTEVDVCkKICAgICAgICAgICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVm\nLCBzdGFydCwgZW5kLCBzdWJzZWxlY3QpOwogICAgICAgIGlmIChmb3JVcGRh\ndGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZChmb3JVcGRhdGVDbGF1c2UpOwogICAgICAgIGlmIChyYW5nZSAm\nJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfTE9DSykKICAgICAgICAg\nICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5kLCBzdWJzZWxl\nY3QpOwogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJZiB0aGlzIGRpY3Rpb25hcnkgY2FuIHNlbGVjdCByYW5nZXMsCiAgICAg\nKiB1c2UgdGhpcyBtZXRob2QgdG8gYXBwZW5kIHRoZSByYW5nZSBTUUwuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZFNlbGVjdFJhbmdlKFNR\nTEJ1ZmZlciBidWYsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIGJv\nb2xlYW4gc3Vic2VsZWN0KSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0d2Vl\nbiB0aGUgU0VMRUNUIGtleXdvcmQKICAgICAqIGFuZCB0aGUgRlJPTSBrZXl3\nb3JkLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNlbGVj\ndHMoU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJzLAog\nICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gYXBwZW5k\nIHRoZSBhbGlhc2VzIGZvciBhbGwgdGhlIGNvbHVtbnMKICAgICAgICBTUUxC\ndWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAg\nICBMaXN0IGFsaWFzZXM7CiAgICAgICAgaWYgKGRpc3RpbmN0SWRlbnRpZmll\ncnMpCiAgICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0SWRlbnRpZmllckFs\naWFzZXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFsaWFzZXMgPSBz\nZWwuZ2V0U2VsZWN0QWxpYXNlcygpOwoKICAgICAgICBPYmplY3QgYWxpYXM7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLnNpemUoKTsg\naSsrKSB7CiAgICAgICAgICAgIGFsaWFzID0gYWxpYXNlcy5nZXQoaSk7CiAg\nICAgICAgICAgIGlmIChhbGlhcyBpbnN0YW5jZW9mIFN0cmluZykgewogICAg\nICAgICAgICAgICAgYWxpYXMgPSBnZXROYW1pbmdVdGlsKCkuY29udmVydEFs\naWFzKChTdHJpbmcpYWxpYXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGFwcGVuZFNlbGVjdChzZWxlY3RTUUwsIGFsaWFzLCBzZWwsIGkpOwogICAg\nICAgICAgICBpZiAoaSA8IGFsaWFzZXMuc2l6ZSgpIC0gMSkKICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBzZWxlY3RTUUw7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgPGNvZGU+ZWxlbTwvY29kZT4gdG8gPGNvZGU+c2VsZWN0U1FMPC9j\nb2RlPi4KICAgICAqIEBwYXJhbSBzZWxlY3RTUUwgVGhlIFNRTEJ1ZmZlciB0\nbyBhcHBlbmQgdG8uCiAgICAgKiBAcGFyYW0gYWxpYXMgQSB7QGxpbmsgU1FM\nQnVmZmVyfSBvciBhIHtAbGluayBTdHJpbmd9IHRvIGFwcGVuZC4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgYXBwZW5kU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RTUUwsIE9iamVjdCBl\nbGVtLCBTZWxlY3Qgc2VsLAogICAgICAgIGludCBpZHgpIHsKICAgICAgICBp\nZiAoZWxlbSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZCgoU1FMQnVmZmVyKSBlbGVtKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoZWxlbS50b1N0cmluZygp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBhICJG\nT1IgVVBEQVRFIiBjbGF1c2UgY2FuIGJlIHVzZWQgZm9yIHRoZSBzcGVjaWZp\nZWQKICAgICAqIFNlbGVjdCBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIHN1cHBvcnRzTG9ja2luZyhTZWxlY3Qgc2VsKSB7CiAgICAgICAg\naWYgKHNlbC5pc0FnZ3JlZ2F0ZSgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NlbGVjdEZvclVwZGF0ZSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNM\nb2NraW5nV2l0aFNlbGVjdFJhbmdlICYmIChzZWwuZ2V0U3RhcnRJbmRleCgp\nICE9IDAKICAgICAgICAgICAgfHwgc2VsLmdldEVuZEluZGV4KCkgIT0gTG9u\nZy5NQVhfVkFMVUUpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIC8vIG9ubHkgaW5uZXIgc2VsZWN0IGlzIGxvY2tlZAogICAgICAgIGlm\nIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgIHNl\nbCA9IHNlbC5nZXRGcm9tU2VsZWN0KCk7CgogICAgICAgIGlmICghc3VwcG9y\ndHNMb2NraW5nV2l0aERpc3RpbmN0Q2xhdXNlICYmIHNlbC5pc0Rpc3RpbmN0\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1\ncHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcwogICAgICAgICAgICAm\nJiBzZWwuZ2V0VGFibGVBbGlhc2VzKCkuc2l6ZSgpID4gMSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5n\nV2l0aE9yZGVyQ2xhdXNlICYmIHNlbC5nZXRPcmRlcmluZygpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBv\ncnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gfHwgIXN1cHBvcnRzTG9ja2luZ1dp\ndGhJbm5lckpvaW4pIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBKb2luIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE91dGVy\nSm9pbgogICAgICAgICAgICAgICAgICAgICYmIGpvaW4uZ2V0VHlwZSgpID09\nIEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dp\ndGhJbm5lckpvaW4KICAgICAgICAgICAgICAgICAgICAmJiBqb2luLmdldFR5\ncGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGZh\nbHNlIGlmIHRoZSBnaXZlbiBzZWxlY3QgcmVxdWlyZXMgYSBmb3J3YXJkLW9u\nbHkgcmVzdWx0IHNldC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQoU2VsZWN0IHNlbCwKICAgICAg\nICBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIHJldHVybiAhc2VsLmlz\nQWdncmVnYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhh\ndCB0aGUgZ2l2ZW4gZGljdGlvbmFyeSBmbGFnIGlzIHRydWUuIElmIGl0IGlz\nIG5vdCB0cnVlLAogICAgICogdGhyb3cgYW4gZXJyb3Igc2F5aW5nIHRoYXQg\ndGhlIGdpdmVuIHNldHRpbmcgbmVlZHMgdG8gcmV0dXJuIHRydWUgZm9yCiAg\nICAgKiB0aGUgY3VycmVudCBvcGVyYXRpb24gdG8gd29yay4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgYXNzZXJ0U3VwcG9ydChib29sZWFuIGZlYXR1cmUs\nIFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIGlmICghZmVhdHVyZSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJmZWF0dXJlLW5vdC1zdXBwb3J0ZWQiLAogICAgICAgICAgICAgICAg\nZ2V0Q2xhc3MoKSwgcHJvcGVydHkpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gUXVlcnkgZnVuY3Rpb25zCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogSW52b2tlIHRoaXMgZGF0\nYWJhc2UncyBzdWJzdHJpbmcgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBh\ncmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgc3Vic3RyaW5n\nIGludm9jYXRpb24gdG8KICAgICAqIEBwYXJhbSBzdHIgYSBxdWVyeSB2YWx1\nZSByZXByZXNlbnRpbmcgdGhlIHRhcmdldCBzdHJpbmcKICAgICAqIEBwYXJh\nbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgc3RhcnQg\naW5kZXgKICAgICAqIEBwYXJhbSBlbmQgYSBxdWVyeSB2YWx1ZSByZXByZXNl\nbnRpbmcgdGhlIGVuZCBpbmRleCwgb3IgbnVsbCBmb3Igbm9uZQogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzdWJzdHJpbmcoU1FMQnVmZmVyIGJ1ZiwgRmls\ndGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBzdGFydCwKICAgICAgICBGaWx0\nZXJWYWx1ZSBlbmQpIHsKICAgICAgICBidWYuYXBwZW5kKHN1YnN0cmluZ0Z1\nbmN0aW9uTmFtZSkuYXBwZW5kKCIoIik7CiAgICAgICAgc3RyLmFwcGVuZFRv\nKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICBpZiAo\nc3RhcnQuZ2V0VmFsdWUoKSBpbnN0YW5jZW9mIE51bWJlcikgewogICAgICAg\nICAgICBsb25nIHN0YXJ0TG9uZyA9IHRvTG9uZyhzdGFydCk7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoTG9uZy50b1N0cmluZyhzdGFydExvbmcgKyAxKSk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgKyAxKSIpOwogICAgICAgIH0KICAgICAgICBpZiAo\nZW5kICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsK\nICAgICAgICAgICAgaWYgKHN0YXJ0LmdldFZhbHVlKCkgaW5zdGFuY2VvZiBO\ndW1iZXIKICAgICAgICAgICAgICAgICYmIGVuZC5nZXRWYWx1ZSgpIGluc3Rh\nbmNlb2YgTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0TG9u\nZyA9IHRvTG9uZyhzdGFydCk7CiAgICAgICAgICAgICAgICBsb25nIGVuZExv\nbmcgPSB0b0xvbmcoZW5kKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nTG9uZy50b1N0cmluZyhlbmRMb25nIC0gc3RhcnRMb25nKSk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbmQuYXBwZW5kVG8oYnVm\nKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAtICgiKTsKICAgICAg\nICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIGxvbmcgdG9Mb25n\nKEZpbHRlclZhbHVlIGxpdFZhbHVlKSB7CiAgICAgICAgcmV0dXJuICgoTnVt\nYmVyKSBsaXRWYWx1ZS5nZXRWYWx1ZSgpKS5sb25nVmFsdWUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludm9rZSB0aGlzIGRhdGFiYXNlJ3MgaW5kZXhP\nZiBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwg\nYnVmZmVyIHRvIHdyaXRlIHRoZSBpbmRleE9mIGludm9jYXRpb24gdG8KICAg\nICAqIEBwYXJhbSBzdHIgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhl\nIHRhcmdldCBzdHJpbmcKICAgICAqIEBwYXJhbSBmaW5kIGEgcXVlcnkgdmFs\ndWUgcmVwcmVzZW50aW5nIHRoZSBzZWFyY2ggc3RyaW5nCiAgICAgKiBAcGFy\nYW0gc3RhcnQgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHN0YXJ0\nIGluZGV4LCBvciBudWxsCiAgICAgKiB0byBzdGFydCBhdCB0aGUgYmVnaW5u\naW5nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGluZGV4T2YoU1FMQnVmZmVy\nIGJ1ZiwgRmlsdGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBmaW5kLAogICAg\nICAgIEZpbHRlclZhbHVlIHN0YXJ0KSB7CiAgICAgICAgYnVmLmFwcGVuZCgi\nKElOU1RSKCgiKTsKICAgICAgICBpZiAoc3RhcnQgIT0gbnVsbCkKICAgICAg\nICAgICAgc3Vic3RyaW5nKGJ1Ziwgc3RyLCBzdGFydCwgbnVsbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAg\nICBidWYuYXBwZW5kKCIpLCAoIik7CiAgICAgICAgZmluZC5hcHBlbmRUbyhi\ndWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIikpIC0gMSIpOwogICAgICAgIGlm\nIChzdGFydCAhPSBudWxsKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAr\nICIpOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAg\nIH0KICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBcHBlbmQgdGhlIG51bWVyaWMgcGFydHMgb2YgYSBtYXRoZW1hdGlj\nYWwgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FM\nIGJ1ZmZlciB0byB3cml0ZSB0aGUgbWF0aCBmdW5jdGlvbgogICAgICogQHBh\ncmFtIG9wIHRoZSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uIHRvIHBlcmZvcm0K\nICAgICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBt\nYXRoIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5k\nIHNpZGUgb2YgdGhlIG1hdGggZnVuY3Rpb24KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgbWF0aEZ1bmN0aW9uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwg\nRmlsdGVyVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocykgewog\nICAgICAgIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNlOwogICAgICAgIGJvb2xl\nYW4gY2FzdHJocyA9IGZhbHNlOwogICAgICAgIENsYXNzIGxjID0gRmlsdGVy\ncy53cmFwKGxocy5nZXRUeXBlKCkpOwogICAgICAgIENsYXNzIHJjID0gRmls\ndGVycy53cmFwKHJocy5nZXRUeXBlKCkpOwogICAgICAgIGludCB0eXBlID0g\nMDsKICAgICAgICBpZiAocmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyAm\nJiAobGMgIT0gcmMKICAgICAgICAgICAgfHwgKGxocy5pc0NvbnN0YW50KCkg\nfHwgcmhzLmlzQ29uc3RhbnQoKSkpKSB7CiAgICAgICAgICAgIENsYXNzIGMg\nPSBGaWx0ZXJzLnByb21vdGUobGMsIHJjKTsKICAgICAgICAgICAgdHlwZSA9\nIGdldEpEQkNUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZShjKSwgZmFsc2Up\nOwogICAgICAgICAgICBpZiAodHlwZSAhPSBUeXBlcy5WQVJCSU5BUlkgJiYg\ndHlwZSAhPSBUeXBlcy5CTE9CKSB7CiAgICAgICAgICAgICAgICBjYXN0bGhz\nID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwg\nbGMgIT0gYzsKICAgICAgICAgICAgICAgIGNhc3RyaHMgPSAobGhzLmlzQ29u\nc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8fCByYyAhPSBjOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIG1vZCA9ICJN\nT0QiLmVxdWFscyhvcCk7CiAgICAgICAgaWYgKG1vZCkgewogICAgICAgICAg\nICBpZiAoc3VwcG9ydHNNb2RPcGVyYXRvcikKICAgICAgICAgICAgICAgIG9w\nID0gIiUiOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKG9wKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nOwoKICAgICAgICBpZiAoY2FzdGxocykKICAgICAgICAgICAgYXBwZW5kQ2Fz\ndChidWYsIGxocywgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBs\naHMuYXBwZW5kVG8oYnVmKTsKCiAgICAgICAgaWYgKG1vZCAmJiAhc3VwcG9y\ndHNNb2RPcGVyYXRvcikKICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBl\nbmQob3ApLmFwcGVuZCgiICIpOwoKICAgICAgICBpZiAoY2FzdHJocykKICAg\nICAgICAgICAgYXBwZW5kQ2FzdChidWYsIHJocywgdHlwZSk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICByaHMuYXBwZW5kVG8oYnVmKTsKCiAgICAgICAg\nYnVmLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5k\nIGEgY29tcGFyaXNvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBT\nUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFy\nYW0gb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAg\nICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21w\nYXJpc29uCiAgICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUg\nb2YgdGhlIGNvbXBhcmlzb24KICAgICAqLwogICAgcHVibGljIHZvaWQgY29t\ncGFyaXNvbihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVl\nIGxocywKICAgICAgICBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBib29s\nZWFuIGxoc3htbCA9IGxocy5nZXRYUGF0aCgpICE9IG51bGw7CiAgICAgICAg\nYm9vbGVhbiByaHN4bWwgPSByaHMuZ2V0WFBhdGgoKSAhPSBudWxsOwogICAg\nICAgIGlmIChsaHN4bWwgfHwgcmhzeG1sKSB7CiAgICAgICAgICAgIGFwcGVu\nZFhtbENvbXBhcmlzb24oYnVmLCBvcCwgbGhzLCByaHMsIGxoc3htbCwgcmhz\neG1sKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBi\nb29sZWFuIGNhc3RsaHMgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGNhc3Ry\naHMgPSBmYWxzZTsKICAgICAgICBDbGFzcyBsYyA9IEZpbHRlcnMud3JhcChs\naHMuZ2V0VHlwZSgpKTsKICAgICAgICBDbGFzcyByYyA9IEZpbHRlcnMud3Jh\ncChyaHMuZ2V0VHlwZSgpKTsKICAgICAgICAKICAgICAgICAvLyBzcGVjaWFs\nIGNhc2Ugb2YgY29tcGFyaXNvbiBvZiB0d28gYm9vbGVhbiBjb25zdGFudHMK\nICAgICAgICAvLyBiZWNhdXNlIHNvbWUgZGF0YWJhc2VzIGRvIG5vdCBsaWtl\nIGZhbHNlID0gZmFsc2Ugb3IgZmFsc2UgPSB0cnVlCiAgICAgICAgLy8gYnV0\nIGFsbCBkYXRhYmFzZXMgdW5kZXJzdGFuZCAxID0gMCBvciAwIDw+IDEgZXRj\nLgogICAgICAgIGlmIChsYyA9PSByYyAmJiBsYyA9PSBCb29sZWFuLmNsYXNz\nICYmIGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgewog\nICAgICAgICAgICBTdHJpbmcgbHZhbHVlID0gQm9vbGVhbi5UUlVFLmVxdWFs\ncyhsaHMuZ2V0VmFsdWUoKSkgPyAiMSIgOiAiMCI7CiAgICAgICAgICAgIFN0\ncmluZyBydmFsdWUgPSBCb29sZWFuLlRSVUUuZXF1YWxzKHJocy5nZXRWYWx1\nZSgpKSA/ICIxIiA6ICIwIjsKICAgICAgICAgICAgYnVmLmFwcGVuZChsdmFs\ndWUpLmFwcGVuZChvcCkuYXBwZW5kKHJ2YWx1ZSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgaW50IHR5cGUgPSAwOwogICAgICAg\nIGlmIChyZXF1aXJlc0Nhc3RGb3JDb21wYXJpc29ucyAmJiAobGMgIT0gcmMK\nICAgICAgICAgICAgfHwgKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29u\nc3RhbnQoKSkpKSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBGaWx0ZXJzLnBy\nb21vdGUobGMsIHJjKTsKICAgICAgICAgICAgdHlwZSA9IGdldEpEQkNUeXBl\nKEphdmFUeXBlcy5nZXRUeXBlQ29kZShjKSwgZmFsc2UpOwogICAgICAgICAg\nICBpZiAodHlwZSAhPSBUeXBlcy5WQVJCSU5BUlkgJiYgdHlwZSAhPSBUeXBl\ncy5CTE9CKSB7CiAgICAgICAgICAgICAgICBjYXN0bGhzID0gKGxocy5pc0Nv\nbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwgbGMgIT0gYzsKICAg\nICAgICAgICAgICAgIGNhc3RyaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiBy\naHMuaXNDb25zdGFudCgpKSB8fCByYyAhPSBjOwogICAgICAgICAgICAgICAg\nY2FzdGxocyA9IGNhc3RsaHMgJiYgbGhzLnJlcXVpcmVzQ2FzdCgpOwogICAg\nICAgICAgICAgICAgY2FzdHJocyA9IGNhc3RyaHMgJiYgcmhzLnJlcXVpcmVz\nQ2FzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\nY2FzdGxocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIGxocywgdHlw\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBsaHMuYXBwZW5kVG8oYnVm\nKTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5k\nKCIgIik7CgogICAgICAgIGlmIChjYXN0cmhzKQogICAgICAgICAgICBhcHBl\nbmRDYXN0KGJ1ZiwgcmhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHJocy5hcHBlbmRUbyhidWYpOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIFhNTCB0eXBlLAogICAgICog\ndXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB4bWwgcHJlZGljYXRlLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRYbWxDb21wYXJpc29uKFNRTEJ1\nZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAg\nIEZpbHRlclZhbHVlIHJocywgYm9vbGVhbiBsaHN4bWwsIGJvb2xlYW4gcmhz\neG1sKSB7CiAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1hNTENvbHVt\nbiwgIlN1cHBvcnRzWE1MQ29sdW1uIik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBcHBlbmQgU1FMIGZvciB0aGUgZ2l2ZW4gbnVtZXJpYyB2YWx1ZSB0byB0\naGUgYnVmZmVyLCBjYXN0aW5nIGFzIG5lZWRlZC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgYXBwZW5kTnVtZXJpY0Nhc3QoU1FMQnVmZmVyIGJ1Ziwg\nRmlsdGVyVmFsdWUgdmFsKSB7CiAgICAgICAgaWYgKHZhbC5pc0NvbnN0YW50\nKCkpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCB2YWwsIFR5cGVzLk5V\nTUVSSUMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFsLmFwcGVuZFRv\nKGJ1Zik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYXN0IHRoZSBzcGVjaWZp\nZWQgdmFsdWUgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICoKICAgICAq\nIEBwYXJhbSBidWYgdGhlIGJ1ZmZlciB0byBhcHBlbmQgdGhlIGNhc3QgdG8K\nICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGNhc3QKICAgICAqIEBw\nYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHRoZSBjYXNlLCBlLmcuIHtAbGluayBU\neXBlcyNOVU1FUklDfQogICAgICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRD\nYXN0KFNRTEJ1ZmZlciBidWYsIE9iamVjdCB2YWwsIGludCB0eXBlKSB7CiAg\nICAgICAgLy8gQ29udmVydCB0aGUgY2FzdCBmdW5jdGlvbjogIkNBU1QoezB9\nIEFTIHsxfSkiCiAgICAgICAgaW50IGZpcnN0UGFyYW0gPSBjYXN0RnVuY3Rp\nb24uaW5kZXhPZigiezB9Iik7CiAgICAgICAgU3RyaW5nIHByZSA9IGNhc3RG\ndW5jdGlvbi5zdWJzdHJpbmcoMCwgZmlyc3RQYXJhbSk7IC8vICJDQVNUKCIK\nICAgICAgICBTdHJpbmcgbWlkID0gY2FzdEZ1bmN0aW9uLnN1YnN0cmluZyhm\naXJzdFBhcmFtICsgMyk7CiAgICAgICAgaW50IHNlY29uZFBhcmFtID0gbWlk\nLmluZGV4T2YoInsxfSIpOwogICAgICAgIFN0cmluZyBwb3N0OwogICAgICAg\nIGlmIChzZWNvbmRQYXJhbSA+IC0xKSB7CiAgICAgICAgICAgIHBvc3QgPSBt\naWQuc3Vic3RyaW5nKHNlY29uZFBhcmFtICsgMyk7IC8vICIpIgogICAgICAg\nICAgICBtaWQgPSBtaWQuc3Vic3RyaW5nKDAsIHNlY29uZFBhcmFtKTsgLy8g\nIiBBUyAiCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHBvc3QgPSAiIjsK\nCiAgICAgICAgYnVmLmFwcGVuZChwcmUpOwogICAgICAgIGlmICh2YWwgaW5z\ndGFuY2VvZiBGaWx0ZXJWYWx1ZSkKICAgICAgICAgICAgKChGaWx0ZXJWYWx1\nZSkgdmFsKS5hcHBlbmRUbyhidWYpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgYnVmLmFwcGVuZCgo\nKFNRTEJ1ZmZlcikgdmFsKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBi\ndWYuYXBwZW5kKHZhbC50b1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5k\nKG1pZCk7CiAgICAgICAgYnVmLmFwcGVuZChnZXRUeXBlTmFtZSh0eXBlKSk7\nCiAgICAgICAgYXBwZW5kTGVuZ3RoKGJ1ZiwgdHlwZSk7CiAgICAgICAgYnVm\nLmFwcGVuZChwb3N0KTsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIHZvaWQg\nYXBwZW5kTGVuZ3RoKFNRTEJ1ZmZlciBidWYsIGludCB0eXBlKSB7ICAgICAg\nICAKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogYWRkIENBU1QgZm9yIGEg\nZnVuY3Rpb24gb3BlcmF0b3Igd2hlcmUgb3BlcmFuZCBpcyBhIHBhcmFtCiAg\nICAgKiBAcGFyYW0gZnVuYyAgZnVuY3Rpb24gbmFtZQogICAgICogQHBhcmFt\nIHZhbCAKICAgICAqIEByZXR1cm4gdXBkYXRlZCBmdW5jCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgYWRkQ2FzdEFzVHlwZShTdHJpbmcgZnVuYywgVmFs\nIHZhbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfSAgICAKCgogICAg\nLy8vLy8vLy8vLy8KICAgIC8vIERETCBTUUwKICAgIC8vLy8vLy8vLy8vCgog\nICAgLyoqCiAgICAgKiBJbmNyZW1lbnQgdGhlIHJlZmVyZW5jZSBjb3VudCBv\nZiBhbnkgdGFibGUgY29tcG9uZW50cyB0aGF0IHRoaXMKICAgICAqIGRpY3Rp\nb25hcnkgYWRkcyB0aGF0IGFyZSBub3QgdXNlZCBieSBtYXBwaW5ncy4gRG9l\ncyBub3RoaW5nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHJlZlNjaGVtYUNvbXBvbmVudHMoVGFibGUgdGFibGUpIHsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIG5hbWUgb2YgdGhlIGNvbHVtbiB1\nc2luZyBkYXRhYmFzZSBzcGVjaWZpYyBkZWxpbWl0ZXJzLgogICAgICovCiAg\nICBwdWJsaWMgREJJZGVudGlmaWVyIGdldENvbHVtbklkZW50aWZpZXIoQ29s\ndW1uIGNvbHVtbikgewogICAgICAgIGlmIChjb2x1bW4gPT0gbnVsbCkgewog\nICAgICAgICAgICByZXR1cm4gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBjb2x1bW4uZ2V0SWRlbnRpZmllcigpOwogICAg\nfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkRCTmFtZShDb2x1\nbW4gY29sdW1uKSB7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKGdldENvbHVt\nbklkZW50aWZpZXIoY29sdW1uKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBpbmNsdWRpbmcg\ndGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxpbmsgI2NhdGFs\nb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmll\nciBnZXRGdWxsSWRlbnRpZmllcihUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dp\nY2FsKSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IERCSWRlbnRp\nZmllci5pc051bGwodGFibGUuZ2V0U2NoZW1hSWRlbnRpZmllcigpKSkKICAg\nICAgICAgICAgcmV0dXJuIHRhYmxlLmdldElkZW50aWZpZXIoKTsKICAgICAg\nICByZXR1cm4gdGFibGUuZ2V0RnVsbElkZW50aWZpZXIoKTsKICAgIH0KICAg\nICAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0RnVsbE5hbWUoVGFibGUgdGFi\nbGUsIGJvb2xlYW4gbG9naWNhbCkgewogICAgICAgIGlmICghdXNlU2NoZW1h\nTmFtZSB8fCBEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlLmdldFNjaGVtYUlk\nZW50aWZpZXIoKSkpCiAgICAgICAgICAgIHJldHVybiB0b0RCTmFtZSh0YWJs\nZS5nZXRJZGVudGlmaWVyKCkpOwogICAgICAgIHJldHVybiB0b0RCTmFtZSh0\nYWJsZS5nZXRGdWxsSWRlbnRpZmllcigpKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIGluZGV4LCBp\nbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB0aGUg\ncmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgogICAgICov\nCgogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJbmRleCBpbmRleCkg\newogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBEQklkZW50aWZpZXIu\naXNOdWxsKGluZGV4LmdldFNjaGVtYUlkZW50aWZpZXIoKSkpCiAgICAgICAg\nICAgIHJldHVybiB0b0RCTmFtZShpbmRleC5nZXRJZGVudGlmaWVyKCkpOwog\nICAgICAgIHJldHVybiB0b0RCTmFtZShpbmRleC5nZXRGdWxsSWRlbnRpZmll\ncigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZ1bGwg\nbmFtZSBvZiB0aGUgc2VxdWVuY2UsIGluY2x1ZGluZyB0aGUgc2NoZW1hIChk\nZWxpbWl0ZWQKICAgICAqIGJ5IHRoZSByZXN1bHQgb2Yge0BsaW5rICNjYXRh\nbG9nU2VwYXJhdG9yfSkuCiAgICAgKi8KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndEZ1bGxOYW1lKFNlcXVlbmNlIHNlcSkgewogICAgICAgIGlmICghdXNlU2No\nZW1hTmFtZSB8fCBEQklkZW50aWZpZXIuaXNOdWxsKHNlcS5nZXRTY2hlbWFJ\nZGVudGlmaWVyKCkpKQogICAgICAgICAgICByZXR1cm4gdG9EQk5hbWUoc2Vx\nLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKHNl\ncS5nZXRGdWxsSWRlbnRpZmllcigpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgc3Vic2V0IG9mIHRoZSB3b3JkcyBpbiByZXNlcnZlZFdv\ncmRTZXQgdGhhdCBjYW5ub3QgYmUgdXNlZCBhcwogICAgICogdmFsaWQgY29s\ndW1uIG5hbWVzIGZvciB0aGUgY3VycmVudCBEQi4gSWYgdGhlIGNvbHVtbiBu\nYW1lIGlzIGludmFsaWQgdGhlCiAgICAgKiBnZXRWYWxpZENvbHVtbk5hbWUg\nbWV0aG9kIG9mIHRoZSBEQiBkaWN0aW9uYXJ5IHNob3VsZCBiZSBpbnZva2Vk\nIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkLgogICAgICogCiAgICAgKiBAc2Vl\nIGdldFZhbGlkQ29sdW1uTmFtZQogICAgICovCiAgICBwdWJsaWMgZmluYWwg\nU2V0PFN0cmluZz4gZ2V0SW52YWxpZENvbHVtbldvcmRTZXQoKSB7CiAgICAg\nICAgcmV0dXJuIGludmFsaWRDb2x1bW5Xb3JkU2V0OwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIHRhYmxlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZCBmb3IKICAgICAqIHRo\nZSBjdXJyZW50IERCLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXRWYWxpZFRhYmxlTmFtZShTdHJpbmcgbmFtZSwg\nU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHJldHVybiBnZXRWYWxpZFRhYmxl\nTmFtZShEQklkZW50aWZpZXIubmV3VGFibGUobmFtZSksIHNjaGVtYSkuZ2V0\nTmFtZSgpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5l\nY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB0YWJsZSBuYW1lIHRvIG1h\na2UgaXQgdmFsaWQgZm9yCiAgICAgKiB0aGUgY3VycmVudCBEQi4KICAgICAq\nLwogICAgcHVibGljIERCSWRlbnRpZmllciBnZXRWYWxpZFRhYmxlTmFtZShE\nQklkZW50aWZpZXIgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHJl\ndHVybiBuYW1pbmdVdGlsLmdldFZhbGlkVGFibGVJZGVudGlmaWVyKG5hbWUs\nIHNjaGVtYSwgbWF4VGFibGVOYW1lTGVuZ3RoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZl\nbiBzZXF1ZW5jZSBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0\naGUgY3VycmVudCBEQi4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRTZXF1ZW5jZU5hbWUoU3RyaW5nIG5h\nbWUsIFNjaGVtYSBzY2hlbWEpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsaWRT\nZXF1ZW5jZU5hbWUoREJJZGVudGlmaWVyLm5ld1NlcXVlbmNlKG5hbWUpLCBz\nY2hlbWEpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBzZXF1ZW5jZSBu\nYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBE\nQi4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmllciBnZXRWYWxpZFNl\ncXVlbmNlTmFtZShEQklkZW50aWZpZXIgbmFtZSwgU2NoZW1hIHNjaGVtYSkg\newogICAgICAgIHJldHVybiBuYW1pbmdVdGlsLmdldFZhbGlkU2VxdWVuY2VJ\nZGVudGlmaWVyKG5hbWUsIHNjaGVtYSwgbWF4VGFibGVOYW1lTGVuZ3RoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFu\nZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4gbmFtZSB0byBtYWtlIGl0IHZhbGlk\nCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuICBUaGUgY29sdW1uIG5hbWUg\nd2lsbCBiZSBtYWRlIHVuaXF1ZSBmb3IgdGhlCiAgICAgKiBzcGVjaWZpZWQg\ndGFibGUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFZhbGlkQ29sdW1uTmFtZShTdHJpbmcgbmFtZSwgVGFibGUg\ndGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW5OYW1lKERC\nSWRlbnRpZmllci5uZXdDb2x1bW4obmFtZSksIHRhYmxlLCB0cnVlKS5nZXRO\nYW1lKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3Nh\ncnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gY29sdW1uIG5hbWUgdG8gbWFrZSBp\ndCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLiAgVGhlIGNvbHVt\nbiBuYW1lIHdpbGwgYmUgbWFkZSB1bmlxdWUgZm9yIHRoZQogICAgICogc3Bl\nY2lmaWVkIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgREJJZGVudGlmaWVy\nIGdldFZhbGlkQ29sdW1uTmFtZShEQklkZW50aWZpZXIgbmFtZSwgVGFibGUg\ndGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW5OYW1lKG5h\nbWUsIHRhYmxlLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4gbmFt\nZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIu\nICBJZiBjaGVja0ZvclVuaXF1ZW5lc3MgaXMgdHJ1ZSwgdGhlIGNvbHVtbiBu\nYW1lIHdpbGwgCiAgICAgKiBiZSBtYWRlIHVuaXF1ZSBmb3IgdGhlIHNwZWNp\nZmllZCB0YWJsZS4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0VmFsaWRDb2x1bW5OYW1lKFN0cmluZyBuYW1lLCBU\nYWJsZSB0YWJsZSwKICAgICAgICBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVz\ncykgewogICAgICAgIHJldHVybiBnZXRWYWxpZENvbHVtbk5hbWUoREJJZGVu\ndGlmaWVyLm5ld0NvbHVtbihuYW1lKSwgdGFibGUsIGNoZWNrRm9yVW5pcXVl\nbmVzcykudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4gbmFt\nZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIu\nICBJZiBjaGVja0ZvclVuaXF1ZW5lc3MgaXMgdHJ1ZSwgdGhlIGNvbHVtbiBu\nYW1lIHdpbGwgCiAgICAgKiBiZSBtYWRlIHVuaXF1ZSBmb3IgdGhlIHNwZWNp\nZmllZCB0YWJsZS4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmllciBn\nZXRWYWxpZENvbHVtbk5hbWUoREJJZGVudGlmaWVyIG5hbWUsIFRhYmxlIHRh\nYmxlLAogICAgICAgIGJvb2xlYW4gY2hlY2tGb3JVbmlxdWVuZXNzKSB7CiAg\nICAgICAgcmV0dXJuIGdldE5hbWluZ1V0aWwoKS5nZXRWYWxpZENvbHVtbklk\nZW50aWZpZXIobmFtZSwgdGFibGUsIG1heENvbHVtbk5hbWVMZW5ndGgsIAog\nICAgICAgICAgICBjaGVja0ZvclVuaXF1ZW5lc3MpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIHByaW1hcnkga2V5IG5hbWUgdG8gbWFrZSBpdAogICAgICogdmFsaWQg\nZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFZhbGlkUHJpbWFyeUtleU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQog\nICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\ncmV0dXJuIG1ha2VOYW1lVmFsaWQoIlBfIiArIG5hbWUsIHRhYmxlLmdldFNj\naGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heENvbnN0\ncmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4g\nZm9yZWlnbiBrZXkgbmFtZSB0byBtYWtlIGl0CiAgICAgKiB2YWxpZCBmb3Ig\ndGhlIGN1cnJlbnQgREIuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkRm9yZWlnbktleU5hbWUoU3RyaW5n\nIG5hbWUsIFRhYmxlIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsK\nICAgICAgICByZXR1cm4gZ2V0VmFsaWRGb3JlaWduS2V5TmFtZShEQklkZW50\naWZpZXIubmV3Rm9yZWlnbktleShuYW1lKSwgdGFibGUsCiAgICAgICAgICAg\nIHRvVGFibGUpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBmb3JlaWdu\nIGtleSBuYW1lIHRvIG1ha2UgaXQKICAgICAqIHZhbGlkIGZvciB0aGUgY3Vy\ncmVudCBEQi4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmllciBnZXRW\nYWxpZEZvcmVpZ25LZXlOYW1lKERCSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0\nYWJsZSwKICAgICAgICBUYWJsZSB0b1RhYmxlKSB7CiAgICAgICAgcmV0dXJu\nIG5hbWluZ1V0aWwuZ2V0VmFsaWRGb3JlaWduS2V5SWRlbnRpZmllcihuYW1l\nLCB0YWJsZSwgdG9UYWJsZSwgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIGluZGV4IG5hbWUgdG8gbWFrZSBpdCB2YWxpZAog\nICAgICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICogQGRlcHJlY2F0ZWQK\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZEluZGV4TmFtZShT\ndHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0\nVmFsaWRJbmRleE5hbWUoREJJZGVudGlmaWVyLm5ld0luZGV4KG5hbWUpLCB0\nYWJsZSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBh\nbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGluZGV4IG5hbWUg\ndG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLgog\nICAgICovCiAgICBwdWJsaWMgREJJZGVudGlmaWVyIGdldFZhbGlkSW5kZXhO\nYW1lKERCSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAg\nIHJldHVybiBnZXROYW1pbmdVdGlsKCkuZ2V0VmFsaWRJbmRleElkZW50aWZp\nZXIobmFtZSwgdGFibGUsIG1heEluZGV4TmFtZUxlbmd0aCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0\naGUgZ2l2ZW4gdW5pcXVlIGNvbnN0cmFpbnQgbmFtZSB0byBtYWtlCiAgICAg\nKiBpdCB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKiBAZGVwcmVj\nYXRlZAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkVW5pcXVl\nTmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1\ncm4gZ2V0VmFsaWRVbmlxdWVOYW1lKERCSWRlbnRpZmllci5uZXdDb25zdHJh\naW50KG5hbWUpLCB0YWJsZSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVu\nIHVuaXF1ZSBjb25zdHJhaW50IG5hbWUgdG8gbWFrZQogICAgICogaXQgdmFs\naWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgREJJ\nZGVudGlmaWVyIGdldFZhbGlkVW5pcXVlTmFtZShEQklkZW50aWZpZXIgbmFt\nZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gbmFtaW5nVXRpbC5n\nZXRWYWxpZFVuaXF1ZUlkZW50aWZpZXIobmFtZSwgdGFibGUsIG1heENvbnN0\ncmFpbnROYW1lTGVuZ3RoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBT\naG9ydGVuIHRoZSBzcGVjaWZpZWQgbmFtZSB0byB0aGUgc3BlY2lmaWVkIHRh\ncmdldCBuYW1lLiBUaGlzIHdpbGwKICAgICAqIGJlIGRvbmUgYnkgZmlyc3Qg\nc3RyaXBwaW5nIG91dCB0aGUgdm93ZWxzLCBhbmQgdGhlbiByZW1vdmluZwog\nICAgICogY2hhcmFjdGVycyBmcm9tIHRoZSBtaWRkbGUgb2YgdGhlIHdvcmQg\ndW50aWwgaXQgcmVhY2hlcyB0aGUgdGFyZ2V0CiAgICAgKiBsZW5ndGguCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIHNob3J0ZW4oU3RyaW5n\nIG5hbWUsIGludCB0YXJnZXRMZW5ndGgpIHsKICAgICAgICBpZiAobmFtZSA9\nPSBudWxsIHx8IG5hbWUubGVuZ3RoKCkgPD0gdGFyZ2V0TGVuZ3RoKQogICAg\nICAgICAgICByZXR1cm4gbmFtZTsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBu\nbSA9IG5ldyBTdHJpbmdCdWlsZGVyKG5hbWUpOwogICAgICAgIHdoaWxlIChu\nbS5sZW5ndGgoKSA+IHRhcmdldExlbmd0aCkgewogICAgICAgICAgICBpZiAo\nIXN0cmlwVm93ZWwobm0pKSB7CiAgICAgICAgICAgICAgICAvLyBjdXQgb3V0\nIHRoZSBtaWRkbGUgY2hhcgogICAgICAgICAgICAgICAgbm0ucmVwbGFjZShu\nbS5sZW5ndGgoKSAvIDIsIChubS5sZW5ndGgoKSAvIDIpICsgMSwgIiIpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBubS50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHZvd2VscyBm\ncm9tIHRoZSBzcGVjaWZpZWQgU3RyaW5nQnVpbGRlci4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgYW55IHZvd2VscyBoYXZlIGJlZW4gcmVtb3Zl\nZAogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIHN0cmlwVm93\nZWwoU3RyaW5nQnVpbGRlciBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCB8fCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9IHsgJ0EnLCAnRScs\nICdJJywgJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCB2b3dlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaW50IGluZGV4\nID0gbmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5kZXhPZih2b3dl\nbHNbaV0pOwogICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEpIHsKICAgICAg\nICAgICAgICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5kZXggKyAxLCAiIik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4g\nbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0IGlz\nIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBhcHBl\nbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdpdGgg\nYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhlIGxhc3QKICAgICAq\nIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuICcxJywgZXRj\nLgogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVuIG1heSBiZSAw\nIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAgICogaW5jb21wbGV0\nZS4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQs\nIGludCBtYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlKSB7CiAgICAgICAg\ncmV0dXJuIG1ha2VOYW1lVmFsaWQobmFtZSwgc2V0LCBtYXhMZW4sIG5hbWVU\neXBlLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW5zIHRo\nZSBnaXZlbiBuYW1lIHRvIHRoZSBnaXZlbiBtYXhpbXVtIGxlbmd0aCwgdGhl\nbiBjaGVja3MgdGhhdAogICAgICogaXQgaXMgbm90IGEgcmVzZXJ2ZWQgd29y\nZC4gSWYgaXQgaXMgcmVzZXJ2ZWQsIGFwcGVuZHMgYSAiMCIuIElmCiAgICAg\nKiB0aGUgbmFtZSBjb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBzY2hlbWEg\nY29tcG9uZW50LCB0aGUgbGFzdAogICAgICogY2hhcmFjdGVyIGlzIHJlcGxh\nY2Ugd2l0aCAnMCcsIHRoZW4gJzEnLCBldGMuCiAgICAgKiBOb3RlIHRoYXQg\ndGhlIGdpdmVuIG1heCBsZW4gbWF5IGJlIDAgaWYgdGhlIGRhdGFiYXNlIG1l\ndGFkYXRhIGlzCiAgICAgKiBpbmNvbXBsZXRlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgREJJZGVudGlmaWVyIG1ha2VOYW1lVmFsaWQoREJJZGVudGlmaWVy\nIG5hbWUsIE5hbWVTZXQgc2V0LCBpbnQgbWF4TGVuLAogICAgICAgIGludCBu\nYW1lVHlwZSkgewogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUs\nIHNldCwgbWF4TGVuLCBuYW1lVHlwZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4g\nbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0IGlz\nIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBhcHBl\nbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdpdGgg\nYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCBhbmQgdW5pcXVlbmVzcwog\nICAgICogY2hlY2tpbmcgaXMgZW5hYmxlZCwgdGhlIGxhc3QgY2hhcmFjdGVy\nIGlzIHJlcGxhY2Ugd2l0aCAnMCcsIHRoZW4gCiAgICAgKiAnMScsIGV0Yy4g\nCiAgICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBsZW4gbWF5IGJlIDAg\naWYgdGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzIAogICAgICogaW5jb21wbGV0\nZS4KICAgICAqIAogICAgICogTm90ZTogSWYgdGhlIG5hbWUgaXMgZGVsaW1p\ndGVkLCBtYWtlIHN1cmUgdGhlIGVuZGluZyBkZWxpbWl0ZXIgaXMKICAgICAq\nIG5vdCBzdHJpcHBlZCBvZmYuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJp\nbmcgbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQsIGlu\ndCBtYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlLCBib29sZWFuIGNoZWNr\nRm9yVW5pcXVlbmVzcykgewogICAgICAgIHJldHVybiBuYW1pbmdVdGlsLm1h\na2VOYW1lVmFsaWQobmFtZSwgc2V0LAogICAgICAgICAgICBtYXhMZW4sIG5h\nbWVUeXBlLCBjaGVja0ZvclVuaXF1ZW5lc3MpLnRvU3RyaW5nKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0\naGUgZ2l2ZW4gbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAg\nICAqIGl0IGlzIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2Vy\ndmVkLCBhcHBlbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxp\nY3RzIHdpdGggYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCBhbmQgdW5p\ncXVlbmVzcwogICAgICogY2hlY2tpbmcgaXMgZW5hYmxlZCwgdGhlIGxhc3Qg\nY2hhcmFjdGVyIGlzIHJlcGxhY2Ugd2l0aCAnMCcsIHRoZW4gCiAgICAgKiAn\nMScsIGV0Yy4gCiAgICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBsZW4g\nbWF5IGJlIDAgaWYgdGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzIAogICAgICog\naW5jb21wbGV0ZS4KICAgICAqIAogICAgICogTm90ZTogSWYgdGhlIG5hbWUg\naXMgZGVsaW1pdGVkLCBtYWtlIHN1cmUgdGhlIGVuZGluZyBkZWxpbWl0ZXIg\naXMKICAgICAqIG5vdCBzdHJpcHBlZCBvZmYuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBEQklkZW50aWZpZXIgbWFrZU5hbWVWYWxpZChEQklkZW50aWZpZXIg\nbmFtZSwgTmFtZVNldCBzZXQsIGludCBtYXhMZW4sCiAgICAgICAgaW50IG5h\nbWVUeXBlLCBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAg\nIHJldHVybiBuYW1pbmdVdGlsLm1ha2VJZGVudGlmaWVyVmFsaWQobmFtZSwg\nc2V0LAogICAgICAgICAgICBtYXhMZW4sIGNoZWNrRm9yVW5pcXVlbmVzcyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FM\nIHN0YXRlbWVudHMgdG8gY3JlYXRlIHRoZSBnaXZlbiB0YWJsZSwgY29tcGxl\ndGUKICAgICAqIHdpdGggY29sdW1ucy4gSW5kZXhlcyBhbmQgY29uc3RyYWlu\ndHMgd2lsbCBiZSBjcmVhdGVkIHNlcGFyYXRlbHkuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVUYWJsZVNRTChUYWJsZSB0YWJsZSkg\newogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gY2hlY2tOYW1lTGVu\nZ3RoKGdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSksIAogICAgICAgICAgICAg\nICAgbWF4VGFibGVOYW1lTGVuZ3RoLCAibG9uZy10YWJsZS1uYW1lIik7CiAg\nICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFIFRBQkxFICIpLmFwcGVuZCh0YWJs\nZU5hbWUpOwogICAgICAgIGlmIChzdXBwb3J0c0NvbW1lbnRzICYmIHRhYmxl\nLmhhc0NvbW1lbnQoKSkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIgIik7\nCiAgICAgICAgICAgIGNvbW1lbnQoYnVmLCB0YWJsZS5nZXRDb21tZW50KCkp\nOwogICAgICAgICAgICBidWYuYXBwZW5kKCJcbiAgICAoIik7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICgiKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGRvIHRoaXMgYmVmb3JlIGdldHRpbmcgdGhlIGNv\nbHVtbnMgc28gd2Uga25vdyBob3cgdG8gaGFuZGxlCiAgICAgICAgLy8gdGhl\nIGxhc3QgY29tbWEKICAgICAgICBTdHJpbmdCdWlsZGVyIGVuZEJ1ZiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgUHJpbWFyeUtleSBwayA9IHRh\nYmxlLmdldFByaW1hcnlLZXkoKTsKICAgICAgICBTdHJpbmcgcGtTdHI7CiAg\nICAgICAgaWYgKHBrICE9IG51bGwpIHsKICAgICAgICAgICAgcGtTdHIgPSBn\nZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChwayk7CiAgICAgICAgICAgIGlm\nIChwa1N0ciAhPSBudWxsKQogICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVu\nZChwa1N0cik7CiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1bnFzID0g\ndGFibGUuZ2V0VW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFTdHI7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwo\ndW5xc1tpXSk7CiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAgICAg\nICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAg\nICAgICAgIGVuZEJ1Zi5hcHBlbmQodW5xU3RyKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldENv\nbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXREZWNsYXJl\nQ29sdW1uU1FMKGNvbHNbaV0sIGZhbHNlKSk7CiAgICAgICAgICAgIGlmIChp\nIDwgY29scy5sZW5ndGggLSAxIHx8IGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBp\nZiAoc3VwcG9ydHNDb21tZW50cyAmJiBjb2xzW2ldLmhhc0NvbW1lbnQoKSkg\newogICAgICAgICAgICAgICAgY29tbWVudChidWYsIGNvbHNbaV0uZ2V0Q29t\nbWVudCgpKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAgICIp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5k\nKGVuZEJ1Zi50b1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5kKCIpIik7\nCiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkg\nfTsKICAgIH0KICAgIAogICAgcHVibGljIGludCBnZXRCYXRjaEZldGNoU2l6\nZShpbnQgYmF0Y2hGZXRjaFNpemUpIHsKICAgICAgICByZXR1cm4gYmF0Y2hG\nZXRjaFNpemU7CiAgICB9CgogICAgcHJvdGVjdGVkIFN0cmluZ0J1aWxkZXIg\nY29tbWVudChTdHJpbmdCdWlsZGVyIGJ1ZiwgU3RyaW5nIGNvbW1lbnQpIHsK\nICAgICAgICByZXR1cm4gYnVmLmFwcGVuZCgiLS0gIikuYXBwZW5kKGNvbW1l\nbnQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHRhYmxlLiBJbmRl\neGVzCiAgICAgKiB3aWxsIGJlIGRyb3BwZWQgc2VwYXJhdGVseS4gUmV0dXJu\ncwogICAgICogPGNvZGU+RFJPUCBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDs8\nL2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXREcm9wVGFibGVTUUwoVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJp\nbmcgZHJvcCA9IE1lc3NhZ2VGb3JtYXQuZm9ybWF0KGRyb3BUYWJsZVNRTCwg\nbmV3IE9iamVjdFtdewogICAgICAgICAgICBnZXRGdWxsTmFtZSh0YWJsZSwg\nZmFsc2UpIH0pOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGRyb3Ag\nfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBT\nUUwgc3RhdGVtZW50cyB0byBjcmVhdGUgdGhlIGdpdmVuIHNlcXVlbmNlLiBS\nZXR1cm5zCiAgICAgKiA8Y29kZT5DUkVBVEUgU0VRVUVOQ0UgJmx0O3NlcXVl\nbmNlIG5hbWUmZ3Q7WyBTVEFSVCBXSVRIICZsdDtzdGFydCZndDtdCiAgICAg\nKiBbIElOQ1JFTUVOVCBCWSAmbHQ7aW5jcmVtZW50Jmd0O108L2NvZGU+IGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVh\ndGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBpZiAobmV4\ndFNlcXVlbmNlUXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1\naWxkZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJDUkVBVEUgU0VRVUVOQ0Ug\nIik7CiAgICAgICAgU3RyaW5nIHNlcU5hbWUgPSBjaGVja05hbWVMZW5ndGgo\nZ2V0RnVsbE5hbWUoc2VxKSwgbWF4VGFibGVOYW1lTGVuZ3RoLCAKICAgICAg\nICAgICAgICAgICJsb25nLXNlcS1uYW1lIik7CiAgICAgICAgYnVmLmFwcGVu\nZChzZXFOYW1lKTsKICAgICAgICBpZiAoc2VxLmdldEluaXRpYWxWYWx1ZSgp\nICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBTVEFSVCBXSVRIICIp\nLmFwcGVuZChzZXEuZ2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgIGlmIChz\nZXEuZ2V0SW5jcmVtZW50KCkgPiAxKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgSU5DUkVNRU5UIEJZICIpLmFwcGVuZChzZXEuZ2V0SW5jcmVtZW50KCkp\nOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygp\nIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2Yg\nU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gc2VxdWVuY2UuIFJl\ndHVybnMKICAgICAqIDxjb2RlPkRST1AgU0VRVUVOQ0UgJmx0O3NlcXVlbmNl\nIG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RHJvcFNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkg\newogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJEUk9QIFNFUVVFTkNF\nICIgKyBnZXRGdWxsTmFtZShzZXEpIH07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gY3JlYXRl\nIHRoZSBnaXZlbiBpbmRleC4gUmV0dXJucwogICAgICogPGNvZGU+Q1JFQVRF\nIFtVTklRVUVdIElOREVYICZsdDtpbmRleCBuYW1lJmd0OyBPTiAmbHQ7dGFi\nbGUgbmFtZSZndDsKICAgICAqICgmbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4g\nYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldENy\nZWF0ZUluZGV4U1FMKEluZGV4IGluZGV4KSB7CiAgICAgICAgU3RyaW5nQnVp\nbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIkNSRUFURSAiKTsKICAgICAgICBpZiAoaW5kZXguaXNVbmlxdWUo\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiVU5JUVVFICIpOwogICAgICAg\nIAogICAgICAgIERCSWRlbnRpZmllciBmdWxsSWR4TmFtZSA9IGluZGV4Lmdl\ndElkZW50aWZpZXIoKTsKICAgICAgICBEQklkZW50aWZpZXIgdW5RdWFsaWZp\nZWROYW1lID0gZnVsbElkeE5hbWUuZ2V0VW5xdWFsaWZpZWROYW1lKCk7CiAg\nICAgICAgY2hlY2tOYW1lTGVuZ3RoKHRvREJOYW1lKHVuUXVhbGlmaWVkTmFt\nZSksIG1heEluZGV4TmFtZUxlbmd0aCwgCiAgICAgICAgICAgICAgICAibG9u\nZy1pbmRleC1uYW1lIik7CiAgICAgICAgU3RyaW5nIGluZGV4TmFtZSA9IHRv\nREJOYW1lKGZ1bGxJZHhOYW1lKTsKICAgICAgICAgCiAgICAgICAgYnVmLmFw\ncGVuZCgiSU5ERVggIikuYXBwZW5kKGluZGV4TmFtZSk7CiAgICAgICAgYnVm\nLmFwcGVuZCgiIE9OICIpLmFwcGVuZChnZXRGdWxsTmFtZShpbmRleC5nZXRU\nYWJsZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAoIikuYXBw\nZW5kKG5hbWluZ1V0aWwuYXBwZW5kQ29sdW1ucyhpbmRleC5nZXRDb2x1bW5z\nKCkpKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CgogICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMg\ndG8gZHJvcCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMKICAgICAqIDxjb2Rl\nPkRST1AgSU5ERVggJmx0O2luZGV4IG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZh\ndWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcEluZGV4\nU1FMKEluZGV4IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nXXsgIkRST1AgSU5ERVggIiArIGdldEZ1bGxOYW1lKGluZGV4KSB9OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0\nZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gY29sdW1uIHRvCiAgICAgKiBpdHMg\ndGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90\nIHN1cHBvcnRlZC4gUmV0dXJucwogICAgICogPGNvZGU+QUxURVIgVEFCTEUg\nJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERCAoJmx0O2NvbCBkZWMmZ3Q7KTwvY29k\nZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmdbXSBnZXRBZGRDb2x1bW5TUUwoQ29sdW1uIGNvbHVtbikgewogICAgICAg\nIGlmICghc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbikKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CgogICAgICAgIFN0cmluZyBk\nZWMgPSBnZXREZWNsYXJlQ29sdW1uU1FMKGNvbHVtbiwgdHJ1ZSk7CiAgICAg\nICAgaWYgKGRlYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0\ncmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIg\nVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKGNvbHVtbi5nZXRU\nYWJsZSgpLCBmYWxzZSkgKyAiIEFERCAiICsgZGVjIH07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMg\ndG8gZHJvcCB0aGUgZ2l2ZW4gY29sdW1uIGZyb20KICAgICAqIGl0cyB0YWJs\nZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3Vw\ncG9ydGVkLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7\ndGFibGUgbmFtZSZndDsgRFJPUCBDT0xVTU4gJmx0O2NvbCBuYW1lJmd0Ozwv\nY29kZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXREcm9wQ29sdW1uU1FMKENvbHVtbiBjb2x1bW4pIHsKICAg\nICAgICBpZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhEcm9wQ29sdW1uKQog\nICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1\ncm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICAr\nIGdldEZ1bGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAg\nICAgICAgKyAiIERST1AgQ09MVU1OICIgKyBjb2x1bW4gfTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50\ncyB0byBhZGQgdGhlIGdpdmVuIHByaW1hcnkga2V5IHRvCiAgICAgKiBpdHMg\ndGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90\nIHN1cHBvcnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUg\nJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERAogICAgICogJmx0O3BrIGNvbnMgc3Fs\nICZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXRBZGRQcmltYXJ5S2V5U1FMKFByaW1hcnlLZXkgcGspIHsK\nICAgICAgICBTdHJpbmcgcGtzcWwgPSBnZXRQcmltYXJ5S2V5Q29uc3RyYWlu\ndFNRTChwayk7CiAgICAgICAgaWYgKHBrc3FsID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVs\nbE5hbWUocGsuZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiArIHBrc3Fs\nIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2Yg\nU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkg\nZnJvbQogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkg\naWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxj\nb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTlNU\nUkFJTlQKICAgICAqICZsdDtwayBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BQcmltYXJ5\nS2V5U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAgICBpZiAoREJJZGVudGlm\naWVyLmlzTnVsbChway5nZXRJZGVudGlmaWVyKCkpKQogICAgICAgICAgICBy\nZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmlu\nZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1l\nKHBrLmdldFRhYmxlKCksIGZhbHNlKQogICAgICAgICAgICArICIgRFJPUCBD\nT05TVFJBSU5UICIgKyB0b0RCTmFtZShway5nZXRJZGVudGlmaWVyKCkpIH07\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FM\nIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0bwog\nICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3Bl\ncmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFM\nVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBBREQKICAgICAqICZsdDtm\nayBjb25zIHNxbCAmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkRm9yZWlnbktleVNRTChGb3JlaWdu\nS2V5IGZrKSB7CiAgICAgICAgU3RyaW5nIGZrU1FMID0gZ2V0Rm9yZWlnbktl\neUNvbnN0cmFpbnRTUUwoZmspOwogICAgICAgIGlmIChma1NRTCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICBy\nZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAg\nICArIGdldEZ1bGxOYW1lKGZrLmdldFRhYmxlKCksIGZhbHNlKSArICIgQURE\nICIgKyBma1NRTCB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGZv\ncmVpZ24ga2V5IGZyb20KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVt\ncHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICog\nUmV0dXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsg\nRFJPUCBDT05TVFJBSU5UCiAgICAgKiAmbHQ7ZmsgbmFtZSZndDs8L2NvZGU+\nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRE\ncm9wRm9yZWlnbktleVNRTChGb3JlaWduS2V5IGZrLCBDb25uZWN0aW9uIGNv\nbm4pIHsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzTnVsbChmay5nZXRJ\nZGVudGlmaWVyKCkpKSB7CiAgICAgICAgICAgIFN0cmluZ1tdIHJldFZhbDsK\nICAgICAgICAgICAgREJJZGVudGlmaWVyIGZrTmFtZSA9IGZrLmxvYWRJZGVu\ndGlmaWVyRnJvbURCKHRoaXMsY29ubik7CiAgICAgICAgICAgIHJldFZhbCA9\nIChma05hbWUgPT0gbnVsbCkgPyAgbmV3IFN0cmluZ1swXSA6CiAgICAgICAg\nICAgICAgICBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAg\nICAgICAgICArIGdldEZ1bGxOYW1lKGZrLmdldFRhYmxlKCksIGZhbHNlKQog\nICAgICAgICAgICAgICAgKyAiIERST1AgQ09OU1RSQUlOVCAiICsgdG9EQk5h\nbWUoZmtOYW1lKSB9OwogICAgICAgICAgICByZXR1cm4gcmV0VmFsOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFC\nTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKGZrLmdldFRhYmxlKCks\nIGZhbHNlKQogICAgICAgICAgICArICIgRFJPUCBDT05TVFJBSU5UICIgKyB0\nb0RCTmFtZShmay5nZXRJZGVudGlmaWVyKCkpIH07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdp\ndmVuIGNvbHVtbi4gVGhpcyBtZXRob2QgaXMgdXNlZAogICAgICogZm9yIGVh\nY2ggY29sdW1uIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRlVGFibGVT\nUUx9IGFuZAogICAgICoge0BsaW5rICNnZXRBZGRDb2x1bW5TUUx9LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldERlY2xhcmVDb2x1bW5TUUwo\nQ29sdW1uIGNvbCwgYm9vbGVhbiBhbHRlcikgewogICAgICAgIFN0cmluZ0J1\naWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBTdHJp\nbmcgY29sdW1uTmFtZSA9IGNoZWNrTmFtZUxlbmd0aCh0b0RCTmFtZShjb2wu\nZ2V0SWRlbnRpZmllcigpKSwgbWF4Q29sdW1uTmFtZUxlbmd0aCwgCiAgICAg\nICAgICAgICAgICAibG9uZy1jb2x1bW4tbmFtZSIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoY29sdW1uTmFtZSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFw\ncGVuZChnZXRUeXBlTmFtZShjb2wpKTsKCiAgICAgICAgLy8gY2FuJ3QgYWRk\nIGNvbnN0cmFpbnRzIHRvIGEgY29sdW1uIHdlJ3JlIGFkZGluZyBhZnRlciB0\nYWJsZQogICAgICAgIC8vIGNyZWF0aW9uLCBjYXVzZSBzb21lIGRhdGEgbWln\naHQgYWxyZWFkeSBiZSBpbnNlcnRlZAogICAgICAgIGlmICghYWx0ZXIpIHsK\nICAgICAgICAgICAgaWYgKGNvbC5nZXREZWZhdWx0U3RyaW5nKCkgIT0gbnVs\nbCAmJiAhY29sLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgREVGQVVMVCAiKS5hcHBlbmQoY29sLmdldERlZmF1bHRT\ndHJpbmcoKSk7CiAgICAgICAgICAgIGlmIChjb2wuaXNOb3ROdWxsKCkpCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgTk9UIE5VTEwiKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGNvbC5pc0F1dG9Bc3NpZ25lZCgpKSB7CiAgICAg\nICAgICAgIGlmICghc3VwcG9ydHNBdXRvQXNzaWduKQogICAgICAgICAgICAg\nICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQtYXV0b2Fzc2lnbiIsIHBs\nYXRmb3JtLCBjb2wpKTsKICAgICAgICAgICAgZWxzZSBpZiAoYXV0b0Fzc2ln\nbkNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nICIpLmFwcGVuZChhdXRvQXNzaWduQ2xhdXNlKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZlbiBw\ncmltYXJ5IGtleS4gVGhpcyBtZXRob2QgaXMKICAgICAqIHVzZWQgZnJvbSB3\naXRoaW4ge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0gYW5kCiAgICAgKiB7\nQGxpbmsgI2dldEFkZFByaW1hcnlLZXlTUUx9LiBSZXR1cm5zCiAgICAgKiA8\nY29kZT5DT05TVFJBSU5UICZsdDtwayBuYW1lJmd0OyBQUklNQVJZIEtFWSAo\nJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFByaW1hcnlLZXlDb25z\ndHJhaW50U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAgICAvLyBpZiB3ZSBo\nYXZlIGRpc2FibGVkIHRoZSBjcmVhdGlvbiBvZiBwcmltYXJ5IGtleXMsIGFi\nb3J0IGhlcmUKICAgICAgICBpZiAoIWNyZWF0ZVByaW1hcnlLZXlzKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIG5hbWUgPSB0\nb0RCTmFtZShway5nZXRJZGVudGlmaWVyKCkpOwogICAgICAgIGlmIChuYW1l\nICE9IG51bGwgJiYgcmVzZXJ2ZWRXb3JkU2V0LmNvbnRhaW5zKG5hbWUudG9V\ncHBlckNhc2UoKSkpCiAgICAgICAgICAgIG5hbWUgPSBudWxsOwoKICAgICAg\nICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAg\nICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVfQkVGT1JFLmVx\ndWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZChuYW1lKS5hcHBlbmQoIiAiKTsK\nICAgICAgICBidWYuYXBwZW5kKCJQUklNQVJZIEtFWSAiKTsKICAgICAgICBp\nZiAobmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9NSUQuZXF1YWxzKGNvbnN0\ncmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQobmFtZSku\nYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChu\nYW1pbmdVdGlsLmFwcGVuZENvbHVtbnMocGsuZ2V0Q29sdW1ucygpKSkuCiAg\nICAgICAgICAgIGFwcGVuZCgiKSIpOwogICAgICAgIGlmIChuYW1lICE9IG51\nbGwgJiYgQ09OU19OQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1v\nZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5h\ncHBlbmQobmFtZSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBT\nUUwgZm9yIHRoZSBnaXZlbiBmb3JlaWduIGtleSwgb3IgbnVsbCBpZiBpdCBp\ncwogICAgICogbm90IHN1cHBvcnRlZC4gVGhpcyBtZXRob2QgaXMgdXNlZCBm\ncm9tIHdpdGhpbgogICAgICoge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0g\nYW5kIHtAbGluayAjZ2V0QWRkRm9yZWlnbktleVNRTH0uIFJldHVybnMKICAg\nICAqIDxjb2RlPkNPTlNUUkFJTlQgJmx0O2NvbnMgbmFtZSZndDsgRk9SRUlH\nTiBLRVkgKCZsdDtjb2wgbGlzdCZndDspCiAgICAgKiBSRUZFUkVOQ0VTICZs\ndDtmb3JlaWduIHRhYmxlJmd0OyAoJmx0O2NvbCBsaXN0Jmd0OykKICAgICAq\nIFtPTiBERUxFVEUgJmx0O2FjdGlvbiZndDtdIFtPTiBVUERBVEUgJmx0O2Fj\ndGlvbiZndDtdPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIGdldEZvcmVpZ25LZXlDb25zdHJhaW50U1FMKEZvcmVp\nZ25LZXkgZmspIHsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChmay5nZXRD\nb2x1bW5zKCkubGVuZ3RoID4gMCAmJiAhc3VwcG9ydHNGb3JlaWduS2V5c0Nv\nbXBvc2l0ZSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKGZrLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25LZXkuQUNUSU9OX05P\nTkUpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChmay5p\nc0RlZmVycmVkKCkgJiYgIXN1cHBvcnRzRGVmZXJyZWRGb3JlaWduS2V5Q29u\nc3RyYWludHMoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKCFzdXBwb3J0c0RlbGV0ZUFjdGlvbihmay5nZXREZWxldGVBY3Rpb24o\nKSkKICAgICAgICAgICAgfHwgIXN1cHBvcnRzVXBkYXRlQWN0aW9uKGZrLmdl\ndFVwZGF0ZUFjdGlvbigpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENvbHVtbltdIGxvY2FscyA9IGZrLmdldENvbHVtbnMoKTsKICAg\nICAgICBDb2x1bW5bXSBmb3JlaWducyA9IGZrLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCk7CgogICAgICAgIGludCBkZWxBY3Rpb25JZCA9IGZrLmdldERlbGV0\nZUFjdGlvbigpOwogICAgICAgIGlmIChkZWxBY3Rpb25JZCA9PSBGb3JlaWdu\nS2V5LkFDVElPTl9OVUxMKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbG9jYWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBp\nZiAobG9jYWxzW2ldLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAgICAg\nIGRlbEFjdGlvbklkID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGRlbEFjdGlvbiA9\nIGdldEFjdGlvbk5hbWUoZGVsQWN0aW9uSWQpOwogICAgICAgIFN0cmluZyB1\ncEFjdGlvbiA9IGdldEFjdGlvbk5hbWUoZmsuZ2V0VXBkYXRlQWN0aW9uKCkp\nOwoKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWls\nZGVyKCk7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKGZrLmdl\ndElkZW50aWZpZXIoKSkKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0JFRk9S\nRS5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5hcHBlbmQodG9EQk5hbWUoZmsuZ2V0\nSWRlbnRpZmllcigpKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiRk9SRUlHTiBLRVkgIik7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIu\naXNOdWxsKGZrLmdldElkZW50aWZpZXIoKSkgJiYgQ09OU19OQU1FX01JRC5l\ncXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCh0b0RCTmFtZShmay5nZXRJZGVudGlmaWVyKCkpKS5hcHBlbmQoIiAi\nKTsKICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKG5hbWluZ1V0aWwu\nYXBwZW5kQ29sdW1ucyhsb2NhbHMpKS5hcHBlbmQoIikiKTsKICAgICAgICBi\ndWYuYXBwZW5kKCIgUkVGRVJFTkNFUyAiKTsKICAgICAgICBidWYuYXBwZW5k\nKGdldEZ1bGxOYW1lKGZvcmVpZ25zWzBdLmdldFRhYmxlKCksIGZhbHNlKSk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiICgiKS5hcHBlbmQobmFtaW5nVXRpbC5h\ncHBlbmRDb2x1bW5zKGZvcmVpZ25zKSkuYXBwZW5kKCIpIik7CiAgICAgICAg\naWYgKGRlbEFjdGlvbiAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgT04gREVMRVRFICIpLmFwcGVuZChkZWxBY3Rpb24pOwogICAgICAgIGlm\nICh1cEFjdGlvbiAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nT04gVVBEQVRFICIpLmFwcGVuZCh1cEFjdGlvbik7CiAgICAgICAgaWYgKGZr\nLmlzRGVmZXJyZWQoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElOSVRJ\nQUxMWSBERUZFUlJFRCIpOwogICAgICAgIGlmIChzdXBwb3J0c0RlZmVycmVk\nRm9yZWlnbktleUNvbnN0cmFpbnRzKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBERUZFUlJBQkxFIik7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIu\naXNOdWxsKGZrLmdldElkZW50aWZpZXIoKSkKICAgICAgICAgICAgJiYgQ09O\nU19OQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQodG9E\nQk5hbWUoZmsuZ2V0SWRlbnRpZmllcigpKSk7CiAgICAgICAgcmV0dXJuIGJ1\nZi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBv\nciBub3QgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIGRlZmVycmVkIGZvcmVp\nZ24ga2V5IGNvbnN0cmFpbnRzLgogICAgICogVGhpcyBpbXBsZW1lbnRhdGlv\nbiByZXR1cm5zIHtAbGluayAjc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50c30u\nCiAgICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRGb3JlaWduS2V5Q29uc3Ry\nYWludHMoKSB7CiAgICAgICAgcmV0dXJuIHN1cHBvcnRzRGVmZXJyZWRDb25z\ndHJhaW50czsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbmFt\nZSBvZiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgYWN0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyBnZXRBY3Rpb25OYW1lKGludCBhY3Rpb24pIHsK\nICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIEZv\ncmVpZ25LZXkuQUNUSU9OX0NBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1\ncm4gIkNBU0NBREUiOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNU\nSU9OX05VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNFVCBOVUxMIjsK\nICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOgog\nICAgICAgICAgICAgICAgcmV0dXJuICJTRVQgREVGQVVMVCI7CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZGF0\nYWJhc2Ugc3VwcG9ydHMgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGRlbGV0ZSBh\nY3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVs\nZXRlQWN0aW9uKGludCBhY3Rpb24pIHsKICAgICAgICBpZiAoYWN0aW9uID09\nIEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmICghc3VwcG9ydHNGb3JlaWduS2V5cykKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7\nCiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Q6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNSZXN0cmljdERlbGV0\nZUFjdGlvbjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9D\nQVNDQURFOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzQ2FzY2Fk\nZURlbGV0ZUFjdGlvbjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFD\nVElPTl9OVUxMOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzTnVs\nbERlbGV0ZUFjdGlvbjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFD\nVElPTl9ERUZBVUxUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRz\nRGVmYXVsdERlbGV0ZUFjdGlvbjsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZGF0YWJhc2Ugc3VwcG9ydHMg\ndGhlIGdpdmVuIGZvcmVpZ24ga2V5IHVwZGF0ZSBhY3Rpb24uCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzVXBkYXRlQWN0aW9uKGludCBh\nY3Rpb24pIHsKICAgICAgICBpZiAoYWN0aW9uID09IEZvcmVpZ25LZXkuQUNU\nSU9OX05PTkUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlm\nICghc3VwcG9ydHNGb3JlaWduS2V5cykKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgIGNh\nc2UgRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Q6CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3VwcG9ydHNSZXN0cmljdFVwZGF0ZUFjdGlvbjsKICAgICAg\nICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9DQVNDQURFOgogICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cHBvcnRzQ2FzY2FkZVVwZGF0ZUFjdGlvbjsK\nICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9OVUxMOgogICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzTnVsbFVwZGF0ZUFjdGlvbjsK\nICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzRGVmYXVsdFVwZGF0ZUFj\ndGlvbjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdpdmVuIHVuaXF1\nZSBjb25zdHJhaW50LiBUaGlzCiAgICAgKiBtZXRob2QgaXMgdXNlZCBmcm9t\nIHdpdGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfS4KICAgICAqIFJl\ndHVybnMgPGNvZGU+Q09OU1RSQUlOVCAmbHQ7bmFtZSZndDsgVU5JUVVFICgm\nbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0VW5pcXVlQ29uc3RyYWlu\ndFNRTChVbmlxdWUgdW5xKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c1VuaXF1\nZUNvbnN0cmFpbnRzCiAgICAgICAgICAgIHx8ICh1bnEuaXNEZWZlcnJlZCgp\nICYmICFzdXBwb3J0c0RlZmVycmVkVW5pcXVlQ29uc3RyYWludHMoKSkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIFN0cmluZ0J1aWxkZXIg\nYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwodW5xLmdldElkZW50aWZpZXIoKSkKICAgICAgICAg\nICAgJiYgQ09OU19OQU1FX0JFRk9SRS5lcXVhbHMoY29uc3RyYWludE5hbWVN\nb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5h\ncHBlbmQoY2hlY2tOYW1lTGVuZ3RoKHRvREJOYW1lKHVucS5nZXRJZGVudGlm\naWVyKCkpLCAKICAgICAgICAgICAgICAgIG1heENvbnN0cmFpbnROYW1lTGVu\nZ3RoLCAibG9uZy1jb25zdHJhaW50LW5hbWUiKSkuYXBwZW5kKCIgIik7CiAg\nICAgICAgYnVmLmFwcGVuZCgiVU5JUVVFICIpOwogICAgICAgIGlmICghREJJ\nZGVudGlmaWVyLmlzTnVsbCh1bnEuZ2V0SWRlbnRpZmllcigpKSAmJiBDT05T\nX05BTUVfTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKHRvREJOYW1lKHVucS5nZXRJZGVudGlmaWVyKCkp\nKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5k\nKG5hbWluZ1V0aWwuYXBwZW5kQ29sdW1ucyh1bnEuZ2V0Q29sdW1ucygpKSku\nCiAgICAgICAgICAgIGFwcGVuZCgiKSIpOwogICAgICAgIGlmICh1bnEuaXNE\nZWZlcnJlZCgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgSU5JVElBTExZ\nIERFRkVSUkVEIik7CiAgICAgICAgaWYgKHN1cHBvcnRzRGVmZXJyZWRVbmlx\ndWVDb25zdHJhaW50cygpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgREVG\nRVJSQUJMRSIpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbCh1\nbnEuZ2V0SWRlbnRpZmllcigpKQogICAgICAgICAgICAmJiBDT05TX05BTUVf\nQUZURVIuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5UICIpLmFwcGVuZCh0b0RCTmFtZSh1\nbnEuZ2V0SWRlbnRpZmllcigpKSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBvciBub3Qg\ndGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIGRlZmVycmVkIHVuaXF1ZSBjb25z\ndHJhaW50cy4KICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB7\nQGxpbmsgI3N1cHBvcnRzVW5pcXVlQ29uc3RyYWludHN9LgogICAgICoKICAg\nICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBzdXBwb3J0c0RlZmVycmVkVW5pcXVlQ29uc3RyYWludHMoKSB7CiAgICAg\nICAgcmV0dXJuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50czsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIERhdGFiYXNlIG1l\ndGFkYXRhCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSB0YWJs\nZXMgZnJvbSBkYXRhYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVl\nIGlmIHRoZSBnaXZlbiB0YWJsZSBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0g\ndGFibGUgdGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNj\naGVtYSBkZWZpbml0aW9uLiBCeSBkZWZhdWx0LCByZXR1cm5zCiAgICAgKiB0\ncnVlIG9ubHkgaWYgdGhlIGdpdmVuIHRhYmxlIGlzIGluIHRoZSBpbnRlcm5h\nbCBsaXN0IG9mIHN5c3RlbSB0YWJsZXMsCiAgICAgKiBvciBpZiB0aGUgZ2l2\nZW4gc2NoZW1hIGlzIGluIHRoZSBsaXN0IG9mIHN5c3RlbSBzY2hlbWFzIGFu\nZCBpcyBub3QKICAgICAqIHRoZSB0YXJnZXQgc2NoZW1hLgogICAgICoKICAg\nICAqIEBwYXJhbSBuYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0g\nc2NoZW1hIHRoZSB0YWJsZSBzY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBA\ncGFyYW0gdGFyZ2V0U2NoZW1hIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNj\naGVtYSB3YXMgbGlzdGVkIGJ5CiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2Yg\naGlzIHNjaGVtYXMKICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzU3lzdGVtVGFibGUoU3RyaW5nIG5hbWUsIFN0cmlu\nZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAg\nICAgICByZXR1cm4gaXNTeXN0ZW1UYWJsZShEQklkZW50aWZpZXIubmV3VGFi\nbGUobmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEo\nc2NoZW1hKSwgdGFyZ2V0U2NoZW1hKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSB0YWJsZXMg\nZnJvbSBkYXRhYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlm\nIHRoZSBnaXZlbiB0YWJsZSBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0gdGFi\nbGUgdGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVt\nYSBkZWZpbml0aW9uLiBCeSBkZWZhdWx0LCByZXR1cm5zCiAgICAgKiB0cnVl\nIG9ubHkgaWYgdGhlIGdpdmVuIHRhYmxlIGlzIGluIHRoZSBpbnRlcm5hbCBs\naXN0IG9mIHN5c3RlbSB0YWJsZXMsCiAgICAgKiBvciBpZiB0aGUgZ2l2ZW4g\nc2NoZW1hIGlzIGluIHRoZSBsaXN0IG9mIHN5c3RlbSBzY2hlbWFzIGFuZCBp\ncyBub3QKICAgICAqIHRoZSB0YXJnZXQgc2NoZW1hLgogICAgICoKICAgICAq\nIEBwYXJhbSBuYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2No\nZW1hIHRoZSB0YWJsZSBzY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFy\nYW0gdGFyZ2V0U2NoZW1hIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVt\nYSB3YXMgbGlzdGVkIGJ5CiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlz\nIHNjaGVtYXMKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1U\nYWJsZShEQklkZW50aWZpZXIgbmFtZSwgREJJZGVudGlmaWVyIHNjaGVtYSwK\nICAgICAgICBib29sZWFuIHRhcmdldFNjaGVtYSkgewogICAgICAgIERCSWRl\nbnRpZmllciBzTmFtZSA9IERCSWRlbnRpZmllci50b1VwcGVyKG5hbWUpOwog\nICAgICAgIGlmIChzeXN0ZW1UYWJsZVNldC5jb250YWlucyhzTmFtZS5nZXRO\nYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBEQklk\nZW50aWZpZXIgc2NoTmFtZSA9IERCSWRlbnRpZmllci50b1VwcGVyKHNjaGVt\nYSk7CiAgICAgICAgcmV0dXJuICF0YXJnZXRTY2hlbWEgJiYgc2NoZW1hICE9\nIG51bGwKICAgICAgICAgICAgJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5z\nKHNjaE5hbWUuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\naXMgbWV0aG9kIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBpbmRleGVzIGZy\nb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGUgZ2l2ZW4gaW5kZXggbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIGluZGV4\nIHRoYXQKICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEg\nZGVmaW5pdGlvbi4gUmV0dXJucyBmYWxzZSBieSBkZWZhdWx0LgogICAgICoK\nICAgICAqIEBwYXJhbSBuYW1lIHRoZSBpbmRleCBuYW1lCiAgICAgKiBAcGFy\nYW0gdGFibGUgdGhlIGluZGV4IHRhYmxlCiAgICAgKiBAZGVwcmVjYXRlZAog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbUluZGV4KFN0cmlu\nZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2Vk\nIHRvIGZpbHRlciBzeXN0ZW0gaW5kZXhlcyBmcm9tIGRhdGFiYXNlIG1ldGFk\nYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluZGV4IG5h\nbWUgcmVwcmVzZW50cyBhIHN5c3RlbSBpbmRleCB0aGF0CiAgICAgKiBzaG91\nbGQgbm90IGFwcGVhciBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIFJldHVy\nbnMgZmFsc2UgYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFt\nZSB0aGUgaW5kZXggbmFtZQogICAgICogQHBhcmFtIHRhYmxlIHRoZSBpbmRl\neCB0YWJsZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbUlu\nZGV4KERCSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBzZXF1ZW5jZXMgZnJvbSBk\nYXRhYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBn\naXZlbiBzZXF1ZW5jZSByZXByZXNlbnRzIGEgc3lzdGVtIHNlcXVlbmNlIHRo\nYXQKICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVm\naW5pdGlvbi4gUmV0dXJucyB0cnVlIGlmIHN5c3RlbQogICAgICogc2NoZW1h\nIGJ5IGRlZmF1bHQuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRh\nYmxlIG5hbWUKICAgICAqIEBwYXJhbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVt\nYTsgbWF5IGJlIG51bGwKICAgICAqIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYg\ndHJ1ZSwgdGhlbiB0aGUgZ2l2ZW4gc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAg\nICAqIHRoZSB1c2VyIGFzIG9uZSBvZiBoaXMgc2NoZW1hcwogICAgICogQGRl\ncHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1T\nZXF1ZW5jZShTdHJpbmcgbmFtZSwgU3RyaW5nIHNjaGVtYSwKICAgICAgICBi\nb29sZWFuIHRhcmdldFNjaGVtYSkgewogICAgICAgIHJldHVybiBpc1N5c3Rl\nbVNlcXVlbmNlKERCSWRlbnRpZmllci5uZXdTZXF1ZW5jZShuYW1lKSwgCiAg\nICAgICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hKSwgdGFy\nZ2V0U2NoZW1hKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBzZXF1ZW5jZXMgZnJvbSBkYXRh\nYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZl\nbiBzZXF1ZW5jZSByZXByZXNlbnRzIGEgc3lzdGVtIHNlcXVlbmNlIHRoYXQK\nICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5p\ndGlvbi4gUmV0dXJucyB0cnVlIGlmIHN5c3RlbQogICAgICogc2NoZW1hIGJ5\nIGRlZmF1bHQuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxl\nIG5hbWUKICAgICAqIEBwYXJhbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsg\nbWF5IGJlIG51bGwKICAgICAqIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1\nZSwgdGhlbiB0aGUgZ2l2ZW4gc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAq\nIHRoZSB1c2VyIGFzIG9uZSBvZiBoaXMgc2NoZW1hcwogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1N5c3RlbVNlcXVlbmNlKERCSWRlbnRpZmllciBu\nYW1lLCBEQklkZW50aWZpZXIgc2NoZW1hLAogICAgICAgIGJvb2xlYW4gdGFy\nZ2V0U2NoZW1hKSB7CiAgICAgICAgcmV0dXJuICF0YXJnZXRTY2hlbWEgJiYg\nIURCSWRlbnRpZmllci5pc051bGwoc2NoZW1hKQogICAgICAgICAgICAmJiBz\neXN0ZW1TY2hlbWFTZXQuY29udGFpbnMoREJJZGVudGlmaWVyLnRvVXBwZXIo\nc2NoZW1hKS5nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVm\nbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgdGFibGVzIG1hdGNoaW5nIHRo\nZSBnaXZlbiBuYW1lIHBhdHRlcm4uCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgVGFibGVbXSBnZXRUYWJsZXMoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2No\nZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBn\nZXRUYWJsZXMobWV0YSwgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY2F0YWxv\nZyksIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAgICAg\nICAgICAgIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25u\nKTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUg\nc2NoZW1hIHRvIGZpbmQgdGFibGVzIG1hdGNoaW5nIHRoZSBnaXZlbiBuYW1l\nIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBUYWJsZVtdIGdldFRhYmxl\ncyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERCSWRlbnRpZmllciBzcWxDYXRh\nbG9nLAogICAgICAgIERCSWRlbnRpZmllciBzcWxTY2hlbWFOYW1lLCBEQklk\nZW50aWZpZXIgc3FsVGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICAKICAg\nICAgICBTdHJpbmcgc2NoZW1hTmFtZSA9IERCSWRlbnRpZmllci5pc051bGwo\nc3FsU2NoZW1hTmFtZSkgPyBudWxsIDogc3FsU2NoZW1hTmFtZS5nZXROYW1l\nKCk7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NjaGVtYUZvckdldFRhYmxlcykK\nICAgICAgICAgICAgc2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBnZXRTY2hlbWFOYW1lRm9yTWV0\nYWRhdGEoc3FsU2NoZW1hTmFtZSk7CiAgICAgICAgfQoKICAgICAgICBTdHJp\nbmdbXSB0eXBlcyA9IFN0cmluZ3Muc3BsaXQodGFibGVUeXBlcywgIiwiLCAw\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICB0eXBlc1tpXSA9IHR5cGVzW2ldLnRyaW0oKTsK\nCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAg\nICAgUmVzdWx0U2V0IHRhYmxlcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgdGFibGVzID0gbWV0YS5nZXRUYWJsZXMoZ2V0Q2F0YWxvZ05h\nbWVGb3JNZXRhZGF0YShzcWxDYXRhbG9nKSwKICAgICAgICAgICAgICAgIHNj\naGVtYU5hbWUsIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHNxbFRhYmxlTmFt\nZSksIHR5cGVzKTsKICAgICAgICAgICAgTGlzdCB0YWJsZUxpc3QgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlICh0YWJsZXMgIT0gbnVs\nbCAmJiB0YWJsZXMubmV4dCgpKQogICAgICAgICAgICAgICAgdGFibGVMaXN0\nLmFkZChuZXdUYWJsZSh0YWJsZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChU\nYWJsZVtdKSB0YWJsZUxpc3QudG9BcnJheShuZXcgVGFibGVbdGFibGVMaXN0\nLnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlm\nICh0YWJsZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgdGFibGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB0\nYWJsZSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgVGFibGUgbmV3VGFibGUoUmVz\ndWx0U2V0IHRhYmxlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBUYWJsZSB0ID0gbmV3IFRhYmxlKCk7CiAgICAgICAgdC5z\nZXRJZGVudGlmaWVyKGZyb21EQk5hbWUodGFibGVNZXRhLmdldFN0cmluZygi\nVEFCTEVfTkFNRSIpLCBEQklkZW50aWZpZXJUeXBlLlRBQkxFKSk7CiAgICAg\nICAgcmV0dXJuIHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCBzZXF1ZW5jZXMgbWF0Y2hpbmcgdGhlIGdp\ndmVuIG5hbWUgcGF0dGVybi4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgYXJy\nYXkgYnkgZGVmYXVsdCwgYXMgdGhlcmUgaXMgbm8gc3RhbmRhcmQgd2F5IHRv\nCiAgICAgKiByZXRyaWV2ZSBhIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAgICog\nQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlW10gZ2V0\nU2VxdWVuY2VzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFs\nb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyBzZXF1ZW5j\nZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2VzKG1ldGEsIERC\nSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLCBEQklkZW50aWZpZXIu\nbmV3U2NoZW1hKHNjaGVtYU5hbWUpLAogICAgICAgICAgICBEQklkZW50aWZp\nZXIubmV3U2VxdWVuY2Uoc2VxdWVuY2VOYW1lKSwgY29ubik7CiAgICAgICAg\nCiAgICB9CgogICAgcHVibGljIFNlcXVlbmNlW10gZ2V0U2VxdWVuY2VzKERh\ndGFiYXNlTWV0YURhdGEgbWV0YSwgREJJZGVudGlmaWVyIGNhdGFsb2csCiAg\nICAgICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmllciBz\nZXF1ZW5jZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U2VxdWVu\nY2VzU1FMKHNjaGVtYU5hbWUsIHNlcXVlbmNlTmFtZSk7CiAgICAgICAgaWYg\nKHN0ciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFNlcXVlbmNl\nWzBdOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHByZXBh\ncmVTdGF0ZW1lbnQoY29ubiwgc3RyKTsgICAgICAgIAogICAgICAgIFJlc3Vs\ndFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50\nIGlkeCA9IDE7CiAgICAgICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVs\nbChzY2hlbWFOYW1lKSkKICAgICAgICAgICAgICAgIHN0bW50LnNldFN0cmlu\nZyhpZHgrKywgREJJZGVudGlmaWVyLnRvVXBwZXIoc2NoZW1hTmFtZSkuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxs\nKHNlcXVlbmNlTmFtZSkpCiAgICAgICAgICAgICAgICBzdG1udC5zZXRTdHJp\nbmcoaWR4KyssIHNlcXVlbmNlTmFtZS5nZXROYW1lKCkpOwogICAgICAgICAg\nICBzZXRRdWVyeVRpbWVvdXQoc3RtbnQsIGNvbmYuZ2V0UXVlcnlUaW1lb3V0\nKCkpOwogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1u\ndCwgc3RyKTsKICAgICAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlKHJzKTsg\nICAgICAgICAgICAKICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpICAgIAogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHNlcXVlbmNlIGZyb20gdGhlIGluZm9ybWF0aW9u\nIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBTZXF1ZW5jZSBuZXdTZXF1ZW5jZShSZXN1bHRTZXQgc2VxdWVuY2VNZXRh\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNlcXVl\nbmNlIHNlcSA9IG5ldyBTZXF1ZW5jZSgpOwogICAgICAgIHNlcS5zZXRTY2hl\nbWFJZGVudGlmaWVyKGZyb21EQk5hbWUoU3RyaW5nVXRpbHMuc3RyaXBFbmQo\nc2VxdWVuY2VNZXRhLmdldFN0cmluZygiU0VRVUVOQ0VfU0NIRU1BIiksIG51\nbGwpLAogICAgICAgICAgICBEQklkZW50aWZpZXJUeXBlLlNDSEVNQSkpOwog\nICAgICAgIHNlcS5zZXRJZGVudGlmaWVyKGZyb21EQk5hbWUoU3RyaW5nVXRp\nbHMuc3RyaXBFbmQoc2VxdWVuY2VNZXRhLmdldFN0cmluZygiU0VRVUVOQ0Vf\nTkFNRSIpLCBudWxsKSwKICAgICAgICAgICAgREJJZGVudGlmaWVyVHlwZS5T\nRVFVRU5DRSkpOwogICAgICAgIHJldHVybiBzZXE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBuZWVkZWQgdG8gc2VsZWN0IHRoZSBs\naXN0IG9mIHNlcXVlbmNlcy4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKFN0cmluZyBz\nY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRTZXF1\nZW5jZXNTUUwoREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmll\nciBzZXF1ZW5jZU5hbWUpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5k\nIGNvbHVtbnMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRhYmxlIGFuZAogICAgICog\nY29sdW1uIHBhdHRlcm5zLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwog\nICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0\nYSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1h\nTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUsIENv\nbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gZ2V0Q29sdW1ucyhtZXRhLCBEQklkZW50aWZpZXIu\nbmV3Q2F0YWxvZyhjYXRhbG9nKSwKICAgICAgICAgICAgREJJZGVudGlmaWVy\nLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgREJJZGVudGlm\naWVyLm5ld1RhYmxlKHRhYmxlTmFtZSksCiAgICAgICAgICAgIERCSWRlbnRp\nZmllci5uZXdDb2x1bW4oY29sdW1uTmFtZSksCiAgICAgICAgICAgIGNvbm4p\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1h\nIHRvIGZpbmQgY29sdW1ucyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGFibGUgYW5k\nCiAgICAgKiBjb2x1bW4gcGF0dGVybnMuCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2x1bW5bXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgREJJ\nZGVudGlmaWVyIGNhdGFsb2csCiAgICAgICAgREJJZGVudGlmaWVyIHNjaGVt\nYU5hbWUsIERCSWRlbnRpZmllciB0YWJsZU5hbWUsIERCSWRlbnRpZmllciBj\nb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwo\ndGFibGVOYW1lKSAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRDb2x1bW5z\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAKICAgICAgICBT\ndHJpbmcgc3FsU2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAgaWYgKCFEQklk\nZW50aWZpZXIuaXNOdWxsKHNjaGVtYU5hbWUpKSB7CiAgICAgICAgICAgIHNx\nbFNjaGVtYU5hbWUgPSBzY2hlbWFOYW1lLmdldE5hbWUoKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKCFzdXBwb3J0c1NjaGVtYUZvckdldENvbHVtbnMpCiAg\nICAgICAgICAgIHNxbFNjaGVtYU5hbWUgPSBudWxsOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc3FsU2NoZW1hTmFtZSA9IGdldFNjaGVtYU5hbWVGb3JN\nZXRhZGF0YShzY2hlbWFOYW1lKTsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFP\ncGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0IGNvbHMgPSBudWxs\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbHMgPSBtZXRhLmdldENv\nbHVtbnMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAg\nICAgICAgICAgICAgIHNxbFNjaGVtYU5hbWUsIGdldFRhYmxlTmFtZUZvck1l\ndGFkYXRhKHRhYmxlTmFtZSksCiAgICAgICAgICAgICAgICBnZXRDb2x1bW5O\nYW1lRm9yTWV0YWRhdGEoY29sdW1uTmFtZSkpOwoKICAgICAgICAgICAgTGlz\ndCBjb2x1bW5MaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3\naGlsZSAoY29scyAhPSBudWxsICYmIGNvbHMubmV4dCgpKQogICAgICAgICAg\nICAgICAgY29sdW1uTGlzdC5hZGQobmV3Q29sdW1uKGNvbHMpKTsKICAgICAg\nICAgICAgcmV0dXJuIChDb2x1bW5bXSkgY29sdW1uTGlzdC50b0FycmF5CiAg\nICAgICAgICAgICAgICAobmV3IENvbHVtbltjb2x1bW5MaXN0LnNpemUoKV0p\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChjb2xzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIGNvbHMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbHVtbiBmcm9tIHRo\nZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgQ29sdW1uIG5ld0NvbHVtbihSZXN1bHRTZXQgY29s\nTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBD\nb2x1bW4gYyA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBjLnNldFNjaGVtYUlk\nZW50aWZpZXIoZnJvbURCTmFtZShjb2xNZXRhLmdldFN0cmluZygiVEFCTEVf\nU0NIRU0iKSwgREJJZGVudGlmaWVyVHlwZS5TQ0hFTUEpKTsKICAgICAgICBj\nLnNldFRhYmxlSWRlbnRpZmllcihmcm9tREJOYW1lKGNvbE1ldGEuZ2V0U3Ry\naW5nKCJUQUJMRV9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuVEFCTEUpKTsK\nICAgICAgICBjLnNldElkZW50aWZpZXIoZnJvbURCTmFtZShjb2xNZXRhLmdl\ndFN0cmluZygiQ09MVU1OX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5DT0xV\nTU4pKTsKICAgICAgICBjLnNldFR5cGUoY29sTWV0YS5nZXRJbnQoIkRBVEFf\nVFlQRSIpKTsKICAgICAgICBjLnNldFR5cGVJZGVudGlmaWVyKGZyb21EQk5h\nbWUoY29sTWV0YS5nZXRTdHJpbmcoIlRZUEVfTkFNRSIpLCBEQklkZW50aWZp\nZXJUeXBlLkNPTFVNTl9ERUZJTklUSU9OKSk7CiAgICAgICAgYy5zZXRTaXpl\nKGNvbE1ldGEuZ2V0SW50KCJDT0xVTU5fU0laRSIpKTsKICAgICAgICBjLnNl\ndERlY2ltYWxEaWdpdHMoY29sTWV0YS5nZXRJbnQoIkRFQ0lNQUxfRElHSVRT\nIikpOwogICAgICAgIGMuc2V0Tm90TnVsbChjb2xNZXRhLmdldEludCgiTlVM\nTEFCTEUiKQogICAgICAgICAgICA9PSBEYXRhYmFzZU1ldGFEYXRhLmNvbHVt\nbk5vTnVsbHMpOwoKICAgICAgICBTdHJpbmcgZGVmID0gY29sTWV0YS5nZXRT\ndHJpbmcoIkNPTFVNTl9ERUYiKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoZGVmKSAmJiAhIm51bGwiLmVxdWFsc0lnbm9yZUNhc2UoZGVm\nKSkKICAgICAgICAgICAgYy5zZXREZWZhdWx0U3RyaW5nKGRlZik7CiAgICAg\nICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZl\nbiB0YWJsZSBwYXR0ZXJuLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwog\nICAgcHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsCiAgICAgICAgU3RyaW5nIGNhdGFsb2csIFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGdldFByaW1hcnlLZXlzKG1ldGEsIERCSWRlbnRpZmllci5uZXdDYXRh\nbG9nKGNhdGFsb2cpLCBEQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5h\nbWUpLAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3VGFibGUodGFibGVO\nYW1lKSwgY29ubik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZl\nbiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMgUHJpbWFyeUtl\neVtdIGdldFByaW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwKICAg\nICAgICBEQklkZW50aWZpZXIgY2F0YWxvZywgREJJZGVudGlmaWVyIHNjaGVt\nYU5hbWUsIERCSWRlbnRpZmllciB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29u\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\ndXNlR2V0QmVzdFJvd0lkZW50aWZpZXJGb3JQcmltYXJ5S2V5cykKICAgICAg\nICAgICAgcmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUJlc3RSb3dJZGVudGlm\naWVyKG1ldGEsIGNhdGFsb2csCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1l\nLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgICAgIHJldHVybiBnZXRQcmltYXJ5\nS2V5c0Zyb21HZXRQcmltYXJ5S2V5cyhtZXRhLCBjYXRhbG9nLAogICAgICAg\nICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJp\nbWFyeSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAq\nIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5\nW10gZ2V0UHJpbWFyeUtleXNGcm9tR2V0UHJpbWFyeUtleXMKICAgICAgICAo\nRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywgU3RyaW5n\nIHNjaGVtYU5hbWUsCiAgICAgICAgICAgIFN0cmluZyB0YWJsZU5hbWUsIENv\nbm5lY3Rpb24gY29ubikKICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBnZXRQcmltYXJ5S2V5c0Zyb21HZXRQcmltYXJ5S2V5cyht\nZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRhbG9nKSwKICAgICAg\nICAgICAgREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgREJJ\nZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlTmFtZSksIGNvbm4pOwogICAgfQog\nICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBw\ncmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtdIGdldFByaW1hcnlLZXlz\nRnJvbUdldFByaW1hcnlLZXlzCiAgICAgICAgKERhdGFiYXNlTWV0YURhdGEg\nbWV0YSwgREJJZGVudGlmaWVyIGNhdGFsb2csIERCSWRlbnRpZmllciBzY2hl\nbWFOYW1lLAogICAgICAgICAgICBEQklkZW50aWZpZXIgdGFibGVOYW1lLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBwb3J0c051\nbGxUYWJsZUZvckdldFByaW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7\nCiAgICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcGtzID0gbWV0YS5nZXRQcmltYXJ5S2V5cyhnZXRDYXRh\nbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAg\nZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAg\nICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSk7\nCgogICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsK\nICAgICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxsICYmIHBrcy5uZXh0KCkp\nCiAgICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocGtz\nKSk7CiAgICAgICAgICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xpc3Qu\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3BrTGlz\ndC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAocGtzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHBrcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcHJpbWFy\neSBrZXkgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXkgbmV3UHJp\nbWFyeUtleShSZXN1bHRTZXQgcGtNZXRhKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIFByaW1hcnlLZXkgcGsgPSBuZXcgUHJpbWFy\neUtleSgpOwogICAgICAgIHBrLnNldFNjaGVtYUlkZW50aWZpZXIoZnJvbURC\nTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpLCBEQklkZW50\naWZpZXJUeXBlLlNDSEVNQSkpOwogICAgICAgIHBrLnNldFRhYmxlSWRlbnRp\nZmllcihmcm9tREJOYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUi\nKSwgREJJZGVudGlmaWVyVHlwZS5UQUJMRSkpOwogICAgICAgIHBrLnNldENv\nbHVtbklkZW50aWZpZXIoZnJvbURCTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJD\nT0xVTU5fTkFNRSIpLCBEQklkZW50aWZpZXJUeXBlLkNPTFVNTikpOwogICAg\nICAgIHBrLnNldElkZW50aWZpZXIoZnJvbURCTmFtZShwa01ldGEuZ2V0U3Ry\naW5nKCJQS19OQU1FIiksIERCSWRlbnRpZmllclR5cGUuQ09OU1RSQUlOVCkp\nOwogICAgICAgIHJldHVybiBwazsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3Ig\ndGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKiBAZGVwcmVjYXRlZAog\nICAgICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtdIGdldFByaW1hcnlL\nZXlzRnJvbUJlc3RSb3dJZGVudGlmaWVyCiAgICAgICAgKERhdGFiYXNlTWV0\nYURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFOYW1l\nLAogICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNv\nbm4pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRQ\ncmltYXJ5S2V5c0Zyb21CZXN0Um93SWRlbnRpZmllcihtZXRhLCBEQklkZW50\naWZpZXIubmV3Q2F0YWxvZyhjYXRhbG9nKSwKICAgICAgICAgICAgREJJZGVu\ndGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgREJJZGVudGlmaWVyLm5l\nd1RhYmxlKHRhYmxlTmFtZSksIGNvbm4pOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlz\nIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21CZXN0Um93\nSWRlbnRpZmllcgogICAgICAgIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERC\nSWRlbnRpZmllciBjYXRhbG9nLCBEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwK\nICAgICAgICAgICAgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgQ29ubmVjdGlv\nbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmICh0YWJsZU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwog\nICAgICAgIFJlc3VsdFNldCBwa3MgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHBrcyA9IG1ldGEuZ2V0QmVzdFJvd0lkZW50aWZpZXIodG9E\nQk5hbWUoY2F0YWxvZyksIHRvREJOYW1lKHNjaGVtYU5hbWUpLAogICAgICAg\nICAgICAgICAgdG9EQk5hbWUodGFibGVOYW1lKSwgMCwgZmFsc2UpOwoKICAg\nICAgICAgICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgICAgIHdoaWxlIChwa3MgIT0gbnVsbCAmJiBwa3MubmV4dCgpKSB7CiAg\nICAgICAgICAgICAgICBQcmltYXJ5S2V5IHBrID0gbmV3IFByaW1hcnlLZXko\nKTsKICAgICAgICAgICAgICAgIHBrLnNldFNjaGVtYUlkZW50aWZpZXIoc2No\nZW1hTmFtZSk7CiAgICAgICAgICAgICAgICBway5zZXRUYWJsZUlkZW50aWZp\nZXIodGFibGVOYW1lKTsKICAgICAgICAgICAgICAgIHBrLnNldENvbHVtbklk\nZW50aWZpZXIoZnJvbURCTmFtZShwa3MuZ2V0U3RyaW5nKCJDT0xVTU5fTkFN\nRSIpLCBEQklkZW50aWZpZXJUeXBlLkNPTFVNTikpOwogICAgICAgICAgICAg\nICAgcGtMaXN0LmFkZChwayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAgICAg\nICAgICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChwa3MgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGtz\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIGluZGV4\nZXMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKiBA\nZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgSW5kZXhbXSBnZXRJbmRl\neEluZm8oRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywK\nICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwg\nYm9vbGVhbiB1bmlxdWUsCiAgICAgICAgYm9vbGVhbiBhcHByb3gsIENvbm5l\nY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gZ2V0SW5kZXhJbmZvKG1ldGEsIERCSWRlbnRpZmllci5u\nZXdDYXRhbG9nKGNhdGFsb2cpLCAKICAgICAgICAgICAgREJJZGVudGlmaWVy\nLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgREJJZGVudGlmaWVyLm5ld1RhYmxl\nKHRhYmxlTmFtZSksIHVuaXF1ZSwKICAgICAgICAgICAgYXBwcm94LCBjb25u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVt\nYSB0byBmaW5kIGluZGV4ZXMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRhYmxlIHBh\ndHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleFtdIGdldEluZGV4SW5m\nbyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERCSWRlbnRpZmllciBjYXRhbG9n\nLAogICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZp\nZXIgdGFibGVOYW1lLCBib29sZWFuIHVuaXF1ZSwKICAgICAgICBib29sZWFu\nIGFwcHJveCwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVsbCAmJiAh\nc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8pCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlv\nbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgaW5kZXhlcyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaW5kZXhlcyA9IG1ldGEuZ2V0SW5k\nZXhJbmZvKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAg\nICAgICAgICAgICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1h\nTmFtZSksCiAgICAgICAgICAgICAgICBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0\nYSh0YWJsZU5hbWUpLCB1bmlxdWUsIGFwcHJveCk7CgogICAgICAgICAgICBM\naXN0IGluZGV4TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nd2hpbGUgKGluZGV4ZXMgIT0gbnVsbCAmJiBpbmRleGVzLm5leHQoKSkKICAg\nICAgICAgICAgICAgIGluZGV4TGlzdC5hZGQobmV3SW5kZXgoaW5kZXhlcykp\nOwogICAgICAgICAgICByZXR1cm4gKEluZGV4W10pIGluZGV4TGlzdC50b0Fy\ncmF5KG5ldyBJbmRleFtpbmRleExpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKGluZGV4ZXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXhl\ncy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgaW5kZXggZnJvbSB0aGUgaW5mb3Jt\nYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIEluZGV4IG5ld0luZGV4KFJlc3VsdFNldCBpZHhNZXRhKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEluZGV4IGlkeCA9\nIG5ldyBJbmRleCgpOwogICAgICAgIGlkeC5zZXRTY2hlbWFJZGVudGlmaWVy\nKGZyb21EQk5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIiks\nIERCSWRlbnRpZmllclR5cGUuU0NIRU1BKSk7CiAgICAgICAgaWR4LnNldFRh\nYmxlSWRlbnRpZmllcihmcm9tREJOYW1lKGlkeE1ldGEuZ2V0U3RyaW5nKCJU\nQUJMRV9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuVEFCTEUpKTsKICAgICAg\nICBpZHguc2V0Q29sdW1uSWRlbnRpZmllcihmcm9tREJOYW1lKGlkeE1ldGEu\nZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpLCBEQklkZW50aWZpZXJUeXBlLkNP\nTFVNTikpOwogICAgICAgIGlkeC5zZXRJZGVudGlmaWVyKGZyb21EQk5hbWUo\naWR4TWV0YS5nZXRTdHJpbmcoIklOREVYX05BTUUiKSwgREJJZGVudGlmaWVy\nVHlwZS5JTkRFWCkpOwogICAgICAgIGlkeC5zZXRVbmlxdWUoIWlkeE1ldGEu\nZ2V0Qm9vbGVhbigiTk9OX1VOSVFVRSIpKTsKICAgICAgICByZXR1cm4gaWR4\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1h\nIHRvIHJldHVybiBmb3JlaWduIGtleXMgaW1wb3J0ZWQgYnkgdGhlIGdpdmVu\nCiAgICAgKiB0YWJsZSBwYXR0ZXJuLgogICAgICogQGRlcHJlY2F0ZWQKICAg\nICAqLwogICAgcHVibGljIEZvcmVpZ25LZXlbXSBnZXRJbXBvcnRlZEtleXMo\nRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAg\nICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVj\ndGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBnZXRJbXBvcnRlZEtleXMobWV0YSwgY2F0YWxvZywgc2No\nZW1hTmFtZSwgdGFibGVOYW1lLCBjb25uLCB0cnVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byByZXR1cm4gZm9y\nZWlnbiBrZXlzIGltcG9ydGVkIGJ5IHRoZSBnaXZlbgogICAgICogdGFibGUg\ncGF0dGVybi4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXlbXSBnZXRJ\nbXBvcnRlZEtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBEQklkZW50aWZp\nZXIgY2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwg\nREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRJ\nbXBvcnRlZEtleXMobWV0YSwgY2F0YWxvZywgc2NoZW1hTmFtZSwgdGFibGVO\nYW1lLCBjb25uLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxl\nY3Qgb24gdGhlIHNjaGVtYSB0byByZXR1cm4gZnVsbCBmb3JlaWduIGtleXMg\naW1wb3J0ZWQgYnkgdGhlIGdpdmVuCiAgICAgKiB0YWJsZSBwYXR0ZXJuLgog\nICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIEZvcmVpZ25L\nZXlbXSBnZXRJbXBvcnRlZEtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBT\ndHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3Ry\naW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uLCBib29sZWFuIHBhcnRp\nYWxLZXlzKSAKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZ2V0SW1wb3J0ZWRLZXlzKG1ldGEsIERCSWRlbnRpZmllci5u\nZXdDYXRhbG9nKGNhdGFsb2cpLCAKICAgICAgICAgICAgREJJZGVudGlmaWVy\nLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgREJJZGVudGlmaWVyLm5ld1RhYmxl\nKHRhYmxlTmFtZSksIGNvbm4sIHBhcnRpYWxLZXlzKTsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gcmV0dXJu\nIGZ1bGwgZm9yZWlnbiBrZXlzIGltcG9ydGVkIGJ5IHRoZSBnaXZlbgogICAg\nICogdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25L\nZXlbXSBnZXRJbXBvcnRlZEtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBE\nQklkZW50aWZpZXIgY2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIgc2No\nZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBj\nb25uLCBib29sZWFuIHBhcnRpYWxLZXlzKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmICghc3VwcG9ydHNGb3JlaWduS2V5cykK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHRhYmxlTmFt\nZSA9PSBudWxsICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldEltcG9ydGVk\nS2V5cykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9y\nZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBr\nZXlzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBrZXlzID0g\nbWV0YS5nZXRJbXBvcnRlZEtleXMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0\nYShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JN\nZXRhZGF0YShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxl\nTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSkpOwoKICAgICAgICAgICAgTGlz\ndDxGb3JlaWduS2V5PiBpbXBvcnRlZEtleUxpc3QgPSBuZXcgQXJyYXlMaXN0\nPEZvcmVpZ25LZXk+KCk7CiAgICAgICAgICAgIE1hcDxGS01hcEtleSwgRm9y\nZWlnbktleT4gZmtNYXAgPSBuZXcgSGFzaE1hcDxGS01hcEtleSwgRm9yZWln\nbktleT4oKTsKCiAgICAgICAgICAgIHdoaWxlIChrZXlzICE9IG51bGwgJiYg\na2V5cy5uZXh0KCkpIHsKICAgICAgICAgICAgICAgIEZvcmVpZ25LZXkgbmZr\nID0gbmV3Rm9yZWlnbktleShrZXlzKTsKICAgICAgICAgICAgICAgIGlmICgh\ncGFydGlhbEtleXMpIHsKICAgICAgICAgICAgICAgICAgICBGb3JlaWduS2V5\nIGZrID0gY29tYmluZUZvcmVpZ25LZXkoZmtNYXAsIG5mayk7CiAgICAgICAg\nICAgICAgICAgICAgLy8gSWYgdGhlIGtleSByZXR1cm5lZCAhPSBuZXcga2V5\nLCBmayBjb2wgd2FzIGNvbWJpbmVkCiAgICAgICAgICAgICAgICAgICAgLy8g\nd2l0aCBleGlzdGluZyBmay4KICAgICAgICAgICAgICAgICAgICBpZiAoZmsg\nIT0gbmZrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGltcG9ydGVkS2V5TGlzdC5hZGQobmZrKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gKEZvcmVpZ25LZXlbXSkgaW1wb3J0\nZWRLZXlMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgRm9yZWln\nbktleVtpbXBvcnRlZEtleUxpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKGtleXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBrZXlzLmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQogICAgCiAgICAvKgogICAgICogQ29tYmluZXMgcGFydGlhbCBmb3JlaWdu\nIGtleXMgaW50byBzaW5ndWxhciBrZXkKICAgICAqLwogICAgcHJvdGVjdGVk\nIEZvcmVpZ25LZXkgY29tYmluZUZvcmVpZ25LZXkoTWFwPEZLTWFwS2V5LCBG\nb3JlaWduS2V5PiBma01hcCwKICAgICAgICBGb3JlaWduS2V5IGZrKSB7CiAg\nICAgICAgCiAgICAgICAgRktNYXBLZXkgZmttayA9IG5ldyBGS01hcEtleShm\nayk7CiAgICAgICAgRm9yZWlnbktleSBiYXNlS2V5ID0gZmtNYXAuZ2V0KGZr\nbWspOwogICAgICAgIC8vIEZvdW5kIHRoZSBGSywgYWRkIHRoZSBhZGRpdGlv\nbmFsIGNvbHVtbgogICAgICAgIGlmIChiYXNlS2V5ICE9IG51bGwpIHsKICAg\nICAgICAgICAgYmFzZUtleS5hZGRDb2x1bW4oZmspOwogICAgICAgICAgICBy\nZXR1cm4gYmFzZUtleTsKICAgICAgICB9CiAgICAgICAgLy8gZmtleSBpcyBu\nZXcKICAgICAgICBma01hcC5wdXQoZmttaywgZmspOwogICAgICAgIHJldHVy\nbiBmazsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBmb3Jl\naWduIGtleSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1l\ndGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktleSBuZXdG\nb3JlaWduS2V5KFJlc3VsdFNldCBma01ldGEpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgRm9yZWlnbktleSBmayA9IG5ldyBGb3Jl\naWduS2V5KCk7CiAgICAgICAgZmsuc2V0U2NoZW1hSWRlbnRpZmllcihmcm9t\nREJOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZLVEFCTEVfU0NIRU0iKSwgREJJ\nZGVudGlmaWVyVHlwZS5TQ0hFTUEpKTsKICAgICAgICBmay5zZXRUYWJsZUlk\nZW50aWZpZXIoZnJvbURCTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS1RBQkxF\nX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5UQUJMRSkpOwogICAgICAgIGZr\nLnNldENvbHVtbklkZW50aWZpZXIoZnJvbURCTmFtZShma01ldGEuZ2V0U3Ry\naW5nKCJGS0NPTFVNTl9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuQ09MVU1O\nKSk7CiAgICAgICAgZmsuc2V0SWRlbnRpZmllcihmcm9tREJOYW1lKGZrTWV0\nYS5nZXRTdHJpbmcoIkZLX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5GT1JF\nSUdOX0tFWSkpOwogICAgICAgIGZrLnNldFByaW1hcnlLZXlTY2hlbWFJZGVu\ndGlmaWVyKGZyb21EQk5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtUQUJMRV9T\nQ0hFTSIpLCBEQklkZW50aWZpZXJUeXBlLlNDSEVNQSkpOwogICAgICAgIGZr\nLnNldFByaW1hcnlLZXlUYWJsZUlkZW50aWZpZXIoZnJvbURCTmFtZShma01l\ndGEuZ2V0U3RyaW5nKCJQS1RBQkxFX05BTUUiKSwgREJJZGVudGlmaWVyVHlw\nZS5UQUJMRSkpOwogICAgICAgIGZrLnNldFByaW1hcnlLZXlDb2x1bW5JZGVu\ndGlmaWVyKGZyb21EQk5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtDT0xVTU5f\nTkFNRSIpLCBEQklkZW50aWZpZXJUeXBlLkNPTFVNTikpOwogICAgICAgIGZr\nLnNldEtleVNlcXVlbmNlKGZrTWV0YS5nZXRTaG9ydCgiS0VZX1NFUSIpKTsK\nICAgICAgICBmay5zZXREZWZlcnJlZChma01ldGEuZ2V0U2hvcnQoIkRFRkVS\nUkFCSUxJVFkiKQogICAgICAgICAgICA9PSBEYXRhYmFzZU1ldGFEYXRhLmlt\ncG9ydGVkS2V5SW5pdGlhbGx5RGVmZXJyZWQpOwoKICAgICAgICBpbnQgZGVs\nID0gZmtNZXRhLmdldFNob3J0KCJERUxFVEVfUlVMRSIpOwogICAgICAgIHN3\naXRjaCAoZGVsKSB7CiAgICAgICAgICAgIGNhc2UgRGF0YWJhc2VNZXRhRGF0\nYS5pbXBvcnRlZEtleVNldE51bGw6CiAgICAgICAgICAgICAgICBmay5zZXRE\nZWxldGVBY3Rpb24oRm9yZWlnbktleS5BQ1RJT05fTlVMTCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBEYXRhYmFzZU1ldGFE\nYXRhLmltcG9ydGVkS2V5U2V0RGVmYXVsdDoKICAgICAgICAgICAgICAgIGZr\nLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIERhdGFi\nYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlDYXNjYWRlOgogICAgICAgICAgICAg\nICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NB\nREUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWln\nbktleS5BQ1RJT05fUkVTVFJJQ1QpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmazsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIHRhYmxlIG5hbWUgdGhhdCB3aWxsIGJlIHVz\nZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxp\nbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEoU3RyaW5nIHRhYmxlTmFt\nZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZShEQklkZW50\naWZpZXIubmV3VGFibGUodGFibGVOYW1lKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSB0YWJsZSBuYW1lIHRoYXQgd2lsbCBiZSB1c2Vk\nIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5r\nIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKERCSWRlbnRpZmllciB0YWJs\nZU5hbWUpIHsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UodGFi\nbGVOYW1lLmdldFVucXVhbGlmaWVkTmFtZSgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIHNjaGVtYSBuYW1lIHRoYXQgd2lsbCBiZSB1\nc2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0Bs\naW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RyaW5nIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShTdHJpbmcgc2NoZW1h\nTmFtZSkgewogICAgICAgIGlmIChzY2hlbWFOYW1lID09IG51bGwpCiAgICAg\nICAgICAgIHNjaGVtYU5hbWUgPSBjb25mLmdldFNjaGVtYSgpOwogICAgICAg\nIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZShEQklkZW50aWZpZXIubmV3U2No\nZW1hKHNjaGVtYU5hbWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgdGhlIHNjaGVtYSBuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBvYnRh\naW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFiYXNl\nTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNj\naGVtYU5hbWVGb3JNZXRhZGF0YShEQklkZW50aWZpZXIgc2NoZW1hTmFtZSkg\newogICAgICAgIGlmIChEQklkZW50aWZpZXIuaXNOdWxsKHNjaGVtYU5hbWUp\nKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gREJJZGVudGlmaWVyLm5ld1Nj\naGVtYShjb25mLmdldFNjaGVtYSgpKTsKICAgICAgICByZXR1cm4gY29udmVy\ndFNjaGVtYUNhc2Uoc2NoZW1hTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBjYXRhbG9nIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQg\nZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsg\nRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJp\nbmcgZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShTdHJpbmcgY2F0YWxvZ05h\nbWUpIHsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoREJJZGVu\ndGlmaWVyLm5ld0NhdGFsb2coY2F0YWxvZ05hbWUpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgdGhlIGNhdGFsb2cgbmFtZSB0aGF0IHdpbGwg\nYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9t\nIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0cmluZyBnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKERCSWRlbnRp\nZmllciBjYXRhbG9nTmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2No\nZW1hQ2FzZShjYXRhbG9nTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBjb2x1bW4gbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Ig\nb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRh\nYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBn\nZXRDb2x1bW5OYW1lRm9yTWV0YWRhdGEoU3RyaW5nIGNvbHVtbk5hbWUpIHsK\nICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoREJJZGVudGlmaWVy\nLm5ld0NvbHVtbihjb2x1bW5OYW1lKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBjb2x1bW4gbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBm\nb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGluayBE\nYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmlu\nZyBnZXRDb2x1bW5OYW1lRm9yTWV0YWRhdGEoREJJZGVudGlmaWVyIGNvbHVt\nbk5hbWUpIHsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY29s\ndW1uTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgc2NoZW1hIG5hbWUgdG8gYSBuYW1lIHRoYXQgdGhlIGRhdGFi\nYXNlIHdpbGwKICAgICAqIGJlIGFibGUgdG8gdW5kZXJzdGFuZC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBjb252ZXJ0U2NoZW1hQ2FzZShTdHJpbmcg\nb2JqZWN0TmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2Fz\nZShEQklkZW50aWZpZXIubmV3SWRlbnRpZmllcihvYmplY3ROYW1lLCBEQklk\nZW50aWZpZXJUeXBlLkRFRkFVTFQsIGZhbHNlKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgc2NoZW1hIG5hbWUgdG8g\nYSBuYW1lIHRoYXQgdGhlIGRhdGFiYXNlIHdpbGwKICAgICAqIGJlIGFibGUg\ndG8gdW5kZXJzdGFuZC4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBjb252\nZXJ0U2NoZW1hQ2FzZShEQklkZW50aWZpZXIgb2JqZWN0TmFtZSkgewogICAg\nICAgIHJldHVybiB0b0RCTmFtZShuYW1pbmdVdGlsLmNvbnZlcnRTY2hlbWFD\nYXNlKG9iamVjdE5hbWUpLCBmYWxzZSk7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUmV0dXJuIERCIHNwZWNpZmljIHNjaGVtYUNhc2UgCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0U2NoZW1hQ2FzZSgpewogICAgICAgIHJl\ndHVybiBzY2hlbWFDYXNlOwogICAgfQogICAgICAgIAogICAgLyoqCiAgICAg\nKiBQcmVwYXJlZCB0aGUgY29ubmVjdGlvbiBmb3IgbWV0YWRhdGEgb3BlcmF0\naW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJlZm9yZU1ldGFkYXRh\nT3BlcmF0aW9uKENvbm5lY3Rpb24gYykgewogICAgICAgIGlmIChyZXF1aXJl\nc0F1dG9Db21taXRGb3JNZXRhRGF0YSkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgYy5yb2xsYmFjaygpOwogICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc3FsZSkgewogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIWMuZ2V0QXV0b0Nv\nbW1pdCgpKQogICAgICAgICAgICAgICAgICAgIGMuc2V0QXV0b0NvbW1pdCh0\ncnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUp\nIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VxdWVuY2VzIGFuZCBB\ndXRvLUFzc2lnbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbGFzdCBnZW5lcmF0ZWQgdmFs\ndWUgZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKiBUaHJvd3MgYW4gZXhj\nZXB0aW9uIGJ5IGRlZmF1bHQgaWYge0BsaW5rICNsYXN0R2VuZXJhdGVkS2V5\nUXVlcnl9IGlzIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0\nR2VuZXJhdGVkS2V5KENvbHVtbiBjb2wsIENvbm5lY3Rpb24gY29ubikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAobGFzdEdl\nbmVyYXRlZEtleVF1ZXJ5ID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5l\ndyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdldCgibm8tYXV0by1hc3NpZ24iKSk7\nCgogICAgICAgIC8vIHJlcGxhY2UgdGhpbmdzIGxpa2UgIlNFTEVDVCBNQVgo\nezB9KSBGUk9NIHsxfSIKICAgICAgICBTdHJpbmcgcXVlcnkgPSBsYXN0R2Vu\nZXJhdGVkS2V5UXVlcnk7CiAgICAgICAgaWYgKHF1ZXJ5LmluZGV4T2YoJ3sn\nKSAhPSAtMSkgLy8gb25seSBpZiB0aGUgdG9rZW4gaXMgaW4gdGhlIHN0cmlu\nZwogICAgICAgIHsKICAgICAgICAgICAgcXVlcnkgPSBNZXNzYWdlRm9ybWF0\nLmZvcm1hdChxdWVyeSwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAg\ndG9EQk5hbWUoY29sLmdldElkZW50aWZpZXIoKSksIGdldEZ1bGxOYW1lKGNv\nbC5nZXRUYWJsZSgpLCBmYWxzZSksCiAgICAgICAgICAgICAgICBnZXRHZW5l\ncmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKSwKICAgICAgICAgICAgfSk7CiAg\nICAgICAgfQoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IHBy\nZXBhcmVTdGF0ZW1lbnQoY29ubiwgcXVlcnkpOwogICAgICAgIFJlc3VsdFNl\ndCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2V0UXVl\ncnlUaW1lb3V0KHN0bW50LCBjb25mLmdldFF1ZXJ5VGltZW91dCgpKTsKICAg\nICAgICAgICAgcnMgPSBleGVjdXRlUXVlcnkoY29ubiwgc3RtbnQsIHF1ZXJ5\nKTsKICAgICAgICAgICAgcmV0dXJuIGdldEtleShycywgY29sKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkge30KICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwp\nICAgIAogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fSAKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNlcXVlbmNlIG5hbWUgdXNlZCBi\neSBkYXRhYmFzZXMgZm9yIHRoZSBnaXZlbiBhdXRvYXNzaWduZWQKICAgICAq\nIGNvbHVtbi4gVGhpcyBpcyBvbmx5IHVzZWQgYnkgZGF0YWJhc2VzIHRoYXQg\ncmVxdWlyZSBhbiBleHBsaWNpdCBuYW1lCiAgICAgKiB0byBiZSB1c2VkIGZv\nciBhdXRvLWFzc2lnbiBzdXBwb3J0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RyaW5nIGdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShDb2x1bW4gY29s\nKSB7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKG5hbWluZ1V0aWwuZ2V0R2Vu\nZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCwgbWF4QXV0b0Fzc2lnbk5hbWVM\nZW5ndGgpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBDb25maWd1cmFibGUgaW1wbGVtZW50YXRpb24KICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMg\ndm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikgewog\nICAgICAgIHRoaXMuY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgY29uZjsK\nICAgICAgICB0aGlzLmxvZyA9IHRoaXMuY29uZi5nZXRMb2coSkRCQ0NvbmZp\nZ3VyYXRpb24uTE9HX0pEQkMpOwoKICAgICAgICAvLyBDcmVhdGUgdGhlIG5h\nbWluZyB1dGlsaXR5CiAgICAgICAgbmFtaW5nVXRpbCA9IHRoaXMuY29uZi5n\nZXRJZGVudGlmaWVyVXRpbEluc3RhbmNlKCk7CiAgICAgICAgbmFtaW5nVXRp\nbC5zZXRJZGVudGlmaWVyQ29uZmlndXJhdGlvbih0aGlzKTsKICAgICAgICBj\nb25maWd1cmVOYW1pbmdSdWxlcygpOwoKICAgICAgICAvLyB3YXJuIGFib3V0\nIHVuc3VwcG9ydGVkIGRpY3RzCiAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFi\nbGVkKCkgJiYgIWlzU3VwcG9ydGVkKCkpCiAgICAgICAgICAgIGxvZy53YXJu\nKF9sb2MuZ2V0KCJkaWN0LW5vdC1zdXBwb3J0ZWQiLCBnZXRDbGFzcygpKSk7\nCiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzU3VwcG9ydGVkKCkgewog\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBjdXN0b20gZGljdCwgdHJhdmVyc2Ug\ndG8gd2hhdGV2ZXIgb3BlbmpwYSBkaWN0IGl0CiAgICAgICAgLy8gZXh0ZW5k\ncwogICAgICAgIENsYXNzIGMgPSBnZXRDbGFzcygpOwogICAgICAgIHdoaWxl\nICghYy5nZXROYW1lKCkuc3RhcnRzV2l0aCgib3JnLmFwYWNoZS5vcGVuanBh\nLiIpKQogICAgICAgICAgICBjID0gYy5nZXRTdXBlcmNsYXNzKCk7CgogICAg\nICAgIC8vIHRoZSBnZW5lcmljIGRiZGljdGlvbmFyeSBpcyBub3QgY29uc2lk\nZXJlZCBhIHN1cHBvcnRlZCBkaWN0OyBhbGwKICAgICAgICAvLyBvdGhlciBj\nb25jcmV0ZSBkaWN0aW9uYXJpZXMgYXJlCiAgICAgICAgaWYgKGMgPT0gREJE\naWN0aW9uYXJ5LmNsYXNzKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rh\ncnRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIGVu\nZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUg\nc2V0IG9mIHJlc2VydmVkIFNRTDkyIHdvcmRzIGZyb20gcmVzb3VyY2UKICAg\nICAgICBJbnB1dFN0cmVhbSBpbiA9IERCRGljdGlvbmFyeS5jbGFzcy5nZXRS\nZXNvdXJjZUFzU3RyZWFtCiAgICAgICAgICAgICgic3FsLWtleXdvcmRzLnJz\ncmMiKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmcga2V5d29y\nZHMgPSBuZXcgQnVmZmVyZWRSZWFkZXIobmV3IElucHV0U3RyZWFtUmVhZGVy\nKGluKSkuCiAgICAgICAgICAgICAgICByZWFkTGluZSgpOwogICAgICAgICAg\nICBpbi5jbG9zZSgpOwogICAgICAgICAgICByZXNlcnZlZFdvcmRTZXQuYWRk\nQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAgICAg\nICAgKGtleXdvcmRzLCAiLCIsIDApKSk7CiAgICAgICAgfSBjYXRjaCAoSU9F\neGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdHJ5IHsgaW4uY2xvc2UoKTsgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkg\ne30KICAgICAgICB9CgogICAgICAgIC8vIGFkZCBhZGRpdGlvbmFsIHJlc2Vy\ndmVkIHdvcmRzIHNldCBieSB1c2VyCiAgICAgICAgaWYgKHJlc2VydmVkV29y\nZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmVzZXJ2ZWRXb3JkU2V0LmFkZEFs\nbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAg\nIChyZXNlcnZlZFdvcmRzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKCiAg\nICAgICAgLy8gYWRkIHN5c3RlbSBzY2hlbWFzIHNldCBieSB1c2VyCiAgICAg\nICAgaWYgKHN5c3RlbVNjaGVtYXMgIT0gbnVsbCkKICAgICAgICAgICAgc3lz\ndGVtU2NoZW1hU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3Bs\naXQKICAgICAgICAgICAgICAgIChzeXN0ZW1TY2hlbWFzLnRvVXBwZXJDYXNl\nKCksICIsIiwgMCkpKTsKCiAgICAgICAgLy8gYWRkIHN5c3RlbSB0YWJsZXMg\nc2V0IGJ5IHVzZXIKICAgICAgICBpZiAoc3lzdGVtVGFibGVzICE9IG51bGwp\nCiAgICAgICAgICAgIHN5c3RlbVRhYmxlU2V0LmFkZEFsbChBcnJheXMuYXNM\naXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChzeXN0ZW1UYWJs\nZXMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwoKICAgICAgICAvLyBhZGQg\nZml4ZWQgc2l6ZSB0eXBlIG5hbWVzIHNldCBieSB0aGUgdXNlcgogICAgICAg\nIGlmIChmaXhlZFNpemVUeXBlTmFtZXMgIT0gbnVsbCkKICAgICAgICAgICAg\nZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3Ry\naW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKGZpeGVkU2l6ZVR5cGVOYW1l\ncy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CiAgICAgICAgCiAgICAgICAg\nLy8gaWYgdXNlciBoYXMgdW5zZXQgc2VxdWVuY2Ugc3FsLCBudWxsIGl0IG91\ndCBzbyB3ZSBrbm93IHNlcXVlbmNlcwogICAgICAgIC8vIGFyZW4ndCBzdXBw\nb3J0ZWQKICAgICAgICBuZXh0U2VxdWVuY2VRdWVyeSA9IFN0cmluZ1V0aWxz\nLnRyaW1Ub051bGwobmV4dFNlcXVlbmNlUXVlcnkpOwogICAgICAgIAogICAg\nICAgIGlmIChzZWxlY3RXb3JkcyAhPSBudWxsKQogICAgICAgICAgICBzZWxl\nY3RXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQo\nc2VsZWN0V29yZHMKICAgICAgICAgICAgICAgICAgICAudG9VcHBlckNhc2Uo\nKSwgIiwiLCAwKSkpOwogICAgICAgIAogICAgICAgIC8vIGluaXRpYWxpemUg\ndGhlIGVycm9yIGNvZGVzCiAgICAgICAgU1FMRXJyb3JDb2RlUmVhZGVyIGNv\nZGVSZWFkZXIgPSBuZXcgU1FMRXJyb3JDb2RlUmVhZGVyKCk7CiAgICAgICAg\nU3RyaW5nIHJzcmMgPSAic3FsLWVycm9yLXN0YXRlLWNvZGVzLnhtbCI7CiAg\nICAgICAgSW5wdXRTdHJlYW0gc3RyZWFtID0gZ2V0Q2xhc3MoKS5nZXRSZXNv\ndXJjZUFzU3RyZWFtKHJzcmMpOwogICAgICAgIFN0cmluZyBkaWN0aW9uYXJ5\nQ2xhc3NOYW1lID0gZ2V0Q2xhc3MoKS5nZXROYW1lKCk7CiAgICAgICAgaWYg\nKHN0cmVhbSA9PSBudWxsKSB7IC8vIFVzZXIgc3VwcGxpZWQgZGljdGlvbmFy\neSBidXQgbm8gZXJyb3IgY29kZXMgeG1sCiAgICAgICAgICAgIC8vIHVzZSBk\nZWZhdWx0CiAgICAgICAgICAgIHN0cmVhbSA9IERCRGljdGlvbmFyeS5jbGFz\ncy5nZXRSZXNvdXJjZUFzU3RyZWFtKHJzcmMpOwogICAgICAgICAgICBkaWN0\naW9uYXJ5Q2xhc3NOYW1lID0gZ2V0Q2xhc3MoKS5nZXRTdXBlcmNsYXNzKCku\nZ2V0TmFtZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlUmVhZGVyLnBhcnNl\nKHN0cmVhbSwgZGljdGlvbmFyeUNsYXNzTmFtZSwgdGhpcyk7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIGFkZEVycm9yQ29kZShpbnQgZXJyb3JUeXBl\nLCBTdHJpbmcgZXJyb3JDb2RlKSB7CiAgICAgICAgaWYgKGVycm9yQ29kZSA9\nPSBudWxsIHx8IGVycm9yQ29kZS50cmltKCkubGVuZ3RoKCkgPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIFNldDxTdHJpbmc+IGNvZGVzID0g\nc3FsU3RhdGVDb2Rlcy5nZXQoZXJyb3JUeXBlKTsKICAgICAgICBpZiAoY29k\nZXMgPT0gbnVsbCkgewogICAgICAgICAgICBjb2RlcyA9IG5ldyBIYXNoU2V0\nPFN0cmluZz4oKTsKICAgICAgICAgICAgY29kZXMuYWRkKGVycm9yQ29kZS50\ncmltKCkpOwogICAgICAgICAgICBzcWxTdGF0ZUNvZGVzLnB1dChlcnJvclR5\ncGUsIGNvZGVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2Rl\ncy5hZGQoZXJyb3JDb2RlLnRyaW0oKSk7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEZJWE1FIC0gT1BFTkpQQS05NTcgLSBsb2NrVGlt\nZW91dCBpcyBhIHNlcnZlci1zaWRlIGZ1bmN0aW9uIGFuZAogICAgICogc2hv\ndWxkbid0IGJlIHVzaW5nIGNsaWVudC1zaWRlIHNldFF1ZXJ5VGltZW91dCBm\nb3IgbG9jayB0aW1lb3V0cy4KICAgICAqIAogICAgICogVGhpcyBtZXRob2Qg\naXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1s\naWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2Ygc2V0dGluZyBxdWVyeSBh\nbmQgbG9jayB0aW1lb3V0cy4KICAgICAqIAogICAgICogQHBhcmFtIHN0bW50\nCiAgICAgKiBAcGFyYW0gZmV0Y2ggLSBvcHRpb25hbCBsb2NrIGFuZCBxdWVy\neSB0aW1lb3V0cyBpbiBtaWxsaXNlY29uZHMKICAgICAqIEBwYXJhbSBmb3JV\ncGRhdGUgLSB0cnVlIGlmIHdlIHNob3VsZCBhbHNvIHRyeSBzZXR0aW5nIGEg\nbG9jayB0aW1lb3V0CiAgICAgKiBAdGhyb3dzIFNRTEV4Y2VwdGlvbgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1lb3V0cyhQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgYm9vbGVhbiBmb3JVcGRhdGUpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChzdXBwb3J0c1F1ZXJ5VGltZW91dCkgewogICAgICAg\nICAgICBpbnQgdGltZW91dCA9IGZldGNoLmdldFF1ZXJ5VGltZW91dCgpOwog\nICAgICAgICAgICBpZiAoZm9yVXBkYXRlKSB7CiAgICAgICAgICAgICAgICAv\nLyBpZiB0aGlzIGlzIGEgbG9ja2luZyBzZWxlY3QgYW5kIHRoZSBsb2NrIHRp\nbWVvdXQgaXMgZ3JlYXRlciAKICAgICAgICAgICAgICAgIC8vIHRoYW4gdGhl\nIGNvbmZpZ3VyZWQgcXVlcnkgdGltZW91dCwgdXNlIHRoZSBsb2NrIHRpbWVv\ndXQKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBNYXRoLm1heChmZXRjaC5n\nZXRRdWVyeVRpbWVvdXQoKSwgCiAgICAgICAgICAgICAgICAgICAgZmV0Y2gu\nZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nc2V0UXVlcnlUaW1lb3V0KHN0bW50LCB0aW1lb3V0KTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGSVhNRSAtIE9QRU5KUEEtOTU3IC0gbG9j\na1RpbWVvdXQgaXMgYSBzZXJ2ZXItc2lkZSBmdW5jdGlvbiBhbmQKICAgICAq\nIHNob3VsZG4ndCBiZSB1c2luZyBjbGllbnQtc2lkZSBzZXRRdWVyeVRpbWVv\ndXQgZm9yIGxvY2sgdGltZW91dHMuCiAgICAgKiAKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpE\nQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHNldHRpbmcgcXVl\ncnkgYW5kIGxvY2sgdGltZW91dHMuCiAgICAgKiAKICAgICAqIEBwYXJhbSBz\ndG1udAogICAgICogQHBhcmFtIGNvbmYgLSBvcHRpb25hbCBsb2NrIGFuZCBx\ndWVyeSB0aW1lb3V0cyBpbiBtaWxsaXNlY29uZHMKICAgICAqIEBwYXJhbSBm\nb3JVcGRhdGUgLSB0cnVlIGlmIHdlIHNob3VsZCBhbHNvIHRyeSBzZXR0aW5n\nIGEgbG9jayB0aW1lb3V0CiAgICAgKiBAdGhyb3dzIFNRTEV4Y2VwdGlvbgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1lb3V0cyhQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwKICAgICAg\nICBib29sZWFuIGZvclVwZGF0ZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHN1cHBvcnRzUXVlcnlUaW1lb3V0KSB7CiAgICAgICAgICAg\nIGludCB0aW1lb3V0ID0gY29uZi5nZXRRdWVyeVRpbWVvdXQoKTsKICAgICAg\nICAgICAgaWYgKGZvclVwZGF0ZSkgewogICAgICAgICAgICAgICAgLy8gaWYg\ndGhpcyBpcyBhIGxvY2tpbmcgc2VsZWN0IGFuZCB0aGUgbG9jayB0aW1lb3V0\nIGlzIGdyZWF0ZXIKICAgICAgICAgICAgICAgIC8vIHRoYW4gdGhlIGNvbmZp\nZ3VyZWQgcXVlcnkgdGltZW91dCwgdXNlIHRoZSBsb2NrIHRpbWVvdXQKICAg\nICAgICAgICAgICAgIHRpbWVvdXQgPSBNYXRoLm1heChjb25mLmdldFF1ZXJ5\nVGltZW91dCgpLCAKICAgICAgICAgICAgICAgICAgICBjb25mLmdldExvY2tU\naW1lb3V0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldFF1ZXJ5\nVGltZW91dChzdG1udCwgdGltZW91dCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUHJvdmlkZXMgdGhlIGRlZmF1bHQgdmFsaWRhdGlvbiBo\nYW5kbGluZyBvZiBzZXR0aW5nIGEgcXVlcnkgdGltZW91dC4KICAgICAqIEBw\nYXJhbSBzdG1udAogICAgICogQHBhcmFtIHRpbWVvdXQgaW4gbWlsbGlzZWNv\nbmRzCiAgICAgKiBAdGhyb3dzIFNRTEV4Y2VwdGlvbgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRRdWVyeVRpbWVvdXQoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCB0aW1lb3V0KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChzdXBwb3J0c1F1ZXJ5VGltZW91dCkgewogICAg\nICAgICAgICBpZiAodGltZW91dCA9PSAtMSkgewogICAgICAgICAgICAgICAg\nLy8gc3BlY2lhbCBPcGVuSlBBIGFsbG93ZWQgY2FzZSBkZW5vdGluZyBubyB0\naW1lb3V0CiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gMDsKICAgICAgICAg\nICAgfSBlbHNlIGlmICh0aW1lb3V0IDwgMCkgewogICAgICAgICAgICAgICAg\naWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQtdGltZW91dCIsIG5ldyBJbnRl\nZ2VyKHRpbWVvdXQpKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAodGltZW91dCA+IDAgJiYgdGltZW91dCA8IDEw\nMDApIHsKICAgICAgICAgICAgICAgIC8vIHJvdW5kIHVwIHRvIDEgc2VjCiAg\nICAgICAgICAgICAgICB0aW1lb3V0ID0gMTAwMDsgCiAgICAgICAgICAgICAg\nICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgibWlsbGlzLXF1ZXJ5LXRpbWVvdXQiKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0U3RhdGVtZW50UXVlcnlU\naW1lb3V0KHN0bW50LCB0aW1lb3V0KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIHByb3ZpZGUgREIgdW5p\ncXVlIG92ZXJyaWRlIGltcGxlbWVudGF0aW9ucyBvZgogICAgICogc2V0dGlu\nZyBxdWVyeSB0aW1lb3V0cywgd2hpbGUgcHJlc2VydmluZyB0aGUgZGVmYXVs\ndCB0aW1lb3V0IGxvZ2ljCiAgICAgKiBpbiB0aGUgcHVibGljIHNldFF1ZXJ5\nVGltZW91dCBtZXRob2QuCiAgICAgKiBAcGFyYW0gc3RtbnQKICAgICAqIEBw\nYXJhbSB0aW1lb3V0IGluIG1pbGxpc2Vjb25kcwogICAgICogQHRocm93cyBT\nUUxFeGNlcHRpb24KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0U3Rh\ndGVtZW50UXVlcnlUaW1lb3V0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCAK\nICAgICAgICBpbnQgdGltZW91dCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gSkRCQyB1c2VzIHNlY29uZHMsIHNvIHdlJ2xsIGRvIGEgc2lt\ncGxlIHJvdW5kLWRvd24gY29udmVyc2lvbiBoZXJlCiAgICAgICAgc3RtbnQu\nc2V0UXVlcnlUaW1lb3V0KHRpbWVvdXQgLyAxMDAwKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nQ29ubmVjdGlvbkRlY29yYXRvciBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIERlY29yYXRlIHRoZSBnaXZlbiBjb25uZWN0aW9uIGlmIG5lZWRlZC4g\nU29tZSBkYXRhYmFzZXMgcmVxdWlyZSBzcGVjaWFsCiAgICAgKiBoYW5kbGlu\nZyBmb3IgSkRCQyBidWdzLiBUaGlzIGltcGxlbWVudGF0aW9uIGlzc3VlcyBh\nbnkKICAgICAqIHtAbGluayAjaW5pdGlhbGl6YXRpb25TUUx9IHRoYXQgaGFz\nIGJlZW4gc2V0IGZvciB0aGUgZGljdGlvbmFyeSBidXQKICAgICAqIGRvZXMg\nbm90IGRlY29yYXRlIHRoZSBjb25uZWN0aW9uLgogICAgICovCiAgICBwdWJs\naWMgQ29ubmVjdGlvbiBkZWNvcmF0ZShDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFjb25uZWN0\nZWQpCiAgICAgICAgICAgIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oY29ubik7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGluaXRpYWxpemF0\naW9uU1FMKSkgewogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBz\ndG1udCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudChpbml0aWFsaXphdGlvblNR\nTCk7CiAgICAgICAgICAgICAgICBzdG1udC5leGVjdXRlKCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBp\nZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKGUudG9TdHJpbmcoKSwgZSk7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAg\nICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY29ubjsKICAg\nIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudGF0aW9uIG9mIHRoZQogICAg\nICoge0BsaW5rIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLlNRTFdhcm5p\nbmdIYW5kbGVyfSBpbnRlcmZhY2UKICAgICAqIHRoYXQgYWxsb3dzIGN1c3Rv\nbWl6YXRpb24gb2YgdGhlIGFjdGlvbnMgdG8gcGVyZm9ybSB3aGVuIGEKICAg\nICAqIHtAbGluayBTUUxXYXJuaW5nfSBvY2N1cnMgYXQgYW55IHBvaW50IG9u\nIGEge0BsaW5rIENvbm5lY3Rpb259LAogICAgICoge0BsaW5rIFN0YXRlbWVu\ndH0sIG9yIHtAbGluayBSZXN1bHRTZXR9LiBUaGlzIG1ldGhvZCBtYXkKICAg\nICAqIGJlIHVzZWQgZGV0ZXJtaW5lIHRob3NlIHdhcm5pbmdzIHRoZSBhcHBs\naWNhdGlvbiB3YW50cyB0bwogICAgICogY29uc2lkZXIgY3JpdGljYWwgZmFp\nbHVyZXMsIGFuZCB0aHJvdyB0aGUgd2FybmluZyBpbiB0aG9zZQogICAgICog\nY2FzZXMuIEJ5IGRlZmF1bHQsIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZy4K\nICAgICAqCiAgICAgKiBAc2VlIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9y\nI3NldFdhcm5pbmdBY3Rpb24KICAgICAqIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rp\nb25EZWNvcmF0b3Ijc2V0V2FybmluZ0hhbmRsZXIKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgaGFuZGxlV2FybmluZyhTUUxXYXJuaW5nIHdhcm5pbmcpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBuZXcgZXhjZXB0aW9uIHRoYXQgd3JhcHMgPGNvZGU+\nY2F1c2VzPC9jb2RlPi4KICAgICAqIEhvd2V2ZXIsIHRoZSBkZXRhaWxzIG9m\nIGV4YWN0bHkgd2hhdCB0eXBlIG9mIGV4Y2VwdGlvbiBpcyByZXR1cm5lZCBj\nYW4KICAgICAqIGJlIGRldGVybWluZWQgYnkgdGhlIGltcGxlbWVudGF0aW9u\nLiBUaGlzIG1heSB0YWtlIGludG8gYWNjb3VudAogICAgICogREItc3BlY2lm\naWMgZXhjZXB0aW9uIGluZm9ybWF0aW9uIGluIDxjb2RlPmNhdXNlczwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBRXhjZXB0aW9uIG5ld1N0\nb3JlRXhjZXB0aW9uKFN0cmluZyBtc2csIFNRTEV4Y2VwdGlvbltdIGNhdXNl\ncywgT2JqZWN0IGZhaWxlZCkgewogICAgICAgIGlmIChjYXVzZXMgIT0gbnVs\nbCAmJiBjYXVzZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBPcGVuSlBB\nRXhjZXB0aW9uIHJldCA9IG5hcnJvdyhtc2csIGNhdXNlc1swXSwgZmFpbGVk\nKTsKICAgICAgICAgICAgcmV0LnNldEZhaWxlZE9iamVjdChmYWlsZWQpLnNl\ndE5lc3RlZFRocm93YWJsZXMoY2F1c2VzKTsKICAgICAgICAgICAgcmV0dXJu\nIHJldDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTdG9yZUV4Y2Vw\ndGlvbihtc2cpLnNldEZhaWxlZE9iamVjdChmYWlsZWQpLgogICAgICAgICAg\nICBzZXROZXN0ZWRUaHJvd2FibGVzKGNhdXNlcyk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogR2V0cyB0aGUgY2F0ZWdvcnkgb2YgU3RvcmVFeGNlcHRp\nb24gYnkgbWF0Y2hpbmcgdGhlIGdpdmVuIFNRTEV4Y2VwdGlvbidzCiAgICAg\nKiBlcnJvciBzdGF0ZSBjb2RlIHRvIHRoZSBsaXN0IG9mIGVycm9yIGNvZGVz\nIHN1cHBsaWVkIGJ5IHRoZSBkaWN0aW9uYXJ5LgogICAgICogCiAgICAgKiBA\ncmV0dXJuIGEgU3RvcmVFeGNlcHRpb24gb2Yge0BsaW5rIEV4Y2VwdGlvbklu\nZm8jR0VORVJBTCBnZW5lcmFsfSBjYXRlZ29yeQogICAgICogaWYgdGhlIGdp\ndmVuIFNRTCBFeGNlcHRpb24gY2FuIG5vdCBiZSBmdXJ0aGVyIGNhdGVnb3Jp\nemVkLgogICAgICogCiAgICAgKiBAc2VlICNtYXRjaEVycm9yU3RhdGUoTWFw\nLCBTUUxFeGNlcHRpb24pCiAgICAgKi8KICAgIE9wZW5KUEFFeGNlcHRpb24g\nbmFycm93KFN0cmluZyBtc2csIFNRTEV4Y2VwdGlvbiBleCwgT2JqZWN0IGZh\naWxlZCkgewogICAgICAgIGludCBlcnJvclR5cGUgPSBtYXRjaEVycm9yU3Rh\ndGUoc3FsU3RhdGVDb2RlcywgZXgpOwogICAgICAgIFN0b3JlRXhjZXB0aW9u\nIHN0b3JlRXg7CiAgICAgICAgc3dpdGNoIChlcnJvclR5cGUpIHsKICAgICAg\nICBjYXNlIFN0b3JlRXhjZXB0aW9uLkxPQ0s6CiAgICAgICAgICAgIHN0b3Jl\nRXggPSBuZXcgTG9ja0V4Y2VwdGlvbihmYWlsZWQpOwogICAgICAgICAgICBi\ncmVhazsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0aW9uLk9CSkVDVF9FWElT\nVFM6CiAgICAgICAgICAgIHN0b3JlRXggPSBuZXcgT2JqZWN0RXhpc3RzRXhj\nZXB0aW9uKG1zZyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2Ug\nU3RvcmVFeGNlcHRpb24uT0JKRUNUX05PVF9GT1VORDoKICAgICAgICAgICAg\nc3RvcmVFeCA9IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQp\nOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0\naW9uLk9QVElNSVNUSUM6CiAgICAgICAgICAgIHN0b3JlRXggPSBuZXcgT3B0\naW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQpOwogICAgICAgICAgICBicmVhazsK\nICAgICAgICBjYXNlIFN0b3JlRXhjZXB0aW9uLlJFRkVSRU5USUFMX0lOVEVH\nUklUWToKICAgICAgICAgICAgc3RvcmVFeCA9IG5ldyBSZWZlcmVudGlhbElu\ndGVncml0eUV4Y2VwdGlvbihtc2cpOwogICAgICAgICAgICBicmVhazsKICAg\nICAgICBjYXNlIFN0b3JlRXhjZXB0aW9uLlFVRVJZOgogICAgICAgICAgICBz\ndG9yZUV4ID0gbmV3IFF1ZXJ5RXhjZXB0aW9uKG1zZyk7CiAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHN0b3JlRXgg\nPSBuZXcgU3RvcmVFeGNlcHRpb24obXNnKTsKICAgICAgICB9CiAgICAgICAg\nc3RvcmVFeC5zZXRGYXRhbChpc0ZhdGFsRXhjZXB0aW9uKGVycm9yVHlwZSwg\nZXgpKTsKICAgICAgICByZXR1cm4gc3RvcmVFeDsKICAgIH0KCiAgICAvKioK\nICAgICAqIERldGVybWluZSB0aGUgbW9yZSBhcHByb3ByaWF0ZSB0eXBlIG9m\nIHN0b3JlIGV4Y2VwdGlvbiBieSBtYXRjaGluZyB0aGUgU1FMIEVycm9yIFN0\nYXRlIG9mIHRoZQogICAgICogdGhlIGdpdmVuIFNRTEV4Y2VwdGlvbiB0byB0\naGUgZ2l2ZW4gRXJyb3IgU3RhdGVzIGNhdGVnb3JpemVkIGJ5IGVycm9yIHR5\ncGVzLgogICAgICogRGljdGlvbmFyeSBzdWJjbGFzcyBjYW4gb3ZlcnJpZGUg\ndGhpcyBtZXRob2QgYW5kIGV4dHJhY3QKICAgICAqIFNRTEV4Y2VwdGlvbiBk\nYXRhIHRvIGZpZ3VyZSBvdXQgaWYgdGhlIGV4Y2VwdGlvbiBpcyByZWNvdmVy\nYWJsZS4KICAgICAqIAogICAgICogQHBhcmFtIGVycm9yU3RhdGVzIGNsYXNz\naWZpY2F0aW9uIG9mIFNRTCBlcnJvciBzdGF0ZXMgYnkgdGhlaXIgc3BlY2lm\naWMgbmF0dXJlLiBUaGUga2V5cyBvZiB0aGUKICAgICAqIG1hcCByZXByZXNl\nbnQgb25lIG9mIHRoZSBjb25zdGFudHMgZGVmaW5lZCBpbiB7QGxpbmsgU3Rv\ncmVFeGNlcHRpb259LiBUaGUgdmFsdWUgY29ycmVzcG9uZGluZyB0bwogICAg\nICogYSBrZXkgcmVwcmVzZW50IHRoZSBzZXQgb2YgU1FMIEVycm9yIFN0YXRl\ncyByZXByZXNlbnRpbmcgc3BlY2lmaWMgY2F0ZWdvcnkgb2YgZGF0YWJhc2Ug\nZXJyb3IuIAogICAgICogVGhpcyBzdXBwbGllZCBtYXAgaXMgc291cmNlZCBm\ncm9tIDxjb2RlPnNxbC1lcnJvci1zdGF0ZS1jb2Rlcy54bWw8L3htbD4gYW5k\nIGZpbHRlcmVkIHRoZQogICAgICogZXJyb3Igc3RhdGVzIGZvciB0aGUgY3Vy\ncmVudCBkYXRhYmFzZS4KICAgICAqIAogICAgICogQHBhcmFtIGV4IG9yaWdp\nbmFsIFNRTCBFeGNlcHRpb24gYXMgcmFpc2VkIGJ5IHRoZSBkYXRhYmFzZSBk\ncml2ZXIuCiAgICAgKiAKICAgICAqIEByZXR1cm4gQSBjb25zdGFudCBpbmRp\nY2F0aW5nIHRoZSBjYXRlZ29yeSBvZiBlcnJvciBhcyBkZWZpbmVkIGluIHtA\nbGluayBTdG9yZUV4Y2VwdGlvbn0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBp\nbnQgbWF0Y2hFcnJvclN0YXRlKE1hcDxJbnRlZ2VyLFNldDxTdHJpbmc+PiBl\ncnJvclN0YXRlcywgU1FMRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgU3RyaW5n\nIGVycm9yU3RhdGUgPSBleC5nZXRTUUxTdGF0ZSgpOwogICAgICAgIGZvciAo\nTWFwLkVudHJ5PEludGVnZXIsU2V0PFN0cmluZz4+IHN0YXRlcyA6IGVycm9y\nU3RhdGVzLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgaWYgKHN0YXRlcy5n\nZXRWYWx1ZSgpLmNvbnRhaW5zKGVycm9yU3RhdGUpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHN0YXRlcy5nZXRLZXkoKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIFN0b3JlRXhjZXB0aW9uLkdFTkVSQUw7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBTUUwgRXhjZXB0\naW9uIGlzIGZhdGFsIG9yIHJlY292ZXJhYmxlIChzdWNoIGFzIGEgdGltZW91\ndCkuCiAgICAgKiBUaGlzIGltcGxlbWVudGF0aW9uIGFsd2F5cyByZXR1cm5z\nIHRydWUgKGkuZS4gYWxsIGV4Y2VwdGlvbnMgYXJlIGZhdGFsKS4KICAgICAq\nIFRoZSBjdXJyZW50IGRpY3Rpb25hcnkgaW1wbGVtZW50YXRpb24gY2FuIG92\nZXJ3cml0ZSB0aGlzIG1ldGhvZCB0byBtYXJrIGNlcnRhaW4KICAgICAqIGV4\nY2VwdGlvbiBjb25kaXRpb25zIGFzIHJlY292ZXJhYmxlIGVycm9yLgoKICAg\nICAqIEBwYXJhbSBzdWJ0eXBlIEEgY29uc3RhbnQgaW5kaWNhdGluZyB0aGUg\nY2F0ZWdvcnkgb2YgZXJyb3IgYXMgZGVmaW5lZCBpbiB7QGxpbmsgU3RvcmVF\neGNlcHRpb259LiAKICAgICAqIEBwYXJhbSBleCBvcmlnaW5hbCBTUUwgRXhj\nZXB0aW9uIGFzIHJhaXNlZCBieSB0aGUgZGF0YWJhc2UgZHJpdmVyLgogICAg\nICogCiAgICAgKiBAcmV0dXJuIGZhbHNlIGlmIHRoZSBlcnJvciBpcyBmYXRh\nbC4gCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRmF0YWxFeGNlcHRp\nb24oaW50IHN1YnR5cGUsIFNRTEV4Y2VwdGlvbiBleCkgewogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENsb3NlcyB0\naGUgc3BlY2lmaWVkIHtAbGluayBEYXRhU291cmNlfSBhbmQgcmVsZWFzZXMg\nYW55CiAgICAgKiByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRoIGl0LgogICAg\nICoKICAgICAqIEBwYXJhbSBkYXRhU291cmNlIHRoZSBEYXRhU291cmNlIHRv\nIGNsb3NlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3NlRGF0YVNvdXJj\nZShEYXRhU291cmNlIGRhdGFTb3VyY2UpIHsKICAgICAgICBEYXRhU291cmNl\nRmFjdG9yeS5jbG9zZURhdGFTb3VyY2UoZGF0YVNvdXJjZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBVc2VkIGJ5IHNvbWUgbWFwcGluZ3MgdG8gcmVwcmVz\nZW50IGRhdGEgdGhhdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAgKiBzZXJpYWxp\nemVkIHNvIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byBzZXJpYWxpemUgbXVsdGlw\nbGUgdGltZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2Vy\naWFsaXplZERhdGEgewoKICAgICAgICBwdWJsaWMgZmluYWwgYnl0ZVtdIGJ5\ndGVzOwoKICAgICAgICBwdWJsaWMgU2VyaWFsaXplZERhdGEoYnl0ZVtdIGJ5\ndGVzKSB7CiAgICAgICAgICAgIHRoaXMuYnl0ZXMgPSBieXRlczsKICAgICAg\nICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHZlcnNpb24g\nY29sdW1uIG5hbWUKICAgICAqIEBwYXJhbSBjb2x1bW4KICAgICAqIEBwYXJh\nbSB0YWJsZUFsaWFzIDogdGhpcyBpcyBuZWVkZWQgZm9yIHBsYXRmb3JtIHNw\nZWNpZmljIHZlcnNpb24gY29sdW1uCiAgICAgKiBAcmV0dXJuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmVyc2lvbkNvbHVtbihDb2x1bW4gY29s\ndW1uLCBTdHJpbmcgdGFibGVBbGlhcykgewogICAgICAgIHJldHVybiBnZXRW\nZXJzaW9uQ29sdW1uKGNvbHVtbiwgREJJZGVudGlmaWVyLm5ld1RhYmxlKHRh\nYmxlQWxpYXMpKS50b1N0cmluZygpOwogICAgfQoKICAgIHB1YmxpYyBEQklk\nZW50aWZpZXIgZ2V0VmVyc2lvbkNvbHVtbihDb2x1bW4gY29sdW1uLCBEQklk\nZW50aWZpZXIgdGFibGVBbGlhcykgewogICAgICAgIHJldHVybiBjb2x1bW4u\nZ2V0SWRlbnRpZmllcigpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBp\nbnNlcnRCbG9iRm9yU3RyZWFtaW5nTG9hZChSb3cgcm93LCBDb2x1bW4gY29s\nLCAKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVjdCBvYiwgU2VsZWN0\nIHNlbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9iICE9\nIG51bGwpIHsKICAgICAgICAgICAgcm93LnNldEJpbmFyeVN0cmVhbShjb2ws\nIAogICAgICAgICAgICAgICAgbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFtKG5l\ndyBieXRlWzBdKSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncm93LnNldE51bGwoY29sKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIGluc2VydENsb2JGb3JTdHJlYW1pbmdMb2FkKFJvdyByb3cs\nIENvbHVtbiBjb2wsIE9iamVjdCBvYikKICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChvYiAhPSBudWxsKSB7CiAgICAgICAgcm93LnNl\ndENoYXJhY3RlclN0cmVhbShjb2wsCiAgICAgICAgICAgICAgICBuZXcgQ2hh\nckFycmF5UmVhZGVyKG5ldyBjaGFyWzBdKSwgMCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcm93LnNldE51bGwoY29sKTsKICAgICAgICB9CiAg\nICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZUJsb2IoU2VsZWN0IHNl\nbCwgSkRCQ1N0b3JlIHN0b3JlLCBJbnB1dFN0cmVhbSBpcykKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTUUxCdWZmZXIgc3FsID0g\nc2VsLnRvU2VsZWN0KHRydWUsIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlv\nbigpKTsKICAgICAgICBSZXN1bHRTZXQgcmVzID0gbnVsbDsKICAgICAgICBD\nb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAg\nICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHN0bW50ID0gc3FsLnByZXBhcmVTdGF0ZW1lbnQo\nY29ubiwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksCiAgICAgICAg\nICAgICAgICBSZXN1bHRTZXQuVFlQRV9TQ1JPTExfU0VOU0lUSVZFLAogICAg\nICAgICAgICAgICAgUmVzdWx0U2V0LkNPTkNVUl9VUERBVEFCTEUpOwogICAg\nICAgICAgICBzZXRUaW1lb3V0cyhzdG1udCwgc3RvcmUuZ2V0RmV0Y2hDb25m\naWd1cmF0aW9uKCksIHRydWUpOwogICAgICAgICAgICByZXMgPSBzdG1udC5l\neGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAgaWYgKCFyZXMubmV4dCgpKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24o\nX2xvYy5nZXQoInN0cmVhbS1leGNlcHRpb24iKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgQmxvYiBibG9iID0gcmVzLmdldEJsb2IoMSk7CiAgICAg\nICAgICAgIE91dHB1dFN0cmVhbSBvcyA9IGJsb2Iuc2V0QmluYXJ5U3RyZWFt\nKDEpOwogICAgICAgICAgICBjb3B5KGlzLCBvcyk7CiAgICAgICAgICAgIG9z\nLmNsb3NlKCk7CiAgICAgICAgICAgIHJlcy51cGRhdGVCbG9iKDEsIGJsb2Ip\nOwogICAgICAgICAgICByZXMudXBkYXRlUm93KCk7CgogICAgICAgIH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24oaW9lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBpZiAocmVzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\neyByZXMuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7fQog\nICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7IHN0bW50LmNsb3NlICgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nZSkge30KICAgICAgICAgICAgaWYgKGNvbm4gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRyeSB7IGNvbm4uY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBlKSB7fQogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgdXBkYXRlQ2xvYihTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIFJl\nYWRlciByZWFkZXIpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU1FMQnVmZmVyIHNxbCA9IHNlbC50b1NlbGVjdCh0cnVlLCBzdG9y\nZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAgUmVzdWx0U2V0\nIHJlcyA9IG51bGw7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gc3RvcmUu\nZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdG1udCA9\nIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIHN0b3JlLmdldEZldGNoQ29u\nZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgUmVzdWx0U2V0LlRZUEVf\nU0NST0xMX1NFTlNJVElWRSwKICAgICAgICAgICAgICAgIFJlc3VsdFNldC5D\nT05DVVJfVVBEQVRBQkxFKTsKICAgICAgICAgICAgc2V0VGltZW91dHMoc3Rt\nbnQsIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpLCB0cnVlKTsKICAg\nICAgICAgICAgcmVzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAg\nICAgIGlmICghcmVzLm5leHQoKSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJzdHJlYW0tZXhjZXB0\naW9uIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIENsb2IgY2xvYiA9\nIHJlcy5nZXRDbG9iKDEpOwogICAgICAgICAgICBpZiAoY2xvYiAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBXcml0ZXIgd3JpdGVyID0gY2xvYi5zZXRD\naGFyYWN0ZXJTdHJlYW0oMSk7CiAgICAgICAgICAgICAgICBjb3B5KHJlYWRl\nciwgd3JpdGVyKTsKICAgICAgICAgICAgICAgIHdyaXRlci5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgcmVzLnVwZGF0ZUNsb2IoMSwgY2xvYik7CiAgICAg\nICAgICAgICAgICByZXMudXBkYXRlUm93KCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkgCiAgICAgICAg\nICAgICAgICB0cnkgeyByZXMuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkgCiAg\nICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSAoKTsgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChjb25uICE9IG51\nbGwpIAogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9zZSAoKTsgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfSAgICAKICAgIH0K\nICAgIAogICAgcHJvdGVjdGVkIGxvbmcgY29weShJbnB1dFN0cmVhbSBpbiwg\nT3V0cHV0U3RyZWFtIG91dCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBieXRlW10gY29weUJ1ZmZlciA9IG5ldyBieXRlW2Jsb2JCdWZmZXJTaXpl\nXTsKICAgICAgICBsb25nIGJ5dGVzQ29waWVkID0gMDsKICAgICAgICBpbnQg\ncmVhZCA9IC0xOwoKICAgICAgICB3aGlsZSAoKHJlYWQgPSBpbi5yZWFkKGNv\ncHlCdWZmZXIsIDAsIGNvcHlCdWZmZXIubGVuZ3RoKSkgIT0gLTEpIHsKICAg\nICAgICAgICAgb3V0LndyaXRlKGNvcHlCdWZmZXIsIDAsIHJlYWQpOwogICAg\nICAgICAgICBieXRlc0NvcGllZCArPSByZWFkOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gYnl0ZXNDb3BpZWQ7CiAgICB9CiAgICAKICAgIHByb3RlY3Rl\nZCBsb25nIGNvcHkoUmVhZGVyIHJlYWRlciwgV3JpdGVyIHdyaXRlcikgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGFyW10gY29weUJ1ZmZlciA9\nIG5ldyBjaGFyW2Nsb2JCdWZmZXJTaXplXTsKICAgICAgICBsb25nIGJ5dGVz\nQ29waWVkID0gMDsKICAgICAgICBpbnQgcmVhZCA9IC0xOwoKICAgICAgICB3\naGlsZSAoKHJlYWQgPSByZWFkZXIucmVhZChjb3B5QnVmZmVyLCAwLCBjb3B5\nQnVmZmVyLmxlbmd0aCkpICE9IC0xKSB7CiAgICAgICAgICAgIHdyaXRlci53\ncml0ZShjb3B5QnVmZmVyLCAwLCByZWFkKTsKICAgICAgICAgICAgYnl0ZXND\nb3BpZWQgKz0gcmVhZDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBieXRl\nc0NvcGllZDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBdHRhY2ggQ0FT\nVCB0byB0aGUgY3VycmVudCBmdW5jdGlvbiBpZiBuZWNlc3NhcnkKICAgICAq\nIAogICAgICogQHBhcmFtIHZhbCBvcGVyYW5kIHZhbHVlCiAgICAgKiBAcGFy\nbWEgZnVuYyB0aGUgc3FsIGZ1bmN0aW9uIHN0YXRlbWVudAogICAgICogQHJl\ndHVybiBhIFN0cmluZyB3aXRoIHRoZSBjb3JyZWN0IENBU1QgZnVuY3Rpb24g\nc3ludGF4CiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2FzdEZ1bmN0\naW9uKFZhbCB2YWwsIFN0cmluZyBmdW5jKSB7CiAgICAgICAgcmV0dXJuIGZ1\nbmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvcnJlY3Qg\nQ0FTVCBmdW5jdGlvbiBzeW50YXguICBUaGlzIHNob3VsZCBiZSBvdmVycmlk\nZW4gYnkgc3ViY2xhc3NlcwogICAgICogdGhhdCBuZWVkIGFjY2VzcyB0byB0\naGUgQ29sdW1uIGluZm9ybWF0aW9uLgogICAgICogCiAgICAgKiBAcGFyYW0g\ndmFsIG9wZXJhbmQgb2YgY2FzdAogICAgICogQHBhcmFtIGZ1bmMgb3JpZ2lu\nYWwgc3RyaW5nCiAgICAgKiBAcGFyYW0gY29sIGRhdGFiYXNlIGNvbHVtbgog\nICAgICogQHJldHVybiBhIFN0cmluZyB3aXRoIHRoZSBjb3JyZWN0IENBU1Qg\nZnVuY3Rpb24gc3ludGF4CiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ2FzdEZ1bmN0aW9uKFZhbCB2YWwsIFN0cmluZyBmdW5jLCBDb2x1bW4gY29s\nKSB7CiAgICAgICAgcmV0dXJuIGdldENhc3RGdW5jdGlvbiAodmFsLCBmdW5j\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gaW5kZXgg\naWYgbmVjZXNzYXJ5IGZvciBzb21lIGRhdGFiYXNlIHRhYmxlcwogICAgICog\nQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZvaWQgY3JlYXRlSW5k\nZXhJZk5lY2Vzc2FyeShTY2hlbWEgc2NoZW1hLCBTdHJpbmcgdGFibGUsCiAg\nICAgICAgICAgIENvbHVtbiBwa0NvbHVtbikgewogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNyZWF0ZUluZGV4SWZOZWNlc3NhcnkoU2NoZW1hIHNjaGVtYSwg\nREJJZGVudGlmaWVyIHRhYmxlLAogICAgICAgIENvbHVtbiBwa0NvbHVtbikg\newogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYmF0Y2hM\naW1pdAogICAgICovCiAgICBwdWJsaWMgaW50IGdldEJhdGNoTGltaXQoKXsK\nICAgICAgICByZXR1cm4gYmF0Y2hMaW1pdDsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIGJhdGNoTGltaXQgdmFsdWUKICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0QmF0Y2hMaW1pdChpbnQgbGltaXQpewogICAgICAg\nIGJhdGNoTGltaXQgPSBsaW1pdDsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBWYWxpZGF0ZSB0aGUgYmF0Y2ggcHJvY2Vzcy4gSW4gc29tZSBjYXNlcywg\nd2UgY2FuJ3QgYmF0Y2ggdGhlIHN0YXRlbWVudHMKICAgICAqIGR1ZSB0byBz\nb21lIHJlc3RyaWN0aW9ucy4gRm9yIGV4YW1wbGUsIGlmIHRoZSBHZW5lcmF0\nZWRUeXBlPUlERU5USVRZLAogICAgICogd2UgaGF2ZSB0byBkaXNhYmxlIHRo\nZSBiYXRjaCBwcm9jZXNzIGJlY2F1c2Ugd2UgbmVlZCB0byBnZXQgdGhlIElE\nIHZhbHVlCiAgICAgKiByaWdodCBhd2F5IGZvciB0aGUgaW4tbWVtb3J5IGVu\ndGl0eSB0byB1c2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHZhbGlk\nYXRlQmF0Y2hQcm9jZXNzKFJvd0ltcGwgcm93LCBDb2x1bW5bXSBhdXRvQXNz\naWduLAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyICBzbSwgQ2xh\nc3NNYXBwaW5nIGNtZCApIHsKICAgICAgICBib29sZWFuIGRpc2FibGVCYXRj\naCA9IGZhbHNlOwogICAgICAgIGlmIChnZXRCYXRjaExpbWl0KCk9PSAwKSBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGF1dG9Bc3NpZ24gIT0gbnVsbCAm\nJiBzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWQgPSBjbWQuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgICAgICBp\nbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxlICghZGlzYWJsZUJhdGNoICYm\nIGkgPCBmbWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kW2ld\nLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuQVVUT0FT\nU0lHTikKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlQmF0Y2ggPSB0cnVl\nOwogICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIC8vIGdvIHRvIGVhY2ggRGljdGlvbmFyeSB0byB2YWxpZGF0\nZSB0aGUgYmF0Y2ggY2FwYWJpbGl0eQogICAgICAgIGlmICghZGlzYWJsZUJh\ndGNoKQogICAgICAgICAgICBkaXNhYmxlQmF0Y2ggPSB2YWxpZGF0ZURCU3Bl\nY2lmaWNCYXRjaFByb2Nlc3MoZGlzYWJsZUJhdGNoLCByb3csIAogICAgICAg\nICAgICAgICAgYXV0b0Fzc2lnbiwgc20sIGNtZCk7CiAgICAgICAgcmV0dXJu\nIGRpc2FibGVCYXRjaDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBbGxv\ndyBlYWNoIERpY3Rpb25hcnkgdG8gdmFsaWRhdGUgaXRzIG93biBiYXRjaCBw\ncm9jZXNzLiAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdmFsaWRhdGVE\nQlNwZWNpZmljQmF0Y2hQcm9jZXNzIChib29sZWFuIGRpc2FibGVCYXRjaCwg\nCiAgICAgICAgICAgIFJvd0ltcGwgcm93LCBDb2x1bW5bXSBhdXRvQXNzaWdu\nLCAKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciAgc20sIENsYXNz\nTWFwcGluZyBjbWQgKSB7CiAgICAgICAgcmV0dXJuIGRpc2FibGVCYXRjaDsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBw\ncm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAg\nICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcgcXVlcnkuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KENvbm5l\nY3Rpb24gY29ubiwgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsCiAgICAgICAg\nICAgIFN0cmluZyBzcWwgCiAgICAgICAgKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICB9\nCiAgICAgICAgICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0\nbyBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2Ug\nCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJl\ncGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4sIFN0cmluZyBzcWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGNv\nbm4ucHJlcGFyZVN0YXRlbWVudChzcWwpOwogICAgfSAgICAKIAogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZv\nciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbiBvZiBnZXR0aW5nIHNlcXVlbmNlIGZyb20gdGhlIHJlc3VsdCBzZXQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTZXF1ZW5jZVtdIGdldFNlcXVlbmNlKFJl\nc3VsdFNldCBycykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgTGlz\ndCBzZXFMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgIHdoaWxlIChy\ncyAhPSBudWxsICYmIHJzLm5leHQoKSkKICAgICAgICAgICAgc2VxTGlzdC5h\nZGQobmV3U2VxdWVuY2UocnMpKTsKICAgICAgICByZXR1cm4gKFNlcXVlbmNl\nW10pIHNlcUxpc3QudG9BcnJheShuZXcgU2VxdWVuY2Vbc2VxTGlzdC5zaXpl\nKCldKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBp\ncyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxp\na2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBnZXR0aW5nIGtleSBmcm9t\nIHRoZSByZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0\nIGdldEtleSAoUmVzdWx0U2V0IHJzLCBDb2x1bW4gY29sKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXJzLm5leHQoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1nZW5r\nZXkiKSk7CiAgICAgICAgT2JqZWN0IGtleSA9IHJzLmdldE9iamVjdCgxKTsK\nICAgICAgICBpZiAoa2V5ID09IG51bGwpCiAgICAgICAgICAgIGxvZy53YXJu\nKF9sb2MuZ2V0KCJpbnZhbGlkLWdlbmtleSIsIGNvbCkpOwogICAgICAgIHJl\ndHVybiBrZXk7ICAgICAgICAKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBU\naGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRC\nQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBjYWxj\ndWxhdGluZyB2YWx1ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2Fs\nY3VsYXRlVmFsdWUoVmFsIHZhbCwgU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBj\ndHgsIAogICAgICAgIEV4cFN0YXRlIHN0YXRlLCBQYXRoIHBhdGgsIEV4cFN0\nYXRlIHBhdGhTdGF0ZSkgewogICAgICAgIHZhbC5jYWxjdWxhdGVWYWx1ZShz\nZWwsIGN0eCwgc3RhdGUsIChWYWwpIHBhdGgsIHBhdGhTdGF0ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciB0aGUgcHJvdmlk\nZWQgPGNvZGU+c3FsPC9jb2RlPiBtYXkgYmUgdHJlYXRlZCBhcyBhIAogICAg\nICogc2VsZWN0IHN0YXRlbWVudCBvbiB0aGlzIGRhdGFiYXNlLgogICAgICog\nIAogICAgICogQHBhcmFtIHNxbCAgIEEgc3FsIHN0YXRlbWVudC4gCiAgICAg\nKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiA8Y29kZT5zcWw8L2NvZGU+IHJl\ncHJlc2VudHMgYSBzZWxlY3Qgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBpc1NlbGVjdChTdHJpbmcgc3FsKSB7CiAgICAgICAgSXRl\ncmF0b3IgaSA9IHNlbGVjdFdvcmRTZXQuaXRlcmF0b3IoKTsKICAgICAgICBT\ndHJpbmcgY3VyOwogICAgICAgIHdoaWxlIChpLmhhc05leHQoKSkgewogICAg\nICAgICAgICBjdXIgPSAoU3RyaW5nKSBpLm5leHQoKTsKICAgICAgICAgICAg\naWYgKHNxbC5sZW5ndGgoKSA+PSBjdXIubGVuZ3RoKCkKICAgICAgICAgICAg\nICAgICAgICAmJiBzcWwuc3Vic3RyaW5nKDAsIGN1ci5sZW5ndGgoKSkuZXF1\nYWxzSWdub3JlQ2FzZShjdXIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbmVlZHNUb0NyZWF0\nZUluZGV4KEluZGV4IGlkeCwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBiYXRjaGVk\nIHN0YXRlbWVudHMgdXBkYXRlIHN1Y2Nlc3MgY291bnQKICAgICAqIEBwYXJh\nbSBwcyBBIFByZXBhcmVkU3RhdGVtZW50CiAgICAgKiBAcmV0dXJuIHJldHVy\nbiB1cGRhdGUgY291bnQKICAgICAqLwogICAgcHVibGljIGludCBnZXRCYXRj\naFVwZGF0ZUNvdW50KFByZXBhcmVkU3RhdGVtZW50IHBzKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAg\ncHVibGljIGJvb2xlYW4gZ2V0VHJpbVNjaGVtYU5hbWUoKSB7IAogICAgICAg\nIHJldHVybiB0cmltU2NoZW1hTmFtZTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgc2V0VHJpbVNjaGVtYU5hbWUoYm9vbGVhbiB0cmltU2NoZW1hTmFt\nZSkgeyAKICAgICAgICB0aGlzLnRyaW1TY2hlbWFOYW1lID0gdHJpbVNjaGVt\nYU5hbWU7IAogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBkZWxldGVTdHJl\nYW0oSkRCQ1N0b3JlIHN0b3JlLCBTZWxlY3Qgc2VsKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBEbyBub3RoaW5nCiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgZ2l2ZW4gbmFtZSBpcyBu\nbyBsb25nZXIgdGhhbiBnaXZlbiBtYXhpbXVtIGxlbmd0aC4KICAgICAqIElm\nIHRoZSBnaXZlbiBuYW1lIGlzIGluZGVlZCBsb25nZXIgdGhlbiByYWlzZXMg\nYW4gVXNlckV4Y2VwdGlvbiB3aXRoIHRoZSAKICAgICAqIGdpdmVuIG1lc3Nh\nZ2Uga2V5IG90aGVyd2lzZSByZXR1cm5zIHRoZSBzYW1lIG5hbWUuCiAgICAg\nKi8KICAgIGZpbmFsIFN0cmluZyBjaGVja05hbWVMZW5ndGgoU3RyaW5nIG5h\nbWUsIGludCBsZW5ndGgsIFN0cmluZyBtc2dLZXkpIHsKICAgICAgICBpZiAo\nbmFtZS5sZW5ndGgoKSA+IGxlbmd0aCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQobXNnS2V5LCBuYW1lLCBuYW1lLmxl\nbmd0aCgpLCAKICAgICAgICAgICAgICAgICAgICBsZW5ndGgpKTsKICAgICAg\nICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRE\nZWxpbWl0ZWRDYXNlKERhdGFiYXNlTWV0YURhdGEgbWV0YURhdGEpIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAobWV0YURhdGEuc3RvcmVzTWl4\nZWRDYXNlUXVvdGVkSWRlbnRpZmllcnMoKSkgewogICAgICAgICAgICAgICAg\nZGVsaW1pdGVkQ2FzZSA9IFNDSEVNQV9DQVNFX1BSRVNFUlZFOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKG1ldGFEYXRhLnN0b3Jlc1Vw\ncGVyQ2FzZVF1b3RlZElkZW50aWZpZXJzKCkpIHsKICAgICAgICAgICAgICAg\nIGRlbGltaXRlZENhc2UgPSBTQ0hFTUFfQ0FTRV9VUFBFUjsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBlbHNlIGlmIChtZXRhRGF0YS5zdG9yZXNMb3dl\nckNhc2VRdW90ZWRJZGVudGlmaWVycygpKSB7CiAgICAgICAgICAgICAgICBk\nZWxpbWl0ZWRDYXNlID0gU0NIRU1BX0NBU0VfTE9XRVI7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBnZXRMb2coKS53YXJuKCJjYW5ub3QtZGV0ZXJtaW5lLWlkZW50aWZp\nZXItY2FzZSIpOwogICAgICAgICAgICBpZiAoZ2V0TG9nKCkuaXNUcmFjZUVu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoZS50\nb1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBzdXBwb3J0c0RlbGlt\naXRlZElkcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTdXBwb3J0\nc0RlbGltaXRlZElkZW50aWZpZXJzKCkgewogICAgICAgIHJldHVybiBzdXBw\nb3J0c0RlbGltaXRlZElkZW50aWZpZXJzOwogICAgfQoKICAgIC8qKgogICAg\nICogQHBhcmFtIHN1cHBvcnRzRGVsaW1pdGVkSWRzIHRoZSBzdXBwb3J0c0Rl\nbGltaXRlZElkcyB0byBzZXQKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nU3VwcG9ydHNEZWxpbWl0ZWRJZGVudGlmaWVycyhEYXRhYmFzZU1ldGFEYXRh\nIG1ldGFEYXRhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3VwcG9y\ndHNEZWxpbWl0ZWRJZGVudGlmaWVycyA9IAogICAgICAgICAgICAgICAgbWV0\nYURhdGEuc3VwcG9ydHNNaXhlZENhc2VRdW90ZWRJZGVudGlmaWVycygpIHx8\nCiAgICAgICAgICAgICAgICBtZXRhRGF0YS5zdG9yZXNMb3dlckNhc2VRdW90\nZWRJZGVudGlmaWVycygpIHx8CiAgICAgICAgICAgICAgICBtZXRhRGF0YS5z\ndG9yZXNVcHBlckNhc2VRdW90ZWRJZGVudGlmaWVycygpOwogICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHN1cHBvcnRz\nRGVsaW1pdGVkSWRlbnRpZmllcnMgPSBmYWxzZTsKICAgICAgICAgICAgZ2V0\nTG9nKCkud2FybihfbG9jLmdldCgidW5rbm93bi1kZWxpbS1zdXBwb3J0Iiwg\nZSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4g\ndGhlIGRlbGltaXRJZHMKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0\nRGVsaW1pdElkZW50aWZpZXJzKCkgewogICAgICAgIHJldHVybiBkZWxpbWl0\nSWRlbnRpZmllcnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0gZGVs\naW1pdElkcyB0aGUgZGVsaW1pdElkcyB0byBzZXQKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RGVsaW1pdElkZW50aWZpZXJzKGJvb2xlYW4gZGVsaW1p\ndElkcykgewogICAgICAgIGRlbGltaXRJZGVudGlmaWVycyA9IGRlbGltaXRJ\nZHM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQHJldHVybiBzdXBwb3J0\nc1hNTENvbHVtbgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTdXBw\nb3J0c1hNTENvbHVtbigpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydHNYTUxD\nb2x1bW47CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0gYiBib29sZWFu\nIHJlcHJlc2VudGluZyBpZiBYTUwgY29sdW1ucyBhcmUgc3VwcG9ydGVkCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN1cHBvcnRzWE1MQ29sdW1uKGJv\nb2xlYW4gYikgewogICAgICAgIHN1cHBvcnRzWE1MQ29sdW1uID0gYjsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBAcmV0dXJuIHhtbFR5cGVFbmNvZGlu\nZwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFhNTFR5cGVFbmNvZGlu\nZygpIHsKICAgICAgICByZXR1cm4geG1sVHlwZUVuY29kaW5nOwogICAgfQoK\nICAgIC8qKgogICAgICogQHBhcmFtIGVuY29kaW5nIGRhdGFiYXNlIHJlcXVp\ncmVkIEpBWEIgZW5jb2RpbmcgZm9yIHRoZSBYTUwgdmFsdWUKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0WE1MVHlwZUVuY29kaW5nKFN0cmluZyBlbmNv\nZGluZykgewogICAgICAgIHhtbFR5cGVFbmNvZGluZyA9IGVuY29kaW5nOwog\nICAgfQoKICAgIHB1YmxpYyBMb2cgZ2V0TG9nKCkgeyAKICAgICAgICByZXR1\ncm4gbG9nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGRlbGltaXRBbGwo\nKSB7CiAgICAgICAgcmV0dXJuIGRlbGltaXRJZGVudGlmaWVyczsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGdldExlYWRpbmdEZWxpbWl0ZXIoKSB7CiAg\nICAgICAgcmV0dXJuIGxlYWRpbmdEZWxpbWl0ZXI7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0TGVhZGluZ0RlbGltaXRlcihTdHJpbmcgZGVsaW0pIHsK\nICAgICAgICBsZWFkaW5nRGVsaW1pdGVyID0gZGVsaW07CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyBnZXRJZGVudGlmaWVyRGVsaW1pdGVyKCkgewogICAg\nICAgIHJldHVybiBjYXRhbG9nU2VwYXJhdG9yOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0SWRlbnRpZmllckNvbmNhdGVuYXRvcigpIHsKICAgICAg\nICByZXR1cm4gbmFtZUNvbmNhdGVuYXRvcjsKICAgIH0KICAgIAogICAgcHVi\nbGljIFN0cmluZyBnZXRUcmFpbGluZ0RlbGltaXRlcigpIHsKICAgICAgICBy\nZXR1cm4gdHJhaWxpbmdEZWxpbWl0ZXI7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0VHJhaWxpbmdEZWxpbWl0ZXIoU3RyaW5nIGRlbGltKSB7CiAgICAg\nICAgdHJhaWxpbmdEZWxpbWl0ZXIgPSBkZWxpbTsKICAgIH0KCiAgICBwdWJs\naWMgSWRlbnRpZmllclJ1bGUgZ2V0RGVmYXVsdElkZW50aWZpZXJSdWxlKCkg\newogICAgICAgIGlmIChkZWZhdWx0TmFtaW5nUnVsZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIGRlZmF1bHROYW1pbmdSdWxlID0gbmFtaW5nUnVsZXMuZ2V0\nKERCSWRlbnRpZmllclR5cGUuREVGQVVMVC5uYW1lKCkpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZGVmYXVsdE5hbWluZ1J1bGU7CiAgICB9CgogICAg\ncHVibGljIDxUPiBJZGVudGlmaWVyUnVsZSBnZXRJZGVudGlmaWVyUnVsZShU\nIHQpIHsKICAgICAgICBpZiAodC5lcXVhbHMoREJJZGVudGlmaWVyVHlwZS5E\nRUZBVUxULm5hbWUoKSkpIHsKICAgICAgICAgICAgcmV0dXJuIGdldERlZmF1\nbHRJZGVudGlmaWVyUnVsZSgpOwogICAgICAgIH0KICAgICAgICBJZGVudGlm\naWVyUnVsZSBucnVsZSA9IG5hbWluZ1J1bGVzLmdldCh0KTsKICAgICAgICBp\nZiAobnJ1bGUgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gZ2V0RGVm\nYXVsdElkZW50aWZpZXJSdWxlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBucnVsZTsKICAgIH0KCiAgICBAU3VwcHJlc3NXYXJuaW5ncygidW5jaGVj\na2VkIikKICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBJZGVudGlmaWVyUnVsZT4g\nZ2V0SWRlbnRpZmllclJ1bGVzKCkgewogICAgICAgIHJldHVybiBuYW1pbmdS\ndWxlczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIG5hbWlu\nZyB1dGlsaXR5IHVzZWQgYnkgdGhpcyBkaWN0aW9uYXJ5IGluc3RhbmNlCiAg\nICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHB1YmxpYyBEQklkZW50aWZpZXJV\ndGlsIGdldE5hbWluZ1V0aWwoKSB7CiAgICAgICAgcmV0dXJuIG5hbWluZ1V0\naWw7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0RGVsaW1pdGVk\nQ2FzZSgpIHsKICAgICAgICByZXR1cm4gZGVsaW1pdGVkQ2FzZTsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIHRvREJOYW1lKERCSWRlbnRpZmllciBuYW1l\nKSB7CiAgICAgICAgcmV0dXJuIGdldE5hbWluZ1V0aWwoKS50b0RCTmFtZShu\nYW1lKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvREJOYW1lKERCSWRl\nbnRpZmllciBuYW1lLCBib29sZWFuIGRlbGltaXQpIHsKICAgICAgICByZXR1\ncm4gZ2V0TmFtaW5nVXRpbCgpLnRvREJOYW1lKG5hbWUsIGRlbGltaXQpOwog\nICAgfQoKICAgIHB1YmxpYyBEQklkZW50aWZpZXIgZnJvbURCTmFtZShTdHJp\nbmcgbmFtZSwgREJJZGVudGlmaWVyVHlwZSBpZCkgewogICAgICAgIHJldHVy\nbiBnZXROYW1pbmdVdGlsKCkuZnJvbURCTmFtZShuYW1lLCBpZCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRTY2hlbWFOYW1lKFN0\ncmluZyBkZWZhdWx0U2NoZW1hTmFtZSkgewogICAgICAgIHRoaXMuZGVmYXVs\ndFNjaGVtYU5hbWUgPSBkZWZhdWx0U2NoZW1hTmFtZTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nIGdldERlZmF1bHRTY2hlbWFOYW1lKCkgewogICAgICAg\nIHJldHVybiBkZWZhdWx0U2NoZW1hTmFtZTsKICAgIH0KICAgIAogICAgcHVi\nbGljIFN0cmluZyBnZXRDb252ZXJzaW9uS2V5KCkgewogICAgICAgIGlmIChj\nb252ZXJzaW9uS2V5ID09IG51bGwpIHsKICAgICAgICAgICAgY29udmVyc2lv\nbktleSA9IGdldExlYWRpbmdEZWxpbWl0ZXIoKSArIGdldElkZW50aWZpZXJE\nZWxpbWl0ZXIoKSArCiAgICAgICAgICAgIGdldFRyYWlsaW5nRGVsaW1pdGVy\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb252ZXJzaW9uS2V5Owog\nICAgfQp9Cg==\n","encoding":"base64"}

