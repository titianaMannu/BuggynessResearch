{"sha":"6af2487050e11bda646485fcda65e31dbf98246f","node_id":"MDQ6QmxvYjIwNjM2NDo2YWYyNDg3MDUwZTExYmRhNjQ2NDg1ZmNkYTY1ZTMxZGJmOTgyNDZm","size":186563,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6af2487050e11bda646485fcda65e31dbf98246f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0lu\ndGVnZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7\nCmltcG9ydCBqYXZhLnNlY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3Ry\naW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5j\nb25mLk9wZW5KUEFDb25maWd1cmF0aW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubWV0YS5DbGFzc0FyZ1BhcnNlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5GaWxlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5TZXJ2aWNlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXIu\nTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vz\nc0NvZGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZh\nbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRh\ndGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRvdWJsZUlk\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdHJp\nbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2Vy\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1w\nbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFzczsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmllbGRJbnN0cnVj\ndGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlvbjsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTG9h\nZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Mb29rdXBTd2l0\nY2hJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTWV0aG9kSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLlRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb247CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLkNsYXNzSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJw\nLnV0aWwuU3RyaW5nczsKCi8qKgogKiBCeXRlY29kZSBlbmhhbmNlciB1c2Vk\nIHRvIGVuaGFuY2UgcGVyc2lzdGVudCBjbGFzc2VzIGZyb20gbWV0YWRhdGEu\nIFRoZQogKiBlbmhhbmNlciBtdXN0IGJlIGludm9rZWQgb24gYWxsIHBlcnNp\nc3RlbmNlLWNhcGFibGUgYW5kIHBlcnNpc3RlbmNlIGF3YXJlCiAqIGNsYXNz\nZXMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3Mg\nUENFbmhhbmNlciB7CiAgICAvLyBEZXNpZ25hdGVzIGEgdmVyc2lvbiBmb3Ig\nbWFpbnRhaW5pbmcgY29tcGF0YmlsaXR5IHdoZW4gUENFbmhhbmNlcgogICAg\nLy8gbW9kaWZpZXMgZW5oYW5jZW1lbnQgdGhhdCBjYW4gYnJlYWsgc2VyaWFs\naXphdGlvbiBvciBvdGhlciBjb250cmFjdHMKICAgIC8vIEVhY2ggZW5oYW5j\nZWQgY2xhc3Mgd2lsbCByZXR1cm4gdGhlIHZhbHVlIG9mIHRoaXMgZmllbGQg\ndmlhCiAgICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RW\nZXJzaW9uKCkKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VS\nX1ZFUlNJT04gPSAyOwogICAgCiAgICBib29sZWFuIF9hZGRWZXJzaW9uSW5p\ndEZsYWcgPSB0cnVlOyAKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBF\nTkhBTkNFX05PTkUgPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nRU5IQU5DRV9BV0FSRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IEVOSEFOQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgSVNERVRBQ0hFRFNUQVRFREVGSU5J\nVElWRSA9IFBSRSAKICAgICAgICArICJpc0RldGFjaGVkU3RhdGVEZWZpbml0\naXZlIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBQQ1RZUEUg\nPSBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU00gPSBQUkUgKyAiU3RhdGVNYW5hZ2VyIjsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFNNVFlQRSA9IFN0YXRlTWFu\nYWdlci5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBJ\nTkhFUklUID0gUFJFICsgIkluaGVyaXRlZEZpZWxkQ291bnQiOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlRFWFROQU1FID0gIkdlbmVy\naWNDb250ZXh0IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFVT\nRVJFWENFUCA9IFVzZXJFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBDbGFzcyBJTlRFUk5FWENFUCA9IEludGVybmFsRXhjZXB0\naW9uLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSEVM\nUEVSVFlQRSA9IFBDUmVnaXN0cnkuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU1VQRVIgPSBQUkUgKyAiUENTdXBlcmNsYXNzIjsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIE9JREZTVFlQRSA9IEZp\nZWxkU3VwcGxpZXIuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\nbGFzcyBPSURGQ1RZUEUgPSBGaWVsZENvbnN1bWVyLmNsYXNzOwogICAgCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgVkVSU0lPTl9JTklUX1NU\nUiA9ICBQUkUgKyAiVmVyc2lvbkluaXQiOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoUENFbmhhbmNlci5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUkVERUZJTkVEX0FUVFJJQlVURQogICAgICAgID0g\nUENFbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI3JlZGVmaW5lZC10eXBl\nIjsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQXV4aWxpYXJ5RW5o\nYW5jZXJbXSBfYXV4RW5oYW5jZXJzOwogICAgc3RhdGljIHsKICAgICAgICBD\nbGFzc1tdIGNsYXNzZXMgPSBTZXJ2aWNlcy5nZXRJbXBsZW1lbnRvckNsYXNz\nZXMoCiAgICAgICAgICAgIEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzLAogICAg\nICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9u\nKEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzKSkpOwogICAgICAgIExpc3QgYXV4\nRW5oYW5jZXJzID0gbmV3IEFycmF5TGlzdChjbGFzc2VzLmxlbmd0aCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhdXhFbmhh\nbmNlcnMuYWRkKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0\naW9uKGNsYXNzZXNbaV0pKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBhdXggZW5oYW5jZXIgbWF5\nIHJlbHkgb24gbm9uLWV4aXN0YW50IHNwZWMgY2xhc3NlcywgZXRjCiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX2F1eEVuaGFuY2VycyA9IChB\ndXhpbGlhcnlFbmhhbmNlcltdKSBhdXhFbmhhbmNlcnMudG9BcnJheQogICAg\nICAgIChuZXcgQXV4aWxpYXJ5RW5oYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUo\nKV0pOwogICAgfQoKICAgIHByaXZhdGUgQkNDbGFzcyBfcGM7CiAgICBwcml2\nYXRlIGZpbmFsIEJDQ2xhc3MgX21hbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBm\naW5hbCBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBm\naW5hbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBM\nb2cgX2xvZzsKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9yZWRlZmluZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9zdWJjbGFzcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9mYWlsID0gZmFsc2U7CiAgICBwcml2YXRlIFNldCBfdmlvbGF0aW9ucyA9\nIG51bGw7CiAgICBwcml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2\nYXRlIEJ5dGVjb2RlV3JpdGVyIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0\nZSBNYXAgX2JhY2tpbmdGaWVsZHMgPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8g\nZ2V0IG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0\ncnNUb0ZpZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZp\nZWxkIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfZmllbGRzVG9BdHRycyA9IG51\nbGw7IC8vIG1hcCBvZiBmaWVsZCBuYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBw\ncml2YXRlIGJvb2xlYW4gX2lzQWxyZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9pc0FscmVhZHlTdWJjbGFzc2VkID0gZmFs\nc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxz\nZTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLiBUaGlzIHdpbGwgbG9vawog\nICAgICogdXAgdGhlIG1ldGFkYXRhIGZvciA8Y29kZT50eXBlPC9jb2RlPiBm\ncm9tIDxjb2RlPmNvbmY8L2NvZGU+J3MKICAgICAqIHJlcG9zaXRvcnkuCiAg\nICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0\naW9uIGNvbmYsIENsYXNzIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYsIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAg\nICAgICAgICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKG5ldyBQcm9qZWN0\nKCksIHR5cGUpKSwKICAgICAgICAgICAgKE1ldGFEYXRhUmVwb3NpdG9yeSkg\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3Vw\ncGx5IGNvbmZpZ3VyYXRpb24gYW5kIHR5cGUgdG8gZW5oYW5jZS4gVGhpcyB3\naWxsIGxvb2sKICAgICAqIHVwIHRoZSBtZXRhZGF0YSBmb3IgPGNvZGU+bWV0\nYTwvY29kZT4gYnkgY29udmVydGluZyBiYWNrIHRvIGEgY2xhc3MKICAgICAq\nIGFuZCB0aGVuIGxvYWRpbmcgZnJvbSA8Y29kZT5jb25mPC9jb2RlPidzIHJl\ncG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5K\nUEFDb25maWd1cmF0aW9uIGNvbmYsIENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIHRoaXMoY29uZiwgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgLmxvYWRQcm9qZWN0Q2xh\nc3NBY3Rpb24obmV3IFByb2plY3QoKSwgbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpKSwKICAgICAgICAgICAgbWV0YS5nZXRSZXBvc2l0b3J5KCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1\ncmF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBieXRlY29k\nZSByZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICogZW5oYW5j\nZTsgdGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0gb3IgZmls\nZQogICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0\nbyB1c2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9yIG51bGwgdG8g\nY3JlYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0b3J5CiAgICAg\nKiBmcm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0IHVzZWQgYnkg\nZGVmYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJhdGlvbiBtaWdo\ndCBiZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgc3ViY2xh\nc3Mgd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBq\ndXN0IGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqIEBkZXByZWNhdGVkIHVz\nZSB7QGxpbmsgI1BDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24sIEJD\nQ2xhc3MsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5LCBDbGFzc0xvYWRl\ncil9IGluc3RlYWQuIAogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihP\ncGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAg\nICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgdGhpcyhj\nb25mLCB0eXBlLCByZXBvcywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAgKgog\nICAgICogQHBhcmFtIHR5cGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9u\nIGZvIHRoZSB0eXBlIHRvCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBj\ncmVhdGVkIGZyb20gYW55IHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFyYW0g\ncmVwb3MgYSBtZXRhZGF0YSByZXBvc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRh\ndGEgYWNjZXNzLAogICAgICogb3IgbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVw\nb3JpdG9yeTsgdGhlIHJlcG9zaXRvcnkKICAgICAqIGZyb20gdGhlIGdpdmVu\nIGNvbmZpZ3VyYXRpb24gaXNuJ3QgdXNlZCBieSBkZWZhdWx0CiAgICAgKiBi\nZWNhdXNlIHRoZSBjb25maWd1cmF0aW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBp\nbXBsZW1lbnRhdGlvbi1zcGVjaWZpYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0\nYQogICAgICogcmVxdWlyZWQgbW9yZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0\nYSBmaWxlcwogICAgICogQHBhcmFtIGxvYWRlciB0aGUgZW52aXJvbm1lbnQg\nY2xhc3Nsb2FkZXIgdG8gdXNlIGZvciBsb2FkaW5nCiAgICAgKiBjbGFzc2Vz\nIGFuZCByZXNvdXJjZXMuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2Vy\nKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIENsYXNzTG9hZGVyIGxv\nYWRlcikgewogICAgICAgIF9tYW5hZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAg\nX3BjID0gdHlwZTsKCiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5K\nUEFDb25maWd1cmF0aW9uLkxPR19FTkhBTkNFKTsKCiAgICAgICAgaWYgKHJl\ncG9zID09IG51bGwpIHsKICAgICAgICAgICAgX3JlcG9zID0gY29uZi5uZXdN\nZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICBfcmVw\nb3Muc2V0U291cmNlTW9kZShNZXRhRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRB\nKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgX3JlcG9zID0gcmVwb3M7\nCiAgICAgICAgX21ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEodHlwZS5nZXRU\neXBlKCksIGxvYWRlciwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29uc3RydWN0b3IuIFN1cHBseSByZXBvc2l0b3J5LiBUaGUgcmVwb3NpdG9y\neSdzIGNvbmZpZ3VyYXRpb24gd2lsbAogICAgICogYmUgdXNlZCwgYW5kIHRo\nZSBtZXRhZGF0YSBwYXNzZWQgaW4gd2lsbCBiZSB1c2VkIGFzLWlzIHdpdGhv\ndXQgZG9pbmcKICAgICAqIGFueSBhZGRpdGlvbmFsIGxvb2t1cHMuIFRoaXMg\naXMgdXNlZnVsIHdoZW4gcnVubmluZyB0aGUgZW5oYW5jZXIKICAgICAqIGR1\ncmluZyBtZXRhZGF0YSBsb2FkLgogICAgICoKICAgICAqIEBwYXJhbSByZXBv\ncyBhIG1ldGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0YSBh\nY2Nlc3MsCiAgICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0\nb3J5OyB0aGUgcmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4gY29u\nZmlndXJhdGlvbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1\nc2UgdGhlIGNvbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGltcGxl\nbWVudGF0aW9uLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRhCiAg\nICAgKiByZXF1aXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZp\nbGVzCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50\nYXRpb24gZm8gdGhlIHR5cGUgdG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2Fu\nIGJlIGNyZWF0ZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBw\nYXJhbSBtZXRhIHRoZSBtZXRhZGF0YSB0byB1c2UgZm9yIHByb2Nlc3Npbmcg\ndGhpcyB0eXBlLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICov\nCiAgICBwdWJsaWMgUENFbmhhbmNlcihNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nb3MsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEp\nIHsKICAgICAgICBfbWFuYWdlZFR5cGUgPSB0eXBlOwogICAgICAgIF9wYyA9\nIHR5cGU7CgogICAgICAgIF9sb2cgPSByZXBvcy5nZXRDb25maWd1cmF0aW9u\nKCkKICAgICAgICAgICAgLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5M\nT0dfRU5IQU5DRSk7CgogICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAg\nIF9tZXRhID0gbWV0YTsKICAgIH0KCiAgICBzdGF0aWMgU3RyaW5nIHRvUENT\ndWJjbGFzc05hbWUoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJuIFN0cmlu\nZ3MuZ2V0UGFja2FnZU5hbWUoUENFbmhhbmNlci5jbGFzcykgKyAiLiIKICAg\nICAgICAgICAgKyBjbHMuZ2V0TmFtZSgpLnJlcGxhY2UoJy4nLCAnJCcpICsg\nIiRwY3N1YmNsYXNzIjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\nb3Igbm90IDxjb2RlPmNsYXNzTmFtZTwvY29kZT4gaXMgdGhlIG5hbWUgZm9y\nIGEKICAgICAqIGR5bmFtaWNhbGx5LWNyZWF0ZWQgcGVyc2lzdGVuY2UtY2Fw\nYWJsZSBzdWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzUENTdWJjbGFzc05h\nbWUoU3RyaW5nIGNsYXNzTmFtZSkgewogICAgICAgIHJldHVybiBjbGFzc05h\nbWUuc3RhcnRzV2l0aChTdHJpbmdzLmdldFBhY2thZ2VOYW1lKFBDRW5oYW5j\nZXIuY2xhc3MpKQogICAgICAgICAgICAmJiBjbGFzc05hbWUuZW5kc1dpdGgo\nIiRwY3N1YmNsYXNzIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiA8Y29k\nZT5jbGFzc05hbWU8L2NvZGU+IGlzIGEgZHluYW1pY2FsbHktY3JlYXRlZCBw\nZXJzaXN0ZW5jZS1jYXBhYmxlCiAgICAgKiBzdWJjbGFzcyBuYW1lLCByZXR1\ncm5zIHRoZSBuYW1lIG9mIHRoZSBjbGFzcyB0aGF0IGl0IHN1YmNsYXNzZXMu\nCiAgICAgKiBPdGhlcndpc2UsIHJldHVybnMgPGNvZGU+Y2xhc3NOYW1lPC9j\nb2RlPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBTdHJpbmcgdG9NYW5hZ2VkVHlwZU5hbWUoU3RyaW5n\nIGNsYXNzTmFtZSkgewogICAgICAgIGlmIChpc1BDU3ViY2xhc3NOYW1lKGNs\nYXNzTmFtZSkpIHsKICAgICAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1l\nLnN1YnN0cmluZygKICAgICAgICAgICAgICAgIFN0cmluZ3MuZ2V0UGFja2Fn\nZU5hbWUoUENFbmhhbmNlci5jbGFzcykubGVuZ3RoKCkgKyAxKTsKICAgICAg\nICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnN1YnN0cmluZygwLCBjbGFz\nc05hbWUubGFzdEluZGV4T2YoIiQiKSk7CiAgICAgICAgICAgIC8vIHRoaXMg\naXMgbm90IGNvcnJlY3QgZm9yIG5lc3RlZCBQQ3MKICAgICAgICAgICAgY2xh\nc3NOYW1lID0gY2xhc3NOYW1lLnJlcGxhY2UoJyQnLCAnLicpOwogICAgICAg\nIH0KICAgICAgICAKICAgICAgICByZXR1cm4gY2xhc3NOYW1lOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0\naW9uLCB0eXBlLCBhbmQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBQ\nQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3Mg\ndHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICB0\naGlzKGNvbmYsIHR5cGUsIG1ldGEuZ2V0UmVwb3NpdG9yeSgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50\nYXRpb24gb2YgdGhlIHBlcnNpc3RlbmNlLWNhcGFibGUgY2xhc3MKICAgICAq\nIGJlaW5nIG1hbmlwdWxhdGVkLgogICAgICovCiAgICBwdWJsaWMgQkNDbGFz\ncyBnZXRQQ0J5dGVjb2RlKCkgewogICAgICAgIHJldHVybiBfcGM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ5dGVjb2RlIHJlcHJlc2Vu\ndGF0aW9uIG9mIHRoZSBtYW5hZ2VkIGNsYXNzIGJlaW5nCiAgICAgKiBtYW5p\ncHVsYXRlZC4gVGhpcyBpcyB1c3VhbGx5IHRoZSBzYW1lIGFzIHtAbGluayAj\nZ2V0UENCeXRlY29kZX0sCiAgICAgKiBleGNlcHQgd2hlbiBydW5uaW5nIHRo\nZSBlbmhhbmNlciB0byByZWRlZmluZSBhbmQgc3ViY2xhc3MKICAgICAqIGV4\naXN0aW5nIHBlcnNpc3RlbnQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyBC\nQ0NsYXNzIGdldE1hbmFnZWRUeXBlQnl0ZWNvZGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9tYW5hZ2VkVHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyBiZWluZyBtYW5pcHVsYXRl\nZCwgb3IgbnVsbCBpZiBub3QKICAgICAqIGEgcGVyc2lzdGVudCB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgp\nIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBlbmhhbmNlciBz\naG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0b3IgaWYgb25l\nIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNzLiBPcGVuSlBB\nCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0cnVjdG9yICh3\naGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAgKiBvciBieSB0\naGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRBZGREZWZhdWx0Q29uc3RydWN0b3IoKSB7CiAgICAg\nICAgcmV0dXJuIF9kZWZDb25zOwogICAgfQoKICAgIC8qKgogICAgICogQSBi\nb29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxk\nIGFkZCBhIG5vLWFyZ3MKICAgICAqIGNvbnN0cnVjdG9yIGlmIG9uZSBpcyBu\nb3QgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBjbGFzcy4gT3BlbkpQQQogICAg\nICogcmVxdWlyZXMgdGhhdCBhIG5vLWFyZyBjb25zdHJ1Y3RvciAod2hldGhl\nciBjcmVhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgICogb3IgYnkgdGhlIHVz\nZXIpIGJlIHByZXNlbnQgaW4gYSBQQy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGJvb2xlYW4gYWRkRGVmYXVs\ndENvbnN0cnVjdG9yKSB7CiAgICAgICAgX2RlZkNvbnMgPSBhZGREZWZhdWx0\nQ29uc3RydWN0b3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\nZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0cyBhcmd1bWVudHMsIG9yIGp1\nc3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFuZCBvcHRpb25hbCBzdWJjbGFz\nc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5IHVzZWQgaW4gY29uanVuY3Rp\nb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3JlYXRlU3ViY2xhc3ModHJ1ZSk8\nL2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBnZXRSZWRlZmluZSgpIHsKICAgICAgICByZXR1\ncm4gX3JlZGVmaW5lOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\naGUgZW5oYW5jZXIgc2hvdWxkIG11dGF0ZSBpdHMgYXJndW1lbnRzLCBvciBq\ndXN0IHJ1biB2YWxpZGF0aW9uCiAgICAgKiBhbmQgb3B0aW9uYWwgc3ViY2xh\nc3NpbmcgbG9naWMgb24gdGhlbS4gVXN1YWxseSB1c2VkIGluIGNvbmp1bmN0\naW9uIHdpdGgKICAgICAqIDxjb2RlPnNldENyZWF0ZVN1YmNsYXNzKHRydWUp\nPC9jb2RlPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0UmVkZWZpbmUoYm9vbGVhbiByZWRlZmluZSkg\newogICAgICAgIF9yZWRlZmluZSA9IHJlZGVmaW5lOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMgaW5zdGFuY2Ug\naXMgZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHJlZGVmaW5l\nZC4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gaXNBbHJlYWR5UmVkZWZpbmVkKCkgewogICAgICAgIHJl\ndHVybiBfaXNBbHJlYWR5UmVkZWZpbmVkOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMgaW5zdGFuY2UgaXMgZW5o\nYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHN1YmNsYXNzZWQgaW4g\ndGhpcyBpbnN0YW5jZSdzIGVudmlyb25tZW50IGNsYXNzbG9hZGVyLgogICAg\nICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0FscmVhZHlTdWJjbGFzc2VkKCkgewogICAgICAgIHJldHVybiBf\naXNBbHJlYWR5U3ViY2xhc3NlZDsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtYWtlIGl0cyBhcmd1bWVudHMg\ncGVyc2lzdGVuY2UtY2FwYWJsZSwKICAgICAqIG9yIGdlbmVyYXRlIGEgcGVy\nc2lzdGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2lu\nY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJjbGFzczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBt\nYWtlIGl0cyBhcmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJsZSwKICAgICAq\nIG9yIGdlbmVyYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4K\nICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Q3JlYXRlU3ViY2xhc3MoYm9vbGVhbiBzdWJjbGFzcykgewog\nICAgICAgIF9zdWJjbGFzcyA9IHN1YmNsYXNzOwogICAgICAgIF9hZGRWZXJz\naW9uSW5pdEZsYWcgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdG8gZmFpbCBpZiB0aGUgcGVyc2lzdGVudCB0eXBlIHVzZXMgcHJv\ncGVydHkgYWNjZXNzIGFuZAogICAgICogYnl0ZWNvZGUgYW5hbHlzaXMgc2hv\nd3MgdGhhdCBpdCBtYXkgYmUgdmlvbGF0aW5nIE9wZW5KUEEncyBwcm9wZXJ0\neQogICAgICogYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0RW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zKCkg\newogICAgICAgIHJldHVybiBfZmFpbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdG8gZmFpbCBpZiB0aGUgcGVyc2lzdGVudCB0eXBlIHVzZXMg\ncHJvcGVydHkgYWNjZXNzIGFuZAogICAgICogYnl0ZWNvZGUgYW5hbHlzaXMg\nc2hvd3MgdGhhdCBpdCBtYXkgYmUgdmlvbGF0aW5nIE9wZW5KUEEncyBwcm9w\nZXJ0eQogICAgICogYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zKGJv\nb2xlYW4gZmFpbCkgewogICAgICAgIF9mYWlsID0gZmFpbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBiYXNlIGJ1aWxkIGRpcmVjdG9yeSB0byBnZW5l\ncmF0ZSBjb2RlIHRvLiBUaGUgcHJvcGVyIHBhY2thZ2UKICAgICAqIHN0cnVj\ndHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4g\nRGVmYXVsdHMgdG8KICAgICAqIG92ZXJ3cml0aW5nIHRoZSBleGlzdGluZyBj\nbGFzcyBmaWxlIGlmIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBGaWxlIGdl\ndERpcmVjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2RpcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBiYXNlIGJ1aWxkIGRpcmVjdG9yeSB0byBnZW5l\ncmF0ZSBjb2RlIHRvLiBUaGUgcHJvcGVyIHBhY2thZ2UKICAgICAqIHN0cnVj\ndHVyZSB3aWxsIGJlIGNyZWFlZCBiZW5lYXRoIHRoaXMgZGlyZWN0b3J5LiBE\nZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRpbmcgdGhlIGV4aXN0aW5nIGNs\nYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nRGlyZWN0b3J5KEZpbGUgZGlyKSB7CiAgICAgICAgX2RpciA9IGRpcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY3VycmVudCB7QGxpbmsg\nQnl0ZWNvZGVXcml0ZXJ9IHRvIHdyaXRlIHRvIG9yIG51bGwgaWYgbm9uZS4K\nICAgICAqLwogICAgcHVibGljIEJ5dGVjb2RlV3JpdGVyIGdldEJ5dGVjb2Rl\nV3JpdGVyKCkgewogICAgICAgIHJldHVybiBfd3JpdGVyOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSB7QGxpbmsgQnl0ZWNvZGVXcml0ZXJ9IHRv\nIHdyaXRlIHRoZSBieXRlY29kZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVjb2RlV3JpdGVyKEJ5dGVjb2Rl\nV3JpdGVyIHdyaXRlcikgewogICAgICAgIF93cml0ZXIgPSB3cml0ZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGJ5dGVjb2RlIGVuaGFuY2Vt\nZW50cy4KICAgICAqCiAgICAgKiBAcmV0dXJuIDxjb2RlPkVOSEFOQ0VfKjwv\nY29kZT4gY29uc3RhbnQKICAgICAqLwogICAgcHVibGljIGludCBydW4oKSB7\nCiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IF9tYW5hZ2VkVHlwZS5nZXRUeXBl\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgbWFuYWdlZCBp\nbnRlcmZhY2UsIHNraXAKICAgICAgICAgICAgaWYgKF9wYy5pc0ludGVyZmFj\nZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfSU5URVJGQUNF\nOwoKICAgICAgICAgICAgLy8gY2hlY2sgaWYgYWxyZWFkeSBlbmhhbmNlZAog\nICAgICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRl\nckFjdGlvbih0eXBlKSk7CiAgICAgICAgICAgIGZvciAoQ2xhc3M8Pz4gaWZh\nY2UgOiBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRJbnRlcmZhY2VUeXBlcygp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaWZhY2UuZ2V0TmFtZSgpLmVxdWFs\ncyhQQ1RZUEUuZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGMtdHlwZSIsIHR5cGUsIGxv\nYWRlcikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gRU5IQU5DRV9OT05FOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nImVuaGFuY2Utc3RhcnQiLCB0eXBlLCBsb2FkZXIpKTsKICAgICAgICAgICAg\nfQoKCiAgICAgICAgICAgIGNvbmZpZ3VyZUJDcygpOwoKICAgICAgICAgICAg\nLy8gdmFsaWRhdGUgcHJvcGVydGllcyBiZWZvcmUgcmVwbGFjaW5nIGZpZWxk\nIGFjY2VzcyBzbyB0aGF0CiAgICAgICAgICAgIC8vIHdlIGJ1aWxkIHVwIGEg\ncmVjb3JkIG9mIGJhY2tpbmcgZmllbGRzLCBldGMKICAgICAgICAgICAgaWYg\nKGlzUHJvcGVydHlBY2Nlc3MoX21ldGEpKSB7CiAgICAgICAgICAgICAgICB2\nYWxpZGF0ZVByb3BlcnRpZXMoKTsKICAgICAgICAgICAgICAgIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZVRyYW5zbGF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKTsKICAgICAgICAgICAg\ncHJvY2Vzc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBlbmhhbmNlQ2xhc3MoKTsKICAg\nICAgICAgICAgICAgIGFkZEZpZWxkcygpOwogICAgICAgICAgICAgICAgYWRk\nU3RhdGljSW5pdGlhbGl6ZXIoKTsKICAgICAgICAgICAgICAgIGFkZFBDTWV0\naG9kcygpOwogICAgICAgICAgICAgICAgYWRkQWNjZXNzb3JzKCk7CiAgICAg\nICAgICAgICAgICBhZGRBdHRhY2hEZXRhY2hDb2RlKCk7CiAgICAgICAgICAg\nICAgICBhZGRTZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAgICAgICAg\nYWRkQ2xvbmluZ0NvZGUoKTsKICAgICAgICAgICAgICAgIHJ1bkF1eGlsaWFy\neUVuaGFuY2VycygpOwogICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0Vf\nUEM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgicGVycy1hd2FyZSIsIHR5cGUsIGxvYWRlcikpOwogICAgICAgICAgICBy\nZXR1cm4gRU5IQU5DRV9BV0FSRTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbmhhbmNlLWVycm9yIiwK\nICAgICAgICAgICAgICAgIHR5cGUuZ2V0TmFtZSgpLCBlLmdldE1lc3NhZ2Uo\nKSksIGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY29u\nZmlndXJlQkNzKCkgewogICAgICAgIGlmICghX2Jjc0NvbmZpZ3VyZWQpIHsK\nICAgICAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0QXR0cmlidXRlKFJFREVGSU5FRF9B\nVFRSSUJVVEUpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX21hbmFn\nZWRUeXBlLmFkZEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfaXNBbHJl\nYWR5UmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAg\nIFBDU3ViY2xhc3NWYWxpZGF0b3IgdmFsID0gbmV3IFBDU3ViY2xhc3NWYWxp\nZGF0b3IoCiAgICAgICAgICAgICAgICAgICAgX21ldGEsIF9tYW5hZ2VkVHlw\nZSwgX2xvZywgX2ZhaWwpOwogICAgICAgICAgICAgICAgdmFsLmFzc2VydENh\nblN1YmNsYXNzKCk7CgogICAgICAgICAgICAgICAgX3BjID0gX21hbmFnZWRU\neXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoCiAgICAgICAgICAgICAgICAg\nICAgdG9QQ1N1YmNsYXNzTmFtZShfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7\nCiAgICAgICAgICAgICAgICBpZiAoX3BjLmdldFN1cGVyY2xhc3NCQygpICE9\nIF9tYW5hZ2VkVHlwZSkgewogICAgICAgICAgICAgICAgICAgIF9wYy5zZXRT\ndXBlcmNsYXNzKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAg\nX3BjLnNldEFic3RyYWN0KF9tYW5hZ2VkVHlwZS5pc0Fic3RyYWN0KCkpOwog\nICAgICAgICAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKER5bmFt\naWNQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOwogICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5U3ViY2xh\nc3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIF9iY3NDb25maWd1cmVkID0gdHJ1ZTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2VuZXJhdGVkIGJ5\ndGVjb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9tYW5hZ2Vk\nVHlwZSAhPSBfcGMgJiYgZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgcmVj\nb3JkKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgcmVjb3JkKF9wYyk7CiAgICAg\nICAgaWYgKF9vaWRzICE9IG51bGwpCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX29pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAg\nICAgICAgICAgICAgICByZWNvcmQoKEJDQ2xhc3MpIGl0ci5uZXh0KCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIGdpdmVuIGNsYXNzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVjb3JkKEJDQ2xhc3MgYmMpCiAg\nICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3dyaXRl\nciAhPSBudWxsKQogICAgICAgICAgICBfd3JpdGVyLndyaXRlKGJjKTsKICAg\nICAgICBlbHNlIGlmIChfZGlyID09IG51bGwpCiAgICAgICAgICAgIGJjLndy\naXRlKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEZpbGUgZGlyID0g\nRmlsZXMuZ2V0UGFja2FnZUZpbGUoX2RpciwgYmMuZ2V0UGFja2FnZU5hbWUo\nKSwgdHJ1ZSk7CiAgICAgICAgICAgIGJjLndyaXRlKG5ldyBGaWxlKGRpciwg\nYmMuZ2V0Q2xhc3NOYW1lKCkgKyAiLmNsYXNzIikpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIG1ldGhvZHMg\ndGhhdCB1c2UgYSBwcm9wZXJ0eS1hY2Nlc3MgaW5zdGFuY2UgYXJlCiAgICAg\nKiB3cml0dGVuIGNvcnJlY3RseS4gVGhpcyBtZXRob2QgYWxzbyBnYXRoZXJz\nIGluZm9ybWF0aW9uIG9uIGVhY2gKICAgICAqIHByb3BlcnR5J3MgYmFja2lu\nZyBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlUHJv\ncGVydGllcygpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kczsKICAg\nICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgZm1kcyA9IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAg\nTWV0aG9kIG1ldGg7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVyLCBzZXR0ZXI7\nCiAgICAgICAgQkNGaWVsZCByZXR1cm5lZCwgYXNzaWduZWQgPSBudWxsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newoKICAgICAgICAgICAgaWYgKCEoZm1kc1tpXS5nZXRCYWNraW5nTWVtYmVy\nKCkgaW5zdGFuY2VvZiBNZXRob2QpICkgewogICAgICAgICAgICAgICAgLy8g\nSWYgbm90IG1peGVkIGFjY2VzcyBpcyBub3QgZGVmaW5lZCwgZmxhZyB0aGUg\nZmllbGQgbWVtYmVycywgCiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ug\nZG8gbm90IHByb2Nlc3MgdGhlbSBiZWNhdXNlIHRoZXkgYXJlIHZhbGlkCiAg\nICAgICAgICAgICAgICAvLyBwZXJzaXN0ZW50IGF0dHJpYnV0ZXMuCiAgICAg\nICAgICAgICAgICBpZiAoIV9tZXRhLmlzTWl4ZWRBY2Nlc3MoKSkgewogICAg\nICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktYmFkLW1l\nbWJlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsg\nZm1kc1tpXSwgZm1kc1tpXS5nZXRCYWNraW5nTWVtYmVyKCkgfSwKICAgICAg\nICAgICAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAKICAgICAgICAgICAgbWV0aCA9IChNZXRob2QpIGZtZHNbaV0uZ2V0\nQmFja2luZ01lbWJlcigpOwogICAgICAgICAgICAvLyAjIyMjIyB0aGlzIHdp\nbGwgZmFpbCBpZiB3ZSBvdmVycmlkZSBhbmQgZG9uJ3QgY2FsbCBzdXBlci4K\nICAgICAgICAgICAgQkNDbGFzcyBkZWNsYXJpbmdUeXBlID0gX21hbmFnZWRU\neXBlLmdldFByb2plY3QoKQogICAgICAgICAgICAgICAgLmxvYWRDbGFzcyhm\nbWRzW2ldLmdldERlY2xhcmluZ1R5cGUoKSk7CiAgICAgICAgICAgIGdldHRl\nciA9IGRlY2xhcmluZ1R5cGUuZ2V0RGVjbGFyZWRNZXRob2QobWV0aC5nZXRO\nYW1lKCksCiAgICAgICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVz\nKCkpOwogICAgICAgICAgICBpZiAoZ2V0dGVyID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktbm8tZ2V0dGVyIiwg\nbmV3IE9iamVjdFtdeyBmbWRzW2ldIH0sCiAgICAgICAgICAgICAgICAgICAg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm5lZCA9IGdldFJldHVybmVkRmllbGQoZ2V0\ndGVyKTsKICAgICAgICAgICAgaWYgKHJldHVybmVkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oZm1kc1tpXSwg\nZ2V0dGVyLCByZXR1cm5lZCk7CgogICAgICAgICAgICBzZXR0ZXIgPSBkZWNs\nYXJpbmdUeXBlLmdldERlY2xhcmVkTWV0aG9kKGdldFNldHRlck5hbWUoZm1k\nc1tpXSksCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAgaWYgKHNldHRlciA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmV0dXJuZWQgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVy\ndHktbm8tc2V0dGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBmbWRzW2ldIH0sIHRydWUpOwogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0UmVk\nZWZpbmUoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBzeW50\naGV0aWMgc2V0dGVyCiAgICAgICAgICAgICAgICAgICAgc2V0dGVyID0gX21h\nbmFnZWRUeXBlLmRlY2xhcmVNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWRzW2ld\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAg\nICAgICAgICAgICAgc2V0dGVyLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAg\nICAgICAgICAgQ29kZSBjb2RlID0gc2V0dGVyLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKHJl\ndHVybmVkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgaWYgKHNldHRlciAhPSBudWxsKQogICAgICAgICAgICAgICAgYXNzaWdu\nZWQgPSBnZXRBc3NpZ25lZEZpZWxkKHNldHRlcik7CgogICAgICAgICAgICBp\nZiAoYXNzaWduZWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNl\ndHRlciAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyQmFj\na2luZ0ZpZWxkSW5mbyhmbWRzW2ldLCBzZXR0ZXIsIGFzc2lnbmVkKTsKCiAg\nICAgICAgICAgICAgICBpZiAoYXNzaWduZWQgIT0gcmV0dXJuZWQpCiAgICAg\nICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1zZXR0ZXIt\nZ2V0dGVyLW1pc21hdGNoIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAgICAg\nICAgICAgICAgIHsgZm1kc1tpXSwgYXNzaWduZWQuZ2V0TmFtZSgpLCAocmV0\ndXJuZWQgPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAgICAgID8gbnVs\nbCA6IHJldHVybmVkLmdldE5hbWUoKSB9LCBmYWxzZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlZ2lzdGVy\nQmFja2luZ0ZpZWxkSW5mbyhGaWVsZE1ldGFEYXRhIGZtZCwgQkNNZXRob2Qg\nbWV0aG9kLAogICAgICAgIEJDRmllbGQgZmllbGQpIHsKICAgICAgICBpZiAo\nX2JhY2tpbmdGaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgX2JhY2tpbmdG\naWVsZHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9iYWNraW5nRmllbGRz\nLnB1dChtZXRob2QuZ2V0TmFtZSgpLCBmaWVsZC5nZXROYW1lKCkpOwoKICAg\nICAgICBpZiAoX2F0dHJzVG9GaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAg\nX2F0dHJzVG9GaWVsZHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9hdHRy\nc1RvRmllbGRzLnB1dChmbWQuZ2V0TmFtZSgpLCBmaWVsZC5nZXROYW1lKCkp\nOwoKICAgICAgICBpZiAoX2ZpZWxkc1RvQXR0cnMgPT0gbnVsbCkKICAgICAg\nICAgICAgX2ZpZWxkc1RvQXR0cnMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nIF9maWVsZHNUb0F0dHJzLnB1dChmaWVsZC5nZXROYW1lKCksIGZtZC5nZXRO\nYW1lKCkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRBdHRyaWJ1dGVU\ncmFuc2xhdGlvbigpIHsKCiAgICAgICAgLy8gR2V0IGFsbCBmaWVsZCBtZXRh\nZGF0YQogICAgICAgIEFycmF5TGlzdDxJbnRlZ2VyPiBwcm9wRm1kcyA9IG5l\ndyBBcnJheUxpc3Q8SW50ZWdlcj4oKTsKICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwoKICAgICAgICBpZiAoX21l\ndGEuaXNNaXhlZEFjY2VzcygpKSB7CiAgICAgICAgICAgIC8vIFN0b3JlcyBp\nbmRleGVzIG9mIHByb3BlcnR5IGFjY2VzcyBmaWVsZHMgdG8gYmUgdXNlZCBp\nbgogICAgICAgICAgICAvLyAKICAgICAgICAgICAgcHJvcEZtZHMgPSBuZXcg\nQXJyYXlMaXN0PEludGVnZXI+KCk7CiAgICAgICAgICAgIAogICAgICAgICAg\nICAvLyBEZXRlcm1pbmUgd2hpY2ggZmllbGRzIGhhdmUgcHJvcGVydHkgYWNj\nZXNzIGFuZCBzYXZlIHRoZWlyIAogICAgICAgICAgICAvLyBpbmRleGVzCiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKGlzUHJvcGVydHlBY2Nlc3MoZm1k\nc1tpXSkpCiAgICAgICAgICAgICAgICAgICAgcHJvcEZtZHMuYWRkKGkpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBubyBmaWVsZHMgaGF2\nZSBwcm9wZXJ0eSBhY2Nlc3MgZG8gbm90IGRvIGF0dHJpYnV0ZSB0cmFuc2xh\ndGlvbgogICAgICAgICAgICBpZiAocHJvcEZtZHMuc2l6ZSgpID09IDApCiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfcGMu\nZGVjbGFyZUludGVyZmFjZShBdHRyaWJ1dGVUcmFuc2xhdG9yLmNsYXNzKTsK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiQXR0cmlidXRlSW5kZXhUb0ZpZWxkTmFtZSIsCiAgICAgICAgICAg\nIFN0cmluZy5jbGFzcywgbmV3IENsYXNzW10geyBpbnQuY2xhc3MgfSk7CiAg\nICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3dpdGNoICh2\nYWwpCiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nIGlmICghX21ldGEuaXNNaXhlZEFjY2VzcygpKSB7CiAgICAgICAgICAgIC8v\nIGlmIG5vdCBtaXhlZCBhY2Nlc3MgdXNlIGEgdGFibGUgc3dpdGNoIG9uIGFs\nbCBwcm9wZXJ0eS1iYXNlZCBmbWQuCiAgICAgICAgICAgIC8vIGEgdGFibGUg\nc3dpdGNoIGlzIG1vcmUgZWZmaWNpZW50IHdpdGggKzEgaW5jcmVtZW50YWwg\nb3BlcmF0aW9ucwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9u\nIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgCiAg\nICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlu\ncy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAvLyBj\nYXNlIGk6CiAgICAgICAgICAgIC8vICAgICByZXR1cm4gPF9hdHRyc1RvRmll\nbGRzLmdldChmbWRzW2ldLmdldE5hbWUoKSk+CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgdGFiaW5zLmFkZFRhcmdldChjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoCiAgICAgICAgICAgICAgICAgICAgX2F0dHJzVG9GaWVsZHMuZ2V0KGZt\nZHNbaV0uZ2V0TmFtZSgpKSkpOwogICAgICAgICAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CiAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICAgICAg\nLy8gZGVmYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbiAoKQogICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJv\nd0V4Y2VwdGlvbgogICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0KICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgLy8gSW4gbWl4ZWQgYWNjZXNzIG1vZGUsIHByb3Bl\ncnR5IGluZGV4ZXMgYXJlIG5vdCArMSBpbmNyZW1lbnRhbCAKICAgICAgICAg\nICAgLy8gYSBsb29rdXAgc3dpdGNoIG11c3QgYmUgdXNlZCB0byBkbyBpbmRl\neGVkIGxvb2t1cC4KICAgICAgICAgICAgTG9va3VwU3dpdGNoSW5zdHJ1Y3Rp\nb24gbG9va3VwaW5zID0gY29kZS5sb29rdXBzd2l0Y2goKTsKICAgICAgICAg\nICAgCiAgICAgICAgICAgIGZvciAoSW50ZWdlciBpIDogcHJvcEZtZHMpIHsK\nICAgICAgICAgICAgICAgIGxvb2t1cGlucy5hZGRDYXNlKGksCiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKAogICAgICAg\nICAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzLmdldChmbWRzW2ldLmdldE5h\nbWUoKSkpKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAg\nICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAg\nICAgICAgbG9va3VwaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRp\nb24KICAgICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24uY2xhc3MpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG5hbWUgb2YgdGhlIHNldHRlciBtZXRob2QgZm9yIHRoZSBnaXZlbiBmaWVs\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFNldHRl\nck5hbWUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gInNl\ndCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5l\nZCBieSB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlmIG5vbmUuCiAgICAg\nKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZvciB0ZXN0aW5nLgog\nICAgICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRSZXR1cm5lZEZpZWxkKEJD\nTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmluZEZpZWxkKG1ldGgs\nIChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKSkueHJldHVybigpCiAg\nICAgICAgICAgIC5zZXRUeXBlKG1ldGguZ2V0UmV0dXJuVHlwZSgpKSwgZmFs\nc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCBh\nc3NpZ25lZCBpbiB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlmIG5vbmUu\nCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZvciB0ZXN0\naW5nLgogICAgICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRBc3NpZ25lZEZp\nZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmluZEZpZWxk\nKG1ldGgsIChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKSkucHV0Zmll\nbGQoKSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGZpZWxkIHJldHVybmVkIC8gYXNzaWduZWQgYnkgPGNvZGU+bWV0aDwvY29k\nZT4uIFJldHVybnMKICAgICAqIG51bGwgaWYgbm9uLWZpZWxkcyAobWV0aG9k\ncywgbGl0ZXJhbHMsIHBhcmFtZXRlcnMsIHZhcmlhYmxlcykgYXJlCiAgICAg\nKiByZXR1cm5lZCwgb3IgaWYgbm9uLXBhcmFtZXRlcnMgYXJlIGFzc2lnbmVk\nIHRvIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQkNGaWVs\nZCBmaW5kRmllbGQoQkNNZXRob2QgbWV0aCwgSW5zdHJ1Y3Rpb24gdGVtcGxh\ndGUsCiAgICAgICAgYm9vbGVhbiBmaW5kQWNjZXNzZWQpIHsKICAgICAgICAv\nLyBpZ25vcmUgYW55IHN0YXRpYyBtZXRob2RzLiBPcGVuSlBBIG9ubHkgY3Vy\ncmVudGx5IHN1cHBvcnRzCiAgICAgICAgLy8gbm9uLXN0YXRpYyBzZXR0ZXJz\nIGFuZCBnZXR0ZXJzCiAgICAgICAgaWYgKG1ldGguaXNTdGF0aWMoKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvZGUgY29kZSA9IG1l\ndGguZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgaWYgKGNvZGUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgY29kZS5iZWZvcmVG\naXJzdCgpOwoKICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gbnVsbCwgY3VyOwog\nICAgICAgIEluc3RydWN0aW9uIHRlbXBsYXRlSW5zLCBwcmV2SW5zLCBlYXJs\naWVySW5zOwogICAgICAgIHdoaWxlIChjb2RlLnNlYXJjaEZvcndhcmQodGVt\ncGxhdGUpKSB7CiAgICAgICAgICAgIGludCBiYWNrdXBDb3VudCA9IDM7CiAg\nICAgICAgICAgIHRlbXBsYXRlSW5zID0gY29kZS5wcmV2aW91cygpOwogICAg\nICAgICAgICBpZiAoIWNvZGUuaGFzUHJldmlvdXMoKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBwcmV2SW5zID0gY29kZS5w\ncmV2aW91cygpOwoKICAgICAgICAgICAgaWYgKHByZXZJbnMgaW5zdGFuY2Vv\nZiBDbGFzc0luc3RydWN0aW9uCiAgICAgICAgICAgICAgICAmJiBjb2RlLmhh\nc1ByZXZpb3VzKCkpIHsKICAgICAgICAgICAgICAgIHByZXZJbnMgPSBjb2Rl\nLnByZXZpb3VzKCk7CiAgICAgICAgICAgICAgICBiYWNrdXBDb3VudCsrOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWNvZGUuaGFzUHJldmlv\ndXMoKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICBlYXJsaWVySW5zID0gY29kZS5wcmV2aW91cygpOwoKICAgICAgICAgICAg\nLy8gaWYgdGhlIG9wY29kZSB0d28gYmVmb3JlIHRoZSB0ZW1wbGF0ZSB3YXMg\nYW4gYWxvYWRfMCwgY2hlY2sKICAgICAgICAgICAgLy8gYWdhaW5zdCB0aGUg\nbWlkZGxlIGluc3RydWN0aW9uIGJhc2VkIG9uIHdoYXQgdHlwZSBvZiBmaW5k\nCiAgICAgICAgICAgIC8vIHdlJ3JlIGRvaW5nCiAgICAgICAgICAgIGlmICgh\nKGVhcmxpZXJJbnMgaW5zdGFuY2VvZiBMb2FkSW5zdHJ1Y3Rpb24pCiAgICAg\nICAgICAgICAgICB8fCAhKChMb2FkSW5zdHJ1Y3Rpb24pIGVhcmxpZXJJbnMp\nLmlzVGhpcygpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgICAgICAvLyBpZiB0aGUgbWlkZGxlIGluc3RydWN0aW9uIHdhcyBhIGdl\ndGZpZWxkLCB0aGVuIGl0J3MgdGhlCiAgICAgICAgICAgIC8vIGZpZWxkIHRo\nYXQncyBiZWluZyBhY2Nlc3NlZAogICAgICAgICAgICBpZiAoIWZpbmRBY2Nl\nc3NlZCAmJiBwcmV2SW5zIGluc3RhbmNlb2YgR2V0RmllbGRJbnN0cnVjdGlv\nbikgewogICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBm\nUHJldklucyA9IChGaWVsZEluc3RydWN0aW9uKSBwcmV2SW5zOwogICAgICAg\nICAgICAgICAgY3VyID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RmllbGRJ\nbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZQcmV2SW5zKSk7CiAgICAgICAgICAg\nICAgICAvLyBpZiB0aGUgbWlkZGxlIGluc3RydWN0aW9uIHdhcyBhbiB4bG9h\nZF8xLCB0aGVuIHRoZQogICAgICAgICAgICAgICAgLy8gbWF0Y2hlZCBpbnN0\ncnVjdGlvbiBpcyB0aGUgZmllbGQgdGhhdCdzIGJlaW5nIHNldC4KICAgICAg\nICAgICAgfSBlbHNlIGlmIChmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0\nYW5jZW9mIExvYWRJbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgJiYgKChM\nb2FkSW5zdHJ1Y3Rpb24pIHByZXZJbnMpLmdldFBhcmFtKCkgPT0gMCkgewog\nICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBmVGVtcGxh\ndGVJbnMgPQogICAgICAgICAgICAgICAgICAgIChGaWVsZEluc3RydWN0aW9u\nKSB0ZW1wbGF0ZUluczsKICAgICAgICAgICAgICAgIGN1ciA9IEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAg\nICAgICAgICAgICAgLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVsZEFjdGlvbihm\nVGVtcGxhdGVJbnMpKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGlmIChmaWVsZCAhPSBu\ndWxsICYmIGN1ciAhPSBmaWVsZCkKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgICAgICBmaWVsZCA9IGN1cjsKCiAgICAgICAgICAgIC8v\nIHJlYWR5IGZvciBuZXh0IHNlYXJjaCBpdGVyYXRpb24KICAgICAgICAgICAg\nd2hpbGUgKGJhY2t1cENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgY29k\nZS5uZXh0KCk7CiAgICAgICAgICAgICAgICBiYWNrdXBDb3VudC0tOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmaWVsZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlY29yZCBhIHZpb2xhdGlvbiBvZiB0aGUg\ncHJvcGVydHkgYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZFZpb2xhdGlvbihTdHJpbmcga2V5LCBPYmplY3RbXSBh\ncmdzLCBib29sZWFuIGZhdGFsKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25z\nID09IG51bGwpCiAgICAgICAgICAgIF92aW9sYXRpb25zID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICBfdmlvbGF0aW9ucy5hZGQoX2xvYy5nZXQoa2V5LCBh\ncmdzKSk7CiAgICAgICAgX2ZhaWwgfD0gZmF0YWw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBMb2cgLyB0aHJvdyByZWNvcmRlZCBwcm9wZXJ0eSBhY2Nlc3Mg\ndmlvbGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb2Nlc3NW\naW9sYXRpb25zKCkgewogICAgICAgIGlmIChfdmlvbGF0aW9ucyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFN0cmluZyBzZXAgPSBK\nMkRvUHJpdkhlbHBlci5nZXRMaW5lU2VwYXJhdG9yKCk7CiAgICAgICAgU3Ry\naW5nQnVpbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gX3Zpb2xhdGlvbnMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChpdHIu\nbmV4dCgpKTsKICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKHNlcCk7CiAgICAgICAgfQogICAgICAg\nIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInByb3BlcnR5LXZpb2xhdGlvbnMi\nLCBidWYpOwoKICAgICAgICBpZiAoX2ZhaWwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgaWYgKF9sb2cuaXNX\nYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLndhcm4obXNnKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2VkIGFsbCBkaXJlY3QgYWNjZXNz\nIHRvIG1hbmFnZWQgZmllbGRzIHdpdGggdGhlIGFwcHJvcHJpYXRlCiAgICAg\nKiBwY0dldC9wY1NldCBtZXRob2QuIE5vdGUgdGhhdCB0aGlzIGluY2x1ZGVz\nIGFjY2VzcyB0byBmaWVsZHMKICAgICAqIG93bmVkIGJ5IFBlcnNpc3RlbmNl\nQ2FwYWJsZSBjbGFzc2VzIG90aGVyIHRoYW4gdGhpcyBvbmUuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vz\ncygpIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8v\nIGNyZWF0ZSB0ZW1wbGF0ZSBwdXRmaWVsZC9nZXRmaWVsZCBpbnN0cnVjdGlv\nbnMgdG8gc2VhcmNoIGZvcgogICAgICAgIENvZGUgdGVtcGxhdGUgPSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAgICAgICBJbnN0cnVjdGlv\nbiBwdXQgPSB0ZW1wbGF0ZS5wdXRmaWVsZCgpOwogICAgICAgIEluc3RydWN0\naW9uIGdldCA9IHRlbXBsYXRlLmdldGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1\nY3Rpb24gc3RhdCA9IHRlbXBsYXRlLmludm9rZXN0YXRpYygpOwoKICAgICAg\nICAvLyBsb29rIHRocm91Z2ggYWxsIG1ldGhvZHM7IHRoaXMgaXMgZG9uZSBi\nZWZvcmUgYW55IG1ldGhvZHMgYXJlIGFkZGVkCiAgICAgICAgLy8gc28gd2Ug\nZG9uJ3QgbmVlZCB0byB3b3JyeSBhYm91dCBleGNsdWRpbmcgc3ludGhldGlj\nIG1ldGhvZHMuCiAgICAgICAgQkNNZXRob2RbXSBtZXRob2RzID0gX21hbmFn\nZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kcygpOwogICAgICAgIENvZGUgY29k\nZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhvZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgY29kZSA9IG1ldGhvZHNbaV0uZ2V0Q29k\nZShmYWxzZSk7CgogICAgICAgICAgICAvLyBkb24ndCBtb2RpZnkgdGhlIG1l\ndGhvZHMgc3BlY2lmaWVkIGJ5IHRoZSBhdXhpbGlhcnkgZW5oYW5jZXJzCiAg\nICAgICAgICAgIGlmIChjb2RlICE9IG51bGwgJiYgIXNraXBFbmhhbmNlKG1l\ndGhvZHNbaV0pKSB7CiAgICAgICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRh\ndGVGaWVsZEFjY2Vzcyhjb2RlLCBnZXQsIHRydWUsIHN0YXQpOwogICAgICAg\nICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoY29kZSwg\ncHV0LCBmYWxzZSwgc3RhdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgaW5zdHJ1Y3Rpb25z\nIG1hdGNoaW5nIHRoZSBnaXZlbiB0ZW1wbGF0ZSBpbiB0aGUgZ2l2ZW4KICAg\nICAqIGNvZGUgYmxvY2sgd2l0aCBjYWxscyB0byB0aGUgYXBwcm9wcmlhdGUg\nZ2VuZXJhdGVkIGdldHRlci9zZXR0ZXIuCiAgICAgKgogICAgICogQHBhcmFt\nIGNvZGUgdGhlIGNvZGUgYmxvY2sgdG8gbW9kaWZ5OyB0aGUgY29kZSBpdGVy\nYXRvciB3aWxsCiAgICAgKiBiZSBwbGFjZWQgYmVmb3JlIHRoZSBmaXJzdCBp\nbnN0cnVjdGlvbiBvbiBtZXRob2Qgc3RhcnQsCiAgICAgKiBhbmQgd2lsbCBi\nZSBhZnRlciB0aGUgbGFzdCBpbnN0cnVjdGlvbiBvbiBtZXRob2QgY29tcGxl\ndGlvbgogICAgICogQHBhcmFtIGlucyB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rp\nb24gdG8gc2VhcmNoIGZvcjsgZWl0aGVyIGEKICAgICAqIGdldGZpZWxkIG9y\nIHB1dGZpZWxkIGluc3RydWN0aW9uCiAgICAgKiBAcGFyYW0gZ2V0IGJvb2xl\nYW4gaW5kaWNhdGluZyBpZiB0aGlzIGlzIGEgZ2V0IGluc3RydWN0aW9uCiAg\nICAgKiBAcGFyYW0gc3RhdCB0ZW1wbGF0ZSBpbnZva2VzdGF0aWMgaW5zdHJ1\nY3Rpb24gdG8gcmVwbGFjZSB3aXRoCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2VzcyhDb2RlIGNvZGUsIElu\nc3RydWN0aW9uIGlucywKICAgICAgICBib29sZWFuIGdldCwgSW5zdHJ1Y3Rp\nb24gc3RhdCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICBGaWVsZEluc3RydWN0\naW9uIGZpOwogICAgICAgIE1ldGhvZEluc3RydWN0aW9uIG1pOwogICAgICAg\nIENsYXNzTWV0YURhdGEgb3duZXI7CiAgICAgICAgU3RyaW5nIG5hbWUsIHR5\ncGVOYW1lLCBtZXRob2ROYW1lOwogICAgICAgIHdoaWxlIChjb2RlLnNlYXJj\naEZvcndhcmQoaW5zKSkgewogICAgICAgICAgICAvLyBiYWNrIHVwIHRvIHRo\nZSBtYXRjaGVkIGluc3RydWN0aW9uCiAgICAgICAgICAgIGZpID0gKEZpZWxk\nSW5zdHJ1Y3Rpb24pIGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgbmFt\nZSA9IGZpLmdldEZpZWxkTmFtZSgpOwogICAgICAgICAgICB0eXBlTmFtZSA9\nIGZpLmdldEZpZWxkVHlwZU5hbWUoKTsKICAgICAgICAgICAgb3duZXIgPSBn\nZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihuYW1lLCBmaS5nZXRGaWVsZERl\nY2xhcmVyVHlwZSgpKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBvd25lciA9PSBudWxsID8gbnVsbCA6IG93bmVyLmdldEZpZWxkKG5hbWUp\nOwogICAgICAgICAgICBpZiAoaXNQcm9wZXJ0eUFjY2VzcyhmbWQpKSB7CiAg\nICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBkaXJlY3RseSBhY2Nlc3Npbmcg\nYSBmaWVsZCBpbiBhbm90aGVyIGNsYXNzCiAgICAgICAgICAgICAgICAvLyBo\naWVyYXJjaHkgdGhhdCB1c2VzIHByb3BlcnR5IGFjY2Vzcywgc29tZXRoaW5n\nIGlzIHdyb25nCiAgICAgICAgICAgICAgICBpZiAob3duZXIgIT0gX21ldGEg\nJiYgb3duZXIuZ2V0RGVjbGFyZWRGaWVsZChuYW1lKSAhPSBudWxsICYmCiAg\nICAgICAgICAgICAgICAgICAgX21ldGEgIT0gbnVsbCAmJiAhb3duZXIuZ2V0\nRGVzY3JpYmVkVHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5pc0Fz\nc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoInByb3BlcnR5LWZpZWxkLWFjY2VzcyIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXXsgX21ldGEsIG93bmVyLCBuYW1lLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRNZXRob2QoKS5nZXRO\nYW1lKCkgfSkpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVj\ndGx5IGFjY2Vzc2luZyBhIHByb3BlcnR5LWJhY2tpbmcgZmllbGQgb3V0c2lk\nZQogICAgICAgICAgICAgICAgLy8gdGhlIHByb3BlcnR5IGluIG91ciBvd24g\nY2xhc3MsIG5vdGlmeSB1c2VyCiAgICAgICAgICAgICAgICBpZiAoaXNCYWNr\naW5nRmllbGRPZkFub3RoZXJQcm9wZXJ0eShuYW1lLCBjb2RlKSkKICAgICAg\nICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWZpZWxkLWFj\nY2VzcyIsIG5ldyBPYmplY3RbXXsgX21ldGEsCiAgICAgICAgICAgICAgICAg\nICAgICAgIG93bmVyLCBuYW1lLCBjb2RlLmdldE1ldGhvZCgpLmdldE5hbWUo\nKSB9LCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChv\nd25lciA9PSBudWxsIHx8CiAgICAgICAgICAgICAgICBvd25lci5nZXREZWNs\nYXJlZEZpZWxkKGZyb21CYWNraW5nRmllbGROYW1lKG5hbWUpKSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBub3QgcGVyc2lzdGVudCBmaWVsZD8K\nICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdldFJlZGVmaW5l\nKCkgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkKICAgICAgICAgICAgICAgICYm\nIGlzRmllbGRBY2Nlc3MoZm1kKSkgewogICAgICAgICAgICAgICAgLy8gcmVw\nbGFjZSB0aGUgaW5zdHJ1Y3Rpb24gd2l0aCBhIGNhbGwgdG8gdGhlIGdlbmVy\nYXRlZCBhY2Nlc3MKICAgICAgICAgICAgICAgIC8vIG1ldGhvZAogICAgICAg\nICAgICAgICAgbWkgPSAoTWV0aG9kSW5zdHJ1Y3Rpb24pIGNvZGUuc2V0KHN0\nYXQpOwoKICAgICAgICAgICAgICAgIC8vIGludm9rZSB0aGUgcHJvcGVyIGFj\nY2VzcyBtZXRob2QsIHdoZXRoZXIgZ2V0dGVyIG9yIHNldHRlcgogICAgICAg\nICAgICAgICAgU3RyaW5nIHByZWZpeCA9IChnZXQpID8gUFJFICsgIkdldCIg\nOiBQUkUgKyAiU2V0IjsKICAgICAgICAgICAgICAgIG1ldGhvZE5hbWUgPSBw\ncmVmaXggKyBuYW1lOwogICAgICAgICAgICAgICAgaWYgKGdldCkgewogICAg\nICAgICAgICAgICAgICAgIG1pLnNldE1ldGhvZChnZXRUeXBlKG93bmVyKS5n\nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZE5hbWUs\nIHR5cGVOYW1lLCBuZXcgU3RyaW5nW10KICAgICAgICAgICAgICAgICAgICAg\nICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1lKCkgfSk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1pLnNldE1ldGhv\nZChnZXRUeXBlKG93bmVyKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgIG1ldGhvZE5hbWUsICJ2b2lkIiwgbmV3IFN0cmluZ1tdCiAgICAg\nICAgICAgICAgICAgICAgICAgIHsgZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgp\nLCB0eXBlTmFtZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGdldFJl\nZGVmaW5lKCkpIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBmcm9tQmFja2lu\nZ0ZpZWxkTmFtZShuYW1lKTsKICAgICAgICAgICAgICAgIGlmIChnZXQpIHsK\nICAgICAgICAgICAgICAgICAgICBhZGROb3RpZnlBY2Nlc3MoY29kZSwgb3du\nZXIuZ2V0RmllbGQobmFtZSkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nbmV4dCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBpbnNlcnQgdGhlIHNldCBvcGVyYXRpb25zIGFmdGVyIHRo\nZSBmaWVsZCBtdXRhdGlvbiwgYnV0CiAgICAgICAgICAgICAgICAgICAgLy8g\nZmlyc3QgbG9hZCB0aGUgb2xkIHZhbHVlIGZvciB1c2UgaW4gdGhlCiAgICAg\nICAgICAgICAgICAgICAgLy8gU3RhdGVNYW5hZ2VyLnNldHRpbmdYWFggbWV0\naG9kLgogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGZpbmFsIEZpZWxk\nSW5zdHJ1Y3Rpb24gZkZpID0gZmk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKAogICAgICAgICAgICAgICAgICAgICAg\nICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEZpZWxkSW5zdHJ1\nY3Rpb25GaWVsZEFjdGlvbihmRmkpKSk7CiAgICAgICAgICAgICAgICAgICAg\naW50IHZhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbCh2YWwpLnNldFR5\ncGUoZmkuZ2V0RmllbGRUeXBlKCkpOwoKICAgICAgICAgICAgICAgICAgICAv\nLyBtb3ZlIHBhc3QgdGhlIHB1dGZpZWxkCiAgICAgICAgICAgICAgICAgICAg\nY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZ5TXV0\nYXRpb24oY29kZSwgb3duZXIuZ2V0RmllbGQobmFtZSksIHZhbCwgLTEpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgYWRkTm90aWZ5QWNjZXNzKENvZGUgY29kZSwgRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBQQ0hlbHBlci5hY2Nlc3NpbmdG\naWVsZCh0aGlzLCA8YWJzb2x1dGUtaW5kZXg+KTsKICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLAogICAg\nICAgICAgICAiYWNjZXNzaW5nRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNzIH0p\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtdXN0IGJlIGNhbGxlZCBh\nZnRlciBzZXR0aW5nIHRoZSB2YWx1ZSBpbiB0aGUgb2JqZWN0LgogICAgICog\nCiAgICAgKiBAcGFyYW0gY29kZQogICAgICogQHBhcmFtIHZhbCB0aGUgcG9z\naXRpb24gaW4gdGhlIGxvY2FsIHZhcmlhYmxlIHRhYmxlIHdoZXJlIHRoZQog\nICAgICogb2xkIHZhbHVlIGlzIHN0b3JlZAogICAgICogQHBhcmFtIHBhcmFt\nIHRoZSBwYXJhbWV0ZXIgcG9zaXRpb24gY29udGFpbmluZyB0aGUgbmV3IHZh\nbHVlLCBvcgogICAgICogLTEgaWYgdGhlIG5ldyB2YWx1ZSBpcyB1bmF2YWls\nYWJsZSBhbmQgc2hvdWxkIHRoZXJlZm9yZSBiZSBsb29rZWQKICAgICAqIHVw\nLgogICAgICogQHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5vdGlmeU11dGF0aW9uKENvZGUgY29k\nZSwgRmllbGRNZXRhRGF0YSBmbWQsIGludCB2YWwsCiAgICAgICAgaW50IHBh\ncmFtKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIC8vIFBDSGVscGVyLnNldHRpbmdGaWVsZCh0aGlzLCA8YWJzb2x1\ndGUtaW5kZXg+LCBvbGQsIG5ldyk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1k\nLmdldEluZGV4KCkpOwogICAgICAgIENsYXNzIHR5cGUgPSBmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCk7CiAgICAgICAgLy8gd2Ugb25seSBoYXZlIHNwZWNpYWwg\nc2lnbmF0dXJlcyBmb3IgcHJpbWl0aXZlcyBhbmQgU3RyaW5ncwogICAgICAg\nIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gU3RyaW5nLmNs\nYXNzKQogICAgICAgICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAgICAg\nIGNvZGUueGxvYWQoKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgaWYgKHBhcmFtID09IC0xKSB7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKHBhcmFtKS5zZXRU\neXBlKHR5cGUpOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsICJzZXR0\naW5nRmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7CiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIGludC5jbGFzcywg\ndHlwZSwgdHlwZQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluc3RydWN0aW9uIGFjY2Vzc2Vz\nIGEgZmllbGQgdGhhdCBpcyBhIGJhY2tpbmcKICAgICAqIGZpZWxkIG9mIGFu\nb3RoZXIgcHJvcGVydHkgaW4gdGhpcyBwcm9wZXJ0eS1hY2Nlc3MgY2xhc3Mu\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0JhY2tpbmdGaWVsZE9m\nQW5vdGhlclByb3BlcnR5KFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsKICAg\nICAgICBTdHJpbmcgbWV0aE5hbWUgPSBjb2RlLmdldE1ldGhvZCgpLmdldE5h\nbWUoKTsKICAgICAgICByZXR1cm4gISI8aW5pdD4iLmVxdWFscyhtZXRoTmFt\nZSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMgIT0gbnVsbAogICAg\nICAgICAgICAmJiAhbmFtZS5lcXVhbHMoX2JhY2tpbmdGaWVsZHMuZ2V0KG1l\ndGhOYW1lKSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMuY29udGFp\nbnNWYWx1ZShuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBt\nZXRob2QgdG8gcmV0dXJuIHRoZSBkZWNsYXJpbmcgUGVyc2lzdGVuY2VDYXBh\nYmxlIGNsYXNzIG9mCiAgICAgKiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKgog\nICAgICogQHBhcmFtIGZpZWxkTmFtZSB0aGUgbmFtZSBvZiB0aGUgZmllbGQK\nICAgICAqIEBwYXJhbSBvd25lciB0aGUgbm9taW5hbCBvd25lciBvZiB0aGUg\nZmllbGQKICAgICAqIEByZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgUGVy\nc2lzdGVuY2VDYXBhYmxlIHR5cGUgdGhhdAogICAgICogZGVjbGFyZXMgdGhl\nIGZpZWxkIChhbmQgdGhlcmVmb3JlIGhhcyB0aGUgc3RhdGljIG1ldGhvZCks\nIG9yIG51bGwgaWYgbm9uZQogICAgICovCiAgICBwcml2YXRlIENsYXNzTWV0\nYURhdGEgZ2V0UGVyc2lzdGVuY2VDYXBhYmxlT3duZXIoU3RyaW5nIGZpZWxk\nTmFtZSwKICAgICAgICBDbGFzcyBvd25lcikgewogICAgICAgIC8vIGZpbmQg\ndGhlIGFjdHVhbCBhbmNlc3RvciBjbGFzcyB0aGF0IGRlY2xhcmVzIHRoZSBm\naWVsZCwgdGhlbgogICAgICAgIC8vIGNoZWNrIGlmIHRoZSBjbGFzcyBpcyBw\nZXJzaXN0ZW50LCBhbmQgaWYgdGhlIGZpZWxkIGlzIG1hbmFnZWQKICAgICAg\nICBGaWVsZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQob3duZXIsIGZpZWxk\nTmFtZSwgZmFsc2UpOwogICAgICAgIGlmIChmID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBtYW5hZ2VkIGludGVyZmFj\nZQogICAgICAgIGlmIChfbWV0YSAhPSBudWxsICYmIF9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICByZXR1cm4g\nX21ldGE7CgogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0TWV0YURhdGEoZi5n\nZXREZWNsYXJpbmdDbGFzcygpLCBudWxsLCBmYWxzZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIGFsbCBzeW50aGV0aWMgbWV0aG9kcyB0byB0aGUg\nYnl0ZWNvZGUgYnkgZGVsZWdhdGluZyB0bwogICAgICogdGhlIHZhcmlvdXMg\nYWRkWFhYTWV0aG9kcyAoKSBmdW5jdGlvbnMgaW4gdGhpcyBjbGFzcy4gSW5j\nbHVkZXMKICAgICAqIGFsbCBzdGF0aWMgZmllbGQgYWNjZXNzIG1ldGhvZHMu\nCiAgICAgKiBOb3RlIHRoYXQgdGhlICdzdG9jaycgbWV0aG9kcyBsaWtlIDxj\nb2RlPnBjSXNUcmFuc2FjdGlvbmFsPC9jb2RlPiwKICAgICAqIDxjb2RlPnBj\nRmV0Y2hPYmplY3RJZDwvY29kZT4sIGV0YyBhcmUgZGVmaW5lZCBvbmx5IGlu\nIHRoZQogICAgICogbGVhc3QtZGVyaXZlZCBQZXJzaXN0ZW5jZUNhcGFibGUg\ndHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFBDTWV0aG9kcygp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgYWRkQ2xlYXJGaWVsZHNNZXRob2QoKTsKICAgICAgICBhZGROZXdJbnN0\nYW5jZU1ldGhvZCh0cnVlKTsKICAgICAgICBhZGROZXdJbnN0YW5jZU1ldGhv\nZChmYWxzZSk7CiAgICAgICAgYWRkTWFuYWdlZEZpZWxkQ291bnRNZXRob2Qo\nKTsKICAgICAgICBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpOwogICAgICAg\nIGFkZFByb3ZpZGVGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkQ29weUZp\nZWxkc01ldGhvZCgpOwoKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAg\nICAgICAgIGFkZFN0b2NrTWV0aG9kcygpOwogICAgICAgICAgICBhZGRHZXRW\nZXJzaW9uTWV0aG9kKCk7CiAgICAgICAgICAgIGFkZFJlcGxhY2VTdGF0ZU1h\nbmFnZXJNZXRob2QoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQog\nICAgICAgICAgICAgICAgYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRpdHlNZXRo\nb2RzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIGFwcCBpZCBt\nZXRob2RzIHRvIGVhY2ggc3ViY2xhc3MgcmF0aGVyCiAgICAgICAgLy8gdGhh\nbiBqdXN0IHRoZSBzdXBlcmNsYXNzLCBzaW5jZSBpdCBpcyBwb3NzaWJsZSB0\nbyBoYXZlCiAgICAgICAgLy8gYSBzdWJjbGFzcyB3aXRoIGFuIGFwcCBpZCBo\naWVyYXJjaHkgdGhhdCBtYXRjaGVzIHRoZQogICAgICAgIC8vIHBlcnNpc3Rl\nbnQgY2xhc3MgaW5oZXJpdGFuY2UgaGllcmFyY2h5CiAgICAgICAgaWYgKF9t\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQ\nTElDQVRJT04KICAgICAgICAgICAgJiYgKF9tZXRhLmdldFBDU3VwZXJjbGFz\ncygpID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSB8fAogICAgICAg\nICAgICAgICAgX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgIT0KICAgICAgICAg\nICAgICAgICAgICBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdl\ndE9iamVjdElkVHlwZSgpKSkgewogICAgICAgICAgICBhZGRDb3B5S2V5Rmll\nbGRzVG9PYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRkQ29w\neUtleUZpZWxkc1RvT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAgICAgICAg\nICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKHRydWUpOwog\nICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9k\nKGZhbHNlKTsKICAgICAgICAgICAgaWYgKF9tZXRhLmhhc0Fic3RyYWN0UEtG\naWVsZCgpID09IHRydWUpIHsgCiAgICAgICAgICAgICAgICBhZGRHZXRJRE93\nbmluZ0NsYXNzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkTmV3\nT2JqZWN0SWRJbnN0YW5jZU1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRk\nTmV3T2JqZWN0SWRJbnN0YW5jZU1ldGhvZChmYWxzZSk7CiAgICAgICAgfQog\nICAgICAgIGVsc2UgaWYgKF9tZXRhLmhhc1BLRmllbGRzRnJvbUFic3RyYWN0\nQ2xhc3MoKSl7IAogICAgICAgICAgICBhZGRHZXRJRE93bmluZ0NsYXNzKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbWV0aG9k\nIHRvIGNsZWFyIGFsbCBwZXJzaXN0ZW50IGZpZWxkczsgd2UnbGwgY2FsbCB0\naGlzIGZyb20KICAgICAqIHRoZSBuZXcgaW5zdGFuY2UgbWV0aG9kIHRvIGVu\nc3VyZSB0aGF0IHVubG9hZGVkIGZpZWxkcyBoYXZlCiAgICAgKiBkZWZhdWx0\nIHZhbHVlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENsZWFyRmll\nbGRzTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwcm90ZWN0ZWQgdm9pZCBwY0NsZWFyRmllbGRz\nICgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gc3VwZXIucGNDbGVhckZpZWxkcyAoKQogICAgICAgIGlmIChfbWV0\nYS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJj\nbGFzcygpKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChn\nZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNz\nTWV0YURhdGEoKSksIFBSRSArICJDbGVhckZpZWxkcyIsIHZvaWQuY2xhc3Ms\nCiAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICB9CgogICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgp\nICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBzd2l0Y2ggKGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVI6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFk\nZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAg\nfQoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnBj\nTmV3SW5zdGFuY2U8L2NvZGU+IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAg\nICAgKiBUaGVzZSBtZXRob2RzIGFyZSB1c2VkIGJ5IHRoZSBpbXBsIGhlbHBl\nciB0byBjcmVhdGUgbmV3CiAgICAgKiBtYW5hZ2VkIGluc3RhbmNlcyBlZmZp\nY2llbnRseSB3aXRob3V0IHJlZmxlY3Rpb24uCiAgICAgKgogICAgICogQHBh\ncmFtIG9pZCBzZXQgdG8gdHJ1ZSB0byBtaW1pYyB0aGUgbWV0aG9kIHZlcnNp\nb24gdGhhdCB0YWtlcwogICAgICogYW4gb2lkIHZhbHVlIGFzIHdlbGwgYXMg\nYSBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRO\nZXdJbnN0YW5jZU1ldGhvZChib29sZWFuIG9pZCkgewogICAgICAgIC8vIHB1\nYmxpYyBQZXJzaXN0ZW5jZUNhcGFibGUgcGNOZXdJbnN0YW5jZSAoLi4uKQog\nICAgICAgIENsYXNzW10gYXJncyA9CiAgICAgICAgICAgIChvaWQpID8gbmV3\nIENsYXNzW117IFNNVFlQRSwgT2JqZWN0LmNsYXNzLCBib29sZWFuLmNsYXNz\nIH0KICAgICAgICAgICAgICAgIDogbmV3IENsYXNzW117IFNNVFlQRSwgYm9v\nbGVhbi5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKFBSRSArICJOZXdJbnN0YW5jZSIsIFBDVFlQRSwgYXJn\ncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7\nCgogICAgICAgIC8vIGlmIHRoZSB0eXBlIGlzIGFic3RyYWN0LCB0aHJvdyBh\nIFVzZXJFeGNlcHRpb24KICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkg\newogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBVU0VSRVhDRVAp\nOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgLy8gWFhYIHBjID0gbmV3IFhYWCAoKTsKICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGludCBpbnN0ID0gY29k\nZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgp\nLnNldExvY2FsKGluc3QpOwoKICAgICAgICAvLyBpZiAoY2xlYXIpCiAgICAg\nICAgLy8gICBwYy5wY0NsZWFyRmllbGRzICgpOwogICAgICAgIGNvZGUuaWxv\nYWQoKS5zZXRQYXJhbSgob2lkKSA/IDIgOiAxKTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gbm9jbGVhciA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5j\nbGFzcywgbnVsbCk7CgogICAgICAgIC8vIHBjLnBjU3RhdGVNYW5hZ2VyID0g\nc207CiAgICAgICAgbm9jbGVhci5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNl\ndExvY2FsKGluc3QpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwoKICAgICAgICAvLyBjb3B5IGtleSBmaWVsZHMgZnJvbSBvaWQKICAg\nICAgICBpZiAob2lkKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChpbnN0KTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDEpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAg\nICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICB9CgogICAgICAgIC8vIHJldHVybiBwYzsKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cHJvdGVjdGVkIHN0YXRpYyBp\nbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKTwvY29kZT4KICAgICAqIG1l\ndGhvZCB0byB0aGUgYnl0ZWNvZGUsIHJldHVybmluZyB0aGUgaW5oZXJpdGVk\nIGZpZWxkIGNvdW50IGFkZGVkCiAgICAgKiB0byB0aGUgbnVtYmVyIG9mIG1h\nbmFnZWQgZmllbGRzIGluIHRoZSBjdXJyZW50IFBlcnNpc3RlbmNlQ2FwYWJs\nZSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE1hbmFnZWRG\naWVsZENvdW50TWV0aG9kKCkgewogICAgICAgIC8vIHByb3RlY3RlZCBzdGF0\naWMgaW50IHBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0TWFu\nYWdlZEZpZWxkQ291bnQiLAogICAgICAgICAgICBpbnQuY2xhc3MsIG51bGwp\nOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgbWV0\naG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+\nICsgcGNJbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgLy8gYXdoaXRlOiB0\naGUgYWJvdmUgc2hvdWxkIHdvcmssIGJ1dCBJJ20gc2VlaW5nIGEgbWVzc2Vk\nIHVwIHNpdHVhdGlvbgogICAgICAgIC8vIGFsbCBvZiBhIHN1ZGRlbiB3aGVy\nZSB3aGVuIGEgc3ViY2xhc3MgY2FsbHMgdGhpcyBtZXRob2QsIGl0IHNvbWVo\nb3cKICAgICAgICAvLyBoYXBwZW5zIGJlZm9yZSA8Y2xpbml0PiBpcyBldmVy\nIGludm9rZWQsIGFuZCBzbyBvdXIKICAgICAgICAvLyBwY0luaGVyaXRlZEZp\nZWxkQ291bnQgZmllbGQgaXNuJ3QgaW5pdGlhbGl6ZWQhICBzbyBpbnN0ZWFk\nLAogICAgICAgIC8vIHJldHVybiA8ZmllbGRzPiArIDxzdXBlcmNsYXNzPi5w\nY0dldE1hbmFnZWRGaWVsZENvdW50ICgpCiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCkubGVuZ3Ro\nKTsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBDbGFzcyBzdXBlckNsYXNzID0gZ2V0VHlwZShf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKTsKICAgICAgICAgICAg\nU3RyaW5nIHN1cGVyTmFtZSA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPwogICAg\nICAgICAgICAgICAgUENFbmhhbmNlci50b1BDU3ViY2xhc3NOYW1lKHN1cGVy\nQ2xhc3MpIDoKICAgICAgICAgICAgICAgIHN1cGVyQ2xhc3MuZ2V0TmFtZSgp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChz\ndXBlck5hbWUsCiAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZp\nZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaXJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5j\nZUNhcGFibGUjcGNQcm92aWRlRmllbGR9IGFuZAogICAgICoge0BsaW5rIFBl\ncnNpc3RlbmNlQ2FwYWJsZSNwY1Byb3ZpZGVGaWVsZHN9IG1ldGhvZHMgdG8g\ndGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUHJv\ndmlkZUZpZWxkc01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjUHJvdmlk\nZUZpZWxkIChpbnQgZmllbGROdW1iZXIpCiAgICAgICAgQkNNZXRob2QgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlByb3ZpZGVGaWVsZCIs\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xh\nc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdoIHRoZSBz\nd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3aXRjaE1l\ndGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwgY29kZSk7CgogICAgICAgIC8v\nIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cgZXhjZXB0\naW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVT\ndWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBf\nbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChmbWRzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICAgICAgY29k\nZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgVGFi\nbGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNo\nKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAg\nIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAg\nICAvLyA8ZmllbGQ+ID0gcGNTdGF0ZU1hbmFnZXIucHJvdmlkZWQ8dHlwZT5G\naWVsZAogICAgICAgICAgICAvLyAgICAgKHRoaXMsIGZpZWxkTnVtYmVyKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUs\nIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAg\nICAgICAgICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksICJwcm92\naWRlZCIsIGZhbHNlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS52\ncmV0dXJuKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1\nbHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAg\nICAgICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRp\nb24KICAgICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24uY2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24o\nbWV0aG9kKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGlu\nayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmllbGR9IGFuZAogICAg\nICoge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZHN9\nIG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkUmVwbGFjZUZpZWxkc01ldGhvZHMoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2\nb2lkIHBjUmVwbGFjZUZpZWxkIChpbnQgZmllbGROdW1iZXIpCiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJl\ncGxhY2VGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0\naHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwgPSBi\nZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiUmVwbGFjZUZpZWxkIiwgY29kZSk7\nCgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3Qg\ndGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAg\nICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAg\nIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAg\nICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAg\nICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2Rl\nLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7\nCiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7\nCgogICAgICAgICAgICAvLyA8ZmllbGQ+ID0gcGNTdGF0ZU1hbmFnZXIucmVw\nbGFjZTx0eXBlPkZpZWxkCiAgICAgICAgICAgIC8vICAodGhpcywgZmllbGRO\ndW1iZXIpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIGZvciB0aGUgYWRk\nU2V0TWFuYWdlZFZhbHVlQ29kZSBjYWxsIGJlbG93LgogICAgICAgICAgICAg\nICAgdGFiaW5zLmFkZFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlLCBmbWRzW2ldKSk7CgogICAgICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSwgZm1kc1tpXSk7CiAgICAgICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAgICAgICAg\nICAgICAgICAgIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAicmVwbGFj\nZSIsIHRydWUsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBpZiAoIWZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUoKSkKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgYWRkU2V0TWFu\nYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAg\nIGlmKF9hZGRWZXJzaW9uSW5pdEZsYWcpewogICAgICAgICAgICAgICAgICAg\nIGlmKGZtZHNbaV0uaXNWZXJzaW9uKCkpewogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBJZiB0aGlzIGNhc2UgaXMgc2V0dGluZyB0aGUgdmVyc2lvbiBm\naWVsZAogICAgICAgICAgICAgICAgICAgICAgICAvLyBwY1ZlcnNpb25Jbml0\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgxKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVsbCwgVkVSU0lPTl9JTklUX1NU\nUiwgYm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAg\ndGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAg\nICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xh\nc3MpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAg\nICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0\nZW5jZUNhcGFibGUjcGNDb3B5RmllbGRzfSBtZXRob2QgdG8gdGhlIGJ5dGVj\nb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUZpZWxkc01l\ndGhvZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5RmllbGQgKE9iamVjdCBw\nYywgaW50IGZpZWxkKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5RmllbGQiLAogICAgICAgICAgICB2\nb2lkLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgbmV3IFN0cmluZ1td\neyBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0TmFtZSgp\nIH0pOwogICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAg\nQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8v\nIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAg\nICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiQ29w\neUZpZWxkIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0\naGlzIGluc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEu\nZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAg\nICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24uY2xhc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBz\nd2l0Y2ggKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2Fs\nKHJlbExvY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRh\nYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZt\nZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIDxm\naWVsZD4gPSBvdGhlci48ZmllbGQ+OwogICAgICAgICAgICAgICAgLy8gb3Ig\nc2V0PGZpZWxkPiAob3RoZXIuZ2V0PGZpZWxkPik7CiAgICAgICAgICAgICAg\nICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UsIGZtZHNbaV0pKTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRW\nYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKCiAg\nICAgICAgICAgICAgICAvLyBicmVhazsKICAgICAgICAgICAgICAgIGNvZGUu\ndnJldHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWZh\ndWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAg\nICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0\naW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9u\nKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9k\nIHRvIGFkZCB0aGUgY29kZSBjb21tb24gdG8gdGhlIGJlZ2lubmluZyBvZiBi\nb3RoIHRoZQogICAgICogcGNSZXBsYWNlRmllbGQgbWV0aG9kIGFuZCB0aGUg\ncGNQcm92aWRlRmllbGQgbWV0aG9kLiBUaGlzIGluY2x1ZGVzCiAgICAgKiBj\nYWxjdWxhdGluZyB0aGUgcmVsYXRpdmUgZmllbGQgbnVtYmVyIG9mIHRoZSBk\nZXNpcmVkIGZpZWxkIGFuZCBjYWxsaW5nCiAgICAgKiB0aGUgc3VwZXJjbGFz\ncyBpZiBuZWNlc3NhcnkuCiAgICAgKgogICAgICogQHJldHVybiB0aGUgaW5k\nZXggaW4gd2hpY2ggdGhlIGxvY2FsIHZhcmlhYmxlIGhvbGRpbmcgdGhlIHJl\nbGF0aXZlCiAgICAgKiBmaWVsZCBudW1iZXIgaXMgc3RvcmVkCiAgICAgKi8K\nICAgIHByaXZhdGUgaW50IGJlZ2luU3dpdGNoTWV0aG9kKFN0cmluZyBuYW1l\nLCBDb2RlIGNvZGUpIHsKICAgICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsg\nIkNvcHlGaWVsZCIpLmVxdWFscyhuYW1lKTsKICAgICAgICBpbnQgZmllbGRO\ndW1iZXIgPSAoY29weSkgPyAxIDogMDsKCiAgICAgICAgaW50IHJlbExvY2Fs\nID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBpZiAoZ2V0\nQ3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBjb2RlLmlsb2FkKCku\nc2V0UGFyYW0oZmllbGROdW1iZXIpOwogICAgICAgICAgICBjb2RlLmlzdG9y\nZSgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgcmV0dXJuIHJl\nbExvY2FsOwogICAgICAgIH0KCiAgICAgICAgLy8gaW50IHJlbCA9IGZpZWxk\nTnVtYmVyIC0gcGNJbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgY29kZS5p\nbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICBjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAg\nICAgY29kZS5pc3ViKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2Nh\nbChyZWxMb2NhbCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJl\nbExvY2FsKTsKCiAgICAgICAgLy8gc3VwZXI6IGlmIChyZWwgPCAwKSBzdXBl\nci5wY1JlcGxhY2VGaWVsZCAoZmllbGROdW1iZXIpOyByZXR1cm47CiAgICAg\nICAgLy8gbm8gc3VwZXI6IGlmIChyZWwgPCAwKSB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uICgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZnZSgpOwogICAgICAgIGlmIChfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBTdHJpbmdb\nXSBhcmdzOwogICAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAgICAg\nICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgZ2V0VHlwZShfbWV0YS5nZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICBnZXRO\nYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0cmluZ1tdeyBpbnQuY2xh\nc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQ\nYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAg\nICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLCBuYW1l\nLCAKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdz\nKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbi5jbGFzcyk7CgogICAgICAgIGlmaW5zLnNldFRhcmdl\ndChjb2RlLm5vcCgpKTsKICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIGhlbHBlciBtZXRob2QsIGdpdmVuIHRo\nZSBwY1JlcGxhY2VGaWVsZCBvciBwY1Byb3ZpZGVGaWVsZAogICAgICogbWV0\naG9kLCBhZGRzIHRoZSBieXRlY29kZSBmb3IgdGhlIGNvcnJlc3BvbmRpbmcg\nJ3BsdXJhbCcgdmVyc2lvbgogICAgICogb2YgdGhlIG1ldGhvZCAtLSB0aGUg\ndmVyc2lvbiB0aGF0IHRha2VzIGFuIGludFtdIG9mIGZpZWxkcyB0bwogICAg\nICogdG8gYWNjZXNzIHJhdGhlciB0aGFuIGEgc2luZ2xlIGZpZWxkLiBUaGUg\nbXVsdGlwbGUgZmllbGRzIHZlcnNpb24KICAgICAqIHNpbXBseSBsb29wcyB0\naHJvdWdoIHRoZSBwcm92aWRlZCBpbmRleGVzIGFuZCBkZWxlZ2F0ZXMgdG8g\ndGhlCiAgICAgKiBzaW5ndWxhciB2ZXJzaW9uIGZvciBlYWNoIG9uZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE11bHRpcGxlRmllbGRzTWV0aG9k\nVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUpIHsKICAgICAgICBib29sZWFuIGNv\ncHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhzaW5nbGUuZ2V0TmFt\nZSgpKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgPG1ldGhvZD5zIChpbnRb\nXSBmaWVsZHMpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKGNvcHkpID8gbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcywgaW50W10uY2xhc3MgfQogICAgICAg\nICAgICA6IG5ldyBDbGFzc1tdeyBpbnRbXS5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKHNpbmdsZS5nZXRO\nYW1lKCkgKyAicyIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3MpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICBpbnQgZmllbGROdW1iZXJzID0gMDsKICAgICAgICBpbnQgaW5zdCA9\nIDA7CiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgZmllbGROdW1i\nZXJzID0gMTsKCiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIG1hbmFnZWQgaW5zdGFu\nY2UgaW50byB0aGUgbG9jYWwgdmFyaWFibGUgdGFibGUKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKEltcGxIZWxwZXIuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgImdldE1hbmFnZWRJbnN0YW5jZSIs\nIE9iamVjdC5jbGFzcywKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3Nb\nXSB7IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShfbWFuYWdlZFR5cGUpOwogICAgICAgICAgICAg\nICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAg\nICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGluc3QpOwoKICAgICAg\nICAgICAgICAgIC8vIHRoZXJlIG1pZ2h0IGJlIGEgZGlmZmVyZW5jZSBiZXR3\nZWVuIHRoZSBjbGFzc2VzIG9mICd0aGlzJwogICAgICAgICAgICAgICAgLy8g\ndnMgJ290aGVyJyBpbiB0aGlzIGNvbnRleHQ7IHVzZSB0aGUgUEMgbWV0aG9k\ncyB0byBnZXQgdGhlIFNNCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ndGF0aWMoKS5zZXRNZXRob2QoSW1wbEhlbHBlci5jbGFzcywKICAgICAgICAg\nICAgICAgICAgICAidG9QZXJzaXN0ZW5jZUNhcGFibGUiLCBQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNp\nc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICAgICAicGNH\nZXRTdGF0ZU1hbmFnZXIiLCBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gWFhYIG90\naGVyID0gKFhYWCkgcGM7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoX3BjKTsKICAgICAgICAgICAgICAgIGluc3QgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29kZS5hc3Rv\ncmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAgICAgICAgICAvLyBhY2Nl\nc3MgdGhlIG90aGVyJ3Mgc20gZmllbGQgZGlyZWN0bHkKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgKG90aGVyLnBjU3RhdGVN\nYW5hZ2VyICE9IHBjU3RhdGVNYW5hZ2VyKQogICAgICAgICAgICAvLwl0aHJv\ndyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uCgogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmYWNtcGVxKCk7\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRh\ncmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgICAgIC8vIGlmIChwY1N0YXRl\nTWFuYWdlciA9PSBudWxsKQogICAgICAgICAgICAvLyAgdGhyb3cgbmV3IEls\nbGVnYWxTdGF0ZUV4Y2VwdGlvbgogICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBpZmlucyA9\nIGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9u\nKGNvZGUsIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGZvciAoaW50IGkgPSAwOwogICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICBpbnQgaWR4ID0gY29kZS5nZXRO\nZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExv\nY2FsKGlkeCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIHRlc3RpbnMgPSBj\nb2RlLmdvMigpOwoKICAgICAgICAvLyA8bWV0aG9kPiAoZmllbGRzW2ldKTsK\nICAgICAgICBJbnN0cnVjdGlvbiBib2R5aW5zID0gbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgaWYgKGNvcHkpCiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXJzKTsKICAgICAgICBjb2Rl\nLmlsb2FkKCkuc2V0TG9jYWwoaWR4KTsKICAgICAgICBjb2RlLmlhbG9hZCgp\nOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChzaW5n\nbGUpOwoKICAgICAgICAvLyBpKys7CiAgICAgICAgY29kZS5paW5jKCkuc2V0\nSW5jcmVtZW50KDEpLnNldExvY2FsKGlkeCk7CgogICAgICAgIC8vIGkgPCBm\naWVsZHMubGVuZ3RoCiAgICAgICAgdGVzdGlucy5zZXRUYXJnZXQoY29kZS5p\nbG9hZCgpLnNldExvY2FsKGlkeCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbShmaWVsZE51bWJlcnMpOwogICAgICAgIGNvZGUuYXJyYXlsZW5n\ndGgoKTsKICAgICAgICBjb2RlLmlmaWNtcGx0KCkuc2V0VGFyZ2V0KGJvZHlp\nbnMpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlICdzdG9j\naycgbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGU7IHRoZXNlIGluY2x1ZGUgbWV0\naG9kcwogICAgICogbGlrZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3Bj\nRmV0Y2hPYmplY3RJZH0KICAgICAqIGFuZCB7QGxpbmsgUGVyc2lzdGVuY2VD\nYXBhYmxlI3BjSXNUcmFuc2FjdGlvbmFsfS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZFN0b2NrTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gcGNHZXRHZW5lcmljQ29udGV4dAogICAgICAgICAgICB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAg\nICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImdldCIgKyBDT05URVhUTkFN\nRSwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAg\nIC8vIHBjRmV0Y2hPYmplY3RJZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9t\nU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgIFNNVFlQRSwgImZldGNoT2JqZWN0SWQiLCAoQ2xh\nc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJ\nc0RlbGV0ZWQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdl\nck1ldGhvZCgKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAg\nICAgICBTTVRZUEUsICJpc0RlbGV0ZWQiLCAoQ2xhc3NbXSkgbnVsbCkpLCBm\nYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RpcnR5CiAgICAgICAg\nICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAg\nICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhv\nZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNE\naXJ0eSIsIChDbGFzc1tdKSBudWxsKSksIHRydWUpOwogICAgCiAgICAgICAg\nICAgIC8vIHBjSXNOZXcKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRl\nTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAg\nICAgICAgICAgICBTTVRZUEUsICJpc05ldyIsIChDbGFzc1tdKSBudWxsKSks\nIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzUGVyc2lzdGVudAog\nICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAog\nICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFy\nZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQ\nRSwgImlzUGVyc2lzdGVudCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsK\nICAgIAogICAgICAgICAgICAvLyBwY0lzVHJhbnNhY3Rpb25hbAogICAgICAg\nICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAg\nICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRo\nb2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlz\nVHJhbnNhY3Rpb25hbCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAg\nIAogICAgICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAgICAgICAgICAgIHRy\nYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAg\nICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAic2VyaWFsaXpp\nbmciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAg\nICAgLy8gcGNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVN\nYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIFNNVFlQRSwgImRpcnR5IiwgbmV3IENsYXNzW117IFN0cmlu\nZy5jbGFzcyB9KSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0dl\ndFN0YXRlTWFuYWdlcgogICAgICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFN0YXRlTWFuYWdlciIsCiAgICAg\nICAgICAgICAgICBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFN0YXRlTWFuYWdl\nci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfSBjYXRjaCAoUHJp\ndmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgIHRo\ncm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0\naG9kIHRvIGFkZCBhIHN0b2NrIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuIEVh\nY2gKICAgICAqIHN0b2NrIG1ldGhvZCBzaW1wbHkgZGVsZWdhdGVzIHRvIGEg\nY29ycmVzcG9uZGluZyBTdGF0ZU1hbmFnZXIgbWV0aG9kLgogICAgICogR2l2\nZW4gdGhlIFN0YXRlTWFuYWdlciBtZXRob2QsIHRoZW4sIHRoaXMgZnVuY3Rp\nb24gdHJhbnNsYXRlcyBpdCBpbnRvCiAgICAgKiB0aGUgd3JhcHBlciBtZXRo\nb2QgdGhhdCBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGJ5dGVjb2RlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdl\nck1ldGhvZChNZXRob2QgbSwKICAgICAgICBib29sZWFuIGlzRGlydHlDaGVj\na01ldGhvZCkgewogICAgICAgIC8vIGZvcm0gdGhlIG5hbWUgb2YgdGhlIG1l\ndGhvZCBieSBwcmVwZW5kaW5nICdwYycgdG8gdGhlIHNtIG1ldGhvZAogICAg\nICAgIFN0cmluZyBuYW1lID0gUFJFICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6\nZShtLmdldE5hbWUoKSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSBtLmdl\ndFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgQ2xhc3MgcmV0dXJuVHlwZSA9\nIG0uZ2V0UmV0dXJuVHlwZSgpOwoKICAgICAgICAvLyBhZGQgdGhlIG1ldGhv\nZCB0byB0aGUgcGMKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChuYW1lLCByZXR1cm5UeXBlLCBwYXJhbXMpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJuIDxkZWZhdWx0\nPjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51\nbGwoKTsKICAgICAgICBpZiAocmV0dXJuVHlwZS5lcXVhbHMoYm9vbGVhbi5j\nbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nYWxzZSk7CiAgICAgICAgZWxzZSBpZiAoIXJldHVyblR5cGUuZXF1YWxzKHZv\naWQuY2xhc3MpKQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVs\nbCgpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUocmV0dXJuVHlw\nZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGRpcnR5LWNoZWNrIG1l\ndGhvZCBhbmQgd2UncmUgc3ViY2xhc3NpbmcgYnV0IG5vdAogICAgICAgIC8v\nIHJlZGVmaW5pbmcsIGhvb2sgaW50byBQQ0hlbHBlciB0byBkbyB0aGUgZGly\ndHkgY2hlY2sKICAgICAgICBpZiAoaXNEaXJ0eUNoZWNrTWV0aG9kICYmICFn\nZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIFJlZGVmaW5pdGlvbkhl\nbHBlci5kaXJ0eUNoZWNrKHNtKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFy\nZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAg\nICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgdGhlIHJldHVybiBzdGF0\nZW1lbnQgYmVsb3cKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5z\nZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLCAKICAgICAgICAg\nICAgICAgICJkaXJ0eUNoZWNrIiwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10g\neyBTTVRZUEUgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyByZXR1cm4g\ncGNTdGF0ZU1hbmFnZXIuPG1ldGhvZD4gKDxhcmdzPik7CiAgICAgICAgLy8g\nbWFuYWdlZCBpbnN0YW5jZSBsb2FkZWQgYWJvdmUgaW4gaWYtZWxzZSBibG9j\nawogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSk7CiAg\nICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QobSk7CiAg\nICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsKCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjR2V0VmVyc2lv\nbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRWZXJzaW9uIiwgT2Jq\nZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBj\nU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBp\nZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKCiAg\nICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQogICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1cm4gbnVsbDsKICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJuIDx2ZXJzaW9uRmll\nbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0gdG9QcmltaXRpdmVX\ncmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3cmFwcGVy\nICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkgewogICAgICAg\nICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFwcGVyKTsKICAgICAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbkZpZWxk\nKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZpZWxkLmdl\ndERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5pdD4iLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB2ZXJzaW9u\nRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfQogICAgICAg\nIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1cm4gcGNTdGF0ZU1h\nbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQo\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJnZXRW\nZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAg\nICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNpb24gZmll\nbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBvciBudWxsIGlmCiAg\nICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJpbWl0aXZlLgogICAg\nICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZlV3JhcHBlcihGaWVs\nZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uY2xhc3M7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBDaGFyYWN0ZXIu\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgcmV0dXJu\nIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIHJl\ndHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9ydC5jbGFzczsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0\nZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVNYW5hZ2VyfQogICAgICogbWV0\naG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKSB7CiAgICAgICAgLy8g\ncHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVNYW5hZ2VyIChTdGF0ZU1hbmFn\nZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAgICAgICAg\nICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU01UWVBFIH0pOwogICAgICAg\nIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1ZSk7CiAgICAgICAgbWV0aG9k\nLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKFNlY3VyaXR5RXhj\nZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyICE9\nIG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1hbmFnZXIgPSBwY1N0YXRlTWFu\nYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxk\nKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAg\nICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1tdeyBTTVRZUEUgfSk7CiAgICAg\nICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBTZWN1cml0eU1hbmFn\nZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5TWFuYWdlciAoKTsKICAgICAg\nICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAgICAgLy8JCXNlYy5jaGVja1Bl\ncm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NUQVRFX01BTkFHRVIpOwogICAg\nICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmludm9rZXN0YXRpYygpLnNldE1l\ndGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAgICAgICJnZXRTZWN1cml0eU1h\nbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xhc3MsIG51bGwpKTsKCiAgICAg\nICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBpZmlucy5zZXRU\nYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIG1l\ndGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0aW9uCiAgICAgKiBpZGVudGl0\neSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBsZW1lbnRhdGlvbnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09wQXBwbGljYXRpb25JZGVudGl0\neU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5\nRmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZzLAog\nICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAg\nICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElk\nIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxk\nc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAogICAg\nICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAog\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERkNUWVBF\nLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2\nb2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0IG9pZCkK\nICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29w\neUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNlICgp\nCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5l\nd09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xhc3Ms\nIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNv\nZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAg\nICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoT2Jq\nZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9iamVj\ndC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAg\nICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQ8L2Nv\nZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRp\nb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxkTWFuYWdl\ncikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElk\nIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAgICAgLy8JT2JqZWN0\nIG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFuYWdlcikg\nPwogICAgICAgICAgICBuZXcgU3RyaW5nW117IE9JREZTVFlQRS5nZXROYW1l\nKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6IG5l\ndyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJD\nb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xh\nc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc2luZ2xlIGZpZWxkIGlk\nZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0aW9uCiAgICAgICAgaWYgKF9t\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgdGhyb3dF\neGNlcHRpb24oY29kZSwgSU5URVJORVhDRVApOwogICAgICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gY2Fs\nbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1\ncGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSB7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3MubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\naSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhv\nZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgUFJF\nICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwgdm9pZC5jbGFzcy5nZXRO\nYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gT2JqZWN0IGlk\nID0gb2lkOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYg\nKF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAg\nLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgpOwogICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2Jq\nZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICBPYmplY3Qu\nY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9pZCB0eXBl\nPiBpZCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAgICAgICAgaW50IGlkID0gY29k\nZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBDbGFzcyBvaWRUeXBl\nID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUuYXN0b3Jl\nKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAvLyBpbnQgaW5oZXJpdGVkID0g\ncGNJbmhlcml0ZWRGaWVsZENvdW50OwogICAgICAgIGludCBpbmhlcml0ZWQg\nPSAwOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsKICAgICAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3Mp\nOwogICAgICAgICAgICBpbmhlcml0ZWQgPSBjb2RlLmdldE5leHRMb2NhbHNJ\nbmRleCgpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGlu\naGVyaXRlZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZC48ZmllbGQ+ID0g\nZnMuZmV0Y2g8dHlwZT5GaWVsZCAoPGluZGV4Pik7IG9yLi4uCiAgICAgICAg\nLy8gaWQuPGZpZWxkPiA9IHBjLjxmaWVsZD47CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0\nRmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxk\ncygpOwogICAgICAgIENsYXNzIHR5cGU7CiAgICAgICAgU3RyaW5nIG5hbWU7\nCiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgTWV0aG9kIHNldHRlcjsK\nICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgh\nZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwoK\nICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFtZSgpOwogICAgICAg\nICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwog\nICAgICAgICAgICBpZiAoaXNGaWVsZEFjY2VzcyhmbWRzW2ldKSkgewogICAg\nICAgICAgICAgICAgc2V0dGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIGZp\nZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgbmFtZSwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICByZWZsZWN0ID0gIU1vZGlmaWVyLmlzUHVi\nbGljKGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAgICAgICAgICAgICAgIGlm\nIChyZWZsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChSZWZsZWN0aW9uLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAg\nImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IENsYXNz\nLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xhc3Ms\nIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IG51bGw7CiAg\nICAgICAgICAgICAgICBzZXR0ZXIgPSBSZWZsZWN0aW9uLmZpbmRTZXR0ZXIo\nb2lkVHlwZSwgbmFtZSwgdHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBy\nZWZsZWN0ID0gIU1vZGlmaWVyLmlzUHVibGljKHNldHRlci5nZXRNb2RpZmll\ncnMoKSk7CiAgICAgICAgICAgICAgICBpZiAocmVmbGVjdCkgewogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKG9p\nZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNz\nY29uc3RhbnQoKS5zZXRDbGFzcyh0eXBlKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVj\ndGlvbi5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICJmaW5kU2V0\ndGVyIiwgTWV0aG9kLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IENsYXNzLmNsYXNz\nLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xhc3MsIENsYXNz\nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7\nCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoaW5oZXJpdGVk\nKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QKICAgICAgICAg\nICAgICAgICAgICAoZ2V0RmllbGRTdXBwbGllck1ldGhvZCh0eXBlKSk7CiAg\nICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0JKRUNUICYmCiAgICAgICAgICAgICAg\nICAgICAgIWZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkuaXNFbnVtKCkpIHsK\nICAgICAgICAgICAgICAgIAljb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2Jq\nZWN0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgCWNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwgCiAg\nICAgICAgICAgIAkJCU9iamVjdC5jbGFzcywgbnVsbCk7ICAgICAgICAgICAg\nICAgIAkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBp\nZiB0aGUgdHlwZSBvZiB0aGlzIGZpZWxkIG1ldGEgZGF0YSBpcwogICAgICAg\nICAgICAgICAgLy8gbm9uLXByaW1pdGl2ZSBhbmQgbm9uLXN0cmluZywgYmUg\nc3VyZSB0byBjYXN0CiAgICAgICAgICAgICAgICAvLyB0byB0aGUgYXBwcm9w\ncmlhdGUgdHlwZS4KICAgICAgICAgICAgICAgIGlmICghcmVmbGVjdCAmJiAh\ndHlwZS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAgICAgICAgICAgJiYgIXR5\ncGUuZ2V0TmFtZSgpLmVxdWFscyhTdHJpbmcuY2xhc3MuZ2V0TmFtZSgpKSkK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\ndHlwZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7Cgog\nICAgICAgICAgICAgICAgLy8gZ2V0IGlkL3BrIGZyb20gcGMgaW5zdGFuY2UK\nICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAgYWRk\nRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZWZsZWN0ICYmIGZp\nZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJzZXQiLCAKICAg\nICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IE9i\namVjdC5jbGFzcywgRmllbGQuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDogT2JqZWN0LmNsYXNzIH0p\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlZmxlY3QpIHsgCiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0\naW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAgICAgICAgICAgICAgdm9pZC5j\nbGFzcywgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIE1ldGhvZC5jbGFz\ncywKICAgICAgICAgICAgICAgICAgICAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/\nIHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvZGUucHV0Zmll\nbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChzZXR0\nZXIpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\nY29kZSB0byBleHRyYWN0IHRoZSBpZCBvZiB0aGUgZ2l2ZW4gcHJpbWFyeSBr\nZXkgcmVsYXRpb24gZmllbGQgZm9yCiAgICAgKiBzZXR0aW5nIGludG8gYW4g\nb2JqZWN0aWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZp\nZWxkTWV0YURhdGEgcGspIHsKICAgICAgICAvLyBpZiAodmFsICE9IG51bGwp\nIAogICAgICAgIC8vICB2YWwgPSAoKFBlcnNpc3RlbmNlQ2FwYWJsZSkgdmFs\nKS5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICBpbnQgcGMgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0\nTG9jYWwocGMpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChwYyk7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmbnVsbDEgPSBjb2RlLmlmbnVs\nbCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFBlcnNpc3RlbmNlQ2FwYWJs\nZS5jbGFzcyk7IAogICAgICAgIGlmICghcGsuZ2V0VHlwZU1ldGFEYXRhKCku\naXNPcGVuSlBBSWRlbnRpdHkoKSkKICAgICAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNz\nLAogICAgICAgICAgICAgICAgUFJFICsgIkZldGNoT2JqZWN0SWQiLCBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoUGVyc2lzdGVuY2VDYXBh\nYmxlLmNsYXNzLAogICAgICAgICAgICAgICAgUFJFICsgIk5ld09iamVjdElk\nSW5zdGFuY2UiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAK\nICAgICAgICBpbnQgb2lkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKG9pZCk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIGlmbnVsbDIgPSBjb2RlLmlmbnVsbCgpOyAKCiAgICAgICAgLy8g\nZm9yIGRhdGFzdG9yZSAvIHNpbmdsZS1maWVsZCBpZGVudGl0eToKICAgICAg\nICAvLyBpZiAodmFsICE9IG51bGwpCiAgICAgICAgLy8gICB2YWwgPSAoKE9w\nZW5KUEFJZCkgdmFsKS5nZXRJZCgpOwogICAgICAgIENsYXNzTWV0YURhdGEg\ncGttZXRhID0gcGsuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBpbnQgcGtjb2RlID0gcGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCk7\nCiAgICAgICAgQ2xhc3MgcGt0eXBlID0gcGsuZ2V0T2JqZWN0SWRGaWVsZFR5\ncGUoKTsKICAgICAgICBpZiAocGttZXRhLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFIAogICAgICAgICAgICAmJiBw\na2NvZGUgPT0gSmF2YVR5cGVzLkxPTkcpIHsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShJZC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChJZC5jbGFzcywgImdldElkIiwgCiAg\nICAgICAgICAgICAgICBsb25nLmNsYXNzLCBudWxsKTsKICAgICAgICB9IGVs\nc2UgaWYgKHBrbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLklEX0RBVEFTVE9SRSkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwob2lkKTsKICAgICAgICB9IGVsc2UgaWYgKHBrbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIHN3aXRjaCAocGtjb2Rl\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKEJ5dGUu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEJ5dGVJZC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJ5\ndGVJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nYnl0ZS5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBr\nY29kZSA9PSBKYXZhVHlwZXMuQllURV9PQkopCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChCeXRlLmNs\nYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtieXRlLmNsYXNzfSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXco\nKS5zZXRUeXBlKENoYXJhY3Rlci5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVh\nawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2hh\ncklkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoQ2hhcklkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBjaGFyLmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5DSEFSX09C\nSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKENoYXJhY3Rlci5jbGFzcywgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW10ge2NoYXIuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShEb3VibGUu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRG91YmxlSWQuY2xhc3MpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChEb3VibGVJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgZG91YmxlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5ET1VCTEVfT0JKKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoRG91YmxlLmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtkb3VibGUuY2xh\nc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKEZsb2F0LmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAg\nIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoRmxvYXRJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEZsb2F0SWQuY2xhc3Ms\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0LmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEph\ndmFUeXBlcy5GTE9BVF9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChGbG9hdC5jbGFzcywgIjxp\nbml0PiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117ZmxvYXQuY2xhc3N9KTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZShJbnRlZ2VyLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEludElkLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoSW50SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuSU5UX09CSikKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKElu\ndGVnZXIuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2ludC5jbGFzc30pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZShMb25nLmNsYXNzKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShM\nb25nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChMb25nSWQuY2xhc3MsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkxPTkdf\nT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoTG9uZy5jbGFzcywgIjxpbml0PiIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nbG9uZy5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAg\nICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoU2hvcnQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShTaG9ydElkLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoU2hvcnRJ\nZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2hv\ncnQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2Nv\nZGUgPT0gSmF2YVR5cGVzLlNIT1JUX09CSikKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKFNob3J0LmNs\nYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtzaG9ydC5jbGFzc30pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuREFURToKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUoRGF0ZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRGF0ZUlkLmNs\nYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBEYXRlLmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGt0eXBlICE9\nIERhdGUuY2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gamF2\nYS5zcWwuRGF0ZS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUocGt0eXBlKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFN0cmluZ0lkLmNsYXNz\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoU3RyaW5nSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CSUdERUNJTUFMOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShCaWdEZWNpbWFsSWQuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChC\naWdEZWNpbWFsSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIEJpZ0RlY2ltYWwuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQklHSU5URUdFUjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUoQmlnSW50ZWdlcklkLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQmln\nSW50ZWdlcklkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAg\nICAgICBCaWdJbnRlZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9iamVj\ndElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHBrbWV0YS5nZXRPYmpl\nY3RJZFR5cGUoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICBpZiAocGtjb2RlID09IEph\ndmFUeXBlcy5PQkpFQ1QpIHsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xh\nc3MsICJnZXRJZCIsIAogICAgICAgICAgICAJCQlPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICB9IAogICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUocGt0eXBlKTsKICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIGdvMiA9IGNvZGUuZ28yKCk7CgogICAgICAgIC8vIGlmICh2\nYWwgPT0gbnVsbCkKICAgICAgICAvLyAgIHZhbCA9IDxkZWZhdWx0PjsKICAg\nICAgICBJbnN0cnVjdGlvbiBkZWY7CiAgICAgICAgc3dpdGNoIChwa2NvZGUp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmYWxz\nZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSgoYnl0ZSkgMCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoY2hh\ncikgMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgZGVmID0gY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBk\nZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEwpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JU\nOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKChzaG9ydCkgMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29u\nc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgfQogICAgICAgIGlmbnVsbDEu\nc2V0VGFyZ2V0KGRlZik7CiAgICAgICAgaWZudWxsMi5zZXRUYXJnZXQoZGVm\nKTsKICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNDb3B5S2V5RmllbGRz\nRnJvbU9iamVjdElkPC9jb2RlPiBtZXRob2RzCiAgICAgKiB0byBjbGFzc2Vz\nIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50aXR5LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZE1ldGhvZChi\nb29sZWFuIGZpZWxkTWFuYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlL\nZXlGaWVsZHNGcm9tT2JqZWN0SWQgKE9iamVjdElkRmllbGRDb25zdW1lciBm\nYywKICAgICAgICAvLwlPYmplY3Qgb2lkKQogICAgICAgIFN0cmluZ1tdIGFy\nZ3MgPSAoZmllbGRNYW5hZ2VyKSAKICAgICAgICAgICAgPyAgbmV3IFN0cmlu\nZ1tdeyBPSURGQ1RZUEUuZ2V0TmFtZSgpLCBPYmplY3QuY2xhc3MuZ2V0TmFt\nZSgpIH0KICAgICAgICAgICAgOiBuZXcgU3RyaW5nW117IE9iamVjdC5jbGFz\ncy5nZXROYW1lKCkgfTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJ\nZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAg\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLCB2\nb2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZmllbGRNYW5hZ2VyKQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CgogICAgICAgIGlmICghX21ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgp\nKSB7CiAgICAgICAgICAgIC8vIG9pZCA9ICgoT2JqZWN0SWQpIGlkKS5nZXRJ\nZCAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9i\namVjdElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICB9CgogICAg\nICAgIC8vIDxvaWQgdHlwZT4gY2FzdCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAg\nICAgICAgaW50IGlkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwog\nICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAv\nLyBmcy5zdG9yZTx0eXBlPkZpZWxkICg8aW5kZXg+LCBpZC48ZmllbGQ+KTsg\nb3IuLi4KICAgICAgICAvLyB0aGlzLjxmaWVsZD4gPSBpZC48ZmllbGQ+CiAg\nICAgICAgLy8gb3IgZm9yIHNpbmdsZSBmaWVsZCBpZGVudGl0eTogaWQuZ2V0\nSWQgKCkKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0\nZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6\nIF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgU3RyaW5nIG5h\nbWU7CiAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAgICBDbGFzcyB1bndyYXBw\nZWQ7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgTWV0aG9kIGdldHRl\ncjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgp\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBuYW1l\nID0gZm1kc1tpXS5nZXROYW1lKCk7CiAgICAgICAgICAgIHR5cGUgPSBmbWRz\nW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAgICAgICAgICAgIGlmICgh\nZmllbGRNYW5hZ2VyIAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKSB7CiAgICAgICAg\nICAgICAgICAvLyBpZiAoc20gPT0gbnVsbCkgcmV0dXJuOwogICAgICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmbm9ubnVsbCgpOwogICAgICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgICAgICAgICAvLyBzbS5nZXRQQ1ByaW1hcnlLZXkob2lk\nLCBpICsgcGNJbmhlcml0ZWRGaWVsZENvdW50KTsgCiAgICAgICAgICAgICAg\nICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8gbGVhdmUg\nb3JpZyBvbiBzdGFjayB0byBzZXQgdmFsdWUgaW50bwogICAgICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAg\nICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwg\naW50LmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nU3RhdGVNYW5hZ2VyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAiZ2V0\nUENQcmltYXJ5S2V5IiwgT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNzIH0p\nOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICB9IGVsc2Ug\neyAKICAgICAgICAgICAgICAgIHVud3JhcHBlZCA9IChmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIAogICAgICAgICAg\nICAgICAgICAgID8gdHlwZSA6IHVud3JhcFNpbmdsZUZpZWxkSWRlbnRpdHko\nZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShpKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKCiAgICAgICAgICAgICAgICBpZiAodW53cmFwcGVkICE9IHR5cGUpIHsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\naWQpOwogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50\naXR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2lkVHlwZSA9PSBP\nYmplY3RJZC5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgImdldElkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2Vy\nICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAob2lkVHlwZSA9PSBEYXRlSWQuY2xhc3MpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5\ncGUsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRl\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFm\naWVsZE1hbmFnZXIgJiYgdHlwZSAhPSBEYXRlLmNsYXNzKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHVud3JhcHBlZCwgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlwZSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgdW53cmFw\ncGVkIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0gZWxzZSBpZiAoaXNGaWVsZEFjY2VzcyhmbWRzW2ldKSkgewogICAgICAg\nICAgICAgICAgICAgIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lk\nVHlwZSwgbmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKE1v\nZGlmaWVyLmlzUHVibGljKGZpZWxkLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGZp\nZWxkKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5nZXRYWFgob2lkLCBSZWZsZWN0\naW9uLmZpbmRGaWVsZCguLi4pKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShu\nYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChn\nZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIEZpZWxkLmNsYXNzKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2\nZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgZ2V0dGVyID0gUmVmbGVjdGlvbi5maW5k\nR2V0dGVyKG9pZFR5cGUsIG5hbWUsIHRydWUpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChNb2RpZmllci5pc1B1YmxpYyhnZXR0ZXIuZ2V0TW9kaWZpZXJz\nKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoZ2V0dGVyKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5n\nZXRYWFgob2lkLCBSZWZsZWN0aW9uLmZpbmRHZXR0ZXIoLi4uKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENs\nYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qo\nUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICJmaW5kR2V0dGVyIiwgTWV0aG9kLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5n\nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2Qo\ndHlwZSwgTWV0aG9kLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNs\nYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKGZpZWxkTWFuYWdlcikKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKGdldEZpZWxkQ29uc3VtZXJNZXRob2QodHlw\nZSkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhZGRTZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgIH0KICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gaWYgdGhlIGNsYXNzIHVz\nZXMgdGhlIENsYXNzL1N0cmluZyBjb25zdHJ1Y3RvcgogICAgICogaW5zdGVh\nZCBvZiBqdXN0IFN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBCb29sZWFu\nIHVzZXNDbGFzc1N0cmluZ0lkQ29uc3RydWN0b3IoKSB7CiAgICAgICAgaWYg\nKF9tZXRhLmdldElkZW50aXR5VHlwZSgpICE9IENsYXNzTWV0YURhdGEuSURf\nQVBQTElDQVRJT04pCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNF\nOwoKICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewog\nICAgICAgICAgICBpZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2Jq\nZWN0SWQuY2xhc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9CgogICAg\nICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBvaWRUeXBlLmdldENvbnN0cnVj\ndG9yKG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzIH0p\nOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgfQogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIG9pZFR5cGUuZ2V0Q29uc3RydWN0b3IobmV3IENsYXNz\nW117IFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0aGUgZ2l2ZW4gZmllbGQgaXMgYSB3cmFwcGVyLXR5cGUgc2lu\nZ2xlIGZpZWxkIGlkZW50aXR5IHByaW1hcnkga2V5LAogICAgICogcmV0dXJu\nIGl0cyBjb3JyZXNwb25kaW5nIHByaW1pdGl2ZSBjbGFzcy4gRWxzZSByZXR1\ncm4gdGhlIGZpZWxkIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3Mg\ndW53cmFwU2luZ2xlRmllbGRJZGVudGl0eShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIGlmICghZm1kLmdldERlZmluaW5nTWV0YURhdGEoKS5pc09w\nZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICByZXR1cm4gZm1kLmdldERl\nY2xhcmVkVHlwZSgpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRV9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gYnl0ZS5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAg\nICAgICByZXR1cm4gY2hhci5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBkb3Vi\nbGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09C\nSjoKICAgICAgICAgICAgICAgIHJldHVybiBmbG9hdC5jbGFzczsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBpbnQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBzaG9ydC5jbGFz\nczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbG9uZy5jbGFzczsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBwcm9wZXIgZ2V0dGVyIG1ldGhvZCBvZiB0aGUge0BsaW5rIFJlZmxl\nY3Rpb259IGhlbHBlciBmb3IKICAgICAqIGEgZmllbGQgb3IgZ2V0dGVyIG1l\ndGhvZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBN\nZXRob2QgZ2V0UmVmbGVjdGlvbkdldHRlck1ldGhvZChDbGFzcyB0eXBlLCBD\nbGFzcyBhcmdUeXBlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIFN0cmluZyBuYW1lID0gImdldCI7CiAgICAgICAg\naWYgKHR5cGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgbmFtZSArPSBT\ndHJpbmdVdGlscy5jYXBpdGFsaXplKHR5cGUuZ2V0TmFtZSgpKTsKICAgICAg\nICByZXR1cm4gUmVmbGVjdGlvbi5jbGFzcy5nZXRNZXRob2QobmFtZSwgbmV3\nIENsYXNzW10geyBPYmplY3QuY2xhc3MsIAogICAgICAgICAgICBhcmdUeXBl\nIH0pOyAKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVy\nIGZldGNoIG1ldGhvZCBvZiB0aGUgT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZv\ncgogICAgICogYSBmaWVsZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBNZXRob2QgZ2V0RmllbGRTdXBwbGllck1ldGhvZChDbGFz\ncyB0eXBlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBnZXRNZXRob2QoT0lERlNUWVBFLCB0eXBlLCAi\nZmV0Y2giLCB0cnVlLCBmYWxzZSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBwcm9wZXIgZmV0Y2ggbWV0aG9kIG9mIHRoZSBP\nYmplY3RJZEZpZWxkQ29uc3VtZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9mIHRo\nZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRG\naWVsZENvbnN1bWVyTWV0aG9kKENsYXNzIHR5cGUpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1l\ndGhvZChPSURGQ1RZUEUsIHR5cGUsICJzdG9yZSIsIGZhbHNlLCBmYWxzZSwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgcGNOZXdP\nYmplY3RJZEluc3RhbmNlIG1ldGhvZCB0byBjbGFzc2VzIHVzaW5nCiAgICAg\nKiBhcHBsaWNhdGlvbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZE5ld09iamVjdElkSW5zdGFuY2VNZXRob2QoYm9vbGVhbiBvYmop\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gcHVibGljIE9iamVjdCBwY05ld09iamVjdElkSW5zdGFuY2UgKCkK\nICAgICAgICBDbGFzc1tdIGFyZ3MgPSAob2JqKSA/IG5ldyBDbGFzc1tdeyBP\nYmplY3QuY2xhc3MgfSA6IG51bGw7CiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFu\nY2UiLAogICAgICAgICAgICBPYmplY3QuY2xhc3MsIGFyZ3MpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBC\nb29sZWFuIHVzZXNDbHNTdHJpbmcgPSB1c2VzQ2xhc3NTdHJpbmdJZENvbnN0\ncnVjdG9yKCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9i\namVjdElkVHlwZSgpOwogICAgICAgIGlmIChvYmogJiYgdXNlc0Nsc1N0cmlu\nZyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24gKC4uLik7CiAgICAgICAgICAgIFN0cmluZyBt\nc2cgPSBfbG9jLmdldCgic3RyLWNvbnMiLCBvaWRUeXBlLAogICAgICAgICAg\nICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKS5nZXRNZXNzYWdlKCk7\nCiAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG1zZyk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChJbGxl\nZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MsCiAgICAgICAgICAgICAgICAi\nPGluaXQ+Iiwgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IFN0cmluZy5jbGFz\ncyB9KTsKICAgICAgICAgICAgY29kZS5hdGhyb3coKTsKICAgICAgICAgICAg\nY29kZS52cmV0dXJuKCk7CgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlm\nICghX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVj\ndElkVHlwZVNoYXJlZCgpKSB7CiAgICAgICAgICAgIC8vIG5ldyBPYmplY3RJ\nZCAoY2xzLCBvaWQpCiAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBpZihfbWV0YS5pc0VtYmVkZGVkT25seSgpIHx8IF9tZXRhLmhh\nc0Fic3RyYWN0UEtGaWVsZCgpID09IHRydWUpIHsKICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldElET3duaW5n\nQ2xhc3MiLAogICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBudWxs\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvZGUu\nY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5cGUoX21ldGEpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbmV3IDxvaWQgY2xh\nc3M+ICgpOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUob2lkVHlwZSk7\nCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBpZiAoX21ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSB8fCAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0KICAg\nICAgICAgICAgICAgICAgICBCb29sZWFuLlRSVUUpKSB7CiAgICAgICAgICAg\nIGlmKF9tZXRhLmlzRW1iZWRkZWRPbmx5KCkgfHwgX21ldGEuaGFzQWJzdHJh\nY3RQS0ZpZWxkKCkgPT0gdHJ1ZSApIHsKICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldElET3duaW5nQ2xhc3Mi\nLAogICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGlmIChvYmopIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICAgICAg\naWYgKHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAg\nICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5n\nLmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UgaWYgKHVzZXNDbHNTdHJpbmcg\nPT0gQm9vbGVhbi5GQUxTRSkKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcg\nQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH07CiAgICAgICAgfSBlbHNlIGlmIChf\nbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIC8vIG5l\ndyA8dHlwZT5JZGVudGl0eSAoWFhYLmNsYXNzLCA8cGs+KTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGEgcGsgPSBfbWV0YS5nZXRQcmltYXJ5S2V5Rmll\nbGRzKClbMF07CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgcGspOwogICAgICAgICAgICBpZiAocGsuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAgIGFkZEV4\ndHJhY3RPYmplY3RJZEZpZWxkVmFsdWVDb2RlKGNvZGUsIHBrKTsKICAgICAg\nICAgICAgaWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElk\nLmNsYXNzKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBD\nbGFzcy5jbGFzcywgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGVsc2Ug\naWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IERhdGUuY2xhc3MpCiAg\nICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNz\nLCBEYXRlLmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIHBrLmdldE9i\namVjdElkRmllbGRUeXBlKCkgfTsKICAgICAgICB9CgogICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgYXJncyk7CiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5K\nUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkp\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChP\nYmplY3RJZC5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIGNvbW11bmlj\nYXRpbmcgd2l0aCB0aGUgU3RhdGVNYW5hZ2VyLCBtYW55IG1ldGhvZHMgYXJl\nIHVzZWQKICAgICAqIGRlcGVuZGluZyBvbiB0aGUgY2xhc3Mgb2Ygc3RhdGUg\nYmVpbmcgcGFzc2VkLiBUaGlzIG1ldGhvZCwKICAgICAqIGdpdmVuIHRoZSB0\neXBlIG9mIGluZm9ybWF0aW9uIGJlaW5nIHBhc3NlZCBhbmQgdGhlIHByZWZp\neAogICAgICogKCdwcm92aWRlZCcsICdyZXBsYWNlJywgZXRjKSBvZiB0aGUg\nbWV0aG9kIHRvCiAgICAgKiBjYWxsLCByZXR1cm5zIHRoZSBTdGF0ZU1hbmFn\nZXIgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKgogICAgICog\nQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAg\nICAgKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0\nbyBjYWxsOyBhbGwgbWV0aG9kcwogICAgICogZW5kIGluICdbc3RhdGUgdHlw\nZV1GaWVsZCc7IG9ubHkgdGhlIHByZWZpeCB2YXJpZXMKICAgICAqIEBwYXJh\nbSBnZXQgdHJ1ZSBpZiByZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUK\nICAgICAqIFN0YXRlTWFuYWdlciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0\naGUgU00KICAgICAqIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJy\nZW50IHN0YXRlIHZhbHVlIGlzIHBhc3NlZCB0bwogICAgICogdGhlIFN0YXRl\nTWFuYWdlciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICovCiAgICBwcml2\nYXRlIE1ldGhvZCBnZXRTdGF0ZU1hbmFnZXJNZXRob2QoQ2xhc3MgdHlwZSwg\nU3RyaW5nIHByZWZpeCwKICAgICAgICBib29sZWFuIGdldCwgYm9vbGVhbiBj\ndXJWYWx1ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9kKFNNVFlQRSwgdHlwZSwgcHJl\nZml4LCBnZXQsIHRydWUsIGN1clZhbHVlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0aG9kIG9mIHRoZSBnaXZlbiBvd25lciB0eXBl\nIG1hdGNoaW5nIHRoZSBnaXZlbiBjcml0ZXJpYS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAg\nICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRv\nIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBl\nXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFt\nIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQog\nICAgICogb3duZXIsIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhlIG93bmVy\nCiAgICAgKiBAcGFyYW0gaGFzcGMgdHJ1ZSBpZiB0aGUgcGMgaXMgcGFzc2Vk\nIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKiBAcGFyYW0gY3VyVmFsdWUg\ndHJ1ZSBpZiB0aGUgY3VycmVudCBzdGF0ZSB2YWx1ZSBpcyBwYXNzZWQgdG8K\nICAgICAqIHRoZSBvd25lciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICov\nCiAgICBwcml2YXRlIE1ldGhvZCBnZXRNZXRob2QoQ2xhc3Mgb3duZXIsIENs\nYXNzIHR5cGUsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgYm9vbGVhbiBnZXQs\nIGJvb2xlYW4gaGFzcGMsIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWxsIG1l\ndGhvZHMgZW5kIGluIFtmaWVsZCB0eXBlXUZpZWxkLCB3aGVyZSB0aGUgZmll\nbGQgdHlwZQogICAgICAgIC8vIGNhbiBiZSBhbnkgb2YgdGhlIHByaW1pdHZl\nIHR5cGVzIChidXQgY2FwaXRhbGl6ZWQpLCAnU3RyaW5nJywKICAgICAgICAv\nLyBvciAnT2JqZWN0JzsgZmlndXJlIG91dCB3aGF0IHR5cGUgdG8gdXNlCiAg\nICAgICAgU3RyaW5nIHR5cGVOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAg\nICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgdHlwZU5h\nbWUgPSB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoTG9j\nYWxlLkVOR0xJU0gpCiAgICAgICAgICAgICAgICArIHR5cGVOYW1lLnN1YnN0\ncmluZygxKTsKICAgICAgICBlbHNlIGlmICh0eXBlLmVxdWFscyhTdHJpbmcu\nY2xhc3MpKQogICAgICAgICAgICB0eXBlTmFtZSA9ICJTdHJpbmciOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICB0eXBlTmFtZSA9ICJPYmplY3QiOwog\nICAgICAgICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdGhlIGZpZWxkIGluZGV4IGlzIGFsd2F5cyBwYXNzZWQgYXMg\nYW4gYXJnOyB0aGUgcGMgaW5zdGFuY2UgYW5kCiAgICAgICAgLy8gdGhlIGN1\ncnJlbnQgdmFsdWUgbWF5IGJlIHBhc3NlZDsgaWYgc2V0dGluZyB0aGUgbmV3\nIHZhbHVlIGlzCiAgICAgICAgLy8gYWxzbyBwYXNzZWQKICAgICAgICBMaXN0\nIHBsaXN0ID0gbmV3IEFycmF5TGlzdCg0KTsKICAgICAgICBpZiAoaGFzcGMp\nCiAgICAgICAgICAgIHBsaXN0LmFkZChQQ1RZUEUpOwogICAgICAgIHBsaXN0\nLmFkZChpbnQuY2xhc3MpOwogICAgICAgIGlmICghZ2V0IHx8IGN1clZhbHVl\nKQogICAgICAgICAgICBwbGlzdC5hZGQodHlwZSk7CiAgICAgICAgaWYgKCFn\nZXQgJiYgY3VyVmFsdWUpIHsKICAgICAgICAgICAgcGxpc3QuYWRkKHR5cGUp\nOwogICAgICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAgICAgICB9\nCgogICAgICAgIC8vIHVzZSByZWZsZWN0aW9uIHRvIHJldHVybiB0aGUgcmln\naHQgbWV0aG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBwcmVmaXggKyB0eXBl\nTmFtZSArICJGaWVsZCI7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAoQ2xh\nc3NbXSkgcGxpc3QudG9BcnJheShuZXcgQ2xhc3NbcGxpc3Quc2l6ZSgpXSk7\nCiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24ob3duZXIs\nIG5hbWUsIHBhcmFtcykpOwogICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAgICAgICAgICB0aHJvdyAoTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uKSBwYWUuZ2V0RXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBh\nZGQgdGhlIGNvZGUgbmVjZXNzYXJ5IHRvIHRocm93IHRoZSBnaXZlbgogICAg\nICogZXhjZXB0aW9uIHR5cGUsIHNhbnMgbWVzc2FnZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBJbnN0cnVjdGlvbiB0aHJvd0V4Y2VwdGlvbihDb2RlIGNvZGUs\nIENsYXNzIHR5cGUpIHsKICAgICAgICBJbnN0cnVjdGlvbiBpbnMgPSBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7CiAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8\naW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICBjb2RlLmF0aHJv\ndygpOwogICAgICAgIHJldHVybiBpbnM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW50ZXJmYWNlIHRvIHRo\nZSBjbGFzcyBiZWluZwogICAgICogZW5oYW5jZWQsIGFuZCBhZGRzIGEgZGVm\nYXVsdCBjb25zdHJ1Y3RvciBmb3IgdXNlIGJ5IE9wZW5KUEEKICAgICAqIGlm\nIGl0IGlzIG5vdCBhbHJlYWR5IHByZXNlbnQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBlbmhhbmNlQ2xhc3MoKSB7CiAgICAgICAgLy8gbWFrZSB0aGUg\nY2xhc3MgaW1wbGVtZW50IFBlcnNpc3RlbmNlQ2FwYWJsZQogICAgICAgIF9w\nYy5kZWNsYXJlSW50ZXJmYWNlKFBDVFlQRSk7CgogICAgICAgIC8vIGFkZCBh\nIHZlcnNpb24gc3RhbXAKICAgICAgICBhZGRHZXRFbmhhbmNlbWVudENvbnRy\nYWN0VmVyc2lvbk1ldGhvZCgpOwoKICAgICAgICAvLyBmaW5kIHRoZSBkZWZh\ndWx0IGNvbnN0cnVjdG9yCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3Bj\nLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4iLCAoU3RyaW5nW10pIG51bGwp\nOwoKICAgICAgICAvLyBhIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcmVxdWly\nZWQKICAgICAgICBpZiAobWV0aG9kID09IG51bGwpIHsKICAgICAgICAgICAg\nU3RyaW5nIG5hbWUgPSBfcGMuZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAo\nIV9kZWZDb25zKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoImVuaGFuY2UtZGVmYXVsdGNvbnN0IiwgbmFtZSkp\nOwoKICAgICAgICAgICAgbWV0aG9kID0gX3BjLmFkZERlZmF1bHRDb25zdHJ1\nY3RvcigpOwogICAgICAgICAgICBTdHJpbmcgYWNjZXNzOwogICAgICAgICAg\nICBpZiAoX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgICAg\nIC8vIGV4dGVybmFsaXphYmxlIHJlcXVpcmVzIHRoYXQgdGhlIGNvbnN0cnVj\ndG9yCiAgICAgICAgICAgICAgICAvLyBiZSBwdWJsaWMsIHNvIG1ha2UgdGhl\nIGFkZGVkIGNvbnN0cnVjdG9yIHB1YmxpYwogICAgICAgICAgICAgICAgbWV0\naG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJw\ndWJsaWMiOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9wYy5pc0ZpbmFsKCkp\nIHsKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAg\nICAgICAgICAgICAgYWNjZXNzID0gInByaXZhdGUiOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQo\nKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJwcm90ZWN0ZWQiOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmICghKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS5pc0ludGVyZmFjZSgpIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkp\nCiAgICAgICAgICAgICAgICAmJiBfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS1hZGRk\nZWZhdWx0Y29uc3QiLCBuYW1lLCBhY2Nlc3MpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBmb2xsb3dpbmcgZmllbGRzIHRv\nIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2U6CiAgICAgKiA8dWw+\nCiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgaW50IHBjSW5oZXJp\ndGVkRmllbGRDb3VudDwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnBy\naXZhdGUgc3RhdGljIENsYXNzIHBjUENTdXBlcmNsYXNzPC9jb2RlPgogICAg\nICogPC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBTdHJp\nbmdbXSBwY0ZpZWxkTmFtZXM8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29k\nZT5wcml2YXRlIHN0YXRpYyBDbGFzc1tdIHBjRmllbGRUeXBlczwvY29kZT48\nL2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIGJ5dGVbXSBw\nY0ZpZWxkRmxhZ3M8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5wcm90\nZWN0ZWQgdHJhbnNpZW50IFN0YXRlTWFuYWdlciBwY1N0YXRlTWFuYWdlcjwv\nY29kZT4KICAgICAqIGlmIG5vIFBlcnNpc3RlbmNlQ2FwYWJsZSBzdXBlcmNs\nYXNzIHByZXNlbnQpPC9saT4KICAgICAqIDwvdWw+CiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRGaWVsZHMoKSB7CiAgICAgICAgX3BjLmRlY2xhcmVG\naWVsZChJTkhFUklULCBpbnQuY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAg\nICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3Ry\naW5nW10uY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBfcGMuZGVj\nbGFyZUZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3NbXS5jbGFzcyku\nc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoUFJF\nICsgIkZpZWxkRmxhZ3MiLCBieXRlW10uY2xhc3MpLnNldFN0YXRpYyh0cnVl\nKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFNVUEVSLCBDbGFzcy5jbGFz\ncykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIGlmIChfYWRkVmVyc2lvbklu\naXRGbGFnICYmIF9tZXRhLmdldFZlcnNpb25GaWVsZCgpICE9IG51bGwpIHsK\nICAgICAgICAgICAgLy8gcHJvdGVjdGVkIHRyYW5zaWVudCBib29sZWFuIHBj\nVmVyc2lvbkluaXQ7CiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMu\nZGVjbGFyZUZpZWxkKFZFUlNJT05fSU5JVF9TVFIsIGJvb2xlYW4uY2xhc3Mp\nOwogICAgICAgICAgICBmaWVsZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAg\nICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwgfHwgZ2V0\nQ3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxk\nID0gX3BjLmRlY2xhcmVGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAg\nZmllbGQubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBmaWVsZC5zZXRU\ncmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogTW9kaWZpZXMgdGhlIGNsYXNzIGluaXRpYWxpemF0aW9uIG1ldGhvZCAo\nY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2FyeSkKICAgICAqIHRvIGluaXRpYWxp\nemUgdGhlIHN0YXRpYyBmaWVsZHMgb2YgdGhlIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBpbnN0YW5jZSBhbmQKICAgICAqIHRvIHJlZ2lzdGVyIGl0IHdpdGggdGhl\nIGltcGwgaGVscGVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3Rh\ndGljSW5pdGlhbGl6ZXIoKSB7CiAgICAgICAgQ29kZSBjb2RlID0gZ2V0T3JD\ncmVhdGVDbGFzc0luaXRDb2RlKHRydWUpOwogICAgICAgIGlmIChfbWV0YS5n\nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChn\nZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAgICBjb2RlLnB1\ndHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBwY0luaGVyaXRl\nZEZpZWxkQ291bnQgPSA8c3VwZXJDbGFzcz4ucGNHZXRNYW5hZ2VkRmllbGRD\nb3VudCgpCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgICAgIGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZpZWxkQ291bnQiLCBpbnQu\nY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAgICAgICAgIGNvZGUu\ncHV0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGNQQ1N1cGVyY2xhc3MgPSA8\nc3VwZXJDbGFzcz47CiAgICAgICAgICAgIC8vIHRoaXMgaW50ZW50aW9uYWxs\neSBjYWxscyBnZXREZXNjcmliZWRUeXBlKCkgZGlyZWN0bHkKICAgICAgICAg\nICAgLy8gaW5zdGVhZCBvZiBQQ0VuaGFuY2VyLmdldFR5cGUoKQogICAgICAg\nICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcygKICAgICAgICAg\nICAgICAgIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5z\nZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3IFN0cmluZ1tdIHsgIjxuYW1lMT4i\nLCAiPG5hbWUyPiIsIC4uLiB9OwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNv\nZGUuYW5ld2FycmF5KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGNvZGUu\nYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0YXRpYygp\nLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3Mp\nOwoKICAgICAgICAvLyBwY0ZpZWxkVHlwZXMgPSBuZXcgQ2xhc3NbXSB7IDx0\neXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xhc3MsIC4uLiB9OwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAgICAg\nY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBlKENsYXNzLmNsYXNzKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3Rh\nbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAg\nICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIGNv\nZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBD\nbGFzc1tdLmNsYXNzKTsKCiAgICAgICAgLy8gcGNGaWVsZEZsYWdzID0gbmV3\nIGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFnMj4sIC4uLiB9OwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAgICAg\nY29kZS5uZXdhcnJheSgpLnNldFR5cGUoYnl0ZS5jbGFzcyk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGdldEZpZWxkRmxhZyhmbWRzW2ldKSk7CiAgICAgICAgICAgIGNv\nZGUuYmFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0YXRp\nYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNz\nKTsKCiAgICAgICAgLy8gUENSZWdpc3RyeS5yZWdpc3RlciAoY2xzLAogICAg\nICAgIC8vCXBjRmllbGROYW1lcywgcGNGaWVsZFR5cGVzLCBwY0ZpZWxkRmxh\nZ3MsCiAgICAgICAgLy8gIHBjUENTdXBlcmNsYXNzLCBhbGlhcywgbmV3IFhY\nWCAoKSk7CiAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mo\nX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10u\nY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoUFJF\nICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0\nZVtdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAgICAgICAgCiAgICAgICAgaWYgKF9t\nZXRhLmlzTWFwcGVkKCkgfHwgX21ldGEuaXNBYnN0cmFjdCgpKQogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoX21ldGEuZ2V0VHlwZUFs\naWFzKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldE51bGwoKTsKCiAgICAgICAgaWYgKF9wYy5pc0Fic3RyYWN0KCkp\nCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX3Bj\nKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNz\nLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3RhdGlj\nKCkuc2V0TWV0aG9kKEhFTFBFUlRZUEUsICJyZWdpc3RlciIsIHZvaWQuY2xh\nc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3Ry\naW5nW10uY2xhc3MsIENsYXNzW10uY2xhc3MsCiAgICAgICAgICAgICAgICBi\neXRlW10uY2xhc3MsIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIFBDVFlQ\nRSB9KTsKCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBmbGFnIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGJ5dGUgZ2V0RmllbGRGbGFnKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0g\nRmllbGRNZXRhRGF0YS5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0dXJu\nIC0xOwoKICAgICAgICBieXRlIGZsYWdzID0gMDsKICAgICAgICBpZiAoZm1k\nLmdldERlY2xhcmVkVHlwZSgpLmlzUHJpbWl0aXZlKCkKICAgICAgICAgICAg\nfHwgU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oZm1kLmdl\ndERlY2xhcmVkVHlwZSgpKSkKICAgICAgICAgICAgZmxhZ3MgPSBQZXJzaXN0\nZW5jZUNhcGFibGUuU0VSSUFMSVpBQkxFOwoKICAgICAgICBpZiAoZm1kLmdl\ndE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9UUkFOU0FD\nVElPTkFMKQogICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFi\nbGUuQ0hFQ0tfV1JJVEU7CiAgICAgICAgZWxzZSBpZiAoIWZtZC5pc1ByaW1h\ncnlLZXkoKSAmJiAhZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAg\nICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfV1JJ\nVEUKICAgICAgICAgICAgICAgIHwgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNL\nX1JFQUQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmbGFncyB8PSBQZXJz\naXN0ZW5jZUNhcGFibGUuTUVESUFURV9XUklURQogICAgICAgICAgICAgICAg\nfCBQZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFURV9SRUFEOwogICAgICAgIHJl\ndHVybiBmbGFnczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGNv\nZGUgdG8gcHJvcGVybHkgaGFuZGxlIFBlcnNpc3RlbmNlQ2FwYWJsZSBzZXJp\nYWxpemF0aW9uCiAgICAgKiB0byB0aGUgYnl0ZWNvZGUuIFRoaXMgaW5jbHVk\nZXMgY3JlYXRpbmcgYW5kIGluaXRpYWxpemluZyB0aGUKICAgICAqIHN0YXRp\nYyA8Y29kZT5zZXJpYWxWZXJzaW9uVUlEPC9jb2RlPiBjb25zdGFudCBpZiBu\nb3QgYWxyZWFkeSBkZWZpbmVkLAogICAgICogYXMgd2VsbCBhcyBjcmVhdGlu\nZyBhIGN1c3RvbSA8Y29kZT53cml0ZU9iamVjdDwvY29kZT4gbWV0aG9kIGlm\nIHRoZQogICAgICogY2xhc3MgaXMgU2VyaWFsaXphYmxlIGFuZCBkb2VzIG5v\ndCBkZWZpbmUgdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNl\ncmlhbGl6YXRpb25Db2RlKCkgewogICAgICAgIGlmIChleHRlcm5hbGl6ZURl\ndGFjaGVkKCkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5p\nc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNs\nYXNzKCkpIHsKICAgICAgICAgICAgLy8gIyMjIyMgd2hhdCBzaG91bGQgaGFw\ncGVuIGlmIGEgdHlwZSBpcyBFeHRlcm5hbGl6YWJsZT8gSXQgbG9va3MKICAg\nICAgICAgICAgLy8gIyMjIyMgbGlrZSBFeHRlcm5hbGl6YWJsZSBjbGFzc2Vz\nIHdpbGwgbm90IGJlIHNlcmlhbGl6ZWQgYXMgUENzCiAgICAgICAgICAgIC8v\nICMjIyMjIGJhc2VkIG9uIHRoaXMgbG9naWMuCiAgICAgICAgICAgIGlmICgh\nRXh0ZXJuYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgKICAgICAg\nICAgICAgICAgIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAg\nICAgICAgICBhZGRTdWJjbGFzc1NlcmlhbGl6YXRpb25Db2RlKCk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG5vdCBh\nbHJlYWR5IHByZXNlbnQsIGFkZCBhIHNlcmlhbFZlcnNpb25VSUQgZmllbGQ7\nIGlmIHRoZSBpbnN0YW5jZQogICAgICAgIC8vIGlzIGRldGFjaGFibGUgYW5k\nIHVzZXMgZGV0YWNoZWQgc3RhdGUgd2l0aG91dCBhIGRlY2xhcmVkIGZpZWxk\nLAogICAgICAgIC8vIGNhbid0IGFkZCBhIHNlcmlhbCB2ZXJzaW9uIFVJRCBi\nZWNhdXNlIHdlJ2xsIGJlIGFkZGluZyBleHRyYSBmaWVsZHMKICAgICAgICAv\nLyB0byB0aGUgZW5oYW5jZWQgdmVyc2lvbgogICAgICAgIEJDRmllbGQgZmll\nbGQgPSBfcGMuZ2V0RGVjbGFyZWRGaWVsZCgic2VyaWFsVmVyc2lvblVJRCIp\nOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsKSB7CiAgICAgICAgICAgIExv\nbmcgdWlkID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHVpZCA9IE9iamVjdFN0cmVhbUNsYXNzLmxvb2t1cAogICAgICAgICAg\nICAgICAgICAgIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpLmdldFNlcmlh\nbFZlcnNpb25VSUQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxl\nIHQpIHsKICAgICAgICAgICAgICAgIC8vIGxhc3QtY2hhbmNlIGNhdGNoIGZv\nciBidWcgIzI4MyAod2hpY2ggY2FuIGhhcHBlbgogICAgICAgICAgICAgICAg\nLy8gaW4gYSB2YXJpZXR5IG9mIENsYXNzTG9hZGluZyBlbnZpcm9ubWVudHMp\nCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5j\nZS11aWQtYWNjZXNzIiwgX21ldGEpLCB0KTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVu\naGFuY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIGlmIHdlIGNvdWxkbid0IGFjY2VzcyB0aGUgc2VyaWFs\nVmVyc2lvblVJRCwgd2Ugd2lsbCBoYXZlIHRvCiAgICAgICAgICAgIC8vIHNr\naXAgdGhlIG92ZXJyaWRlIG9mIHRoYXQgZmllbGQgYW5kIG5vdCBiZSBzZXJp\nYWxpemF0aW9uCiAgICAgICAgICAgIC8vIGNvbXBhdGlibGUgd2l0aCBub24t\nZW5oYW5jZWQgY2xhc3NlcwogICAgICAgICAgICBpZiAodWlkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZCgi\nc2VyaWFsVmVyc2lvblVJRCIsIGxvbmcuY2xhc3MpOwogICAgICAgICAgICAg\nICAgZmllbGQubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGZpZWxk\nLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAgICAgIGZpZWxkLnNldEZp\nbmFsKHRydWUpOwoKICAgICAgICAgICAgICAgIENvZGUgY29kZSA9IGdldE9y\nQ3JlYXRlQ2xhc3NJbml0Q29kZShmYWxzZSk7CiAgICAgICAgICAgICAgICBj\nb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUodWlkLmxvbmdWYWx1ZSgpKTsKICAgICAgICAgICAg\nICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoZmllbGQpOwoKICAgICAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHdyaXRlIG9iamVjdCBt\nZXRob2QKICAgICAgICBCQ01ldGhvZCB3cml0ZSA9IF9wYy5nZXREZWNsYXJl\nZE1ldGhvZCgid3JpdGVPYmplY3QiLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgIGJvb2xl\nYW4gZnVsbCA9IHdyaXRlID09IG51bGw7CiAgICAgICAgaWYgKGZ1bGwpIHsK\nICAgICAgICAgICAgLy8gcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0IChPYmpl\nY3RPdXRwdXRTdHJlYW0gb3V0KQogICAgICAgICAgICB3cml0ZSA9IF9wYy5k\nZWNsYXJlTWV0aG9kKCJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNs\nYXNzIH0pOwogICAgICAgICAgICB3cml0ZS5nZXRFeGNlcHRpb25zKHRydWUp\nLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIHdyaXRlLm1ha2VQcml2YXRlKCk7CiAgICAgICAgfQogICAgICAgIG1vZGlm\neVdyaXRlT2JqZWN0TWV0aG9kKHdyaXRlLCBmdWxsKTsKCiAgICAgICAgLy8g\nYW5kIHJlYWQgb2JqZWN0CiAgICAgICAgQkNNZXRob2QgcmVhZCA9IF9wYy5n\nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsCiAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAg\nICBmdWxsID0gcmVhZCA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7CiAg\nICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0IChPYmplY3RJ\nbnB1dFN0cmVhbSBpbikKICAgICAgICAgICAgcmVhZCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKCJyZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFzcyB9KTsK\nICAgICAgICAgICAgcmVhZC5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2Vw\ndGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHJlYWQuZ2V0\nRXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAgICAgICAgICAgICAg\nIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAg\ncmVhZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2RpZnlS\nZWFkT2JqZWN0TWV0aG9kKHJlYWQsIGZ1bGwpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBhZGRTdWJjbGFzc1NlcmlhbGl6YXRpb25Db2RlKCkgewogICAg\nICAgIC8vIGZvciBnZW5lcmF0ZWQgc3ViY2xhc3Nlcywgc2VyaWFsaXphdGlv\nbiBtdXN0IHdyaXRlIGFuIGluc3RhbmNlIG9mCiAgICAgICAgLy8gdGhlIHN1\ncGVyY2xhc3MgaW5zdGVhZCBvZiB0aGUgc3ViY2xhc3MsIHNvIHRoYXQgdGhl\nIGNsaWVudCBWTSBjYW4KICAgICAgICAvLyBkZXNlcmlhbGl6ZSBzdWNjZXNz\nZnVsbHkuCgogICAgICAgIC8vIHByaXZhdGUgT2JqZWN0IHdyaXRlUmVwbGFj\nZSgpIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRpb24KICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVSZXBsYWNl\nIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2QuZ2V0RXhj\nZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oT2JqZWN0U3RyZWFtRXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29k\nZSh0cnVlKTsKCiAgICAgICAgLy8gT2JqZWN0IG8gPSBuZXcgPG1hbmFnZWQt\ndHlwZT4oKQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX21hbmFnZWRU\neXBlKTsgLy8gZm9yIHJldHVybgogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZv\nciBwb3N0LTxpbml0PiB3b3JrCiAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9y\nIDxpbml0PgogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhv\nZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLCAiPGluaXQ+IiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbnVsbCk7CgogICAgICAgIC8vIGNvcHkgYWxsIHRo\nZSBmaWVsZHMuCiAgICAgICAgLy8gIyMjIyMgbGltaXRpbmcgdG8gSlBBIEBU\ncmFuc2llbnQgbGltaXRhdGlvbnMKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIC8vIG8uPGZpZWxkPiA9IHRoaXMuPGZpZWxkPiAo\nb3IgcmVmbGVjdGl2ZSBhbmFsb2cpCiAgICAgICAgICAgIGNvZGUuZHVwKCk7\nIC8vIGZvciBwdXRmaWVsZAogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOyAvLyBmb3IgZ2V0ZmllbGQKICAgICAgICAgICAgZ2V0ZmllbGQo\nY29kZSwgX21hbmFnZWRUeXBlLCBmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIHB1dGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5n\nZXROYW1lKCksCiAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVk\nVHlwZSgpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuYXJldHVybigpLnNl\ndFR5cGUoT2JqZWN0LmNsYXNzKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBjbGFzcyBiZWlu\nZyBlbmhhbmNlZCBzaG91bGQgZXh0ZXJuYWxpemUgdG8gYSBkZXRhY2hlZAog\nICAgICogaW5zdGFuY2UgcmF0aGVyIHRoYW4gc2VyaWFsaXplLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gZXh0ZXJuYWxpemVEZXRhY2hlZCgpIHsK\nICAgICAgICByZXR1cm4gQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxz\nKF9tZXRhLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAgJiYgU2Vy\naWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKQogICAgICAgICAgICAmJiAhX3JlcG9zLmdldENvbmZp\nZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuCiAgICAgICAg\nICAgIGlzRGV0YWNoZWRTdGF0ZVRyYW5zaWVudCgpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkcyBhIGN1c3RvbSB3cml0ZU9iamVjdCBtZXRob2QgdGhh\ndCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxpbmsgT2JqZWN0T3V0cHV0\nU3RyZWFtI2RlZmF1bHRXcml0ZU9iamVjdH0gbWV0aG9kLAogICAgICogYnV0\nIG9ubHkgYWZ0ZXIgY2FsbGluZyB0aGUgaW50ZXJuYWwgPGNvZGU+cGNTZXJp\nYWxpemluZzwvY29kZT4gbWV0aG9kLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgbW9kaWZ5V3JpdGVPYmplY3RNZXRob2QoQkNNZXRob2QgbWV0aG9kLCBi\nb29sZWFuIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAg\nICAgIC8vIGJvb2wgY2xlYXIgPSBwY1NlcmlhbGl6aW5nICgpOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2VyaWFsaXpp\nbmciLAogICAgICAgICAgICBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAg\nICBpbnQgY2xlYXIgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoY2xlYXIpOwoKICAgICAgICBp\nZiAoZnVsbCkgewogICAgICAgICAgICAvLyBvdXQuZGVmYXVsdFdyaXRlT2Jq\nZWN0ICgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChP\nYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAiZGVm\nYXVsdFdyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgSW5zdHJ1\nY3Rpb24gdG1wbGF0ZSA9IChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigp\nKSkudnJldHVybigpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiB0b3JldDsK\nICAgICAgICBJbnN0cnVjdGlvbiByZXQ7CiAgICAgICAgY29kZS5iZWZvcmVG\naXJzdCgpOwogICAgICAgIHdoaWxlIChjb2RlLnNlYXJjaEZvcndhcmQodG1w\nbGF0ZSkpIHsKICAgICAgICAgICAgcmV0ID0gY29kZS5wcmV2aW91cygpOwog\nICAgICAgICAgICAvLyBpZiAoY2xlYXIpIHBjU2V0RGV0YWNoZWRTdGF0ZSAo\nbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChjbGVh\ncik7CiAgICAgICAgICAgIHRvcmV0ID0gY29kZS5pZmVxKCk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNldERldGFj\naGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgdG9yZXQuc2V0\nVGFyZ2V0KHJldCk7CiAgICAgICAgICAgIGNvZGUubmV4dCgpOyAvLyBqdW1w\nIG92ZXIgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGN1c3RvbSByZWFkT2Jq\nZWN0IG1ldGhvZCB0aGF0IGRlbGVnYXRlcyB0byB0aGUKICAgICAqIHtAbGlu\nayBPYmplY3RJbnB1dFN0cmVhbSNyZWFkT2JqZWN0fSBtZXRob2QuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBtb2RpZnlSZWFkT2JqZWN0TWV0aG9kKEJD\nTWV0aG9kIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5iZWZv\ncmVGaXJzdCgpOwoKICAgICAgICAvLyBpZiB0aGlzIGluc3RhbmNlIHVzZXMg\nc3ludGhldGljIGRldGFjaGVkIHN0YXRlLCBub3RlIHRoYXQgaXQgaGFzCiAg\nICAgICAgLy8gYmVlbiBkZXNlcmlhbGl6ZWQKICAgICAgICBpZiAoQ2xhc3NN\nZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3Rh\ndGUoKSkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLAogICAgICAgICAgICAgICAg\nIkRFU0VSSUFMSVpFRCIsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2V0RGV0YWNo\nZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKGZ1bGwpIHsKICAgICAgICAgICAgLy8gaW4uZGVmYXVsdFJlYWRPYmplY3Qg\nKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVj\ndElucHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAgICAgICAgImRlZmF1bHRS\nZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBwY0lzRGV0\nYWNoZWQoKSBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIGFuIGluc3RhbmNlCiAg\nICAgKiBpcyBkZXRhY2hlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZElzRGV0YWNoZWRNZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyBib29sZWFuIHBjSXNE\nZXRhY2hlZCgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIklzRGV0YWNoZWQiLAogICAgICAgICAgICBCb29s\nZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVB1YmxpYygp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGJvb2xlYW4gbmVlZHNEZWZpbml0aXZlTWV0aG9kID0gd3JpdGVJ\nc0RldGFjaGVkTWV0aG9kKGNvZGUpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgICAgIGlmICghbmVlZHNEZWZpbml0aXZlTWV0aG9kKSAKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBwcml2YXRlIGJvb2xlYW4gcGNJ\nc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlKCkKICAgICAgICAvLyAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAvLyBhdXhpbGxpYXJ5IGVuaGFuY2VycyBtYXkg\nY2hhbmdlIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhpcyBtZXRob2QKICAgICAg\nICAvLyBpZiB0aGVpciBzcGVjcyBjb25zaWRlciBkZXRhY2hlZCBzdGF0ZSBk\nZWZpbml0aXZlCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nSVNERVRBQ0hFRFNUQVRFREVGSU5JVElWRSwgYm9vbGVhbi5jbGFzcywKICAg\nICAgICAgICAgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7\nCiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgY29k\nZS5pcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBib2R5IG9mIHRoZSBwY0lzRGV0\nYWNoZWQoKSBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIGFuCiAgICAgKiBpbnN0\nYW5jZSBpcyBkZXRhY2hlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUg\naWYgd2UgbmVlZCBhIHBjSXNEZXRhY2hlZFN0YXRlRGVmaW5pdGl2ZSBtZXRo\nb2QsIGZhbHNlCiAgICAgKiBvdGhlcndpc2UKICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHdyaXRlSXNEZXRhY2hlZE1ldGhvZChDb2RlIGNvZGUpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gbm90IGRldGFjaGFibGU6IHJldHVybiBCb29sZWFuLkZBTFNFCiAgICAg\nICAgaWYgKCFfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICBj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxT\nRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4o\nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgLy8gICAgIHJldHVybiAo\nc20uaXNEZXRhY2hlZCAoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVs\nbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChT\nTVRZUEUsICJpc0RldGFjaGVkIiwKICAgICAgICAgICAgYm9vbGVhbi5jbGFz\ncywgbnVsbCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmZmFsc2UgPSBj\nb2RlLmlmZXEoKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgaWZmYWxzZS5zZXRUYXJnZXQo\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFM\nU0UiLAogICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CgogICAgICAgIC8vIGlmIHdlIHVzZSBkZXRhY2hlZCBz\ndGF0ZToKICAgICAgICAvLyBpZiAocGNHZXREZXRhY2hlZFN0YXRlICgpICE9\nIG51bGwKICAgICAgICAvLyAgICAgJiYgcGNHZXREZXRhY2hlZFN0YXRlICE9\nIERFU0VSSUFMSVpFRCkKICAgICAgICAvLyAgICAgcmV0dXJuIEJvb2xlYW4u\nVFJVRTsKICAgICAgICBCb29sZWFuIHN0YXRlID0gX21ldGEudXNlc0RldGFj\naGVkU3RhdGUoKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gbm90ZGVzZXIg\nPSBudWxsOwogICAgICAgIEluc3RydWN0aW9uIHRhcmdldDsKICAgICAgICBp\nZiAoc3RhdGUgIT0gQm9vbGVhbi5GQUxTRSkgewogICAgICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlm\nbnVsbCgpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLAog\nICAgICAgICAgICAgICAgIkRFU0VSSUFMSVpFRCIsIE9iamVjdC5jbGFzcyk7\nCiAgICAgICAgICAgIG5vdGRlc2VyID0gY29kZS5pZmFjbXBlcSgpOwogICAg\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xh\nc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwoKICAgICAgICAgICAgaWYgKHN0YXRlID09IEJvb2xlYW4u\nVFJVRSkgewogICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSB0byB1c2Ug\nZGV0YWNoZWQgc3RhdGU6CiAgICAgICAgICAgICAgICAvLyByZXR1cm4gQm9v\nbGVhbi5GQUxTRTsKICAgICAgICAgICAgICAgIHRhcmdldCA9IGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwKICAg\nICAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAg\nbm90ZGVzZXIuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIGFy\ndGlmaWNpYWwgdGFyZ2V0IHRvIHNpbXBsaWZ5CiAgICAgICAgdGFyZ2V0ID0g\nY29kZS5ub3AoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsK\nICAgICAgICBpZiAobm90ZGVzZXIgIT0gbnVsbCkKICAgICAgICAgICAgbm90\nZGVzZXIuc2V0VGFyZ2V0KHRhcmdldCk7CgogICAgICAgIC8vIGFsbG93IHVz\nZXJzIHdpdGggdmVyc2lvbiBvciBhdXRvLWFzc2lnbmVkIHBrIGZpZWxkcyB0\nbyBtYW51YWxseSAKICAgICAgICAvLyBjb25zdHJ1Y3QgYSAiZGV0YWNoZWQi\nIGluc3RhbmNlLCBzbyBjaGVjayB0aGVzZSBiZWZvcmUgdGFraW5nIGludG8g\nCiAgICAgICAgLy8gYWNjb3VudCBub24tZXhpc3RlbnQgZGV0YWNoZWQgc3Rh\ndGUKCiAgICAgICAgLy8gY29uc2lkZXIgZGV0YWNoZWQgaWYgdmVyc2lvbiBp\ncyBub24tZGVmYXVsdAogICAgICAgIEZpZWxkTWV0YURhdGEgdmVyc2lvbiA9\nIF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgIGlmIChzdGF0ZSAh\nPSBCb29sZWFuLlRSVUUgJiYgdmVyc2lvbiAhPSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIGlmICg8dmVyc2lvbj4gIT0gPGRlZmF1bHQ+KQogICAgICAgICAg\nICAvLwkJcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIHZlcnNpb24pOwogICAgICAgICAgICBpZmlucyA9\nIGlmRGVmYXVsdFZhbHVlKGNvZGUsIHZlcnNpb24pOwogICAgICAgICAgICBj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVF\nIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgICAgICBpZiAoIV9hZGRWZXJzaW9uSW5pdEZsYWcpewogICAg\nICAgICAgICAgICAgLy8gZWxzZSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKSk7CiAg\nICAgICAgICAgIH1lbHNleyAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg\nICAvLyBub29wCiAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29k\nZS5ub3AoKSk7CiAgICAgICAgICAgICAgICAvLyBpZiAocGNWZXJzaW9uSW5p\ndCAhPSBmYWxzZSkKICAgICAgICAgICAgICAgIC8vIHJldHVybiB0cnVlCiAg\nICAgICAgICAgICAgICAvLyBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgVkVSU0lPTl9JTklU\nX1NUUik7CiAgICAgICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZlcSgpOwog\nICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29s\nZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgICAgICBpZmlucy5z\nZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICAgICAgICAgICAgICBjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJv\nb2xlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbnNpZGVyIGRldGFj\naGVkIGlmIGF1dG8tZ2VubmVkIHByaW1hcnkga2V5cyBhcmUgbm9uLWRlZmF1\nbHQKICAgICAgICBpZmlucyA9IG51bGw7CiAgICAgICAgSnVtcEluc3RydWN0\naW9uIGlmaW5zMiA9IG51bGw7CiAgICAgICAgYm9vbGVhbiBoYXNBdXRvQXNz\naWduZWRQSyA9IGZhbHNlOwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFu\nLlRSVUUKICAgICAgICAgICAgJiYgX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikgewogICAgICAgICAg\nICAvLyBmb3IgZWFjaCBwayBmaWVsZDoKICAgICAgICAgICAgLy8gaWYgKDxw\naz4gIT0gPGRlZmF1bHQ+IFsmJiAhIiIuZXF1YWxzICg8cGs+KV0pCiAgICAg\nICAgICAgIC8vCQlyZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gcGtzID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxk\ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1\nZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdGFyZ2V0\nID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICBpZiAoaWZpbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlm\nIChpZmluczIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpZmluczIu\nc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZmluczIgPSBu\ndWxsOwoKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAgIGlmaW5zID0gaWZEZWZh\ndWx0VmFsdWUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChw\na3NbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5TVFJJ\nTkcpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoIiIpOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoU3RyaW5n\nLmNsYXNzLCAiZXF1YWxzIiwKICAgICAgICAgICAgICAgICAgICAgICAgYm9v\nbGVhbi5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICAgICAgICAgICAgICBpZmluczIgPSBjb2RlLmlmbmUoKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCku\nc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLAogICAgICAgICAgICAg\nICAgICAgIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8v\nIGNyZWF0ZSBhcnRpZmljaWFsIHRhcmdldCB0byBzaW1wbGlmeQogICAgICAg\nIHRhcmdldCA9IGNvZGUubm9wKCk7CiAgICAgICAgaWYgKGlmaW5zICE9IG51\nbGwpCiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAg\nICAgIGlmIChpZmluczIgIT0gbnVsbCkKICAgICAgICAgICAgaWZpbnMyLnNl\ndFRhcmdldCh0YXJnZXQpOwoKICAgICAgICAvLyBpZiBoYXMgYXV0by1hc3Np\nZ25lZCBwayBhbmQgd2UgZ2V0IHRvIHRoaXMgcG9pbnQsIG11c3QgaGF2ZSBk\nZWZhdWx0CiAgICAgICAgLy8gdmFsdWUsIHNvIG11c3QgYmUgbmV3IGluc3Rh\nbmNlCiAgICAgICAgaWYgKGhhc0F1dG9Bc3NpZ25lZFBLKSB7CiAgICAgICAg\nICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywg\nIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoK\nICAgICAgICAvLyBpZiBkZXRhY2hlZCBzdGF0ZSBpcyBub3QgZGVmaW5pdGl2\nZSwganVzdCBnaXZlIHVwIG5vdyBhbmQgcmV0dXJuCiAgICAgICAgLy8gbnVs\nbCBzbyB0aGF0IHRoZSBydW50aW1lIHdpbGwgcGVyZm9ybSBhIERCIGxvb2t1\ncCB0byBkZXRlcm1pbmUKICAgICAgICAvLyB3aGV0aGVyIHdlJ3JlIGRldGFj\naGVkIG9yIG5ldwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKElTREVUQUNI\nRURTVEFURURFRklOSVRJVkUsIGJvb2xlYW4uY2xhc3MsCiAgICAgICAgICAg\nIG51bGwpOwogICAgICAgIGlmaW5zID0gY29kZS5pZm5lKCk7CiAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7Cgog\nICAgICAgIC8vIG5vIGRldGFjaGVkIHN0YXRlOiBpZiBpbnN0YW5jZSB1c2Vz\nIGRldGFjaGVkIHN0YXRlIGFuZCBpdCdzIG5vdAogICAgICAgIC8vIHN5bnRo\nZXRpYyBvciB0aGUgaW5zdGFuY2UgaXMgbm90IHNlcmlhbGl6YWJsZSBvciB0\naGUgc3RhdGUgaXNuJ3QKICAgICAgICAvLyB0cmFuc2llbnQsIG11c3Qgbm90\nIGJlIGRldGFjaGVkCiAgICAgICAgaWYgKHN0YXRlID09IG51bGwKICAgICAg\nICAgICAgJiYgKCFDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21l\ndGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKQogICAgICAgICAgICB8fCAhU2VyaWFs\naXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKQogICAgICAgICAgICB8fCAhX3JlcG9zLmdldENvbmZpZ3Vy\nYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuCiAgICAgICAgICAg\nIGlzRGV0YWNoZWRTdGF0ZVRyYW5zaWVudCgpKSkgewogICAgICAgICAgICAv\nLyByZXR1cm4gQm9vbGVhbi5GQUxTRQogICAgICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xl\nYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBubyBk\nZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0\nZSAoYW5kIG11c3QgYmUKICAgICAgICAvLyBzeW50aGV0aWMgYW5kIHRyYW5z\naWVudCBpbiBzZXJpYWxpemFibGUgaW5zdGFuY2UgYXQgdGhpcyBwb2ludCks\nCiAgICAgICAgLy8gbm90IGRldGFjaGVkIGlmIHN0YXRlIG5vdCBzZXQgdG8g\nREVTRVJJQUxJWkVECiAgICAgICAgaWYgKHN0YXRlID09IG51bGwpIHsKICAg\nICAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSA9PSBudWxs\nKSAvLyBpbnN0ZWFkIG9mIERFU0VSSUFMSVpFRAogICAgICAgICAgICAvLyAg\nICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3Rh\ndGUiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJG\nQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gZ2l2ZSB1cDsgd2UganVzdCBkb24n\ndCBrbm93CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAg\nICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbXBhcmUgdGhlIGdpdmVuIGZpZWxkIHRv\nIGl0cyBKYXZhIGRlZmF1bHQsIHJldHVybmluZyB0aGUKICAgICAqIGNvbXBh\ncmlzb24gaW5zdHJ1Y3Rpb24uIFRoZSBmaWVsZCB2YWx1ZSB3aWxsIGFscmVh\nZHkgYmUgb24gdGhlIHN0YWNrLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBKdW1wSW5zdHJ1Y3Rpb24gaWZEZWZhdWx0VmFsdWUoQ29kZSBjb2RlLAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5p\nZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmRjbXBsKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKDBGKTsKICAgICAgICAgICAgICAgIGNvZGUuZmNtcGwoKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBjb2RlLmxjbXAo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlm\nbnVsbCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gZ2V0IHRoZSBjb2RlIGZvciB0aGUgY2xhc3MgaW5pdGlh\nbGl6ZXIgbWV0aG9kLAogICAgICogY3JlYXRpbmcgdGhlIG1ldGhvZCBpZiBp\ndCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LgogICAgICovCiAgICBwcml2YXRl\nIENvZGUgZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKGJvb2xlYW4gcmVwbGFj\nZUxhc3QpIHsKICAgICAgICBCQ01ldGhvZCBjbGluaXQgPSBfcGMuZ2V0RGVj\nbGFyZWRNZXRob2QoIjxjbGluaXQ+Iik7CiAgICAgICAgQ29kZSBjb2RlOwog\nICAgICAgIGlmIChjbGluaXQgIT0gbnVsbCkgewogICAgICAgICAgICBjb2Rl\nID0gY2xpbml0LmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgIGlmIChyZXBs\nYWNlTGFzdCkgewogICAgICAgICAgICAgICAgQ29kZSB0ZW1wbGF0ZSA9IEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSk7CiAgICAgICAg\nICAgICAgICBjb2RlLnNlYXJjaEZvcndhcmQodGVtcGxhdGUudnJldHVybigp\nKTsKICAgICAgICAgICAgICAgIGNvZGUucHJldmlvdXMoKTsKICAgICAgICAg\nICAgICAgIGNvZGUuc2V0KHRlbXBsYXRlLm5vcCgpKTsKICAgICAgICAgICAg\nICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiBjb2RlOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHN0YXRpYyBp\nbml0aWFsaXplciBtZXRob2QgaWYgbm9uIGV4aXN0cwogICAgICAgIGNsaW5p\ndCA9IF9wYy5kZWNsYXJlTWV0aG9kKCI8Y2xpbml0PiIsIHZvaWQuY2xhc3Ms\nIG51bGwpOwogICAgICAgIGNsaW5pdC5tYWtlUGFja2FnZSgpOwogICAgICAg\nIGNsaW5pdC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgY2xpbml0LnNldEZp\nbmFsKHRydWUpOwoKICAgICAgICBjb2RlID0gY2xpbml0LmdldENvZGUodHJ1\nZSk7CiAgICAgICAgaWYgKCFyZXBsYWNlTGFzdCkgewogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gY29kZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgYnl0ZWNvZGUgbW9kaWZ5aW5nIHRoZSBjbG9uaW5nIGJl\naGF2aW9yIG9mIHRoZSBjbGFzcyBiZWluZwogICAgICogZW5oYW5jZWQgdG8g\nY29ycmVjdGx5IHJlcGxhY2UgdGhlIDxjb2RlPnBjU3RhdGVNYW5hZ2VyPC9j\nb2RlPiAKICAgICAqIGluc3RhbmNlIGZpZWxkcyBvZiBhbnkgY2xvbmUgY3Jl\nYXRlZCB3aXRoIHRoZWlyIGRlZmF1bHQgdmFsdWVzLiAKICAgICAqIEFsc28s\nIGlmIHRoaXMgY2xhc3MgaXMgdGhlIGJhc2UgUEMgdHlwZSBhbmQgZG9lcyBu\nb3QgZGVjbGFyZWQgCiAgICAgKiBhIGNsb25lIG1ldGhvZCwgb25lIHdpbGwg\nYmUgYWRkZWQuIEFsc28sIGlmIF9wYyBpcyBhIHN5bnRoZXRpYwogICAgICog\nc3ViY2xhc3MsIGNyZWF0ZSB0aGUgY2xvbmUoKSBtZXRob2QgdGhhdCBjbGVh\ncnMgdGhlIHN0YXRlIG1hbmFnZXIKICAgICAqIHRoYXQgbWF5IGhhdmUgYmVl\nbiBpbml0aWFsaXplZCBpbiBhIHN1cGVyJ3MgY2xvbmUoKSBtZXRob2QuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDbG9uaW5nQ29kZSgpIHsKICAg\nICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCAmJiAh\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBhZGQgdGhlIGNsb25lIG1ldGhvZCBpZiBuZWNlc3NhcnkKICAg\nICAgICBCQ01ldGhvZCBjbG9uZSA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgi\nY2xvbmUiLCAKICAgICAgICAgICAgKFN0cmluZ1tdKSBudWxsKTsKICAgICAg\nICBTdHJpbmcgc3VwZXJOYW1lID0gX21hbmFnZWRUeXBlLmdldFN1cGVyY2xh\nc3NOYW1lKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbnVsbDsKICAgICAgICBp\nZiAoY2xvbmUgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBhZGQgY2xvbmUg\nc3VwcG9ydCBmb3IgYmFzZSBjbGFzc2VzCiAgICAgICAgICAgIC8vIHdoaWNo\nIGFsc28gaW1wbGVtZW50IGNsb25lYWJsZQogICAgICAgICAgICBib29sZWFu\nIGlzQ2xvbmVhYmxlID0gQ2xvbmVhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZy\nb20oCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKTsK\nICAgICAgICAgICAgYm9vbGVhbiBleHRlbmRzT2JqZWN0ID0KICAgICAgICAg\nICAgICAgIHN1cGVyTmFtZS5lcXVhbHMoT2JqZWN0LmNsYXNzLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGlmICghaXNDbG9uZWFibGUgfHwgKCFleHRlbmRz\nT2JqZWN0ICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmICghZ2V0Q3JlYXRlU3ViY2xh\nc3MoKSkKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy50cmFjZSgKICAgICAgICAg\nICAgICAgICAgICAgICAgX2xvYy5nZXQoImVuaGFuY2UtY2xvbmVhYmxlIiwg\nX21hbmFnZWRUeXBlLmdldE5hbWUoKSkpOwoKICAgICAgICAgICAgLy8gYWRk\nIGNsb25lIG1ldGhvZAogICAgICAgICAgICAvLyBwcm90ZWN0ZWQgT2JqZWN0\nIGNsb25lICgpIHRocm93cyBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbgog\nICAgICAgICAgICBjbG9uZSA9IF9wYy5kZWNsYXJlTWV0aG9kKCJjbG9uZSIs\nIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmICghc2V0Vmlz\naWJpbGl0eVRvU3VwZXJNZXRob2QoY2xvbmUpKQogICAgICAgICAgICAgICAg\nY2xvbmUubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBjbG9uZS5nZXRF\neGNlcHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbgogICAgICAgICAgICAgICAg\nKENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZSA9IGNsb25lLmdldENvZGUodHJ1ZSk7CgogICAgICAgICAgICAv\nLyByZXR1cm4gc3VwZXIuY2xvbmUgKCk7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3VwZXJOYW1lLCAiY2xvbmUiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7\nCiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIC8vIGdldCB0aGUgY2xvbmUgbWV0aG9kIGNvZGUKICAg\nICAgICAgICAgY29kZSA9IGNsb25lLmdldENvZGUoZmFsc2UpOwogICAgICAg\nICAgICBpZiAoY29kZSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIHRlbXBsYXRlIHN1cGVy\nLmNsb25lICgpIGluc3RydWN0aW9uIHRvIG1hdGNoIGFnYWluc3QKICAgICAg\nICBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSA9IChBY2Nlc3NDb250cm9sbGVyLmRv\nUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29k\nZUFjdGlvbigpKSkuaW52b2tlc3BlY2lhbCgpCiAgICAgICAgICAgIC5zZXRN\nZXRob2Qoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3QuY2xhc3MuZ2V0TmFt\nZSgpLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxscyB0byB0aGUgdGVt\ncGxhdGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAgICAgLy8gY2xvbmUg\nd2lsbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsK\nICAgICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewog\nICAgICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBjU3RhdGVNYW5hZ2Vy\nID0gbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUucHV0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAgICAgICAgICAgIC8v\nIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAgICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyByZWdpc3RlcmVkIGFz\nIHtAbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAgKi8KICAgIHB1Ymxp\nYyBBdXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFyeUVuaGFuY2Vycygp\nIHsKCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhpbGlhcnkgY29kZSBn\nZW5lcmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJ1\nbkF1eGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3IgKGludCBpID0gMDsg\naSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCV9hdXhFbmhh\nbmNlcnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhvZCBiZSBza2lwcGVk\nLgogICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1ldGhvZCB0byBiZSBz\na2lwcGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiB0\naGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUgZ2l2ZW4gbWV0aG9k\nLAogICAgICogb3IgaWYgdGhlIG1ldGhvZCBpcyBhIGNvbnN0cnVjdG9yCiAg\nICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lwRW5oYW5jZShCQ01ldGhv\nZCBtZXRob2QpIHsKICAgICAgICBpZiAoIjxpbml0PiIuZXF1YWxzKG1ldGhv\nZC5nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMu\nbGVuZ3RoOyBpKyspCiAgICAJCWlmIChfYXV4RW5oYW5jZXJzW2ldLnNraXBF\nbmhhbmNlKG1ldGhvZCkpCiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGRzIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcyB0aGF0IHdpbGwg\ncmVwbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBhY2Nlc3Nlcy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29ycygpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEu\nZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZp\nZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSkgewogICAgICAgICAgICAgICAgaWYgKCFnZXRSZWRlZmluZSgpICYmIGlz\nUHJvcGVydHlBY2Nlc3MoZm1kc1tpXSkpIHsKICAgICAgICAgICAgICAgICAg\nICBhZGRTdWJjbGFzc1NldE1ldGhvZChmbWRzW2ldKTsKICAgICAgICAgICAg\nICAgICAgICBhZGRTdWJjbGFzc0dldE1ldGhvZChmbWRzW2ldKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIGFkZEdldE1ldGhvZChpLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAg\nIGFkZFNldE1ldGhvZChpLCBmbWRzW2ldKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBub24tc3RhdGlj\nIHNldHRlciB0aGF0IGRlbGVnYXRlcyB0byB0aGUgc3VwZXIgbWV0aG9kcywg\nYW5kCiAgICAgKiBwZXJmb3JtcyBhbnkgbmVjZXNzYXJ5IGZpZWxkIHRyYWNr\naW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NTZXRN\nZXRob2QoRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3MgcHJvcFR5cGUgPSBm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgU3RyaW5nIHNldHRlck5h\nbWUgPSBnZXRTZXR0ZXJOYW1lKGZtZCk7CiAgICAgICAgQkNNZXRob2Qgc2V0\ndGVyID0gX3BjLmRlY2xhcmVNZXRob2Qoc2V0dGVyTmFtZSwgdm9pZC5jbGFz\ncywKICAgICAgICAgICAgbmV3IENsYXNzW10geyBwcm9wVHlwZSB9KTsKICAg\nICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChzZXR0ZXIpOwogICAg\nICAgIENvZGUgY29kZSA9IHNldHRlci5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBub3QgbmVjZXNzYXJ5IGlmIHdlJ3JlIGFscmVhZHkgdHJhY2tpbmcg\nYWNjZXNzIHZpYSByZWRlZmluaXRpb24KICAgICAgICBpZiAoIWdldFJlZGVm\naW5lKCkpIHsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBvcmlnIHZhbHVlIG9u\ndG8gc3RhY2sKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQp\nOwogICAgICAgICAgICBpbnQgdmFsID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbCh2YWwp\nLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAg\nYWRkTm90aWZ5TXV0YXRpb24oY29kZSwgZm1kLCB2YWwsIDApOwogICAgICAg\nIH0KCiAgICAgICAgLy8gIyMjIyMgdGVzdCBjYXNlOiBCIGV4dGVuZHMgQS4g\nTWV0aG9kcyBkZWZpbmVkIGluIEEuIFdoYXQKICAgICAgICAvLyAjIyMjIyBo\nYXBwZW5zPwogICAgICAgIC8vIHN1cGVyLnNldFhYWCguLi4pCiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLnhsb2FkKCku\nc2V0UGFyYW0oMCkuc2V0VHlwZShwcm9wVHlwZSk7CiAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBl\nKCksCiAgICAgICAgICAgIHNldHRlck5hbWUsIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHsgcHJvcFR5cGUgfSk7CgogICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIHByaXZhdGUg\nYm9vbGVhbiBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChCQ01ldGhvZCBt\nZXRob2QpIHsKICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfbWFuYWdl\nZFR5cGUuZ2V0TWV0aG9kcyhtZXRob2QuZ2V0TmFtZSgpLAogICAgICAgICAg\nICBtZXRob2QuZ2V0UGFyYW1UeXBlcygpKTsKICAgICAgICBpZiAobWV0aG9k\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLWFjY2Vzc29yIiwKICAgICAgICAgICAgICAg\nIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCksIG1ldGhvZC5nZXROYW1lKCkpKTsK\nICAgICAgICBCQ01ldGhvZCBzdXBlck1ldGggPSBtZXRob2RzWzBdOwogICAg\nICAgIGlmIChzdXBlck1ldGguaXNQcml2YXRlKCkpIHsKICAgICAgICAgICAg\nbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRoLmlzUGFja2FnZSgpKSB7\nCiAgICAgICAgICAgIG1ldGhvZC5tYWtlUGFja2FnZSgpOwogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5p\nc1Byb3RlY3RlZCgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJvdGVj\ndGVkKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxz\nZSBpZiAoc3VwZXJNZXRoLmlzUHVibGljKCkpIHsKICAgICAgICAgICAgbWV0\naG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgYSBub24tc3RhdGljIGdldHRlciB0aGF0IGRlbGVnYXRl\ncyB0byB0aGUgc3VwZXIgbWV0aG9kcywgYW5kCiAgICAgKiBwZXJmb3JtcyBh\nbnkgbmVjZXNzYXJ5IGZpZWxkIHRyYWNraW5nLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkU3ViY2xhc3NHZXRNZXRob2QoRmllbGRNZXRhRGF0YSBm\nbWQpIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWUgPSAiZ2V0IiArIFN0cmlu\nZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgaWYg\nKF9tYW5hZ2VkVHlwZS5nZXRNZXRob2RzKG1ldGhOYW1lLCBuZXcgQ2xhc3Nb\nMF0pLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBtZXRoTmFtZSA9ICJpcyIg\nKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAg\nICAgIEJDTWV0aG9kIGdldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKG1ldGhO\nYW1lLCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgIG51bGwp\nOwogICAgICAgIHNldFZpc2liaWxpdHlUb1N1cGVyTWV0aG9kKGdldHRlcik7\nCiAgICAgICAgZ2V0dGVyLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBnZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgd2Un\ncmUgbm90IGFscmVhZHkgdHJhY2tpbmcgZmllbGQgYWNjZXNzIHZpYSByZWZs\nZWN0aW9uLCB0aGVuIHdlCiAgICAgICAgLy8gbXVzdCBtYWtlIHRoZSBnZXR0\nZXIgaG9vayBpbiBsYXp5IGxvYWRpbmcgYmVmb3JlIGFjY2Vzc2luZyB0aGUg\nc3VwZXIKICAgICAgICAvLyBtZXRob2QuCiAgICAgICAgaWYgKCFnZXRSZWRl\nZmluZSgpKQogICAgICAgICAgICBhZGROb3RpZnlBY2Nlc3MoY29kZSwgZm1k\nKTsKCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdl\ndFR5cGUoKSwgbWV0aE5hbWUsCiAgICAgICAgICAgIGZtZC5nZXREZWNsYXJl\nZFR5cGUoKSwgbnVsbCk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlw\nZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIHN0YXRpYyBnZXR0\nZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKiBUaGUgZ2Vu\nZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUgaW5zdGFuY2Ugc3Rh\ndGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5hZ2VyIHRvIGdldCB0aGUgdmFs\ndWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJhbSBpbmRleCB0\naGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFt\nIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmllbGQgdG8gZ2V0CiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRHZXRNZXRob2QoaW50IGluZGV4LCBGaWVs\nZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBjcmVhdGVHZXRN\nZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29k\nZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgcmVhZHMgYXJlIG5vdCBjaGVja2Vk\nLCBqdXN0IHJldHVybiB0aGUgdmFsdWUKICAgICAgICBieXRlIGZpZWxkRmxh\nZyA9IGdldEZpZWxkRmxhZyhmbWQpOwogICAgICAgIGlmICgoZmllbGRGbGFn\nICYgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JFQUQpID09IDAKICAgICAg\nICAgICAgJiYgKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5NRURJ\nQVRFX1JFQUQpID09IDApIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCB0cnVlLCBmbWQpOwogICAgICAgICAgICBhZGRHZXRNYW5h\nZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIGNvZGUueHJl\ndHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAg\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgKGluc3QucGNTdGF0ZU1hbmFn\nZXIgPT0gbnVsbCkgcmV0dXJuIGluc3QuPGZpZWxkPjsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQpOwogICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAg\nICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSk7CgogICAgICAgIC8vIGludCBmaWVsZCA9IHBjSW5oZXJpdGVkRmllbGRD\nb3VudCArIDxmaWVsZGluZGV4PjsKICAgICAgICBpbnQgZmllbGRMb2NhbCA9\nIGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50\nLmNsYXNzKSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGlu\nZGV4KTsKICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICBjb2RlLmlzdG9y\nZSgpLnNldExvY2FsKGZpZWxkTG9jYWwpOwoKICAgICAgICAvLyBpbnN0LnBj\nU3RhdGVNYW5hZ2VyLmFjY2Vzc2luZ0ZpZWxkIChmaWVsZCk7CiAgICAgICAg\nLy8gcmV0dXJuIGluc3QuPGZpZWxkPjsKICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaWxvYWQo\nKS5zZXRMb2NhbChmaWVsZExvY2FsKTsKICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJhY2Nlc3NpbmdGaWVsZCIs\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xh\nc3MgfSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nLCBmbWQpOwogICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\nZm1kKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyBhIHN0YXRpYyBzZXR0ZXIgbWV0aG9k\nIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1l\ndGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRo\nZQogICAgICogU3RhdGVNYW5hZ2VyIHRvIHNldCB0aGUgdmFsdWUgb2YgdGhl\nIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRp\ndmUgbnVtYmVyIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFtIGZtZCBtZXRh\nZGF0YSBhYm91dCB0aGUgZmllbGQgdG8gc2V0CiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRTZXRNZXRob2QoaW50IGluZGV4LCBGaWVsZE1ldGFEYXRh\nIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBjcmVhdGVTZXRNZXRob2QoZm1k\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gUENFbmhhbmNlciB1c2VzIHN0YXRpYyBtZXRob2RzOyBQ\nQ1N1YmNsYXNzZXIgZG9lcyBub3QuCiAgICAgICAgaW50IGZpcnN0UGFyYW1P\nZmZzZXQgPSBnZXRBY2Nlc3NvclBhcmFtZXRlck9mZnNldChmbWQpOwoKICAg\nICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdlciA9PSBudWxsKSBpbnN0\nLjxmaWVsZD4gPSB2YWx1ZTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIHRydWUsIGZtZCk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBp\nZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQpOwogICAgICAgIGNvZGUueGxvYWQo\nKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0KTsKICAgICAgICBhZGRTZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgaWYoZm1kLmlz\nVmVyc2lvbigpPT10cnVlICYmIF9hZGRWZXJzaW9uSW5pdEZsYWcpewogICAg\nICAgICAgICAvLyBpZiB3ZSBhcmUgc2V0dGluZyB0aGUgdmVyc2lvbiwgZmxp\ncCB0aGUgdmVyc2lvbkluaXQgZmxhZyB0byB0cnVlCiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgxKTsKICAgICAgICAgICAgLy8gcGNW\nZXJzaW9uSW5pdCA9IHRydWU7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUs\nIG51bGwsIFZFUlNJT05fSU5JVF9TVFIsIGJvb2xlYW4uY2xhc3MpOyAgIAog\nICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgLy8g\naW5zdC5wY1N0YXRlTWFuYWdlci5zZXR0aW5nPGZpZWxkVHlwZT5GaWVsZCAo\naW5zdCwKICAgICAgICAvLyAgICAgcGNJbmhlcml0ZWRGaWVsZENvdW50ICsg\nPGluZGV4PiwgaW5zdC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSwg\nZm1kKSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1\nZSwgZm1kKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElO\nSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGluZGV4KTsKICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAgICAgICAg\nYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIGNv\nZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0KTsKICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0\naG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCksICJzZXR0\naW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBtZXRob2RzIHRv\nIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dGFjaERldGFj\naENvZGUoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2VzIGFyZSBkZXRh\nY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlID0gZmFs\nc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVudCA9IF9tZXRh\nLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIHBhcmVu\ndCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKSkgewogICAgICAgICAgICBpZiAocGFyZW50LmlzRGV0YWNoYWJs\nZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJlbnREZXRhY2hhYmxlID0gdHJ1\nZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFjaGFibGUsIHdl\nIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRzIGFuZAogICAg\nICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAoX21ldGEuZ2V0\nUENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygp\nCiAgICAgICAgICAgIHx8IHBhcmVudERldGFjaGFibGUgIT0gX21ldGEuaXNE\nZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgYWRkSXNEZXRhY2hlZE1ldGhv\nZCgpOwogICAgICAgICAgICBhZGREZXRhY2hlZFN0YXRlTWV0aG9kcyhfbWV0\nYS51c2VzRGV0YWNoZWRTdGF0ZSgpCiAgICAgICAgICAgICAgICAhPSBCb29s\nZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHdlIGRldGFj\naCBvbiBzZXJpYWxpemUsIHdlIGFsc28gbmVlZCB0byBpbXBsZW1lbnQgdGhl\nCiAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNlIHRvIHdyaXRl\nIGp1c3QgdGhlIHN0YXRlIGZvciB0aGUgZmllbGRzCiAgICAgICAgLy8gYmVp\nbmcgZGV0YWNoZWQKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRhY2hlZCgp\nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhZGREZXRh\nY2hFeHRlcm5hbGl6ZShwYXJlbnREZXRhY2hhYmxlLAogICAgICAgICAgICAg\nICAgICAgIF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkgIT0gQm9vbGVhbi5G\nQUxTRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiBuc21lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihuc21lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZmllbGRzIHRvIGhvbGQgZGV0\nYWNoZWQgc3RhdGUgYW5kIHRoZWlyIGFjY2Vzc29yIG1ldGhvZHMuCiAgICAg\nKgogICAgICogQHBhcmFtIGltcGwgd2hldGhlciB0byBmdWxseSBpbXBsZW1l\nbnQgZGV0YWNoIHN0YXRlIGZ1bmN0aW9uYWxpdHkKICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZERldGFjaGVkU3RhdGVNZXRob2RzKGJvb2xlYW4gaW1w\nbCkgewogICAgICAgIEZpZWxkIGRldGFjaEZpZWxkID0gX21ldGEuZ2V0RGV0\nYWNoZWRTdGF0ZUZpZWxkKCk7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBudWxs\nOwogICAgICAgIFN0cmluZyBkZWNsYXJlciA9IG51bGw7CiAgICAgICAgaWYg\nKGltcGwgJiYgZGV0YWNoRmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBu\nYW1lID0gUFJFICsgIkRldGFjaGVkU3RhdGUiOwogICAgICAgICAgICBkZWNs\nYXJlciA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIEJDRmllbGQgZmll\nbGQgPSBfcGMuZGVjbGFyZUZpZWxkKG5hbWUsIE9iamVjdC5jbGFzcyk7CiAg\nICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgIGZp\nZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICB9IGVsc2UgaWYgKGlt\ncGwpIHsKICAgICAgICAgICAgbmFtZSA9IGRldGFjaEZpZWxkLmdldE5hbWUo\nKTsKICAgICAgICAgICAgZGVjbGFyZXIgPSBkZXRhY2hGaWVsZC5nZXREZWNs\nYXJpbmdDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9CgogICAgICAgIC8v\nIHB1YmxpYyBPYmplY3QgcGNHZXREZXRhY2hlZFN0YXRlICgpCiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdl\ndERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWMoZmFsc2UpOwogICAgICAg\nIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgaW50IGFjY2VzcyA9IG1l\ndGhvZC5nZXRBY2Nlc3NGbGFncygpOwoKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1wbCkgewogICAg\nICAgICAgICAvLyByZXR1cm4gcGNEZXRhY2hlZFN0YXRlOwogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFByb2plY3QoKS5s\nb2FkQ2xhc3MoZGVjbGFyZXIpLAogICAgICAgICAgICAgICAgbmFtZSk7CiAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRO\ndWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjU2V0RGV0YWNo\nZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAgICAgIG1ldGhvZCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzIFtdeyBPYmplY3QuY2xhc3Mg\nfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdzKGFjY2Vzcyk7CiAg\nICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGlm\nIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBjRGV0YWNoZWRTdGF0ZSA9IHN0\nYXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUuZ2V0UHJv\namVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAgICAgICAgICBu\nYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4gdGhlIGluc3Ry\ndWN0aW9ucyB0byBnZXQgZmllbGQKICAgICAqIDxjb2RlPmF0dHJOYW1lPC9j\nb2RlPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVyPC9jb2RlPgog\nICAgICogb250byB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAg\nKiBUaGUgaW5zdGFuY2UgdG8gYWNjZXNzIG11c3QgYWxyZWFkeSBiZSBvbiB0\naGUgdG9wIG9mIHRoZQogICAgICogc3RhY2sgd2hlbiB0aGlzIGlzIGludm9r\nZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRmaWVsZChDb2RlIGNv\nZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFtZSkgewogICAg\nICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAgICBkZWNsYXJl\nciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgLy8gZmlyc3QsIHNlZSBpZiB3\nZSBjYW4gY29udmVydCB0aGUgYXR0cmlidXRlIG5hbWUgdG8gYSBmaWVsZCBu\nYW1lCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRvQmFja2luZ0ZpZWxk\nTmFtZShhdHRyTmFtZSk7CgogICAgICAgIC8vIG5leHQsIGZpbmQgdGhlIGZp\nZWxkIGluIHRoZSBtYW5hZ2VkIHR5cGUgaGllcmFyY2h5CiAgICAgICAgQkNG\naWVsZCBmaWVsZCA9IG51bGw7CiAgICAgICAgb3V0ZXI6IGZvciAoQkNDbGFz\ncyBiYyA9IF9wYzsgYmMgIT0gbnVsbDsgYmMgPSBiYy5nZXRTdXBlcmNsYXNz\nQkMoKSkgewogICAgICAgICAgICBCQ0ZpZWxkW10gZmllbGRzID0gQWNjZXNz\nQ29udHJvbGxlcgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRv\nUHJpdkhlbHBlci5nZXRCQ0NsYXNzRmllbGRzQWN0aW9uKGJjLAogICAgICAg\nICAgICAgICAgICAgIGZpZWxkTmFtZSkpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgZmllbGQgPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAgICAvLyBp\nZiB3ZSByZWFjaCBhIGZpZWxkIGRlY2xhcmVkIGluIHRoaXMgdHlwZSwgdGhl\nbiB0aGlzIGlzIHRoZQogICAgICAgICAgICAgICAgLy8gbW9zdC1tYXNraW5n\nIGZpZWxkLCBhbmQgaXMgdGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAgICAgICAg\nICAgICAgICBpZiAoZmllbGRzW2ldLmdldERlY2xhcmVyKCkgPT0gZGVjbGFy\nZXIpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYgKGdldENyZWF0ZVN1YmNsYXNzKCkgJiYgY29kZS5nZXRNZXRob2QoKS5n\nZXREZWNsYXJlcigpID09IF9wYwogICAgICAgICAgICAmJiAoZmllbGQgPT0g\nbnVsbCB8fCAhZmllbGQuaXNQdWJsaWMoKSkpIHsKICAgICAgICAgICAgLy8g\nd2UncmUgY3JlYXRpbmcgdGhlIHN1YmNsYXNzLCBub3QgcmVkZWZpbmluZyB0\naGUgdXNlciB0eXBlLgoKICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5nZXRY\nWFgodGhpcywgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAgICAgICAg\nICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xhcmVyKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZpZWxkTmFt\nZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVl\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qo\nUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5kRmllbGQi\nLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAg\nQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsK\nICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IF9tZXRhLmdldEZpZWxkKGF0dHJO\nYW1lKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKAog\nICAgICAgICAgICAgICAgICAgIGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2Qo\ndHlwZSwgRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIHNo\nb3VsZCBuZXZlciBoYXBwZW4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5j\nbGFzcykKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZSh0eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBmaWVsZE5h\nbWUsCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUeXBlKCkuZ2V0TmFtZSgp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRvIDxj\nb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gc2V0IGZpZWxk\nCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQgaW4gdHlw\nZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIHRvIHRoZSB2YWx1ZSBv\nZiB0eXBlIDxjb2RlPmZpZWxkVHlwZTwvY29kZT4gb24gdGhlIHRvcCBvZiB0\naGUgc3RhY2suCiAgICAgKgogICAgICogV2hlbiB0aGlzIG1ldGhvZCBpcyBp\nbnZva2VkLCB0aGUgdmFsdWUgdG8gbG9hZCBtdXN0CiAgICAgKiBhbHJlYWR5\nIGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGluIDxjb2RlPmNvZGU8L2Nv\nZGU+LAogICAgICogYW5kIHRoZSBpbnN0YW5jZSB0byBsb2FkIGludG8gbXVz\ndCBiZSBzZWNvbmQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwdXRmaWVs\nZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFt\nZSwKICAgICAgICBDbGFzcyBmaWVsZFR5cGUpIHsKICAgICAgICBpZiAoZGVj\nbGFyZXIgPT0gbnVsbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBfbWFuYWdl\nZFR5cGU7CgogICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSB0b0JhY2tpbmdG\naWVsZE5hbWUoYXR0ck5hbWUpOwoKICAgICAgICBpZiAoZ2V0UmVkZWZpbmUo\nKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIFJl\nZmxlY3Rpb24uc2V0KHRoaXMsIFJlZmxlY3Rpb24uZmluZEZpZWxkKC4uLiks\nIHZhbHVlKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0\nQ2xhc3MoZGVjbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAg\nICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nCiAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBi\nb29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwKICAgICAg\nICAgICAgICAgIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLAogICAg\nICAgICAgICAgICAgICAgIGZpZWxkVHlwZS5pc1ByaW1pdGl2ZSgpID8gZmll\nbGRUeXBlIDogT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICBG\naWVsZC5jbGFzcyB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkKICAgICAgICAgICAgICAgIC5zZXRGaWVsZChkZWNs\nYXJlci5nZXROYW1lKCksIGZpZWxkTmFtZSwgZmllbGRUeXBlLmdldE5hbWUo\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgdXNpbmcg\ncHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZmZXJlbnQg\nYmFja2luZyBmaWVsZAogICAgICogbmFtZSBmb3IgdGhlIHBlcnNpc3RlbnQg\nYXR0cmlidXRlIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICovCiAgICBwcml2\nYXRlIFN0cmluZyB0b0JhY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5hbWUpIHsK\nICAgICAgICAvLyBtZXRhIGlzIG51bGwgd2hlbiBlbmhhbmNpbmcgcGVyc2lz\ndGVuY2UtYXdhcmUgCiAgICAJRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YSA9\nPSBudWxsID8gbnVsbCA6IF9tZXRhLmdldEZpZWxkKG5hbWUpOwogICAgICAg\nIGlmIChfbWV0YSAhPSBudWxsICYmIGlzUHJvcGVydHlBY2Nlc3MoZm1kKQog\nICAgICAgICAgICAmJiBfYXR0cnNUb0ZpZWxkcyAhPSBudWxsICYmIF9hdHRy\nc1RvRmllbGRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAgICBuYW1l\nID0gKFN0cmluZylfYXR0cnNUb0ZpZWxkcy5nZXQobmFtZSk7CiAgICAgICAg\ncmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB1c2luZyBw\ncm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBpcyBhIGRpZmZlcmVudCBw\nZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFtZSBmb3IgdGhlIGJhY2tp\nbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAgICAgKi8KICAgIHByaXZh\ndGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1lKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4gZW5oYW5jaW5nIHBlcnNp\nc3RlbmNlLWF3YXJlIAogICAgCUZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEg\nPT0gbnVsbCA/IG51bGwgOiBfbWV0YS5nZXRGaWVsZChuYW1lKTsKICAgICAg\nICBpZiAoX21ldGEgIT0gbnVsbCAmJiBpc1Byb3BlcnR5QWNjZXNzKGZtZCkK\nICAgICAgICAgICAgJiYgX2ZpZWxkc1RvQXR0cnMgIT0gbnVsbCAmJiBfZmll\nbGRzVG9BdHRycy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgcmV0\ndXJuIChTdHJpbmcpX2ZpZWxkc1RvQXR0cnMuZ2V0KG5hbWUpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbXBsZW1lbnQgdGhlIGV4dGVybmFsaXphYmxlIGludGVyZmFj\nZSB0byBkZXRhY2ggb24gc2VyaWFsaXplLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVhbiBwYXJlbnREZXRh\nY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBl\nbnN1cmUgdGhhdCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBjb25zdHJ1Y3RvciBp\ncyBwdWJsaWMgCiAgICAgICAgLy8gZm9yIGV4dGVybmFsaXphdGlvbgogICAg\nICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIjxp\nbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7CiAgICAgICAgaWYgKCFtZXRoLmlz\nUHVibGljKCkpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhh\nbmNlLWRlZmNvbnMtZXh0ZXJuIiwgCiAgICAgICAgICAgICAgICAgIF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkpOwogICAgICAgICAgICBtZXRoLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVjbGFyZSBleHRlcm5h\nbGl6YWJsZSBpbnRlcmZhY2UKICAgICAgICBpZiAoIUV4dGVybmFsaXphYmxl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKSkKICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoRXh0ZXJu\nYWxpemFibGUuY2xhc3MpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHVz\nZXIgZG9lc24ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4dGVybmFsaXphdGlv\nbiBvcgogICAgICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0aG9kcwogICAgICAg\nIENsYXNzW10gaW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJl\nYW0uY2xhc3MgfTsKICAgICAgICBDbGFzc1tdIG91dHB1dCA9IG5ldyBDbGFz\nc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBpZiAo\nX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2JqZWN0Iiwg\naW5wdXQpICE9IG51bGwKICAgICAgICAgICAgfHwgX21hbmFnZWRUeXBlLmdl\ndERlY2xhcmVkTWV0aG9kKCJ3cml0ZU9iamVjdCIsIG91dHB1dCkgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoImRldGFjaC1jdXN0b20tc2VyIiwgX21ldGEpKTsKICAgICAgICBpbnB1\ndFswXSA9IE9iamVjdElucHV0LmNsYXNzOwogICAgICAgIG91dHB1dFswXSA9\nIE9iamVjdE91dHB1dC5jbGFzczsKICAgICAgICBpZiAoX21hbmFnZWRUeXBl\nLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCBpbnB1dCkgIT0g\nbnVsbAogICAgICAgICAgICB8fCBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRN\nZXRob2QoIndyaXRlRXh0ZXJuYWwiLCBvdXRwdXQpICE9IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZXRh\nY2gtY3VzdG9tLWV4dGVybiIsIF9tZXRhKSk7CgogICAgICAgIC8vIGNyZWF0\nZSBsaXN0IG9mIGFsbCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxkcwog\nICAgICAgIEJDRmllbGRbXSBmaWVsZHMgPSBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRGaWVsZHMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVubWdkID0gbmV3\nIEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoIWZpZWxkc1tpXS5pc1RyYW5zaWVudCgpICYmICFmaWVsZHNbaV0uaXNT\ndGF0aWMoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5pc0ZpbmFs\nKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uZ2V0TmFtZSgpLnN0\nYXJ0c1dpdGgoUFJFKQogICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0RGVj\nbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAgfQoK\nICAgICAgICBhZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJsZSwgZGV0\nYWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkUmVhZFVubWFuYWdlZCh1bm1nZCwg\ncGFyZW50RGV0YWNoYWJsZSk7CiAgICAgICAgYWRkV3JpdGVFeHRlcm5hbChw\nYXJlbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAgICBhZGRX\ncml0ZVVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRFeHRlcm5hbCBtZXRo\nb2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkRXh0ZXJuYWwo\nYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0\nYWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFzc1tdeyBP\nYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBf\ncGMuZGVjbGFyZU1ldGhvZCgicmVhZEV4dGVybmFsIiwgdm9pZC5jbGFzcywg\naW5hcmdzKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0\nRXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9u\nKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0\naW9uKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3Vw\nZXIucmVhZEV4dGVybmFsIChpbik7CiAgICAgICAgQ2xhc3Mgc3VwID0gX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAg\nICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFibGUuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJyZWFkRXh0ZXJuYWwiLAogICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAgICAgICAgICBQUkUgKyAi\nUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJncyk7CgogICAgICAg\nIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIHBjU2V0RGV0\nYWNoZWRTdGF0ZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAi\ncmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKCiAg\nICAgICAgICAgIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoKFN0YXRlTWFu\nYWdlcikgaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAicmVhZE9i\namVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3RhdGVNYW5h\nZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKFBSRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdGF0ZU1hbmFn\nZXIuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFkIG1hbmFn\nZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1Ry\nYW5zaWVudCgpKQogICAgICAgICAgICAgICAgcmVhZEV4dGVybmFsKGNvZGUs\nIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxkcyBmcm9tIHRoZSBz\ndHJlYW0gKHBjUmVhZFVubWFuYWdlZCkuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRSZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xl\nYW4gcGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBD\nbGFzc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9k\nIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVhZFVubWFuYWdl\nZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIGluYXJncyk7CiAgICAgICAg\nbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNl\ncHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBz\nLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZXhj\nZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNz\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBp\nZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAg\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiUmVhZFVubWFu\nYWdlZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAgICAgaW5hcmdzKTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgZGVjbGFyZWQgdW5tYW5hZ2Vk\nIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVs\nZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgcmVhZEV4dGVybmFsKGNvZGUs\nIGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgpLCBudWxsKTsKICAg\nICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9k\nIHRvIHJlYWQgYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFsaXphdGlvbiBpbnB1\ndCBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFkRXh0ZXJu\nYWwoQ29kZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsK\nICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAg\nIG1ldGhOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhO\nYW1lID0gbWV0aE5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKExv\nY2FsZS5FTkdMSVNIKQogICAgICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJz\ndHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gInJlYWQiICsgbWV0\naE5hbWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIG1ldGhOYW1lID0g\nInJlYWRPYmplY3QiOwoKICAgICAgICAvLyA8ZmllbGQ+ID0gaW4ucmVhZDx0\neXBlPiAoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgQ2xhc3MgcmV0ID0gKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDog\nT2JqZWN0LmNsYXNzOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCBtZXRoTmFtZSwKICAgICAg\nICAgICAgcmV0LCBudWxsKTsKICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRp\ndmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGlmIChmbWQg\nPT0gbnVsbCkKICAgICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVsbCwgZmll\nbGROYW1lLCB0eXBlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYWRk\nU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpF\nQ1Q6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoK\nICAgICAgICAgICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAvLyAgIHNtLnByb3h5RGV0YWNoZWREZXNlcmlhbGl6\nZWQgKDxpbmRleD4pOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAg\nICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwo\nKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxk\nKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgpKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChTTVRZUEUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm94eURl\ndGFjaGVkRGVzZXJpYWxpemVkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAg\nICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgY3VzdG9tIHdyaXRlRXh0ZXJuYWwgbWV0aG9kLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkV3JpdGVFeHRlcm5hbChib29sZWFuIHBhcmVudERl\ndGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRlKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENs\nYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXQuY2xh\nc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRo\nb2QoIndyaXRlRXh0ZXJuYWwiLCB2b2lkLmNsYXNzLCBvdXRhcmdzKTsKICAg\nICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0aW9ucyh0\ncnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhjZXB0aW9u\nLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlRXh0ZXJuYWwgKG91dCk7CiAg\nICAgICAgQ2xhc3Mgc3VwID0gZ2V0VHlwZShfbWV0YSkuZ2V0U3VwZXJjbGFz\ncygpOwogICAgICAgIGlmICghcGFyZW50RGV0YWNoYWJsZSAmJiBFeHRlcm5h\nbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cCwgIndyaXRlRXh0\nZXJuYWwiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgb3V0YXJncyk7\nCiAgICAgICAgfQoKICAgICAgICAvLyB3cml0ZVVubWFuYWdlZCAob3V0KTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAg\nICAgICAgICBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCBv\ndXRhcmdzKTsKCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdvMiA9IG51bGw7\nCiAgICAgICAgaWYgKGRldGFjaGVkU3RhdGUpIHsKICAgICAgICAgICAgLy8g\naWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgIC8vICAgaWYgKHNtLndyaXRl\nRGV0YWNoZWQgKG91dCkpCiAgICAgICAgICAgIC8vICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgICAgICBJZkluc3RydWN0aW9uIGlmbnVsbCA9IGNvZGUu\naWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5z\nZXRNZXRob2QoU01UWVBFLCAid3JpdGVEZXRhY2hlZCIsCiAgICAgICAgICAg\nICAgICBib29sZWFuLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICAgICAgZ28y\nID0gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoK\nICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAvLyAgIG91dC53cml0\nZU9iamVjdCAocGNHZXREZXRhY2hlZFN0YXRlICgpKTsKICAgICAgICAgICAg\nQ2xhc3NbXSBvYmphcmdzID0gbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9\nOwogICAgICAgICAgICBpZm51bGwuc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNs\nYXNzLAogICAgICAgICAgICAgICAgIndyaXRlT2JqZWN0Iiwgdm9pZC5jbGFz\ncywgb2JqYXJncyk7CiAgICAgICAgICAgIC8vICAgIG91dC53cml0ZU9iamVj\ndCAobnVsbCkgLy8gU3RhdGVNYW5hZ2VyCiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKChPYmplY3QpIG51bGwpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLCBv\nYmphcmdzKTsKICAgICAgICB9CiAgICAgICAgaWYgKGdvMiAhPSBudWxsKQog\nICAgICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAgICAg\nICAvLyB3cml0ZSBtYW5hZ2VkIGZpZWxkcwogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAgICAgIHdy\naXRlRXh0ZXJuYWwoY29kZSwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgZm1kc1tp\nXSk7CgogICAgICAgIC8vIHJldHVybgogICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogV3JpdGUgdW5tYW5hZ2VkIGZpZWxkcyB0byB0aGUgc3RyZWFtIChwY1dy\naXRlVW5tYW5hZ2VkKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFdy\naXRlVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2QsIGJvb2xlYW4gcGFyZW50\nRGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIHsKICAgICAgICBDbGFzc1tdIG91dGFyZ3MgPSBuZXcgQ2xhc3NbXXsg\nT2JqZWN0T3V0cHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZv\naWQuY2xhc3MsCiAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAgIG1ldGgu\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0g\nbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRF\neGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29k\nZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIud3Jp\ndGVVbm1hbmFnZWQgKG91dCk7CiAgICAgICAgaWYgKHBhcmVudERldGFjaGFi\nbGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdl\ndFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpKSwgUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFz\ncywgCiAgICAgICAgICAgICAgICBvdXRhcmdzKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHdyaXRlIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxpemFibGUg\nZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIHdyaXRlRXh0ZXJuYWwoY29kZSwgZmllbGQuZ2V0TmFt\nZSgpLCBmaWVsZC5nZXRUeXBlKCksIG51bGwpOwogICAgICAgIH0KICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gd3JpdGUgYSBm\naWVsZCB0byBhbiBleHRlcm5hbGl6YXRpb24gb3V0cHV0IHN0cmVhbS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRXh0ZXJuYWwoQ29kZSBjb2Rl\nLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0eXBlLAogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIFN0cmluZyBtZXRoTmFtZTsKICAgICAgICBpZiAo\ndHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAgICAgICAgIG1ldGhOYW1lID0g\ndHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gbWV0aE5h\nbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKExvY2FsZS5FTkdMSVNI\nKQogICAgICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJzdHJpbmcoMSk7CiAg\nICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRlIiArIG1ldGhOYW1lOwogICAg\nICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJ3cml0ZU9iamVj\ndCI7CgogICAgICAgIC8vIG91dC53cml0ZTx0eXBlPiAoPGZpZWxkPik7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlmIChmbWQg\nPT0gbnVsbCkKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZmll\nbGROYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBDbGFzc1tdIGFyZ3Mg\nPSBuZXcgQ2xhc3NbXXsgdHlwZSB9OwogICAgICAgIGlmICh0eXBlID09IGJ5\ndGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFyLmNsYXNzIHx8IHR5cGUgPT0gc2hv\ncnQuY2xhc3MpCiAgICAgICAgICAgIGFyZ3NbMF0gPSBpbnQuY2xhc3M7CiAg\nICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAg\nICAgYXJnc1swXSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3MsIG1l\ndGhOYW1lLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShDb2Rl\nIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZEdldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZCBieSA8Y29kZT5mbWQ8\nL2NvZGU+IG9udG8gdGhlIHN0YWNrLgogICAgICogQmVmb3JlIHRoaXMgbWV0\naG9kIGlzIGNhbGxlZCwgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRhIHNob3Vs\nZCBiZSBsb2FkZWQKICAgICAqIGZyb20gd2lsbCBiZSBvbiB0aGUgdG9wIG9m\nIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVNhbWVDbGFz\ncyBpZiA8Y29kZT50cnVlPC9jb2RlPiwgdGhlbiA8Y29kZT5mbWQ8L2NvZGU+\nIGlzCiAgICAgKiBiZWluZyBsb2FkZWQgZnJvbSBhbiBpbnN0YW5jZSBvZiB0\naGUgc2FtZSBjbGFzcyBhcyB0aGUgY3VycmVudCBleGVjdXRpb24KICAgICAq\nIGNvbnRleHQuIElmIDxjb2RlPmZhbHNlPC9jb2RlPiwgdGhlbiB0aGUgaW5z\ndGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sKICAgICAqIG1pZ2h0IGJl\nIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3VycmVudCBleGVjdXRpb24gY29udGV4\ndCdzICd0aGlzJyBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFE\nYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZyb21TYW1lQ2xhc3MpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\naWYgcmVkZWZpbmluZywgdGhlbiB3ZSBtdXN0IGFsd2F5cyByZWZsZWN0IChv\nciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAgICAgLy8gZGlyZWN0bHkgaWYgYWNj\nZXNzaWJsZSksIHNpbmNlIHRoZSByZWRlZmluZWQgbWV0aG9kcyB3aWxsIGFs\nd2F5cwogICAgICAgIC8vIHRyaWdnZXIgbWV0aG9kIGNhbGxzIHRvIFN0YXRl\nTWFuYWdlciwgZXZlbiBmcm9tIGludGVybmFsIGRpcmVjdC0KICAgICAgICAv\nLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxkIHdvcmsgYXJvdW5kIHRoaXMgYnkg\nbm90IHJlZGVmaW5pbmcsIGFuZAogICAgICAgIC8vIGp1c3QgZG8gYSBzdWJj\nbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBCdXQgdGhpcyBpcyBub3QgYSBnb29k\nIG9wdGlvbiwKICAgICAgICAvLyBzaW5jZSBpdCB3b3VsZCBzYWNyaWZpY2Ug\nbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2llbnQgZGlydHkgdHJhY2tpbmcuCgog\nICAgICAgIGlmIChnZXRSZWRlZmluZSgpIHx8IGlzRmllbGRBY2Nlc3MoZm1k\nKSkgewogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBmbWQuZ2V0\nTmFtZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKGdldENyZWF0ZVN1YmNsYXNz\nKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzLCBhbmQgd2Un\ncmUgbm90IHJlZGVmaW5pbmcuIElmIHdlJ3JlIG9wZXJhdGluZwogICAgICAg\nICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0aGF0IGlzIGRlZmluaXRlbHkgdGhl\nIHNhbWUgdHlwZSBhcyAndGhpcycsIHRoZW4KICAgICAgICAgICAgLy8gY2Fs\nbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcuIE90aGVy\nd2lzZSwgcmVmbGVjdAogICAgICAgICAgICAvLyB0byBib3RoIGJ5cGFzcyB0\ncmFja2luZyBhbmQgYXZvaWQgY2xhc3MgdmVyaWZpY2F0aW9uIGVycm9ycy4K\nICAgICAgICAgICAgaWYgKGZyb21TYW1lQ2xhc3MpIHsKICAgICAgICAgICAg\nICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdNZW1i\nZXIoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZChtZXRoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g\ncmVndWxhciBlbmhhbmNlbWVudCArIHByb3BlcnR5IGFjY2VzcwogICAgICAg\nICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVt\nYmVyKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIG1l\ndGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSB2\nYWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbnRvIHRoZSBmaWVsZCB2\nYWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxjb2RlPmZtZDwvY29kZT4uIEJl\nZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBkYXRhIHRvIGxvYWQg\nd2lsbAogICAgICogYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sgYW5kIHRo\nZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVkCiAgICAg\nKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRoZSBzdGFjay4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBj\nb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmluaW5nLCB0\naGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0aGUgZmll\nbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwgc2luY2Ug\ndGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAgICAgLy8g\ndHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBldmVuIGZy\nb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1c2FnZS4g\nV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZpbmluZywg\nYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJvYWNoIGlu\nc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAogICAgICAg\nIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRpbmcgYW5k\nIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYgKGdldFJl\nZGVmaW5lKCkgfHwgaXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAgICAgICAg\nIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCksIGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFjY2Vzcywg\nYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBpbnZva2UgdGhlCiAgICAgICAg\nICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFja2luZy4K\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9t\nYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBnZXRTZXR0\nZXJOYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2VtZW50ICsg\ncHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIHtAbGluayBJbnN0cnVjdGlvbn1zIHRvIGxvYWQgdGhl\nIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRoZQogICAgICogc3RhY2ssIGFu\nZCByZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0YXRpYzwvY29kZT4gaXMgc2V0\nLCB0aGVuCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiBpcyBpbiBhbiBhY2Nl\nc3NvciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0aWMgbWV0aG9kOwogICAgICog\nb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBDLXNwZWNpZmllZCBt\nZXRob2RzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0IGluc3Ry\ndWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAgICovCiAg\nICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFuY2UoQ29k\nZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYywKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoZm9yU3RhdGljICYmIGlzRmll\nbGRBY2Nlc3MoZm1kKSkKICAgICAgICAgICAgcmV0dXJuIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUge0BsaW5r\nIEluc3RydWN0aW9ufXMgdG8gbG9hZCB0aGUgaW5zdGFuY2UgdG8gbW9kaWZ5\nIG9udG8gdGhlCiAgICAgKiBzdGFjaywgYW5kIHJldHVybiBpdC4gIFRoaXMg\nbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZCB0byBsb2FkIHN0YXRpYwogICAg\nICogZmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0IGlu\nc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAgICov\nCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYykgewogICAgCXJldHVybiBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZvclN0YXRpYywgbnVsbCk7CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgaW50IGdldEFjY2Vzc29yUGFyYW1ldGVy\nT2Zmc2V0KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICByZXR1cm4gaXNG\naWVsZEFjY2VzcyhmbWQpID8gMSA6IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZmZpcm1zIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyB1c2luZyBmaWVsZC1i\nYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNQcm9wZXJ0eUFj\nY2VzcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgIAlyZXR1cm4gbWV0YSAh\nPSBudWxsICYmIChtZXRhLmlzTWl4ZWRBY2Nlc3MoKSB8fCAKICAgIAkJQWNj\nZXNzQ29kZS5pc1Byb3BlcnR5KG1ldGEuZ2V0QWNjZXNzVHlwZSgpKSk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgZ2l2ZW4g\nZmllbGQgaXMgdXNpbmcgZmllbGQtYmFzZWQgYWNjZXNzLgogICAgICovCiAg\nICBib29sZWFuIGlzUHJvcGVydHlBY2Nlc3MoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgIAlyZXR1cm4gZm1kICE9IG51bGwgJiYgQWNjZXNzQ29kZS5pc1By\nb3BlcnR5KGZtZC5nZXRBY2Nlc3NUeXBlKCkpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIGZpZWxkIGlzIHVzaW5n\nIG1ldGhvZC1iYXNlZCBhY2Nlc3MuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNG\naWVsZEFjY2VzcyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgCXJldHVybiBm\nbWQgIT0gbnVsbCAmJiBBY2Nlc3NDb2RlLmlzRmllbGQoZm1kLmdldEFjY2Vz\nc1R5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgdGhlIGdl\nbmVyYXRlZCBnZXR0ZXIge0BsaW5rIEJDTWV0aG9kfSBmb3IgPGNvZGU+Zm1k\nPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5nIGVudmlyb25tZW50IHdpbGwg\ndGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdzIGNvZGUgYmxvY2suCiAgICAg\nKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3JlYXRlR2V0TWV0aG9kKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVyOwogICAg\nICAgIGlmIChpc0ZpZWxkQWNjZXNzKGZtZCkpIHsKICAgICAgICAgICAgLy8g\nc3RhdGljIDxmaWVsZHR5cGU+IHBjR2V0PGZpZWxkPiAoWFhYIGluc3QpCiAg\nICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVjbGFyZWRGaWVs\nZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZ2V0dGVyID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkdldCIgKyBmbWQuZ2V0TmFtZSgpLCBmbWQu\nCiAgICAgICAgICAgICAgICBnZXREZWNsYXJlZFR5cGUoKS5nZXROYW1lKCks\nIG5ldyBTdHJpbmdbXXsgX3BjLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAg\nZ2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdzKCkK\nICAgICAgICAgICAgICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJBTlNJRU5U\nICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAgICAgICBn\nZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAgICAgICAgICBnZXR0ZXIuc2V0\nRmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBnZXR0ZXI7CiAgICAg\nICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAgICAgLy8g\nY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcgbmFtZTsg\nd2UgY2FuJ3QganVzdCByZXNldAogICAgICAgIC8vIHRoZSBuYW1lLCBiZWNh\ndXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0aGUgbWV0\naG9kCiAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0QmFj\na2luZ01lbWJlcigpOwogICAgICAgIGdldHRlciA9IF9wYy5nZXREZWNsYXJl\nZE1ldGhvZChtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgbWV0aC5nZXRQ\nYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBCQ01ldGhvZCBuZXdnZXR0ZXIg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAg\nICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0UGFyYW1l\ndGVyVHlwZXMoKSk7CiAgICAgICAgbmV3Z2V0dGVyLnNldEFjY2Vzc0ZsYWdz\nKGdldHRlci5nZXRBY2Nlc3NGbGFncygpKTsKICAgICAgICBuZXdnZXR0ZXIu\nbWFrZVByb3RlY3RlZCgpOyAKICAgICAgICB0cmFuc2ZlckNvZGVBdHRyaWJ1\ndGVzKGdldHRlciwgbmV3Z2V0dGVyKTsKICAgICAgICByZXR1cm4gZ2V0dGVy\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBnZW5lcmF0ZWQg\nc2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxjb2RlPmZtZDwvY29kZT4u\nIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVudCB3aWxsIHRoZW4gcG9w\ndWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2NrLgogICAgICovCiAgICBw\ncml2YXRlIEJDTWV0aG9kIGNyZWF0ZVNldE1ldGhvZChGaWVsZE1ldGFEYXRh\nIGZtZCkgewogICAgICAgIEJDTWV0aG9kIHNldHRlcjsKICAgICAgICBpZiAo\naXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAgICAgICAgIC8vIHN0YXRpYyB2\nb2lkIHBjU2V0PGZpZWxkPiAoWFhYIGluc3QsIDxmaWVsZHR5cGU+IHZhbHVl\nKQogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVk\nRmllbGQoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHNldHRlciA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXQiICsgZm1kLmdldE5hbWUoKSwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBnZXRU\neXBlKF9tZXRhKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAg\nICAgICBzZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNjZXNzRmxh\nZ3MoKQogICAgICAgICAgICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VTU19UUkFO\nU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAgICAgICAg\nICAgIHNldHRlci5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgIHNldHRl\nci5zZXRGaW5hbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHNldHRlcjsK\nICAgICAgICB9CgogICAgICAgIC8vIHByb3BlcnR5IGFjY2VzczoKICAgICAg\nICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBhIG5ldyBu\nYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0CiAgICAgICAgLy8gdGhlIG5hbWUs\nIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28gcmVzZXQgYWxsIGNhbGxzIHRvIHRo\nZSBtZXRob2QKICAgICAgICBzZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRo\nb2QoZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIEJDTWV0aG9k\nIG5ld3NldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArIHNldHRlci5n\nZXROYW1lKCksCiAgICAgICAgICAgIHNldHRlci5nZXRSZXR1cm5OYW1lKCks\nIHNldHRlci5nZXRQYXJhbU5hbWVzKCkpOwogICAgICAgIG5ld3NldHRlci5z\nZXRBY2Nlc3NGbGFncyhzZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7CiAgICAg\nICAgbmV3c2V0dGVyLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICB0cmFuc2Zl\nckNvZGVBdHRyaWJ1dGVzKHNldHRlciwgbmV3c2V0dGVyKTsKICAgICAgICBy\nZXR1cm4gc2V0dGVyOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRF\nbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpIHsKICAgICAgICAv\nLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9uKCkK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAKICAgICAgICAgICAgICAgICJHZXRFbmhhbmNlbWVudENvbnRyYWN0\nVmVyc2lvbiIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1h\na2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29k\nZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoRU5I\nQU5DRVJfVkVSU0lPTik7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGNvbmNyZXRlIHR5cGUgZm9yIHRoZSBnaXZlbiBjbGFzcywgaS5l\nLiBpbXBsIGZvciBtYW5hZ2VkCiAgICAgKiBpbnRlcmZhY2VzCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhLmdldEludGVyZmFjZUltcGwoKSAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbWV0YS5nZXRJbnRlcmZhY2VJbXBsKCk7\nCiAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogTW92ZSBjb2RlLXJlbGF0ZWQgYXR0cmlidXRl\ncyBmcm9tIG9uZSBtZXRob2QgdG8gYW5vdGhlci4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgdm9pZCB0cmFuc2ZlckNvZGVBdHRyaWJ1dGVzKEJDTWV0\naG9kIGZyb20sIEJDTWV0aG9kIHRvKSB7CiAgICAgICAgQ29kZSBjb2RlID0g\nZnJvbS5nZXRDb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShjb2RlKTsKICAgICAg\nICAgICAgZnJvbS5yZW1vdmVDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBF\neGNlcHRpb25zIGV4Y2VwcyA9IGZyb20uZ2V0RXhjZXB0aW9ucyhmYWxzZSk7\nCiAgICAgICAgaWYgKGV4Y2VwcyAhPSBudWxsKQogICAgICAgICAgICB0by5h\nZGRBdHRyaWJ1dGUoZXhjZXBzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVz\nYWdlOiBqYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDRW5oYW5j\nZXIgW29wdGlvbl0qCiAgICAgKiAmbHQ7Y2xhc3MgbmFtZSB8IC5qYXZhIGZp\nbGUgfCAuY2xhc3MgZmlsZSB8IC5qZG8gZmlsZSZndDsrCiAgICAgKiAgV2hl\ncmUgdGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVkLgogICAg\nICogPHVsPgogICAgICogPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZsdDtwcm9w\nZXJ0aWVzIGZpbGUmZ3Q7PC9pPjogVGhlIHBhdGggdG8gYSBPcGVuSlBBCiAg\nICAgKiBwcm9wZXJ0aWVzIGZpbGUgY29udGFpbmluZyBpbmZvcm1hdGlvbiBh\ncyBvdXRsaW5lZCBpbgogICAgICoge0BsaW5rIENvbmZpZ3VyYXRpb259OyBv\ncHRpb25hbC48L2xpPgogICAgICogPGxpPjxpPi0mbHQ7cHJvcGVydHkgbmFt\nZSZndDsgJmx0O3Byb3BlcnR5IHZhbHVlJmd0OzwvaT46IEFsbCBiZWFuCiAg\nICAgKiBwcm9wZXJ0aWVzIG9mIHRoZSBzdGFuZGFyZCBPcGVuSlBBIHtAbGlu\nayBPcGVuSlBBQ29uZmlndXJhdGlvbn0gY2FuIGJlCiAgICAgKiBzZXQgYnkg\ndXNpbmcgdGhlaXIgbmFtZXMgYW5kIHN1cHBseWluZyBhIHZhbHVlOyBmb3Ig\nZXhhbXBsZToKICAgICAqIDxsaT48aT4tZGlyZWN0b3J5Ly1kICZsdDtidWls\nZCBkaXJlY3RvcnkmZ3Q7PC9pPjogVGhlIHBhdGggdG8gdGhlIGJhc2UKICAg\nICAqIGRpcmVjdG9yeSB3aGVyZSBlbmhhbmNlZCBjbGFzc2VzIGFyZSBzdG9y\nZWQuIEJ5IGRlZmF1bHQsIHRoZQogICAgICogZW5oYW5jZXIgb3ZlcndyaXRl\ncyB0aGUgb3JpZ2luYWwgLmNsYXNzIGZpbGUgd2l0aCB0aGUgZW5oYW5jZWQK\nICAgICAqIHZlcnNpb24uIFVzZSB0aGlzIG9wdGlvbiB0byBzdG9yZSB0aGUg\nZ2VuZXJhdGVkIC5jbGFzcyBmaWxlIGluCiAgICAgKiBhbm90aGVyIGRpcmVj\ndG9yeS4gVGhlIHBhY2thZ2Ugc3RydWN0dXJlIHdpbGwgYmUgY3JlYXRlZCBi\nZW5lYXRoCiAgICAgKiB0aGUgZ2l2ZW4gZGlyZWN0b3J5LjwvbGk+CiAgICAg\nKiA8bGk+PGk+LWFkZERlZmF1bHRDb25zdHJ1Y3Rvci8tYWRjIFt0cnVlL3Qg\nfCBmYWxzZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGFkZCBhIGRlZmF1\nbHQgY29uc3RydWN0b3IgdG8gcGVyc2lzdGVudCBjbGFzc2VzIG1pc3Npbmcg\nb25lLCBhcwogICAgICogb3Bwb3NlZCB0byB0aHJvd2luZyBhbiBleGNlcHRp\nb24uIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48aT4tdG1w\nQ2xhc3NMb2FkZXIvLXRjbCBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+OiBXaGV0\naGVyIHRvCiAgICAgKiBsb2FkIHRoZSBwcmUtZW5oYW5jZWQgY2xhc3NlcyB1\nc2luZyBhIHRlbXBvcmFyeSBjbGFzcyBsb2FkZXIuCiAgICAgKiBEZWZhdWx0\ncyB0byB0cnVlLiBTZXQgdGhpcyB0byBmYWxzZSB3aGVuIGF0dGVtcHRpbmcg\ndG8gZGVidWcKICAgICAqIGNsYXNzIGxvYWRpbmcgZXJyb3JzLjwvbGk+CiAg\nICAgKiA8bGk+PGk+LWVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucy8tZXBy\nIFt0cnVlL3QgfCBmYWxzZS9mXTwvaT46CiAgICAgKiBXaGV0aGVyIHRvIHRo\ncm93IGFuIGV4Y2VwdGlvbiBpZiBhIFBST1BFUlRZIGFjY2VzcyBlbnRpdHkg\nYXBwZWFycwogICAgICogdG8gYmUgdmlvbGF0aW5nIHN0YW5kYXJkIHByb3Bl\ncnR5IHJlc3RyaWN0aW9ucy4gRGVmYXVsdHMgdG8gZmFsc2UuPC9saT4KICAg\nICAqIDwvdWw+CiAgICAgKiAgRWFjaCBhZGRpdGlvbmFsIGFyZ3VtZW50IGNh\nbiBiZSBlaXRoZXIgdGhlIGZ1bGwgY2xhc3MgbmFtZSBvZiB0aGUKICAgICAq\nIHR5cGUgdG8gZW5oYW5jZSwgdGhlIHBhdGggdG8gdGhlIC5qYXZhIGZpbGUg\nZm9yIHRoZSB0eXBlLCB0aGUgcGF0aCB0bwogICAgICogdGhlIC5jbGFzcyBm\naWxlIGZvciB0aGUgdHlwZSwgb3IgdGhlIHBhdGggdG8gYSAuamRvIGZpbGUg\nbGlzdGluZyBvbmUKICAgICAqIG9yIG1vcmUgdHlwZXMgdG8gZW5oYW5jZS4K\nICAgICAqIElmIHRoZSB0eXBlIGJlaW5nIGVuaGFuY2VkIGhhcyBtZXRhZGF0\nYSwgaXQgd2lsbCBiZSBlbmhhbmNlZCBhcyBhCiAgICAgKiBwZXJzaXN0ZW5j\nZSBjYXBhYmxlIGNsYXNzLiBJZiBub3QsIGl0IHdpbGwgYmUgY29uc2lkZXJl\nZCBhIHBlcnNpc3RlbmNlCiAgICAgKiBhd2FyZSBjbGFzcywgYW5kIGFsbCBh\nY2Nlc3MgdG8gZmllbGRzIG9mIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3Nl\ncwogICAgICogd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYXBwcm9wcmlhdGUJ\nZ2V0L3NldCBtZXRob2QuIElmIHRoZSB0eXBlCiAgICAgKiBleHBsaWNpdGx5\nIGRlY2xhcmVzIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGludGVyZmFjZSwg\naXQgd2lsbAogICAgICogbm90IGJlIGVuaGFuY2VkLiBUaHVzLCBpdCBpcyBz\nYWZlIHRvIGludm9rZSB0aGUgZW5oYW5jZXIgb24gY2xhc3NlcwogICAgICog\ndGhhdCBhcmUgYWxyZWFkeSBlbmhhbmNlZC4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAgICAgIE9w\ndGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgYXJncyA9IG9w\ndHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAgICAgICAgaWYgKCFydW4oYXJn\ncywgb3B0cykpCiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbihfbG9j\nLmdldCgiZW5oYW5jZS11c2FnZSIpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJ1biB0aGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlkIG9wdGlv\nbnMgZ2l2ZW4uIFJ1bnMgYWdhaW5zdCBhbGwKICAgICAqIHRoZSBwZXJzaXN0\nZW5jZSB1bml0cyBkZWZpbmVkIGluIHRoZSByZXNvdXJjZSB0byBwYXJzZS4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihmaW5hbCBT\ndHJpbmdbXSBhcmdzLCBPcHRpb25zIG9wdHMpIHsKICAgICAgICByZXR1cm4g\nQ29uZmlndXJhdGlvbnMucnVuQWdhaW5zdEFsbEFuY2hvcnMob3B0cywKICAg\nICAgICAgICAgbmV3IENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlKCkgewogICAg\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW4oT3B0aW9ucyBvcHRzKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICAgICAgT3BlbkpQQUNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBPcGVuSlBBQ29uZmlndXJhdGlvbkltcGwo\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIFBDRW5oYW5jZXIucnVuKGNvbmYsIGFyZ3MsIG9wdHMpOwogICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBj\nb25mLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0aGUgdG9v\nbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgZ2l2ZW4uCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQQUNv\nbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBPcHRp\nb25zIG9wdHMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBGbGFncyBmbGFncyA9IG5ldyBGbGFncygpOwogICAgICAgIGZsYWdzLmRp\ncmVjdG9yeSA9IEZpbGVzLmdldEZpbGUob3B0cy5yZW1vdmVQcm9wZXJ0eSgi\nZGlyZWN0b3J5IiwgImQiLAogICAgICAgICAgICBudWxsKSwgbnVsbCk7CiAg\nICAgICAgZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yID0gb3B0cy5yZW1v\ndmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJhZGREZWZhdWx0Q29u\nc3RydWN0b3IiLCAiYWRjIiwgZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9y\nKTsKICAgICAgICBmbGFncy50bXBDbGFzc0xvYWRlciA9IG9wdHMucmVtb3Zl\nQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgidG1wQ2xhc3NMb2FkZXIi\nLCAidGNsIiwgZmxhZ3MudG1wQ2xhc3NMb2FkZXIpOwogICAgICAgIGZsYWdz\nLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IG9wdHMucmVtb3ZlQm9v\nbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiZW5mb3JjZVByb3BlcnR5UmVz\ndHJpY3Rpb25zIiwgImVwciIsCiAgICAgICAgICAgICAgICBmbGFncy5lbmZv\ncmNlUHJvcGVydHlSZXN0cmljdGlvbnMpOwoKICAgICAgICAvLyBmb3IgdW5p\ndCB0ZXN0aW5nCiAgICAgICAgQnl0ZWNvZGVXcml0ZXIgd3JpdGVyID0gKEJ5\ndGVjb2RlV3JpdGVyKSBvcHRzLmdldCgKICAgICAgICAgICAgUENFbmhhbmNl\nci5jbGFzcy5nZXROYW1lKCkgKyAiI2J5dGVjb2RlV3JpdGVyIik7CgogICAg\nICAgIENvbmZpZ3VyYXRpb25zLnBvcHVsYXRlQ29uZmlndXJhdGlvbihjb25m\nLCBvcHRzKTsKICAgICAgICByZXR1cm4gcnVuKGNvbmYsIGFyZ3MsIGZsYWdz\nLCBudWxsLCB3cml0ZXIsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICog\nRW5oYW5jZSB0aGUgZ2l2ZW4gY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBib29sZWFuIHJ1bihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25m\nLCBTdHJpbmdbXSBhcmdzLAogICAgICAgIEZsYWdzIGZsYWdzLCBNZXRhRGF0\nYVJlcG9zaXRvcnkgcmVwb3MsIEJ5dGVjb2RlV3JpdGVyIHdyaXRlciwKICAg\nICAgICBDbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAobG9hZGVyID09IG51bGwpCiAgICAgICAg\nICAgIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNlKCku\nCiAgICAgICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihQQ0VuaGFuY2VyLmNs\nYXNzLCBudWxsKTsKICAgICAgICBpZiAoZmxhZ3MudG1wQ2xhc3NMb2FkZXIp\nCiAgICAgICAgICAgIGxvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAubmV3VGVt\ncG9yYXJ5Q2xhc3NMb2FkZXJBY3Rpb24obG9hZGVyKSk7CgogICAgICAgIGlm\nIChyZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJlcG9zID0gY29uZi5u\nZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICBy\nZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01F\nVEEpOwogICAgICAgIH0KCiAgICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9n\nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19UT09MKTsKICAgICAgICBDb2xs\nZWN0aW9uIGNsYXNzZXM7CiAgICAgICAgaWYgKGFyZ3MgPT0gbnVsbCB8fCBh\ncmdzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2Mu\nZ2V0KCJydW5uaW5nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAgICBjbGFz\nc2VzID0gcmVwb3MuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVlLCBsb2Fk\nZXIpOwogICAgICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIAlsb2cud2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8tZW5oYW5j\nZSIpKTsKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJnUGFyc2Vy\nIGNhcCA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4K\nICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5ld0NsYXNz\nQXJnUGFyc2VyKCk7CiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xvYWRlcihs\nb2FkZXIpOwogICAgICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJyYXlzLmFz\nTGlzdChjYXAucGFyc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAgIH0KCiAg\nICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsKICAgICAg\nICBCQ0NsYXNzIGJjOwogICAgICAgIFBDRW5oYW5jZXIgZW5oYW5jZXI7CiAg\nICAgICAgaW50IHN0YXR1czsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgT2JqZWN0IG8gPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJh\nY2UoX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZyIsIG8pKTsKCiAgICAgICAg\nICAgIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICAgICAg\nYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoU3RyaW5nKSBvLCBsb2FkZXIpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBiYyA9IHByb2plY3Qu\nbG9hZENsYXNzKChDbGFzcykgbyk7CiAgICAgICAgICAgIGVuaGFuY2VyID0g\nbmV3IFBDRW5oYW5jZXIoY29uZiwgYmMsIHJlcG9zLCBsb2FkZXIpOwogICAg\nICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBl\nbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAgICAgICAg\nICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAg\nICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGZs\nYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0YXR1\ncyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3RhdHVzID09\nIEVOSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShf\nbG9jLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpIHsKICAgICAgICAg\nICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtaW50ZXJmYWNl\nIikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNF\nX0FXQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJlbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAgICAgZW5oYW5jZXIu\ncmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHByb2plY3QuY2xlYXIo\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3Rv\ncnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRD\nb25zdHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1w\nQ2xhc3NMb2FkZXIgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29sZWFuIGVu\nZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwogICAgfQoKICAg\nIC8qKgogICAgICogUGx1Z2luIGludGVyZmFjZSBmb3IgYWRkaXRpb25hbCBl\nbmhhbmNlbWVudC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRlcmZh\nY2UgQXV4aWxpYXJ5RW5oYW5jZXIKICAgIHsKICAgICAgICBwdWJsaWMgdm9p\nZCBydW4gKEJDQ2xhc3MgYmMsIENsYXNzTWV0YURhdGEgbWV0YSk7CiAgICAg\nICAgcHVibGljIGJvb2xlYW4gc2tpcEVuaGFuY2UoQkNNZXRob2QgbSk7CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRJRE93bmluZ0NsYXNz\nKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldElE\nT3duaW5nQ2xhc3MiLCAKICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIG51bGwp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIAogICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNz\nKGdldFR5cGUoX21ldGEpKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICAKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KfQo=\n","encoding":"base64"}

