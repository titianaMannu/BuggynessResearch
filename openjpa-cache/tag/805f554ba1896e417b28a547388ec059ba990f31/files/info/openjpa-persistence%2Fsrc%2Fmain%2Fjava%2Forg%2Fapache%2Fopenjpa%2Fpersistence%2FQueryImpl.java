{"sha":"3b0333aed1381f37e06a1a5d12ea9de768bc18f7","node_id":"MDQ6QmxvYjIwNjM2NDozYjAzMzNhZWQxMzgxZjM3ZTA2YTFhNWQxMmVhOWRlNzY4YmMxOGY3","size":37887,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3b0333aed1381f37e06a1a5d12ea9de768bc18f7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5n\ndWFnZXMuTEFOR19QUkVQQVJFRF9TUUw7CgppbXBvcnQgamF2YS5pby5TZXJp\nYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5z\ncWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nbG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5GbHVzaE1vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTG9j\na01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTm9SZXN1bHRF\neGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Ob25VbmlxdWVS\nZXN1bHRFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QYXJh\nbWV0ZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlRlbXBvcmFsVHlwZTsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlR5cGVkUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5jcml0ZXJpYS5QYXJhbWV0ZXJFeHByZXNzaW9uOwoKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdRdWVyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGluZ1Jl\nc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZl\ndGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuUHJlcGFyZWRRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUHJlcGFyZWRRdWVyeUNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlPcGVyYXRpb25zOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeVN0YXRpc3RpY3M7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRpc3RpbmN0UmVzdWx0TGlz\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BZ2dy\nZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuanBxbC5KUFFMUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuT3JkZXJlZE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5jcml0ZXJpYS5Dcml0ZXJpYUJ1aWxkZXJJ\nbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlJ1bnRpbWVFeGNl\ncHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVXNlckV4Y2VwdGlvbjsKCgovKioKICogSW1wbGVtZW50YXRpb24gb2Yg\ne0BsaW5rIFF1ZXJ5fSBpbnRlcmZhY2UuCiAqIAogKiBAYXV0aG9yIE1hcmMg\nUHJ1ZCdob21tZWF1eAogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZh\nZG9jCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNs\nYXNzIFF1ZXJ5SW1wbDxYPiBpbXBsZW1lbnRzIE9wZW5KUEFRdWVyeVNQSTxY\nPiwgU2VyaWFsaXphYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKFF1ZXJ5SW1w\nbC5jbGFzcyk7CgoJcHJpdmF0ZSBEZWxlZ2F0aW5nUXVlcnkgX3F1ZXJ5OwoJ\ncHJpdmF0ZSB0cmFuc2llbnQgRW50aXR5TWFuYWdlckltcGwgX2VtOwoJcHJp\ndmF0ZSB0cmFuc2llbnQgRmV0Y2hQbGFuIF9mZXRjaDsKCiAgICBwcml2YXRl\nIE1hcDxQYXJhbWV0ZXI8Pz4sIE9iamVjdD4gX2JvdW5kUGFyYW1zOwogICAg\ncHJpdmF0ZSBNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+IF9kZWNsYXJlZFBh\ncmFtczsKCXByaXZhdGUgU3RyaW5nIF9pZDsKICAgIHByaXZhdGUgdHJhbnNp\nZW50IFJlZW50cmFudExvY2sgX2xvY2sgPSBudWxsOwoJcHJpdmF0ZSBIaW50\nSGFuZGxlciBfaGludEhhbmRsZXI7CgoJLyoqCgkgKiBDb25zdHJ1Y3Rvcjsg\nc3VwcGx5IGZhY3RvcnkgZXhjZXB0aW9uIHRyYW5zbGF0b3IgYW5kIGRlbGVn\nYXRlLgoJICogCgkgKiBAcGFyYW0gZW0gIFRoZSBFbnRpdHlNYW5hZ2VyIHdo\naWNoIGNyZWF0ZWQgdGhpcyBxdWVyeQoJICogQHBhcmFtIHJldCBFeGNlcHRp\nb24gdHJhbnNsYXRvciBmb3IgdGhpcyBxdWVyeQoJICogQHBhcmFtIHF1ZXJ5\nIFRoZSB1bmRlcmx5aW5nICJrZXJuZWwiIHF1ZXJ5LgoJICovCglwdWJsaWMg\nUXVlcnlJbXBsKEVudGl0eU1hbmFnZXJJbXBsIGVtLCBSdW50aW1lRXhjZXB0\naW9uVHJhbnNsYXRvciByZXQsIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnkgcXVlcnkpIHsKCQlfZW0gPSBlbTsKCQlfcXVlcnkgPSBuZXcgRGVs\nZWdhdGluZ1F1ZXJ5KHF1ZXJ5LCByZXQpOwoJCV9sb2NrID0gbmV3IFJlZW50\ncmFudExvY2soKTsKCX0KCgkvKioKCSAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nZmFjdG9yeSBhbmQgZGVsZWdhdGUuCgkgKiAKCSAqIEBkZXByZWNhdGVkCgkg\nKi8KCXB1YmxpYyBRdWVyeUltcGwoRW50aXR5TWFuYWdlckltcGwgZW0sIG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcXVlcnkpIHsKCQl0aGlz\nKGVtLCBudWxsLCBxdWVyeSk7Cgl9CgoJLyoqCgkgKiBEZWxlZ2F0ZS4KCSAq\nLwoJcHVibGljIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgZ2V0\nRGVsZWdhdGUoKSB7CgkJcmV0dXJuIF9xdWVyeS5nZXREZWxlZ2F0ZSgpOwoJ\nfQoKCXB1YmxpYyBPcGVuSlBBRW50aXR5TWFuYWdlciBnZXRFbnRpdHlNYW5h\nZ2VyKCkgewoJCXJldHVybiBfZW07Cgl9CgoJcHVibGljIFN0cmluZyBnZXRM\nYW5ndWFnZSgpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldExhbmd1YWdlKCk7Cgl9\nCgoJcHVibGljIFF1ZXJ5T3BlcmF0aW9uVHlwZSBnZXRPcGVyYXRpb24oKSB7\nCiAgICAgICAgcmV0dXJuIFF1ZXJ5T3BlcmF0aW9uVHlwZS5mcm9tS2VybmVs\nQ29uc3RhbnQoX3F1ZXJ5LmdldE9wZXJhdGlvbigpKTsKCX0KCglwdWJsaWMg\nRmV0Y2hQbGFuIGdldEZldGNoUGxhbigpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xv\nc2VJbnZva2VkKCk7CgkJX3F1ZXJ5LmFzc2VydE5vdFNlcmlhbGl6ZWQoKTsK\nCQlfcXVlcnkubG9jaygpOwoJCXRyeSB7CgkJCWlmIChfZmV0Y2ggPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9mZXRjaCA9ICgoRW50aXR5TWFuYWdlckZh\nY3RvcnlJbXBsKSBfZW0KICAgICAgICAgICAgICAgICAgICAgICAgLmdldEVu\ndGl0eU1hbmFnZXJGYWN0b3J5KCkpLnRvRmV0Y2hQbGFuKF9xdWVyeQogICAg\nICAgICAgICAgICAgICAgICAgICAuZ2V0QnJva2VyKCksIF9xdWVyeS5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKSk7CgkJCXJldHVybiBfZmV0Y2g7CgkJfSBm\naW5hbGx5IHsKCQkJX3F1ZXJ5LnVubG9jaygpOwoJCX0KCX0KCglwdWJsaWMg\nU3RyaW5nIGdldFF1ZXJ5U3RyaW5nKCkgewoJCVN0cmluZyByZXN1bHQgPSBf\ncXVlcnkuZ2V0UXVlcnlTdHJpbmcoKTsKCQlyZXR1cm4gcmVzdWx0ICE9IG51\nbGwgPyByZXN1bHQgOiBfaWQ7Cgl9CgoJcHVibGljIGJvb2xlYW4gZ2V0SWdu\nb3JlQ2hhbmdlcygpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldElnbm9yZUNoYW5n\nZXMoKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldElnbm9yZUNo\nYW5nZXMoYm9vbGVhbiBpZ25vcmUpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJ\nbnZva2VkKCk7CgkJX3F1ZXJ5LnNldElnbm9yZUNoYW5nZXMoaWdub3JlKTsK\nCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IGFk\nZEZpbHRlckxpc3RlbmVyKEZpbHRlckxpc3RlbmVyIGxpc3RlbmVyKSB7CgkJ\nX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5hZGRGaWx0\nZXJMaXN0ZW5lcihsaXN0ZW5lcik7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJcHVi\nbGljIE9wZW5KUEFRdWVyeTxYPiByZW1vdmVGaWx0ZXJMaXN0ZW5lcihGaWx0\nZXJMaXN0ZW5lciBsaXN0ZW5lcikgewoJCV9lbS5hc3NlcnROb3RDbG9zZUlu\ndm9rZWQoKTsKCQlfcXVlcnkucmVtb3ZlRmlsdGVyTGlzdGVuZXIobGlzdGVu\nZXIpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBPcGVuSlBBUXVlcnk8\nWD4gYWRkQWdncmVnYXRlTGlzdGVuZXIoQWdncmVnYXRlTGlzdGVuZXIgbGlz\ndGVuZXIpIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJX3F1\nZXJ5LmFkZEFnZ3JlZ2F0ZUxpc3RlbmVyKGxpc3RlbmVyKTsKCQlyZXR1cm4g\ndGhpczsKCX0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHJlbW92ZUFn\nZ3JlZ2F0ZUxpc3RlbmVyKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7\nCgkJX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5yZW1v\ndmVBZ2dyZWdhdGVMaXN0ZW5lcihsaXN0ZW5lcik7CgkJcmV0dXJuIHRoaXM7\nCgl9CgoJcHVibGljIENvbGxlY3Rpb248Pz4gZ2V0Q2FuZGlkYXRlQ29sbGVj\ndGlvbigpIHsKCQlyZXR1cm4gX3F1ZXJ5LmdldENhbmRpZGF0ZUNvbGxlY3Rp\nb24oKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldENhbmRpZGF0\nZUNvbGxlY3Rpb24oQ29sbGVjdGlvbiBjb2xsKSB7CgkJX2VtLmFzc2VydE5v\ndENsb3NlSW52b2tlZCgpOwoJCV9xdWVyeS5zZXRDYW5kaWRhdGVDb2xsZWN0\naW9uKGNvbGwpOwoJCXJldHVybiB0aGlzOwoJfQoKCXB1YmxpYyBDbGFzcyBn\nZXRSZXN1bHRDbGFzcygpIHsKCQlDbGFzcyByZXMgPSBfcXVlcnkuZ2V0UmVz\ndWx0VHlwZSgpOwoJCWlmIChyZXMgIT0gbnVsbCkKCQkJcmV0dXJuIHJlczsK\nCQlyZXR1cm4gX3F1ZXJ5LmdldENhbmRpZGF0ZVR5cGUoKTsKCX0KCglwdWJs\naWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFJlc3VsdENsYXNzKENsYXNzIGNscykg\newoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlpZiAoSW1wbEhl\nbHBlci5pc01hbmFnZWRUeXBlKF9lbS5nZXRDb25maWd1cmF0aW9uKCksIGNs\ncykpCgkJCV9xdWVyeS5zZXRDYW5kaWRhdGVUeXBlKGNscywgdHJ1ZSk7CgkJ\nZWxzZQoJCQlfcXVlcnkuc2V0UmVzdWx0VHlwZShjbHMpOwoJCXJldHVybiB0\naGlzOwoJfQoKCXB1YmxpYyBib29sZWFuIGhhc1N1YmNsYXNzZXMoKSB7CgkJ\ncmV0dXJuIF9xdWVyeS5oYXNTdWJjbGFzc2VzKCk7Cgl9CgoJcHVibGljIE9w\nZW5KUEFRdWVyeTxYPiBzZXRTdWJjbGFzc2VzKGJvb2xlYW4gc3VicykgewoJ\nCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKCQlDbGFzczw/PiBjbHMg\nPSBfcXVlcnkuZ2V0Q2FuZGlkYXRlVHlwZSgpOwogICAgICAgIF9xdWVyeS5z\nZXRDYW5kaWRhdGVFeHRlbnQoX3F1ZXJ5LmdldEJyb2tlcigpLm5ld0V4dGVu\ndChjbHMsIHN1YnMpKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgaW50\nIGdldEZpcnN0UmVzdWx0KCkgewoJCXJldHVybiBhc0ludChfcXVlcnkuZ2V0\nU3RhcnRSYW5nZSgpKTsKCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNl\ndEZpcnN0UmVzdWx0KGludCBzdGFydFBvc2l0aW9uKSB7CgkJX2VtLmFzc2Vy\ndE5vdENsb3NlSW52b2tlZCgpOwoJCWxvbmcgZW5kOwoJCWlmIChfcXVlcnku\nZ2V0RW5kUmFuZ2UoKSA9PSBMb25nLk1BWF9WQUxVRSkKCQkJZW5kID0gTG9u\nZy5NQVhfVkFMVUU7CgkJZWxzZQoJCQllbmQgPSBzdGFydFBvc2l0aW9uCiAg\nICAgICAgICAgICAgICAgICAgKyAoX3F1ZXJ5LmdldEVuZFJhbmdlKCkgLSBf\ncXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKCQlfcXVlcnkuc2V0UmFuZ2Uoc3Rh\ncnRQb3NpdGlvbiwgZW5kKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMg\naW50IGdldE1heFJlc3VsdHMoKSB7CgkJcmV0dXJuIGFzSW50KF9xdWVyeS5n\nZXRFbmRSYW5nZSgpIC0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKSk7Cgl9CgoJ\ncHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRNYXhSZXN1bHRzKGludCBtYXgp\nIHsKCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CgkJbG9uZyBzdGFy\ndCA9IF9xdWVyeS5nZXRTdGFydFJhbmdlKCk7CgkJaWYgKG1heCA9PSBJbnRl\nZ2VyLk1BWF9WQUxVRSkKCQkJX3F1ZXJ5LnNldFJhbmdlKHN0YXJ0LCBMb25n\nLk1BWF9WQUxVRSk7CgkJZWxzZQoJCQlfcXVlcnkuc2V0UmFuZ2Uoc3RhcnQs\nIHN0YXJ0ICsgbWF4KTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgT3Bl\nbkpQQVF1ZXJ5PFg+IGNvbXBpbGUoKSB7CgkJX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwoJCV9xdWVyeS5jb21waWxlKCk7CgkJcmV0dXJuIHRoaXM7\nCgl9CgkKCS8qKgoJICogR2V0cyBhIG1hcCBvZiB2YWx1ZXMgb2YgZWFjaCBw\nYXJhbWV0ZXIgaW5kZXhlZCBieSB0aGVpciA8ZW0+b3JpZ2luYWw8L2VtPiBr\nZXkuCgkgKiAKCSAqIEByZXR1cm4gYW4gZW1wdHkgbWFwIGlmIG5vIHBhcmFt\nZXRlciBpcyBkZWNsYXJlZCBmb3IgdGhpcyBxdWVyeS4KICAgICAqIFRoZSB1\nbmJvdW5kIHBhcmFtZXRlcnMgaGFzIGEgdmFsdWUgb2YgbnVsbCB3aGljaCBp\ncyBpbmRpc3Rpbmd1aXNoYWJsZQogICAgICogZnJvbSB0aGUgdmFsdWUgYmVp\nbmcgYm91bmQgdG8gbnVsbC4KCSAqLwoJTWFwPE9iamVjdCxPYmplY3Q+IGdl\ndFBhcmFtZXRlclZhbHVlcygpIHsKCSAgICBNYXA8T2JqZWN0LE9iamVjdD4g\ncmVzdWx0ID0gbmV3IEhhc2hNYXA8T2JqZWN0LE9iamVjdD4oKTsKCSAgICBp\nZiAoX2JvdW5kUGFyYW1zID09IG51bGwpCgkgICAgICAgIHJldHVybiByZXN1\nbHQ7CgkgICAgZm9yIChNYXAuRW50cnk8T2JqZWN0LFBhcmFtZXRlcjw/Pj4g\nZW50cnkgOiBnZXREZWNsYXJlZFBhcmFtZXRlcnMoKS5lbnRyeVNldCgpKSB7\nCgkgICAgICAgIE9iamVjdCBwYXJhbUtleSA9IGVudHJ5LmdldEtleSgpOwoJ\nICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBlbnRyeS5nZXRWYWx1ZSgp\nOwoJICAgICAgICByZXN1bHQucHV0KHBhcmFtS2V5LCBfYm91bmRQYXJhbXMu\nZ2V0KHBhcmFtKSk7CgkgICAgfQoJICAgIHJldHVybiByZXN1bHQ7Cgl9CgkK\nCXByaXZhdGUgT2JqZWN0IGV4ZWN1dGUoKSB7CiAgICAgICAgaWYgKCFpc05h\ndGl2ZSgpICYmIF9xdWVyeS5nZXRPcGVyYXRpb24oKSAhPSBRdWVyeU9wZXJh\ndGlvbnMuT1BfU0VMRUNUKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qtc2VsZWN0LXF1ZXJ5Iiwg\nZ2V0UXVlcnlTdHJpbmcoKSksIG51bGwsIG51bGwsIGZhbHNlKTsKCQl0cnkg\newoJCSAgICBsb2NrKCk7CiAgICAgICAgICAgIE1hcCBwYXJhbXMgPSBnZXRQ\nYXJhbWV0ZXJWYWx1ZXMoKTsKICAgICAgICAgICAgYm9vbGVhbiByZWdpc3Rl\ncmVkID0gcHJlRXhlY3V0ZShwYXJhbXMpOwogICAgICAgICAgICBPYmplY3Qg\ncmVzdWx0ID0gX3F1ZXJ5LmV4ZWN1dGUocGFyYW1zKTsKICAgICAgICAgICAg\naWYgKHJlZ2lzdGVyZWQpIHsKICAgICAgICAgICAgICAgIHBvc3RFeGVjdXRl\nKHJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKCQl9IGNhdGNoIChMb2NrVGltZW91dEV4Y2VwdGlvbiBlKSB7CgkJ\nICAgIHRocm93IG5ldyBRdWVyeVRpbWVvdXRFeGNlcHRpb24oZS5nZXRNZXNz\nYWdlKCksIG5ldyBUaHJvd2FibGVbXXtlfSwgdGhpcyk7CgkJfSBmaW5hbGx5\nIHsKCQkgICAgdW5sb2NrKCk7CgkJfQoJfQoJCglwdWJsaWMgTGlzdCBnZXRS\nZXN1bHRMaXN0KCkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nCQlPYmplY3Qgb2IgPSBleGVjdXRlKCk7CgkJaWYgKG9iIGluc3RhbmNlb2Yg\nTGlzdCkgewoJCQlMaXN0IHJldCA9IChMaXN0KSBvYjsKCQkJaWYgKHJldCBp\nbnN0YW5jZW9mIFJlc3VsdExpc3QpIHsKCQkJICAgIFJ1bnRpbWVFeGNlcHRp\nb25UcmFuc2xhdG9yIHRyYW5zID0gUGVyc2lzdGVuY2VFeGNlcHRpb25zLmdl\ndFJvbGxiYWNrVHJhbnNsYXRvcihfZW0pOwoJCQkgICAgaWYgKF9xdWVyeS5p\nc0Rpc3RpbmN0KCkpIHsKCQkJICAgICAgICByZXR1cm4gbmV3IERpc3RpbmN0\nUmVzdWx0TGlzdCgoUmVzdWx0TGlzdCkgcmV0LCB0cmFucyk7CgkJCSAgICB9\nIGVsc2UgewoJCQkgICAgICAgIHJldHVybiBuZXcgRGVsZWdhdGluZ1Jlc3Vs\ndExpc3QoKFJlc3VsdExpc3QpIHJldCwgdHJhbnMpOwoJCQkgICAgfQoJCQl9\nIGVsc2UgewoJCQkJcmV0dXJuIHJldDsKCQkJfQoJCX0KCgkJcmV0dXJuIENv\nbGxlY3Rpb25zLnNpbmdsZXRvbkxpc3Qob2IpOwoJfQoKCS8qKgoJICogRXhl\nY3V0ZSBhIHF1ZXJ5IHRoYXQgcmV0dXJucyBhIHNpbmdsZSByZXN1bHQuCgkg\nKi8KCXB1YmxpYyBYIGdldFNpbmdsZVJlc3VsdCgpIHsKCQlfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgc2V0SGludCgib3BlbmpwYS5o\naW50Lk9wdGltaXplUmVzdWx0Q291bnQiLCAxKTsgLy8gZm9yIERCMiBvcHRp\nbWl6YXRpb24KCQlMaXN0IHJlc3VsdCA9IGdldFJlc3VsdExpc3QoKTsKCQlp\nZiAocmVzdWx0ID09IG51bGwgfHwgcmVzdWx0LmlzRW1wdHkoKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1yZXN1bHQiLCBnZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAg\nICAgIC5nZXRNZXNzYWdlKCkpOwoJCWlmIChyZXN1bHQuc2l6ZSgpID4gMSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlv\nbihfbG9jLmdldCgibm9uLXVuaXF1ZS1yZXN1bHQiLAogICAgICAgICAgICAg\nICAgICAgIGdldFF1ZXJ5U3RyaW5nKCksIHJlc3VsdC5zaXplKCkpLmdldE1l\nc3NhZ2UoKSk7CgkJdHJ5IHsKCQkgICAgcmV0dXJuIChYKXJlc3VsdC5nZXQo\nMCk7CgkJfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IE5vUmVzdWx0RXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1yZXN1bHQi\nLCBnZXRRdWVyeVN0cmluZygpKQogICAgICAgICAgICAgICAgLmdldE1lc3Nh\nZ2UoKSk7CgkJfQoJfQoKCXB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHsK\nCQlfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgTWFwPD8s\nPz4gcGFyYW1WYWx1ZXMgPSBnZXRQYXJhbWV0ZXJWYWx1ZXMoKTsKCQlpZiAo\nX3F1ZXJ5LmdldE9wZXJhdGlvbigpID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9E\nRUxFVEUpIHsKCQkgICByZXR1cm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0\neSgpID8gX3F1ZXJ5LmRlbGV0ZUFsbCgpIDogX3F1ZXJ5LmRlbGV0ZUFsbChw\nYXJhbVZhbHVlcykpOwoJCX0KCQlpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigp\nID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9VUERBVEUpIHsKCSAgICAgICByZXR1\ncm4gYXNJbnQocGFyYW1WYWx1ZXMuaXNFbXB0eSgpID8gX3F1ZXJ5LnVwZGF0\nZUFsbCgpIDogX3F1ZXJ5LnVwZGF0ZUFsbChwYXJhbVZhbHVlcykpOwoJCX0K\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtdXBkYXRlLWRlbGV0ZS1xdWVyeSIsIGdldFF1ZXJ5U3RyaW5n\nKCkpLCBudWxsLCBudWxsLCBmYWxzZSk7Cgl9CgoJLyoqCgkgKiBDYXN0IHRo\nZSBzcGVjaWZpZWQgbG9uZyBkb3duIHRvIGFuIGludCwgZmlyc3QgY2hlY2tp\nbmcgZm9yIG92ZXJmbG93LgoJICovCglwcml2YXRlIHN0YXRpYyBpbnQgYXNJ\nbnQobG9uZyBsKSB7CgkJaWYgKGwgPiBJbnRlZ2VyLk1BWF9WQUxVRSkKCQkJ\ncmV0dXJuIEludGVnZXIuTUFYX1ZBTFVFOwogICAgICAgIGlmIChsIDwgSW50\nZWdlci5NSU5fVkFMVUUpIC8vIHVubGlrZWx5LCBidXQgd2UgbWlnaHQgYXMg\nd2VsbCBjaGVjawoJCQlyZXR1cm4gSW50ZWdlci5NSU5fVkFMVUU7CgkJcmV0\ndXJuIChpbnQpIGw7Cgl9CgoJcHVibGljIEZsdXNoTW9kZVR5cGUgZ2V0Rmx1\nc2hNb2RlKCkgewoJCXJldHVybiBFbnRpdHlNYW5hZ2VySW1wbC5mcm9tRmx1\nc2hCZWZvcmVRdWVyaWVzKF9xdWVyeQogICAgICAgICAgICAgICAgLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpLmdldEZsdXNoQmVmb3JlUXVlcmllcygpKTsK\nCX0KCglwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldEZsdXNoTW9kZShGbHVz\naE1vZGVUeXBlIGZsdXNoTW9kZSkgewoJCV9lbS5hc3NlcnROb3RDbG9zZUlu\ndm9rZWQoKTsKCQlfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0\nRmx1c2hCZWZvcmVRdWVyaWVzKAogICAgICAgICAgICAgICAgRW50aXR5TWFu\nYWdlckltcGwudG9GbHVzaEJlZm9yZVF1ZXJpZXMoZmx1c2hNb2RlKSk7CgkJ\ncmV0dXJuIHRoaXM7Cgl9CgoJcHVibGljIGJvb2xlYW4gaXNOYXRpdmUoKSB7\nCgkJcmV0dXJuIFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhnZXRM\nYW5ndWFnZSgpKTsKCX0KCgkvKioKCSAqIEFzc2VydHMgdGhhdCB0aGlzIHF1\nZXJ5IGlzIGEgSlBRTCBvciBDcml0ZXJpYSBRdWVyeS4KCSAqLwoJdm9pZCBh\nc3NlcnRKUFFMT3JDcml0ZXJpYVF1ZXJ5KCkgewogICAgICAgIFN0cmluZyBs\nYW5ndWFnZSA9IGdldExhbmd1YWdlKCk7CiAgICAgICAgaWYgKEpQUUxQYXJz\nZXIuTEFOR19KUFFMLmVxdWFscyhsYW5ndWFnZSkgCiAgICAgICAgIHx8IFF1\nZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURfU1FMLmVxdWFscyhsYW5ndWFn\nZSkKICAgICAgICAgfHwgQ3JpdGVyaWFCdWlsZGVySW1wbC5MQU5HX0NSSVRF\nUklBLmVxdWFscyhsYW5ndWFnZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1qcHFsLW9yLWNyaXRlcmlh\nLXF1ZXJ5IikuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9Cgl9CgoJcHVibGlj\nIE9wZW5KUEFRdWVyeTxYPiBjbG9zZUFsbCgpIHsKCQlfcXVlcnkuY2xvc2VB\nbGwoKTsKCQlyZXR1cm4gdGhpczsKCX0KCglwdWJsaWMgU3RyaW5nW10gZ2V0\nRGF0YVN0b3JlQWN0aW9ucyhNYXAgcGFyYW1zKSB7CgkJcmV0dXJuIF9xdWVy\neS5nZXREYXRhU3RvcmVBY3Rpb25zKHBhcmFtcyk7Cgl9CgogICAgcHVibGlj\nIExvY2tNb2RlVHlwZSBnZXRMb2NrTW9kZSgpIHsKICAgICAgICBhc3NlcnRK\nUFFMT3JDcml0ZXJpYVF1ZXJ5KCk7CiAgICAgICAgcmV0dXJuIGdldEZldGNo\nUGxhbigpLmdldFJlYWRMb2NrTW9kZSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0cyBsb2NrIG1vZGUgb24gdGhlIGdpdmVuIHF1ZXJ5LgogICAgICog\nSWYgdGhlIHRhcmdldCBxdWVyeSBoYXMgYmVlbiBwcmVwYXJlZCBhbmQgY2Fj\naGVkLCB0aGVuIGlnbm9yZXMgdGhlIGNhY2hlZCB2ZXJzaW9uLgogICAgICog\nQHNlZSAjaWdub3JlUHJlcGFyZWRRdWVyeSgpCiAgICAgKi8KICAgIHB1Ymxp\nYyBUeXBlZFF1ZXJ5PFg+IHNldExvY2tNb2RlKExvY2tNb2RlVHlwZSBsb2Nr\nTW9kZSkgewogICAgICAgIFN0cmluZyBsYW5ndWFnZSA9IGdldExhbmd1YWdl\nKCk7CiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJFUEFSRURf\nU1FMLmVxdWFscyhsYW5ndWFnZSkpIHsKICAgICAgICAgICAgaWdub3JlUHJl\ncGFyZWRRdWVyeSgpOwogICAgICAgIH0KICAgICAgICBhc3NlcnRKUFFMT3JD\ncml0ZXJpYVF1ZXJ5KCk7CiAgICAgICBnZXRGZXRjaFBsYW4oKS5zZXRSZWFk\nTG9ja01vZGUobG9ja01vZGUpOwogICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgoJcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gKF9x\ndWVyeSA9PSBudWxsKSA/IDAgOiBfcXVlcnkuaGFzaENvZGUoKTsKCX0KCglw\ndWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CgkJaWYgKG90\naGVyID09IHRoaXMpCgkJCXJldHVybiB0cnVlOwogICAgICAgIGlmICgob3Ro\nZXIgPT0gbnVsbCkgfHwgKG90aGVyLmdldENsYXNzKCkgIT0gdGhpcy5nZXRD\nbGFzcygpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChfcXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJ\nCXJldHVybiBfcXVlcnkuZXF1YWxzKCgoUXVlcnlJbXBsKSBvdGhlcikuX3F1\nZXJ5KTsKCX0KCgkvKioKCSAqIEdldCBhbGwgdGhlIGFjdGl2ZSBoaW50cyBh\nbmQgdGhlaXIgdmFsdWVzLgoJICogCgkgKi8KICAgIC8vVE9ETzogSlBBIDIu\nMCBIaW50cyB0aGF0IGFyZSBub3Qgc2V0IHRvIEZldGNoQ29uZmlndXJhdGlv\nbiAKICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBPYmplY3Q+IGdldEhpbnRzKCkg\newogICAgICAgIGlmIChfaGludEhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TWFwKCk7CiAgICAgICAgcmV0\ndXJuIF9oaW50SGFuZGxlci5nZXRIaW50cygpOwogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBUXVlcnk8WD4gc2V0SGludChTdHJpbmcga2V5LCBPYmplY3Qg\ndmFsdWUpIHsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7\nCiAgICAgICAgaWYgKF9oaW50SGFuZGxlciA9PSBudWxsKSB7CiAgICAgICAg\nICAgIF9oaW50SGFuZGxlciA9IG5ldyBIaW50SGFuZGxlcih0aGlzKTsKICAg\nICAgICB9CiAgICAgICAgX2hpbnRIYW5kbGVyLnNldEhpbnQoa2V5LCB2YWx1\nZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNl\ndDxTdHJpbmc+IGdldFN1cHBvcnRlZEhpbnRzKCkgewogICAgICAgIGlmIChf\naGludEhhbmRsZXIgPT0gbnVsbCkgewogICAgICAgICAgICBfaGludEhhbmRs\nZXIgPSBuZXcgSGludEhhbmRsZXIodGhpcyk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBfaGludEhhbmRsZXIuZ2V0U3VwcG9ydGVkSGludHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVud3JhcHMgdGhpcyByZWNlaXZlciB0byBh\nbiBpbnN0YW5jZSBvZiB0aGUgZ2l2ZW4gY2xhc3MsIGlmIHBvc3NpYmxlLgog\nICAgICogCiAgICAgKiBAZXhjZXB0aW9uIGlmIHRoZSBnaXZlbiBjbGFzcyBp\ncyBudWxsLCBnZW5lcmljIDxjb2RlPk9iamVjdC5jbGFzczwvY29kZT4gb3Ig\nYSBjbGFzcwogICAgICogdGhhdCBpcyBub3Qgd3JhcHBlZCBieSB0aGlzIHJl\nY2VpdmVyLiAgCiAgICAgKiAKICAgICAqIEBzaW5jZSAyLjAuMAogICAgICov\nCiAgICBwdWJsaWMgPFQ+IFQgdW53cmFwKENsYXNzPFQ+IGNscykgewogICAg\nICAgIE9iamVjdFtdIGRlbGVnYXRlcyA9IG5ldyBPYmplY3RbXXtfcXVlcnku\nZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKSwgX3F1ZXJ5LmdldERlbGVnYXRlKCks\nIF9xdWVyeSwgdGhpc307CiAgICAgICAgZm9yIChPYmplY3QgbyA6IGRlbGVn\nYXRlcykgewogICAgICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgY2xzICE9\nIE9iamVjdC5jbGFzcyAmJiBjbHMuaXNJbnN0YW5jZShvKSkKICAgICAgICAg\nICAgICAgIHJldHVybiAoVClvOwogICAgICAgIH0KICAgICAgICAvLyBTZXQg\ndGhpcyB0cmFuc2FjdGlvbiB0byByb2xsYmFjayBvbmx5IChhcyBwZXIgc3Bl\nYykgaGVyZSBiZWNhdXNlIHRoZSByYWlzZWQgZXhjZXB0aW9uIAogICAgICAg\nIC8vIGRvZXMgbm90IGdvIHRocm91Z2ggbm9ybWFsIGV4Y2VwdGlvbiB0cmFu\nc2xhdGlvbiBwYXRod2F5cwogICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gZXgg\nPSBuZXcgUGVyc2lzdGVuY2VFeGNlcHRpb24oX2xvYy5nZXQoInVud3JhcC1x\ndWVyeS1pbnZhbGlkIiwgY2xzKS50b1N0cmluZygpLCBudWxsLCAKICAgICAg\nICAgICAgICAgIHRoaXMsIGZhbHNlKTsKICAgICAgICBpZiAoX2VtLmlzQWN0\naXZlKCkpCiAgICAgICAgICAgIF9lbS5zZXRSb2xsYmFja09ubHkoZXgpOwog\nICAgICAgIHRocm93IGV4OwogICAgfQoKICAgIAogICAgLy8gPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT0KICAgIC8vIFByZXBhcmVkIFF1ZXJ5IENhY2hl\nIHJlbGF0ZWQgbWV0aG9kcwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT0KICAgIAogICAgLyoqCiAgICAgKiBJbnZva2VkIGJlZm9yZSBhIHF1\nZXJ5IGlzIGV4ZWN1dGVkLgogICAgICogSWYgdGhpcyByZWNlaXZlciBpcyBj\nYWNoZWQgYXMgYSB7QGxpbmtwbGFpbiBQcmVwYXJlZFF1ZXJ5IHByZXBhcmVk\nIHF1ZXJ5fQogICAgICogdGhlbiByZS1wYXJhbWV0ZXJpemVzIHRoZSBnaXZl\nbiB1c2VyIHBhcmFtZXRlcnMuIFRoZSBnaXZlbiBtYXAgaXMgY2xlYXJlZAog\nICAgICogYW5kIHJlLXBhcmFtZXRlcml6ZWQgdmFsdWVzIGFyZSBmaWxsZWQg\naW4uIAogICAgICogCiAgICAgKiBAcGFyYW0gcGFyYW1zIHVzZXIgc3VwcGxp\nZWQgcGFyYW1ldGVyIGtleS12YWx1ZXMuIEFsd2F5cyBzdXBwbHkgYSAKICAg\nICAqIG5vbi1udWxsIG1hcCBldmVuIGlmIHRoZSB1c2VyIGhhcyBub3Qgc3Bl\nY2lmaWVkIGFueSBwYXJhbWV0ZXIsIGJlY2F1c2UgCiAgICAgKiB0aGUgc2Ft\nZSBtYXAgd2lsbCB0byBiZSBwb3B1bGF0ZWQgYnkgcmUtcGFyYW1ldGVyaXph\ndGlvbi4KICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHRoaXMgaW52\nb2NhdGlvbiBjYXVzZWQgdGhlIHF1ZXJ5IGJlaW5nIHJlZ2lzdGVyZWQgaW4g\ndGhlCiAgICAgKiBjYWNoZS4gCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBwcmVFeGVjdXRlKE1hcCBwYXJhbXMpIHsKICAgICAgICBQcmVwYXJlZFF1\nZXJ5Q2FjaGUgY2FjaGUgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeUNhY2hlKCk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2ggPSBfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgaWYgKGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSAhPSAwKSB7CiAg\nICAgICAgICAgIGlmIChjYWNoZS5nZXQoX2lkKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBpZ25vcmVQcmVwYXJlZFF1ZXJ5KCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAg\nICBCb29sZWFuIHJlZ2lzdGVyZWQgPSBjYWNoZS5yZWdpc3RlcihfaWQsIF9x\ndWVyeSwgZmV0Y2gpOwogICAgICAgIGJvb2xlYW4gYWxyZWFkeUNhY2hlZCA9\nIChyZWdpc3RlcmVkID09IG51bGwpOwogICAgICAgIFN0cmluZyBsYW5nID0g\nX3F1ZXJ5LmdldExhbmd1YWdlKCk7CiAgICAgICAgUXVlcnlTdGF0aXN0aWNz\nPFN0cmluZz4gc3RhdHMgPSBjYWNoZS5nZXRTdGF0aXN0aWNzKCk7CiAgICAg\nICAgaWYgKGFscmVhZHlDYWNoZWQgJiYgTEFOR19QUkVQQVJFRF9TUUwuZXF1\nYWxzKGxhbmcpKSB7CiAgICAgICAgICAgIFByZXBhcmVkUXVlcnkgcHEgPSBf\nZW0uZ2V0UHJlcGFyZWRRdWVyeShfaWQpOwogICAgICAgICAgICBpZiAocHEu\naXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIE1hcCByZXAgPSBwcS5yZXBhcmFtZXRyaXplKHBh\ncmFtcywgX2VtLmdldEJyb2tlcigpKTsKICAgICAgICAgICAgICAgICAgICBw\nYXJhbXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMucHV0\nQWxsKHJlcCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0\naW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW52YWxpZGF0ZVByZXBh\ncmVkUXVlcnkoKTsKICAgICAgICAgICAgICAgICAgICBMb2cgbG9nID0gX2Vt\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRp\nb24uTE9HX1JVTlRJTUUpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2cu\naXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cu\nd2Fybih1ZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICBzdGF0cy5yZWNvcmRFeGVjdXRpb24ocHEuZ2V0T3JpZ2lu\nYWxRdWVyeSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0\ncy5yZWNvcmRFeGVjdXRpb24oZ2V0UXVlcnlTdHJpbmcoKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiByZWdpc3RlcmVkID09IEJvb2xlYW4uVFJVRTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHRoZSByZWdp\nc3RlcmVkIFByZXBhcmVkIFF1ZXJ5IGZyb20gdGhlIGdpdmVuIG9wYXF1ZSBv\nYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJhbSByZXN1bHQgYW4gb3BhcXVl\nIG9iamVjdCByZXByZXNlbnRpbmcgZXhlY3V0aW9uIHJlc3VsdCBvZiBhIHF1\nZXJ5CiAgICAgKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgcHJlcGFy\nZWQgcXVlcnkgY2FuIGJlIGluaXRpYWxpemVkLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gcG9zdEV4ZWN1dGUoT2JqZWN0IHJlc3VsdCkgewogICAg\nICAgIFByZXBhcmVkUXVlcnlDYWNoZSBjYWNoZSA9IF9lbS5nZXRQcmVwYXJl\nZFF1ZXJ5Q2FjaGUoKTsKICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkgewog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBjYWNoZS5pbml0aWFsaXplKF9pZCwgcmVzdWx0KSAhPSBudWxsOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGlzIHF1ZXJ5IGZy\nb20gUHJlcGFyZWRRdWVyeUNhY2hlLiAKICAgICAqLwogICAgYm9vbGVhbiBp\nbnZhbGlkYXRlUHJlcGFyZWRRdWVyeSgpIHsKICAgICAgICBQcmVwYXJlZFF1\nZXJ5Q2FjaGUgY2FjaGUgPSBfZW0uZ2V0UHJlcGFyZWRRdWVyeUNhY2hlKCk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBpZ25vcmVQcmVwYXJlZFF1ZXJ5KCk7CiAgICAg\nICAgcmV0dXJuIGNhY2hlLmludmFsaWRhdGUoX2lkKTsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBJZ25vcmVzIHRoaXMgcXVlcnkgZnJvbSBQcmVwYXJl\nZFF1ZXJ5Q2FjaGUgYnkgcmVjcmVhdGluZyB0aGUgb3JpZ2luYWwKICAgICAq\nIHF1ZXJ5IGlmIGl0IGhhcyBiZWVuIGNhY2hlZC4gCiAgICAgKi8KICAgIHZv\naWQgaWdub3JlUHJlcGFyZWRRdWVyeSgpIHsKICAgICAgICBQcmVwYXJlZFF1\nZXJ5IGNhY2hlZCA9IF9lbS5nZXRQcmVwYXJlZFF1ZXJ5KF9pZCk7CiAgICAg\nICAgaWYgKGNhY2hlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgQnJva2VyIGJyb2tlciA9IF9lbS5nZXRCcm9rZXIoKTsKICAgICAg\nICAvLyBDcml0aWNhbCBhc3N1bXB0aW9uOiBPbmx5IEpQUUwgcXVlcmllcyBh\ncmUgY2FjaGVkIGFuZCBtb3JlIAogICAgICAgIC8vIGltcG9ydGFudGx5LCB0\naGUgaWRlbnRpZmllciBvZiB0aGUgcHJlcGFyZWQgcXVlcnkgaXMgdGhlIG9y\naWdpbmFsCiAgICAgICAgLy8gSlBRTCBTdHJpbmcKICAgICAgICBTdHJpbmcg\nSlBRTCA9IEpQUUxQYXJzZXIuTEFOR19KUFFMOwogICAgICAgIFN0cmluZyBq\ncHFsID0gX2lkOwogICAgICAgIAogICAgICAgIG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUXVlcnkgbmV3UXVlcnkgPSBicm9rZXIubmV3UXVlcnkoSlBR\nTCwganBxbCk7CiAgICAgICAgbmV3UXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCkuY29weShfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkpOwog\nICAgICAgIG5ld1F1ZXJ5LmNvbXBpbGUoKTsKICAgICAgICBfcXVlcnkgPSBu\nZXcgRGVsZWdhdGluZ1F1ZXJ5KG5ld1F1ZXJ5LCBfZW0uZ2V0RXhjZXB0aW9u\nVHJhbnNsYXRvcigpKTsKICAgIH0KICAgIAogICAgLy8gcGFja2FnZSBwcm90\nZWN0ZWQKICAgIFF1ZXJ5SW1wbCBzZXRJZChTdHJpbmcgaWQpIHsKICAgICAg\nICBfaWQgPSBpZDsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8v\nID09PT09PT09PT09PT09PT0gRW5kIG9mIFByZXBhcmVkIFF1ZXJ5IHJlbGF0\nZWQgbWV0aG9kcyA9PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgdm9p\nZCBsb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKSAKICAgICAg\nICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAgIHZvaWQgdW5sb2NrKCkg\newogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAgICAgICAgICBfbG9j\nay51bmxvY2soKTsKICAgIH0KCiAgICAKICAgIC8vID09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICBQYXJhbWV0ZXIgcHJv\nY2Vzc2luZyByb3V0aW5lcwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09CgogICAgLyoqCiAgICAgKiBCaW5kcyB0aGUgcGFy\nYW1ldGVyIGlkZW50aWZpZWQgYnkgdGhlIGdpdmVuIHBvc2l0aW9uIHRvIHRo\nZSBnaXZlbiB2YWx1ZS4KICAgICAqIFRoZSBwYXJhbWV0ZXIgYXJlIGJvdW5k\nIHRvIGEgdmFsdWUgaW4gdGhlIGNvbnRleHQgb2YgdGhpcyBxdWVyeS4gCiAg\nICAgKiBUaGUgc2FtZSBwYXJhbWV0ZXIgbWF5IGJlIGJvdW5kIHRvIGEgZGlm\nZmVyZW50IHZhbHVlIGluIHRoZSBjb250ZXh0IG9mIAogICAgICogYW5vdGhl\nciBxdWVyeS4KICAgICAqIDxicj4KICAgICAqIEZvciBub24tbmF0aXZlIHF1\nZXJpZXMsIHRoZSBnaXZlbiBwb3NpdGlvbiBtdXN0IGJlIGEgdmFsaWQgcG9z\naXRpb24gaW4KICAgICAqIHRoZSBkZWNsYXJlZCBwYXJhbWV0ZXJzLgogICAg\nICogPGJyPgogICAgICogQXMgbmF0aXZlIHF1ZXJpZXMgbWF5IG5vdCBiZSBw\nYXJzZWQgYW5kIGhlbmNlIHRoZWlyIGRlY2xhcmVkIHBhcmFtZXRlcnMKICAg\nICAqIG1heSBub3QgYmUga25vd24sIHNldHRpbmcgYW4gcG9zaXRpb25hbCBw\nYXJhbWV0ZXIgaGFzIHRoZSBzaWRlLWVmZmVjdAogICAgICogb2YgYSBwb3Np\ndGlvbmFsIHBhcmFtZXRlciBiZWluZyBkZWNsYXJlZC4KICAgICAqICAgCiAg\nICAgKiBAcGFyYW0gcG9zaXRpb24gcG9zaXRpdmUsIGludGVnZXIgcG9zaXRp\nb24gb2YgdGhlIHBhcmFtZXRlcgogICAgICogQHBhcmFtIHZhbHVlIGFuIGFz\nc2lnbm1lbnQgY29tcGF0aWJsZSB2YWx1ZQogICAgICogQHJldHVybiB0aGUg\nc2FtZSBxdWVyeSBpbnN0YW5jZQogICAgICogQHRocm93cyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24gaWYgcG9zaXRpb24gZG9lcyBub3QgY29ycmVzcG9u\nZCB0byBhIHBvc2l0aW9uYWwgCiAgICAgKiBwYXJhbWV0ZXIgb2YgdGhlIHF1\nZXJ5IG9yIGlmIHRoZSBhcmd1bWVudCBpcyBvZiBpbmNvcnJlY3QgdHlwZQog\nICAgICovICAgIAogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJh\nbWV0ZXIoaW50IHBvcywgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgX3F1ZXJ5\nLmFzc2VydE9wZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZv\na2VkKCk7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAocG9zIDwgMSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgiaWxs\nZWdhbC1pbmRleCIsIHBvcykuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBudWxsOwogICAg\nICAgICAgICBpZiAoaXNOYXRpdmUoKSkgewogICAgICAgICAgICAgICAgcGFy\nYW0gPSBuZXcgUGFyYW1ldGVySW1wbDxPYmplY3Q+KHBvcywgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICAgICAgICAgIGRlY2xhcmVQYXJhbWV0ZXIocG9zLCBw\nYXJhbSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBw\nYXJhbSA9IGdldFBhcmFtZXRlcihwb3MpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGJpbmRWYWx1ZShwYXJhbSwgdmFsdWUpOwoKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nX3F1ZXJ5LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gcG9zaXRpb25h\nbCBwYXJhbWV0ZXIgYWZ0ZXIgY29udmVyc2lvbiBvZiB0aGUKICAgICAqIGdp\ndmVuIHZhbHVlIHRvIHRoZSBnaXZlbiBUZW1wb3JhbCBUeXBlLgogICAgICov\nCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRlcihpbnQg\ncG9zaXRpb24sIENhbGVuZGFyIHZhbHVlLCBUZW1wb3JhbFR5cGUgdCkgewog\nICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIocG9zaXRpb24sIGNvbnZlcnRU\nZW1wb3JhbFR5cGUodmFsdWUsIHQpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldHMgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBuYW1lZCBwYXJhbWV0ZXIg\nYWZ0ZXIgY29udmVyc2lvbiBvZiB0aGUKICAgICAqIGdpdmVuIHZhbHVlIHRv\nIHRoZSBnaXZlbiBUZW1wb3JhbCBUeXBlLgogICAgICovCiAgICBwdWJsaWMg\nT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRlcihpbnQgcG9zaXRpb24sIERh\ndGUgdmFsdWUsIFRlbXBvcmFsVHlwZSB0eXBlKSB7CiAgICAgICAgcmV0dXJu\nIHNldFBhcmFtZXRlcihwb3NpdGlvbiwgY29udmVydFRlbXBvcmFsVHlwZSh2\nYWx1ZSwgdHlwZSkpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENvbnZl\ncnRzIHRoZSBnaXZlbiBEYXRlIHRvIGEgdmFsdWUgY29ycmVzcG9uZGluZyB0\nbyBnaXZlbiB0ZW1wb3JhbCB0eXBlLgogICAgICovCiAgICBPYmplY3QgY29u\ndmVydFRlbXBvcmFsVHlwZShEYXRlIHZhbHVlLCBUZW1wb3JhbFR5cGUgdHlw\nZSkgewogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgREFU\nRToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIGNhc2UgVElN\nRToKICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lKHZhbHVlLmdldFRpbWUo\nKSk7CiAgICAgICAgY2FzZSBUSU1FU1RBTVA6CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgVGltZXN0YW1wKHZhbHVlLmdldFRpbWUoKSk7CiAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIE9iamVjdCBjb252ZXJ0VGVtcG9yYWxUeXBlKENhbGVuZGFyIHZh\nbHVlLCBUZW1wb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJldHVybiBjb252\nZXJ0VGVtcG9yYWxUeXBlKHZhbHVlLmdldFRpbWUoKSwgdHlwZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIGRlY2xhcmVkIHBhcmFtZXRl\ncnMgdXNlIHBvc2l0aW9uIGlkZW50aWZpZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGhhc1Bvc2l0aW9uYWxQYXJhbWV0ZXJzKCkgewogICAgICAg\nIHJldHVybiAhZ2V0RGVjbGFyZWRQYXJhbWV0ZXJLZXlzKEludGVnZXIuY2xh\nc3MpLmlzRW1wdHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhl\nIGFycmF5IG9mIHBvc2l0aW9uYWwgcGFyYW1ldGVyIHZhbHVlcy4KICAgICAq\nIFRoZSBuLXRoIGFycmF5IGVsZW1lbnQgcmVwcmVzZW50cyAobisxKS10aCBw\nb3NpdGlvbmFsIHBhcmFtZXRlci4gIAogICAgICogSWYgYSBwYXJhbWV0ZXIg\naGFzIGJlZW4gZGVjbGFyZWQgYnV0IG5vdCBib3VuZCB0byBhIHZhbHVlIHRo\nZW4KICAgICAqIHRoZSB2YWx1ZSBpcyBudWxsIGFuZCBoZW5jZSBpcyBpbmRp\nc3Rpbmd1aXNoYWJsZSBmcm9tIHRoZSB2YWx1ZQogICAgICogYmVpbmcgYWN0\ndWFsbHkgbnVsbC4KICAgICAqIElmIHRoZSBwYXJhbWV0ZXIgaW5kZXhpbmcg\naXMgbm90IGNvbnRpZ3VvdXMgdGhlbiB0aGUgdW5zcGVjaWZpZWQKICAgICAq\nIHBhcmFtZXRlcnMgYXJlIGNvbnNpZGVyZWQgYXMgbnVsbC4KICAgICAqLwog\nICAgcHVibGljIE9iamVjdFtdIGdldFBvc2l0aW9uYWxQYXJhbWV0ZXJzKCkg\newogICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgU2V0PEludGVnZXI+IHBvc2l0aW9uYWxLZXlzID0gZ2V0RGVjbGFy\nZWRQYXJhbWV0ZXJLZXlzKEludGVnZXIuY2xhc3MpOwogICAgICAgICAgICBP\nYmplY3RbXSByZXN1bHQgPSBuZXcgT2JqZWN0W2NhbGN1bGF0ZU1heEtleShw\nb3NpdGlvbmFsS2V5cyldOwogICAgICAgICAgICBmb3IgKEludGVnZXIgcG9z\nIDogcG9zaXRpb25hbEtleXMpIHsKICAgICAgICAgICAgICAgIFBhcmFtZXRl\ncjw/PiBwYXJhbSA9IGdldFBhcmFtZXRlcihwb3MpOwogICAgICAgICAgICAg\nICAgcmVzdWx0W3Bvcy5pbnRWYWx1ZSgpLTFdID0gaXNCb3VuZChwYXJhbSkg\nPyBnZXRQYXJhbWV0ZXJWYWx1ZShwb3MpIDogbnVsbDsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHRoZSBtYXhpbXVt\nIHZhbHVlIG9mIHRoZSBnaXZlbiBzZXQuCiAgICAgKi8KICAgIGludCBjYWxj\ndWxhdGVNYXhLZXkoU2V0PEludGVnZXI+IHApIHsKICAgICAgICBpZiAocCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpbnQgbWF4\nID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICAgICAgZm9yIChJbnRlZ2VyIGkg\nOiBwKQogICAgICAgICAgICBtYXggPSBNYXRoLm1heChtYXgsIGkpOwogICAg\nICAgIHJldHVybiBtYXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBCaW5kcyB0\naGUgZ2l2ZW4gdmFsdWVzIGFzIHBvc2l0aW9uYWwgcGFyYW1ldGVycy4gCiAg\nICAgKiBUaGUgbi10aCBhcnJheSBlbGVtZW50IHZhbHVlIGlzIHNldCB0byBh\nIFBhcmFtZXRlciB3aXRoIChuKzEpLXRoIHBvc2l0aW9uYWwgaWRlbnRpZmll\nci4gIAogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5PFg+IHNldFBh\ncmFtZXRlcnMoT2JqZWN0Li4uIHBhcmFtcykgewogICAgICAgIF9xdWVyeS5h\nc3NlcnRPcGVuKCk7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tl\nZCgpOwogICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgY2xlYXJCaW5kaW5nKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBwYXJhbXMgIT0gbnVsbCAmJiBpIDwgcGFyYW1zLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBzZXRQYXJhbWV0ZXIoaSArIDEsIHBh\ncmFtc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgdm9pZCBjbGVhckJp\nbmRpbmcoKSB7CiAgICAgICAgaWYgKF9ib3VuZFBhcmFtcyAhPSBudWxsKQog\nICAgICAgICAgICBfYm91bmRQYXJhbXMuY2xlYXIoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEdldHMgdGhlIHZhbHVlIG9mIGFsbCB0aGUgbmFtZWQgcGFy\nYW1ldGVycy4gIAogICAgICogCiAgICAgKiBJZiBhIHBhcmFtZXRlciBoYXMg\nYmVlbiBkZWNsYXJlZCBidXQgbm90IGJvdW5kIHRvIGEgdmFsdWUgdGhlbgog\nICAgICogdGhlIHZhbHVlIGlzIG51bGwgYW5kIGhlbmNlIGlzIGluZGlzdGlu\nZ3Vpc2hhYmxlIGZyb20gdGhlIHZhbHVlCiAgICAgKiBiZWluZyBhY3R1YWxs\neSBudWxsLgogICAgICovCiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0\nPiBnZXROYW1lZFBhcmFtZXRlcnMoKSB7CiAgICAgICAgX3F1ZXJ5LmxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBNYXA8U3RyaW5nLCBPYmpl\nY3Q+IHJlc3VsdCA9IG5ldyBIYXNoTWFwPFN0cmluZywgT2JqZWN0PigpOwog\nICAgICAgICAgICBTZXQ8U3RyaW5nPiBuYW1lZEtleXMgPSBnZXREZWNsYXJl\nZFBhcmFtZXRlcktleXMoU3RyaW5nLmNsYXNzKTsKICAgICAgICAgICAgZm9y\nIChTdHJpbmcgbmFtZSA6IG5hbWVkS2V5cykgewogICAgICAgICAgICAgICAg\nUGFyYW1ldGVyPD8+IHBhcmFtID0gZ2V0UGFyYW1ldGVyKG5hbWUpOwogICAg\nICAgICAgICAgICAgcmVzdWx0LnB1dChuYW1lLCBpc0JvdW5kKHBhcmFtKSA/\nIGdldFBhcmFtZXRlclZhbHVlKG5hbWUpIDogbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU2V0cyB0aGUgdmFsdWVzIG9mIHRoZSBw\nYXJhbWV0ZXJzIGZyb20gdGhlIGdpdmVuIE1hcC4KICAgICAqIFRoZSBrZXlz\nIG9mIHRoZSBnaXZlbiBtYXAgZGVzaWduYXRlIHRoZSBuYW1lIG9mIHRoZSBk\nZWNsYXJlZCBwYXJhbWV0ZXIuCiAgICAgIAogICAgICovCiAgICBwdWJsaWMg\nT3BlbkpQQVF1ZXJ5PFg+IHNldFBhcmFtZXRlcnMoTWFwIHBhcmFtcykgewog\nICAgICAgIF9xdWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2VtLmFzc2Vy\ndE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgY2xlYXJCaW5kaW5nKCk7CiAgICAg\nICAgICAgIGlmIChwYXJhbXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZv\nciAoTWFwLkVudHJ5IGUgOiAoU2V0PE1hcC5FbnRyeT4pIHBhcmFtcy5lbnRy\neVNldCgpKQogICAgICAgICAgICAgICAgICAgIHNldFBhcmFtZXRlcigoU3Ry\naW5nKSBlLmdldEtleSgpLCBlLmdldFZhbHVlKCkpOwogICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBf\ncXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogR2V0IHRoZSBwYXJhbWV0ZXIgb2YgdGhlIGdpdmVuIG5hbWUgYW5kIHR5\ncGUuCiAgICAgKiAKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uIGlmIHRoZSBwYXJhbWV0ZXIgb2YgdGhlCiAgICAgKiAgICAgICAg\nIHNwZWNpZmllZCBuYW1lIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhc3Np\nZ25hYmxlCiAgICAgKiAgICAgICAgIHRvIHRoZSB0eXBlCiAgICAgKiBAdGhy\nb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpZiBpbnZva2VkIG9uIGEgbmF0\naXZlIHF1ZXJ5IAogICAgICovCiAgICBwdWJsaWMgPFQ+IFBhcmFtZXRlcjxU\nPiBnZXRQYXJhbWV0ZXIoU3RyaW5nIG5hbWUsIENsYXNzPFQ+IHR5cGUpIHsK\nICAgICAgICBQYXJhbWV0ZXI8Pz4gcGFyYW0gPSBnZXRQYXJhbWV0ZXIobmFt\nZSk7CiAgICAgICAgaWYgKHBhcmFtLmdldFBhcmFtZXRlclR5cGUoKS5pc0Fz\nc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHBhcmFtICsgIiBkb2VzIG5vdCBtYXRj\naCB0aGUgcmVxdWVzdGVkIHR5cGUgIiArIHR5cGUpOwogICAgICAgIHJldHVy\nbiAoUGFyYW1ldGVyPFQ+KXBhcmFtOwogICAgfQoKICAgIC8qKgogICAgICog\nR2V0IHRoZSBwb3NpdGlvbmFsIHBhcmFtZXRlciB3aXRoIHRoZSBnaXZlbiBw\nb3NpdGlvbiBhbmQgdHlwZS4KICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uIGlmIHRoZSBwYXJhbWV0ZXIgd2l0aCB0aGUKICAgICAq\nICAgICAgICAgc3BlY2lmaWVkIHBvc2l0aW9uIGRvZXMgbm90IGV4aXN0IG9y\nIGlzIG5vdCBhc3NpZ25hYmxlCiAgICAgKiAgICAgICAgIHRvIHRoZSB0eXBl\nCiAgICAgKiBAdGhyb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpZiBpbnZv\na2VkIG9uIGEgbmF0aXZlIHF1ZXJ5IHVubGVzcwogICAgICogdGhlIHNhbWUg\ncGFyYW1ldGVyIHBvc2l0aW9uIGlzIGJvdW5kIGFscmVhZHkuCiAgICAgKi8K\nICAgIHB1YmxpYyA8VD4gUGFyYW1ldGVyPFQ+IGdldFBhcmFtZXRlcihpbnQg\ncG9zLCBDbGFzczxUPiB0eXBlKSB7CiAgICAgICAgUGFyYW1ldGVyPD8+IHBh\ncmFtID0gZ2V0UGFyYW1ldGVyKHBvcyk7CiAgICAgICAgaWYgKHBhcmFtLmdl\ndFBhcmFtZXRlclR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHBh\ncmFtICsgIiBkb2VzIG5vdCBtYXRjaCB0aGUgcmVxdWVzdGVkIHR5cGUgIiAr\nIHR5cGUpOwogICAgICAgIHJldHVybiAoUGFyYW1ldGVyPFQ+KXBhcmFtOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBib3VuZCB0\nbyB0aGUgcGFyYW1ldGVyLgogICAgICogQHBhcmFtIHBhcmFtIHBhcmFtZXRl\nciBvYmplY3QKICAgICAqIEByZXR1cm4gcGFyYW1ldGVyIHZhbHVlCiAgICAg\nKiBAdGhyb3dzIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1l\ndGVyIGhhcyBub3QgYmVlbiBiZWVuIGJvdW5kCiAgICAgKiBAdGhyb3dzIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiB0aGUgcGFyYW1ldGVyIGRvZXMg\nbm90IGJlbG9uZyB0byB0aGlzIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyA8\nVD4gVCBnZXRQYXJhbWV0ZXJWYWx1ZShQYXJhbWV0ZXI8VD4gcCkgewogICAg\nICAgIGlmICghaXNCb3VuZChwKSkgewogICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoInBhcmFtLW1pc3Np\nbmciLCBwLCBnZXRRdWVyeVN0cmluZygpLCAKICAgICAgICAgICAgICAgZ2V0\nQm91bmRQYXJhbWV0ZXJLZXlzKCkpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiAoVClfYm91bmRQYXJhbXMuZ2V0KHApOwogICAg\nfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgcGFyYW1ldGVycyBkZWNsYXJl\nZCBpbiB0aGlzIHF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgU2V0PFBhcmFt\nZXRlcjw/Pj4gZ2V0UGFyYW1ldGVycygpIHsKICAgICAgICBTZXQ8UGFyYW1l\ndGVyPD8+PiByZXN1bHQgPSBuZXcgSGFzaFNldDxQYXJhbWV0ZXI8Pz4+KCk7\nCiAgICAgICAgcmVzdWx0LmFkZEFsbChnZXREZWNsYXJlZFBhcmFtZXRlcnMo\nKS52YWx1ZXMoKSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAg\nICBwdWJsaWMgPFQ+IE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0ZXIoUGFy\nYW1ldGVyPFQ+IHAsIFQgYXJnMSkgewogICAgICAgIGJpbmRWYWx1ZSgoUGFy\nYW1ldGVyPFQ+KXAsIGFyZzEpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVyKFBh\ncmFtZXRlcjxEYXRlPiBwLCBEYXRlIGRhdGUsIFRlbXBvcmFsVHlwZSB0eXBl\nKSB7CiAgICAgICAgcmV0dXJuIHNldFBhcmFtZXRlcihwLCAoRGF0ZSljb252\nZXJ0VGVtcG9yYWxUeXBlKGRhdGUsIHR5cGUpKTsKICAgIH0KCiAgICBwdWJs\naWMgVHlwZWRRdWVyeTxYPiBzZXRQYXJhbWV0ZXIoUGFyYW1ldGVyPENhbGVu\nZGFyPiBwLCBDYWxlbmRhciBjYWwsIFRlbXBvcmFsVHlwZSB0eXBlKSB7CiAg\nICAgICAgcmV0dXJuIHNldFBhcmFtZXRlcihwLCAoQ2FsZW5kYXIpY29udmVy\ndFRlbXBvcmFsVHlwZShjYWwsIHR5cGUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgcGFyYW1ldGVyIG9iamVjdCBjb3JyZXNwb25kaW5nIHRv\nIHRoZSBkZWNsYXJlZCBwYXJhbWV0ZXIgb2YgdGhlIGdpdmVuIG5hbWUuCiAg\nICAgKiBUaGlzIG1ldGhvZCBpcyBub3QgcmVxdWlyZWQgdG8gYmUgc3VwcG9y\ndGVkIGZvciBuYXRpdmUgcXVlcmllcy4KICAgICAqIAogICAgICogQHRocm93\ncyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgdGhlIHBhcmFtZXRlciBv\nZiB0aGUgc3BlY2lmaWVkIG5hbWUgZG9lcyBub3QgZXhpc3QKICAgICAqIEB0\naHJvd3MgSWxsZWdhbFN0YXRlRXhjZXB0aW9uIGlmIGludm9rZWQgb24gYSBu\nYXRpdmUgcXVlcnkKICAgICAqLwogICAgcHVibGljIFBhcmFtZXRlcjw/PiBn\nZXRQYXJhbWV0ZXIoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoaXNOYXRp\ndmUoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYXJhbS1uYW1lZC1ub24tbmF0aXZlIiwgbmFt\nZSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICAgICAgUGFyYW1ldGVy\nPD8+IHBhcmFtID0gZ2V0RGVjbGFyZWRQYXJhbWV0ZXJzKCkuZ2V0KG5hbWUp\nOwogICAgICAgIGlmIChwYXJhbSA9PSBudWxsKSB7CiAgICAgICAgICAgIFNl\ndDxQYXJhbWV0ZXJFeHByZXNzaW9uPiBleHBzID0gZ2V0RGVjbGFyZWRQYXJh\nbWV0ZXJLZXlzKFBhcmFtZXRlckV4cHJlc3Npb24uY2xhc3MpOwogICAgICAg\nICAgICBmb3IgKFBhcmFtZXRlckV4cHJlc3Npb248Pz4gZSA6IGV4cHMpIHsK\nICAgICAgICAgICAgICAgIGlmIChuYW1lLmVxdWFscyhlLmdldE5hbWUoKSkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbihfbG9jLmdldCgicGFyYW0tbWlzc2luZy1uYW1lIiwgCiAgICAgICAgICAg\nICAgICBuYW1lLCBnZXRRdWVyeVN0cmluZygpLCBnZXREZWNsYXJlZFBhcmFt\nZXRlcktleXMoKSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHBhcmFtOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBw\nb3NpdGlvbmFsIHBhcmFtZXRlciB3aXRoIHRoZSBnaXZlbiBwb3NpdGlvbi4K\nICAgICAqIFRoZSBwYXJhbWV0ZXIgbWF5IGp1c3QgaGF2ZSBiZWVuIGRlY2xh\ncmVkIGFuZCBub3QgYm91bmQgdG8gYSB2YWx1ZS4KICAgICAqIAogICAgICog\nQHBhcmFtIHBvc2l0aW9uIHNwZWNpZmllZCBpbiB0aGUgdXNlciBxdWVyeS4K\nICAgICAqIEByZXR1cm4gcGFyYW1ldGVyIG9iamVjdAogICAgICogQHRocm93\ncyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgdGhlIHBhcmFtZXRlciB3\naXRoIHRoZSBnaXZlbiBwb3NpdGlvbiBkb2VzIG5vdCBleGlzdAogICAgICov\nCiAgICBwdWJsaWMgUGFyYW1ldGVyPD8+IGdldFBhcmFtZXRlcihpbnQgcG9z\nKSB7CiAgICAgICAgUGFyYW1ldGVyPD8+IHBhcmFtID0gZ2V0RGVjbGFyZWRQ\nYXJhbWV0ZXJzKCkuZ2V0KHBvcyk7CiAgICAgICAgaWYgKHBhcmFtID09IG51\nbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oX2xvYy5nZXQoInBhcmFtLW1pc3NpbmctcG9zIiwgCiAgICAgICAg\nICAgICAgICBwb3MsIGdldFF1ZXJ5U3RyaW5nKCksIGdldERlY2xhcmVkUGFy\nYW1ldGVyS2V5cygpKS5nZXRNZXNzYWdlKCkpOwogICAgICAgIHJldHVybiBw\nYXJhbTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUg\nYm91bmQgdG8gdGhlIHBhcmFtZXRlci4KICAgICAqIAogICAgICogQHBhcmFt\nIG5hbWUgbmFtZSBvZiB0aGUgcGFyYW1ldGVyCiAgICAgKiBAcmV0dXJuIHBh\ncmFtZXRlciB2YWx1ZQogICAgICogCiAgICAgKiBAdGhyb3dzIElsbGVnYWxT\ndGF0ZUV4Y2VwdGlvbiBpZiB0aGlzIHBhcmFtZXRlciBoYXMgbm90IGJlZW4g\nYm91bmQKICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRQYXJhbWV0ZXJW\nYWx1ZShTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiBfYm91bmRQYXJh\nbXMuZ2V0KGdldFBhcmFtZXRlcihuYW1lKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHZhbHVlIGJvdW5kIHRvIHRoZSBwYXJhbWV0ZXIu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBwb3MgcG9zaXRpb24gb2YgdGhlIHBh\ncmFtZXRlcgogICAgICogQHJldHVybiBwYXJhbWV0ZXIgdmFsdWUKICAgICAq\nIAogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhp\ncyBwYXJhbWV0ZXIgaGFzIG5vdCBiZWVuIGJvdW5kCiAgICAgKi8KICAgIHB1\nYmxpYyBPYmplY3QgZ2V0UGFyYW1ldGVyVmFsdWUoaW50IHBvcykgewogICAg\nICAgIFBhcmFtZXRlcjw/PiBwYXJhbSA9IGdldFBhcmFtZXRlcihwb3MpOwog\nICAgICAgIGFzc2VydEJvdW5kKHBhcmFtKTsKICAgICAgICByZXR1cm4gX2Jv\ndW5kUGFyYW1zLmdldChwYXJhbSk7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogR2V0cyB0aGUgcGFyYW1ldGVyIGtleXMgYm91bmQgd2l0aCB0aGlzIHF1\nZXJ5LgogICAgICogUGFyYW1ldGVyIGtleSBjYW4gYmUgSW50ZWdlciwgU3Ry\naW5nIG9yIGEgUGFyYW1ldGVyRXhwcmVzc2lvbiBpdHNlbGYKICAgICAqIGJ1\ndCBhbGwgcGFyYW1ldGVycyBrZXlzIG9mIGEgcGFydGljdWxhciBxdWVyeSBh\ncmUgb2YgdGhlIHNhbWUgdHlwZS4KICAgICAqLwogICAgcHVibGljIFNldDw/\nPiBnZXRCb3VuZFBhcmFtZXRlcktleXMoKSB7CiAgICAgICAgaWYgKF9ib3Vu\nZFBhcmFtcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlv\nbnMuRU1QVFlfU0VUOwogICAgICAgIGdldERlY2xhcmVkUGFyYW1ldGVycygp\nOwogICAgICAgIFNldDxPYmplY3Q+IHJlc3VsdCA9IG5ldyBIYXNoU2V0PE9i\namVjdD4oKTsKICAgICAgICBmb3IgKE1hcC5FbnRyeTxPYmplY3QsIFBhcmFt\nZXRlcjw/Pj4gZW50cnkgOiBfZGVjbGFyZWRQYXJhbXMuZW50cnlTZXQoKSkg\newogICAgICAgICAgICBpZiAoaXNCb3VuZChlbnRyeS5nZXRWYWx1ZSgpKSkg\newogICAgICAgICAgICAgICAgcmVzdWx0LmFkZChlbnRyeS5nZXRLZXkoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBkZWNsYXJl\nZCBwYXJhbWV0ZXIga2V5cyBpbiB0aGUgZ2l2ZW4gcXVlcnkuCiAgICAgKiBU\naGlzIGluZm9ybWF0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIGFmdGVyIHRoZSBx\ndWVyeSBoYXMgYmVlbiBwYXJzZWQuCiAgICAgKiBBcyBuYXRpdmUgbGFuZ3Vh\nZ2UgcXVlcmllcyBhcmUgbm90IHBhcnNlZCwgdGhpcyBpbmZvcm1hdGlvbiBp\ncyBub3QgYXZhaWxhYmxlIGZvciB0aGVtLgogICAgICogICAKICAgICAqIEBy\nZXR1cm4gc2V0IG9mIHBhcmFtZXRlciBpZGVudGlmaWVycyBpbiBhIHBhcnNl\nZCBxdWVyeQogICAgICovCiAgICBwdWJsaWMgU2V0PD8+IGdldERlY2xhcmVk\nUGFyYW1ldGVyS2V5cygpIHsKICAgICAgICByZXR1cm4gZ2V0RGVjbGFyZWRQ\nYXJhbWV0ZXJzKCkua2V5U2V0KCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyA8\nVD4gU2V0PFQ+IGdldERlY2xhcmVkUGFyYW1ldGVyS2V5cyhDbGFzczxUPiBr\nZXlUeXBlKSB7CiAgICAgICAgU2V0PFQ+IHJlc3VsdCA9IG5ldyBIYXNoU2V0\nPFQ+KCk7CiAgICAgICAgZm9yIChPYmplY3Qga2V5IDogZ2V0RGVjbGFyZWRQ\nYXJhbWV0ZXJLZXlzKCkpIHsKICAgICAgICAgICAgaWYgKGtleVR5cGUuaXNJ\nbnN0YW5jZShrZXkpKQogICAgICAgICAgICAgICAgcmVzdWx0LmFkZCgoVClr\nZXkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHBhcmFtZXRlciBpbnN0YW5j\nZXMgZGVjbGFyZWQgaW4gdGhpcyBxdWVyeS4KICAgICAqIEFsbCBwYXJhbWV0\nZXIga2V5cyBhcmUgb2YgdGhlIHNhbWUgdHlwZS4gSXQgaXMgbm90IGFsbG93\nZWQgdG8gbWl4IGtleXMgb2YgZGlmZmVyZW50IHR5cGUKICAgICAqIHN1Y2gg\nYXMgbmFtZWQgYW5kIHBvc2l0aW9uYWwga2V5cy4gCiAgICAgKiAKICAgICAq\nIEZvciBzdHJpbmctYmFzZWQgcXVlcmllcywgdGhlIHBhcnNlciBzdXBwbGll\ncyB0aGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGRlY2xhcmVkIHBhcmFtZXRl\ncnMKICAgICAqIGFzIGEgTGlua2VkTWFwIG9mIGV4cGVjdGVkIHBhcmFtZXRl\nciB2YWx1ZSB0eXBlIGluZGV4ZWQgYnkgcGFyYW1ldGVyIGlkZW50aWZpZXIu\nCiAgICAgKiBGb3Igbm9uIHN0cmluZy1iYXNlZCBxdWVyaWVzIHRoYXQgYSBm\nYWNhZGUgaXRzZWxmIG1heSBjb25zdHJ1Y3QgKGUuZy4gQ3JpdGVyaWFRdWVy\neSksCiAgICAgKiB0aGUgcGFyYW1ldGVycyBtdXN0IGJlIGRlY2xhcmVkIGJ5\nIHRoZSBjYWxsZXIuCiAgICAgKiBUaGlzIHJlY2VpdmVyIGNvbnN0cnVjdHMg\nY29uY3JldGUgUGFyYW1ldGVyIGluc3RhbmNlcyBmcm9tIHRoZSBnaXZlbiBw\nYXJhbWV0ZXIgaWRlbnRpZmllcnMuCiAgICAgKiAKICAgICAqIEByZXR1cm4g\nYSBNYXAgd2hlcmUgdGhlIGtleSByZXByZXNlbnRzIHRoZSBvcmlnaW5hbCBp\nZGVudGlmaWVyIG9mIHRoZSBwYXJhbWV0ZXIgKGNhbiBiZSBhIFN0cmluZywK\nICAgICAqIEludGVnZXIgb3IgYSBQYXJhbWV0ZXJFeHByZXNzaW9uIGl0c2Vs\nZikgYW5kIHRoZSB2YWx1ZSBpcyB0aGUgY29uY3JldGUgUGFyYW1ldGVyIGlu\nc3RhbmNlCiAgICAgKiBlaXRoZXIgY29uc3RydWN0ZWQgYXMgYSByZXN1bHQg\nb2YgdGhpcyBjYWxsIG9yIHN1cHBsaWVkIGJ5IGRlY2xhcmluZyB0aGUgcGFy\nYW1ldGVyIGV4cGxpY2l0bHkKICAgICAqIHZpYSB7QGxpbmtwbGFpbiAjZGVj\nbGFyZVBhcmFtZXRlcihQYXJhbWV0ZXIpfS4KICAgICAqLwogICAgcHVibGlj\nIE1hcDxPYmplY3QsIFBhcmFtZXRlcjw/Pj4gZ2V0RGVjbGFyZWRQYXJhbWV0\nZXJzKCkgewogICAgICAgIGlmIChfZGVjbGFyZWRQYXJhbXMgPT0gbnVsbCkg\newogICAgICAgICAgICBfZGVjbGFyZWRQYXJhbXMgPSBuZXcgSGFzaE1hcDxP\nYmplY3QsIFBhcmFtZXRlcjw/Pj4oKTsKICAgICAgICAgICAgT3JkZXJlZE1h\ncDxPYmplY3QsQ2xhc3M8Pz4+IHBhcmFtVHlwZXMgPSBfcXVlcnkuZ2V0T3Jk\nZXJlZFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgICAgIGZvciAoT2JqZWN0\nIGtleSA6IHBhcmFtVHlwZXMua2V5U2V0KCkpIHsKICAgICAgICAgICAgICAg\nIFBhcmFtZXRlcjw/PiBwYXJhbSA9IG51bGw7CiAgICAgICAgICAgICAgICBD\nbGFzczw/PiBleHBlY3RlZFZhbHVlVHlwZSA9IHBhcmFtVHlwZXMuZ2V0KGtl\neSk7CiAgICAgICAgICAgICAgICBpZiAoa2V5IGluc3RhbmNlb2YgSW50ZWdl\ncikgewogICAgICAgICAgICAgICAgICAgIHBhcmFtID0gbmV3IFBhcmFtZXRl\nckltcGwoKEludGVnZXIpa2V5LCBleHBlY3RlZFZhbHVlVHlwZSk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKGtleSBpbnN0YW5jZW9mIFN0cmluZykg\newogICAgICAgICAgICAgICAgICAgIHBhcmFtID0gbmV3IFBhcmFtZXRlcklt\ncGwoKFN0cmluZylrZXksIGV4cGVjdGVkVmFsdWVUeXBlKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoa2V5IGluc3RhbmNlb2YgUGFyYW1ldGVyKSB7\nCiAgICAgICAgICAgICAgICAgICAgcGFyYW0gPSAoUGFyYW1ldGVyPD8+KWtl\neTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigicGFyYW1l\ndGVyIGlkZW50aWZpZXIgIiArIGtleSArICIgdW5yZWNvZ25pemVkIik7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkZWNsYXJlUGFyYW1l\ndGVyKGtleSwgcGFyYW0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfZGVjbGFyZWRQYXJhbXM7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogRGVjbGFyZXMgdGhlIGdpdmVuIHBhcmFtZXRlciBmb3IgdGhp\ncyBxdWVyeS4gCiAgICAgKiBVc2VkIGJ5IG5vbi1zdHJpbmcgYmFzZWQgcXVl\ncmllcyB0aGF0IGFyZSBjb25zdHJ1Y3RlZCBieSB0aGUgZmFjYWRlIGl0c2Vs\nZiByYXRoZXIgdGhhbgogICAgICogT3BlbkpQQSBwYXJzaW5nIHRoZSBxdWVy\neSB0byBkZXRlY3QgdGhlIGRlY2xhcmVkIHBhcmFtZXRlcnMuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBrZXkgdGhpcyBpcyB0aGUga2V5IHRvIGlkZW50aWZ5\nIHRoZSBwYXJhbWV0ZXIgbGF0ZXIgaW4gdGhlIGNvbnRleHQgb2YgdGhpcyBx\ndWVyeS4KICAgICAqIFZhbGlkIGtleSB0eXBlcyBhcmUgSW50ZWdlciwgU3Ry\naW5nIG9yIFBhcmFtZXRlckV4cHJlc3Npb24gaXRzZWxmLgogICAgICogQHBh\ncmFtIHRoZSBwYXJhbWV0ZXIgaW5zdGFuY2UgdG8gYmUgZGVjbGFyZWQKICAg\nICAqLwogICAgcHVibGljIHZvaWQgZGVjbGFyZVBhcmFtZXRlcihPYmplY3Qg\na2V5LCBQYXJhbWV0ZXI8Pz4gcGFyYW0pIHsKICAgICAgICBpZiAoX2RlY2xh\ncmVkUGFyYW1zID09IG51bGwpIHsKICAgICAgICAgICAgX2RlY2xhcmVkUGFy\nYW1zID0gbmV3IEhhc2hNYXA8T2JqZWN0LCBQYXJhbWV0ZXI8Pz4+KCk7CiAg\nICAgICAgfQogICAgICAgIF9kZWNsYXJlZFBhcmFtcy5wdXQoa2V5LCBwYXJh\nbSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRoZSBnaXZl\nbiBwYXJhbWV0ZXIgaXMgYm91bmQgdG8gYSB2YWx1ZSBmb3IgdGhpcyBxdWVy\neS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNCb3VuZChQYXJhbWV0\nZXI8Pz4gcGFyYW0pIHsKICAgICAgICByZXR1cm4gX2JvdW5kUGFyYW1zICE9\nIG51bGwgJiYgX2JvdW5kUGFyYW1zLmNvbnRhaW5zS2V5KHBhcmFtKTsKICAg\nIH0KICAgIAogICAgdm9pZCBhc3NlcnRCb3VuZChQYXJhbWV0ZXI8Pz4gcGFy\nYW0pIHsKICAgICAgICBpZiAoIWlzQm91bmQocGFyYW0pKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInBhcmFtLW5vdC1ib3VuZCIsIHBhcmFtLCBnZXRRdWVyeVN0cmluZygpLCAK\nICAgICAgICAgICAgICAgICAgICBnZXRCb3VuZFBhcmFtZXRlcktleXMoKSku\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAq\nIEJpbmRzIHRoZSBnaXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gcGFyYW1ldGVy\nLgogICAgICogVmFsaWRhdGVzIGlmIHRoZSBwYXJhbWV0ZXIgY2FuIGFjY2Vw\ndCB0aGUgdmFsdWUgYnkgaXRzIHR5cGUuCiAgICAgKi8KICAgIHZvaWQgYmlu\nZFZhbHVlKFBhcmFtZXRlcjw/PiBwYXJhbSwgT2JqZWN0IHZhbHVlKSB7CiAg\nICAgICAgYXNzZXJ0VmFsdWVBc3NpZ25hYmxlKHBhcmFtLCB2YWx1ZSk7CiAg\nICAgICAgaWYgKF9ib3VuZFBhcmFtcyA9PSBudWxsKQogICAgICAgICAgICBf\nYm91bmRQYXJhbXMgPSBuZXcgSGFzaE1hcDxQYXJhbWV0ZXI8Pz4sIE9iamVj\ndD4oKTsKICAgICAgICBfYm91bmRQYXJhbXMucHV0KHBhcmFtLCB2YWx1ZSk7\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJhbWV0\nZXIoU3RyaW5nIG5hbWUsIENhbGVuZGFyIHZhbHVlLCBUZW1wb3JhbFR5cGUg\ndHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0ZXIobmFtZSwgY29u\ndmVydFRlbXBvcmFsVHlwZSh2YWx1ZSwgdHlwZSkpOwogICAgfQoKICAgIHB1\nYmxpYyBPcGVuSlBBUXVlcnk8WD4gc2V0UGFyYW1ldGVyKFN0cmluZyBuYW1l\nLCBEYXRlIHZhbHVlLCBUZW1wb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJl\ndHVybiBzZXRQYXJhbWV0ZXIobmFtZSwgY29udmVydFRlbXBvcmFsVHlwZSh2\nYWx1ZSwgdHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB0aGUg\ncGFyYW1ldGVyIG9mIHRoZSBnaXZlbiBuYW1lIHRvIHRoZSBnaXZlbiB2YWx1\nZS4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFRdWVyeTxYPiBzZXRQYXJh\nbWV0ZXIoU3RyaW5nIG5hbWUsIE9iamVjdCB2YWx1ZSkgewogICAgICAgIF9x\ndWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gbmF0aXZlIHF1ZXJpZXMgY2FuIG5vdCBoYXZl\nIG5hbWVkIHBhcmFtZXRlcnMKICAgICAgICAgICAgaWYgKGlzTmF0aXZlKCkp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXBhcmFtcyIsCiAgICAgICAg\nICAgICAgICAgICAgICAgIG5hbWUsIGdldFF1ZXJ5U3RyaW5nKCkpLnRvU3Ry\naW5nKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nYmluZFZhbHVlKGdldFBhcmFtZXRlcihuYW1lKSwgdmFsdWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgYXNzZXJ0VmFsdWVBc3Np\nZ25hYmxlKFBhcmFtZXRlcjw/PiBwYXJhbSwgT2JqZWN0IHYpIHsKICAgICAg\nICBpZiAodiA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChwYXJhbS5nZXRQ\nYXJhbWV0ZXJUeXBlKCkuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQo\nInBhcmFtLW51bGwtcHJpbWl0aXZlIiwgcGFyYW0pLmdldE1lc3NhZ2UoKSk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCFG\naWx0ZXJzLmNhbkNvbnZlcnQodi5nZXRDbGFzcygpLCBwYXJhbS5nZXRQYXJh\nbWV0ZXJUeXBlKCksIHRydWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoInBhcmFtLXR5cGUt\nbWlzbWF0Y2giLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICBwYXJh\nbSwgZ2V0UXVlcnlTdHJpbmcoKSwgdiwgdi5nZXRDbGFzcygpLmdldE5hbWUo\nKSwgcGFyYW0uZ2V0UGFyYW1ldGVyVHlwZSgpLmdldE5hbWUoKX0pLmdldE1l\nc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyA9PT09PT09\nPT09PT09PT09PT0gRW5kIG9mIFBhcmFtZXRlciBQcm9jZXNzaW5nIHJvdXRp\nbmVzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAKICAg\nIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgU3RyaW5nIHJl\nc3VsdCA9IF9xdWVyeS5nZXRRdWVyeVN0cmluZygpOyAKICAgICAgICByZXR1\ncm4gcmVzdWx0ICE9IG51bGwgPyByZXN1bHQgOiBfaWQ7CiAgICB9Cn0K\n","encoding":"base64"}

