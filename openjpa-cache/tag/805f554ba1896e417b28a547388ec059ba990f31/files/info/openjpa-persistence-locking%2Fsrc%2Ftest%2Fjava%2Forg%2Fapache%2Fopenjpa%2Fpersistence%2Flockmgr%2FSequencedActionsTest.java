{"sha":"148ebb03d1c1996c617d6f6b0ea0f303b2107284","node_id":"MDQ6QmxvYjIwNjM2NDoxNDhlYmIwM2QxYzE5OTZjNjE3ZDZmNmIwZWEwZjMwM2IyMTA3Mjg0","size":39416,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/148ebb03d1c1996c617d6f6b0ea0f303b2107284","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5sb2NrbWdyOwoK\naW1wb3J0IGphdmEuaW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07CmltcG9ydCBq\nYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8u\nT2JqZWN0SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBq\nYXZhLmlvLlN0cmluZ1dyaXRlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGls\nLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5FbnRpdHlNYW5hZ2VyOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTG9ja01vZGVUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuUXVlcnk7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29u\nZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb25JbXBsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLnRlc3QuU1FM\nTGlzdGVuZXJUZXN0Q2FzZTsKCi8qKgogKiBCYXNlIGNsYXNzIHRvIHN1cHBv\ncnQgcHNldWRvIHByb2dyYW1tYWJsZSBwcmUtZGVmaW5lIEpQQSByZWxhdGVk\nCiAqIGFjdGlvbnMgd2hpY2ggaXMgZHJpdmVuIGJ5IGFjdGlvbiB0YWJsZSBk\nZWZpbmUgYnkgYSB0ZXN0IGNhc2UuIEUuZy4KICogPHByZT4KICogT2JqZWN0\nW11bXSBhY3Rpb25zID0gewogKiAgIHsgQWN0LkFjdGlvbnMgWywgYWN0aW9u\nX3NwZWNpZmljX3BhcmFtZXRlcnNdKiB9CiAqIH07CiAqIDwvcHJlPgogKiBT\nZWUgZW51bSB0eXBlIDxjb2RlPkFjdDwvY29kZT4gZm9yIGxpc3Qgb2YgdmFs\naWQgYWN0aW9ucy4KICogPHA+VGhlIGFjdGlvbiBvYmplY3RzIGFyZSBwYXNz\nZWQgYXMgYXJndW1lbnQgdG8gdGhlIGxhdW5jaEFjdGlvblNlcXVlbmNlKCkK\nICogbWV0aG9kLiBUaGUgYWN0aW9ucyBpbiB0aGUgc2VxdWVuY2UgdGFibGUg\nYXJlIGludm9rZWQgaW4gdGhlIG9yZGVyCiAqIHNwZWNpZmllZC4gRWFjaCBh\nY3Rpb24gc2VxdWVuY2UgdGFibGUgaW4gdGhlIGFyZ3VtZW50IGxpc3QgYXJl\nIGxhdW5jaGVkIGluCiAqIGEgc2VwYXJhdGUgdGhyZWFkLgogKgogKiBAYXV0\naG9yIEFsYmVydCBMZWUKICogQHNpbmNlIDIuMAogKi8KcHVibGljIGFic3Ry\nYWN0IGNsYXNzIFNlcXVlbmNlZEFjdGlvbnNUZXN0IGV4dGVuZHMgU1FMTGlz\ndGVuZXJUZXN0Q2FzZSB7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgRGVmYXVsdF9GaXJzdE5hbWUgPSAiRGVmIEZpcnN0TmFtZSI7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIENsYXNzPD8+W10gRXhwZWN0aW5n\nT3B0aW1pc3RpY0xvY2tFeENsYXNzID0KICAgICAgICBuZXcgQ2xhc3M8Pz5b\nXQogICAgICAgICAgICB7IGphdmF4LnBlcnNpc3RlbmNlLk9wdGltaXN0aWNM\nb2NrRXhjZXB0aW9uLmNsYXNzIH07CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIENsYXNzPD8+W10gRXhwZWN0aW5nUGVzc2ltaXN0aWNMb2NrRXhDbGFz\ncyA9CiAgICAgICAgbmV3IENsYXNzPD8+W10KICAgICAgICAgICAgeyBqYXZh\neC5wZXJzaXN0ZW5jZS5QZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24uY2xhc3Mg\nfTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgQ2xhc3M8Pz5bXSBFeHBl\nY3RpbmdMb2NrVGltZW91dEV4Q2xhc3MgPQogICAgICAgIG5ldyBDbGFzczw/\nPltdCiAgICAgICAgICAgIHsgamF2YXgucGVyc2lzdGVuY2UuTG9ja1RpbWVv\ndXRFeGNlcHRpb24uY2xhc3MgfTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgQ2xhc3M8Pz5bXSBFeHBlY3RpbmdBbnlMb2NrRXhDbGFzcyA9CiAgICAg\nICAgbmV3IENsYXNzPD8+W10gewogICAgICAgICAgICBqYXZheC5wZXJzaXN0\nZW5jZS5QZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24uY2xhc3MsCiAgICAgICAg\nICAgIGphdmF4LnBlcnNpc3RlbmNlLkxvY2tUaW1lb3V0RXhjZXB0aW9uLmNs\nYXNzIH07CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTWluVGhy\nZWFkV2FpdEluTXMgPSAxMDAwMDsKCiAgICBwcml2YXRlIHN0YXRpYyBsb25n\nIHdhaXRJbk1zZWMgPSAtMTsKICAgIHByaXZhdGUgU3RyaW5nIGVtcFRhYmxl\nTmFtZTsKICAgIHByaXZhdGUgTGlzdDxUZXN0VGhyZWFkPiB0aHJlYWRzID0g\nbnVsbDsKCiAgICBAU3VwcHJlc3NXYXJuaW5ncygiZGVwcmVjYXRpb24iKQog\nICAgcHJvdGVjdGVkIHZvaWQgY29tbW9uU2V0VXAoKSB7CiAgICAgICAgZW1w\nVGFibGVOYW1lID0gZ2V0TWFwcGluZyhMb2NrRW1wbG95ZWUuY2xhc3MpLmdl\ndFRhYmxlKCkuZ2V0RnVsbE5hbWUoKTsKCiAgICAgICAgY2xlYW51cERCKCk7\nCgogICAgICAgIExvY2tFbXBsb3llZSBlMSwgZTIsIGUzOwogICAgICAgIGUx\nID0gbmV3RW1wbG95ZWUoMSk7CiAgICAgICAgZTIgPSBuZXdFbXBsb3llZSgy\nKTsKICAgICAgICBlMyA9IG5ld0VtcGxveWVlKDMpOwoKICAgICAgICByZXNl\ndFNRTCgpOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW0gPSBudWxsOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5iZWdp\nbigpOwogICAgICAgICAgICBlbS5wZXJzaXN0KGUxKTsKICAgICAgICAgICAg\nZW0ucGVyc2lzdChlMik7CiAgICAgICAgICAgIGVtLnBlcnNpc3QoZTMpOwog\nICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChlbSAhPSBudWxsICYm\nIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAgICAgICBlbS5jbG9zZSgpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFzc2VydEFsbFNRTElu\nT3JkZXIoCiAgICAgICAgICAgICJJTlNFUlQgSU5UTyAiICsgZW1wVGFibGVO\nYW1lICsgIiAuKiIpOwoKICAgICAgICAvLyBkeW5hbWljIHJ1bnRpbWUgdGVz\ndCB0byBkZXRlcm1pbmUgd2FpdCB0aW1lLgogICAgICAgIGxvbmcgc3BlZWRD\nbnQgPSAtMTsKICAgICAgICBpZiAod2FpdEluTXNlYyA9PSAtMSkgewogICAg\nICAgICAgICBzcGVlZENudCA9IHBsYXRmb3JtU3BlZWRUZXN0KCk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB3YWl0SW5Nc2VjID0gTWlu\nVGhyZWFkV2FpdEluTXMgKyAyNTAwMDAgLyAoc3BlZWRDbnQgLyAxMDAwMDAw\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAod2FpdEluTXNlYyA8PSAw\nKSB7CiAgICAgICAgICAgIHdhaXRJbk1zZWMgPSBNaW5UaHJlYWRXYWl0SW5N\nczsgLy8gc2V0IHRvIGRlZmF1bHQKICAgICAgICB9CiAgICAgICAgZ2V0TG9n\nKCkudHJhY2UoCiAgICAgICAgICAgICIqKioqIFNwZWVkIENvbnQ9IiArIHNw\nZWVkQ250ICsgIiwgd2FpdFRpbWUobXMpPSIgKyB3YWl0SW5Nc2VjKTsKICAg\nIH0KCiAgICBwcml2YXRlIGxvbmcgcGxhdGZvcm1TcGVlZFRlc3QoKSB7CiAg\nICAgICAgUGxhdGZvcm1TcGVlZFRlc3RUaHJlYWQgc3BlZWRUaHJlYWQgPSBu\nZXcgUGxhdGZvcm1TcGVlZFRlc3RUaHJlYWQoKTsKICAgICAgICBzcGVlZFRo\ncmVhZC5zdGFydCgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFRocmVh\nZC5zbGVlcCgxMDAwKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGxvZ1N0YWNrKGUpOwogICAgICAg\nIH0KICAgICAgICBzcGVlZFRocmVhZC5pbnRlcnJ1cHQoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBUaHJlYWQuc2xlZXAoNTApOwogICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nbG9nU3RhY2soZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzcGVlZFRo\ncmVhZC5nZXRMb29wQ250KCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNs\nZWFudXBEQigpIHsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCku\nYmVnaW4oKTsKCiAgICAgICAgICAgIGVtLmNyZWF0ZVF1ZXJ5KCJkZWxldGUg\nZnJvbSAiICsgZW1wVGFibGVOYW1lKS5leGVjdXRlVXBkYXRlKCk7CgogICAg\nICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAg\nIH0gY2F0Y2goRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZS5wcmludFN0\nYWNrVHJhY2UoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAoZW0gIT0gbnVsbCAmJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICAg\nICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIExvY2tFbXBsb3llZSBuZXdFbXBsb3llZShpbnQgaWQp\nIHsKICAgICAgICBMb2NrRW1wbG95ZWUgZSA9IG5ldyBMb2NrRW1wbG95ZWUo\nKTsKICAgICAgICBlLnNldElkKGlkKTsKICAgICAgICByZXR1cm4gZTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgTG9nIGdldExvZygpIHsKICAgICAgICByZXR1\ncm4gZW1mLmdldENvbmZpZ3VyYXRpb24oKS5nZXRMb2coIlRlc3RzIik7CiAg\nICB9CgogICAgcHJvdGVjdGVkIExvZyBnZXREdW1wU3RhY2tMb2coKSB7CiAg\nICAgICAgcmV0dXJuIGVtZi5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TG9nKCJE\ndW1wU3RhY2siKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBsb2dTdGFj\nayhUaHJvd2FibGUgdCkgewogICAgICAgIFN0cmluZ1dyaXRlciBzdHIgPSBu\nZXcgU3RyaW5nV3JpdGVyKCk7CiAgICAgICAgUHJpbnRXcml0ZXIgcHJpbnQg\nPSBuZXcgUHJpbnRXcml0ZXIoc3RyKTsKICAgICAgICB0LnByaW50U3RhY2tU\ncmFjZShwcmludCk7CiAgICAgICAgZ2V0RHVtcFN0YWNrTG9nKCkudHJhY2Uo\nc3RyLnRvU3RyaW5nKCkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBub3Rp\nZnlQYXJlbnQoKSB7CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoIm5vdGlmeVBh\ncmVudDoiKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAg\nICAgICAgbm90aWZ5KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIExpc3Qg\nb2Ygc3VwcG9ydCBhY3Rpb25zIGFuZCBwYXJhbWV0ZXIgZGVmaW5pdGlvbi4K\nICAgIHByb3RlY3RlZCBlbnVtIEFjdCB7CiAgICAgICAgLy8gSlBBIGVudGl0\neSBtYW5hZ2VyIEFQSQogICAgICAgIENyZWF0ZUVtLCAgICAgICAgICAvLyAo\nKQogICAgICAgIENsb3NlRW0sICAgICAgICAgICAvLyAoKQogICAgICAgIEZp\nbmQsICAgICAgICAgICAgICAvLyAoW2ludCBpZF0pCiAgICAgICAgRmluZFdp\ndGhMb2NrLCAgICAgIC8vIChpbnQgaWQsIExvY2tNb2RlVHlwZSBsb2NrVHlw\nZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICBbU3RyaW5n\nIHByb3BlcnRpZXMsIE9iamVjdCB2YWx1ZV0qKQogICAgICAgIEZpbmRPYmpl\nY3QsICAgICAgICAvLyAoT2JqZWN0IG9iaiwgTG9ja01vZGVUeXBlIGxvY2tU\neXBlKQogICAgICAgIE5hbWVkUXVlcnlXaXRoTG9jaywvLyAoU3RyaW5nIG5h\nbWVkUXVlcnksIGludCBpZCwgTG9ja01vZGVUeXBlIGxvY2tUeXBlLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgIFtTdHJpbmcgcHJvcGVy\ndGllcywgT2JqZWN0IHZhbHVlXSopCiAgICAgICAgUmVmcmVzaCwgICAgICAg\nICAgIC8vIChbaW50IGlkXSkKICAgICAgICBSZWZyZXNoV2l0aExvY2ssICAg\nLy8gKGludCBpZCwgTG9ja01vZGVUeXBlIGxvY2tUeXBlLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyAgICAgIFtTdHJpbmcgcHJvcGVydGllcywg\nT2JqZWN0IHZhbHVlXSopCiAgICAgICAgUmVmcmVzaE9iamVjdCwgICAgIC8v\nIChPYmplY3Qgb2JqLCBMb2NrTW9kZVR5cGUgbG9ja1R5cGUpCiAgICAgICAg\nTG9jaywgICAgICAgICAgICAgIC8vIChpbnQgaWQsIExvY2tNb2RlVHlwZSBs\nb2NrVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICBb\nU3RyaW5nIHByb3BlcnRpZXMsIE9iamVjdCB2YWx1ZV0qKQogICAgICAgIExv\nY2tPYmplY3QsICAgICAgICAvLyAoT2JqZWN0IG9iaiwgTG9ja01vZGVUeXBl\nIGxvY2tUeXBlKQogICAgICAgIFBlcnNpc3QsICAgICAgICAgICAvLyAoaW50\nIGlkLCBTdHJpbmcgZmlyc3ROYW1lKQogICAgICAgIENsZWFyLCAgICAgICAg\nICAgICAvLyAoKQogICAgICAgIEZsdXNoLCAgICAgICAgICAgICAvLyAoKQog\nICAgICAgIFJlbW92ZSwgICAgICAgICAgICAvLyAoW2ludCBpZF0pCgogICAg\nICAgIFVwZGF0ZUVtcGxveWVlLCAgICAvLyAoW2ludCBpZFssIFN0cmluZyBu\nZXdGaXJzdE5hbWVdXSkKCiAgICAgICAgLy8gT3BlbkpQQSBlbnRpdHkgbWFu\nYWdlciBBUEkKICAgICAgICBEZXRhY2gsICAgICAgICAgICAgLy8gKCk7Cgog\nICAgICAgIC8vIFRyYW5zYWN0aW9uIEFQSQogICAgICAgIFN0YXJ0VHgsICAg\nICAgICAgICAvLyAoKQogICAgICAgIENvbW1pdFR4LCAgICAgICAgICAvLyAo\nKQogICAgICAgIFJvbGxiYWNrVHgsICAgICAgICAvLyAoKQoKICAgICAgICAv\nLyBUaHJlYWQgbWFuYWdlbWVudCBmdW5jdGlvbnMKICAgICAgICBOZXdUaHJl\nYWQsICAgICAgICAgLy8gKGludCB0aHJlYWQpCiAgICAgICAgU3RhcnRUaHJl\nYWQsICAgICAgIC8vIChpbnQgdGhyZWFkKQogICAgICAgIE5vdGlmeSwgICAg\nICAgICAgICAvLyAoaW50IHRocmVhZCwgW2ludCBzbGVlcFRpbWVNcyldICkK\nICAgICAgICBXYWl0LCAgICAgICAgICAgICAgLy8gKGludCB0aHJlYWQsIFtp\nbnQgc2xlZXBUaW1lTXMpXSApCgogICAgICAgIFdhaXRBbGxDaGlsZHJlbiwg\nICAvLyAoKQogICAgICAgIEpvaW5QYXJlbnQsICAgICAgICAvLyAoKQogICAg\nICAgIFlpZWxkVGhyZWFkLCAgICAgICAvLyAoKQoKICAgICAgICAvLyBVdGls\naXR5IGZ1bmN0aW9ucwogICAgICAgIFNsZWVwLCAgICAgICAgICAgICAvLyAo\naW50IHNsZWVwVGltZU1zKQogICAgICAgIEluZm8sICAgICAgICAgICAgICAv\nLyAoT2JqZWN0IG1zZykKICAgICAgICBUcmFjZSwgICAgICAgICAgICAgLy8g\nKE9iamVjdCBtc2cpCiAgICAgICAgRXJyb3IsICAgICAgICAgICAgIC8vIChP\nYmplY3QgbXNnKQogICAgICAgIFdhcm4sICAgICAgICAgICAgICAvLyAoT2Jq\nZWN0IG1zZykKICAgICAgICBEZXRhY2hTZXJpYWxpemUsICAgLy8gKGludCBp\nZCwgaW50IGlkeCkKCiAgICAgICAgLy8gVGVzdCBhbmQgYXNzZXJ0aW9uIGZ1\nbmN0aW9ucwogICAgICAgIFRlc3RFeGNlcHRpb24sICAgICAvLyAoaW50IHRo\ncmVhZCwgW0NsYXNzIGV4Y2VwdGlvbnNdKikKICAgICAgICBSZXNldEV4Y2Vw\ndGlvbiwgICAgLy8gKCkKICAgICAgICBUZXN0RW1wbG95ZWUsICAgICAgLy8g\nKGludCBpZCwgU3RyaW5nIEZpcnN0TmFtZSwgaW50IHZlcnNpb25JbmMpCiAg\nICAgICAgRW1wbG95ZWVOb3ROdWxsLCAgIC8vIChpbnQgaWQpCiAgICAgICAg\nU2F2ZVZlcnNpb24sICAgICAgIC8vIChbaW50IGlkXSkKICAgICAgICBUZXN0\nVmVyc2lvbiwgICAgICAgLy8gKGludCBpZCwgaW50IGluY3JlbWVudCkKICAg\nICAgICBUZXN0TG9ja01vZGUsICAgICAgLy8gKGludCBpZCwgTG9ja01vZGVU\neXBlIGxvY2tNb2RlKQoKICAgICAgICBUZXN0LCAgICAgICAgICAgICAgLy8g\nT3Blbi1lbmRlZCB0ZXN0aW5nIGFjdGlvbnMKICAgIH07CgogICAgcHVibGlj\nIHZvaWQgbGF1bmNoQWN0aW9uU2VxdWVuY2UoU3RyaW5nIHRlc3ROYW1lLCBP\nYmplY3QgcGFyYW1ldGVycywKICAgICAgICBPYmplY3RbXVtdLi4uIGFjdGlv\nbnMpIHsKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgbG9n\nLnRyYWNlKCI9PT09PT09PT09PT0vLy8gIiArIHRlc3ROYW1lICsgIiAvLy89\nPT09PT09PT09PT0iKTsKICAgICAgICBpZiAocGFyYW1ldGVycyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJzIGluc3RhbmNlb2YgU3Ry\naW5nW10pIHsKICAgICAgICAgICAgICAgIGZvciAoU3RyaW5nIHBhcmFtZXRl\nciA6IChTdHJpbmdbXSkgcGFyYW1ldGVycykgewogICAgICAgICAgICAgICAg\nICAgIGxvZy50cmFjZSgiLS0tPiAiICsgcGFyYW1ldGVyKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbWV0ZXJzIGlu\nc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nIi0tLT4gIiArIChTdHJpbmcpIHBhcmFtZXRlcnMpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCku\nYmVnaW4oKTsKICAgICAgICAgICAgTG9ja0VtcGxveWVlIGVpID0gZW0uZmlu\nZChMb2NrRW1wbG95ZWUuY2xhc3MsIDEpOwogICAgICAgICAgICBhc3NlcnRO\nb3ROdWxsKGVpKTsKICAgICAgICAgICAgZWkuc2V0Rmlyc3ROYW1lKERlZmF1\nbHRfRmlyc3ROYW1lKTsKICAgICAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24o\nKS5jb21taXQoKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsK\nICAgICAgICAgICAgbG9nU3RhY2soZXgpOwogICAgICAgICAgICBUaHJvd2Fi\nbGUgcm9vdENhdXNlID0gZXguZ2V0Q2F1c2UoKTsKICAgICAgICAgICAgU3Ry\naW5nIGZhaWxTdHIgPSAiVW5hYmxlIHRvIHByZS1pbml0aWFsaXplIEZpcnN0\nTmFtZSB0byBrbm93biAiCiAgICAgICAgICAgICAgICArICJ2YWx1ZToiICsg\nZXguZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAiOiIgKyBleDsKICAgICAgICAg\nICAgaWYgKHJvb3RDYXVzZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBm\nYWlsU3RyICs9ICJcbiAgICAgICAgLS0gQ2F1c2UgLS0+ICIKICAgICAgICAg\nICAgICAgICAgICArIHJvb3RDYXVzZS5nZXRDbGFzcygpLmdldE5hbWUoKSAr\nICI6IiArIHJvb3RDYXVzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBm\nYWlsKGZhaWxTdHIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChlbSAhPSBudWxsICYmIGVtLmlzT3BlbigpKSB7CiAgICAgICAgICAg\nICAgICBpZiAoZW0uZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuZ2V0\nUm9sbGJhY2tPbmx5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKCJmaW5hbGx5OiByb2xsZWRiYWNrIik7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJmaW5hbGx5OiByb2xs\nZWRiYWNrIGNvbXBsZXRlZCIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiZmluYWxs\neTogY29tbWl0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtLmdldFRy\nYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZy50cmFjZSgiZmluYWxseTogY29tbWl0IGNvbXBsZXRlZCIpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaW50IG51bVRocmVhZHMgPSBhY3Rpb25zLmxlbmd0aDsKICAgICAg\nICB0aHJlYWRzID0gbmV3IEFycmF5TGlzdDxUZXN0VGhyZWFkPihudW1UaHJl\nYWRzKTsKICAgICAgICBUZXN0VGhyZWFkIG1haW5UaHJlYWQgPSBuZXcgVGVz\ndFRocmVhZCgwLCBhY3Rpb25zKTsKICAgICAgICB0aHJlYWRzLmFkZChtYWlu\nVGhyZWFkKTsKICAgICAgICBsYXVuY2hDb21tb25TZXF1ZW5jZShtYWluVGhy\nZWFkKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbGF1bmNoQ29tbW9uU2Vx\ndWVuY2UoVGVzdFRocmVhZCB0aGlzVGhyZWFkICkgewogICAgICAgIGludCB0\naHJlYWRUb1J1biA9IHRoaXNUaHJlYWQudGhyZWFkVG9SdW47CiAgICAgICAg\nT2JqZWN0W11bXVtdIGFjdGlvbnMgPSB0aGlzVGhyZWFkLmFjdGlvbnM7CiAg\nICAgICAgTWFwPEludGVnZXIsTG9ja0VtcGxveWVlPiBlbXBsb3llZXMgPSB0\naGlzVGhyZWFkLmVtcGxveWVlczsKCiAgICAgICAgYXNzZXJ0Tm90TnVsbCgi\nVGVzdCBzZXF1ZW5jZSB0YWJsZSBtdXN0IGJlIGRlZmluZWQiLCBhY3Rpb25z\nKTsKICAgICAgICBhc3NlcnQgKGFjdGlvbnMubGVuZ3RoID49IDEpOwoKICAg\nICAgICBpbnQgbnVtVGhyZWFkcyA9IGFjdGlvbnMubGVuZ3RoOwogICAgICAg\nIGludCBzYXZlVmVyc2lvbiA9IC0xOwoKICAgICAgICBMb2cgbG9nID0gZ2V0\nTG9nKCk7CiAgICAgICAgbG9nLnRyYWNlKCI+Pj4+IFNlcXVlbmNlZCBUZXN0\nOiBUaHJlYWRzPSIgKyB0aHJlYWRUb1J1biArICcvJwogICAgICAgICAgICAr\nIG51bVRocmVhZHMpOwogICAgICAgIGxvbmcgZW5kVGltZSA9IFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpICsgd2FpdEluTXNlYzsKCiAgICAgICAgRW50\naXR5TWFuYWdlciBlbSA9IG51bGw7CiAgICAgICAgSW50ZWdlciBpZCA9IDE7\nCiAgICAgICAgTG9ja0VtcGxveWVlIGVtcGxveWVlID0gbnVsbDsKICAgICAg\nICBMb2NrTW9kZVR5cGUgbG9ja01vZGUgPSBudWxsOwogICAgICAgIEFjdCBj\ndXJBY3Rpb24gPSBudWxsOwogICAgICAgIGludCBhY3RJbmRleCA9IDA7CiAg\nICAgICAgT2JqZWN0W11bXSB0aHJlYWRTZXF1ZW5jZSA9IGFjdGlvbnNbdGhy\nZWFkVG9SdW5dOwogICAgICAgIGZvciAoT2JqZWN0W10gYXJncyA6IHRocmVh\nZFNlcXVlbmNlKSB7CiAgICAgICAgICAgIGN1ckFjdGlvbiA9IChBY3QpIGFy\nZ3NbMF07CiAgICAgICAgICAgIFN0cmluZyBjdXJBY3QgPSAiQWN0W3QiICsg\ndGhyZWFkVG9SdW4gKyAiOiIgKyAoKythY3RJbmRleCkgKyJdPSIgKyBBcnJh\neXMudG9TdHJpbmcoYXJncyk7CiAgICAgICAgICAgIGxvZy50cmFjZSgiKiog\nIiArIGN1ckFjdCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBzd2l0Y2ggKGN1ckFjdGlvbikgewogICAgICAgICAgICAgICAgY2FzZSBD\ncmVhdGVFbToKICAgICAgICAgICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIENsb3NlRW06CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGVtICE9IG51bGwgJiYgZW0uaXNPcGVuKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgZW0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ2xl\nYXI6CiAgICAgICAgICAgICAgICAgICAgZW0uY2xlYXIoKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRmx1c2g6\nCiAgICAgICAgICAgICAgICAgICAgZW0uZmx1c2goKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRmluZDoKICAg\nICAgICAgICAgICAgICAgICBpZCA9IDE7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGFyZ3MubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZCA9IChJbnRlZ2VyKWFyZ3NbMV07CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW0uZmluZChMb2Nr\nRW1wbG95ZWUuY2xhc3MsIGlkKTsKICAgICAgICAgICAgICAgICAgICBsb2cu\ndHJhY2UoIkVtcGxveWVlPSIgKyBlbXBsb3llZSk7CiAgICAgICAgICAgICAg\nICAgICAgaWYoIGVtcGxveWVlICE9IG51bGwgKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGVtcGxveWVlcy5wdXQoaWQsIGVtcGxveWVlKTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBlbXBsb3llZXMucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEZpbmRXaXRoTG9jazoKICAgICAgICAgICAgICAgICAgICBpZCA9IDE7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbMV0gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZCA9IChJbnRlZ2VyKWFyZ3NbMV07\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxv\nY2tNb2RlID0gTG9ja01vZGVUeXBlLk5PTkU7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGFyZ3NbMl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBsb2NrTW9kZSA9IChMb2NrTW9kZVR5cGUpYXJnc1syXTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgTWFwPFN0cmlu\nZywgT2JqZWN0PiBmaW5kUHJvcHMgPSBidWlsZFByb3BzTWFwKGFyZ3MsIDMp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChmaW5kUHJvcHMgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICBlbXBsb3llZSA9IGVtLmZpbmQo\nTG9ja0VtcGxveWVlLmNsYXNzLCBpZCwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvY2tNb2RlLCBmaW5kUHJvcHMpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtcGxveWVl\nID0gZW0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKExvY2tF\nbXBsb3llZS5jbGFzcywgaWQsIGxvY2tNb2RlKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3ll\nZT0iICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGlmKCBlbXBs\nb3llZSAhPSBudWxsICkgewogICAgICAgICAgICAgICAgICAgICAgICBlbXBs\nb3llZXMucHV0KGlkLCBlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWVzLnJl\nbW92ZShpZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGaW5kT2JqZWN0\nOgogICAgICAgICAgICAgICAgICAgIGVtLmZpbmQoKENsYXNzPD8+KWFyZ3Nb\nMV0sIGFyZ3NbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgIChMb2NrTW9k\nZVR5cGUpIGFyZ3NbM10pOwogICAgICAgICAgICAgICAgICAgIC8vIGxvZy50\ncmFjZSgiRW1wbG95ZWU9IiArIGVtcGxveWVlKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTmFtZWRRdWVyeVdp\ndGhMb2NrOgogICAgICAgICAgICAgICAgICAgIFN0cmluZyBuYW1lZFF1ZXJ5\nID0gIj8/Pz8iOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0\naCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZWRRdWVyeSA9\nIChTdHJpbmcpYXJnc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgaWQgPSAxOwogICAgICAgICAgICAgICAgICAgIGlm\nIChhcmdzLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWQgPSAoSW50ZWdlcilhcmdzWzJdOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBsb2NrTW9kZSA9IG51bGw7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMykgewogICAgICAgICAg\nICAgICAgICAgICAgICBsb2NrTW9kZSA9IChMb2NrTW9kZVR5cGUpYXJnc1sz\nXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nTWFwPFN0cmluZywgT2JqZWN0PiBxdWVyeVByb3BzID0gYnVpbGRQcm9wc01h\ncChhcmdzLCA0KTsKICAgICAgICAgICAgICAgICAgICAvL1R5cGVkUXVlcnk8\nTG9ja0VtcGxveWVlPiBxID0gZW0uY3JlYXRlTmFtZWRRdWVyeShuYW1lZFF1\nZXJ5LCBMb2NrRW1wbG95ZWUuY2xhc3MpOwogICAgICAgICAgICAgICAgICAg\nIFF1ZXJ5IHEgPSBlbS5jcmVhdGVOYW1lZFF1ZXJ5KG5hbWVkUXVlcnkpOwog\nICAgICAgICAgICAgICAgICAgIGlmKCBsb2NrTW9kZSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHEuc2V0TG9ja01vZGUobG9ja01vZGUp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBp\nZiggcXVlcnlQcm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGZvciggU3RyaW5nIG5hbWUgOiBxdWVyeVByb3BzLmtleVNldCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLnNldEhpbnQobmFtZSwg\ncXVlcnlQcm9wcy5nZXQobmFtZSkpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIHEuc2V0UGFyYW1ldGVyKCJpZCIsIGlkKTsKICAgICAgICAgICAgICAgICAg\nICBlbXBsb3llZSA9IChMb2NrRW1wbG95ZWUpcS5nZXRTaW5nbGVSZXN1bHQo\nKTsKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoIkVtcGxveWVlPSIg\nKyBlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgaWYoIGVtcGxveWVl\nICE9IG51bGwgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtcGxveWVl\ncy5wdXQoaWQsIGVtcGxveWVlKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgICAgICBlbXBsb3llZXMucmVtb3Zl\nKGlkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBlcnNpc3Q6CiAgICAg\nICAgICAgICAgICAgICAgaWQgPSAxOwogICAgICAgICAgICAgICAgICAgIGlm\nIChhcmdzWzFdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWQgPSAoSW50ZWdlcilhcmdzWzFdOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBTdHJpbmcgZmlyc3ROYW1lID0gKFN0cmlu\nZylhcmdzWzJdOwogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gbmV3\nIExvY2tFbXBsb3llZSgpOwogICAgICAgICAgICAgICAgICAgIGVtcGxveWVl\nLnNldElkKGlkKTsKICAgICAgICAgICAgICAgICAgICBlbXBsb3llZS5zZXRG\naXJzdE5hbWUoZmlyc3ROYW1lKTsKICAgICAgICAgICAgICAgICAgICBsb2cu\ndHJhY2UoIkVtcGxveWVlPSIgKyBlbXBsb3llZSk7CiAgICAgICAgICAgICAg\nICAgICAgZW0ucGVyc2lzdChlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFJlbW92ZToKICAgICAg\nICAgICAgICAgICAgICBpZCA9IDE7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGFyZ3MubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZCA9IChJbnRlZ2VyKWFyZ3NbMV07CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVzLmdldChp\nZCk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3llZT0i\nICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGVtLnJlbW92ZShl\nbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFJlZnJlc2g6CiAgICAgICAgICAgICAgICAgICAgaWQg\nPSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSAoSW50ZWdlcilhcmdz\nWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBlbXBsb3llZSA9IGVtcGxveWVlcy5nZXQoaWQpOwogICAgICAgICAgICAg\nICAgICAgIGxvZy50cmFjZSgiRW1wbG95ZWUoYmVmb3JlKT0iICsgZW1wbG95\nZWUpOwogICAgICAgICAgICAgICAgICAgIGVtLnJlZnJlc2goZW1wbG95ZWUp\nOwogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiRW1wbG95ZWUoYWZ0\nZXIpID0iICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBSZWZyZXNoV2l0aExvY2s6CiAgICAg\nICAgICAgICAgICAgICAgaWQgPSAxOwogICAgICAgICAgICAgICAgICAgIGlm\nIChhcmdzWzFdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWQgPSAoSW50ZWdlcilhcmdzWzFdOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBsb2NrTW9kZSA9IExvY2tNb2RlVHlwZS5O\nT05FOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzJdICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9ja01vZGUgPSAoTG9ja01v\nZGVUeXBlKWFyZ3NbMl07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVzLmdldChpZCk7CiAg\nICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3llZShiZWZvcmUp\nPSIgKyBlbXBsb3llZSk7CiAgICAgICAgICAgICAgICAgICAgTWFwPFN0cmlu\nZywgT2JqZWN0PiByZWZyZXNoUHJvcHMgPSBidWlsZFByb3BzTWFwKGFyZ3Ms\nCiAgICAgICAgICAgICAgICAgICAgICAgIDMpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChyZWZyZXNoUHJvcHMgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBlbS5yZWZyZXNoKGVtcGxveWVlLCBsb2NrTW9kZSwgcmVm\ncmVzaFByb3BzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICBlbS5yZWZyZXNoKGVtcGxveWVlLCBsb2Nr\nTW9kZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGxvZy50cmFjZSgiRW1wbG95ZWUoYWZ0ZXIpID0iICsgZW1wbG95ZWUp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBSZWZyZXNoT2JqZWN0OgogICAgICAgICAgICAgICAgICAgIGVtLnJl\nZnJlc2goYXJnc1sxXSwgKExvY2tNb2RlVHlwZSkgYXJnc1syXSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIExv\nY2s6CiAgICAgICAgICAgICAgICAgICAgaWQgPSAxOwogICAgICAgICAgICAg\nICAgICAgIGlmIChhcmdzWzFdICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWQgPSAoSW50ZWdlcilhcmdzWzFdOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsb2NrTW9kZSA9IExvY2tN\nb2RlVHlwZS5OT05FOwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzJd\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9ja01vZGUg\nPSAoTG9ja01vZGVUeXBlKWFyZ3NbMl07CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVzLmdl\ndChpZCk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3ll\nZT0iICsgZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIE1hcDxTdHJp\nbmcsIE9iamVjdD4gbG9ja1Byb3BzID0gYnVpbGRQcm9wc01hcChhcmdzLCAz\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9ja1Byb3BzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW0ubG9jayhlbXBsb3llZSwg\nbG9ja01vZGUsIGxvY2tQcm9wcyk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW0ubG9jayhlbXBsb3ll\nZSwgbG9ja01vZGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTG9ja09i\namVjdDoKICAgICAgICAgICAgICAgICAgICBlbS5sb2NrKGFyZ3NbMV0sIChM\nb2NrTW9kZVR5cGUpIGFyZ3NbMl0pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBVcGRhdGVFbXBsb3llZToKICAg\nICAgICAgICAgICAgICAgICBpZCA9IDE7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGFyZ3MubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZCA9IChJbnRlZ2VyKSBhcmdzWzFdOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICBlbXBsb3llZSA9IGVtcGxveWVlcy5n\nZXQoaWQpOwogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiRW1wbG95\nZWUgKGJlZm9yZSk6IiArIGVtcGxveWVlKTsKICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcgbmV3Rmlyc3ROYW1lID0gIlVua25vd24iOwogICAgICAgICAg\nICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3Rmlyc3ROYW1lID0gKFN0cmluZykgYXJnc1syXTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICBuZXdGaXJzdE5hbWUgPSAobmV3IERhdGUoKSkudG9TdHJpbmco\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nZW1wbG95ZWUuc2V0Rmlyc3ROYW1lKG5ld0ZpcnN0TmFtZSk7CiAgICAgICAg\nICAgICAgICAgICAgbG9nLnRyYWNlKCJFbXBsb3llZSAoYWZ0ZXIpIDoiICsg\nZW1wbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAg\nICAgICAgICAgIGNhc2UgRGV0YWNoOgogICAgICAgICAgICAgICAgICAgIGlk\nID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1sxXSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gKEludGVnZXIpYXJn\nc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgZW1wbG95ZWUgPSBlbXBsb3llZXMuZ2V0KGlkKTsKICAgICAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoIkVtcGxveWVlIChiZWZvcmUpIDoiICsgZW1w\nbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIExvY2tFbXBsb3llZSBkZXRF\nbXBsb3llZSA9ICgoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGVtCiAgICAgICAg\nICAgICAgICAgICAgICAgIC5nZXREZWxlZ2F0ZSgpKS5kZXRhY2hDb3B5KGVt\ncGxveWVlKTsKICAgICAgICAgICAgICAgICAgICBlbXBsb3llZXMucHV0KChJ\nbnRlZ2VyKWFyZ3NbMl0sIGRldEVtcGxveWVlKTsKICAgICAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoIkVtcGxveWVlIChhZnRlcikgIDoiICsgZGV0RW1w\nbG95ZWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAg\nICAgICAgIGNhc2UgU3RhcnRUeDoKICAgICAgICAgICAgICAgICAgICBlbS5n\nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENvbW1pdFR4OgogICAgICAg\nICAgICAgICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFJvbGxiYWNrVHg6CiAgICAgICAgICAgICAgICAgICAgZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwoKICAgICAgICAgICAgICAgIGNhc2UgTmV3VGhyZWFkOgogICAgICAgICAg\nICAgICAgICAgIGludCBjaGlsZFRvUnVuID0gKEludGVnZXIpIGFyZ3NbMV07\nCiAgICAgICAgICAgICAgICAgICAgVGVzdFRocmVhZCB0MSA9IG5ldyBUZXN0\nVGhyZWFkKGNoaWxkVG9SdW4sIGFjdGlvbnMpOwogICAgICAgICAgICAgICAg\nICAgIHRocmVhZHMuYWRkKHQxKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgU3RhcnRUaHJlYWQ6CiAgICAgICAg\nICAgICAgICAgICAgdGhyZWFkcy5nZXQoKEludGVnZXIpIGFyZ3NbMV0pLnN0\nYXJ0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIE5vdGlmeToKICAgICAgICAgICAgICAgIAkvLyBzbGVlcCBh\nbmQgbGV0IG90aGVyIHRocmVhZHMgaGFzIGEgY2hhbmNlIHRvIHdhaXQsCiAg\nICAgICAgICAgICAgICAJLy8gb3RoZXJ3aXNlIHRoaXMgbm90aWZ5IG1heSB0\ncmlnZ2VyIGJlZm9yZSB0aGUgb3RoZXIgCiAgICAgICAgICAgICAgICAJLy8g\ndGhyZWFkIGhhcyBhIGNoYW5jZSB0byB3YWl0LgogICAgICAgICAgICAgICAg\nCVRocmVhZC5zbGVlcCg1MDApOwogICAgICAgICAgICAgICAgICAgIGludCBu\nb3RpZnlUaHJlYWRpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFy\nZ3MubGVuZ3RoID4gMSAmJiBhcmdzWzFdICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgbm90aWZ5VGhyZWFkaWQgPSAoSW50ZWdlcikgYXJn\nc1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGFyZ3MubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICAg\nICAgICBUaHJlYWQuc2xlZXAoKEludGVnZXIpIGFyZ3NbMl0pOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiggbm90aWZ5\nVGhyZWFkaWQgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBub3Rp\nZnlQYXJlbnQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJlYWRzLmdldChub3RpZnlUaHJlYWRp\nZCkubm90aWZ5VGhyZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBX\nYWl0OgogICAgICAgICAgICAgICAgICAgIGludCB3YWl0VGhyZWFkaWQgPSB0\naHJlYWRUb1J1bjsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPiAxICYmIGFyZ3NbMV0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICB3YWl0VGhyZWFkaWQgPSAoSW50ZWdlcikgYXJnc1sxXTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaW50IHdh\naXRUaW1lID0gKGludCkod2FpdEluTXNlYyAvIDUpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDIgJiYgYXJnc1syXSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRUaW1lID0gKEludGVn\nZXIpIGFyZ3NbMl07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIGlmICh3YWl0VGltZSA8IE1pblRocmVhZFdhaXRJbk1zIC8g\nMikKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdFRpbWUgPSBNaW5UaHJl\nYWRXYWl0SW5NcyAvIDI7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKCI+PiBTdGFydGVkIHdhaXQgZm9yICIgKyB3YWl0VGltZSArICIgbXMiKTsK\nICAgICAgICAgICAgICAgICAgICBpZiggd2FpdFRocmVhZGlkICE9IDApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1RocmVhZC53YWl0KHdhaXRU\naW1lKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHdhaXQod2FpdFRpbWUpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGxvZy50cmFjZSgiPDwgRW5kZWQgd2FpdCIpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2Ug\nRW1wbG95ZWVOb3ROdWxsOgogICAgICAgICAgICAgICAgICAgIGlkID0gMTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1sxXSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlkID0gKEludGVnZXIpYXJnc1sxXTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZW1w\nbG95ZWUgPSBlbXBsb3llZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAg\nICBhc3NlcnROb3ROdWxsKGN1ckFjdCwgZW1wbG95ZWUpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUZXN0RW1w\nbG95ZWU6CiAgICAgICAgICAgICAgICAgICAgaWQgPSAxOwogICAgICAgICAg\nICAgICAgICAgIGlmIChhcmdzWzFdICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWQgPSAoSW50ZWdlcilhcmdzWzFdOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbXBsb3llZSA9IGVt\ncGxveWVlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAo\nYXJncy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzNdICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhjdXJB\nY3QsIHNhdmVWZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAoSW50ZWdlcikgYXJnc1szXSwgZW1wbG95ZWUuZ2V0VmVyc2lvbigp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3Nb\nMl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNz\nZXJ0RXF1YWxzKGN1ckFjdCwgKFN0cmluZykgYXJnc1syXSwgZW1wbG95ZWUK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Rmlyc3ROYW1l\nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJn\nc1sxXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\nc3NlcnRFcXVhbHMoY3VyQWN0LCBpZC5pbnRWYWx1ZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGVtcGxveWVlLmdldElkKCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAg\nICAgICAgICAgICAgICAgYXNzZXJ0TnVsbChjdXJBY3QsIGVtcGxveWVlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNhdmVWZXJzaW9uOgogICAgICAg\nICAgICAgICAgICAgIGlkID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nYXJncy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlk\nID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGVtcGxveWVlID0gZW1wbG95ZWVzLmdldChp\nZCk7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVZlcnNpb24gPSBlbXBsb3ll\nZS5nZXRWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKCJzYXZlIHZlcnNpb249ICIgKyBzYXZlVmVyc2lvbik7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRlc3RWZXJz\naW9uOgogICAgICAgICAgICAgICAgICAgIGlkID0gMTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoYXJnc1sxXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlkID0gKEludGVnZXIpIGFyZ3NbMV07CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGludCBpbmNyZW1lbnQg\nPSAoSW50ZWdlcilhcmdzWzJdOwogICAgICAgICAgICAgICAgICAgIGVtcGxv\neWVlID0gZW1wbG95ZWVzLmdldChpZCk7CiAgICAgICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKCJ0ZXN0IHZlcnNpb246IGV4cGVjdGVkPSIKICAgICAgICAg\nICAgICAgICAgICAgICAgKyAoc2F2ZVZlcnNpb24gKyBpbmNyZW1lbnQpICsg\nIiwgdGVzdGluZz0iCiAgICAgICAgICAgICAgICAgICAgICAgICsgZW1wbG95\nZWUuZ2V0VmVyc2lvbigpKTsKCiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKGN1ckFjdCwgc2F2ZVZlcnNpb24gKyBpbmNyZW1lbnQsIGVtcGxv\neWVlCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRWZXJzaW9uKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBUZXN0TG9ja01vZGU6CiAgICAgICAgICAgICAgICAgICAgaWQgPSAxOwog\nICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzFdICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWQgPSAoSW50ZWdlcikgYXJnc1sxXTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZW1w\nbG95ZWUgPSBlbXBsb3llZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAg\nICBMb2NrTW9kZVR5cGUgZXhwZWN0ZWRsb2NrTW9kZSA9IChMb2NrTW9kZVR5\ncGUpYXJnc1syXTsKICAgICAgICAgICAgICAgICAgICBMb2NrTW9kZVR5cGUg\ndGVzdGluZ2xvY2tNb2RlID0gZW0uZ2V0TG9ja01vZGUoZW1wbG95ZWUpOwog\nICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSgidGVzdCB2ZXJzaW9uOiBl\neHBlY3RlZD0iICsgZXhwZWN0ZWRsb2NrTW9kZQogICAgICAgICAgICAgICAg\nICAgICAgICArICIsIHRlc3Rpbmc9IiArIHRlc3Rpbmdsb2NrTW9kZSk7Cgog\nICAgICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhjdXJBY3QsIGdldENh\nbm9uaWNhbChleHBlY3RlZGxvY2tNb2RlKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgZ2V0Q2Fub25pY2FsKHRlc3Rpbmdsb2NrTW9kZSkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBSZXNl\ndEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICB0aGlzVGhyZWFkLnRo\ncm93YWJsZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFRlc3RFeGNlcHRpb246CiAgICAgICAgICAg\nICAgICAgICAgTGlzdDxDbGFzczw/Pj4gZXhwZWN0ZWRFeGNlcHRpb25zID0g\nbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAy\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkRXhjZXB0aW9u\ncyA9IG5ldyBBcnJheUxpc3Q8Q2xhc3M8Pz4+KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAyOyBpIDwgYXJncy5sZW5ndGg7ICsr\naSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0g\naW5zdGFuY2VvZiBPYmplY3RbXSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZvciAoT2JqZWN0IG8gOiAoT2JqZWN0W10pIGFyZ3NbaV0p\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8g\nIT0gbnVsbCAmJiBvIGluc3RhbmNlb2YgQ2xhc3MpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkRXhjZXB0aW9u\ncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5hZGQoKENsYXNzPD8+KSBvKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0gIT0gbnVs\nbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBhcmdz\nW2ldIGluc3RhbmNlb2YgQ2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZXhwZWN0ZWRFeGNlcHRpb25zCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkKChDbGFzczw/Pikg\nYXJnc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIFN0cmluZyB0ZXN0RXhDbGFzcyA9IG51bGw7CiAgICAgICAgICAg\nICAgICAgICAgVGhyb3dhYmxlIGN1clRocm93YWJsZSA9IG51bGw7CiAgICAg\nICAgICAgICAgICAgICAgaW50IHRocmVhZElkID0gdGhyZWFkVG9SdW47CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSkgewogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJlYWRJZCA9IChJbnRlZ2VyKSBhcmdz\nWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBUZXN0VGhyZWFkIGV4VGhyZWFkID0gdGhyZWFkcy5nZXQodGhyZWFkSWQp\nOwogICAgICAgICAgICAgICAgICAgIGN1clRocm93YWJsZSA9IGV4VGhyZWFk\nLnRocm93YWJsZTsKICAgICAgICAgICAgICAgICAgICB0ZXN0RXhDbGFzcyA9\nIHByb2Nlc3NFeGNlcHRpb24oY3VyQWN0aW9uLCBjdXJUaHJvd2FibGUpOwoK\nICAgICAgICAgICAgICAgICAgICBib29sZWFuIGV4TWF0Y2hlZCA9IGZhbHNl\nOwogICAgICAgICAgICAgICAgICAgIGlmIChleHBlY3RlZEV4Y2VwdGlvbnMg\nIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAmJiBleHBlY3RlZEV4\nY2VwdGlvbnMuc2l6ZSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBmb3IgKENsYXNzPD8+IGV4cGVjdGVkRXhjZXB0aW9uIDoKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkRXhjZXB0aW9ucykgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoRXhwZWN0ZWRFeGNl\ncHRpb24oY3VyQWN0LCBleHBlY3RlZEV4Y2VwdGlvbiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjdXJUaHJvd2FibGUpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZXhNYXRjaGVkID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChjdXJUaHJvd2FibGUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXhNYXRjaGVkID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBpZiAoIWV4TWF0Y2hlZCkgewogICAgICAgICAg\nICAgICAgICAgICAgICBsb2cudHJhY2UodGVzdEV4Q2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoY3VyVGhyb3dhYmxlICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ1N0YWNrKGN1clRocm93\nYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZShjdXJB\nY3QgKyAiOkV4cGVjdGluZz0iICsgZXhwZWN0ZWRFeGNlcHRpb25zCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgIiwgVGVzdGluZz0iICsgdGVzdEV4Q2xh\nc3MsIGV4TWF0Y2hlZCk7CiAgICAgICAgICAgICAgICAgICAgZXhUaHJlYWQu\ndGhyb3dhYmxlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nCiAgICAgICAgICAgICAgICBjYXNlIFdhaXRBbGxDaGlsZHJlbjoKICAgICAg\nICAgICAgICAgICAgICAvLyB3YWl0IGZvciB0aHJlYWRzIHRvIGRpZSBvciB0\naW1lb3V0CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJjaGVja2lu\nZyBpZiB0aHJlYWQgaXMgYWxpdmUgZm9yICIgKwogICAgICAgICAgICAgICAg\nICAgICAgICAoZW5kVGltZS1TeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSkg\nKyAibXMuIik7CiAgICAgICAgICAgICAgICAgICAgaW50IGRlYWRUaHJlYWRz\nID0gMDsKICAgICAgICAgICAgICAgICAgICBMaXN0PFRlc3RUaHJlYWQ+IHBy\nb2NlZWRUaHJlYWQgPQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQXJy\nYXlMaXN0PFRlc3RUaHJlYWQ+KHRocmVhZHMpOwogICAgICAgICAgICAgICAg\nICAgIHdoaWxlIChwcm9jZWVkVGhyZWFkLnNpemUoKSA+IDAKICAgICAgICAg\nICAgICAgICAgICAgICAgJiYgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkg\nPCBlbmRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoVGVz\ndFRocmVhZCB0aHJlYWQgOiBwcm9jZWVkVGhyZWFkKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAodGhyZWFkLmlzQWxpdmUoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZSh0aHJlYWQg\nKyAiIGlzIHN0aWxsIGFsaXZlLCB3YWl0IiArCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICIgZm9yIDUwMG1zIGFuZCB0cnkgYWdhaW4u\nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKDUwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZTEpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKCJ3YWl0aW5nIGNoaWxkcmVuIHRocmVhZCAoIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIChlbmRUaW1l\nIC0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArICIgbXMgbGVmdCkiKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZGVhZFRocmVhZHMrKzsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZih0aHJlYWQuYXNzZXJ0RXJyb3IgIT0g\nbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IHRocmVhZC5hc3NlcnRFcnJvcjsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncHJvY2VlZFRocmVhZC5yZW1vdmUodGhyZWFkKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2VlZFRo\ncmVhZC5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxv\nZy50cmFjZShwcm9jZWVkVGhyZWFkLnNpemUoKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyAiIHRocmVhZHMgc3RpbGwgYWxpdmUuIik7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZvciAoVGVzdFRocmVhZCB0aHJlYWQgOiBw\ncm9jZWVkVGhyZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoIlNlbmQgaW50ZXJydXB0IHRvIHRocmVhZCAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyB0aHJlYWQudGhyZWFkVG9SdW4p\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyZWFkLmludGVycnVw\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKb2luUGFyZW50OgogICAgICAgICAgICAgICAgICAgIGZv\nciAoVGhyZWFkIHRocmVhZCA6IHRocmVhZHMpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYm9vbGVhbiBhbGl2ZSA9IHRocmVhZC5pc0FsaXZlKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGl2ZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKHRocmVhZC5nZXROYW1lKCkg\nKyAiIGlzIHN0aWxsIGFsaXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncmVhZC5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0aHJlYWQuam9pbigpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsb2dTdGFjayhlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgWWllbGRUaHJlYWQ6CiAgICAgICAgICAgICAg\nICAgICAgVGhyZWFkLnlpZWxkKCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CgogICAgICAgICAgICAgICAgY2FzZSBTbGVlcDoKICAgICAgICAgICAg\nICAgICAgICBUaHJlYWQuc2xlZXAoKEludGVnZXIpIGFyZ3NbMV0pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBE\nZXRhY2hTZXJpYWxpemU6CiAgICAgICAgICAgICAgICAgICAgaWQgPSAxOwog\nICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzFdICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWQgPSAoSW50ZWdlcikgYXJnc1sxXTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZW1w\nbG95ZWUgPSBlbXBsb3llZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAg\nICBsb2cudHJhY2UoIkVtcGxveWVlIChiZWZvcmUpPSIgKyBlbXBsb3llZSk7\nCiAgICAgICAgICAgICAgICAgICAgQnl0ZUFycmF5T3V0cHV0U3RyZWFtIGJh\nb3MgPQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQnl0ZUFycmF5T3V0\ncHV0U3RyZWFtKCk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0T3V0cHV0\nU3RyZWFtIG9vcyA9IG5ldyBPYmplY3RPdXRwdXRTdHJlYW0oYmFvcyk7CiAg\nICAgICAgICAgICAgICAgICAgZW1wbG95ZWUud3JpdGVFeHRlcm5hbChvb3Mp\nOwogICAgICAgICAgICAgICAgICAgIG9vcy5mbHVzaCgpOyBiYW9zLmZsdXNo\nKCk7CiAgICAgICAgICAgICAgICAgICAgQnl0ZUFycmF5SW5wdXRTdHJlYW0g\nYmFpcyA9IG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbSgKICAgICAgICAgICAg\nICAgICAgICAgICAgYmFvcy50b0J5dGVBcnJheSgpKTsKICAgICAgICAgICAg\nICAgICAgICBPYmplY3RJbnB1dFN0cmVhbSBvaXMgPSBuZXcgT2JqZWN0SW5w\ndXRTdHJlYW0oYmFpcyk7CiAgICAgICAgICAgICAgICAgICAgTG9ja0VtcGxv\neWVlIHRyYW5zZm9ybWVkRW1wbG95ZWUgPSBuZXcgTG9ja0VtcGxveWVlKCk7\nCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtZWRFbXBsb3llZS5yZWFk\nRXh0ZXJuYWwob2lzKTsKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nIkVtcGxveWVlIChhZnRlcikgPSIgKyB0cmFuc2Zvcm1lZEVtcGxveWVlKTsK\nCiAgICAgICAgICAgICAgICAgICAgZW1wbG95ZWVzLnB1dCgoSW50ZWdlcilh\ncmdzWzJdLHRyYW5zZm9ybWVkRW1wbG95ZWUpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJbmZvOgogICAgICAg\nICAgICAgICAgICAgIGxvZy5pbmZvKGFyZ3NbMV0pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBXYXJuOgogICAg\nICAgICAgICAgICAgICAgIGxvZy53YXJuKGFyZ3NbMV0pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFcnJvcjoK\nICAgICAgICAgICAgICAgICAgICBsb2cuZXJyb3IoYXJnc1sxXSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRy\nYWNlOgogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShhcmdzWzFdKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBj\nYXNlIFRlc3Q6CiAgICAgICAgICAgICAgICAgICAgZW0ubG9jaygieHh4Iiwg\nTG9ja01vZGVUeXBlLldSSVRFKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewogICAgICAg\nICAgICAgICAgLy8gb25seSByZW1lbWJlciB0aGUgZmlyc3QgZXhjZXB0aW9u\nIGNhdWdodAogICAgICAgICAgICAgICAgaWYgKHRoaXNUaHJlYWQudGhyb3dh\nYmxlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzVGhyZWFk\nLnRocm93YWJsZSA9IGV4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKCJDYXVnaHQgZXhjZXB0aW9uIGFuZCBjb250aW51\nZTogIiArIGV4KTsKICAgICAgICAgICAgICAgIGxvZ1N0YWNrKGV4KTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXJyb3IgZXJyKSB7CiAgICAgICAgICAgICAg\nICAvLyBvbmx5IHJlbWVtYmVyIHRoZSBmaXJzdCBleGNlcHRpb24gY2F1Z2h0\nCiAgICAgICAgICAgICAgICBpZiAodGhpc1RocmVhZC5hc3NlcnRFcnJvciA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc1RocmVhZC5hc3Nl\ncnRFcnJvciA9IGVycjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGxvZy50cmFjZSgiQ2F1Z2h0IGV4Y2VwdGlvbiBhbmQgY29udGludWU6\nICIgKyBlcnIpOwogICAgICAgICAgICAgICAgbG9nU3RhY2soZXJyKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZW0gIT0gbnVsbCAm\nJiBlbS5pc09wZW4oKSkgewogICAgICAgICAgICBpZiAoZW0uZ2V0VHJhbnNh\nY3Rpb24oKS5pc0FjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhp\nc1RocmVhZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc1Ro\ncmVhZC5zeXN0ZW1Sb2xsZWRiYWNrID0gZW0uZ2V0VHJhbnNhY3Rpb24oKQog\nICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Um9sbGJhY2tPbmx5KCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgaWYgKGVtLmdldFRyYW5zYWN0aW9uKCkuZ2V0Um9sbGJhY2tP\nbmx5KCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoImZpbmFs\nbHk6IHJvbGxlZGJhY2siKTsKICAgICAgICAgICAgICAgICAgICBlbS5nZXRU\ncmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKCJmaW5hbGx5OiByb2xsZWRiYWNrIGNvbXBsZXRlZCIpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoImZpbmFsbHk6IGNvbW1pdCIpOwogICAgICAgICAgICAgICAg\nICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKCJmaW5hbGx5OiBjb21taXQgY29tcGxldGVk\nIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNo\nKEV4Y2VwdGlvbiBmaW5hbEV4KSB7CiAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nIGZhaWxTdHIgPSBwcm9jZXNzRXhjZXB0aW9uKGN1ckFjdGlvbiwgZmlu\nYWxFeCk7CiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKCJGaW5jYWxs\neToiICsgZmFpbFN0cik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgaWYgKHRo\naXNUaHJlYWQuYXNzZXJ0RXJyb3IgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgdGhyb3cgdGhpc1RocmVhZC5hc3NlcnRFcnJvcjsKICAgICAgICAgICAg\nfQovLyAgICAgICAgICAgIFRocm93YWJsZSBmaXJzdFRocm93YWJsZSA9IHRo\naXNUaHJlYWQudGhyb3dhYmxlOyAgICAgICAgICAgIAovLyAgICAgICAgICAg\nIGlmIChmaXJzdFRocm93YWJsZSAhPSBudWxsKSB7Ci8vICAgICAgICAgICAg\nICAgIGlmKCBmaXJzdFRocm93YWJsZSBpbnN0YW5jZW9mIEVycm9yICkKLy8g\nICAgICAgICAgICAgICAgICAgIHRocm93IChFcnJvcilmaXJzdFRocm93YWJs\nZTsKLy8gICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZy50cmFjZSgiPDw8\nPCBTZXF1ZW5jZWQgVGVzdDogVGhyZWFkcz0iICsgdGhyZWFkVG9SdW4gKyAn\nLycKICAgICAgICAgICAgICAgICsgbnVtVGhyZWFkcyk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgTG9ja01vZGVUeXBlIGdldENhbm9uaWNhbChM\nb2NrTW9kZVR5cGUgbG9ja01vZGUpIHsKICAgICAgICBpZiggbG9ja01vZGUg\nPT0gTG9ja01vZGVUeXBlLlJFQUQgKQogICAgICAgICAgICByZXR1cm4gTG9j\na01vZGVUeXBlLk9QVElNSVNUSUM7CiAgICAgICAgaWYoIGxvY2tNb2RlID09\nIExvY2tNb2RlVHlwZS5XUklURSApCiAgICAgICAgICAgIHJldHVybiBMb2Nr\nTW9kZVR5cGUuT1BUSU1JU1RJQ19GT1JDRV9JTkNSRU1FTlQ7CiAgICAgICAg\ncmV0dXJuIGxvY2tNb2RlOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIHBy\nb2Nlc3NFeGNlcHRpb24oQWN0IGN1ckFjdGlvbiwgVGhyb3dhYmxlIHQpIHsK\nICAgICAgICBTdHJpbmcgZmFpbFN0ciA9ICJDYXVnaHQgZXhjZXB0aW9uOiBu\nb25lIjsKICAgICAgICBpZiAodCAhPSBudWxsKSB7CiAgICAgICAgICAgIGdl\ndExvZygpLnRyYWNlKAogICAgICAgICAgICAgICAgIkNhdWdodCBleGNlcHRp\nb246ICIgKyB0LmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgdCk7CiAg\nICAgICAgICAgIGxvZ1N0YWNrKHQpOwogICAgICAgICAgICBUaHJvd2FibGUg\ncm9vdENhdXNlID0gdC5nZXRDYXVzZSgpOwogICAgICAgICAgICBmYWlsU3Ry\nID0gIkZhaWxlZCBvbiBhY3Rpb24gJyIgKyBjdXJBY3Rpb24gKyAiJyB3aXRo\nIGV4Y2VwdGlvbiAiCiAgICAgICAgICAgICAgICArIHQ7CiAgICAgICAgICAg\nIGlmIChyb290Q2F1c2UgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmFp\nbFN0ciArPSAiXG4gICAgICAgIC0tIENhdXNlIC0tPiAiCiAgICAgICAgICAg\nICAgICAgICAgKyByb290Q2F1c2UuZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAi\nOiIgKyByb290Q2F1c2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhaWxTdHI7CiAgICB9CgogICAgcHJpdmF0ZSBNYXA8U3Ry\naW5nLCBPYmplY3Q+IGJ1aWxkUHJvcHNNYXAoT2JqZWN0W10gYXJncywgaW50\nIHN0YXJ0SWR4KSB7CiAgICAgICAgTWFwPFN0cmluZywgT2JqZWN0PiBwcm9w\ncyA9IG51bGw7CiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gc3RhcnRJZHgp\nIHsKICAgICAgICAgICAgcHJvcHMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIE9i\namVjdD4oKTsKICAgICAgICAgICAgd2hpbGUgKHN0YXJ0SWR4IDwgKGFyZ3Mu\nbGVuZ3RoIC0gMSkpIHsKICAgICAgICAgICAgICAgIHByb3BzLnB1dCgoU3Ry\naW5nKSBhcmdzW3N0YXJ0SWR4XSwgYXJnc1tzdGFydElkeCArIDFdKTsKICAg\nICAgICAgICAgICAgIHN0YXJ0SWR4ICs9IDI7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgZ2V0TG9nKCkudHJhY2UoIlByb3BlcnRpZXMgTWFw\nPSAiICsgcHJvcHMpOwogICAgICAgIHJldHVybiBwcm9wczsKICAgIH0KCiAg\nICBwcml2YXRlIGJvb2xlYW4gbWF0Y2hFeHBlY3RlZEV4Y2VwdGlvbihTdHJp\nbmcgY3VyQWN0LCBDbGFzczw/PiBleHBlY3RlZCwKICAgICAgICBUaHJvd2Fi\nbGUgdGVzdGVkKSB7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChjdXJBY3QsIGV4\ncGVjdGVkKTsKICAgICAgICBDbGFzczw/PiB0ZXN0RXhDbGFzcyA9IG51bGw7\nCiAgICAgICAgYm9vbGVhbiBleE1hdGNoZWQgPSB0cnVlOwogICAgICAgIGlm\nICh0ZXN0ZWQgIT0gbnVsbCkgewogICAgICAgICAgICB0ZXN0RXhDbGFzcyA9\nIHRlc3RlZC5nZXRDbGFzcygpOwogICAgICAgICAgICBleE1hdGNoZWQgPSBl\neHBlY3RlZC5pc0Fzc2lnbmFibGVGcm9tKHRlc3RFeENsYXNzKTsKICAgICAg\nICAgICAgaWYgKCFleE1hdGNoZWQpIHsKICAgICAgICAgICAgICAgIFRocm93\nYWJsZSB0ZXN0RXggPSB0ZXN0ZWQuZ2V0Q2F1c2UoKTsKICAgICAgICAgICAg\nICAgIGlmICh0ZXN0RXggIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIHRlc3RFeENsYXNzID0gdGVzdEV4LmdldENsYXNzKCk7CiAgICAgICAgICAg\nICAgICAgICAgZXhNYXRjaGVkID0gZXhwZWN0ZWQuaXNBc3NpZ25hYmxlRnJv\nbSh0ZXN0RXhDbGFzcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleE1hdGNoZWQgPSBm\nYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4TWF0Y2hlZDsKICAg\nIH0KCiAgICBwcml2YXRlIGNsYXNzIFRlc3RUaHJlYWQgZXh0ZW5kcyBUaHJl\nYWQgewogICAgICAgIHByaXZhdGUgaW50IHRocmVhZFRvUnVuOwogICAgICAg\nIHByaXZhdGUgT2JqZWN0W11bXVtdIGFjdGlvbnM7CiAgICAgICAgcHJpdmF0\nZSBNYXA8SW50ZWdlciwgTG9ja0VtcGxveWVlPiBlbXBsb3llZXMgPSBudWxs\nOwoKICAgICAgICBwdWJsaWMgVGhyb3dhYmxlIHRocm93YWJsZSA9IG51bGw7\nCiAgICAgICAgcHVibGljIEVycm9yIGFzc2VydEVycm9yID0gbnVsbDsKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBzeXN0ZW1Sb2xsZWRiYWNrID0gZmFsc2U7\nCgogICAgICAgIHB1YmxpYyBUZXN0VGhyZWFkKGludCB0aHJlYWRUb1J1biwg\nT2JqZWN0W11bXS4uLiBhY3Rpb25zKSB7CiAgICAgICAgICAgIGdldExvZygp\nLnRyYWNlKCJjcmVhdGUgdGhyZWFkICIgKyB0aHJlYWRUb1J1bik7CiAgICAg\nICAgICAgIHRoaXMudGhyZWFkVG9SdW4gPSB0aHJlYWRUb1J1bjsKICAgICAg\nICAgICAgdGhpcy5hY3Rpb25zID0gYWN0aW9uczsKCiAgICAgICAgICAgIHRo\naXMuZW1wbG95ZWVzID0gbmV3IEhhc2hNYXA8SW50ZWdlciwgTG9ja0VtcGxv\neWVlPigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN5bmNocm9uaXpl\nZCB2b2lkIG5vdGlmeVRocmVhZCgpIHsKICAgICAgICAgICAgbm90aWZ5KCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQg\ncnVuKCkgewogICAgICAgIAkvLyBzbGVlcCBhbmQgbGV0IG90aGVyIHRocmVh\nZHMgaGFzIGEgY2hhbmNlIHRvIGRvIHN0dWZmcywKICAgICAgICAJLy8gb3Ro\nZXJ3aXNlIHRoaXMgbmV3IHRocmVhZCBtYXkgcGVyZm9ybSBhIG5vdGlmeSBi\nZWZvcmUKICAgICAgICAJLy8gdGhlIG90aGVyIHRocmVhZCBoYXMgYSBjaGFu\nY2UgdG8gd2FpdC4KICAgICAgICAJdHJ5IHsKCQkJCVRocmVhZC5zbGVlcCg1\nMDApOwoJCQl9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CgkJ\nCX0KICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoIlRocmVhZCAiICsgdGhy\nZWFkVG9SdW4gKyAiOiBydW4oKSIpOwogICAgICAgICAgICBsYXVuY2hDb21t\nb25TZXF1ZW5jZSh0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgY2xhc3Mg\nUGxhdGZvcm1TcGVlZFRlc3RUaHJlYWQgZXh0ZW5kcyBUaHJlYWQgewogICAg\nICAgIGxvbmcgbG9vcENudCA9IDA7CgogICAgICAgIHB1YmxpYyBsb25nIGdl\ndExvb3BDbnQoKSB7CiAgICAgICAgICAgIHJldHVybiBsb29wQ250OwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIHJ1bigp\nIHsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAg\nICsrbG9vcENudDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzSW50ZXJy\ndXB0ZWQoKSkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgZW51bSBEQlR5\ncGUgewogICAgICAgIGFjY2VzcywgZGIyLCBkZXJieSwgZW1wcmVzcywgZm94\ncHJvLCBoMiwgaHNxbCwgaW5mb3JtaXgsIGluZ3JlcywgamRhdGFzdG9yZSwg\nbXlzcWwsIG9yYWNsZSwgcG9pbnRiYXNlLCBwb3N0Z3JlcywKICAgICAgICBz\ncWxzZXJ2ZXIsIHN5YmFzZQogICAgfTsKCiAgICBwcm90ZWN0ZWQgREJUeXBl\nIGdldERCVHlwZShFbnRpdHlNYW5hZ2VyIGVtKSB7CiAgICAgICAgSkRCQ0Nv\nbmZpZ3VyYXRpb25JbXBsIGNvbmYgPSAoSkRCQ0NvbmZpZ3VyYXRpb25JbXBs\nKSBnZXRDb25maWd1cmF0aW9uKGVtKTsKICAgICAgICBTdHJpbmcgZGljdENs\nYXNzTmFtZSA9IGdldENvbmZpZ3VyYXRpb24oZW0pLmdldERCRGljdGlvbmFy\neUluc3RhbmNlKCkuZ2V0Q2xhc3MoKS5nZXROYW1lKCk7CiAgICAgICAgU3Ry\naW5nIGRiID0gY29uZi5kYmRpY3Rpb25hcnlQbHVnaW4uYWxpYXMoZGljdENs\nYXNzTmFtZSk7CiAgICAgICAgcmV0dXJuIERCVHlwZS52YWx1ZU9mKGRiKTsK\nICAgIH0KCiAgICBAU3VwcHJlc3NXYXJuaW5ncyggeyAidW51c2VkIiwgImRl\ncHJlY2F0aW9uIiB9KQogICAgcHJvdGVjdGVkIEpEQkNDb25maWd1cmF0aW9u\nIGdldENvbmZpZ3VyYXRpb24oRW50aXR5TWFuYWdlciBlbSkgewogICAgICAg\nIHJldHVybiAoKEpEQkNDb25maWd1cmF0aW9uKSAoKE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyKSBlbSkuZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KfQo=\n","encoding":"base64"}

