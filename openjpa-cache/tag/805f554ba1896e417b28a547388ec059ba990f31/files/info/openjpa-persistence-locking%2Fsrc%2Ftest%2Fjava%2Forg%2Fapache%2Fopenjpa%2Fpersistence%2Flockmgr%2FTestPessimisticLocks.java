{"sha":"e154e55c58080ce6d6b1db0aad40959f580710c8","node_id":"MDQ6QmxvYjIwNjM2NDplMTU0ZTU1YzU4MDgwY2U2ZDZiMWRiMGFhZDQwOTU5ZjU4MDcxMGM4","size":18869,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e154e55c58080ce6d6b1db0aad40959f580710c8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5sb2NrbWdyOwoK\naW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkVudGl0eU1hbmFnZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5Mb2NrTW9kZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QZXNz\naW1pc3RpY0xvY2tFeGNlcHRpb247CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5RdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5VGltZW91\ndEV4Y2VwdGlvbjsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlR5cGVkUXVl\ncnk7CgppbXBvcnQganVuaXQuZnJhbWV3b3JrLkFzc2VydGlvbkZhaWxlZEVy\ncm9yOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRC\nQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnBlcnNpc3RlbmNlLkxvY2tUaW1lb3V0RXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlNYW5h\nZ2VyRmFjdG9yeVNQSTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJz\naXN0ZW5jZS50ZXN0LlNRTExpc3RlbmVyVGVzdENhc2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwoKLyoqCiAq\nIFRlc3QgUGVzc2ltaXN0aWMgTG9jayBhbmQgZXhjZXB0aW9uIGJlaGF2aW9y\nIGFnYWluc3QgRW50aXR5TWFuYWdlciBhbmQgUXVlcnkKICogaW50ZXJmYWNl\nIG1ldGhvZHMuCiAqLwpwdWJsaWMgY2xhc3MgVGVzdFBlc3NpbWlzdGljTG9j\na3MgZXh0ZW5kcyBTUUxMaXN0ZW5lclRlc3RDYXNlIHsKCiAgICBwcml2YXRl\nIERCRGljdGlvbmFyeSBkaWN0ID0gbnVsbDsKICAgIHByaXZhdGUgaW50IGxv\nY2tXYWl0VGltZSA9IDIwMDA7CgogICAgcHVibGljIHZvaWQgc2V0VXAoKSB7\nCiAgICAgICAgLy8gRGlzYWJsZSB0ZXN0cyBmb3IgYW55IERCIHRoYXQgaGFz\nIHN1cHBvcnRzUXVlcnlUaW1lb3V0PT1mYWxzZSwgbGlrZSBQb3N0Z3Jlcwog\nICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeVNQSSB0ZW1wRU1G\nID0gZW1mOwogICAgICAgIGlmICh0ZW1wRU1GID09IG51bGwpIHsKICAgICAg\nICAgICAgdGVtcEVNRiA9IGNyZWF0ZUVNRigpOwogICAgICAgIH0KICAgICAg\nICBhc3NlcnROb3ROdWxsKHRlbXBFTUYpOwogICAgICAgIGRpY3QgPSAoKEpE\nQkNDb25maWd1cmF0aW9uKXRlbXBFTUYuZ2V0Q29uZmlndXJhdGlvbigpKS5n\nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIGFzc2VydE5vdE51\nbGwoZGljdCk7CiAgICAgICAgaWYgKCFkaWN0LnN1cHBvcnRzUXVlcnlUaW1l\nb3V0KQogICAgICAgICAgICBzZXRUZXN0c0Rpc2FibGVkKHRydWUpOwogICAg\nICAgIGlmIChlbWYgPT0gbnVsbCkgewogICAgICAgICAgICBjbG9zZUVNRih0\nZW1wRU1GKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc1Rlc3RzRGlzYWJs\nZWQoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIAogICAgICAgIHNl\ndFVwKENMRUFSX1RBQkxFUywgRW1wbG95ZWUuY2xhc3MsIERlcGFydG1lbnQu\nY2xhc3MsICJvcGVuanBhLkxvY2tNYW5hZ2VyIiwgIm1peGVkIik7CgogICAg\nICAgIEVudGl0eU1hbmFnZXIgZW0gPSBudWxsOwogICAgICAgIGVtID0gZW1m\nLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLmJlZ2luKCk7CgogICAgICAgIEVtcGxveWVlIGUxLCBlMjsKICAg\nICAgICBEZXBhcnRtZW50IGQxLCBkMjsKICAgICAgICBkMSA9IG5ldyBEZXBh\ncnRtZW50KCk7CiAgICAgICAgZDEuc2V0SWQoMTApOwogICAgICAgIGQxLnNl\ndE5hbWUoIkQxMCIpOwoKICAgICAgICBlMSA9IG5ldyBFbXBsb3llZSgpOwog\nICAgICAgIGUxLnNldElkKDEpOwogICAgICAgIGUxLnNldERlcGFydG1lbnQo\nZDEpOwogICAgICAgIGUxLnNldEZpcnN0TmFtZSgiZmlyc3QuMSIpOwogICAg\nICAgIGUxLnNldExhc3ROYW1lKCJsYXN0LjEiKTsKCiAgICAgICAgZDIgPSBu\nZXcgRGVwYXJ0bWVudCgpOwogICAgICAgIGQyLnNldElkKDIwKTsKICAgICAg\nICBkMi5zZXROYW1lKCJEMjAiKTsKCiAgICAgICAgZTIgPSBuZXcgRW1wbG95\nZWUoKTsKICAgICAgICBlMi5zZXRJZCgyKTsKICAgICAgICBlMi5zZXREZXBh\ncnRtZW50KGQyKTsKICAgICAgICBlMi5zZXRGaXJzdE5hbWUoImZpcnN0LjIi\nKTsKICAgICAgICBlMi5zZXRMYXN0TmFtZSgibGFzdC4yIik7CgogICAgICAg\nIGVtLnBlcnNpc3QoZDEpOwogICAgICAgIGVtLnBlcnNpc3QoZDIpOwogICAg\nICAgIGVtLnBlcnNpc3QoZTEpOwogICAgICAgIGVtLnBlcnNpc3QoZTIpOwog\nICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICB9Cgog\nICAgLyoKICAgICAqIFRlc3QgZmluZCB3aXRoIHBlc3NpbWlzdGljIGxvY2sg\nYWZ0ZXIgYSBxdWVyeSB3aXRoIHBlc3NpbWlzdGljIGxvY2suCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHRlc3RGaW5kQWZ0ZXJRdWVyeVdpdGhQZXNzaW1p\nc3RpY0xvY2tzKCkgewogICAgICAgIEVudGl0eU1hbmFnZXIgZW0xID0gZW1m\nLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBFbnRpdHlNYW5hZ2Vy\nIGVtMiA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgZW0x\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBUeXBlZFF1ZXJ5\nPEVtcGxveWVlPiBxdWVyeSA9IGVtMS5jcmVhdGVRdWVyeSgic2VsZWN0IGUg\nZnJvbSBFbXBsb3llZSBlIHdoZXJlIGUuaWQgPCAxMCIsIEVtcGxveWVlLmNs\nYXNzKQogICAgICAgICAgICAgICAgLnNldEZpcnN0UmVzdWx0KDEpOwogICAg\nICAgIC8vIExvY2sgYWxsIHNlbGVjdGVkIEVtcGxveWVlcywgc2tpcCB0aGUg\nZmlyc3Qgb25lLCBpLmUgc2hvdWxkIGxvY2sKICAgICAgICAvLyBFbXBsb3ll\nZSgyKQogICAgICAgIHF1ZXJ5LnNldExvY2tNb2RlKExvY2tNb2RlVHlwZS5Q\nRVNTSU1JU1RJQ19SRUFEKTsKICAgICAgICBxdWVyeS5zZXRIaW50KCJqYXZh\neC5wZXJzaXN0ZW5jZS5xdWVyeS50aW1lb3V0IiwgbG9ja1dhaXRUaW1lKTsK\nICAgICAgICBMaXN0PEVtcGxveWVlPiBlbXBsb3llZXMgPSBxdWVyeS5nZXRS\nZXN1bHRMaXN0KCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJFeHBlY3RlZCAx\nIGVsZW1lbnQgd2l0aCBlbXBseWVlIGlkPTIiLCBlbXBsb3llZXMuc2l6ZSgp\nLCAxKTsKICAgICAgICBhc3NlcnRUcnVlKCJUZXN0IEVtcGxveWVlIGZpcnN0\nIG5hbWUgPSAnZmlyc3QuMiciLCBlbXBsb3llZXMuZ2V0KDApLmdldEZpcnN0\nTmFtZSgpLmVxdWFscygiZmlyc3QuMSIpCiAgICAgICAgICAgICAgICB8fCBl\nbXBsb3llZXMuZ2V0KDApLmdldEZpcnN0TmFtZSgpLmVxdWFscygiZmlyc3Qu\nMiIpKTsKCiAgICAgICAgZW0yLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsK\nICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IGhpbnRzID0gbmV3IEhhc2hN\nYXA8U3RyaW5nLCBPYmplY3Q+KCk7CiAgICAgICAgaGludHMucHV0KCJqYXZh\neC5wZXJzaXN0ZW5jZS5sb2NrLnRpbWVvdXQiLCBsb2NrV2FpdFRpbWUpOwog\nICAgICAgIC8vIGZpbmQgRW1wbG95ZWUoMikgd2l0aCBhIGxvY2ssIHNob3Vs\nZCBibG9jayBhbmQgZXhwZWN0ZWQgYQogICAgICAgIC8vIFBlc3NpbWlzdGlj\nTG9ja0V4Y2VwdGlvbgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVtMi5m\naW5kKEVtcGxveWVlLmNsYXNzLCAyLCBMb2NrTW9kZVR5cGUuUEVTU0lNSVNU\nSUNfUkVBRCwgaGludHMpOwogICAgICAgICAgICBmYWlsKCJVbmV4Y3BlY3Rl\nZCBmaW5kIHN1Y2NlZWRlZC4gU2hvdWxkIHRocm93IGEgUGVzc2ltaXN0aWNM\nb2NrRXhjZXB0aW9uLiIpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSBl\nKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghZGljdC5zdXBwb3J0\nc0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMpCiAgICAgICAgICAgICAgICBh\nc3NlcnRFcnJvcihlLCBQZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24uY2xhc3Mp\nOwogICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAgICAgYXNzZXJ0RXJy\nb3IoZSwgTG9ja1RpbWVvdXRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChlbTEuZ2V0VHJhbnNhY3Rpb24o\nKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgZW0xLmdldFRyYW5zYWN0\naW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgaWYgKGVtMi5nZXRUcmFu\nc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBlbTIuZ2V0\nVHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgIH0KCiAgICAgICAg\nZW0xLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBUeXBlZFF1\nZXJ5PERlcGFydG1lbnQ+IHF1ZXJ5MiA9IGVtMS5jcmVhdGVRdWVyeSgic2Vs\nZWN0IGUuZGVwYXJ0bWVudCBmcm9tIEVtcGxveWVlIGUgd2hlcmUgZS5pZCA8\nIDEwIiwKICAgICAgICAgICAgICAgIERlcGFydG1lbnQuY2xhc3MpLnNldEZp\ncnN0UmVzdWx0KDEpOwogICAgICAgIC8vIExvY2sgYWxsIHNlbGVjdGVkIERl\ncGFydG1lbnRzLCBza2lwIHRoZSBmaXJzdCBvbmUsIGkuZSBzaG91bGQKICAg\nICAgICAvLyBsb2NrIERlcGFydG1lbnQoMjApCiAgICAgICAgcXVlcnkuc2V0\nTG9ja01vZGUoTG9ja01vZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQpOwogICAg\nICAgIHF1ZXJ5LnNldEhpbnQoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRp\nbWVvdXQiLCBsb2NrV2FpdFRpbWUpOwogICAgICAgIExpc3Q8RGVwYXJ0bWVu\ndD4gZGVwdHMgPSBxdWVyeTIuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgIGFz\nc2VydEVxdWFscygiRXhwZWN0ZWQgMSBlbGVtZW50IHdpdGggZGVwYXJ0bWVu\ndCBpZD0yMCIsIGRlcHRzLnNpemUoKSwgMSk7CiAgICAgICAgYXNzZXJ0VHJ1\nZSgiVGVzdCBkZXBhcnRtZW50IG5hbWUgPSAnRDIwJyIsIGRlcHRzLmdldCgw\nKS5nZXROYW1lKCkuZXF1YWxzKCJEMTAiKQogICAgICAgICAgICAgICAgfHwg\nZGVwdHMuZ2V0KDApLmdldE5hbWUoKS5lcXVhbHMoIkQyMCIpKTsKCiAgICAg\nICAgZW0yLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBNYXA8\nU3RyaW5nLCBPYmplY3Q+IG1hcCA9IG5ldyBIYXNoTWFwPFN0cmluZywgT2Jq\nZWN0PigpOwogICAgICAgIG1hcC5wdXQoImphdmF4LnBlcnNpc3RlbmNlLmxv\nY2sudGltZW91dCIsIGxvY2tXYWl0VGltZSk7CiAgICAgICAgLy8gZmluZCBF\nbXBsb3llZSgyKSB3aXRoIGEgbG9jaywgbm8gYmxvY2sgc2luY2Ugb25seSBk\nZXBhcnRtZW50IHdhcwogICAgICAgIC8vIGxvY2tlZAogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIEVtcGxveWVlIGVtcCA9IGVtMi5maW5kKEVtcGxveWVl\nLmNsYXNzLCAxLCBMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNfUkVBRCwgbWFw\nKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbCgiUXVlcnkgbG9ja3MgZGVw\nYXJ0bWVudCBvbmx5LCB0aGVyZWZvcmUgc2hvdWxkIGZpbmQgRW1wbG95ZWUu\nIiwgZW1wKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJUZXN0IEVtcGxv\neWVlIGZpcnN0IG5hbWUgPSAnZmlyc3QuMSciLCBlbXAuZ2V0Rmlyc3ROYW1l\nKCksICJmaXJzdC4xIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4\nKSB7CiAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkICIgKyBl\neC5nZXRDbGFzcygpLmdldE5hbWUoKSArICI6IiArIGV4LmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGVtMS5n\nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBl\nbTEuZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgICAgICBp\nZiAoZW0yLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAg\nICAgICAgIGVtMi5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAg\nICAgfQogICAgICAgIGVtMS5jbG9zZSgpOwogICAgICAgIGVtMi5jbG9zZSgp\nOwogICAgfQoKICAgIC8qCiAgICAgKiBUZXN0IGZpbmQgd2l0aCBwZXNzaW1p\nc3RpYyBsb2NrIGFmdGVyIGEgcXVlcnkgd2l0aCBwZXNzaW1pc3RpYyBsb2Nr\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0ZXN0RmluZEFmdGVyUXVlcnlP\ncmRlckJ5V2l0aFBlc3NpbWlzdGljTG9ja3MoKSB7CiAgICAgICAgRW50aXR5\nTWFuYWdlciBlbTEgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAg\nICAgIEVudGl0eU1hbmFnZXIgZW0yID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFn\nZXIoKTsKICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwog\nICAgICAgIFF1ZXJ5IHF1ZXJ5ID0gZW0xLmNyZWF0ZVF1ZXJ5KCJzZWxlY3Qg\nZSBmcm9tIEVtcGxveWVlIGUgd2hlcmUgZS5pZCA8IDEwIG9yZGVyIGJ5IGUu\naWQiKS5zZXRGaXJzdFJlc3VsdCgxKTsKICAgICAgICAvLyBMb2NrIGFsbCBz\nZWxlY3RlZCBFbXBsb3llZXMsIHNraXAgdGhlIGZpcnN0IG9uZSwgaS5lIHNo\nb3VsZCBsb2NrCiAgICAgICAgLy8gRW1wbG95ZWUoMikKICAgICAgICBxdWVy\neS5zZXRMb2NrTW9kZShMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNfUkVBRCk7\nCiAgICAgICAgcXVlcnkuc2V0SGludCgiamF2YXgucGVyc2lzdGVuY2UucXVl\ncnkudGltZW91dCIsIGxvY2tXYWl0VGltZSk7CiAgICAgICAgTGlzdDxFbXBs\nb3llZT4gcSA9IHF1ZXJ5LmdldFJlc3VsdExpc3QoKTsKICAgICAgICBhc3Nl\ncnRFcXVhbHMoIkV4cGVjdGVkIDEgZWxlbWVudCB3aXRoIGVtcGx5ZWUgaWQ9\nMiIsIHEuc2l6ZSgpLCAxKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlRlc3Qg\nRW1wbG95ZWUgZmlyc3QgbmFtZSA9ICdmaXJzdC4yJyIsIHEuZ2V0KDApLmdl\ndEZpcnN0TmFtZSgpLCAiZmlyc3QuMiIpOwoKICAgICAgICBlbTIuZ2V0VHJh\nbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgIE1hcDxTdHJpbmcsIE9iamVj\ndD4gbWFwID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBPYmplY3Q+KCk7CiAgICAg\nICAgbWFwLnB1dCgiamF2YXgucGVyc2lzdGVuY2UubG9jay50aW1lb3V0Iiwg\nbG9ja1dhaXRUaW1lKTsKICAgICAgICAvLyBmaW5kIEVtcGxveWVlKDIpIHdp\ndGggYSBsb2NrLCBzaG91bGQgYmxvY2sgYW5kIGV4cGVjdGVkIGEKICAgICAg\nICAvLyBQZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24KICAgICAgICB0cnkgewog\nICAgICAgICAgICBlbTIuZmluZChFbXBsb3llZS5jbGFzcywgMiwgTG9ja01v\nZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQsIG1hcCk7CiAgICAgICAgICAgIGZh\naWwoIlVuZXhjcGVjdGVkIGZpbmQgc3VjY2VlZGVkLiBTaG91bGQgdGhyb3cg\nYSBQZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24uIik7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKCFkaWN0LnN1cHBv\ncnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcykKICAgICAgICAgICAgICAg\nIGFzc2VydEVycm9yKGUsIFBlc3NpbWlzdGljTG9ja0V4Y2VwdGlvbi5jbGFz\ncyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFzc2VydEVy\ncm9yKGUsIExvY2tUaW1lb3V0RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZW0xLmdldFRyYW5zYWN0aW9u\nKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMS5nZXRUcmFuc2Fj\ndGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIGlmIChlbTIuZ2V0VHJh\nbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgZW0yLmdl\ndFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9CgogICAgICAg\nIGVtMS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgcXVlcnkg\nPSBlbTEuY3JlYXRlUXVlcnkoInNlbGVjdCBlLmRlcGFydG1lbnQgZnJvbSBF\nbXBsb3llZSBlIHdoZXJlIGUuaWQgPCAxMCBvcmRlciBieSBlLmRlcGFydG1l\nbnQuaWQiKQogICAgICAgICAgICAgICAgLnNldEZpcnN0UmVzdWx0KDEpOwog\nICAgICAgIC8vIExvY2sgYWxsIHNlbGVjdGVkIERlcGFydG1lbnRzLCBza2lw\nIHRoZSBmaXJzdCBvbmUsIGkuZSBzaG91bGQKICAgICAgICAvLyBsb2NrIERl\ncGFydG1lbnQoMjApCiAgICAgICAgcXVlcnkuc2V0TG9ja01vZGUoTG9ja01v\nZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQpOwogICAgICAgIHF1ZXJ5LnNldEhp\nbnQoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCBsb2NrV2Fp\ndFRpbWUpOwogICAgICAgIExpc3Q8RGVwYXJ0bWVudD4gcmVzdWx0ID0gcXVl\ncnkuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAgIGFzc2VydEVxdWFscygiRXhw\nZWN0ZWQgMSBlbGVtZW50IHdpdGggZGVwYXJ0bWVudCBpZD0yMCIsIHEuc2l6\nZSgpLCAxKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlRlc3QgZGVwYXJ0bWVu\ndCBuYW1lID0gJ0QyMCciLCByZXN1bHQuZ2V0KDApLmdldE5hbWUoKSwgIkQy\nMCIpOwoKICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwog\nICAgICAgIG1hcC5jbGVhcigpOwogICAgICAgIG1hcC5wdXQoImphdmF4LnBl\ncnNpc3RlbmNlLmxvY2sudGltZW91dCIsIGxvY2tXYWl0VGltZSk7CiAgICAg\nICAgLy8gZmluZCBFbXBsb3llZSgyKSB3aXRoIGEgbG9jaywgbm8gYmxvY2sg\nc2luY2Ugb25seSBkZXBhcnRtZW50IHdhcwogICAgICAgIC8vIGxvY2tlZAog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEVtcGxveWVlIGVtcCA9IGVtMi5m\naW5kKEVtcGxveWVlLmNsYXNzLCAxLCBMb2NrTW9kZVR5cGUuUEVTU0lNSVNU\nSUNfUkVBRCwgbWFwKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbCgiUXVl\ncnkgbG9ja3MgZGVwYXJ0bWVudCBvbmx5LCB0aGVyZWZvcmUgc2hvdWxkIGZp\nbmQgRW1wbG95ZWUuIiwgZW1wKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKCJUZXN0IEVtcGxveWVlIGZpcnN0IG5hbWUgPSAnZmlyc3QuMSciLCBlbXAu\nZ2V0Rmlyc3ROYW1lKCksICJmaXJzdC4xIik7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgIGlmICghZGljdC5zdXBwb3J0\nc0xvY2tpbmdXaXRoT3JkZXJDbGF1c2UpCiAgICAgICAgICAgICAgICBmYWls\nKCJDYXVnaHQgdW5leHBlY3RlZCAiICsgZXguZ2V0Q2xhc3MoKS5nZXROYW1l\nKCkgKyAiOiIgKyBleC5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBlbHNl\nIAogICAgICAgICAgICAgICAgYXNzZXJ0RXJyb3IoZXgsIExvY2tUaW1lb3V0\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBpZiAoZW0xLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAg\nICAgICAgICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7\nCiAgICAgICAgICAgIGlmIChlbTIuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2\nZSgpKQogICAgICAgICAgICAgICAgZW0yLmdldFRyYW5zYWN0aW9uKCkucm9s\nbGJhY2soKTsKICAgICAgICB9CiAgICAgICAgZW0xLmNsb3NlKCk7CiAgICAg\nICAgZW0yLmNsb3NlKCk7CiAgICB9CgogICAgLyoKICAgICAqIFRlc3QgcXVl\ncnkgd2l0aCBwZXNzaW1pc3RpYyBsb2NrIGFmdGVyIGEgZmluZCB3aXRoIHBl\nc3NpbWlzdGljIGxvY2suCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RR\ndWVyeUFmdGVyRmluZFdpdGhQZXNzaW1pc3RpY0xvY2tzKCkgewogICAgICAg\nIEVudGl0eU1hbmFnZXIgZW0xID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIo\nKTsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVtMiA9IGVtZi5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZW0yLmdl\ndFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgTWFwPFN0cmlu\nZywgT2JqZWN0PiBtYXAgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIE9iamVjdD4o\nKTsKICAgICAgICAgICAgbWFwLnB1dCgiamF2YXgucGVyc2lzdGVuY2UubG9j\nay50aW1lb3V0IiwgbG9ja1dhaXRUaW1lKTsKICAgICAgICAgICAgLy8gTG9j\nayBFbXBseWVlKDEpLCBubyBkZXBhcnRtZW50IHNob3VsZCBiZSBsb2NrZWQK\nICAgICAgICAgICAgZW0yLmZpbmQoRW1wbG95ZWUuY2xhc3MsIDEsIExvY2tN\nb2RlVHlwZS5QRVNTSU1JU1RJQ19SRUFELCBtYXApOwoKICAgICAgICAgICAg\nZW0xLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgUXVl\ncnkgcXVlcnkgPSBlbTEuY3JlYXRlUXVlcnkoInNlbGVjdCBlLmRlcGFydG1l\nbnQgZnJvbSBFbXBsb3llZSBlIHdoZXJlIGUuaWQgPCAxMCIpLnNldEZpcnN0\nUmVzdWx0KDEpOwogICAgICAgICAgICBxdWVyeS5zZXRMb2NrTW9kZShMb2Nr\nTW9kZVR5cGUuUEVTU0lNSVNUSUNfUkVBRCk7CiAgICAgICAgICAgIHF1ZXJ5\nLnNldEhpbnQoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCBs\nb2NrV2FpdFRpbWUpOwogICAgICAgICAgICAvLyBMb2NrIGFsbCBzZWxlY3Rl\nZCBEZXBhcnRtZW50IGJ1dCBza2lwIHRoZSBmaXJzdCwgaS5lLiBsb2NrCiAg\nICAgICAgICAgIC8vIERlcGFydG1lbnQoMjApLCBzaG91bGQgcXVlcnkgc3Vj\nY2Vzc2Z1bGx5LgogICAgICAgICAgICBMaXN0PERlcGFydG1lbnQ+IHEgPSBx\ndWVyeS5nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFs\ncygiRXhwZWN0ZWQgMSBlbGVtZW50IHdpdGggZGVwYXJ0bWVudCBpZD0yMCIs\nIHEuc2l6ZSgpLCAxKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVGVzdCBk\nZXBhcnRtZW50IG5hbWUgPSAnRDIwJyIsIHEuZ2V0KDApLmdldE5hbWUoKS5l\ncXVhbHMoIkQxMCIpCiAgICAgICAgICAgICAgICAgICAgfHwgcS5nZXQoMCku\nZ2V0TmFtZSgpLmVxdWFscygiRDIwIikpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBleCkgewogICAgICAgICAgICBpZiAoIWRpY3Quc3VwcG9ydHNM\nb2NraW5nV2l0aE11bHRpcGxlVGFibGVzKQogICAgICAgICAgICAgICAgZmFp\nbCgiQ2F1Z2h0IHVuZXhwZWN0ZWQgIiArIGV4LmdldENsYXNzKCkuZ2V0TmFt\nZSgpICsgIjoiICsgZXguZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgYXNzZXJ0RXJyb3IoZXgsIFF1ZXJ5VGltZW91\ndEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgaWYgKGVtMS5nZXRUcmFuc2FjdGlvbigpLmlzQWN0aXZlKCkpCiAg\nICAgICAgICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygp\nOwogICAgICAgICAgICBpZiAoZW0yLmdldFRyYW5zYWN0aW9uKCkuaXNBY3Rp\ndmUoKSkKICAgICAgICAgICAgICAgIGVtMi5nZXRUcmFuc2FjdGlvbigpLnJv\nbGxiYWNrKCk7CiAgICAgICAgfQoKICAgICAgICBlbTIuZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwoKICAgICAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG1h\ncCA9IG5ldyBIYXNoTWFwPFN0cmluZywgT2JqZWN0PigpOwogICAgICAgIG1h\ncC5wdXQoImphdmF4LnBlcnNpc3RlbmNlLmxvY2sudGltZW91dCIsIGxvY2tX\nYWl0VGltZSk7CiAgICAgICAgLy8gTG9jayBFbXBseWVlKDIpLCBubyBkZXBh\ncnRtZW50IHNob3VsZCBiZSBsb2NrZWQKICAgICAgICBlbTIuZmluZChFbXBs\nb3llZS5jbGFzcywgMiwgTG9ja01vZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQs\nIG1hcCk7CgogICAgICAgIGVtMS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7\nCiAgICAgICAgUXVlcnkgcXVlcnkgPSBlbTEuY3JlYXRlUXVlcnkoInNlbGVj\ndCBlIGZyb20gRW1wbG95ZWUgZSB3aGVyZSBlLmlkIDwgMTAiKS5zZXRGaXJz\ndFJlc3VsdCgxKTsKICAgICAgICAvLyBMb2NrIGFsbCBzZWxlY3RlZCBFbXBs\nb3llZXMsIHNraXAgdGhlIGZpcnN0IG9uZSwgaS5lIHNob3VsZCBsb2NrCiAg\nICAgICAgLy8gRW1wbG95ZWUoMikKICAgICAgICBxdWVyeS5zZXRMb2NrTW9k\nZShMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNfUkVBRCk7CiAgICAgICAgcXVl\ncnkuc2V0SGludCgiamF2YXgucGVyc2lzdGVuY2UucXVlcnkudGltZW91dCIs\nIGxvY2tXYWl0VGltZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTGlz\ndDxFbXBsb3llZT4gcSA9IHF1ZXJ5LmdldFJlc3VsdExpc3QoKTsKICAgICAg\nICAgICAgZmFpbCgiVW5leGNwZWN0ZWQgZmluZCBzdWNjZWVkZWQuIFNob3Vs\nZCB0aHJvdyBhIFBlc3NpbWlzdGljTG9ja0V4Y2VwdGlvbi4iKTsKICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoIWRp\nY3Quc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxlVGFibGVzKQogICAgICAg\nICAgICAgICAgYXNzZXJ0RXJyb3IoZSwgUGVzc2ltaXN0aWNMb2NrRXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nYXNzZXJ0RXJyb3IoZSwgUXVlcnlUaW1lb3V0RXhjZXB0aW9uLmNsYXNzKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZW0xLmdldFRy\nYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMS5n\nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIGlmIChl\nbTIuZ2V0VHJhbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAg\nICAgZW0yLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9\nCiAgICAgICAgZW0xLmNsb3NlKCk7CiAgICAgICAgZW0yLmNsb3NlKCk7CiAg\nICB9CgogICAgLyoKICAgICAqIFRlc3QgcXVlcnkgd2l0aCBwZXNzaW1pc3Rp\nYyBsb2NrIGFmdGVyIGEgZmluZCB3aXRoIHBlc3NpbWlzdGljIGxvY2suCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RRdWVyeU9yZGVyQnlBZnRlckZp\nbmRXaXRoUGVzc2ltaXN0aWNMb2NrcygpIHsKICAgICAgICBFbnRpdHlNYW5h\nZ2VyIGVtMSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAg\nRW50aXR5TWFuYWdlciBlbTIgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOwogICAgICAgIGVtMi5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAg\nICAgTWFwPFN0cmluZywgT2JqZWN0PiBtYXAgPSBuZXcgSGFzaE1hcDxTdHJp\nbmcsIE9iamVjdD4oKTsKICAgICAgICBtYXAucHV0KCJqYXZheC5wZXJzaXN0\nZW5jZS5sb2NrLnRpbWVvdXQiLCBsb2NrV2FpdFRpbWUpOwogICAgICAgIC8v\nIExvY2sgRW1wbHllZSgxKSwgbm8gZGVwYXJ0bWVudCBzaG91bGQgYmUgbG9j\na2VkCiAgICAgICAgZW0yLmZpbmQoRW1wbG95ZWUuY2xhc3MsIDEsIExvY2tN\nb2RlVHlwZS5QRVNTSU1JU1RJQ19SRUFELCBtYXApOwoKICAgICAgICBlbTEu\nZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgIFF1ZXJ5IHF1ZXJ5\nID0gZW0xLmNyZWF0ZVF1ZXJ5KCJzZWxlY3QgZS5kZXBhcnRtZW50IGZyb20g\nRW1wbG95ZWUgZSB3aGVyZSBlLmlkIDwgMTAgb3JkZXIgYnkgZS5kZXBhcnRt\nZW50LmlkIikKICAgICAgICAgICAgICAgIC5zZXRGaXJzdFJlc3VsdCgxKTsK\nICAgICAgICBxdWVyeS5zZXRMb2NrTW9kZShMb2NrTW9kZVR5cGUuUEVTU0lN\nSVNUSUNfUkVBRCk7CiAgICAgICAgcXVlcnkuc2V0SGludCgiamF2YXgucGVy\nc2lzdGVuY2UucXVlcnkudGltZW91dCIsIGxvY2tXYWl0VGltZSk7CiAgICAg\nICAgLy8gTG9jayBhbGwgc2VsZWN0ZWQgRGVwYXJ0bWVudCBidXQgc2tpcCB0\naGUgZmlyc3QsIGkuZS4gbG9jawogICAgICAgIC8vIERlcGFydG1lbnQoMjAp\nLCBzaG91bGQgcXVlcnkgc3VjY2Vzc2Z1bGx5LgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIExpc3Q8RGVwYXJ0bWVudD4gcSA9IHF1ZXJ5LmdldFJlc3Vs\ndExpc3QoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJFeHBlY3RlZCAx\nIGVsZW1lbnQgd2l0aCBkZXBhcnRtZW50IGlkPTIwIiwgcS5zaXplKCksIDEp\nOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoIlRlc3QgZGVwYXJ0bWVudCBu\nYW1lID0gJ0QyMCciLCBxLmdldCgwKS5nZXROYW1lKCksICJEMjAiKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgaWYg\nKCFkaWN0LnN1cHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcykKICAg\nICAgICAgICAgICAgIGZhaWwoIkNhdWdodCB1bmV4cGVjdGVkICIgKyBleC5n\nZXRDbGFzcygpLmdldE5hbWUoKSArICI6IiArIGV4LmdldE1lc3NhZ2UoKSk7\nCiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICBhc3NlcnRFcnJv\ncihleCwgUXVlcnlUaW1lb3V0RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZW0xLmdldFRyYW5zYWN0aW9u\nKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMS5nZXRUcmFuc2Fj\ndGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIGlmIChlbTIuZ2V0VHJh\nbnNhY3Rpb24oKS5pc0FjdGl2ZSgpKQogICAgICAgICAgICAgICAgZW0yLmdl\ndFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9CgogICAgICAg\nIGVtMi5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CgogICAgICAgIG1hcC5j\nbGVhcigpOwogICAgICAgIG1hcC5wdXQoImphdmF4LnBlcnNpc3RlbmNlLmxv\nY2sudGltZW91dCIsIGxvY2tXYWl0VGltZSk7CiAgICAgICAgLy8gTG9jayBF\nbXBseWVlKDIpLCBubyBkZXBhcnRtZW50IHNob3VsZCBiZSBsb2NrZWQKICAg\nICAgICBlbTIuZmluZChFbXBsb3llZS5jbGFzcywgMiwgTG9ja01vZGVUeXBl\nLlBFU1NJTUlTVElDX1JFQUQsIG1hcCk7CgogICAgICAgIGVtMS5nZXRUcmFu\nc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgcXVlcnkgPSBlbTEuY3JlYXRl\nUXVlcnkoInNlbGVjdCBlIGZyb20gRW1wbG95ZWUgZSB3aGVyZSBlLmlkIDwg\nMTAgb3JkZXIgYnkgZS5kZXBhcnRtZW50LmlkIikuc2V0Rmlyc3RSZXN1bHQo\nMSk7CiAgICAgICAgLy8gTG9jayBhbGwgc2VsZWN0ZWQgRW1wbG95ZWVzLCBz\na2lwIHRoZSBmaXJzdCBvbmUsIGkuZSBzaG91bGQgbG9jawogICAgICAgIC8v\nIEVtcGxveWVlKDIpCiAgICAgICAgcXVlcnkuc2V0TG9ja01vZGUoTG9ja01v\nZGVUeXBlLlBFU1NJTUlTVElDX1JFQUQpOwogICAgICAgIHF1ZXJ5LnNldEhp\nbnQoImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5LnRpbWVvdXQiLCBsb2NrV2Fp\ndFRpbWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExpc3Q8Pz4gcSA9\nIHF1ZXJ5LmdldFJlc3VsdExpc3QoKTsKICAgICAgICAgICAgZmFpbCgiVW5l\neGNwZWN0ZWQgZmluZCBzdWNjZWVkZWQuIFNob3VsZCB0aHJvdyBhIFBlc3Np\nbWlzdGljTG9ja0V4Y2VwdGlvbi4iKTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBpZiAoIWRpY3Quc3VwcG9ydHNMb2Nr\naW5nV2l0aE11bHRpcGxlVGFibGVzKQogICAgICAgICAgICAgICAgYXNzZXJ0\nRXJyb3IoZSwgUGVzc2ltaXN0aWNMb2NrRXhjZXB0aW9uLmNsYXNzKTsKICAg\nICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIGFzc2VydEVycm9yKGUs\nIFF1ZXJ5VGltZW91dEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKGVtMS5nZXRUcmFuc2FjdGlvbigpLmlz\nQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBlbTEuZ2V0VHJhbnNhY3Rpb24o\nKS5yb2xsYmFjaygpOwogICAgICAgICAgICBpZiAoZW0yLmdldFRyYW5zYWN0\naW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIGVtMi5nZXRUcmFu\nc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgfQogICAgICAgIGVtMS5j\nbG9zZSgpOwogICAgICAgIGVtMi5jbG9zZSgpOwogICAgfQoKICAgIC8qCiAg\nICAgKiBUZXN0IG11bHRpcGxlIGV4ZWN1dGlvbiBvZiB0aGUgc2FtZSBxdWVy\neSB3aXRoIHBlc3NpbWlzdGljIGxvY2suCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHRlc3RSZXBlYXRlZFF1ZXJ5V2l0aFBlc3NpbWlzdGljTG9ja3MoKSB7\nCiAgICAgICAgRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7CiAgICAgICAgcmVzZXRTUUwoKTsKICAgICAgICBlbS5nZXRU\ncmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgU3RyaW5nIGpwcWwgPSAi\nc2VsZWN0IGUuZmlyc3ROYW1lIGZyb20gRW1wbG95ZWUgZSB3aGVyZSBlLmlk\nID0gMSI7CiAgICAgICAgUXVlcnkgcTEgPSBlbS5jcmVhdGVRdWVyeShqcHFs\nKTsKICAgICAgICBxMS5zZXRMb2NrTW9kZShMb2NrTW9kZVR5cGUuUEVTU0lN\nSVNUSUNfV1JJVEUpOwogICAgICAgIFN0cmluZyBmaXJzdE5hbWUxID0gKFN0\ncmluZykgcTEuZ2V0U2luZ2xlUmVzdWx0KCk7CiAgICAgICAgLy9FeHBlY3Rl\nZCBzcWwgZm9yIERlcmJ5IGlzOgogICAgICAgIC8vU0VMRUNUIHQwLmZpcnN0\nTmFtZSBGUk9NIEVtcGxveWVlIHQwIFdIRVJFICh0MC5pZCA9IENBU1QoPyBB\nUyBCSUdJTlQpKSBGT1IgVVBEQVRFIFdJVEggUlIKICAgICAgICBTdHJpbmcg\nU1FMMSA9IHRvU3RyaW5nKHNxbCk7CiAgICAgICAgCiAgICAgICAgLy8gcnVu\nIHRoZSBzZWNvbmQgdGltZQogICAgICAgIHJlc2V0U1FMKCk7CiAgICAgICAg\nUXVlcnkgcTIgPSBlbS5jcmVhdGVRdWVyeShqcHFsKTsKICAgICAgICBxMi5z\nZXRMb2NrTW9kZShMb2NrTW9kZVR5cGUuUEVTU0lNSVNUSUNfV1JJVEUpOwog\nICAgICAgIFN0cmluZyBmaXJzdE5hbWUyID0gKFN0cmluZykgcTIuZ2V0U2lu\nZ2xlUmVzdWx0KCk7CiAgICAgICAgU3RyaW5nIFNRTDIgPSB0b1N0cmluZyhz\ncWwpOwogICAgICAgIGFzc2VydEVxdWFscyhTUUwxLCBTUUwyKTsKICAgICAg\nICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgfQoKICAgIC8q\nKgogICAgICogQXNzZXJ0IHRoYXQgYW4gZXhjZXB0aW9uIG9mIHByb3BlciB0\neXBlIGhhcyBiZWVuIHRocm93bi4gQWxzbyBjaGVja3MgdGhhdAogICAgICog\ndGhhdCB0aGUgZXhjZXB0aW9uIGhhcyBwb3B1bGF0ZWQgdGhlIGZhaWxlZCBv\nYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJhbSBhY3R1YWwKICAgICAqICAg\nICAgICAgICAgZXhjZXB0aW9uIGJlaW5nIHRocm93bgogICAgICogQHBhcmFt\nIGV4cGVjZXRlZAogICAgICogICAgICAgICAgICB0eXBlIG9mIHRoZSBleGNl\ncHRpb24KICAgICAqLwogICAgdm9pZCBhc3NlcnRFcnJvcihUaHJvd2FibGUg\nYWN0dWFsLCBDbGFzczw/IGV4dGVuZHMgVGhyb3dhYmxlPiBleHBlY3RlZCkg\newogICAgICAgIGlmICghZXhwZWN0ZWQuaXNBc3NpZ25hYmxlRnJvbShhY3R1\nYWwuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgYWN0dWFsLnByaW50U3Rh\nY2tUcmFjZSgpOwogICAgICAgICAgICB0aHJvdyBuZXcgQXNzZXJ0aW9uRmFp\nbGVkRXJyb3IoYWN0dWFsLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIiB3YXMg\ncmFpc2VkIGJ1dCBleHBlY3RlZCAiCiAgICAgICAgICAgICAgICAgICAgKyBl\neHBlY3RlZC5nZXROYW1lKCkpOwogICAgICAgIH0KICAgICAgICBPYmplY3Qg\nZmFpbGVkID0gZ2V0RmFpbGVkT2JqZWN0KGFjdHVhbCk7CiAgICAgICAgYXNz\nZXJ0Tm90TnVsbCgiRmFpbGVkIG9iamVjdCBpcyBudWxsIiwgZmFpbGVkKTsK\nICAgICAgICBhc3NlcnROb3RFcXVhbHMoIm51bGwiLCBmYWlsZWQpOwogICAg\nfQoKICAgIE9iamVjdCBnZXRGYWlsZWRPYmplY3QoVGhyb3dhYmxlIGUpIHsK\nICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIExvY2tUaW1lb3V0RXhjZXB0aW9u\nKSB7CiAgICAgICAgICAgIHJldHVybiAoKExvY2tUaW1lb3V0RXhjZXB0aW9u\nKSBlKS5nZXRPYmplY3QoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGUgaW5z\ndGFuY2VvZiBQZXNzaW1pc3RpY0xvY2tFeGNlcHRpb24pIHsKICAgICAgICAg\nICAgcmV0dXJuICgoUGVzc2ltaXN0aWNMb2NrRXhjZXB0aW9uKSBlKS5nZXRF\nbnRpdHkoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBR\ndWVyeVRpbWVvdXRFeGNlcHRpb24pIHsKICAgICAgICAgICAgcmV0dXJuICgo\nUXVlcnlUaW1lb3V0RXhjZXB0aW9uKSBlKS5nZXRRdWVyeSgpOwogICAgICAg\nIH0KICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE9wZW5KUEFFeGNlcHRpb24p\nIHsKICAgICAgICAgICAgcmV0dXJuICgoT3BlbkpQQUV4Y2VwdGlvbikgZSku\nZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKfQo=\n","encoding":"base64"}

