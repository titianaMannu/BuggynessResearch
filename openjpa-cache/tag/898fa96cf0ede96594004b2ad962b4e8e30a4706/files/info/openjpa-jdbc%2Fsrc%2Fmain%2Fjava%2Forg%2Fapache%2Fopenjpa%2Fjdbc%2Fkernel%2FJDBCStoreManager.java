{"sha":"451edbf53ac4d6c444203d3b10e68eb57abb21a7","node_id":"MDQ6QmxvYjIwNjM2NDo0NTFlZGJmNTNhYzRkNmM0NDQyMDNkM2IxMGU2OGViNTdhYmIyMWE3","size":63320,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/451edbf53ac4d6c444203d3b10e68eb57abb21a7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5z\ncWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5o\nYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1p\nbmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZp\nZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmFsdWVNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuU3VwZXJjbGFzc0Rpc2NyaW1pbmF0b3JTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rp\nb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9p\nblN5bnRheGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJl\nc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxF\neGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNRTEZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlNlbGVjdEV4ZWN1dG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlVuaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5Ccm9rZXJJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLkZpbmRlckNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5Mb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlNlcTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlUXVlcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29u\nbmVjdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5E\nZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmpkYmMuRGVsZWdhdGluZ1N0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dlbmVyYXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAq\nIFN0b3JlTWFuYWdlciBwbHVnaW4gdGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUg\ncGVyc2lzdGVudCBkYXRhIGluIGEKICogcmVsYXRpb25hbCBkYXRhIHN0b3Jl\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgSkRCQ1N0b3JlTWFuYWdlciAKICAgIGltcGxlbWVudHMg\nU3RvcmVNYW5hZ2VyLCBKREJDU3RvcmUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoSkRCQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0\nZSBTdG9yZUNvbnRleHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkND\nb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgREJEaWN0\naW9uYXJ5IF9kaWN0ID0gbnVsbDsKICAgIHByaXZhdGUgU1FMRmFjdG9yeSBf\nc3FsID0gbnVsbDsKICAgIHByaXZhdGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9\nIG51bGw7CiAgICBwcml2YXRlIERhdGFTb3VyY2UgX2RzID0gbnVsbDsKICAg\nIHByaXZhdGUgUmVmQ291bnRDb25uZWN0aW9uIF9jb25uID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfYWN0aXZlID0gZmFsc2U7CgogICAgLy8gdHJh\nY2sgdGhlIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRo\nZW0KICAgIHByaXZhdGUgU2V0PFN0YXRlbWVudD4gX3N0bW50cyA9IENvbGxl\nY3Rpb25zLnN5bmNocm9uaXplZFNldChuZXcgSGFzaFNldDxTdGF0ZW1lbnQ+\nKCkpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPENs\naWVudENvbm5lY3Rpb24+IGNsaWVudENvbm5lY3Rpb25JbXBsOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8UmVmQ291bnRDb25uZWN0\naW9uPiByZWZDb3VudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgQ29uc3RydWN0b3I8Q2FuY2VsU3RhdGVtZW50PiBjYW5jZWxT\ndGF0ZW1lbnRJbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ29uc3Ry\ndWN0b3I8Q2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQ+IGNhbmNlbFByZXBhcmVk\nU3RhdGVtZW50SW1wbDsKCiAgICBzdGF0aWMgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGNsaWVudENvbm5lY3Rpb25JbXBsID0gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENsaWVudENvbm5l\nY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgQ29ubmVjdGlvbi5jbGFz\ncyk7CiAgICAgICAgICAgIHJlZkNvdW50Q29ubmVjdGlvbkltcGwgPSBDb25j\ncmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoUmVm\nQ291bnRDb25uZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0\nb3JlTWFuYWdlci5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIGNhbmNlbFN0YXRlbWVudEltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJh\ndG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoQ2FuY2VsU3RhdGVtZW50LmNs\nYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci5jbGFzcywg\nU3RhdGVtZW50LmNsYXNzLCBDb25uZWN0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsID0gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENhbmNlbFByZXBh\ncmVkU3RhdGVtZW50LmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3Jl\nTWFuYWdlci5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIENvbm5l\nY3Rpb24uY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVy\nRXJyb3IoZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNv\nbnRleHQgZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2N0eDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBj\ndHgpIHsKICAgICAgICBzZXRDb250ZXh0KGN0eCwgKEpEQkNDb25maWd1cmF0\naW9uKSBjdHguZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4LCBKREJD\nQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAg\nICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2RpY3QgPSBfY29uZi5nZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIF9zcWwgPSBfY29uZi5n\nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKTsKCiAgICAgICAgTG9ja01hbmFnZXIg\nbG0gPSBjdHguZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICBpZiAobG0gaW5z\ndGFuY2VvZiBKREJDTG9ja01hbmFnZXIpCiAgICAgICAgICAgIF9sbSA9IChK\nREJDTG9ja01hbmFnZXIpIGxtOwoKICAgICAgICBpZiAoIWN0eC5pc01hbmFn\nZWQoKSAmJiBfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQo\nKSkKICAgICAgICAgICAgX2RzID0gX2NvbmYuZ2V0RGF0YVNvdXJjZTIoY3R4\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERh\ndGFTb3VyY2UoY3R4KTsKCiAgICAgICAgaWYgKF9jb25mLmdldFVwZGF0ZU1h\nbmFnZXJJbnN0YW5jZSgpLm9yZGVyRGlydHkoKSkKICAgICAgICAgICAgY3R4\nLnNldE9yZGVyRGlydHlPYmplY3RzKHRydWUpOwogICAgfQoKICAgIHB1Ymxp\nYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAg\nICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgREJEaWN0aW9u\nYXJ5IGdldERCRGljdGlvbmFyeSgpIHsKICAgICAgICByZXR1cm4gX2RpY3Q7\nCiAgICB9CgogICAgcHVibGljIFNRTEZhY3RvcnkgZ2V0U1FMRmFjdG9yeSgp\nIHsKICAgICAgICByZXR1cm4gX3NxbDsKICAgIH0KCiAgICBwdWJsaWMgSkRC\nQ0xvY2tNYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAgICAgIHJldHVy\nbiBfbG07CiAgICB9CgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiAo\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgX2N0eC5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbk9wdGltaXN0\naWMoKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tPcHRpbWlz\ndGljKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2luKCkgewogICAg\nICAgIF9hY3RpdmUgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICgoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9jb25mLmlzQ29ubmVjdGlv\nbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQogICAgICAgICAgICAgICAgJiYgX2Nv\nbm4uZ2V0QXV0b0NvbW1pdCgpKQogICAgICAgICAgICAgICAgX2Nvbm4uc2V0\nQXV0b0NvbW1pdChmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsKICAgICAg\nICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3Qp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfY3R4LmlzTWFuYWdl\nZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQo\nKSkKICAgICAgICAgICAgICAgIF9jb25uLmNvbW1pdCgpOwogICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJhY2soKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikgewogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9k\naWN0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfYWN0aXZl\nID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJv\nbGxiYWNrKCkgewogICAgICAgIC8vIGFscmVhZHkgcm9sbGVkIGJhY2sgb3Vy\nc2VsdmVzPwogICAgICAgIGlmICghX2FjdGl2ZSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX2Nvbm4gIT0g\nbnVsbAogICAgICAgICAgICAgICAgJiYgKCFfY3R4LmlzTWFuYWdlZCgpIHx8\nICFfY29uZgogICAgICAgICAgICAgICAgICAgIC5pc0Nvbm5lY3Rpb25GYWN0\nb3J5TW9kZU1hbmFnZWQoKSkpCiAgICAgICAgICAgICAgICBfY29ubi5yb2xs\nYmFjaygpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBf\nZGljdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2\nZSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBy\nZXRhaW5Db25uZWN0aW9uKCkgewogICAgICAgIGNvbm5lY3QoZmFsc2UpOwog\nICAgICAgIF9jb25uLnNldFJldGFpbih0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByZWxlYXNlQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoX2Nv\nbm4gIT0gbnVsbCkKICAgICAgICAgICAgX2Nvbm4uc2V0UmV0YWluKGZhbHNl\nKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldENsaWVudENvbm5lY3Rp\nb24oKSB7CiAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3Iu\nbmV3SW5zdGFuY2UoY2xpZW50Q29ubmVjdGlvbkltcGwsIGdldENvbm5lY3Rp\nb24oKSk7CiAgICB9CgogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29ubmVj\ndGlvbigpIHsKICAgICAgICBjb25uZWN0KHRydWUpOwogICAgICAgIHJldHVy\nbiBfY29ubjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIERhdGFTb3VyY2Ug\nZ2V0RGF0YVNvdXJjZSgpIHsKICAgIAlyZXR1cm4gX2RzOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGV4aXN0cyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIGFkZCB3aGVyZSBjb25k\naXRpb25zIG9uIGJhc2UgY2xhc3MgdG8gYXZvaWQgam9pbnMgaWYgc3ViY2xh\nc3MKICAgICAgICAvLyBkb2Vzbid0IHVzZSBvaWQgYXMgaWRlbnRpZmllcgog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykg\nc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICByZXR1cm4gZXhpc3RzKG1hcHBp\nbmcsIHNtLmdldE9iamVjdElkKCksIGNvbnRleHQpOwogICAgfQoKICAgIHBy\naXZhdGUgYm9vbGVhbiBleGlzdHMoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9i\namVjdCBvaWQsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgLy8gYWRkIHdo\nZXJlIGNvbmRpdGlvbnMgb24gYmFzZSBjbGFzcyB0byBhdm9pZCBqb2lucyBp\nZiBzdWJjbGFzcwogICAgICAgIC8vIGRvZXNuJ3QgdXNlIG9pZCBhcyBpZGVu\ndGlmaWVyCiAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7\nCiAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgbWFwcGluZyA9IG1h\ncHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CgogICAg\nICAgIHNlbC53aGVyZVByaW1hcnlLZXkob2lkLCBtYXBwaW5nLCB0aGlzKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gc2VsLmdldENvdW50\nKHRoaXMpICE9IDA7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUo\nc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gc3luY1ZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0\nIGNvbnRleHQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChD\nbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNoZWNr\nVmVyc2lvbihzbSwgdGhpcywgdHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGludCBjb21wYXJlVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHN0YXRlLCBPYmplY3QgdjEsIE9iamVjdCB2MikgewogICAgICAgIENsYXNz\nTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc3RhdGUuZ2V0TWV0\nYURhdGEoKTsKICAgICAgICByZXR1cm4gbWFwcGluZy5nZXRWZXJzaW9uKCku\nY29tcGFyZVZlcnNpb24odjEsIHYyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpbml0aWFsaXplKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3Rh\ndGUgc3RhdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3QgY29udGV4dCkgewogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8g\nPSAoQ29ubmVjdGlvbkluZm8pIGNvbnRleHQ7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIGluaXRpYWxpemVTdGF0ZShzbSwgc3RhdGUsIChK\nREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaCwgCiAgICAgICAgICAgICAg\nICBpbmZvKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0\naW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2Us\nIF9kaWN0LCBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgYSBuZXdseS1sb2Fk\nZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlu\naXRpYWxpemVTdGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRl\nIHN0YXRlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIENvbm5lY3Rpb25JbmZvIGluZm8pCiAgICAgICAgdGhyb3dzIENsYXNzTm90\nRm91bmRFeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0\nIG9pZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwog\nICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChpbmZvICE9IG51bGwgJiYgaW5mby5yZXN1bHQgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgcmVzID0gaW5mby5yZXN1bHQ7CiAgICAg\nICAgICAgICAgICBpbmZvLnNtID0gc207CiAgICAgICAgICAgICAgICBpZiAo\naW5mby5tYXBwaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaW5m\nby5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgICAgICAgICAgIG1hcHBpbmcg\nPSBpbmZvLm1hcHBpbmc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob2lkIGlu\nc3RhbmNlb2YgT3BlbkpQQUlkCiAgICAgICAgICAgICAgICAmJiAhKChPcGVu\nSlBBSWQpIG9pZCkuaGFzU3ViY2xhc3NlcygpKSB7CiAgICAgICAgICAgICAg\nICBCb29sZWFuIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20sIG1hcHBpbmcsIHN0\nYXRlLCBmZXRjaCk7CiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1c3RvbS5ib29sZWFu\nVmFsdWUoKTsKICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxpemVT\ndGF0ZVJlc3VsdChzbSwgbWFwcGluZywgZmV0Y2gsCiAgICAgICAgICAgICAg\nICAgICAgU2VsZWN0LlNVQlNfRVhBQ1QpOwogICAgICAgICAgICAgICAgaWYg\nKHJlcyA9PSBudWxsICYmICFzZWxlY3RQcmltYXJ5S2V5KHNtLCBtYXBwaW5n\nLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICAgICAgaWYgKGlzRW1wdHlSZXN1bHQocmVzKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9\nIG1hcHBpbmcuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5kZXBlbmRlbnRB\nc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGlmIChtYXBw\naW5ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgICAgIG1hcHBp\nbmcgPSBtYXBwaW5nc1swXTsKICAgICAgICAgICAgICAgICAgICBCb29sZWFu\nIGN1c3RvbSA9IGN1c3RvbUxvYWQoc20sIG1hcHBpbmcsIHN0YXRlLCBmZXRj\naCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1c3RvbSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VzdG9tLmJvb2xlYW5W\nYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxp\nemVTdGF0ZVJlc3VsdChzbSwgbWFwcGluZywgZmV0Y2gsCiAgICAgICAgICAg\nICAgICAgICAgICAgIFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHJlcyA9PSBudWxsICYmICFzZWxlY3RQcmlt\nYXJ5S2V5KHNtLCBtYXBwaW5nLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgIHJlcyA9IGdldEluaXRpYWxpemVTdGF0ZVVu\naW9uUmVzdWx0KHNtLCBtYXBwaW5nLCBtYXBwaW5ncywKICAgICAgICAgICAg\nICAgICAgICAgICAgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKGlzRW1w\ndHlSZXN1bHQocmVzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZpZ3VyZSBvdXQg\nd2hhdCB0eXBlIG9mIG9iamVjdCB0aGlzIGlzOyB0aGUgc3RhdGUgbWFuYWdl\ncgogICAgICAgICAgICAvLyBvbmx5IGd1YXJhbnRlZXMgdG8gcHJvdmlkZSBh\nIGJhc2UgY2xhc3MKICAgICAgICAgICAgQ2xhc3M8Pz4gdHlwZTsKICAgICAg\nICAgICAgaWYgKCh0eXBlID0gZ2V0VHlwZShyZXMsIG1hcHBpbmcpKSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzLmdldEJhc2VNYXBwaW5n\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBtYXBwaW5nID0gcmVz\nLmdldEJhc2VNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICByZXMuc3RhcnRE\nYXRhUmVxdWVzdChtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKSk7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBt\nYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5nZXRDbGFzcyh0aGlzLCBtYXBw\naW5nLAogICAgICAgICAgICAgICAgICAgICAgICByZXMpOwogICAgICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICByZXMuZW5k\nRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc3RhdGUgbWFuYWdl\ncjsgdGhpcyBtYXkgY2hhbmdlIHRoZSBtYXBwaW5nCiAgICAgICAgICAgIC8v\nIGFuZCB0aGUgb2JqZWN0IGlkIGluc3RhbmNlIGlmIHRoZSB0eXBlIGFzIGRl\ndGVybWluZWQKICAgICAgICAgICAgLy8gZnJvbSB0aGUgaW5kaWNhdG9yIGlz\nIGEgc3ViY2xhc3Mgb2YgZXhwZWN0ZWQgdHlwZQogICAgICAgICAgICBzbS5p\nbml0aWFsaXplKHR5cGUsIHN0YXRlKTsKCiAgICAgICAgICAgIGlmIChpbmZv\nICE9IG51bGwgJiYgaW5mby5yZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5RmllbGRNYXBwaW5nID0gaW5m\nby5yZXN1bHQuCiAgICAgICAgICAgICAgICAgICAgZ2V0TWFwcGVkQnlGaWVs\nZE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIE9iamVjdCBtYXBwZWRCeU9i\namVjdCA9IGluZm8ucmVzdWx0LmdldE1hcHBlZEJ5VmFsdWUoKTsKICAgICAg\nICAgICAgICAgIGlmIChtYXBwZWRCeUZpZWxkTWFwcGluZyAhPSBudWxsICYm\nIG1hcHBlZEJ5T2JqZWN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\naWYgKG1hcHBlZEJ5T2JqZWN0IGluc3RhbmNlb2YgT3BlbkpQQUlkICYmCiAg\nICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmcuZ2V0RXh0cmFGaWVsZERh\ndGFJbmRleChtYXBwZWRCeUZpZWxkTWFwcGluZy5nZXRJbmRleCgpKSAhPSAt\nMSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgaW52ZXJzZSBy\nZWxhdGlvbiBjYW4gbm90IGJlIHNldCBzaW5jZQogICAgICAgICAgICAgICAg\nICAgICAgICAvLyB3ZSBhcmUgZWFnZXJseSBsb2FkaW5nIHRoaXMgc20gZm9y\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGEgc20gb3duZXIgdGhhdCBp\ncyBzdGlsbCBpbiB0aGUgcHJvY2VzcyBvZiAKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gaW5pdGlhbGl6aW5nIGl0c2VsZi4KICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gUmVtZW1iZXIgb3duZXIgb2lkIGJ5IHNldEludGVybWVk\naWF0ZSgpLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgaW52ZXJz\nZSByZWxhdGlvbiBpcyBzZXQgbGF0ZXIgYnkKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gc2V0SW52ZXJzZVJlbGF0aW9uKCkgd2hlbiB0aGUgc20gb3du\nZXIgaXMgZnVsbHkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5pdGlh\nbGl6ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgIGludCBpbmRleCA9IG1h\ncHBlZEJ5RmllbGRNYXBwaW5nLmdldEluZGV4KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChzbS5nZXRMb2FkZWQoKS5nZXQoaW5kZXgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRJbXBsRGF0YShpbmRl\neCwgbWFwcGVkQnlPYmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0SW50\nZXJtZWRpYXRlKGluZGV4LCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICBzZXRNYXBwZWRCeShzbSwgbWFwcGVk\nQnlGaWVsZE1hcHBpbmcsIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbG9hZCB0\naGUgc2VsZWN0ZWQgbWFwcGluZ3MgaW50byB0aGUgZ2l2ZW4gc3RhdGUgbWFu\nYWdlcgogICAgICAgICAgICBpZiAocmVzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIHJlLWdldCB0aGUgbWFwcGluZyBpbiBjYXNlIHRoZSBpbnN0\nYW5jZSB3YXMgYSBzdWJjbGFzcwogICAgICAgICAgICAgICAgbWFwcGluZyA9\nIChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAg\nICAgICBsb2FkKG1hcHBpbmcsIHNtLCBmZXRjaCwgcmVzKTsKICAgICAgICAg\nICAgICAgIGdldFZlcnNpb24obWFwcGluZywgc20sIHJlcyk7CiAgICAgICAg\nICAgICAgICBzZXRJbnZlcnNlUmVsYXRpb24oc20sIG1hcHBpbmcsIHJlcyk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsICYm\nIChpbmZvID09IG51bGwgfHwgcmVzICE9IGluZm8ucmVzdWx0KSkKICAgICAg\nICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgc2V0SW52ZXJzZVJlbGF0aW9uKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgb3duZXIsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFJl\nc3VsdCByZXMpIHsKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBw\naW5nLmdldEZpZWxkTWFwcGluZ3MoKTsKCiAgICAgICAgLy8gQXQgdGhpcyBw\nb2ludCwgdGhlIG93bmVyIGlzIGZ1bGx5IGluaXRpYWxpemVkLgogICAgICAg\nIC8vIENoZWNrIGlmIHRoZSBvd25lciBoYXMgZWFnZXJseSBsb2FkZWQgVG9N\nYW55IHJlbGF0aW9ucy4KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAocmVzLmdldEVhZ2Vy\nKGZtc1tpXSkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCFmbXNb\naV0uZ2V0RWxlbWVudCgpLmlzVHlwZVBDKCkpCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICBPYmplY3QgY29sbCA9ICBv\nd25lci5mZXRjaE9iamVjdChmbXNbaV0uZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgICAgICBpZiAoY29sbCBpbnN0YW5jZW9mIE1hcCkKICAgICAgICAgICAg\nICAgICAgICBjb2xsID0gKChNYXApY29sbCkudmFsdWVzKCk7CiAgICAgICAg\nICAgICAgICBpZiAoY29sbCBpbnN0YW5jZW9mIENvbGxlY3Rpb248Pz4gJiYg\nCiAgICAgICAgICAgICAgICAgICAgKChDb2xsZWN0aW9uPD8+KSBjb2xsKS5z\naXplKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgZWFn\nZXJseSBsb2FkZWQgY29sbGVjdGlvbi4KICAgICAgICAgICAgICAgICAgICAv\nLyBQdWJsaXNoZXIgKDEpIDw9PT4gIChNKSBNYWdhemluZQogICAgICAgICAg\nICAgICAgICAgIC8vICAgIHB1Ymxpc2hlciBoYXMgYSBFQUdFUiBPbmVUb01h\nbnkgcmVsYXRpb24KICAgICAgICAgICAgICAgICAgICAvLyAgICBtYWdhemlu\nZSBoYXMgYSBFQUdFUiBvciBMQVpZIE1hbnlUb09uZSBwdWJsaXNoZXIKICAg\nICAgICAgICAgICAgICAgICAvLyBGb3IgZWFjaCBtZW1iZXIgKE1hZ2F6aW5l\nKSBpbiB0aGUgY29sbGVjdGlvbiwgCiAgICAgICAgICAgICAgICAgICAgLy8g\nc2V0IGl0cyBpbnZlcnNlIHJlbGF0aW9uIChQdWJsaXNoZXIpLgogICAgICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gKChDb2xsZWN0\naW9uPD8+KSBjb2xsKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxl\nKSBpdHIubmV4dCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBj\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgcGMuCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAg\nICAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbWQgPSAoKENsYXNz\nTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKSkuCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBnZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZm1kLmxlbmd0aDsgaisr\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qgb2lkID0g\nc20uZ2V0SW50ZXJtZWRpYXRlKGZtZFtqXS5nZXRJbmRleCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG9pZCB3YXMgc2V0SW50ZXJt\nZWRpYXRlKCkgcHJldmlvdXNseQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gYW5kIGl0IGlzIHRoZSBzYW1lIGFzIHRoZSBvd25lciwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gc2V0IHRoZSBpbnZlcnNl\nIHJlbGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2lk\nICE9IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBv\naWQuZXF1YWxzKG93bmVyLmdldE9iamVjdElkKCkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZm1kW2pdLmdl\ndEluZGV4KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG93bmVyLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRNYXBw\nZWRCeShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEZpZWxkTWFw\ncGluZyBtYXBwZWRCeUZpZWxkTWFwcGluZywgT2JqZWN0IG1hcHBlZEJ5T2Jq\nZWN0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NN\nYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIEZpZWxkTWFwcGlu\nZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmbXNbaV0gPT0gbWFwcGVkQnlGaWVsZE1hcHBpbmcpIHsK\nICAgICAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZtc1tpXS5nZXRJbmRl\neCgpLCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24t\nSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBn\nZXR0aW5nIHZlcnNpb24gZnJvbSB0aGUgcmVzdWx0IHNldC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgZ2V0VmVyc2lvbihDbGFzc01hcHBpbmcgbWFw\ncGluZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBSZXN1bHQg\ncmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBtYXBwaW5nLmdl\ndFZlcnNpb24oKS5hZnRlckxvYWQoc20sIHRoaXMpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGNoZWNraW5nIHdoZXRoZXIgdGhlIHJlc3VsdCBzZXQgaXMg\nZW1wdHkgb3Igbm90LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBp\nc0VtcHR5UmVzdWx0KFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAhcmVzLm5leHQoKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHBy\nb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAg\nICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcgdHlwZSBmcm9tIHRoZSBy\nZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3M8Pz4gZ2V0\nVHlwZShSZXN1bHQgcmVzLCBDbGFzc01hcHBpbmcgbWFwcGluZyl7CiAgICAg\nICAgaWYgKHJlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWFwcGlu\nZy5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB0aGUgbWFwcGluZyB0byBjdXN0\nb20gbG9hZCBkYXRhLiBSZXR1cm4gbnVsbCBpZiB0aGUgbWFwcGluZwogICAg\nICogZG9lcyBub3QgdXNlIGN1c3RvbSBsb2FkaW5nLgogICAgICovCiAgICBw\ncml2YXRlIEJvb2xlYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBQQ1N0YXRlIHN0\nYXRlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRo\ncm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgbWFwcGluZyB0YWtlcyBj\nYXJlIG9mIGluaXRpYWxpemF0aW9uCiAgICAgICAgaWYgKCFtYXBwaW5nLmN1\nc3RvbUxvYWQoc20sIHRoaXMsIHN0YXRlLCBmZXRjaCkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lv\nbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybiBC\nb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFu\nLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBkYXRh\nIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UgYW5kIHJldHVybiB0aGUgcmVzdWx0\nLiBSZXR1cm4KICAgICAqIG51bGwgaWYgdGhlcmUgaXMgbm8gZGF0YSBpbiB0\naGUgY3VycmVudCBmZXRjaCBncm91cHMgdG8gc2VsZWN0LgogICAgICovCiAg\nICBwcml2YXRlIFJlc3VsdCBnZXRJbml0aWFsaXplU3RhdGVSZXN1bHQoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHN1YnMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRmluZGVy\nUXVlcnlJbXBsIGZxID0gZ2V0RmluZGVyKG1hcHBpbmcsIGZldGNoKTsKICAg\nICAgICBpZiAoZnEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZxLmV4\nZWN1dGUoc20sIHRoaXMsIGZldGNoKTsKICAgICAgICBTZWxlY3Qgc2VsID0g\nX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBpZiAoIXNlbGVjdChzZWwsIG1h\ncHBpbmcsIHN1YnMsIHNtLCBudWxsLCBmZXRjaCwKICAgICAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOLCB0cnVlLCBmYWxzZSkp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywgdGhpcyk7CiAg\nICAgICAgc2VsLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwog\nICAgICAgIFJlc3VsdCByZXN1bHQgPSBzZWwuZXhlY3V0ZSh0aGlzLCBmZXRj\naCk7CiAgICAgICAgY2FjaGVGaW5kZXIobWFwcGluZywgc2VsLCBmZXRjaCk7\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlbGVjdCBhIHVuaW9uIG9mIHRoZSBkYXRhIGZvciB0aGUgZ2l2ZW4gaW5z\ndGFuY2UgZnJvbSBwb3NzaWJsZSBjb25jcmV0ZQogICAgICogbWFwcGluZ3Mg\nYW5kIHJldHVybiB0aGUgcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIFJl\nc3VsdCBnZXRJbml0aWFsaXplU3RhdGVVbmlvblJlc3VsdChmaW5hbCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBmaW5hbCBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncywKICAgICAgICBm\naW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBGaW5kZXJRdWVyeUltcGwgZnEgPSBnZXRG\naW5kZXIobWFwcGluZywgZmV0Y2gpOwogICAgICAgIGlmIChmcSAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZnEuZXhlY3V0ZShzbSwgdGhpcywgZmV0\nY2gpOwogICAgICAgIGZpbmFsIEpEQkNTdG9yZU1hbmFnZXIgc3RvcmUgPSB0\naGlzOwogICAgICAgIGZpbmFsIGludCBlYWdlciA9IE1hdGgubWluKGZldGNo\nLmdldEVhZ2VyRmV0Y2hNb2RlKCksCiAgICAgICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7CgogICAgICAgIFVuaW9uIHVuaW9u\nID0gX3NxbC5uZXdVbmlvbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgIHVu\naW9uLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwogICAgICAg\nIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBm\nZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAgICB1bmlvbi5hYm9ydFVuaW9u\nKCk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3Rvcigp\nIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWws\nIGludCBpKSB7CiAgICAgICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmdz\nW2ldLCBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEUsIHN0b3JlLCBmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICBlYWdlcik7CiAgICAgICAgICAgICAgICBz\nZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmdz\nW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAg\nICBSZXN1bHQgcmVzdWx0ID0gdW5pb24uZXhlY3V0ZSh0aGlzLCBmZXRjaCk7\nCiAgICAgICAgY2FjaGVGaW5kZXIobWFwcGluZywgdW5pb24sIGZldGNoKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICog\nU2VsZWN0IHByaW1hcnkga2V5IGRhdGEgdG8gbWFrZSBzdXJlIHRoZSBnaXZl\nbiBpbnN0YW5jZSBleGlzdHMsIGxvY2tpbmcKICAgICAqIGlmIG5lZWRlZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdFByaW1hcnlLZXko\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBzZWxlY3QgcGtz\nIGZyb20gYmFzZSBjbGFzcyByZWNvcmQgdG8gZW5zdXJlIGl0IGV4aXN0cyBh\nbmQgbG9jawogICAgICAgIC8vIGl0IGlmIG5lZWRlZAogICAgICAgIENsYXNz\nTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAg\nICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKTsKCiAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0\nKCk7CiAgICAgICAgc2VsLnNlbGVjdChiYXNlLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCkpOwogICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2Jq\nZWN0SWQoKSwgYmFzZSwgdGhpcyk7CiAgICAgICAgUmVzdWx0IGV4aXN0cyA9\nIHNlbC5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChleGlzdHMpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgLy8gcmVjb3JkIGxv\nY2tlZD8KICAgICAgICAgICAgaWYgKF9hY3RpdmUgJiYgX2xtICE9IG51bGwg\nJiYgZXhpc3RzLmlzTG9ja2luZygpKQogICAgICAgICAgICAgICAgX2xtLmxv\nYWRlZEZvclVwZGF0ZShzbSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGV4aXN0cy5jbG9zZSgp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBsb2FkKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9ja0xldmVsLCBPYmpl\nY3QgY29udGV4dCkgewogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\namZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZldGNoOwoKICAg\nICAgICAvLyBnZXQgYSBjb25uZWN0aW9uLCBvciByZXVzZSBjdXJyZW50IG9u\nZQogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSAoQ29ubmVjdGlvbklu\nZm8pIGNvbnRleHQ7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAgICAg\nICAgaWYgKGluZm8gIT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBpbml0\naWFsaXplKCkgZmFpbHMgdG8gbG9hZCByZXF1aXJlZCBmaWVsZHMsIHRoZW4g\ndGhpcyBtZXRob2QKICAgICAgICAgICAgLy8gaXMgY2FsbGVkOyBtYWtlIHN1\ncmUgbm90IHRvIHRyeSB0byB1c2UgdGhlIGdpdmVuIHJlc3VsdCBpZiBpdCdz\nCiAgICAgICAgICAgIC8vIHRoZSBzYW1lIG9uZSB3ZSBqdXN0IGZhaWxlZCB0\nbyBjb21wbGV0ZWx5IGluaXRpYWxpemUoKSB3aXRoCiAgICAgICAgICAgIGlm\nIChpbmZvLnNtICE9IHNtKQogICAgICAgICAgICAgICAgcmVzID0gaW5mby5y\nZXN1bHQ7CiAgICAgICAgICAgIGluZm8uc20gPSBudWxsOwogICAgICAgIH0K\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGFuIGV4\naXN0aW5nIHJlc3VsdCwgbG9hZCBhbGwgd2UgY2FuIGZyb20gaXQKICAgICAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBz\nbS5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAocmVzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRjaCwg\ncmVzKTsKICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwg\nZmllbGRzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhl\nIGluc3RhbmNlIGlzIGhvbGxvdyBhbmQgdGhlcmUncyBhIGN1c3RvbWl6ZWQK\nICAgICAgICAgICAgLy8gZ2V0IGJ5IGlkIG1ldGhvZCwgdXNlIGl0CiAgICAg\nICAgICAgIGlmIChzbS5nZXRMb2FkZWQoKS5sZW5ndGgoKSA9PSAwIAogICAg\nICAgICAgICAgICAgJiYgbWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBu\ndWxsLCBqZmV0Y2gpKQogICAgICAgICAgICAgICAgcmVtb3ZlTG9hZGVkRmll\nbGRzKHNtLCBmaWVsZHMpOwoKICAgICAgICAgICAgLy8jIyMgc2VsZWN0IGlz\nIGtpbmQgb2YgYSBiaWcgb2JqZWN0LCBhbmQgaW4gc29tZSBjYXNlcyB3ZSBk\nb24ndAogICAgICAgICAgICAvLyMjIyB1c2UgaXQuLi4gd291bGQgaXQgYmUg\nd29ydGggaXQgdG8gaGF2ZSBhIHNtYWxsIHNoZWxsIHNlbGVjdAogICAgICAg\nICAgICAvLyMjIyBvYmplY3QgdGhhdCBvbmx5IGNyZWF0ZXMgYSByZWFsIHNl\nbGVjdCB3aGVuIGFjdHVhbGx5IHVzZWQ/CgogICAgICAgICAgICBTZWxlY3Qg\nc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgaWYgKHNlbGVj\ndChzZWwsIG1hcHBpbmcsIFNlbGVjdC5TVUJTX0VYQUNULCBzbSwgZmllbGRz\nLCBqZmV0Y2gsCiAgICAgICAgICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFH\nRVJfSk9JTiwgdHJ1ZSwgZmFsc2UpKSB7CiAgICAgICAgICAgICAgICBzZWwu\nd2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmcsIHRo\naXMpOwogICAgICAgICAgICAgICAgcmVzID0gc2VsLmV4ZWN1dGUodGhpcywg\namZldGNoLCBsb2NrTGV2ZWwpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAJaWYgKGlzRW1wdHlSZXN1bHQocmVzKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAg\nICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRjaCwgcmVzKTsKICAgICAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIG5vdyBhbGxvdyB0aGUgZmllbGRzIHRvIGxvYWQgdGhl\nbXNlbHZlcyBpbmRpdmlkdWFsbHkgdG9vCiAgICAgICAgICAgIEZpZWxkTWFw\ncGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIGlmIChmaWVsZHMuZ2V0KGkpICYmICFzbS5nZXRM\nb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmxv\nYWQoc20sIHRoaXMsIGpmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSk7CiAg\nICAgICAgICAgIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwg\ndGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0\nY2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNR\nTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0LCBsb2NrTGV2ZWwpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGxpc3Qg\nZm9ybWVkIGJ5IHJlbW92aW5nIGFsbCBsb2FkZWQgZmllbGRzIGZyb20gdGhl\nIGdpdmVuIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUxv\nYWRlZEZpZWxkcyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmll\nbGRzKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IGZpZWxkcy5s\nZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRz\nLmdldChpKSAmJiBzbS5nZXRMb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAg\nICAgICBmaWVsZHMuY2xlYXIoaSk7CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gbG9hZEFsbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwg\naW50IGxvYWQsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBP\nYmplY3QgY29udGV4dCkgewogICAgICAgIHJldHVybiBJbXBsSGVscGVyLmxv\nYWRBbGwoc21zLCB0aGlzLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGNvbnRleHQp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZm9yZVN0YXRlQ2hhbmdlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFBDU3RhdGUgZnJvbVN0YXRlLAogICAg\nICAgIFBDU3RhdGUgdG9TdGF0ZSkgewogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGZsdXNoKENvbGxlY3Rpb24gc21zKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9jb25uICE9IG51bGwgJiYgX2Nvbm4uZ2V0SW5u\nZXJtb3N0RGVsZWdhdGUoKS5pc1JlYWRPbmx5KCkpCiAgICAgICAgICAgICAg\nICBfY29ubi5zZXRSZWFkT25seShmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIGUpIHsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9j\nb25mLmdldFVwZGF0ZU1hbmFnZXJJbnN0YW5jZSgpLmZsdXNoKHNtcywgdGhp\ncyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxsKCkgewog\nICAgICAgIC8vIG5vdGUgdGhhdCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBsb2Nr\nIHRoZSBjb250ZXh0LCBzaW5jZQogICAgICAgIC8vIHdlIHdhbnQgdG8gYWxs\nb3cgYSBkaWZmZXJlbnQgdGhyZWFkIHRvIGJlIGFibGUgdG8gY2FuY2VsIHRo\nZQogICAgICAgIC8vIG91dHN0YW5kaW5nIHN0YXRlbWVudCBvbiBhIGRpZmZl\ncmVudCBjb250ZXh0CgogICAgICAgIENvbGxlY3Rpb248U3RhdGVtZW50PiBz\ndG1udHM7CiAgICAgICAgc3luY2hyb25pemVkIChfc3RtbnRzKSB7CiAgICAg\nICAgICAgIGlmIChfc3RtbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3RtbnRzID0gbmV3IEFycmF5\nTGlzdDxTdGF0ZW1lbnQ+KF9zdG1udHMpOwogICAgICAgIH0KCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxTdGF0ZW1lbnQ+IGl0\nciA9IHN0bW50cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICgoU3RhdGVtZW50KSBpdHIubmV4dCgpKS5jYW5jZWwoKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gYXNzaWduT2JqZWN0SWQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBM\nSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmFz\nc2lnbihzbSwgdGhpcywgcHJlRmx1c2gpOwoKICAgICAgICAvLyBkYXRhc3Rv\ncmUgaWRlbnRpdHkKICAgICAgICBPYmplY3QgdmFsID0gSW1wbEhlbHBlci5n\nZW5lcmF0ZUlkZW50aXR5VmFsdWUoX2N0eCwgbWV0YSwKICAgICAgICAgICAg\nSmF2YVR5cGVzLkxPTkcpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiBt\nZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0ZWdpZXMu\nTkFUSVZFKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICB2YWwgPSBnZXREYXRhU3RvcmVJ\nZFNlcXVlbmNlKG1ldGEpLm5leHQoX2N0eCwgbWV0YSk7CiAgICAgICAgc20u\nc2V0T2JqZWN0SWQobmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKSk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXNz\naWduRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGZpZWxkLAog\nICAgICAgIGJvb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRlRmllbGRW\nYWx1ZShfY3R4LCBmbWQpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHNtLnN0b3JlKGZpZWxk\nLCB2YWwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzczw/PiBnZXRNYW5hZ2VkVHlwZShPYmplY3Qgb2lkKSB7CiAgICAg\nICAgaWYgKG9pZCBpbnN0YW5jZW9mIElkKQogICAgICAgICAgICByZXR1cm4g\nKChJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIENsYXNzPD8+IGdldERhdGFTdG9yZUlkVHlwZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQuY2xhc3M7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBjb3B5RGF0YVN0b3JlSWQoT2Jq\nZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgSWQgaWQg\nPSAoSWQpIG9pZDsKICAgICAgICByZXR1cm4gbmV3IElkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCBpZC5nZXRJZCgpLCBpZC5oYXNTdWJjbGFzc2VzKCkp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RGF0YVN0b3JlSWQoT2Jq\nZWN0IHZhbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJu\nIElkLm5ld0luc3RhbmNlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB2YWwp\nOwogICAgfQoKICAgIHB1YmxpYyBJZCBuZXdEYXRhU3RvcmVJZChsb25nIGlk\nLCBDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBzdWJzKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBJZChtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSwg\naWQsIHN1YnMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92\naWRlciBleGVjdXRlRXh0ZW50KENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAg\nICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMsIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENs\nYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdb\nXSBtYXBwaW5nczsKICAgICAgICBpZiAoc3ViY2xhc3NlcykKICAgICAgICAg\nICAgbWFwcGluZ3MgPSBtYXBwaW5nLmdldEluZGVwZW5kZW50QXNzaWduYWJs\nZU1hcHBpbmdzKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtYXBwaW5n\ncyA9IG5ldyBDbGFzc01hcHBpbmdbXSB7IG1hcHBpbmcgfTsKCiAgICAgICAg\nUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAgICBm\naW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9IChKREJDRmV0\nY2hDb25maWd1cmF0aW9uKSBmZXRjaDsKICAgICAgICBpZiAoamZldGNoLmdl\ndFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGpmZXRjaC5FQUdFUl9K\nT0lOKQogICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3Zp\nZGVyW21hcHBpbmdzLmxlbmd0aF07CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBjdXN0b20gbG9hZHMKICAgICAgICAgICAgUmVz\ndWx0T2JqZWN0UHJvdmlkZXIgcm9wOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICByb3AgPSBtYXBwaW5nc1tpXS5jdXN0b21Mb2FkKHRoaXMsIHN1YmNs\nYXNzZXMsIGpmZXRjaCwgMCwKICAgICAgICAgICAgICAgICAgICBMb25nLk1B\nWF9WQUxVRSk7CiAgICAgICAgICAgICAgICBpZiAocm9wICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAocm9wcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3Zp\nZGVyW21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgcm9w\nc1tpXSA9IHJvcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaWYgd2UncmUgc2VsZWN0aW5nIGluZGVwZW5kZW50\nIG1hcHBpbmdzIHNlcGFyYXRlbHkgb3IgaGF2ZQogICAgICAgICAgICAvLyBj\ndXN0b20gbG9hZHMsIGRvIGluZGl2aWR1YWwgc2VsZWN0cyBmb3IgZWFjaCBj\nbGFzcwogICAgICAgICAgICByb3AgPSBudWxsOwogICAgICAgICAgICBpZiAo\ncm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHJvcHNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIFNlbGVjdCBz\nZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgICAgICAgICAgICAgIHNl\nbC5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgQml0U2V0IHBh\nZ2VkID0gc2VsZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaV0sIGpmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJvcHNbaV0gPSBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQ\ncm92aWRlcihzZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBw\naW5nc1tpXSwgdGhpcywgamZldGNoKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBuZXcgUGFn\naW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCwgcGFnZWQs\nIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGlmIChyb3BzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiByb3BzWzBdOwogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3BzKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gcGVyZm9ybSBhIHVuaW9uIG9uIGFsbCBp\nbmRlcGVuZGVudCBjbGFzc2VzCiAgICAgICAgICAgIFVuaW9uIHVuaW9uID0g\nX3NxbC5uZXdVbmlvbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgICAgICB1\nbmlvbi5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgIGZpbmFsIEJpdFNldFtd\nIHBhZ2VkID0gbmV3IEJpdFNldFttYXBwaW5ncy5sZW5ndGhdOwogICAgICAg\nICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGlu\ndCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlZFtpZHhdID0gc2Vs\nZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaWR4XSwgamZldGNoLAogICAgICAg\nICAgICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyB1c2luZyBwYWdp\nbmcgcm9wIGlmIGFueSB1bmlvbiBlbGVtZW50IGhhcyBwYWdlZCBmaWVsZHMK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYWdlZC5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VkW2ldICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlcih1bmlvbiwgbWFwcGluZ3MsCiAgICAgICAgICAgICAg\nICAgICAgICAgIEpEQkNTdG9yZU1hbmFnZXIudGhpcywgamZldGNoLCBwYWdl\nZCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcih1bmlv\nbiwgbWFwcGluZ3NbMF0sIHRoaXMsCiAgICAgICAgICAgICAgICBqZmV0Y2gp\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBn\naXZlbiBtYXBwaW5nIGZvciB1c2UgaW4gYW4gZXh0ZW50LCByZXR1cm5pbmcg\ncGFnZWQgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldCBzZWxl\nY3RFeHRlbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBz\ndWJjbGFzc2VzKSB7CiAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3Nlcykg\nPyBTZWxlY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7CiAg\nICAgICAgLy8gZGVjaWRlIGJldHdlZW4gcGFnaW5nIGFuZCBzdGFuZGFyZCBp\ndGVyYXRpb24KICAgICAgICBCaXRTZXQgcGFnZWQgPSBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlci5nZXRQYWdlZEZpZWxkcyhzZWwsIG1hcHBpbmcsCiAg\nICAgICAgICAgIHRoaXMsIGZldGNoLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nLkVBR0VSX1BBUkFMTEVMLAogICAgICAgICAgICBMb25nLk1BWF9WQUxVRSk7\nCiAgICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgIHNlbC5z\nZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAog\nICAgICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9Q\nQVJBTExFTCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWwuc2VsZWN0\nSWRlbnRpZmllcihtYXBwaW5nLCBzdWJzLCB0aGlzLCBmZXRjaCwKICAgICAg\nICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7\nCiAgICAgICAgcmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIHB1YmxpYyBTdG9y\nZVF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIEV4\ncHJlc3Npb25QYXJzZXIgZXAgPSBRdWVyeUxhbmd1YWdlcy5wYXJzZXJGb3JM\nYW5ndWFnZShsYW5ndWFnZSk7CiAgICAgICAgaWYgKGVwICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgSkRCQ1N0b3JlUXVlcnkodGhpcywgZXAp\nOwogICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMo\nbGFuZ3VhZ2UpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNRTFN0b3JlUXVl\ncnkodGhpcyk7CiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfUFJF\nUEFSRURfU1FMLmVxdWFscyhsYW5ndWFnZSkpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgUHJlcGFyZWRTUUxTdG9yZVF1ZXJ5KHRoaXMpOwogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb24gbmV3RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBu\nZXcgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgIH0KCiAgICBw\ndWJsaWMgU2VxIGdldERhdGFTdG9yZUlkU2VxdWVuY2UoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVn\neSgpID09IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUKICAgICAgICAgICAgfHwg\nbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVz\nLk5PTkUpCiAgICAgICAgICAgIHJldHVybiBfY29uZi5nZXRTZXF1ZW5jZUlu\nc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVi\nbGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nY2xvc2UoKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwpCiAgICAgICAg\nICAgIF9jb25uLmZyZWUoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAg\nICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIENvbm5lY3QgdG8gdGhlIGRiLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgY29ubmVjdChib29sZWFuIHJlZikgewogICAgICAgIF9jdHgubG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbm5lY3QgaWYgdGhl\nIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IG51bGwsIG9yIGlmCiAgICAgICAg\nICAgIC8vIHRoZSBjb25uZWN0aW9uIGhhcyBiZWVuIGNsb3NlZCBvdXQgZnJv\nbSB1bmRlciB1cwogICAgICAgICAgICBpZiAoX2Nvbm4gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9jb25uID0gY29ubmVjdEludGVybmFsKCk7CiAgICAg\nICAgICAgIGlmIChyZWYpCiAgICAgICAgICAgICAgICBfY29ubi5yZWYoKTsK\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdCB0byB0\naGUgZGF0YWJhc2UuIFRoaXMgbWV0aG9kIGlzIHNlcGFyYXRlZCBvdXQgc28g\ndGhhdCBpdAogICAgICogY2FuIGJlIG92ZXJyaWRkZW4uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBSZWZDb3VudENvbm5lY3Rpb24gY29ubmVjdEludGVybmFs\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIENvbmNy\nZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UocmVmQ291bnRDb25uZWN0\naW9uSW1wbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBfZHMuZ2V0Q29ubmVj\ndGlvbigpKTsKICAgIH0KICAgIAogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0\nTmV3Q29ubmVjdGlvbigpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gY29ubmVjdEludGVybmFsKCk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9u\ncy5nZXRTdG9yZShlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogRmluZCB0aGUgb2JqZWN0IHdpdGggdGhlIGdpdmVuIG9pZC4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIFZh\nbHVlTWFwcGluZyB2bSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgT2JqZWN0IHBjID0gX2N0eC5maW5k\nKG9pZCwgZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgICAgIGlmIChwYyA9\nPSBudWxsICYmIHZtICE9IG51bGwpIHsKICAgICAgICAgICAgT3JwaGFuZWRL\nZXlBY3Rpb24gYWN0aW9uID0gX2NvbmYuZ2V0T3JwaGFuZWRLZXlBY3Rpb25J\nbnN0YW5jZSgpOwogICAgICAgICAgICBwYyA9IGFjdGlvbi5vcnBoYW4ob2lk\nLCBudWxsLCB2bSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYzsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIG9iamVjdCBpbiB0aGUgY3Vy\ncmVudCByb3cgb2YgdGhlIGdpdmVuIHJlc3VsdC4KICAgICAqLwogICAgcHVi\nbGljIE9iamVjdCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJpdFNldCBleGNsdWRl\nLCBSZXN1bHQgcmVzdWx0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoIW1hcHBpbmcuaXNNYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1t\nYXBwaW5nIiwgCiAgICAgICAgICAgICAgICBtYXBwaW5nKSk7CgogICAgICAg\nIC8vIGdldCB0aGUgb2JqZWN0IGlkIGZvciB0aGUgcm93OyBiYXNlIGNsYXNz\nIHNlbGVjdHMgcGsgY29sdW1ucwogICAgICAgIENsYXNzTWFwcGluZyBiYXNl\nID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBiYXNl\nID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAg\nICAgICBPYmplY3Qgb2lkID0gYmFzZS5nZXRPYmplY3RJZCh0aGlzLCByZXN1\nbHQsIG51bGwsIHRydWUsIG51bGwpOwogICAgICAgIGlmIChvaWQgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbm5lY3Rp\nb25JbmZvIGluZm8gPSBuZXcgQ29ubmVjdGlvbkluZm8oKTsKICAgICAgICBp\nbmZvLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICBpbmZvLm1hcHBpbmcgPSBt\nYXBwaW5nOwoKICAgICAgICAvLyBpZiBpbnZlcnNlIHJlbGF0aW9uIGlzIGtu\nb3duLCBleGNsdWRlIGxvYWRpbmcgZHVyaW5nIGZpbmQKICAgICAgICBleGNs\ndWRlID0gZXhjbHVkZUludmVyc2VSZWxhdGlvbihtYXBwaW5nLCBpbmZvLCBl\neGNsdWRlKTsKICAgICAgICByZXR1cm4gX2N0eC5maW5kKG9pZCwgZmV0Y2gs\nIGV4Y2x1ZGUsIGluZm8sIDApOwogICAgfQoKICAgIHByaXZhdGUgQml0U2V0\nIGV4Y2x1ZGVJbnZlcnNlUmVsYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nCiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbywgQml0U2V0IGV4Y2x1ZGUp\nIHsKICAgICAgICBGaWVsZE1hcHBpbmcgaW52ZXJzZSA9IGluZm8ucmVzdWx0\nLmdldE1hcHBlZEJ5RmllbGRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGludmVy\nc2UgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMg\nPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAg\nICAgIGlmIChleGNsdWRlID09IG51bGwpCiAgICAgICAgICAgICAgICBleGNs\ndWRlID0gbmV3IEJpdFNldChmbXMubGVuZ3RoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChmbXNbaV0gPT0gaW52ZXJzZSkgewogICAgICAgICAgICAg\nICAgICAgIGV4Y2x1ZGUuc2V0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhjbHVkZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIHN0YXRlIG1hbmFn\nZXIgd2l0aCBkYXRhIGZyb20gdGhlIHJlc3VsdCBzZXQuIE9ubHkKICAgICAq\nIG1hcHBpbmdzIG9yaWdpbmFsbHkgc2VsZWN0ZWQgd2lsbCBiZSBsb2FkZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2FkKENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFu\neSA9IGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMsIG51bGwpOwogICAg\nICAgIGlmIChlYWdlclRvTWFueSAhPSBudWxsKQogICAgICAgICAgICBlYWdl\nclRvTWFueS5sb2FkRWFnZXJKb2luKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJz\nZUpEQkMoZWFnZXJUb01hbnkpLAogICAgICAgICAgICAgICAgcmVzKTsKICAg\nICAgICBpZiAoX2FjdGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2Nr\naW5nKCkpCiAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwog\nICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBn\naXZlbiBtYXBwaW5nLiBSZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQK\nICAgICAqIHdpdGhvdXQgbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0\nZSBGaWVsZE1hcHBpbmcgbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJU\nb01hbnkpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykp\nCiAgICAgICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8g\nbG9hZCBzdXBlcmNsYXNzIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lv\nbgogICAgICAgIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJl\nbnQgIT0gbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBh\ncmVudCwgc20sIGZldGNoLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBl\nbHNlIGlmIChzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nbWFwcGluZy5nZXRWZXJzaW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAg\nICAgICAgLy8gbG9hZCB1bmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgT2JqZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoZm1zW2ldLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRl\nZCgpLmdldChmbXNbaV0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZv\nciBlYWdlciByZXN1bHQsIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFy\nZCBsb2FkCiAgICAgICAgICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ld\nKTsKICAgICAgICAgICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0g\ncmVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09\nIG51bGwgJiYgZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBm\nbXNbaV0ubG9hZEVhZ2VySm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAg\nICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdl\nclBhcmFsbGVsKHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0\nY2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChwcm9jZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAg\nICAgICAgICAgcmVzLnB1dEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGZtc1tp\nXS5sb2FkKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwg\ncmVzKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIHJlcy5lbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEZvciBpbXBsZW1lbnRhdGlvbiB1c2Ugb25seS4KICAgICAqIFJl\ndHVybiBhIHNlbGVjdCBmb3IgdGhlIHByb3BlciBtYXBwaW5ncy4gUmV0dXJu\nIG51bGwgaWYgbm8gc2VsZWN0IGlzCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRo\nb2QgaXMgZGVzaWduZWQgdG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGUgbG9h\nZCBtZXRob2RzLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRv\nIGJ1aWxkIG9uCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBm\nb3IgdGhlIGJhc2UgdHlwZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0g\nc3VicyB3aGV0aGVyIHRoZSBzZWxlY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFz\nc2VzIG9mIHRoZQogICAgICogZ2l2ZW4gbWFwcGluZwogICAgICogQHBhcmFt\nIHNtIHN0YXRlIG1hbmFnZXIgaWYgYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9h\nZGVkIG9yCiAgICAgKiBpbml0aWFsaXplZCwgZWxzZSBudWxsCiAgICAgKiBA\ncGFyYW0gZmllbGRzIGlmIGEgc3RhdGUgbWFuYWdlciBpcyBiZWluZyBsb2Fk\nZWQsIHRoZSBzZXQgb2YKICAgICAqIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9h\nZGVkIGluIG9yZGVyLCBlbHNlIG51bGwKICAgICAqIEBwYXJhbSBmZXRjaCB0\naGUgZmV0Y2ggY29uZmlndXJhdGlvbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBm\naWVsZHMKICAgICAqIG11c3QgYmUgbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNl\nbGVjdGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciBlYWdlciBm\nZXRjaCBtb2RlIHRvIHVzZQogICAgICogQHBhcmFtIGlkZW50IHdoZXRoZXIg\ndG8gc2VsZWN0IHByaW1hcnkga2V5IGNvbHVtbnMgYXMgZGlzdGluY3QKICAg\nICAqIGlkZW50aWZpZXJzCiAgICAgKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3\nZSdyZSBvdXRlci1qb2luaW5nIHRvIHRoaXMgdHlwZQogICAgICogQHJldHVy\nbiB0cnVlIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIGZhbHNlIG90aGVy\nd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyLCBi\nb29sZWFuIGlkZW50LCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gYWRk\nIGNsYXNzIGNvbmRpdGlvbnMgc28gdGhhdCB0aGV5J3JlIGNsb25lZCBmb3Ig\nYW55IGJhdGNoZWQgc2VsZWN0cwogICAgICAgIGJvb2xlYW4gam9pbmVkU3Vw\nZXJzID0gZmFsc2U7ICAgIAogICAgICAgIGlmKG5lZWRDbGFzc0NvbmRpdGlv\nbihtYXBwaW5nLCBzdWJzLCBzbSkpIHsKICAgICAgICAgICAgam9pbmVkU3Vw\nZXJzID0gZ2V0Sm9pbmVkU3VwZXJzKHNlbCwgbWFwcGluZywgc3Vicywgb3V0\nZXIpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjcmVhdGUgYWxs\nIG91ciBlYWdlciBzZWxlY3RzIHNvIHRoYXQgdGhvc2UgZmllbGRzIGFyZSBy\nZXNlcnZlZAogICAgICAgIC8vIGFuZCBjYW5ub3QgYmUgcmV1c2VkIGR1cmlu\nZyB0aGUgYWN0dWFsIGVhZ2VyIHNlbGVjdCBwcm9jZXNzLAogICAgICAgIC8v\nIHByZXZlbnRpbmcgaW5maW5pdGUgcmVjdXJzaW9uCiAgICAgICAgZWFnZXIg\nPSBNYXRoLm1pbihlYWdlciwgZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUoKSk7\nCiAgICAgICAgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFn\nZXJTZWxlY3RzKHNlbCwgbWFwcGluZywgc20sIGZpZWxkcywKICAgICAgICAg\nICAgZmV0Y2gsIGVhZ2VyKTsKCiAgICAgICAgLy8gc2VsZWN0IGFsbCBiYXNl\nIGNsYXNzIG1hcHBpbmdzOyBkbyB0aGlzIGFmdGVyIGJhdGNoaW5nIHNvIHRo\nYXQKICAgICAgICAvLyB0aGUgam9pbnMgbmVlZGVkIGJ5IHRoZXNlIHNlbGVj\ndHMgZG9uJ3QgZ2V0IGluIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICAvLyBv\nZiB0aGUgYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAgaW50IHNlbGQgPSBzZWxl\nY3RCYXNlTWFwcGluZ3Moc2VsLCBtYXBwaW5nLCBtYXBwaW5nLCBzbSwgZmll\nbGRzLAogICAgICAgICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBp\nZGVudCwgam9pbmVkU3VwZXJzKTsKCiAgICAgICAgLy8gc2VsZWN0IGVhZ2Vy\nIHRvLW1hbnkgcmVsYXRpb25zIGxhc3QgYmVjYXVzZSBkdXJpbmcgbG9hZCB0\naGV5CiAgICAgICAgLy8gYWR2YW5jZSB0aGUgcmVzdWx0IHNldCBhbmQgY291\nbGQgZXhoYXVzdCBpdCwgc28gbm8gb3RoZXIgbWFwcGluZ3MKICAgICAgICAv\nLyBjYW4gbG9hZCBhZnRlcndvcmRzCiAgICAgICAgaWYgKGVhZ2VyVG9NYW55\nICE9IG51bGwpCiAgICAgICAgICAgIGVhZ2VyVG9NYW55LnNlbGVjdEVhZ2Vy\nSm9pbihzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIGZldGNoLnRy\nYXZlcnNlSkRCQyhlYWdlclRvTWFueSksIGVhZ2VyKTsKCiAgICAgICAgLy8g\nb3B0aW9uYWxseSBzZWxlY3Qgc3ViY2xhc3MgbWFwcGluZ3MKICAgICAgICBp\nZiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJzID09IFNl\nbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSkKICAgICAgICAgICAgc2VsZWN0U3Vi\nY2xhc3NNYXBwaW5ncyhzZWwsIG1hcHBpbmcsIHNtLCBmZXRjaCk7CiAgICAg\nICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5zZXREaXN0aW5j\ndChmYWxzZSk7CiAgICAgICAgcmV0dXJuIHNlbGQgPiAwOwogICAgfQoKICAg\nIHByaXZhdGUgYm9vbGVhbiBnZXRKb2luZWRTdXBlcnMoU2VsZWN0IHNlbCwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLCBib29sZWFuIG91dGVy\nKSB7CiAgICAgICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7IAogICAgICAg\nIEpvaW5zIGpvaW5zID0gKG91dGVyKSA/IHNlbC5uZXdPdXRlckpvaW5zKCkg\nOiBudWxsOwogICAgICAgIHJldHVybiBtYXBwaW5nLmdldERpc2NyaW1pbmF0\nb3IoKS5hZGRDbGFzc0NvbmRpdGlvbnMoc2VsLCBzdWJzID09IFNlbGVjdC5T\nVUJTX0pPSU5BQkxFLCBqb2lucyk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\nYm9vbGVhbiBuZWVkQ2xhc3NDb25kaXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20p\nIHsKICAgICAgICBib29sZWFuIHJldFZhbCA9IGZhbHNlOwogICAgICAgIGlm\nKHNtID09IG51bGwgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJB\nTlNJRU5UKSB7CiAgICAgICAgICAgIGlmKHN1YnMgPT0gU2VsZWN0LlNVQlNf\nSk9JTkFCTEUgfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSB7CiAgICAg\nICAgICAgICAgICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0\nRGlzY3JpbWluYXRvcigpICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAm\nJiBTdXBlcmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNsYXNzLmlzSW5z\ndGFuY2UobWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0U3RyYXRlZ3ko\nKSkKICAgICAgICAgICAgICAgICAgICAmJiBtYXBwaW5nLmdldE1hcHBpbmdS\nZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxp\ndHlJbnN0YW5jZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTdXBl\ncmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5QnlEZWZhdWx0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICByZXRWYWwgPSB0cnVlOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXRWYWw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogTWFyayB0aGUgZmll\nbGRzIG9mIHRoaXMgbWFwcGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2Vy\nIGZldGNoZXMgY2FuJ3QKICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vy\nc2l2ZSBzaXR1YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFw\ncGluZyBjcmVhdGVFYWdlclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nQml0U2V0IGZpZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwK\nICAgICAgICBpbnQgZWFnZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBu\ndWxsIHx8IGVhZ2VyID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJf\nTk9ORSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxk\nTWFwcGluZyBlYWdlclRvTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWws\nIAogICAgICAgICAgICBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpLCBzbSwgZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAg\nICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVs\nZE1hcHBpbmdzKCk7CiAgICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNl\nbC5oYXNFYWdlckpvaW4oZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAg\nICAgIGludCBqdHlwZTsKICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBtb2RlID0gZm1zW2ldLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAg\nICAgIGlmIChtb2RlID09IGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVj\ndChmbXNbaV0sIHNtLCBmaWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRo\nIGpvaW4gZmlyc3QKICAgICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51\nbGxWYWx1ZSgpID09IGZtc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAg\nICAgICAgICA/IHNlbC5FQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsK\nICAgICAgICAgICAgaWYgKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwg\nJiYgIWZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAg\nICAgICYmIGZtc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwg\ndGhpcywgZmV0Y2gpID4gMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2Vy\nQ2xvbmUoZm1zW2ldLCBqdHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFz\nSm9pbiA9IGZldGNoLmhhc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNl\nKSk7CgogICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBw\ncmVmZXJyZWQgc2VsZWN0IG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAg\nICAgICAgICAvLyBoYXZlIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRv\naW5nIGEgYnktaWQgbG9va3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNl\nIGEgdG8tbWFueSBqb2luIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFn\nZXIKICAgICAgICAgICAgLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9u\nLXJhbmdlZCBzZWxlY3RzIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAg\nICAvLyBoYXZlIGFuIGVhZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBp\nZiAoKGhhc0pvaW4gfHwgbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAg\nICAgICAgICAgICAgfHwgKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAh\nPSBudWxsKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2Vs\nZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgog\nICAgICAgICAgICAgICAgJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAg\nICAgICAgICAgICAgICYmICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICgh\nc2VsLmlzTFJTKCkKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydElu\nZGV4KCkgPT0gMCAKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRl\neCgpID09IExvbmcuTUFYX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZt\nc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0\nY2gpID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25l\nKGZtc1tpXSwganR5cGUsIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAog\nICAgICAgICAgICBpZiAoZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwK\nICAgICAgICAgICAgICAgICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2Vs\nZWN0KHNlbCwgc2VsLkVBR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAg\nICAgIHRoaXMsIGZldGNoKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5l\nYWdlckNsb25lKGZtc1tpXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAg\nICAgICAgICAgICAgICAgICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgp\nLCBzZWxzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55\nOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZl\nbiBmaWVsZCBuZWVkcyB0byBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBp\nbmcgZm0sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0\nIGZpZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAg\nICAgIGlmIChmaWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZp\nZWxkcy5nZXQoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51\nbGwgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAg\nICAgICAgICAgICYmIHNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgp\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBm\nZXRjaC5yZXF1aXJlc0ZldGNoKGZtKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24u\nRkVUQ0hfTE9BRDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUg\nZmllbGQgbWFwcGluZ3Mgb2YgdGhlIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRz\nIHN1cGVyY2xhc3Nlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBz\nZWxlY3QgdG8gdXNlCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbW9zdC1k\nZXJpdmVkIHR5cGUgdG8gc2VsZWN0IGZvcgogICAgICogQHBhcmFtIG9yaWcg\ndGhlIG9yaWdpbmFsIG1hcHBpbmcgdHlwZSBzZWxlY3RlZAogICAgICogQHBh\ncmFtIHNtIHRoZSBpbnN0YW5jZSBiZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51\nbGwgaWYgbm9uZQogICAgICogQHBhcmFtIGZpZWxkcyB0aGUgZmllbGRzIHRv\nIGxvYWQKICAgICAqIEBwYXJhbSBmZXRjaCBmZXRjaCBjb25maWd1cmF0aW9u\nIHRvIHVzZSBmb3IgbG9hZGluZyByZWxhdGlvbnMKICAgICAqIEBwYXJhbSBl\nYWdlciB0aGUgZWFnZXIgZmV0Y2ggbW9kZSB0byB1c2UKICAgICAqIEBwYXJh\nbSBqb2luZWQgd2hldGhlciB0aGUgY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBq\nb2luZWQgZG93biB0bwogICAgICogaXRzIGJhc2UgY2xhc3MKICAgICAqIEBy\nZXR1cm4gJmd0OyAwIGlmIHRoZSBzZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYg\nZGF0YSB3YXMKICAgICAqIHNlbGVjdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQs\nIGFuZCAmbHQ7IDAgaWYgbm90aGluZyB3YXMgc2VsZWN0ZWQKICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgc2VsZWN0QmFzZU1hcHBpbmdzKFNlbGVjdCBzZWws\nIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIENsYXNzTWFwcGluZyBv\ncmlnLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdl\nciwgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55LAogICAgICAgIGJvb2xlYW4g\naWRlbnQsIGJvb2xlYW4gam9pbmVkKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHBhcmVudCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgaWYgKHBhcmVudCA9PSBudWxsICYmICFtYXBwaW5n\nLmlzTWFwcGVkKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQoInZpcnR1YWwtbWFwcGluZyIsIG1hcHBp\nbmcuCiAgICAgICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkpKTsKCiAg\nICAgICAgaW50IHNlbGQgPSAtMTsKICAgICAgICBpbnQgcHNlbGQgPSAtMTsK\nCiAgICAgICAgLy8gYmFzZSBjbGFzcyBzZWxlY3RzIHBrcywgZXRjCiAgICAg\nICAgaWYgKHBhcmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5v\nIGluc3RhbmNlLCBzZWxlY3QgcGtzCiAgICAgICAgICAgIGlmIChzbSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoaWRlbnQpCiAgICAgICAgICAg\nICAgICAgICAgc2VsLnNlbGVjdElkZW50aWZpZXIobWFwcGluZy5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKSk7CiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90\nIGluaXRpYWxpemVkIGFuZCBub3QgZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQog\nICAgICAgICAgICBpZiAoKHNtID09IG51bGwgfHwgKHNtLmdldFBDU3RhdGUo\nKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgICAgICYmICgh\nKHNtLmdldE9iamVjdElkKCkgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIAogICAg\nICAgICAgICAgICAgfHwgKChPcGVuSlBBSWQpIHNtLmdldE9iamVjdElkKCkp\nLmhhc1N1YmNsYXNzZXMoKSkpKQogICAgICAgICAgICAgICAgJiYgbWFwcGlu\nZy5nZXREaXNjcmltaW5hdG9yKCkuc2VsZWN0KHNlbCwgb3JpZykpCiAgICAg\nICAgICAgICAgICBzZWxkID0gMTsKCiAgICAgICAgICAgIC8vIGlmIG5vIGlu\nc3RhbmNlIG9yIG5vIHZlcnNpb24sIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAg\nICAgIGlmICgoc20gPT0gbnVsbCB8fCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNl\nbGVjdChzZWwsIG9yaWcpKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVjdXJzZSBvbiBwYXJl\nbnQKICAgICAgICAgICAgcHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2Vs\nLCBwYXJlbnQsIG9yaWcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBm\nZXRjaCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhl\nIGdpdmVuIGZpZWxkcyBzZXQsIG9yIGJhc2VkIG9uIGZldGNoCiAgICAgICAg\nLy8gY29uZmlndXJhdGlvbiBpZiBubyBmaWVsZHMgZ2l2ZW4KICAgICAgICBG\naWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1h\ncHBpbmdzKCk7CiAgICAgICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAg\nICBpbnQgZnNlbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gc2tpcCBlYWdlciB0by1t\nYW55IHNlbGVjdDsgd2UgZG8gdGhhdCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcK\nICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAgIGlmIChmbXNbaV0g\nPT0gZWFnZXJUb01hbnkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIC8vIGNoZWNrIGZvciBlYWdlciBzZWxlY3QKICAgICAgICAg\nICAgZXNlbCA9IHNlbC5nZXRFYWdlcihmbXNbaV0pOwogICAgICAgICAgICBp\nZiAoZXNlbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZXNlbCA9\nPSBzZWwpCiAgICAgICAgICAgICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2Vy\nSm9pbihzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0\nY2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFn\nZXJQYXJhbGxlbChlc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAg\nICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAg\nICAgICAgICAgICBzZWxkID0gTWF0aC5tYXgoMCwgc2VsZCk7CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAocmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmll\nbGRzLCBmZXRjaCkpIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ld\nLnNlbGVjdChzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRj\naC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAg\nICAgc2VsZCA9IE1hdGgubWF4KGZzZWxkLCBzZWxkKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChvcHRTZWxlY3QoZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkp\nIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWws\nIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpE\nQkMoZm1zW2ldKSwgZmV0Y2guRUFHRVJfTk9ORSk7CgogICAgICAgICAgICAg\nICAgLy8gZG9uJ3QgdXBncmFkZSBzZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVz\nZSBmaWVsZHMsIHNpbmNlCiAgICAgICAgICAgICAgICAvLyB0aGV5J3JlIG5v\ndCBpbiB0aGUgY2FsY3VsYXRlZCBmaWVsZCBzZXQKICAgICAgICAgICAgICAg\nIGlmIChmc2VsZCA+PSAwICYmIHNlbGQgPCAwKQogICAgICAgICAgICAgICAg\nICAgIHNlbGQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBpbiBjZXJ0YWluIGNpcmN1bXN0YW5jZXMgZm9yY2Ugam9pbiB0byBz\ndXBlcmNsYXNzIHRhYmxlIHRvIGF2b2lkCiAgICAgICAgLy8gU1FMIGdlbmVy\nYXRpb24gZXJyb3IuCiAgICAgICAgaWYgKCBlYWdlclRvTWFueSAhPSBudWxs\nICYmIHBzZWxkIDwgMCAmJiBzZWxkID4gMCAmJiAham9pbmVkCiAgICAgICAg\nICAgICAgICAmJiBwYXJlbnQgIT0gbnVsbCApIHsKICAgICAgICAgICAgRmll\nbGRNYXBwaW5nW10gcGZtcyA9IHBhcmVudC5nZXREZWZpbmVkRmllbGRNYXBw\naW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBmbXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwZm1zW2ldID09\nIGVhZ2VyVG9NYW55ICkgewogICAgICAgICAgICAgICAgICAgIHBzZWxkID0g\nMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAv\nLyBqb2luIHRvIHBhcmVudCB0YWJsZSBpZiB0aGUgcGFyZW50IC8gYW55IGFu\nY2VzdG9ycyBoYXZlIHNlbGVjdGVkCiAgICAgICAgLy8gYW55dGhpbmcKICAg\nICAgICBpZiAoIWpvaW5lZCAmJiBwc2VsZCA+PSAwICYmIHBhcmVudC5nZXRU\nYWJsZSgpICE9IG1hcHBpbmcuZ2V0VGFibGUoKSkKICAgICAgICAgICAgc2Vs\nLndoZXJlKG1hcHBpbmcuam9pblN1cGVyY2xhc3Moc2VsLm5ld0pvaW5zKCks\nIGZhbHNlKSk7CgogICAgICAgIC8vIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1\nZQogICAgICAgIHJldHVybiBNYXRoLm1heChwc2VsZCwgc2VsZCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGVuIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNw\nZWNpYWwgY2FzZSBpcyBtYWRlIGZvciBtYXBwaW5ncyB0aGF0IHVzZQogICAg\nICogMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QgZXhwbGljaXRseSAqbm90\nKiBpbiB0aGUgZGZnIHNvIHRoYXQgdGhleQogICAgICogY2FuIGdldCB0aGVp\nciBwcmltYXJ5IHRhYmxlIGRhdGEuIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0\naGF0IHNwZWNpYWwKICAgICAqIGNhc2UgYXMgYW4gb3B0aW1pemF0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFw\ncGluZyBmbSwgU2VsZWN0IHNlbCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgcmV0dXJuICFmbS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAg\nICAgICAgJiYgIWZtLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpCiAg\nICAgICAgICAgICYmIChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9\nPSBQQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAgICAgfHwgIXNtLmdldExv\nYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgJiYgZm0u\nc3VwcG9ydHNTZWxlY3Qoc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRo\naXMsIGZldGNoKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3Qg\nZmllbGQgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29u\nZmlndXJhdGlvbiBmb3IKICAgICAqIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVu\nIHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRv\nIHVzZQogICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3Vi\nY2xhc3NlcyB0byBzZWxlY3QKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFu\nY2UgYmVpbmcgc2VsZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAq\nIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxl\nY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nKSB7CiAgICAgICAgbG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5nLmdldEpvaW5h\nYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBp\nbmdzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIHNlbGVjdCBhbGwgc3ViY2xhc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0\naGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIC8vIGFuZCB3aG9zZSB0\nYWJsZSBpcyBpbiB0aGUgbGlzdCBvZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7\nIHRoaXMKICAgICAgICAvLyB3YXkgd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2li\nbGUgd2l0aG91dCBzZWxlY3RpbmcgYW55IHRhYmxlcyB0aGF0CiAgICAgICAg\nLy8gYXJlbid0IHByZXNlbnQgaW4gYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNo\nZXM7IGEgc3BlY2lhbCBjYXNlCiAgICAgICAgLy8gaXMgbWFkZSBmb3IgbWFw\ncGluZ3MgdGhhdCB1c2UgMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAg\nICAgICAvLyBleHBsaWNpdGx5ICpub3QqIGluIHRoZSBkZWZhdWx0IHNvIHRo\nYXQgdGhleSBjYW4gZ2V0IHRoZWlyCiAgICAgICAgLy8gcHJpbWFyeSB0YWJs\nZSBkYXRhCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zOwogICAgICAgIGJv\nb2xlYW4gam9pbmVkOwogICAgICAgIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0\nLmpvaW5TeW50YXggIT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05B\nTAogICAgICAgICAgICAmJiBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZSht\nYXBwaW5nKSAhPSBmZXRjaC5FQUdFUl9OT05FOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgc3ViTWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKCFzdWJNYXBwaW5nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0\nKHNlbCwgc20sIHRoaXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICBmZXRj\naCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8v\nIGluaXRpYWxpemUgc28gdGhhdCBpZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0\nZW5kIHdlIGFscmVhZHkgaGF2ZQogICAgICAgICAgICBqb2luZWQgPSAhY2Fu\nSm9pbjsKICAgICAgICAgICAgZm1zID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVm\naW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9\nIDA7IGogPCBmbXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIC8v\nIG1ha2Ugc3VyZSBpbiBvbmUgb2YgY29uZmlndXJlZCBmZXRjaCBncm91cHMK\nICAgICAgICAgICAgCWlmIChmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkg\nIT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX0xPQUQKICAgICAgICAgICAg\nICAgICAgICAmJiAoKCFmbXNbal0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkg\nCiAgICAgICAgICAgICAgICAgICAgJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNo\nR3JvdXBFeHBsaWNpdCgpKQogICAgICAgICAgICAgICAgICAgIHx8IGZtc1tq\nXS5zdXBwb3J0c1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwg\ndGhpcywgCiAgICAgICAgICAgICAgICAgICAgZmV0Y2gpIDw9IDApKSAKICAg\nICAgICAgICAgCQljb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3\nZSBjYW4gam9pbiB0byB0aGUgc3ViY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRl\nciBjaGFuY2UKICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdp\nbGwgYmUgYWJsZSB0byBzZWxlY3QgaXRzZWxmIHdpdGhvdXQgam9pbnMKICAg\nICAgICAgICAgICAgIGlmICgham9pbmVkKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gbWFyayBqb2luZWQgd2hldGhlciBvciBub3Qgd2Ugam9pbiwgc28g\nd2UgZG9uJ3QgaGF2ZSB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRlc3Qg\nY29uZGl0aW9ucyBhZ2FpbiBmb3IgdGhpcyBzdWJjbGFzcwogICAgICAgICAg\nICAgICAgICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAg\nc2VsLndoZXJlKGpvaW5TdWJjbGFzcyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBp\nbmdzW2ldLCBudWxsKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgLy8gaWYgY2FuIHNlbGVjdCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNl\nbGVjdGVkLCBkbyBpdAogICAgICAgICAgICAgICAgaWYgKGZtc1tqXS5zdXBw\nb3J0c1NlbGVjdChzZWwsIHNlbC5UWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywK\nICAgICAgICAgICAgICAgICAgICBmZXRjaCkgPiAwKQogICAgICAgICAgICAg\nICAgICAgIGZtc1tqXS5zZWxlY3Qoc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50\ncmF2ZXJzZUpEQkMoZm1zW2pdKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nZmV0Y2guRUFHRVJfTk9ORSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJv\nbSBjbGFzcyB0byBpdHMgc3ViY2xhc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwog\nICAgICogZm9yIG11bHRpcGxlIGhvcHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJh\nc2UgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEpvaW5zIGpv\naW5TdWJjbGFzcyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgYmFzZSwKICAg\nICAgICBDbGFzc01hcHBpbmcgc3ViLCBKb2lucyBqb2lucykgewogICAgICAg\nIGlmIChzdWIgPT0gYmFzZSB8fCBzdWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdl\ndFRhYmxlKCkKICAgICAgICAgICAgfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdl\ndFRhYmxlKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nLy8gcmVjdXJzZSBmaXJzdCBzbyB3ZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVk\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBqb2lucyA9IGpvaW5TdWJj\nbGFzcyhzZWwsIGJhc2UsIHN1cCwgam9pbnMpOwogICAgICAgIGlmIChqb2lu\ncyA9PSBudWxsKQogICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygp\nOwogICAgICAgIHJldHVybiBzdWIuam9pblN1cGVyY2xhc3Moam9pbnMsIHRy\ndWUpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgc3VyZSBhbGwgc3Vi\nY2xhc3NlcyBvZiB0aGUgZ2l2ZW4gdHlwZSBhcmUgbG9hZGVkIGluIHRoZSBK\nVk0uCiAgICAgKiBUaGlzIGlzIHVzdWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFz\nc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIERpc2NyaW1pbmF0b3IgZHNj\nID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCk7CiAgICAgICAgaWYgKGRz\nYy5nZXRTdWJjbGFzc2VzTG9hZGVkKCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gaWYgdGhlIHN1YmNsYXNzIGxpc3QgaXMgc2V0LCBubyBu\nZWVkIHRvIGxvYWQgc3VicwogICAgICAgIGlmIChtYXBwaW5nLmdldFJlcG9z\naXRvcnkoKS5nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLAogICAgICAg\nICAgICBfY3R4LmdldENsYXNzTG9hZGVyKCkpICE9IG51bGwpIHsKICAgICAg\nICAgICAgZHNjLnNldFN1YmNsYXNzZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGRzYy5sb2FkU3ViY2xhc3Nlcyh0aGlzKTsKICAgICAgICB9IGNhdGNo\nIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogTWFrZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlk\nYXRlIGZvciBjYW5jZWxsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KFN0YXRlbWVudCBzdG1udCkgewog\nICAgICAgIF9zdG1udHMuYWRkKHN0bW50KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSB0aGUgc3RhdGVtZW50IGZyb20gdGhlIGNhbmNlbGxhYmxl\nIHNldC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0\nYXRlbWVudChTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLnJl\nbW92ZShzdG1udCk7CiAgICB9CiAgICAKICAgIEZpbmRlclF1ZXJ5SW1wbCBn\nZXRGaW5kZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkgewogICAgICAgIEZpbmRlckNhY2hlIGNhY2hlID0gZ2V0\nRmluZGVyQ2FjaGUoKTsKICAgICAgICByZXR1cm4gY2FjaGUgPT0gbnVsbCAK\nICAgICAgICAgICAgID8gbnVsbCA6IChGaW5kZXJRdWVyeUltcGwpY2FjaGUu\nZ2V0KG1hcHBpbmcsIGZldGNoKTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBj\nYWNoZUZpbmRlcihDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0RXhlY3V0\nb3Igc2VsZWN0LCAKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gp\nIHsKICAgICAgICBGaW5kZXJDYWNoZSBjYWNoZSA9IGdldEZpbmRlckNhY2hl\nKCk7CiAgICAgICAgcmV0dXJuIGNhY2hlICE9IG51bGwgJiYgY2FjaGUuY2Fj\naGUobWFwcGluZywgc2VsZWN0LCBmZXRjaCkgIT0gbnVsbDsKICAgIH0KICAg\nIAogICAgRmluZGVyQ2FjaGUgZ2V0RmluZGVyQ2FjaGUoKSB7CiAgICAgICAg\ncmV0dXJuICgoKEJyb2tlckltcGwpZ2V0Q29udGV4dCgpKS5nZXRDYWNoZUZp\nbmRlclF1ZXJ5KCkpCiAgICAgICAgICAgICA/IGdldENvbmZpZ3VyYXRpb24o\nKS5nZXRGaW5kZXJDYWNoZUluc3RhbmNlKCkgOiBudWxsOwogICAgfQoKCiAg\nICAvKioKICAgICAqIENvbm5lY3Rpb24gcmV0dXJuZWQgdG8gY2xpZW50IGNv\nZGUuIE1ha2VzIHN1cmUgaXRzIHdyYXBwZWQgY29ubmVjdGlvbgogICAgICog\ncmVmIGNvdW50IGlzIGRlY3JlbWVudGVkIG9uIGZpbmFsaXplLgogICAgICov\nCiAgICBwdWJsaWMgYWJzdHJhY3Qgc3RhdGljIGNsYXNzIENsaWVudENvbm5l\nY3Rpb24gZXh0ZW5kcwogICAgICAgICAgICBEZWxlZ2F0aW5nQ29ubmVjdGlv\nbiB7CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7\nCgogICAgICAgIHB1YmxpYyBDbGllbnRDb25uZWN0aW9uKENvbm5lY3Rpb24g\nY29ubikgewogICAgICAgICAgICBzdXBlcihjb25uKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBz\ndXBlci5jbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZv\naWQgZmluYWxpemUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgaWYgKCFfY2xvc2VkKQogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHdyYXBw\nZXIgdGhhdCBrZWVwcyBhbiBpbnRlcm5hbCByZWYgY291bnQgc28gdGhhdCBp\ndCBrbm93cwogICAgICogd2hlbiB0byByZWFsbHkgY2xvc2UuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBhYnN0cmFjdCBjbGFzcyBSZWZDb3VudENvbm5lY3Rp\nb24gZXh0ZW5kcyBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHBy\naXZhdGUgYm9vbGVhbiBfcmV0YWluID0gZmFsc2U7CiAgICAgICAgcHJpdmF0\nZSBpbnQgX3JlZnMgPSAwOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfZnJl\nZWQgPSBmYWxzZTsKCiAgICAgICAgcHVibGljIFJlZkNvdW50Q29ubmVjdGlv\nbihDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW4o\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcmV0YWluOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgc2V0UmV0YWluKGJvb2xlYW4gcmV0YWluKSB7\nCiAgICAgICAgICAgIGlmIChfcmV0YWluICYmICFyZXRhaW4gJiYgX3JlZnMg\nPD0gMCkKICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgX3Jl\ndGFpbiA9IHJldGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHJlZigpIHsKICAgICAgICAgICAgLy8gZG9uJ3QgaGF2ZSB0byBsb2NrOyBj\nYWxsZWQgZnJvbSBjb25uZWN0KCksIHdoaWNoIGlzIGxvY2tlZAogICAgICAg\nICAgICBfcmVmcysrOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8g\nbG9jayBhdCBicm9rZXIgbGV2ZWwgdG8gYXZvaWQgZGVhZGxvY2tzCiAgICAg\nICAgICAgIF9jdHgubG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgX3JlZnMtLTsKICAgICAgICAgICAgICAgIGlmIChfcmVmcyA8\nPSAwICYmICFfcmV0YWluKQogICAgICAgICAgICAgICAgICAgIGZyZWUoKTsK\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9jdHgu\ndW5sb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGZyZWUoKSB7CiAgICAgICAgICAgIC8vIGVuc3VyZSB0aGF0\nIHdlIGRvIG5vdCBjbG9zZSB0aGUgdW5kZXJseWluZyBjb25uZWN0aW9uCiAg\nICAgICAgICAgIC8vIG11bHRpcGxlIHRpbWVzOyB0aGlzIGNvdWxkIGhhcHBl\nbiBpZiBzb21lb25lIChlLmcuLCBhbgogICAgICAgICAgICAvLyBFeHRlbnQp\nIGhvbGRzIGEgUmVmQ29ubmVjdGlvbiwgYW5kIHRoZW4gY2xvc2VzIGl0IChl\nLmcuLCBpbgogICAgICAgICAgICAvLyB0aGUgZmluYWxpemVyKSBhZnRlciB0\naGUgU3RvcmVNYW5hZ2VyIGhhcyBhbHJlYWR5IGJlZW4gY2xvc2VkLgogICAg\nICAgICAgICBpZiAoX2ZyZWVkKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdldERlbGVnYXRl\nKCkuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2ZyZWVkID0gdHJ1\nZTsKICAgICAgICAgICAgX2Nvbm4gPSBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoYm9vbGVh\nbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0\ndXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UoY2FuY2Vs\nU3RhdGVtZW50SW1wbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLAogICAgICAg\nICAgICAgICAgICAgIHN1cGVyLmNyZWF0ZVN0YXRlbWVudChmYWxzZSksIFJl\nZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCByc1R5cGUs\nIGludCByc0NvbmN1ciwKICAgICAgICAgICAgYm9vbGVhbiB3cmFwKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIENvbmNyZXRl\nQ2xhc3NHZW5lcmF0b3IubmV3SW5zdGFuY2UoY2FuY2VsU3RhdGVtZW50SW1w\nbCwgSkRCQ1N0b3JlTWFuYWdlci50aGlzLAogICAgICAgICAgICAgICAgICAg\nIHN1cGVyLmNyZWF0ZVN0YXRlbWVudChyc1R5cGUsIHJzQ29uY3VyLCBmYWxz\nZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAg\nICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVt\nZW50KFN0cmluZyBzcWwsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0\nZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFByZXBhcmVkU3Rh\ndGVtZW50SW1wbCwKICAgICAgICAgICAgICAgICAgICBKREJDU3RvcmVNYW5h\nZ2VyLnRoaXMsIHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLCBmYWxzZSks\nIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAg\nIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50\nKFN0cmluZyBzcWwsIGludCByc1R5cGUsCiAgICAgICAgICAgIGludCByc0Nv\nbmN1ciwgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIENvbmNyZXRlQ2xhc3NHZW5lcmF0b3IubmV3SW5z\ndGFuY2UKICAgICAgICAgICAgICAgIChjYW5jZWxQcmVwYXJlZFN0YXRlbWVu\ndEltcGwsCiAgICAgICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci50\naGlzLCBzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgcnNUeXBlLCByc0Nv\nbmN1ciwgZmFsc2UpLAogICAgICAgICAgICAgICAgICAgIFJlZkNvdW50Q29u\nbmVjdGlvbi50aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJlbW92ZXMgaXRzZWxm\nIGZyb20gdGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0YXRlbWVudHMgc28g\ndGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBhYnN0cmFjdCBjbGFzcyBDYW5jZWxTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxl\nZ2F0aW5nU3RhdGVtZW50IHsKCiAgICAgICAgcHVibGljIENhbmNlbFN0YXRl\nbWVudChTdGF0ZW1lbnQgc3RtbnQsIENvbm5lY3Rpb24gY29ubikgewogICAg\nICAgICAgICBzdXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGV4ZWN1dGVVcGRhdGUoU3RyaW5nIHNxbCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0\nZW1lbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3Rh\ndGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3Fs\nLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmV4ZWN1dGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50\nKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVz\nIGl0c2VsZiBmcm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1l\nbnRzIHNvIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgYWJzdHJhY3QgY2xhc3MgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1l\nbnQgZXh0ZW5kcwogICAgICAgICAgICBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0\nZW1lbnQgewoKICAgICAgICBwdWJsaWMgQ2FuY2VsUHJlcGFyZWRTdGF0ZW1l\nbnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgICAgICBDb25u\nZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIoc3RtbnQsIGNvbm4p\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBleGVjdXRlVXBkYXRl\nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4\nZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZSgpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVj\ndXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShib29s\nZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBi\nZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVRdWVyeSh3\ncmFwKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGludFtdIGV4ZWN1dGVCYXRjaCgp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVj\ndXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVCYXRjaCgpOwogICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRl\nU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQp9Cgo=\n","encoding":"base64"}

