{"sha":"716961df71f471aa5176e1c95ef56ae34e4470b1","node_id":"MDQ6QmxvYjIwNjM2NDo3MTY5NjFkZjcxZjQ3MWFhNTE3NmUxYzk1ZWY1NmFlMzRlNDQ3MGIx","size":43248,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/716961df71f471aa5176e1c95ef56ae34e4470b1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuRXhwQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5leHBzLkdldENvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNFeHByZXNzaW9uRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkpEQkNTdHJpbmdDb250YWluczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNXaWxkY2FyZE1hdGNoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUENQYXRoOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUXVl\ncnlFeHByZXNzaW9uc1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLmV4cHMuU1FMRW1iZWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TUUxFeHByZXNzaW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU1FMVmFs\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhw\ncy5WYWw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdElt\ncGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuVW5pb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkV4cHJlc3Npb25T\ndG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5G\naWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVu\nSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5PcmRlcmluZ01lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUhpbnRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkNvbnN0YW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkNvbnRleHQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVz\nc2lvbkZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5NZXJnZWRSZXN1\nbHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIucm9wLlJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRPYmplY3RQcm92aWRlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEpE\nQkMgcXVlcnkgaW1wbGVtZW50YXRpb24uCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKREJDU3RvcmVR\ndWVyeSAKICAgIGV4dGVuZHMgRXhwcmVzc2lvblN0b3JlUXVlcnkgewoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFRhYmxlIElOVkFMSUQgPSBuZXcgVGFi\nbGUoKTsKCiAgICAvLyBhZGQgYWxsIHN0YW5kYXJkIGZpbHRlciBhbmQgYWdn\ncmVnYXRlIGxpc3RlbmVycyB0byB0aGVzZSBtYXBzCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBNYXAgX2xpc3RlbmVycyA9IG5ldyBIYXNoTWFwKCk7Cgog\nICAgc3RhdGljIHsKICAgICAgICAvLyBkZXByZWNhdGVkIGV4dGVuc2lvbnMK\nICAgICAgICBfbGlzdGVuZXJzLnB1dChKREJDU3RyaW5nQ29udGFpbnMuVEFH\nLCBuZXcgSkRCQ1N0cmluZ0NvbnRhaW5zKCkpOwogICAgICAgIF9saXN0ZW5l\ncnMucHV0KEpEQkNXaWxkY2FyZE1hdGNoLlRBRywgbmV3IEpEQkNXaWxkY2Fy\nZE1hdGNoKCkpOwogICAgICAgIF9saXN0ZW5lcnMucHV0KFNRTEV4cHJlc3Np\nb24uVEFHLCBuZXcgU1FMRXhwcmVzc2lvbigpKTsKICAgICAgICBfbGlzdGVu\nZXJzLnB1dChTUUxWYWx1ZS5UQUcsIG5ldyBTUUxWYWx1ZSgpKTsKCiAgICAg\nICAgLy8gamRiYy1zcGVjaWZpYyBleHRlbnNpb25zCiAgICAgICAgX2xpc3Rl\nbmVycy5wdXQoR2V0Q29sdW1uLlRBRywgbmV3IEdldENvbHVtbigpKTsKICAg\nICAgICBfbGlzdGVuZXJzLnB1dChTUUxFbWJlZC5UQUcsIG5ldyBTUUxFbWJl\nZCgpKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIHRyYW5zaWVudCBKREJD\nU3RvcmUgX3N0b3JlOwogICAgcHJpdmF0ZSBzdGF0aWMgVGhyZWFkTG9jYWxD\nb250ZXh0IGxvY2FsQ29udGV4dCA9IG5ldyBUaHJlYWRMb2NhbENvbnRleHQo\nKTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgc3RvcmUg\nbWFuYWdlci4KICAgICAqLwogICAgcHVibGljIEpEQkNTdG9yZVF1ZXJ5KEpE\nQkNTdG9yZSBzdG9yZSwgRXhwcmVzc2lvblBhcnNlciBwYXJzZXIpIHsKICAg\nICAgICBzdXBlcihwYXJzZXIpOwogICAgICAgIF9zdG9yZSA9IHN0b3JlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdG9yZS4KICAgICAq\nLwogICAgcHVibGljIEpEQkNTdG9yZSBnZXRTdG9yZSgpIHsKICAgICAgICBy\nZXR1cm4gX3N0b3JlOwogICAgfQoKICAgIHB1YmxpYyBGaWx0ZXJMaXN0ZW5l\nciBnZXRGaWx0ZXJMaXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAgICAgICAgcmV0\ndXJuIChGaWx0ZXJMaXN0ZW5lcikgX2xpc3RlbmVycy5nZXQodGFnKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld0NvbXBpbGF0aW9uS2V5KCkgewog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSAoSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbikgY3R4CiAgICAgICAgICAgIC5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKGZldGNoLmdldEpvaW5TeW50YXgoKSk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNEYXRhU3RvcmVFeGVjdXRpb24oKSB7CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURh\ndGFbXSBnZXRJbmRlcGVuZGVudEV4cHJlc3Npb25DYW5kaWRhdGVzKAogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YSwgYm9vbGVhbiBzdWJjbGFzc2VzKSB7\nCiAgICAgICAgaWYgKCFzdWJjbGFzc2VzKQogICAgICAgICAgICByZXR1cm4g\nbmV3IENsYXNzTWFwcGluZ1tdIHsgKENsYXNzTWFwcGluZykgbWV0YSB9Owog\nICAgICAgIHJldHVybiAoKENsYXNzTWFwcGluZykgbWV0YSkuZ2V0SW5kZXBl\nbmRlbnRBc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgRXhwcmVzc2lvbkZhY3RvcnkgZ2V0RXhwcmVzc2lvbkZhY3RvcnkoQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBKREJDRXhw\ncmVzc2lvbkZhY3RvcnkoKENsYXNzTWFwcGluZykgbWV0YSk7CiAgICB9CiAg\nICAKICAgIHByb3RlY3RlZCBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRl\nUXVlcnkoRXhlY3V0b3IgZXgsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBiYXNl\nLCBDbGFzc01ldGFEYXRhW10gbWV0YXMsIGJvb2xlYW4gc3ViY2xhc3NlcywK\nICAgICAgICBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLCBRdWVyeUV4cHJl\nc3Npb25zW10gZXhwcywgT2JqZWN0W10gcGFyYW1zLAogICAgICAgIFJhbmdl\nIHJhbmdlKSB7CiAgICAgICAgQ29udGV4dFtdIGN0eHMgPSBuZXcgQ29udGV4\ndFtleHBzLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBl\neHBzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjdHhzW2ldID0gZXhwc1tp\nXS5jdHgoKTsKICAgICAgICBsb2NhbENvbnRleHQuc2V0KGNsb25lKGN0eHMs\nIG51bGwpKTsKICAgICAgICBpZiAobWV0YXMubGVuZ3RoID4gMSAmJiBleHBz\nWzBdLmlzQWdncmVnYXRlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKExvY2FsaXplci5mb3JQYWNrYWdlKEpEQkNTdG9yZVF1ZXJ5\nLmNsYXNzKS4KICAgICAgICAgICAgICAgIGdldCgibXVsdC1tYXBwaW5nLWFn\nZ3JlZ2F0ZSIsIEFycmF5cy5hc0xpc3QobWV0YXMpKSk7CgogICAgICAgIENs\nYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0gKENsYXNzTWFwcGluZ1tdKSBtZXRh\nczsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0gKEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24pIAogICAgICAgICAgICBjdHguZ2V0RmV0\nY2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKGV4cHNbMF0uZmV0Y2hQ\nYXRocyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZldGNoLmFkZEZpZWxkcyhB\ncnJheXMuYXNMaXN0KGV4cHNbMF0uZmV0Y2hQYXRocykpOwogICAgICAgICAg\nICBmZXRjaC5hZGRKb2lucyhBcnJheXMuYXNMaXN0KGV4cHNbMF0uZmV0Y2hQ\nYXRocykpOwogICAgICAgIH0KICAgICAgICBpZiAoZXhwc1swXS5mZXRjaElu\nbmVyUGF0aHMgIT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2guYWRkRmV0Y2hJ\nbm5lckpvaW5zKEFycmF5cy5hc0xpc3QoZXhwc1swXS5mZXRjaElubmVyUGF0\naHMpKTsKCiAgICAgICAgaW50IGVhZ2VyID0gY2FsY3VsYXRlRWFnZXJNb2Rl\nKGV4cHNbMF0sIHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpOwogICAgICAgIGlu\ndCBzdWJjbGFzc01vZGUgPSBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZSgo\nQ2xhc3NNYXBwaW5nKSBiYXNlKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGlj\ndCA9IF9zdG9yZS5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBsb25nIHN0\nYXJ0ID0gKG1hcHBpbmdzLmxlbmd0aCA9PSAxICYmIGRpY3Quc3VwcG9ydHNT\nZWxlY3RTdGFydEluZGV4KSAKICAgICAgICAgICAgPyByYW5nZS5zdGFydCA6\nIDBMOwogICAgICAgIGxvbmcgZW5kID0gKGRpY3Quc3VwcG9ydHNTZWxlY3RF\nbmRJbmRleCkgPyByYW5nZS5lbmQgOiBMb25nLk1BWF9WQUxVRTsKCiAgICAg\nICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlW10gc3RhdGVzID0gbmV3IFF1ZXJ5\nRXhwcmVzc2lvbnNTdGF0ZVtleHBzLmxlbmd0aF07CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgc3RhdGVzW2ldID0gbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZSgpOwog\nICAgICAgICAgICBleHBzW2ldLnN0YXRlID0gc3RhdGVzW2ldOwogICAgICAg\nIH0KICAgICAgICBFeHBDb250ZXh0IGN0eCA9IG5ldyBFeHBDb250ZXh0KF9z\ndG9yZSwgcGFyYW1zLCBmZXRjaCk7CgogICAgICAgIC8vIGFkZCBzZWxlY3Rz\nIHdpdGggcG9wdWxhdGUgV0hFUkUgY29uZGl0aW9ucyB0byBsaXN0CiAgICAg\nICAgTGlzdCBzZWxzID0gbmV3IEFycmF5TGlzdChtYXBwaW5ncy5sZW5ndGgp\nOwogICAgICAgIExpc3Qgc2VsTWFwcGluZ3MgPSBuZXcgQXJyYXlMaXN0KG1h\ncHBpbmdzLmxlbmd0aCk7CiAgICAgICAgQml0U2V0IHN1YmNsYXNzQml0cyA9\nIG5ldyBCaXRTZXQoKTsKICAgICAgICBCaXRTZXQgbmV4dEJpdHMgPSBuZXcg\nQml0U2V0KCk7CiAgICAgICAgYm9vbGVhbiB1bmlvbmFibGUgPSBjcmVhdGVX\naGVyZVNlbGVjdHMoc2VscywgbWFwcGluZ3MsIHNlbE1hcHBpbmdzLAogICAg\nICAgICAgICBzdWJjbGFzc2VzLCBzdWJjbGFzc0JpdHMsIG5leHRCaXRzLCBm\nYWN0cywgZXhwcywgc3RhdGVzLCBjdHgsCiAgICAgICAgICAgIHN1YmNsYXNz\nTW9kZSkKICAgICAgICAgICAgJiYgc3ViY2xhc3NNb2RlID09IEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTgogICAgICAgICAgICAmJiBzdGFy\ndCA9PSAwCiAgICAgICAgICAgICYmIGVuZCA9PSBMb25nLk1BWF9WQUxVRTsK\nCiAgICAgICAgLy8gd2UgbWlnaHQgd2FudCB0byB1c2UgbHJzIHNldHRpbmdz\nIGlmIHdlIGNhbid0IHVzZSB0aGUgcmFuZ2UKICAgICAgICBpZiAoc2Vscy5z\naXplKCkgPiAxKQogICAgICAgICAgICBzdGFydCA9IDBMOwogICAgICAgIGJv\nb2xlYW4gbHJzID0gcmFuZ2UubHJzIHx8IChmZXRjaC5nZXRGZXRjaEJhdGNo\nU2l6ZSgpID49IDAgCiAgICAgICAgICAgICYmIChzdGFydCAhPSByYW5nZS5z\ndGFydCB8fCBlbmQgIT0gcmFuZ2UuZW5kKSk7CgogICAgICAgIFJlc3VsdE9i\namVjdFByb3ZpZGVyW10gcm9wcyA9IG51bGw7CiAgICAgICAgUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgcm9wID0gbnVsbDsKICAgICAgICBpZiAodW5pb25hYmxl\nKSB7CiAgICAgICAgICAgIFVuaW9uIHVuaW9uID0gX3N0b3JlLmdldFNRTEZh\nY3RvcnkoKS5uZXdVbmlvbigKICAgICAgICAgICAgICAgIChTZWxlY3RbXSkg\nc2Vscy50b0FycmF5KG5ldyBTZWxlY3Rbc2Vscy5zaXplKCldKSk7CiAgICAg\nICAgICAgIEJpdFNldFtdIHBhZ2VkID0gcG9wdWxhdGVVbmlvbih1bmlvbiwg\nbWFwcGluZ3MsIHN1YmNsYXNzZXMsIGZhY3RzLAogICAgICAgICAgICAgICAg\nZXhwcywgc3RhdGVzLCBjdHgsIGxycywgZWFnZXIsIHN0YXJ0LCBlbmQpOwog\nICAgICAgICAgICB1bmlvbi5zZXRMUlMobHJzKTsKICAgICAgICAgICAgcm9w\nID0gZXhlY3V0ZVVuaW9uKHVuaW9uLCBtYXBwaW5ncywgZXhwcywgc3RhdGVz\nLCBjdHgsIHBhZ2VkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBp\nZiAoc2Vscy5zaXplKCkgPiAxKQogICAgICAgICAgICAgICAgcm9wcyA9IG5l\ndyBSZXN1bHRPYmplY3RQcm92aWRlcltzZWxzLnNpemUoKV07CgogICAgICAg\nICAgICBTZWxlY3Qgc2VsOwogICAgICAgICAgICBCaXRTZXQgcGFnZWQ7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBpZHggPSAwOyBpIDwgc2Vscy5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgc2VsID0gKFNlbGVjdCkg\nc2Vscy5nZXQoaSk7CiAgICAgICAgICAgICAgICBwYWdlZCA9IHBvcHVsYXRl\nU2VsZWN0KHNlbCwgKENsYXNzTWFwcGluZykgc2VsTWFwcGluZ3MuZ2V0KGkp\nLAogICAgICAgICAgICAgICAgICAgIHN1YmNsYXNzQml0cy5nZXQoaSksIChK\nREJDRXhwcmVzc2lvbkZhY3RvcnkpIGZhY3RzW2lkeF0sCiAgICAgICAgICAg\nICAgICAgICAgZXhwc1tpZHhdLCBzdGF0ZXNbaWR4XSwgY3R4LCBscnMsIGVh\nZ2VyLCBzdGFydCwgZW5kKTsKCiAgICAgICAgICAgICAgICByb3AgPSBleGVj\ndXRlU2VsZWN0KHNlbCwgKENsYXNzTWFwcGluZykgc2VsTWFwcGluZ3MuZ2V0\nKGkpLAogICAgICAgICAgICAgICAgICAgIGV4cHNbaWR4XSwgc3RhdGVzW2lk\neF0sIGN0eCwgcGFnZWQsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICAgICAg\naWYgKHJvcHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByb3BzW2ld\nID0gcm9wOwoKICAgICAgICAgICAgICAgIGlmIChuZXh0Qml0cy5nZXQoaSkp\nCiAgICAgICAgICAgICAgICAgICAgaWR4Kys7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChyb3BzICE9IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKGV4cHNbMF0uYXNjZW5kaW5nLmxlbmd0aCA9PSAwKQogICAgICAg\nICAgICAgICAgcm9wID0gbmV3IE1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVy\nKHJvcHMpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJv\ncCA9IG5ldyBPcmRlcmluZ01lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyKHJv\ncHMsCiAgICAgICAgICAgICAgICAgICAgZXhwc1swXS5hc2NlbmRpbmcsIGV4\nLCB0aGlzLCBwYXJhbXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyBuZWVkIHRvIGZha2UgcmVzdWx0IHJhbmdlPwogICAgICAgIGlm\nICgocm9wcyAhPSBudWxsICYmIHJhbmdlLmVuZCAhPSBMb25nLk1BWF9WQUxV\nRSkgCiAgICAgICAgICAgIHx8IHN0YXJ0ICE9IHJhbmdlLnN0YXJ0IHx8IGVu\nZCAhPSByYW5nZS5lbmQpCiAgICAgICAgICAgIHJvcCA9IG5ldyBSYW5nZVJl\nc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgcmFuZ2Uuc3RhcnQsIHJhbmdlLmVu\nZCk7CgogICAgICAgIGxvY2FsQ29udGV4dC5yZW1vdmUoKTsKICAgICAgICBy\nZXR1cm4gcm9wOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGRhdGEg\nZm9yIHRoZSBnaXZlbiB1bmlvbiwgcmV0dXJuaW5nIHBhZ2VkIGZpZWxkcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBCaXRTZXRbXSBwb3B1bGF0ZVVuaW9uKFVu\naW9uIHVuaW9uLCBmaW5hbCBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncywKICAg\nICAgICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMsIGZpbmFsIEV4cHJlc3Np\nb25GYWN0b3J5W10gZmFjdHMsCiAgICAgICAgZmluYWwgUXVlcnlFeHByZXNz\naW9uc1tdIGV4cHMsIGZpbmFsIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtdIHN0\nYXRlcywKICAgICAgICBmaW5hbCBFeHBDb250ZXh0IGN0eCwgZmluYWwgYm9v\nbGVhbiBscnMsIGZpbmFsIGludCBlYWdlciwKICAgICAgICBmaW5hbCBsb25n\nIHN0YXJ0LCBmaW5hbCBsb25nIGVuZCkgewogICAgICAgIGZpbmFsIEJpdFNl\ndFtdIHBhZ2VkID0gKGV4cHNbMF0ucHJvamVjdGlvbnMubGVuZ3RoID4gMCkg\nPyBudWxsCiAgICAgICAgICAgIDogbmV3IEJpdFNldFttYXBwaW5ncy5sZW5n\ndGhdOwogICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3Io\nKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2Vs\nLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICBCaXRTZXQgYml0cyA9IHBv\ncHVsYXRlU2VsZWN0KHNlbCwgbWFwcGluZ3NbaWR4XSwgc3ViY2xhc3NlcywK\nICAgICAgICAgICAgICAgICAgICAoSkRCQ0V4cHJlc3Npb25GYWN0b3J5KSBm\nYWN0c1tpZHhdLCBleHBzW2lkeF0sIHN0YXRlc1tpZHhdLAogICAgICAgICAg\nICAgICAgICAgIGN0eCwgIGxycywgZWFnZXIsIHN0YXJ0LCBlbmQpOwogICAg\nICAgICAgICAgICAgaWYgKHBhZ2VkICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgcGFnZWRbaWR4XSA9IGJpdHM7CiAgICAgICAgICAgIH0KICAgICAg\nICB9KTsKICAgICAgICByZXR1cm4gcGFnZWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZWxlY3QgZGF0YSBmb3IgdGhlIGdpdmVuIHNlbGVjdCwgcmV0dXJu\naW5nIHBhZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRTZXQg\ncG9wdWxhdGVTZWxlY3QoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsCiAgICAgICAgYm9vbGVhbiBzdWJjbGFzc2VzLCBKREJDRXhwcmVzc2lv\nbkZhY3RvcnkgZmFjdCwgUXVlcnlFeHByZXNzaW9ucyBleHBzLAogICAgICAg\nIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZSBzdGF0ZSwgRXhwQ29udGV4dCBjdHgs\nIGJvb2xlYW4gbHJzLCBpbnQgZWFnZXIsCiAgICAgICAgbG9uZyBzdGFydCwg\nbG9uZyBlbmQpIHsKICAgICAgICBzZWwuc2V0TFJTKGxycyk7CiAgICAgICAg\nc2VsLnNldFJhbmdlKHN0YXJ0LCBlbmQpOwoKICAgICAgICBCaXRTZXQgcGFn\nZWQgPSBudWxsOwogICAgICAgIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0\naCA9PSAwKSB7CiAgICAgICAgICAgIHBhZ2VkID0gUGFnaW5nUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIuZ2V0UGFnZWRGaWVsZHMoc2VsLCBtYXBwaW5nLAogICAg\nICAgICAgICAgICAgX3N0b3JlLCBjdHguZmV0Y2gsIGVhZ2VyLCBlbmQgLSBz\ndGFydCk7CiAgICAgICAgICAgIGlmIChwYWdlZCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgZWFnZXIgPSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VS\nX0pPSU47CiAgICAgICAgfQoKICAgICAgICBmYWN0LmdldFNlbGVjdENvbnN0\ncnVjdG9yKCkuc2VsZWN0KHNlbCwgY3R4LCBtYXBwaW5nLCBzdWJjbGFzc2Vz\nLCBleHBzLAogICAgICAgICAgICBzdGF0ZSwgZWFnZXIpOwogICAgICAgIHJl\ndHVybiBwYWdlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgdGhl\nIGdpdmVuIHVuaW9uLgogICAgICovCiAgICBwcml2YXRlIFJlc3VsdE9iamVj\ndFByb3ZpZGVyIGV4ZWN1dGVVbmlvbihVbmlvbiB1bmlvbiwKICAgICAgICBD\nbGFzc01hcHBpbmdbXSBtYXBwaW5ncywgUXVlcnlFeHByZXNzaW9uc1tdIGV4\ncHMsIAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtdIHN0YXRlcywg\nRXhwQ29udGV4dCBjdHgsIEJpdFNldFtdIHBhZ2VkKSB7CiAgICAgICAgaWYg\nKGV4cHNbMF0ucHJvamVjdGlvbnMubGVuZ3RoID4gMCkKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBQcm9qZWN0aW9uUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5p\nb24sIGV4cHMsIHN0YXRlcywgY3R4KTsKCiAgICAgICAgaWYgKHBhZ2VkICE9\nIG51bGwpCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFnZWQu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAocGFnZWRbaV0gIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jl\nc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5ncywKICAgICAgICAg\nICAgICAgICAgICAgICAgX3N0b3JlLCBjdHguZmV0Y2gsIHBhZ2VkLCBMb25n\nLk1BWF9WQUxVRSk7CgogICAgICAgIHJldHVybiBuZXcgSW5zdGFuY2VSZXN1\nbHRPYmplY3RQcm92aWRlcih1bmlvbiwgbWFwcGluZ3NbMF0sIF9zdG9yZSwK\nICAgICAgICAgICAgY3R4LmZldGNoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEV4ZWN1dGUgdGhlIGdpdmVuIHNlbGVjdC4KICAgICAqLwogICAgcHJpdmF0\nZSBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRlU2VsZWN0KFNlbGVjdCBz\nZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIFF1ZXJ5RXhwcmVz\nc2lvbnMgZXhwcywgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlLCBFeHBD\nb250ZXh0IGN0eCwgCiAgICAgICAgQml0U2V0IHBhZ2VkLCBsb25nIHN0YXJ0\nLCBsb25nIGVuZCkgewogICAgICAgIGlmIChleHBzLnByb2plY3Rpb25zLmxl\nbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvamVjdGlvblJl\nc3VsdE9iamVjdFByb3ZpZGVyKHNlbCwgZXhwcywgc3RhdGUsIGN0eCk7CiAg\nICAgICAgaWYgKHBhZ2VkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLCBtYXBwaW5nLCBf\nc3RvcmUsIAogICAgICAgICAgICAgICAgY3R4LmZldGNoLCBwYWdlZCwgZW5k\nIC0gc3RhcnQpOwogICAgICAgIHJldHVybiBuZXcgSW5zdGFuY2VSZXN1bHRP\nYmplY3RQcm92aWRlcihzZWwsIG1hcHBpbmcsIF9zdG9yZSwgCiAgICAgICAg\nICAgIGN0eC5mZXRjaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSB0aGUgc2VsZWN0cyB3aXRoIFdIRVJFIGNvbmRpdGlvbnMgbmVlZGVkIHRv\nIGV4ZWN1dGUgdGhlIHF1ZXJ5CiAgICAgKiBmb3IgdGhlIGdpdmVuIG1hcHBp\nbmdzLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gY3JlYXRlV2hlcmVT\nZWxlY3RzKExpc3Qgc2VscywgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3MsCiAg\nICAgICAgTGlzdCBzZWxNYXBwaW5ncywgYm9vbGVhbiBzdWJjbGFzc2VzLCBC\naXRTZXQgc3ViY2xhc3NCaXRzLAogICAgICAgIEJpdFNldCBuZXh0Qml0cywg\nRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywgUXVlcnlFeHByZXNzaW9uc1td\nIGV4cHMsCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlW10gc3RhdGVz\nLCBFeHBDb250ZXh0IGN0eCwgaW50IHN1YmNsYXNzTW9kZSkgewogICAgICAg\nIE51bWJlciBvcHRIaW50ID0gKE51bWJlcikgY3R4LmZldGNoLmdldEhpbnQK\nICAgICAgICAgICAgKFF1ZXJ5SGludHMuSElOVF9SRVNVTFRfQ09VTlQpOwog\nICAgICAgIENsYXNzTWFwcGluZ1tdIHZlcnRzOwogICAgICAgIGJvb2xlYW4g\ndW5pb25hYmxlID0gdHJ1ZTsKICAgICAgICBTZWxlY3Qgc2VsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHZlcnRpY2FsIG1hcHBpbmdzIHRv\nIHNlbGVjdCBzZXBhcmF0ZWx5CiAgICAgICAgICAgIHZlcnRzID0gZ2V0VmVy\ndGljYWxNYXBwaW5ncyhtYXBwaW5nc1tpXSwgc3ViY2xhc3NlcywgZXhwc1tp\nXSwKICAgICAgICAgICAgICAgIHN1YmNsYXNzTW9kZSk7CiAgICAgICAgICAg\nIGlmICh2ZXJ0cy5sZW5ndGggPT0gMSAmJiBzdWJjbGFzc2VzKQogICAgICAg\nICAgICAgICAgc3ViY2xhc3NCaXRzLnNldChzZWxzLnNpemUoKSk7CgogICAg\nICAgICAgICAvLyBjcmVhdGUgY3JpdGVyaWEgc2VsZWN0IGFuZCBjbG9uZSBm\nb3IgZWFjaCB2ZXJ0IG1hcHBpbmcKICAgICAgICAgICAgc2VsID0gKChKREJD\nRXhwcmVzc2lvbkZhY3RvcnkpIGZhY3RzW2ldKS5nZXRTZWxlY3RDb25zdHJ1\nY3RvcigpLgogICAgICAgICAgICAgICAgZXZhbHVhdGUoY3R4LCBudWxsLCBu\ndWxsLCBleHBzW2ldLCBzdGF0ZXNbaV0pOwogICAgICAgICAgICBpZiAob3B0\nSGludCAhPSBudWxsKQogICAgICAgICAgICAgICBzZWwuc2V0RXhwZWN0ZWRS\nZXN1bHRDb3VudChvcHRIaW50LmludFZhbHVlKCksIHRydWUpOwogICAgICAg\nICAgICBlbHNlIGlmICh0aGlzLmN0eC5pc1VuaXF1ZSgpKQogICAgICAgICAg\nICAgICAgc2VsLnNldEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwog\nICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHZlcnRzLmxlbmd0aDsg\naisrKSB7CiAgICAgICAgICAgICAgICBzZWxNYXBwaW5ncy5hZGQodmVydHNb\nal0pOwogICAgICAgICAgICAgICAgaWYgKGogPT0gdmVydHMubGVuZ3RoIC0g\nMSkgewogICAgICAgICAgICAgICAgICAgIG5leHRCaXRzLnNldChzZWxzLnNp\nemUoKSk7CiAgICAgICAgICAgICAgICAgICAgc2Vscy5hZGQoc2VsKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNlbHMu\nYWRkKHNlbC5mdWxsQ2xvbmUoMSkpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyB0dXJuIG9mZiB1bmlvbmluZyBpZiBhIGdpdmVuIGluZGVwZW5k\nZW50IG1hcHBpbmcgcmVxdWlyZXMKICAgICAgICAgICAgLy8gbXVsdGlwbGUg\nc2VsZWN0cywgb3IgaWYgd2UncmUgdXNpbmcgRlJPTSBzZWxlY3RzCiAgICAg\nICAgICAgIGlmICh2ZXJ0cy5sZW5ndGggPiAxIHx8IHNlbC5nZXRGcm9tU2Vs\nZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHVuaW9uYWJsZSA9IGZh\nbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdW5pb25hYmxlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCB0aGUgdmVydGljYWwgbWFw\ncGluZ3MgdG8gc2VsZWN0IHNlcGFyYXRlbHkuIERlcGVuZHMgb24KICAgICAq\nIHN1YmNsYXNzIGZldGNoIG1vZGUgYW5kIHRoZSB0eXBlIG9mIHF1ZXJ5Lgog\nICAgICovCiAgICBwcml2YXRlIENsYXNzTWFwcGluZ1tdIGdldFZlcnRpY2Fs\nTWFwcGluZ3MoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgYm9vbGVh\nbiBzdWJjbGFzc2VzLCBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIGludCBzdWJj\nbGFzc01vZGUpIHsKICAgICAgICBpZiAoIXN1YmNsYXNzZXMgfHwgZXhwcy5w\ncm9qZWN0aW9ucy5sZW5ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gbmV3\nIENsYXNzTWFwcGluZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBpZiAoc3Vi\nY2xhc3NNb2RlICE9IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFS\nQUxMRUwKICAgICAgICAgICAgfHwgIWhhc1ZlcnRpY2FsU3ViY2xhc3Nlcyht\nYXBwaW5nKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBpbmdb\nXSB7IG1hcHBpbmcgfTsKCiAgICAgICAgTGlzdCBzdWJzID0gbmV3IEFycmF5\nTGlzdCg0KTsKICAgICAgICBhZGRTdWJjbGFzc2VzKG1hcHBpbmcsIHN1YnMp\nOwogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1YnMudG9BcnJh\neShuZXcgQ2xhc3NNYXBwaW5nW3N1YnMuc2l6ZSgpXSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVyIHRvIGFkZCBtYXBwaW5ncyBm\nb3Igc3ViY2xhc3NlcyB0byB0aGUgZ2l2ZW4gbGlzdC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzZXMoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIENvbGxlY3Rpb24gc3VicykgewogICAgICAgIC8vIHBvc3NpYmxlIGZ1\ndHVyZSBvcHRpbWl6YXRpb25zOgogICAgICAgIC8vIC0gaWYgbm8gZmllbGRz\nIGluIG1ldGEgb3IgaXRzIHN1YmNsYXNzZXMgKGFuZCBub3QgaW4gYW4KICAg\nICAgICAvLyAgIGFscmVhZHktc2VsZWN0ZWQgdGFibGUpIGFyZSBpbiB0aGUg\nY3VycmVudCBmZXRjaAogICAgICAgIC8vICAgY29uZmlndXJhdGlvbiwgc3Rv\ncCBjcmVhdGluZyBuZXcgZXhlY3V0b3JzCiAgICAgICAgLy8gLSBhbGxvdyBh\nbiBleGVjdXRvciB0byBzZWxlY3QgYSByYW5nZSBvZiBzdWJjbGFzc2VzLCBy\nYXRoZXIKICAgICAgICAvLyAgIHRoYW4ganVzdCBhbGwgc3ViY2xhc3NlcyAv\nIG5vIHN1YmNsYXNzZXM7IHRoaXMgd291bGQKICAgICAgICAvLyAgIGFsbG93\nIHVzIHRvIGRvIGp1c3Qgb25lIHF1ZXJ5IHBlciBhY3R1YWwgdmVydGljYWxs\neS1tYXBwZWQKICAgICAgICAvLyAgIHN1YmNsYXNzLCByYXRoZXIgdGhhbiBv\nbmUgcGVyIG1hcHBlZCBzdWJjbGFzcywgYXMgaXMgaGFwcGVuaW5nIG5vdwoK\nICAgICAgICBzdWJzLmFkZChtYXBwaW5nKTsKICAgICAgICBpZiAoIWhhc1Zl\ncnRpY2FsU3ViY2xhc3NlcyhtYXBwaW5nKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyByZWN1cnNlIG9uIGltbWVkaWF0ZSBzdWJjbGFzc2Vz\nCiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzdWJNYXBwaW5ncy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKHN1Yk1hcHBpbmdzW2ldLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpID09IG1hcHBpbmcpCiAgICAgICAgICAgICAgICBh\nZGRTdWJjbGFzc2VzKHN1Yk1hcHBpbmdzW2ldLCBzdWJzKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBjbGFzcyBo\nYXMgYW55IHZlcnRpY2FsIHN1YmNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gaGFzVmVydGljYWxTdWJjbGFzc2VzKENsYXNz\nTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3Vi\ncyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmIChzdWJzW2ldLmdldFN0cmF0ZWd5KCkgaW5zdGFu\nY2VvZiBWZXJ0aWNhbENsYXNzU3RyYXRlZ3kpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgZWFnZXIgbW9kZSBkZXBlbmRzIG9uIHRoZSB1bmlx\ndWUgc2V0dGluZyBhbmQgcmFuZ2UuIElmIHRoZSByYW5nZQogICAgICogcHJv\nZHVjZXMgMCByZXN1bHRzLCB1c2UgZWFnZXIgc2V0dGluZyBvZiBub25lLiBJ\nZiBpdCBwcm9kdWNlcyAxIHJlc3VsdAogICAgICogb3IgdGhlIHF1ZXJ5IGlz\nIHVuaXF1ZSwgdXNlIGFuIGVhZ2VyIHNldHRpbmcgb2Ygc2luZ2xlLiBPdGhl\ncndpc2UgdXNlCiAgICAgKiBhbiBlYWdlciBtb2RlIG9mIG11bHRpcGxlLgog\nICAgICovCiAgICBwcml2YXRlIGludCBjYWxjdWxhdGVFYWdlck1vZGUoUXVl\ncnlFeHByZXNzaW9ucyBleHBzLCBsb25nIHN0YXJ0LAogICAgICAgIGxvbmcg\nZW5kKSB7CiAgICAgICAgaWYgKGV4cHMucHJvamVjdGlvbnMubGVuZ3RoID4g\nMCB8fCBzdGFydCA+PSBlbmQpCiAgICAgICAgICAgIHJldHVybiBFYWdlckZl\ndGNoTW9kZXMuRUFHRVJfTk9ORTsKICAgICAgICBpZiAoZW5kIC0gc3RhcnQg\nPT0gMSB8fCBjdHguaXNVbmlxdWUoKSkKICAgICAgICAgICAgcmV0dXJuIEVh\nZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9KT0lOOwogICAgICAgIHJldHVybiBFYWdl\nckZldGNoTW9kZXMuRUFHRVJfUEFSQUxMRUw7CiAgICB9CgogICAgcHJvdGVj\ndGVkIE51bWJlciBleGVjdXRlRGVsZXRlKEV4ZWN1dG9yIGV4LCBDbGFzc01l\ndGFEYXRhIGJhc2UsCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLCBi\nb29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMs\nCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMsIE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgIHJldHVybiBleGVjdXRlQnVsa09wZXJhdGlvbiht\nZXRhcywgc3ViY2xhc3NlcywgZmFjdHMsIGV4cHMsCiAgICAgICAgICAgIHBh\ncmFtcywgbnVsbCk7CiAgICB9CgogICAgcHJvdGVjdGVkIE51bWJlciBleGVj\ndXRlVXBkYXRlKEV4ZWN1dG9yIGV4LCBDbGFzc01ldGFEYXRhIGJhc2UsCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLCBib29sZWFuIHN1YmNsYXNz\nZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsCiAgICAgICAgUXVlcnlF\neHByZXNzaW9uc1tdIGV4cHMsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAg\nIHJldHVybiBleGVjdXRlQnVsa09wZXJhdGlvbihtZXRhcywgc3ViY2xhc3Nl\ncywgZmFjdHMsIGV4cHMsCiAgICAgICAgICAgIHBhcmFtcywgZXhwc1swXS51\ncGRhdGVzKTsKICAgIH0KCiAgICBwcml2YXRlIE51bWJlciBleGVjdXRlQnVs\na09wZXJhdGlvbihDbGFzc01ldGFEYXRhW10gbWV0YXMsCiAgICAgICAgYm9v\nbGVhbiBzdWJjbGFzc2VzLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLCBR\ndWVyeUV4cHJlc3Npb25zW10gZXhwcywKICAgICAgICBPYmplY3RbXSBwYXJh\nbXMsIE1hcCB1cGRhdGVzKSB7CiAgICAgICAgQ29udGV4dFtdIGN0eHMgPSBu\nZXcgQ29udGV4dFtleHBzLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBleHBzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjdHhzW2ld\nID0gZXhwc1tpXS5jdHgoKTsKICAgICAgICBsb2NhbENvbnRleHQuc2V0KGNs\nb25lKGN0eHMsIG51bGwpKTsKICAgICAgICAKICAgICAgICAvLyB3ZSBjYW5u\nb3QgZXhlY3V0ZSBhIGJ1bGsgZGVsZXRlIHN0YXRlbWVudCB3aGVuIGhhdmUg\nbWFwcGluZ3MgaW4KICAgICAgICAvLyBtdWx0aXBsZSB0YWJsZXMsIHNvIGlu\nZGljYXRlIHdlIHdhbnQgdG8gdXNlIGluLW1lbW9yeSB3aXRoIG51bGwKICAg\nICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IChDbGFzc01hcHBpbmdb\nXSkgbWV0YXM7CgogICAgICAgIC8vIHNwZWNpZmljYXRpb24gb2YgdGhlICJ1\ncGRhdGVzIiBtYXAgaW5kaWNhdGVzIHRoYXQgdGhpcyBpcwogICAgICAgIC8v\nIGFuIHVwZGF0ZSBxdWVyeTsgb3RoZXJ3aXNlLCB0aGlzIGlzIGEgZGVsZXRl\nIHN0YXRlbWVudAogICAgICAgIGJvb2xlYW4gaXNVcGRhdGUgPSB1cGRhdGVz\nICE9IG51bGwgJiYgdXBkYXRlcy5zaXplKCkgPiAwOwoKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghaXNTaW5nbGVUYWJsZU1hcHBpbmcobWFwcGluZ3NbaV0s\nIHN1YmNsYXNzZXMpICYmICFpc1VwZGF0ZSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAgICAgaWYgKCFpc1VwZGF0ZSkgewogICAg\nICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIGFueSBkZWxldGUgY2FsbGJh\nY2tzLCB3ZSBuZWVkIHRvCiAgICAgICAgICAgICAgICAvLyBleGVjdXRlIGlu\nLW1lbW9yeSBzbyB0aGUgY2FsbGJhY2tzIGFyZSBpbnZva2VkCiAgICAgICAg\nICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIgbWdyID0gY3R4LmdldFN0\nb3JlQ29udGV4dCgpLmdldEJyb2tlcigpCiAgICAgICAgICAgICAgICAgICAg\nLmdldExpZmVjeWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAgICAgICAgICAg\naWYgKG1nci5oYXNEZWxldGVMaXN0ZW5lcnMobnVsbCwgbWFwcGluZ3NbaV0p\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIAogICAgICAgICAg\nICBjdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgRXhwQ29u\ndGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChfc3RvcmUsIHBhcmFtcywgZmV0\nY2gpOwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gX3N0b3JlLmdldERC\nRGljdGlvbmFyeSgpOwogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtd\nIHN0YXRlID0gbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtleHBzLmxlbmd0\naF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGF0ZS5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgc3RhdGVbaV0gPSBuZXcgUXVlcnlFeHByZXNz\naW9uc1N0YXRlKCk7CgogICAgICAgIFNRTEJ1ZmZlcltdIHNxbCA9IG5ldyBT\nUUxCdWZmZXJbbWFwcGluZ3MubGVuZ3RoXTsKICAgICAgICBKREJDRXhwcmVz\nc2lvbkZhY3RvcnkgamRiY0ZhY3Rvcnk7CiAgICAgICAgU2VsZWN0IHNlbDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGpkYmNGYWN0b3J5ID0gKEpEQkNFeHByZXNz\naW9uRmFjdG9yeSkgZmFjdHNbaV07CiAgICAgICAgICAgIHNlbCA9IGpkYmNG\nYWN0b3J5LmdldFNlbGVjdENvbnN0cnVjdG9yKCkuZXZhbHVhdGUoY3R4LCBu\ndWxsLCBudWxsLAogICAgICAgICAgICAgICAgZXhwc1tpXSwgc3RhdGVbaV0p\nOwogICAgICAgICAgICBqZGJjRmFjdG9yeS5nZXRTZWxlY3RDb25zdHJ1Y3Rv\ncigpLnNlbGVjdChzZWwsIGN0eCwgbWFwcGluZ3NbaV0sIAogICAgICAgICAg\nICAgICAgc3ViY2xhc3NlcywgZXhwc1tpXSwgc3RhdGVbaV0sIAogICAgICAg\nICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FKTsK\nCiAgICAgICAgICAgIC8vIFRoZSBidWxrIG9wZXJhdGlvbiB3aWxsIHJldHVy\nbiBudWxsIHRvIGluZGljYXRlIHRoYXQgdGhlIGRhdGFiYXNlCiAgICAgICAg\nICAgIC8vIGRvZXMgbm90IHN1cHBvcnQgdGhlIHJlcXVlc3QgYnVsayBkZWxl\ndGUgb3BlcmF0aW9uOyBpbgogICAgICAgICAgICAvLyB0aGlzIGNhc2UsIHdl\nIG5lZWQgdG8gcGVyZm9ybSB0aGUgcXVlcnkgaW4tbWVtb3J5IGFuZAogICAg\nICAgICAgICAvLyBtYW51YWxseSBkZWxldGUgdGhlIGluc3RhbmNlcwogICAg\nICAgICAgICBpZiAoIWlzVXBkYXRlKQogICAgICAgICAgICAgICAgc3FsW2ld\nID0gZGljdC50b0RlbGV0ZShtYXBwaW5nc1tpXSwgc2VsLCBwYXJhbXMpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzcWxbaV0gPSBkaWN0\nLnRvVXBkYXRlKG1hcHBpbmdzW2ldLCBzZWwsIF9zdG9yZSwgcGFyYW1zLAog\nICAgICAgICAgICAgICAgICAgIHVwZGF0ZXMpOwoKICAgICAgICAgICAgaWYg\nKHNxbFtpXSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB3\nZSBoYXZlIGFuIGFjdGl2ZSBzdG9yZSBjb25uZWN0aW9uCiAgICAgICAgX3N0\nb3JlLmdldENvbnRleHQoKS5iZWdpblN0b3JlKCk7CgogICAgICAgIENvbm5l\nY3Rpb24gY29ubiA9IF9zdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAg\nbG9uZyBjb3VudCA9IDA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc3FsLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBz\ndG1udCA9IG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzcWxb\naV0pOwogICAgICAgICAgICAgICAgICAgIGRpY3Quc2V0VGltZW91dHMoc3Rt\nbnQsIGZldGNoLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb3VudCAr\nPSBleGVjdXRlVXBkYXRlKGNvbm4sIHN0bW50LCBzcWxbaV0sIGlzVXBkYXRl\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0\nU3RvcmUoc2UsIHNxbFtpXS5nZXRTUUwoKSwgCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9zdG9yZS5nZXREQkRpY3Rpb25hcnkoKSk7CiAgICAgICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGlmIChzdG1u\ndCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgeyBzdG1u\ndC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlKCk7IH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICB9CgogICAgICAgIGxvY2FsQ29u\ndGV4dC5yZW1vdmUoKTsKICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKGNvdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGdp\ndmVuIG1hcHBpbmcgb2NjdXBpZXMgb25seSBvbmUgdGFibGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBpc1NpbmdsZVRhYmxlTWFwcGluZyhDbGFz\nc01hcHBpbmcgbWFwcGluZywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMp\nIHsKICAgICAgICBDbGFzc01hcHBpbmcgcm9vdCA9IG1hcHBpbmc7CiAgICAg\nICAgd2hpbGUgKHJvb3QuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcm9vdCA9IHJvb3QuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKGhhc1ZlcnRp\nY2FsU3ViY2xhc3Nlcyhyb290KSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICAvLyB3ZSBjYW5ub3QgZXhlY3V0ZSBhIGJ1bGsgZGVsZXRl\nIGlmIGFueSBvZiB0aGUKICAgICAgICAvLyBmaWVsZCBtYXBwaW5ncyBmb3Ig\ndGhlIGNhbmRpZGF0ZXMgaGF2ZSBjb2x1bW5zCiAgICAgICAgLy8gaW4gYW55\nIG90aGVyIHRhYmxlLCBzaW5jZSBidWxrIGRlbGV0aW5nIGp1c3QgZnJvbSB0\naGUKICAgICAgICAvLyBjbGFzcyB3aWxsIGxlYXZlIGRhbmdsaW5nIHJlbGF0\naW9uczsgd2UgbWlnaHQgYmUgYWJsZQogICAgICAgIC8vIHRvIGlzc3VlIGJ1\nbGsgZGVsZXRlcyBzZXBhcmF0ZWx5IGZvciB0aGUgam9pbnMgKHBvc3NpYmx5\nCiAgICAgICAgLy8gdXNpbmcgYSB0ZW1wb3JhcnkgdGFibGUgdG8gc2VsZWN0\nIHRoZSBwcmltYXJ5IGtleXMgZm9yCiAgICAgICAgLy8gYWxsIHRoZSByZWxh\ndGVkIHRhYmxlcyBhbmQgdGhlbiBpc3NpbmcgYSBkZWxldGUgYWdhaW5zdCB0\naG9zZQogICAgICAgIC8vIGtleXMpLCBidXQgdGhhdCBsb2dpYyBpcyBub3Qg\nY3VycmVudGx5IGltcGxlbWVudGVkCiAgICAgICAgVGFibGUgdGFibGUgPSBn\nZXRUYWJsZShtYXBwaW5nLmdldEZpZWxkTWFwcGluZ3MoKSwgbnVsbCk7CiAg\nICAgICAgaWYgKHRhYmxlID09IElOVkFMSUQpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgaWYgKHN1YmNsYXNzZXMpIHsKICAgICAgICAg\nICAgLy8gaWYgd2UgYXJlIGluY2x1ZGluZyBzdWJjbGFzc2VzLCB3ZSBhbHNv\nIG5lZWQgdG8gZ2F0aGVyCiAgICAgICAgICAgIC8vIGFsbCB0aGUgbWFwcGlu\nZ3MgZm9yIGFsbCBrbm93biBzdWJjbGFzc2VzCiAgICAgICAgICAgIENsYXNz\nTWFwcGluZ1tdIHN1YnMgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFz\nc01hcHBpbmdzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBzdWJz\nICE9IG51bGwgJiYgaSA8IHN1YnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIHRhYmxlID0gZ2V0VGFibGUoc3Vic1tpXS5nZXREZWZpbmVkRmll\nbGRNYXBwaW5ncygpLCB0YWJsZSk7CiAgICAgICAgICAgICAgICBpZiAodGFi\nbGUgPT0gSU5WQUxJRCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNpbmdsZSB0\nYWJsZSBmb3IgdGhlIGdpdmVuIGZpZWxkcywgb3IgSU5WQUxJRCBpZiB0aGV5\nCiAgICAgKiB1c2UgbXVsdGlwbGUgdGFibGVzLgogICAgICovCiAgICBwcml2\nYXRlIFRhYmxlIGdldFRhYmxlKEZpZWxkTWFwcGluZ1tdIGZpZWxkcywgVGFi\nbGUgdGFibGUpIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJsZSA9IGdldFRhYmxl\nKGZpZWxkc1tpXSwgdGFibGUpOwogICAgICAgICAgICBpZiAodGFibGUgPT0g\nSU5WQUxJRCkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHRhYmxlIGZvciB0aGUgZmllbGQgaWYgdGhlIGdpdmVuIHRhYmxl\nIGhhc24ndCBiZWVuIHNldAogICAgICogeWV0LCBvciBpZiB0aGUgdGFibGVz\nIG1hdGNoLiBJZiB0aGUgZmllbGQgdXNlcyBhIGRpZmZlcmVudCB0YWJsZSwK\nICAgICAqIHJldHVybnMgSU5WQUxJRC4gQWxzbyByZXR1cm5zIElOVkFMSUQg\naWYgZmllbGQgaXMgZGVwZW5kZW50LgogICAgICovCiAgICBwcml2YXRlIFRh\nYmxlIGdldFRhYmxlKEZpZWxkTWFwcGluZyBmbSwgVGFibGUgdGFibGUpIHsK\nICAgICAgICBpZiAoZm0uZ2V0Q2FzY2FkZURlbGV0ZSgpICE9IFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9OT05FIAogICAgICAgICAgICAmJiAhZm0uaXNFbWJl\nZGRlZFBDKCkpCiAgICAgICAgICAgIHJldHVybiBJTlZBTElEOwoKICAgICAg\nICBDb2x1bW5bXSBjb2x1bW5zID0gZm0uZ2V0Q29sdW1ucygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBjb2x1bW5zICE9IG51bGwgJiYgaSA8IGNvbHVt\nbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRhYmxlID09IG51\nbGwpCiAgICAgICAgICAgICAgICB0YWJsZSA9IGNvbHVtbnNbaV0uZ2V0VGFi\nbGUoKTsKICAgICAgICAgICAgZWxzZSBpZiAodGFibGUgIT0gY29sdW1uc1tp\nXS5nZXRUYWJsZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIElOVkFMSUQ7\nCiAgICAgICAgfQogICAgICAgIGlmIChmbS5pc0JpZGlyZWN0aW9uYWxKb2lu\nVGFibGVNYXBwaW5nT3duZXIoKSkKICAgICAgICAJcmV0dXJuIElOVkFMSUQ7\nCiAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgfQoKICAgIHByb3RlY3RlZCBO\ndW1iZXIgZXhlY3V0ZVVwZGF0ZShDbGFzc01ldGFEYXRhIGJhc2UsIENsYXNz\nTWV0YURhdGFbXSBtZXRhcywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMs\nIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsCiAgICAgICAgUXVlcnlFeHBy\nZXNzaW9uc1tdIHBhcnNlZCwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgcHJvdGVjdGVkIFN0cmluZ1tdIGdl\ndERhdGFTdG9yZUFjdGlvbnMoQ2xhc3NNZXRhRGF0YSBiYXNlLAogICAgICAg\nIENsYXNzTWV0YURhdGFbXSBtZXRhcywgYm9vbGVhbiBzdWJjbGFzc2VzLCBF\neHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLAogICAgICAgIFF1ZXJ5RXhwcmVz\nc2lvbnNbXSBleHBzLCBPYmplY3RbXSBwYXJhbXMsIFJhbmdlIHJhbmdlKSB7\nCiAgICAgICAgQ29udGV4dFtdIGN0eHMgPSBuZXcgQ29udGV4dFtleHBzLmxl\nbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBjdHhzW2ldID0gZXhwc1tpXS5jdHgoKTsK\nICAgICAgICBsb2NhbENvbnRleHQuc2V0KGNsb25lKGN0eHMsIG51bGwpKTsK\nICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IChDbGFzc01hcHBp\nbmdbXSkgbWV0YXM7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBjdHguCiAgICAgICAg\nICAgIGdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIGlmIChleHBz\nWzBdLmZldGNoUGF0aHMgIT0gbnVsbCkgewogICAgICAgICAgICBmZXRjaC5h\nZGRGaWVsZHMoQXJyYXlzLmFzTGlzdChleHBzWzBdLmZldGNoUGF0aHMpKTsK\nICAgICAgICAgICAgZmV0Y2guYWRkSm9pbnMoQXJyYXlzLmFzTGlzdChleHBz\nWzBdLmZldGNoUGF0aHMpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGV4cHNb\nMF0uZmV0Y2hJbm5lclBhdGhzICE9IG51bGwpCiAgICAgICAgICAgIGZldGNo\nLmFkZEZldGNoSW5uZXJKb2lucyhBcnJheXMuYXNMaXN0KGV4cHNbMF0uZmV0\nY2hJbm5lclBhdGhzKSk7CgogICAgICAgIGludCBlYWdlciA9IGNhbGN1bGF0\nZUVhZ2VyTW9kZShleHBzWzBdLCByYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTsK\nICAgICAgICBlYWdlciA9IE1hdGgubWluKGVhZ2VyLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uLkVBR0VSX0pPSU4pOwogICAgICAgIGludCBzdWJjbGFzc01v\nZGUgPSBmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZSgoQ2xhc3NNYXBwaW5n\nKSBiYXNlKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9zdG9yZS5n\nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBsb25nIHN0YXJ0ID0gKG1hcHBp\nbmdzLmxlbmd0aCA9PSAxICYmIGRpY3Quc3VwcG9ydHNTZWxlY3RTdGFydElu\nZGV4KSAKICAgICAgICAgICAgPyByYW5nZS5zdGFydCA6IDBMOwogICAgICAg\nIGxvbmcgZW5kID0gKGRpY3Quc3VwcG9ydHNTZWxlY3RFbmRJbmRleCkgPyBy\nYW5nZS5lbmQgOiBMb25nLk1BWF9WQUxVRTsKCiAgICAgICAgUXVlcnlFeHBy\nZXNzaW9uc1N0YXRlW10gc3RhdGVzID0gbmV3IFF1ZXJ5RXhwcmVzc2lvbnNT\ndGF0ZVtleHBzLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzdGF0ZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHN0YXRlc1tpXSA9\nIG5ldyBRdWVyeUV4cHJlc3Npb25zU3RhdGUoKTsKICAgICAgICBFeHBDb250\nZXh0IGN0eCA9IG5ldyBFeHBDb250ZXh0KF9zdG9yZSwgcGFyYW1zLCBmZXRj\naCk7CgogICAgICAgIC8vIGFkZCBzZWxlY3RzIHdpdGggcG9wdWxhdGUgV0hF\nUkUgY29uZGl0aW9ucyB0byBsaXN0CiAgICAgICAgTGlzdCBzZWxzID0gbmV3\nIEFycmF5TGlzdChtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgIExpc3Qgc2Vs\nTWFwcGluZ3MgPSBuZXcgQXJyYXlMaXN0KG1hcHBpbmdzLmxlbmd0aCk7CiAg\nICAgICAgQml0U2V0IHN1YmNsYXNzQml0cyA9IG5ldyBCaXRTZXQoKTsKICAg\nICAgICBCaXRTZXQgbmV4dEJpdHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAg\nYm9vbGVhbiB1bmlvbmFibGUgPSBjcmVhdGVXaGVyZVNlbGVjdHMoc2Vscywg\nbWFwcGluZ3MsIHNlbE1hcHBpbmdzLAogICAgICAgICAgICBzdWJjbGFzc2Vz\nLCBzdWJjbGFzc0JpdHMsIG5leHRCaXRzLCBmYWN0cywgZXhwcywgc3RhdGVz\nLCBjdHgsIAogICAgICAgICAgICBzdWJjbGFzc01vZGUpICYmIHN1YmNsYXNz\nTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU47CiAg\nICAgICAgaWYgKHNlbHMuc2l6ZSgpID4gMSkKICAgICAgICAgICAgc3RhcnQg\nPSAwTDsKCiAgICAgICAgaWYgKHVuaW9uYWJsZSkgewogICAgICAgICAgICBV\nbmlvbiB1bmlvbiA9IF9zdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3VW5pb24o\nCiAgICAgICAgICAgICAgICAoU2VsZWN0W10pIHNlbHMudG9BcnJheShuZXcg\nU2VsZWN0W3NlbHMuc2l6ZSgpXSkpOwogICAgICAgICAgICBwb3B1bGF0ZVVu\naW9uKHVuaW9uLCBtYXBwaW5ncywgc3ViY2xhc3NlcywgZmFjdHMsIGV4cHMs\nIHN0YXRlcywgY3R4LAogICAgICAgICAgICAgICAgZmFsc2UsIGVhZ2VyLCBz\ndGFydCwgZW5kKTsKICAgICAgICAgICAgaWYgKHVuaW9uLmlzVW5pb24oKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nW10ge3VuaW9uLnRv\nU2VsZWN0KGZhbHNlLCBmZXRjaCkuZ2V0U1FMKHRydWUpfTsKICAgICAgICAg\nICAgc2VscyA9IEFycmF5cy5hc0xpc3QodW5pb24uZ2V0U2VsZWN0cygpKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTZWxlY3Qgc2VsOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMCwgaWR4ID0gMDsgaSA8IHNlbHMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHNlbCA9IChTZWxlY3QpIHNl\nbHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgcG9wdWxhdGVTZWxlY3Qoc2Vs\nLCAoQ2xhc3NNYXBwaW5nKSBzZWxNYXBwaW5ncy5nZXQoaSksCiAgICAgICAg\nICAgICAgICAgICAgc3ViY2xhc3NCaXRzLmdldChpKSwgKEpEQkNFeHByZXNz\naW9uRmFjdG9yeSkgZmFjdHNbaWR4XSwKICAgICAgICAgICAgICAgICAgICBl\neHBzW2lkeF0sIHN0YXRlc1tpZHhdLCBjdHgsIGZhbHNlLCBlYWdlciwgc3Rh\ncnQsIGVuZCk7CiAgICAgICAgICAgICAgICBpZiAobmV4dEJpdHMuZ2V0KGkp\nKQogICAgICAgICAgICAgICAgICAgIGlkeCsrOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBTdHJpbmdbXSBzcWwgPSBuZXcgU3RyaW5nW3Nl\nbHMuc2l6ZSgpXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlbHMu\nc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIHNxbFtpXSA9ICgoU2VsZWN0KSBz\nZWxzLmdldChpKSkudG9TZWxlY3QoZmFsc2UsIGZldGNoKS5nZXRTUUwodHJ1\nZSk7CgogICAgICAgIGxvY2FsQ29udGV4dC5yZW1vdmUoKTsKICAgICAgICBy\nZXR1cm4gc3FsOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpE\nQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyB1\ncGRhdGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBpbnQgZXhlY3V0ZVVwZGF0\nZShDb25uZWN0aW9uIGNvbm4sIFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCAK\nICAgICAgICBTUUxCdWZmZXIgc3FsQnVmLCBib29sZWFuIGlzVXBkYXRlKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gc3RtbnQuZXhl\nY3V0ZVVwZGF0ZSgpOwogICAgfQogICAgICAgICAgICAKICAgIC8qKgogICAg\nICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9u\nLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2Yg\ncHJlcGFyaW5nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHJvdGVjdGVkIFBy\nZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoQ29ubmVjdGlvbiBj\nb25uLCBTUUxCdWZmZXIgc3FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBzcWwucHJlcGFyZVN0YXRlbWVudChjb25u\nKTsKICAgIH0gICAgCgogICAgcHVibGljIE9iamVjdCBldmFsdWF0ZShPYmpl\nY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAg\nICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgaW50IGlkID0g\nMDsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWwpCiAgICAgICAgICAgIGlkID0g\nKChvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWwpdmFs\ndWUpLmdldElkKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsgCgogICAgICAgIHN3aXRjaChp\nZCkgewogICAgICAgIGNhc2UgVmFsLk1BVEhfVkFMOgogICAgICAgICAgICBy\nZXR1cm4gaGFuZGxlTWF0aFZhbCh2YWx1ZSwgb2IsIHBhcmFtcywgc20pOwog\nICAgICAgIGNhc2UgVmFsLkNPTkNBVF9WQUw6CiAgICAgICAgICAgIHJldHVy\nbiBoYW5kbGVDb25jYXRWYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAg\nICAgICBjYXNlIFZhbC5TVUJTVFJJTkdfVkFMOgogICAgICAgICAgICByZXR1\ncm4gaGFuZGxlU3Vic3RyaW5nVmFsKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7\nCiAgICAgICAgY2FzZSBWYWwuQVJHU19WQUw6CiAgICAgICAgICAgIHJldHVy\nbiBoYW5kbGVBcmdzVmFsKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAg\nICAgY2FzZSBWYWwuTE9XRVJfVkFMOgogICAgICAgICAgICByZXR1cm4gaGFu\nZGxlTG93ZXJWYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBj\nYXNlIFZhbC5VUFBFUl9WQUw6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVV\ncHBlclZhbCh2YWx1ZSwgb2IsIHBhcmFtcywgc20pOwogICAgICAgIGNhc2Ug\nVmFsLkxFTkdUSF9WQUw6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVMZW5n\ndGhWYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBjYXNlIFZh\nbC5UUklNX1ZBTDoKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZVRyaW1WYWwo\ndmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5JTkRF\nWE9GX1ZBTDoKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUluZGV4T2ZWYWwo\ndmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5BQlNf\nVkFMOgogICAgICAgICAgICByZXR1cm4gaGFuZGxlQWJzVmFsKHZhbHVlLCBv\nYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgY2FzZSBWYWwuU1FSVF9WQUw6CiAg\nICAgICAgICAgIHJldHVybiBoYW5kbGVTcXJ0VmFsKHZhbHVlLCBvYiwgcGFy\nYW1zLCBzbSk7CiAgICAgICAgZGVmYXVsdDogICAgCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVNYXRoVmFsKE9iamVjdCB2\nYWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMsIAogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5NYXRoIG1hdGhWYWwgPQogICAgICAg\nICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuTWF0\naCkgdmFsdWU7CiAgICAgICAgVmFsIHZhbHVlMSA9IG1hdGhWYWwuZ2V0VmFs\nMSgpOwogICAgICAgIE9iamVjdCB2YWwxID0gZ2V0VmFsdWUodmFsdWUxLCBv\nYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgQ2xhc3MgYzEgPSB2YWx1ZTEuZ2V0\nVHlwZSgpOwoKICAgICAgICBWYWwgdmFsdWUyID0gbWF0aFZhbC5nZXRWYWwy\nKCk7CiAgICAgICAgT2JqZWN0IHZhbDIgPSBnZXRWYWx1ZSh2YWx1ZTIsIG9i\nLCBwYXJhbXMsIHNtKTsKICAgICAgICBDbGFzcyBjMiA9IHZhbHVlMi5nZXRU\neXBlKCk7CgogICAgICAgIFN0cmluZyBvcCA9IG1hdGhWYWwuZ2V0T3BlcmF0\naW9uKCk7CiAgICAgICAgaWYgKG9wLmVxdWFscyhvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5NYXRoLkFERCkpIAogICAgICAgICAgICBy\nZXR1cm4gRmlsdGVycy5hZGQodmFsMSwgYzEsIHZhbDIsIGMyKTsKICAgICAg\nICBlbHNlIGlmIChvcC5lcXVhbHMoCiAgICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5NYXRoLlNVQlRSQUNUKSkK\nICAgICAgICAgICAgcmV0dXJuIEZpbHRlcnMuc3VidHJhY3QodmFsMSwgYzEs\nIHZhbDIsIGMyKTsKICAgICAgICBlbHNlIGlmIChvcC5lcXVhbHMoCiAgICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhw\ncy5NYXRoLk1VTFRJUExZKSkgCiAgICAgICAgICAgIHJldHVybiBGaWx0ZXJz\nLm11bHRpcGx5KHZhbDEsIGMxLCB2YWwyLCBjMik7CiAgICAgICAgZWxzZSBp\nZiAob3AuZXF1YWxzKAogICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLmV4cHMuTWF0aC5ESVZJREUpKSAKICAgICAgICAg\nICAgcmV0dXJuIEZpbHRlcnMuZGl2aWRlKHZhbDEsIGMxLCB2YWwyLCBjMik7\nCiAgICAgICAgZWxzZSBpZiAob3AuZXF1YWxzKG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLk1hdGguTU9EKSkgCiAgICAgICAgICAgIHJl\ndHVybiBGaWx0ZXJzLm1vZCh2YWwxLCBjMSwgdmFsMiwgYzIpOwogICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfQoKICAg\nIHByaXZhdGUgT2JqZWN0IGhhbmRsZUNvbmNhdFZhbChPYmplY3QgdmFsdWUs\nIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5rZXJuZWwuZXhwcy5Db25jYXQgY29uY2F0VmFsID0KICAgICAgICAg\nICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkNvbmNh\ndCl2YWx1ZTsKICAgICAgICBWYWwgdmFsdWUxID0gY29uY2F0VmFsLmdldFZh\nbDEoKTsKICAgICAgICBPYmplY3QgdmFsMSA9IGdldFZhbHVlKHZhbHVlMSwg\nb2IsIHBhcmFtcywgc20pOwoKICAgICAgICBWYWwgdmFsdWUyID0gY29uY2F0\nVmFsLmdldFZhbDIoKTsKICAgICAgICBPYmplY3QgdmFsMiA9IGdldFZhbHVl\nKHZhbHVlMiwgb2IsIHBhcmFtcywgc20pOwogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nQnVpbGRlcigxMDApLmFwcGVuZCh2YWwxKS5hcHBlbmQodmFsMiku\ndG9TdHJpbmcoKTsKICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVT\ndWJzdHJpbmdWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtd\nIHBhcmFtcywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAg\nICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU3Vi\nc3RyaW5nIHN1YnN0clZhbCA9CiAgICAgICAgICAgIChvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TdWJzdHJpbmcpIHZhbHVlOwogICAg\nICAgIFZhbCB2YWx1ZTEgPSBzdWJzdHJWYWwuZ2V0VmFsMSgpOwogICAgICAg\nIFN0cmluZyB2YWwxID0gKFN0cmluZykgZ2V0VmFsdWUodmFsdWUxLCBvYiwg\ncGFyYW1zLCBzbSk7CgogICAgICAgIFZhbCB2YWx1ZTIgPSBzdWJzdHJWYWwu\nZ2V0VmFsMigpOwogICAgICAgIE9iamVjdCB2YWwyID0gZ2V0VmFsdWUodmFs\ndWUyLCBvYiwgcGFyYW1zLCBzbSk7CgogICAgICAgIG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZVtdIHZhbEFyeTIgPSAKICAgICAgICAg\nICAgKG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZVtdKSB2\nYWwyOwogICAgICAgIE9iamVjdCBhcmcxID0gZ2V0VmFsdWUodmFsQXJ5Mlsw\nXSwgb2IsIHBhcmFtcywgc20pOyAvL3N0YXJ0aW5nIHBvcwogICAgICAgIE9i\namVjdCBhcmcyID0gZ2V0VmFsdWUodmFsQXJ5MlsxXSwgb2IsIHBhcmFtcywg\nc20pOyAvLyBsZW5ndGgKICAgICAgICBpbnQgc3RhcnRJZHggPSAoKExvbmcp\nIGFyZzEpLmludFZhbHVlKCk7CiAgICAgICAgaW50IGxlbmd0aCA9ICgoTG9u\nZykgYXJnMikuaW50VmFsdWUoKTsKICAgICAgICBpbnQgZW5kSWR4ID0gc3Rh\ncnRJZHggKyBsZW5ndGg7CiAgICAgICAgcmV0dXJuIHZhbDEuc3Vic3RyaW5n\nKHN0YXJ0SWR4LCBlbmRJZHgpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0\nIGhhbmRsZUFyZ3NWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVj\ndFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkg\newogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkFyZ3MgYXJnc1ZhbCA9IAogICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLmV4cHMuQXJncykgdmFsdWU7CiAgICAgICAgcmV0\ndXJuIGFyZ3NWYWwuZ2V0VmFsdWVzKCk7CiAgICB9CgogICAgcHJpdmF0ZSBP\nYmplY3QgaGFuZGxlTG93ZXJWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2Is\nIE9iamVjdFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSkgewogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLlRvTG93ZXJDYXNlIGxvd2VyVmFsID0gCiAgICAgICAgICAgIChv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5Ub0xvd2VyQ2Fz\nZSkgdmFsdWU7CiAgICAgICAgVmFsIHZhbCA9IGxvd2VyVmFsLmdldFZhbHVl\nKCk7CiAgICAgICAgcmV0dXJuICgoU3RyaW5nKSBnZXRWYWx1ZSh2YWwsIG9i\nLCBwYXJhbXMsIHNtKSkudG9Mb3dlckNhc2UoKTsKICAgIH0KCiAgICBwcml2\nYXRlIE9iamVjdCBoYW5kbGVVcHBlclZhbChPYmplY3QgdmFsdWUsIE9iamVj\ndCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtKXsKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5r\nZXJuZWwuZXhwcy5Ub1VwcGVyQ2FzZSB1cHBlclZhbCA9IAogICAgICAgICAg\nICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuVG9VcHBl\nckNhc2UpIHZhbHVlOwogICAgICAgIFZhbCB2YWwgPSB1cHBlclZhbC5nZXRW\nYWx1ZSgpOwogICAgICAgIHJldHVybiAoKFN0cmluZykgZ2V0VmFsdWUodmFs\nLCBvYiwgcGFyYW1zLCBzbSkpLnRvVXBwZXJDYXNlKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBPYmplY3QgaGFuZGxlTGVuZ3RoVmFsKE9iamVjdCB2YWx1ZSwg\nT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMsIAogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20pewogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5leHBzLlN0cmluZ0xlbmd0aCBzdHJMZW5WYWwgPSAKICAg\nICAgICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLlN0cmluZ0xlbmd0aCkgdmFsdWU7CiAgICAgICAgVmFsIHZhbCA9IHN0ckxl\nblZhbC5nZXRWYWx1ZSgpOwogICAgICAgIHJldHVybiAoKFN0cmluZykgZ2V0\nVmFsdWUodmFsLCBvYiwgcGFyYW1zLCBzbSkpLmxlbmd0aCgpOwogICAgfQoK\nICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZVRyaW1WYWwoT2JqZWN0IHZhbHVl\nLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLlRyaW0gdHJpbVZhbCA9IAogICAgICAgICAg\nICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuVHJpbSkg\ndmFsdWU7CiAgICAgICAgVmFsIHZhbCA9IHRyaW1WYWwuZ2V0VmFsKCk7CiAg\nICAgICAgU3RyaW5nIHZhbFN0ciA9IChTdHJpbmcpIGdldFZhbHVlKHZhbCwg\nb2IsIHBhcmFtcywgc20pOwogICAgICAgIFZhbCB0cmltQ2hhciA9IHRyaW1W\nYWwuZ2V0VHJpbUNoYXIoKTsKICAgICAgICBjaGFyIHRyaW1DaGFyT2JqID0g\nKChTdHJpbmcpIGdldFZhbHVlKHRyaW1DaGFyLCBvYiwgcGFyYW1zLCBzbSkp\nLgogICAgICAgICAgICBjaGFyQXQoMCk7CiAgICAgICAgQm9vbGVhbiB3aGVy\nZSA9IHRyaW1WYWwuZ2V0V2hlcmUoKTsKICAgICAgICBpZiAod2hlcmUgPT0g\nbnVsbCkgeyAvL3RyaW0gYm90aAogICAgICAgICAgICByZXR1cm4gdHJpbUxl\nYWRpbmcodHJpbVRyYWlsaW5nKHZhbFN0ciwgdHJpbUNoYXJPYmopLCB0cmlt\nQ2hhck9iaik7CiAgICAgICAgfSBlbHNlIGlmICh3aGVyZS5ib29sZWFuVmFs\ndWUoKSkgeyAvLyB0cmltIGxlYWRpbmcKICAgICAgICAgICAgcmV0dXJuIHRy\naW1MZWFkaW5nKHZhbFN0ciwgdHJpbUNoYXJPYmopOwogICAgICAgIH0gZWxz\nZSB7IC8vIHRyaW0gdHJhaWxpbmcKICAgICAgICAgICAgcmV0dXJuIHRyaW1U\ncmFpbGluZyh2YWxTdHIsIHRyaW1DaGFyT2JqKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSBTdHJpbmcgdHJpbUxlYWRpbmcoU3RyaW5nIHZhbHVl\nLCBjaGFyIHRyaW1DaGFyKSB7CiAgICAgICAgaW50IHN0YXJ0SWR4ID0gMDsK\nICAgICAgICBpbnQgbGVuID0gdmFsdWUubGVuZ3RoKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAo\ndmFsdWUuY2hhckF0KGkpICE9IHRyaW1DaGFyKSB7CiAgICAgICAgICAgICAg\nICBzdGFydElkeCA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWUuc3Vic3Ry\naW5nKHN0YXJ0SWR4KTsKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyB0cmlt\nVHJhaWxpbmcoU3RyaW5nIHZhbHVlLCBjaGFyIHRyaW1DaGFyKSB7CiAgICAg\nICAgaW50IGVuZElkeCA9IDA7CiAgICAgICAgaW50IGxlbiA9IHZhbHVlLmxl\nbmd0aCgpOwogICAgICAgIGZvciAoaW50IGkgPSBsZW4tMTsgaSA+PSAwOyBp\nLS0pIHsKICAgICAgICAgICAgaWYgKHZhbHVlLmNoYXJBdChpKSAhPSB0cmlt\nQ2hhcikgewogICAgICAgICAgICAgICAgZW5kSWR4ID0gaTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB2YWx1ZS5zdWJzdHJpbmcoMCwgZW5kSWR4KzEpOwogICAgfQoK\nICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZUluZGV4T2ZWYWwoT2JqZWN0IHZh\nbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLmV4cHMuSW5kZXhPZiBsb2NhdGVWYWwgPSAKICAg\nICAgICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkluZGV4T2YpIHZhbHVlOwogICAgICAgIFN0cmluZyB2YWwxID0gKFN0cmlu\nZykgZ2V0VmFsdWUobG9jYXRlVmFsLmdldFZhbDEoKSwgb2IsIHBhcmFtcywg\nc20pOwogICAgICAgIFZhbFtdIHZhbDIgPSAoVmFsW10pIGdldFZhbHVlKGxv\nY2F0ZVZhbC5nZXRWYWwyKCksIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBT\ndHJpbmcgc3RyVmFsID0gKFN0cmluZykgZ2V0VmFsdWUodmFsMlswXSwgb2Is\nIHBhcmFtcywgc20pOwogICAgICAgIGludCBpZHggPSAoKExvbmcpIGdldFZh\nbHVlKHZhbDJbMV0sIG9iLCBwYXJhbXMsIHNtKSkuaW50VmFsdWUoKTsKICAg\nICAgICByZXR1cm4gc3RyVmFsLmluZGV4T2YodmFsMSwgaWR4KTsKICAgIH0K\nCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVBYnNWYWwoT2JqZWN0IHZhbHVl\nLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLkFicyBhYnNWYWwgPSAKICAgICAgICAgICAg\nKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkFicykgdmFs\ndWU7CiAgICAgICAgT2JqZWN0IHZhbCA9IGdldFZhbHVlKGFic1ZhbC5nZXRW\nYWx1ZSgpLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgQ2xhc3MgYyA9IHZh\nbC5nZXRDbGFzcygpOwogICAgICAgIGlmIChjID09IEludGVnZXIuY2xhc3Mp\nCiAgICAgICAgICAgIHJldHVybiBuZXcgSW50ZWdlcihqYXZhLmxhbmcuTWF0\naC5hYnMoKChJbnRlZ2VyKSB2YWwpLmludFZhbHVlKCkpKTsKICAgICAgICBl\nbHNlIGlmIChjID09IEZsb2F0LmNsYXNzKQogICAgICAgICAgICByZXR1cm4g\nbmV3IEZsb2F0KGphdmEubGFuZy5NYXRoLmFicygoKEZsb2F0KSB2YWwpLmZs\nb2F0VmFsdWUoKSkpOwogICAgICAgIGVsc2UgaWYgKGMgPT0gRG91YmxlLmNs\nYXNzKQogICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShqYXZhLmxhbmcu\nTWF0aC5hYnMoKChEb3VibGUpIHZhbCkuZG91YmxlVmFsdWUoKSkpOwogICAg\nICAgIGVsc2UgaWYgKGMgPT0gTG9uZy5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBMb25nKGphdmEubGFuZy5NYXRoLmFicygoKExvbmcpIHZhbCku\nbG9uZ1ZhbHVlKCkpKTsKICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oKTsKICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVT\ncXJ0VmFsKE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJh\nbXMsIAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAg\nICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TcXJ0IHNx\ncnRWYWwgPSAKICAgICAgICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5leHBzLlNxcnQpIHZhbHVlOwogICAgICAgIE9iamVjdCB2YWwg\nPSBnZXRWYWx1ZShzcXJ0VmFsLmdldFZhbHVlKCksIG9iLCBwYXJhbXMsIHNt\nKTsKICAgICAgICBDbGFzcyBjID0gdmFsLmdldENsYXNzKCk7CiAgICAgICAg\naWYgKGMgPT0gSW50ZWdlci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBEb3VibGUoamF2YS5sYW5nLk1hdGguc3FydCgoKEludGVnZXIpIHZhbCku\nCiAgICAgICAgICAgICAgICBkb3VibGVWYWx1ZSgpKSk7CiAgICAgICAgZWxz\nZSBpZiAoYyA9PSBGbG9hdC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBEb3VibGUoamF2YS5sYW5nLk1hdGguc3FydCgoKEZsb2F0KSB2YWwpLmZs\nb2F0VmFsdWUoKSkpOwogICAgICAgIGVsc2UgaWYgKGMgPT0gRG91YmxlLmNs\nYXNzKQogICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShqYXZhLmxhbmcu\nTWF0aC5zcXJ0KCgoRG91YmxlKSB2YWwpLgogICAgICAgICAgICAgICAgZG91\nYmxlVmFsdWUoKSkpOwogICAgICAgIGVsc2UgaWYgKGMgPT0gTG9uZy5jbGFz\ncykKICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoamF2YS5sYW5nLk1h\ndGguc3FydCgoKExvbmcpIHZhbCkuZG91YmxlVmFsdWUoKSkpOwogICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfSAgICAK\nCiAgICBwcml2YXRlIE9iamVjdCBnZXRWYWx1ZShPYmplY3QgdmFsdWUsIE9i\namVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20pIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBQ\nQ1BhdGgpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxk\nTWFwcGluZykoKFBDUGF0aCkgdmFsdWUpLmxhc3QoKTsKICAgICAgICAgICAg\ncmV0dXJuIGdldFZhbHVlKG9iLCBmbSwgc20pOwogICAgICAgIH0gZWxzZSBp\nZiAodmFsdWUgaW5zdGFuY2VvZiBMaXRlcmFsKSB7CiAgICAgICAgICAgIHJl\ndHVybiAoKExpdGVyYWwpIHZhbHVlKS5nZXRWYWx1ZSgpOwogICAgICAgIH0g\nZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBDb25zdGFudCkgewogICAgICAg\nICAgICByZXR1cm4gKChDb25zdGFudCkgdmFsdWUpLmdldFZhbHVlKHBhcmFt\ncyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGV2YWx1\nYXRlKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgT2JqZWN0IGdldFZhbHVlKE9iamVjdCBvYiwgRmllbGRN\nYXBwaW5nIGZtZCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7\nCiAgICAgICAgaW50IGkgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0\nY2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICByZXR1cm4gc20uZmV0\nY2hCb29sZWFuRmllbGQoaSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRToKICAgICAgICAgICAgcmV0dXJuIHNtLmZldGNoQnl0ZUZpZWxkKGkpOwog\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIHJldHVy\nbiBzbS5mZXRjaENoYXJGaWVsZChpKTsKICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEU6CiAgICAgICAgICAgIHJldHVybiBzbS5mZXRjaERvdWJsZUZp\nZWxkKGkpOwogICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAg\nICAgICByZXR1cm4gc20uZmV0Y2hGbG9hdEZpZWxkKGkpOwogICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgcmV0dXJuIHNtLmZldGNo\nSW50RmllbGQoaSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAg\nICAgICAgICAgcmV0dXJuIHNtLmZldGNoTG9uZ0ZpZWxkKGkpOwogICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICByZXR1cm4gc20u\nZmV0Y2hTaG9ydEZpZWxkKGkpOwogICAgICAgIGNhc2UgSmF2YVR5cGVzLlNU\nUklORzoKICAgICAgICAgICAgcmV0dXJuIHNtLmZldGNoU3RyaW5nRmllbGQo\naSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICBjYXNl\nIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTl9PQko6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVF9PQko6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklH\nREVDSU1BTDoKICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgog\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICBjYXNlIEph\ndmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgog\nICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hPYmplY3RGaWVsZChpKTsKICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgVGhyZWFkTG9jYWxDb250ZXh0IGV4dGVuZHMgVGhyZWFk\nTG9jYWw8Q29udGV4dFtdPiB7CiAgICAgICAgcHVibGljIENvbnRleHRbXSBp\nbml0aWFsVmFsdWUoKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBDb250ZXh0W10gZ2V0VGhy\nZWFkTG9jYWxDb250ZXh0KCkgewogICAgICAgIHJldHVybiBsb2NhbENvbnRl\neHQuZ2V0KCk7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBDb250ZXh0IGdl\ndFRocmVhZExvY2FsQ29udGV4dChDb250ZXh0IG9yaWcpIHsKICAgICAgICBD\nb250ZXh0W10gcm9vdCA9IGxvY2FsQ29udGV4dC5nZXQoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHJvb3QubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgQ29udGV4dCBsY3R4ID0gZ2V0VGhyZWFkTG9jYWxDb250ZXh0KHJv\nb3RbaV0sIG9yaWcpOwogICAgICAgICAgICBpZiAobGN0eCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGxjdHg7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgU2VsZWN0\nIGdldFRocmVhZExvY2FsU2VsZWN0KFNlbGVjdCBzZWxlY3QpIHsKICAgICAg\nICBpZiAoc2VsZWN0ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIENvbnRleHRbXSBsY3R4ID0gSkRCQ1N0b3JlUXVlcnkuZ2V0\nVGhyZWFkTG9jYWxDb250ZXh0KCk7CiAgICAgICAgQ29udGV4dCBjbG9uZUZy\nb20gPSBzZWxlY3QuY3R4KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBsY3R4Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIENvbnRleHQgY2xv\nbmVUbyA9IGdldFRocmVhZExvY2FsQ29udGV4dChsY3R4W2ldLCBjbG9uZUZy\nb20pOwogICAgICAgICAgICBpZiAoY2xvbmVUbyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIChTZWxlY3QpY2xvbmVUby5nZXRTZWxlY3QoKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVjdDsKICAgIH0KCiAgICBw\ndWJsaWMgc3RhdGljIENvbnRleHQgZ2V0VGhyZWFkTG9jYWxDb250ZXh0KENv\nbnRleHQgbGN0eCwgQ29udGV4dCBjbG9uZUZyb20pIHsKICAgICAgICBpZiAo\nbGN0eC5jbG9uZUZyb20gPT0gY2xvbmVGcm9tKQogICAgICAgICAgICByZXR1\ncm4gbGN0eDsKICAgICAgICBqYXZhLnV0aWwuTGlzdDxDb250ZXh0PiBzdWJz\nZWxDdHhzID0gbGN0eC5nZXRTdWJzZWxDb250ZXh0cygpOwogICAgICAgIGlm\nIChzdWJzZWxDdHhzICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yIChDb250\nZXh0IHN1YnNlbEN0eCA6IHN1YnNlbEN0eHMpIHsKICAgICAgICAgICAgICAg\nIENvbnRleHQgY3R4ID0gZ2V0VGhyZWFkTG9jYWxDb250ZXh0KHN1YnNlbEN0\neCwgY2xvbmVGcm9tKTsKICAgICAgICAgICAgICAgIGlmIChjdHggIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3R4OwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIENvbnRleHRbXSBjbG9uZShDb250ZXh0W10gb3Jp\nZywgQ29udGV4dCBwYXJlbnQpIHsKICAgICAgICBDb250ZXh0W10gbmV3Q3R4\nID0gbmV3IENvbnRleHRbb3JpZy5sZW5ndGhdOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgb3JpZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBu\nZXdDdHhbaV0gPSBjbG9uZShvcmlnW2ldLCBwYXJlbnQpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gbmV3Q3R4OwogICAgfQoKICAgIHByaXZhdGUgc3Rh\ndGljIENvbnRleHQgY2xvbmUoQ29udGV4dCBvcmlnLCBDb250ZXh0IHBhcmVu\ndCkgewogICAgICAgIENvbnRleHQgbXlQYXJlbnQgPSBudWxsOwogICAgICAg\nIGlmIChwYXJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICBDb250ZXh0IG9y\naWdQYXJlbnQgPSBvcmlnLmdldFBhcmVudCgpOwogICAgICAgICAgICBpZiAo\nb3JpZ1BhcmVudCAhPSBudWxsKQogICAgICAgICAgICAgICAgbXlQYXJlbnQg\nPSBjbG9uZShvcmlnLmdldFBhcmVudCgpLCBudWxsKTsKICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgbXlQYXJlbnQgPSBwYXJlbnQ7CgogICAgICAgIENv\nbnRleHQgbmV3Q3R4ID0gbmV3IENvbnRleHQob3JpZy5wYXJzZWQsIG51bGws\nIG15UGFyZW50KTsKICAgICAgICBuZXdDdHguZnJvbSA9IG9yaWcuZnJvbTsK\nICAgICAgICBuZXdDdHgubWV0YSA9IG9yaWcubWV0YTsKICAgICAgICBuZXdD\ndHguc2NoZW1hQWxpYXMgPSBvcmlnLnNjaGVtYUFsaWFzOwogICAgICAgIG5l\nd0N0eC5zZXRTY2hlbWFzKG9yaWcuZ2V0U2NoZW1hcygpKTsKICAgICAgICBu\nZXdDdHguc2V0VmFyaWFibGVzKG9yaWcuZ2V0VmFyaWFibGVzKCkpOwogICAg\nICAgIG5ld0N0eC5jbG9uZUZyb20gPSBvcmlnOwogICAgICAgIE9iamVjdCBz\nZWxlY3QgPSBvcmlnLmdldFNlbGVjdCgpOwogICAgICAgIGlmIChzZWxlY3Qg\nIT0gbnVsbCkKICAgICAgICAgICAgbmV3Q3R4LnNldFNlbGVjdCgoKFNlbGVj\ndEltcGwpc2VsZWN0KS5jbG9uZShuZXdDdHgpKTsKICAgICAgICBuZXdDdHgu\nc3VicXVlcnkgPSBvcmlnLnN1YnF1ZXJ5OwogICAgICAgIExpc3Q8Q29udGV4\ndD4gc3Vic2VscyA9IG9yaWcuZ2V0U3Vic2VsQ29udGV4dHMoKTsKICAgICAg\nICBpZiAoc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoQ29u\ndGV4dCBzdWJzZWwgOiBzdWJzZWxzKSAKICAgICAgICAgICAgICAgIG5ld0N0\neC5hZGRTdWJzZWxDb250ZXh0KGNsb25lKHN1YnNlbCwgbmV3Q3R4KSk7CiAg\nICAgICAgfQoKICAgICAgICByZXR1cm4gbmV3Q3R4OyAgICAgICAgCiAgICB9\nCn0K\n","encoding":"base64"}

