{"sha":"8e569600150feef2a07710f7dba1430b7f311e12","node_id":"MDQ6QmxvYjIwNjM2NDo4ZTU2OTYwMDE1MGZlZWYyYTA3NzEwZjdkYmExNDMwYjdmMzExZTEy","size":14571,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8e569600150feef2a07710f7dba1430b7f311e12","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsOwoKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuTG9naWNhbFVuaW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEJ1ZmZlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVjdXRvcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RJbXBs\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlVuaW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlByZXBhcmVkUXVlcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5Q2Fj\naGUuRXhjbHVzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLlF1ZXJ5RXhwcmVzc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnJvcC5SYW5nZVJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0TGlzdDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9u\nOwoKLyoqCiAqIEltcGxlbWVudHMge0BsaW5rIFByZXBhcmVkUXVlcnl9IGZv\nciBTUUwgcXVlcmllcy4KICogUHJlcGFyZWRRdWVyeSBob2xkcyB0aGUgcG9z\ndC1jb21waWxhdGlvbiBhbmQgcG9zdC1leGVjdXRpb24gc3RhdGUgb2YgYSBr\nZXJuZWwgUXVlcnkuCiAqIFRoZSBwb3N0LWV4ZWN1dGlvbiBpbnRlcm5hbCBz\ndGF0ZSBvZiBhIHF1ZXJ5IGlzIGFwcGVuZGVkIGFzIGEgPGVtPnVzZXIgb2Jq\nZWN0PC9lbT4KICogdG8gdGhlIHVzZXItdmlzaWJsZSByZXN1bHQgdG8gbWFp\nbnRhaW4gdGhlIEFQSSBjb250cmFjdC4gCiAqIAogKiBAYXV0aG9yIFBpbmFr\naSBQb2RkYXIKICoKICovCnB1YmxpYyBjbGFzcyBQcmVwYXJlZFF1ZXJ5SW1w\nbCBpbXBsZW1lbnRzIFByZXBhcmVkUXVlcnkgewogICAgcHJpdmF0ZSBzdGF0\naWMgTG9jYWxpemVyIF9sb2MgPSAKICAgICAgICBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShQcmVwYXJlZFF1ZXJ5SW1wbC5jbGFzcyk7CgogICAgcHJpdmF0ZSBm\naW5hbCBTdHJpbmcgX2lkOwogICAgcHJpdmF0ZSBTdHJpbmcgX3NxbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfaW5pdGlhbGl6ZWQ7CiAgICAKICAgIC8vIFBv\nc3QtY29tcGlsYXRpb24gc3RhdGUgb2YgYW4gZXhlY3V0YWJsZSBxdWVyeSwg\ncG9wdWxhdGVkIG9uIGNvbnN0cnVjdGlvbgogICAgcHJpdmF0ZSBDbGFzczw/\nPiBfY2FuZGlkYXRlOwogICAgcHJpdmF0ZSBib29sZWFuIF9zdWJjbGFzc2Vz\nOwogICAgCiAgICAvLyBwb3N0LWV4ZWN1dGlvbiBzdGF0ZSBvZiBhIHF1ZXJ5\nCiAgICBwcml2YXRlIFF1ZXJ5RXhwcmVzc2lvbnNbXSBfZXhwczsKICAgIHBy\naXZhdGUgQ2xhc3M8Pz5bXSBfcHJvalR5cGVzOwoKICAgIC8vIFBvc2l0aW9u\nIG9mIHRoZSB1c2VyIGRlZmluZWQgcGFyYW1ldGVycyBpbiB0aGUgX3BhcmFt\ncyBsaXN0CiAgICBwcml2YXRlIE1hcDxPYmplY3QsIGludFtdPiAgICBfdXNl\nclBhcmFtUG9zaXRpb25zOwogICAgcHJpdmF0ZSBNYXA8SW50ZWdlciwgT2Jq\nZWN0PiBfdGVtcGxhdGU7CiAgICBwcml2YXRlIFNlbGVjdEltcGwgc2VsZWN0\nOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0LgogICAgICogCiAgICAgKiBA\ncGFyYW0gaWQgYW4gaWRlbnRpZmllciBmb3IgdGhpcyBxdWVyeSB0byBiZSB1\nc2VkIGFzIGNhY2hlIGtleQogICAgICogQHBhcmFtIGNvbXBpbGVkIGEgY29t\ncGlsZWQgcXVlcnkgCiAgICAgKi8KICAgIHB1YmxpYyBQcmVwYXJlZFF1ZXJ5\nSW1wbChTdHJpbmcgaWQsIFF1ZXJ5IGNvbXBpbGVkKSB7CiAgICAgICAgdGhp\ncyhpZCwgbnVsbCwgY29tcGlsZWQpOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdC4KICAgICAqIAogICAgICogQHBhcmFtIGlkIGFuIGlk\nZW50aWZpZXIgZm9yIHRoaXMgcXVlcnkgdG8gYmUgdXNlZCBhcyBjYWNoZSBr\nZXkKICAgICAqIEBwYXJhbSBjb3JyZXNwb25kaW5nIGRhdGEgc3RvcmUgbGFu\nZ3VhZ2UgcXVlcnkgc3RyaW5nIAogICAgICogQHBhcmFtIGNvbXBpbGVkIGEg\nY29tcGlsZWQgcXVlcnkgCiAgICAgKi8KICAgIHB1YmxpYyBQcmVwYXJlZFF1\nZXJ5SW1wbChTdHJpbmcgaWQsIFN0cmluZyBzcWwsIFF1ZXJ5IGNvbXBpbGVk\nKSB7CiAgICAgICAgdGhpcy5faWQgPSBpZDsKICAgICAgICB0aGlzLl9zcWwg\nPSBzcWw7CiAgICAgICAgaWYgKGNvbXBpbGVkICE9IG51bGwpIHsKICAgICAg\nICAgICAgX2NhbmRpZGF0ZSAgICA9IGNvbXBpbGVkLmdldENhbmRpZGF0ZVR5\ncGUoKTsKICAgICAgICAgICAgX3N1YmNsYXNzZXMgICA9IGNvbXBpbGVkLmhh\nc1N1YmNsYXNzZXMoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0SWRlbnRpZmllcigpIHsKICAgICAgICByZXR1cm4gX2lk\nOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGdldExhbmd1YWdlKCkg\newogICAgICAgIHJldHVybiBRdWVyeUxhbmd1YWdlcy5MQU5HX1BSRVBBUkVE\nX1NRTDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXQgdGhlIG9yaWdp\nbmFsIHF1ZXJ5IHN0cmluZyB3aGljaCBpcyBzYW1lIGFzIHRoZSBpZGVudGlm\naWVyIG9mIHRoaXMgCiAgICAgKiByZWNlaXZlci4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXRPcmlnaW5hbFF1ZXJ5KCkgewogICAgICAgIHJldHVy\nbiBnZXRJZGVudGlmaWVyKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0VGFyZ2V0UXVlcnkoKSB7CiAgICAgICAgcmV0dXJuIF9zcWw7CiAg\nICB9CiAgICAKICAgIHZvaWQgc2V0VGFyZ2V0UXVlcnkoU3RyaW5nIHNxbCkg\newogICAgICAgIF9zcWwgPSBzcWw7CiAgICB9CiAgICAKICAgIHB1YmxpYyBi\nb29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmV0dXJuIF9pbml0\naWFsaXplZDsKICAgIH0KICAgIAogICAgcHVibGljIFF1ZXJ5RXhwcmVzc2lv\nbnNbXSBnZXRRdWVyeUV4cHJlc3Npb25zKCkgewogICAgICAgIHJldHVybiBf\nZXhwczsKICAgIH0KICAgIAogICAgcHVibGljIENsYXNzW10gZ2V0UHJvamVj\ndGlvblR5cGVzKCkgewogICAgICAgIHJldHVybiBfcHJvalR5cGVzOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFBvdXJzIHRoZSBwb3N0LWNvbXBpbGF0\naW9uIHN0YXRlIGhlbGQgYnkgdGhpcyByZWNlaXZlciB0byB0aGUgZ2l2ZW4K\nICAgICAqIHF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRv\nKFF1ZXJ5IHEpIHsKICAgIAlxLnNldFF1ZXJ5KF9pZCk7CiAgICAgICAgcS5z\nZXRDYW5kaWRhdGVUeXBlKF9jYW5kaWRhdGUsIF9zdWJjbGFzc2VzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgdGhpcyByZWNlaXZlciB3\naXRoIHBvc3QtZXhlY3V0aW9uIHJlc3VsdC4KICAgICAqIFRoZSBpbnB1dCBh\ncmd1bWVudCBpcyBwcm9jZXNzZWQgb25seSBpZiBpdCBpcyBhIHtAbGluayBS\nZXN1bHRMaXN0fSB3aXRoCiAgICAgKiBhbiBhdHRhY2hlZCB7QGxpbmsgU2Vs\nZWN0UmVzdWx0T2JqZWN0UHJvdmlkZXJ9IGFzIGl0cwogICAgICoge0BsaW5r\nIFJlc3VsdExpc3QjZ2V0VXNlck9iamVjdCgpIHVzZXIgb2JqZWN0fS4gCiAg\nICAgKiAKICAgICAqIEByZXR1cm4gYW4gZXhjbHVzaW9uIGlmIGNhbiBub3Qg\nYmUgaW5pdGlhbGl6ZWQgZm9yIHNvbWUgcmVhc29uLiAKICAgICAqIG51bGwg\naWYgaW5pdGlhbGl6YXRpb24gaXMgc3VjY2Vzc2Z1bC4gCiAgICAgKi8KICAg\nIHB1YmxpYyBFeGNsdXNpb24gaW5pdGlhbGl6ZShPYmplY3QgcmVzdWx0KSB7\nCiAgICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgT2JqZWN0W10gZXh0cmFjdCA9IGV4dHJhY3RT\nZWxlY3RFeGVjdXRvcihyZXN1bHQpOwogICAgICAgIFNlbGVjdEV4ZWN1dG9y\nIHNlbGVjdG9yID0gKFNlbGVjdEV4ZWN1dG9yKWV4dHJhY3RbMF07CiAgICAg\nICAgaWYgKHNlbGVjdG9yID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgUHJlcGFyZWRRdWVyeUNhY2hlSW1wbC5TdHJvbmdFeGNsdXNpb24oX2lk\nLCAoKExvY2FsaXplci5NZXNzYWdlKWV4dHJhY3RbMV0pLmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgaWYgKHNlbGVjdG9yID09IG51bGwgfHwgc2VsZWN0b3Iu\naGFzTXVsdGlwbGVTZWxlY3RzKCkKICAgICAgICAgICAgfHwgKChzZWxlY3Rv\nciBpbnN0YW5jZW9mIFVuaW9uKSAKICAgICAgICAgICAgJiYgKCgoVW5pb24p\nc2VsZWN0b3IpLmdldFNlbGVjdHMoKS5sZW5ndGggIT0gMSkpKQogICAgICAg\nICAgICByZXR1cm4gbmV3IFByZXBhcmVkUXVlcnlDYWNoZUltcGwuU3Ryb25n\nRXhjbHVzaW9uKF9pZCwgX2xvYy5nZXQoImV4Y2x1ZGUtbXVsdGktc2VsZWN0\nIikuZ2V0TWVzc2FnZSgpKTsKICAgICAgICBzZWxlY3QgPSBleHRyYWN0SW1w\nbGVtZW50YXRpb24oc2VsZWN0b3IpOwogICAgICAgIGlmIChzZWxlY3QgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcmVwYXJlZFF1ZXJ5Q2Fj\naGVJbXBsLlN0cm9uZ0V4Y2x1c2lvbihfaWQsIF9sb2MuZ2V0KCJleGNsdWRl\nLW5vLXNlbGVjdCIpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgU1FMQnVmZmVy\nIGJ1ZmZlciA9IHNlbGVjdG9yLmdldFNRTCgpOwogICAgICAgIGlmIChidWZm\nZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcmVwYXJlZFF1\nZXJ5Q2FjaGVJbXBsLlN0cm9uZ0V4Y2x1c2lvbihfaWQsIF9sb2MuZ2V0KCJl\neGNsdWRlLW5vLXNxbCIpLmdldE1lc3NhZ2UoKSk7OwogICAgICAgIHNldFRh\ncmdldFF1ZXJ5KGJ1ZmZlci5nZXRTUUwoKSk7CiAgICAgICAgc2V0UGFyYW1l\ndGVycyhidWZmZXIuZ2V0UGFyYW1ldGVycygpKTsKICAgICAgICBzZXRVc2Vy\nUGFyYW1ldGVyUG9zaXRpb25zKGJ1ZmZlci5nZXRVc2VyUGFyYW1ldGVycygp\nKTsKICAgICAgICBfaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgIAogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEV4\ndHJhY3QgdGhlIHVuZGVybHlpbmcgU2VsZWN0RXhlY3V0b3IgZnJvbSB0aGUg\nZ2l2ZW4gYXJndW1lbnQsIGlmIHBvc3NpYmxlLgogICAgICogCiAgICAgKiBA\ncmV0dXJuIHR3byBvYmplY3RzIGluIGFuIGFycmF5LiBUaGUgZWxlbWVudCBh\ndCBpbmRleCAwIGlzIFNlbGVjdEV4ZWN1dG9yLCAKICAgICAqIGlmIGl0IGNh\nbiBiZSBleHRyYWN0ZWQuIFRoZSBlbGVtZW50IGF0IGluZGV4IDEgaXMgdGhl\nIHJlYXNvbiB3aHkgaXQgY2FuCiAgICAgKiBub3QgYmUgZXh0cmFjdGVkLgog\nICAgICovCiAgICBwcml2YXRlIE9iamVjdFtdIGV4dHJhY3RTZWxlY3RFeGVj\ndXRvcihPYmplY3QgcmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdCBpbnN0\nYW5jZW9mIFJlc3VsdExpc3QgPT0gZmFsc2UpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgT2JqZWN0W117bnVsbCwgX2xvYy5nZXQoImV4Y2x1ZGUtbm90LXJl\nc3VsdCIpfTsKICAgICAgICBPYmplY3QgdXNlck9iamVjdCA9ICgoUmVzdWx0\nTGlzdDw/PilyZXN1bHQpLmdldFVzZXJPYmplY3QoKTsKICAgICAgICBpZiAo\ndXNlck9iamVjdCA9PSBudWxsIHx8ICF1c2VyT2JqZWN0LmdldENsYXNzKCku\naXNBcnJheSgpIHx8ICgoT2JqZWN0W10pdXNlck9iamVjdCkubGVuZ3RoICE9\nIDIpCiAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0W117bnVsbCwgX2xv\nYy5nZXQoImV4Y2x1ZGUtbm8tdXNlci1vYmplY3QiKX07CiAgICAgICAgT2Jq\nZWN0IHByb3ZpZGVyID0gKChPYmplY3RbXSl1c2VyT2JqZWN0KVswXTsKICAg\nICAgICBPYmplY3QgZXhlY3V0b3IgPSAoKE9iamVjdFtdKXVzZXJPYmplY3Qp\nWzFdOwogICAgICAgIGlmIChleGVjdXRvciBpbnN0YW5jZW9mIFN0b3JlUXVl\ncnkuRXhlY3V0b3IgPT0gZmFsc2UpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nT2JqZWN0W117bnVsbCwgX2xvYy5nZXQoImV4Y2x1ZGUtbm90LWV4ZWN1dG9y\nIil9OwogICAgICAgIF9leHBzID0gKChTdG9yZVF1ZXJ5LkV4ZWN1dG9yKWV4\nZWN1dG9yKS5nZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgaWYgKF9l\neHBzWzBdLnByb2plY3Rpb25zLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAg\nIF9wcm9qVHlwZXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX0NMQVNTRVM7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgX3Byb2pUeXBlcyA9IG5ldyBDbGFz\nc1tfZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5ndGhdOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IF9leHBzWzBdLnByb2plY3Rpb25zLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBfcHJvalR5cGVzW2ldID0gX2V4\ncHNbMF0ucHJvamVjdGlvbnNbaV0uZ2V0VHlwZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIFF1\nZXJ5SW1wbC5QYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIpIHsKICAgICAg\nICAgICAgcHJvdmlkZXIgPSAoKFF1ZXJ5SW1wbC5QYWNraW5nUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIpcHJvdmlkZXIpLmdldERlbGVnYXRlKCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIFJhbmdlUmVzdWx0\nT2JqZWN0UHJvdmlkZXIpIHsKICAgICAgICAgICAgcHJvdmlkZXIgPSAoKFJh\nbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIpcHJvdmlkZXIpLmdldERlbGVnYXRl\nKCk7CiAgICAgICAgfQogICAgICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9m\nIFNlbGVjdFJlc3VsdE9iamVjdFByb3ZpZGVyKSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgT2JqZWN0W117KChTZWxlY3RSZXN1bHRPYmplY3RQcm92aWRl\ncilwcm92aWRlcikuZ2V0U2VsZWN0KCksIG51bGx9OwogICAgICAgIH0gCiAg\nICAgICAgcmV0dXJuIG5ldyBPYmplY3RbXXtudWxsLCBfbG9jLmdldCgiZXhj\nbHVkZS1ub3Qtc2VsZWN0LXJvcCIsIHByb3ZpZGVyKX07CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgU2VsZWN0SW1wbCBleHRyYWN0SW1wbGVtZW50YXRpb24o\nU2VsZWN0RXhlY3V0b3Igc2VsZWN0b3IpIHsKICAgICAgICBpZiAoc2VsZWN0\nb3IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKHNlbGVjdG9yIGluc3RhbmNlb2YgU2VsZWN0SW1wbCkgCiAgICAgICAg\nICAgIHJldHVybiAoU2VsZWN0SW1wbClzZWxlY3RvcjsKICAgICAgICBpZiAo\nc2VsZWN0b3IgaW5zdGFuY2VvZiBMb2dpY2FsVW5pb24uVW5pb25TZWxlY3Qp\nCiAgICAgICAgICAgIHJldHVybiAoKExvZ2ljYWxVbmlvbi5VbmlvblNlbGVj\ndClzZWxlY3RvcikuZ2V0RGVsZWdhdGUoKTsKICAgICAgICBpZiAoc2VsZWN0\nb3IgaW5zdGFuY2VvZiBVbmlvbikgCiAgICAgICAgICAgIHJldHVybiBleHRy\nYWN0SW1wbGVtZW50YXRpb24oKChVbmlvbilzZWxlY3RvcikuZ2V0U2VsZWN0\ncygpWzBdKTsKICAgICAgICAKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBNZXJnZSB0aGUgZ2l2ZW4gdXNlciBwYXJh\nbWV0ZXJzIHdpdGggaXRzIG93biBwYXJhbWV0ZXIuIFRoZSBnaXZlbiBtYXAK\nICAgICAqIG11c3QgYmUgY29tcGF0aWJsZSB3aXRoIHRoZSB1c2VyIHBhcmFt\nZXRlcnMgZXh0cmFjdGVkIGR1cmluZyAKICAgICAqIHtAbGluayAjaW5pdGlh\nbGl6ZShPYmplY3QpIGluaXRpYWxpemF0aW9ufS4gCiAgICAgKiAKICAgICAq\nIEByZXR1cm4gMC1iYXNlZCBwYXJhbWV0ZXIgaW5kZXggbWFwcGVkIHRvIGNv\ncnJlc3BvbmRpbmcgdmFsdWVzLgogICAgICogCiAgICAgKi8KICAgIHB1Ymxp\nYyBNYXA8SW50ZWdlciwgT2JqZWN0PiByZXBhcmFtZXRyaXplKE1hcCB1c2Vy\nLCBCcm9rZXIgYnJva2VyKSB7CiAgICAgICAgaWYgKCFpc0luaXRpYWxpemVk\nKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigi\ncmVwYXJhbWV0ZXJpemUoKSBvbiB1bmluaXRpYWxpemVkLiIpOwogICAgICAg\nIGlmICh1c2VyID09IG51bGwgfHwgdXNlci5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgaWYgKCFfdXNlclBhcmFtUG9zaXRpb25zLmlzRW1wdHkoKSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoInVwYXJhbS1udWxsIiwgCiAgICAgICAgICAgICAgICAgICAgX3VzZXJQ\nYXJhbVBvc2l0aW9ucy5rZXlTZXQoKSwgdGhpcykpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIF90ZW1wbGF0ZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIV91c2VyUGFyYW1Q\nb3NpdGlvbnMua2V5U2V0KCkuZXF1YWxzKHVzZXIua2V5U2V0KCkpKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1\ncGFyYW0tbWlzbWF0Y2giLCAKICAgICAgICAgICAgICAgIF91c2VyUGFyYW1Q\nb3NpdGlvbnMua2V5U2V0KCksIHVzZXIua2V5U2V0KCksIHRoaXMpKTsKICAg\nICAgICB9CiAgICAgICAgTWFwPEludGVnZXIsIE9iamVjdD4gcmVzdWx0ID0g\nbmV3IEhhc2hNYXA8SW50ZWdlciwgT2JqZWN0PihfdGVtcGxhdGUpOwogICAg\nICAgIAogICAgICAgIGZvciAoT2JqZWN0IGtleSA6IHVzZXIua2V5U2V0KCkp\nIHsKICAgICAgICAgICAgaW50W10gaW5kaWNlcyA9IF91c2VyUGFyYW1Qb3Np\ndGlvbnMuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChpbmRpY2VzID09IG51\nbGwgfHwgaW5kaWNlcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1cGFyYW0tbm8tcG9z\nIiwga2V5LCB0aGlzKSk7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSB1c2Vy\nLmdldChrZXkpOwogICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFn\nZWFibGUodmFsKSkgewogICAgICAgICAgICAgICAgc2V0UGVyc2lzdGVuY2VD\nYXBhYmxlUGFyYW1ldGVyKHJlc3VsdCwgdmFsLCBpbmRpY2VzLCBicm9rZXIp\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENvbGxl\nY3Rpb24pIHsKICAgICAgICAgICAgICAgIHNldENvbGxlY3Rpb25WYWx1ZWRQ\nYXJhbWV0ZXIocmVzdWx0LCAoQ29sbGVjdGlvbil2YWwsIGluZGljZXMsIAog\nICAgICAgICAgICAgICAgICAgIGtleSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBqIDogaW5kaWNlcykgewogICAg\nICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBFbnVtKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGVtcGxhdGUuZ2V0KGopIGlu\nc3RhbmNlb2YgSW50ZWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsID0gKChFbnVtKXZhbCkub3JkaW5hbCgpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsID0gKChFbnVtKXZhbCkubmFtZSgpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAg\nICAgICAgICByZXN1bHQucHV0KGosIHZhbCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgcHJpbWFy\neSBrZXkgaWRlbnRpdHkgdmFsdWUocykgb2YgdGhlIGdpdmVuIG1hbmFnZWFi\nbGUgaW5zdGFuY2UKICAgICAqIGFuZCBmaWxsIGluIHRoZSBnaXZlbiBtYXAu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSB2YWx1ZXMgYSBtYXAgb2YgaW50ZWdl\nciBwYXJhbWV0ZXIgaW5kZXggdG8gcGFyYW1ldGVyIHZhbHVlCiAgICAgKiBA\ncGFyYW0gcGMgYSBtYW5hZ2VhYmxlIGluc3RhbmNlCiAgICAgKiBAcGFyYW0g\naW5kaWNlcyB0aGUgaW5kaWNlcyBvZiB0aGUgY29sdW1uIHZhbHVlcwogICAg\nICogQHBhcmFtIGJyb2tlciB1c2VkIHRvIG9idGFpbiB0aGUgcHJpbWFyeSBr\nZXkgdmFsdWVzCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRQZXJzaXN0\nZW5jZUNhcGFibGVQYXJhbWV0ZXIoTWFwPEludGVnZXIsT2JqZWN0PiByZXN1\nbHQsIAogICAgICAgIE9iamVjdCBwYywgaW50W10gaW5kaWNlcywgQnJva2Vy\nIGJyb2tlcikgewogICAgICAgIEpEQkNTdG9yZSBzdG9yZSA9IChKREJDU3Rv\ncmUpYnJva2VyLmdldFN0b3JlTWFuYWdlcigpCiAgICAgICAgICAgIC5nZXRJ\nbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5\nIHJlcG9zID0gc3RvcmUuZ2V0Q29uZmlndXJhdGlvbigpCiAgICAgICAgICAg\nIC5nZXRNYXBwaW5nUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcgPSByZXBvcy5nZXRNYXBwaW5nKHBjLmdldENs\nYXNzKCksIAogICAgICAgICAgICBicm9rZXIuZ2V0Q2xhc3NMb2FkZXIoKSwg\ndHJ1ZSk7CiAgICAgICAgQ29sdW1uW10gcGtzID0gbWFwcGluZy5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIE9iamVjdCBjb2xzID0gbWFwcGlu\nZy50b0RhdGFTdG9yZVZhbHVlKHBjLCBwa3MsIHN0b3JlKTsKICAgICAgICBp\nZiAoY29scyBpbnN0YW5jZW9mIE9iamVjdFtdKSB7CiAgICAgICAgICAgIE9i\namVjdFtdIGFycmF5ID0gKE9iamVjdFtdKWNvbHM7CiAgICAgICAgICAgIGlu\ndCBuID0gYXJyYXkubGVuZ3RoOwogICAgICAgICAgICBpZiAobiA+IGluZGlj\nZXMubGVuZ3RoIHx8IGluZGljZXMubGVuZ3RoJW4gIT0gMCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1cGFy\nYW0tcGMta2V5IiwgCiAgICAgICAgICAgICAgICAgICAgcGMuZ2V0Q2xhc3Mo\nKSwgbiwgQXJyYXlzLnRvU3RyaW5nKGluZGljZXMpKSk7CiAgICAgICAgICAg\nIGludCBrID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaiA6IGluZGljZXMp\nIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoaiwgYXJyYXlbayVuXSk7\nCiAgICAgICAgICAgICAgICBrKys7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBmb3IgKGludCBqIDogaW5kaWNlcykgewog\nICAgICAgICAgICAgICAgcmVzdWx0LnB1dChqLCBjb2xzKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gCiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBz\nZXRDb2xsZWN0aW9uVmFsdWVkUGFyYW1ldGVyKE1hcDxJbnRlZ2VyLE9iamVj\ndD4gcmVzdWx0LCAKICAgICAgICBDb2xsZWN0aW9uIHZhbHVlcywgaW50W10g\naW5kaWNlcywgT2JqZWN0IHBhcmFtKSB7CiAgICAgICAgaW50IG4gPSB2YWx1\nZXMuc2l6ZSgpOwogICAgICAgIE9iamVjdFtdIGFycmF5ID0gdmFsdWVzLnRv\nQXJyYXkoKTsKICAgICAgICBpZiAobiA+IGluZGljZXMubGVuZ3RoIHx8IGlu\nZGljZXMubGVuZ3RoJW4gIT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidXBhcmFtLWNvbGwtc2l6ZSIsIHBh\ncmFtLCB2YWx1ZXMsIAogICAgICAgICAgICAgICAgQXJyYXlzLnRvU3RyaW5n\nKGluZGljZXMpKSk7CiAgICAgICAgfQogICAgICAgIGludCBrID0gMDsKICAg\nICAgICBmb3IgKGludCBqIDogaW5kaWNlcykgewogICAgICAgICAgICByZXN1\nbHQucHV0KGosIGFycmF5W2slbl0pOwogICAgICAgICAgICBrKys7CiAgICAg\nICAgfQogICAgICAgIAogICAgfQogICAgLyoqCiAgICAgKiBNYXJrcyB0aGUg\ncG9zaXRpb25zIGFuZCBrZXlzIG9mIHVzZXIgcGFyYW1ldGVycy4KICAgICAq\nIAogICAgICogQHBhcmFtIGxpc3QgZXZlbiBlbGVtZW50cyBhcmUgbnVtYmVy\ncyByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIGEgCiAgICAgKiB1c2Vy\nIHBhcmFtZXRlciBpbiB0aGUgX3BhcmFtIGxpc3QuIE9kZCBlbGVtZW50cyBh\ncmUgdGhlIHVzZXIgcGFyYW1ldGVyCiAgICAgKiBrZXkuIEEgdXNlciBwYXJh\nbWV0ZXIga2V5IG1heSBhcHBlYXIgbW9yZSB0aGFuIG9uY2UuCiAgICAgKi8K\nICAgIHZvaWQgc2V0VXNlclBhcmFtZXRlclBvc2l0aW9ucyhMaXN0IGxpc3Qp\nIHsKICAgICAgICBfdXNlclBhcmFtUG9zaXRpb25zID0gbmV3IEhhc2hNYXA8\nT2JqZWN0LCBpbnRbXT4oKTsKICAgICAgICBmb3IgKGludCBpID0gMTsgbGlz\ndCAhPSBudWxsICYmIGkgPCBsaXN0LnNpemUoKTsgaSArPSAyKSB7CiAgICAg\nICAgICAgIE9iamVjdCBrZXkgPSBsaXN0LmdldChpKTsKICAgICAgICAgICAg\naW50IHAgPSAoSW50ZWdlcilsaXN0LmdldChpLTEpOwogICAgICAgICAgICBp\nbnRbXSBwb3NpdGlvbnMgPSBfdXNlclBhcmFtUG9zaXRpb25zLmdldChrZXkp\nOwogICAgICAgICAgICBpZiAocG9zaXRpb25zID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHBvc2l0aW9ucyA9IG5ldyBpbnRbXXtwfTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGludFtdIHRlbXAgPSBuZXcg\naW50W3Bvc2l0aW9ucy5sZW5ndGgrMV07CiAgICAgICAgICAgICAgICBTeXN0\nZW0uYXJyYXljb3B5KHBvc2l0aW9ucywgMCwgdGVtcCwgMCwgcG9zaXRpb25z\nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICB0ZW1wW3Bvc2l0aW9ucy5sZW5n\ndGhdID0gcDsKICAgICAgICAgICAgICAgIHBvc2l0aW9ucyA9IHRlbXA7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgX3VzZXJQYXJhbVBvc2l0aW9ucy5w\ndXQoa2V5LCBwb3NpdGlvbnMpOwogICAgICAgIH0KICAgIH0KICAgIAogICAg\ndm9pZCBzZXRQYXJhbWV0ZXJzKExpc3QgbGlzdCkgewogICAgICAgIE1hcDxJ\nbnRlZ2VyLCBPYmplY3Q+IHRtcCA9IG5ldyBIYXNoTWFwPEludGVnZXIsIE9i\namVjdD4oKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgbGlzdCAhPSBudWxs\nICYmIGkgPCBsaXN0LnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIHRtcC5w\ndXQoaSwgbGlzdC5nZXQoaSkpOwogICAgICAgIH0KICAgICAgICBfdGVtcGxh\ndGUgPSBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVNYXAodG1wKTsKICAgIH0K\nICAgIAogICAgU2VsZWN0SW1wbCBnZXRTZWxlY3QoKSB7CiAgICAgICAgcmV0\ndXJuIHNlbGVjdDsKICAgIH0KICAgIAogICAgcHVibGljIFN0cmluZyB0b1N0\ncmluZygpIHsKICAgICAgICByZXR1cm4gIlByZXBhcmVkUXVlcnk6IFsiICsg\nZ2V0T3JpZ2luYWxRdWVyeSgpICsgIl0gLS0+IFsiICsgCiAgICAgICAgICAg\nICAgIGdldFRhcmdldFF1ZXJ5KCkgKyAiXSI7CiAgICB9Cn0K\n","encoding":"base64"}

