{"sha":"896944d5642966937bff7262a15a2b40de774c3f","node_id":"MDQ6QmxvYjIwNjM2NDo4OTY5NDRkNTY0Mjk2NjkzN2JmZjcyNjJhMTVhMmI0MGRlNzc0YzNm","size":15745,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/896944d5642966937bff7262a15a2b40de774c3f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uU3RyZWFt\nVG9rZW5pemVyOwppbXBvcnQgamF2YS5pby5TdHJpbmdSZWFkZXI7CmltcG9y\ndCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFy\nZWRTdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9y\ndCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQg\namF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuUXVlcnlSZXN1bHRNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHRTZXRS\nZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FM\nQnVmZmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNR\nTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLkFic3RyYWN0U3RvcmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUXVlcnlDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2Fs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEEg\nU1FMIHF1ZXJ5LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZh\nZG9jCiAqLwpwdWJsaWMgY2xhc3MgU1FMU3RvcmVRdWVyeQogICAgZXh0ZW5k\ncyBBYnN0cmFjdFN0b3JlUXVlcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAg\nICAgICAoU1FMU3RvcmVRdWVyeS5jbGFzcyk7CgogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgZmluYWwgSkRCQ1N0b3JlIF9zdG9yZTsKCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdCBhIHF1ZXJ5IG1hbmFnZWQgYnkgdGhlIGdpdmVuIGNvbnRl\neHQuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxTdG9yZVF1ZXJ5KEpEQkNTdG9y\nZSBzdG9yZSkgewogICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAgfQoKICAg\nIHB1YmxpYyBKREJDU3RvcmUgZ2V0U3RvcmUoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdG9yZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Bh\ncmFtZXRlckRlY2xhcmF0aW9ucygpIHsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEYXRhU3RvcmVF\neGVjdXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\ncHVibGljIEV4ZWN1dG9yIG5ld0RhdGFTdG9yZUV4ZWN1dG9yKENsYXNzTWV0\nYURhdGEgbWV0YSwKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMpIHsKICAg\nICAgICByZXR1cm4gbmV3IFNRTEV4ZWN1dG9yKHRoaXMsIG1ldGEpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ2FuZGlkYXRlVHlwZSgp\nIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gcmVxdWlyZXNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSB7CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0\nZXMgdGhlIGZpbHRlciBhcyBhIFNRTCBxdWVyeS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHN0YXRpYyBjbGFzcyBTUUxFeGVjdXRvcgogICAgICAgIGV4dGVu\nZHMgQWJzdHJhY3RFeGVjdXRvciB7CgogICAgICAgIHByaXZhdGUgZmluYWwg\nQ2xhc3NNZXRhRGF0YSBfbWV0YTsKICAgICAgICBwcml2YXRlIGZpbmFsIGJv\nb2xlYW4gX3NlbGVjdDsKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4g\nX2NhbGw7ICAgLy8gbmF0aXZlIGNhbGwgc3RvcmVkIHByb2NlZHVyZQogICAg\nICAgIHByaXZhdGUgZmluYWwgUXVlcnlSZXN1bHRNYXBwaW5nIF9yZXN1bHRN\nYXBwaW5nOwoKICAgICAgICBwdWJsaWMgU1FMRXhlY3V0b3IoU1FMU3RvcmVR\ndWVyeSBxLCBDbGFzc01ldGFEYXRhIGNhbmRpZGF0ZSkgewogICAgICAgICAg\nICBRdWVyeUNvbnRleHQgY3R4ID0gcS5nZXRDb250ZXh0KCk7CiAgICAgICAg\nICAgIFN0cmluZyByZXN1bHRNYXBwaW5nID0gY3R4LmdldFJlc3VsdE1hcHBp\nbmdOYW1lKCk7CiAgICAgICAgICAgIGlmIChyZXN1bHRNYXBwaW5nID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfcmVzdWx0TWFwcGluZyA9IG51bGw7CiAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyID0gY3R4LmdldFN0b3JlQ29udGV4dCgpLmdldENsYXNzTG9h\nZGVyKCk7CiAgICAgICAgICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBv\ncyA9IHEuZ2V0U3RvcmUoKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0TWFwcGluZ1JlcG9zaXRvcnlJbnN0YW5jZSgpOwog\nICAgICAgICAgICAgICAgX3Jlc3VsdE1hcHBpbmcgPSByZXBvcy5nZXRRdWVy\neVJlc3VsdE1hcHBpbmcKICAgICAgICAgICAgICAgICAgICAoY3R4LmdldFJl\nc3VsdE1hcHBpbmdTY29wZSgpLCByZXN1bHRNYXBwaW5nLCBlbnZMb2FkZXIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIF9tZXRhID0gY2FuZGlkYXRlOwoKICAgICAgICAgICAg\nU3RyaW5nIHNxbCA9IFN0cmluZ1V0aWxzLnRyaW1Ub051bGwoY3R4LmdldFF1\nZXJ5U3RyaW5nKCkpOwogICAgICAgICAgICBpZiAoc3FsID09IG51bGwpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tc3FsIikpOwogICAgICAgICAgICBfc2VsZWN0ID0gcS5nZXRTdG9y\nZSgpLmdldERCRGljdGlvbmFyeSgpLmlzU2VsZWN0KHNxbCk7CiAgICAgICAg\nICAgIF9jYWxsID0gc3FsLmxlbmd0aCgpID4gNAogICAgICAgICAgICAgICAg\nJiYgc3FsLnN1YnN0cmluZygwLCA0KS5lcXVhbHNJZ25vcmVDYXNlKCJjYWxs\nIik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldE9wZXJhdGlv\nbihTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICByZXR1cm4gX3NlbGVjdCA/\nIE9QX1NFTEVDVCA6IAogICAgICAgICAgICAgICAgKHEuZ2V0Q29udGV4dCgp\nLmdldENhbmRpZGF0ZVR5cGUoKSAhPSBudWxsCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8IHEuZ2V0Q29udGV4dCgpLmdldFJlc3VsdFR5cGUoKSAhPSBu\ndWxsCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHEuZ2V0Q29udGV4dCgp\nLmdldFJlc3VsdE1hcHBpbmdOYW1lKCkgIT0gbnVsbCAKICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgcS5nZXRDb250ZXh0KCkuZ2V0UmVzdWx0TWFwcGlu\nZ1Njb3BlKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgPyBP\nUF9TRUxFQ1QgOiBPUF9VUERBVEU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgTnVtYmVyIGV4ZWN1dGVVcGRhdGUoU3RvcmVRdWVyeSBxLCBPYmplY3Rb\nXSBwYXJhbXMpIHsKICAgICAgICAgICAgSkRCQ1N0b3JlIHN0b3JlID0gKChT\nUUxTdG9yZVF1ZXJ5KSBxKS5nZXRTdG9yZSgpOwogICAgICAgICAgICBEQkRp\nY3Rpb25hcnkgZGljdCA9IHN0b3JlLmdldERCRGljdGlvbmFyeSgpOwogICAg\nICAgICAgICBTdHJpbmcgc3FsID0gcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnlT\ndHJpbmcoKTsKCiAgICAgICAgICAgIExpc3QgcGFyYW1MaXN0ID0gbmV3IEFy\ncmF5TGlzdChBcnJheXMuYXNMaXN0KHBhcmFtcykpOwogICAgICAgICAgICBT\nUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcihkaWN0KS5hcHBlbmQoc3Fs\nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gbWFr\nZSBzdXJlIHdlIGhhdmUgYW4gYWN0aXZlIHN0b3JlIGNvbm5lY3Rpb24KICAg\nICAgICAgICAgc3RvcmUuZ2V0Q29udGV4dCgpLmJlZ2luU3RvcmUoKTsKICAg\nICAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gc3RvcmUuZ2V0Q29ubmVjdGlv\nbigpOwogICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pCiAgICAgICAgICAgICAgICBx\nLmdldENvbnRleHQoKS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKCiAgICAg\nICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChfY2FsbCkKICAgICAg\nICAgICAgICAgICAgICBzdG1udCA9IHByZXBhcmVDYWxsKGNvbm4sIGJ1Zik7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc3Rt\nbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIGJ1Zik7CiAgICAgICAgICAg\nICAgICAKICAgICAgICAgICAgICAgIGJ1Zi5zZXRQYXJhbWV0ZXJzKHBhcmFt\nTGlzdCk7CiAgICAgICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBidWYuc2V0UGFyYW1ldGVycyhzdG1udCk7Cgog\nICAgICAgICAgICAgICAgZGljdC5zZXRUaW1lb3V0cyhzdG1udCwgZmV0Y2gs\nIHRydWUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbnQg\nY291bnQgPSBleGVjdXRlVXBkYXRlKHN0b3JlLCBjb25uLCBzdG1udCwgYnVm\nKTsgIAogICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIE51\nbWJlcnMudmFsdWVPZihjb3VudCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgdGhyb3cgU1FMRXhj\nZXB0aW9ucy5nZXRTdG9yZShzZSwgZGljdCk7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIHNhZmUgdG8gaWdub3JlCiAgICAgICAgICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RtbnQgPSBudWxsOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29ubi5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRl\nUXVlcnkoU3RvcmVRdWVyeSBxLAogICAgICAgICAgICBPYmplY3RbXSBwYXJh\nbXMsIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSA9ICgoU1FMU3RvcmVRdWVyeSkgcSkuZ2V0U3RvcmUoKTsKICAgICAgICAg\nICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBzdG9yZS5nZXREQkRpY3Rpb25hcnko\nKTsKICAgICAgICAgICAgU3RyaW5nIHNxbCA9IHEuZ2V0Q29udGV4dCgpLmdl\ndFF1ZXJ5U3RyaW5nKCk7CgogICAgICAgICAgICBMaXN0IHBhcmFtTGlzdCA9\nIG5ldyBBcnJheUxpc3QoQXJyYXlzLmFzTGlzdChwYXJhbXMpKTsKICAgICAg\nICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoZGljdCkuYXBw\nZW5kKHNxbCk7CiAgICAgICAgICAgIENvbm5lY3Rpb24gY29ubiA9IHN0b3Jl\nLmdldENvbm5lY3Rpb24oKTsKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKQogICAg\nICAgICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCk7CgogICAgICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciByb3A7\nCiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gbnVsbDsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIHVzZSB0aGUg\ncmlnaHQgbWV0aG9kIGRlcGVuZGluZyBvbiBzZWwgdnMuIHByb2MsIGxycyBz\nZXR0aW5nCiAgICAgICAgICAgICAgICBpZiAoX3NlbGVjdCAmJiAhcmFuZ2Uu\nbHJzKQogICAgICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRl\nbWVudChjb25uLCBidWYpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoX3Nl\nbGVjdCkKICAgICAgICAgICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0\nZW1lbnQoY29ubiwgYnVmLCBmZXRjaCwgLTEsIC0xKTsKICAgICAgICAgICAg\nICAgIGVsc2UgaWYgKCFyYW5nZS5scnMpCiAgICAgICAgICAgICAgICAgICAg\nc3RtbnQgPSBwcmVwYXJlQ2FsbChjb25uLCBidWYpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZUNh\nbGwoY29ubiwgYnVmLCBmZXRjaCwgLTEsIC0xKTsKCiAgICAgICAgICAgICAg\nICBpbnQgaW5kZXggPSAwOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpID0gcGFyYW1MaXN0Lml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpICYmIAog\nICAgICAgICAgICAgICAgICAgIHN0bW50ICE9IG51bGw7KQogICAgICAgICAg\nICAgICAgICAgIGRpY3Quc2V0VW5rbm93bihzdG1udCwgKytpbmRleCwgaS5u\nZXh0KCksIG51bGwpOwoKICAgICAgICAgICAgICAgIGRpY3Quc2V0VGltZW91\ndHMoc3RtbnQsIGZldGNoLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBSZXN1\nbHRTZXQgcnMgPSBleGVjdXRlUXVlcnkoc3RvcmUsIGNvbm4sIHN0bW50LCBi\ndWYsIHBhcmFtTGlzdCk7CiAgICAgICAgICAgICAgICBSZXN1bHRTZXRSZXN1\nbHQgcmVzID0gc3RtbnQgIT0gbnVsbCA/IAogICAgICAgICAgICAgICAgICAg\nIG5ldyBSZXN1bHRTZXRSZXN1bHQoY29ubiwgc3RtbnQsIHJzLCBzdG9yZSkg\nOgogICAgICAgICAgICAgICAgICAgIG5ldyBSZXN1bHRTZXRSZXN1bHQoY29u\nbiwgcnMsIGRpY3QpOwogICAgICAgICAgICAgICAgaWYgKF9yZXN1bHRNYXBw\naW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcm9wID0gbmV3IE1h\ncHBlZFF1ZXJ5UmVzdWx0T2JqZWN0UHJvdmlkZXIoX3Jlc3VsdE1hcHBpbmcs\nCiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLCBmZXRjaCwgcmVzKTsK\nICAgICAgICAgICAgICAgIGVsc2UgaWYgKHEuZ2V0Q29udGV4dCgpLmdldENh\nbmRpZGF0ZVR5cGUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJv\ncCA9IG5ldyBHZW5lcmljUmVzdWx0T2JqZWN0UHJvdmlkZXIoKENsYXNzTWFw\ncGluZykgX21ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLCBm\nZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICByb3AgPSBuZXcgU1FMUHJvamVjdGlvblJlc3VsdE9iamVjdFBy\nb3ZpZGVyKHN0b3JlLCBmZXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAg\ncmVzLCBxLmdldENvbnRleHQoKS5nZXRSZXN1bHRUeXBlKCkpOwogICAgICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRy\neSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIp\nIHt9CiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAgICAgICB0aHJv\ndyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBkaWN0KTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDAgfHwgcmFu\nZ2UuZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICAgICAgcm9w\nID0gbmV3IFJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCByYW5nZS5z\ndGFydCxyYW5nZS5lbmQpOwogICAgICAgICAgICByZXR1cm4gcm9wOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZ1tdIGdldERhdGFTdG9yZUFj\ndGlvbnMoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAg\nICAgIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3Ry\naW5nW117IHEuZ2V0Q29udGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCkgfTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzUGFja2luZyhTdG9y\nZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIHEuZ2V0Q29udGV4dCgp\nLmdldENhbmRpZGF0ZVR5cGUoKSA9PSBudWxsOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICAvKioKICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBw\ncm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAg\nICAgICAgICogaW1wbGVtZW50YXRpb24gb2YgcHJlcGFyaW5nIGNhbGwgc3Rh\ndGVtZW50LgogICAgICAgICAqLwogICAgICAgIHByb3RlY3RlZCBQcmVwYXJl\nZFN0YXRlbWVudCBwcmVwYXJlQ2FsbChDb25uZWN0aW9uIGNvbm4sIFNRTEJ1\nZmZlciBidWYpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gYnVmLnByZXBhcmVDYWxsKGNvbm4pOyAgICAg\nICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKioKICAgICAg\nICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBu\nb24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgICAgICogaW1wbGVtZW50YXRp\nb24gb2YgZXhlY3V0aW5nIHVwZGF0ZS4KICAgICAgICAgKi8KICAgICAgICBw\ncm90ZWN0ZWQgaW50IGV4ZWN1dGVVcGRhdGUoSkRCQ1N0b3JlIHN0b3JlLCBD\nb25uZWN0aW9uIGNvbm4sIAogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgU1FMQnVmZmVyIGJ1ZikgCiAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBpbnQgY291bnQgPSAwOwogICAg\nICAgICAgICBpZiAoX2NhbGwgJiYgc3RtbnQuZXhlY3V0ZSgpID09IGZhbHNl\nKSB7CiAgICAgICAgICAgICAgICBjb3VudCA9IHN0bW50LmdldFVwZGF0ZUNv\ndW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICAvLyBuYXRpdmUgaW5zZXJ0LCB1cGRhdGUsIGRlbGV0ZQog\nICAgICAgICAgICAgICAgY291bnQgPSBzdG1udC5leGVjdXRlVXBkYXRlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvdW50OwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBUaGlzIG1l\ndGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBK\nREJDLWxpa2UgCiAgICAgICAgICogaW1wbGVtZW50YXRpb24gb2YgcHJlcGFy\naW5nIGNhbGwgc3RhdGVtZW50LgogICAgICAgICAqLwogICAgICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlQ2FsbChDb25uZWN0aW9u\nIGNvbm4sIFNRTEJ1ZmZlciBidWYsCiAgICAgICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5cGUsIGludCByc0NvbmN1cikK\nICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIHJldHVybiBidWYucHJlcGFyZUNhbGwoY29ubiwgZmV0Y2gsIHJzVHlwZSwg\ncnNDb25jdXIpOyAgCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24t\nSkRCQyBvciBKREJDLWxpa2UgCiAgICAgICAgICogaW1wbGVtZW50YXRpb24g\nb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAgICAgICAgKi8KICAgICAgICBw\ncm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChD\nb25uZWN0aW9uIGNvbm4sIAogICAgICAgICAgICBTUUxCdWZmZXIgYnVmKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIGJ1Zi5w\ncmVwYXJlU3RhdGVtZW50KGNvbm4pOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICAvKioKICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRl\nIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgICAg\nICogaW1wbGVtZW50YXRpb24gb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAg\nICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQg\ncHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4sIAogICAgICAgICAg\nICBTUUxCdWZmZXIgYnVmLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgcnNUeXBlLAogICAgICAgICAgICBpbnQgcnNDb25jdXIpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gYnVmLnByZXBh\ncmVTdGF0ZW1lbnQoY29ubiwgZmV0Y2gsIHJzVHlwZSwgcnNDb25jdXIpOwog\nICAgICAgIH0KICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBUaGlz\nIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBv\nciBKREJDLWxpa2UgCiAgICAgICAgICogaW1wbGVtZW50YXRpb24gb2YgZXhl\nY3V0aW5nIHF1ZXJ5LgogICAgICAgICAqLwogICAgICAgIHByb3RlY3RlZCBS\nZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KEpEQkNTdG9yZSBzdG9yZSwgQ29ubmVj\ndGlvbiBjb25uLAogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgU1FMQnVmZmVyIGJ1ZiwgTGlzdCBwYXJhbUxpc3QpCiAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gc3Rt\nbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAg\nIC8qKgogICAgICAgICAqIFRoZSBnaXZlbiBxdWVyeSBpcyBwYXJzZWQgdG8g\nZmluZCB0aGUgcGFyYW1ldGVyIHRva2VucyBvZiB0aGUgZm9ybQogICAgICAg\nICAqIDxjb2RlPj9uPC9jb2RlPiB3aGljaCBpcyBkaWZmZXJlbnQgdGhhbiA8\nY29kZT4/PC9jb2RlPiB0b2tlbnMgaW4KICAgICAgICAgKiBhY3R1YWwgU1FM\nIHBhcmFtZXRlciB0b2tlbnMuIFRoZXNlIDxjb2RlPj9uPC9jb2RlPiBzdHls\nZSB0b2tlbnMKICAgICAgICAgKiBhcmUgcmVwbGFjZWQgaW4gdGhlIHF1ZXJ5\nIHN0cmluZyBieSA8Y29kZT4/PC9jb2RlPiB0b2tlbnMuIAogICAgICAgICAq\nIAogICAgICAgICAqIER1cmluZyB0aGUgdG9rZW4gcGFyc2luZywgdGhlIG9y\nZGVyaW5nIG9mIHRoZSB0b2tlbnMgaXMgcmVjb3JkZWQuIAogICAgICAgICAq\nIFRoZSBnaXZlbiB1c2VyUGFyYW0gbXVzdCBjb250YWluIHBhcmFtZXRlciBr\nZXlzIGFzIEludGVnZXIgYW5kCiAgICAgICAgICogdGhlIHNhbWUgSW50ZWdl\ncnMgbXVzdCBhcHBlYXIgaW4gdGhlIHRva2Vucy4gCiAgICAgICAgICogCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRvUGFyYW1ldGVy\nQXJyYXkoU3RvcmVRdWVyeSBxLCBNYXAgdXNlclBhcmFtcykgewogICAgICAg\nICAgICBpZiAodXNlclBhcmFtcyA9PSBudWxsIHx8IHVzZXJQYXJhbXMuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIFN0b3JlUXVlcnkuRU1Q\nVFlfT0JKRUNUUzsKICAgICAgICAgICAgU3RyaW5nIHNxbCA9IHEuZ2V0Q29u\ndGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCk7CiAgICAgICAgICAgIExpc3Q8SW50\nZWdlcj4gcGFyYW1PcmRlciA9IG5ldyBBcnJheUxpc3Q8SW50ZWdlcj4oKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHNxbCA9IHN1YnN0\naXR1dGVQYXJhbXMoc3FsLCBwYXJhbU9yZGVyKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoSU9FeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKGV4LmdldExvY2FsaXplZE1lc3NhZ2UoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIE9iamVj\ndFtdIHJlc3VsdCA9IG5ldyBPYmplY3RbcGFyYW1PcmRlci5zaXplKCldOwog\nICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yIChJbnRl\nZ2VyIGtleSA6IHBhcmFtT3JkZXIpIHsKICAgICAgICAgICAgICAgIGlmICgh\ndXNlclBhcmFtcy5jb250YWluc0tleShrZXkpKSAKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidXBhcmFt\nLW1pc3NpbmciLCAKICAgICAgICAgICAgICAgICAgICAgICAga2V5LCBzcWws\nIHVzZXJQYXJhbXMpKTsKICAgICAgICAgICAgICAgIHJlc3VsdFtpZHgrK10g\nPSB1c2VyUGFyYW1zLmdldChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIC8vIG1vZGlmeSBvcmlnaW5hbCBKUEEtc3R5bGUgU1FMIHRvIHByb3Bl\nciBTUUwKICAgICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnkoKS5z\nZXRRdWVyeShzcWwpOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBVdGlsaXR5IG1ldGhv\nZCB0byBzdWJzdGl0dXRlICc/bnVtJyBmb3IgcGFyYW1ldGVycyBpbiB0aGUg\nZ2l2ZW4gU1FMCiAgICAgKiBzdGF0ZW1lbnQsIGFuZCBmaWxsLWluIHRoZSBv\ncmRlciBvZiB0aGUgcGFyYW1ldGVyIHRva2VucwogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIFN0cmluZyBzdWJzdGl0dXRlUGFyYW1zKFN0cmluZyBzcWws\nIExpc3Q8SW50ZWdlcj4gcGFyYW1PcmRlcikKICAgICAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBubyAi\nPyIgcGFyYW1ldGVyIG1hcmtlciwgdGhlbiB3ZSBkb24ndCBuZWVkIHRvCiAg\nICAgICAgICAgIC8vIHBlcmZvcm0gdGhlIHBhcnNpbmcgcHJvY2VzcwogICAg\nICAgICAgICBpZiAoc3FsLmluZGV4T2YoIj8iKSA9PSAtMSkKICAgICAgICAg\nICAgICAgIHJldHVybiBzcWw7CgogICAgICAgICAgICBwYXJhbU9yZGVyLmNs\nZWFyKCk7CiAgICAgICAgICAgIFN0cmVhbVRva2VuaXplciB0b2sgPSBuZXcg\nU3RyZWFtVG9rZW5pemVyKG5ldyBTdHJpbmdSZWFkZXIoc3FsKSk7CiAgICAg\nICAgICAgIHRvay5yZXNldFN5bnRheCgpOwogICAgICAgICAgICB0b2sucXVv\ndGVDaGFyKCdcJycpOwogICAgICAgICAgICB0b2sud29yZENoYXJzKCcwJywg\nJzknKTsKICAgICAgICAgICAgdG9rLndvcmRDaGFycygnPycsICc/Jyk7Cgog\nICAgICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWls\nZGVyKHNxbC5sZW5ndGgoKSk7CiAgICAgICAgICAgIGZvciAoaW50IHR0eXBl\nOyAodHR5cGUgPSB0b2submV4dFRva2VuKCkpICE9CiAgICAgICAgICAgICAg\nICAgICAgU3RyZWFtVG9rZW5pemVyLlRUX0VPRjspIHsKICAgICAgICAgICAg\nICAgIHN3aXRjaCAodHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNl\nIFN0cmVhbVRva2VuaXplci5UVF9XT1JEOgogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBhIHRva2VuIGlzIGEgcG9zaXRpb25hbCBwYXJhbWV0ZXIgaWYg\naXQgc3RhcnRzIHdpdGgKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYSAi\nPyIgYW5kIHRoZSByZXN0IG9mIHRoZSB0b2tlbiBhcmUgYWxsIG51bWJlcnMK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvay5zdmFsLnN0YXJ0c1dp\ndGgoIj8iKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiPyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5n\nIHBJbmRleCA9IHRvay5zdmFsLnN1YnN0cmluZygxKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChwSW5kZXgubGVuZ3RoKCkgPiAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1PcmRlci5hZGQo\nSW50ZWdlci52YWx1ZU9mKHBJbmRleCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIHsgLy8gb3Igbm90aGluZwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcmFtT3JkZXIuYWRkKHBhcmFtT3JkZXIu\nc2l6ZSgpKzEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQodG9rLnN2YWwpOwogICAgICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlJ1wn\nJzoKICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgnXCcnKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvay5zdmFsICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQodG9r\nLnN2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZCgnXCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKChjaGFy\nKSB0dHlwZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQp9Cg==\n","encoding":"base64"}

