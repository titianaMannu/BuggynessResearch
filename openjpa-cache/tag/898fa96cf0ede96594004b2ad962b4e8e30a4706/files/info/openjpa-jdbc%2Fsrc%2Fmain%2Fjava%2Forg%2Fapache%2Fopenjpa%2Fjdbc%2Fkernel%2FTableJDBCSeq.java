{"sha":"84471026a80d84d05d8545b9fd7f8a3c94c9ed8e","node_id":"MDQ6QmxvYjIwNjM2NDo4NDQ3MTAyNmE4MGQ4NGQwNWQ4NTQ1YjlmZDdmOGEzYzk0YzllZDhl","size":35099,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/84471026a80d84d05d8545b9fd7f8a3c94c9ed8e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5Db25u\nZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0ZW1lbnQ7Cmlt\ncG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5TUUxF\neGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwoKaW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLk5vdFN1\ncHBvcnRlZEV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nbGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uSW1wbDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZpZXIuTm9ybWFs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZp\nZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuaWRlbnRpZmllci5RdWFsaWZpZWREQklkZW50aWZpZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmll\nci5EQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2w7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9u\nYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd0lt\ncGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVm\nZmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZp\nZ3VyYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5D\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5j\nb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5pZGVudGlmaWVyLklkZW50aWZpZXJVdGlsOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCmltcG9ydCBzZXJw\nLnV0aWwuTnVtYmVyczsKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBOT1RFOiBEbyBu\nb3QgY2hhbmdlIHByb3BlcnR5IG5hbWVzOyBzZWUgU2VxdWVuY2VNZXRhRGF0\nYQovLyBhbmQgU2VxdWVuY2VNYXBwaW5nIGZvciBzdGFuZGFyZCBwcm9wZXJ0\neSBuYW1lcy4KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovKioKICoge0BsaW5rIEpEQkNT\nZXF9IGltcGxlbWVudGF0aW9uIHRoYXQgdXNlcyBhIGRhdGFiYXNlIHRhYmxl\nCiAqIGZvciBzZXF1ZW5jZSBudW1iZXIgZ2VuZXJhdGlvbi4gVGhpcyBiYXNl\nIGltcGxlbWVudGF0aW9uIHVzZXMgYSBzaW5nbGUKICogcm93IGZvciBhIGds\nb2JhbCBzZXF1ZW5jZSBudW1iZXIuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqLwpwdWJsaWMgY2xhc3MgVGFibGVKREJDU2VxCiAgICBleHRlbmRzIEFi\nc3RyYWN0SkRCQ1NlcQogICAgaW1wbGVtZW50cyBDb25maWd1cmFibGUgewoK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9EUk9QID0g\nImRyb3AiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9O\nX0FERCA9ICJhZGQiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nQUNUSU9OX0dFVCA9ICJnZXQiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgQUNUSU9OX1NFVCA9ICJzZXQiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgREVGQVVMVF9UQUJMRSA9ICJPUEVOSlBBX1NFUVVFTkNF\nX1RBQkxFIjsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChUYWJs\nZUpEQkNTZXEuY2xhc3MpOwoKICAgIHByaXZhdGUgdHJhbnNpZW50IEpEQkND\nb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNp\nZW50IExvZyBfbG9nID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9hbGxvYyA9\nIDUwOwogICAgcHJpdmF0ZSBpbnQgX2ludFZhbHVlID0gMTsKICAgIHByaXZh\ndGUgZmluYWwgSGFzaE1hcDxDbGFzc01hcHBpbmcsIFN0YXR1cz4gX3N0YXQg\nPQogICAgICAgIG5ldyBIYXNoTWFwPENsYXNzTWFwcGluZywgU3RhdHVzPigp\nOwoKICAgIHByaXZhdGUgREJJZGVudGlmaWVyIF90YWJsZSA9IERCSWRlbnRp\nZmllci5uZXdUYWJsZShERUZBVUxUX1RBQkxFKTsKICAgIHByaXZhdGUgREJJ\nZGVudGlmaWVyIF9zZXFDb2x1bW5OYW1lID0gREJJZGVudGlmaWVyLm5ld0Nv\nbHVtbigiU0VRVUVOQ0VfVkFMVUUiKTsKICAgIHByaXZhdGUgREJJZGVudGlm\naWVyIF9wa0NvbHVtbk5hbWUgPSBEQklkZW50aWZpZXIubmV3Q29sdW1uKCJJ\nRCIpOwogICAgcHJpdmF0ZSBEQklkZW50aWZpZXJbXSBfdW5pcXVlQ29sdW1u\nTmFtZXM7CiAgICBwcml2YXRlIERCSWRlbnRpZmllciBfdW5pcXVlQ29uc3Ry\nYWludE5hbWUgPSBEQklkZW50aWZpZXIuTlVMTDsKCiAgICBwcml2YXRlIENv\nbHVtbiBfc2VxQ29sdW1uID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uIF9w\na0NvbHVtbiA9IG51bGw7CiAgICAKICAgIC8qKgogICAgICogVGhlIHNlcXVl\nbmNlIHRhYmxlIG5hbWUuIERlZmF1bHRzIHRvIDxjb2RlPk9QRU5KUEFfU0VR\nVUVOQ0VfVEFCTEU8L2NvZGU+LgogICAgICogQnkgZGVmYXVsdCwgdGhlIHRh\nYmxlIHdpbGwgYmUgcGxhY2VkIGluIHRoZSBmaXJzdCBzY2hlbWEgbGlzdGVk\nIGluIHlvdXIKICAgICAqIDxjb2RlPm9wZW5qcGEuamRiYy5TY2hlbWFzPC9j\nb2RlPiBwcm9wZXJ0eSwgb3IgaW4gdGhlIGRlZmF1bHQgc2NoZW1hIGlmCiAg\nICAgKiB0aGUgcHJvcGVydHkgaXMgbm90IGdpdmVuLiBJZiB5b3Ugc3BlY2lm\neSBhIHRhYmxlIG5hbWUgaW4gdGhlIGZvcm0KICAgICAqIDxjb2RlPiZsdDtz\nY2hlbWEmZ3Q7LiZsdDt0YWJsZSZndDs8L2NvZGU+LCB0aGVuIHRoZSBnaXZl\nbiBzY2hlbWEKICAgICAqIHdpbGwgYmUgdXNlZC4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXRUYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3RhYmxl\nLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzZXF1ZW5j\nZSB0YWJsZSBuYW1lLiBEZWZhdWx0cyB0byA8Y29kZT5PUEVOSlBBX1NFUVVF\nTkNFX1RBQkxFPC9jb2RlPi4KICAgICAqIEJ5IGRlZmF1bHQsIHRoZSB0YWJs\nZSB3aWxsIGJlIHBsYWNlZCBpbiB0aGUgZmlyc3Qgc2NoZW1hIGxpc3RlZCBp\nbiB5b3VyCiAgICAgKiA8Y29kZT5vcGVuanBhLmpkYmMuU2NoZW1hczwvY29k\nZT4gcHJvcGVydHksIG9yIGluIHRoZSBkZWZhdWx0IHNjaGVtYSBpZgogICAg\nICogdGhlIHByb3BlcnR5IGlzIG5vdCBnaXZlbi4gSWYgeW91IHNwZWNpZnkg\nYSB0YWJsZSBuYW1lIGluIHRoZSBmb3JtCiAgICAgKiA8Y29kZT4mbHQ7c2No\nZW1hJmd0Oy4mbHQ7dGFibGUmZ3Q7PC9jb2RlPiwgdGhlbiB0aGUgZ2l2ZW4g\nc2NoZW1hCiAgICAgKiB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFRhYmxlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgLy8gU3Bs\naXQgdGhlIG5hbWUgaW50byBpdHMgaW5kaXZpZHVhbCBwYXJ0cwogICAgICAg\nIFN0cmluZ1tdIG5hbWVzID0gTm9ybWFsaXplci5zcGxpdE5hbWUobmFtZSk7\nCiAgICAgICAgLy8gSm9pbiB0aGUgbmFtZSBiYWNrIHRvZ2V0aGVyLiAgVGhp\ncyB3aWxsIGRlbGltaXQgYXMgYXBwcm9wcmlhdGUuCiAgICAgICAgX3RhYmxl\nID0gREJJZGVudGlmaWVyLm5ld1RhYmxlKE5vcm1hbGl6ZXIuam9pbk5hbWVz\nKG5hbWVzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGVwcmVjYXRlZCBV\nc2Uge0BsaW5rICNzZXRUYWJsZX0uIFJldGFpbmVkIGZvcgogICAgICogYmFj\na3dhcmRzLWNvbXBhdGliaWxpdHkJd2l0aCBhdXRvLWNvbmZpZ3VyYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRhYmxlTmFtZShTdHJpbmcg\nbmFtZSkgewogICAgICAgIHNldFRhYmxlKG5hbWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGNvbHVtbiB0aGF0IGhvbGRzIHRo\nZSBzZXF1ZW5jZSB2YWx1ZS4gRGVmYXVsdHMKICAgICAqIHRvIDxjb2RlPlNF\nUVVFTkNFX1ZBTFVFPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXRTZXF1ZW5jZUNvbHVtbigpIHsKICAgICAgICByZXR1cm4gX3NlcUNv\nbHVtbk5hbWUuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIG5hbWUgb2YgdGhlIGNvbHVtbiB0aGF0IGhvbGRzIHRoZSBzZXF1ZW5jZSB2\nYWx1ZS4gRGVmYXVsdHMKICAgICAqIHRvIDxjb2RlPlNFUVVFTkNFX1ZBTFVF\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U2VxdWVuY2VD\nb2x1bW4oU3RyaW5nIHNlcXVlbmNlQ29sdW1uKSB7CiAgICAgICAgX3NlcUNv\nbHVtbk5hbWUgPSBEQklkZW50aWZpZXIubmV3Q29sdW1uKHNlcXVlbmNlQ29s\ndW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSB0\nYWJsZSdzIHByaW1hcnkga2V5IGNvbHVtbi4gRGVmYXVsdHMgdG8KICAgICAq\nIDxjb2RlPklEPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRQcmltYXJ5S2V5Q29sdW1uKCkgewogICAgICAgIHJldHVybiBfcGtDb2x1\nbW5OYW1lLmdldE5hbWUoKTsKICAgIH0KCiAgICBwdWJsaWMgREJJZGVudGlm\naWVyIGdldFByaW1hcnlLZXlDb2x1bW5JZGVudGlmaWVyKCkgewogICAgICAg\nIHJldHVybiBfcGtDb2x1bW5OYW1lOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIG5hbWUgb2YgdGhlIHRhYmxlJ3MgcHJpbWFyeSBrZXkgY29sdW1uLiBE\nZWZhdWx0cyB0bwogICAgICogPGNvZGU+SUQ8L2NvZGU+LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRQcmltYXJ5S2V5Q29sdW1uKFN0cmluZyBwcmlt\nYXJ5S2V5Q29sdW1uKSB7CiAgICAgICAgX3BrQ29sdW1uTmFtZSA9IERCSWRl\nbnRpZmllci5uZXdDb2x1bW4ocHJpbWFyeUtleUNvbHVtbik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBzZXF1ZW5jZXMg\ndG8gYWxsb2NhdGUgZm9yIGVhY2ggdXBkYXRlIG9mIHRoZQogICAgICogc2Vx\ndWVuY2UgdGFibGUuIFNlcXVlbmNlIG51bWJlcnMgd2lsbCBiZSBncmFiYmVk\nIGluIGJsb2NrcyBvZiB0aGlzCiAgICAgKiB2YWx1ZSB0byByZWR1Y2UgdGhl\nIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgdGhhdCBtdXN0IGJlIHBlcmZvcm1l\nZCBvbgogICAgICogdGhlIHNlcXVlbmNlIHRhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgaW50IGdldEFsbG9jYXRlKCkgewogICAgICAgIHJldHVybiBfYWxs\nb2M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBv\nZiBzZXF1ZW5jZXMgdG8gYWxsb2NhdGUgZm9yIGVhY2ggdXBkYXRlIG9mIHRo\nZQogICAgICogc2VxdWVuY2UgdGFibGUuIFNlcXVlbmNlIG51bWJlcnMgd2ls\nbCBiZSBncmFiYmVkIGluIGJsb2NrcyBvZiB0aGlzCiAgICAgKiB2YWx1ZSB0\nbyByZWR1Y2UgdGhlIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgdGhhdCBtdXN0\nIGJlIHBlcmZvcm1lZCBvbgogICAgICogdGhlIHNlcXVlbmNlIHRhYmxlLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBbGxvY2F0ZShpbnQgYWxsb2Mp\nIHsKICAgICAgICBfYWxsb2MgPSBhbGxvYzsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBhcyB0aGUgaW5pdGlhbCBudW1i\nZXIgZm9yIHRoZSAKICAgICAqIEdlbmVyYXRlZFZhbHVlLlRBQkxFIHN0cmF0\nZWd5IHRvIHN0YXJ0IHdpdGguIAogICAgICogQHJldHVybiBhbiBpbml0aWFs\nIG51bWJlcgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEluaXRpYWxWYWx1\nZSgpIHsKICAgICAgICByZXR1cm4gX2ludFZhbHVlOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBpbml0aWFsIG51bWJlciBpbiB0aGUgdGFibGUg\nZm9yIHRoZSBHZW5lcmF0ZWRWYWx1ZS5UQUJMRQogICAgICogc3RyYXRlZ3kg\ndG8gdXNlIGFzIGluaXRpYWwgbnVtYmVyLiAKICAgICAqIEBwYXJhbSBpbnRW\nYWx1ZS4gVGhlIGluaXRpYWwgbnVtYmVyCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEluaXRpYWxWYWx1ZShpbnQgaW50VmFsdWUpIHsKICAgICAgICBf\naW50VmFsdWUgPSBpbnRWYWx1ZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBTZXRzIHRoZSBuYW1lcyBvZiB0aGUgY29sdW1ucyBvbiB3aGljaCBhIHVu\naXF1ZSBjb25zdHJhaW50IGlzIHNldC4KICAgICAqIEBwYXJhbSBjb2x1bW5z\nTmFtZXMgYXJlIHBhc3NlZCBhcyBhIHNpbmdsZSBTdHJpbmcgY29uY2F0ZW5h\ndGVkIHdpdGgKICAgICAqIGEgJ3wnIGNoYXJhY3Rlci4gVGhpcyBtZXRob2Qg\ncGFyc2VzIGl0IGJhY2sgdG8gYXJyYXkgb2YgU3RyaW5ncy4gCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFVuaXF1ZUNvbHVtbnMoU3RyaW5nIGNvbHVt\nbk5hbWVzKSB7CiAgICAJX3VuaXF1ZUNvbHVtbk5hbWVzID0gKFN0cmluZ1V0\naWxzLmlzRW1wdHkoY29sdW1uTmFtZXMpKSAKICAgIAkJPyBudWxsIDogREJJ\nZGVudGlmaWVyLnNwbGl0KGNvbHVtbk5hbWVzLCBEQklkZW50aWZpZXJUeXBl\nLkNPTFVNTiwgSWRlbnRpZmllclV0aWwuQkFSKTsKICAgIH0KICAgIAogICAg\ncHVibGljIFN0cmluZyBnZXRVbmlxdWVDb2x1bW5zKCkgewogICAgCXJldHVy\nbiBOb3JtYWxpemVyLmpvaW5OYW1lcyhEQklkZW50aWZpZXIudG9TdHJpbmdB\ncnJheShfdW5pcXVlQ29sdW1uTmFtZXMpLCBJZGVudGlmaWVyVXRpbC5CQVIp\nOwogICAgfQoKICAgIC8qKgogICAgICogQGRlcHJlY2F0ZWQgVXNlIHtAbGlu\nayAjc2V0QWxsb2NhdGV9LiBSZXRhaW5lZCBmb3IgYmFja3dhcmRzCiAgICAg\nKiBjb21wYXRpYmlsaXR5IG9mIGF1dG8tY29uZmlndXJhdGlvbi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0SW5jcmVtZW50KGludCBpbmMpIHsKICAg\nICAgICBzZXRBbGxvY2F0ZShpbmMpOwogICAgfQoKICAgIHB1YmxpYyBKREJD\nQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJl\ndHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1\ncmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0g\nKEpEQkNDb25maWd1cmF0aW9uKSBjb25mOwogICAgICAgIF9sb2cgPSBfY29u\nZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX1JVTlRJTUUpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAg\nICAgIGJ1aWxkVGFibGUoKTsKICAgIH0KICAgIAoKICAgIHB1YmxpYyB2b2lk\nIGFkZFNjaGVtYShDbGFzc01hcHBpbmcgbWFwcGluZywgU2NoZW1hR3JvdXAg\nZ3JvdXApIHsKICAgICAgICAvLyBTaW5jZSB0aGUgdGFibGUgaXMgY3JlYXRl\nZCBieSBvcGVuanBhIGludGVybmFsbHkKICAgICAgICAvLyB3ZSBjYW4gY3Jl\nYXRlIHRoZSB0YWJsZSBmb3IgZWFjaCBzY2hlbWEgd2l0aGluIHRoZSBQVQog\nICAgICAgIC8vIGluIGhlcmUuCiAgICAgICAgCiAgICAgICAgU2NoZW1hW10g\nc2NoZW1hcyA9IGdyb3VwLmdldFNjaGVtYXMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgUXVhbGlmaWVkREJJZGVudGlmaWVyIHBhdGggPSBRdWFsaWZpZWREQklk\nZW50aWZpZXIuZ2V0UGF0aChfdGFibGUpOwogICAgICAgICAgICBEQklkZW50\naWZpZXIgc2NoZW1hTmFtZSA9IHBhdGguZ2V0U2NoZW1hTmFtZSgpOwogICAg\nICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzRW1wdHkoc2NoZW1hTmFtZSkp\nIHsKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBTY2hlbWFzLmdldE5l\nd1RhYmxlU2NoZW1hSWRlbnRpZmllcihfY29uZik7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFt\nZSkpIHsKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBzY2hlbWFzW2ld\nLmdldElkZW50aWZpZXIoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gY3JlYXRlIHRhYmxlIGluIHRoaXMgZ3JvdXAKICAgICAgICAgICAgU2No\nZW1hIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1lKTsKICAg\nICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBzY2hlbWEgPSBncm91cC5hZGRTY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIFRhYmxlIGNvcHkg\nPSBzY2hlbWEuaW1wb3J0VGFibGUoX3BrQ29sdW1uLmdldFRhYmxlKCkpOwog\nICAgICAgICAgICAvLyBpbXBvcnRUYWJsZSgpIGRvZXMgbm90IGltcG9ydCB1\nbmlxdWUgY29uc3RyYWludHMKICAgICAgICAgICAgVW5pcXVlW10gdW5pcXVl\ncyA9IF9wa0NvbHVtbi5nZXRUYWJsZSgpLmdldFVuaXF1ZXMoKTsKICAgICAg\nICAgICAgZm9yIChVbmlxdWUgdSA6IHVuaXF1ZXMpIHsKICAgICAgICAgICAg\nCWNvcHkuaW1wb3J0VW5pcXVlKHUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIC8vIHdlIG5lZWQgdG8gcmVzZXQgdGhlIHRhYmxlIG5hbWUgaW4gdGhl\nIGNvbHVtbiB3aXRoIHRoZQogICAgICAgICAgICAvLyBmdWxseSBxdWFsaWZp\nZWQgbmFtZSBmb3IgbWF0Y2hpbmcgdGhlIHRhYmxlIG5hbWUgZnJvbSB0aGUK\nICAgICAgICAgICAgLy8gQ29sdW1uLgogICAgICAgICAgICBfcGtDb2x1bW4u\ncmVzZXRUYWJsZUlkZW50aWZpZXIoUXVhbGlmaWVkREJJZGVudGlmaWVyLm5l\nd1BhdGgoc2NoZW1hTmFtZSwgX3BrQ29sdW1uLmdldFRhYmxlSWRlbnRpZmll\ncigpKSk7CiAgICAgICAgICAgIC8vIHNvbWUgZGF0YWJhc2VzIHJlcXVpcmUg\ndG8gY3JlYXRlIGFuIGluZGV4IGZvciB0aGUgc2VxdWVuY2UgdGFibGUKICAg\nICAgICAgICAgX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKS5jcmVh\ndGVJbmRleElmTmVjZXNzYXJ5KHNjaGVtYSwKICAgICAgICAgICAgICAgICAg\nICBfdGFibGUsIF9wa0NvbHVtbik7CiAgICAgICAgfQogICAgfQoKICAgIHBy\nb3RlY3RlZCBPYmplY3QgbmV4dEludGVybmFsKEpEQkNTdG9yZSBzdG9yZSwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gaWYgbmVlZGVkLCBncmFiIHRoZSBuZXh0IGhhbmRm\ndWwgb2YgaWRzCiAgICAgICAgU3RhdHVzIHN0YXQgPSBnZXRTdGF0dXMobWFw\ncGluZyk7CiAgICAgICAgaWYgKHN0YXQgPT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLXNlcS10eXBlIiwKICAgICAgICAgICAgICAgIGdldENsYXNzKCksIG1hcHBp\nbmcpKTsKCiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChzdGF0KSB7CiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgc2VxIGlzIGF0IGxlYXN0IDEsIHNpbmNlIGF1dG9hc3NpZ25lZCBpZHMg\nb2YgMCBjYW4KICAgICAgICAgICAgICAgIC8vIGNvbmZsaWN0IHdpdGggdW5p\nbml0aWFsaXplZCB2YWx1ZXMKICAgICAgICAgICAgICAgIHN0YXQuc2VxID0g\nTWF0aC5tYXgoc3RhdC5zZXEsIDEpOwogICAgICAgICAgICAgICAgaWYgKHN0\nYXQuc2VxIDwgc3RhdC5tYXgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIE51bWJlcnMudmFsdWVPZihzdGF0LnNlcSsrKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBhbGxvY2F0ZVNlcXVlbmNlKHN0b3JlLCBtYXBwaW5nLCBz\ndGF0LCBfYWxsb2MsIHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90\nZWN0ZWQgT2JqZWN0IGN1cnJlbnRJbnRlcm5hbChKREJDU3RvcmUgc3RvcmUs\nIENsYXNzTWFwcGluZyBtYXBwaW5nKQogICAgICAgIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGlmIChjdXJyZW50ID09IG51bGwpIHsKICAgICAgICAg\nICAgQ3VycmVudFNlcXVlbmNlUnVubmFibGUgcnVubmFibGUgPQogICAgICAg\nICAgICAgICAgbmV3IEN1cnJlbnRTZXF1ZW5jZVJ1bm5hYmxlKHN0b3JlLCBt\nYXBwaW5nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlm\nIChzdXNwZW5kSW5KVEEoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIE5v\ndFN1cHBvcnRlZEV4Y2VwdGlvbiBpcyB3cmFwcGVkIGluIGEgU3RvcmVFeGNl\ncHRpb24gYnkKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgY2FsbGVyLgog\nICAgICAgICAgICAgICAgICAgIF9jb25mLmdldE1hbmFnZWRSdW50aW1lSW5z\ndGFuY2UoKS5kb05vblRyYW5zYWN0aW9uYWxXb3JrKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcnVubmFibGUpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBydW5uYWJsZS5ydW4oKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhyb3cgKEV4Y2VwdGlv\nbikgKHJlLmdldENhdXNlKCkgPT0gbnVsbCA/IHJlIDogcmUuZ2V0Q2F1c2Uo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1\ncGVyLmN1cnJlbnRJbnRlcm5hbChzdG9yZSwgbWFwcGluZyk7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIHZvaWQgYWxsb2NhdGVJbnRlcm5hbChpbnQgY291bnQs\nIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGlu\nZykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdGF0\ndXMgc3RhdCA9IGdldFN0YXR1cyhtYXBwaW5nKTsKICAgICAgICBpZiAoc3Rh\ndCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHdoaWxl\nICh0cnVlKSB7CiAgICAgICAgICAgIGludCBhdmFpbGFibGU7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoc3RhdCkgewogICAgICAgICAgICAgICAgYXZh\naWxhYmxlID0gKGludCkgKHN0YXQubWF4IC0gc3RhdC5zZXEpOwogICAgICAg\nICAgICAgICAgaWYgKGF2YWlsYWJsZSA+PSBjb3VudCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxs\nb2NhdGVTZXF1ZW5jZShzdG9yZSwgbWFwcGluZywgc3RhdCwgY291bnQgLSBh\ndmFpbGFibGUsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGFwcHJvcHJpYXRlIHN0YXR1cyBvYmplY3QgZm9y\nIHRoZSBnaXZlbiBjbGFzcywgb3IgbnVsbAogICAgICogaWYgY2Fubm90IGhh\nbmRsZSB0aGUgZ2l2ZW4gY2xhc3MuIFRoZSBtYXBwaW5nIG1heSBiZSBudWxs\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdHVzIGdldFN0YXR1cyhDbGFz\nc01hcHBpbmcgbWFwcGluZykgeyAgCiAgICAgICAgU3RhdHVzIHN0YXR1cyA9\nIChTdGF0dXMpX3N0YXQuZ2V0KG1hcHBpbmcpOyAgICAgICAgCiAgICAgICAg\naWYgKHN0YXR1cyA9PSBudWxsKXsgCiAgICAgICAgICAgIHN0YXR1cyA9IG5l\ndyBTdGF0dXMoKTsKICAgICAgICAgICAgX3N0YXQucHV0KG1hcHBpbmcsIHN0\nYXR1cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgdGhlIHByaW1hcnkga2V5IGNvbHVtbiB0\nbyB0aGUgZ2l2ZW4gdGFibGUgYW5kIHJldHVybiBpdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIENvbHVtbiBhZGRQcmltYXJ5S2V5Q29sdW1uKFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBfY29uZi5nZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIENvbHVtbiBwa0NvbHVt\nbiA9IHRhYmxlLmFkZENvbHVtbihkaWN0LmdldFZhbGlkQ29sdW1uTmFtZQog\nICAgICAgICAgICAoZ2V0UHJpbWFyeUtleUNvbHVtbklkZW50aWZpZXIoKSwg\ndGFibGUpKTsKICAgICAgICBwa0NvbHVtbi5zZXRUeXBlKGRpY3QuZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5USU5ZSU5UKSk7CiAgICAgICAgcGtDb2x1bW4u\nc2V0SmF2YVR5cGUoSmF2YVR5cGVzLklOVCk7CiAgICAgICAgcmV0dXJuIHBr\nQ29sdW1uOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmlt\nYXJ5IGtleSB2YWx1ZSBmb3IgdGhlIHNlcXVlbmNlIHRhYmxlIGZvciB0aGUg\nZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgZ2V0\nUHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIHJl\ndHVybiBOdW1iZXJzLnZhbHVlT2YoMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGVzIHRoZSBvYmplY3QtbGV2ZWwgcmVwcmVzZW50YXRpb24gb2Yg\ndGhlIHNlcXVlbmNlIHRhYmxlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYnVpbGRUYWJsZSgpIHsKICAgICAgICBEQklkZW50aWZpZXIgdGFibGVOYW1l\nID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgREJJZGVudGlmaWVyIHNj\naGVtYU5hbWUgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBRdWFsaWZp\nZWREQklkZW50aWZpZXIgcGF0aCA9IFF1YWxpZmllZERCSWRlbnRpZmllci5n\nZXRQYXRoKF90YWJsZSk7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNF\nbXB0eShwYXRoLmdldFNjaGVtYU5hbWUoKSkpIHsKICAgICAgICAgICAgc2No\nZW1hTmFtZSA9IHBhdGguZ2V0U2NoZW1hTmFtZSgpOwogICAgICAgICAgICB0\nYWJsZU5hbWUgPSBwYXRoLmdldFVucXVhbGlmaWVkTmFtZSgpOwogICAgICAg\nIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGFibGVOYW1lID0gX3Rh\nYmxlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoREJJZGVudGlm\naWVyLmlzRW1wdHkoc2NoZW1hTmFtZSkpIHsKICAgICAgICAgICAgc2NoZW1h\nTmFtZSA9IFNjaGVtYXMuZ2V0TmV3VGFibGVTY2hlbWFJZGVudGlmaWVyKF9j\nb25mKTsKICAgICAgICB9CgogICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0g\nbmV3IFNjaGVtYUdyb3VwKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdy\nb3VwLmFkZFNjaGVtYShzY2hlbWFOYW1lKTsKCiAgICAgICAgVGFibGUgdGFi\nbGUgPSBzY2hlbWEuYWRkVGFibGUodGFibGVOYW1lKTsKICAgICAgICBfcGtD\nb2x1bW4gPSBhZGRQcmltYXJ5S2V5Q29sdW1uKHRhYmxlKTsKICAgICAgICBQ\ncmltYXJ5S2V5IHBrID0gdGFibGUuYWRkUHJpbWFyeUtleSgpOwogICAgICAg\nIHBrLmFkZENvbHVtbihfcGtDb2x1bW4pOwoKICAgICAgICBEQkRpY3Rpb25h\ncnkgZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAg\nICAgICAgX3NlcUNvbHVtbiA9IHRhYmxlLmFkZENvbHVtbihkaWN0LmdldFZh\nbGlkQ29sdW1uTmFtZQogICAgICAgICAgICAoX3NlcUNvbHVtbk5hbWUsIHRh\nYmxlKSk7CiAgICAgICAgX3NlcUNvbHVtbi5zZXRUeXBlKGRpY3QuZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5CSUdJTlQpKTsKICAgICAgICBfc2VxQ29sdW1u\nLnNldEphdmFUeXBlKEphdmFUeXBlcy5MT05HKTsKICAgICAgICAKICAgICAg\nICBpZiAoX3VuaXF1ZUNvbHVtbk5hbWVzICE9IG51bGwpIHsKICAgICAgICAg\nICAgREJJZGVudGlmaWVyIHVuaXF1ZU5hbWUgPSBfdW5pcXVlQ29uc3RyYWlu\ndE5hbWU7CiAgICAgICAgICAgIGlmIChEQklkZW50aWZpZXIuaXNFbXB0eSh1\nbmlxdWVOYW1lKSkgewogICAgICAgICAgICAgICAgdW5pcXVlTmFtZSA9IGRp\nY3QuZ2V0VmFsaWRVbmlxdWVOYW1lKERCSWRlbnRpZmllci5uZXdDb25zdHJh\naW50KCJVTlEiKSwgdGFibGUpOwogICAgICAgICAgICB9CiAgICAJCVVuaXF1\nZSB1ID0gdGFibGUuYWRkVW5pcXVlKHVuaXF1ZU5hbWUpOwogICAgCQlmb3Ig\nKERCSWRlbnRpZmllciBjb2x1bW5OYW1lIDogX3VuaXF1ZUNvbHVtbk5hbWVz\nKSB7CiAgICAJCQlpZiAoIXRhYmxlLmNvbnRhaW5zQ29sdW1uKGNvbHVtbk5h\nbWUsIF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCkpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ1bmlxdWUtbWlzc2luZy1jb2x1bW4iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29sdW1uTmFtZSwgdGFibGUuZ2V0SWRlbnRpZmllcigpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuZ2V0Q29sdW1uTmFt\nZXMoKSkpOwogICAgCQkJQ29sdW1uIGNvbCA9IHRhYmxlLmdldENvbHVtbihj\nb2x1bW5OYW1lKTsKICAgIAkJCXUuYWRkQ29sdW1uKGNvbCk7CiAgICAJCX0K\nICAgICAgICB9CiAgICAgICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRh\ndGVzIHRoZSBtYXggYXZhaWxhYmxlIHNlcXVlbmNlIHZhbHVlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWxsb2NhdGVTZXF1ZW5jZShKREJDU3RvcmUg\nc3RvcmUsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgICAgICBTdGF0\ndXMgc3RhdCwgaW50IGFsbG9jLCBib29sZWFuIHVwZGF0ZVN0YXRTZXEpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFJ1bm5hYmxlIHJ1bm5hYmxl\nID0KICAgICAgICAgICAgbmV3IEFsbG9jYXRlU2VxdWVuY2VSdW5uYWJsZSgK\nICAgICAgICAgICAgICAgICAgICBzdG9yZSwgbWFwcGluZywgc3RhdCwgYWxs\nb2MsIHVwZGF0ZVN0YXRTZXEpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChzdXNwZW5kSW5KVEEoKSkgewogICAgICAgICAgICAgICAgLy8gTm90\nU3VwcG9ydGVkRXhjZXB0aW9uIGlzIHdyYXBwZWQgaW4gYSBTdG9yZUV4Y2Vw\ndGlvbiBieQogICAgICAgICAgICAgICAgLy8gdGhlIGNhbGxlci4KICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfY29uZi5nZXRNYW5h\nZ2VkUnVudGltZUluc3RhbmNlKCkuZG9Ob25UcmFuc2FjdGlvbmFsV29yaygK\nICAgICAgICAgICAgICAgICAgICAgICAgcnVubmFibGUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2goTm90U3VwcG9ydGVkRXhj\nZXB0aW9uIG5zZSkgeyAKICAgICAgICAgICAgICAgICAgICBTUUxFeGNlcHRp\nb24gc3FsRXggPSBuZXcgU1FMRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbnNlLmdldExvY2FsaXplZE1lc3NhZ2UoKSk7CiAgICAg\nICAgICAgICAgICAgICAgc3FsRXguaW5pdENhdXNlKG5zZSk7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgc3FsRXg7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBydW5uYWJsZS5y\ndW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgVGhyb3dhYmxlIGUgPSByZS5n\nZXRDYXVzZSgpOwogICAgICAgICAgICBpZihlIGluc3RhbmNlb2YgU1FMRXhj\nZXB0aW9uICkgCiAgICAgICAgICAgICAgICB0aHJvdyAoU1FMRXhjZXB0aW9u\nKSBlOwogICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAgICAgdGhyb3cg\ncmU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0\naGUgaW5pdGlhbCBzZXF1ZW5jZSBjb2x1bW4gaW50byB0aGUgZGF0YWJhc2Uu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBtYXBwaW5nCiAgICAgKiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyBmb3IgdGhlIGNsYXNzIHdob3NlIHNlcXVlbmNl\nIGNvbHVtbiB3aWxsIGJlCiAgICAgKiAgICAgICAgICAgIHVwZGF0ZWQKICAg\nICAqIEBwYXJhbSBjb25uCiAgICAgKiAgICAgICAgICAgIENvbm5lY3Rpb24g\ndXNlZCBpc3N1ZSBTUUwgc3RhdGVtZW50cy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGluc2VydFNlcXVlbmNlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgX2xvZy50cmFjZShfbG9jLmdldCgiaW5zZXJ0LXNlcSIpKTsKCiAgICAg\nICAgT2JqZWN0IHBrID0gZ2V0UHJpbWFyeUtleShtYXBwaW5nKTsKICAgICAg\nICBpZiAocGsgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFs\naWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXNlcS10eXBlIiwKICAg\nICAgICAgICAgICAgIGdldENsYXNzKCksIG1hcHBpbmcpKTsKCiAgICAgICAg\nREJEaWN0aW9uYXJ5IGRpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0\nYW5jZSgpOwogICAgICAgIERCSWRlbnRpZmllciB0YWJsZU5hbWUgPSByZXNv\nbHZlVGFibGVJZGVudGlmaWVyKG1hcHBpbmcsIF9wa0NvbHVtbi5nZXRUYWJs\nZSgpKTsKICAgICAgICBTUUxCdWZmZXIgaW5zZXJ0ID0gbmV3IFNRTEJ1ZmZl\ncihkaWN0KS5hcHBlbmQoIklOU0VSVCBJTlRPICIpLgogICAgICAgICAgICBh\ncHBlbmQodGFibGVOYW1lKS5hcHBlbmQoIiAoIikuCiAgICAgICAgICAgIGFw\ncGVuZChfcGtDb2x1bW4pLmFwcGVuZCgiLCAiKS5hcHBlbmQoX3NlcUNvbHVt\nbikuCiAgICAgICAgICAgIGFwcGVuZCgiKSBWQUxVRVMgKCIpLgogICAgICAg\nICAgICBhcHBlbmRWYWx1ZShwaywgX3BrQ29sdW1uKS5hcHBlbmQoIiwgIiku\nCiAgICAgICAgICAgIGFwcGVuZFZhbHVlKF9pbnRWYWx1ZSwgX3NlcUNvbHVt\nbikuYXBwZW5kKCIpIik7CiAgICAgICAgCiAgICAgICAgYm9vbGVhbiB3YXNB\ndXRvID0gY29ubi5nZXRBdXRvQ29tbWl0KCk7CiAgICAgICAgaWYgKCF3YXNB\ndXRvICYmICFzdXNwZW5kSW5KVEEoKSkKICAgICAgICAgICAgY29ubi5zZXRB\ndXRvQ29tbWl0KHRydWUpOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RtbnQg\nPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIGluc2VydCk7CiAgICAgICAgICAg\nIGRpY3Quc2V0VGltZW91dHMoc3RtbnQsIF9jb25mLCB0cnVlKTsKICAgICAg\nICAgICAgZXhlY3V0ZVVwZGF0ZShfY29uZiwgY29ubiwgc3RtbnQsIGluc2Vy\ndCwgUm93SW1wbC5BQ1RJT05fSU5TRVJUKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkge30KICAgICAgICAgICAgaWYgKCF3YXNBdXRvICYmICFzdXNwZW5k\nSW5KVEEoKSkKICAgICAgICAgICAgICAgIGNvbm4uc2V0QXV0b0NvbW1pdChm\nYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRo\nZSBjdXJyZW50IHNlcXVlbmNlIHZhbHVlLgogICAgICogCiAgICAgKiBAcGFy\nYW0gbWFwcGluZwogICAgICogICAgICAgICAgICBDbGFzc01hcHBpbmcgb2Yg\ndGhlIGVudGl0eSB3aG9zZSBzZXF1ZW5jZSB2YWx1ZSB3aWxsIGJlCiAgICAg\nKiAgICAgICAgICAgIG9idGFpbmVkLgogICAgICogQHBhcmFtIGNvbm4KICAg\nICAqICAgICAgICAgICAgQ29ubmVjdGlvbiB1c2VkIGlzc3VlIFNRTCBzdGF0\nZW1lbnRzLgogICAgICogCiAgICAgKiBAcmV0dXJuIFRoZSBjdXJyZW50IHNl\ncXVlbmNlIHZhbHVlLCBvciA8Y29kZT5TRVFVRU5DRV9OT1RfRk9VTkQ8L2Nv\nZGU+CiAgICAgKiAgICAgICAgIGlmIHRoZSBzZXF1ZW5jZSBjb3VsZCBub3Qg\nYmUgZm91bmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBsb25nIGdldFNlcXVl\nbmNlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgiZ2V0LXNlcSIpKTsKCiAgICAgICAgT2JqZWN0IHBrID0gZ2V0UHJp\nbWFyeUtleShtYXBwaW5nKTsKICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBEQkRpY3Rpb25hcnkgZGlj\ndCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAg\nU1FMQnVmZmVyIHNlbCA9IG5ldyBTUUxCdWZmZXIoZGljdCkuYXBwZW5kKF9z\nZXFDb2x1bW4pOwogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxC\ndWZmZXIoZGljdCkuYXBwZW5kKF9wa0NvbHVtbikuYXBwZW5kKCIgPSAiKS4K\nICAgICAgICAgICAgYXBwZW5kVmFsdWUocGssIF9wa0NvbHVtbik7CiAgICAg\nICAgREJJZGVudGlmaWVyIHRhYmxlTmFtZSA9IHJlc29sdmVUYWJsZUlkZW50\naWZpZXIobWFwcGluZywgX3NlcUNvbHVtbi5nZXRUYWJsZSgpKTsKICAgICAg\nICBTUUxCdWZmZXIgdGFibGVzID0gbmV3IFNRTEJ1ZmZlcihkaWN0KS5hcHBl\nbmQodGFibGVOYW1lKTsKCiAgICAgICAgU1FMQnVmZmVyIHNlbGVjdCA9IGRp\nY3QudG9TZWxlY3Qoc2VsLCBudWxsLCB0YWJsZXMsIHdoZXJlLCBudWxsLCBu\ndWxsLAogICAgICAgICAgICAgICAgbnVsbCwgZmFsc2UsIGRpY3Quc3VwcG9y\ndHNTZWxlY3RGb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFLAogICAgICAg\nICAgICAgICAgZmFsc2UsIHRydWUpOwoKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdG1udCA9IHByZXBhcmVT\ndGF0ZW1lbnQoY29ubiwgc2VsZWN0KTsKICAgICAgICAgICAgZGljdC5zZXRU\naW1lb3V0cyhzdG1udCwgX2NvbmYsIGZhbHNlKTsKICAgICAgICAgICAgcnMg\nPSBleGVjdXRlUXVlcnkoX2NvbmYsIGNvbm4sIHN0bW50LCBzZWxlY3QpOwog\nICAgICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UocnMsIGRpY3QpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVs\nbCkgICAgCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR3JhYnMgdGhlIG5leHQgaGFuZGZ1bCBvZiBzZXF1\nZW5jZSBudW1iZXJzLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0\naGUgc2VxdWVuY2Ugd2FzIHVwZGF0ZWQsIGZhbHNlIGlmIG5vIHNlcXVlbmNl\nCiAgICAgKiByb3cgZXhpc3RlZCBmb3IgdGhpcyBtYXBwaW5nCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBib29sZWFuIHNldFNlcXVlbmNlKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBTdGF0dXMgc3RhdCwgaW50IGluYywKICAgICAgICBib29s\nZWFuIHVwZGF0ZVN0YXRTZXEsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJ1\ncGRhdGUtc2VxIikpOwoKICAgICAgICBPYmplY3QgcGsgPSBnZXRQcmltYXJ5\nS2V5KG1hcHBpbmcpOwogICAgICAgIGlmIChwayA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtc2VxLXR5cGUiLAogICAgICAgICAgICAgICAgZ2V0Q2xhc3MoKSwg\nbWFwcGluZykpOwoKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25m\nLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7ICAgICAgICAKICAgICAgICBT\nUUxCdWZmZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKGRpY3QpLmFwcGVuZChf\ncGtDb2x1bW4pLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgIGFwcGVuZFZh\nbHVlKHBrLCBfcGtDb2x1bW4pOwoKICAgICAgICAvLyBsb29wIHVudGlsIHdl\nIGhhdmUgYSBzdWNjZXNzZnVsIGF0b21pYyBzZWxlY3QvdXBkYXRlIHNlcXVl\nbmNlCiAgICAgICAgbG9uZyBjdXIgPSAwOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50OwogICAgICAgIFJlc3VsdFNldCByczsKICAgICAgICBT\nUUxCdWZmZXIgdXBkOwogICAgICAgIGZvciAoaW50IHVwZGF0ZXMgPSAwOyB1\ncGRhdGVzID09IDA7KSB7CiAgICAgICAgICAgIHN0bW50ID0gbnVsbDsKICAg\nICAgICAgICAgcnMgPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgY3VyID0gZ2V0U2VxdWVuY2UobWFwcGluZywgY29ubik7CiAg\nICAgICAgICAgICAgICBpZiAoY3VyID09IC0xKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUg\ndGhlIHZhbHVlCiAgICAgICAgICAgICAgICB1cGQgPSBuZXcgU1FMQnVmZmVy\nKGRpY3QpOwogICAgICAgICAgICAgICAgREJJZGVudGlmaWVyIHRhYmxlTmFt\nZSA9IHJlc29sdmVUYWJsZUlkZW50aWZpZXIobWFwcGluZywKICAgICAgICAg\nICAgICAgICAgICAgICAgX3NlcUNvbHVtbi5nZXRUYWJsZSgpKTsKICAgICAg\nICAgICAgICAgIHVwZC5hcHBlbmQoIlVQREFURSAiKS5hcHBlbmQodGFibGVO\nYW1lKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoIiBTRVQgIikuYXBw\nZW5kKF9zZXFDb2x1bW4pLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgICAg\nICAgICAgYXBwZW5kVmFsdWUoTnVtYmVycy52YWx1ZU9mKGN1ciArIGluYyks\nIF9zZXFDb2x1bW4pLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZCgiIFdI\nRVJFICIpLmFwcGVuZCh3aGVyZSkuYXBwZW5kKCIgQU5EICIpLgogICAgICAg\nICAgICAgICAgICAgIGFwcGVuZChfc2VxQ29sdW1uKS5hcHBlbmQoIiA9ICIp\nLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZFZhbHVlKE51bWJlcnMudmFs\ndWVPZihjdXIpLCBfc2VxQ29sdW1uKTsKCiAgICAgICAgICAgICAgICBzdG1u\ndCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgdXBkKTsKICAgICAgICAgICAg\nICAgIGRpY3Quc2V0VGltZW91dHMoc3RtbnQsIF9jb25mLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIHVwZGF0ZXMgPSBleGVjdXRlVXBkYXRlKF9jb25mLCBj\nb25uLCBzdG1udCwgdXBkLAogICAgICAgICAgICAgICAgICAgICAgICBSb3dJ\nbXBsLkFDVElPTl9VUERBVEUpOwogICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgaWYgKHJzICE9IG51bGwpIAogICAgICAgICAgICAg\nICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkge30KICAgICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gc2V0dXAgbmV3IHNlcXVlbmNlIHJhbmdlICAgICAg\nICAKICAgICAgICBzeW5jaHJvbml6ZWQgKHN0YXQpIHsKICAgICAgICAgICAg\naWYgKHVwZGF0ZVN0YXRTZXEgJiYgc3RhdC5zZXEgPCBjdXIpCiAgICAgICAg\nICAgICAgICBzdGF0LnNlcSA9IGN1cjsKICAgICAgICAgICAgaWYgKHN0YXQu\nbWF4IDwgY3VyICsgaW5jKQogICAgICAgICAgICAgICAgc3RhdC5tYXggPSBj\ndXIgKyBpbmM7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQogICAgLyoqCiAgICAgKiBSZXNvbHZlIGEgZnVsbHkgcXVhbGlmaWVkIHRh\nYmxlIG5hbWUKICAgICAqIAogICAgICogQHBhcmFtIGNsYXNzCiAgICAgKiAg\nICAgICAgICAgIG1hcHBpbmcgdG8gZ2V0IHRoZSBzY2hlbWEgbmFtZQogICAg\nICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIFN0cmluZyByZXNv\nbHZlVGFibGVOYW1lKENsYXNzTWFwcGluZyBtYXBwaW5nLCBUYWJsZSB0YWJs\nZSkgewogICAgICAgIHJldHVybiByZXNvbHZlVGFibGVJZGVudGlmaWVyKG1h\ncHBpbmcsIHRhYmxlKS5nZXROYW1lKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXNvbHZlIGEgZnVsbHkgcXVhbGlmaWVkIHRhYmxlIG5hbWUKICAgICAq\nIAogICAgICogQHBhcmFtIGNsYXNzCiAgICAgKiAgICAgICAgICAgIG1hcHBp\nbmcgdG8gZ2V0IHRoZSBzY2hlbWEgbmFtZQogICAgICovCiAgICBwdWJsaWMg\nREJJZGVudGlmaWVyIHJlc29sdmVUYWJsZUlkZW50aWZpZXIoQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgREJJZGVudGlm\naWVyIHNOYW1lID0gbWFwcGluZy5nZXRUYWJsZSgpLmdldFNjaGVtYUlkZW50\naWZpZXIoKTsKICAgICAgICBEQklkZW50aWZpZXIgdGFibGVOYW1lID0gREJJ\nZGVudGlmaWVyLk5VTEw7CiAgICAgICAgaWYgKERCSWRlbnRpZmllci5pc051\nbGwoc05hbWUpKSB7CiAgICAgICAgICAgIHRhYmxlTmFtZSA9IHRhYmxlLmdl\ndEZ1bGxJZGVudGlmaWVyKCk7CiAgICAgICAgfSBlbHNlIGlmICghREJJZGVu\ndGlmaWVyLmlzTnVsbCh0YWJsZS5nZXRTY2hlbWFJZGVudGlmaWVyKCkpKSB7\nCiAgICAgICAgICAgIHRhYmxlTmFtZSA9IHRhYmxlLmdldEZ1bGxJZGVudGlm\naWVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFibGVOYW1l\nID0gUXVhbGlmaWVkREJJZGVudGlmaWVyLm5ld1BhdGgoc05hbWUsIHRhYmxl\nLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\nYWJsZU5hbWU7CiAgICB9CgogICAgCiAgICAvKioKICAgICAqIENyZWF0ZXMg\ndGhlIHNlcXVlbmNlIHRhYmxlIGluIHRoZSBEQi4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgcmVmcmVzaFRhYmxlKCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoX2xvZy5pc0luZm9FbmFibGVkKCkpCiAg\nICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgibWFrZS1zZXEtdGFibGUi\nKSk7CgogICAgICAgIC8vIGNyZWF0ZSB0aGUgdGFibGUKICAgICAgICBTY2hl\nbWFUb29sIHRvb2wgPSBuZXcgU2NoZW1hVG9vbChfY29uZik7CiAgICAgICAg\ndG9vbC5zZXRJZ25vcmVFcnJvcnModHJ1ZSk7CiAgICAgICAgdG9vbC5jcmVh\ndGVUYWJsZShfcGtDb2x1bW4uZ2V0VGFibGUoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEcm9wcyB0aGUgc2VxdWVuY2UgdGFibGUgaW4gdGhlIERCLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBkcm9wVGFibGUoKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfbG9nLmlzSW5mb0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJkcm9w\nLXNlcS10YWJsZSIpKTsKCiAgICAgICAgLy8gZHJvcCB0aGUgdGFibGUKICAg\nICAgICBTY2hlbWFUb29sIHRvb2wgPSBuZXcgU2NoZW1hVG9vbChfY29uZik7\nCiAgICAgICAgdG9vbC5zZXRJZ25vcmVFcnJvcnModHJ1ZSk7CiAgICAgICAg\ndG9vbC5kcm9wVGFibGUoX3BrQ29sdW1uLmdldFRhYmxlKCkpOwogICAgfQoK\nICAgIC8vLy8vLy8vLwogICAgLy8gTWFpbgogICAgLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuVGFibGVKREJDU2VxdWVuY2UgW29wdGlvbl0qCiAgICAgKiAt\nYWN0aW9uLy1hICZsdDthZGQgfCBkcm9wIHwgZ2V0IHwgc2V0Jmd0OyBbdmFs\ndWVdCiAgICAgKiAgV2hlcmUgdGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSBy\nZWNvZ25pemVkLgogICAgICogPHVsPgogICAgICogPGxpPjxpPi1wcm9wZXJ0\naWVzLy1wICZsdDtwcm9wZXJ0aWVzIGZpbGUgb3IgcmVzb3VyY2UmZ3Q7PC9p\nPjogVGhlCiAgICAgKiBwYXRoIG9yIHJlc291cmNlIG5hbWUgb2YgYSBPcGVu\nSlBBIHByb3BlcnRpZXMgZmlsZSBjb250YWluaW5nCiAgICAgKiBpbmZvcm1h\ndGlvbiBzdWNoIGFzIHRoZSBsaWNlbnNlIGtleQlhbmQgY29ubmVjdGlvbiBk\nYXRhIGFzCiAgICAgKiBvdXRsaW5lZCBpbiB7QGxpbmsgSkRCQ0NvbmZpZ3Vy\nYXRpb259LiBPcHRpb25hbC48L2xpPgogICAgICogPGxpPjxpPi0mbHQ7cHJv\ncGVydHkgbmFtZSZndDsgJmx0O3Byb3BlcnR5IHZhbHVlJmd0OzwvaT46IEFs\nbCBiZWFuCiAgICAgKiBwcm9wZXJ0aWVzIG9mIHRoZSBPcGVuSlBBIHtAbGlu\nayBKREJDQ29uZmlndXJhdGlvbn0gY2FuIGJlIHNldCBieQogICAgICogdXNp\nbmcgdGhlaXIJbmFtZXMgYW5kIHN1cHBseWluZyBhIHZhbHVlLiBGb3IgZXhh\nbXBsZToKICAgICAqIDxjb2RlPi1saWNlbnNlS2V5IGFkc2xmamE4M3IzbGth\nZGY8L2NvZGU+PC9saT4KICAgICAqIDwvdWw+CiAgICAgKiAgVGhlIHZhcmlv\ndXMgYWN0aW9ucyBhcmUgYXMgZm9sbG93cy4KICAgICAqIDx1bD4KICAgICAq\nIDxsaT48aT5hZGQ8L2k+OiBDcmVhdGUgdGhlIHNlcXVlbmNlIHRhYmxlLjwv\nbGk+CiAgICAgKiA8bGk+PGk+ZHJvcDwvaT46IERyb3AgdGhlIHNlcXVlbmNl\nIHRhYmxlLjwvbGk+CiAgICAgKiA8bGk+PGk+Z2V0PC9pPjogUHJpbnQgdGhl\nIGN1cnJlbnQgc2VxdWVuY2UgdmFsdWUuPC9saT4KICAgICAqIDxsaT48aT5z\nZXQ8L2k+OiBTZXQgdGhlIHNlcXVlbmNlIHZhbHVlLjwvbGk+CiAgICAgKiA8\nL3VsPgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJp\nbmdbXSBhcmdzKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgZmluYWwg\nU3RyaW5nW10gYXJndW1lbnRzID0gb3B0cy5zZXRGcm9tQ21kTGluZShhcmdz\nKTsKICAgICAgICBib29sZWFuIHJldCA9IENvbmZpZ3VyYXRpb25zLnJ1bkFn\nYWluc3RBbGxBbmNob3JzKG9wdHMsCiAgICAgICAgICAgIG5ldyBDb25maWd1\ncmF0aW9ucy5SdW5uYWJsZSgpIHsKICAgICAgICAgICAgcHVibGljIGJvb2xl\nYW4gcnVuKE9wdGlvbnMgb3B0cykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBKREJDQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IEpEQkND\nb25maWd1cmF0aW9uSW1wbCgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gVGFibGVKREJDU2VxLnJ1bihjb25m\nLCBhcmd1bWVudHMsIG9wdHMpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgICAgICBjb25mLmNsb3NlKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBp\nZiAoIXJldCkKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKF9sb2Mu\nZ2V0KCJzZXEtdXNhZ2UiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4g\ndGhlIHRvb2wuIFJldHVybnMgZmFsc2UgaWYgaW52YWxpZCBvcHRpb25zIHdl\ncmUgZ2l2ZW4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBy\ndW4oSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAg\nICAgICBPcHRpb25zIG9wdHMpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgU3RyaW5nIGFjdGlvbiA9IG9wdHMucmVtb3ZlUHJvcGVydHko\nImFjdGlvbiIsICJhIiwgbnVsbCk7CiAgICAgICAgQ29uZmlndXJhdGlvbnMu\ncG9wdWxhdGVDb25maWd1cmF0aW9uKGNvbmYsIG9wdHMpOwogICAgICAgIHJl\ndHVybiBydW4oY29uZiwgYXJncywgYWN0aW9uKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJuIGZhbHNlIGlmIGFuIGludmFs\naWQgb3B0aW9uIHdhcyBnaXZlbi4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBib29sZWFuIHJ1bihKREJDQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdb\nXSBhcmdzLAogICAgICAgIFN0cmluZyBhY3Rpb24pCiAgICAgICAgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSB8fCAo\nYXJncy5sZW5ndGggIT0gMAogICAgICAgICAgICAmJiAhQUNUSU9OX1NFVC5l\ncXVhbHMoYWN0aW9uKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgVGFibGVKREJDU2VxIHNlcSA9IG5ldyBUYWJsZUpEQkNTZXEoKTsK\nICAgICAgICBTdHJpbmcgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5nZXRQcm9w\nZXJ0aWVzKGNvbmYuZ2V0U2VxdWVuY2UoKSk7CiAgICAgICAgQ29uZmlndXJh\ndGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc2VxLCBjb25mLCBwcm9wcyk7Cgog\nICAgICAgIGlmIChBQ1RJT05fRFJPUC5lcXVhbHMoYWN0aW9uKSkKICAgICAg\nICAgICAgc2VxLmRyb3BUYWJsZSgpOwogICAgICAgIGVsc2UgaWYgKEFDVElP\nTl9BREQuZXF1YWxzKGFjdGlvbikpCiAgICAgICAgICAgIHNlcS5yZWZyZXNo\nVGFibGUoKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fR0VULmVxdWFscyhh\nY3Rpb24pIHx8IEFDVElPTl9TRVQuZXF1YWxzKGFjdGlvbikpIHsKICAgICAg\nICAgICAgQ29ubmVjdGlvbiBjb25uID0gY29uZi5nZXREYXRhU291cmNlMihu\ndWxsKS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBsb25nIGN1ciA9IHNlcS5nZXRTZXF1ZW5jZShudWxsLCBj\nb25uKTsKICAgICAgICAgICAgICAgIGlmIChBQ1RJT05fR0VULmVxdWFscyhh\nY3Rpb24pKQogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRs\nbihjdXIpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9uZyBzZXQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3Mu\nbGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgc2V0ID0gTG9u\nZy5wYXJzZUxvbmcoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICBzZXQgPSBjdXIgKyBzZXEuZ2V0\nQWxsb2NhdGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2V0IDwgY3Vy\nKQogICAgICAgICAgICAgICAgICAgICAgICBzZXQgPSBjdXI7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0\nYXR1cyBzdGF0ID0gc2VxLmdldFN0YXR1cyhudWxsKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgc2VxLnNldFNlcXVlbmNlKG51bGwsIHN0YXQsIChpbnQp\nIChzZXQgLSBjdXIpLCB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY29ubik7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldCA9IHN0YXQu\nc2VxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBTeXN0ZW0uZXJyLnByaW50bG4oc2V0KTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoTnVtYmVyRm9ybWF0\nRXhjZXB0aW9uIG5mZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdHJ5\nIHsgY29ubi5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIHN0cnVjdCB0byBob2xkIHN0YXR1cyBpbmZvcm1h\ndGlvbi4KICAgICAqLwogICAgQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIp\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIFN0YXR1cwogICAgICAgIGlt\ncGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIGxvbmcg\nc2VxID0gMUw7CiAgICAgICAgcHVibGljIGxvbmcgbWF4ID0gMEw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVu\ndChDb25uZWN0aW9uIGNvbm4sIFNRTEJ1ZmZlciBidWYpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGJ1Zi5wcmVwYXJl\nU3RhdGVtZW50KGNvbm4pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRo\naXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJD\nIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1\ndGluZyB1cGRhdGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBpbnQgZXhlY3V0\nZVVwZGF0ZShKREJDQ29uZmlndXJhdGlvbiBjb25mLCBDb25uZWN0aW9uIGNv\nbm4sICAKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgU1FMQnVm\nZmVyIGJ1ZiwgaW50IG9wY29kZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbgogICAg\newogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlVXBkYXRlKCk7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlk\nZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICog\naW1wbGVtZW50YXRpb24gb2YgZXhlY3V0aW5nIHF1ZXJ5LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShKREJDQ29uZmln\ndXJhdGlvbiBjb25mLCBDb25uZWN0aW9uIGNvbm4sCiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIFNRTEJ1ZmZlciBidWYpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnko\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0\nbyBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2Ug\nCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBnZXR0aW5nIHNlcXVlbmNlIGZy\nb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBsb25n\nIGdldFNlcXVlbmNlKFJlc3VsdFNldCBycywgREJEaWN0aW9uYXJ5IGRpY3Qp\nCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChycyA9PSBudWxsIHx8ICFycy5uZXh0KCkpCiAgICAgICAgICAgIHJldHVy\nbiAtMTsKICAgICAgICByZXR1cm4gZGljdC5nZXRMb25nKHJzLCAxKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRVbmlxdWVDb25zdHJhaW50TmFtZShT\ndHJpbmcgdW5pcXVlQ29uc3RyYWludE5hbWUpIHsKICAgICAgICBfdW5pcXVl\nQ29uc3RyYWludE5hbWUgPSBEQklkZW50aWZpZXIubmV3Q29uc3RyYWludCh1\nbmlxdWVDb25zdHJhaW50TmFtZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0VW5pcXVlQ29uc3RyYWludE5hbWUoREJJZGVudGlmaWVyIHVuaXF1ZUNv\nbnN0cmFpbnROYW1lKSB7CiAgICAgICAgX3VuaXF1ZUNvbnN0cmFpbnROYW1l\nID0gdW5pcXVlQ29uc3RyYWludE5hbWU7CiAgICB9CgogICAgcHVibGljIFN0\ncmluZyBnZXRVbmlxdWVDb25zdHJhaW50TmFtZSgpIHsKICAgICAgICByZXR1\ncm4gX3VuaXF1ZUNvbnN0cmFpbnROYW1lLmdldE5hbWUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgREJJZGVudGlmaWVyIGdldFVuaXF1ZUNvbnN0cmFpbnRJZGVu\ndGlmaWVyKCkgewogICAgICAgIHJldHVybiBfdW5pcXVlQ29uc3RyYWludE5h\nbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvY2F0ZVNlcXVlbmNlUnVu\nbmFibGUgaXMgYSBydW5uYWJsZSB3cmFwcGVyIHRoYXQgd2lsbCBpbnNlcnRz\nIHRoZQogICAgICogaW5pdGlhbCBzZXF1ZW5jZSB2YWx1ZSBpbnRvIHRoZSBk\nYXRhYmFzZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGNsYXNzIEFsbG9jYXRl\nU2VxdWVuY2VSdW5uYWJsZSBpbXBsZW1lbnRzIFJ1bm5hYmxlIHsKCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlID0gbnVsbDsKICAgICAgICBDbGFzc01hcHBp\nbmcgbWFwcGluZyA9IG51bGw7CiAgICAgICAgU3RhdHVzIHN0YXQgPSBudWxs\nOwogICAgICAgIGludCBhbGxvYzsKICAgICAgICBib29sZWFuIHVwZGF0ZVN0\nYXRTZXE7CgogICAgICAgIEFsbG9jYXRlU2VxdWVuY2VSdW5uYWJsZShKREJD\nU3RvcmUgc3RvcmUsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgICAg\nICAgICAgU3RhdHVzIHN0YXQsIGludCBhbGxvYywgYm9vbGVhbiB1cGRhdGVT\ndGF0U2VxKSB7CiAgICAgICAgICAgIHRoaXMuc3RvcmUgPSBzdG9yZTsKICAg\nICAgICAgICAgdGhpcy5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgICAgICAg\ndGhpcy5zdGF0ID0gc3RhdDsKICAgICAgICAgICAgdGhpcy5hbGxvYyA9IGFs\nbG9jOwogICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRTZXEgPSB1cGRhdGVT\ndGF0U2VxOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVGhp\ncyBtZXRob2QgYWN0dWFsbHkgb2J0YWlucyB0aGUgY3VycmVudCBzZXF1ZW5j\nZSB2YWx1ZS4KICAgICAgICAgKiAKICAgICAgICAgKiBAdGhyb3dzIFJ1bnRp\nbWVFeGNlcHRpb24KICAgICAgICAgKiAgICAgICAgICAgICBhbnkgU1FMRXhj\nZXB0aW9ucyB0aGF0IG9jY3VyIHdoZW4gb2J0YWluaW5nIHRoZSBzZXF1ZW5j\nZQogICAgICAgICAqICAgICAgICAgICAgIHZhbHVlIGFyZSB3cmFwcGVkIGlu\nIGEgcnVudGltZSBleGNlcHRpb24gdG8gYXZvaWQKICAgICAgICAgKiAgICAg\nICAgICAgICBicmVha2luZyB0aGUgUnVubmFibGUgbWV0aG9kIHNpZ25hdHVy\nZS4gVGhlIGNhbGxlciBjYW4KICAgICAgICAgKiAgICAgICAgICAgICBvYnRh\naW4gdGhlICJyZWFsIiBleGNlcHRpb24gYnkgY2FsbGluZyBnZXRDYXVzZSgp\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHRocm93\ncyBSdW50aW1lRXhjZXB0aW9uIHsKICAgICAgICAgICAgQ29ubmVjdGlvbiBj\nb25uID0gbnVsbDsKICAgICAgICAgICAgU1FMRXhjZXB0aW9uIGVyciA9IG51\nbGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBUcnkg\ndG8gdXNlIHRoZSBzdG9yZSdzIGNvbm5lY3Rpb24uCiAgICAgICAgICAgICAg\nICAKICAgICAgICAgICAgICAgIGNvbm4gPSBnZXRDb25uZWN0aW9uKHN0b3Jl\nKTsgIAogICAgICAgICAgICAgICAgYm9vbGVhbiBzZXF1ZW5jZVNldCA9CiAg\nICAgICAgICAgICAgICAgICAgc2V0U2VxdWVuY2UobWFwcGluZywgc3RhdCwg\nYWxsb2MsIHVwZGF0ZVN0YXRTZXEsIGNvbm4pOwogICAgICAgICAgICAgICAg\nY2xvc2VDb25uZWN0aW9uKGNvbm4pOwoKICAgICAgICAgICAgICAgIGlmICgh\nc2VxdWVuY2VTZXQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQg\nYSBuZXcgc2VxdWVuY2UgY29sdW1uLiAKICAgICAgICAgICAgICAgICAgICAv\nLyBQcmVmZXIgY29ubmVjdGlvbjIgLyBub24tanRhLWRhdGEtc291cmNlIHdo\nZW4gaW5zZXJ0aW5nIAogICAgICAgICAgICAgICAgICAgIC8vIGEgc2VxdWVu\nY2UgY29sdW1uIHJlZ2FyZGxlc3Mgb2YgU2VxLnR5cGUuCiAgICAgICAgICAg\nICAgICAgICAgY29ubiA9IF9jb25mLmdldERhdGFTb3VyY2UyKHN0b3JlLmdl\ndENvbnRleHQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nZ2V0Q29ubmVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgIGluc2VydFNl\ncXVlbmNlKG1hcHBpbmcsIGNvbm4pOwogICAgICAgICAgICAgICAgICAgIGNv\nbm4uY2xvc2UoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gbm93IHdlIHNo\nb3VsZCBiZSBhYmxlIHRvIHVwZGF0ZSB1c2luZyB0aGUgY29ubmVjdGlvbiBw\nZXIKICAgICAgICAgICAgICAgICAgICAvLyBvbiB0aGUgc2VxIHR5cGUuCiAg\nICAgICAgICAgICAgICAgICAgY29ubiA9IGdldENvbm5lY3Rpb24oc3RvcmUp\nOwogICAgICAgICAgICAgICAgICAgIGlmICghc2V0U2VxdWVuY2UobWFwcGlu\nZywgc3RhdCwgYWxsb2MsIHVwZGF0ZVN0YXRTZXEsIGNvbm4pKQogICAgICAg\nICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nKGVyciAhPSBudWxsKSA/IGVyciA6IG5ldyBTUUxFeGNlcHRpb24oX2xvYy5n\nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5vLXNlcS1y\nb3ciLCBtYXBwaW5nLCBfdGFibGUpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNsb3NlQ29ubmVj\ndGlvbihjb25uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChj\nb25uICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjbG9zZUNvbm5l\nY3Rpb24oY29ubik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBSdW50aW1lRXhjZXB0aW9uIHJlID0gbmV3IFJ1bnRpbWVFeGNlcHRpb24o\nZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgcmUuaW5pdENhdXNl\nKGUpOwogICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDdXJlbnRTZXF1ZW5j\nZVJ1bm5hYmxlIGlzIGEgcnVubmFibGUgd3JhcHBlciB3aGljaCBvYnRhaW5z\nIHRoZSBjdXJyZW50CiAgICAgKiBzZXF1ZW5jZSB2YWx1ZSBmcm9tIHRoZSBk\nYXRhYmFzZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGNsYXNzIEN1cnJlbnRT\nZXF1ZW5jZVJ1bm5hYmxlIGltcGxlbWVudHMgUnVubmFibGUgewogICAgICAg\nIHByaXZhdGUgSkRCQ1N0b3JlIF9zdG9yZTsKICAgICAgICBwcml2YXRlIENs\nYXNzTWFwcGluZyBfbWFwcGluZzsKCiAgICAgICAgQ3VycmVudFNlcXVlbmNl\nUnVubmFibGUoSkRCQ1N0b3JlIHN0b3JlLCBDbGFzc01hcHBpbmcgbWFwcGlu\nZykgewogICAgICAgICAgICBfc3RvcmUgPSBzdG9yZTsKICAgICAgICAgICAg\nX21hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogVGhpcyBtZXRob2QgYWN0dWFsbHkgb2J0YWlucyB0aGUgY3Vy\ncmVudCBzZXF1ZW5jZSB2YWx1ZS4KICAgICAgICAgKiAKICAgICAgICAgKiBA\ndGhyb3dzIFJ1bnRpbWVFeGNlcHRpb24KICAgICAgICAgKiAgICAgICAgICAg\nICBhbnkgU1FMRXhjZXB0aW9ucyB0aGF0IG9jY3VyIHdoZW4gb2J0YWluaW5n\nIHRoZSBzZXF1ZW5jZQogICAgICAgICAqICAgICAgICAgICAgIHZhbHVlIGFy\nZSB3cmFwcGVkIGluIGEgcnVudGltZSBleGNlcHRpb24gdG8gYXZvaWQKICAg\nICAgICAgKiAgICAgICAgICAgICBicmVha2luZyB0aGUgUnVubmFibGUgbWV0\naG9kIHNpZ25hdHVyZS4gVGhlIGNhbGxlciBjYW4KICAgICAgICAgKiAgICAg\nICAgICAgICBvYnRhaW4gdGhlICJyZWFsIiBleGNlcHRpb24gYnkgY2FsbGlu\nZyBnZXRDYXVzZSgpLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIHJ1bigpIHRocm93cyBSdW50aW1lRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGNvbm4gPSBnZXRDb25uZWN0aW9uKF9zdG9yZSk7CiAg\nICAgICAgICAgICAgICBsb25nIGN1ciA9IGdldFNlcXVlbmNlKF9tYXBwaW5n\nLCBjb25uKTsKICAgICAgICAgICAgICAgIGlmIChjdXIgIT0gLTEgKSAvLyBV\nU0UgdGhlIGNvbnN0YW50CiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9\nIE51bWJlcnMudmFsdWVPZihjdXIpOwogICAgICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc3FsZSkgewogICAgICAgICAgICAgICAgUnVudGltZUV4\nY2VwdGlvbiByZSA9IG5ldyBSdW50aW1lRXhjZXB0aW9uKHNxbGUuZ2V0TWVz\nc2FnZSgpKTsKICAgICAgICAgICAgICAgIHJlLmluaXRDYXVzZShzcWxlKTsK\nICAgICAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgaWYgKGNvbm4gIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGNsb3NlQ29ubmVjdGlvbihjb25uKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

