{"sha":"179e2dfa534128e1dc00a027316e20f7598cca34","node_id":"MDQ6QmxvYjIwNjM2NDoxNzllMmRmYTUzNDEyOGUxZGMwMGEwMjczMTZlMjBmNzU5OGNjYTM0","size":15808,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/179e2dfa534128e1dc00a027316e20f7598cca34","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDU3RvcmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5leHBzLkFic3RyYWN0RXhwcmVzc2lvblZpc2l0b3I7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQ29uc3Rh\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQ29u\ndGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5F\neHByZXNzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLlF1ZXJ5RXhwcmVzc2lvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuU3VicXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLmV4cHMuVmFsdWU7CgovKioKICogVHVybnMgcGFyc2Vk\nIHF1ZXJpZXMgaW50byBzZWxlY3RzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgU2VsZWN0Q29uc3Ry\ndWN0b3IKICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICBwcml2\nYXRlIGJvb2xlYW4gX2V4dGVudCA9IGZhbHNlOwogICAgcHJpdmF0ZSBTZWxl\nY3QgX3N1YnNlbGVjdCA9IG51bGw7CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndHJ1ZSBpZiB3ZSBrbm93IHRoZSBzZWxlY3QgdG8gaGF2ZSBvbiBjcml0ZXJp\nYTsgdG8gYmUgYW4gZXh0ZW50LgogICAgICogTm90ZSB0aGF0IGV2ZW4gaWYg\ndGhpcyBtZXRob2QgcmV0dXJucyBmYWxzZSwge0BsaW5rICNldmFsdWF0ZX0g\nbWF5IHN0aWxsCiAgICAgKiByZXR1cm4gbnVsbCBpZiB3ZSBoYXZlbid0IGNh\nY2hlZCB3aGV0aGVyIHRoZSBxdWVyeSBpcyBhbiBleHRlbnQgeWV0LgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0V4dGVudCgpIHsKICAgICAgICBy\nZXR1cm4gX2V4dGVudDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTdWJz\nZWxlY3QoU2VsZWN0IHN1YnNlbGVjdCkgewogICAgICAgIF9zdWJzZWxlY3Qg\nPSBzdWJzZWxlY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBFdmFsdWF0ZSB0\naGUgZXhwcmVzc2lvbiwgcmV0dXJuaW5nIGEgbmV3IHNlbGVjdCBhbmQgZmls\nbGluZyBpbiBhbnkKICAgICAqIGFzc29jaWF0ZWQgZXhwcmVzc2lvbiBzdGF0\nZS4gVXNlIHtAbGluayAjc2VsZWN0fSB0byB0aGVuIHNlbGVjdCB0aGUgZGF0\nYS4KICAgICAqIAogICAgICogQHBhcmFtIGN0eCBmaWxsIHdpdGggZXhlY3V0\naW9uIGNvbnRleHQKICAgICAqIEBwYXJhbSBzdGF0ZSB3aWxsIGJlIGZpbGxl\nZCB3aXRoIGV4cHJlc3Npb24gc3RhdGUKICAgICAqLwogICAgcHVibGljIFNl\nbGVjdCBldmFsdWF0ZShFeHBDb250ZXh0IGN0eCwgU2VsZWN0IHBhcmVudCwg\nU3RyaW5nIGFsaWFzLCAKICAgICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMs\nIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZSBzdGF0ZSkgewogICAgICAgIC8vIGFs\ncmVhZHkga25vdyB0aGF0IHRoaXMgcXVlcnkgaXMgZXF1aXZhbGVudCB0byBh\nbiBleHRlbnQ/CiAgICAgICAgU2VsZWN0IHNlbDsKICAgICAgICBpZiAoX2V4\ndGVudCkgewogICAgICAgICAgICBzZWwgPSBjdHguc3RvcmUuZ2V0U1FMRmFj\ndG9yeSgpLm5ld1NlbGVjdCgpOwogICAgICAgICAgICBzZWwuc2V0QXV0b0Rp\nc3RpbmN0KChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9BVVRPKSAh\nPSAwKTsKICAgICAgICAgICAgcmV0dXJuIHNlbDsKICAgICAgICB9CgogICAg\nICAgIC8vIGNyZWF0ZSBhIG5ldyBzZWxlY3QgYW5kIGluaXRpYWxpemUgaXQg\nd2l0aCB0aGUgam9pbnMgbmVlZGVkIGZvcgogICAgICAgIC8vIHRoZSBjcml0\nZXJpYSBvZiB0aGlzIHF1ZXJ5CiAgICAgICAgc2VsID0gbmV3U2VsZWN0KGN0\neCwgcGFyZW50LCBhbGlhcywgZXhwcywgc3RhdGUpOwoKICAgICAgICAvLyBj\ncmVhdGUgd2hlcmUgY2xhdXNlOyBpZiB0aGVyZSBhcmUgbm8gd2hlcmUgY29u\nZGl0aW9ucyBhbmQKICAgICAgICAvLyBubyBvcmRlcmluZyBvciBwcm9qZWN0\naW9ucywgd2UgcmV0dXJuIG51bGwgdG8gc2lnbmlmeSB0aGF0IHRoaXMKICAg\nICAgICAvLyBxdWVyeSBzaG91bGQgYmUgdHJlYXRlZCBsaWtlIGFuIGV4dGVu\ndAogICAgICAgIFNlbGVjdCBpbm5lciA9IHNlbC5nZXRGcm9tU2VsZWN0KCk7\nCiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gYnVpbGRXaGVyZSgoaW5uZXIg\nIT0gbnVsbCkgPyBpbm5lciA6IHNlbCwgY3R4LCAKICAgICAgICAgICAgc3Rh\ndGUuZmlsdGVyLCBleHBzLmZpbHRlcik7CiAgICAgICAgaWYgKHdoZXJlID09\nIG51bGwgJiYgZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGggPT0gMAogICAgICAg\nICAgICAmJiBleHBzLm9yZGVyaW5nLmxlbmd0aCA9PSAwCiAgICAgICAgICAg\nICYmIChzZWwuZ2V0Sm9pbnMoKSA9PSBudWxsIHx8IHNlbC5nZXRKb2lucygp\nLmlzRW1wdHkoKSkpIHsKICAgICAgICAgICAgX2V4dGVudCA9IHRydWU7CiAg\nICAgICAgICAgIHNlbC5zZXRBdXRvRGlzdGluY3QoKGV4cHMuZGlzdGluY3Qg\nJiBleHBzLkRJU1RJTkNUX0FVVE8pICE9IDApOwogICAgICAgICAgICByZXR1\ncm4gc2VsOwogICAgICAgIH0KCiAgICAgICAgLy8gbm93IHNldCBzcWwgY3Jp\ndGVyaWE7IGl0IGdvZXMgb24gdGhlIGlubmVyIHNlbGVjdCBpZiBwcmVzZW50\nCiAgICAgICAgaWYgKGlubmVyICE9IG51bGwpCiAgICAgICAgICAgIGlubmVy\nLndoZXJlKHdoZXJlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNlbC53\naGVyZSh3aGVyZSk7CgogICAgICAgIC8vIGFwcGx5IGdyb3VwaW5nIGFuZCBo\nYXZpbmcuICB0aGlzIGRvZXMgbm90IHNlbGVjdCB0aGUgZ3JvdXBpbmcKICAg\nICAgICAvLyBjb2x1bW5zLCBqdXN0IGJ1aWxkcyB0aGUgR1JPVVAgQlkgY2xh\ndXNlcy4gIHdlIGRvbid0IGJ1aWxkIHRoZQogICAgICAgIC8vIE9SREVSIEJZ\nIGNsYXVzZXMgeWV0IGJlY2F1c2UgaWYgd2UgZGVjaWRlIHRvIGFkZCB0aGlz\nIHNlbGVjdAogICAgICAgIC8vIHRvIGEgdW5pb24sIHRoZSBPUkRFUiBCWSB2\nYWx1ZXMgZ2V0IGFsaWFzZWQgZGlmZmVyZW50bHkKICAgICAgICBpZiAoZXhw\ncy5oYXZpbmcgIT0gbnVsbCkgewogICAgICAgICAgICBFeHAgaGF2aW5nRXhw\nID0gKEV4cCkgZXhwcy5oYXZpbmc7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBi\ndWYgPSBuZXcgU1FMQnVmZmVyKGN0eC5zdG9yZS5nZXREQkRpY3Rpb25hcnko\nKSk7CiAgICAgICAgICAgIGhhdmluZ0V4cC5hcHBlbmRUbyhzZWwsIGN0eCwg\nc3RhdGUuaGF2aW5nLCBidWYpOwogICAgICAgICAgICBzZWwuaGF2aW5nKGJ1\nZik7CiAgICAgICAgfQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXhw\ncy5ncm91cGluZy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgKChWYWwpIGV4\ncHMuZ3JvdXBpbmdbaV0pLmdyb3VwQnkoc2VsLCBjdHgsIHN0YXRlLmdyb3Vw\naW5nW2ldKTsKICAgICAgICByZXR1cm4gc2VsOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgbmV3IHNlbGVjdCB3aXRoIGV4cHJlc3Npb25zIGlu\naXRpYWxpemVkLgogICAgICovCiAgICBwcml2YXRlIFNlbGVjdCBuZXdTZWxl\nY3QoRXhwQ29udGV4dCBjdHgsIFNlbGVjdCBwYXJlbnQsCiAgICAgICAgU3Ry\naW5nIGFsaWFzLCBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIFF1ZXJ5RXhwcmVz\nc2lvbnNTdGF0ZSBzdGF0ZSkgewogICAgICAgIFNlbGVjdCBzdWJzZWxlY3Qg\nPSBKREJDU3RvcmVRdWVyeS5nZXRUaHJlYWRMb2NhbFNlbGVjdChfc3Vic2Vs\nZWN0KTsKICAgICAgICBTZWxlY3Qgc2VsID0gcGFyZW50ICE9IG51bGwgPyBz\ndWJzZWxlY3QKICAgICAgICAgICAgOiBjdHguc3RvcmUuZ2V0U1FMRmFjdG9y\neSgpLm5ld1NlbGVjdCgpOwogICAgICAgIHNlbC5zZXRBdXRvRGlzdGluY3Qo\nKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX0FVVE8pICE9IDApOwog\nICAgICAgIHNlbC5zZXRKb2luU3ludGF4KGN0eC5mZXRjaC5nZXRKb2luU3lu\ndGF4KCkpOwogICAgICAgIHNlbC5zZXRQYXJlbnQocGFyZW50LCBhbGlhcyk7\nCgogICAgICAgIENvbnRleHRbXSBxcnlDdHggPSBKREJDU3RvcmVRdWVyeS5n\nZXRUaHJlYWRMb2NhbENvbnRleHQoKTsKICAgICAgICBDb250ZXh0IGxjdHgg\nPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcXJ5Q3R4Lmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChxcnlDdHhbaV0uY2xvbmVG\ncm9tID09IGV4cHMuY3R4KCkpIHsKICAgICAgICAgICAgICAgIGxjdHggPSBx\ncnlDdHhbaV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbC5jdHgoKSA9PSBudWxsKQog\nICAgICAgICAgICBzZWwuc2V0Q29udGV4dChsY3R4KTsKCiAgICAgICAgaWYg\nKHBhcmVudCA9PSBudWxsICYmIGxjdHguZ2V0U3Vic2VsQ29udGV4dHMoKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugc3Vi\nc2VsZWN0IHdhcyBjcmVhdGVkIGJlZm9yZSBwYXJlbnQgZ290IGNyZWF0ZWQK\nICAgICAgICAgICAgTGlzdDxDb250ZXh0PiBzdWJzZWxDdHhzID0gbGN0eC5n\nZXRTdWJzZWxDb250ZXh0cygpOwogICAgICAgICAgICBmb3IgKENvbnRleHQg\nc3Vic2VsQ3R4IDogc3Vic2VsQ3R4cykgewogICAgICAgICAgICAgICAgU2Vs\nZWN0IHN1YnNlbCA9IChTZWxlY3QpIHN1YnNlbEN0eC5nZXRTZWxlY3QoKTsK\nICAgICAgICAgICAgICAgIFN1YnF1ZXJ5IHN1YnF1ZXJ5ID0gc3Vic2VsQ3R4\nLmdldFN1YnF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBzdWJzZWwuc2V0UGFy\nZW50KHNlbCwgc3VicXVlcnkuZ2V0Q2FuZGlkYXRlQWxpYXMoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgCiAgICAgICAgaW5pdGlhbGl6ZShz\nZWwsIGN0eCwgZXhwcywgc3RhdGUpOwoKICAgICAgICBpZiAoIXNlbC5nZXRB\ndXRvRGlzdGluY3QoKSkgewogICAgICAgICAgICBpZiAoKGV4cHMuZGlzdGlu\nY3QgJiBleHBzLkRJU1RJTkNUX1RSVUUpICE9IDApCiAgICAgICAgICAgICAg\nICBzZWwuc2V0RGlzdGluY3QodHJ1ZSk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9GQUxTRSkgIT0gMCkK\nICAgICAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7CiAgICAg\nICAgfSBlbHNlIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA+IDApIHsK\nICAgICAgICAgICAgaWYgKCFzZWwuaXNEaXN0aW5jdCgpICYmIChleHBzLmRp\nc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9UUlVFKSAhPSAwKXsKICAgICAgICAg\nICAgICAgIC8vIGlmIHRoZSBzZWxlY3QgaXMgbm90IGRpc3RpbmN0IGJ1dCB0\naGUgcXVlcnkgaXMsIGZvcmNlCiAgICAgICAgICAgICAgICAvLyB0aGUgc2Vs\nZWN0IHRvIGJlIGRpc3RpbmN0CiAgICAgICAgICAgICAgICBzZWwuc2V0RGlz\ndGluY3QodHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsLmlzRGlz\ndGluY3QoKSkgewogICAgICAgICAgICAgICAgLy8gd2hlbiBhZ2dyZWdhdGlu\nZyBkYXRhIG9yIG1ha2luZyBhIG5vbi1kaXN0aW5jdCBwcm9qZWN0aW9uCiAg\nICAgICAgICAgICAgICAvLyBmcm9tIGEgZGlzdGluY3Qgc2VsZWN0LCB3ZSBo\nYXZlIHRvIHNlbGVjdCBmcm9tIGEgdG1wCiAgICAgICAgICAgICAgICAvLyB0\nYWJsZSBmb3JtZWQgYnkgYSBkaXN0aW5jdCBzdWJzZWxlY3QgaW4gdGhlIGZy\nb20gY2xhdXNlOwogICAgICAgICAgICAgICAgLy8gdGhpcyBzdWJzZWxlY3Qg\nc2VsZWN0cyB0aGUgcGtzIG9mIHRoZSBjYW5kaWRhdGUgKHRvCiAgICAgICAg\nICAgICAgICAvLyBnZXQgdW5pcXVlIGNhbmRpZGF0ZSB2YWx1ZXMpIGFuZCBu\nZWVkZWQgZmllbGQgdmFsdWVzIGFuZAogICAgICAgICAgICAgICAgLy8gYXBw\nbGllcyB0aGUgd2hlcmUgY29uZGl0aW9uczsgdGhlIG91dGVyIHNlbGVjdCBh\ncHBsaWVzCiAgICAgICAgICAgICAgICAvLyBvcmRlcmluZywgZ3JvdXBpbmcs\nIGV0YwogICAgICAgICAgICAgICAgYm9vbGVhbiBhZ2cgPSBleHBzLmlzQWdn\ncmVnYXRlKCk7CiAgICAgICAgICAgICAgICBib29sZWFuIGNhbmRpZGF0ZSA9\nIFByb2plY3Rpb25FeHByZXNzaW9uVmlzaXRvci4KICAgICAgICAgICAgICAg\nICAgICBoYXNDYW5kaWRhdGVQcm9qZWN0aW9ucyhleHBzLnByb2plY3Rpb25z\nKTsKICAgICAgICAgICAgICAgIGlmIChhZ2cgfHwgKGNhbmRpZGF0ZSAKICAg\nICAgICAgICAgICAgICAgICAmJiAoZXhwcy5kaXN0aW5jdCAmIGV4cHMuRElT\nVElOQ1RfVFJVRSkgPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICBEQkRp\nY3Rpb25hcnkgZGljdCA9IGN0eC5zdG9yZS5nZXREQkRpY3Rpb25hcnkoKTsK\nICAgICAgICAgICAgICAgICAgICBkaWN0LmFzc2VydFN1cHBvcnQoZGljdC5z\ndXBwb3J0c1N1YnNlbGVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgIlN1\ncHBvcnRzU3Vic2VsZWN0Iik7CgogICAgICAgICAgICAgICAgICAgIFNlbGVj\ndCBpbm5lciA9IHNlbDsKICAgICAgICAgICAgICAgICAgICBzZWwgPSBjdHgu\nc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1NlbGVjdCgpOwogICAgICAgICAg\nICAgICAgICAgIHNlbC5zZXRQYXJlbnQocGFyZW50LCBhbGlhcyk7CiAgICAg\nICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KGFnZwogICAgICAgICAg\nICAgICAgICAgICAgICAmJiAoZXhwcy5kaXN0aW5jdCAmIGV4cHMuRElTVElO\nQ1RfVFJVRSkgIT0gMCk7CiAgICAgICAgICAgICAgICAgICAgc2VsLnNldEZy\nb21TZWxlY3QoaW5uZXIpOwoKICAgICAgICAgICAgICAgIC8vIGF1dG8tZGlz\ndGluY3RpbmcgaGFwcGVucyB0byBnZXQgdW5pcXVlIGNhbmRpZGF0ZSBpbnN0\nYW5jZXMKICAgICAgICAgICAgICAgIC8vIGJhY2s7IGRvbid0IGF1dG8tZGlz\ndGluY3QgaWYgdGhlIHVzZXIgaXNuJ3Qgc2VsZWN0aW5nIAogICAgICAgICAg\nICAgICAgLy8gY2FuZGlkYXRlIGRhdGEKICAgICAgICAgICAgICAgIH0gZWxz\nZSBpZiAoIWNhbmRpZGF0ZSAKICAgICAgICAgICAgICAgICAgICAmJiAoZXhw\ncy5kaXN0aW5jdCAmIGV4cHMuRElTVElOQ1RfVFJVRSkgPT0gMCkgCiAgICAg\nICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KGZhbHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsOwogICAgfQoK\nICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhbGwgZXhwcmVzc2lvbnMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBpbml0aWFsaXplKFNlbGVjdCBzZWws\nIEV4cENvbnRleHQgY3R4LCBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIAogICAg\nICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZSBzdGF0ZSkgewogICAgICAgIE1h\ncCBjb250YWlucyA9IG51bGw7CiAgICAgICAgaWYgKEhhc0NvbnRhaW5zRXhw\ncmVzc2lvblZpc2l0b3IuaGFzQ29udGFpbnMoZXhwcy5maWx0ZXIpCiAgICAg\nICAgICAgIHx8IEhhc0NvbnRhaW5zRXhwcmVzc2lvblZpc2l0b3IuaGFzQ29u\ndGFpbnMoZXhwcy5oYXZpbmcpKQogICAgICAgICAgICBjb250YWlucyA9IG5l\ndyBIYXNoTWFwKDcpOwoKICAgICAgICAvLyBpbml0aWFsaXplIGZpbHRlciBh\nbmQgaGF2aW5nIGV4cHJlc3Npb25zCiAgICAgICAgRXhwIGZpbHRlckV4cCA9\nIChFeHApIGV4cHMuZmlsdGVyOwogICAgICAgIHN0YXRlLmZpbHRlciA9IGZp\nbHRlckV4cC5pbml0aWFsaXplKHNlbCwgY3R4LCBjb250YWlucyk7CiAgICAg\nICAgRXhwIGhhdmluZ0V4cCA9IChFeHApIGV4cHMuaGF2aW5nOwogICAgICAg\nIGlmIChoYXZpbmdFeHAgIT0gbnVsbCkKICAgICAgICAgICAgc3RhdGUuaGF2\naW5nID0gaGF2aW5nRXhwLmluaXRpYWxpemUoc2VsLCBjdHgsIGNvbnRhaW5z\nKTsKCiAgICAgICAgLy8gZ2V0IHRoZSB0b3AtbGV2ZWwgam9pbnMgYW5kIG51\nbGwgdGhlIGV4cHJlc3Npb24ncyBqb2lucwogICAgICAgIC8vIGF0IHRoZSBz\nYW1lIHRpbWUgc28gdGhleSBhcmVuJ3QgaW5jbHVkZWQgaW4gdGhlIHdoZXJl\nL2hhdmluZyBTUUwKICAgICAgICBKb2lucyBmaWx0ZXJKb2lucyA9IHN0YXRl\nLmZpbHRlci5qb2luczsKICAgICAgICBKb2lucyBoYXZpbmdKb2lucyA9IChz\ndGF0ZS5oYXZpbmcgPT0gbnVsbCkgPyBudWxsIDogc3RhdGUuaGF2aW5nLmpv\naW5zOwogICAgICAgIEpvaW5zIGpvaW5zID0gc2VsLmFuZChmaWx0ZXJKb2lu\ncywgaGF2aW5nSm9pbnMpOwoKICAgICAgICAvLyBpbml0aWFsaXplIHJlc3Vs\ndCB2YWx1ZXMKICAgICAgICBpZiAoZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGgg\nPiAwKSB7CiAgICAgICAgICAgIHN0YXRlLnByb2plY3Rpb25zID0gbmV3IEV4\ncFN0YXRlW2V4cHMucHJvamVjdGlvbnMubGVuZ3RoXTsKICAgICAgICAgICAg\nVmFsIHJlc3VsdFZhbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBleHBzLnByb2plY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICByZXN1bHRWYWwgPSAoVmFsKSBleHBzLnByb2plY3Rpb25zW2ldOwog\nICAgICAgICAgICAgICAgaWYgKCFjdHguc3RvcmUuZ2V0REJEaWN0aW9uYXJ5\nKCkuc3VwcG9ydHNQYXJhbWV0ZXJJblNlbGVjdCAmJiByZXN1bHRWYWwgaW5z\ndGFuY2VvZiBMaXQpIHsKICAgICAgICAgICAgICAgICAgICAoKExpdClyZXN1\nbHRWYWwpLnNldFJhdyh0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIC8vIGhhdmUgdG8gam9pbiB0aHJvdWdoIHRvIHJlbGF0ZWQg\ndHlwZSBmb3IgcGMgb2JqZWN0IAogICAgICAgICAgICAgICAgLy8gcHJvamVj\ndGlvbnM7IHRoaXMgZW5zdXJlcyB0aGF0IHdlIGhhdmUgYWxsIG91ciBqb2lu\ncyBjYWNoZWQKICAgICAgICAgICAgICAgIHN0YXRlLnByb2plY3Rpb25zW2ld\nID0gcmVzdWx0VmFsLmluaXRpYWxpemUoc2VsLCBjdHgsIAogICAgICAgICAg\nICAgICAgICAgIFZhbC5KT0lOX1JFTCB8IFZhbC5GT1JDRV9PVVRFUik7CiAg\nICAgICAgICAgICAgICBqb2lucyA9IHNlbC5hbmQoam9pbnMsIHN0YXRlLnBy\nb2plY3Rpb25zW2ldLmpvaW5zKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBncm91cGluZwogICAgICAgIGlmIChl\neHBzLmdyb3VwaW5nLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgc3RhdGUu\nZ3JvdXBpbmcgPSBuZXcgRXhwU3RhdGVbZXhwcy5ncm91cGluZy5sZW5ndGhd\nOwogICAgICAgICAgICBWYWwgZ3JvdXBWYWw7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZXhwcy5ncm91cGluZy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgZ3JvdXBWYWwgPSAoVmFsKSBleHBzLmdyb3VwaW5n\nW2ldOwogICAgICAgICAgICAgICAgLy8gaGF2ZSB0byBqb2luIHRocm91Z2gg\ndG8gcmVsYXRlZCB0eXBlIGZvciBwYyBvYmplY3QgZ3JvdXBpbmdzOwogICAg\nICAgICAgICAgICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQgd2UgaGF2ZSBhbGwg\nb3VyIGpvaW5zIGNhY2hlZAogICAgICAgICAgICAgICAgc3RhdGUuZ3JvdXBp\nbmdbaV0gPSBncm91cFZhbC5pbml0aWFsaXplKHNlbCwgY3R4LCBWYWwuSk9J\nTl9SRUwpOwogICAgICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5z\nLCBzdGF0ZS5ncm91cGluZ1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGluaXRpYWxpemUgb3JkZXJpbmcKICAgICAg\nICBpZiAoZXhwcy5vcmRlcmluZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAg\nIHN0YXRlLm9yZGVyaW5nID0gbmV3IEV4cFN0YXRlW2V4cHMub3JkZXJpbmcu\nbGVuZ3RoXTsKICAgICAgICAgICAgVmFsIG9yZGVyVmFsOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMub3JkZXJpbmcubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIG9yZGVyVmFsID0gKFZhbCkgZXhwcy5v\ncmRlcmluZ1tpXTsKICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyaW5nW2ld\nID0gb3JkZXJWYWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAg\nICAgICAgICBqb2lucyA9IHNlbC5hbmQoam9pbnMsIHN0YXRlLm9yZGVyaW5n\nW2ldLmpvaW5zKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBz\nZWwud2hlcmUoam9pbnMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIHRoZSB3aGVyZSBzcWwuCiAgICAgKi8KICAgIHByaXZhdGUgU1FMQnVmZmVy\nIGJ1aWxkV2hlcmUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0\nYXRlIHN0YXRlLCAKICAgICAgICBFeHByZXNzaW9uIGZpbHRlcikgewogICAg\nICAgIC8vIGNyZWF0ZSB3aGVyZSBidWZmZXIKICAgICAgICBTUUxCdWZmZXIg\nd2hlcmUgPSBuZXcgU1FMQnVmZmVyKGN0eC5zdG9yZS5nZXREQkRpY3Rpb25h\ncnkoKSk7CiAgICAgICAgd2hlcmUuYXBwZW5kKCIoIik7CiAgICAgICAgRXhw\nIGZpbHRlckV4cCA9IChFeHApIGZpbHRlcjsKICAgICAgICBmaWx0ZXJFeHAu\nYXBwZW5kVG8oc2VsLCBjdHgsIHN0YXRlLCB3aGVyZSk7CgogICAgICAgIGlm\nICh3aGVyZS5zcWxFcXVhbHMoIigiKSB8fCB3aGVyZS5zcWxFcXVhbHMoIigx\nID0gMSIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gd2hlcmUuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZWxlY3QgdGhlIGRhdGEgZm9yIHRoaXMgcXVlcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgYm9vbGVhbiBzdWJjbGFz\nc2VzLCBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIFF1ZXJ5RXhwcmVzc2lvbnNT\ndGF0ZSBzdGF0ZSwKICAgICAgICBpbnQgZWFnZXIpIHsKICAgICAgICBTZWxl\nY3QgaW5uZXIgPSBzZWwuZ2V0RnJvbVNlbGVjdCgpOwogICAgICAgIFZhbCB2\nYWw7CiAgICAgICAgSm9pbnMgam9pbnMgPSBudWxsOwogICAgICAgIGlmIChz\nZWwuZ2V0U3Vic2VsZWN0UGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgIGpv\naW5zID0gc2VsLm5ld0pvaW5zKCkuc2V0U3Vic2VsZWN0KHNlbC5nZXRTdWJz\nZWxlY3RQYXRoKCkpOwoKICAgICAgICAvLyBidWlsZCBvcmRlcmluZyBjbGF1\nc2VzIGJlZm9yZSBzZWxlY3Qgc28gdGhhdCBhbnkgZWFnZXIgam9pbgogICAg\nICAgIC8vIG9yZGVyaW5nIGdldHMgYXBwbGllZCBhZnRlciBxdWVyeSBvcmRl\ncmluZwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXhwcy5vcmRlcmlu\nZy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgKChWYWwpIGV4cHMub3JkZXJp\nbmdbaV0pLm9yZGVyQnkoc2VsLCBjdHgsIHN0YXRlLm9yZGVyaW5nW2ldLAog\nICAgICAgICAgICAgICAgZXhwcy5hc2NlbmRpbmdbaV0pOwoKICAgICAgICAv\nLyBpZiBubyByZXN1bHQgc3RyaW5nIHNldCwgc2VsZWN0IG1hdGNoaW5nIG9i\namVjdHMgbGlrZSBub3JtYWwKICAgICAgICBpZiAoZXhwcy5wcm9qZWN0aW9u\ncy5sZW5ndGggPT0gMCAmJiBzZWwuZ2V0UGFyZW50KCkgPT0gbnVsbCkgewog\nICAgICAgICAgICBpbnQgc3VicyA9IChzdWJjbGFzc2VzKSA/IFNlbGVjdC5T\nVUJTX0pPSU5BQkxFIDogU2VsZWN0LlNVQlNfTk9ORTsKICAgICAgICAgICAg\nc2VsLnNlbGVjdElkZW50aWZpZXIobWFwcGluZywgc3VicywgY3R4LnN0b3Jl\nLCBjdHguZmV0Y2gsIGVhZ2VyKTsKICAgICAgICB9IGVsc2UgaWYgKGV4cHMu\ncHJvamVjdGlvbnMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgLy8gc3Vi\nc2VsZWN0IGZvciBvYmplY3RzOyB3ZSByZWFsbHkganVzdCBuZWVkIHRoZSBw\ncmltYXJ5IGtleSB2YWx1ZXMKICAgICAgICAgICAgc2VsLnNlbGVjdChtYXBw\naW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIGpvaW5zKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIGFuIGlubmVyIHNl\nbGVjdCwgd2UgbmVlZCB0byBzZWxlY3QgdGhlIGNhbmRpZGF0ZQogICAgICAg\nICAgICAvLyBjbGFzcycgcGsgY29sdW1ucyB0byBndWFyYW50ZWUgdW5pcXVl\nIGluc3RhbmNlcwogICAgICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGlubmVyLnNlbGVjdChtYXBwaW5nLmdldFByaW1hcnlL\nZXlDb2x1bW5zKCksIGpvaW5zKTsKCiAgICAgICAgICAgIC8vIHNlbGVjdCBl\nYWNoIHJlc3VsdCB2YWx1ZTsgbm8gbmVlZCB0byBwYXNzIG9uIHRoZSBlYWdl\nciBtb2RlIHNpbmNlCiAgICAgICAgICAgIC8vIHVuZGVyIHByb2plY3Rpb25z\nIHdlIGFsd2F5cyB1c2UgRUFHRVJfTk9ORQogICAgICAgICAgICBib29sZWFu\nIHBrcyA9IHNlbC5nZXRQYXJlbnQoKSAhPSBudWxsOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGV4cHMucHJvamVjdGlvbnMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIHZhbCA9IChWYWwpIGV4cHMucHJvamVj\ndGlvbnNbaV07CiAgICAgICAgICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICB2YWwuc2VsZWN0Q29sdW1ucyhpbm5lciwg\nY3R4LCBzdGF0ZS5wcm9qZWN0aW9uc1tpXSwgcGtzKTsKICAgICAgICAgICAg\nICAgIHZhbC5zZWxlY3Qoc2VsLCBjdHgsIHN0YXRlLnByb2plY3Rpb25zW2ld\nLCBwa3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgaGF2aW5nIGNvbHVtbnMgYXJlIHNlbGVjdGVkIHNpbmNlIGl0IGlzIHJl\ncXVpcmVkIGJ5IAogICAgICAgICAgICAvLyBzb21lIERCcy4gIHB1dCB0aGVt\nIGxhc3Qgc28gdGhleSBkb24ndCBhZmZlY3QgcmVzdWx0IHByb2Nlc3NpbmcK\nICAgICAgICAgICAgaWYgKGV4cHMuaGF2aW5nICE9IG51bGwgJiYgaW5uZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICgoRXhwKSBleHBzLmhhdmluZyku\nc2VsZWN0Q29sdW1ucyhpbm5lciwgY3R4LCBzdGF0ZS5oYXZpbmcsIAogICAg\nICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nc2VsZWN0IG9yZGVyaW5nIGNvbHVtbnMsIHNpbmNlIGl0IGlzIHJlcXVpcmVk\nIGJ5IHNvbWUgREJzLiAgcHV0IHRoZW0KICAgICAgICAvLyBsYXN0IHNvIHRo\nZXkgZG9uJ3QgYWZmZWN0IHJlc3VsdCBwcm9jZXNzaW5nCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBleHBzLm9yZGVyaW5nLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHZhbCA9IChWYWwpIGV4cHMub3JkZXJpbmdbaV07CiAg\nICAgICAgICAgIGlmIChpbm5lciAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndmFsLnNlbGVjdENvbHVtbnMoaW5uZXIsIGN0eCwgc3RhdGUub3JkZXJpbmdb\naV0sIHRydWUpOwogICAgICAgICAgICB2YWwuc2VsZWN0KHNlbCwgY3R4LCBz\ndGF0ZS5vcmRlcmluZ1tpXSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBhZGQgY29uZGl0aW9ucyBsaW1pdGluZyB0aGUgcHJvamVjdGlvbnMgdG8g\ndGhlIHByb3BlciBjbGFzc2VzOyBpZgogICAgICAgIC8vIHRoaXMgaXNuJ3Qg\nYSBwcm9qZWN0aW9uIG9yIGEgc3VicSB0aGVuIHRoZXkgd2lsbCBhbHJlYWR5\nIGJlIGFkZGVkCiAgICAgICAgaWYgKGV4cHMucHJvamVjdGlvbnMubGVuZ3Ro\nID4gMCB8fCBzZWwuZ2V0UGFyZW50KCkgIT0gbnVsbCkgewogICAgICAgICAg\nICBjdHguc3RvcmUubG9hZFN1YmNsYXNzZXMobWFwcGluZyk7CiAgICAgICAg\nICAgIG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmFkZENsYXNzQ29uZGl0\naW9ucygoaW5uZXIgIT0gbnVsbCkgCiAgICAgICAgICAgICAgICA/IGlubmVy\nIDogc2VsLCBzdWJjbGFzc2VzLCBqb2lucyk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVXNlZCB0byBjaGVjayB3aGV0aGVyIGEgcXVlcnkn\ncyByZXN1bHQgcHJvamVjdGlvbnMgYXJlIG9uIHRoZSBjYW5kaWRhdGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFByb2plY3Rpb25FeHBy\nZXNzaW9uVmlzaXRvcgogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNz\naW9uVmlzaXRvciB7CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfY2FuZGlk\nYXRlID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX2xldmVsID0gMDsK\nCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sZWFuIGhhc0NhbmRpZGF0ZVBy\nb2plY3Rpb25zKFZhbHVlW10gcHJvanMpIHsKICAgICAgICAgICAgUHJvamVj\ndGlvbkV4cHJlc3Npb25WaXNpdG9yIHYgPSBuZXcgUHJvamVjdGlvbkV4cHJl\nc3Npb25WaXNpdG9yKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgcHJvanMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHByb2pz\nW2ldLmFjY2VwdFZpc2l0KHYpOwogICAgICAgICAgICAgICAgaWYgKHYuX2Nh\nbmRpZGF0ZSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBlbnRlcihWYWx1ZSB2YWwpIHsKICAg\nICAgICAgICAgaWYgKCFfY2FuZGlkYXRlKSB7CiAgICAgICAgICAgICAgICBf\nY2FuZGlkYXRlID0gKF9sZXZlbCA9PSAwICYmIHZhbCBpbnN0YW5jZW9mIENv\nbnN0YW50KQogICAgICAgICAgICAgICAgICAgIHx8ICh2YWwgaW5zdGFuY2Vv\nZiBQQ1BhdGggCiAgICAgICAgICAgICAgICAgICAgJiYgISgoUENQYXRoKSB2\nYWwpLmlzVmFyaWFibGVQYXRoKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIF9sZXZlbCsrOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nZXhpdChWYWx1ZSB2YWwpIHsKICAgICAgICAgICAgX2xldmVsLS07CiAgICAg\nICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

