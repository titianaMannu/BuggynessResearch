{"sha":"5f14db307f9979c4e2d633dd265d4a1ddc8bda6c","node_id":"MDQ6QmxvYjIwNjM2NDo1ZjE0ZGIzMDdmOTk3OWM0ZTJkNjMzZGQyNjVkNGExZGRjOGJkYTZj","size":20075,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5f14db307f9979c4e2d633dd265d4a1ddc8bda6c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZh\nLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5NYXAuRW50cnk7CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZpZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLlF1YWxp\nZmllZERCSWRlbnRpZmllcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuc3RyYXRzLkZ1bGxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91\ncDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Vbmlx\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNl\nVHJhY2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnhtbC5D\nb21tZW50YWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1l\ndGFEYXRhQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVzZXJFeGNlcHRpb247CgovKioKICogSW5mb3JtYXRpb24gYWJvdXQgdGhl\nIG1hcHBpbmcgZnJvbSBhIGNsYXNzIHRvIHRoZSBzY2hlbWEsIGluIHJhdyBm\nb3JtLgogKiBUaGUgY29sdW1ucyBhbmQgdGFibGVzIHVzZWQgaW4gbWFwcGlu\nZyBpbmZvIHdpbGwgbm90IGJlIHBhcnQgb2YgdGhlCiAqIHtAbGluayBTY2hl\nbWFHcm91cH0gdXNlZCBhdCBydW50aW1lLiBSYXRoZXIsIHRoZXkgd2lsbCBi\nZSBzdHJ1Y3RzCiAqIHdpdGggdGhlIHJlbGV2YW50IHBpZWNlcyBvZiBpbmZv\ncm1hdGlvbiBmaWxsZWQgaW4uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNsYXNzIENs\nYXNzTWFwcGluZ0luZm8KICAgIGV4dGVuZHMgTWFwcGluZ0luZm8KICAgIGlt\ncGxlbWVudHMgU291cmNlVHJhY2tlciwgQ29tbWVudGFibGUgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoQ2xhc3NNYXBwaW5nSW5mby5jbGFzcyk7\nCgogICAgcHJpdmF0ZSBTdHJpbmcgX2NsYXNzTmFtZSA9IE9iamVjdC5jbGFz\ncy5nZXROYW1lKCk7CiAgICBwcml2YXRlIERCSWRlbnRpZmllciBfdGFibGVO\nYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICBwcml2YXRlIERCSWRlbnRp\nZmllciBfc2NoZW1hTmFtZSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9qb2luZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgTWFw\nPERCSWRlbnRpZmllciwgTGlzdDxDb2x1bW4+PiBfc2Vjb25kcyA9IG51bGw7\nCiAgICBwcml2YXRlIFN0cmluZyBfc3ViU3RyYXQgPSBudWxsOwogICAgcHJp\ndmF0ZSBGaWxlIF9maWxlID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9zcmNU\neXBlID0gU1JDX09USEVSOwogICAgcHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVu\ndHMgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX2xpbmVOdW0gPSAwOyAgCiAg\nICBwcml2YXRlIGludCBfY29sTnVtID0gMDsgIAogICAgCiAgICAvLyBVbmlx\ndWUgY29uc3RyYWludHMgaW5kZXhlZCBieSBwcmltYXJ5IG9yIHNlY29uZGFy\neSB0YWJsZSBuYW1lCiAgICBwcml2YXRlIE1hcDxEQklkZW50aWZpZXIsTGlz\ndDxVbmlxdWU+PiBfdW5pcXVlczsKCiAgICAvKioKICAgICAqIFRoZSBkZXNj\ncmliZWQgY2xhc3MgbmFtZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRDbGFzc05hbWUoKSB7CiAgICAgICAgcmV0dXJuIF9jbGFzc05hbWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGVzY3JpYmVkIGNsYXNzIG5hbWUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENsYXNzTmFtZShTdHJpbmcg\nbmFtZSkgewogICAgICAgIF9jbGFzc05hbWUgPSBuYW1lOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIGRlZmF1bHQgc3RyYXRlZ3kgZm9yIHN1YmNsYXNz\nZXMgaW4gdGhpcyBoaWVyYXJjaHkuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0SGllcmFyY2h5U3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9z\ndWJTdHJhdDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IHN0\ncmF0ZWd5IGZvciBzdWJjbGFzc2VzIGluIHRoaXMgaGllcmFyY2h5LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRIaWVyYXJjaHlTdHJhdGVneShTdHJp\nbmcgc3RyYXRlZ3kpIHsKICAgICAgICBfc3ViU3RyYXQgPSBzdHJhdGVneTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBnaXZlbiB0YWJsZSBuYW1lLgog\nICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRUYWJsZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIGdldFRhYmxlSWRlbnRp\nZmllcigpLmdldE5hbWUoKTsKICAgIH0KCiAgICBwdWJsaWMgREJJZGVudGlm\naWVyIGdldFRhYmxlSWRlbnRpZmllcigpIHsKICAgICAgICByZXR1cm4gX3Rh\nYmxlTmFtZSA9PSBudWxsID8gREJJZGVudGlmaWVyLk5VTEwgOiBfdGFibGVO\nYW1lOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGdpdmVuIHRhYmxlIG5h\nbWUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRUYWJsZU5hbWUoU3RyaW5nIHRhYmxlKSB7CiAgICAgICAgc2V0VGFi\nbGVJZGVudGlmaWVyKERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZSkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFRhYmxlSWRlbnRpZmllcihEQklk\nZW50aWZpZXIgdGFibGUpIHsKICAgICAgICBfdGFibGVOYW1lID0gdGFibGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBzY2hlbWEgbmFt\nZSBmb3IgdW5xdWFsaWZpZWQgdGFibGVzLgogICAgICogQGRlcHJlY2F0ZWQK\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTY2hlbWFOYW1lKCkgewog\nICAgICAgIHJldHVybiBnZXRTY2hlbWFJZGVudGlmaWVyKCkuZ2V0TmFtZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBEQklkZW50aWZpZXIgZ2V0U2NoZW1hSWRl\nbnRpZmllcigpIHsKICAgICAgICByZXR1cm4gX3NjaGVtYU5hbWUgPT0gbnVs\nbCA/IERCSWRlbnRpZmllci5OVUxMIDogX3NjaGVtYU5hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBzY2hlbWEgbmFtZSBmb3IgdW5x\ndWFsaWZpZWQgdGFibGVzLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U2NoZW1hTmFtZShTdHJpbmcgc2NoZW1hKSB7\nCiAgICAgICAgc2V0U2NoZW1hSWRlbnRpZmllcihEQklkZW50aWZpZXIubmV3\nU2NoZW1hKHNjaGVtYSkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNj\naGVtYUlkZW50aWZpZXIoREJJZGVudGlmaWVyIHNjaGVtYSkgewogICAgICAg\nIF9zY2hlbWFOYW1lID0gc2NoZW1hOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGVyZSBpcyBhIGpvaW4gdG8gdGhlIHN1cGVyY2xhc3MgdGFi\nbGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzSm9pbmVkU3ViY2xh\nc3MoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luZWQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZXJlIGlzIGEgam9pbiB0byB0aGUgc3VwZXJj\nbGFzcyB0YWJsZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pbmVk\nU3ViY2xhc3MoYm9vbGVhbiBqb2luZWQpIHsKICAgICAgICBfam9pbmVkID0g\nam9pbmVkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjbGFz\ncy1sZXZlbCBqb2luZWQgdGFibGVzLgogICAgICogQGRlcHJlY2F0ZWQKICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldFNlY29uZGFyeVRhYmxlTmFt\nZXMoKSB7CiAgICAgICAgaWYgKF9zZWNvbmRzID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBEQklk\nZW50aWZpZXIudG9TdHJpbmdBcnJheShfc2Vjb25kcy5rZXlTZXQoKS50b0Fy\ncmF5KG5ldyBEQklkZW50aWZpZXJbXXsgfSkpOwogICAgfQoKICAgIHB1Ymxp\nYyBEQklkZW50aWZpZXJbXSBnZXRTZWNvbmRhcnlUYWJsZUlkZW50aWZpZXJz\nKCkgewogICAgICAgIGlmIChfc2Vjb25kcyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbmV3IERCSWRlbnRpZmllclswXTsKICAgICAgICByZXR1cm4g\nKERCSWRlbnRpZmllcltdKSBfc2Vjb25kcy5rZXlTZXQoKS50b0FycmF5KG5l\ndyBEQklkZW50aWZpZXJbXXsgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\nZSBhbGxvdyBmaWVsZHMgdG8gcmVmZXJlbmNlIGNsYXNzLWxldmVsIGpvaW5z\nIHVzaW5nIGp1c3QgdGhlIHRhYmxlCiAgICAgKiBuYW1lLCB3aGVyZWFzIHRo\nZSBjbGFzcyBqb2luIG1pZ2h0IGhhdmUgc2NoZW1hLCBldGMgaW5mb3JtYXRp\nb24uCiAgICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIHRoZSBuYW1lIG9mIHRo\nZSBnaXZlbiB0YWJsZSBhcyBsaXN0ZWQgaW4gYQogICAgICogY2xhc3MtbGV2\nZWwgam9pbiwgb3IgdGhlIGdpdmVuIG5hbWUgaWYgbm8gam9pbiBleGlzdHMu\nCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFNlY29uZGFyeVRhYmxlTmFtZShTdHJpbmcgdGFibGVOYW1lKSB7CiAg\nICAgICAgcmV0dXJuIGdldFNlY29uZGFyeVRhYmxlSWRlbnRpZmllcihEQklk\nZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSkuZ2V0TmFtZSgpOwogICAg\nfQoKICAgIHB1YmxpYyBEQklkZW50aWZpZXIgZ2V0U2Vjb25kYXJ5VGFibGVJ\nZGVudGlmaWVyKERCSWRlbnRpZmllciB0YWJsZU5hbWUpIHsKICAgICAgICAv\nLyBpZiBubyBzZWNvbmRhcnkgdGFibGUgam9pbnMsIGJhZCB0YWJsZSBuYW1l\nLCBleGFjdCBtYXRjaCwKICAgICAgICAvLyBvciBhbiBhbHJlYWR5LXF1YWxp\nZmllZCB0YWJsZSBuYW1lLCBub3RoaW5nIHRvIGRvCiAgICAgICAgUXVhbGlm\naWVkREJJZGVudGlmaWVyIHBhdGggPSBRdWFsaWZpZWREQklkZW50aWZpZXIu\nZ2V0UGF0aCh0YWJsZU5hbWUpOwogICAgICAgIGlmIChfc2Vjb25kcyA9PSBu\ndWxsIHx8IERCSWRlbnRpZmllci5pc051bGwodGFibGVOYW1lKQogICAgICAg\nICAgICB8fCBfc2Vjb25kcy5jb250YWluc0tleSh0YWJsZU5hbWUpCiAgICAg\nICAgICAgIHx8ICFEQklkZW50aWZpZXIuaXNOdWxsKHBhdGguZ2V0U2NoZW1h\nTmFtZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHRhYmxlTmFtZTsKCiAgICAg\nICAgLy8gZGVjaWRlIHdoaWNoIGNsYXNzLWxldmVsIGpvaW4gdGFibGUgaXMg\nYmVzdCBtYXRjaAogICAgICAgIERCSWRlbnRpZmllciBiZXN0ID0gdGFibGVO\nYW1lOwogICAgICAgIGludCBwdHMgPSAwOwogICAgICAgIERCSWRlbnRpZmll\nciBmdWxsSm9pbiA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIERCSWRl\nbnRpZmllciBqb2luID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgZm9y\nIChJdGVyYXRvcjxEQklkZW50aWZpZXI+IGl0ciA9IF9zZWNvbmRzLmtleVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nIC8vIGF3YXJkIGEgY2FzZWxlc3MgbWF0Y2ggd2l0aG91dCBzY2hlbWEgMiBw\nb2ludHMKICAgICAgICAgICAgZnVsbEpvaW4gPSAoREJJZGVudGlmaWVyKSBp\ndHIubmV4dCgpOwogICAgICAgICAgICBRdWFsaWZpZWREQklkZW50aWZpZXIg\nam9pblBhdGggPSBRdWFsaWZpZWREQklkZW50aWZpZXIuZ2V0UGF0aChmdWxs\nSm9pbik7CiAgICAgICAgICAgIGlmIChqb2luUGF0aC5pc1VucXVhbGlmaWVk\nT2JqZWN0KCkgJiYgcHRzIDwgMiAmJiBmdWxsSm9pbi5lcXVhbHNJZ25vcmVD\nYXNlKHRhYmxlTmFtZSkpIHsKICAgICAgICAgICAgICAgIGJlc3QgPSBmdWxs\nSm9pbjsKICAgICAgICAgICAgICAgIHB0cyA9IDI7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoam9pblBhdGguaXNVbnF1YWxpZmllZE9iamVjdCgpKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBpbW1lZGlh\ndGVseSByZXR1cm4gYW4gZXhhY3QgbWF0Y2ggd2l0aCBzY2hlbWEKICAgICAg\nICAgICAgam9pbiA9IGpvaW5QYXRoLmdldElkZW50aWZpZXIoKTsKICAgICAg\nICAgICAgaWYgKGpvaW4uZXF1YWxzKHRhYmxlTmFtZSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZnVsbEpvaW47CgogICAgICAgICAgICAvLyBjYXNlbGVz\ncyBtYXRjaCB3aXRoIHNjaGVtYSB3b3J0aCAxIHBvaW50CiAgICAgICAgICAg\nIGlmIChwdHMgPCAxICYmIGpvaW4uZXF1YWxzSWdub3JlQ2FzZSh0YWJsZU5h\nbWUpKSB7CiAgICAgICAgICAgICAgICBiZXN0ID0gZnVsbEpvaW47CiAgICAg\nICAgICAgICAgICBwdHMgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBiZXN0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGFueSBjb2x1bW5zIGRlZmluZWQgZm9yIHRoZSBnaXZlbiBjbGFzcyBs\nZXZlbCBqb2luLCBvciBlbXB0eQogICAgICogbGlzdCBpZiBub25lLgogICAg\nICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIExpc3Q8Q29sdW1u\nPiBnZXRTZWNvbmRhcnlUYWJsZUpvaW5Db2x1bW5zKFN0cmluZyB0YWJsZU5h\nbWUpIHsKICAgICAgICByZXR1cm4gZ2V0U2Vjb25kYXJ5VGFibGVKb2luQ29s\ndW1ucyhEQklkZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSk7CiAgICB9\nCgogICAgcHVibGljIExpc3Q8Q29sdW1uPiBnZXRTZWNvbmRhcnlUYWJsZUpv\naW5Db2x1bW5zKERCSWRlbnRpZmllciB0YWJsZU5hbWUpIHsKICAgICAgICBp\nZiAoX3NlY29uZHMgPT0gbnVsbCB8fCBEQklkZW50aWZpZXIuaXNOdWxsKHRh\nYmxlTmFtZSkpIHsKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLmVt\ncHR5TGlzdCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gZ2V0IHRoZSBjb2x1\nbW5zIGZvciB0aGUgam9pbiB3aXRoIHRoZSBiZXN0IG1hdGNoIGZvciB0YWJs\nZSBuYW1lCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBfc2Vjb25kcy5n\nZXQoZ2V0U2Vjb25kYXJ5VGFibGVJZGVudGlmaWVyKHRhYmxlTmFtZSkpOwog\nICAgICAgIGlmIChjb2xzID09IG51bGwpIHsKICAgICAgICAgICAgLy8gcG9z\nc2libGUgdGhhdCBnaXZlbiB0YWJsZSBoYXMgZXh0cmEgaW5mbyB0aGUgam9p\nbiB0YWJsZQogICAgICAgICAgICAvLyBkb2Vzbid0IGhhdmU7IHN0cmlwIGl0\nCiAgICAgICAgICAgIFF1YWxpZmllZERCSWRlbnRpZmllciBwYXRoID0gUXVh\nbGlmaWVkREJJZGVudGlmaWVyLmdldFBhdGgodGFibGVOYW1lKTsKICAgICAg\nICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHBhdGguZ2V0U2NoZW1h\nTmFtZSgpKSkgewogICAgICAgICAgICAgICAgdGFibGVOYW1lID0gcGF0aC5n\nZXRJZGVudGlmaWVyKCk7CiAgICAgICAgICAgICAgICBjb2xzID0gX3NlY29u\nZHMuZ2V0KGdldFNlY29uZGFyeVRhYmxlSWRlbnRpZmllcih0YWJsZU5hbWUp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY29scyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbHM7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogQWRkcyBhIFNlY29uZGFyeSB0YWJsZSBv\nZiBnaXZlbiBuYW1lIHRvIHRoaXMgbWFwcGluZy4gQSBzZWNvbmRhcnkgdGFi\nbGUgCiAgICAgKiBtdXN0IGJlIGtub3duIGJlZm9yZSB1bmlxdWUgY29uc3Ry\nYWludHMgYXJlIGFkZGVkIHRvIGEgU2Vjb25kYXJ5IHRhYmxlLgogICAgICog\nQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkU2Vjb25k\nYXJ5VGFibGUoU3RyaW5nIHNlY29uZCkgewogICAgCXNldFNlY29uZGFyeVRh\nYmxlSm9pbkNvbHVtbnMoREJJZGVudGlmaWVyLm5ld1RhYmxlKHNlY29uZCks\nIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZFNlY29uZGFyeVRh\nYmxlKERCSWRlbnRpZmllciBzZWNvbmQpIHsKICAgICAgICBzZXRTZWNvbmRh\ncnlUYWJsZUpvaW5Db2x1bW5zKHNlY29uZCwgbnVsbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZWNsYXJlIHRoZSBnaXZlbiBjbGFzcy1sZXZlbCBqb2lu\nIHRvIHRoZSBuYW1lZCAoc2Vjb25kYXJ5KSB0YWJsZS4KICAgICAqIEBkZXBy\nZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNlY29uZGFyeVRh\nYmxlSm9pbkNvbHVtbnMoU3RyaW5nIHRhYmxlTmFtZSwgTGlzdDxDb2x1bW4+\nIGNvbHMpIHsKICAgICAgICBpZiAoY29scyA9PSBudWxsKQogICAgICAgICAg\nICBjb2xzID0gQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAgc2V0\nU2Vjb25kYXJ5VGFibGVKb2luQ29sdW1ucyhEQklkZW50aWZpZXIubmV3VGFi\nbGUodGFibGVOYW1lKSwgY29scyk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0U2Vjb25kYXJ5VGFibGVKb2luQ29sdW1ucyhEQklkZW50aWZpZXIgdGFi\nbGVOYW1lLCBMaXN0PENvbHVtbj4gY29scykgewogICAgICAgIGlmIChjb2xz\nID09IG51bGwpCiAgICAgICAgICAgIGNvbHMgPSBDb2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKICAgICAgICBpZiAoX3NlY29uZHMgPT0gbnVsbCkKICAgICAg\nICAgICAgX3NlY29uZHMgPSBuZXcgTGlua2VkSGFzaE1hcDxEQklkZW50aWZp\nZXIsIExpc3Q8Q29sdW1uPj4oKTsKICAgICAgICBfc2Vjb25kcy5wdXQodGFi\nbGVOYW1lLCBjb2xzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIG5hbWVkIHRhYmxlIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAg\nKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgVGFibGUgZ2V0VGFi\nbGUoZmluYWwgQ2xhc3NNYXBwaW5nIGNscywgU3RyaW5nIHRhYmxlTmFtZSwg\nCiAgICAgICAgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIHJldHVybiBnZXRU\nYWJsZShjbHMsIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBh\nZGFwdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWVk\nIHRhYmxlIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyBUYWJsZSBnZXRUYWJsZShmaW5hbCBDbGFzc01hcHBpbmcgY2xzLCBEQklk\nZW50aWZpZXIgdGFibGVOYW1lLCAKICAgIAkJYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIFRhYmxlIHQgPSBjcmVhdGVUYWJsZShjbHMsIG5ldyBUYWJsZURl\nZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMgU3RyaW5nIGdldChTY2hl\nbWEgc2NoZW1hKSB7CiAgICAgICAgICAgICAgICAvLyBkZWxheSB0aGlzIHNv\nIHRoYXQgd2UgZG9uJ3QgZG8gc2NoZW1hIHJlZmxlY3Rpb24gZm9yIHVuaXF1\nZQogICAgICAgICAgICAgICAgLy8gdGFibGUgbmFtZSB1bmxlc3MgbmVjZXNz\nYXJ5CiAgICAgICAgICAgICAgICByZXR1cm4gY2xzLmdldE1hcHBpbmdSZXBv\nc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAgICAgICAgICAgICAg\nICAgICAgZ2V0VGFibGVOYW1lKGNscywgc2NoZW1hKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgREJJZGVudGlmaWVyIGdldElkZW50aWZp\nZXIoU2NoZW1hIHNjaGVtYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNs\ncy5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygp\nLgogICAgICAgICAgICAgICAgICAgIGdldFRhYmxlSWRlbnRpZmllcihjbHMs\nIHNjaGVtYSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBfc2NoZW1hTmFt\nZSwgdGFibGVOYW1lLCBhZGFwdCk7CiAgICAgICAgdC5zZXRDb21tZW50KGNs\ncy5nZXRUeXBlQWxpYXMoKSA9PSBudWxsCiAgICAgICAgICAgID8gY2xzLmdl\ndERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkKICAgICAgICAgICAgOiBjbHMu\nZ2V0VHlwZUFsaWFzKCkpOwogICAgICAgIHJldHVybiB0OwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJpbWFyeSB0YWJsZSBmb3Ig\ndGhlIGdpdmVuIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgVGFibGUgZ2V0\nVGFibGUoZmluYWwgQ2xhc3NNYXBwaW5nIGNscywgYm9vbGVhbiBhZGFwdCkg\newogICAgCXJldHVybiBnZXRUYWJsZShjbHMsIF90YWJsZU5hbWUsIGFkYXB0\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGFz\ndG9yZSBpZGVudGl0eSBjb2x1bW5zIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIGJh\nc2VkIG9uIHRoZQogICAgICogZ2l2ZW4gdGVtcGxhdGVzLgogICAgICovCiAg\nICBwdWJsaWMgQ29sdW1uW10gZ2V0RGF0YVN0b3JlSWRDb2x1bW5zKENsYXNz\nTWFwcGluZyBjbHMsIENvbHVtbltdIHRtcGxhdGVzLAogICAgICAgIFRhYmxl\nIHRhYmxlLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgY2xzLmdldE1hcHBp\nbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAgICAgICAg\nICAgIHBvcHVsYXRlRGF0YVN0b3JlSWRDb2x1bW5zKGNscywgdGFibGUsIHRt\ncGxhdGVzKTsKICAgICAgICByZXR1cm4gY3JlYXRlQ29sdW1ucyhjbHMsICJk\nYXRhc3RvcmVpZCIsIHRtcGxhdGVzLCB0YWJsZSwgYWRhcHQpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2luIGZyb20gdGhpcyBjbGFz\ncyB0byBpdHMgc3VwZXJjbGFzcy4gVGhlIHRhYmxlIGZvcgogICAgICogdGhp\ncyBjbGFzcyBtdXN0IGJlIHNldC4KICAgICAqLwogICAgcHVibGljIEZvcmVp\nZ25LZXkgZ2V0U3VwZXJjbGFzc0pvaW4oZmluYWwgQ2xhc3NNYXBwaW5nIGNs\ncywgVGFibGUgdGFibGUsCiAgICAgICAgYm9vbGVhbiBhZGFwdCkgewogICAg\nICAgIENsYXNzTWFwcGluZyBzdXAgPSBjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVy\nY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRm9yZWlnbktleURlZmF1\nbHRzIGRlZiA9IG5ldyBGb3JlaWduS2V5RGVmYXVsdHMoKSB7CiAgICAgICAg\nICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldChUYWJsZSBsb2NhbCwgVGFibGUg\nZm9yZWlnbiwgYm9vbGVhbiBpbnZlcnNlKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gY2xzLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0Rl\nZmF1bHRzKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0Sm9pbkZvcmVpZ25L\nZXkoY2xzLCBsb2NhbCwgZm9yZWlnbik7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHBvcHVsYXRlKFRhYmxlIGxvY2FsLCBUYWJs\nZSBmb3JlaWduLCBDb2x1bW4gY29sLAogICAgICAgICAgICAgICAgT2JqZWN0\nIHRhcmdldCwgYm9vbGVhbiBpbnZlcnNlLCBpbnQgcG9zLCBpbnQgY29scykg\newogICAgICAgICAgICAgICAgY2xzLmdldE1hcHBpbmdSZXBvc2l0b3J5KCku\nZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAgICAgICAgICAgICAgICAgICAgcG9w\ndWxhdGVKb2luQ29sdW1uKGNscywgbG9jYWwsIGZvcmVpZ24sIGNvbCwgdGFy\nZ2V0LAogICAgICAgICAgICAgICAgICAgICAgICBwb3MsIGNvbHMpOwogICAg\nICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gY3JlYXRlRm9y\nZWlnbktleShjbHMsICJzdXBlcmNsYXNzIiwgZ2V0Q29sdW1ucygpLCBkZWYs\nIHRhYmxlLAogICAgICAgICAgICBjbHMsIHN1cCwgZmFsc2UsIGFkYXB0KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIGludGVybmFsIGlu\nZm9ybWF0aW9uIHdpdGggdGhlIG1hcHBpbmcgZGF0YSBmb3IgdGhlIGdpdmVu\nCiAgICAgKiBjbGFzcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc3luY1dp\ndGgoQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIGNsZWFyKGZhbHNlKTsK\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IGNscy5nZXRNYXBwZWRQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKGNscy5nZXRUYWJsZSgp\nICE9IG51bGwgJiYgKHN1cCA9PSBudWxsCiAgICAgICAgICAgIHx8IHN1cC5n\nZXRUYWJsZSgpICE9IGNscy5nZXRUYWJsZSgpKSkKICAgICAgICAgICAgX3Rh\nYmxlTmFtZSA9IGNscy5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldERCRGlj\ndGlvbmFyeSgpLgogICAgICAgICAgICAgICAgZ2V0RnVsbElkZW50aWZpZXIo\nY2xzLmdldFRhYmxlKCksIHRydWUpOwoKICAgICAgICAvLyBzZXQgaW8gYmVm\nb3JlIHN5bmNpbmcgY29scwogICAgICAgIHNldENvbHVtbklPKGNscy5nZXRD\nb2x1bW5JTygpKTsKICAgICAgICBpZiAoY2xzLmdldEpvaW5Gb3JlaWduS2V5\nKCkgIT0gbnVsbCAmJiBzdXAgIT0gbnVsbAogICAgICAgICAgICAmJiBzdXAu\nZ2V0VGFibGUoKSAhPSBudWxsKQogICAgICAgICAgICBzeW5jRm9yZWlnbktl\neShjbHMsIGNscy5nZXRKb2luRm9yZWlnbktleSgpLCBjbHMuZ2V0VGFibGUo\nKSwKICAgICAgICAgICAgICAgIHN1cC5nZXRUYWJsZSgpKTsKICAgICAgICBl\nbHNlIGlmIChjbHMuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5n\nLklEX0RBVEFTVE9SRSkKICAgICAgICAgICAgc3luY0NvbHVtbnMoY2xzLCBj\nbHMuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwgZmFsc2UpOwoKICAgICAgICAv\nLyByZWNvcmQgaW5oZXJpdGFuY2Ugc3RyYXRlZ3kgaWYgY2xhc3MgZG9lcyBu\nb3QgdXNlIGRlZmF1bHQgc3RyYXRlZ3kKICAgICAgICAvLyBmb3IgYmFzZSBj\nbGFzc2VzLCBhbmQgZm9yIGFsbCBzdWJjbGFzc2VzIHNvIHdlIGNhbiBiZSBz\ndXJlIHN1YnNlcXVlbnQKICAgICAgICAvLyBtYXBwaW5nIHJ1bnMgZG9uJ3Qg\ndGhpbmsgc3ViY2xhc3MgaXMgdW5tYXBwZWQKICAgICAgICBTdHJpbmcgc3Ry\nYXQgPSAoY2xzLmdldFN0cmF0ZWd5KCkgPT0gbnVsbCkgPyBudWxsCiAgICAg\nICAgICAgIDogY2xzLmdldFN0cmF0ZWd5KCkuZ2V0QWxpYXMoKTsKICAgICAg\nICBpZiAoc3RyYXQgIT0gbnVsbCAmJiAoY2xzLmdldFBDU3VwZXJjbGFzcygp\nICE9IG51bGwKICAgICAgICAgICAgfHwgIUZ1bGxDbGFzc1N0cmF0ZWd5LkFM\nSUFTLmVxdWFscyhzdHJhdCkpKQogICAgICAgICAgICBzZXRTdHJhdGVneShz\ndHJhdCk7ICAgICAgICAKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNT\nY2hlbWFDb21wb25lbnRzKCkgewogICAgICAgIHJldHVybiBzdXBlci5oYXNT\nY2hlbWFDb21wb25lbnRzKCkgfHwgIURCSWRlbnRpZmllci5pc051bGwoX3Rh\nYmxlTmFtZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXIoYm9v\nbGVhbiBjYW5GbGFncykgewogICAgICAgIHN1cGVyLmNsZWFyKGNhbkZsYWdz\nKTsKICAgICAgICBfdGFibGVOYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY29weShNYXBwaW5nSW5mbyBpbmZvKSB7\nCiAgICAgICAgc3VwZXIuY29weShpbmZvKTsKICAgICAgICBpZiAoIShpbmZv\nIGluc3RhbmNlb2YgQ2xhc3NNYXBwaW5nSW5mbykpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBjaW5mbyA9IChDbGFz\nc01hcHBpbmdJbmZvKSBpbmZvOwogICAgICAgIGlmIChEQklkZW50aWZpZXIu\naXNOdWxsKF90YWJsZU5hbWUpKQogICAgICAgICAgICBfdGFibGVOYW1lID0g\nY2luZm8uZ2V0VGFibGVJZGVudGlmaWVyKCk7CiAgICAgICAgaWYgKF9zdWJT\ndHJhdCA9PSBudWxsKQogICAgICAgICAgICBfc3ViU3RyYXQgPSBjaW5mby5n\nZXRIaWVyYXJjaHlTdHJhdGVneSgpOwogICAgICAgIGlmIChjaW5mby5fc2Vj\nb25kcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfc2Vjb25kcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX3NlY29uZHMgPSBuZXcgSGFzaE1hcDxE\nQklkZW50aWZpZXIsIExpc3Q8Q29sdW1uPj4oKTsKICAgICAgICAgICAgREJJ\nZGVudGlmaWVyIGtleTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxEQklk\nZW50aWZpZXI+IGl0ciA9IGNpbmZvLl9zZWNvbmRzLmtleVNldCgpLml0ZXJh\ndG9yKCk7CiAgICAgICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAga2V5ID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmICghX3NlY29uZHMuY29udGFpbnNLZXkoa2V5KSkKICAgICAgICAgICAg\nICAgICAgICBfc2Vjb25kcy5wdXQoa2V5LCBjaW5mby5fc2Vjb25kcy5nZXQo\na2V5KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNp\nbmZvLl91bmlxdWVzICE9IG51bGwpIHsKICAgICAgICAJaWYgKF91bmlxdWVz\nID09IG51bGwpCiAgICAgICAgCQlfdW5pcXVlcyA9IG5ldyBIYXNoTWFwPERC\nSWRlbnRpZmllciwgTGlzdDxVbmlxdWU+PigpOwogICAgICAgIGZvciAoRW50\ncnk8REJJZGVudGlmaWVyLCBMaXN0PFVuaXF1ZT4+IGVudHJ5IDogY2luZm8u\nX3VuaXF1ZXMuZW50cnlTZXQoKSkKICAgICAgICAJCWlmICghX3VuaXF1ZXMu\nY29udGFpbnNLZXkoZW50cnkuZ2V0S2V5KCkpKQogICAgICAgIAkJCV91bmlx\ndWVzLnB1dChlbnRyeS5nZXRLZXkoKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAg\nICAgICAgfQoKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZGQgYSB1bmlx\ndWUgY29uc3RyYWludCBmb3IgdGhlIGdpdmVuIHRhYmxlLgogICAgICogQHBh\ncmFtIHRhYmxlIG11c3QgYmUgcHJpbWFyeSB0YWJsZSBvciBzZWNvbmRhcnkg\ndGFibGUgbmFtZSBhZGRlZCBhIAogICAgICogcHJpb3JpIHRvIHRoaXMgcmVj\nZWl2ZXIuCiAgICAgKiBAcGFyYW0gdW5pcXVlIHRoZSB1bmlxdWUgY29uc3Ry\nYWludC4gbnVsbCBtZWFucyBuby1vcC4KICAgICAqIEBkZXByZWNhdGVkCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZFVuaXF1ZShTdHJpbmcgdGFibGUs\nIFVuaXF1ZSB1bmlxdWUpIHsKICAgICAgICBhZGRVbmlxdWUoREJJZGVudGlm\naWVyLm5ld1RhYmxlKHRhYmxlKSwgdW5pcXVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCBhIHVuaXF1ZSBjb25zdHJhaW50IGZvciB0aGUgZ2l2ZW4g\ndGFibGUuCiAgICAgKiBAcGFyYW0gdGFibGUgbXVzdCBiZSBwcmltYXJ5IHRh\nYmxlIG9yIHNlY29uZGFyeSB0YWJsZSBuYW1lIGFkZGVkIGEgCiAgICAgKiBw\ncmlvcmkgdG8gdGhpcyByZWNlaXZlci4KICAgICAqIEBwYXJhbSB1bmlxdWUg\ndGhlIHVuaXF1ZSBjb25zdHJhaW50LiBudWxsIG1lYW5zIG5vLW9wLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhZGRVbmlxdWUoREJJZGVudGlmaWVyIHRh\nYmxlLCBVbmlxdWUgdW5pcXVlKSB7CiAgICAJaWYgKCFEQklkZW50aWZpZXIu\nZXF1YWwoX3RhYmxlTmFtZSwgdGFibGUpICYmCiAgICAJICAgKF9zZWNvbmRz\nID09IG51bGwgfHwgIV9zZWNvbmRzLmNvbnRhaW5zS2V5KHRhYmxlKSkpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nInVuaXF1ZS1uby10YWJsZSIsIAogICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXt0YWJsZSwgX2NsYXNzTmFtZSwgX3RhYmxlTmFtZSwgCiAgICAg\nICAgICAgICAgICAgICAgKChfc2Vjb25kcyA9PSBudWxsKSA/ICIiIDogX3Nl\nY29uZHMua2V5U2V0KCkpfSkpOwogICAgCX0KICAgIAlpZiAodW5pcXVlID09\nIG51bGwpCiAgICAJCXJldHVybjsKICAgICAgICBpZiAoX3VuaXF1ZXMgPT0g\nbnVsbCkKICAgICAgICAgICAgX3VuaXF1ZXMgPSBuZXcgSGFzaE1hcDxEQklk\nZW50aWZpZXIsTGlzdDxVbmlxdWU+PigpOwogICAgICAgIHVuaXF1ZS5zZXRU\nYWJsZUlkZW50aWZpZXIodGFibGUpOwogICAgICAgIExpc3Q8VW5pcXVlPiB1\nbmlxdWVzID0gX3VuaXF1ZXMuZ2V0KHRhYmxlKTsKICAgICAgICBpZiAodW5p\ncXVlcyA9PSBudWxsKSB7CiAgICAgICAgCXVuaXF1ZXMgPSBuZXcgQXJyYXlM\naXN0PFVuaXF1ZT4oKTsKICAgICAgICAJdW5pcXVlcy5hZGQodW5pcXVlKTsK\nICAgICAgICAJX3VuaXF1ZXMucHV0KHRhYmxlLCB1bmlxdWVzKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgIAl1bmlxdWVzLmFkZCh1bmlxdWUpOwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXQgdGhlIHVuaXF1\nZSBjb25zdHJhaW50cyBvZiB0aGUgZ2l2ZW4gcHJpbWFyeSBvciBzZWNvbmRh\ncnkgdGFibGUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJs\naWMgVW5pcXVlW10gZ2V0VW5pcXVlcyhTdHJpbmcgdGFibGUpIHsKICAgICAg\nICByZXR1cm4gZ2V0VW5pcXVlcyhEQklkZW50aWZpZXIubmV3VGFibGUodGFi\nbGUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgdW5pcXVlIGNv\nbnN0cmFpbnRzIG9mIHRoZSBnaXZlbiBwcmltYXJ5IG9yIHNlY29uZGFyeSB0\nYWJsZS4KICAgICAqLwogICAgcHVibGljIFVuaXF1ZVtdIGdldFVuaXF1ZXMo\nREJJZGVudGlmaWVyIHRhYmxlKSB7CiAgICAgICAgaWYgKF91bmlxdWVzID09\nIG51bGwgfHwgX3VuaXF1ZXMuaXNFbXB0eSgpIAogICAgICAgIHx8IF91bmlx\ndWVzLmNvbnRhaW5zS2V5KHRhYmxlKSkKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBVbmlxdWVbMF07CiAgICAgICAgTGlzdDxVbmlxdWU+IHVuaXF1ZXMgPSBf\ndW5pcXVlcy5nZXQodGFibGUpOwogICAgICAgIHJldHVybiB1bmlxdWVzLnRv\nQXJyYXkobmV3IFVuaXF1ZVt1bmlxdWVzLnNpemUoKV0pOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdldCBhbGwgdGhlIHVuaXF1ZSBjb25zdHJhaW50\ncyBhc3NvY2lhdGVkIHdpdGggYm90aCB0aGUgcHJpbWFyeSBhbmQvb3IgCiAg\nICAgKiBzZWNvbmRhcnkgdGFibGVzLgogICAgICogCiAgICAgKi8KICAgIHB1\nYmxpYyBVbmlxdWVbXSBnZXRVbmlxdWVzKE1ldGFEYXRhQ29udGV4dCBjbSwg\nYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChfdW5pcXVlcyA9PSBudWxs\nIHx8IF91bmlxdWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBVbmlxdWVbMF07CiAgICAgICAgTGlzdDxVbmlxdWU+IHJlc3VsdCA9IG5l\ndyBBcnJheUxpc3Q8VW5pcXVlPigpOwogICAgICAgIGZvciAoREJJZGVudGlm\naWVyIHRhYmxlTmFtZSA6IF91bmlxdWVzLmtleVNldCgpKSB7CiAgICAgICAg\nCUxpc3Q8VW5pcXVlPiB1bmlxdWVDb25zdHJhaW50cyA9IF91bmlxdWVzLmdl\ndCh0YWJsZU5hbWUpOwogICAgICAgIAlmb3IgKFVuaXF1ZSB0ZW1wbGF0ZSA6\nIHVuaXF1ZUNvbnN0cmFpbnRzKSB7CiAgICAgICAgCQlDb2x1bW5bXSB0ZW1w\nbGF0ZUNvbHVtbnMgPSB0ZW1wbGF0ZS5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nICAgICAgICBDb2x1bW5bXSB1bmlxdWVDb2x1bW5zID0gbmV3IENvbHVtblt0\nZW1wbGF0ZUNvbHVtbnMubGVuZ3RoXTsKICAgICAgICAgICAgICAgIFRhYmxl\nIHRhYmxlID0gZ2V0VGFibGUoKENsYXNzTWFwcGluZyljbSwgdGFibGVOYW1l\nLCBhZGFwdCk7CiAgICAgICAgCQlmb3IgKGludCBpPTA7IGk8dW5pcXVlQ29s\ndW1ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIERCSWRl\nbnRpZmllciBjb2x1bW5OYW1lID0gdGVtcGxhdGVDb2x1bW5zW2ldLmdldElk\nZW50aWZpZXIoKTsKICAgICAgICAJCQlpZiAoIXRhYmxlLmNvbnRhaW5zQ29s\ndW1uKGNvbHVtbk5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICJ1bmlxdWUtbWlzc2luZy1jb2x1bW4iLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nY20sIGNvbHVtbk5hbWUsIHRhYmxlTmFtZSwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQXJyYXlzLnRvU3RyaW5nKHRhYmxlLmdldENvbHVt\nbk5hbWVzKCkpfSkpOwogICAgICAgIAkJCX0KICAgICAgICAgICAgICAgICAg\nICBDb2x1bW4gdW5pcXVlQ29sdW1uID0gdGFibGUuZ2V0Q29sdW1uKGNvbHVt\nbk5hbWUpOwogICAgICAgIAkJCXVuaXF1ZUNvbHVtbnNbaV0gPSB1bmlxdWVD\nb2x1bW47CiAgICAgICAgCQl9CiAgICAgICAgCQlVbmlxdWUgdW5pcXVlID0g\nY3JlYXRlVW5pcXVlKGNtLCAidW5pcXVlIiwgdGVtcGxhdGUsICAKICAgICAg\nICAJCQkJdW5pcXVlQ29sdW1ucywgYWRhcHQpOwogICAgICAgIAkJaWYgKHVu\naXF1ZSAhPSBudWxsKQogICAgICAgIAkJCXJlc3VsdC5hZGQodW5pcXVlKTsK\nICAgICAgICAJfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0LnRv\nQXJyYXkobmV3IFVuaXF1ZVtyZXN1bHQuc2l6ZSgpXSk7CiAgICB9ICAgCiAg\nICAKICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9maWxlOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0U291\ncmNlU2NvcGUoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRTb3VyY2VUeXBlKCkgewogICAgICAgIHJldHVybiBf\nc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2UoRmls\nZSBmaWxlLCBpbnQgc3JjVHlwZSkgewogICAgICAgIF9maWxlID0gZmlsZTsK\nICAgICAgICBfc3JjVHlwZSA9IHNyY1R5cGU7CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZyBnZXRSZXNvdXJjZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF9j\nbGFzc05hbWU7CiAgICB9CgogICAgcHVibGljIFN0cmluZ1tdIGdldENvbW1l\nbnRzKCkgewogICAgICAgIHJldHVybiAoX2NvbW1lbnRzID09IG51bGwpID8g\nRU1QVFlfQ09NTUVOVFMgOiBfY29tbWVudHM7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Q29tbWVudHMoU3RyaW5nW10gY29tbWVudHMpIHsKICAgICAg\nICBfY29tbWVudHMgPSBjb21tZW50czsKICAgIH0KICAgIAogICAgcHVibGlj\nIGludCBnZXRMaW5lTnVtYmVyKCkgewogICAgICAgIHJldHVybiBfbGluZU51\nbTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMaW5lTnVtYmVyKGludCBs\naW5lTnVtKSB7CiAgICAgICAgX2xpbmVOdW0gPSBsaW5lTnVtOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZ2V0Q29sTnVtYmVyKCkgewogICAgICAgIHJldHVy\nbiBfY29sTnVtOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbE51bWJl\ncihpbnQgY29sTnVtKSB7CiAgICAgICAgX2NvbE51bSA9IGNvbE51bTsKICAg\nIH0KfQo=\n","encoding":"base64"}

