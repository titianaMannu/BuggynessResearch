{"sha":"af44cdf988544ccb771729c6ccb156e760faed90","node_id":"MDQ6QmxvYjIwNjM2NDphZjQ0Y2RmOTg4NTQ0Y2NiNzcxNzI5YzZjY2IxNTZlNzYwZmFlZDkw","size":44514,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/af44cdf988544ccb771729c6ccb156e760faed90","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3Rl\nbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNl\nLlJlZmxlY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5p\nZGVudGlmaWVyLkRCSWRlbnRpZmllcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk5v\nbmVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuUHJpbWl0aXZlRmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uSU87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktl\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRl\neDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Vbmlx\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvdzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEJ1ZmZlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0RXhlY3V0b3I7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZldGNoQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3Bl\nbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuU3RhdGVNYW5hZ2VySW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdElkOwoKLyoqCiAqIFNwZWNpYWxpemF0\naW9uIG9mIG1ldGFkYXRhIGZvciByZWxhdGlvbmFsIGRhdGFiYXNlcy4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICovCkBTdXBwcmVzc1dhcm5pbmdzKCJz\nZXJpYWwiKQpwdWJsaWMgY2xhc3MgRmllbGRNYXBwaW5nCiAgICBleHRlbmRz\nIEZpZWxkTWV0YURhdGEKICAgIGltcGxlbWVudHMgVmFsdWVNYXBwaW5nLCBG\naWVsZFN0cmF0ZWd5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEZp\nZWxkTWFwcGluZy5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBWYWx1ZU1h\ncHBpbmcgX3ZhbDsKICAgIHByaXZhdGUgZmluYWwgVmFsdWVNYXBwaW5nIF9r\nZXk7CiAgICBwcml2YXRlIGZpbmFsIFZhbHVlTWFwcGluZyBfZWxlbTsKICAg\nIHByaXZhdGUgZmluYWwgRmllbGRNYXBwaW5nSW5mbyBfaW5mbzsKICAgIHBy\naXZhdGUgZmluYWwgSkRCQ0NvbHVtbk9yZGVyIF9vcmRlckNvbCA9IG5ldyBK\nREJDQ29sdW1uT3JkZXIoKTsKICAgIHByaXZhdGUgRmllbGRTdHJhdGVneSBf\nc3RyYXRlZ3kgPSBudWxsOwoKICAgIHByaXZhdGUgRm9yZWlnbktleSBfZmsg\nPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5JTyBfaW8gPSBudWxsOwogICAg\ncHJpdmF0ZSBVbmlxdWUgX3VucSA9IG51bGw7CiAgICBwcml2YXRlIEluZGV4\nIF9pZHggPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9vdXRlciA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBpbnQgX2ZldGNoTW9kZSA9IEludGVnZXIuTUFY\nX1ZBTFVFOwogICAgcHJpdmF0ZSBVbmlxdWVbXSBfam9pblRhYmxlVW5pcXVl\nczsgLy8gVW5pcXVlIGNvbnN0cmFpbnRzIG9uIEpvaW5UYWJsZQogICAgcHJp\ndmF0ZSBCb29sZWFuIF9iaWRpcmVjdGlvbmFsSm9pblRhYmxlT3duZXIgPSBu\ndWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9iaWRpcmVjdGlvbmFsSm9pblRh\nYmxlTm9uT3duZXIgPSBudWxsOwogICAgCiAgICBwcml2YXRlIEJvb2xlYW4g\nX2JpX01UbzFfSlQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF91bmlf\nMVRvTV9GSyA9IG51bGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX3VuaV9NVG8x\nX0pUID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfdW5pXzFUbzFfSlQg\nPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9iaV8xVG8xX0pUID0gbnVs\nbDsKICAgIAogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcgX2JpXzFUb01fSlRf\nRmllbGQgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcgX2JpX01U\nbzFfSlRfRmllbGQgPSBudWxsOwogICAgcHJpdmF0ZSBGb3JlaWduS2V5IF9i\naV8xVG9NX0pvaW5fRksgPSBudWxsOwogICAgcHJpdmF0ZSBGb3JlaWduS2V5\nIF9iaV8xVG9NX0VsZW1fRksgPSBudWxsOwogICAgCiAgICBwcml2YXRlIGJv\nb2xlYW4gX2hhc01hcHNJZENvbHMgPSBmYWxzZTsKICAgICAgICAKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZE1hcHBpbmcoU3RyaW5nIG5hbWUsIENsYXNzPD8+IHR5cGUsIENsYXNzTWFw\ncGluZyBvd25lcikgewogICAgICAgIHN1cGVyKG5hbWUsIHR5cGUsIG93bmVy\nKTsKICAgICAgICBfaW5mbyA9IG93bmVyLmdldE1hcHBpbmdSZXBvc2l0b3J5\nKCkubmV3TWFwcGluZ0luZm8odGhpcyk7CiAgICAgICAgX3ZhbCA9IChWYWx1\nZU1hcHBpbmcpIGdldFZhbHVlKCk7CiAgICAgICAgX2tleSA9IChWYWx1ZU1h\ncHBpbmcpIGdldEtleSgpOwogICAgICAgIF9lbGVtID0gKFZhbHVlTWFwcGlu\nZykgZ2V0RWxlbWVudCgpOwoKICAgICAgICBzZXRVc2VzSW50ZXJtZWRpYXRl\nKGZhbHNlKTsKICAgICAgICBzZXRVc2VzSW1wbERhdGEoQm9vbGVhbi5GQUxT\nRSk7CiAgICB9CgogICAgLy8vLy8vLwogICAgLy8gT1JNCiAgICAvLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBSYXcgbWFwcGluZyBkYXRhIGFib3V0IGZpZWxk\nJ3Mgam9pbiB0byBwYXJlbnQgdGFibGUsIGFzIHdlbGwgYXMKICAgICAqIG1p\nc2NlbGxhbmVvdXMgc3BlY2lhbGl6ZWQgY29sdW1ucyBsaWtlIG9yZGVyIGNv\nbHVtbi4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ0luZm8gZ2V0\nTWFwcGluZ0luZm8oKSB7CiAgICAgICAgcmV0dXJuIF9pbmZvOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHVzZWQgdG8gbWFwIHRoaXMg\nbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIEZpZWxkU3RyYXRlZ3kgZ2V0\nU3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVneTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBzdHJhdGVneSB1c2VkIHRvIG1hcCB0aGlz\nIG1hcHBpbmcuIFRoZSA8Y29kZT5hZGFwdDwvY29kZT4KICAgICAqIHBhcmFt\nZXRlciBkZXRlcm1pbmVzIHdoZXRoZXIgdG8gYWRhcHQgd2hlbiBtYXBwaW5n\nIHRoZSBzdHJhdGVneTsKICAgICAqIHVzZSBudWxsIGlmIHRoZSBzdHJhdGVn\neSBzaG91bGQgbm90IGJlIG1hcHBlZC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0U3RyYXRlZ3koRmllbGRTdHJhdGVneSBzdHJhdGVneSwgQm9vbGVh\nbiBhZGFwdCkgewogICAgICAgIC8vIHNldCBzdHJhdGVneSBmaXJzdCBzbyB3\nZSBjYW4gYWNjZXNzIGl0IGR1cmluZyBtYXBwaW5nCiAgICAgICAgRmllbGRT\ndHJhdGVneSBvcmlnID0gX3N0cmF0ZWd5OwogICAgICAgIF9zdHJhdGVneSA9\nIHN0cmF0ZWd5OwogICAgICAgIGlmIChzdHJhdGVneSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdHJhdGVneS5zZXRG\naWVsZE1hcHBpbmcodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoYWRhcHQg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzdHJhdGVneS5tYXAoYWRh\ncHQuYm9vbGVhblZhbHVlKCkpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAvLyByZXNldCBz\ndHJhdGVneQogICAgICAgICAgICAgICAgX3N0cmF0ZWd5ID0gb3JpZzsKICAg\nICAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBpZiBzZXQgdG8gdW5tYXBwZWQsIGNsZWFyIGRlZmluZWQgZmll\nbGQgY2FjaGUgaW4gcGFyZW50CiAgICAgICAgICAgIGlmICghaXNNYXBwZWQo\nKSkKICAgICAgICAgICAgICAgIGdldERlZmluaW5nTWFwcGluZygpLmNsZWFy\nRGVmaW5lZEZpZWxkQ2FjaGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgbWFwcGluZydzIHByaW1hcnkgdGFibGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBUYWJsZSBnZXRUYWJsZSgpIHsKICAgICAgICBpZiAoX2Zr\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfZmsuZ2V0VGFibGUoKTsK\nICAgICAgICBpZiAoX3ZhbC5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIF92YWwuZ2V0Rm9yZWlnbktleSgpLmdldFRhYmxl\nKCk7CiAgICAgICAgCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIG1hcCBvZiBi\naS1kaXJlY3Rpb25hbCByZWxhdGlvbiwKICAgICAgICAvLyB0aGUgY29sdW1u\nIG9mIHRoaXMgZmllbGQgc2hvdWxkIGJlIGluIHRoZSB0YWJsZSAKICAgICAg\nICAvLyBvZiB0aGUgZW50aXR5IHRoYXQgaXMgdGhlIHZhbHVlIG9mIHRoZSBt\nYXAKICAgICAgICBpZiAoX3ZhbC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLk1BUCkgewogICAgICAgICAgICBDbGFzc01hcHBpbmcgbWV0\nYSA9IF9lbGVtLmdldERlY2xhcmVkVHlwZU1hcHBpbmcoKTsKICAgICAgICAg\nICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBt\nZXRhLmdldFRhYmxlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIFZh\nbHVlTWFwcGluZ0ltcGwgdm0gPSAoVmFsdWVNYXBwaW5nSW1wbClnZXREZWZp\nbmluZ01hcHBpbmcoKS4KICAgICAgICAgICAgZ2V0RW1iZWRkaW5nTWV0YURh\ndGEoKTsKICAgICAgICBpZiAodm0gIT0gbnVsbCAmJiB2bS5nZXRWYWx1ZU1h\ncHBlZEJ5KCkgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gdm0uZ2V0\nRmllbGRNYXBwaW5nKCkuZ2V0RWxlbWVudE1hcHBpbmcoKS4KICAgICAgICAg\nICAgICAgIGdldERlY2xhcmVkVHlwZU1hcHBpbmcoKS5nZXRUYWJsZSgpOwog\nICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gZ2V0RGVmaW5pbmdN\nYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEkv\nTyBpbmZvcm1hdGlvbiBvbiB0aGUgam9pbiBjb2x1bW5zLgogICAgICovCiAg\nICBwdWJsaWMgQ29sdW1uSU8gZ2V0Sm9pbkNvbHVtbklPKCkgewogICAgICAg\nIHJldHVybiAoX2lvID09IG51bGwpID8gQ29sdW1uSU8uVU5SRVNUUklDVEVE\nIDogX2lvOwogICAgfQoKICAgIC8qKgogICAgICogSS9PIGluZm9ybWF0aW9u\nIG9uIHRoZSBqb2luIGNvbHVtbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEpvaW5Db2x1bW5JTyhDb2x1bW5JTyBpbykgewogICAgICAgIF9pbyA9\nIGlvOwogICAgfQoKICAgIC8qKgogICAgICogRm9yZWlnbiBrZXkgbGlua2lu\nZyB0aGUgZmllbGQgdGFibGUgdG8gdGhlIGNsYXNzJyBwcmltYXJ5IHRhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRKb2luRm9yZWln\nbktleSgpIHsKICAgICAgICByZXR1cm4gX2ZrOwogICAgfQoKICAgIC8qKgog\nICAgICogRm9yZWlnbiBrZXkgbGlua2luZyB0aGUgZmllbGQgdGFibGUgdG8g\ndGhlIGNsYXNzJyBwcmltYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRKb2luRm9yZWlnbktleShGb3JlaWduS2V5IGZrKSB7CiAgICAg\nICAgX2ZrID0gZms7CiAgICB9CgogICAgLyoqCiAgICAgKiBVbmlxdWUgY29u\nc3RyYWludCBvbiBqb2luIGZvcmVpZ24ga2V5IGNvbHVtbnMuCiAgICAgKi8K\nICAgIHB1YmxpYyBVbmlxdWUgZ2V0Sm9pblVuaXF1ZSgpIHsKICAgICAgICBy\nZXR1cm4gX3VucTsKICAgIH0KCiAgICAvKioKICAgICAqIFVuaXF1ZSBjb25z\ndHJhaW50IG9uIGpvaW4gZm9yZWlnbiBrZXkgY29sdW1ucy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0Sm9pblVuaXF1ZShVbmlxdWUgdW5xKSB7CiAg\nICAgICAgX3VucSA9IHVucTsKICAgIH0KCiAgICBwdWJsaWMgVW5pcXVlW10g\nZ2V0Sm9pblRhYmxlVW5pcXVlcygpIHsKICAgIAlyZXR1cm4gX2pvaW5UYWJs\nZVVuaXF1ZXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHNldEpvaW5U\nYWJsZVVuaXF1ZXMoVW5pcXVlW10gdW5xcykgewogICAgCV9qb2luVGFibGVV\nbmlxdWVzID0gdW5xczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBJbmRl\neCBvbiBqb2luIGZvcmVpZ24ga2V5IGNvbHVtbnMuCiAgICAgKi8KICAgIHB1\nYmxpYyBJbmRleCBnZXRKb2luSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9p\nZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbmRleCBvbiBqb2luIGZvcmVp\nZ24ga2V5IGNvbHVtbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpv\naW5JbmRleChJbmRleCBpZHgpIHsKICAgICAgICBfaWR4ID0gaWR4OwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2UgYW4gb3V0ZXIgam9p\nbiBmcm9tIHRoZSBjbGFzcycgcHJpbWFyeSB0YWJsZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNKb2luT3V0ZXIoKSB7CiAgICAgICAgcmV0dXJu\nIF9vdXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNl\nIGFuIG91dGVyIGpvaW4gZnJvbSB0aGUgY2xhc3MnIHByaW1hcnkgdGFibGUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpvaW5PdXRlcihib29sZWFu\nIG91dGVyKSB7CiAgICAgICAgX291dGVyID0gb3V0ZXI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGaWVsZCBvcmRlciBjb2x1bW4sIGlmIGFueS4KICAgICAq\nLwogICAgcHVibGljIENvbHVtbiBnZXRPcmRlckNvbHVtbigpIHsKICAgICAg\nICByZXR1cm4gX29yZGVyQ29sLmdldENvbHVtbigpOwogICAgfQoKICAgIC8q\nKgogICAgICogRmllbGQgb3JkZXIgY29sdW1uLCBpZiBhbnkuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldE9yZGVyQ29sdW1uKENvbHVtbiBvcmRlcikg\newogICAgICAgIF9vcmRlckNvbC5zZXRDb2x1bW4ob3JkZXIpOwogICAgfQoK\nICAgIC8qKgogICAgICogSS9PIGluZm9ybWF0aW9uIGZvciBvcmRlciBjb2x1\nbW4uCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRPcmRlckNvbHVt\nbklPKCkgewogICAgICAgIHJldHVybiBfb3JkZXJDb2wuZ2V0Q29sdW1uSU8o\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEkvTyBpbmZvcm1hdGlvbiBmb3Ig\nb3JkZXIgY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPcmRl\nckNvbHVtbklPKENvbHVtbklPIGlvKSB7CiAgICAgICAgX29yZGVyQ29sLnNl\ndENvbHVtbklPKGlvKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluY3JlbWVu\ndCB0aGUgcmVmZXJlbmNlIGNvdW50IG9mIHVzZWQgc2NoZW1hIGNvbXBvbmVu\ndHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlZlNjaGVtYUNvbXBvbmVu\ndHMoKSB7CiAgICAgICAgaWYgKF9mayAhPSBudWxsKSB7CiAgICAgICAgICAg\nIF9may5yZWYoKTsKICAgICAgICAgICAgX2ZrLnJlZkNvbHVtbnMoKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKF9vcmRlckNvbC5nZXRDb2x1bW4oKSAhPSBu\ndWxsKQogICAgICAgICAgICBfb3JkZXJDb2wuZ2V0Q29sdW1uKCkucmVmKCk7\nCiAgICAgICAgX3ZhbC5yZWZTY2hlbWFDb21wb25lbnRzKCk7CiAgICAgICAg\nX2tleS5yZWZTY2hlbWFDb21wb25lbnRzKCk7CiAgICAgICAgX2VsZW0ucmVm\nU2NoZW1hQ29tcG9uZW50cygpOwogICAgICAgIGlmIChfam9pblRhYmxlVW5p\ncXVlcyAhPSBudWxsKSB7CiAgICAgICAgCWZvciAoVW5pcXVlIGpvaW5Vbmlx\ndWUgOiBfam9pblRhYmxlVW5pcXVlcykgewogICAgICAgIAkJZm9yIChDb2x1\nbW4gY29sIDogam9pblVuaXF1ZS5nZXRDb2x1bW5zKCkpIHsKICAgICAgICAJ\nCQljb2wucmVmKCk7CiAgICAgICAgCQl9CiAgICAgICAgCX0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBtYXBwaW5nIGluZm9ybWF0\naW9uLCBpbmNsdWRpbmcgc3RyYXRlZ3kuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGNsZWFyTWFwcGluZygpIHsKICAgICAgICBfc3RyYXRlZ3kgPSBudWxs\nOwogICAgICAgIF9mayA9IG51bGw7CiAgICAgICAgX3VucSA9IG51bGw7CiAg\nICAgICAgX2lkeCA9IG51bGw7CiAgICAgICAgX291dGVyID0gZmFsc2U7CiAg\nICAgICAgX29yZGVyQ29sLnNldENvbHVtbihudWxsKTsKICAgICAgICBfdmFs\nLmNsZWFyTWFwcGluZygpOwogICAgICAgIF9rZXkuY2xlYXJNYXBwaW5nKCk7\nCiAgICAgICAgX2VsZW0uY2xlYXJNYXBwaW5nKCk7CiAgICAgICAgX2luZm8u\nY2xlYXIoKTsKICAgICAgICBzZXRSZXNvbHZlKE1PREVfTUFQUElORywgZmFs\nc2UpOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHtAbGluayBNYXBw\naW5nSW5mb30gd2l0aCBvdXIgY3VycmVudCBtYXBwaW5nIGluZm9ybWF0aW9u\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzeW5jTWFwcGluZ0luZm8oKSB7\nCiAgICAgICAgaWYgKGlzVmVyc2lvbigpKSB7CiAgICAgICAgICAgIC8vIHdl\nIHJlbHkgb24gdGhlIGZhY3QgdGhhdCB0aGUgdmVyc2lvbiB3aWxsIHNldHVw\nIG91ciBtYXBwaW5nCiAgICAgICAgICAgIC8vIGluZm8gY29ycmVjdGx5IHdo\nZW4gaXQgaXMgc3luY2VkCiAgICAgICAgfSBlbHNlIGlmIChnZXRNYXBwZWRC\neU1hcHBpbmcoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pbmZvLmNsZWFy\nKCk7CiAgICAgICAgICAgIF92YWwuZ2V0VmFsdWVJbmZvKCkuY2xlYXIoKTsK\nICAgICAgICAgICAgX2tleS5nZXRWYWx1ZUluZm8oKS5jbGVhcigpOwogICAg\nICAgICAgICBfZWxlbS5nZXRWYWx1ZUluZm8oKS5jbGVhcigpOwoKICAgICAg\nICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZCA9IGdldE1hcHBlZEJ5TWFwcGlu\nZygpOwogICAgICAgICAgICBfaW5mby5zeW5jU3RyYXRlZ3kodGhpcyk7CiAg\nICAgICAgICAgIGlmIChfb3JkZXJDb2wuZ2V0Q29sdW1uKCkgIT0gbnVsbAog\nICAgICAgICAgICAgICAgJiYgbWFwcGVkLmdldE9yZGVyQ29sdW1uKCkgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9pbmZvLnN5bmNPcmRlckNvbHVtbih0\naGlzKTsKICAgICAgICAgICAgX3ZhbC5nZXRWYWx1ZUluZm8oKS5zZXRVc2VD\nbGFzc0NyaXRlcmlhCiAgICAgICAgICAgICAgICAoX3ZhbC5nZXRVc2VDbGFz\nc0NyaXRlcmlhKCkpOwogICAgICAgICAgICBfa2V5LmdldFZhbHVlSW5mbygp\nLnNldFVzZUNsYXNzQ3JpdGVyaWEKICAgICAgICAgICAgICAgIChfa2V5Lmdl\ndFVzZUNsYXNzQ3JpdGVyaWEoKSk7CiAgICAgICAgICAgIF9lbGVtLmdldFZh\nbHVlSW5mbygpLnNldFVzZUNsYXNzQ3JpdGVyaWEKICAgICAgICAgICAgICAg\nIChfZWxlbS5nZXRVc2VDbGFzc0NyaXRlcmlhKCkpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIF9pbmZvLnN5bmNXaXRoKHRoaXMpOwogICAgICAg\nICAgICBfdmFsLnN5bmNNYXBwaW5nSW5mbygpOwogICAgICAgICAgICBfa2V5\nLnN5bmNNYXBwaW5nSW5mbygpOwogICAgICAgICAgICBfZWxlbS5zeW5jTWFw\ncGluZ0luZm8oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRydWUgaWYgZmllbGQgY2xhc3MgZG9lcyBub3QgdXNlIHRoZSAi\nbm9uZSIgc3RyYXRlZ3kgKGluY2x1ZGluZwogICAgICogaWYgaXQgaGFzIGEg\nbnVsbCBzdHJhdGVneSwgYW5kIHRoZXJlZm9yZSBpcyBwcm9iYWJseSBpbiB0\naGUgcHJvY2VzcyBvZgogICAgICogYmVpbmcgbWFwcGVkKS4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNNYXBwZWQoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdHJhdGVneSAhPSBOb25lRmllbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1l\ndGFEYXRhIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIC8qKgogICAgICogVGhlIGVhZ2VyIGZldGNoIG1vZGUsIGFzIG9uZSBv\nZiB0aGUgZWFnZXIgY29uc3RhbnRzIGluCiAgICAgKiB7QGxpbmsgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbn0uCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nRWFnZXJGZXRjaE1vZGUoKSB7CiAgICAgICAgaWYgKF9mZXRjaE1vZGUgPT0g\nSW50ZWdlci5NQVhfVkFMVUUpCiAgICAgICAgICAgIF9mZXRjaE1vZGUgPSBG\nZXRjaENvbmZpZ3VyYXRpb24uREVGQVVMVDsKICAgICAgICByZXR1cm4gX2Zl\ndGNoTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBlYWdlciBmZXRj\naCBtb2RlLCBhcyBvbmUgb2YgdGhlIGVhZ2VyIGNvbnN0YW50cyBpbgogICAg\nICoge0BsaW5rIEpEQkNGZXRjaENvbmZpZ3VyYXRpb259LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRFYWdlckZldGNoTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIF9mZXRjaE1vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgRmllbGRNZXRhRGF0YSNnZXRSZXBvc2l0b3J5fQogICAg\nICovCiAgICBwdWJsaWMgTWFwcGluZ1JlcG9zaXRvcnkgZ2V0TWFwcGluZ1Jl\ncG9zaXRvcnkoKSB7CiAgICAgICAgcmV0dXJuIChNYXBwaW5nUmVwb3NpdG9y\neSkgZ2V0UmVwb3NpdG9yeSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7\nQGxpbmsgRmllbGRNZXRhRGF0YSNnZXREZWZpbmluZ01ldGFEYXRhfQogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldERlZmluaW5nTWFwcGlu\nZygpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZykgZ2V0RGVmaW5p\nbmdNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVu\nY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsg\nRmllbGRNZXRhRGF0YSNnZXREZWNsYXJpbmdNZXRhRGF0YX0KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWFwcGluZyBnZXREZWNsYXJpbmdNYXBwaW5nKCkg\newogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBnZXREZWNsYXJpbmdN\nZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tIHtAbGluayBGaWVsZE1ldGFE\nYXRhI2dldEtleX0KICAgICAqLwogICAgcHVibGljIFZhbHVlTWFwcGluZyBn\nZXRLZXlNYXBwaW5nKCkgewogICAgICAgIHJldHVybiBfa2V5OwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0g\nY2FzdCBmcm9tIHtAbGluayBGaWVsZE1ldGFEYXRhI2dldEVsZW1lbnR9CiAg\nICAgKi8KICAgIHB1YmxpYyBWYWx1ZU1hcHBpbmcgZ2V0RWxlbWVudE1hcHBp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIF9lbGVtOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9t\nIHtAbGluayBGaWVsZE1ldGFEYXRhI2dldFZhbHVlfQogICAgICovCiAgICBw\ndWJsaWMgVmFsdWVNYXBwaW5nIGdldFZhbHVlTWFwcGluZygpIHsKICAgICAg\nICByZXR1cm4gKFZhbHVlTWFwcGluZykgZ2V0VmFsdWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNh\nc3QgZnJvbQogICAgICoge0BsaW5rIEZpZWxkTWV0YURhdGEjZ2V0TWFwcGVk\nQnlNZXRhRGF0YX0KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBn\nZXRNYXBwZWRCeU1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1h\ncHBpbmcpIGdldE1hcHBlZEJ5TWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJv\nbQogICAgICoge0BsaW5rIEZpZWxkTWV0YURhdGEjZ2V0SW52ZXJzZU1ldGFE\nYXRhc30KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1tdIGdldElu\ndmVyc2VNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGlu\nZ1tdKSBnZXRJbnZlcnNlTWV0YURhdGFzKCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gcmVzb2x2ZShpbnQgbW9kZSkgewogICAgICAgIGludCBjdXIg\nPSBnZXRSZXNvbHZlKCk7CiAgICAgICAgaWYgKHN1cGVyLnJlc29sdmUobW9k\nZSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICgobW9k\nZSAmIE1PREVfTUFQUElORykgIT0gMCAmJiAoY3VyICYgTU9ERV9NQVBQSU5H\nKSA9PSAwKQogICAgICAgICAgICByZXNvbHZlTWFwcGluZygpOwogICAgICAg\nIGlmICgobW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwICYmIChjdXIg\nJiBNT0RFX01BUFBJTkdfSU5JVCkgPT0gMCkKICAgICAgICAgICAgaW5pdGlh\nbGl6ZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXNvbHZlIHRoZSBtYXBwaW5nIGluZm9ybWF0aW9u\nIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVz\nb2x2ZU1hcHBpbmcoKSB7CiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVw\nb3MgPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpOwogICAgICAgIGlmIChyZXBv\ncy5nZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZhdWx0TWlzc2luZ0luZm8oKSkg\newogICAgICAgICAgICAvLyBjb3B5IGVtYmVkZGVkIHRlbXBsYXRlIG1hcHBp\nbmcgaW5mbwogICAgICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gZ2V0RGVm\naW5pbmdNYXBwaW5nKCk7CiAgICAgICAgICAgIGlmIChjbHMuZ2V0RW1iZWRk\naW5nTWFwcGluZygpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENsYXNz\nTWFwcGluZyBvcmlnID0gcmVwb3MuZ2V0TWFwcGluZyhjbHMuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGNscy5nZXRFbnZDbGFz\nc0xvYWRlcigpLCB0cnVlKTsKICAgICAgICAgICAgICAgIEZpZWxkTWFwcGlu\nZyB0bXBsYXRlID0gb3JpZy5nZXRGaWVsZE1hcHBpbmcoZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgICAgIGlmICh0bXBsYXRlICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgY29weU1hcHBpbmdJbmZvKHRtcGxhdGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIC8vIGNvcHkgc3VwZXJjbGFzcyBmaWVsZCBp\nbmZvCiAgICAgICAgICAgIGVsc2UgaWYgKGNscy5pc01hcHBlZCgpICYmIGNs\ncy5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsCiAgICAgICAgICAgICAgICAm\nJiBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpICE9IGdldERlY2xhcmluZ1R5cGUo\nKSkgewogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5nIHN1cCA9IGNscy5n\nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RmllbGRNYXBwaW5nKGdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICBp\nZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29weU1hcHBp\nbmdJbmZvKHN1cCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIGlmIChfc3RyYXRlZ3kgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaXNW\nZXJzaW9uKCkpCiAgICAgICAgICAgICAgICBfc3RyYXRlZ3kgPSBOb25lRmll\nbGRTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICByZXBvcy5nZXRTdHJhdGVneUluc3RhbGxlcigpLmlu\nc3RhbGxTdHJhdGVneSh0aGlzKTsKICAgICAgICB9CiAgICAgICAgTG9nIGxv\nZyA9IGdldFJlcG9zaXRvcnkoKS5nZXRMb2coKTsKICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShfbG9j\nLmdldCgiZmllbGQtc3RyYXRlZ3kiLCBnZXROYW1lKCksCiAgICAgICAgICAg\nICAgICBfc3RyYXRlZ3kuZ2V0QWxpYXMoKSkpOwoKICAgICAgICAvLyBtYXJr\nIG1hcHBlZCBjb2x1bW5zCiAgICAgICAgaWYgKF9vcmRlckNvbC5nZXRDb2x1\nbW4oKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChnZXRPcmRlckNvbHVt\nbklPKCkuaXNJbnNlcnRhYmxlKDAsIGZhbHNlKSkKICAgICAgICAgICAgICAg\nIF9vcmRlckNvbC5nZXRDb2x1bW4oKS5zZXRGbGFnKENvbHVtbi5GTEFHX0RJ\nUkVDVF9JTlNFUlQsIHRydWUpOwogICAgICAgICAgICBpZiAoZ2V0T3JkZXJD\nb2x1bW5JTygpLmlzVXBkYXRhYmxlKDAsIGZhbHNlKSkKICAgICAgICAgICAg\nICAgIF9vcmRlckNvbC5nZXRDb2x1bW4oKS5zZXRGbGFnKENvbHVtbi5GTEFH\nX0RJUkVDVF9VUERBVEUsIHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAo\nX2ZrICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1uW10gY29scyA9IF9m\nay5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIENvbHVtbklPIGlvID0gZ2V0\nSm9pbkNvbHVtbklPKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGlv\nLmlzSW5zZXJ0YWJsZShpLCBmYWxzZSkpCiAgICAgICAgICAgICAgICAgICAg\nY29sc1tpXS5zZXRGbGFnKENvbHVtbi5GTEFHX0ZLX0lOU0VSVCwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICBpZiAoaW8uaXNVcGRhdGFibGUoaSwgZmFsc2Up\nKQogICAgICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0RmxhZyhDb2x1bW4u\nRkxBR19GS19VUERBVEUsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBfdmFsLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgICAg\nICBfa2V5LnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgICAgICBfZWxlbS5y\nZXNvbHZlKE1PREVfTUFQUElORyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb3B5IG1hcHBpbmcgaW5mbyBmcm9tIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0\naGlzIG9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgY29weU1hcHBpbmdJ\nbmZvKEZpZWxkTWFwcGluZyBmbSkgewogICAgICAgIHNldE1hcHBlZEJ5KGZt\nLmdldE1hcHBlZEJ5KCkpOwogICAgICAgIF9pbmZvLmNvcHkoZm0uZ2V0TWFw\ncGluZ0luZm8oKSk7CiAgICAgICAgX3ZhbC5jb3B5TWFwcGluZ0luZm8oZm0u\nZ2V0VmFsdWVNYXBwaW5nKCkpOwogICAgICAgIF9rZXkuY29weU1hcHBpbmdJ\nbmZvKGZtLmdldEtleU1hcHBpbmcoKSk7CiAgICAgICAgX2VsZW0uY29weU1h\ncHBpbmdJbmZvKGZtLmdldEVsZW1lbnRNYXBwaW5nKCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogUHJlcGFyZSBtYXBwaW5nIGZvciBydW50aW1lIHVzZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVNYXBwaW5nKCkg\newogICAgICAgIF92YWwucmVzb2x2ZShNT0RFX01BUFBJTkdfSU5JVCk7CiAg\nICAgICAgX2tleS5yZXNvbHZlKE1PREVfTUFQUElOR19JTklUKTsKICAgICAg\nICBfZWxlbS5yZXNvbHZlKE1PREVfTUFQUElOR19JTklUKTsKICAgICAgICBp\nZiAoX3N0cmF0ZWd5ICE9IG51bGwpCiAgICAgICAgICAgIF9zdHJhdGVneS5p\nbml0aWFsaXplKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShGaWVs\nZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN1cGVyLmNvcHkoZm1kKTsKICAg\nICAgICBpZiAoX2ZldGNoTW9kZSA9PSBJbnRlZ2VyLk1BWF9WQUxVRSkKICAg\nICAgICAgICAgX2ZldGNoTW9kZSA9ICgoRmllbGRNYXBwaW5nKSBmbWQpLmdl\ndEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gdmFsaWRhdGVEYXRhU3RvcmVFeHRlbnNpb25QcmVmaXgoU3RyaW5nIHBy\nZWZpeCkgewogICAgICAgIHJldHVybiAiamRiYy0iLmVxdWFscyhwcmVmaXgp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBGaWVsZFN0cmF0ZWd5IGltcGxlbWVudGF0aW9uCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0QWxpYXMoKSB7CiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5\nKCkuZ2V0QWxpYXMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBtYXAoYm9v\nbGVhbiBhZGFwdCkgewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkubWFwKGFk\nYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcCB0aGlzIGZpZWxkIHRv\nIGl0cyB0YWJsZSwgb3B0aW9uYWxseSByZXF1aXJpbmcgdGhhdCBpdCBiZQog\nICAgICogaW4gYW5vdGhlciB0YWJsZS4gVXRpbGl0eSBtZXRob2QgZm9yIHVz\nZSBieSBtYXBwaW5nIHN0cmF0ZWdpZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIG1hcEpvaW4oYm9vbGVhbiBhZGFwdCwgYm9vbGVhbiBqb2luUmVxdWly\nZWQpIHsKICAgICAgICBUYWJsZSB0YWJsZSA9IF9pbmZvLmdldFRhYmxlKHRo\naXMsIGpvaW5SZXF1aXJlZCwgYWRhcHQpOwoKICAgICAgICBpZih0YWJsZSAh\nPSBudWxsICYmIHRhYmxlLmVxdWFscyhnZXREZWZpbmluZ01hcHBpbmcoKS5n\nZXRUYWJsZSgpKSkgewogICAgICAgICAgICAvLyBEb24ndCBjcmVhdGUgYSBq\nb2luIGlmIHRoZSBmaWVsZCdzIHRhYmxlIGlzIHRoZSBzYW1lIGFzIHRoZQog\nICAgICAgICAgICAvLyBjbGFzcydzIHRhYmxlLiAKICAgICAgICAgICAgdGFi\nbGUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgRm9yZWlnbktleSBqb2lu\nID0gbnVsbDsKICAgICAgICBpZiAodGFibGUgIT0gbnVsbCkKICAgICAgICAg\nICAgam9pbiA9IF9pbmZvLmdldEpvaW4odGhpcywgdGFibGUsIGFkYXB0KTsK\nICAgICAgICBpZiAoam9pbiA9PSBudWxsICYmIGpvaW5SZXF1aXJlZCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJqb2luLXJlcXVpcmVkIiwgdGhpcykpOwoKICAgICAgICBpZiAoam9pbiA9\nPSBudWxsKSB7CiAgICAgICAgICAgIF9pbmZvLmFzc2VydE5vSm9pbih0aGlz\nLCB0cnVlKTsKICAgICAgICAgICAgX2luZm8uYXNzZXJ0Tm9Gb3JlaWduS2V5\nKHRoaXMsICFhZGFwdCk7CiAgICAgICAgICAgIF9pbmZvLmFzc2VydE5vVW5p\ncXVlKHRoaXMsICFhZGFwdCk7CiAgICAgICAgICAgIF9pbmZvLmFzc2VydE5v\nSW5kZXgodGhpcywgIWFkYXB0KTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBfZmsgPSBqb2luOwogICAgICAgICAgICBfaW8gPSBfaW5mby5nZXRD\nb2x1bW5JTygpOwogICAgICAgICAgICBfb3V0ZXIgPSBfaW5mby5pc0pvaW5P\ndXRlcigpOwogICAgICAgICAgICBfdW5xID0gX2luZm8uZ2V0Sm9pblVuaXF1\nZSh0aGlzLCBmYWxzZSwgYWRhcHQpOwogICAgICAgICAgICBfam9pblRhYmxl\nVW5pcXVlcyA9IF9pbmZvLmdldEpvaW5UYWJsZVVuaXF1ZXModGhpcywgZmFs\nc2UsIGFkYXB0KTsKICAgICAgICAgICAgX2lkeCA9IF9pbmZvLmdldEpvaW5J\nbmRleCh0aGlzLCBhZGFwdCk7CiAgICAgICAgICAgIHRhYmxlLnNldEFzc29j\naWF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFw\ncyB0aGUgcHJpbWFyeSBrZXkgb24gdGhlIHNlY29uZGFyeSB0YWJsZSBmb3Ig\ndGhpcyBmaWVsZCwgaWYgdGhlCiAgICAgKiB1c2VyJ3MgZGVmYXVsdHMgY3Jl\nYXRlIG9uZS4gVGhpcyBtdXN0IGJlIGNhbGxlZCBhZnRlcgogICAgICogdGhp\ncyBmaWVsZCBpcyBtYXBwZWQgc28gdGhhdCBpdCdzIHRhYmxlIGhhcyBpdHMg\nY29sdW1ucyBzZXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG1hcFByaW1h\ncnlLZXkoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChhZGFwdCAmJiBf\nZmsgIT0gbnVsbCAmJiBfZmsuZ2V0VGFibGUoKS5nZXRQcmltYXJ5S2V5KCkg\nPT0gbnVsbCkKICAgICAgICAgICAgZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5n\nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgIGluc3RhbGxQ\ncmltYXJ5S2V5KHRoaXMsIF9may5nZXRUYWJsZSgpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBpbml0aWFsaXplKCkgewogICAgICAgIGFzc2VydFN0cmF0\nZWd5KCkuaW5pdGlhbGl6ZSgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGlu\nc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAJc2V0UEtWYWx1ZUZyb21NYXBwZWRCeUlkRmllbGQoc20pOwogICAg\nICAgIGFzc2VydFN0cmF0ZWd5KCkuaW5zZXJ0KHNtLCBzdG9yZSwgcm0pOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRQS1ZhbHVlRnJvbU1hcHBlZEJ5\nSWRGaWVsZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgaWYg\nKHNtIGluc3RhbmNlb2YgU3RhdGVNYW5hZ2VySW1wbCkgewogICAgICAgICAg\nICBMaXN0PEZpZWxkTWV0YURhdGE+IG1hcHBlZEJ5SWRGaWVsZHMgPSAoKFN0\nYXRlTWFuYWdlckltcGwpc20pLgogICAgICAgICAgICAgICAgZ2V0TWFwcGVk\nQnlJZEZpZWxkcygpOwogICAgICAgICAgICBpZiAobWFwcGVkQnlJZEZpZWxk\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICBpZiAoIW1hcHBlZEJ5SWRGaWVsZHMuY29udGFpbnModGhpcykpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICghaXNNYXBwZWRC\neUlkKCkpIAogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKXNt\nLgogICAgICAgICAgICAgICAgZmV0Y2hPYmplY3QoZ2V0SW5kZXgoKSk7CiAg\nICAgICAgICAgIGlmIChwYyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHBrU20gPSAoU3Rh\ndGVNYW5hZ2VySW1wbClwYy4KICAgICAgICAgICAgICAgIHBjR2V0U3RhdGVN\nYW5hZ2VyKCk7CiAgICAgICAgICAgIE9iamVjdCBwa1ZhbCA9IGdldFBLVmFs\ndWUocGtTbSk7CiAgICAgICAgICAgIGlmIChwa1ZhbCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBzZXRQS1ZhbHVlKChT\ndGF0ZU1hbmFnZXJJbXBsKXNtLCBwa1ZhbCk7CiAgICAgICAgICAgIHNtLnNl\ndE9iamVjdElkKAogICAgICAgICAgICBBcHBsaWNhdGlvbklkcy5jcmVhdGUo\nc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCksIAogICAgICAgICAgICAgICAg\nc20uZ2V0TWV0YURhdGEoKSkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAg\ncHJpdmF0ZSBPYmplY3QgZ2V0UEtWYWx1ZShTdGF0ZU1hbmFnZXJJbXBsIHBr\nU20pIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHBrTWV0YSA9IHBrU20uZ2V0\nTWV0YURhdGEoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHBr\nTWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgLy8gTWFwcGVk\nQnlJZCBpcyBmb3Igc2luZ2xlIHZhbHVlIHByaW1hcnkga2V5IG9yIGVtYmVk\nZGFibGUgaWQKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgZWxzZSAKICAgICAgICAgICAg\ncmV0dXJuIEFwcGxpY2F0aW9uSWRzLmdldEtleShwa1NtLmdldE9iamVjdElk\nKCksIHBrTWV0YSk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBzZXRQ\nS1ZhbHVlKFN0YXRlTWFuYWdlckltcGwgc20sIE9iamVjdCBwa1ZhbCkgewog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRhLmdldFByaW1h\ncnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJhdGVneSBzdHJhdCA9\nICgoRmllbGRNYXBwaW5nKWZtZHNbMF0pLmdldFN0cmF0ZWd5KCk7CiAgICAg\nICAgLy8gc2luZ2xlIHZhbHVlIHByaW1hcnkga2V5CiAgICAgICAgaWYgKHN0\ncmF0IGluc3RhbmNlb2YgUHJpbWl0aXZlRmllbGRTdHJhdGVneSkgCiAgICAg\nICAgICAgICgoUHJpbWl0aXZlRmllbGRTdHJhdGVneSlzdHJhdCkuc2V0QXV0\nb0Fzc2lnbmVkVmFsdWUoc20sIG51bGwsIG51bGwsCiAgICAgICAgICAgIHBr\nVmFsKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy9jb21wb3NpdGUg\na2V5CiAgICAgICAgICAgIFN0cmluZyBtYXBwZWRCeUlkRmllbGROYW1lID0g\nZ2V0TWFwcGVkQnlJZFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChtYXBwZWRC\neUlkRmllbGROYW1lICE9IG51bGwgJiYgCiAgICAgICAgICAgICAgICBtYXBw\nZWRCeUlkRmllbGROYW1lLmxlbmd0aCgpID4gMCkgewogICAgICAgICAgICAg\nICAgLy9UaGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHdpdGhpbiB0aGUgY29t\ncG9zaXRlIGtleSB0byB3aGljaCAKICAgICAgICAgICAgICAgIC8vdGhlIHJl\nbGF0aW9uc2hpcCBhdHRyaWJ1dGUgY29ycmVzcG9uZHMuCiAgICAgICAgICAg\nICAgICBPYmplY3QgdGFyZ2V0ID0gKChPYmplY3RJZClzbS5nZXRPYmplY3RJ\nZCgpKS5nZXRJZCgpOwogICAgICAgICAgICAgICAgaWYgKHRhcmdldCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgIHNldE1hcHBlZEJ5SWRWYWx1ZSh0YXJnZXQsIHBrVmFsLCBtYXBwZWRC\neUlkRmllbGROYW1lKTsKICAgICAgICAgICAgICAgIHBrVmFsID0gdGFyZ2V0\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0Rmll\nbGQoZm1kc1swXS5nZXRJbmRleCgpLCBwa1ZhbCk7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBwZWRCeUlkVmFsdWUoT2Jq\nZWN0IHRhcmdldCwgCiAgICAgICAgT2JqZWN0IHZhbCwgU3RyaW5nIG1hcHBl\nZEJ5SWRGaWVsZE5hbWUpIHsKICAgICAgICBSZWZsZWN0aW9uLnNldCh0YXJn\nZXQsIAogICAgICAgICAgICBSZWZsZWN0aW9uLmZpbmRGaWVsZCh0YXJnZXQu\nZ2V0Q2xhc3MoKSwgbWFwcGVkQnlJZEZpZWxkTmFtZSwgdHJ1ZSksIAogICAg\nICAgICAgICB2YWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01h\nbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgYXNzZXJ0U3RyYXRlZ3koKS51cGRhdGUoc20sIHN0b3JlLCBybSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVn\neSgpLmRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIERlbGV0ZSB0aGUgcm93IGZvciB0aGlzIG9iamVjdCBpZiB0aGUgcmVm\nZXJlbmNlIGZvcmVpZ24ga2V5IGV4aXN0cy4KICAgICAqIFV0aWxpdHkgbWV0\naG9kIGZvciB1c2UgYnkgbWFwcGluZyBzdHJhdGVnaWVzLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBkZWxldGVSb3coT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIFJvd01hbmFnZXIgcm0pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9mayAh\nPSBudWxsKSB7CiAgICAgICAgICAgIFJvdyByb3cgPSBybS5nZXRSb3coZ2V0\nVGFibGUoKSwgUm93LkFDVElPTl9ERUxFVEUsIHNtLCB0cnVlKTsKICAgICAg\nICAgICAgcm93LndoZXJlRm9yZWlnbktleShfZmssIHNtKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJvdyB0byB1c2Ug\nZm9yIHRoaXMgZmllbGQuIFRoaXMgbWV0aG9kIGlzIG1lYW50IG9ubHkgZm9y\nCiAgICAgKiBzaW5nbGUtdmFsdWUgZmllbGRzIHRoYXQgbWlnaHQgcmVzaWRl\nIGluIGEgdGFibGUgdGhhdCBpcyBqb2luZWQgdG8KICAgICAqIHRoZSBwcmlt\nYXJ5IHRhYmxlIHRocm91Z2ggdGhlIGpvaW4gZm9yZWlnbiBrZXkuIEl0IGlz\nIG5vdAogICAgICogbWVhbnQgZm9yIG11bHRpLXZhbHVlZCBmaWVsZHMgbGlr\nZSBjb2xsZWN0aW9ucyBhbmQgbWFwcy4gVGhlIG1ldGhvZAogICAgICogY2hl\nY2tzIHdoZXRoZXIgd2UncmUgdXNpbmcgYW4gb3V0ZXIgam9pbiBhbmQgaWYg\nc28gaXQgZGVsZXRlcyB0aGUKICAgICAqIGZpZWxkJ3MgcHJldmlvdXMgdmFs\ndWUsIHRoZW4gaWYgdGhlIGZpZWxkIGlzIG5vbi1udWxsIHJldHVybnMgYW4g\naW5zZXJ0CiAgICAgKiByb3cgZm9yIHRoZSBuZXcgdmFsdWUuIFRoZSBqb2lu\nIGZvcmVpZ24ga2V5IHdpbGwgYWxyZWFkeSBiZSBzZXQgb24KICAgICAqIHRo\nZSByZXR1cm5lZCByb3c7IG1hcHBpbmcgc3RyYXRlZ2llcyBqdXN0IG5lZWQg\ndG8gc2V0IHRoZWlyIG93biB2YWx1ZXMuCiAgICAgKiBVdGlsaXR5IG1ldGhv\nZCBmb3IgdXNlIGJ5IG1hcHBpbmcgc3RyYXRlZ2llcy4KICAgICAqLwogICAg\ncHVibGljIFJvdyBnZXRSb3coT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRC\nQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtLAogICAgICAgIGludCBhY3Rp\nb24pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUm93\nIHJvdyA9IG51bGw7CiAgICAgICAgYm9vbGVhbiBuZXdPdXRlclJvdyA9IGZh\nbHNlOwogICAgICAgIGlmIChfZmsgIT0gbnVsbCAmJiBfb3V0ZXIgJiYgYWN0\naW9uICE9IFJvdy5BQ1RJT05fREVMRVRFKSB7CiAgICAgICAgICAgIC8vIGlm\nIHVwZGF0aW5nIHdpdGggb3V0ZXIgam9pbiwgZGVsZXRlIG9sZCB2YWx1ZSBm\naXJzdCwgdGhlbiBpbnNlcnQ7CiAgICAgICAgICAgIC8vIHdlIGNhbid0IGp1\nc3QgdXBkYXRlIGIvYyB0aGUgcm93IG1pZ2h0IG5vdCBleGlzdAogICAgICAg\nICAgICBpZiAoYWN0aW9uID09IFJvdy5BQ1RJT05fVVBEQVRFKSB7CiAgICAg\nICAgICAgICAgICAvLyBtYXliZSBzb21lIG90aGVyIGZpZWxkIGFscmVhZHkg\naXMgdXBkYXRpbmc/CiAgICAgICAgICAgICAgICByb3cgPSBybS5nZXRSb3co\nZ2V0VGFibGUoKSwgUm93LkFDVElPTl9VUERBVEUsIHNtLCBmYWxzZSk7CiAg\nICAgICAgICAgICAgICBpZiAocm93ID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBSb3cgZGVsID0gcm0uZ2V0Um93KGdldFRhYmxlKCksIFJvdy5B\nQ1RJT05fREVMRVRFLCBzbSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgZGVsLndoZXJlRm9yZWlnbktleShf\nZmssIHNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICByb3cgPSBybS5nZXRSb3coZ2V0VGFibGUoKSwg\nUm93LkFDVElPTl9JTlNFUlQsIHNtLCBmYWxzZSk7CgogICAgICAgICAgICAv\nLyBvbmx5IHVwZGF0ZS9pbnNlcnQgaWYgdGhlIHJvdyBleGlzdHMgYWxyZWFk\neSBvciB0aGUgdmFsdWUgaXMKICAgICAgICAgICAgLy8gbm90IG51bGwvZGVm\nYXVsdAogICAgICAgICAgICBpZiAocm93ID09IG51bGwgJiYgIWlzTnVsbFZh\nbHVlKHNtKSkgewogICAgICAgICAgICAgICAgcm93ID0gcm0uZ2V0Um93KGdl\ndFRhYmxlKCksIFJvdy5BQ1RJT05fSU5TRVJULCBzbSwgdHJ1ZSk7CiAgICAg\nICAgICAgICAgICBuZXdPdXRlclJvdyA9IHRydWU7CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcm93ID0gcm0uZ2V0Um93KGdl\ndFRhYmxlKCksIGFjdGlvbiwgc20sIHRydWUpOwoKICAgICAgICAvLyBzZXR1\ncCBmawogICAgICAgIGlmIChyb3cgIT0gbnVsbCAmJiBfZmsgIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAocm93LmdldEFjdGlvbigpID09IFJvdy5BQ1RJ\nT05fSU5TRVJUKQogICAgICAgICAgICAgICAgcm93LnNldEZvcmVpZ25LZXko\nX2ZrLCBfaW8sIHNtKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgcm93LndoZXJlRm9yZWlnbktleShfZmssIHNtKTsKCiAgICAgICAgICAg\nIC8vIGlmIHRoaXMgaXMgYSBuZXcgb3V0ZXIgam9pbmVkIHJvdywgbWFyayBp\ndCBpbnZhbGlkIHVudGlsCiAgICAgICAgICAgIC8vIHNvbWUgbWFwcGluZyBh\nY3R1YWxseSBzZXRzIGluZm9ybWF0aW9uIG9uIGl0CiAgICAgICAgICAgIGlm\nIChuZXdPdXRlclJvdykKICAgICAgICAgICAgICAgIHJvdy5zZXRWYWxpZChm\nYWxzZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByb3c7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGZpZWxkIGlzIG51\nbGwvZGVmYXVsdCBpbiB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBpc051bGxWYWx1ZShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtKSB7CiAgICAgICAgc3dpdGNoIChnZXRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAg\nICAgICByZXR1cm4gIXNtLmZldGNoQm9vbGVhbihnZXRJbmRleCgpKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAg\nIHJldHVybiBzbS5mZXRjaEJ5dGUoZ2V0SW5kZXgoKSkgPT0gMDsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJl\ndHVybiBzbS5mZXRjaENoYXIoZ2V0SW5kZXgoKSkgPT0gMDsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHNtLmZldGNoRG91YmxlKGdldEluZGV4KCkpID09IDA7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHNtLmZldGNoRmxvYXQoZ2V0SW5kZXgoKSkgPT0gMDsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgcmV0dXJu\nIHNtLmZldGNoSW50KGdldEluZGV4KCkpID09IDA7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gc20u\nZmV0Y2hMb25nKGdldEluZGV4KCkpID09IDA7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtLmZl\ndGNoU2hvcnQoZ2V0SW5kZXgoKSkgPT0gMDsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtLmZl\ndGNoU3RyaW5nKGdldEluZGV4KCkpID09IG51bGw7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hPYmplY3Qo\nZ2V0SW5kZXgoKSkgPT0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIEJvb2xlYW4gaXNDdXN0b21JbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIGFzc2Vy\ndFN0cmF0ZWd5KCkuaXNDdXN0b21JbnNlcnQoc20sIHN0b3JlKTsKICAgIH0K\nCiAgICBwdWJsaWMgQm9vbGVhbiBpc0N1c3RvbVVwZGF0ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1\ncm4gYXNzZXJ0U3RyYXRlZ3koKS5pc0N1c3RvbVVwZGF0ZShzbSwgc3RvcmUp\nOwogICAgfQoKICAgIHB1YmxpYyBCb29sZWFuIGlzQ3VzdG9tRGVsZXRlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkgewogICAg\nICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzQ3VzdG9tRGVsZXRlKHNt\nLCBzdG9yZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY3VzdG9tSW5zZXJ0\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJh\ndGVneSgpLmN1c3RvbUluc2VydChzbSwgc3RvcmUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGN1c3RvbVVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5jdXN0b21VcGRhdGUoc20s\nIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjdXN0b21EZWxldGUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0\nZWd5KCkuY3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0RmllbGRNYXBwaW5nKEZpZWxkTWFwcGluZyBvd25lcikg\newogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuc2V0RmllbGRNYXBwaW5nKG93\nbmVyKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHN1cHBvcnRzU2VsZWN0KFNl\nbGVjdCBzZWwsIGludCB0eXBlLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAog\nICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLnN1\ncHBvcnRzU2VsZWN0KHNlbCwgdHlwZSwgc20sIHN0b3JlLCBmZXRjaCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0RWFnZXJQYXJhbGxlbChTZWxl\nY3RFeGVjdXRvciBzZWwsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3ko\nKS5zZWxlY3RFYWdlclBhcmFsbGVsKHNlbCwgc20sIHN0b3JlLCBmZXRjaCwg\nZWFnZXJNb2RlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RFYWdl\nckpvaW4oU2VsZWN0IHNlbCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGludCBlYWdlck1vZGUpIHsKICAgICAgICBhc3NlcnRTdHJhdGVn\neSgpLnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCBzdG9yZSwgZmV0Y2gsIGVh\nZ2VyTW9kZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNFYWdlclNl\nbGVjdFRvTWFueSgpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3ko\nKS5pc0VhZ2VyU2VsZWN0VG9NYW55KCk7CiAgICB9CgogICAgcHVibGljIGlu\ndCBzZWxlY3QoU2VsZWN0IHNlbCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIGludCBlYWdlck1vZGUpIHsKICAgICAgICByZXR1cm4gYXNz\nZXJ0U3RyYXRlZ3koKS5zZWxlY3Qoc2VsLCBzbSwgc3RvcmUsIGZldGNoLCBl\nYWdlck1vZGUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFueSBq\nb2lucyBuZWVkZWQgdG8gZ2V0IGZyb20gdGhlIHByaW1hcnkgdGFibGUgdG8g\ndGhpcyB0YWJsZS4KICAgICAqLwogICAgcHVibGljIEpvaW5zIGpvaW4oU2Vs\nZWN0IHNlbCkgewogICAgICAgIGlmIChfZmsgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIEpvaW5zIGpvaW5zID0gc2VsLm5l\nd0pvaW5zKCk7CiAgICAgICAgaWYgKF9vdXRlcikKICAgICAgICAgICAgcmV0\ndXJuIGpvaW5zLm91dGVySm9pbihfZmssIHRydWUsIGZhbHNlKTsKICAgICAg\nICByZXR1cm4gam9pbnMuam9pbihfZmssIHRydWUsIGZhbHNlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBhIDxjb2RlPndoZXJlUHJpbWFyeUtleTwv\nY29kZT4gb3IgPGNvZGU+d2hlcmVGb3JlaWduS2V5PC9jb2RlPgogICAgICog\nY29uZGl0aW9uIHRvIHRoZSBnaXZlbiBzZWxlY3QsIGRlcGVuZGluZyBvbiB3\naGV0aGVyIHdlIGhhdmUgYSBqb2luCiAgICAgKiBmb3JlaWduIGtleS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgd2hlcmVQcmltYXJ5S2V5KFNlbGVjdCBz\nZWwsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlKSB7CiAgICAgICAgaWYgKF9mayAhPSBudWxsKQogICAgICAgICAg\nICBzZWwud2hlcmVGb3JlaWduS2V5KF9maywgc20uZ2V0T2JqZWN0SWQoKSwg\nZ2V0RGVmaW5pbmdNYXBwaW5nKCksCiAgICAgICAgICAgICAgICBzdG9yZSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5\nKHNtLmdldE9iamVjdElkKCksIGdldERlZmluaW5nTWFwcGluZygpLAogICAg\nICAgICAgICAgICAgc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIG9yZGVyaW5nIHRvIHRoZSBnaXZlbiBzZWxlY3QgZm9yIGFsbCBub24tcmVs\nYXRpb24gb3JkZXIgdmFsdWVzLAogICAgICogaW5jbHVkaW5nIHRoZSBzeW50\naGV0aWMgb3JkZXIgY29sdW1uLCBpZiBhbnkuCiAgICAgKgogICAgICogQHBh\ncmFtIGVsZW0gdGhlIHJlbGF0ZWQgdHlwZSB3ZSdyZSBmZXRjaGluZywgb3Ig\nbnVsbAogICAgICogQHBhcmFtIGpvaW5zIHRoZSBqb2lucyB0byB0aGlzIGZp\nZWxkJ3MgdGFibGUKICAgICAqLwogICAgcHVibGljIHZvaWQgb3JkZXJMb2Nh\nbChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgZWxlbSwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBfb3JkZXJDb2wub3JkZXIoc2VsLCBlbGVtLCBqb2lucyk7\nCiAgICAgICAgSkRCQ09yZGVyW10gb3JkZXJzID0gKEpEQkNPcmRlcltdKSBn\nZXRPcmRlcnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9yZGVy\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFvcmRlcnNbaV0uaXNJ\nblJlbGF0aW9uKCkpCiAgICAgICAgICAgICAgICBvcmRlcnNbaV0ub3JkZXIo\nc2VsLCBlbGVtLCBqb2lucyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\nb3JkZXJpbmcgdG8gdGhlIGdpdmVuIHNlbGVjdCBmb3IgYWxsIHJlbGF0aW9u\nLWJhc2VkIHZhbHVlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gZWxlbSB0aGUg\ncmVsYXRlZCB0eXBlIHdlJ3JlIGZldGNoaW5nCiAgICAgKiBAcGFyYW0gam9p\nbnMgdGhlIGpvaW5zIGFjcm9zcyB0aGUgcmVsYXRpb24KICAgICAqLwogICAg\ncHVibGljIHZvaWQgb3JkZXJSZWxhdGlvbihTZWxlY3Qgc2VsLCBDbGFzc01h\ncHBpbmcgZWxlbSwgSm9pbnMgam9pbnMpIHsKICAgICAgICBKREJDT3JkZXJb\nXSBvcmRlcnMgPSAoSkRCQ09yZGVyW10pIGdldE9yZGVycygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgb3JkZXJzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAob3JkZXJzW2ldLmlzSW5SZWxhdGlvbigpKQogICAgICAg\nICAgICAgICAgb3JkZXJzW2ldLm9yZGVyKHNlbCwgZWxlbSwgam9pbnMpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZEVhZ2VyUGFyYWxsZWwoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCByZXMpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkubG9hZEVhZ2VyUGFyYWxsZWwoc20sIHN0b3JlLCBm\nZXRjaCwgcmVzKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkRWFnZXJK\nb2luKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwK\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQg\ncmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFz\nc2VydFN0cmF0ZWd5KCkubG9hZEVhZ2VySm9pbihzbSwgc3RvcmUsIGZldGNo\nLCByZXMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3ko\nKS5sb2FkKHNtLCBzdG9yZSwgZmV0Y2gsIHJlcyk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRTdHJhdGVneSgpLmxvYWQoc20sIHN0b3JlLCBmZXRjaCk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWws\nIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJh\ndGVneSgpLnRvRGF0YVN0b3JlVmFsdWUodmFsLCBzdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCB0b0tleURhdGFTdG9yZVZhbHVlKE9iamVjdCB2\nYWwsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBhc3NlcnRT\ndHJhdGVneSgpLnRvS2V5RGF0YVN0b3JlVmFsdWUodmFsLCBzdG9yZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNFbXB0eShTUUxCdWZmZXIg\nc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucykgewogICAgICAgIGFzc2Vy\ndFN0cmF0ZWd5KCkuYXBwZW5kSXNFbXB0eShzcWwsIHNlbCwgam9pbnMpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90RW1wdHkoU1FMQnVm\nZmVyIHNxbCwgU2VsZWN0IHNlbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBh\nc3NlcnRTdHJhdGVneSgpLmFwcGVuZElzTm90RW1wdHkoc3FsLCBzZWwsIGpv\naW5zKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc051bGwoU1FM\nQnVmZmVyIHNxbCwgU2VsZWN0IHNlbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBhc3NlcnRTdHJhdGVneSgpLmFwcGVuZElzTnVsbChzcWwsIHNlbCwgam9p\nbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90TnVsbChT\nUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucykgewogICAg\nICAgIGFzc2VydFN0cmF0ZWd5KCkuYXBwZW5kSXNOb3ROdWxsKHNxbCwgc2Vs\nLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kU2l6ZShT\nUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucykgewogICAg\nICAgIGFzc2VydFN0cmF0ZWd5KCkuYXBwZW5kU2l6ZShzcWwsIHNlbCwgam9p\nbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZEluZGV4KFNRTEJ1\nZmZlciBzcWwsIFNlbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\nYXNzZXJ0U3RyYXRlZ3koKS5hcHBlbmRJbmRleChzcWwsIHNlbCwgam9pbnMp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZFR5cGUoU1FMQnVmZmVy\nIHNxbCwgU2VsZWN0IHNlbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBhc3Nl\ncnRTdHJhdGVneSgpLmFwcGVuZFR5cGUoc3FsLCBzZWwsIGpvaW5zKTsKICAg\nIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbihKb2lucyBqb2lucywgYm9vbGVh\nbiBmb3JjZU91dGVyKSB7CiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5\nKCkuam9pbihqb2lucywgZm9yY2VPdXRlcik7CiAgICB9CgogICAgcHVibGlj\nIEpvaW5zIGpvaW5LZXkoSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRl\ncikgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmpvaW5LZXko\nam9pbnMsIGZvcmNlT3V0ZXIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBq\nb2luUmVsYXRpb24oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRlciwK\nICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkuam9pblJlbGF0aW9uKGpvaW5zLCBmb3JjZU91dGVy\nLCB0cmF2ZXJzZSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5LZXlS\nZWxhdGlvbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyLAogICAg\nICAgIGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0\nU3RyYXRlZ3koKS5qb2luS2V5UmVsYXRpb24oam9pbnMsIGZvcmNlT3V0ZXIs\nIHRyYXZlcnNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEpvaW5zIGZyb20g\ndGhlIG93bmluZyBjbGFzcycgdGFibGUgdG8gdGhlIHRhYmxlIHdoZXJlIHRo\naXMgZmllbGQgbGllcwogICAgICogdXNpbmcgdGhlIGpvaW4gZm9yZWlnbiBr\nZXkuIFV0aWxpdHkgbWV0aG9kIGZvciB1c2UgYnkgbWFwcGluZyBzdHJhdGVn\naWVzLgogICAgICovCiAgICBwdWJsaWMgSm9pbnMgam9pbihKb2lucyBqb2lu\ncywgYm9vbGVhbiBmb3JjZU91dGVyLCBib29sZWFuIHRvTWFueSkgewogICAg\nICAgIGlmIChfZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGpvaW5z\nOwogICAgICAgIGlmIChfb3V0ZXIgfHwgZm9yY2VPdXRlcikKICAgICAgICAg\nICAgcmV0dXJuIGpvaW5zLm91dGVySm9pbihfZmssIHRydWUsIHRvTWFueSk7\nCiAgICAgICAgcmV0dXJuIGpvaW5zLmpvaW4oX2ZrLCB0cnVlLCB0b01hbnkp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZFByb2plY3Rpb24oSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgCS8vIE9QRU5KUEEtNjYyOiBWZXJzaW9u\nIGZpZWxkcyBoYXZlIE5vbmVGaWVsZFN0cmF0ZWd5IC0tIGhlbmNlIHRoZXkK\nICAgIAkvLyBuZWVkIHNwZWNpYWwgdHJlYXRtZW50CiAgICAJaWYgKGlzVmVy\nc2lvbigpKSB7CiAgICAJCXJldHVybiBnZXREZWZpbmluZ01hcHBpbmcoKS5n\nZXRWZXJzaW9uKCkubG9hZChudWxsLCBzdG9yZSwgcmVzKTsKICAgIAl9CiAg\nICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkubG9hZFByb2plY3Rpb24o\nc3RvcmUsIGZldGNoLCByZXMsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGxvYWRLZXlQcm9qZWN0aW9uKEpEQkNTdG9yZSBzdG9yZSwKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVz\nLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKQogICAgICAgICAgICAu\nbG9hZEtleVByb2plY3Rpb24oc3RvcmUsIGZldGNoLCByZXMsIGpvaW5zKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNpb25hYmxlKCkgewog\nICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzVmVyc2lvbmFibGUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0sCiAg\nICAgICAgT2JqZWN0IHByZXZWYWx1ZSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLndoZXJlKHNtLCBz\ndG9yZSwgcm0sIHByZXZWYWx1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSBGaWVs\nZFN0cmF0ZWd5IGFzc2VydFN0cmF0ZWd5KCkgewogICAgICAgIGlmIChfc3Ry\nYXRlZ3kgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVneTsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBW\nYWx1ZU1hcHBpbmcgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgVmFsdWVNYXBwaW5nSW5m\nbyBnZXRWYWx1ZUluZm8oKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0VmFs\ndWVJbmZvKCk7CiAgICB9CgogICAgcHVibGljIFZhbHVlSGFuZGxlciBnZXRI\nYW5kbGVyKCkgewogICAgICAgIHJldHVybiBfdmFsLmdldEhhbmRsZXIoKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRIYW5kbGVyKFZhbHVlSGFuZGxl\nciBoYW5kbGVyKSB7CiAgICAgICAgX3ZhbC5zZXRIYW5kbGVyKGhhbmRsZXIp\nOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBw\naW5nKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzc01hcHBpbmcgZ2V0VHlwZU1hcHBpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIF92YWwuZ2V0VHlwZU1hcHBpbmcoKTsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNYXBwaW5nIGdldERlY2xhcmVkVHlwZU1hcHBpbmcoKSB7CiAgICAg\nICAgcmV0dXJuIF92YWwuZ2V0RGVjbGFyZWRUeXBlTWFwcGluZygpOwogICAg\nfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0RW1iZWRkZWRNYXBwaW5n\nKCkgewogICAgICAgIHJldHVybiBfdmFsLmdldEVtYmVkZGVkTWFwcGluZygp\nOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0VmFsdWVNYXBw\nZWRCeU1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0VmFsdWVN\nYXBwZWRCeU1hcHBpbmcoKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sdW1uW10g\nZ2V0Q29sdW1ucygpIHsKICAgICAgICAvLyBwY2w6IDYgSnVseSAyMDA3OiB0\naGlzIHNlZW1zIGEgYml0IGhhY2t5LCBidXQgaWYgdGhlIG1hcHBpbmcgaXMg\nYQogICAgICAgIC8vIHZlcnNpb24sIGl0IHdpbGwgaGF2ZSBhIE5vbmVGaWVs\nZE1hcHBpbmcgKHNpbmNlIHRoZSB2ZXJzaW9uIHN0cmF0ZWd5CiAgICAgICAg\nLy8gZm9yIHRoZSBjbGFzcyB0YWtlcyBjYXJlIG9mIGl0J3MgbWFwcGluZyks\nIGFuZCBOb25lRmllbGRTdHJhdGVnaWVzCiAgICAgICAgLy8gZG8gbm90IGhh\ndmUgY29sdW1ucy4KICAgICAgICBpZiAoaXNWZXJzaW9uKCkpCiAgICAgICAg\nICAgIHJldHVybiBnZXREZWNsYXJpbmdNYXBwaW5nKCkuZ2V0VmVyc2lvbigp\nLmdldENvbHVtbnMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVy\nbiBfdmFsLmdldENvbHVtbnMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRDb2x1bW5zKENvbHVtbltdIGNvbHMpIHsKICAgICAgICBfdmFsLnNldENv\nbHVtbnMoY29scyk7CiAgICB9CgogICAgcHVibGljIENvbHVtbklPIGdldENv\nbHVtbklPKCkgewogICAgICAgIHJldHVybiBfdmFsLmdldENvbHVtbklPKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29sdW1uSU8oQ29sdW1uSU8g\naW8pIHsKICAgICAgICBfdmFsLnNldENvbHVtbklPKGlvKTsKICAgIH0KCiAg\nICBwdWJsaWMgRm9yZWlnbktleSBnZXRGb3JlaWduS2V5KCkgewogICAgICAg\nIHJldHVybiBfdmFsLmdldEZvcmVpZ25LZXkoKTsKICAgIH0KCiAgICBwdWJs\naWMgRm9yZWlnbktleSBnZXRGb3JlaWduS2V5KENsYXNzTWFwcGluZyB0YXJn\nZXQpIHsKICAgICAgICByZXR1cm4gX3ZhbC5nZXRGb3JlaWduS2V5KHRhcmdl\ndCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Rm9yZWlnbktleShGb3Jl\naWduS2V5IGZrKSB7CiAgICAgICAgX3ZhbC5zZXRGb3JlaWduS2V5KGZrKTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEpvaW5EaXJlY3Rpb24oKSB7CiAg\nICAgICAgcmV0dXJuIF92YWwuZ2V0Sm9pbkRpcmVjdGlvbigpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldEpvaW5EaXJlY3Rpb24oaW50IGRpcmVjdGlv\nbikgewogICAgICAgIF92YWwuc2V0Sm9pbkRpcmVjdGlvbihkaXJlY3Rpb24p\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoUm93IHJv\ndywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBfdmFsLnNldEZvcmVpZ25LZXkocm93LCBz\nbSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KFJv\ndyByb3csIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX3ZhbC53aGVyZUZvcmVpZ25LZXko\ncm93LCBzbSk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdl\ndEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiBf\ndmFsLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRTZWxlY3RTdWJjbGFzc2VzKCkgewogICAgICAgIHJl\ndHVybiBfdmFsLmdldFNlbGVjdFN1YmNsYXNzZXMoKTsKICAgIH0KCiAgICBw\ndWJsaWMgVW5pcXVlIGdldFZhbHVlVW5pcXVlKCkgewogICAgICAgIHJldHVy\nbiBfdmFsLmdldFZhbHVlVW5pcXVlKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0VmFsdWVVbmlxdWUoVW5pcXVlIHVucSkgewogICAgICAgIF92YWwu\nc2V0VmFsdWVVbmlxdWUodW5xKTsKICAgIH0KCiAgICBwdWJsaWMgSW5kZXgg\nZ2V0VmFsdWVJbmRleCgpIHsKICAgICAgICByZXR1cm4gX3ZhbC5nZXRWYWx1\nZUluZGV4KCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VmFsdWVJbmRl\neChJbmRleCBpZHgpIHsKICAgICAgICBfdmFsLnNldFZhbHVlSW5kZXgoaWR4\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRVc2VDbGFzc0NyaXRl\ncmlhKCkgewogICAgICAgIHJldHVybiBfdmFsLmdldFVzZUNsYXNzQ3JpdGVy\naWEoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRVc2VDbGFzc0NyaXRl\ncmlhKGJvb2xlYW4gY3JpdGVyaWEpIHsKICAgICAgICBfdmFsLnNldFVzZUNs\nYXNzQ3JpdGVyaWEoY3JpdGVyaWEpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0UG9seW1vcnBoaWMoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuZ2V0UG9s\neW1vcnBoaWMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRQb2x5bW9y\ncGhpYyhpbnQgcG9seSkgewogICAgICAgIF92YWwuc2V0UG9seW1vcnBoaWMo\ncG9seSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBtYXBDb25zdHJhaW50cyhTdHJpbmcgbmFt\nZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIF92YWwubWFwQ29uc3RyYWlu\ndHMobmFtZSwgYWRhcHQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1hcENv\nbnN0cmFpbnRzKERCSWRlbnRpZmllciBuYW1lLCBib29sZWFuIGFkYXB0KSB7\nCiAgICAgICAgX3ZhbC5tYXBDb25zdHJhaW50cyhuYW1lLCBhZGFwdCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY29weU1hcHBpbmdJbmZvKFZhbHVlTWFw\ncGluZyB2bSkgewogICAgICAgIF92YWwuY29weU1hcHBpbmdJbmZvKHZtKTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRoaXMgZmll\nbGQgaXMgdGhlIG93bmluZyBzaWRlIG9mIGEgYmlkaXJlY3Rpb25hbCByZWxh\ndGlvbgogICAgICogd2l0aCBhIGpvaW4gdGFibGUuIEV2YWx1YXRlZCBvbmx5\nIG9uY2UgYW5kIHRoZSByZXN1bHQgY2FjaGVkIGZvciAKICAgICAqIHN1YnNl\ncXVlbnQgY2FsbC4gSGVuY2UgbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgcmVzb2x1\ndGlvbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNCaWRpcmVjdGlv\nbmFsSm9pblRhYmxlTWFwcGluZ093bmVyKCkgewogICAgCWlmIChfYmlkaXJl\nY3Rpb25hbEpvaW5UYWJsZU93bmVyICE9IG51bGwpCiAgICAJCXJldHVybiBf\nYmlkaXJlY3Rpb25hbEpvaW5UYWJsZU93bmVyLmJvb2xlYW5WYWx1ZSgpOwog\nICAgCQogICAgCV9iaWRpcmVjdGlvbmFsSm9pblRhYmxlT3duZXIgPSBmYWxz\nZTsKICAgICAgICBGb3JlaWduS2V5IGZrID0gZ2V0Rm9yZWlnbktleSgpOwog\nICAgICAgIGlmIChmayAhPSBudWxsKSAKICAgICAgICAJcmV0dXJuIGZhbHNl\nOwogICAgICAgIEZvcmVpZ25LZXkgamZrID0gZ2V0Sm9pbkZvcmVpZ25LZXko\nKTsKICAgICAgICBpZiAoamZrID09IG51bGwpIAogICAgICAgIAlyZXR1cm4g\nZmFsc2U7CiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5ID0gZ2V0VmFs\ndWVNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICBpZiAobWFwcGVkQnkgIT0g\nbnVsbCkgCiAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICBWYWx1ZU1h\ncHBpbmcgZWxlbSA9IGdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgaWYg\nKGVsZW0gPT0gbnVsbCkgCiAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAg\nICBDbGFzc01hcHBpbmcgcmVsVHlwZSA9IGVsZW0uZ2V0RGVjbGFyZWRUeXBl\nTWFwcGluZygpOwogICAgICAgIGlmIChyZWxUeXBlID09IG51bGwpIAogICAg\nICAgIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgRmllbGRNYXBwaW5nW10gcmVs\nRm1kcyA9IHJlbFR5cGUuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAgIGZv\nciAoaW50IGk9MDsgaTxyZWxGbWRzLmxlbmd0aDtpKyspIHsKICAgICAgICAg\nICAgRmllbGRNYXBwaW5nIHJmbSA9IHJlbEZtZHNbaV07CiAgICAgICAgICAg\nIGlmIChyZm0uZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKSA9PSBnZXREZWNs\nYXJpbmdNYXBwaW5nKCkpIHsKICAgICAgICAJCUZvcmVpZ25LZXkgcmpmayA9\nIHJmbS5nZXRKb2luRm9yZWlnbktleSgpOwogICAgICAgIAkJaWYgKHJqZmsg\nPT0gbnVsbCkgCiAgICAgICAgCQkgICAgY29udGludWU7CiAgICAgICAgICAg\nICAgICBpZiAocmpmay5nZXRUYWJsZSgpID09IGpmay5nZXRUYWJsZSgpICYm\nCiAgICAgICAgICAgICAgICAgICAgICAgIGpmay5nZXRUYWJsZSgpLmdldENv\nbHVtbnMoKS5sZW5ndGggPT0KICAgICAgICAgICAgICAgICAgICAgICAgamZr\nLmdldENvbHVtbnMoKS5sZW5ndGggKyByamZrLmdldENvbHVtbnMoKS5sZW5n\ndGgpIHsKICAgICAgICAJCQlfYmlkaXJlY3Rpb25hbEpvaW5UYWJsZU93bmVy\nID0gdHJ1ZTsKICAgICAgICAJCQlicmVhazsKICAgICAgICAJCX0KICAgICAg\nICAJfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2JpZGlyZWN0aW9uYWxK\nb2luVGFibGVPd25lci5ib29sZWFuVmFsdWUoKTsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRoaXMgZmllbGQgaXMgdGhlIG5vbi1v\nd25pbmcgc2lkZSBvZiBhIGJpZGlyZWN0aW9uYWwgcmVsYXRpb24KICAgICAq\nIHdpdGggYSBqb2luIHRhYmxlLiBFdmFsdWF0ZWQgb25seSBvbmNlIGFuZCB0\naGUgcmVzdWx0IGNhY2hlZCBmb3IgCiAgICAgKiBzdWJzZXF1ZW50IGNhbGwu\nIEhlbmNlIG11c3QgYmUgY2FsbGVkIGFmdGVyIHJlc29sdXRpb24uCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQmlkaXJlY3Rpb25hbEpvaW5UYWJs\nZU1hcHBpbmdOb25Pd25lcigpIHsKICAgIAlpZiAoX2JpZGlyZWN0aW9uYWxK\nb2luVGFibGVOb25Pd25lciAhPSBudWxsKQogICAgCQlyZXR1cm4gX2JpZGly\nZWN0aW9uYWxKb2luVGFibGVOb25Pd25lci5ib29sZWFuVmFsdWUoKTsKICAg\nIAkKICAgIAlfYmlkaXJlY3Rpb25hbEpvaW5UYWJsZU5vbk93bmVyID0gZmFs\nc2U7CiAgICAgICAgRm9yZWlnbktleSBmayA9IGdldEZvcmVpZ25LZXkoKTsK\nICAgICAgICBpZiAoZmsgPT0gbnVsbCkgCiAgICAgICAgCXJldHVybiBmYWxz\nZTsKICAgICAgICBGb3JlaWduS2V5IGpmayA9IGdldEpvaW5Gb3JlaWduS2V5\nKCk7CiAgICAgICAgaWYgKGpmayA9PSBudWxsKSAKICAgICAgICAJcmV0dXJu\nIGZhbHNlOwogICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWRCeSA9IGdldFZh\nbHVlTWFwcGVkQnlNYXBwaW5nKCk7CiAgICAgICAgaWYgKG1hcHBlZEJ5ICE9\nIG51bGwpIAogICAgICAgIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgVmFsdWVN\nYXBwaW5nIGVsZW0gPSBnZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGlm\nIChlbGVtID09IG51bGwpIAogICAgICAgIAlyZXR1cm4gZmFsc2U7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHJlbFR5cGUgPSBnZXREZWNsYXJlZFR5cGVNYXBw\naW5nKCk7CiAgICAgICAgaWYgKHJlbFR5cGUgPT0gbnVsbCkgCiAgICAgICAg\nCXJldHVybiBmYWxzZTsKICAgICAgICBGaWVsZE1hcHBpbmdbXSByZWxGbWRz\nID0gcmVsVHlwZS5nZXRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgZm9yIChp\nbnQgaT0wOyBpPHJlbEZtZHMubGVuZ3RoO2krKykgewogICAgICAgICAgICBG\naWVsZE1hcHBpbmcgcmZtID0gcmVsRm1kc1tpXTsKICAgICAgICAgICAgVmFs\ndWVNYXBwaW5nIHJlbGVtID0gcmZtLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAg\nICAgICAgICAgIGlmIChyZWxlbSAhPSBudWxsICYmIHJlbGVtLmdldERlY2xh\ncmVkVHlwZU1hcHBpbmcoKSA9PQogICAgICAgICAgICAgICAgICAgIGdldERl\nY2xhcmluZ01hcHBpbmcoKSkgewogICAgICAgIAkJRm9yZWlnbktleSByamZr\nID0gcmZtLmdldEpvaW5Gb3JlaWduS2V5KCk7CiAgICAgICAgCQlpZiAocmpm\nayA9PSBudWxsKSAKICAgICAgICAJCSAgICBjb250aW51ZTsKICAgICAgICAJ\nCWlmIChyamZrLmdldFRhYmxlKCkgPT0gamZrLmdldFRhYmxlKCkgJiYgCiAg\nICAgICAgCQkgICAgICAgIGpmay5nZXRUYWJsZSgpLmdldENvbHVtbnMoKS5s\nZW5ndGggPT0KICAgICAgICAgICAgICAgICAgICAgICAgamZrLmdldENvbHVt\nbnMoKS5sZW5ndGggKyByamZrLmdldENvbHVtbnMoKS5sZW5ndGgpIHsKICAg\nICAgICAJCQlfYmlkaXJlY3Rpb25hbEpvaW5UYWJsZU5vbk93bmVyID0gdHJ1\nZTsKICAgICAgICAJCQlicmVhazsKICAgICAgICAJCX0KICAgICAgICAJfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2JpZGlyZWN0aW9uYWxKb2luVGFi\nbGVOb25Pd25lci5ib29sZWFuVmFsdWUoKTsKICAgIH0KICAgIAogICAgcHVi\nbGljIGJvb2xlYW4gaXNCaU1UbzFKVCgpIHsKICAgICAgICBpZiAoX2JpX01U\nbzFfSlQgPT0gbnVsbCkgewogICAgICAgICAgICBfYmlfTVRvMV9KVCA9IGdl\ndE1hcHBpbmdSZXBvc2l0b3J5KCkuaXNCaU1UbzFKVCh0aGlzKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9iaV9NVG8xX0pUOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzVW5pMVRvTUZLKCkgewogICAgICAgIGlmIChfdW5p\nXzFUb01fRksgPT0gbnVsbCkKICAgICAgICAgICAgX3VuaV8xVG9NX0ZLID0g\nZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5pc1VuaTFUb01GSyh0aGlzKTsKICAg\nICAgICByZXR1cm4gX3VuaV8xVG9NX0ZLOwogICAgfQogICAgCiAgICBwdWJs\naWMgYm9vbGVhbiBpc1VuaU1UbzFKVCgpIHsKICAgICAgICBpZiAoX3VuaV9N\nVG8xX0pUID09IG51bGwpCiAgICAgICAgICAgIF91bmlfTVRvMV9KVCA9IGdl\ndE1hcHBpbmdSZXBvc2l0b3J5KCkuaXNVbmlNVG8xSlQodGhpcyk7CiAgICAg\nICAgcmV0dXJuIF91bmlfTVRvMV9KVDsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1VuaTFUbzFKVCgpIHsKICAgICAgICBpZiAoX3VuaV8xVG8xX0pU\nID09IG51bGwpCiAgICAgICAgICAgIF91bmlfMVRvMV9KVCA9IGdldE1hcHBp\nbmdSZXBvc2l0b3J5KCkuaXNVbmkxVG8xSlQodGhpcyk7CiAgICAgICAgcmV0\ndXJuIF91bmlfMVRvMV9KVDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0JpMVRvMUpUKCkgewogICAgICAgIGlmIChfYmlfMVRvMV9KVCA9PSBudWxs\nKQogICAgICAgICAgICBfYmlfMVRvMV9KVCA9IGdldE1hcHBpbmdSZXBvc2l0\nb3J5KCkuaXNCaTFUbzFKVCh0aGlzKTsKICAgICAgICByZXR1cm4gX2JpXzFU\nbzFfSlQ7CiAgICB9CiAgICAKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0\nQmlfMVRvTV9KVEZpZWxkKCkgewogICAgICAgIGlmIChfYmlfMVRvTV9KVF9G\naWVsZCA9PSBudWxsKSB7CiAgICAgICAgICAgIF9iaV8xVG9NX0pUX0ZpZWxk\nID0gZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRCaV8xVG9NX0pvaW5UYWJs\nZUZpZWxkKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2JpXzFU\nb01fSlRfRmllbGQ7CiAgICB9CiAgICAKICAgIHB1YmxpYyBGaWVsZE1hcHBp\nbmcgZ2V0QmlfTVRvMV9KVEZpZWxkKCkgewogICAgICAgIGlmIChfYmlfTVRv\nMV9KVF9GaWVsZCA9PSBudWxsKSB7CiAgICAgICAgICAgIF9iaV9NVG8xX0pU\nX0ZpZWxkID0gZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRCaV9NVG8xX0pv\naW5UYWJsZUZpZWxkKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2JpX01UbzFfSlRfRmllbGQ7CiAgICB9CgogICAgcHVibGljIEZvcmVpZ25L\nZXkgZ2V0QmkxVG9NSm9pbkZLKCkgewogICAgICAgIGlmIChfYmlfMVRvTV9K\nb2luX0ZLID09IG51bGwpIHsKICAgICAgICAgICAgZ2V0QmlfMVRvTV9KVEZp\nZWxkKCk7CiAgICAgICAgICAgIGlmIChfYmlfMVRvTV9KVF9GaWVsZCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX2JpXzFUb01fSm9pbl9GSyA9IF9iaV8x\nVG9NX0pUX0ZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfYmlfMVRvTV9Kb2luX0ZLOwogICAgfQogICAgCiAg\nICBwdWJsaWMgRm9yZWlnbktleSBnZXRCaTFUb01FbGVtRksoKSB7CiAgICAg\nICAgaWYgKF9iaV8xVG9NX0VsZW1fRksgPT0gbnVsbCkgewogICAgICAgICAg\nICBnZXRCaV8xVG9NX0pURmllbGQoKTsKICAgICAgICAgICAgaWYgKF9iaV8x\nVG9NX0pUX0ZpZWxkICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYmlfMVRv\nTV9FbGVtX0ZLID0gX2JpXzFUb01fSlRfRmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKS5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfYmlfMVRvTV9FbGVtX0ZLOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9p\nZCBzZXRCaTFNSm9pblRhYmxlSW5mbygpIHsKICAgICAgICBpZiAoZ2V0QXNz\nb2NpYXRpb25UeXBlKCkgPT0gRmllbGRNZXRhRGF0YS5PTkVfVE9fTUFOWSkg\newogICAgICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkID0gZ2V0QmlfTVRv\nMV9KVEZpZWxkKCk7CiAgICAgICAgICAgIGlmIChtYXBwZWQgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5nSW5mbyBpbmZvID0gZ2V0\nTWFwcGluZ0luZm8oKTsKICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZ0lu\nZm8gbWFwcGVkSW5mbyA9IG1hcHBlZC5nZXRNYXBwaW5nSW5mbygpOwogICAg\nICAgICAgICAgICAgaW5mby5zZXRUYWJsZUlkZW50aWZpZXIobWFwcGVkSW5m\nby5nZXRUYWJsZUlkZW50aWZpZXIoKSk7CiAgICAgICAgICAgICAgICBpbmZv\nLnNldENvbHVtbnMobWFwcGVkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFs\ndWVJbmZvKCkuZ2V0Q29sdW1ucygpKTsKICAgICAgICAgICAgICAgIGdldEVs\nZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuc2V0Q29sdW1ucygKICAg\nICAgICAgICAgICAgICAgICBtYXBwZWRJbmZvLmdldENvbHVtbnMoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgIAogICAgcHVibGljIGJv\nb2xlYW4gaXNOb25EZWZhdWx0TWFwcGluZ1VzaW5nSm9pblRhYmxlU3RyYXRl\nZ3koKSB7CiAgICAgICAgcmV0dXJuIGlzQmkxVG8xSlQoKSB8fCBpc1VuaTFU\nbzFKVCgpIHx8IGlzVW5pTVRvMUpUKCkgfHwgaXNCaU1UbzFKVCgpOwogICAg\nfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBzSWRDb2xzKGJvb2xlYW4g\naGFzTWFwc0lkQ29scykgewogICAgICAgIF9oYXNNYXBzSWRDb2xzID0gaGFz\nTWFwc0lkQ29sczsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gaGFz\nTWFwc0lkQ29scygpIHsKICAgICAgICByZXR1cm4gX2hhc01hcHNJZENvbHM7\nCiAgICB9Cn0K\n","encoding":"base64"}

