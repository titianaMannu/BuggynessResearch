{"sha":"6cd0963881ee4e927c960d75420ec9d50b94f0c6","node_id":"MDQ6QmxvYjIwNjM2NDo2Y2QwOTYzODgxZWU0ZTkyN2M5NjBkNzU0MjBlYzlkNTBiOTRmMGM2","size":72632,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6cd0963881ee4e927c960d75420ec9d50b94f0c6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5O\nb3JtYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRl\nbnRpZmllci5EQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5pZGVudGlmaWVyLlF1YWxpZmllZERCSWRlbnRpZmllcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uSU87\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWln\nbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5J\nbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Q\ncmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuTWV0YURhdGFDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBzZXJw\nLnV0aWwuU3RyaW5nczsKCi8qKgogKiBCYXNlIGNsYXNzIHN0b3JpbmcgcmF3\nIG1hcHBpbmcgaW5mb3JtYXRpb247IGRlZmluZXMgdXRpbGl0eSBtZXRob2Rz\nIGZvcgogKiBjb252ZXJ0aW5nIHJhdyBtYXBwaW5nIGluZm9ybWF0aW9uIHRv\nIGZ1bGwgbWFwcGluZyB0byB0aGUgc2NoZW1hLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCnB1Ymxp\nYyBhYnN0cmFjdCBjbGFzcyBNYXBwaW5nSW5mbwogICAgaW1wbGVtZW50cyBT\nZXJpYWxpemFibGUgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEpP\nSU5fTk9ORSA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBKT0lO\nX0ZPUldBUkQgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSk9J\nTl9JTlZFUlNFID0gMjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmpl\nY3QgTlVMTCA9IG5ldyBPYmplY3QoKTsKCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAg\nICAgICAgKE1hcHBpbmdJbmZvLmNsYXNzKTsKCiAgICBwcml2YXRlIFN0cmlu\nZyBfc3RyYXRlZ3kgPSBudWxsOwogICAgcHJpdmF0ZSBMaXN0PENvbHVtbj4g\nX2NvbHMgPSBudWxsOwogICAgcHJpdmF0ZSBJbmRleCBfaWR4ID0gbnVsbDsK\nICAgIHByaXZhdGUgVW5pcXVlIF91bnEgPSBudWxsOwogICAgcHJpdmF0ZSBG\nb3JlaWduS2V5IF9mayA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Nh\nbklkeCA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NhblVucSA9IHRy\ndWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NhbkZLID0gdHJ1ZTsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaW1wbGljaXRSZWxhdGlvbiA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBpbnQgX2pvaW4gPSBKT0lOX05PTkU7CiAgICBwcml2YXRlIENv\nbHVtbklPIF9pbyA9IG51bGw7CgogICAgLyoqCiAgICAgKiBNYXBwaW5nIHN0\ncmF0ZWd5IG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3Ry\nYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVneTsKICAgIH0KCiAg\nICAvKioKICAgICAqIE1hcHBpbmcgc3RyYXRlZ3kgbmFtZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U3RyYXRlZ3koU3RyaW5nIHN0cmF0ZWd5KSB7\nCiAgICAgICAgX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSYXcgY29sdW1uIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBM\naXN0PENvbHVtbj4gZ2V0Q29sdW1ucygpIHsKICAgICAgICBpZiAoX2NvbHMg\nPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuZW1w\ndHlMaXN0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY29sczsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBjb2x1bW5zIHdob3Nl\nIHRhYmxlIG5hbWUgbWF0Y2hlcyB0aGUgZ2l2ZW4gdGFibGUgbmFtZS4gCiAg\nICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgTGlzdDxDb2x1\nbW4+IGdldENvbHVtbnMoU3RyaW5nIHRhYmxlTmFtZSkgewogICAgICAgIHJl\ndHVybiBnZXRDb2x1bW5zKERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5h\nbWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgdGhlIGNvbHVtbnMg\nd2hvc2UgdGFibGUgbmFtZSBtYXRjaGVzIHRoZSBnaXZlbiB0YWJsZSBuYW1l\nLiAKICAgICAqLwogICAgcHVibGljIExpc3Q8Q29sdW1uPiBnZXRDb2x1bW5z\nKERCSWRlbnRpZmllciB0YWJsZU5hbWUpIHsKICAgICAgICBpZiAoX2NvbHMg\nPT0gbnVsbCkgCiAgICAgICAgCXJldHVybiBDb2xsZWN0aW9ucy5lbXB0eUxp\nc3QoKTsKICAgICAgICBMaXN0PENvbHVtbj4gcmVzdWx0ID0gbmV3IEFycmF5\nTGlzdDxDb2x1bW4+KCk7CiAgICAgICAgZm9yIChDb2x1bW4gY29sIDogX2Nv\nbHMpIHsKICAgICAgICAJaWYgKERCSWRlbnRpZmllci5lcXVhbChjb2wuZ2V0\nVGFibGVJZGVudGlmaWVyKCksIAogICAgICAgIAkJCXRhYmxlTmFtZSkpIAog\nICAgICAgIAkJcmVzdWx0LmFkZChjb2wpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogUmF3IGNvbHVt\nbiBkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDb2x1bW5zKExp\nc3Q8Q29sdW1uPiBjb2xzKSB7CiAgICAgICAgX2NvbHMgPSBjb2xzOwogICAg\nfQoKICAgIC8qKgogICAgICogUmF3IGluZGV4LgogICAgICovCiAgICBwdWJs\naWMgSW5kZXggZ2V0SW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9pZHg7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSYXcgaW5kZXguCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEluZGV4KEluZGV4IGlkeCkgewogICAgICAgIF9pZHgg\nPSBpZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFy\nayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm9uLWluZGV4YWJsZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gY2FuSW5kZXgoKSB7CiAgICAgICAgcmV0\ndXJuIF9jYW5JZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBj\nYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm9uLWluZGV4YWJsZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FuSW5kZXgoYm9vbGVhbiBp\nbmRleGFibGUpIHsKICAgICAgICBfY2FuSWR4ID0gaW5kZXhhYmxlOwogICAg\nfQoKICAgIC8qKiAKICAgICAqICBBZmZpcm1zIGlmIHRoaXMgaW5zdGFuY2Ug\ncmVwcmVzZW50cyBhbiBpbXBsaWNpdCByZWxhdGlvbi4gRm9yIGV4YW1wbGUs\nIGEKICAgICAqICByZWxhdGlvbiBleHByZXNzZWQgYXMgdGhlIHZhbHVlIG9m\nIHByaW1hcnkga2V5IG9mIHRoZSByZWxhdGVkIGNsYXNzIGFuZAoJICogIG5v\ndCBhcyBvYmplY3QgcmVmZXJlbmNlLgogICAgICoKICAgICAqIEBzaW5jZSAx\nLjMuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ltcGxpY2l0UmVs\nYXRpb24oKSB7CiAgICAJcmV0dXJuIF9pbXBsaWNpdFJlbGF0aW9uOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFNldHMgYSBtYXJrZXIgdG8gaW1wbHkg\nYSBsb2dpY2FsIHJlbGF0aW9uIHRoYXQgY2FuIG5vdCBoYXZlIGFueSBwaHlz\naWNhbAogICAgICogbWFuaWZlc3QgaW4gdGhlIGRhdGFiYXNlLiBGb3IgZXhh\nbXBsZSwgYSByZWxhdGlvbiBleHByZXNzZWQgYXMgdGhlIHZhbHVlCiAgICAg\nKiBvZiBwcmltYXJ5IGtleSBvZiB0aGUgcmVsYXRlZCBjbGFzcyBhbmQgbm90\nIGFzIG9iamVjdCByZWZlcmVuY2UuCiAgICAgKiBQb3B1bGF0ZWQgZnJvbSBA\nRm9yZWlnbktleShpbXBsaWNpdD10cnVlKSBhbm5vdGF0aW9uLgogICAgICog\nVGhlIG11dGF0b3IgY2FuIG9ubHkgdHJhbnNpdCBmcm9tIGZhbHNlIHRvIHRy\ndWUgYnV0IG5vdCB2aWNlIHZlcnNhLgogICAgICogCiAgICAgKiBAc2luY2Ug\nMS4zLjAKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW1wbGljaXRSZWxh\ndGlvbihib29sZWFuIGZsYWcpIHsKICAgIAlfaW1wbGljaXRSZWxhdGlvbiB8\nPSBmbGFnOwogICAgfQoKICAgIC8qKgogICAgICogUmF3IGZvcmVpZ24ga2V5\nIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleSBn\nZXRGb3JlaWduS2V5KCkgewogICAgICAgIHJldHVybiBfZms7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSYXcgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24uCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoRm9yZWlnbktl\neSBmaykgewogICAgICAgIF9mayA9IGZrOwogICAgICAgIGlmIChmayAhPSBu\ndWxsICYmIF9qb2luID09IEpPSU5fTk9ORSkKICAgICAgICAgICAgX2pvaW4g\nPSBKT0lOX0ZPUldBUkQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNl\nciBjYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm90IGhhdmluZyBh\nIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5G\nb3JlaWduS2V5KCkgewogICAgICAgIHJldHVybiBfY2FuRks7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFyayBjb2x1bW5zIGFzIGV4\ncGxpY2l0bHkgbm90IGhhdmluZyBhIGZvcmVpZ24ga2V5LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRDYW5Gb3JlaWduS2V5KGJvb2xlYW4gZmthYmxl\nKSB7CiAgICAgICAgX2NhbkZLID0gZmthYmxlOwogICAgfQoKICAgIC8qKgog\nICAgICogUmF3IHVuaXF1ZSBjb25zdHJhaW50IGluZm9ybWF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgVW5pcXVlIGdldFVuaXF1ZSgpIHsKICAgICAgICBy\nZXR1cm4gX3VucTsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyB1bmlxdWUg\nY29uc3RyYWludCBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0VW5pcXVlKFVuaXF1ZSB1bnEpIHsKICAgICAgICBfdW5xID0gdW5x\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHVzZXIgY2FuIG1hcmsgY29s\ndW1ucyBhcyBleHBsaWNpdGx5IG5vdCBoYXZpbmcgYSB1bmlxdWUgY29uc3Ry\nYWludC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gY2FuVW5pcXVlKCkg\newogICAgICAgIHJldHVybiBfY2FuVW5xOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHVzZXIgY2FuIG1hcmsgY29sdW1ucyBhcyBleHBsaWNpdGx5IG5v\ndCBoYXZpbmcgYSB1bmlxdWUgY29uc3RyYWludC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0Q2FuVW5pcXVlKGJvb2xlYW4gdW5pcXVhYmxlKSB7CiAg\nICAgICAgX2NhblVucSA9IHVuaXF1YWJsZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEkvTyBmb3IgdGhlIGNvbHVtbnMgY3JlYXRlZCBieSB0aGUgbGFzdCBj\nYWxsIHRvIHtAbGluayAjY3JlYXRlQ29sdW1uc30sCiAgICAgKiBvciBmb3Ig\ndGhlIGZvcmVpZ24ga2V5IGNyZWF0ZWQgYnkgdGhlIGxhc3QgY2FsbCB0bwog\nICAgICoge0BsaW5rICNjcmVhdGVGb3JlaWduS2V5fS4gVGhpcyBpcyBhbHNv\nIGV4cGVjdGVkIHRvIGJlIHNldCBjb3JyZWN0bHkKICAgICAqIHByaW9yIHRv\nIGNhbGxzIHRvIHtAbGluayAjc3luY0NvbHVtbnN9IGFuZCB7QGxpbmsgI3N5\nbmNGb3JlaWduS2V5fS4KICAgICAqLwogICAgcHVibGljIENvbHVtbklPIGdl\ndENvbHVtbklPKCkgewogICAgICAgIHJldHVybiBfaW87CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJL08gZm9yIHRoZSBjb2x1bW5zIGNyZWF0ZWQgYnkgdGhl\nIGxhc3QgY2FsbCB0byB7QGxpbmsgI2NyZWF0ZUNvbHVtbnN9LAogICAgICog\nb3IgZm9yIHRoZSBmb3JlaWduIGtleSBjcmVhdGVkIGJ5IHRoZSBsYXN0IGNh\nbGwgdG8KICAgICAqIHtAbGluayAjY3JlYXRlRm9yZWlnbktleX0uIFRoaXMg\naXMgYWxzbyBleHBlY3RlZCB0byBiZSBzZXQgY29ycmVjdGx5CiAgICAgKiBw\ncmlvciB0byBjYWxscyB0byB7QGxpbmsgI3N5bmNDb2x1bW5zfSBhbmQge0Bs\naW5rICNzeW5jRm9yZWlnbktleX0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldENvbHVtbklPKENvbHVtbklPIGlvKSB7CiAgICAgICAgX2lvID0gaW87\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEaXJlY3Rpb24gb2YgdGhlIGpvaW4g\ndGhhdCB0aGUgY29sdW1ucyBvZiB0aGlzIG1hcHBpbmcgaW5mbyBmb3JtLiBU\naGlzCiAgICAgKiBpcyB1c3VhbGx5IGF1dG9tYXRpY2FsbHkgc2V0IGJ5IHtA\nbGluayAjY3JlYXRlRm9yZWlnbktleX0uIFRoaXMgZmxhZwogICAgICogaXMg\nYWxzbyBleHBlY3RlZCB0byBiZSBzZXQgY29ycmVjdGx5IHByaW9yIHRvIGNh\nbGxzIHRvCiAgICAgKiB7QGxpbmsgI3N5bmNGb3JlaWduS2V5fSBpZiB0aGUg\nam9pbiBpcyBpbnZlcnNlZC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRK\nb2luRGlyZWN0aW9uKCkgewogICAgICAgIHJldHVybiBfam9pbjsKICAgIH0K\nCiAgICAvKioKICAgICAqIERpcmVjdGlvbiBvZiB0aGUgam9pbiB0aGF0IHRo\nZSBjb2x1bW5zIG9mIHRoaXMgbWFwcGluZyBpbmZvIGZvcm0uIFRoaXMKICAg\nICAqIGlzIHVzdWFsbHkgYXV0b21hdGljYWxseSBzZXQgYnkge0BsaW5rICNj\ncmVhdGVGb3JlaWduS2V5fS4gVGhpcyBmbGFnCiAgICAgKiBpcyBhbHNvIGV4\ncGVjdGVkIHRvIGJlIHNldCBjb3JyZWN0bHkgcHJpb3IgdG8gY2FsbHMgdG8K\nICAgICAqIHtAbGluayAjc3luY0ZvcmVpZ25LZXl9IGlmIHRoZSBqb2luIGlz\nIGludmVyc2VkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luRGly\nZWN0aW9uKGludCBqb2luKSB7CiAgICAgICAgX2pvaW4gPSBqb2luOwogICAg\nfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIG1hcHBpbmcgaW5mb3JtYXRp\nb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAg\nIGNsZWFyKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgbWFw\ncGluZyBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gY2FuRmxh\nZ3Mgd2hldGhlciB0byBjbGVhciBpbmZvcm1hdGlvbiBhYm91dCB3aGV0aGVy\nIHdlCiAgICAgKiBjYW4gcGxhY2UgaW5kZXhlZCwgZm9yZWlnbiBrZXlzLCBl\ndGMgb24gdGhpcyBtYXBwaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIGNsZWFyKGJvb2xlYW4gY2FuRmxhZ3MpIHsKICAgICAgICBfc3RyYXRlZ3kg\nPSBudWxsOwogICAgICAgIF9jb2xzID0gbnVsbDsKICAgICAgICBfaW8gPSBu\ndWxsOwogICAgICAgIF9pZHggPSBudWxsOwogICAgICAgIF91bnEgPSBudWxs\nOwogICAgICAgIF9mayA9IG51bGw7CiAgICAgICAgX2pvaW4gPSBKT0lOX05P\nTkU7CiAgICAgICAgaWYgKGNhbkZsYWdzKSB7CiAgICAgICAgICAgIF9jYW5J\nZHggPSB0cnVlOwogICAgICAgICAgICBfY2FuRksgPSB0cnVlOwogICAgICAg\nICAgICBfY2FuVW5xID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb3B5IG1pc3NpbmcgaW5mbyBmcm9tIHRoZSBpbnN0YW5jZSB0\nbyB0aGlzIG9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgY29weShNYXBw\naW5nSW5mbyBpbmZvKSB7CiAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxs\nKQogICAgICAgICAgICBfc3RyYXRlZ3kgPSBpbmZvLmdldFN0cmF0ZWd5KCk7\nCiAgICAgICAgaWYgKF9jYW5JZHggJiYgX2lkeCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChpbmZvLmdldEluZGV4KCkgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9pZHggPSBpbmZvLmdldEluZGV4KCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIF9jYW5JZHggPSBpbmZvLmNhbkluZGV4KCk7\nCiAgICAgICAgfQogICAgICAgIGlmIChfY2FuVW5xICYmIF91bnEgPT0gbnVs\nbCkgewogICAgICAgICAgICBpZiAoaW5mby5nZXRVbmlxdWUoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgX3VucSA9IGluZm8uZ2V0VW5pcXVlKCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYW5VbnEgPSBpbmZv\nLmNhblVuaXF1ZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoX2NhbkZLICYm\nIF9mayA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbmZvLmdldEZvcmVp\nZ25LZXkoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgX2ZrID0gaW5mby5n\nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIF9jYW5GSyA9IGluZm8uY2FuRm9yZWlnbktleSgpOwogICAgICAgIH0K\nICAgICAgICBfaW1wbGljaXRSZWxhdGlvbiA9IGluZm8uaXNJbXBsaWNpdFJl\nbGF0aW9uKCk7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBnZXRDb2x1\nbW5zKCk7CiAgICAgICAgTGlzdDxDb2x1bW4+IGljb2xzID0gaW5mby5nZXRD\nb2x1bW5zKCk7CiAgICAgICAgaWYgKCFpY29scy5pc0VtcHR5KCkgJiYgKGNv\nbHMuaXNFbXB0eSgpCiAgICAgICAgICAgIHx8IGNvbHMuc2l6ZSgpID09IGlj\nb2xzLnNpemUoKSkpIHsKICAgICAgICAgICAgaWYgKGNvbHMuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1u\nPihpY29scy5zaXplKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGljb2xzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAo\nY29scy5zaXplKCkgPT0gaSkKICAgICAgICAgICAgICAgICAgICBjb2xzLmFk\nZChuZXcgQ29sdW1uKCkpOwogICAgICAgICAgICAgICAgKChDb2x1bW4pIGNv\nbHMuZ2V0KGkpKS5jb3B5KChDb2x1bW4pIGljb2xzLmdldChpKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc2V0Q29sdW1ucyhjb2xzKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlz\nIGluZm8gaGFzIGNvbHVtbnMsIGZvcmVpZ24ga2V5IGluZm9ybWF0aW9uLCBp\nbmRleAogICAgICogaW5mb3JtYXRpb24sIGV0Yy4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzU2NoZW1hQ29tcG9uZW50cygpIHsKICAgICAgICBy\nZXR1cm4gKF9jb2xzICE9IG51bGwgJiYgIV9jb2xzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgfHwgX2lkeCAhPSBudWxsCiAgICAgICAgICAgIHx8IF91bnEg\nIT0gbnVsbAogICAgICAgICAgICB8fCBfZmsgIT0gbnVsbAogICAgICAgICAg\nICB8fCAhX2NhbklkeAogICAgICAgICAgICB8fCAhX2NhbkZLCiAgICAgICAg\nICAgIHx8ICFfY2FuVW5xOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0\nIHRoYXQgdGhlIHVzZXIgZGlkIG5vdCBzdXBwbHkgYW55IGNvbHVtbnMsIGlu\nZGV4LCB1bmlxdWUKICAgICAqIGNvbnN0cmFpbnQsIG9yIGZvcmVpZ24ga2V5\nIGZvciB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE5vU2NoZW1hQ29tcG9uZW50cyhNZXRhRGF0YUNvbnRleHQgY29udGV4\ndCwgYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX2NvbHMgPT0gbnVsbCB8\nfCBfY29scy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYXNzZXJ0Tm9JbmRl\neChjb250ZXh0LCBkaWUpOwogICAgICAgICAgICBhc3NlcnROb1VuaXF1ZShj\nb250ZXh0LCBkaWUpOwogICAgICAgICAgICBhc3NlcnROb0ZvcmVpZ25LZXko\nY29udGV4dCwgZGllKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgidW5leHBlY3RlZC1j\nb2xzIiwgY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgY29u\ndGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fybihtc2cpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhpcyBpbmZvIGhhcyB0\naGUgZ2l2ZW4gc3RyYXRlZ3kgb3Igbm8gc3RyYXRlZ3kuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFzc2VydFN0cmF0ZWd5KE1ldGFEYXRhQ29udGV4dCBj\nb250ZXh0LCBPYmplY3QgY29udGV4dFN0cmF0LAogICAgICAgIE9iamVjdCBl\neHBlY3RlZCwgYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoY29udGV4dFN0\ncmF0ID09IGV4cGVjdGVkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIFN0cmluZyBzdHJhdDsKICAgICAgICBpZiAoY29udGV4dFN0cmF0ID09IG51\nbGwpIHsKICAgICAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoX3N0cmF0ZWd5\nLmVxdWFscyhleHBlY3RlZC5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChleHBlY3RlZCBp\nbnN0YW5jZW9mIFN0cmF0ZWd5CiAgICAgICAgICAgICAgICAmJiBfc3RyYXRl\nZ3kuZXF1YWxzKCgoU3RyYXRlZ3kpIGV4cGVjdGVkKS5nZXRBbGlhcygpKSkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgc3RyYXQgPSBf\nc3RyYXRlZ3k7CiAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0U3RyYXQgaW5z\ndGFuY2VvZiBTdHJhdGVneSkKICAgICAgICAgICAgc3RyYXQgPSAoKFN0cmF0\nZWd5KSBjb250ZXh0U3RyYXQpLmdldEFsaWFzKCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzdHJhdCA9IGNvbnRleHRTdHJhdC5nZXRDbGFzcygpLmdl\ndE5hbWUoKTsKCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgidW5l\neHBlY3RlZC1zdHJhdGVneSIsIGNvbnRleHQsIGV4cGVjdGVkLAogICAgICAg\nICAgICBzdHJhdCk7CiAgICAgICAgaWYgKGRpZSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fybihtc2cpOwogICAgfQoK\nICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhlIHVzZXIgZGlkIG5vdCB0\ncnkgdG8gcGxhY2UgYW4gaW5kZXggb24gdGhpcyBtYXBwaW5nLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb0luZGV4KE1ldGFEYXRhQ29udGV4\ndCBjb250ZXh0LCBib29sZWFuIGRpZSkgewogICAgICAgIGlmIChfaWR4ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBt\nc2cgPSBfbG9jLmdldCgidW5leHBlY3RlZC1pbmRleCIsIGNvbnRleHQpOwog\nICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2VydCB0aGF0IHRoZSB1c2VyIGRpZCBub3QgdHJ5IHRvIHBsYWNlIGEg\ndW5pcXVlIGNvbnN0cmFpbnQgb24gdGhpcwogICAgICogbWFwcGluZy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9VbmlxdWUoTWV0YURhdGFD\nb250ZXh0IGNvbnRleHQsIGJvb2xlYW4gZGllKSB7CiAgICAgICAgaWYgKF91\nbnEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBNZXNz\nYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLXVuaXF1ZSIsIGNvbnRl\neHQpOwogICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVw\nb3NpdG9yeSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFzc2VydCB0aGF0IHRoZSB1c2VyIGRpZCBub3QgdHJ5IHRvIHBs\nYWNlIGEgZm9yZWlnbiBrZXkgb24gdGhpcyBtYXBwaW5nCiAgICAgKiBvciBw\nbGFjZWQgYW4gaW1wbGljaXQgZm9yZWlnbiBrZXkuIAogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBhc3NlcnROb0ZvcmVpZ25LZXkoTWV0YURhdGFDb250ZXh0\nIGNvbnRleHQsIGJvb2xlYW4gZGllKSB7CiAgICAgICAgaWYgKF9mayA9PSBu\ndWxsIHx8IGlzSW1wbGljaXRSZWxhdGlvbigpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0\nZWQtZmsiLCBjb250ZXh0KTsKICAgICAgICBpZiAoZGllKQogICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24obXNnKTsKICAgICAgICBj\nb250ZXh0LmdldFJlcG9zaXRvcnkoKS5nZXRMb2coKS53YXJuKG1zZyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgdXNlciBkaWQg\nbm90IHRyeSB0byBqb2luLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3Nl\ncnROb0pvaW4oTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIGJvb2xlYW4gZGll\nKSB7CiAgICAgICAgYm9vbGVhbiBqb2luID0gZmFsc2U7CiAgICAgICAgaWYg\nKF9jb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1uIGNvbDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7ICFqb2luICYmIGkgPCBfY29scy5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgY29sID0gKENvbHVtbikg\nX2NvbHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgaWYgKCFEQklkZW50aWZp\nZXIuaXNOdWxsKGNvbC5nZXRUYXJnZXRJZGVudGlmaWVyKCkpKQogICAgICAg\nICAgICAgICAgICAgIGpvaW4gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGlmICgham9pbikKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLWpv\naW4iLCBjb250ZXh0KTsKICAgICAgICBpZiAoZGllKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24obXNnKTsKICAgICAgICBjb250\nZXh0LmdldFJlcG9zaXRvcnkoKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaW5kIG9yIGdlbmVyYXRlIGEgdGFibGUgZm9y\nIGEgbWFwcGluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0aGUg\nbWFwcGluZyB0aGF0IHVzZXMgdGhlIHRhYmxlCiAgICAgKiBAcGFyYW0gZGVm\nIGRlZmF1bHQgdGFibGUgbmFtZSBwcm92aWRlcgogICAgICogQHBhcmFtIHNj\naGVtYU5hbWUgZGVmYXVsdCBzY2hlbWEgaWYga25vd24sIG9yIG51bGwKICAg\nICAqIEBwYXJhbSBnaXZlbiBnaXZlbiB0YWJsZSBuYW1lCiAgICAgKiBAcGFy\nYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4gYWx0ZXIgdGhlIHNjaGVtYSBvciBt\nYXBwaW5ncwogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGlj\nIFRhYmxlIGNyZWF0ZVRhYmxlKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBU\nYWJsZURlZmF1bHRzIGRlZiwKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwg\nU3RyaW5nIGdpdmVuLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgcmV0dXJu\nIGNyZWF0ZVRhYmxlKGNvbnRleHQsIGRlZiwgREJJZGVudGlmaWVyLm5ld1Nj\naGVtYShzY2hlbWFOYW1lKSwgCiAgICAgICAgICAgIERCSWRlbnRpZmllci5u\nZXdUYWJsZShnaXZlbiksIGFkYXB0KTsKICAgIH0KCiAgICBwdWJsaWMgVGFi\nbGUgY3JlYXRlVGFibGUoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFRhYmxl\nRGVmYXVsdHMgZGVmLAogICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFOYW1l\nLCBEQklkZW50aWZpZXIgZ2l2ZW4sIGJvb2xlYW4gYWRhcHQpIHsKICAgICAg\nICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9y\neSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgaWYgKERCSWRl\nbnRpZmllci5pc051bGwoZ2l2ZW4pICYmIChkZWYgPT0gbnVsbCB8fCAoIWFk\nYXB0CiAgICAgICAgICAgICYmICFyZXBvcy5nZXRNYXBwaW5nRGVmYXVsdHMo\nKS5kZWZhdWx0TWlzc2luZ0luZm8oKSkpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXRhYmxlIiwgY29u\ndGV4dCkpOwoKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzTnVsbChzY2hl\nbWFOYW1lKSkKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IFNjaGVtYXMuZ2V0\nTmV3VGFibGVTY2hlbWFJZGVudGlmaWVyKChKREJDQ29uZmlndXJhdGlvbikK\nICAgICAgICAgICAgICAgIHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKSk7Cgog\nICAgICAgIC8vIGlmIG5vIGdpdmVuIGFuZCBhZGFwdGluZyBvciBkZWZhdWx0\naW5nIG1pc3NpbmcgaW5mbywgdXNlIHRlbXBsYXRlCiAgICAgICAgU2NoZW1h\nR3JvdXAgZ3JvdXAgPSByZXBvcy5nZXRTY2hlbWFHcm91cCgpOwogICAgICAg\nIFNjaGVtYSBzY2hlbWEgPSBudWxsOwogICAgICAgIGlmIChEQklkZW50aWZp\nZXIuaXNOdWxsKGdpdmVuKSkgewogICAgICAgICAgICBzY2hlbWEgPSBncm91\ncC5nZXRTY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGlmIChzY2hl\nbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmFk\nZFNjaGVtYShzY2hlbWFOYW1lKTsKICAgICAgICAgICAgZ2l2ZW4gPSBkZWYu\nZ2V0SWRlbnRpZmllcihzY2hlbWEpOwogICAgICAgIH0KCiAgICAgICAgUXVh\nbGlmaWVkREJJZGVudGlmaWVyIHBhdGggPSBRdWFsaWZpZWREQklkZW50aWZp\nZXIuZ2V0UGF0aChnaXZlbik7CiAgICAgICAgaWYgKERCSWRlbnRpZmllci5p\nc051bGwocGF0aC5nZXRTY2hlbWFOYW1lKCkpKSB7CiAgICAgICAgICAgIGlm\nICghREJJZGVudGlmaWVyLmlzTnVsbChzY2hlbWFOYW1lKSkgewogICAgICAg\nICAgICAgICAgcGF0aC5zZXRTY2hlbWFOYW1lKHNjaGVtYU5hbWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2NoZW1h\nTmFtZSA9IHBhdGguZ2V0U2NoZW1hTmFtZSgpOwogICAgICAgICAgICBzY2hl\nbWEgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gbG9vayBmb3IgbmFt\nZWQgdGFibGUgdXNpbmcgZnVsbCBuYW1lIGFuZCBmaW5kVGFibGUsIHdoaWNo\nIGFsbG93cwogICAgICAgIC8vIHRoZSBkeW5hbWljIHNjaGVtYSBmYWN0b3J5\nIHRvIGNyZWF0ZSB0aGUgdGFibGUgaWYgbmVlZGVkCiAgICAgICAgVGFibGUg\ndGFibGUgPSBncm91cC5maW5kVGFibGUocGF0aCk7CiAgICAgICAgaWYgKHRh\nYmxlICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0YWJsZTsKICAgICAg\nICBpZiAoIWFkYXB0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC10YWJsZSIsIGdpdmVuLCBjb250ZXh0\nKSk7CgogICAgICAgIC8vIG5hbWVkIHRhYmxlIGRvZXNuJ3QgZXhpc3Q7IGNy\nZWF0ZSBpdAogICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkgewogICAgICAg\nICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEoc2NoZW1hTmFtZSk7CiAg\nICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHNjaGVtYSA9IGdyb3VwLmFkZFNjaGVtYShzY2hlbWFOYW1lKTsKICAgICAg\nICB9CiAgICAgICAgdGFibGUgPSBzY2hlbWEuZ2V0VGFibGUoZ2l2ZW4pOwog\nICAgICAgIGlmICh0YWJsZSA9PSBudWxsKQogICAgICAgICAgICB0YWJsZSA9\nIHNjaGVtYS5hZGRUYWJsZShnaXZlbik7CiAgICAgICAgcmV0dXJuIHRhYmxl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0cmlldmUvY3JlYXRlIGNvbHVt\nbnMgb24gdGhlIGdpdmVuIHRhYmxlIGJ5IG1lcmdpbmcgdGhlIGdpdmVuCiAg\nICAgKiB0ZW1wbGF0ZSBpbmZvcm1hdGlvbiB3aXRoIGFueSB1c2VyLXByb3Zp\nZGVkIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0\nIHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZpbmcgY29sdW1ucyBmb3IKICAg\nICAqIEBwYXJhbSBwcmVmaXggbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5\nIHByZWZpeAogICAgICogQHBhcmFtIHRtcGxhdGVzIHRlbXBsYXRlIGNvbHVt\nbnMKICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUgZm9yIHRoZSBjb2x1\nbW5zCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5\nIHRoZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVtYQogICAgICovCiAgICBw\ncm90ZWN0ZWQgQ29sdW1uW10gY3JlYXRlQ29sdW1ucyhNZXRhRGF0YUNvbnRl\neHQgY29udGV4dCwgU3RyaW5nIHByZWZpeCwKICAgICAgICBDb2x1bW5bXSB0\nbXBsYXRlcywgVGFibGUgdGFibGUsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAg\nICBhc3NlcnRUYWJsZShjb250ZXh0LCB0YWJsZSk7CiAgICAgICAgaWYgKHBy\nZWZpeCA9PSBudWxsKQogICAgICAgICAgICBwcmVmaXggPSAiZ2VuZXJpYyI7\nCgogICAgICAgIC8vIHRoZSB1c2VyIGhhcyB0byBnaXZlIHRoZSByaWdodCBu\ndW1iZXIgb2YgZXhwZWN0ZWQgY29sdW1ucyBmb3IgdGhpcwogICAgICAgIC8v\nIG1hcHBpbmcsIG9yIG5vbmUgYXQgYWxsIGlmIHdlJ3JlIGFkYXB0aW5nLiAg\nY2FuJ3QganVzdCBnaXZlbiBvbmUgb2YKICAgICAgICAvLyBuIGNvbHVtbnMg\nYmVjYXVzZSB3ZSBkb24ndCBrbm93IHdoaWNoIG9mIHRoZSBuIGNvbHVtbnMg\ndGhlIGluZm8KICAgICAgICAvLyBhcHBsaWVzIHRvCiAgICAgICAgTGlzdDxD\nb2x1bW4+IGdpdmVuID0gZ2V0Q29sdW1ucygpOwogICAgICAgIAogICAgICAg\nIGlmIChjb250ZXh0IGluc3RhbmNlb2YgRmllbGRNYXBwaW5nICYmICgoRmll\nbGRNYXBwaW5nKWNvbnRleHQpLmhhc01hcHNJZENvbHMoKSkKICAgICAgICAg\nICAgZ2l2ZW4gPSAoKEZpZWxkTWFwcGluZyljb250ZXh0KS5nZXRWYWx1ZUlu\nZm8oKS5nZXRNYXBzSWRDb2x1bW5zKCk7CiAgICAgICAgCiAgICAgICAgYm9v\nbGVhbiBmaWxsID0gKChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRS\nZXBvc2l0b3J5KCkpLgogICAgICAgICAgICBnZXRNYXBwaW5nRGVmYXVsdHMo\nKS5kZWZhdWx0TWlzc2luZ0luZm8oKTsKICAgICAgICBpZiAoKCFnaXZlbi5p\nc0VtcHR5KCkgfHwgKCFhZGFwdCAmJiAhZmlsbCkpCiAgICAgICAgICAgICYm\nIGdpdmVuLnNpemUoKSAhPSB0bXBsYXRlcy5sZW5ndGgpIHsKICAgICAgICAJ\nLy8gYWxzbyBjb25zaWRlciB3aGVuIHRoaXMgaW5mbyBoYXMgY29sdW1ucyBm\ncm9tIG11bHRpcGxlIHRhYmxlcwogICAgICAgIAlnaXZlbiA9IGdldENvbHVt\nbnModGFibGUuZ2V0SWRlbnRpZmllcigpKTsKICAgICAgICAJaWYgKCghYWRh\ncHQgJiYgIWZpbGwpICYmIGdpdmVuLnNpemUoKSAhPSB0bXBsYXRlcy5sZW5n\ndGgpIHsKICAgICAgICAJCS8vIHRyeSBkZWZhdWx0IHRhYmxlCiAgICAgICAg\nCQlnaXZlbiA9IGdldENvbHVtbnMoIiIpOwogICAgICAgICAgICAgICAgaWYg\nKCghYWRhcHQgJiYgIWZpbGwpICYmIGdpdmVuLnNpemUoKSAhPSB0bXBsYXRl\ncy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1udW0tY29scyIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LCBTdHJpbmcu\ndmFsdWVPZih0bXBsYXRlcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgU3RyaW5nLnZhbHVlT2YoZ2l2ZW4uc2l6ZSgpKSkpOwogICAg\nICAgICAgICAJfQogICAgICAgIAl9CiAgICAgICAgfQoKICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gbmV3IENvbHVtblt0bXBsYXRlcy5sZW5ndGhdOwogICAg\nICAgIF9pbyA9IG51bGw7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGNvbCA9IChnaXZlbi5pc0VtcHR5KCkpID8gbnVsbCA6IChD\nb2x1bW4pIGdpdmVuLmdldChpKTsKICAgICAgICAgICAgY29sc1tpXSA9IG1l\ncmdlQ29sdW1uKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZXNbaV0sIHRydWUs\nIGNvbCwKICAgICAgICAgICAgICAgIHRhYmxlLCBhZGFwdCwgZmlsbCk7CiAg\nICAgICAgICAgIHNldElPRnJvbUNvbHVtbkZsYWdzKGNvbCwgaSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBjb2xzOwogICAgfQogICAgCiAgICBib29s\nZWFuIGNhbk1lcmdlKExpc3Q8Q29sdW1uPiBnaXZlbiwgQ29sdW1uW10gdGVt\ncGxhdGVzLCBib29sZWFuIGFkYXB0LAogICAgICAgICAgICBib29sZWFuIGZp\nbGwpIHsKICAgIAlyZXR1cm4gISgoIWdpdmVuLmlzRW1wdHkoKSB8fCAoIWFk\nYXB0ICYmICFmaWxsKSkgCiAgICAJCQkmJiBnaXZlbi5zaXplKCkgIT0gdGVt\ncGxhdGVzLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIHByb3BlciBpbnRlcm5hbCBjb2x1bW4gSS9PIG1ldGFkYXRhIGZvciB0aGUg\nZ2l2ZW4gY29sdW1uJ3MgZmxhZ3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBzZXRJT0Zyb21Db2x1bW5GbGFncyhDb2x1bW4gY29sLCBpbnQgaSkgewog\nICAgICAgIGlmIChjb2wgPT0gbnVsbCB8fCAoIWNvbC5nZXRGbGFnKENvbHVt\nbi5GTEFHX1VOSU5TRVJUQUJMRSkKICAgICAgICAgICAgJiYgIWNvbC5nZXRG\nbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFKQogICAgICAgICAgICAmJiAh\nY29sLmlzTm90TnVsbCgpKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpZiAoX2lvID09IG51bGwpCiAgICAgICAgICAgIF9pbyA9IG5ldyBDb2x1\nbW5JTygpOwogICAgICAgIF9pby5zZXRJbnNlcnRhYmxlKGksICFjb2wuZ2V0\nRmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUpKTsKICAgICAgICBfaW8u\nc2V0VXBkYXRhYmxlKGksICFjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQ\nREFUQUJMRSkpOwogICAgICAgIF9pby5zZXROdWxsSW5zZXJ0YWJsZShpLCAh\nY29sLmlzTm90TnVsbCgpKTsKICAgICAgICBfaW8uc2V0TnVsbFVwZGF0YWJs\nZShpLCAhY29sLmlzTm90TnVsbCgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2VydCB0aGF0IHRoZSBnaXZlbiB0YWJsZSBpcyBub24tbnVsbC4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBhc3NlcnRUYWJsZShNZXRh\nRGF0YUNvbnRleHQgY29udGV4dCwgVGFibGUgdGFibGUpIHsKICAgICAgICBp\nZiAodGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bm1hcHBlZCIsIGNvbnRleHQpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1lcmdlIHRoZSBnaXZlbiBjb2x1bW5z\nIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRo\nZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZpbmcgY29sdW1ucyBmb3IKICAgICAq\nIEBwYXJhbSBwcmVmaXggbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHBy\nZWZpeAogICAgICogQHBhcmFtIHRtcGxhdGUgdGVtcGxhdGUgZm9yIGV4cGVj\ndGVkIGNvbHVtbiBpbmZvcm1hdGlvbgogICAgICogQHBhcmFtIGNvbXBhdCB3\naGV0aGVyIHRoZSBleGlzdGluZyBjb2x1bW4gdHlwZSBtdXN0IGJlIGNvbXBh\ndGlibGUKICAgICAqIHdpdGggdGhlIHR5cGUgb2YgdGhlIHRlbXBsYXRlIGNv\nbHVtbgogICAgICogQHBhcmFtIGdpdmVuIHRoZSBnaXZlbiBjb2x1bW4gaW5m\nb3JtYXRpb24gZnJvbSBtYXBwaW5nIGluZm8KICAgICAqIEBwYXJhbSB0YWJs\nZSB0aGUgdGFibGUgZm9yIHRoZSBjb2x1bW5zCiAgICAgKiBAcGFyYW0gYWRh\ncHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5n\nIG9yIHNjaGVtYQogICAgICogQHBhcmFtIGZpbGwgd2hldGhlciB0byBkZWZh\ndWx0IG1pc3NpbmcgY29sdW1uIGluZm9ybWF0aW9uCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBzdGF0aWMgQ29sdW1uIG1lcmdlQ29sdW1uKE1ldGFEYXRhQ29u\ndGV4dCBjb250ZXh0LCBTdHJpbmcgcHJlZml4LAogICAgICAgIENvbHVtbiB0\nbXBsYXRlLCBib29sZWFuIGNvbXBhdCwgQ29sdW1uIGdpdmVuLCBUYWJsZSB0\nYWJsZSwKICAgICAgICBib29sZWFuIGFkYXB0LCBib29sZWFuIGZpbGwpIHsK\nICAgICAgICBhc3NlcnRUYWJsZShjb250ZXh0LCB0YWJsZSk7CgogICAgICAg\nIC8vIGlmIG5vdCBhZGFwdGluZyBtdXN0IHByb3ZpZGUgY29sdW1uIG5hbWUg\nYXQgYSBtaW5pbXVtCiAgICAgICAgREJJZGVudGlmaWVyIGNvbE5hbWUgPSAo\nZ2l2ZW4gPT0gbnVsbCkgPyBEQklkZW50aWZpZXIuTlVMTCA6IGdpdmVuLmdl\ndElkZW50aWZpZXIoKTsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzTnVs\nbChjb2xOYW1lKSAmJiAhYWRhcHQgJiYgIWZpbGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXggKyAi\nLW5vLWNvbC1uYW1lIiwKICAgICAgICAgICAgICAgIGNvbnRleHQpKTsKCiAg\nICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9z\naXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIERCRGlj\ndGlvbmFyeSBkaWN0ID0gcmVwb3MuZ2V0REJEaWN0aW9uYXJ5KCk7CgogICAg\nICAgIC8vIGRldGVybWluZSB0aGUgY29sdW1uIG5hbWUgYmFzZWQgb24gZ2l2\nZW4gaW5mbywgb3IgdGVtcGxhdGUgaWYgbm9uZTsKICAgICAgICAvLyBhbHNv\nIG1ha2Ugc3VyZSB0aGF0IGlmIHRoZSB1c2VyIGdhdmUgYSBjb2x1bW4gbmFt\nZSwgaGUgZGlkbid0IHRyeQogICAgICAgIC8vIHRvIHB1dCB0aGUgY29sdW1u\nIGluIGFuIHVuZXhwZWN0ZWQgdGFibGUKICAgICAgICBpZiAoREJJZGVudGlm\naWVyLmlzTnVsbChjb2xOYW1lKSkKICAgICAgICAgICAgY29sTmFtZSA9IHRt\ncGxhdGUuZ2V0SWRlbnRpZmllcigpOwogICAgICAgIFF1YWxpZmllZERCSWRl\nbnRpZmllciBwYXRoID0gUXVhbGlmaWVkREJJZGVudGlmaWVyLmdldFBhdGgo\nY29sTmFtZSk7CiAgICAgICAgaWYgKHBhdGguaXNVbnF1YWxpZmllZENvbHVt\nbigpKSB7CiAgICAgICAgICAgIGNvbE5hbWUgPSBwYXRoLmdldElkZW50aWZp\nZXIoKTsKICAgICAgICB9IGVsc2UgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxs\nKHBhdGguZ2V0T2JqZWN0VGFibGVOYW1lKCkpKSB7CiAgICAgICAgICAgIGZp\nbmRUYWJsZShjb250ZXh0LCBwYXRoLmdldE9iamVjdFRhYmxlTmFtZSgpLCB0\nYWJsZSwKICAgICAgICAgICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAg\nICBjb2xOYW1lID0gcGF0aC5nZXRVbnF1YWxpZmllZE5hbWUoKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGZpbmQgZXhpc3RpbmcgY29sdW1uCiAgICAgICAg\nQ29sdW1uIGNvbCA9IHRhYmxlLmdldENvbHVtbihjb2xOYW1lKTsKICAgICAg\nICBpZiAoY29sID09IG51bGwgJiYgIWFkYXB0KSB7CiAgICAgICAgICAgIC8v\nIAogICAgICAgICAgICAvLyBTZWUgaWYgY29sdW1uIG5hbWUgaGFzIGFscmVh\nZHkgYmVlbiB2YWxpZGF0ZWQgaW4gYSBkeW5hbWljIHRhYmxlLgogICAgICAg\nICAgICAvLyBJZiBzbyB0aGVuIHdhbnQgdG8gdXNlIHRoYXQgdmFsaWRhdGVk\nIGNvbHVtbiBuYW1lIGluc3RlYWQuIFRoaXMKICAgICAgICAgICAgLy8gc2hv\ndWxkIHNlbGRvbSBpZiBldmVyIG9jY3VyIGFzIGxvbmcgYXMgdGhlIGRhdGFi\nYXNlIGRpY3Rpb25hcmllcwogICAgICAgICAgICAvLyBhcmUga2VwdCB1cC10\nby1kYXRlLiAKICAgICAgICAgICAgLy8gCiAgICAgICAgICAgIGlmICgoY29s\nTmFtZS5nZXROYW1lKCkubGVuZ3RoKCkgPiBkaWN0Lm1heENvbHVtbk5hbWVM\nZW5ndGgpIHx8IAogICAgICAgICAgICAgICBkaWN0LmdldEludmFsaWRDb2x1\nbW5Xb3JkU2V0KCkuY29udGFpbnMoREJJZGVudGlmaWVyLnRvVXBwZXIoY29s\nTmFtZSkuZ2V0TmFtZSgpKSAmJgogICAgICAgICAgICAgICEodGFibGUuZ2V0\nQ2xhc3MoKS5nZXROYW1lKCkuY29udGFpbnMoIkR5bmFtaWNUYWJsZSIpKSkg\newogICAgICAgICAgICAgICAgY29sTmFtZT1kaWN0LmdldFZhbGlkQ29sdW1u\nTmFtZShjb2xOYW1lLCBuZXcgVGFibGUoKSk7CiAgICAgICAgICAgICAgICBj\nb2wgPSB0YWJsZS5nZXRDb2x1bW4oY29sTmFtZSk7CiAgICAgICAgICAgICAg\nICBpZiAoY29sID09IG51bGwgJiYgIWFkYXB0KSB7CiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuCiAgICAg\nICAgICAgICAgICAgICAgICAgIGdldChwcmVmaXggKyAiLWJhZC1jb2wtbmFt\nZSIsIGNvbnRleHQsIGNvbE5hbWUsIHRhYmxlKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy4KICAg\nICAgICAgICAgICAgICAgICBnZXQocHJlZml4ICsgIi1iYWQtY29sLW5hbWUi\nLCBjb250ZXh0LCBjb2xOYW1lLCB0YWJsZSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyB1c2UgaW5mb3JtYXRpb24gZnJvbSB0ZW1w\nbGF0ZSBjb2x1bW4gYnkgZGVmYXVsdCwgYWxsb3dpbmcgYW55CiAgICAgICAg\nLy8gdXNlci1naXZlbiBzcGVjaWZpY3MgdG8gb3ZlcnJpZGUgaXQKICAgICAg\nICBpbnQgdHlwZSA9IHRtcGxhdGUuZ2V0VHlwZSgpOwogICAgICAgIGludCBz\naXplID0gdG1wbGF0ZS5nZXRTaXplKCk7CiAgICAgICAgaWYgKHR5cGUgPT0g\nVHlwZXMuT1RIRVIpIHsKICAgICAgICAgICAgaW50IHByZWNpcyA9IDA7CiAg\nICAgICAgICAgIGludCBzY2FsZSA9IDA7CiAgICAgICAgICAgIGlmKGdpdmVu\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHByZWNpcyA9IGdpdmVuLmdl\ndFNpemUoKTsKICAgICAgICAgICAgICAgIHNjYWxlID0gZ2l2ZW4uZ2V0RGVj\naW1hbERpZ2l0cygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGUg\nPQogICAgICAgICAgICAgICAgZGljdC5nZXRKREJDVHlwZSh0bXBsYXRlLmdl\ndEphdmFUeXBlKCksIHNpemUgPT0gLTEsIHByZWNpcywKICAgICAgICAgICAg\nICAgICAgICBzY2FsZSwgdG1wbGF0ZS5pc1hNTCgpKTsKICAgICAgICB9CiAg\nICAgICAgICAgIAogICAgICAgIGJvb2xlYW4gdHR5cGUgPSB0cnVlOwogICAg\nICAgIGludCBvdHlwZSA9IHR5cGU7CiAgICAgICAgU3RyaW5nIHR5cGVOYW1l\nID0gdG1wbGF0ZS5nZXRUeXBlTmFtZSgpOwogICAgICAgIEJvb2xlYW4gbm90\nTnVsbCA9IG51bGw7CiAgICAgICAgaWYgKHRtcGxhdGUuaXNOb3ROdWxsRXhw\nbGljaXQoKSkKICAgICAgICAgICAgbm90TnVsbCA9ICh0bXBsYXRlLmlzTm90\nTnVsbCgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgaW50IGRlY2ltYWxzID0gdG1wbGF0ZS5nZXREZWNpbWFsRGlnaXRzKCk7\nCiAgICAgICAgU3RyaW5nIGRlZlN0ciA9IHRtcGxhdGUuZ2V0RGVmYXVsdFN0\ncmluZygpOwogICAgICAgIGJvb2xlYW4gYXV0b0Fzc2lnbiA9IHRtcGxhdGUu\naXNBdXRvQXNzaWduZWQoKTsKICAgICAgICBib29sZWFuIHJlbGF0aW9uSWQg\nPSB0bXBsYXRlLmlzUmVsYXRpb25JZCgpOwogICAgICAgIGJvb2xlYW4gaW1w\nbGljaXRSZWxhdGlvbiA9IHRtcGxhdGUuaXNJbXBsaWNpdFJlbGF0aW9uKCk7\nCiAgICAgICAgU3RyaW5nIHRhcmdldEZpZWxkID0gdG1wbGF0ZS5nZXRUYXJn\nZXRGaWVsZCgpOwogICAgICAgIGlmIChnaXZlbiAhPSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIHVzZSBnaXZlbiB0eXBlIGlmIHByb3ZpZGVkLCBidXQgd2Fy\nbiBpZiBpdCBpc24ndCBjb21wYXRpYmxlIHdpdGgKICAgICAgICAgICAgLy8g\ndGhlIGV4cGVjdGVkIGNvbHVtbiB0eXBlCiAgICAgICAgICAgIGlmIChnaXZl\nbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsKICAgICAgICAgICAgICAg\nIHR0eXBlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoY29tcGF0ICYm\nICFnaXZlbi5pc0NvbXBhdGlibGUodHlwZSwgdHlwZU5hbWUsIHNpemUsIAog\nICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzKSkgewogICAgICAgICAgICAg\nICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi1pbmNv\nbXBhdC1jb2wiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4\ndCwgY29sTmFtZSwgU2NoZW1hcy5nZXRKREJDTmFtZSh0eXBlKSkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3R5cGUgPSBnaXZlbi5n\nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICB0eXBlID0gZGljdC5nZXRQcmVm\nZXJyZWRUeXBlKG90eXBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0\neXBlTmFtZSA9IGdpdmVuLmdldFR5cGVOYW1lKCk7CiAgICAgICAgICAgIHNp\nemUgPSBnaXZlbi5nZXRTaXplKCk7CiAgICAgICAgICAgIGRlY2ltYWxzID0g\nZ2l2ZW4uZ2V0RGVjaW1hbERpZ2l0cygpOwoKICAgICAgICAgICAgLy8gbGVh\ndmUgdGhpcyBpbmZvIGFzIHRoZSB0ZW1wbGF0ZSBkZWZhdWx0cyB1bmxlc3Mg\ndGhlIHVzZXIKICAgICAgICAgICAgLy8gZXhwbGljaXRseSB0dXJucyBpdCBv\nbiBpbiB0aGUgZ2l2ZW4gY29sdW1uCiAgICAgICAgICAgIGlmIChnaXZlbi5p\nc05vdE51bGxFeHBsaWNpdCgpKQogICAgICAgICAgICAgICAgbm90TnVsbCA9\nIChnaXZlbi5pc05vdE51bGwoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICBpZiAoZ2l2ZW4uZ2V0RGVmYXVsdFN0cmlu\nZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICBkZWZTdHIgPSBnaXZlbi5n\nZXREZWZhdWx0U3RyaW5nKCk7CiAgICAgICAgICAgIGlmIChnaXZlbi5pc0F1\ndG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAgYXV0b0Fzc2lnbiA9IHRy\ndWU7CiAgICAgICAgICAgIGlmIChnaXZlbi5pc1JlbGF0aW9uSWQoKSkKICAg\nICAgICAgICAgICAgIHJlbGF0aW9uSWQgPSB0cnVlOwogICAgICAgICAgICBp\nZiAoZ2l2ZW4uaXNJbXBsaWNpdFJlbGF0aW9uKCkpCiAgICAgICAgICAgIAlp\nbXBsaWNpdFJlbGF0aW9uID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8v\nIGRlZmF1bHQgY2hhciBjb2x1bW4gc2l6ZSBpZiBvcmlnaW5hbCB0eXBlIGlz\nIGNoYXIgKHRlc3Qgb3JpZ2luYWwKICAgICAgICAvLyB0eXBlIHJhdGhlciB0\naGFuIGZpbmFsIHR5cGUgYmVjYXVzZSBvcmlnIG1pZ2h0IGJlIGNsb2IsIHRy\nYW5zbGF0ZWQKICAgICAgICAvLyB0byBhbiB1bnNpemVkIHZhcmNoYXIsIHdo\naWNoIGlzIHN1cHBvcnRlZCBieSBzb21lIGRicykKICAgICAgICBpZiAoc2l6\nZSA9PSAwICYmIChvdHlwZSA9PSBUeXBlcy5WQVJDSEFSIHx8IG90eXBlID09\nIFR5cGVzLkNIQVIpKQogICAgICAgICAgICBzaXplID0gZGljdC5jaGFyYWN0\nZXJDb2x1bW5TaXplOwoKICAgICAgICAvLyBjcmVhdGUgY29sdW1uLCBvciBt\nYWtlIHN1cmUgZXhpc3RpbmcgY29sdW1uIG1hdGNoZXMgZXhwZWN0ZWQgdHlw\nZQogICAgICAgIGlmIChjb2wgPT0gbnVsbCkgewogICAgICAgICAgICBjb2wg\nPSB0YWJsZS5hZGRDb2x1bW4oY29sTmFtZSk7CiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlKHR5cGUpOwogICAgICAgIH0gZWxzZSBpZiAoKGNvbXBhdCB8fCAh\ndHR5cGUpICYmICFjb2wuaXNDb21wYXRpYmxlKHR5cGUsIHR5cGVOYW1lLCAK\nICAgICAgICAgICAgc2l6ZSwgZGVjaW1hbHMpKSB7CiAgICAgICAgICAgIC8v\nIGlmIGV4aXN0aW5nIGNvbHVtbiBpc24ndCBjb21wYXRpYmxlIHdpdGggZGVz\naXJlZCB0eXBlLCBkaWUgaWYKICAgICAgICAgICAgLy8gY2FuJ3QgYWRhcHQs\nIGVsc2Ugd2FybiBhbmQgY2hhbmdlIHRoZSBleGlzdGluZyBjb2x1bW4gdHlw\nZQogICAgICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KHByZWZpeCAr\nICItYmFkLWNvbCIsIGNvbnRleHQsCiAgICAgICAgICAgICAgICBTY2hlbWFz\nLmdldEpEQkNOYW1lKHR5cGUpLCBjb2wuZ2V0RGVzY3JpcHRpb24oKSk7CiAg\nICAgICAgICAgIGlmICghYWRhcHQpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24obXNnKTsKICAgICAgICAgICAgTG9nIGxv\nZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKG1zZyk7Cgog\nICAgICAgICAgICBjb2wuc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2Ug\naWYgKGdpdmVuICE9IG51bGwgJiYgZ2l2ZW4uZ2V0VHlwZSgpICE9IFR5cGVz\nLk9USEVSKSB7CiAgICAgICAgICAgIC8vIGFzIGxvbmcgYXMgdHlwZXMgYXJl\nIGNvbXBhdGlibGUsIHNldCBjb2x1bW4gdG8gZXhwZWN0ZWQgdHlwZQogICAg\nICAgICAgICBjb2wuc2V0VHlwZSh0eXBlKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGFsd2F5cyBzZXQgdGhlIGphdmEgdHlwZSBhbmQgYXV0b2Fzc2lnbiB0\nbyBleHBlY3RlZCB2YWx1ZXMsIGV2ZW4gb24KICAgICAgICAvLyBhbiBleGlz\ndGluZyBjb2x1bW4sIHNpbmNlIHdlIGRvbid0IGdldCB0aGlzIGZyb20gdGhl\nIERCCiAgICAgICAgaWYgKGNvbXBhdCkKICAgICAgICAgICAgY29sLnNldEph\ndmFUeXBlKHRtcGxhdGUuZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAgZWxzZSBp\nZiAoY29sLmdldEphdmFUeXBlKCkgPT0gSmF2YVR5cGVzLk9CSkVDVCkgewog\nICAgICAgICAgICBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiBnaXZlbi5nZXRKYXZh\nVHlwZSgpICE9IEphdmFUeXBlcy5PQkpFQ1QpCiAgICAgICAgICAgICAgICBj\nb2wuc2V0SmF2YVR5cGUoZ2l2ZW4uZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShKYXZh\nVHlwZXMuZ2V0VHlwZUNvZGUKICAgICAgICAgICAgICAgICAgICAoU2NoZW1h\ncy5nZXRKYXZhVHlwZShjb2wuZ2V0VHlwZSgpLCBjb2wuZ2V0U2l6ZSgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBjb2wuZ2V0RGVjaW1hbERpZ2l0cygp\nKSkpOwogICAgICAgIH0KICAgICAgICBjb2wuc2V0QXV0b0Fzc2lnbmVkKGF1\ndG9Bc3NpZ24pOwogICAgICAgIGNvbC5zZXRSZWxhdGlvbklkKHJlbGF0aW9u\nSWQpOwogICAgICAgIGNvbC5zZXRJbXBsaWNpdFJlbGF0aW9uKGltcGxpY2l0\nUmVsYXRpb24pOwogICAgICAgIGNvbC5zZXRUYXJnZXRGaWVsZCh0YXJnZXRG\naWVsZCk7CgogICAgICAgIC8vIHdlIG5lZWQgdGhpcyBmb3IgcnVudGltZSwg\nYW5kIHRoZSBkeW5hbWljIHNjaGVtYSBmYWN0b3J5IG1pZ2h0CiAgICAgICAg\nLy8gbm90IGtub3cgaXQsIHNvIHNldCBpdCBldmVuIGlmIG5vdCBhZGFwdGlu\nZwogICAgICAgIGlmIChkZWZTdHIgIT0gbnVsbCkKICAgICAgICAgICAgY29s\nLnNldERlZmF1bHRTdHJpbmcoZGVmU3RyKTsKICAgICAgICBpZiAobm90TnVs\nbCAhPSBudWxsKQogICAgICAgICAgICBjb2wuc2V0Tm90TnVsbChub3ROdWxs\nLmJvb2xlYW5WYWx1ZSgpKTsKCiAgICAgICAgLy8gYWRkIG90aGVyIGRldGFp\nbHMgaWYgYWRhcHRpbmcKICAgICAgICBpZiAoYWRhcHQpIHsKICAgICAgICAg\nICAgaWYgKHR5cGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBjb2wu\nc2V0VHlwZU5hbWUodHlwZU5hbWUpOwogICAgICAgICAgICBpZiAoc2l6ZSAh\nPSAwKQogICAgICAgICAgICAgICAgY29sLnNldFNpemUoc2l6ZSk7CiAgICAg\nICAgICAgIGlmIChkZWNpbWFscyAhPSAwKQogICAgICAgICAgICAgICAgY29s\nLnNldERlY2ltYWxEaWdpdHMoZGVjaW1hbHMpOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKHRtcGxhdGUuaGFzQ29tbWVudCgpKQogICAgICAgICAgICBjb2wu\nc2V0Q29tbWVudCh0bXBsYXRlLmdldENvbW1lbnQoKSk7CiAgICAgICAgaWYg\nKHRtcGxhdGUuaXNYTUwoKSkKICAgICAgICAgICAgY29sLnNldFhNTCh0bXBs\nYXRlLmlzWE1MKCkpOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGaW5kIHRoZSB0YWJsZSBuYW1lZCBieSBhIGNvbHVtbiBv\nciB0YXJnZXQuCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgY29udGV4\ndCBmb3IgZXJyb3IgbWVzc2FnZXMsIGV0Yy4KICAgICAqIEBwYXJhbSBuYW1l\nIHRoZSB0YWJsZSBuYW1lLCBwb3NzaWJseSBpbmNsdWRpbmcgc2NoZW1hCiAg\nICAgKiBAcGFyYW0gZXhwZWN0ZWQgdGhlIGV4cGVjdGVkIHRhYmxlOyBtYXkg\nYmUgbnVsbAogICAgICogQHBhcmFtIGludmVyc2UgdGhlIHBvc3NpYmxlIGlu\ndmVyc2UgdGFibGU7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0gcmVsIGlm\nIHdlJ3JlIGZpbmRpbmcgdGhlIHRhcmdldCB0YWJsZSBvZiBhIGpvaW4sIHRo\nZQogICAgICogam9pbmVkLXRvIHR5cGU7IGFsbG93cyB1cyB0byBhbHNvIGxv\nb2sgaW4gaXRzIHN1cGVyY2xhc3MgdGFibGVzCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIFRhYmxlIGZpbmRUYWJsZShNZXRhRGF0YUNvbnRleHQgY29u\ndGV4dCwgREJJZGVudGlmaWVyIG5hbWUsCiAgICAgICAgVGFibGUgZXhwZWN0\nZWQsIFRhYmxlIGludmVyc2UsIENsYXNzTWFwcGluZyByZWwpIHsKICAgICAg\nICAvLyBpcyB0aGlzIHRoZSBleHBlY3RlZCB0YWJsZT8KICAgICAgICBpZiAo\nZXhwZWN0ZWQgPT0gbnVsbCAmJiByZWwgIT0gbnVsbCkKICAgICAgICAgICAg\nZXhwZWN0ZWQgPSByZWwuZ2V0VGFibGUoKTsKICAgICAgICBpZiAoZXhwZWN0\nZWQgIT0gbnVsbCAmJiBpc1RhYmxlTmFtZShuYW1lLCBleHBlY3RlZCkpCiAg\nICAgICAgICAgIHJldHVybiBleHBlY3RlZDsKCiAgICAgICAgLy8gY2hlY2sg\nZm9yIGludmVyc2UKICAgICAgICBpZiAoaW52ZXJzZSAhPSBudWxsICYmIGlz\nVGFibGVOYW1lKG5hbWUsIGludmVyc2UpKQogICAgICAgICAgICByZXR1cm4g\naW52ZXJzZTsKCiAgICAgICAgLy8gc3VwZXJjbGFzcyB0YWJsZT8KICAgICAg\nICBpZiAocmVsICE9IG51bGwpCiAgICAgICAgICAgIHJlbCA9IHJlbC5nZXRK\nb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICB3aGlsZSAo\ncmVsICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGlzVGFibGVOYW1lKG5h\nbWUsIHJlbC5nZXRUYWJsZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBy\nZWwuZ2V0VGFibGUoKTsKICAgICAgICAgICAgcmVsID0gcmVsLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gbm9uZSBvZiB0aGUgcG9zc2libGUgdGFibGVzCiAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJjb2wtd3JvbmctdGFi\nbGUiLCBjb250ZXh0LAogICAgICAgICAgICBleHBlY3RlZCwgbmFtZS5nZXRO\nYW1lKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBuYW1lIG1hdGNoZXMgdGhlIGdpdmVuIHRhYmxlLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzVGFibGVOYW1lKERC\nSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVy\nbiBEQklkZW50aWZpZXIuZXF1YWwobmFtZSwgdGFibGUuZ2V0SWRlbnRpZmll\ncigpKQogICAgICAgICAgICB8fCBEQklkZW50aWZpZXIuZXF1YWwobmFtZSwg\ndGFibGUuZ2V0RnVsbElkZW50aWZpZXIoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXRyaWV2ZS9jcmVhdGUgYW4gaW5kZXggb24gdGhlIGdpdmVuIGNv\nbHVtbnMgYnkgbWVyZ2luZyB0aGUgZ2l2ZW4KICAgICAqIHRlbXBsYXRlIGlu\nZm9ybWF0aW9uIHdpdGggYW55IHVzZXItcHJvdmlkZWQgaW5mb3JtYXRpb24u\nCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2Un\ncmUgcmV0cmlldmluZyBhbiBpbmRleCBmb3IKICAgICAqIEBwYXJhbSBwcmVm\naXggbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICog\nQHBhcmFtIHRtcGxhdGUgdGVtcGxhdGUgZm9yIGV4cGVjdGVkIGluZGV4IGlu\nZm9ybWF0aW9uCiAgICAgKiBAcGFyYW0gY29scyB0aGUgaW5kZXhlZCBjb2x1\nbW5zCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5\nIHRoZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVtYQogICAgICovCiAgICBw\ncm90ZWN0ZWQgSW5kZXggY3JlYXRlSW5kZXgoTWV0YURhdGFDb250ZXh0IGNv\nbnRleHQsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgSW5kZXggdG1wbGF0ZSwg\nQ29sdW1uW10gY29scywgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChw\ncmVmaXggPT0gbnVsbCkKICAgICAgICAgICAgcHJlZml4ID0gImdlbmVyaWMi\nOwoKICAgICAgICAvLyBjYW4ndCBjcmVhdGUgYW4gaW5kZXggaWYgdGhlcmUg\nYXJlIG5vIGNvbHMKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMu\nbGVuZ3RoID09IDApIHsKICAgICAgICAgICAgaWYgKF9pZHggIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICItbm8taW5k\nZXgtY29scyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyBsb29rIGZvciBhbiBleGlzdGluZyBp\nbmRleCBvbiB0aGVzZSBjb2x1bW5zCiAgICAgICAgVGFibGUgdGFibGUgPSBj\nb2xzWzBdLmdldFRhYmxlKCk7CiAgICAgICAgSW5kZXhbXSBpZHhzID0gdGFi\nbGUuZ2V0SW5kZXhlcygpOwogICAgICAgIEluZGV4IGV4aXN0ID0gbnVsbDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlkeHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGlkeHNbaV0uY29sdW1uc01hdGNoKGNvbHMp\nKSB7CiAgICAgICAgICAgICAgICBleGlzdCA9IGlkeHNbaV07CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gcmVtb3ZlIGV4aXN0aW5nIGluZGV4PwogICAgICAgIGlmICghX2Nh\nbklkeCkgewogICAgICAgICAgICBpZiAoZXhpc3QgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoIWFkYXB0\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KHByZWZpeCArICItaW5kZXgtZXhpc3RzIiwKICAgICAgICAg\nICAgICAgICAgICBjb250ZXh0KSk7CiAgICAgICAgICAgIHRhYmxlLnJlbW92\nZUluZGV4KGV4aXN0KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfQoKICAgICAgICAvLyBpZiB3ZSBoYXZlIGFuIGV4aXN0aW5nIGluZGV4\nLCBtZXJnZSBnaXZlbiBpbmZvIGludG8gaXQKICAgICAgICBpZiAoZXhpc3Qg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2lkeCAhPSBudWxsICYmIF9p\nZHguaXNVbmlxdWUoKSAmJiAhZXhpc3QuaXNVbmlxdWUoKSkgewogICAgICAg\nICAgICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAg\nICAgICAgICAgICAgICAgICAgICsgIi1pbmRleC1ub3QtdW5pcXVlIiwgY29u\ndGV4dCkpOwogICAgICAgICAgICAgICAgZXhpc3Quc2V0VW5pcXVlKHRydWUp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBleGlzdDsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIG5vIGRlZmF1bHRzIHJldHVybiBudWxs\nCiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGluZ1Jl\ncG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIGJv\nb2xlYW4gZmlsbCA9IHJlcG9zLmdldE1hcHBpbmdEZWZhdWx0cygpLmRlZmF1\nbHRNaXNzaW5nSW5mbygpOwogICAgICAgIGlmIChfaWR4ID09IG51bGwgJiYg\nKHRtcGxhdGUgPT0gbnVsbCB8fCAoIWFkYXB0ICYmICFmaWxsKSkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBEQklkZW50aWZpZXIgbmFt\nZSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIGJvb2xlYW4gdW5xOwog\nICAgICAgIGlmIChfaWR4ICE9IG51bGwpIHsKICAgICAgICAgICAgbmFtZSA9\nIF9pZHguZ2V0SWRlbnRpZmllcigpOwogICAgICAgICAgICB1bnEgPSBfaWR4\nLmlzVW5pcXVlKCk7CiAgICAgICAgICAgIC8vIHByZXNlcnZlIG11bHRpcGxl\nIGNvbHVtbnMgaWYgdGhleSBhcmUgc3BlY2lmaWVkIGluIHRoZSBpbmRleAog\nICAgICAgICAgICBpZiAoX2lkeC5nZXRDb2x1bW5zKCkgIT0gbnVsbCAmJiBf\naWR4LmdldENvbHVtbnMoKS5sZW5ndGggPiAxKQogICAgICAgICAgICAgICAg\nY29scyA9IF9pZHguZ2V0Q29sdW1ucygpOwogICAgICAgIH0gZWxzZQogICAg\nICAgICAgICB1bnEgPSB0bXBsYXRlLmlzVW5pcXVlKCk7CgogICAgICAgIC8v\nIGlmIG5vIG5hbWUgcHJvdmlkZWQgYnkgdXNlciBpbmZvLCBtYWtlIG9uZQog\nICAgICAgIGlmIChEQklkZW50aWZpZXIuaXNOdWxsKG5hbWUpKSB7CiAgICAg\nICAgICAgIGlmICh0bXBsYXRlICE9IG51bGwpCiAgICAgICAgICAgICAgICBu\nYW1lID0gdG1wbGF0ZS5nZXRJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgbmFtZSA9IGNvbHNbMF0uZ2V0SWRlbnRp\nZmllcigpOwogICAgICAgICAgICAgICAgbmFtZSA9IHJlcG9zLmdldERCRGlj\ndGlvbmFyeSgpLmdldFZhbGlkSW5kZXhOYW1lKG5hbWUsIHRhYmxlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgSW5kZXggaWR4ID0gdGFi\nbGUuYWRkSW5kZXgobmFtZSk7CiAgICAgICAgaWR4LnNldFVuaXF1ZSh1bnEp\nOwogICAgICAgIGlkeC5zZXRDb2x1bW5zKGNvbHMpOwogICAgICAgIHJldHVy\nbiBpZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZS9jcmVhdGUg\nYSB1bmlxdWUgY29uc3RyYWludCBvbiB0aGUgZ2l2ZW4gY29sdW1ucyBieSBt\nZXJnaW5nIHRoZQogICAgICogZ2l2ZW4gdGVtcGxhdGUgaW5mb3JtYXRpb24g\nd2l0aCBhbnkgdXNlci1wcm92aWRlZCBpbmZvcm1hdGlvbi4KICAgICAqCiAg\nICAgKiBAcGFyYW0gY29udGV4dCB0aGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2\naW5nIGEgY29uc3RyYWludCBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXggbG9j\nYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBhcmFt\nIHRtcGxhdGUgdGVtcGxhdGUgZm9yIGV4cGVjdGVkIHVuaXF1ZSBpbmZvcm1h\ndGlvbgogICAgICogQHBhcmFtIGNvbHMgdGhlIGNvbnN0cmFpbnQgY29sdW1u\ncwogICAgICogQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0\naGUgZXhpc3RpbmcgbWFwcGluZyBvciBzY2hlbWEKICAgICAqLwogICAgcHJv\ndGVjdGVkIFVuaXF1ZSBjcmVhdGVVbmlxdWUoTWV0YURhdGFDb250ZXh0IGNv\nbnRleHQsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgVW5pcXVlIHRtcGxhdGUs\nIENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAo\ncHJlZml4ID09IG51bGwpCiAgICAgICAgICAgIHByZWZpeCA9ICJnZW5lcmlj\nIjsKCiAgICAgICAgLy8gY2FuJ3QgY3JlYXRlIGEgY29uc3RyYWludCBpZiB0\naGVyZSBhcmUgbm8gY29scwogICAgICAgIGlmIChjb2xzID09IG51bGwgfHwg\nY29scy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBpZiAoX3VucSAhPSBu\ndWxsIHx8IHRtcGxhdGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAg\nICAgICAgICAgICAgICArICItbm8tdW5pcXVlLWNvbHMiLCBjb250ZXh0KSk7\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAg\nLy8gbG9vayBmb3IgYW4gZXhpc3RpbmcgY29uc3RyYWludCBvbiB0aGVzZSBj\nb2x1bW5zCiAgICAgICAgVGFibGUgdGFibGUgPSBjb2xzWzBdLmdldFRhYmxl\nKCk7CiAgICAgICAgVW5pcXVlW10gdW5xcyA9IHRhYmxlLmdldFVuaXF1ZXMo\nKTsKICAgICAgICBVbmlxdWUgZXhpc3QgPSBudWxsOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgdW5xcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAodW5xc1tpXS5jb2x1bW5zTWF0Y2goY29scykpIHsKICAgICAgICAg\nICAgICAgIGV4aXN0ID0gdW5xc1tpXTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUg\nZXhpc3RpbmcgdW5pcXVlPwogICAgICAgIGlmICghX2NhblVucSkgewogICAg\nICAgICAgICBpZiAoZXhpc3QgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICBpZiAoIWFkYXB0KQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHBy\nZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi11bmlxdWUtZXhpc3RzIiwg\nY29udGV4dCkpOwogICAgICAgICAgICB0YWJsZS5yZW1vdmVVbmlxdWUoZXhp\nc3QpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIC8vIG5vIGRlZmF1bHRzOyByZXR1cm4gZXhpc3RpbmcgY29uc3RyYWlu\ndCAoaWYgYW55KQogICAgICAgIGlmICh0bXBsYXRlID09IG51bGwgJiYgX3Vu\ncSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZXhpc3Q7CgogICAgICAg\nIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5\nKSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBpZiAoZXhpc3Qg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX3VucSAhPSBudWxsICYmIF91\nbnEuaXNEZWZlcnJlZCgpICYmICFleGlzdC5pc0RlZmVycmVkKCkpIHsKICAg\nICAgICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAg\nICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItZGVmZXIt\ndW5pcXVlIiwgY29udGV4dCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBleGlzdDsKICAgICAgICB9CgogICAgICAgIC8vIGRpY3QgY2Fu\nJ3QgaGFuZGxlIHVuaXF1ZSBjb25zdHJhaW50cz8KICAgICAgICBEQkRpY3Rp\nb25hcnkgZGljdCA9IHJlcG9zLmdldERCRGljdGlvbmFyeSgpOwogICAgICAg\nIGlmIChfdW5xICE9IG51bGwgJiYgIWRpY3Quc3VwcG9ydHNVbmlxdWVDb25z\ndHJhaW50cykgewogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9n\nKCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi11bmlx\ndWUtc3VwcG9ydCIsIGNvbnRleHQpKTsKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGZpbGwgPSByZXBvcy5n\nZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZhdWx0TWlzc2luZ0luZm8oKTsKICAg\nICAgICBpZiAoIWFkYXB0ICYmICFmaWxsICYmIF91bnEgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIERCSWRlbnRpZmllciBu\nYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgYm9vbGVhbiBkZWZl\ncnJlZDsKICAgICAgICBpZiAoX3VucSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIG5hbWUgPSBfdW5xLmdldElkZW50aWZpZXIoKTsKICAgICAgICAgICAgZGVm\nZXJyZWQgPSBfdW5xLmlzRGVmZXJyZWQoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBuYW1lID0gdG1wbGF0ZS5nZXRJZGVudGlmaWVyKCk7CiAg\nICAgICAgICAgIGRlZmVycmVkID0gdG1wbGF0ZS5pc0RlZmVycmVkKCk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoZGVmZXJyZWQgJiYgIWRpY3Quc3VwcG9y\ndHNEZWZlcnJlZENvbnN0cmFpbnRzKSB7CiAgICAgICAgICAgIExvZyBsb2cg\nPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5F\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldChw\ncmVmaXggKyAiLWNyZWF0ZS1kZWZlci11bmlxdWUiLAogICAgICAgICAgICAg\nICAgICAgIGNvbnRleHQsIGRpY3QucGxhdGZvcm0pKTsKICAgICAgICAgICAg\nZGVmZXJyZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\naWYgKERCSWRlbnRpZmllci5pc0VtcHR5KG5hbWUpKSB7CiAgICAgICAgCW5h\nbWUgPSBjb2xzWzBdLmdldElkZW50aWZpZXIoKTsKICAgICAgICAJbmFtZSA9\nIHJlcG9zLmdldERCRGljdGlvbmFyeSgpLmdldFZhbGlkVW5pcXVlTmFtZShu\nYW1lLCB0YWJsZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIFVuaXF1\nZSB1bnEgPSB0YWJsZS5hZGRVbmlxdWUobmFtZSk7CiAgICAgICAgdW5xLnNl\ndERlZmVycmVkKGRlZmVycmVkKTsKICAgICAgICB1bnEuc2V0Q29sdW1ucyhj\nb2xzKTsKICAgICAgICByZXR1cm4gdW5xOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0cmlldmUvY3JlYXRlIGEgZm9yZWlnbiBrZXkgKHBvc3NpYmx5IGxv\nZ2ljYWwpIG9uIHRoZSBnaXZlbiBjb2x1bW5zCiAgICAgKiBieSBtZXJnaW5n\nIHRoZSBnaXZlbiB0ZW1wbGF0ZSBpbmZvcm1hdGlvbiB3aXRoIGFueSB1c2Vy\nLXByb3ZpZGVkCiAgICAgKiBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBA\ncGFyYW0gY29udGV4dCB0aGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGEg\na2V5IGZvcgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3Ig\nbWVzc2FnZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gZ2l2ZW4gdGhlIGNv\nbHVtbnMgZ2l2ZW4gYnkgdGhlIHVzZXIKICAgICAqIEBwYXJhbSBkZWYgZGVm\nYXVsdHMgcHJvdmlkZXIKICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUg\nZm9yIHRoZSBrZXkKICAgICAqIEBwYXJhbSBjbHMgdHlwZSB3ZSdyZSBqb2lu\naW5nIGZyb20KICAgICAqIEBwYXJhbSByZWwgdGFyZ2V0IHR5cGUgd2UncmUg\nam9pbmluZyB0bwogICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciB0\naGUgZm9yZWlnbiBrZXkgY2FuIGJlIGludmVyc2VkCiAgICAgKiBAcGFyYW0g\nYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBw\naW5nIG9yIHNjaGVtYQogICAgICovCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktl\neSBjcmVhdGVGb3JlaWduS2V5KE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LAog\nICAgICAgIFN0cmluZyBwcmVmaXgsIExpc3Q8Q29sdW1uPiBnaXZlbiwgRm9y\nZWlnbktleURlZmF1bHRzIGRlZiwgVGFibGUgdGFibGUsCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIGNscywgQ2xhc3NNYXBwaW5nIHJlbCwgYm9vbGVhbiBpbnZl\ncnNhYmxlLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgYXNzZXJ0VGFibGUo\nY29udGV4dCwgdGFibGUpOwogICAgICAgIGlmIChwcmVmaXggPT0gbnVsbCkK\nICAgICAgICAgICAgcHJlZml4ID0gImdlbmVyaWMiOwoKICAgICAgICAvLyBj\nb2xsZWN0IHRoZSBmb3JlaWduIGtleSBjb2x1bW5zIGFuZCB0aGVpciB0YXJn\nZXRzCiAgICAgICAgT2JqZWN0W11bXSBqb2lucyA9IGNyZWF0ZUpvaW5zKGNv\nbnRleHQsIHByZWZpeCwgdGFibGUsIGNscywgcmVsLAogICAgICAgICAgICBn\naXZlbiwgZGVmLCBpbnZlcnNhYmxlLCBhZGFwdCk7CiAgICAgICAgX2pvaW4g\nPSBKT0lOX0ZPUldBUkQ7CgogICAgICAgIC8vIGVzdGFibGlzaCBsb2NhbCB0\nYWJsZSB1c2luZyBhbnkgam9pbiBiZXR3ZWVuIHR3byBjb2x1bW5zOyBpZiB3\nZSBvbmx5CiAgICAgICAgLy8gZmluZCBjb25zdGFudCBqb2lucywgdGhlbiBr\nZWVwIGRlZmF1bHQgbG9jYWwgdGFibGUgKGRpcmVjdGlvbmxlc3MpCiAgICAg\nICAgVGFibGUgbG9jYWwgPSB0YWJsZTsKICAgICAgICBUYWJsZSBmb3JlaWdu\nID0gcmVsLmdldFRhYmxlKCk7CiAgICAgICAgVGFibGUgdG1wOwogICAgICAg\nIGJvb2xlYW4gY29uc3RhbnQgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGxv\nY2FsU2V0ID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBq\nb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoam9pbnNbaV1b\nMV1pbnN0YW5jZW9mIENvbHVtbikgewogICAgICAgICAgICAgICAgdG1wID0g\nKChDb2x1bW4pIGpvaW5zW2ldWzBdKS5nZXRUYWJsZSgpOwogICAgICAgICAg\nICAgICAgaWYgKCFsb2NhbFNldCkgewogICAgICAgICAgICAgICAgICAgIGxv\nY2FsID0gdG1wOwogICAgICAgICAgICAgICAgICAgIGxvY2FsU2V0ID0gdHJ1\nZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG1wICE9IGxvY2FsKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nLW11bHQtZmstdGFibGVzIiwgY29udGV4dCwgbG9jYWwsIHRtcCkpOwogICAg\nICAgICAgICAgICAgZm9yZWlnbiA9ICgoQ29sdW1uKSBqb2luc1tpXVsxXSku\nZ2V0VGFibGUoKTsKCiAgICAgICAgICAgICAgICBpZiAoam9pbnNbaV1bMl0g\nPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgICAgIF9qb2luID0g\nSk9JTl9JTlZFUlNFOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgIGNvbnN0YW50ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHRoaXMgaXMgbm90IGEgY29uc3RhbnQgam9pbiwgbG9vayBmb3IgZXhpc3Rp\nbmcgZm9yZWlnbiBrZXkKICAgICAgICAvLyBvbiBsb2NhbCBjb2x1bW5zCiAg\nICAgICAgRm9yZWlnbktleSBleGlzdCA9IG51bGw7CiAgICAgICAgaWYgKCFj\nb25zdGFudCAmJiBsb2NhbC5nZXRGb3JlaWduS2V5cygpLmxlbmd0aCA+IDAp\nIHsKICAgICAgICAgICAgQ29sdW1uW10gY29scyA9IG5ldyBDb2x1bW5bam9p\nbnMubGVuZ3RoXTsKICAgICAgICAgICAgQ29sdW1uW10gcGtzID0gbmV3IENv\nbHVtbltqb2lucy5sZW5ndGhdOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBj\nb2xzW2ldID0gKENvbHVtbikgam9pbnNbaV1bMF07CiAgICAgICAgICAgICAg\nICBwa3NbaV0gPSAoQ29sdW1uKSBqb2luc1tpXVsxXTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IGxvY2FsLmdldEZv\ncmVpZ25LZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZmtzW2ld\nLmdldENvbnN0YW50Q29sdW1ucygpLmxlbmd0aCA9PSAwCiAgICAgICAgICAg\nICAgICAgICAgJiYgZmtzW2ldLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVt\nbnMoKS5sZW5ndGggPT0gMAogICAgICAgICAgICAgICAgICAgICYmIGZrc1tp\nXS5jb2x1bW5zTWF0Y2goY29scywgcGtzKSkgewogICAgICAgICAgICAgICAg\nICAgIGV4aXN0ID0gZmtzW2ldOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVw\nb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgREJE\naWN0aW9uYXJ5IGRpY3QgPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKTsKICAg\nICAgICBpZiAoZXhpc3QgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBtYWtl\nIGV4aXN0aW5nIGtleSBsb2dpY2FsPwogICAgICAgICAgICBpZiAoIV9jYW5G\nSykgewogICAgICAgICAgICAgICAgaWYgKGV4aXN0LmdldERlbGV0ZUFjdGlv\nbigpICE9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkUgJiYgIWFkYXB0KQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgKyAiLWZr\nLWV4aXN0cyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgICAgIGV4aXN0LnNl\ndERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9OT05FKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKF9mayAhPSBudWxsICYmIF9may5p\nc0RlZmVycmVkKCkgJiYgIWV4aXN0LmlzRGVmZXJyZWQoKSkgewogICAgICAg\nICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAg\nICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi1kZWZlci1mayIs\nIGNvbnRleHQpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYWxs\nb3cgdXNlci1naXZlbiBpbmZvIHRvIG92ZXJyaWRlIGV4aXN0aW5nIGtleSBp\nZiB3ZSdyZSBhZGFwdGluZzsKICAgICAgICAgICAgLy8gdGVtcGxhdGUgaW5m\nbyBjYW5ub3Qgb3ZlcnJpZGUgZXhpc3Rpbmcga2V5CiAgICAgICAgICAgIGlm\nIChhZGFwdCAmJiBfZmsgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKF9may5nZXRVcGRhdGVBY3Rpb24oKSAhPSBGb3JlaWduS2V5LkFDVElPTl9O\nT05FKQogICAgICAgICAgICAgICAgICAgIGV4aXN0LnNldFVwZGF0ZUFjdGlv\nbihfZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwogICAgICAgICAgICAgICAgaWYg\nKF9may5nZXREZWxldGVBY3Rpb24oKSAhPSBGb3JlaWduS2V5LkFDVElPTl9O\nT05FKQogICAgICAgICAgICAgICAgICAgIGV4aXN0LnNldERlbGV0ZUFjdGlv\nbihfZmsuZ2V0RGVsZXRlQWN0aW9uKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHNldElPRnJvbUpvaW5zKGV4aXN0LCBqb2lucyk7CiAgICAgICAg\nICAgIHJldHVybiBleGlzdDsKICAgICAgICB9CgogICAgICAgIERCSWRlbnRp\nZmllciBuYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgaW50IGRl\nbEFjdGlvbiA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAgaW50\nIHVwQWN0aW9uID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAgICBi\nb29sZWFuIGRlZmVycmVkID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBmaWxs\nID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJ\nbmZvKCk7CiAgICAgICAgRm9yZWlnbktleSB0bXBsYXRlID0gKGRlZiA9PSBu\ndWxsKSA/IG51bGwKICAgICAgICAgICAgOiBkZWYuZ2V0KGxvY2FsLCBmb3Jl\naWduLCBfam9pbiA9PSBKT0lOX0lOVkVSU0UpOwogICAgICAgIGlmIChfZmsg\nIT0gbnVsbCAmJiAodG1wbGF0ZSA9PSBudWxsIHx8ICghYWRhcHQgJiYgIWZp\nbGwpKSkgewogICAgICAgICAgICAvLyBpZiBub3QgYWRhcHRpbmcgb3Igbm8g\ndGVtcGxhdGUgaW5mbyB1c2UgZ2l2ZW4gZGF0YQogICAgICAgICAgICBuYW1l\nID0gX2ZrLmdldElkZW50aWZpZXIoKTsKICAgICAgICAgICAgZGVsQWN0aW9u\nID0gX2ZrLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgICAgICB1cEFjdGlv\nbiA9IF9may5nZXRVcGRhdGVBY3Rpb24oKTsKICAgICAgICAgICAgZGVmZXJy\nZWQgPSBfZmsuaXNEZWZlcnJlZCgpOwogICAgICAgIH0gZWxzZSBpZiAoX2Nh\nbkZLICYmIChhZGFwdCB8fCBmaWxsKSkgewogICAgICAgICAgICBpZiAoX2Zr\nID09IG51bGwgJiYgdG1wbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAvLyBubyB1c2VyIGdpdmVuIGluZm87IHVzZSB0ZW1wbGF0ZSBkYXRhCiAg\nICAgICAgICAgICAgICBuYW1lID0gdG1wbGF0ZS5nZXRJZGVudGlmaWVyKCk7\nCiAgICAgICAgICAgICAgICBkZWxBY3Rpb24gPSB0bXBsYXRlLmdldERlbGV0\nZUFjdGlvbigpOwogICAgICAgICAgICAgICAgdXBBY3Rpb24gPSB0bXBsYXRl\nLmdldFVwZGF0ZUFjdGlvbigpOwogICAgICAgICAgICAgICAgZGVmZXJyZWQg\nPSB0bXBsYXRlLmlzRGVmZXJyZWQoKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChfZmsgIT0gbnVsbCAmJiB0bXBsYXRlICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIG1lcmdlIHVzZXIgYW5kIHRlbXBsYXRlIGRhdGEsIGFsd2F5\ncyBsZXR0aW5nIHVzZXIgaW5mbyB3aW4KICAgICAgICAgICAgICAgIG5hbWUg\nPSBfZmsuZ2V0SWRlbnRpZmllcigpOwogICAgICAgICAgICAgICAgaWYgKERC\nSWRlbnRpZmllci5pc051bGwobmFtZSkgJiYgIURCSWRlbnRpZmllci5pc051\nbGwodG1wbGF0ZS5nZXRJZGVudGlmaWVyKCkpKQogICAgICAgICAgICAgICAg\nICAgIG5hbWUgPSB0bXBsYXRlLmdldElkZW50aWZpZXIoKTsKICAgICAgICAg\nICAgICAgIGRlbEFjdGlvbiA9IF9may5nZXREZWxldGVBY3Rpb24oKTsKICAg\nICAgICAgICAgICAgIGlmIChkZWxBY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJ\nT05fTk9ORSkKICAgICAgICAgICAgICAgICAgICBkZWxBY3Rpb24gPSB0bXBs\nYXRlLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgICAgICAgICAgdXBBY3Rp\nb24gPSBfZmsuZ2V0VXBkYXRlQWN0aW9uKCk7CiAgICAgICAgICAgICAgICBp\nZiAodXBBY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAg\nICAgICAgICAgICAgICB1cEFjdGlvbiA9IHRtcGxhdGUuZ2V0VXBkYXRlQWN0\naW9uKCk7CiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IF9may5pc0RlZmVy\ncmVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgh\nZGljdC5zdXBwb3J0c0RlbGV0ZUFjdGlvbihkZWxBY3Rpb24pCiAgICAgICAg\nICAgIHx8ICFkaWN0LnN1cHBvcnRzVXBkYXRlQWN0aW9uKHVwQWN0aW9uKSkg\newogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAgICAg\nICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi11bnN1cHBvcnRlZC1m\nay1hY3Rpb24iLCBjb250ZXh0KSk7CiAgICAgICAgICAgIGRlbEFjdGlvbiA9\nIEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAgICAgIHVwQWN0aW9u\nID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAgICB9CiAgICAgICAg\naWYgKGRlZmVycmVkICYmICFkaWN0LnN1cHBvcnRzRGVmZXJyZWRDb25zdHJh\naW50cykgewogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7\nCiAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi1jcmVhdGUt\nZGVmZXItZmsiLAogICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIGRpY3Qu\ncGxhdGZvcm0pKTsKICAgICAgICAgICAgZGVmZXJyZWQgPSBmYWxzZTsKICAg\nICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBmb3JlaWduIGtleSB3aXRoIG1l\ncmdlZCBpbmZvCiAgICAgICAgRm9yZWlnbktleSBmayA9IGxvY2FsLmFkZEZv\ncmVpZ25LZXkobmFtZSk7CiAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKGRl\nbEFjdGlvbik7CiAgICAgICAgZmsuc2V0VXBkYXRlQWN0aW9uKHVwQWN0aW9u\nKTsKICAgICAgICBmay5zZXREZWZlcnJlZChkZWZlcnJlZCk7CgogICAgICAg\nIC8vIGFkZCBqb2lucyB0byBrZXkKICAgICAgICBDb2x1bW4gY29sOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgY29sID0gKENvbHVtbikgam9pbnNbaV1bMF07CiAgICAg\nICAgICAgIGlmIChqb2luc1tpXVsxXWluc3RhbmNlb2YgQ29sdW1uKQogICAg\nICAgICAgICAgICAgZmsuam9pbihjb2wsIChDb2x1bW4pIGpvaW5zW2ldWzFd\nKTsKICAgICAgICAgICAgZWxzZSBpZiAoKGpvaW5zW2ldWzJdID09IEJvb2xl\nYW4uVFJVRSkgIT0gKF9qb2luID09IEpPSU5fSU5WRVJTRSkpCiAgICAgICAg\nICAgICAgICBmay5qb2luQ29uc3RhbnQoam9pbnNbaV1bMV0sIGNvbCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZrLmpvaW5Db25zdGFu\ndChjb2wsIGpvaW5zW2ldWzFdKTsKICAgICAgICB9CiAgICAgICAgc2V0SU9G\ncm9tSm9pbnMoZmssIGpvaW5zKTsKICAgICAgICByZXR1cm4gZms7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGpvaW4gaW5mb3JtYXRpb24gdG8g\ncG9wdWxhdGUgb3VyIGludGVybmFsIGNvbHVtbiBJL08gZGF0YS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNldElPRnJvbUpvaW5zKEZvcmVpZ25LZXkg\nZmssIE9iamVjdFtdW10gam9pbnMpIHsKICAgICAgICBMaXN0PENvbHVtbj4g\nY29scyA9IGdldENvbHVtbnMoKTsKICAgICAgICBfaW8gPSBudWxsOwogICAg\nICAgIGlmIChjb2xzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpbnQgY29uc3RJZHggPSAwOwogICAgICAgIGludCBpZHg7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAvLyBjb25zdCBjb2x1bW5zIGFyZSBpbmRleGVkIGFm\ndGVyIHN0ZCBqb2luIGNvbHVtbnMgaW4gZmsgSU8KICAgICAgICAgICAgaWYg\nKGpvaW5zW2ldWzFdaW5zdGFuY2VvZiBDb2x1bW4pCiAgICAgICAgICAgICAg\nICBpZHggPSBpIC0gY29uc3RJZHg7CiAgICAgICAgICAgIGVsc2UgaWYgKChq\nb2luc1tpXVsyXSA9PSBCb29sZWFuLlRSVUUpID09IChfam9pbiA9PSBKT0lO\nX0lOVkVSU0UpKQogICAgICAgICAgICAgICAgaWR4ID0gZmsuZ2V0Q29sdW1u\ncygpLmxlbmd0aCArIGNvbnN0SWR4Kys7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBzZXRJT0Zyb21D\nb2x1bW5GbGFncygoQ29sdW1uKSBjb2xzLmdldChpKSwgaWR4KTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgb3IgcmV0cmlldmUg\ndGhlIGZvcmVpZ24ga2V5IGpvaW5zLgogICAgICoKICAgICAqIEBwYXJhbSBj\nb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZpbmcgYSBrZXkgZm9y\nCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdl\nIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUgZm9y\nIHRoZSBrZXkKICAgICAqIEBwYXJhbSBjbHMgdHlwZSB3ZSdyZSBqb2luaW5n\nIGZyb20sIGlmIGFwcGxpY2FibGUKICAgICAqIEBwYXJhbSByZWwgdGFyZ2V0\nIHR5cGUgd2UncmUgam9pbmluZyB0bwogICAgICogQHBhcmFtIGdpdmVuIHRo\nZSBjb2x1bW5zIGdpdmVuIGJ5IHRoZSB1c2VyCiAgICAgKiBAcGFyYW0gZGVm\nIGZvcmVpZ24ga2V5IGRlZmF1bHRzIHByb3ZpZGVyCiAgICAgKiBAcGFyYW0g\naW52ZXJzYWJsZSB3aGV0aGVyIHRoZSBmb3JlaWduIGtleSBjYW4gYmUgaW52\nZXJzZWQKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2Rp\nZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKiBAcmV0\ndXJuIGFycmF5IG9mIHR1cGxlcyB3aGVyZSB0aGUgZmlyc3QgZWxlbWVudCBp\ncyB0aGUKICAgICAqIGxvY2FsIGNvbHVtbiAob3IgaW4gdGhlIGNhc2Ugb2Yg\nYSBjb25zdGFudCBqb2luIHRoZQogICAgICogc29sZSBjb2x1bW4pLCB0aGUg\nc2Vjb25kIGlzIHRoZSB0YXJnZXQgY29sdW1uIChvcgogICAgICogY29uc3Rh\nbnQpLCBhbmQgdGhlIHRoaXJkIGlzIHtAbGluayBCb29sZWFuI1RSVUV9IGlm\nCiAgICAgKiB0aGlzIGlzIGFuIGludmVyc2Ugam9pbgogICAgICovCiAgICBw\ncml2YXRlIE9iamVjdFtdW10gY3JlYXRlSm9pbnMoTWV0YURhdGFDb250ZXh0\nIGNvbnRleHQsCiAgICAgICAgU3RyaW5nIHByZWZpeCwgVGFibGUgdGFibGUs\nIENsYXNzTWFwcGluZyBjbHMsIENsYXNzTWFwcGluZyByZWwsCiAgICAgICAg\nTGlzdDxDb2x1bW4+IGdpdmVuLCBGb3JlaWduS2V5RGVmYXVsdHMgZGVmLCBi\nb29sZWFuIGludmVyc2FibGUsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBN\nYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkg\nY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgYm9vbGVhbiBmaWxs\nID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJ\nbmZvKCk7CiAgICAgICAgT2JqZWN0W11bXSBqb2luczsKCiAgICAgICAgLy8g\naWYgbm8gY29sdW1ucyBnaXZlbiwganVzdCBjcmVhdGUgbWlycm9ycyBvZiB0\nYXJnZXQgY29sdW1ucwogICAgICAgIGlmIChnaXZlbi5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgaWYgKCFhZGFwdCAmJiAhZmlsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVm\naXggKyAiLW5vLWZrLWNvbHMiLAogICAgICAgICAgICAgICAgICAgIGNvbnRl\neHQpKTsKCiAgICAgICAgICAgIENvbHVtbltdIHRhcmdldHMgPSByZWwuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBuZXcg\nT2JqZWN0W3RhcmdldHMubGVuZ3RoXVszXTsKICAgICAgICAgICAgQ29sdW1u\nIHRtcGxhdGU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGFy\nZ2V0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdG1wbGF0ZSA9\nIG5ldyBDb2x1bW4oKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUuc2V0SWRl\nbnRpZmllcih0YXJnZXRzW2ldLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAg\nICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKHRhcmdldHNbaV0uZ2V0SmF2\nYVR5cGUoKSk7CiAgICAgICAgICAgICAgICB0bXBsYXRlLnNldFR5cGUodGFy\nZ2V0c1tpXS5nZXRUeXBlKCkpOwogICAgICAgICAgICAgICAgdG1wbGF0ZS5z\nZXRUeXBlTmFtZSh0YXJnZXRzW2ldLmdldFR5cGVOYW1lKCkpOwogICAgICAg\nICAgICAgICAgdG1wbGF0ZS5zZXRTaXplKHRhcmdldHNbaV0uZ2V0U2l6ZSgp\nKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUuc2V0RGVjaW1hbERpZ2l0cyh0\nYXJnZXRzW2ldLmdldERlY2ltYWxEaWdpdHMoKSk7CgogICAgICAgICAgICAg\nICAgaWYgKGRlZiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGRlZi5w\nb3B1bGF0ZSh0YWJsZSwgcmVsLmdldFRhYmxlKCksIHRtcGxhdGUsIHRhcmdl\ndHNbaV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCBpLCB0YXJn\nZXRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBqb2luc1tpXVswXSA9IG1l\ncmdlQ29sdW1uKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZSwgdHJ1ZSwKICAg\nICAgICAgICAgICAgICAgICBudWxsLCB0YWJsZSwgYWRhcHQsIGZpbGwpOwog\nICAgICAgICAgICAgICAgam9pbnNbaV1bMV0gPSB0YXJnZXRzW2ldOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICB9\nCgogICAgICAgIC8vIHVzZSBnaXZlbiBjb2x1bW5zIHRvIGNyZWF0ZSBqb2lu\nLiAgd2UgZG9uJ3QgdHJ5IHRvIHVzZSBhbnkgb2YgdGhlCiAgICAgICAgLy8g\ndGVtcGxhdGUgY29sdW1ucywgZXZlbiBpZiB0aGUgdXNlciBkb2Vzbid0IGdp\ndmUgYSBjb2x1bW4gbGlua2luZyB0bwogICAgICAgIC8vIGV2ZXJ5IHByaW1h\ncnkga2V5IG9mIHRoZSB0YXJnZXQgdHlwZSAtLSB1c2VycyBhcmUgYWxsb3dl\nZCB0byBjcmVhdGUKICAgICAgICAvLyBwYXJ0aWFsIGpvaW5zLiAgdGhpcyBt\nZWFucywgdGhvdWdoLCB0aGF0IGlmIGEgdXNlciB3YW50cyB0byBzcGVjaWZ5\nCiAgICAgICAgLy8gaW5mbyBmb3Igb25lIGpvaW4gY29sdW1uLCBoZSBoYXMg\ndG8gYXQgbGVhc3QgY3JlYXRlIGVsZW1lbnRzIGZvcgogICAgICAgIC8vIGFs\nbCBvZiB0aGVtCgogICAgICAgIGpvaW5zID0gbmV3IE9iamVjdFtnaXZlbi5z\naXplKCldWzNdOwogICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjb2wgPSAoQ29sdW1uKSBnaXZlbi5nZXQoaSk7CiAgICAgICAgICAgIG1l\ncmdlSm9pbkNvbHVtbihjb250ZXh0LCBwcmVmaXgsIGNvbCwgam9pbnMsIGks\nIHRhYmxlLCBjbHMsIHJlbCwKICAgICAgICAgICAgICAgIGRlZiwgaW52ZXJz\nYWJsZSAmJiAhY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfUEtfSk9JTiksIGFk\nYXB0LAogICAgICAgICAgICAgICAgZmlsbCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBqb2luczsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBv\nciByZXRyaWV2ZSBhIGZvcmVpZ24ga2V5IGNvbHVtbiBmb3IgYSBqb2luLgog\nICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3Jl\nIHJldHJpZXZpbmcgYSBrZXkgZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxv\nY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJh\nbSBnaXZlbiB0aGUgZ2l2ZW4gbG9jYWwgZm9yZWlnbiBrZXkgY29sdW1uCiAg\nICAgKiBAcGFyYW0gam9pbnMgYXJyYXkgb2Ygam9pbnMKICAgICAqIEBwYXJh\nbSBpZHggaW5kZXggb2YgdGhlIGpvaW4gYXJyYXkgdG8gcG9wdWxhdGUKICAg\nICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUgZm9yIHRoZSBrZXkKICAgICAq\nIEBwYXJhbSBjbHMgdGhlIHR5cGUgd2UncmUgam9pbmluZyBmcm9tCiAgICAg\nKiBAcGFyYW0gcmVsIHRhcmdldCB0eXBlIHdlJ3JlIGpvaW5pbmcgdG8KICAg\nICAqIEBwYXJhbSBkZWYgZm9yZWlnbiBrZXkgZGVmYXVsdHMgcHJvdmlkZXI7\nCiAgICAgKiB1c2UgbnVsbCB0byBtaXJyb3IgdGFyZ2V0IGNvbHVtbiBuYW1l\ncwogICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciB0aGUgZm9yZWln\nbiBrZXkgY2FuIGJlIGludmVyc2VkCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hl\ndGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5nIG9yIHNj\naGVtYQogICAgICogQHBhcmFtIGZpbGwgd2hldGhlciB0byBkZWZhdWx0IG1p\nc3NpbmcgY29sdW1uIGluZm9ybWF0aW9uCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBtZXJnZUpvaW5Db2x1bW4oTWV0YURhdGFDb250ZXh0IGNvbnRleHQs\nIFN0cmluZyBwcmVmaXgsCiAgICAgICAgQ29sdW1uIGdpdmVuLCBPYmplY3Rb\nXVtdIGpvaW5zLCBpbnQgaWR4LCBUYWJsZSB0YWJsZSwgQ2xhc3NNYXBwaW5n\nIGNscywKICAgICAgICBDbGFzc01hcHBpbmcgcmVsLCBGb3JlaWduS2V5RGVm\nYXVsdHMgZGVmLCBib29sZWFuIGludmVyc2FibGUsCiAgICAgICAgYm9vbGVh\nbiBhZGFwdCwgYm9vbGVhbiBmaWxsKSB7CiAgICAgICAgLy8gZGVmYXVsdCB0\nbyB0aGUgcHJpbWFyeSBrZXkgY29sdW1uIG5hbWUgaWYgdGhpcyBpcyBhIHBr\nIGpvaW4KICAgICAgICBEQklkZW50aWZpZXIgbmFtZSA9IGdpdmVuLmdldElk\nZW50aWZpZXIoKTsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzTnVsbChu\nYW1lKSAmJiBnaXZlbiAhPSBudWxsCiAgICAgICAgICAgICYmIGdpdmVuLmdl\ndEZsYWcoQ29sdW1uLkZMQUdfUEtfSk9JTikgJiYgY2xzICE9IG51bGwpIHsK\nICAgICAgICAgICAgQ29sdW1uW10gcGtzID0gY2xzLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CiAgICAgICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEpCiAg\nICAgICAgICAgICAgICBuYW1lID0gcGtzWzBdLmdldElkZW50aWZpZXIoKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGlmIHdlIGNhbid0IGFkYXB0LCB0aGVu\nIHRoZSB1c2VyIG11c3QgYXQgbGVhc3QgZ2l2ZSBhIGNvbHVtbiBuYW1lCiAg\nICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwobmFtZSkgJiYgIWFkYXB0\nICYmICFmaWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1uby1ma2NvbC1uYW1lIiwKICAg\nICAgICAgICAgICAgIGNvbnRleHQpKTsKCiAgICAgICAgLy8gY2hlY2sgdG8g\nc2VlIGlmIHRoZSBjb2x1bW4gaXNuJ3QgaW4gdGhlIGV4cGVjdGVkIHRhYmxl\nOyBpdCBtaWdodAogICAgICAgIC8vIGJlIGFuIGludmVyc2Ugam9pbiBvciBh\nIGpvaW4gdG8gYSBiYXNlIGNsYXNzIG9mIHRoZSB0YXJnZXQgdHlwZQogICAg\nICAgIFRhYmxlIGxvY2FsID0gdGFibGU7CiAgICAgICAgVGFibGUgZm9yZWln\nbiA9IHJlbC5nZXRUYWJsZSgpOwogICAgICAgIGJvb2xlYW4gZnVsbE5hbWUg\nPSBmYWxzZTsKICAgICAgICBib29sZWFuIGludmVyc2UgPSBmYWxzZTsKICAg\nICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwobmFtZSkpIHsKICAgICAg\nICAgICAgUXVhbGlmaWVkREJJZGVudGlmaWVyIHBhdGggPSBRdWFsaWZpZWRE\nQklkZW50aWZpZXIuZ2V0UGF0aChuYW1lKTsKICAgICAgICAgICAgaWYgKCFE\nQklkZW50aWZpZXIuaXNOdWxsKHBhdGguZ2V0T2JqZWN0VGFibGVOYW1lKCkp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzRW1wdHko\ncGF0aC5nZXRPYmplY3RUYWJsZU5hbWUoKSkpCiAgICAgICAgICAgICAgICAg\nICAgbG9jYWwgPSBmb3JlaWduOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIGxvY2FsID0gZmluZFRhYmxlKGNvbnRleHQsIHBh\ndGguZ2V0T2JqZWN0VGFibGVOYW1lKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIGxvY2FsLCBmb3JlaWduLCBudWxsKTsKICAgICAgICAgICAgICAgIGZ1\nbGxOYW1lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG5hbWUgPSBwYXRoLmdl\ndElkZW50aWZpZXIoKS5nZXRVbnF1YWxpZmllZE5hbWUoKTsKCiAgICAgICAg\nICAgICAgICAvLyBpZiBpbnZlcnNlIGpvaW4sIHRoZW4gc3dhcCBsb2NhbCBh\nbmQgZm9yZWlnbiB0YWJsZXMKICAgICAgICAgICAgICAgIGlmIChsb2NhbCAh\nPSB0YWJsZSkgewogICAgICAgICAgICAgICAgICAgIGZvcmVpZ24gPSB0YWJs\nZTsKICAgICAgICAgICAgICAgICAgICBpbnZlcnNlID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBi\nb29sZWFuIGZvcmNlSW52ZXJzZSA9ICFmdWxsTmFtZSAmJiBfam9pbiA9PSBK\nT0lOX0lOVkVSU0U7CiAgICAgICAgaWYgKGZvcmNlSW52ZXJzZSkgewogICAg\nICAgICAgICBsb2NhbCA9IGZvcmVpZ247CiAgICAgICAgICAgIGZvcmVpZ24g\nPSB0YWJsZTsKICAgICAgICAgICAgaW52ZXJzZSA9IHRydWU7CiAgICAgICAg\nfQoKICAgICAgICAvLyBkZXRlcm1pbmUgdGFyZ2V0CiAgICAgICAgREJJZGVu\ndGlmaWVyIHRhcmdldE5hbWUgPSBnaXZlbi5nZXRUYXJnZXRJZGVudGlmaWVy\nKCk7CiAgICAgICAgT2JqZWN0IHRhcmdldCA9IG51bGw7CiAgICAgICAgVGFi\nbGUgdHRhYmxlID0gbnVsbDsKICAgICAgICBib29sZWFuIGNvbnN0YW50ID0g\nZmFsc2U7CiAgICAgICAgYm9vbGVhbiBmdWxsVGFyZ2V0ID0gZmFsc2U7CiAg\nICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwodGFyZ2V0TmFtZSkgJiYg\nZ2l2ZW4uZ2V0VGFyZ2V0RmllbGQoKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIENsYXNzTWFwcGluZyB0Y2xzID0gKGludmVyc2UpID8gY2xzIDogcmVsOwog\nICAgICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gZ2l2ZW4uZ2V0VGFyZ2V0\nRmllbGQoKTsKICAgICAgICAgICAgU3RyaW5nW10gbmFtZXMgPSBOb3JtYWxp\nemVyLnNwbGl0TmFtZShmaWVsZE5hbWUpOwogICAgICAgICAgICBmdWxsVGFy\nZ2V0ID0gbmFtZXMubGVuZ3RoID4gMTsKCiAgICAgICAgICAgIGlmIChuYW1l\ncy5sZW5ndGggPiAxICYmIFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZXNbMF0p\nKSB7CiAgICAgICAgICAgICAgICAvLyBhbGxvdyB1c2Ugb2YgJy4nIHdpdGhv\ndXQgcHJlZml4IHRvIG1lYW4gInVzZSBleHBlY3RlZCBsb2NhbAogICAgICAg\nICAgICAgICAgLy8gY2xzIjsgYnV0IGlmIHdlIGFscmVhZHkgaW52ZXJzZWQg\nbm8gbmVlZCB0byBzd2l0Y2ggYWdhaW4KICAgICAgICAgICAgICAgIGlmICgh\naW52ZXJzZSkKICAgICAgICAgICAgICAgICAgICB0Y2xzID0gY2xzOwogICAg\nICAgICAgICAgICAgZmllbGROYW1lID0gbmFtZXNbMV07CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAobmFtZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAg\nICAgLy8gbXVzdCBiZSBjbGFzcyArIGZpZWxkIG5hbWUKICAgICAgICAgICAg\nICAgIHRjbHMgPSBmaW5kQ2xhc3NNYXBwaW5nKGNvbnRleHQsIG5hbWVzWzBd\nLCBjbHMsIHJlbCk7CiAgICAgICAgICAgICAgICBmaWVsZE5hbWUgPSBuYW1l\nc1sxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGNscyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1i\nYWQtZmt0YXJnZXRjbHMiLCBjb250ZXh0LCBmaWVsZE5hbWUsIG5hbWUpKTsK\nCiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZCA9IHRjbHMuZ2V0Rmll\nbGRNYXBwaW5nKGZpZWxkTmFtZSk7CiAgICAgICAgICAgIGlmIChmaWVsZCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsg\nIi1iYWQtZmt0YXJnZXRmaWVsZCIsIG5ldyBPYmplY3RbXXsgY29udGV4dCwg\nZmllbGROYW1lLAogICAgICAgICAgICAgICAgICAgIG5hbWUsIHRjbHMgfSkp\nOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0Q29sdW1ucygpLmxlbmd0aCAh\nPSAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1m\na3RhcmdldGZpZWxkLWNvbHMiLCBjb250ZXh0LCBmaWVsZE5hbWUsIG5hbWUp\nKTsKICAgICAgICAgICAgdHRhYmxlID0gKGZpZWxkLmdldEpvaW5Gb3JlaWdu\nS2V5KCkgIT0gbnVsbCkgPyBmaWVsZC5nZXRUYWJsZSgpCiAgICAgICAgICAg\nICAgICA6IGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpLmdldFRhYmxlKCk7\nCiAgICAgICAgICAgIHRhcmdldE5hbWUgPSBmaWVsZC5nZXRDb2x1bW5zKClb\nMF0uZ2V0SWRlbnRpZmllcigpOwogICAgICAgIH0gZWxzZSBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwodGFyZ2V0TmFtZSkpIHsKICAgICAgICAgICAgU3Ry\naW5nIHRhcmdldE5hbWVTdHIgPSB0YXJnZXROYW1lLmdldE5hbWUoKTsKICAg\nICAgICAgICAgaWYgKHRhcmdldE5hbWVTdHIuY2hhckF0KDApID09ICdcJycp\nIHsKICAgICAgICAgICAgICAgIGNvbnN0YW50ID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIHRhcmdldCA9IHRhcmdldE5hbWVTdHIuc3Vic3RyaW5nKDEsIHRh\ncmdldE5hbWVTdHIubGVuZ3RoKCkgLSAxKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmICh0YXJnZXROYW1lU3RyLmNoYXJBdCgwKSA9PSAnLScKICAgICAgICAg\nICAgICAgIHx8IHRhcmdldE5hbWVTdHIuY2hhckF0KDApID09ICcuJwogICAg\nICAgICAgICAgICAgfHwgQ2hhcmFjdGVyLmlzRGlnaXQodGFyZ2V0TmFtZVN0\nci5jaGFyQXQoMCkpKSB7CiAgICAgICAgICAgICAgICBjb25zdGFudCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIGlmICh0YXJnZXROYW1lU3RyLmluZGV4T2YoJy4nKSA9PSAtMSkKICAgICAg\nICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gbmV3IEludGVnZXIodGFyZ2V0\nTmFtZVN0cik7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICB0YXJnZXQgPSBuZXcgRG91YmxlKHRhcmdldE5hbWVT\ndHIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiLWJhZC1ma2NvbnN0IiwgY29udGV4dCwgdGFyZ2V0TmFtZSwg\nbmFtZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ug\naWYgKCJudWxsIi5lcXVhbHNJZ25vcmVDYXNlKHRhcmdldE5hbWVTdHIpKQog\nICAgICAgICAgICAgICAgY29uc3RhbnQgPSB0cnVlOwogICAgICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgICAgIFF1YWxpZmllZERCSWRlbnRpZmllciBw\nYXRoID0gUXVhbGlmaWVkREJJZGVudGlmaWVyLmdldFBhdGgodGFyZ2V0TmFt\nZSk7IAogICAgICAgICAgICAgICAgZnVsbFRhcmdldCA9ICghREJJZGVudGlm\naWVyLmlzTnVsbChwYXRoLmdldE9iamVjdFRhYmxlTmFtZSgpKSk7CiAgICAg\nICAgICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwocGF0aC5nZXRP\nYmplY3RUYWJsZU5hbWUoKSkgJiYgCiAgICAgICAgICAgICAgICAgICAgREJJ\nZGVudGlmaWVyLmlzRW1wdHkocGF0aC5nZXRPYmplY3RUYWJsZU5hbWUoKSkp\nIHsKICAgICAgICAgICAgICAgICAgICAvLyBhbGxvdyB1c2Ugb2YgJy4nIHdp\ndGhvdXQgcHJlZml4IHRvIG1lYW4gInVzZSBleHBlY3RlZAogICAgICAgICAg\nICAgICAgICAgIC8vIGxvY2FsIHRhYmxlIiwgYnV0IGlnbm9yZSBpZiB3ZSdy\nZSBhbHJlYWR5IGludmVyc2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCFp\nbnZlcnNlKQogICAgICAgICAgICAgICAgICAgICAgICB0dGFibGUgPSBsb2Nh\nbDsKICAgICAgICAgICAgICAgICAgICB0YXJnZXROYW1lID0gcGF0aC5nZXRJ\nZGVudGlmaWVyKCkuZ2V0VW5xdWFsaWZpZWROYW1lKCk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHBhdGguZ2V0\nT2JqZWN0VGFibGVOYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgdHRh\nYmxlID0gZmluZFRhYmxlKGNvbnRleHQsIHBhdGguZ2V0T2JqZWN0VGFibGVO\nYW1lKCksIGZvcmVpZ24sIGxvY2FsLCAoaW52ZXJzZSkgPyBjbHMgOiByZWwp\nOwogICAgICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSBwYXRoLmdldElk\nZW50aWZpZXIoKS5nZXRVbnF1YWxpZmllZE5hbWUoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gdXNl\nIGV4cGxpY2l0IHRhcmdldCB0YWJsZSBpZiBhdmFpbGFibGUKICAgICAgICBp\nZiAodHRhYmxlID09IGxvY2FsICYmIGxvY2FsICE9IGZvcmVpZ24pIHsKICAg\nICAgICAgICAgLy8gc3dhcCwgdW5sZXNzIHVzZXIgZ2F2ZSBpbmNvbXBhdGli\nbGUgdGFibGUgaW4gY29sdW1uIG5hbWUKICAgICAgICAgICAgaWYgKGZ1bGxO\nYW1lKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1i\nYWQtZmt0YXJnZXQtaW52ZXJzZSIsIG5ldyBPYmplY3RbXXsgY29udGV4dCwg\nbmFtZSwKICAgICAgICAgICAgICAgICAgICBmb3JlaWduLCB0dGFibGUgfSkp\nOwogICAgICAgICAgICBsb2NhbCA9IGZvcmVpZ247CiAgICAgICAgICAgIGZv\ncmVpZ24gPSB0dGFibGU7CiAgICAgICAgfSBlbHNlIGlmICh0dGFibGUgIT0g\nbnVsbCkgewogICAgICAgICAgICAvLyB0dGFibGUgbWlnaHQgYmUgYSB0YWJs\nZSBvZiBhIGJhc2UgY2xhc3Mgb2YgdGhlIHRhcmdldAogICAgICAgICAgICBm\nb3JlaWduID0gdHRhYmxlOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sg\ndG8gc2VlIGlmIHdlIGludmVyc2VkOyBpZiB0aGlzIGlzIGEgc2FtZS10YWJs\nZSBqb2luLCB0aGVuCiAgICAgICAgLy8gY29uc2lkZXIgaXQgYW4gaW1wbGlj\naXQgaW52ZXJzZSBpZiB0aGUgdXNlciBpbmNsdWRlcyB0aGUgdGFibGUgbmFt\nZQogICAgICAgIC8vIGluIHRoZSBjb2x1bW4gbmFtZSwgYnV0IG5vdCBpbiB0\naGUgY29sdW1uIHRhcmdldCwgb3IgaWYgdGhlIHVzZXIKICAgICAgICAvLyBn\naXZlcyBubyBjb2x1bW4gbmFtZSBidXQgYSBmdWxsIHRhcmdldCBuYW1lCiAg\nICAgICAgaW52ZXJzZSA9IGludmVyc2UgfHwgbG9jYWwgIT0gdGFibGUgfHwg\nKGxvY2FsID09IGZvcmVpZ24KICAgICAgICAgICAgJiYgKChmdWxsTmFtZSAm\nJiAhZnVsbFRhcmdldCkgfHwgKERCSWRlbnRpZmllci5pc051bGwobmFtZSkg\nJiYgZnVsbFRhcmdldCkpKTsKICAgICAgICBpZiAoIWludmVyc2FibGUgJiYg\nIWNvbnN0YW50ICYmIGludmVyc2UpIHsKICAgICAgICAgICAgaWYgKGxvY2Fs\nID09IGZvcmVpZ24pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAg\nICAgKyAiLWJhZC1may1zZWxmLWludmVyc2UiLCBjb250ZXh0LCBsb2NhbCkp\nOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQocHJlZml4ICsgIi1iYWQtZmstaW52ZXJzZSIsCiAgICAgICAgICAg\nICAgICBjb250ZXh0LCBsb2NhbCwgdGFibGUpKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKERCSWRlbnRpZmllci5pc051bGwobmFtZSkgJiYgY29uc3RhbnQp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICsgIi1uby1ma2NvbC1uYW1l\nLWFkYXB0IiwgY29udGV4dCkpOwoKICAgICAgICBpZiAoREJJZGVudGlmaWVy\nLmlzTnVsbChuYW1lKSAmJiBEQklkZW50aWZpZXIuaXNOdWxsKHRhcmdldE5h\nbWUpKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIG5hbWUgb3IgdGFyZ2V0IGlz\nIHByb3ZpZGVkIGFuZCB0aGVyZSdzIG1vcmUgdGhhbiBvbmUgbGlrZWx5CiAg\nICAgICAgICAgIC8vIGpvaW4gcG9zc2liaWxpdHksIHRvbyBhbWJpZ3VvdXMK\nICAgICAgICAgICAgUHJpbWFyeUtleSBwayA9IGZvcmVpZ24uZ2V0UHJpbWFy\neUtleSgpOwogICAgICAgICAgICBpZiAoam9pbnMubGVuZ3RoICE9IDEgfHwg\ncGsgPT0gbnVsbCB8fCBway5nZXRDb2x1bW5zKCkubGVuZ3RoICE9IDEpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLW5vLWZrY29s\nLW5hbWUtYWRhcHQiLCBjb250ZXh0KSk7CgogICAgICAgICAgICAvLyBhc3N1\nbWUgdGFyZ2V0IGlzIHBrIGNvbHVtbgogICAgICAgICAgICB0YXJnZXROYW1l\nID0gcGsuZ2V0Q29sdW1ucygpWzBdLmdldElkZW50aWZpZXIoKTsKICAgICAg\nICB9IGVsc2UgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKG5hbWUpICYmIERC\nSWRlbnRpZmllci5pc051bGwodGFyZ2V0TmFtZSkpIHsKICAgICAgICAgICAg\nLy8gaWYgb25lIHByaW1hcnkga2V5IGNvbHVtbiB1c2UgaXQgZm9yIHRhcmdl\ndDsgaWYgbXVsdGlwbGUgam9pbnMKICAgICAgICAgICAgLy8gbG9vayBmb3Ig\nYSBmb3JlaWduIGNvbHVtbiB3aXRoIHNhbWUgbmFtZSBhcyBsb2NhbCBjb2x1\nbW4KICAgICAgICAgICAgUHJpbWFyeUtleSBwayA9IGZvcmVpZ24uZ2V0UHJp\nbWFyeUtleSgpOwogICAgICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09IDEg\nJiYgcGsgIT0gbnVsbCAmJiBway5nZXRDb2x1bW5zKCkubGVuZ3RoID09IDEp\nIHsKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSBway5nZXRDb2x1bW5z\nKClbMF0uZ2V0SWRlbnRpZmllcigpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGVsc2UgaWYgKGZvcmVpZ24uZ2V0Q29sdW1uKG5hbWUpICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSBuYW1lOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAg\nICAgICAgICAgICAgICAgICsgIi1uby1ma2NvbC10YXJnZXQtYWRhcHQiLCBj\nb250ZXh0LCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIGZpbmQgdGhlIHRhcmdldCBjb2x1bW4sIGFuZCBjcmVhdGUgdGVt\ncGxhdGUgZm9yIGxvY2FsIGNvbHVtbiBiYXNlZAogICAgICAgIC8vIG9uIGl0\nCiAgICAgICAgQ29sdW1uIHRtcGxhdGUgPSBuZXcgQ29sdW1uKCk7CiAgICAg\nICAgdG1wbGF0ZS5zZXRJZGVudGlmaWVyKG5hbWUpOwogICAgICAgIGlmICgh\nY29uc3RhbnQpIHsKICAgICAgICAgICAgQ29sdW1uIHRjb2wgPSBmb3JlaWdu\nLmdldENvbHVtbih0YXJnZXROYW1lKTsKICAgICAgICAgICAgaWYgKHRjb2wg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldChwcmVmaXggKyAiLWJhZC1ma3RhcmdldCIsCiAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjb250ZXh0LCB0YXJn\nZXROYW1lLCBuYW1lLCBmb3JlaWduIH0pKTsKCiAgICAgICAgICAgIGlmIChE\nQklkZW50aWZpZXIuaXNOdWxsKG5hbWUpKQogICAgICAgICAgICAgICAgdG1w\nbGF0ZS5zZXRJZGVudGlmaWVyKHRjb2wuZ2V0SWRlbnRpZmllcigpKTsKICAg\nICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZSh0Y29sLmdldEphdmFUeXBl\nKCkpOwogICAgICAgICAgICB0bXBsYXRlLnNldFR5cGUodGNvbC5nZXRUeXBl\nKCkpOwogICAgICAgICAgICB0bXBsYXRlLnNldFR5cGVOYW1lKHRjb2wuZ2V0\nVHlwZU5hbWUoKSk7CiAgICAgICAgICAgIHRtcGxhdGUuc2V0U2l6ZSh0Y29s\nLmdldFNpemUoKSk7CiAgICAgICAgICAgIHRtcGxhdGUuc2V0RGVjaW1hbERp\nZ2l0cyh0Y29sLmdldERlY2ltYWxEaWdpdHMoKSk7CiAgICAgICAgICAgIHRh\ncmdldCA9IHRjb2w7CiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFu\nY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHRtcGxhdGUuc2V0SmF2YVR5cGUo\nSmF2YVR5cGVzLlNUUklORyk7CiAgICAgICAgZWxzZSBpZiAodGFyZ2V0IGlu\nc3RhbmNlb2YgSW50ZWdlcikKICAgICAgICAgICAgdG1wbGF0ZS5zZXRKYXZh\nVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAgICBlbHNlIGlmICh0YXJnZXQg\naW5zdGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAgIHRtcGxhdGUuc2V0SmF2\nYVR5cGUoSmF2YVR5cGVzLkRPVUJMRSk7CgogICAgICAgIC8vIHBvcHVsYXRl\nIHRlbXBsYXRlLCBidXQgbGV0IHVzZXItZ2l2ZW4gbmFtZSBvdmVycmlkZSBk\nZWZhdWx0IG5hbWUKICAgICAgICBpZiAoZGVmICE9IG51bGwpCiAgICAgICAg\nICAgIGRlZi5wb3B1bGF0ZShsb2NhbCwgZm9yZWlnbiwgdG1wbGF0ZSwgdGFy\nZ2V0LCBpbnZlcnNlLCBpZHgsCiAgICAgICAgICAgICAgICBqb2lucy5sZW5n\ndGgpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChuYW1lKSkK\nICAgICAgICAgICAgdG1wbGF0ZS5zZXRJZGVudGlmaWVyKG5hbWUpOwoKICAg\nICAgICAvLyBjcmVhdGUgb3IgbWVyZ2UgbG9jYWwgY29sdW1uCiAgICAgICAg\nQ29sdW1uIGNvbCA9IG1lcmdlQ29sdW1uKGNvbnRleHQsIHByZWZpeCwgdG1w\nbGF0ZSwgdHJ1ZSwgZ2l2ZW4sIGxvY2FsLAogICAgICAgICAgICBhZGFwdCwg\nZmlsbCk7CgogICAgICAgIGpvaW5zW2lkeF1bMF0gPSBjb2w7CiAgICAgICAg\nam9pbnNbaWR4XVsxXSA9IHRhcmdldDsKICAgICAgICBpZiAoaW52ZXJzZSkK\nICAgICAgICAgICAgam9pbnNbaWR4XVsyXSA9IEJvb2xlYW4uVFJVRTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIHRhcmdldCBjbGFzcyBtYXBw\naW5nIGdpdmVuIHRoZSB1c2VyJ3MgY2xhc3MgbmFtZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gY29udGV4dCBmb3IgZXJyb3IgbWVzc2FnZXMKICAgICAqIEBw\nYXJhbSBjbHNOYW1lIGNsYXNzIG5hbWUgZ2l2ZW4gYnkgdXNlcgogICAgICog\nQHBhcmFtIGNscyBvcmlnaW5hbCBzb3VyY2UgbWFwcGluZwogICAgICogQHBh\ncmFtIHJlbCBvcmlnaW5hbCB0YXJnZXQgbWFwcGluZwogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBDbGFzc01hcHBpbmcgZmluZENsYXNzTWFwcGluZyhN\nZXRhRGF0YUNvbnRleHQgY29udGV4dCwKICAgICAgICBTdHJpbmcgY2xzTmFt\nZSwgQ2xhc3NNYXBwaW5nIGNscywgQ2xhc3NNYXBwaW5nIHJlbCkgewogICAg\nICAgIGlmIChpc0NsYXNzTWFwcGluZ05hbWUoY2xzTmFtZSwgY2xzKSkKICAg\nICAgICAgICAgcmV0dXJuIGNsczsKICAgICAgICBpZiAoaXNDbGFzc01hcHBp\nbmdOYW1lKGNsc05hbWUsIHJlbCkpCiAgICAgICAgICAgIHJldHVybiByZWw7\nCiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ0YXJnZXQtd3JvbmctY2xzIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAg\nIHsgY29udGV4dCwgY2xzTmFtZSwgY2xzLCByZWwgfSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIG5hbWUgbWF0\nY2hlcyB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBpc0NsYXNzTWFwcGluZ05hbWUoU3RyaW5nIG5hbWUs\nIENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAobmFtZS5l\ncXVhbHMoY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpCiAgICAg\nICAgICAgIHx8IG5hbWUuZXF1YWxzKFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKGNs\ncy5nZXREZXNjcmliZWRUeXBlKCkpKSkKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgcmV0dXJuIGlzQ2xhc3NNYXBwaW5nTmFtZShuYW1lLCBj\nbHMuZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldHMgaW50ZXJuYWwgY29sdW1uIGluZm9ybWF0aW9uIHRvIG1h\ndGNoIHRoZSBnaXZlbiBtYXBwZWQgY29sdW1ucy4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZm9yY2VKREJDVHlwZSB3aGV0aGVyIHRvIGZvcmNlIHRoZSBqZGJj\nLXR5cGUgb2YgdGhlIGNvbHVtbnMKICAgICAqIHRvIGJlIHNldCwgZXZlbiB3\naGVuIGl0IG1hdGNoZXMgdGhlIGRlZmF1bHQgZm9yIHRoZSBjb2x1bW5zJyBq\nYXZhIHR5cGUKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3luY0NvbHVt\nbnMoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIENvbHVtbltdIGNvbHMsCiAg\nICAgICAgYm9vbGVhbiBmb3JjZUpEQkNUeXBlKSB7CiAgICAgICAgaWYgKGNv\nbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBf\nY29scyA9IG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9jb2xz\nID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGNvbHMubGVuZ3RoKTsKICAgICAg\nICAgICAgQ29sdW1uIGNvbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb2wg\nPSBzeW5jQ29sdW1uKGNvbnRleHQsIGNvbHNbaV0sIGNvbHMubGVuZ3RoLAog\nICAgICAgICAgICAgICAgICAgIGZvcmNlSkRCQ1R5cGUsIGNvbHNbaV0uZ2V0\nVGFibGUoKSwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nc2V0Q29sdW1uRmxhZ3NGcm9tSU8oY29sLCBpKTsKICAgICAgICAgICAgICAg\nIF9jb2xzLmFkZChjb2wpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IEkvTyBmbGFncyBvbiB0aGUgY29sdW1u\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0Q29sdW1uRmxhZ3NGcm9t\nSU8oQ29sdW1uIGNvbCwgaW50IGkpIHsKICAgICAgICBpZiAoX2lvID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb2wuc2V0RmxhZyhD\nb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIV9pby5pc1VwZGF0YWJsZShpLCBm\nYWxzZSkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5T\nRVJUQUJMRSwgIV9pby5pc0luc2VydGFibGUoaSwgZmFsc2UpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldHMgaW50ZXJuYWwgaW5kZXggaW5mb3JtYXRp\nb24gdG8gbWF0Y2ggZ2l2ZW4gbWFwcGVkIGluZGV4LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBzeW5jSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRl\neHQsIEluZGV4IGlkeCkgewogICAgICAgIGlmIChpZHggPT0gbnVsbCkgewog\nICAgICAgICAgICBfaWR4ID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgX2NhbklkeCA9IHRydWU7CiAgICAgICAgX2lk\neCA9IG5ldyBJbmRleCgpOwogICAgICAgIF9pZHguc2V0SWRlbnRpZmllcihp\nZHguZ2V0SWRlbnRpZmllcigpKTsKICAgICAgICBfaWR4LnNldFVuaXF1ZShp\nZHguaXNVbmlxdWUoKSk7CiAgICAgICAgaWYgKGlkeC5nZXRDb2x1bW5zKCkg\nIT0gbnVsbCAmJiBpZHguZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDEpCiAgICAg\nICAgICAgIF9pZHguc2V0Q29sdW1ucyhpZHguZ2V0Q29sdW1ucygpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldHMgaW50ZXJuYWwgY29uc3RyYWludCBp\nbmZvcm1hdGlvbiB0byBtYXRjaCBnaXZlbiBtYXBwZWQgY29uc3RyYWludC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3luY1VuaXF1ZShNZXRhRGF0\nYUNvbnRleHQgY29udGV4dCwgVW5pcXVlIHVucSkgewogICAgICAgIGlmICh1\nbnEgPT0gbnVsbCkgewogICAgICAgICAgICBfdW5xID0gbnVsbDsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX2NhblVucSA9IHRy\ndWU7CiAgICAgICAgX3VucSA9IG5ldyBVbmlxdWUoKTsKICAgICAgICBfdW5x\nLnNldElkZW50aWZpZXIodW5xLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAg\nX3VucS5zZXREZWZlcnJlZCh1bnEuaXNEZWZlcnJlZCgpKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBTZXRzIGludGVybmFsIGNvbnN0cmFpbnQgYW5k\nIGNvbHVtbiBpbmZvcm1hdGlvbiB0byBtYXRjaCBnaXZlbiBtYXBwZWQKICAg\nICAqIGNvbnN0cmFpbnQuCiAgICAgKgogICAgICogQHBhcmFtIGxvY2FsIGRl\nZmF1bHQgbG9jYWwgdGFibGUKICAgICAqIEBwYXJhbSB0YXJnZXQgZGVmYXVs\ndCB0YXJnZXQgdGFibGUKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3lu\nY0ZvcmVpZ25LZXkoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIEZvcmVpZ25L\nZXkgZmssCiAgICAgICAgVGFibGUgbG9jYWwsIFRhYmxlIHRhcmdldCkgewog\nICAgICAgIGlmIChmayA9PSBudWxsKSB7CiAgICAgICAgICAgIF9mayA9IG51\nbGw7CiAgICAgICAgICAgIF9jb2xzID0gbnVsbDsKICAgICAgICAgICAgX2pv\naW4gPSBKT0lOX05PTkU7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCiAgICAgICAgaWYgKF9qb2luID09IEpPSU5fTk9ORSkKICAgICAgICAgICAg\nX2pvaW4gPSBKT0lOX0ZPUldBUkQ7CgogICAgICAgIGlmIChmay5pc0xvZ2lj\nYWwoKSkKICAgICAgICAgICAgX2ZrID0gbnVsbDsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgX2NhbkZLID0gdHJ1ZTsKICAgICAgICAgICAgX2ZrID0g\nbmV3IEZvcmVpZ25LZXkoKTsKICAgICAgICAgICAgX2ZrLnNldElkZW50aWZp\nZXIoZmsuZ2V0SWRlbnRpZmllcigpKTsKICAgICAgICAgICAgX2ZrLnNldERl\nbGV0ZUFjdGlvbihmay5nZXREZWxldGVBY3Rpb24oKSk7CiAgICAgICAgICAg\nIF9may5zZXRVcGRhdGVBY3Rpb24oZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwog\nICAgICAgICAgICBfZmsuc2V0RGVmZXJyZWQoZmsuaXNEZWZlcnJlZCgpKTsK\nICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBmay5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgQ29sdW1uW10gcGtDb2xzID0gZmsuZ2V0UHJpbWFy\neUtleUNvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBjY29scyA9IGZrLmdl\ndENvbnN0YW50Q29sdW1ucygpOwogICAgICAgIE9iamVjdFtdIGNzID0gZmsu\nZ2V0Q29uc3RhbnRzKCk7CiAgICAgICAgQ29sdW1uW10gY3BrQ29scyA9IGZr\nLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBPYmpl\nY3RbXSBjcGtzID0gZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50cygpOwoKICAg\nICAgICBpbnQgc2l6ZSA9IGNvbHMubGVuZ3RoICsgY2NvbHMubGVuZ3RoICsg\nY3BrQ29scy5sZW5ndGg7CiAgICAgICAgX2NvbHMgPSBuZXcgQXJyYXlMaXN0\nPENvbHVtbj4oc2l6ZSk7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgY29sID0gc3luY0NvbHVtbihjb250ZXh0LCBjb2xzW2ldLCBzaXpl\nLCBmYWxzZSwgbG9jYWwsCiAgICAgICAgICAgICAgICB0YXJnZXQsIHBrQ29s\nc1tpXSwgX2pvaW4gPT0gSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAgc2V0\nQ29sdW1uRmxhZ3NGcm9tSU8oY29sLCBpKTsKICAgICAgICAgICAgX2NvbHMu\nYWRkKGNvbCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdCBjb25zdGFudDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNjb2xzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGNvbnN0YW50ID0gKGNzW2ldID09IG51bGwpID8g\nTlVMTCA6IGNzW2ldOwogICAgICAgICAgICBjb2wgPSBzeW5jQ29sdW1uKGNv\nbnRleHQsIGNjb2xzW2ldLCBzaXplLCBmYWxzZSwgbG9jYWwsCiAgICAgICAg\nICAgICAgICB0YXJnZXQsIGNvbnN0YW50LCBfam9pbiA9PSBKT0lOX0lOVkVS\nU0UpOwogICAgICAgICAgICBzZXRDb2x1bW5GbGFnc0Zyb21JTyhjb2wsIGNv\nbHMubGVuZ3RoICsgaSk7CiAgICAgICAgICAgIF9jb2xzLmFkZChjb2wpOwog\nICAgICAgIH0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNwa0NvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3RhbnQgPSAoY3Brc1tp\nXSA9PSBudWxsKSA/IE5VTEwgOiBjcGtzW2ldOwogICAgICAgICAgICBfY29s\ncy5hZGQoc3luY0NvbHVtbihjb250ZXh0LCBjcGtDb2xzW2ldLCBzaXplLCBm\nYWxzZSwgdGFyZ2V0LAogICAgICAgICAgICAgICAgbG9jYWwsIGNvbnN0YW50\nLCBfam9pbiAhPSBKT0lOX0lOVkVSU0UpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBnaXZlbiBjb2x1\nbW4gd2l0aCB0aGUgcmF3IG1hcHBpbmcgaW5mb3JtYXRpb24KICAgICAqIHNl\ndCBjb3JyZWN0bHksIGFuZCB3aXRob3V0IHNldHRpbmdzIHRoYXQgbWF0Y2gg\nZGVmYXVsdHMuCiAgICAgKgogICAgICogQHBhcmFtIG51bSB0aGUgbnVtYmVy\nIG9mIGNvbHVtbnMgZm9yIHRoaXMgbWFwcGluZwogICAgICogQHBhcmFtIGZv\ncmNlSkRCQ1R5cGUgd2hldGhlciB0aGUgamRiYy10eXBlIG9mIHRoZSBjcmVh\ndGVkIGNvbHVtbgogICAgICogc2hvdWxkIGJlIHNldCwgZXZlbiBpZiBpdCBt\nYXRjaGVzIHRoZSBkZWZhdWx0CiAgICAgKiBmb3IgdGhlIGdpdmVuIGNvbHVt\nbidzIGphdmEgdHlwZQogICAgICogQHBhcmFtIGNvbFRhYmxlIGV4cGVjdGVk\nIHRhYmxlIGZvciB0aGUgY29sdW1uCiAgICAgKiBAcGFyYW0gdGFyZ2V0VGFi\nbGUgZXhwZWN0ZWQgdGFyZ2V0IHRhYmxlIGZvciBqb2luIGNvbHVtbgogICAg\nICogQHBhcmFtIHRhcmdldCB0YXJnZXQgY29sdW1uIG9yIG9iamVjdCBmb3Ig\nam9pbiBjb2x1bW47IGZvciBhCiAgICAgKiBjb25zdGFudCBudWxsIHRhcmdl\ndCwgdXNlIHtAbGluayAjTlVMTH0KICAgICAqIEBwYXJhbSBpbnZlcnNlIHdo\nZXRoZXIgam9pbiBjb2x1bW4gaXMgZm9yIGludmVyc2Ugam9pbgogICAgICov\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIENvbHVtbiBzeW5jQ29sdW1uKE1ldGFE\nYXRhQ29udGV4dCBjb250ZXh0LCBDb2x1bW4gY29sLAogICAgICAgIGludCBu\ndW0sIGJvb2xlYW4gZm9yY2VKREJDVHlwZSwgVGFibGUgY29sVGFibGUsIFRh\nYmxlIHRhcmdldFRhYmxlLAogICAgICAgIE9iamVjdCB0YXJnZXQsIGJvb2xl\nYW4gaW52ZXJzZSkgewogICAgICAgIC8vIHVzZSBmdWxsIG5hbWUgZm9yIGNv\nbHMgdGhhdCBhcmVuJ3QgaW4gdGhlIGV4cGVjdGVkIHRhYmxlLCBvciB0aGF0\nCiAgICAgICAgLy8gYXJlIGludmVyc2Ugam9pbnMKICAgICAgICBEQkRpY3Rp\nb25hcnkgZGljdCA9ICgoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0\nUmVwb3NpdG9yeSgpKS4KICAgICAgICAgICAgZ2V0REJEaWN0aW9uYXJ5KCk7\nCiAgICAgICAgQ29sdW1uIGNvcHkgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAg\naWYgKGNvbC5nZXRUYWJsZSgpICE9IGNvbFRhYmxlIHx8IGludmVyc2UpCiAg\nICAgICAgICAgIGNvcHkuc2V0SWRlbnRpZmllcihRdWFsaWZpZWREQklkZW50\naWZpZXIubmV3UGF0aChkaWN0LmdldEZ1bGxJZGVudGlmaWVyKGNvbC5nZXRU\nYWJsZSgpLCB0cnVlKSwKICAgICAgICAgICAgICAgIGNvbC5nZXRJZGVudGlm\naWVyKCkpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvcHkuc2V0SWRl\nbnRpZmllcihjb2wuZ2V0SWRlbnRpZmllcigpKTsKCiAgICAgICAgLy8gc2V0\nIHRhcmdldCBpZiBub3QgZGVmYXVsdAogICAgICAgIGlmICh0YXJnZXQgIT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAodGFyZ2V0ID09IE5VTEwpCiAgICAg\nICAgICAgICAgICBjb3B5LnNldFRhcmdldElkZW50aWZpZXIoREJJZGVudGlm\naWVyLm5ld0NvbHVtbigibnVsbCIpKTsKICAgICAgICAgICAgZWxzZSBpZiAo\ndGFyZ2V0IGluc3RhbmNlb2YgQ29sdW1uKSB7CiAgICAgICAgICAgICAgICBD\nb2x1bW4gdGNvbCA9IChDb2x1bW4pIHRhcmdldDsKICAgICAgICAgICAgICAg\nIGlmICgoIWludmVyc2UgJiYgdGNvbC5nZXRUYWJsZSgpICE9IHRhcmdldFRh\nYmxlKQogICAgICAgICAgICAgICAgICAgIHx8IChpbnZlcnNlICYmIHRjb2wu\nZ2V0VGFibGUoKSAhPSBjb2xUYWJsZSkpCiAgICAgICAgICAgICAgICAgICAg\nY29weS5zZXRUYXJnZXRJZGVudGlmaWVyKAogICAgICAgICAgICAgICAgICAg\nICAgICBRdWFsaWZpZWREQklkZW50aWZpZXIubmV3UGF0aChkaWN0LmdldEZ1\nbGxJZGVudGlmaWVyKHRjb2wuZ2V0VGFibGUoKSwgdHJ1ZSksCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRjb2wuZ2V0SWRlbnRpZmllcigpKSk7CiAgICAg\nICAgICAgICAgICBlbHNlIGlmICghZGVmYXVsdFRhcmdldChjb2wsIHRjb2ws\nIG51bSkpCiAgICAgICAgICAgICAgICAgICAgY29weS5zZXRUYXJnZXRJZGVu\ndGlmaWVyKHRjb2wuZ2V0SWRlbnRpZmllcigpKTsKICAgICAgICAgICAgfSBl\nbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBOdW1iZXIpCiAgICAgICAgICAg\nICAgICBjb3B5LnNldFRhcmdldElkZW50aWZpZXIoREJJZGVudGlmaWVyLm5l\nd0NvbnN0YW50KHRhcmdldC50b1N0cmluZygpKSk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGNvcHkuc2V0VGFyZ2V0SWRlbnRpZmllcihE\nQklkZW50aWZpZXIubmV3Q29uc3RhbnQoIiciICsgdGFyZ2V0ICsgIiciKSk7\nCiAgICAgICAgfSBlbHNlIGlmIChudW0gPiAxKQogICAgICAgICAgICBjb3B5\nLnNldFRhcmdldEZpZWxkKGNvbC5nZXRUYXJnZXRGaWVsZCgpKTsKCiAgICAg\nICAgaWYgKGNvbC5nZXRTaXplKCkgIT0gMCAmJiBjb2wuZ2V0U2l6ZSgpICE9\nIGRpY3QuY2hhcmFjdGVyQ29sdW1uU2l6ZQogICAgICAgICAgICAmJiAoY29s\nLmdldFNpemUoKSAhPSAtMSB8fCAhY29sLmlzTG9iKCkpKQogICAgICAgICAg\nICBjb3B5LnNldFNpemUoY29sLmdldFNpemUoKSk7CiAgICAgICAgaWYgKGNv\nbC5nZXREZWNpbWFsRGlnaXRzKCkgIT0gMCkKICAgICAgICAgICAgY29weS5z\nZXREZWNpbWFsRGlnaXRzKGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpOwogICAg\nICAgIGlmIChjb2wuZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwpCiAgICAg\nICAgICAgIGNvcHkuc2V0RGVmYXVsdFN0cmluZyhjb2wuZ2V0RGVmYXVsdFN0\ncmluZygpKTsKICAgICAgICBpZiAoY29sLmlzTm90TnVsbCgpICYmICFjb2wu\naXNQcmltYXJ5S2V5KCkKICAgICAgICAgICAgJiYgKCFpc1ByaW1pdGl2ZShj\nb2wuZ2V0SmF2YVR5cGUoKSkgfHwgaXNGb3JlaWduS2V5KGNvbCkpKQogICAg\nICAgICAgICBjb3B5LnNldE5vdE51bGwodHJ1ZSk7CgogICAgICAgIC8vIHNl\ndCB0eXBlIG5hbWUgaWYgbm90IGRlZmF1bHQKICAgICAgICBTdHJpbmcgdHlw\nZU5hbWUgPSBjb2wuZ2V0VHlwZU5hbWUoKTsKICAgICAgICBpZiAodHlwZU5h\nbWUgIT0gbnVsbCB8fCBjb3B5LmdldFNpemUoKSAhPSAwCiAgICAgICAgICAg\nIHx8IGNvcHkuZ2V0RGVjaW1hbERpZ2l0cygpICE9IDApIHsKICAgICAgICAg\nICAgLy8gaXMgdGhpcyB0aGUgZGljdCBkZWZhdWx0IHR5cGU/IGhhdmUgdG8g\nZW5zdXJlIGpkYmMtdHlwZSBzZXQKICAgICAgICAgICAgLy8gcHJpb3IgdG8g\nZmluZGluZyBkaWN0IGRlZmF1bHQKICAgICAgICAgICAgY29weS5zZXRUeXBl\nKGNvbC5nZXRUeXBlKCkpOwogICAgICAgICAgICBTdHJpbmcgZGVmTmFtZSA9\nIGRpY3QuZ2V0VHlwZU5hbWUoY29weSk7CiAgICAgICAgICAgIGNvcHkuc2V0\nVHlwZShUeXBlcy5PVEhFUik7CgogICAgICAgICAgICAvLyBjb3B5IHNob3Vs\nZCBub3QgaGF2ZSBzaXplIGluZm8gc2V0IGlmIGl0IGlzbid0IHVzZWQgaW4g\ndHlwZSBuYW1lCiAgICAgICAgICAgIGJvb2xlYW4gZGVmU2l6ZWQgPSBkZWZO\nYW1lLmluZGV4T2YoJygnKSAhPSAtMTsKICAgICAgICAgICAgaWYgKCFkZWZT\naXplZCkgewogICAgICAgICAgICAgICAgaWYgKGNvcHkuZ2V0U2l6ZSgpID4g\nMCkKICAgICAgICAgICAgICAgICAgICBjb3B5LnNldFNpemUoMCk7CiAgICAg\nICAgICAgICAgICBjb3B5LnNldERlY2ltYWxEaWdpdHMoMCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlTmFtZSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdG8gc3RyaXAgc2l6ZSBmb3Ig\nY29tcGFyaXNvbgogICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1lLmluZGV4\nT2YoJygnKSA9PSAtMSAmJiBkZWZTaXplZCkKICAgICAgICAgICAgICAgICAg\nICBkZWZOYW1lID0gZGVmTmFtZS5zdWJzdHJpbmcoMCwgZGVmTmFtZS5pbmRl\neE9mKCcoJykpOwogICAgICAgICAgICAgICAgaWYgKCF0eXBlTmFtZS5lcXVh\nbHNJZ25vcmVDYXNlKGRlZk5hbWUpKQogICAgICAgICAgICAgICAgICAgIGNv\ncHkuc2V0VHlwZU5hbWUodHlwZU5hbWUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBzZXQgamRiYy10eXBlIGlmIG5vdCBkZWZhdWx0\nIG9yIGlmIGZvcmNlZAogICAgICAgIGlmIChmb3JjZUpEQkNUeXBlCiAgICAg\nICAgICAgIHx8ICh0YXJnZXQgIT0gbnVsbCAmJiAhKHRhcmdldCBpbnN0YW5j\nZW9mIENvbHVtbikKICAgICAgICAgICAgJiYgY29sLmdldFR5cGUoKSAhPSBU\neXBlcy5WQVJDSEFSKQogICAgICAgICAgICB8fCBkaWN0LmdldEpEQkNUeXBl\nKGNvbC5nZXRKYXZhVHlwZSgpLCBmYWxzZSkgIT0gY29sLmdldFR5cGUoKSkK\nICAgICAgICAgICAgY29weS5zZXRUeXBlKGNvbC5nZXRUeXBlKCkpOwoKICAg\nICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKiogCiAgICAgKiBSZXR1\ncm4gd2hldGhlciB0aGUgZ2l2ZW4gY29sdW1uIGJlbG9uZ3MgdG8gYSBmb3Jl\naWduIGtleS4KICAgICAqLyAKICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4g\naXNGb3JlaWduS2V5KENvbHVtbiBjb2wpIAogICAgeyAgICAgICAKICAgICAg\nICBpZiAoY29sLmdldFRhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSBjb2wuZ2V0\nVGFibGUoKS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsrKSAKICAgICAgICAgICAgaWYgKGZr\nc1tpXS5jb250YWluc0NvbHVtbihjb2wpIAogICAgICAgICAgICAgICAgfHwg\nZmtzW2ldLmNvbnRhaW5zQ29uc3RhbnRDb2x1bW4oY29sKSkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiB0\neXBlIGNvZGUgcmVwcmVzZW50cyBhIHByaW1pdGl2ZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc1ByaW1pdGl2ZShpbnQgdHlwZSkg\newogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHRhcmdldCBjb2x1bW4gbWF0\nY2hlcyB0aGUgZGVmYXVsdC4KICAgICAqIElmIHRoZXJlIGlzIG9ubHkgb25l\nIGNvbHVtbiBpbnZvbHZlZCBpbiB0aGUgam9pbiBhbmQgaXQgbGlua3MgdG8g\ndGhlCiAgICAgKiBzaW5nbGUgdGFyZ2V0IHRhYmxlIHBrIGNvbHVtbiwgb3Ig\naWYgdGhlIGNvbHVtbiBuYW1lIGlzIHRoZSBzYW1lIGFzCiAgICAgKiB0aGUg\ndGFyZ2V0IGNvbHVtbiBuYW1lLCB0aGVuIHRoZSB0YXJnZXQgaXMgdGhlIGRl\nZmF1bHQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gZGVm\nYXVsdFRhcmdldChDb2x1bW4gY29sLCBDb2x1bW4gdGFyZ2V0Q29sLAogICAg\nICAgIGludCBudW0pIHsKICAgICAgICBpZiAoY29sLmdldElkZW50aWZpZXIo\nKS5lcXVhbHModGFyZ2V0Q29sLmdldElkZW50aWZpZXIoKSkpCiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChudW0gPiAxKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFByaW1hcnlLZXkgcGsgPSB0\nYXJnZXRDb2wuZ2V0VGFibGUoKS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAg\naWYgKHBrID09IG51bGwgfHwgcGsuZ2V0Q29sdW1ucygpLmxlbmd0aCAhPSAx\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRh\ncmdldENvbCA9PSBway5nZXRDb2x1bW5zKClbMF07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTdXBwbGllcyBkZWZhdWx0IHRhYmxlIGluZm9ybWF0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFjZSBUYWJsZURlZmF1\nbHRzIHsKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBkZWZh\ndWx0IHRhYmxlIG5hbWUuCiAgICAgICAgICogQGRlcHJlY2F0ZWQKICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgU3RyaW5nIGdldChTY2hlbWEgc2NoZW1h\nKTsKICAgICAgICBwdWJsaWMgREJJZGVudGlmaWVyIGdldElkZW50aWZpZXIo\nU2NoZW1hIHNjaGVtYSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwbGll\ncyBkZWZhdWx0IGZvcmVpZ24ga2V5IGluZm9ybWF0aW9uLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGludGVyZmFjZSBGb3JlaWduS2V5RGVmYXVsdHMg\newoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBkZWZhdWx0IGZv\ncmVpZ24ga2V5IGZvciB0aGUgZ2l2ZW4gdGFibGVzLCBvciBudWxsIHRvCiAg\nICAgICAgICogY3JlYXRlIGEgbG9naWNhbCBmb3JlaWduIGtleSBvbmx5LiBE\nbyBub3QgZmlsbCBpbiB0aGUgY29sdW1ucyBvZgogICAgICAgICAqIHRoZSBm\nb3JlaWduIGtleSwgb25seSBhdHRyaWJ1dGVzIGxpa2UgaXRzIG5hbWUsIGRl\nbGV0ZSBhY3Rpb24sIGV0Yy4KICAgICAgICAgKiBEbyBub3QgYWRkIHRoZSBm\nb3JlaWduIGtleSB0byB0aGUgdGFibGUuCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIEZvcmVpZ25LZXkgZ2V0KFRhYmxlIGxvY2FsLCBUYWJsZSBmb3Jl\naWduLCBib29sZWFuIGludmVyc2UpOwoKICAgICAgICAvKioKICAgICAgICAg\nKiBQb3B1bGF0ZSB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgY29sdW1uIHdpdGgg\nZGVmYXVsdHMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdGFyZ2V0\nIHRoZSB0YXJnZXQgY29sdW1uIG9yIGNvbnN0YW50IHZhbHVlCiAgICAgICAg\nICogQHBhcmFtIHBvcyB0aGUgaW5kZXggb2YgdGhpcyBjb2x1bW4gaW4gdGhl\nIGZvcmVpZ24ga2V5CiAgICAgICAgICogQHBhcmFtIGNvbHMgdGhlIG51bWJl\nciBvZiBjb2x1bW5zIGluIHRoZSBmb3JlaWduIGtleQogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyB2b2lkIHBvcHVsYXRlKFRhYmxlIGxvY2FsLCBUYWJs\nZSBmb3JlaWduLCBDb2x1bW4gY29sLAogICAgICAgICAgICBPYmplY3QgdGFy\nZ2V0LCBib29sZWFuIGludmVyc2UsIGludCBwb3MsIGludCBjb2xzKTsKCX0K\nfQo=\n","encoding":"base64"}

