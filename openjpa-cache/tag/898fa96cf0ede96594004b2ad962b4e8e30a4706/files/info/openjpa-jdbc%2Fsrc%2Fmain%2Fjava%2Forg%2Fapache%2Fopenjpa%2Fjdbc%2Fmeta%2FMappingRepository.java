{"sha":"61d348143b346f68380600fc9d40b2f185abd32d","node_id":"MDQ6QmxvYjIwNjM2NDo2MWQzNDgxNDNiMzQ2ZjY4MzgwNjAwZmM5ZDQwYjJmMTg1YWJkMzJk","size":61849,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/61d348143b346f68380600fc9d40b2f185abd32d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Q\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlw\nZXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJD\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQmxvYlZhbHVlSGFuZGxlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkJ5dGVB\ncnJheVZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuc3RyYXRzLkNoYXJBcnJheVN0cmVhbVZhbHVlSGFuZGxlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkNo\nYXJBcnJheVZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLkNsYXNzTmFtZURpc2NyaW1pbmF0b3JTdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3Ry\nYXRzLkNsb2JWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5FbGVtZW50RW1iZWRWYWx1ZUhhbmRsZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5F\nbWJlZEZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLnN0cmF0cy5FbWJlZGRlZENsYXNzU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5GbGF0Q2xh\nc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuc3RyYXRzLkZ1bGxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuSGFuZGxlckNvbGxlY3Rpb25U\nYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLnN0cmF0cy5IYW5kbGVyRmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkhhbmRsZXJI\nYW5kbGVyTWFwVGFibGVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuSGFuZGxlclJlbGF0aW9uTWFw\nVGFibGVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuSW1tdXRhYmxlVmFsdWVIYW5kbGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTG9iRmll\nbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuc3RyYXRzLk1heEVtYmVkZGVkQmxvYkZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5NYXhFbWJl\nZGRlZEJ5dGVBcnJheUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5NYXhFbWJlZGRlZENoYXJBcnJh\neUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5NYXhFbWJlZGRlZENsb2JGaWVsZFN0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTXVs\ndGlDb2x1bW5WZXJzaW9uU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy4KICAgICAgICBOYW5vUHJlY2lzaW9u\nVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUNsYXNzU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25l\nRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuTm9uZUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lVmVy\nc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuTnVtYmVyVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuT2JqZWN0SWRDbGFz\nc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuT2JqZWN0SWRWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5QcmltaXRpdmVGaWVsZFN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuCiAgICAgICAgUmVsYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZp\nZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5SZWxhdGlvbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRl\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0\ncy5SZWxhdGlvbkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlvbkhhbmRsZXJNYXBUYWJs\nZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5SZWxhdGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy4KICAgICAgICBSZWxh\ndGlvblJlbGF0aW9uTWFwVGFibGVGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3RhdGVDb21wYXJp\nc29uVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuU3RyaW5nRmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1YmNsYXNz\nSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1cGVyY2xhc3NEaXNjcmltaW5h\ndG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5TdXBlcmNsYXNzVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVGltZXN0YW1w\nVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuVW50eXBlZFBDVmFsdWVIYW5kbGVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVmFsdWVNYXBE\naXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNzU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdy\nb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGlj\ndGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5K\nb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNv\nbmYuQ29uZmlndXJhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkphdmFWZXJzaW9uczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk9yZGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247Cgov\nKioKICogUmVwb3NpdG9yeSBvZiBvYmplY3QvcmVsYXRpb25hbCBtYXBwaW5n\nIGluZm9ybWF0aW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVi\nbGljIGNsYXNzIE1hcHBpbmdSZXBvc2l0b3J5IGV4dGVuZHMgTWV0YURhdGFS\nZXBvc2l0b3J5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKE1hcHBp\nbmdSZXBvc2l0b3J5LmNsYXNzKTsKCiAgICBwcml2YXRlIHRyYW5zaWVudCBE\nQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2ll\nbnQgTWFwcGluZ0RlZmF1bHRzIF9kZWZhdWx0cyA9IG51bGw7CiAgICAKICAg\nIC8vIG9iamVjdC0+cXVlcnlyZXN1bHRtYXBwaW5nCiAgICBwcml2YXRlIE1h\ncDxPYmplY3QsIFF1ZXJ5UmVzdWx0TWFwcGluZz4gX3Jlc3VsdHMgPSBuZXcg\nSGFzaE1hcDxPYmplY3QsIFF1ZXJ5UmVzdWx0TWFwcGluZz4oKTsgCiAgICBw\ncml2YXRlIFNjaGVtYUdyb3VwIF9zY2hlbWEgPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJhdGVneUluc3RhbGxlciBfaW5zdGFsbGVyID0gbnVsbDsKCiAgICAv\nKioKICAgICAqIERlZmF1bHQgY29uc3RydWN0b3IuICBDb25maWd1cmUgdmlh\nIAogICAgICoge0BsaW5rIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5D\nb25maWd1cmFibGV9LgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ1JlcG9z\naXRvcnkoKSB7CiAgICAgICAgc2V0VmFsaWRhdGUoVkFMSURBVEVfTUFQUElO\nRywgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW50IGFj\nY2VzcyB0byBkaWN0aW9uYXJ5IGZvciBtYXBwaW5ncy4KICAgICAqLwogICAg\ncHVibGljIERCRGljdGlvbmFyeSBnZXREQkRpY3Rpb25hcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9kaWN0OwogICAgfQoKICAgIC8qKgogICAgICogTWFwcGlu\nZyBkZWZhdWx0cy4KICAgICAqLwogICAgcHVibGljIE1hcHBpbmdEZWZhdWx0\ncyBnZXRNYXBwaW5nRGVmYXVsdHMoKSB7CiAgICAgICAgcmV0dXJuIF9kZWZh\ndWx0czsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcHBpbmcgZGVmYXVsdC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWFwcGluZ0RlZmF1bHRzKE1h\ncHBpbmdEZWZhdWx0cyBkZWZhdWx0cykgewogICAgICAgIF9kZWZhdWx0cyA9\nIGRlZmF1bHRzOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50YXRp\nb24gb2YgdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqLwogICAgcHVibGlj\nIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3VwKCkgewogICAgICAgIGlmIChf\nbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgICAgIGlmIChfc2NoZW1hID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgX3NjaGVtYSA9ICgoSkRCQ0NvbmZpZ3VyYXRpb24pIGdl\ndENvbmZpZ3VyYXRpb24oKSkuZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCku\ncmVhZFNjaGVtYSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9zY2hlbWE7\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBp\nZiAoX3NjaGVtYSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3NjaGVtYSA9\nICgoSkRCQ0NvbmZpZ3VyYXRpb24pIGdldENvbmZpZ3VyYXRpb24oKSkuZ2V0\nU2NoZW1hRmFjdG9yeUluc3RhbmNlKCkucmVhZFNjaGVtYSgpOwogICAgICAg\nICAgICByZXR1cm4gX3NjaGVtYTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXByZXNlbnRhdGlvbiBvZiB0aGUgZGF0YWJhc2Ugc2NoZW1h\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTY2hlbWFHcm91cChTY2hl\nbWFHcm91cCBzY2hlbWEpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICBfc2NoZW1hID0gc2NoZW1hOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgX3NjaGVtYSA9IHNjaGVtYTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0YWxscyBtYXBwaW5nIHN0cmF0\nZWdpZXMgb24gY29tcG9uZW50cy4KICAgICAqLwogICAgcHVibGljIFN0cmF0\nZWd5SW5zdGFsbGVyIGdldFN0cmF0ZWd5SW5zdGFsbGVyKCkgewogICAgICAg\nIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgICAgIGlmIChfaW5zdGFsbGVyID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgX2luc3RhbGxlciA9IG5ldyBSdW50aW1l\nU3RyYXRlZ3lJbnN0YWxsZXIodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gX2luc3RhbGxlcjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGlmIChfaW5zdGFsbGVyID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfaW5zdGFsbGVyID0gbmV3IFJ1bnRpbWVTdHJhdGVneUluc3Rh\nbGxlcih0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIF9pbnN0YWxsZXI7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFsbHMgbWFwcGlu\nZyBzdHJhdGVnaWVzIG9uIGNvbXBvbmVudHMuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFN0cmF0ZWd5SW5zdGFsbGVyKFN0cmF0ZWd5SW5zdGFsbGVy\nIGluc3RhbGxlcikgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIF9p\nbnN0YWxsZXIgPSBpbnN0YWxsZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBfaW5zdGFsbGVyID0gaW5zdGFsbGVyOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcXVl\ncnkgcmVzdWx0IG1hcHBpbmcgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgICov\nCiAgICBwdWJsaWMgUXVlcnlSZXN1bHRNYXBwaW5nIGdldFF1ZXJ5UmVzdWx0\nTWFwcGluZyhDbGFzczw/PiBjbHMsIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRl\nciBsb2FkZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgUXVlcnlS\nZXN1bHRNYXBwaW5nIHJlcyA9IG51bGw7CiAgICAgICAgaWYgKF9sb2NraW5n\nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICAgICAgcmVzID0gZ2V0UXVlcnlSZXN1bHRNYXBwaW5nSW50ZXJuYWwo\nY2xzLCBuYW1lLCBsb2FkZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgcmVzID0gZ2V0UXVlcnlSZXN1bHRNYXBwaW5n\nSW50ZXJuYWwoY2xzLCBuYW1lLCBsb2FkZXIpOwogICAgICAgIH0KICAgICAg\nICBpZiAocmVzID09IG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXF1ZXJ5\nLXJlcyIsIGNscywgbmFtZSkpOwogICAgICAgIHJldHVybiByZXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5lZCB0aGUgcXVlcnkgcmVzdWx0IG1h\ncHBpbmcgd2l0aCB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHJpdmF0\nZSBRdWVyeVJlc3VsdE1hcHBpbmcgZ2V0UXVlcnlSZXN1bHRNYXBwaW5nSW50\nZXJuYWwoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGNoZWNrIGNhY2hlCiAg\nICAgICAgT2JqZWN0IGtleSA9IGdldFF1ZXJ5UmVzdWx0S2V5KGNscywgbmFt\nZSk7CiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlcyA9IChRdWVyeVJl\nc3VsdE1hcHBpbmcpIF9yZXN1bHRzLmdldChrZXkpOwogICAgICAgIGlmIChy\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJlczsKCiAgICAgICAg\nLy8gZ2V0IG1ldGFkYXRhIGZvciBjbGFzcywgd2hpY2ggd2lsbCBmaW5kIHJl\nc3VsdHMgaW4gbWV0YWRhdGEgZmlsZQogICAgICAgIGlmIChjbHMgIT0gbnVs\nbCAmJiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgZmFsc2UpICE9IG51\nbGwpIHsKICAgICAgICAgICAgcmVzID0gKFF1ZXJ5UmVzdWx0TWFwcGluZykg\nX3Jlc3VsdHMuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQogICAg\nICAgIGlmICgoZ2V0U291cmNlTW9kZSgpICYgTU9ERV9RVUVSWSkgPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmIChjbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgY2xzID0gZ2V0TWV0YURhdGFGYWN0b3J5KCkK\nICAgICAgICAgICAgICAgICAgICAuZ2V0UmVzdWx0U2V0TWFwcGluZ1Njb3Bl\nKG5hbWUsIGVudkxvYWRlcik7CiAgICAgICAgLy8gbm90IGluIGNhY2hlOyBs\nb2FkCiAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCkubG9hZChjbHMsIE1P\nREVfTUVUQSB8IE1PREVfTUFQUElORywgZW52TG9hZGVyKTsKICAgICAgICBy\nZXR1cm4gKFF1ZXJ5UmVzdWx0TWFwcGluZykgX3Jlc3VsdHMuZ2V0KGtleSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGNhY2hlZCBxdWVy\neSByZXN1bHQgbWFwcGluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeVJl\nc3VsdE1hcHBpbmdbXSBnZXRRdWVyeVJlc3VsdE1hcHBpbmdzKCkgewogICAg\nICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQg\nKHRoaXMpIHsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gdmFsdWVzID0g\nX3Jlc3VsdHMudmFsdWVzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gKFF1\nZXJ5UmVzdWx0TWFwcGluZ1tdKSB2YWx1ZXMudG9BcnJheShuZXcgUXVlcnlS\nZXN1bHRNYXBwaW5nW3ZhbHVlcy5zaXplKCldKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gdmFsdWVz\nID0gX3Jlc3VsdHMudmFsdWVzKCk7CiAgICAgICAgICAgIHJldHVybiAoUXVl\ncnlSZXN1bHRNYXBwaW5nW10pIHZhbHVlcy50b0FycmF5KG5ldyBRdWVyeVJl\nc3VsdE1hcHBpbmdbdmFsdWVzLnNpemUoKV0pOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1ZXJ5IHJlc3Vs\ndCBtYXBwaW5nIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYKICAg\nICAqIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBRdWVyeVJlc3VsdE1hcHBp\nbmcgZ2V0Q2FjaGVkUXVlcnlSZXN1bHRNYXBwaW5nKENsYXNzIGNscywgU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gKFF1ZXJ5UmVzdWx0TWFwcGluZykgX3Jlc3VsdHMuZ2V0KGdldFF1ZXJ5\nUmVzdWx0S2V5KGNscywgbmFtZSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIChRdWVyeVJlc3VsdE1hcHBp\nbmcpIF9yZXN1bHRzLmdldChnZXRRdWVyeVJlc3VsdEtleShjbHMsIG5hbWUp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBxdWVy\neSByZXN1bHQgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5UmVz\ndWx0TWFwcGluZyBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLCBT\ndHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBhZGRRdWVyeVJlc3VsdE1hcHBpbmdJbnRlcm5hbChjbHMsIG5hbWUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\ncmV0dXJuIGFkZFF1ZXJ5UmVzdWx0TWFwcGluZ0ludGVybmFsKGNscywgbmFt\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgUXVlcnlSZXN1bHRN\nYXBwaW5nIGFkZFF1ZXJ5UmVzdWx0TWFwcGluZ0ludGVybmFsKENsYXNzIGNs\ncywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcg\ncmVzID0gbmV3IFF1ZXJ5UmVzdWx0TWFwcGluZyhuYW1lLCB0aGlzKTsKICAg\nICAgICByZXMuc2V0RGVmaW5pbmdUeXBlKGNscyk7CiAgICAgICAgX3Jlc3Vs\ndHMucHV0KGdldFF1ZXJ5UmVzdWx0S2V5KHJlcyksIHJlcyk7CiAgICAgICAg\ncmV0dXJuIHJlczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIHF1\nZXJ5IHJlc3VsdCBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZW1vdmVRdWVyeVJlc3VsdE1hcHBpbmcoUXVlcnlSZXN1bHRNYXBwaW5n\nIHJlcykgewogICAgICAgIGlmIChfbG9ja2luZykgewogICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBf\ncmVzdWx0cy5yZW1vdmUoZ2V0UXVlcnlSZXN1bHRLZXkocmVzKSkgIT0gbnVs\nbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIHJldHVybiBfcmVzdWx0cy5yZW1vdmUoZ2V0UXVlcnlSZXN1bHRLZXkocmVz\nKSkgIT0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYSBxdWVyeSByZXN1bHQgbWFwcGluZy4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKENsYXNzIGNs\ncywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX2xvY2tpbmcpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBfcmVzdWx0cy5yZW1v\ndmUoZ2V0UXVlcnlSZXN1bHRLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChu\nYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIHJldHVybiBfcmVzdWx0cy5yZW1vdmUoZ2V0UXVlcnlSZXN1\nbHRLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciB0aGUgZ2l2\nZW4gbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0\nIGdldFF1ZXJ5UmVzdWx0S2V5KFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMpIHsK\nICAgICAgICBpZiAocmVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIHJldHVybiBnZXRRdWVyeVJlc3VsdEtleShyZXMuZ2V0\nRGVmaW5pbmdUeXBlKCksIHJlcy5nZXROYW1lKCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgdW5pcXVlIGtleSBmb3IgdGhlIGdpdmVuIGNs\nYXNzIC8gbmFtZS4gVGhlIGNsYXNzIGFyZ3VtZW50CiAgICAgKiBjYW4gYmUg\nbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGdldFF1\nZXJ5UmVzdWx0S2V5KENsYXNzPD8+IGNscywgU3RyaW5nIG5hbWUpIHsKICAg\nICAgICByZXR1cm4gZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKTsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldE1hcHBpbmcoQ2xhc3M8Pz4gY2xz\nLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsCiAgICAgICAgYm9vbGVhbiBtdXN0\nRXhpc3QpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZykgc3VwZXIu\nZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICB9\nCgogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldE1hcHBpbmdzKCkgewog\nICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1cGVyLmdldE1ldGFE\nYXRhcygpOwogICAgfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0TWFw\ncGluZyhPYmplY3Qgb2lkLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsCiAgICAg\nICAgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICByZXR1cm4gKENsYXNz\nTWFwcGluZykgc3VwZXIuZ2V0TWV0YURhdGEob2lkLCBlbnZMb2FkZXIsIG11\nc3RFeGlzdCk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdl\ndEltcGxlbWVudG9yTWFwcGluZ3MoQ2xhc3M8Pz4gY2xzLAogICAgICAgIENs\nYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAg\nICAgICByZXR1cm4gKENsYXNzTWFwcGluZ1tdKSBzdXBlci5nZXRJbXBsZW1l\nbnRvck1ldGFEYXRhcyhjbHMsIGVudkxvYWRlciwKICAgICAgICAgICAgbXVz\ndEV4aXN0KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAg\nICAgICBpZiAoX2xvY2tpbmcpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgICAgICBzdXBlci5jbGVhcigpOwogICAg\nICAgICAgICAgICAgX3NjaGVtYSA9IG51bGw7CiAgICAgICAgICAgICAgICBf\ncmVzdWx0cy5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICAgICAgX3Nj\naGVtYSA9IG51bGw7CiAgICAgICAgICAgIF9yZXN1bHRzLmNsZWFyKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHByZXBhcmVNYXBw\naW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIC8vIG1ha2Ugc3Vy\nZSBzdXBlcmNsYXNzIHJlc29sdmVkIGZpcnN0OyByZXNvbHZpbmcgc3VwZXJj\nbGFzcyBtYXkgaGF2ZQogICAgICAgIC8vIHJlc29sdmVkIHRoaXMgbWFwcGlu\nZwogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGlu\nZykgbWV0YTsKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5n\nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsICYmIChtYXBwaW5nLmdldFJlc29sdmUoKSAmIE1PREVfTUFQUElORykg\nIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIAogICAgICAgIC8v\nIGlmIHRoaXMgbWFwcGluZyBpcyBub3QgZm9yIGEgbWFuYWdlZCBpbnRlcmZh\nY2UsIGVuc3VyZSB0aGF0IGlmIAogICAgICAgIC8vIHdlIGhhdmUgYW4gaW5o\nZXJpdGFuY2UgaGllcmFyY2h5IHRoZXJlIGlzIGEgZGVmYXVsdCBzdHJhdGVn\neQogICAgICAgIC8vIGFwcGxpZWQgdG8gdGhlIHJvb3QgY2xhc3MKICAgICAg\nICBpZiAoIW1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJmYWNl\nKCkgJiYKICAgICAgICAgICAgIW1hcHBpbmcuaXNFbWJlZGRlZE9ubHkoKSkg\newogICAgICAgICAgICAvLyBpZiBhbiBpbmhlcml0YW5jZSBzdHJhdGVneSBo\nYXMgbm90IGJlZW4gc2V0IG9uIHRoaXMgbWFwcGluZwogICAgICAgICAgICAv\nLyBkZXRlcm1pbmUgaWYgbmVlZHMgb25lIGFuZCBpZiBzbywgc2V0IGl0CiAg\nICAgICAgICAgIGlmICghaGFzSW5oZXJpdGFuY2VTdHJhdGVneShtYXBwaW5n\nKSkgewogICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2VNYXBwaW5n\nID0gZmluZEJhc2VDbGFzc01hcHBpbmcobWFwcGluZyk7IAogICAgICAgICAg\nICAgICAgaWYgKGJhc2VNYXBwaW5nICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgc2V0RGVmYXVsdEluaGVyaXRhbmNlU3RyYXRlZ3koYmFzZU1hcHBp\nbmcpOwogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgfQoKICAg\nICAgICAvLyBkZWZpbmUgc3VwZXJjbGFzcyBmaWVsZHMgYWZ0ZXIgbWFwcGlu\nZyBjbGFzcywgc28gd2UgY2FuIHRlbGwgd2hldGhlcgogICAgICAgIC8vIHRo\nZSBjbGFzcyBpcyBtYXBwZWQgYW5kIG5lZWRzIHRvIHJlZGVmaW5lIGFic3Ry\nYWN0IHN1cGVyY2xhc3MgZmllbGRzCiAgICAgICAgZ2V0U3RyYXRlZ3lJbnN0\nYWxsZXIoKS5pbnN0YWxsU3RyYXRlZ3kobWFwcGluZyk7CiAgICAgICAgbWFw\ncGluZy5kZWZpbmVTdXBlcmNsYXNzRmllbGRzKG1hcHBpbmcuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkKICAgICAgICAgICAgPT0gbnVsbCk7\nCgogICAgICAgIC8vIHJlc29sdmUgZXZlcnl0aGluZyB0aGF0IGRvZXNuJ3Qg\naW52b2x2ZSByZWxhdGlvbnMgdG8gYWxsb3cgcmVsYXRpb24KICAgICAgICAv\nLyBtYXBwaW5ncyB0byB1c2UgdGhlIG90aGVycyBhcyBqb2luYWJsZXMKICAg\nICAgICBtYXBwaW5nLnJlc29sdmVOb25SZWxhdGlvbk1hcHBpbmdzKCk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3Q2xhc3NNZXRh\nRGF0YShDbGFzczw/PiB0eXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFz\nc01hcHBpbmcodHlwZSwgdGhpcyk7CiAgICB9CgogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGFbXSBuZXdDbGFzc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0\naCkgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNYXBwaW5nW2xlbmd0aF07\nCiAgICB9CgogICAgcHJvdGVjdGVkIEZpZWxkTWV0YURhdGEgbmV3RmllbGRN\nZXRhRGF0YShTdHJpbmcgbmFtZSwgQ2xhc3M8Pz4gdHlwZSwKICAgICAgICBD\nbGFzc01ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVs\nZE1hcHBpbmcobmFtZSwgdHlwZSwgKENsYXNzTWFwcGluZykgb3duZXIpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhW10gbmV3RmllbGRN\nZXRhRGF0YUFycmF5KGludCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gbmV3\nIEZpZWxkTWFwcGluZ1tsZW5ndGhdOwogICAgfQoKICAgIHByb3RlY3RlZCBD\nbGFzc01ldGFEYXRhIG5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0YShWYWx1ZU1l\ndGFEYXRhIG93bmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBp\nbmcob3duZXIpOwogICAgfQoKICAgIHByb3RlY3RlZCBWYWx1ZU1ldGFEYXRh\nIG5ld1ZhbHVlTWV0YURhdGEoRmllbGRNZXRhRGF0YSBvd25lcikgewogICAg\nICAgIHJldHVybiBuZXcgVmFsdWVNYXBwaW5nSW1wbCgoRmllbGRNYXBwaW5n\nKSBvd25lcik7CiAgICB9CgogICAgcHJvdGVjdGVkIFNlcXVlbmNlTWV0YURh\ndGEgbmV3U2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkgewogICAgICAg\nIHJldHVybiBuZXcgU2VxdWVuY2VNYXBwaW5nKG5hbWUsIHRoaXMpOwogICAg\nfQoKICAgIHByb3RlY3RlZCBPcmRlciBuZXdWYWx1ZU9yZGVyKEZpZWxkTWV0\nYURhdGEgb3duZXIsIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBKREJDVmFsdWVPcmRlcigoRmllbGRNYXBwaW5nKSBvd25lciwgYXNjKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3UmVsYXRlZEZpZWxkT3Jk\nZXIoRmllbGRNZXRhRGF0YSBvd25lciwKICAgICAgICBGaWVsZE1ldGFEYXRh\nIHJlbCwgYm9vbGVhbiBhc2MpIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNS\nZWxhdGVkRmllbGRPcmRlcigoRmllbGRNYXBwaW5nKSBvd25lciwKICAgICAg\nICAgICAgKEZpZWxkTWFwcGluZykgcmVsLCBhc2MpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBPcmRlcltdIG5ld09yZGVyQXJyYXkoaW50IHNpemUpIHsKICAg\nICAgICByZXR1cm4gbmV3IEpEQkNPcmRlcltzaXplXTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSB2ZXJzaW9uIG1ldGFkYXRhIGZvciB0aGUgZ2l2\nZW4gY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uIG5ld1Zl\ncnNpb24oQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIHJldHVybiBuZXcg\nVmVyc2lvbihjbHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGRp\nc2NyaW1pbmF0b3IgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3IgbmV3RGlzY3JpbWlu\nYXRvcihDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBE\naXNjcmltaW5hdG9yKGNscyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgcmF3IG1hcHBpbmcgaW5mbyBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNYXBwaW5nSW5mbyBuZXdNYXBw\naW5nSW5mbyhDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgQ2xhc3NNYXBw\naW5nSW5mbyBpbmZvID0gbmV3IENsYXNzTWFwcGluZ0luZm8oKTsKICAgICAg\nICBpbmZvLnNldENsYXNzTmFtZShjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpLmdl\ndE5hbWUoKSk7CiAgICAgICAgcmV0dXJuIGluZm87CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcgaW5mbyBmb3IgdGhlIGdpdmVu\nIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmllbGRNYXBwaW5n\nSW5mbyBuZXdNYXBwaW5nSW5mbyhGaWVsZE1hcHBpbmcgZm0pIHsKICAgICAg\nICByZXR1cm4gbmV3IEZpZWxkTWFwcGluZ0luZm8oKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0aGUgZ2l2\nZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZU1hcHBp\nbmdJbmZvIG5ld01hcHBpbmdJbmZvKFZhbHVlTWFwcGluZyB2bSkgewogICAg\nICAgIHJldHVybiBuZXcgVmFsdWVNYXBwaW5nSW5mbygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8gZm9yIHRoZSBn\naXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25N\nYXBwaW5nSW5mbyBuZXdNYXBwaW5nSW5mbyhWZXJzaW9uIHZlcnNpb24pIHsK\nICAgICAgICByZXR1cm4gbmV3IFZlcnNpb25NYXBwaW5nSW5mbygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8gZm9y\nIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIERp\nc2NyaW1pbmF0b3JNYXBwaW5nSW5mbyBuZXdNYXBwaW5nSW5mbyhEaXNjcmlt\naW5hdG9yIGRpc2MpIHsKICAgICAgICByZXR1cm4gbmV3IERpc2NyaW1pbmF0\nb3JNYXBwaW5nSW5mbygpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFu\ndGlhdGUgdGhlIGdpdmVuIGNsYXNzJyBuYW1lZCBzdHJhdGVneSwgb3IgcmV0\ndXJuIG51bGwgaWYgbm8KICAgICAqIG5hbWVkIHN0cmF0ZWd5LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgQ2xhc3NTdHJhdGVneSBuYW1lZFN0cmF0ZWd5KENs\nYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGNscy5n\nZXRNYXBwaW5nSW5mbygpLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJu\nIGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVneShuYW1lLCBjbHMpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdHJhdGVneSBmb3IgdGhlIGdp\ndmVuIG5hbWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc1N0cmF0ZWd5\nIGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVneShTdHJpbmcgbmFtZSwKICAgICAg\nICBDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKE5vbmVD\nbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAg\ncmV0dXJuIE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAg\nICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRp\nZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENs\nYXNzTmFtZShuYW1lKTsKICAgICAgICBDbGFzczw/PiBzdHJhdCA9IG51bGw7\nCgogICAgICAgIC8vIGJhc2UgYW5kIHZlcnRpY2FsIHN0cmF0ZWdpZXMgdXNl\nIHNhbWUgYWxpYXM7IGRpZmZlcmVudGlhdGUgb24gam9pbgogICAgICAgIGlm\nIChGdWxsQ2xhc3NTdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAg\nICAgICAgIHN0cmF0ID0gRnVsbENsYXNzU3RyYXRlZ3kuY2xhc3M7CiAgICAg\nICAgZWxzZSBpZiAoRmxhdENsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5h\nbWUpKQogICAgICAgICAgICBzdHJhdCA9IEZsYXRDbGFzc1N0cmF0ZWd5LmNs\nYXNzOwogICAgICAgIGVsc2UgaWYgKFZlcnRpY2FsQ2xhc3NTdHJhdGVneS5B\nTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gVmVydGlj\nYWxDbGFzc1N0cmF0ZWd5LmNsYXNzOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChzdHJhdCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3RyYXQg\nPSBKYXZhVHlwZXMuY2xhc3NGb3JOYW1lKG5hbWUsIGNscywKICAgICAgICAg\nICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NM\nb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGFz\nc1N0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAgICAgICBDbGFzc1N0cmF0ZWd5\nIHN0cmF0ZWd5ID0gCiAgICAgICAgICAgICAgICAoQ2xhc3NTdHJhdGVneSkg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oc3RyYXQp\nKTsKICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFu\nY2Uoc3RyYXRlZ3ksIGdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAg\nICAgIHByb3BzKTsKICAgICAgICAgICAgcmV0dXJuIHN0cmF0ZWd5OwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChl\nIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikKICAgICAg\nICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUp\nLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1jbHMtc3RyYXRlZ3kiLAogICAg\nICAgICAgICAgICAgY2xzLCBuYW1lKSwgZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIGZpZWxkJ3Mg\nbmFtZWQgc3RyYXRlZ3ksIG9yIHJldHVybiBudWxsIGlmIG5vCiAgICAgKiBu\nYW1lZCBzdHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkU3Ry\nYXRlZ3kgbmFtZWRTdHJhdGVneShGaWVsZE1hcHBpbmcgZmllbGQsCiAgICAg\nICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICBTdHJpbmcg\nbmFtZSA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0U3RyYXRlZ3koKTsK\nICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgaWYgKE5vbmVGaWVsZFN0cmF0ZWd5LkFMSUFTLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVGaWVsZFN0cmF0\nZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENv\nbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFt\nZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBDbGFzczw/PiBjID0gSmF2YVR5cGVzLmNs\nYXNzRm9yTmFtZShuYW1lLCBmaWVsZCwKICAgICAgICAgICAgICAgIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAg\nIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKEZpZWxkU3Ry\nYXRlZ3kuY2xhc3MpKSk7CiAgICAgICAgICAgIGlmIChGaWVsZFN0cmF0ZWd5\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oYykpIHsKICAgICAgICAgICAgICAg\nIEZpZWxkU3RyYXRlZ3kgc3RyYXQgPSAoRmllbGRTdHJhdGVneSkKICAgICAg\nICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5z\ndGFuY2VBY3Rpb24oYykpOwogICAgICAgICAgICAgICAgQ29uZmlndXJhdGlv\nbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXQsIGdldENvbmZpZ3VyYXRpb24o\nKSwKICAgICAgICAgICAgICAgICAgICBwcm9wcyk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3RyYXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIG11c3QgYmUgbmFtZWQgaGFuZGxlcgogICAgICAgICAgICBpZiAoaW5zdGFs\nbEhhbmRsZXJzKSB7CiAgICAgICAgICAgICAgICBWYWx1ZUhhbmRsZXIgdmgg\nPSAoVmFsdWVIYW5kbGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0\nYW5jZUFjdGlvbihjKSk7CiAgICAgICAgICAgICAgICBDb25maWd1cmF0aW9u\ncy5jb25maWd1cmVJbnN0YW5jZSh2aCwgZ2V0Q29uZmlndXJhdGlvbigpLAog\nICAgICAgICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICAgICAgICAgIGZp\nZWxkLnNldEhhbmRsZXIodmgpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0\nYW5jZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAg\nICAgICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRF\neGNlcHRpb24oKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmllbGQtc3RyYXRlZ3kiLAogICAgICAg\nICAgICAgICAgZmllbGQsIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gZGlzY3JpbWlu\nYXRvcidzIG5hbWVkIHN0cmF0ZWd5LCBvciByZXR1cm4gbnVsbAogICAgICog\naWYgbm8gbmFtZWQgc3RyYXRlZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBE\naXNjcmltaW5hdG9yU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShEaXNjcmltaW5h\ndG9yIGRpc2NyaW0pIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGRpc2NyaW0u\nZ2V0TWFwcGluZ0luZm8oKS5nZXRTdHJhdGVneSgpOwogICAgICAgIGlmIChu\nYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAvLyBpZiB0aGVyZSBpcyBhIG5hbWVkIHN0cmF0ZWd5IHByZXNlbnQsIGRp\nc2NhcmQgaXQgaWYgaXQgbWF0Y2hlcwogICAgICAgIC8vIHRoZSBiYXNlIHN0\ncmF0ZWd5LCBzbyB0aGF0IHdlIHdvbid0IGNyZWF0ZSBhbiBpbmRlcGVuZGVu\ndCBpbnN0YW5jZQogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSBkaXNjcmlt\nLmdldENsYXNzTWFwcGluZygpOwogICAgICAgIHdoaWxlIChjbHMuZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAg\nICAgY2xzID0gY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nOwogICAgICAgIERpc2NyaW1pbmF0b3IgYmFzZSA9IGNscy5nZXREaXNjcmlt\naW5hdG9yKCk7CiAgICAgICAgaWYgKGJhc2UgIT0gZGlzY3JpbSAmJiBiYXNl\nLmdldFN0cmF0ZWd5KCkgIT0gbnVsbAogICAgICAgICAgICAmJiBuYW1lLmVx\ndWFscyhiYXNlLmdldFN0cmF0ZWd5KCkuZ2V0QWxpYXMoKSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICByZXR1cm4gaW5zdGFudGlhdGVE\naXNjcmltaW5hdG9yU3RyYXRlZ3kobmFtZSwgZGlzY3JpbSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gZGlzY3JpbWlu\nYXRvciBzdHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1p\nbmF0b3JTdHJhdGVneSBpbnN0YW50aWF0ZURpc2NyaW1pbmF0b3JTdHJhdGVn\neQogICAgICAgIChTdHJpbmcgbmFtZSwgRGlzY3JpbWluYXRvciBkaXNjcmlt\nKSB7CiAgICAgICAgaWYgKE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuQUxJ\nQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gTm9uZURpc2Ny\naW1pbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBTdHJp\nbmcgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5hbWUp\nOwogICAgICAgIG5hbWUgPSBDb25maWd1cmF0aW9ucy5nZXRDbGFzc05hbWUo\nbmFtZSk7CiAgICAgICAgQ2xhc3M8Pz4gc3RyYXQgPSBudWxsOwoKICAgICAg\nICBpZiAoQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0ZWd5LkFMSUFTLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBDbGFzc05hbWVEaXNj\ncmltaW5hdG9yU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoVmFs\ndWVNYXBEaXNjcmltaW5hdG9yU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICBzdHJhdCA9IFZhbHVlTWFwRGlzY3JpbWluYXRvclN0\ncmF0ZWd5LmNsYXNzOwogICAgICAgIGVsc2UgaWYgKFN1YmNsYXNzSm9pbkRp\nc2NyaW1pbmF0b3JTdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAg\nICAgICAgIHN0cmF0ID0gU3ViY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0\nZWd5LmNsYXNzOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoc3Ry\nYXQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0cmF0ID0gSmF2YVR5cGVz\nLmNsYXNzRm9yTmFtZShuYW1lLAogICAgICAgICAgICAgICAgICAgIGRpc2Ny\naW0uZ2V0Q2xhc3NNYXBwaW5nKCksCiAgICAgICAgICAgICAgICAgICAgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzY3JpbWluYXRvclN0cmF0\nZWd5LmNsYXNzKSkpOwogICAgICAgICAgICBEaXNjcmltaW5hdG9yU3RyYXRl\nZ3kgc3RyYXRlZ3kgPSAoRGlzY3JpbWluYXRvclN0cmF0ZWd5KQogICAgICAg\nICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rp\nb24oc3RyYXQpKTsKICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmln\ndXJlSW5zdGFuY2Uoc3RyYXRlZ3ksIGdldENvbmZpZ3VyYXRpb24oKSwKICAg\nICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICAgICAgcmV0dXJuIHN0cmF0\nZWd5OwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlv\nbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNl\ncHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kaXNjcmltLXN0\ncmF0ZWd5IiwKICAgICAgICAgICAgICAgIGRpc2NyaW0uZ2V0Q2xhc3NNYXBw\naW5nKCksIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVyc2lvbidzIG5hbWVkIHN0\ncmF0ZWd5LCBvciByZXR1cm4gbnVsbAogICAgICogaWYgbm8gbmFtZWQgc3Ry\nYXRlZ3kuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kg\nbmFtZWRTdHJhdGVneShWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICBTdHJp\nbmcgbmFtZSA9IHZlcnNpb24uZ2V0TWFwcGluZ0luZm8oKS5nZXRTdHJhdGVn\neSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIG5hbWVkIHN0\ncmF0ZWd5IHByZXNlbnQsIGRpc2NhcmQgaXQgaWYgaXQgbWF0Y2hlcwogICAg\nICAgIC8vIHRoZSBiYXNlIHN0cmF0ZWd5LCBzbyB0aGF0IHdlIHdvbid0IGNy\nZWF0ZSBhbiBpbmRlcGVuZGVudCBpbnN0YW5jZQogICAgICAgIENsYXNzTWFw\ncGluZyBjbHMgPSB2ZXJzaW9uLmdldENsYXNzTWFwcGluZygpOwogICAgICAg\nIHdoaWxlIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkg\nIT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xzLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIFZlcnNpb24gYmFzZSA9IGNs\ncy5nZXRWZXJzaW9uKCk7CiAgICAgICAgaWYgKGJhc2UgIT0gdmVyc2lvbiAm\nJiBiYXNlLmdldFN0cmF0ZWd5KCkgIT0gbnVsbAogICAgICAgICAgICAmJiBu\nYW1lLmVxdWFscyhiYXNlLmdldFN0cmF0ZWd5KCkuZ2V0QWxpYXMoKSkpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICByZXR1cm4gaW5zdGFu\ndGlhdGVWZXJzaW9uU3RyYXRlZ3kobmFtZSwgdmVyc2lvbik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVyc2lvbiBz\ndHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25TdHJhdGVn\neSBpbnN0YW50aWF0ZVZlcnNpb25TdHJhdGVneShTdHJpbmcgbmFtZSwKICAg\nICAgICBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICBpZiAoTm9uZVZlcnNp\nb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJl\ndHVybiBOb25lVmVyc2lvblN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAg\nICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRp\nZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENs\nYXNzTmFtZShuYW1lKTsKICAgICAgICBDbGFzczw/PiBzdHJhdCA9IG51bGw7\nCgogICAgICAgIGlmIChOdW1iZXJWZXJzaW9uU3RyYXRlZ3kuQUxJQVMuZXF1\nYWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IE51bWJlclZlcnNpb25T\ndHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlmIChNdWx0aUNvbHVtblZl\ncnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgCXN0\ncmF0ID0gTXVsdGlDb2x1bW5WZXJzaW9uU3RyYXRlZ3kuY2xhc3M7CiAgICAg\nICAgZWxzZSBpZiAoVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5LkFMSUFTLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBUaW1lc3RhbXBWZXJz\naW9uU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoTmFub1ByZWNp\nc2lvblRpbWVzdGFtcFZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFt\nZSkpCiAgICAgICAgICAgIHN0cmF0ID0gTmFub1ByZWNpc2lvblRpbWVzdGFt\ncFZlcnNpb25TdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlmIChTdGF0\nZUNvbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICBzdHJhdCA9IFN0YXRlQ29tcGFyaXNvblZlcnNpb25T\ndHJhdGVneS5jbGFzczsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgICAgICBzdHJhdCA9IEphdmFU\neXBlcy5jbGFzc0Zvck5hbWUobmFtZSwKICAgICAgICAgICAgICAgICAgICB2\nZXJzaW9uLmdldENsYXNzTWFwcGluZygpLAogICAgICAgICAgICAgICAgICAg\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb25TdHJhdGVn\neS5jbGFzcykpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC12ZXJzaW9uLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIHZl\ncnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCksIG5hbWUpLCBlKTsKICAgICAgICB9\nCgogICAgICAgIHJldHVybiBpbnN0YW50aWF0ZVZlcnNpb25TdHJhdGVneShz\ndHJhdCwgdmVyc2lvbiwgcHJvcHMpOwogICAgfQoKICAgIC8qKgogICAgICog\nSW5zdGFudGlhdGUgdGhlIGdpdmVuIHZlcnNpb24gc3RyYXRlZ3kuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kgaW5zdGFudGlhdGVW\nZXJzaW9uU3RyYXRlZ3koQ2xhc3M8Pz4gc3RyYXQsCiAgICAgICAgVmVyc2lv\nbiB2ZXJzaW9uLCBTdHJpbmcgcHJvcHMpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBWZXJzaW9uU3RyYXRlZ3kgc3RyYXRlZ3kgPSAoVmVyc2lvblN0\ncmF0ZWd5KQogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3SW5zdGFuY2VBY3Rpb24oc3RyYXQpKTsKICAgICAgICAgICAgQ29uZmln\ndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2Uoc3RyYXRlZ3ksIGdldENvbmZp\nZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIHByb3BzKTsKICAgICAgICAg\nICAgcmV0dXJuIHN0cmF0ZWd5OwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdl\nZEFjdGlvbkV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZp\nbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC12ZXJzaW9uLXN0cmF0ZWd5IiwKICAgICAgICAgICAgICAgIHZlcnNp\nb24uZ2V0Q2xhc3NNYXBwaW5nKCksIHN0cmF0ICsgIiIpLCBlKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1\nbHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gY2xhc3MuIERvZXMK\nICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgY3VycmVudCBzdHJh\ndGVneSwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NTdHJh\ndGVneSBkZWZhdWx0U3RyYXRlZ3koQ2xhc3NNYXBwaW5nIGNscykgewogICAg\nICAgIHJldHVybiBkZWZhdWx0U3RyYXRlZ3koY2xzLCBnZXRTdHJhdGVneUlu\nc3RhbGxlcigpLmlzQWRhcHRpbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZXRlcm1pbmUgdGhlIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0\naGUgZ2l2ZW4gY2xhc3MuIERvZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNj\nb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ2xhc3NTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koQ2xh\nc3NNYXBwaW5nIGNscywKICAgICAgICBib29sZWFuIGFkYXB0aW5nKSB7CiAg\nICAgICAgVmFsdWVNYXBwaW5nIGVtYmVkID0gY2xzLmdldEVtYmVkZGluZ01h\ncHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgIT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBzdXBlcmNsYXNzIG9mIGVtYmVkZGVkIGNsYXNzIGlzbid0IG1h\ncHBlZAogICAgICAgICAgICBpZiAoZW1iZWQuZ2V0VHlwZSgpICE9IGNscy5n\nZXREZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgIHx8IGVtYmVkLmdl\ndEZpZWxkTWFwcGluZygpLmdldFN0cmF0ZWd5KCkKICAgICAgICAgICAgICAg\nID09IE5vbmVGaWVsZFN0cmF0ZWd5LmdldEluc3RhbmNlKCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgaWYgKGVtYmVkLmdldFR5cGVDb2RlKCkgPT0gSmF2\nYVR5cGVzLk9JRCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0\nSWRDbGFzc1N0cmF0ZWd5KCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgRW1i\nZWRkZWRDbGFzc1N0cmF0ZWd5KCk7CiAgICAgICAgfQogICAgICAgIGlmIChj\nbHMuaXNFbWJlZGRlZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVD\nbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIE9iamVjdCBz\ndHJhdCA9IF9kZWZhdWx0cy5nZXRTdHJhdGVneShjbHMsIGFkYXB0aW5nKTsK\nICAgICAgICBpZiAoc3RyYXQgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAg\nICAgIHJldHVybiBpbnN0YW50aWF0ZUNsYXNzU3RyYXRlZ3koKFN0cmluZykg\nc3RyYXQsIGNscyk7CiAgICAgICAgaWYgKHN0cmF0ICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiAoQ2xhc3NTdHJhdGVneSkgc3RyYXQ7CiAgICAgICAg\nCiAgICAgICAgLy8gc2VlIGlmIHRoZXJlIGlzIGEgZGVjbGFyZWQgaGllcmFy\nY2h5IHN0cmF0ZWd5CiAgICAgICAgQ2xhc3NTdHJhdGVneSBoc3RyYXQgPSBu\ndWxsOwogICAgICAgIGZvciAoQ2xhc3NNYXBwaW5nIGJhc2UgPSBjbHM7IGJh\nc2UgIT0gbnVsbCAmJiBoc3RyYXQgPT0gbnVsbDspIHsKICAgICAgICAgICAg\naHN0cmF0ID0gaW5zdGFudGlhdGVDbGFzc1N0cmF0ZWd5KGJhc2UuZ2V0TWFw\ncGluZ0luZm8oKS4KICAgICAgICAgICAgICAgIGdldEhpZXJhcmNoeVN0cmF0\nZWd5KCksIGNscyk7CiAgICAgICAgICAgIGJhc2UgPSBiYXNlLmdldE1hcHBl\nZFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICB9CgogICAgICAgIC8v\nIHRoZSBmdWxsIHN0cmF0ZWd5IGFzIGFwcGxpZWQgdG8gYSBoaWVyYXJjaHkg\naXMgYQogICAgICAgIC8vIHRhYmxlLXBlci1jb25jcmV0ZS1jbGFzcyBzdHJh\ndGVneSwgc28gZG9uJ3QgbWFwIGFic3RyYWN0IHR5cGVzCiAgICAgICAgaWYg\nKGhzdHJhdCBpbnN0YW5jZW9mIEZ1bGxDbGFzc1N0cmF0ZWd5CiAgICAgICAg\nICAgICYmICFjbHMuaXNNYW5hZ2VkSW50ZXJmYWNlKCkKICAgICAgICAgICAg\nJiYgTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0RGVzY3JpYmVkVHlwZSgp\nLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVDbGFz\nc1N0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIHN1cCA9IGNscy5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbmV3IEZ1bGxDbGFzc1N0cmF0ZWd5KCk7CiAgICAgICAgaWYgKGhz\ndHJhdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gaHN0cmF0OwogICAg\nICAgIHJldHVybiBuZXcgRmxhdENsYXNzU3RyYXRlZ3koKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0\nbyB1c2UgZm9yIHRoZSBnaXZlbiBmaWVsZC4gRG9lcwogICAgICogbm90IHRh\na2UgaW50byBhY2NvdW50IHRoZSBuYW1lZCBvciBjdXJyZW50IHN0cmF0ZWd5\nLCBpZiBhbnkuIElmIGEKICAgICAqIG5vbi1udWxsIHN0cmF0ZWd5IGlzIHJl\ndHVybmVkLCB0aGlzIG1ldGhvZCBtYXkgYXMgYSBzaWRlIGVmZmVjdCBpbnN0\nYWxsCiAgICAgKiB2YWx1ZSBoYW5kbGVycyBvbiB0aGUgZmllbGQncyB2YWx1\nZSBtYXBwaW5ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkU3RyYXRl\nZ3kgZGVmYXVsdFN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCwKICAgICAg\nICBib29sZWFuIGluc3RhbGxIYW5kbGVycykgewogICAgICAgIHJldHVybiBk\nZWZhdWx0U3RyYXRlZ3koZmllbGQsIGluc3RhbGxIYW5kbGVycywKICAgICAg\nICAgICAgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0\ncmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGZpZWxkLiBEb2VzCiAgICAg\nKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIG5hbWVkIG9yIGN1cnJlbnQg\nc3RyYXRlZ3ksIGlmIGFueS4gSWYgYQogICAgICogbm9uLW51bGwgc3RyYXRl\nZ3kgaXMgcmV0dXJuZWQsIHRoaXMgbWV0aG9kIG1heSBhcyBhIHNpZGUgZWZm\nZWN0IGluc3RhbGwKICAgICAqIHZhbHVlIGhhbmRsZXJzIG9uIHRoZSBmaWVs\nZCdzIHZhbHVlIG1hcHBpbmdzLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmll\nbGRTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koRmllbGRNYXBwaW5nIGZpZWxk\nLAogICAgICAgIGJvb2xlYW4gaW5zdGFsbEhhbmRsZXJzLCBib29sZWFuIGFk\nYXB0aW5nKSB7CiAgICAgICAgLy8gbm90IHBlcnNpc3RlbnQ/CiAgICAgICAg\naWYgKGZpZWxkLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9QRVJTSVNURU5UCiAgICAgICAgICAgIHx8IGZpZWxkLmlzVmVyc2lv\nbigpKQogICAgICAgICAgICByZXR1cm4gTm9uZUZpZWxkU3RyYXRlZ3kuZ2V0\nSW5zdGFuY2UoKTsKICAgICAgICBpZiAoZmllbGQuZ2V0RGVmaW5pbmdNYXBw\naW5nKCkuZ2V0U3RyYXRlZ3koKSA9PQogICAgICAgICAgICBOb25lQ2xhc3NT\ndHJhdGVneS5nZXRJbnN0YW5jZSgpKQogICAgICAgICAgICByZXR1cm4gTm9u\nZUZpZWxkU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgLy8gY2hl\nY2sgZm9yIG5hbWVkIGhhbmRsZXIgZmlyc3QKICAgICAgICBWYWx1ZUhhbmRs\nZXIgaGFuZGxlciA9IG5hbWVkSGFuZGxlcihmaWVsZCk7CiAgICAgICAgaWYg\nKGhhbmRsZXIgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaW5zdGFsbEhh\nbmRsZXJzKQogICAgICAgICAgICAgICAgZmllbGQuc2V0SGFuZGxlcihoYW5k\nbGVyKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRTdHJh\ndGVneSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxkLmlzU2VyaWFs\naXplZCgpKSB7CiAgICAgICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJs\nb2JTaXplICE9IC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhF\nbWJlZGRlZEJsb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgLy8gY2hlY2sgZm9yIG1hcHBlZCBzdHJhdGVneQogICAg\nICAgICAgICBPYmplY3Qgc3RyYXQgPSBtYXBwZWRTdHJhdGVneShmaWVsZCwg\nZmllbGQuZ2V0VHlwZSgpLCBhZGFwdGluZyk7CiAgICAgICAgICAgIGlmIChz\ndHJhdCBpbnN0YW5jZW9mIEZpZWxkU3RyYXRlZ3kpCiAgICAgICAgICAgICAg\nICByZXR1cm4gKEZpZWxkU3RyYXRlZ3kpIHN0cmF0OwogICAgICAgICAgICBp\nZiAoc3RyYXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGluc3Rh\nbGxIYW5kbGVycykKICAgICAgICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5k\nbGVyKChWYWx1ZUhhbmRsZXIpIHN0cmF0KTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9yIGtub3duIGZpZWxk\nIHN0cmF0ZWdpZXMKICAgICAgICBpZiAoIWZpZWxkLmlzU2VyaWFsaXplZCgp\nICYmIChmaWVsZC5nZXRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAg\nICAgIHx8IGZpZWxkLmdldFR5cGUoKSA9PSBCeXRlW10uY2xhc3MpKSB7CiAg\nICAgICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXplICE9IC0x\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhFbWJlZGRlZEJ5dGVB\ncnJheUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9IGVsc2UgaWYgKCFmaWVs\nZC5pc1NlcmlhbGl6ZWQoKQogICAgICAgICAgICAmJiAoZmllbGQuZ2V0VHlw\nZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICB8fCBmaWVsZC5nZXRU\neXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpKSB7CiAgICAgICAgICAgIGlm\nIChfZGljdC5tYXhFbWJlZGRlZENsb2JTaXplICE9IC0xICYmIGlzQ2xvYihm\naWVsZCwgZmFsc2UpKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhF\nbWJlZGRlZENoYXJBcnJheUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9IGVs\nc2UgaWYgKCFmaWVsZC5pc1NlcmlhbGl6ZWQoKSkgewogICAgICAgICAgICBG\naWVsZFN0cmF0ZWd5IHN0cmF0ID0gZGVmYXVsdFR5cGVTdHJhdGVneShmaWVs\nZCwgaW5zdGFsbEhhbmRsZXJzLAogICAgICAgICAgICAgICAgYWRhcHRpbmcp\nOwogICAgICAgICAgICBpZiAoc3RyYXQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBzdHJhdDsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNr\nIGZvciBkZWZhdWx0IGhhbmRsZXIKICAgICAgICBoYW5kbGVyID0gZGVmYXVs\ndEhhbmRsZXIoZmllbGQsIGFkYXB0aW5nKTsKICAgICAgICBpZiAoaGFuZGxl\nciAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMp\nCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVyKGhhbmRsZXIpOwog\nICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJGaWVsZFN0cmF0ZWd5KCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0IHRvIGJsb2IKICAgICAg\nICBpZiAoaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAgICAgICAgIGlmIChnZXRM\nb2coKS5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBnZXRMb2co\nKS53YXJuKF9sb2MuZ2V0KCJuby1maWVsZC1zdHJhdGVneSIsIGZpZWxkKSk7\nCiAgICAgICAgICAgIGZpZWxkLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAgICAg\nICAgfQogICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXplID09\nIC0xKSB7CiAgICAgICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMpCiAgICAg\nICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVyKEJsb2JWYWx1ZUhhbmRsZXIu\nZ2V0SW5zdGFuY2UoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxl\nckZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5l\ndyBNYXhFbWJlZGRlZEJsb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ1aWx0LWluIHN0cmF0ZWd5IGZvciB0\naGUgZmllbGQncyB0eXBlLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBGaWVsZFN0cmF0ZWd5IGRlZmF1bHRUeXBlU3RyYXRlZ3ko\nRmllbGRNYXBwaW5nIGZpZWxkLAogICAgICAgIGJvb2xlYW4gaW5zdGFsbEhh\nbmRsZXJzLCBib29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgc3dpdGNoIChm\naWVsZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFByaW1pdGl2ZUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgaWYgKCFpc0Ns\nb2IoZmllbGQsIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ0ZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAgIGlm\nIChfZGljdC5tYXhFbWJlZGRlZENsb2JTaXplICE9IC0xKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgTWF4RW1iZWRkZWRDbG9iRmllbGRTdHJh\ndGVneSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmlz\nRW1iZWRkZWRQQygpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nRW1iZWRGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICBpZiAoZmll\nbGQuZ2V0VHlwZU1hcHBpbmcoKS5pc01hcHBlZCgpCiAgICAgICAgICAgICAg\nICAgICAgfHwgIXVzZVVudHlwZWRQQ0hhbmRsZXIoZmllbGQpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25GaWVsZFN0cmF0ZWd5\nKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNP\nTExFQ1RJT046CiAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9\nIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBW\nYWx1ZUhhbmRsZXIgZWhhbmRsZXIgPSBuYW1lZEhhbmRsZXIoZWxlbSk7CiAg\nICAgICAgICAgICAgICBpZiAoZWhhbmRsZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBlaGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKGVsZW0pOwog\nICAgICAgICAgICAgICAgaWYgKGVoYW5kbGVyICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXJDb2xsZWN0aW9uU3RyYXRlZ3ko\nZmllbGQsIGVoYW5kbGVyLCAKICAgICAgICAgICAgICAgICAgICAgICAgaW5z\ndGFsbEhhbmRsZXJzKTsKICAgICAgICAgICAgICAgIGlmIChlbGVtLmdldFR5\ncGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDCiAgICAgICAgICAgICAgICAgICAg\nJiYgIWVsZW0uaXNTZXJpYWxpemVkKCkgJiYgIWVsZW0uaXNFbWJlZGRlZFBD\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlSW52ZXJzZUtleU1h\ncHBpbmcoZmllbGQpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFJlbGF0aW9uQ29sbGVjdGlvbkludmVyc2VLZXlGaWVsZFN0cmF0ZWd5\nKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvbkNv\nbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcga2V5\nID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAgICAgICAgICAgVmFs\ndWVIYW5kbGVyIGtoYW5kbGVyID0gbmFtZWRIYW5kbGVyKGtleSk7CiAgICAg\nICAgICAgICAgICBpZiAoa2hhbmRsZXIgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBraGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKGtleSk7CiAgICAg\nICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIFZhbHVlSGFuZGxlciB2aGFu\nZGxlciA9IG5hbWVkSGFuZGxlcih2YWwpOwogICAgICAgICAgICAgICAgaWYg\nKHZoYW5kbGVyID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgdmhhbmRs\nZXIgPSBkZWZhdWx0SGFuZGxlcih2YWwpOwogICAgICAgICAgICAgICAgYm9v\nbGVhbiBrcmVsID0ga2hhbmRsZXIgPT0gbnVsbCAKICAgICAgICAgICAgICAg\nICAgICAmJiBrZXkuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAg\nICAgICAgICAgICAgICAgICAmJiAha2V5LmlzU2VyaWFsaXplZCgpICYmICFr\nZXkuaXNFbWJlZGRlZFBDKCk7CiAgICAgICAgICAgICAgICBib29sZWFuIHZy\nZWwgPSB2aGFuZGxlciA9PSBudWxsIAogICAgICAgICAgICAgICAgICAgICYm\nIHZhbC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQwogICAgICAgICAg\nICAgICAgICAgICYmICF2YWwuaXNTZXJpYWxpemVkKCkgJiYgIXZhbC5pc0Vt\nYmVkZGVkUEMoKTsKICAgICAgICAgICAgICAgIGlmICh2cmVsICYmIGtleS5n\nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIGlmICh1c2VJbnZlcnNlS2V5TWFwcGluZyhmaWVsZCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25NYXBJbnZlcnNl\nS2V5RmllbGRTdHJhdGVneSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3koKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vVE9ETzogaW4gSlBBIDIu\nMCBpZiBNYXBLZXlDbGFzcyB0eXBlIGlzIG5vdCBzcGVjaWZpZWQKICAgICAg\nICAgICAgICAgIC8vIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uIEluIE9wZW5K\ncGEgMS54LCB0aGUgbWFwIHdpbGwKICAgICAgICAgICAgICAgIC8vIGJlIHNl\ncmlhbGl6ZWQgdG8gYSBibG9iICh0aGUgbnVsbCB2YWx1ZSByZXR1cm5lZCBi\neQogICAgICAgICAgICAgICAgLy8gdGhpcyBtZXRob2Qgd2lsbCBsZWFkIHRv\nIGEgc3RyYXRlZ3kgdG8gc2VyaWFsaXplCiAgICAgICAgICAgICAgICAvLyB0\naGUgbWFwKS4KICAgICAgICAgICAgICAgIGlmICgha3JlbCAmJiBraGFuZGxl\nciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgaWYgKCF2cmVsICYmIHZoYW5kbGVyID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICByZXR1cm4g\naGFuZGxlck1hcFN0cmF0ZWd5KGZpZWxkLCBraGFuZGxlciwgdmhhbmRsZXIs\nIGtyZWwsCiAgICAgICAgICAgICAgICAgICAgdnJlbCwgaW5zdGFsbEhhbmRs\nZXJzKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5QVVRfU1RSRUFN\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlBVVF9SRUFERVI6CiAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IExvYkZpZWxkU3RyYXRlZ3koKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGNvbGxlY3Rpb24gc3RyYXRlZ3kgZm9yIHRo\nZSBnaXZlbiBlbGVtZW50IGhhbmRsZXIsIG9yIG51bGwKICAgICAqIGlmIG5v\nbmUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZFN0cmF0ZWd5IGhhbmRs\nZXJDb2xsZWN0aW9uU3RyYXRlZ3koRmllbGRNYXBwaW5nIGZpZWxkLCAKICAg\nICAgICBWYWx1ZUhhbmRsZXIgZWhhbmRsZXIsIGJvb2xlYW4gaW5zdGFsbEhh\nbmRsZXJzKSB7CiAgICAgICAgLy8gVE9ETzogSlBBIDIuMCBzaG91bGQgaWdu\nb3JlIHRoaXMgZmxhZyBhbmQgbm90IHRvIHNlcmlhbGl6ZQogICAgICAgIGlm\nIChnZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNl\nKCkKICAgICAgICAgICAgLmdldFN0b3JlTWFwQ29sbGVjdGlvbkluRW50aXR5\nQXNCbG9iKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChpbnN0YWxsSGFuZGxlcnMpCiAgICAgICAgICAgIGZpZWxkLmdldEVsZW1l\nbnRNYXBwaW5nKCkuc2V0SGFuZGxlcihlaGFuZGxlcik7CiAgICAgICAgcmV0\ndXJuIG5ldyBIYW5kbGVyQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtYXAgc3RyYXRl\nZ3kgZm9yIHRoZSBnaXZlbiBrZXkgYW5kIHZhbHVlIGhhbmRsZXJzIC8gcmVs\nYXRpb25zLAogICAgICogb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRmllbGRTdHJhdGVneSBoYW5kbGVyTWFwU3RyYXRlZ3koRmll\nbGRNYXBwaW5nIGZpZWxkLCAKICAgICAgICBWYWx1ZUhhbmRsZXIga2hhbmRs\nZXIsIFZhbHVlSGFuZGxlciB2aGFuZGxlciwgYm9vbGVhbiBrcmVsLCAKICAg\nICAgICBib29sZWFuIHZyZWwsICBib29sZWFuIGluc3RhbGxIYW5kbGVycykg\newogICAgICAgIC8vIFRPRE86IEpQQSAyLjAgc2hvdWxkIGlnbm9yZSB0aGlz\nIGZsYWcgYW5kIG5vdCB0byBzZXJpYWxpemUKICAgICAgICBpZiAoZ2V0Q29u\nZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpCiAgICAg\nICAgICAgIC5nZXRTdG9yZU1hcENvbGxlY3Rpb25JbkVudGl0eUFzQmxvYigp\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5zdGFs\nbEhhbmRsZXJzKSB7CiAgICAgICAgICAgIGZpZWxkLmdldEtleU1hcHBpbmco\nKS5zZXRIYW5kbGVyKGtoYW5kbGVyKTsKICAgICAgICAgICAgZmllbGQuZ2V0\nRWxlbWVudE1hcHBpbmcoKS5zZXRIYW5kbGVyKHZoYW5kbGVyKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKCFrcmVsICYmICF2cmVsKQogICAgICAgICAgICBy\nZXR1cm4gbmV3IEhhbmRsZXJIYW5kbGVyTWFwVGFibGVGaWVsZFN0cmF0ZWd5\nKCk7CiAgICAgICAgaWYgKCFrcmVsICYmIHZyZWwpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgSGFuZGxlclJlbGF0aW9uTWFwVGFibGVGaWVsZFN0cmF0ZWd5\nKCk7CiAgICAgICAgaWYgKGtyZWwgJiYgIXZyZWwpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgUmVsYXRpb25IYW5kbGVyTWFwVGFibGVGaWVsZFN0cmF0ZWd5\nKCk7CiAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlvblJlbGF0aW9uTWFwVGFi\nbGVGaWVsZFN0cmF0ZWd5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2Ug\naGludHMgaW4gbWFwcGluZyBkYXRhIHRvIGZpZ3VyZSBvdXQgd2hldGhlciB0\naGUgZ2l2ZW4gcmVsYXRpb24KICAgICAqIGZpZWxkIHNob3VsZCB1c2UgYW4g\naW52ZXJzZSBmb3JlaWduIGtleSBvciBhbiBhc3NvY2lhdGlvbiB0YWJsZSBt\nYXBwaW5nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gdXNlSW52ZXJz\nZUtleU1hcHBpbmcoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgRmll\nbGRNYXBwaW5nIG1hcHBlZCA9IGZpZWxkLmdldE1hcHBlZEJ5TWFwcGluZygp\nOwogICAgICAgIGlmIChtYXBwZWQgIT0gbnVsbCkgewogICAgICAgICAgICAv\nL2JpLS9NLTEvSm9pblRhYmxlID09PiBqb2luIHRhYmxlIHN0cmF0ZWd5CiAg\nICAgICAgICAgIGlmIChpc0JpTVRvMUpUKGZpZWxkKSkgCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChtYXBwZWQuZ2V0\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG1hcHBlZC5nZXRFbGVtZW50\nKCkuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1hcHBlZC1ieSIsIGZpZWxk\nLAogICAgICAgICAgICAgICAgbWFwcGVkKSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyB3aXRob3V0IGEgbWFwcGVkLWJ5LCB3ZSBoYXZlIHRvIGxvb2sgZm9y\nIGNsdWVzIGFzIHRvIHRoZSBtYXBwaW5nLgogICAgICAgIC8vIHdlIGFzc3Vt\nZSB0aGF0IGFueXRoaW5nIHdpdGggZWxlbWVudCBmb3JlaWduIGtleSBjb2x1\nbW5zIGJ1dCBubyBqb2luCiAgICAgICAgLy8gY29sdW1ucyBvciB0YWJsZSB1\nc2VzIGFuIGludmVyc2UgZm9yZWlnbiBrZXksIGFuZCBhbnl0aGluZyBlbHNl\nIHVzZXMKICAgICAgICAvLyBhbiBhc3NvY2lhdGlvbiB0YWJsZQogICAgICAg\nIEZpZWxkTWFwcGluZ0luZm8gaW5mbyA9IGZpZWxkLmdldE1hcHBpbmdJbmZv\nKCk7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpOwogICAgICAgIGJvb2xlYW4gdXNlSW52ZXJzZUtleU1h\ncHBpbmcgPSBEQklkZW50aWZpZXIuaXNOdWxsKGluZm8uZ2V0VGFibGVJZGVu\ndGlmaWVyKCkpICYmIGluZm8uZ2V0Q29sdW1ucygpLmlzRW1wdHkoKQogICAg\nICAgICAgICAmJiAhZWxlbS5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCku\naXNFbXB0eSgpOwogICAgICAgIAogICAgICAgIC8vIEpQQSAyLjA6IG5vbi1k\nZWZhdWx0IG1hcHBpbmc6IHVuaS0vMS1NL0pvaW5Db2x1bW4gPT0+IGZvcmVp\nZ24ga2V5IHN0cmF0ZWd5CiAgICAgICAgaWYgKGlzVW5pMVRvTUZLKGZpZWxk\nKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHVzZUludmVyc2VLZXlNYXBwaW5nOwogICAgfQogICAgICAg\nIAogICAgcHVibGljIGJvb2xlYW4gaXNOb25EZWZhdWx0TWFwcGluZ0FsbG93\nZWQoKSB7CiAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGdl\ndENvbmZpZ3VyYXRpb24oKTsKICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGFG\nYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS5pc05vbkRlZmF1bHRNYXBwaW5nQWxs\nb3dlZChjb25mKTsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gaXNV\nbmlNVG8xSlQoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGlz\nTm9uRGVmYXVsdE1hcHBpbmdBbGxvd2VkKCkgJiYgCiAgICAgICAgICAgIGZp\nZWxkLmdldEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEuTUFO\nWV9UT19PTkUgJiYKICAgICAgICAgICAgaGFzSm9pblRhYmxlKGZpZWxkKSAm\nJiAKICAgICAgICAgICAgIWlzQmlkaXJlY3Rpb25hbChmaWVsZCkpICB7CiAg\nICAgICAgICAgIGZpZWxkLmdldFZhbHVlTWFwcGluZygpLmdldFZhbHVlSW5m\nbygpLnNldENvbHVtbnMoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzVW5pMVRvMUpUKEZpZWxkTWFwcGluZyBm\naWVsZCkgewogICAgICAgIGlmIChpc05vbkRlZmF1bHRNYXBwaW5nQWxsb3dl\nZCgpICYmIAogICAgICAgICAgICBmaWVsZC5nZXRBc3NvY2lhdGlvblR5cGUo\nKSA9PSBGaWVsZE1ldGFEYXRhLk9ORV9UT19PTkUgJiYgCiAgICAgICAgICAg\nIGhhc0pvaW5UYWJsZShmaWVsZCkgJiYgCiAgICAgICAgICAgICFpc0JpZGly\nZWN0aW9uYWwoZmllbGQpKSB7CiAgICAgICAgICAgIGZpZWxkLmdldFZhbHVl\nTWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoZmllbGQuZ2V0\nRWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkp\nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzQmkx\nVG8xSlQoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGlzTm9u\nRGVmYXVsdE1hcHBpbmdBbGxvd2VkKCkgJiYgCiAgICAgICAgICAgIGZpZWxk\nLmdldEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEuT05FX1RP\nX09ORSAmJiAKICAgICAgICAgICAgaGFzSm9pblRhYmxlKGZpZWxkKSAmJiAK\nICAgICAgICAgICAgaXNCaWRpcmVjdGlvbmFsKGZpZWxkKSkgewogICAgICAg\nICAgICBmaWVsZC5nZXRWYWx1ZU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5z\nZXRDb2x1bW5zKGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJ\nbmZvKCkuZ2V0Q29sdW1ucygpKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAog\nICAgcHVibGljIGJvb2xlYW4gaXNVbmkxVG9NRksoRmllbGRNYXBwaW5nIGZp\nZWxkKSB7CiAgICAgICAgaWYgKGlzTm9uRGVmYXVsdE1hcHBpbmdBbGxvd2Vk\nKCkgJiYgCiAgICAgICAgICAgIGZpZWxkLmdldEFzc29jaWF0aW9uVHlwZSgp\nID09IEZpZWxkTWV0YURhdGEuT05FX1RPX01BTlkgJiYKICAgICAgICAgICAg\naGFzSm9pbkNvbHVtbihmaWVsZCkgJiYKICAgICAgICAgICAgIWlzQmlkaXJl\nY3Rpb25hbChmaWVsZCkpIHsKICAgICAgICAgICAgZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5zZXRDb2x1bW5zKGZpZWxkLmdl\ndFZhbHVlSW5mbygpLmdldENvbHVtbnMoKSk7CiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBib29sZWFuIGlzQmlNVG8xSlQoRmllbGRNYXBw\naW5nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZCA9IGZp\nZWxkLmdldE1hcHBlZEJ5TWFwcGluZygpOwogICAgICAgIGlmIChpc05vbkRl\nZmF1bHRNYXBwaW5nQWxsb3dlZCgpKSB7CiAgICAgICAgICAgIGlmIChmaWVs\nZC5nZXRBc3NvY2lhdGlvblR5cGUoKSA9PSBGaWVsZE1ldGFEYXRhLk9ORV9U\nT19NQU5ZICkgewogICAgICAgICAgICAgICAgaWYgKG1hcHBlZCAhPSBudWxs\nICYmIGhhc0pvaW5UYWJsZShtYXBwZWQpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLmdl\ndEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEuTUFOWV9UT19P\nTkUpIHsKICAgICAgICAgICAgICAgIGlmIChnZXRCaV8xVG9NX0pvaW5UYWJs\nZUZpZWxkKGZpZWxkKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyByZXR1cm4gdGhlIGludmVyc2Ug\nZmllbGQgb2YgYmlkaXJlY3Rpb25hbCBtYW55IHRvIG9uZQogICAgLy8gcmVs\nYXRpb24gdXNpbmcgam9pbiB0YWJsZSBzdHJhdGVneQogICAgcHVibGljIEZp\nZWxkTWFwcGluZyBnZXRCaV8xVG9NX0pvaW5UYWJsZUZpZWxkKEZpZWxkTWFw\ncGluZyBmaWVsZCkgewogICAgICAgIGlmIChpc05vbkRlZmF1bHRNYXBwaW5n\nQWxsb3dlZCgpKSB7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRBc3NvY2lh\ndGlvblR5cGUoKSA9PSBGaWVsZE1ldGFEYXRhLk9ORV9UT19NQU5ZKSB7CiAg\nICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkQnkgPSBmaWVsZC5n\nZXRNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIGlmIChtYXBw\nZWRCeSAhPSBudWxsICYmIGhhc0pvaW5UYWJsZShtYXBwZWRCeSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkOwogICAgICAgICAgICB9IGVs\nc2UgaWYgKGZpZWxkLmdldEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0\nYURhdGEuTUFOWV9UT19PTkUpIHsKICAgICAgICAgICAgICAgIGlmICghaGFz\nSm9pblRhYmxlKGZpZWxkKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZyBpbnZlcnNlID0g\nZmllbGQuZ2V0VmFsdWVNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAg\nICAgICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtZHMgPSBpbnZlcnNlLmdl\ndEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nICAgIGlmIChmaWVsZCA9PSBmbWRzW2ldLmdldE1hcHBlZEJ5TWFwcGluZygp\nKSAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZtZHNbaV07CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8gcmV0dXJuIHRoZSBvd25p\nbmcgZmllbGQgb2YgYmlkaXJlY3Rpb25hbCBvbmUgdG8gbWFueQogICAgLy8g\ncmVsYXRpb24gdXNpbmcgam9pbiB0YWJsZSBzdHJhdGVneQogICAgcHVibGlj\nIEZpZWxkTWFwcGluZyBnZXRCaV9NVG8xX0pvaW5UYWJsZUZpZWxkKEZpZWxk\nTWFwcGluZyBmaWVsZCkgewogICAgICAgIGlmIChpc05vbkRlZmF1bHRNYXBw\naW5nQWxsb3dlZCgpKSB7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRBc3Nv\nY2lhdGlvblR5cGUoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTllfVE9fT05FKSB7\nCiAgICAgICAgICAgICAgICBpZiAoIWhhc0pvaW5UYWJsZShmaWVsZCkpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAg\nICBpZiAoaXNCaWRpcmVjdGlvbmFsKGZpZWxkKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmllbGQ7CiAgICAgICAgICAgICB9IGVsc2UgaWYgKGZp\nZWxkLmdldEFzc29jaWF0aW9uVHlwZSgpID09IEZpZWxkTWV0YURhdGEuT05F\nX1RPX01BTlkpIHsKICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZyBtYXBw\nZWRCeSA9IGZpZWxkLmdldE1hcHBlZEJ5TWFwcGluZygpOwogICAgICAgICAg\nICAgICAgaWYgKG1hcHBlZEJ5ICE9IG51bGwgJiYgaGFzSm9pblRhYmxlKG1h\ncHBlZEJ5KSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFwcGVkQnk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBib29sZWFuIGhhc0pvaW5Db2x1bW4o\nRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgYm9vbGVhbiBoYXNKb2lu\nQ29sdW1uID0gKGZpZWxkLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKS5z\naXplKCkgPiAwID8gdHJ1ZSA6IGZhbHNlKTsKICAgICAgICByZXR1cm4gaGFz\nSm9pbkNvbHVtbjsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gaGFz\nSm9pblRhYmxlKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIGJvb2xl\nYW4gaGFzSm9pblRhYmxlID0gIURCSWRlbnRpZmllci5pc051bGwoZmllbGQu\nZ2V0TWFwcGluZ0luZm8oKS5nZXRUYWJsZUlkZW50aWZpZXIoKSkgPyB0cnVl\nIDogZmFsc2U7CiAgICAgICAgcmV0dXJuIGhhc0pvaW5UYWJsZTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0JpZGlyZWN0aW9uYWwoRmllbGRNYXBw\naW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5TWFw\ncGluZygpICE9IG51bGwpIHJldHVybiB0cnVlOwogICAgICAgIGludCBhc3Nv\nVHlwZSA9IGZpZWxkLmdldEFzc29jaWF0aW9uVHlwZSgpOwogICAgICAgIGlm\nIChhc3NvVHlwZSA9PSBGaWVsZE1ldGFEYXRhLk9ORV9UT19PTkUgfHwgCiAg\nICAgICAgICAgIGFzc29UeXBlID09IEZpZWxkTWV0YURhdGEuTUFOWV9UT19P\nTkUpIHsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGludmVyc2UgPSBmaWVs\nZC5nZXRWYWx1ZU1hcHBpbmcoKS5nZXRUeXBlTWFwcGluZygpOwogICAgICAg\nICAgICBGaWVsZE1hcHBpbmdbXSBmbWRzID0gaW52ZXJzZS5nZXRGaWVsZE1h\ncHBpbmdzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkID09\nIGZtZHNbaV0uZ2V0TWFwcGVkQnlNYXBwaW5nKCkpIAogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBDaGVjayB0aGUgZ2l2ZW4gdmFsdWUgYWdhaW5zdCBtYXBwZWQgc3RyYXRl\nZ2llcy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgbWFwcGVkU3RyYXRl\nZ3koVmFsdWVNYXBwaW5nIHZhbCwgQ2xhc3M8Pz4gdHlwZSwKICAgICAgICBi\nb29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCB8\nfCB0eXBlID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIE9iamVjdCBzdHJhdCA9IF9kZWZhdWx0cy5nZXRTdHJh\ndGVneSh2YWwsIHR5cGUsIGFkYXB0aW5nKTsKCiAgICAgICAgLy8gcmVjdXJz\nZSBvbiBzdXBlcmNsYXNzIHNvIHRoYXQsIGZvciBleGFtcGxlLCBhIHJlZ2lz\ndGVyZWQgaGFuZGxlcgogICAgICAgIC8vIGZvciBqYXZhLmxhbmcuRW51bSB3\naWxsIHdvcmsgb24gYWxsIGVudW1zCiAgICAgICAgaWYgKHN0cmF0ID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBtYXBwZWRTdHJhdGVneSh2YWwsIHR5\ncGUuZ2V0U3VwZXJjbGFzcygpLCBhZGFwdGluZyk7CiAgICAgICAgaWYgKCEo\nc3RyYXQgaW5zdGFuY2VvZiBTdHJpbmcpKQogICAgICAgICAgICByZXR1cm4g\nc3RyYXQ7CgogICAgICAgIFN0cmluZyBuYW1lID0gKFN0cmluZykgc3RyYXQ7\nCiAgICAgICAgaWYgKE5vbmVGaWVsZFN0cmF0ZWd5LkFMSUFTLmVxdWFscyhu\nYW1lKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVGaWVsZFN0cmF0ZWd5Lmdl\ndEluc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3Vy\nYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENv\nbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBDbGFzczw/PiBjID0gSmF2YVR5cGVzLmNsYXNzRm9y\nTmFtZShuYW1lLCB2YWwsCiAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihGaWVsZFN0cmF0ZWd5LmNs\nYXNzKSkpOwogICAgICAgICAgICBPYmplY3QgbyA9IEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxw\nZXIubmV3SW5zdGFuY2VBY3Rpb24oYykpOwogICAgICAgICAgICBDb25maWd1\ncmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShvLCBnZXRDb25maWd1cmF0aW9u\nKCksIHByb3BzKTsKICAgICAgICAgICAgcmV0dXJuIG87CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKGUgaW5zdGFu\nY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAg\nICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSkuZ2V0RXhj\nZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYmFkLW1hcHBlZC1zdHJhdGVneSIsCiAgICAgICAg\nICAgICAgICB2YWwsIG5hbWUpLCBlKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmFsdWUncyBuYW1l\nZCBoYW5kbGVyLCBvciByZXR1cm4gbnVsbCBpZiBubwogICAgICogbmFtZWQg\naGFuZGxlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlSGFuZGxlciBu\nYW1lZEhhbmRsZXIoVmFsdWVNYXBwaW5nIHZhbCkgewogICAgICAgIFN0cmlu\nZyBuYW1lID0gdmFsLmdldFZhbHVlSW5mbygpLmdldFN0cmF0ZWd5KCk7CiAg\nICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdl\ndFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRp\nb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBDbGFzczw/PiBjID0gSmF2YVR5cGVzLmNsYXNzRm9yTmFtZShuYW1l\nLCB2YWwsCiAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXRDbGFzc0xvYWRlckFjdGlvbihWYWx1ZUhhbmRsZXIuY2xhc3MpKSk7CiAg\nICAgICAgICAgIGlmIChWYWx1ZUhhbmRsZXIuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbShjKSkgewogICAgICAgICAgICAgICAgVmFsdWVIYW5kbGVyIHZoID0g\nKFZhbHVlSGFuZGxlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFu\nY2VBY3Rpb24oYykpOwogICAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMu\nY29uZmlndXJlSW5zdGFuY2UodmgsIGdldENvbmZpZ3VyYXRpb24oKSwKICAg\nICAgICAgICAgICAgICAgICBwcm9wcyk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdmg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7\nIC8vIG5hbWVkIGZpZWxkIHN0cmF0ZWd5CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2\naWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgZSA9ICgo\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLXZhbHVlLWhhbmRsZXIiLAogICAgICAgICAgICAgICAgdmFs\nLCBuYW1lKSwgZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAg\nICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBoYW5kbGVyIHRvIHVzZSBmb3Ig\ndGhlIGdpdmVuIHZhbHVlLiBEb2VzCiAgICAgKiBub3QgdGFrZSBpbnRvIGFj\nY291bnQgdGhlIG5hbWVkIGhhbmRsZXIsIGlmIGFueS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFZhbHVlSGFuZGxlciBkZWZhdWx0SGFuZGxlcihWYWx1ZU1h\ncHBpbmcgdmFsKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRIYW5kbGVyKHZh\nbCwgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IGhhbmRs\nZXIgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmFsdWUuIERvZXMKICAgICAqIG5v\ndCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFtZWQgaGFuZGxlciwgaWYgYW55\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgVmFsdWVIYW5kbGVyIGRlZmF1bHRI\nYW5kbGVyKFZhbHVlTWFwcGluZyB2YWwsIGJvb2xlYW4gYWRhcHRpbmcpIHsK\nICAgICAgICBpZiAodmFsLmlzU2VyaWFsaXplZCgpKSB7CiAgICAgICAgICAg\nIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXplICE9IC0xKQogICAgICAg\nICAgICAgICAgd2Fybk1heEVtYmVkZGVkKHZhbCwgX2RpY3QubWF4RW1iZWRk\nZWRCbG9iU2l6ZSk7CiAgICAgICAgICAgIHJldHVybiBCbG9iVmFsdWVIYW5k\nbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3Qg\naGFuZGxlciA9IG1hcHBlZFN0cmF0ZWd5KHZhbCwgdmFsLmdldFR5cGUoKSwg\nYWRhcHRpbmcpOwogICAgICAgIGlmIChoYW5kbGVyIGluc3RhbmNlb2YgVmFs\ndWVIYW5kbGVyKQogICAgICAgICAgICByZXR1cm4gKFZhbHVlSGFuZGxlcikg\naGFuZGxlcjsKCiAgICAgICAgaWYgKHZhbC5nZXRUeXBlKCkgPT0gYnl0ZVtd\nLmNsYXNzIAogICAgICAgICAgICB8fCB2YWwuZ2V0VHlwZSgpID09IEJ5dGVb\nXS5jbGFzcykgewogICAgICAgICAgICBpZiAoX2RpY3QubWF4RW1iZWRkZWRC\nbG9iU2l6ZSAhPSAtMSkKICAgICAgICAgICAgICAgIHdhcm5NYXhFbWJlZGRl\nZCh2YWwsIF9kaWN0Lm1heEVtYmVkZGVkQmxvYlNpemUpOwogICAgICAgICAg\nICByZXR1cm4gQnl0ZUFycmF5VmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7\nCiAgICAgICAgfQogICAgICAgIGlmICh2YWwuZ2V0VHlwZSgpID09IGNoYXJb\nXS5jbGFzcwogICAgICAgICAgICB8fCB2YWwuZ2V0VHlwZSgpID09IENoYXJh\nY3RlcltdLmNsYXNzKSB7CiAgICAgICAgICAgIGlmIChpc0Nsb2IodmFsLCB0\ncnVlKSkKICAgICAgICAgICAgICAgIHJldHVybiBDaGFyQXJyYXlTdHJlYW1W\nYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmV0dXJu\nIENoYXJBcnJheVZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAgICAg\nIH0KCiAgICAgICAgc3dpdGNoICh2YWwuZ2V0VHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEVfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9B\nVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk5V\nTUJFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAgICAgICAgIHJldHVybiBJ\nbW11dGFibGVWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgaWYg\nKGlzQ2xvYih2YWwsIHRydWUpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBDbG9iVmFsdWVIYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gSW1tdXRhYmxlVmFsdWVIYW5kbGVyLmdldEluc3RhbmNl\nKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAg\nICAgICAgaWYgKCF2YWwuZ2V0VHlwZU1hcHBpbmcoKS5pc01hcHBlZCgpCiAg\nICAgICAgICAgICAgICAgICAgJiYgdXNlVW50eXBlZFBDSGFuZGxlcih2YWwp\nKSAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVW50eXBlZFBDVmFsdWVI\nYW5kbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAg\nICAgICAgICAgIHJldHVybiBVbnR5cGVkUENWYWx1ZUhhbmRsZXIuZ2V0SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZFZhbHVlSGFuZGxlcigp\nOwogICAgICAgIH0KICAgICAgICBpZiAoIWdldENvbmZpZ3VyYXRpb24oKS5n\nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKQogICAgICAgICAgICAuZ2V0U3Rv\ncmVNYXBDb2xsZWN0aW9uSW5FbnRpdHlBc0Jsb2IoKQogICAgICAgICAgICAm\nJiB2YWwuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nRWxlbWVudEVtYmVkVmFsdWVIYW5kbGVyKCk7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBz\naG91bGQgdXNlIHRoZSBnZW5lcmljIHVudHlwZWQgUEMgaGFuZGxlciBmb3Ig\ndGhlCiAgICAgKiBnaXZlbiB1bm1hcHBlZCByZWxhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIHVzZVVudHlwZWRQQ0hhbmRsZXIoVmFsdWVN\nYXBwaW5nIHZhbCkgewogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSB2YWwu\nZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gcmVsLmdldElkZW50\naXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5JRF9VTktOT1dOCiAgICAgICAg\nICAgIHx8IChyZWwuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5n\nLklEX0FQUExJQ0FUSU9OCiAgICAgICAgICAgICYmIChyZWwuZ2V0UHJpbWFy\neUtleUZpZWxkcygpLmxlbmd0aCA9PSAwCiAgICAgICAgICAgIHx8ICghcmVs\nLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYgTW9kaWZpZXIuaXNBYnN0cmFjdAog\nICAgICAgICAgICAocmVsLmdldE9iamVjdElkVHlwZSgpLmdldE1vZGlmaWVy\ncygpKSkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrcyBmb3IgaGlu\ndHMgYXMgdG8gd2hldGhlciB0aGUgZ2l2ZW4gY29sdW1uIGlzIGEgQ0xPQi4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzQ2xvYihWYWx1ZU1hcHBp\nbmcgdmFsLCBib29sZWFuIHdhcm4pIHsKICAgICAgICBMaXN0PENvbHVtbj4g\nY29scyA9IHZhbC5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgaWYgKGNvbHMuc2l6ZSgpICE9IDEpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIGNvbHMuZ2V0\nKDApOwogICAgICAgIGlmIChjb2wuZ2V0U2l6ZSgpICE9IC0xICYmIGNvbC5n\nZXRUeXBlKCkgIT0gVHlwZXMuQ0xPQikKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBpZiAoX2RpY3QuZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5DTE9CKSAhPSBUeXBlcy5DTE9CKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIGlmICh3YXJuICYmIF9kaWN0Lm1heEVtYmVkZGVkQ2xv\nYlNpemUgIT0gLTEpCiAgICAgICAgICAgIHdhcm5NYXhFbWJlZGRlZCh2YWws\nIF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogV2FybiB0aGF0IHRoZSBnaXZl\nbiB2YWx1ZSBpcyBiZWluZyBtYXBwZWQgdG8gYSBoYW5kbGVyIHRoYXQgd2ls\nbCBub3QKICAgICAqIGJlIGFibGUgdG8gc3RvcmUgbGFyZ2UgbG9icy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdhcm5NYXhFbWJlZGRlZChWYWx1ZU1h\ncHBpbmcgdmFsLCBpbnQgc2l6ZSkgewogICAgICAgIGlmIChnZXRMb2coKS5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIGdldExvZygpLndhcm4oX2xv\nYy5nZXQoIm1heC1lbWJlZC1sb2IiLCB2YWwsCiAgICAgICAgICAgICAgICBT\ndHJpbmcudmFsdWVPZihzaXplKSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhl\nIGdpdmVuIGRpc2NyaW1pbmF0b3IuCiAgICAgKiBEb2VzIG5vdCB0YWtlIGlu\ndG8gYWNjb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgRGlzY3JpbWluYXRvclN0cmF0ZWd5IGRlZmF1\nbHRTdHJhdGVneShEaXNjcmltaW5hdG9yIGRpc2NyaW0pIHsKICAgICAgICBy\nZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGRpc2NyaW0sIGdldFN0cmF0ZWd5SW5z\ndGFsbGVyKCkuaXNBZGFwdGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRo\nZSBnaXZlbiBkaXNjcmltaW5hdG9yLgogICAgICogRG9lcyBub3QgdGFrZSBp\nbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3RyYXRlZ3ksIGlmIGFueS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3JTdHJhdGVneSBkZWZh\ndWx0U3RyYXRlZ3koRGlzY3JpbWluYXRvciBkaXNjcmltLAogICAgICAgIGJv\nb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0g\nZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoY2xzLmdl\ndEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsK\nICAgICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpID09IG51bGwKICAgICAgICAgICAgJiYgKGNscy5nZXRTdHJhdGVneSgp\nID09IE5vbmVDbGFzc1N0cmF0ZWd5LmdldEluc3RhbmNlKCkKICAgICAgICAg\nICAgfHwgTW9kaWZpZXIuaXNGaW5hbChkaXNjcmltLmdldENsYXNzTWFwcGlu\nZygpLmdldERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9kaWZp\nZXJzKCkpKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVEaXNjcmltaW5hdG9y\nU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgT2JqZWN0IHN0cmF0\nID0gX2RlZmF1bHRzLmdldFN0cmF0ZWd5KGRpc2NyaW0sIGFkYXB0aW5nKTsK\nICAgICAgICBpZiAoc3RyYXQgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAg\nICAgIHJldHVybiBpbnN0YW50aWF0ZURpc2NyaW1pbmF0b3JTdHJhdGVneSgo\nU3RyaW5nKSBzdHJhdCwgZGlzY3JpbSk7CiAgICAgICAgaWYgKHN0cmF0ICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiAoRGlzY3JpbWluYXRvclN0cmF0\nZWd5KSBzdHJhdDsKCiAgICAgICAgaWYgKGNscy5nZXRKb2luYWJsZVBDU3Vw\nZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbmV3IFN1cGVyY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3koKTsKICAgICAg\nICBpZiAoZGlzY3JpbS5nZXRNYXBwaW5nSW5mbygpLmdldFZhbHVlKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZU1hcERpc2NyaW1p\nbmF0b3JTdHJhdGVneSgpOwogICAgICAgIGlmIChjbHMuZ2V0TWFwcGVkUENT\ndXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CiAg\nICAgICAgaWYgKGFkYXB0aW5nIHx8IF9kZWZhdWx0cy5kZWZhdWx0TWlzc2lu\nZ0luZm8oKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBDbGFzc05hbWVEaXNj\ncmltaW5hdG9yU3RyYXRlZ3koKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGlj\ndCA9ICgoSkRCQ0NvbmZpZ3VyYXRpb24pIGdldENvbmZpZ3VyYXRpb24oKSku\nCiAgICAgICAgICAgIGdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAg\nICAgaWYgKGRpY3Quam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFY\nX1RSQURJVElPTkFMKQogICAgICAgICAgICByZXR1cm4gTm9uZURpc2NyaW1p\nbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiBu\nZXcgU3ViY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0ZWd5KCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhlIGRlZmF1bHQgc3RyYXRl\nZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmVyc2lvbi4KICAgICAqIERvZXMg\nbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBjdXJyZW50IHN0cmF0ZWd5LCBp\nZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kg\nZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVyc2lvbikgewogICAgICAgIHJl\ndHVybiBkZWZhdWx0U3RyYXRlZ3kodmVyc2lvbiwgZ2V0U3RyYXRlZ3lJbnN0\nYWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhl\nIGdpdmVuIHZlcnNpb24uCiAgICAgKiBEb2VzIG5vdCB0YWtlIGludG8gYWNj\nb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShW\nZXJzaW9uIHZlcnNpb24sCiAgICAgICAgYm9vbGVhbiBhZGFwdGluZykgewog\nICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSB2ZXJzaW9uLmdldENsYXNzTWFw\ncGluZygpOwogICAgICAgIGlmIChjbHMuZ2V0RW1iZWRkaW5nTWV0YURhdGEo\nKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIGlmIChjbHMuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0gbnVsbAogICAgICAgICAgICAm\nJiBjbHMuZ2V0U3RyYXRlZ3koKSA9PSBOb25lQ2xhc3NTdHJhdGVneS5nZXRJ\nbnN0YW5jZSgpKQogICAgICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25TdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBPYmplY3Qgc3RyYXQgPSBf\nZGVmYXVsdHMuZ2V0U3RyYXRlZ3kodmVyc2lvbiwgYWRhcHRpbmcpOwogICAg\nICAgIGlmIChzdHJhdCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAg\ncmV0dXJuIGluc3RhbnRpYXRlVmVyc2lvblN0cmF0ZWd5KChTdHJpbmcpIHN0\ncmF0LCB2ZXJzaW9uKTsKICAgICAgICBpZiAoc3RyYXQgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIChWZXJzaW9uU3RyYXRlZ3kpIHN0cmF0OwoKICAg\nICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3VwZXJjbGFzc1Zl\ncnNpb25TdHJhdGVneSgpOwoKICAgICAgICBGaWVsZE1hcHBpbmcgdmZpZWxk\nID0gdmVyc2lvbi5nZXRDbGFzc01hcHBpbmcoKS4KICAgICAgICAgICAgZ2V0\nVmVyc2lvbkZpZWxkTWFwcGluZygpOwogICAgICAgIGlmICh2ZmllbGQgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTdHJhdGVneSh2ZXJz\naW9uLCB2ZmllbGQpOwogICAgICAgIGlmIChhZGFwdGluZyB8fCBfZGVmYXVs\ndHMuZGVmYXVsdE1pc3NpbmdJbmZvKCkpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgTnVtYmVyVmVyc2lvblN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJuIE5v\nbmVWZXJzaW9uU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZGVmYXVsdCB2ZXJzaW9uIHN0cmF0ZWd5\nLCBnaXZlbiBhIHZlcnNpb24gZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBWZXJzaW9uU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVy\ncywKICAgICAgICBGaWVsZE1hcHBpbmcgdmZpZWxkKSB7CiAgICAgICAgc3dp\ndGNoICh2ZmllbGQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVybiAoSmF2YVZlcnNpb25z\nLlZFUlNJT04gPj0gNSkgCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgTmFu\nb1ByZWNpc2lvblRpbWVzdGFtcFZlcnNpb25TdHJhdGVneSgpCiAgICAgICAg\nICAgICAgICAgICAgOiBuZXcgVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5KCk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5OVU1CRVI6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE51bWJlclZlcnNpb25TdHJh\ndGVneSgpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInZlcnNpb24tdHlw\nZS11bnN1cHBvcnRlZCIsIHZmaWVsZCwgdmZpZWxkLmdldERlY2xhcmVkVHlw\nZSgpKSk7Ci8vICAgICAgICAgICAgICAgIHJldHVybiBOb25lVmVyc2lvblN0\ncmF0ZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHN1\ncGVyLmVuZENvbmZpZ3VyYXRpb24oKTsKCiAgICAgICAgSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJh\ndGlvbigpOwogICAgICAgIF9kaWN0ID0gY29uZi5nZXREQkRpY3Rpb25hcnlJ\nbnN0YW5jZSgpOwogICAgICAgIGlmIChfZGVmYXVsdHMgPT0gbnVsbCkKICAg\nICAgICAgICAgX2RlZmF1bHRzID0gY29uZi5nZXRNYXBwaW5nRGVmYXVsdHNJ\nbnN0YW5jZSgpOwogICAgICAgIGlmIChfc2NoZW1hICE9IG51bGwgJiYgX3Nj\naGVtYSBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkgewogICAgICAgICAgICAo\nKENvbmZpZ3VyYWJsZSkgX3NjaGVtYSkuc2V0Q29uZmlndXJhdGlvbihjb25m\nKTsKICAgICAgICAgICAgKChDb25maWd1cmFibGUpIF9zY2hlbWEpLnN0YXJ0\nQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICAoKENvbmZpZ3VyYWJsZSkg\nX3NjaGVtYSkuZW5kQ29uZmlndXJhdGlvbigpOwogICAgICAgIH0gICAgICAg\nICAgICAKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBGaW5kcyB0aGUgYmFz\nZSBjbGFzcyBtYXBwaW5nIGZvciB0aGUgc3BlY2lmaWVkIG1hcHBpbmcuICBM\nb2FkcyBhbGwKICAgICAqIHBlcnNpc3RlbnQgdHlwZXMgaWYgbmVjZXNzYXJ5\nLCBzaW5jZSBhbGwgcGVyc2lzdGVudCBzdWJjbGFzc2VzIG9mIHRoaXMKICAg\nICAqIG1hcHBpbmcgbWF5IG5vdCBoYXZlIGJlZW4gcmVzb2x2ZWQgYmVmb3Jl\nIHRoaXMgbWV0aG9kIGlzIGNhbGxlZC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIENsYXNzTWFwcGluZyBmaW5kQmFzZUNsYXNzTWFwcGluZyhDbGFzc01hcHBp\nbmcgbWFwcGluZykgeyAgICAgICAgCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJh\nc2VNYXBwaW5nID0gbnVsbDsKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0g\nbWFwcGluZy5nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYg\nKHN1cCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG5vIHN1cGVyY2xhc3Mg\nbWV0YWRhdGEgd2FzIHByb3ZpZGVkLiAgY2hlY2sgdG8gc2VlIGlmIHRoaXMg\nY2xhc3MKICAgICAgICAgICAgLy8gaGFzIGFueSBwZXJzaXN0ZW50IHN1YmNs\nYXNzZXMuCiAgICAgICAgICAgIGlmIChtYXBwaW5nLmdldFBDU3ViY2xhc3Nl\ncygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBiYXNlTWFwcGluZyA9\nIG1hcHBpbmc7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nLy8gcGVyc2lzdGVudCBzdWJjbGFzc2VzIG1heSBub3QgaGF2ZSBiZWVuIHJl\nc29sdmVkIHlldC4gIAogICAgICAgICAgICAgICAgLy8gcnVuIHRocm91Z2gg\ndGhlIHBlcnNpc3RlbnQgdHlwZXMgdG8gc2VlIGlmIGFueSBvZiB0aGVtIAog\nICAgICAgICAgICAgICAgLy8gb3IgdGhlaXIgc3VwZXJjbGFzcyBpcyBhIHN1\nYmNsYXNzIG9mIHRoaXMgY2xhc3MuCiAgICAgICAgICAgICAgICBDb2xsZWN0\naW9uPENsYXNzPD8+PiBjbGFzc2VzID0gbG9hZFBlcnNpc3RlbnRUeXBlcyhm\nYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmcuZ2V0RW52\nQ2xhc3NMb2FkZXIoKSk7CiAgICAgICAgICAgICAgICBDbGFzczw/PiBjbHM7\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPENsYXNzPD8+PiBpdHIg\nPSBjbGFzc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICAgICAgY2xzID0gaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgICAgICBDbGFzczw/PiBzdXBjbCA9IGNscy5nZXRTdXBlcmNsYXNzKCk7\nCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN1cGNsICE9IG51bGwgJiYg\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICFzdXBjbC5nZXRDbGFzcygp\nLmVxdWFscyhqYXZhLmxhbmcuT2JqZWN0LmNsYXNzKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIXN1cGNsLmlzSW50ZXJmYWNlKCkgJiYKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHN1cGNsLmVxdWFscyhtYXBwaW5n\nLmdldERlc2NyaWJlZFR5cGUoKSkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGJhc2VNYXBwaW5nID0gbWFwcGluZzsgICAgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICBzdXBjbCA9IHN1cGNsLmdl\ndFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGJhc2VNYXBwaW5nICE9IG51bGwpIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIGlmICghc3VwLmdldERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKSB7\nCiAgICAgICAgICAgIC8vIGlmIHRoZSBzdXBlcmNsYXNzIGlzIG5vdCBhIG1h\nbmFnZWQgaW50ZXJmYWNlLCBmaW5kIHRoZSByb290CiAgICAgICAgICAgIC8v\nIHN1cGVyY2xhc3MgYW5kIGdldCBpdHMgbWFwcGluZyBpbmZvCiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyBzdXBjbSA9IHN1cDsKICAgICAgICAgICAgd2hp\nbGUgKHN1cGNtICE9IG51bGwgJiYgCiAgICAgICAgICAgICAgICAgICAgIXN1\ncGNtLmdldERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpICYmCiAgICAg\nICAgICAgICAgICAgICAgIXN1cGNtLmlzRW1iZWRkZWRPbmx5KCkpIHsKICAg\nICAgICAgICAgICAgIENsYXNzTWFwcGluZyBzdXBjbTIgPSBzdXBjbS5nZXRQ\nQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICBpZiAoc3Vw\nY20yID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgYmFzZU1hcHBpbmcg\nPSBzdXBjbTsKICAgICAgICAgICAgICAgIHN1cGNtID0gc3VwY20yOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBiYXNlTWFwcGlu\nZzsKICAgIH0KICAgCiAgICAvKioKICAgICAqIElmIGFuIGluaGVyaXRhbmNl\nIHN0cmF0ZWd5IGhhcyBub3QgYmVlbiBzZXQgb24gdGhpcyBtYXBwaW5nLCBz\nZXQgaXQKICAgICAqIHRvIHRoZSBkZWZhdWx0IChmbGF0KS4gIFRoaXMgbWV0\naG9kIHNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIHN0cmF0ZWdpZXMKICAgICAq\nIGFyZSBjcmVhdGVkIGZvciB0aGUgc3BlY2lmaWVkIG1hcHBpbmcuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldERlZmF1bHRJbmhlcml0YW5jZVN0\ncmF0ZWd5KENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NN\nYXBwaW5nSW5mbyBpbmZvID0gbWFwcGluZy5nZXRNYXBwaW5nSW5mbygpOwog\nICAgICAgIGlmIChpbmZvICE9IG51bGwgJiYgaW5mby5nZXRIaWVyYXJjaHlT\ndHJhdGVneSgpID09IG51bGwpCiAgICAgICAgICAgIGluZm8uc2V0SGllcmFy\nY2h5U3RyYXRlZ3koRmxhdENsYXNzU3RyYXRlZ3kuQUxJQVMpOyAgICAgICAg\nCiAgICB9IAogICAgCiAgICAvKioKICAgICAqIERldGVybWluZXMgd2hldGhl\nciBhbiBpbmhlcnRhbmNlIHN0cmF0ZWd5IGhhcyBiZWVuIHNldCBvbiB0aGUK\nICAgICAqIHNwZWNpZmllZCBtYXBwaW5nLgogICAgICovCiAgICBwcm90ZWN0\nZWQgYm9vbGVhbiBoYXNJbmhlcml0YW5jZVN0cmF0ZWd5KENsYXNzTWFwcGlu\nZyBtYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0g\nbWFwcGluZy5nZXRNYXBwaW5nSW5mbygpOwogICAgICAgIGlmIChpbmZvICE9\nIG51bGwgJiYgaW5mby5nZXRIaWVyYXJjaHlTdHJhdGVneSgpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxz\nZTsgICAgICAgIAogICAgfQp9Cg==\n","encoding":"base64"}

