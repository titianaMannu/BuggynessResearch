{"sha":"13fe736184b2f9a7eb76bdf9e11ee3c931da88a2","node_id":"MDQ6QmxvYjIwNjM2NDoxM2ZlNzM2MTg0YjJmOWE3ZWI3NmJkZjllMTFlZTNjOTMxZGE4OGEy","size":18527,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/13fe736184b2f9a7eb76bdf9e11ee3c931da88a2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uSU87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktl\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRl\neDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hl\nbWFzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRh\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVu\naXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3c7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1l\ndGFEYXRhSW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuTWV0YURhdGFFeGNlcHRpb247CgovKioKICogU3RhbmRhbG9uZSB7QGxp\nbmsgVmFsdWVNYXBwaW5nfSBpbXBsZW1lbnRhdGlvbi4KICoKICogQGF1dGhv\nciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wCiAqLwpAU3VwcHJlc3NXYXJu\naW5ncygic2VyaWFsIikKcHVibGljIGNsYXNzIFZhbHVlTWFwcGluZ0ltcGwK\nICAgIGV4dGVuZHMgVmFsdWVNZXRhRGF0YUltcGwKICAgIGltcGxlbWVudHMg\nVmFsdWVNYXBwaW5nIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFZh\nbHVlTWFwcGluZ0ltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUgVmFsdWVNYXBw\naW5nSW5mbyBfaW5mbzsKICAgIHByaXZhdGUgVmFsdWVIYW5kbGVyIF9oYW5k\nbGVyID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nW10gX3R5cGVB\ncnIgPSBudWxsOwoKICAgIHByaXZhdGUgQ29sdW1uW10gX2NvbHMgPSBTY2hl\nbWFzLkVNUFRZX0NPTFVNTlM7CiAgICBwcml2YXRlIENvbHVtbklPIF9pbyA9\nIG51bGw7CiAgICBwcml2YXRlIEZvcmVpZ25LZXkgX2ZrID0gbnVsbDsKICAg\nIHByaXZhdGUgTWFwPENsYXNzTWFwcGluZyxGb3JlaWduS2V5PiBfdGFyZ2V0\nRktzID0gbnVsbDsKICAgIHByaXZhdGUgSW5kZXggX2lkeCA9IG51bGw7CiAg\nICBwcml2YXRlIFVuaXF1ZSBfdW5xID0gbnVsbDsKICAgIHByaXZhdGUgaW50\nIF9qb2luID0gSk9JTl9GT1JXQVJEOwogICAgcHJpdmF0ZSBib29sZWFuIF9j\ncml0ZXJpYSA9IGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX3BvbHkgPSBQT0xZ\nX1RSVUU7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IG93\nbmluZyBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMgVmFsdWVNYXBwaW5n\nSW1wbChGaWVsZE1hcHBpbmcgb3duZXIpIHsKICAgICAgICBzdXBlcihvd25l\ncik7CiAgICAgICAgX2luZm8gPSBvd25lci5nZXRNYXBwaW5nUmVwb3NpdG9y\neSgpLm5ld01hcHBpbmdJbmZvKHRoaXMpOwogICAgICAgIF9pbmZvLnNldFVz\nZUNsYXNzQ3JpdGVyaWEob3duZXIuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS4K\nICAgICAgICAgICAgZ2V0TWFwcGluZ0RlZmF1bHRzKCkudXNlQ2xhc3NDcml0\nZXJpYSgpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rv\nciBmb3IgZGVzZXJpYWxpemF0aW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nVmFsdWVNYXBwaW5nSW1wbCgpIHsKICAgICAgICBzdXBlcigpOwogICAgfQoK\nICAgIHB1YmxpYyBWYWx1ZU1hcHBpbmdJbmZvIGdldFZhbHVlSW5mbygpIHsK\nICAgICAgICByZXR1cm4gX2luZm87CiAgICB9CgogICAgcHVibGljIFZhbHVl\nSGFuZGxlciBnZXRIYW5kbGVyKCkgewogICAgICAgIHJldHVybiBfaGFuZGxl\ncjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRIYW5kbGVyKFZhbHVlSGFu\nZGxlciBoYW5kbGVyKSB7CiAgICAgICAgX2hhbmRsZXIgPSBoYW5kbGVyOwog\nICAgfQoKICAgIHB1YmxpYyBNYXBwaW5nUmVwb3NpdG9yeSBnZXRNYXBwaW5n\nUmVwb3NpdG9yeSgpIHsKICAgICAgICByZXR1cm4gKE1hcHBpbmdSZXBvc2l0\nb3J5KSBnZXRSZXBvc2l0b3J5KCk7CiAgICB9CgogICAgcHVibGljIEZpZWxk\nTWFwcGluZyBnZXRGaWVsZE1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChG\naWVsZE1hcHBpbmcpIGdldEZpZWxkTWV0YURhdGEoKTsKICAgIH0KCiAgICBw\ndWJsaWMgQ2xhc3NNYXBwaW5nIGdldFR5cGVNYXBwaW5nKCkgewogICAgICAg\nIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBnZXRUeXBlTWV0YURhdGEoKTsKICAg\nIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldERlY2xhcmVkVHlwZU1h\ncHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmcpIGdldERl\nY2xhcmVkVHlwZU1ldGFEYXRhKCk7CiAgICB9CgogICAgcHVibGljIENsYXNz\nTWFwcGluZyBnZXRFbWJlZGRlZE1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJu\nIChDbGFzc01hcHBpbmcpIGdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgIH0K\nCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGdldFZhbHVlTWFwcGVkQnlNYXBw\naW5nKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5nKSBnZXRWYWx1\nZU1hcHBlZEJ5TWV0YURhdGEoKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sdW1u\nW10gZ2V0Q29sdW1ucygpIHsKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoICE9\nIDApCiAgICAgICAgICAgIHJldHVybiBfY29sczsKICAgICAgICBpZiAoX2Zr\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfZmsuZ2V0Q29sdW1ucygp\nOwogICAgICAgIGlmIChnZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGdldFZhbHVlTWFwcGVkQnlNYXBwaW5nKCkuZ2V0\nQ29sdW1ucygpOwogICAgICAgIHJldHVybiBfY29sczsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRDb2x1bW5zKENvbHVtbltdIGNvbHMpIHsKICAgICAg\nICBpZiAoY29scyA9PSBudWxsKQogICAgICAgICAgICBjb2xzID0gU2NoZW1h\ncy5FTVBUWV9DT0xVTU5TOwogICAgICAgIF9jb2xzID0gY29sczsKICAgIH0K\nCiAgICBwdWJsaWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAg\naWYgKF9jb2xzLmxlbmd0aCA9PSAwICYmIF9mayA9PSBudWxsICYmIGdldFZh\nbHVlTWFwcGVkQnkoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0\nVmFsdWVNYXBwZWRCeU1hcHBpbmcoKS5nZXRDb2x1bW5JTygpOwogICAgICAg\nIHJldHVybiAoX2lvID09IG51bGwpID8gQ29sdW1uSU8uVU5SRVNUUklDVEVE\nIDogX2lvOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbHVtbklPKENv\nbHVtbklPIGlvKSB7CiAgICAgICAgX2lvID0gaW87CiAgICB9CgogICAgcHVi\nbGljIEZvcmVpZ25LZXkgZ2V0Rm9yZWlnbktleSgpIHsKICAgICAgICBpZiAo\nX2ZrID09IG51bGwgJiYgZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBnZXRWYWx1ZU1hcHBlZEJ5TWFwcGluZygpLmdl\ndEZvcmVpZ25LZXkoKTsKICAgICAgICByZXR1cm4gX2ZrOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykgewog\nICAgICAgIF9mayA9IGZrOwogICAgICAgIGlmIChmayA9PSBudWxsKQogICAg\nICAgICAgICBfam9pbiA9IEpPSU5fRk9SV0FSRDsKICAgIH0KCiAgICBwdWJs\naWMgRm9yZWlnbktleSBnZXRGb3JlaWduS2V5KENsYXNzTWFwcGluZyB0YXJn\nZXQpIHsKICAgICAgICBpZiAoX2ZrID09IG51bGwgJiYgZ2V0VmFsdWVNYXBw\nZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZU1h\ncHBlZEJ5TWFwcGluZygpLmdldEZvcmVpZ25LZXkodGFyZ2V0KTsKICAgICAg\nICBpZiAodGFyZ2V0ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfZms7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGVtYmVkZGVkTWV0YSA9IChDbGFzc01h\ncHBpbmcpZ2V0RW1iZWRkZWRNZXRhRGF0YSgpOyAKICAgICAgICBpZiAoZW1i\nZWRkZWRNZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5n\nW10gZmllbGRzID0gZW1iZWRkZWRNZXRhLmdldEZpZWxkTWFwcGluZ3MoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBm\naWVsZHNbaV0uZ2V0VmFsdWVNYXBwaW5nKCk7IAogICAgICAgICAgICAgICAg\naWYgKHZhbC5nZXREZWNsYXJlZFR5cGVNYXBwaW5nKCkgPT0gdGFyZ2V0KQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwuZ2V0Rm9yZWlnbktleSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChfZmsgPT0g\nbnVsbCAmJiBfY29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIC8vIGFsd2F5cyB1c2UgbGVhc3QtZGVyaXZlZCBq\nb2luYWJsZSB0eXBlCiAgICAgICAgZm9yIChDbGFzc01hcHBpbmcgc3VwID0g\ndGFyZ2V0OyBzdXAgIT0gbnVsbDsKICAgICAgICAgICAgc3VwID0gc3VwLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKSB7CiAgICAgICAgICAg\nIGlmIChzdXAgPT0gZ2V0VHlwZU1ldGFEYXRhKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gX2ZrOwogICAgICAgICAgICB0YXJnZXQgPSBzdXA7CiAgICAg\nICAgfQoKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAg\nICAgaWYgKF90YXJnZXRGS3MgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nT2JqZWN0IGNhY2hlZEZLID0gX3RhcmdldEZLcy5nZXQodGFyZ2V0KTsKICAg\nICAgICAgICAgICAgIGlmIChjYWNoZWRGSyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiAoRm9yZWlnbktleSkgY2FjaGVkRks7CiAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgX3RhcmdldEZLcyA9IG5l\ndyBIYXNoTWFwPENsYXNzTWFwcGluZywgRm9yZWlnbktleT4oKTsKCiAgICAg\nICAgICAgIEZvcmVpZ25LZXkgbmV3ZmsgPSAoX2pvaW4gPT0gSk9JTl9GT1JX\nQVJEKQogICAgICAgICAgICAgICAgPyBuZXdGb3J3YXJkRm9yZWlnbktleSh0\nYXJnZXQpIDogbmV3SW52ZXJzZUZvcmVpZ25LZXkodGFyZ2V0KTsKICAgICAg\nICAgICAgX3RhcmdldEZLcy5wdXQodGFyZ2V0LCBuZXdmayk7CiAgICAgICAg\nICAgIHJldHVybiBuZXdmazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBmb3J3YXJkIGZvcmVpZ24ga2V5IHRvIHRoZSBnaXZl\nbiB0YXJnZXQuCiAgICAgKi8KICAgIHByaXZhdGUgRm9yZWlnbktleSBuZXdG\nb3J3YXJkRm9yZWlnbktleShDbGFzc01hcHBpbmcgdGFyZ2V0KSB7CiAgICAg\nICAgVGFibGUgdGFibGU7CiAgICAgICAgQ29sdW1uW10gY29sczsKICAgICAg\nICBpZiAoX2ZrID09IG51bGwpIHsKICAgICAgICAgICAgdGFibGUgPSBfY29s\nc1swXS5nZXRUYWJsZSgpOwogICAgICAgICAgICBjb2xzID0gX2NvbHM7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFibGUgPSBfZmsuZ2V0VGFi\nbGUoKTsKICAgICAgICAgICAgY29scyA9IF9may5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBnYXRoZXIgdGFyZ2V0IGNvbHMgYmVmb3Jl\nIGFkZGluZyBmb3JlaWduIGtleSB0byB0YWJsZSBpbiBjYXNlCiAgICAgICAg\nLy8gdGhlcmUgaXMgYW4gZXJyb3Igd2hpbGUgbG9va2luZyBmb3IgYSB0YXJn\nZXQgY29sCiAgICAgICAgQ29sdW1uW10gdGNvbHMgPSBuZXcgQ29sdW1uW2Nv\nbHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbHNbaV0uZ2V0VGFy\nZ2V0RmllbGQoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGNvbHNbaV0g\nPSBnZXRFcXVpdmFsZW50Q29sdW1uKGNvbHNbaV0sIHRhcmdldCwKICAgICAg\nICAgICAgICAgICAgICBjb2xzW2ldLmdldFRhcmdldEZpZWxkKCkpOwogICAg\nICAgICAgICBlbHNlIGlmIChfZmsgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRjb2xzW2ldID0gZ2V0RXF1aXZhbGVudENvbHVtbihfZmsuZ2V0UHJpbWFy\neUtleUNvbHVtbgogICAgICAgICAgICAgICAgICAgIChjb2xzW2ldKS5nZXRJ\nZGVudGlmaWVyKCksIHRhcmdldCwgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKGNvbHNbaV0uZ2V0VGFyZ2V0SWRl\nbnRpZmllcigpKSkKICAgICAgICAgICAgICAgIHRjb2xzW2ldID0gZ2V0RXF1\naXZhbGVudENvbHVtbihjb2xzW2ldLmdldFRhcmdldElkZW50aWZpZXIoKSwg\ndGFyZ2V0LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICB0Y29sc1tpXSA9IGdldEVxdWl2YWxl\nbnRDb2x1bW4oY29sc1tpXS5nZXRJZGVudGlmaWVyKCksIHRhcmdldCwKICAg\nICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBG\nb3JlaWduS2V5IG5ld2ZrID0gdGFibGUuYWRkRm9yZWlnbktleSgpOwogICAg\nICAgIG5ld2ZrLnNldEpvaW5zKGNvbHMsIHRjb2xzKTsKICAgICAgICBpZiAo\nX2ZrICE9IG51bGwpIHsKICAgICAgICAgICAgY29scyA9IF9may5nZXRDb25z\ndGFudENvbHVtbnMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgbmV3Zmsuam9p\nbkNvbnN0YW50KGNvbHNbaV0sIF9may5nZXRDb25zdGFudChjb2xzW2ldKSk7\nCgogICAgICAgICAgICBjb2xzID0gX2ZrLmdldENvbnN0YW50UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgbmV3Zmsuam9pbkNv\nbnN0YW50KF9may5nZXRQcmltYXJ5S2V5Q29uc3RhbnQoY29sc1tpXSksCiAg\nICAgICAgICAgICAgICAgICAgZ2V0RXF1aXZhbGVudENvbHVtbihjb2xzW2ld\nLmdldElkZW50aWZpZXIoKSwgdGFyZ2V0LCB0cnVlKSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBuZXdmazsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgZ2l2ZW4gbWFwcGluZydzIGVxdWl2YWxlbnQgdG8gdGhlIGdp\ndmVuIGNvbHVtbiwgdXNpbmcgdGhlCiAgICAgKiB0YXJnZXQgZmllbGQuCiAg\nICAgKi8KICAgIHByaXZhdGUgQ29sdW1uIGdldEVxdWl2YWxlbnRDb2x1bW4o\nQ29sdW1uIGNvbCwgQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAgICAgICBTdHJp\nbmcgZmllbGROYW1lKSB7CiAgICAgICAgZmllbGROYW1lID0gZmllbGROYW1l\nLnN1YnN0cmluZyhmaWVsZE5hbWUuaW5kZXhPZignLicpICsgMSk7CiAgICAg\nICAgRmllbGRNYXBwaW5nIGZpZWxkID0gdGFyZ2V0LmdldEZpZWxkTWFwcGlu\nZyhmaWVsZE5hbWUpOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLWVxdWl2LWZpZWxkIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb\nXXsgdGhpcywgdGFyZ2V0LCBmaWVsZE5hbWUsIGNvbCB9KSk7CgogICAgICAg\nIENvbHVtbltdIGNvbHMgPSBmaWVsZC5nZXRDb2x1bW5zKCk7CiAgICAgICAg\naWYgKGNvbHMubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWVxdWl2LWZpZWxkIiwK\nICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgdGhpcywgdGFyZ2V0LCBm\naWVsZE5hbWUsIGNvbCB9KSk7CgogICAgICAgIHJldHVybiBjb2xzWzBdOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBnaXZlbiBtYXBwaW5n\nJ3MgZXF1aXZhbGVudCBvZiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAg\nICBwcml2YXRlIENvbHVtbiBnZXRFcXVpdmFsZW50Q29sdW1uKERCSWRlbnRp\nZmllciBjb2xOYW1lLCBDbGFzc01hcHBpbmcgdGFyZ2V0LAogICAgICAgIGJv\nb2xlYW4gZXhwbGljaXQpIHsKICAgICAgICAvLyBpZiB0aGVyZSB3YXMgbm8g\nZXhwbGljaXQgdGFyZ2V0LCB1c2Ugc2luZ2xlIHBrIGNvbHVtbgogICAgICAg\nIGlmICghZXhwbGljaXQpIHsKICAgICAgICAgICAgZm9yIChDbGFzc01hcHBp\nbmcgY2xzID0gdGFyZ2V0OyBjbHMgIT0gbnVsbDsKICAgICAgICAgICAgICAg\nIGNscyA9IGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSkg\newogICAgICAgICAgICAgICAgaWYgKGNscy5nZXRUYWJsZSgpICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2xzLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCkubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBjbHMuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKVswXTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQ29sdW1uIHJldDsKICAgICAg\nICBmb3IgKENsYXNzTWFwcGluZyBjbHMgPSB0YXJnZXQ7IGNscyAhPSBudWxs\nOwogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCkpIHsKICAgICAgICAgICAgaWYgKGNscy5nZXRUYWJsZSgp\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldCA9IGNscy5nZXRUYWJs\nZSgpLmdldENvbHVtbihjb2xOYW1lKTsKICAgICAgICAgICAgICAgIGlmIChy\nZXQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWVxdWl2LWNvbCIsIHRoaXMs\nIHRhcmdldCwKICAgICAgICAgICAgY29sTmFtZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGFuIGludmVyc2UgZm9yZWlnbiBrZXkgZnJvbSB0\naGUgZ2l2ZW4gcmVsYXRlZCB0eXBlIHRvIG91ciB0YWJsZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBGb3JlaWduS2V5IG5ld0ludmVyc2VGb3JlaWduS2V5KENs\nYXNzTWFwcGluZyB0YXJnZXQpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgZmll\nbGQgPSBnZXRGaWVsZE1hcHBpbmcoKTsKICAgICAgICBGaWVsZE1hcHBpbmcg\nbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBwaW5nKCk7CiAgICAgICAg\naWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImNhbnQtaW52ZXJzZSIsIHRoaXMp\nKTsKCiAgICAgICAgbWFwcGVkID0gdGFyZ2V0LmdldEZpZWxkTWFwcGluZyht\nYXBwZWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxs\nIHx8IG1hcHBlZC5nZXRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5QQykKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1lcXVpdi1tYXBwZWQtYnkiLAogICAgICAgICAgICAgICAgdGhpcywg\ndGFyZ2V0LCBmaWVsZC5nZXRNYXBwZWRCeSgpKSk7CiAgICAgICAgcmV0dXJu\nIG1hcHBlZC5nZXRGb3JlaWduS2V5KCk7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRKb2luRGlyZWN0aW9uKCkgewogICAgICAgIGlmIChfZmsgPT0gbnVs\nbCAmJiBnZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGdldFZhbHVlTWFwcGVkQnlNYXBwaW5nKCkuZ2V0Sm9pbkRpcmVj\ndGlvbigpOwogICAgICAgIHJldHVybiBfam9pbjsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRKb2luRGlyZWN0aW9uKGludCBkaXJlY3Rpb24pIHsKICAg\nICAgICBfam9pbiA9IGRpcmVjdGlvbjsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRGb3JlaWduS2V5KFJvdyByb3csIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\ncmVsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChyZWwgIT0gbnVsbCkKICAgICAgICAgICAgcm93LnNldEZvcmVpZ25LZXko\nZ2V0Rm9yZWlnbktleSgoQ2xhc3NNYXBwaW5nKSByZWwuZ2V0TWV0YURhdGEo\nKSksCiAgICAgICAgICAgICAgICBfaW8sIHJlbCk7CiAgICAgICAgZWxzZSBp\nZiAoX2ZrICE9IG51bGwpCiAgICAgICAgICAgIHJvdy5zZXRGb3JlaWduS2V5\nKF9maywgX2lvLCBudWxsKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKF9pbyA9PSBudWxsIHx8IChyb3cuZ2V0QWN0aW9u\nKCkgPT0gUm93LkFDVElPTl9JTlNFUlQKICAgICAgICAgICAgICAgICAgICAm\nJiBfaW8uaXNJbnNlcnRhYmxlKGksIHRydWUpKQogICAgICAgICAgICAgICAg\nICAgIHx8IChyb3cuZ2V0QWN0aW9uKCkgIT0gUm93LkFDVElPTl9JTlNFUlQK\nICAgICAgICAgICAgICAgICAgICAmJiBfaW8uaXNVcGRhdGFibGUoaSwgdHJ1\nZSkpKQogICAgICAgICAgICAgICAgICAgIHJvdy5zZXROdWxsKF9jb2xzW2ld\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB3aGVyZUZvcmVpZ25LZXkoUm93IHJvdywgT3BlbkpQQVN0YXRlTWFu\nYWdlciByZWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHJlbCAhPSBudWxsKQogICAgICAgICAgICByb3cud2hlcmVGb3Jl\naWduS2V5KGdldEZvcmVpZ25LZXkoKENsYXNzTWFwcGluZykKICAgICAgICAg\nICAgICAgIHJlbC5nZXRNZXRhRGF0YSgpKSwgcmVsKTsKICAgICAgICBlbHNl\nIGlmIChfZmsgIT0gbnVsbCkKICAgICAgICAgICAgcm93LndoZXJlRm9yZWln\nbktleShfZmssIG51bGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfY29scy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIHJvdy53aGVyZU51bGwoX2NvbHNbaV0pOwogICAgfQoKICAgIHB1\nYmxpYyBDbGFzc01hcHBpbmdbXSBnZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5n\ncygpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gZ2V0VHlwZU1hcHBp\nbmcoKTsKICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBDbGFzc01hcHBpbmcuRU1QVFlfTUFQUElOR1M7CiAgICAgICAgaWYg\nKF9wb2x5ICE9IFBPTFlfVFJVRSkgewogICAgICAgICAgICBpZiAoIXJlbC5p\nc01hcHBlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIENsYXNzTWFwcGlu\nZy5FTVBUWV9NQVBQSU5HUzsKICAgICAgICAgICAgaWYgKF90eXBlQXJyID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfdHlwZUFyciA9IG5ldyBDbGFzc01h\ncHBpbmdbXXsgcmVsIH07CiAgICAgICAgICAgIHJldHVybiBfdHlwZUFycjsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlbC5nZXRJbmRlcGVuZGVudEFz\nc2lnbmFibGVNYXBwaW5ncygpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVs\nID0gZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocmVsID09IG51bGwg\nfHwgIXJlbC5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gLTE7Cgog\nICAgICAgIHN3aXRjaCAoX3BvbHkpIHsKICAgICAgICAgICAgY2FzZSBQT0xZ\nX0ZBTFNFOgogICAgICAgICAgICAgICAgcmV0dXJuIChfY3JpdGVyaWEpID8g\nU2VsZWN0LlNVQlNfTk9ORSA6IFNlbGVjdC5TVUJTX0VYQUNUOwogICAgICAg\nICAgICBjYXNlIFBPTFlfVFJVRToKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZ1tdIGFzc2lnbiA9IHJlbC5nZXRJbmRlcGVuZGVudEFzc2lnbmFibGVN\nYXBwaW5ncygpOwogICAgICAgICAgICAgICAgaWYgKGFzc2lnbi5sZW5ndGgg\nIT0gMSB8fCBhc3NpZ25bMF0gIT0gcmVsKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiAtMTsKICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAg\nICAgICAgIGNhc2UgUE9MWV9KT0lOQUJMRToKICAgICAgICAgICAgICAgIHJl\ndHVybiAoX2NyaXRlcmlhKSA/IFNlbGVjdC5TVUJTX0pPSU5BQkxFCiAgICAg\nICAgICAgICAgICAgICAgOiBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEU7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIFVuaXF1ZSBnZXRWYWx1ZVVuaXF1ZSgpIHsKICAgICAgICByZXR1cm4g\nX3VucTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZVVuaXF1ZShV\nbmlxdWUgdW5xKSB7CiAgICAgICAgX3VucSA9IHVucTsKICAgIH0KCiAgICBw\ndWJsaWMgSW5kZXggZ2V0VmFsdWVJbmRleCgpIHsKICAgICAgICByZXR1cm4g\nX2lkeDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZUluZGV4KElu\nZGV4IGlkeCkgewogICAgICAgIF9pZHggPSBpZHg7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpIHsKICAgICAgICBp\nZiAoX2ZrID09IG51bGwgJiYgZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZU1hcHBlZEJ5TWFwcGluZygp\nLmdldFVzZUNsYXNzQ3JpdGVyaWEoKTsKICAgICAgICByZXR1cm4gX2NyaXRl\ncmlhOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFVzZUNsYXNzQ3JpdGVy\naWEoYm9vbGVhbiBjcml0ZXJpYSkgewogICAgICAgIF9jcml0ZXJpYSA9IGNy\naXRlcmlhOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0UG9seW1vcnBoaWMo\nKSB7CiAgICAgICAgcmV0dXJuIF9wb2x5OwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFBvbHltb3JwaGljKGludCBwb2x5KSB7CiAgICAgICAgX3BvbHkg\nPSBwb2x5OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlZlNjaGVtYUNvbXBv\nbmVudHMoKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgX2NvbHNbaV0ucmVmKCk7CiAgICAg\nICAgaWYgKF9mayAhPSBudWxsKSB7CiAgICAgICAgICAgIF9may5yZWYoKTsK\nICAgICAgICAgICAgX2ZrLnJlZkNvbHVtbnMoKTsKICAgICAgICB9CgogICAg\nICAgIENsYXNzTWFwcGluZyBlbWJlZCA9IGdldEVtYmVkZGVkTWFwcGluZygp\nOwogICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQogICAgICAgICAgICBlbWJl\nZC5yZWZTY2hlbWFDb21wb25lbnRzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBtYXBDb25z\ndHJhaW50cyhTdHJpbmcgbmFtZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAg\nIG1hcENvbnN0cmFpbnRzKERCSWRlbnRpZmllci5uZXdDb25zdHJhaW50KG5h\nbWUpLCBhZGFwdCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwQ29uc3Ry\nYWludHMoREJJZGVudGlmaWVyIG5hbWUsIGJvb2xlYW4gYWRhcHQpIHsKICAg\nICAgICBfdW5xID0gX2luZm8uZ2V0VW5pcXVlKHRoaXMsIG5hbWUsIGFkYXB0\nKTsKICAgICAgICBfaWR4ID0gX2luZm8uZ2V0SW5kZXgodGhpcywgbmFtZSwg\nYWRhcHQpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBjbGVhck1hcHBp\nbmcoKSB7CiAgICAgICAgX2hhbmRsZXIgPSBudWxsOwogICAgICAgIF9jb2xz\nID0gU2NoZW1hcy5FTVBUWV9DT0xVTU5TOwogICAgICAgIF91bnEgPSBudWxs\nOwogICAgICAgIF9pZHggPSBudWxsOwogICAgICAgIF9mayA9IG51bGw7CiAg\nICAgICAgX2pvaW4gPSBKT0lOX0ZPUldBUkQ7CiAgICAgICAgX2luZm8uY2xl\nYXIoKTsKICAgICAgICBzZXRSZXNvbHZlKE1PREVfTUFQUElORyB8IE1PREVf\nTUFQUElOR19JTklULCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3luY01hcHBpbmdJbmZvKCkgewogICAgICAgIGlmIChnZXRWYWx1ZU1hcHBl\nZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAgX2luZm8uY2xlYXIoKTsKICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgX2luZm8uc3luY1dpdGgodGhpcyk7\nCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBlbWJlZCA9IGdldEVtYmVkZGVk\nTWFwcGluZygpOwogICAgICAgICAgICBpZiAoZW1iZWQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGVtYmVkLnN5bmNNYXBwaW5nSW5mbygpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgY29weShWYWx1ZU1ldGFE\nYXRhIHZtZCkgewogICAgICAgIHN1cGVyLmNvcHkodm1kKTsKICAgICAgICBj\nb3B5TWFwcGluZ0luZm8oKFZhbHVlTWFwcGluZyl2bWQpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNvcHlNYXBwaW5nSW5mbyhWYWx1ZU1hcHBpbmcgdm0p\nIHsKICAgICAgICBzZXRWYWx1ZU1hcHBlZEJ5KHZtLmdldFZhbHVlTWFwcGVk\nQnkoKSk7CiAgICAgICAgc2V0UG9seW1vcnBoaWModm0uZ2V0UG9seW1vcnBo\naWMoKSk7CiAgICAgICAgX2luZm8uY29weSh2bS5nZXRWYWx1ZUluZm8oKSk7\nCgogICAgICAgIENsYXNzTWFwcGluZyBlbWJlZCA9IHZtLmdldEVtYmVkZGVk\nTWFwcGluZygpOwogICAgICAgIGlmIChlbWJlZCAhPSBudWxsICYmIGdldEVt\nYmVkZGVkTWFwcGluZygpICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRN\nYXBwaW5nW10gdG1wbGF0ZXMgPSBlbWJlZC5nZXRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IGdldEVtYmVkZGVk\nTWFwcGluZygpLmdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgaWYg\nKHRtcGxhdGVzLmxlbmd0aCA9PSBmbXMubGVuZ3RoKQogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICAgICAgZm1zW2ldLmNvcHlNYXBwaW5nSW5mbyh0bXBsYXRl\nc1tpXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJl\nc29sdmUoaW50IG1vZGUpIHsKICAgICAgICBpbnQgY3VyID0gZ2V0UmVzb2x2\nZSgpOwogICAgICAgIGlmIChzdXBlci5yZXNvbHZlKG1vZGUpKQogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQg\nPSBnZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgIT0g\nbnVsbCkKICAgICAgICAgICAgZW1iZWQucmVzb2x2ZShtb2RlKTsKICAgICAg\nICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkcpICE9IDAgJiYgKGN1ciAmIE1P\nREVfTUFQUElORykgPT0gMCkKICAgICAgICAgICAgcmVzb2x2ZU1hcHBpbmco\nKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkdfSU5JVCkgIT0g\nMCAmJiAoY3VyICYgTU9ERV9NQVBQSU5HX0lOSVQpID09IDApCiAgICAgICAg\nICAgIGluaXRpYWxpemVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0dXAgbWFwcGluZy4gT3VyIGhh\nbmRsZXIgd2lsbCBhbHJlYWR5IGhhdmUgYmVlbiBzZXQgYnkgb3VyIG93bmlu\nZwogICAgICogZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXNv\nbHZlTWFwcGluZygpIHsKICAgICAgICAvLyBtYXJrIG1hcHBlZCBjb2x1bW5z\nCiAgICAgICAgQ29sdW1uW10gY29sczsKICAgICAgICBpbnQgaW5zZXJ0Rmxh\nZzsKICAgICAgICBpZiAoX2ZrICE9IG51bGwpIHsKICAgICAgICAgICAgY29s\ncyA9IF9may5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIGluc2VydEZsYWcg\nPSBDb2x1bW4uRkxBR19GS19JTlNFUlQ7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgY29scyA9IGdldENvbHVtbnMoKTsKICAgICAgICAgICAgaW5z\nZXJ0RmxhZyA9IENvbHVtbi5GTEFHX0RJUkVDVF9JTlNFUlQ7CiAgICAgICAg\nfQogICAgICAgIENvbHVtbklPIGlvID0gZ2V0Q29sdW1uSU8oKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGlvLmlzSW5zZXJ0YWJsZShpLCBmYWxzZSkpCiAgICAg\nICAgICAgICAgICBjb2xzW2ldLnNldEZsYWcoaW5zZXJ0RmxhZywgdHJ1ZSk7\nCiAgICAgICAgICAgIGlmIChpby5pc1VwZGF0YWJsZShpLCBmYWxzZSkpCiAg\nICAgICAgICAgICAgICBjb2xzW2ldLnNldEZsYWcoaW5zZXJ0RmxhZywgdHJ1\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHJlcGFyZSBt\nYXBwaW5nIGZvciBydW50aW1lIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGluaXRpYWxpemVNYXBwaW5nKCkgewogICAgICAgIGlmIChfZmsgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiBvdXIg\nZmsgY29scyBhcmUgZGlyZWN0IG1hcHBlZCBieSBvdGhlciB2YWx1ZXMsIG1h\na2UgdGhlbQogICAgICAgIC8vIG5vbi1udWxsYWJsZQogICAgICAgIENvbHVt\nbltdIGNvbHMgPSBfZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoY29sc1tpXS5nZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9JTlNFUlQp\nKQogICAgICAgICAgICAgICAgbmV3SU8oKS5zZXROdWxsSW5zZXJ0YWJsZShp\nLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChjb2xzW2ldLmdldEZsYWcoQ29s\ndW1uLkZMQUdfRElSRUNUX1VQREFURSkpCiAgICAgICAgICAgICAgICBuZXdJ\nTygpLnNldE51bGxVcGRhdGFibGUoaSwgZmFsc2UpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgYW55dGhpbmcgbWFwcyBvdXIgY29uc3RhbnQgZmsgY29s\ncywgbWFrZSB0aGVtIHJlYWQgb25seQogICAgICAgIGludCBsZW4gPSBjb2xz\nLmxlbmd0aDsKICAgICAgICBjb2xzID0gX2ZrLmdldENvbnN0YW50Q29sdW1u\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoY29sc1tpXS5nZXRGbGFnKENvbHVt\nbi5GTEFHX0RJUkVDVF9JTlNFUlQpCiAgICAgICAgICAgICAgICB8fCBjb2xz\nW2ldLmdldEZsYWcoQ29sdW1uLkZMQUdfRktfSU5TRVJUKSkKICAgICAgICAg\nICAgICAgIG5ld0lPKCkuc2V0SW5zZXJ0YWJsZShsZW4gKyBpLCBmYWxzZSk7\nCiAgICAgICAgICAgIGlmIChjb2xzW2ldLmdldEZsYWcoQ29sdW1uLkZMQUdf\nRElSRUNUX1VQREFURSkKICAgICAgICAgICAgICAgIHx8IGNvbHNbaV0uZ2V0\nRmxhZyhDb2x1bW4uRkxBR19GS19VUERBVEUpKQogICAgICAgICAgICAgICAg\nbmV3SU8oKS5zZXRVcGRhdGFibGUobGVuICsgaSwgZmFsc2UpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29sdW1uIEkv\nTyBpbmZvcm1hdGlvbiwgY3JlYXRpbmcgaXQgaWYgbmVjZXNzYXJ5LgogICAg\nICovCiAgICBwcml2YXRlIENvbHVtbklPIG5ld0lPKCkgewogICAgICAgIGlm\nIChfaW8gPT0gbnVsbCkKICAgICAgICAgICAgX2lvID0gbmV3IENvbHVtbklP\nKCk7CiAgICAgICAgcmV0dXJuIF9pbzsKICAgIH0KfQo=\n","encoding":"base64"}

