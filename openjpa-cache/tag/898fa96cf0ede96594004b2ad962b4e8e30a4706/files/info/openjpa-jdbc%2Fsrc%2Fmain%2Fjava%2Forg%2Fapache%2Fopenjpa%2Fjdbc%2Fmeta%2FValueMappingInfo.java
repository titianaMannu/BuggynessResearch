{"sha":"c9881674f6e4eb558b0f446d7d8a93530367909a","node_id":"MDQ6QmxvYjIwNjM2NDpjOTg4MTY3NGY2ZTRlYjU1OGIwZjQ0NmQ3ZDhhOTM1MzAzNjc5MDlh","size":14287,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c9881674f6e4eb558b0f446d7d8a93530367909a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZpZXIu\nREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBJbmZv\ncm1hdGlvbiBhYm91dCB0aGUgbWFwcGluZyBmcm9tIGEgZmllbGQgdmFsdWUg\ndG8gdGhlIHNjaGVtYSwgaW4KICogcmF3IGZvcm0uIFRoZSBjb2x1bW5zIGFu\nZCB0YWJsZXMgdXNlZCBpbiBtYXBwaW5nIGluZm8gd2lsbCBub3QgYmUgcGFy\ndCBvZgogKiB0aGUge0BsaW5rIFNjaGVtYUdyb3VwfSB1c2VkIGF0IHJ1bnRp\nbWUuIFJhdGhlciwgdGhleSB3aWxsIGJlIHN0cnVjdHMKICogd2l0aCB0aGUg\ncmVsZXZhbnQgcGllY2VzIG9mIGluZm9ybWF0aW9uIGZpbGxlZCBpbi4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICovCkBTdXBwcmVzc1dhcm5pbmdzKCJz\nZXJpYWwiKQpwdWJsaWMgY2xhc3MgVmFsdWVNYXBwaW5nSW5mbwogICAgZXh0\nZW5kcyBNYXBwaW5nSW5mbyB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAg\nIChWYWx1ZU1hcHBpbmdJbmZvLmNsYXNzKTsKCiAgICBwcml2YXRlIGJvb2xl\nYW4gX2NyaXRlcmlhID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Nh\nbk51bGwgPSB0cnVlOwogICAgcHJpdmF0ZSBMaXN0PENvbHVtbj4gX21hcHNJ\nZENvbHMgPSBudWxsOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2Ug\nY2xhc3MgY3JpdGVyaWEgd2hlbiBqb2luaW5nIHRvIHJlbGF0ZWQgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0VXNlQ2xhc3NDcml0ZXJp\nYSgpIHsKICAgICAgICByZXR1cm4gX2NyaXRlcmlhOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0byB1c2UgY2xhc3MgY3JpdGVyaWEgd2hlbiBq\nb2luaW5nIHRvIHJlbGF0ZWQgdHlwZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0VXNlQ2xhc3NDcml0ZXJpYShib29sZWFuIGNyaXRlcmlhKSB7CiAg\nICAgICAgX2NyaXRlcmlhID0gY3JpdGVyaWE7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHVzZXIgaGFzIGV4cGxpY2l0bHkgdHVybmVkIG51bGwg\naW5kaWNhdG9yIGNvbHVtbiBvZmYuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGNhbkluZGljYXRlTnVsbCgpIHsKICAgICAgICByZXR1cm4gX2Nhbk51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHVzZXIgaGFzIGV4\ncGxpY2l0bHkgdHVybmVkIG51bGwgaW5kaWNhdG9yIGNvbHVtbiBvZmYuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENhbkluZGljYXRlTnVsbChib29s\nZWFuIGluZCkgewogICAgICAgIF9jYW5OdWxsID0gaW5kOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2luIGZyb20gdGhpcyB2YWx1ZSB0\nbyBpdHMgcmVsYXRlZCB0eXBlLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1l\nIGJhc2UgbmFtZSBmb3IgdmFsdWUgbWFwcGluZwogICAgICogQHBhcmFtIGlu\ndmVyc2FibGUgd2hldGhlciBhbiBpbnZlcnNlIGpvaW4gaXMgYWxsb3dlZAog\nICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIEZvcmVpZ25L\nZXkgZ2V0VHlwZUpvaW4oZmluYWwgVmFsdWVNYXBwaW5nIHZhbCwgZmluYWwg\nU3RyaW5nIG5hbWUsCiAgICAgICAgYm9vbGVhbiBpbnZlcnNhYmxlLCBib29s\nZWFuIGFkYXB0KSB7CiAgICAgICAgcmV0dXJuIGdldFR5cGVKb2luKHZhbCwg\nREJJZGVudGlmaWVyLm5ld0ZvcmVpZ25LZXkobmFtZSksIGludmVyc2FibGUs\nIGFkYXB0KTsKICAgIH0KCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRUeXBl\nSm9pbihmaW5hbCBWYWx1ZU1hcHBpbmcgdmFsLCBmaW5hbCBEQklkZW50aWZp\nZXIgbmFtZSwKICAgICAgICBib29sZWFuIGludmVyc2FibGUsIGJvb2xlYW4g\nYWRhcHQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gdmFsLmdldFR5\ncGVNYXBwaW5nKCk7CiAgICAgICAgaWYgKHJlbCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRm9yZWlnbktleURlZmF1bHRz\nIGRlZiA9IG5ldyBGb3JlaWduS2V5RGVmYXVsdHMoKSB7CiAgICAgICAgICAg\nIHB1YmxpYyBGb3JlaWduS2V5IGdldChUYWJsZSBsb2NhbCwgVGFibGUgZm9y\nZWlnbiwgYm9vbGVhbiBpbnZlcnNlKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdmFsLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1\nbHRzKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0Rm9yZWlnbktleSh2YWws\nIG5hbWUsIGxvY2FsLCBmb3JlaWduLCBpbnZlcnNlKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgcG9wdWxhdGUoVGFibGUgbG9j\nYWwsIFRhYmxlIGZvcmVpZ24sIENvbHVtbiBjb2wsCiAgICAgICAgICAgICAg\nICBPYmplY3QgdGFyZ2V0LCBib29sZWFuIGludmVyc2UsIGludCBwb3MsIGlu\ndCBjb2xzKSB7CiAgICAgICAgICAgICAgICB2YWwuZ2V0TWFwcGluZ1JlcG9z\naXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAg\nICAgICBwb3B1bGF0ZUZvcmVpZ25LZXlDb2x1bW4odmFsLCBuYW1lLCBsb2Nh\nbCwgZm9yZWlnbiwgY29sLAogICAgICAgICAgICAgICAgICAgICAgICB0YXJn\nZXQsIGludmVyc2UsIHBvcywgY29scyk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9OwogICAgICAgIFRhYmxlIHRhYmxlID0gZ2V0VGFibGUodmFsKTsKICAg\nICAgICByZXR1cm4gY3JlYXRlRm9yZWlnbktleSh2YWwsIG51bGwsIGdldENv\nbHVtbnMoKSwgZGVmLAogICAgICAgICAgICB0YWJsZSwgdmFsLmdldEZpZWxk\nTWFwcGluZygpLgogICAgICAgICAgICBnZXREZWZpbmluZ01hcHBpbmcoKSwg\ncmVsLCBpbnZlcnNhYmxlLCBhZGFwdCk7CiAgICB9CgogICAgcHVibGljIFRh\nYmxlIGdldFRhYmxlKFZhbHVlTWFwcGluZyB2YWwpIHsKICAgICAgICBGaWVs\nZE1hcHBpbmcgZmllbGQgPSB2YWwuZ2V0RmllbGRNYXBwaW5nKCk7CiAgICAg\nICAgVGFibGUgdGFibGUgPSBmaWVsZC5nZXRUYWJsZSgpOwogICAgICAgIGlm\nICh0YWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBj\nbHMgPSAoQ2xhc3NNYXBwaW5nKWZpZWxkLmdldERlZmluaW5nTWV0YURhdGEo\nKTsKICAgICAgICAgICAgVmFsdWVNYXBwaW5nIHZhbDEgPSAoVmFsdWVNYXBw\naW5nKWNscy5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpOwogICAgICAgICAgICBp\nZiAodmFsMSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGdldFRh\nYmxlKHZhbDEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGFibGU7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2luIGZyb20g\ndGhlIHJlbGF0ZWQgdHlwZSB0byB0aGlzIHZhbHVlLgogICAgICogQGRlcHJl\nY2F0ZWQKICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0SW52ZXJz\nZVR5cGVKb2luKGZpbmFsIFZhbHVlTWFwcGluZyB2YWwsCiAgICAgICAgZmlu\nYWwgU3RyaW5nIG5hbWUsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICByZXR1\ncm4gZ2V0SW52ZXJzZVR5cGVKb2luKHZhbCwgREJJZGVudGlmaWVyLm5ld0Zv\ncmVpZ25LZXkobmFtZSksIGFkYXB0KTsKICAgIH0KCiAgICBwdWJsaWMgRm9y\nZWlnbktleSBnZXRJbnZlcnNlVHlwZUpvaW4oZmluYWwgVmFsdWVNYXBwaW5n\nIHZhbCwKICAgICAgICBmaW5hbCBEQklkZW50aWZpZXIgbmFtZSwgYm9vbGVh\nbiBhZGFwdCkgewogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSB2YWwuZ2V0\nVHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocmVsID09IG51bGwgfHwgcmVs\nLmdldFRhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYgPSBuZXcgRm9yZWln\nbktleURlZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMgRm9yZWlnbktl\neSBnZXQoVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIGJvb2xlYW4gaW52\nZXJzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbC5nZXRNYXBwaW5n\nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAg\nICAgICAgICAgIGdldEZvcmVpZ25LZXkodmFsLCBuYW1lLCBsb2NhbCwgZm9y\nZWlnbiwgIWludmVyc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBwb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFibGUgZm9yZWln\nbiwgQ29sdW1uIGNvbCwKICAgICAgICAgICAgICAgIE9iamVjdCB0YXJnZXQs\nIGJvb2xlYW4gaW52ZXJzZSwgaW50IHBvcywgaW50IGNvbHMpIHsKICAgICAg\nICAgICAgICAgIHZhbC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBp\nbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlRm9y\nZWlnbktleUNvbHVtbih2YWwsIG5hbWUsIGxvY2FsLCBmb3JlaWduLCBjb2ws\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCwgIWludmVyc2UsIHBv\ncywgY29scyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJl\ndHVybiBjcmVhdGVGb3JlaWduS2V5KHZhbCwgbnVsbCwgZ2V0Q29sdW1ucygp\nLCBkZWYsIHJlbC5nZXRUYWJsZSgpLAogICAgICAgICAgICByZWwsIHZhbC5n\nZXRGaWVsZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBpbmcoKSwgZmFsc2Us\nIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29s\ndW1ucyBmb3IgdGhpcyB2YWx1ZSwgYmFzZWQgb24gdGhlIGdpdmVuIHRlbXBs\nYXRlcy4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2x1bW5bXSBnZXRDb2x1bW5zKFZhbHVlTWFwcGluZyB2YWwsIFN0cmluZyBu\nYW1lLAogICAgICAgIENvbHVtbltdIHRtcGxhdGVzLCBUYWJsZSB0YWJsZSwg\nYm9vbGVhbiBhZGFwdCkgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5zKHZh\nbCwgREJJZGVudGlmaWVyLm5ld0NvbHVtbihuYW1lKSwgdG1wbGF0ZXMsIHRh\nYmxlLCBhZGFwdCk7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENv\nbHVtbnMoVmFsdWVNYXBwaW5nIHZhbCwgREJJZGVudGlmaWVyIG5hbWUsCiAg\nICAgICAgQ29sdW1uW10gdG1wbGF0ZXMsIFRhYmxlIHRhYmxlLCBib29sZWFu\nIGFkYXB0KSB7CiAgICAgICAgb3JkZXJDb2x1bW5zQnlUYXJnZXRGaWVsZCh2\nYWwsIHRtcGxhdGVzLCBhZGFwdCk7CiAgICAgICAgdmFsLmdldE1hcHBpbmdS\nZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkucG9wdWxhdGVDb2x1\nbW5zCiAgICAgICAgICAgICh2YWwsIG5hbWUsIHRhYmxlLCB0bXBsYXRlcyk7\nCiAgICAgICAgcmV0dXJuIGNyZWF0ZUNvbHVtbnModmFsLCBudWxsLCB0bXBs\nYXRlcywgdGFibGUsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgZ2l2ZW4gY29sdW1ucyBtYXRjaCB1cCB3aXRoIHRoZSB0YXJnZXQgZmll\nbGRzIHN1cHBsaWVkIG9uIHRoZQogICAgICogdGVtcGxhdGVzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgb3JkZXJDb2x1bW5zQnlUYXJnZXRGaWVsZChW\nYWx1ZU1hcHBpbmcgdmFsLCBDb2x1bW5bXSB0bXBsYXRlcywKICAgICAgICBi\nb29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKHRtcGxhdGVzLmxlbmd0aCA8\nIDIgfHwgdG1wbGF0ZXNbMF0uZ2V0VGFyZ2V0RmllbGQoKSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMg\nPSBnZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNvbHMuaXNFbXB0eSgpIHx8\nIGNvbHMuc2l6ZSgpICE9IHRtcGxhdGVzLmxlbmd0aCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpbnQgcG9zID0gMDsKICAgICAgICBDb2x1bW4g\nY3VyID0gKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAgQ29sdW1uIG5l\neHQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLnNpemUoKTsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChjdXIuZ2V0VGFyZ2V0RmllbGQoKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby10YXJnZXRmaWVsZCIsIHZhbCkpOwoKICAg\nICAgICAgICAgcG9zID0gZmluZFRhcmdldEZpZWxkKHRtcGxhdGVzLCBjdXIu\nZ2V0VGFyZ2V0RmllbGQoKSk7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC10YXJnZXRmaWVsZCIsCiAgICAgICAgICAgICAgICAg\nICAgdmFsLCBjdXIuZ2V0VGFyZ2V0RmllbGQoKSkpOwoKICAgICAgICAgICAg\nbmV4dCA9IChDb2x1bW4pIGNvbHMuZ2V0KHBvcyk7CiAgICAgICAgICAgIGNv\nbHMuc2V0KHBvcywgY3VyKTsKICAgICAgICAgICAgY3VyID0gbmV4dDsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvc2l0\naW9uIG9mIHRoZSB0ZW1wbGF0ZSBjb2x1bW4gd2l0aCB0aGUgZ2l2ZW4gdGFy\nZ2V0IGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgaW50IGZpbmRUYXJnZXRG\naWVsZChDb2x1bW5bXSB0bXBsYXRlcywgU3RyaW5nIHRhcmdldCkgewogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdG1wbGF0ZXMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmICh0YXJnZXQuZXF1YWxzKHRtcGxhdGVzW2ldLmdl\ndFRhcmdldEZpZWxkKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAg\nICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgdW5pcXVlIGNvbnN0cmFpbnQgZm9yIHRoZSBnaXZlbiBjb2x1bW5zLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAg\nICBwdWJsaWMgVW5pcXVlIGdldFVuaXF1ZShWYWx1ZU1hcHBpbmcgdmFsLCBT\ndHJpbmcgbmFtZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIHJldHVybiBn\nZXRVbmlxdWUodmFsLCBEQklkZW50aWZpZXIubmV3Q29uc3RyYWludChuYW1l\nKSwgYWRhcHQpOwogICAgfQoKICAgIHB1YmxpYyBVbmlxdWUgZ2V0VW5pcXVl\nKFZhbHVlTWFwcGluZyB2YWwsIERCSWRlbnRpZmllciBuYW1lLCBib29sZWFu\nIGFkYXB0KSB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHZhbC5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBVbmlxdWUgdW5xID0gdmFsLmdl\ndE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAg\nICAgICAgICAgIGdldFVuaXF1ZSh2YWwsIG5hbWUsIGNvbHNbMF0uZ2V0VGFi\nbGUoKSwgY29scyk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVVuaXF1ZSh2YWws\nIG51bGwsIHVucSwgY29scywgYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGFuIGluZGV4IGZvciB0aGUgZ2l2ZW4gY29sdW1ucywgb3Ig\nbnVsbCBpZiBub25lLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAg\ncHVibGljIEluZGV4IGdldEluZGV4KFZhbHVlTWFwcGluZyB2YWwsIFN0cmlu\nZyBuYW1lLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgcmV0dXJuIGdldElu\nZGV4KHZhbCwgREJJZGVudGlmaWVyLm5ld0luZGV4KG5hbWUpLCBhZGFwdCk7\nCiAgICB9CgogICAgcHVibGljIEluZGV4IGdldEluZGV4KFZhbHVlTWFwcGlu\nZyB2YWwsIERCSWRlbnRpZmllciBuYW1lLCBib29sZWFuIGFkYXB0KSB7CiAg\nICAgICAgQ29sdW1uW10gY29scyA9IHZhbC5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgaWYgKGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBJbmRleCBpZHggPSB2YWwuZ2V0TWFwcGluZ1JlcG9z\naXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAgZ2V0\nSW5kZXgodmFsLCBuYW1lLCBjb2xzWzBdLmdldFRhYmxlKCksIGNvbHMpOwog\nICAgICAgIHJldHVybiBjcmVhdGVJbmRleCh2YWwsIG51bGwsIGlkeCwgY29s\ncywgYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBu\ndWxsIGluZGljYXRvciBjb2x1bW4gZm9yIHRoaXMgdmFsdWUsIG9yIG51bGwg\naWYgbm9uZS4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1Ymxp\nYyBDb2x1bW4gZ2V0TnVsbEluZGljYXRvckNvbHVtbihWYWx1ZU1hcHBpbmcg\ndmFsLCBTdHJpbmcgbmFtZSwKICAgICAgICBUYWJsZSB0YWJsZSwgYm9vbGVh\nbiBhZGFwdCkgewogICAgICAgIHJldHVybiBnZXROdWxsSW5kaWNhdG9yQ29s\ndW1uKHZhbCwgREJJZGVudGlmaWVyLm5ld0NvbHVtbihuYW1lKSwgdGFibGUs\nIGFkYXB0KTsKICAgIH0KCiAgICBwdWJsaWMgQ29sdW1uIGdldE51bGxJbmRp\nY2F0b3JDb2x1bW4oVmFsdWVNYXBwaW5nIHZhbCwgREJJZGVudGlmaWVyIG5h\nbWUsCiAgICAgICAgVGFibGUgdGFibGUsIGJvb2xlYW4gYWRhcHQpIHsKICAg\nICAgICAvLyByZXNldCBJTwogICAgICAgIHNldENvbHVtbklPKG51bGwpOwoK\nICAgICAgICAvLyBoYXMgdGhlIHVzZXIgZXhwbGljaXRseSB0dXJuZWQgbnVs\nbCBpbmRpY2F0b3Igb2ZmPwogICAgICAgIGlmICghX2Nhbk51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBleHRyYWN0IGdpdmVu\nIG51bGwtaW5kIGNvbHVtbgogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0g\nZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbiBnaXZlbiA9IChjb2xzLmlz\nRW1wdHkoKSkgPyBudWxsIDogKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAg\nICAgTWFwcGluZ0RlZmF1bHRzIGRlZiA9IHZhbC5nZXRNYXBwaW5nUmVwb3Np\ndG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpOwogICAgICAgIGlmIChnaXZl\nbiA9PSBudWxsICYmICghYWRhcHQgJiYgIWRlZi5kZWZhdWx0TWlzc2luZ0lu\nZm8oKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1\nbW4gdG1wbGF0ZSA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBEQklkZW50aWZp\nZXIgc05hbWUgPSBEQklkZW50aWZpZXIuYXBwZW5kKG5hbWUsICJfbnVsbCIp\nOwogICAgICAgIHRtcGxhdGUuc2V0SWRlbnRpZmllcihzTmFtZSk7CiAgICAg\nICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAg\nICBpZiAoIWRlZi5wb3B1bGF0ZU51bGxJbmRpY2F0b3JDb2x1bW5zKHZhbCwg\nbmFtZSwgdGFibGUsIG5ldyBDb2x1bW5bXQogICAgICAgICAgICB7IHRtcGxh\ndGUgfSkgJiYgZ2l2ZW4gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGlmIChnaXZlbiAhPSBudWxsICYmIChnaXZlbi5nZXRG\nbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkKICAgICAgICAgICAgfHwg\nZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpKSB7CiAg\nICAgICAgICAgIENvbHVtbklPIGlvID0gbmV3IENvbHVtbklPKCk7CiAgICAg\nICAgICAgIGlvLnNldEluc2VydGFibGUoMCwgIWdpdmVuLmdldEZsYWcoQ29s\ndW1uLkZMQUdfVU5JTlNFUlRBQkxFKSk7CiAgICAgICAgICAgIGlvLnNldFVw\nZGF0YWJsZSgwLCAhZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFU\nQUJMRSkpOwogICAgICAgICAgICBzZXRDb2x1bW5JTyhpbyk7CiAgICAgICAg\nfQoKICAgICAgICBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiAhREJJZGVudGlmaWVy\nLmlzTnVsbChnaXZlbi5nZXRJZGVudGlmaWVyKCkpKSB7CiAgICAgICAgICAg\nIC8vIHRlc3QgaWYgZ2l2ZW4gY29sdW1uIG5hbWUgaXMgYWN0dWFsbHkgYSBm\naWVsZCBuYW1lLCBpbiB3aGljaAogICAgICAgICAgICAvLyBjYXNlIHdlIHVz\nZSBpdHMgY29sdW1uIGFzIHRoZSBudWxsIGluZGljYXRvciBjb2x1bW4KICAg\nICAgICAgICAgQ2xhc3NNYXBwaW5nIGVtYmVkID0gdmFsLmdldEVtYmVkZGVk\nTWFwcGluZygpOwogICAgICAgICAgICBGaWVsZE1hcHBpbmcgZWZtID0gKGVt\nYmVkID09IG51bGwpID8gbnVsbAogICAgICAgICAgICAgICAgOiBlbWJlZC5n\nZXRGaWVsZE1hcHBpbmcoZ2l2ZW4uZ2V0SWRlbnRpZmllcigpLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGlmIChlZm0gIT0gbnVsbCAmJiBlZm0uZ2V0Q29s\ndW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBnaXZlbi5zZXRJ\nZGVudGlmaWVyKGVmbS5nZXRDb2x1bW5zKClbMF0uZ2V0SWRlbnRpZmllcigp\nKTsKICAgICAgICB9CiAgICAgICAgYm9vbGVhbiBjb21wYXQgPSBnaXZlbiA9\nPSBudWxsIHx8IERCSWRlbnRpZmllci5pc051bGwoZ2l2ZW4uZ2V0SWRlbnRp\nZmllcigpKQogICAgICAgICAgICB8fCB0YWJsZSA9PSBudWxsIHx8ICF0YWJs\nZS5pc05hbWVUYWtlbihnaXZlbi5nZXRJZGVudGlmaWVyKCkpOwoKICAgICAg\nICByZXR1cm4gbWVyZ2VDb2x1bW4odmFsLCAibnVsbC1pbmQiLCB0bXBsYXRl\nLCBjb21wYXQsIGdpdmVuLAogICAgICAgICAgICB0YWJsZSwgYWRhcHQsIGRl\nZi5kZWZhdWx0TWlzc2luZ0luZm8oKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTeW5jaHJvbml6ZSBpbnRlcm5hbCBpbmZvcm1hdGlvbiB3aXRoIHRoZSBt\nYXBwaW5nIGRhdGEgZm9yIHRoZSBnaXZlbgogICAgICogdmFsdWUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHN5bmNXaXRoKFZhbHVlTWFwcGluZyB2YWwp\nIHsKICAgICAgICBjbGVhcihmYWxzZSk7CgogICAgICAgIF9jcml0ZXJpYSA9\nIHZhbC5nZXRVc2VDbGFzc0NyaXRlcmlhKCk7CiAgICAgICAgc2V0Q29sdW1u\nSU8odmFsLmdldENvbHVtbklPKCkpOwogICAgICAgIGlmICh2YWwuZ2V0Rm9y\nZWlnbktleSgpICE9IG51bGwgJiYgdmFsLmdldFR5cGVNYXBwaW5nKCkgIT0g\nbnVsbAogICAgICAgICAgICAmJiB2YWwuZ2V0VHlwZU1hcHBpbmcoKS5nZXRU\nYWJsZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZt\nID0gdmFsLmdldEZpZWxkTWFwcGluZygpOwogICAgICAgICAgICBUYWJsZSBs\nb2NhbCA9IChmbS5nZXRKb2luRm9yZWlnbktleSgpICE9IG51bGwpID8gZm0u\nZ2V0VGFibGUoKQogICAgICAgICAgICAgICAgOiBmbS5nZXREZWZpbmluZ01h\ncHBpbmcoKS5nZXRUYWJsZSgpOwogICAgICAgICAgICBUYWJsZSBmb3JlaWdu\nOwogICAgICAgICAgICBpZiAodmFsLmdldEpvaW5EaXJlY3Rpb24oKSA9PSBW\nYWx1ZU1hcHBpbmcuSk9JTl9FWFBFQ1RFRF9JTlZFUlNFKSB7CiAgICAgICAg\nICAgICAgICBmb3JlaWduID0gbG9jYWw7CiAgICAgICAgICAgICAgICBsb2Nh\nbCA9IHZhbC5nZXRUeXBlTWFwcGluZygpLmdldFRhYmxlKCk7CiAgICAgICAg\nICAgICAgICBzZXRKb2luRGlyZWN0aW9uKEpPSU5fRk9SV0FSRCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3JlaWduID0gdmFs\nLmdldFR5cGVNYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAg\nIHNldEpvaW5EaXJlY3Rpb24oKHZhbC5nZXRKb2luRGlyZWN0aW9uKCkgPT0g\nVmFsdWVNYXBwaW5nLkpPSU5fRk9SV0FSRCkKICAgICAgICAgICAgICAgICAg\nICA/IEpPSU5fRk9SV0FSRCA6IEpPSU5fSU5WRVJTRSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgc3luY0ZvcmVpZ25LZXkodmFsLCB2YWwuZ2V0Rm9y\nZWlnbktleSgpLCBsb2NhbCwgZm9yZWlnbik7CiAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgIHN5bmNDb2x1bW5zKHZhbCwgdmFsLmdldENvbHVtbnMoKSwg\nZmFsc2UpOwoKICAgICAgICBzeW5jSW5kZXgodmFsLCB2YWwuZ2V0VmFsdWVJ\nbmRleCgpKTsKICAgICAgICBzeW5jVW5pcXVlKHZhbCwgdmFsLmdldFZhbHVl\nVW5pcXVlKCkpOwoKICAgICAgICAvLyBleHBsaWNpdCBoYW5kbGVyIHN0cmF0\nZWd5IGlmIHRoZSBoYW5kbGVyIGlzbid0IHRoZSBleHBlY3RlZCBkZWZhdWx0\nCiAgICAgICAgaWYgKHZhbC5nZXRIYW5kbGVyKCkgIT0gbnVsbCkgewogICAg\nICAgICAgICBWYWx1ZUhhbmRsZXIgZGVmID0gdmFsLmdldEZpZWxkTWFwcGlu\nZygpLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgICAgICBk\nZWZhdWx0SGFuZGxlcih2YWwpOwogICAgICAgICAgICBpZiAoZGVmID09IG51\nbGwgfHwgdmFsLmdldEhhbmRsZXIoKS5nZXRDbGFzcygpICE9IGRlZi5nZXRD\nbGFzcygpKQogICAgICAgICAgICAgICAgc2V0U3RyYXRlZ3kodmFsLmdldEhh\nbmRsZXIoKS5nZXRDbGFzcygpLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyKGJvb2xlYW4gY2FuRmxhZ3Mp\nIHsKICAgICAgICBzdXBlci5jbGVhcihjYW5GbGFncyk7CiAgICAgICAgaWYg\nKGNhbkZsYWdzKSB7CiAgICAgICAgICAgIF9jcml0ZXJpYSA9IGZhbHNlOwog\nICAgICAgICAgICBfY2FuTnVsbCA9IHRydWU7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGNvcHkoTWFwcGluZ0luZm8gaW5mbykgewogICAg\nICAgIHN1cGVyLmNvcHkoaW5mbyk7CiAgICAgICAgaWYgKCEoaW5mbyBpbnN0\nYW5jZW9mIFZhbHVlTWFwcGluZ0luZm8pKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIFZhbHVlTWFwcGluZ0luZm8gdmluZm8gPSAoVmFsdWVNYXBw\naW5nSW5mbykgaW5mbzsKICAgICAgICBpZiAoIV9jcml0ZXJpYSkKICAgICAg\nICAgICAgX2NyaXRlcmlhID0gdmluZm8uZ2V0VXNlQ2xhc3NDcml0ZXJpYSgp\nOwogICAgICAgIGlmIChfY2FuTnVsbCkKICAgICAgICAgICAgX2Nhbk51bGwg\nPSB2aW5mby5jYW5JbmRpY2F0ZU51bGwoKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSYXcgY29sdW1uIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBM\naXN0PENvbHVtbj4gZ2V0TWFwc0lkQ29sdW1ucygpIHsKICAgICAgICBpZiAo\nX21hcHNJZENvbHMgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gQ29s\nbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiAgX21hcHNJZENvbHM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmF3\nIGNvbHVtbiBkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBz\nSWRDb2x1bW5zKExpc3Q8Q29sdW1uPiBjb2xzKSB7CiAgICAgICAgX21hcHNJ\nZENvbHMgPSBjb2xzOwogICAgfQp9Cg==\n","encoding":"base64"}

