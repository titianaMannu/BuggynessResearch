{"sha":"9da5944132622f56ce45b0427d2686eb61e1485a","node_id":"MDQ6QmxvYjIwNjM2NDo5ZGE1OTQ0MTMyNjIyZjU2Y2U0NWIwNDI3ZDI2ODZlYjYxZTE0ODVh","size":13329,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9da5944132622f56ce45b0427d2686eb61e1485a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEu\nbWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZpZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuVmVyc2lvbk1hcHBpbmdJbmZvOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkluZGV4Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFy\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5NaXhlZExvY2tMZXZlbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0\nZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5K\nYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRl\ncm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk1ldGFEYXRhRXhjZXB0aW9uOwoKLyoqCiAqIFVzZXMgYSBvbmUgb3IgbW9y\nZSBjb2x1bW4ocykgYW5kIGNvcnJlc3BvbmRpbmcgdmVyc2lvbiBvYmplY3Qu\nCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3Ig\nUGluYWtpIFBvZGRhcgogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIENvbHVt\nblZlcnNpb25TdHJhdGVneQogICAgZXh0ZW5kcyBBYnN0cmFjdFZlcnNpb25T\ndHJhdGVneSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVy\nIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChDb2x1bW5W\nZXJzaW9uU3RyYXRlZ3kuY2xhc3MpOwoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjb2RlIGZyb20ge0BsaW5rIEphdmFUeXBlc30gZm9yIHRoZSB2ZXJz\naW9uIHZhbHVlcyB0aGlzCiAgICAgKiBzdHJhdGVneSB1c2VzLiBUaGlzIG1l\ndGhvZCBpcyBvbmx5IHVzZWQgZHVyaW5nIG1hcHBpbmcgaW5zdGFsbGF0aW9u\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgaW50IGdldEphdmFU\neXBlKCk7CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb2RlIGZy\nb20ge0BsaW5rIEphdmFUeXBlc30gZm9yIHRoZSB2ZXJzaW9uIHZhbHVlIHRo\naXMgZ2l2ZW4KICAgICAqIGNvbHVtbiBpbmRleCB1c2VzLiBPbmx5IHVzZWQg\naWYgdGhlIHZlcnNpb24gc3RyYXRlZ3kgZW1wbG95cyBtb3JlIHRoYW4KICAg\nICAqIG9uZSBjb2x1bW4uIAogICAgICovCiAgICBwcm90ZWN0ZWQgaW50IGdl\ndEphdmFUeXBlKGludCBpKSB7CiAgICAgICAgdGhyb3cgbmV3IEFic3RyYWN0\nTWV0aG9kRXJyb3IoX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAibXVsdGkt\nY29sdW1uLXZlcnNpb24tdW5zdXBwb3J0ZWQiLGdldEFsaWFzKCkpLnRvU3Ry\naW5nKCkpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbmV4dCB2ZXJzaW9uIGdpdmVuIHRoZSBjdXJyZW50IG9uZSwgd2hpY2ggbWF5\nIGJlIG51bGwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBPYmpl\nY3QgbmV4dFZlcnNpb24oT2JqZWN0IHZlcnNpb24pOwoKICAgIC8qKgogICAg\nICogQ29tcGFyZSB0aGUgdHdvIHZlcnNpb25zLiBEZWZhdWx0cyB0byBhc3N1\nbWluZyB0aGUgdmVyc2lvbiBvYmplY3RzCiAgICAgKiBpbXBsZW1lbnQge0Bs\naW5rIENvbXBhcmFibGV9LgogICAgICoKICAgICAqIEBzZWUgQ29tcGFyYXRv\nciNjb21wYXJlCiAgICAgKi8KICAgIHByb3RlY3RlZCBpbnQgY29tcGFyZShP\nYmplY3QgdjEsIE9iamVjdCB2MikgewogICAgICAgIGlmICh2MSA9PSB2MikK\nICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKHYxID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBpZiAodjIgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgCiAgICAgICAgaWYg\nKHYxLmdldENsYXNzKCkuaXNBcnJheSgpKSB7CiAgICAgICAgCWlmICghdjIu\nZ2V0Q2xhc3MoKS5pc0FycmF5KCkpCiAgICAgICAgCQl0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAJcmV0dXJuIGNvbXBhcmUoKE9i\namVjdFtdKXYxLCAoT2JqZWN0W10pdjIpOwogICAgICAgIH0KICAgICAgICBp\nZiAodjEuZ2V0Q2xhc3MoKSAhPSB2Mi5nZXRDbGFzcygpKSB7CiAgICAgICAg\nICAgIGlmICh2MSBpbnN0YW5jZW9mIE51bWJlciAmJiAhKHYxIGluc3RhbmNl\nb2YgQmlnRGVjaW1hbCkpCiAgICAgICAgICAgICAgICB2MSA9IG5ldyBCaWdE\nZWNpbWFsKCgoTnVtYmVyKSB2MSkuZG91YmxlVmFsdWUoKSk7CgogICAgICAg\nICAgICBpZiAodjIgaW5zdGFuY2VvZiBOdW1iZXIgJiYgISh2MiBpbnN0YW5j\nZW9mIEJpZ0RlY2ltYWwpKQogICAgICAgICAgICAgICAgdjIgPSBuZXcgQmln\nRGVjaW1hbCgoKE51bWJlcikgdjIpLmRvdWJsZVZhbHVlKCkpOwogICAgICAg\nIH0KCiAgICAgICAgcmV0dXJuICgoQ29tcGFyYWJsZSkgdjEpLmNvbXBhcmVU\nbyh2Mik7CiAgICB9CgoKCS8qKgoJICogQ29tcGFyZSBlYWNoIGVsZW1lbnQg\nb2YgdGhlIGdpdmVuIGFycmF5cyB0aGF0IG11c3QgYmUgb2YgZXF1YWwgc2l6\nZS4gCiAgICAgKiBUaGUgZ2l2ZW4gYXJyYXkgdmFsdWVzIHJlcHJlc2VudCB2\nZXJzaW9uIHZhbHVlcyBhbmQgdGhlIHJlc3VsdCBkZXNpZ25hdGUKCSAqIHdo\nZXRoZXIgZmlyc3QgdmVyc2lvbiBpcyBlYXJsaWVyLCBzYW1lIG9yIGxhdGVy\nIHRoYW4gdGhlIHNlY29uZCBvbmUuCgkgKiAKCSAqIEByZXR1cm4gSWYgYW55\nIGVsZW1lbnQgb2YgYTEgaXMgbGF0ZXIgdGhhbiBjb3JyZXNwb25kaW5nIGVs\nZW1lbnQgb2YKICAgICAqIGEyIHRoZW4gcmV0dXJucyAxIGkuZS4gdGhlIGZp\ncnN0IHZlcnNpb24gaXMgbGF0ZXIgdGhhbiB0aGUgc2Vjb25kCiAgICAgKiB2\nZXJzaW9uLiBJZiBlYWNoIGVsZW1lbnQgb2YgYTEgaXMgZXF1YWwgdG8gY29y\ncmVzcG9uZGluZyBlbGVtZW50IG9mIGEyCiAgICAgKiB0aGVuIHJldHVybiAw\nIGkuZS4gdGhlIGZpcnN0IHZlcnNpb24gaXMgc2FtZSBhcyB0aGUgc2Vjb25k\nIHZlcnNpb24uCgkgKiBlbHNlIHJldHVybiBhIG5lZ2F0aXZlIG51bWJlciBp\nLmUuIHRoZSBmaXJzdCB2ZXJzaW9uIGlzIGVhcmxpZXIgdGhhbiAKCSAqIHRo\nZSBzZWNvbmQgdmVyc2lvbi4KCSAqLwoJcHJvdGVjdGVkIGludCBjb21wYXJl\nKE9iamVjdFtdIGExLCBPYmplY3RbXSBhMikgewoJCWlmIChhMS5sZW5ndGgg\nIT0gYTIubGVuZ3RoKQoJICAgIAl0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKCQlpbnQgdG90YWwgPSAwOwoJCWZvciAoaW50IGkgPSAwOyBpIDwg\nYTEubGVuZ3RoOyBpKyspIHsKCQkJaW50IGMgPSAgY29tcGFyZShhMVtpXSwg\nYTJbaV0pOwoJCQlpZiAoYyA+IDApIAoJCQkJcmV0dXJuIDE7CgkJCXRvdGFs\nICs9IGM7CgkJfQoJCXJldHVybiB0b3RhbDsKCX0KCQogICAgcHVibGljIHZv\naWQgbWFwKGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nY2xzID0gdmVycy5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoY2xz\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwKICAg\nICAgICAgICAgfHwgY2xzLmdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub3QtYmFzZS12ZXJzIiwgY2xzKSk7CgogICAgICAgIFZlcnNp\nb25NYXBwaW5nSW5mbyBpbmZvID0gdmVycy5nZXRNYXBwaW5nSW5mbygpOwog\nICAgICAgIGluZm8uYXNzZXJ0Tm9Kb2luKHZlcnMsIHRydWUpOwogICAgICAg\nIGluZm8uYXNzZXJ0Tm9Gb3JlaWduS2V5KHZlcnMsICFhZGFwdCk7CiAgICAg\nICAgaW5mby5hc3NlcnROb1VuaXF1ZSh2ZXJzLCBmYWxzZSk7CiAgICAgICAg\naWYgKGluZm8uZ2V0Q29sdW1ucygpLnNpemUoKSA+IDEpIHsKICAgICAgICAJ\nQ29sdW1uW10gdGVtcGxhdGVzID0gbmV3IENvbHVtbltpbmZvLmdldENvbHVt\nbnMoKS5zaXplKCldOwogICAgICAgIAlmb3IgKGludCBpID0gMDsgaSA8IGlu\nZm8uZ2V0Q29sdW1ucygpLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAg\nICB0ZW1wbGF0ZXNbaV0gPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgCQlDb2x1\nbW4gaW5mb0NvbHVtbiA9IChDb2x1bW4paW5mby5nZXRDb2x1bW5zKCkuZ2V0\nKGkpOwogICAgICAgIAkJdGVtcGxhdGVzW2ldLnNldFRhYmxlSWRlbnRpZmll\ncihpbmZvQ29sdW1uLmdldFRhYmxlSWRlbnRpZmllcigpKTsKICAgICAgICAJ\nCXRlbXBsYXRlc1tpXS5zZXRUeXBlKGluZm9Db2x1bW4uZ2V0VHlwZSgpKTsK\nICAgICAgICAJCXRlbXBsYXRlc1tpXS5zZXRTaXplKGluZm9Db2x1bW4uZ2V0\nU2l6ZSgpKTsKICAgICAgICAgICAgICAgIHRlbXBsYXRlc1tpXS5zZXREZWNp\nbWFsRGlnaXRzKGluZm9Db2x1bW4uZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAg\nICAgICAJCXRlbXBsYXRlc1tpXS5zZXRKYXZhVHlwZShnZXRKYXZhVHlwZShp\nKSk7CiAgICAgICAgCQl0ZW1wbGF0ZXNbaV0uc2V0SWRlbnRpZmllcihpbmZv\nQ29sdW1uLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgCX0KICAgICAgICAJ\nQ29sdW1uW10gY29scyA9IGluZm8uZ2V0Q29sdW1ucyh2ZXJzLCB0ZW1wbGF0\nZXMsIGFkYXB0KTsKICAgICAgICAJZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xz\nLmxlbmd0aDsgaSsrKQogICAgICAgIAkJY29sc1tpXS5zZXRWZXJzaW9uU3Ry\nYXRlZ3kodGhpcyk7CiAgICAgICAgCXZlcnMuc2V0Q29sdW1ucyhjb2xzKTsK\nICAgICAgICAJdmVycy5zZXRDb2x1bW5JTyhpbmZvLmdldENvbHVtbklPKCkp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgQ29sdW1uIHRtcGxhdGUg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlw\nZShnZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICBEQkRpY3Rpb25hcnkgZGlj\ndCA9IHZlcnMuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXREQkRpY3Rpb25h\ncnkoKTsKICAgICAgICAgICBEQklkZW50aWZpZXIgdmVyc05hbWUgPSBEQklk\nZW50aWZpZXIubmV3Q29sdW1uKCJ2ZXJzbiIsIGRpY3QgIT0gbnVsbCA/IGRp\nY3QuZGVsaW1pdEFsbCgpIDogZmFsc2UpOwogICAgICAgICAgIHRtcGxhdGUu\nc2V0SWRlbnRpZmllcih2ZXJzTmFtZSk7CgogICAgICAgICAgIENvbHVtbltd\nIGNvbHMgPSBpbmZvLmdldENvbHVtbnModmVycywgbmV3IENvbHVtbltdeyB0\nbXBsYXRlIH0sCiAgICAgICAgICAgICAgICAgICBhZGFwdCk7CiAgICAgICAg\nICAgY29sc1swXS5zZXRWZXJzaW9uU3RyYXRlZ3kodGhpcyk7CiAgICAgICAg\nICAgdmVycy5zZXRDb2x1bW5zKGNvbHMpOwogICAgICAgICAgIHZlcnMuc2V0\nQ29sdW1uSU8oaW5mby5nZXRDb2x1bW5JTygpKTsKCiAgICAgICAgICAgSW5k\nZXggaWR4ID0gaW5mby5nZXRJbmRleCh2ZXJzLCBjb2xzLCBhZGFwdCk7CiAg\nICAgICAgICAgdmVycy5zZXRJbmRleChpZHgpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbHVtbltdIGNvbHMgPSB2\nZXJzLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5JTyBpbyA9IHZlcnMu\nZ2V0Q29sdW1uSU8oKTsKICAgICAgICBPYmplY3QgaW5pdGlhbCA9IG5leHRW\nZXJzaW9uKG51bGwpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29s\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBSb3cgcm93ID0gcm0uZ2V0\nUm93KGNvbHNbaV0uZ2V0VGFibGUoKSwgUm93LkFDVElPTl9JTlNFUlQsIHNt\nLAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAgICBpZiAo\naW8uaXNJbnNlcnRhYmxlKGksIGluaXRpYWwgPT0gbnVsbCkpCiAgICAgICAg\nICAgICAgICByb3cuc2V0T2JqZWN0KGNvbHNbaV0sIGdldENvbHVtblZhbHVl\nKGluaXRpYWwsIGkpKTsKICAgICAgICB9CiAgICAgICAgLy8gc2V0IGluaXRp\nYWwgdmVyc2lvbiBpbnRvIHN0YXRlIG1hbmFnZXIKICAgICAgICBPYmplY3Qg\nbmV4dFZlcnNpb247CiAgICAgICAgbmV4dFZlcnNpb24gPSBpbml0aWFsOwog\nICAgICAgIHNtLnNldE5leHRWZXJzaW9uKG5leHRWZXJzaW9uKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbHVtbltdIGNvbHMgPSB2\nZXJzLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8\nIGNvbHMubGVuZ3RoID09IDAgfHwKICAgICAgICAgICAgIXNtLmlzRGlydHko\nKSAmJiAhc20uaXNWZXJzaW9uVXBkYXRlUmVxdWlyZWQoKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBPYmplY3QgY3VyVmVyc2lvbiA9IHNtLmdl\ndFZlcnNpb24oKTsKICAgICAgICBPYmplY3QgbmV4dFZlcnNpb24gPSBuZXh0\nVmVyc2lvbihjdXJWZXJzaW9uKTsKCgogICAgICAgIC8vIHNldCB3aGVyZSBh\nbmQgdXBkYXRlIGNvbmRpdGlvbnMgb24gcm93CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFJv\ndyByb3cgPSBybS5nZXRSb3coY29sc1tpXS5nZXRUYWJsZSgpLCBSb3cuQUNU\nSU9OX1VQREFURSwgc20sCiAgICAgICAgICAgICAgICAgICAgdHJ1ZSk7CiAg\nICAgICAgICAgIHJvdy5zZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpOwogICAgICAgICAgICBpZiAoY3VyVmVyc2lvbiAhPSBudWxs\nICYmIHNtLmlzVmVyc2lvbkNoZWNrUmVxdWlyZWQoKSkgewogICAgICAgICAg\nICAgICAgcm93LndoZXJlT2JqZWN0KGNvbHNbaV0sIGdldENvbHVtblZhbHVl\nKGN1clZlcnNpb24sIGkpKTsKICAgICAgICAgICAgICAgIGlmIChpc1NlY29u\nZGFyeUNvbHVtbihjb2xzW2ldLCBzbSkpIHsKICAgICAgICAgICAgICAgIAlG\nb3JlaWduS2V5W10gZmtzID0gY29sc1tpXS5nZXRUYWJsZSgpLmdldEZvcmVp\nZ25LZXlzKCk7CiAgICAgICAgICAgICAgICAJZm9yIChGb3JlaWduS2V5IGZr\nIDogZmtzKSB7CiAgICAgICAgICAgICAgICAJCXJvdy53aGVyZUZvcmVpZ25L\nZXkoZmssIHNtKTsKICAgICAgICAgICAgICAgIAl9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZlcnMuZ2V0Q29s\ndW1uSU8oKS5pc1VwZGF0YWJsZShpLCBuZXh0VmVyc2lvbiA9PSBudWxsKSkK\nICAgICAgICAgICAgICAgIHJvdy5zZXRPYmplY3QoY29sc1tpXSwgZ2V0Q29s\ndW1uVmFsdWUobmV4dFZlcnNpb24sIGkpKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChuZXh0VmVyc2lvbiAhPSBudWxsKQogICAgICAgICAgICBzbS5zZXRO\nZXh0VmVyc2lvbihuZXh0VmVyc2lvbik7CiAgICB9CgogICAgcHVibGljIHZv\naWQgZGVsZXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBz\ndG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdmVycy5nZXRDb2x1bW5z\nKCk7CgogICAgICAgIE9iamVjdCBjdXJWZXJzaW9uID0gc20uZ2V0VmVyc2lv\nbigpOwogICAgICAgIE9iamVjdCBjdXI7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFJvdyBy\nb3cgPSBybS5nZXRSb3coY29sc1tpXS5nZXRUYWJsZSgpLAogICAgICAgICAg\nICAJUm93LkFDVElPTl9ERUxFVEUsIHNtLCB0cnVlKTsKICAgICAgICAgICAg\ncm93LnNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSk7\nCiAgICAgICAgICAgIGN1ciA9IGdldENvbHVtblZhbHVlKGN1clZlcnNpb24s\nIGkpOwogICAgICAgICAgICAvLyBzZXQgd2hlcmUgYW5kIHVwZGF0ZSBjb25k\naXRpb25zIG9uIHJvdwogICAgICAgICAgICBpZiAoY3VyICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIHJvdy53aGVyZU9iamVjdChjb2xzW2ldLCBjdXIp\nOwogICAgICAgICAgICAgICAgaWYgKGlzU2Vjb25kYXJ5Q29sdW1uKGNvbHNb\naV0sIHNtKSkgewogICAgICAgICAgICAgICAgCUZvcmVpZ25LZXlbXSBma3Mg\nPSBjb2xzW2ldLmdldFRhYmxlKCkuZ2V0Rm9yZWlnbktleXMoKTsKICAgICAg\nICAgICAgICAgIAlmb3IgKEZvcmVpZ25LZXkgZmsgOiBma3MpIHsKICAgICAg\nICAgICAgICAgIAkJcm93LndoZXJlRm9yZWlnbktleShmaywgc20pOwogICAg\nICAgICAgICAgICAgCX0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3Qo\nU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcpIHsKICAgICAgICBz\nZWwuc2VsZWN0KHZlcnMuZ2V0Q29sdW1ucygpKTsKICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGxvYWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSZXN1bHQgcmVzKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHR5cGlj\nYWxseSBpZiBvbmUgdmVyc2lvbiBjb2x1bW4gaXMgaW4gdGhlIHJlc3VsdCwg\ndGhleSBhbGwgYXJlLCBzbwogICAgICAgIC8vIG9wdGltaXplIGJ5IGNoZWNr\naW5nIGZvciB0aGUgZmlyc3Qgb25lIGJlZm9yZSBkb2luZyBhbnkgcmVhbCB3\nb3JrCiAgICAgICAgQ29sdW1uW10gY29scyA9IHZlcnMuZ2V0Q29sdW1ucygp\nOwogICAgICAgIGlmICghcmVzLmNvbnRhaW5zKGNvbHNbMF0pKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBw\nb3B1bGF0ZUZyb21SZXN1bHQocmVzKTsKCiAgICAgICAgLy8gT1BFTkpQQS02\nNjIgQWxsb3cgYSBudWxsIFN0YXRlTWFuYWdlciBiZWNhdXNlIHRoaXMgbWV0\naG9kIG1heSBqdXN0IGJlCiAgICAgICAgLy8gaW52b2tlZCB0byBnZXQgdGhl\nIHJlc3VsdCBvZiBwcm9qZWN0aW9uIHF1ZXJ5CiAgICAgICAgaWYgKHNtICE9\nIG51bGwpCiAgICAgICAgCXNtLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAg\nICAgcmV0dXJuIHZlcnNpb247CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nY2hlY2tWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBib29sZWFuIHVwZGF0ZVZlcnNpb24pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uW10gY29s\ncyA9IHZlcnMuZ2V0Q29sdW1ucygpOwogICAgICAgIFNlbGVjdCBzZWwgPSBz\ndG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgc2Vs\nLnNlbGVjdChjb2xzKTsKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNt\nLmdldE9iamVjdElkKCksIHZlcnMuZ2V0Q2xhc3NNYXBwaW5nKCksIHN0b3Jl\nKTsKCiAgICAgICAgLy8gTm8gbmVlZCB0byBsb2NrIHZlcnNpb24gZmllbGQg\nKGkuZS4gb3B0aW1pc3RpYyksIGV4Y2VwdCB3aGVuIHZlcnNpb24gdXBkYXRl\nIGlzIHJlcXVpcmVkIChlLmcuIHJlZnJlc2gpIAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgICAgICBpZiAoIXVwZGF0ZVZlcnNpb24gJiYgZmV0Y2gu\nZ2V0UmVhZExvY2tMZXZlbCgpID49IE1peGVkTG9ja0xldmVscy5MT0NLX1BF\nU1NJTUlTVElDX1JFQUQpIHsKICAgICAgICAgICAgZmV0Y2ggPSAoSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbikgZmV0Y2guY2xvbmUoKTsKICAgICAgICAgICAg\nZmV0Y2guc2V0UmVhZExvY2tMZXZlbChNaXhlZExvY2tMZXZlbHMuTE9DS19O\nT05FKTsKICAgICAgICB9CiAgICAgICAgUmVzdWx0IHJlcyA9IHNlbC5leGVj\ndXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKCFyZXMubmV4dCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICAgICAgT2JqZWN0IG1lbVZlcnNpb24gPSBzbS5nZXRWZXJz\naW9uKCk7CiAgICAgICAgICAgIE9iamVjdCBkYlZlcnNpb24gID0gcG9wdWxh\ndGVGcm9tUmVzdWx0KHJlcyk7CiAgICAgICAgICAgIGJvb2xlYW4gcmVmcmVz\naCAgID0gY29tcGFyZShtZW1WZXJzaW9uLCBkYlZlcnNpb24pIDwgMDsKCiAg\nICAgICAgICAgIGlmICh1cGRhdGVWZXJzaW9uKQogICAgICAgICAgICAgICAg\nc20uc2V0VmVyc2lvbihkYlZlcnNpb24pOwogICAgICAgICAgICByZXR1cm4g\nIXJlZnJlc2g7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBpbnQgY29t\ncGFyZVZlcnNpb24oT2JqZWN0IHYxLCBPYmplY3QgdjIpIHsKICAgICAgICBp\nZiAodjEgPT0gdjIpCiAgICAgICAgICAgIHJldHVybiBTdG9yZU1hbmFnZXIu\nVkVSU0lPTl9TQU1FOwogICAgICAgIGlmICh2MSA9PSBudWxsIHx8IHYyID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBTdG9yZU1hbmFnZXIuVkVSU0lP\nTl9ESUZGRVJFTlQ7CgogICAgICAgIGludCBjbXAgPSBjb21wYXJlKHYxLCB2\nMik7CiAgICAgICAgaWYgKGNtcCA8IDApCiAgICAgICAgICAgIHJldHVybiBT\ndG9yZU1hbmFnZXIuVkVSU0lPTl9FQVJMSUVSOwogICAgICAgIGlmIChjbXAg\nPiAwKQogICAgICAgICAgICByZXR1cm4gU3RvcmVNYW5hZ2VyLlZFUlNJT05f\nTEFURVI7CiAgICAgICAgcmV0dXJuIFN0b3JlTWFuYWdlci5WRVJTSU9OX1NB\nTUU7CiAgICB9CiAgICAgICAgCiAgICAvKioKICAgICAqIFBvcHVsYXRlIHZh\nbHVlcyBvZiBhIHZlcnNpb24gb2JqZWN0IGZyb20gdGhlIGdpdmVuIHJlc3Vs\ndC4KICAgICAqIAogICAgICogQHJldHVybiBhIHNpbmdsZSBPYmplY3Qgb3Ig\nYW4gYXJyYXkgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdXNpbmcgYSBzaW5nbGUK\nICAgICAqIG9yIG11bHRpcGxlIGNvbHVtbnMgYmVpbmcgdXNlZCBmb3IgcmVw\ncmVzZW50YXRpb24uCiAgICAqLwogICAgT2JqZWN0IHBvcHVsYXRlRnJvbVJl\nc3VsdChSZXN1bHQgcmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAocmVzID09IG51bGwpCiAJCXJldHVybiBudWxsOwogICAgCQogICAg\nICAgIENvbHVtbltdIGNvbHMgPSB2ZXJzLmdldENvbHVtbnMoKTsKICAgICAg\nICBPYmplY3RbXSB2YWx1ZXMgPSBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgdmFsdWVzW2ldID0gcmVzLmdldE9iamVjdChjb2xz\nW2ldLCAtMSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoY29s\ncy5sZW5ndGggPT0gMSkgPyB2YWx1ZXNbMF0gOiB2YWx1ZXM7CiAgICB9CiAg\nICAKICAgIE9iamVjdCBnZXRDb2x1bW5WYWx1ZShPYmplY3QgbywgaW50IGlk\neCkgewogICAgCWlmIChvID09IG51bGwpIAogICAgCQlyZXR1cm4gbnVsbDsK\nICAgIAlpZiAoby5nZXRDbGFzcygpLmlzQXJyYXkoKSkKICAgIAkJcmV0dXJu\nIEFycmF5LmdldChvLCBpZHgpOwogICAgCXJldHVybiBvOwogICAgfQogICAg\nCiAgICBib29sZWFuIGlzU2Vjb25kYXJ5Q29sdW1uKENvbHVtbiBjb2wsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgIAlDbGFzc01hcHBpbmcgbWFw\ncGluZyA9IChDbGFzc01hcHBpbmcpc20uZ2V0TWV0YURhdGEoKTsKICAgIAl3\naGlsZSAobWFwcGluZyAhPSBudWxsKSB7CiAgICAJCWlmIChtYXBwaW5nLmdl\ndFRhYmxlKCkgPT0gY29sLmdldFRhYmxlKCkpCiAgICAJCQlyZXR1cm4gZmFs\nc2U7CiAgICAJCWVsc2UKICAgIAkJCW1hcHBpbmcgPSBtYXBwaW5nLmdldFBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgIAl9CiAgICAJcmV0dXJuIHRydWU7\nCiAgICB9Cn0K\n","encoding":"base64"}

