{"sha":"1db2491daf02d31ec7abd7ba7d8915b57d9981bc","node_id":"MDQ6QmxvYjIwNjM2NDoxZGIyNDkxZGFmMDJkMzFlYzdhYmQ3YmE3ZDg5MTViNTdkOTk4MWJj","size":6539,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1db2491daf02d31ec7abd7ba7d8915b57d9981bc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1w\nb3J0IGphdmEuc3FsLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuKjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVy\nLkRCSWRlbnRpZmllcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC4qOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJE\naWN0aW9uYXJ5OwoKLyoqCiAqIDxwPkhhbmRsZXIgZm9yIGVtYmVkZGVkIG9i\namVjdHMgYXMgZWxlbWVudHMgb2YgYSBjb2xsZWN0aW9uIG9yIG1hcC4gIEZv\ncgogKiBlbWJlZGRlZCBvYmplY3RzIGFzIGZpZWxkcywgdXNlIHRoZSBtb3Jl\nIHBvd2VyZnVsCiAqIHtAbGluayBFbWJlZEZpZWxkU3RyYXRlZ3l9LjwvcD4K\nICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wLCAxLjEu\nMAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRWxlbWVudEVtYmVk\nVmFsdWVIYW5kbGVyCiAgICBleHRlbmRzIEVtYmVkVmFsdWVIYW5kbGVyCiAg\nICBpbXBsZW1lbnRzIFJlbGF0aW9uSWQgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoRWxlbWVudEVtYmVkVmFsdWVIYW5kbGVyLmNsYXNzKTsKCiAg\nICBwcml2YXRlIFZhbHVlTWFwcGluZyBfdm0gPSBudWxsOwogICAgcHJpdmF0\nZSBDb2x1bW5bXSBfY29scyA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdFtd\nIF9hcmdzID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9udWxsSWR4ID0gLTE7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX3N5bnRoZXRpYyA9IGZhbHNlOwoKICAg\nIC8qKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIENv\nbHVtbltdIG1hcChWYWx1ZU1hcHBpbmcgdm0sIFN0cmluZyBuYW1lLCBDb2x1\nbW5JTyBpbywKICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgREJE\naWN0aW9uYXJ5IGRpY3QgPSB2bS5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdl\ndERCRGljdGlvbmFyeSgpOwogICAgICAgIERCSWRlbnRpZmllciBjb2xOYW1l\nID0gREJJZGVudGlmaWVyLm5ld0NvbHVtbihuYW1lLCBkaWN0ICE9IG51bGwg\nPyBkaWN0LmRlbGltaXRBbGwoKSA6IGZhbHNlKTsKICAgICAgICByZXR1cm4g\nbWFwKHZtLCBjb2xOYW1lLCBpbywgYWRhcHQpOwogICAgfQogICAgCiAgICBw\ndWJsaWMgQ29sdW1uW10gbWFwKFZhbHVlTWFwcGluZyB2bSwgREJJZGVudGlm\naWVyIG5hbWUsIENvbHVtbklPIGlvLAogICAgICAgIGJvb2xlYW4gYWRhcHQp\nIHsKICAgICAgICBMaW5rZWRMaXN0IGNvbHMgPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgIExpbmtlZExpc3QgYXJncyA9IG5ldyBMaW5rZWRMaXN0KCk7\nCiAgICAgICAgc3VwZXIubWFwKHZtLCBuYW1lLCBpbywgYWRhcHQsIGNvbHMs\nIGFyZ3MpOwoKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0gdm0u\nZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgQ29sdW1uIG51bGxJbmQgPSB2aW5m\nby5nZXROdWxsSW5kaWNhdG9yQ29sdW1uKHZtLCBuYW1lLAogICAgICAgICAg\nICB2bS5nZXRGaWVsZE1hcHBpbmcoKS5nZXRUYWJsZSgpLCBhZGFwdCk7CiAg\nICAgICAgaWYgKG51bGxJbmQgIT0gbnVsbCkKICAgICAgICAgICAgdm0uc2V0\nQ29sdW1ucyhuZXcgQ29sdW1uW117IG51bGxJbmQgfSk7CgogICAgICAgIC8v\nIHJlY29yZCBpbmRleCBvZiBudWxsIGluZGljYXRvciBjb2x1bW4gYW5kIHdo\nZXRoZXIgaXQgaXMgc3ludGhldGljCiAgICAgICAgaWYgKG51bGxJbmQgIT0g\nbnVsbCkgewogICAgICAgICAgICBfbnVsbElkeCA9IGNvbHMuaW5kZXhPZihu\ndWxsSW5kKTsKICAgICAgICAgICAgaWYgKF9udWxsSWR4ID09IC0xKSB7CiAg\nICAgICAgICAgICAgICBjb2xzLmFkZEZpcnN0KG51bGxJbmQpOwogICAgICAg\nICAgICAgICAgYXJncy5hZGRGaXJzdChudWxsKTsKICAgICAgICAgICAgICAg\nIF9udWxsSWR4ID0gMDsKICAgICAgICAgICAgICAgIF9zeW50aGV0aWMgPSB0\ncnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfdm0gPSB2\nbTsKICAgICAgICBfY29scyA9IChDb2x1bW5bXSkgY29scy50b0FycmF5KG5l\ndyBDb2x1bW5bY29scy5zaXplKCldKTsKICAgICAgICBfYXJncyA9IGFyZ3Mu\ndG9BcnJheSgpOwogICAgICAgIHJldHVybiBfY29sczsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBvYmplY3RWYWx1ZVJlcXVpcmVzTG9hZChWYWx1ZU1h\ncHBpbmcgdm0pIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFJlc3VsdEFyZ3VtZW50KFZhbHVlTWFwcGluZyB2\nbSkgewogICAgICAgIHJldHVybiBfYXJnczsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IHRvRGF0YVN0b3JlVmFsdWUoVmFsdWVNYXBwaW5nIHZtLCBPYmpl\nY3QgdmFsLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgZW0gPSBzdG9yZS5nZXRDb250ZXh0KCkuZ2V0\nU3RhdGVNYW5hZ2VyKHZhbCk7CiAgICAgICAgT2JqZWN0IHJ2YWwgPSBudWxs\nOwogICAgICAgIGlmIChfY29scy5sZW5ndGggPiAxKQogICAgICAgICAgICBy\ndmFsID0gbmV3IE9iamVjdFtfY29scy5sZW5ndGhdOwoKICAgICAgICAvLyBz\nZXQgbnVsbCBpbmRpY2F0b3IgY29sdW1uCiAgICAgICAgaW50IGlkeCA9IDA7\nCiAgICAgICAgaWYgKF9zeW50aGV0aWMpIHsKICAgICAgICAgICAgT2JqZWN0\nIGN2YWwgPSAoKEVtYmVkZGVkQ2xhc3NTdHJhdGVneSkgdm0uZ2V0RW1iZWRk\nZWRNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICBnZXRTdHJhdGVneSgpKS5n\nZXROdWxsSW5kaWNhdG9yVmFsdWUoZW0pOwogICAgICAgICAgICBpZiAoX2Nv\nbHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gY3ZhbDsK\nICAgICAgICAgICAgKChPYmplY3RbXSkgcnZhbClbaWR4KytdID0gY3ZhbDsK\nICAgICAgICB9CgogICAgICAgIHJldHVybiBzdXBlci50b0RhdGFTdG9yZVZh\nbHVlKGVtLCB2bSwgc3RvcmUsIF9jb2xzLCBydmFsLCBpZHgpOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgdG9PYmplY3RWYWx1ZShWYWx1ZU1hcHBpbmcg\ndm0sIE9iamVjdCB2YWwsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8v\nIGNoZWNrIG51bGwgaW5kaWNhdG9yIGZpcnN0CiAgICAgICAgaWYgKF9udWxs\nSWR4ICE9IC0xKSB7CiAgICAgICAgICAgIE9iamVjdCBudmFsOwogICAgICAg\nICAgICBpZiAoX2NvbHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICBu\ndmFsID0gdmFsOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBu\ndmFsID0gKChPYmplY3RbXSkgdmFsKVtfbnVsbElkeF07CiAgICAgICAgICAg\nIGlmICgoKEVtYmVkZGVkQ2xhc3NTdHJhdGVneSkgdm0uZ2V0RW1iZWRkZWRN\nYXBwaW5nKCkuCiAgICAgICAgICAgICAgICBnZXRTdHJhdGVneSgpKS5pbmRp\nY2F0ZXNOdWxsKG52YWwpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgZW1iZWRkZWQgaW5zdGFu\nY2UKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVtID0gc3RvcmUuZ2V0\nQ29udGV4dCgpLmVtYmVkKG51bGwsIG51bGwsIHNtLCB2bSk7CiAgICAgICAg\naW50IGlkeCA9IChfc3ludGhldGljKSA/IDEgOiAwOwogICAgICAgIHN1cGVy\nLnRvT2JqZWN0VmFsdWUoZW0sIHZtLCB2YWwsIHN0b3JlLCBmZXRjaCwgX2Nv\nbHMsIGlkeCk7CgogICAgICAgIC8vIGFmdGVyIGxvYWRpbmcgZXZlcnl0aGlu\nZyBmcm9tIHJlc3VsdCwgbG9hZCB0aGUgcmVzdCBvZiB0aGUKICAgICAgICAv\nLyBjb25maWd1cmVkIGZpZWxkcwogICAgICAgIGVtLmxvYWQoZmV0Y2gpOwog\nICAgICAgIHJldHVybiBlbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVs\nYXRpb25JZCBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2JqZWN0IHRvUmVsYXRpb25EYXRh\nU3RvcmVWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBDb2x1bW4gY29s\nKSB7CiAgICAgICAgcmV0dXJuIHRvUmVsYXRpb25EYXRhU3RvcmVWYWx1ZShz\nbSwgY29sLCAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBo\nZWxwZXIuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IHRvUmVsYXRpb25E\nYXRhU3RvcmVWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBDb2x1bW4g\nY29sLAogICAgICAgIGludCBpZHgpIHsKICAgICAgICBGaWVsZE1hcHBpbmcg\nZmllbGQgPSBmaW5kRmllbGQoY29sLCBpZHgpOwogICAgICAgIGlmIChmaWVs\nZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oKTsKCiAgICAgICAgaWYgKGZpZWxkLmdldEhhbmRsZXIoKSBpbnN0\nYW5jZW9mIFJlbGF0aW9uSWQpCiAgICAgICAgICAgIHJldHVybiAoKFJlbGF0\naW9uSWQpIGZpZWxkLmdldFN0cmF0ZWd5KCkpLgogICAgICAgICAgICAgICAg\ndG9SZWxhdGlvbkRhdGFTdG9yZVZhbHVlKHNtLCBjb2wpOwogICAgICAgIGlm\nIChmaWVsZC5nZXRTdHJhdGVneSgpIGluc3RhbmNlb2YgUmVsYXRpb25JZCkK\nICAgICAgICAgICAgcmV0dXJuICgoUmVsYXRpb25JZCkgZmllbGQuZ2V0U3Ry\nYXRlZ3koKSkuCiAgICAgICAgICAgICAgICB0b1JlbGF0aW9uRGF0YVN0b3Jl\nVmFsdWUoc20sIGNvbCk7CiAgICAgICAgcmV0dXJuIHRvUmVsYXRpb25EYXRh\nU3RvcmVWYWx1ZShzbSwgY29sLCBmaWVsZC5nZXRJbmRleCgpICsgMSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBmaXJzdCBmaWVsZCBtYXBw\naW5nIHRoYXQgdXNlcyB0aGUgZ2l2ZW4gY29sdW1uIHN0YXJ0aW5nIHdpdGgK\nICAgICAqIHRoZSBnaXZlbiBmaWVsZCBpbmRleC4KICAgICAqLwogICAgcHJp\ndmF0ZSBGaWVsZE1hcHBpbmcgZmluZEZpZWxkKENvbHVtbiBjb2wsIGludCBp\nZHgpIHsKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBfdm0uZ2V0RW1i\nZWRkZWRNYXBwaW5nKCkuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAgIENv\nbHVtbltdIGNvbHM7CiAgICAgICAgZm9yIChpbnQgaSA9IGlkeDsgaSA8IGZt\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1zW2ldLmdldE1h\nbmFnZW1lbnQoKSAhPSBGaWVsZE1hcHBpbmcuTUFOQUdFX1BFUlNJU1RFTlQp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29scyA9\nICgoRW1iZWRkYWJsZSkgZm1zW2ldKS5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGogPSAwOyBqIDwgY29scy5sZW5ndGg7IGorKykKICAg\nICAgICAgICAgICAgIGlmIChjb2xzW2pdID09IGNvbCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZm1zW2ldOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKCX0KfQo=\n","encoding":"base64"}

