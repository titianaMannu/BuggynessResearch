{"sha":"df0b091760be327849c8b25cc1afcef4274db6cf","node_id":"MDQ6QmxvYjIwNjM2NDpkZjBiMDkxNzYwYmUzMjc4NDljOGIyNWNjMWFmY2VmNDI3NGRiNmNm","size":12512,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/df0b091760be327849c8b25cc1afcef4274db6cf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5E\nQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5r\nZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRW1iZWRkYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZFN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5W\nYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLlZhbHVlTWFwcGluZ0ltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuT2JqZWN0SWRTdGF0ZU1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0YXRlTWFu\nYWdlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0\nYURhdGFFeGNlcHRpb247CgovKioKICogQmFzZSBjbGFzcyBmb3IgZW1iZWRk\nZWQgdmFsdWUgaGFuZGxlcnMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nIEBzaW5jZSAwLjQuMAogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEVtYmVk\nVmFsdWVIYW5kbGVyCiAgICBleHRlbmRzIEFic3RyYWN0VmFsdWVIYW5kbGVy\nIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nIExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEVtYmVkVmFsdWVIYW5k\nbGVyLmNsYXNzKTsKCiAgICAvKioKICAgICAqIE1hcHMgZW1iZWRkZWQgdmFs\ndWUgYW5kIGdhdGhlcnMgY29sdW1ucyBhbmQgYXJndW1lbnRzIGludG8gZ2l2\nZW4gbGlzdHMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBtYXAoVmFsdWVNYXBwaW5nIHZtLCBTdHJpbmcgbmFtZSwg\nQ29sdW1uSU8gaW8sCiAgICAgICAgYm9vbGVhbiBhZGFwdCwgTGlzdCBjb2xz\nLCBMaXN0IGFyZ3MpIHsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IHZt\nLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0REJEaWN0aW9uYXJ5KCk7CiAg\nICAgICAgREJJZGVudGlmaWVyIGNvbE5hbWUgPSBEQklkZW50aWZpZXIubmV3\nQ29sdW1uKG5hbWUsIGRpY3QgIT0gbnVsbCA/IGRpY3QuZGVsaW1pdEFsbCgp\nIDogZmFsc2UpOwogICAgICAgIG1hcCh2bSwgY29sTmFtZSwgaW8sIGFkYXB0\nLCBjb2xzLCBhcmdzKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcHMgZW1i\nZWRkZWQgdmFsdWUgYW5kIGdhdGhlcnMgY29sdW1ucyBhbmQgYXJndW1lbnRz\nIGludG8gZ2l2ZW4gbGlzdHMuCiAgICAgKi8gICAgCiAgICBwcm90ZWN0ZWQg\ndm9pZCBtYXAoVmFsdWVNYXBwaW5nIHZtLCBEQklkZW50aWZpZXIgbmFtZSwg\nQ29sdW1uSU8gaW8sCiAgICAgICAgYm9vbGVhbiBhZGFwdCwgTGlzdCBjb2xz\nLCBMaXN0IGFyZ3MpIHsKICAgICAgICAvLyBoYXZlIHRvIHJlc29sdmUgZW1i\nZWRkZWQgdmFsdWUgdG8gY29sbGVjdCBpdHMgY29sdW1ucwogICAgICAgIHZt\nLmdldEVtYmVkZGVkTWFwcGluZygpLnJlc29sdmUodm0uTU9ERV9NRVRBIHwg\ndm0uTU9ERV9NQVBQSU5HKTsKCiAgICAgICAgLy8gZ2F0aGVyIGNvbHVtbnMg\nYW5kIHJlc3VsdCBhcmd1bWVudHMKICAgICAgICBGaWVsZE1hcHBpbmdbXSBm\nbXMgPSB2bS5nZXRFbWJlZGRlZE1hcHBpbmcoKS5nZXRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgQ29sdW1uW10gY3VyQ29sczsKICAgICAgICBPYmplY3Rb\nXSBjdXJBcmdzOwogICAgICAgIENvbHVtbklPIGN1cklPOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmIChmbXNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWFwcGlu\nZy5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICBGaWVsZFN0cmF0ZWd5IHN0cmF0ID0gZm1zW2ldLmdl\ndFN0cmF0ZWd5KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIShz\ndHJhdCBpbnN0YW5jZW9mIEVtYmVkZGFibGUpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1i\nZWRkYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgdm0sIGZtc1tpXSkpOwog\nICAgICAgICAgICAKICAgICAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZt\nc1tpXS5nZXRWYWx1ZU1hcHBpbmcoKTsKICAgICAgICAgICAgaWYgKHZhbC5n\nZXRFbWJlZGRlZE1hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nbWFwKHZhbCwgbmFtZSwgaW8sIGFkYXB0LCBjb2xzLCBhcmdzKTsKICAgICAg\nICAgICAgCiAgICAgICAgICAgIGN1ckNvbHMgPSAoKEVtYmVkZGFibGUpIHN0\ncmF0KS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIGN1cklPID0gKChFbWJl\nZGRhYmxlKSBzdHJhdCkuZ2V0Q29sdW1uSU8oKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaiA9IDA7IGogPCBjdXJDb2xzLmxlbmd0aDsgaisrKSB7CiAgICAg\nICAgICAgICAgICBpby5zZXRJbnNlcnRhYmxlKGNvbHMuc2l6ZSgpLCBjdXJJ\nTy5pc0luc2VydGFibGUoaiwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGlv\nLnNldE51bGxJbnNlcnRhYmxlKGNvbHMuc2l6ZSgpLAogICAgICAgICAgICAg\nICAgICAgIGN1cklPLmlzSW5zZXJ0YWJsZShqLCB0cnVlKSk7CiAgICAgICAg\nICAgICAgICBpby5zZXRVcGRhdGFibGUoY29scy5zaXplKCksIGN1cklPLmlz\nVXBkYXRhYmxlKGosIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBpby5zZXRO\ndWxsVXBkYXRhYmxlKGNvbHMuc2l6ZSgpLCBjdXJJTy5pc1VwZGF0YWJsZShq\nLCB0cnVlKSk7CiAgICAgICAgICAgICAgICBjb2xzLmFkZChjdXJDb2xzW2pd\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3VyQXJncyA9ICgoRW1i\nZWRkYWJsZSkgZm1zW2ldLmdldFN0cmF0ZWd5KCkpLmdldFJlc3VsdEFyZ3Vt\nZW50cygpOwogICAgICAgICAgICBpZiAoY3VyQ29scy5sZW5ndGggPT0gMSkK\nICAgICAgICAgICAgICAgIGFyZ3MuYWRkKGN1ckFyZ3MpOwogICAgICAgICAg\nICBlbHNlIGlmIChjdXJDb2xzLmxlbmd0aCA+IDEpCiAgICAgICAgICAgICAg\nICBmb3IgKGludCBqID0gMDsgaiA8IGN1ckNvbHMubGVuZ3RoOyBqKyspCiAg\nICAgICAgICAgICAgICAgICAgYXJncy5hZGQoKGN1ckFyZ3MgPT0gbnVsbCkg\nPyBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIDogKChPYmplY3RbXSkg\nY3VyQXJncylbal0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEhlbHBlciB0byBjb252ZXJ0IGFuIG9iamVjdCB2YWx1ZSB0byBpdHMgZGF0\nYXN0b3JlIGVxdWl2YWxlbnQuCiAgICAgKgogICAgICogQHBhcmFtIGVtIHN0\nYXRlIG1hbmFnZXIgZm9yIGVtYmVkZGVkIG9iamVjdAogICAgICogQHBhcmFt\nIHZtIG93bmluZyB2YWx1ZQogICAgICogQHBhcmFtIHN0b3JlIHN0b3JlIG1h\nbmFnZXIKICAgICAqIEBwYXJhbSBjb2xzIGVtYmVkZGVkIGNvbHVtbnMKICAg\nICAqIEBwYXJhbSBydmFsIHJldHVybiBhcnJheSBpZiBtdWx0aXBsZSBjb2x1\nbW5zCiAgICAgKiBAcGFyYW0gaWR4IGluZGV4IGluIGNvbHVtbnMgYXJyYXkg\ndG8gc3RhcnQKICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0RhdGFT\ndG9yZVZhbHVlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW0sIFZhbHVlTWFwcGlu\nZyB2bSwKICAgICAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBDb2x1bW5bXSBj\nb2xzLCBPYmplY3QgcnZhbCwgaW50IGlkeCkgewogICAgICAgIAogICAgICAg\nIC8vIFRoaXMgaXMgYSBwbGFjZWhvbGRlciB0byBob2xkIHRoZSB2YWx1ZSBn\nZW5lcmF0ZWQgaW4gCiAgICAgICAgLy8gdG9EYXRhU3RvcmVWYWx1ZTEuIFdo\nZW4gdGhpcyBtZXRob2QgaXMgY2FsbGVkIGZyb20gCiAgICAgICAgLy8gRWxl\nbWVudEVtYmVkVmFsdWVIYW5kbGVyIG9yIE9iamVjdElkVmFsdWVIYW5kbGVy\nLCAKICAgICAgICAvLyBpZiB0aGUgZGltZW5zaW9uIG9mIGNvbHMgPiAxLCBy\ndmFsIGlzIGFuIGFycmF5IG9mIHRoZSAKICAgICAgICAvLyBzYW1lIGRpbWVu\nc2lvbi4gSWYgdGhlIGRpbWVuc2lvbiBvZiBjb2xzIGlzIDEsIHJ2YWwgaXMg\nbnVsbC4KICAgICAgICAvLyBJZiBydmFsIGlzIG5vdCBudWxsLCBpdCBpcyBh\nbiBhcnJheSBvZiBvYmplY3RzIGFuZCB0aGlzIGFycmF5CiAgICAgICAgLy8g\nd2lsbCBiZSBwb3B1bGF0ZWQgaW4gdG9EYXRhc3RvcmVWYWx1ZTEuIElmIHJ2\nYWwgaXMgbnVsbCwKICAgICAgICAvLyBhIG5ldyB2YWx1ZSB3aWxsIGJlIGFk\nZGVkIHRvIHJ2YWxzIGluIHRvRGF0YVN0b3JlVmFsdWUxCiAgICAgICAgLy8g\nYW5kIHJldHVybiB0byB0aGUgY2FsbGVyLgogICAgICAgIExpc3QgcnZhbHMg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgaWYgKHJ2YWwgIT0gbnVsbCkK\nICAgICAgICAgICAgcnZhbHMuYWRkKHJ2YWwpOwogICAgICAgIAogICAgICAg\nIHRvRGF0YVN0b3JlVmFsdWUxKGVtLCB2bSwgc3RvcmUsIGNvbHMsIHJ2YWxz\nLCBpZHgpOwogICAgICAgIHJldHVybiBydmFscy5nZXQoMCk7CiAgICB9ICAg\nIAogICAgCiAgICBwcm90ZWN0ZWQgaW50IHRvRGF0YVN0b3JlVmFsdWUxKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgZW0sIFZhbHVlTWFwcGluZyB2bSwKICAgICAg\nICBKREJDU3RvcmUgc3RvcmUsIENvbHVtbltdIGNvbHMsIExpc3QgcnZhbHMs\nIGludCBpZHgpIHsKICAgICAgICAvLyBzZXQgcmVzdCBvZiBjb2x1bW5zIGZy\nb20gZmllbGRzCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gdm0uZ2V0\nRW1iZWRkZWRNYXBwaW5nKCkuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAg\nIE9iamVjdCBjdmFsOwogICAgICAgIENvbHVtbltdIGVjb2xzOwogICAgICAg\nIEVtYmVkZGFibGUgZW1iZWQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZtc1tpXS5n\nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNYXBwaW5nLk1BTkFHRV9QRVJTSVNU\nRU5UKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIAog\nICAgICAgICAgICAvLyBUaGlzIHJlY3Vyc2l2ZSBjb2RlIGlzIG1haW5seSB0\nbyBkZWFsIHdpdGggc2l0dWF0aW9ucwogICAgICAgICAgICAvLyB3aGVyZSBh\nbiBlbnRpdHkgY29udGFpbnMgYSBjb2xsZWN0aW9uIG9mIGVtYmVkZGFibGVB\nLgogICAgICAgICAgICAvLyBUaGUgZW1iZWRkYWJsZUEgZWxlbWVudCBpbiB0\naGUgY29sbGVjdGlvbiBjb250YWlucyBhbiAKICAgICAgICAgICAgLy8gZW1i\nZWRkYWJsZUIuIFRoZSBwYXJhbWV0ZXIgdm0gdG8gdG9EYXRhU3RvcmVWYWx1\nZSBpcyAKICAgICAgICAgICAgLy8gZW1iZWRkYWJsZUEuIElmIHNvbWUgZmll\nbGQgaW4gZW1iZWRkYWJsZUEgaXMgb2YgdHlwZSAKICAgICAgICAgICAgLy8g\nZW1iZWRkYWJsZUIsIHJlY3Vyc2l2ZSBjYWxsIGlzIHJlcXVpcmVkIHRvIHBv\ncHVsYXRlIHRoZSAKICAgICAgICAgICAgLy8gdmFsdWUgZm9yIGVtYmVkZGFi\nbGVCLgogICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZm1zW2ldLmdl\ndFZhbHVlTWFwcGluZygpOwogICAgICAgICAgICBpZiAodmFsLmdldEVtYmVk\nZGVkTWFwcGluZygpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGN2YWwg\nPSAoZW0gPT0gbnVsbCkgPyBudWxsIDogZW0uZmV0Y2goaSk7CiAgICAgICAg\nICAgICAgICBpZiAoY3ZhbCBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJs\nZSkgewogICAgICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZW1iZWRTbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKQogICAgICAgICAgICAg\nICAgICAgICAgICAoKFBlcnNpc3RlbmNlQ2FwYWJsZSljdmFsKS5wY0dldFN0\nYXRlTWFuYWdlcigpOwogICAgICAgICAgICAgICAgICAgIGlkeCA9IHRvRGF0\nYVN0b3JlVmFsdWUxKGVtYmVkU20sIHZhbCwgc3RvcmUsIGNvbHMsIHJ2YWxz\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4KTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoY3ZhbCBpbnN0YW5jZW9mIE9iamVjdElkU3Rh\ndGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgaWR4ID0gdG9EYXRh\nU3RvcmVWYWx1ZTEoKE9iamVjdElkU3RhdGVNYW5hZ2VyKWN2YWwsIHZhbCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLCBjb2xzLCBydmFs\ncywgaWR4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3ZhbCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWR4ID0gdG9EYXRhU3RvcmVW\nYWx1ZTEobnVsbCwgdmFsLCBzdG9yZSwgY29scywgcnZhbHMsIGlkeCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAg\nICAgICAgICAgIGVtYmVkID0gKEVtYmVkZGFibGUpIGZtc1tpXS5nZXRTdHJh\ndGVneSgpOwogICAgICAgICAgICBlY29scyA9IGVtYmVkLmdldENvbHVtbnMo\nKTsKICAgICAgICAgICAgaWYgKGVjb2xzLmxlbmd0aCA9PSAwKQogICAgICAg\nICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBjdmFsID0gKGVtID09\nIG51bGwpID8gbnVsbCA6IGVtLmZldGNoKGkpOwogICAgICAgICAgICBjdmFs\nID0gZW1iZWQudG9FbWJlZGRlZERhdGFTdG9yZVZhbHVlKGN2YWwsIHN0b3Jl\nKTsKICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09IDEpIHsKICAgICAg\nICAgICAgICAgIC8vIHJ2YWxzIGlzIGVtcHR5CiAgICAgICAgICAgICAgICBy\ndmFscy5hZGQoY3ZhbCk7IC8vIHNhdmUgdGhlIHJldHVybiB2YWx1ZQogICAg\nICAgICAgICB9IGVsc2UgaWYgKGVjb2xzLmxlbmd0aCA9PSAxKSB7CiAgICAg\nICAgICAgICAgICBPYmplY3QgcnZhbCA9IHJ2YWxzLmdldCgwKTsKICAgICAg\nICAgICAgICAgICgoT2JqZWN0W10pIHJ2YWwpW2lkeCsrXSA9IGN2YWw7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBPYmplY3QgcnZh\nbCA9IHJ2YWxzLmdldCgwKTsKICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkoY3ZhbCwgMCwgcnZhbCwgaWR4LCBlY29scy5sZW5ndGgpOwogICAg\nICAgICAgICAgICAgaWR4ICs9IGVjb2xzLmxlbmd0aDsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIHRvIGNvbnZlcnQgYSBkYXRhc3RvcmUgdmFsdWUg\ndG8gaXRzIG9iamVjdCBlcXVpdmFsZW50LgogICAgICoKICAgICAqIEBwYXJh\nbSBlbSBzdGF0ZSBtYW5hZ2VyIGZvciBlbWJlZGRlZCBvYmplY3QKICAgICAq\nIEBwYXJhbSB2bSBvd25pbmcgdmFsdWUKICAgICAqIEBwYXJhbSB2YWwgZGF0\nYXN0b3JlIHZhbHVlCiAgICAgKiBAcGFyYW0gc3RvcmUgb3B0aW9uYWwgc3Rv\ncmUgbWFuYWdlcgogICAgICogQHBhcmFtIGZldGNoIG9wdGlvbmFsIGZldGNo\nIGNvbmZpZ3VyYXRpb24KICAgICAqIEBwYXJhbSBjb2xzIGVtYmVkZGVkIGNv\nbHVtbnMKICAgICAqIEBwYXJhbSBpZHggaW5kZXggaW4gY29sdW1ucyBhcnJh\neSB0byBzdGFydAogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCB0b09iamVj\ndFZhbHVlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW0sIFZhbHVlTWFwcGluZyB2\nbSwKICAgICAgICAgICAgT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgICAgICBDb2x1\nbW5bXSBjb2xzLCBpbnQgaWR4KQogICAgICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB0b09iamVjdFZhbHVlMShlbSwgdm0sIHZhbCwg\nc3RvcmUsIGZldGNoLCBjb2xzLCBpZHgpOwogICAgfSAgICAKICAgIAogICAg\ncHJvdGVjdGVkIGludCB0b09iamVjdFZhbHVlMShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIGVtLCBWYWx1ZU1hcHBpbmcgdm0sCiAgICAgICAgT2JqZWN0IHZhbCwg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLAogICAgICAgIENvbHVtbltdIGNvbHMsIGludCBpZHgpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1z\nID0gdm0uZ2V0RW1iZWRkZWRNYXBwaW5nKCkuZ2V0RmllbGRNYXBwaW5ncygp\nOwogICAgICAgIEVtYmVkZGFibGUgZW1iZWQ7CiAgICAgICAgT2JqZWN0IGN2\nYWw7CiAgICAgICAgQ29sdW1uW10gZWNvbHM7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKGZtc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNYXBwaW5nLk1BTkFH\nRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICBWYWx1ZU1hcHBpbmcgdm0xID0gZm1zW2ldLmdldFZhbHVlTWFw\ncGluZygpOwogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVtMSA9\nIG51bGw7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbWJlZCA9IChFbWJl\nZGRhYmxlKSBmbXNbaV0uZ2V0U3RyYXRlZ3koKTsKICAgICAgICAgICAgaWYg\nKHZtMS5nZXRFbWJlZGRlZE1hcHBpbmcoKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZW0gaW5zdGFuY2VvZiBTdGF0ZU1hbmFnZXJJbXBsKSB7\nCiAgICAgICAgICAgICAgICBlbTEgPSBzdG9yZS5nZXRDb250ZXh0KCkuZW1i\nZWQobnVsbCwgbnVsbCwgZW0sIHZtMSk7CiAgICAgICAgICAgICAgICBpZHgg\nPSB0b09iamVjdFZhbHVlMShlbTEsIHZtMSwgdmFsLCBzdG9yZSwgZmV0Y2gs\nIGNvbHMsIGlkeCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVtIGlu\nc3RhbmNlb2YgT2JqZWN0SWRTdGF0ZU1hbmFnZXIpIHsKICAgICAgICAgICAg\nICAgICAgICBlbTEgPSBuZXcgT2JqZWN0SWRTdGF0ZU1hbmFnZXIobnVsbCwg\nbnVsbCwgdm0xKTsKICAgICAgICAgICAgICAgICAgICBpZHggPSB0b09iamVj\ndFZhbHVlMShlbTEsIHZtMSwgdmFsLCBzdG9yZSwgbnVsbCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldENvbHVtbnMoZm1zW2ldKSwgaWR4KTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGN2YWwgPSBlbTEu\nZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBlY29scyA9IGVtYmVkLmdldENvbHVtbnMoKTsKICAg\nICAgICAgICAgICAgIGlmIChlY29scy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgICAgICAgICBjdmFsID0gbnVsbDsKICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKGlkeCA9PSAwICYmIGVjb2xzLmxlbmd0aCA9PSBjb2xzLmxlbmd0aCkK\nICAgICAgICAgICAgICAgICAgICBjdmFsID0gdmFsOwogICAgICAgICAgICAg\nICAgZWxzZSBpZiAoZWNvbHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAg\nICAgICAgY3ZhbCA9ICgoT2JqZWN0W10pIHZhbClbaWR4KytdOwogICAgICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY3ZhbCA9IG5l\ndyBPYmplY3RbZWNvbHMubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KHZhbCwgaWR4LCBjdmFsLCAwLCBlY29scy5sZW5n\ndGgpOwogICAgICAgICAgICAgICAgICAgIGlkeCArPSBlY29scy5sZW5ndGg7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChzdG9yZSAhPSBudWxsICYmIGVtIGluc3RhbmNlb2YgU3RhdGVNYW5h\nZ2VySW1wbCkKICAgICAgICAgICAgICAgIGVtYmVkLmxvYWRFbWJlZGRlZChl\nbSwgc3RvcmUsIGZldGNoLCBjdmFsKTsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBpZiAoIShlbSBpbnN0YW5jZW9mIE9iamVjdElkU3Rh\ndGVNYW5hZ2VyKSkKICAgICAgICAgICAgICAgICAgICBjdmFsID0gZW1iZWQu\ndG9FbWJlZGRlZE9iamVjdFZhbHVlKGN2YWwpOwogICAgICAgICAgICAgICAg\naWYgKGZtc1tpXS5nZXRIYW5kbGVyKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBjdmFsID0gZm1zW2ldLmdldEhhbmRsZXIoKS50b09iamVjdFZh\nbHVlKGZtc1tpXSwgY3ZhbCk7CgogICAgICAgICAgICAgICAgZW0uc3RvcmUo\nZm1zW2ldLmdldEluZGV4KCksIGN2YWwpOyAKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gaWR4OwogICAgfQogICAgcHJpdmF0ZSBD\nb2x1bW5bXSBnZXRDb2x1bW5zKEZpZWxkTWFwcGluZyBmbSkgewogICAgICAg\nIExpc3Q8Q29sdW1uPiBjb2xMaXN0ID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+\nKCk7CiAgICAgICAgZ2V0RW1iZWRkZWRJZENvbHMoZm0sIGNvbExpc3QpOwog\nICAgICAgIENvbHVtbltdIGNvbHMgPSBuZXcgQ29sdW1uW2NvbExpc3Quc2l6\nZSgpXTsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChDb2x1bW4g\nY29sIDogY29sTGlzdCkgewogICAgICAgICAgICBjb2xzW2krK10gPSBjb2w7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBjb2xzOwogICAgfQogICAgCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgZ2V0RW1iZWRkZWRJZENvbHMoRmllbGRN\nYXBwaW5nIGZtZCwgTGlzdCBjb2xzKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIGVtYmVkID0gZm1kLmdldEVtYmVkZGVkTWFwcGluZygpOwogICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGZtZHMgPSBlbWJlZC5nZXRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldFZhbHVlKCkuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGdl\ndElkQ29sdW1ucyhmbWRzW2ldLCBjb2xzKTsKICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIGdldEVtYmVkZGVkSWRDb2xzKGZtZHNbaV0s\nIGNvbHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgZ2V0SWRDb2x1bW5zKEZpZWxkTWFwcGlu\nZyBmbWQsIExpc3QgY29scykgewogICAgICAgIENvbHVtbltdIHBrQ29scyA9\nICAoKFZhbHVlTWFwcGluZ0ltcGwpZm1kLmdldFZhbHVlKCkpLmdldENvbHVt\nbnMoKTsKICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHBrQ29scy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICBDb2x1bW4gbmV3Q29sID0gbmV3IENv\nbHVtbigpOwogICAgICAgICAgICBuZXdDb2wuY29weShwa0NvbHNbal0pOwog\nICAgICAgICAgICBjb2xzLmFkZChuZXdDb2wpOwogICAgICAgIH0KICAgIH0K\nfQo=\n","encoding":"base64"}

