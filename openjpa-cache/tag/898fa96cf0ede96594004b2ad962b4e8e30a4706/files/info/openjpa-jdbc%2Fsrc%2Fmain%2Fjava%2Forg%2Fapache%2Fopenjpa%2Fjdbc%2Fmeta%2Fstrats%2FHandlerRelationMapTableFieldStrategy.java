{"sha":"65b77cce55eb3935f401e09da2d1a90fce4e5e37","node_id":"MDQ6QmxvYjIwNjM2NDo2NWI3N2NjZTU1ZWIzOTM1ZjQwMWUwOWRhMmQxYTkwZmNlNGU1ZTM3","size":18394,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/65b77cce55eb3935f401e09da2d1a90fce4e5e37","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1w\nb3J0IGphdmEuc3FsLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuKjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC4qOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VD\nYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS4q\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5E\nQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5r\nZXJuZWwuKjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS4qOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLio7Cgov\nKioKICogPHA+TWFwcGluZyBmb3IgYSBtYXAgd2hvc2Uga2V5cyBhcmUgY29u\ndHJvbGxlZCBieSBhIHtAbGluayBWYWx1ZUhhbmRsZXJ9CiAqIGFuZCB3aG9z\nZSB2YWx1ZXMgYXJlIHJlbGF0aW9ucyB0byBvdGhlciBwZXJzaXN0ZW50IG9i\namVjdHMuPC9wPgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAc2luY2Ug\nMC40LjAsIDEuMS4wCiAqLwpwdWJsaWMgY2xhc3MgSGFuZGxlclJlbGF0aW9u\nTWFwVGFibGVGaWVsZFN0cmF0ZWd5CiAgICBleHRlbmRzIE1hcFRhYmxlRmll\nbGRTdHJhdGVneSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChIYW5k\nbGVyUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3kuY2xhc3MpOwoKICAg\nIHByaXZhdGUgQ29sdW1uW10gX2tjb2xzID0gbnVsbDsKICAgIHByaXZhdGUg\nQ29sdW1uSU8gX2tpbyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ts\nb2FkID0gZmFsc2U7CgogICAgcHVibGljIENvbHVtbltdIGdldEtleUNvbHVt\nbnMoQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIHJldHVybiBfa2NvbHM7\nCiAgICB9CgogICAgcHVibGljIENvbHVtbklPIGdldEtleUNvbHVtbklPKCkg\newogICAgICAgIHJldHVybiBfa2lvOwogICAgfQoKICAgIHB1YmxpYyBDb2x1\nbW5bXSBnZXRWYWx1ZUNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNscykgewogICAg\nICAgIHJldHVybiBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldENvbHVt\nbnMoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RLZXkoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIGtleSwgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsLnNlbGVj\ndChfa2NvbHMsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxl\nY3RWYWx1ZShTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgdmFsLAogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgCiAgICAgICAgSm9pbnMgam9p\nbnMpIHsKICAgICAgICBzZWwuc2VsZWN0KHZhbCwgZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAgICAg\nIHN0b3JlLCBmZXRjaCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9O\nT05FLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdFtdIGdldFJl\nc3VsdHMoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBm\naW5hbCBKREJDU3RvcmUgc3RvcmUsIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsCiAgICAgICAgZmluYWwgaW50IGVhZ2VyTW9kZSwgZmlu\nYWwgSm9pbnNbXSByZXNKb2lucywgYm9vbGVhbiBscnMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0g\nPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGZpbmFsIENs\nYXNzTWFwcGluZ1tdIHZhbHMgPSBlbGVtLmdldEluZGVwZW5kZW50VHlwZU1h\ncHBpbmdzKCk7CiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxG\nYWN0b3J5KCkubmV3VW5pb24odmFscy5sZW5ndGgpOwogICAgICAgIGlmIChm\nZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShlbGVtLmdldFR5cGVNYXBwaW5n\nKCkpCiAgICAgICAgICAgICE9IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFH\nRVJfSk9JTikKICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAg\nICAgIHVuaW9uLnNldExSUyhscnMpOwogICAgICAgIHVuaW9uLnNlbGVjdChu\nZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAg\nICBzZWwuc2VsZWN0KF9rY29scyk7CiAgICAgICAgICAgICAgICBpZiAoZmll\nbGQuaXNVbmkxVG9NRksoKSkgewogICAgICAgICAgICAgICAgICAgIHNlbC53\naGVyZUZvcmVpZ25LZXkoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRG\nb3JlaWduS2V5KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE9i\namVjdElkKCksIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0RGVjbGFy\nZWRUeXBlTWFwcGluZygpLCBzdG9yZSk7CiAgICAgICAgICAgICAgICAgICAg\nc2VsLnNlbGVjdCh2YWxzW2lkeF0sIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5n\nKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRTZWxlY3RTdWJj\nbGFzc2VzKCksIHN0b3JlLCBmZXRjaCwgZWFnZXJNb2RlLCBudWxsKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2Vs\nLndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBmaWVs\nZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUpOwogICAgICAgICAgICAg\nICAgICAgIEpvaW5zIGpvaW5zID0gam9pblZhbHVlUmVsYXRpb24oc2VsLm5l\nd0pvaW5zKCksIHZhbHNbaWR4XSk7CiAgICAgICAgICAgICAgICAgICAgc2Vs\nLnNlbGVjdCh2YWxzW2lkeF0sIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCku\nCiAgICAgICAgICAgICAgICAgICAgICAgIGdldFNlbGVjdFN1YmNsYXNzZXMo\nKSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5zKTsKCiAgICAgICAg\nICAgICAgICAgICAgLy8jIyMgY2hlYXQ6IHJlc3VsdCBqb2lucyBvbmx5IGNh\ncmUgYWJvdXQgdGhlIHJlbGF0aW9uIHBhdGg7CiAgICAgICAgICAgICAgICAg\nICAgLy8jIyMgdGh1cyB3ZSBjYW4gdXNlIGZpcnN0IG1hcHBpbmcgb2YgdW5p\nb24gb25seQogICAgICAgICAgICAgICAgICAgIGlmIChpZHggPT0gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgcmVzSm9pbnNbMV0gPSBqb2luczsKICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAg\nICAgUmVzdWx0IHJlcyA9IHVuaW9uLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsK\nICAgICAgICByZXR1cm4gbmV3IFJlc3VsdFtdeyByZXMsIHJlcyB9OwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZEtleShPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIEhh\nbmRsZXJTdHJhdGVnaWVzLmxvYWRPYmplY3QoZmllbGQuZ2V0S2V5TWFwcGlu\nZygpLAogICAgICAgICAgICBzbSwgc3RvcmUsIGZldGNoLCByZXMsIGpvaW5z\nLCBfa2NvbHMsIF9rbG9hZCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBs\nb2FkVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0\nb3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJl\nc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIENsYXNzTWFwcGluZyB2YWwgPSByZXMuZ2V0QmFz\nZU1hcHBpbmcoKTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgIHZhbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0SW5kZXBl\nbmRlbnRUeXBlTWFwcGluZ3MoKVswXTsKICAgICAgICByZXR1cm4gcmVzLmxv\nYWQodmFsLCBzdG9yZSwgZmV0Y2gsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJs\naWMgSm9pbnMgam9pblZhbHVlUmVsYXRpb24oSm9pbnMgam9pbnMsIENsYXNz\nTWFwcGluZyB2YWwpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgdm0gPSBmaWVs\nZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIEZvcmVpZ25LZXkgZmsg\nPSB2bS5nZXRGb3JlaWduS2V5KHZhbCk7CiAgICAgICAgaWYgKGZrID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICByZXR1cm4g\nam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgZmssIHZhbCwK\nICAgICAgICAgICAgdm0uZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwg\nZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1hcChib29sZWFuIGFk\nYXB0KSB7CiAgICAgICAgc3VwZXIubWFwKGFkYXB0KTsKCiAgICAgICAgVmFs\ndWVNYXBwaW5nIGtleSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAg\nICBpZiAoa2V5LmdldEhhbmRsZXIoKSA9PSBudWxsKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWhhbmRs\nZXIiLCBrZXkpKTsKICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBpZiAodmFsLmdldFR5cGVD\nb2RlKCkgIT0gSmF2YVR5cGVzLlBDIHx8IHZhbC5pc0VtYmVkZGVkUEMoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtcmVsYXRpb24iLCB2YWwpKTsKICAgICAgICAKICAgICAgICBG\naWVsZE1hcHBpbmcgbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBwaW5n\nKCk7CiAgICAgICAgaWYgKGZpZWxkLmlzVW5pMVRvTUZLKCkgfHwgKCFmaWVs\nZC5pc0JpTVRvMUpUKCkgJiYgbWFwcGVkICE9IG51bGwpKSB7IAogICAgICAg\nICAgICAvLyBtYXAgdG8gdGhlIG93bmVyIHRhYmxlCiAgICAgICAgICAgIGhh\nbmRsZU1hcHBlZEJ5Rm9yZWlnbktleShhZGFwdCk7CiAgICAgICAgfSBlbHNl\nIGlmIChmaWVsZC5pc0JpTVRvMUpUKCkgfHwgbWFwcGVkID09IG51bGwpIHsg\nCiAgICAgICAgICAgIC8vIG1hcCB0byBhIHNlcGFyYXRlIHRhYmxlCiAgICAg\nICAgICAgIGZpZWxkLm1hcEpvaW4oYWRhcHQsIHRydWUpOwogICAgICAgICAg\nICBpZiAodmFsLmdldFR5cGVNYXBwaW5nKCkuaXNNYXBwZWQoKSkgewogICAg\nICAgICAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyB2aW5mbyA9IHZhbC5nZXRW\nYWx1ZUluZm8oKTsKICAgICAgICAgICAgICAgIEZvcmVpZ25LZXkgZmsgPSB2\naW5mby5nZXRUeXBlSm9pbih2YWwsICJ2YWx1ZSIsIGZhbHNlLCBhZGFwdCk7\nCiAgICAgICAgICAgICAgICB2YWwuc2V0Rm9yZWlnbktleShmayk7CiAgICAg\nICAgICAgICAgICB2YWwuc2V0Q29sdW1uSU8odmluZm8uZ2V0Q29sdW1uSU8o\nKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgUmVsYXRp\nb25TdHJhdGVnaWVzLm1hcFJlbGF0aW9uVG9Vbm1hcHBlZFBDKHZhbCwgInZh\nbHVlIiwgYWRhcHQpOwoKICAgICAgICAgICAgdmFsLm1hcENvbnN0cmFpbnRz\nKCJ2YWx1ZSIsIGFkYXB0KTsKICAgICAgICB9CiAgICAgICAgX2tpbyA9IG5l\ndyBDb2x1bW5JTygpOwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gZmll\nbGQuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXREQkRpY3Rpb25hcnkoKTsK\nICAgICAgICBfa2NvbHMgPSBIYW5kbGVyU3RyYXRlZ2llcy5tYXAoa2V5LCAK\nICAgICAgICAgICAgZGljdC5nZXRWYWxpZENvbHVtbk5hbWUoREJJZGVudGlm\naWVyLm5ld0NvbHVtbigia2V5IiksIGZpZWxkLmdldFRhYmxlKCkpLmdldE5h\nbWUoKSwgX2tpbywgYWRhcHQpOwoKICAgICAgICBmaWVsZC5tYXBQcmltYXJ5\nS2V5KGFkYXB0KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXpl\nKCkgewogICAgICAgIF9rbG9hZCA9IGZpZWxkLmdldEtleU1hcHBpbmcoKS5n\nZXRIYW5kbGVyKCkuCiAgICAgICAgICAgIG9iamVjdFZhbHVlUmVxdWlyZXNM\nb2FkKGZpZWxkLmdldEtleU1hcHBpbmcoKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9y\nZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpbnNlcnQoc20sIHN0b3JlLCBybSwgKE1hcCkg\nc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtLAogICAgICAgIE1hcCBt\nYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKG1hcCA9PSBudWxsIHx8IG1hcC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAKICAgICAgICBpZiAoIWZpZWxkLmlzQmlNVG8xSlQo\nKSAmJiBmaWVsZC5nZXRNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgUm93IHJvdyA9IG51bGw7CiAgICAgICAgaWYg\nKCFmaWVsZC5pc1VuaTFUb01GSygpKSB7CiAgICAgICAgICAgIHJvdyA9IHJt\nLmdldFNlY29uZGFyeVJvdyhmaWVsZC5nZXRUYWJsZSgpLCBSb3cuQUNUSU9O\nX0lOU0VSVCk7CiAgICAgICAgICAgIHJvdy5zZXRGb3JlaWduS2V5KGZpZWxk\nLmdldEpvaW5Gb3JlaWduS2V5KCksIGZpZWxkLmdldEpvaW5Db2x1bW5JTygp\nLAogICAgICAgICAgICAgICAgc20pOwogICAgICAgIH0KICAgICAgICBWYWx1\nZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAg\nIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIFN0b3JlQ29udGV4dCBjdHggPSBzdG9yZS5nZXRDb250ZXh0\nKCk7CiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciB2YWxzbTsKICAgICAg\nICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIHZhbHNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0\nYXRlTWFuYWdlcihlbnRyeS5nZXRWYWx1ZSgpLAogICAgICAgICAgICAgICAg\nY3R4KTsKICAgICAgICAgICAgaWYgKGZpZWxkLmlzVW5pMVRvTUZLKCkpewog\nICAgICAgICAgICAgICAgcm93ID0gcm0uZ2V0Um93KGZpZWxkLmdldEVsZW1l\nbnRNYXBwaW5nKCkuZ2V0RGVjbGFyZWRUeXBlTWFwcGluZygpLmdldFRhYmxl\nKCksCiAgICAgICAgICAgICAgICAgICAgUm93LkFDVElPTl9VUERBVEUsIHZh\nbHNtLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJvdy53aGVyZVByaW1hcnlL\nZXkodmFsc20pOwogICAgICAgICAgICAgICAgdmFsLnNldEZvcmVpZ25LZXko\ncm93LCBzbSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICB2YWwuc2V0Rm9yZWlnbktleShyb3csIHZhbHNtKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBIYW5kbGVyU3RyYXRlZ2llcy5zZXQoa2V5LCBlbnRy\neS5nZXRLZXkoKSwgc3RvcmUsIHJvdywgX2tjb2xzLAogICAgICAgICAgICAg\nICAgICAgIF9raW8sIHRydWUpOwogICAgICAgICAgICAKICAgICAgICAgICAg\nLy8gU28gZmFyIHdlIHBvcHVsYXRlZCB0aGUga2V5L3ZhbHVlIG9mIGVhY2gK\nICAgICAgICAgICAgLy8gbWFwIGVsZW1lbnQgb3duZWQgYnkgdGhlIGVudGl0\neS4KICAgICAgICAgICAgLy8gSW4gdGhlIGNhc2Ugb2YgVG9NYW55LCBhbmQg\nYm90aCBzaWRlcwogICAgICAgICAgICAvLyB1c2UgTWFwIHRvIHJlcHJlc2Vu\ndCB0aGUgcmVsYXRpb24sCiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcG9w\ndWxhdGUgdGhlIGtleSB2YWx1ZSBvZiB0aGUgb3duZXIKICAgICAgICAgICAg\nLy8gZnJvbSB0aGUgdmlldyBwb2ludCBvZiB0aGUgb3duZWQgc2lkZQogICAg\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgb2JqID0gc20uZ2V0UGVyc2lz\ndGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgIGlmICghcG9wdWxhdGVLZXko\ncm93LCB2YWxzbSwgb2JqLCBjdHgsIHJtLCBzdG9yZSkpIHsKICAgICAgICAg\nICAgICAgIGlmICghZmllbGQuaXNVbmkxVG9NRksoKSkKICAgICAgICAgICAg\nICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhyb3cpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRL\nZXkoT2JqZWN0IGtleU9iaiwgSkRCQ1N0b3JlIHN0b3JlLCBSb3cgcm93KSAK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBWYWx1ZU1h\ncHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAgIEhh\nbmRsZXJTdHJhdGVnaWVzLnNldChrZXksIGtleU9iaiwgc3RvcmUsIHJvdywg\nX2tjb2xzLAogICAgICAgICAgICBfa2lvLCB0cnVlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRC\nQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgp\nICE9IG51bGwgJiYgIWZpZWxkLmlzQmlNVG8xSlQoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBNYXAgbWFwID0gKE1hcCkgc20uZmV0Y2hPYmpl\nY3QoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAgQ2hhbmdlVHJhY2tlciBj\ndCA9IG51bGw7CiAgICAgICAgaWYgKG1hcCBpbnN0YW5jZW9mIFByb3h5KSB7\nCiAgICAgICAgICAgIFByb3h5IHByb3h5ID0gKFByb3h5KSBtYXA7CiAgICAg\nICAgICAgIGlmIChQcm94aWVzLmlzT3duZXIocHJveHksIHNtLCBmaWVsZC5n\nZXRJbmRleCgpKSkKICAgICAgICAgICAgICAgIGN0ID0gcHJveHkuZ2V0Q2hh\nbmdlVHJhY2tlcigpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm8gZmlu\nZS1ncmFpbmVkIGNoYW5nZSB0cmFja2luZyB0aGVuIGp1c3QgZGVsZXRlIGFu\nZCByZWluc2VydAogICAgICAgIGlmIChjdCA9PSBudWxsIHx8ICFjdC5pc1Ry\nYWNraW5nKCkpIHsKICAgICAgICAgICAgZGVsZXRlKHNtLCBzdG9yZSwgcm0p\nOwogICAgICAgICAgICBpbnNlcnQoc20sIHN0b3JlLCBybSwgbWFwKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgVmFsdWVNYXBw\naW5nIGtleSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICBWYWx1\nZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAg\nICAgICBTdG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgpOwog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgdmFsc207CgogICAgICAgIC8v\nIHVwZGF0ZSB0aGUgY2hhbmdlczsgbm90ZSB0aGF0IHdlIGhhdmUgdG8gbW9k\nZWwgY2hhbmdlcyBhcwogICAgICAgIC8vIGRlbGV0ZS10aGVuLWluc2VydCBp\nZiB3ZSBoYXZlIGEgZm9yZWlnbiBrZXkgYWN0aW9uLCBiZWNhdXNlCiAgICAg\nICAgLy8gc2Vjb25kYXJ5IHJvdyB1cGRhdGVzIGFyZW4ndCBwYXJ0IG9mIHRo\nZSBjb25zdHJhaW50IGdyYXBoCiAgICAgICAgQ29sbGVjdGlvbiBjaGFuZ2Ug\nPSBjdC5nZXRDaGFuZ2VkKCk7CiAgICAgICAgYm9vbGVhbiBjYW5DaGFuZ2Ug\nPSB2YWwuZ2V0Rm9yZWlnbktleSgpLmlzTG9naWNhbCgpOwogICAgICAgIE9i\namVjdCBta2V5OwogICAgICAgIGlmIChjYW5DaGFuZ2UgJiYgIWNoYW5nZS5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgUm93IGNoYW5nZVJvdyA9IG51bGw7\nCiAgICAgICAgICAgIGlmICghZmllbGQuaXNVbmkxVG9NRksoKSkgewogICAg\nICAgICAgICAgICAgY2hhbmdlUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZp\nZWxkLmdldFRhYmxlKCksCiAgICAgICAgICAgICAgICAgICAgUm93LkFDVElP\nTl9VUERBVEUpOwogICAgICAgICAgICAgICAgY2hhbmdlUm93LndoZXJlRm9y\nZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLCBzbSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gY2hhbmdlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICBta2V5ID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIHZhbHNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFu\nYWdlcihtYXAuZ2V0KG1rZXkpLCBjdHgpOwogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkLmlzVW5pMVRvTUZLKCkpewogICAgICAgICAgICAgICAgICAgIGNo\nYW5nZVJvdyA9IHJtLmdldFJvdyhmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nLmdldERlY2xhcmVkVHlwZU1hcHBpbmcoKS5nZXRUYWJsZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX1VQREFURSwgdmFsc20sIHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgIGNoYW5nZVJvdy53aGVyZVByaW1h\ncnlLZXkodmFsc20pOwogICAgICAgICAgICAgICAgICAgIHZhbC5zZXRGb3Jl\naWduS2V5KGNoYW5nZVJvdywgc20pOwogICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICB2YWwuc2V0Rm9yZWlnbktleShjaGFu\nZ2VSb3csIHZhbHNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIAogICAgICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMud2hlcmUo\na2V5LCBta2V5LCBzdG9yZSwgY2hhbmdlUm93LCBfa2NvbHMpOwogICAgICAg\nICAgICAgICAgaWYgKCFmaWVsZC5pc1VuaTFUb01GSygpKQogICAgICAgICAg\nICAgICAgICAgIHJtLmZsdXNoU2Vjb25kYXJ5Um93KGNoYW5nZVJvdyk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGRlbGV0ZSB0aGUg\ncmVtb3ZlcwogICAgICAgIENvbGxlY3Rpb24gcmVtID0gY3QuZ2V0UmVtb3Zl\nZCgpOwogICAgICAgIGlmICghcmVtLmlzRW1wdHkoKSB8fCAoIWNhbkNoYW5n\nZSAmJiAhY2hhbmdlLmlzRW1wdHkoKSkpIHsKICAgICAgICAgICAgUm93IGRl\nbFJvdyA9IG51bGw7CiAgICAgICAgICAgIGlmICghZmllbGQuaXNVbmkxVG9N\nRksoKSkgewogICAgICAgICAgICAgICAgZGVsUm93ID0gcm0uZ2V0U2Vjb25k\nYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksCiAgICAgICAgICAgICAgICAgICAg\nUm93LkFDVElPTl9ERUxFVEUpOwogICAgICAgICAgICAgICAgZGVsUm93Lndo\nZXJlRm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLCBzbSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSByZW0uaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIG1rZXkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkLmlzVW5pMVRvTUZLKCkpewogICAgICAgICAgICAgICAgICAgIHVw\nZGF0ZVNldE51bGwoc20sIG1rZXksIHN0b3JlLCBybSk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEhhbmRsZXJTdHJh\ndGVnaWVzLndoZXJlKGtleSwgbWtleSwgc3RvcmUsIGRlbFJvdywgX2tjb2xz\nKTsKICAgICAgICAgICAgICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhk\nZWxSb3cpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmICghY2FuQ2hhbmdlICYmICFjaGFuZ2UuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNoYW5nZS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIG1rZXkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChmaWVsZC5pc1VuaTFUb01GSygpKXsKICAgICAgICAgICAgICAgICAgICAg\nICAgdXBkYXRlU2V0TnVsbChzbSwgbWtleSwgc3RvcmUsIHJtKTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgICAgICAgICAg\nICAgSGFuZGxlclN0cmF0ZWdpZXMud2hlcmUoa2V5LCBpdHIubmV4dCgpLCBz\ndG9yZSwgZGVsUm93LCAgX2tjb2xzKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coZGVsUm93KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGluc2VydCB0aGUgYWRkcwogICAgICAgIENv\nbGxlY3Rpb24gYWRkID0gY3QuZ2V0QWRkZWQoKTsKICAgICAgICBpZiAoIWFk\nZC5pc0VtcHR5KCkgfHwgKCFjYW5DaGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5\nKCkpKSB7CiAgICAgICAgICAgIFJvdyBhZGRSb3cgPSBudWxsOwogICAgICAg\nICAgICBpZiAoIWZpZWxkLmlzVW5pMVRvTUZLKCkpIHsKICAgICAgICAgICAg\nICAgIGFkZFJvdyA9IHJtLmdldFNlY29uZGFyeVJvdyhmaWVsZC5nZXRUYWJs\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0lOU0VS\nVCk7CiAgICAgICAgICAgICAgICBhZGRSb3cuc2V0Rm9yZWlnbktleShmaWVs\nZC5nZXRKb2luRm9yZWlnbktleSgpLAogICAgICAgICAgICAgICAgICAgICAg\nICBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwgc20pOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYWRkLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBta2V5ID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIHZhbHNtID0gUmVsYXRpb25T\ndHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihtYXAuZ2V0KG1rZXkpLCBjdHgp\nOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmlzVW5pMVRvTUZLKCkpewog\nICAgICAgICAgICAgICAgICAgIGFkZFJvdyA9IHJtLmdldFJvdyhmaWVsZC5n\nZXRFbGVtZW50TWFwcGluZygpLmdldERlY2xhcmVkVHlwZU1hcHBpbmcoKS5n\nZXRUYWJsZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBSb3cuQUNUSU9O\nX1VQREFURSwgdmFsc20sIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGFk\nZFJvdy53aGVyZVByaW1hcnlLZXkodmFsc20pOwogICAgICAgICAgICAgICAg\nICAgIHZhbC5zZXRGb3JlaWduS2V5KGFkZFJvdywgc20pOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWwuc2V0Rm9y\nZWlnbktleShhZGRSb3csIHZhbHNtKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdp\nZXMuc2V0KGtleSwgbWtleSwgc3RvcmUsIGFkZFJvdywgX2tjb2xzLAogICAg\nICAgICAgICAgICAgICAgIF9raW8sIHRydWUpOwogICAgICAgICAgICAgICAg\naWYgKCFmaWVsZC5pc1VuaTFUb01GSygpKQogICAgICAgICAgICAgICAgICAg\nIHJtLmZsdXNoU2Vjb25kYXJ5Um93KGFkZFJvdyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKCFjYW5DaGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2hh\nbmdlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICAgICAgbWtleSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAg\nICAgdmFsc20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2Vy\nKG1hcC5nZXQobWtleSksIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGZpZWxkLmlzVW5pMVRvTUZLKCkpewogICAgICAgICAgICAgICAgICAgICAg\nICBhZGRSb3cgPSBybS5nZXRSb3coZmllbGQuZ2V0RWxlbWVudE1hcHBpbmco\nKS5nZXREZWNsYXJlZFR5cGVNYXBwaW5nKCkuZ2V0VGFibGUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05fVVBEQVRFLCB2YWxz\nbSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFJvdy53aGVy\nZVByaW1hcnlLZXkodmFsc20pOwogICAgICAgICAgICAgICAgICAgICAgICB2\nYWwuc2V0Rm9yZWlnbktleShhZGRSb3csIHNtKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YWwuc2V0\nRm9yZWlnbktleShhZGRSb3csIHZhbHNtKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAg\nSGFuZGxlclN0cmF0ZWdpZXMuc2V0KGtleSwgbWtleSwgc3RvcmUsIGFkZFJv\ndywgX2tjb2xzLAogICAgICAgICAgICAgICAgICAgICAgICBfa2lvLCB0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkLmlzVW5pMVRvTUZL\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vjb25kYXJ5\nUm93KGFkZFJvdyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlv\nbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyLAogICAgICAgIGJv\nb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0g\nZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBDbGFzc01hcHBp\nbmdbXSBjbHNzID0gdmFsLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7\nCiAgICAgICAgaWYgKGNsc3MubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAg\naWYgKHRyYXZlcnNlKQogICAgICAgICAgICAgICAgdGhyb3cgUmVsYXRpb25T\ndHJhdGVnaWVzLnVuam9pbmFibGUodmFsKTsKICAgICAgICAgICAgcmV0dXJu\nIGpvaW5zOwogICAgICAgIH0KICAgICAgICBGb3JlaWduS2V5IGZrID0gdmFs\nLmdldEZvcmVpZ25LZXkoY2xzc1swXSk7CiAgICAgICAgaWYgKGZrID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICBpZiAoZm9y\nY2VPdXRlcikKICAgICAgICAgICAgcmV0dXJuIGpvaW5zLm91dGVySm9pblJl\nbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGZrLCBj\nbHNzWzBdLCB2YWwuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLAogICAgICAgICAg\nICAgICAgZmFsc2UsIGZhbHNlKTsKICAgICAgICByZXR1cm4gam9pbnMuam9p\nblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGZr\nLCBjbHNzWzBdLCB2YWwuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCAKICAgICAg\nICAgICAgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nam9pbktleVJlbGF0aW9uKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0\nZXIsCiAgICAgICAgYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIGlmICh0\ncmF2ZXJzZSkKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMuYXNzZXJ0\nSm9pbmFibGUoZmllbGQuZ2V0S2V5TWFwcGluZygpKTsKICAgICAgICByZXR1\ncm4gam9pbnM7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0b0RhdGFTdG9y\nZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAg\nIHJldHVybiBSZWxhdGlvblN0cmF0ZWdpZXMudG9EYXRhU3RvcmVWYWx1ZShm\naWVsZC5nZXRFbGVtZW50TWFwcGluZygpLAogICAgICAgICAgICB2YWwsIHN0\nb3JlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvS2V5RGF0YVN0b3Jl\nVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\ncmV0dXJuIEhhbmRsZXJTdHJhdGVnaWVzLnRvRGF0YVN0b3JlVmFsdWUoZmll\nbGQuZ2V0S2V5TWFwcGluZygpLCB2YWwsCiAgICAgICAgICAgIF9rY29scywg\nc3RvcmUpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5h\nZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmICgoZmllbGQuZ2V0TWFwcGVkQnkoKSAhPSBudWxsICYmICFmaWVsZC5p\nc0JpTVRvMUpUKCkpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYg\nKGZpZWxkLmlzVW5pMVRvTUZLKCkpIHsKICAgICAgICAgICAgTWFwIG1hcE9i\naiA9IChNYXApc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSk7CiAg\nICAgICAgICAgIHVwZGF0ZVNldE51bGwoc20sIHN0b3JlLCBybSwgbWFwT2Jq\nLmtleVNldCgpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gICAg\nCgogICAgICAgIHN1cGVyLmRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZVNldE51bGwoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJt\nLAogICAgICAgIFNldCByZW0pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcmVtLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE9iamVjdCBta2V5ID0gaXRyLm5l\neHQoKTsKICAgICAgICAgICAgdXBkYXRlU2V0TnVsbChzbSwgbWtleSwgc3Rv\ncmUsIHJtKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHVw\nZGF0ZVNldE51bGwoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0IG1r\nZXksIAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGtl\neSA9IGZpZWxkLmdldEtleU1hcHBpbmcoKTsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBT\ndG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgpOwogICAgICAg\nIFZhbHVlTWFwcGluZ0luZm8gdmluZm8gPSBmaWVsZC5nZXRFbGVtZW50TWFw\ncGluZygpLmdldFZhbHVlSW5mbygpOwogICAgICAgIFRhYmxlIHRhYmxlID0g\ndmluZm8uZ2V0VGFibGUodmFsKTsKICAgICAgICBGb3JlaWduS2V5IGpvaW5G\nSyA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0Sm9pbkZvcmVpZ25LZXko\nZmllbGQsIHRhYmxlLCB0cnVlKTsKICAgICAgICBSb3cgZGVsUm93ID0gcm0u\nZ2V0Um93KGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0RGVjbGFyZWRU\neXBlTWFwcGluZygpLmdldFRhYmxlKCksCiAgICAgICAgICAgIFJvdy5BQ1RJ\nT05fVVBEQVRFLCBzbSwgdHJ1ZSk7CiAgICAgICAgZGVsUm93LndoZXJlRm9y\nZWlnbktleShqb2luRkssIHNtKTsKICAgICAgICB2YWwuc2V0Rm9yZWlnbktl\neShkZWxSb3csIG51bGwpOwogICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLnNl\ndChrZXksIG51bGwsIHN0b3JlLCBkZWxSb3csIF9rY29scywgX2tpbywgdHJ1\nZSk7CiAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMud2hlcmUoa2V5LCBta2V5\nLCBzdG9yZSwgZGVsUm93LCBfa2NvbHMpOwogICAgfQp9Cg==\n","encoding":"base64"}

