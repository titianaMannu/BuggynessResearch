{"sha":"df8edcc9c765b60396c944c357f0a08869dea767","node_id":"MDQ6QmxvYjIwNjM2NDpkZjhlZGNjOWM3NjViNjAzOTZjOTQ0YzM1N2YwYTA4ODY5ZGVhNzY3","size":13496,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/df8edcc9c765b60396c944c357f0a08869dea767","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlu\nZ1BlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5D\nbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJlc3VsdDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93SW1wbDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwoKLyoq\nCiAqIEJhc2UgY2xhc3MgZm9yIG1hcCBtYXBwaW5ncy4gSGFuZGxlcyBtYW5h\nZ2luZyB0aGUgc2Vjb25kYXJ5IHRhYmxlCiAqIHVzZWQgdG8gaG9sZCBtYXAg\na2V5cyBhbmQgdmFsdWVzIGFuZCBsb2FkaW5nLiBTdWJjbGFzc2VzIG11c3Qg\naW1wbGVtZW50CiAqIGFic3RyYWN0IG1ldGhvZHMgYW5kIGluc2VydC91cGRh\ndGUgYmVoYXZpb3IgYXMgd2VsbCBhcyBvdmVycmlkaW5nCiAqIHtAbGluayBG\naWVsZFN0cmF0ZWd5I3RvRGF0YVN0b3JlVmFsdWV9LAogKiB7QGxpbmsgRmll\nbGRTdHJhdGVneSN0b0tleURhdGFTdG9yZVZhbHVlfSwKICoge0BsaW5rIEZp\nZWxkU3RyYXRlZ3kjam9pblJlbGF0aW9ufSwgYW5kCiAqIHtAbGluayBGaWVs\nZFN0cmF0ZWd5I2pvaW5LZXlSZWxhdGlvbn0gaWYgbmVjZXNzYXJ5LgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNz\nIE1hcFRhYmxlRmllbGRTdHJhdGVneQogICAgZXh0ZW5kcyBDb250YWluZXJG\naWVsZFN0cmF0ZWd5CiAgICBpbXBsZW1lbnRzIExSU01hcEZpZWxkU3RyYXRl\nZ3kgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9j\nID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoTWFwVGFibGVGaWVs\nZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGdl\ndEZpZWxkTWFwcGluZygpIHsKICAgICAgICByZXR1cm4gZmllbGQ7CiAgICB9\nCgogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldEluZGVwZW5kZW50S2V5\nTWFwcGluZ3MoYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIHJldHVybiAo\ndHJhdmVyc2UpID8gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldEluZGVwZW5k\nZW50VHlwZU1hcHBpbmdzKCkKICAgICAgICAgICAgOiBDbGFzc01hcHBpbmcu\nRU1QVFlfTUFQUElOR1M7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGlu\nZ1tdIGdldEluZGVwZW5kZW50VmFsdWVNYXBwaW5ncyhib29sZWFuIHRyYXZl\ncnNlKSB7CiAgICAgICAgcmV0dXJuICh0cmF2ZXJzZSkgPyBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpLgogICAgICAgICAgICBnZXRJbmRlcGVuZGVudFR5\ncGVNYXBwaW5ncygpIDogQ2xhc3NNYXBwaW5nLkVNUFRZX01BUFBJTkdTOwog\nICAgfQoKICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldEpvaW5Gb3JlaWduS2V5\nKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0\nSm9pbkZvcmVpZ25LZXkoKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGRl\ncml2ZUtleShKREJDU3RvcmUgc3RvcmUsIE9iamVjdCB2YWx1ZSkgewogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZGVy\naXZlVmFsdWUoSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3Qga2V5KSB7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2Vz\nIHtAbGluayBGaWVsZFN0cmF0ZWd5I2pvaW5LZXlSZWxhdGlvbn0gYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHVibGljIEpvaW5zIGpvaW5LZXlSZWxhdGlv\nbihKb2lucyBqb2lucywgQ2xhc3NNYXBwaW5nIGtleSkgewogICAgICAgIHJl\ndHVybiBqb2luS2V5UmVsYXRpb24oam9pbnMsIGZhbHNlLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnZva2VzIHtAbGluayBGaWVsZFN0cmF0\nZWd5I2pvaW5SZWxhdGlvbn0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVi\nbGljIEpvaW5zIGpvaW5WYWx1ZVJlbGF0aW9uKEpvaW5zIGpvaW5zLCBDbGFz\nc01hcHBpbmcgdmFsKSB7CiAgICAgICAgcmV0dXJuIGpvaW5SZWxhdGlvbihq\nb2lucywgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBt\nYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChmaWVsZC5nZXRUeXBl\nQ29kZSgpICE9IEphdmFUeXBlcy5NQVApCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1hcCIsIGZpZWxk\nKSk7CiAgICAgICAgaWYgKGZpZWxkLmdldEtleSgpLmdldFZhbHVlTWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm1hcHBlZC1ieS1rZXkiLCBmaWVsZCkpOwoK\nICAgICAgICAvLyBOb24tZGVmYXVsdCBtYXBwaW5nIFVuaS0vT25lVG9NYW55\nL0ZvcmVpZ25LZXkgYWxsb3dzIHNjaGVtYSBjb21wb25lbnRzCiAgICAgICAg\naWYgKGZpZWxkLmlzVW5pMVRvTUZLKCkpICAKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIGlmIChmaWVsZC5pc0JpTVRvMUpUKCkpCiAgICAgICAgICAg\nIGZpZWxkLnNldEJpMU1Kb2luVGFibGVJbmZvKCk7CiAgICAgICAgZmllbGQu\nZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzKGZpZWxk\nLCAhYWRhcHQpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBkZWxldGUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dN\nYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFJvdyByb3cgPSBybS5nZXRBbGxSb3dzKGZpZWxkLmdldFRhYmxlKCks\nIFJvdy5BQ1RJT05fREVMRVRFKTsKICAgICAgICByb3cud2hlcmVGb3JlaWdu\nS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksIHNtKTsKICAgICAgICBy\nbS5mbHVzaEFsbFJvd3Mocm93KTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHN1\ncHBvcnRzU2VsZWN0KFNlbGVjdCBzZWwsIGludCB0eXBlLCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVybiAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKGZpZWxkLmlzTFJTKCkpIHsKICAgICAgICAgICAgc20u\nc3RvcmVPYmplY3RGaWVsZChmaWVsZC5nZXRJbmRleCgpLCBuZXcgTFJTUHJv\neHlNYXAodGhpcykpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBzZWxlY3QgYWxsIGFuZCBsb2FkIGludG8gYSBub3JtYWwg\ncHJveHkKICAgICAgICBKb2luc1tdIGpvaW5zID0gbmV3IEpvaW5zWzJdOwog\nICAgICAgIFJlc3VsdFtdIHJlcyA9IGdldFJlc3VsdHMoc20sIHN0b3JlLCBm\nZXRjaCwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdF\nUl9QQVJBTExFTCwgam9pbnMsIGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBNYXAgbWFwID0gKE1hcCkgc20ubmV3UHJveHkoZmllbGQuZ2V0\nSW5kZXgoKSk7CiAgICAgICAgICAgIE9iamVjdCBrZXksIHZhbDsKICAgICAg\nICAgICAgd2hpbGUgKHJlc1swXS5uZXh0KCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChyZXNbMV0gIT0gcmVzWzBdICYmICFyZXNbMV0ubmV4dCgpKQogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGtleSA9\nIGxvYWRLZXkoc20sIHN0b3JlLCBmZXRjaCwgcmVzWzBdLCBqb2luc1swXSk7\nCiAgICAgICAgICAgICAgICB2YWwgPSBsb2FkVmFsdWUoc20sIHN0b3JlLCBm\nZXRjaCwgcmVzWzFdLCBqb2luc1sxXSk7CiAgICAgICAgICAgICAgICBtYXAu\ncHV0KGtleSwgdmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzbS5z\ndG9yZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCBtYXApOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHJlc1swXS5jbG9zZSgpOwogICAgICAg\nICAgICBpZiAocmVzWzFdICE9IHJlc1swXSkKICAgICAgICAgICAgICAgIHJl\nc1sxXS5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGxvYWRLZXlQcm9qZWN0aW9uKEpEQkNTdG9yZSBzdG9yZSwKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzLCBK\nb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gbG9hZEtleShudWxsLCBzdG9yZSwgZmV0Y2gsIHJlcywg\nam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZFByb2plY3Rp\nb24oSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBsb2FkVmFs\ndWUobnVsbCwgc3RvcmUsIGZldGNoLCByZXMsIGpvaW5zKTsKICAgIH0KCiAg\nICBwdWJsaWMgSm9pbnMgam9pbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3Jj\nZU91dGVyKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkLmpvaW4oam9pbnMsIGZv\ncmNlT3V0ZXIsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2lu\nS2V5KEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsKICAgICAg\nICByZXR1cm4gZmllbGQuam9pbihqb2lucywgZm9yY2VPdXRlciwgdHJ1ZSk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgZ2V0Sm9pbkZvcmVp\nZ25LZXkoKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkLmdldEpvaW5Gb3JlaWdu\nS2V5KCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZ1tdIGdl\ndEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKGJvb2xlYW4gdHJhdmVyc2Up\nIHsKICAgICAgICByZXR1cm4gQ2xhc3NNYXBwaW5nLkVNUFRZX01BUFBJTkdT\nOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgdm9pZCBoYW5kbGVNYXBwZWRC\neUZvcmVpZ25LZXkoYm9vbGVhbiBhZGFwdCl7CiAgICAgICAgYm9vbGVhbiBj\ncml0ZXJpYSA9IGZpZWxkLmdldFZhbHVlSW5mbygpLmdldFVzZUNsYXNzQ3Jp\ndGVyaWEoKTsKICAgICAgICAvLyBjaGVjayBmb3IgbmFtZWQgaW52ZXJzZQog\nICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWQgPSBmaWVsZC5nZXRNYXBwZWRC\neU1hcHBpbmcoKTsKICAgICAgICBpZiAobWFwcGVkICE9IG51bGwpIHsKICAg\nICAgICAgICAgZmllbGQuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFD\nb21wb25lbnRzKGZpZWxkLCAhYWRhcHQpOwogICAgICAgICAgICBtYXBwZWQu\ncmVzb2x2ZShtYXBwZWQuTU9ERV9NRVRBIHwgbWFwcGVkLk1PREVfTUFQUElO\nRyk7CgogICAgICAgICAgICBpZiAoIW1hcHBlZC5pc01hcHBlZCgpIHx8IG1h\ncHBlZC5pc1NlcmlhbGl6ZWQoKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibWFwcGVkLWJ5LXVubWFw\ncGVkIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZCwgbWFwcGVkKSk7Cgog\nICAgICAgICAgICBpZiAobWFwcGVkLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5\ncGVzLlBDKSB7CiAgICAgICAgICAgICAgICBpZiAobWFwcGVkLmdldEpvaW5E\naXJlY3Rpb24oKSA9PSBtYXBwZWQuSk9JTl9GT1JXQVJEKSB7CiAgICAgICAg\nICAgICAgICAgICAgZmllbGQuc2V0Sm9pbkRpcmVjdGlvbihmaWVsZC5KT0lO\nX0lOVkVSU0UpOwogICAgICAgICAgICAgICAgICAgIGZpZWxkLnNldENvbHVt\nbnMobWFwcGVkLmdldERlZmluaW5nTWFwcGluZygpLgogICAgICAgICAgICAg\nICAgICAgICAgICBnZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoaXNUeXBlVW5qb2luZWRTdWJjbGFzcyhtYXBw\nZWQpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoIm1h\ncHBlZC1pbnZlcnNlLXVuam9pbmVkIiwgZmllbGQuZ2V0TmFtZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBw\naW5nKCksIG1hcHBlZCkpOwogICAgICAgICAgICAgICAgRm9yZWlnbktleSBm\nayA9IG1hcHBlZC5nZXRGb3JlaWduS2V5KAogICAgICAgICAgICAgICAgICAg\nICAgICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSk7CiAgICAgICAgICAg\nICAgICBmaWVsZC5zZXRGb3JlaWduS2V5KGZrKTsKICAgICAgICAgICAgICAg\nIGZpZWxkLnNldEpvaW5Gb3JlaWduS2V5KGZrKTsKICAgICAgICAgICAgfSBl\nbHNlIGlmIChtYXBwZWQuZ2V0RWxlbWVudCgpLmdldFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLlBDKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNUeXBlVW5q\nb2luZWRTdWJjbGFzcyhtYXBwZWQuZ2V0RWxlbWVudE1hcHBpbmcoKSkpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgibWFwcGVkLWlu\ndmVyc2UtdW5qb2luZWQiLCBmaWVsZC5nZXROYW1lKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSwg\nbWFwcGVkKSk7CgogICAgICAgICAgICAgICAgLy8gd2FybiB0aGUgdXNlciBh\nYm91dCBtYWtpbmcgdGhlIGNvbGxlY3Rpb24gc2lkZSB0aGUgb3duZXIKICAg\nICAgICAgICAgICAgIExvZyBsb2cgPSBmaWVsZC5nZXRSZXBvc2l0b3J5KCku\nZ2V0TG9nKCk7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgi\nY29sbC1vd25lciIsIGZpZWxkLCBtYXBwZWQpKTsKICAgICAgICAgICAgICAg\nIFZhbHVlTWFwcGluZyBlbGVtID0gbWFwcGVkLmdldEVsZW1lbnRNYXBwaW5n\nKCk7CiAgICAgICAgICAgICAgICBGb3JlaWduS2V5IGZrID0gZWxlbS5nZXRG\nb3JlaWduS2V5KCk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRKb2luRm9y\nZWlnbktleShmayk7CiAgICAgICAgICAgICAgICBmaWVsZC5nZXRFbGVtZW50\nTWFwcGluZygpLnNldEZvcmVpZ25LZXkoCiAgICAgICAgICAgICAgICAgICAg\nICAgIG1hcHBlZC5nZXRKb2luRm9yZWlnbktleSgpKTsKICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1pbnYtcmVsYXRpb24iLAogICAgICAgICAg\nICAgICAgICAgIGZpZWxkLCBtYXBwZWQpKTsKCiAgICAgICAgICAgIGZpZWxk\nLnNldFVzZUNsYXNzQ3JpdGVyaWEoY3JpdGVyaWEpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVW5pLS9P\nbmVUb01hbnkvRm9yZWluZ0tleQogICAgICAgICAgICBWYWx1ZU1hcHBpbmcg\ndmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAg\ndmFsLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoZmllbGQuZ2V0VmFsdWVJ\nbmZvKCkuZ2V0Q29sdW1ucygpKTsKICAgICAgICAgICAgaWYgKHZhbC5nZXRU\neXBlTWFwcGluZygpLmlzTWFwcGVkKCkpIHsKICAgICAgICAgICAgICAgIFZh\nbHVlTWFwcGluZ0luZm8gdmluZm8gPSB2YWwuZ2V0VmFsdWVJbmZvKCk7CiAg\nICAgICAgICAgICAgICBGb3JlaWduS2V5IGZrID0gdmluZm8uZ2V0VHlwZUpv\naW4odmFsLCBEQklkZW50aWZpZXIuTlVMTCwgZmFsc2UsIGFkYXB0KTsKICAg\nICAgICAgICAgICAgIHZhbC5zZXRGb3JlaWduS2V5KGZrKTsKICAgICAgICAg\nICAgICAgIHZhbC5zZXRDb2x1bW5JTyh2aW5mby5nZXRDb2x1bW5JTygpKTsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBSZWxhdGlvblN0\ncmF0ZWdpZXMubWFwUmVsYXRpb25Ub1VubWFwcGVkUEModmFsLCAidmFsdWUi\nLCBhZGFwdCk7CgogICAgICAgICAgICB2YWwubWFwQ29uc3RyYWludHMoInZh\nbHVlIiwgYWRhcHQpOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KLyoKICAgICAgICAvLyB0aGlzIGlzIG5lY2Vzc2FyeSB0\nbyBzdXBwb3J0IG9wZW5qcGEgMyBtYXBwaW5ncywgd2hpY2ggZGlkbid0CiAg\nICAgICAgLy8gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIHNlY29uZGFyeSB0YWJs\nZSBqb2lucyBhbmQgcmVsYXRpb25zIGJ1aWx0CiAgICAgICAgLy8gYXJvdW5k\nIGFuIGludmVyc2Uga2V5OiBjaGVjayB0byBzZWUgaWYgd2UncmUgbWFwcGVk\nIGFzIGEgc2Vjb25kYXJ5CiAgICAgICAgLy8gdGFibGUgam9pbiBidXQgd2Un\ncmUgaW4gdGhlIHRhYmxlIG9mIHRoZSByZWxhdGVkIHR5cGUsIGFuZCBpZiBz\nbwogICAgICAgIC8vIHN3aXRjaCBvdXIgam9pbiBtYXBwaW5nIGluZm8gdG8g\nb3VyIHZhbHVlIG1hcHBpbmcgaW5mbwogICAgICAgIFN0cmluZyB0YWJsZU5h\nbWUgPSBmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldFRhYmxlTmFtZSgpOwog\nICAgICAgIFRhYmxlIHRhYmxlID0gZmllbGQuZ2V0VHlwZU1hcHBpbmcoKS5n\nZXRUYWJsZSgpOwogICAgICAgIFZhbHVlTWFwcGluZ0luZm8gdmluZm8gPSBm\naWVsZC5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBpZiAodGFibGVOYW1lICE9\nIG51bGwgJiYgdGFibGUgIT0gbnVsbAogICAgICAgICAgICAmJiAodGFibGVO\nYW1lLmVxdWFsc0lnbm9yZUNhc2UodGFibGUuZ2V0TmFtZSgpKQogICAgICAg\nICAgICB8fCB0YWJsZU5hbWUuZXF1YWxzSWdub3JlQ2FzZSh0YWJsZS5nZXRG\ndWxsTmFtZSgpKSkpIHsKICAgICAgICAgICAgdmluZm8uc2V0Sm9pbkRpcmVj\ndGlvbihNYXBwaW5nSW5mby5KT0lOX0lOVkVSU0UpOwogICAgICAgICAgICB2\naW5mby5zZXRDb2x1bW5zKGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0Q29s\ndW1ucygpKTsKICAgICAgICAgICAgZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5z\nZXRUYWJsZU5hbWUobnVsbCk7CiAgICAgICAgICAgIGZpZWxkLmdldE1hcHBp\nbmdJbmZvKCkuc2V0Q29sdW1ucyhudWxsKTsKICAgICAgICB9CiovICAgICAg\nICAKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1R5cGVVbmpvaW5l\nZFN1YmNsYXNzKFZhbHVlTWFwcGluZyBtYXBwZWQpIHsKICAgICAgICBDbGFz\nc01hcHBpbmcgZGVmID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7CiAg\nICAgICAgZm9yICg7IGRlZiAhPSBudWxsOyBkZWYgPSBkZWYuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpCiAgICAgICAgICAgIGlmIChkZWYg\nPT0gbWFwcGVkLmdldFR5cGVNYXBwaW5nKCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gcG9wdWxhdGVLZXkoUm93IHJvdywgT3BlbkpQ\nQVN0YXRlTWFuYWdlciB2YWxzbSwKICAgICAgICAgICAgT2JqZWN0IG9iaiwg\nU3RvcmVDb250ZXh0IGN0eCwgUm93TWFuYWdlciBybSwgSkRCQ1N0b3JlIHN0\nb3JlKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBDbGFzc01hcHBpbmcgbWV0YSA9IChDbGFzc01hcHBpbmcpdmFsc20uZ2V0\nTWV0YURhdGEoKTsKICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSBnZXRGaWVs\nZE1hcHBpbmcobWV0YSk7CiAgICAgICAgaWYgKGZtID09IG51bGwpIAogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgTWFwIG1hcE9iaiA9IChN\nYXApdmFsc20uZmV0Y2hPYmplY3QoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAg\nQ29sbGVjdGlvbjxNYXAuRW50cnk+IGVudHJ5U2V0cyA9IG1hcE9iai5lbnRy\neVNldCgpOwogICAgICAgIGJvb2xlYW4gZm91bmQgPSBmYWxzZTsKICAgICAg\nICBmb3IgKE1hcC5FbnRyeSBlbnRyeSA6IGVudHJ5U2V0cykgewogICAgICAg\nICAgICBPYmplY3QgdmFsdWUgPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAg\nICAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmbGVjdGluZ1BlcnNpc3RlbmNl\nQ2FwYWJsZSkKICAgICAgICAgICAgICAgb2JqID0gKChSZWZsZWN0aW5nUGVy\nc2lzdGVuY2VDYXBhYmxlKW9iaikuZ2V0TWFuYWdlZEluc3RhbmNlKCk7IAog\nICAgICAgICAgICBpZiAodmFsdWUgPT0gb2JqKSB7CiAgICAgICAgICAgICAg\nICBSb3cgbmV3Um93ID0gKFJvdykgKChSb3dJbXBsKXJvdykuY2xvbmUoKTsK\nICAgICAgICAgICAgICAgIE9iamVjdCBrZXlPYmogPSBlbnRyeS5nZXRLZXko\nKTsKICAgICAgICAgICAgICAgIFN0cmF0ZWd5IHN0cmF0ID0gZm0uZ2V0U3Ry\nYXRlZ3koKTsKICAgICAgICAgICAgICAgIGlmIChzdHJhdCBpbnN0YW5jZW9m\nIEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJhdGVneSkgewogICAg\nICAgICAgICAgICAgICAgIEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmllbGRT\ndHJhdGVneSBoclN0cmF0ID0gCiAgICAgICAgICAgICAgICAgICAgICAgIChI\nYW5kbGVyUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3kpIHN0cmF0Owog\nICAgICAgICAgICAgICAgICAgIGhyU3RyYXQuc2V0S2V5KGtleU9iaiwgc3Rv\ncmUsIG5ld1Jvdyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleU9i\naiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJsZSkgewogICAgICAgICAg\nICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIga2V5c20gPSAKICAgICAg\nICAgICAgICAgICAgICAgICAgUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRl\nTWFuYWdlcihlbnRyeS5nZXRLZXkoKSwgY3R4KTsKICAgICAgICAgICAgICAg\nICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZm0uZ2V0S2V5TWFwcGluZygpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChrZXlzbSAhPSBudWxsKSAKICAgICAg\nICAgICAgICAgICAgICAgICAga2V5LnNldEZvcmVpZ25LZXkobmV3Um93LCBr\nZXlzbSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICBrZXkuc2V0Rm9yZWlnbktleShuZXdSb3csIG51bGwpOwog\nICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vj\nb25kYXJ5Um93KG5ld1Jvdyk7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZvdW5k\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFs\nc2U7ICAgICAgICAKICAgIH0KCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBn\nZXRGaWVsZE1hcHBpbmcoQ2xhc3NNYXBwaW5nIG1ldGEpIHsKICAgICAgICBG\naWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBtZXRhLmdldEZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGRz\nW2ldLmdldFZhbHVlTWFwcGluZygpOwogICAgICAgICAgICBpZiAoZmllbGRz\nW2ldLmdldE1hcHBlZEJ5TWV0YURhdGEoKSA9PSBmaWVsZCAmJiAKICAgICAg\nICAgICAgICAgICAgICB2YWwuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEph\ndmFUeXBlcy5NQVApCiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGRzW2ld\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KfQo=\n","encoding":"base64"}

