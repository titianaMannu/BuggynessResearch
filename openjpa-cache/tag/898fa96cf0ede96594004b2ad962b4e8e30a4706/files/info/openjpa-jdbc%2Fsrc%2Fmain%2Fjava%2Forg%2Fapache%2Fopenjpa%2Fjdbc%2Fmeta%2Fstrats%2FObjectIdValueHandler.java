{"sha":"7fe9ce8451b86e77fd30db5fcb5c1ed8618f1f51","node_id":"MDQ6QmxvYjIwNjM2NDo3ZmU5Y2U4NDUxYjg2ZTc3ZmQzMGRiNWZjYjVjMWVkODYxOGYxZjUx","size":6384,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7fe9ce8451b86e77fd30db5fcb5c1ed8618f1f51","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZp\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5D\nbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLk9iamVjdElkU3RhdGVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxF\neGNlcHRpb247CgovKioKICogSGFuZGxlciBmb3IgZW1iZWRkZWQgb2JqZWN0\nIGlkIGZpZWxkcy4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2\nYWRvYwogKiBAc2luY2UgMC40LjAKICovCnB1YmxpYyBjbGFzcyBPYmplY3RJ\nZFZhbHVlSGFuZGxlcgogICAgZXh0ZW5kcyBFbWJlZFZhbHVlSGFuZGxlciB7\nCgogICAgcHJpdmF0ZSBPYmplY3RbXSBfYXJncyA9IG51bGw7CgogICAgLyoq\nCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgQ29sdW1u\nW10gbWFwKFZhbHVlTWFwcGluZyB2bSwgU3RyaW5nIG5hbWUsIENvbHVtbklP\nIGlvLAogICAgICAgIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBEQkRpY3Rp\nb25hcnkgZGljdCA9IHZtLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0REJE\naWN0aW9uYXJ5KCk7CiAgICAgICAgREJJZGVudGlmaWVyIGNvbE5hbWUgPSBE\nQklkZW50aWZpZXIubmV3Q29sdW1uKG5hbWUsIGRpY3QgIT0gbnVsbCA/IGRp\nY3QuZGVsaW1pdEFsbCgpIDogZmFsc2UpOwogICAgICAgIHJldHVybiBtYXAo\ndm0sIGNvbE5hbWUsIGlvLCBhZGFwdCk7CiAgICB9CgogICAgcHVibGljIENv\nbHVtbltdIG1hcChWYWx1ZU1hcHBpbmcgdm0sIERCSWRlbnRpZmllciBuYW1l\nLCBDb2x1bW5JTyBpbywKICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAgICAg\nICAgTGlzdCBjb2xzID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgIExpc3Qg\nYXJncyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBzZXRNYXBzSWRDb2wo\ndm0pOwogICAgICAgIHN1cGVyLm1hcCh2bSwgbmFtZSwgaW8sIGFkYXB0LCBj\nb2xzLCBhcmdzKTsKCiAgICAgICAgdm0uc2V0Q29sdW1ucygoQ29sdW1uW10p\nIGNvbHMudG9BcnJheShuZXcgQ29sdW1uW2NvbHMuc2l6ZSgpXSkpOwogICAg\nICAgIF9hcmdzID0gYXJncy50b0FycmF5KCk7CiAgICAgICAgcmV0dXJuIHZt\nLmdldENvbHVtbnMoKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIHNl\ndE1hcHNJZENvbChWYWx1ZU1hcHBpbmcgdm0pIHsKICAgICAgICBpZiAoISh2\nbSBpbnN0YW5jZW9mIEZpZWxkTWFwcGluZykpIAogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgaWYgKCEoKEZpZWxkTWFwcGluZyl2bSkuaGFzTWFwc0lk\nQ29scygpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NNYXBw\naW5nIGVtYmVkZGVkTWV0YSA9IChDbGFzc01hcHBpbmcpKChGaWVsZE1hcHBp\nbmcpdm0pLmdldFZhbHVlKCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChlbWJlZGRlZE1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIExpc3QgbWFwc0lkQ29sTGlzdCA9ICgoRmllbGRNYXBw\naW5nKXZtKS5nZXRWYWx1ZUluZm8oKS5nZXRNYXBzSWRDb2x1bW5zKCk7CiAg\nICAgICAgaWYgKG1hcHNJZENvbExpc3Quc2l6ZSgpID4gMCApIHsKICAgICAg\nICAgICAgc2V0TWFwc0lkQ29scyhtYXBzSWRDb2xMaXN0LCBlbWJlZGRlZE1l\ndGEpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAKCiAgICAgICAg\nRmllbGRNYXBwaW5nW10gZm1kcyA9IGVtYmVkZGVkTWV0YS5nZXRGaWVsZE1h\ncHBpbmdzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1hcHNJZENvbExpc3QgPSBmbWRz\nW2ldLmdldFZhbHVlSW5mbygpLmdldE1hcHNJZENvbHVtbnMoKTsKICAgICAg\nICAgICAgaWYgKG1hcHNJZENvbExpc3Quc2l6ZSgpID09IDApCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGVt\nYmVkZGVkTWV0YTEgPSAoQ2xhc3NNYXBwaW5nKWZtZHNbaV0uZ2V0RW1iZWRk\nZWRNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoZW1iZWRkZWRNZXRhMSAh\nPSBudWxsKSAKICAgICAgICAgICAgICAgIHNldE1hcHNJZENvbHMobWFwc0lk\nQ29sTGlzdCwgZW1iZWRkZWRNZXRhMSk7CiAgICAgICAgICAgIGVsc2UgCiAg\nICAgICAgICAgICAgICBzZXRNYXBzSWRDb2xzKG1hcHNJZENvbExpc3QsIGZt\nZHNbaV0pOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lk\nIHNldE1hcHNJZENvbHMoTGlzdCBjb2xzLCBDbGFzc01hcHBpbmcgY20pIHsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgREJJZGVudGlmaWVyIHJlZkNvbE5hbWUgPSAoKENv\nbHVtbiljb2xzLmdldChpKSkuZ2V0VGFyZ2V0SWRlbnRpZmllcigpOwogICAg\nICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSBnZXRSZWZlcmVuY2VGaWVsZChj\nbSwgcmVmQ29sTmFtZSk7CiAgICAgICAgICAgIGlmIChmbSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBMaXN0IGNvbExpc3QxID0gbmV3IEFycmF5TGlz\ndCgpOwogICAgICAgICAgICAgICAgY29sTGlzdDEuYWRkKGNvbHMuZ2V0KGkp\nKTsKICAgICAgICAgICAgICAgIGZtLnNldE1hcHNJZENvbHModHJ1ZSk7CiAg\nICAgICAgICAgICAgICBmbS5nZXRWYWx1ZUluZm8oKS5zZXRNYXBzSWRDb2x1\nbW5zKGNvbExpc3QxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgc2V0TWFwc0lkQ29scyhMaXN0IGNvbHMsIEZp\nZWxkTWFwcGluZyBmbSkgewogICAgICAgIGlmIChjb2xzLnNpemUoKSA9PSAx\nKSB7CiAgICAgICAgICAgIGZtLnNldE1hcHNJZENvbHModHJ1ZSk7CiAgICAg\nICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldE1hcHNJZENvbHVtbnMoY29s\ncyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgICAg\nIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5zaXplKCk7IGkr\nKykgewogICAgICAgICAgICBEQklkZW50aWZpZXIgcmVmQ29sTmFtZSA9ICgo\nQ29sdW1uKWNvbHMuZ2V0KGkpKS5nZXRUYXJnZXRJZGVudGlmaWVyKCk7CiAg\nICAgICAgICAgIGlmIChpc1JlZmVyZW5jZUZpZWxkKGZtLCByZWZDb2xOYW1l\nKSkgewogICAgICAgICAgICAgICAgTGlzdCBjb2xMaXN0MSA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgICAgIGNvbExpc3QxLmFkZChjb2xzLmdl\ndChpKSk7CiAgICAgICAgICAgICAgICBmbS5zZXRNYXBzSWRDb2xzKHRydWUp\nOwogICAgICAgICAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0TWFwc0lk\nQ29sdW1ucyhjb2xMaXN0MSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgRmllbGRNYXBwaW5nIGdldFJlZmVyZW5j\nZUZpZWxkKENsYXNzTWFwcGluZyBjbSwgREJJZGVudGlmaWVyIHJlZkNvbE5h\nbWUpIHsKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbWRzID0gY20uZ2V0Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaXNSZWZlcmVuY2VG\naWVsZChmbWRzW2ldLCByZWZDb2xOYW1lKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmbWRzW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFuIGlzUmVmZXJlbmNlRmll\nbGQoRmllbGRNYXBwaW5nIGZtLCBEQklkZW50aWZpZXIgcmVmQ29sTmFtZSkg\newogICAgICAgIExpc3QgY29scyA9IGZtLmdldFZhbHVlSW5mbygpLmdldENv\nbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5zaXplKCkgPT0gMCkgewogICAg\nICAgICAgICBpZiAoZm0uZ2V0TmFtZSgpLmVxdWFscyhyZWZDb2xOYW1lKSkK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAgICAgICAgICAgICAgICAK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoKChDb2x1bW4pY29s\ncy5nZXQoMCkpLmdldElkZW50aWZpZXIoKS5lcXVhbHMocmVmQ29sTmFtZSkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IAogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndFJlc3VsdEFyZ3VtZW50KFZhbHVlTWFwcGluZyB2bSkgewogICAgICAgIHJl\ndHVybiBfYXJnczsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0\nb3JlVmFsdWUoVmFsdWVNYXBwaW5nIHZtLCBPYmplY3QgdmFsLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20gPSAodmFsID09IG51bGwpID8gbnVsbAogICAgICAgICAgICA6IG5l\ndyBPYmplY3RJZFN0YXRlTWFuYWdlcih2YWwsIG51bGwsIHZtKTsKICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gdm0uZ2V0Q29sdW1ucygpOwogICAgICAgIE9i\namVjdCBydmFsID0gbnVsbDsKICAgICAgICBpZiAoY29scy5sZW5ndGggPiAx\nKQogICAgICAgICAgICBydmFsID0gbmV3IE9iamVjdFtjb2xzLmxlbmd0aF07\nCiAgICAgICAgcmV0dXJuIHN1cGVyLnRvRGF0YVN0b3JlVmFsdWUoc20sIHZt\nLCBzdG9yZSwgY29scywgcnZhbCwgMCk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCB0b09iamVjdFZhbHVlKFZhbHVlTWFwcGluZyB2bSwgT2JqZWN0IHZh\nbCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBu\nZXcgT2JqZWN0SWRTdGF0ZU1hbmFnZXIobnVsbCwgbnVsbCwgdm0pOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHN1cGVyLnRvT2JqZWN0VmFsdWUoc20s\nIHZtLCB2YWwsIG51bGwsIG51bGwsIHZtLmdldENvbHVtbnMoKSwgMCk7CiAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nIC8vIHNob3VsZG4ndCBiZSBwb3NzaWJsZQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oc2UpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gc20uZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAgICB9Cn0K\n","encoding":"base64"}

