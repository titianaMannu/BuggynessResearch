{"sha":"009518bfe4007c49389d91eaf900a7391ff5957e","node_id":"MDQ6QmxvYjIwNjM2NDowMDk1MThiZmU0MDA3YzQ5Mzg5ZDkxZWFmOTAwYTczOTFmZjU5NTdl","size":14958,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/009518bfe4007c49389d91eaf900a7391ff5957e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZpZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkVtYmVkZGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9u\nYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5z\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJlc3VsdDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3c7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2Fs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRl\nZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0\nYURhdGFFeGNlcHRpb247CgovKioKICogRGlyZWN0IG1hcHBpbmcgZnJvbSBh\nIHByaW1pdGl2ZSB2YWx1ZSB0byBhIGNvbHVtbi4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wCiAqLwpwdWJsaWMgY2xhc3MgUHJp\nbWl0aXZlRmllbGRTdHJhdGVneQogICAgZXh0ZW5kcyBBYnN0cmFjdEZpZWxk\nU3RyYXRlZ3kKICAgIGltcGxlbWVudHMgSm9pbmFibGUsIEVtYmVkZGFibGUg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdCBOVUxMID0gbmV3\nIE9iamVjdCgpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoUHJpbWl0\naXZlRmllbGRTdHJhdGVneS5jbGFzcyk7CgogICAgcHJpdmF0ZSBib29sZWFu\nIF9zdGF0ZUltYWdlID0gZmFsc2U7CgogICAgcHVibGljIHZvaWQgbWFwKGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAoZmllbGQuaXNTZXJpYWxpemVk\nKCkgfHwgIWZpZWxkLmdldFR5cGUoKS5pc1ByaW1pdGl2ZSgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\ndC1wcmltaXRpdmUiLCBmaWVsZCkpOwogICAgICAgIGFzc2VydE5vdE1hcHBl\nZEJ5KCk7CgogICAgICAgIC8vIG1hcCBqb2luIGtleSwgaWYgYW55CiAgICAg\nICAgZmllbGQubWFwSm9pbihhZGFwdCwgZmFsc2UpOwogICAgICAgIGZpZWxk\nLmdldEtleU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVt\nYUNvbXBvbmVudHMKICAgICAgICAgICAgKGZpZWxkLmdldEtleSgpLCAhYWRh\ncHQpOwogICAgICAgIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFs\ndWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAg\nIChmaWVsZC5nZXRFbGVtZW50KCksICFhZGFwdCk7CgogICAgICAgIFZhbHVl\nTWFwcGluZ0luZm8gdmluZm8gPSBmaWVsZC5nZXRWYWx1ZUluZm8oKTsKICAg\nICAgICB2aW5mby5hc3NlcnROb0pvaW4oZmllbGQsIHRydWUpOwogICAgICAg\nIHZpbmZvLmFzc2VydE5vRm9yZWlnbktleShmaWVsZCwgIWFkYXB0KTsKCiAg\nICAgICAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdG8gZGVsaW1pdCB0aGUgYmFz\nZSBmaWVsZCBuYW1lCiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBmaWVs\nZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldERCRGljdGlvbmFyeSgpOwog\nICAgICAgIERCSWRlbnRpZmllciBmaWVsZE5hbWUgPSBEQklkZW50aWZpZXIu\nbmV3Q29sdW1uKGZpZWxkLmdldE5hbWUoKSwgZGljdCAhPSBudWxsID8gZGlj\ndC5kZWxpbWl0QWxsKCkgOiBmYWxzZSk7CiAgICAgICAgLy8gZ2V0IHZhbHVl\nIGNvbHVtbnMKICAgICAgICBDb2x1bW4gdG1wQ29sID0gbmV3IENvbHVtbigp\nOwogICAgICAgIHRtcENvbC5zZXRJZGVudGlmaWVyKGZpZWxkTmFtZSk7CiAg\nICAgICAgdG1wQ29sLnNldEphdmFUeXBlKGZpZWxkLmdldFR5cGVDb2RlKCkp\nOwoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdmluZm8uZ2V0Q29sdW1ucyhm\naWVsZCwgZmllbGROYW1lLAogICAgICAgICAgICBuZXcgQ29sdW1uW117IHRt\ncENvbCB9LCBmaWVsZC5nZXRUYWJsZSgpLCBhZGFwdCk7CiAgICAgICAgaWYg\nKGZpZWxkLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMu\nQVVUT0FTU0lHTikKICAgICAgICAgICAgY29sc1swXS5zZXRBdXRvQXNzaWdu\nZWQodHJ1ZSk7CiAgICAgICAgaWYgKHZpbmZvLmlzSW1wbGljaXRSZWxhdGlv\nbigpKQogICAgICAgIAlmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgCQljb2xzW2ldLnNldEltcGxpY2l0UmVsYXRpb24o\ndHJ1ZSk7CiAgICAgICAgZmllbGQuc2V0Q29sdW1ucyhjb2xzKTsKICAgICAg\nICBmaWVsZC5zZXRDb2x1bW5JTyh2aW5mby5nZXRDb2x1bW5JTygpKTsKICAg\nICAgICBmaWVsZC5tYXBDb25zdHJhaW50cyhmaWVsZE5hbWUsIGFkYXB0KTsK\nCiAgICAgICAgLy8gYWRkIHByaW1hcnkga2V5IGNvbHVtbnMgdG8gdGFibGUg\ncGsgaWYgbG9naWNhbAogICAgICAgIGZpZWxkLm1hcFByaW1hcnlLZXkoYWRh\ncHQpOwogICAgICAgIFByaW1hcnlLZXkgcGsgPSBmaWVsZC5nZXRUYWJsZSgp\nLmdldFByaW1hcnlLZXkoKTsKICAgICAgICBpZiAoZmllbGQuaXNQcmltYXJ5\nS2V5KCkgJiYgcGsgIT0gbnVsbCAmJiAoYWRhcHQgfHwgcGsuaXNMb2dpY2Fs\nKCkpKQogICAgICAgICAgICBway5hZGRDb2x1bW4oY29sc1swXSk7CgogICAg\nICAgIC8vIHNldCBqb2luYWJsZQogICAgICAgIGZpZWxkLmdldERlZmluaW5n\nTWFwcGluZygpLnNldEpvaW5hYmxlKGZpZWxkLmdldENvbHVtbnMoKVswXSwg\ndGhpcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsK\nICAgICAgICAvLyByZWNvcmQgd2hldGhlciB3ZSdyZSB1c2luZyBhIHN0YXRl\nIGltYWdlIGluZGljYXRvciwgd2hpY2ggcmVxdWlyZXMKICAgICAgICAvLyB0\naGF0IHdlIGRvIHNwZWNpYWwgbnVsbCBjaGVja3Mgd2hlbiBsb2FkaW5nIHBy\naW1pdGl2ZXMKICAgICAgICBfc3RhdGVJbWFnZSA9IGZpZWxkLmdldERlZmlu\naW5nTWFwcGluZygpLmdldFZlcnNpb24oKS5nZXRTdHJhdGVneSgpLgogICAg\nICAgICAgICBnZXRBbGlhcygpLmVxdWFscyhTdGF0ZUNvbXBhcmlzb25WZXJz\naW9uU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgIGlmIChfc3RhdGVJbWFnZSkK\nICAgICAgICAgICAgZmllbGQuc2V0VXNlc0ltcGxEYXRhKG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFmaWVsZC5nZXRD\nb2x1bW5JTygpLmlzSW5zZXJ0YWJsZSgwLCBmYWxzZSkpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBSb3cgcm93ID0gZmllbGQuZ2V0Um93KHNtLCBz\ndG9yZSwgcm0sIFJvdy5BQ1RJT05fSU5TRVJUKTsKICAgICAgICBpZiAocm93\nICE9IG51bGwpCiAgICAgICAgICAgIHVwZGF0ZShzbSwgcm93KTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghZmllbGQuZ2V0Q29s\ndW1uSU8oKS5pc1VwZGF0YWJsZSgwLCBmYWxzZSkpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBSb3cgcm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9y\nZSwgcm0sIFJvdy5BQ1RJT05fVVBEQVRFKTsKICAgICAgICBpZiAocm93ICE9\nIG51bGwpCiAgICAgICAgICAgIHVwZGF0ZShzbSwgcm93KTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBkZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGZpZWxkLmRlbGV0ZVJvdyhzbSwg\nc3RvcmUsIHJtKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgdmFs\ndWUgb2YgdGhlIG93bmluZyBmaWVsZCBpbnRvIHRoZSBnaXZlbiByb3cuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgUm93IHJvdykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBDb2x1bW4gY29sID0gZmllbGQuZ2V0Q29sdW1ucygpWzBd\nOwogICAgICAgIHN3aXRjaCAoZmllbGQuZ2V0VHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAg\nICAgcm93LnNldEJvb2xlYW4oY29sLCBzbS5mZXRjaEJvb2xlYW4oZmllbGQu\nZ2V0SW5kZXgoKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICByb3cu\nc2V0Qnl0ZShjb2wsIHNtLmZldGNoQnl0ZShmaWVsZC5nZXRJbmRleCgpKSk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJvdy5zZXRDaGFyKGNvbCwg\nc20uZmV0Y2hDaGFyKGZpZWxkLmdldEluZGV4KCkpKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6\nCiAgICAgICAgICAgICAgICByb3cuc2V0RG91YmxlKGNvbCwgc20uZmV0Y2hE\nb3VibGUoZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAg\nICAgICAgICAgcm93LnNldEZsb2F0KGNvbCwgc20uZmV0Y2hGbG9hdChmaWVs\nZC5nZXRJbmRleCgpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgcm93\nLnNldEludChjb2wsIHNtLmZldGNoSW50KGZpZWxkLmdldEluZGV4KCkpKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5MT05HOgogICAgICAgICAgICAgICAgcm93LnNldExvbmcoY29sLCBz\nbS5mZXRjaExvbmcoZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICAgICAgcm93LnNldFNob3J0KGNvbCwgc20uZmV0Y2hTaG9y\ndChmaWVsZC5nZXRJbmRleCgpKSk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgaW50IHN1cHBvcnRzU2VsZWN0KFNlbGVjdCBzZWwsIGludCB0eXBl\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIGlmICh0eXBlID09IFNlbGVjdC5UWVBFX0pPSU5MRVNTICYmIHNlbC5pc1Nl\nbGVjdGVkKGZpZWxkLmdldFRhYmxlKCkpKQogICAgICAgICAgICByZXR1cm4g\nMTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNl\nbGVjdChTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIHNlbC5zZWxlY3QoZmll\nbGQuZ2V0Q29sdW1ucygpWzBdLCBmaWVsZC5qb2luKHNlbCkpOwogICAgICAg\nIHJldHVybiAxOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbCA9\nIGZpZWxkLmdldENvbHVtbnMoKVswXTsKICAgICAgICBpZiAoIXJlcy5jb250\nYWlucyhjb2wpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGludCBp\nZHggPSBmaWVsZC5nZXRJbmRleCgpOwogICAgICAgIGJvb2xlYW4gY2hlY2tO\ndWxsID0gX3N0YXRlSW1hZ2UgJiYgIWZpZWxkLmlzSm9pbk91dGVyKCk7CiAg\nICAgICAgc3dpdGNoIChmaWVsZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBz\nbS5zdG9yZUJvb2xlYW4oaWR4LCByZXMuZ2V0Qm9vbGVhbihjb2wpKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CWVRFOgogICAgICAgICAgICAgICAgc20uc3RvcmVCeXRlKGlkeCwgcmVz\nLmdldEJ5dGUoY29sKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHNt\nLnN0b3JlQ2hhcihpZHgsIHJlcy5nZXRDaGFyKGNvbCkpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgIHNtLnN0b3JlRG91YmxlKGlkeCwgcmVzLmdl\ndERvdWJsZShjb2wpKTsKICAgICAgICAgICAgICAgIGNoZWNrTnVsbCA9IGZh\nbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgc20uc3RvcmVGbG9h\ndChpZHgsIHJlcy5nZXRGbG9hdChjb2wpKTsKICAgICAgICAgICAgICAgIGNo\nZWNrTnVsbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHNt\nLnN0b3JlSW50KGlkeCwgcmVzLmdldEludChjb2wpKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgog\nICAgICAgICAgICAgICAgc20uc3RvcmVMb25nKGlkeCwgcmVzLmdldExvbmco\nY29sKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBzbS5zdG9yZVNo\nb3J0KGlkeCwgcmVzLmdldFNob3J0KGNvbCkpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHdlJ3JlIHVzaW5nIHN0YXRlIGltYWdlIHZlcnNpb25pbmcsIHNv\nIHJlY29yZCB0aGF0IHRoZSBhY3R1YWwgZGIKICAgICAgICAvLyB2YWx1ZSB3\nYXMgbnVsbCBzbyB3ZSBhZGQgdGhlIGNvcnJlY3QgT0wgY2hlY2sgb24gdXBk\nYXRlCiAgICAgICAgaWYgKGNoZWNrTnVsbCAmJiByZXMud2FzTnVsbCgpKQog\nICAgICAgICAgICBzbS5zZXRJbXBsRGF0YShmaWVsZC5nZXRJbmRleCgpLCBO\nVUxMKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc051bGwoU1FM\nQnVmZmVyIHNxbCwgU2VsZWN0IHNlbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBqb2lucyA9IGpvaW4oam9pbnMsIGZhbHNlKTsKICAgICAgICBzcWwuYXBw\nZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhmaWVsZC5nZXRDb2x1bW5zKClbMF0s\nIGpvaW5zKSkuCiAgICAgICAgICAgIGFwcGVuZCgiIElTICIpLmFwcGVuZFZh\nbHVlKG51bGwsIGZpZWxkLmdldENvbHVtbnMoKVswXSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXBwZW5kSXNOb3ROdWxsKFNRTEJ1ZmZlciBzcWwsIFNl\nbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2lu\nKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29s\ndW1uQWxpYXMoZmllbGQuZ2V0Q29sdW1ucygpWzBdLCBqb2lucykpLgogICAg\nICAgICAgICBhcHBlbmQoIiBJUyBOT1QgIikuYXBwZW5kVmFsdWUobnVsbCwg\nZmllbGQuZ2V0Q29sdW1ucygpWzBdKTsKICAgIH0KCiAgICBwdWJsaWMgSm9p\nbnMgam9pbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyKSB7CiAg\nICAgICAgcmV0dXJuIGZpZWxkLmpvaW4oam9pbnMsIGZvcmNlT3V0ZXIsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRQcm9qZWN0aW9u\nKEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwKICAgICAgICBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcmVzLmdldE9i\namVjdChmaWVsZC5nZXRDb2x1bW5zKClbMF0sIG51bGwsIGpvaW5zKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNpb25hYmxlKCkgewogICAg\nICAgIGlmIChmaWVsZC5pc0pvaW5PdXRlcigpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChmaWVsZC5nZXRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgd2hlcmUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0\nb3JlLCBSb3dNYW5hZ2VyIHJtLAogICAgICAgIE9iamVjdCBwcmV2VmFsdWUp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUm93IHJv\ndyA9IGZpZWxkLmdldFJvdyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNUSU9OX1VQ\nREFURSk7CiAgICAgICAgaWYgKHJvdyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIGZvciBwcmltaXRpdmVzIGxvYWRlZCBhcyBk\nZWZhdWx0IHZhbHMsIGNoZWNrIHRvIHNlZSBpZiB3YXMgbnVsbCBpbgogICAg\nICAgIC8vIHRoZSBkYXRhYmFzZSB3aGVuIGxvYWRlZCA9PSByZW1vdmUgdGhl\nIGltcGwgZGF0YSBhdCB0aGUgc2FtZSB0aW1lCiAgICAgICAgLy8gdG8gYmUg\nc3VyZSB3ZSBkb24ndCB0aGluayB0aGUgdmFsdWUgaXMgbnVsbCBhZnRlciB0\naGUgY29tbWl0CiAgICAgICAgQ29sdW1uIGNvbCA9IGZpZWxkLmdldENvbHVt\nbnMoKVswXTsKICAgICAgICBpZiAoc20uc2V0SW1wbERhdGEoZmllbGQuZ2V0\nSW5kZXgoKSwgbnVsbCkgPT0gTlVMTCkKICAgICAgICAgICAgcm93LndoZXJl\nTnVsbChjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcm93LndoZXJl\nT2JqZWN0KGNvbCwgcHJldlZhbHVlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEpvaW5hYmxlIGltcGxlbWVudGF0\naW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgaW50IGdldEZpZWxkSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIGZpZWxk\nLmdldEluZGV4KCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRQcmlt\nYXJ5S2V5VmFsdWUoUmVzdWx0IHJlcywgQ29sdW1uW10gY29scywgRm9yZWln\nbktleSBmaywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpvaW5zIGpvaW5z\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbHVt\nbiBjb2wgPSBjb2xzWzBdOwogICAgICAgIGlmIChmayAhPSBudWxsKQogICAg\nICAgICAgICBjb2wgPSBmay5nZXRDb2x1bW4oY29sKTsKICAgICAgICByZXR1\ncm4gSmF2YVR5cGVzLmNvbnZlcnQocmVzLmdldE9iamVjdChjb2wsIG51bGws\nIGpvaW5zKSwKICAgICAgICAgICAgZmllbGQuZ2V0VHlwZUNvZGUoKSk7CiAg\nICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoKSB7CiAgICAg\nICAgcmV0dXJuIGZpZWxkLmdldENvbHVtbnMoKTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEpvaW5WYWx1ZShPYmplY3QgZmllbGRWYWwsIENvbHVt\nbiBjb2wsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBmaWVs\nZFZhbDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEpvaW5WYWx1ZShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBDb2x1bW4gY29sLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBzbS5mZXRjaChmaWVs\nZC5nZXRJbmRleCgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRv\nQXNzaWduZWRWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsCiAgICAgICAgQ29sdW1uIGNvbCwgT2JqZWN0IGF1dG9JbmMp\nIHsKICAgICAgICBpbnQgaWR4ID0gZmllbGQuZ2V0SW5kZXgoKTsKICAgICAg\nICBzd2l0Y2ggKGZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIGlmIChh\ndXRvSW5jID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVC\nb29sZWFuKGlkeCwgZmFsc2UpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAo\nYXV0b0luYyBpbnN0YW5jZW9mIEJvb2xlYW4pCiAgICAgICAgICAgICAgICAg\nICAgc20uc3RvcmVCb29sZWFuKGlkeCwgKChCb29sZWFuKSBhdXRvSW5jKS5i\nb29sZWFuVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgc20uc3RvcmVCb29sZWFuKGlkeCwgKChOdW1iZXIpIGF1\ndG9JbmMpLmludFZhbHVlKCkgIT0gMCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAg\nICAgICAgIGlmIChhdXRvSW5jID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgc20uc3RvcmVCeXRlKGlkeCwgKGJ5dGUpIDApOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlQnl0ZShpZHgs\nICgoTnVtYmVyKSBhdXRvSW5jKS5ieXRlVmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgICAgIGlmIChhdXRvSW5jID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgc20uc3RvcmVDaGFyKGlkeCwgKGNoYXIpIDApOwogICAg\nICAgICAgICAgICAgZWxzZSBpZiAoYXV0b0luYyBpbnN0YW5jZW9mIENoYXJh\nY3RlcikKICAgICAgICAgICAgICAgICAgICBzbS5zdG9yZUNoYXIoaWR4LCAo\nKENoYXJhY3RlcikgYXV0b0luYykuY2hhclZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgZWxzZSBpZiAoYXV0b0luYyBpbnN0YW5jZW9mIFN0cmluZykKICAg\nICAgICAgICAgICAgICAgICBzbS5zdG9yZUNoYXIoaWR4LCAoKFN0cmluZykg\nYXV0b0luYykuY2hhckF0KDApKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICBzbS5zdG9yZUNoYXIoaWR4LCAoY2hhcikgKChO\ndW1iZXIpIGF1dG9JbmMpLmludFZhbHVlKCkpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgICAgIGlmIChhdXRvSW5jID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgc20uc3RvcmVEb3VibGUoaWR4LCAwRCk7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVEb3VibGUo\naWR4LCAoKE51bWJlcikgYXV0b0luYykuZG91YmxlVmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRkxPQVQ6CiAgICAgICAgICAgICAgICBpZiAoYXV0b0luYyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlRmxvYXQoaWR4LCAwRik7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc20uc3Rv\ncmVGbG9hdChpZHgsICgoTnVtYmVyKSBhdXRvSW5jKS5mbG9hdFZhbHVlKCkp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIGlmIChhdXRvSW5jID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVJbnQoaWR4LCAwKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzbS5z\ndG9yZUludChpZHgsICgoTnVtYmVyKSBhdXRvSW5jKS5pbnRWYWx1ZSgpKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5MT05HOgogICAgICAgICAgICAgICAgaWYgKGF1dG9JbmMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBzbS5zdG9yZUxvbmcoaWR4LCAwTCk7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc20u\nc3RvcmVMb25nKGlkeCwgKChOdW1iZXIpIGF1dG9JbmMpLmxvbmdWYWx1ZSgp\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGlmIChhdXRvSW5jID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVTaG9ydChpZHgs\nIChzaG9ydCkgMCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgc20uc3RvcmVTaG9ydChpZHgsICgoTnVtYmVyKSBhdXRvSW5j\nKS5zaG9ydFZhbHVlKCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEVtYmVkZGFibGUgaW1w\nbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIENvbHVtbklPIGdldENvbHVtbklPKCkgewogICAgICAg\nIHJldHVybiBmaWVsZC5nZXRDb2x1bW5JTygpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3RbXSBnZXRSZXN1bHRBcmd1bWVudHMoKSB7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0b0VtYmVkZGVk\nT2JqZWN0VmFsdWUoT2JqZWN0IHZhbCkgewogICAgICAgIHJldHVybiB2YWw7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCB0b0VtYmVkZGVkRGF0YVN0b3Jl\nVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\ncmV0dXJuIHRvRGF0YVN0b3JlVmFsdWUodmFsLCBzdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgbG9hZEVtYmVkZGVkKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBPYmplY3QgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHNtLnN0b3JlKGZpZWxkLmdldEluZGV4\nKCksIHZhbCk7CiAgICB9Cn0K\n","encoding":"base64"}

