{"sha":"bde5b898d12c437f194c5faaea37c2327f620c29","node_id":"MDQ6QmxvYjIwNjM2NDpiZGU1Yjg5OGQxMmM0MzdmMTk0YzVmYWFlYTM3YzIzMjdmNjIwYzI5","size":24017,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bde5b898d12c437f194c5faaea37c2327f620c29","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5K\nREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5GaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVjdXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5VbmlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RhdGVNYW5hZ2VySW1w\nbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhbmdlVHJhY2tl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CgovKioKICogQmFzZSBj\nbGFzcyBmb3Igc3RyYXRlZ2llcyB0aGF0IGFyZSBzdG9yZWQgYXMgYSBjb2xs\nZWN0aW9uLCBldmVuIGlmCiAqIHRoZWlyIGZpZWxkIHZhbHVlIGlzIHNvbWV0\naGluZyBlbHNlLiBIYW5kbGVzIGRhdGEgbG9hZGluZyBhbmQgYmFzaWMgcXVl\ncnkKICogZnVuY3Rpb25hbGl0eS4gU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVu\ndCBhYnN0cmFjdCBtZXRob2RzIGFuZAogKiBpbnNlcnQvdXBkYXRlL2RlbGV0\nZSBiZWhhdmlvciBhcyB3ZWxsIGFzIG92ZXJyaWRpbmcKICoge0BsaW5rIEZp\nZWxkU3RyYXRlZ3kjdG9EYXRhU3RvcmVWYWx1ZX0sIHtAbGluayBGaWVsZFN0\ncmF0ZWd5I2pvaW59LCBhbmQKICoge0BsaW5rIEZpZWxkU3RyYXRlZ3kjam9p\nblJlbGF0aW9ufSBpZiBuZWNlc3NhcnkuCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgU3RvcmVDb2xsZWN0aW9u\nRmllbGRTdHJhdGVneQogICAgZXh0ZW5kcyBDb250YWluZXJGaWVsZFN0cmF0\nZWd5IHsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZm9yZWlnbiBrZXkg\ndXNlZCB0byBqb2luIHRvIHRoZSBvd25pbmcgZmllbGQgZm9yIHRoZSBnaXZl\nbgogICAgICogZWxlbWVudCBtYXBwaW5nIGZyb20ge0BsaW5rICNnZXRJbmRl\ncGVuZGVudEVsZW1lbnRNYXBwaW5nc30gKG9yIG51bGwpLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3QgRm9yZWlnbktleSBnZXRKb2luRm9yZWln\nbktleShDbGFzc01hcHBpbmcgZWxlbSk7CgogICAgLyoqCiAgICAgKiBJbXBs\nZW1lbnQgdGhpcyBtZXRob2QgdG8gc2VsZWN0IHRoZSBlbGVtZW50cyBvZiB0\naGlzIGZpZWxkIGZvciB0aGUKICAgICAqIGdpdmVuIGVsZW1lbnQgbWFwcGlu\nZyBmcm9tIHtAbGluayAjZ2V0SW5kZXBlbmRlbnRFbGVtZW50TWFwcGluZ3N9\nCiAgICAgKiAob3IgbnVsbCkuIEVsZW1lbnRzIG9mIHRoZSByZXN1bHQgd2ls\nbCBiZSBsb2FkZWQgd2l0aAogICAgICoge0BsaW5rICNsb2FkRWxlbWVudH0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIHNlbGVjdEVs\nZW1lbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgZWFnZXJNb2RlLAogICAgICAgIEpvaW5zIGpvaW5zKTsKCiAgICAv\nKioKICAgICAqIExvYWQgYW4gZWxlbWVudCBvZiB0aGUgY29sbGVjdGlvbi4g\nVGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgbWlnaHQgYmUKICAgICAqIG51bGwg\naWYgdGhlIGxvYWQgaXMgZm9yIGEgcHJvamVjdGlvbiBvciBmb3IgcHJvY2Vz\nc2luZyBlYWdlciBwYXJhbGxlbAogICAgICogcmVzdWx0cy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGFic3RyYWN0IE9iamVjdCBsb2FkRWxlbWVudChPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9p\nbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbjsKCiAgICAv\nKioKICAgICAqIEpvaW4gdGhpcyB2YWx1ZSdzIHRhYmxlIHRvIHRoZSB0YWJs\nZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbWFwcGluZwogICAgICogZnJvbSB7\nQGxpbmsgI2dldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzfSAob3IgbnVs\nbCkuCiAgICAgKgogICAgICogQHNlZSBGaWVsZE1hcHBpbmcjam9pblJlbGF0\naW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBKb2lucyBqb2lu\nRWxlbWVudFJlbGF0aW9uKEpvaW5zIGpvaW5zLAogICAgICAgIENsYXNzTWFw\ncGluZyBlbGVtKTsKCiAgICAvKioKICAgICAqIEpvaW4gdG8gdGhlIG93bmlu\nZyBmaWVsZCB0YWJsZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbWFwcGluZyBm\ncm9tCiAgICAgKiB7QGxpbmsgI2dldEluZGVwZW5kZW50RWxlbWVudE1hcHBp\nbmdzfSAob3IgbnVsbCkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgZWxlbSk7\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBsYXJnZSByZXN1bHQgc2V0IHBy\nb3h5IGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3QgUHJveHkgbmV3TFJTUHJveHkoKTsKCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIGZpZWxkIHZhbHVlIHRvIGEgY29sbGVjdGlvbi4gSGFuZGxl\ncyBjb2xsZWN0aW9ucyBhbmQKICAgICAqIGFycmF5cyBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiB0b0NvbGxlY3Rpb24o\nT2JqZWN0IHZhbCkgewogICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5DT0xMRUNUSU9OKQogICAgICAgICAgICByZXR1cm4g\nKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICByZXR1cm4gSmF2YVR5cGVzLnRv\nTGlzdCh2YWwsIGZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlKCksIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBpdGVtIHRvIHRoZSBk\nYXRhIHN0cnVjdHVyZSByZXByZXNlbnRpbmcgYSBmaWVsZCB2YWx1ZS4KICAg\nICAqIEJ5IGRlZmF1bHQsIGFzc3VtZXMgdGhlIHN0cnVjdHVyZSBpcyBhIGNv\nbGxlY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZChKREJD\nU3RvcmUgc3RvcmUsIE9iamVjdCBjb2xsLCBPYmplY3Qgb2JqKSB7CiAgICAg\nICAgKChDb2xsZWN0aW9uKSBjb2xsKS5hZGQob2JqKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgdGhlIGZpcnN0IGluZGVwZW5kZW50IGVsZW1l\nbnQgbWFwcGluZywgb3IgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFz\nc01hcHBpbmcgZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5nKGJvb2xlYW4gdHJh\ndmVyc2UpIHsKICAgICAgICBDbGFzc01hcHBpbmdbXSBlbGVtcyA9IGdldElu\nZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRyYXZlcnNlKTsKICAgICAgICBy\nZXR1cm4gKGVsZW1zLmxlbmd0aCA9PSAwKSA/IG51bGwgOiBlbGVtc1swXTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IHN1cHBvcnRzU2VsZWN0KFNlbGVjdCBz\nZWwsIGludCB0eXBlLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIGlmIChmaWVsZC5pc0xSUygpKQogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICBpZiAodHlwZSA9PSBTZWxlY3QuRUFHRVJfUEFS\nQUxMRUwpCiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCgxLCBnZXRJbmRl\ncGVuZGVudEVsZW1lbnRNYXBwaW5ncyh0cnVlKS5sZW5ndGgpOwogICAgICAg\nIGlmICh0eXBlICE9IFNlbGVjdC5FQUdFUl9JTk5FUiAmJiB0eXBlICE9IFNl\nbGVjdC5FQUdFUl9PVVRFUikKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAg\nICAgaWYgKGdldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRydWUpLmxl\nbmd0aCA+IDEpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVy\nbiAodHlwZSA9PSBTZWxlY3QuRUFHRVJfSU5ORVIgfHwgc3RvcmUuZ2V0REJE\naWN0aW9uYXJ5KCkuCiAgICAgICAgICAgIGNhbk91dGVySm9pbihzZWwuZ2V0\nSm9pblN5bnRheCgpLCBnZXRKb2luRm9yZWlnbktleQogICAgICAgICAgICAg\nICAgKGdldERlZmF1bHRFbGVtZW50TWFwcGluZyhmYWxzZSkpKSkgPyAxIDog\nMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RFYWdlclBhcmFsbGVs\nKFNlbGVjdEV4ZWN1dG9yIHNlbCwKICAgICAgICBmaW5hbCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAg\nZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgZmluYWwgaW50\nIGVhZ2VyTW9kZSkgewogICAgICAgIGlmICghKHNlbCBpbnN0YW5jZW9mIFVu\naW9uKSkKICAgICAgICAgICAgc2VsZWN0RWFnZXIoKFNlbGVjdCkgc2VsLCBn\nZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1ZSksIHNtLAogICAgICAgICAg\nICAgICAgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIHRydWUsIGZhbHNlKTsK\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5n\nW10gZWxlbXMgPSBnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5ncyh0cnVl\nKTsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSAoVW5pb24pIHNlbDsKICAg\nICAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICBnZXRUeXBl\nTWFwcGluZygpKSAhPSBmZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAgICAg\nICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgICAgICB1bmlvbi5zZWxl\nY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAg\nICAgICAgICAgICAgICBzZWxlY3RFYWdlcihzZWwsIGVsZW1zW2lkeF0sIHNt\nLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwgCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdEVhZ2VySm9pbihTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIC8vIHdl\nIGxpbWl0IGZ1cnRoZXIgZWFnZXIgZmV0Y2hlcyB0byBqb2lucywgYmVjYXVz\nZSBhZnRlciB0aGlzIHBvaW50CiAgICAgICAgLy8gdGhlIHNlbGVjdCBoYXMg\nYmVlbiBtb2RpZmllZCBzdWNoIHRoYXQgcGFyYWxsZWwgY2xvbmVzIG1heSBw\ncm9kdWNlCiAgICAgICAgLy8gaW52YWxpZCBzcWwKICAgICAgICBib29sZWFu\nIG91dGVyID0gZmllbGQuZ2V0TnVsbFZhbHVlKCkgIT0gRmllbGRNYXBwaW5n\nLk5VTExfRVhDRVBUSU9OOwogICAgICAgIC8vIGZvcmNlIGlubmVyIGpvaW4g\nZm9yIGlubmVyIGpvaW4gZmV0Y2ggCiAgICAgICAgaWYgKGZldGNoLmhhc0Zl\ndGNoSW5uZXJKb2luKGZpZWxkLmdldEZ1bGxOYW1lKGZhbHNlKSkpCiAgICAg\nICAgICAgIG91dGVyID0gZmFsc2U7CiAgICAgICAgc2VsZWN0RWFnZXIoc2Vs\nLCBnZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1ZSksIHNtLCBzdG9yZSwg\nZmV0Y2gsIAogICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVB\nR0VSX0pPSU4sIGZhbHNlLAogICAgICAgICAgICBvdXRlcik7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNFYWdlclNlbGVjdFRvTWFueSgpIHsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVj\ndCBvdXIgZGF0YSBlYWdlcmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nc2VsZWN0RWFnZXIoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3Jl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGludCBl\nYWdlck1vZGUsIGJvb2xlYW4gc2VsZWN0T2lkLCBib29sZWFuIG91dGVyKSB7\nCiAgICAgICAgLy8gZm9yY2UgZGlzdGluY3QgaWYgdGhlcmUgd2FzIGEgdG8t\nbWFueSBqb2luIHRvIGF2b2lkIGR1cHMsIGJ1dAogICAgICAgIC8vIGlmIHRo\naXMgaXMgYSBwYXJhbGxlbCBzZWxlY3QgZG9uJ3QgbWFrZSBkaXN0aW5jdCBi\nYXNlZCBvbiB0aGUKICAgICAgICAvLyBlYWdlciBqb2lucyBhbG9uZSBpZiB0\naGUgb3JpZ2luYWwgd2Fzbid0IGRpc3RpbmN0CiAgICAgICAgaWYgKGVhZ2Vy\nTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVM\nKSB7CiAgICAgICAgICAgIGlmIChzZWwuaGFzSm9pbih0cnVlKSkKICAgICAg\nICAgICAgICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkpCiAgICAgICAgICAgICAgICBz\nZWwuc2V0RGlzdGluY3QoZmFsc2UpOyAvLyBzZXQgZXhwbGljaXRseSBzbyBy\nZW1lbWJlcmVkCiAgICAgICAgfQoKICAgICAgICAvLyBzZXQgYSB2YXJpYWJs\nZSBuYW1lIHRoYXQgZG9lcyBub3QgY29uZmxpY3Qgd2l0aCBhbnkgaW4gdGhl\nIHF1ZXJ5OwogICAgICAgIC8vIHVzaW5nIGEgdmFyaWFibGUgZ3VhcmFudGVl\ncyB0aGF0IHRoZSBzZWxlY3RlZCBkYXRhIHdpbGwgdXNlIGRpZmZlcmVudAog\nICAgICAgIC8vIGFsaWFzZXMgYW5kIGpvaW5zIHRoYW4gYW55IGV4aXN0aW5n\nIFdIRVJFIGNvbmRpdGlvbnMgb24gdGhpcyBmaWVsZAogICAgICAgIC8vIHRo\nYXQgbWlnaHQgb3RoZXJ3aXNlIGxpbWl0IHRoZSBlbGVtZW50cyBvZiB0aGUg\nZmllbGQgdGhhdCBtYXRjaAogICAgICAgIGlmIChzZWxlY3RPaWQpCiAgICAg\nICAgICAgIHNlbC5vcmRlckJ5UHJpbWFyeUtleShmaWVsZC5nZXREZWZpbmlu\nZ01hcHBpbmcoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgSm9pbnMgam9pbnMg\nPSBzZWwubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgIGpv\naW5zID0gam9pbihqb2lucywgZWxlbSk7CgogICAgICAgIC8vIG9yZGVyLCBy\nZWYgY29scwogICAgICAgIGlmIChmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9\nIG51bGwgfHwgZmllbGQuZ2V0T3JkZXJzKCkubGVuZ3RoID4gMAogICAgICAg\nICAgICB8fCAhc2VsZWN0T2lkKSB7CiAgICAgICAgICAgIGlmIChvdXRlcikK\nICAgICAgICAgICAgICAgIGpvaW5zID0gc2VsLm91dGVyKGpvaW5zKTsKICAg\nICAgICAgICAgaWYgKCFzZWxlY3RPaWQpIHsKICAgICAgICAgICAgICAgIENv\nbHVtbltdIHJlZnMgPSBnZXRKb2luRm9yZWlnbktleShlbGVtKS5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgICAgICAgICBpZiAocmVxdWlyZXNPcmRlckJ5KCkp\nIHsKICAgICAgICAgICAgICAgICAgICBzZWwub3JkZXJCeShyZWZzLCB0cnVl\nLCBqb2lucywgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIHNlbC5zZWxlY3QocmVmcywgam9pbnMpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpZWxk\nLm9yZGVyTG9jYWwoc2VsLCBlbGVtLCBqb2lucyk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBzZWxlY3QgZGF0YQogICAgICAgIGpvaW5zID0gam9pbkVsZW1l\nbnRSZWxhdGlvbihqb2lucywgZWxlbSk7CiAgICAgICAgaWYgKG91dGVyKQog\nICAgICAgICAgICBqb2lucyA9IHNlbC5vdXRlcihqb2lucyk7CiAgICAgICAg\nZmllbGQub3JkZXJSZWxhdGlvbihzZWwsIGVsZW0sIGpvaW5zKTsKICAgICAg\nICBzZWxlY3RFbGVtZW50KHNlbCwgZWxlbSwgc3RvcmUsIGZldGNoLCBlYWdl\nck1vZGUsIGpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRF\nYWdlclBhcmFsbGVsKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBPYmplY3QgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIHByb2Nlc3MgYmF0Y2hlZCByZXN1bHRzIGlmIHdlIGhhdmVu\nJ3QgYWxyZWFkeQogICAgICAgIE1hcCByZWxzOwogICAgICAgIGlmIChyZXMg\naW5zdGFuY2VvZiBSZXN1bHQpCiAgICAgICAgICAgIHJlbHMgPSBwcm9jZXNz\nRWFnZXJQYXJhbGxlbFJlc3VsdChzbSwgc3RvcmUsIGZldGNoLCAoUmVzdWx0\nKSByZXMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVscyA9IChNYXAp\nIHJlczsKCiAgICAgICAgLy8gbG9vayB1cCB0aGUgY29sbGVjdGlvbiBmb3Ig\ndGhpcyBvaWQsIGFuZCBzdG9yZSBpbiBpbnN0YW5jZQogICAgICAgIE9iamVj\ndCBjb2xsID0gcmVscy5yZW1vdmUoc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAg\nICAgaWYgKGZpZWxkLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkFSUkFZ\nKQogICAgICAgICAgICBzbS5zdG9yZU9iamVjdChmaWVsZC5nZXRJbmRleCgp\nLCBKYXZhVHlwZXMudG9BcnJheQogICAgICAgICAgICAgICAgKChDb2xsZWN0\naW9uKSBjb2xsLCBmaWVsZC5nZXRFbGVtZW50KCkuZ2V0VHlwZSgpKSk7CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChjb2xsID09IG51bGwpCiAg\nICAgICAgICAgICAgICBjb2xsID0gc20ubmV3UHJveHkoZmllbGQuZ2V0SW5k\nZXgoKSk7CiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldElu\nZGV4KCksIGNvbGwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVsczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3MgdGhlIGdpdmVuIGJhdGNo\nZWQgcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIE1hcCBwcm9jZXNzRWFn\nZXJQYXJhbGxlbFJlc3VsdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAg\nICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgUmVzdWx0IHJlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAvLyBkbyBzYW1lIGpvaW5zIGFzIGZvciBsb2FkCiAgICAg\nICAgLy8jIyMgY2hlYXQ6IHdlIGtub3cgdHlwaWNhbCByZXN1bHQgam9pbnMg\nb25seSBjYXJlIGFib3V0IHRoZSByZWxhdGlvbgogICAgICAgIC8vIyMjIHBh\ndGg7IHRodXMgd2UgY2FuIGlnbm9yZSBkaWZmZXJlbnQgbWFwcGluZ3MKICAg\nICAgICBDbGFzc01hcHBpbmcgZWxlbSA9IGdldERlZmF1bHRFbGVtZW50TWFw\ncGluZyh0cnVlKTsKICAgICAgICBKb2lucyBkYXRhSm9pbnMgPSByZXMubmV3\nSm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgIGRhdGFKb2lucyA9\nIGpvaW4oZGF0YUpvaW5zLCBlbGVtKTsKICAgICAgICBkYXRhSm9pbnMgPSBq\nb2luRWxlbWVudFJlbGF0aW9uKGRhdGFKb2lucywgZWxlbSk7CiAgICAgICAg\nSm9pbnMgb3JkZXJKb2lucyA9IG51bGw7CiAgICAgICAgaWYgKGZpZWxkLmdl\ndE9yZGVyQ29sdW1uKCkgIT0gbnVsbCkgewogICAgICAgICAgICBvcmRlckpv\naW5zID0gcmVzLm5ld0pvaW5zKCkuc2V0VmFyaWFibGUoIioiKTsKICAgICAg\nICAgICAgb3JkZXJKb2lucyA9IGpvaW4ob3JkZXJKb2lucywgZWxlbSk7CiAg\nICAgICAgfQoKICAgICAgICBNYXAgcmVscyA9IG5ldyBIYXNoTWFwKCk7CiAg\nICAgICAgQ2xhc3NNYXBwaW5nIG93bmVyTWFwcGluZyA9IGZpZWxkLmdldERl\nZmluaW5nTWFwcGluZygpOwogICAgICAgIE9iamVjdCBuZXh0T2lkLCBvaWQg\nPSBudWxsOwogICAgICAgIE9iamVjdCBjb2xsID0gbnVsbDsKICAgICAgICBp\nbnQgc2VxID0gMDsKICAgICAgICB3aGlsZSAocmVzLm5leHQoKSkgewogICAg\nICAgICAgICAvLyBleHRyYWN0IHRoZSBvd25lciBpZCB2YWx1ZQogICAgICAg\nICAgICBuZXh0T2lkID0gZ2V0TmV4dE9iamVjdElkKG93bmVyTWFwcGluZywg\nc3RvcmUsIHJlcywgb2lkKTsKICAgICAgICAgICAgaWYgKG5leHRPaWQgIT0g\nb2lkKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgb2xkIGNvbGwgd2Fz\nIGFuIG9yZGVyZWQgdHJhY2tpbmcgcHJveHksIHNldAogICAgICAgICAgICAg\nICAgLy8gaXRzIHNlcSB2YWx1ZSB0byB0aGUgbGFzdCBvcmRlciB2YWwgd2Ug\ncmVhZAogICAgICAgICAgICAgICAgaWYgKHNlcSAhPSAwICYmIGNvbGwgaW5z\ndGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgICAgICAgICAoKFByb3h5KSBj\nb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCkuc2V0TmV4dFNlcXVlbmNlKHNlcSk7\nCgogICAgICAgICAgICAgICAgLy8gc3RhcnQgYSBuZXcgY29sbGVjdGlvbgog\nICAgICAgICAgICAgICAgb2lkID0gbmV4dE9pZDsKICAgICAgICAgICAgICAg\nIHNlcSA9IDA7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAgICAgICAgICAgICAgICAgICAg\nY29sbCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICBjb2xsID0gc20ubmV3UHJveHkoZmllbGQu\nZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICByZWxzLnB1dChvaWQsIGNv\nbGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGQuZ2V0\nT3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgc2VxID0g\ncmVzLmdldEludChmaWVsZC5nZXRPcmRlckNvbHVtbigpLCBvcmRlckpvaW5z\nKSArIDE7CgogICAgICAgICAgICAvLyBmb3IgaW52ZXJzZSByZWxhdGlvbiBm\naWVsZAogICAgICAgICAgICBzZXRNYXBwZWRCeShvaWQuZXF1YWxzKHNtLmdl\ndE9iamVjdElkKCkpID8gCiAgICAgICAgICAgICAgICBzbS5nZXRQZXJzaXN0\nZW5jZUNhcGFibGUoKSA6IG9pZCwgcmVzKTsKICAgICAgICAgICAgT2JqZWN0\nIHZhbCA9IGxvYWRFbGVtZW50KG51bGwsIHN0b3JlLCBmZXRjaCwgcmVzLCBk\nYXRhSm9pbnMpOwogICAgICAgICAgICBhZGQoc3RvcmUsIGNvbGwsIHZhbCk7\nCiAgICAgICAgfQogICAgICAgIHJlcy5jbG9zZSgpOwoKICAgICAgICByZXR1\ncm4gcmVsczsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc2V0TWFwcGVkQnko\nT2JqZWN0IG9pZCwgUmVzdWx0IHJlcykgewogICAgICAgIC8vICBmb3IgaW52\nZXJzZSB0b09uZSByZWxhdGlvbiBmaWVsZAogICAgICAgIEZpZWxkTWFwcGlu\nZyBtYXBwZWRCeUZpZWxkTWFwcGluZyA9IGZpZWxkLmdldE1hcHBlZEJ5TWFw\ncGluZygpOwogICAgICAgIAogICAgICAgIGlmIChtYXBwZWRCeUZpZWxkTWFw\ncGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIFZhbHVlTWFwcGluZyB2YWwg\nPSBtYXBwZWRCeUZpZWxkTWFwcGluZy5nZXRWYWx1ZU1hcHBpbmcoKTsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBkZWNNZXRhID0gdmFsLmdldFR5cGVN\nZXRhRGF0YSgpOwogICAgICAgICAgICAvLyB0aGlzIGludmVyc2UgZmllbGQg\nZG9lcyBub3QgaGF2ZSBjb3JyZXNwb25kaW5nIGNsYXNzTWFwcGluZwogICAg\nICAgICAgICAvLyBpdHMgdmFsdWUgbWF5IGJlIGEgY29sbGVjdGlvbi9tYXAg\nZXRjLgogICAgICAgICAgICBpZiAoZGVjTWV0YSA9PSBudWxsKSAKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJl\ncy5zZXRNYXBwZWRCeUZpZWxkTWFwcGluZyhtYXBwZWRCeUZpZWxkTWFwcGlu\nZyk7CiAgICAgICAgICAgIHJlcy5zZXRNYXBwZWRCeVZhbHVlKG9pZCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzZXRNYXBwZWRCeShP\nYmplY3Qgb2lkLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29s\nbCwKICAgICAgICBSZXN1bHQgcmVzKSB7CiAgICAgICAgLy8gZm9yIGludmVy\nc2VFYWdlciBmaWVsZAogICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWRCeUZp\nZWxkTWFwcGluZyA9IGZpZWxkLmdldE1hcHBlZEJ5TWFwcGluZygpOwogICAg\nICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBtYXBwZWRCeVZhbHVlID0gbnVsbDsK\nICAgICAgICAKICAgICAgICBpZiAobWFwcGVkQnlGaWVsZE1hcHBpbmcgIT0g\nbnVsbCkgewogICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gbWFwcGVk\nQnlGaWVsZE1hcHBpbmcuZ2V0VmFsdWVNYXBwaW5nKCk7CiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgZGVjTWV0YSA9IHZhbC5nZXRUeXBlTWV0YURhdGEo\nKTsKICAgICAgICAgICAgLy8gdGhpcyBpbnZlcnNlIGZpZWxkIGRvZXMgbm90\nIGhhdmUgY29ycmVzcG9uZGluZyBjbGFzc01hcHBpbmcKICAgICAgICAgICAg\nLy8gaXRzIHZhbHVlIG1heSBiZSBhIGNvbGxlY3Rpb24vbWFwIGV0Yy4KICAg\nICAgICAgICAgaWYgKGRlY01ldGEgPT0gbnVsbCkgCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgCQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIG93bmVyID0gKChTdGF0ZU1hbmFnZXJJbXBsKXNtKS5nZXRPYmplY3RJ\nZE93bmVyKCk7CiAgICAgICAgICAgIGlmIChvaWQuZXF1YWxzKG93bmVyLmdl\ndE9iamVjdElkKCkpKSB7CiAgICAgICAgICAgICAgICBtYXBwZWRCeVZhbHVl\nID0gb3duZXIuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAg\nICAgICByZXMuc2V0TWFwcGVkQnlGaWVsZE1hcHBpbmcobWFwcGVkQnlGaWVs\nZE1hcHBpbmcpOwogICAgICAgICAgICAgICAgcmVzLnNldE1hcHBlZEJ5VmFs\ndWUobWFwcGVkQnlWYWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29s\nbCBpbnN0YW5jZW9mIENvbGxlY3Rpb24gJiYgCiAgICAgICAgICAgICAgICAo\nKENvbGxlY3Rpb24pIGNvbGwpLnNpemUoKSA+IDApIHsKICAgICAgICAgICAg\nICAgIC8vIEN1c3RvbWVyICgxKSA8LS0+IE9yZGVycyhuKQogICAgICAgICAg\nICAgICAgLy8gY29sbCBjb250YWlucyB0aGUgdmFsdWVzIG9mIHRoZSB0b01h\nbnkgZmllbGQgKE9yZGVycykKICAgICAgICAgICAgICAgIC8vIGdldCB0aGUg\nU3RhdGVNYW5hZ2VyIG9mIHRoaXMgdG9NYW55IHZhbHVlCiAgICAgICAgICAg\nICAgICAvLyBhbmQgZmluZCB0aGUgdmFsdWUgb2YgdGhlIGludmVyc2UgbWFw\ncGVkQnkgZmllbGQgKEN1c3RvbWVyKQogICAgICAgICAgICAgICAgLy8gZm9y\nIHRoaXMgdG9NYWNkbnkgZmllbGQKICAgICAgICAgICAgICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpCiAgICAgICAg\nICAgICAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsKS5pdGVyYXRvcigpLm5l\neHQoKTsKICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20x\nID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIHBjLgogICAgICAgICAgICAgICAg\nICAgIHBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICAKICAg\nICAgICAgICAgICAgIENsYXNzTWFwcGluZyBjbG0gPSAoKENsYXNzTWFwcGlu\nZykgc20xLmdldE1ldGFEYXRhKCkpOwogICAgICAgICAgICAgICAgRmllbGRN\nYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykgY2xtLmdldEZpZWxkKAogICAg\nICAgICAgICAgICAgICAgIG1hcHBlZEJ5RmllbGRNYXBwaW5nLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgICAgICBpZiAoZm0gPT0gbWFwcGVkQnlGaWVsZE1h\ncHBpbmcpCiAgICAgICAgICAgICAgICAgICAgcmVzLnNldE1hcHBlZEJ5VmFs\ndWUoc20xLmZldGNoT2JqZWN0KGZtLmdldEluZGV4KCkpKTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlcy5zZXRNYXBwZWRCeVZh\nbHVlKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfSAgICAgICAgCiAg\nICB9CgogICAgLyoqCiAgICAgKiBFeHRyYWN0IHRoZSBvaWQgdmFsdWUgZnJv\nbSB0aGUgZ2l2ZW4gcmVzdWx0LiBJZiB0aGUgbmV4dCBvaWQgaXMgdGhlCiAg\nICAgKiBzYW1lIGFzIHRoZSBnaXZlbiBvbmUsIHJldHVybnMgdGhlIGdpdmVu\nIEpWTSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZ2V0\nTmV4dE9iamVjdElkKENsYXNzTWFwcGluZyBvd25lciwgSkRCQ1N0b3JlIHN0\nb3JlLAogICAgICAgIFJlc3VsdCByZXMsIE9iamVjdCBvaWQpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgdGhpcyBpcyBh\nIGRhdGFzdG9yZSBpZCBjbGFzcyB3ZSBjYW4gYXZvaWQgY3JlYXRpbmcgYSBu\nZXcgb2lkCiAgICAgICAgLy8gb2JqZWN0IGZvciB0aGUgY29tbW9uIGNhc2UK\nICAgICAgICBpZiAob2lkICE9IG51bGwgJiYgb3duZXIuZ2V0SWRlbnRpdHlU\neXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0RBVEFTVE9SRQogICAgICAgICAg\nICAmJiBvd25lci5pc1ByaW1hcnlLZXlPYmplY3RJZCh0cnVlKSkgewogICAg\nICAgICAgICBsb25nIG5pZCA9IHJlcy5nZXRMb25nKG93bmVyLmdldFByaW1h\ncnlLZXlDb2x1bW5zKClbMF0pOwogICAgICAgICAgICBsb25nIGlkID0gKChJ\nZCkgb2lkKS5nZXRJZCgpOwogICAgICAgICAgICByZXR1cm4gKG5pZCA9PSBp\nZCkgPyBvaWQgOiBzdG9yZS5uZXdEYXRhU3RvcmVJZChuaWQsIG93bmVyLCB0\ncnVlKTsKICAgICAgICB9CgogICAgICAgIE9iamVjdCBub2lkID0gb3duZXIu\nZ2V0T2JqZWN0SWQoc3RvcmUsIHJlcywgbnVsbCwgdHJ1ZSwgbnVsbCk7CiAg\nICAgICAgaWYgKG5vaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIChub2lkLmVxdWFscyhvaWQpKSA/IG9pZCA6\nIG5vaWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZEVhZ2VySm9pbihP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBpbml0\naWFsaXplIGZpZWxkIHZhbHVlCiAgICAgICAgT2JqZWN0IGNvbGw7CiAgICAg\nICAgaWYgKGZpZWxkLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkFSUkFZ\nKQogICAgICAgICAgICBjb2xsID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgY29sbCA9IHNtLm5ld1Byb3h5KGZpZWxkLmdl\ndEluZGV4KCkpOwoKICAgICAgICBKb2lucyBkYXRhSm9pbnMgPSBudWxsOwog\nICAgICAgIEpvaW5zIHJlZkpvaW5zID0gcmVzLm5ld0pvaW5zKCkuc2V0VmFy\naWFibGUoIioiKTsKICAgICAgICBqb2luKHJlZkpvaW5zLCBmYWxzZSk7Cgog\nICAgICAgIENsYXNzTWFwcGluZyBvd25lck1hcHBpbmcgPSBmaWVsZC5nZXRE\nZWZpbmluZ01hcHBpbmcoKTsKICAgICAgICBPYmplY3QgcmVmID0gbnVsbDsK\nICAgICAgICBpbnQgc2VxID0gMDsKICAgICAgICBpbnQgdHlwZUlkeCA9IHJl\ncy5pbmRleE9mKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IHRydWU7IGkr\nKykgewogICAgICAgICAgICAvLyBleHRyYWN0IHRoZSBvd25lciBpZCB2YWx1\nZQogICAgICAgICAgICByZWYgPSBnZXROZXh0UmVmKG93bmVyTWFwcGluZywg\nc3RvcmUsIHJlcywgcmVmLCByZWZKb2lucyk7CiAgICAgICAgICAgIGlmIChy\nZWYgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlIG9sZCBj\nb2xsIHdhcyBhbiBvcmRlcmVkIHRyYWNraW5nIHByb3h5LCBzZXQKICAgICAg\nICAgICAgICAgIC8vIGl0cyBzZXEgdmFsdWUgdG8gdGhlIGxhc3Qgb3JkZXIg\ndmFsIHdlIHJlYWQKICAgICAgICAgICAgICAgIGlmIChzZXEgIT0gMCAmJiBj\nb2xsIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAgICAgICAgICAgKChQ\ncm94eSkgY29sbCkuZ2V0Q2hhbmdlVHJhY2tlcigpLnNldE5leHRTZXF1ZW5j\nZShzZXEpOwogICAgICAgICAgICAgICAgaWYgKGkgIT0gMCkKICAgICAgICAg\nICAgICAgICAgICByZXMucHVzaEJhY2soKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkbyBzYW1lIGpv\naW5zIGFzIGZvciBsb2FkCiAgICAgICAgICAgIGlmIChkYXRhSm9pbnMgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgZGF0YUpvaW5zID0gcmVzLm5ld0pv\naW5zKCkuc2V0VmFyaWFibGUoIioiKTsKICAgICAgICAgICAgICAgIGRhdGFK\nb2lucyA9IGpvaW4oZGF0YUpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICBkYXRhSm9pbnMgPSBqb2luUmVsYXRpb24oZGF0YUpvaW5zLCBmYWxzZSwg\nZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGQu\nZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgc2Vx\nID0gcmVzLmdldEludChmaWVsZC5nZXRPcmRlckNvbHVtbigpLCByZWZKb2lu\ncykgKyAxOwogICAgICAgICAgICByZXMuc2V0QmFzZU1hcHBpbmcobnVsbCk7\nCiAgICAgICAgICAgIE9iamVjdCBvYmogPSBsb2FkRWxlbWVudChzbSwgc3Rv\ncmUsIGZldGNoLCByZXMsIGRhdGFKb2lucyk7CiAgICAgICAgICAgIGlmIChv\nYmogIT0gbnVsbCkKICAgICAgICAgICAgICAgIGFkZChzdG9yZSwgY29sbCwg\nb2JqKTsKICAgICAgICAgICAgaWYgKCFyZXMubmV4dCgpIHx8IHJlcy5pbmRl\neE9mKCkgIT0gdHlwZUlkeCkgewogICAgICAgICAgICAgICAgcmVzLnB1c2hC\nYWNrKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gbG9hZCB0aGUgY29sbGVjdGlvbiBpbnRv\nIHRoZSBvYmplY3QKICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9\nPSBKYXZhVHlwZXMuQVJSQVkpCiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0\nKGZpZWxkLmdldEluZGV4KCksIEphdmFUeXBlcy50b0FycmF5CiAgICAgICAg\nICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwsIGZpZWxkLmdldEVsZW1lbnQo\nKS5nZXRUeXBlKCkpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNtLnN0\nb3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIGNvbGwpOwogICAgfQoKICAg\nIC8qKgogICAgICogRXh0cmFjdCB0aGUgcmVmZXJlbmNlIGNvbHVtbiB2YWx1\nZShzKSBmcm9tIHRoZSBnaXZlbiByZXN1bHQuIElmIHRoZQogICAgICogZXh0\ncmFjdGVkIHJlc3VsdCBpcyB0aGUgc2FtZSBhcyB0aGUgY3VycmVudCBvbmUg\nb3IgdGhlIGN1cnJlbnQKICAgICAqIG9uZSBpcyBudWxsLCByZXR1cm5zIHRo\nZSBleHRyYWN0ZWQgcmVzdWx0LiBFbHNlIHJldHVybnMgbnVsbC4KICAgICAq\nLwogICAgcHJpdmF0ZSBPYmplY3QgZ2V0TmV4dFJlZihDbGFzc01hcHBpbmcg\nbWFwcGluZywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIFJlc3VsdCByZXMs\nIE9iamVjdCByZWYsIEpvaW5zIHJlZkpvaW5zKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIENvbHVtbltdIGNvbHMgPSBnZXRKb2lu\nRm9yZWlnbktleShnZXREZWZhdWx0RWxlbWVudE1hcHBpbmcoZmFsc2UpKS4K\nICAgICAgICAgICAgZ2V0Q29sdW1ucygpOwogICAgICAgIE9iamVjdCB2YWw7\nCiAgICAgICAgaWYgKGNvbHMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAg\ndmFsID0gcmVzLmdldE9iamVjdChjb2xzWzBdLCBudWxsLCByZWZKb2lucyk7\nCiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCB8fCAocmVmICE9IG51bGwg\nJiYgIXZhbC5lcXVhbHMocmVmKSkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CgogICAg\nICAgIE9iamVjdFtdIHJlZnMgPSAoT2JqZWN0W10pIHJlZjsKICAgICAgICBp\nZiAocmVmcyA9PSBudWxsKQogICAgICAgICAgICByZWZzID0gbmV3IE9iamVj\ndFtjb2xzLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhbCA9IHJlcy5nZXRP\nYmplY3QoY29sc1tpXSwgbnVsbCwgcmVmSm9pbnMpOwogICAgICAgICAgICBp\nZiAodmFsID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgaWYgKHJlZnNbaV0gIT0gbnVsbCAmJiAhdmFsLmVxdWFs\ncyhyZWZzW2ldKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgICAgICByZWZzW2ldID0gdmFsOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcmVmczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkKGZpbmFsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSwK\nICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVs\nZC5pc0xSUygpKSB7CiAgICAgICAgICAgIFByb3h5IGNvbGwgPSBuZXdMUlNQ\ncm94eSgpOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBvcmRlcmVkIHdl\nIG5lZWQgdG8ga25vdyB0aGUgbmV4dCBzZXEgdG8gdXNlIGluIGNhc2UKICAg\nICAgICAgICAgLy8gb2JqZWN0cyBhcmUgYWRkZWQgdG8gdGhlIGNvbGxlY3Rp\nb24KICAgICAgICAgICAgaWYgKGZpZWxkLmdldE9yZGVyQ29sdW1uKCkgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgLy8gd2UgZG9uJ3QgYWxsb3cgb3Jk\nZXJpbmcgdGFibGUgcGVyIGNsYXNzIG9uZS1tYW55J3MsIHNvCiAgICAgICAg\nICAgICAgICAvLyB3ZSBrbm93IHdlIGRvbid0IG5lZWQgYSB1bmlvbgogICAg\nICAgICAgICAgICAgU2VsZWN0IHNlbCA9IHN0b3JlLmdldFNRTEZhY3Rvcnko\nKS5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgICAgIHNlbC5zZXRBZ2dyZWdh\ndGUodHJ1ZSk7CiAgICAgICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNxbCA9\nIG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICBzcWwuYXBw\nZW5kKCJNQVgoIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKHNlbC5n\nZXRDb2x1bW5BbGlhcyhmaWVsZC5nZXRPcmRlckNvbHVtbigpKSkuCiAgICAg\nICAgICAgICAgICAgICAgYXBwZW5kKCIpIik7CiAgICAgICAgICAgICAgICBz\nZWwuc2VsZWN0KHNxbC50b1N0cmluZygpLCBmaWVsZCk7CiAgICAgICAgICAg\nICAgICBDbGFzc01hcHBpbmcgcmVsID0gZ2V0RGVmYXVsdEVsZW1lbnRNYXBw\naW5nKGZhbHNlKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZUZvcmVpZ25L\nZXkoZ2V0Sm9pbkZvcmVpZ25LZXkocmVsKSwKICAgICAgICAgICAgICAgICAg\nICBzbS5nZXRPYmplY3RJZCgpLCBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmco\nKSwgc3RvcmUpOwoKICAgICAgICAgICAgICAgIFJlc3VsdCByZXMgPSBzZWwu\nZXhlY3V0ZShzdG9yZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICByZXMubmV4dCgpOwogICAgICAgICAgICAg\nICAgICAgIGNvbGwuZ2V0Q2hhbmdlVHJhY2tlcigpLnNldE5leHRTZXF1ZW5j\nZQogICAgICAgICAgICAgICAgICAgICAgICAocmVzLmdldEludChmaWVsZCkg\nKyAxKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc20uc3RvcmVPYmplY3RGaWVsZChmaWVs\nZC5nZXRJbmRleCgpLCBjb2xsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgLy8gc2VsZWN0IGRhdGEgZm9yIHRoaXMgc20KICAg\nICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSBlbGVtcyA9IGdldEluZGVwZW5k\nZW50RWxlbWVudE1hcHBpbmdzKHRydWUpOwogICAgICAgIGZpbmFsIEpvaW5z\nW10gcmVzSm9pbnMgPSBuZXcgSm9pbnNbTWF0aC5tYXgoMSwgZWxlbXMubGVu\nZ3RoKV07CiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0\nb3J5KCkubmV3VW5pb24KICAgICAgICAgICAgKE1hdGgubWF4KDEsIGVsZW1z\nLmxlbmd0aCkpOwogICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2Vs\nZWN0b3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxl\nY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBp\nbmcgZWxlbSA9IChlbGVtcy5sZW5ndGggPT0gMCkgPyBudWxsIDogZWxlbXNb\naWR4XTsKICAgICAgICAgICAgICAgIHJlc0pvaW5zW2lkeF0gPSBzZWxlY3RB\nbGwoc2VsLCBlbGVtLCBzbSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAg\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFSQUxMRUwp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIGNyZWF0\nZSBwcm94eQogICAgICAgIE9iamVjdCBjb2xsOwogICAgICAgIENoYW5nZVRy\nYWNrZXIgY3QgPSBudWxsOwogICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29k\nZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAgICAgICAgICAgY29sbCA9IG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29s\nbCA9IHNtLm5ld1Byb3h5KGZpZWxkLmdldEluZGV4KCkpOwogICAgICAgICAg\nICBpZiAoY29sbCBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAg\nY3QgPSAoKFByb3h5KSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBsb2FkIHZhbHVlcwogICAgICAgIFJlc3VsdCBy\nZXMgPSB1bmlvbi5leGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaW50IHNlcSA9IC0xOwogICAgICAgICAgICB3aGls\nZSAocmVzLm5leHQoKSkgewogICAgICAgICAgICAgICAgaWYgKGN0ICE9IG51\nbGwgJiYgZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIHNlcSA9IHJlcy5nZXRJbnQoZmllbGQuZ2V0T3JkZXJD\nb2x1bW4oKSk7CiAgICAgICAgICAgICAgICBzZXRNYXBwZWRCeShzbS5nZXRP\nYmplY3RJZCgpLCBzbSwgY29sbCwgcmVzKTsKICAgICAgICAgICAgICAgCWFk\nZChzdG9yZSwgY29sbCwgbG9hZEVsZW1lbnQoc20sIHN0b3JlLCBmZXRjaCwg\ncmVzLAogICAgICAgICAgIAkgICAgICAgIHJlc0pvaW5zW3Jlcy5pbmRleE9m\nKCldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN0ICE9IG51\nbGwgJiYgZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgY3Quc2V0TmV4dFNlcXVlbmNlKHNlcSArIDEpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gc2V0IGludG8gc20KICAgICAgICBpZiAoZmllbGQu\nZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAgICAgICAgICAg\nIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIEphdmFUeXBlcy50\nb0FycmF5CiAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwsIGZp\nZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlKCkpKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIGNv\nbGwpOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGRhdGEgZm9yIGxv\nYWRpbmcsIHN0YXJ0aW5nIGluIGZpZWxkIHRhYmxlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgSm9pbnMgc2VsZWN0QWxsKFNlbGVjdCBzZWwsIENsYXNzTWFw\ncGluZyBlbGVtLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwK\nICAgICAgICBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgc2VsLndoZXJlRm9y\nZWlnbktleShnZXRKb2luRm9yZWlnbktleShlbGVtKSwgc20uZ2V0T2JqZWN0\nSWQoKSwKICAgICAgICAgICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCks\nIHN0b3JlKTsKCiAgICAgICAgLy8gb3JkZXIgZmlyc3QsIHRoZW4gc2VsZWN0\nIHNvIHRoYXQgaWYgdGhlIHByb2plY3Rpb24gaW50cm9kdWNlcwogICAgICAg\nIC8vIGFkZGl0aW9uYWwgb3JkZXJpbmcsIGl0IHdpbGwgYmUgYWZ0ZXIgb3Vy\nIHJlcXVpcmVkIG9yZGVyaW5nCiAgICAgICAgZmllbGQub3JkZXJMb2NhbChz\nZWwsIGVsZW0sIG51bGwpOwogICAgICAgIEpvaW5zIGpvaW5zID0gam9pbkVs\nZW1lbnRSZWxhdGlvbihzZWwubmV3Sm9pbnMoKSwgZWxlbSk7CiAgICAgICAg\nZmllbGQub3JkZXJSZWxhdGlvbihzZWwsIGVsZW0sIGpvaW5zKTsKICAgICAg\nICBzZWxlY3RFbGVtZW50KHNlbCwgZWxlbSwgc3RvcmUsIGZldGNoLCBlYWdl\nck1vZGUsIGpvaW5zKTsKICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBsb2FkUHJvamVjdGlvbihKREJDU3RvcmUgc3Rv\ncmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgUmVz\ndWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIGxvYWRFbGVtZW50KG51bGwsIHN0b3Jl\nLCBmZXRjaCwgcmVzLCBqb2lucyk7CiAgICB9CgogICAgcHJvdGVjdGVkIEZv\ncmVpZ25LZXkgZ2V0Sm9pbkZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJu\nIGdldEpvaW5Gb3JlaWduS2V5KGdldERlZmF1bHRFbGVtZW50TWFwcGluZyhm\nYWxzZSkpOwogICAgfQogICAgCiAgICBib29sZWFuIHJlcXVpcmVzT3JkZXJC\neSgpIHsKICAgIAlyZXR1cm4gTGlzdC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9t\nKGZpZWxkLmdldFByb3h5VHlwZSgpKTsKICAgIH0KfQo=\n","encoding":"base64"}

