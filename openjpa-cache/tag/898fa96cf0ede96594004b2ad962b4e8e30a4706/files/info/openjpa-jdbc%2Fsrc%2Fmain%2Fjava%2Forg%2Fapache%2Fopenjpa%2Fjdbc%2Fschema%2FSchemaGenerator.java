{"sha":"723f490754369a465c1a1bfcd5557293896b04ed","node_id":"MDQ6QmxvYjIwNjM2NDo3MjNmNDkwNzU0MzY5YTQ2NWMxYTFiZmNkNTU1NzI5Mzg5NmIwNGVk","size":40056,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/723f490754369a465c1a1bfcd5557293896b04ed","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFi\nYXNlTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRXZlbnRPYmplY3Q7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YXguc3FsLkRhdGFTb3VyY2U7\nCgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlk\nZW50aWZpZXIuTm9ybWFsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5RdWFsaWZpZWREQklkZW50\naWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlm\naWVyLkRCSWRlbnRpZmllci5EQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CgovKioKICogVGhl\nIFNjaGVtYUdlbmVyYXRvciBjcmVhdGVzIHtAbGluayBTY2hlbWF9cyBtYXRj\naGluZyB0aGUgY3VycmVudAogKiBkYXRhYmFzZS4gQWxsIHNjaGVtYXMgYXJl\nIGFkZGVkIHRvIHRoZSBjdXJyZW50IHtAbGluayBTY2hlbWFHcm91cH0uCiAq\nICBOb3RlIHRoYXQgdGFibGVzIHdob3NlIG5hbWUgc3RhcnRzIHdpdGggIk9Q\nRU5KUEFfIiB3aWxsIGJlIG5vdCBiZSBhZGRlZAogKiB0byB0aGUgZGF0YWJh\nc2Ugc2NoZW1hLiBUaGlzIGVuYWJsZXMgdGhlIGNyZWF0aW9uIG9mIHNwZWNp\nYWwgdGFibGVzCiAqIHRoYXQgd2lsbCBuZXZlciBiZSBkcm9wcGVkIGJ5IHRo\nZSB7QGxpbmsgU2NoZW1hVG9vbH0uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hR2VuZXJhdG9yIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYUdlbmVyYXRvci5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBmaW5hbCBEYXRhU291cmNlIF9kczsKICAgIHByaXZhdGUg\nZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwogICAgcHJpdmF0ZSBmaW5hbCBM\nb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgT2JqZWN0W11bXSBfYWxsb3dl\nZDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaW5kZXhlcyA9IHRydWU7CiAgICBw\ncml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX3BrcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3NlcXMgPSB0\ncnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcGVuanBhVGFibGVzID0gdHJ1\nZTsKICAgIHByaXZhdGUgU2NoZW1hR3JvdXAgX2dyb3VwID0gbnVsbDsKCiAg\nICBwcml2YXRlIExpc3Q8TGlzdGVuZXI+IF9saXN0ZW5lcnMgPSBudWxsOwog\nICAgcHJpdmF0ZSBpbnQgX3NjaGVtYU9iamVjdHMgPSAwOwoKICAgIC8qKgog\nICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGNvbmYg\nY29uZmlndXJhdGlvbiBmb3IgY29ubmVjdGluZyB0byB0aGUgZGF0YSBzdG9y\nZQogICAgICovCiAgICBwdWJsaWMgU2NoZW1hR2VuZXJhdG9yKEpEQkNDb25m\naWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICAvLyBub3RlOiB3ZSBjYW5ub3Qg\nYXNzZXJ0IGRldmVsb3BlciBjYXBhYmlsaXRpZXMgaW4gdGhpcyB0b29sIGxp\na2UKICAgICAgICAvLyB3ZSBub3JtYWxseSBkbyBiZWNhdXNlIHRoaXMgY2xh\nc3MgaXMgYWxzbyB1c2VkIGF0IHJ1bnRpbWUKCiAgICAgICAgX2RzID0gY29u\nZi5nZXREYXRhU291cmNlMihudWxsKTsKICAgICAgICBfbG9nID0gY29uZi5n\nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX1NDSEVNQSk7CgogICAgICAg\nIC8vIGNhY2hlIHRoaXMgbm93IHNvIHRoYXQgaWYgdGhlIGNvbm4gcG9vbCBv\nbmx5IGhhcyAxIGNvbm5lY3Rpb24gd2UKICAgICAgICAvLyBkb24ndCBjb25m\nbGljdCBsYXRlciB3aXRoIHRoZSBvcGVuIGRhdGFiYXNlbWV0YWRhdGEgY29u\nbmVjdGlvbgogICAgICAgIF9kaWN0ID0gY29uZi5nZXREQkRpY3Rpb25hcnlJ\nbnN0YW5jZSgpOwoKICAgICAgICAvLyBjcmVhdGUgYSB0YWJsZSBvZiBhbGxv\nd2VkIHNjaGVtYSBhbmQgdGFibGVzIHRvIHJlZmxlY3Qgb24KICAgICAgICBT\ndHJpbmdbXSBzY2hlbWFBcnJheSA9IGNvbmYuZ2V0U2NoZW1hc0xpc3QoKTsK\nICAgICAgICBEQklkZW50aWZpZXJbXSBuYW1lcyA9IG5ldyBEQklkZW50aWZp\nZXJbc2NoZW1hQXJyYXkgPT0gbnVsbCA/IDAgOiBzY2hlbWFBcnJheS5sZW5n\ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbmFtZXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgU3RyaW5nW10gc3BsaXROYW1lID0gTm9y\nbWFsaXplci5zcGxpdE5hbWUoc2NoZW1hQXJyYXlbaV0pOwogICAgICAgICAg\nICBpZiAoc3BsaXROYW1lID09IG51bGwgfHwgc3BsaXROYW1lLmxlbmd0aCA9\nPSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoc3BsaXROYW1lLmxlbmd0aCA9PSAxKSB7CiAg\nICAgICAgICAgICAgICBuYW1lc1tpXSA9IERCSWRlbnRpZmllci5uZXdTY2hl\nbWEoc2NoZW1hQXJyYXlbaV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgbmFtZXNbaV0gPSBRdWFsaWZpZWREQklkZW50aWZpZXIu\nbmV3VGFibGUoc2NoZW1hQXJyYXlbaV0pOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIF9hbGxvd2VkID0gcGFyc2VTY2hlbWFzTGlzdChuYW1l\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHaXZlbiBhIGxpc3Qgb2Ygc2No\nZW1hIG5hbWVzIGFuZCB0YWJsZSBuYW1lcyAod2hlcmUgdGFibGUgbmFtZXMK\nICAgICAqIGFyZSBhbHdheXMgb2YgdGhlIGZvcm0gc2NoZW1hLnRhYmxlLCBv\nciBqdXN0IC50YWJsZSBpZiB0aGUgc2NoZW1hIGlzCiAgICAgKiB1bmtub3du\nKSwgY3JlYXRlcyBhIHRhYmxlIG1hcHBpbmcgc2NoZW1hIG5hbWUgdG8gdGFi\nbGUgbGlzdC4gUmV0dXJucwogICAgICogbnVsbCBpZiBubyBhcmdzIGFyZSBn\naXZlbi4gSWYgbm8gdGFibGVzIGFyZSBnaXZlbiBmb3IgYSBwYXJ0aWN1bGFy\nCiAgICAgKiBzY2hlbWEsIG1hcHMgdGhlIHNjaGVtYSBuYW1lIHRvIG51bGwu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdFtdW10gcGFyc2VT\nY2hlbWFzTGlzdChEQklkZW50aWZpZXJbXSBhcmdzKSB7CiAgICAgICAgaWYg\nKGFyZ3MgPT0gbnVsbCB8fCBhcmdzLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgTWFwPERCSWRlbnRpZmllciwgQ29s\nbGVjdGlvbjxEQklkZW50aWZpZXI+PiBzY2hlbWFzID0gbmV3IEhhc2hNYXA8\nREJJZGVudGlmaWVyLCBDb2xsZWN0aW9uPERCSWRlbnRpZmllcj4+KCk7CiAg\nICAgICAgREJJZGVudGlmaWVyIHNjaGVtYSA9IERCSWRlbnRpZmllci5OVUxM\nLCB0YWJsZSA9IERCSWRlbnRpZmllci5OVUxMOwogICAgICAgIENvbGxlY3Rp\nb248REJJZGVudGlmaWVyPiB0YWJsZXMgPSBudWxsOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBRdWFsaWZpZWREQklkZW50aWZpZXIgcGF0aCA9IFF1YWxpZmllZERCSWRl\nbnRpZmllci5nZXRQYXRoKGFyZ3NbaV0pOwogICAgICAgICAgICBzY2hlbWEg\nPSBwYXRoLmdldFNjaGVtYU5hbWUoKTsKICAgICAgICAgICAgdGFibGUgPSBw\nYXRoLmdldElkZW50aWZpZXIoKTsKCiAgICAgICAgICAgIC8vIGlmIGp1c3Qg\nYSBzY2hlbWEgbmFtZSwgbWFwIHNjaGVtYSB0byBudWxsCiAgICAgICAgICAg\nIGlmIChEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlKSAmJiAhc2NoZW1hcy5j\nb250YWluc0tleShzY2hlbWEpKQogICAgICAgICAgICAgICAgc2NoZW1hcy5w\ndXQoc2NoZW1hLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwodGFibGUpKSB7CiAgICAgICAgICAgICAgICB0YWJs\nZXMgPSBzY2hlbWFzLmdldChzY2hlbWEpOwogICAgICAgICAgICAgICAgaWYg\nKHRhYmxlcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGFibGVz\nID0gbmV3IExpbmtlZExpc3Q8REJJZGVudGlmaWVyPigpOwogICAgICAgICAg\nICAgICAgICAgIHNjaGVtYXMucHV0KHNjaGVtYSwgdGFibGVzKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRhYmxlcy5hZGQodGFibGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBPYmplY3RbXVtd\nIHBhcnNlZCA9IG5ldyBPYmplY3Rbc2NoZW1hcy5zaXplKCldWzJdOwogICAg\nICAgIE1hcC5FbnRyeTxEQklkZW50aWZpZXIsIENvbGxlY3Rpb248REJJZGVu\ndGlmaWVyPj4gZW50cnk7CiAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAg\nZm9yIChJdGVyYXRvcjxNYXAuRW50cnk8REJJZGVudGlmaWVyLCBDb2xsZWN0\naW9uPERCSWRlbnRpZmllcj4+PiBpdHIgPSBzY2hlbWFzLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsgCiAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgIGVudHJ5ID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgdGFi\nbGVzID0gZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIHBhcnNlZFtp\nZHhdWzBdID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgIGlmICh0YWJs\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBhcnNlZFtpZHhdWzFdID0g\ndGFibGVzLnRvQXJyYXkobmV3IERCSWRlbnRpZmllclt0YWJsZXMuc2l6ZSgp\nXSk7CiAgICAgICAgICAgIGlkeCsrOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcGFyc2VkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgaW5kZXhlcyBzaG91bGQgYmUgZ2VuZXJhdGVkLiBEZWZhdWx0cyB0byB0\ncnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJbmRleGVzKCkg\newogICAgICAgIHJldHVybiBfaW5kZXhlczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB3aGV0aGVyIGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVyYXRlZC4g\nRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nSW5kZXhlcyhib29sZWFuIGluZGV4ZXMpIHsKICAgICAgICBfaW5kZXhlcyA9\nIGluZGV4ZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhl\nciBmb3JlaWduIGtleXMgc2hvdWxkIGJlIGdlbmVyYXRlZC4gRGVmYXVsdHMg\ndG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Rm9yZWln\nbktleXMoKSB7CiAgICAgICAgcmV0dXJuIF9ma3M7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgd2hldGhlciBmb3JlaWduIGtleXMgc2hvdWxkIGJlIGdl\nbmVyYXRlZC4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Rm9yZWlnbktleXMoYm9vbGVhbiBma3MpIHsKICAgICAgICBf\nZmtzID0gZmtzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgcHJpbWFyeSBrZXlzIHNob3VsZCBiZSBnZW5lcmF0ZWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFByaW1h\ncnlLZXlzKCkgewogICAgICAgIHJldHVybiBfcGtzOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHdoZXRoZXIgcHJpbWFyeSBrZXlzIHNob3VsZCBiZSBn\nZW5lcmF0ZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFByaW1hcnlLZXlzKGJvb2xlYW4gcGtzKSB7CiAgICAgICAg\nX3BrcyA9IHBrczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgZ2VuZXJhdGVkLiBEZWZhdWx0cyB0\nbyB0cnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTZXF1ZW5j\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zZXFzOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHdoZXRoZXIgc2VxdWVuY2VzIHNob3VsZCBiZSBnZW5lcmF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9\nIHNlcXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVy\nYXRlIGluZm8gb24gc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNv\nbXBvbmVudHMKICAgICAqIGZvciBib29ra2VlcGluZy4gRGVmYXVsdHMgdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0T3BlbkpQQVRh\nYmxlcygpIHsKICAgICAgICByZXR1cm4gX29wZW5qcGFUYWJsZXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIGluZm8gb24g\nc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNvbXBvbmVudHMKICAg\nICAqIGZvciBib29ra2VlcGluZy4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0T3BlbkpQQVRhYmxlcyhib29sZWFuIG9w\nZW5qcGFUYWJsZXMpIHsKICAgICAgICBfb3BlbmpwYVRhYmxlcyA9IG9wZW5q\ncGFUYWJsZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGN1\ncnJlbnQgc2NoZW1hIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgU2NoZW1h\nR3JvdXAgZ2V0U2NoZW1hR3JvdXAoKSB7CiAgICAgICAgaWYgKF9ncm91cCA9\nPSBudWxsKQogICAgICAgICAgICBfZ3JvdXAgPSBuZXcgU2NoZW1hR3JvdXAo\nKTsKICAgICAgICByZXR1cm4gX2dyb3VwOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBzY2hlbWEgZ3JvdXAgdG8gYWRkIGdlbmVyYXRlZCBzY2hl\nbWFzIHRvLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTY2hlbWFHcm91\ncChTY2hlbWFHcm91cCBncm91cCkgewogICAgICAgIF9ncm91cCA9IGdyb3Vw\nOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYWxsIHNjaGVtYXMg\nc2V0IGluIHRoZSBjb25maWd1cmF0aW9uLiBUaGlzIG1ldGhvZCBhbHNvCiAg\nICAgKiBjYWxscyB7QGxpbmsgI2dlbmVyYXRlSW5kZXhlc30sIHtAbGluayAj\nZ2VuZXJhdGVQcmltYXJ5S2V5c30sIGFuZAogICAgICoge0BsaW5rICNnZW5l\ncmF0ZUZvcmVpZ25LZXlzfSBhdXRvbWF0aWNhbGx5LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBnZW5lcmF0ZVNjaGVtYXMoKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xv\nYy5nZXQoImdlbmVyYXRpbmctc2NoZW1hcyIpKTsKICAgICAgICBnZW5lcmF0\nZVNjaGVtYXMoKERCSWRlbnRpZmllcltdKW51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZvaWQg\nZ2VuZXJhdGVTY2hlbWFzKFN0cmluZ1tdIHNjaGVtYXNBbmRUYWJsZXMpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7ICAgICAgICAKICAgICAgICBn\nZW5lcmF0ZVNjaGVtYXMoREJJZGVudGlmaWVyLnRvQXJyYXkoc2NoZW1hc0Fu\nZFRhYmxlcywgREJJZGVudGlmaWVyVHlwZS5UQUJMRSkpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBzY2hlbWFzIGFuZC9vciB0\nYWJsZXMgbmFtZWQgaW4gdGhlIGdpdmVuIHN0cmluZ3MuCiAgICAgKiBUaGlz\nIG1ldGhvZCBjYWxscyB7QGxpbmsgI2dlbmVyYXRlSW5kZXhlc30sCiAgICAg\nKiB7QGxpbmsgI2dlbmVyYXRlUHJpbWFyeUtleXN9LCBhbmQge0BsaW5rICNn\nZW5lcmF0ZUZvcmVpZ25LZXlzfQogICAgICogYXV0b21hdGljYWxseS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgZ2VuZXJhdGVTY2hlbWFzKERCSWRlbnRp\nZmllcltdIHNjaGVtYXNBbmRUYWJsZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdl\ndCgiZ2VuZXJhdGluZy1zY2hlbWFzIikpOwoKICAgICAgICBPYmplY3RbXVtd\nIHNjaGVtYU1hcDsKICAgICAgICBpZiAoc2NoZW1hc0FuZFRhYmxlcyA9PSBu\ndWxsIHx8IHNjaGVtYXNBbmRUYWJsZXMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHNjaGVtYU1hcCA9IF9hbGxvd2VkOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc2NoZW1hTWFwID0gcGFyc2VTY2hlbWFzTGlzdChzY2hlbWFzQW5k\nVGFibGVzKTsKCiAgICAgICAgaWYgKHNjaGVtYU1hcCA9PSBudWxsKSB7CiAg\nICAgICAgICAgIGdlbmVyYXRlU2NoZW1hKERCSWRlbnRpZmllci5OVUxMLCAo\nREJJZGVudGlmaWVyW10pbnVsbCk7CgogICAgICAgICAgICAvLyBlc3RpbWF0\nZSB0aGUgbnVtYmVyIG9mIHNjaGVtYSBvYmplY3RzIHdlIHdpbGwgbmVlZCB0\nbyB2aXNpdAogICAgICAgICAgICAvLyBpbiBvcmRlciB0byBlc3RpbWF0ZSBw\ncm9ncmVzcyB0b3RhbCBmb3IgYW55IGxpc3RlbmVycwogICAgICAgICAgICBp\nbnQgbnVtVGFibGVzID0gZ2V0VGFibGVzKG51bGwpLnNpemUoKTsKICAgICAg\nICAgICAgX3NjaGVtYU9iamVjdHMgKz0gbnVtVGFibGVzCiAgICAgICAgICAg\nICAgICArIChfcGtzID8gbnVtVGFibGVzIDogMCkKICAgICAgICAgICAgICAg\nICsgKF9pbmRleGVzID8gbnVtVGFibGVzIDogMCkKICAgICAgICAgICAgICAg\nICsgKF9ma3MgPyBudW1UYWJsZXMgOiAwKTsKCiAgICAgICAgICAgIGlmIChf\ncGtzKQogICAgICAgICAgICAgICAgZ2VuZXJhdGVQcmltYXJ5S2V5cyhEQklk\nZW50aWZpZXIuTlVMTCwgbnVsbCk7CiAgICAgICAgICAgIGlmIChfaW5kZXhl\ncykKICAgICAgICAgICAgICAgIGdlbmVyYXRlSW5kZXhlcyhEQklkZW50aWZp\nZXIuTlVMTCwgbnVsbCk7CiAgICAgICAgICAgIGlmIChfZmtzKQogICAgICAg\nICAgICAgICAgZ2VuZXJhdGVGb3JlaWduS2V5cyhEQklkZW50aWZpZXIuTlVM\nTCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIC8vIGdlbmVyYXRlIGFsbCBzY2hlbWFzIGFuZCB0YWJsZXMKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYU1hcC5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgZ2VuZXJhdGVTY2hlbWEoKERCSWRlbnRpZmllcikgc2No\nZW1hTWFwW2ldWzBdLAogICAgICAgICAgICAgICAgKERCSWRlbnRpZmllcltd\nKSBzY2hlbWFNYXBbaV1bMV0pOwoKICAgICAgICAvLyBnZW5lcmF0ZSBwa3Ms\nIGluZGV4ZXMsIGZrcwogICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFOYW1l\nID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgREJJZGVudGlmaWVyW10g\ndGFibGVOYW1lczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVt\nYU1hcC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzY2hlbWFOYW1lID0g\nKERCSWRlbnRpZmllcikgc2NoZW1hTWFwW2ldWzBdOwogICAgICAgICAgICB0\nYWJsZU5hbWVzID0gKERCSWRlbnRpZmllcltdKSBzY2hlbWFNYXBbaV1bMV07\nCgogICAgICAgICAgICAvLyBlc3RpbWF0ZSB0aGUgbnVtYmVyIG9mIHNjaGVt\nYSBvYmplY3RzIHdlIHdpbGwgbmVlZCB0byB2aXNpdAogICAgICAgICAgICAv\nLyBpbiBvcmRlciB0byBlc3RpbWF0ZSBwcm9ncmVzcyB0b3RhbCBmb3IgYW55\nIGxpc3RlbmVycwogICAgICAgICAgICBpbnQgbnVtVGFibGVzID0gKHRhYmxl\nTmFtZXMgIT0gbnVsbCkgPyB0YWJsZU5hbWVzLmxlbmd0aAogICAgICAgICAg\nICAgICAgOiBnZXRUYWJsZXMoc2NoZW1hTmFtZSkuc2l6ZSgpOwogICAgICAg\nICAgICBfc2NoZW1hT2JqZWN0cyArPSBudW1UYWJsZXMKICAgICAgICAgICAg\nICAgICsgKF9wa3MgPyBudW1UYWJsZXMgOiAwKQogICAgICAgICAgICAgICAg\nKyAoX2luZGV4ZXMgPyBudW1UYWJsZXMgOiAwKQogICAgICAgICAgICAgICAg\nKyAoX2ZrcyA/IG51bVRhYmxlcyA6IDApOwoKICAgICAgICAgICAgaWYgKF9w\na3MpCiAgICAgICAgICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKHNjaGVt\nYU5hbWUsIHRhYmxlTmFtZXMpOwogICAgICAgICAgICBpZiAoX2luZGV4ZXMp\nCiAgICAgICAgICAgICAgICBnZW5lcmF0ZUluZGV4ZXMoc2NoZW1hTmFtZSwg\ndGFibGVOYW1lcyk7CiAgICAgICAgICAgIGlmIChfZmtzKQogICAgICAgICAg\nICAgICAgZ2VuZXJhdGVGb3JlaWduS2V5cyhzY2hlbWFOYW1lLCB0YWJsZU5h\nbWVzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0g\nbmFtZQogICAgICogQHBhcmFtIHRhYmxlTmFtZXMKICAgICAqIEBkZXByZWNh\ndGVkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlU2NoZW1hKFN0\ncmluZyBuYW1lLCBTdHJpbmdbXSB0YWJsZU5hbWVzKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlU2NoZW1hKERCSWRl\nbnRpZmllci5uZXdTY2hlbWEobmFtZSksCiAgICAgICAgICAgIERCSWRlbnRp\nZmllci50b0FycmF5KHRhYmxlTmFtZXMsIERCSWRlbnRpZmllclR5cGUuVEFC\nTEUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIGZ1bGx5LWNvbnN0\ncnVjdGVkIHtAbGluayBTY2hlbWF9IG1hdGNoaW5nIHRoZSBnaXZlbiBkYXRh\nYmFzZQogICAgICogc2NoZW1hIHRvIHRoZSBjdXJyZW50IGdyb3VwLiBObyBm\nb3JlaWduIGtleXMgYXJlIGdlbmVyYXRlZCBiZWNhdXNlCiAgICAgKiBzb21l\nIGtleXMgbWlnaHQgc3BhbiBzY2hlbWFzLiBZb3UgbXVzdCBjYWxsCiAgICAg\nKiB7QGxpbmsgI2dlbmVyYXRlUHJpbWFyeUtleXN9LCB7QGxpbmsgI2dlbmVy\nYXRlSW5kZXhlc30sIGFuZAogICAgICoge0BsaW5rICNnZW5lcmF0ZUZvcmVp\nZ25LZXlzfSBzZXBhcmF0ZWx5LgogICAgICoKICAgICAqIEBwYXJhbSBuYW1l\nIHRoZSBkYXRhYmFzZSBuYW1lIG9mIHRoZSBzY2hlbWEsIG9yIG51bGwgZm9y\nIGFsbCBzY2hlbWFzCiAgICAgKiBAcGFyYW0gdGFibGVOYW1lcyBhIGxpc3Qg\nb2YgdGFibGVzIHRvIGdlbmVyYXRlIGluIHRoZSBzY2hlbWEsIG9yIG51bGwK\nICAgICAqIHRvIGdlbmVyYXRlIGFsbCB0YWJsZXMKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgZ2VuZXJhdGVTY2hlbWEoREJJZGVudGlmaWVyIG5hbWUsIERC\nSWRlbnRpZmllcltdIHRhYmxlTmFtZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdl\ndCgiZ2VuZXJhdGluZy1zY2hlbWEiLCBuYW1lKSk7CgogICAgICAgIC8vIGdl\nbmVyYXRlIHRhYmxlcywgaW5jbHVkaW5nIGNvbHVtbnMgYW5kIHByaW1hcnkg\na2V5cwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9IF9kcy5nZXRDb25uZWN0\naW9uKCk7CiAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRhID0gY29ubi5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0\nYWJsZU5hbWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBnZW5lcmF0ZVRh\nYmxlcyhuYW1lLCBEQklkZW50aWZpZXIuTlVMTCwgY29ubiwgbWV0YSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgdGFibGVOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nICAgICBnZW5lcmF0ZVRhYmxlcyhuYW1lLCB0YWJsZU5hbWVzW2ldLCBjb25u\nLCBtZXRhKTsKCiAgICAgICAgICAgIGlmIChfc2VxcykKICAgICAgICAgICAg\nICAgIGdlbmVyYXRlU2VxdWVuY2VzKG5hbWUsIERCSWRlbnRpZmllci5OVUxM\nLCBjb25uLCBtZXRhKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAvLyBzb21lIGRhdGFiYXNlcyByZXF1aXJlIGEgY29tbWl0IGFmdGVyIG1l\ndGFkYXRhIHRvIHJlbGVhc2UgbG9ja3MKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGNvbm4uY29tbWl0KCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUg\ncHJpbWFyeSBrZXkgaW5mb3JtYXRpb24gZm9yIHRoZSBnaXZlbiBzY2hlbWEu\nIFRoaXMgbWV0aG9kCiAgICAgKiBtdXN0IGJlIGNhbGxlZCBpbiBhZGRpdGlv\nbiB0byB7QGxpbmsgI2dlbmVyYXRlU2NoZW1hfS4gSXQgc2hvdWxkCiAgICAg\nKiBvbmx5IGJlIGNhbGxlZCBhZnRlciBhbGwgc2NoZW1hcyBhcmUgZ2VuZXJh\ndGVkLiBUaGUgc2NoZW1hIG5hbWUgYW5kCiAgICAgKiB0YWJsZXMgYXJyYXkg\nY2FuIGJlIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBpbmRleGVzIHNob3VsZCBi\nZSBnZW5lcmF0ZWQKICAgICAqIGZvciBhbGwgc2NoZW1hcyBhbmQvb3IgdGFi\nbGVzLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZv\naWQgZ2VuZXJhdGVQcmltYXJ5S2V5cyhTdHJpbmcgc2NoZW1hTmFtZSwgU3Ry\naW5nW10gdGFibGVOYW1lcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKERCSWRlbnRpZmllci5u\nZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmll\nci50b0FycmF5KHRhYmxlTmFtZXMsIERCSWRlbnRpZmllclR5cGUuVEFCTEUp\nKTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogR2VuZXJhdGUgcHJpbWFy\neSBrZXkgaW5mb3JtYXRpb24gZm9yIHRoZSBnaXZlbiBzY2hlbWEuIFRoaXMg\nbWV0aG9kCiAgICAgKiBtdXN0IGJlIGNhbGxlZCBpbiBhZGRpdGlvbiB0byB7\nQGxpbmsgI2dlbmVyYXRlU2NoZW1hfS4gSXQgc2hvdWxkCiAgICAgKiBvbmx5\nIGJlIGNhbGxlZCBhZnRlciBhbGwgc2NoZW1hcyBhcmUgZ2VuZXJhdGVkLiBU\naGUgc2NoZW1hIG5hbWUgYW5kCiAgICAgKiB0YWJsZXMgYXJyYXkgY2FuIGJl\nIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBpbmRleGVzIHNob3VsZCBiZSBnZW5l\ncmF0ZWQKICAgICAqIGZvciBhbGwgc2NoZW1hcyBhbmQvb3IgdGFibGVzLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZVByaW1hcnlLZXlzKERC\nSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXJbXSB0YWJsZU5h\nbWVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGZp\ncmVHZW5lcmF0aW9uRXZlbnQoX2xvYy5nZXQoImdlbmVyYXRpbmctYWxsLXBy\naW1hcmllcyIsIHNjaGVtYU5hbWUpKTsKCiAgICAgICAgQ29ubmVjdGlvbiBj\nb25uID0gX2RzLmdldENvbm5lY3Rpb24oKTsKICAgICAgICBEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEgPSBjb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKHRhYmxlTmFtZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGdlbmVyYXRlUHJpbWFyeUtleXMoc2NoZW1hTmFtZSwgbnVs\nbCwgY29ubiwgbWV0YSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGFibGVOYW1lcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKHNj\naGVtYU5hbWUsIHRhYmxlTmFtZXNbaV0sIGNvbm4sIG1ldGEpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIC8vIHNvbWUgZGF0YWJhc2VzIHJl\ncXVpcmUgYSBjb21taXQgYWZ0ZXIgbWV0YWRhdGEgdG8gcmVsZWFzZSBsb2Nr\ncwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29ubi5jb21t\naXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBpbmRleCBpbmZvcm1hdGlvbiBmb3Ig\ndGhlIGdpdmVuIHNjaGVtYS4gVGhpcyBtZXRob2QKICAgICAqIG11c3QgYmUg\nY2FsbGVkIGluIGFkZGl0aW9uIHRvIHtAbGluayAjZ2VuZXJhdGVTY2hlbWF9\nLiBJdCBzaG91bGQKICAgICAqIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFsbCBz\nY2hlbWFzIGFyZSBnZW5lcmF0ZWQuIFRoZSBzY2hlbWEgbmFtZSBhbmQKICAg\nICAqIHRhYmxlcyBhcnJheSBjYW4gYmUgbnVsbCB0byBpbmRpY2F0ZSB0aGF0\nIGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVyYXRlZAogICAgICogZm9yIGFsbCBz\nY2hlbWFzIGFuZC9vciB0YWJsZXMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZUluZGV4ZXMoU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZ1tdIHRhYmxlTmFtZXMpIAogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlSW5kZXhlcyhEQklk\nZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLAogICAgICAgICAgICBE\nQklkZW50aWZpZXIudG9BcnJheSh0YWJsZU5hbWVzLCBEQklkZW50aWZpZXJU\neXBlLlRBQkxFKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBp\nbmRleCBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIHNjaGVtYS4gVGhpcyBt\nZXRob2QKICAgICAqIG11c3QgYmUgY2FsbGVkIGluIGFkZGl0aW9uIHRvIHtA\nbGluayAjZ2VuZXJhdGVTY2hlbWF9LiBJdCBzaG91bGQKICAgICAqIG9ubHkg\nYmUgY2FsbGVkIGFmdGVyIGFsbCBzY2hlbWFzIGFyZSBnZW5lcmF0ZWQuIFRo\nZSBzY2hlbWEgbmFtZSBhbmQKICAgICAqIHRhYmxlcyBhcnJheSBjYW4gYmUg\nbnVsbCB0byBpbmRpY2F0ZSB0aGF0IGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVy\nYXRlZAogICAgICogZm9yIGFsbCBzY2hlbWFzIGFuZC9vciB0YWJsZXMuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlSW5kZXhlcyhEQklkZW50\naWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyW10gdGFibGVOYW1lcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmaXJlR2Vu\nZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5lcmF0aW5nLWFsbC1pbmRleGVz\nIiwgc2NoZW1hTmFtZSkpOwoKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBf\nZHMuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIERhdGFiYXNlTWV0YURhdGEg\nbWV0YSA9IGNvbm4uZ2V0TWV0YURhdGEoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAodGFibGVOYW1lcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgZ2VuZXJhdGVJbmRleGVzKHNjaGVtYU5hbWUsIG51bGwsIGNvbm4sIG1l\ndGEpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHRhYmxlTmFtZXMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICAgICAgZ2VuZXJhdGVJbmRleGVzKHNjaGVtYU5hbWUsIHRhYmxl\nTmFtZXNbaV0sIGNvbm4sIG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIC8vIHNvbWUgZGF0YWJhc2VzIHJlcXVpcmUgYSBjb21taXQg\nYWZ0ZXIgbWV0YWRhdGEgdG8gcmVsZWFzZSBsb2NrcwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgY29ubi5jb21taXQoKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2Uo\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZW5lcmF0ZSBmb3JlaWduIGtleSBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVu\nIHNjaGVtYS4gVGhpcyBtZXRob2QKICAgICAqIG11c3QgYmUgY2FsbGVkIGlu\nIGFkZGl0aW9uIHRvIHtAbGluayAjZ2VuZXJhdGVTY2hlbWF9LiBJdCBzaG91\nbGQKICAgICAqIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFsbCBzY2hlbWFzIGFy\nZSBnZW5lcmF0ZWQuIFRoZSBzY2hlbWEgbmFtZSBhbmQKICAgICAqIHRhYmxl\ncyBhcnJheSBjYW4gYmUgbnVsbCB0byBpbmRpY2F0ZSB0aGF0IGluZGV4ZXMg\nc2hvdWxkIGJlIGdlbmVyYXRlZAogICAgICogZm9yIGFsbCBzY2hlbWFzIGFu\nZC9vciB0YWJsZXMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBnZW5lcmF0ZUZvcmVpZ25LZXlzKFN0cmluZyBzY2hlbWFO\nYW1lLCBTdHJpbmdbXSB0YWJsZU5hbWVzKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlRm9yZWlnbktleXMoREJJZGVu\ndGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgREJJ\nZGVudGlmaWVyLnRvQXJyYXkodGFibGVOYW1lcywgREJJZGVudGlmaWVyVHlw\nZS5UQUJMRSkpOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSBmb3JlaWduIGtleSBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIHNjaGVt\nYS4gVGhpcyBtZXRob2QKICAgICAqIG11c3QgYmUgY2FsbGVkIGluIGFkZGl0\naW9uIHRvIHtAbGluayAjZ2VuZXJhdGVTY2hlbWF9LiBJdCBzaG91bGQKICAg\nICAqIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFsbCBzY2hlbWFzIGFyZSBnZW5l\ncmF0ZWQuIFRoZSBzY2hlbWEgbmFtZSBhbmQKICAgICAqIHRhYmxlcyBhcnJh\neSBjYW4gYmUgbnVsbCB0byBpbmRpY2F0ZSB0aGF0IGluZGV4ZXMgc2hvdWxk\nIGJlIGdlbmVyYXRlZAogICAgICogZm9yIGFsbCBzY2hlbWFzIGFuZC9vciB0\nYWJsZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlRm9yZWln\nbktleXMoREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmllcltd\nIHRhYmxlTmFtZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdldCgiZ2VuZXJhdGlu\nZy1hbGwtZm9yZWlnbnMiLCBzY2hlbWFOYW1lKSk7CgogICAgICAgIENvbm5l\nY3Rpb24gY29ubiA9IF9kcy5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgRGF0\nYWJhc2VNZXRhRGF0YSBtZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0YWJsZU5hbWVzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBnZW5lcmF0ZUZvcmVpZ25LZXlzKHNjaGVtYU5h\nbWUsIG51bGwsIGNvbm4sIG1ldGEpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRhYmxlTmFtZXMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVGb3JlaWdu\nS2V5cyhzY2hlbWFOYW1lLCB0YWJsZU5hbWVzW2ldLCBjb25uLCBtZXRhKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyBzb21lIGRhdGFi\nYXNlcyByZXF1aXJlIGEgY29tbWl0IGFmdGVyIG1ldGFkYXRhIHRvIHJlbGVh\nc2UgbG9ja3MKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNv\nbm4uY29tbWl0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBjb25uLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAg\ncHVibGljIHZvaWQgZ2VuZXJhdGVUYWJsZXMoU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyB0YWJsZU5hbWUsCiAgICAgICAgQ29ubmVjdGlvbiBjb25uLCBE\nYXRhYmFzZU1ldGFEYXRhIG1ldGEpIAogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGdlbmVyYXRlVGFibGVzKERCSWRlbnRpZmllci5u\nZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmll\nci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25uLCBtZXRhKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgYWxsIHRhYmxlcyBtYXRjaGluZyB0aGUgZ2l2\nZW4gbmFtZSBwYXR0ZXJuIHRvIHRoZSBzY2hlbWEuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGdlbmVyYXRlVGFibGVzKERCSWRlbnRpZmllciBzY2hlbWFO\nYW1lLCBEQklkZW50aWZpZXIgdGFibGVOYW1lLAogICAgICAgIENvbm5lY3Rp\nb24gY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQo\nX2xvYy5nZXQoImdlbmVyYXRpbmctY29sdW1ucyIsIHNjaGVtYU5hbWUsCiAg\nICAgICAgICAgIHRhYmxlTmFtZSkpOwogICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nImdlbi10YWJsZXMiLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUpKTsKCiAgICAg\nICAgQ29sdW1uW10gY29scyA9IF9kaWN0LmdldENvbHVtbnMobWV0YSwgCiAg\nICAgICAgICAgIERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNvbm4uZ2V0Q2F0\nYWxvZygpKSwgc2NoZW1hTmFtZSwKICAgICAgICAgICAgdGFibGVOYW1lLCBu\ndWxsLCBjb25uKTsKCiAgICAgICAgLy8gd2hlbiB3ZSB3YW50IHRvIGdldCBh\nbGwgdGhlIGNvbHVtbnMgZm9yIGFsbCB0YWJsZXMsIHdlIG5lZWQgdG8gYnVp\nbGQKICAgICAgICAvLyBhIGxpc3Qgb2YgdGFibGVzIHRvIHZlcmlmeSBiZWNh\ndXNlIHNvbWUgZGF0YWJhc2VzIChlLmcuLCBQb3N0Z3JlcykKICAgICAgICAv\nLyB3aWxsIGluY2x1ZGUgaW5kZXhlcyBpbiB0aGUgbGlzdCBvZiBjb2x1bW5z\nLCBhbmQgdGhlcmUgaXMgbm8gd2F5IHRvCiAgICAgICAgLy8gZGlzdGluZ3Vp\nc2ggdGhlIGluZGV4ZXMgZnJvbSBwcm9wZXIgY29sdW1ucwogICAgICAgIFNl\ndDxEQklkZW50aWZpZXI+IHRhYmxlTmFtZXMgPSBudWxsOwogICAgICAgIGlm\nIChEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkgfHwgIiUiLmVxdWFs\ncyh0YWJsZU5hbWUuZ2V0TmFtZSgpKSkgewogICAgICAgICAgICBUYWJsZVtd\nIHRhYmxlcyA9IF9kaWN0LmdldFRhYmxlcyhtZXRhLCBEQklkZW50aWZpZXIu\nbmV3Q2F0YWxvZyhjb25uLmdldENhdGFsb2coKSksCiAgICAgICAgICAgICAg\nICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGNvbm4pOwogICAgICAgICAgICB0\nYWJsZU5hbWVzID0gbmV3IEhhc2hTZXQ8REJJZGVudGlmaWVyPigpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgdGFibGVzICE9IG51bGwgJiYgaSA8\nIHRhYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGNv\nbHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRhYmxlTmFtZXMu\nYWRkKHRhYmxlc1tpXS5nZXRJZGVudGlmaWVyKCkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgREJJZGVudGlmaWVyIHNOYW1lID0gREJJZGVudGlmaWVyLnRvVXBwZXIo\ndGFibGVzW2ldLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgICAgICAgICAg\nICAgdGFibGVOYW1lcy5hZGQoc05hbWUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBkYXRhYmFz\nZSBjYW4ndCBoYW5kbGUgbnVsbCB0YWJsZSBuYW1lLCByZWN1cnNlIG9uIGVh\nY2gga25vd24gbmFtZQogICAgICAgIGlmIChjb2xzID09IG51bGwgJiYgREJJ\nZGVudGlmaWVyLmlzTnVsbCh0YWJsZU5hbWUpKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3I8REJJZGVudGlmaWVyPiBpdHIgPSB0YWJsZU5hbWVzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgZ2Vu\nZXJhdGVUYWJsZXMoc2NoZW1hTmFtZSwgaXRyLm5leHQoKSwgY29ubiwgbWV0\nYSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNj\naGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBT\nY2hlbWEgc2NoZW1hOwogICAgICAgIFRhYmxlIHRhYmxlOwogICAgICAgIERC\nSWRlbnRpZmllciB0YWJsZVNjaGVtYSA9IERCSWRlbnRpZmllci5OVUxMOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBjb2xzICE9IG51bGwgJiYgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKERCSWRlbnRpZmll\nci5pc051bGwodGFibGVOYW1lKSB8fCB0YWJsZU5hbWUuZXF1YWxzKCIlIikp\nIHsKICAgICAgICAgICAgICAgIHRhYmxlTmFtZSA9IGNvbHNbaV0uZ2V0VGFi\nbGVJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKERCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpIHsKICAgICAgICAg\nICAgICAgIHRhYmxlU2NoZW1hID0gREJJZGVudGlmaWVyLnRyaW1Ub051bGwo\nY29sc1tpXS5nZXRTY2hlbWFJZGVudGlmaWVyKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGFibGVTY2hl\nbWEgPSBzY2hlbWFOYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAog\nICAgICAgICAgICAvLyBpZ25vcmUgc3BlY2lhbCB0YWJsZXMKICAgICAgICAg\nICAgaWYgKCFfb3BlbmpwYVRhYmxlcyAmJgogICAgICAgICAgICAgICAgKHRh\nYmxlTmFtZS5nZXROYW1lKCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJP\nUEVOSlBBXyIpCiAgICAgICAgICAgICAgICAgICAgfHwgdGFibGVOYW1lLmdl\ndE5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIkpET18iKSkpIC8v\nIGxlZ2FjeQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg\nIGlmIChfZGljdC5pc1N5c3RlbVRhYmxlKHRhYmxlTmFtZSwgdGFibGVTY2hl\nbWEsICFEQklkZW50aWZpZXIuaXNOdWxsKHNjaGVtYU5hbWUpKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gaWdub3JlIHRh\nYmxlcyBub3QgaW4gbGlzdCwgb3Igbm90IGFsbG93ZWQgYnkgc2NoZW1hcyBw\ncm9wZXJ0eQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRhYmxlTmFt\nZXMgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgIXRhYmxlTmFtZXMuY29u\ndGFpbnMoREJJZGVudGlmaWVyLnRvVXBwZXIodGFibGVOYW1lKSkpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKCFpc0FsbG93\nZWRUYWJsZSh0YWJsZVNjaGVtYSwgdGFibGVOYW1lKSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuZ2V0\nU2NoZW1hKHRhYmxlU2NoZW1hKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuYWRkU2No\nZW1hKHRhYmxlU2NoZW1hKTsKCiAgICAgICAgICAgIHRhYmxlID0gc2NoZW1h\nLmdldFRhYmxlKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGlmICh0YWJsZSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICB0YWJsZSA9IHNjaGVtYS5hZGRU\nYWJsZSh0YWJsZU5hbWUpOwogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJjb2wtdGFibGUiLCB0YWJsZSkpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2VuLWNvbHVtbiIs\nIGNvbHNbaV0uZ2V0SWRlbnRpZmllcigpLCB0YWJsZSkpOwoKICAgICAgICAg\nICAgaWYgKHRhYmxlLmdldENvbHVtbihjb2xzW2ldLmdldElkZW50aWZpZXIo\nKSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGFibGUuaW1wb3J0Q29s\ndW1uKGNvbHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHRhYmxl\nIGlzIGFsbG93ZWQgYnkgdGhlIHVzZXIncyBzY2hlbWEgbGlzdC4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGlzQWxsb3dlZFRhYmxlKERCSWRlbnRp\nZmllciBzY2hlbWEsIERCSWRlbnRpZmllciB0YWJsZSkgewogICAgICAgIGlm\nIChfYWxsb3dlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nCiAgICAgICAgLy8gZG8gY2FzZS1pbnNlbnNpdGl2ZSBjb21wYXJpc29uIG9u\nIGFsbG93ZWQgdGFibGUgYW5kIHNjaGVtYSBuYW1lcwogICAgICAgIERCSWRl\nbnRpZmllcltdIHRhYmxlczsKICAgICAgICBEQklkZW50aWZpZXJbXSBhbnlT\nY2hlbWFUYWJsZXMgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgX2FsbG93ZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKF9h\nbGxvd2VkW2ldWzBdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGFueVNj\naGVtYVRhYmxlcyA9IChEQklkZW50aWZpZXJbXSkgX2FsbG93ZWRbaV1bMV07\nCiAgICAgICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXNjaGVtYS5lcXVhbHMo\nKERCSWRlbnRpZmllcikgX2FsbG93ZWRbaV1bMF0pKQogICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICBpZiAodGFibGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB0YWJs\nZXMgPSAoREJJZGVudGlmaWVyW10pIF9hbGxvd2VkW2ldWzFdOwogICAgICAg\nICAgICBpZiAodGFibGVzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJs\nZXMubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICBpZiAodGFibGUuZXF1\nYWxzKHRhYmxlc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYW55U2NoZW1hVGFibGVzICE9\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBhbnlTY2hlbWFUYWJsZXMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICBpZiAodGFibGUuZXF1YWxzKGFueVNjaGVtYVRhYmxlc1tp\nXSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEdlbmVyYXRlcyB0YWJsZSBwcmltYXJ5IGtleXMuCiAgICAgKiBAZGVwcmVj\nYXRlZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZVByaW1hcnlL\nZXlzKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLAogICAg\nICAgIENvbm5lY3Rpb24gY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRl\nUHJpbWFyeUtleXMoREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1l\nKSwgREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlTmFtZSksCiAgICAgICAg\nICAgIGNvbm4sIG1ldGEpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdlbmVy\nYXRlUHJpbWFyeUtleXMoREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRl\nbnRpZmllciB0YWJsZU5hbWUsCiAgICAgICAgQ29ubmVjdGlvbiBjb25uLCBE\nYXRhYmFzZU1ldGFEYXRhIG1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdldCgi\nZ2VuZXJhdGluZy1wcmltYXJ5IiwKICAgICAgICAgICAgc2NoZW1hTmFtZSwg\ndGFibGVOYW1lKSk7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2VuLXBrcyIs\nIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSkpOwoKICAgICAgICAvLyBpZiBsb29r\naW5nIGZvciBhIG5vbi1leGlzdGFudCB0YWJsZSwganVzdCByZXR1cm4KICAg\nICAgICBTY2hlbWFHcm91cCBncm91cCA9IGdldFNjaGVtYUdyb3VwKCk7CiAg\nICAgICAgaWYgKHRhYmxlTmFtZSAhPSBudWxsICYmICF0YWJsZU5hbWUuaXNO\ndWxsKCkgJiYgCiAgICAgICAgICAgICAgICBncm91cC5maW5kVGFibGUoUXVh\nbGlmaWVkREJJZGVudGlmaWVyLmdldFBhdGgodGFibGVOYW1lKSkgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB0aGUgZGF0\nYWJhc2UgY2FuJ3QgdXNlIGEgdGFibGUgbmFtZSB3aWxkY2FyZCwgcmVjdXJz\nZSBvbiBlYWNoCiAgICAgICAgLy8gY29uY3JldGUgdGFibGUgaW4gdGhlIHJl\ncXVlc3RlZCBzY2hlbWEocykKICAgICAgICBQcmltYXJ5S2V5W10gcGtzID0g\nX2RpY3QuZ2V0UHJpbWFyeUtleXMobWV0YSwgCiAgICAgICAgICAgIERCSWRl\nbnRpZmllci5uZXdDYXRhbG9nKGNvbm4uZ2V0Q2F0YWxvZygpKSwKICAgICAg\nICAgICAgc2NoZW1hTmFtZSwgdGFibGVOYW1lLCBjb25uKTsKICAgICAgICBU\nYWJsZSB0YWJsZTsKICAgICAgICBpZiAocGtzID09IG51bGwgJiYgdGFibGVO\nYW1lID09IG51bGwpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbjxUYWJsZT4g\ndGFibGVzID0gZ2V0VGFibGVzKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yPFRhYmxlPiBpdHIgPSB0YWJsZXMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRhYmxlID0gKFRh\nYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgZ2VuZXJhdGVQcmlt\nYXJ5S2V5cyh0YWJsZS5nZXRTY2hlbWFJZGVudGlmaWVyKCksCiAgICAgICAg\nICAgICAgICAgICAgdGFibGUuZ2V0SWRlbnRpZmllcigpLCBjb25uLCBtZXRh\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICBTY2hlbWEgc2NoZW1hOwogICAgICAgIFByaW1hcnlLZXkg\ncGs7CiAgICAgICAgREJJZGVudGlmaWVyIG5hbWUgPSBEQklkZW50aWZpZXIu\nTlVMTDsKICAgICAgICBEQklkZW50aWZpZXIgY29sTmFtZSA9IERCSWRlbnRp\nZmllci5OVUxMOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBwa3MgIT0gbnVs\nbCAmJiBpIDwgcGtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNjaGVt\nYU5hbWUgPSBEQklkZW50aWZpZXIudHJpbVRvTnVsbChzY2hlbWFOYW1lKTsK\nICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuZ2V0U2NoZW1hKHNjaGVtYU5h\nbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgdGFibGUgPSBzY2hlbWEu\nZ2V0VGFibGUocGtzW2ldLmdldFRhYmxlSWRlbnRpZmllcigpKTsKICAgICAg\nICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIGNvbE5hbWUgPSBwa3NbaV0uZ2V0Q29sdW1u\nSWRlbnRpZmllcigpOwogICAgICAgICAgICBuYW1lID0gcGtzW2ldLmdldElk\nZW50aWZpZXIoKTsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImdl\nbi1wayIsIG5hbWUsIHRhYmxlLCBjb2xOYW1lKSk7CgogICAgICAgICAgICBw\nayA9IHRhYmxlLmdldFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgaWYgKHBr\nID09IG51bGwpCiAgICAgICAgICAgICAgICBwayA9IHRhYmxlLmFkZFByaW1h\ncnlLZXkobmFtZSk7CiAgICAgICAgICAgIHBrLmFkZENvbHVtbih0YWJsZS5n\nZXRDb2x1bW4oY29sTmFtZSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEdlbmVyYXRlcyB0YWJsZSBpbmRleGVzLgogICAgICogQGRlcHJl\nY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZvaWQgZ2VuZXJhdGVJbmRleGVz\nKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLAogICAgICAg\nIENvbm5lY3Rpb24gY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGdlbmVyYXRlSW5k\nZXhlcyhEQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLCBEQklk\nZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSwKICAgICAgICAgICAgY29u\nbiwgbWV0YSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ2VuZXJhdGVJbmRl\neGVzKERCSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIgdGFi\nbGVOYW1lLAogICAgICAgIENvbm5lY3Rpb24gY29ubiwgRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xvYy5nZXQoImdlbmVyYXRpbmct\naW5kZXhlcyIsCiAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSkp\nOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImdlbi1pbmRleGVzIiwgc2NoZW1h\nTmFtZSwgdGFibGVOYW1lKSk7CgogICAgICAgIC8vIGlmIGxvb2tpbmcgZm9y\nIGEgbm9uLWV4aXN0YW50IHRhYmxlLCBqdXN0IHJldHVybgogICAgICAgIFNj\naGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBp\nZiAodGFibGVOYW1lICE9IG51bGwgJiYgZ3JvdXAuZmluZFRhYmxlKFF1YWxp\nZmllZERCSWRlbnRpZmllci5nZXRQYXRoKHRhYmxlTmFtZSkpID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhlIGRhdGFi\nYXNlIGNhbid0IHVzZSBhIHRhYmxlIG5hbWUgd2lsZGNhcmQsIHJlY3Vyc2Ug\nb24gZWFjaAogICAgICAgIC8vIGNvbmNyZXRlIHRhYmxlIGluIHRoZSByZXF1\nZXN0ZWQgc2NoZW1hKHMpCiAgICAgICAgSW5kZXhbXSBpZHhzID0gX2RpY3Qu\nZ2V0SW5kZXhJbmZvKG1ldGEsIERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNv\nbm4uZ2V0Q2F0YWxvZygpKSwKICAgICAgICAgICAgc2NoZW1hTmFtZSwgdGFi\nbGVOYW1lLCBmYWxzZSwgdHJ1ZSwgY29ubik7CiAgICAgICAgVGFibGUgdGFi\nbGU7CiAgICAgICAgaWYgKGlkeHMgPT0gbnVsbCAmJiB0YWJsZU5hbWUgPT0g\nbnVsbCkgewogICAgICAgICAgICBDb2xsZWN0aW9uPFRhYmxlPiB0YWJsZXMg\nPSBnZXRUYWJsZXMoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3I8VGFibGU+IGl0ciA9IHRhYmxlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgdGFibGUgPSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAgZ2VuZXJhdGVJbmRleGVzKHRhYmxlLmdldFNj\naGVtYUlkZW50aWZpZXIoKSwKICAgICAgICAgICAgICAgICAgICB0YWJsZS5n\nZXRJZGVudGlmaWVyKCksIGNvbm4sIG1ldGEpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNjaGVtYSBz\nY2hlbWE7CiAgICAgICAgSW5kZXggaWR4OwogICAgICAgIERCSWRlbnRpZmll\nciBuYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAgREJJZGVudGlm\naWVyIGNvbE5hbWUgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBEQklk\nZW50aWZpZXIgcGtOYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGlkeHMgIT0gbnVsbCAmJiBpIDwgaWR4cy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBzY2hlbWFOYW1lID0gREJJZGVudGlm\naWVyLnRyaW1Ub051bGwoaWR4c1tpXS5nZXRTY2hlbWFJZGVudGlmaWVyKCkp\nOwogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEoc2NoZW1h\nTmFtZSk7CiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB0YWJsZSA9IHNjaGVt\nYS5nZXRUYWJsZShpZHhzW2ldLmdldFRhYmxlSWRlbnRpZmllcigpKTsKICAg\nICAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIGlmICh0YWJsZS5nZXRQcmltYXJ5S2V5\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBrTmFtZSA9IHRhYmxlLmdl\ndFByaW1hcnlLZXkoKS5nZXRJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIHBrTmFtZSA9IG51bGw7CgogICAgICAgICAg\nICAvLyBzdGF0aXN0aWNzIGRvbid0IGhhdmUgbmFtZXM7IHNraXAgdGhlbQog\nICAgICAgICAgICBuYW1lID0gaWR4c1tpXS5nZXRJZGVudGlmaWVyKCk7CiAg\nICAgICAgICAgIGlmIChEQklkZW50aWZpZXIuaXNFbXB0eShuYW1lKQogICAg\nICAgICAgICAgICAgfHwgKHBrTmFtZSAhPSBudWxsICYmIG5hbWUuZXF1YWxz\nKHBrTmFtZSkpCiAgICAgICAgICAgICAgICB8fCBfZGljdC5pc1N5c3RlbUlu\nZGV4KG5hbWUsIHRhYmxlKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgY29sTmFtZSA9IGlkeHNbaV0uZ2V0Q29sdW1uSWRlbnRp\nZmllcigpOwogICAgICAgICAgICBpZiAodGFibGUuZ2V0Q29sdW1uKGNvbE5h\nbWUpID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4taW5kZXgiLCBuYW1lLCB0\nYWJsZSwgY29sTmFtZSkpOwoKICAgICAgICAgICAgLy8gc2FtZSBpbmRleCBt\nYXkgaGF2ZSBtdWx0aXBsZSByb3dzIGZvciBtdWx0aXBsZSBjb2xzCiAgICAg\nICAgICAgIGlkeCA9IHRhYmxlLmdldEluZGV4KG5hbWUpOwogICAgICAgICAg\nICBpZiAoaWR4ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlkeCA9IHRh\nYmxlLmFkZEluZGV4KG5hbWUpOwogICAgICAgICAgICAgICAgaWR4LnNldFVu\naXF1ZShpZHhzW2ldLmlzVW5pcXVlKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlkeC5hZGRDb2x1bW4odGFibGUuZ2V0Q29sdW1uKGNvbE5hbWUp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZXMg\ndGFibGUgZm9yZWlnbiBrZXlzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBn\nZW5lcmF0ZUZvcmVpZ25LZXlzKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcg\ndGFibGVOYW1lLAogICAgICAgIENvbm5lY3Rpb24gY29ubiwgRGF0YWJhc2VN\nZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGdlbmVyYXRlRm9yZWlnbktleXMoREJJZGVudGlmaWVyLm5ld1Nj\naGVtYShzY2hlbWFOYW1lKSwgREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxl\nTmFtZSksCiAgICAgICAgICAgIGNvbm4sIG1ldGEpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGdlbmVyYXRlRm9yZWlnbktleXMoREJJZGVudGlmaWVyIHNj\naGVtYU5hbWUsIERCSWRlbnRpZmllciB0YWJsZU5hbWUsCiAgICAgICAgQ29u\nbmVjdGlvbiBjb25uLCBEYXRhYmFzZU1ldGFEYXRhIG1ldGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmlyZUdlbmVyYXRpb25F\ndmVudChfbG9jLmdldCgiZ2VuZXJhdGluZy1mb3JlaWduIiwKICAgICAgICAg\nICAgc2NoZW1hTmFtZSwgdGFibGVOYW1lKSk7CiAgICAgICAgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9j\nLmdldCgiZ2VuLWZrcyIsIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSkpOwoKICAg\nICAgICAvLyBpZiBsb29raW5nIGZvciBhIG5vbi1leGlzdGFudCB0YWJsZSwg\nanVzdCByZXR1cm4KICAgICAgICBTY2hlbWFHcm91cCBncm91cCA9IGdldFNj\naGVtYUdyb3VwKCk7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxs\nKHRhYmxlTmFtZSkgJiYgZ3JvdXAuZmluZFRhYmxlKFF1YWxpZmllZERCSWRl\nbnRpZmllci5nZXRQYXRoKHRhYmxlTmFtZSkpID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhlIGRhdGFiYXNlIGNhbid0\nIHVzZSBhIHRhYmxlIG5hbWUgd2lsZGNhcmQsIHJlY3Vyc2Ugb24gZWFjaAog\nICAgICAgIC8vIGNvbmNyZXRlIHRhYmxlIGluIHRoZSByZXF1ZXN0ZWQgc2No\nZW1hKHMpCiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IF9kaWN0LmdldElt\ncG9ydGVkS2V5cyhtZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjb25u\nLmdldENhdGFsb2coKSksCiAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxl\nTmFtZSwgY29ubik7CiAgICAgICAgVGFibGUgdGFibGU7CiAgICAgICAgaWYg\nKGZrcyA9PSBudWxsICYmIERCSWRlbnRpZmllci5pc051bGwodGFibGVOYW1l\nKSkgewogICAgICAgICAgICBDb2xsZWN0aW9uPFRhYmxlPiB0YWJsZXMgPSBn\nZXRUYWJsZXMoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3I8VGFibGU+IGl0ciA9IHRhYmxlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgdGFibGUgPSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgZ2VuZXJhdGVGb3JlaWduS2V5cyh0YWJsZS5nZXRT\nY2hlbWFJZGVudGlmaWVyKCksCiAgICAgICAgICAgICAgICAgICAgdGFibGUu\nZ2V0SWRlbnRpZmllcigpLCBjb25uLCBtZXRhKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBTY2hlbWEg\nc2NoZW1hOwogICAgICAgIFRhYmxlIHBrVGFibGU7CiAgICAgICAgRm9yZWln\nbktleSBmazsKICAgICAgICBEQklkZW50aWZpZXIgbmFtZSA9IERCSWRlbnRp\nZmllci5OVUxMOwogICAgICAgIERCSWRlbnRpZmllciBwa1NjaGVtYU5hbWUg\nPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBEQklkZW50aWZpZXIgcGtU\nYWJsZU5hbWUgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAgICBEQklkZW50\naWZpZXIgcGtDb2xOYW1lID0gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAg\nREJJZGVudGlmaWVyIGZrQ29sTmFtZSA9IERCSWRlbnRpZmllci5OVUxMOwog\nICAgICAgIGludCBzZXE7CiAgICAgICAgYm9vbGVhbiBzZXFXYXMwID0gZmFs\nc2U7IC8vIHNvbWUgZHJpdmVycyBpbmNvcnJlY3RseSBzdGFydCBhdCAwCiAg\nICAgICAgQ29sbGVjdGlvbjxGb3JlaWduS2V5PiBpbnZhbGlkcyA9IG51bGw7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGZrcyAhPSBudWxsICYmIGkgPCBm\na3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IERC\nSWRlbnRpZmllci50cmltVG9OdWxsKGZrc1tpXS5nZXRTY2hlbWFJZGVudGlm\naWVyKCkpOwogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEo\nc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB0YWJsZSA9\nIHNjaGVtYS5nZXRUYWJsZShma3NbaV0uZ2V0VGFibGVJZGVudGlmaWVyKCkp\nOwogICAgICAgICAgICBpZiAodGFibGUgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbmFtZSA9IGZrc1tpXS5nZXRJ\nZGVudGlmaWVyKCk7CiAgICAgICAgICAgIGZrQ29sTmFtZSA9IGZrc1tpXS5n\nZXRDb2x1bW5JZGVudGlmaWVyKCk7CiAgICAgICAgICAgIHBrQ29sTmFtZSA9\nIGZrc1tpXS5nZXRQcmltYXJ5S2V5Q29sdW1uSWRlbnRpZmllcigpOwogICAg\nICAgICAgICBzZXEgPSBma3NbaV0uZ2V0S2V5U2VxdWVuY2UoKTsKICAgICAg\nICAgICAgaWYgKHNlcSA9PSAwKQogICAgICAgICAgICAgICAgc2VxV2FzMCA9\nIHRydWU7CiAgICAgICAgICAgIGlmIChzZXFXYXMwKQogICAgICAgICAgICAg\nICAgc2VxKys7CgogICAgICAgICAgICAvLyBmaW5kIHBrIHRhYmxlCiAgICAg\nICAgICAgIHBrU2NoZW1hTmFtZSA9IGZrc1tpXS5nZXRQcmltYXJ5S2V5U2No\nZW1hSWRlbnRpZmllcigpOwogICAgICAgICAgICBpZihfZGljdC5nZXRUcmlt\nU2NoZW1hTmFtZSgpKSB7CiAgICAgICAgICAgICAgICBwa1NjaGVtYU5hbWU9\nIERCSWRlbnRpZmllci50cmltVG9OdWxsKHBrU2NoZW1hTmFtZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcGtUYWJsZU5hbWUgPSBma3NbaV0uZ2V0\nUHJpbWFyeUtleVRhYmxlSWRlbnRpZmllcigpOwogICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgiZ2VuLWZrIiwgbmV3IE9iamVjdFtdeyBuYW1lLCB0\nYWJsZSwKICAgICAgICAgICAgICAgICAgICBma0NvbE5hbWUsIHBrVGFibGVO\nYW1lLCBwa0NvbE5hbWUsIHNlcSArICIiIH0pKTsKCiAgICAgICAgICAgIHBr\nVGFibGUgPSBncm91cC5maW5kVGFibGUoUXVhbGlmaWVkREJJZGVudGlmaWVy\nLm5ld1BhdGgocGtTY2hlbWFOYW1lLCBwa1RhYmxlTmFtZSkpOwogICAgICAg\nICAgICBpZiAocGtUYWJsZSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFNRTEV4Y2VwdGlvbihfbG9jLmdldCgiZ2VuLW5vZmt0YWJsZSIs\nCiAgICAgICAgICAgICAgICAgICAgdGFibGUsIHBrVGFibGVOYW1lKS5nZXRN\nZXNzYWdlKCkpOwoKICAgICAgICAgICAgLy8gdGhpcyBzdWNrcywgYmVjYXVz\nZSBpdCBpcyAqbm90KiBndWFyYW50ZWVkIHRvIHdvcms7CiAgICAgICAgICAg\nIC8vIHRoZSBmayByZXN1bHRzZXQgaXMgb3JkZXJlZCBieSBwcmltYXJ5IGtl\neSB0YWJsZSwgdGhlbgogICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIg\nd2l0aGluIHRoZSBmb3JlaWduIGtleSAoc29tZSBkcml2ZXJzIGRvbid0CiAg\nICAgICAgICAgIC8vIHVzZSBzZXF1ZW5jZSBudW1iZXJzIGNvcnJlY3RseSBl\naXRoZXIpOyBzaW5jZSBmayBuYW1lcwogICAgICAgICAgICAvLyBhcmUgYWxs\nb3dlZCB0byBiZSBudWxsLCBhbGwgdGhpcyBhZGRzIHVwIHRvIHRoZSBmYWN0\nCiAgICAgICAgICAgIC8vIHRoYXQgdGhlcmUgaXMgYWJzb2x1dGVseSBubyB3\nYXkgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbgogICAgICAgICAgICAvLyBtdWx0\naXBsZSBtdWx0aS1jb2x1bW4gZmtzIHRvIHRoZSBzYW1lIHRhYmxlOyB3ZSdy\nZSBnb2luZwogICAgICAgICAgICAvLyB0byByZWx5IG9uIGZrIG5hbWUgaGVy\nZSBhbmQgaG9wZSBpdCB3b3JrcwogICAgICAgICAgICBmayA9IHRhYmxlLmdl\ndEZvcmVpZ25LZXkobmFtZSk7CgogICAgICAgICAgICAvLyBzdGFydCBhIG5l\ndyBmaz8KICAgICAgICAgICAgaWYgKHNlcSA9PSAxIHx8IGZrID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZrID0gdGFibGUuYWRkRm9yZWlnbktleShu\nYW1lKTsKICAgICAgICAgICAgICAgIGZrLnNldERlZmVycmVkKGZrc1tpXS5p\nc0RlZmVycmVkKCkpOwogICAgICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0\naW9uKGZrc1tpXS5nZXREZWxldGVBY3Rpb24oKSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChpbnZhbGlkcyA9PSBudWxsIHx8ICFpbnZhbGlk\ncy5jb250YWlucyhmaykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgQ29sdW1uIGZrQ29sID0gdGFibGUuZ2V0Q29sdW1u\nKGZrQ29sTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZrQ29sID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJuby1jb2x1bW4iLCBma0NvbE5hbWUsIHRhYmxl\nLmdldElkZW50aWZpZXIoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBmay5qb2luKGZrQ29sLCBwa1RhYmxlLmdldENvbHVt\nbihwa0NvbE5hbWUpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbiBpYWUpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWpvaW4iLCBpYWUudG9T\ndHJpbmcoKSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnZhbGlkcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkcyA9IG5l\ndyBIYXNoU2V0PEZvcmVpZ25LZXk+KCk7CiAgICAgICAgICAgICAgICAgICAg\naW52YWxpZHMuYWRkKGZrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGludmFsaWQgZmtz\nCiAgICAgICAgaWYgKGludmFsaWRzICE9IG51bGwpIHsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvcjxGb3JlaWduS2V5PiBpdHIgPSBpbnZhbGlkcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZmsg\nPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgZmsuZ2V0VGFibGUoKS5y\nZW1vdmVGb3JlaWduS2V5KGZrKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxsIHNlcXVlbmNlcyBtYXRj\naGluZyB0aGUgZ2l2ZW4gbmFtZSBwYXR0ZXJuIHRvIHRoZSBzY2hlbWEuCiAg\nICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBnZW5l\ncmF0ZVNlcXVlbmNlcyhTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVl\nbmNlTmFtZSwKICAgICAgICBDb25uZWN0aW9uIGNvbm4sIERhdGFiYXNlTWV0\nYURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBnZW5lcmF0ZVNlcXVlbmNlcyhEQklkZW50aWZpZXIubmV3U2NoZW1h\nKHNjaGVtYU5hbWUpLCAKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld1Nl\ncXVlbmNlKHNlcXVlbmNlTmFtZSksIGNvbm4sIG1ldGEpOwogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCBnZW5lcmF0ZVNlcXVlbmNlcyhEQklkZW50aWZp\nZXIgc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHNlcXVlbmNlTmFtZSwKICAg\nICAgICBDb25uZWN0aW9uIGNvbm4sIERhdGFiYXNlTWV0YURhdGEgbWV0YSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmaXJlR2Vu\nZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5lcmF0aW5nLXNlcXVlbmNlcyIs\nIHNjaGVtYU5hbWUpKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tc2Vx\ncyIsIHNjaGVtYU5hbWUsIHNlcXVlbmNlTmFtZSkpOwoKICAgICAgICAvLyBz\naW5jZSBhbGwgdGhlIHNlcXVlbmNlcyBhcmUgZ2VuZXJhdGVkIHVuZGVyIHRo\nZSBkZWZhdWx0IHNjaGVtYQogICAgICAgIC8vIHRoZXJlZm9yZSwgd2UgY2Fu\nIHVzZSB0aGUgbnVsbCBzY2hlbWFuYW1lIHRvIHNlYXJjaAogICAgICAgIFNl\ncXVlbmNlW10gc2VxcyA9IF9kaWN0LmdldFNlcXVlbmNlcyhtZXRhLCBEQklk\nZW50aWZpZXIubmV3Q2F0YWxvZyhjb25uLmdldENhdGFsb2coKSksCiAgICAg\nICAgICAgIERCSWRlbnRpZmllci5OVUxMLCBzZXF1ZW5jZU5hbWUsIGNvbm4p\nOwoKICAgICAgICBTY2hlbWFHcm91cCBncm91cCA9IGdldFNjaGVtYUdyb3Vw\nKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBEQklkZW50aWZp\nZXIgc2VxdWVuY2VTY2hlbWEgPSBEQklkZW50aWZpZXIuTlVMTDsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgc2VxcyAhPSBudWxsICYmIGkgPCBzZXFzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNlcXVlbmNlTmFtZSA9IHNlcXNb\naV0uZ2V0SWRlbnRpZmllcigpOwogICAgICAgICAgICBzZXF1ZW5jZVNjaGVt\nYSA9IERCSWRlbnRpZmllci50cmltVG9OdWxsKHNlcXNbaV0uZ2V0U2NoZW1h\nSWRlbnRpZmllcigpKTsKCiAgICAgICAgICAgIC8vIGlnbm9yZSBzcGVjaWFs\nIHRhYmxlcwogICAgICAgICAgICBTdHJpbmcgc2VxVXBwZXIgPSBEQklkZW50\naWZpZXIudG9VcHBlcihzZXF1ZW5jZU5hbWUpLmdldE5hbWUoKTsKICAgICAg\nICAgICAgaWYgKCFfb3BlbmpwYVRhYmxlcyAmJgogICAgICAgICAgICAgICAg\nKHNlcVVwcGVyLnN0YXJ0c1dpdGgoIk9QRU5KUEFfIikKICAgICAgICAgICAg\nICAgICAgICB8fCBzZXFVcHBlci5zdGFydHNXaXRoKCJKRE9fIikpKSAvLyBs\nZWdhY3kKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBp\nZiAoX2RpY3QuaXNTeXN0ZW1TZXF1ZW5jZShzZXF1ZW5jZU5hbWUsIHNlcXVl\nbmNlU2NoZW1hLAogICAgICAgICAgICAgICAgc2NoZW1hTmFtZSAhPSBudWxs\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAo\nIWlzQWxsb3dlZFRhYmxlKHNlcXVlbmNlU2NoZW1hLCBudWxsKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgc2NoZW1hID0gZ3Jv\ndXAuZ2V0U2NoZW1hKHNlcXVlbmNlU2NoZW1hKTsKICAgICAgICAgICAgaWYg\nKHNjaGVtYSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzY2hlbWEgPSBn\ncm91cC5hZGRTY2hlbWEoc2VxdWVuY2VTY2hlbWEpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChzY2hlbWEuZ2V0U2VxdWVuY2Uoc2VxdWVuY2VO\nYW1lKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzY2hlbWEuYWRkU2Vx\ndWVuY2Uoc2VxdWVuY2VOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSBhbnkgbGlzdGVuZXJzIHRo\nYXQgYSBzY2hlbWEgb2JqZWN0IHdhcyBnZW5lcmF0ZWQuIFJldHVybnMKICAg\nICAqIHRydWUgaWYgZ2VuZXJhdGlvbiBzaG91bGQgY29udGludWUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBmaXJlR2VuZXJhdGlvbkV2ZW50KE9iamVj\ndCBzY2hlbWFPYmplY3QpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHNjaGVtYU9iamVjdCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgaWYgKF9saXN0ZW5lcnMgPT0gbnVsbCB8fCBf\nbGlzdGVuZXJzLnNpemUoKSA9PSAwKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIEV2ZW50IGUgPSBuZXcgRXZlbnQoc2NoZW1hT2JqZWN0LCBfc2No\nZW1hT2JqZWN0cyk7CiAgICAgICAgZm9yIChJdGVyYXRvcjxMaXN0ZW5lcj4g\naSA9IF9saXN0ZW5lcnMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgIExpc3RlbmVyIGwgPSBpLm5leHQoKTsKICAgICAgICAgICAg\naWYgKCFsLnNjaGVtYU9iamVjdEdlbmVyYXRlZChlKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24oX2xvYy5nZXQoInJlZnJlc2gt\nY2FuY2VsbGVkIikKICAgICAgICAgICAgICAgICAgICAuZ2V0TWVzc2FnZSgp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbGlz\ndGVuZXIgZm9yIHNjaGVtYSBnZW5lcmF0aW9uIGV2ZW50cy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gbCB0aGUgbGlzdGVuZXIgdG8gYWRkCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFkZExpc3RlbmVyKExpc3RlbmVyIGwpIHsKICAgICAg\nICBpZiAoX2xpc3RlbmVycyA9PSBudWxsKQogICAgICAgICAgICBfbGlzdGVu\nZXJzID0gbmV3IExpbmtlZExpc3Q8TGlzdGVuZXI+KCk7CiAgICAgICAgX2xp\nc3RlbmVycy5hZGQobCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVz\nIGEgc2NoZW1hIGdlbmVyYXRpb24gbGlzdGVuZXIgZm9yIHNjaGVtYSBldmVu\ndHMuCiAgICAgKgogICAgICogQHBhcmFtIGwgdGhlIGxpc3RlbmVyIHRvIHJl\nbW92ZQogICAgICogQHJldHVybiB0cnVlIGlmIGl0IHdhcyBzdWNjZXNzZnVs\nbHkgcmVtb3ZlZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVM\naXN0ZW5lcihMaXN0ZW5lciBsKSB7CiAgICAgICAgcmV0dXJuIF9saXN0ZW5l\ncnMgIT0gbnVsbCAmJiBfbGlzdGVuZXJzLnJlbW92ZShsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhbGwgdGFibGVzIGZvciB0aGUgZ2l2ZW4g\nc2NoZW1hIG5hbWUsIG9yIGFsbCB0YWJsZXMgaW4KICAgICAqIHRoZSBzY2hl\nbWEgZ3JvdXAgaWYgbnVsbCBpcyBnaXZlbi4KICAgICAqLwogICAgcHJpdmF0\nZSBDb2xsZWN0aW9uPFRhYmxlPiBnZXRUYWJsZXMoREJJZGVudGlmaWVyIHNj\naGVtYU5hbWUpIHsKICAgICAgICBTY2hlbWFHcm91cCBncm91cCA9IGdldFNj\naGVtYUdyb3VwKCk7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxs\nKHNjaGVtYU5hbWUpKSB7CiAgICAgICAgICAgIFNjaGVtYSBzY2hlbWEgPSBn\ncm91cC5nZXRTY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGlmIChz\nY2hlbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0\naW9ucy5lbXB0eUxpc3QoKTsKICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5h\nc0xpc3Qoc2NoZW1hLmdldFRhYmxlcygpKTsKICAgICAgICB9CgogICAgICAg\nIFNjaGVtYVtdIHNjaGVtYXMgPSBncm91cC5nZXRTY2hlbWFzKCk7CiAgICAg\nICAgQ29sbGVjdGlvbjxUYWJsZT4gdGFibGVzID0gbmV3IExpbmtlZExpc3Q8\nVGFibGU+KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB0YWJsZXMuYWRkQWxsKEFycmF5\ncy5hc0xpc3Qoc2NoZW1hc1tpXS5nZXRUYWJsZXMoKSkpOwogICAgICAgIHJl\ndHVybiB0YWJsZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBIGxpc3RlbmVy\nIGZvciBhIHBvdGVudGlhbGx5IGxlbmd0aHkgc2NoZW1hIGdlbmVyYXRpb24g\ncHJvY2Vzcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRlcmZhY2Ug\nTGlzdGVuZXIgewoKICAgICAgICBib29sZWFuIHNjaGVtYU9iamVjdEdlbmVy\nYXRlZChFdmVudCBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFuIGV2ZW50\nIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdlbmVyYXRpb24gb2YgYSBzY2hlbWEg\nb2JqZWN0LgogICAgICovCiAgICBAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFs\nIikKICAgIHB1YmxpYyBjbGFzcyBFdmVudAogICAgICAgIGV4dGVuZHMgRXZl\nbnRPYmplY3QgewoKICAgICAgICBwcml2YXRlIGZpbmFsIGludCBfdG90YWw7\nCgogICAgICAgIHB1YmxpYyBFdmVudChPYmplY3Qgb2IsIGludCB0b3RhbCkg\newogICAgICAgICAgICBzdXBlcihvYik7CiAgICAgICAgICAgIF90b3RhbCA9\nIHRvdGFsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRUb3Rh\nbCgpIHsKICAgICAgICAgICAgcmV0dXJuIF90b3RhbDsKICAgICAgICB9CiAg\nICB9Cn0K\n","encoding":"base64"}

