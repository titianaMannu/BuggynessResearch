{"sha":"780f41bc754d5e85b446132085608935da6445db","node_id":"MDQ6QmxvYjIwNjM2NDo3ODBmNDFiYzc1NGQ1ZTg1YjQ0NjEzMjA4NTYwODkzNWRhNjQ0NWRi","size":197476,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/780f41bc754d5e85b446132085608935da6445db","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7\nCmltcG9ydCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc3Fs\nLkFycmF5OwppbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3Fs\nLkNsb2I7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2\nYS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVmOwppbXBvcnQgamF2\nYS5zcWwuUmVzdWx0U2V0OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5zcWwuU1FMV2FybmluZzsKaW1wb3J0IGphdmEuc3Fs\nLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZh\nLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0\nIGphdmEudGV4dC5NZXNzYWdlRm9ybWF0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkVudW1TZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtl\nZEhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5Mb2NhbGU7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlm\naWVyLkNvbHVtbkRlZklkZW50aWZpZXJSdWxlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5Ob3JtYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZp\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVy\nLkRCSWRlbnRpZmllclJ1bGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllclV0aWw7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllci5E\nQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhwQ29udGV4\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkV4cFN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2Vy\nbmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5OdWxsOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2YVNRTFR5cGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5EYXRhU291\ncmNlRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLk5hbWVTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuRktNYXBL\nZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0\nZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlNl\ncTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRo\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5pZGVu\ndGlmaWVyLklkZW50aWZpZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5pZGVudGlmaWVyLklkZW50aWZpZXJSdWxlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5pZGVudGlmaWVyLklkZW50\naWZpZXJVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJj\nLkNvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmpkYmMuTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFs\naWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkxvY2tFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PYmplY3RFeGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlzdGljRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUXVlcnlFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SZWZlcmVu\ndGlhbEludGVncml0eUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlNlcmlhbGl6YXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCmltcG9ydCBz\nZXJwLnV0aWwuTnVtYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoK\nLyoqCiAqIENsYXNzIHdoaWNoIGFsbG93cyB0aGUgY3JlYXRpb24gb2YgU1FM\nIGR5bmFtaWNhbGx5LCBpbiBhCiAqIGRhdGFiYXNlIGFnbm9zdGljIGZhc2hp\nb24uIFN1YmNsYXNzIGZvciB0aGUgbnVhbmNlcyBvZiBkaWZmZXJlbnQgZGF0\nYSBzdG9yZXMuCiAqLwpwdWJsaWMgY2xhc3MgREJEaWN0aW9uYXJ5CiAgICBp\nbXBsZW1lbnRzIENvbmZpZ3VyYWJsZSwgQ29ubmVjdGlvbkRlY29yYXRvciwg\nSm9pblN5bnRheGVzLAogICAgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3Iu\nU1FMV2FybmluZ0hhbmRsZXIsIElkZW50aWZpZXJDb25maWd1cmF0aW9uIHsK\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBWRU5ET1JfT1RIRVIg\nPSAib3RoZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVkVO\nRE9SX0RBVEFESVJFQ1QgPSAiZGF0YWRpcmVjdCI7CgogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0VfVVBQRVIgPSBJZGVudGlm\naWVyVXRpbC5DQVNFX1VQUEVSOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgU0NIRU1BX0NBU0VfTE9XRVIgPSBJZGVudGlmaWVyVXRpbC5DQVNF\nX0xPV0VSOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1B\nX0NBU0VfUFJFU0VSVkUgPSBJZGVudGlmaWVyVXRpbC5DQVNFX1BSRVNFUlZF\nOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlNfTkFNRV9C\nRUZPUkUgPSAiYmVmb3JlIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry\naW5nIENPTlNfTkFNRV9NSUQgPSAibWlkIjsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgU3RyaW5nIENPTlNfTkFNRV9BRlRFUiA9ICJhZnRlciI7CiAgICAK\nICAgIHB1YmxpYyBpbnQgYmxvYkJ1ZmZlclNpemUgPSA1MDAwMDsKICAgIHB1\nYmxpYyBpbnQgY2xvYkJ1ZmZlclNpemUgPSA1MDAwMDsKCiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9QT1NUX1NFTEVDVCA9IDA7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9QUkVfRElTVElO\nQ1QgPSAxOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0Vf\nUE9TVF9ESVNUSU5DVCA9IDI7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBSQU5HRV9QT1NUX0xPQ0sgPSAzOwoKICAgIHByb3RlY3RlZCBzdGF0\naWMgZmluYWwgaW50IE5BTk8gPSAxOwogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgTUlDUk8gPSBOQU5PICogMTAwMDsKICAgIHByb3RlY3RlZCBz\ndGF0aWMgZmluYWwgaW50IE1JTExJID0gTUlDUk8gKiAxMDAwOwogICAgcHJv\ndGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgQ0VOVEkgPSBNSUxMSSAqIDEwOwog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgREVDSSA9IE1JTExJICog\nMTAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgU0VDID0gTUlM\nTEkgKiAxMDAwOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IE5B\nTUVfQU5ZID0gREJJZGVudGlmaWVyVXRpbC5BTlk7CiAgICBwcm90ZWN0ZWQg\nc3RhdGljIGZpbmFsIGludCBOQU1FX1RBQkxFID0gREJJZGVudGlmaWVyVXRp\nbC5UQUJMRTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IE5BTUVf\nU0VRVUVOQ0UgPSBEQklkZW50aWZpZXJVdGlsLlNFUVVFTkNFOwogICAgCiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBVTkxJTUlURUQgPSAtMTsK\nICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IE5PX0JBVENIID0gMDsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgWkVST19EQVRFX1NU\nUiA9CiAgICAgICAgIiciICsgbmV3IGphdmEuc3FsLkRhdGUoMCkgKyAiJyI7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgWkVST19USU1FX1NU\nUiA9ICInIiArIG5ldyBUaW1lKDApICsgIiciOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgU3RyaW5nIFpFUk9fVElNRVNUQU1QX1NUUiA9CiAgICAgICAg\nIiciICsgbmV3IFRpbWVzdGFtcCgwKSArICInIjsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKERCRGljdGlvbmFyeS5jbGFzcyk7CgogICAgLy8gc2No\nZW1hIGRhdGEKICAgIHB1YmxpYyBTdHJpbmcgcGxhdGZvcm0gPSAiR2VuZXJp\nYyI7CiAgICBwdWJsaWMgU3RyaW5nIGRyaXZlclZlbmRvciA9IG51bGw7CiAg\nICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVQcmltYXJ5S2V5cyA9IHRydWU7CiAg\nICBwdWJsaWMgU3RyaW5nIGNvbnN0cmFpbnROYW1lTW9kZSA9IENPTlNfTkFN\nRV9CRUZPUkU7CiAgICBwdWJsaWMgaW50IG1heFRhYmxlTmFtZUxlbmd0aCA9\nIDEyODsKICAgIHB1YmxpYyBpbnQgbWF4Q29sdW1uTmFtZUxlbmd0aCA9IDEy\nODsKICAgIHB1YmxpYyBpbnQgbWF4Q29uc3RyYWludE5hbWVMZW5ndGggPSAx\nMjg7CiAgICBwdWJsaWMgaW50IG1heEluZGV4TmFtZUxlbmd0aCA9IDEyODsK\nICAgIHB1YmxpYyBpbnQgbWF4SW5kZXhlc1BlclRhYmxlID0gSW50ZWdlci5N\nQVhfVkFMVUU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0ZvcmVpZ25L\nZXlzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUGFyYW1l\ndGVySW5TZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNGb3JlaWduS2V5c0NvbXBvc2l0ZSA9IHRydWU7CiAgICBwdWJsaWMgYm9v\nbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0gdHJ1ZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3RyaWN0RGVsZXRl\nQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQ2Fz\nY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0gdHJ1ZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rpb24g\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRlVXBk\nYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbiA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFibGVXaXRo\nRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc0NvbW1lbnRzID0gZmFsc2U7CiAgICBwdWJsaWMgQm9vbGVhbiBzdXBwb3J0\nc0dldEdlbmVyYXRlZEtleXMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBy\nZXNlcnZlZFdvcmRzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVt\nU2NoZW1hcyA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHN5c3RlbVRhYmxl\ncyA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHNlbGVjdFdvcmRzID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgZml4ZWRTaXplVHlwZU5hbWVzID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgc2NoZW1hQ2FzZSA9IFNDSEVNQV9DQVNF\nX1VQUEVSOwogICAgcHVibGljIGJvb2xlYW4gc2V0U3RyaW5nUmlnaHRUcnVu\nY2F0aW9uT24gPSB0cnVlOwoKICAgIC8vIHNxbAogICAgcHVibGljIFN0cmlu\nZyB2YWxpZGF0aW9uU1FMID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgY2xv\nc2VQb29sU1FMID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgaW5pdGlhbGl6\nYXRpb25TUUwgPSBudWxsOwogICAgcHVibGljIGludCBqb2luU3ludGF4ID0g\nU1lOVEFYX1NRTDkyOwogICAgcHVibGljIFN0cmluZyBvdXRlckpvaW5DbGF1\nc2UgPSAiTEVGVCBPVVRFUiBKT0lOIjsKICAgIHB1YmxpYyBTdHJpbmcgaW5u\nZXJKb2luQ2xhdXNlID0gIklOTkVSIEpPSU4iOwogICAgcHVibGljIFN0cmlu\nZyBjcm9zc0pvaW5DbGF1c2UgPSAiQ1JPU1MgSk9JTiI7CiAgICBwdWJsaWMg\nYm9vbGVhbiByZXF1aXJlc0NvbmRpdGlvbkZvckNyb3NzSm9pbiA9IGZhbHNl\nOwogICAgcHVibGljIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UgPSAiRk9SIFVQ\nREFURSI7CiAgICBwdWJsaWMgU3RyaW5nIHRhYmxlRm9yVXBkYXRlQ2xhdXNl\nID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgZGlzdGluY3RDb3VudENvbHVt\nblNlcGFyYXRvciA9IG51bGw7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc1NlbGVjdEZvclVwZGF0ZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgPSB0cnVlOwogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxlVGFi\nbGVzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2lu\nZ1dpdGhPcmRlckNsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0xvY2tpbmdXaXRoT3V0ZXJKb2luID0gdHJ1ZTsKICAgIHB1Ymxp\nYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhJbm5lckpvaW4gPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aFNlbGVj\ndFJhbmdlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUXVl\ncnlUaW1lb3V0ID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHNpbXVsYXRl\nTG9ja2luZyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNT\ndWJzZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHND\nb3JyZWxhdGVkU3Vic2VsZWN0ID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzSGF2aW5nID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzU2VsZWN0U3RhcnRJbmRleCA9IGZhbHNlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNTZWxlY3RFbmRJbmRleCA9IGZhbHNlOwogICAgcHVi\nbGljIGludCByYW5nZVBvc2l0aW9uID0gUkFOR0VfUE9TVF9TRUxFQ1Q7CiAg\nICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0ID0g\nZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc1RhcmdldEZvckRl\nbGV0ZSA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gYWxsb3dzQWxpYXNJ\nbkJ1bGtDbGF1c2UgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNNdWx0aXBsZU5vbnRyYW5zYWN0aW9uYWxSZXN1bHRTZXRzID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzU2VhcmNoU3RyaW5nRXNjYXBl\nRm9yTGlrZSA9IHRydWU7CiAgICBwdWJsaWMgU3RyaW5nIHNlYXJjaFN0cmlu\nZ0VzY2FwZSA9ICJcXCI7CiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0Nh\nc3RGb3JNYXRoRnVuY3Rpb25zID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiByZXF1aXJlc0Nhc3RGb3JDb21wYXJpc29ucyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNNb2RPcGVyYXRvciA9IGZhbHNlOwogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNYTUxDb2x1bW4gPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQ2FzZUNvbnZlcnNpb25Gb3JMb2Ig\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcG9ydHNTdWNjZXNzTm9J\nbmZvT25CYXRjaFVwZGF0ZXMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzU2VsZWN0RnJvbUZpbmFsVGFibGUgPSBmYWxzZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzU2ltcGxlQ2FzZUV4cHJlc3Npb24gPSB0\ncnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNHZW5lcmFsQ2FzZUV4\ncHJlc3Npb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gdXNlV2lsZENh\ncmRGb3JDb3VudCA9IGZhbHNlOwogICAgCiAgICAvKioKICAgICAqIFNvbWUg\nRGF0YWJhc2VzIGFwcGVuZCB3aGl0ZXNwYWNlIGFmdGVyIHRoZSBzY2hlbWEg\nbmFtZSAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdHJpbVNjaGVtYU5h\nbWUgPSBmYWxzZTsKCiAgICAvLyBmdW5jdGlvbnMKICAgIHB1YmxpYyBTdHJp\nbmcgY2FzdEZ1bmN0aW9uID0gIkNBU1QoezB9IEFTIHsxfSkiOwogICAgcHVi\nbGljIFN0cmluZyB0b0xvd2VyQ2FzZUZ1bmN0aW9uID0gIkxPV0VSKHswfSki\nOwogICAgcHVibGljIFN0cmluZyB0b1VwcGVyQ2FzZUZ1bmN0aW9uID0gIlVQ\nUEVSKHswfSkiOwogICAgcHVibGljIFN0cmluZyBzdHJpbmdMZW5ndGhGdW5j\ndGlvbiA9ICJDSEFSX0xFTkdUSCh7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcg\nYml0TGVuZ3RoRnVuY3Rpb24gPSAiKE9DVEVUX0xFTkdUSCh7MH0pICogOCki\nOwogICAgcHVibGljIFN0cmluZyB0cmltTGVhZGluZ0Z1bmN0aW9uID0gIlRS\nSU0oTEVBRElORyB7MX0gRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcg\ndHJpbVRyYWlsaW5nRnVuY3Rpb24gPSAiVFJJTShUUkFJTElORyB7MX0gRlJP\nTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgdHJpbUJvdGhGdW5jdGlvbiA9\nICJUUklNKEJPVEggezF9IEZST00gezB9KSI7CiAgICBwdWJsaWMgU3RyaW5n\nIGNvbmNhdGVuYXRlRnVuY3Rpb24gPSAiKHswfXx8ezF9KSI7CiAgICBwdWJs\naWMgU3RyaW5nIGNvbmNhdGVuYXRlRGVsaW1pdGVyID0gIidPUEVOSlBBVE9L\nRU4nIjsKICAgIHB1YmxpYyBTdHJpbmcgc3Vic3RyaW5nRnVuY3Rpb25OYW1l\nID0gIlNVQlNUUklORyI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnREYXRl\nRnVuY3Rpb24gPSAiQ1VSUkVOVF9EQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcg\nY3VycmVudFRpbWVGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUUiOwogICAgcHVi\nbGljIFN0cmluZyBjdXJyZW50VGltZXN0YW1wRnVuY3Rpb24gPSAiQ1VSUkVO\nVF9USU1FU1RBTVAiOwogICAgcHVibGljIFN0cmluZyBkcm9wVGFibGVTUUwg\nPSAiRFJPUCBUQUJMRSB7MH0iOwoKICAgIC8vIHR5cGVzCiAgICBwdWJsaWMg\nYm9vbGVhbiBzdG9yYWdlTGltaXRhdGlvbnNGYXRhbCA9IGZhbHNlOwogICAg\ncHVibGljIGJvb2xlYW4gc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MgPSBm\nYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN0b3JlQ2hhcnNBc051bWJlcnMg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0Qnl0ZXNGb3JCbG9i\ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlU2V0Qnl0ZXNGb3JC\nbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNlR2V0T2JqZWN0\nRm9yQmxvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdldFN0\ncmluZ0ZvckNsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VT\nZXRTdHJpbmdGb3JDbG9icyA9IGZhbHNlOwogICAgcHVibGljIGludCBtYXhF\nbWJlZGRlZEJsb2JTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IG1heEVtYmVk\nZGVkQ2xvYlNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgaW5DbGF1c2VMaW1p\ndCA9IC0xOwogICAgcHVibGljIGludCBkYXRlUHJlY2lzaW9uID0gTUlMTEk7\nCiAgICBwdWJsaWMgaW50IGNoYXJhY3RlckNvbHVtblNpemUgPSAyNTU7CiAg\nICBwdWJsaWMgU3RyaW5nIGFycmF5VHlwZU5hbWUgPSAiQVJSQVkiOwogICAg\ncHVibGljIFN0cmluZyBiaWdpbnRUeXBlTmFtZSA9ICJCSUdJTlQiOwogICAg\ncHVibGljIFN0cmluZyBiaW5hcnlUeXBlTmFtZSA9ICJCSU5BUlkiOwogICAg\ncHVibGljIFN0cmluZyBiaXRUeXBlTmFtZSA9ICJCSVQiOwogICAgcHVibGlj\nIFN0cmluZyBibG9iVHlwZU5hbWUgPSAiQkxPQiI7CiAgICBwdWJsaWMgU3Ry\naW5nIGJvb2xlYW5UeXBlTmFtZSA9ICJCT09MRUFOIjsKICAgIHB1YmxpYyBT\ndHJpbmcgY2hhclR5cGVOYW1lID0gIkNIQVIiOwogICAgcHVibGljIFN0cmlu\nZyBjbG9iVHlwZU5hbWUgPSAiQ0xPQiI7CiAgICBwdWJsaWMgU3RyaW5nIGRh\ndGVUeXBlTmFtZSA9ICJEQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcgZGVjaW1h\nbFR5cGVOYW1lID0gIkRFQ0lNQUwiOwogICAgcHVibGljIFN0cmluZyBkaXN0\naW5jdFR5cGVOYW1lID0gIkRJU1RJTkNUIjsKICAgIHB1YmxpYyBTdHJpbmcg\nZG91YmxlVHlwZU5hbWUgPSAiRE9VQkxFIjsKICAgIHB1YmxpYyBTdHJpbmcg\nZmxvYXRUeXBlTmFtZSA9ICJGTE9BVCI7CiAgICBwdWJsaWMgU3RyaW5nIGlu\ndGVnZXJUeXBlTmFtZSA9ICJJTlRFR0VSIjsKICAgIHB1YmxpYyBTdHJpbmcg\namF2YU9iamVjdFR5cGVOYW1lID0gIkpBVkFfT0JKRUNUIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgbG9uZ1ZhcmJpbmFyeVR5cGVOYW1lID0gIkxPTkdWQVJCSU5B\nUlkiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyY2hhclR5cGVOYW1lID0g\nIkxPTkdWQVJDSEFSIjsKICAgIHB1YmxpYyBTdHJpbmcgbnVsbFR5cGVOYW1l\nID0gIk5VTEwiOwogICAgcHVibGljIFN0cmluZyBudW1lcmljVHlwZU5hbWUg\nPSAiTlVNRVJJQyI7CiAgICBwdWJsaWMgU3RyaW5nIG90aGVyVHlwZU5hbWUg\nPSAiT1RIRVIiOwogICAgcHVibGljIFN0cmluZyByZWFsVHlwZU5hbWUgPSAi\nUkVBTCI7CiAgICBwdWJsaWMgU3RyaW5nIHJlZlR5cGVOYW1lID0gIlJFRiI7\nCiAgICBwdWJsaWMgU3RyaW5nIHNtYWxsaW50VHlwZU5hbWUgPSAiU01BTExJ\nTlQiOwogICAgcHVibGljIFN0cmluZyBzdHJ1Y3RUeXBlTmFtZSA9ICJTVFJV\nQ1QiOwogICAgcHVibGljIFN0cmluZyB0aW1lVHlwZU5hbWUgPSAiVElNRSI7\nCiAgICBwdWJsaWMgU3RyaW5nIHRpbWVzdGFtcFR5cGVOYW1lID0gIlRJTUVT\nVEFNUCI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbnlpbnRUeXBlTmFtZSA9ICJU\nSU5ZSU5UIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFyYmluYXJ5VHlwZU5hbWUg\nPSAiVkFSQklOQVJZIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFyY2hhclR5cGVO\nYW1lID0gIlZBUkNIQVIiOwogICAgcHVibGljIFN0cmluZyB4bWxUeXBlTmFt\nZSA9ICJYTUwiOwogICAgcHVibGljIFN0cmluZyB4bWxUeXBlRW5jb2Rpbmcg\nPSAiVVRGLTgiOwogICAgcHVibGljIFN0cmluZyBnZXRTdHJpbmdWYWwgPSAi\nIjsKCiAgICAvLyBzY2hlbWEgbWV0YWRhdGEKICAgIHB1YmxpYyBib29sZWFu\nIHVzZVNjaGVtYU5hbWUgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyB0YWJs\nZVR5cGVzID0gIlRBQkxFIjsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nU2NoZW1hRm9yR2V0VGFibGVzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzU2NoZW1hRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldENvbHVtbnMgPSB0\ncnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVGFibGVGb3JH\nZXRQcmltYXJ5S2V5cyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8gPSBmYWxzZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW1wb3J0ZWRL\nZXlzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRCZXN0Um93\nSWRlbnRpZmllckZvclByaW1hcnlLZXlzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiByZXF1aXJlc0F1dG9Db21taXRGb3JNZXRhRGF0YSA9IGZhbHNl\nOwoKICAgIC8vIGF1dG8taW5jcmVtZW50CiAgICBwdWJsaWMgaW50IG1heEF1\ndG9Bc3NpZ25OYW1lTGVuZ3RoID0gMzE7CiAgICBwdWJsaWMgU3RyaW5nIGF1\ndG9Bc3NpZ25DbGF1c2UgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBhdXRv\nQXNzaWduVHlwZU5hbWUgPSBudWxsOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNBdXRvQXNzaWduID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5nIGxh\nc3RHZW5lcmF0ZWRLZXlRdWVyeSA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5n\nIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcg\nc2VxdWVuY2VTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzZXF1ZW5j\nZVNjaGVtYVNRTCA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHNlcXVlbmNl\nTmFtZVNRTCA9IG51bGw7CiAgICAvLyBtb3N0IG5hdGl2ZSBzZXF1ZW5jZXMg\nY2FuIGJlIHJ1biBpbnNpZGUgdGhlIGJ1c2luZXNzIHRyYW5zYWN0aW9uCiAg\nICBwdWJsaWMgaW50IG5hdGl2ZVNlcXVlbmNlVHlwZT0gU2VxLlRZUEVfQ09O\nVElHVU9VUzsKCiAgICBwcm90ZWN0ZWQgSkRCQ0NvbmZpZ3VyYXRpb24gY29u\nZiA9IG51bGw7CiAgICBwcm90ZWN0ZWQgTG9nIGxvZyA9IG51bGw7CiAgICBw\ncm90ZWN0ZWQgYm9vbGVhbiBjb25uZWN0ZWQgPSBmYWxzZTsKICAgIHByb3Rl\nY3RlZCBib29sZWFuIGlzSkRCQzMgPSBmYWxzZTsKICAgIHByb3RlY3RlZCBm\naW5hbCBTZXQ8U3RyaW5nPiByZXNlcnZlZFdvcmRTZXQgPSBuZXcgSGFzaFNl\ndDxTdHJpbmc+KCk7CiAgICAvLyByZXNlcnZlZFdvcmRTZXQgc3Vic2V0IHRo\nYXQgQ0FOTk9UIGJlIHVzZWQgYXMgdmFsaWQgY29sdW1uIG5hbWVzCiAgICAv\nLyAoaS5lLiwgd2l0aG91dCBzdXJyb3VuZGluZyB0aGVtIHdpdGggZG91Ymxl\nLXF1b3RlcykKICAgIHByb3RlY3RlZCBTZXQ8U3RyaW5nPiBpbnZhbGlkQ29s\ndW1uV29yZFNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIHByb3Rl\nY3RlZCBmaW5hbCBTZXQ8U3RyaW5nPiBzeXN0ZW1TY2hlbWFTZXQgPSBuZXcg\nSGFzaFNldDxTdHJpbmc+KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0PFN0\ncmluZz4gc3lzdGVtVGFibGVTZXQgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7\nCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0PFN0cmluZz4gZml4ZWRTaXplVHlw\nZU5hbWVTZXQgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICBwcm90ZWN0\nZWQgZmluYWwgU2V0PFN0cmluZz4gdHlwZU1vZGlmaWVyU2V0ID0gbmV3IEhh\nc2hTZXQ8U3RyaW5nPigpOwoKICAgIC8vIE5hbWluZ0NvbmZpZ3VyYXRpb24g\ncHJvcGVydGllcwogICAgcHJpdmF0ZSBib29sZWFuIGRlbGltaXRJZGVudGlm\naWVycyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWxp\nbWl0ZWRJZGVudGlmaWVycyA9IHRydWU7CiAgICBwdWJsaWMgU3RyaW5nIGxl\nYWRpbmdEZWxpbWl0ZXIgPSAiXCIiOwogICAgcHVibGljIFN0cmluZyB0cmFp\nbGluZ0RlbGltaXRlciA9ICJcIiI7CiAgICBwdWJsaWMgU3RyaW5nIG5hbWVD\nb25jYXRlbmF0b3IgPSAiXyI7CiAgICBwdWJsaWMgU3RyaW5nIGRlbGltaXRl\nZENhc2UgPSBTQ0hFTUFfQ0FTRV9QUkVTRVJWRTsKICAgIHB1YmxpYyBTdHJp\nbmcgY2F0YWxvZ1NlcGFyYXRvciA9ICIuIjsKICAgIHByaXZhdGUgU3RyaW5n\nIGRlZmF1bHRTY2hlbWFOYW1lID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5n\nIGNvbnZlcnNpb25LZXkgPSBudWxsOwogICAgICAgCiAgICAvLyBOYW1pbmcg\ndXRpbGl0eSBhbmQgbmFtaW5nIHJ1bGVzCiAgICBwcml2YXRlIERCSWRlbnRp\nZmllclV0aWwgbmFtaW5nVXRpbCA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxT\ndHJpbmcsIElkZW50aWZpZXJSdWxlPiBuYW1pbmdSdWxlcyA9IG5ldyBIYXNo\nTWFwPFN0cmluZywgSWRlbnRpZmllclJ1bGU+KCk7CiAgICBwcml2YXRlIElk\nZW50aWZpZXJSdWxlIGRlZmF1bHROYW1pbmdSdWxlID0gbnVsbDsgIC8vIGNh\nY2hlZCBmb3IgcGVyZm9ybWFuY2UKICAgIAogICAgLyoqCiAgICAgKiBJZiBh\nIG5hdGl2ZSBxdWVyeSBiZWdpbnMgd2l0aCBhbnkgb2YgdGhlIHZhbHVlcyBm\nb3VuZCBoZXJlIHRoZW4gaXQgd2lsbAogICAgICogYmUgdHJlYXRlZCBhcyBh\nIHNlbGVjdCBzdGF0ZW1lbnQuICAKICAgICAqLwogICAgcHJvdGVjdGVkIGZp\nbmFsIFNldCBzZWxlY3RXb3JkU2V0ID0gbmV3IEhhc2hTZXQoKTsKCiAgICAv\nLyB3aGVuIHdlIHN0b3JlIHZhbHVlcyB0aGF0IGxvc2UgcHJlY2lzaW9uLCB0\ncmFjayB0aGUgdHlwZXMgc28gdGhhdCB0aGUKICAgIC8vIGZpcnN0IHRpbWUg\naXQgaGFwcGVucyB3ZSBjYW4gd2FybiB0aGUgdXNlcgogICAgcHJpdmF0ZSBT\nZXQgX3ByZWNpc2lvbldhcm5lZFR5cGVzID0gbnVsbDsKCiAgICAvLyBiYXRj\naExpbWl0IHZhbHVlOgogICAgLy8gLTEgPSB1bmxpbWl0ZWQKICAgIC8vIDAg\nID0gbm8gYmF0Y2gKICAgIC8vIGFueSBwb3NpdGl2ZSBudW1iZXIgPSBiYXRj\naCBsaW1pdAogICAgcHVibGljIGludCBiYXRjaExpbWl0ID0gTk9fQkFUQ0g7\nCiAgICAKICAgIHB1YmxpYyBmaW5hbCBNYXA8SW50ZWdlcixTZXQ8U3RyaW5n\nPj4gc3FsU3RhdGVDb2RlcyA9IAogICAgICAgIG5ldyBIYXNoTWFwPEludGVn\nZXIsIFNldDxTdHJpbmc+PigpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgCiAgICBwdWJsaWMgREJEaWN0aW9uYXJ5\nKCkgewogICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFsbChBcnJh\neXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkJJR0lOVCIs\nICJCSVQiLCAiQkxPQiIsICJDTE9CIiwgIkRBVEUiLCAiREVDSU1BTCIsICJE\nSVNUSU5DVCIsCiAgICAgICAgICAgICJET1VCTEUiLCAiRkxPQVQiLCAiSU5U\nRUdFUiIsICJKQVZBX09CSkVDVCIsICJOVUxMIiwgIk5VTUVSSUMiLCAKICAg\nICAgICAgICAgIk9USEVSIiwgIlJFQUwiLCAiUkVGIiwgIlNNQUxMSU5UIiwg\nIlNUUlVDVCIsICJUSU1FIiwgIlRJTUVTVEFNUCIsCiAgICAgICAgICAgICJU\nSU5ZSU5UIiwKICAgICAgICB9KSk7CiAgICAgICAgCiAgICAgICAgc2VsZWN0\nV29yZFNldC5hZGQoIlNFTEVDVCIpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4gdGhlIGRpY3Rpb25hcnkgZmly\nc3Qgc2VlcyBhbnkgY29ubmVjdGlvbi4KICAgICAqIEl0IGlzIHVzZWQgdG8g\naW5pdGlhbGl6ZSBkaWN0aW9uYXJ5IG1ldGFkYXRhIGlmIG5lZWRlZC4gSWYg\neW91CiAgICAgKiBvdmVycmlkZSB0aGlzIG1ldGhvZCwgYmUgc3VyZSB0byBj\nYWxsCiAgICAgKiA8Y29kZT5zdXBlci5jb25uZWN0ZWRDb25maWd1cmF0aW9u\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgY29ubmVjdGVkQ29u\nZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFjb25uZWN0ZWQpIHsKICAgICAg\nICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRhRGF0YSA9IG51bGw7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBtZXRhRGF0YSA9IGNvbm4u\nZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gSkRCQzMtb25seSBtZXRob2QsIHNvIGl0IG1pZ2h0\nIHRocm93IGEgCiAgICAgICAgICAgICAgICAgICAgLy8gQWJzdHJhY3RNZXRo\nb2RFcnJvcgogICAgICAgICAgICAgICAgICAgIGlzSkRCQzMgPSBtZXRhRGF0\nYS5nZXRKREJDTWFqb3JWZXJzaW9uKCkgPj0gMzsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gaWdub3JlIGlmIG5vdCBKREJDMwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIGxvZy50cmFjZShlLnRvU3RyaW5nKCksIGUpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsgICAg\nICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nLnRyYWNlKERC\nRGljdGlvbmFyeUZhY3RvcnkudG9TdHJpbmcobWV0YURhdGEpKTsKCiAgICAg\nICAgICAgICAgICBpZiAoaXNKREJDMykKICAgICAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoX2xvYy5nZXQoImNvbm5lY3Rpb24tZGVmYXVsdHMiLCBuZXcg\nT2JqZWN0W117CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4uZ2V0QXV0\nb0NvbW1pdCgpLCBjb25uLmdldEhvbGRhYmlsaXR5KCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbm4uZ2V0VHJhbnNhY3Rpb25Jc29sYXRpb24oKX0p\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8g\nQ29uZmlndXJlIHRoZSBuYW1pbmcgdXRpbGl0eQogICAgICAgICAgICBjb25m\naWd1cmVOYW1pbmdVdGlsKG1ldGFEYXRhKTsKCiAgICAgICAgICAgIC8vIEF1\ndG8tZGV0ZWN0IGdlbmVyYXRlZCBrZXlzIHJldHJpZXZhbCBzdXBwb3J0CiAg\nICAgICAgICAgIC8vIHVubGVzcyB1c2VyIHNwZWNpZmllZCBpdC4KICAgICAg\nICAgICAgaWYgKHN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaXNKREJDMykgewogICAgICAgICAgICAg\nICAgICAgIHN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cyA9CiAgICAgICAgICAg\nICAgICAgICAgICAgIG1ldGFEYXRhLnN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5\ncygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBzdXBwb3J0c0dldEdlbmVyYXRlZEtleXMgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBj\nb25uZWN0ZWQgPSB0cnVlOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQg\nY29uZmlndXJlTmFtaW5nVXRpbChEYXRhYmFzZU1ldGFEYXRhIG1ldGFEYXRh\nKSB7CiAgICAgICAgLy8gR2V0IHRoZSBuYW1pbmcgdXRpbGl0eSBmcm9tIHRo\nZSBjb25maWd1cmF0aW9uCiAgICAgICAgc2V0U3VwcG9ydHNEZWxpbWl0ZWRJ\nZGVudGlmaWVycyhtZXRhRGF0YSk7CiAgICAgICAgc2V0RGVsaW1pdGVkQ2Fz\nZShtZXRhRGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmVz\nIHRoZSBuYW1pbmcgcnVsZXMgZm9yIHRoaXMgZGljdGlvbmFyeS4gIFN1YmNs\nYXNzZXMgc2hvdWxkIAogICAgICogb3ZlcnJpZGUgdGhpcyBtZXRob2QsIHBy\nb3ZpZGluZyB0aGVpciBvd24gbmFtaW5nIHJ1bGVzLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBjb25maWd1cmVOYW1pbmdSdWxlcygpIHsKICAgICAg\nICAvLyBBZGQgdGhlIGRlZmF1bHQgbmFtaW5nIHJ1bGUKICAgICAgICBEQklk\nZW50aWZpZXJSdWxlIGRlZlJ1bGUgPSBuZXcgREJJZGVudGlmaWVyUnVsZShE\nQklkZW50aWZpZXJUeXBlLkRFRkFVTFQsIHJlc2VydmVkV29yZFNldCk7CiAg\nICAgICAgbmFtaW5nUnVsZXMucHV0KGRlZlJ1bGUuZ2V0TmFtZSgpLCBkZWZS\ndWxlKTsKICAgICAgICAvLyBEaXNhYmxlIGRlbGltaXRpbmcgb2YgY29sdW1u\nIGRlZmluaXRpb24uICBEQiBwbGF0Zm9ybXMgYXJlIHZlcnkKICAgICAgICAv\nLyBwaWNreSBhYm91dCBkZWxpbWl0ZXJzIGluIGNvbHVtbiBkZWZpbml0aW9u\ncy4gQmFzZSBjb2x1bW4gdHlwZXMKICAgICAgICAvLyBkbyBub3QgcmVxdWly\nZSBkZWxpbWl0ZXJzIGFuZCB3aWxsIGNhdXNlIGZhaWx1cmVzIGlmIGRlbGlt\naXRlZC4KICAgICAgICBEQklkZW50aWZpZXJSdWxlIGNkUnVsZSA9IG5ldyBD\nb2x1bW5EZWZJZGVudGlmaWVyUnVsZSgpOwogICAgICAgIGNkUnVsZS5zZXRD\nYW5EZWxpbWl0KGZhbHNlKTsKICAgICAgICBuYW1pbmdSdWxlcy5wdXQoY2RS\ndWxlLmdldE5hbWUoKSwgY2RSdWxlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBSZXN1bHRTZXQgd3JhcHBlcnMKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8g\ndGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgQXJyYXkgZ2V0QXJyYXkoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBy\ncy5nZXRBcnJheShjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRBc2NpaVN0cmVhbShSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEFzY2lpU3RyZWFtKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIEJpZ0RlY2ltYWwgZ2V0\nQmlnRGVjaW1hbChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0b3JlTGFyZ2VO\ndW1iZXJzQXNTdHJpbmdzKSB7CiAgICAgICAgICAgIFN0cmluZyBzdHIgPSBn\nZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgICAgIHJldHVybiAoc3Ry\nID09IG51bGwpID8gbnVsbCA6IG5ldyBCaWdEZWNpbWFsKHN0cik7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBycy5nZXRCaWdEZWNpbWFsKGNvbHVtbik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBzcGVjaWZpZWQg\nY29sdW1uIHZhbHVlIGFzIGFuIHVua25vd24gbnVtZXJpYyB0eXBlOwogICAg\nICogd2UgdHJ5IGZyb20gdGhlIG1vc3QgZ2VuZXJpYyB0byB0aGUgbGVhc3Qg\nZ2VuZXJpYy4KICAgICAqLwogICAgcHVibGljIE51bWJlciBnZXROdW1iZXIo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIC8vIHRyeSBmcm9tIHRoZSBtb3N0IGdlbmVy\naWMsIGFuZCBpZiBlcnJvcnMgb2NjdXIsIHRyeQogICAgICAgIC8vIGxlc3Mg\nZ2VuZXJpYyB0eXBlczsgdGhpcyBlbmFibGVzIHVzIHRvIGhhbmRsZSB2YWx1\nZXMKICAgICAgICAvLyBsaWtlIERvdWJsZS5OYU4gd2l0aG91dCBoYXZpbmcg\ndG8gaW50cm9zcGVjdCBvbiB0aGUKICAgICAgICAvLyBSZXN1bHRTZXRNZXRh\nRGF0YSAoYnVnICMxMDUzKS4gTm90ZSB0aGF0IHdlIGhhbmRsZQogICAgICAg\nIC8vIGdlbmVyaWMgZXhjZXB0aW9ucywgc2luY2Ugc29tZSBkcml2ZXJzIG1h\neSB0aHJvdwogICAgICAgIC8vIE51bWJlckZvcm1hdEV4Y2VwdGlvbnMsIHdo\nZXJlYXMgb3RoZXJzIG1heSB0aHJvdyBTUUxFeGNlcHRpb25zCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGdldEJpZ0RlY2ltYWwocnMsIGNv\nbHVtbik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUxKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvdWJs\nZShnZXREb3VibGUocnMsIGNvbHVtbikpOwogICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZTIpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdChnZXRGbG9hdChycywg\nY29sdW1uKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZTMpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGdldExvbmcocnMs\nIGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlNCkgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVP\nZihnZXRJbnQocnMsIGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZTUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGUxIGluc3RhbmNl\nb2YgUnVudGltZUV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFJ1\nbnRpbWVFeGNlcHRpb24pIGUxOwogICAgICAgICAgICBpZiAoZTEgaW5zdGFu\nY2VvZiBTUUxFeGNlcHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyhTUUxF\neGNlcHRpb24pIGUxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIEJpZ0ludGVnZXIg\nZ2V0QmlnSW50ZWdlcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0b3JlTGFy\nZ2VOdW1iZXJzQXNTdHJpbmdzKSB7CiAgICAgICAgICAgIFN0cmluZyBzdHIg\nPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgICAgIHJldHVybiAo\nc3RyID09IG51bGwpID8gbnVsbCA6IG5ldyBCaWdEZWNpbWFsKHN0cikudG9C\naWdJbnRlZ2VyKCk7CiAgICAgICAgfQogICAgICAgIEJpZ0RlY2ltYWwgYmQg\nPSBnZXRCaWdEZWNpbWFsKHJzLCBjb2x1bW4pOwogICAgICAgIHJldHVybiAo\nYmQgPT0gbnVsbCkgPyBudWxsIDogYmQudG9CaWdJbnRlZ2VyKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIElucHV0U3RyZWFtIGdldEJp\nbmFyeVN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJp\nbmFyeVN0cmVhbShjb2x1bW4pOwogICAgfQoKICAgIHB1YmxpYyBJbnB1dFN0\ncmVhbSBnZXRMT0JTdHJlYW0oSkRCQ1N0b3JlIHN0b3JlLCBSZXN1bHRTZXQg\ncnMsCiAgICAgICAgaW50IGNvbHVtbikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJpbmFyeVN0cmVhbShjb2x1bW4pOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQmxvYiBnZXRC\nbG9iKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QmxvYihjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3Qg\nZ2V0QmxvYk9iamVjdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIEpEQkNT\ndG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBJbnB1dFN0cmVhbSBpbiA9IG51bGw7CiAgICAgICAgaWYgKHVzZUdl\ndEJ5dGVzRm9yQmxvYnMgfHwgdXNlR2V0T2JqZWN0Rm9yQmxvYnMpIHsKICAg\nICAgICAgICAgYnl0ZVtdIGJ5dGVzID0gZ2V0Qnl0ZXMocnMsIGNvbHVtbik7\nCiAgICAgICAgICAgIGlmIChieXRlcyAhPSBudWxsICYmIGJ5dGVzLmxlbmd0\naCA+IDApCiAgICAgICAgICAgICAgICBpbiA9IG5ldyBCeXRlQXJyYXlJbnB1\ndFN0cmVhbShieXRlcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nQmxvYiBibG9iID0gZ2V0QmxvYihycywgY29sdW1uKTsKICAgICAgICAgICAg\naWYgKGJsb2IgIT0gbnVsbCAmJiBibG9iLmxlbmd0aCgpID4gMCkKICAgICAg\nICAgICAgICAgIGluID0gYmxvYi5nZXRCaW5hcnlTdHJlYW0oKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGluID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoc3RvcmUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9u\nLmRlc2VyaWFsaXplKGluLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuIFNl\ncmlhbGl6YXRpb24uZGVzZXJpYWxpemUoaW4sIHN0b3JlLmdldENvbnRleHQo\nKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGluLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNv\nbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAg\nKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEJv\nb2xlYW4oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCb29sZWFu\nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJ5\ndGUgZ2V0Qnl0ZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJ5\ndGUoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nYnl0ZVtdIGdldEJ5dGVzKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlR2V0\nQnl0ZXNGb3JCbG9icykKICAgICAgICAgICAgcmV0dXJuIHJzLmdldEJ5dGVz\nKGNvbHVtbik7CiAgICAgICAgaWYgKHVzZUdldE9iamVjdEZvckJsb2JzKQog\nICAgICAgICAgICByZXR1cm4gKGJ5dGVbXSkgcnMuZ2V0T2JqZWN0KGNvbHVt\nbik7CgogICAgICAgIEJsb2IgYmxvYiA9IGdldEJsb2IocnMsIGNvbHVtbik7\nCiAgICAgICAgaWYgKGJsb2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgaW50IGxlbmd0aCA9IChpbnQpIGJsb2IubGVuZ3Ro\nKCk7CiAgICAgICAgaWYgKGxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gYmxvYi5nZXRCeXRlcygxLCBsZW5n\ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuIENvbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7\nQGxpbmsgVGltZXN0YW1wfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgQ2FsZW5kYXIgZ2V0Q2FsZW5kYXIoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIERh\ndGUgZCA9IGdldERhdGUocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENhbGVu\nZGFyIGNhbCA9IENhbGVuZGFyLmdldEluc3RhbmNlKCk7CiAgICAgICAgY2Fs\nLnNldFRpbWUoZCk7CiAgICAgICAgcmV0dXJuIGNhbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgY2hhciBnZXRDaGFyKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoc3RvcmVDaGFyc0FzTnVtYmVycykKICAgICAgICAgICAg\ncmV0dXJuIChjaGFyKSBnZXRJbnQocnMsIGNvbHVtbik7CgogICAgICAgIFN0\ncmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgcmV0\ndXJuIChTdHJpbmdVdGlscy5pc0VtcHR5KHN0cikpID8gMCA6IHN0ci5jaGFy\nQXQoMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9w\nZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFJlYWRl\nciBnZXRDaGFyYWN0ZXJTdHJlYW0oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBycy5nZXRDaGFyYWN0ZXJTdHJlYW0oY29sdW1uKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgQ2xvYiBnZXRDbG9iKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcnMuZ2V0Q2xvYihjb2x1bW4pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZUdldFN0cmluZ0ZvckNsb2JzKQog\nICAgICAgICAgICByZXR1cm4gcnMuZ2V0U3RyaW5nKGNvbHVtbik7CgogICAg\nICAgIENsb2IgY2xvYiA9IGdldENsb2IocnMsIGNvbHVtbik7CiAgICAgICAg\naWYgKGNsb2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGNsb2IubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuICIiOwoKICAgICAgICAvLyB1bmxpa2VseSB0aGF0IHdlJ2xsIGhhdmUg\nc3RyaW5ncyBvdmVyIEludGVnZXIuTUFYX1ZBTFVFIGNoYXJzCiAgICAgICAg\ncmV0dXJuIGNsb2IuZ2V0U3ViU3RyaW5nKDEsIChpbnQpIGNsb2IubGVuZ3Ro\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuIENvbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7\nQGxpbmsgVGltZXN0YW1wfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgRGF0ZSBnZXREYXRlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBUaW1lc3RhbXAg\ndHN0YW1wID0gZ2V0VGltZXN0YW1wKHJzLCBjb2x1bW4sIG51bGwpOwogICAg\nICAgIGlmICh0c3RhbXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIC8vIGdldCB0aGUgZnJhY3Rpb25hbCBzZWNvbmRzIGNv\nbXBvbmVudCwgcm91bmRpbmcgYXdheSBhbnl0aGluZyBiZXlvbmQKICAgICAg\nICAvLyBtaWxsaXNlY29uZHMKICAgICAgICBpbnQgZnJhY3Rpb25hbCA9IChp\nbnQpIE1hdGgucm91bmQodHN0YW1wLmdldE5hbm9zKCkgLyAoZG91YmxlKSBN\nSUxMSSk7CgogICAgICAgIC8vIGdldCB0aGUgbWlsbGlzIGNvbXBvbmVudDsg\nc29tZSBKREJDIGRyaXZlcnMgcm91bmQgdGhpcyB0byB0aGUKICAgICAgICAv\nLyBuZWFyZXN0IHNlY29uZCwgd2hpbGUgb3RoZXJzIGRvIG5vdAogICAgICAg\nIGxvbmcgbWlsbGlzID0gKHRzdGFtcC5nZXRUaW1lKCkgLyAxMDAwTCkgKiAx\nMDAwTDsKICAgICAgICByZXR1cm4gbmV3IERhdGUobWlsbGlzICsgZnJhY3Rp\nb25hbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9w\nZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGphdmEu\nc3FsLkRhdGUgZ2V0RGF0ZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENh\nbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5n\nZXREYXRlKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldERhdGUoY29s\ndW1uLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUg\ncHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBk\nb3VibGUgZ2V0RG91YmxlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMu\nZ2V0RG91YmxlKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIGZsb2F0IGdldEZsb2F0KFJlc3VsdFNldCBycywgaW50IGNvbHVt\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gcnMuZ2V0RmxvYXQoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1\nbHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICov\nCiAgICBwdWJsaWMgaW50IGdldEludChSZXN1bHRTZXQgcnMsIGludCBjb2x1\nbW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHJzLmdldEludChjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBMb2NhbGUgZ2V0TG9jYWxlKFJlc3VsdFNldCBycywgaW50\nIGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJzLCBjb2x1bW4pOwogICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHN0cikpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBTdHJpbmdbXSBwYXJhbXMgPSBTdHJpbmdz\nLnNwbGl0KHN0ciwgIl8iLCAzKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0\naCA8IDMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVy\nbiBuZXcgTG9jYWxlKHBhcmFtc1swXSwgcGFyYW1zWzFdLCBwYXJhbXNbMl0p\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBsb25nIGdldExv\nbmcoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRMb25nKGNvbHVt\nbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBn\nZXRPYmplY3QoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBNYXAgbWFwKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChtYXAg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldE9iamVjdChjb2x1\nbW4pOwogICAgICAgIHJldHVybiBycy5nZXRPYmplY3QoY29sdW1uLCBtYXAp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBSZWYgZ2V0UmVm\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0UmVm\nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIHNo\nb3J0IGdldFNob3J0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0\nU2hvcnQoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8g\ndGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIHJzLmdldFN0cmluZyhjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBUaW1lIGdldFRpbWUoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gcnMuZ2V0VGltZShjb2x1bW4pOwogICAgICAgIHJldHVybiBycy5nZXRU\naW1lKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgVGltZXN0YW1wIGdldFRpbWVzdGFtcChSZXN1bHRTZXQgcnMsIGlu\ndCBjb2x1bW4sIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBycy5nZXRUaW1lc3RhbXAoY29sdW1uKTsKICAgICAgICByZXR1\ncm4gcnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByZXBhcmVk\nU3RhdGVtZW50IHdyYXBwZXJzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0QXJyYXkoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIGludCBpZHgsIEFycmF5IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEFy\ncmF5KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXNjaWlTdHJlYW0oUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAgICAgSW5wdXRTdHJl\nYW0gdmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEFzY2lpU3RyZWFt\nKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdEZWNpbWFsKFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCaWdEZWNpbWFsIHZh\nbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29t\ncGF0aWJsZShUeXBlcy5WQVJDSEFSLCBudWxsLCAwLCAwKSkKICAgICAgICAg\nICAgfHwgKGNvbCA9PSBudWxsICYmIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJp\nbmdzKSkKICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC50\nb1N0cmluZygpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rt\nbnQuc2V0QmlnRGVjaW1hbChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpZ0lu\ndGVnZXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEJpZ0lu\ndGVnZXIgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBj\nb2wuaXNDb21wYXRpYmxlKFR5cGVzLlZBUkNIQVIsIG51bGwsIDAsIDApKQog\nICAgICAgICAgICB8fCAoY29sID09IG51bGwgJiYgc3RvcmVMYXJnZU51bWJl\ncnNBc1N0cmluZ3MpKQogICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlk\neCwgdmFsLnRvU3RyaW5nKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFs\nKHZhbCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpbmFyeVN0cmVhbShQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwKICAgICAgICBJbnB1dFN0cmVh\nbSB2YWwsIGludCBsZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QmluYXJ5U3RyZWFt\nKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCbG9iKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCbG9iIHZhbCwgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1u\ndC5zZXRCbG9iKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4gVXNlcyB0aGUKICAgICAqIHtAbGluayAjc2VyaWFsaXplfSBtZXRo\nb2QgdG8gc2VyaWFsaXplIHRoZSB2YWx1ZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0QmxvYk9iamVjdChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29sLCBKREJD\nU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc2V0Qnl0ZXMoc3RtbnQsIGlkeCwgc2VyaWFsaXplKHZhbCwgc3Rv\ncmUpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZl\nbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRCb29sZWFuKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBib29sZWFuIHZhbCwKICAgICAgICBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHN0bW50LnNldEludChpZHgsICh2YWwpID8gMSA6IDApOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCeXRlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBieXRl\nIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzdG1udC5zZXRCeXRlKGlkeCwgdmFsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0Qnl0ZXMoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGJ5\ndGVbXSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlU2V0Qnl0ZXNGb3JCbG9i\ncykKICAgICAgICAgICAgc3RtbnQuc2V0Qnl0ZXMoaWR4LCB2YWwpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgc2V0QmluYXJ5U3RyZWFtKHN0bW50LCBp\nZHgsIG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbSh2YWwpLAogICAgICAgICAg\nICAgICAgdmFsLmxlbmd0aCwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2hhcihQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgY2hhciB2YWwsIENvbHVt\nbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxlKFR5cGVzLklO\nVEVHRVIsIG51bGwsIDAsIDApKQogICAgICAgICAgICB8fCAoY29sID09IG51\nbGwgJiYgc3RvcmVDaGFyc0FzTnVtYmVycykpCiAgICAgICAgICAgIHNldElu\ndChzdG1udCwgaWR4LCAoaW50KSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgU3RyaW5nLnZhbHVl\nT2YodmFsKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LAogICAgICAgIFJlYWRl\nciB2YWwsIGludCBsZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0Q2hhcmFjdGVyU3Ry\nZWFtKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDbG9iKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBDbG9iIHZhbCwgQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBz\ndG1udC5zZXRDbG9iKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2xvYlN0cmlu\nZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZh\nbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICh1c2VTZXRTdHJpbmdGb3JDbG9icykKICAg\nICAgICAgICAgc3RtbnQuc2V0U3RyaW5nKGlkeCwgdmFsKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgLy8gc2V0IHJlYWRlciBmcm9tIHN0cmluZwog\nICAgICAgICAgICBTdHJpbmdSZWFkZXIgaW4gPSBuZXcgU3RyaW5nUmVhZGVy\nKHZhbCk7CiAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwg\naWR4LCBpbiwgdmFsLmxlbmd0aCgpLCBjb2wpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0RGF0ZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nRGF0ZSB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBl\nKCkgPT0gVHlwZXMuREFURSkKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwg\naWR4LCBuZXcgamF2YS5zcWwuRGF0ZSh2YWwuZ2V0VGltZSgpKSwgbnVsbCwg\nY29sKTsKICAgICAgICBlbHNlIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0\nVHlwZSgpID09IFR5cGVzLlRJTUUpCiAgICAgICAgICAgIHNldFRpbWUoc3Rt\nbnQsIGlkeCwgbmV3IFRpbWUodmFsLmdldFRpbWUoKSksIG51bGwsIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgVGltZXN0YW1wKQog\nICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwoVGltZXN0YW1w\nKSB2YWwsIG51bGwsIGNvbCk7ICAgCiAgICAgICAgZWxzZQogICAgICAgICAg\nICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwgbmV3IFRpbWVzdGFtcCh2YWwu\nZ2V0VGltZSgpKSwgbnVsbCwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0ZShQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgamF2YS5zcWwuRGF0ZSB2\nYWwsCiAgICAgICAgQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVs\nbCkKICAgICAgICAgICAgc3RtbnQuc2V0RGF0ZShpZHgsIHZhbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXREYXRlKGlkeCwgdmFsLCBj\nYWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRDYWxlbmRhcihQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgQ2FsZW5kYXIgdmFsLAogICAgICAgIENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nYnkgZGVmYXVsdCB3ZSBtZXJlbHkgZGVsZWdhdGUgdG8gdGhlIERhdGUgcGFy\nYW1ldGVyCiAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCB2YWwuZ2V0VGlt\nZSgpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZl\nbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXREb3VibGUoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIGRvdWJsZSB2YWwsCiAgICAgICAgQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBz\ndG1udC5zZXREb3VibGUoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRGbG9hdChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgZmxvYXQgdmFsLAog\nICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0RmxvYXQoaWR4LCB2YWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRJbnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGlu\ndCB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0SW50KGlkeCwgdmFsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0TG9uZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgbG9u\nZyB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0TG9uZyhpZHgsIHZhbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1l\ndGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldExvY2FsZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nTG9jYWxlIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4\nLCB2YWwuZ2V0TGFuZ3VhZ2UoKSArICJfIiArIHZhbC5nZXRDb3VudHJ5KCkK\nICAgICAgICAgICAgKyAiXyIgKyB2YWwuZ2V0VmFyaWFudCgpLCBjb2wpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IG51bGwgYXMgYSBwYXJhbWV0ZXIg\ndG8gdGhlIHN0YXRlbWVudC4gVGhlIGNvbHVtbgogICAgICogdHlwZSB3aWxs\nIGNvbWUgZnJvbSB7QGxpbmsgVHlwZXN9LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXROdWxsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4\nLCBpbnQgY29sVHlwZSwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldE51bGwoaWR4\nLCBjb2xUeXBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0TnVtYmVyKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBOdW1iZXIgbnVtLAogICAgICAgIENvbHVt\nbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gY2hlY2sgZm9yIGtub3duIGZsb2F0aW5nIHBvaW50IHR5cGVzIHRvIGdp\ndmUgZHJpdmVyIGEgY2hhbmNlIHRvCiAgICAgICAgLy8gaGFuZGxlIHNwZWNp\nYWwgbnVtYmVycyBsaWtlIE5hTiBhbmQgaW5maW5pdHk7IGJ1ZyAjMTA1Mwog\nICAgICAgIGlmIChudW0gaW5zdGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAg\nIHNldERvdWJsZShzdG1udCwgaWR4LCAoKERvdWJsZSkgbnVtKS5kb3VibGVW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKG51bSBpbnN0YW5jZW9m\nIEZsb2F0KQogICAgICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKEZs\nb2F0KSBudW0pLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgbmV3IEJpZ0Rl\nY2ltYWwobnVtLnRvU3RyaW5nKCkpLCBjb2wpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0\naGUgc3RhdGVtZW50LiBUaGUgY29sdW1uCiAgICAgKiB0eXBlIHdpbGwgY29t\nZSBmcm9tIHtAbGluayBUeXBlc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE9iamVjdChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nT2JqZWN0IHZhbCwKICAgICAgICBpbnQgY29sVHlwZSwgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29s\nVHlwZSA9PSAtMSB8fCBjb2xUeXBlID09IFR5cGVzLk9USEVSKQogICAgICAg\nICAgICBzdG1udC5zZXRPYmplY3QoaWR4LCB2YWwpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc3RtbnQuc2V0T2JqZWN0KGlkeCwgdmFsLCBjb2xUeXBl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0UmVmKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBSZWYgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldFJlZihpZHgsIHZhbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFNob3J0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBzaG9ydCB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRTaG9y\ndChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN0cmluZyhQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHN0bW50LnNldFN0cmluZyhpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRpbWUo\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIFRpbWUgdmFsLAog\nICAgICAgIENhbGVuZGFyIGNhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAg\nICAgICAgICAgIHN0bW50LnNldFRpbWUoaWR4LCB2YWwpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc3RtbnQuc2V0VGltZShpZHgsIHZhbCwgY2FsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMg\nYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0VGltZXN0YW1wKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LAogICAgICAgIFRpbWVzdGFtcCB2YWwsIENhbGVuZGFyIGNh\nbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBkbyBub3QgaW5zZXJ0IGRhdGVz\nIGF0IGEgZ3JlYXRlciBwcmVjaXNpb24gdGhhbgogICAgICAgIC8vIHRoYXQg\nYXQgd2hpY2ggdGhleSB3aWxsIGJlIHJldHVybmVkIGJ5IGEgU0VMRUNUCiAg\nICAgICAgaW50IHJvdW5kZWQgPSAoaW50KSBNYXRoLnJvdW5kKHZhbC5nZXRO\nYW5vcygpIC8KICAgICAgICAgICAgKGRvdWJsZSkgZGF0ZVByZWNpc2lvbik7\nCiAgICAgICAgaW50IG5hbm9zID0gcm91bmRlZCAqIGRhdGVQcmVjaXNpb247\nCiAgICAgICAgaWYgKG5hbm9zID4gOTk5OTk5OTk5KSB7CiAgICAgICAgICAg\nIC8vIHJvbGxvdmVyIHRvIG5leHQgc2Vjb25kCiAgICAgICAgICAgIHZhbC5z\nZXRUaW1lKHZhbC5nZXRUaW1lKCkgKyAxMDAwKTsKICAgICAgICAgICAgbmFu\nb3MgPSAwOwogICAgICAgIH0KCiAgICAgICAgdmFsLnNldE5hbm9zKG5hbm9z\nKTsKCiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICBzdG1u\ndC5zZXRUaW1lc3RhbXAoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3RtbnQuc2V0VGltZXN0YW1wKGlkeCwgdmFsLCBjYWwpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IGEgY29sdW1uIHZhbHVlIGludG8gYSBw\ncmVwYXJlZCBzdGF0ZW1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHN0bW50\nIHRoZSBwcmVwYXJlZCBzdGF0ZW1lbnQgdG8gcGFyYW1ldGVyaXplCiAgICAg\nKiBAcGFyYW0gaWR4IHRoZSBpbmRleCBvZiB0aGUgcGFyYW1ldGVyIGluIHRo\nZSBwcmVwYXJlZCBzdGF0ZW1lbnQKICAgICAqIEBwYXJhbSB2YWwgdGhlIHZh\nbHVlIG9mIHRoZSBjb2x1bW4KICAgICAqIEBwYXJhbSBjb2wgdGhlIGNvbHVt\nbiBiZWluZyBzZXQKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBmaWVsZCBtYXBw\naW5nIHR5cGUgY29kZSBmb3IgdGhlIHZhbHVlCiAgICAgKiBAcGFyYW0gc3Rv\ncmUgdGhlIHN0b3JlIG1hbmFnZXIgZm9yIHRoZSBjdXJyZW50IGNvbnRleHQK\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VHlwZWQoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVjdCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCwgaW50IHR5cGUsIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsID09IG51bGwp\nIHsKICAgICAgICAgICAgc2V0TnVsbChzdG1udCwgaWR4LCAoY29sID09IG51\nbGwpID8gVHlwZXMuT1RIRVIgOiBjb2wuZ2V0VHlwZSgpLAogICAgICAgICAg\nICAgICAgY29sKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgU2l6ZWQgczsKICAgICAgICBDYWxlbmRhcmQgYzsKICAgICAgICBz\nd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6\nCiAgICAgICAgICAgICAgICBzZXRCb29sZWFuKHN0bW50LCBpZHgsICgoQm9v\nbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAg\nICAgICAgIHNldEJ5dGUoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuYnl0\nZVZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICBzZXRDaGFyKHN0\nbW50LCBpZHgsICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1ZSgpLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9V\nQkxFX09CSjoKICAgICAgICAgICAgICAgIHNldERvdWJsZShzdG1udCwgaWR4\nLCAoKE51bWJlcikgdmFsKS5kb3VibGVWYWx1ZSgpLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAg\nICAgICAgICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKE51bWJlcikg\ndmFsKS5mbG9hdFZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgc2V0\nSW50KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmludFZhbHVlKCksIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nR19PQko6CiAgICAgICAgICAgICAgICBzZXRMb25nKHN0bW50LCBpZHgsICgo\nTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAg\nICAgICAgICBzZXRTaG9ydChzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5z\naG9ydFZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAg\nICAgaWYgKGNvbCAhPSBudWxsICYmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVz\nLkNMT0IKICAgICAgICAgICAgICAgICAgICB8fCBjb2wuZ2V0VHlwZSgpID09\nIFR5cGVzLkxPTkdWQVJDSEFSKSkKICAgICAgICAgICAgICAgICAgICBzZXRD\nbG9iU3RyaW5nKHN0bW50LCBpZHgsIChTdHJpbmcpIHZhbCwgY29sKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRTdHJp\nbmcoc3RtbnQsIGlkeCwgKFN0cmluZykgdmFsLCBjb2wpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVD\nVDoKICAgICAgICAgICAgICAgIHNldEJsb2JPYmplY3Qoc3RtbnQsIGlkeCwg\ndmFsLCBjb2wsIHN0b3JlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAg\nc2V0RGF0ZShzdG1udCwgaWR4LCAoRGF0ZSkgdmFsLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNB\nTEVOREFSOgogICAgICAgICAgICAgICAgc2V0Q2FsZW5kYXIoc3RtbnQsIGlk\neCwgKENhbGVuZGFyKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAg\nICAgICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgKEJpZ0Rl\nY2ltYWwpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAg\nICAgICAgc2V0QmlnSW50ZWdlcihzdG1udCwgaWR4LCAoQmlnSW50ZWdlcikg\ndmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAgICAgICAgICAgIHNldE51\nbWJlcihzdG1udCwgaWR4LCAoTnVtYmVyKSB2YWwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9D\nQUxFOgogICAgICAgICAgICAgICAgc2V0TG9jYWxlKHN0bW50LCBpZHgsIChM\nb2NhbGUpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfQVJSQVk6CiAgICAgICAg\nICAgICAgICBzZXRBcnJheShzdG1udCwgaWR4LCAoQXJyYXkpIHZhbCwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFTUUxUeXBlcy5BU0NJSV9TVFJFQU06CiAgICAgICAgICAgICAgICBzID0g\nKFNpemVkKSB2YWw7CiAgICAgICAgICAgICAgICBzZXRBc2NpaVN0cmVhbShz\ndG1udCwgaWR4LCAoSW5wdXRTdHJlYW0pIHMudmFsdWUsIHMuc2l6ZSwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFTUUxUeXBlcy5CSU5BUllfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9\nIChTaXplZCkgdmFsOwogICAgICAgICAgICAgICAgc2V0QmluYXJ5U3RyZWFt\nKHN0bW50LCBpZHgsIChJbnB1dFN0cmVhbSkgcy52YWx1ZSwgcy5zaXplLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLkJMT0I6CiAgICAgICAgICAgICAgICBzZXRCbG9iKHN0\nbW50LCBpZHgsIChCbG9iKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQllURVM6CiAg\nICAgICAgICAgICAgICBzZXRCeXRlcyhzdG1udCwgaWR4LCAoYnl0ZVtdKSB2\nYWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAg\nICBzID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAgICAgICBzZXRDaGFyYWN0\nZXJTdHJlYW0oc3RtbnQsIGlkeCwgKFJlYWRlcikgcy52YWx1ZSwgcy5zaXpl\nLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVNRTFR5cGVzLkNMT0I6CiAgICAgICAgICAgICAgICBzZXRDbG9i\nKHN0bW50LCBpZHgsIChDbG9iKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0RB\nVEU6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5k\nYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZh\nbDsKICAgICAgICAgICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChq\nYXZhLnNxbC5EYXRlKSBjLnZhbHVlLCBjLmNhbGVuZGFyLAogICAgICAgICAg\nICAgICAgICAgICAgICBjb2wpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoamF2YS5z\ncWwuRGF0ZSkgdmFsLCBudWxsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlJFRjoKICAgICAg\nICAgICAgICAgIHNldFJlZihzdG1udCwgaWR4LCAoUmVmKSB2YWwsIGNvbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nU1FMVHlwZXMuVElNRToKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFu\nY2VvZiBDYWxlbmRhcmQpIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENh\nbGVuZGFyZCkgdmFsOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWUoc3Rt\nbnQsIGlkeCwgKFRpbWUpIGMudmFsdWUsIGMuY2FsZW5kYXIsIGNvbCk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRU\naW1lKHN0bW50LCBpZHgsIChUaW1lKSB2YWwsIG51bGwsIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlw\nZXMuVElNRVNUQU1QOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5j\nZW9mIENhbGVuZGFyZCkgewogICAgICAgICAgICAgICAgICAgIGMgPSAoQ2Fs\nZW5kYXJkKSB2YWw7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZXN0YW1w\nKHN0bW50LCBpZHgsIChUaW1lc3RhbXApIGMudmFsdWUsIGMuY2FsZW5kYXIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3Rt\nbnQsIGlkeCwgKFRpbWVzdGFtcCkgdmFsLCBudWxsLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICBpZiAoY29sICE9IG51bGwgJiYgKGNvbC5nZXRUeXBlKCkgPT0g\nVHlwZXMuQkxPQgogICAgICAgICAgICAgICAgICAgIHx8IGNvbC5nZXRUeXBl\nKCkgPT0gVHlwZXMuVkFSQklOQVJZKSkKICAgICAgICAgICAgICAgICAgICBz\nZXRCbG9iT2JqZWN0KHN0bW50LCBpZHgsIHZhbCwgY29sLCBzdG9yZSk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0T2Jq\nZWN0KHN0bW50LCBpZHgsIHZhbCwgY29sLmdldFR5cGUoKSwgY29sKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYSBjb21wbGV0ZWx5\nIHVua25vd24gcGFyYW1ldGVyIGludG8gYSBwcmVwYXJlZCBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFVua25vd24oUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVjdCB2YWwsCiAgICAgICAg\nQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBTaXplZCBzaXplZCA9IG51bGw7CiAgICAgICAgQ2FsZW5kYXJkIGNh\nbGQgPSBudWxsOwogICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTaXplZCkg\newogICAgICAgICAgICBzaXplZCA9IChTaXplZCkgdmFsOwogICAgICAgICAg\nICB2YWwgPSBzaXplZC52YWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIENhbGVuZGFyZCkgewogICAgICAgICAgICBjYWxkID0gKENh\nbGVuZGFyZCkgdmFsOwogICAgICAgICAgICB2YWwgPSBjYWxkLnZhbHVlOwog\nICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICBzZXROdWxsKHN0bW50LCBpZHgsIChjb2wgPT0gbnVsbCkgPyBUeXBlcy5P\nVEhFUiA6IGNvbC5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAg\nICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmluZygpLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEludGVnZXIp\nCiAgICAgICAgICAgIHNldEludChzdG1udCwgaWR4LCAoKEludGVnZXIpIHZh\nbCkuaW50VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5z\ndGFuY2VvZiBCb29sZWFuKQogICAgICAgICAgICBzZXRCb29sZWFuKHN0bW50\nLCBpZHgsICgoQm9vbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKSwgY29sKTsK\nICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBMb25nKQogICAgICAg\nICAgICBzZXRMb25nKHN0bW50LCBpZHgsICgoTG9uZykgdmFsKS5sb25nVmFs\ndWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBG\nbG9hdCkKICAgICAgICAgICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChGbG9h\ndCkgdmFsKS5mbG9hdFZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgRG91YmxlKQogICAgICAgICAgICBzZXREb3VibGUo\nc3RtbnQsIGlkeCwgKChEb3VibGUpIHZhbCkuZG91YmxlVmFsdWUoKSwgY29s\nKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBCeXRlKQogICAg\nICAgICAgICBzZXRCeXRlKHN0bW50LCBpZHgsICgoQnl0ZSkgdmFsKS5ieXRl\nVmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2Vv\nZiBDaGFyYWN0ZXIpCiAgICAgICAgICAgIHNldENoYXIoc3RtbnQsIGlkeCwg\nKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCksIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgU2hvcnQpCiAgICAgICAgICAgIHNl\ndFNob3J0KHN0bW50LCBpZHgsICgoU2hvcnQpIHZhbCkuc2hvcnRWYWx1ZSgp\nLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIExvY2Fs\nZSkKICAgICAgICAgICAgc2V0TG9jYWxlKHN0bW50LCBpZHgsIChMb2NhbGUp\nIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBC\naWdEZWNpbWFsKQogICAgICAgICAgICBzZXRCaWdEZWNpbWFsKHN0bW50LCBp\nZHgsIChCaWdEZWNpbWFsKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgQmlnSW50ZWdlcikKICAgICAgICAgICAgc2V0Qmln\nSW50ZWdlcihzdG1udCwgaWR4LCAoQmlnSW50ZWdlcikgdmFsLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEFycmF5KQogICAgICAg\nICAgICBzZXRBcnJheShzdG1udCwgaWR4LCAoQXJyYXkpIHZhbCwgY29sKTsK\nICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBCbG9iKQogICAgICAg\nICAgICBzZXRCbG9iKHN0bW50LCBpZHgsIChCbG9iKSB2YWwsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgYnl0ZVtdKQogICAgICAg\nICAgICBzZXRCeXRlcyhzdG1udCwgaWR4LCAoYnl0ZVtdKSB2YWwsIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQ2xvYikKICAgICAg\nICAgICAgc2V0Q2xvYihzdG1udCwgaWR4LCAoQ2xvYikgdmFsLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJlZikKICAgICAgICAg\nICAgc2V0UmVmKHN0bW50LCBpZHgsIChSZWYpIHZhbCwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBqYXZhLnNxbC5EYXRlKQogICAg\nICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChqYXZhLnNxbC5EYXRlKSB2\nYWwsCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBudWxsKSA/IG51bGwgOiBj\nYWxkLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0\nYW5jZW9mIFRpbWVzdGFtcCkKICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0\nbW50LCBpZHgsIChUaW1lc3RhbXApIHZhbCwKICAgICAgICAgICAgICAgIChj\nYWxkID09IG51bGwpID8gbnVsbCA6IGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgVGltZSkKICAgICAgICAg\nICAgc2V0VGltZShzdG1udCwgaWR4LCAoVGltZSkgdmFsLAogICAgICAgICAg\nICAgICAgKGNhbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwg\nY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBEYXRlKQog\nICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChEYXRlKSB2YWwsIGNv\nbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5kYXIp\nCiAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKChDYWxlbmRhcikg\ndmFsKS5nZXRUaW1lKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGlu\nc3RhbmNlb2YgUmVhZGVyKQogICAgICAgICAgICBzZXRDaGFyYWN0ZXJTdHJl\nYW0oc3RtbnQsIGlkeCwgKFJlYWRlcikgdmFsLAogICAgICAgICAgICAgICAg\nKHNpemVkID09IG51bGwpID8gMCA6IHNpemVkLnNpemUsIGNvbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLXBhcmFtIiwgdmFsLmdldENsYXNzKCkpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc2VyaWFsaXplZCBieXRlcyBm\nb3IgdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIGJ5dGVb\nXSBzZXJpYWxpemUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2YWwgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHZh\nbCBpbnN0YW5jZW9mIFNlcmlhbGl6ZWREYXRhKQogICAgICAgICAgICByZXR1\ncm4gKChTZXJpYWxpemVkRGF0YSkgdmFsKS5ieXRlczsKICAgICAgICByZXR1\ncm4gU2VyaWFsaXphdGlvbi5zZXJpYWxpemUodmFsLCBzdG9yZS5nZXRDb250\nZXh0KCkpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBKREsg\nMS40IDxjb2RlPnNldEJ5dGVzPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVu\nIEJMT0Igb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRCeXRl\ncyhCbG9iIGJsb2IsIGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGJsb2Iuc2V0Qnl0ZXMoMUwsIGRhdGEpOwog\nICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBKREsgMS40IDxjb2Rl\nPnNldFN0cmluZzwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CCiAg\nICAgKiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dFN0cmlu\nZyhDbG9iIGNsb2IsIFN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGNsb2Iuc2V0U3RyaW5nKDFMLCBkYXRhKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29k\nZT5zZXRDaGFyYWN0ZXJTdHJlYW08L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2\nZW4KICAgICAqIENMT0Igb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBwdXRDaGFycyhDbG9iIGNsb2IsIGNoYXJbXSBkYXRhKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFdyaXRlciB3cml0ZXIgPSBj\nbG9iLnNldENoYXJhY3RlclN0cmVhbSgxTCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgd3JpdGVyLndyaXRlKGRhdGEpOwogICAgICAgICAgICB3cml0\nZXIuZmx1c2goKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2Up\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihpb2UudG9T\ndHJpbmcoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2Fy\nbiB0aGF0IGEgcGFydGljdWxhciB2YWx1ZSBjb3VsZCBub3QgYmUgc3RvcmVk\nIHByZWNpc2VseS4KICAgICAqIEFmdGVyIHRoZSBmaXJzdCB3YXJuaW5nIGZv\nciBhIHBhcnRpY3VsYXIgdHlwZSwgbWVzc2FnZXMKICAgICAqIHdpbGwgYmUg\ndHVybmVkIGludG8gdHJhY2UgbWVzc2FnZXMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIHN0b3JhZ2VXYXJuaW5nKE9iamVjdCBvcmlnLCBPYmplY3Qg\nY29udmVydGVkKSB7CiAgICAgICAgYm9vbGVhbiB3YXJuOwogICAgICAgIHN5\nbmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBpZiAoX3ByZWNpc2lv\nbldhcm5lZFR5cGVzID09IG51bGwpCiAgICAgICAgICAgICAgICBfcHJlY2lz\naW9uV2FybmVkVHlwZXMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICB3\nYXJuID0gX3ByZWNpc2lvbldhcm5lZFR5cGVzLmFkZChvcmlnLmdldENsYXNz\nKCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0b3JhZ2VMaW1pdGF0aW9u\nc0ZhdGFsIHx8ICh3YXJuICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgIHx8ICghd2FybiAmJiBsb2cuaXNUcmFjZUVuYWJsZWQoKSkpIHsK\nICAgICAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgic3RvcmFnZS1y\nZXN0cmljdGlvbiIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgIHBs\nYXRmb3JtLAogICAgICAgICAgICAgICAgb3JpZywKICAgICAgICAgICAgICAg\nIG9yaWcuZ2V0Q2xhc3MoKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBj\nb252ZXJ0ZWQsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHN0\nb3JhZ2VMaW1pdGF0aW9uc0ZhdGFsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKG1zZyk7CgogICAgICAgICAgICBpZiAod2Fy\nbikKICAgICAgICAgICAgICAgIGxvZy53YXJuKG1zZyk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFjZShtc2cpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLy8vLy8vLy8KICAgIC8vIFR5cGVzCiAgICAvLy8v\nLy8vLy8KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJl\nZCB7QGxpbmsgVHlwZXN9IGNvbnN0YW50IGZvciB0aGUgZ2l2ZW4KICAgICAq\nIHtAbGluayBKYXZhVHlwZXN9IG9yIHtAbGluayBKYXZhU1FMVHlwZXN9IGNv\nbnN0YW50LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEpEQkNUeXBlKGlu\ndCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4gbG9iKSB7CiAgICAgICAgcmV0dXJu\nIGdldEpEQkNUeXBlKG1ldGFUeXBlQ29kZSwgbG9iLCAwLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJlZmVycmVkIHtAbGluayBU\neXBlc30gY29uc3RhbnQgZm9yIHRoZSBnaXZlbgogICAgICoge0BsaW5rIEph\ndmFUeXBlc30gb3Ige0BsaW5rIEphdmFTUUxUeXBlc30gY29uc3RhbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0SkRCQ1R5cGUoaW50IG1ldGFUeXBl\nQ29kZSwgYm9vbGVhbiBsb2IsIGludCBwcmVjaXMsIAogICAgICAgIGludCBz\nY2FsZSwgYm9vbGVhbiB4bWwpIHsKICAgICAgICByZXR1cm4gZ2V0SkRCQ1R5\ncGUobWV0YVR5cGVDb2RlLCBsb2IsIHByZWNpcywgc2NhbGUpOyAgICAgICAg\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7\nQGxpbmsgVHlwZXN9IGNvbnN0YW50IGZvciB0aGUgZ2l2ZW4KICAgICAqIHtA\nbGluayBKYXZhVHlwZXN9IG9yIHtAbGluayBKYXZhU1FMVHlwZXN9IGNvbnN0\nYW50LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEpEQkNUeXBlKGludCBt\nZXRhVHlwZUNvZGUsIGJvb2xlYW4gbG9iLCBpbnQgcHJlY2lzLCAKICAgICAg\nICBpbnQgc2NhbGUpIHsKICAgICAgICBpZiAobG9iKSB7CiAgICAgICAgICAg\nIHN3aXRjaCAobWV0YVR5cGVDb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFT\nUUxUeXBlcy5BU0NJSV9TVFJFQU06CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFTUUxUeXBlcy5DSEFSX1NUUkVBTToKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5DTE9CKTsKICAgICAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIHN3aXRjaCAobWV0YVR5cGVDb2RlKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklUKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVy\ncmVkVHlwZShUeXBlcy5USU5ZSU5UKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9P\nQko6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVDaGFyc0FzTnVtYmVycykK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5JTlRFR0VSKTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLkNIQVIpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRV9PQko6CiAgICAgICAgICAgICAgICBpZihwcmVjaXMgPiAwIHx8IHNjYWxl\nID4gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuRE9VQkxFKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAg\nICAgIGlmKHByZWNpcyA+IDAgfHwgc2NhbGUgPiAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuTlVNRVJJ\nQyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5SRUFMKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5\ncGUoVHlwZXMuSU5URUdFUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nQklHSU5UKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlNNQUxMSU5U\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAg\nIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFS\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5\ncGVzLkJJR0lOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RF\nQ0lNQUw6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNB\nc1N0cmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5OVU1FUklDKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgaWYg\nKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nTlVNRVJJQyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFS\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRVNUQU1Q\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nQVJSQVkpOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CSU5BUllf\nU1RSRUFNOgogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CTE9COgog\nICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwog\nICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5DTE9COgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuREFURSk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuVElNRVNUQU1QOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElN\nRVNUQU1QKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJlZmVycmVk\nIHtAbGluayBUeXBlc30gdHlwZSBmb3IgdGhlIGdpdmVuIG9uZS4gUmV0dXJu\ncwogICAgICogdGhlIGdpdmVuIHR5cGUgYnkgZGVmYXVsdC4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRQcmVmZXJyZWRUeXBlKGludCB0eXBlKSB7CiAg\nICAgICAgcmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHByZWZlcnJlZCBkYXRhYmFzZSB0eXBlIG5hbWUgZm9yIHRoZSBn\naXZlbiBjb2x1bW4ncyB0eXBlCiAgICAgKiBmcm9tIHtAbGluayBUeXBlc30u\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZU5hbWUoQ29sdW1u\nIGNvbCkgewogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzRW1wdHkoY29s\nLmdldFR5cGVJZGVudGlmaWVyKCkpKQogICAgICAgICAgICByZXR1cm4gYXBw\nZW5kU2l6ZShjb2wsIHRvREJOYW1lKGNvbC5nZXRUeXBlSWRlbnRpZmllcigp\nKSk7CgogICAgICAgIGlmIChjb2wuaXNBdXRvQXNzaWduZWQoKSAmJiBhdXRv\nQXNzaWduVHlwZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFw\ncGVuZFNpemUoY29sLCBhdXRvQXNzaWduVHlwZU5hbWUpOwoKICAgICAgICBy\nZXR1cm4gYXBwZW5kU2l6ZShjb2wsIGdldFR5cGVOYW1lKGNvbC5nZXRUeXBl\nKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHR5cGUg\nbmFtZSBmb3IgdGhlIHNwZWNpZmljIGNvbnN0YW50IGFzIGRlZmluZWQKICAg\nICAqIGJ5IHtAbGluayBqYXZhLnNxbC5UeXBlc30uCiAgICAgKgogICAgICog\nQHBhcmFtIHR5cGUgdGhlIHR5cGUKICAgICAqIEByZXR1cm4gdGhlIG5hbWUg\nZm9yIHRoZSB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VHlw\nZU5hbWUoaW50IHR5cGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIHJl\ndHVybiBhcnJheVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJJ\nR0lOVDoKICAgICAgICAgICAgICAgIHJldHVybiBiaWdpbnRUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5CSU5BUlk6CiAgICAgICAgICAgICAg\nICByZXR1cm4gYmluYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuQklUOgogICAgICAgICAgICAgICAgcmV0dXJuIGJpdFR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLkJMT0I6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gYmxvYlR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJP\nT0xFQU46CiAgICAgICAgICAgICAgICByZXR1cm4gYm9vbGVhblR5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkNIQVI6CiAgICAgICAgICAgICAg\nICByZXR1cm4gY2hhclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLkNMT0I6CiAgICAgICAgICAgICAgICByZXR1cm4gY2xvYlR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZGF0ZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRF\nQ0lNQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gZGVjaW1hbFR5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRJU1RJTkNUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGRpc3RpbmN0VHlwZU5hbWU7CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIGRvdWJs\nZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkZMT0FUOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZsb2F0VHlwZU5hbWU7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuSU5URUdFUjoKICAgICAgICAgICAgICAgIHJldHVybiBp\nbnRlZ2VyVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuSkFWQV9P\nQkpFQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gamF2YU9iamVjdFR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkxPTkdWQVJCSU5BUlk6CiAg\nICAgICAgICAgICAgICByZXR1cm4gbG9uZ1ZhcmJpbmFyeVR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLkxPTkdWQVJDSEFSOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGxvbmdWYXJjaGFyVHlwZU5hbWU7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuTlVNRVJJQzoKICAg\nICAgICAgICAgICAgIHJldHVybiBudW1lcmljVHlwZU5hbWU7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuT1RIRVI6CiAgICAgICAgICAgICAgICByZXR1cm4g\nb3RoZXJUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5SRUFMOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlYWxUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5SRUY6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVm\nVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuU01BTExJTlQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gc21hbGxpbnRUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5TVFJVQ1Q6CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3RydWN0VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElN\nRToKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lVHlwZU5hbWU7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuVElNRVNUQU1QOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHRpbWVzdGFtcFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLlRJTllJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGlueWludFR5\ncGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlZBUkJJTkFSWToKICAg\nICAgICAgICAgICAgIHJldHVybiB2YXJiaW5hcnlUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5WQVJDSEFSOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHZhcmNoYXJUeXBlTmFtZTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHJldHVybiBvdGhlclR5cGVOYW1lOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHNp\nemUgcHJvcGVydGllcyB0byB0aGUgc3BlY2lmaWVkIHR5cGUuCiAgICAgKiBJ\nZiBwcmVzZW50LCB0aGUgc3RyaW5nICJ7MH0iIHdpbGwgYmUgcmVwbGFjZWQg\nd2l0aCB0aGUgc2l6ZSBkZWZpbml0aW9uOwogICAgICogb3RoZXJ3aXNlIHRo\nZSBzaXplIGRlZmluaXRpb24gd2lsbCBiZSBhcHBlbmRlZCB0byB0aGUgdHlw\nZSBuYW1lLgogICAgICogSWYgeW91ciBkYXRhYmFzZSBoYXMgY29sdW1uIHR5\ncGVzIHRoYXQgZG9uJ3QgYWxsb3cgc2l6ZSBkZWZpbml0aW9ucywKICAgICAq\nIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIHJldHVybiB0aGUgdW5hbHRlcmVk\nIHR5cGUgbmFtZSBmb3IgY29sdW1ucyBvZgogICAgICogdGhvc2UgdHlwZXMg\nKG9yIGFkZCB0aGUgdHlwZSBuYW1lcyB0byB0aGUKICAgICAqIDxjb2RlPmZp\neGVkU2l6ZVR5cGVOYW1lU2V0PC9jb2RlPikuCiAgICAgKiAKICAgICAqIDxQ\nPlNvbWUgZGF0YWJhc2VzIHN1cHBvcnQgInR5cGUgbW9kaWZpZXJzIiwgZm9y\nIGV4YW1wbGUgdGhlIHVuc2lnbmVkCiAgICAgKiAibW9kaWZpZXIiIGluIE15\nU1FMLiBJbiB0aGVzZSBjYXNlcyB0aGUgc2l6ZSBzaG91bGQgZ28gYmV0d2Vl\nbiB0aGUgdHlwZSAKICAgICAqIGFuZCB0aGUgIm1vZGlmaWVyIiwgaW5zdGVh\nZCBvZiBhZnRlciB0aGUgbW9kaWZpZXIuIEZvciBleGFtcGxlIAogICAgICog\nQ1JFQVRFIHRhYmxlIEZPTyAoIG15aW50IElOVCAoMTApIFVOU0lHTkVEIC4g\nLiAuKSBpbnN0ZWFkIG9mIAogICAgICogQ1JFQVRFIHRhYmxlIEZPTyAoIG15\naW50IElOVCBVTlNJR05FRCAoMTApIC4gLiAuKS4KICAgICAqIFR5cGUgbW9k\naWZpZXJzIHNob3VsZCBiZSBhZGRlZCB0byA8Y29kZT50eXBlTW9kaWZpZXJT\nZXQ8L2NvZGU+IGluIAogICAgICogc3ViY2xhc3Nlcy4gCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgYXBwZW5kU2l6ZShDb2x1bW4gY29sLCBTdHJp\nbmcgdHlwZU5hbWUpIHsKICAgICAgICBpZiAoZml4ZWRTaXplVHlwZU5hbWVT\nZXQuY29udGFpbnModHlwZU5hbWUudG9VcHBlckNhc2UoKSkpCiAgICAgICAg\nICAgIHJldHVybiB0eXBlTmFtZTsKICAgICAgICBpZiAodHlwZU5hbWUuaW5k\nZXhPZignKCcpICE9IC0xKQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7\nCgogICAgICAgIFN0cmluZyBzaXplID0gbnVsbDsKICAgICAgICBpZiAoY29s\nLmdldFNpemUoKSA+IDApIHsKICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBi\ndWYgPSBuZXcgU3RyaW5nQnVpbGRlcigxMCk7CiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIigiKS5hcHBlbmQoY29sLmdldFNpemUoKSk7CiAgICAgICAgICAg\nIGlmIChjb2wuZ2V0RGVjaW1hbERpZ2l0cygpID4gMCkKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBwZW5kKGNvbC5nZXREZWNpbWFsRGln\naXRzKCkpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAg\nICAgIHNpemUgPSBidWYudG9TdHJpbmcoKTsKICAgICAgICB9CgogICAgICAg\nIHJldHVybiBpbnNlcnRTaXplKHR5cGVOYW1lLCBzaXplKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdGhhdCBpbnNlcnRzIGEgc2l6\nZSBjbGF1c2UgZm9yIGEgZ2l2ZW4gU1FMIHR5cGUuIAogICAgICogCiAgICAg\nKiBAc2VlIGFwcGVuZFNpemUKICAgICAqIAogICAgICogQHBhcmFtIHR5cGVO\nYW1lICBUaGUgU1FMIHR5cGUgZS5nLiBJTlQKICAgICAqIEBwYXJhbSBzaXpl\nICAgICAgVGhlIHNpemUgY2xhdXNlIGUuZy4gKDEwKQogICAgICogQHJldHVy\nbiAgICAgICAgICBUaGUgdHlwZU5hbWUgKyBzaXplIGNsYXVzZS4gVXN1YWxs\neSB0aGUgc2l6ZSBjbGF1c2Ugd2lsbAogICAgICogICAgICAgICAgICAgICAg\nICBiZSBhcHBlbmRlZCB0byB0eXBlTmFtZS4gSWYgdGhlIHR5cGVOYW1lIGNv\nbnRhaW5zIGEgCiAgICAgKiAgICAgICAgICAgICAgICAgIG1hcmtlciA6IHsw\nfSBvciBpZiB0eXBlTmFtZSBjb250YWlucyBhIG1vZGlmaWVyIHRoZSAKICAg\nICAqICAgICAgICAgICAgICAgICAgc2l6ZSBjbGF1c2Ugd2lsbCBiZSBpbnNl\ncnRlZCBhcHByb3ByaWF0ZWx5LiAgIAogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RyaW5nIGluc2VydFNpemUoU3RyaW5nIHR5cGVOYW1lLCBTdHJpbmcgc2l6\nZSkgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHNpemUpKSB7\nCiAgICAgICAgICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9mKCJ7MH0i\nKTsKICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZTsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgaW50IGlkeCA9IHR5cGVOYW1lLmluZGV4T2Yo\nInswfSIpOwogICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAgICAg\nLy8gcmVwbGFjZSAnezB9JyB3aXRoIHNpemUKICAgICAgICAgICAgU3RyaW5n\nIHJldCA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAgICAgICAg\nICBpZiAoc2l6ZSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0ID0gcmV0\nICsgc2l6ZTsKICAgICAgICAgICAgaWYgKHR5cGVOYW1lLmxlbmd0aCgpID4g\naWR4ICsgMykKICAgICAgICAgICAgICAgIHJldCA9IHJldCArIHR5cGVOYW1l\nLnN1YnN0cmluZyhpZHggKyAzKTsKICAgICAgICAgICAgcmV0dXJuIHJldDsK\nICAgICAgICB9CiAgICAgICAgaWYgKCF0eXBlTW9kaWZpZXJTZXQuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgIFN0cmluZyBzOwogICAgICAgICAgICBpZHgg\nPSB0eXBlTmFtZS5sZW5ndGgoKTsKICAgICAgICAgICAgaW50IGN1cklkeCA9\nIC0xOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB0eXBlTW9kaWZp\nZXJTZXQuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICBzID0gKFN0cmluZykgaS5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAodHlwZU5hbWUudG9VcHBlckNhc2UoKS5pbmRleE9mKHMpICE9IC0xKSB7\nCiAgICAgICAgICAgICAgICAgICAgY3VySWR4ID0gdHlwZU5hbWUudG9VcHBl\nckNhc2UoKS5pbmRleE9mKHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChj\ndXJJZHggIT0gLTEgJiYgY3VySWR4IDwgaWR4KSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlkeCA9IGN1cklkeDsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYoaWR4ICE9IHR5cGVOYW1lLmxlbmd0aCgpKSB7CiAgICAgICAgICAgICAg\nICBTdHJpbmcgcmV0ID0gdHlwZU5hbWUuc3Vic3RyaW5nKDAsIGlkeCk7CiAg\nICAgICAgICAgICAgICByZXQgPSByZXQgKyBzaXplOwogICAgICAgICAgICAg\nICAgcmV0ID0gcmV0ICsgJyAnICsgdHlwZU5hbWUuc3Vic3RyaW5nKGlkeCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0eXBlTmFtZSArIHNpemU7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8KICAgIC8vIFNlbGVjdHMKICAgIC8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG5hbWUgb2YgdGhlIGpvaW4g\nc3ludGF4IHRvIHVzZTogc3FsOTIsIHRyYWRpdGlvbmFsLCBkYXRhYmFzZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pblN5bnRheChTdHJpbmcg\nc3ludGF4KSB7CiAgICAgICAgaWYgKCJzcWw5MiIuZXF1YWxzKHN5bnRheCkp\nCiAgICAgICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7CiAgICAg\nICAgZWxzZSBpZiAoInRyYWRpdGlvbmFsIi5lcXVhbHMoc3ludGF4KSkKICAg\nICAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9UUkFESVRJT05BTDsKICAg\nICAgICBlbHNlIGlmICgiZGF0YWJhc2UiLmVxdWFscyhzeW50YXgpKQogICAg\nICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwogICAgICAg\nIGVsc2UgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHN5bnRheCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oc3lu\ndGF4KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIFNRTCBzdHJp\nbmcgdG8gYWN0IGFzIGEgcGxhY2Vob2xkZXIgZm9yIHRoZSBnaXZlbiBjb2x1\nbW4uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0UGxhY2Vob2xkZXJW\nYWx1ZVN0cmluZyhDb2x1bW4gY29sKSB7CiAgICAgICAgc3dpdGNoIChjb2wu\nZ2V0VHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklHSU5UOgog\nICAgICAgICAgICBjYXNlIFR5cGVzLkJJVDoKICAgICAgICAgICAgY2FzZSBU\neXBlcy5JTlRFR0VSOgogICAgICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuU01BTExJTlQ6CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuVElOWUlOVDoKICAgICAgICAgICAgICAgIHJldHVybiAi\nMCI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0hBUjoKICAgICAgICAgICAg\nICAgIHJldHVybiAoc3RvcmVDaGFyc0FzTnVtYmVycykgPyAiMCIgOiAiJyAn\nIjsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAgICAgICBj\nYXNlIFR5cGVzLkxPTkdWQVJDSEFSOgogICAgICAgICAgICBjYXNlIFR5cGVz\nLlZBUkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gIicnIjsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJu\nIFpFUk9fREFURV9TVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuREVDSU1B\nTDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVB\nTDoKICAgICAgICAgICAgICAgIHJldHVybiAiMC4wIjsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIFpFUk9f\nVElNRV9TVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElNRVNUQU1QOgog\nICAgICAgICAgICAgICAgcmV0dXJuIFpFUk9fVElNRVNUQU1QX1NUUjsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAiTlVM\nTCI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nU0VMRUNUIENPVU5UIHN0YXRlbWVudCBpbiB0aGUgcHJvcGVyIGpvaW4gc3lu\ndGF4IGZvciB0aGUKICAgICAqIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0Q291bnQoU2VsZWN0IHNlbCkg\newogICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVy\nKHRoaXMpOwogICAgICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAgIHNlbC5h\nZGRKb2luQ2xhc3NDb25kaXRpb25zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRG\ncm9tU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGdldEZy\nb21TZWxlY3Qoc2VsLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBmcm9tID0gZ2V0RnJvbShzZWwsIGZhbHNlKTsKICAgICAgICBTUUxCdWZm\nZXIgd2hlcmUgPSBnZXRXaGVyZShzZWwsIGZhbHNlKTsKCiAgICAgICAgLy8g\naWYgbm8gZ3JvdXBpbmcgYW5kIG5vIHJhbmdlLCB3ZSBtaWdodCBiZSBhYmxl\nIHRvIGdldCBieSB3aXRob3V0CiAgICAgICAgLy8gYSBzdWJzZWxlY3QKICAg\nICAgICBpZiAoc2VsLmdldEdyb3VwaW5nKCkgPT0gbnVsbCAmJiBzZWwuZ2V0\nU3RhcnRJbmRleCgpID09IDAKICAgICAgICAgICAgJiYgc2VsLmdldEVuZElu\nZGV4KCkgPT0gTG9uZy5NQVhfVkFMVUUpIHsKICAgICAgICAgICAgLy8gaWYg\ndGhlIHNlbGVjdCBoYXMgbm8gaWRlbnRpZmllciBjb2xzLCB1c2UgQ09VTlQo\nKikKICAgICAgICAgICAgTGlzdCBhbGlhc2VzID0gKCFzZWwuaXNEaXN0aW5j\ndCgpKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QKICAgICAgICAgICAgICAg\nIDogc2VsLmdldElkZW50aWZpZXJBbGlhc2VzKCk7CiAgICAgICAgICAgIGlm\nICh1c2VXaWxkQ2FyZEZvckNvdW50IHx8IGFsaWFzZXMuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVCgqKSIp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwg\nbnVsbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAg\nICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGEg\nc2luZ2xlIGRpc3RpbmN0IGNvbCwgdXNlIENPVU5UKERJU1RJTkNUIGNvbCkK\nICAgICAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpID09IDEpIHsKICAgICAg\nICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKERJU1RJTkNUICIp\nLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChhbGlhc2VzLmdldCgwKS50\nb1N0cmluZygpKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxs\nLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxz\nZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBjYW4gd2UgY29tYmluZSBkaXN0aW5jdCBjb2xzPwogICAgICAg\nICAgICBpZiAoZGlzdGluY3RDb3VudENvbHVtblNlcGFyYXRvciAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVChE\nSVNUSU5DVCAiKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYWxpYXNlcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgICAg\nIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RT\nUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVj\ndFNRTC5hcHBlbmQoZGlzdGluY3RDb3VudENvbHVtblNlcGFyYXRvcik7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiAiKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZChhbGlhc2VzLmdldChpKS50b1N0cmluZygpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBl\nbmQoIikiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxl\nY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxsLCBudWxsLCBudWxsLAog\nICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhf\nVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBz\naW5jZSB3ZSBjYW4ndCBjb21iaW5lIGRpc3RpbmN0IGNvbHMsIHdlIGhhdmUg\ndG8gcGVyZm9ybSBhbiBvdXRlcgogICAgICAgIC8vIENPVU5UKCopIHNlbGVj\ndCB1c2luZyB0aGUgb3JpZ2luYWwgc2VsZWN0IGFzIGEgc3Vic2VsZWN0IGlu\nIHRoZQogICAgICAgIC8vIEZST00gY2xhdXNlCiAgICAgICAgYXNzZXJ0U3Vw\ncG9ydChzdXBwb3J0c1N1YnNlbGVjdCwgIlN1cHBvcnRzU3Vic2VsZWN0Iik7\nCgogICAgICAgIFNRTEJ1ZmZlciBzdWJTZWxlY3QgPSBnZXRTZWxlY3RzKHNl\nbCwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIFNRTEJ1ZmZlciBzdWJGcm9tID0g\nZnJvbTsKICAgICAgICBmcm9tID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAg\nICAgICBmcm9tLmFwcGVuZCgiKCIpOwogICAgICAgIGZyb20uYXBwZW5kKHRv\nU2VsZWN0KHN1YlNlbGVjdCwgbnVsbCwgc3ViRnJvbSwgd2hlcmUsCiAgICAg\nICAgICAgIHNlbC5nZXRHcm91cGluZygpLCBzZWwuZ2V0SGF2aW5nKCksIG51\nbGwsIHNlbC5pc0Rpc3RpbmN0KCksCiAgICAgICAgICAgIGZhbHNlLCBzZWwu\nZ2V0U3RhcnRJbmRleCgpLCBzZWwuZ2V0RW5kSW5kZXgoKSwgdHJ1ZSwgc2Vs\nKSk7CiAgICAgICAgZnJvbS5hcHBlbmQoIikiKTsKICAgICAgICBpZiAocmVx\ndWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAgZnJvbS5hcHBl\nbmQoIiAiKS5hcHBlbmQoU2VsZWN0LkZST01fU0VMRUNUX0FMSUFTKTsKCiAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoKikiKTsKICAgICAgICBy\nZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9tLCBudWxsLCBu\ndWxsLCBudWxsLCBudWxsLAogICAgICAgICAgICBmYWxzZSwgZmFsc2UsIDAs\nIExvbmcuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIERFTEVURSBzdGF0ZW1lbnQgZm9yIHRoZSBzcGVjaWZpZWQgU2VsZWN0\nLiBJZiB0aGUKICAgICAqIGRhdGFiYXNlIGRvZXMgbm90IHN1cHBvcnQgdGhl\nIGJ1bGsgZGVsZXRlIHN0YXRlbWVudCAoc3VjaCBhcwogICAgICogY2FzZXMg\nd2hlcmUgYSBzdWJzZWxlY3QgaXMgcmVxdWlyZWQgYW5kIHRoZSBkYXRhYmFz\nZSBkb2Vzbid0IHN1cHBvcnQKICAgICAqIHN1YnNlbGVjdHMpLCB0aGlzIG1l\ndGhvZCBzaG91bGQgcmV0dXJuIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBT\nUUxCdWZmZXIgdG9EZWxldGUoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFNlbGVj\ndCBzZWwsIAogICAgICAgIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJl\ndHVybiB0b0J1bGtPcGVyYXRpb24obWFwcGluZywgc2VsLCBudWxsLCBwYXJh\nbXMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9VcGRh\ndGUoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFNlbGVjdCBzZWwsCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVz\nKSB7CiAgICAgICAgcmV0dXJuIHRvQnVsa09wZXJhdGlvbihtYXBwaW5nLCBz\nZWwsIHN0b3JlLCBwYXJhbXMsIHVwZGF0ZXMpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgU1FMIGZvciBhIGJ1bGsgb3BlcmF0aW9uLCBl\naXRoZXIgYSBERUxFVEUgb3IgYW4gVVBEQVRFLgogICAgICoKICAgICAqIEBw\nYXJhbSBtYXBwaW5nIHRoZSBtYXBwaW5nIGFnYWluc3Qgd2hpY2ggd2UgYXJl\nIG9wZXJhdGluZwogICAgICogQHBhcmFtIHNlbCB0aGUgU2VsZWN0IHRoYXQg\nd2lsbCBjb25zdGl0dXRlIHRoZSBXSEVSRSBjbGF1c2UKICAgICAqIEBwYXJh\nbSBzdG9yZSB0aGUgY3VycmVudCBzdG9yZQogICAgICogQHBhcmFtIHVwZGF0\nZVBhcmFtcyB0aGUgTWFwIHRoYXQgaG9sZHMgdGhlIHVwZGF0ZSBwYXJhbWV0\nZXJzOyBhIG51bGwKICAgICAqIHZhbHVlIGluZGljYXRlcyB0aGF0IHRoaXMg\naXMgYSBkZWxldGUgb3BlcmF0aW9uCiAgICAgKiBAcmV0dXJuIHRoZSBTUUxC\ndWZmZXIgZm9yIHRoZSB1cGRhdGUsIG9yIDxlbT5udWxsPC9lbT4gaWYgaXQg\naXMgbm90CiAgICAgKiBwb3NzaWJsZSB0byBwZXJmb3JtIHRoZSBidWxrIHVw\nZGF0ZQogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIHRvQnVsa09w\nZXJhdGlvbihDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNlbCwKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVjdFtdIHBhcmFtcywgTWFwIHVw\nZGF0ZVBhcmFtcykgewogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBuZXcgU1FM\nQnVmZmVyKHRoaXMpOwogICAgICAgIGlmICh1cGRhdGVQYXJhbXMgPT0gbnVs\nbCkgewogICAgICAgICAgaWYgKHJlcXVpcmVzVGFyZ2V0Rm9yRGVsZXRlKSB7\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIkRFTEVURSAiKTsKICAgICAgICAg\nICAgU1FMQnVmZmVyIGRlbGV0ZVRhcmdldHMgPSBnZXREZWxldGVUYXJnZXRz\nKHNlbCk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoZGVsZXRlVGFyZ2V0cyk7\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBGUk9NICIpOwogICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgc3FsLmFwcGVuZCgiREVMRVRFIEZST00g\nIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3FsLmFwcGVuZCgiVVBEQVRFICIpOwogICAgICAgIHNlbC5hZGRK\nb2luQ2xhc3NDb25kaXRpb25zKCk7CgogICAgICAgIC8vIGlmIHRoZXJlIGlz\nIG9ubHkgYSBzaW5nbGUgdGFibGUgaW4gdGhlIHNlbGVjdCwgdGhlbiB3ZSBj\nYW4KICAgICAgICAvLyBqdXN0IGlzc3VlIGEgc2luZ2xlIERFTEVURSBGUk9N\nIFRBQkxFIFdIRVJFIDxjb25kaXRpb25zPgogICAgICAgIC8vIHN0YXRlbWVu\ndDsgb3RoZXJ3aXNlLCBzaW5jZSBTUUwgZG9lc24ndCBhbGxvdyBkZWxldGlu\nZwogICAgICAgIC8vIGZyb20gb25lIG9mIGEgbXVsdGktdGFibGUgc2VsZWN0\nLCB3ZSBuZWVkIHRvIGlzc3VlIGEgc3Vic2VsZWN0CiAgICAgICAgLy8gbGlr\nZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSBFWElTVFMKICAgICAgICAvLyAo\nU0VMRUNUIDEgRlJPTSBUQUJMRSB0MCBXSEVSRSB0MC5JRCA9IFRBQkxFLklE\nKTsgYWxzbywgc29tZQogICAgICAgIC8vIGRhdGFiYXNlcyBkbyBub3QgYWxs\nb3cgYWxpYXNlcyBpbiBkZWxldGUgc3RhdGVtZW50cywgd2hpY2gKICAgICAg\nICAvLyBhbHNvIGNhdXNlcyB1cyB0byB1c2UgYSBzdWJzZWxlY3QKICAgICAg\nICBDb2xsZWN0aW9uPFN0cmluZz4gc2VsZWN0ZWRUYWJsZXMgPSBnZXRTZWxl\nY3RUYWJsZUFsaWFzZXMoc2VsKTsKICAgICAgICBpZiAoc2VsZWN0ZWRUYWJs\nZXMuc2l6ZSgpID09IDEgJiYgc3VwcG9ydHNTdWJzZWxlY3QKICAgICAgICAg\nICAgJiYgYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpIHsKICAgICAgICAgICAg\nU1FMQnVmZmVyIGZyb207CiAgICAgICAgICAgIGlmIChzZWwuZ2V0RnJvbVNl\nbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBmcm9tID0gZ2V0RnJv\nbVNlbGVjdChzZWwsIGZhbHNlKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgZnJvbSA9IGdldEZyb20oc2VsLCBmYWxzZSk7CgogICAgICAg\nICAgICBzcWwuYXBwZW5kKGZyb20pOwogICAgICAgICAgICBhcHBlbmRVcGRh\ndGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsCiAg\nICAgICAgICAgICAgICBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSk7CgogICAg\nICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBzZWwuZ2V0V2hlcmUoKTsKICAg\nICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwgJiYgIXdoZXJlLmlzRW1wdHko\nKSkgewogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFICIpOwog\nICAgICAgICAgICAgICAgc3FsLmFwcGVuZCh3aGVyZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIHNxbDsKICAgICAgICB9CgogICAgICAg\nIFRhYmxlIHRhYmxlID0gbWFwcGluZy5nZXRUYWJsZSgpOwogICAgICAgIFN0\ncmluZyB0YWJsZU5hbWUgPSBnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpOwoK\nICAgICAgICAvLyBvbmx5IHVzZSBhICBzdWJzZWxlY3QgaWYgdGhlIHdoZXJl\nIGlzIG5vdCBlbXB0eTsgb3RoZXJ3aXNlCiAgICAgICAgLy8gYW4gdW5xdWFs\naWZpZWQgZGVsZXRlIG9yIHVwZGF0ZSB3aWxsIHdvcmsKICAgICAgICBpZiAo\nc2VsLmdldFdoZXJlKCkgPT0gbnVsbCB8fCBzZWwuZ2V0V2hlcmUoKS5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUpOwog\nICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFy\nYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJu\nIHNxbDsKICAgICAgICB9CgogICAgICAgIC8vIHdlIG5lZWQgdG8gdXNlIGEg\nc3Vic2VsZWN0IGlmIHdlIGFyZSB0byBidWxrIGRlbGV0ZSB3aGVyZQogICAg\nICAgIC8vIHRoZSBzZWxlY3QgaW5jbHVkZXMgbXVsdGlwbGUgdGFibGVzOyBp\nZiB0aGUgZGF0YWJhc2UKICAgICAgICAvLyBkb2Vzbid0IHN1cHBvcnQgaXQs\nIHRoZW4gd2UgbmVlZCB0byBzaWduYWwgdGhpcyBieSByZXR1cm5pbmcgbnVs\nbAogICAgICAgIGlmICghc3VwcG9ydHNTdWJzZWxlY3QgfHwgIXN1cHBvcnRz\nQ29ycmVsYXRlZFN1YnNlbGVjdCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENvbHVtbltdIHBrcyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICBzZWwuY2xlYXJTZWxlY3RzKCk7CiAgICAg\nICAgc2VsLnNldERpc3RpbmN0KHRydWUpOwoKICAgICAgICAvLyBpZiB3ZSBo\nYXZlIG9ubHkgYSBzaW5nbGUgUEssIHdlIGNhbiB1c2UgYSBub24tY29ycmVs\nYXRlZAogICAgICAgIC8vIHN1YnF1ZXJ5ICh1c2luZyBhbiBJTiBzdGF0ZW1l\nbnQpLCB3aGljaCBpcyBtdWNoIGZhc3RlciB0aGFuCiAgICAgICAgLy8gYSBj\nb3JyZWxhdGVkIHN1YnF1ZXJ5IChzaW5jZSBhIGNvcnJlbGF0ZWQgc3VicXVl\ncnkgbmVlZHMKICAgICAgICAvLyB0byBiZSBleGVjdXRlZCBvbmNlIGZvciBl\nYWNoIHJvdyBpbiB0aGUgdGFibGUpCiAgICAgICAgaWYgKHBrcy5sZW5ndGgg\nPT0gMSkgewogICAgICAgICAgICBzZWwuc2VsZWN0KHBrc1swXSk7CiAgICAg\nICAgICAgIHNxbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICAgICAgYXBw\nZW5kVXBkYXRlcyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFy\nYW1zLCBmYWxzZSk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBXSEVSRSAi\nKS4KICAgICAgICAgICAgICAgIGFwcGVuZChwa3NbMF0pLmFwcGVuZCgiIElO\nICgiKS4KICAgICAgICAgICAgICAgIGFwcGVuZChzZWwudG9TZWxlY3QoZmFs\nc2UsIG51bGwpKS5hcHBlbmQoIikiKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBzZWwuY2xlYXJTZWxlY3RzKCk7CiAgICAgICAgICAgIHNlbC5z\nZXREaXN0aW5jdChmYWxzZSk7CgogICAgICAgICAgICAvLyBzaW5jZSB0aGUg\nc2VsZWN0IGlzIHVzaW5nIGEgY29ycmVsYXRlZCBzdWJxdWVyeSwgd2UKICAg\nICAgICAgICAgLy8gb25seSBuZWVkIHRvIHNlbGVjdCBhIGJvZ3VzIHZpcnR1\nYWwgY29sdW1uCiAgICAgICAgICAgIHNlbC5zZWxlY3QoIjEiLCBudWxsKTsK\nCiAgICAgICAgICAgIC8vIGFkZCBpbiB0aGUgam9pbnMgdG8gdGhlIHRhYmxl\nCiAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRQcmltYXJ5\nS2V5KCkuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICBTUUxCdWZmZXIgYnVm\nID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiKCIpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpID4gMCkKICAg\nICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwoKICAgICAg\nICAgICAgICAgIC8vIGFkZCBpbiAidDAuUEsgPSBNWVRBQkxFLlBLIgogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29s\nc1tpXSkpLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgICAgICAgICAgYXBw\nZW5kKHRhYmxlKS5hcHBlbmQoY2F0YWxvZ1NlcGFyYXRvcikuYXBwZW5kKGNv\nbHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIikiKTsKICAgICAgICAgICAgc2VsLndoZXJlKGJ1ZiwgbnVsbCk7CgogICAg\nICAgICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFw\ncGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBh\ncmFtcywgZmFsc2UpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUg\nRVhJU1RTICgiKS4KICAgICAgICAgICAgICAgIGFwcGVuZChzZWwudG9TZWxl\nY3QoZmFsc2UsIG51bGwpKS5hcHBlbmQoIikiKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHNxbDsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIENvbGxl\nY3Rpb248U3RyaW5nPiBnZXRTZWxlY3RUYWJsZUFsaWFzZXMoU2VsZWN0IHNl\nbCkgewogICAgICAgIHJldHVybiBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXREZWxldGVUYXJnZXRz\nKFNlbGVjdCBzZWwpIHsKICAgICAgU1FMQnVmZmVyIGRlbGV0ZVRhcmdldHMg\nPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICBDb2xsZWN0aW9uPFN0cmlu\nZz4gYWxpYXNlcyA9IHNlbC5nZXRUYWJsZUFsaWFzZXMoKTsKICAgICAgLy8g\nQXNzdW1lcyBhbGlhc2VzIGFyZSBvZiB0aGUgZm9ybSAiVEFCTEVOQU1FIHQw\nIgogICAgICAvLyBvciAiXCJUQUJMRSBOQU1FXCIgdDAiCiAgICAgIGZvciAo\nSXRlcmF0b3I8U3RyaW5nPiBpdHIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgU3RyaW5nIHRhYmxlQWxpYXMgPSBp\ndHIubmV4dCgpOwogICAgICAgIFN0cmluZ1tdIG5hbWVzID0gTm9ybWFsaXpl\nci5zcGxpdE5hbWUodGFibGVBbGlhcywgSWRlbnRpZmllclV0aWwuU1BBQ0Up\nOwogICAgICAgIGlmIChuYW1lcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBp\nZiAoYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpIHsKICAgICAgICAgICAgZGVs\nZXRlVGFyZ2V0cy5hcHBlbmQobmFtZXNbMV0pOwogICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBlbmQodG9EQk5hbWUo\nREJJZGVudGlmaWVyLm5ld1RhYmxlKG5hbWVzWzBdKSkpOwogICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWxldGVUYXJnZXRzLmFw\ncGVuZCh0b0RCTmFtZShEQklkZW50aWZpZXIubmV3VGFibGUodGFibGVBbGlh\ncykpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAg\nICAgICAgICBkZWxldGVUYXJnZXRzLmFwcGVuZCgiLCAiKTsKICAgICAgfSAg\nICAgIAogICAgICByZXR1cm4gZGVsZXRlVGFyZ2V0czsgICAgICAKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRVcGRhdGVzKFNlbGVjdCBzZWws\nIEpEQkNTdG9yZSBzdG9yZSwgU1FMQnVmZmVyIHNxbCwKICAgICAgICBPYmpl\nY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVQYXJhbXMsIGJvb2xlYW4gYWxsb3dB\nbGlhcykgewogICAgICAgIGlmICh1cGRhdGVQYXJhbXMgPT0gbnVsbCB8fCB1\ncGRhdGVQYXJhbXMuc2l6ZSgpID09IDApCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gbWFudWFsbHkgYnVpbGQgdXAgdGhlIFNFVCBjbGF1c2Ug\nZm9yIHRoZSBVUERBVEUgc3RhdGVtZW50CiAgICAgICAgc3FsLmFwcGVuZCgi\nIFNFVCAiKTsKICAgICAgICBFeHBDb250ZXh0IGN0eCA9IG5ldyBFeHBDb250\nZXh0KHN0b3JlLCBwYXJhbXMsIAogICAgICAgICAgICBzdG9yZS5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKSk7CgogICAgICAgIC8vIElmIHRoZSB1cGRhdGVz\nIG1hcCBjb250YWlucyBhbnkgdmVyc2lvbiBmaWVsZHMsIGFzc3VtZSB0aGF0\nIHRoZQogICAgICAgIC8vIG9wdGltaXN0aWMgbG9jayB2ZXJzaW9uIGRhdGEg\naXMgYmVpbmcgaGFuZGxlZCBwcm9wZXJseSBieSB0aGUKICAgICAgICAvLyBj\nYWxsZXIuIE90aGVyd2lzZSwgZ2l2ZSB0aGUgdmVyc2lvbiBpbmRpY2F0b3Ig\nYW4gb3Bwb3J0dW5pdHkgdG8KICAgICAgICAvLyBhZGQgbW9yZSB1cGRhdGUg\nY2xhdXNlcyBhcyBuZWVkZWQuCiAgICAgICAgYm9vbGVhbiBhdWdtZW50VXBk\nYXRlcyA9IHRydWU7CgogICAgICAgIGZvciAoSXRlcmF0b3IgaSA9IHVwZGF0\nZVBhcmFtcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBNYXAuRW50cnkgbmV4dCA9IChNYXAuRW50cnkpIGku\nbmV4dCgpOwogICAgICAgICAgICBQYXRoIHBhdGggPSAoUGF0aCkgbmV4dC5n\nZXRLZXkoKTsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtZCA9IChGaWVs\nZE1hcHBpbmcpIHBhdGgubGFzdCgpOwoKICAgICAgICAgICAgaWYgKGZtZC5p\nc1ZlcnNpb24oKSkKICAgICAgICAgICAgICAgIGF1Z21lbnRVcGRhdGVzID0g\nZmFsc2U7CgogICAgICAgICAgICBWYWwgdmFsID0gKFZhbCkgbmV4dC5nZXRW\nYWx1ZSgpOwogICAgICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgICAgICB2YWwgPSBuZXcgTnVsbCgpOwogICAgICAgICAgICBDb2x1bW4g\nY29sID0gZm1kLmdldENvbHVtbnMoKVswXTsKICAgICAgICAgICAgaWYgKGFs\nbG93QWxpYXMpIHsKICAgICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRD\nb2x1bW5BbGlhcyhjb2wpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICBzcWwuYXBwZW5kKHRvREJOYW1lKGNvbC5nZXRJZGVudGlmaWVy\nKCkpKTsKICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAgICAgICBz\ncWwuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIEV4cFN0YXRlIHN0YXRl\nID0gdmFsLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwogICAgICAgICAgICAv\nLyBKREJDIFBhdGhzIGFyZSBhbHdheXMgUENQYXRoczsgUENQYXRoIGltcGxl\nbWVudHMgVmFsCiAgICAgICAgICAgIEV4cFN0YXRlIHBhdGhTdGF0ZSA9ICgo\nVmFsKSBwYXRoKS5pbml0aWFsaXplKHNlbCwgY3R4LCAwKTsKICAgICAgICAg\nICAgY2FsY3VsYXRlVmFsdWUodmFsLCBzZWwsIGN0eCwgc3RhdGUsIHBhdGgs\nIHBhdGhTdGF0ZSk7CgogICAgICAgICAgICAvLyBhcHBlbmQgdGhlIHZhbHVl\nIHdpdGggYSBudWxsIGZvciB0aGUgU2VsZWN0OyBpCiAgICAgICAgICAgIC8v\nIGluZGljYXRlcyB0aGF0IHRoZQogICAgICAgICAgICBpbnQgbGVuZ3RoID0g\ndmFsLmxlbmd0aChzZWwsIGN0eCwgc3RhdGUpOwogICAgICAgICAgICBmb3Ig\nKGludCBqID0gMDsgaiA8IGxlbmd0aDsgaisrKQogICAgICAgICAgICAgICAg\ndmFsLmFwcGVuZFRvKChhbGxvd0FsaWFzKSA/IHNlbCA6IG51bGwsIGN0eCwg\nc3RhdGUsIHNxbCwgaik7CgogICAgICAgICAgICBpZiAoaS5oYXNOZXh0KCkp\nCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIsICIpOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKGF1Z21lbnRVcGRhdGVzKSB7CiAgICAgICAgICAgIFBh\ndGggcGF0aCA9IChQYXRoKSB1cGRhdGVQYXJhbXMua2V5U2V0KCkuaXRlcmF0\nb3IoKS5uZXh0KCk7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChG\naWVsZE1hcHBpbmcpIHBhdGgubGFzdCgpOwogICAgICAgICAgICBDbGFzc01h\ncHBpbmcgbWV0YSA9IGZtLmdldERlY2xhcmluZ01hcHBpbmcoKTsKICAgICAg\nICAgICAgTWFwIHVwZGF0ZXMgPSBtZXRhLmdldFZlcnNpb24oKS5nZXRCdWxr\nVXBkYXRlVmFsdWVzKCk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRl\nciA9IHVwZGF0ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAg\nICAgICAgaXRlci5oYXNOZXh0KCk7ICkgewogICAgICAgICAgICAgICAgTWFw\nLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBpdGVyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIENvbHVtbiBjb2wgPSAoQ29sdW1uKSBlLmdldEtleSgpOwogICAg\nICAgICAgICAgICAgU3RyaW5nIHZhbCA9IChTdHJpbmcpIGUuZ2V0VmFsdWUo\nKTsKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIikuYXBwZW5kKHRv\nREJOYW1lKGNvbC5nZXRJZGVudGlmaWVyKCkpKQogICAgICAgICAgICAgICAg\nICAgIC5hcHBlbmQoIiA9ICIpLmFwcGVuZCh2YWwpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBT\nUUwgdG8gZGVsZXRlIHRoZSBjb250ZW50cyBvZiB0aGUgc3BlY2lmaWVkIHRh\nYmxlcy4gCiAgICAgKiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBkcm9w\ncyBhbGwgbm9uLWRlZmVycmVkIFJFU1RSSUNUIGZvcmVpZ24ga2V5IAogICAg\nICogY29uc3RyYWludHMgaW52b2x2aW5nIHRoZSBzcGVjaWZpZWQgdGFibGVz\nLCBpc3N1ZXMgREVMRVRFIHN0YXRlbWVudHMgCiAgICAgKiBhZ2FpbnN0IHRo\nZSB0YWJsZXMsIGFuZCB0aGVuIGFkZHMgdGhlIGRyb3BwZWQgY29uc3RyYWlu\ndHMgYmFjayBpbi4gCiAgICAgKiBEYXRhYmFzZXMgd2l0aCBtb3JlIG9wdGlt\nYWwgd2F5cyBvZiBkZWxldGluZyB0aGUgY29udGVudHMgb2Ygc2V2ZXJhbCAK\nICAgICAqIHRhYmxlcyBzaG91bGQgb3ZlcnJpZGUgdGhpcyBtZXRob2QuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREZWxldGVUYWJsZUNvbnRl\nbnRzU1FMKFRhYmxlW10gdGFibGVzLENvbm5lY3Rpb24gY29ubikgewogICAg\nICAgIENvbGxlY3Rpb248U3RyaW5nPiBzcWwgPSBuZXcgQXJyYXlMaXN0PFN0\ncmluZz4oKTsKICAgICAgICAKICAgICAgICAvLyBjb2xsZWN0IGFuZCBkcm9w\nIG5vbi1kZWZlcnJlZCBwaHlzaWNhbCByZXN0cmljdCBjb25zdHJhaW50cywg\nYW5kCiAgICAgICAgLy8gY29sbGVjdCB0aGUgREVMRVRFIEZST00gc3RhdGVt\nZW50cwogICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiBkZWxldGVTUUwgPSBu\nZXcgQXJyYXlMaXN0PFN0cmluZz4odGFibGVzLmxlbmd0aCk7CiAgICAgICAg\nQ29sbGVjdGlvbjxGb3JlaWduS2V5PiByZXN0cmljdENvbnN0cmFpbnRzID0K\nICAgICAgICAgICAgbmV3IExpbmtlZEhhc2hTZXQ8Rm9yZWlnbktleT4oKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRhYmxlcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gdGFibGVzW2ld\nLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAw\nOyBqIDwgZmtzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIWZrc1tqXS5pc0xvZ2ljYWwoKSAmJiAhZmtzW2pdLmlzRGVmZXJyZWQoKSAK\nICAgICAgICAgICAgICAgICAgICAmJiBma3Nbal0uZ2V0RGVsZXRlQWN0aW9u\nKCkgPT0gRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1QpCiAgICAgICAgICAg\nICAgICByZXN0cmljdENvbnN0cmFpbnRzLmFkZChma3Nbal0pOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBkZWxldGVTUUwuYWRk\nKCJERUxFVEUgRlJPTSAiICsgCiAgICAgICAgICAgICAgICB0b0RCTmFtZSh0\nYWJsZXNbaV0uZ2V0RnVsbElkZW50aWZpZXIoKSkpOwogICAgICAgIH0KICAg\nICAgICAKICAgICAgICBmb3IoRm9yZWlnbktleSBmayA6IHJlc3RyaWN0Q29u\nc3RyYWludHMpIHsKICAgICAgICAgICAgU3RyaW5nW10gY29uc3RyYWludFNR\nTCA9IGdldERyb3BGb3JlaWduS2V5U1FMKGZrLGNvbm4pOwogICAgICAgICAg\nICBzcWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29uc3RyYWludFNRTCkpOwog\nICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBhZGQgdGhlIGRlbGV0ZSBz\ndGF0ZW1lbnRzIGFmdGVyIGFsbCB0aGUgY29uc3RyYWludCBtdXRhdGlvbnMK\nICAgICAgICBzcWwuYWRkQWxsKGRlbGV0ZVNRTCk7CiAgICAgICAgCiAgICAg\nICAgLy8gYWRkIHRoZSBkZWxldGVkIGNvbnN0cmFpbnRzIGJhY2sgdG8gdGhl\nIHNjaGVtYQogICAgICAgIGZvciAoRm9yZWlnbktleSBmayA6IHJlc3RyaWN0\nQ29uc3RyYWludHMpIHsKICAgICAgICAgICAgU3RyaW5nW10gY29uc3RyYWlu\ndFNRTCA9IGdldEFkZEZvcmVpZ25LZXlTUUwoZmspOwogICAgICAgICAgICBz\ncWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29uc3RyYWludFNRTCkpOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKFN0cmluZ1tdKSBzcWwu\ndG9BcnJheShuZXcgU3RyaW5nW3NxbC5zaXplKCldKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBzdGF0ZW1lbnQgaW4gdGhlIHBy\nb3BlciBqb2luIHN5bnRheCBmb3IgdGhlIGdpdmVuCiAgICAgKiBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTZWxl\nY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSwKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgc2VsLmFkZEpvaW5DbGFz\nc0NvbmRpdGlvbnMoKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9IGZvclVw\nZGF0ZSAmJiBzZWwuZ2V0RnJvbVNlbGVjdCgpID09IG51bGw7CiAgICAgICAg\nU1FMQnVmZmVyIHNlbGVjdCA9IGdldFNlbGVjdHMoc2VsLCBmYWxzZSwgdXBk\nYXRlKTsKICAgICAgICBTUUxCdWZmZXIgb3JkZXJpbmcgPSBudWxsOwogICAg\nICAgIGlmICghc2VsLmlzQWdncmVnYXRlKCkgfHwgc2VsLmdldEdyb3VwaW5n\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgb3JkZXJpbmcgPSBzZWwuZ2V0T3Jk\nZXJpbmcoKTsKICAgICAgICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICBpZiAo\nc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxsKQogICAgICAgICAgICBmcm9t\nID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZvclVwZGF0ZSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBmcm9tID0gZ2V0RnJvbShzZWwsIHVwZGF0ZSk7CiAg\nICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0V2hlcmUoc2VsLCB1cGRhdGUp\nOwogICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3QsIGZldGNoLCBmcm9t\nLCB3aGVyZSwgc2VsLmdldEdyb3VwaW5nKCksCiAgICAgICAgICAgIHNlbC5n\nZXRIYXZpbmcoKSwgb3JkZXJpbmcsIHNlbC5pc0Rpc3RpbmN0KCksIGZvclVw\nZGF0ZSwKICAgICAgICAgICAgc2VsLmdldFN0YXJ0SW5kZXgoKSwgc2VsLmdl\ndEVuZEluZGV4KCksIHNlbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0d2Vl\nbiB0aGUgRlJPTSBrZXl3b3JkCiAgICAgKiBhbmQgdGhlIFdIRVJFIGtleXdv\ncmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgZ2V0RnJvbShT\nZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIFNRTEJ1\nZmZlciBmcm9tU1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBD\nb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAg\nICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpIDwgMiB8fCBzZWwuZ2V0Sm9pblN5\nbnRheCgpICE9IFNZTlRBWF9TUUw5MikgewogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGFsaWFzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGZyb21TUUwuYXBwZW5kKGl0ci5uZXh0\nKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm9yVXBkYXRl\nICYmIHRhYmxlRm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JV\ncGRhdGVDbGF1c2UpOwogICAgICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0\nKCkpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiwgIik7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgp\nIDwgMiAmJiBzZWwuZ2V0UGFyZW50KCkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgLy8gc3VicXVlcnkgbWF5IGNvbnRhaW4gY29ycmVsYXRlZCBqb2lu\ncwogICAgICAgICAgICAgICAgSXRlcmF0b3IgaXRyID0gc2VsLmdldEpvaW5J\ndGVyYXRvcigpOwogICAgICAgICAgICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBKb2luIGpvaW4gPSAoSm9pbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICAvLyBhcHBlbmQgd2hl\ncmUgY2xhdXNlCiAgICAgICAgICAgICAgICAgICAgaWYgKGpvaW4uaXNDb3Jy\nZWxhdGVkKCkgJiYgam9pbi5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBuZXcg\nU1FMQnVmZmVyKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICB3aGVy\nZS5hcHBlbmQoIigiKS5hcHBlbmQodG9UcmFkaXRpb25hbEpvaW4oam9pbikp\nLmFwcGVuZCgiKSIpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWwud2hl\ncmUod2hlcmUuZ2V0U1FMKCkpOwogICAgICAgICAgICAgICAgICAgIH0gICAg\nICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBJdGVyYXRvciBpdHIgPSBz\nZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGJvb2xlYW4gZmly\nc3QgPSB0cnVlOwogICAgICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkg\newogICAgICAgICAgICAgICAgSm9pbiBqb2luID0gKEpvaW4pIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBpZiAoY29ycmVsYXRlZEpvaW5Db25kaXRp\nb24oam9pbiwgc2VsKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgICAgICBpZiAoam9pbi5pc0NvcnJlbGF0ZWQoKSkKICAg\nICAgICAgICAgICAgICAgICB0b0NvcnJlbGF0ZWRKb2luKHNlbCwgam9pbiwg\nZm9yVXBkYXRlLCBmaXJzdCk7ICAgICAgICAgICAgICAgICAgICAKICAgICAg\nICAgICAgICAgIGVsc2UgICAgCiAgICAgICAgICAgICAgICAgICAgZnJvbVNR\nTC5hcHBlbmQodG9TUUw5MkpvaW4oc2VsLCBqb2luLCBmb3JVcGRhdGUsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpcnN0KSk7CiAgICAgICAgICAgICAg\nICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGl0ci5oYXNO\nZXh0KCkgJiYgam9pbi5pc0NvcnJlbGF0ZWQoKSkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChmcm9tU1FMLmdldFNRTCgpLmxlbmd0aCgpID4gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiwgIik7CiAg\nICAgICAgICAgICAgICAgICAgZmlyc3QgPSB0cnVlOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0cjIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7IGl0cjIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxlQWxpYXMgPSBpdHIyLm5l\neHQoKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgaWYgKGZyb21TUUwu\nZ2V0U1FMKCkuaW5kZXhPZih0YWJsZUFsaWFzKSA9PSAtMSkgewogICAgICAg\nICAgICAgICAgICAgIGlmICghZmlyc3QgJiYgZnJvbVNRTC5nZXRTUUwoKS5s\nZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZyb21TUUwu\nYXBwZW5kKCIsICIpOwogICAgICAgICAgICAgICAgICAgIGZyb21TUUwuYXBw\nZW5kKHRhYmxlQWxpYXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3JV\ncGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQo\ndGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAgICAgICAgICAgICAgIGZp\ncnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyb21TUUw7CiAgICB9CgogICAg\ncHJpdmF0ZSBib29sZWFuIGNvcnJlbGF0ZWRKb2luQ29uZGl0aW9uKEpvaW4g\nam9pbiwgU2VsZWN0IHNlbCkgewogICAgICAgIGlmICgham9pbi5pc0NvcnJl\nbGF0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIEl0\nZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsKICAgICAgICBi\nb29sZWFuIHNraXAgPSBmYWxzZTsKICAgICAgICAvL2lmIHRhYmxlMSBpbiBq\nb2luIGlzIGluIHRoZSBtYWluIHF1ZXJ5LCB0YWJsZTIgaXMgaW4KICAgICAg\nICAvL3N1YnF1ZXJ5LCBhbmQgdGFibGUyIHBhcnRpY2lwYXRlcyBpbiBvdGhl\nciBqb2lucwogICAgICAgIC8vaW4gc3VicXVlcnksIHRoZSBqb2luIGNvbmRp\ndGlvbiBjYW4gb25seSBiZSBwbGFjZWQgaW4gCiAgICAgICAgLy90aGUgd2hl\ncmUgY2xhdXNlIGluIHRoZSBzdWJxdWVyeQogICAgICAgIHdoaWxlIChpdHIu\naGFzTmV4dCgpKSB7CiAgICAgICAgICAgIEpvaW4gam9pbjEgPSAoSm9pbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGpvaW4gPT0gam9pbjEgJiYg\nIWpvaW4uaXNGb3JlaWduS2V5SW52ZXJzZWQoKSkgewogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGpv\naW4uZ2V0SW5kZXgyKCkgPT0gam9pbjEuZ2V0SW5kZXgxKCkgfHwKICAgICAg\nICAgICAgICAgIGpvaW4uZ2V0SW5kZXgyKCkgPT0gam9pbjEuZ2V0SW5kZXgy\nKCkpIHsKICAgICAgICAgICAgICAgIHNraXAgPSB0cnVlOwogICAgICAgICAg\nICAgICAgaWYgKGpvaW4uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpewogICAg\nICAgICAgICAgICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxCdWZm\nZXIodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgd2hlcmUuYXBwZW5kKCIo\nIikuYXBwZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKS5hcHBlbmQoIiki\nKTsKICAgICAgICAgICAgICAgICAgICBzZWwud2hlcmUod2hlcmUuZ2V0U1FM\nKCkpOwogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBza2lwOwogICAgfQogICAgCiAgICAKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBGUk9NIGNsYXVzZSBmb3IgYSBzZWxlY3QgdGhhdCBz\nZWxlY3RzIGZyb20gYSB0bXAgdGFibGUKICAgICAqIGNyZWF0ZWQgYnkgYW4g\naW5uZXIgc2VsZWN0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVy\nIGdldEZyb21TZWxlY3QoU2VsZWN0IHNlbCwgYm9vbGVhbiBmb3JVcGRhdGUp\nIHsKICAgICAgICBTUUxCdWZmZXIgZnJvbVNRTCA9IG5ldyBTUUxCdWZmZXIo\ndGhpcyk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQoIigiKTsKICAgICAgICBm\ncm9tU1FMLmFwcGVuZCh0b1NlbGVjdChzZWwuZ2V0RnJvbVNlbGVjdCgpLCBm\nb3JVcGRhdGUsIG51bGwpKTsKICAgICAgICBmcm9tU1FMLmFwcGVuZCgiKSIp\nOwogICAgICAgIGlmIChyZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAg\nICAgICAgICBmcm9tU1FMLmFwcGVuZCgiICIpLmFwcGVuZChTZWxlY3QuRlJP\nTV9TRUxFQ1RfQUxJQVMpOwogICAgICAgIHJldHVybiBmcm9tU1FMOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBXSEVSRSBwb3J0aW9uIG9m\nIHRoZSBzZWxlY3Qgc3RhdGVtZW50LCBvciBudWxsIGlmIG5vIHdoZXJlCiAg\nICAgKiBjb25kaXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVm\nZmVyIGdldFdoZXJlKFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlKSB7\nCiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwuZ2V0Sm9pbnMoKTsKICAgICAg\nICBpZiAoc2VsLmdldEpvaW5TeW50YXgoKSA9PSBTWU5UQVhfU1FMOTIKICAg\nICAgICAgICAgfHwgam9pbnMgPT0gbnVsbCB8fCBqb2lucy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBzZWwuZ2V0V2hlcmUoKTsKCiAgICAgICAg\nU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAg\nICBpZiAoc2VsLmdldFdoZXJlKCkgIT0gbnVsbCkKICAgICAgICAgICAgd2hl\ncmUuYXBwZW5kKHNlbC5nZXRXaGVyZSgpKTsKICAgICAgICBpZiAoam9pbnMg\nIT0gbnVsbCkKICAgICAgICAgICAgc2VsLmFwcGVuZCh3aGVyZSwgam9pbnMp\nOwogICAgICAgIHJldHVybiB3aGVyZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFVzZSB0aGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0byBjcmVhdGUgU1FMIGpv\naW5pbmcgaXRzIHRhYmxlcyBpbgogICAgICogdGhlIHRyYWRpdGlvbmFsIHN0\neWxlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvVHJhZGl0aW9u\nYWxKb2luKEpvaW4gam9pbikgewogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBq\nb2luLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJvb2xlYW4gaW52\nZXJzZSA9IGpvaW4uaXNGb3JlaWduS2V5SW52ZXJzZWQoKTsKICAgICAgICBD\nb2x1bW5bXSBmcm9tID0gKGludmVyc2UpID8gZmsuZ2V0UHJpbWFyeUtleUNv\nbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdldENvbHVtbnMoKTsKICAgICAg\nICBDb2x1bW5bXSB0byA9IChpbnZlcnNlKSA/IGZrLmdldENvbHVtbnMoKQog\nICAgICAgICAgICA6IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CgogICAg\nICAgIC8vIGRvIGNvbHVtbiBqb2lucwogICAgICAgIFNRTEJ1ZmZlciBidWYg\nPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGludCBjb3VudCA9IDA7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmcm9tLmxlbmd0aDsgaSsr\nLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBi\ndWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLmFwcGVu\nZChmcm9tW2ldKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczIoKSkuYXBwZW5k\nKCIuIikuYXBwZW5kKHRvW2ldKTsKICAgICAgICB9CgogICAgICAgIC8vIGRv\nIGNvbnN0YW50IGpvaW5zCiAgICAgICAgQ29sdW1uW10gY29uc3RDb2xzID0g\nZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAg\nICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNv\nbnN0Q29sc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSku\nYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0\nQ29sc1tpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwoKICAg\nICAgICAgICAgaWYgKGludmVyc2UpCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAg\nICAgICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0pOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUoZmsuZ2V0Q29u\nc3RhbnQoY29uc3RDb2xzW2ldKSwgY29uc3RDb2xzW2ldKTsKICAgICAgICB9\nCgogICAgICAgIENvbHVtbltdIGNvbnN0Q29sc1BLID0gZmsuZ2V0Q29uc3Rh\nbnRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29uc3RDb2xzUEsubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAg\nICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgpKS5hcHBl\nbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoY29uc3RDb2xz\nUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kVmFsdWUoZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50KGNvbnN0Q29s\nc1BLW2ldKSwKICAgICAgICAgICAgICAgICAgICBjb25zdENvbHNQS1tpXSk7\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwoKICAgICAgICAgICAg\naWYgKGludmVyc2UpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUo\nZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50KGNvbnN0Q29sc1BLW2ldKSwKICAg\nICAgICAgICAgICAgICAgICBjb25zdENvbHNQS1tpXSk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlh\nczIoKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5k\nKGNvbnN0Q29sc1BLW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1\nZjsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZSB0aGUgZ2l2ZW4gam9pbiBp\nbnN0YW5jZSB0byBjcmVhdGUgU1FMIGpvaW5pbmcgaXRzIHRhYmxlcyBpbgog\nICAgICogdGhlIFNRTDkyIHN0eWxlLgogICAgICovCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIHRvU1FMOTJKb2luKFNlbGVjdCBzZWwsIEpvaW4gam9pbiwgYm9v\nbGVhbiBmb3JVcGRhdGUsCiAgICAgICAgYm9vbGVhbiBmaXJzdCkgewogICAg\nICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwoKICAg\nICAgICBpZiAoZmlyc3QpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2lu\nLmdldFRhYmxlMSgpKS5hcHBlbmQoIiAiKS4KICAgICAgICAgICAgICAgIGFw\ncGVuZChqb2luLmdldEFsaWFzMSgpKTsKICAgICAgICAgICAgaWYgKGZvclVw\nZGF0ZSAmJiB0YWJsZUZvclVwZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0\nZUNsYXVzZSk7CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5kKCIgIik7\nCiAgICAgICAgaWYgKGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9PVVRF\nUikKICAgICAgICAgICAgYnVmLmFwcGVuZChvdXRlckpvaW5DbGF1c2UpOwog\nICAgICAgIGVsc2UgaWYgKGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9J\nTk5FUikKICAgICAgICAgICAgYnVmLmFwcGVuZChpbm5lckpvaW5DbGF1c2Up\nOwogICAgICAgIGVsc2UgLy8gY3Jvc3MKICAgICAgICAgICAgYnVmLmFwcGVu\nZChjcm9zc0pvaW5DbGF1c2UpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKTsK\nCiAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldFRhYmxlMigpKS5hcHBlbmQo\nIiAiKS5hcHBlbmQoam9pbi5nZXRBbGlhczIoKSk7CiAgICAgICAgaWYgKGZv\nclVwZGF0ZSAmJiB0YWJsZUZvclVwZGF0ZUNsYXVzZSAhPSBudWxsKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKHRhYmxlRm9yVXBkYXRl\nQ2xhdXNlKTsKCiAgICAgICAgaWYgKGpvaW4uZ2V0Rm9yZWlnbktleSgpICE9\nIG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAiKS5hcHBlbmQo\ndG9UcmFkaXRpb25hbEpvaW4oam9pbikpOwogICAgICAgIGVsc2UgaWYgKHJl\ncXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luICYmCiAgICAgICAgICAgICAg\nICBqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfQ1JPU1MpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBPTiAoMSA9IDEpIik7CiAgICAgICAgCiAgICAg\nICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICBwcml2YXRlIFNRTEJ1ZmZlciB0\nb0NvcnJlbGF0ZWRKb2luKFNlbGVjdCBzZWwsIEpvaW4gam9pbiwgYm9vbGVh\nbiBmb3JVcGRhdGUsCiAgICAgICAgYm9vbGVhbiBmaXJzdCkgewogICAgICAg\nIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKXsKICAgICAgICAg\nICAgU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAg\nICAgICAgICAgd2hlcmUuYXBwZW5kKCIoIikuYXBwZW5kKHRvVHJhZGl0aW9u\nYWxKb2luKGpvaW4pKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgc2VsLndo\nZXJlKHdoZXJlLmdldFNRTCgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogVXNlIHRoZSBnaXZlbiBq\nb2luIGluc3RhbmNlIHRvIGNyZWF0ZSBTUUwgam9pbmluZyBpdHMgdGFibGVz\nIGluCiAgICAgKiB0aGUgZGF0YWJhc2UncyBuYXRpdmUgc3ludGF4LiBUaHJv\nd3MgYW4gZXhjZXB0aW9uIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTUUxCdWZmZXIgdG9OYXRpdmVKb2luKEpvaW4gam9pbikgewogICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyBpZiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkg\nY2FuIGJlIGVhZ2VybHkgbG9hZGVkIHVzaW5nIG90aGVyIGpvaW5zLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5PdXRlckpvaW4oaW50IHN5bnRh\neCwgRm9yZWlnbktleSBmaykgewogICAgICAgIHJldHVybiBzeW50YXggIT0g\nU1lOVEFYX1RSQURJVElPTkFMOwogICAgfQoKICAgIC8qKgogICAgICogQ29t\nYmluZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRvIGEgU0VMRUNUIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChT\nUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBT\nUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVmZmVyIGhhdmluZywgU1FM\nQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xl\nYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgICAg\nIHJldHVybiB0b09wZXJhdGlvbihnZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gp\nLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwKICAgICAgICAgICAgZ3JvdXAsIGhh\ndmluZywgb3JkZXIsIGRpc3RpbmN0LCBzdGFydCwgZW5kLAogICAgICAgICAg\nICBnZXRGb3JVcGRhdGVDbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29tYmluZSB0aGUgZ2l2ZW4gY29t\ncG9uZW50cyBpbnRvIGEgU0VMRUNUIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0\ncywKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZl\nciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIg\nb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JV\ncGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIGJvb2xlYW4g\nc3Vic2VsZWN0LCBTZWxlY3Qgc2VsKSB7CiAgICAgICAgcmV0dXJuIHRvT3Bl\ncmF0aW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZy\nb20sIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwg\nZGlzdGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0\nZUNsYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxsKSwgc3Vic2VsZWN0KTsK\nICAgIH0KICAgIAogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxC\ndWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwK\nICAgICAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwg\nU1FMQnVmZmVyIGdyb3VwLAogICAgICAgICAgICBTUUxCdWZmZXIgaGF2aW5n\nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgICAgIGJvb2xlYW4gZGlzdGlu\nY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwK\nICAgICAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QsIGJvb2xlYW4gY2hlY2tU\nYWJsZUZvclVwZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gdG9PcGVyYXRp\nb24oZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwg\nd2hlcmUsCiAgICAgICAgICAgICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3Jk\nZXIsIGRpc3RpbmN0LCBzdGFydCwgZW5kLAogICAgICAgICAgICAgICAgICAg\nIGdldEZvclVwZGF0ZUNsYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxsKSwg\nc3Vic2VsZWN0LAogICAgICAgICAgICAgICAgICAgIGNoZWNrVGFibGVGb3JV\ncGRhdGUpOwogICAgICAgIH0KCiAgICAvKioKICAgICAqIENvbWJpbmUgdGhl\nIGdpdmVuIGNvbXBvbmVudHMgaW50byBhIFNFTEVDVCBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVm\nZmVyIHNlbGVjdHMsIAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsCiAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVy\nZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1ZmZlciBoYXZpbmcs\nIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBi\nb29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAg\nICAgU2VsZWN0IHNlbCkgewogICAgICAgIHJldHVybiB0b09wZXJhdGlvbihn\nZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBmcm9tLCB3aGVy\nZSwKICAgICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIsIGRpc3RpbmN0\nLCBzdGFydCwgZW5kLAogICAgICAgICAgICBnZXRGb3JVcGRhdGVDbGF1c2Uo\nZmV0Y2gsIGZvclVwZGF0ZSwgc2VsKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBHZXQgdGhlIHVwZGF0ZSBjbGF1c2UgZm9yIHRoZSBxdWVyeSBiYXNlZCBv\nbiB0aGUKICAgICAqIHVwZGF0ZUNsYXVzZSBhbmQgaXNvbGF0aW9uTGV2ZWwg\naGludHMKICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRGb3JVcGRh\ndGVDbGF1c2UoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAg\nICBib29sZWFuIGlzRm9yVXBkYXRlLCBTZWxlY3Qgc2VsKSB7CiAgICAgICAg\naWYgKGZldGNoICE9IG51bGwgJiYgZmV0Y2guZ2V0SXNvbGF0aW9uKCkgIT0g\nLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICJpc29sYXRpb24tbGV2\nZWwtY29uZmlnLW5vdC1zdXBwb3J0ZWQiLCBnZXRDbGFzcygpLmdldE5hbWUo\nKSkpOwogICAgICAgIH0gZWxzZSBpZiAoaXNGb3JVcGRhdGUgJiYgIXNpbXVs\nYXRlTG9ja2luZykgewogICAgICAgICAgICBhc3NlcnRTdXBwb3J0KHN1cHBv\ncnRzU2VsZWN0Rm9yVXBkYXRlLCAiU3VwcG9ydHNTZWxlY3RGb3JVcGRhdGUi\nKTsKICAgICAgICAgICAgcmV0dXJuIGZvclVwZGF0ZUNsYXVzZTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZGlj\ndGlvbmFyeSB1c2VzIGlzb2xhdGlvbiBsZXZlbCB0byBjb21wdXRlIHRoZSAK\nICAgICAqIHJldHVybmVkIGdldEZvclVwZGF0ZUNsYXVzZSgpIFNRTCBjbGF1\nc2UuICAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNJc29s\nYXRpb25Gb3JVcGRhdGUoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgIlNFTEVDVCIgb3Bl\ncmF0aW9uIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFpbGFibGUgaGludHMsIGV0\nYy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTZWxlY3RPcGVyYXRp\nb24oSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJl\ndHVybiAiU0VMRUNUIjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJpbmcg\nb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZlciBmcm9t\nLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVy\nIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4gZGlz\ndGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0cmluZyBm\nb3JVcGRhdGVDbGF1c2UpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24o\nb3AsIHNlbGVjdHMsIGZyb20sIHdoZXJlLCBncm91cCwgaGF2aW5nLCBvcmRl\nciwKICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0LCBlbmQsIGZvclVwZGF0\nZUNsYXVzZSwgZmFsc2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihT\ndHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZl\nciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FM\nQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xl\nYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0\ncmluZyBmb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAg\nICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBmcm9tLCB3\naGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAgICAgICAgICBk\naXN0aW5jdCwgc3RhcnQsIGVuZCwgZm9yVXBkYXRlQ2xhdXNlLCBzdWJzZWxl\nY3QsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9w\nLCBTUUxCdWZmZXIgc2VsZWN0cywgU1FMQnVmZmVyIGZyb20sCiAgICAgICAg\nICAgIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLCBTUUxCdWZm\nZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgICAgIGJvb2xl\nYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLCBTdHJpbmcgZm9y\nVXBkYXRlQ2xhdXNlLAogICAgICAgICAgICBib29sZWFuIHN1YnNlbGVjdCwg\nYm9vbGVhbiBjaGVja1RhYmxlRm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVm\nZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgYnVmLmFw\ncGVuZChvcCk7CgogICAgICAgIGJvb2xlYW4gcmFuZ2UgPSBzdGFydCAhPSAw\nIHx8IGVuZCAhPSBMb25nLk1BWF9WQUxVRTsKICAgICAgICBpZiAocmFuZ2Ug\nJiYgcmFuZ2VQb3NpdGlvbiA9PSBSQU5HRV9QUkVfRElTVElOQ1QpCiAgICAg\nICAgICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vi\nc2VsZWN0KTsKICAgICAgICBpZiAoZGlzdGluY3QpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBESVNUSU5DVCIpOwogICAgICAgIGlmIChyYW5nZSAmJiBy\nYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfRElTVElOQ1QpCiAgICAgICAg\nICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2Vs\nZWN0KTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChzZWxlY3Rz\nKS5hcHBlbmQoIiBGUk9NICIpLmFwcGVuZChmcm9tKTsKCiAgICAgICAgaWYg\nKGNoZWNrVGFibGVGb3JVcGRhdGUKICAgICAgICAgICAgICAgICYmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KGZvclVwZGF0ZUNsYXVzZSkgJiYgIVN0cmluZ1V0\naWxzCiAgICAgICAgICAgICAgICAgICAgICAgIC5pc0VtcHR5KHRhYmxlRm9y\nVXBkYXRlQ2xhdXNlKSkpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgV0hFUkUgIikuYXBwZW5kKHdoZXJl\nKTsKICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCAmJiAhZ3JvdXAuaXNFbXB0\neSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgR1JPVVAgQlkgIikuYXBw\nZW5kKGdyb3VwKTsKICAgICAgICBpZiAoaGF2aW5nICE9IG51bGwgJiYgIWhh\ndmluZy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChz\ndXBwb3J0c0hhdmluZywgIlN1cHBvcnRzSGF2aW5nIik7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBIQVZJTkcgIikuYXBwZW5kKGhhdmluZyk7CiAgICAg\nICAgfQogICAgICAgIGlmIChvcmRlciAhPSBudWxsICYmICFvcmRlci5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPUkRFUiBCWSAiKS5h\ncHBlbmQob3JkZXIpOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0\naW9uID09IFJBTkdFX1BPU1RfU0VMRUNUKQogICAgICAgICAgICBhcHBlbmRT\nZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAg\nICAgaWYgKGZvclVwZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgIikuYXBwZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAg\nICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9M\nT0NLKQogICAgICAgICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0\nLCBlbmQsIHN1YnNlbGVjdCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHRoaXMgZGljdGlvbmFyeSBjYW4gc2VsZWN0\nIHJhbmdlcywKICAgICAqIHVzZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgdGhl\nIHJhbmdlIFNRTC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5k\nU2VsZWN0UmFuZ2UoU1FMQnVmZmVyIGJ1ZiwgbG9uZyBzdGFydCwgbG9uZyBl\nbmQsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QpIHsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0\nYXRlbWVudCBiZXR3ZWVuIHRoZSBTRUxFQ1Qga2V5d29yZAogICAgICogYW5k\nIHRoZSBGUk9NIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgZ2V0U2VsZWN0cyhTZWxlY3Qgc2VsLCBib29sZWFuIGRpc3RpbmN0\nSWRlbnRpZmllcnMsCiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAg\nICAgICAvLyBhcHBlbmQgdGhlIGFsaWFzZXMgZm9yIGFsbCB0aGUgY29sdW1u\ncwogICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVy\nKHRoaXMpOwogICAgICAgIExpc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlz\ndGluY3RJZGVudGlmaWVycykKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5n\nZXRJZGVudGlmaWVyQWxpYXNlcygpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgYWxpYXNlcyA9IHNlbC5nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAg\nIE9iamVjdCBhbGlhczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFs\naWFzZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgYWxpYXMgPSBhbGlh\nc2VzLmdldChpKTsKICAgICAgICAgICAgaWYgKGFsaWFzIGluc3RhbmNlb2Yg\nU3RyaW5nKSB7CiAgICAgICAgICAgICAgICBhbGlhcyA9IGdldE5hbWluZ1V0\naWwoKS5jb252ZXJ0QWxpYXMoKFN0cmluZylhbGlhcyk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgYXBwZW5kU2VsZWN0KHNlbGVjdFNRTCwgYWxpYXMs\nIHNlbCwgaSk7CiAgICAgICAgICAgIGlmIChpIDwgYWxpYXNlcy5zaXplKCkg\nLSAxKQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVjdFNRTDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFwcGVuZCA8Y29kZT5lbGVtPC9jb2RlPiB0byA8Y29k\nZT5zZWxlY3RTUUw8L2NvZGU+LgogICAgICogQHBhcmFtIHNlbGVjdFNRTCBU\naGUgU1FMQnVmZmVyIHRvIGFwcGVuZCB0by4KICAgICAqIEBwYXJhbSBhbGlh\ncyBBIHtAbGluayBTUUxCdWZmZXJ9IG9yIGEge0BsaW5rIFN0cmluZ30gdG8g\nYXBwZW5kLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRTZWxlY3QoU1FMQnVmZmVyIHNlbGVj\ndFNRTCwgT2JqZWN0IGVsZW0sIFNlbGVjdCBzZWwsCiAgICAgICAgaW50IGlk\neCkgewogICAgICAgIGlmIChlbGVtIGluc3RhbmNlb2YgU1FMQnVmZmVyKQog\nICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKChTUUxCdWZmZXIpIGVsZW0p\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChl\nbGVtLnRvU3RyaW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyB0cnVlIGlmIGEgIkZPUiBVUERBVEUiIGNsYXVzZSBjYW4gYmUgdXNlZCBm\nb3IgdGhlIHNwZWNpZmllZAogICAgICogU2VsZWN0IG9iamVjdC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nKFNlbGVjdCBz\nZWwpIHsKICAgICAgICBpZiAoc2VsLmlzQWdncmVnYXRlKCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBvcnRzU2VsZWN0\nRm9yVXBkYXRlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\naWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgJiYgKHNlbC5n\nZXRTdGFydEluZGV4KCkgIT0gMAogICAgICAgICAgICB8fCBzZWwuZ2V0RW5k\nSW5kZXgoKSAhPSBMb25nLk1BWF9WQUxVRSkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgLy8gb25seSBpbm5lciBzZWxlY3QgaXMgbG9j\na2VkCiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkK\nICAgICAgICAgICAgc2VsID0gc2VsLmdldEZyb21TZWxlY3QoKTsKCiAgICAg\nICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgJiYg\nc2VsLmlzRGlzdGluY3QoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxlVGFibGVz\nCiAgICAgICAgICAgICYmIHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5zaXplKCkg\nPiAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFz\ndXBwb3J0c0xvY2tpbmdXaXRoT3JkZXJDbGF1c2UgJiYgc2VsLmdldE9yZGVy\naW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE91dGVySm9pbiB8fCAhc3Vw\ncG9ydHNMb2NraW5nV2l0aElubmVySm9pbikgewogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIEpvaW4gam9pbiA9IChKb2lu\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKCFzdXBwb3J0c0xv\nY2tpbmdXaXRoT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAgICAgJiYgam9p\nbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghc3Vw\ncG9ydHNMb2NraW5nV2l0aElubmVySm9pbgogICAgICAgICAgICAgICAgICAg\nICYmIGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gZmFsc2UgaWYgdGhlIGdpdmVuIHNlbGVjdCByZXF1aXJl\ncyBhIGZvcndhcmQtb25seSByZXN1bHQgc2V0LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNldChTZWxl\nY3Qgc2VsLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAg\ncmV0dXJuICFzZWwuaXNBZ2dyZWdhdGUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFzc2VydCB0aGF0IHRoZSBnaXZlbiBkaWN0aW9uYXJ5IGZsYWcgaXMg\ndHJ1ZS4gSWYgaXQgaXMgbm90IHRydWUsCiAgICAgKiB0aHJvdyBhbiBlcnJv\nciBzYXlpbmcgdGhhdCB0aGUgZ2l2ZW4gc2V0dGluZyBuZWVkcyB0byByZXR1\ncm4gdHJ1ZSBmb3IKICAgICAqIHRoZSBjdXJyZW50IG9wZXJhdGlvbiB0byB3\nb3JrLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRTdXBwb3J0KGJv\nb2xlYW4gZmVhdHVyZSwgU3RyaW5nIHByb3BlcnR5KSB7CiAgICAgICAgaWYg\nKCFmZWF0dXJlKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oX2xvYy5nZXQoImZlYXR1cmUtbm90LXN1cHBvcnRlZCIsCiAg\nICAgICAgICAgICAgICBnZXRDbGFzcygpLCBwcm9wZXJ0eSkpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBmdW5jdGlv\nbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBJ\nbnZva2UgdGhpcyBkYXRhYmFzZSdzIHN1YnN0cmluZyBmdW5jdGlvbi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRl\nIHRoZSBzdWJzdHJpbmcgaW52b2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0\nciBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmlu\nZwogICAgICogQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50\naW5nIHRoZSBzdGFydCBpbmRleAogICAgICogQHBhcmFtIGVuZCBhIHF1ZXJ5\nIHZhbHVlIHJlcHJlc2VudGluZyB0aGUgZW5kIGluZGV4LCBvciBudWxsIGZv\nciBub25lCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN1YnN0cmluZyhTUUxC\ndWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVlIHN0YXJ0\nLAogICAgICAgIEZpbHRlclZhbHVlIGVuZCkgewogICAgICAgIGJ1Zi5hcHBl\nbmQoc3Vic3RyaW5nRnVuY3Rpb25OYW1lKS5hcHBlbmQoIigiKTsKICAgICAg\nICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIsICIp\nOwogICAgICAgIGlmIChzdGFydC5nZXRWYWx1ZSgpIGluc3RhbmNlb2YgTnVt\nYmVyKSB7CiAgICAgICAgICAgIGxvbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0\nYXJ0KTsKICAgICAgICAgICAgYnVmLmFwcGVuZChMb25nLnRvU3RyaW5nKHN0\nYXJ0TG9uZyArIDEpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIoIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1\nZik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiArIDEpIik7CiAgICAgICAg\nfQogICAgICAgIGlmIChlbmQgIT0gbnVsbCkgewogICAgICAgICAgICBidWYu\nYXBwZW5kKCIsICIpOwogICAgICAgICAgICBpZiAoc3RhcnQuZ2V0VmFsdWUo\nKSBpbnN0YW5jZW9mIE51bWJlcgogICAgICAgICAgICAgICAgJiYgZW5kLmdl\ndFZhbHVlKCkgaW5zdGFuY2VvZiBOdW1iZXIpIHsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0YXJ0KTsKICAgICAgICAgICAg\nICAgIGxvbmcgZW5kTG9uZyA9IHRvTG9uZyhlbmQpOwogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChMb25nLnRvU3RyaW5nKGVuZExvbmcgLSBzdGFydExv\nbmcpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVu\nZC5hcHBlbmRUbyhidWYpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIC0gKCIpOwogICAgICAgICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9Cgog\nICAgbG9uZyB0b0xvbmcoRmlsdGVyVmFsdWUgbGl0VmFsdWUpIHsKICAgICAg\nICByZXR1cm4gKChOdW1iZXIpIGxpdFZhbHVlLmdldFZhbHVlKCkpLmxvbmdW\nYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoaXMgZGF0\nYWJhc2UncyBpbmRleE9mIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEBwYXJh\nbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGluZGV4T2YgaW52\nb2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJl\ncHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmluZwogICAgICogQHBhcmFtIGZp\nbmQgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHNlYXJjaCBzdHJp\nbmcKICAgICAqIEBwYXJhbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2Vu\ndGluZyB0aGUgc3RhcnQgaW5kZXgsIG9yIG51bGwKICAgICAqIHRvIHN0YXJ0\nIGF0IHRoZSBiZWdpbm5pbmcKICAgICAqLwogICAgcHVibGljIHZvaWQgaW5k\nZXhPZihTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZh\nbHVlIGZpbmQsCiAgICAgICAgRmlsdGVyVmFsdWUgc3RhcnQpIHsKICAgICAg\nICBidWYuYXBwZW5kKCIoSU5TVFIoKCIpOwogICAgICAgIGlmIChzdGFydCAh\nPSBudWxsKQogICAgICAgICAgICBzdWJzdHJpbmcoYnVmLCBzdHIsIHN0YXJ0\nLCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0ci5hcHBlbmRU\nbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiksICgiKTsKICAgICAgICBm\naW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiKSkgLSAx\nIik7CiAgICAgICAgaWYgKHN0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiICsgIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRv\nKGJ1Zik7CiAgICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCB0aGUgbnVtZXJpYyBwYXJ0cyBv\nZiBhIG1hdGhlbWF0aWNhbCBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFy\nYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBtYXRoIGZ1bmN0\naW9uCiAgICAgKiBAcGFyYW0gb3AgdGhlIG1hdGhlbWF0aWNhbCBvcGVyYXRp\nb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5k\nIHNpZGUgb2YgdGhlIG1hdGggZnVuY3Rpb24KICAgICAqIEBwYXJhbSByaHMg\ndGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgbWF0aCBmdW5jdGlvbgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBtYXRoRnVuY3Rpb24oU1FMQnVmZmVyIGJ1\nZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVy\nVmFsdWUgcmhzKSB7CiAgICAgICAgYm9vbGVhbiBjYXN0bGhzID0gZmFsc2U7\nCiAgICAgICAgYm9vbGVhbiBjYXN0cmhzID0gZmFsc2U7CiAgICAgICAgQ2xh\nc3MgbGMgPSBGaWx0ZXJzLndyYXAobGhzLmdldFR5cGUoKSk7CiAgICAgICAg\nQ2xhc3MgcmMgPSBGaWx0ZXJzLndyYXAocmhzLmdldFR5cGUoKSk7CiAgICAg\nICAgaW50IHR5cGUgPSAwOwogICAgICAgIGlmIChyZXF1aXJlc0Nhc3RGb3JN\nYXRoRnVuY3Rpb25zICYmIChsYyAhPSByYwogICAgICAgICAgICB8fCAobGhz\nLmlzQ29uc3RhbnQoKSB8fCByaHMuaXNDb25zdGFudCgpKSkpIHsKICAgICAg\nICAgICAgQ2xhc3MgYyA9IEZpbHRlcnMucHJvbW90ZShsYywgcmMpOwogICAg\nICAgICAgICB0eXBlID0gZ2V0SkRCQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKGMpLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICh0eXBlICE9IFR5cGVz\nLlZBUkJJTkFSWSAmJiB0eXBlICE9IFR5cGVzLkJMT0IpIHsKICAgICAgICAg\nICAgICAgIGNhc3RsaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXND\nb25zdGFudCgpKSB8fCBsYyAhPSBjOwogICAgICAgICAgICAgICAgY2FzdHJo\ncyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8\nIHJjICE9IGM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJv\nb2xlYW4gbW9kID0gIk1PRCIuZXF1YWxzKG9wKTsKICAgICAgICBpZiAobW9k\nKSB7CiAgICAgICAgICAgIGlmIChzdXBwb3J0c01vZE9wZXJhdG9yKQogICAg\nICAgICAgICAgICAgb3AgPSAiJSI7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQob3ApOwogICAgICAgIH0KICAgICAgICBi\ndWYuYXBwZW5kKCIoIik7CgogICAgICAgIGlmIChjYXN0bGhzKQogICAgICAg\nICAgICBhcHBlbmRDYXN0KGJ1ZiwgbGhzLCB0eXBlKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGxocy5hcHBlbmRUbyhidWYpOwoKICAgICAgICBpZiAo\nbW9kICYmICFzdXBwb3J0c01vZE9wZXJhdG9yKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIsICIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7CgogICAgICAgIGlm\nIChjYXN0cmhzKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgcmhzLCB0\neXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJocy5hcHBlbmRUbyhi\ndWYpOwoKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBcHBlbmQgYSBjb21wYXJpc29uLgogICAgICoKICAgICAqIEBw\nYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlz\nb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24g\ndG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNp\nZGUgb2YgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJp\nZ2h0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjb21wYXJpc29uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBv\ncCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocykg\newogICAgICAgIGJvb2xlYW4gbGhzeG1sID0gbGhzLmdldFhQYXRoKCkgIT0g\nbnVsbDsKICAgICAgICBib29sZWFuIHJoc3htbCA9IHJocy5nZXRYUGF0aCgp\nICE9IG51bGw7CiAgICAgICAgaWYgKGxoc3htbCB8fCByaHN4bWwpIHsKICAg\nICAgICAgICAgYXBwZW5kWG1sQ29tcGFyaXNvbihidWYsIG9wLCBsaHMsIHJo\ncywgbGhzeG1sLCByaHN4bWwpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQogICAgICAgIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNlOwogICAgICAg\nIGJvb2xlYW4gY2FzdHJocyA9IGZhbHNlOwogICAgICAgIENsYXNzIGxjID0g\nRmlsdGVycy53cmFwKGxocy5nZXRUeXBlKCkpOwogICAgICAgIENsYXNzIHJj\nID0gRmlsdGVycy53cmFwKHJocy5nZXRUeXBlKCkpOwogICAgICAgIAogICAg\nICAgIC8vIHNwZWNpYWwgY2FzZSBvZiBjb21wYXJpc29uIG9mIHR3byBib29s\nZWFuIGNvbnN0YW50cwogICAgICAgIC8vIGJlY2F1c2Ugc29tZSBkYXRhYmFz\nZXMgZG8gbm90IGxpa2UgZmFsc2UgPSBmYWxzZSBvciBmYWxzZSA9IHRydWUK\nICAgICAgICAvLyBidXQgYWxsIGRhdGFiYXNlcyB1bmRlcnN0YW5kIDEgPSAw\nIG9yIDAgPD4gMSBldGMuCiAgICAgICAgaWYgKGxjID09IHJjICYmIGxjID09\nIEJvb2xlYW4uY2xhc3MgJiYgbGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXND\nb25zdGFudCgpKSB7CiAgICAgICAgICAgIFN0cmluZyBsdmFsdWUgPSBCb29s\nZWFuLlRSVUUuZXF1YWxzKGxocy5nZXRWYWx1ZSgpKSA/ICIxIiA6ICIwIjsK\nICAgICAgICAgICAgU3RyaW5nIHJ2YWx1ZSA9IEJvb2xlYW4uVFJVRS5lcXVh\nbHMocmhzLmdldFZhbHVlKCkpID8gIjEiIDogIjAiOwogICAgICAgICAgICBi\ndWYuYXBwZW5kKGx2YWx1ZSkuYXBwZW5kKG9wKS5hcHBlbmQocnZhbHVlKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpbnQgdHlw\nZSA9IDA7CiAgICAgICAgaWYgKHJlcXVpcmVzQ2FzdEZvckNvbXBhcmlzb25z\nICYmIChsYyAhPSByYwogICAgICAgICAgICB8fCAobGhzLmlzQ29uc3RhbnQo\nKSAmJiByaHMuaXNDb25zdGFudCgpKSkpIHsKICAgICAgICAgICAgQ2xhc3Mg\nYyA9IEZpbHRlcnMucHJvbW90ZShsYywgcmMpOwogICAgICAgICAgICB0eXBl\nID0gZ2V0SkRCQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVDb2RlKGMpLCBmYWxz\nZSk7CiAgICAgICAgICAgIGlmICh0eXBlICE9IFR5cGVzLlZBUkJJTkFSWSAm\nJiB0eXBlICE9IFR5cGVzLkJMT0IpIHsKICAgICAgICAgICAgICAgIGNhc3Rs\naHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8\nfCBsYyAhPSBjOwogICAgICAgICAgICAgICAgY2FzdHJocyA9IChsaHMuaXND\nb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8IHJjICE9IGM7CiAg\nICAgICAgICAgICAgICBjYXN0bGhzID0gY2FzdGxocyAmJiBsaHMucmVxdWly\nZXNDYXN0KCk7CiAgICAgICAgICAgICAgICBjYXN0cmhzID0gY2FzdHJocyAm\nJiByaHMucmVxdWlyZXNDYXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIGlmIChjYXN0bGhzKQogICAgICAgICAgICBhcHBlbmRDYXN0\nKGJ1ZiwgbGhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxo\ncy5hcHBlbmRUbyhidWYpOwoKICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBw\nZW5kKG9wKS5hcHBlbmQoIiAiKTsKCiAgICAgICAgaWYgKGNhc3RyaHMpCiAg\nICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCByaHMsIHR5cGUpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgcmhzLmFwcGVuZFRvKGJ1Zik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJZiB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgWE1M\nIHR5cGUsCiAgICAgKiB1c2UgdGhpcyBtZXRob2QgdG8gYXBwZW5kIHhtbCBw\ncmVkaWNhdGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFwcGVuZFhtbENv\nbXBhcmlzb24oU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1\nZSBsaHMsCiAgICAgICAgRmlsdGVyVmFsdWUgcmhzLCBib29sZWFuIGxoc3ht\nbCwgYm9vbGVhbiByaHN4bWwpIHsKICAgICAgICBhc3NlcnRTdXBwb3J0KHN1\ncHBvcnRzWE1MQ29sdW1uLCAiU3VwcG9ydHNYTUxDb2x1bW4iKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFwcGVuZCBTUUwgZm9yIHRoZSBnaXZlbiBudW1l\ncmljIHZhbHVlIHRvIHRoZSBidWZmZXIsIGNhc3RpbmcgYXMgbmVlZGVkLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmROdW1lcmljQ2FzdChT\nUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSB2YWwpIHsKICAgICAgICBpZiAo\ndmFsLmlzQ29uc3RhbnQoKSkKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYs\nIHZhbCwgVHlwZXMuTlVNRVJJQyk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICB2YWwuYXBwZW5kVG8oYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAqIENh\nc3QgdGhlIHNwZWNpZmllZCB2YWx1ZSB0byB0aGUgc3BlY2lmaWVkIHR5cGUu\nCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgYnVmZmVyIHRvIGFwcGVu\nZCB0aGUgY2FzdCB0bwogICAgICogQHBhcmFtIHZhbCB0aGUgdmFsdWUgdG8g\nY2FzdAogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2YgdGhlIGNhc2Us\nIGUuZy4ge0BsaW5rIFR5cGVzI05VTUVSSUN9CiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFwcGVuZENhc3QoU1FMQnVmZmVyIGJ1ZiwgT2JqZWN0IHZhbCwg\naW50IHR5cGUpIHsKICAgICAgICAvLyBDb252ZXJ0IHRoZSBjYXN0IGZ1bmN0\naW9uOiAiQ0FTVCh7MH0gQVMgezF9KSIKICAgICAgICBpbnQgZmlyc3RQYXJh\nbSA9IGNhc3RGdW5jdGlvbi5pbmRleE9mKCJ7MH0iKTsKICAgICAgICBTdHJp\nbmcgcHJlID0gY2FzdEZ1bmN0aW9uLnN1YnN0cmluZygwLCBmaXJzdFBhcmFt\nKTsgLy8gIkNBU1QoIgogICAgICAgIFN0cmluZyBtaWQgPSBjYXN0RnVuY3Rp\nb24uc3Vic3RyaW5nKGZpcnN0UGFyYW0gKyAzKTsKICAgICAgICBpbnQgc2Vj\nb25kUGFyYW0gPSBtaWQuaW5kZXhPZigiezF9Iik7CiAgICAgICAgU3RyaW5n\nIHBvc3Q7CiAgICAgICAgaWYgKHNlY29uZFBhcmFtID4gLTEpIHsKICAgICAg\nICAgICAgcG9zdCA9IG1pZC5zdWJzdHJpbmcoc2Vjb25kUGFyYW0gKyAzKTsg\nLy8gIikiCiAgICAgICAgICAgIG1pZCA9IG1pZC5zdWJzdHJpbmcoMCwgc2Vj\nb25kUGFyYW0pOyAvLyAiIEFTICIKICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgcG9zdCA9ICIiOwoKICAgICAgICBidWYuYXBwZW5kKHByZSk7CiAgICAg\nICAgaWYgKHZhbCBpbnN0YW5jZW9mIEZpbHRlclZhbHVlKQogICAgICAgICAg\nICAoKEZpbHRlclZhbHVlKSB2YWwpLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCgoU1FMQnVmZmVyKSB2YWwpKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQodmFsLnRvU3RyaW5nKCkpOwogICAg\nICAgIGJ1Zi5hcHBlbmQobWlkKTsKICAgICAgICBidWYuYXBwZW5kKGdldFR5\ncGVOYW1lKHR5cGUpKTsKICAgICAgICBhcHBlbmRMZW5ndGgoYnVmLCB0eXBl\nKTsKICAgICAgICBidWYuYXBwZW5kKHBvc3QpOwogICAgfQogICAgCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhcHBlbmRMZW5ndGgoU1FMQnVmZmVyIGJ1ZiwgaW50\nIHR5cGUpIHsgICAgICAgIAogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiBh\nZGQgQ0FTVCBmb3IgYSBmdW5jdGlvbiBvcGVyYXRvciB3aGVyZSBvcGVyYW5k\nIGlzIGEgcGFyYW0KICAgICAqIEBwYXJhbSBmdW5jICBmdW5jdGlvbiBuYW1l\nCiAgICAgKiBAcGFyYW0gdmFsIAogICAgICogQHJldHVybiB1cGRhdGVkIGZ1\nbmMKICAgICAqLwogICAgcHVibGljIFN0cmluZyBhZGRDYXN0QXNUeXBlKFN0\ncmluZyBmdW5jLCBWYWwgdmFsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9ICAgIAoKCiAgICAvLy8vLy8vLy8vLwogICAgLy8gRERMIFNRTAogICAg\nLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEluY3JlbWVudCB0aGUgcmVm\nZXJlbmNlIGNvdW50IG9mIGFueSB0YWJsZSBjb21wb25lbnRzIHRoYXQgdGhp\ncwogICAgICogZGljdGlvbmFyeSBhZGRzIHRoYXQgYXJlIG5vdCB1c2VkIGJ5\nIG1hcHBpbmdzLiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgcmVmU2NoZW1hQ29tcG9uZW50cyhUYWJsZSB0YWJs\nZSkgewogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgbmFtZSBv\nZiB0aGUgY29sdW1uIHVzaW5nIGRhdGFiYXNlIHNwZWNpZmljIGRlbGltaXRl\ncnMuCiAgICAgKi8KICAgIHB1YmxpYyBEQklkZW50aWZpZXIgZ2V0Q29sdW1u\nSWRlbnRpZmllcihDb2x1bW4gY29sdW1uKSB7CiAgICAgICAgaWYgKGNvbHVt\nbiA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBEQklkZW50aWZpZXIu\nTlVMTDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbHVtbi5nZXRJZGVu\ndGlmaWVyKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29s\ndW1uREJOYW1lKENvbHVtbiBjb2x1bW4pIHsKICAgICAgICByZXR1cm4gdG9E\nQk5hbWUoZ2V0Q29sdW1uSWRlbnRpZmllcihjb2x1bW4pKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIGZ1bGwgbmFtZSBvZiB0aGUgdGFi\nbGUsIGluY2x1ZGluZyB0aGUgc2NoZW1hIChkZWxpbWl0ZWQKICAgICAqIGJ5\nIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgogICAgICovCiAgICBwdWJs\naWMgREJJZGVudGlmaWVyIGdldEZ1bGxJZGVudGlmaWVyKFRhYmxlIHRhYmxl\nLCBib29sZWFuIGxvZ2ljYWwpIHsKICAgICAgICBpZiAoIXVzZVNjaGVtYU5h\nbWUgfHwgREJJZGVudGlmaWVyLmlzTnVsbCh0YWJsZS5nZXRTY2hlbWFJZGVu\ndGlmaWVyKCkpKQogICAgICAgICAgICByZXR1cm4gdGFibGUuZ2V0SWRlbnRp\nZmllcigpOwogICAgICAgIHJldHVybiB0YWJsZS5nZXRGdWxsSWRlbnRpZmll\ncigpOwogICAgfQogICAgICAgIAogICAgcHVibGljIFN0cmluZyBnZXRGdWxs\nTmFtZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dpY2FsKSB7CiAgICAgICAg\naWYgKCF1c2VTY2hlbWFOYW1lIHx8IERCSWRlbnRpZmllci5pc051bGwodGFi\nbGUuZ2V0U2NoZW1hSWRlbnRpZmllcigpKSkKICAgICAgICAgICAgcmV0dXJu\nIHRvREJOYW1lKHRhYmxlLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgcmV0\ndXJuIHRvREJOYW1lKHRhYmxlLmdldEZ1bGxJZGVudGlmaWVyKCkpOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZ1bGwgbmFtZSBv\nZiB0aGUgaW5kZXgsIGluY2x1ZGluZyB0aGUgc2NoZW1hIChkZWxpbWl0ZWQK\nICAgICAqIGJ5IHRoZSByZXN1bHQgb2Yge0BsaW5rICNjYXRhbG9nU2VwYXJh\ndG9yfSkuCiAgICAgKi8KCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1l\nKEluZGV4IGluZGV4KSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8\nIERCSWRlbnRpZmllci5pc051bGwoaW5kZXguZ2V0U2NoZW1hSWRlbnRpZmll\ncigpKSkKICAgICAgICAgICAgcmV0dXJuIHRvREJOYW1lKGluZGV4LmdldElk\nZW50aWZpZXIoKSk7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKGluZGV4Lmdl\ndEZ1bGxJZGVudGlmaWVyKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB0aGUgZnVsbCBuYW1lIG9mIHRoZSBzZXF1ZW5jZSwgaW5jbHVkaW5n\nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAogICAgICogYnkgdGhlIHJlc3VsdCBv\nZiB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAgICAqLwoKICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0RnVsbE5hbWUoU2VxdWVuY2Ugc2VxKSB7CiAgICAg\nICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IERCSWRlbnRpZmllci5pc051bGwo\nc2VxLmdldFNjaGVtYUlkZW50aWZpZXIoKSkpCiAgICAgICAgICAgIHJldHVy\nbiB0b0RCTmFtZShzZXEuZ2V0SWRlbnRpZmllcigpKTsKICAgICAgICByZXR1\ncm4gdG9EQk5hbWUoc2VxLmdldEZ1bGxJZGVudGlmaWVyKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdWJzZXQgb2YgdGhlIHdvcmRz\nIGluIHJlc2VydmVkV29yZFNldCB0aGF0IGNhbm5vdCBiZSB1c2VkIGFzCiAg\nICAgKiB2YWxpZCBjb2x1bW4gbmFtZXMgZm9yIHRoZSBjdXJyZW50IERCLiBJ\nZiB0aGUgY29sdW1uIG5hbWUgaXMgaW52YWxpZCB0aGUKICAgICAqIGdldFZh\nbGlkQ29sdW1uTmFtZSBtZXRob2Qgb2YgdGhlIERCIGRpY3Rpb25hcnkgc2hv\ndWxkIGJlIGludm9rZWQgdG8gbWFrZQogICAgICogaXQgdmFsaWQuCiAgICAg\nKiAKICAgICAqIEBzZWUgZ2V0VmFsaWRDb2x1bW5OYW1lCiAgICAgKi8KICAg\nIHB1YmxpYyBmaW5hbCBTZXQ8U3RyaW5nPiBnZXRJbnZhbGlkQ29sdW1uV29y\nZFNldCgpIHsKICAgICAgICByZXR1cm4gaW52YWxpZENvbHVtbldvcmRTZXQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hh\nbmdlcyB0byB0aGUgZ2l2ZW4gdGFibGUgbmFtZSB0byBtYWtlIGl0IHZhbGlk\nIGZvcgogICAgICogdGhlIGN1cnJlbnQgREIuCiAgICAgKiBAZGVwcmVjYXRl\nZAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkVGFibGVOYW1l\nKFN0cmluZyBuYW1lLCBTY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgcmV0dXJu\nIGdldFZhbGlkVGFibGVOYW1lKERCSWRlbnRpZmllci5uZXdUYWJsZShuYW1l\nKSwgc2NoZW1hKS5nZXROYW1lKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIHRh\nYmxlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZCBmb3IKICAgICAqIHRoZSBjdXJy\nZW50IERCLgogICAgICovCiAgICBwdWJsaWMgREJJZGVudGlmaWVyIGdldFZh\nbGlkVGFibGVOYW1lKERCSWRlbnRpZmllciBuYW1lLCBTY2hlbWEgc2NoZW1h\nKSB7CiAgICAgICAgcmV0dXJuIG5hbWluZ1V0aWwuZ2V0VmFsaWRUYWJsZUlk\nZW50aWZpZXIobmFtZSwgc2NoZW1hLCBtYXhUYWJsZU5hbWVMZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFrZSBpdCB2YWxp\nZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICogQGRlcHJlY2F0\nZWQKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFNlcXVlbmNl\nTmFtZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHJl\ndHVybiBnZXRWYWxpZFNlcXVlbmNlTmFtZShEQklkZW50aWZpZXIubmV3U2Vx\ndWVuY2UobmFtZSksIHNjaGVtYSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9y\nIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgREJJZGVudGlm\naWVyIGdldFZhbGlkU2VxdWVuY2VOYW1lKERCSWRlbnRpZmllciBuYW1lLCBT\nY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgcmV0dXJuIG5hbWluZ1V0aWwuZ2V0\nVmFsaWRTZXF1ZW5jZUlkZW50aWZpZXIobmFtZSwgc2NoZW1hLCBtYXhUYWJs\nZU5hbWVMZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkg\nbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGNvbHVtbiBuYW1lIHRv\nIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBEQi4gIFRo\nZSBjb2x1bW4gbmFtZSB3aWxsIGJlIG1hZGUgdW5pcXVlIGZvciB0aGUKICAg\nICAqIHNwZWNpZmllZCB0YWJsZS4KICAgICAqIEBkZXByZWNhdGVkCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRDb2x1bW5OYW1lKFN0cmlu\nZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBnZXRWYWxp\nZENvbHVtbk5hbWUoREJJZGVudGlmaWVyLm5ld0NvbHVtbihuYW1lKSwgdGFi\nbGUsIHRydWUpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4g\nbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQg\nREIuICBUaGUgY29sdW1uIG5hbWUgd2lsbCBiZSBtYWRlIHVuaXF1ZSBmb3Ig\ndGhlCiAgICAgKiBzcGVjaWZpZWQgdGFibGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBEQklkZW50aWZpZXIgZ2V0VmFsaWRDb2x1bW5OYW1lKERCSWRlbnRpZmll\nciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBnZXRWYWxp\nZENvbHVtbk5hbWUobmFtZSwgdGFibGUsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIGNvbHVtbiBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0\naGUgY3VycmVudCBEQi4gIElmIGNoZWNrRm9yVW5pcXVlbmVzcyBpcyB0cnVl\nLCB0aGUgY29sdW1uIG5hbWUgd2lsbCAKICAgICAqIGJlIG1hZGUgdW5pcXVl\nIGZvciB0aGUgc3BlY2lmaWVkIHRhYmxlLgogICAgICogQGRlcHJlY2F0ZWQK\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZENvbHVtbk5hbWUo\nU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlLAogICAgICAgIGJvb2xlYW4gY2hl\nY2tGb3JVbmlxdWVuZXNzKSB7CiAgICAgICAgcmV0dXJuIGdldFZhbGlkQ29s\ndW1uTmFtZShEQklkZW50aWZpZXIubmV3Q29sdW1uKG5hbWUpLCB0YWJsZSwg\nY2hlY2tGb3JVbmlxdWVuZXNzKS50b1N0cmluZygpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIGNvbHVtbiBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0\naGUgY3VycmVudCBEQi4gIElmIGNoZWNrRm9yVW5pcXVlbmVzcyBpcyB0cnVl\nLCB0aGUgY29sdW1uIG5hbWUgd2lsbCAKICAgICAqIGJlIG1hZGUgdW5pcXVl\nIGZvciB0aGUgc3BlY2lmaWVkIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMg\nREJJZGVudGlmaWVyIGdldFZhbGlkQ29sdW1uTmFtZShEQklkZW50aWZpZXIg\nbmFtZSwgVGFibGUgdGFibGUsCiAgICAgICAgYm9vbGVhbiBjaGVja0ZvclVu\naXF1ZW5lc3MpIHsKICAgICAgICByZXR1cm4gZ2V0TmFtaW5nVXRpbCgpLmdl\ndFZhbGlkQ29sdW1uSWRlbnRpZmllcihuYW1lLCB0YWJsZSwgbWF4Q29sdW1u\nTmFtZUxlbmd0aCwgCiAgICAgICAgICAgIGNoZWNrRm9yVW5pcXVlbmVzcyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hh\nbmdlcyB0byB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgbmFtZSB0byBtYWtlIGl0\nCiAgICAgKiB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRQcmltYXJ5S2V5TmFtZShTdHJpbmcg\nbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICB3aGlsZSAobmFtZS5zdGFy\ndHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmlu\nZygxKTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZCgiUF8iICsgbmFt\nZSwgdGFibGUuZ2V0U2NoZW1hKCkuZ2V0U2NoZW1hR3JvdXAoKSwKICAgICAg\nICAgICAgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2Vz\nIHRvIHRoZSBnaXZlbiBmb3JlaWduIGtleSBuYW1lIHRvIG1ha2UgaXQKICAg\nICAqIHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAqIEBkZXByZWNh\ndGVkCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRGb3JlaWdu\nS2V5TmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUsCiAgICAgICAgVGFi\nbGUgdG9UYWJsZSkgewogICAgICAgIHJldHVybiBnZXRWYWxpZEZvcmVpZ25L\nZXlOYW1lKERCSWRlbnRpZmllci5uZXdGb3JlaWduS2V5KG5hbWUpLCB0YWJs\nZSwKICAgICAgICAgICAgdG9UYWJsZSkuZ2V0TmFtZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhl\nIGdpdmVuIGZvcmVpZ24ga2V5IG5hbWUgdG8gbWFrZSBpdAogICAgICogdmFs\naWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgREJJ\nZGVudGlmaWVyIGdldFZhbGlkRm9yZWlnbktleU5hbWUoREJJZGVudGlmaWVy\nIG5hbWUsIFRhYmxlIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsK\nICAgICAgICByZXR1cm4gbmFtaW5nVXRpbC5nZXRWYWxpZEZvcmVpZ25LZXlJ\nZGVudGlmaWVyKG5hbWUsIHRhYmxlLCB0b1RhYmxlLCBtYXhDb25zdHJhaW50\nTmFtZUxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBu\nZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gaW5kZXggbmFtZSB0byBt\nYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAg\nKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZh\nbGlkSW5kZXhOYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAg\nICAgIHJldHVybiBnZXRWYWxpZEluZGV4TmFtZShEQklkZW50aWZpZXIubmV3\nSW5kZXgobmFtZSksIHRhYmxlKS5nZXROYW1lKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2\nZW4gaW5kZXggbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhl\nIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1YmxpYyBEQklkZW50aWZpZXIg\nZ2V0VmFsaWRJbmRleE5hbWUoREJJZGVudGlmaWVyIG5hbWUsIFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgcmV0dXJuIGdldE5hbWluZ1V0aWwoKS5nZXRWYWxp\nZEluZGV4SWRlbnRpZmllcihuYW1lLCB0YWJsZSwgbWF4SW5kZXhOYW1lTGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2Fy\neSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB1bmlxdWUgY29uc3RyYWludCBuYW1l\nIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4K\nICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0VmFsaWRVbmlxdWVOYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkg\newogICAgICAgIHJldHVybiBnZXRWYWxpZFVuaXF1ZU5hbWUoREJJZGVudGlm\naWVyLm5ld0NvbnN0cmFpbnQobmFtZSksIHRhYmxlKS5nZXROYW1lKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdl\ncyB0byB0aGUgZ2l2ZW4gdW5pcXVlIGNvbnN0cmFpbnQgbmFtZSB0byBtYWtl\nCiAgICAgKiBpdCB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8K\nICAgIHB1YmxpYyBEQklkZW50aWZpZXIgZ2V0VmFsaWRVbmlxdWVOYW1lKERC\nSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVy\nbiBuYW1pbmdVdGlsLmdldFZhbGlkVW5pcXVlSWRlbnRpZmllcihuYW1lLCB0\nYWJsZSwgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFNob3J0ZW4gdGhlIHNwZWNpZmllZCBuYW1lIHRvIHRo\nZSBzcGVjaWZpZWQgdGFyZ2V0IG5hbWUuIFRoaXMgd2lsbAogICAgICogYmUg\nZG9uZSBieSBmaXJzdCBzdHJpcHBpbmcgb3V0IHRoZSB2b3dlbHMsIGFuZCB0\naGVuIHJlbW92aW5nCiAgICAgKiBjaGFyYWN0ZXJzIGZyb20gdGhlIG1pZGRs\nZSBvZiB0aGUgd29yZCB1bnRpbCBpdCByZWFjaGVzIHRoZSB0YXJnZXQKICAg\nICAqIGxlbmd0aC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcg\nc2hvcnRlbihTdHJpbmcgbmFtZSwgaW50IHRhcmdldExlbmd0aCkgewogICAg\nICAgIGlmIChuYW1lID09IG51bGwgfHwgbmFtZS5sZW5ndGgoKSA8PSB0YXJn\nZXRMZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBuYW1lOwoKICAgICAgICBT\ndHJpbmdCdWlsZGVyIG5tID0gbmV3IFN0cmluZ0J1aWxkZXIobmFtZSk7CiAg\nICAgICAgd2hpbGUgKG5tLmxlbmd0aCgpID4gdGFyZ2V0TGVuZ3RoKSB7CiAg\nICAgICAgICAgIGlmICghc3RyaXBWb3dlbChubSkpIHsKICAgICAgICAgICAg\nICAgIC8vIGN1dCBvdXQgdGhlIG1pZGRsZSBjaGFyCiAgICAgICAgICAgICAg\nICBubS5yZXBsYWNlKG5tLmxlbmd0aCgpIC8gMiwgKG5tLmxlbmd0aCgpIC8g\nMikgKyAxLCAiIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG5tLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgdm93ZWxzIGZyb20gdGhlIHNwZWNpZmllZCBTdHJpbmdCdWlsZGVy\nLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhbnkgdm93ZWxzIGhh\ndmUgYmVlbiByZW1vdmVkCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gc3RyaXBWb3dlbChTdHJpbmdCdWlsZGVyIG5hbWUpIHsKICAgICAg\nICBpZiAobmFtZSA9PSBudWxsIHx8IG5hbWUubGVuZ3RoKCkgPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBjaGFyW10gdm93ZWxz\nID0geyAnQScsICdFJywgJ0knLCAnTycsICdVJywgfTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHZvd2Vscy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpbnQgaW5kZXggPSBuYW1lLnRvU3RyaW5nKCkudG9VcHBlckNhc2Uo\nKS5pbmRleE9mKHZvd2Vsc1tpXSk7CiAgICAgICAgICAgIGlmIChpbmRleCAh\nPSAtMSkgewogICAgICAgICAgICAgICAgbmFtZS5yZXBsYWNlKGluZGV4LCBp\nbmRleCArIDEsICIiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW5zIHRoZSBnaXZlbiBuYW1l\nIHRvIHRoZSBnaXZlbiBtYXhpbXVtIGxlbmd0aCwgdGhlbiBjaGVja3MgdGhh\ndAogICAgICogaXQgaXMgbm90IGEgcmVzZXJ2ZWQgd29yZC4gSWYgaXQgaXMg\ncmVzZXJ2ZWQsIGFwcGVuZHMgYSAiMCIuIElmCiAgICAgKiB0aGUgbmFtZSBj\nb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBzY2hlbWEgY29tcG9uZW50LCB0\naGUgbGFzdAogICAgICogY2hhcmFjdGVyIGlzIHJlcGxhY2Ugd2l0aCAnMCcs\nIHRoZW4gJzEnLCBldGMuCiAgICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1h\neCBsZW4gbWF5IGJlIDAgaWYgdGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzCiAg\nICAgKiBpbmNvbXBsZXRlLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0cmluZyBtYWtlTmFtZVZhbGlkKFN0cmluZyBuYW1l\nLCBOYW1lU2V0IHNldCwgaW50IG1heExlbiwKICAgICAgICBpbnQgbmFtZVR5\ncGUpIHsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCBzZXQs\nIG1heExlbiwgbmFtZVR5cGUsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2hvcnRlbnMgdGhlIGdpdmVuIG5hbWUgdG8gdGhlIGdpdmVuIG1heGlt\ndW0gbGVuZ3RoLCB0aGVuIGNoZWNrcyB0aGF0CiAgICAgKiBpdCBpcyBub3Qg\nYSByZXNlcnZlZCB3b3JkLiBJZiBpdCBpcyByZXNlcnZlZCwgYXBwZW5kcyBh\nICIwIi4gSWYKICAgICAqIHRoZSBuYW1lIGNvbmZsaWN0cyB3aXRoIGFuIGV4\naXN0aW5nIHNjaGVtYSBjb21wb25lbnQsIHRoZSBsYXN0CiAgICAgKiBjaGFy\nYWN0ZXIgaXMgcmVwbGFjZSB3aXRoICcwJywgdGhlbiAnMScsIGV0Yy4KICAg\nICAqIE5vdGUgdGhhdCB0aGUgZ2l2ZW4gbWF4IGxlbiBtYXkgYmUgMCBpZiB0\naGUgZGF0YWJhc2UgbWV0YWRhdGEgaXMKICAgICAqIGluY29tcGxldGUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBEQklkZW50aWZpZXIgbWFrZU5hbWVWYWxp\nZChEQklkZW50aWZpZXIgbmFtZSwgTmFtZVNldCBzZXQsIGludCBtYXhMZW4s\nCiAgICAgICAgaW50IG5hbWVUeXBlKSB7CiAgICAgICAgcmV0dXJuIG1ha2VO\nYW1lVmFsaWQobmFtZSwgc2V0LCBtYXhMZW4sIG5hbWVUeXBlLCB0cnVlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW5zIHRoZSBnaXZlbiBuYW1l\nIHRvIHRoZSBnaXZlbiBtYXhpbXVtIGxlbmd0aCwgdGhlbiBjaGVja3MgdGhh\ndAogICAgICogaXQgaXMgbm90IGEgcmVzZXJ2ZWQgd29yZC4gSWYgaXQgaXMg\ncmVzZXJ2ZWQsIGFwcGVuZHMgYSAiMCIuIElmCiAgICAgKiB0aGUgbmFtZSBj\nb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBzY2hlbWEgY29tcG9uZW50IGFu\nZCB1bmlxdWVuZXNzCiAgICAgKiBjaGVja2luZyBpcyBlbmFibGVkLCB0aGUg\nbGFzdCBjaGFyYWN0ZXIgaXMgcmVwbGFjZSB3aXRoICcwJywgdGhlbiAKICAg\nICAqICcxJywgZXRjLiAKICAgICAqIE5vdGUgdGhhdCB0aGUgZ2l2ZW4gbWF4\nIGxlbiBtYXkgYmUgMCBpZiB0aGUgZGF0YWJhc2UgbWV0YWRhdGEgaXMgCiAg\nICAgKiBpbmNvbXBsZXRlLgogICAgICogCiAgICAgKiBOb3RlOiBJZiB0aGUg\nbmFtZSBpcyBkZWxpbWl0ZWQsIG1ha2Ugc3VyZSB0aGUgZW5kaW5nIGRlbGlt\naXRlciBpcwogICAgICogbm90IHN0cmlwcGVkIG9mZi4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFN0cmluZyBtYWtlTmFtZVZhbGlkKFN0cmluZyBuYW1lLCBO\nYW1lU2V0IHNldCwgaW50IG1heExlbiwKICAgICAgICBpbnQgbmFtZVR5cGUs\nIGJvb2xlYW4gY2hlY2tGb3JVbmlxdWVuZXNzKSB7CiAgICAgICAgcmV0dXJu\nIG5hbWluZ1V0aWwubWFrZU5hbWVWYWxpZChuYW1lLCBzZXQsCiAgICAgICAg\nICAgIG1heExlbiwgbmFtZVR5cGUsIGNoZWNrRm9yVW5pcXVlbmVzcykudG9T\ndHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW5zIHRoZSBn\naXZlbiBuYW1lIHRvIHRoZSBnaXZlbiBtYXhpbXVtIGxlbmd0aCwgdGhlbiBj\naGVja3MgdGhhdAogICAgICogaXQgaXMgbm90IGEgcmVzZXJ2ZWQgd29yZC4g\nSWYgaXQgaXMgcmVzZXJ2ZWQsIGFwcGVuZHMgYSAiMCIuIElmCiAgICAgKiB0\naGUgbmFtZSBjb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBzY2hlbWEgY29t\ncG9uZW50IGFuZCB1bmlxdWVuZXNzCiAgICAgKiBjaGVja2luZyBpcyBlbmFi\nbGVkLCB0aGUgbGFzdCBjaGFyYWN0ZXIgaXMgcmVwbGFjZSB3aXRoICcwJywg\ndGhlbiAKICAgICAqICcxJywgZXRjLiAKICAgICAqIE5vdGUgdGhhdCB0aGUg\nZ2l2ZW4gbWF4IGxlbiBtYXkgYmUgMCBpZiB0aGUgZGF0YWJhc2UgbWV0YWRh\ndGEgaXMgCiAgICAgKiBpbmNvbXBsZXRlLgogICAgICogCiAgICAgKiBOb3Rl\nOiBJZiB0aGUgbmFtZSBpcyBkZWxpbWl0ZWQsIG1ha2Ugc3VyZSB0aGUgZW5k\naW5nIGRlbGltaXRlciBpcwogICAgICogbm90IHN0cmlwcGVkIG9mZi4KICAg\nICAqLwogICAgcHJvdGVjdGVkIERCSWRlbnRpZmllciBtYWtlTmFtZVZhbGlk\nKERCSWRlbnRpZmllciBuYW1lLCBOYW1lU2V0IHNldCwgaW50IG1heExlbiwK\nICAgICAgICBpbnQgbmFtZVR5cGUsIGJvb2xlYW4gY2hlY2tGb3JVbmlxdWVu\nZXNzKSB7CiAgICAgICAgcmV0dXJuIG5hbWluZ1V0aWwubWFrZUlkZW50aWZp\nZXJWYWxpZChuYW1lLCBzZXQsCiAgICAgICAgICAgIG1heExlbiwgY2hlY2tG\nb3JVbmlxdWVuZXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBjcmVhdGUgdGhlIGdpdmVu\nIHRhYmxlLCBjb21wbGV0ZQogICAgICogd2l0aCBjb2x1bW5zLiBJbmRleGVz\nIGFuZCBjb25zdHJhaW50cyB3aWxsIGJlIGNyZWF0ZWQgc2VwYXJhdGVseS4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldENyZWF0ZVRhYmxlU1FM\nKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBu\nZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIFN0cmluZyB0YWJsZU5hbWUg\nPSBjaGVja05hbWVMZW5ndGgoZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSwg\nCiAgICAgICAgICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGgsICJsb25nLXRh\nYmxlLW5hbWUiKTsKICAgICAgICBidWYuYXBwZW5kKCJDUkVBVEUgVEFCTEUg\nIikuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgaWYgKHN1cHBvcnRzQ29t\nbWVudHMgJiYgdGFibGUuaGFzQ29tbWVudCgpKSB7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiAiKTsKICAgICAgICAgICAgY29tbWVudChidWYsIHRhYmxl\nLmdldENvbW1lbnQoKSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAg\nICgiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgKCIpOwogICAgICAgIH0KCiAgICAgICAgLy8gZG8gdGhpcyBiZWZvcmUg\nZ2V0dGluZyB0aGUgY29sdW1ucyBzbyB3ZSBrbm93IGhvdyB0byBoYW5kbGUK\nICAgICAgICAvLyB0aGUgbGFzdCBjb21tYQogICAgICAgIFN0cmluZ0J1aWxk\nZXIgZW5kQnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBQcmlt\nYXJ5S2V5IHBrID0gdGFibGUuZ2V0UHJpbWFyeUtleSgpOwogICAgICAgIFN0\ncmluZyBwa1N0cjsKICAgICAgICBpZiAocGsgIT0gbnVsbCkgewogICAgICAg\nICAgICBwa1N0ciA9IGdldFByaW1hcnlLZXlDb25zdHJhaW50U1FMKHBrKTsK\nICAgICAgICAgICAgaWYgKHBrU3RyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBlbmRCdWYuYXBwZW5kKHBrU3RyKTsKICAgICAgICB9CgogICAgICAgIFVu\naXF1ZVtdIHVucXMgPSB0YWJsZS5nZXRVbmlxdWVzKCk7CiAgICAgICAgU3Ry\naW5nIHVucVN0cjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHVucXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdW5xU3RyID0gZ2V0VW5pcXVl\nQ29uc3RyYWludFNRTCh1bnFzW2ldKTsKICAgICAgICAgICAgaWYgKHVucVN0\nciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZW5kQnVmLmxlbmd0\naCgpID4gMCkKICAgICAgICAgICAgICAgICAgICBlbmRCdWYuYXBwZW5kKCIs\nICIpOwogICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVuZCh1bnFTdHIpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBidWYuYXBw\nZW5kKGdldERlY2xhcmVDb2x1bW5TUUwoY29sc1tpXSwgZmFsc2UpKTsKICAg\nICAgICAgICAgaWYgKGkgPCBjb2xzLmxlbmd0aCAtIDEgfHwgZW5kQnVmLmxl\nbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7\nCiAgICAgICAgICAgIGlmIChzdXBwb3J0c0NvbW1lbnRzICYmIGNvbHNbaV0u\naGFzQ29tbWVudCgpKSB7CiAgICAgICAgICAgICAgICBjb21tZW50KGJ1Ziwg\nY29sc1tpXS5nZXRDb21tZW50KCkpOwogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiXG4gICAgIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGJ1Zi5hcHBlbmQoZW5kQnVmLnRvU3RyaW5nKCkpOwogICAgICAgIGJ1\nZi5hcHBlbmQoIikiKTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBi\ndWYudG9TdHJpbmcoKSB9OwogICAgfQogICAgCiAgICBwdWJsaWMgaW50IGdl\ndEJhdGNoRmV0Y2hTaXplKGludCBiYXRjaEZldGNoU2l6ZSkgewogICAgICAg\nIHJldHVybiBiYXRjaEZldGNoU2l6ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nU3RyaW5nQnVpbGRlciBjb21tZW50KFN0cmluZ0J1aWxkZXIgYnVmLCBTdHJp\nbmcgY29tbWVudCkgewogICAgICAgIHJldHVybiBidWYuYXBwZW5kKCItLSAi\nKS5hcHBlbmQoY29tbWVudCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2\nZW4gdGFibGUuIEluZGV4ZXMKICAgICAqIHdpbGwgYmUgZHJvcHBlZCBzZXBh\ncmF0ZWx5LiBSZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIFRBQkxFICZsdDt0\nYWJsZSBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZ1tdIGdldERyb3BUYWJsZVNRTChUYWJsZSB0YWJsZSkg\newogICAgICAgIFN0cmluZyBkcm9wID0gTWVzc2FnZUZvcm1hdC5mb3JtYXQo\nZHJvcFRhYmxlU1FMLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgIGdldEZ1\nbGxOYW1lKHRhYmxlLCBmYWxzZSkgfSk7CiAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbXXsgZHJvcCB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2\nZW4gc2VxdWVuY2UuIFJldHVybnMKICAgICAqIDxjb2RlPkNSRUFURSBTRVFV\nRU5DRSAmbHQ7c2VxdWVuY2UgbmFtZSZndDtbIFNUQVJUIFdJVEggJmx0O3N0\nYXJ0Jmd0O10KICAgICAqIFsgSU5DUkVNRU5UIEJZICZsdDtpbmNyZW1lbnQm\nZ3Q7XTwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZ1tdIGdldENyZWF0ZVNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkgewog\nICAgICAgIGlmIChuZXh0U2VxdWVuY2VRdWVyeSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYg\nPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNS\nRUFURSBTRVFVRU5DRSAiKTsKICAgICAgICBTdHJpbmcgc2VxTmFtZSA9IGNo\nZWNrTmFtZUxlbmd0aChnZXRGdWxsTmFtZShzZXEpLCBtYXhUYWJsZU5hbWVM\nZW5ndGgsIAogICAgICAgICAgICAgICAgImxvbmctc2VxLW5hbWUiKTsKICAg\nICAgICBidWYuYXBwZW5kKHNlcU5hbWUpOwogICAgICAgIGlmIChzZXEuZ2V0\nSW5pdGlhbFZhbHVlKCkgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIFNUQVJUIFdJVEggIikuYXBwZW5kKHNlcS5nZXRJbml0aWFsVmFsdWUoKSk7\nCiAgICAgICAgaWYgKHNlcS5nZXRJbmNyZW1lbnQoKSA+IDEpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBJTkNSRU1FTlQgQlkgIikuYXBwZW5kKHNlcS5n\nZXRJbmNyZW1lbnQoKSk7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsg\nYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZl\nbiBzZXF1ZW5jZS4gUmV0dXJucwogICAgICogPGNvZGU+RFJPUCBTRVFVRU5D\nRSAmbHQ7c2VxdWVuY2UgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wU2VxdWVuY2VTUUwo\nU2VxdWVuY2Ugc2VxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsg\nIkRST1AgU0VRVUVOQ0UgIiArIGdldEZ1bGxOYW1lKHNlcSkgfTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVt\nZW50cyB0byBjcmVhdGUgdGhlIGdpdmVuIGluZGV4LiBSZXR1cm5zCiAgICAg\nKiA8Y29kZT5DUkVBVEUgW1VOSVFVRV0gSU5ERVggJmx0O2luZGV4IG5hbWUm\nZ3Q7IE9OICZsdDt0YWJsZSBuYW1lJmd0OwogICAgICogKCZsdDtjb2wgbGlz\ndCZndDspPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nW10gZ2V0Q3JlYXRlSW5kZXhTUUwoSW5kZXggaW5kZXgpIHsKICAg\nICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFICIpOwogICAgICAgIGlmIChp\nbmRleC5pc1VuaXF1ZSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJVTklR\nVUUgIik7CiAgICAgICAgU3RyaW5nIGluZGV4TmFtZSA9IGNoZWNrTmFtZUxl\nbmd0aCh0b0RCTmFtZShpbmRleC5nZXRJZGVudGlmaWVyKCkpLCBtYXhJbmRl\neE5hbWVMZW5ndGgsIAogICAgICAgICAgICAgICAgImxvbmctaW5kZXgtbmFt\nZSIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIklOREVYICIpLmFwcGVuZChpbmRl\neE5hbWUpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAiKS5hcHBlbmQoZ2V0\nRnVsbE5hbWUoaW5kZXguZ2V0VGFibGUoKSwgZmFsc2UpKTsKICAgICAgICBi\ndWYuYXBwZW5kKCIgKCIpLmFwcGVuZChuYW1pbmdVdGlsLmFwcGVuZENvbHVt\nbnMoaW5kZXguZ2V0Q29sdW1ucygpKSkuCiAgICAgICAgICAgIGFwcGVuZCgi\nKSIpOwoKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBidWYudG9TdHJp\nbmcoKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVz\nIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGluZGV4LiBS\nZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIElOREVYICZsdDtpbmRleCBuYW1l\nJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZ1tdIGdldERyb3BJbmRleFNRTChJbmRleCBpbmRleCkgewogICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nW117ICJEUk9QIElOREVYICIgKyBnZXRGdWxs\nTmFtZShpbmRleCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBhZGQgdGhlIGdpdmVuIGNv\nbHVtbiB0bwogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJy\nYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuIFJldHVybnMKICAgICAq\nIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBBREQgKCZs\ndDtjb2wgZGVjJmd0Oyk8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkQ29sdW1uU1FMKENvbHVt\nbiBjb2x1bW4pIHsKICAgICAgICBpZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdp\ndGhBZGRDb2x1bW4pCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBd\nOwoKICAgICAgICBTdHJpbmcgZGVjID0gZ2V0RGVjbGFyZUNvbHVtblNRTChj\nb2x1bW4sIHRydWUpOwogICAgICAgIGlmIChkZWMgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5l\ndyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRG\ndWxsTmFtZShjb2x1bW4uZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiAr\nIGRlYyB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVz\nIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGNvbHVtbiBm\ncm9tCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBp\nZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4gUmV0dXJucwogICAgICogPGNv\nZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IERST1AgQ09MVU1O\nICZsdDtjb2wgbmFtZSZndDs8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcENvbHVtblNRTChD\nb2x1bW4gY29sdW1uKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0FsdGVyVGFi\nbGVXaXRoRHJvcENvbHVtbikKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJp\nbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRB\nQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFi\nbGUoKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTFVNTiAiICsg\nY29sdW1uIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJp\nZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZlbiBwcmltYXJ5\nIGtleSB0bwogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJy\nYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5z\nIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBBREQKICAg\nICAqICZsdDtwayBjb25zIHNxbCAmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkUHJpbWFyeUtleVNR\nTChQcmltYXJ5S2V5IHBrKSB7CiAgICAgICAgU3RyaW5nIHBrc3FsID0gZ2V0\nUHJpbWFyeUtleUNvbnN0cmFpbnRTUUwocGspOwogICAgICAgIGlmIChwa3Nx\nbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsK\nICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgog\nICAgICAgICAgICArIGdldEZ1bGxOYW1lKHBrLmdldFRhYmxlKCksIGZhbHNl\nKSArICIgQUREICIgKyBwa3NxbCB9OwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhl\nIGdpdmVuIHByaW1hcnkga2V5IGZyb20KICAgICAqIGl0cyB0YWJsZS4gUmV0\ndXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVk\nLgogICAgICogUmV0dXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUg\nbmFtZSZndDsgRFJPUCBDT05TVFJBSU5UCiAgICAgKiAmbHQ7cGsgbmFtZSZn\ndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmdbXSBnZXREcm9wUHJpbWFyeUtleVNRTChQcmltYXJ5S2V5IHBrKSB7CiAg\nICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwocGsuZ2V0SWRlbnRpZmll\ncigpKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAg\nICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAg\nICAgICAgKyBnZXRGdWxsTmFtZShway5nZXRUYWJsZSgpLCBmYWxzZSkKICAg\nICAgICAgICAgKyAiIERST1AgQ09OU1RSQUlOVCAiICsgdG9EQk5hbWUocGsu\nZ2V0SWRlbnRpZmllcigpKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2\nZW4gZm9yZWlnbiBrZXkgdG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFu\nIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAg\nICogUmV0dXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZn\ndDsgQURECiAgICAgKiAmbHQ7ZmsgY29ucyBzcWwgJmd0OzwvY29kZT4gYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZEZv\ncmVpZ25LZXlTUUwoRm9yZWlnbktleSBmaykgewogICAgICAgIFN0cmluZyBm\na1NRTCA9IGdldEZvcmVpZ25LZXlDb25zdHJhaW50U1FMKGZrKTsKICAgICAg\nICBpZiAoZmtTUUwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVS\nIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShmay5nZXRUYWJs\nZSgpLCBmYWxzZSkgKyAiIEFERCAiICsgZmtTUUwgfTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0\nbyBkcm9wIHRoZSBnaXZlbiBmb3JlaWduIGtleSBmcm9tCiAgICAgKiBpdHMg\ndGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90\nIHN1cHBvcnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUg\nJmx0O3RhYmxlIG5hbWUmZ3Q7IERST1AgQ09OU1RSQUlOVAogICAgICogJmx0\nO2ZrIG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0RHJvcEZvcmVpZ25LZXlTUUwoRm9yZWlnbktl\neSBmaywgQ29ubmVjdGlvbiBjb25uKSB7CiAgICAgICAgaWYgKERCSWRlbnRp\nZmllci5pc051bGwoZmsuZ2V0SWRlbnRpZmllcigpKSkgewogICAgICAgICAg\nICBTdHJpbmdbXSByZXRWYWw7CiAgICAgICAgICAgIERCSWRlbnRpZmllciBm\na05hbWUgPSBmay5sb2FkSWRlbnRpZmllckZyb21EQih0aGlzLGNvbm4pOwog\nICAgICAgICAgICByZXRWYWwgPSAoZmtOYW1lID09IG51bGwpID8gIG5ldyBT\ndHJpbmdbMF0gOgogICAgICAgICAgICAgICAgbmV3IFN0cmluZ1tdeyAiQUxU\nRVIgVEFCTEUgIgogICAgICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShmay5n\nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAgICAgICsgIiBEUk9QIENP\nTlNUUkFJTlQgIiArIHRvREJOYW1lKGZrTmFtZSkgfTsKICAgICAgICAgICAg\ncmV0dXJuIHJldFZhbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxs\nTmFtZShmay5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAgKyAiIERS\nT1AgQ09OU1RSQUlOVCAiICsgdG9EQk5hbWUoZmsuZ2V0SWRlbnRpZmllcigp\nKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJh\ndGlvbiBTUUwgZm9yIHRoZSBnaXZlbiBjb2x1bW4uIFRoaXMgbWV0aG9kIGlz\nIHVzZWQKICAgICAqIGZvciBlYWNoIGNvbHVtbiBmcm9tIHdpdGhpbiB7QGxp\nbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQKICAgICAqIHtAbGluayAjZ2V0\nQWRkQ29sdW1uU1FMfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBn\nZXREZWNsYXJlQ29sdW1uU1FMKENvbHVtbiBjb2wsIGJvb2xlYW4gYWx0ZXIp\nIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWls\nZGVyKCk7CiAgICAgICAgU3RyaW5nIGNvbHVtbk5hbWUgPSBjaGVja05hbWVM\nZW5ndGgodG9EQk5hbWUoY29sLmdldElkZW50aWZpZXIoKSksIG1heENvbHVt\nbk5hbWVMZW5ndGgsIAogICAgICAgICAgICAgICAgImxvbmctY29sdW1uLW5h\nbWUiKTsKICAgICAgICBidWYuYXBwZW5kKGNvbHVtbk5hbWUpLmFwcGVuZCgi\nICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5hbWUoY29sKSk7Cgog\nICAgICAgIC8vIGNhbid0IGFkZCBjb25zdHJhaW50cyB0byBhIGNvbHVtbiB3\nZSdyZSBhZGRpbmcgYWZ0ZXIgdGFibGUKICAgICAgICAvLyBjcmVhdGlvbiwg\nY2F1c2Ugc29tZSBkYXRhIG1pZ2h0IGFscmVhZHkgYmUgaW5zZXJ0ZWQKICAg\nICAgICBpZiAoIWFsdGVyKSB7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RGVm\nYXVsdFN0cmluZygpICE9IG51bGwgJiYgIWNvbC5pc0F1dG9Bc3NpZ25lZCgp\nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIERFRkFVTFQgIikuYXBw\nZW5kKGNvbC5nZXREZWZhdWx0U3RyaW5nKCkpOwogICAgICAgICAgICBpZiAo\nY29sLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIE5PVCBOVUxMIik7CiAgICAgICAgfQogICAgICAgIGlmIChjb2wuaXNBdXRv\nQXNzaWduZWQoKSkgewogICAgICAgICAgICBpZiAoIXN1cHBvcnRzQXV0b0Fz\nc2lnbikKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJpbnZh\nbGlkLWF1dG9hc3NpZ24iLCBwbGF0Zm9ybSwgY29sKSk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKGF1dG9Bc3NpZ25DbGF1c2UgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQoYXV0b0Fzc2lnbkNsYXVz\nZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRpb24g\nU1FMIGZvciB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkuIFRoaXMgbWV0aG9kIGlz\nCiAgICAgKiB1c2VkIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRlVGFi\nbGVTUUx9IGFuZAogICAgICoge0BsaW5rICNnZXRBZGRQcmltYXJ5S2V5U1FM\nfS4gUmV0dXJucwogICAgICogPGNvZGU+Q09OU1RSQUlOVCAmbHQ7cGsgbmFt\nZSZndDsgUFJJTUFSWSBLRVkgKCZsdDtjb2wgbGlzdCZndDspPC9jb2RlPgog\nICAgICogYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmlu\nZyBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChQcmltYXJ5S2V5IHBrKSB7\nCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBkaXNhYmxlZCB0aGUgY3JlYXRpb24g\nb2YgcHJpbWFyeSBrZXlzLCBhYm9ydCBoZXJlCiAgICAgICAgaWYgKCFjcmVh\ndGVQcmltYXJ5S2V5cykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIFN0cmluZyBuYW1lID0gdG9EQk5hbWUocGsuZ2V0SWRlbnRpZmllcigp\nKTsKICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIHJlc2VydmVkV29yZFNl\ndC5jb250YWlucyhuYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICBu\nYW1lID0gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBuZXcg\nU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYg\nQ09OU19OQU1FX0JFRk9SRS5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5hcHBlbmQo\nbmFtZSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiUFJJTUFS\nWSBLRVkgIik7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05B\nTUVfTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKG5hbWUpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIigiKS5hcHBlbmQobmFtaW5nVXRpbC5hcHBlbmRDb2x1bW5zKHBr\nLmdldENvbHVtbnMoKSkpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsKICAg\nICAgICBpZiAobmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9BRlRFUi5lcXVh\nbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIENPTlNUUkFJTlQgIikuYXBwZW5kKG5hbWUpOwogICAgICAgIHJldHVy\nbiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZGVjbGFyYXRpb24gU1FMIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBr\nZXksIG9yIG51bGwgaWYgaXQgaXMKICAgICAqIG5vdCBzdXBwb3J0ZWQuIFRo\naXMgbWV0aG9kIGlzIHVzZWQgZnJvbSB3aXRoaW4KICAgICAqIHtAbGluayAj\nZ2V0Q3JlYXRlVGFibGVTUUx9IGFuZCB7QGxpbmsgI2dldEFkZEZvcmVpZ25L\nZXlTUUx9LiBSZXR1cm5zCiAgICAgKiA8Y29kZT5DT05TVFJBSU5UICZsdDtj\nb25zIG5hbWUmZ3Q7IEZPUkVJR04gS0VZICgmbHQ7Y29sIGxpc3QmZ3Q7KQog\nICAgICogUkVGRVJFTkNFUyAmbHQ7Zm9yZWlnbiB0YWJsZSZndDsgKCZsdDtj\nb2wgbGlzdCZndDspCiAgICAgKiBbT04gREVMRVRFICZsdDthY3Rpb24mZ3Q7\nXSBbT04gVVBEQVRFICZsdDthY3Rpb24mZ3Q7XTwvY29kZT4gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRGb3JlaWduS2V5\nQ29uc3RyYWludFNRTChGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgaWYgKCFz\ndXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoZmsuZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDAgJiYgIXN1\ncHBvcnRzRm9yZWlnbktleXNDb21wb3NpdGUpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChmay5nZXREZWxldGVBY3Rpb24oKSA9PSBG\nb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpZiAoZmsuaXNEZWZlcnJlZCgpICYmICFzdXBwb3J0c0Rl\nZmVycmVkRm9yZWlnbktleUNvbnN0cmFpbnRzKCkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIGlmICghc3VwcG9ydHNEZWxldGVBY3Rpb24o\nZmsuZ2V0RGVsZXRlQWN0aW9uKCkpCiAgICAgICAgICAgIHx8ICFzdXBwb3J0\nc1VwZGF0ZUFjdGlvbihmay5nZXRVcGRhdGVBY3Rpb24oKSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1bW5bXSBsb2NhbHMgPSBm\nay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gZm9yZWlnbnMgPSBm\nay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICBpbnQgZGVsQWN0\naW9uSWQgPSBmay5nZXREZWxldGVBY3Rpb24oKTsKICAgICAgICBpZiAoZGVs\nQWN0aW9uSWQgPT0gRm9yZWlnbktleS5BQ1RJT05fTlVMTCkgewogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxvY2Fscy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKGxvY2Fsc1tpXS5pc05vdE51bGwoKSkK\nICAgICAgICAgICAgICAgICAgICBkZWxBY3Rpb25JZCA9IEZvcmVpZ25LZXku\nQUNUSU9OX05PTkU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIFN0cmluZyBkZWxBY3Rpb24gPSBnZXRBY3Rpb25OYW1lKGRlbEFjdGlvbklk\nKTsKICAgICAgICBTdHJpbmcgdXBBY3Rpb24gPSBnZXRBY3Rpb25OYW1lKGZr\nLmdldFVwZGF0ZUFjdGlvbigpKTsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBi\ndWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGlmICghREJJZGVu\ndGlmaWVyLmlzTnVsbChmay5nZXRJZGVudGlmaWVyKCkpCiAgICAgICAgICAg\nICYmIENPTlNfTkFNRV9CRUZPUkUuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9k\nZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNPTlNUUkFJTlQgIikuYXBw\nZW5kKHRvREJOYW1lKGZrLmdldElkZW50aWZpZXIoKSkpLmFwcGVuZCgiICIp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIkZPUkVJR04gS0VZICIpOwogICAgICAg\nIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChmay5nZXRJZGVudGlmaWVyKCkp\nICYmIENPTlNfTkFNRV9NSUQuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQodG9EQk5hbWUoZmsuZ2V0SWRlbnRp\nZmllcigpKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nLmFwcGVuZChuYW1pbmdVdGlsLmFwcGVuZENvbHVtbnMobG9jYWxzKSkuYXBw\nZW5kKCIpIik7CiAgICAgICAgYnVmLmFwcGVuZCgiIFJFRkVSRU5DRVMgIik7\nCiAgICAgICAgYnVmLmFwcGVuZChnZXRGdWxsTmFtZShmb3JlaWduc1swXS5n\nZXRUYWJsZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAoIiku\nYXBwZW5kKG5hbWluZ1V0aWwuYXBwZW5kQ29sdW1ucyhmb3JlaWducykpLmFw\ncGVuZCgiKSIpOwogICAgICAgIGlmIChkZWxBY3Rpb24gIT0gbnVsbCkKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIE9OIERFTEVURSAiKS5hcHBlbmQoZGVs\nQWN0aW9uKTsKICAgICAgICBpZiAodXBBY3Rpb24gIT0gbnVsbCkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIE9OIFVQREFURSAiKS5hcHBlbmQodXBBY3Rp\nb24pOwogICAgICAgIGlmIChmay5pc0RlZmVycmVkKCkpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBJTklUSUFMTFkgREVGRVJSRUQiKTsKICAgICAgICBp\nZiAoc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25LZXlDb25zdHJhaW50cygpKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgREVGRVJSQUJMRSIpOwogICAgICAg\nIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChmay5nZXRJZGVudGlmaWVyKCkp\nCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9BRlRFUi5lcXVhbHMoY29uc3Ry\nYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIENPTlNU\nUkFJTlQgIikuYXBwZW5kKHRvREJOYW1lKGZrLmdldElkZW50aWZpZXIoKSkp\nOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgb3Igbm90IHRoaXMgZGljdGlvbmFyeSBzdXBw\nb3J0cyBkZWZlcnJlZCBmb3JlaWduIGtleSBjb25zdHJhaW50cy4KICAgICAq\nIFRoaXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB7QGxpbmsgI3N1cHBvcnRz\nVW5pcXVlQ29uc3RyYWludHN9LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEu\nMAogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdXBwb3J0c0RlZmVy\ncmVkRm9yZWlnbktleUNvbnN0cmFpbnRzKCkgewogICAgICAgIHJldHVybiBz\ndXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIGdpdmVuIGZvcmVpZ24ga2V5\nIGFjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0QWN0aW9u\nTmFtZShpbnQgYWN0aW9uKSB7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsK\nICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9DQVNDQURFOgog\nICAgICAgICAgICAgICAgcmV0dXJuICJDQVNDQURFIjsKICAgICAgICAgICAg\nY2FzZSBGb3JlaWduS2V5LkFDVElPTl9OVUxMOgogICAgICAgICAgICAgICAg\ncmV0dXJuICJTRVQgTlVMTCI7CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktl\neS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiAiU0VU\nIERFRkFVTFQiOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGlzIGRhdGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBm\nb3JlaWduIGtleSBkZWxldGUgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0RlbGV0ZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAg\nICAgICAgaWYgKGFjdGlvbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIXN1cHBvcnRz\nRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIEZvcmVpZ25L\nZXkuQUNUSU9OX1JFU1RSSUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncHBvcnRzUmVzdHJpY3REZWxldGVBY3Rpb247CiAgICAgICAgICAgIGNhc2Ug\nRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBwb3J0c0Nhc2NhZGVEZWxldGVBY3Rpb247CiAgICAgICAgICAg\nIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb247CiAgICAgICAgICAg\nIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBwb3J0c0RlZmF1bHREZWxldGVBY3Rpb247CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlz\nIGRhdGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBmb3JlaWduIGtleSB1cGRh\ndGUgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc1VwZGF0ZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAgICAgICAgaWYgKGFjdGlv\nbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGFjdGlv\nbikgewogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RS\nSUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzUmVzdHJpY3RV\ncGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJ\nT05fQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0Nh\nc2NhZGVVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktl\neS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0\nc051bGxVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktl\neS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBw\nb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwg\nZm9yIHRoZSBnaXZlbiB1bmlxdWUgY29uc3RyYWludC4gVGhpcwogICAgICog\nbWV0aG9kIGlzIHVzZWQgZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRDcmVhdGVU\nYWJsZVNRTH0uCiAgICAgKiBSZXR1cm5zIDxjb2RlPkNPTlNUUkFJTlQgJmx0\nO25hbWUmZ3Q7IFVOSVFVRSAoJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+CiAg\nICAgKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5n\nIGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwoVW5pcXVlIHVucSkgewogICAgICAg\nIGlmICghc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50cwogICAgICAgICAgICB8\nfCAodW5xLmlzRGVmZXJyZWQoKSAmJiAhc3VwcG9ydHNEZWZlcnJlZFVuaXF1\nZUNvbnN0cmFpbnRzKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7\nCiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHVucS5nZXRJZGVu\ndGlmaWVyKCkpCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9CRUZPUkUuZXF1\nYWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKGNoZWNrTmFtZUxlbmd0aCh0b0RC\nTmFtZSh1bnEuZ2V0SWRlbnRpZmllcigpKSwgCiAgICAgICAgICAgICAgICBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgImxvbmctY29uc3RyYWludC1uYW1l\nIikpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlVOSVFVRSAi\nKTsKICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwodW5xLmdldElk\nZW50aWZpZXIoKSkgJiYgQ09OU19OQU1FX01JRC5lcXVhbHMoY29uc3RyYWlu\ndE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCh0b0RCTmFtZSh1\nbnEuZ2V0SWRlbnRpZmllcigpKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVm\nLmFwcGVuZCgiKCIpLmFwcGVuZChuYW1pbmdVdGlsLmFwcGVuZENvbHVtbnMo\ndW5xLmdldENvbHVtbnMoKSkpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsK\nICAgICAgICBpZiAodW5xLmlzRGVmZXJyZWQoKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIElOSVRJQUxMWSBERUZFUlJFRCIpOwogICAgICAgIGlmIChz\ndXBwb3J0c0RlZmVycmVkVW5pcXVlQ29uc3RyYWludHMoKSkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAoIURC\nSWRlbnRpZmllci5pc051bGwodW5xLmdldElkZW50aWZpZXIoKSkKICAgICAg\nICAgICAgJiYgQ09OU19OQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFt\nZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAi\nKS5hcHBlbmQodG9EQk5hbWUodW5xLmdldElkZW50aWZpZXIoKSkpOwogICAg\nICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgb3Igbm90IHRoaXMgZGljdGlvbmFyeSBzdXBwb3J0cyBk\nZWZlcnJlZCB1bmlxdWUgY29uc3RyYWludHMuCiAgICAgKiBUaGlzIGltcGxl\nbWVudGF0aW9uIHJldHVybnMge0BsaW5rICNzdXBwb3J0c1VuaXF1ZUNvbnN0\ncmFpbnRzfS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwog\nICAgcHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZFVuaXF1ZUNv\nbnN0cmFpbnRzKCkgewogICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmVycmVk\nQ29uc3RyYWludHM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBEYXRhYmFzZSBtZXRhZGF0YQogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRv\nIGZpbHRlciBzeXN0ZW0gdGFibGVzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEu\nCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdGFibGUgbmFtZSBy\nZXByZXNlbnRzIGEgc3lzdGVtIHRhYmxlIHRoYXQKICAgICAqIHNob3VsZCBu\nb3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gQnkgZGVmYXVs\ndCwgcmV0dXJucwogICAgICogdHJ1ZSBvbmx5IGlmIHRoZSBnaXZlbiB0YWJs\nZSBpcyBpbiB0aGUgaW50ZXJuYWwgbGlzdCBvZiBzeXN0ZW0gdGFibGVzLAog\nICAgICogb3IgaWYgdGhlIGdpdmVuIHNjaGVtYSBpcyBpbiB0aGUgbGlzdCBv\nZiBzeXN0ZW0gc2NoZW1hcyBhbmQgaXMgbm90CiAgICAgKiB0aGUgdGFyZ2V0\nIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUg\nbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2NoZW1hOyBt\nYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBpZiB0cnVl\nLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQogICAgICog\ndGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKiBAZGVwcmVj\nYXRlZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbVRhYmxl\nKFN0cmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAogICAgICAgIGJvb2xlYW4g\ndGFyZ2V0U2NoZW1hKSB7CiAgICAgICAgcmV0dXJuIGlzU3lzdGVtVGFibGUo\nREJJZGVudGlmaWVyLm5ld1RhYmxlKG5hbWUpLAogICAgICAgICAgICBEQklk\nZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYSksIHRhcmdldFNjaGVtYSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZp\nbHRlciBzeXN0ZW0gdGFibGVzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdGFibGUgbmFtZSByZXBy\nZXNlbnRzIGEgc3lzdGVtIHRhYmxlIHRoYXQKICAgICAqIHNob3VsZCBub3Qg\nYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gQnkgZGVmYXVsdCwg\ncmV0dXJucwogICAgICogdHJ1ZSBvbmx5IGlmIHRoZSBnaXZlbiB0YWJsZSBp\ncyBpbiB0aGUgaW50ZXJuYWwgbGlzdCBvZiBzeXN0ZW0gdGFibGVzLAogICAg\nICogb3IgaWYgdGhlIGdpdmVuIHNjaGVtYSBpcyBpbiB0aGUgbGlzdCBvZiBz\neXN0ZW0gc2NoZW1hcyBhbmQgaXMgbm90CiAgICAgKiB0aGUgdGFyZ2V0IHNj\naGVtYS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUgbmFt\nZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2NoZW1hOyBtYXkg\nYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBpZiB0cnVlLCB0\naGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQogICAgICogdGhl\nIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGlzU3lzdGVtVGFibGUoREJJZGVudGlmaWVyIG5hbWUsIERC\nSWRlbnRpZmllciBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hl\nbWEpIHsKICAgICAgICBEQklkZW50aWZpZXIgc05hbWUgPSBEQklkZW50aWZp\nZXIudG9VcHBlcihuYW1lKTsKICAgICAgICBpZiAoc3lzdGVtVGFibGVTZXQu\nY29udGFpbnMoc05hbWUuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgREJJZGVudGlmaWVyIHNjaE5hbWUgPSBEQklkZW50\naWZpZXIudG9VcHBlcihzY2hlbWEpOwogICAgICAgIHJldHVybiAhdGFyZ2V0\nU2NoZW1hICYmIHNjaGVtYSAhPSBudWxsCiAgICAgICAgICAgICYmIHN5c3Rl\nbVNjaGVtYVNldC5jb250YWlucyhzY2hOYW1lLmdldE5hbWUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRl\nciBzeXN0ZW0gaW5kZXhlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluZGV4IG5hbWUgcmVwcmVz\nZW50cyBhIHN5c3RlbSBpbmRleCB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFw\ncGVhciBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIFJldHVybnMgZmFsc2Ug\nYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgaW5k\nZXggbmFtZQogICAgICogQHBhcmFtIHRhYmxlIHRoZSBpbmRleCB0YWJsZQog\nICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\naXNTeXN0ZW1JbmRleChTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nVGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIGluZGV4ZXMg\nZnJvbSBkYXRhYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlm\nIHRoZSBnaXZlbiBpbmRleCBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0gaW5k\nZXggdGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVt\nYSBkZWZpbml0aW9uLiBSZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQuCiAgICAg\nKgogICAgICogQHBhcmFtIG5hbWUgdGhlIGluZGV4IG5hbWUKICAgICAqIEBw\nYXJhbSB0YWJsZSB0aGUgaW5kZXggdGFibGUKICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gaXNTeXN0ZW1JbmRleChEQklkZW50aWZpZXIgbmFtZSwgVGFi\nbGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRlciBzeXN0\nZW0gc2VxdWVuY2VzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gc2VxdWVuY2UgcmVwcmVzZW50cyBh\nIHN5c3RlbSBzZXF1ZW5jZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVh\nciBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIFJldHVybnMgdHJ1ZSBpZiBz\neXN0ZW0KICAgICAqIHNjaGVtYSBieSBkZWZhdWx0LgogICAgICoKICAgICAq\nIEBwYXJhbSBuYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2No\nZW1hIHRoZSB0YWJsZSBzY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFy\nYW0gdGFyZ2V0U2NoZW1hIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVt\nYSB3YXMgbGlzdGVkIGJ5CiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlz\nIHNjaGVtYXMKICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3RyaW5nIG5hbWUsIFN0cmlu\nZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAg\nICAgICByZXR1cm4gaXNTeXN0ZW1TZXF1ZW5jZShEQklkZW50aWZpZXIubmV3\nU2VxdWVuY2UobmFtZSksIAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3\nU2NoZW1hKHNjaGVtYSksIHRhcmdldFNjaGVtYSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRlciBzeXN0ZW0g\nc2VxdWVuY2VzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1\ncm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gc2VxdWVuY2UgcmVwcmVzZW50cyBhIHN5\nc3RlbSBzZXF1ZW5jZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVhciBp\nbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIFJldHVybnMgdHJ1ZSBpZiBzeXN0\nZW0KICAgICAqIHNjaGVtYSBieSBkZWZhdWx0LgogICAgICoKICAgICAqIEBw\nYXJhbSBuYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2NoZW1h\nIHRoZSB0YWJsZSBzY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0g\ndGFyZ2V0U2NoZW1hIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVtYSB3\nYXMgbGlzdGVkIGJ5CiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlzIHNj\naGVtYXMKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1TZXF1\nZW5jZShEQklkZW50aWZpZXIgbmFtZSwgREJJZGVudGlmaWVyIHNjaGVtYSwK\nICAgICAgICBib29sZWFuIHRhcmdldFNjaGVtYSkgewogICAgICAgIHJldHVy\nbiAhdGFyZ2V0U2NoZW1hICYmICFEQklkZW50aWZpZXIuaXNOdWxsKHNjaGVt\nYSkKICAgICAgICAgICAgJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5zKERC\nSWRlbnRpZmllci50b1VwcGVyKHNjaGVtYSkuZ2V0TmFtZSgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5k\nIHRhYmxlcyBtYXRjaGluZyB0aGUgZ2l2ZW4gbmFtZSBwYXR0ZXJuLgogICAg\nICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIFRhYmxlW10gZ2V0\nVGFibGVzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2cs\nCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUs\nIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZ2V0VGFibGVzKG1ldGEsIERCSWRlbnRpZmll\nci5uZXdDYXRhbG9nKGNhdGFsb2cpLCBEQklkZW50aWZpZXIubmV3U2NoZW1h\nKHNjaGVtYU5hbWUpLAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3VGFi\nbGUodGFibGVOYW1lKSwgY29ubik7CiAgICB9CgogICAgCiAgICAvKioKICAg\nICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHRhYmxlcyBtYXRj\naGluZyB0aGUgZ2l2ZW4gbmFtZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJs\naWMgVGFibGVbXSBnZXRUYWJsZXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBE\nQklkZW50aWZpZXIgc3FsQ2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIg\nc3FsU2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHNxbFRhYmxlTmFtZSwgQ29u\nbmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUgPSBE\nQklkZW50aWZpZXIuaXNOdWxsKHNxbFNjaGVtYU5hbWUpID8gbnVsbCA6IHNx\nbFNjaGVtYU5hbWUuZ2V0TmFtZSgpOwogICAgICAgIGlmICghc3VwcG9ydHNT\nY2hlbWFGb3JHZXRUYWJsZXMpCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBu\ndWxsOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzY2hlbWFOYW1lID0g\nZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNxbFNjaGVtYU5hbWUpOwogICAg\nICAgIH0KCiAgICAgICAgU3RyaW5nW10gdHlwZXMgPSBTdHJpbmdzLnNwbGl0\nKHRhYmxlVHlwZXMsICIsIiwgMCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCB0eXBlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgdHlwZXNbaV0g\nPSB0eXBlc1tpXS50cmltKCk7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3Bl\ncmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCB0YWJsZXMgPSBudWxs\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRhYmxlcyA9IG1ldGEuZ2V0\nVGFibGVzKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoc3FsQ2F0YWxvZyks\nCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lLCBnZXRUYWJsZU5hbWVGb3JN\nZXRhZGF0YShzcWxUYWJsZU5hbWUpLCB0eXBlcyk7CiAgICAgICAgICAgIExp\nc3QgdGFibGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3\naGlsZSAodGFibGVzICE9IG51bGwgJiYgdGFibGVzLm5leHQoKSkKICAgICAg\nICAgICAgICAgIHRhYmxlTGlzdC5hZGQobmV3VGFibGUodGFibGVzKSk7CiAg\nICAgICAgICAgIHJldHVybiAoVGFibGVbXSkgdGFibGVMaXN0LnRvQXJyYXko\nbmV3IFRhYmxlW3RhYmxlTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAodGFibGVzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHRhYmxlcy5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgdGFibGUgZnJvbSB0aGUgaW5mb3JtYXRpb24g\naW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFRhYmxlIG5ld1RhYmxlKFJlc3VsdFNldCB0YWJsZU1ldGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVGFibGUgdCA9IG5ldyBU\nYWJsZSgpOwogICAgICAgIHQuc2V0SWRlbnRpZmllcihmcm9tREJOYW1lKHRh\nYmxlTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSwgREJJZGVudGlmaWVy\nVHlwZS5UQUJMRSkpOwogICAgICAgIHJldHVybiB0OwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgc2VxdWVu\nY2VzIG1hdGNoaW5nIHRoZSBnaXZlbiBuYW1lIHBhdHRlcm4uCiAgICAgKiBS\nZXR1cm5zIGFuIGVtcHR5IGFycmF5IGJ5IGRlZmF1bHQsIGFzIHRoZXJlIGlz\nIG5vIHN0YW5kYXJkIHdheSB0bwogICAgICogcmV0cmlldmUgYSBsaXN0IG9m\nIHNlcXVlbmNlcy4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1\nYmxpYyBTZXF1ZW5jZVtdIGdldFNlcXVlbmNlcyhEYXRhYmFzZU1ldGFEYXRh\nIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFO\nYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdl\ndFNlcXVlbmNlcyhtZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRh\nbG9nKSwgREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwKICAg\nICAgICAgICAgREJJZGVudGlmaWVyLm5ld1NlcXVlbmNlKHNlcXVlbmNlTmFt\nZSksIGNvbm4pOwogICAgICAgIAogICAgfQoKICAgIHB1YmxpYyBTZXF1ZW5j\nZVtdIGdldFNlcXVlbmNlcyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERCSWRl\nbnRpZmllciBjYXRhbG9nLAogICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFO\nYW1lLCBEQklkZW50aWZpZXIgc2VxdWVuY2VOYW1lLCBDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3Ry\naW5nIHN0ciA9IGdldFNlcXVlbmNlc1NRTChzY2hlbWFOYW1lLCBzZXF1ZW5j\nZU5hbWUpOwogICAgICAgIGlmIChzdHIgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTZXF1ZW5jZVswXTsKCiAgICAgICAgUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHN0cik7ICAg\nICAgICAKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGludCBpZHggPSAxOwogICAgICAgICAgICBpZiAo\nIURCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpCiAgICAgICAgICAg\nICAgICBzdG1udC5zZXRTdHJpbmcoaWR4KyssIERCSWRlbnRpZmllci50b1Vw\ncGVyKHNjaGVtYU5hbWUpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmICgh\nREJJZGVudGlmaWVyLmlzTnVsbChzZXF1ZW5jZU5hbWUpKQogICAgICAgICAg\nICAgICAgc3RtbnQuc2V0U3RyaW5nKGlkeCsrLCBzZXF1ZW5jZU5hbWUuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgc2V0UXVlcnlUaW1lb3V0KHN0bW50LCBj\nb25mLmdldFF1ZXJ5VGltZW91dCgpKTsKICAgICAgICAgICAgcnMgPSBleGVj\ndXRlUXVlcnkoY29ubiwgc3RtbnQsIHN0cik7CiAgICAgICAgICAgIHJldHVy\nbiBnZXRTZXF1ZW5jZShycyk7ICAgICAgICAgICAgCiAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxs\nKSAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzZXF1ZW5jZSBm\ncm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2UgbmV3U2VxdWVuY2UoUmVz\ndWx0U2V0IHNlcXVlbmNlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBTZXF1ZW5jZSBzZXEgPSBuZXcgU2VxdWVuY2UoKTsK\nICAgICAgICBzZXEuc2V0U2NoZW1hSWRlbnRpZmllcihmcm9tREJOYW1lKFN0\ncmluZ1V0aWxzLnN0cmlwRW5kKHNlcXVlbmNlTWV0YS5nZXRTdHJpbmcoIlNF\nUVVFTkNFX1NDSEVNQSIpLCBudWxsKSwKICAgICAgICAgICAgREJJZGVudGlm\naWVyVHlwZS5TQ0hFTUEpKTsKICAgICAgICBzZXEuc2V0SWRlbnRpZmllcihm\ncm9tREJOYW1lKFN0cmluZ1V0aWxzLnN0cmlwRW5kKHNlcXVlbmNlTWV0YS5n\nZXRTdHJpbmcoIlNFUVVFTkNFX05BTUUiKSwgbnVsbCksCiAgICAgICAgICAg\nIERCSWRlbnRpZmllclR5cGUuU0VRVUVOQ0UpKTsKICAgICAgICByZXR1cm4g\nc2VxOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBTUUwgbmVl\nZGVkIHRvIHNlbGVjdCB0aGUgbGlzdCBvZiBzZXF1ZW5jZXMuCiAgICAgKiBA\nZGVwcmVjYXRlZAogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNl\ncXVlbmNlc1NRTChTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNl\nTmFtZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKERCSWRlbnRpZmllciBzY2hl\nbWFOYW1lLCBEQklkZW50aWZpZXIgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCBjb2x1bW5zIG1hdGNoaW5nIHRoZSBnaXZl\nbiB0YWJsZSBhbmQKICAgICAqIGNvbHVtbiBwYXR0ZXJucy4KICAgICAqIEBk\nZXByZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1\nbW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAg\nICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIFN0\ncmluZyBjb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbnMo\nbWV0YSwgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY2F0YWxvZyksCiAgICAg\nICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAg\nICAgICAgICAgIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLAog\nICAgICAgICAgICBEQklkZW50aWZpZXIubmV3Q29sdW1uKGNvbHVtbk5hbWUp\nLAogICAgICAgICAgICBjb25uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIGNvbHVtbnMgbWF0Y2hpbmcg\ndGhlIGdpdmVuIHRhYmxlIGFuZAogICAgICogY29sdW1uIHBhdHRlcm5zLgog\nICAgICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1ucyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsIERCSWRlbnRpZmllciBjYXRhbG9nLAogICAgICAg\nIERCSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIgdGFibGVO\nYW1lLCBEQklkZW50aWZpZXIgY29sdW1uTmFtZSwgQ29ubmVjdGlvbiBjb25u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChE\nQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkgJiYgIXN1cHBvcnRzTnVs\nbFRhYmxlRm9yR2V0Q29sdW1ucykKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgCiAgICAgICAgU3RyaW5nIHNxbFNjaGVtYU5hbWUgPSBudWxs\nOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChzY2hlbWFOYW1l\nKSkgewogICAgICAgICAgICBzcWxTY2hlbWFOYW1lID0gc2NoZW1hTmFtZS5n\nZXROYW1lKCk7CiAgICAgICAgfQogICAgICAgIGlmICghc3VwcG9ydHNTY2hl\nbWFGb3JHZXRDb2x1bW5zKQogICAgICAgICAgICBzcWxTY2hlbWFOYW1lID0g\nbnVsbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbFNjaGVtYU5hbWUg\nPSBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSk7CgogICAg\nICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJl\nc3VsdFNldCBjb2xzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBjb2xzID0gbWV0YS5nZXRDb2x1bW5zKGdldENhdGFsb2dOYW1lRm9yTWV0\nYWRhdGEoY2F0YWxvZyksCiAgICAgICAgICAgICAgICBzcWxTY2hlbWFOYW1l\nLCBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0YWJsZU5hbWUpLAogICAgICAg\nICAgICAgICAgZ2V0Q29sdW1uTmFtZUZvck1ldGFkYXRhKGNvbHVtbk5hbWUp\nKTsKCiAgICAgICAgICAgIExpc3QgY29sdW1uTGlzdCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGNvbHMgIT0gbnVsbCAmJiBjb2xz\nLm5leHQoKSkKICAgICAgICAgICAgICAgIGNvbHVtbkxpc3QuYWRkKG5ld0Nv\nbHVtbihjb2xzKSk7CiAgICAgICAgICAgIHJldHVybiAoQ29sdW1uW10pIGNv\nbHVtbkxpc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBDb2x1bW5b\nY29sdW1uTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBpZiAoY29scyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICBjb2xzLmNsb3NlKCk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nIG5ldyBjb2x1bW4gZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVt\nYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbHVtbiBuZXdD\nb2x1bW4oUmVzdWx0U2V0IGNvbE1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGMgPSBuZXcgQ29sdW1uKCk7CiAg\nICAgICAgYy5zZXRTY2hlbWFJZGVudGlmaWVyKGZyb21EQk5hbWUoY29sTWV0\nYS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIiksIERCSWRlbnRpZmllclR5cGUu\nU0NIRU1BKSk7CiAgICAgICAgYy5zZXRUYWJsZUlkZW50aWZpZXIoZnJvbURC\nTmFtZShjb2xNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIpLCBEQklkZW50\naWZpZXJUeXBlLlRBQkxFKSk7CiAgICAgICAgYy5zZXRJZGVudGlmaWVyKGZy\nb21EQk5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIkNPTFVNTl9OQU1FIiksIERC\nSWRlbnRpZmllclR5cGUuQ09MVU1OKSk7CiAgICAgICAgYy5zZXRUeXBlKGNv\nbE1ldGEuZ2V0SW50KCJEQVRBX1RZUEUiKSk7CiAgICAgICAgYy5zZXRUeXBl\nSWRlbnRpZmllcihmcm9tREJOYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJUWVBF\nX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5DT0xVTU5fREVGSU5JVElPTikp\nOwogICAgICAgIGMuc2V0U2l6ZShjb2xNZXRhLmdldEludCgiQ09MVU1OX1NJ\nWkUiKSk7CiAgICAgICAgYy5zZXREZWNpbWFsRGlnaXRzKGNvbE1ldGEuZ2V0\nSW50KCJERUNJTUFMX0RJR0lUUyIpKTsKICAgICAgICBjLnNldE5vdE51bGwo\nY29sTWV0YS5nZXRJbnQoIk5VTExBQkxFIikKICAgICAgICAgICAgPT0gRGF0\nYWJhc2VNZXRhRGF0YS5jb2x1bW5Ob051bGxzKTsKCiAgICAgICAgU3RyaW5n\nIGRlZiA9IGNvbE1ldGEuZ2V0U3RyaW5nKCJDT0xVTU5fREVGIik7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGRlZikgJiYgISJudWxsIi5l\ncXVhbHNJZ25vcmVDYXNlKGRlZikpCiAgICAgICAgICAgIGMuc2V0RGVmYXVs\ndFN0cmluZyhkZWYpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFy\neSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqIEBk\nZXByZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyBQcmltYXJ5S2V5W10gZ2V0\nUHJpbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLAogICAgICAgIFN0\ncmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxl\nTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBnZXRQcmltYXJ5S2V5cyhtZXRhLCBE\nQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRhbG9nKSwgREJJZGVudGlmaWVy\nLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgREJJZGVudGlm\naWVyLm5ld1RhYmxlKHRhYmxlTmFtZSksIGNvbm4pOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFy\neSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwog\nICAgcHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsCiAgICAgICAgREJJZGVudGlmaWVyIGNhdGFsb2cs\nIERCSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIgdGFibGVO\nYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHVzZUdldEJlc3RSb3dJZGVudGlmaWVyRm9y\nUHJpbWFyeUtleXMpCiAgICAgICAgICAgIHJldHVybiBnZXRQcmltYXJ5S2V5\nc0Zyb21CZXN0Um93SWRlbnRpZmllcihtZXRhLCBjYXRhbG9nLAogICAgICAg\nICAgICAgICAgc2NoZW1hTmFtZSwgdGFibGVOYW1lLCBjb25uKTsKICAgICAg\nICByZXR1cm4gZ2V0UHJpbWFyeUtleXNGcm9tR2V0UHJpbWFyeUtleXMobWV0\nYSwgY2F0YWxvZywKICAgICAgICAgICAgc2NoZW1hTmFtZSwgdGFibGVOYW1l\nLCBjb25uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhl\nIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVuIHRh\nYmxlIHBhdHRlcm4uCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBw\ncm90ZWN0ZWQgUHJpbWFyeUtleVtdIGdldFByaW1hcnlLZXlzRnJvbUdldFBy\naW1hcnlLZXlzCiAgICAgICAgKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3Ry\naW5nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFOYW1lLAogICAgICAgICAgICBT\ndHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtleXNG\ncm9tR2V0UHJpbWFyeUtleXMobWV0YSwgREJJZGVudGlmaWVyLm5ld0NhdGFs\nb2coY2F0YWxvZyksCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hl\nbWEoc2NoZW1hTmFtZSksIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5h\nbWUpLCBjb25uKTsKICAgIH0KICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0\naGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlzIGZvciB0aGUgZ2l2ZW4g\ndGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlL\nZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21HZXRQcmltYXJ5S2V5cwogICAgICAg\nIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERCSWRlbnRpZmllciBjYXRhbG9n\nLCBEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwKICAgICAgICAgICAgREJJZGVu\ndGlmaWVyIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUgPT0g\nbnVsbCAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRQcmltYXJ5S2V5cykK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1ldGFk\nYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBwa3MgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBrcyA9IG1ldGEuZ2V0\nUHJpbWFyeUtleXMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9n\nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShz\nY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFtZUZvck1l\ndGFkYXRhKHRhYmxlTmFtZSkpOwoKICAgICAgICAgICAgTGlzdCBwa0xpc3Qg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChwa3MgIT0g\nbnVsbCAmJiBwa3MubmV4dCgpKQogICAgICAgICAgICAgICAgcGtMaXN0LmFk\nZChuZXdQcmltYXJ5S2V5KHBrcykpOwogICAgICAgICAgICByZXR1cm4gKFBy\naW1hcnlLZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChu\nZXcgUHJpbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBwa3MuY2xvc2UoKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IHByaW1hcnkga2V5IGZyb20gdGhlIGluZm9ybWF0aW9u\nIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBQcmltYXJ5S2V5IG5ld1ByaW1hcnlLZXkoUmVzdWx0U2V0IHBrTWV0YSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBQcmltYXJ5\nS2V5IHBrID0gbmV3IFByaW1hcnlLZXkoKTsKICAgICAgICBway5zZXRTY2hl\nbWFJZGVudGlmaWVyKGZyb21EQk5hbWUocGtNZXRhLmdldFN0cmluZygiVEFC\nTEVfU0NIRU0iKSwgREJJZGVudGlmaWVyVHlwZS5TQ0hFTUEpKTsKICAgICAg\nICBway5zZXRUYWJsZUlkZW50aWZpZXIoZnJvbURCTmFtZShwa01ldGEuZ2V0\nU3RyaW5nKCJUQUJMRV9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuVEFCTEUp\nKTsKICAgICAgICBway5zZXRDb2x1bW5JZGVudGlmaWVyKGZyb21EQk5hbWUo\ncGtNZXRhLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSwgREJJZGVudGlmaWVy\nVHlwZS5DT0xVTU4pKTsKICAgICAgICBway5zZXRJZGVudGlmaWVyKGZyb21E\nQk5hbWUocGtNZXRhLmdldFN0cmluZygiUEtfTkFNRSIpLCBEQklkZW50aWZp\nZXJUeXBlLkNPTlNUUkFJTlQpKTsKICAgICAgICByZXR1cm4gcGs7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmlu\nZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgog\nICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1h\ncnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21CZXN0Um93SWRlbnRpZmllcgog\nICAgICAgIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9n\nLCBTdHJpbmcgc2NoZW1hTmFtZSwKICAgICAgICAgICAgU3RyaW5nIHRhYmxl\nTmFtZSwgQ29ubmVjdGlvbiBjb25uKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtleXNGcm9tQmVzdFJvd0lkZW50\naWZpZXIobWV0YSwgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY2F0YWxvZyks\nCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFt\nZSksIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0\nbyBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVuIHRhYmxlIHBhdHRl\ncm4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5W10gZ2V0UHJp\nbWFyeUtleXNGcm9tQmVzdFJvd0lkZW50aWZpZXIKICAgICAgICAoRGF0YWJh\nc2VNZXRhRGF0YSBtZXRhLCBEQklkZW50aWZpZXIgY2F0YWxvZywgREJJZGVu\ndGlmaWVyIHNjaGVtYU5hbWUsCiAgICAgICAgICAgIERCSWRlbnRpZmllciB0\nYWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0\nYU9wZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgcGtzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBwa3MgPSBtZXRhLmdldEJl\nc3RSb3dJZGVudGlmaWVyKHRvREJOYW1lKGNhdGFsb2cpLCB0b0RCTmFtZShz\nY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIHRvREJOYW1lKHRhYmxlTmFt\nZSksIDAsIGZhbHNlKTsKCiAgICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAocGtzICE9IG51bGwg\nJiYgcGtzLm5leHQoKSkgewogICAgICAgICAgICAgICAgUHJpbWFyeUtleSBw\nayA9IG5ldyBQcmltYXJ5S2V5KCk7CiAgICAgICAgICAgICAgICBway5zZXRT\nY2hlbWFJZGVudGlmaWVyKHNjaGVtYU5hbWUpOwogICAgICAgICAgICAgICAg\ncGsuc2V0VGFibGVJZGVudGlmaWVyKHRhYmxlTmFtZSk7CiAgICAgICAgICAg\nICAgICBway5zZXRDb2x1bW5JZGVudGlmaWVyKGZyb21EQk5hbWUocGtzLmdl\ndFN0cmluZygiQ09MVU1OX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5DT0xV\nTU4pKTsKICAgICAgICAgICAgICAgIHBrTGlzdC5hZGQocGspOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xp\nc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3Br\nTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAocGtzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIHBrcy5jbG9zZSgpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gZmluZCBpbmRleGVzIG1hdGNoaW5nIHRoZSBnaXZlbiB0YWJs\nZSBwYXR0ZXJuLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVi\nbGljIEluZGV4W10gZ2V0SW5kZXhJbmZvKERhdGFiYXNlTWV0YURhdGEgbWV0\nYSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLAogICAgICAgIGJv\nb2xlYW4gYXBwcm94LCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldEluZGV4SW5mbyht\nZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRhbG9nKSwgCiAgICAg\nICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksIERC\nSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCB1bmlxdWUsCiAgICAg\nICAgICAgIGFwcHJveCwgY29ubik7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBpbmRleGVzIG1hdGNoaW5n\nIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMg\nSW5kZXhbXSBnZXRJbmRleEluZm8oRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBE\nQklkZW50aWZpZXIgY2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIgc2No\nZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgYm9vbGVhbiB1bmlx\ndWUsCiAgICAgICAgYm9vbGVhbiBhcHByb3gsIENvbm5lY3Rpb24gY29ubikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFi\nbGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW5k\nZXhJbmZvKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVm\nb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0\nIGluZGV4ZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlu\nZGV4ZXMgPSBtZXRhLmdldEluZGV4SW5mbyhnZXRDYXRhbG9nTmFtZUZvck1l\ndGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgZ2V0U2NoZW1hTmFt\nZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0\nVGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSwgdW5pcXVlLCBhcHBy\nb3gpOwoKICAgICAgICAgICAgTGlzdCBpbmRleExpc3QgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChpbmRleGVzICE9IG51bGwgJiYg\naW5kZXhlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICBpbmRleExpc3QuYWRk\nKG5ld0luZGV4KGluZGV4ZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChJbmRl\neFtdKSBpbmRleExpc3QudG9BcnJheShuZXcgSW5kZXhbaW5kZXhMaXN0LnNp\nemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChp\nbmRleGVzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIGluZGV4ZXMuY2xvc2UoKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGlu\nZGV4IGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBJbmRleCBuZXdJbmRleChSZXN1\nbHRTZXQgaWR4TWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBJbmRleCBpZHggPSBuZXcgSW5kZXgoKTsKICAgICAgICBpZHgu\nc2V0U2NoZW1hSWRlbnRpZmllcihmcm9tREJOYW1lKGlkeE1ldGEuZ2V0U3Ry\naW5nKCJUQUJMRV9TQ0hFTSIpLCBEQklkZW50aWZpZXJUeXBlLlNDSEVNQSkp\nOwogICAgICAgIGlkeC5zZXRUYWJsZUlkZW50aWZpZXIoZnJvbURCTmFtZShp\nZHhNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIpLCBEQklkZW50aWZpZXJU\neXBlLlRBQkxFKSk7CiAgICAgICAgaWR4LnNldENvbHVtbklkZW50aWZpZXIo\nZnJvbURCTmFtZShpZHhNZXRhLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSwg\nREJJZGVudGlmaWVyVHlwZS5DT0xVTU4pKTsKICAgICAgICBpZHguc2V0SWRl\nbnRpZmllcihmcm9tREJOYW1lKGlkeE1ldGEuZ2V0U3RyaW5nKCJJTkRFWF9O\nQU1FIiksIERCSWRlbnRpZmllclR5cGUuSU5ERVgpKTsKICAgICAgICBpZHgu\nc2V0VW5pcXVlKCFpZHhNZXRhLmdldEJvb2xlYW4oIk5PTl9VTklRVUUiKSk7\nCiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nZmxlY3Qgb24gdGhlIHNjaGVtYSB0byByZXR1cm4gZm9yZWlnbiBrZXlzIGlt\ncG9ydGVkIGJ5IHRoZSBnaXZlbgogICAgICogdGFibGUgcGF0dGVybi4KICAg\nICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5\nW10gZ2V0SW1wb3J0ZWRLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3Ry\naW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmlu\nZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0SW1wb3J0ZWRLZXlz\nKG1ldGEsIGNhdGFsb2csIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwgY29ubiwg\ndHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gcmV0dXJuIGZvcmVpZ24ga2V5cyBpbXBvcnRlZCBieSB0aGUg\nZ2l2ZW4KICAgICAqIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1Ymxp\nYyBGb3JlaWduS2V5W10gZ2V0SW1wb3J0ZWRLZXlzKERhdGFiYXNlTWV0YURh\ndGEgbWV0YSwgREJJZGVudGlmaWVyIGNhdGFsb2csCiAgICAgICAgREJJZGVu\ndGlmaWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmllciB0YWJsZU5hbWUsIENv\nbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gZ2V0SW1wb3J0ZWRLZXlzKG1ldGEsIGNhdGFsb2cs\nIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwgY29ubiwgdHJ1ZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gcmV0dXJu\nIGZ1bGwgZm9yZWlnbiBrZXlzIGltcG9ydGVkIGJ5IHRoZSBnaXZlbgogICAg\nICogdGFibGUgcGF0dGVybi4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8K\nICAgIHB1YmxpYyBGb3JlaWduS2V5W10gZ2V0SW1wb3J0ZWRLZXlzKERhdGFi\nYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3Ry\naW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24g\nY29ubiwgYm9vbGVhbiBwYXJ0aWFsS2V5cykgCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldEltcG9ydGVkS2V5cyht\nZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRhbG9nKSwgCiAgICAg\nICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksIERC\nSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25uLCBwYXJ0aWFs\nS2V5cyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0\naGUgc2NoZW1hIHRvIHJldHVybiBmdWxsIGZvcmVpZ24ga2V5cyBpbXBvcnRl\nZCBieSB0aGUgZ2l2ZW4KICAgICAqIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8K\nICAgIHB1YmxpYyBGb3JlaWduS2V5W10gZ2V0SW1wb3J0ZWRLZXlzKERhdGFi\nYXNlTWV0YURhdGEgbWV0YSwgREJJZGVudGlmaWVyIGNhdGFsb2csCiAgICAg\nICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRlbnRpZmllciB0YWJs\nZU5hbWUsIENvbm5lY3Rpb24gY29ubiwgYm9vbGVhbiBwYXJ0aWFsS2V5cykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXN1\ncHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVsbCAmJiAhc3VwcG9ydHNOdWxs\nVGFibGVGb3JHZXRJbXBvcnRlZEtleXMpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25uKTsK\nICAgICAgICBSZXN1bHRTZXQga2V5cyA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAga2V5cyA9IG1ldGEuZ2V0SW1wb3J0ZWRLZXlzKGdldENh\ndGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAgICAgICAgICAgICAg\nICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSksCiAgICAg\nICAgICAgICAgICBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0YWJsZU5hbWUp\nKTsKCiAgICAgICAgICAgIExpc3Q8Rm9yZWlnbktleT4gaW1wb3J0ZWRLZXlM\naXN0ID0gbmV3IEFycmF5TGlzdDxGb3JlaWduS2V5PigpOwogICAgICAgICAg\nICBNYXA8RktNYXBLZXksIEZvcmVpZ25LZXk+IGZrTWFwID0gbmV3IEhhc2hN\nYXA8RktNYXBLZXksIEZvcmVpZ25LZXk+KCk7CgogICAgICAgICAgICB3aGls\nZSAoa2V5cyAhPSBudWxsICYmIGtleXMubmV4dCgpKSB7CiAgICAgICAgICAg\nICAgICBGb3JlaWduS2V5IG5mayA9IG5ld0ZvcmVpZ25LZXkoa2V5cyk7CiAg\nICAgICAgICAgICAgICBpZiAoIXBhcnRpYWxLZXlzKSB7CiAgICAgICAgICAg\nICAgICAgICAgRm9yZWlnbktleSBmayA9IGNvbWJpbmVGb3JlaWduS2V5KGZr\nTWFwLCBuZmspOwogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBrZXkg\ncmV0dXJuZWQgIT0gbmV3IGtleSwgZmsgY29sIHdhcyBjb21iaW5lZAogICAg\nICAgICAgICAgICAgICAgIC8vIHdpdGggZXhpc3RpbmcgZmsuCiAgICAgICAg\nICAgICAgICAgICAgaWYgKGZrICE9IG5maykgewogICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbXBvcnRlZEtleUxpc3Qu\nYWRkKG5mayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChG\nb3JlaWduS2V5W10pIGltcG9ydGVkS2V5TGlzdC50b0FycmF5CiAgICAgICAg\nICAgICAgICAobmV3IEZvcmVpZ25LZXlbaW1wb3J0ZWRLZXlMaXN0LnNpemUo\nKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChrZXlz\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAga2V5cy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoKICAgICAqIENvbWJp\nbmVzIHBhcnRpYWwgZm9yZWlnbiBrZXlzIGludG8gc2luZ3VsYXIga2V5CiAg\nICAgKi8KICAgIHByb3RlY3RlZCBGb3JlaWduS2V5IGNvbWJpbmVGb3JlaWdu\nS2V5KE1hcDxGS01hcEtleSwgRm9yZWlnbktleT4gZmtNYXAsCiAgICAgICAg\nRm9yZWlnbktleSBmaykgewogICAgICAgIAogICAgICAgIEZLTWFwS2V5IGZr\nbWsgPSBuZXcgRktNYXBLZXkoZmspOwogICAgICAgIEZvcmVpZ25LZXkgYmFz\nZUtleSA9IGZrTWFwLmdldChma21rKTsKICAgICAgICAvLyBGb3VuZCB0aGUg\nRkssIGFkZCB0aGUgYWRkaXRpb25hbCBjb2x1bW4KICAgICAgICBpZiAoYmFz\nZUtleSAhPSBudWxsKSB7CiAgICAgICAgICAgIGJhc2VLZXkuYWRkQ29sdW1u\nKGZrKTsKICAgICAgICAgICAgcmV0dXJuIGJhc2VLZXk7CiAgICAgICAgfQog\nICAgICAgIC8vIGZrZXkgaXMgbmV3CiAgICAgICAgZmtNYXAucHV0KGZrbWss\nIGZrKTsKICAgICAgICByZXR1cm4gZms7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgZm9yZWlnbiBrZXkgZnJvbSB0aGUgaW5mb3JtYXRp\nb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIEZvcmVpZ25LZXkgbmV3Rm9yZWlnbktleShSZXN1bHRTZXQgZmtNZXRh\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEZvcmVp\nZ25LZXkgZmsgPSBuZXcgRm9yZWlnbktleSgpOwogICAgICAgIGZrLnNldFNj\naGVtYUlkZW50aWZpZXIoZnJvbURCTmFtZShma01ldGEuZ2V0U3RyaW5nKCJG\nS1RBQkxFX1NDSEVNIiksIERCSWRlbnRpZmllclR5cGUuU0NIRU1BKSk7CiAg\nICAgICAgZmsuc2V0VGFibGVJZGVudGlmaWVyKGZyb21EQk5hbWUoZmtNZXRh\nLmdldFN0cmluZygiRktUQUJMRV9OQU1FIiksIERCSWRlbnRpZmllclR5cGUu\nVEFCTEUpKTsKICAgICAgICBmay5zZXRDb2x1bW5JZGVudGlmaWVyKGZyb21E\nQk5hbWUoZmtNZXRhLmdldFN0cmluZygiRktDT0xVTU5fTkFNRSIpLCBEQklk\nZW50aWZpZXJUeXBlLkNPTFVNTikpOwogICAgICAgIGZrLnNldElkZW50aWZp\nZXIoZnJvbURCTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS19OQU1FIiksIERC\nSWRlbnRpZmllclR5cGUuRk9SRUlHTl9LRVkpKTsKICAgICAgICBmay5zZXRQ\ncmltYXJ5S2V5U2NoZW1hSWRlbnRpZmllcihmcm9tREJOYW1lKGZrTWV0YS5n\nZXRTdHJpbmcoIlBLVEFCTEVfU0NIRU0iKSwgREJJZGVudGlmaWVyVHlwZS5T\nQ0hFTUEpKTsKICAgICAgICBmay5zZXRQcmltYXJ5S2V5VGFibGVJZGVudGlm\naWVyKGZyb21EQk5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtUQUJMRV9OQU1F\nIiksIERCSWRlbnRpZmllclR5cGUuVEFCTEUpKTsKICAgICAgICBmay5zZXRQ\ncmltYXJ5S2V5Q29sdW1uSWRlbnRpZmllcihmcm9tREJOYW1lKGZrTWV0YS5n\nZXRTdHJpbmcoIlBLQ09MVU1OX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5D\nT0xVTU4pKTsKICAgICAgICBmay5zZXRLZXlTZXF1ZW5jZShma01ldGEuZ2V0\nU2hvcnQoIktFWV9TRVEiKSk7CiAgICAgICAgZmsuc2V0RGVmZXJyZWQoZmtN\nZXRhLmdldFNob3J0KCJERUZFUlJBQklMSVRZIikKICAgICAgICAgICAgPT0g\nRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleUluaXRpYWxseURlZmVycmVk\nKTsKCiAgICAgICAgaW50IGRlbCA9IGZrTWV0YS5nZXRTaG9ydCgiREVMRVRF\nX1JVTEUiKTsKICAgICAgICBzd2l0Y2ggKGRlbCkgewogICAgICAgICAgICBj\nYXNlIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlTZXROdWxsOgogICAg\nICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNU\nSU9OX05VTEwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleVNldERlZmF1bHQ6\nCiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktl\neS5BQ1RJT05fREVGQVVMVCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBEYXRhYmFzZU1ldGFEYXRhLmltcG9ydGVkS2V5Q2Fz\nY2FkZToKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihGb3Jl\naWduS2V5LkFDVElPTl9DQVNDQURFKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZmsuc2V0\nRGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZms7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB0YWJsZSBu\nYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRp\nb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFRhYmxlTmFtZUZvck1ldGFk\nYXRhKFN0cmluZyB0YWJsZU5hbWUpIHsKICAgICAgICByZXR1cm4gY29udmVy\ndFNjaGVtYUNhc2UoREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlTmFtZSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdGFibGUgbmFt\nZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9u\nCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0\nYShEQklkZW50aWZpZXIgdGFibGVOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNv\nbnZlcnRTY2hlbWFDYXNlKHRhYmxlTmFtZS5nZXRVbnF1YWxpZmllZE5hbWUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBzY2hlbWEg\nbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0\naW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRTY2hlbWFOYW1lRm9yTWV0\nYWRhdGEoU3RyaW5nIHNjaGVtYU5hbWUpIHsKICAgICAgICBpZiAoc2NoZW1h\nTmFtZSA9PSBudWxsKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gY29uZi5n\nZXRTY2hlbWEoKTsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2Uo\nREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBzY2hlbWEgbmFtZSB0aGF0IHdp\nbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBm\ncm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFN0cmluZyBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoREJJZGVu\ndGlmaWVyIHNjaGVtYU5hbWUpIHsKICAgICAgICBpZiAoREJJZGVudGlmaWVy\nLmlzTnVsbChzY2hlbWFOYW1lKSkKICAgICAgICAgICAgc2NoZW1hTmFtZSA9\nIERCSWRlbnRpZmllci5uZXdTY2hlbWEoY29uZi5nZXRTY2hlbWEoKSk7CiAg\nICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKHNjaGVtYU5hbWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY2F0YWxvZyBuYW1l\nIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24K\nICAgICAqIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldENhdGFsb2dOYW1lRm9yTWV0YWRh\ndGEoU3RyaW5nIGNhdGFsb2dOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZl\ncnRTY2hlbWFDYXNlKERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2dO\nYW1lKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjYXRh\nbG9nIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZv\ncm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q2F0YWxvZ05hbWVG\nb3JNZXRhZGF0YShEQklkZW50aWZpZXIgY2F0YWxvZ05hbWUpIHsKICAgICAg\nICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY2F0YWxvZ05hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY29sdW1uIG5hbWUgdGhh\ndCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAg\nICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q29sdW1uTmFtZUZvck1ldGFkYXRhKFN0\ncmluZyBjb2x1bW5OYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hl\nbWFDYXNlKERCSWRlbnRpZmllci5uZXdDb2x1bW4oY29sdW1uTmFtZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY29sdW1uIG5hbWUg\ndGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgog\nICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q29sdW1uTmFtZUZvck1ldGFkYXRh\nKERCSWRlbnRpZmllciBjb2x1bW5OYW1lKSB7CiAgICAgICAgcmV0dXJuIGNv\nbnZlcnRTY2hlbWFDYXNlKGNvbHVtbk5hbWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIHNjaGVtYSBuYW1lIHRvIGEg\nbmFtZSB0aGF0IHRoZSBkYXRhYmFzZSB3aWxsCiAgICAgKiBiZSBhYmxlIHRv\nIHVuZGVyc3RhbmQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgY29udmVy\ndFNjaGVtYUNhc2UoU3RyaW5nIG9iamVjdE5hbWUpIHsKICAgICAgICByZXR1\ncm4gY29udmVydFNjaGVtYUNhc2UoREJJZGVudGlmaWVyLm5ld0lkZW50aWZp\nZXIob2JqZWN0TmFtZSwgREJJZGVudGlmaWVyVHlwZS5ERUZBVUxULCBmYWxz\nZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIHNjaGVtYSBuYW1lIHRvIGEgbmFtZSB0aGF0IHRoZSBkYXRhYmFzZSB3\naWxsCiAgICAgKiBiZSBhYmxlIHRvIHVuZGVyc3RhbmQuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgY29udmVydFNjaGVtYUNhc2UoREJJZGVudGlmaWVy\nIG9iamVjdE5hbWUpIHsKICAgICAgICByZXR1cm4gdG9EQk5hbWUobmFtaW5n\nVXRpbC5jb252ZXJ0U2NoZW1hQ2FzZShvYmplY3ROYW1lKSwgZmFsc2UpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiBEQiBzcGVjaWZpYyBz\nY2hlbWFDYXNlIAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNjaGVt\nYUNhc2UoKXsKICAgICAgICByZXR1cm4gc2NoZW1hQ2FzZTsKICAgIH0KICAg\nICAgICAKICAgIC8qKgogICAgICogUHJlcGFyZWQgdGhlIGNvbm5lY3Rpb24g\nZm9yIG1ldGFkYXRhIG9wZXJhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihDb25uZWN0aW9uIGMpIHsK\nICAgICAgICBpZiAocmVxdWlyZXNBdXRvQ29tbWl0Rm9yTWV0YURhdGEpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGMucm9sbGJhY2so\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsK\nICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgaWYgKCFjLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgICAg\nICBjLnNldEF1dG9Db21taXQodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIFNlcXVlbmNlcyBhbmQgQXV0by1Bc3NpZ24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGxhc3QgZ2VuZXJhdGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgog\nICAgICogVGhyb3dzIGFuIGV4Y2VwdGlvbiBieSBkZWZhdWx0IGlmIHtAbGlu\nayAjbGFzdEdlbmVyYXRlZEtleVF1ZXJ5fSBpcyBudWxsLgogICAgICovCiAg\nICBwdWJsaWMgT2JqZWN0IGdldEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLWF1dG8tYXNzaWduIikpOwoKICAgICAgICAvLyByZXBsYWNlIHRoaW5n\ncyBsaWtlICJTRUxFQ1QgTUFYKHswfSkgRlJPTSB7MX0iCiAgICAgICAgU3Ry\naW5nIHF1ZXJ5ID0gbGFzdEdlbmVyYXRlZEtleVF1ZXJ5OwogICAgICAgIGlm\nIChxdWVyeS5pbmRleE9mKCd7JykgIT0gLTEpIC8vIG9ubHkgaWYgdGhlIHRv\na2VuIGlzIGluIHRoZSBzdHJpbmcKICAgICAgICB7CiAgICAgICAgICAgIHF1\nZXJ5ID0gTWVzc2FnZUZvcm1hdC5mb3JtYXQocXVlcnksIG5ldyBPYmplY3Rb\nXXsKICAgICAgICAgICAgICAgIHRvREJOYW1lKGNvbC5nZXRJZGVudGlmaWVy\nKCkpLCBnZXRGdWxsTmFtZShjb2wuZ2V0VGFibGUoKSwgZmFsc2UpLAogICAg\nICAgICAgICAgICAgZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCks\nCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHF1ZXJ5\nKTsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHNldFF1ZXJ5VGltZW91dChzdG1udCwgY29uZi5nZXRR\ndWVyeVRpbWVvdXQoKSk7CiAgICAgICAgICAgIHJzID0gZXhlY3V0ZVF1ZXJ5\nKGNvbm4sIHN0bW50LCBxdWVyeSk7CiAgICAgICAgICAgIHJldHVybiBnZXRL\nZXkocnMsIGNvbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBycy5jbG9z\nZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAg\nIGlmIChzdG1udCAhPSBudWxsKSAgICAKICAgICAgICAgICAgICAgIHRyeSB7\nIHN0bW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30g\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBz\nZXF1ZW5jZSBuYW1lIHVzZWQgYnkgZGF0YWJhc2VzIGZvciB0aGUgZ2l2ZW4g\nYXV0b2Fzc2lnbmVkCiAgICAgKiBjb2x1bW4uIFRoaXMgaXMgb25seSB1c2Vk\nIGJ5IGRhdGFiYXNlcyB0aGF0IHJlcXVpcmUgYW4gZXhwbGljaXQgbmFtZQog\nICAgICogdG8gYmUgdXNlZCBmb3IgYXV0by1hc3NpZ24gc3VwcG9ydC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRHZW5lcmF0ZWRLZXlTZXF1\nZW5jZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiB0b0RCTmFt\nZShuYW1pbmdVdGlsLmdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2ws\nIG1heEF1dG9Bc3NpZ25OYW1lTGVuZ3RoKSk7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uZmlndXJhYmxl\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25m\naWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICB0aGlzLmNvbmYgPSAoSkRCQ0Nv\nbmZpZ3VyYXRpb24pIGNvbmY7CiAgICAgICAgdGhpcy5sb2cgPSB0aGlzLmNv\nbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKCiAgICAg\nICAgLy8gQ3JlYXRlIHRoZSBuYW1pbmcgdXRpbGl0eQogICAgICAgIG5hbWlu\nZ1V0aWwgPSB0aGlzLmNvbmYuZ2V0SWRlbnRpZmllclV0aWxJbnN0YW5jZSgp\nOwogICAgICAgIG5hbWluZ1V0aWwuc2V0SWRlbnRpZmllckNvbmZpZ3VyYXRp\nb24odGhpcyk7CiAgICAgICAgY29uZmlndXJlTmFtaW5nUnVsZXMoKTsKCiAg\nICAgICAgLy8gd2FybiBhYm91dCB1bnN1cHBvcnRlZCBkaWN0cwogICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpICYmICFpc1N1cHBvcnRlZCgpKQog\nICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiZGljdC1ub3Qtc3VwcG9y\ndGVkIiwgZ2V0Q2xhc3MoKSkpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVh\nbiBpc1N1cHBvcnRlZCgpIHsKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgY3Vz\ndG9tIGRpY3QsIHRyYXZlcnNlIHRvIHdoYXRldmVyIG9wZW5qcGEgZGljdCBp\ndAogICAgICAgIC8vIGV4dGVuZHMKICAgICAgICBDbGFzcyBjID0gZ2V0Q2xh\nc3MoKTsKICAgICAgICB3aGlsZSAoIWMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgo\nIm9yZy5hcGFjaGUub3BlbmpwYS4iKSkKICAgICAgICAgICAgYyA9IGMuZ2V0\nU3VwZXJjbGFzcygpOwoKICAgICAgICAvLyB0aGUgZ2VuZXJpYyBkYmRpY3Rp\nb25hcnkgaXMgbm90IGNvbnNpZGVyZWQgYSBzdXBwb3J0ZWQgZGljdDsgYWxs\nCiAgICAgICAgLy8gb3RoZXIgY29uY3JldGUgZGljdGlvbmFyaWVzIGFyZQog\nICAgICAgIGlmIChjID09IERCRGljdGlvbmFyeS5jbGFzcykKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIC8vIGluaXRpYWxpemUgdGhlIHNldCBvZiByZXNlcnZlZCBTUUw5MiB3b3Jk\ncyBmcm9tIHJlc291cmNlCiAgICAgICAgSW5wdXRTdHJlYW0gaW4gPSBEQkRp\nY3Rpb25hcnkuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbQogICAgICAgICAg\nICAoInNxbC1rZXl3b3Jkcy5yc3JjIik7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgU3RyaW5nIGtleXdvcmRzID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5l\ndyBJbnB1dFN0cmVhbVJlYWRlcihpbikpLgogICAgICAgICAgICAgICAgcmVh\nZExpbmUoKTsKICAgICAgICAgICAgaW4uY2xvc2UoKTsKICAgICAgICAgICAg\ncmVzZXJ2ZWRXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Mu\nc3BsaXQKICAgICAgICAgICAgICAgIChrZXl3b3JkcywgIiwiLCAwKSkpOwog\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7IGluLmNsb3NlKCk7IH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQoKICAgICAgICAvLyBh\nZGQgYWRkaXRpb25hbCByZXNlcnZlZCB3b3JkcyBzZXQgYnkgdXNlcgogICAg\nICAgIGlmIChyZXNlcnZlZFdvcmRzICE9IG51bGwpCiAgICAgICAgICAgIHJl\nc2VydmVkV29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNw\nbGl0CiAgICAgICAgICAgICAgICAocmVzZXJ2ZWRXb3Jkcy50b1VwcGVyQ2Fz\nZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBzeXN0ZW0gc2NoZW1h\ncyBzZXQgYnkgdXNlcgogICAgICAgIGlmIChzeXN0ZW1TY2hlbWFzICE9IG51\nbGwpCiAgICAgICAgICAgIHN5c3RlbVNjaGVtYVNldC5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoc3lzdGVt\nU2NoZW1hcy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8v\nIGFkZCBzeXN0ZW0gdGFibGVzIHNldCBieSB1c2VyCiAgICAgICAgaWYgKHN5\nc3RlbVRhYmxlcyAhPSBudWxsKQogICAgICAgICAgICBzeXN0ZW1UYWJsZVNl\ndC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAg\nICAgICAgICAoc3lzdGVtVGFibGVzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkp\nKTsKCiAgICAgICAgLy8gYWRkIGZpeGVkIHNpemUgdHlwZSBuYW1lcyBzZXQg\nYnkgdGhlIHVzZXIKICAgICAgICBpZiAoZml4ZWRTaXplVHlwZU5hbWVzICE9\nIG51bGwpCiAgICAgICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFs\nbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAg\nIChmaXhlZFNpemVUeXBlTmFtZXMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkp\nOwogICAgICAgIAogICAgICAgIC8vIGlmIHVzZXIgaGFzIHVuc2V0IHNlcXVl\nbmNlIHNxbCwgbnVsbCBpdCBvdXQgc28gd2Uga25vdyBzZXF1ZW5jZXMKICAg\nICAgICAvLyBhcmVuJ3Qgc3VwcG9ydGVkCiAgICAgICAgbmV4dFNlcXVlbmNl\nUXVlcnkgPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKG5leHRTZXF1ZW5jZVF1\nZXJ5KTsKICAgICAgICAKICAgICAgICBpZiAoc2VsZWN0V29yZHMgIT0gbnVs\nbCkKICAgICAgICAgICAgc2VsZWN0V29yZFNldC5hZGRBbGwoQXJyYXlzLmFz\nTGlzdChTdHJpbmdzLnNwbGl0KHNlbGVjdFdvcmRzCiAgICAgICAgICAgICAg\nICAgICAgLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKICAgICAgICAKICAg\nICAgICAvLyBpbml0aWFsaXplIHRoZSBlcnJvciBjb2RlcwogICAgICAgIFNR\nTEVycm9yQ29kZVJlYWRlciBjb2RlUmVhZGVyID0gbmV3IFNRTEVycm9yQ29k\nZVJlYWRlcigpOwogICAgICAgIFN0cmluZyByc3JjID0gInNxbC1lcnJvci1z\ndGF0ZS1jb2Rlcy54bWwiOwogICAgICAgIElucHV0U3RyZWFtIHN0cmVhbSA9\nIGdldENsYXNzKCkuZ2V0UmVzb3VyY2VBc1N0cmVhbShyc3JjKTsKICAgICAg\nICBTdHJpbmcgZGljdGlvbmFyeUNsYXNzTmFtZSA9IGdldENsYXNzKCkuZ2V0\nTmFtZSgpOwogICAgICAgIGlmIChzdHJlYW0gPT0gbnVsbCkgeyAvLyBVc2Vy\nIHN1cHBsaWVkIGRpY3Rpb25hcnkgYnV0IG5vIGVycm9yIGNvZGVzIHhtbAog\nICAgICAgICAgICAvLyB1c2UgZGVmYXVsdAogICAgICAgICAgICBzdHJlYW0g\nPSBEQkRpY3Rpb25hcnkuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbShyc3Jj\nKTsKICAgICAgICAgICAgZGljdGlvbmFyeUNsYXNzTmFtZSA9IGdldENsYXNz\nKCkuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9CiAgICAg\nICAgY29kZVJlYWRlci5wYXJzZShzdHJlYW0sIGRpY3Rpb25hcnlDbGFzc05h\nbWUsIHRoaXMpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBhZGRFcnJv\nckNvZGUoaW50IGVycm9yVHlwZSwgU3RyaW5nIGVycm9yQ29kZSkgewogICAg\nICAgIGlmIChlcnJvckNvZGUgPT0gbnVsbCB8fCBlcnJvckNvZGUudHJpbSgp\nLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBT\nZXQ8U3RyaW5nPiBjb2RlcyA9IHNxbFN0YXRlQ29kZXMuZ2V0KGVycm9yVHlw\nZSk7CiAgICAgICAgaWYgKGNvZGVzID09IG51bGwpIHsKICAgICAgICAgICAg\nY29kZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAgICAgICAgIGNv\nZGVzLmFkZChlcnJvckNvZGUudHJpbSgpKTsKICAgICAgICAgICAgc3FsU3Rh\ndGVDb2Rlcy5wdXQoZXJyb3JUeXBlLCBjb2Rlcyk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgY29kZXMuYWRkKGVycm9yQ29kZS50cmltKCkpOwog\nICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBGSVhNRSAtIE9Q\nRU5KUEEtOTU3IC0gbG9ja1RpbWVvdXQgaXMgYSBzZXJ2ZXItc2lkZSBmdW5j\ndGlvbiBhbmQKICAgICAqIHNob3VsZG4ndCBiZSB1c2luZyBjbGllbnQtc2lk\nZSBzZXRRdWVyeVRpbWVvdXQgZm9yIGxvY2sgdGltZW91dHMuCiAgICAgKiAK\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9u\nIG9mIHNldHRpbmcgcXVlcnkgYW5kIGxvY2sgdGltZW91dHMuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBzdG1udAogICAgICogQHBhcmFtIGZldGNoIC0gb3B0\naW9uYWwgbG9jayBhbmQgcXVlcnkgdGltZW91dHMgaW4gbWlsbGlzZWNvbmRz\nCiAgICAgKiBAcGFyYW0gZm9yVXBkYXRlIC0gdHJ1ZSBpZiB3ZSBzaG91bGQg\nYWxzbyB0cnkgc2V0dGluZyBhIGxvY2sgdGltZW91dAogICAgICogQHRocm93\ncyBTUUxFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGlt\nZW91dHMoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJvb2xlYW4gZm9yVXBkYXRlKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3VwcG9ydHNRdWVy\neVRpbWVvdXQpIHsKICAgICAgICAgICAgaW50IHRpbWVvdXQgPSBmZXRjaC5n\nZXRRdWVyeVRpbWVvdXQoKTsKICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSkg\newogICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGxvY2tpbmcgc2Vs\nZWN0IGFuZCB0aGUgbG9jayB0aW1lb3V0IGlzIGdyZWF0ZXIgCiAgICAgICAg\nICAgICAgICAvLyB0aGFuIHRoZSBjb25maWd1cmVkIHF1ZXJ5IHRpbWVvdXQs\nIHVzZSB0aGUgbG9jayB0aW1lb3V0CiAgICAgICAgICAgICAgICB0aW1lb3V0\nID0gTWF0aC5tYXgoZmV0Y2guZ2V0UXVlcnlUaW1lb3V0KCksIAogICAgICAg\nICAgICAgICAgICAgIGZldGNoLmdldExvY2tUaW1lb3V0KCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHNldFF1ZXJ5VGltZW91dChzdG1udCwgdGlt\nZW91dCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRklYTUUg\nLSBPUEVOSlBBLTk1NyAtIGxvY2tUaW1lb3V0IGlzIGEgc2VydmVyLXNpZGUg\nZnVuY3Rpb24gYW5kCiAgICAgKiBzaG91bGRuJ3QgYmUgdXNpbmcgY2xpZW50\nLXNpZGUgc2V0UXVlcnlUaW1lb3V0IGZvciBsb2NrIHRpbWVvdXRzLgogICAg\nICogCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRl\nIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRh\ndGlvbiBvZiBzZXR0aW5nIHF1ZXJ5IGFuZCBsb2NrIHRpbWVvdXRzLgogICAg\nICogCiAgICAgKiBAcGFyYW0gc3RtbnQKICAgICAqIEBwYXJhbSBjb25mIC0g\nb3B0aW9uYWwgbG9jayBhbmQgcXVlcnkgdGltZW91dHMgaW4gbWlsbGlzZWNv\nbmRzCiAgICAgKiBAcGFyYW0gZm9yVXBkYXRlIC0gdHJ1ZSBpZiB3ZSBzaG91\nbGQgYWxzbyB0cnkgc2V0dGluZyBhIGxvY2sgdGltZW91dAogICAgICogQHRo\ncm93cyBTUUxFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nVGltZW91dHMoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIEpEQkNDb25maWd1\ncmF0aW9uIGNvbmYsCiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChzdXBwb3J0c1F1ZXJ5VGlt\nZW91dCkgewogICAgICAgICAgICBpbnQgdGltZW91dCA9IGNvbmYuZ2V0UXVl\ncnlUaW1lb3V0KCk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUpIHsKICAg\nICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBsb2NraW5nIHNlbGVjdCBh\nbmQgdGhlIGxvY2sgdGltZW91dCBpcyBncmVhdGVyCiAgICAgICAgICAgICAg\nICAvLyB0aGFuIHRoZSBjb25maWd1cmVkIHF1ZXJ5IHRpbWVvdXQsIHVzZSB0\naGUgbG9jayB0aW1lb3V0CiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gTWF0\naC5tYXgoY29uZi5nZXRRdWVyeVRpbWVvdXQoKSwgCiAgICAgICAgICAgICAg\nICAgICAgY29uZi5nZXRMb2NrVGltZW91dCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzZXRRdWVyeVRpbWVvdXQoc3RtbnQsIHRpbWVvdXQpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFByb3ZpZGVzIHRoZSBk\nZWZhdWx0IHZhbGlkYXRpb24gaGFuZGxpbmcgb2Ygc2V0dGluZyBhIHF1ZXJ5\nIHRpbWVvdXQuCiAgICAgKiBAcGFyYW0gc3RtbnQKICAgICAqIEBwYXJhbSB0\naW1lb3V0IGluIG1pbGxpc2Vjb25kcwogICAgICogQHRocm93cyBTUUxFeGNl\ncHRpb24KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UXVlcnlUaW1lb3V0\nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgdGltZW91dCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3VwcG9ydHNR\ndWVyeVRpbWVvdXQpIHsKICAgICAgICAgICAgaWYgKHRpbWVvdXQgPT0gLTEp\nIHsKICAgICAgICAgICAgICAgIC8vIHNwZWNpYWwgT3BlbkpQQSBhbGxvd2Vk\nIGNhc2UgZGVub3Rpbmcgbm8gdGltZW91dAogICAgICAgICAgICAgICAgdGlt\nZW91dCA9IDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGltZW91dCA8IDAp\nIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJpbnZhbGlk\nLXRpbWVvdXQiLCBuZXcgSW50ZWdlcih0aW1lb3V0KSkpOwogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRpbWVvdXQg\nPiAwICYmIHRpbWVvdXQgPCAxMDAwKSB7CiAgICAgICAgICAgICAgICAvLyBy\nb3VuZCB1cCB0byAxIHNlYwogICAgICAgICAgICAgICAgdGltZW91dCA9IDEw\nMDA7IAogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoIm1pbGxp\ncy1xdWVyeS10aW1lb3V0IikpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHNldFN0YXRlbWVudFF1ZXJ5VGltZW91dChzdG1udCwgdGltZW91dCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3Nl\ncyB0byBwcm92aWRlIERCIHVuaXF1ZSBvdmVycmlkZSBpbXBsZW1lbnRhdGlv\nbnMgb2YKICAgICAqIHNldHRpbmcgcXVlcnkgdGltZW91dHMsIHdoaWxlIHBy\nZXNlcnZpbmcgdGhlIGRlZmF1bHQgdGltZW91dCBsb2dpYwogICAgICogaW4g\ndGhlIHB1YmxpYyBzZXRRdWVyeVRpbWVvdXQgbWV0aG9kLgogICAgICogQHBh\ncmFtIHN0bW50CiAgICAgKiBAcGFyYW0gdGltZW91dCBpbiBtaWxsaXNlY29u\nZHMKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0aW9uCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHNldFN0YXRlbWVudFF1ZXJ5VGltZW91dChQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgCiAgICAgICAgaW50IHRpbWVvdXQpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIEpEQkMgdXNlcyBzZWNvbmRz\nLCBzbyB3ZSdsbCBkbyBhIHNpbXBsZSByb3VuZC1kb3duIGNvbnZlcnNpb24g\naGVyZQogICAgICAgIHN0bW50LnNldFF1ZXJ5VGltZW91dCh0aW1lb3V0IC8g\nMTAwMCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIENvbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVt\nZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgLyoqCiAgICAgKiBEZWNvcmF0ZSB0aGUgZ2l2ZW4gY29u\nbmVjdGlvbiBpZiBuZWVkZWQuIFNvbWUgZGF0YWJhc2VzIHJlcXVpcmUgc3Bl\nY2lhbAogICAgICogaGFuZGxpbmcgZm9yIEpEQkMgYnVncy4gVGhpcyBpbXBs\nZW1lbnRhdGlvbiBpc3N1ZXMgYW55CiAgICAgKiB7QGxpbmsgI2luaXRpYWxp\nemF0aW9uU1FMfSB0aGF0IGhhcyBiZWVuIHNldCBmb3IgdGhlIGRpY3Rpb25h\ncnkgYnV0CiAgICAgKiBkb2VzIG5vdCBkZWNvcmF0ZSB0aGUgY29ubmVjdGlv\nbi4KICAgICAqLwogICAgcHVibGljIENvbm5lY3Rpb24gZGVjb3JhdGUoQ29u\nbmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmICghY29ubmVjdGVkKQogICAgICAgICAgICBjb25uZWN0ZWRD\nb25maWd1cmF0aW9uKGNvbm4pOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShpbml0aWFsaXphdGlvblNRTCkpIHsKICAgICAgICAgICAgUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1l\nbnQoaW5pdGlhbGl6YXRpb25TUUwpOwogICAgICAgICAgICAgICAgc3RtbnQu\nZXhlY3V0ZSgpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShlLnRvU3RyaW5nKCksIGUp\nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYg\nKHN0bW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGNvbm47CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1l\nbnRhdGlvbiBvZiB0aGUKICAgICAqIHtAbGluayBMb2dnaW5nQ29ubmVjdGlv\nbkRlY29yYXRvci5TUUxXYXJuaW5nSGFuZGxlcn0gaW50ZXJmYWNlCiAgICAg\nKiB0aGF0IGFsbG93cyBjdXN0b21pemF0aW9uIG9mIHRoZSBhY3Rpb25zIHRv\nIHBlcmZvcm0gd2hlbiBhCiAgICAgKiB7QGxpbmsgU1FMV2FybmluZ30gb2Nj\ndXJzIGF0IGFueSBwb2ludCBvbiBhIHtAbGluayBDb25uZWN0aW9ufSwKICAg\nICAqIHtAbGluayBTdGF0ZW1lbnR9LCBvciB7QGxpbmsgUmVzdWx0U2V0fS4g\nVGhpcyBtZXRob2QgbWF5CiAgICAgKiBiZSB1c2VkIGRldGVybWluZSB0aG9z\nZSB3YXJuaW5ncyB0aGUgYXBwbGljYXRpb24gd2FudHMgdG8KICAgICAqIGNv\nbnNpZGVyIGNyaXRpY2FsIGZhaWx1cmVzLCBhbmQgdGhyb3cgdGhlIHdhcm5p\nbmcgaW4gdGhvc2UKICAgICAqIGNhc2VzLiBCeSBkZWZhdWx0LCB0aGlzIG1l\ndGhvZCBkb2VzIG5vdGhpbmcuCiAgICAgKgogICAgICogQHNlZSBMb2dnaW5n\nQ29ubmVjdGlvbkRlY29yYXRvciNzZXRXYXJuaW5nQWN0aW9uCiAgICAgKiBA\nc2VlIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yI3NldFdhcm5pbmdIYW5k\nbGVyCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGhhbmRsZVdhcm5pbmcoU1FM\nV2FybmluZyB3YXJuaW5nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IGV4Y2VwdGlv\nbiB0aGF0IHdyYXBzIDxjb2RlPmNhdXNlczwvY29kZT4uCiAgICAgKiBIb3dl\ndmVyLCB0aGUgZGV0YWlscyBvZiBleGFjdGx5IHdoYXQgdHlwZSBvZiBleGNl\ncHRpb24gaXMgcmV0dXJuZWQgY2FuCiAgICAgKiBiZSBkZXRlcm1pbmVkIGJ5\nIHRoZSBpbXBsZW1lbnRhdGlvbi4gVGhpcyBtYXkgdGFrZSBpbnRvIGFjY291\nbnQKICAgICAqIERCLXNwZWNpZmljIGV4Y2VwdGlvbiBpbmZvcm1hdGlvbiBp\nbiA8Y29kZT5jYXVzZXM8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgT3Bl\nbkpQQUV4Y2VwdGlvbiBuZXdTdG9yZUV4Y2VwdGlvbihTdHJpbmcgbXNnLCBT\nUUxFeGNlcHRpb25bXSBjYXVzZXMsCiAgICAgICAgT2JqZWN0IGZhaWxlZCkg\newogICAgICAgIGlmIChjYXVzZXMgIT0gbnVsbCAmJiBjYXVzZXMubGVuZ3Ro\nID4gMCkgewogICAgICAgICAgICBPcGVuSlBBRXhjZXB0aW9uIHJldCA9IG5h\ncnJvdyhtc2csIGNhdXNlc1swXSk7CiAgICAgICAgICAgIHJldC5zZXRGYWls\nZWRPYmplY3QoZmFpbGVkKS5zZXROZXN0ZWRUaHJvd2FibGVzKGNhdXNlcyk7\nCiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBuZXcgU3RvcmVFeGNlcHRpb24obXNnKS5zZXRGYWlsZWRPYmplY3Qo\nZmFpbGVkKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyhjYXVz\nZXMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHN1YnR5\ncGUgb2YgU3RvcmVFeGNlcHRpb24gYnkgbWF0Y2hpbmcgdGhlIGdpdmVuIFNR\nTEV4Y2VwdGlvbidzCiAgICAgKiBlcnJvciBzdGF0ZSBjb2RlIHRvIHRoZSBs\naXN0IG9mIGVycm9yIGNvZGVzIHN1cHBsaWVkIGJ5IHRoZSBkaWN0aW9uYXJ5\nLgogICAgICogUmV0dXJucyAtMSBpZiBubyBtYXRjaGluZyBjb2RlIGNhbiBi\nZSBmb3VuZC4KICAgICAqLwogICAgT3BlbkpQQUV4Y2VwdGlvbiBuYXJyb3co\nU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgQm9vbGVh\nbiByZWNvdmVyYWJsZSA9IG51bGw7CiAgICAgICAgaW50IGVycm9yVHlwZSA9\nIFN0b3JlRXhjZXB0aW9uLkdFTkVSQUw7CiAgICAgICAgZm9yIChJbnRlZ2Vy\nIHR5cGUgOiBzcWxTdGF0ZUNvZGVzLmtleVNldCgpKSB7CiAgICAgICAgICAg\nIFNldDxTdHJpbmc+IGVycm9yU3RhdGVzID0gc3FsU3RhdGVDb2Rlcy5nZXQo\ndHlwZSk7CiAgICAgICAgICAgIGlmIChlcnJvclN0YXRlcyAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICByZWNvdmVyYWJsZSA9IG1hdGNoRXJyb3JTdGF0\nZSh0eXBlLCBlcnJvclN0YXRlcywgZXgpOwogICAgICAgICAgICAgICAgaWYg\nKHJlY292ZXJhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBl\ncnJvclR5cGUgPSB0eXBlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIFN0b3JlRXhjZXB0aW9uIHN0b3JlRXg7CiAgICAgICAgc3dpdGNoIChl\ncnJvclR5cGUpIHsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0aW9uLkxPQ0s6\nCiAgICAgICAgICAgIHN0b3JlRXggPSBuZXcgTG9ja0V4Y2VwdGlvbihtc2cp\nOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0\naW9uLk9CSkVDVF9FWElTVFM6CiAgICAgICAgICAgIHN0b3JlRXggPSBuZXcg\nT2JqZWN0RXhpc3RzRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgIGNhc2UgU3RvcmVFeGNlcHRpb24uT0JKRUNUX05PVF9GT1VO\nRDoKICAgICAgICAgICAgc3RvcmVFeCA9IG5ldyBPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbihtc2cpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNl\nIFN0b3JlRXhjZXB0aW9uLk9QVElNSVNUSUM6CiAgICAgICAgICAgIHN0b3Jl\nRXggPSBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihtc2cpOwogICAgICAgICAg\nICBicmVhazsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0aW9uLlJFRkVSRU5U\nSUFMX0lOVEVHUklUWToKICAgICAgICAgICAgc3RvcmVFeCA9IG5ldyBSZWZl\ncmVudGlhbEludGVncml0eUV4Y2VwdGlvbihtc2cpOwogICAgICAgICAgICBi\ncmVhazsKICAgICAgICBjYXNlIFN0b3JlRXhjZXB0aW9uLlFVRVJZOgogICAg\nICAgICAgICBzdG9yZUV4ID0gbmV3IFF1ZXJ5RXhjZXB0aW9uKG1zZyk7CiAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nIHN0b3JlRXggPSBuZXcgU3RvcmVFeGNlcHRpb24obXNnKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKHJlY292ZXJhYmxlICE9IG51bGwpIHsKICAgICAgICAg\nICAgc3RvcmVFeC5zZXRGYXRhbCghcmVjb3ZlcmFibGUpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gc3RvcmVFeDsKICAgIH0KCiAgICAvKioKICAgICAq\nIERldGVybWluZSBpZiB0aGUgU1FMRXhjZXB0aW9uIGFyZ3VtZW50IG1hdGNo\nZXMgYW55IGVsZW1lbnQgaW4gdGhlCiAgICAgKiBlcnJvclN0YXRlcy4gRGlj\ndGlvbmFyeSBzdWJjbGFzcyBjYW4gb3ZlcnJpZGUgdGhpcyBtZXRob2QgYW5k\nIGV4dHJhY3QKICAgICAqIFNRTEV4Y2VwdGlvbiBkYXRhIHRvIGZpZ3VyZSBv\ndXQgaWYgdGhlIGV4Y2VwdGlvbiBpcyByZWNvdmVyYWJsZS4KICAgICAqIAog\nICAgICogQHJldHVybiBudWxsIGlmIG5vIG1hdGNoIGlzIGZvdW5kIG9yIGEg\nQm9vbGVhbiB2YWx1ZSBpbmRpY2F0ZXMgdGhlCiAgICAgKiBleGNlcHRpb24g\naXMgcmVjb3ZlcmFibGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCb29sZWFu\nIG1hdGNoRXJyb3JTdGF0ZShpbnQgc3VidHlwZSwgU2V0PFN0cmluZz4gZXJy\nb3JTdGF0ZXMsCiAgICAgICAgU1FMRXhjZXB0aW9uIGV4KSB7CiAgICAgICAg\nU3RyaW5nIGVycm9yU3RhdGUgPSBleC5nZXRTUUxTdGF0ZSgpOwogICAgICAg\nIHJldHVybiBlcnJvclN0YXRlcy5jb250YWlucyhlcnJvclN0YXRlKSA/IEJv\nb2xlYW4uRkFMU0UgOiBudWxsOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIENsb3NlcyB0aGUgc3BlY2lmaWVkIHtAbGluayBEYXRhU291cmNlfSBhbmQg\ncmVsZWFzZXMgYW55CiAgICAgKiByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRo\nIGl0LgogICAgICoKICAgICAqIEBwYXJhbSBkYXRhU291cmNlIHRoZSBEYXRh\nU291cmNlIHRvIGNsb3NlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3Nl\nRGF0YVNvdXJjZShEYXRhU291cmNlIGRhdGFTb3VyY2UpIHsKICAgICAgICBE\nYXRhU291cmNlRmFjdG9yeS5jbG9zZURhdGFTb3VyY2UoZGF0YVNvdXJjZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHNvbWUgbWFwcGluZ3Mg\ndG8gcmVwcmVzZW50IGRhdGEgdGhhdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAg\nKiBzZXJpYWxpemVkIHNvIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byBzZXJpYWxp\nemUgbXVsdGlwbGUgdGltZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nY2xhc3MgU2VyaWFsaXplZERhdGEgewoKICAgICAgICBwdWJsaWMgZmluYWwg\nYnl0ZVtdIGJ5dGVzOwoKICAgICAgICBwdWJsaWMgU2VyaWFsaXplZERhdGEo\nYnl0ZVtdIGJ5dGVzKSB7CiAgICAgICAgICAgIHRoaXMuYnl0ZXMgPSBieXRl\nczsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJu\nIHZlcnNpb24gY29sdW1uIG5hbWUKICAgICAqIEBwYXJhbSBjb2x1bW4KICAg\nICAqIEBwYXJhbSB0YWJsZUFsaWFzIDogdGhpcyBpcyBuZWVkZWQgZm9yIHBs\nYXRmb3JtIHNwZWNpZmljIHZlcnNpb24gY29sdW1uCiAgICAgKiBAcmV0dXJu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmVyc2lvbkNvbHVtbihD\nb2x1bW4gY29sdW1uLCBTdHJpbmcgdGFibGVBbGlhcykgewogICAgICAgIHJl\ndHVybiBnZXRWZXJzaW9uQ29sdW1uKGNvbHVtbiwgREJJZGVudGlmaWVyLm5l\nd1RhYmxlKHRhYmxlQWxpYXMpKS50b1N0cmluZygpOwogICAgfQoKICAgIHB1\nYmxpYyBEQklkZW50aWZpZXIgZ2V0VmVyc2lvbkNvbHVtbihDb2x1bW4gY29s\ndW1uLCBEQklkZW50aWZpZXIgdGFibGVBbGlhcykgewogICAgICAgIHJldHVy\nbiBjb2x1bW4uZ2V0SWRlbnRpZmllcigpOwogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCBpbnNlcnRCbG9iRm9yU3RyZWFtaW5nTG9hZChSb3cgcm93LCBD\nb2x1bW4gY29sLCAKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVjdCBv\nYiwgU2VsZWN0IHNlbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKG9iICE9IG51bGwpIHsKICAgICAgICAgICAgcm93LnNldEJpbmFyeVN0\ncmVhbShjb2wsIAogICAgICAgICAgICAgICAgbmV3IEJ5dGVBcnJheUlucHV0\nU3RyZWFtKG5ldyBieXRlWzBdKSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcm93LnNldE51bGwoY29sKTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIGluc2VydENsb2JGb3JTdHJlYW1pbmdMb2Fk\nKFJvdyByb3csIENvbHVtbiBjb2wsIE9iamVjdCBvYikKICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChvYiAhPSBudWxsKSB7CiAgICAg\nICAgcm93LnNldENoYXJhY3RlclN0cmVhbShjb2wsCiAgICAgICAgICAgICAg\nICBuZXcgQ2hhckFycmF5UmVhZGVyKG5ldyBjaGFyWzBdKSwgMCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LnNldE51bGwoY29sKTsKICAg\nICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZUJsb2Io\nU2VsZWN0IHNlbCwgSkRCQ1N0b3JlIHN0b3JlLCBJbnB1dFN0cmVhbSBpcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTUUxCdWZm\nZXIgc3FsID0gc2VsLnRvU2VsZWN0KHRydWUsIHN0b3JlLmdldEZldGNoQ29u\nZmlndXJhdGlvbigpKTsKICAgICAgICBSZXN1bHRTZXQgcmVzID0gbnVsbDsK\nICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9u\nKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0bW50ID0gc3FsLnByZXBhcmVT\ndGF0ZW1lbnQoY29ubiwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCks\nCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQuVFlQRV9TQ1JPTExfU0VOU0lU\nSVZFLAogICAgICAgICAgICAgICAgUmVzdWx0U2V0LkNPTkNVUl9VUERBVEFC\nTEUpOwogICAgICAgICAgICBzZXRUaW1lb3V0cyhzdG1udCwgc3RvcmUuZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCksIHRydWUpOwogICAgICAgICAgICByZXMg\nPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAgaWYgKCFyZXMu\nbmV4dCgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oX2xvYy5nZXQoInN0cmVhbS1leGNlcHRpb24iKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgQmxvYiBibG9iID0gcmVzLmdldEJsb2Io\nMSk7CiAgICAgICAgICAgIE91dHB1dFN0cmVhbSBvcyA9IGJsb2Iuc2V0Qmlu\nYXJ5U3RyZWFtKDEpOwogICAgICAgICAgICBjb3B5KGlzLCBvcyk7CiAgICAg\nICAgICAgIG9zLmNsb3NlKCk7CiAgICAgICAgICAgIHJlcy51cGRhdGVCbG9i\nKDEsIGJsb2IpOwogICAgICAgICAgICByZXMudXBkYXRlUm93KCk7CgogICAg\nICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oaW9lKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAocmVzICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0cnkgeyByZXMuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlICgpOyB9IGNhdGNoIChTUUxF\neGNlcHRpb24gZSkge30KICAgICAgICAgICAgaWYgKGNvbm4gIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UgKCk7IH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBlKSB7fQogICAgICAgIH0KICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgdXBkYXRlQ2xvYihTZWxlY3Qgc2VsLCBKREJDU3RvcmUg\nc3RvcmUsIFJlYWRlciByZWFkZXIpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU1FMQnVmZmVyIHNxbCA9IHNlbC50b1NlbGVjdCh0\ncnVlLCBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAg\nUmVzdWx0U2V0IHJlcyA9IG51bGw7CiAgICAgICAgQ29ubmVjdGlvbiBjb25u\nID0gc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBzdG1udCA9IHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIHN0b3JlLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgUmVzdWx0\nU2V0LlRZUEVfU0NST0xMX1NFTlNJVElWRSwKICAgICAgICAgICAgICAgIFJl\nc3VsdFNldC5DT05DVVJfVVBEQVRBQkxFKTsKICAgICAgICAgICAgc2V0VGlt\nZW91dHMoc3RtbnQsIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpLCB0\ncnVlKTsKICAgICAgICAgICAgcmVzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7\nCiAgICAgICAgICAgIGlmICghcmVzLm5leHQoKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJzdHJl\nYW0tZXhjZXB0aW9uIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIENs\nb2IgY2xvYiA9IHJlcy5nZXRDbG9iKDEpOwogICAgICAgICAgICBpZiAoY2xv\nYiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBXcml0ZXIgd3JpdGVyID0g\nY2xvYi5zZXRDaGFyYWN0ZXJTdHJlYW0oMSk7CiAgICAgICAgICAgICAgICBj\nb3B5KHJlYWRlciwgd3JpdGVyKTsKICAgICAgICAgICAgICAgIHdyaXRlci5j\nbG9zZSgpOwogICAgICAgICAgICAgICAgcmVzLnVwZGF0ZUNsb2IoMSwgY2xv\nYik7CiAgICAgICAgICAgICAgICByZXMudXBkYXRlUm93KCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihpb2UpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkg\nCiAgICAgICAgICAgICAgICB0cnkgeyByZXMuY2xvc2UgKCk7IH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0g\nbnVsbCkgCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSAoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChj\nb25uICE9IG51bGwpIAogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9z\nZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfSAg\nICAKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGxvbmcgY29weShJbnB1dFN0\ncmVhbSBpbiwgT3V0cHV0U3RyZWFtIG91dCkgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBieXRlW10gY29weUJ1ZmZlciA9IG5ldyBieXRlW2Jsb2JC\ndWZmZXJTaXplXTsKICAgICAgICBsb25nIGJ5dGVzQ29waWVkID0gMDsKICAg\nICAgICBpbnQgcmVhZCA9IC0xOwoKICAgICAgICB3aGlsZSAoKHJlYWQgPSBp\nbi5yZWFkKGNvcHlCdWZmZXIsIDAsIGNvcHlCdWZmZXIubGVuZ3RoKSkgIT0g\nLTEpIHsKICAgICAgICAgICAgb3V0LndyaXRlKGNvcHlCdWZmZXIsIDAsIHJl\nYWQpOwogICAgICAgICAgICBieXRlc0NvcGllZCArPSByZWFkOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gYnl0ZXNDb3BpZWQ7CiAgICB9CiAgICAKICAg\nIHByb3RlY3RlZCBsb25nIGNvcHkoUmVhZGVyIHJlYWRlciwgV3JpdGVyIHdy\naXRlcikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGFyW10gY29w\neUJ1ZmZlciA9IG5ldyBjaGFyW2Nsb2JCdWZmZXJTaXplXTsKICAgICAgICBs\nb25nIGJ5dGVzQ29waWVkID0gMDsKICAgICAgICBpbnQgcmVhZCA9IC0xOwoK\nICAgICAgICB3aGlsZSAoKHJlYWQgPSByZWFkZXIucmVhZChjb3B5QnVmZmVy\nLCAwLCBjb3B5QnVmZmVyLmxlbmd0aCkpICE9IC0xKSB7CiAgICAgICAgICAg\nIHdyaXRlci53cml0ZShjb3B5QnVmZmVyLCAwLCByZWFkKTsKICAgICAgICAg\nICAgYnl0ZXNDb3BpZWQgKz0gcmVhZDsKICAgICAgICB9CgogICAgICAgIHJl\ndHVybiBieXRlc0NvcGllZDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBB\ndHRhY2ggQ0FTVCB0byB0aGUgY3VycmVudCBmdW5jdGlvbiBpZiBuZWNlc3Nh\ncnkKICAgICAqIAogICAgICogQHBhcmFtIHZhbCBvcGVyYW5kIHZhbHVlCiAg\nICAgKiBAcGFybWEgZnVuYyB0aGUgc3FsIGZ1bmN0aW9uIHN0YXRlbWVudAog\nICAgICogQHJldHVybiBhIFN0cmluZyB3aXRoIHRoZSBjb3JyZWN0IENBU1Qg\nZnVuY3Rpb24gc3ludGF4CiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ2FzdEZ1bmN0aW9uKFZhbCB2YWwsIFN0cmluZyBmdW5jKSB7CiAgICAgICAg\ncmV0dXJuIGZ1bmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGNvcnJlY3QgQ0FTVCBmdW5jdGlvbiBzeW50YXguICBUaGlzIHNob3VsZCBi\nZSBvdmVycmlkZW4gYnkgc3ViY2xhc3NlcwogICAgICogdGhhdCBuZWVkIGFj\nY2VzcyB0byB0aGUgQ29sdW1uIGluZm9ybWF0aW9uLgogICAgICogCiAgICAg\nKiBAcGFyYW0gdmFsIG9wZXJhbmQgb2YgY2FzdAogICAgICogQHBhcmFtIGZ1\nbmMgb3JpZ2luYWwgc3RyaW5nCiAgICAgKiBAcGFyYW0gY29sIGRhdGFiYXNl\nIGNvbHVtbgogICAgICogQHJldHVybiBhIFN0cmluZyB3aXRoIHRoZSBjb3Jy\nZWN0IENBU1QgZnVuY3Rpb24gc3ludGF4CiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0Q2FzdEZ1bmN0aW9uKFZhbCB2YWwsIFN0cmluZyBmdW5jLCBD\nb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIGdldENhc3RGdW5jdGlvbiAo\ndmFsLCBmdW5jKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYW4gaW5kZXggaWYgbmVjZXNzYXJ5IGZvciBzb21lIGRhdGFiYXNlIHRhYmxl\ncwogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHVibGljIHZvaWQg\nY3JlYXRlSW5kZXhJZk5lY2Vzc2FyeShTY2hlbWEgc2NoZW1hLCBTdHJpbmcg\ndGFibGUsCiAgICAgICAgICAgIENvbHVtbiBwa0NvbHVtbikgewogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGNyZWF0ZUluZGV4SWZOZWNlc3NhcnkoU2NoZW1h\nIHNjaGVtYSwgREJJZGVudGlmaWVyIHRhYmxlLAogICAgICAgIENvbHVtbiBw\na0NvbHVtbikgewogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgYmF0Y2hMaW1pdAogICAgICovCiAgICBwdWJsaWMgaW50IGdldEJhdGNo\nTGltaXQoKXsKICAgICAgICByZXR1cm4gYmF0Y2hMaW1pdDsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBTZXQgdGhlIGJhdGNoTGltaXQgdmFsdWUKICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0QmF0Y2hMaW1pdChpbnQgbGltaXQp\newogICAgICAgIGJhdGNoTGltaXQgPSBsaW1pdDsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGUgYmF0Y2ggcHJvY2Vzcy4gSW4gc29t\nZSBjYXNlcywgd2UgY2FuJ3QgYmF0Y2ggdGhlIHN0YXRlbWVudHMKICAgICAq\nIGR1ZSB0byBzb21lIHJlc3RyaWN0aW9ucy4gRm9yIGV4YW1wbGUsIGlmIHRo\nZSBHZW5lcmF0ZWRUeXBlPUlERU5USVRZLAogICAgICogd2UgaGF2ZSB0byBk\naXNhYmxlIHRoZSBiYXRjaCBwcm9jZXNzIGJlY2F1c2Ugd2UgbmVlZCB0byBn\nZXQgdGhlIElEIHZhbHVlCiAgICAgKiByaWdodCBhd2F5IGZvciB0aGUgaW4t\nbWVtb3J5IGVudGl0eSB0byB1c2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIHZhbGlkYXRlQmF0Y2hQcm9jZXNzKFJvd0ltcGwgcm93LCBDb2x1bW5b\nXSBhdXRvQXNzaWduLAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nICBzbSwgQ2xhc3NNYXBwaW5nIGNtZCApIHsKICAgICAgICBib29sZWFuIGRp\nc2FibGVCYXRjaCA9IGZhbHNlOwogICAgICAgIGlmIChnZXRCYXRjaExpbWl0\nKCk9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGF1dG9Bc3NpZ24g\nIT0gbnVsbCAmJiBzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWQgPSBjbWQuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAg\nICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxlICghZGlzYWJs\nZUJhdGNoICYmIGkgPCBmbWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBp\nZiAoZm1kW2ldLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdp\nZXMuQVVUT0FTU0lHTikKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlQmF0\nY2ggPSB0cnVlOwogICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIC8vIGdvIHRvIGVhY2ggRGljdGlvbmFyeSB0\nbyB2YWxpZGF0ZSB0aGUgYmF0Y2ggY2FwYWJpbGl0eQogICAgICAgIGlmICgh\nZGlzYWJsZUJhdGNoKQogICAgICAgICAgICBkaXNhYmxlQmF0Y2ggPSB2YWxp\nZGF0ZURCU3BlY2lmaWNCYXRjaFByb2Nlc3MoZGlzYWJsZUJhdGNoLCByb3cs\nIAogICAgICAgICAgICAgICAgYXV0b0Fzc2lnbiwgc20sIGNtZCk7CiAgICAg\nICAgcmV0dXJuIGRpc2FibGVCYXRjaDsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBBbGxvdyBlYWNoIERpY3Rpb25hcnkgdG8gdmFsaWRhdGUgaXRzIG93\nbiBiYXRjaCBwcm9jZXNzLiAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\ndmFsaWRhdGVEQlNwZWNpZmljQmF0Y2hQcm9jZXNzIChib29sZWFuIGRpc2Fi\nbGVCYXRjaCwgCiAgICAgICAgICAgIFJvd0ltcGwgcm93LCBDb2x1bW5bXSBh\ndXRvQXNzaWduLCAKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciAg\nc20sIENsYXNzTWFwcGluZyBjbWQgKSB7CiAgICAgICAgcmV0dXJuIGRpc2Fi\nbGVCYXRjaDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhv\nZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJD\nLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcgcXVl\ncnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1\nZXJ5KENvbm5lY3Rpb24gY29ubiwgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nCiAgICAgICAgICAgIFN0cmluZyBzcWwgCiAgICAgICAgKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gc3RtbnQuZXhlY3V0ZVF1ZXJ5\nKCk7CiAgICB9CiAgICAgICAgICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1l\ndGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBK\nREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcg\nc3RhdGVtZW50LgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0\nZW1lbnQgcHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4sIFN0cmlu\nZyBzcWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIGNvbm4ucHJlcGFyZVN0YXRlbWVudChzcWwpOwogICAgfSAgICAK\nIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBnZXR0aW5nIHNlcXVlbmNlIGZyb20gdGhlIHJlc3Vs\ndCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXF1ZW5jZVtdIGdldFNl\ncXVlbmNlKFJlc3VsdFNldCBycykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgTGlzdCBzZXFMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nIHdoaWxlIChycyAhPSBudWxsICYmIHJzLm5leHQoKSkKICAgICAgICAgICAg\nc2VxTGlzdC5hZGQobmV3U2VxdWVuY2UocnMpKTsKICAgICAgICByZXR1cm4g\nKFNlcXVlbmNlW10pIHNlcUxpc3QudG9BcnJheShuZXcgU2VxdWVuY2Vbc2Vx\nTGlzdC5zaXplKCldKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlz\nIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBv\nciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBnZXR0aW5n\nIGtleSBmcm9tIHRoZSByZXN1bHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0\nZWQgT2JqZWN0IGdldEtleSAoUmVzdWx0U2V0IHJzLCBDb2x1bW4gY29sKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXJzLm5leHQoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1nZW5rZXkiKSk7CiAgICAgICAgT2JqZWN0IGtleSA9IHJzLmdldE9i\namVjdCgxKTsKICAgICAgICBpZiAoa2V5ID09IG51bGwpCiAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KCJpbnZhbGlkLWdlbmtleSIsIGNvbCkpOwog\nICAgICAgIHJldHVybiBrZXk7ICAgICAgICAKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZv\nciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbiBvZiBjYWxjdWxhdGluZyB2YWx1ZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgY2FsY3VsYXRlVmFsdWUoVmFsIHZhbCwgU2VsZWN0IHNlbCwgRXhw\nQ29udGV4dCBjdHgsIAogICAgICAgIEV4cFN0YXRlIHN0YXRlLCBQYXRoIHBh\ndGgsIEV4cFN0YXRlIHBhdGhTdGF0ZSkgewogICAgICAgIHZhbC5jYWxjdWxh\ndGVWYWx1ZShzZWwsIGN0eCwgc3RhdGUsIChWYWwpIHBhdGgsIHBhdGhTdGF0\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciB0\naGUgcHJvdmlkZWQgPGNvZGU+c3FsPC9jb2RlPiBtYXkgYmUgdHJlYXRlZCBh\ncyBhIAogICAgICogc2VsZWN0IHN0YXRlbWVudCBvbiB0aGlzIGRhdGFiYXNl\nLgogICAgICogIAogICAgICogQHBhcmFtIHNxbCAgIEEgc3FsIHN0YXRlbWVu\ndC4gCiAgICAgKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiA8Y29kZT5zcWw8\nL2NvZGU+IHJlcHJlc2VudHMgYSBzZWxlY3Qgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NlbGVjdChTdHJpbmcgc3FsKSB7CiAg\nICAgICAgSXRlcmF0b3IgaSA9IHNlbGVjdFdvcmRTZXQuaXRlcmF0b3IoKTsK\nICAgICAgICBTdHJpbmcgY3VyOwogICAgICAgIHdoaWxlIChpLmhhc05leHQo\nKSkgewogICAgICAgICAgICBjdXIgPSAoU3RyaW5nKSBpLm5leHQoKTsKICAg\nICAgICAgICAgaWYgKHNxbC5sZW5ndGgoKSA+PSBjdXIubGVuZ3RoKCkKICAg\nICAgICAgICAgICAgICAgICAmJiBzcWwuc3Vic3RyaW5nKDAsIGN1ci5sZW5n\ndGgoKSkuZXF1YWxzSWdub3JlQ2FzZShjdXIpKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbmVl\nZHNUb0NyZWF0ZUluZGV4KEluZGV4IGlkeCwgVGFibGUgdGFibGUpIHsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBiYXRjaGVkIHN0YXRlbWVudHMgdXBkYXRlIHN1Y2Nlc3MgY291bnQKICAg\nICAqIEBwYXJhbSBwcyBBIFByZXBhcmVkU3RhdGVtZW50CiAgICAgKiBAcmV0\ndXJuIHJldHVybiB1cGRhdGUgY291bnQKICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRCYXRjaFVwZGF0ZUNvdW50KFByZXBhcmVkU3RhdGVtZW50IHBzKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0K\nICAgIAogICAgcHVibGljIGJvb2xlYW4gZ2V0VHJpbVNjaGVtYU5hbWUoKSB7\nIAogICAgICAgIHJldHVybiB0cmltU2NoZW1hTmFtZTsKICAgIH0KICAgIAog\nICAgcHVibGljIHZvaWQgc2V0VHJpbVNjaGVtYU5hbWUoYm9vbGVhbiB0cmlt\nU2NoZW1hTmFtZSkgeyAKICAgICAgICB0aGlzLnRyaW1TY2hlbWFOYW1lID0g\ndHJpbVNjaGVtYU5hbWU7IAogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBk\nZWxldGVTdHJlYW0oSkRCQ1N0b3JlIHN0b3JlLCBTZWxlY3Qgc2VsKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBEbyBub3RoaW5nCiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgZ2l2ZW4g\nbmFtZSBpcyBubyBsb25nZXIgdGhhbiBnaXZlbiBtYXhpbXVtIGxlbmd0aC4K\nICAgICAqIElmIHRoZSBnaXZlbiBuYW1lIGlzIGluZGVlZCBsb25nZXIgdGhl\nbiByYWlzZXMgYW4gVXNlckV4Y2VwdGlvbiB3aXRoIHRoZSAKICAgICAqIGdp\ndmVuIG1lc3NhZ2Uga2V5IG90aGVyd2lzZSByZXR1cm5zIHRoZSBzYW1lIG5h\nbWUuCiAgICAgKi8KICAgIGZpbmFsIFN0cmluZyBjaGVja05hbWVMZW5ndGgo\nU3RyaW5nIG5hbWUsIGludCBsZW5ndGgsIFN0cmluZyBtc2dLZXkpIHsKICAg\nICAgICBpZiAobmFtZS5sZW5ndGgoKSA+IGxlbmd0aCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQobXNnS2V5LCBuYW1l\nLCBuYW1lLmxlbmd0aCgpLCAKICAgICAgICAgICAgICAgICAgICBsZW5ndGgp\nKTsKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\ndm9pZCBzZXREZWxpbWl0ZWRDYXNlKERhdGFiYXNlTWV0YURhdGEgbWV0YURh\ndGEpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobWV0YURhdGEu\nc3RvcmVzTWl4ZWRDYXNlUXVvdGVkSWRlbnRpZmllcnMoKSkgewogICAgICAg\nICAgICAgICAgZGVsaW1pdGVkQ2FzZSA9IFNDSEVNQV9DQVNFX1BSRVNFUlZF\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKG1ldGFEYXRh\nLnN0b3Jlc1VwcGVyQ2FzZVF1b3RlZElkZW50aWZpZXJzKCkpIHsKICAgICAg\nICAgICAgICAgIGRlbGltaXRlZENhc2UgPSBTQ0hFTUFfQ0FTRV9VUFBFUjsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChtZXRhRGF0YS5z\ndG9yZXNMb3dlckNhc2VRdW90ZWRJZGVudGlmaWVycygpKSB7CiAgICAgICAg\nICAgICAgICBkZWxpbWl0ZWRDYXNlID0gU0NIRU1BX0NBU0VfTE9XRVI7CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gZSkg\newogICAgICAgICAgICBnZXRMb2coKS53YXJuKCJjYW5ub3QtZGV0ZXJtaW5l\nLWlkZW50aWZpZXItY2FzZSIpOwogICAgICAgICAgICBpZiAoZ2V0TG9nKCku\naXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgZ2V0TG9nKCku\ndHJhY2UoZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBzdXBw\nb3J0c0RlbGltaXRlZElkcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRTdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzKCkgewogICAgICAgIHJl\ndHVybiBzdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzOwogICAgfQoKICAg\nIC8qKgogICAgICogQHBhcmFtIHN1cHBvcnRzRGVsaW1pdGVkSWRzIHRoZSBz\ndXBwb3J0c0RlbGltaXRlZElkcyB0byBzZXQKICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0U3VwcG9ydHNEZWxpbWl0ZWRJZGVudGlmaWVycyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGFEYXRhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgc3VwcG9ydHNEZWxpbWl0ZWRJZGVudGlmaWVycyA9IAogICAgICAgICAg\nICAgICAgbWV0YURhdGEuc3VwcG9ydHNNaXhlZENhc2VRdW90ZWRJZGVudGlm\naWVycygpIHx8CiAgICAgICAgICAgICAgICBtZXRhRGF0YS5zdG9yZXNMb3dl\nckNhc2VRdW90ZWRJZGVudGlmaWVycygpIHx8CiAgICAgICAgICAgICAgICBt\nZXRhRGF0YS5zdG9yZXNVcHBlckNhc2VRdW90ZWRJZGVudGlmaWVycygpOwog\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIHN1cHBvcnRzRGVsaW1pdGVkSWRlbnRpZmllcnMgPSBmYWxzZTsKICAgICAg\nICAgICAgZ2V0TG9nKCkud2FybihfbG9jLmdldCgidW5rbm93bi1kZWxpbS1z\ndXBwb3J0IiwgZSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEByZXR1cm4gdGhlIGRlbGltaXRJZHMKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZ2V0RGVsaW1pdElkZW50aWZpZXJzKCkgewogICAgICAgIHJldHVy\nbiBkZWxpbWl0SWRlbnRpZmllcnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBA\ncGFyYW0gZGVsaW1pdElkcyB0aGUgZGVsaW1pdElkcyB0byBzZXQKICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RGVsaW1pdElkZW50aWZpZXJzKGJvb2xl\nYW4gZGVsaW1pdElkcykgewogICAgICAgIGRlbGltaXRJZGVudGlmaWVycyA9\nIGRlbGltaXRJZHM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQHJldHVy\nbiBzdXBwb3J0c1hNTENvbHVtbgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRTdXBwb3J0c1hNTENvbHVtbigpIHsKICAgICAgICByZXR1cm4gc3Vw\ncG9ydHNYTUxDb2x1bW47CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0g\nYiBib29sZWFuIHJlcHJlc2VudGluZyBpZiBYTUwgY29sdW1ucyBhcmUgc3Vw\ncG9ydGVkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN1cHBvcnRzWE1M\nQ29sdW1uKGJvb2xlYW4gYikgewogICAgICAgIHN1cHBvcnRzWE1MQ29sdW1u\nID0gYjsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAcmV0dXJuIHhtbFR5\ncGVFbmNvZGluZwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFhNTFR5\ncGVFbmNvZGluZygpIHsKICAgICAgICByZXR1cm4geG1sVHlwZUVuY29kaW5n\nOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIGVuY29kaW5nIGRhdGFi\nYXNlIHJlcXVpcmVkIEpBWEIgZW5jb2RpbmcgZm9yIHRoZSBYTUwgdmFsdWUK\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0WE1MVHlwZUVuY29kaW5nKFN0\ncmluZyBlbmNvZGluZykgewogICAgICAgIHhtbFR5cGVFbmNvZGluZyA9IGVu\nY29kaW5nOwogICAgfQoKICAgIHB1YmxpYyBMb2cgZ2V0TG9nKCkgeyAKICAg\nICAgICByZXR1cm4gbG9nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGRl\nbGltaXRBbGwoKSB7CiAgICAgICAgcmV0dXJuIGRlbGltaXRJZGVudGlmaWVy\nczsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldExlYWRpbmdEZWxpbWl0\nZXIoKSB7CiAgICAgICAgcmV0dXJuIGxlYWRpbmdEZWxpbWl0ZXI7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0TGVhZGluZ0RlbGltaXRlcihTdHJpbmcg\nZGVsaW0pIHsKICAgICAgICBsZWFkaW5nRGVsaW1pdGVyID0gZGVsaW07CiAg\nICB9CgogICAgcHVibGljIFN0cmluZyBnZXRJZGVudGlmaWVyRGVsaW1pdGVy\nKCkgewogICAgICAgIHJldHVybiBjYXRhbG9nU2VwYXJhdG9yOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0SWRlbnRpZmllckNvbmNhdGVuYXRvcigp\nIHsKICAgICAgICByZXR1cm4gbmFtZUNvbmNhdGVuYXRvcjsKICAgIH0KICAg\nIAogICAgcHVibGljIFN0cmluZyBnZXRUcmFpbGluZ0RlbGltaXRlcigpIHsK\nICAgICAgICByZXR1cm4gdHJhaWxpbmdEZWxpbWl0ZXI7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0VHJhaWxpbmdEZWxpbWl0ZXIoU3RyaW5nIGRlbGlt\nKSB7CiAgICAgICAgdHJhaWxpbmdEZWxpbWl0ZXIgPSBkZWxpbTsKICAgIH0K\nCiAgICBwdWJsaWMgSWRlbnRpZmllclJ1bGUgZ2V0RGVmYXVsdElkZW50aWZp\nZXJSdWxlKCkgewogICAgICAgIGlmIChkZWZhdWx0TmFtaW5nUnVsZSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGRlZmF1bHROYW1pbmdSdWxlID0gbmFtaW5n\nUnVsZXMuZ2V0KERCSWRlbnRpZmllclR5cGUuREVGQVVMVC5uYW1lKCkpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmYXVsdE5hbWluZ1J1bGU7CiAg\nICB9CgogICAgcHVibGljIDxUPiBJZGVudGlmaWVyUnVsZSBnZXRJZGVudGlm\naWVyUnVsZShUIHQpIHsKICAgICAgICBpZiAodC5lcXVhbHMoREJJZGVudGlm\naWVyVHlwZS5ERUZBVUxULm5hbWUoKSkpIHsKICAgICAgICAgICAgcmV0dXJu\nIGdldERlZmF1bHRJZGVudGlmaWVyUnVsZSgpOwogICAgICAgIH0KICAgICAg\nICBJZGVudGlmaWVyUnVsZSBucnVsZSA9IG5hbWluZ1J1bGVzLmdldCh0KTsK\nICAgICAgICBpZiAobnJ1bGUgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1\ncm4gZ2V0RGVmYXVsdElkZW50aWZpZXJSdWxlKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBucnVsZTsKICAgIH0KCiAgICBAU3VwcHJlc3NXYXJuaW5n\ncygidW5jaGVja2VkIikKICAgIHB1YmxpYyBNYXA8U3RyaW5nLCBJZGVudGlm\naWVyUnVsZT4gZ2V0SWRlbnRpZmllclJ1bGVzKCkgewogICAgICAgIHJldHVy\nbiBuYW1pbmdSdWxlczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndGhlIG5hbWluZyB1dGlsaXR5IHVzZWQgYnkgdGhpcyBkaWN0aW9uYXJ5IGlu\nc3RhbmNlCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHB1YmxpYyBEQklk\nZW50aWZpZXJVdGlsIGdldE5hbWluZ1V0aWwoKSB7CiAgICAgICAgcmV0dXJu\nIG5hbWluZ1V0aWw7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nRGVsaW1pdGVkQ2FzZSgpIHsKICAgICAgICByZXR1cm4gZGVsaW1pdGVkQ2Fz\nZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvREJOYW1lKERCSWRlbnRp\nZmllciBuYW1lKSB7CiAgICAgICAgcmV0dXJuIGdldE5hbWluZ1V0aWwoKS50\nb0RCTmFtZShuYW1lKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvREJO\nYW1lKERCSWRlbnRpZmllciBuYW1lLCBib29sZWFuIGRlbGltaXQpIHsKICAg\nICAgICByZXR1cm4gZ2V0TmFtaW5nVXRpbCgpLnRvREJOYW1lKG5hbWUsIGRl\nbGltaXQpOwogICAgfQoKICAgIHB1YmxpYyBEQklkZW50aWZpZXIgZnJvbURC\nTmFtZShTdHJpbmcgbmFtZSwgREJJZGVudGlmaWVyVHlwZSBpZCkgewogICAg\nICAgIHJldHVybiBnZXROYW1pbmdVdGlsKCkuZnJvbURCTmFtZShuYW1lLCBp\nZCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRTY2hl\nbWFOYW1lKFN0cmluZyBkZWZhdWx0U2NoZW1hTmFtZSkgewogICAgICAgIHRo\naXMuZGVmYXVsdFNjaGVtYU5hbWUgPSBkZWZhdWx0U2NoZW1hTmFtZTsKICAg\nIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldERlZmF1bHRTY2hlbWFOYW1lKCkg\newogICAgICAgIHJldHVybiBkZWZhdWx0U2NoZW1hTmFtZTsKICAgIH0KICAg\nIAogICAgcHVibGljIFN0cmluZyBnZXRDb252ZXJzaW9uS2V5KCkgewogICAg\nICAgIGlmIChjb252ZXJzaW9uS2V5ID09IG51bGwpIHsKICAgICAgICAgICAg\nY29udmVyc2lvbktleSA9IGdldExlYWRpbmdEZWxpbWl0ZXIoKSArIGdldElk\nZW50aWZpZXJEZWxpbWl0ZXIoKSArCiAgICAgICAgICAgIGdldFRyYWlsaW5n\nRGVsaW1pdGVyKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb252ZXJz\naW9uS2V5OwogICAgfQp9Cg==\n","encoding":"base64"}

