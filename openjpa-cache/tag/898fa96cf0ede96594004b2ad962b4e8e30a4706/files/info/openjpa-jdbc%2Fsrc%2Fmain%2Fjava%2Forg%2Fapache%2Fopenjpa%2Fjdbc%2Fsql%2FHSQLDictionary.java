{"sha":"d8e4635354b079f32e5899e7941d95df3cd26ce3","node_id":"MDQ6QmxvYjIwNjM2NDpkOGU0NjM1MzU0YjA3OWYzMmU1ODk5ZTc5NDFkOTVkZjNjZDI2Y2Uz","size":11224,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d8e4635354b079f32e5899e7941d95df3cd26ce3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0\nIGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwu\nU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlzOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmhzcWxkYi5UcmFjZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZpZXIuREJJZGVu\ndGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9uOwoK\nLyoqCiAqIERpY3Rpb25hcnkgZm9yIEh5cGVyc29uaWMgU1FMIGRhdGFiYXNl\nLgogKi8KcHVibGljIGNsYXNzIEhTUUxEaWN0aW9uYXJ5CiAgICBleHRlbmRz\nIERCRGljdGlvbmFyeSB7CgogICAgLyoqCiAgICAgKiBTZXRzIHdoZXRoZXIg\nSFNRTCBzaG91bGQgdXNlICJDUkVBVEVEIENBQ0hFRCBUQUJMRSIgcmF0aGVy\nIHRoYW4KICAgICAqICJDUkVBVEUgVEFCTEUiLCB3aGljaCBhbGxvd3MgZGlz\nay1iYXNlZCBkYXRhYmFzZSBvcGVyYXRpb25zLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBjYWNoZVRhYmxlcyA9IGZhbHNlOwoKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vbmVCdWZmZXIgPSBuZXcgU1FMQnVmZmVyKHRoaXMpLmFw\ncGVuZCgiMSIpOwoKICAgIHB1YmxpYyBIU1FMRGljdGlvbmFyeSgpIHsKICAg\nICAgICBwbGF0Zm9ybSA9ICJIU1FMIjsKICAgICAgICB2YWxpZGF0aW9uU1FM\nID0gIkNBTEwgMSI7CiAgICAgICAgY29uY2F0ZW5hdGVGdW5jdGlvbiA9ICJD\nT05DQVQoezB9LHsxfSkiOwogICAgICAgIGNsb3NlUG9vbFNRTCA9ICJTSFVU\nRE9XTiI7CgogICAgICAgIHN1cHBvcnRzQXV0b0Fzc2lnbiA9IHRydWU7CiAg\nICAgICAgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gIkNBTEwgSURFTlRJVFko\nKSI7CiAgICAgICAgYXV0b0Fzc2lnbkNsYXVzZSA9ICJJREVOVElUWSI7CiAg\nICAgICAgYXV0b0Fzc2lnblR5cGVOYW1lID0gIklOVEVHRVIiOwogICAgICAg\nIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gIlNFTEVDVCBORVhUIFZBTFVFIEZPUiB7\nMH0gRlJPTSIKICAgICAgICAgICAgKyAiIElORk9STUFUSU9OX1NDSEVNQS5T\nWVNURU1fU0VRVUVOQ0VTIjsKICAgICAgICBjcm9zc0pvaW5DbGF1c2UgPSAi\nSk9JTiI7CiAgICAgICAgcmVxdWlyZXNDb25kaXRpb25Gb3JDcm9zc0pvaW4g\nPSB0cnVlOwogICAgICAgIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkxFTkdU\nSCh7MH0pIjsKICAgICAgICB0cmltTGVhZGluZ0Z1bmN0aW9uID0gIkxUUklN\nKHswfSkiOwogICAgICAgIHRyaW1UcmFpbGluZ0Z1bmN0aW9uID0gIlJUUklN\nKHswfSkiOwogICAgICAgIHRyaW1Cb3RoRnVuY3Rpb24gPSAiTFRSSU0oUlRS\nSU0oezB9KSkiOwoKICAgICAgICAvLyBIU1FMIDEuOC4wIGRvZXMgc3VwcG9y\ndCBzY2hlbWEgbmFtZXMgaW4gdGhlIHRhYmxlICgic2NoZW1hLnRhYmxlIiks\nCiAgICAgICAgLy8gYnV0IGRvZXNuJ3Qgc3VwcG9ydCBpdCBmb3IgY29sdW1u\ncyByZWZlcmVuY2VzICgic2NoZW1hLnRhYmxlLmNvbHVtbiIpCiAgICAgICAg\ndXNlU2NoZW1hTmFtZSA9IGZhbHNlOwogICAgICAgIHN1cHBvcnRzU2VsZWN0\nRm9yVXBkYXRlID0gZmFsc2U7CiAgICAgICAgc3VwcG9ydHNTZWxlY3RTdGFy\ndEluZGV4ID0gdHJ1ZTsKICAgICAgICBzdXBwb3J0c1NlbGVjdEVuZEluZGV4\nID0gdHJ1ZTsKICAgICAgICByYW5nZVBvc2l0aW9uID0gUkFOR0VfUFJFX0RJ\nU1RJTkNUOwogICAgICAgIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9\nIGZhbHNlOwoKICAgICAgICB1c2VHZXRPYmplY3RGb3JCbG9icyA9IHRydWU7\nCiAgICAgICAgYmxvYlR5cGVOYW1lID0gIlZBUkJJTkFSWSI7CiAgICAgICAg\nZG91YmxlVHlwZU5hbWUgPSAiTlVNRVJJQyI7CgogICAgICAgIHN1cHBvcnRz\nTnVsbFRhYmxlRm9yR2V0UHJpbWFyeUtleXMgPSB0cnVlOwogICAgICAgIHN1\ncHBvcnRzTnVsbFRhYmxlRm9yR2V0SW5kZXhJbmZvID0gdHJ1ZTsKCiAgICAg\nICAgcmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyA9IHRydWU7CiAgICAg\nICAgcmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNvbnMgPSB0cnVlOwoKICAgICAg\nICByZXNlcnZlZFdvcmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0\ncmluZ1tdewogICAgICAgICAgICAiQkVGT1JFIiwgIkJJR0lOVCIsICJCSU5B\nUlkiLCAiQ0FDSEVEIiwgIkRBVEVUSU1FIiwgIkxJTUlUIiwKICAgICAgICAg\nICAgIkxPTkdWQVJCSU5BUlkiLCAiTE9OR1ZBUkNIQVIiLCAiT0JKRUNUIiwg\nIk9USEVSIiwKICAgICAgICAgICAgIlNBVkVQT0lOVCIsICJURU1QIiwgIlRF\nWFQiLCAiVFJJR0dFUiIsICJUSU5ZSU5UIiwKICAgICAgICAgICAgIlZBUkJJ\nTkFSWSIsICJWQVJDSEFSX0lHTk9SRUNBU0UiLAogICAgICAgIH0pKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBpbnQgZ2V0SkRCQ1R5cGUo\naW50IG1ldGFUeXBlQ29kZSwgYm9vbGVhbiBsb2IpIHsKICAgICAgICBpbnQg\ndHlwZSA9IHN1cGVyLmdldEpEQkNUeXBlKG1ldGFUeXBlQ29kZSwgbG9iKTsK\nICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5CSUdJTlQ6CiAgICAgICAgICAgICAgICBpZiAobWV0YVR5cGVDb2RlID09\nIEphdmFUeXBlcy5CSUdJTlRFR0VSKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBUeXBlcy5OVU1FUklDOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0eXBlOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIGludCBnZXRQcmVmZXJyZWRUeXBlKGludCB0eXBl\nKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHJldHVybiBUeXBlcy5WQVJD\nSEFSOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJMT0I6CiAgICAgICAgICAg\nICAgICByZXR1cm4gVHlwZXMuVkFSQklOQVJZOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFByZWZlcnJl\nZFR5cGUodHlwZSk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIFN0cmluZ1tdIGdldEFkZFByaW1hcnlLZXlTUUwoUHJpbWFy\neUtleSBwaykgewogICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BQ\ncmltYXJ5S2V5U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ1swXTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXRBZGRDb2x1bW5TUUwoQ29sdW1uIGNvbHVtbikgewog\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAg\nICAgICAgICAgICsgZ2V0RnVsbE5hbWUoY29sdW1uLmdldFRhYmxlKCksIGZh\nbHNlKQogICAgICAgICAgICArICIgQUREIENPTFVNTiAiICsgZ2V0RGVjbGFy\nZUNvbHVtblNRTChjb2x1bW4sIHRydWUpIH07CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFi\nbGUgdGFibGUpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWlsZGVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFICIp\nOwogICAgICAgIGlmIChjYWNoZVRhYmxlcykKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiQ0FDSEVEICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlRBQkxFICIp\nLmFwcGVuZChnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpKS5hcHBlbmQoIiAo\nIik7CgogICAgICAgIENvbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChpID4gMCkKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0\nRGVjbGFyZUNvbHVtblNRTChjb2xzW2ldLCBmYWxzZSkpOwogICAgICAgIH0K\nCiAgICAgICAgUHJpbWFyeUtleSBwayA9IHRhYmxlLmdldFByaW1hcnlLZXko\nKTsKICAgICAgICBTdHJpbmcgcGtTdHI7CiAgICAgICAgaWYgKHBrICE9IG51\nbGwpIHsKICAgICAgICAgICAgcGtTdHIgPSBnZXRQcmltYXJ5S2V5Q29uc3Ry\nYWludFNRTChwayk7CiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShwa1N0cikpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIp\nLmFwcGVuZChwa1N0cik7CiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1\nbnFzID0gdGFibGUuZ2V0VW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFT\ndHI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFp\nbnRTUUwodW5xc1tpXSk7CiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBwZW5kKHVu\ncVN0cik7CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkgfTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nUHJpbWFyeUtleUNvbnN0cmFpbnRTUUwoUHJpbWFyeUtleSBwaykgewogICAg\nICAgIENvbHVtbltdIGNvbHMgPSBway5nZXRDb2x1bW5zKCk7CiAgICAgICAg\naWYgKGNvbHMubGVuZ3RoID09IDEgJiYgY29sc1swXS5pc0F1dG9Bc3NpZ25l\nZCgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4g\nc3VwZXIuZ2V0UHJpbWFyeUtleUNvbnN0cmFpbnRTUUwocGspOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtSW5kZXgoU3RyaW5nIG5hbWUs\nIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIG5hbWUudG9VcHBlckNh\nc2UoKS5zdGFydHNXaXRoKCJTWVNfIik7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbUluZGV4KERCSWRlbnRpZmll\nciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIGlmIChEQklkZW50aWZp\nZXIuaXNOdWxsKG5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hbWUuZ2V0TmFtZSgpLnRvVXBw\nZXJDYXNlKCkuc3RhcnRzV2l0aCgiU1lTXyIpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRTZXF1ZW5jZXNTUUwoU3Ry\naW5nIHNjaGVtYU5hbWUsIFN0cmluZyBzZXF1ZW5jZU5hbWUpIHsKICAgICAg\nICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIFNFUVVFTkNFX1NDSEVNQSwgU0VR\nVUVOQ0VfTkFNRSBGUk9NICIpLgogICAgICAgICAgICBhcHBlbmQoIklORk9S\nTUFUSU9OX1NDSEVNQS5TWVNURU1fU0VRVUVOQ0VTIik7CiAgICAgICAgaWYg\nKHNjaGVtYU5hbWUgIT0gbnVsbCB8fCBzZXF1ZW5jZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIFdIRVJFICIpOwogICAgICAgIGlm\nIChzY2hlbWFOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiU0VRVUVOQ0VfU0NIRU1BID0gPyIpOwogICAgICAgICAgICBpZiAoc2Vx\ndWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VxdWVuY2VOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX05B\nTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJh\ndGlvbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNR\nTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91\ncCwgU1FMQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIs\nIGJvb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAg\nICAgIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UpIHsKICAgICAgICAvLyBoc3Fs\nIHJlcXVpcmVzIG9yZGVyaW5nIHdoZW4gbGltaXQgaXMgdXNlZAogICAgICAg\nIGlmICgoc3RhcnQgIT0gMCB8fCBlbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAg\nICAgICAgICAgICYmIChvcmRlciA9PSBudWxsIHx8IG9yZGVyLmlzRW1wdHko\nKSkpCiAgICAgICAgICAgIG9yZGVyID0gX29uZUJ1ZmZlcjsKICAgICAgICBy\nZXR1cm4gc3VwZXIudG9PcGVyYXRpb24ob3AsIHNlbGVjdHMsIGZyb20sIHdo\nZXJlLCBncm91cCwgaGF2aW5nLAogICAgICAgICAgICBvcmRlciwgZGlzdGlu\nY3QsIHN0YXJ0LCBlbmQsIGZvclVwZGF0ZUNsYXVzZSk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1ucyhEYXRh\nYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0\ncmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBTdHJpbmcgY29s\ndW1uTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIENvbHVtbltdIGNvbHMgPSBzdXBlci5nZXRD\nb2x1bW5zKG1ldGEsIGNhdGFsb2csIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwK\nICAgICAgICAgICAgY29sdW1uTmFtZSwgY29ubik7CgogICAgICAgIGZvciAo\naW50IGkgPSAwOyBjb2xzICE9IG51bGwgJiYgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIGlmICgiQk9PTEVBTiIuZXF1YWxzSWdub3JlQ2Fz\nZShjb2xzW2ldLmdldFR5cGVJZGVudGlmaWVyKCkuZ2V0TmFtZSgpKSkKICAg\nICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5CSVQpOwogICAg\nICAgIHJldHVybiBjb2xzOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgc2V0RG91YmxlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBkb3VibGUgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gSFNRTCBoYXMg\nYSBidWcgd2hlcmUgaXQgY2Fubm90IHN0b3JlIGEgZG91YmxlIGlmIGl0IGlz\nCiAgICAgICAgLy8gZXhhY3RseSB0aGUgc2FtZSBhcyBMb25nLk1BWF9WQUxV\nRSBvciBNSU5fVkFMVUUKICAgICAgICBpZiAodmFsID09IExvbmcuTUFYX1ZB\nTFVFIHx8IHZhbCA9PSBMb25nLk1JTl9WQUxVRSkgewogICAgICAgICAgICBz\ndG1udC5zZXRMb25nKGlkeCwgKGxvbmcpIHZhbCk7CiAgICAgICAgfSBlbHNl\nICB7CiAgICAgICAgICAgIHN1cGVyLnNldERvdWJsZShzdG1udCwgaWR4LCB2\nYWwsIGNvbCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgQmlnRGVjaW1hbCB2YWwsCiAgICAgICAgQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAv\nLyBoc3FsIGNhbid0IGNvbXBhcmUgYSBCaWdEZWNpbWFsIGVxdWFsIHRvIGFu\neSBvdGhlciB0eXBlLCBzbyB0cnkKICAgICAgICAvLyB0byBzZXQgdHlwZSBi\nYXNlZCBvbiBjb2x1bW4KICAgICAgICBpbnQgdHlwZSA9ICh2YWwgPT0gbnVs\nbCB8fCBjb2wgPT0gbnVsbCkgPyBKYXZhVHlwZXMuQklHREVDSU1BTAogICAg\nICAgICAgICA6IGNvbC5nZXRKYXZhVHlwZSgpOwogICAgICAgIHN3aXRjaCAo\ndHlwZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAg\nICAgICAgICBzZXREb3VibGUoc3RtbnQsIGlkeCwgdmFsLmRvdWJsZVZhbHVl\nKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgICAgIHNldERvdWJsZShzdG1u\ndCwgaWR4LCB2YWwuZmxvYXRWYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIHZhbCwgY29sKTsK\nICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQg\ndm9pZCBhcHBlbmRTZWxlY3RSYW5nZShTUUxCdWZmZXIgYnVmLCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICBib29sZWFuIHN1YnNlbGVjdCkgewog\nICAgICAgIC8vIEhTUUwgZG9lc24ndCBwYXJhbWV0ZXJzIGluIHJhbmdlCiAg\nICAgICAgYnVmLmFwcGVuZCgiIExJTUlUICIpLmFwcGVuZChTdHJpbmcudmFs\ndWVPZihzdGFydCkpLmFwcGVuZCgiICIpOwogICAgICAgIGlmIChlbmQgPT0g\nTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoU3RyaW5n\nLnZhbHVlT2YoMCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFw\ncGVuZChTdHJpbmcudmFsdWVPZihlbmQgLSBzdGFydCkpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgaW5kZXhPZihTUUxCdWZmZXIg\nYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVlIGZpbmQsCiAgICAg\nICAgRmlsdGVyVmFsdWUgc3RhcnQpIHsKICAgICAgICBidWYuYXBwZW5kKCIo\nTE9DQVRFKCIpOwogICAgICAgIGZpbmQuYXBwZW5kVG8oYnVmKTsKICAgICAg\nICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgIHN0ci5hcHBlbmRUbyhidWYp\nOwogICAgICAgIGlmIChzdGFydCAhPSBudWxsKSB7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiwgKCIpOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhi\ndWYpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgKyAxKSIpOwogICAgICAg\nIH0KICAgICAgICBidWYuYXBwZW5kKCIpIC0gMSkiKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UGxhY2Vob2xkZXJWYWx1\nZVN0cmluZyhDb2x1bW4gY29sKSB7CiAgICAgICAgU3RyaW5nIHR5cGUgPSBn\nZXRUeXBlTmFtZShjb2wuZ2V0VHlwZSgpKTsKICAgICAgICBpbnQgaWR4ID0g\ndHlwZS5pbmRleE9mKCJ7MH0iKTsKICAgICAgICBpZiAoaWR4ICE9IC0xKSB7\nCiAgICAgICAgICAgIFN0cmluZyBwcmUgPSB0eXBlLnN1YnN0cmluZygwLCBp\nZHgpOwogICAgICAgICAgICBpZiAodHlwZS5sZW5ndGgoKSA+IGlkeCArIDMp\nCiAgICAgICAgICAgICAgICB0eXBlID0gcHJlICsgdHlwZS5zdWJzdHJpbmco\naWR4ICsgMyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHR5\ncGUgPSBwcmU7CiAgICAgICAgfQogICAgICAgIHJldHVybiAiTlVMTCBBUyAi\nICsgdHlwZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBPcGVu\nSlBBRXhjZXB0aW9uIG5ld1N0b3JlRXhjZXB0aW9uKFN0cmluZyBtc2csIFNR\nTEV4Y2VwdGlvbltdIGNhdXNlcywKICAgICAgICBPYmplY3QgZmFpbGVkKSB7\nCiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBrZSA9IHN1cGVyLm5ld1N0b3Jl\nRXhjZXB0aW9uKG1zZywgY2F1c2VzLCBmYWlsZWQpOwogICAgICAgIGlmIChr\nZSBpbnN0YW5jZW9mIFJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9uCiAg\nICAgICAgICAgICYmIGNhdXNlc1swXS5nZXRFcnJvckNvZGUoKSA9PSAtVHJh\nY2UuVklPTEFUSU9OX09GX1VOSVFVRV9JTkRFWCkgewogICAgICAgICAgICAo\nKFJlZmVyZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9uKSBrZSkuc2V0SW50ZWdy\naXR5VmlvbGF0aW9uCiAgICAgICAgICAgICAgICAoUmVmZXJlbnRpYWxJbnRl\nZ3JpdHlFeGNlcHRpb24uSVZfVU5JUVVFKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGtlOwogICAgfQp9Cg==\n","encoding":"base64"}

