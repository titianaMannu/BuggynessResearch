{"sha":"248724cf6911fca644aff5233342bd715384eea9","node_id":"MDQ6QmxvYjIwNjM2NDoyNDg3MjRjZjY5MTFmY2E2NDRhZmY1MjMzMzQyYmQ3MTUzODRlZWE5","size":51276,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/248724cf6911fca644aff5233342bd715384eea9","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRp\nZmllci5EQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJW\nYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2\nYVNRTFR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleS5GS01hcEtleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nRGF0YWJh\nc2VNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRi\nYy5EZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKaW1wb3J0\nIHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIERpY3Rpb25hcnkgZm9yIE9y\nYWNsZS4KICovCnB1YmxpYyBjbGFzcyBPcmFjbGVEaWN0aW9uYXJ5CiAgICBl\neHRlbmRzIERCRGljdGlvbmFyeSB7CgogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgU0VMRUNUX0hJTlQgPSAib3BlbmpwYS5oaW50Lk9yYWNsZVNl\nbGVjdEhpbnQiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVkVO\nRE9SX09SQUNMRSA9ICJvcmFjbGUiOwoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBCRUhBVkVfT1RIRVIgPSAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEJFSEFWRV9PUkFDTEUgPSAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEJFSEFWRV9EQVRBRElSRUNUMzEgPSAyOwoKICAgIHBy\naXZhdGUgc3RhdGljIEJsb2IgRU1QVFlfQkxPQiA9IG51bGw7CiAgICBwcml2\nYXRlIHN0YXRpYyBDbG9iIEVNUFRZX0NMT0IgPSBudWxsOwoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZv\nclBhY2thZ2UKICAgICAgICAoT3JhY2xlRGljdGlvbmFyeS5jbGFzcyk7Cgog\nICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0aGVuIHNpbXVsYXRlIGF1dG8tYXNz\naWduZWQgdmFsdWVzIGluIE9yYWNsZSBieQogICAgICogdXNpbmcgYSB0cmln\nZ2VyIHRoYXQgaW5zZXJ0cyBhIHNlcXVlbmNlIHZhbHVlIGludG8gdGhlCiAg\nICAgKiBwcmltYXJ5IGtleSB2YWx1ZSB3aGVuIGEgcm93IGlzIGluc2VydGVk\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB1c2VUcmlnZ2Vyc0ZvckF1\ndG9Bc3NpZ24gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSBnbG9iYWwg\nc2VxdWVuY2UgbmFtZSB0byB1c2UgZm9yIGF1dG9hc3NpZ24gc2ltdWxhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBhdXRvQXNzaWduU2VxdWVu\nY2VOYW1lID0gbnVsbDsKCiAgICAvKioKICAgICAqIEZsYWcgdG8gdXNlIE9w\nZW5KUEEgMC4zIHN0eWxlIG5hbWluZyBmb3IgYXV0byBhc3NpZ24gc2VxdWVu\nY2UgbmFtZSBhbmQKICAgICAqIHRyaWdnZXIgbmFtZSBmb3IgYmFja3dhcmRz\nIGNvbXBhdGliaWxpdHkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIG9w\nZW5qcGEzR2VuZXJhdGVkS2V5TmFtZXMgPSBmYWxzZTsKCiAgICAvKioKICAg\nICAqIElmIHRydWUsIHRoZW4gT3BlbkpQQSB3aWxsIGF0dGVtcHQgdG8gdXNl\nIHRoZSBzcGVjaWFsCiAgICAgKiBPcmFjbGVQcmVwYXJlZFN0YXRlbWVudC5z\nZXRGb3JtT2ZVc2UgbWV0aG9kIHRvCiAgICAgKiBjb25maWd1cmUgc3RhdGVt\nZW50cyB0aGF0IGl0IGRldGVjdHMgYXJlIG9wZXJhdGluZyBvbiB1bmljb2Rl\nIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdXNlU2V0Rm9y\nbU9mVXNlRm9yVW5pY29kZSA9IHRydWU7CgogICAgLy8gc29tZSBvcmFjbGUg\nZHJpdmVycyBoYXZlIHByb2JsZW1zIHdpdGggc2VsZWN0IGZvciB1cGRhdGU7\nIHdhcm4gdGhlCiAgICAvLyBmaXJzdCB0aW1lIGxvY2tpbmcgaXMgYXR0ZW1w\ndGVkCiAgICBwcml2YXRlIGJvb2xlYW4gX2NoZWNrZWRVcGRhdGVCdWcgPSBm\nYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfd2FybmVkQ2hhckNvbHVtbiA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF93YXJuZWROY2hhckNvbHVt\nbiA9IGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX2RyaXZlckJlaGF2aW9yID0g\nLTE7CgogICAgLy8gY2FjaGUgbG9iIG1ldGhvZHMKICAgIHByaXZhdGUgTWV0\naG9kIF9wdXRCeXRlcyA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCBfcHV0\nU3RyaW5nID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9wdXRDaGFycyA9\nIG51bGw7CiAgICAKICAgIC8vIGJhdGNoIGxpbWl0CiAgICBwcml2YXRlIGlu\ndCBkZWZhdWx0QmF0Y2hMaW1pdCA9IDEwMDsKCiAgICBwdWJsaWMgT3JhY2xl\nRGljdGlvbmFyeSgpIHsKICAgICAgICBwbGF0Zm9ybSA9ICJPcmFjbGUiOwog\nICAgICAgIHZhbGlkYXRpb25TUUwgPSAiU0VMRUNUIFNZU0RBVEUgRlJPTSBE\nVUFMIjsKICAgICAgICBuZXh0U2VxdWVuY2VRdWVyeSA9ICJTRUxFQ1QgezB9\nLk5FWFRWQUwgRlJPTSBEVUFMIjsKICAgICAgICBzdHJpbmdMZW5ndGhGdW5j\ndGlvbiA9ICJMRU5HVEgoezB9KSI7CiAgICAgICAgam9pblN5bnRheCA9IFNZ\nTlRBWF9EQVRBQkFTRTsKICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGggPSAz\nMDsKICAgICAgICBtYXhDb2x1bW5OYW1lTGVuZ3RoID0gMzA7CiAgICAgICAg\nbWF4SW5kZXhOYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4Q29uc3RyYWlu\ndE5hbWVMZW5ndGggPSAzMDsKICAgICAgICBtYXhFbWJlZGRlZEJsb2JTaXpl\nID0gNDAwMDsKICAgICAgICBtYXhFbWJlZGRlZENsb2JTaXplID0gNDAwMDsK\nICAgICAgICBpbkNsYXVzZUxpbWl0ID0gMTAwMDsKCiAgICAgICAgc3VwcG9y\ndHNEZWZlcnJlZENvbnN0cmFpbnRzID0gdHJ1ZTsKICAgICAgICBzdXBwb3J0\nc0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgPSBmYWxzZTsKICAgICAgICBz\ndXBwb3J0c1NlbGVjdFN0YXJ0SW5kZXggPSB0cnVlOwogICAgICAgIHN1cHBv\ncnRzU2VsZWN0RW5kSW5kZXggPSB0cnVlOwoKICAgICAgICBzeXN0ZW1TY2hl\nbWFTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAg\nICAgICAgICAiQ1RYU1lTIiwgIk1EU1lTIiwgIlNZUyIsICJTWVNURU0iLCAi\nV0tTWVMiLCAiV01TWVMiLCAiWERCIiwKICAgICAgICB9KSk7CgogICAgICAg\nIHN1cHBvcnRzWE1MQ29sdW1uID0gdHJ1ZTsKICAgICAgICB4bWxUeXBlTmFt\nZSA9ICJYTUxUeXBlIjsKICAgICAgICBiaWdpbnRUeXBlTmFtZSA9ICJOVU1C\nRVJ7MH0iOwogICAgICAgIGJpdFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAg\nICAgICAgZGVjaW1hbFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAg\nZG91YmxlVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBpbnRlZ2Vy\nVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBudW1lcmljVHlwZU5h\nbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBzbWFsbGludFR5cGVOYW1lID0g\nIk5VTUJFUnswfSI7CiAgICAgICAgdGlueWludFR5cGVOYW1lID0gIk5VTUJF\nUnswfSI7CiAgICAgICAgbG9uZ1ZhcmNoYXJUeXBlTmFtZSA9ICJMT05HIjsK\nICAgICAgICBiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICB2YXJi\naW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICBsb25nVmFyYmluYXJ5\nVHlwZU5hbWUgPSAiQkxPQiI7CiAgICAgICAgdGltZVR5cGVOYW1lID0gIkRB\nVEUiOwogICAgICAgIHZhcmNoYXJUeXBlTmFtZSA9ICJWQVJDSEFSMnswfSI7\nCiAgICAgICAgZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5h\nc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAgICAiTE9ORyBSQVciLCAi\nUkFXIiwgIkxPTkciLCAiUkVGIiwKICAgICAgICB9KSk7CiAgICAgICAgcmVz\nZXJ2ZWRXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdb\nXXsKICAgICAgICAgICAgIkFDQ0VTUyIsICJBVURJVCIsICJDTFVTVEVSIiwg\nIkNPTU1FTlQiLCAiQ09NUFJFU1MiLCAiRVhDTFVTSVZFIiwKICAgICAgICAg\nICAgIkZJTEUiLCAiSURFTlRJRklFRCIsICJJTkNSRU1FTlQiLCAiSU5ERVgi\nLCAiSU5JVElBTCIsICJMT0NLIiwKICAgICAgICAgICAgIkxPTkciLCAiTUFY\nRVhURU5UUyIsICJNSU5VUyIsICJNT0RFIiwgIk5PQVVESVQiLCAiTk9DT01Q\nUkVTUyIsCiAgICAgICAgICAgICJOT1dBSVQiLCAiT0ZGTElORSIsICJPTkxJ\nTkUiLCAiUENURlJFRSIsICJST1ciLAogICAgICAgIH0pKTsKCiAgICAgICAg\nLy8gcmVzZXJ2ZWRXb3JkU2V0IHN1YnNldCB0aGF0IENBTk5PVCBiZSB1c2Vk\nIGFzIHZhbGlkIGNvbHVtbiBuYW1lcwogICAgICAgIC8vIChpLmUuLCB3aXRo\nb3V0IHN1cnJvdW5kaW5nIHRoZW0gd2l0aCBkb3VibGUtcXVvdGVzKQogICAg\nICAgIGludmFsaWRDb2x1bW5Xb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0\nKG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkFDQ0VTUyIsICJBREQiLCAi\nQUxMIiwgIkFMVEVSIiwgIkFORCIsICJBTlkiLCAiQVMiLCAiQVNDIiwgIkFV\nRElUIiwKICAgICAgICAgICAgIkJFVFdFRU4iLCAiQlkiLCAiQ0hBUiIsICJD\nSEVDSyIsICJDTFVTVEVSIiwgIkNPTFVNTiIsICJDT01NRU5UIiwKICAgICAg\nICAgICAgIkNPTVBSRVNTIiwgIkNPTk5FQ1QiLCAiQ1JFQVRFIiwgIkNVUlJF\nTlQiLCAiREFURSIsICJERUNJTUFMIiwKICAgICAgICAgICAgIkRFRkFVTFQi\nLCAiREVMRVRFIiwgIkRFU0MiLCAiRElTVElOQ1QiLCAiRFJPUCIsICJFTFNF\nIiwgIkVORC1FWEVDIiwKICAgICAgICAgICAgIkVYQ0xVU0lWRSIsICJFWElT\nVFMiLCAiRklMRSIsICJGTE9BVCIsICJGT1IiLCAiRlJPTSIsICJHUkFOVCIs\nCiAgICAgICAgICAgICJHUk9VUCIsICJIQVZJTkciLCAiSURFTlRJRklFRCIs\nICJJTU1FRElBVEUiLCAiSU4iLCAiSU5DUkVNRU5UIiwKICAgICAgICAgICAg\nIklOREVYIiwgIklOSVRJQUwiLCAiSU5TRVJUIiwgIklOVEVHRVIiLCAiSU5U\nRVJTRUNUIiwgIklOVE8iLAogICAgICAgICAgICAiSVMiLCAiTEVWRUwiLCAi\nTElLRSIsICJMT0NLIiwgIkxPTkciLCAiTUFYRVhURU5UUyIsICJNSU5VUyIs\nCiAgICAgICAgICAgICJNT0RFIiwgIk5PQVVESVQiLCAiTk9DT01QUkVTUyIs\nICJOT1QiLCAiTk9XQUlUIiwgIk5VTEwiLCAiTlVNQkVSIiwKICAgICAgICAg\nICAgIk9GIiwgIk9GRkxJTkUiLCAiT04iLCAiT05MSU5FIiwgIk9QVElPTiIs\nICJPUiIsICJPUkRFUiIsICJQQ1RGUkVFIiwKICAgICAgICAgICAgIlBSSU9S\nIiwgIlBSSVZJTEVHRVMiLCAiUFVCTElDIiwgIlJFVk9LRSIsICJST1ciLCAi\nUk9XUyIsICJTRUxFQ1QiLAogICAgICAgICAgICAiU0VTU0lPTiIsICJTRVQi\nLCAiU0laRSIsICJTTUFMTElOVCIsICJUQUJMRSIsICJUSEVOIiwgIlRPIiwK\nICAgICAgICAgICAgIlVOSU9OIiwgIlVOSVFVRSIsICJVUERBVEUiLCAiVVNF\nUiIsICJWQUxVRVMiLCAiVkFSQ0hBUiIsICJWSUVXIiwKICAgICAgICAgICAg\nIldIRU5FVkVSIiwgIldIRVJFIiwgIldJVEgiLAogICAgICAgIH0pKTsKCiAg\nICAgICAgc3Vic3RyaW5nRnVuY3Rpb25OYW1lID0gIlNVQlNUUiI7CiAgICAg\nICAgc3VwZXIuc2V0QmF0Y2hMaW1pdChkZWZhdWx0QmF0Y2hMaW1pdCk7CiAg\nICAgICAgc2VsZWN0V29yZFNldC5hZGQoIldJVEgiKTsKICAgICAgICByZXBv\ncnRzU3VjY2Vzc05vSW5mb09uQmF0Y2hVcGRhdGVzID0gdHJ1ZTsKICAgICAg\nICByZXF1aXJlc1NlYXJjaFN0cmluZ0VzY2FwZUZvckxpa2UgPSBmYWxzZTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGVuZENvbmZp\nZ3VyYXRpb24oKSB7CiAgICAgICAgc3VwZXIuZW5kQ29uZmlndXJhdGlvbigp\nOwogICAgICAgIGlmICh1c2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAg\nICAgICAgIHN1cHBvcnRzQXV0b0Fzc2lnbiA9IHRydWU7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjb25uZWN0ZWRDb25maWd1cmF0\naW9uKENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdXBlci5jb25uZWN0ZWRDb25maWd1cmF0aW9uKGNv\nbm4pOwogICAgICAgIGlmIChkcml2ZXJWZW5kb3IgPT0gbnVsbCkgewogICAg\nICAgICAgICBEYXRhYmFzZU1ldGFEYXRhIG1ldGEgPSBjb25uLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgICAgIFN0cmluZyB1cmwgPSAobWV0YS5nZXRVUkwo\nKSA9PSBudWxsKSA/ICIiIDogbWV0YS5nZXRVUkwoKTsKICAgICAgICAgICAg\nU3RyaW5nIGRyaXZlck5hbWUgPSBtZXRhLmdldERyaXZlck5hbWUoKTsKICAg\nICAgICAgICAgU3RyaW5nIG1ldGFkYXRhQ2xhc3NOYW1lOwogICAgICAgICAg\nICBpZiAobWV0YSBpbnN0YW5jZW9mIERlbGVnYXRpbmdEYXRhYmFzZU1ldGFE\nYXRhKQogICAgICAgICAgICAgICAgbWV0YWRhdGFDbGFzc05hbWUgPSAoKERl\nbGVnYXRpbmdEYXRhYmFzZU1ldGFEYXRhKSBtZXRhKS4KICAgICAgICAgICAg\nICAgICAgICBnZXRJbm5lcm1vc3REZWxlZ2F0ZSgpLmdldENsYXNzKCkuZ2V0\nTmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtZXRh\nZGF0YUNsYXNzTmFtZSA9IG1ldGEuZ2V0Q2xhc3MoKS5nZXROYW1lKCk7Cgog\nICAgICAgICAgICAvLyBjaGVjayBib3RoIHRoZSBkcml2ZXIgY2xhc3MgbmFt\nZSBhbmQgdGhlIFVSTCBmb3Iga25vd24gcGF0dGVybnMKICAgICAgICAgICAg\naWYgKG1ldGFkYXRhQ2xhc3NOYW1lLnN0YXJ0c1dpdGgoIm9yYWNsZS4iKQog\nICAgICAgICAgICAgICAgfHwgdXJsLmluZGV4T2YoImpkYmM6b3JhY2xlOiIp\nICE9IC0xCiAgICAgICAgICAgICAgICB8fCAiT3JhY2xlIEpEQkMgZHJpdmVy\nIi5lcXVhbHMoZHJpdmVyTmFtZSkpIHsKICAgICAgICAgICAgICAgIGRyaXZl\nclZlbmRvciA9IFZFTkRPUl9PUkFDTEUgKyBtZXRhLmdldERyaXZlck1ham9y\nVmVyc2lvbigpCiAgICAgICAgICAgICAgICAgICAgKyBtZXRhLmdldERyaXZl\nck1pbm9yVmVyc2lvbigpOwoKICAgICAgICAgICAgICAgIFN0cmluZyBwcm9k\ndWN0VmVyc2lvbiA9IG1ldGEuZ2V0RGF0YWJhc2VQcm9kdWN0VmVyc2lvbigp\nCiAgICAgICAgICAgICAgICAgICAgLnNwbGl0KCJSZWxlYXNlICIsMClbMV0u\nc3BsaXQoIlxcLiIsMClbMF07CiAgICAgICAgICAgICAgICBpbnQgcmVsZWFz\nZSA9IEludGVnZXIucGFyc2VJbnQocHJvZHVjdFZlcnNpb24pOwogICAgICAg\nICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyB3YXJuIHNxbDkyCiAgICAg\nICAgICAgICAgICBpZiAocmVsZWFzZSA8PSA4KSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGpvaW5TeW50YXggPT0gU1lOVEFYX1NRTDkyICYmIGxvZy5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KCJvcmFjbGUtc3ludGF4IikpOwogICAgICAgICAgICAg\nICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfREFUQUJBU0U7CiAgICAgICAg\nICAgICAgICAgICAgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOyAvLyBhZGRlZCBv\ncmFjbGUgOQogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcFR5cGVOYW1l\nID0gIkRBVEUiOyAvLyBhZGRlZCBvcmFjbGUgOQogICAgICAgICAgICAgICAg\nICAgIHN1cHBvcnRzWE1MQ29sdW1uID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgLy8gc2VsZWN0IG9mIGFuIHhtbCBj\nb2x1bW4gcmVxdWlyZXMgIi5nZXRTdHJpbmdWYWwoKSIKICAgICAgICAgICAg\nICAgICAgICAvLyBzdWZmaXguIGVnLiB0MC54bWxjb2wuZ2V0U3RyaW5nVmFs\nKCkKICAgICAgICAgICAgICAgICAgICBnZXRTdHJpbmdWYWwgPSAiLmdldFN0\ncmluZ1ZhbCgpIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRhZGF0YUNs\nYXNzTmFtZS5zdGFydHNXaXRoKCJjb20uZGR0ZWsuIikKICAgICAgICAgICAg\nICAgIHx8IHVybC5pbmRleE9mKCJqZGJjOmRhdGFkaXJlY3Q6b3JhY2xlOiIp\nICE9IC0xCiAgICAgICAgICAgICAgICB8fCAiT3JhY2xlIi5lcXVhbHMoZHJp\ndmVyTmFtZSkpIHsKICAgICAgICAgICAgICAgIGRyaXZlclZlbmRvciA9IFZF\nTkRPUl9EQVRBRElSRUNUICsgbWV0YS5nZXREcml2ZXJNYWpvclZlcnNpb24o\nKQogICAgICAgICAgICAgICAgICAgICsgbWV0YS5nZXREcml2ZXJNaW5vclZl\ncnNpb24oKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBk\ncml2ZXJWZW5kb3IgPSBWRU5ET1JfT1RIRVI7CiAgICAgICAgfQogICAgICAg\nIGNhY2hlRHJpdmVyQmVoYXZpb3IoZHJpdmVyVmVuZG9yKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENhY2hlIGNvbnN0YW50IGZvciBkcml2ZXJzIHdpdGgg\nYmVoYXZpb3JzIHdlIGhhdmUgdG8gZGVhbCB3aXRoLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgY2FjaGVEcml2ZXJCZWhhdmlvcihTdHJpbmcgZHJpdmVy\nVmVuZG9yKSB7CiAgICAgICAgaWYgKF9kcml2ZXJCZWhhdmlvciAhPSAtMSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBkcml2ZXJWZW5kb3IgPSBk\ncml2ZXJWZW5kb3IudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAoZHJpdmVy\nVmVuZG9yLnN0YXJ0c1dpdGgoVkVORE9SX09SQUNMRSkpCiAgICAgICAgICAg\nIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9PUkFDTEU7CiAgICAgICAgZWxz\nZSBpZiAoZHJpdmVyVmVuZG9yLmVxdWFscyhWRU5ET1JfREFUQURJUkVDVCAr\nICIzMCIpCiAgICAgICAgICAgIHx8IGRyaXZlclZlbmRvci5lcXVhbHMoVkVO\nRE9SX0RBVEFESVJFQ1QgKyAiMzEiKSkKICAgICAgICAgICAgX2RyaXZlckJl\naGF2aW9yID0gQkVIQVZFX0RBVEFESVJFQ1QzMTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9PVEhFUjsKICAg\nIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0IHRoZSBkcml2ZXIgdmVu\nZG9yIGhhcyBiZWVuIHNldCwgYW5kIGlmIG5vdCwgc2V0IGl0IG5vdy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgZW5zdXJlRHJpdmVyVmVuZG9yKCkgewog\nICAgICAgIGlmIChkcml2ZXJWZW5kb3IgIT0gbnVsbCkgewogICAgICAgICAg\nICBjYWNoZURyaXZlckJlaGF2aW9yKGRyaXZlclZlbmRvcik7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChsb2cuaXNJbmZv\nRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgib3Jh\nY2xlLWNvbm5lY3RpbmctZm9yLWRyaXZlciIpKTsKICAgICAgICBDb25uZWN0\naW9uIGNvbm4gPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNv\nbm4gPSBjb25mLmdldERhdGFTb3VyY2UyKG51bGwpLmdldENvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgY29ubmVjdGVkQ29uZmlndXJhdGlvbihjb25uKTsK\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgdGhpcyk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGNvbm4gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nY29ubi5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNM\nb2NraW5nKFNlbGVjdCBzZWwpIHsKICAgICAgICBpZiAoIXN1cGVyLnN1cHBv\ncnRzTG9ja2luZyhzZWwpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgcmV0dXJuICFyZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKHNlbC5n\nZXRTdGFydEluZGV4KCksCiAgICAgICAgICAgIHNlbC5nZXRFbmRJbmRleCgp\nLCBzZWwuaXNEaXN0aW5jdCgpLCBzZWwuZ2V0T3JkZXJpbmcoKSk7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNl\nbGVjdHMoU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJz\nLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gaWYg\ncmFuZ2UgZG9lc24ndCByZXF1aXJlIGEgc3Vic2VsZWN0IGNhbiB1c2Ugc3Vw\nZXIKICAgICAgICBpZiAoIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc2Vs\nLmdldFN0YXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVuZEluZGV4\nKCksIHNlbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygpKSkKICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNlbGVjdHMoc2VsLCBkaXN0aW5j\ndElkZW50aWZpZXJzLCBmb3JVcGRhdGUpOwoKICAgICAgICAvLyBpZiB0aGVy\nZSBhcmUgbm8gam9pbnMgaW52b2x2ZWQgb3Igd2UncmUgdXNpbmcgYSBmcm9t\nIHNlbGVjdCBzbwogICAgICAgIC8vIHRoYXQgYWxsIGNvbHMgYWxyZWFkeSBo\nYXZlIHVuaXF1ZSBhbGlhc2VzLCBjYW4gdXNlIHN1cGVyCiAgICAgICAgaWYg\nKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCB8fCBzZWwuZ2V0VGFibGVB\nbGlhc2VzKCkuc2l6ZSgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLmdldFNlbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50aWZpZXJzLCBmb3JVcGRh\ndGUpOwoKICAgICAgICAvLyBzaW5jZSBub25lIG9mIHRoZSBjb25kaXRpb25z\nIGFib3ZlIHdlcmUgbWV0LCB3ZSdyZSBkZWFsaW5nIHdpdGgKICAgICAgICAv\nLyBhIHNlbGVjdCB0aGF0IHVzZXMgam9pbnMgYW5kIHJlcXVpcmVzIHN1YnNl\nbGVjdHMgdG8gc2VsZWN0IHRoZQogICAgICAgIC8vIHByb3BlciByYW5nZTsg\nYWxpYXMgYWxsIGNvbHVtbiB2YWx1ZXMgc28gdGhhdCB0aGV5IGFyZSB1bmlx\ndWUgd2l0aGluCiAgICAgICAgLy8gdGhlIHN1YnNlbGVjdAogICAgICAgIFNR\nTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAg\nICAgIExpc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVudGlm\naWVycykKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlmaWVy\nQWxpYXNlcygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNlcyA9\nIHNlbC5nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBhbGlh\nczsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGkrKykg\newogICAgICAgICAgICBhbGlhcyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nIGlmIChhbGlhcyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAg\nICAgIHNlbGVjdFNRTC5hcHBlbmQoKFNRTEJ1ZmZlcikgYWxpYXMpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5k\nKGFsaWFzLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBzZWxlY3RTUUwuYXBw\nZW5kKCIgQVMgYyIpLmFwcGVuZChTdHJpbmcudmFsdWVPZihpKSk7CiAgICAg\nICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHNlbGVjdFNRTDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBi\nb29sZWFuIGNhbk91dGVySm9pbihpbnQgc3ludGF4LCBGb3JlaWduS2V5IGZr\nKSB7CiAgICAgICAgaWYgKCFzdXBlci5jYW5PdXRlckpvaW4oc3ludGF4LCBm\naykpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoZmsg\nIT0gbnVsbCAmJiBzeW50YXggPT0gU1lOVEFYX0RBVEFCQVNFKSB7CiAgICAg\nICAgICAgIGlmIChmay5nZXRDb25zdGFudHMoKS5sZW5ndGggPiAwKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoZmsu\nZ2V0UHJpbWFyeUtleUNvbnN0YW50cygpLmxlbmd0aCA+IDApCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFNRTEJ1\nZmZlciB0b05hdGl2ZUpvaW4oSm9pbiBqb2luKSB7CiAgICAgICAgaWYgKGpv\naW4uZ2V0VHlwZSgpICE9IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAg\ncmV0dXJuIHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pOwoKICAgICAgICBGb3Jl\naWduS2V5IGZrID0gam9pbi5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYg\nKGZrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBib29sZWFuIGludmVyc2UgPSBqb2luLmlzRm9yZWlnbktleUludmVyc2Vk\nKCk7CiAgICAgICAgQ29sdW1uW10gZnJvbSA9IChpbnZlcnNlKSA/IGZrLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG8gPSAoaW52ZXJzZSkgPyBmay5n\nZXRDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5Q29s\ndW1ucygpOwoKICAgICAgICAvLyBkbyBjb2x1bW4gam9pbnMKICAgICAgICBT\nUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBp\nbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJv\nbS5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICBpZiAoY291\nbnQgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsK\nICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgpKS5hcHBl\nbmQoIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiA9ICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxp\nYXMyKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0b1tpXSk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIigrKSIpOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hl\nY2sgY29uc3RhbnQgam9pbnMKICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRD\nb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJvcmFjbGUtY29uc3RhbnQiLAogICAg\nICAgICAgICAgICAgam9pbi5nZXRUYWJsZTEoKSwgam9pbi5nZXRUYWJsZTIo\nKSkpLnNldEZhdGFsKHRydWUpOwoKICAgICAgICBpZiAoZmsuZ2V0Q29uc3Rh\nbnRQcmltYXJ5S2V5Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdldCgib3JhY2xlLWNv\nbnN0YW50IiwKICAgICAgICAgICAgICAgIGpvaW4uZ2V0VGFibGUxKCksIGpv\naW4uZ2V0VGFibGUyKCkpKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICByZXR1\ncm4gYnVmOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIFNR\nTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0LCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciB0YWJsZXMs\nIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNR\nTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29s\nZWFuIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwg\nbG9uZyBlbmQsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QsIFNlbGVjdCBz\nZWwpIHsKICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0LCBmZXRjaCwg\ndGFibGVzLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAg\nICAgIGRpc3RpbmN0LCBmb3JVcGRhdGUsIHN0YXJ0LCBlbmQsIHNlbCk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIHRv\nU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3QsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsCiAgICAgICAgU1FMQnVmZmVyIHRhYmxlcywgU1FMQnVmZmVy\nIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVmZmVyIGhh\ndmluZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4gZGlzdGlu\nY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwK\nICAgICAgICBTZWxlY3Qgc2VsKSB7CiAgICAgICAgaWYgKCFfY2hlY2tlZFVw\nZGF0ZUJ1ZykgewogICAgICAgICAgICBlbnN1cmVEcml2ZXJWZW5kb3IoKTsK\nICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBfZHJpdmVyQmVoYXZpb3Ig\nPT0gQkVIQVZFX0RBVEFESVJFQ1QzMSkKICAgICAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KCJkZC1sb2NrLWJ1ZyIpKTsKICAgICAgICAgICAgX2No\nZWNrZWRVcGRhdGVCdWcgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8g\naWYgbm8gcmFuZ2UsIHVzZSBzdGFuZGFyZCBzZWxlY3QKICAgICAgICBpZiAo\nc3RhcnQgPT0gMCAmJiBlbmQgPT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAg\nICAgIHJldHVybiBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJs\nZXMsIHdoZXJlLCBncm91cCwgaGF2aW5nLAogICAgICAgICAgICAgICAgb3Jk\nZXIsIGRpc3RpbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFLCBz\nZWwpOwoKICAgICAgICAvLyBpZiBubyBza2lwLCBvcmRlcmluZywgb3IgZGlz\ndGluY3QgY2FuIHVzZSByb3dudW0gZGlyZWN0bHkKICAgICAgICBTUUxCdWZm\nZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpZiAoIXJl\ncXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc3RhcnQsIGVuZCwgZGlzdGluY3Qs\nIG9yZGVyKSkgewogICAgICAgICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAh\nd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCh3\naGVyZSkuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5k\nKCJST1dOVU0gPD0gIikuYXBwZW5kVmFsdWUoZW5kKTsKICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLnRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywg\nYnVmLCBncm91cCwgaGF2aW5nLAogICAgICAgICAgICAgICAgb3JkZXIsIGRp\nc3RpbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFLCBzZWwpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgb3JkZXJpbmcsIHNr\naXAsIG9yIGRpc3RpbmN0IHdlIGhhdmUgdG8gdXNlIHN1YnNlbGVjdHMKICAg\nICAgICBTUUxCdWZmZXIgbmV3c2VsID0gc3VwZXIudG9TZWxlY3Qoc2VsZWN0\nLCBmZXRjaCwgdGFibGVzLCB3aGVyZSwKICAgICAgICAgICAgZ3JvdXAsIGhh\ndmluZywgb3JkZXIsIGRpc3RpbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFY\nX1ZBTFVFLAogICAgICAgICAgICBzZWwpOwoKICAgICAgICAvLyBpZiBubyBz\na2lwLCBjYW4gdXNlIHNpbmdsZSBuZXN0ZWQgc3Vic2VsZWN0CiAgICAgICAg\naWYgKHN0YXJ0ID09IDApIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXRT\nZWxlY3RPcGVyYXRpb24oZmV0Y2gpICsgIiAqIEZST00gKCIpOwogICAgICAg\nICAgICBidWYuYXBwZW5kKG5ld3NlbCk7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIikgV0hFUkUgUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAg\nICAgICAgICAgIHJldHVybiBidWY7CiAgICAgICAgfQoKICAgICAgICAvLyB3\naXRoIGEgc2tpcCwgd2UgaGF2ZSB0byB1c2UgYSBkb3VibGUtbmVzdGVkIHN1\nYnNlbGVjdCB0byBwdXQKICAgICAgICAvLyB3aGVyZSBjb25kaXRpb25zIG9u\nIHRoZSByb3dudW0KICAgICAgICBidWYuYXBwZW5kKGdldFNlbGVjdE9wZXJh\ndGlvbihmZXRjaCkKICAgICAgICAgICAgKyAiICogRlJPTSAoU0VMRUNUIHIu\nKiwgUk9XTlVNIFJOVU0gRlJPTSAoIik7CiAgICAgICAgYnVmLmFwcGVuZChu\nZXdzZWwpOwogICAgICAgIGJ1Zi5hcHBlbmQoIikgciIpOwogICAgICAgIGlm\nIChlbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBXSEVSRSBST1dOVU0gPD0gIikuYXBwZW5kVmFsdWUoZW5kKTsKICAg\nICAgICBidWYuYXBwZW5kKCIpIFdIRVJFIFJOVU0gPiAiKS5hcHBlbmRWYWx1\nZShzdGFydCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBzZWxlY3Qgd2l0aCB0aGUgZ2l2\nZW4gcGFyYW1ldGVycyBuZWVkcyBhCiAgICAgKiBzdWJzZWxlY3QgdG8gYXBw\nbHkgYSByYW5nZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHJlcXVp\ncmVzU3Vic2VsZWN0Rm9yUmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQsCiAg\nICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgU1FMQnVmZmVyIG9yZGVyKSB7CiAg\nICAgICAgaWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IExvbmcuTUFYX1ZBTFVF\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHN0\nYXJ0ICE9IDAgfHwgZGlzdGluY3QgfHwgKG9yZGVyICE9IG51bGwgJiYgIW9y\nZGVyLmlzRW1wdHkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0\nbyBzZWUgaWYgd2UgaGF2ZSBzZXQgdGhlIHtAbGluayAjU0VMRUNUX0hJTlR9\nIGluIHRoZQogICAgICogZmV0Y2ggY29uZmlndXJhaXRvbiwgYW5kIGlmIHNv\nLCBhcHBlbmQgdGhlIE9yYWNoZSBoaW50IGFmdGVyIHRoZQogICAgICogIlNF\nTEVDVCIgcGFydCBvZiB0aGUgcXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0U2VsZWN0T3BlcmF0aW9uKEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBPYmplY3QgaGludCA9IGZldGNoID09IG51\nbGwgPyBudWxsIDogZmV0Y2guZ2V0SGludChTRUxFQ1RfSElOVCk7CiAgICAg\nICAgU3RyaW5nIHNlbGVjdCA9ICJTRUxFQ1QiOwogICAgICAgIGlmIChoaW50\nICE9IG51bGwpCiAgICAgICAgICAgIHNlbGVjdCArPSAiICIgKyBoaW50Owog\nICAgICAgIHJldHVybiBzZWxlY3Q7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0U3RyaW5nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBT\ndHJpbmcgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gb3JhY2xlIE5DSEFSL05WQVJD\nSEFSL05DTE9CIHVuaWNvZGUgY29sdW1ucyByZXF1aXJlIHNvbWUKICAgICAg\nICAvLyBzcGVjaWFsIGhhbmRsaW5nIHRvIGNvbmZpZ3VyZSB0aGVtIGNvcnJl\nY3RseTsgc2VlOgogICAgICAgIC8vIGh0dHA6Ly93d3cub3JhY2xlLmNvbS90\nZWNobm9sb2d5L3NhbXBsZV9jb2RlL3RlY2gvamF2YS8KICAgICAgICAvLyBz\ncWxqX2pkYmMvZmlsZXMvOWlfamRiYy9OQ0hBUnN1cHBvcnQ0VW5pY29kZVNh\nbXBsZS9SZWFkbWUuaHRtbAogICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IChj\nb2wgPT0gbnVsbCkgPyBudWxsIDogY29sLmdldFR5cGVJZGVudGlmaWVyKCku\nZ2V0TmFtZSgpOwogICAgICAgIGlmICh1c2VTZXRGb3JtT2ZVc2VGb3JVbmlj\nb2RlICYmIHR5cGVOYW1lICE9IG51bGwgJiYKICAgICAgICAgICAgKHR5cGVO\nYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgibnZhcmNoYXIiKSB8fAog\nICAgICAgICAgICAgICAgdHlwZU5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNX\naXRoKCJuY2hhciIpIHx8CiAgICAgICAgICAgICAgICB0eXBlTmFtZS50b0xv\nd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoIm5jbG9iIikpKSB7CiAgICAgICAgICAg\nIFN0YXRlbWVudCBpbm5lciA9IHN0bW50OwogICAgICAgICAgICBpZiAoaW5u\nZXIgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpCiAg\nICAgICAgICAgICAgICBpbm5lciA9ICgoRGVsZWdhdGluZ1ByZXBhcmVkU3Rh\ndGVtZW50KSBpbm5lcikuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJt\nb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKGlzT3JhY2xlUHJlcGFy\nZWRTdGF0ZW1lbnQoaW5uZXIpKSB7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIGlubmVyLmdldENsYXNzKCkuZ2V0TWV0aG9k\nKCJzZXRGb3JtT2ZVc2UiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgaW50LmNsYXNzLCBzaG9ydC5jbGFzcyB9KS4KICAgICAgICAg\nICAgICAgICAgICAgICAgaW52b2tlKGlubmVyLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBJbnRlZ2VyKGlkeCksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoIm9yYWNsZS5qZGJjLk9yYWNsZVBy\nZXBhcmVkU3RhdGVtZW50IikuCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGdldEZpZWxkKCJGT1JNX05DSEFSIikuZ2V0KG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nbG9nLndhcm4oZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoIV93YXJuZWROY2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBfd2FybmVkTmNoYXJDb2x1bW4g\nPSB0cnVlOwogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVu\nY29uZmlndXJlZC1uY2hhci1jb2xzIikpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBjYWxsIHNldEZpeGVkQ0hBUiBmb3IgZml4ZWQg\nd2lkdGggY2hhcmFjdGVyIGNvbHVtbnMgdG8gZ2V0IHBhZGRpbmcKICAgICAg\nICAvLyBzZW1hbnRpY3MKICAgICAgICBpZiAoY29sICE9IG51bGwgJiYgY29s\nLmdldFR5cGUoKSA9PSBUeXBlcy5DSEFSCiAgICAgICAgICAgICYmIHZhbCAh\nPSBudWxsICYmIHZhbC5sZW5ndGgoKSAhPSBjb2wuZ2V0U2l6ZSgpKSB7CiAg\nICAgICAgICAgIFN0YXRlbWVudCBpbm5lciA9IHN0bW50OwogICAgICAgICAg\nICBpZiAoaW5uZXIgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0\nZW1lbnQpCiAgICAgICAgICAgICAgICBpbm5lciA9ICgoRGVsZWdhdGluZ1By\nZXBhcmVkU3RhdGVtZW50KSBpbm5lcikuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKGlzT3Jh\nY2xlUHJlcGFyZWRTdGF0ZW1lbnQoaW5uZXIpKSB7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlubmVyLmdldENsYXNzKCku\nZ2V0TWV0aG9kKCJzZXRGaXhlZENIQVIiLAogICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzLCBTdHJpbmcuY2xhc3MgfSku\nCiAgICAgICAgICAgICAgICAgICAgICAgIGludm9rZShpbm5lciwgbmV3IE9i\namVjdFtdeyBuZXcgSW50ZWdlcihpZHgpLCB2YWwgfSk7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKCFfd2FybmVkQ2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgICAgICBfd2FybmVkQ2hhckNvbHVtbiA9IHRydWU7\nCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgidW5wYWRkZWQt\nY2hhci1jb2xzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHN1cGVyLnNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwsIGNvbCk7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXROdWxsKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQgY29sVHlwZSwKICAg\nICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmICgoY29sVHlwZSA9PSBUeXBlcy5DTE9CIHx8IGNvbFR5\ncGUgPT0gVHlwZXMuQkxPQikgJiYgY29sLmlzTm90TnVsbCgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1i\nbG9iLWluLW5vdC1udWxsYWJsZSIsIHRvREJOYW1lKGNvbAogICAgICAgICAg\nICAgICAgLmdldEZ1bGxEQklkZW50aWZpZXIoKSkpKTsKICAgICAgICBpZiAo\nY29sVHlwZSA9PSBUeXBlcy5CTE9CICYmIF9kcml2ZXJCZWhhdmlvciA9PSBC\nRUhBVkVfT1JBQ0xFKQogICAgICAgICAgICBzdG1udC5zZXRCbG9iKGlkeCwg\nZ2V0RW1wdHlCbG9iKCkpOwogICAgICAgIGVsc2UgaWYgKGNvbFR5cGUgPT0g\nVHlwZXMuQ0xPQiAmJiBfZHJpdmVyQmVoYXZpb3IgPT0gQkVIQVZFX09SQUNM\nRQogICAgICAgICAgICAmJiAhY29sLmlzWE1MKCkpCiAgICAgICAgICAgIHN0\nbW50LnNldENsb2IoaWR4LCBnZXRFbXB0eUNsb2IoKSk7CiAgICAgICAgZWxz\nZSBpZiAoKGNvbFR5cGUgPT0gVHlwZXMuU1RSVUNUIHx8IGNvbFR5cGUgPT0g\nVHlwZXMuT1RIRVIpCiAgICAgICAgICAgICYmIGNvbCAhPSBudWxsICYmICFE\nQklkZW50aWZpZXIuaXNOdWxsKGNvbC5nZXRUeXBlSWRlbnRpZmllcigpKSkK\nICAgICAgICAgICAgc3RtbnQuc2V0TnVsbChpZHgsIFR5cGVzLlNUUlVDVCwg\nY29sLmdldFR5cGVJZGVudGlmaWVyKCkuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgLy8gc29tZSB2ZXJzaW9ucyBvZiB0aGUgT3JhY2xlIEpEQkMgZHJpdmVy\nIHdpbGwgZmFpbCBpZiBjYWxsaW5nCiAgICAgICAgICAgIC8vIHNldE51bGwg\nd2l0aCBEQVRFOyBzZWUgYnVnICMxMTcxCiAgICAgICAgZWxzZSBpZiAoY29s\nVHlwZSA9PSBUeXBlcy5EQVRFKQogICAgICAgICAgICBzdXBlci5zZXROdWxs\nKHN0bW50LCBpZHgsIFR5cGVzLlRJTUVTVEFNUCwgY29sKTsKICAgICAgICAv\nLyB0aGUgT3JhY2xlIGRyaXZlciBkb2VzIG5vdCBzdXBwb3J0IFR5cGVzLk9U\nSEVSIHdpdGggc2V0TnVsbAogICAgICAgIGVsc2UgaWYgKGNvbFR5cGUgPT0g\nVHlwZXMuT1RIRVIgfHwgY29sLmlzWE1MKCkpCiAgICAgICAgICAgIHN1cGVy\nLnNldE51bGwoc3RtbnQsIGlkeCwgVHlwZXMuTlVMTCwgY29sKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN1cGVyLnNldE51bGwoc3RtbnQsIGlkeCwg\nY29sVHlwZSwgY29sKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1\nbW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKF9kcml2ZXJCZWhhdmlvciAhPSBCRUhBVkVfT1JBQ0xFKQogICAgICAgICAg\nICByZXR1cm4gc3VwZXIuZ2V0Q2xvYlN0cmluZyhycywgY29sdW1uKTsKCiAg\nICAgICAgQ2xvYiBjbG9iID0gZ2V0Q2xvYihycywgY29sdW1uKTsKICAgICAg\nICBpZiAoY2xvYiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoY2xvYi5nZXRDbGFzcygpLmdldE5hbWUoKS5lcXVhbHMo\nIm9yYWNsZS5zcWwuQ0xPQiIpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBpZiAoKChCb29sZWFuKSBDbGFzcy5mb3JOYW1lKCJvcmFj\nbGUuc3FsLkNMT0IiKS4KICAgICAgICAgICAgICAgICAgICBnZXRNZXRob2Qo\nImlzRW1wdHlMb2IiLCBuZXcgQ2xhc3NbMF0pLgogICAgICAgICAgICAgICAg\nICAgIGludm9rZShjbG9iLCBuZXcgT2JqZWN0WzBdKSkuCiAgICAgICAgICAg\nICAgICAgICAgYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAvLyBwb3NzaWJseSBkaWZmZXJlbnQgdmVy\nc2lvbiBvZiB0aGUgZHJpdmVyCiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaWYgKGNsb2IubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIC8vIHVubGlrZWx5IHRoYXQgd2UnbGwgaGF2\nZSBzdHJpbmdzIG92ZXIgNCBiaWxsaW9uIGNoYXJzCiAgICAgICAgcmV0dXJu\nIGNsb2IuZ2V0U3ViU3RyaW5nKDEsIChpbnQpIGNsb2IubGVuZ3RoKCkpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFRpbWVzdGFtcCBnZXRU\naW1lc3RhbXAoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBj\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGNhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwZXIuZ2V0VGltZXN0YW1wKHJzLCBjb2x1bW4sIGNh\nbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEFycmF5SW5kZXhPdXRPZkJvdW5k\nc0V4Y2VwdGlvbiBhZSkgewogICAgICAgICAgICAgICAgLy8gQ1IyOTU2MDQ6\nIGlzc3VlIGEgd2FybmluZyB0aGlzIHRoaXMgYnVnIGNhbiBiZSBnb3R0ZW4K\nICAgICAgICAgICAgICAgIC8vIGFyb3VuZCB3aXRoIFN1cHBvcnRzVGltZXN0\nYW1wTmFub3M9ZmFsc2UKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2Mu\nZ2V0KCJvcmFjbGUtdGltZXN0YW1wLWJ1ZyIpLCBhZSk7CiAgICAgICAgICAg\nICAgICB0aHJvdyBhZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gaGFuZGxlIE9yYWNsZSBidWcgd2hlcmUgbmFub3Mgbm90IHJldHVy\nbmVkIGZyb20gY2FsbCB3aXRoIENhbGVuZGFyCiAgICAgICAgLy8gcGFyYW1l\ndGVyCiAgICAgICAgVGltZXN0YW1wIHRzID0gcnMuZ2V0VGltZXN0YW1wKGNv\nbHVtbiwgY2FsKTsKICAgICAgICBpZiAodHMgIT0gbnVsbCAmJiB0cy5nZXRO\nYW5vcygpID09IDApCiAgICAgICAgICAgIHRzLnNldE5hbm9zKHJzLmdldFRp\nbWVzdGFtcChjb2x1bW4pLmdldE5hbm9zKCkpOwogICAgICAgIHJldHVybiB0\nczsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBPYmplY3QgZ2V0\nT2JqZWN0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyByZWNlbnQg\nb3JhY2xlIGRyaXZlcnMgcmV0dXJuIG9yYWNsZS1zcGVjaWZpYyB0eXBlcyBm\nb3IgdGltZXN0YW1wcwogICAgICAgIC8vIGFuZCBkYXRlcwogICAgICAgIE9i\namVjdCBvYmogPSBzdXBlci5nZXRPYmplY3QocnMsIGNvbHVtbiwgbWFwKTsK\nICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmICgib3JhY2xlLnNxbC5EQVRFIi5lcXVhbHMob2Jq\nLmdldENsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgb2JqID0gY29u\ndmVydEZyb21PcmFjbGVUeXBlKG9iaiwgImRhdGVWYWx1ZSIpOwogICAgICAg\nIGVsc2UgaWYgKCJvcmFjbGUuc3FsLlRJTUVTVEFNUCIuZXF1YWxzKG9iai5n\nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAgICAgICAgIG9iaiA9IGNvbnZl\ncnRGcm9tT3JhY2xlVHlwZShvYmosICJ0aW1lc3RhbXBWYWx1ZSIpOwogICAg\nICAgIHJldHVybiBvYmo7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIGFuIG9iamVjdCBmcm9tIGl0cyBwcm9wcmlldGFyeSBPcmFjbGUgdHlwZSB0\nbyB0aGUgc3RhbmRhcmQKICAgICAqIEphdmEgdHlwZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGNvbnZlcnRGcm9tT3JhY2xlVHlwZShP\nYmplY3Qgb2JqLAogICAgICAgIFN0cmluZyBjb252ZXJ0TWV0aG9kKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIE1ldGhvZCBtID0gb2JqLmdldENsYXNzKCkuZ2V0TWV0aG9kKGNv\nbnZlcnRNZXRob2QsIChDbGFzc1tdKSBudWxsKTsKICAgICAgICAgICAgcmV0\ndXJuIG0uaW52b2tlKG9iaiwgKE9iamVjdFtdKSBudWxsKTsKICAgICAgICB9\nIGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICBpZiAodCBpbnN0\nYW5jZW9mIEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24pCiAgICAgICAgICAg\nICAgICB0ID0gKChJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uKSB0KS5nZXRU\nYXJnZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2Vv\nZiBTUUxFeGNlcHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyhTUUxFeGNl\ncHRpb24pIHQ7CiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24o\ndC5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nQ29sdW1uW10gZ2V0Q29sdW1ucyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0\ncmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJp\nbmcgdGFibGVOYW1lLCBTdHJpbmcgY29sdW1uTmFtZSwgQ29ubmVjdGlvbiBj\nb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBnZXRDb2x1bW5zKG1ldGEsIAogICAgICAgICAgICBEQklkZW50aWZp\nZXIubmV3Q2F0YWxvZyhjYXRhbG9nKSwgCiAgICAgICAgICAgIERCSWRlbnRp\nZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksIAogICAgICAgICAgICBEQklk\nZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSwgCiAgICAgICAgICAgIERC\nSWRlbnRpZmllci5uZXdDb2x1bW4oY29sdW1uTmFtZSksY29ubik7CiAgICB9\nCgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBEQklkZW50aWZpZXIgY2F0YWxvZywKICAgICAgICBEQklk\nZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwg\nREJJZGVudGlmaWVyIGNvbHVtbk5hbWUsIENvbm5lY3Rpb24gY29ubikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDb2x1bW5bXSBj\nb2xzID0gc3VwZXIuZ2V0Q29sdW1ucyhtZXRhLCBjYXRhbG9nLCBzY2hlbWFO\nYW1lLCB0YWJsZU5hbWUsCiAgICAgICAgICAgIGNvbHVtbk5hbWUsIGNvbm4p\nOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgY29scyAhPSBudWxsICYmIGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFN0cmluZyB0eXBl\nTmFtZSA9IGNvbHNbaV0uZ2V0VHlwZUlkZW50aWZpZXIoKS5nZXROYW1lKCk7\nCiAgICAgICAgICAgIGlmICh0eXBlTmFtZSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZS50b1Vw\ncGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIlRJTUVTVEFNUCIpKQogICAgICAgICAg\nICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKCJCTE9CIi5lcXVhbHNJZ25vcmVDYXNlKHR5cGVO\nYW1lKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5C\nTE9CKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkNMT0IiLmVxdWFsc0lnbm9y\nZUNhc2UodHlwZU5hbWUpCiAgICAgICAgICAgICAgICB8fCAiTkNMT0IiLmVx\ndWFsc0lnbm9yZUNhc2UodHlwZU5hbWUpKQogICAgICAgICAgICAgICAgY29s\nc1tpXS5zZXRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICBlbHNlIGlm\nICgiRkxPQVQiLmVxdWFsc0lnbm9yZUNhc2UodHlwZU5hbWUpKQogICAgICAg\nICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLkZMT0FUKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoIk5WQVJDSEFSIi5lcXVhbHNJZ25vcmVDYXNlKHR5\ncGVOYW1lKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBl\ncy5WQVJDSEFSKTsKICAgICAgICAgICAgZWxzZSBpZiAoIk5DSEFSIi5lcXVh\nbHNJZ25vcmVDYXNlKHR5cGVOYW1lKSkKICAgICAgICAgICAgICAgIGNvbHNb\naV0uc2V0VHlwZShUeXBlcy5DSEFSKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGNvbHM7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgUHJp\nbWFyeUtleVtdIGdldFByaW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0\nYSwKICAgICAgICBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0UHJpbWFy\neUtleXMobWV0YSwKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld0NhdGFs\nb2coY2F0YWxvZyksIAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3U2No\nZW1hKHNjaGVtYU5hbWUpLCAKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5l\nd1RhYmxlKHRhYmxlTmFtZSksIGNvbm4pOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhEYXRh\nYmFzZU1ldGFEYXRhIG1ldGEsCiAgICAgICAgREJJZGVudGlmaWVyIGNhdGFs\nb2csIERCSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIgdGFi\nbGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBuZXcgU3Ry\naW5nQnVpbGRlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVDVCB0MC5P\nV05FUiBBUyBUQUJMRV9TQ0hFTSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\ndDAuVEFCTEVfTkFNRSBBUyBUQUJMRV9OQU1FLCAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFNRSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1FIEFTIFBLX05B\nTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xV\nTU5TIHQwLCBBTExfQ09OU1RSQUlOVFMgdDEgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgiV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAg\nICAgYXBwZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RS\nQUlOVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05T\nVFJBSU5UX1RZUEUgPSAnUCciKTsKICAgICAgICBpZiAoIURCSWRlbnRpZmll\nci5pc051bGwoc2NoZW1hTmFtZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBBTkQgdDAuT1dORVIgPSA/Iik7CiAgICAgICAgaWYgKCFEQklkZW50aWZp\nZXIuaXNOdWxsKHRhYmxlTmFtZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBBTkQgdDAuVEFCTEVfTkFNRSA9ID8iKTsKCiAgICAgICAgUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRv\nU3RyaW5nKCkpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAg\nIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChzY2hlbWFOYW1lKSkKICAgICAg\nICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIGNvbnZlcnRTY2hl\nbWFDYXNlKHNjaGVtYU5hbWUpLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFE\nQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkpCiAgICAgICAgICAgICAg\nICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBjb252ZXJ0U2NoZW1hQ2FzZSh0\nYWJsZU5hbWUpLCBudWxsKTsKICAgICAgICAgICAgc2V0VGltZW91dHMoc3Rt\nbnQsIGNvbmYsIGZhbHNlKTsKICAgICAgICAgICAgcnMgPSBzdG1udC5leGVj\ndXRlUXVlcnkoKTsKICAgICAgICAgICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChycyAhPSBudWxsICYmIHJz\nLm5leHQoKSkKICAgICAgICAgICAgICAgIHBrTGlzdC5hZGQobmV3UHJpbWFy\neUtleShycykpOwogICAgICAgICAgICByZXR1cm4gKFByaW1hcnlLZXlbXSkg\ncGtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgUHJpbWFyeUtl\neVtwa0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2Uo\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyBJbmRleFtdIGdldEluZGV4SW5mbyhEYXRhYmFzZU1ldGFEYXRhIG1l\ndGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1l\nLCBTdHJpbmcgdGFibGVOYW1lLCBib29sZWFuIHVuaXF1ZSwgYm9vbGVhbiBh\ncHByb3gsCiAgICAgICAgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRJbmRleEluZm8o\nbWV0YSwKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY2F0\nYWxvZyksIAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3U2NoZW1hKHNj\naGVtYU5hbWUpLCAKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld1RhYmxl\nKHRhYmxlTmFtZSksIHVuaXF1ZSwgYXBwcm94LCBjb25uKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBJbmRleFtdIGdldEluZGV4SW5mbyhE\nYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERCSWRlbnRpZmllciBjYXRhbG9nLAog\nICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIg\ndGFibGVOYW1lLCBib29sZWFuIHVuaXF1ZSwgYm9vbGVhbiBhcHByb3gsCiAg\nICAgICAgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1aWxkZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgdDAuSU5E\nRVhfT1dORVIgQVMgVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBhcHBl\nbmQoInQwLlRBQkxFX05BTUUgQVMgVEFCTEVfTkFNRSwgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiREVDT0RFKHQxLlVOSVFVRU5FU1MsICdVTklRVUUnLCAw\nLCAnTk9OVU5JUVVFJywgMSkgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQVMg\nTk9OX1VOSVFVRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuSU5ERVhf\nTkFNRSBBUyBJTkRFWF9OQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0\nMC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFNRSAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJGUk9NIEFMTF9JTkRfQ09MVU1OUyB0MCwgQUxMX0lOREVYRVMg\ndDEgIikuCiAgICAgICAgICAgIGFwcGVuZCgiV0hFUkUgdDAuSU5ERVhfT1dO\nRVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDAu\nSU5ERVhfTkFNRSA9IHQxLklOREVYX05BTUUiKTsKICAgICAgICBpZiAoIURC\nSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBBTkQgdDAuVEFCTEVfT1dORVIgPSA/Iik7CiAgICAgICAg\naWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAuVEFCTEVfTkFNRSA9ID8iKTsKCiAg\nICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVT\ndGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAgICAgIFJlc3VsdFNldCBy\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlkeCA9\nIDE7CiAgICAgICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChzY2hl\nbWFOYW1lKSkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4\nKyssIGNvbnZlcnRTY2hlbWFDYXNlKHNjaGVtYU5hbWUpLCBudWxsKTsKICAg\nICAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkp\nCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBjb252\nZXJ0U2NoZW1hQ2FzZSh0YWJsZU5hbWUpLCBudWxsKTsKCiAgICAgICAgICAg\nIHNldFRpbWVvdXRzKHN0bW50LCBjb25mLCBmYWxzZSk7CiAgICAgICAgICAg\nIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3Qg\naWR4TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUg\nKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICAgICAgaWR4\nTGlzdC5hZGQobmV3SW5kZXgocnMpKTsKICAgICAgICAgICAgcmV0dXJuIChJ\nbmRleFtdKSBpZHhMaXN0LnRvQXJyYXkobmV3IEluZGV4W2lkeExpc3Quc2l6\nZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBGb3JlaWdu\nS2V5W10gZ2V0SW1wb3J0ZWRLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwg\nU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0\ncmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubiwgYm9vbGVhbiBwYXJ0\naWFsS2V5cykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZ2V0SW1wb3J0ZWRLZXlzKG1ldGEsCiAgICAgICAgICAgIERC\nSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLCAKICAgICAgICAgICAg\nREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgCiAgICAgICAg\nICAgIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25uLCBw\nYXJ0aWFsS2V5cyk7CiAgICB9CiAgICAKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIEZvcmVpZ25LZXlbXSBnZXRJbXBvcnRlZEtleXMoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBEQklkZW50aWZpZXIgY2F0YWxvZywKICAgICAgICBEQklk\nZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwg\nQ29ubmVjdGlvbiBjb25uLCBib29sZWFuIHBhcnRpYWxLZXlzKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZ0J1aWxkZXIg\nZGVsQWN0aW9uID0gbmV3IFN0cmluZ0J1aWxkZXIoIkRFQ09ERSh0MS5ERUxF\nVEVfUlVMRSIpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ05PIEFDVElPTics\nICIpLmFwcGVuZChtZXRhLmltcG9ydGVkS2V5Tm9BY3Rpb24pLgogICAgICAg\nICAgICBhcHBlbmQoIiwgJ1JFU1RSSUNUJywgIikuYXBwZW5kKG1ldGEuaW1w\nb3J0ZWRLZXlSZXN0cmljdCkuCiAgICAgICAgICAgIGFwcGVuZCgiLCAnQ0FT\nQ0FERScsICIpLmFwcGVuZChtZXRhLmltcG9ydGVkS2V5Q2FzY2FkZSkuCiAg\nICAgICAgICAgIGFwcGVuZCgiLCAnU0VUIE5VTEwnLCAiKS5hcHBlbmQobWV0\nYS5pbXBvcnRlZEtleVNldE51bGwpLgogICAgICAgICAgICBhcHBlbmQoIiwg\nJ1NFVCBERUZBVUxUJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXRE\nZWZhdWx0KS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CgogICAgICAgIFN0\ncmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAg\nICBidWYuYXBwZW5kKCJTRUxFQ1QgdDIuT1dORVIgQVMgUEtUQUJMRV9TQ0hF\nTSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDIuVEFCTEVfTkFNRSBBUyBQ\nS1RBQkxFX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoInQyLkNPTFVN\nTl9OQU1FIEFTIFBLQ09MVU1OX05BTUUsICIpLgogICAgICAgICAgICBhcHBl\nbmQoInQwLk9XTkVSIEFTIEZLVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAg\nICBhcHBlbmQoInQwLlRBQkxFX05BTUUgQVMgRktUQUJMRV9OQU1FLCAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBGS0NPTFVN\nTl9OQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5QT1NJVElPTiBB\nUyBLRVlfU0VRLCAiKS4KICAgICAgICAgICAgYXBwZW5kKGRlbEFjdGlvbiku\nYXBwZW5kKCIgQVMgREVMRVRFX1JVTEUsICIpLgogICAgICAgICAgICBhcHBl\nbmQoInQwLkNPTlNUUkFJTlRfTkFNRSBBUyBGS19OQU1FLCAiKS4KICAgICAg\nICAgICAgYXBwZW5kKCJERUNPREUodDEuREVGRVJSRUQsICdERUZFUlJFRCcs\nICIpLgogICAgICAgICAgICBhcHBlbmQobWV0YS5pbXBvcnRlZEtleUluaXRp\nYWxseURlZmVycmVkKS4KICAgICAgICAgICAgYXBwZW5kKCIsICdJTU1FRElB\nVEUnLCAiKS4KICAgICAgICAgICAgYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlJ\nbml0aWFsbHlJbW1lZGlhdGUpLgogICAgICAgICAgICBhcHBlbmQoIikgQVMg\nREVGRVJSQUJJTElUWSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJGUk9NIEFM\nTF9DT05TX0NPTFVNTlMgdDAsIEFMTF9DT05TVFJBSU5UUyB0MSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgiQUxMX0NPTlNfQ09MVU1OUyB0MiAiKS4KICAg\nICAgICAgICAgYXBwZW5kKCJXSEVSRSB0MC5PV05FUiA9IHQxLk9XTkVSICIp\nLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MC5DT05TVFJBSU5UX05BTUUg\nPSB0MS5DT05TVFJBSU5UX05BTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\nQU5EIHQxLkNPTlNUUkFJTlRfVFlQRSA9ICdSJyAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJBTkQgdDEuUl9PV05FUiA9IHQyLk9XTkVSICIpLgogICAgICAg\nICAgICBhcHBlbmQoIkFORCB0MS5SX0NPTlNUUkFJTlRfTkFNRSA9IHQyLkNP\nTlNUUkFJTlRfTkFNRSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDAu\nUE9TSVRJT04gPSB0Mi5QT1NJVElPTiIpOwogICAgICAgIGlmICghREJJZGVu\ndGlmaWVyLmlzTnVsbChzY2hlbWFOYW1lKSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCB0MC5PV05FUiA9ID8iKTsKICAgICAgICBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwodGFibGVOYW1lKSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIiBPUkRFUiBCWSB0Mi5PV05FUiwgdDIuVEFCTEVfTkFNRSwgdDAu\nUE9TSVRJT04iKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQg\nPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAg\nICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAgIGlmICghREJJZGVudGlm\naWVyLmlzTnVsbChzY2hlbWFOYW1lKSkKICAgICAgICAgICAgICAgIHNldFN0\ncmluZyhzdG1udCwgaWR4KyssIGNvbnZlcnRTY2hlbWFDYXNlKHNjaGVtYU5h\nbWUpLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNO\ndWxsKHRhYmxlTmFtZSkpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3Rt\nbnQsIGlkeCsrLCBjb252ZXJ0U2NoZW1hQ2FzZSh0YWJsZU5hbWUpLCBudWxs\nKTsKICAgICAgICAgICAgc2V0VGltZW91dHMoc3RtbnQsIGNvbmYsIGZhbHNl\nKTsKICAgICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAg\nICAgICAgICAgTGlzdDxGb3JlaWduS2V5PiBma0xpc3QgPSBuZXcgQXJyYXlM\naXN0PEZvcmVpZ25LZXk+KCk7ICAgICAgICAgICAgCiAgICAgICAgICAgIE1h\ncDxGS01hcEtleSwgRm9yZWlnbktleT4gZmtNYXAgPSBuZXcgSGFzaE1hcDxG\nS01hcEtleSwgRm9yZWlnbktleT4oKTsKCiAgICAgICAgICAgIHdoaWxlIChy\ncyAhPSBudWxsICYmIHJzLm5leHQoKSkgewogICAgICAgICAgICAgICAgRm9y\nZWlnbktleSBuZmsgPSBuZXdGb3JlaWduS2V5KHJzKTsKICAgICAgICAgICAg\nICAgIGlmICghcGFydGlhbEtleXMpIHsKICAgICAgICAgICAgICAgICAgICBG\nb3JlaWduS2V5IGZrID0gY29tYmluZUZvcmVpZ25LZXkoZmtNYXAsIG5mayk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBhZGQgdGhlIGZrIHRvIHRo\nZSBpbXBvcnQgbGlzdCBpZiBpdCBpcyBuZXcKICAgICAgICAgICAgICAgICAg\nICBpZiAoZmsgIT0gbmZrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGZrTGlzdC5hZGQobmZrKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gKEZvcmVpZ25LZXlbXSkgZmtMaXN0\nLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgRm9yZWlnbktleVtma0xp\nc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXRDcmVhdGVUYWJsZVNRTChUYWJsZSB0YWJsZSkgewogICAg\nICAgIC8vIG9ubHkgb3ZlcnJpZGUgaWYgd2UgYXJlIHNpbXVsYXRpbmcgYXV0\nby1pbmNyZW1lbmV0IHdpdGggdHJpZ2dlcnMKICAgICAgICBTdHJpbmdbXSBj\ncmVhdGUgPSBzdXBlci5nZXRDcmVhdGVUYWJsZVNRTCh0YWJsZSk7CiAgICAg\nICAgaWYgKCF1c2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAg\nIHJldHVybiBjcmVhdGU7CgogICAgICAgIENvbHVtbltdIGNvbHMgPSB0YWJs\nZS5nZXRDb2x1bW5zKCk7CiAgICAgICAgTGlzdCBzZXFzID0gbnVsbDsKICAg\nICAgICBTdHJpbmcgc2VxLCB0cmlnOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBjb2xzICE9IG51bGwgJiYgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKCFjb2xzW2ldLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHNlcXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHNlcXMgPSBuZXcgQXJyYXlMaXN0KDQp\nOwoKICAgICAgICAgICAgc2VxID0gYXV0b0Fzc2lnblNlcXVlbmNlTmFtZTsK\nICAgICAgICAgICAgaWYgKHNlcSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBpZiAob3BlbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAg\nICAgICAgICBzZXEgPSBnZXRPcGVuSlBBM0dlbmVyYXRlZEtleVNlcXVlbmNl\nTmFtZShjb2xzW2ldKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICBzZXEgPSBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUo\nY29sc1tpXSk7CiAgICAgICAgICAgICAgICBzZXFzLmFkZCgiQ1JFQVRFIFNF\nUVVFTkNFICIgKyBzZXEgKyAiIFNUQVJUIFdJVEggMSIpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGlmIChvcGVuanBhM0dlbmVyYXRlZEtleU5hbWVz\nKQogICAgICAgICAgICAgICAgdHJpZyA9IGdldE9wZW5KUEEzR2VuZXJhdGVk\nS2V5VHJpZ2dlck5hbWUoY29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIHRyaWcgPSBnZXRHZW5lcmF0ZWRLZXlUcmlnZ2VyTmFt\nZShjb2xzW2ldKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgdHJpZ2dl\nciB0aGF0IHdpbGwgaW5zZXJ0IG5ldyB2YWx1ZXMgaW50bwogICAgICAgICAg\nICAvLyB0aGUgdGFibGUgd2hlbmV2ZXIgYSByb3cgaXMgY3JlYXRlZAogICAg\nICAgICAgICBzZXFzLmFkZCgiQ1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiAi\nICsgdHJpZwogICAgICAgICAgICAgICAgKyAiIEJFRk9SRSBJTlNFUlQgT04g\nIiArIHRvREJOYW1lKHRhYmxlLmdldElkZW50aWZpZXIoKSkKICAgICAgICAg\nICAgICAgICsgIiBGT1IgRUFDSCBST1cgQkVHSU4gU0VMRUNUICIgKyBzZXEg\nKyAiLm5leHR2YWwgSU5UTyAiCiAgICAgICAgICAgICAgICArICI6bmV3LiIg\nKyB0b0RCTmFtZShjb2xzW2ldLmdldElkZW50aWZpZXIoKSkgKyAiIEZST00g\nRFVBTDsgIgogICAgICAgICAgICAgICAgKyAiRU5EICIgKyB0cmlnICsgIjsi\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGNyZWF0ZTsKCiAgICAgICAgLy8gY29tYmluZSBjcmVh\ndGUgdGFibGUgc3FsIGFuZCBjcmVhdGUgc2VxZW5jZXMgc3FsCiAgICAgICAg\nU3RyaW5nW10gc3FsID0gbmV3IFN0cmluZ1tjcmVhdGUubGVuZ3RoICsgc2Vx\ncy5zaXplKCldOwogICAgICAgIFN5c3RlbS5hcnJheWNvcHkoY3JlYXRlLCAw\nLCBzcWwsIDAsIGNyZWF0ZS5sZW5ndGgpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc2Vxcy5zaXplKCk7IGkrKykKICAgICAgICAgICAgc3FsW2Ny\nZWF0ZS5sZW5ndGggKyBpXSA9IChTdHJpbmcpIHNlcXMuZ2V0KGkpOwogICAg\nICAgIHJldHVybiBzcWw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0Q3JlYXRlU2VxdWVuY2VTUUwoU2VxdWVuY2Ugc2Vx\nKSB7CiAgICAgICAgU3RyaW5nW10gc3FsID0gc3VwZXIuZ2V0Q3JlYXRlU2Vx\ndWVuY2VTUUwoc2VxKTsKICAgICAgICBpZiAoc2VxLmdldEFsbG9jYXRlKCkg\nPiAxKQogICAgICAgICAgICBzcWxbMF0gKz0gIiBDQUNIRSAiICsgc2VxLmdl\ndEFsbG9jYXRlKCk7CiAgICAgICAgcmV0dXJuIHNxbDsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlw\nZXN9IGNvbnN0YW50IGZvciB0aGUgZ2l2ZW4KICAgICAqIHtAbGluayBKYXZh\nVHlwZXN9IG9yIHtAbGluayBKYXZhU1FMVHlwZXN9IGNvbnN0YW50LgogICAg\nICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBpbnQgZ2V0SkRCQ1R5cGUo\naW50IG1ldGFUeXBlQ29kZSwgYm9vbGVhbiBsb2IsIGludCBwcmVjaXMsIAog\nICAgICAgIGludCBzY2FsZSwgYm9vbGVhbiB4bWwpIHsgICAgICAgIAogICAg\nICAgIHJldHVybiBnZXRKREJDVHlwZShtZXRhVHlwZUNvZGUsIGxvYiB8fCB4\nbWwsIHByZWNpcywgc2NhbGUpOyAgICAgICAgCiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNlcXVlbmNlc1NRTChTdHJp\nbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSkgewogICAgICAg\nIHJldHVybiBnZXRTZXF1ZW5jZXNTUUwoREJJZGVudGlmaWVyLm5ld1NjaGVt\nYShzY2hlbWFOYW1lKSwgREJJZGVudGlmaWVyLm5ld1NlcXVlbmNlKHNlcXVl\nbmNlTmFtZSkpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVk\nIFN0cmluZyBnZXRTZXF1ZW5jZXNTUUwoREJJZGVudGlmaWVyIHNjaGVtYU5h\nbWUsIERCSWRlbnRpZmllciBzZXF1ZW5jZU5hbWUpIHsKICAgICAgICBTdHJp\nbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAg\nYnVmLmFwcGVuZCgiU0VMRUNUIFNFUVVFTkNFX09XTkVSIEFTIFNFUVVFTkNF\nX1NDSEVNQSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiU0VRVUVOQ0VfTkFN\nRSBGUk9NIEFMTF9TRVFVRU5DRVMiKTsKICAgICAgICBpZiAoIURCSWRlbnRp\nZmllci5pc051bGwoc2NoZW1hTmFtZSkgfHwgIURCSWRlbnRpZmllci5pc051\nbGwoc2VxdWVuY2VOYW1lKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIFdI\nRVJFICIpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbChzY2hl\nbWFOYW1lKSkgewogICAgICAgICAgICBidWYuYXBwZW5kKCJTRVFVRU5DRV9P\nV05FUiA9ID8iKTsKICAgICAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNO\ndWxsKHNlcXVlbmNlTmFtZSkpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoIURCSWRlbnRpZmll\nci5pc051bGwoc2VxdWVuY2VOYW1lKSkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiU0VRVUVOQ0VfTkFNRSA9ID8iKTsKICAgICAgICByZXR1cm4gYnVmLnRv\nU3RyaW5nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1T\nZXF1ZW5jZShTdHJpbmcgbmFtZSwgU3RyaW5nIHNjaGVtYSwKICAgICAgICBi\nb29sZWFuIHRhcmdldFNjaGVtYSkgewogICAgICAgIHJldHVybiBpc1N5c3Rl\nbVNlcXVlbmNlKERCSWRlbnRpZmllci5uZXdTZXF1ZW5jZShuYW1lKSwKICAg\nICAgICAgICAgREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWEpLCB0YXJn\nZXRTY2hlbWEpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJv\nb2xlYW4gaXNTeXN0ZW1TZXF1ZW5jZShEQklkZW50aWZpZXIgbmFtZSwgREJJ\nZGVudGlmaWVyIHNjaGVtYSwKICAgICAgICBib29sZWFuIHRhcmdldFNjaGVt\nYSkgewogICAgICAgIGlmIChzdXBlci5pc1N5c3RlbVNlcXVlbmNlKG5hbWUs\nIHNjaGVtYSwgdGFyZ2V0U2NoZW1hKSkKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CgogICAgICAgIC8vIGZpbHRlciBvdXQgZ2VuZXJhdGVkIHNlcXVlbmNl\ncyB1c2VkIGZvciBhdXRvLWFzc2lnbgogICAgICAgIFN0cmluZyBzdHJOYW1l\nID0gREJJZGVudGlmaWVyLmlzTnVsbChuYW1lKSA/ICIiIDogbmFtZS5nZXRO\nYW1lKCk7CiAgICAgICAgcmV0dXJuIChhdXRvQXNzaWduU2VxdWVuY2VOYW1l\nICE9IG51bGwKICAgICAgICAgICAgJiYgc3RyTmFtZS5lcXVhbHNJZ25vcmVD\nYXNlKGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUpKQogICAgICAgICAgICB8fCAo\nYXV0b0Fzc2lnblNlcXVlbmNlTmFtZSA9PSBudWxsCiAgICAgICAgICAgICYm\nIHN0ck5hbWUudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJTVF8iKSk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgT2JqZWN0IGdldEdlbmVy\nYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCF1c2VUcmlnZ2Vy\nc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZh\nbHVlT2YoMEwpOwoKICAgICAgICAvLyBpZiB3ZSBzaW11bGF0ZSBhdXRvLWFz\nc2lnbmVkIGNvbHVtbnMgdXNpbmcgdHJpZ2dlcnMgYW5kCiAgICAgICAgLy8g\nc2VxdWVuY2VzLCB0aGVuIHJldHVybiB0aGUgY3VycmVudCB2YWx1ZSBvZiB0\naGUgc2VxdWVuY2UKICAgICAgICAvLyBmcm9tIGF1dG9Bc3NpZ25TZXF1ZW5j\nZU5hbWUKICAgICAgICBTdHJpbmcgc2VxID0gYXV0b0Fzc2lnblNlcXVlbmNl\nTmFtZTsKICAgICAgICBpZiAoc2VxID09IG51bGwgJiYgb3BlbmpwYTNHZW5l\ncmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgc2VxID0gZ2V0T3BlbkpQQTNH\nZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAgICBlbHNlIGlm\nIChzZXEgPT0gbnVsbCkKICAgICAgICAgICAgc2VxID0gZ2V0R2VuZXJhdGVk\nS2V5U2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoIlNFTEVDVCAiICsg\nc2VxCiAgICAgICAgICAgICsgIi5jdXJydmFsIEZST00gRFVBTCIpOwogICAg\nICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgc2V0VGltZW91dHMoc3RtbnQsIGNvbmYsIGZhbHNlKTsKICAgICAg\nICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAg\ncnMubmV4dCgpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKHJzLmdldExvbmcoMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMu\nY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAg\nICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJp\nZ2dlciBuYW1lIGZvciBzaW11bGF0aW5nIGF1dG8tYXNzaWduIHZhbHVlcyBv\nbiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldEdlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsK\nICAgICAgICAvLyByZXBsYWNlIHRyYWlsaW5nIF9TRVEgd2l0aCBfVFJHCiAg\nICAgICAgU3RyaW5nIHNlcU5hbWUgPSBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5j\nZU5hbWUoY29sKTsKICAgICAgICByZXR1cm4gc2VxTmFtZS5zdWJzdHJpbmco\nMCwgc2VxTmFtZS5sZW5ndGgoKSAtIDMpICsgIlRSRyI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFt\nZSBmb3IgYW4gYXV0by1hc3NpZ24gc2VxdWVuY2UuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdHJpbmcgZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlTZXF1ZW5j\nZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gY29s\nLmdldFRhYmxlKCk7CiAgICAgICAgREJJZGVudGlmaWVyIHNOYW1lID0gREJJ\nZGVudGlmaWVyLnByZUNvbWJpbmUodGFibGUuZ2V0SWRlbnRpZmllcigpLCAi\nU0VRIik7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKGdldE5hbWluZ1V0aWwo\nKS5tYWtlSWRlbnRpZmllclZhbGlkKHNOYW1lLCB0YWJsZS5nZXRTY2hlbWEo\nKS4KICAgICAgICAgICAgZ2V0U2NoZW1hR3JvdXAoKSwgbWF4VGFibGVOYW1l\nTGVuZ3RoLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0by1hc3Np\nZ24gdHJpZ2dlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRP\ncGVuSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsK\nICAgICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgpOyAgICAgICAg\nCiAgICAgICAgREJJZGVudGlmaWVyIHNOYW1lID0gREJJZGVudGlmaWVyLnBy\nZUNvbWJpbmUodGFibGUuZ2V0SWRlbnRpZmllcigpLCAiVFJJRyIpOwogICAg\nICAgIHJldHVybiB0b0RCTmFtZShnZXROYW1pbmdVdGlsKCkubWFrZUlkZW50\naWZpZXJWYWxpZChzTmFtZSwgdGFibGUuZ2V0U2NoZW1hKCkuCiAgICAgICAg\nICAgIGdldFNjaGVtYUdyb3VwKCksIG1heFRhYmxlTmFtZUxlbmd0aCwgdHJ1\nZSkpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxj\nb2RlPnB1dEJ5dGVzPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIEJMT0Ig\nb2JqZWN0LgogICAgICogVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGJs\nb2IgaXMgd3JhcHBlZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lm\naWMgY2xhc3M7IGZvciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0\naGluIGRyaXZlcgogICAgICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMg\nd2l0aCB0aGUgc2FtZSBtZXRob2RzLgogICAgICovCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIHB1dEJ5dGVzKEJsb2IgYmxvYiwgYnl0ZVtdIGRh\ndGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGJsb2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlm\nIChfcHV0Qnl0ZXMgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgX3B1dEJ5dGVzID0gYmxvYi5nZXRDbGFzcygpLmdldE1l\ndGhvZCgicHV0Qnl0ZXMiLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyBsb25nLmNsYXNzLCBieXRlW10uY2xhc3MgfSk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9wdXRCeXRlcywgYmxv\nYiwgZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgT3JhY2xl\nJ3MgPGNvZGU+cHV0U3RyaW5nPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVu\nIENMT0Igb2JqZWN0LgogICAgICogVXNlcyByZWZsZWN0aW9uIGluIGNhc2Ug\ndGhlIGNsb2IgaXMgd3JhcHBlZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3It\nc3BlY2lmaWMgY2xhc3M7IGZvciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9y\nYWNsZSB0aGluIGRyaXZlcgogICAgICogbG9icyBpbiBpdHMgb3duIGludGVy\nZmFjZXMgd2l0aCB0aGUgc2FtZSBtZXRob2RzLgogICAgICovCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIHB1dFN0cmluZyhDbG9iIGNsb2IsIFN0\ncmluZyBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChfcHV0U3RyaW5nID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIF9wdXRTdHJpbmcgPSBjbG9iLmdldENsYXNz\nKCkuZ2V0TWV0aG9kKCJwdXRTdHJpbmciLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9wdXRT\ndHJpbmcsIGNsb2IsIGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogSW52\nb2tlIE9yYWNsZSdzIDxjb2RlPnB1dENoYXJzPC9jb2RlPiBtZXRob2Qgb24g\ndGhlIGdpdmVuIENMT0IKICAgICAqIG9iamVjdC4gVXNlcyByZWZsZWN0aW9u\nIGluIGNhc2UgdGhlIGNsb2IgaXMgd3JhcHBlZCBpbiBhbm90aGVyCiAgICAg\nKiB2ZW5kb3Itc3BlY2lmaWMgY2xhc3M7IGZvciBleGFtcGxlIFdlYmxvZ2lj\nIHdyYXBzIG9yYWNsZSB0aGluIGRyaXZlcgogICAgICogbG9icyBpbiBpdHMg\nb3duIGludGVyZmFjZXMgd2l0aCB0aGUgc2FtZSBtZXRob2RzLgogICAgICov\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHB1dENoYXJzKENsb2Ig\nY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF9wdXRDaGFycyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0Q2hhcnMgPSBjbG9iLmdl\ndENsYXNzKCkuZ2V0TWV0aG9kKCJwdXRDaGFycyIsCiAgICAgICAgICAgICAg\nICAgICAgbmV3IENsYXNzW117IGxvbmcuY2xhc3MsIGNoYXJbXS5jbGFzcyB9\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBpbnZva2VQdXRMb2JNZXRob2Qo\nX3B1dENoYXJzLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEludm9rZSB0aGUgZ2l2ZW4gTE9CIG1ldGhvZCBvbiB0aGUgZ2l2ZW4gdGFy\nZ2V0IHdpdGggdGhlIGdpdmVuIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIHZvaWQgaW52b2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRob2Qs\nIE9iamVjdCB0YXJnZXQsCiAgICAgICAgT2JqZWN0IGRhdGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgbWV0aG9kLmludm9rZSh0YXJnZXQsIG5ldyBPYmplY3RbXXsgTnVtYmVy\ncy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgICAgICB9IGNhdGNoIChJbnZv\nY2F0aW9uVGFyZ2V0RXhjZXB0aW9uIGl0ZSkgewogICAgICAgICAgICBUaHJv\nd2FibGUgdCA9IGl0ZS5nZXRUYXJnZXRFeGNlcHRpb24oKTsKICAgICAgICAg\nICAgaWYgKHQgaW5zdGFuY2VvZiBTUUxFeGNlcHRpb24pCiAgICAgICAgICAg\nICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIHQ7CiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbih0KTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRp\nb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgQ2xvYiBnZXRF\nbXB0eUNsb2IoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChFTVBUWV9DTE9CICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBFTVBUWV9DTE9COwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBFTVBUWV9DTE9CID0gKENsb2IpIENsYXNzLmZvck5hbWUoIm9yYWNsZS5z\ncWwuQ0xPQiIsdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5nZXRDb250ZXh0Q2xhc3NMb2FkZXJBY3Rp\nb24oKSkpLgogICAgICAgICAgICAgICAgZ2V0TWV0aG9kKCJlbXB0eV9sb2Ii\nLCBuZXcgQ2xhc3NbMF0pLgogICAgICAgICAgICAgICAgaW52b2tlKG51bGws\nIG5ldyBPYmplY3RbMF0pOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24oZS5nZXRN\nZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIEJsb2Ig\nZ2V0RW1wdHlCbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoRU1QVFlfQkxPQiAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfQkxPQjsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gRU1QVFlfQkxPQiA9IChCbG9iKSBDbGFzcy5mb3JOYW1lKCJvcmFj\nbGUuc3FsLkJMT0IiLHRydWUsIAogICAgICAgICAgICAgICAgICAgIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29udGV4dENsYXNzTG9hZGVy\nQWN0aW9uKCkpKS4KICAgICAgICAgICAgICAgIGdldE1ldGhvZCgiZW1wdHlf\nbG9iIiwgbmV3IENsYXNzWzBdKS4KICAgICAgICAgICAgICAgIGludm9rZShu\ndWxsLCBuZXcgT2JqZWN0WzBdKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGUu\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBpc09yYWNsZVByZXBhcmVkU3RhdGVtZW50KFN0YXRl\nbWVudCBzdG1udCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuamRiYy5PcmFjbGVQcmVwYXJlZFN0\nYXRlbWVudCIpLgogICAgICAgICAgICAgICAgaXNJbnN0YW5jZShzdG1udCk7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBJZiB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgWE1MIHR5cGUsCiAg\nICAgKiB1c2UgdGhpcyBtZXRob2QgdG8gYXBwZW5kIHhtbCBwcmVkaWNhdGUu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8g\nd3JpdGUgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29t\ncGFyaXNvbiBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxo\ncyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24KICAgICAq\nIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFy\naXNvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRYbWxDb21wYXJp\nc29uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhz\nLAogICAgICAgIEZpbHRlclZhbHVlIHJocywgYm9vbGVhbiBsaHN4bWwsIGJv\nb2xlYW4gcmhzeG1sKSB7CiAgICAgICAgc3VwZXIuYXBwZW5kWG1sQ29tcGFy\naXNvbihidWYsIG9wLCBsaHMsIHJocywgbGhzeG1sLCByaHN4bWwpOwogICAg\nICAgIGlmIChsaHN4bWwgJiYgcmhzeG1sKQogICAgICAgICAgICBhcHBlbmRY\nbWxDb21wYXJpc29uMihidWYsIG9wLCBsaHMsIHJocyk7CiAgICAgICAgZWxz\nZSBpZiAobGhzeG1sKQogICAgICAgICAgICBhcHBlbmRYbWxDb21wYXJpc29u\nMShidWYsIG9wLCBsaHMsIHJocyk7CiAgICAgICAgZWxzZSAKICAgICAgICAg\nICAgYXBwZW5kWG1sQ29tcGFyaXNvbjEoYnVmLCBvcCwgcmhzLCBsaHMpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIEFwcGVuZCBhbiB4bWwgY29tcGFy\naXNvbiBwcmVkaWNhdGUKICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBT\nUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFy\nYW0gb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAg\nICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21w\nYXJpc29uIChtYXBzIHRvIHhtbCBjb2x1bW4pCiAgICAgKiBAcGFyYW0gcmhz\nIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24xKFNRTEJ1\nZmZlciBidWYsIFN0cmluZyBvcCwKICAgICAgICBGaWx0ZXJWYWx1ZSBsaHMs\nIEZpbHRlclZhbHVlIHJocykgewogICAgICAgIGFwcGVuZFhtbEV4dHJhY3RW\nYWx1ZShidWYsIGxocyk7CiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVu\nZChvcCkuYXBwZW5kKCIgIik7CiAgICAgICAgcmhzLmFwcGVuZFRvKGJ1Zik7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQXBwZW5kIGFuIHhtbCBjb21w\nYXJpc29uIHByZWRpY2F0ZSAoYm90aCBvcGVyYW5kcyBtYXAgdG8geG1sIGNv\nbHVtbikKICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVy\nIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFyYW0gb3AgdGhl\nIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAgICAqIEBwYXJh\nbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uICht\nYXBzIHRvIHhtbCBjb2x1bW4pCiAgICAgKiBAcGFyYW0gcmhzIHRoZSByaWdo\ndCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8geG1sIGNv\nbHVtbikKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFwcGVuZFhtbENvbXBh\ncmlzb24yKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgCiAgICAgICAgRmls\ndGVyVmFsdWUgbGhzLCBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBhcHBl\nbmRYbWxFeHRyYWN0VmFsdWUoYnVmLCBsaHMpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwogICAgICAgIGFwcGVu\nZFhtbEV4dHJhY3RWYWx1ZShidWYsIHJocyk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgdm9pZCBhcHBlbmRYbWxFeHRyYWN0VmFsdWUoU1FMQnVmZmVyIGJ1\nZiwgRmlsdGVyVmFsdWUgdmFsKSB7CiAgICAgICAgYnVmLmFwcGVuZCgiZXh0\ncmFjdFZhbHVlKCIpLgogICAgICAgICAgICBhcHBlbmQodmFsLmdldENvbHVt\nbkFsaWFzKAogICAgICAgICAgICB2YWwuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0\nQ29sdW1ucygpWzBdKSkuCiAgICAgICAgICAgIGFwcGVuZCgiLCcvKi8iKTsK\nICAgICAgICB2YWwuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5k\nKCInKSIpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBpbnNlcnRDbG9i\nRm9yU3RyZWFtaW5nTG9hZChSb3cgcm93LCBDb2x1bW4gY29sLCBPYmplY3Qg\nb2IpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKG9iID09IG51bGwpIHsKICAgICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMu\nT1RIRVIpOwogICAgICAgICAgICByb3cuc2V0TnVsbChjb2wpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHJvdy5zZXRDbG9iKGNvbCwgZ2V0RW1w\ndHlDbG9iKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndEJhdGNoVXBkYXRlQ291bnQoUHJlcGFyZWRTdGF0ZW1lbnQgcHMpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGludCB1cGRhdGVTdWNjZXNzQ250\nID0gMDsKICAgICAgICBpZiAoYmF0Y2hMaW1pdCAhPSAwICYmIHBzICE9IG51\nbGwpIHsKICAgICAgICAgICAgdXBkYXRlU3VjY2Vzc0NudCA9IHBzLmdldFVw\nZGF0ZUNvdW50KCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiYmF0\nY2gtdXBkYXRlLXN1Y2Nlc3MtY291bnQiLAogICAgICAgICAgICAgICAgICAg\nIHVwZGF0ZVN1Y2Nlc3NDbnQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHVwZGF0ZVN1Y2Nlc3NDbnQ7CiAgICB9CiAgICAKICAgIEBPdmVycmlkZQog\nICAgcHJvdGVjdGVkIEJvb2xlYW4gbWF0Y2hFcnJvclN0YXRlKGludCBzdWJ0\neXBlLCBTZXQ8U3RyaW5nPiBlcnJvclN0YXRlcywKICAgICAgICBTUUxFeGNl\ncHRpb24gZXgpIHsKICAgICAgICBCb29sZWFuIHJlY292ZXJhYmxlID0gbnVs\nbDsKICAgICAgICBTdHJpbmcgZXJyb3JTdGF0ZSA9IGV4LmdldFNRTFN0YXRl\nKCk7CiAgICAgICAgaW50IGVycm9yQ29kZSA9IGV4LmdldEVycm9yQ29kZSgp\nOwogICAgICAgIGlmIChlcnJvclN0YXRlcy5jb250YWlucyhlcnJvclN0YXRl\nKSkgewogICAgICAgICAgICByZWNvdmVyYWJsZSA9IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgIGlmICgoc3VidHlwZSA9PSBTdG9yZUV4Y2VwdGlvbi5M\nT0NLKQogICAgICAgICAgICAgICAgJiYgKChlcnJvclN0YXRlLmVxdWFscygi\nNjEwMDAiKSAmJiAoZXJyb3JDb2RlID09IDU0IHx8CiAgICAgICAgICAgICAg\nICAgICAgIGVycm9yQ29kZSA9PSA2MCB8fCBlcnJvckNvZGUgPT0gNDAyMCB8\nfAogICAgICAgICAgICAgICAgICAgICBlcnJvckNvZGUgPT0gNDAyMSB8fCBl\ncnJvckNvZGUgPT0gNDAyMikpCiAgICAgICAgICAgICAgICAgICAgfHwgKGVy\ncm9yU3RhdGUuZXF1YWxzKCI0MjAwMCIpICYmIGVycm9yQ29kZSA9PSAyMDQ5\nKSkpIHsKICAgICAgICAgICAgICAgIHJlY292ZXJhYmxlID0gQm9vbGVhbi5U\nUlVFOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1YnR5cGUgPT0gU3RvcmVF\neGNlcHRpb24uUVVFUlkgJiYKICAgICAgICAgICAgICAgIGVycm9yU3RhdGUu\nZXF1YWxzKCI3MjAwMCIpICYmIGVycm9yQ29kZSA9PSAxMDEzKSB7CiAgICAg\nICAgICAgICAgICByZWNvdmVyYWJsZSA9IEJvb2xlYW4uVFJVRTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVjb3ZlcmFibGU7\nCiAgICB9CiAgICAKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgaW5z\nZXJ0QmxvYkZvclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwg\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3Qgb2IsIFNlbGVjdCBz\nZWwpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChvYiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVzLk9USEVSKTsK\nICAgICAgICAgICAgcm93LnNldE51bGwoY29sKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICByb3cuc2V0QmxvYihjb2wsIGdldEVtcHR5QmxvYigp\nKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

