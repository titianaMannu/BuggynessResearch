{"sha":"04cb56fef600e1b73d671692559b3c1a255668fb","node_id":"MDQ6QmxvYjIwNjM2NDowNGNiNTZmZWY2MDBlMWI3M2Q2NzE2OTI1NTliM2MxYTI1NTY2OGZi","size":15562,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/04cb56fef600e1b73d671692559b3c1a255668fb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLlJlbGF0aW9uSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0\nYXRlRXhjZXB0aW9uOwoKLyoqCiAqIFByaW1hcnkgdGFibGUgcm93IHRoYXQg\ndHJhY2tzIGZvcmVpZ24ga2V5cyBhbmQgYXV0by1pbmMgY29sdW1ucy4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGlj\nIGNsYXNzIFByaW1hcnlSb3cKICAgIGV4dGVuZHMgUm93SW1wbCB7CgogICAg\nLy8gVkFMSUQgZmxhZyBpbiBzdXBlcmNsYXNzIHVzZXMgMiA8PCAwCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBieXRlIFBLX1NFVCA9IDIgPDwgMTsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGJ5dGUgUEtfV0hFUkUgPSAyIDw8IDI7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBieXRlIERFUEVOREVOVCA9IDIg\nPDwgNDsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFByaW1hcnlSb3cu\nY2xhc3MpOwoKICAgIHByaXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlciBfcGsg\nPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5JTyBfcGtJTyA9IG51bGw7CiAg\nICBwcml2YXRlIE9wZW5KUEFTdGF0ZU1hbmFnZXJbXSBfZmtTZXQgPSBudWxs\nOwogICAgcHJpdmF0ZSBDb2x1bW5JT1tdIF9ma0lPID0gbnVsbDsKICAgIHBy\naXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlcltdIF9ma1doZXJlID0gbnVsbDsK\nICAgIHByaXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlcltdIF9yZWxTZXQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBSZWxhdGlvbklkW10gX2NhbGxiYWNrcyA9IG51\nbGw7CiAgICBwcml2YXRlIE9iamVjdCBfZmFpbGVkID0gbnVsbDsKICAgIHBy\naXZhdGUgaW50IF9pZHggPSAtMTsKCiAgICAvKioKICAgICAqIENvbnN0cnVj\ndG9yOyBzdXBwbHkgdGFibGUgYW5kIGFjdGlvbi4KICAgICAqLwogICAgcHVi\nbGljIFByaW1hcnlSb3coVGFibGUgdGFibGUsIGludCBhY3Rpb24sIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgb3duZXIpIHsKICAgICAgICB0aGlzKHRhYmxlLmdl\ndENvbHVtbnMoKSwgYWN0aW9uLCBvd25lcik7CiAgICB9CgogICAgcHJvdGVj\ndGVkIFByaW1hcnlSb3coQ29sdW1uW10gY29scywgaW50IGFjdGlvbiwgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBvd25lcikgewogICAgICAgIHN1cGVyKGNvbHMs\nIGFjdGlvbik7CiAgICAgICAgX3BrID0gb3duZXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYXJrIHRoaXMgcm93IGFzIGRlcGVuZGVudCBvbiBzb21lIG90\naGVyIHJvdy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZXBlbmRl\nbnQoKSB7CiAgICAgICAgcmV0dXJuIChmbGFncyAmIERFUEVOREVOVCkgPiAw\nOwogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGlzIHJvdyBhcyBkZXBl\nbmRlbnQgb24gc29tZSBvdGhlciByb3cuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERlcGVuZGVudChib29sZWFuIGRlcGVuZGVudCkgewogICAgICAg\nIGlmIChkZXBlbmRlbnQpCiAgICAgICAgICAgIGZsYWdzIHw9IERFUEVOREVO\nVDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZsYWdzICY9IH5ERVBFTkRF\nTlQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggb2YgdGhpcyBy\nb3cgaW4gb3JkZXJlZCByb3cgbGlzdC4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2lkeDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBpbmRleCBvZiB0aGlzIHJvdyBpbiBvcmRlcmVk\nIHJvdyBsaXN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRleChp\nbnQgaWR4KSB7CiAgICAgICAgX2lkeCA9IGlkeDsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEZhaWxlZE9iamVjdCgpIHsKICAgICAgICByZXR1cm4g\nX2ZhaWxlZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGYWlsZWRPYmpl\nY3QoT2JqZWN0IGZhaWxlZCkgewogICAgICAgIF9mYWlsZWQgPSBmYWlsZWQ7\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0UHJp\nbWFyeUtleSgpIHsKICAgICAgICByZXR1cm4gX3BrOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFByaW1hcnlLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRQ\ncmltYXJ5S2V5KG51bGwsIHNtKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRQcmltYXJ5S2V5KENvbHVtbklPIGlvLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKSB7CiAgICAgICAgX3BrID0gc207CiAgICAgICAgZmxhZ3MgfD0gUEtf\nU0VUOwogICAgICAgIF9wa0lPID0gaW87CgogICAgICAgIC8vIGZvcmNlIHZh\nbGlkCiAgICAgICAgc2V0VmFsaWQodHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX3BrID0g\nc207CiAgICAgICAgZmxhZ3MgfD0gUEtfV0hFUkU7CgogICAgICAgIC8vIGZv\ncmNlIHZhbGlkCiAgICAgICAgaWYgKGdldEFjdGlvbigpID09IEFDVElPTl9E\nRUxFVEUpCiAgICAgICAgICAgIHNldFZhbGlkKHRydWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBJL08gaW5mb3JtYXRpb24gZm9yIHRo\nZSBnaXZlbiBzZXQgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2x1bW5JTyBnZXRGb3JlaWduS2V5SU8oRm9yZWlnbktleSBmaykgewogICAg\nICAgIHJldHVybiAoX2ZrSU8gPT0gbnVsbCkgPyBudWxsIDogX2ZrSU9bZmsu\nZ2V0SW5kZXgoKV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZhbHVlIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkuIFZhbHVlcyBub3Qg\nbmVlZGVkIGZvcgogICAgICogY29uc3RyYWludCBhbmFseXNlcyBhcmUgbm90\nIHJlY29yZGVkLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFu\nYWdlciBnZXRGb3JlaWduS2V5U2V0KEZvcmVpZ25LZXkgZmspIHsKICAgICAg\nICByZXR1cm4gKF9ma1NldCA9PSBudWxsKSA/IG51bGwgOiBfZmtTZXRbZmsu\nZ2V0SW5kZXgoKV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZhbHVlIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkuIFZhbHVlcyBub3Qg\nbmVlZGVkIGZvcgogICAgICogY29uc3RyYWludCBhbmFseXNlcyBhcmUgbm90\nIHJlY29yZGVkLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFu\nYWdlciBnZXRGb3JlaWduS2V5V2hlcmUoRm9yZWlnbktleSBmaykgewogICAg\nICAgIHJldHVybiAoX2ZrV2hlcmUgPT0gbnVsbCkgPyBudWxsIDogX2ZrV2hl\ncmVbZmsuZ2V0SW5kZXgoKV07CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndEZvcmVpZ25LZXkoZmssIG51bGwsIHNtKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIENvbHVtbklPIGlv\nLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFkZWxheUZvcmVpZ25L\nZXkoZmssIHNtLCB0cnVlKSkKICAgICAgICAgICAgc3VwZXIuc2V0Rm9yZWln\nbktleShmaywgaW8sIHNtKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJl\nY29yZEZvcmVpZ25LZXkoZmssIGlvLCBzbSwgdHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKCFkZWxheUZvcmVpZ25LZXkoZmssIHNtLCBm\nYWxzZSkpCiAgICAgICAgICAgIHN1cGVyLndoZXJlRm9yZWlnbktleShmaywg\nc20pOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVjb3JkRm9yZWlnbktl\neShmaywgbnVsbCwgc20sIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBjbGVhckZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5jbGVhckZvcmVpZ25L\nZXkoZmspOwogICAgICAgIGlmIChfZmtTZXQgIT0gbnVsbCkKICAgICAgICAg\nICAgX2ZrU2V0W2ZrLmdldEluZGV4KCldID0gbnVsbDsKICAgICAgICBpZiAo\nX2ZrSU8gIT0gbnVsbCkKICAgICAgICAgICAgX2ZrSU9bZmsuZ2V0SW5kZXgo\nKV0gPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhpcyBpcyBh\nIGRlbGV0ZSwgZGVsYXkgZm9yZWlnbiBrZXlzIHRvIG90aGVyIGRlbGV0ZWQg\nb2JqZWN0cyBpZiB0aGUgCiAgICAgKiBrZXkgaXMgcmVzdHJpY3RlZCBvciBj\nYXNjYWRlLiBJZiB0aGlzIGlzIGFuIHVwZGF0ZSBvciBpbnNlcnQsIGRlbGF5\nIAogICAgICogZm9yZWlnbiBrZXlzIHRvIG90aGVyIGluc2VydHMgaWYgdGhl\nIGtleSBpcyBub3QgbG9naWNhbC4gSWYgdGhlIGZvcmVpZ24gCiAgICAgKiBr\nZXkgaXMgdG8gYSBuZXcgcmVjb3JkIGFuZCB0aGUgY29sdW1ucyBhcmUgYXV0\nby1pbmMsIHJlY29yZCBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGRlbGF5Rm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLAogICAgICAgIGJvb2xlYW4gc2V0KSB7CiAgICAgICAgaWYg\nKHNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgaWYgKGdldEFjdGlvbigpID09IEFDVElPTl9ERUxFVEUpCiAgICAgICAg\nICAgIHJldHVybiBzbS5pc0RlbGV0ZWQoKSAmJiAhZmsuaXNEZWZlcnJlZCgp\nCiAgICAgICAgICAgICAgICAmJiAoZmsuZ2V0RGVsZXRlQWN0aW9uKCkgPT0g\nRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1QgfHwKICAgICAgICAgICAgICAg\nICAgICBmay5nZXREZWxldGVBY3Rpb24oKSA9PSBGb3JlaWduS2V5LkFDVElP\nTl9DQVNDQURFKTsKCiAgICAgICAgaWYgKCFzbS5pc05ldygpIHx8IHNtLmlz\nRmx1c2hlZCgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\naWYgKCFmay5pc0RlZmVycmVkKCkgJiYgIWZrLmlzTG9naWNhbCgpKQogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZmsuaXNQcmltYXJ5\nS2V5QXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nY29yZCBhIGRlbGF5ZWQgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZWNvcmRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIENvbHVt\nbklPIGlvLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJvb2xl\nYW4gc2V0KSB7CiAgICAgICAgaWYgKHNldCkgewogICAgICAgICAgICAvLyBm\nb3JjZSB2YWxpZAogICAgICAgICAgICBpZiAoY2FuU2V0QW55KGlvLCBmay5n\nZXRDb2x1bW5zKCkubGVuZ3RoCiAgICAgICAgICAgICAgICArIGZrLmdldENv\nbnN0YW50Q29sdW1ucygpLmxlbmd0aCwgZmFsc2UpKQogICAgICAgICAgICAg\nICAgc2V0VmFsaWQodHJ1ZSk7CgogICAgICAgICAgICBpZiAoX2ZrU2V0ID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfZmtTZXQgPSBuZXcgT3BlbkpQQVN0\nYXRlTWFuYWdlcltnZXRUYWJsZSgpLgogICAgICAgICAgICAgICAgICAgIGdl\ndEZvcmVpZ25LZXlzKCkubGVuZ3RoXTsKICAgICAgICAgICAgX2ZrU2V0W2Zr\nLmdldEluZGV4KCldID0gc207CgogICAgICAgICAgICBpZiAoX2ZrSU8gIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9ma0lPW2ZrLmdldEluZGV4KCldID0g\naW87CiAgICAgICAgICAgIGVsc2UgaWYgKGlvICE9IG51bGwgJiYgKChnZXRB\nY3Rpb24oKSA9PSBBQ1RJT05fSU5TRVJUCiAgICAgICAgICAgICAgICAmJiAh\naW8uaXNBbGxJbnNlcnRhYmxlKGZrLCBmYWxzZSkpCiAgICAgICAgICAgICAg\nICB8fCAoZ2V0QWN0aW9uKCkgIT0gQUNUSU9OX0lOU0VSVAogICAgICAgICAg\nICAgICAgJiYgIWlvLmlzQWxsVXBkYXRhYmxlKGZrLCBmYWxzZSkpKSkgewog\nICAgICAgICAgICAgICAgX2ZrSU8gPSBuZXcgQ29sdW1uSU9bX2ZrU2V0Lmxl\nbmd0aF07CiAgICAgICAgICAgICAgICBfZmtJT1tmay5nZXRJbmRleCgpXSA9\nIGlvOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgLy8gZm9yY2UgdmFsaWQKICAgICAgICAgICAgaWYgKGdldEFjdGlvbigp\nID09IEFDVElPTl9ERUxFVEUpCiAgICAgICAgICAgICAgICBzZXRWYWxpZCh0\ncnVlKTsKCiAgICAgICAgICAgIGlmIChfZmtXaGVyZSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgX2ZrV2hlcmUgPSBuZXcgT3BlbkpQQVN0YXRlTWFuYWdl\ncltnZXRUYWJsZSgpLgogICAgICAgICAgICAgICAgICAgIGdldEZvcmVpZ25L\nZXlzKCkubGVuZ3RoXTsKICAgICAgICAgICAgX2ZrV2hlcmVbZmsuZ2V0SW5k\nZXgoKV0gPSBzbTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHJlY29yZGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4gcmVsYXRp\nb24gaWQgY29sdW1uLiBPbmx5CiAgICAgKiB2YWx1ZXMgdGhhdCBhcmUgZGVw\nZW5kZW50IG9uIGEgbmV3LCB1bmZsdXNoZWQgYXV0by1hc3NpZ25lZCBpbnN0\nYW5jZQogICAgICogYXJlIHJlY29yZGVkLgogICAgICovCiAgICBwdWJsaWMg\nT3BlbkpQQVN0YXRlTWFuYWdlciBnZXRSZWxhdGlvbklkU2V0KENvbHVtbiBj\nb2wpIHsKICAgICAgICByZXR1cm4gKF9yZWxTZXQgPT0gbnVsbCkgPyBudWxs\nIDogX3JlbFNldFtnZXRSZWxhdGlvbklkSW5kZXgoY29sKV07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlY29yZGVkIGNhbGxiYWNrcyBm\nb3IgdGhlIGdpdmVuIHJlbGF0aW9uIGlkIGNvbHVtbi4gT25seQogICAgICog\ndmFsdWVzIHRoYXQgYXJlIGRlcGVuZGVudCBvbiBhIG5ldywgdW5mbHVzaGVk\nIGF1dG8tYXNzaWduZWQgaW5zdGFuY2UKICAgICAqIGFyZSByZWNvcmRlZC4K\nICAgICAqLwogICAgcHVibGljIFJlbGF0aW9uSWQgZ2V0UmVsYXRpb25JZENh\nbGxiYWNrKENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gKF9jYWxsYmFj\na3MgPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgIDogX2NhbGxiYWNrc1tn\nZXRSZWxhdGlvbklkSW5kZXgoY29sKV07CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0UmVsYXRpb25JZChDb2x1bW4gY29sLCBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIFJlbGF0aW9uSWQgcmVsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChzbSA9PSBudWxsIHx8IHNt\nLmdldE9iamVjdElkKCkgIT0gbnVsbCB8fCAhc20uaXNOZXcoKQogICAgICAg\nICAgICB8fCBzbS5pc0ZsdXNoZWQoKSB8fCAhaXNQcmltYXJ5S2V5QXV0b0Fz\nc2lnbmVkKHNtKSkKICAgICAgICAgICAgc3VwZXIuc2V0UmVsYXRpb25JZChj\nb2wsIHNtLCByZWwpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAo\nX3JlbFNldCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBDb2x1bW5bXSBj\nb2xzID0gZ2V0VGFibGUoKS5nZXRSZWxhdGlvbklkQ29sdW1ucygpOwogICAg\nICAgICAgICAgICAgX3JlbFNldCA9IG5ldyBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nW2NvbHMubGVuZ3RoXTsKICAgICAgICAgICAgICAgIF9jYWxsYmFja3MgPSBu\nZXcgUmVsYXRpb25JZFtjb2xzLmxlbmd0aF07CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaW50IGlkeCA9IGdldFJlbGF0aW9uSWRJbmRleChjb2wpOwog\nICAgICAgICAgICBfcmVsU2V0W2lkeF0gPSBzbTsKICAgICAgICAgICAgX2Nh\nbGxiYWNrc1tpZHhdID0gcmVsOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBjbGVhclJlbGF0aW9uSWQoQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5jbGVhclJlbGF0\naW9uSWQoY29sKTsKICAgICAgICBpZiAoX3JlbFNldCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGludCBpZHggPSBnZXRSZWxhdGlvbklkSW5kZXgoY29sKTsK\nICAgICAgICAgICAgX3JlbFNldFtpZHhdID0gbnVsbDsKICAgICAgICAgICAg\nX2NhbGxiYWNrc1tpZHhdID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGluZGV4IGludG8gb3VyIHJlbGF0aW9u\nIGlkIGFycmF5IG9mIHRoZSB2YWx1ZSBmb3IgdGhlCiAgICAgKiBnaXZlbiBj\nb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldFJlbGF0aW9uSWRJ\nbmRleChDb2x1bW4gY29sKSB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IGdl\ndFRhYmxlKCkuZ2V0UmVsYXRpb25JZENvbHVtbnMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGlmIChjb2xzW2ldID09IGNvbCkKICAgICAgICAgICAgICAgIHJldHVybiBp\nOwogICAgICAgIHJldHVybiAtMTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0cnVlIGlmIGFueSBwcmltYXJ5IGtleSBjb2x1bW5zIG9mIHRoZSBn\naXZlbiBpbnN0YW5jZSBhcmUKICAgICAqIGF1dG8tYXNzaWduZWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNQcmltYXJ5S2V5QXV0\nb0Fzc2lnbmVkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgY2xzID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURh\ndGEoKTsKICAgICAgICB3aGlsZSAoY2xzLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIGNscyA9IGNscy5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gY2xzLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAoY29sc1tpXS5pc0F1dG9Bc3NpZ25lZCgpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHNldE9iamVjdChDb2x1bW4gY29s\nLCBPYmplY3QgdmFsLCBpbnQgbWV0YVR5cGUsCiAgICAgICAgYm9vbGVhbiBv\ndmVycmlkZURlZmF1bHQpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlJ3JlIG5vdCBzZXR0aW5nIHR3byBk\naWZmZXJlbnQgdmFsdWVzCiAgICAJLy8gdW5sZXNzIHRoZSBnaXZlbiBjb2x1\nbW4gaXMgYW4gaW1wbGljaXQgcmVsYXRpb25zaGlwIGFuZCB2YWx1ZQogICAg\nCS8vIGNoYW5nZXMgZnJvbSBsb2dpY2FsIGRlZmF1bHQgdG8gbm9uLWRlZmF1\nbHQKICAgICAgICBPYmplY3QgcHJldiA9IGdldFNldChjb2wpOwogICAgICAg\nIGlmIChwcmV2ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHByZXYgPT0g\nTlVMTCkKICAgICAgICAgICAgICAgIHByZXYgPSBudWxsOwogICAgICAgICAg\nICBpZiAoIXJvd1ZhbHVlRXF1YWxzKHByZXYsIHZhbCkpIHsKICAgICAgICAg\nICAgCWlmIChhbGxvd3NVcGRhdGUoY29sLCBwcmV2LCB2YWwpKSB7CiAgICAg\nICAgICAgIAkJc3VwZXIuc2V0T2JqZWN0KGNvbCwgdmFsLCBtZXRhVHlwZSwg\nb3ZlcnJpZGVEZWZhdWx0KTsKICAgICAgICAgICAgCX0gZWxzZSBpZiAoIWlz\nRGVmYXVsdFZhbHVlKHZhbCkpIHsKICAgICAgICAgICAgCQl0aHJvdyBuZXcg\nSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJkaWZmLXZhbHVlcyIs\nCiAgICAgICAgICAgIAkJCQluZXcgT2JqZWN0W117IGNvbC5nZXRGdWxsREJJ\nZGVudGlmaWVyKCkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKHByZXYgPT0gbnVsbCkgPyBudWxsIDogcHJldi5nZXRDbGFzcygp\nLCBwcmV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZhbCA9PSBu\ndWxsKSA/IG51bGwgOiB2YWwuZ2V0Q2xhc3MoKSwgdmFsIH0pKS4KICAgICAg\nICAgICAgCQkJCXNldEZhdGFsKHRydWUpOwogICAgICAgICAgICAJfSBlbHNl\nIHsKICAgICAgICAgICAgCSAgICAvLyBzaW5jZSBub3QgYWxsb3cgdG8gdXBk\nYXRlIGFuZCB0aGUgbmV3IHZhbHVlIGlzIDAgb3IgbnVsbCwKICAgICAgICAg\nICAgCSAgICAvLyBqdXN0IHJldHVybi4KICAgICAgICAgICAgCSAgICByZXR1\ncm47CiAgICAgICAgICAgIAl9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgc3VwZXIuc2V0T2JqZWN0KGNvbCwgdmFsLCBtZXRhVHlwZSwgb3Zl\ncnJpZGVEZWZhdWx0KTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBbGxv\ndyB0aGUgZ2l2ZW4gY29sdW1uIHZhbHVlIHRvIGJlIHVwZGF0ZWQgb25seSBp\nZiBvbGQgb3IgY3VycmVudCB2YWx1ZQogICAgICogaXMgYSBkZWZhdWx0IHZh\nbHVlIG9yIHdhcyBub3Qgc2V0IGFuZCB0aGUgY29sdW1uIGlzIG5vdCBhIHBy\naW1hcnkga2V5LgogICAgICovCiAgICBib29sZWFuIGFsbG93c1VwZGF0ZShD\nb2x1bW4gY29sLCBPYmplY3Qgb2xkLCBPYmplY3QgY3VyKSB7CiAgICAJcmV0\ndXJuICgoIWNvbC5pc1ByaW1hcnlLZXkoKSAmJiBjb2wuaXNJbXBsaWNpdFJl\nbGF0aW9uKCkpIHx8CiAgICAJICAgY29sLmlzVW5pMU1GSygpKSAmJiAoaXNE\nZWZhdWx0VmFsdWUob2xkKSk7CiAgICB9CiAgICAKICAgIGJvb2xlYW4gaXNE\nZWZhdWx0VmFsdWUoT2JqZWN0IHZhbCkgewogICAgCXJldHVybiB2YWwgPT0g\nbnVsbCB8fCB2YWwgPT0gTlVMTAogICAgCSAgICB8fCAodmFsIGluc3RhbmNl\nb2YgTnVtYmVyICYmICgoTnVtYmVyKXZhbCkubG9uZ1ZhbHVlKCkgPT0gMCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdHdv\nIHZhbHVlcyBzaG91bGQgYmUgY29uc2lkZXJlZCBlcXVhbC4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiByb3dWYWx1ZUVxdWFscyhPYmpl\nY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgIGlmIChPYmplY3RVdGlscy5l\ncXVhbHMobzEsIG8yKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAg\nICAgIC8vIGNoZWNrIGZvciBudW1lcmljIGVxdWFsaXR5IChidWcgIzExNTEp\nCiAgICAgICAgcmV0dXJuIG8xIGluc3RhbmNlb2YgTnVtYmVyICYmIG8yIGlu\nc3RhbmNlb2YgTnVtYmVyCiAgICAgICAgICAgICYmICgoTnVtYmVyKSBvMSku\nZG91YmxlVmFsdWUoKSA9PSAoKE51bWJlcikgbzIpLmRvdWJsZVZhbHVlKCk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIFN0cmluZyBnZW5lcmF0ZVNRTChEQkRp\nY3Rpb25hcnkgZGljdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICgoZmxhZ3MgJiBQS19TRVQpID4gMCkKICAgICAgICAgICAgICAgIHN1cGVy\nLnNldFByaW1hcnlLZXkoX3BrSU8sIF9wayk7CiAgICAgICAgICAgIGlmICgo\nZmxhZ3MgJiBQS19XSEVSRSkgPiAwKQogICAgICAgICAgICAgICAgc3VwZXIu\nd2hlcmVQcmltYXJ5S2V5KF9wayk7CiAgICAgICAgICAgIGlmIChfZmtTZXQg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9\nIGdldFRhYmxlKCkuZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICAgICAgICAg\nIENvbHVtbklPIGlvOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfZmtTZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2ZrU2V0W2ldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaW8gPSAoX2ZrSU8gPT0gbnVsbCkgPyBudWxsIDogX2ZrSU9baV07\nCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyLnNldEZvcmVpZ25LZXko\nZmtzW2ldLCBpbywgX2ZrU2V0W2ldKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKF9yZWxTZXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29sdW1u\nW10gY29scyA9IGdldFRhYmxlKCkuZ2V0UmVsYXRpb25JZENvbHVtbnMoKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3JlbFNldC5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAoX3JlbFNldFtp\nXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzdXBlci5zZXRS\nZWxhdGlvbklkKGNvbHNbaV0sIF9yZWxTZXRbaV0sIF9jYWxsYmFja3NbaV0p\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfZmtXaGVyZSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gZ2V0\nVGFibGUoKS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfZmtXaGVyZS5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgICAgICBpZiAoX2ZrV2hlcmVbaV0gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgc3VwZXIud2hlcmVGb3JlaWduS2V5KGZrc1tp\nXSwgX2ZrV2hlcmVbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhy\nb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgZGljdCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzdXBlci5nZW5lcmF0ZVNRTChkaWN0KTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgUm93SW1wbCBuZXdJbnN0YW5jZShDb2x1bW5b\nXSBjb2xzLCBpbnQgYWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcmlt\nYXJ5Um93KGNvbHMsIGFjdGlvbiwgX3BrKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjb3B5SW50byhSb3dJbXBsIHJvdywgYm9vbGVhbiB3aGVyZU9ubHkp\nIHsKICAgICAgICBzdXBlci5jb3B5SW50byhyb3csIHdoZXJlT25seSk7CiAg\nICAgICAgaWYgKCEocm93IGluc3RhbmNlb2YgUHJpbWFyeVJvdykpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgUHJpbWFyeVJvdyBwcm93ID0gKFBy\naW1hcnlSb3cpIHJvdzsKICAgICAgICBwcm93Ll9wayA9IF9wazsKICAgICAg\nICBwcm93Ll9wa0lPID0gX3BrSU87CiAgICAgICAgaWYgKChmbGFncyAmIFBL\nX1dIRVJFKSA+IDApCiAgICAgICAgICAgIHByb3cuZmxhZ3MgfD0gUEtfV0hF\nUkU7CiAgICAgICAgaWYgKCF3aGVyZU9ubHkgJiYgKGZsYWdzICYgUEtfU0VU\nKSA+IDApCiAgICAgICAgICAgIHByb3cuZmxhZ3MgfD0gUEtfU0VUOwoKICAg\nICAgICBpZiAoX2ZrV2hlcmUgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\ncHJvdy5fZmtXaGVyZSA9PSBudWxsKQogICAgICAgICAgICAgICAgcHJvdy5f\nZmtXaGVyZSA9IG5ldyBPcGVuSlBBU3RhdGVNYW5hZ2VyW19ma1doZXJlLmxl\nbmd0aF07CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX2ZrV2hlcmUs\nIDAsIHByb3cuX2ZrV2hlcmUsIDAsIF9ma1doZXJlLmxlbmd0aCk7CiAgICAg\nICAgfQogICAgICAgIGlmICghd2hlcmVPbmx5ICYmIF9ma1NldCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChwcm93Ll9ma1NldCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcHJvdy5fZmtTZXQgPSBuZXcgT3BlbkpQQVN0YXRlTWFu\nYWdlcltfZmtTZXQubGVuZ3RoXTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5\nY29weShfZmtTZXQsIDAsIHByb3cuX2ZrU2V0LCAwLCBfZmtTZXQubGVuZ3Ro\nKTsKICAgICAgICAgICAgaWYgKF9ma0lPICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGlmIChwcm93Ll9ma0lPID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgcHJvdy5fZmtJTyA9IG5ldyBDb2x1bW5JT1tfZmtJTy5sZW5ndGhd\nOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShfZmtJTywgMCwg\ncHJvdy5fZmtJTywgMCwgX2ZrSU8ubGVuZ3RoKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBpZiAoIXdoZXJlT25seSAmJiBfcmVsU2V0ICE9\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKHByb3cuX3JlbFNldCA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBwcm93Ll9yZWxTZXQgPSBuZXcgT3BlbkpQ\nQVN0YXRlTWFuYWdlcltfcmVsU2V0Lmxlbmd0aF07CiAgICAgICAgICAgICAg\nICBwcm93Ll9jYWxsYmFja3MgPSBuZXcgUmVsYXRpb25JZFtfY2FsbGJhY2tz\nLmxlbmd0aF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShfcmVsU2V0LCAwLCBwcm93Ll9yZWxTZXQsIDAsIF9yZWxTZXQu\nbGVuZ3RoKTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShfY2FsbGJh\nY2tzLCAwLCBwcm93Ll9jYWxsYmFja3MsIDAsCiAgICAgICAgICAgICAgICBf\nY2FsbGJhY2tzLmxlbmd0aCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

