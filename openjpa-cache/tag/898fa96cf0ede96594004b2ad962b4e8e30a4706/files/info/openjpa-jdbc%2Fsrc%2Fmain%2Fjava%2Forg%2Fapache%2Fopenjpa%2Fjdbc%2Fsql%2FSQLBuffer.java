{"sha":"9d9b150d446bcc74322b312544785affbbb7d010","node_id":"MDQ6QmxvYjIwNjM2NDo5ZDliMTUwZDQ0NmJjYzc0MzIyYjMxMjU0NDc4NWFmZmJiYjdkMDEw","size":22241,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9d9b150d446bcc74322b312544785affbbb7d010","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJs\nZVN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9y\ndCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWw7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVl\nbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRh\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBh\ncmFtZXRlcjsKCmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBC\ndWZmZXIgZm9yIFNRTCBzdGF0ZW1lbnRzIHRoYXQgY2FuIGJlIHVzZWQgdG8g\nY3JlYXRlCiAqIGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50cy4KICogVGhp\ncyBidWZmZXIgaG9sZHMgdGhlIFNRTCBzdGF0ZW1lbnQgcGFyYW1ldGVycyBh\nbmQgdGhlaXIgY29ycmVzcG9uZGluZyAKICogY29sdW1ucy4gVGhlIHBhcmFt\nZXRlcnMgaW50cm9kdWNlZCBieSB0aGUgcnVudGltZSBzeXN0ZW0gYXJlIGRp\nc3Rpbmd1aXNoZWQKICogZnJvbSB0aGUgcGFyYW1ldGVycyBzZXQgYnkgdGhl\nIHVzZXIuICAKICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICog\nQGF1dGhvciBBYmUgV2hpdGUKICogQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAq\nIAogKiBAc2luY2UgMC4yLjQKICovCnB1YmxpYyBmaW5hbCBjbGFzcyBTUUxC\ndWZmZXIKICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlLCBDbG9uZWFibGUg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBQQVJBTUVURVJf\nVE9LRU4gPSAiPyI7CgogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25hcnkg\nX2RpY3Q7CiAgICBwcml2YXRlIGZpbmFsIFN0cmluZ0J1aWxkZXIgX3NxbCA9\nIG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBMaXN0IF9wYXJhbXMgPSBudWxsOwog\nICAgcHJpdmF0ZSBMaXN0IF9jb2xzID0gbnVsbDsKICAgIAogICAgLy8gRXZl\nbiBlbGVtZW50IHJlZmVycyB0byBhbiBpbmRleCBvZiB0aGUgX3BhcmFtcyBs\naXN0CiAgICAvLyBPZGQgZWxlbWVudCByZWZlcnMgdG8gdGhlIHVzZXIgcGFy\nYW1ldGVyIGtleQogICAgcHJpdmF0ZSBMaXN0IF91c2VySW5kZXggPSBudWxs\nOwogICAgCiAgICAvKioKICAgICAqIERlZmF1bHQgY29uc3RydWN0b3IuCiAg\nICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIoREJEaWN0aW9uYXJ5IGRpY3Qp\nIHsKICAgICAgICBfZGljdCA9IGRpY3Q7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb3B5IGNvbnN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVm\nZmVyKFNRTEJ1ZmZlciBidWYpIHsKICAgICAgICBfZGljdCA9IGJ1Zi5fZGlj\ndDsKICAgICAgICBhcHBlbmQoYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBlcmZvcm0gYSBzaGFsbG93IGNsb25lIG9mIHRoaXMgU1FMIEJ1ZmZlci4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBjbG9uZSgpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0cnVlIGlmIHRoZSBidWZmZXIgaXMgZW10cHkuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0\ndXJuIF9zcWwubGVuZ3RoKCkgPT0gMDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFwcGVuZCBhbGwgU1FMIGFuZCBwYXJhbWV0ZXJzIG9mIHRoZSBnaXZlbiBi\ndWZmZXIuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kKFNR\nTEJ1ZmZlciBidWYpIHsKICAgICAgICBhcHBlbmQoYnVmLCBfc3FsLmxlbmd0\naCgpLCAoX3BhcmFtcyA9PSBudWxsKSA/IDAgOiBfcGFyYW1zLnNpemUoKSwK\nICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBcHBlbmQgYWxsIFNRTCBhbmQgcGFyYW1ldGVy\ncyBvZiB0aGUgZ2l2ZW4gYnVmZmVyIGF0IHRoZSBnaXZlbiBwb3NpdGlvbnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmQoU1FMQnVmZmVyIGJ1\nZiwgaW50IHNxbEluZGV4LCBpbnQgcGFyYW1JbmRleCwKICAgICAgICBib29s\nZWFuIHN1YnNlbHMpIHsKICAgICAgICBpZiAoc3Vic2VscykgewogICAgICAg\nICAgICAvLyBvbmx5IGFsbG93IGFwcGVuZGluZyBvZiBidWZmZXJzIHdpdGgg\nc3Vic2VsZWN0cywgbm90IGluc2VydGlvbgogICAgICAgICAgICBpZiAoX3N1\nYnNlbHMgIT0gbnVsbCAmJiAhX3N1YnNlbHMuaXNFbXB0eSgpCiAgICAgICAg\nICAgICAgICAmJiBzcWxJbmRleCAhPSBfc3FsLmxlbmd0aCgpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwog\nICAgICAgICAgICBpZiAoYnVmLl9zdWJzZWxzICE9IG51bGwgJiYgIWJ1Zi5f\nc3Vic2Vscy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIGlmIChzcWxJ\nbmRleCAhPSBfc3FsLmxlbmd0aCgpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nICAgIGlmIChfc3Vic2VscyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9zdWJzZWxzID0gbmV3IEFycmF5TGlzdChidWYuX3N1YnNlbHMuc2l6ZSgp\nKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYnVmLl9z\ndWJzZWxzLnNpemUoKTsgaSsrKQogICAgICAgICAgICAgICAgICAgIF9zdWJz\nZWxzLmFkZCgoKFN1YnNlbGVjdCkgYnVmLl9zdWJzZWxzLmdldChpKSkuCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNsb25lKHNxbEluZGV4LCBwYXJhbUlu\nZGV4KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChz\ncWxJbmRleCA9PSBfc3FsLmxlbmd0aCgpKQogICAgICAgICAgICBfc3FsLmFw\ncGVuZChidWYuX3NxbC50b1N0cmluZygpKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9zcWwuaW5zZXJ0KHNxbEluZGV4LCBidWYuX3NxbC50b1N0cmlu\nZygpKTsKCiAgICAgICAgaWYgKGJ1Zi5fcGFyYW1zICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF9wYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9wYXJhbXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIGlmIChf\nY29scyA9PSBudWxsICYmIGJ1Zi5fY29scyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBfY29scyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nICAgIHdoaWxlIChfY29scy5zaXplKCkgPCBfcGFyYW1zLnNpemUoKSkKICAg\nICAgICAgICAgICAgICAgICBfY29scy5hZGQobnVsbCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4ID09IF9wYXJhbXMuc2l6\nZSgpKSB7CiAgICAgICAgICAgICAgICBfcGFyYW1zLmFkZEFsbChidWYuX3Bh\ncmFtcyk7CiAgICAgICAgICAgICAgICBpZiAoYnVmLl9jb2xzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgX2NvbHMuYWRkQWxsKGJ1Zi5fY29scyk7\nCiAgICAgICAgICAgICAgICBlbHNlIGlmIChfY29scyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIHdoaWxlIChfY29scy5zaXplKCkgPCBfcGFyYW1z\nLnNpemUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbHMuYWRkKG51\nbGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3Bh\ncmFtcy5hZGRBbGwocGFyYW1JbmRleCwgYnVmLl9wYXJhbXMpOwogICAgICAg\nICAgICAgICAgaWYgKGJ1Zi5fY29scyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIF9jb2xzLmFkZEFsbChwYXJhbUluZGV4LCBidWYuX2NvbHMpOwog\nICAgICAgICAgICAgICAgZWxzZSBpZiAoX2NvbHMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICB3aGlsZSAoX2NvbHMuc2l6ZSgpIDwgX3BhcmFtcy5z\naXplKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIF9jb2xzLmFkZChwYXJh\nbUluZGV4LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBpZiAoYnVmLl91c2VySW5kZXggIT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoX3VzZXJJbmRleCA9PSBudWxsKQogICAgICAgICAgICAgICAgX3VzZXJJ\nbmRleCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBidWYuX3VzZXJJbmRleC5zaXplKCk7IGkrPTIpIHsKICAg\nICAgICAgICAgICAgIGludCBuZXdJbmRleCA9ICgoSW50ZWdlcilidWYuX3Vz\nZXJJbmRleC5nZXQoaSkpLmludFZhbHVlKCkgCiAgICAgICAgICAgICAgICAg\nICAgKyBwYXJhbUluZGV4OwogICAgICAgICAgICAgICAgT2JqZWN0IHVzZXJQ\nYXJhbSA9IGJ1Zi5fdXNlckluZGV4LmdldChpKzEpOwogICAgICAgICAgICAg\nICAgX3VzZXJJbmRleC5hZGQobmV3SW5kZXgpOwogICAgICAgICAgICAgICAg\nX3VzZXJJbmRleC5hZGQodXNlclBhcmFtKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSB7IAogICAgICAgICAgICBpZiAoX3VzZXJJbmRleCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBMaXN0IHVzZXJJbmRleCA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgX3VzZXJJbmRleC5zaXplKCk7IGkrPTIpIHsKICAgICAgICAgICAgICAg\nICAgICBpbnQgb2xkSW5kZXggPSAoKEludGVnZXIpX3VzZXJJbmRleC5nZXQo\naSkpLmludFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IHVz\nZXJQYXJhbSA9IF91c2VySW5kZXguZ2V0KGkrMSk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKG9sZEluZGV4ID49IHBhcmFtSW5kZXgpIAogICAgICAgICAg\nICAgICAgICAgICAgICB1c2VySW5kZXguYWRkKG9sZEluZGV4ICsgcGFyYW1J\nbmRleCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAg\nICAgICAgICAgICAgdXNlckluZGV4LmFkZChvbGRJbmRleCk7CiAgICAgICAg\nICAgICAgICAgICAgdXNlckluZGV4LmFkZCh1c2VyUGFyYW0pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgX3VzZXJJbmRleCA9IHVzZXJJ\nbmRleDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAg\ncHVibGljIFNRTEJ1ZmZlciBhcHBlbmQoREJJZGVudGlmaWVyIG5hbWUpIHsK\nICAgICAgICBfc3FsLmFwcGVuZChfZGljdC50b0RCTmFtZShuYW1lKSk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciBhcHBlbmQoVGFibGUgdGFibGUpIHsKICAgICAgICBfc3FsLmFwcGVuZChf\nZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChT\nZXF1ZW5jZSBzZXEpIHsKICAgICAgICBfc3FsLmFwcGVuZChfZGljdC5nZXRG\ndWxsTmFtZShzZXEpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChDb2x1bW4gY29sKSB7CiAgICAg\nICAgX3NxbC5hcHBlbmQoX2RpY3QuZ2V0Q29sdW1uREJOYW1lKGNvbCkpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZm\nZXIgYXBwZW5kKFN0cmluZyBzKSB7CiAgICAgICAgX3NxbC5hcHBlbmQocyk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgYSBzdWJzZWxlY3QuIFRoaXMgZGVsYXlzIHJlc29sdXRpb24gb2Yg\ndGhlIHNlbGVjdCBTUUwuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\nYXBwZW5kKFNlbGVjdCBzZWwsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gpIHsKICAgICAgICByZXR1cm4gYXBwZW5kKHNlbCwgZmV0Y2gsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHN1YnNlbGVjdCBj\nb3VudC4gVGhpcyBkZWxheXMgcmVzb2x1dGlvbiBvZiB0aGUgc2VsZWN0IFNR\nTC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRDb3VudChT\nZWxlY3Qgc2VsLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgcmV0dXJuIGFwcGVuZChzZWwsIGZldGNoLCB0cnVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHN1YnNlbGVjdC4gVGhpcyBkZWxh\neXMgcmVzb2x1dGlvbiBvZiB0aGUgc2VsZWN0IFNRTC4KICAgICAqLwogICAg\ncHJpdmF0ZSBTUUxCdWZmZXIgYXBwZW5kKFNlbGVjdCBzZWwsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgYm9vbGVhbiBjb3VudCkg\newogICAgICAgIF9zcWwuYXBwZW5kKCIoIik7CiAgICAgICAgU3Vic2VsZWN0\nIHN1YiA9IG5ldyBTdWJzZWxlY3QoKTsKICAgICAgICBzdWIuc2VsZWN0ID0g\nc2VsOwogICAgICAgIHN1Yi5mZXRjaCA9IGZldGNoOwogICAgICAgIHN1Yi5j\nb3VudCA9IGNvdW50OwogICAgICAgIHN1Yi5zcWxJbmRleCA9IF9zcWwubGVu\nZ3RoKCk7CiAgICAgICAgc3ViLnBhcmFtSW5kZXggPSAoX3BhcmFtcyA9PSBu\ndWxsKSA/IDAgOiBfcGFyYW1zLnNpemUoKTsKICAgICAgICBfc3FsLmFwcGVu\nZCgiKSIpOwoKICAgICAgICBpZiAoX3N1YnNlbHMgPT0gbnVsbCkKICAgICAg\nICAgICAgX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0KDIpOwogICAgICAgIF9z\ndWJzZWxzLmFkZChzdWIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVwbGFjZSBhIHN1YnNlbGVjdC4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gcmVwbGFjZShTZWxlY3Qgb2xkLCBTZWxlY3Qg\nc2VsKSB7CiAgICAgICAgaWYgKF9zdWJzZWxzID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBTdWJzZWxlY3Qgc3ViOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgc3ViID0gKFN1YnNlbGVjdCkgX3N1YnNlbHMuZ2V0\nKGkpOwogICAgICAgICAgICBpZiAoc3ViLnNlbGVjdCA9PSBvbGQpIHsKICAg\nICAgICAgICAgICAgIHN1Yi5zZWxlY3QgPSBzZWw7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQg\nYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZm\nZXIgYXBwZW5kVmFsdWUoT2JqZWN0IG8pIHsKICAgICAgICByZXR1cm4gYXBw\nZW5kVmFsdWUobywgbnVsbCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nQXBwZW5kIGEgc3lzdGVtIGluc2VydGVkIHBhcmFtZXRlciB2YWx1ZSBmb3Ig\nYSBzcGVjaWZpYyBjb2x1bW4uCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZm\nZXIgYXBwZW5kVmFsdWUoT2JqZWN0IG8sIENvbHVtbiBjb2wpIHsKICAgICAg\nICByZXR1cm4gYXBwZW5kVmFsdWUobywgY29sLCBudWxsKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBBcHBlbmQgYSB1c2VyIHBhcmFtZXRlciB2YWx1\nZSBmb3IgYSBzcGVjaWZpYyBjb2x1bW4uIFVzZXIgcGFyYW1ldGVycwogICAg\nICogYXJlIG1hcmtlZCBhcyBvcHBvc2VkIHRvIHRoZSBwYXJhbWV0ZXJzIGlu\nc2VydGVkIGJ5IHRoZSBpbnRlcm5hbCBydW50aW1lCiAgICAgKiBzeXN0ZW0u\nIFRoaXMgaGVscHMgdG8gcmV1c2UgdGhlIGJ1ZmZlciBieSByZXBhcm1ldGVy\naXppbmcgaXQgd2l0aCBuZXcKICAgICAqIHNldCBvZiB1c2VyIHBhcmFtZXRl\ncnMgd2hpbGUgdGhlICdpbnRlcm5hbCcgcGFyYW1ldGVycyByZW1haW4gdW5j\naGFuZ2VkLgogICAgICogCiAgICAgKiBAcGFyYW0gdXNlclBhcmFtIGlmIG5v\nbi1udWxsLCBkZXNpZ25hdGVzIGEgJ3VzZXInIHBhcmFtZXRlci4KICAgICAq\nLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShPYmplY3Qgbywg\nQ29sdW1uIGNvbCwgUGFyYW1ldGVyIHVzZXJQYXJhbSkgewogICAgICAgIGlm\nIChvID09IG51bGwpCiAgICAgICAgICAgIF9zcWwuYXBwZW5kKCJOVUxMIik7\nCiAgICAgICAgZWxzZSBpZiAobyBpbnN0YW5jZW9mIFJhdykKICAgICAgICAg\nICAgX3NxbC5hcHBlbmQoby50b1N0cmluZygpKTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgX3NxbC5hcHBlbmQoUEFSQU1FVEVSX1RPS0VOKTsKCiAg\nICAgICAgICAgIC8vIGluaXRpYWxpemUgcGFyYW0gYW5kIGNvbCBsaXN0czsg\nd2UgaG9sZCBvZmYgb24gY29sIGxpc3QgdW50aWwKICAgICAgICAgICAgLy8g\nd2UgZ2V0IHRoZSBmaXJzdCBub24tbnVsbCBjb2wKICAgICAgICAgICAgaWYg\nKF9wYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wYXJhbXMgPSBu\nZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIGlmIChjb2wgIT0gbnVsbCAm\nJiBfY29scyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBfY29scyA9IG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIHdoaWxlIChfY29scy5z\naXplKCkgPCBfcGFyYW1zLnNpemUoKSkKICAgICAgICAgICAgICAgICAgICBf\nY29scy5hZGQobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9w\nYXJhbXMuYWRkKG8pOwogICAgICAgICAgICBpZiAodXNlclBhcmFtICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmIChfdXNlckluZGV4ID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgX3VzZXJJbmRleCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgICAgIGludCBpbmRleCA9IF9wYXJhbXMuc2l6\nZSgpLTE7CiAgICAgICAgICAgICAgICBfdXNlckluZGV4LmFkZChpbmRleCk7\nCiAgICAgICAgICAgICAgICBfdXNlckluZGV4LmFkZCh1c2VyUGFyYW0uZ2V0\nUGFyYW1ldGVyS2V5KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChfY29scyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NvbHMuYWRkKGNv\nbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICov\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGJvb2xlYW4gYikg\newogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShiLCBudWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShib29sZWFu\nIGIsIENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUo\nKGIpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSwgY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4K\nICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShieXRl\nIGIpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUoYiwgbnVsbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUu\nCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoYnl0\nZSBiLCBDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIGFwcGVuZFZhbHVl\nKG5ldyBCeXRlKGIpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogQXBw\nZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIGFwcGVuZFZhbHVlKGNoYXIgYykgewogICAgICAgIHJldHVybiBh\ncHBlbmRWYWx1ZShjLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFw\ncGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciBhcHBlbmRWYWx1ZShjaGFyIGMsIENvbHVtbiBjb2wpIHsKICAg\nICAgICByZXR1cm4gYXBwZW5kVmFsdWUobmV3IENoYXJhY3RlcihjKSwgY29s\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2\nYWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1\nZShkb3VibGUgZCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShkLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRl\nciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRW\nYWx1ZShkb3VibGUgZCwgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBh\ncHBlbmRWYWx1ZShuZXcgRG91YmxlKGQpLCBjb2wpOwogICAgfQoKICAgIC8q\nKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGZsb2F0IGYpIHsKICAg\nICAgICByZXR1cm4gYXBwZW5kVmFsdWUoZiwgbnVsbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoZmxvYXQgZiwgQ29s\ndW1uIGNvbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShuZXcgRmxv\nYXQoZiksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBw\nYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\nYXBwZW5kVmFsdWUoaW50IGkpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFs\ndWUoaSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBw\nYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\nYXBwZW5kVmFsdWUoaW50IGksIENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1\ncm4gYXBwZW5kVmFsdWUoTnVtYmVycy52YWx1ZU9mKGkpLCBjb2wpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgog\nICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGxvbmcg\nbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShsLCBudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4K\nICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShsb25n\nIGwsIENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUo\nTnVtYmVycy52YWx1ZU9mKGwpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJs\naWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKHNob3J0IHMpIHsKICAgICAgICBy\nZXR1cm4gYXBwZW5kVmFsdWUocywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1\nYmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoc2hvcnQgcywgQ29sdW1uIGNv\nbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShuZXcgU2hvcnQocyks\nIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxpc3Qg\nb2YgcGFyYW1ldGVyIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIExpc3Qg\nZ2V0UGFyYW1ldGVycygpIHsKICAgICAgICByZXR1cm4gKF9wYXJhbXMgPT0g\nbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUIDogX3BhcmFtczsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXQgdGhlIHVzZXIgcGFyYW1ldGVy\nIHBvc2l0aW9ucyBpbiB0aGUgbGlzdCBvZiBwYXJhbWV0ZXJzLiBUaGUgb2Rk\nIAogICAgICogZWxlbWVudCBvZiB0aGUgcmV0dXJuZWQgbGlzdCBjb250YWlu\ncyBhbiBpbnRlZ2VyIGluZGV4IHRoYXQgcmVmZXJzCiAgICAgKiB0byB0aGUg\ncG9zaXRpb24gaW4gdGhlIHtAbGluayAjZ2V0UGFyYW1ldGVycygpfSBsaXN0\nLiBUaGUgZXZlbiBlbGVtZW50CiAgICAgKiBvZiB0aGUgcmV0dXJuZWQgbGlz\ndCByZWZlcnMgdG8gdGhlIHVzZXIgcGFyYW1ldGVyIGtleS4gCiAgICAgKiBU\naGlzIHN0cnVjdHVyZSBpcyBwcmVmZXJyZWQgb3ZlciBhIG5vcm1hbCBtYXAg\nYmVjYXVzZSBhIHVzZXIgcGFyYW1ldGVyIAogICAgICogbWF5IG9jY3VyIG1v\ncmUgdGhhbiBvbmUgaW4gdGhlIHBhcmFtZXRlcnMuIAogICAgICovCiAgICBw\ndWJsaWMgTGlzdCBnZXRVc2VyUGFyYW1ldGVycygpIHsKICAgICAgICBpZiAo\nX3VzZXJJbmRleCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuRU1QVFlfTElTVDsKICAgICAgICByZXR1cm4gX3VzZXJJbmRleDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZvciB0aGlz\nIGJ1ZmZlci4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTUUwoKSB7\nCiAgICAgICAgcmV0dXJuIGdldFNRTChmYWxzZSk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogUmV0dXJucyB0aGUgU1FMIGZvciB0aGlzIGJ1ZmZlci4K\nICAgICAqCiAgICAgKiBAcGFyYW0gcmVwbGFjZVBhcmFtcyBpZiB0cnVlLCB0\naGVuIHJlcGxhY2UgcGFyYW1ldGVycyB3aXRoIHRoZQogICAgICogYWN0dWFs\nIHBhcmFtZXRlciB2YWx1ZXMKICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRTUUwoYm9vbGVhbiByZXBsYWNlUGFyYW1zKSB7CiAgICAgICAgcmVzb2x2\nZVN1YnNlbGVjdHMoKTsKICAgICAgICBTdHJpbmcgc3FsID0gX3NxbC50b1N0\ncmluZygpOwogICAgICAgIGlmICghcmVwbGFjZVBhcmFtcyB8fCBfcGFyYW1z\nID09IG51bGwgfHwgX3BhcmFtcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybiBzcWw7CgogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0\ncmluZ0J1aWxkZXIoKTsKICAgICAgICBJdGVyYXRvciBwaSA9IF9wYXJhbXMu\naXRlcmF0b3IoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNxbC5s\nZW5ndGgoKTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChzcWwuY2hhckF0KGkp\nICE9ICc/JykgewogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChzcWwuY2hh\nckF0KGkpKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBPYmplY3QgcGFyYW0gPSBwaS5oYXNOZXh0KCkg\nPyBwaS5uZXh0KCkgOiBudWxsOwogICAgICAgICAgICBpZiAocGFyYW0gPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIk5VTEwiKTsKICAg\nICAgICAgICAgZWxzZSBpZiAocGFyYW0gaW5zdGFuY2VvZiBOdW1iZXIgfHwg\ncGFyYW0gaW5zdGFuY2VvZiBCb29sZWFuKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChwYXJhbSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtIGlu\nc3RhbmNlb2YgU3RyaW5nIHx8IHBhcmFtIGluc3RhbmNlb2YgQ2hhcmFjdGVy\nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiJyIpLmFwcGVuZChwYXJh\nbSkuYXBwZW5kKCInIik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIj8iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2\nZSBvdXIgZGVsYXllZCBzdWJzZWxlY3RzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmVzb2x2ZVN1YnNlbGVjdHMoKSB7CiAgICAgICAgaWYgKF9zdWJz\nZWxzID09IG51bGwgfHwgX3N1YnNlbHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIC8vIGFkZCBzdWJzZWxzIGJhY2t3YXJkcyBz\nbyB0aGF0IHRoZSBzdG9yZWQgaW5zZXJ0aW9uIHBvaW50cyBvZgogICAgICAg\nIC8vIGxhdGVyIHN1YnNlbHMgcmVtYWluIHZhbGlkCiAgICAgICAgU3Vic2Vs\nZWN0IHN1YjsKICAgICAgICBTUUxCdWZmZXIgYnVmOwogICAgICAgIGZvciAo\naW50IGkgPSBfc3Vic2Vscy5zaXplKCkgLSAxOyBpID49IDA7IGktLSkgewog\nICAgICAgICAgICBzdWIgPSAoU3Vic2VsZWN0KSBfc3Vic2Vscy5nZXQoaSk7\nCiAgICAgICAgICAgIGlmIChzdWIuY291bnQpCiAgICAgICAgICAgICAgICBi\ndWYgPSBzdWIuc2VsZWN0LnRvU2VsZWN0Q291bnQoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgYnVmID0gc3ViLnNlbGVjdC50b1NlbGVj\ndChmYWxzZSwgc3ViLmZldGNoKTsKICAgICAgICAgICAgYnVmLnJlc29sdmVT\ndWJzZWxlY3RzKCk7CiAgICAgICAgICAgIGFwcGVuZChidWYsIHN1Yi5zcWxJ\nbmRleCwgc3ViLnBhcmFtSW5kZXgsIGZhbHNlKTsKICAgICAgICB9CiAgICAg\nICAgX3N1YnNlbHMuY2xlYXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhbmQgcG9wdWxhdGUgdGhlIHBhcmFtZXRlcnMgb2YgYSBwcmVwYXJl\nZCBzdGF0ZW1lbnQgdXNpbmcKICAgICAqIHRoZSBTUUwgaW4gdGhpcyBidWZm\nZXIuCiAgICAgKi8KICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVw\nYXJlU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVu\ndChjb25uLCBSZXN1bHRTZXQuVFlQRV9GT1JXQVJEX09OTFksCiAgICAgICAg\nICAgIFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUgdGhlIHBhcmFtZXRlcnMg\nb2YgYSBwcmVwYXJlZCBzdGF0ZW1lbnQgdXNpbmcKICAgICAqIHRoZSBTUUwg\naW4gdGhpcyBidWZmZXIuCiAgICAgKi8KICAgIHB1YmxpYyBQcmVwYXJlZFN0\nYXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgaW50\nIHJzVHlwZSwKICAgICAgICBpbnQgcnNDb25jdXIpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVTdGF0ZW1l\nbnQoY29ubiwgbnVsbCwgcnNUeXBlLCByc0NvbmN1cik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJz\nIG9mIGEgcHJlcHJlZCBzdGF0ZW1lbnQgdXNpbmcgdGhlCiAgICAgKiBTUUwg\naW4gdGhpcyBidWZmZXIgYW5kIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1cmF0\naW9uLgogICAgICovCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQgcHJl\ncGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4sCiAgICAgICAgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgaW50IHJzQ29u\nY3VyKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChyc1R5cGUgPT0gLTEgJiYgZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAg\ncnNUeXBlID0gUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZOwogICAgICAg\nIGVsc2UgaWYgKHJzVHlwZSA9PSAtMSkKICAgICAgICAgICAgcnNUeXBlID0g\nZmV0Y2guZ2V0UmVzdWx0U2V0VHlwZSgpOwogICAgICAgIGlmIChyc0NvbmN1\nciA9PSAtMSkKICAgICAgICAgICAgcnNDb25jdXIgPSBSZXN1bHRTZXQuQ09O\nQ1VSX1JFQURfT05MWTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQ7CiAgICAgICAgaWYgKHJzVHlwZSA9PSBSZXN1bHRTZXQuVFlQRV9GT1JX\nQVJEX09OTFkKICAgICAgICAgICAgJiYgcnNDb25jdXIgPT0gUmVzdWx0U2V0\nLkNPTkNVUl9SRUFEX09OTFkpCiAgICAgICAgICAgIHN0bW50ID0gY29ubi5w\ncmVwYXJlU3RhdGVtZW50KGdldFNRTCgpKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KGdldFNRTCgp\nLCByc1R5cGUsIHJzQ29uY3VyKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBzZXRQYXJhbWV0ZXJzKHN0bW50KTsKICAgICAgICAgICAgaWYgKGZldGNo\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChmZXRjaC5nZXRGZXRj\naEJhdGNoU2l6ZSgpID4gMCkKICAgICAgICAgICAgICAgICAgICBzdG1udC5z\nZXRGZXRjaFNpemUoCiAgICAgICAgICAgICAgICAgICAgICAgIF9kaWN0Lmdl\ndEJhdGNoRmV0Y2hTaXplKGZldGNoLmdldEZldGNoQmF0Y2hTaXplKCkpKTsK\nICAgICAgICAgICAgICAgIGlmIChyc1R5cGUgIT0gUmVzdWx0U2V0LlRZUEVf\nRk9SV0FSRF9PTkxZCiAgICAgICAgICAgICAgICAgICAgJiYgZmV0Y2guZ2V0\nRmV0Y2hEaXJlY3Rpb24oKSAhPSBSZXN1bHRTZXQuRkVUQ0hfRk9SV0FSRCkK\nICAgICAgICAgICAgICAgICAgICBzdG1udC5zZXRGZXRjaERpcmVjdGlvbihm\nZXRjaC5nZXRGZXRjaERpcmVjdGlvbigpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UyKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cg\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFu\nZCBwb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXBhcmVkIHN0YXRl\nbWVudCB1c2luZwogICAgICogdGhlIFNRTCBpbiB0aGlzIGJ1ZmZlci4KICAg\nICAqLwogICAgcHVibGljIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVDYWxs\nKENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcHJlcGFyZUNhbGwoY29ubiwgUmVzdWx0U2V0\nLlRZUEVfRk9SV0FSRF9PTkxZLAogICAgICAgICAgICBSZXN1bHRTZXQuQ09O\nQ1VSX1JFQURfT05MWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYW5kIHBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGEgcHJlcGFyZWQgc3Rh\ndGVtZW50IHVzaW5nCiAgICAgKiB0aGUgU1FMIGluIHRoaXMgYnVmZmVyLgog\nICAgICovCiAgICBwdWJsaWMgQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNh\nbGwoQ29ubmVjdGlvbiBjb25uLCBpbnQgcnNUeXBlLAogICAgICAgIGludCBy\nc0NvbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gcHJlcGFyZUNhbGwoY29ubiwgbnVsbCwgcnNUeXBlLCByc0Nv\nbmN1cik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVs\nYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGEgcHJlcHJlZCBzdGF0ZW1lbnQgdXNp\nbmcgdGhlCiAgICAgKiBTUUwgaW4gdGhpcyBidWZmZXIgYW5kIHRoZSBnaXZl\nbiBmZXRjaCBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgQ2Fs\nbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoQ29ubmVjdGlvbiBjb25uLAog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5\ncGUsIGludCByc0NvbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAocnNUeXBlID09IC0xICYmIGZldGNoID09IG51bGwp\nCiAgICAgICAgICAgIHJzVHlwZSA9IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRf\nT05MWTsKICAgICAgICBlbHNlIGlmIChyc1R5cGUgPT0gLTEpCiAgICAgICAg\nICAgIHJzVHlwZSA9IGZldGNoLmdldFJlc3VsdFNldFR5cGUoKTsKICAgICAg\nICBpZiAocnNDb25jdXIgPT0gLTEpCiAgICAgICAgICAgIHJzQ29uY3VyID0g\nUmVzdWx0U2V0LkNPTkNVUl9SRUFEX09OTFk7CgogICAgICAgIENhbGxhYmxl\nU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChyc1R5cGUgPT0gUmVzdWx0\nU2V0LlRZUEVfRk9SV0FSRF9PTkxZCiAgICAgICAgICAgICYmIHJzQ29uY3Vy\nID09IFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZKQogICAgICAgICAgICBz\ndG1udCA9IGNvbm4ucHJlcGFyZUNhbGwoZ2V0U1FMKCkpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc3RtbnQgPSBjb25uLnByZXBhcmVDYWxsKGdldFNR\nTCgpLCByc1R5cGUsIHJzQ29uY3VyKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzZXRQYXJhbWV0ZXJzKHN0bW50KTsKICAgICAgICAgICAgaWYgKGZl\ndGNoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChmZXRjaC5nZXRG\nZXRjaEJhdGNoU2l6ZSgpID4gMCkKICAgICAgICAgICAgICAgICAgICBzdG1u\ndC5zZXRGZXRjaFNpemUoCiAgICAgICAgICAgICAgICAgICAgICAgIF9kaWN0\nLmdldEJhdGNoRmV0Y2hTaXplKGZldGNoLmdldEZldGNoQmF0Y2hTaXplKCkp\nKTsKICAgICAgICAgICAgICAgIGlmIChyc1R5cGUgIT0gUmVzdWx0U2V0LlRZ\nUEVfRk9SV0FSRF9PTkxZCiAgICAgICAgICAgICAgICAgICAgJiYgZmV0Y2gu\nZ2V0RmV0Y2hEaXJlY3Rpb24oKSAhPSBSZXN1bHRTZXQuRkVUQ0hfRk9SV0FS\nRCkKICAgICAgICAgICAgICAgICAgICBzdG1udC5zZXRGZXRjaERpcmVjdGlv\nbihmZXRjaC5nZXRGZXRjaERpcmVjdGlvbigpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UyKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhy\nb3cgc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUG9wdWxh\ndGUgdGhlIHBhcmFtZXRlcnMgb2YgYW4gZXhpc3RpbmcgUHJlcGFyZWRTdGF0\nZW1lbnQKICAgICAqIHdpdGggdmFsdWVzIGZyb20gdGhpcyBidWZmZXIuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFBhcmFtZXRlcnMoUHJlcGFyZWRT\ndGF0ZW1lbnQgcHMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKF9wYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBDb2x1bW4gY29sOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgX3BhcmFtcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBjb2wg\nPSAoX2NvbHMgPT0gbnVsbCkgPyBudWxsIDogKENvbHVtbikgX2NvbHMuZ2V0\nKGkpOwogICAgICAgICAgICBfZGljdC5zZXRVbmtub3duKHBzLCBpICsgMSwg\nX3BhcmFtcy5nZXQoaSksIGNvbCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgaW50IGhhc2ggPSBfc3Fs\nLmhhc2hDb2RlKCk7CiAgICAgICAgcmV0dXJuIChfcGFyYW1zID09IG51bGwp\nID8gaGFzaCA6IGhhc2ggXiBfcGFyYW1zLmhhc2hDb2RlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb21wYXJlIGludGVybmFsIFNRTCB3aXRob3V0IHJl\nc29sdmluZyBzdWJzZWxlY3RzIG9yIHN0cmluZ2lmeWluZwogICAgICogcGFy\nYW1ldGVycy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3FsRXF1YWxz\nKFN0cmluZyBzcWwpIHsKICAgICAgICByZXR1cm4gX3NxbC50b1N0cmluZygp\nLmVxdWFscyhzcWwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFs\ncyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIg\naW5zdGFuY2VvZiBTUUxCdWZmZXIpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIFNRTEJ1ZmZlciBidWYgPSAoU1FMQnVmZmVyKSBvdGhl\ncjsKICAgICAgICByZXR1cm4gX3NxbC5lcXVhbHMoYnVmLl9zcWwpCiAgICAg\nICAgICAgICYmIE9iamVjdFV0aWxzLmVxdWFscyhfcGFyYW1zLCBidWYuX3Bh\ncmFtcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIFNRTCAnPycg\nd2l0aCBDQVNUIHN0cmluZyBpZiByZXF1aXJlZCBieSBEQiBwbGF0Zm9ybQog\nICAgICogQHBhcmFtIG9wZXIKICAgICAqIEBwYXJhbSB2YWwKICAgICAqLwog\nICAgcHVibGljIHZvaWQgYWRkQ2FzdEZvclBhcmFtKFN0cmluZyBvcGVyLCBW\nYWwgdmFsKSB7CiAgICAgICAgaWYgKF9zcWwuY2hhckF0KF9zcWwubGVuZ3Ro\nKCkgLSAxKSA9PSAnPycpIHsKICAgICAgICAgICAgU3RyaW5nIGNhc3RTdHJp\nbmcgPSBfZGljdC5hZGRDYXN0QXNUeXBlKG9wZXIsIHZhbCk7CiAgICAgICAg\nICAgIGlmIChjYXN0U3RyaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc3FsLnJlcGxhY2UoX3NxbC5sZW5ndGgoKSAtIDEsIF9zcWwubGVuZ3RoKCks\nIGNhc3RTdHJpbmcpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlcGxhY2UgY3VycmVudCBidWZmZXIgc3RyaW5nIHdpdGggdGhlIG5ldyBz\ndHJpbmcKICAgICAqIAogICAgICogQHBhcmFtIHN0YXJ0IHJlcGxhY2Ugc3Rh\ncnQgcG9zaXRpb24KICAgICAqIEBwYXJhbSBlbmQgcmVwbGFjZSBlbmQgcG9z\naXRpb24KICAgICAqIEBwYXJhbSBuZXdTdHJpbmcKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgcmVwbGFjZVNxbFN0cmluZyhpbnQgc3RhcnQsIGludCBlbmQs\nIFN0cmluZyBuZXdTdHJpbmcpIHsKICAgICAgICBfc3FsLnJlcGxhY2Uoc3Rh\ncnQsIGVuZCwgbmV3U3RyaW5nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAg\nKiBSZXByZXNlbnRzIGEgc3Vic2VsZWN0LgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBTdWJzZWxlY3QgewoKICAgICAgICBwdWJsaWMgU2Vs\nZWN0IHNlbGVjdDsKICAgICAgICBwdWJsaWMgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaDsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb3VudDsKICAg\nICAgICBwdWJsaWMgaW50IHNxbEluZGV4OwogICAgICAgIHB1YmxpYyBpbnQg\ncGFyYW1JbmRleDsKCiAgICAgICAgcHVibGljIFN1YnNlbGVjdCBjbG9uZShp\nbnQgc3FsSW5kZXgsIGludCBwYXJhbUluZGV4KSB7CiAgICAgICAgICAgIGlm\nIChzcWxJbmRleCA9PSAwICYmIHBhcmFtSW5kZXggPT0gMCkKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwoKICAgICAgICAgICAgU3Vic2VsZWN0IHN1\nYiA9IG5ldyBTdWJzZWxlY3QoKTsKICAgICAgICAgICAgc3ViLnNlbGVjdCA9\nIHNlbGVjdDsKICAgICAgICAgICAgc3ViLmZldGNoID0gZmV0Y2g7CiAgICAg\nICAgICAgIHN1Yi5jb3VudCA9IGNvdW50OwogICAgICAgICAgICBzdWIuc3Fs\nSW5kZXggPSB0aGlzLnNxbEluZGV4ICsgc3FsSW5kZXg7CiAgICAgICAgICAg\nIHN1Yi5wYXJhbUluZGV4ID0gdGhpcy5wYXJhbUluZGV4ICsgcGFyYW1JbmRl\neDsKICAgICAgICAgICAgcmV0dXJuIHN1YjsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIHNldFBhcmFtZXRlcnMoTGlzdCBwYXJhbXMp\nIHsKICAgICAgICBfcGFyYW1zID0gcGFyYW1zOwogICAgfQogICAgCiAgICBw\ndWJsaWMgTGlzdCBnZXRDb2x1bW5zKCkgewogICAgICAgIHJldHVybiBfY29s\nczsKICAgIH0KfQo=\n","encoding":"base64"}

