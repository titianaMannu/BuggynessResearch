{"sha":"1e5dc54c9abd3bfa10980b043abc86a102ce26ce","node_id":"MDQ6QmxvYjIwNjM2NDoxZTVkYzU0YzlhYmQzYmZhMTA5ODBiMDQzYWJjODZhMTAyY2UyNmNl","size":103538,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1e5dc54c9abd3bfa10980b043abc86a102ce26ce","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGls\nLlRyZWVNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLml0ZXJhdG9ycy5FbXB0eUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hNb2Rl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNMb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5Db250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoK\nLyoqCiAqIFN0YW5kYXJkIHtAbGluayBTZWxlY3R9IGltcGxlbWVudGF0aW9u\nLiBVc2FnZSBub3RlOiB0aG91Z2ggdGhpcyBjbGFzcwogKiBpbXBsZW1lbnRz\nIHtAbGluayBKb2luc30sIGl0IHNob3VsZCBub3QgYmUgdXNlZCBmb3Igam9p\nbmluZyBkaXJlY3RseS4KICogSW5zdGVhZCwgdXNlIHRoZSByZXR1cm4gdmFs\ndWUgb2Yge0BsaW5rICNuZXdKb2luc30uCiAqCiAqIEBhdXRob3IgQWJlIFdo\naXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBTZWxlY3RJbXBs\nCiAgICBpbXBsZW1lbnRzIFNlbGVjdCwgUGF0aEpvaW5zIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgTk9OQVVUT19ESVNUSU5DVCA9IDIgPDwg\nMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBESVNUSU5DVCA9IDIg\nPDwgMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBOT1RfRElTVElO\nQ1QgPSAyIDw8IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgSU1Q\nTElDSVRfRElTVElOQ1QgPSAyIDw8IDM7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgVE9fTUFOWSA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBBR0dSRUdBVEUgPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgTE9CID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE9VVEVSID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IExSUyA9IDIgPDwgODsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBFQUdFUl9UT19PTkUgPSAyIDw8IDk7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRUFHRVJfVE9fTUFOWSA9IDIgPDwgMTA7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgUkVDT1JEX09SREVSRUQgPSAy\nIDw8IDExOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEdST1VQSU5H\nID0gMiA8PCAxMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGT1JD\nRV9DT1VOVCA9IDIgPDwgMTM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nU3RyaW5nW10gVEFCTEVfQUxJQVNFUyA9IG5ldyBTdHJpbmdbMTZdOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nW10gT1JERVJfQUxJQVNFUyA9\nIG5ldyBTdHJpbmdbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2Jq\nZWN0W10gTlVMTF9JRFMgPSBuZXcgT2JqZWN0WzE2XTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE9iamVjdFtdIFBMQUNFSE9MREVSUyA9IG5ldyBPYmpl\nY3RbNTBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoU2VsZWN0LmNsYXNzKTsKCiAg\nICBzdGF0aWMgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVEFCTEVf\nQUxJQVNFUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgVEFCTEVfQUxJQVNF\nU1tpXSA9ICJ0IiArIGk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBP\nUkRFUl9BTElBU0VTLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBPUkRFUl9B\nTElBU0VTW2ldID0gIm8iICsgaTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IE5VTExfSURTLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBOVUxMX0lE\nU1tpXSA9IG5ldyBOdWxsSWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IFBMQUNFSE9MREVSUy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgUExB\nQ0VIT0xERVJTW2ldID0gbmV3IFBsYWNlaG9sZGVyKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBmaW5hbCBKREJDQ29uZmlndXJhdGlvbiBfY29uZjsKICAgIHBy\naXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwoKICAgIC8vIG1hcCBv\nZiB2YXJpYWJsZSArIHJlbGF0aW9uIHBhdGggKyB0YWJsZSBrZXlzIHRvIHRo\nZSBjb3JyZWN0IGFsaWFzIGluZGV4OgogICAgLy8gZWFjaCByZWxhdGlvbiBw\nYXRoL3RhYmxlIGNvbWJpbmF0aW9uIHNob3VsZCBoYXZlIGEgdW5pcXVlIGFs\naWFzIGJlY2F1c2UKICAgIC8vIGl0IHJlcHJlc2VudHMgYSBzZXBhcmF0ZSBv\nYmplY3Q7IGZvciBleGFtcGxlLCBpZiBhIFBlcnNvbiBjbGFzcyBoYXMgYQog\nICAgLy8gJ3BhcmVudCcgZmllbGQgcmVwcmVzZW50aW5nIGFub3RoZXIgUGVy\nc29uIGFuZCBhbHNvIGhhcyBhbiAnYWRkcmVzcycKICAgIC8vIGZpZWxkIG9m\nIHR5cGUgQWRkcmVzczoKICAgIC8vICdhZGRyZXNzLnN0cmVldCcgc2hvdWxk\nIG1hcCB0byBhIGRpZmZlcmVudCB0YWJsZSBhbGlhcyB0aGFuCiAgICAvLyAn\ncGFyZW50LmFkZHJlc3Muc3RyZWV0JyBmb3IgdGhlIHB1cnBvc2VzIG9mIGNv\nbXBhcmlzb25zCiAgICBwcml2YXRlIE1hcCBfYWxpYXNlcyA9IG51bGw7Cgog\nICAgLy8gbWFwIG9mIGluZGV4ZXMgdG8gdGFibGUgYWxpYXNlcyBsaWtlICdU\nQUJMRU5BTUUgdDAnCiAgICBwcml2YXRlIFNvcnRlZE1hcCBfdGFibGVzID0g\nbnVsbDsKCiAgICAvLyBjb21iaW5lZCBsaXN0IG9mIHNlbGVjdGVkIGlkcyBh\nbmQgbWFwIG9mIGVhY2ggaWQgdG8gaXRzIGFsaWFzCiAgICBwcm90ZWN0ZWQg\nZmluYWwgU2VsZWN0cyBfc2VsZWN0cyA9IG5ld1NlbGVjdHMoKTsKICAgIHBy\naXZhdGUgTGlzdCBfb3JkZXJlZCA9IG51bGw7CiAgICBwcml2YXRlIExpc3Qg\nX2dyb3VwZWQgPSBudWxsOwoKICAgIC8vIGZsYWdzCiAgICBwcml2YXRlIGlu\ndCBfZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2pvaW5TeW50YXggPSAw\nOwogICAgcHJpdmF0ZSBsb25nIF9zdGFydElkeCA9IDA7CiAgICBwcml2YXRl\nIGxvbmcgX2VuZElkeCA9IExvbmcuTUFYX1ZBTFVFOwogICAgcHJpdmF0ZSBp\nbnQgX251bGxJZHMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX29yZGVycyA9IDA7\nCiAgICBwcml2YXRlIGludCBfcGxhY2Vob2xkZXJzID0gMDsKICAgIHByaXZh\ndGUgaW50IF9leHBlY3RlZFJlc3VsdENvdW50ID0gMDsKCiAgICAvLyBxdWVy\neSBjbGF1c2VzCiAgICBwcml2YXRlIFNRTEJ1ZmZlciBfb3JkZXJpbmcgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX3doZXJlID0gbnVsbDsKICAg\nIHByaXZhdGUgU1FMQnVmZmVyIF9ncm91cGluZyA9IG51bGw7CiAgICBwcml2\nYXRlIFNRTEJ1ZmZlciBfaGF2aW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FM\nQnVmZmVyIF9mdWxsID0gbnVsbDsKCiAgICAvLyBqb2lucyB0byBhZGQgdG8g\ndGhlIGVuZCBvZiBvdXIgd2hlcmUgY2xhdXNlLCBhbmQgam9pbnMgdG8gcHJl\ncGVuZCB0bwogICAgLy8gYWxsIHNlbGVjdHMgKHNlZSBzZWxlY3QoY2xhc3Nt\nYXBwaW5nKSBtZXRob2QpCiAgICBwcml2YXRlIFNlbGVjdEpvaW5zIF9qb2lu\ncyA9IG51bGw7CiAgICBwcml2YXRlIFN0YWNrIF9wcmVKb2lucyA9IG51bGw7\nCgogICAgLy8gbWFwIG9mIGpvaW5zK2tleXMgdG8gZWFnZXIgc2VsZWN0cyBh\nbmQgZ2xvYmFsIHNldCBvZiBlYWdlciBrZXlzOyB0aGUKICAgIC8vIHNhbWUg\na2V5IGNhbid0IGJlIHVzZWQgbW9yZSB0aGFuIG9uY2UKICAgIHByaXZhdGUg\nTWFwIF9lYWdlciA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZWFnZXJLZXlz\nID0gbnVsbDsKCiAgICAvLyBzdWJzZWxlY3Qgc3VwcG9ydAogICAgcHJpdmF0\nZSBMaXN0IF9zdWJzZWxzID0gbnVsbDsKICAgIHByaXZhdGUgU2VsZWN0SW1w\nbCBfcGFyZW50ID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9zdWJQYXRo\nID0gbnVsbDsKCiAgICAvLyBmcm9tIHNlbGVjdCBpZiB0aGlzIHNlbGVjdCBz\nZWxlY3RzIGZyb20gYSB0bXAgdGFibGUgY3JlYXRlZCBieSBhbm90aGVyCiAg\nICBwcml2YXRlIFNlbGVjdEltcGwgX2Zyb20gPSBudWxsOwogICAgcHJvdGVj\ndGVkIFNlbGVjdEltcGwgX291dGVyID0gbnVsbDsKCiAgICAvLyBKUFFMIFF1\nZXJ5IGNvbnRleHQgdGhpcyBzZWxlY3QgaXMgYXNzb2NpYXRlZCB3aXRoCiAg\nICBwcml2YXRlIENvbnRleHQgX2N0eCA9IG51bGw7CgogICAgLy8gQSBwYXRo\nIG5hdmlnYXRpb24gaXMgYmVnaW4gd2l0aCB0aGlzIHNjaGVtYSBhbGlhcwog\nICAgcHJpdmF0ZSBTdHJpbmcgX3NjaGVtYUFsaWFzID0gbnVsbDsKICAgICAK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhlIHBy\nb3BlciB0YWJsZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGFsaWFzIGluZGV4Lgog\nICAgICovCiAgICBzdGF0aWMgU3RyaW5nIHRvQWxpYXMoaW50IGluZGV4KSB7\nCiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBUQUJMRV9BTElBU0VTLmxlbmd0\naCkKICAgICAgICAgICAgcmV0dXJuIFRBQkxFX0FMSUFTRVNbaW5kZXhdOwog\nICAgICAgIHJldHVybiAidCIgKyBpbmRleDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgb3JkZXIg\nYWxpYXMgZm9yIHRoZSBnaXZlbiBvcmRlcgogICAgICogY29sdW1uIGluZGV4\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b09yZGVyQWxp\nYXMoaW50IGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBPUkRF\nUl9BTElBU0VTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIE9SREVSX0FM\nSUFTRVNbaW5kZXhdOwogICAgICAgIHJldHVybiAibyIgKyBpbmRleDsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNlbGVjdEltcGwoSkRCQ0Nv\nbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29uZjsKICAg\nICAgICBfZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7\nCiAgICAgICAgX2pvaW5TeW50YXggPSBfZGljdC5qb2luU3ludGF4OwogICAg\nICAgIF9zZWxlY3RzLl9kaWN0ID0gX2RpY3Q7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0Q29udGV4dChDb250ZXh0IGNvbnRleHQpIHsKICAgICAgICBp\nZiAoX2N0eCA9PSBudWxsKSB7CiAgICAgICAgICAgIF9jdHggPSBjb250ZXh0\nOwogICAgICAgICAgICBfY3R4LnNldFNlbGVjdCh0aGlzKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIENvbnRleHQgY3R4KCkgewogICAgICAgIHJl\ndHVybiBfY3R4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNjaGVtYUFs\naWFzKFN0cmluZyBzY2hlbWFBbGlhcykgewogICAgICAgIF9zY2hlbWFBbGlh\ncyA9IHNjaGVtYUFsaWFzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1wbGVt\nZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0\naW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJs\naWMgU1FMQnVmZmVyIHRvU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgX2Z1bGwgPSBf\nZGljdC50b1NlbGVjdCh0aGlzLCBmb3JVcGRhdGUsIGZldGNoKTsKICAgICAg\nICByZXR1cm4gX2Z1bGw7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTUUxCdWZm\nZXIgZ2V0U1FMKCkgewogICAgICAgIHJldHVybiBfZnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0Q291bnQoKSB7CiAgICAgICAg\ncmV0dXJuIF9kaWN0LnRvU2VsZWN0Q291bnQodGhpcyk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0QXV0b0Rpc3RpbmN0KCkgewogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgTk9OQVVUT19ESVNUSU5DVCkgPT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvRGlzdGluY3QoYm9vbGVhbiB2YWwp\nIHsKICAgICAgICBpZiAodmFsKQogICAgICAgICAgICBfZmxhZ3MgJj0gfk5P\nTkFVVE9fRElTVElOQ1Q7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgfD0gTk9OQVVUT19ESVNUSU5DVDsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0Rpc3RpbmN0KCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYg\nTk9UX0RJU1RJTkNUKSA9PSAwICYmICgoX2ZsYWdzICYgRElTVElOQ1QpICE9\nIDAKICAgICAgICAgICAgfHwgKChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNU\nKSA9PSAwCiAgICAgICAgICAgICYmIChfZmxhZ3MgJiBJTVBMSUNJVF9ESVNU\nSU5DVCkgIT0gMCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldERpc3Rp\nbmN0KGJvb2xlYW4gZGlzdGluY3QpIHsKICAgICAgICAvLyBuZWVkIHR3byBm\nbGFncyBpbiBjYXNlIHNldCBub3RfZGlzdGluY3QsIHRoZW4gYSB0by1tYW55\nIGpvaW4gaGFwcGVucwogICAgICAgIC8vIGFuZCBkaXN0aW5jdCBmbGFnIGdl\ndHMgc2V0IGF1dG9tYXRpY2FsbHkKICAgICAgICBpZiAoZGlzdGluY3QpIHsK\nICAgICAgICAgICAgX2ZsYWdzIHw9IERJU1RJTkNUOwogICAgICAgICAgICBf\nZmxhZ3MgJj0gfk5PVF9ESVNUSU5DVDsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBfZmxhZ3MgfD0gTk9UX0RJU1RJTkNUOwogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkRJU1RJTkNUOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0xSUygpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIExSUykgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMUlMoYm9v\nbGVhbiBscnMpIHsKICAgICAgICBpZiAobHJzKQogICAgICAgICAgICBfZmxh\nZ3MgfD0gTFJTOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5MUlM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KCkgewogICAgICAgIC8vIGlmIHRoZSBjb3VudCBpc24ndCBmb3Jj\nZWQgYW5kIHdlIGhhdmUgdG8tbWFueSBlYWdlciBqb2lucyB0aGF0IGNvdWxk\nCiAgICAgICAgLy8gdGhyb3cgdGhlIGNvdW50IG9mZiwgZG9uJ3QgcGF5IGF0\ndGVudGlvbiB0byBpdAogICAgICAgIGlmICgoX2ZsYWdzICYgRk9SQ0VfQ09V\nTlQpID09IDAgJiYgaGFzRWFnZXJKb2luKHRydWUpKQogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICByZXR1cm4gX2V4cGVjdGVkUmVzdWx0Q291bnQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RXhwZWN0ZWRSZXN1bHRDb3Vu\ndChpbnQgZXhwZWN0ZWRSZXN1bHRDb3VudCwgYm9vbGVhbiBmb3JjZSkgewog\nICAgICAgIF9leHBlY3RlZFJlc3VsdENvdW50ID0gZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgICAgICBpZiAoZm9yY2UpCiAgICAgICAgICAgIF9mbGFncyB8\nPSBGT1JDRV9DT1VOVDsKICAgICAgICBlbHNlIAogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZPUkNFX0NPVU5UOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nSm9pblN5bnRheCgpIHsKICAgICAgICByZXR1cm4gX2pvaW5TeW50YXg7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0Sm9pblN5bnRheChpbnQgam9pblN5\nbnRheCkgewogICAgICAgIF9qb2luU3ludGF4ID0gam9pblN5bnRheDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzcyhi\nb29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBw\nb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNldCh0aGlzLCBmb3JVcGRhdGUpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZygpIHsK\nICAgICAgICByZXR1cm4gX2RpY3Quc3VwcG9ydHNMb2NraW5nKHRoaXMpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc011bHRpcGxlU2VsZWN0cygp\nIHsKICAgICAgICBpZiAoX2VhZ2VyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBfZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChlbnRyeS5n\nZXRWYWx1ZSgpICE9IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0Q291bnQoSkRCQ1N0b3JlIHN0b3JlKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENvbm5lY3Rpb24gY29u\nbiA9IG51bGw7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBu\ndWxsOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgU1FMQnVmZmVyIHNxbCA9IHRvU2VsZWN0Q291bnQo\nKTsKICAgICAgICAgICAgY29ubiA9IHN0b3JlLmdldE5ld0Nvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4s\nIHNxbCwgbnVsbCwgCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQuVFlQRV9G\nT1JXQVJEX09OTFksIAogICAgICAgICAgICAgICAgUmVzdWx0U2V0LkNPTkNV\nUl9SRUFEX09OTFksIGZhbHNlKTsKICAgICAgICAgICAgX2RpY3Quc2V0UXVl\ncnlUaW1lb3V0KHN0bW50LAogICAgICAgICAgICAgICAgICAgIHN0b3JlLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpLmdldFF1ZXJ5VGltZW91dCgpKTsKICAg\nICAgICAgICAgcnMgPSBleGVjdXRlUXVlcnkoY29ubiwgc3RtbnQsIHNxbCwg\nZmFsc2UsIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuIGdldENvdW50KHJz\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgaWYgKHN0bW50\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgp\nOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlm\nIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIFJlc3VsdCBleGVjdXRlKEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVs\nbCkKICAgICAgICAgICAgZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZS5nZXRDb250\nZXh0KCksIHN0b3JlLCBmZXRjaCwKICAgICAgICAgICAgZmV0Y2guZ2V0UmVh\nZExvY2tMZXZlbCgpKTsKICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0IGV4ZWN1\ndGUoSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIGludCBsb2NrTGV2ZWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIGZldGNoID0gc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3RvcmUuZ2V0Q29udGV4dCgpLCBz\ndG9yZSwgZmV0Y2gsIGxvY2tMZXZlbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFeGVjdXRlIHRoaXMgc2VsZWN0IGluIHRoZSBjb250ZXh0IG9mIHRoZSBn\naXZlbiBzdG9yZSBtYW5hZ2VyLiBUaGUKICAgICAqIGNvbnRleHQgaXMgcGFz\nc2VkIGluIHNlcGFyYXRlbHkgZm9yIHByb2ZpbGluZyBwdXJwb3Nlcy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdCBleGVjdXRlKFN0b3JlQ29udGV4\ndCBjdHgsIEpEQkNTdG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSA9\nIGZhbHNlOwogICAgICAgIGlmICghaXNBZ2dyZWdhdGUoKSAmJiBfZ3JvdXBp\nbmcgPT0gbnVsbCkgewogICAgICAgICAgICBKREJDTG9ja01hbmFnZXIgbG0g\nPSBzdG9yZS5nZXRMb2NrTWFuYWdlcigpOwogICAgICAgICAgICBpZiAobG0g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvclVwZGF0ZSA9IGxtLnNlbGVj\ndEZvclVwZGF0ZSh0aGlzLCBsb2NrTGV2ZWwpOwogICAgICAgIH0KCiAgICAg\nICAgU1FMQnVmZmVyIHNxbCA9IHRvU2VsZWN0KGZvclVwZGF0ZSwgZmV0Y2gp\nOwogICAgICAgIGJvb2xlYW4gaXNMUlMgPSBpc0xSUygpOwogICAgICAgIGlu\ndCByc1R5cGUgPSAoaXNMUlMgJiYgc3VwcG9ydHNSYW5kb21BY2Nlc3MoZm9y\nVXBkYXRlKSkKICAgICAgICAgICAgPyAtMSA6IFJlc3VsdFNldC5UWVBFX0ZP\nUldBUkRfT05MWTsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5n\nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQgPSBudWxsOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzTFJTKSAKICAgICAgICAgICAg\nICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzcWwsIGZldGNo\nLCByc1R5cGUsIC0xLCB0cnVlKTsgCiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzcWws\nIG51bGwsIHJzVHlwZSwgLTEsIGZhbHNlKTsKICAgICAgICAgICAgCiAgICAg\nICAgICAgIF9kaWN0LnNldFRpbWVvdXRzKHN0bW50LCBmZXRjaCwgZm9yVXBk\nYXRlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJzID0gZXhlY3V0ZVF1\nZXJ5KGNvbm4sIHN0bW50LCBzcWwsIGlzTFJTLCBzdG9yZSk7CiAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIC8vIGNs\nZWFuIHVwIHN0YXRlbWVudAogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAgIHRyeSB7IGNv\nbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikge30KICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBn\nZXRFYWdlclJlc3VsdChjb25uLCBzdG1udCwgcnMsIHN0b3JlLCBmZXRjaCwg\nZm9yVXBkYXRlLCBzcWwpOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0\nZSBvdXIgZWFnZXIgc2VsZWN0cywgYWRkaW5nIHRoZSByZXN1bHRzIHVuZGVy\nIHRoZSBzYW1lIGtleXMKICAgICAqIHRvIHRoZSBnaXZlbiByZXN1bHQuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYWRkRWFnZXJSZXN1bHRz\nKFNlbGVjdFJlc3VsdCByZXMsIFNlbGVjdEltcGwgc2VsLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vs\nLl9lYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIGV4ZWN1dGUgZWFnZXIgc2VsZWN0cwogICAgICAgIE1hcC5FbnRyeSBl\nbnRyeTsKICAgICAgICBSZXN1bHQgZXJlczsKICAgICAgICBNYXAgZWFnZXI7\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzZWwuX2VhZ2VyLmVudHJ5\nU2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwoKICAgICAgICAg\nICAgLy8gc2ltdWxhdGVkIGJhdGNoZWQgc2VsZWN0cyBmb3IgaW5uZXIvb3V0\nZXIgam9pbnM7IGZvciBzZXBhcmF0ZQogICAgICAgICAgICAvLyBzZWxlY3Rz\nLCBkb24ndCBwYXNzIG9uIGxvY2sgbGV2ZWwsIGJlY2F1c2UgdGhleSdyZSBw\ncm9iYWJseQogICAgICAgICAgICAvLyBmb3IgcmVsYXRpb25zIGFuZCB0aGVy\nZWZvcmUgc2hvdWxkIHVzZSBkZWZhdWx0IGxldmVsCiAgICAgICAgICAgIGlm\nIChlbnRyeS5nZXRWYWx1ZSgpID09IHNlbCkKICAgICAgICAgICAgICAgIGVy\nZXMgPSByZXM7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGVy\nZXMgPSAoKFNlbGVjdEV4ZWN1dG9yKSBlbnRyeS5nZXRWYWx1ZSgpKS5leGVj\ndXRlKHN0b3JlLAogICAgICAgICAgICAgICAgICAgIGZldGNoKTsKCiAgICAg\nICAgICAgIGVhZ2VyID0gcmVzLmdldEVhZ2VyTWFwKGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKGVhZ2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGVh\nZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHJlcy5zZXRF\nYWdlck1hcChlYWdlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWFn\nZXIucHV0KGVudHJ5LmdldEtleSgpLCBlcmVzKTsKICAgICAgICB9CiAgICB9\nCgoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBv\ndmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1w\nbGVtZW50YXRpb24gb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1l\nbnQoQ29ubmVjdGlvbiBjb25uLCAKICAgICAgICBTUUxCdWZmZXIgc3FsLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgcnNUeXBlLCAKICAg\nICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4gaXNMUlMpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgcnNUeXBl\nLCByc0NvbmN1cik7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4g\nc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgZmV0Y2gsIHJzVHlwZSwgLTEp\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRv\nIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAK\nICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJl\nU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgCiAgICAgICAgU3RyaW5nIHNx\nbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGNvbm4u\ncHJlcGFyZVN0YXRlbWVudChzcWwpOwogICAgfSAgICAKICAgIAogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZv\nciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbiBvZiBleGVjdXRpbmcgcXVlcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBS\nZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KENvbm5lY3Rpb24gY29ubiwgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwsIGJv\nb2xlYW4gaXNMUlMsIEpEQkNTdG9yZSBzdG9yZSkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1dGVRdWVyeSgpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHBy\nb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAg\nICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyBxdWVyeS4KICAgICAq\nLwogICAgcHVibGljIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoQ29ubmVjdGlv\nbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgCiAgICAgICAgU3Ry\naW5nIHNxbCwgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIENv\nbHVtbltdIGNvbHMpIAogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGdldHRpbmcgY291bnQgZnJvbSB0aGUgcmVzdWx0IHNldC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGludCBnZXRDb3VudChSZXN1bHRTZXQg\ncnMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJzLm5leHQoKTsK\nICAgICAgICByZXR1cm4gcnMuZ2V0SW50KDEpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIGV4ZWN1dGluZyBlYWdlciBzZWxlY3RzLgogICAgICovCiAgICBw\ndWJsaWMgUmVzdWx0IGdldEVhZ2VyUmVzdWx0KENvbm5lY3Rpb24gY29ubiwg\nCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIFJlc3VsdFNldCBy\ncywgSkRCQ1N0b3JlIHN0b3JlLCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBib29sZWFuIGZvclVwZGF0ZSwgU1FMQnVmZmVyIHNx\nbCkgCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2Vs\nZWN0UmVzdWx0IHJlcyA9IG5ldyBTZWxlY3RSZXN1bHQoY29ubiwgc3RtbnQs\nIHJzLCBfZGljdCk7CiAgICAgICAgcmVzLnNldFNlbGVjdCh0aGlzKTsKICAg\nICAgICByZXMuc2V0U3RvcmUoc3RvcmUpOwogICAgICAgIHJlcy5zZXRMb2Nr\naW5nKGZvclVwZGF0ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYWRk\nRWFnZXJSZXN1bHRzKHJlcywgdGhpcywgc3RvcmUsIGZldGNoKTsKICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFNlbGVjdCBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBpbnQgaW5kZXhP\nZigpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgTGlz\ndCBnZXRTdWJzZWxlY3RzKCkgewogICAgICAgIHJldHVybiAoX3N1YnNlbHMg\nPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUIDogX3N1YnNlbHM7\nCiAgICB9CgogICAgcHVibGljIFNlbGVjdCBnZXRQYXJlbnQoKSB7CiAgICAg\nICAgcmV0dXJuIF9wYXJlbnQ7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBn\nZXRTdWJzZWxlY3RQYXRoKCkgewogICAgICAgIHJldHVybiBfc3ViUGF0aDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRQYXJlbnQoU2VsZWN0IHBhcmVu\ndCwgU3RyaW5nIHBhdGgpIHsKICAgICAgICBpZiAocGF0aCAhPSBudWxsKQog\nICAgICAgICAgICBfc3ViUGF0aCA9IHBhdGg7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBfc3ViUGF0aCA9IG51bGw7CgogICAgICAgIGlmIChwYXJlbnQg\nPT0gX3BhcmVudCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChf\ncGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgIF9wYXJlbnQuX3N1YnNlbHMu\ncmVtb3ZlKHRoaXMpOwoKICAgICAgICAvLyMjIyByaWdodCBub3cgd2UgY2Fu\nJ3QgdXNlIHNxbDkyIGpvaW5zIHdpdGggc3Vic2VsZWN0cywgY2F1c2UKICAg\nICAgICAvLyMjIyBJIGNhbid0IGZpZ3VyZSBvdXQgd2hhdCB0byBkbyB3aGVu\nIHRoZSBzdWJzZWxlY3QgaGFzIGEgam9pbgogICAgICAgIC8vIyMjIHdpdGgg\nYW4gYWxpYXMgYWxzbyBwcmVzZW50IGluIHRoZSBvdXRlciBzZWxlY3QuLi4g\neW91IGRvbid0IHdhbnQKICAgICAgICAvLyMjIyB0aGUgam9pbiB0byBhcHBl\nYXIgaW4gdGhlIEZST00gY2xhdXNlIG9mIHRoZSBzdWJzZWxlY3QgY2F1c2UK\nICAgICAgICAvLyMjIyB0aGVuIGl0IHJlLWFsaWFzZXMgYm90aCB0YWJsZXMg\naW4gdGhlIHNjb3BlIG9mIHRoZSBzdWJzZWxlY3QKICAgICAgICAvLyMjIyBh\nbmQgdGhlIGNvcnJlbGF0aW9uIHdpdGggdGhlIG91dGVyIHNlbGVjdCBpcyBs\nb3N0CiAgICAgICAgX3BhcmVudCA9IChTZWxlY3RJbXBsKSBwYXJlbnQ7CiAg\nICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nX3BhcmVudC5fc3Vic2VscyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3Bh\ncmVudC5fc3Vic2VscyA9IG5ldyBBcnJheUxpc3QoMik7CiAgICAgICAgICAg\nIF9wYXJlbnQuX3N1YnNlbHMuYWRkKHRoaXMpOwogICAgICAgICAgICBpZiAo\nX3BhcmVudC5fam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1NR\nTDkyKQogICAgICAgICAgICAgICAgX2pvaW5TeW50YXggPSBKb2luU3ludGF4\nZXMuU1lOVEFYX1RSQURJVElPTkFMOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfam9pblN5bnRheCA9IF9wYXJlbnQuX2pvaW5TeW50YXg7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgTWFwIGdldEFsaWFz\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9hbGlhc2VzOwogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCByZW1vdmVBbGlhcyhPYmplY3Qga2V5KSB7CiAgICAg\nICAgX2FsaWFzZXMucmVtb3ZlKGtleSk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBNYXAgZ2V0VGFibGVzKCkgewogICAgICAgIHJldHVybiBfdGFibGVzOwog\nICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCByZW1vdmVUYWJsZShPYmplY3Qg\na2V5KSB7CiAgICAgICAgX3RhYmxlcy5yZW1vdmUoa2V5KTsKICAgIH0KCiAg\nICBwdWJsaWMgU2VsZWN0IGdldEZyb21TZWxlY3QoKSB7CiAgICAgICAgcmV0\ndXJuIF9mcm9tOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEZyb21TZWxl\nY3QoU2VsZWN0IHNlbCkgewogICAgICAgIF9mcm9tID0gKFNlbGVjdEltcGwp\nIHNlbDsKICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAg\nX2Zyb20uX291dGVyID0gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNFYWdlckpvaW4oYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICBpZiAo\ndG9NYW55KQogICAgICAgICAgICByZXR1cm4gKF9mbGFncyAmIEVBR0VSX1RP\nX01BTlkpICE9IDA7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBFQUdFUl9U\nT19PTkUpICE9IDA7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzSm9p\nbihib29sZWFuIHRvTWFueSkgewogICAgICAgIGlmICh0b01hbnkpCiAgICAg\nICAgICAgIHJldHVybiAoX2ZsYWdzICYgVE9fTUFOWSkgIT0gMDsKICAgICAg\nICByZXR1cm4gX3RhYmxlcyAhPSBudWxsICYmIF90YWJsZXMuc2l6ZSgpID4g\nMTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NlbGVjdGVkKFRhYmxl\nIHRhYmxlKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMobnVs\nbCwgZmFsc2UpOwogICAgICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gX2Zyb20uZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIGZh\nbHNlKSAhPSAtMTsKICAgICAgICByZXR1cm4gZ2V0VGFibGVJbmRleCh0YWJs\nZSwgcGosIGZhbHNlKSAhPSAtMTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRUYWJsZUFsaWFzZXMoKSB7CiAgICAgICAgcmV0dXJuIChfdGFi\nbGVzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfU0VUIDogX3RhYmxl\ncy52YWx1ZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRTZWxlY3Rz\nKCkgewogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVM\naXN0KF9zZWxlY3RzKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRTZWxl\nY3RBbGlhc2VzKCkgewogICAgICAgIHJldHVybiBfc2VsZWN0cy5nZXRBbGlh\nc2VzKGZhbHNlLCBfb3V0ZXIgIT0gbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIExpc3QgZ2V0SWRlbnRpZmllckFsaWFzZXMoKSB7CiAgICAgICAgcmV0dXJu\nIF9zZWxlY3RzLmdldEFsaWFzZXModHJ1ZSwgX291dGVyICE9IG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0T3JkZXJpbmcoKSB7CiAg\nICAgICAgcmV0dXJuIF9vcmRlcmluZzsKICAgIH0KCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIGdldEdyb3VwaW5nKCkgewogICAgICAgIHJldHVybiBfZ3JvdXBp\nbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRXaGVyZSgpIHsK\nICAgICAgICByZXR1cm4gX3doZXJlOwogICAgfQoKICAgIHB1YmxpYyBTUUxC\ndWZmZXIgZ2V0SGF2aW5nKCkgewogICAgICAgIHJldHVybiBfaGF2aW5nOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZEpvaW5DbGFzc0NvbmRpdGlvbnMo\nKSB7CiAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5qb2lu\ncygpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nam9pbiBzZXQgaXRlcmF0b3IgYWxsb3dzIGNvbmN1cnJlbnQgbW9kaWZpY2F0\naW9uCiAgICAgICAgSm9pbiBqOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gX2pvaW5zLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgaiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICBpZiAoai5nZXRSZWxhdGlvblRhcmdldCgpICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGouZ2V0UmVsYXRpb25UYXJnZXQoKS5nZXREaXNjcmlt\naW5hdG9yKCkuYWRkQ2xhc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAg\nICAgKHRoaXMsIGouZ2V0U3ViY2xhc3NlcygpID09IFNVQlNfSk9JTkFCTEUs\nIAogICAgICAgICAgICAgICAgICAgIGouZ2V0UmVsYXRpb25Kb2lucygpKTsK\nICAgICAgICAgICAgICAgIGouc2V0UmVsYXRpb24obnVsbCwgMCwgbnVsbCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpv\naW5zIGdldEpvaW5zKCkgewogICAgICAgIHJldHVybiBfam9pbnM7CiAgICB9\nCgogICAgcHVibGljIEl0ZXJhdG9yIGdldEpvaW5JdGVyYXRvcigpIHsKICAg\nICAgICBpZiAoX2pvaW5zID09IG51bGwgfHwgX2pvaW5zLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIEVtcHR5SXRlcmF0b3IuSU5TVEFOQ0U7CiAg\nICAgICAgcmV0dXJuIF9qb2lucy5qb2lucygpLmpvaW5JdGVyYXRvcigpOwog\nICAgfQoKICAgIHB1YmxpYyBsb25nIGdldFN0YXJ0SW5kZXgoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBn\nZXRFbmRJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2VuZElkeDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRSYW5nZShsb25nIHN0YXJ0LCBsb25nIGVu\nZCkgewogICAgICAgIF9zdGFydElkeCA9IHN0YXJ0OwogICAgICAgIF9lbmRJ\nZHggPSBlbmQ7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5B\nbGlhcyhDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFs\naWFzKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwgZ2V0Sm9pbnMo\nam9pbnMsIGZhbHNlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBw\ncml2YXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBQYXRo\nSm9pbnMgcGopIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29s\nLmdldElkZW50aWZpZXIoKS5nZXROYW1lKCksIGNvbC5nZXRUYWJsZSgpLCBw\naik7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhT\ndHJpbmcgY29sLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBnZXRD\nb2x1bW5BbGlhcyhjb2wsIHRhYmxlLCAoSm9pbnMpIG51bGwpOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwg\nVGFibGUgdGFibGUsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgcmV0dXJuIGdl\ndENvbHVtbkFsaWFzKGNvbCwgdGFibGUsIGdldEpvaW5zKGpvaW5zLCBmYWxz\nZSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhbGlhcyBm\nb3IgdGhlIGdpdmUgY29sdW1uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCwgT2JqZWN0IHBhdGgpIHsKICAg\nICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgpOwogICAgICAgIFN0\ncmluZyB0YWJsZUFsaWFzID0gbnVsbDsKICAgICAgICBJdGVyYXRvciBpdHIg\nPSBnZXRKb2luSXRlcmF0b3IoKTsKICAgICAgICB3aGlsZSAoaXRyLmhhc05l\neHQoKSkgewogICAgICAgICAgICBKb2luIGpvaW4gPSAoSm9pbikgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKGpvaW4gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKGpvaW4uZ2V0VGFibGUxKCkgPT0gdGFibGUpCiAgICAg\nICAgICAgICAgICAgICAgdGFibGVBbGlhcyA9IGpvaW4uZ2V0QWxpYXMxKCk7\nCiAgICAgICAgICAgICAgICBlbHNlIGlmIChqb2luLmdldFRhYmxlMigpID09\nIHRhYmxlKQogICAgICAgICAgICAgICAgICAgIHRhYmxlQWxpYXMgPSBqb2lu\nLmdldEFsaWFzMigpOwogICAgICAgICAgICAgICAgaWYgKHRhYmxlQWxpYXMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0cmlu\nZ0J1aWxkZXIodGFibGVBbGlhcykuYXBwZW5kKCIuIikuCiAgICAgICAgICAg\nICAgICAgICAgICAgIGFwcGVuZChfZGljdC5nZXROYW1pbmdVdGlsKCkudG9E\nQk5hbWUoY29sLmdldElkZW50aWZpZXIoKSkpLnRvU3RyaW5nKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCJDYW4gbm90IHJlc29sdmUgYWxpYXMgZm9yIGZpZWxkOiAi\nICsKICAgICAgICAgICAgcGF0aC50b1N0cmluZygpICsgIiBtYXBwZWQgdG8g\nY29sdW1uOiAiICsgY29sLmdldElkZW50aWZpZXIoKS5nZXROYW1lKCkgKwog\nICAgICAgICAgICAiIHRhYmxlOiAiK3RhYmxlLmdldElkZW50aWZpZXIoKS5n\nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBh\nbGlhcyBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0\nZSBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFibGUgdGFi\nbGUsIFBhdGhKb2lucyBwaikgewogICAgICAgIHJldHVybiBnZXRUYWJsZUFs\naWFzKHRhYmxlLCBwaikuYXBwZW5kKF9kaWN0LmdldE5hbWluZ1V0aWwoKS50\nb0RCTmFtZShjb2wpKS50b1N0cmluZygpOwogICAgfQogICAgCiAgICBwcml2\nYXRlIFN0cmluZ0J1aWxkZXIgZ2V0VGFibGVBbGlhcyhUYWJsZSB0YWJsZSwg\nUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBu\nZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGlmIChfZnJvbSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIFN0cmluZyBhbGlhcyA9IHRvQWxpYXMoX2Zyb20u\nZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIHRydWUpKTsKICAgICAgICAgICAg\naWYgKF9kaWN0LnJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QpCiAgICAgICAg\nICAgICAgICByZXR1cm4gYnVmLmFwcGVuZChGUk9NX1NFTEVDVF9BTElBUyku\nYXBwZW5kKCIuIikuYXBwZW5kKGFsaWFzKS4KICAgICAgICAgICAgICAgICAg\nICBhcHBlbmQoIl8iKTsKICAgICAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQo\nYWxpYXMpLmFwcGVuZCgiXyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nYnVmLmFwcGVuZCh0b0FsaWFzKGdldFRhYmxlSW5kZXgodGFibGUsIHBqLCB0\ncnVlKSkpLmFwcGVuZCgiLiIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzQWdncmVnYXRlKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgQUdH\nUkVHQVRFKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEFnZ3Jl\nZ2F0ZShib29sZWFuIGFnZykgewogICAgICAgIGlmIChhZ2cpCiAgICAgICAg\nICAgIF9mbGFncyB8PSBBR0dSRUdBVEU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkFHR1JFR0FURTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0xvYigpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIExP\nQikgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMb2IoYm9vbGVh\nbiBsb2IpIHsKICAgICAgICBpZiAobG9iKQogICAgICAgICAgICBfZmxhZ3Mg\nfD0gTE9COwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5M\nT0I7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJTZWxlY3RzKCkgewog\nICAgICAgIF9zZWxlY3RzLmNsZWFyKCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc2VsZWN0KFNRTEJ1ZmZlciBzcWwsIE9iamVjdCBpZCkgewogICAg\nICAgIHJldHVybiBzZWxlY3Qoc3FsLCBpZCwgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gc2VsZWN0KFNRTEJ1ZmZlciBzcWwsIE9iamVjdCBp\nZCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoIWlzR3JvdXBpbmcoKSkK\nICAgICAgICAgICAgcmV0dXJuIHNlbGVjdCgoT2JqZWN0KSBzcWwsIGlkLCBq\nb2lucyk7CiAgICAgICAgZ3JvdXBCeShzcWwsIGpvaW5zKTsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhl\nIHNlbGVjdCBvZiB0aGUgZ2l2ZW4gU1FMIGJ1ZmZlciBvciBzdHJpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3QoT2JqZWN0IHNxbCwg\nT2JqZWN0IGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGdldEpvaW5zKGpv\naW5zLCB0cnVlKTsKICAgICAgICBib29sZWFuIGNvbnRhaW5zOwogICAgICAg\nIGlmIChpZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfc2Vs\nZWN0cy5pbmRleE9mQWxpYXMoc3FsKTsKICAgICAgICAgICAgY29udGFpbnMg\nPSBpZHggIT0gLTE7CiAgICAgICAgICAgIGlmIChjb250YWlucykKICAgICAg\nICAgICAgICAgIGlkID0gX3NlbGVjdHMuZ2V0KGlkeCk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIGlkID0gbnVsbElkKCk7CiAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgIGNvbnRhaW5zID0gX3NlbGVjdHMuY29udGFp\nbnMoaWQpOwoKICAgICAgICBpZiAoY29udGFpbnMpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBfc2VsZWN0cy5zZXRBbGlhcyhpZCwgc3Fs\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIGEgdW5pcXVlIGlkIGZvciBhIFNRTCBzdHJpbmcg\nd2hvc2UgZ2l2ZW4gaWQgaXMgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSBP\nYmplY3QgbnVsbElkKCkgewogICAgICAgIGlmIChfbnVsbElkcyA+PSBOVUxM\nX0lEUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBuZXcgTnVsbElkKCk7\nCiAgICAgICAgcmV0dXJuIE5VTExfSURTW19udWxsSWRzKytdOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTdHJpbmcgc3FsLCBPYmplY3Qg\naWQpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNxbCwgaWQsIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTdHJpbmcgc3FsLCBP\nYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dyb3Vw\naW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoKE9iamVjdCkgc3Fs\nLCBpZCwgam9pbnMpOwogICAgICAgIGdyb3VwQnkoc3FsLCBqb2lucyk7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2Vs\nZWN0UGxhY2Vob2xkZXIoU3RyaW5nIHNxbCkgewogICAgICAgIE9iamVjdCBo\nb2xkZXIgPSAoX3BsYWNlaG9sZGVycyA+PSBQTEFDRUhPTERFUlMubGVuZ3Ro\nKQogICAgICAgICAgICA/IG5ldyBQbGFjZWhvbGRlcigpIDogUExBQ0VIT0xE\nRVJTW19wbGFjZWhvbGRlcnMrK107CiAgICAgICAgc2VsZWN0KHNxbCwgaG9s\nZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc2VydCBhIHBsYWNlaG9s\nZGVyIGF0IHRoZSBnaXZlbiBpbmRleDsgdXNlIGEgbmVnYXRpdmUgaW5kZXgK\nICAgICAqIHRvIGNvdW50IGZyb20gdGhlIGJhY2sgb2YgdGhlIHNlbGVjdCBs\naXN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBpbnNlcnRQbGFjZWhvbGRl\ncihTdHJpbmcgc3FsLCBpbnQgcG9zKSB7CiAgICAgICAgT2JqZWN0IGhvbGRl\nciA9IChfcGxhY2Vob2xkZXJzID49IFBMQUNFSE9MREVSUy5sZW5ndGgpCiAg\nICAgICAgICAgID8gbmV3IFBsYWNlaG9sZGVyKCkgOiBQTEFDRUhPTERFUlNb\nX3BsYWNlaG9sZGVycysrXTsKICAgICAgICBfc2VsZWN0cy5pbnNlcnRBbGlh\ncyhwb3MsIGhvbGRlciwgc3FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENs\nZWFyIHNlbGVjdGVkIHBsYWNlaG9sZGVycywgYW5kIHJldHVybiByZW1vdmVk\nIHNlbGVjdCBpbmRleGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVh\nclBsYWNlaG9sZGVyU2VsZWN0cygpIHsKICAgICAgICBfc2VsZWN0cy5jbGVh\nclBsYWNlaG9sZGVycygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNl\nbGVjdChDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdChjb2ws\nIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2Vs\nZWN0KENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFp\nc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoY29sLCBn\nZXRKb2lucyhqb2lucywgdHJ1ZSksIGZhbHNlKTsKICAgICAgICBncm91cEJ5\nKGNvbCwgam9pbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IHNlbGVjdChDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAg\ncmV0dXJuIHNlbGVjdChjb2xzLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IHNlbGVjdChDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykgewogICAg\nICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGlzR3JvdXBpbmcoKSkg\newogICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAgICAgICAg\nICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIFBhdGhKb2lucyBwaiA9\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICBpZiAoc2VsZWN0KGNvbHNbaV0sIHBqLCBmYWxzZSkp\nCiAgICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1\ncm4gc2VsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZ2l2\nZW4gY29sdW1uIGFmdGVyIG1ha2luZyB0aGUgZ2l2ZW4gam9pbnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCwgUGF0\naEpvaW5zIHBqLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAgLy8gd2UgY2Fj\naGUgb24gY29sdW1uIG9iamVjdCBpZiB0aGVyZSBhcmUgbm8gam9pbnMgc28g\ndGhhdCB3aGVuCiAgICAgICAgLy8gbG9va2luZyB1cCBjb2x1bW5zIGluIHRo\nZSByZXN1bHQgd2UgZG9uJ3QgaGF2ZSB0byBjcmVhdGUgYSBzdHJpbmcKICAg\nICAgICAvLyBidWZmZXIgZm9yIHRoZSB0YWJsZSArIGNvbHVtbiBhbGlhczsg\naWYgdGhlcmUgYXJlIGpvaW5zLCB0aGVuCiAgICAgICAgLy8gd2Uga2V5IG9u\nIHRoZSBhbGlhcwogICAgICAgIFN0cmluZyBhbGlhcyA9IGdldENvbHVtbkFs\naWFzKGNvbCwgcGopOwogICAgICAgIE9iamVjdCBpZDsKICAgICAgICBpZiAo\ncGogPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAg\naWQgPSBjb2w7CiAgICAgICAgZWxzZQogICAgICAgICAgICBpZCA9IGFsaWFz\nOwogICAgICAgIGlmIChfc2VsZWN0cy5jb250YWlucyhpZCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKGNvbC5nZXRUeXBlKCkg\nPT0gVHlwZXMuQkxPQiB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkNMT0Ip\nCiAgICAgICAgICAgIHNldExvYih0cnVlKTsKICAgICAgICBfc2VsZWN0cy5z\nZXRBbGlhcyhpZCwgYWxpYXMsIGlkZW50KTsKICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nKSB7CiAgICAgICAgc2VsZWN0KG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3Jl\nLCBmZXRjaCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNlbGVjdChDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMs\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMpIHsK\nICAgICAgICBzZWxlY3QodGhpcywgbWFwcGluZywgc3ViY2xhc3Nlcywgc3Rv\ncmUsIGZldGNoLCBlYWdlciwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNlbGVjdCB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwog\nICAgdm9pZCBzZWxlY3QoU2VsZWN0IHdyYXBwZXIsIENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJDU3RvcmUgc3Rv\ncmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwK\nICAgICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBpZGVudCkgewogICAgICAg\nIC8vIG5vdGUgdGhhdCB0aGlzIGlzIG9uZSBjYXNlIHdoZXJlIHdlIGRvbid0\nIHdhbnQgdG8gdXNlIHRoZSByZXN1bHQKICAgICAgICAvLyBvZiBnZXRKb2lu\ncygpOyBqdXN0IHVzZSB0aGUgZ2l2ZW4gam9pbnMsIHdoaWNoIHdpbGwgZWl0\naGVyIGJlIGNsZWFuCiAgICAgICAgLy8gb3IgdGhlIHJlc3VsdCBvZiBwcmV2\naW91cyBwcmUtam9pbnMuIHRoaXMgd2F5IHdlIGRvbid0IHB1c2ggZXh0cmEK\nICAgICAgICAvLyBzdGFjayBzdHVmZiB3aGVuIG5vIGFjdHVhbCBuZXcgam9p\nbnMgaGF2ZSBiZWVuIG1hZGUsIGFuZCB3ZSBkb24ndAogICAgICAgIC8vIHRo\naW5rIHRoZSB1c2VyIHdhbnRzIG91dGVyIGpvaW5zIHdoZW4gYWN0dWFsbHkg\nb25seSB0aGUgcHJldmlvdXMKICAgICAgICAvLyBqb2lucyB3ZXJlIG91dGVy\nLiAgd2UgZG8gaW52b2tlIGdldEpvaW5zKCksIHRob3VnaCwgdG8gYWRkIHRo\nZXNlCiAgICAgICAgLy8gam9pbnMgKGlmIGFueSkgdG8gb3VyIHRvcC1sZXZl\nbCBqb2luczsgb3RoZXJ3aXNlIGl0J2QgYmUgcG9zc2libGUKICAgICAgICAv\nLyBmb3IgdGhlIHVzZXIgdG8gaW1tZWRpYXRlbHkgZG8gYW5vdGhlciBqb2lu\nIGFuZCBzZWxlY3Qgc29tZXRoaW5nLAogICAgICAgIC8vIGFuZCBpZiB3ZSdy\nZSBpbiBvdXRlciBtb2RlIGFsbCB0aGVzZSBqb2lucyB3aWxsIGdldCBzd2l0\nY2hlZCB0byBvdXRlcgogICAgICAgIC8vIGpvaW5zLiAgY2FjaGluZyB0aGVt\nIGFzIHRoZWlyIG9yaWdpbmFsIGpvaW4gdHlwZSBwcmV2ZW50cyB0aGF0CiAg\nICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwoKICAgICAgICBQYXRoSm9p\nbnMgcGogPSAoUGF0aEpvaW5zKSBqb2luczsKICAgICAgICBib29sZWFuIGhh\nc0pvaW5zID0gcGogIT0gbnVsbCAmJiBwai5pc0RpcnR5KCk7CiAgICAgICAg\naWYgKGhhc0pvaW5zKSB7CiAgICAgICAgICAgIGlmIChfcHJlSm9pbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9wcmVKb2lucyA9IG5ldyBTdGFjaygp\nOwogICAgICAgICAgICBfcHJlSm9pbnMucHVzaChwaik7CiAgICAgICAgfQoK\nICAgICAgICAvLyBpZiB0aGV5IGFyZSBzZWxlY3RpbmcgdGhpcyBtYXBwaW5n\nIHdpdGggb3V0ZXIgam9pbnMsIHRoZW4gYWxsIGpvaW5zCiAgICAgICAgLy8g\nZnJvbSB0aGlzIG1hcHBpbmcgc2hvdWxkIGFsc28gYmUgb3V0ZXIKICAgICAg\nICBib29sZWFuIHdhc091dGVyID0gKF9mbGFncyAmIE9VVEVSKSAhPSAwOwog\nICAgICAgIGlmIChoYXNKb2lucyAmJiAhd2FzT3V0ZXIgJiYgcGouaXNPdXRl\ncigpKQogICAgICAgICAgICBfZmxhZ3MgfD0gT1VURVI7CgogICAgICAgIC8v\nIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIgdG8gc2VsZWN0IGluIHNhbWUg\nb3JkZXIgaXQgbG9hZHMgcmVzdWx0CiAgICAgICAgKChKREJDU3RvcmVNYW5h\nZ2VyKSBzdG9yZSkuc2VsZWN0KHdyYXBwZXIsIG1hcHBpbmcsIHN1YmNsYXNz\nZXMsIG51bGwsCiAgICAgICAgICAgIG51bGwsIGZldGNoLCBlYWdlciwgaWRl\nbnQsIChfZmxhZ3MgJiBPVVRFUikgIT0gMCk7CgogICAgICAgIC8vIHJlc2V0\nCiAgICAgICAgaWYgKGhhc0pvaW5zKQogICAgICAgICAgICBfcHJlSm9pbnMu\ncG9wKCk7CiAgICAgICAgaWYgKCF3YXNPdXRlciAmJiAoX2ZsYWdzICYgT1VU\nRVIpICE9IDApCiAgICAgICAgICAgIF9mbGFncyAmPSB+T1VURVI7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0SWRlbnRpZmllcihDb2x1bW4g\nY29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdElkZW50aWZpZXIoY29sLCAo\nSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVj\ndElkZW50aWZpZXIoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBpZiAoIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVj\ndChjb2wsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgdHJ1ZSk7CiAgICAgICAg\nZ3JvdXBCeShjb2wsIGpvaW5zKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgcHVibGljIGludCBzZWxlY3RJZGVudGlmaWVyKENvbHVtbltd\nIGNvbHMpIHsKICAgICAgICByZXR1cm4gc2VsZWN0SWRlbnRpZmllcihjb2xz\nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdElkZW50aWZp\nZXIoQ29sdW1uW10gY29scywgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAo\nY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIHJldHVybiAwOwogICAgICAgIGlmIChpc0dyb3VwaW5nKCkpIHsKICAgICAg\nICAgICAgZ3JvdXBCeShjb2xzLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVy\nbiAwOwogICAgICAgIH0KICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lu\ncyhqb2lucywgdHJ1ZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgaWYgKHNlbGVjdChjb2xzW2ldLCBwaiwgdHJ1ZSkpCiAgICAgICAg\nICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1cm4gc2VsZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RJZGVudGlmaWVyKENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGlu\ndCBlYWdlcikgewogICAgICAgIHNlbGVjdElkZW50aWZpZXIobWFwcGluZywg\nc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwgbnVsbCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2VsZWN0SWRlbnRpZmllcihDbGFzc01hcHBp\nbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFn\nZXIsCiAgICAgICAgSm9pbnMgam9pbnMpIHsKICAgICAgICBzZWxlY3QodGhp\ncywgbWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdlciwg\nam9pbnMsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0UHJp\nbWFyeUtleShDbGFzc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIHJldHVy\nbiBzZWxlY3RQcmltYXJ5S2V5KG1hcHBpbmcsIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgc2VsZWN0UHJpbWFyeUtleShDbGFzc01hcHBpbmcgbWFw\ncGluZywgSm9pbnMgam9pbnMpIHsKICAgICAgICByZXR1cm4gcHJpbWFyeUtl\neU9wZXJhdGlvbihtYXBwaW5nLCB0cnVlLCBudWxsLCBqb2lucywgZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogT3BlcmF0ZSBvbiBwcmltYXJ5IGtl\neSBkYXRhLiBSZXR1cm4gYSBiaXQgbWFzayBvZiBzZWxlY3RlZCBjb2x1bW5z\nLgogICAgICovCiAgICBwcml2YXRlIGludCBwcmltYXJ5S2V5T3BlcmF0aW9u\nKENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIHNlbCwKICAgICAgICBC\nb29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gYWxpYXNPcmRlcikg\newogICAgICAgIGlmICghc2VsICYmIGFzYyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gMDsKCiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nIGNhbid0\nIHNlbGVjdCB0aGUgZnVsbCBwayB2YWx1ZXMsIHRoZW4gam9pbiB0bwogICAg\nICAgIC8vIHN1cGVyIGFuZCByZWN1cnNlCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHN1cDsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0\nSWQodHJ1ZSkpIHsKICAgICAgICAgICAgc3VwID0gbWFwcGluZy5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgaWYgKGpv\naW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5z\nKCk7CiAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2luU3VwZXJjbGFz\ncyhqb2lucywgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gcHJpbWFyeUtl\neU9wZXJhdGlvbihzdXAsIHNlbCwgYXNjLCBqb2lucywgYWxpYXNPcmRlcik7\nCiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gbWFwcGluZy5n\nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGlmIChpc0dyb3VwaW5n\nKCkpIHsKICAgICAgICAgICAgZ3JvdXBCeShjb2xzLCBqb2lucyk7CiAgICAg\nICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgUGF0aEpvaW5z\nIHBqID0gZ2V0Sm9pbnMoam9pbnMsIGZhbHNlKTsKICAgICAgICBpbnQgc2Vs\nZCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoY29sdW1uT3BlcmF0aW9uKGNvbHNb\naV0sIHNlbCwgYXNjLCBwaiwgYWxpYXNPcmRlcikpCiAgICAgICAgICAgICAg\nICBzZWxkIHw9IDIgPDwgaTsKCiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5n\nIGhhcyBub3QgYmVlbiB1c2VkIGluIHRoZSBzZWxlY3QgeWV0IChhbmQgdGhl\ncmVmb3JlCiAgICAgICAgLy8gaXMgbm90IGpvaW5lZCB0byBhbnl0aGluZyks\nIGJ1dCBoYXMgYW4gb3RoZXItdGFibGUgc3VwZXJjbGFzcyB0aGF0CiAgICAg\nICAgLy8gaGFzIGJlZW4gdXNlZCwgbWFrZSBzdXJlIHRvIGpvaW4gdG8gaXQK\nICAgICAgICBib29sZWFuIGpvaW5lZCA9IGZhbHNlOwogICAgICAgIGZvciAo\nc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKTsgc3VwICE9IG51bGw7CiAgICAgICAgICAgIG1hcHBpbmcgPSBzdXAsIHN1\ncCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkp\nIHsKICAgICAgICAgICAgaWYgKHN1cC5nZXRUYWJsZSgpID09IG1hcHBpbmcu\nZ2V0VGFibGUoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAg\nICAgICAgaWYgKG1hcHBpbmcuZ2V0VGFibGUoKSAhPSBzdXAuZ2V0VGFibGUo\nKQogICAgICAgICAgICAgICAgJiYgZ2V0VGFibGVJbmRleChtYXBwaW5nLmdl\ndFRhYmxlKCksIHBqLCBmYWxzZSkgPT0gLTEKICAgICAgICAgICAgICAgICYm\nIGdldFRhYmxlSW5kZXgoc3VwLmdldFRhYmxlKCksIHBqLCBmYWxzZSkgIT0g\nLTEpIHsKICAgICAgICAgICAgICAgIGlmIChwaiA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgbmV3Sm9pbnMoKTsKICAg\nICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgbWFwcGluZy5qb2luU3Vw\nZXJjbGFzcyhwaiwgZmFsc2UpOwogICAgICAgICAgICAgICAgam9pbmVkID0g\ndHJ1ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICB9CiAgICAgICAgaWYgKGpvaW5lZCkKICAgICAgICAgICAg\nd2hlcmUocGopOwoKICAgICAgICByZXR1cm4gc2VsZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBlcmZvcm0gYW4gb3BlcmF0aW9uIG9uIGEgY29sdW1uLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gY29sdW1uT3BlcmF0aW9uKENv\nbHVtbiBjb2wsIGJvb2xlYW4gc2VsLCBCb29sZWFuIGFzYywKICAgICAgICBQ\nYXRoSm9pbnMgcGosIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIFN0\ncmluZyBhcyA9IG51bGw7CiAgICAgICAgaWYgKGFzYyAhPSBudWxsICYmIChh\nbGlhc09yZGVyIHx8IChfZmxhZ3MgJiBSRUNPUkRfT1JERVJFRCkgIT0gMCkp\nIHsKICAgICAgICAgICAgT2JqZWN0IGlkOwogICAgICAgICAgICBpZiAocGog\nPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGlkID0gY29sOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBp\nZCA9IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSB7CiAgICAgICAgICAg\nICAgICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBfb3JkZXJlZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAgICAgICAgICAg\nICBfb3JkZXJlZC5hZGQoaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChhbGlhc09yZGVyKSB7CiAgICAgICAgICAgICAgICBhcyA9IHRvT3Jk\nZXJBbGlhcyhfb3JkZXJzKyspOwogICAgICAgICAgICAgICAgX3NlbGVjdHMu\nc2V0U2VsZWN0QXMoaWQsIGFzKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgYm9vbGVhbiBzZWxkID0gc2VsICYmIHNlbGVjdChjb2wsIHBq\nLCBmYWxzZSk7CiAgICAgICAgaWYgKGFzYyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIFN0cmluZyBhbGlhcyA9IChhcyAhPSBudWxsKSA/IGFzIDogZ2V0Q29s\ndW1uQWxpYXMoY29sLCBwaik7CiAgICAgICAgICAgIGFwcGVuZE9yZGVyaW5n\nKGFsaWFzLCBhc2MuYm9vbGVhblZhbHVlKCkpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gc2VsZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBv\ncmRlcmluZyBpbmZvcm1hdGlvbiB0byBvdXIgaW50ZXJuYWwgYnVmZmVyLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kT3JkZXJpbmcoT2JqZWN0\nIG9yZGVyQnksIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgaWYgKF9vcmRlcmlu\nZyA9PSBudWxsKQogICAgICAgICAgICBfb3JkZXJpbmcgPSBuZXcgU1FMQnVm\nZmVyKF9kaWN0KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmlu\nZy5hcHBlbmQoIiwgIik7CgogICAgICAgIGlmIChvcmRlckJ5IGluc3RhbmNl\nb2YgU1FMQnVmZmVyKQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKChT\nUUxCdWZmZXIpIG9yZGVyQnkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX29yZGVyaW5nLmFwcGVuZCgoU3RyaW5nKSBvcmRlckJ5KTsKICAgICAgICBp\nZiAoYXNjKQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIgQVNDIik7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIg\nREVTQyIpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeVByaW1hcnlL\nZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gYXNjLAogICAgICAg\nIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnlQcmltYXJ5\nS2V5KG1hcHBpbmcsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJs\naWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBib29sZWFuIGFzYywKICAgICAgICBKb2lucyBqb2lucywgYm9vbGVhbiBz\nZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeVByaW1hcnlLZXkobWFwcGlu\nZywgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIgY29s\ndW1ucy4KICAgICAqLwogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFyeUtl\neShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAgICAg\nSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLCBib29sZWFuIGFsaWFzT3JkZXIp\nIHsKICAgICAgICByZXR1cm4gcHJpbWFyeUtleU9wZXJhdGlvbihtYXBwaW5n\nLCBzZWwsCiAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9v\nbGVhbi5GQUxTRSwgam9pbnMsIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9vbGVhbiBhc2Ms\nIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29sLCBh\nc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3Jk\nZXJCeShDb2x1bW4gY29sLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMsIGJv\nb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoY29sLCBhc2Ms\nIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFs\nbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgog\nICAgICovCiAgICBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9vbGVh\nbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAgICAgICBib29s\nZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4gY29sdW1uT3BlcmF0\naW9uKGNvbCwgc2VsLCAoYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4u\nRkFMU0UsCiAgICAgICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgYWxp\nYXNPcmRlcik7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5KENvbHVt\nbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KGNvbHMsIGFzYywgbnVsbCwgc2VsKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IG9yZGVyQnkoQ29sdW1uW10gY29scywgYm9vbGVh\nbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAgIHJl\ndHVybiBvcmRlckJ5KGNvbHMsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlh\nc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGludCBvcmRlckJ5\nKENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9v\nbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAg\nICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2x1bW5PcGVy\nYXRpb24oY29sc1tpXSwgc2VsLAogICAgICAgICAgICAgICAgKGFzYykgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLCBwaiwgYWxpYXNPcmRlcikp\nCiAgICAgICAgICAgICAgICBzZWxkIHw9IDIgPDwgaTsKICAgICAgICByZXR1\ncm4gc2VsZDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFNR\nTEJ1ZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCwgVmFsdWUg\nc2VsQXMpCiAgICB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2Ms\nIChKb2lucykgbnVsbCwgc2VsLCBzZWxBcyk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFuIGFzYywg\nSm9pbnMgam9pbnMsCiAgICAgICAgYm9vbGVhbiBzZWwsIFZhbHVlIHNlbEFz\nKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2MsIGpvaW5zLCBz\nZWwsIGZhbHNlLCBzZWxBcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxv\ndyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAg\nICAqLwogICAgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJvb2xl\nYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9v\nbGVhbiBhbGlhc09yZGVyLCBWYWx1ZSBzZWxBcykgewogICAgICAgIHJldHVy\nbiBvcmRlckJ5KChPYmplY3QpIHNxbCwgYXNjLCBqb2lucywgc2VsLCBhbGlh\nc09yZGVyLCBzZWxBcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBv\nbiBhIFNRTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gb3JkZXJCeShPYmplY3Qgc3FsLCBib29sZWFuIGFzYywgSm9p\nbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNP\ncmRlciwgVmFsdWUgc2VsQXMpIHsKICAgICAgICBPYmplY3Qgb3JkZXIgPSBz\ncWw7CiAgICAgICAgaWYgKGFsaWFzT3JkZXIpIHsKICAgICAgICAgICAgb3Jk\nZXIgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsKICAgICAgICAgICAgX3Nl\nbGVjdHMuc2V0U2VsZWN0QXMoc3FsLCAoU3RyaW5nKSBvcmRlcik7CiAgICAg\nICAgfQogICAgICAgIGlmICgoX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9\nIDApIHsKICAgICAgICAgICAgaWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfb3JkZXJlZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAg\nICAgICAgIF9vcmRlcmVkLmFkZChzZWxBcyA9PSBudWxsID8gc3FsIDogc2Vs\nQXMpOwogICAgICAgIH0KCiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nOwogICAgICAgIGFwcGVuZE9yZGVyaW5nKHNlbEFzICE9IG51bGwgPyBzZWxB\ncy5nZXRBbGlhcygpIDogb3JkZXIsIGFzYyk7CiAgICAgICAgaWYgKHNlbCkg\newogICAgICAgICAgICBpbnQgaWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFz\nKHNxbCk7CiAgICAgICAgICAgIGlmIChpZHggPT0gLTEpIHsKICAgICAgICAg\nICAgICAgIF9zZWxlY3RzLnNldEFsaWFzKG51bGxJZCgpLCBzcWwsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gYXNj\nLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwg\nYXNjLCBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9y\nZGVyQnkoU3RyaW5nIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBi\nb29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNj\nLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4K\nICAgICAqLwogICAgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJvb2xl\nYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9v\nbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoKE9i\namVjdCkgc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGFsaWFzT3JkZXIsIG51bGwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyT3JkZXJpbmcoKSB7CiAg\nICAgICAgX29yZGVyaW5nID0gbnVsbDsKICAgICAgICBfb3JkZXJzID0gMDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0byByZWNvcmQg\ndGhlIHNlbGVjdCBsaXN0IGluZGV4ZXMgb2YgaXRlbXMgd2Ugb3JkZXIgYnku\nCiAgICAgKi8KICAgIHZvaWQgc2V0UmVjb3JkT3JkZXJlZEluZGV4ZXMoYm9v\nbGVhbiByZWNvcmQpIHsKICAgICAgICBpZiAocmVjb3JkKQogICAgICAgICAg\nICBfZmxhZ3MgfD0gUkVDT1JEX09SREVSRUQ7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIF9vcmRlcmVkID0gbnVsbDsKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5SRUNPUkRfT1JERVJFRDsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGluZGV4ZXMgaW4gdGhlIHNlbGVjdCBsaXN0\nIG9mIGFsbCBpdGVtcyB3ZSdyZSBvcmRlcmluZwogICAgICogYnksIG9yIG51\nbGwgaWYgbm9uZS4gRm9yIHVzZSB3aXRoIHVuaW9ucy4KICAgICAqLwogICAg\nTGlzdCBnZXRPcmRlcmVkSW5kZXhlcygpIHsKICAgICAgICBpZiAoX29yZGVy\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nTGlzdCBpZHhzID0gbmV3IEFycmF5TGlzdChfb3JkZXJlZC5zaXplKCkpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX29yZGVyZWQuc2l6ZSgpOyBp\nKyspCiAgICAgICAgICAgIGlkeHMuYWRkKE51bWJlcnMudmFsdWVPZihfc2Vs\nZWN0cy5pbmRleE9mKF9vcmRlcmVkLmdldChpKSkpKTsKICAgICAgICByZXR1\ncm4gaWR4czsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVByaW1hcnlL\nZXkoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgd2hlcmVQcmltYXJ5S2V5KG9p\nZCwgbWFwcGluZywgbnVsbCwgc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHdoZXJlIGNvbmRpdGlvbnMgc2V0dGluZyB0aGUgbWFwcGluZydz\nIHByaW1hcnkga2V5IHRvIHRoZSBnaXZlbgogICAgICogb2lkIHZhbHVlcy4g\nSWYgdGhlIGdpdmVuIG1hcHBpbmcgZG9lcyBub3QgdXNlIG9pZCB2YWx1ZXMg\nZm9yIGl0cwogICAgICogcHJpbWFyeSBrZXksIHdlIHdpbGwgcmVjdXJzaXZl\nbHkgam9pbiB0byBpdHMgc3VwZXJjbGFzcyB1bnRpbCB3ZSBmaW5kCiAgICAg\nKiBhbiBhbmNlc3RvciB0aGF0IGRvZXMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB3aGVyZVByaW1hcnlLZXkoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIEpvaW5zIGpvaW5zLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSkgewogICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZydzIGlkZW50aWZpZXJz\nIGluY2x1ZGUgc29tZXRoaW5nIG90aGVyIHRoYW4KICAgICAgICAvLyB0aGUg\ncGsgdmFsdWVzLCBqb2luIHRvIHN1cGVyIGFuZCByZWN1cnNlCiAgICAgICAg\naWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKGZhbHNlKSkgewog\nICAgICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgaWYgKGpv\naW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5z\nKCk7CiAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2luU3VwZXJjbGFz\ncyhqb2lucywgZmFsc2UpOwogICAgICAgICAgICB3aGVyZVByaW1hcnlLZXko\nb2lkLCBzdXAsIGpvaW5zLCBzdG9yZSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBtYXBwaW5nLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgd2hlcmUob2lkLCBtYXBw\naW5nLCBjb2xzLCBjb2xzLCBudWxsLCBudWxsLCBnZXRKb2lucyhqb2lucywg\ndHJ1ZSksCiAgICAgICAgICAgIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB3aGVyZUZvcmVpZ25LZXkoRm9yZWlnbktleSBmaywgT2JqZWN0IG9p\nZCwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ1N0b3JlIHN0\nb3JlKSB7CiAgICAgICAgd2hlcmVGb3JlaWduS2V5KGZrLCBvaWQsIG1hcHBp\nbmcsIG51bGwsIHN0b3JlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB3\naGVyZSBjb25kaXRpb25zIHNldHRpbmcgdGhlIGdpdmVuIGZvcmVpZ24ga2V5\nIHRvIHRoZSBnaXZlbgogICAgICogb2lkIHZhbHVlcy4KICAgICAqCiAgICAg\nKiBAc2VlICN3aGVyZVByaW1hcnlLZXkKICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPYmplY3Qgb2lk\nLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKb2lucyBqb2lucywg\nSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5n\nJ3MgaWRlbnRpZmllcnMgaW5jbHVkZSBzb21ldGhpbmcgb3RoZXIgdGhhbgog\nICAgICAgIC8vIHRoZSBwayB2YWx1ZXMsIG9yIGlmIHRoaXMgZm9yZWlnbiBr\nZXkgZG9lc24ndCBsaW5rIHRvIG9ubHkKICAgICAgICAvLyBpZGVudGlmaWVy\ncywgam9pbiB0byB0YWJsZSBhbmQgZG8gYSBnZXRQcmltYXJ5S2V5CiAgICAg\nICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKGZhbHNlKSB8\nfCAhY29udGFpbnNBbGwKICAgICAgICAgICAgKG1hcHBpbmcuZ2V0UHJpbWFy\neUtleUNvbHVtbnMoKSwgZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSkpIHsK\nICAgICAgICAgICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICBqb2lucyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAgIC8vIHRyYXZlcnNl\nIHRvIGZvcmVpZ24ga2V5IHRhcmdldCBtYXBwaW5nCiAgICAgICAgICAgIHdo\naWxlIChtYXBwaW5nLmdldFRhYmxlKCkgIT0gZmsuZ2V0UHJpbWFyeUtleVRh\nYmxlKCkpIHsKICAgICAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAgICAg\nICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2luU3VwZXJjbGFzcyhqb2lu\ncywgZmFsc2UpOwogICAgICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAg\nICAgICBpZiAobWFwcGluZyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGpvaW5zID0gam9pbnMuam9pbihmaywgZmFsc2UsIGZh\nbHNlKTsKICAgICAgICAgICAgd2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFwcGlu\nZywgam9pbnMsIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgQ29sdW1uW10gZnJvbUNvbHMgPSBmay5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgQ29sdW1uW10gdG9Db2xzID0gZmsuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBjb25zdENvbHMgPSBmay5n\nZXRDb25zdGFudENvbHVtbnMoKTsKICAgICAgICBPYmplY3RbXSBjb25zdHMg\nPSBmay5nZXRDb25zdGFudHMoKTsKICAgICAgICB3aGVyZShvaWQsIG1hcHBp\nbmcsIHRvQ29scywgZnJvbUNvbHMsIGNvbnN0cywgY29uc3RDb2xzLAogICAg\nICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSksIHN0b3JlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludGVybmFsIG1ldGhvZCB0byBmbHVzaCB0aGUg\nb2lkIHZhbHVlcyBhcyB3aGVyZSBjb25kaXRpb25zIHRvIHRoZQogICAgICog\nZ2l2ZW4gY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJl\nKE9iamVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLCBDb2x1bW5bXSB0\nb0NvbHMsCiAgICAgICAgQ29sdW1uW10gZnJvbUNvbHMsIE9iamVjdFtdIHZh\nbHMsIENvbHVtbltdIGNvbnN0Q29scywgUGF0aEpvaW5zIHBqLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIFZhbHVlTWFwcGluZyBlbWJl\nZCA9IG1hcHBpbmcuZ2V0RW1iZWRkaW5nTWFwcGluZygpOwogICAgICAgIGlm\nIChlbWJlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHdoZXJlKG9pZCwgZW1i\nZWQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0RGVmaW5pbmdNYXBwaW5nKCksCiAg\nICAgICAgICAgICAgICB0b0NvbHMsIGZyb21Db2xzLCB2YWxzLCBjb25zdENv\nbHMsIHBqLCBzdG9yZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIG9ubHkgYm90aGVyIHRvIHBhY2sgcGsgdmFsdWVzIGlu\ndG8gYXJyYXkgaWYgYXBwIGlkCiAgICAgICAgT2JqZWN0W10gcGtzID0gbnVs\nbDsKICAgICAgICBpZiAobWFwcGluZy5nZXRJZGVudGl0eVR5cGUoKSA9PSBD\nbGFzc01hcHBpbmcuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgIHBrcyA9\nIEFwcGxpY2F0aW9uSWRzLnRvUEtWYWx1ZXMob2lkLCBtYXBwaW5nKTsKCiAg\nICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwog\nICAgICAgIEpvaW5hYmxlIGpvaW47CiAgICAgICAgT2JqZWN0IHZhbDsKICAg\nICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgdG9Db2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAg\nIGlmIChwa3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHZhbCA9IChvaWQg\nPT0gbnVsbCkgPyBudWxsIDoKICAgICAgICAgICAgICAgICAgICAgICAgTnVt\nYmVycy52YWx1ZU9mKCgoSWQpIG9pZCkuZ2V0SWQoKSk7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgLy8gbXVzdCBiZSBhcHAgaWRlbnRp\ndHk7IHVzZSBwayBpbmRleCB0byBnZXQgY29ycmVjdCBwayB2YWx1ZQogICAg\nICAgICAgICAgICAgam9pbiA9IG1hcHBpbmcuYXNzZXJ0Sm9pbmFibGUodG9D\nb2xzW2ldKTsKICAgICAgICAgICAgICAgIHZhbCA9IHBrc1ttYXBwaW5nLmdl\ndEZpZWxkKGpvaW4uZ2V0RmllbGRJbmRleCgpKS4KICAgICAgICAgICAgICAg\nICAgICBnZXRQcmltYXJ5S2V5SW5kZXgoKV07CiAgICAgICAgICAgICAgICB2\nYWwgPSBqb2luLmdldEpvaW5WYWx1ZSh2YWwsIHRvQ29sc1tpXSwgc3RvcmUp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY291bnQgPiAwKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZChnZXRDb2x1bW5BbGlhcyhmcm9tQ29sc1tpXSwgcGop\nKTsKICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIElTICIpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZFZhbHVlKHZhbCwgZnJvbUNvbHNbaV0pOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKGNvbnN0Q29scyAhPSBudWxsICYmIGNvbnN0Q29scy5sZW5n\ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29u\nc3RDb2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGdldENv\nbHVtbkFsaWFzKGNvbnN0Q29sc1tpXSwgcGopKTsKCiAgICAgICAgICAgICAg\nICBpZiAodmFsc1tpXSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBJUyAiKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmRWYWx1ZSh2YWxzW2ldLCBjb25zdENvbHNbaV0pOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB3aGVyZShidWYsIHBq\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdG8gc2VlIGlmIHRoZSBn\naXZlbiBzZXQgb2YgY29sdW1ucyBjb250YWlucyBhbGwgdGhlCiAgICAgKiBj\nb2x1bW5zIGluIHRoZSBnaXZlbiBwb3RlbnRpYWwgc3Vic2V0LgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbHVt\nbltdIHNldCwgQ29sdW1uW10gc3ViKSB7CiAgICAgICAgaWYgKHN1Yi5sZW5n\ndGggPiBzZXQubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIC8vIHRoaXMgaXMgb2J2aW91c2x5IG5eMiwgYnV0IHRoZSBudW1i\nZXIgb2YgY29sdW1ucyBzaG91bGQgYmUgaW4KICAgICAgICAvLyB0aGUgMS0y\nIHJhbmdlLCBzbyBubyBiaWdnaWUKICAgICAgICBib29sZWFuIGZvdW5kID0g\ndHJ1ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1Yi5sZW5ndGgg\nJiYgZm91bmQ7IGkrKykgewogICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwog\nICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHNldC5sZW5ndGggJiYg\nIWZvdW5kOyBqKyspCiAgICAgICAgICAgICAgICBmb3VuZCA9IHN1YltpXSA9\nPSBzZXRbal07CiAgICAgICAgfQogICAgICAgIHJldHVybiBmb3VuZDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShKb2lucyBqb2lucykgewogICAg\nICAgIGlmIChqb2lucyAhPSBudWxsKQogICAgICAgICAgICB3aGVyZSgoU3Ry\naW5nKSBudWxsLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmUoU1FMQnVmZmVyIHNxbCkgewogICAgICAgIHdoZXJlKHNxbCwgKEpvaW5z\nKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTUUxCdWZm\nZXIgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIHdoZXJlKHNxbCwgZ2V0\nSm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBXSEVSRSBjbGF1c2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsLCBQ\nYXRoSm9pbnMgcGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lu\ncy4uLgogICAgICAgIGlmIChzcWwgPT0gbnVsbCB8fCBzcWwuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChfd2hlcmUgPT0g\nbnVsbCkKICAgICAgICAgICAgX3doZXJlID0gbmV3IFNRTEJ1ZmZlcihfZGlj\ndCk7CiAgICAgICAgZWxzZSBpZiAoIV93aGVyZS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIF93aGVyZS5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX3doZXJl\nLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFN0\ncmluZyBzcWwpIHsKICAgICAgICB3aGVyZShzcWwsIChKb2lucykgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoU3RyaW5nIHNxbCwgSm9p\nbnMgam9pbnMpIHsKICAgICAgICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIGNvbmRpdGlvbiB0byB0aGUgV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2hlcmUoU3RyaW5nIHNxbCwgUGF0aEpvaW5zIHBqKSB7\nCiAgICAgICAgLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzcWwpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmIChfd2hlcmUgPT0gbnVsbCkKICAgICAgICAgICAg\nX3doZXJlID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBp\nZiAoIV93aGVyZS5pc0VtcHR5KCkpCiAgICAgICAgICAgIF93aGVyZS5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgX3doZXJlLmFwcGVuZChzcWwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTUUxCdWZmZXIgc3FsKSB7CiAg\nICAgICAgaGF2aW5nKHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBoYXZpbmcoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBoYXZpbmcoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRp\nb24gdG8gdGhlIEhBVklORyBjbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBoYXZpbmcoU1FMQnVmZmVyIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAg\nICAgICAgLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAo\nc3FsID09IG51bGwgfHwgc3FsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpZiAoX2hhdmluZyA9PSBudWxsKQogICAgICAgICAg\nICBfaGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxz\nZSBpZiAoIV9oYXZpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICBfaGF2aW5n\nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBfaGF2aW5nLmFwcGVuZChzcWwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTdHJpbmcgc3FsKSB7\nCiAgICAgICAgaGF2aW5nKHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBoYXZpbmcoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBoYXZpbmcoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRp\nb24gdG8gdGhlIEhBVklORyBjbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBoYXZpbmcoU3RyaW5nIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAg\nICAgLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuaXNFbXB0eShzcWwpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGlmIChfaGF2aW5nID09IG51bGwpCiAgICAgICAgICAgIF9oYXZp\nbmcgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICgh\nX2hhdmluZy5pc0VtcHR5KCkpCiAgICAgICAgICAgIF9oYXZpbmcuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgIF9oYXZpbmcuYXBwZW5kKHNxbCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShTUUxCdWZmZXIgc3FsKSB7CiAg\nICAgICAgZ3JvdXBCeShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZ3JvdXBCeShTUUxCdWZmZXIgc3FsLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBn\ncm91cEJ5QXBwZW5kKHNxbC5nZXRTUUwoKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgZ3JvdXBCeShTdHJpbmcgc3FsKSB7CiAgICAgICAgZ3JvdXBCeShz\ncWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3Jv\ndXBCeShTdHJpbmcgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIGdldEpv\naW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBncm91cEJ5QXBwZW5kKHNxbCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW4gY29sKSB7\nCiAgICAgICAgZ3JvdXBCeShjb2wsIG51bGwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAg\nICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAg\nICAgICAgZ3JvdXBCeUFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW5bXSBjb2xz\nKSB7CiAgICAgICAgZ3JvdXBCeShjb2xzLCBudWxsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBncm91cEJ5KENvbHVtbltdIGNvbHMsIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRy\ndWUpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBncm91cEJ5QXBwZW5kKGdldENvbHVtbkFs\naWFzKGNvbHNbaV0sIHBqKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBw\ncml2YXRlIHZvaWQgZ3JvdXBCeUFwcGVuZChTdHJpbmcgc3FsKSB7CiAgICAg\nICAgaWYgKF9ncm91cGVkID09IG51bGwgfHwgIV9ncm91cGVkLmNvbnRhaW5z\nKHNxbCkpIHsKICAgICAgICAgICAgaWYgKF9ncm91cGluZyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBfZ3JvdXBpbmcgPSBuZXcgU1FMQnVmZmVyKF9k\naWN0KTsKICAgICAgICAgICAgICAgIF9ncm91cGVkID0gbmV3IEFycmF5TGlz\ndCgpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIF9ncm91\ncGluZy5hcHBlbmQoIiwgIik7CgogICAgICAgICAgICBfZ3JvdXBpbmcuYXBw\nZW5kKHNxbCk7CiAgICAgICAgICAgIF9ncm91cGVkLmFkZChzcWwpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywgSkRCQ1N0b3JlIHN0b3Jl\nLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAg\nICAgICBncm91cEJ5KG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRj\naCwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDbGFz\nc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsIEpEQkNTdG9yZSBz\ndG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBK\nb2lucyBqb2lucykgewogICAgICAgIC8vIHdlIGltcGxlbWVudCB0aGlzIGJ5\nIHB1dHRpbmcgb3Vyc2VsdmVzIGludG8gZ3JvdXBpbmcgbW9kZSwgd2hlcmUK\nICAgICAgICAvLyBhbGwgc2VsZWN0IGludm9jYXRpb25zIGFyZSByZS1yb3V0\nZWQgdG8gZ3JvdXAtYnkgaW52b2NhdGlvbnMgaW5zdGVhZC4KICAgICAgICAv\nLyB0aGlzIGFsbG93cyB1cyB0byB1dGlsaXplIHRoZSBzYW1lIHNlbGVjdCBB\nUElzIG9mIHRoZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgLy8gYW5kIGFsbCB0\naGUgbWFwcGluZyBzdHJhdGVnaWVzLCByYXRoZXIgdGhhbiBoYXZpbmcgdG8g\nY3JlYXRlIAogICAgICAgIC8vIGVxdWl2YWxlbnQgQVBJcyBhbmQgZHVwbGlj\nYXRlIGxvZ2ljIGZvciBncm91cGluZwogICAgICAgIGJvb2xlYW4gd2FzR3Jv\ndXBpbmcgPSBpc0dyb3VwaW5nKCk7CiAgICAgICAgX2ZsYWdzIHw9IEdST1VQ\nSU5HOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNlbGVjdChtYXBwaW5n\nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIAogICAgICAgICAgICAgICAg\nRWFnZXJGZXRjaE1vZGVzLkVBR0VSX05PTkUsIGpvaW5zKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoIXdhc0dyb3VwaW5nKQogICAg\nICAgICAgICAgICAgX2ZsYWdzICY9IH5HUk9VUElORzsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHdlJ3JlIGluIGdyb3VwIG1v\nZGUsIHdoZXJlIGFueSBzZWxlY3QgaXMgY2hhbmdlZCB0byBhIGdyb3VwLWJ5\nCiAgICAgKiBjYWxsLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNH\ncm91cGluZygpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEdST1VQSU5H\nKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2lu\ncyB0byB1c2UgZm9yIGNvbHVtbiBhbGlhc2VzLCBldGMuCiAgICAgKgogICAg\nICogQHBhcmFtIGpvaW5zIGpvaW5zIGdpdmVuIGJ5IHRoZSB1c2VyCiAgICAg\nKiBAcmV0dXJuIHRoZSBqb2lucyB0byB1c2UgZm9yIGFsaWFzZXMsIGV0Ywog\nICAgICovCiAgICBwcml2YXRlIFBhdGhKb2lucyBnZXRKb2lucyhKb2lucyBq\nb2lucywgYm9vbGVhbiByZWNvcmQpIHsKICAgICAgICBQYXRoSm9pbnMgcGog\nPSAoUGF0aEpvaW5zKSBqb2luczsKICAgICAgICBib29sZWFuIHByZSA9IChw\naiA9PSBudWxsIHx8ICFwai5pc0RpcnR5KCkpCiAgICAgICAgICAgICYmIF9w\ncmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgpOwogICAg\nICAgIGlmIChwcmUpCiAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgX3By\nZUpvaW5zLnBlZWsoKTsKCiAgICAgICAgaWYgKHBqID09IG51bGwgfHwgIXBq\nLmlzRGlydHkoKSkKICAgICAgICAgICAgcGogPSBfam9pbnM7CiAgICAgICAg\nZWxzZSBpZiAoIXByZSkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIE9V\nVEVSKSAhPSAwKQogICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBv\ndXRlcihwaik7CiAgICAgICAgICAgIGlmIChyZWNvcmQpIHsKICAgICAgICAg\nICAgICAgIGlmICghcGouaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBfam9pbnMgPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKF9qb2lucy5qb2lucygpID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIF9qb2lucy5zZXRKb2lucyhuZXcgSm9pblNldChw\nai5qb2lucygpKSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgICAgICBfam9pbnMuam9pbnMoKS5hZGRBbGwocGouam9p\nbnMoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHBqOwogICAgfQoKICAgIHB1YmxpYyBTZWxl\nY3RFeGVjdXRvciB3aGVyZUNsb25lKGludCBzZWxzKSB7CiAgICAgICAgaWYg\nKHNlbHMgPCAxKQogICAgICAgICAgICBzZWxzID0gMTsKCiAgICAgICAgU2Vs\nZWN0W10gY2xvbmVzID0gbnVsbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlbHM7IGkrKykgewogICAg\nICAgICAgICBzZWwgPSAoU2VsZWN0SW1wbCkgX2NvbmYuZ2V0U1FMRmFjdG9y\neUluc3RhbmNlKCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIHNlbC5fZmxh\nZ3MgPSBfZmxhZ3M7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkFHR1JF\nR0FURTsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+T1VURVI7CiAgICAg\nICAgICAgIHNlbC5fZmxhZ3MgJj0gfkxSUzsKICAgICAgICAgICAgc2VsLl9m\nbGFncyAmPSB+RUFHRVJfVE9fT05FOwogICAgICAgICAgICBzZWwuX2ZsYWdz\nICY9IH5FQUdFUl9UT19NQU5ZOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9\nIH5GT1JDRV9DT1VOVDsKICAgICAgICAgICAgc2VsLl9qb2luU3ludGF4ID0g\nX2pvaW5TeW50YXg7CiAgICAgICAgICAgIHNlbC5fc2NoZW1hQWxpYXMgPSBf\nc2NoZW1hQWxpYXM7CiAgICAgICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgc2VsLl9hbGlhc2VzID0gbmV3IEhhc2hNYXAo\nX2FsaWFzZXMpOwogICAgICAgICAgICBpZiAoX3RhYmxlcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgc2VsLl90YWJsZXMgPSBuZXcgVHJlZU1hcChfdGFi\nbGVzKTsKICAgICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgc2VsLl9qb2lucyA9IF9qb2lucy5jbG9uZShzZWwpOwogICAg\nICAgICAgICBpZiAoX3doZXJlICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nZWwuX3doZXJlID0gbmV3IFNRTEJ1ZmZlcihfd2hlcmUpOwogICAgICAgICAg\nICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9m\ncm9tID0gKFNlbGVjdEltcGwpIF9mcm9tLndoZXJlQ2xvbmUoMSk7CiAgICAg\nICAgICAgICAgICBzZWwuX2Zyb20uX291dGVyID0gc2VsOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBzZWwuX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0KF9zdWJz\nZWxzLnNpemUoKSk7CiAgICAgICAgICAgICAgICBTZWxlY3RJbXBsIHN1Yiwg\nc2VsU3ViOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBf\nc3Vic2Vscy5zaXplKCk7IGorKykgewogICAgICAgICAgICAgICAgICAgIHN1\nYiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaik7CiAgICAgICAgICAg\nICAgICAgICAgc2VsU3ViID0gKFNlbGVjdEltcGwpIHN1Yi5mdWxsQ2xvbmUo\nMSk7CiAgICAgICAgICAgICAgICAgICAgc2VsU3ViLl9wYXJlbnQgPSBzZWw7\nCiAgICAgICAgICAgICAgICAgICAgc2VsU3ViLl9zdWJQYXRoID0gc3ViLl9z\ndWJQYXRoOwogICAgICAgICAgICAgICAgICAgIHNlbC5fc3Vic2Vscy5hZGQo\nc2VsU3ViKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsLl93aGVyZSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWwuX3doZXJlLnJl\ncGxhY2Uoc3ViLCBzZWxTdWIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAoc2VscyA9PSAxKQogICAgICAgICAg\nICAgICAgcmV0dXJuIHNlbDsKICAgICAgICAgICAgaWYgKGNsb25lcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxz\nXTsKICAgICAgICAgICAgY2xvbmVzW2ldID0gc2VsOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3\nVW5pb24oY2xvbmVzKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0\nb3IgZnVsbENsb25lKGludCBzZWxzKSB7CiAgICAgICAgaWYgKHNlbHMgPCAx\nKQogICAgICAgICAgICBzZWxzID0gMTsKCiAgICAgICAgU2VsZWN0W10gY2xv\nbmVzID0gbnVsbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHNlbHM7IGkrKykgewogICAgICAgICAgICBz\nZWwgPSAoU2VsZWN0SW1wbCkgd2hlcmVDbG9uZSgxKTsKICAgICAgICAgICAg\nc2VsLl9mbGFncyA9IF9mbGFnczsKICAgICAgICAgICAgc2VsLl9leHBlY3Rl\nZFJlc3VsdENvdW50ID0gX2V4cGVjdGVkUmVzdWx0Q291bnQ7CiAgICAgICAg\nICAgIHNlbC5fc2VsZWN0cy5hZGRBbGwoX3NlbGVjdHMpOwogICAgICAgICAg\nICBpZiAoX29yZGVyaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwu\nX29yZGVyaW5nID0gbmV3IFNRTEJ1ZmZlcihfb3JkZXJpbmcpOwogICAgICAg\nICAgICBzZWwuX29yZGVycyA9IF9vcmRlcnM7CiAgICAgICAgICAgIGlmIChf\nZ3JvdXBpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fZ3JvdXBp\nbmcgPSBuZXcgU1FMQnVmZmVyKF9ncm91cGluZyk7CiAgICAgICAgICAgIGlm\nIChfaGF2aW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2hhdmlu\nZyA9IG5ldyBTUUxCdWZmZXIoX2hhdmluZyk7CiAgICAgICAgICAgIGlmIChf\nZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzZWwuX2Zyb20gPSAo\nU2VsZWN0SW1wbCkgX2Zyb20uZnVsbENsb25lKDEpOwogICAgICAgICAgICAg\nICAgc2VsLl9mcm9tLl9vdXRlciA9IHNlbDsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKHNlbHMgPT0gMSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBzZWw7CiAgICAgICAgICAgIGlmIChjbG9uZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107CiAgICAgICAg\nICAgIGNsb25lc1tpXSA9IHNlbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25l\ncyk7CiAgICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGVhZ2VyQ2xv\nbmUoRmllbGRNYXBwaW5nIGtleSwgaW50IGVhZ2VyVHlwZSwKICAgICAgICBi\nb29sZWFuIHRvTWFueSwgaW50IHNlbHMpIHsKICAgICAgICBpZiAoZWFnZXJU\neXBlID09IEVBR0VSX09VVEVSCiAgICAgICAgICAgICYmIF9qb2luU3ludGF4\nID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChfZWFnZXJLZXlzICE9IG51\nbGwgJiYgX2VhZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gZ2xvYmFsIHNldCBvZiBlYWdlciBr\nZXlzCiAgICAgICAgaWYgKF9lYWdlcktleXMgPT0gbnVsbCkKICAgICAgICAg\nICAgX2VhZ2VyS2V5cyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgX2VhZ2Vy\nS2V5cy5hZGQoa2V5KTsKCiAgICAgICAgU2VsZWN0RXhlY3V0b3Igc2VsOwog\nICAgICAgIGlmIChlYWdlclR5cGUgIT0gRUFHRVJfUEFSQUxMRUwpIHsKICAg\nICAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAgICAgICAgIF9mbGFncyB8\nPSBFQUdFUl9UT19NQU5ZOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBfZmxhZ3MgfD0gRUFHRVJfVE9fT05FOwogICAgICAgICAgICBzZWwg\nPSB0aGlzOwogICAgICAgIH0gZWxzZSBpZiAoc2VscyA8IDIpCiAgICAgICAg\nICAgIHNlbCA9IHBhcmFsbGVsQ2xvbmUoKTsKICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgU2VsZWN0W10gY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbG9uZXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBjbG9uZXNbaV0gPSBwYXJhbGxlbENs\nb25lKCk7CiAgICAgICAgICAgIHNlbCA9IF9jb25mLmdldFNRTEZhY3RvcnlJ\nbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25lcyk7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoX2VhZ2VyID09IG51bGwpCiAgICAgICAgICAgIF9lYWdlciA9IG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgX2VhZ2VyLnB1dCh0b0VhZ2VyS2V5KGtl\neSwgZ2V0Sm9pbnMobnVsbCwgZmFsc2UpKSwgc2VsKTsKICAgICAgICByZXR1\ncm4gc2VsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY2xvbmUg\nb2YgdGhpcyBzZWxlY3QgZm9yIHVzZSBpbiBlYWdlciBwYXJhbGxlbCBzZWxl\nY3RzLgogICAgICovCiAgICBwcml2YXRlIFNlbGVjdEltcGwgcGFyYWxsZWxD\nbG9uZSgpIHsKICAgICAgICBTZWxlY3RJbXBsIHNlbCA9IChTZWxlY3RJbXBs\nKSB3aGVyZUNsb25lKDEpOwogICAgICAgIHNlbC5fZmxhZ3MgJj0gfk5PTkFV\nVE9fRElTVElOQ1Q7CiAgICAgICAgc2VsLl9lYWdlcktleXMgPSBfZWFnZXJL\nZXlzOwogICAgICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpv\naW5zLmlzRW1wdHkoKSkgewogICAgICAgICAgICBzZWwuX3ByZUpvaW5zID0g\nbmV3IFN0YWNrKCk7CiAgICAgICAgICAgIHNlbC5fcHJlSm9pbnMucHVzaCgo\nKFNlbGVjdEpvaW5zKSBfcHJlSm9pbnMucGVlaygpKS4KICAgICAgICAgICAg\nICAgIGNsb25lKHNlbCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2Vs\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHZpZXcgb2YgZWFnZXIg\nc2VsZWN0cy4gTWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBNYXAg\nZ2V0RWFnZXJNYXAoKSB7CiAgICAgICAgcmV0dXJuIF9lYWdlcjsKICAgIH0K\nCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3IgZ2V0RWFnZXIoRmllbGRNYXBw\naW5nIGtleSkgewogICAgICAgIGlmIChfZWFnZXIgPT0gbnVsbCB8fCAhX2Vh\nZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICByZXR1cm4gKFNlbGVjdEV4ZWN1dG9yKSBfZWFnZXIuZ2V0\nKHRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsLAogICAgICAgICAgICBm\nYWxzZSkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZWFn\nZXIga2V5IHRvIHVzZSBmb3IgdGhlIHVzZXItZ2l2ZW4ga2V5LgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgdG9FYWdlcktleShGaWVsZE1h\ncHBpbmcga2V5LCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBpZiAocGogPT0g\nbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGtleTsKICAgICAgICByZXR1cm4gbmV3IEtleShwai5wYXRoKCkudG9TdHJp\nbmcoKSwga2V5KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgbmV3Sm9pbnMo\nKSB7CiAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9p\nbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIFNlbGVjdEpvaW5zIHNqID0g\nKFNlbGVjdEpvaW5zKSBfcHJlSm9pbnMucGVlaygpOwogICAgICAgICAgICBy\nZXR1cm4gc2ouY2xvbmUodGhpcyk7CiAgICAgICAgfQogICAgICAgIC8vIHJl\ndHVybiB0aGlzIGZvciBlZmZpY2llbmN5IGluIGNhc2Ugbm8gam9pbnMgZW5k\nIHVwIGJlaW5nIG1hZGUKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgSm9pbnMgbmV3T3V0ZXJKb2lucygpIHsKICAgICAgICByZXR1\ncm4gKChQYXRoSm9pbnMpIG5ld0pvaW5zKCkpLnNldE91dGVyKHRydWUpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZChTUUxCdWZmZXIgYnVmLCBK\nb2lucyBqb2lucykgewogICAgICAgIGlmIChqb2lucyA9PSBudWxsIHx8IGpv\naW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlm\nIChfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1NRTDkyKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmICghYnVmLmlzRW1wdHko\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBK\nb2luIGpvaW4gPSBudWxsOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nKChQYXRoSm9pbnMpIGpvaW5zKS5qb2lucygpLmpvaW5JdGVyYXRvcigpOwog\nICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2lu\nID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHN3aXRjaCAoX2pv\naW5TeW50YXgpIHsKICAgICAgICAgICAgICAgIGNhc2UgSm9pblN5bnRheGVz\nLlNZTlRBWF9UUkFESVRJT05BTDoKICAgICAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKF9kaWN0LnRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSm9p\nblN5bnRheGVzLlNZTlRBWF9EQVRBQkFTRToKICAgICAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKF9kaWN0LnRvTmF0aXZlSm9pbihqb2luKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXRyLmhh\nc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBKb2lucyBhbmQoSm9pbnMg\nam9pbnMxLCBKb2lucyBqb2luczIpIHsKICAgICAgICByZXR1cm4gYW5kKChQ\nYXRoSm9pbnMpIGpvaW5zMSwgKFBhdGhKb2lucykgam9pbnMyLCB0cnVlKTsK\nICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0IGdldFNlbGVjdCgpIHsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbWJpbmUg\ndGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIFNlbGVjdEpv\naW5zIGFuZChQYXRoSm9pbnMgajEsIFBhdGhKb2lucyBqMiwgYm9vbGVhbiBu\ndWxsSm9pbnMpIHsKICAgICAgICBpZiAoKGoxID09IG51bGwgfHwgajEuaXNF\nbXB0eSgpKQogICAgICAgICAgICAmJiAoajIgPT0gbnVsbCB8fCBqMi5pc0Vt\ncHR5KCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU2Vs\nZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CiAgICAgICAg\naWYgKGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nIGlmIChqMi5nZXRTZWxlY3QoKSA9PSB0aGlzKSB7CiAgICAgICAgICAgICAg\nICBpZiAobnVsbEpvaW5zKQogICAgICAgICAgICAgICAgICAgIHNqLnNldEpv\naW5zKGoyLmpvaW5zKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHNqLnNldEpvaW5zKG5ldyBKb2luU2V0KGoyLmpvaW5z\nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIEpvaW5TZXQgc2V0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKGoxLmdl\ndFNlbGVjdCgpID09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmIChudWxs\nSm9pbnMpCiAgICAgICAgICAgICAgICAgICAgc2V0ID0gajEuam9pbnMoKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXQg\nPSBuZXcgSm9pblNldChqMS5qb2lucygpKTsKCiAgICAgICAgICAgICAgICBp\nZiAoajIgIT0gbnVsbCAmJiAhajIuaXNFbXB0eSgpCiAgICAgICAgICAgICAg\nICAgICAgJiYgajIuZ2V0U2VsZWN0KCkgPT0gdGhpcykKICAgICAgICAgICAg\nICAgICAgICBzZXQuYWRkQWxsKGoyLmpvaW5zKCkpOwogICAgICAgICAgICAg\nICAgc2ouc2V0Sm9pbnMoc2V0KTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gbnVsbCBwcmV2aW91cyBqb2luczsgYWxsIGFyZSBjb21i\naW5lZCBpbnRvIHRoaXMgb25lCiAgICAgICAgaWYgKG51bGxKb2lucyAmJiBq\nMSAhPSBudWxsKQogICAgICAgICAgICBqMS5udWxsSm9pbnMoKTsKICAgICAg\nICBpZiAobnVsbEpvaW5zICYmIGoyICE9IG51bGwpCiAgICAgICAgICAgIGoy\nLm51bGxKb2lucygpOwoKICAgICAgICByZXR1cm4gc2o7CiAgICB9CgogICAg\ncHVibGljIEpvaW5zIG9yKEpvaW5zIGpvaW5zMSwgSm9pbnMgam9pbnMyKSB7\nCiAgICAgICAgUGF0aEpvaW5zIGoxID0gKFBhdGhKb2lucykgam9pbnMxOwog\nICAgICAgIFBhdGhKb2lucyBqMiA9IChQYXRoSm9pbnMpIGpvaW5zMjsKCiAg\nICAgICAgLy8gaWYgbm8gY29tbW9uIGpvaW5zLCByZXR1cm4gbnVsbDsgaWYg\nb25lIHNpZGUgb2YgdGhlIG9yIGNsYXVzZSBoYXMKICAgICAgICAvLyBkaWZm\nZXJlbnQgam9pbnMgdGhhbiB0aGUgb3RoZXIsIHRoZW4gd2UgbmVlZCB0byB1\nc2UgZGlzdGluY3QKICAgICAgICBib29sZWFuIGoxRW1wdHkgPSBqMSA9PSBu\ndWxsIHx8IGoxLmlzRW1wdHkoKTsKICAgICAgICBib29sZWFuIGoyRW1wdHkg\nPSBqMiA9PSBudWxsIHx8IGoyLmlzRW1wdHkoKTsKICAgICAgICBpZiAoajFF\nbXB0eSB8fCBqMkVtcHR5KSB7CiAgICAgICAgICAgIGlmIChqMUVtcHR5ICYm\nICFqMkVtcHR5KSB7CiAgICAgICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lu\ncyhqMik7CiAgICAgICAgICAgICAgICBpZiAoIWoyLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoajJFbXB0eSAmJiAhajFFbXB0eSkg\newogICAgICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajEpOwogICAg\nICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgYWxsIGNvbW1vbiBqb2lucywgbW92ZSBhbGwgam9pbnMgdG8g\ncmV0dXJuZWQgaW5zdGFuY2UKICAgICAgICBTZWxlY3RKb2lucyBzaiA9IG5l\ndyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAgICBpZiAoajEuam9pbnMoKS5l\ncXVhbHMoajIuam9pbnMoKSkpIHsKICAgICAgICAgICAgc2ouc2V0Sm9pbnMo\najEuam9pbnMoKSk7CiAgICAgICAgICAgIGoxLm51bGxKb2lucygpOwogICAg\nICAgICAgICBqMi5udWxsSm9pbnMoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBKb2luU2V0IGNvbW1vbkpvaW5zID0gbmV3IEpvaW5TZXQoajEu\nam9pbnMoKSk7CiAgICAgICAgICAgIGNvbW1vbkpvaW5zLnJldGFpbkFsbChq\nMi5qb2lucygpKTsKICAgICAgICAgICAgaWYgKCFjb21tb25Kb2lucy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgICAgIC8vIHB1dCBjb21tb24gam9pbnMg\naW4gcmV0dXJuZWQgaW5zdGFuY2U7IHJlbW92ZSB0aGVtIGZyb20KICAgICAg\nICAgICAgICAgIC8vIGVhY2ggZ2l2ZW4gaW5zdGFuY2UKICAgICAgICAgICAg\nICAgIHNqLnNldEpvaW5zKGNvbW1vbkpvaW5zKTsKICAgICAgICAgICAgICAg\nIGoxLmpvaW5zKCkucmVtb3ZlQWxsKGNvbW1vbkpvaW5zKTsKICAgICAgICAg\nICAgICAgIGoyLmpvaW5zKCkucmVtb3ZlQWxsKGNvbW1vbkpvaW5zKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lucyhqMSk7\nCiAgICAgICAgICAgIGNvbGxlY3RPdXRlckpvaW5zKGoyKTsKCiAgICAgICAg\nICAgIC8vIGlmIG9uZSBzaWRlIG9mIHRoZSBvciBjbGF1c2UgaGFzIGRpZmZl\ncmVudCBqb2lucyB0aGFuIHRoZSBvdGhlciwKICAgICAgICAgICAgLy8gdGhl\nbiB3ZSBuZWVkIHRvIHVzZSBkaXN0aW5jdAogICAgICAgICAgICBpZiAoIWox\nLmlzRW1wdHkoKSB8fCAhajIuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gc2o7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG91dGVyKEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKF9qb2luU3ludGF4ID09IEpvaW5T\neW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwgfHwgam9pbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwoKICAgICAgICAvLyByZWNvcmQg\ndGhhdCB0aGlzIGlzIGFuIG91dGVyIGpvaW4gc2V0LCBldmVuIGlmIGl0J3Mg\nZW1wdHkKICAgICAgICBQYXRoSm9pbnMgcGogPSAoKFBhdGhKb2lucykgam9p\nbnMpLnNldE91dGVyKHRydWUpOwogICAgICAgIGlmIChwai5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBwajsKCiAgICAgICAgSm9pbiBqb2luOwog\nICAgICAgIEpvaW4gcmVjOwogICAgICAgIGJvb2xlYW4gaGFzSm9pbnMgPSBf\nam9pbnMgIT0gbnVsbCAmJiBfam9pbnMuam9pbnMoKSAhPSBudWxsOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGouam9pbnMoKS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2luID0gKEpvaW4p\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9\nPSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAgICAgICAgICAgIGlmICghaGFz\nSm9pbnMpCiAgICAgICAgICAgICAgICAgICAgam9pbi5zZXRUeXBlKEpvaW4u\nVFlQRV9PVVRFUik7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICByZWMgPSBfam9pbnMuam9pbnMoKS5nZXRSZWNvcmRlZEpv\naW4oam9pbik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYyA9PSBudWxs\nIHx8IHJlYy5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAg\nICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5UWVBFX09VVEVS\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nb3ZlcyB0aGUgam9pbnMgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgaW50byBv\ndXIgb3V0ZXIgam9pbnMgc2V0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nY29sbGVjdE91dGVySm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYg\nKF9qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9O\nQUwgfHwgcGogPT0gbnVsbAogICAgICAgICAgICB8fCBwai5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9qb2lucyA9PSBu\ndWxsKQogICAgICAgICAgICBfam9pbnMgPSBuZXcgU2VsZWN0Sm9pbnModGhp\ncyk7CgogICAgICAgIGJvb2xlYW4gYWRkID0gdHJ1ZTsKICAgICAgICBpZiAo\nX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkgewogICAgICAgICAgICBfam9pbnMu\nc2V0Sm9pbnMocGouam9pbnMoKSk7CiAgICAgICAgICAgIGFkZCA9IGZhbHNl\nOwogICAgICAgIH0KCiAgICAgICAgSm9pbiBqb2luOwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gcGouam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICBqb2luID0gKEpvaW4pIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZ\nUEVfSU5ORVIpIHsKICAgICAgICAgICAgICAgIGlmIChqb2luLmdldEZvcmVp\nZ25LZXkoKSAhPSBudWxsCiAgICAgICAgICAgICAgICAgICAgJiYgIV9kaWN0\nLmNhbk91dGVySm9pbihfam9pblN5bnRheCwgam9pbi5nZXRGb3JlaWduS2V5\nKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgTG9nIGxvZyA9IF9jb25mLmdl\ndExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRCQyk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJjYW50LW91dGVyLWZr\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW4uZ2V0Rm9yZWln\nbktleSgpKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5UWVBFX09VVEVSKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoYWRkKQogICAgICAgICAgICAgICAg\nX2pvaW5zLmpvaW5zKCkuYWRkKGpvaW4pOwogICAgICAgIH0KICAgICAgICBw\nai5udWxsSm9pbnMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgYWxpYXMgZm9yIHRoZSBnaXZlbiB0YWJsZSB1bmRlciB0aGUgZ2l2ZW4g\nam9pbnMuCiAgICAgKiBOT1RFOiBXRSBSRUxZIE9OIFRIRVNFIElOREVYRVMg\nQkVJTkcgTU9OT1RPTklDQUxMWSBJTkNSRUFTSU5HIEZST00gMAogICAgICov\nCiAgICBwcml2YXRlIGludCBnZXRUYWJsZUluZGV4KFRhYmxlIHRhYmxlLCBQ\nYXRoSm9pbnMgcGosIGJvb2xlYW4gY3JlYXRlKSB7CiAgICAgICAgLy8gaWYg\nd2UgaGF2ZSBhIGZyb20gc2VsZWN0LCB0aGVuIHRoZXJlIGFyZSBubyB0YWJs\nZSBhbGlhc2VzCiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiAtMTsKCiAgICAgICAgSW50ZWdlciBpID0gbnVsbDsKICAg\nICAgICBPYmplY3Qga2V5ID0gdGFibGUuZ2V0RnVsbElkZW50aWZpZXIoKS5n\nZXROYW1lKCk7CiAgICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgp\nICE9IG51bGwpCiAgICAgICAgICAgIGtleSA9IG5ldyBLZXkocGoucGF0aCgp\nLnRvU3RyaW5nKCksIGtleSk7CgogICAgICAgIGlmIChfY3R4ICE9IG51bGwp\nCiAgICAgICAgICAgIGkgPSBmaW5kQWxpYXNGb3JRdWVyeSh0YWJsZSwgcGos\nIGtleSwgY3JlYXRlKTsKCiAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKCiAgICAgICAgLy8gY2hlY2sg\nb3V0IGV4aXN0aW5nIGFsaWFzZXMKICAgICAgICBpID0gZmluZEFsaWFzKHRh\nYmxlLCBrZXkpOwoKICAgICAgICBpZiAoaSAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgICAgIGlmICghY3JlYXRlKQog\nICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAgIC8vIG5vdCBmb3VuZDsg\nY3JlYXRlIGFsaWFzCiAgICAgICAgaSA9IE51bWJlcnMudmFsdWVPZihhbGlh\nc1NpemUobnVsbCkpOwovLyAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJH\nZXRUYWJsZUluZGV4XHQiKwovLyAgICAgICAgICAgICAgICAoKF9wYXJlbnQg\nIT0gbnVsbCkgPyAiU3ViIiA6IiIpICsKLy8gICAgICAgICAgICAgICAgIiBj\ncmVhdGVkIGFsaWFzOiAiKwovLyAgICAgICAgICAgICAgICBpLmludFZhbHVl\nKCkrICIgIisga2V5KTsKICAgICAgICByZWNvcmRUYWJsZUFsaWFzKHRhYmxl\nLCBrZXksIGkpOwogICAgICAgIHJldHVybiBpLmludFZhbHVlKCk7CiAgICB9\nCgogICAgcHJpdmF0ZSBJbnRlZ2VyIGZpbmRBbGlhc0ZvclF1ZXJ5KFRhYmxl\nIHRhYmxlLCBQYXRoSm9pbnMgcGosIE9iamVjdCBrZXksCiAgICAgICAgYm9v\nbGVhbiBjcmVhdGUpIHsKICAgICAgICBJbnRlZ2VyIGkgPSBudWxsOwogICAg\nICAgIFNlbGVjdEltcGwgc2VsID0gdGhpczsKICAgICAgICBTdHJpbmcgYWxp\nYXMgPSBfc2NoZW1hQWxpYXM7CiAgICAgICAgaWYgKGlzUGF0aEluVGhpc0Nv\nbnRleHQocGopIHx8IHRhYmxlLmlzQXNzb2NpYXRpb24oKSkgICAgICAgICAg\nCiAgICAgICAgICAgIGFsaWFzID0gbnVsbDsKCiAgICAgICAgLy8gZmluZCB0\naGUgY29udGV4dCB3aGVyZSB0aGlzIGFsaWFzIGlzIGRlZmluZWQKICAgICAg\nICBDb250ZXh0IGN0eCA9IChhbGlhcyAhPSBudWxsKSA/CiAgICAgICAgICAg\nIF9jdHguZmluZENvbnRleHQoYWxpYXMpIDogbnVsbDsKICAgICAgICBpZiAo\nY3R4ICE9IG51bGwpCiAgICAgICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSBj\ndHguZ2V0U2VsZWN0KCk7CgogICAgICAgIGlmICghY3JlYXRlKSAKICAgICAg\nICAgICAgaSA9IHNlbC5maW5kQWxpYXModGFibGUsIGtleSk7ICAvLyBmaW5k\nIGluIHBhcmVudCBhbmQgaW4gbXlzZWxmCiAgICAgICAgZWxzZQogICAgICAg\nICAgICBpID0gc2VsLmdldEFsaWFzKHRhYmxlLCBrZXkpOyAvLyBmaW5kIGlu\nIG15c2VsZgogICAgICAgIGlmIChpICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBpOwogICAgICAgIAogICAgICAgIGlmIChjcmVhdGUpIHsgLy8gY3Jl\nYXRlIGhlcmUKICAgICAgICAgICAgaSA9IHNlbC5jcmVhdGVBbGlhcyh0YWJs\nZSwga2V5KTsKICAgICAgICB9IGVsc2UgaWYgKGN0eCAhPSBudWxsICYmIGN0\neCAhPSBjdHgoKSkgeyAvLyBjcmVhdGUgaW4gb3RoZXIgc2VsZWN0CiAgICAg\nICAgICAgIGkgPSAoKFNlbGVjdEltcGwpY3R4LmdldFNlbGVjdCgpKS5jcmVh\ndGVBbGlhcyh0YWJsZSwga2V5KTsKICAgICAgICB9CgogICAgICAgIHJldHVy\nbiBpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBpc1BhdGhJblRoaXND\nb250ZXh0KFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIGN1cnJDdHggaXMg\nc2V0IGZyb20gQWN0aW9uLCBpdCBpcyByZXNldCB0byBudWxsIGFmdGVyIHRo\nZSBQQ1BhdGggaW5pdGlhbGl6YXRpb24KICAgICAgICBDb250ZXh0IGN1cnJD\ndHggPSBwaiA9PSBudWxsID8gbnVsbCA6ICgoUGF0aEpvaW5zSW1wbClwaiku\nY29udGV4dDsKICAgICAgICAKICAgICAgICAvLyBsYXN0Q3R4IGlzIHNldCB0\nbyBjdXJyQ3R4IGFmdGVyIHRoZSBTZWxlY3RKb2lucy5qb2luLiBwai5sYXN0\nQ3R4IGFuZCBwai5wYXRoIHN0cmluZyBhcmUgCiAgICAgICAgLy8gdGhlIGxh\nc3Qgc25hcHNob3Qgb2YgcGouIFRoZXkgd2lsbCBiZSB1c2VkIHRvZ2V0aGVy\nIGZvciBsYXRlciB0YWJsZSBhbGlhcyByZXNvbHV0aW9uIGluCiAgICAgICAg\nLy8gdGhlIGdldENvbHVtbkFsaWFzKCkuIAogICAgICAgIENvbnRleHQgbGFz\ndEN0eCA9IHBqID09IG51bGwgPyBudWxsIDogKChQYXRoSm9pbnNJbXBsKXBq\nKS5sYXN0Q29udGV4dDsKICAgICAgICBDb250ZXh0IHRoaXNDdHggPSBjdXJy\nQ3R4ID09IG51bGwgPyBsYXN0Q3R4IDogY3VyckN0eDsKICAgICAgICBTdHJp\nbmcgY29yclZhciA9IHBqID09IG51bGwgPyBudWxsIDogcGouZ2V0Q29ycmVs\nYXRlZFZhcmlhYmxlKCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChwaiAh\nPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsICYmIAogICAgICAgICAgICAo\nY29yclZhciA9PSBudWxsIHx8ICh0aGlzQ3R4ICE9IG51bGwgJiYgY3R4KCkg\nPT0gdGhpc0N0eCkpKTsKICAgIH0KIAogICAgcHJpdmF0ZSBJbnRlZ2VyIGdl\ndEFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qga2V5KSB7CiAgICAgICAgSW50\nZWdlciBhbGlhcyA9IG51bGw7CiAgICAgICAgaWYgKF9hbGlhc2VzICE9IG51\nbGwpCiAgICAgICAgICAgIGFsaWFzID0gKEludGVnZXIpIF9hbGlhc2VzLmdl\ndChrZXkpOwogICAgICAgIHJldHVybiBhbGlhczsKICAgIH0KCiAgICBwcml2\nYXRlIGludCBjcmVhdGVBbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtleSkg\newogICAgICAgIEludGVnZXIgaSA9IE51bWJlcnMudmFsdWVPZihjdHgoKS5u\nZXh0QWxpYXMoKSk7Ci8vICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlx0\nIisKLy8gICAgICAgICAgICAgICAgKChfcGFyZW50ICE9IG51bGwpID8gIlN1\nYiIgOiIiKSArCi8vICAgICAgICAgICAgICAgICJRdWVyeSBjcmVhdGVkIGFs\naWFzOiAiKyAKLy8gICAgICAgICAgICAgICAgaS5pbnRWYWx1ZSgpKyAiICIr\nIGtleSk7CiAgICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBp\nKTsKICAgICAgICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIHBy\naXZhdGUgSW50ZWdlciBmaW5kQWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBr\nZXkpIHsKICAgICAgICBJbnRlZ2VyIGFsaWFzID0gbnVsbDsKICAgICAgICBp\nZiAoX2FsaWFzZXMgIT0gbnVsbCkgewogICAgICAgICAgICBhbGlhcyA9IChJ\nbnRlZ2VyKSBfYWxpYXNlcy5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKGFs\naWFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhbGlhczsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX3BhcmVudCAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGFsaWFzID0gX3BhcmVudC5maW5kQWxp\nYXModGFibGUsIGtleSk7CiAgICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVjb3JkIHRoZSBtYXBwaW5nIG9mIHRoZSBnaXZlbiBr\nZXkgdG8gdGhlIGdpdmVuIGFsaWFzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVjb3JkVGFibGVBbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtleSwg\nSW50ZWdlciBhbGlhcykgewogICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxs\nKQogICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAg\nICAgX2FsaWFzZXMucHV0KGtleSwgYWxpYXMpOwoKICAgICAgICBTdHJpbmcg\ndGFibGVTdHJpbmcgPSBfZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2Up\nICsgIiAiCiAgICAgICAgICAgICsgdG9BbGlhcyhhbGlhcy5pbnRWYWx1ZSgp\nKTsKICAgICAgICBpZiAoX3RhYmxlcyA9PSBudWxsKQogICAgICAgICAgICBf\ndGFibGVzID0gbmV3IFRyZWVNYXAoKTsKICAgICAgICBfdGFibGVzLnB1dChh\nbGlhcywgdGFibGVTdHJpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQ2Fs\nY3VsYXRlIHRvdGFsIG51bWJlciBvZiBhbGlhc2VzLgogICAgICovCiAgICBw\ncml2YXRlIGludCBhbGlhc1NpemUoU2VsZWN0SW1wbCBmcm9tU3ViKSB7CiAg\nICAgICAgaW50IGFsaWFzZXMgPSAoX3BhcmVudCA9PSBudWxsKSA/IDAKICAg\nICAgICAgICAgOiBfcGFyZW50LmFsaWFzU2l6ZSh0aGlzKTsKICAgICAgICBh\nbGlhc2VzICs9IChfYWxpYXNlcyA9PSBudWxsKSA/IDAgOiBfYWxpYXNlcy5z\naXplKCk7CiAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwpIHsKICAgICAg\nICAgICAgU2VsZWN0SW1wbCBzdWI7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAg\nICAgIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAg\nICAgICAgICAgICBpZiAoc3ViICE9IGZyb21TdWIpCiAgICAgICAgICAgICAg\nICAgICAgYWxpYXNlcyArPSBzdWIuYWxpYXNTaXplKG51bGwpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbGlhc2VzOwogICAg\nfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAg\nIHJldHVybiB0b1NlbGVjdChmYWxzZSwgbnVsbCkuZ2V0U1FMKCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUGF0\naEpvaW5zIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIFBhdGhKb2lu\ncyBzZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBTZWxlY3RKb2lucyh0aGlzKS5zZXRPdXRlcih0cnVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nQnVpbGRlciBwYXRoKCkg\newogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBKb2lu\nU2V0IGpvaW5zKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgIHJldHVybiAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUg\nbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5jcm9zc0pvaW4obG9jYWxUYWJs\nZSwgZm9yZWlnblRhYmxlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9p\nbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9N\nYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5q\nb2luKGZrLCBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBK\nb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNl\nLCBib29sZWFuIHRvTWFueSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0\nSm9pbnModGhpcykub3V0ZXJKb2luKGZrLCBpbnZlcnNlLCB0b01hbnkpOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5h\nbWUsIEZvcmVpZ25LZXkgZmssIENsYXNzTWFwcGluZyB0YXJnZXQsCiAgICAg\nICAgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkp\nIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW5S\nZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAg\naW52ZXJzZSwgdG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3V0\nZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAog\nICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFu\nIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBTZWxlY3RKb2lucyh0aGlzKS5vdXRlckpvaW5SZWxhdGlvbihuYW1lLCBm\naywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55\nKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5n\nIHZhcikgewogICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0\naGlzKS5zZXRWYXJpYWJsZSh2YXIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lu\ncyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgaWYgKGFs\naWFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0U3Vic2VsZWN0KGFs\naWFzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSBTUUwg\nc3RyaW5nIHNlbGVjdGVkIHdpdGggbnVsbCBpZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgTnVsbElkIHsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlcHJlc2VudHMgYSBwbGFjZWhvbGRlciBTUUwgc3RyaW5nLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQbGFjZWhvbGRlciB7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBTZWxlY3RJbXBsIGNsb25lKENvbnRleHQg\nY3R4KSB7CiAgICAgICAgU2VsZWN0SW1wbCBzZWwgPSAoU2VsZWN0SW1wbCkg\nX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3U2VsZWN0KCk7CiAg\nICAgICAgc2VsLl9jdHggPSBjdHg7CiAgICAgICAgaWYgKF9wYXJlbnQgIT0g\nbnVsbCAmJiBfcGFyZW50LmN0eCgpICE9IG51bGwpCiAgICAgICAgICAgIHNl\nbC5fcGFyZW50ID0gKFNlbGVjdEltcGwpX3BhcmVudC5jdHgoKS5nZXRTZWxl\nY3QoKTsKICAgICAgICBzZWwuX3NjaGVtYUFsaWFzID0gX3NjaGVtYUFsaWFz\nOwogICAgICAgIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAgcmV0dXJu\nIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIEtleSB0eXBlIHVzZWQgZm9y\nIGFsaWFzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEtl\neSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9wYXRoOwogICAg\nICAgIHByaXZhdGUgZmluYWwgT2JqZWN0IF9rZXk7CgogICAgICAgIHB1Ymxp\nYyBLZXkoU3RyaW5nIHBhdGgsIE9iamVjdCBrZXkpIHsKICAgICAgICAgICAg\nX3BhdGggPSBwYXRoOwogICAgICAgICAgICBfa2V5ID0ga2V5OwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9wYXRoLmhhc2hDb2RlKCkgXiBfa2V5Lmhhc2hDb2RlKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2Jq\nZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChv\ndGhlci5nZXRDbGFzcygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIEtleSBrID0gKEtleSkgb3Ro\nZXI7CiAgICAgICAgICAgIHJldHVybiBrLl9wYXRoLmVxdWFscyhfcGF0aCkg\nJiYgay5fa2V5LmVxdWFscyhfa2V5KTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBf\ncGF0aCArICJ8IiArIF9rZXk7CiAgICAgICAgfQogICAgICAgIAogICAgICAg\nIE9iamVjdCBnZXRLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBfa2V5Owog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEge0BsaW5rIFJlc3Vs\ndH0gaW1wbGVtZW50YXRpb24gd3JhcHBlZCBhcm91bmQgdGhpcyBzZWxlY3Qu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2VsZWN0UmVzdWx0\nCiAgICAgICAgZXh0ZW5kcyBSZXN1bHRTZXRSZXN1bHQKICAgICAgICBpbXBs\nZW1lbnRzIFBhdGhKb2lucyB7CgogICAgICAgIHByaXZhdGUgU2VsZWN0SW1w\nbCBfc2VsID0gbnVsbDsKCiAgICAgICAgLy8gcG9zaXRpb24gaW4gc2VsZWN0\nZWQgY29sdW1ucyBsaXN0IHdoZXJlIHdlIGV4cGVjdCB0aGUgbmV4dCBsb2Fk\nCiAgICAgICAgcHJpdmF0ZSBpbnQgX3BvcyA9IDA7CiAgICAgICAgcHJpdmF0\nZSBTdGFjayBfcHJlSm9pbnMgPSBudWxsOwoKICAgICAgICAvKioKICAgICAg\nICAgKiBDb25zdHJ1Y3Rvci4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\nU2VsZWN0UmVzdWx0KENvbm5lY3Rpb24gY29ubiwgU3RhdGVtZW50IHN0bW50\nLCBSZXN1bHRTZXQgcnMsCiAgICAgICAgICAgIERCRGljdGlvbmFyeSBkaWN0\nKSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4sIHN0bW50LCBycywgZGljdCk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9y\nIHRoaXMgcmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTZWxl\nY3RJbXBsIGdldFNlbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZWw7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9y\nIHRoaXMgcmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIHNldFNlbGVjdChTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAgICBfc2Vs\nID0gc2VsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRF\nYWdlcihGaWVsZE1hcHBpbmcga2V5KSB7CiAgICAgICAgICAgIC8vIGRvbid0\nIGJvdGhlciBjcmVhdGluZyBrZXkgaWYgd2Uga25vdyB3ZSBkb24ndCBoYXZl\nIGFueQogICAgICAgICAgICAvLyBlYWdlciByZXN1bHRzCiAgICAgICAgICAg\nIGlmIChfc2VsLl9lYWdlciA9PSBudWxsIHx8ICFfc2VsLl9lYWdlcktleXMu\nY29udGFpbnMoa2V5KSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICBNYXAgbWFwID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFn\nZXJNYXAodHJ1ZSk7CiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4g\nbWFwLmdldChfc2VsLnRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSkp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHV0RWFnZXIoRmll\nbGRNYXBwaW5nIGtleSwgT2JqZWN0IHJlcykgewogICAgICAgICAgICBNYXAg\nbWFwID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAodHJ1ZSk7CiAg\nICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nbWFwID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHNldEVhZ2Vy\nTWFwKG1hcCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFwLnB1dChf\nc2VsLnRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSksIHJlcyk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGxvYWQoQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpCiAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBib29s\nZWFuIGhhc0pvaW5zID0gam9pbnMgIT0gbnVsbAogICAgICAgICAgICAgICAg\nJiYgKChQYXRoSm9pbnMpIGpvaW5zKS5wYXRoKCkgIT0gbnVsbDsKICAgICAg\nICAgICAgaWYgKGhhc0pvaW5zKSB7CiAgICAgICAgICAgICAgICBpZiAoX3By\nZUpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3ByZUpvaW5z\nID0gbmV3IFN0YWNrKCk7CiAgICAgICAgICAgICAgICBfcHJlSm9pbnMucHVz\naChqb2lucyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9iamVjdCBv\nYmogPSBzdXBlci5sb2FkKG1hcHBpbmcsIHN0b3JlLCBmZXRjaCwgam9pbnMp\nOwoKICAgICAgICAgICAgLy8gcmVzZXQKICAgICAgICAgICAgaWYgKGhhc0pv\naW5zKQogICAgICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAg\nICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5zIG5ld0pvaW5zKCkgewogICAgICAgICAgICBQYXRoSm9pbnMgcHJlID0g\nZ2V0UHJlSm9pbnMoKTsKICAgICAgICAgICAgaWYgKHByZSA9PSBudWxsIHx8\nIHByZS5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwoKICAgICAgICAgICAgUGF0aEpvaW5zSW1wbCBwaiA9IG5ldyBQYXRo\nSm9pbnNJbXBsKCk7CiAgICAgICAgICAgIHBqLnBhdGggPSBuZXcgU3RyaW5n\nQnVpbGRlcihwcmUucGF0aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBy\nZXR1cm4gcGo7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBjb250YWluc0ludGVybmFsKE9iamVjdCBvYmosIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBvYmpzIGFuZCBq\nb2luLWxlc3MgY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAgICAgICAgIC8v\nIGZvciBjb2xzIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0aEpvaW5zIHBq\nID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBpZiAocGogIT0gbnVs\nbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG9iaiA9\nIGdldENvbHVtbkFsaWFzKChDb2x1bW4pIG9iaiwgcGopOwogICAgICAgICAg\nICByZXR1cm4gb2JqICE9IG51bGwgJiYgX3NlbC5fc2VsZWN0cy5jb250YWlu\ncyhvYmopOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4g\nY29udGFpbnNBbGxJbnRlcm5hbChPYmplY3RbXSBvYmpzLCBKb2lucyBqb2lu\ncykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAg\nICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBvYmpzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGog\nIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcygoQ29sdW1uKSBvYmpzW2ldLCBw\naik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nb2JqID0gb2Jqc1tpXTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVs\nbCB8fCAhX3NlbC5fc2VsZWN0cy5jb250YWlucyhvYmopKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHB1c2hCYWNrKCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIF9wb3MgPSAwOwogICAgICAgICAgICBzdXBlci5w\ndXNoQmFjaygpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xl\nYW4gYWJzb2x1dGVJbnRlcm5hbChpbnQgcm93KQogICAgICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAg\nICAgICAgIHJldHVybiBzdXBlci5hYnNvbHV0ZUludGVybmFsKHJvdyk7CiAg\nICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBuZXh0SW50ZXJu\nYWwoKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5uZXh0\nSW50ZXJuYWwoKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBpbnQg\nZmluZE9iamVjdChPYmplY3Qgb2JqLCBKb2lucyBqb2lucykKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfcG9z\nID09IF9zZWwuX3NlbGVjdHMuc2l6ZSgpKQogICAgICAgICAgICAgICAgX3Bv\ncyA9IDA7CgogICAgICAgICAgICAvLyB3ZSBrZXkgZGlyZWN0bHkgb24gb2Jq\ncyBhbmQgam9pbi1sZXNzIGNvbHMsIG9yIG9uIHRoZSBhbGlhcwogICAgICAg\nICAgICAvLyBmb3IgY29scyB3aXRoIGpvaW5zCiAgICAgICAgICAgIFBhdGhK\nb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAgQm9vbGVh\nbiBwayA9IG51bGw7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBq\nLnBhdGgoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDb2x1bW4gY29s\nID0gKENvbHVtbikgb2JqOwogICAgICAgICAgICAgICAgcGsgPSAoY29sLmlz\nUHJpbWFyeUtleSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBq\nKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGNvbC5nZXRUYWJs\nZSgpICsgIjogIgogICAgICAgICAgICAgICAgICAgICAgICArIHBqLnBhdGgo\nKSArICIgKCIgKyBfc2VsLl9hbGlhc2VzICsgIikiKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gd2UgbG9hZCBpbiB0aGUgc2FtZSBvcmRlciB3\nZSBzZWxlY3QsIG1vcmUgb3IgbGVzcy4uLgogICAgICAgICAgICBpZiAoX3Nl\nbC5fc2VsZWN0cy5nZXQoX3BvcykuZXF1YWxzKG9iaikpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKytfcG9zOwoKICAgICAgICAgICAgLy8gaWYgd2UncmUg\nbG9va2luZyBmb3IgYSBwcmltYXJ5IGtleSwgdHJ5IGJhY2sgYSBjb3VwbGUg\ncGxhY2VzLAogICAgICAgICAgICAvLyBzaW5jZSBwa3MgbWlnaHQgYmUgc2Vs\nZWN0ZWQgaW4gYSBzbGlnaHRseSBkaWZmZXJlbnQgb3JkZXIgdGhhbgogICAg\nICAgICAgICAvLyB0aGV5IGFyZSBsb2FkZWQgYmFjazsgZG9uJ3QgY2hhbmdl\nIHRoZSBtYXJrZXIgcG9zaXRpb24KICAgICAgICAgICAgaWYgKHBrID09IG51\nbGwpCiAgICAgICAgICAgICAgICBwayA9IChvYmogaW5zdGFuY2VvZiBDb2x1\nbW4gJiYgKChDb2x1bW4pIG9iaikuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAg\nICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICBpZiAocGsuYm9vbGVhblZhbHVlKCkpIHsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSBfcG9zIC0gMTsgaSA+PSAwICYmIGkgPj0g\nX3BvcyAtIDM7IGktLSkKICAgICAgICAgICAgICAgICAgICBpZiAoX3NlbC5f\nc2VsZWN0cy5nZXQoaSkuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBpICsgMTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gc2VhcmNoIGZvcndhcmQgb24gdGhlIGFzc3VtcHRpb24gdGhhdCB3\nZSBtaWdodCBiZSBza2lwcGluZwogICAgICAgICAgICAvLyBzZWxlY3RzIGZv\nciBzaWJsaW5nIGNsYXNzZXM7IGFkdmFuY2UgdGhlIHBvc2l0aW9uIGlmIHdl\nIGZpbmQKICAgICAgICAgICAgLy8gc29tZXRoaW5nIGZvcndhcmQKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IF9wb3MgKyAxOyBpIDwgX3NlbC5fc2VsZWN0\ncy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9zZWwuX3Nl\nbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmopKSB7CiAgICAgICAgICAgICAgICAg\nICAgX3BvcyA9IGk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICsrX3Bv\nczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gbWF5YmUgdGhlIGNvbHVtbiB3YXMgc2VsZWN0ZWQgYnkgMiBkaWZm\nZXJlbnQgbWFwcGluZ3MsIHNvIGl0J3MKICAgICAgICAgICAgLy8gc29tZXdo\nZXJlIHByaW9yIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uOyBpbiB0aGlzIGNh\nc2UgbGVhdmUgdGhlCiAgICAgICAgICAgIC8vIHBvc2l0aW9uIG1hcmtlciBh\ndCBpdHMgY3VycmVudCBwbGFjZSBjYXVzZSBzdWJzZXF1ZW50IGxvYWRzIHdp\nbGwKICAgICAgICAgICAgLy8gc3RpbGwgcHJvYmFibHkgc3RhcnQgZnJvbSB0\naGVyZQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9wb3M7IGkr\nKykKICAgICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdldChpKS5l\ncXVhbHMob2JqKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSArIDE7\nCgogICAgICAgICAgICAvLyBzb21ldGhpbmdzJ3Mgd3JvbmcuLi4KICAgICAg\nICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihvYmoudG9TdHJpbmcoKSk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhl\nIGpvaW5zIHRvIHVzZSB0byBmaW5kIGNvbHVtbiBkYXRhLgogICAgICAgICAq\nLwogICAgICAgIHByaXZhdGUgUGF0aEpvaW5zIGdldEpvaW5zKEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IChQYXRoSm9pbnMp\nIGpvaW5zOwogICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRo\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBwajsKICAgICAg\nICAgICAgcmV0dXJuIGdldFByZUpvaW5zKCk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIHByZSBqb2lucyBmb3IgdGhl\nIHJlc3VsdCwgb3IgbnVsbCBpZiBub25lLiBOb3RlIHRoYXQKICAgICAgICAg\nKiB3ZSBoYXZlIHRvIHRha2UgdGhlIFNlbGVjdCdzIHByZSBqb2lucyBpbnRv\nIGFjY291bnQgdG9vLCBzaW5jZQogICAgICAgICAqIGJhdGNoZWQgc2VsZWN0\ncyBjYW4gaGF2ZSBhZGRpdGlvbmFsIHByZSBqb2lucyBvbiB0aGUgc3RhY2sg\nZXZlbgogICAgICAgICAqIG9uIGV4ZWN1dGlvbi4KICAgICAgICAgKi8KICAg\nICAgICBwcml2YXRlIFBhdGhKb2lucyBnZXRQcmVKb2lucygpIHsKICAgICAg\nICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9pbnMuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIChQYXRoSm9pbnMpIF9w\ncmVKb2lucy5wZWVrKCk7CiAgICAgICAgICAgIGlmIChfc2VsLl9wcmVKb2lu\ncyAhPSBudWxsICYmICFfc2VsLl9wcmVKb2lucy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gKFBhdGhKb2lucykgX3NlbC5fcHJlSm9pbnMu\ncGVlaygpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgYWxpYXMgdXNlZCB0\nbyBrZXkgb24gdGhlIGNvbHVtbiBkYXRhLCBjb25zaWRlcmluZyB0aGUKICAg\nICAgICAgKiBnaXZlbiBqb2lucy4KICAgICAgICAgKi8KICAgICAgICBwcml2\nYXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBQYXRoSm9p\nbnMgcGopIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzOwogICAgICAgICAg\nICBpZiAoX3NlbC5fZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBh\nbGlhcyA9IF9zZWwudG9BbGlhcyhfc2VsLl9mcm9tLmdldFRhYmxlSW5kZXgK\nICAgICAgICAgICAgICAgICAgICAoY29sLmdldFRhYmxlKCksIHBqLCBmYWxz\nZSkpOwogICAgICAgICAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBp\nZiAoX3NlbC5fZGljdC5yZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBGUk9NX1NFTEVDVF9BTElBUyArICIu\nIiArIGFsaWFzICsgIl8iICsgY29sOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGFsaWFzICsgIl8iICsgY29sOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGFsaWFzID0gX3NlbC50b0FsaWFzKF9zZWwuZ2V0VGFibGVJbmRleChjb2wu\nZ2V0VGFibGUoKSwgcGosIGZhbHNlKSk7CiAgICAgICAgICAgIHJldHVybiAo\nYWxpYXMgPT0gbnVsbCkgPyBudWxsIDogYWxpYXMgKyAiLiIgKyBjb2w7CiAg\nICAgICAgfQoKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAgICAgLy8gUGF0aEpvaW5zIGltcGxlbWVudGF0aW9uCiAgICAgICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVy\nKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgU3RyaW5nQnVpbGRlciBwYXRoKCkgewogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpv\naW5zKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxK\nb2lucygpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRh\nYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pbihG\nb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55\nKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZrLCBib29s\nZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpv\naW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAg\nICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFu\nIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgUGF0aEpvaW5zSW1wbCgpLmpvaW5SZWxhdGlvbihuYW1lLCBmaywg\ndGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgICAgIGludmVyc2UsIHRvTWFu\neSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2lu\nUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGlu\ndmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgUGF0aEpvaW5zSW1wbCgpLm91dGVySm9pblJlbGF0aW9uKG5hbWUsIGZr\nLCB0YXJnZXQsIHN1YnMsCiAgICAgICAgICAgICAgICBpbnZlcnNlLCB0b01h\nbnkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldFZhcmlh\nYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgaWYgKHZhciA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLnNldFZhcmlhYmxlKHZhcik7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0\ncmluZyBhbGlhcykgewogICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICByZXR1\ncm4gbmV3IFBhdGhKb2luc0ltcGwoKS5zZXRTdWJzZWxlY3QoYWxpYXMpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldENvcnJlbGF0ZWRW\nYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldEpvaW5Db250\nZXh0KENvbnRleHQgY3R4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRDb3JyZWxhdGVk\nVmFyaWFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgbW92ZUpvaW5zVG9QYXJlbnQoKSB7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBqb2lucyBp\nbXBsZW1lbnRhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xh\nc3MgUGF0aEpvaW5zSW1wbAogICAgICAgIGltcGxlbWVudHMgUGF0aEpvaW5z\nIHsKCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZ0J1aWxkZXIgcGF0aCA9IG51\nbGw7CiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyB2YXIgPSBudWxsOwogICAg\nICAgIHByb3RlY3RlZCBTdHJpbmcgY29ycmVsYXRlZFZhciA9IG51bGw7CiAg\nICAgICAgcHJvdGVjdGVkIENvbnRleHQgY29udGV4dCA9IG51bGw7CiAgICAg\nICAgcHJvdGVjdGVkIENvbnRleHQgbGFzdENvbnRleHQgPSBudWxsOwoKICAg\nICAgICBwdWJsaWMgU2VsZWN0IGdldFNlbGVjdCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xl\nYW4gb3V0ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAg\nICAgICByZXR1cm4gdmFyICE9IG51bGwgfHwgcGF0aCAhPSBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZ0J1aWxkZXIgcGF0aCgpIHsK\nICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pblNldCBqb2lucygpIHsKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgp\nIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAg\nICAgICB0aGlzLnZhciA9IHZhcjsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFZhcmlhYmxl\nKCkgewogICAgICAgICAgICByZXR1cm4gdmFyOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0Q29ycmVsYXRlZFZhcmlhYmxl\nKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgdGhpcy5jb3JyZWxhdGVkVmFy\nID0gdmFyOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRDb3JyZWxhdGVkVmFy\naWFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBjb3JyZWxhdGVkVmFyOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldEpvaW5Db250ZXh0\nKENvbnRleHQgY29udGV4dCkgewogICAgICAgICAgICB0aGlzLmNvbnRleHQg\nPSBjb250ZXh0OwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmluZyBh\nbGlhcykgewogICAgICAgICAgICBhcHBlbmQoYWxpYXMpOwogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBs\nb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAg\nYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29s\nZWFuIHRvTWFueSkgewogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAg\nICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVp\nZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51\nbGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9y\nZWlnbktleSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQs\nIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgICAgIGFwcGVuZChuYW1lKTsKICAgICAgICAgICAgYXBwZW5k\nKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91\ndGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLAog\nICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBh\ncHBlbmQobmFtZSk7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAg\nICAgICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZChTdHJpbmcg\nc3RyKSB7CiAgICAgICAgICAgIGlmIChzdHIgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKHBhdGggPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBwYXRoID0gbmV3IFN0cmluZ0J1aWxkZXIoc3RyKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwYXRoLmFwcGVuZCgnLicp\nLmFwcGVuZChzdHIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1\ncm4gIlBhdGhKb2luc0ltcGw8IiArIGhhc2hDb2RlKCkgKyAiPjogIgogICAg\nICAgICAgICAgICAgKyBTdHJpbmcudmFsdWVPZihwYXRoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIG1vdmVKb2luc1RvUGFyZW50KCkgewog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEpvaW5zIGltcGxlbWVu\ndGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTZWxl\nY3RKb2lucwogICAgICAgIGV4dGVuZHMgUGF0aEpvaW5zSW1wbCAKICAgICAg\nICBpbXBsZW1lbnRzIENsb25lYWJsZSB7CgogICAgICAgIHByaXZhdGUgZmlu\nYWwgU2VsZWN0SW1wbCBfc2VsOwogICAgICAgIHByaXZhdGUgSm9pblNldCBf\nam9pbnMgPSBudWxsOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfb3V0ZXIg\nPSBmYWxzZTsKICAgICAgICBwcml2YXRlIGludCBfY291bnQgPSAwOwoKICAg\nICAgICBwdWJsaWMgU2VsZWN0Sm9pbnMoU2VsZWN0SW1wbCBzZWwpIHsKICAg\nICAgICAgICAgX3NlbCA9IHNlbDsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTZWxlY3QgZ2V0U2VsZWN0KCkgewogICAgICAgICAgICByZXR1cm4gX3Nl\nbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfb3V0ZXI7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIp\nIHsKICAgICAgICAgICAgX291dGVyID0gb3V0ZXI7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNEaXJ0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmlzRGlydHko\nKSB8fCAhaXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5TZXQgam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBfam9pbnM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXRKb2lucyhKb2luU2V0\nIGpvaW5zKSB7CiAgICAgICAgICAgIF9qb2lucyA9IGpvaW5zOwogICAgICAg\nICAgICBfb3V0ZXIgPSBqb2lucyAhPSBudWxsICYmIGpvaW5zLmxhc3QoKSAh\nPSBudWxsCiAgICAgICAgICAgICAgICAmJiBqb2lucy5sYXN0KCkuZ2V0VHlw\nZSgpID09IEpvaW4uVFlQRV9PVVRFUjsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICBpZiAoX2pvaW5z\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvdW50OwogICAg\nICAgICAgICByZXR1cm4gTWF0aC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgp\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygp\nIHsKICAgICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2NvdW50ID0gTWF0aC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgp\nKTsKICAgICAgICAgICAgX2pvaW5zID0gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNFbXB0eSgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBs\nb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAg\nLy8gY3Jvc3Mgam9pbnMgYXJlIGZvciB1bmJvdW5kIHZhcmlhYmxlczsgdW5m\nb3J0dW5hdGVseSB3ZSBoYXZlCiAgICAgICAgICAgIC8vIHRvIGFsd2F5cyBn\nbyBESVNUSU5DVCBmb3IgdW5ib3VuZCB2YXJzIGJlY2F1c2UgdGhlcmUgYXJl\nIGNlcnRhaW4KICAgICAgICAgICAgLy8gY2FzZXMgdGhhdCByZXF1aXJlIGl0\nLCBhbmQgd2UgY2FuJ3QgZGlmZmVyZW50aWF0ZSB0aGVtIGZyb20gdGhlCiAg\nICAgICAgICAgIC8vIGNhc2VzIHRoYXQgZG9uJ3QKICAgICAgICAgICAgX3Nl\nbC5fZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CgogICAgICAgICAgICBp\nZiAoX3NlbC5nZXRKb2luU3ludGF4KCkgIT0gSm9pblN5bnRheGVzLlNZTlRB\nWF9TUUw5MgogICAgICAgICAgICAgICAgfHwgX3NlbC5fZnJvbSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBkb24ndCBtYWtlIGFueSBqb2lucywg\nYnV0IHVwZGF0ZSB0aGUgcGF0aCBpZiBhIHZhcmlhYmxlCiAgICAgICAgICAg\nICAgICAvLyBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgICAgIHRoaXMuYXBw\nZW5kKHRoaXMudmFyKTsKICAgICAgICAgICAgICAgIHRoaXMudmFyID0gbnVs\nbDsKICAgICAgICAgICAgICAgIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGRvbid0IGxldCB0aGUgZ2V0IGFsaWFzIG1ldGhvZHMgc2VlIHRoYXQg\nYSB2YXIgaGFzIGJlZW4gc2V0CiAgICAgICAgICAgIC8vIHVudGlsIHdlIGdl\ndCBwYXN0IHRoZSBsb2NhbCB0YWJsZQogICAgICAgICAgICBTdHJpbmcgdmFy\nID0gdGhpcy52YXI7CiAgICAgICAgICAgIHRoaXMudmFyID0gbnVsbDsKICAg\nICAgICAgICAgQ29udGV4dCBjdHggPSBjb250ZXh0OyAKICAgICAgICAgICAg\nY29udGV4dCA9IG51bGw7IAoKICAgICAgICAgICAgaW50IGFsaWFzMSA9IF9z\nZWwuZ2V0VGFibGVJbmRleChsb2NhbFRhYmxlLCB0aGlzLCB0cnVlKTsKICAg\nICAgICAgICAgdGhpcy5hcHBlbmQodmFyKTsKICAgICAgICAgICAgdGhpcy5h\ncHBlbmQoY29ycmVsYXRlZFZhcik7CiAgICAgICAgICAgIGNvbnRleHQgPSBj\ndHg7IAogICAgICAgICAgICAKICAgICAgICAgICAgaW50IGFsaWFzMiA9IF9z\nZWwuZ2V0VGFibGVJbmRleChmb3JlaWduVGFibGUsIHRoaXMsIHRydWUpOwog\nICAgICAgICAgICBKb2luIGogPSBuZXcgSm9pbihsb2NhbFRhYmxlLCBhbGlh\nczEsIGZvcmVpZ25UYWJsZSwgYWxpYXMyLAogICAgICAgICAgICAgICAgbnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICBqLnNldFR5cGUoSm9pbi5UWVBFX0NS\nT1NTKTsKCiAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9qb2lucyA9IG5ldyBKb2luU2V0KCk7CiAgICAgICAgICAg\nIF9qb2lucy5hZGQoaik7CiAgICAgICAgICAgIHNldENvcnJlbGF0ZWQoaik7\nCiAgICAgICAgICAgIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAgICBsYXN0\nQ29udGV4dCA9ICBjb250ZXh0OwogICAgICAgICAgICBjb250ZXh0ID0gbnVs\nbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGlu\ndmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBq\nb2luKG51bGwsIGZrLCBudWxsLCAtMSwgaW52ZXJzZSwgdG9NYW55LCBmYWxz\nZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2lu\nKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01h\nbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4obnVsbCwgZmssIG51bGws\nIC0xLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9y\nZWlnbktleSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQs\nIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgICAgIHJldHVybiBqb2luKG5hbWUsIGZrLCB0YXJnZXQsIHN1\nYnMsIGludmVyc2UsIHRvTWFueSwgZmFsc2UpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1l\nLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFy\nZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgICAgICByZXR1cm4gam9pbihuYW1lLCBmaywgdGFyZ2V0\nLCBzdWJzLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAgICAgIH0KCiAg\nICAgICAgcHJpdmF0ZSBKb2lucyBqb2luKFN0cmluZyBuYW1lLCBGb3JlaWdu\nS2V5IGZrLCBDbGFzc01hcHBpbmcgdGFyZ2V0LAogICAgICAgICAgICBpbnQg\nc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSwgYm9vbGVh\nbiBvdXRlcikgewogICAgICAgICAgICAvLyBkb24ndCBsZXQgdGhlIGdldCBh\nbGlhcyBtZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBiZWVuIHNldAogICAg\nICAgICAgICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUgbG9jYWwgdGFibGUK\nICAgICAgICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFyOwogICAgICAgICAg\nICB0aGlzLnZhciA9IG51bGw7CiAgICAgICAgICAgIENvbnRleHQgY3R4ID0g\nY29udGV4dDsgCiAgICAgICAgICAgIGNvbnRleHQgPSBudWxsOyAKCiAgICAg\nICAgICAgIC8vIGdldCBmaXJzdCB0YWJsZSBhbGlhcyBiZWZvcmUgdXBkYXRp\nbmcgcGF0aDsgaWYgdGhlcmUgaXMgYSBmcm9tCiAgICAgICAgICAgIC8vIHNl\nbGVjdCB0aGVuIHdlIHNob3VsZG4ndCBhY3R1YWxseSBjcmVhdGUgYSBqb2lu\nIG9iamVjdCwgc2luY2UKICAgICAgICAgICAgLy8gdGhlIGpvaW5zIHdpbGwg\nYWxsIGJlIGRvbmUgaW4gdGhlIGZyb20gc2VsZWN0CiAgICAgICAgICAgIGJv\nb2xlYW4gY3JlYXRlSm9pbiA9IF9zZWwuX2Zyb20gPT0gbnVsbDsKICAgICAg\nICAgICAgVGFibGUgdGFibGUxID0gbnVsbDsKICAgICAgICAgICAgaW50IGFs\naWFzMSA9IC0xOwogICAgICAgICAgICBpZiAoY3JlYXRlSm9pbikgewogICAg\nICAgICAgICAgICAgYm9vbGVhbiBjcmVhdGVJbmRleCA9IHRydWU7CiAgICAg\nICAgICAgICAgICB0YWJsZTEgPSAoaW52ZXJzZSkgPyBmay5nZXRQcmltYXJ5\nS2V5VGFibGUoKSA6IGZrLmdldFRhYmxlKCk7CiAgICAgICAgICAgICAgICBp\nZiAoY29ycmVsYXRlZFZhciAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGNyZWF0ZUluZGV4ID0gZmFsc2U7ICAvLyBub3QgdG8gY3JlYXRlIGhlcmUK\nICAgICAgICAgICAgICAgIGFsaWFzMSA9IF9zZWwuZ2V0VGFibGVJbmRleCh0\nYWJsZTEsIHRoaXMsIGNyZWF0ZUluZGV4KTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gdXBkYXRlIHRoZSBwYXRoIHdpdGggdGhlIHJlbGF0aW9u\nIG5hbWUgYmVmb3JlIGdldHRpbmcgcGsgYWxpYXMKICAgICAgICAgICAgdGhp\ncy5hcHBlbmQobmFtZSk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kKHZhcik7\nCiAgICAgICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRoaXMuYXBwZW5kKGNvcnJlbGF0ZWRWYXIpOwogICAgICAgICAgICBjb250\nZXh0ID0gY3R4OyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0b01h\nbnkpIHsKICAgICAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IElNUExJQ0lU\nX0RJU1RJTkNUOwogICAgICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gVE9f\nTUFOWTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfb3V0ZXIgPSBvdXRl\ncjsKCiAgICAgICAgICAgIGlmIChjcmVhdGVKb2luKSB7CiAgICAgICAgICAg\nICAgICBib29sZWFuIGNyZWF0ZUluZGV4ID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgIFRhYmxlIHRhYmxlMiA9IChpbnZlcnNlKSA/IGZrLmdldFRhYmxlKCkg\nCiAgICAgICAgICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5VGFibGUo\nKTsKICAgICAgICAgICAgICAgIGJvb2xlYW4gY3JlYXRlZCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgaW50IGFsaWFzMiA9IC0xOwogICAgICAgICAgICAg\nICAgaWYgKHRhYmxlMi5pc0Fzc29jaWF0aW9uKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBhbGlhczIgPSBfc2VsLmdldFRhYmxlSW5kZXgodGFibGUyLCB0\naGlzLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFsaWFzMiA9\nPSAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlSW5kZXggPSB0\ncnVlOwogICAgICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNyZWF0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udGV4dCA9PSBfc2VsLmN0eCgp\nKSAKICAgICAgICAgICAgICAgICAgIGNyZWF0ZUluZGV4ID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKGNvcnJlbGF0ZWRWYXIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjcmVhdGVJbmRleCA9IGZhbHNlOwogICAg\nICAgICAgICAgICAgaWYgKCFjcmVhdGVkKQogICAgICAgICAgICAgICAgICAg\nIGFsaWFzMiA9IF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTIsIHRoaXMsIGNy\nZWF0ZUluZGV4KTsKICAgICAgICAgICAgICAgIEpvaW4gaiA9IG5ldyBKb2lu\nKHRhYmxlMSwgYWxpYXMxLCB0YWJsZTIsIGFsaWFzMiwgZmssIGludmVyc2Up\nOwogICAgICAgICAgICAgICAgai5zZXRUeXBlKChvdXRlcikgPyBKb2luLlRZ\nUEVfT1VURVIgOiBKb2luLlRZUEVfSU5ORVIpOwoKICAgICAgICAgICAgICAg\nIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfam9p\nbnMgPSBuZXcgSm9pblNldCgpOwogICAgICAgICAgICAgICAgaWYgKF9qb2lu\ncy5hZGQoaikgJiYgKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgCiAg\nICAgICAgICAgICAgICAgICAgfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05F\nKSkKICAgICAgICAgICAgICAgICAgICBqLnNldFJlbGF0aW9uKHRhcmdldCwg\nc3VicywgY2xvbmUoX3NlbCkpOwoKICAgICAgICAgICAgICAgIHNldENvcnJl\nbGF0ZWQoaik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdENvbnRl\neHQgPSBjb250ZXh0OwogICAgICAgICAgICBjb250ZXh0ID0gbnVsbDsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwcml2\nYXRlIHZvaWQgc2V0Q29ycmVsYXRlZChKb2luIGopIHsKICAgICAgICAgICAg\naWYgKF9zZWwuX3BhcmVudCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgaWYgKF9zZWwuX2FsaWFzZXMgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgai5zZXRJc05vdE15Sm9pbigpOwogICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9i\namVjdCBhbGlhc2VzW10gPSBfc2VsLl9hbGlhc2VzLnZhbHVlcygpLnRvQXJy\nYXkoKTsKICAgICAgICAgICAgYm9vbGVhbiBmb3VuZDEgPSBmYWxzZTsKICAg\nICAgICAgICAgYm9vbGVhbiBmb3VuZDIgPSBmYWxzZTsKCiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgYWxpYXNlcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaW50IGFsaWFzID0gKChJbnRlZ2VyKWFsaWFzZXNb\naV0pLmludFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0g\nai5nZXRJbmRleDEoKSkKICAgICAgICAgICAgICAgICAgICBmb3VuZDEgPSB0\ncnVlOwogICAgICAgICAgICAgICAgaWYgKGFsaWFzID09IGouZ2V0SW5kZXgy\nKCkpCiAgICAgICAgICAgICAgICAgICAgZm91bmQyID0gdHJ1ZTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChmb3Vu\nZDEgJiYgZm91bmQyKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICBlbHNlIGlmICghZm91bmQxICYmICFmb3VuZDIpIHsKICAgICAgICAg\nICAgICAgIGouc2V0SXNOb3RNeUpvaW4oKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIGouc2V0Q29ycmVsYXRlZCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBtb3ZlSm9pbnNUb1BhcmVu\ndCgpIHsKICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgIEpvaW4gaiA9IG51bGw7CiAg\nICAgICAgICAgTGlzdDxKb2luPiByZW1vdmVkID0gbmV3IEFycmF5TGlzdDxK\nb2luPig1KTsKICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9qb2lu\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICBqID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgIGlmIChq\nLmlzTm90TXlKb2luKCkpIHsKICAgICAgICAgICAgICAgICAgIGFkZEpvaW5z\nVG9QYXJlbnQoX3NlbC5fcGFyZW50LCBqKTsKICAgICAgICAgICAgICAgICAg\nIHJlbW92ZWQuYWRkKGopOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nfQogICAgICAgICAgIGZvciAoSm9pbiBqb2luIDogcmVtb3ZlZCkgewogICAg\nICAgICAgICAgICBfam9pbnMucmVtb3ZlKGpvaW4pOwogICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBhZGRKb2luc1RvUGFy\nZW50KFNlbGVjdEltcGwgcGFyZW50LCBKb2luIGpvaW4pIHsKICAgICAgICAg\nICAgaWYgKHBhcmVudC5fYWxpYXNlcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBPYmplY3QgYWxpYXNlc1tdID0gcGFy\nZW50Ll9hbGlhc2VzLnZhbHVlcygpLnRvQXJyYXkoKTsKICAgICAgICAgICAg\nYm9vbGVhbiBmb3VuZDEgPSBmYWxzZTsKICAgICAgICAgICAgYm9vbGVhbiBm\nb3VuZDIgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYWxpYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaW50\nIGFsaWFzID0gKChJbnRlZ2VyKWFsaWFzZXNbaV0pLmludFZhbHVlKCk7CiAg\nICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0gam9pbi5nZXRJbmRleDEoKSkK\nICAgICAgICAgICAgICAgICAgICBmb3VuZDEgPSB0cnVlOwogICAgICAgICAg\nICAgICAgaWYgKGFsaWFzID09IGpvaW4uZ2V0SW5kZXgyKCkpCiAgICAgICAg\nICAgICAgICAgICAgZm91bmQyID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChmb3VuZDEgJiYgZm91bmQy\nKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG15IGpvaW4sIGFkZCBq\nb2luCiAgICAgICAgICAgICAgICBpZiAocGFyZW50Ll9qb2lucyA9PSBudWxs\nKSAKICAgICAgICAgICAgICAgICAgICBwYXJlbnQuX2pvaW5zID0gbmV3IFNl\nbGVjdEpvaW5zKHBhcmVudCk7CiAgICAgICAgICAgICAgICBTZWxlY3RKb2lu\ncyBwID0gcGFyZW50Ll9qb2luczsKICAgICAgICAgICAgICAgIGlmIChwLmpv\naW5zKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwLnNldEpvaW5z\nKG5ldyBKb2luU2V0KCkpOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAg\nICAgIHAuam9pbnMoKS5hZGQoam9pbik7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgZWxzZSBpZiAocGFyZW50Ll9wYXJlbnQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGFkZEpvaW5zVG9QYXJlbnQocGFyZW50Ll9wYXJlbnQsIGpv\naW4pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNlbGVjdEpvaW5zIGNs\nb25lKFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIFNlbGVjdEpvaW5z\nIHNqID0gbmV3IFNlbGVjdEpvaW5zKHNlbCk7CiAgICAgICAgICAgIHNqLnZh\nciA9IHZhcjsKICAgICAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNqLnBhdGggPSBuZXcgU3RyaW5nQnVpbGRlcihwYXRoLnRv\nU3RyaW5nKCkpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwgJiYg\nIV9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBzai5fam9pbnMg\nPSBuZXcgSm9pblNldChfam9pbnMpOwogICAgICAgICAgICBzai5fb3V0ZXIg\nPSBfb3V0ZXI7CiAgICAgICAgICAgIHJldHVybiBzajsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci50b1N0cmluZygpICsgIiAoIiArIF9vdXRlciArICIp\nOiAiICsgX2pvaW5zOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJvdGVj\ndGVkIFNlbGVjdHMgbmV3U2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gbmV3\nIFNlbGVjdHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBjbGFz\ncyB0byB0cmFjayBzZWxlY3RlZCBjb2x1bW5zLCB3aXRoIGZhc3QgY29udGFp\nbnMgbWV0aG9kLgogICAgICogQWN0cyBhcyBhIGxpc3Qgb2Ygc2VsZWN0IGlk\ncywgd2l0aCBhZGRpdGlvbmFsIG1ldGhvZHMgdG8gbWFuaXB1bGF0ZQogICAg\nICogdGhlIGFsaWFzIG9mIGVhY2ggc2VsZWN0ZWQgaWQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU2VsZWN0cwogICAgICAgIGV4dGVu\nZHMgQWJzdHJhY3RMaXN0IHsKCiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lk\ncyA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lkZW50cyA9IG51\nbGw7CiAgICAgICAgcHJvdGVjdGVkIE1hcCBfYWxpYXNlcyA9IG51bGw7CiAg\nICAgICAgcHJvdGVjdGVkIE1hcCBfc2VsZWN0QXMgPSBudWxsOwogICAgICAg\nIHByb3RlY3RlZCBEQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxsOwoKICAgICAg\nICAvKioKICAgICAgICAgKiBBZGQgYWxsIGFsaWFzZXMgZnJvbSBhbm90aGVy\nIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFk\nZEFsbChTZWxlY3RzIHNlbHMpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0g\nbnVsbCAmJiBzZWxzLl9pZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9p\nZHMgPSBuZXcgQXJyYXlMaXN0KHNlbHMuX2lkcyk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKHNlbHMuX2lkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2lk\ncy5hZGRBbGwoc2Vscy5faWRzKTsKCiAgICAgICAgICAgIGlmIChfaWRlbnRz\nID09IG51bGwgJiYgc2Vscy5faWRlbnRzICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfaWRlbnRzID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZGVudHMpOwog\nICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9pZGVudHMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9pZGVudHMuYWRkQWxsKHNlbHMuX2lkZW50cyk7Cgog\nICAgICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVsbCAmJiBzZWxzLl9hbGlh\nc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBI\nYXNoTWFwKHNlbHMuX2FsaWFzZXMpOwogICAgICAgICAgICBlbHNlIGlmIChz\nZWxzLl9hbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNl\ncy5wdXRBbGwoc2Vscy5fYWxpYXNlcyk7CgogICAgICAgICAgICBpZiAoX3Nl\nbGVjdEFzID09IG51bGwgJiYgc2Vscy5fc2VsZWN0QXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFwKHNlbHMuX3Nl\nbGVjdEFzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5fc2VsZWN0QXMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcy5wdXRBbGwoc2Vs\ncy5fc2VsZWN0QXMpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmV0dXJucyB0aGUgYWxpYXMgb2YgYSBnaXZlbiBpZC4KICAgICAgICAg\nKi8KICAgICAgICBwdWJsaWMgT2JqZWN0IGdldEFsaWFzKE9iamVjdCBpZCkg\newogICAgICAgICAgICByZXR1cm4gKF9hbGlhc2VzID09IG51bGwpID8gbnVs\nbCA6IF9hbGlhc2VzLmdldChpZCk7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBTZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4gaWQuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIGludCBzZXRBbGlhcyhPYmplY3QgaWQs\nIE9iamVjdCBhbGlhcywgYm9vbGVhbiBpZGVudCkgewogICAgICAgICAgICBp\nZiAoX2lkcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaWRzID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcg\nSGFzaE1hcCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnQgaWR4\nOwogICAgICAgICAgICBpZiAoX2FsaWFzZXMucHV0KGlkLCBhbGlhcykgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGlkeCA9IF9pZHMuaW5kZXhPZihpZCk7\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgX2lkcy5hZGQo\naWQpOwogICAgICAgICAgICAgICAgaWR4ID0gX2lkcy5zaXplKCkgLSAxOwoK\nICAgICAgICAgICAgICAgIGlmIChpZGVudCkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChfaWRlbnRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF9pZGVudHMgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICAg\nICAgICAgIF9pZGVudHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaWR4OwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBhIGdp\ndmVuIGluZGV4LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNl\ndEFsaWFzKGludCBpZHgsIE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBP\nYmplY3QgaWQgPSBfaWRzLmdldChpZHgpOwogICAgICAgICAgICBfYWxpYXNl\ncy5wdXQoaWQsIGFsaWFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIEluc2VydCBhbiBhbGlhcyBiZWZvcmUgdGhlIGdpdmVuIGluZGV4\nLCB1c2luZyBuZWdhdGl2ZSBpbmRleGVzCiAgICAgICAgICogdG8gY291bnQg\nYmFja3dhcmRzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGlu\nc2VydEFsaWFzKGludCBpZHgsIE9iamVjdCBpZCwgT2JqZWN0IGFsaWFzKSB7\nCiAgICAgICAgICAgIF9hbGlhc2VzLnB1dChpZCwgYWxpYXMpOwogICAgICAg\nICAgICBpZiAoaWR4ID49IDApCiAgICAgICAgICAgICAgICBfaWRzLmFkZChp\nZHgsIGlkKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lk\ncy5hZGQoX2lkcy5zaXplKCkgKyBpZHgsIGlkKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5kZXggb2YgdGhlIGdp\ndmVuIGFsaWFzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgaW5k\nZXhPZkFsaWFzKE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBpZiAoX2Fs\naWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfaWRzLnNpemUoKTsgaSsr\nKQogICAgICAgICAgICAgICAgaWYgKGFsaWFzLmVxdWFscyhfYWxpYXNlcy5n\nZXQoX2lkcy5nZXQoaSkpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\naTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogQSBsaXN0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBh\nbGlhc2VzLCBpbiBzZWxlY3Qgb3JkZXIsIHdpdGgKICAgICAgICAgKiBBUyBh\nbGlhc2VzIHByZXNlbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIExp\nc3QgZ2V0QWxpYXNlcyhmaW5hbCBib29sZWFuIGlkZW50LCBmaW5hbCBib29s\nZWFuIGlubmVyKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsK\nCiAgICAgICAgICAgIHJldHVybiBuZXcgQWJzdHJhY3RMaXN0KCkgewogICAg\nICAgICAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICAg\nICAgICAgIHJldHVybiAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9p\nZGVudHMuc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5z\naXplKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVi\nbGljIE9iamVjdCBnZXQoaW50IGkpIHsKICAgICAgICAgICAgICAgICAgICBP\nYmplY3QgaWQgPSAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9pZGVu\ndHMuZ2V0KGkpCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5nZXQo\naSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGFsaWFzID0gX2FsaWFz\nZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWQgaW5zdGFu\nY2VvZiBDb2x1bW4gJiYgKChDb2x1bW4pIGlkKS5pc1hNTCgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBhbGlhcyA9IGFsaWFzICsgX2RpY3QuZ2V0U3Ry\naW5nVmFsOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAg\nICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nIGlmIChpbm5lcikKICAgICAgICAgICAgICAgICAgICAgICAgYXMgPSAoKFN0\ncmluZykgYWxpYXMpLnJlcGxhY2UoJy4nLCAnXycpOwogICAgICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKF9zZWxlY3RBcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICBhcyA9IChTdHJpbmcpIF9zZWxlY3RBcy5nZXQoaWQp\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlkIGluc3RhbmNlb2Yg\nVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFzID0gKChWYWx1ZSkg\naWQpLmdldEFsaWFzKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChhcyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZGVudCAm\nJiBfaWRlbnRzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gYXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGlh\ncyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGFsaWFzID0gbmV3IFNRTEJ1ZmZlcigoU1FMQnVmZmVyKSBhbGlh\ncykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCIg\nQVMgIikuYXBwZW5kKGFzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXMgPSBhbGlhcyAr\nICIgQVMgIiArIGFzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBTZXQgdGhhdCBhIGdpdmVuIGlkJ3MgYWxpYXMgaGFzIGFuIEFTIHZhbHVl\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFNlbGVjdEFz\nKE9iamVjdCBpZCwgU3RyaW5nIGFzKSB7CiAgICAgICAgICAgIGlmIChfc2Vs\nZWN0QXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcyA9IG5l\ndyBIYXNoTWFwKChpbnQpICg1ICogMS4zMyArIDEpKTsKICAgICAgICAgICAg\nX3NlbGVjdEFzLnB1dChpZCwgYXMpOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogQ2xlYXIgYWxsIHBsYWNlaG9sZGVycyBhbmQgc2VsZWN0\nIEFTIGNsYXVzZXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQg\nY2xlYXJQbGFjZWhvbGRlcnMoKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBP\nYmplY3QgaWQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2lk\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgaWQgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGlkIGlu\nc3RhbmNlb2YgUGxhY2Vob2xkZXIpIHsKICAgICAgICAgICAgICAgICAgICBp\ndHIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgX2FsaWFzZXMucmVt\nb3ZlKGlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0\nIGlkKSB7CiAgICAgICAgICAgIHJldHVybiBfYWxpYXNlcyAhPSBudWxsICYm\nIF9hbGlhc2VzLmNvbnRhaW5zS2V5KGlkKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpKSB7CiAgICAgICAgICAgIGlmIChf\naWRzID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJyYXlJ\nbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHJldHVy\nbiBfaWRzLmdldChpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQg\nc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIChfaWRzID09IG51bGwpID8g\nMCA6IF9pZHMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9pZHMgPSBudWxsOwogICAgICAg\nICAgICBfYWxpYXNlcyA9IG51bGw7CiAgICAgICAgICAgIF9zZWxlY3RBcyA9\nIG51bGw7CiAgICAgICAgICAgIF9pZGVudHMgPSBudWxsOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgc2V0Q29ycmVsYXRlZFZhcmlhYmxl\nKFN0cmluZyB2YXIpIHsKICAgICAgICBpZiAodmFyID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVybiBuZXcgU2VsZWN0\nSm9pbnModGhpcykuc2V0Q29ycmVsYXRlZFZhcmlhYmxlKHZhcik7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBKb2lucyBzZXRKb2luQ29udGV4dChDb250ZXh0\nIGN0eCkgewogICAgICAgIGlmIChjdHggPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0\naGlzKS5zZXRKb2luQ29udGV4dChjdHgpOwogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0Q29ycmVsYXRlZFZhcmlhYmxlKCkgewogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1vdmVKb2luc1RvUGFy\nZW50KCkgewogICAgfQp9CgovKioKICogQ29tbW9uIGpvaW5zIGludGVyZmFj\nZSB1c2VkIGludGVybmFsbHkuIENhbm5vdCBiZSBtYWRlIGFuIGlubmVyIGNs\nYXNzCiAqIGJlY2F1c2UgdGhlIG91dGVyIGNsYXNzIChTZWxlY3QpIGhhcyB0\nbyBpbXBsZW1lbnQgaXQuCiAqLwppbnRlcmZhY2UgUGF0aEpvaW5zCiAgICBl\neHRlbmRzIEpvaW5zIHsKCiAgICAvKioKICAgICAqIE1hcmsgdGhpcyBhcyBh\nbiBvdXRlciBqb2lucyBzZXQuCiAgICAgKi8KICAgIHB1YmxpYyBQYXRoSm9p\nbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcik7CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiB0aGlzIGluc3RhbmNlIGhhcyBhIHBhdGgsIGFueSBq\nb2lucywgb3IgYSB2YXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNEaXJ0eSgpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZWxh\ndGlvbiBwYXRoIHRyYXZlcnNlZCBieSB0aGVzZSBqb2lucywgb3IgbnVsbCBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nQnVpbGRlciBwYXRo\nKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNldCBvZiB7QGxpbmsg\nSm9pbn0gZWxlbWVudHMsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAg\ncHVibGljIEpvaW5TZXQgam9pbnMoKTsKCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbWF4aW11bSBudW1iZXIgb2Ygam9pbnMgY29udGFpbmVkIGluIHRo\naXMgaW5zdGFuY2UgYXQgYW55CiAgICAgKiB0aW1lLgogICAgICovCiAgICBw\ndWJsaWMgaW50IGpvaW5Db3VudCgpOwoKICAgIC8qKgogICAgICogTnVsbCB0\naGUgc2V0IG9mIHtAbGluayBKb2lufSBlbGVtZW50cy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgbnVsbEpvaW5zKCk7CgogICAgLyoqCiAgICAgKiBUaGUg\nc2VsZWN0IG93bmVyIG9mIHRoaXMgam9pbgogICAgICogQHJldHVybgogICAg\nICovCiAgICBwdWJsaWMgU2VsZWN0IGdldFNlbGVjdCgpOwp9Cgo=\n","encoding":"base64"}

