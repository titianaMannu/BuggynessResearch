{"sha":"ad9cb6f6a15d47331edec0470b9635ad422c926d","node_id":"MDQ6QmxvYjIwNjM2NDphZDljYjZmNmExNWQ0NzMzMWVkZWMwNDcwYjk2MzVhZDQyMmM5MjZk","size":13658,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ad9cb6f6a15d47331edec0470b9635ad422c926d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZh\nLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3Vy\ncmVudEhhc2hNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYu\nT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuUmVtb3RlQ29tbWl0RXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZXZlbnQuUmVtb3RlQ29tbWl0TGlzdGVuZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1cnJl\nbnQuQWJzdHJhY3RDb25jdXJyZW50RXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVu\ndFJlZmVyZW5jZUhhc2hTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSWQ7CgovKioKICogQWJzdHJhY3Qge0BsaW5rIFF1ZXJ5\nQ2FjaGV9IGltcGxlbWVudGF0aW9uIHRoYXQgcHJvdmlkZXMgdmFyaW91cwog\nKiBzdGF0aXN0aWNzLCBsb2dnaW5nLCBhbmQgdGltZW91dCBmdW5jdGlvbmFs\naXR5IGNvbW1vbiBhY3Jvc3MgY2FjaGUKICogaW1wbGVtZW50YXRpb25zLgog\nKgogKiBAYXV0aG9yIFBhdHJpY2sgTGluc2tleQogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEFic3RyYWN0UXVlcnlD\nYWNoZQogICAgZXh0ZW5kcyBBYnN0cmFjdENvbmN1cnJlbnRFdmVudE1hbmFn\nZXIgCiAgICBpbXBsZW1lbnRzIFF1ZXJ5Q2FjaGUsIENvbmZpZ3VyYWJsZSB7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIHNfbG9jID0K\nICAgICAgICBMb2NhbGl6ZXIuZm9yUGFja2FnZShBYnN0cmFjdFF1ZXJ5Q2Fj\naGUuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBU\nSU1FU1RBTVAgPSAidGltZXN0YW1wIjsKICAgIHB1YmxpYyBlbnVtIEV2aWN0\nUG9saWN5IHtERUZBVUxULCBUSU1FU1RBTVB9OwogICAgLyoqCiAgICAgKiBU\naGUgY29uZmlndXJhdGlvbiBzZXQgYnkgdGhlIHN5c3RlbS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmY7CgogICAg\nLyoqCiAgICAgKiBUaGUgbG9nIHRvIHVzZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIExvZyBsb2c7CgogICAgcHJvdGVjdGVkIENvbmN1cnJlbnRIYXNoTWFw\nPFN0cmluZyxMb25nPiBlbnRpdHlUaW1lc3RhbXBNYXAgPSBudWxsOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsKICAgIC8vIGRlZmF1\nbHQgZXZpY3QgcG9saWN5CiAgICBwdWJsaWMgRXZpY3RQb2xpY3kgZXZpY3RQ\nb2xpY3kgPSBFdmljdFBvbGljeS5ERUZBVUxUOwoKICAgIHB1YmxpYyB2b2lk\nIGluaXRpYWxpemUoRGF0YUNhY2hlTWFuYWdlciBtYW5hZ2VyKSB7CiAgICAg\nICAgaWYgKGV2aWN0UG9saWN5ID09IEV2aWN0UG9saWN5LlRJTUVTVEFNUCkg\newogICAgICAgICAgICBlbnRpdHlUaW1lc3RhbXBNYXAgPSBuZXcgQ29uY3Vy\ncmVudEhhc2hNYXA8U3RyaW5nLExvbmc+KCk7CiAgICAgICAgCiAgICAgICAg\nICAgIC8vIEdldCBhbGwgcGVyc2lzdGVuY2UgdHlwZXMgdG8gcHJlLWxvYWQg\ndGhlIGVudGl0eVRpbWVzdGFtcCBNYXAKICAgICAgICAgICAgQ29sbGVjdGlv\nbiBwZXJUeXBlcyA9CiAgICAgICAgICAgICAgICBjb25mLmdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcygK\nICAgICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAg\nICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncgogICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29udGV4dENsYXNzTG9h\nZGVyQWN0aW9uKCkpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBy\nZS1sb2FkIGFsbCB0aGUgZW50aXR5IHR5cGVzIGludG8gdGhlIEhhc2hNYXAg\ndG8gaGFuZGxlIAogICAgICAgICAgICAvLyBzeW5jaHJvbml6YXRpb24gb24g\ndGhlIG1hcCBlZmZpY2llbnRseQogICAgICAgICAgICBmb3IgKE9iamVjdCBv\nIDogcGVyVHlwZXMpCiAgICAgICAgICAgICAgICBlbnRpdHlUaW1lc3RhbXBN\nYXAucHV0KChTdHJpbmcpbywgbmV3IExvbmcoMCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBvblR5cGVzQ2hhbmdlZChUeXBlc0NoYW5n\nZWRFdmVudCBldikgewogICAgICAgIGlmIChldmljdFBvbGljeSA9PSBFdmlj\ndFBvbGljeS5ERUZBVUxUKSB7CiAgICAgICAgICAgIHdyaXRlTG9jaygpOwog\nICAgICAgICAgICBDb2xsZWN0aW9uIGtleXMgPSBudWxsOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGhhc0xpc3RlbmVycygpKQog\nICAgICAgICAgICAgICAgICAgIGZpcmVFdmVudChldik7CiAgICAgICAgICAg\nICAgICBrZXlzID0ga2V5U2V0KCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICB3cml0ZVVubG9jaygpOwogICAgICAgICAgICB9\nCiAgICAKICAgICAgICAgICAgUXVlcnlLZXkgcWs7CiAgICAgICAgICAgICAg\nICBMaXN0PFF1ZXJ5S2V5PiByZW1vdmVzID0gbnVsbDsKICAgICAgICAgICAg\nICAgIGZvciAoT2JqZWN0IG86IGtleXMpIHsKICAgICAgICAgICAgICAgICAg\nICBxayA9IChRdWVyeUtleSkgbzsKICAgICAgICAgICAgICAgIGlmIChxay5j\naGFuZ2VJbnZhbGlkYXRlc1F1ZXJ5KGV2LmdldFR5cGVzKCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHJlbW92ZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmVtb3ZlcyA9IG5ldyBBcnJheUxpc3Q8UXVlcnlL\nZXk+KCk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3Zlcy5hZGQocWspOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChyZW1vdmVzICE9IG51bGwpCiAgICAgICAgICAgICAgICByZW1vdmVBbGxJ\nbnRlcm5hbChyZW1vdmVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBDb2xsZWN0aW9uIGNoYW5nZWRUeXBlcyA9IGV2LmdldFR5cGVzKCk7CiAg\nICAgICAgICAgIEhhc2hNYXA8U3RyaW5nLExvbmc+IGNoYW5nZWRDbGFzc2Vz\nID0gCiAgICAgICAgICAgICAgICBuZXcgSGFzaE1hcDxTdHJpbmcsTG9uZz4o\nKTsKICAgICAgICAgICAgTG9uZyB0c3RhbXAgPSBuZXcgTG9uZyhTeXN0ZW0u\nY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAgICAgIGZvciAoT2JqZWN0\nIG86IGNoYW5nZWRUeXBlcykgewogICAgICAgICAgICAgICAgU3RyaW5nIG5h\nbWUgPSAoKENsYXNzKSBvKS5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICBp\nZighY2hhbmdlZENsYXNzZXMuY29udGFpbnNLZXkobmFtZSkpIHsKICAgICAg\nICAgICAgICAgICAgICBjaGFuZ2VkQ2xhc3Nlcy5wdXQobmFtZSwgdHN0YW1w\nICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAgICAgICAg\nIAogICAgICAgICAgICAvLyBOb3cgdXBkYXRlIGVudGl0eSB0aW1lc3RhbXAg\nbWFwCiAgICAgICAgICAgIHVwZGF0ZUVudGl0eVRpbWVzdGFtcChjaGFuZ2Vk\nQ2xhc3Nlcyk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBRdWVyeVJl\nc3VsdCBnZXQoUXVlcnlLZXkga2V5KSB7CiAgICAgICAgUXVlcnlSZXN1bHQg\nbyA9IGdldEludGVybmFsKGtleSk7CiAgICAgICAgaWYgKG8gIT0gbnVsbCAm\nJiBvLmlzVGltZWRPdXQoKSkgewogICAgICAgICAgICBvID0gbnVsbDsKICAg\nICAgICAgICAgcmVtb3ZlSW50ZXJuYWwoa2V5KTsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKHNfbG9jLmdldCgiY2FjaGUtdGltZW91dCIsIGtleSkpOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAgICAgICBsb2cudHJh\nY2Uoc19sb2MuZ2V0KCJjYWNoZS1taXNzIiwga2V5KSk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQoImNh\nY2hlLWhpdCIsIGtleSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbzsK\nICAgIH0KCiAgICBwdWJsaWMgUXVlcnlSZXN1bHQgcHV0KFF1ZXJ5S2V5IHFr\nLCBRdWVyeVJlc3VsdCBvaWRzKSB7CiAgICAgICAgUXVlcnlSZXN1bHQgbyA9\nIHB1dEludGVybmFsKHFrLCBvaWRzKTsKICAgICAgICBpZiAobG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZShzX2xvYy5nZXQo\nImNhY2hlLXB1dCIsIHFrKSk7CiAgICAgICAgcmV0dXJuIChvID09IG51bGwg\nfHwgby5pc1RpbWVkT3V0KCkpID8gbnVsbCA6IG87CiAgICB9CgogICAgcHVi\nbGljIFF1ZXJ5UmVzdWx0IHJlbW92ZShRdWVyeUtleSBrZXkpIHsKICAgICAg\nICBRdWVyeVJlc3VsdCBvID0gcmVtb3ZlSW50ZXJuYWwoa2V5KTsKICAgICAg\nICBpZiAobyAhPSBudWxsICYmIG8uaXNUaW1lZE91dCgpKQogICAgICAgICAg\nICBvID0gbnVsbDsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGxvZy50cmFjZShzX2xvYy5nZXQoImNhY2hlLXJlbW92ZS1taXNzIiwga2V5\nKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFj\nZShzX2xvYy5nZXQoImNhY2hlLXJlbW92ZS1oaXQiLCBrZXkpKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG87CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gcGluKFF1ZXJ5S2V5IGtleSkgewogICAgICAgIGJvb2xlYW4gYm9vbCA9\nIHBpbkludGVybmFsKGtleSk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgIGlmIChib29sKQogICAgICAgICAgICAg\nICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtcGluLWhpdCIsIGtleSkp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nc19sb2MuZ2V0KCJjYWNoZS1waW4tbWlzcyIsIGtleSkpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gYm9vbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiB1bnBpbihRdWVyeUtleSBrZXkpIHsKICAgICAgICBib29sZWFuIGJvb2wg\nPSB1bnBpbkludGVybmFsKGtleSk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNl\nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGlmIChib29sKQogICAgICAgICAg\nICAgICAgbG9nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtdW5waW4taGl0Iiwg\na2V5KSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShzX2xvYy5nZXQoImNhY2hlLXVucGluLW1pc3MiLCBrZXkpKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGJvb2w7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgY2xlYXJJbnRlcm5hbCgpOwogICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nLnRyYWNlKHNfbG9jLmdldCgiY2FjaGUtY2xlYXIiLCAiPHF1ZXJ5LWNhY2hl\nPiIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAg\nICBjbG9zZSh0cnVlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBjbG9z\nZShib29sZWFuIGNsZWFyKSB7CiAgICAgICAgaWYgKCFfY2xvc2VkKSB7CiAg\nICAgICAgICAgIGlmIChjbGVhcikKICAgICAgICAgICAgICAgIGNsZWFySW50\nZXJuYWwoKTsKICAgICAgICAgICAgX2Nsb3NlZCA9IHRydWU7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2VkKCkgewogICAg\nICAgIHJldHVybiBfY2xvc2VkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFk\nZFR5cGVzQ2hhbmdlZExpc3RlbmVyKFR5cGVzQ2hhbmdlZExpc3RlbmVyIGxp\nc3RlbikgewogICAgICAgIGFkZExpc3RlbmVyKGxpc3Rlbik7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlVHlwZXNDaGFuZ2VkTGlzdGVuZXIo\nVHlwZXNDaGFuZ2VkTGlzdGVuZXIgbGlzdGVuKSB7CiAgICAgICAgcmV0dXJu\nIHJlbW92ZUxpc3RlbmVyKGxpc3Rlbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyBwYXJ0IG9mIHRoZSB7QGxpbmsgUmVtb3RlQ29t\nbWl0TGlzdGVuZXJ9IGludGVyZmFjZS4gSWYKICAgICAqIHlvdXIgY2FjaGUg\nc3ViY2xhc3MgcmVsaWVzIG9uIE9wZW5KUEEgZm9yIGNsdXN0ZXJpbmcgc3Vw\ncG9ydCwgbWFrZSBpdAogICAgICogaW1wbGVtZW50IDxjb2RlPlJlbW90ZUNv\nbW1pdExpc3RlbmVyPC9jb2RlPi4gVGhpcyBtZXRob2Qgd2lsbCB0YWtlCiAg\nICAgKiBjYXJlIG9mIGludmFsaWRhdGluZyBlbnRyaWVzIGZyb20gcmVtb3Rl\nIGNvbW1pdHMsIGJ5IGRlbGVnYXRpbmcgdG8KICAgICAqIHtAbGluayAjb25U\neXBlc0NoYW5nZWR9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZnRlckNv\nbW1pdChSZW1vdGVDb21taXRFdmVudCBldmVudCkgewogICAgICAgIGlmIChf\nY2xvc2VkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGRyb3Ag\nYWxsIGNvbW1pdHRlZCBjbGFzc2VzCiAgICAgICAgU2V0IGNsYXNzZXMgPSBD\nYWNoZXMuYWRkVHlwZXNCeU5hbWUoY29uZiwKICAgICAgICAgICAgZXZlbnQu\nZ2V0UGVyc2lzdGVkVHlwZU5hbWVzKCksIG51bGwpOwogICAgICAgIGlmIChl\ndmVudC5nZXRQYXlsb2FkVHlwZSgpID09IFJlbW90ZUNvbW1pdEV2ZW50LlBB\nWUxPQURfRVhURU5UUykgewogICAgICAgICAgICBjbGFzc2VzID0gQ2FjaGVz\nLmFkZFR5cGVzQnlOYW1lKGNvbmYsIGV2ZW50LmdldFVwZGF0ZWRUeXBlTmFt\nZXMoKSwKICAgICAgICAgICAgICAgIGNsYXNzZXMpOwogICAgICAgICAgICBj\nbGFzc2VzID0gQ2FjaGVzLmFkZFR5cGVzQnlOYW1lKGNvbmYsIGV2ZW50Lmdl\ndERlbGV0ZWRUeXBlTmFtZXMoKSwKICAgICAgICAgICAgICAgIGNsYXNzZXMp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNsYXNzZXMgPSBhZGRU\neXBlcyhldmVudC5nZXRVcGRhdGVkT2JqZWN0SWRzKCksIGNsYXNzZXMpOwog\nICAgICAgICAgICBjbGFzc2VzID0gYWRkVHlwZXMoZXZlbnQuZ2V0RGVsZXRl\nZE9iamVjdElkcygpLCBjbGFzc2VzKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKGNsYXNzZXMgIT0gbnVsbCkKICAgICAgICAgICAgb25UeXBlc0NoYW5nZWQo\nbmV3IFR5cGVzQ2hhbmdlZEV2ZW50KHRoaXMsIGNsYXNzZXMpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEJ1aWxkIHVwIGEgc2V0IG9mIGNsYXNzZXMgZm9y\nIHRoZSBnaXZlbiBvaWRzLgogICAgICovCiAgICBwcml2YXRlIFNldCBhZGRU\neXBlcyhDb2xsZWN0aW9uIG9pZHMsIFNldCBjbGFzc2VzKSB7CiAgICAgICAg\naWYgKG9pZHMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gY2xhc3Nl\nczsKICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKQogICAgICAgICAgICBj\nbGFzc2VzID0gbmV3IEhhc2hTZXQoKTsKCiAgICAgICAgTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zID0gY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBP\nYmplY3Qgb2lkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2lkcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBvaWQg\nPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAob2lkIGluc3RhbmNlb2Yg\nSWQpCiAgICAgICAgICAgICAgICBjbGFzc2VzLmFkZCgoKElkKSBvaWQpLmdl\ndFR5cGUoKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nLy8gb2sgaWYgbm8gbWV0YWRhdGEgZm9yIG9pZDsgdGhhdCBqdXN0IG1lYW5z\nIHRoZSBwYyB0eXBlCiAgICAgICAgICAgICAgICAvLyBwcm9iYWJseSBoYXNu\nJ3QgYmVlbiBsb2FkZWQgaW50byB0aGlzIEpWTSB5ZXQsIGFuZCB0aGVyZWZv\ncmUKICAgICAgICAgICAgICAgIC8vIHRoZXJlJ3Mgbm8gY2hhbmNlIHRoYXQg\naXQncyBpbiB0aGUgY2FjaGUgYW55d2F5CiAgICAgICAgICAgICAgICBtZXRh\nID0gcmVwb3MuZ2V0TWV0YURhdGEob2lkLCBudWxsLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGNsYXNzZXMuYWRkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xhc3NlczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHRocmVhZHNhZmUgdmll\ndyBvZiB0aGUga2V5cyBpbiB0aGlzIGNhY2hlLiBUaGlzIGNvbGxlY3Rpb24K\nICAgICAqIG11c3QgYmUgaXRlcmFibGUgd2l0aG91dCByaXNrIG9mIGNvbmN1\ncnJlbnQgbW9kaWZpY2F0aW9uIGV4Y2VwdGlvbnMuCiAgICAgKiBJdCBkb2Vz\nIG5vdCBoYXZlIHRvIGltcGxlbWVudCBjb250YWlucygpIGVmZmljaWVudGx5\nIG9yIHVzZSBzZXQKICAgICAqIHNlbWFudGljcy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IENvbGxlY3Rpb24ga2V5U2V0KCk7CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGxpc3QgZm9yIHRoZSBnaXZlbiBrZXkuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBRdWVyeVJlc3VsdCBnZXRJ\nbnRlcm5hbChRdWVyeUtleSBxayk7CgogICAgLyoqCiAgICAgKiBBZGQgdGhl\nIGdpdmVuIHJlc3VsdCB0byB0aGUgY2FjaGUsIHJldHVybmluZyB0aGUgb2xk\nIHJlc3VsdCB1bmRlciB0aGUKICAgICAqIGdpdmVuIGtleS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGFic3RyYWN0IFF1ZXJ5UmVzdWx0IHB1dEludGVybmFs\nKFF1ZXJ5S2V5IHFrLCBRdWVyeVJlc3VsdCBvaWRzKTsKCiAgICAvKioKICAg\nICAqIFJlbW92ZSB0aGUgcmVzdWx0IHVuZGVyIHRoZSBnaXZlbiBrZXkgZnJv\nbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBR\ndWVyeVJlc3VsdCByZW1vdmVJbnRlcm5hbChRdWVyeUtleSBxayk7CgogICAg\nLyoqCiAgICAgKiBSZW1vdmUgYWxsIHJlc3VsdHMgdW5kZXIgdGhlIGdpdmVu\nIGtleXMgZnJvbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIHJlbW92ZUFsbEludGVybmFsKENvbGxlY3Rpb24gcWtzKSB7CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdGVyID0gcWtzLml0ZXJhdG9yKCk7IGl0ZXIu\naGFzTmV4dCgpOykKICAgICAgICAgICAgcmVtb3ZlSW50ZXJuYWwoKFF1ZXJ5\nS2V5KSBpdGVyLm5leHQoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVh\nciB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2\nb2lkIGNsZWFySW50ZXJuYWwoKTsKCiAgICAvKioKICAgICAqIFBpbiBhbiBv\nYmplY3QgdG8gdGhlIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3QgYm9vbGVhbiBwaW5JbnRlcm5hbChRdWVyeUtleSBxayk7CgogICAg\nLyoqCiAgICAgKiBVbnBpbiBhbiBvYmplY3QgZnJvbSB0aGUgY2FjaGUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBib29sZWFuIHVucGluSW50\nZXJuYWwoUXVlcnlLZXkgcWspOwoKICAgIC8vIC0tLS0tLS0tLS0gQ29uZmln\ndXJhYmxlIGltcGxlbWVudGF0aW9uIC0tLS0tLS0tLS0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZikgewog\nICAgICAgIHRoaXMuY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikgY29u\nZjsKICAgICAgICB0aGlzLmxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25m\naWd1cmF0aW9uLkxPR19EQVRBQ0FDSEUpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIC8vIC0tLS0t\nLS0tLS0gQWJzdHJhY3RFdmVudE1hbmFnZXIgaW1wbGVtZW50YXRpb24gLS0t\nLS0tLS0tLQoKICAgIHByb3RlY3RlZCB2b2lkIGZpcmVFdmVudChPYmplY3Qg\nZXZlbnQsIE9iamVjdCBsaXN0ZW5lcikgewogICAgICAgIFR5cGVzQ2hhbmdl\nZExpc3RlbmVyIGxpc3RlbiA9IChUeXBlc0NoYW5nZWRMaXN0ZW5lcikgbGlz\ndGVuZXI7CiAgICAgICAgVHlwZXNDaGFuZ2VkRXZlbnQgZXYgPSAoVHlwZXND\naGFuZ2VkRXZlbnQpIGV2ZW50OwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGxpc3Rlbi5vblR5cGVzQ2hhbmdlZChldik7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2FybihzX2xvYy5nZXQoImV4\ncC1saXN0ZW5lci1leCIpLCBlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbmRpdmlkdWFsIHF1ZXJ5IHJlc3VsdHMgd2lsbCBiZSByZWdp\nc3RlcmVkIGFzIHR5cGVzIGNoYW5nZWQKICAgICAqIGxpc3RlbmVycy4gV2Ug\nd2FudCBzdWNoIHF1ZXJ5IHJlc3VsdHMgdG8gYmUgZ2MnZCBvbmNlCiAgICAg\nKiB0aGUgb25seSByZWZlcmVuY2UgaXMgaGVsZCBieSB0aGUgbGlzdCBvZiBl\neHBpcmF0aW9uIGxpc3RlbmVycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENv\nbGxlY3Rpb24gbmV3TGlzdGVuZXJDb2xsZWN0aW9uKCkgewogICAgICAgIHJl\ndHVybiBuZXcgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hTZXQgKENvbmN1cnJl\nbnRSZWZlcmVuY2VIYXNoU2V0LldFQUspOwoJfQoKICAgIC8qKgogICAgICog\nU2V0cyB0aGUgZXZpY3Rpb24gcG9saWN5IGZvciB0aGUgcXVlcnkgY2FjaGUK\nICAgICAqIEBwYXJhbSBldmljdFBvbGljeSAtLSBTdHJpbmcgdmFsdWUgdGhh\ndCBzcGVjaWZpZXMgdGhlIGV2aWN0aW9uIHBvbGljeQogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRFdmljdFBvbGljeShTdHJpbmcgZXZpY3RQb2xpY3kp\nIHsKICAgICAgICBpZiAoZXZpY3RQb2xpY3kuZXF1YWxzSWdub3JlQ2FzZShU\nSU1FU1RBTVApKQogICAgICAgICAgICB0aGlzLmV2aWN0UG9saWN5ID0gRXZp\nY3RQb2xpY3kuVElNRVNUQU1QOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB0aGUgZXZpY3Rpb25Qb2xpY3kgZm9yIFF1ZXJ5Q2FjaGUKICAgICAq\nIEByZXR1cm4gLS0gcmV0dXJucyBhIFN0cmluZyB2YWx1ZSBvZiBldmljdFBv\nbGljeSBhdHRyaWJ1dGUKICAgICAqLwogICAgcHVibGljIEV2aWN0UG9saWN5\nIGdldEV2aWN0UG9saWN5KCkgewogICAgICAgIHJldHVybiB0aGlzLmV2aWN0\nUG9saWN5OwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZW50\naXR5IHRpbWVzdGFtcCBtYXAgd2l0aCB0aGUgY3VycmVudCB0aW1lIGluIG1p\nbGxpc2Vjb25kcwogICAgICogQHBhcmFtIHRpbWVzdGFtcE1hcCAtLSBhIG1h\ncCB0aGF0IGNvbnRhaW5zIGVudGl0eW5hbWUgYW5kIGl0cyBsYXN0CiAgICAg\nKiB1cGRhdGVkIHRpbWVzdGFtcAogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCB1cGRhdGVFbnRpdHlUaW1lc3RhbXAoTWFwPFN0cmluZyxMb25nPiB0aW1l\nc3RhbXBNYXApIHsKICAgICAgICBpZiAoZW50aXR5VGltZXN0YW1wTWFwICE9\nIG51bGwpCiAgICAgICAgICAgIGVudGl0eVRpbWVzdGFtcE1hcC5wdXRBbGwo\ndGltZXN0YW1wTWFwKTsKICAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIGEgbGlzdCBvZiB0aW1lc3RhbXBzIGluIHRoZSBmb3JtIG9mIExvbmcgb2Jq\nZWN0cwogICAgICogd2hpY2ggYXJlIHRoZSBsYXN0IHVwZGF0ZWQgdGltZSBz\ndGFtcHMgZm9yIHRoZSBnaXZlbiBlbnRpdGllcyBpbiB0aGUKICAgICAqIGtl\neWxpc3QuCiAgICAgKiBAcGFyYW0ga2V5TGlzdCAtLSBMaXN0IG9mIGVudGl0\neSBuYW1lcyAKICAgICAqIEByZXR1cm4gLS0gUmV0dXJucyBhIGxpc3QgdGhh\ndCBoYXMgdGhlIHRpbWVzdGFtcCBmb3IgdGhlIGdpdmVuIGVudGl0aWVzCiAg\nICAgKi8KICAgIHB1YmxpYyBMaXN0PExvbmc+IGdldEFsbEVudGl0eVRpbWVz\ndGFtcChMaXN0PFN0cmluZz4ga2V5TGlzdCkgeyAKICAgICAgICBBcnJheUxp\nc3Q8TG9uZz4gdG12YWwgPSBudWxsOwogICAgICAgIGlmIChlbnRpdHlUaW1l\nc3RhbXBNYXAgIT0gbnVsbCkgewogICAgICAgICAgICBmb3IgKFN0cmluZyBz\nOiBrZXlMaXN0KSB7CiAgICAgICAgICAgICAgICBpZiAoZW50aXR5VGltZXN0\nYW1wTWFwLmNvbnRhaW5zS2V5KHMpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYodG12YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgdG12\nYWwgPSBuZXcgQXJyYXlMaXN0PExvbmc+KCk7CiAgICAgICAgICAgICAgICAg\nICAgdG12YWwuYWRkKGVudGl0eVRpbWVzdGFtcE1hcC5nZXQocykpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0bXZhbDsKICAgIH0KfQo=\n","encoding":"base64"}

