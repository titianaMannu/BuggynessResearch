{"sha":"afcb31e2f80e62f834d1145d8f56f15b8aba98eb","node_id":"MDQ6QmxvYjIwNjM2NDphZmNiMzFlMmY4MGU2MmY4MzRkMTE0NWQ4ZjU2ZjE1YjhhYmE5OGVi","size":28667,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/afcb31e2f80e62f834d1145d8f56f15b8aba98eb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRhdGFDYWNoZVJldHJpZXZl\nTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGF0YUNh\nY2hlU3RvcmVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5EZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbmRDYWxsYmFja3M7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tMZXZlbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2Vz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFu\nYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVR\ndWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0\nYVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5P\ncGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRp\nbWlzdGljRXhjZXB0aW9uOwoKLyoqCiAqIFN0b3JlTWFuYWdlciBwcm94eSB0\naGF0IGRlbGVnYXRlcyB0byBhIGRhdGEgY2FjaGUgd2hlbiBwb3NzaWJsZS4K\nICoKICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICogQG5vamF2YWRvYwog\nKi8KcHVibGljIGNsYXNzIERhdGFDYWNoZVN0b3JlTWFuYWdlcgogICAgZXh0\nZW5kcyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIHsKCiAgICAvLyBhbGwgdGhl\nIHN0YXRlIG1hbmFnZXJzIGNoYW5nZWQgaW4gdGhpcyB0cmFuc2FjdGlvbgog\nICAgcHJpdmF0ZSBDb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IF9p\nbnNlcnRzID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPE9wZW5KUEFTdGF0ZU1h\nbmFnZXIsIEJpdFNldD4gX3VwZGF0ZXMgPSBudWxsOwogICAgcHJpdmF0ZSBD\nb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IF9kZWxldGVzID0gbnVs\nbDsKCiAgICAvLyB0aGUgb3duaW5nIGNvbnRleHQKICAgIHByaXZhdGUgU3Rv\ncmVDb250ZXh0IF9jdHggPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhQ2FjaGVN\nYW5hZ2VyIF9tZ3IgPSBudWxsOwogICAgLy8gcGMgZGF0YSBnZW5lcmF0b3IK\nICAgIHByaXZhdGUgUENEYXRhR2VuZXJhdG9yIF9nZW4gPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFt\nIHNtIHRoZSBzdG9yZSBtYW5hZ2VyIHRvIGRlbGVnYXRlIHRvCiAgICAgKi8K\nICAgIHB1YmxpYyBEYXRhQ2FjaGVTdG9yZU1hbmFnZXIoU3RvcmVNYW5hZ2Vy\nIHNtKSB7CiAgICAgICAgc3VwZXIoc20pOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIF9j\ndHggPSBjdHg7CiAgICAgICAgX21nciA9IGN0eC5nZXRDb25maWd1cmF0aW9u\nKCkuZ2V0RGF0YUNhY2hlTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX2dl\nbiA9IF9tZ3IuZ2V0UENEYXRhR2VuZXJhdG9yKCk7CiAgICAgICAgc3VwZXIu\nc2V0Q29udGV4dChjdHgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2lu\nKCkgewogICAgICAgIHN1cGVyLmJlZ2luKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN1\ncGVyLmNvbW1pdCgpOwogICAgICAgICAgICB1cGRhdGVDYWNoZXMoKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaW5zZXJ0cyA9IG51bGw7\nCiAgICAgICAgICAgIF91cGRhdGVzID0gbnVsbDsKICAgICAgICAgICAgX2Rl\nbGV0ZXMgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCByb2xsYmFjaygpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdXBl\nci5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9pbnNlcnRzID0gbnVsbDsKICAgICAgICAgICAgX3VwZGF0ZXMgPSBudWxs\nOwogICAgICAgICAgICBfZGVsZXRlcyA9IG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogRXZpY3QgYWxsIG1lbWJlcnMgb2YgdGhlIGdp\ndmVuIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBldmljdFR5\ncGVzKENvbGxlY3Rpb248Q2xhc3M8Pz4+IGNsYXNzZXMpIHsKICAgICAgICBp\nZiAoY2xhc3Nlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IG1kciA9IF9jdHguZ2V0Q29uZmln\ndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAg\nICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gX2N0eC5nZXRDbGFzc0xvYWRl\ncigpOwoKICAgICAgICBEYXRhQ2FjaGUgY2FjaGU7CiAgICAgICAgZm9yIChD\nbGFzczw/PiBjbHMgOiBjbGFzc2VzKSB7CiAgICAgICAgICAgIGNhY2hlID0g\nbWRyLmdldE1ldGFEYXRhKGNscywgbG9hZGVyLCBmYWxzZSkuZ2V0RGF0YUNh\nY2hlKCk7CiAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKGNscywgZmFsc2UpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgY2FjaGVzIHdp\ndGggdGhlIGNvbW1pdHRlZCBpbnNlcnRzLCB1cGRhdGVzLCBhbmQgZGVsZXRl\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUNhY2hlcygpIHsK\nICAgICAgICBpZihfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpLmdldENh\nY2hlU3RvcmVNb2RlKCkgIT0gRGF0YUNhY2hlU3RvcmVNb2RlLkJZUEFTUyAp\nIHsgCiAgICAgICAgICAgIC8vIG1hcCBlYWNoIGRhdGEgY2FjaGUgdG8gdGhl\nIG1vZGlmaWNhdGlvbnMgd2UgbmVlZCB0byBwZXJmb3JtCiAgICAgICAgICAg\nIE1hcDxEYXRhQ2FjaGUsTW9kaWZpY2F0aW9ucz4gbW9kTWFwID0gbnVsbDsK\nICAgICAgICAgICAgaWYgKChfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCkg\nJiYgX2luc2VydHMgIT0gbnVsbCkgfHwgX3VwZGF0ZXMgIT0gbnVsbCB8fCBf\nZGVsZXRlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgbW9kTWFwID0gbmV3\nIEhhc2hNYXA8RGF0YUNhY2hlLE1vZGlmaWNhdGlvbnM+KCk7CiAgICAgICAg\nICAgIE1vZGlmaWNhdGlvbnMgbW9kczsKICAgICAgICAgICAgRGF0YUNhY2hl\nUENEYXRhIGRhdGE7CiAgICAgICAgICAgIERhdGFDYWNoZSBjYWNoZTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBwYyBkYXRhcyBmb3IgaW5zZXJ0cwogICAg\nICAgICAgICBpZiAoX2N0eC5nZXRQb3B1bGF0ZURhdGFDYWNoZSgpICYmIF9p\nbnNlcnRzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSA6IF9pbnNlcnRzKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2FjaGUgPSBfbWdyLnNlbGVjdENhY2hlKHNtKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIG1vZHMg\nPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwogICAgICAgICAg\nICAgICAgICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAgICAgICAgICAg\nICAgICAgIGRhdGEuc3RvcmUoc20pOwogICAgICAgICAgICAgICAgICAgIG1v\nZHMuYWRkaXRpb25zLmFkZChuZXcgUENEYXRhSG9sZGVyKGRhdGEsIHNtKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIHVwZGF0ZSBwY2RhdGFzIGZvciB1cGRhdGVzCiAgICAgICAgICAgIGlm\nIChfdXBkYXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBCaXRTZXQg\nZmllbGRzOwogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbTsKICAgICAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5PE9wZW5KUEFTdGF0\nZU1hbmFnZXIsIEJpdFNldD4gZW50cnkgOiBfdXBkYXRlcy5lbnRyeVNldCgp\nKSB7IAogICAgICAgICAgICAgICAgICAgIHNtID0gZW50cnkuZ2V0S2V5KCk7\nCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gZW50cnkuZ2V0VmFsdWUo\nKTsKCiAgICAgICAgICAgICAgICAgICAgY2FjaGUgPSBfbWdyLnNlbGVjdENh\nY2hlKHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGl0J3Mg\nb2sgbm90IHRvIGNsb25lIHRoZSBvYmplY3QgdGhhdCB3ZSBnZXQgZnJvbSB0\naGUgY2FjaGUsCiAgICAgICAgICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUg\naW5zaWRlIHRoZSBjb21taXQoKSBtZXRob2QsIHNvIGFueSBtb2RpZmljYXRp\nb25zCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gdGhlIHVuZGVybHlpbmcg\nY2FjaGUgYXJlIHZhbGlkLiBJZiB0aGUgY29tbWl0IGhhZCBub3QKICAgICAg\nICAgICAgICAgICAgICAvLyBhbHJlYWR5IHN1Y2NlZWRlZCwgdGhlbiB3ZSdk\nIHdhbnQgdG8gY2xvbmUgdGhlIHJldHJpZXZlZAogICAgICAgICAgICAgICAg\nICAgIC8vIG9iamVjdC4KICAgICAgICAgICAgICAgICAgICBkYXRhID0gY2Fj\naGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgICAg\nIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwoKICAg\nICAgICAgICAgICAgICAgICAvLyBkYXRhIHNob3VsZCBhbHdheXMgYmUgbm9u\nLW51bGwsIHNpbmNlIHRoZSBvYmplY3QgaXMKICAgICAgICAgICAgICAgICAg\nICAvLyBkaXJ0eSwgYnV0IG1heWJlIGl0IGdvdCBkcm9wcGVkIGZyb20gdGhl\nIGNhY2hlIGluIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGludGVyaW0K\nICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAg\nICAgICAgICAgICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbW9kcy5uZXdVcGRhdGVzLmFkZChuZXcgUENEYXRh\nSG9sZGVyKGRhdGEsIHNtKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdG9yZShzbSwgZmll\nbGRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kcy5leGlzdGluZ1Vw\nZGF0ZXMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20pKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHJlbW92ZSBwY2RhdGFzIGZvciBkZWxldGVz\nCiAgICAgICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBmb3IgKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gOiBfZGVsZXRl\ncykgeyAKICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IF9tZ3Iuc2VsZWN0\nQ2FjaGUoc20pOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAgICAgbW9kcyA9IGdldE1vZGlmaWNhdGlvbnMobW9kTWFw\nLCBjYWNoZSk7CiAgICAgICAgICAgICAgICAgICAgbW9kcy5kZWxldGVzLmFk\nZChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbm90aWZ5IHRoZSBjYWNoZXMgb2Yg\ndGhlIGNoYW5nZXMKICAgICAgICAgICAgaWYgKG1vZE1hcCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBmb3IgKE1hcC5FbnRyeTxEYXRhQ2FjaGUsTW9k\naWZpY2F0aW9ucz4gZW50cnkgOiBtb2RNYXAuZW50cnlTZXQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGNhY2hlID0gZW50cnkuZ2V0S2V5KCk7CiAgICAg\nICAgICAgICAgICAgICAgbW9kcyA9IGVudHJ5LmdldFZhbHVlKCk7CgogICAg\nICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSdyZSBub3QgY2FjaGlu\nZyBvbGQgdmVyc2lvbnMKICAgICAgICAgICAgICAgICAgICBjYWNoZS53cml0\nZUxvY2soKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICBjYWNoZS5jb21taXQoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMo\nY2FjaGUsIG1vZHMuYWRkaXRpb25zKSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2Fj\naGUsIG1vZHMubmV3VXBkYXRlcyksIAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHRyYW5zZm9ybVRvVmVyc2lvblNhZmVQQ0RhdGFzKGNhY2hl\nLCBtb2RzLmV4aXN0aW5nVXBkYXRlcyksIAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG1vZHMuZGVsZXRlcyk7CiAgICAgICAgICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGUu\nd3JpdGVVbmxvY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHdl\nIHdlcmUgaW4gbGFyZ2VUcmFuc2FjdGlvbiBtb2RlLCB0aGVuIHdlIGhhdmUg\ncmVjb3JkZWQKICAgICAgICAgICAgLy8gdGhlIGNsYXNzZXMgb2YgdXBkYXRl\nZC9kZWxldGVkIG9iamVjdHMgYW5kIHRoZXNlIG5vdyBuZWVkIHRvIGJlCiAg\nICAgICAgICAgIC8vIGV2aWN0ZWQKICAgICAgICAgICAgaWYgKF9jdHguaXNU\ncmFja0NoYW5nZXNCeVR5cGUoKSkgewogICAgICAgICAgICAgICAgZXZpY3RU\neXBlcyhfY3R4LmdldERlbGV0ZWRUeXBlcygpKTsKICAgICAgICAgICAgICAg\nIGV2aWN0VHlwZXMoX2N0eC5nZXRVcGRhdGVkVHlwZXMoKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGFuZCBub3RpZnkgdGhlIHF1ZXJ5IGNh\nY2hlLiAgbm90aWZ5IGluIG9uZSBiYXRjaCB0byByZWR1Y2Ugc3luY2gKICAg\nICAgICAgICAgUXVlcnlDYWNoZSBxdWVyeUNhY2hlID0gX2N0eC5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERhdGFDYWNoZU1hbmFnZXJJ\nbnN0YW5jZSgpLmdldFN5c3RlbVF1ZXJ5Q2FjaGUoKTsKICAgICAgICAgICAg\naWYgKHF1ZXJ5Q2FjaGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbjxDbGFzczw/Pj4gcGVycyA9IF9jdHguZ2V0UGVyc2lzdGVkVHlw\nZXMoKTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IGRl\nbCA9IF9jdHguZ2V0RGVsZXRlZFR5cGVzKCk7CiAgICAgICAgICAgICAgICBD\nb2xsZWN0aW9uPENsYXNzPD8+PiB1cCA9IF9jdHguZ2V0VXBkYXRlZFR5cGVz\nKCk7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZSA9IHBlcnMuc2l6ZSgpICsg\nZGVsLnNpemUoKSArIHVwLnNpemUoKTsKICAgICAgICAgICAgICAgIGlmIChz\naXplID4gMCkgewogICAgICAgICAgICAgICAgICAgIENvbGxlY3Rpb248Q2xh\nc3M8Pz4+IHR5cGVzID0gbmV3IEFycmF5TGlzdDxDbGFzczw/Pj4oc2l6ZSk7\nCiAgICAgICAgICAgICAgICAgICAgdHlwZXMuYWRkQWxsKHBlcnMpOwogICAg\nICAgICAgICAgICAgICAgIHR5cGVzLmFkZEFsbChkZWwpOwogICAgICAgICAg\nICAgICAgICAgIHR5cGVzLmFkZEFsbCh1cCk7CiAgICAgICAgICAgICAgICAg\nICAgcXVlcnlDYWNoZS5vblR5cGVzQ2hhbmdlZChuZXcgVHlwZXNDaGFuZ2Vk\nRXZlbnQodGhpcywgdHlwZXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSAKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFu\nc2Zvcm1zIGEgY29sbGVjdGlvbiBvZiB7QGxpbmsgUENEYXRhSG9sZGVyfXMg\ndGhhdCBtaWdodCBjb250YWluCiAgICAgKiBzdGFsZSBpbnN0YW5jZXMgaW50\nbyBhIGNvbGxlY3Rpb24gb2YgdXAtdG8tZGF0ZSB7QGxpbmsgRGF0YUNhY2hl\nUENEYXRhfXMuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxEYXRhQ2FjaGVQ\nQ0RhdGE+IHRyYW5zZm9ybVRvVmVyc2lvblNhZmVQQ0RhdGFzKERhdGFDYWNo\nZSBjYWNoZSwgTGlzdDxQQ0RhdGFIb2xkZXI+IGhvbGRlcnMpIHsKICAgICAg\nICBMaXN0PERhdGFDYWNoZVBDRGF0YT4gdHJhbnNmb3JtZWQgPSBuZXcgQXJy\nYXlMaXN0PERhdGFDYWNoZVBDRGF0YT4oaG9sZGVycy5zaXplKCkpOwogICAg\nICAgIE1hcDxPYmplY3QsSW50ZWdlcj4gaWRzID0gbmV3IEhhc2hNYXA8T2Jq\nZWN0LEludGVnZXI+KGhvbGRlcnMuc2l6ZSgpKTsKICAgICAgICAvLyB0aGlz\nIGxpc3QgY291bGQgYmUgcmVtb3ZlZCBpZiBEYXRhQ2FjaGUuZ2V0QWxsKCkg\ndG9vayBhIENvbGxlY3Rpb24KICAgICAgICBMaXN0PE9iamVjdD4gaWRMaXN0\nID0gbmV3IEFycmF5TGlzdDxPYmplY3Q+KGhvbGRlcnMuc2l6ZSgpKTsKICAg\nICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChQQ0RhdGFIb2xkZXIgaG9s\nZGVyIDogaG9sZGVycykgewogICAgICAgICAgICBpZHMucHV0KGhvbGRlci5z\nbS5nZXRPYmplY3RJZCgpLCBpKyspOwogICAgICAgICAgICBpZExpc3QuYWRk\nKGhvbGRlci5zbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICB9CgogICAgICAg\nIE1hcDxPYmplY3QsRGF0YUNhY2hlUENEYXRhPiBwY2RhdGFzID0gY2FjaGUu\nZ2V0QWxsKGlkTGlzdCk7CiAgICAgICAgZm9yIChFbnRyeTxPYmplY3QsRGF0\nYUNhY2hlUENEYXRhPiBlbnRyeSA6IHBjZGF0YXMuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICBJbnRlZ2VyIGluZGV4ID0gaWRzLmdldChlbnRyeS5nZXRL\nZXkoKSk7CiAgICAgICAgICAgIERhdGFDYWNoZVBDRGF0YSBvbGRwYyA9IGVu\ndHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgIFBDRGF0YUhvbGRlciBob2xk\nZXIgPSBob2xkZXJzLmdldChpbmRleCk7CiAgICAgICAgICAgIGlmIChvbGRw\nYyAhPSBudWxsICYmIGNvbXBhcmVWZXJzaW9uKGhvbGRlci5zbSwKICAgICAg\nICAgICAgICAgIGhvbGRlci5zbS5nZXRWZXJzaW9uKCksIG9sZHBjLmdldFZl\ncnNpb24oKSkgPT0gVkVSU0lPTl9FQVJMSUVSKQogICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRy\nYW5zZm9ybWVkLmFkZChob2xkZXIucGNkYXRhKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRyYW5zZm9ybWVkOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEge0BsaW5rIE1vZGlmaWNhdGlvbnN9IGluc3RhbmNlIHRvIHRy\nYWNrIG1vZGlmaWNhdGlvbnMKICAgICAqIHRvIHRoZSBnaXZlbiBjYWNoZSwg\nY3JlYXRpbmcgYW5kIGNhY2hpbmcgdGhlIGluc3RhbmNlIGlmIGl0IGRvZXMK\nICAgICAqIG5vdCBhbHJlYWR5IGV4aXN0IGluIHRoZSBnaXZlbiBtYXAuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE1vZGlmaWNhdGlvbnMgZ2V0TW9k\naWZpY2F0aW9ucyhNYXA8RGF0YUNhY2hlLE1vZGlmaWNhdGlvbnM+IG1vZE1h\ncCwgRGF0YUNhY2hlIGNhY2hlKSB7CiAgICAgICAgTW9kaWZpY2F0aW9ucyBt\nb2RzID0gKE1vZGlmaWNhdGlvbnMpIG1vZE1hcC5nZXQoY2FjaGUpOwogICAg\nICAgIGlmIChtb2RzID09IG51bGwpIHsKICAgICAgICAgICAgbW9kcyA9IG5l\ndyBNb2RpZmljYXRpb25zKCk7CiAgICAgICAgICAgIG1vZE1hcC5wdXQoY2Fj\naGUsIG1vZHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kczsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgRGF0YUNhY2hlIGNh\nY2hlID0gX21nci5zZWxlY3RDYWNoZShzbSk7IAogICAgICAgIGlmIChjYWNo\nZSAhPSBudWxsICYmICFpc0xvY2tpbmcobnVsbCkKICAgICAgICAgICAgJiYg\nY2FjaGUuY29udGFpbnMoc20uZ2V0T2JqZWN0SWQoKSkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBzdXBlci5leGlzdHMoc20s\nIGVkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lv\nbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAg\nICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLnNlbGVjdENhY2hlKHNtKTsK\nICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBzdXBlci5zeW5jVmVyc2lvbihzbSwgZWRh\ndGEpOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YTsKICAgICAgICBP\nYmplY3QgdmVyc2lvbiA9IG51bGw7CiAgICAgICAgZGF0YSA9IGNhY2hlLmdl\ndChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAoIWlzTG9ja2luZyhu\ndWxsKSAmJiBkYXRhICE9IG51bGwpCiAgICAgICAgICAgIHZlcnNpb24gPSBk\nYXRhLmdldFZlcnNpb24oKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIGNh\nY2hlZCB2ZXJzaW9uIHVwZGF0ZSBmcm9tIHRoZXJlCiAgICAgICAgaWYgKHZl\ncnNpb24gIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIXZlcnNpb24uZXF1\nYWxzKHNtLmdldFZlcnNpb24oKSkpIHsKICAgICAgICAgICAgICAgIHNtLnNl\ndFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQoKICAgICAgICAvLyB1c2UgZGF0YSBzdG9yZSB2ZXJzaW9uCiAg\nICAgICAgcmV0dXJuIHN1cGVyLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLCBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgICAgIGJvb2xlYW4gZnJv\nbURhdGFiYXNlOyAKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLnNl\nbGVjdENhY2hlKHNtKTsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9\nIG51bGw7CiAgICAgICAgYm9vbGVhbiB1cGRhdGVDYWNoZSA9IF9jdHguZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCkuZ2V0Q2FjaGVTdG9yZU1vZGUoKSAhPSBE\nYXRhQ2FjaGVTdG9yZU1vZGUuQllQQVNTIAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgX2N0eC5nZXRQb3B1bGF0ZURhdGFDYWNoZSgpOwogICAg\nICAgIGlmIChjYWNoZSA9PSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSAKICAg\nICAgICAgICAgfHwgX2N0eC5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKS5nZXRD\nYWNoZVJldHJpZXZlTW9kZSgpID09IERhdGFDYWNoZVJldHJpZXZlTW9kZS5C\nWVBBU1MKICAgICAgICAgICAgfHwgX2N0eC5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKS5nZXRDYWNoZVN0b3JlTW9kZSgpID09IERhdGFDYWNoZVN0b3JlTW9k\nZS5SRUZSRVNIKSB7CiAgICAgICAgICAgIGZyb21EYXRhYmFzZSA9IHN1cGVy\nLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGEgPSBjYWNoZS5nZXQoc20uZ2V0\nT2JqZWN0SWQoKSk7CiAgICAgICAgICAgIGlmIChkYXRhICE9IG51bGwgJiYg\nIWlzTG9ja2luZyhmZXRjaCkpIHsgICAgICAgICAgICAgICAgCiAgICAgICAg\nICAgICAgICAvLyMjIyB0aGUgJ2RhdGEudHlwZScgYWNjZXNzIGhlcmUgcHJv\nYmFibHkgbmVlZHMgdG8gYmUKICAgICAgICAgICAgICAgIC8vIyMjIGFkZHJl\nc3NlZCBmb3IgYnVnIDUxMQogICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6\nZShkYXRhLmdldFR5cGUoKSwgc3RhdGUpOwogICAgICAgICAgICAgICAgZGF0\nYS5sb2FkKHNtLCBmZXRjaCwgZWRhdGEpOwogICAgICAgICAgICAgICAgLy8g\nbm8gbmVlZCB0byB1cGRhdGUgdGhlIGNhY2hlLiAKICAgICAgICAgICAgICAg\nIHVwZGF0ZUNhY2hlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBmcm9tRGF0\nYWJhc2UgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgLy8gaW5pdGlhbGl6ZSBmcm9tIHN0b3JlIG1hbmFnZXIKICAgICAg\nICAgICAgICAgIGZyb21EYXRhYmFzZSA9IHN1cGVyLmluaXRpYWxpemUoc20s\nIHN0YXRlLCBmZXRjaCwgZWRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBpZiAoY2FjaGUgIT0gbnVsbCAmJiAoZnJvbURhdGFiYXNl\nICYmIHVwZGF0ZUNhY2hlKSkgewogICAgICAgICAgICAvLyB1cGRhdGUgY2Fj\naGUgaWYgdGhlIHJlc3VsdCBjYW1lIGZyb20gdGhlIGRhdGFiYXNlIGFuZCBj\nb25maWd1cmVkIHRvIHN0b3JlIG9yIHJlZnJlc2ggdGhlIGNhY2hlLgogICAg\nICAgICAgICBjYWNoZVN0YXRlTWFuYWdlcihjYWNoZSwgc20sIGRhdGEpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZnJvbURhdGFiYXNlOwogICAgfQog\nICAgCiAgICBwcml2YXRlIHZvaWQgY2FjaGVTdGF0ZU1hbmFnZXIoRGF0YUNh\nY2hlIGNhY2hlLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBEYXRhQ2FjaGVQ\nQ0RhdGEgZGF0YSkgewogICAgICAgIGlmIChzbS5pc0ZsdXNoZWQoKSkgeyAK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBtYWtl\nIHN1cmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNhY2hlIGFuIG9sZCB2\nZXJzaW9uCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCAmJiBjb21wYXJlVmVy\nc2lvbihzbSwgc20uZ2V0VmVyc2lvbigpLCBkYXRhLmdldFZlcnNpb24oKSkg\nPT0gVkVSU0lPTl9FQVJMSUVSKSB7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNhY2hlIG5ld2x5IGxv\nYWRlZCBpbmZvLiBJdCBpcyBzYWZlIHRvIGNhY2hlIGRhdGEgZnJvcm0KICAg\nICAgICAgICAgLy8gaW5pdGlhbGl6ZSgpIGJlY2F1c2UgdGhpcyBtZXRob2Qg\naXMgb25seSBjYWxsZWQgdXBvbgogICAgICAgICAgICAvLyBpbml0aWFsIGxv\nYWQgb2YgdGhlIGRhdGEuCiAgICAgICAgICAgIGJvb2xlYW4gaXNOZXcgPSBk\nYXRhID09IG51bGw7CiAgICAgICAgICAgIGlmIChpc05ldykgewogICAgICAg\nICAgICAgICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgZGF0YS5zdG9yZShzbSk7CiAgICAgICAgICAgIGlmIChp\nc05ldykgeyAKICAgICAgICAgICAgICAgIGNhY2hlLnB1dChkYXRhKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhY2hlLnVwZGF0\nZShkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwsIE9iamVjdCBlZGF0YSkgewogICAg\nICAgIERhdGFDYWNoZSBjYWNoZSA9IF9tZ3Iuc2VsZWN0Q2FjaGUoc20pOwog\nICAgICAgIGlmIChjYWNoZSA9PSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSB8\nfCBieXBhc3MoX2N0eC5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwgU3RvcmVN\nYW5hZ2VyLkZPUkNFX0xPQURfTk9ORSkpCiAgICAgICAgICAgIHJldHVybiBz\ndXBlci5sb2FkKHNtLCBmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIGVkYXRh\nKTsKCiAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRhdGEgPSBjYWNoZS5nZXQo\nc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgaWYgKGxvY2tMZXZlbCA9PSBM\nb2NrTGV2ZWxzLkxPQ0tfTk9ORSAmJiAhaXNMb2NraW5nKGZldGNoKSAmJiBk\nYXRhICE9IG51bGwpCiAgICAgICAgICAgIGRhdGEubG9hZChzbSwgZmllbGRz\nLCBmZXRjaCwgZWRhdGEpOwogICAgICAgIGlmIChmaWVsZHMubGVuZ3RoKCkg\nPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIGxv\nYWQgZnJvbSBzdG9yZSBtYW5hZ2VyOyBjbG9uZSB0aGUgc2V0IG9mIHN0aWxs\nLXVubG9hZGVkIGZpZWxkcwogICAgICAgIC8vIHNvIHRoYXQgaWYgdGhlIHN0\nb3JlIG1hbmFnZXIgZGVjaWRlcyB0byBtb2RpZnkgaXQgaXQgd29uJ3QgYWZm\nZWN0IHVzCiAgICAgICAgaWYgKCFzdXBlci5sb2FkKHNtLCAoQml0U2V0KSBm\naWVsZHMuY2xvbmUoKSwgZmV0Y2gsIGxvY2tMZXZlbCwgZWRhdGEpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9jdHguZ2V0UG9w\ndWxhdGVEYXRhQ2FjaGUoKSkgewogICAgICAgICAgICBjYWNoZVN0YXRlTWFu\nYWdlcihjYWNoZSwgc20sIGRhdGEpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gdHJ1ZTsKCiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb248T2JqZWN0\nPiBsb2FkQWxsKENvbGxlY3Rpb248T3BlbkpQQVN0YXRlTWFuYWdlcj4gc21z\nLCBQQ1N0YXRlIHN0YXRlLCBpbnQgbG9hZCwKICAgIAkJRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBPYmplY3QgZWRhdGEpIHsKICAgIAlpZiAoYnlwYXNz\nKGZldGNoLCBsb2FkKSkgewogICAgCSAgICByZXR1cm4gc3VwZXIubG9hZEFs\nbChzbXMsIHN0YXRlLCBsb2FkLCBmZXRjaCwgZWRhdGEpOwogICAgCX0KCiAg\nICAgICAgTWFwPE9wZW5KUEFTdGF0ZU1hbmFnZXIsIEJpdFNldD4gdW5sb2Fk\nZWQgPSBudWxsOwogICAgICAgIExpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4g\nc21MaXN0ID0gbnVsbDsKICAgICAgICBNYXA8RGF0YUNhY2hlLExpc3Q8T3Bl\nbkpQQVN0YXRlTWFuYWdlcj4+IGNhY2hlcyA9IG5ldyBIYXNoTWFwPERhdGFD\nYWNoZSxMaXN0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+PigpOwogICAgICAgIERh\ndGFDYWNoZSBjYWNoZTsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YTsK\nICAgICAgICBCaXRTZXQgZmllbGRzOwoKICAgICAgICBmb3IgKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20gOiBzbXMpIHsKICAgICAgICAgICAgY2FjaGUgPSBf\nbWdyLnNlbGVjdENhY2hlKHNtKTsKICAgICAgICAgICAgaWYgKGNhY2hlID09\nIG51bGwgfHwgc20uaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAgICB1\nbmxvYWRlZCA9IGFkZFVubG9hZGVkKHNtLCBudWxsLCB1bmxvYWRlZCk7CiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpID09IG51bGwKICAg\nICAgICAgICAgICAgIHx8IGxvYWQgIT0gRk9SQ0VfTE9BRF9OT05FCiAgICAg\nICAgICAgICAgICB8fCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xM\nT1cpIHsKICAgICAgICAgICAgICAgIHNtTGlzdCA9IGNhY2hlcy5nZXQoY2Fj\naGUpOwogICAgICAgICAgICAgICAgaWYgKHNtTGlzdCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgc21MaXN0ID0gbmV3IEFycmF5TGlzdDxPcGVu\nSlBBU3RhdGVNYW5hZ2VyPigpOwogICAgICAgICAgICAgICAgICAgIGNhY2hl\ncy5wdXQoY2FjaGUsIHNtTGlzdCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBzbUxpc3QuYWRkKHNtKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmICghY2FjaGUuY29udGFpbnMoc20uZ2V0T2JqZWN0SWQoKSkpCiAgICAg\nICAgICAgICAgICB1bmxvYWRlZCA9IGFkZFVubG9hZGVkKHNtLCBudWxsLCB1\nbmxvYWRlZCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciAoSXRl\ncmF0b3I8RGF0YUNhY2hlPiBpdHIgPSBjYWNoZXMua2V5U2V0KCkuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgY2FjaGUgPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICBzbUxpc3QgPSBjYWNoZXMuZ2V0KGNh\nY2hlKTsKICAgICAgICAgICAgTGlzdDxPYmplY3Q+IG9pZExpc3QgPSBuZXcg\nQXJyYXlMaXN0PE9iamVjdD4oc21MaXN0LnNpemUoKSk7CgogICAgICAgICAg\nICBmb3IgKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gOiBzbUxpc3QpIHsKICAg\nICAgICAgICAgICAgIG9pZExpc3QuYWRkKChPcGVuSlBBSWQpIHNtLmdldE9i\namVjdElkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAg\nICAgICBNYXA8T2JqZWN0LERhdGFDYWNoZVBDRGF0YT4gZGF0YU1hcCA9IGNh\nY2hlLmdldEFsbChvaWRMaXN0KTsKCiAgICAgICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSA6IHNtTGlzdCkgewogICAgICAgICAgICAgICAg\nZGF0YSA9IGRhdGFNYXAuZ2V0KHNtLmdldE9iamVjdElkKCkpOwoKICAgICAg\nICAgICAgICAgIGlmIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICAvLyMjIyB0aGUgJ2RhdGEudHlwZScg\nYWNjZXNzIGhlcmUgcHJvYmFibHkgbmVlZHMKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8jIyMgdG8gYmUgYWRkcmVzc2VkIGZvciBidWcgNTExCiAgICAg\nICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUoZGF0YS5nZXRUeXBl\nKCksIHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5sb2Fk\nKHNtLCBmZXRjaCwgZWRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5s\nb2FkZWQoc20sIG51bGwsIHVubG9hZGVkKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWQgIT0gRk9SQ0Vf\nTE9BRF9OT05FCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHNtLmdldFBD\nU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAgICAgICAgICAg\nICAgIGRhdGEgPSBjYWNoZS5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBsb2FkIHVubG9hZGVkIGZpZWxkcwogICAgICAg\nICAgICAgICAgICAgICAgICBmaWVsZHMgPSBzbS5nZXRVbmxvYWRlZChmZXRj\naCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubG9hZChzbSwgZmll\nbGRzLCBmZXRjaCwgZWRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoZmllbGRzLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIGZpZWxkcywgdW5s\nb2FkZWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICB1bmxvYWRlZCA9IGFkZFVubG9hZGVkKHNtLCBudWxs\nLCB1bmxvYWRlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIGlmICh1bmxvYWRlZCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CgogICAg\nICAgIC8vIGxvYWQgd2l0aCBkZWxlZ2F0ZQogICAgICAgIENvbGxlY3Rpb248\nT2JqZWN0PiBmYWlsZWQgPSBzdXBlci5sb2FkQWxsKHVubG9hZGVkLmtleVNl\ndCgpLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICBpZiAo\nIV9jdHguZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhaWxlZDsKCiAgICAgICAgLy8gZm9yIGVhY2ggbG9hZGVkIGluc3Rh\nbmNlLCBtZXJnZSBsb2FkZWQgc3RhdGUgaW50byBjYWNoZWQgZGF0YQoKICAg\nICAgICBib29sZWFuIGlzTmV3OwoKICAgICAgICBmb3IoTWFwLkVudHJ5PE9w\nZW5KUEFTdGF0ZU1hbmFnZXIsIEJpdFNldD4gZW50cnkgOiB1bmxvYWRlZC5l\nbnRyeVNldCgpKSB7IAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgIGZpZWxkcyA9IGVu\ndHJ5LmdldFZhbHVlKCk7CgogICAgICAgICAgICBjYWNoZSA9IF9tZ3Iuc2Vs\nZWN0Q2FjaGUoc20pOwogICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCB8\nfCBzbS5pc0VtYmVkZGVkKCkgfHwgKGZhaWxlZCAhPSBudWxsCiAgICAgICAg\nICAgICAgICAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNhY2hlIGFuIG9sZCB2ZXJz\naW9uCiAgICAgICAgICAgIGNhY2hlLndyaXRlTG9jaygpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5n\nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgICAgIGlmIChkYXRhICE9IG51\nbGwgJiYgY29tcGFyZVZlcnNpb24oc20sIHNtLmdldFZlcnNpb24oKSwKICAg\nICAgICAgICAgICAgICAgICBkYXRhLmdldFZlcnNpb24oKSkgPT0gVkVSU0lP\nTl9FQVJMSUVSKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgIGlzTmV3ID0gZGF0YSA9PSBudWxsOwogICAgICAgICAg\nICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBu\nZXdQQ0RhdGEoc20pOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGRhdGEuc3RvcmUoc20pOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGRhdGEuc3Rv\ncmUoc20sIGZpZWxkcyk7CiAgICAgICAgICAgICAgICBpZiAoaXNOZXcpCiAg\nICAgICAgICAgICAgICAgICAgY2FjaGUucHV0KGRhdGEpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNhY2hlLnVwZGF0ZShk\nYXRhKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZhaWxlZDsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBhbiB1bmxvYWRlZCBpbnN0YW5j\nZSB0byB0aGUgZ2l2ZW4gbWFwLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0PiBhZGRVbmxvYWRl\nZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAg\nICAgIE1hcDxPcGVuSlBBU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+IHVubG9hZGVk\nKSB7CiAgICAgICAgaWYgKHVubG9hZGVkID09IG51bGwpCiAgICAgICAgICAg\nIHVubG9hZGVkID0gbmV3IEhhc2hNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwg\nQml0U2V0PigpOwogICAgICAgIHVubG9hZGVkLnB1dChzbSwgZmllbGRzKTsK\nICAgICAgICByZXR1cm4gdW5sb2FkZWQ7CiAgICB9CgogICAgcHVibGljIENv\nbGxlY3Rpb248RXhjZXB0aW9uPiBmbHVzaChDb2xsZWN0aW9uPE9wZW5KUEFT\ndGF0ZU1hbmFnZXI+IHN0YXRlcykgewogICAgICAgIENvbGxlY3Rpb248RXhj\nZXB0aW9uPiBleGNlcHMgPSBzdXBlci5mbHVzaChzdGF0ZXMpOwoKICAgICAg\nICAvLyBpZiB0aGVyZSB3ZXJlIGVycm9ycyBldmljdCBiYWQgaW5zdGFuY2Vz\nIGFuZCBkb24ndCByZWNvcmQgY2hhbmdlcwogICAgICAgIGlmICghZXhjZXBz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBmb3IgKEV4Y2VwdGlvbiBlIDog\nZXhjZXBzKSB7CiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE9w\ndGltaXN0aWNFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgbm90aWZ5\nT3B0aW1pc3RpY0xvY2tGYWlsdXJlKChPcHRpbWlzdGljRXhjZXB0aW9uKSBl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZXhjZXBzOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgbGFyZ2UgdHJhbnNhY3Rpb24gbW9k\nZSBkb24ndCByZWNvcmQgaW5kaXZpZHVhbCBjaGFuZ2VzCiAgICAgICAgaWYg\nKF9jdHguaXNUcmFja0NoYW5nZXNCeVR5cGUoKSkKICAgICAgICAgICAgcmV0\ndXJuIGV4Y2VwczsKCiAgICAgICAgZm9yIChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtIDogc3RhdGVzKSB7CiAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRl\nKCkgPT0gUENTdGF0ZS5QTkVXICYmICFzbS5pc0ZsdXNoZWQoKSkgewogICAg\nICAgICAgICAgICAgaWYgKF9pbnNlcnRzID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICBfaW5zZXJ0cyA9IG5ldyBBcnJheUxpc3Q8T3BlbkpQQVN0\nYXRlTWFuYWdlcj4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIF9pbnNlcnRzLmFkZChzbSk7CgogICAgICAgICAgICAgICAgLy8gbWF5\nIGhhdmUgYmVlbiByZS1wZXJzaXN0ZWQKICAgICAgICAgICAgICAgIGlmIChf\nZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgX2RlbGV0\nZXMucmVtb3ZlKHNtKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoX2luc2VydHMgIT0gbnVsbCAKICAgICAgICAgICAgICAg\nICYmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXREVMRVRFRCAK\nICAgICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRl\nLlBORVdGTFVTSEVEREVMRVRFRCkpIHsKICAgICAgICAgICAgICAgIF9pbnNl\ncnRzLnJlbW92ZShzbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxz\nZSBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUERJUlRZKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX3VwZGF0ZXMgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIF91cGRhdGVzID0gbmV3IEhhc2hNYXA8T3BlbkpQQVN0\nYXRlTWFuYWdlciwgQml0U2V0PigpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgX3VwZGF0ZXMucHV0KHNtLCBzbS5nZXREaXJ0eSgpKTsK\nICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENT\ndGF0ZS5QREVMRVRFRCkgewogICAgICAgICAgICAgICAgaWYgKF9kZWxldGVz\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBfZGVsZXRlcyA9IG5l\ndyBIYXNoU2V0PE9wZW5KUEFTdGF0ZU1hbmFnZXI+KCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBfZGVsZXRlcy5hZGQoc20pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBDb2xsZWN0aW9u\ncy5lbXB0eUxpc3QoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgbG9j\nYWwgc3RhbGVuZXNzIGRldGVjdGlvbiBldmVudHMgZnJvbSB0aGUgY2FjaGUg\ndGhlIE9JRCAoaWYKICAgICAqIGF2YWlsYWJsZSkgdGhhdCByZXN1bHRlZCBp\nbiBhbiBvcHRpbWlzdGljIGxvY2sgZXhjZXB0aW9uIGlmZiB0aGUKICAgICAq\nIHZlcnNpb24gaW5mb3JtYXRpb24gaW4gdGhlIGNhY2hlIG1hdGNoZXMgdGhl\nIHZlcnNpb24gaW5mb3JtYXRpb24KICAgICAqIGluIHRoZSBzdGF0ZSBtYW5h\nZ2VyIGZvciB0aGUgZmFpbGVkIGluc3RhbmNlLiBUaGlzIG1lYW5zIHRoYXQg\nd2UKICAgICAqIHdpbGwgZXZpY3QgZGF0YSBmcm9tIHRoZSBjYWNoZSBmb3Ig\ncmVjb3JkcyB0aGF0IHNob3VsZCBoYXZlCiAgICAgKiBzdWNjZXNzZnVsbHkg\nY29tbWl0dGVkIGFjY29yZGluZyB0byB0aGUgZGF0YSBjYWNoZSBidXQKICAg\nICAqIGRpZCBub3QuIFRoZSBvbmx5IHByZWRpY3RhYmxlIHJlYXNvbiB0aGF0\nIGNvdWxkIGNhdXNlIHRoaXMgYmVoYXZpb3IKICAgICAqIGlzIGEgY29uY3Vy\ncmVudCBvdXQtb2YtYmFuZCBtb2RpZmljYXRpb24gdG8gdGhlIGRhdGFiYXNl\nIHRoYXQgd2FzIG5vdCAKICAgICAqIGNvbW11bmljYXRlZCB0byB0aGUgY2Fj\naGUuIFRoaXMgbG9naWMgbWFrZXMgT3BlbkpQQSdzIGRhdGEgY2FjaGUgCiAg\nICAgKiBzb21ld2hhdCB0b2xlcmFudCBvZiBzdWNoIGJlaGF2aW9yLCBpbiB0\naGF0IHRoZSBjYWNoZSB3aWxsIGJlIGNsZWFuZWQgCiAgICAgKiB1cCBhcyBm\nYWlsdXJlcyBvY2N1ci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG5vdGlm\neU9wdGltaXN0aWNMb2NrRmFpbHVyZShPcHRpbWlzdGljRXhjZXB0aW9uIGUp\nIHsKICAgICAgICBPYmplY3QgbyA9IGUuZ2V0RmFpbGVkT2JqZWN0KCk7CiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IF9jdHguZ2V0U3RhdGVN\nYW5hZ2VyKG8pOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdldElkKCk7CiAg\nICAgICAgYm9vbGVhbiByZW1vdmU7CgogICAgICAgIC8vIHRoaXMgbG9naWMg\nY291bGQgYmUgbW9yZSBlZmZpY2llbnQgLS0gd2UgY291bGQgYWdncmVnYXRl\nCiAgICAgICAgLy8gYWxsIHRoZSBjYWNoZS0+b2lkIGNoYW5nZXMsIGFuZCB0\naGVuIHVzZSBEYXRhQ2FjaGUucmVtb3ZlQWxsKCkgCiAgICAgICAgLy8gYW5k\nIGxlc3Mgd3JpdGUgbG9ja3MgdG8gZG8gdGhlIG11dGF0aW9uLgogICAgICAg\nIERhdGFDYWNoZSBjYWNoZSA9IF9tZ3Iuc2VsZWN0Q2FjaGUoc20pOwogICAg\nICAgIGlmIChjYWNoZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGNhY2hlLndyaXRlTG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRhID0gY2FjaGUuZ2V0KG9pZCk7\nCiAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm47CgogICAgICAgICAgICBzd2l0Y2ggKGNvbXBhcmVWZXJzaW9u\nKHNtLCBzbS5nZXRWZXJzaW9uKCksIGRhdGEuZ2V0VmVyc2lvbigpKSkgewog\nICAgICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVSU0lPTl9MQVRF\nUjoKICAgICAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJT05f\nU0FNRToKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHR4J3MgY3VycmVu\ndCB2ZXJzaW9uIGlzIGxhdGVyIHRoYW4gb3IgdGhlIHNhbWUgYXMgCiAgICAg\nICAgICAgICAgICAgICAgLy8gdGhlIGRhdGEgY2FjaGUgdmVyc2lvbi4gSW4g\ndGhpcyBjYXNlLCB0aGUgY29tbWl0IHNob3VsZCAKICAgICAgICAgICAgICAg\nICAgICAvLyBoYXZlIHN1Y2NlZWRlZCBmcm9tIHRoZSBzdGFuZHBvaW50IG9m\nIHRoZSBjYWNoZS4gUmVtb3ZlIAogICAgICAgICAgICAgICAgICAgIC8vIHRo\nZSBpbnN0YW5jZSBmcm9tIGNhY2hlIGluIHRoZSBob3BlcyB0aGF0IHRoZSBj\nYWNoZSBpcyAKICAgICAgICAgICAgICAgICAgICAvLyBvdXQgb2Ygc3luYy4K\nICAgICAgICAgICAgICAgICAgICByZW1vdmUgPSB0cnVlOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTdG9yZU1h\nbmFnZXIuVkVSU0lPTl9FQVJMSUVSOgogICAgICAgICAgICAgICAgICAgIC8v\nIFRoaXMgdHgncyBjdXJyZW50IHZlcnNpb24gaXMgZWFybGllciB0aGFuIHRo\nZSBkYXRhIAogICAgICAgICAgICAgICAgICAgIC8vIGNhY2hlIHZlcnNpb24u\nIFRoaXMgaXMgYSBub3JtYWwgb3B0aW1pc3RpYyBsb2NrIGZhaWx1cmUuIAog\nICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBjbGVhbiB1cCB0aGUgY2Fj\naGU7IGl0IHByb2JhYmx5IGFscmVhZHkgaGFzIHRoZSAKICAgICAgICAgICAg\nICAgICAgICAvLyByaWdodCB2YWx1ZXMsIGFuZCBpZiBub3QsIGl0J2xsIGdl\ndCBjbGVhbmVkIHVwIGJ5IGEgdHgKICAgICAgICAgICAgICAgICAgICAvLyB0\naGF0IGZhaWxzIGluIG9uZSBvZiB0aGUgb3RoZXIgY2FzZSBzdGF0ZW1lbnRz\nLgogICAgICAgICAgICAgICAgICAgIHJlbW92ZSA9IGZhbHNlOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTdG9y\nZU1hbmFnZXIuVkVSU0lPTl9ESUZGRVJFTlQ6CiAgICAgICAgICAgICAgICAg\nICAgLy8gVGhlIHZlcnNpb24gc3RyYXRlZ3kgZm9yIHRoZSBmYWlsZWQgb2Jq\nZWN0IGRvZXMgbm90CiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgZW5v\ndWdoIGluZm9ybWF0aW9uIHRvIG9wdGltaXplIGZvciBleHBlY3RlZAogICAg\nICAgICAgICAgICAgICAgIC8vIGZhaWx1cmVzLiBDbGVhbiB1cCB0aGUgY2Fj\naGUuCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgLy8gVW5leHBlY3RlZCByZXR1cm4gdmFs\ndWUuIFJlbW92ZSB0byBiZSBmdXR1cmUtcHJvb2YuCiAgICAgICAgICAgICAg\nICAgICAgcmVtb3ZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVtb3ZlKQogICAg\nICAgICAgICAgICAgLy8gcmVtb3ZlIGRpcmVjdGx5IGluc3RlYWQgb2Ygdmlh\nIHRoZSBSZW1vdGVDb21taXRMaXN0ZW5lcgogICAgICAgICAgICAgICAgLy8g\nc2luY2Ugd2UgaGF2ZSBhIHdyaXRlIGxvY2sgaGVyZSBhbHJlYWR5LCBzbyB0\naGlzIGlzIG1vcmUKICAgICAgICAgICAgICAgIC8vIGVmZmljaWVudCB0aGFu\nIHJlYWQtbG9ja2luZyBhbmQgdGhlbiB3cml0ZS1sb2NraW5nIGxhdGVyLgog\nICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlKHNtLmdldElkKCkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2Nr\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBmaXJlIG9mZiBhIHJlbW90ZSBj\nb21taXQgc3RhbGVuZXNzcyBkZXRlY3Rpb24gZXZlbnQuCiAgICAgICAgX2N0\neC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0UmVtb3RlQ29tbWl0RXZlbnRNYW5h\nZ2VyKCkKICAgICAgICAgICAgLmZpcmVMb2NhbFN0YWxlTm90aWZpY2F0aW9u\nKG9pZCk7CiAgICB9CgogICAgcHVibGljIFN0b3JlUXVlcnkgbmV3UXVlcnko\nU3RyaW5nIGxhbmd1YWdlKSB7CiAgICAgICAgU3RvcmVRdWVyeSBxID0gc3Vw\nZXIubmV3UXVlcnkobGFuZ3VhZ2UpOwoKICAgICAgICAvLyBpZiB0aGUgcXVl\ncnkgY2FuJ3QgYmUgcGFyc2VkIG9yIGl0J3MgdXNpbmcgYSBub24tcGFyc2Vk\nIGxhbmd1YWdlCiAgICAgICAgLy8gKG9uZSBmb3Igd2hpY2ggdGhlcmUgaXMg\nbm8gRXhwcmVzc2lvblBhcnNlciksIHdlIGNhbid0IGNhY2hlIGl0LgogICAg\nICAgIGlmIChxID09IG51bGwgfHwgUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9y\nTGFuZ3VhZ2UobGFuZ3VhZ2UpID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBxOwoKICAgICAgICBRdWVyeUNhY2hlIHF1ZXJ5Q2FjaGUgPSBfY3R4Lmdl\ndENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0RGF0YUNhY2hlTWFu\nYWdlckluc3RhbmNlKCkuZ2V0U3lzdGVtUXVlcnlDYWNoZSgpOwogICAgICAg\nIGlmIChxdWVyeUNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBx\nOwoKICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KHEs\nIHF1ZXJ5Q2FjaGUpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IGNhY2hlYWJsZSBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIHN0YXRlIG1h\nbmFnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgRGF0YUNhY2hlUENEYXRhIG5l\nd1BDRGF0YShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBp\nZiAoX2dlbiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKERhdGFDYWNo\nZVBDRGF0YSkgX2dlbi5nZW5lcmF0ZVBDRGF0YShzbS5nZXRPYmplY3RJZCgp\nLCBtZXRhKTsKICAgICAgICByZXR1cm4gbmV3IERhdGFDYWNoZVBDRGF0YUlt\ncGwoc20uZmV0Y2hPYmplY3RJZCgpLCBtZXRhLCBfbWdyLnNlbGVjdENhY2hl\nKHNtKS5nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQWZmaXJt\ncyBpZiBhIGxvYWQgb3BlcmF0aW9uIG11c3QgYnlwYXNzIHRoZSBMMiBjYWNo\nZS4KICAgICAqIElmIGxvY2sgaXMgYWN0aXZlLCBhbHdheXMgYnlwYXNzLgog\nICAgICogCiAgICAgKi8KICAgIGJvb2xlYW4gYnlwYXNzKEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgaW50IGxvYWQpIHsKICAgICAgICAvLyBPcmRlciBv\nZiBjaGVja3MgYXJlIGltcG9ydGFudAogICAgICAgIGlmIChpc0xvY2tpbmco\nZmV0Y2gpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nX2N0eC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0UmVmcmVzaEZyb21EYXRhQ2Fj\naGUoKSkgCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAo\nZmV0Y2guZ2V0Q2FjaGVSZXRyaWV2ZU1vZGUoKSA9PSBEYXRhQ2FjaGVSZXRy\naWV2ZU1vZGUuQllQQVNTKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICBpZiAobG9hZCA9PSBTdG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9SRUZS\nRVNIKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0\naGUgY29udGV4dCBpcyBsb2NraW5nIGxvYWRlZCBkYXRhLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNMb2NraW5nKEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAg\nICAgICBmZXRjaCA9IF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgcmV0dXJuIGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSA+IExvY2tM\nZXZlbHMuTE9DS19OT05FOwogICAgfSAgCiAgICAKICAgIC8qKgogICAgICog\nU3RydWN0dXJlIHVzZWQgZHVyaW5nIHRoZSBjb21taXQgcHJvY2VzcyB0byB0\ncmFjayBjYWNoZSBtb2RpZmljYXRpb25zLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBNb2RpZmljYXRpb25zIHsKCiAgICAgICAgcHVibGlj\nIGZpbmFsIExpc3Q8UENEYXRhSG9sZGVyPiBhZGRpdGlvbnMgPSBuZXcgQXJy\nYXlMaXN0PFBDRGF0YUhvbGRlcj4oKTsKICAgICAgICBwdWJsaWMgZmluYWwg\nTGlzdDxQQ0RhdGFIb2xkZXI+IG5ld1VwZGF0ZXMgPSBuZXcgQXJyYXlMaXN0\nPFBDRGF0YUhvbGRlcj4oKTsKICAgICAgICBwdWJsaWMgZmluYWwgTGlzdDxQ\nQ0RhdGFIb2xkZXI+IGV4aXN0aW5nVXBkYXRlcyA9IG5ldyBBcnJheUxpc3Q8\nUENEYXRhSG9sZGVyPigpOwogICAgICAgIHB1YmxpYyBmaW5hbCBMaXN0PE9i\namVjdD4gZGVsZXRlcyA9IG5ldyBBcnJheUxpc3Q8T2JqZWN0PigpOwogICAg\nfQoKICAgIC8qKgogICAgICogVXRpbGl0eSBzdHJ1Y3R1cmUgaG9sZHMgdGhl\nIHR1cGxlIG9mIGNhY2hlYWJsZSBpbnN0YW5jZSBhbmQgaXRzIGNvcnJlc3Bv\nbmRpbmcgc3RhdGUgbWFuYWdlci4gCiAgICAgKgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBQQ0RhdGFIb2xkZXIgewoKICAgICAgICBwdWJs\naWMgZmluYWwgRGF0YUNhY2hlUENEYXRhIHBjZGF0YTsKICAgICAgICBwdWJs\naWMgZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbTsKCiAgICAgICAgcHVi\nbGljIFBDRGF0YUhvbGRlcihEYXRhQ2FjaGVQQ0RhdGEgcGNkYXRhLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgICAgIHRoaXMucGNkYXRh\nID0gcGNkYXRhOwogICAgICAgICAgICB0aGlzLnNtID0gc207CgkJfQoJfQp9\nCgo=\n","encoding":"base64"}

