{"sha":"904b6582e98b9bd0df6444e3ee65fc77dd64a365","node_id":"MDQ6QmxvYjIwNjM2NDo5MDRiNjU4MmU5OGI5YmQwZGY2NDQ0ZTNlZTY1ZmM3N2RkNjRhMzY1","size":24242,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/904b6582e98b9bd0df6444e3ee65fc77dd64a365","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5M\naW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkFic3RyYWN0UXVlcnlDYWNoZS5FdmljdFBvbGljeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTGV2ZWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlJlc3Vs\ndFNoYXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9y\nZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4\ncHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLkxpc3RSZXN1bHRPYmpl\nY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9w\nLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9yZGVyZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNlcHRpb247CgppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogQSB7QGxpbmsgU3RvcmVR\ndWVyeX0gaW1wbGVtZW50YXRpb24gdGhhdCBjYWNoZXMgdGhlIE9JRHMgaW52\nb2x2ZWQgaW4KICogdGhlIHF1ZXJ5LCBhbmQgY2FuIGRldGVybWluZSB3aGV0\naGVyIG9yIG5vdCB0aGUgcXVlcnkgaGFzIGJlZW4gZGlydGllZC4KICoKICog\nQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICogQHNpbmNlIDAuMi41LjAKICov\nCnB1YmxpYyBjbGFzcyBRdWVyeUNhY2hlU3RvcmVRdWVyeQogICAgaW1wbGVt\nZW50cyBTdG9yZVF1ZXJ5IHsKCiAgICBwcml2YXRlIGZpbmFsIFN0b3JlUXVl\ncnkgX3F1ZXJ5OwogICAgcHJpdmF0ZSBmaW5hbCBRdWVyeUNhY2hlIF9jYWNo\nZTsKICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9zY3R4OwogICAgcHJpdmF0\nZSBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IGluc3RhbmNlIHRoYXQgZGVsZWdhdGVzIHRvIDxjb2Rl\nPnF1ZXJ5PC9jb2RlPiBpZiBubwogICAgICogY2FjaGVkIHJlc3VsdHMgYXJl\nIGF2YWlsYWJsZS4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5Q2FjaGVTdG9y\nZVF1ZXJ5KFN0b3JlUXVlcnkgcXVlcnksIFF1ZXJ5Q2FjaGUgY2FjaGUpIHsK\nICAgICAgICBfcXVlcnkgPSBxdWVyeTsKICAgICAgICBfY2FjaGUgPSBjYWNo\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUge0BsaW5rIFF1\nZXJ5Q2FjaGV9IHRoYXQgdGhpcyBvYmplY3QgaXMgYXNzb2NpYXRlZCB3aXRo\nLgogICAgICovCiAgICBwdWJsaWMgUXVlcnlDYWNoZSBnZXRDYWNoZSgpIHsK\nICAgICAgICByZXR1cm4gX2NhY2hlOwogICAgfQoKICAgIC8qKgogICAgICog\nRGVsZWdhdGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IGdldERl\nbGVnYXRlKCkgewogICAgICAgIHJldHVybiBfcXVlcnk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBMb29rIGluIHRoZSBxdWVyeSBjYWNoZSBmb3IgYSByZXN1\nbHQgZm9yIHRoZSBnaXZlbiBxdWVyeQogICAgICoga2V5LiBPbmx5IGxvb2sg\naWYgdGhpcyBxdWVyeSBpcyBiZWluZyBleGVjdXRlZCBvdXRzaWRlIGEKICAg\nICAqIHRyYW5zYWN0aW9uIG9yIGluIGEgdHJhbnNhY3Rpb24gd2l0aCBJZ25v\ncmVDaGFuZ2VzIHNldCB0byB0cnVlCiAgICAgKiBvciBpbiBhIHRyYW5zYWN0\naW9uIHdpdGggSWdub3JlQ2hhbmdlcyBzZXQgdG8gZmFsc2UgYnV0IGluIHdo\naWNoCiAgICAgKiBub25lIG9mIHRoZSBjbGFzc2VzIGludm9sdmVkIGluIHRo\naXMgcXVlcnkgaGF2ZSBiZWVuIHRvdWNoZWQuCiAgICAgKiAgQ2FjaGluZyBp\ncyBub3QgdXNlZCB3aGVuIHVzaW5nIG9iamVjdCBsb2NraW5nLgogICAgICog\nVGhpcyBpcyBiZWNhdXNlIHdlIG11c3Qgb2J0YWluIGxvY2tzIG9uIHRoZQog\nICAgICogZGF0YSwgYW5kIGl0IGlzIGxpa2VseSB0aGF0IG1ha2luZyBuIHRy\naXBzIHRvIHRoZSBkYXRhYmFzZSB0bwogICAgICogbWFrZSB0aGUgbG9ja3Mg\nd2lsbCBiZSBzbG93ZXIgdGhhbiBydW5uaW5nIHRoZSBxdWVyeSBhZ2FpbnN0\nCiAgICAgKiB0aGUgZGF0YWJhc2UuCiAgICAgKiAgSWYgdGhlIGZldGNoIGNv\nbmZpZ3VyYXRpb24gaGFzIHF1ZXJ5IGNhY2hpbmcgZGlzYWJsZWQsCiAgICAg\nKiB0aGVuIHRoaXMgbWV0aG9kIHJldHVybnMgPGNvZGU+bnVsbDwvY29kZT4u\nCiAgICAgKiAgUmV0dXJuIHRoZSBsaXN0IGlmIHdlIG1lZXQgdGhlIGFib3Zl\nIGNyaXRlcmlhIGFuZCBpZiBhIGxpc3QKICAgICAqIGlzIGZvdW5kIGZvciA8\nY29kZT5xazwvY29kZT4uIEVsc2UsIHJldHVybgogICAgICogPGNvZGU+bnVs\nbDwvY29kZT4uCiAgICAgKiAgVGhpcyBpbXBsZW1lbnRhdGlvbiBtZWFucyB0\naGF0IHF1ZXJpZXMgYWdhaW5zdCB0aGUgY2FjaGUKICAgICAqIGFyZSBvZiBS\nRUFEX0NPTU1JVFRFRCBpc29sYXRpb24gbGV2ZWwuIEl0J2QgYmUgbmljZSB0\nbyBzdXBwb3J0CiAgICAgKiBSRUFEX1NFUklBTElaQUJMRSAtLSB0byBkbyBz\nbywgd2UnZCBqdXN0IHJldHVybiBmYWxzZSB3aGVuIGluCiAgICAgKiBhIHRy\nYW5zYWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIExpc3Q8T2JqZWN0PiBj\naGVja0NhY2hlKFF1ZXJ5S2V5IHFrKSB7CiAgICAgICAgaWYgKHFrID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCA9IGdldENvbnRleHQoKS5nZXRGZXRjaENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICBpZiAoIWZldGNoLmdldFF1ZXJ5Q2FjaGVF\nbmFibGVkKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkgPiBMb2NrTGV2ZWxzLkxPQ0tf\nTk9ORSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGdl\ndCB0aGUgY2FjaGVkIGRhdGEKICAgICAgICBRdWVyeVJlc3VsdCByZXMgPSBf\nY2FjaGUuZ2V0KHFrKTsKICAgICAgICBpZiAocmVzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOyAgICAgICAgCiAgICAgICAgaWYgKHJlcy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKCiAgICAgICAgLy8gdGhpcyBpZiBibG9jayBpcyBpbnZva2Vk\nIGlmIHRoZSBldmljdE9uVGltZXN0YW1wIGlzIHNldCB0byB0cnVlCiAgICAg\nICAgaWYgKF9jYWNoZSBpbnN0YW5jZW9mIEFic3RyYWN0UXVlcnlDYWNoZSkg\newogICAgICAgICAgICBBYnN0cmFjdFF1ZXJ5Q2FjaGUgcWNhY2hlID0gKEFi\nc3RyYWN0UXVlcnlDYWNoZSkgX2NhY2hlOwogICAgICAgICAgICBpZiAocWNh\nY2hlLmdldEV2aWN0UG9saWN5KCkgPT0gRXZpY3RQb2xpY3kuVElNRVNUQU1Q\nKSB7CiAgICAgICAgICAgICAgICBTZXQ8U3RyaW5nPiBjbGFzc05hbWVzID0g\ncWsuZ2V0QWNlc3NQYXRoQ2xhc3NOYW1lcygpOwogICAgICAgICAgICAgICAg\nTGlzdDxTdHJpbmc+IGtleUxpc3QgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4o\nKTsgICAgICAKICAgICAgICAgICAgICAgIGtleUxpc3QuYWRkQWxsKGNsYXNz\nTmFtZXMpOwoKICAgICAgICAgICAgICAgIExpc3Q8TG9uZz4gdGltZXN0YW1w\ncyA9IAogICAgICAgICAgICAgICAgICAgIHFjYWNoZS5nZXRBbGxFbnRpdHlU\naW1lc3RhbXAoa2V5TGlzdCk7CiAgICAgICAgICAgICAgICBsb25nIHF1ZXJ5\nVFMgPSByZXMuZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgICAgICAgICBpZiAo\ndGltZXN0YW1wcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZm9y\nIChMb25nIHRzOiB0aW1lc3RhbXBzKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoaXMgaXMgdHJ1ZSB3ZSBoYXZlIHRvIGV2aWN0IHRoZSBx\ndWVyeSAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZnJvbSBjYWNoZQog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlUUyA8IHRzKSB7IAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcWNhY2hlLnJlbW92ZShxayk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaW50IHByb2pzID0gZ2V0Q29udGV4dCgpLmdldFByb2plY3Rpb25B\nbGlhc2VzKCkubGVuZ3RoOwogICAgICAgIGlmIChwcm9qcyA9PSAwKSB7CiAg\nICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZGF0YSBjYWNoZSBjb250YWlu\ncyB0aGUgb2lkcyBmb3IgdGhlIHF1ZXJ5IHJlc3VsdDsKICAgICAgICAgICAg\nLy8gaWYgaXQgZG9lc24ndCwgdGhlbiB1c2luZyB0aGUgcmVzdWx0IGNvdWxk\nIGJlIHNsb3dlciB0aGFuIG5vdAogICAgICAgICAgICAvLyB1c2luZyBpdCBi\nZWNhdXNlIG9mIHRoZSBpbmRpdmlkdWFsIGJ5LW9pZCBsb29rdXBzCiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0\nYShnZXRDb250ZXh0KCkuCiAgICAgICAgICAgICAgICBnZXRDYW5kaWRhdGVU\neXBlKCksIF9zY3R4LmdldENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAg\nICAgICBpZiAobWV0YS5nZXREYXRhQ2FjaGUoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBCaXRTZXQgaWR4\ncyA9IG1ldGEuZ2V0RGF0YUNhY2hlKCkuY29udGFpbnNBbGwocmVzKTsKCiAg\nICAgICAgICAgIC8vIGV2ZW50dWFsbHkgd2Ugc2hvdWxkIG9wdGltaXplIHRo\naXMgdG8gZmlndXJlIG91dCBob3cgbWFueSBvYmplY3RzCiAgICAgICAgICAg\nIC8vIHRoZSBjYWNoZSBpcyBtaXNzaW5nIGFuZCBpZiBvbmx5IGEgZmV3IGRv\nIGEgYnVsayBmZXRjaCBmb3IgdGhlbQogICAgICAgICAgICBpbnQgbGVuID0g\naWR4cy5sZW5ndGgoKTsKICAgICAgICAgICAgaWYgKGxlbiA8IHJlcy5zaXpl\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAg\nIGlmICghaWR4cy5nZXQoaSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgQ2FjaGVkTGlz\ndChyZXMsIHByb2pzICE9IDAsIF9zY3R4KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdyYXAgdGhlIHJlc3VsdCBvYmplY3QgcHJvdmlkZXIgcmV0dXJuZWQg\nYnkgb3VyIGRlbGVnYXRlIGluIGEKICAgICAqIGNhY2hpbmcgcHJvdmlkZXIu\nCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0T2JqZWN0UHJvdmlkZXIgd3Jh\ncFJlc3VsdChSZXN1bHRPYmplY3RQcm92aWRlciByb3AsCiAgICAgICAgUXVl\ncnlLZXkga2V5KSB7CiAgICAgICAgaWYgKGtleSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gcm9wOwogICAgICAgIHJldHVybiBuZXcgQ2FjaGluZ1Jl\nc3VsdE9iamVjdFByb3ZpZGVyKHJvcCwgZ2V0Q29udGV4dCgpLgogICAgICAg\nICAgICBnZXRQcm9qZWN0aW9uQWxpYXNlcygpLmxlbmd0aCA+IDAsIGtleSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb3B5IGEgcHJvamVjdGlvbiBlbGVt\nZW50IGZvciBjYWNoaW5nIC8gcmV0dXJuaW5nLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBPYmplY3QgY29weVByb2plY3Rpb24oT2JqZWN0IG9iaiwg\nU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc3dpdGNoIChKYXZh\nVHlwZXMuZ2V0VHlwZUNvZGUob2JqLmdldENsYXNzKCkpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTl9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEVfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFS\nX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU0hPUlRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdE\nRUNJTUFMOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VS\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gb2JqOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuICgoRGF0ZSkgb2JqKS5jbG9u\nZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gKChMb2NhbGUpIG9iaikuY2xvbmUoKTsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChvYmogaW5z\ndGFuY2VvZiBDYWNoZWRPYmplY3RJZCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZnJvbU9iamVjdElkKCgoQ2FjaGVkT2JqZWN0SWQpIG9iaikub2lk\nLCBjdHgpOwogICAgICAgICAgICAgICAgT2JqZWN0IG9pZCA9IGN0eC5nZXRP\nYmplY3RJZChvYmopOwogICAgICAgICAgICAgICAgaWYgKG9pZCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2FjaGVkT2JqZWN0\nSWQob2lkKTsKICAgICAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZXN1bHQgb2Jq\nZWN0IGJhc2VkIG9uIGl0cyBjYWNoZWQgb2lkLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBPYmplY3QgZnJvbU9iamVjdElkKE9iamVjdCBvaWQsIFN0\nb3JlQ29udGV4dCBzY3R4KSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgT2JqZWN0IG9iaiA9\nIHNjdHguZmluZChvaWQsIG51bGwsIG51bGwsIG51bGwsIDApOwogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVj\ndE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7CiAgICAgICAgcmV0dXJuIG9iajsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAg\nICAgdGhyb3dzIE9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIF9xdWVyeTsKICAgIH0KCiAgICBwdWJsaWMgUXVlcnlDb250ZXh0IGdl\ndENvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXRDb250ZXh0\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChRdWVyeUNv\nbnRleHQgcWN0eCkgewogICAgICAgIF9xdWVyeS5zZXRDb250ZXh0KHFjdHgp\nOwogICAgICAgIF9zY3R4ID0gcWN0eC5nZXRTdG9yZUNvbnRleHQoKTsKICAg\nICAgICBfcmVwb3MgPSBfc2N0eC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TWV0\nYURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzZXRRdWVyeShPYmplY3QgcXVlcnkpIHsKICAgICAgICByZXR1\ncm4gX3F1ZXJ5LnNldFF1ZXJ5KHF1ZXJ5KTsKICAgIH0KCiAgICBwdWJsaWMg\nRmlsdGVyTGlzdGVuZXIgZ2V0RmlsdGVyTGlzdGVuZXIoU3RyaW5nIHRhZykg\newogICAgICAgIHJldHVybiBfcXVlcnkuZ2V0RmlsdGVyTGlzdGVuZXIodGFn\nKTsKICAgIH0KCiAgICBwdWJsaWMgQWdncmVnYXRlTGlzdGVuZXIgZ2V0QWdn\ncmVnYXRlTGlzdGVuZXIoU3RyaW5nIHRhZykgewogICAgICAgIHJldHVybiBf\ncXVlcnkuZ2V0QWdncmVnYXRlTGlzdGVuZXIodGFnKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IG5ld0NvbXBpbGF0aW9uS2V5KCkgewogICAgICAgIHJl\ndHVybiBfcXVlcnkubmV3Q29tcGlsYXRpb25LZXkoKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IG5ld0NvbXBpbGF0aW9uKCkgewogICAgICAgIHJldHVy\nbiBfcXVlcnkubmV3Q29tcGlsYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBwb3B1bGF0ZUZyb21Db21waWxhdGlvbihPYmplY3QgY29tcCkgewog\nICAgICAgIF9xdWVyeS5wb3B1bGF0ZUZyb21Db21waWxhdGlvbihjb21wKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbnZhbGlkYXRlQ29tcGlsYXRpb24o\nKSB7CiAgICAgICAgX3F1ZXJ5LmludmFsaWRhdGVDb21waWxhdGlvbigpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGF0YVN0b3JlRXhl\nY3V0aW9uKCkgewogICAgICAgIHJldHVybiBfcXVlcnkuc3VwcG9ydHNEYXRh\nU3RvcmVFeGVjdXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkgewogICAgICAgIHJldHVybiBf\ncXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpOwogICAgfQoKICAg\nIHB1YmxpYyBFeGVjdXRvciBuZXdJbk1lbW9yeUV4ZWN1dG9yKENsYXNzTWV0\nYURhdGEgbWV0YSwgYm9vbGVhbiBzdWJzKSB7CiAgICAgICAgcmV0dXJuIF9x\ndWVyeS5uZXdJbk1lbW9yeUV4ZWN1dG9yKG1ldGEsIHN1YnMpOwogICAgfQoK\nICAgIHB1YmxpYyBFeGVjdXRvciBuZXdEYXRhU3RvcmVFeGVjdXRvcihDbGFz\nc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gc3VicykgewogICAgICAgIEV4ZWN1\ndG9yIGV4ID0gX3F1ZXJ5Lm5ld0RhdGFTdG9yZUV4ZWN1dG9yKG1ldGEsIHN1\nYnMpOwogICAgICAgIHJldHVybiBuZXcgUXVlcnlDYWNoZUV4ZWN1dG9yKGV4\nLCBtZXRhLCBzdWJzLAogICAgICAgICAgICAgICAgICAgICAgZ2V0Q29udGV4\ndCgpLmdldEZldGNoQ29uZmlndXJhdGlvbigpKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0Fic3RyYWN0RXhlY3V0b3JzKCkgewogICAg\nICAgIHJldHVybiBfcXVlcnkuc3VwcG9ydHNBYnN0cmFjdEV4ZWN1dG9ycygp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ2FuZGlkYXRl\nVHlwZSgpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnJlcXVpcmVzQ2FuZGlk\nYXRlVHlwZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVz\nUGFyYW1ldGVyRGVjbGFyYXRpb25zKCkgewogICAgICAgIHJldHVybiBfcXVl\ncnkucmVxdWlyZXNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9u\ncygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzUGFyYW1ldGVy\nRGVjbGFyYXRpb25zKCk7CiAgICB9CiAKICAgIHB1YmxpYyBPYmplY3QgZXZh\nbHVhdGUoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFt\ncywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAg\ncmV0dXJuIF9xdWVyeS5ldmFsdWF0ZSh2YWx1ZSwgb2IsIHBhcmFtcywgc20p\nOyAgICAgICAgIAogICAgfQoKICAgIC8qKgogICAgICogQ2FjaGluZyBleGVj\ndXRvci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUXVlcnlD\nYWNoZUV4ZWN1dG9yCiAgICAgICAgaW1wbGVtZW50cyBFeGVjdXRvciB7Cgog\nICAgICAgIHByaXZhdGUgZmluYWwgRXhlY3V0b3IgX2V4OwogICAgICAgIHBy\naXZhdGUgZmluYWwgQ2xhc3M8Pz4gX2NhbmRpZGF0ZTsKICAgICAgICBwcml2\nYXRlIGZpbmFsIGJvb2xlYW4gX3N1YnM7CiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBGZXRjaENvbmZpZ3VyYXRpb24gX2ZjOwoKICAgICAgICBwdWJsaWMgUXVl\ncnlDYWNoZUV4ZWN1dG9yKEV4ZWN1dG9yIGV4LCBDbGFzc01ldGFEYXRhIG1l\ndGEsCiAgICAgICAgICAgIGJvb2xlYW4gc3VicywgRmV0Y2hDb25maWd1cmF0\naW9uIGZjKSB7CiAgICAgICAgICAgIF9leCA9IGV4OwogICAgICAgICAgICBf\nY2FuZGlkYXRlID0gKG1ldGEgPT0gbnVsbCkgPyBudWxsIDogbWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCk7CiAgICAgICAgICAgIF9zdWJzID0gc3ViczsKICAg\nICAgICAgICAgX2ZjID0gZmM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZVF1ZXJ5KFN0b3JlUXVlcnkg\ncSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBSYW5nZSByYW5nZSkg\newogICAgICAgICAgICBRdWVyeUNhY2hlU3RvcmVRdWVyeSBjcSA9IChRdWVy\neUNhY2hlU3RvcmVRdWVyeSkgcTsKICAgICAgICAgICAgUXVlcnlLZXkga2V5\nID0gUXVlcnlLZXkubmV3SW5zdGFuY2UoY3EuZ2V0Q29udGV4dCgpLAogICAg\nICAgICAgICAgICAgX2V4LmlzUGFja2luZyhxKSwgcGFyYW1zLCBfY2FuZGlk\nYXRlLCBfc3VicywgcmFuZ2Uuc3RhcnQsIAogICAgICAgICAgICAgICAgcmFu\nZ2UuZW5kKTsKICAgICAgICAgICAgTGlzdDxPYmplY3Q+IGNhY2hlZCA9IGNx\nLmNoZWNrQ2FjaGUoa2V5KTsKICAgICAgICAgICAgaWYgKGNhY2hlZCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0UmVzdWx0T2Jq\nZWN0UHJvdmlkZXIoY2FjaGVkKTsKCiAgICAgICAgICAgIFJlc3VsdE9iamVj\ndFByb3ZpZGVyIHJvcCA9IF9leC5leGVjdXRlUXVlcnkoY3EuZ2V0RGVsZWdh\ndGUoKSwKICAgICAgICAgICAgICAgIHBhcmFtcywgcmFuZ2UpOwogICAgICAg\nICAgICBpZiAoX2ZjLmdldFF1ZXJ5Q2FjaGVFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gY3Eud3JhcFJlc3VsdChyb3AsIGtleSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiByb3A7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBRdWVyeUV4cHJlc3Npb25z\nW10gZ2V0UXVlcnlFeHByZXNzaW9ucygpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leC5nZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBDbGVhciB0aGUgY2FjaGVkIHF1ZXJpZXMgYXNz\nb2NpYXRlZCB3aXRoIHRoZSBhY2Nlc3MgcGF0aAogICAgICAgICAqIGNsYXNz\nZXMgaW4gdGhlIHF1ZXJ5LiBUaGlzIGlzIGRvbmUgd2hlbiBidWxrIG9wZXJh\ndGlvbnMKICAgICAgICAgKiAoc3VjaCBhcyBkZWxldGVzIG9yIHVwZGF0ZXMp\nIGFyZSBwZXJmb3JtZWQgc28gdGhhdCB0aGUKICAgICAgICAgKiBjYWNoZSBy\nZW1haW5zIHVwLXRvLWRhdGUuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSB2b2lkIGNsZWFyQWNjZXNzUGF0aChTdG9yZVF1ZXJ5IHEpIHsKICAgICAg\nICAgICAgaWYgKHEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGFbXSBjbWQgPSBnZXRBY2Nlc3NQ\nYXRoTWV0YURhdGFzKHEpOwogICAgICAgICAgICBpZiAoY21kID09IG51bGwg\nfHwgY21kLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgTGlzdDxDbGFzczw/Pj4gY2xhc3NlcyA9IG5ldyBBcnJh\neUxpc3Q8Q2xhc3M8Pz4+KGNtZC5sZW5ndGgpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGNtZC5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgIGNsYXNzZXMuYWRkKGNtZFtpXS5nZXREZXNjcmliZWRUeXBlKCkpOwoK\nICAgICAgICAgICAgLy8gZXZpY3QgZnJvbSB0aGUgcXVlcnkgY2FjaGUKICAg\nICAgICAgICAgUXVlcnlDYWNoZVN0b3JlUXVlcnkgY3EgPSAoUXVlcnlDYWNo\nZVN0b3JlUXVlcnkpIHE7CiAgICAgICAgICAgIGNxLmdldENhY2hlKCkub25U\neXBlc0NoYW5nZWQobmV3IFR5cGVzQ2hhbmdlZEV2ZW50CiAgICAgICAgICAg\nICAgICAocS5nZXRDb250ZXh0KCksIGNsYXNzZXMpKTsKCiAgICAgICAgICAg\nIC8vIGV2aWN0IGZyb20gdGhlIGRhdGEgY2FjaGUKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBjbWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChjbWRbaV0uZ2V0RGF0YUNhY2hlKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBjbWRbaV0uZ2V0RGF0YUNhY2hlKCkucmVtb3Zl\nQWxsKAogICAgICAgICAgICAgICAgICAgICAgICBjbWRbaV0uZ2V0RGVzY3Jp\nYmVkVHlwZSgpLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE51bWJlciBleGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkg\ncSwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gX2V4LmV4ZWN1dGVEZWxldGUodW53cmFwKHEp\nLCBwYXJhbXMpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgY2xlYXJBY2Nlc3NQYXRoKHEpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgTnVtYmVyIGV4ZWN1dGVVcGRhdGUoU3Rv\ncmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBfZXguZXhlY3V0ZVVwZGF0ZSh1\nbndyYXAocSksIHBhcmFtcyk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICBjbGVhckFjY2Vzc1BhdGgocSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREYXRh\nU3RvcmVBY3Rpb25zKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAog\nICAgICAgICAgICBSYW5nZSByYW5nZSkgewogICAgICAgICAgICByZXR1cm4g\nRU1QVFlfU1RSSU5HUzsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHZhbGlkYXRlKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBfZXgudmFs\naWRhdGUodW53cmFwKHEpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\ncHVibGljIHZvaWQgZ2V0UmFuZ2UoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBw\nYXJhbXMsIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIF9leC5nZXRSYW5n\nZShxLCBwYXJhbXMsIHJhbmdlKTsgCiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgT2JqZWN0IGdldE9yZGVyaW5nVmFsdWUoU3RvcmVRdWVyeSBxLCBPYmpl\nY3RbXSBwYXJhbXMsCiAgICAgICAgICAgIE9iamVjdCByZXN1bHRPYmplY3Qs\nIGludCBvcmRlckluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0\nT3JkZXJpbmdWYWx1ZSh1bndyYXAocSksIHBhcmFtcywgcmVzdWx0T2JqZWN0\nLAogICAgICAgICAgICAgICAgb3JkZXJJbmRleCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbltdIGdldEFzY2VuZGluZyhTdG9yZVF1ZXJ5\nIHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5nZXRBc2NlbmRpbmcodW53\ncmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nUGFja2luZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9l\neC5pc1BhY2tpbmcodW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0QWxpYXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiBfZXguZ2V0QWxpYXModW53cmFwKHEpKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBDbGFzczw/PiBnZXRSZXN1bHRDbGFzcyhTdG9y\nZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5nZXRSZXN1bHRD\nbGFzcyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJl\nc3VsdFNoYXBlPD8+IGdldFJlc3VsdFNoYXBlKFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICByZXR1cm4gX2V4LmdldFJlc3VsdFNoYXBlKHEpOwogICAg\nICAgIH0KICAgICAgICAKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0UHJv\namVjdGlvbkFsaWFzZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfZXguZ2V0UHJvamVjdGlvbkFsaWFzZXModW53cmFwKHEpKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBDbGFzczw/PltdIGdldFByb2plY3Rp\nb25UeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9l\neC5nZXRQcm9qZWN0aW9uVHlwZXModW53cmFwKHEpKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0QWNjZXNzUGF0aE1l\ndGFEYXRhcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9l\neC5nZXRBY2Nlc3NQYXRoTWV0YURhdGFzKHVud3JhcChxKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgaW50IGdldE9wZXJhdGlvbihTdG9yZVF1ZXJ5\nIHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5nZXRPcGVyYXRpb24odW53\ncmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nQWdncmVnYXRlKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4g\nX2V4LmlzQWdncmVnYXRlKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc0Rpc3RpbmN0KFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICByZXR1cm4gX2V4LmlzRGlzdGluY3QodW53cmFwKHEpKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc0dyb3VwaW5n\nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4Lmhhc0dy\nb3VwaW5nKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nT3JkZXJlZE1hcDxPYmplY3QsIENsYXNzPD8+PiBnZXRPcmRlcmVkUGFyYW1l\ndGVyVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0T3JkZXJlZFBhcmFtZXRlclR5cGVzKHVud3JhcChxKSk7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBMaW5rZWRNYXAgZ2V0UGFy\nYW1ldGVyVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfZXguZ2V0UGFyYW1ldGVyVHlwZXModW53cmFwKHEpKTsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRvUGFyYW1ldGVy\nQXJyYXkoU3RvcmVRdWVyeSBxLCBNYXAgdXNlclBhcmFtcykgewogICAgICAg\nICAgICByZXR1cm4gX2V4LnRvUGFyYW1ldGVyQXJyYXkocSwgdXNlclBhcmFt\ncyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTWFwIGdldFVwZGF0ZXMo\nU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0VXBk\nYXRlcyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBz\ndGF0aWMgU3RvcmVRdWVyeSB1bndyYXAoU3RvcmVRdWVyeSBxKSB7CiAgICAg\nICAgICAgIHJldHVybiAoKFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KSBxKS5nZXRE\nZWxlZ2F0ZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\nc3VsdCBsaXN0IGltcGxlbWVudGF0aW9uIGZvciBhIGNhY2hlZCBxdWVyeSBy\nZXN1bHQuIFBhY2thZ2UtcHJvdGVjdGVkCiAgICAgKiBmb3IgdGVzdGluZy4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBDYWNoZWRMaXN0IGV4\ndGVuZHMgQWJzdHJhY3RMaXN0PE9iamVjdD4KICAgICAgICBpbXBsZW1lbnRz\nIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlS\nZXN1bHQgX3JlczsKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX3By\nb2o7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdG9yZUNvbnRleHQgX3NjdHg7\nCgogICAgICAgIHB1YmxpYyBDYWNoZWRMaXN0KFF1ZXJ5UmVzdWx0IHJlcywg\nYm9vbGVhbiBwcm9qLCBTdG9yZUNvbnRleHQgY3R4KSB7CiAgICAgICAgICAg\nIF9yZXMgPSByZXM7CiAgICAgICAgICAgIF9wcm9qID0gcHJvajsKICAgICAg\nICAgICAgX3NjdHggPSBjdHg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nT2JqZWN0IGdldChpbnQgaWR4KSB7CiAgICAgICAgICAgIGlmICghX3Byb2op\nCiAgICAgICAgICAgICAgICByZXR1cm4gZnJvbU9iamVjdElkKF9yZXMuZ2V0\nKGlkeCksIF9zY3R4KTsKCiAgICAgICAgICAgIE9iamVjdFtdIGNhY2hlZCA9\nIChPYmplY3RbXSkgX3Jlcy5nZXQoaWR4KTsKICAgICAgICAgICAgaWYgKGNh\nY2hlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgICAgIE9iamVjdFtdIHVuY2FjaGVkID0gbmV3IE9iamVjdFtjYWNo\nZWQubGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nYWNoZWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICB1bmNhY2hlZFtp\nXSA9IGNvcHlQcm9qZWN0aW9uKGNhY2hlZFtpXSwgX3NjdHgpOwogICAgICAg\nICAgICByZXR1cm4gdW5jYWNoZWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnNpemUo\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qgd3JpdGVSZXBs\nYWNlKCkKICAgICAgICAgICAgdGhyb3dzIE9iamVjdFN0cmVhbUV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXlMaXN0PE9iamVjdD4o\ndGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQSB3cmFw\ncGVyIGFyb3VuZCBhIHtAbGluayBSZXN1bHRPYmplY3RQcm92aWRlcn0gdGhh\ndCBidWlsZHMgdXAgYSBsaXN0IG9mCiAgICAgKiBhbGwgdGhlIE9JRHMgaW4g\ndGhpcyBsaXN0IGFuZCByZWdpc3RlcnMgdGhhdCBsaXN0IHdpdGggdGhlCiAg\nICAgKiBxdWVyeSBjYWNoZS4gQWJhbmRvbnMgbW9uaXRvcmluZyBhbmQgcmVn\naXN0ZXJpbmcgaWYgb25lIG9mIHRoZSBjbGFzc2VzCiAgICAgKiBpbiB0aGUg\nYWNjZXNzIHBhdGggaXMgbW9kaWZpZWQgd2hpbGUgdGhlIHF1ZXJ5IHJlc3Vs\ndHMgYXJlIGJlaW5nIGxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFz\ncyBDYWNoaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIKICAgICAgICBpbXBsZW1l\nbnRzIFJlc3VsdE9iamVjdFByb3ZpZGVyLCBUeXBlc0NoYW5nZWRMaXN0ZW5l\nciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0T2JqZWN0UHJvdmlk\nZXIgX3JvcDsKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX3Byb2o7\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBRdWVyeUtleSBfcWs7CiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBUcmVlTWFwPEludGVnZXIsT2JqZWN0PiBfZGF0YSA9\nIG5ldyBUcmVlTWFwPEludGVnZXIsT2JqZWN0PigpOwogICAgICAgIHByaXZh\ndGUgYm9vbGVhbiBfbWFpbnRhaW5DYWNoZSA9IHRydWU7CiAgICAgICAgcHJp\ndmF0ZSBpbnQgX3BvcyA9IC0xOwoKICAgICAgICAvLyB1c2VkIHRvIGRldGVy\nbWluZSBsaXN0IHNpemUgd2l0aG91dCBuZWNlc3NhcmlseSBjYWxsaW5nIHNp\nemUoKSwKICAgICAgICAvLyB3aGljaCBtYXkgcmVxdWlyZSBhIERCIHRyaXAg\nb3IgcmV0dXJuIEludGVnZXIuTUFYX1ZBTFVFCiAgICAgICAgcHJpdmF0ZSBp\nbnQgX21heCA9IC0xOwogICAgICAgIHByaXZhdGUgaW50IF9zaXplID0gSW50\nZWdlci5NQVhfVkFMVUU7CgogICAgICAgIC8qKgogICAgICAgICAqIENvbnN0\ncnVjdG9yLiBTdXBwbHkgZGVsZWdhdGUgcmVzdWx0IHByb3ZpZGVyIGFuZCBv\ndXIgcXVlcnkga2V5LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDYWNo\naW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoUmVzdWx0T2JqZWN0UHJvdmlkZXIg\ncm9wLAogICAgICAgICAgICBib29sZWFuIHByb2osIFF1ZXJ5S2V5IGtleSkg\newogICAgICAgICAgICBfcm9wID0gcm9wOwogICAgICAgICAgICBfcHJvaiA9\nIHByb2o7CiAgICAgICAgICAgIF9xayA9IGtleTsKICAgICAgICAgICAgX2Nh\nY2hlLmFkZFR5cGVzQ2hhbmdlZExpc3RlbmVyKHRoaXMpOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogU3RvcCBjYWNoaW5nLgogICAgICAg\nICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBhYm9ydENhY2hpbmcoKSB7CiAg\nICAgICAgICAgIGlmICghX21haW50YWluQ2FjaGUpCiAgICAgICAgICAgICAg\nICByZXR1cm47CgogICAgICAgICAgICAvLyB0aGlzIGNhbiBiZSBjYWxsZWQg\ndmlhIGFuIGV2ZW50IGZyb20gYW5vdGhlciB0aHJlYWQKICAgICAgICAgICAg\nc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICAvLyBpdCdz\nIGltcG9ydGFudCB0aGF0IHdlIHNldCB0aGlzIGZsYWcgZmlyc3Qgc28gdGhh\ndCBhbnkKICAgICAgICAgICAgICAgIC8vIHN1YnNlcXVlbnQgY2FsbHMgdG8g\ndGhpcyBvYmplY3QgYXJlIGJ5cGFzc2VkLgogICAgICAgICAgICAgICAgX21h\naW50YWluQ2FjaGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9jYWNoZS5y\nZW1vdmVUeXBlc0NoYW5nZWRMaXN0ZW5lcih0aGlzKTsKICAgICAgICAgICAg\nICAgIF9kYXRhLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIENoZWNrIHdoZXRoZXIgd2UndmUgYnVm\nZmVyZWQgYWxsIHJlc3VsdHMsIHdoaWxlIG9wdGlvbmFsbHkgYWRkaW5nCiAg\nICAgICAgICogdGhlIGdpdmVuIHJlc3VsdC4KICAgICAgICAgKi8KICAgICAg\nICBwcml2YXRlIHZvaWQgY2hlY2tGaW5pc2hlZChPYmplY3Qgb2JqLCBib29s\nZWFuIHJlc3VsdCkgewogICAgICAgICAgICAvLyB0aGlzIGNhbiBiZSBjYWxs\nZWQgYXQgdGhlIHNhbWUgdGltZSBhcyBhYm9ydENhY2hpbmcgdmlhCiAgICAg\nICAgICAgIC8vIGEgdHlwZXMgY2hhbmdlZCBldmVudAogICAgICAgICAgICBi\nb29sZWFuIGZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgIHN5bmNocm9u\naXplZCAodGhpcykgewogICAgICAgICAgICAgICAgaWYgKF9tYWludGFpbkNh\nY2hlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBJbnRlZ2VyIGluZGV4ID0gTnVtYmVycy52\nYWx1ZU9mKF9wb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV9k\nYXRhLmNvbnRhaW5zS2V5KGluZGV4KSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgT2JqZWN0IGNhY2hlZDsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjYWNoZWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZWxzZSBpZiAoIV9wcm9qKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNhY2hlZCA9IF9zY3R4LmdldE9iamVjdElkKG9iaik7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RbXSBhcnIgPSAoT2JqZWN0\nW10pIG9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmpl\nY3RbXSBjcCA9IG5ldyBPYmplY3RbYXJyLmxlbmd0aF07CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcnIu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGNwW2ldID0gY29weVByb2plY3Rpb24oYXJyW2ldLCBfc2N0eCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkID0gY3A7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoY2FjaGVkICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX2RhdGEucHV0KGluZGV4LCBjYWNoZWQpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGZpbmlzaGVkID0gX3NpemUgPT0gX2Rh\ndGEuc2l6ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoZmluaXNoZWQpIHsKICAgICAgICAgICAgICAgIC8v\nIGFuIGFib3J0Q2FjaGluZyBjYWxsIGNhbiBzbmVhayBpbiBoZXJlIHZpYSBv\nbkV4cGlyZTsgdGhlCiAgICAgICAgICAgICAgICAvLyBjYWNoZSBpcyBsb2Nr\nZWQgZHVyaW5nIGV2ZW50IGZpcmluZ3MsIHNvIHRoZSBsb2NrIGhlcmUgd2ls\nbAogICAgICAgICAgICAgICAgLy8gd2FpdCBmb3IgaXQgKG9yIHdpbGwgZm9y\nY2UgdGhlIG5leHQgZmlyaW5nIHRvIHdhaXQpCiAgICAgICAgICAgICAgICBf\nY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBkaWRuJ3QgYWJvcnQK\nICAgICAgICAgICAgICAgICAgICBpZiAoX21haW50YWluQ2FjaGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgUXVlcnlSZXN1bHQgcmVzID0gbnVsbDsK\nICAgICAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBuZXcgUXVlcnlS\nZXN1bHQoX3FrLCBfZGF0YS52YWx1ZXMoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZXMuc2V0VGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICBfY2FjaGUucHV0KF9xaywgcmVzKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLndyaXRlVW5s\nb2NrKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNj\nZXNzKCkgewogICAgICAgICAgICByZXR1cm4gX3JvcC5zdXBwb3J0c1JhbmRv\nbUFjY2VzcygpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3Bl\nbigpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAg\nICBfcm9wLm9wZW4oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0UmVzdWx0T2JqZWN0KCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIE9iamVjdCBvYmogPSBfcm9wLmdldFJlc3Vs\ndE9iamVjdCgpOwogICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG9iaiwgdHJ1\nZSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBuZXh0KCkKICAgICAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIF9wb3MrKzsKICAgICAgICAgICAgYm9v\nbGVhbiBuZXh0ID0gX3JvcC5uZXh0KCk7CiAgICAgICAgICAgIGlmICghbmV4\ndCAmJiBfcG9zID09IF9tYXggKyAxKSB7CiAgICAgICAgICAgICAgICBfc2l6\nZSA9IF9wb3M7CiAgICAgICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG51bGws\nIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuZXh0ICYmIF9wb3Mg\nPiBfbWF4KQogICAgICAgICAgICAgICAgX21heCA9IF9wb3M7CiAgICAgICAg\nICAgIHJldHVybiBuZXh0OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gYWJzb2x1dGUoaW50IHBvcykKICAgICAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSBwb3M7CiAgICAgICAgICAg\nIGJvb2xlYW4gdmFsaWQgPSBfcm9wLmFic29sdXRlKHBvcyk7CiAgICAgICAg\nICAgIGlmICghdmFsaWQgJiYgX3BvcyA9PSBfbWF4ICsgMSkgewogICAgICAg\nICAgICAgICAgX3NpemUgPSBfcG9zOwogICAgICAgICAgICAgICAgY2hlY2tG\naW5pc2hlZChudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\ndmFsaWQgJiYgX3BvcyA+IF9tYXgpCiAgICAgICAgICAgICAgICBfbWF4ID0g\nX3BvczsKICAgICAgICAgICAgcmV0dXJuIHZhbGlkOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBzaXplKCkKICAgICAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfc2l6ZSAhPSBJbnRlZ2VyLk1B\nWF9WQUxVRSkKICAgICAgICAgICAgICAgIHJldHVybiBfc2l6ZTsKICAgICAg\nICAgICAgaW50IHNpemUgPSBfcm9wLnNpemUoKTsKICAgICAgICAgICAgX3Np\nemUgPSBzaXplOwogICAgICAgICAgICBjaGVja0ZpbmlzaGVkKG51bGwsIGZh\nbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCByZXNldCgpCiAgICAgICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgICAgICBfcm9wLnJlc2V0KCk7CiAgICAgICAg\nICAgIF9wb3MgPSAtMTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIGNsb3NlKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIGFib3J0Q2FjaGluZygpOwogICAgICAgICAgICBfcm9wLmNsb3Nl\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBoYW5kbGVDaGVj\na2VkRXhjZXB0aW9uKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIF9yb3Au\naGFuZGxlQ2hlY2tlZEV4Y2VwdGlvbihlKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIG9uVHlwZXNDaGFuZ2VkKFR5cGVzQ2hhbmdlZEV2ZW50\nIGV2KSB7CiAgICAgICAgICAgIGlmIChfcWsuY2hhbmdlSW52YWxpZGF0ZXNR\ndWVyeShldi5nZXRUeXBlcygpKSkKICAgICAgICAgICAgICAgIGFib3J0Q2Fj\naGluZygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0cnVj\ndCB0byByZWNvZ25pemUgY2FjaGVkIG9pZHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIENhY2hlZE9iamVjdElkIHsKCiAgICAgICAgcHVi\nbGljIGZpbmFsIE9iamVjdCBvaWQ7CgogICAgICAgIHB1YmxpYyBDYWNoZWRP\nYmplY3RJZCAoT2JqZWN0IG9pZCkKICAgICAgICB7CiAgICAgICAgICAgIHRo\naXMub2lkID0gb2lkOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

