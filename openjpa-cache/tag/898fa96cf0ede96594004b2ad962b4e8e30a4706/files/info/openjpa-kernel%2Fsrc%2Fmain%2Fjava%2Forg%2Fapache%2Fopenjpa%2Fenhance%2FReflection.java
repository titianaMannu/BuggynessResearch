{"sha":"86630a690f056ee98dd4c311e47788d4b82c519c","node_id":"MDQ6QmxvYjIwNjM2NDo4NjYzMGE2OTBmMDU2ZWU5OGRkNGMzMTFlNDc3ODhkNGI4MmM1MTlj","size":34008,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/86630a690f056ee98dd4c311e47788d4b82c519c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmxhbmcucmVmbGVjdC5BY2Nlc3NpYmxlT2JqZWN0OwppbXBvcnQgamF2\nYS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVj\ndC5JbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9k\naWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7\nCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRp\nbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0\ncmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5SZWZlcmVuY2VNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuUmVmbGVjdGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nUmVmZXJlbmNlSGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIFJlZmxlY3Rpb24gdXRp\nbGl0aWVzIHVzZWQgdG8gc3VwcG9ydCBhbmQgYXVnbWVudCBlbmhhbmNlbWVu\ndC4gIFVzZWQgYm90aAogKiBhdCBlbmhhbmNlbWVudCB0aW1lIGFuZCBhdCBy\ndW50aW1lLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNs\nYXNzIFJlZmxlY3Rpb24gewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAo\nUmVmbGVjdGlvbi5jbGFzcyk7CgogICAgLy8gV2VhayBIYXNoTWFwIGNhY2hl\ncyBvZiBnZXR0ZXIvc2V0dGVyL2JlYW5Qcm9wZXJ0eSBtZXRob2RzCiAgICBw\ncml2YXRlIHN0YXRpYyBNYXA8Q2xhc3M8Pz4sIE1hcDxTdHJpbmcsIE1ldGhv\nZD4+IGdldHRlck1ldGhvZENhY2hlID0gCiAgICAgICAgbmV3IENvbmN1cnJl\nbnRSZWZlcmVuY2VIYXNoTWFwKFJlZmVyZW5jZU1hcC5XRUFLLCBSZWZlcmVu\nY2VNYXAuSEFSRCk7CiAgICBwcml2YXRlIHN0YXRpYyBNYXA8Q2xhc3M8Pz4s\nIE1hcDxTdHJpbmcsIE1ldGhvZD4+IHNldHRlck1ldGhvZENhY2hlID0gCiAg\nICAgICAgbmV3IENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwKFJlZmVyZW5j\nZU1hcC5XRUFLLCBSZWZlcmVuY2VNYXAuSEFSRCk7CiAgICBwcml2YXRlIHN0\nYXRpYyBNYXA8Q2xhc3M8Pz4sIFNldDxTdHJpbmc+PiBiZWFuUHJvcGVydGll\nc05hbWVDYWNoZSA9IAogICAgICAgIG5ldyBDb25jdXJyZW50UmVmZXJlbmNl\nSGFzaE1hcChSZWZlcmVuY2VNYXAuV0VBSywgUmVmZXJlbmNlTWFwLkhBUkQp\nOwogICAgCiAgICBwcml2YXRlIHN0YXRpYyBNZXRob2QgZ2V0R2V0dGVyTWV0\naG9kKENsYXNzPD8+IGNscywgU3RyaW5nIHByb3ApIHsKICAgICAgICBNZXRo\nb2QgcnRuTWV0aG9kID0gbnVsbDsKICAgICAgICBNYXA8U3RyaW5nLCBNZXRo\nb2Q+IGNsc01hcCA9IGdldHRlck1ldGhvZENhY2hlLmdldChjbHMpOwogICAg\nICAgIGlmIChjbHNNYXAgIT0gbnVsbCkgewogICAgICAgICAgICBydG5NZXRo\nb2QgPSBjbHNNYXAuZ2V0KHByb3ApOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcnRuTWV0aG9kOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQg\nc2V0R2V0dGVyTWV0aG9kKENsYXNzPD8+IGNscywgU3RyaW5nIHByb3AsCiAg\nICAgICAgTWV0aG9kIG1ldGhvZCkgewogICAgICAgIE1hcDxTdHJpbmcsIE1l\ndGhvZD4gY2xzTWFwID0gZ2V0dGVyTWV0aG9kQ2FjaGUuZ2V0KGNscyk7CiAg\nICAgICAgaWYgKGNsc01hcCA9PSBudWxsKSB7CiAgICAgICAgICAgIGNsc01h\ncCA9IG5ldyBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1hcChSZWZlcmVuY2VN\nYXAuSEFSRCwKICAgICAgICAgICAgICAgIFJlZmVyZW5jZU1hcC5XRUFLKTsK\nICAgICAgICAgICAgZ2V0dGVyTWV0aG9kQ2FjaGUucHV0KGNscywgY2xzTWFw\nKTsKICAgICAgICB9CiAgICAgICAgY2xzTWFwLnB1dChwcm9wLCBtZXRob2Qp\nOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIE1ldGhvZCBnZXRTZXR0ZXJN\nZXRob2QoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgcHJvcCkgewogICAgICAgIE1l\ndGhvZCBydG5NZXRob2QgPSBudWxsOwogICAgICAgIE1hcDxTdHJpbmcsIE1l\ndGhvZD4gY2xzTWFwID0gc2V0dGVyTWV0aG9kQ2FjaGUuZ2V0KGNscyk7CiAg\nICAgICAgaWYgKGNsc01hcCAhPSBudWxsKSB7CiAgICAgICAgICAgIHJ0bk1l\ndGhvZCA9IGNsc01hcC5nZXQocHJvcCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBydG5NZXRob2Q7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9p\nZCBzZXRTZXR0ZXJNZXRob2QoQ2xhc3M8Pz4gY2xzLCBTdHJpbmcgcHJvcCwK\nICAgICAgICBNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgTWFwPFN0cmluZywg\nTWV0aG9kPiBjbHNNYXAgPSBzZXR0ZXJNZXRob2RDYWNoZS5nZXQoY2xzKTsK\nICAgICAgICBpZiAoY2xzTWFwID09IG51bGwpIHsKICAgICAgICAgICAgY2xz\nTWFwID0gbmV3IENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwKFJlZmVyZW5j\nZU1hcC5IQVJELAogICAgICAgICAgICAgICAgUmVmZXJlbmNlTWFwLldFQUsp\nOwogICAgICAgICAgICBzZXR0ZXJNZXRob2RDYWNoZS5wdXQoY2xzLCBjbHNN\nYXApOwogICAgICAgIH0KICAgICAgICBjbHNNYXAucHV0KHByb3AsIG1ldGhv\nZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGdldHRlciBt\nZXRob2QgbWF0Y2hpbmcgdGhlIGdpdmVuIHByb3BlcnR5IG5hbWUsIG9wdGlv\nbmFsbHkKICAgICAqIHRocm93aW5nIGFuIGV4Y2VwdGlvbiBpZiBub25lLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIE1ldGhvZCBmaW5kR2V0dGVyKENs\nYXNzIGNscywgU3RyaW5nIHByb3AsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAg\nICAgICAgTWV0aG9kIG0gPSBnZXRHZXR0ZXJNZXRob2QoY2xzLCBwcm9wKTsK\nICAgICAgICBpZiAobSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBt\nOwogICAgICAgIH0KICAgICAgICBTdHJpbmcgY2FwUHJvcCA9IFN0cmluZ1V0\naWxzLmNhcGl0YWxpemUocHJvcCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gdGhpcyBhbGdvcml0aG0gc2VhcmNoZXMgZm9yIGEgZ2V0PHByb3A+\nIG9yIGlzPHByb3A+IG1ldGhvZCBpbgogICAgICAgICAgICAvLyBhIGJyZWFk\ndGgtZmlyc3QgbWFubmVyLgogICAgICAgICAgICBmb3IgKENsYXNzIGMgPSBj\nbHM7IGMgIT0gbnVsbCAmJiBjICE9IE9iamVjdC5jbGFzczsKICAgICAgICAg\nICAgICAgIGMgPSBjLmdldFN1cGVyY2xhc3MoKSkgewogICAgICAgICAgICAg\nICAgbSA9IGdldERlY2xhcmVkTWV0aG9kKGMsICJnZXQiICsgY2FwUHJvcCwg\nbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAobSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgc2V0R2V0dGVyTWV0aG9kKGNscywgcHJvcCwgbSk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG0gPSBnZXREZWNsYXJl\nZE1ldGhvZChjLCAiaXMiICsgY2FwUHJvcCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKG0gIT0gbnVsbCAmJiAobS5nZXRSZXR1cm5UeXBlKCkg\nPT0gYm9vbGVhbi5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBt\nLmdldFJldHVyblR5cGUoKSA9PSBCb29sZWFuLmNsYXNzKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBzZXRHZXR0ZXJNZXRob2QoY2xzLCBwcm9wLCBt\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAobXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWdldHRlciIsIGNscywgcHJvcCkp\nOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBzZXR0ZXIgbWV0aG9kIG1hdGNoaW5nIHRoZSBnaXZlbiBw\ncm9wZXJ0eSBuYW1lLCBvcHRpb25hbGx5CiAgICAgKiB0aHJvd2luZyBhbiBl\neGNlcHRpb24gaWYgbm9uZS4gIFRoZSBwcm9wZXJ0eSBtdXN0IGFsc28gaGF2\nZSBhIGdldHRlci4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBNZXRob2Qg\nZmluZFNldHRlcihDbGFzcyBjbHMsIFN0cmluZyBwcm9wLCBib29sZWFuIG11\nc3RFeGlzdCkgewogICAgICAgIE1ldGhvZCBnZXR0ZXIgPSBmaW5kR2V0dGVy\nKGNscywgcHJvcCwgbXVzdEV4aXN0KTsKICAgICAgICByZXR1cm4gKGdldHRl\nciA9PSBudWxsKSA/IG51bGwgCiAgICAgICAgICAgIDogZmluZFNldHRlcihj\nbHMsIHByb3AsIGdldHRlci5nZXRSZXR1cm5UeXBlKCksIG11c3RFeGlzdCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNldHRlciBtZXRo\nb2QgbWF0Y2hpbmcgdGhlIGdpdmVuIHByb3BlcnR5IG5hbWUsIG9wdGlvbmFs\nbHkKICAgICAqIHRocm93aW5nIGFuIGV4Y2VwdGlvbiBpZiBub25lLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE1ldGhvZCBmaW5kU2V0dGVyKENsYXNz\nIGNscywgU3RyaW5nIHByb3AsIENsYXNzIHBhcmFtLAogICAgICAgIGJvb2xl\nYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgTWV0aG9kIG0gPSBnZXRTZXR0ZXJN\nZXRob2QoY2xzLCBwcm9wKTsKICAgICAgICBpZiAobSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIHJldHVybiBtOwogICAgICAgIH0KICAgICAgICBTdHJpbmcg\nbmFtZSA9ICJzZXQiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShwcm9wKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKENsYXNzIGMgPSBjbHM7\nIGMgIT0gbnVsbCAmJiBjICE9IE9iamVjdC5jbGFzczsKICAgICAgICAgICAg\nICAgIGMgPSBjLmdldFN1cGVyY2xhc3MoKSkgewogICAgICAgICAgICAgICAg\nbSA9IGdldERlY2xhcmVkTWV0aG9kKGMsIG5hbWUsIHBhcmFtKTsKICAgICAg\nICAgICAgICAgIGlmIChtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBzZXRTZXR0ZXJNZXRob2QoY2xzLCBwcm9wLCBtKTsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1zZXR0ZXIiLCBjbHMsIHBy\nb3ApKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZXMgPGNvZGU+Y2xzLmdldERlY2xhcmVkTWV0aG9kcygpPC9j\nb2RlPiwgYW5kIHJldHVybnMgdGhlIG1ldGhvZAogICAgICogdGhhdCBtYXRj\naGVzIHRoZSA8Y29kZT5uYW1lPC9jb2RlPiBhbmQgPGNvZGU+cGFyYW08L2Nv\nZGU+IGFyZ3VtZW50cy4KICAgICAqIEF2b2lkcyB0aGUgZXhjZXB0aW9uIHRo\ncm93biBieSA8Y29kZT5DbGFzcy5nZXREZWNsYXJlZE1ldGhvZCgpPC9jb2Rl\nPgogICAgICogZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuIDxjb2RlPnBhcmFt\nPC9jb2RlPiBtYXkgYmUgbnVsbC4gQWRkaXRpb25hbGx5LAogICAgICogaWYg\ndGhlcmUgYXJlIG11bHRpcGxlIG1ldGhvZHMgd2l0aCBkaWZmZXJlbnQgcmV0\ndXJuIHR5cGVzLCB0aGlzIHdpbGwKICAgICAqIHJldHVybiB0aGUgbWV0aG9k\nIGRlZmluZWQgaW4gdGhlIGxlYXN0LWRlcml2ZWQgY2xhc3MuCiAgICAgKgog\nICAgICogQHNpbmNlIDAuOS44CiAgICAgKi8KICAgIHN0YXRpYyBNZXRob2Qg\nZ2V0RGVjbGFyZWRNZXRob2QoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSwKICAg\nICAgICBDbGFzcyBwYXJhbSkgewogICAgICAgIE1ldGhvZFtdIG1ldGhvZHMg\nPSAoTWV0aG9kW10pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZHNB\nY3Rpb24oY2xzKSk7CiAgICAgICAgTWV0aG9kIGNhbmRpZGF0ZSA9IG51bGw7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDAgOyBpIDwgbWV0aG9kcy5sZW5ndGg7\nIGkrKykgewogICAgCSAgICBpZiAobmFtZS5lcXVhbHMobWV0aG9kc1tpXS5n\nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICBDbGFzc1tdIG1ldGhvZFBh\ncmFtcyA9IG1ldGhvZHNbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAg\nICAgICAgICAgIGlmIChwYXJhbSA9PSBudWxsICYmIG1ldGhvZFBhcmFtcy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUgPSBt\nb3N0RGVyaXZlZChtZXRob2RzW2ldLCBjYW5kaWRhdGUpOwogICAgICAgICAg\nICAgICAgZWxzZSBpZiAocGFyYW0gIT0gbnVsbCAmJiBtZXRob2RQYXJhbXMu\nbGVuZ3RoID09IDEKICAgICAgICAgICAgICAgICAgICAmJiBwYXJhbS5lcXVh\nbHMobWV0aG9kUGFyYW1zWzBdKSkKICAgICAgICAgICAgICAgICAgICBjYW5k\naWRhdGUgPSBtb3N0RGVyaXZlZChtZXRob2RzW2ldLCBjYW5kaWRhdGUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjYW5kaWRh\ndGU7CiAgICB9CgogICAgc3RhdGljIE1ldGhvZCBtb3N0RGVyaXZlZChNZXRo\nb2QgbWV0aDEsIE1ldGhvZCBtZXRoMikgewogICAgICAgIGlmIChtZXRoMSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWV0aDI7CiAgICAgICAgaWYg\nKG1ldGgyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtZXRoMTsKICAg\nICAgICAKICAgICAgICBDbGFzcyBjbHMyID0gbWV0aDIuZ2V0RGVjbGFyaW5n\nQ2xhc3MoKTsKICAgICAgICBDbGFzcyBjbHMxID0gbWV0aDEuZ2V0RGVjbGFy\naW5nQ2xhc3MoKTsKCiAgICAgICAgaWYgKGNsczEuZXF1YWxzKGNsczIpKSB7\nCiAgICAgICAgICAgIENsYXNzIHJldDEgPSBtZXRoMS5nZXRSZXR1cm5UeXBl\nKCk7CiAgICAgICAgICAgIENsYXNzIHJldDIgPSBtZXRoMi5nZXRSZXR1cm5U\neXBlKCk7CiAgICAgICAgICAgIGlmIChyZXQxLmlzQXNzaWduYWJsZUZyb20o\ncmV0MikpCiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aDI7CiAgICAgICAg\nICAgIGVsc2UgaWYgKHJldDIuaXNBc3NpZ25hYmxlRnJvbShyZXQxKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBtZXRoMTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgibW9zdC1kZXJp\ndmVkLXVucmVsYXRlZC1zYW1lLXR5cGUiLCBtZXRoMSwgbWV0aDIpCiAgICAg\nICAgICAgICAgICAgICAgICAgIC5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIGlmIChjbHMxLmlzQXNzaWduYWJsZUZyb20o\nY2xzMikpCiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aDI7CiAgICAgICAg\nICAgIGVsc2UgaWYgKGNsczIuaXNBc3NpZ25hYmxlRnJvbShjbHMxKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBtZXRoMTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgibW9zdC1kZXJp\ndmVkLXVucmVsYXRlZCIsIG1ldGgxLCBtZXRoMikKICAgICAgICAgICAgICAg\nICAgICAgICAgLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCB3aXRoIHRoZSBnaXZlbiBu\nYW1lLCBvcHRpb25hbGx5IHRocm93aW5nIGFuIGV4Y2VwdGlvbgogICAgICog\naWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBGaWVsZCBmaW5k\nRmllbGQoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBtdXN0RXhp\nc3QpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBGaWVsZCBmOwogICAg\nICAgICAgICBmb3IgKENsYXNzIGMgPSBjbHM7IGMgIT0gbnVsbCAmJiBjICE9\nIE9iamVjdC5jbGFzczsKICAgICAgICAgICAgICAgIGMgPSBjLmdldFN1cGVy\nY2xhc3MoKSkgewogICAgICAgICAgICAgICAgZiA9IGdldERlY2xhcmVkRmll\nbGQoYywgbmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoZiAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQoKICAgICAg\nICBpZiAobXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLWZpZWxkIiwgY2xzLCBuYW1lKSk7CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZv\na2VzIDxjb2RlPmNscy5nZXREZWNsYXJlZEZpZWxkcygpPC9jb2RlPiwgYW5k\nIHJldHVybnMgdGhlIGZpZWxkCiAgICAgKiB0aGF0IG1hdGNoZXMgdGhlIDxj\nb2RlPm5hbWU8L2NvZGU+IGFyZ3VtZW50LiAgQXZvaWRzIHRoZSBleGNlcHRp\nb24KICAgICAqIHRocm93biBieSA8Y29kZT5DbGFzcy5nZXREZWNsYXJlZEZp\nZWxkKCk8L2NvZGU+IGZvciBwZXJmb3JtYW5jZSByZWFzb25zLgogICAgICoK\nICAgICAqIEBzaW5jZSAwLjkuOAogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBGaWVsZCBnZXREZWNsYXJlZEZpZWxkKENsYXNzIGNscywgU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBGaWVsZFtdIGZpZWxkcyA9IEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXREZWNsYXJlZEZpZWxkc0FjdGlvbihjbHMpKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMCA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgIAkgICAg\naWYgKG5hbWUuZXF1YWxzKGZpZWxkc1tpXS5nZXROYW1lKCkpKQoJCSAgICAg\nICAgcmV0dXJuIGZpZWxkc1tpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVl\nIG9mIHRoZSBnaXZlbiBmaWVsZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZXQoT2JqZWN0IHRhcmdl\ndCwgRmllbGQgZmllbGQpIHsKICAgICAgICBpZiAodGFyZ2V0ID09IG51bGwg\nfHwgZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgbWFrZUFjY2Vzc2libGUoZmllbGQsIGZpZWxkLmdldE1vZGlmaWVy\ncygpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZmllbGQu\nZ2V0KHRhcmdldCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICAgICAgdGhyb3cgd3JhcFJlZmxlY3Rpb25FeGNlcHRpb24odCwg\nX2xvYy5nZXQoImdldC1maWVsZCIsIHRhcmdldCwgZmllbGQpKTsKICAgICAg\nICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0IHRoZSB2YWx1ZSBv\nZiB0aGUgZ2l2ZW4gbmFtZWQgZmllbGQgb3IgYSBjb3JyZXNwb25kaW5nIGdl\ndHRlciBtZXRob2QuCiAgICAgKiAKICAgICAqIEByZXR1cm4gbnVsbCBpZiB0\naGUgZmllbGQgZG9lcyBub3QgZXhpc3QgYW5kIG11c3RFeGlzdCBpcyBzZXQg\ndG8gZmFsc2Ugb3IKICAgICAqIHRoZSBnaXZlbiB0YXJnZXQgaXMgbnVsbC4K\nICAgICAqIAogICAgICogQGV4Y2VwdGlvbiBVc2VyRXhjZXB0aW9uIGlmIG11\nc3RFeGlzdCBpcyB0cnVlIGFuZCB0aGUgZmllbGQgb3IgZ2V0dGVyIAogICAg\nICogbWV0aG9kIGlzIG5vbi1leGlzdGVudAogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIE9iamVjdCBnZXRWYWx1ZShPYmplY3Qgb2JqLCBTdHJpbmcgcHJv\ncCwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgIAlpZiAob2JqID09IG51bGwp\nCiAgICAJCXJldHVybiBudWxsOwogICAgCUNsYXNzIGNscyA9IG9iai5nZXRD\nbGFzcygpOwogICAgCUZpZWxkIGZpZWxkID0gZmluZEZpZWxkKGNscywgcHJv\ncCwgZmFsc2UpOwogICAgCWlmIChmaWVsZCAhPSBudWxsKQogICAgCQlyZXR1\ncm4gZ2V0KG9iaiwgZmllbGQpOwogICAgCU1ldGhvZCBnZXR0ZXIgPSBmaW5k\nR2V0dGVyKGNscywgcHJvcCwgZmFsc2UpOwogICAgCWlmIChnZXR0ZXIgIT0g\nbnVsbCkKICAgIAkJcmV0dXJuIGdldChvYmosIGdldHRlcik7CiAgICAgICAg\naWYgKG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1maWVsZCIsIGNscywgcHJvcCkpOwogICAg\nICAgIHJldHVybiBudWxsOyAvLyBzaG91bGQgbm90IHJlYWNoCiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIHRoZSBnaXZlbiBtZW1iZXIgYWNjZXNzaWJs\nZSBpZiBpdCBpc24ndCBhbHJlYWR5LgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyB2b2lkIG1ha2VBY2Nlc3NpYmxlKEFjY2Vzc2libGVPYmplY3QgYW8s\nIGludCBtb2RzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFN\nb2RpZmllci5pc1B1YmxpYyhtb2RzKSAmJiAhYW8uaXNBY2Nlc3NpYmxlKCkp\nCiAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgICAgIC5zZXRBY2Nl\nc3NpYmxlQWN0aW9uKGFvLCB0cnVlKSk7CiAgICAgICAgfSBjYXRjaCAoU2Vj\ndXJpdHlFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoInJlZmxlY3Qtc2VjdXJpdHkiLCBhbykp\nLgogICAgICAgICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogV3JhcCB0aGUgZ2l2ZW4gcmVmbGVjdGlv\nbiBleGNlcHRpb24gYXMgYSBydW50aW1lIGV4Y2VwdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgUnVudGltZUV4Y2VwdGlvbiB3cmFwUmVmbGVj\ndGlvbkV4Y2VwdGlvbihUaHJvd2FibGUgdCwgTWVzc2FnZSBtZXNzYWdlKSB7\nCiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0RXhj\nZXB0aW9uKQogICAgICAgICAgICB0ID0gKChJbnZvY2F0aW9uVGFyZ2V0RXhj\nZXB0aW9uKSB0KS5nZXRUYXJnZXRFeGNlcHRpb24oKTsgIAogICAgICAgIHQu\naW5pdENhdXNlKG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24obWVzc2Fn\nZS5nZXRNZXNzYWdlKCkpKTsKICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFJ1\nbnRpbWVFeGNlcHRpb24pCiAgICAgICAgICAgIHJldHVybiAoUnVudGltZUV4\nY2VwdGlvbikgdDsKICAgICAgICByZXR1cm4gbmV3IEdlbmVyYWxFeGNlcHRp\nb24odCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVl\nIG9mIHRoZSBnaXZlbiBmaWVsZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gZ2V0Qm9vbGVhbihPYmpl\nY3QgdGFyZ2V0LCBGaWVsZCBmaWVsZCkgewogICAgICAgIGlmICh0YXJnZXQg\nPT0gbnVsbCB8fCBmaWVsZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgbWFrZUFjY2Vzc2libGUoZmllbGQsIGZpZWxkLmdl\ndE1vZGlmaWVycygpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gZmllbGQuZ2V0Qm9vbGVhbih0YXJnZXQpOwogICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93IHdyYXBSZWZsZWN0\naW9uRXhjZXB0aW9uKHQsIF9sb2MuZ2V0KCJnZXQtZmllbGQiLCB0YXJnZXQs\nIGZpZWxkKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVu\nIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBieXRlIGdldEJ5\ndGUoT2JqZWN0IHRhcmdldCwgRmllbGQgZmllbGQpIHsKICAgICAgICBpZiAo\ndGFyZ2V0ID09IG51bGwgfHwgZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIChieXRlKSAwOwogICAgICAgIG1ha2VBY2Nlc3NpYmxlKGZpZWxk\nLCBmaWVsZC5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIGZpZWxkLmdldEJ5dGUodGFyZ2V0KTsKICAgICAgICB9\nIGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB0aHJvdyB3cmFw\nUmVmbGVjdGlvbkV4Y2VwdGlvbih0LCBfbG9jLmdldCgiZ2V0LWZpZWxkIiwg\ndGFyZ2V0LCBmaWVsZCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIGZpZWxkIGluIHRo\nZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2hh\nciBnZXRDaGFyKE9iamVjdCB0YXJnZXQsIEZpZWxkIGZpZWxkKSB7CiAgICAg\nICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGZpZWxkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiAoY2hhcikgMDsKICAgICAgICBtYWtlQWNjZXNzaWJs\nZShmaWVsZCwgZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRDaGFyKHRhcmdldCk7CiAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgdGhy\nb3cgd3JhcFJlZmxlY3Rpb25FeGNlcHRpb24odCwgX2xvYy5nZXQoImdldC1m\naWVsZCIsIHRhcmdldCwgZmllbGQpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVs\nZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGRvdWJsZSBnZXREb3VibGUoT2JqZWN0IHRhcmdldCwgRmllbGQgZmll\nbGQpIHsKICAgICAgICBpZiAodGFyZ2V0ID09IG51bGwgfHwgZmllbGQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDBEOwogICAgICAgIG1ha2VBY2Nl\nc3NpYmxlKGZpZWxkLCBmaWVsZC5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmdldERvdWJsZSh0YXJn\nZXQpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAg\nICAgIHRocm93IHdyYXBSZWZsZWN0aW9uRXhjZXB0aW9uKHQsIF9sb2MuZ2V0\nKCJnZXQtZmllbGQiLCB0YXJnZXQsIGZpZWxkKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2\nZW4gZmllbGQgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBmbG9hdCBnZXRGbG9hdChPYmplY3QgdGFyZ2V0LCBGaWVs\nZCBmaWVsZCkgewogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBmaWVs\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gMEY7CiAgICAgICAgbWFr\nZUFjY2Vzc2libGUoZmllbGQsIGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZmllbGQuZ2V0RmxvYXQo\ndGFyZ2V0KTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgICAgICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2VwdGlvbih0LCBfbG9j\nLmdldCgiZ2V0LWZpZWxkIiwgdGFyZ2V0LCBmaWVsZCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUgb2YgdGhl\nIGdpdmVuIGZpZWxkIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgaW50IGdldEludChPYmplY3QgdGFyZ2V0LCBGaWVs\nZCBmaWVsZCkgewogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBmaWVs\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBtYWtl\nQWNjZXNzaWJsZShmaWVsZCwgZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRJbnQodGFy\nZ2V0KTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAg\nICAgICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2VwdGlvbih0LCBfbG9jLmdl\ndCgiZ2V0LWZpZWxkIiwgdGFyZ2V0LCBmaWVsZCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUgb2YgdGhlIGdp\ndmVuIGZpZWxkIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgbG9uZyBnZXRMb25nKE9iamVjdCB0YXJnZXQsIEZpZWxk\nIGZpZWxkKSB7CiAgICAgICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGZpZWxk\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAwTDsKICAgICAgICBtYWtl\nQWNjZXNzaWJsZShmaWVsZCwgZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRMb25nKHRh\ncmdldCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgdGhyb3cgd3JhcFJlZmxlY3Rpb25FeGNlcHRpb24odCwgX2xvYy5n\nZXQoImdldC1maWVsZCIsIHRhcmdldCwgZmllbGQpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIG9mIHRoZSBn\naXZlbiBmaWVsZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIHNob3J0IGdldFNob3J0KE9iamVjdCB0YXJnZXQsIEZp\nZWxkIGZpZWxkKSB7CiAgICAgICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAoc2hvcnQpIDA7CiAg\nICAgICAgbWFrZUFjY2Vzc2libGUoZmllbGQsIGZpZWxkLmdldE1vZGlmaWVy\ncygpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZmllbGQu\nZ2V0U2hvcnQodGFyZ2V0KTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUg\ndCkgewogICAgICAgICAgICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2VwdGlv\nbih0LCBfbG9jLmdldCgiZ2V0LWZpZWxkIiwgdGFyZ2V0LCBmaWVsZCkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmV0\ndXJuIHZhbHVlIG9mIHRoZSBnaXZlbiBnZXR0ZXIgaW4gdGhlIGdpdmVuIG9i\namVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2V0KE9i\namVjdCB0YXJnZXQsIE1ldGhvZCBnZXR0ZXIpIHsKICAgICAgICBpZiAodGFy\nZ2V0ID09IG51bGwgfHwgZ2V0dGVyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIG1ha2VBY2Nlc3NpYmxlKGdldHRlciwgZ2V0\ndGVyLmdldE1vZGlmaWVycygpKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gZ2V0dGVyLmludm9rZSh0YXJnZXQsIChPYmplY3RbXSkgbnVs\nbCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgdGhyb3cgd3JhcFJlZmxlY3Rpb25FeGNlcHRpb24odCwgX2xvYy5nZXQo\nImdldC1tZXRob2QiLCB0YXJnZXQsIGdldHRlcikpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmV0dXJuIHZhbHVlIG9m\nIHRoZSBnaXZlbiBnZXR0ZXIgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIGdldEJvb2xlYW4oT2JqZWN0\nIHRhcmdldCwgTWV0aG9kIGdldHRlcikgewogICAgICAgIE9iamVjdCBvID0g\nZ2V0KHRhcmdldCwgZ2V0dGVyKTsKICAgICAgICByZXR1cm4gKG8gPT0gbnVs\nbCkgPyBmYWxzZSA6ICgoQm9vbGVhbikgbykuYm9vbGVhblZhbHVlKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJldHVybiB2YWx1ZSBv\nZiB0aGUgZ2l2ZW4gZ2V0dGVyIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgYnl0ZSBnZXRCeXRlKE9iamVjdCB0YXJn\nZXQsIE1ldGhvZCBnZXR0ZXIpIHsKICAgICAgICBPYmplY3QgbyA9IGdldCh0\nYXJnZXQsIGdldHRlcik7CiAgICAgICAgcmV0dXJuIChvID09IG51bGwpID8g\nKGJ5dGUpIDAgOiAoKE51bWJlcikgbykuYnl0ZVZhbHVlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUg\nZ2l2ZW4gZ2V0dGVyIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgY2hhciBnZXRDaGFyKE9iamVjdCB0YXJnZXQsIE1l\ndGhvZCBnZXR0ZXIpIHsKICAgICAgICBPYmplY3QgbyA9IGdldCh0YXJnZXQs\nIGdldHRlcik7CiAgICAgICAgcmV0dXJuIChvID09IG51bGwpID8gKGNoYXIp\nIDAgOiAoKENoYXJhY3RlcikgbykuY2hhclZhbHVlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZ2l2\nZW4gZ2V0dGVyIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgZG91YmxlIGdldERvdWJsZShPYmplY3QgdGFyZ2V0LCBN\nZXRob2QgZ2V0dGVyKSB7CiAgICAgICAgT2JqZWN0IG8gPSBnZXQodGFyZ2V0\nLCBnZXR0ZXIpOwogICAgICAgIHJldHVybiAobyA9PSBudWxsKSA/IDBEIDog\nKChOdW1iZXIpIG8pLmRvdWJsZVZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZ2V0\ndGVyIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgZmxvYXQgZ2V0RmxvYXQoT2JqZWN0IHRhcmdldCwgTWV0aG9kIGdl\ndHRlcikgewogICAgICAgIE9iamVjdCBvID0gZ2V0KHRhcmdldCwgZ2V0dGVy\nKTsKICAgICAgICByZXR1cm4gKG8gPT0gbnVsbCkgPyAwRiA6ICgoTnVtYmVy\nKSBvKS5mbG9hdFZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZ2V0dGVyIGluIHRo\nZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50\nIGdldEludChPYmplY3QgdGFyZ2V0LCBNZXRob2QgZ2V0dGVyKSB7CiAgICAg\nICAgT2JqZWN0IG8gPSBnZXQodGFyZ2V0LCBnZXR0ZXIpOwogICAgICAgIHJl\ndHVybiAobyA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgbykuaW50VmFsdWUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmV0dXJuIHZh\nbHVlIG9mIHRoZSBnaXZlbiBnZXR0ZXIgaW4gdGhlIGdpdmVuIG9iamVjdC4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBsb25nIGdldExvbmcoT2JqZWN0\nIHRhcmdldCwgTWV0aG9kIGdldHRlcikgewogICAgICAgIE9iamVjdCBvID0g\nZ2V0KHRhcmdldCwgZ2V0dGVyKTsKICAgICAgICByZXR1cm4gKG8gPT0gbnVs\nbCkgPyAwTCA6ICgoTnVtYmVyKSBvKS5sb25nVmFsdWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBn\naXZlbiBnZXR0ZXIgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBzaG9ydCBnZXRTaG9ydChPYmplY3QgdGFyZ2V0LCBN\nZXRob2QgZ2V0dGVyKSB7CiAgICAgICAgT2JqZWN0IG8gPSBnZXQodGFyZ2V0\nLCBnZXR0ZXIpOwogICAgICAgIHJldHVybiAobyA9PSBudWxsKSA/IChzaG9y\ndCkgMCA6ICgoTnVtYmVyKSBvKS5zaG9ydFZhbHVlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVsZCBp\nbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIHZvaWQgc2V0KE9iamVjdCB0YXJnZXQsIEZpZWxkIGZpZWxkLCBPYmplY3Qg\ndmFsdWUpIHsKICAgICAgICBpZiAodGFyZ2V0ID09IG51bGwgfHwgZmllbGQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIG1ha2VBY2Nl\nc3NpYmxlKGZpZWxkLCBmaWVsZC5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZmllbGQuc2V0KHRhcmdldCwgdmFsdWUpOwog\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRo\ncm93IHdyYXBSZWZsZWN0aW9uRXhjZXB0aW9uKHQsIF9sb2MuZ2V0KCJzZXQt\nZmllbGQiLCBuZXcgT2JqZWN0W117dGFyZ2V0LCBmaWVsZCwgdmFsdWUsIAog\nICAgICAgICAgICAgICAgICAgIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVl\nLmdldENsYXNzKCl9KSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdp\ndmVuIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHNl\ndChPYmplY3QgdGFyZ2V0LCBGaWVsZCBmaWVsZCwgYm9vbGVhbiB2YWx1ZSkg\newogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBmaWVsZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbWFrZUFjY2Vzc2libGUo\nZmllbGQsIGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBmaWVsZC5zZXRCb29sZWFuKHRhcmdldCwgdmFsdWUpOwog\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRo\ncm93IHdyYXBSZWZsZWN0aW9uRXhjZXB0aW9uKHQsIF9sb2MuZ2V0KCJzZXQt\nZmllbGQiLCBuZXcgT2JqZWN0W117dGFyZ2V0LCBmaWVsZCwgdmFsdWUsICJi\nb29sZWFuIn0pKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVsZCBpbiB0aGUgZ2l2ZW4g\nb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgc2V0KE9i\namVjdCB0YXJnZXQsIEZpZWxkIGZpZWxkLCBieXRlIHZhbHVlKSB7CiAgICAg\nICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGZpZWxkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBtYWtlQWNjZXNzaWJsZShmaWVsZCwg\nZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZpZWxkLnNldEJ5dGUodGFyZ2V0LCB2YWx1ZSk7CiAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgdGhyb3cgd3JhcFJl\nZmxlY3Rpb25FeGNlcHRpb24odCwgX2xvYy5nZXQoInNldC1maWVsZCIsIG5l\ndyBPYmplY3RbXXt0YXJnZXQsIGZpZWxkLCB2YWx1ZSwgImJ5dGUifSkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUg\nb2YgdGhlIGdpdmVuIGZpZWxkIGluIHRoZSBnaXZlbiBvYmplY3QuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXQoT2JqZWN0IHRhcmdldCwg\nRmllbGQgZmllbGQsIGNoYXIgdmFsdWUpIHsKICAgICAgICBpZiAodGFyZ2V0\nID09IG51bGwgfHwgZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIG1ha2VBY2Nlc3NpYmxlKGZpZWxkLCBmaWVsZC5nZXRNb2Rp\nZmllcnMoKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmllbGQuc2V0\nQ2hhcih0YXJnZXQsIHZhbHVlKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2Fi\nbGUgdCkgewogICAgICAgICAgICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2Vw\ndGlvbih0LCBfbG9jLmdldCgic2V0LWZpZWxkIiwgbmV3IE9iamVjdFtde3Rh\ncmdldCwgZmllbGQsIHZhbHVlLCAiY2hhciJ9KSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4g\nZmllbGQgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyB2b2lkIHNldChPYmplY3QgdGFyZ2V0LCBGaWVsZCBmaWVsZCwg\nZG91YmxlIHZhbHVlKSB7CiAgICAgICAgaWYgKHRhcmdldCA9PSBudWxsIHx8\nIGZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBt\nYWtlQWNjZXNzaWJsZShmaWVsZCwgZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpZWxkLnNldERvdWJsZSh0YXJn\nZXQsIHZhbHVlKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewog\nICAgICAgICAgICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2VwdGlvbih0LCBf\nbG9jLmdldCgic2V0LWZpZWxkIiwgbmV3IE9iamVjdFtde3RhcmdldCwgZmll\nbGQsIHZhbHVlLCAiZG91YmxlIn0pKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVsZCBp\nbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIHZvaWQgc2V0KE9iamVjdCB0YXJnZXQsIEZpZWxkIGZpZWxkLCBmbG9hdCB2\nYWx1ZSkgewogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBmaWVsZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbWFrZUFjY2Vz\nc2libGUoZmllbGQsIGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBmaWVsZC5zZXRGbG9hdCh0YXJnZXQsIHZhbHVl\nKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAg\nICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2VwdGlvbih0LCBfbG9jLmdldCgi\nc2V0LWZpZWxkIiwgbmV3IE9iamVjdFtde3RhcmdldCwgZmllbGQsIHZhbHVl\nLCAiZmxvYXQifSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIGZpZWxkIGluIHRoZSBnaXZl\nbiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXQo\nT2JqZWN0IHRhcmdldCwgRmllbGQgZmllbGQsIGludCB2YWx1ZSkgewogICAg\nICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBmaWVsZCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgbWFrZUFjY2Vzc2libGUoZmllbGQs\nIGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBmaWVsZC5zZXRJbnQodGFyZ2V0LCB2YWx1ZSk7CiAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgdGhyb3cgd3JhcFJl\nZmxlY3Rpb25FeGNlcHRpb24odCwgX2xvYy5nZXQoInNldC1maWVsZCIsIG5l\ndyBPYmplY3RbXXt0YXJnZXQsIGZpZWxkLCB2YWx1ZSwgImludCJ9KSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBv\nZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHNldChPYmplY3QgdGFyZ2V0LCBG\naWVsZCBmaWVsZCwgbG9uZyB2YWx1ZSkgewogICAgICAgIGlmICh0YXJnZXQg\nPT0gbnVsbCB8fCBmaWVsZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgbWFrZUFjY2Vzc2libGUoZmllbGQsIGZpZWxkLmdldE1vZGlm\naWVycygpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmaWVsZC5zZXRM\nb25nKHRhcmdldCwgdmFsdWUpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgIHRocm93IHdyYXBSZWZsZWN0aW9uRXhjZXB0\naW9uKHQsIF9sb2MuZ2V0KCJzZXQtZmllbGQiLCBuZXcgT2JqZWN0W117dGFy\nZ2V0LCBmaWVsZCwgdmFsdWUsICJsb25nIn0pKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBm\naWVsZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIHZvaWQgc2V0KE9iamVjdCB0YXJnZXQsIEZpZWxkIGZpZWxkLCBz\naG9ydCB2YWx1ZSkgewogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBm\naWVsZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbWFr\nZUFjY2Vzc2libGUoZmllbGQsIGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBmaWVsZC5zZXRTaG9ydCh0YXJnZXQs\nIHZhbHVlKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgICAgICB0aHJvdyB3cmFwUmVmbGVjdGlvbkV4Y2VwdGlvbih0LCBfbG9j\nLmdldCgic2V0LWZpZWxkIiwgbmV3IE9iamVjdFtde3RhcmdldCwgZmllbGQs\nIHZhbHVlLCAic2hvcnQifSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIGZpZWxkIGluIHRo\nZSBnaXZlbiBvYmplY3QuCiAgICAgKiBTYW1lIGJlaGF2aW9yIGFzIGFib3Zl\nIG1ldGhvZHMsIGJ1dCBwYXJhbWV0ZXIgb3JkZXJpbmcgaXMgcmVhcnJhbmdl\nZAogICAgICogdG8gc2ltcGxpZnkgdXNhZ2UgZnJvbSBnZW5lcmF0ZWQgYnl0\nZWNvZGVzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgc2V0KE9iamVjdCB0YXJnZXQsIE9iamVj\ndCB2YWx1ZSwgRmllbGQgZmllbGQpIHsKICAgICAgICBzZXQodGFyZ2V0LCBm\naWVsZCwgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2\nYWx1ZSBvZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIG9iamVjdC4K\nICAgICAqIFNhbWUgYmVoYXZpb3IgYXMgYWJvdmUgbWV0aG9kcywgYnV0IHBh\ncmFtZXRlciBvcmRlcmluZyBpcyByZWFycmFuZ2VkCiAgICAgKiB0byBzaW1w\nbGlmeSB1c2FnZSBmcm9tIGdlbmVyYXRlZCBieXRlY29kZXMuCiAgICAgKgog\nICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\ndm9pZCBzZXQoT2JqZWN0IHRhcmdldCwgYm9vbGVhbiB2YWx1ZSwgRmllbGQg\nZmllbGQpIHsKICAgICAgICBzZXQodGFyZ2V0LCBmaWVsZCwgdmFsdWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgZ2l2\nZW4gZmllbGQgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAqIFNhbWUgYmVo\nYXZpb3IgYXMgYWJvdmUgbWV0aG9kcywgYnV0IHBhcmFtZXRlciBvcmRlcmlu\nZyBpcyByZWFycmFuZ2VkCiAgICAgKiB0byBzaW1wbGlmeSB1c2FnZSBmcm9t\nIGdlbmVyYXRlZCBieXRlY29kZXMuCiAgICAgKgogICAgICogQHNpbmNlIDEu\nMC4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXQoT2JqZWN0\nIHRhcmdldCwgYnl0ZSB2YWx1ZSwgRmllbGQgZmllbGQpIHsKICAgICAgICBz\nZXQodGFyZ2V0LCBmaWVsZCwgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdp\ndmVuIG9iamVjdC4KICAgICAqIFNhbWUgYmVoYXZpb3IgYXMgYWJvdmUgbWV0\naG9kcywgYnV0IHBhcmFtZXRlciBvcmRlcmluZyBpcyByZWFycmFuZ2VkCiAg\nICAgKiB0byBzaW1wbGlmeSB1c2FnZSBmcm9tIGdlbmVyYXRlZCBieXRlY29k\nZXMuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgdm9pZCBzZXQoT2JqZWN0IHRhcmdldCwgY2hhciB2YWx1\nZSwgRmllbGQgZmllbGQpIHsKICAgICAgICBzZXQodGFyZ2V0LCBmaWVsZCwg\ndmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBv\nZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIG9iamVjdC4KICAgICAq\nIFNhbWUgYmVoYXZpb3IgYXMgYWJvdmUgbWV0aG9kcywgYnV0IHBhcmFtZXRl\nciBvcmRlcmluZyBpcyByZWFycmFuZ2VkCiAgICAgKiB0byBzaW1wbGlmeSB1\nc2FnZSBmcm9tIGdlbmVyYXRlZCBieXRlY29kZXMuCiAgICAgKgogICAgICog\nQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBz\nZXQoT2JqZWN0IHRhcmdldCwgZG91YmxlIHZhbHVlLCBGaWVsZCBmaWVsZCkg\newogICAgICAgIHNldCh0YXJnZXQsIGZpZWxkLCB2YWx1ZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVs\nZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICogU2FtZSBiZWhhdmlvciBh\ncyBhYm92ZSBtZXRob2RzLCBidXQgcGFyYW1ldGVyIG9yZGVyaW5nIGlzIHJl\nYXJyYW5nZWQKICAgICAqIHRvIHNpbXBsaWZ5IHVzYWdlIGZyb20gZ2VuZXJh\ndGVkIGJ5dGVjb2Rlcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHNldChPYmplY3QgdGFyZ2V0\nLCBmbG9hdCB2YWx1ZSwgRmllbGQgZmllbGQpIHsKICAgICAgICBzZXQodGFy\nZ2V0LCBmaWVsZCwgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIG9i\namVjdC4KICAgICAqIFNhbWUgYmVoYXZpb3IgYXMgYWJvdmUgbWV0aG9kcywg\nYnV0IHBhcmFtZXRlciBvcmRlcmluZyBpcyByZWFycmFuZ2VkCiAgICAgKiB0\nbyBzaW1wbGlmeSB1c2FnZSBmcm9tIGdlbmVyYXRlZCBieXRlY29kZXMuCiAg\nICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgdm9pZCBzZXQoT2JqZWN0IHRhcmdldCwgaW50IHZhbHVlLCBGaWVs\nZCBmaWVsZCkgewogICAgICAgIHNldCh0YXJnZXQsIGZpZWxkLCB2YWx1ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBn\naXZlbiBmaWVsZCBpbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICogU2FtZSBi\nZWhhdmlvciBhcyBhYm92ZSBtZXRob2RzLCBidXQgcGFyYW1ldGVyIG9yZGVy\naW5nIGlzIHJlYXJyYW5nZWQKICAgICAqIHRvIHNpbXBsaWZ5IHVzYWdlIGZy\nb20gZ2VuZXJhdGVkIGJ5dGVjb2Rlcy4KICAgICAqCiAgICAgKiBAc2luY2Ug\nMS4wLjAKICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHNldChPYmpl\nY3QgdGFyZ2V0LCBsb25nIHZhbHVlLCBGaWVsZCBmaWVsZCkgewogICAgICAg\nIHNldCh0YXJnZXQsIGZpZWxkLCB2YWx1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVsZCBpbiB0aGUg\nZ2l2ZW4gb2JqZWN0LgogICAgICogU2FtZSBiZWhhdmlvciBhcyBhYm92ZSBt\nZXRob2RzLCBidXQgcGFyYW1ldGVyIG9yZGVyaW5nIGlzIHJlYXJyYW5nZWQK\nICAgICAqIHRvIHNpbXBsaWZ5IHVzYWdlIGZyb20gZ2VuZXJhdGVkIGJ5dGVj\nb2Rlcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyB2b2lkIHNldChPYmplY3QgdGFyZ2V0LCBzaG9ydCB2\nYWx1ZSwgRmllbGQgZmllbGQpIHsKICAgICAgICBzZXQodGFyZ2V0LCBmaWVs\nZCwgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBn\naXZlbiBzZXR0ZXIgb24gdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyB2b2lkIHNldChPYmplY3QgdGFyZ2V0LCBNZXRob2Qg\nc2V0dGVyLCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBpZiAodGFyZ2V0ID09\nIG51bGwgfHwgc2V0dGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICBtYWtlQWNjZXNzaWJsZShzZXR0ZXIsIHNldHRlci5nZXRNb2Rp\nZmllcnMoKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2V0dGVyLmlu\ndm9rZSh0YXJnZXQsIG5ldyBPYmplY3RbXSB7IHZhbHVlIH0pOwogICAgICAg\nIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93IHdy\nYXBSZWZsZWN0aW9uRXhjZXB0aW9uKHQsIF9sb2MuZ2V0KCJzZXQtbWV0aG9k\nIiwgbmV3IE9iamVjdFtde3RhcmdldCwgc2V0dGVyLCB2YWx1ZSwgCiAgICAg\nICAgICAgICAgICAgICAgdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUuZ2V0\nQ2xhc3MoKX0pKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nbnZva2UgdGhlIGdpdmVuIHNldHRlciBvbiB0aGUgZ2l2ZW4gb2JqZWN0Lgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgc2V0KE9iamVjdCB0YXJn\nZXQsIE1ldGhvZCBzZXR0ZXIsIGJvb2xlYW4gdmFsdWUpIHsKICAgICAgICBz\nZXQodGFyZ2V0LCBzZXR0ZXIsICh2YWx1ZSkgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0\naGUgZ2l2ZW4gc2V0dGVyIG9uIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXQoT2JqZWN0IHRhcmdldCwgTWV0\naG9kIHNldHRlciwgYnl0ZSB2YWx1ZSkgewogICAgICAgIHNldCh0YXJnZXQs\nIHNldHRlciwgbmV3IEJ5dGUodmFsdWUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZSB0aGUgZ2l2ZW4gc2V0dGVyIG9uIHRoZSBnaXZlbiBvYmpl\nY3QuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXQoT2JqZWN0\nIHRhcmdldCwgTWV0aG9kIHNldHRlciwgY2hhciB2YWx1ZSkgewogICAgICAg\nIHNldCh0YXJnZXQsIHNldHRlciwgbmV3IENoYXJhY3Rlcih2YWx1ZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBnaXZlbiBzZXR0ZXIg\nb24gdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyB2b2lkIHNldChPYmplY3QgdGFyZ2V0LCBNZXRob2Qgc2V0dGVyLCBkb3Vi\nbGUgdmFsdWUpIHsKICAgICAgICBzZXQodGFyZ2V0LCBzZXR0ZXIsIG5ldyBE\nb3VibGUodmFsdWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0\naGUgZ2l2ZW4gc2V0dGVyIG9uIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBzZXQoT2JqZWN0IHRhcmdldCwgTWV0\naG9kIHNldHRlciwgZmxvYXQgdmFsdWUpIHsKICAgICAgICBzZXQodGFyZ2V0\nLCBzZXR0ZXIsIG5ldyBGbG9hdCh2YWx1ZSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW52b2tlIHRoZSBnaXZlbiBzZXR0ZXIgb24gdGhlIGdpdmVuIG9i\namVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHNldChPYmpl\nY3QgdGFyZ2V0LCBNZXRob2Qgc2V0dGVyLCBpbnQgdmFsdWUpIHsKICAgICAg\nICBzZXQodGFyZ2V0LCBzZXR0ZXIsIG5ldyBJbnRlZ2VyKHZhbHVlKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIGdpdmVuIHNldHRlciBv\nbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIHZvaWQgc2V0KE9iamVjdCB0YXJnZXQsIE1ldGhvZCBzZXR0ZXIsIGxvbmcg\ndmFsdWUpIHsKICAgICAgICBzZXQodGFyZ2V0LCBzZXR0ZXIsIG5ldyBMb25n\nKHZhbHVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIGdp\ndmVuIHNldHRlciBvbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIHZvaWQgc2V0KE9iamVjdCB0YXJnZXQsIE1ldGhvZCBz\nZXR0ZXIsIHNob3J0IHZhbHVlKSB7CiAgICAgICAgc2V0KHRhcmdldCwgc2V0\ndGVyLCBuZXcgU2hvcnQodmFsdWUpKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBHZXRzIGFsbCBiZWFuLXN0eWxlIHByb3BlcnR5IG5hbWVzIG9mIHRo\nZSBnaXZlbiBDbGFzcyBvciBpdHMgc3VwZXJjbGFzcy4KICAgICAqIEEgYmVh\nbi1zdHlsZSBwcm9wZXJ0eSAnYWJjJyBleGlzdHMgaW4gQ2xhc3MgQyBpZmYg\nQyBoYXMgZGVjbGFyZWQgCiAgICAgKiBmb2xsb3dpbmcgcGFpciBvZiBtZXRo\nb2RzOgogICAgICogICBwdWJsaWMgdm9pZCBzZXRBYmMoWSB5KSBvciBwdWJs\naWMgQyBzZXRBYmMoWSB5KQogICAgICogICBwdWJsaWMgWSBnZXRBYmMoKTsK\nICAgICAqICAgCiAgICAgKiBJZiBhIGdldHRlciBwcm9wZXJ0eSBpcyBhbm5v\ndGF0ZWQgd2l0aCB7QGxpbmsgUmVmbGVjdGFibGV9LCB0aGVuCiAgICAgKiBp\ndCBpcyBpZ25vcmVkLgogICAgICogICAKICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBTZXQ8U3RyaW5nPiBnZXRCZWFuU3R5bGVQcm9wZXJ0eU5hbWVzKENs\nYXNzPD8+IGMpIHsKICAgICAgICBpZiAoYyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlTZXQoKTsKICAgICAgICBTZXQ8\nU3RyaW5nPiByZXN1bHQgPSBiZWFuUHJvcGVydGllc05hbWVDYWNoZS5nZXQo\nYyk7CiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIE1ldGhvZFtdIG1l\ndGhvZHMgPSBjLmdldE1ldGhvZHMoKTsKICAgICAgICBpZiAobWV0aG9kcyA9\nPSBudWxsIHx8IG1ldGhvZHMubGVuZ3RoIDwgMikKICAgICAgICAgICAgcmV0\ndXJuIENvbGxlY3Rpb25zLmVtcHR5U2V0KCk7CiAgICAgICAgcmVzdWx0ID0g\nbmV3IFRyZWVTZXQ8U3RyaW5nPigpOwogICAgICAgIGZvciAoTWV0aG9kIG0g\nOiBtZXRob2RzKSB7CiAgICAgICAgICAgIGlmIChtLmdldE5hbWUoKS5zdGFy\ndHNXaXRoKCJnZXQiKSkgewogICAgICAgICAgICAgICAgaWYgKCFjYW5SZWZs\nZWN0KG0pKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgU3RyaW5nIHByb3AgPSBTdHJpbmdVdGlscy5jYXBpdGFsaXpl\nKG0uZ2V0TmFtZSgpCiAgICAgICAgICAgICAgICAgICAgLnN1YnN0cmluZygi\nZ2V0Ii5sZW5ndGgoKSkpOwogICAgICAgICAgICAgICAgQ2xhc3M8Pz4gcnR5\ncGUgPSBtLmdldFJldHVyblR5cGUoKTsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgIE1ldGhvZCBzZXR0ZXIgPSBjLmdldE1ldGhv\nZCgic2V0Iitwcm9wLCBuZXcgQ2xhc3M8Pz5bXXtydHlwZX0pOwogICAgICAg\nICAgICAgICAgICBpZiAoc2V0dGVyLmdldFJldHVyblR5cGUoKSA9PSB2b2lk\nLmNsYXNzIHx8IAogICAgICAgICAgICAgICAgICAgICAgc2V0dGVyLmdldFJl\ndHVyblR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGMpKQogICAgICAgICAgICAg\nICAgICByZXN1bHQuYWRkKHByb3ApOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBiZWFuUHJvcGVydGllc05hbWVDYWNoZS5wdXQoYywgcmVz\ndWx0KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEdldHMgYWxsIHB1YmxpYyBmaWVsZCBuYW1lcyBvZiB0aGUg\nZ2l2ZW4gQ2xhc3MuCiAgICAgKiAgIAogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIFNldDxTdHJpbmc+IGdldFB1YmxpY0ZpZWxkTmFtZXMoQ2xhc3MgYykg\newogICAgICAgIGlmIChjID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgRmllbGRbXSBmaWVsZHMg\nPSBjLmdldEZpZWxkcygpOwogICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCB8\nfCBmaWVsZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBDb2xs\nZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgU2V0PFN0cmluZz4gcmVzdWx0\nID0gbmV3IFRyZWVTZXQ8U3RyaW5nPigpOwogICAgICAgIGZvciAoRmllbGQg\nZiA6IGZpZWxkcykgewogICAgICAgICAgICBpZiAoY2FuUmVmbGVjdChmKSkK\nICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQoZi5nZXROYW1lKCkpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEdldHMgdmFsdWVzIG9mIGFsbCBmaWVsZCBmIHRoZSBnaXZl\nbiBjbGFzcyBzdWNoIHRoYXQgZiBleGFjdGx5IAogICAgICogbWF0Y2ggdGhl\nIGdpdmVuIG1vZGlmaWVycyBhbmQgYXJlIG9mIGdpdmVuIHR5cGUgKE9iamVj\ndCBpbXBsaWVzIGFueSB0eXBlKQogICAgICogdW5sZXNzIGYgaXMgYW5ub3Rh\ndGVkIGFzIHtAbGluayBSZWZsZWN0YWJsZX0uIAogICAgICogICAKICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyA8VD4gU2V0PFQ+IGdldEZpZWxkVmFsdWVz\nKENsYXNzIGMsIGludCBtb2RzLCBDbGFzczxUPiB0KXsKICAgICAgICBpZiAo\nYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1Q\nVFlfU0VUOwogICAgICAgIEZpZWxkW10gZmllbGRzID0gYy5nZXRGaWVsZHMo\nKTsKICAgICAgICBpZiAoZmllbGRzID09IG51bGwgfHwgZmllbGRzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlf\nU0VUOwogICAgICAgIFNldDxUPiByZXN1bHQgPSBuZXcgVHJlZVNldDxUPigp\nOwogICAgICAgIGZvciAoRmllbGQgZiA6IGZpZWxkcykgewogICAgICAgICAg\nICBpZiAobW9kcyA9PSBmLmdldE1vZGlmaWVycygpIAogICAgICAgICAgICAm\nJiAodCA9PSBPYmplY3QuY2xhc3MgfHwgdC5pc0Fzc2lnbmFibGVGcm9tKGYu\nZ2V0VHlwZSgpKSkKICAgICAgICAgICAgJiYgY2FuUmVmbGVjdChmKSkgewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXN1\nbHQuYWRkKChUKWYuZ2V0KG51bGwpKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChJbGxlZ2FsQWNjZXNzRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogQWZmaXJt\ncyBpZiB0aGUgZ2l2ZW4gbWVtYmVyIGlzIHNlbGVjdGVkIGZvciByZWZsZWN0\naW9uLiBUaGUgZGVjaXNpb24gaXMKICAgICAqIGJhc2VkIG9uIHRoZSBmb2xs\nb3dpbmcgdHJ1dGggdGFibGUgb24gYm90aCB0aGUgY2xhc3MtbGV2ZWwgYW5k\nIAogICAgICogbWVtYmVyLWxldmVsIGFubm90YXRpb24gKG51bGwgYW5ub3Rh\ndGlvbiByZXByZXNlbnRzIE1BWUJFKSAKICAgICAqIAogICAgICogQ2xhc3Mg\nICBtZW1iZXIgIAogICAgICogTUFZQkUgICBNQVlCRSAgIFlFUwogICAgICog\nTUFZQkUgICBZRVMgICAgIFlFUwogICAgICogTUFZQkUgICBOTyAgICAgIE5P\nCiAgICAgKgogICAgICogWUVTICAgICBNQVlCRSAgIFlFUwogICAgICogWUVT\nICAgICBZRVMgICAgIFlFUwogICAgICogWUVTICAgICBOTyAgICAgIE5PCiAg\nICAgKgogICAgICogTk8gICAgICBZRVMgICAgIFlFUwogICAgICogTk8gICAg\nICBNQVlCRSAgIE5PCiAgICAgKiBOTyAgICAgIE5PICAgICAgTk8gCiAgICAg\nKiAKICAgICovICAgCiAgICBzdGF0aWMgYm9vbGVhbiBjYW5SZWZsZWN0KFJl\nZmxlY3RhYmxlIGNscywgUmVmbGVjdGFibGUgbWVtYmVyKSB7CiAgICAgICAg\naWYgKGNscyA9PSBudWxsIHx8IGNscy52YWx1ZSgpKSB7CiAgICAgICAgICAg\nIHJldHVybiBtZW1iZXIgPT0gbnVsbCB8fCBtZW1iZXIudmFsdWUoKSA9PSB0\ncnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBtZW1i\nZXIgIT0gbnVsbCAmJiBtZW1iZXIudmFsdWUoKSA9PSB0cnVlOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRoZSBv\ncmlnaW5hbCBkZWNsYXJhdGlvbiB0aGUgZ2l2ZW4gZmllbGQgaXMgYW5ub3Rh\ndGVkCiAgICAgKiBmb3IgcmVmbGVjdGlvbi4gCiAgICAgKi8KICAgIHN0YXRp\nYyBib29sZWFuIGNhblJlZmxlY3QoRmllbGQgZmllbGQpIHsKICAgICAgICBD\nbGFzcyBjbHMgPSBmaWVsZC5nZXREZWNsYXJpbmdDbGFzcygpOwogICAgICAg\nIHJldHVybiBjYW5SZWZsZWN0KChSZWZsZWN0YWJsZSljbHMuZ2V0QW5ub3Rh\ndGlvbihSZWZsZWN0YWJsZS5jbGFzcyksIAogICAgICAgICAgICBmaWVsZC5n\nZXRBbm5vdGF0aW9uKFJlZmxlY3RhYmxlLmNsYXNzKSk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgb3JpZ2luYWwgZGVjbGFy\nYXRpb24gdGhlIGdpdmVuIG1ldGhvZCBpcyBhbm5vdGF0ZWQKICAgICAqIGZv\nciByZWZsZWN0aW9uLiAKICAgICAqLwogICAgc3RhdGljIGJvb2xlYW4gY2Fu\nUmVmbGVjdChNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgQ2xhc3MgY2xzID0g\nZ2V0RGVjbGFyaW5nQ2xhc3MobWV0aG9kKTsKICAgICAgICBpZiAoY2xzICE9\nIG1ldGhvZC5nZXREZWNsYXJpbmdDbGFzcygpKQogICAgICAgICAgICBtZXRo\nb2QgPSBnZXREZWNsYXJpbmdNZXRob2QoY2xzLCBtZXRob2QpOwogICAgICAg\nIHJldHVybiBjYW5SZWZsZWN0KChSZWZsZWN0YWJsZSljbHMuZ2V0QW5ub3Rh\ndGlvbihSZWZsZWN0YWJsZS5jbGFzcyksIAogICAgICAgICAgICBtZXRob2Qu\nZ2V0QW5ub3RhdGlvbihSZWZsZWN0YWJsZS5jbGFzcykpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdldHMgdGhlIGRlY2xhcmluZyBjbGFzcyBvZiB0\naGUgZ2l2ZW4gbWV0aG9kIHNpZ25hdHVyZSBidXQgYWxzbyBjaGVja3MKICAg\nICAqIGlmIHRoZSBtZXRob2QgaXMgZGVjbGFyZWQgaW4gYW4gaW50ZXJmYWNl\nLiBJZiB5ZXMsIHRoZW4gcmV0dXJucyB0aGUKICAgICAqIGludGVyZmFjZS4g\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ2xhc3MgZ2V0RGVjbGFyaW5n\nQ2xhc3MoTWV0aG9kIG0pIHsKICAgICAgICBpZiAobSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBDbGFzcyBjbHMgPSBtLmdl\ndERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9ICBj\nbHMuZ2V0SW50ZXJmYWNlcygpOwogICAgICAgIGZvciAoQ2xhc3MgaW50ZiA6\nIGludGZzKSB7CiAgICAgICAgICAgIGlmIChnZXREZWNsYXJpbmdNZXRob2Qo\naW50ZiwgbSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNscyA9IGludGY7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBjbHM7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogR2V0cyB0aGUgbWV0aG9kIGluIHRoZSBnaXZlbiBjbGFz\ncyB0aGF0IGhhcyB0aGUgc2FtZSBzaWduYXR1cmUgb2YgdGhlCiAgICAgKiBn\naXZlbiBtZXRob2QsIGlmIGV4aXN0cy4gT3RoZXJ3aXNlLCBudWxsLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE1ldGhvZCBnZXREZWNsYXJpbmdNZXRo\nb2QoQ2xhc3MgYywgTWV0aG9kIG0pIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBNZXRob2QgbTAgPSBjLmdldE1ldGhvZChtLmdldE5hbWUoKSwgbS5n\nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICAgICAgcmV0dXJuIG0wOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIH0KICAgIH0gICAgCn0K\n","encoding":"base64"}

