{"sha":"1b1190b3dcada19a6ac380dcb3c9bef66bc4f9a6","node_id":"MDQ6QmxvYjIwNjM2NDoxYjExOTBiM2RjYWRhMTlhNmFjMzgwZGNiM2M5YmVmNjZiYzRmOWE2","size":21751,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1b1190b3dcada19a6ac380dcb3c9bef66bc4f9a6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNl\ncHRpb247CgovKioKICogU3RyYXRlZ3kgZm9yIGF0dGFjaGluZyBvYmplY3Rz\nLgogKgogKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBAYXV0aG9y\nIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwphYnN0cmFjdCBjbGFzcyBB\ndHRhY2hTdHJhdGVneQogICAgZXh0ZW5kcyBUcmFuc2ZlckZpZWxkTWFuYWdl\nciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2Mg\nPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChBdHRhY2hTdHJhdGVn\neS5jbGFzcyk7CgogICAgLyoqCiAgICAgKiBBdHRhY2guCiAgICAgKgogICAg\nICogQHBhcmFtIG1hbmFnZXIgbWFuYWdlciBob2xkaW5nIGNhY2hlIG9mIGF0\ndGFjaGVkIGluc3RhbmNlcwogICAgICogQHBhcmFtIHRvQXR0YWNoIGRldGFj\naGVkIGluc3RhbmNlCiAgICAgKiBAcGFyYW0gbWV0YSBtZXRhZGF0YSBmb3Ig\ndGhlIGluc3RhbmNlIGJlaW5nIGF0dGFjaGVkCiAgICAgKiBAcGFyYW0gaW50\nbyBpbnN0YW5jZSB3ZSdyZSBhdHRhY2hpbmcgaW50bwogICAgICogQHBhcmFt\nIG93bmVyIHN0YXRlIG1hbmFnZXIgZm9yIDxjb2RlPmludG88L2NvZGU+CiAg\nICAgKiBAcGFyYW0gb3duZXJNZXRhIGZpZWxkIHdlIHRyYXZlcnNlZCB0byBm\naW5kIDxjb2RlPnRvQXR0YWNoPC9jb2RlPgogICAgICogQHBhcmFtIGV4cGxp\nY2l0IHdoZXRoZXIgdG8gbWFrZSBuZXcgaW5zdGFuY2VzIGV4cGxpY2l0bHkg\ncGVyc2lzdGVudAogICAgICovCiAgICBwdWJsaWMgYWJzdHJhY3QgT2JqZWN0\nIGF0dGFjaChBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgT2JqZWN0\nIHRvQXR0YWNoLCBDbGFzc01ldGFEYXRhIG1ldGEsIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBpbnRvLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIs\nIFZhbHVlTWV0YURhdGEgb3duZXJNZXRhLCBib29sZWFuIGV4cGxpY2l0KTsK\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgaWRlbnRpdHkgb2YgdGhlIGdp\ndmVuIGRldGFjaGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYWJzdHJhY3QgT2JqZWN0IGdldERldGFjaGVkT2JqZWN0SWQoQXR0YWNoTWFu\nYWdlciBtYW5hZ2VyLAogICAgICAgIE9iamVjdCB0b0F0dGFjaCk7CgogICAg\nLyoqCiAgICAgKiBQcm92aWRlIHRoZSBnaXZlbiBmaWVsZCBpbnRvIHRoaXMg\nZmllbGQgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0\nIHZvaWQgcHJvdmlkZUZpZWxkKE9iamVjdCB0b0F0dGFjaCwgU3RhdGVNYW5h\nZ2VySW1wbCBzbSwKICAgICAgICBpbnQgZmllbGQpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIGEgUE5ldy9QTmV3UHJvdmlzaW9uYWwgbWFuYWdlZCBvYmpl\nY3QgZm9yIHRoZSBnaXZlbiBkZXRhY2hlZCAKICAgICAqIGluc3RhbmNlLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBwZXJzaXN0\nKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwKICAgICAgICBQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIENsYXNzTWV0YURhdGEgbWV0YSwgT2JqZWN0IGFwcElkLCAK\nICAgICAgICBib29sZWFuIGV4cGxpY2l0KSB7CiAgICAgICAgUGVyc2lzdGVu\nY2VDYXBhYmxlIG5ld0luc3RhbmNlOwogICAgICAgIGlmICghbWFuYWdlci5n\nZXRDb3B5TmV3KCkpCiAgICAgICAgICAgIG5ld0luc3RhbmNlID0gcGM7CiAg\nICAgICAgZWxzZSBpZiAoYXBwSWQgPT0gbnVsbCkKICAgICAgICAgICAgLy8g\nZGF0YXN0b3JlIGlkZW50aXR5IG9yIGFwcGxpY2F0aW9uIGlkZW50aXR5IHdp\ndGggZ2VuZXJhdGVkIGtleXMKICAgICAgICAgICAgbmV3SW5zdGFuY2UgPSBw\nYy5wY05ld0luc3RhbmNlKG51bGwsIGZhbHNlKTsKICAgICAgICBlbHNlIC8v\nIGFwcGxpY2F0aW9uIGlkZW50aXR5OiB1c2UgZXhpc3RpbmcgZmllbGRzCiAg\nICAgICAgICAgIG5ld0luc3RhbmNlID0gcGMucGNOZXdJbnN0YW5jZShudWxs\nLCBhcHBJZCwgZmFsc2UpOwoKICAgICAgICByZXR1cm4gKFN0YXRlTWFuYWdl\nckltcGwpIG1hbmFnZXIuZ2V0QnJva2VyKCkucGVyc2lzdAogICAgICAgICAg\nICAobmV3SW5zdGFuY2UsIGFwcElkLCBleHBsaWNpdCwgbWFuYWdlci5nZXRC\nZWhhdmlvcigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEF0dGFjaCB0aGUg\nZ2l2ZW4gZmllbGQgaW50byB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKgog\nICAgICogQHBhcmFtIHRvQXR0YWNoIHRoZSBkZXRhY2hlZCBwZXJzaXN0ZW50\nIGluc3RhbmNlCiAgICAgKiBAcGFyYW0gc20gc3RhdGUgbWFuYWdlciBmb3Ig\ndGhlIG1hbmFnZWQgaW5zdGFuY2Ugd2UncmUgY29weWluZwogICAgICogaW50\nbzsgPGNvZGU+dG9BdHRhY2g8L2NvZGU+IGFsc28gdXNlcyB0aGlzIHN0YXRl\nIG1hbmFnZXIKICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgb24gdGhlIGZp\nZWxkIHdlJ3JlIGNvcHlpbmcKICAgICAqIEBwYXJhbSBudWxsTG9hZGVkIGlm\nIGZhbHNlLCBudWxscyB3aWxsIGJlIGNvbnNpZGVyZWQgdW5sb2FkZWQgYW5k\nIHdpbGwKICAgICAqIG5vdCBiZSBhdHRhY2hlZAogICAgICovCiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiBhdHRhY2hGaWVsZChBdHRhY2hNYW5hZ2VyIG1hbmFn\nZXIsIE9iamVjdCB0b0F0dGFjaCwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCwgYm9vbGVhbiBudWxsTG9hZGVkKSB7\nCiAgICAgICAgaWYgKGZtZC5pc1ZlcnNpb24oKQogICAgICAgICAgICB8fCBm\nbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BF\nUlNJU1RFTlQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nUGVyc2lzdGVuY2VDYXBhYmxlIGludG8gPSBzbS5nZXRQZXJzaXN0ZW5jZUNh\ncGFibGUoKTsKICAgICAgICBpbnQgaSA9IGZtZC5nZXRJbmRleCgpOwogICAg\nICAgIHByb3ZpZGVGaWVsZCh0b0F0dGFjaCwgc20sIGkpOwoKICAgICAgICBp\nbnQgc2V0ID0gU3RhdGVNYW5hZ2VyLlNFVF9BVFRBQ0g7CiAgICAgICAgT2Jq\nZWN0IHZhbDsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoK\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdCb29sZWFuRmllbGQoaW50bywg\naSwgc20uZmV0Y2hCb29sZWFuRmllbGQoaSksCiAgICAgICAgICAgICAgICAg\nICAgZmV0Y2hCb29sZWFuRmllbGQoaSksIHNldCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdCeXRlRmllbGQoaW50bywgaSwgc20u\nZmV0Y2hCeXRlRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hC\neXRlRmllbGQoaSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdDaGFyRmllbGQoaW50bywgaSwgc20uZmV0Y2hDaGFyRmll\nbGQoaSksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hDaGFyRmllbGQoaSks\nIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgc20uc2V0dGlu\nZ0RvdWJsZUZpZWxkKGludG8sIGksIHNtLmZldGNoRG91YmxlRmllbGQoaSks\nCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hEb3VibGVGaWVsZChpKSwgc2V0\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdGbG9h\ndEZpZWxkKGludG8sIGksIHNtLmZldGNoRmxvYXRGaWVsZChpKSwKICAgICAg\nICAgICAgICAgICAgICBmZXRjaEZsb2F0RmllbGQoaSksIHNldCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ0ludEZpZWxkKGludG8s\nIGksIHNtLmZldGNoSW50RmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAg\nZmV0Y2hJbnRGaWVsZChpKSwgc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAg\nICAgICAgc20uc2V0dGluZ0xvbmdGaWVsZChpbnRvLCBpLCBzbS5mZXRjaExv\nbmdGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaExvbmdGaWVs\nZChpKSwgc2V0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHNtLnNl\ndHRpbmdTaG9ydEZpZWxkKGludG8sIGksIHNtLmZldGNoU2hvcnRGaWVsZChp\nKSwKICAgICAgICAgICAgICAgICAgICBmZXRjaFNob3J0RmllbGQoaSksIHNl\ndCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgU3RyaW5nIHN2YWwg\nPSBmZXRjaFN0cmluZ0ZpZWxkKGkpOwogICAgICAgICAgICAgICAgaWYgKHN2\nYWwgPT0gbnVsbCAmJiAhbnVsbExvYWRlZCkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nU3Ry\naW5nRmllbGQoaW50bywgaSwgc20uZmV0Y2hTdHJpbmdGaWVsZChpKSwgc3Zh\nbCwKICAgICAgICAgICAgICAgICAgICBzZXQpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1B\nTDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk9JRDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRU5VTToKICAg\nICAgICAgICAgICAgIHZhbCA9IGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAg\nICAgICAgICAgICBpZiAodmFsID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAg\nICAgc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHNtLmZldGNoT2Jq\nZWN0RmllbGQoaSksIHZhbCwKICAgICAgICAgICAgICAgICAgICBzZXQpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlBDOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVE\nOgogICAgICAgICAgICAgICAgT2JqZWN0IGZybXBjID0gZmV0Y2hPYmplY3RG\naWVsZChpKTsKICAgICAgICAgICAgICAgIGlmIChmcm1wYyA9PSBudWxsICYm\nICFudWxsTG9hZGVkKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgdG9zbSA9\nIG1hbmFnZXIuZ2V0QnJva2VyKCkuZ2V0U3RhdGVNYW5hZ2VyCiAgICAgICAg\nICAgICAgICAgICAgKHNtLmZldGNoT2JqZWN0RmllbGQoaSkpOwogICAgICAg\nICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHRvcGMgPSAodG9zbSA9PSBu\ndWxsKSA/IG51bGwKICAgICAgICAgICAgICAgICAgICA6IHRvc20uZ2V0UGVy\nc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgICAgICBpZiAoZnJtcGMg\nIT0gbnVsbCB8fCB0b3BjICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoZm1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgICAgICAgICAgICAgZnJtcGMg\nPSBnZXRSZWZlcmVuY2UobWFuYWdlciwgZnJtcGMsIHNtLCBmbWQpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgaW50b3BjID0gdG9wYzsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKCFmbWQuaXNFbWJlZGRlZFBDKCkgJiYgZnJt\ncGMgIT0gbnVsbCAmJiB0b3BjICE9IG51bGwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICYmICFPYmplY3RVdGlscy5lcXVhbHModG9wYy5wY0ZldGNo\nT2JqZWN0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmFn\nZXIuZ2V0RGV0YWNoZWRPYmplY3RJZChmcm1wYykpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpbnRvcGMgPSBudWxsOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZybXBjID0g\nbWFuYWdlci5hdHRhY2goZnJtcGMsIGludG9wYywgc20sIGZtZCwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBp\nZiAoZnJtcGMgIT0gdG9wYykKICAgICAgICAgICAgICAgICAgICAgICAgc20u\nc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIHRvcGMsIGZybXBjLCBzZXQp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgICAgICBDb2xsZWN0aW9uIGZybWMgPSAoQ29sbGVjdGlvbikgZmV0Y2hP\nYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmIChmcm1jID09IG51\nbGwgJiYgIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiB0b2MgPSAoQ29s\nbGVjdGlvbikgc20uZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAg\nICAgIGlmICgodG9jICE9IG51bGwgJiYgIXRvYy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICAgICAgfHwgZnJtYyAhPSBudWxsICYmICFmcm1jLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmcm1jID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVs\nZChpbnRvLCBpLCB0b2MsIG51bGwsIHNldCk7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZSBpZiAodG9jID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGksIG51bGwsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2hDb2xsZWN0aW9uKG1h\nbmFnZXIsIGZybWMsIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAodG9jIGluc3RhbmNlb2YgU2V0ICYmIGZybWMgaW5z\ndGFuY2VvZiBTZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VD\nb2xsZWN0aW9uKG1hbmFnZXIsIGZybWMsIHRvYywgc20sIGZtZCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0b2MsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByZXBsYWNlTGlzdChtYW5hZ2VyLCBmcm1j\nLCB0b2MsIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBN\nYXAgZnJtbSA9IChNYXApIGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAg\nICAgICAgICBpZiAoZnJtbSA9PSBudWxsICYmICFudWxsTG9hZGVkKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAg\nIE1hcCB0b20gPSAoTWFwKSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAg\nICAgICAgICAgICAgaWYgKCh0b20gIT0gbnVsbCAmJiAhdG9tLmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgICAgICB8fCAoZnJtbSAhPSBudWxsICYmICFm\ncm1tLmlzRW1wdHkoKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJt\nbSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5n\nT2JqZWN0RmllbGQoaW50bywgaSwgdG9tLCBudWxsLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKHRvbSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwg\nbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaE1hcCht\nYW5hZ2VyLCBmcm1tLCBzbSwgZm1kKSwgc2V0KTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VNYXAo\nbWFuYWdlciwgZnJtbSwgdG9tLCBzbSwgZm1kKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIE9iamVjdCBmcm1hID0g\nZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmIChmcm1h\nID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgT2JqZWN0IHRvYSA9IHNt\nLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAoKHRv\nYSAhPSBudWxsICYmIEFycmF5LmdldExlbmd0aCh0b2EpID4gMCkKICAgICAg\nICAgICAgICAgICAgICB8fCAoZnJtYSAhPSBudWxsICYmIEFycmF5LmdldExl\nbmd0aChmcm1hKSA+IDApKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZy\nbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGlu\nZ09iamVjdEZpZWxkKGludG8sIGksIHRvYSwgbnVsbCwgc2V0KTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNt\nLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0b2EsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXBsYWNlQXJyYXkobWFuYWdlciwgZnJtYSwg\ndG9hLCBzbSwgZm1kKSwgc2V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGZtZC50b1N0\ncmluZygpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBtYW5hZ2VkLCBwb3NzaWJseSBo\nb2xsb3cgcmVmZXJlbmNlIGZvciB0aGUgZ2l2ZW4gZGV0YWNoZWQKICAgICAq\nIG9iamVjdC4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBnZXRSZWZl\ncmVuY2UoQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gs\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFZhbHVlTWV0YURhdGEgdm1kKSB7\nCiAgICAgICAgaWYgKHRvQXR0YWNoID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBpZiAobWFuYWdlci5nZXRCcm9rZXIoKS5p\nc05ldyh0b0F0dGFjaCkpIHsKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdG9B\ndHRhY2ggaXMgYWxyZWFkeSBtYXBwZWQgdG8gYSBtYW5hZ2VkIGluc3RhbmNl\nCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IG1hbmFnZXIu\nZ2V0QXR0YWNoZWRDb3B5KHRvQXR0YWNoKTsKICAgICAgICAgICAgaWYgKHBj\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYzsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b0F0dGFj\naDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobWFuYWdlci5n\nZXRCcm9rZXIoKS5pc1BlcnNpc3RlbnQodG9BdHRhY2gpKSB7CiAgICAgICAg\nICAgIHJldHVybiB0b0F0dGFjaDsKICAgICAgICB9IGVsc2UgaWYgKG1hbmFn\nZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZCh0b0F0dGFjaCkpIHsKICAgICAg\nICAgICAgT2JqZWN0IG9pZCA9IG1hbmFnZXIuZ2V0RGV0YWNoZWRPYmplY3RJ\nZCh0b0F0dGFjaCk7CiAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIG1hbmFnZXIuZ2V0QnJva2VyKCkuZmlu\nZChvaWQsIGZhbHNlLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiY2Fu\ndC1jYXNjYWRlLWF0dGFjaCIsIHZtZCkpLnNldEZhaWxlZE9iamVjdCh0b0F0\ndGFjaCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIHRoZSBjb250\nZW50cyBvZiA8Y29kZT50b2M8L2NvZGU+IHdpdGggdGhlIGNvbnRlbnRzIG9m\nCiAgICAgKiA8Y29kZT5mcm1jPC9jb2RlPi4gTmVpdGhlciBjb2xsZWN0aW9u\nIGlzIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNlQ29s\nbGVjdGlvbihBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIENvbGxlY3Rpb24gZnJt\nYywKICAgICAgICBDb2xsZWN0aW9uIHRvYywgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBpZiBmcm1j\nIGNvbGxlY3Rpb24gaXMgZW1wdHksIGp1c3QgY2xlYXIgdG9jCiAgICAgICAg\naWYgKGZybWMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlmICghdG9jLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRvYy5jbGVhcigpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlzIGlz\nIGEgcGMgY29sbGVjdGlvbiwgYXR0YWNoIGFsbCBpbnN0YW5jZXMKICAgICAg\nICBib29sZWFuIHBjID0gZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlw\nZVBDKCk7CiAgICAgICAgaWYgKHBjKQogICAgICAgICAgICBmcm1jID0gYXR0\nYWNoQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1jLCBzbSwgZm1kKTsKCiAgICAg\nICAgLy8gcmVtb3ZlIGFsbCBlbGVtZW50cyBmcm9tIHRoZSB0b2MgY29sbGVj\ndGlvbiB0aGF0IGFyZW4ndCBpbiBmcm1jCiAgICAgICAgdG9jLnJldGFpbkFs\nbChmcm1jKTsKCiAgICAgICAgLy8gbm93IGFkZCBhbGwgZWxlbWVudHMgdGhh\ndCBhcmUgaW4gZnJtYyBidXQgbm90IHRvYwogICAgICAgIGlmIChmcm1jLnNp\nemUoKSAhPSB0b2Muc2l6ZSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaSA9IGZybWMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBPYmplY3Qgb2IgPSBpLm5leHQoKTsKICAgICAgICAgICAg\nICAgIGlmICghdG9jLmNvbnRhaW5zKG9iKSkKICAgICAgICAgICAgICAgICAg\nICB0b2MuYWRkKG9iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBjb2xsZWN0aW9uIHdpdGgg\ndGhlIGF0dGFjaGVkIGNvbnRlbnRzIG9mIHRoZSBnaXZlbiBvbmUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGF0dGFjaENvbGxlY3Rpb24o\nQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAgIENvbGxlY3Rpb24gb3Jp\nZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBDb2xsZWN0aW9uIGNvbGwgPSBjb3B5Q29sbGVjdGlvbiht\nYW5hZ2VyLCBvcmlnLCBmbWQsIHNtKTsKICAgICAgICBWYWx1ZU1ldGFEYXRh\nIHZtZCA9IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgaWYgKCF2bWQuaXNE\nZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4gY29sbDsKCiAg\nICAgICAgLy8gdW5mb3J0dW5hdGVseSB3ZSBoYXZlIHRvIGNsZWFyIHRoZSBv\ncmlnaW5hbCBhbmQgcmUtYWRkCiAgICAgICAgY29sbC5jbGVhcigpOwogICAg\nICAgIE9iamVjdCBlbGVtOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nb3JpZy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBpZiAodm1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfTk9ORSkKICAgICAgICAgICAgICAgIGVsZW0gPSBnZXRSZWZl\ncmVuY2UobWFuYWdlciwgaXRyLm5leHQoKSwgc20sIHZtZCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGVsZW0gPSBtYW5hZ2VyLmF0dGFj\naChpdHIubmV4dCgpLCBudWxsLCBzbSwgdm1kLCBmYWxzZSk7CiAgICAgICAg\nICAgIGNvbGwuYWRkKGVsZW0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nY29sbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvcGllcyB0aGUgZ2l2ZW4g\nY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIGNv\ncHlDb2xsZWN0aW9uKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgQ29sbGVjdGlv\nbiBvcmlnLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nQ29sbGVjdGlvbiBjb2xsID0gbWFuYWdlci5nZXRQcm94eU1hbmFnZXIoKS5j\nb3B5Q29sbGVjdGlvbihvcmlnKTsKICAgICAgICBpZiAoY29sbCA9PSBudWxs\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgibm90LWNvcHlhYmxlIiwgZm1kKSk7CiAgICAgICAgcmV0dXJuIGNvbGw7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ29waWVzIHRoZSBnaXZlbiBj\nb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb24gY29w\neUNvbGxlY3Rpb24oQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBDb2xsZWN0aW9u\nIG9yaWcsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20pIHsKICAgICAgICBpZiAob3JpZyA9PSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLWNvcHlhYmxlIiwgZm1kKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0dXJuIGNvcHlDb2xsZWN0aW9uKG1hbmFnZXIsIG9yaWcsIGZtZCk7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgQ29s\nbGVjdGlvbiBjb2xsID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHko\nZm1kLmdldEluZGV4KCkpOwogICAgICAgICAgICBjb2xsLmFkZEFsbChvcmln\nKTsKICAgICAgICAgICAgcmV0dXJuIGNvbGw7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ29waWVzIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8K\nICAgIHByaXZhdGUgTWFwIGNvcHlNYXAoQXR0YWNoTWFuYWdlciBtYW5hZ2Vy\nLCBNYXAgb3JpZywKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIGlmIChvcmlnID09IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gbWFuYWdlci5nZXRQcm94eU1hbmFnZXIoKS5jb3B5TWFw\nKG9yaWcpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIE1hcCBtYXAgPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5n\nZXRJbmRleCgpKTsKICAgICAgICAgICAgU2V0IGtleXMgPSBvcmlnLmtleVNl\ndCgpOwogICAgICAgICAgICBmb3IgKE9iamVjdCBrZXkgOiBrZXlzKSAKICAg\nICAgICAgICAgICAgIG1hcC5wdXQoa2V5LCBvcmlnLmdldChrZXkpKTsKICAg\nICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIGFuIGF0dGFjaGVkIHZlcnNpb24gb2YgdGhlIDxj\nb2RlPmZybWw8L2NvZGU+CiAgICAgKiBsaXN0IGlmIGl0IGlzIGRpZmZlcmVu\ndCB0aGFuIDxjb2RlPnRvbDwvY29kZT4uIElmIHRoZSBsaXN0cwogICAgICog\nd2lsbCBiZSBpZGVudGljYWwsIHJldHVybnMgPGNvZGU+dG9sPC9jb2RlPi4g\nTmVpdGhlciBsaXN0IGlzIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgQ29s\nbGVjdGlvbiByZXBsYWNlTGlzdChBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIENv\nbGxlY3Rpb24gZnJtbCwKICAgICAgICBDb2xsZWN0aW9uIHRvbCwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICBib29sZWFuIHBjID0gZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlw\nZVBDKCk7CiAgICAgICAgaWYgKHBjKQogICAgICAgICAgICBmcm1sID0gYXR0\nYWNoQ29sbGVjdGlvbihtYW5hZ2VyLCBmcm1sLCBzbSwgZm1kKTsKCiAgICAg\nICAgLy8gaWYgdGhlIG9ubHkgZGlmZiBiZXR3ZWVuIGZybWwgYW5kIHRvbCBp\ncyBzb21lIGFkZGVkIGVsZW1lbnRzIGF0CiAgICAgICAgLy8gdGhlIGVuZCwg\nbWFrZSB0aGUgY2hhbmdlcyBkaXJlY3RseSBpbiB0b2wKICAgICAgICBpZiAo\nZnJtbC5zaXplKCkgPj0gdG9sLnNpemUoKSkgewogICAgICAgICAgICBJdGVy\nYXRvciBmcm1pID0gZnJtbC5pdGVyYXRvcigpOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIHRvaSA9IHRvbC5pdGVyYXRvcigpOyB0b2kuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBpbmNvbXBh\ndGliaWxpdHksIGp1c3QgcmV0dXJuIGEgY29weSBvZiBmcm1sCiAgICAgICAg\nICAgICAgICAvLyAoaXQncyBhbHJlYWR5IGNvcGllZCBpZiB3ZSBhdHRhY2hl\nZCBpdCkKICAgICAgICAgICAgICAgIGlmICghZXF1YWxzKGZybWkubmV4dCgp\nLCB0b2kubmV4dCgpLCBwYykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIChwYykgPyBmcm1sIDogY29weUNvbGxlY3Rpb24obWFuYWdlciwgZnJtbCwg\nZm1kLCBzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGp1c3Qg\nYWRkIHRoZSBleHRyYSBlbGVtZW50cyBpbiBmcm1sIHRvIHRvbCBhbmQgcmV0\ndXJuIHRvbAogICAgICAgICAgICB3aGlsZSAoZnJtaS5oYXNOZXh0KCkpCiAg\nICAgICAgICAgICAgICB0b2wuYWRkKGZybWkubmV4dCgpKTsKICAgICAgICAg\nICAgcmV0dXJuIHRvbDsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBsaXN0\ncyBhcmUgZGlmZmVyZW50OyBqdXN0IG1ha2Ugc3VyZSBmcm1sIGlzIGNvcGll\nZCBhbmQgcmV0dXJuIGl0CiAgICAgICAgcmV0dXJuIChwYykgPyBmcm1sIDog\nY29weUNvbGxlY3Rpb24obWFuYWdlciwgZnJtbCwgZm1kLCBzbSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXBsYWNlIHRoZSBjb250ZW50cyBvZiA8Y29k\nZT50b208L2NvZGU+IHdpdGggdGhlIGNvbnRlbnRzIG9mCiAgICAgKiA8Y29k\nZT5mcm1tPC9jb2RlPi4gTmVpdGhlciBtYXAgaXMgbnVsbC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VNYXAoQXR0YWNoTWFuYWdlciBtYW5h\nZ2VyLCBNYXAgZnJtbSwgTWFwIHRvbSwKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChm\ncm1tLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoIXRvbS5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICB0b20uY2xlYXIoKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHBj\nIG1hcCwgYXR0YWNoIGFsbCBpbnN0YW5jZXMKICAgICAgICBib29sZWFuIGtl\neVBDID0gZm1kLmdldEtleSgpLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAg\nICBib29sZWFuIHZhbFBDID0gZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVk\nVHlwZVBDKCk7CiAgICAgICAgaWYgKGtleVBDIHx8IHZhbFBDKQogICAgICAg\nICAgICBmcm1tID0gYXR0YWNoTWFwKG1hbmFnZXIsIGZybW0sIHNtLCBmbWQp\nOwoKICAgICAgICAvLyBtYWtlIHN1cmUgYWxsIHRoZSBrZXlzIGluIHRoZSBm\ncm9tIG1hcCBhcmUgaW4gdGhlIHR3byBtYXAsIGFuZAogICAgICAgIC8vIHRo\nYXQgdGhleSBoYXZlIHRoZSBzYW1lIHZhbHVlcwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaSA9IGZybW0uZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5ID0gKE1hcC5F\nbnRyeSkgaS5uZXh0KCk7CiAgICAgICAgICAgIGlmICghdG9tLmNvbnRhaW5z\nS2V5KGVudHJ5LmdldEtleSgpKQogICAgICAgICAgICAgICAgfHwgIWVxdWFs\ncyh0b20uZ2V0KGVudHJ5LmdldEtleSgpKSwgZW50cnkuZ2V0VmFsdWUoKSwg\ndmFsUEMpKSB7CiAgICAgICAgICAgICAgICB0b20ucHV0KGVudHJ5LmdldEtl\neSgpLCBlbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVtb3ZlIGFueSBrZXlzIGluIHRoZSB0byBtYXAg\ndGhhdCBhcmVuJ3QgaW4gdGhlIGZyb20gbWFwCiAgICAgICAgaWYgKHRvbS5z\naXplKCkgIT0gZnJtbS5zaXplKCkpIHsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpID0gdG9tLmtleVNldCgpLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgaWYgKCEoZnJtbS5jb250YWluc0tleShp\nLm5leHQoKSkpKQogICAgICAgICAgICAgICAgICAgIGkucmVtb3ZlKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIG1hcCBhcmUg\nYXR0YWNoZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBNYXAgYXR0YWNoTWFw\nKEF0dGFjaE1hbmFnZXIgbWFuYWdlciwgTWFwIG9yaWcsCiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBNYXAgbWFwID0gY29weU1hcChtYW5hZ2VyLCBvcmlnLCBmbWQsIHNt\nKTsKICAgICAgICBpZiAobWFwID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtY29weWFibGUiLCBm\nbWQpKTsKCiAgICAgICAgVmFsdWVNZXRhRGF0YSBrZXltZCA9IGZtZC5nZXRL\nZXkoKTsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZhbG1kID0gZm1kLmdldEVs\nZW1lbnQoKTsKICAgICAgICBpZiAoIWtleW1kLmlzRGVjbGFyZWRUeXBlUEMo\nKSAmJiAhdmFsbWQuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICBy\nZXR1cm4gbWFwOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlIHRvIHJlcGxhY2Ug\na2V5cywganVzdCBjbGVhciBhbmQgcmUtYWRkOyBvdGhlcndpc2UKICAgICAg\nICAvLyB3ZSBjYW4gdXNlIHRoZSBlbnRyeSBzZXQgdG8gcmVzZXQgdGhlIHZh\nbHVlcyBvbmx5CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIGlm\nIChrZXltZC5pc0RlY2xhcmVkVHlwZVBDKCkpIHsKICAgICAgICAgICAgbWFw\nLmNsZWFyKCk7CiAgICAgICAgICAgIE9iamVjdCBrZXksIHZhbDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvcmlnLmVudHJ5U2V0KCkuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGVu\ndHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGtleSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgaWYgKGtl\neW1kLmdldENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfTk9ORSkKICAgICAgICAgICAgICAgICAgICBrZXkgPSBnZXRSZWZlcmVu\nY2UobWFuYWdlciwga2V5LCBzbSwga2V5bWQpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIGtleSA9IG1hbmFnZXIuYXR0YWNo\nKGtleSwgbnVsbCwgc20sIGtleW1kLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICB2YWwgPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgaWYg\nKHZhbG1kLmlzRGVjbGFyZWRUeXBlUEMoKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmICh2YWxtZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX05PTkUpCiAgICAgICAgICAgICAgICAgICAgICAgIHZh\nbCA9IGdldFJlZmVyZW5jZShtYW5hZ2VyLCB2YWwsIHNtLCB2YWxtZCk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICB2YWwgPSBtYW5hZ2VyLmF0dGFjaCh2YWwsIG51bGwsIHNtLCB2YWxtZCwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWFw\nLnB1dChrZXksIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBPYmplY3QgdmFsOwogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50\ncnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAodmFsbWQuZ2V0\nQ2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05F\nKQogICAgICAgICAgICAgICAgICAgIHZhbCA9IGdldFJlZmVyZW5jZShtYW5h\nZ2VyLCBlbnRyeS5nZXRWYWx1ZSgpLCBzbSwgdmFsbWQpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHZhbCA9IG1hbmFnZXIu\nYXR0YWNoKGVudHJ5LmdldFZhbHVlKCksIG51bGwsIHNtLCB2YWxtZCwgCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgICAg\nIGVudHJ5LnNldFZhbHVlKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG1hcDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgYW4gYXR0YWNoZWQgdmVyc2lvbiBvZiB0aGUgPGNvZGU+ZnJtYTwv\nY29kZT4KICAgICAqIGFycmF5IGlmIGl0IGlzIGRpZmZlcmVudCB0aGFuIDxj\nb2RlPnRvYTwvY29kZT4uIElmIHRoZSBhcnJheXMKICAgICAqIHdpbGwgYmUg\naWRlbnRpY2FsLCByZXR1cm5zIDxjb2RlPnRvYTwvY29kZT4uCiAgICAgKi8K\nICAgIHByaXZhdGUgT2JqZWN0IHJlcGxhY2VBcnJheShBdHRhY2hNYW5hZ2Vy\nIG1hbmFnZXIsIE9iamVjdCBmcm1hLAogICAgICAgIE9iamVjdCB0b2EsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICAgICAgaW50IGxlbiA9IEFycmF5LmdldExlbmd0aChmcm1hKTsKICAgICAg\nICBib29sZWFuIGRpZmYgPSB0b2EgPT0gbnVsbCB8fCBsZW4gIT0gQXJyYXku\nZ2V0TGVuZ3RoKHRvYSk7CgogICAgICAgIC8vIHBvcHVsYXRlIGFuIGFycmF5\nIGNvcHkgb24gdGhlIGluaXRpYWwgYXNzdW1wdGlvbiB0aGF0IHRoZSBhcnJh\neQogICAgICAgIC8vIGlzIGRpcnR5CiAgICAgICAgT2JqZWN0IG5ld2EgPSBB\ncnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVk\nVHlwZSgpLAogICAgICAgICAgICBsZW4pOwogICAgICAgIFZhbHVlTWV0YURh\ndGEgdm1kID0gZm1kLmdldEVsZW1lbnQoKTsKICAgICAgICBib29sZWFuIHBj\nID0gdm1kLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAgICBPYmplY3QgZWxl\nbTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAg\nICAgICAgICAgIGVsZW0gPSBBcnJheS5nZXQoZnJtYSwgaSk7CiAgICAgICAg\nICAgIGlmIChwYykgewogICAgICAgICAgICAgICAgaWYgKHZtZC5nZXRDYXNj\nYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAg\nICAgICAgICAgICAgICAgICAgZWxlbSA9IGdldFJlZmVyZW5jZShtYW5hZ2Vy\nLCBlbGVtLCBzbSwgdm1kKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICBlbGVtID0gbWFuYWdlci5hdHRhY2goZWxlbSwgbnVs\nbCwgc20sIHZtZCwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGRpZmYgPSBkaWZmIHx8ICFlcXVhbHMoZWxlbSwgQXJyYXkuZ2V0KHRvYSwg\naSksIHBjKTsKICAgICAgICAgICAgQXJyYXkuc2V0KG5ld2EsIGksIGVsZW0p\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGRpZmYpID8gbmV3YSA6IHRv\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBn\naXZlbiBvYmplY3RzIGFyZSBlcXVhbC4gUENzIGFyZSBjb21wYXJlZCBmb3IK\nICAgICAqIG9uIEpWTSBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IGEsIE9iamVjdCBiLCBib29s\nZWFuIHBjKSB7CiAgICAgICAgaWYgKGEgPT0gYikKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgaWYgKHBjIHx8IGEgPT0gbnVsbCB8fCBiID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQlyZXR1cm4gYS5l\ncXVhbHMgKGIpOwoJfQp9Cg==\n","encoding":"base64"}

