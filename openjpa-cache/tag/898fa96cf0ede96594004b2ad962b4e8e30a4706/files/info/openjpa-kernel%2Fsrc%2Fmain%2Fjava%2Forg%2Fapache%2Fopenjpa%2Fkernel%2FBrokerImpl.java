{"sha":"f9d59a05fbad0fad12d86218f1a40d7616f80e18","node_id":"MDQ6QmxvYjIwNjM2NDpmOWQ1OWEwNWZiYWQwZmFkMTJkODYyMThmMWE0MGQ3NjE2ZjgwZTE4","size":168170,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f9d59a05fbad0fad12d86218f1a40d7616f80e18","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5sb2Nrcy5SZWVudHJhbnRMb2NrOwoKaW1w\nb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN0YXR1czsKaW1wb3J0IGphdmF4LnRy\nYW5zYWN0aW9uLlN5bmNocm9uaXphdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMuY29sbGVjdGlvbnMuaXRlcmF0b3JzLkl0ZXJhdG9yQ2hhaW47\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLklk\nZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLm1hcC5MaW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nY29sbGVjdGlvbnMuc2V0Lk1hcEJhY2tlZFNldDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVlLk1hbmFnZWRSdW50aW1lOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2Fw\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxl\nY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5\nY2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlm\nZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlvbkV2ZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5zYWN0aW9uRXZlbnRNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4\ncHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNldDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VNYXA7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJh\ndGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGlj\nYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DYWxs\nYmFja0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5H\nZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuTm9UcmFuc2FjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdEV4aXN0c0V4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVu\nSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nT3B0aW1pc3RpY0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5XcmFwcGVkRXhjZXB0\naW9uOwoKLyoqCiAqIENvbmNyZXRlIHtAbGluayBCcm9rZXJ9LiBUaGUgYnJv\na2VyIGhhbmRsZXMgb2JqZWN0LWxldmVsIGJlaGF2aW9yLAogKiBidXQgbGVh\ndmVzIGFsbCBpbnRlcmFjdGlvbiB3aXRoIHRoZSBkYXRhIHN0b3JlIHRvIGEg\ne0BsaW5rIFN0b3JlTWFuYWdlcn0KICogdGhhdCBtdXN0IGJlIHN1cHBsaWVk\nIGF0IGluaXRpYWxpemF0aW9uLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQog\nKi8KQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCnB1YmxpYyBjbGFzcyBC\ncm9rZXJJbXBsCiAgICBpbXBsZW1lbnRzIEJyb2tlciwgRmluZENhbGxiYWNr\ncywgQ2xvbmVhYmxlLCBTZXJpYWxpemFibGUgewoKICAgIC8qKgogICAgICog\nSW5jcmVtZW50YWwgZmx1c2guCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0\naWMgZmluYWwgaW50IEZMVVNIX0lOQyA9IDA7CgogICAgLyoqCiAgICAgKiBG\nbHVzaCBpbiBwcmVwYXJhdGlvbiBvZiBjb21taXQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZMVVNIX0NPTU1JVCA9IDE7Cgog\nICAgLyoqCiAgICAgKiBGbHVzaCB0byBjaGVjayBjb25zaXN0ZW5jeSBvZiBj\nYWNoZSwgdGhlbiBpbW1lZGlhdGVseSByb2xsYmFjayBjaGFuZ2VzLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9ST0xM\nQkFDSyA9IDI7CgogICAgLyoqCiAgICAgKiBSdW4gcGVyc2lzdGVuY2UtYnkt\ncmVhY2hhYmlsaXR5IGFuZCBvdGhlciBmbHVzaC10aW1lIG9wZXJhdGlvbnMg\nd2l0aG91dAogICAgICogYWNjZXNzaW5nIHRoZSBkYXRhYmFzZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfTE9HSUNB\nTCA9IDM7CgogICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfSU5JVCA9IDA7\nCiAgICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19UUkFOU0lFTlQgPSAxOwog\nICAgc3RhdGljIGZpbmFsIGludCBTVEFUVVNfT0lEX0FTU0lHTiA9IDI7CiAg\nICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19DT01NSVRfTkVXID0gMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19BQ1RJVkUgPSAyIDw8\nIDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9B\nQ1RJVkUgPSAyIDw8IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nRkxBR19DTE9TRV9JTlZPS0VEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfUFJFU1RPUklORyA9IDIgPDwgMzsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RFUkVGREVMRVRJTkcgPSAy\nIDw8IDQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVT\nSElORyA9IDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1NUT1JFX0ZMVVNISU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfRkxVU0hFRCA9IDIgPDwgNzsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVNT1RF\nX0xJU1RFTkVSID0gMiA8PCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfUkVUQUlORURfQ09OTiA9IDIgPDwgMTA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDEx\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdFtdIEVNUFRZX09C\nSkVDVFMgPSBuZXcgT2JqZWN0WzBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShCcm9rZXJJbXBsLmNsYXNzKTsKCiAgICAvLwl0aGUgc3RvcmUgbWFu\nYWdlciBpbiB1c2U7IHRoaXMgbWF5IGJlIGEgZGVjb3JhdG9yIHN1Y2ggYXMg\nYQogICAgLy8JZGF0YSBjYWNoZSBzdG9yZSBtYW5hZ2VyIGFyb3VuZCB0aGUg\nbmF0aXZlIHN0b3JlIG1hbmFnZXIKICAgIHByaXZhdGUgdHJhbnNpZW50IERl\nbGVnYXRpbmdTdG9yZU1hbmFnZXIgX3N0b3JlID0gbnVsbDsKCiAgICBwcml2\nYXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMgPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJpbmcgX3VzZXIgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3Bh\nc3MgPSBudWxsOwoKICAgIC8vIHRoZXNlIG11c3QgYmUgcmVidWlsdCBieSB0\naGUgZmFjYWRlIGxheWVyIGR1cmluZyBpdHMgZGVzZXJpYWxpemF0aW9uCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBMb2cgX2xvZyA9IG51bGw7CiAgICBwcml2\nYXRlIHRyYW5zaWVudCBDb21wYXRpYmlsaXR5IF9jb21wYXQgPSBudWxsOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFuYWdlZFJ1bnRpbWUgX3J1bnRpbWUg\nPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9ja01hbmFnZXIgX2xt\nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IEludmVyc2VNYW5hZ2Vy\nIF9pbSA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBSZWVudHJhbnRM\nb2NrIF9sb2NrID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IE9wQ2Fs\nbGJhY2tzIF9jYWxsID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFJ1\nbnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yIF9leHRyYW5zID0gbnVsbDsKCiAg\nICAvLyByZWYgdG8gcHJvZHVjaW5nIGZhY3RvcnkgYW5kIGNvbmZpZ3VyYXRp\nb24KICAgIHByaXZhdGUgdHJhbnNpZW50IEFic3RyYWN0QnJva2VyRmFjdG9y\neSBfZmFjdG9yeSA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CgogICAgLy8gY2FjaGUg\nY2xhc3MgbG9hZGVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgYnJva2VyCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsK\nCiAgICAvLyB1c2VyIHN0YXRlCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlv\nbiBfc3luYyA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfdXNlck9iamVjdHMg\nPSBudWxsOwoKICAgIC8vIG1hbmFnZWQgb2JqZWN0IGNhY2hlcwogICAgcHJp\ndmF0ZSBNYW5hZ2VkQ2FjaGUgX2NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUg\nVHJhbnNhY3Rpb25hbENhY2hlIF90cmFuc0NhY2hlID0gbnVsbDsKICAgIHBy\naXZhdGUgU2V0IF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldCBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVy\nZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgIC8vIHRoZXNlIGFyZSB1c2VkIGZv\nciBtZXRob2QtaW50ZXJuYWwgc3RhdGUgb25seQogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgTWFwIF9sb2FkaW5nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNp\nZW50IFNldCBfb3BlcmF0aW5nID0gbnVsbDsKCiAgICBwcml2YXRlIFNldCBf\ncGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfdXBkYXRl\nZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX2RlbGV0ZWRDbHNzID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZW5kaW5nID0gbnVsbDsKICAgIHBy\naXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAgLy8gdHJhY2sgaW5z\ndGFuY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwgYWZ0ZXIgdGhlIGZp\ncnN0IHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRoZSB0cmFu\nc2FjdGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQgX3NhdmVwb2ludENh\nY2hlID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2VkTWFwIF9zYXZlcG9pbnRz\nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFNhdmVwb2ludE1hbmFn\nZXIgX3NwbSA9IG51bGw7CgogICAgLy8gdHJhY2sgb3BlbiBxdWVyaWVzIGFu\nZCBleHRlbnRzIHNvIHdlIGNhbiBmcmVlIHRoZWlyIHJlc291cmNlcyBvbiBj\nbG9zZQogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVmZXJlbmNlSGFzaFNldCBf\ncXVlcmllcyA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBSZWZlcmVu\nY2VIYXNoU2V0IF9leHRlbnRzID0gbnVsbDsKCiAgICAvLyB0cmFjayBvcGVy\nYXRpb24gc3RhY2sgZGVwdGguIFRyYW5zaWVudCBiZWNhdXNlIG9wZXJhdGlv\nbnMgY2Fubm90CiAgICAvLyBzcGFuIHNlcmlhbGl6YXRpb24uCiAgICBwcml2\nYXRlIHRyYW5zaWVudCBpbnQgX29wZXJhdGlvbkNvdW50ID0gMDsKCiAgICAv\nLyBvcHRpb25zCiAgICBwcml2YXRlIGJvb2xlYW4gX25vbnRyYW5zUmVhZCA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1dyaXRlID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3JldGFpblN0YXRlID0gZmFs\nc2U7CiAgICBwcml2YXRlIGludCBfYXV0b0NsZWFyID0gQ0xFQVJfREFUQVNU\nT1JFOwogICAgcHJpdmF0ZSBpbnQgX3Jlc3RvcmVTdGF0ZSA9IFJFU1RPUkVf\nSU1NVVRBQkxFOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcHRpbWlzdGljID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2lnbm9yZUNoYW5nZXMgPSBm\nYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9tYW5hZ2VkID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX3N5bmNNYW5hZ2VkID0gZmFsc2U7CiAgICBw\ncml2YXRlIGludCBfY29ublJldGFpbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1B\nTkQ7CiAgICBwcml2YXRlIGJvb2xlYW4gX2V2aWN0RGF0YUNhY2hlID0gZmFs\nc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3BvcHVsYXRlRGF0YUNhY2hlID0g\ndHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBpbnQgX2F1dG9EZXRhY2ggPSAwOwogICAg\ncHJpdmF0ZSBpbnQgX2RldGFjaFN0YXRlID0gREVUQUNIX0xPQURFRDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfZGV0YWNoZWROZXcgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9vcmRlckRpcnR5ID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2NhY2hlUHJlcGFyZWRRdWVyeSA9IHRydWU7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2NhY2hlRmluZGVyUXVlcnkgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9zdXBwcmVzc0JhdGNoT0xFTG9nZ2luZyA9IGZhbHNl\nOwoKICAgIC8vIHN0YXR1cwogICAgcHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsK\nCiAgICAvLyB0aGlzIGlzIG5vdCBpbiBzdGF0dXMgYmVjYXVzZSBpdCBzaG91\nbGQgbm90IGJlIHNlcmlhbGl6ZWQKICAgIHByaXZhdGUgdHJhbnNpZW50IGJv\nb2xlYW4gX2lzU2VyaWFsaXppbmcgPSBmYWxzZTsKCiAgICAvLyB0cmFuc2ll\nbnQgYmVjYXVzZSBjbG9zZWQgYnJva2VycyBjYW4ndCBiZSBzZXJpYWxpemVk\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9jbG9zZWQgPSBmYWxz\nZTsKICAgIHByaXZhdGUgdHJhbnNpZW50IFJ1bnRpbWVFeGNlcHRpb24gX2Ns\nb3NlZEV4Y2VwdGlvbiA9IG51bGw7CgogICAgLy8gZXZlbnQgbWFuYWdlcnMK\nICAgIHByaXZhdGUgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIgX3RyYW5zRXZl\nbnRNYW5hZ2VyID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF90cmFuc0NhbGxi\nYWNrTW9kZSA9IDA7CiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFuYWdl\nciBfbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGludCBf\nbGlmZUNhbGxiYWNrTW9kZSA9IDA7CgogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nYm9vbGVhbiBfaW5pdGlhbGl6ZVdhc0ludm9rZWQgPSBmYWxzZTsKICAgIHBy\naXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2Zyb21Xcml0ZUJlaGluZENhbGxi\nYWNrID0gZmFsc2U7CiAgICBwcml2YXRlIExpbmtlZExpc3QgX2ZjczsKICAg\nIAogICAgLy8gU2V0IG9mIHN1cHBvcnRlZCBwcm9wZXJ0eSBrZXlzLiBUaGUg\na2V5cyBpbiB0aGlzIHNldCBjb3JyZXNwb25kIHRvIGJlYW4tc3R5bGUgc2V0\ndGVyIG1ldGhvZHMKICAgIC8vIHRoYXQgY2FuIGJlIHNldCBieSByZWZsZWN0\naW9uLiBUaGUga2V5cyBhcmUgbm90IHF1YWxpZmllZCBieSBhbnkgcHJlZml4\nLgogICAgcHJpdmF0ZSBzdGF0aWMgU2V0PFN0cmluZz4gX3N1cHBvcnRlZFBy\nb3BlcnR5TmFtZXM7CiAgICBzdGF0aWMgewogICAgICAgIF9zdXBwb3J0ZWRQ\ncm9wZXJ0eU5hbWVzID0gbmV3IEhhc2hTZXQ8U3RyaW5nPigpOwogICAgICAg\nIF9zdXBwb3J0ZWRQcm9wZXJ0eU5hbWVzLmFkZEFsbChBcnJheXMuYXNMaXN0\nKG5ldyBTdHJpbmdbXSB7CiAgICAgICAgICAgICAgICAiQXV0b0NsZWFyIiwg\nCiAgICAgICAgICAgICAgICAiQXV0b0RldGFjaCIsIAogICAgICAgICAgICAg\nICAgIkNhY2hlRmluZGVyUXVlcnkiLCAKICAgICAgICAgICAgICAgICJDYWNo\nZVByZXBhcmVkUXVlcnkiLCAKICAgICAgICAgICAgICAgICJEZXRhY2hlZE5l\ndyIsIAogICAgICAgICAgICAgICAgIkRldGFjaFN0YXRlIiwgCiAgICAgICAg\nICAgICAgICAiRXZpY3RGcm9tRGF0YUNhY2hlIiwgCiAgICAgICAgICAgICAg\nICAiSWdub3JlQ2hhbmdlcyIsIAogICAgICAgICAgICAgICAgIkxpZmVjeWNs\nZUxpc3RlbmVyQ2FsbGJhY2tNb2RlIiwgCiAgICAgICAgICAgICAgICAiTXVs\ndGl0aHJlYWRlZCIsIAogICAgICAgICAgICAgICAgIk5vbnRyYW5zYWN0aW9u\nYWxSZWFkIiwgCiAgICAgICAgICAgICAgICAiTm9udHJhbnNhY3Rpb25hbFdy\naXRlIiwgCiAgICAgICAgICAgICAgICAiT3B0aW1pc3RpYyIsIAogICAgICAg\nICAgICAgICAgIlBvcHVsYXRlRGF0YUNhY2hlIiwKICAgICAgICAgICAgICAg\nICJSZXN0b3JlU3RhdGUiLCAKICAgICAgICAgICAgICAgICJSZXRhaW5TdGF0\nZSIsCiAgICAgICAgICAgICAgICB9KSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIncyBhdXRoZW50aWNhdGlv\nbi4gVGhpcyBpcyB0aGUgZmlyc3QKICAgICAqIG1ldGhvZCBjYWxsZWQgYWZ0\nZXIgY29uc3RydWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB1c2VyIHRo\nZSB1c2VybmFtZSB0aGlzIGJyb2tlciByZXByZXNlbnRzOyB1c2VkIHdoZW4g\ncG9vbGluZwogICAgICogYnJva2VycyB0byBtYWtlIHN1cmUgdGhhdCBhIHJl\ncXVlc3QgdG8gdGhlIGZhY3RvcnkgZm9yCiAgICAgKiBhIGNvbm5lY3Rpb24g\nd2l0aCBhbiBleHBsaWNpdCB1c2VyIGlzIGRlbGVnYXRlZCB0byBhIHN1aXRh\nYmxlIGJyb2tlcgogICAgICogQHBhcmFtIHBhc3MgdGhlIHBhc3N3b3JkIGZv\nciB0aGUgYWJvdmUgdXNlcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRB\ndXRoZW50aWNhdGlvbihTdHJpbmcgdXNlciwgU3RyaW5nIHBhc3MpIHsKICAg\nICAgICBfdXNlciA9IHVzZXI7CiAgICAgICAgX3Bhc3MgPSBwYXNzOwogICAg\nfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSB0aGUgcGVyc2lzdGVuY2Ug\nbWFuYWdlci4gVGhpcyBtZXRob2QgaXMgY2FsbGVkCiAgICAgKiBhdXRvbWF0\naWNhbGx5IGJ5IHRoZSBmYWN0b3J5IGJlZm9yZSB1c2UuCiAgICAgKgogICAg\nICogQHBhcmFtIGZhY3RvcnkgdGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUg\ndGhpcyBicm9rZXIKICAgICAqIEBwYXJhbSBzbSBhIGNvbmNyZXRlIFN0b3Jl\nTWFuYWdlciBpbXBsZW1lbnRhdGlvbiB0bwogICAgICogaGFuZGxlIGludGVy\nYWN0aW9uIHdpdGggdGhlIGRhdGEgc3RvcmUKICAgICAqIEBwYXJhbSBtYW5h\nZ2VkIHRoZSB0cmFuc2FjdGlvbiBtb2RlCiAgICAgKiBAcGFyYW0gY29ubk1v\nZGUgdGhlIGNvbm5lY3Rpb24gcmV0YWluIG1vZGUKICAgICAqIEBwYXJhbSBm\ncm9tRGVzZXJpYWxpemF0aW9uIHdoZXRoZXIgdGhpcyBjYWxsIGhhcHBlbmVk\nIGJlY2F1c2Ugb2YgYQogICAgICogZGVzZXJpYWxpemF0aW9uIG9yIGNyZWF0\naW9uIG9mIGEgbmV3IEJyb2tlckltcGwuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGluaXRpYWxpemUoQWJzdHJhY3RCcm9rZXJGYWN0b3J5IGZhY3Rvcnks\nCiAgICAgICAgRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBzbSwgYm9vbGVhbiBt\nYW5hZ2VkLCBpbnQgY29ubk1vZGUsCiAgICAgICAgYm9vbGVhbiBmcm9tRGVz\nZXJpYWxpemF0aW9uKSB7CiAgICAgICAgaW5pdGlhbGl6ZShmYWN0b3J5LCBz\nbSwgbWFuYWdlZCwgY29ubk1vZGUsIGZyb21EZXNlcmlhbGl6YXRpb24sIGZh\nbHNlKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZShB\nYnN0cmFjdEJyb2tlckZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBEZWxlZ2F0\naW5nU3RvcmVNYW5hZ2VyIHNtLCBib29sZWFuIG1hbmFnZWQsIGludCBjb25u\nTW9kZSwKICAgICAgICBib29sZWFuIGZyb21EZXNlcmlhbGl6YXRpb24sIGJv\nb2xlYW4gZnJvbVdyaXRlQmVoaW5kQ2FsbGJhY2spIHsKICAgICAgICBfZnJv\nbVdyaXRlQmVoaW5kQ2FsbGJhY2sgPSBmcm9tV3JpdGVCZWhpbmRDYWxsYmFj\nazsKICAgICAgICBfaW5pdGlhbGl6ZVdhc0ludm9rZWQgPSB0cnVlOwogICAg\nICAgIF9sb2FkZXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q29udGV4dENsYXNzTG9h\nZGVyQWN0aW9uKCkpOwogICAgICAgIGlmICghZnJvbURlc2VyaWFsaXphdGlv\nbikKICAgICAgICAgICAgX2NvbmYgPSBmYWN0b3J5LmdldENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBfY29tcGF0ID0gX2NvbmYuZ2V0Q29tcGF0aWJpbGl0\neUluc3RhbmNlKCk7CiAgICAgICAgX2ZhY3RvcnkgPSBmYWN0b3J5OwogICAg\nICAgIF9sb2cgPSBfY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nTE9HX1JVTlRJTUUpOwogICAgICAgIGlmICghZnJvbURlc2VyaWFsaXphdGlv\nbikKICAgICAgICAgICAgX2NhY2hlID0gbmV3IE1hbmFnZWRDYWNoZSh0aGlz\nKTsKICAgICAgICBpbml0aWFsaXplT3BlcmF0aW5nU2V0KCk7CiAgICAgICAg\nX2Nvbm5SZXRhaW5Nb2RlID0gY29ubk1vZGU7CiAgICAgICAgX21hbmFnZWQg\nPSBtYW5hZ2VkOwogICAgICAgIGlmIChtYW5hZ2VkKQogICAgICAgICAgICBf\ncnVudGltZSA9IF9jb25mLmdldE1hbmFnZWRSdW50aW1lSW5zdGFuY2UoKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9ydW50aW1lID0gbmV3IExvY2Fs\nTWFuYWdlZFJ1bnRpbWUodGhpcyk7CgogICAgICAgIGlmICghZnJvbURlc2Vy\naWFsaXphdGlvbikgewogICAgICAgICAgICBfbGlmZUV2ZW50TWFuYWdlciA9\nIF9jb25mLmdldExpZmVjeWNsZUV2ZW50TWFuYWdlckluc3RhbmNlKCk7CiAg\nICAgICAgICAgIF90cmFuc0V2ZW50TWFuYWdlciA9IG5ldyBUcmFuc2FjdGlv\nbkV2ZW50TWFuYWdlcigpOwogICAgICAgICAgICBpbnQgY21vZGUgPSBfY29u\nZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAg\nICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS5nZXRD\nYWxsYmFja01vZGUoKTsKICAgICAgICAgICAgc2V0TGlmZWN5Y2xlTGlzdGVu\nZXJDYWxsYmFja01vZGUoY21vZGUpOwogICAgICAgICAgICBzZXRUcmFuc2Fj\ndGlvbkxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2RlKTsKCiAgICAgICAgICAg\nIC8vIHNldHVwIGRlZmF1bHQgb3B0aW9ucwogICAgICAgICAgICBfZmFjdG9y\neS5jb25maWd1cmVCcm9rZXIodGhpcyk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBtYWtlIHN1cmUgdG8gZG8gdGhpcyBhZnRlciBjb25maWd1cmluZyBicm9r\nZXIgc28gdGhhdCBzdG9yZSBtYW5hZ2VyCiAgICAgICAgLy8gY2FuIGxvb2sg\ndG8gYnJva2VyIGNvbmZpZ3VyYXRpb247IHdlIHNldCBib3RoIHN0b3JlIGFu\nZCBsb2NrIG1hbmFnZXJzCiAgICAgICAgLy8gYmVmb3JlIGluaXRpYWxpemlu\nZyB0aGVtIGJlY2F1c2UgdGhleSBtYXkgZWFjaCB0cnkgdG8gYWNjZXNzIHRo\nZQogICAgICAgIC8vIG90aGVyIGluIHRoZWlyIGluaXRpYWxpemF0aW9uCiAg\nICAgICAgX3N0b3JlID0gc207CiAgICAgICAgX2xtID0gX2NvbmYubmV3TG9j\na01hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9pbSA9IF9jb25mLm5ld0lu\ndmVyc2VNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfc3BtID0gX2NvbmYu\nZ2V0U2F2ZXBvaW50TWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX3N0b3Jl\nLnNldENvbnRleHQodGhpcyk7CiAgICAgICAgX2xtLnNldENvbnRleHQodGhp\ncyk7CgogICAgICAgIGlmIChfY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRB\nSU5fQUxXQVlTKQogICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAg\nICAgICAgaWYgKCFmcm9tRGVzZXJpYWxpemF0aW9uKSB7CiAgICAgICAgICAg\nIF9mYyA9IF9zdG9yZS5uZXdGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICAgICAgX2ZjLnNldENvbnRleHQodGhpcyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBzeW5jaCB3aXRoIHRoZSBnbG9iYWwgdHJhbnNhY3Rpb24gaW4gcHJv\nZ3Jlc3MsIGlmIGFueQogICAgICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1h\nbmFnZWRUcmFuc2FjdGlvbih0aGlzLCBmYWxzZSkpCiAgICAgICAgICAgIGJl\nZ2luSW50ZXJuYWwoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5pdGlh\nbGl6ZU9wZXJhdGluZ1NldCgpIHsKICAgICAgICBfb3BlcmF0aW5nID0gTWFw\nQmFja2VkU2V0LmRlY29yYXRlKG5ldyBJZGVudGl0eU1hcCgpKTsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSB1bm1vZGlmaWFibGUgc2V0\nIG9mIGluc3RhbmNlcyBiZWluZyBvcGVyYXRlZC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFNldCBnZXRPcGVyYXRpbmdTZXQoKSB7CiAgICAJcmV0dXJuIENv\nbGxlY3Rpb25zLnVubW9kaWZpYWJsZVNldChfb3BlcmF0aW5nKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkKICAgICAgICB0aHJvd3MgQ2xv\nbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGlmIChfaW5pdGlh\nbGl6ZVdhc0ludm9rZWQpCiAgICAgICAgICAgIHRocm93IG5ldyBDbG9uZU5v\ndFN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICByZXR1cm4gc3VwZXIuY2xvbmUoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSB7QGxpbmsgTWFwfSB0byBiZSB1c2Vk\nIGZvciB0aGUgcHJpbWFyeSBtYW5hZ2VkIG9iamVjdCBjYWNoZS4KICAgICAq\nIE1hcHMgb2lkcyB0byBzdGF0ZSBtYW5hZ2Vycy4gQnkgZGVmYXVsdCwgdGhp\ncyBjcmVhdGVzIGEKICAgICAqIHtAbGluayBSZWZlcmVuY2VNYXB9IHdpdGgg\nc29mdCB2YWx1ZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBNYXAgbmV3TWFu\nYWdlZE9iamVjdENhY2hlKCkgewogICAgICAgIHJldHVybiBuZXcgUmVmZXJl\nbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAuSEFSRCwgUmVmZXJlbmNlTWFwLlNP\nRlQpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIFN0b3JlQ29udGV4dAog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiB0aGlz\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcm9wZXJ0aWVz\nCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNldEltcGxp\nY2l0QmVoYXZpb3IoT3BDYWxsYmFja3MgY2FsbCwKICAgICAgICBSdW50aW1l\nRXhjZXB0aW9uVHJhbnNsYXRvciBleCkgewogICAgICAgIGlmIChfY2FsbCA9\nPSBudWxsKQogICAgICAgICAgICBfY2FsbCA9IGNhbGw7CiAgICAgICAgaWYg\nKF9leHRyYW5zID09IG51bGwpCiAgICAgICAgICAgIF9leHRyYW5zID0gZXg7\nCiAgICB9CgogICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgZ2V0SW5z\ndGFuY2VFeGNlcHRpb25UcmFuc2xhdG9yKCkgewogICAgICAgIHJldHVybiAo\nX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4dHJhbnMgOiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5IGdldEJyb2tlckZhY3Rvcnko\nKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5OwogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewog\nICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gcHVzaEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAgICBpZiAo\nX2ZjcyA9PSBudWxsKQogICAgICAgICAgICBfZmNzID0gbmV3IExpbmtlZExp\nc3QoKTsKICAgICAgICBfZmNzLmFkZChfZmMpOwogICAgICAgIF9mYyA9IChG\nZXRjaENvbmZpZ3VyYXRpb24pIF9mYy5jbG9uZSgpOwogICAgICAgIHJldHVy\nbiBfZmM7CiAgICB9CgogICAgcHVibGljIHZvaWQgcG9wRmV0Y2hDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIGlmIChfZmNzID09IG51bGwgfHwgX2Zjcy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJmZXRjaC1jb25maWd1\ncmF0aW9uLXN0YWNrLWVtcHR5IikpOwogICAgICAgIF9mYyA9IChGZXRjaENv\nbmZpZ3VyYXRpb24pIF9mY3MucmVtb3ZlTGFzdCgpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0Q29ubmVjdGlvblJldGFpbk1vZGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9jb25uUmV0YWluTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc01hbmFnZWQoKSB7CiAgICAgICAgcmV0dXJuIF9tYW5hZ2VkOwog\nICAgfQoKICAgIHB1YmxpYyBNYW5hZ2VkUnVudGltZSBnZXRNYW5hZ2VkUnVu\ndGltZSgpIHsKICAgICAgICByZXR1cm4gX3J1bnRpbWU7CiAgICB9CgogICAg\ncHVibGljIENsYXNzTG9hZGVyIGdldENsYXNzTG9hZGVyKCkgewogICAgICAg\nIHJldHVybiBfbG9hZGVyOwogICAgfQoKICAgIHB1YmxpYyBEZWxlZ2F0aW5n\nU3RvcmVNYW5hZ2VyIGdldFN0b3JlTWFuYWdlcigpIHsKICAgICAgICByZXR1\ncm4gX3N0b3JlOwogICAgfQoKICAgIHB1YmxpYyBMb2NrTWFuYWdlciBnZXRM\nb2NrTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX2xtOwogICAgfQoKICAg\nIHB1YmxpYyBJbnZlcnNlTWFuYWdlciBnZXRJbnZlcnNlTWFuYWdlcigpIHsK\nICAgICAgICByZXR1cm4gX2ltOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q29ubmVjdGlvblVzZXJOYW1lKCkgewogICAgICAgIHJldHVybiBfdXNl\ncjsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbm5lY3Rpb25QYXNz\nd29yZCgpIHsKICAgICAgICByZXR1cm4gX3Bhc3M7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0TXVsdGl0aHJlYWRlZCgpIHsKICAgICAgICByZXR1\ncm4gX211bHRpdGhyZWFkZWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nTXVsdGl0aHJlYWRlZChib29sZWFuIG11bHRpdGhyZWFkZWQpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX211bHRpdGhyZWFkZWQgPSBtdWx0\naXRocmVhZGVkOwogICAgICAgIGlmIChtdWx0aXRocmVhZGVkICYmIF9sb2Nr\nID09IG51bGwpCiAgICAgICAgICAgIF9sb2NrID0gbmV3IFJlZW50cmFudExv\nY2soKTsKICAgICAgICBlbHNlIGlmICghbXVsdGl0aHJlYWRlZCkKICAgICAg\nICAgICAgX2xvY2sgPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGdldElnbm9yZUNoYW5nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pZ25vcmVD\naGFuZ2VzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldElnbm9yZUNoYW5n\nZXMoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgX2lnbm9yZUNoYW5nZXMgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gZ2V0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9ub250cmFuc1JlYWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nTm9udHJhbnNhY3Rpb25hbFJlYWQoYm9vbGVhbiB2YWwpIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNU\nT1JJTkcpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJpbGxlZ2FsLW9wLWluLXByZXN0b3JlIikpOwoKICAg\nICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAg\nICAgICBpZiAodmFsICYmICFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29u\ndGFpbnMKICAgICAgICAgICAgKF9jb25mLk9QVElPTl9OT05UUkFOU19SRUFE\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoIm5vbnRyYW5zLXJlYWQtbm90\nLXN1cHBvcnRlZCIpKTsKCiAgICAgICAgX25vbnRyYW5zUmVhZCA9IHZhbDsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFs\nV3JpdGUoKSB7CiAgICAgICAgcmV0dXJuIF9ub250cmFuc1dyaXRlOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldE5vbnRyYW5zYWN0aW9uYWxXcml0ZShi\nb29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwt\nb3AtaW4tcHJlc3RvcmUiKSk7CgogICAgICAgIF9ub250cmFuc1dyaXRlID0g\ndmFsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldE9wdGltaXN0aWMo\nKSB7CiAgICAgICAgcmV0dXJuIF9vcHRpbWlzdGljOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldE9wdGltaXN0aWMoYm9vbGVhbiB2YWwpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgidHJhbnMtYWN0aXZlIiwKICAgICAgICAg\nICAgICAgICJPcHRpbWlzdGljIikpOwoKICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAgICBpZiAodmFsICYmICFf\nY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoX2NvbmYuT1BUSU9O\nX09QVElNSVNUSUMpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgib3B0aW1p\nc3RpYy1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICBfb3B0aW1pc3RpYyA9\nIHZhbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFJlc3RvcmVTdGF0ZSgp\nIHsKICAgICAgICByZXR1cm4gX3Jlc3RvcmVTdGF0ZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRSZXN0b3JlU3RhdGUoaW50IHZhbCkgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAg\nICAgICAgIlJlc3RvcmUiKSk7CgogICAgICAgIF9yZXN0b3JlU3RhdGUgPSB2\nYWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0UmV0YWluU3RhdGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9yZXRhaW5TdGF0ZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRSZXRhaW5TdGF0ZShib29sZWFuIHZhbCkgewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nUFJFU1RPUklORykgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwtb3AtaW4tcHJlc3RvcmUiKSk7\nCiAgICAgICAgX3JldGFpblN0YXRlID0gdmFsOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgZ2V0QXV0b0NsZWFyKCkgewogICAgICAgIHJldHVybiBfYXV0b0Ns\nZWFyOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9DbGVhcihpbnQg\ndmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9hdXRvQ2xl\nYXIgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRBdXRvRGV0YWNo\nKCkgewogICAgICAgIHJldHVybiBfYXV0b0RldGFjaDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRBdXRvRGV0YWNoKGludCBkZXRhY2hGbGFncykgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfYXV0b0RldGFjaCA9IGRl\ndGFjaEZsYWdzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EZXRh\nY2goaW50IGRldGFjaEZsYWcsIGJvb2xlYW4gb24pIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgaWYgKG9uKQogICAgICAgICAgICBfYXV0b0Rl\ndGFjaCB8PSBkZXRhY2hGbGFnOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX2F1dG9EZXRhY2ggJj0gfmRldGFjaEZsYWc7CiAgICB9CgogICAgcHVibGlj\nIGludCBnZXREZXRhY2hTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gX2RldGFj\naFN0YXRlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldERldGFjaFN0YXRl\nKGludCBtb2RlKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9k\nZXRhY2hTdGF0ZSA9IG1vZGU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNEZXRhY2hlZE5ldygpIHsKICAgICAgICByZXR1cm4gX2RldGFjaGVkTmV3\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldERldGFjaGVkTmV3KGJvb2xl\nYW4gaXNOZXcpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2Rl\ndGFjaGVkTmV3ID0gaXNOZXc7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nZ2V0U3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb25zKCkgewogICAgICAgIHJl\ndHVybiBfc3luY01hbmFnZWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nU3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb25zKGJvb2xlYW4gc3luYykgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfc3luY01hbmFnZWQgPSBz\neW5jOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldEV2aWN0RnJvbURh\ndGFDYWNoZSgpIHsKICAgICAgICByZXR1cm4gX2V2aWN0RGF0YUNhY2hlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEV2aWN0RnJvbURhdGFDYWNoZShi\nb29sZWFuIGV2aWN0KSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nIF9ldmljdERhdGFDYWNoZSA9IGV2aWN0OwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldFBvcHVsYXRlRGF0YUNhY2hlKCkgewogICAgICAgIHJldHVy\nbiBfcG9wdWxhdGVEYXRhQ2FjaGU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0UG9wdWxhdGVEYXRhQ2FjaGUoYm9vbGVhbiBjYWNoZSkgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBfcG9wdWxhdGVEYXRhQ2FjaGUgPSBj\nYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1RyYWNrQ2hhbmdl\nc0J5VHlwZSgpIHsKICAgICAgICByZXR1cm4gX2xhcmdlVHJhbnNhY3Rpb247\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJhY2tDaGFuZ2VzQnlUeXBl\nKGJvb2xlYW4gbGFyZ2VUcmFuc2FjdGlvbikgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBfbGFyZ2VUcmFuc2FjdGlvbiA9IGxhcmdlVHJhbnNh\nY3Rpb247CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRVc2VyT2JqZWN0\nKE9iamVjdCBrZXkpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChfdXNlck9iamVj\ndHMgPT0gbnVsbCkgPyBudWxsIDogX3VzZXJPYmplY3RzLmdldChrZXkpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHB1dFVzZXJP\nYmplY3QoT2JqZWN0IGtleSwgT2JqZWN0IHZhbCkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAodmFsID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gKF91c2Vy\nT2JqZWN0cyA9PSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMucmVtb3Zl\nKGtleSk7CgogICAgICAgICAgICBpZiAoX3VzZXJPYmplY3RzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBfdXNlck9iamVjdHMgPSBuZXcgSGFzaE1hcCgp\nOwogICAgICAgICAgICByZXR1cm4gX3VzZXJPYmplY3RzLnB1dChrZXksIHZh\nbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2V0IGN1\ncnJlbnQgY29uZmlndXJhdGlvbiBwcm9wZXJ0eSB2YWx1ZXMgdXNlZCBieSB0\naGlzIGluc3RhbmNlLgogICAgICogVGhpcyB2YWx1ZXMgYXJlIGNvbWJpbmF0\naW9uIG9mIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gdmFsdWVzIAogICAg\nICogb3ZlcndyaXR0ZW4gYnkgdmFsdWVzIG1haW50YWluZWQgYnkgdGhpcyBp\nbnN0YW5jZSBzdWNoIGFzCiAgICAgKiBPcHRpbWlzdGljIGZsYWcuIAogICAg\nICovCiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2JqZWN0PiBnZXRQcm9wZXJ0\naWVzKCkgewogICAgICAgIE1hcCBwcm9wcyA9IF9jb25mLnRvUHJvcGVydGll\ncyh0cnVlKTsKICAgICAgICBmb3IgKFN0cmluZyBzIDogX3N1cHBvcnRlZFBy\nb3BlcnR5TmFtZXMpIHsKICAgICAgICAgICAgcHJvcHMucHV0KCJvcGVuanBh\nLiIgKyBzLCBSZWZsZWN0aW9uLmdldFZhbHVlKHRoaXMsIHMsIHRydWUpKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb3BzOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIEdldHMgdGhlIHByb3BlcnR5IG5hbWVzIHRoYXQgY2Fu\nIGJlIHVzZWQgdG8gY29ycmVzcG9uZGluZyBzZXR0ZXIgbWV0aG9kcyBvZiB0\naGlzIHJlY2VpdmVyCiAgICAgKiB0byBzZXQgaXRzIHZhbHVlLgogICAgICov\nICAgIAogICAgcHVibGljIFNldDxTdHJpbmc+IGdldFN1cHBvcnRlZFByb3Bl\ncnRpZXMoKSB7CiAgICAgICAgU2V0PFN0cmluZz4ga2V5cyA9IF9jb25mLmdl\ndFByb3BlcnR5S2V5cygpOwogICAgICAgIGZvciAoU3RyaW5nIHMgOiBfc3Vw\ncG9ydGVkUHJvcGVydHlOYW1lcykKICAgICAgICAgICAga2V5cy5hZGQoIm9w\nZW5qcGEuIiArIHMpOwogICAgICAgIHJldHVybiBrZXlzOwogICAgfQoKICAg\nIC8vIC8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vIC8vLy8vLy8vCgog\nICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIoT2JqZWN0IGxp\nc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2xpZmVF\ndmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNsYXNzZXMpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVMaWZl\nY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIobGlzdGVuZXIpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGdldExpZmVjeWNs\nZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJldHVybiBfbGlm\nZUNhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMaWZl\nY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBfbGlmZUNhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAgICAgIF9s\naWZlRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FMTEJBQ0tf\nRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBHaXZlIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0byB0aGUgbGlm\nZWN5Y2xlIGV2ZW50IG1hbmFnZXIuCiAgICAgKi8KICAgIHB1YmxpYyBMaWZl\nY3ljbGVFdmVudE1hbmFnZXIgZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VyKCkg\newogICAgICAgIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gbGlmZWN5Y2xlIGV2ZW50LCBoYW5k\nbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAgICoKICAg\nICAqIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHByb2Nlc3Nl\nZCBhdCB0aGlzIHRpbWUKICAgICAqLwogICAgYm9vbGVhbiBmaXJlTGlmZWN5\nY2xlRXZlbnQoT2JqZWN0IHNyYywgT2JqZWN0IHJlbGF0ZWQsIENsYXNzTWV0\nYURhdGEgbWV0YSwKICAgICAgICBpbnQgZXZlbnRUeXBlKSB7CiAgICAgICAg\naWYgKF9saWZlRXZlbnRNYW5hZ2VyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIEV4Y2VwdGlv\nbltdIGV4czsKICAgICAgICB0cnkgewogICAgICAgICAgICBleHMgPSBfbGlm\nZUV2ZW50TWFuYWdlci5maXJlRXZlbnQoc3JjLCByZWxhdGVkLCBtZXRhLCBl\ndmVudFR5cGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0gCiAgICAgICAgaGFuZGxlQ2FsbGJhY2tFeGNl\ncHRpb25zKGV4cywgX2xpZmVDYWxsYmFja01vZGUpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVGFrZSBhY3Rpb25zIG9u\nIGNhbGxiYWNrIGV4Y2VwdGlvbnMgZGVwZW5kaW5nIG9uIGNhbGxiYWNrIG1v\nZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYW5kbGVDYWxsYmFja0V4\nY2VwdGlvbnMoRXhjZXB0aW9uW10gZXhjZXBzLCBpbnQgbW9kZSkgewogICAg\nICAgIGlmIChleGNlcHMubGVuZ3RoID09IDAgfHwgKG1vZGUgJiBDQUxMQkFD\nS19JR05PUkUpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nT3BlbkpQQUV4Y2VwdGlvbiBjZTsKICAgICAgICBpZiAoZXhjZXBzLmxlbmd0\naCA9PSAxKSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBleGNlcHRpb24gaXMg\nYWxyZWFkeSBhIHdyYXBwZWQgZXhjZXB0aW9uIHRocm93IHRoZSAKICAgICAg\nICAgICAgLy8gZXhjZXB0aW9uIGluc3RlYWQgb2Ygd3JhcHBpbmcgaXQgd2l0\naCBhIGNhbGxiYWNrIGV4Y2VwdGlvbgogICAgICAgICAgICBpZiAoZXhjZXBz\nWzBdIGluc3RhbmNlb2YgV3JhcHBlZEV4Y2VwdGlvbikKICAgICAgICAgICAg\nICAgIHRocm93IChXcmFwcGVkRXhjZXB0aW9uKWV4Y2Vwc1swXTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgY2UgPSBuZXcgQ2FsbGJhY2tF\neGNlcHRpb24oZXhjZXBzWzBdKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihfbG9jLmdldCgiY2Fs\nbGJhY2stZXJyIikpLgogICAgICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dh\nYmxlcyhleGNlcHMpOwogICAgICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBD\nQUxMQkFDS19ST0xMQkFDSykgIT0gMCAmJiAoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDApIHsKICAgICAgICAgICAgY2Uuc2V0RmF0YWwodHJ1ZSk7CiAg\nICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGNlKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfTE9HKSAhPSAwICYm\nIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLndhcm4o\nY2UpOwogICAgICAgIGlmICgobW9kZSAmIENBTExCQUNLX1JFVEhST1cpICE9\nIDApCiAgICAgICAgICAgIHRocm93IGNlOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGFkZFRyYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IHRsKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF90cmFuc0V2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih0bCk7CiAg\nICAgICAgICAgIGlmICh0bCBpbnN0YW5jZW9mIFJlbW90ZUNvbW1pdEV2ZW50\nTWFuYWdlcikKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1JFTU9U\nRV9MSVNURU5FUjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgcmVtb3ZlVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgdGwpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5yZW1vdmVMaXN0ZW5l\ncih0bCkKICAgICAgICAgICAgICAgICYmICh0bCBpbnN0YW5jZW9mIFJlbW90\nZUNvbW1pdEV2ZW50TWFuYWdlcikpCiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfUkVNT1RFX0xJU1RFTkVSOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nICAgIAogICAgcHVibGljIENvbGxlY3Rpb248T2JqZWN0PiBnZXRUcmFuc2Fj\ndGlvbkxpc3RlbmVycygpIHsKICAgICAgICByZXR1cm4gX3RyYW5zRXZlbnRN\nYW5hZ2VyLmdldExpc3RlbmVycygpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZSgpIHsKICAgICAg\nICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tNb2RlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoaW50\nIG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgX3RyYW5zQ2FsbGJhY2tNb2RlID0gbW9k\nZTsKICAgICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0\nKChtb2RlICYgQ0FMTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXJlIGdpdmVuIHRyYW5zYWN0\naW9uIGV2ZW50LCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0\nZWx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmlyZVRyYW5zYWN0aW9u\nRXZlbnQoVHJhbnNhY3Rpb25FdmVudCB0cmFucykgewogICAgICAgIGlmIChf\ndHJhbnNFdmVudE1hbmFnZXIgIT0gbnVsbCkKICAgICAgICAgICAgaGFuZGxl\nQ2FsbGJhY2tFeGNlcHRpb25zKF90cmFuc0V2ZW50TWFuYWdlci5maXJlRXZl\nbnQodHJhbnMpLAogICAgICAgICAgICAgICAgX3RyYW5zQ2FsbGJhY2tNb2Rl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB3aGV0aGVyIHRoaXMgQnJv\na2VyIHdpbGwgZ2VuZXJhdGUgdmVyYm9zZSBvcHRpbWlzdGljIGxvY2sgZXhj\nZXB0aW9ucyB3aGVuIGJhdGNoaW5nCiAgICAgKiBvcGVyYXRpb25zLiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICogCiAgICAgKiBAcGFyYW0gYgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRTdXBwcmVzc0JhdGNoT0xFTG9nZ2luZyhi\nb29sZWFuIGIpIHsKICAgICAgICBfc3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcg\nPSBiOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoaXMgQnJva2VyIHdpbGwgZ2VuZXJhdGUgdmVyYm9zZSBvcHRpbWlzdGlj\nIGxvY2sgZXhjZXB0aW9ucyB3aGVuIGJhdGNoaW5nCiAgICAgKiBvcGVyYXRp\nb25zLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTdXBwcmVzc0Jh\ndGNoT0xFTG9nZ2luZygpIHsKICAgICAgICByZXR1cm4gX3N1cHByZXNzQmF0\nY2hPTEVMb2dnaW5nOwogICAgfQogICAgLy8vLy8vLy8vLy8KICAgIC8vIExv\nb2t1cHMKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBmaW5k\nKE9iamVjdCBvaWQsIGJvb2xlYW4gdmFsaWRhdGUsIEZpbmRDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGludCBmbGFncyA9IE9JRF9DT1BZIHwgT0lEX0FM\nTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAgICAgaWYgKCF2YWxpZGF0\nZSkKICAgICAgICAgICAgZmxhZ3MgfD0gT0lEX05PVkFMSURBVEU7CiAgICAg\nICAgcmV0dXJuIGZpbmQob2lkLCBfZmMsIG51bGwsIG51bGwsIGZsYWdzLCBj\nYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQoT2JqZWN0IG9p\nZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRTZXQgZXhjbHVkZSwK\nICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewogICAgICAgIHJl\ndHVybiBmaW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRhLCBmbGFncywg\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgZmluZChPYmplY3Qgb2lk\nLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBleGNsdWRlLAog\nICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzLCBGaW5kQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAg\nICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1\nbWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09IDApCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24o\nX2xvYy5nZXQoIm51bGwtb2lkIikpOwogICAgICAgICAgICByZXR1cm4gY2Fs\nbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgfQogICAgICAg\nIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IF9mYzsK\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAg\nICAgICAgICAgIC8vIGNhY2hlZCBpbnN0YW5jZT8KICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9p\nZCwKICAgICAgICAgICAgICAgIChmbGFncyAmIE9JRF9BTExPV19ORVcpICE9\nIDAgfHwgaGFzRmx1c2hlZCgpKTsKICAgICAgICAgICAgaWYgKHNtICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGlmICghcmVxdWlyZXNMb2FkKHNtLCB0\ncnVlLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwoKICAgICAg\nICAgICAgICAgIGlmICghc20uaXNMb2FkaW5nKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBtYWtlIHN1cmUgYWxsIHRoZSBjb25maWd1cmVkIGZpZWxk\ncyBhcmUgbG9hZGVkOyBkbyB0aGlzCiAgICAgICAgICAgICAgICAgICAgLy8g\nYWZ0ZXIgbWFraW5nIGluc3RhbmNlIHRyYW5zYWN0aW9uYWwgZm9yIGxvY2tp\nbmcKICAgICAgICAgICAgICAgICAgICBpZiAoIXNtLmlzVHJhbnNhY3Rpb25h\nbCgpICYmIHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAg\nICAgICAgICAgICBib29sZWFuIGxvYWRlZDsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQgPSBzbS5s\nb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGUsIGVkYXRhLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24gb25mZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBvbmZlOwogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJu\nKG9pZCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICAvLyBpZiBubyBkYXRhIG5lZWRlZCB0byBiZSBsb2FkZWQg\nYW5kIHRoZSB1c2VyIHdhbnRzIHRvCiAgICAgICAgICAgICAgICAgICAgLy8g\ndmFsaWRhdGUsIGp1c3QgbWFrZSBzdXJlIHRoZSBvYmplY3QgZXhpc3RzCiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFsb2FkZWQgJiYgKGZsYWdzICYgT0lE\nX05PVkFMSURBVEUpID09IDAKICAgICAgICAgICAgICAgICAgICAgICAgJiYg\nX2NvbXBhdC5nZXRWYWxpZGF0ZVRydWVDaGVja3NTdG9yZSgpCiAgICAgICAg\nICAgICAgICAgICAgICAgICYmICFzbS5pc1RyYW5zYWN0aW9uYWwoKQogICAg\nICAgICAgICAgICAgICAgICAgICAmJiAhX3N0b3JlLmV4aXN0cyhzbSwgZWRh\ndGEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBP\nSURfTk9ERUxFVEVEKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICgiZGVsLWluc3RhbmNlIiwgc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIG9p\nZCkpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2Jq\nZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g\nc2luY2UgdGhlIG9iamVjdCB3YXMgY2FjaGVkLCB3ZSBtYXkgbmVlZCB0byB1\ncGdyYWRlIGxvY2sKICAgICAgICAgICAgICAgIC8vIGlmIGN1cnJlbnQgbGV2\nZWwgaXMgaGlnaGVyIHRoYW4gbGV2ZWwgb2YgaW5pdGlhbCBsb2FkCiAgICAg\nICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7\nCiAgICAgICAgICAgICAgICAgICAgaW50IGxldmVsID0gZmV0Y2guZ2V0UmVh\nZExvY2tMZXZlbCgpOwogICAgICAgICAgICAgICAgICAgIF9sbS5sb2NrKHNt\nLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRhdGEpOwogICAg\nICAgICAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGZldGNoLmdl\ndFdyaXRlTG9ja0xldmVsKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBubyBj\nYWNoZWQgc20gZm9yIGEgbmV3L3RyYW5zaWVudCBpZCB0eXBlLCB3ZQogICAg\nICAgICAgICAvLyBpdCBkZWZpbml0ZWx5IGRvZXNuJ3QgZXhpc3QKICAgICAg\nICAgICAgaWYgKG9pZCBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51\nbGwpOwoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBhIG5ldyBzdGF0ZSBt\nYW5hZ2VyIGZvciB0aGUgZGF0YXN0b3JlIGluc3RhbmNlCiAgICAgICAgICAg\nIHNtID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIChmbGFncyAmIE9JRF9D\nT1BZKSAhPSAwKTsKICAgICAgICAgICAgYm9vbGVhbiBsb2FkID0gcmVxdWly\nZXNMb2FkKHNtLCBmYWxzZSwgZmV0Y2gsIGVkYXRhLCBmbGFncyk7CiAgICAg\nICAgICAgIHNtID0gaW5pdGlhbGl6ZShzbSwgbG9hZCwgZmV0Y2gsIGVkYXRh\nKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRp\nb24ob2lkKTsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIGFsbCBjb25maWd1cmVkIGZpZWxkcyB3ZXJlIGxvYWRl\nZAogICAgICAgICAgICBpZiAobG9hZCkgewogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKGZldGNoLCBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTLCBleGNsdWRlLAogICAgICAgICAgICAgICAg\nICAgICAgICBlZGF0YSwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAgICAgICAg\nICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSAhPSAwCiAg\nICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElE\nQVRFKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBvbmZl\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1\ncm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwg\nc20pOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogSW5pdGlhbGl6ZSBhIG5ld2x5LWNvbnN0cnVjdGVkIHN0YXRlIG1h\nbmFnZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBs\nIGluaXRpYWxpemUoU3RhdGVNYW5hZ2VySW1wbCBzbSwgYm9vbGVhbiBsb2Fk\nLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGVk\nYXRhKSB7CiAgICAgICAgaWYgKCFsb2FkKSB7CiAgICAgICAgICAgIHNtLmlu\naXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgICAgICBQQ1N0YXRlLkhPTExPVyk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZSA9ICh1c2VUcmFuc2Fj\ndGlvbmFsU3RhdGUoZmV0Y2gpKQogICAgICAgICAgICAgICAgPyBQQ1N0YXRl\nLlBDTEVBTiA6IFBDU3RhdGUuUE5PTlRSQU5TOwogICAgICAgICAgICBzbS5z\nZXRMb2FkaW5nKHRydWUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgaWYgKCFfc3RvcmUuaW5pdGlhbGl6ZShzbSwgc3RhdGUsIGZldGNo\nLCBlZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBzbS5zZXRM\nb2FkaW5nKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gc207CiAgICB9CgogICAgcHVibGljIE9iamVjdFtdIGZpbmRB\nbGwoQ29sbGVjdGlvbiBvaWRzLCBib29sZWFuIHZhbGlkYXRlLAogICAgICAg\nIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGludCBmbGFncyA9IE9J\nRF9DT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAg\nICAgaWYgKCF2YWxpZGF0ZSkKICAgICAgICAgICAgZmxhZ3MgfD0gT0lEX05P\nVkFMSURBVEU7CiAgICAgICAgcmV0dXJuIGZpbmRBbGwob2lkcywgX2ZjLCBu\ndWxsLCBudWxsLCBmbGFncywgY2FsbCk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUsIE9iamVjdCBl\nZGF0YSwgaW50IGZsYWdzKSB7CiAgICAgICAgcmV0dXJuIGZpbmRBbGwob2lk\ncywgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRhLCBmbGFncywgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rpb24gb2lkcywg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJpdFNldCBleGNs\ndWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncywgRmluZENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgZmluZEFsbERlcHRoICsrOwoKICAgICAgICAvLyB0\naHJvdyBhbnkgZXhjZXB0aW9ucyBmb3IgbnVsbCBvaWRzIHVwIGltbWVkaWF0\nZWx5CiAgICAgICAgaWYgKG9pZHMgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCJvaWRzID09IG51bGwiKTsK\nICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDAgJiYg\nb2lkcy5jb250YWlucyhudWxsKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtb2lkcyIpKTsKCiAgICAgICAg\nLy8gd2UgaGF2ZSB0byB1c2UgYSBtYXAgb2Ygb2lkLT5zbSByYXRoZXIgdGhh\nbiBhIHNpbXBsZQogICAgICAgIC8vIGFycmF5LCBzbyB0aGF0IHdlIG1ha2Ug\nc3VyZSBub3QgdG8gY3JlYXRlIG11bHRpcGxlIHNtcyBmb3IgZXF1aXZhbGVu\ndAogICAgICAgIC8vIG9pZHMgaWYgdGhlIHVzZXIgaGFzIGR1cGxpY2F0ZXMg\naW4gdGhlIGdpdmVuIGFycmF5CiAgICAgICAgaWYgKF9sb2FkaW5nID09IG51\nbGwpCiAgICAgICAgICAgIF9sb2FkaW5nID0gbmV3IEhhc2hNYXAoKGludCkg\nKG9pZHMuc2l6ZSgpICogMS4zMyArIDEpKTsKCiAgICAgICAgaWYgKGNhbGwg\nPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IHRoaXM7CiAgICAgICAgaWYg\nKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gX2ZjOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAg\nICAgICAgLy8gY29sbGVjdGlvbiBvZiBzdGF0ZSBtYW5hZ2VycyB0byBwYXNz\nIHRvIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAgTGlzdCBsb2FkID0gbnVs\nbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAg\nICAgYm9vbGVhbiBpbml0aWFsaXplZDsKICAgICAgICAgICAgYm9vbGVhbiB0\ncmFuc1N0YXRlID0gdXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKTsKICAg\nICAgICAgICAgT2JqZWN0IG9iaiwgb2lkOwogICAgICAgICAgICBpbnQgaWR4\nID0gMDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvaWRzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAgICAg\nICAgICAvLyBpZiB3ZSd2ZSBhbHJlYWR5IHNlZW4gdGhpcyBvaWQsIHNraXAg\ncmVwZWF0cwogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAg\nICAgICAgICAgICAgIG9pZCA9IGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9iaik7\nCiAgICAgICAgICAgICAgICBpZiAob2lkID09IG51bGwgfHwgX2xvYWRpbmcu\nY29udGFpbnNLZXkob2JqKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBkb24ndCBoYXZlIGEgY2Fj\naGVkIGluc3RhbmNlIG9yIGl0IGlzIG5vdCB0cmFuc2FjdGlvbmFsCiAgICAg\nICAgICAgICAgICAvLyBhbmQgaXMgaG9sbG93IG9yIHdlIG5lZWQgdG8gdmFs\naWRhdGUsIGxvYWQgaXQKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVN\nYW5hZ2VySW1wbEJ5SWQob2lkLCAoZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAh\nPSAwCiAgICAgICAgICAgICAgICAgICAgfHwgaGFzRmx1c2hlZCgpKTsKICAg\nICAgICAgICAgICAgIGluaXRpYWxpemVkID0gc20gIT0gbnVsbDsKICAgICAg\nICAgICAgICAgIGlmICghaW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICAg\nICAgc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lE\nX0NPUFkpICE9IDApOwoKICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChv\nYmosIHNtKTsKICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlc0xvYWQoc20s\nIGluaXRpYWxpemVkLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkgewogICAgICAg\nICAgICAgICAgICAgIHRyYW5zU3RhdGUgPSB0cmFuc1N0YXRlIHx8IHVzZVRy\nYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGluaXRpYWxpemVkICYmICFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB0\ncmFuc1N0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICBzbS50cmFuc2Fj\ndGlvbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxp\nc3Qob2lkcy5zaXplKCkgLSBpZHgpOwogICAgICAgICAgICAgICAgICAgIGxv\nYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWluaXRp\nYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUoc20u\nZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gcGFzcyBhbGwgc3RhdGUgbWFuYWdlcnMgaW4gbmVl\nZCBvZiBsb2FkaW5nIG9yIHZhbGlkYXRpb24gdG8gdGhlCiAgICAgICAgICAg\nIC8vIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZSA9ICh0cmFuc1N0\nYXRlKSA/IFBDU3RhdGUuUENMRUFOCiAgICAgICAgICAgICAgICAgICAgOiBQ\nQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24g\nZmFpbGVkID0gX3N0b3JlLmxvYWRBbGwobG9hZCwgc3RhdGUsCiAgICAgICAg\nICAgICAgICAgICAgU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfTk9ORSwgZmV0\nY2gsIGVkYXRhKTsKCiAgICAgICAgICAgICAgICAvLyBzZXQgZmFpbGVkIGlu\nc3RhbmNlcyB0byBudWxsCiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9\nIG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld09iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uKGZhaWxlZCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChpdHIubmV4\ndCgpLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gY3JlYXRlIHJlc3VsdHMgYXJyYXk7IG1ha2Ugc3Vy\nZSBhbGwgY29uZmlndXJlZCBmaWVsZHMgYXJlCiAgICAgICAgICAgIC8vIGxv\nYWRlZCBpbiBlYWNoIGluc3RhbmNlCiAgICAgICAgICAgIE9iamVjdFtdIHJl\nc3VsdHMgPSBuZXcgT2JqZWN0W29pZHMuc2l6ZSgpXTsKICAgICAgICAgICAg\nYm9vbGVhbiBhY3RpdmUgPSAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDA7\nCiAgICAgICAgICAgIGludCBsZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2\nZWwoKTsKICAgICAgICAgICAgaWR4ID0gMDsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nIGlkeCsrKSB7CiAgICAgICAgICAgICAgICBvaWQgPSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgX2xvYWRp\nbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAm\nJiByZXF1aXJlc0xvYWQoc20sIHRydWUsIGZldGNoLCBlZGF0YSwgZmxhZ3Mp\nKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5MT0FE\nX0ZHUywKICAgICAgICAgICAgICAgICAgICAgICAgCWV4Y2x1ZGUsIGVkYXRh\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBs\nZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRhdGEpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc20ucmVhZExvY2tlZChsZXZlbCwgZmV0\nY2guZ2V0V3JpdGVMb2NrTGV2ZWwoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVU\nRUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFn\ncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc20gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdHNbaWR4XSA9IGNhbGwucHJv\nY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gcmVzdWx0czsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGZpbmRBbGxEZXB0aC0tOwogICAgICAgICAgICBp\nZiAoZmluZEFsbERlcHRoID09IDApCiAgICAgICAgICAgICAgICBfbG9hZGlu\nZyA9IG51bGw7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzRmx1c2hlZCgpIHsK\nICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZl\nbiBpbnN0YW5jZSBuZWVkcyBsb2FkaW5nIGJlZm9yZSBiZWluZyByZXR1cm5l\nZAogICAgICogdG8gdGhlIHVzZXIuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiByZXF1aXJlc0xvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgYm9v\nbGVhbiBpbml0aWFsaXplZCwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAgICAgICAgaWYg\nKCFmZXRjaC5yZXF1aXJlc0xvYWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgPT0g\nMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGVkYXRh\nICE9IG51bGwpIC8vIHRha2UgYWR2YW50YWdlIG9mIGV4aXN0aW5nIHJlc3Vs\ndAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoaW5pdGlh\nbGl6ZWQgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUuSE9MTE9XKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFpbml0aWFs\naXplZCAmJiBzbS5nZXRNZXRhRGF0YSgpLmdldFBDU3ViY2xhc3NlcygpLmxl\nbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJl\ndHVybiAhX2NvbXBhdC5nZXRWYWxpZGF0ZUZhbHNlUmV0dXJuc0hvbGxvdygp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdG8gdXNl\nIGEgdHJhbnNhY3Rpb25hbCBzdGF0ZS4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSAhPSAwICYmICghX29wdGltaXN0aWMKICAgICAgICAgICAgfHwgX2F1\ndG9DbGVhciA9PSBDTEVBUl9BTEwKICAgICAgICAgICAgfHwgZmV0Y2guZ2V0\nUmVhZExvY2tMZXZlbCgpICE9IExPQ0tfTk9ORSk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBmaW5kQ2FjaGVkKE9iamVjdCBvaWQsIEZpbmRDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAg\nICAgIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9IGNhbGwucHJvY2Vzc0Fy\nZ3VtZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7Cgog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsQnlJZChvaWQsIHRydWUpOwogICAgICAgICAgICByZXR1cm4gY2Fs\nbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgQ2xhc3MgZ2V0T2JqZWN0SWRUeXBlKENsYXNzIGNscykg\newogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29u\nZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAg\nICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9hZGVyLCBmYWxzZSk7CiAgICAg\nICAgICAgIGlmIChtZXRhID09IG51bGwKICAgICAgICAgICAgICAgIHx8IG1l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9VTktO\nT1dOKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEu\nSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICByZXR1cm4gbWV0YS5n\nZXRPYmplY3RJZFR5cGUoKTsKCiAgICAgICAgICAgIHJldHVybiBfc3RvcmUu\nZ2V0RGF0YVN0b3JlSWRUeXBlKG1ldGEpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3T2JqZWN0SWQoQ2xh\nc3MgY2xzLCBPYmplY3QgdmFsKSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUlu\nc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShjbHMsIF9s\nb2FkZXIsIHRydWUpOwogICAgICAgICAgICBzd2l0Y2ggKG1ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSBDbGFzc01ldGFEYXRh\nLklEX0RBVEFTVE9SRToKICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlIHRv\nIHN0b3JlIG1hbmFnZXIgZm9yIGRhdGFzdG9yZSBpZHMKICAgICAgICAgICAg\nICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcKICAgICAgICAgICAgICAg\nICAgICAmJiAoKFN0cmluZykgdmFsKS5zdGFydHNXaXRoKFN0YXRlTWFuYWdl\ncklkLlNUUklOR19QUkVGSVgpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgU3RhdGVNYW5hZ2VySWQoKFN0cmluZykgdmFsKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBfc3RvcmUubmV3RGF0YVN0b3JlSWQodmFsLCBtZXRh\nKTsKICAgICAgICAgICAgY2FzZSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FU\nSU9OOgogICAgICAgICAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNBc3NpZ25h\nYmxlKG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCksIAogICAgICAgICAgICAgICAg\nICAgIHZhbC5nZXRDbGFzcygpKSkgewogICAgICAgICAgICAgICAgICAgIGlm\nICghbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpIAogICAgICAgICAgICAgICAg\nICAgICAgICAmJiBtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0SWQoY2xzLCB2\nYWwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3RyaW5naWZpZWQgYXBw\nIGlkPwogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmlu\nZyAKICAgICAgICAgICAgICAgICAgICAmJiAhX2NvbmYuZ2V0Q29tcGF0aWJp\nbGl0eUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldFN0\ncmljdElkZW50aXR5VmFsdWVzKCkKICAgICAgICAgICAgICAgICAgICAmJiAh\nTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBQQ1JlZ2lzdHJ5Lm5ld09iamVjdElk\nKGNscywgKFN0cmluZykgdmFsKTsKCiAgICAgICAgICAgICAgICBPYmplY3Rb\nXSBhcnIgPSAodmFsIGluc3RhbmNlb2YgT2JqZWN0W10pID8gKE9iamVjdFtd\nKSB2YWwKICAgICAgICAgICAgICAgICAgICA6IG5ldyBPYmplY3RbXXsgdmFs\nIH07CiAgICAgICAgICAgICAgICByZXR1cm4gQXBwbGljYXRpb25JZHMuZnJv\nbVBLVmFsdWVzKGFyciwgbWV0YSk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgibWV0YS11bmtub3duaWQiLCBjbHMpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gY2F0Y2ggKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpYWUpIHsK\nICAgICAgICAJLy8gT1BFTkpQQS0zNjUKICAgICAgICAJdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1pZC12YWx1ZSIsIHZhbCwKICAg\nICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpLmdldE5hbWUoKSwgY2xzKSku\nc2V0Q2F1c2UoaWFlKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKENsYXNzQ2FzdEV4Y2VwdGlvbiBjY2UpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1pZC12YWx1ZSIs\nIHZhbCwKICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpLmdldE5hbWUo\nKSwgY2xzKSkuc2V0Q2F1c2UoY2NlKTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdp\ndmVuIG9pZC4KICAgICAqLwogICAgcHJpdmF0ZSBTdGF0ZU1hbmFnZXJJbXBs\nIG5ld1N0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9pZCwgYm9vbGVhbiBjb3B5\nKSB7CiAgICAgICAgLy8gc2VlIGlmIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9m\nIGxvYWRpbmcgdGhpcyBvaWQgaW4gYSBsb2FkQWxsIGNhbGwKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGlmIChfbG9hZGluZyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIF9s\nb2FkaW5nLmdldChvaWQpOwogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAm\nJiBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgIH0KCiAgICAgICAgLy8gZmlu\nZCBtZXRhZGF0YSBmb3IgdGhlIG9pZAogICAgICAgIENsYXNzIHBjVHlwZSA9\nIF9zdG9yZS5nZXRNYW5hZ2VkVHlwZShvaWQpOwogICAgICAgIE1ldGFEYXRh\nUmVwb3NpdG9yeSByZXBvcyA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAg\nICAgIGlmIChwY1R5cGUgIT0gbnVsbCkKICAgICAgICAgICAgbWV0YSA9IHJl\ncG9zLmdldE1ldGFEYXRhKHBjVHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEo\nb2lkLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgLy8gY29weSB0aGUgb2lk\nIGlmIG5lZWRlZAogICAgICAgIGlmIChjb3B5ICYmIF9jb21wYXQuZ2V0Q29w\neU9iamVjdElkcygpKSB7CiAgICAgICAgICAgIGlmIChtZXRhLmdldElkZW50\naXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAg\nICAgICAgICAgICAgICBvaWQgPSBBcHBsaWNhdGlvbklkcy5jb3B5KG9pZCwg\nbWV0YSk7CiAgICAgICAgICAgIGVsc2UgaWYgKG1ldGEuZ2V0SWRlbnRpdHlU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9VTktOT1dOKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEt\ndW5rbm93bmlkIiwgbWV0YSkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBvaWQgPSBfc3RvcmUuY29weURhdGFTdG9yZUlkKG9pZCwgbWV0\nYSk7CiAgICAgICAgfQoKICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdlcklt\ncGwob2lkLCBtZXRhKTsKICAgICAgICBzbS5zZXRPYmplY3RJZChvaWQpOwog\nICAgICAgIHJldHVybiBzbTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBvaWQgYW5kIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBu\nZXdTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvaWQsCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFn\nZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBUcmFuc2FjdGlvbgogICAgLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIHZvaWQgYmVnaW4oKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImFjdGl2\nZSIpKTsKICAgICAgICAgICAgX2ZhY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJh\nbnNhY3Rpb24odGhpcywgdHJ1ZSk7CiAgICAgICAgICAgIGJlZ2luSW50ZXJu\nYWwoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3Rp\nZnkgdGhlIHN0b3JlIG1hbmFnZXIgb2YgYSB0cmFuc2FjdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGJlZ2luSW50ZXJuYWwoKSB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlv\nbihfb3B0aW1pc3RpYyk7CiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0FD\nVElWRTsKCiAgICAgICAgICAgIC8vIHN0YXJ0IGxvY2tpbmcKICAgICAgICAg\nICAgaWYgKCFfb3B0aW1pc3RpYykgewogICAgICAgICAgICAgICAgX2ZjLnNl\ndFJlYWRMb2NrTGV2ZWwoX2NvbmYuZ2V0UmVhZExvY2tMZXZlbENvbnN0YW50\nKCkpOwogICAgICAgICAgICAgICAgX2ZjLnNldFdyaXRlTG9ja0xldmVsKF9j\nb25mLmdldFdyaXRlTG9ja0xldmVsQ29uc3RhbnQoKSk7CiAgICAgICAgICAg\nICAgICBfZmMuc2V0TG9ja1RpbWVvdXQoX2NvbmYuZ2V0TG9ja1RpbWVvdXQo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2xtLmJlZ2luVHJhbnNh\nY3Rpb24oKTsKCiAgICAgICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIu\naGFzQmVnaW5MaXN0ZW5lcnMoKSkKICAgICAgICAgICAgICAgIGZpcmVUcmFu\nc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAg\nICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9CRUdJTiwg\nbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCkpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgLy8gaWYgd2UgYWxy\nZWFkeSBzdGFydGVkIHRoZSB0cmFuc2FjdGlvbiwgZG9uJ3QgbGV0IGl0IGNv\nbW1pdAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAh\nPSAwKQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwo\na2UpOwogICAgICAgICAgICB0aHJvdyBrZS5zZXRGYXRhbCh0cnVlKTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIC8vIGlmIHdlIGFscmVhZHkgc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24s\nIGRvbid0IGxldCBpdCBjb21taXQKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIHNldFJvbGxi\nYWNrT25seUludGVybmFsKHJlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChfcGVuZGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXQgPSBfcGVuZGluZy5pdGVyYXRvcigpOyBpdC5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdC5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAg\nICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpKQogICAgICAgICAgICAgICAg\nICAgIHNldERpcnR5KHNtLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBfcGVuZGluZyA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGJlZ2luU3RvcmUoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0VHJh\nbnNhY3Rpb25PcGVyYXRpb24oKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1NUT1JFX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgICAgIGJl\nZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oZmFsc2UpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEJlZ2luIGEgc3Rv\ncmUgbWFuYWdlciB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oYm9vbGVhbiBvcHRp\nbWlzdGljKSB7CiAgICAgICAgaWYgKCFvcHRpbWlzdGljKSB7CiAgICAgICAg\nICAgIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgX3N0b3JlLmJl\nZ2luKCk7CiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1NUT1JFX0FDVElW\nRTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoX2Nvbm5SZXRh\naW5Nb2RlID09IENPTk5fUkVUQUlOX1RSQU5TKQogICAgICAgICAgICAgICAg\ncmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfc3RvcmUuYmVnaW5P\ncHRpbWlzdGljKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nRW5kIHRoZSBjdXJyZW50IHN0b3JlIG1hbmFnZXIgdHJhbnNhY3Rpb24uIFRo\ncm93cyBhbgogICAgICogZXhjZXB0aW9uIHRvIHNpZ25hbCBhIGZvcmNlZCBy\nb2xsYmFjayBhZnRlciBmYWlsZWQgY29tbWl0LCBvdGhlcndpc2UKICAgICAq\nIHJldHVybnMgYW55IGV4Y2VwdGlvbiBlbmNvdW50ZXJlZCBkdXJpbmcgdGhl\nIGVuZCBwcm9jZXNzLgogICAgICovCiAgICBwcml2YXRlIFJ1bnRpbWVFeGNl\ncHRpb24gZW5kU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oYm9vbGVhbiByb2xs\nYmFjaykgewogICAgICAgIGJvb2xlYW4gZm9yY2VkUm9sbGJhY2sgPSBmYWxz\nZTsKICAgICAgICBib29sZWFuIHJlbGVhc2VDb25uID0gZmFsc2U7CiAgICAg\nICAgUnVudGltZUV4Y2VwdGlvbiBlcnIgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUp\nICE9IDApIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VDb25uID0gX2Nvbm5S\nZXRhaW5Nb2RlICE9IENPTk5fUkVUQUlOX0FMV0FZUzsKICAgICAgICAgICAg\nICAgIGlmIChyb2xsYmFjaykKICAgICAgICAgICAgICAgICAgICBfc3RvcmUu\ncm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBfc3RvcmUuY29tbWl0KCk7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICByZWxlYXNlQ29ubiA9IF9jb25uUmV0YWluTW9k\nZSA9PSBDT05OX1JFVEFJTl9UUkFOUzsKICAgICAgICAgICAgICAgIF9zdG9y\nZS5yb2xsYmFja09wdGltaXN0aWMoKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICBpZiAoIXJvbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBmb3Jj\nZWRSb2xsYmFjayA9IHRydWU7CiAgICAgICAgICAgICAgICB0cnkgeyBfc3Rv\ncmUucm9sbGJhY2soKTsgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZTIp\nIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyID0gcmU7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NU\nT1JFX0FDVElWRTsKICAgICAgICB9CgogICAgICAgIGlmIChyZWxlYXNlQ29u\nbikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVsZWFz\nZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgaWYgKGVyciA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGVyciA9IHJlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoZm9yY2VkUm9sbGJhY2spCiAgICAg\nICAgICAgIHRocm93IGVycjsKICAgICAgICByZXR1cm4gZXJyOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nVHJhbnNhY3Rpb25PcGVyYXRpb24oKTsKCiAgICAgICAgICAgIGphdmF4LnRy\nYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAgICAgICAg\nIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0\naW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgibnVsbC10cmFucyIpKTsKCiAgICAgICAgICAgIC8vIHRoaXMgY29t\nbWl0IG9uIHRoZSB0cmFuc2FjdGlvbiB3aWxsIGNhdXNlIG91cgogICAgICAg\nICAgICAvLyBiZWZvcmVDb21wbGV0aW9uIG1ldGhvZCB0byBiZSBpbnZva2Vk\nCiAgICAgICAgICAgIHRyYW5zLmNvbW1pdCgpOwogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9sb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2Uo\nX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3Ii\nKSwgZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJh\nY2soKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9u\nKCk7CgogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlv\nbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2Fj\ndGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBp\nZiAodHJhbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyYW5zLnJvbGxi\nYWNrKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVy\ncm9yIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlv\nbigpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgaWYgKCFfbWFuYWdlZCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLW5v\ndC1tYW5hZ2VkIikpOwogICAgICAgICAgICBpZiAoX2ZhY3Rvcnkuc3luY1dp\ndGhNYW5hZ2VkVHJhbnNhY3Rpb24odGhpcywgZmFsc2UpKSB7CiAgICAgICAg\nICAgICAgICBiZWdpbkludGVybmFsKCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdEFuZFJl\nc3VtZSgpIHsKICAgICAgICBlbmRBbmRSZXN1bWUodHJ1ZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgcm9sbGJhY2tBbmRSZXN1bWUoKSB7CiAgICAgICAg\nZW5kQW5kUmVzdW1lKGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQg\nZW5kQW5kUmVzdW1lKGJvb2xlYW4gY29tbWl0KSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChjb21taXQpCiAgICAgICAgICAgICAgICBjb21taXQoKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgcm9sbGJhY2soKTsKICAgICAgICAg\nICAgYmVnaW4oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gZ2V0Um9sbGJhY2tPbmx5KCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlvbi5UcmFu\nc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGltZS5nZXRU\ncmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAg\nICAgICBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRyYW5zLmdldFN0YXR1cygp\nID09IFN0YXR1cy5TVEFUVVNfTUFSS0VEX1JPTExCQUNLOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBUaHJvd2FibGUgZ2V0Um9sbGJhY2tD\nYXVzZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZF\nKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nICAgICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAg\nICAgICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIo\nKS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICBpZiAodHJhbnMuZ2V0U3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJL\nRURfUk9MTEJBQ0spCiAgICAgICAgICAgICAgICByZXR1cm4gX3J1bnRpbWUu\nZ2V0Um9sbGJhY2tDYXVzZSgpOwoKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Um9s\nbGJhY2tPbmx5KCkgewogICAgICAgIHNldFJvbGxiYWNrT25seShuZXcgVXNl\nckV4Y2VwdGlvbigpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xs\nYmFja09ubHkoVGhyb3dhYmxlIGNhdXNlKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nVHJhbnNhY3Rpb25PcGVyYXRpb24oKTsKICAgICAgICAgICAgc2V0Um9sbGJh\nY2tPbmx5SW50ZXJuYWwoY2F1c2UpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIE1hcmsgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMg\ncm9sbGJhY2stb25seS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNldFJv\nbGxiYWNrT25seUludGVybmFsKFRocm93YWJsZSBjYXVzZSkgewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0\naW9uIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5z\nYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAg\nIGlmICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC10cmFucyIp\nKTsKICAgICAgICAgICAgLy8gZW5zdXJlIHRyYW4gaXMgaW4gYSB2YWxpZCBz\ndGF0ZSB0byBhY2NlcHQgdGhlIHNldFJvbGxiYWNrT25seQogICAgICAgICAg\nICBpbnQgdHJhblN0YXR1cyA9IHRyYW5zLmdldFN0YXR1cygpOwogICAgICAg\nICAgICBpZiAoKHRyYW5TdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19OT19UUkFO\nU0FDVElPTikKICAgICAgICAgICAgICAgICAgICAmJiAodHJhblN0YXR1cyAh\nPSBTdGF0dXMuU1RBVFVTX1JPTExFREJBQ0spCiAgICAgICAgICAgICAgICAg\nICAgJiYgKHRyYW5TdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19DT01NSVRURUQp\nKQogICAgICAgICAgICAgICAgX3J1bnRpbWUuc2V0Um9sbGJhY2tPbmx5KGNh\ndXNlKTsKICAgICAgICAgICAgZWxzZSBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiaW52\nYWxpZC10cmFuLXN0YXR1cyIsIG5ldyBJbnRlZ2VyKAogICAgICAgICAgICAg\nICAgICAgICAgICB0cmFuU3RhdHVzKSwgInNldFJvbGxiYWNrT25seSIpKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTYXZlcG9p\nbnQoU3RyaW5nIG5hbWUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFu\nc2FjdGlvbigpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVs\nbCAmJiBfc2F2ZXBvaW50cy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzYXZl\ncG9pbnQtZXhpc3RzIiwgbmFtZSkpOwoKICAgICAgICAgICAgaWYgKGhhc0Zs\ndXNoZWQoKSAmJiAhX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1c2goKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgic2F2ZXBvaW50LWZs\ndXNoLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgICAgICBPcGVuSlBBU2F2\nZXBvaW50IHNhdmUgPSBfc3BtLm5ld1NhdmVwb2ludChuYW1lLCB0aGlzKTsK\nICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51bGwgfHwgX3NhdmVw\nb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzYXZlLnNhdmUo\nZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpKTsKICAgICAgICAgICAgICAgIF9z\nYXZlcG9pbnRzID0gbmV3IExpbmtlZE1hcCgpOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShDb2xsZWN0aW9u\ncy5FTVBUWV9TRVQpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgc2F2ZS5zYXZlKF9zYXZlcG9pbnRDYWNoZSk7CiAgICAg\nICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3NhdmVw\nb2ludHMucHV0KG5hbWUsIHNhdmUpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9pbnQoKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9zYXZlcG9pbnRzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50IikpOwogICAgICAgICAg\nICByZWxlYXNlU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZlcG9pbnRzLmdldAog\nICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVsZWFzZVNhdmVw\nb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFj\ndGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBpbnQgaW5kZXggPSAo\nX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAgICAgICAgICAgICAgOiBf\nc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7CiAgICAgICAgICAgIGlm\nIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwgc2F2ZXBvaW50KSk7\nCgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2ZXJzZQogICAgICAg\nICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAgICAgICAgIHdoaWxl\nIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEpIHsKICAgICAgICAg\nICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMu\ncmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUo\nKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2ZSA9IChPcGVuSlBBU2F2\nZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgpOwogICAgICAgICAg\nICBzYXZlLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAgICAgIGlmIChfc2F2ZXBv\naW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zYXZlcG9pbnRD\nYWNoZS5jbGVhcigpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9zYXZlcG9pbnRzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50IikpOwogICAgICAgICAgICByb2xs\nYmFja1RvU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZlcG9pbnRzLmdldAogICAg\nICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tUb1NhdmVw\nb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFj\ndGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBpbnQgaW5kZXggPSAo\nX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAgICAgICAgICAgICAgOiBf\nc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7CiAgICAgICAgICAgIGlm\nIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwgc2F2ZXBvaW50KSk7\nCgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2ZXJzZQogICAgICAg\nICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAgICAgICAgIHdoaWxl\nIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEpIHsKICAgICAgICAg\nICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMu\ncmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUo\nKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNlKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2ZSA9IChPcGVuSlBBU2F2\nZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgpOwogICAgICAgICAg\nICBDb2xsZWN0aW9uIHNhdmVkID0gc2F2ZS5yb2xsYmFjayhfc2F2ZXBvaW50\ncy52YWx1ZXMoKSk7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50Q2FjaGUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZS5jbGVh\ncigpOwogICAgICAgICAgICBpZiAoaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMo\nKSkgewogICAgICAgICAgICAgICAgLy8gYnVpbGQgdXAgYSBuZXcgY29sbGVj\ndGlvbiBvZiBzdGF0ZXMKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uYWxD\nYWNoZSBvbGRUcmFuc0NhY2hlID0gX3RyYW5zQ2FjaGU7CiAgICAgICAgICAg\nICAgICBUcmFuc2FjdGlvbmFsQ2FjaGUgbmV3VHJhbnNDYWNoZSA9IG5ldyBU\ncmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICAgICAgICAgICAgICAoX29yZGVy\nRGlydHkpOwogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBudWxsOwoK\nICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRseSB0aGVyZSBpcyB0aGUgYXNz\ndW1wdGlvbiB0aGF0IGluY3JlbWVudGFsCiAgICAgICAgICAgICAgICAvLyBm\nbHVzaCBpcyBlaXRoZXIgYSkgbm90IGFsbG93ZWQsIG9yIGIpIHJlcXVpcmVk\nCiAgICAgICAgICAgICAgICAvLyBwcmUtc2F2ZXBvaW50LiAgdGhpcyBzb2x2\nZXMgYSBudW1iZXIgb2YgaXNzdWVzIGluY2x1ZGluZwogICAgICAgICAgICAg\nICAgLy8gc3RvcmluZyBmbHVzaGVkIHN0YXRlcyBhcyB3ZWxsIGFzIE9JRCBo\nYW5kbGluZy4KICAgICAgICAgICAgICAgIC8vIGlmIGZ1dHVyZSBwbHVnaW5z\nIGRvIG5vdCBmb2xsb3cgdGhpcywgd2UgbmVlZCB0byBjYWNoZQogICAgICAg\nICAgICAgICAgLy8gbW9yZSBpbmZvIHBlciBzdGF0ZQogICAgICAgICAgICAg\nICAgU2F2ZXBvaW50RmllbGRNYW5hZ2VyIGZtOwogICAgICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gc2F2ZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgICAgICBmbSA9IChTYXZlcG9pbnRGaWVsZE1h\nbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgc20gPSBm\nbS5nZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgICAgICAgICBzbS5y\nb2xsYmFja1RvU2F2ZXBvaW50KGZtKTsKICAgICAgICAgICAgICAgICAgICBv\nbGRUcmFuc0NhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nVHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7CiAgICAgICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFk\nZENsZWFuKHNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gb2xkVHJhbnNDYWNoZS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIHNtID0g\nKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICAgICAgc20ucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICByZW1v\ndmVGcm9tVHJhbnNhY3Rpb24oc20pOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXdUcmFuc0NhY2hlOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBmbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyByZXR1cm4gc2ls\nZW50bHkgaWYgbm8gdHJhbnMgaXMgYWN0aXZlLCBvciBpZiB0aGlzIGlzIGEg\ncmVlbnRyYW50CiAgICAgICAgICAgIC8vIGNhbGwsIHdoaWNoIGNhbiBoYXBw\nZW4gaWYgdGhlIHN0b3JlIG1hbmFnZXIgdHJpZXMgdG8gZ2V0IGFuCiAgICAg\nICAgICAgIC8vIGF1dG8taW5jIG9pZCBkdXJpbmcgZmx1c2gKICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMAogICAgICAgICAg\nICAgICAgfHwgKF9mbGFncyAmIEZMQUdfU1RPUkVfRkxVU0hJTkcpICE9IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAvLyBtYWtl\nIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAgICAgICAgaWYg\nKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoX2NvbmYuT1BU\nSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7CiAgICAg\nICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2ZXBvaW50\ncy5pc0VtcHR5KCkKICAgICAgICAgICAgICAgICYmICFfc3BtLnN1cHBvcnRz\nSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKCiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmbHVzaFNhZmUoRkxV\nU0hfSU5DKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNI\nRUQ7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIG9uIGZsdXNoIGVycm9y\nOyBvYmplY3RzIG1heSBiZSBpbiBpbmNvbnNpc3RlbnQgc3RhdGUKICAgICAg\nICAgICAgICAgIHNldFJvbGxiYWNrT25seShrZSk7CiAgICAgICAgICAgICAg\nICB0aHJvdyBrZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgLy8g\ncm9sbGJhY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5IGJlIGluIGlu\nY29uc2lzdGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tP\nbmx5KHJlKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2Vw\ndGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcmVGbHVz\naCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAh\nPSAwKQogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0xPR0lDQUwp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB2YWxpZGF0\nZUNoYW5nZXMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgbm8gdHJhbnMsIGp1c3Qg\ncmV0dXJuOyBpZiBhY3RpdmUgZGF0YXN0b3JlIHRyYW5zLCBmbHVzaAogICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBm\nbHVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9y\ndHMgaW5jIGZsdXNoCiAgICAgICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVk\nT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNfRkxVU0gpKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbmNyZW1lbnRhbC1m\nbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9ST0xMQkFDSyk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNBY3RpdmUo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkg\nIT0gMDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNTdG9yZUFjdGl2ZSgpIHsKICAgICAgICAvLyB3ZSBuZWVkIHRvIGxvY2sg\naGVyZSwgYmVjYXVzZSB3ZSBtaWdodCBiZSBpbiB0aGUgbWlkZGxlIG9mIGFu\nCiAgICAgICAgLy8gYXRvbWljIHRyYW5zYWN0aW9uIHByb2Nlc3MgKGUuZy4s\nIGNvbW1pdEFuZFJlc3VtZSkKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBjdXJyZW50IHRy\nYW5zYWN0aW9uIGlzIGVuZGluZywgaS5lLiBpbiB0aGUgMm5kIHBoYXNlCiAg\nICAgKiBvZiBhIGNvbW1pdCBvciByb2xsYmFjawogICAgICovCiAgICBib29s\nZWFuIGlzVHJhbnNhY3Rpb25FbmRpbmcoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBGTEFHX1RSQU5TX0VORElORykgIT0gMDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBiZWdpbk9wZXJhdGlvbihib29sZWFuIHN5bmNUcmFu\ncykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBpZiAoc3luY1RyYW5zICYm\nIF9vcGVyYXRpb25Db3VudCA9PSAwICYmIF9zeW5jTWFuYWdlZAogICAgICAg\nICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAg\nICAgICAgICAgICAgc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24oKTsKICAg\nICAgICAgICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCsrID09IDE7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhl\nIG9wZXJhdGlvbiBvdmVyLiBJZiBvdXRlcm1vc3QgY2FsbGVyIG9mIHN0YWNr\nLCByZXR1cm5zIHRydWUKICAgICAqIGFuZCB3aWxsIGRldGFjaCBtYW5hZ2Vk\nIGluc3RhbmNlcyBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGVuZE9wZXJhdGlvbigpIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDEgJiYgKF9hdXRvRGV0YWNo\nICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMAogICAgICAgICAgICAgICAgJiYg\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKSB7CiAgICAgICAgICAgICAg\nICBkZXRhY2hBbGxJbnRlcm5hbChudWxsKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50IDwgMSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgibXVs\ndGktdGhyZWFkZWQtYWNjZXNzIikpOwogICAgICAgICAgICByZXR1cm4gX29w\nZXJhdGlvbkNvdW50ID09IDE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfb3BlcmF0aW9uQ291bnQtLTsKICAgICAgICAg\nICAgaWYgKF9vcGVyYXRpb25Db3VudCA9PSAwKQogICAgICAgICAgICAgICAg\naW5pdGlhbGl6ZU9wZXJhdGluZ1NldCgpOwogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN5bmNocm9uaXphdGlv\nbiBnZXRTeW5jaHJvbml6YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9zeW5j\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFN5bmNocm9uaXphdGlvbihT\neW5jaHJvbml6YXRpb24gc3luYykgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfc3luYyA9IHN5bmM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIElt\ncGxlbWVudGF0aW9uIG9mIFN5bmNocm9uaXphdGlvbiBpbnRlcmZhY2UKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgYmVmb3JlQ29tcGxldGlvbigpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gdXNlci1zdXBwbGllZCBzeW5jaHJvbml6YXRpb24KICAg\nICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc3luYy5iZWZvcmVDb21wbGV0aW9uKCk7CgogICAgICAgICAgICBmbHVzaFNh\nZmUoRkxVU0hfQ09NTUlUKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJl\nbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyB0cmFu\nc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihrZSk7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBp\nZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIHJlKTsKICAg\nICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNl\ncHRpb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29tcGxldGlvbihpbnQgc3Rh\ndHVzKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7\nCgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19UUkFOU19FTkRJTkc7CiAg\nICAgICAgICAgIGVuZFRyYW5zYWN0aW9uKHN0YXR1cyk7CiAgICAgICAgICAg\nIGlmIChfc3luYyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N5bmMuYWZ0\nZXJDb21wbGV0aW9uKHN0YXR1cyk7CgogICAgICAgICAgICBpZiAoKF9hdXRv\nRGV0YWNoICYgREVUQUNIX0NPTU1JVCkgIT0gMCkKICAgICAgICAgICAgICAg\nIGRldGFjaEFsbEludGVybmFsKG51bGwpOwogICAgICAgICAgICBlbHNlIGlm\nIChzdGF0dXMgPT0gU3RhdHVzLlNUQVRVU19ST0xMRURCQUNLCiAgICAgICAg\nICAgICAgICAmJiAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfUk9MTEJBQ0spICE9\nIDApIHsKICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbiBhbiBlZSBjb250\nZXh0LCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHVzZXIgdHJpZWQgdG8gY2xv\nc2UKICAgICAgICAgICAgLy8gdXMgYnV0IHdlIGRpZG4ndCBhY3R1YWxseSBj\nbG9zZSBiZWNhdXNlIHdlIHdlcmUgd2FpdGluZyBvbiB0aGlzCiAgICAgICAg\nICAgIC8vIHRyYW5zYWN0aW9uOyBpZiB0aGF0J3MgdHJ1ZSwgdGhlbiBjbG9z\nZSBub3cKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0NMT1NFX0lO\nVk9LRUQpICE9IDAKICAgICAgICAgICAgICAgICYmIF9jb21wYXQuZ2V0Q2xv\nc2VPbk1hbmFnZWRDb21taXQoKSkKICAgICAgICAgICAgICAgIGZyZWUoKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwg\na2UpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxl\ndGlvbkV4Y2VwdGlvbihrZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgi\nZW5kLXRyYW5zLWVycm9yIiksIHJlKTsKICAgICAgICAgICAgdGhyb3cgdHJh\nbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRpb24obmV3IFN0b3JlRXhj\nZXB0aW9uKHJlKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX0FDVElWRTsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19U\nUkFOU19FTkRJTkc7CgogICAgICAgICAgICAvLyBldmVudCBtYW5hZ2VyIG51\nbGxlZCBpZiBmcmVlZCBicm9rZXIKICAgICAgICAgICAgaWYgKF90cmFuc0V2\nZW50TWFuYWdlciAhPSBudWxsIAogICAgICAgICAgICAgICAgJiYgX3RyYW5z\nRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAgICAg\nICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVu\ndCh0aGlzLAogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9PSBTdGF0dXMu\nU1RBVFVTX0NPTU1JVFRFRAogICAgICAgICAgICAgICAgICAgICAgICA/IFRy\nYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlUX0NPTVBMRVRFCiAgICAgICAg\nICAgICAgICAgICAgICAgIDogVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9ST0xM\nQkFDS19DT01QTEVURSwKICAgICAgICAgICAgICAgICAgICBudWxsLCBudWxs\nLCBudWxsLCBudWxsKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIElmIHdlJ3JlIGluIGEgbWFuYWdlZCB0cmFuc2FjdGlvbiwgdXNlIG91ciBp\nbXBsaWNpdCBiZWhhdmlvciBleGNlcHRpb24KICAgICAqIHRyYW5zbGF0b3Ig\ndG8gdHJhbnNsYXRlIGJlZm9yZS9hZnRlckNvbXBsZXRpb24gY2FsbGJhY2sg\nZXJyb3JzLgogICAgICovCiAgICBwcml2YXRlIFJ1bnRpbWVFeGNlcHRpb24g\ndHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNlcHRpb24KICAgICAgICAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIHJldHVybiAoIV9tYW5h\nZ2VkIHx8IF9leHRyYW5zID09IG51bGwpID8gcmUgOiBfZXh0cmFucy50cmFu\nc2xhdGUocmUpOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggc2FmZWx5\nLCBjYXRjaGluZyByZWVudHJhbnQgY2FsbHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBmbHVzaFNhZmUoaW50IHJlYXNvbikgewogICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19GTFVTSElORykgIT0gMCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgicmVlbnRy\nYW50LWZsdXNoIikpOwoKICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSElO\nRzsKICAgICAgICB0cnkgewogICAgICAgICAgICBmbHVzaChyZWFzb24pOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19GTFVTSElORzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBG\nbHVzaCB0aGUgdHJhbnNhY3Rpb25hbCBzdGF0ZSB0byB0aGUgZGF0YSBzdG9y\nZS4gU3ViY2xhc3NlcyB0aGF0CiAgICAgKiBjdXN0b21pemUgY29tbWl0IGJl\naGF2aW9yIHNob3VsZCBvdmVycmlkZSB0aGlzIG1ldGhvZC4gVGhlIG1ldGhv\nZAogICAgICogYXNzdW1lcyB0aGF0IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2Vy\nIGlzIGxvY2tlZCwgaXMgbm90IGNsb3NlZCwKICAgICAqIGFuZCBoYXMgYW4g\nYWN0aXZlIHRyYW5zYWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSByZWFz\nb24gb25lIG9mIHtAbGluayAjRkxVU0hfSU5DfSwge0BsaW5rICNGTFVTSF9D\nT01NSVR9LAogICAgICoge0BsaW5rICNGTFVTSF9ST0xMQkFDS30sIG9yIHtA\nbGluayAjRkxVU0hfTE9HSUNBTH0KICAgICAqIEBzaW5jZSAwLjIuNQogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBmbHVzaChpbnQgcmVhc29uKSB7CiAg\nICAgICAgLy8gdGhpcyB3aWxsIGVubGlzdCBwcm94aWVkIHN0YXRlcyBhcyBu\nZWNlc3Nhcnkgc28gd2Uga25vdyB3aGV0aGVyIHdlCiAgICAgICAgLy8gaGF2\nZSBhbnl0aGluZyB0byBmbHVzaAogICAgICAgIENvbGxlY3Rpb24gdHJhbnNh\nY3Rpb25hbCA9IGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKTsKCiAgICAgICAg\nLy8gZG8gd2UgYWN0dWFsbHkgaGF2ZSB0byBmbHVzaD8gIG9ubHkgaWYgb3Vy\nIGZsYWdzIHNheSBzbywgb3IgaWYKICAgICAgICAvLyB3ZSBoYXZlIHRyYW5z\nYWN0aW9uIGxpc3RlbmVycyB0aGF0IG5lZWQgdG8gYmUgaW52b2tlZCBmb3Ig\nY29tbWl0CiAgICAgICAgLy8gKG5vIG5lZWQgdG8gaW52b2tlIHRoZW0gb24g\naW5jIGZsdXNoIGlmIG5vdGhpbmcgaXMgZGlydHkpLiAgd2UKICAgICAgICAv\nLyBzcGVjaWFsIGNhc2UgdGhlIHJlbW90ZSBjb21taXQgbGlzdGVuZXIgdXNl\nZCBieSB0aGUgZGF0YWNhY2hlIGNhdXNlCiAgICAgICAgLy8gd2Uga25vdyBp\ndCBkb2Vzbid0IHJlcXVpcmUgdGhlIGNvbW1pdCBldmVudCB3aGVuIG5vdGhp\nbmcgY2hhbmdlcwogICAgICAgIGJvb2xlYW4gZmx1c2ggPSAoX2ZsYWdzICYg\nRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0gMDsKICAgICAgICBib29sZWFuIGxp\nc3RlbmVycyA9IChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5l\ncnMoKQogICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5k\nTGlzdGVuZXJzKCkpCiAgICAgICAgICAgICYmICgoX2ZsYWdzICYgRkxBR19S\nRU1PVEVfTElTVEVORVIpID09IDAKICAgICAgICAgICAgfHwgX3RyYW5zRXZl\nbnRNYW5hZ2VyLmdldExpc3RlbmVycygpLnNpemUoKSA+IDEpOwogICAgICAg\nIGlmICghZmx1c2ggJiYgKHJlYXNvbiAhPSBGTFVTSF9DT01NSVQgfHwgIWxp\nc3RlbmVycykpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ29sbGVj\ndGlvbiBtb2JqcyA9IG51bGw7CiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJF\nU1RPUklORzsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoZmx1c2gp\nIHsKICAgICAgICAgICAgICAgIC8vIGNhbGwgcHJlIHN0b3JlIG9uIGFsbCBj\ndXJyZW50bHkgdHJhbnNhY3Rpb25hbCBvYmpzCiAgICAgICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgKChTdGF0ZU1h\nbmFnZXJJbXBsKSBpdHIubmV4dCgpKS5iZWZvcmVGbHVzaChyZWFzb24sIF9j\nYWxsKTsKICAgICAgICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5zYWN0\naW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGhvcGVmdWxseSBub3cgYWxsIGRlcGVuZGVudCBpbnN0YW5jZXMgdGhhdCBh\ncmUgZ29pbmcgdG8gZW5kCiAgICAgICAgICAgIC8vIHVwIHJlZmVyZW5jZWQg\naGF2ZSBiZWVuIG1hcmtlZCBhcyBzdWNoOyBkZWxldGUgdW5yZWZlZAogICAg\nICAgICAgICAvLyBkZXBlbmRlbnRzCiAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX0RFUkVGREVMRVRJTkc7CiAgICAgICAgICAgIGlmIChmbHVzaCAmJiBf\nZGVyZWZDYWNoZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2RlcmVm\nQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAg\nICAgICAgICAgZGVsZXRlRGVyZWYoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5u\nZXh0KCkpOwogICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNh\nY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAgICAgICAg\nICAvLyBpZiBubyBkYXRhc3RvcmUgdHJhbnNhY3Rpb24sIHN0YXJ0IG9uZTsg\nZXZlbiBpZiB3ZSBkb24ndAogICAgICAgICAgICAgICAgLy8gdGhpbmsgd2Un\nbGwgbmVlZCB0byBmbHVzaCBhdCB0aGlzIHBvaW50LCBvdXIgdHJhbnNhY3Rp\nb24KICAgICAgICAgICAgICAgIC8vIGxpc3RlbmVycyBtaWdodCBpbnRyb2R1\nY2Ugc29tZSBkaXJ0eSBvYmplY3RzIG9yIGludGVyYWN0CiAgICAgICAgICAg\nICAgICAvLyBkaXJlY3RseSB3aXRoIHRoZSBkYXRhYmFzZQogICAgICAgICAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgPT0gMCkK\nICAgICAgICAgICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5zYWN0\naW9uKGZhbHNlKTsKCiAgICAgICAgICAgICAgICBpZiAoKF90cmFuc0V2ZW50\nTWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpCiAgICAgICAgICAgICAgICAg\nICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKQog\nICAgICAgICAgICAgICAgICAgICYmIChmbHVzaCB8fCByZWFzb24gPT0gRkxV\nU0hfQ09NTUlUKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGZpcmUgZXZl\nbnRzCiAgICAgICAgICAgICAgICAgICAgbW9ianMgPSBuZXcgTWFuYWdlZE9i\namVjdENvbGxlY3Rpb24odHJhbnNhY3Rpb25hbCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9DT01NSVQKICAgICAgICAgICAg\nICAgICAgICAgICAgJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3Rl\nbmVycygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVUcmFuc2Fj\ndGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25FdmVudC5CRUZPUkVf\nQ09NTUlULCBtb2JqcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9w\nZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNh\nY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmx1\nc2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0gMDsKICAg\nICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChm\nbHVzaCAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25F\ndmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQuQkVGT1JFX0ZMVVNI\nLCBtb2JqcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0\nZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAgICAg\nICAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFs\nLCByZWFzb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5\nIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1BSRVNUT1JJTkc7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19ERVJFRkRFTEVUSU5HOwogICAg\nICAgICAgICBfdHJhbnNBZGRpdGlvbnMgPSBudWxsOwogICAgICAgICAgICBf\nZGVyZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgICAgICAgICAgLy8gYWxzbyBj\nbGVhciBkZXJlZmVkIHNldDsgdGhlIGRlbGV0ZXMgaGF2ZSBiZWVuIHJlY29y\nZGVkCiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX2RlcmVmQ2FjaGUgPSBudWxsOwogICAgICAgIH0KCiAg\nICAgICAgLy8gZmx1c2ggdG8gc3RvcmUgbWFuYWdlcgogICAgICAgIExpc3Qg\nZXhjZXBzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nZmx1c2ggJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwpIHsKICAgICAgICAg\nICAgICAgIF9mbGFncyB8PSBGTEFHX1NUT1JFX0ZMVVNISU5HOwogICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywKICAgICAgICAgICAgICAg\nICAgICBuZXdGbHVzaEV4Y2VwdGlvbihfc3RvcmUuZmx1c2godHJhbnNhY3Rp\nb25hbCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19TVE9SRV9GTFVTSElORzsKCiAg\nICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfUk9MTEJBQ0spCiAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFn\nZXJUcmFuc2FjdGlvbih0cnVlKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHJl\nYXNvbiAhPSBGTFVTSF9MT0dJQ0FMKQogICAgICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX0ZMVVNIX1JFUVVJUkVEOwoKICAgICAgICAgICAgLy8gbWFy\nayBzdGF0ZXMgYXMgZmx1c2hlZAogICAgICAgICAgICBpZiAoZmx1c2gpIHsK\nICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAg\nICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIHRoZSBzdGF0ZSBtYXkgaGF2ZSBiZWNvbWUgdHJhbnNpZW50LCBzdWNoIGFz\nIGlmCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0IGlzIGVtYmVkZGVk\nIGFuZCB0aGUgb3duZXIgaGFzIGJlZW4gZGVsZXRlZCBkdXJpbmcKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gdGhpcyBmbHVzaCBwcm9jZXNzOyBidWcg\nIzExMDAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3Rh\ndGUoKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uYWZ0ZXJGbHVzaChyZWFzb24pOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAocmVhc29uID09IEZMVVNIX0lOQykgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gaWYgbm90IGFib3V0IHRvIGNsZWFyIHRyYW5zIGNh\nY2hlIGZvciBjb21taXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyBhbnl3YXksIHJlLWNhY2hlIGRpcnR5IG9iamVjdHMgd2l0aCBkZWZhdWx0\nIHNvZnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnM7IHdl\nIGRvbid0IG5lZWQgaGFyZCByZWZzIG5vdyB0aGF0IHRoZSAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNo\nZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnByb3h5RmllbGRz\nKHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90\ncmFuc0NhY2hlLmZsdXNoZWQoc20pOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0aHJvdyBh\nbnkgZXhjZXB0aW9ucyB0byBzaG9ydGN1dCBsaXN0ZW5lcnMgb24gZmFpbAog\nICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwoK\nICAgICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9IEZMVVNIX1JPTExCQUNL\nICYmIHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMCiAgICAgICAgICAgICYmIF90\ncmFuc0V2ZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpKSB7CiAgICAg\nICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2\nZW50KHRoaXMsCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFG\nVEVSX0ZMVVNILCBtb2JqcywgX3BlcnNpc3RlZENsc3MsCiAgICAgICAgICAg\nICAgICBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIG5ld2x5LXRyYW5zYWN0aW9u\nYWwgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoQWRk\naXRpb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikg\newogICAgICAgIGJvb2xlYW4gbG9vcDsKICAgICAgICBkbyB7CiAgICAgICAg\nICAgIC8vIGZsdXNoIG5ldyB0cmFuc2FjdGlvbmFsIGluc3RhbmNlczsgbm90\nZSBsb2dpY2FsIG9yCiAgICAgICAgICAgIGxvb3AgPSBmbHVzaFRyYW5zQWRk\naXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbikKICAgICAgICAgICAgICAg\nIHwgZGVsZXRlRGVyZWZBZGRpdGlvbnMoX2RlcmVmQ2FjaGUpOwogICAgICAg\nIH0gd2hpbGUgKGxvb3ApOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2gg\ndHJhbnNhY3Rpb25hbCBhZGRpdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBmbHVzaFRyYW5zQWRkaXRpb25zKENvbGxlY3Rpb24gdHJhbnNh\nY3Rpb25hbCwgaW50IHJlYXNvbikgewogICAgICAgIGlmIChfdHJhbnNBZGRp\ndGlvbnMgPT0gbnVsbCB8fCBfdHJhbnNBZGRpdGlvbnMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGtlZXAgbG9j\nYWwgdHJhbnNhY3Rpb25hbCBsaXN0IGNvcHkgdXAgdG8gZGF0ZQogICAgICAg\nIHRyYW5zYWN0aW9uYWwuYWRkQWxsKF90cmFuc0FkZGl0aW9ucyk7CgogICAg\nICAgIC8vIGNvcHkgdGhlIGNoYW5nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9y\nIHRoZSBuZXh0IGl0ZXJhdGlvbgogICAgICAgIFN0YXRlTWFuYWdlckltcGxb\nXSBzdGF0ZXMgPSAoU3RhdGVNYW5hZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlv\nbnMuCiAgICAgICAgICAgIHRvQXJyYXkobmV3IFN0YXRlTWFuYWdlckltcGxb\nX3RyYW5zQWRkaXRpb25zLnNpemUoKV0pOwogICAgICAgIF90cmFuc0FkZGl0\naW9ucyA9IG51bGw7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Rh\ndGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBzdGF0ZXNbaV0uYmVmb3Jl\nRmx1c2gocmVhc29uLCBfY2FsbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgbmV3IGRlcmVmZXJlbmNlZCBv\nYmplY3RzLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZGVsZXRlRGVy\nZWZBZGRpdGlvbnMoQ29sbGVjdGlvbiBkZXJlZnMpIHsKICAgICAgICBpZiAo\nX2RlcmVmQWRkaXRpb25zID09IG51bGwgfHwgX2RlcmVmQWRkaXRpb25zLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAv\nLyByZW1lbWJlciB0aGVzZSBhZGRpdGlvbnMgaW4gY2FzZSBvbmUgYmVjb21l\ncyBkZXJlZmVkIGFnYWluIGxhdGVyCiAgICAgICAgZGVyZWZzLmFkZEFsbChf\nZGVyZWZBZGRpdGlvbnMpOwoKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsW10g\nc3RhdGVzID0gKFN0YXRlTWFuYWdlckltcGxbXSkgX2RlcmVmQWRkaXRpb25z\nLgogICAgICAgICAgICB0b0FycmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBsW19k\nZXJlZkFkZGl0aW9ucy5zaXplKCldKTsKICAgICAgICBfZGVyZWZBZGRpdGlv\nbnMgPSBudWxsOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRl\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgZGVsZXRlRGVyZWYoc3RhdGVz\nW2ldKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIERlbGV0ZSBhIGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBkZWxldGVEZXJlZihTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChP\ncENhbGxiYWNrcy5PUF9ERUxFVEUsCiAgICAgICAgICAgIHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpLCBzbSwgbnVsbCk7CiAgICAgICAgaWYgKChhY3Rpb24g\nJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSAhPSAwKQogICAgICAgICAgICBzbS5k\nZWxldGUoKTsKICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFD\nVF9DQVNDQURFKSAhPSAwKQogICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRl\nKF9jYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUg\nYWN0aW9uIHRvIHRha2UgYmFzZWQgb24gdGhlIHVzZXIncyBnaXZlbiBjYWxs\nYmFja3MgYW5kCiAgICAgKiBvdXIgaW1wbGljaXQgYmVoYXZpb3IuCiAgICAg\nKi8KICAgIHByaXZhdGUgaW50IHByb2Nlc3NBcmd1bWVudChpbnQgb3AsIE9i\namVjdCBvYmosIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NBcmd1bWVudChvcCwgb2Jq\nLCBzbSk7CiAgICAgICAgaWYgKF9jYWxsICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBfY2FsbC5wcm9jZXNzQXJndW1lbnQob3AsIG9iaiwgc20pOwog\nICAgICAgIHJldHVybiBPcENhbGxiYWNrcy5BQ1RfUlVOIHwgT3BDYWxsYmFj\na3MuQUNUX0NBU0NBREU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyB0\naGUgcHJvcGVyIGV4Y2VwdGlvbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gc2V0IG9m\nIGZsdXNoIGVycm9ycywgb3IKICAgICAqIGRvIG5vdGhpbmcgaWYgbm8gZXJy\nb3JzIG9jY3VycmVkLgogICAgICovCiAgICBwcml2YXRlIE9wZW5KUEFFeGNl\ncHRpb24gbmV3Rmx1c2hFeGNlcHRpb24oQ29sbGVjdGlvbiBleGNlcHMpIHsK\nICAgICAgICBpZiAoZXhjZXBzID09IG51bGwgfHwgZXhjZXBzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFRocm93YWJs\nZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4Y2Vwcy50b0FycmF5CiAgICAgICAg\nICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXplKCldKTsKICAgICAgICBM\naXN0IGZhaWxlZCA9IG5ldyBBcnJheUxpc3QodC5sZW5ndGgpOwoKICAgICAg\nICAvLyBjcmVhdGUgZmF0YWwgZXhjZXB0aW9uIHdpdGggbmVzdGVkIGV4Y2Vw\ndGlvbnMgZm9yIGFsbCB0aGUgZmFpbGVkCiAgICAgICAgLy8gb2JqZWN0czsg\naWYgYWxsIE9MIGV4Y2VwdGlvbnMsIHRocm93IGEgdG9wLWxldmVsIE9MIGV4\nY2VwdGlvbgogICAgICAgIGJvb2xlYW4gb3B0ID0gdHJ1ZTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgb3B0ICYmIGkgPCB0Lmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIG9wdCA9IHRbaV0gaW5zdGFuY2VvZiBPcHRpbWlzdGljRXhj\nZXB0aW9uOwogICAgICAgICAgICBpZiAob3B0KSB7CiAgICAgICAgICAgICAg\nICBPYmplY3QgZiA9ICgoT3B0aW1pc3RpY0V4Y2VwdGlvbikgdFtpXSkuZ2V0\nRmFpbGVkT2JqZWN0KCk7CiAgICAgICAgICAgICAgICBpZiAoZiAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGZhaWxlZC5hZGQoZik7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG9wdCAmJiAhZmFpbGVkLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICBpZihfc3VwcHJlc3NCYXRjaE9MRUxv\nZ2dpbmcgPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9w\ndGltaXN0aWNFeGNlcHRpb24oX2xvYy5nZXQoImJyb2tlci1zdXBwcmVzc2lu\nZy1leGNlcHRpb25zIix0Lmxlbmd0aCkpOwogICAgICAgICAgICB9ZWxzZXsK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlv\nbihmYWlsZWQsIHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGlmIChvcHQpCiAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4\nY2VwdGlvbih0KTsKICAgICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyb2xsZWQtYmFjayIpKS4KICAgICAgICAgICAgc2V0TmVz\ndGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEVuZCB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiwgbWFraW5n\nIGFwcHJvcHJpYXRlIHN0YXRlIHRyYW5zaXRpb25zLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBlbmRUcmFuc2FjdGlvbihpbnQgc3RhdHVzKSB7CiAg\nICAgICAgLy8gaWYgYSBkYXRhIHN0b3JlIHRyYW5zYWN0aW9uIHdhcyBpbiBw\ncm9ncmVzcywgZG8gdGhlCiAgICAgICAgLy8gYXBwcm9wcmlhdGUgdHJhbnNh\nY3Rpb24gY2hhbmdlCiAgICAgICAgYm9vbGVhbiByb2xsYmFjayA9IHN0YXR1\ncyAhPSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRDsKICAgICAgICBMaXN0IGV4\nY2VwcyA9IG51bGw7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGV4Y2Vw\ncyA9IGFkZChleGNlcHMsIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKHJv\nbGxiYWNrKSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICByb2xsYmFjayA9IHRydWU7CiAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGdvIGJhY2sgdG8gZGVmYXVsdCBub25lIGxvY2sgbGV2ZWwKICAgICAg\nICBfZmMuc2V0UmVhZExvY2tMZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9m\nYy5zZXRXcml0ZUxvY2tMZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9mYy5z\nZXRMb2NrVGltZW91dCgtMSk7CgogICAgICAgIENvbGxlY3Rpb24gdHJhbnNT\ndGF0ZXM7CiAgICAgICAgaWYgKGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkp\nCiAgICAgICAgICAgIHRyYW5zU3RhdGVzID0gX3RyYW5zQ2FjaGU7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICB0cmFuc1N0YXRlcyA9IENvbGxlY3Rpb25z\nLkVNUFRZX1NFVDsKCiAgICAgICAgLy8gZmlyZSBhZnRlciByb2xsYmFjay9j\nb21taXQgZXZlbnQKICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsK\nICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVy\ncygpKSB7CiAgICAgICAgICAgIG1vYmpzID0gbmV3IE1hbmFnZWRPYmplY3RD\nb2xsZWN0aW9uKHRyYW5zU3RhdGVzKTsKICAgICAgICAgICAgaW50IGV2ZW50\nVHlwZSA9IChyb2xsYmFjaykgPyBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX1JP\nTExCQUNLCiAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZU\nRVJfQ09NTUlUOwogICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChu\nZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCBldmVudFR5cGUsIG1vYmpzLCAK\nICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3Ms\nIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCB0\ncmFuc2FjdGlvbmFsIGNhY2hlcyBub3cgc28gdGhhdCBhbGwgdGhlIHJlbW92\nZUZyb21UcmFuc2FjdGlvbgogICAgICAgIC8vIGNhbGxzIGFzIHdlIHRyYW5z\naXRpb24gZWFjaCBvYmplY3QgZG9uJ3QgaGF2ZSB0byBkbyBhbnkgd29yazsg\nZG9uJ3QKICAgICAgICAvLyBjbGVhciB0cmFucyBjYWNoZSBvYmplY3QgYmVj\nYXVzZSB3ZSBzdGlsbCBuZWVkIHRoZSB0cmFuc1N0YXRlcwogICAgICAgIC8v\nIHJlZmVyZW5jZSB0byBpdCBiZWxvdwogICAgICAgIF90cmFuc0NhY2hlID0g\nbnVsbDsKICAgICAgICBpZiAoX3BlcnNpc3RlZENsc3MgIT0gbnVsbCkKICAg\nICAgICAgICAgX3BlcnNpc3RlZENsc3MgPSBudWxsOwogICAgICAgIGlmIChf\ndXBkYXRlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAgX3VwZGF0ZWRDbHNz\nID0gbnVsbDsKICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzICE9IG51bGwpCiAg\nICAgICAgICAgIF9kZWxldGVkQ2xzcyA9IG51bGw7CgogICAgICAgIC8vIG5l\ndyBjYWNoZSB3b3VsZCBnZXQgY2xlYXJlZCBhbnl3YXkgZHVyaW5nIHRyYW5z\naXRpb25zLCBidXQgZG9pbmcgc28KICAgICAgICAvLyBpbW1lZGlhdGVseSBz\nYXZlcyB1cyBzb21lIGxvb2t1cHMKICAgICAgICBfY2FjaGUuY2xlYXJOZXco\nKTsKCiAgICAgICAgLy8gdGVsbCBhbGwgZGVyZWZlZCBpbnN0YW5jZXMgdGhl\neSdyZSBubyBsb25nZXIgZGVyZWZlZDsgd2UgY2FuJ3QKICAgICAgICAvLyBy\nZWx5IG9uIHJvbGxiYWNrIGFuZCBjb21taXQgY2FsbHMgYmVsb3cgY2F1c2Ug\nc29tZSBpbnN0YW5jZXMgbWlnaHQKICAgICAgICAvLyBub3QgYmUgdHJhbnNh\nY3Rpb25hbAogICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFf\nZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRy\nLm5leHQoKSkuc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50CiAgICAgICAgICAg\nICAgICAgICAgKGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIF9kZXJlZkNh\nY2hlID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIHBlcmZvcm0gY29t\nbWl0IG9yIHJvbGxiYWNrIHN0YXRlIHRyYW5zaXRpb25zIG9uIGVhY2ggaW5z\ndGFuY2UKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gdHJhbnNTdGF0ZXMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGlmIChyb2xsYmFjaykgewogICAgICAgICAgICAgICAgICAgIC8v\nIHRlbGwgb2JqZWN0cyB0aGF0IG1heSBoYXZlIGJlZW4gZGVyZWZlZCB0aGVu\nIGZsdXNoZWQKICAgICAgICAgICAgICAgICAgICAvLyAoYW5kIHRoZXJlZm9y\nZSBkZWxldGVkKSB0byB1bi1kZXJlZgogICAgICAgICAgICAgICAgICAgIHNt\nLnNldERlcmVmZXJlbmNlZERlcGVuZGVudChmYWxzZSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0\nYXRlKCkgPT0gUENTdGF0ZS5QTkVXREVMRVRFRCB8fCBzbS5nZXRQQ1N0YXRl\nKCkgPT0gUENTdGF0ZS5QREVMRVRFRCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoc20uZ2V0UGVyc2lzdGVuY2VDYXBh\nYmxlKCksIG51bGwsIHNtLmdldE1ldGFEYXRhKCksIAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVMRVRFX1BF\nUkZPUk1FRCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIHNtLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCByZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIG5vdGlmeSB0aGUgbG9jayBtYW5h\nZ2VyIHRvIGNsZWFuIHVwIGFuZCByZWxlYXNlIHJlbWFpbmluZyBsb2Nrcwog\nICAgICAgIF9sbS5lbmRUcmFuc2FjdGlvbigpOwoKICAgICAgICAvLyBjbGVh\nciBvbGQgc2F2ZXBvaW50cyBpbiByZXZlcnNlCiAgICAgICAgT3BlbkpQQVNh\ndmVwb2ludCBzYXZlOwogICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cyAhPSBu\ndWxsICYmIF9zYXZlcG9pbnRzLnNpemUoKSA+IDApIHsKICAgICAgICAgICAg\nc2F2ZSA9CiAgICAgICAgICAgICAgICAoT3BlbkpQQVNhdmVwb2ludCkgX3Nh\ndmVwb2ludHMucmVtb3ZlKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpOwogICAg\nICAgICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgIH0KICAgICAg\nICBfc2F2ZXBvaW50cyA9IG51bGw7CiAgICAgICAgX3NhdmVwb2ludENhY2hl\nID0gbnVsbDsKCiAgICAgICAgLy8gZmlyZSBhZnRlciBzdGF0ZSBjaGFuZ2Ug\nZXZlbnQKICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExp\nc3RlbmVycygpKQogICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChu\nZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCBUcmFuc2FjdGlvbkV2ZW50Lgog\nICAgICAgICAgICAgICAgQUZURVJfU1RBVEVfVFJBTlNJVElPTlMsIG1vYmpz\nLCBudWxsLCBudWxsLCBudWxsKSk7CgogICAgICAgIC8vIG5vdyBjbGVhciB0\ncmFucyBjYWNoZTsga2VlcCBjbGVhcmVkIHZlcnNpb24gcmF0aGVyIHRoYW4K\nICAgICAgICAvLyBudWxsIHRvIGF2b2lkIGhhdmluZyB0byByZS1jcmVhdGUg\ndGhlIHNldCBsYXRlcjsgbW9yZSBlZmZpY2llbnQKICAgICAgICBpZiAodHJh\nbnNTdGF0ZXMgIT0gQ29sbGVjdGlvbnMuRU1QVFlfU0VUKSB7CiAgICAgICAg\nICAgIF90cmFuc0NhY2hlID0gKFRyYW5zYWN0aW9uYWxDYWNoZSkgdHJhbnNT\ndGF0ZXM7CiAgICAgICAgICAgIF90cmFuc0NhY2hlLmNsZWFyKCk7CiAgICAg\nICAgfQoKICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCB0\ncnVlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nT2JqZWN0IGxpZmVjeWNsZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICBwdWJsaWMgdm9pZCBwZXJzaXN0KE9iamVjdCBvYmosIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBwZXJzaXN0KG9iaiwgbnVsbCwgdHJ1ZSwgY2Fs\nbCk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgcGVy\nc2lzdChPYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIHJldHVybiBwZXJzaXN0KG9iaiwgaWQsIHRy\ndWUsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwo\nQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\ncGVyc2lzdEFsbChvYmpzLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdHMuICBJbmRpY2F0ZSB3\naGV0aGVyIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNpc3QKICAgICAqIChQ\nTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFM\nKS4KICAgICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdEFsbChDb2xsZWN0\naW9uIG9ianMsIGJvb2xlYW4gZXhwbGljaXQsIAogICAgICAgIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CgogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgcGVyc2lzdChpdHIubmV4dCgpLCBleHBsaWNpdCwgY2FsbCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7\nCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBnaXZlbiBlbGVtZW50\nIGlzIG5vdCBudWxsLCBhZGQgaXQgdG8gdGhlIGdpdmVuIGxpc3QsCiAgICAg\nKiBjcmVhdGluZyB0aGUgbGlzdCBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAg\nIHByaXZhdGUgTGlzdCBhZGQoTGlzdCBsLCBPYmplY3QgbykgewogICAgICAg\nIGlmIChvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBsOwogICAgICAg\nIGlmIChsID09IG51bGwpCiAgICAgICAgICAgIGwgPSBuZXcgTGlua2VkTGlz\ndCgpOwogICAgICAgIGwuYWRkKG8pOwogICAgICAgIHJldHVybiBsOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIHdyYXBwaW5n\nIHRoZSBnaXZlbiBuZXN0ZWQgZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHRocm93TmVzdGVkRXhjZXB0aW9ucyhMaXN0IGV4Y2Vwcywg\nYm9vbGVhbiBkYXRhc3RvcmUpIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51\nbGwgfHwgZXhjZXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIGlmIChkYXRhc3RvcmUgJiYgZXhjZXBzLnNpemUoKSA9PSAxKQog\nICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2VwdGlvbikgZXhjZXBzLmdl\ndCgwKTsKCiAgICAgICAgYm9vbGVhbiBmYXRhbCA9IGZhbHNlOwogICAgICAg\nIFRocm93YWJsZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4Y2Vwcy50b0FycmF5\nCiAgICAgICAgICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXplKCldKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKHRbaV0gaW5zdGFuY2VvZiBPcGVuSlBBRXhjZXB0\naW9uCiAgICAgICAgICAgICAgICAmJiAoKE9wZW5KUEFFeGNlcHRpb24pIHRb\naV0pLmlzRmF0YWwoKSkKICAgICAgICAgICAgICAgIGZhdGFsID0gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBlcnI7CiAgICAg\nICAgaWYgKGRhdGFzdG9yZSkKICAgICAgICAgICAgZXJyID0gbmV3IFN0b3Jl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBzIikpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgZXJyID0gbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7CiAgICAgICAgdGhyb3cgZXJyLnNl\ndE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0YWwoZmF0YWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5k\naWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAg\nICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9W\nSVNJT05BTCkKICAgICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdChPYmpl\nY3Qgb2JqLCBib29sZWFuIGV4cGxpY2l0LCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgcGVyc2lzdChvYmosIG51bGwsIGV4cGxpY2l0LCBjYWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVj\ndC4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVy\nc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQ\nTkVXUFJPVklTSU9OQUwpLgogICAgICogU2VlIHtAbGluayBCcm9rZXJ9IGZv\nciBkZXRhaWxzIG9uIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJsaWMg\nT3BlbkpQQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVj\ndCBpZCwgYm9vbGVhbiBleHBsaWNpdCwKICAgICAgICBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24o\nKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICghX29w\nZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsK\nCiAgICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAg\nICAgIGlmIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpCiAgICAg\nICAgICAgICAgICByZXR1cm4gc207CgogICAgICAgICAgICAvLyBBQ1RfQ0FT\nQ0FERQogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNh\nc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBj\nYWxsLAogICAgICAgICAgICAgICAgICAgICAgICAicGVyc2lzdCIpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBBQ1RfUlVOCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYzsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNpc3QtZGV0YWNoZWQiLCBF\neGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAgICAgICAgICAgICAg\nICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CgogICAgICAgICAgICAgICAg\naWYgKCFzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBz\nbS5wZXJzaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLnBlcnNp\nc3Qoc20pOwogICAgICAgICAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BD\nYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBzbTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyBhbiBlbWJlZGRlZCBmaWVsZDsgbm90aWZ5IHRoZSBvd25l\nciB0aGF0IHRoZSB2YWx1ZSBoYXMKICAgICAgICAgICAgICAgIC8vIGNoYW5n\nZWQgYnkgYmVjb21pbmcgaW5kZXBlbmRlbnRseSBwZXJzaXN0ZW50CiAgICAg\nICAgICAgICAgICBzbS5nZXRPd25lcigpLmRpcnR5KHNtLmdldE93bmVySW5k\nZXgoKSk7CiAgICAgICAgICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7CiAg\nICAgICAgICAgICAgICBwYyA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGMgPSBh\nc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsKICAgICAgICAgICAgICAg\nIGlmIChwYy5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNpc3Qt\nZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwg\ndHJ1ZSk7CiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChvYmosIG51\nbGwsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9QRVJTSVNUKTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBpZCBmb3IgaW5zdGFuY2UKICAgICAgICAg\nICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAgCWludCBpZFR5cGUg\nPSBtZXRhLmdldElkZW50aXR5VHlwZSgpOwogICAgICAgICAgICAgICAgaWYg\nKGlkVHlwZSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAg\nICAgICAgICAgICAgICAgIGlkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKHBj\nLCBtZXRhKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlkVHlwZSA9PSBD\nbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93\nbmlkIiwgbWV0YSkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhp\ncyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3\nZSBkb24ndCBhbHJlYWR5IGhhdmUgdGhlIGluc3RhbmNlIGNhY2hlZAogICAg\nICAgICAgICBjaGVja0ZvckR1cGxpY2F0ZUlkKGlkLCBvYmopOwoKICAgICAg\nICAgICAgLy8gaWYgaGFkIGVtYmVkZGVkIHNtLCBudWxsIGl0CiAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGMucGNSZXBs\nYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwoKICAgICAgICAgICAgLy8gY3JlYXRl\nIG5ldyBzbQogICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGV4cGxp\nY2l0KQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUocGMsIFBD\nU3RhdGUuUE5FVyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVXUFJPVklT\nSU9OQUwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5PTlRSQU5TTkVXKTsKICAgICAg\nICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkg\nIT0gMCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwp\nOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZW1wb3JhcmlseSBtYW5hZ2Ug\ndGhlIGdpdmVuIGluc3RhbmNlIGluIG9yZGVyIHRvIGNhc2NhZGUgdGhlIGdp\ndmVuCiAgICAgKiBvcGVyYXRpb24gdGhyb3VnaCBpdC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGNhc2NhZGVUcmFuc2llbnQoaW50IG9wLCBPYmplY3Qg\nb2JqLCBPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFN0cmluZyBlcnJPcCkg\newogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IGFzc2VydFBlcnNp\nc3RlbmNlQ2FwYWJsZShvYmopOwoKICAgICAgICAvLyBpZiB1c2luZyBkZXRh\nY2hlZCBzdGF0ZSBtYW5hZ2VyLCBkb24ndCByZXBsYWNlCiAgICAgICAgaWYg\nKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCBlcnJPcCk7CgogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhKG9i\nai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwoU3RhdGVNYW5h\nZ2VySWQuCiAgICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBtZXRhLCB0\naGlzKTsKICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlRMT0FE\nRUQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAob3ApIHsK\nICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVSU0lTVDoK\nICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgT3BDYWxsYmFja3MuT1BfREVMRVRFOgogICAgICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1JF\nRlJFU0g6CiAgICAgICAgICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJl\nZnJlc2goY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihvcCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAg\nICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBkZWxldGVBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRp\nb24oKTsKCiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAg\nICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG9iaiA9IGl0\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUob2JqLCBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSksIGNhbGwpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAg\nICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvd05lc3RlZEV4\nY2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPYmplY3Qgb2JqLCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7\nCiAgICAgICAgICAgIGRlbGV0ZShvYmosIGdldFN0YXRlTWFuYWdlckltcGwo\nb2JqLCB0cnVlKSwgY2FsbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBkZWxldGUuCiAgICAgKi8K\nICAgIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIFN0YXRlTWFuYWdlckltcGwg\nc20sIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoIV9vcGVyYXRp\nbmcuYWRkKG9iaikpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaW50\nIGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9ERUxF\nVEUsIG9iaiwgc20sIGNhbGwpOwogICAgICAgIGlmIChhY3Rpb24gPT0gT3BD\nYWxsYmFja3MuQUNUX05PTkUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gQUNUX0NBU0NBREUKICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApIHsKICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICghc20uaXNFbWJlZGRlZCgp\nIHx8ICFzbS5nZXREZXJlZmVyZW5jZWRFbWJlZERlcGVuZGVudCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tz\nLk9QX0RFTEVURSwgb2JqLCBjYWxsLCAiZGVsZXRlIik7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIEFDVF9SVU4KICAgICAg\nICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoc20uaXNEZXRh\nY2hlZCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNl\ncHRpb24ob2JqLCAiZGVsZXRlIik7CiAgICAgICAgICAgIGlmICgoYWN0aW9u\nICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApIHsKICAgICAgICAg\nICAgICAgIGlmICghc20uaXNFbWJlZGRlZCgpIHx8ICFzbS5nZXREZXJlZmVy\nZW5jZWRFbWJlZERlcGVuZGVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICB9\nIGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNE\nZXRhY2hlZCgpID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgdGhyb3cg\nbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAiZGVsZXRlIik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gaW5kaWNhdGluZyB0\naGF0IHRoZSBjdXJyZW50IGFjdGlvbiBjYW4ndCBiZQogICAgICogcGVyZm9y\nbWVkIG9uIGEgZGV0YWNoZWQgb2JqZWN0LgogICAgICovCiAgICBwcml2YXRl\nIE9wZW5KUEFFeGNlcHRpb24gbmV3RGV0YWNoZWRFeGNlcHRpb24oT2JqZWN0\nIG9iaiwKICAgICAgICBTdHJpbmcgb3BlcmF0aW9uKSB7CiAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kZXRhY2hlZC1v\ncCIsIG9wZXJhdGlvbiwKICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmlu\nZyhvYmopKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcmVsZWFzZUFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgcmVsZWFzZShpdHIubmV4dCgpLCBjYWxsKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsK\nICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ndGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlKE9iamVjdCBv\nYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7\nCiAgICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfUkVMRUFTRSwgb2JqLCBzbSwgY2FsbCk7CgogICAgICAg\nICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVO\nKSAhPSAwICYmIHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAg\nICBib29sZWFuIHBlbmRpbmcgPSBzbS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFs\nKCk7CiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAg\nICAgICAgICAgaWYgKHBlbmRpbmcpCiAgICAgICAgICAgICAgICAgICAgcmVt\nb3ZlRnJvbVBlbmRpbmdUcmFuc2FjdGlvbihzbSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVtYmVkKE9iamVjdCBvYmosIE9i\namVjdCBpZCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBW\nYWx1ZU1ldGFEYXRhIG93bmVyTWV0YSkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgb3JpZyA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVl\nKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgLy8gaWYgYWxyZWFkeSBlbWJlZGRlZCwgbm90aGluZyB0byBkbwog\nICAgICAgICAgICAgICAgaWYgKG9yaWcuZ2V0T3duZXIoKSA9PSBvd25lciAm\nJiBvcmlnLmdldE1ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRW1iZWRkaW5nTWV0YURhdGEoKSA9PSBvd25lck1ldGEpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG9yaWc7CgogICAgICAgICAgICAgICAgLy8gb3Ro\nZXJ3aXNlIG1ha2Ugc3VyZSBwYyBpcyBmdWxseSBsb2FkZWQgZm9yIHdoZW4g\nd2UgY29weSBpdHMKICAgICAgICAgICAgICAgIC8vIGRhdGEgYmVsb3cKICAg\nICAgICAgICAgICAgIG9yaWcubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwu\nTE9BRF9BTEwsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gY3JlYXRlIG5ldyBzdGF0ZSBtYW5hZ2VyIHdpdGgg\nZW1iZWRkZWQgbWV0YWRhdGEKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gb3duZXJNZXRhLmdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWVtYmVkIiwg\nb3duZXJNZXRhKSk7CgogICAgICAgICAgICBpZiAoaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2Uo\ndGhpcyk7CgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gbmV3\nIFN0YXRlTWFuYWdlckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAg\nICBzbS5zZXRPd25lcigoU3RhdGVNYW5hZ2VySW1wbCkgb3duZXIsIG93bmVy\nTWV0YSk7CgogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgY29weTsK\nICAgICAgICAgICAgUENTdGF0ZSBzdGF0ZTsKICAgICAgICAgICAgQ2xhc3Mg\ndHlwZSA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBp\nZiAob2JqICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGdpdmUgY29w\neSBhbmQgdGhlIG9yaWdpbmFsIGluc3RhbmNlIHRoZSBzYW1lIHN0YXRlIG1h\nbmFnZXIKICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIGNvcHkg\nZmllbGRzIGZyb20gb25lIHRvIHRoZSBvdGhlcgogICAgICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBjb3B5U007CiAgICAgICAgICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUgcGM7CiAgICAgICAgICAgICAgICBpZiAob3JpZyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29weVNNID0gc207CiAg\nICAgICAgICAgICAgICAgICAgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqKTsKICAgICAgICAgICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0\nZU1hbmFnZXIoc20pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICBjb3B5U00gPSBvcmlnOwogICAgICAgICAgICAgICAg\nICAgIHBjID0gb3JpZy5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIC8vIGNvcHkgdGhlIGluc3RhbmNlLiAgd2UgZG8gdGhpcyBl\ndmVuIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeQogICAgICAgICAgICAgICAgICAg\nIC8vIGhhdmUgYSBzdGF0ZSBtYW5hZ2VyIGluIGNhc2UgaXQgaXMgbGF0ZXIg\nYXNzaWduZWQgdG8gYQogICAgICAgICAgICAgICAgICAgIC8vIFBDIGZpZWxk\nOyBhdCB0aGF0IHBvaW50IGl0J3MgdG9vIGxhdGUgdG8gY29weQogICAgICAg\nICAgICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5\ncGUsIGNvcHlTTSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGludFtd\nIGZpZWxkcyA9IG5ldyBpbnRbbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGhdOwog\nICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNb\naV0gPSBpOwogICAgICAgICAgICAgICAgICAgIGNvcHkucGNDb3B5RmllbGRz\nKHBjLCBmaWVsZHMpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENT\ndGF0ZS5FQ09QWTsKICAgICAgICAgICAgICAgICAgICBjb3B5LnBjUmVwbGFj\nZVN0YXRlTWFuYWdlcihudWxsKTsKICAgICAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGluc3RhbmNlIGRp\nZG4ndCBoYXZlIGEgc3RhdGUgbWFuYWdlciB0byBzdGFydCwKICAgICAgICAg\nICAgICAgICAgICAvLyByZXZlcnQgaXQgdG8gYmVpbmcgdHJhbnNpZW50CiAg\nICAgICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlw\nZSwgc20sIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19BQ1RJVkUpICE9IDAgJiYgIV9vcHRpbWlzdGljKQogICAgICAgICAg\nICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FQ0xFQU47CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBQQ1N0YXRl\nLkVOT05UUkFOUzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc20uaW5p\ndGlhbGl6ZShjb3B5LCBzdGF0ZSk7CiAgICAgICAgICAgIHJldHVybiBzbTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIElmIG5vdCBhbHJlYWR5IGNhY2hlZCwgY3JlYXRlIGFuIGVtcHR5IGNvcHkg\nb2YgdGhlIGdpdmVuIHN0YXRlCiAgICAgKiBtYW5hZ2VyIGluIHRoZSBnaXZl\nbiBzdGF0ZS4KICAgICAqLwogICAgT3BlbkpQQVN0YXRlTWFuYWdlciBjb3B5\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weSwgUENTdGF0ZSBzdGF0ZSkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgT2JqZWN0IG9p\nZCA9IGNvcHkuZmV0Y2hPYmplY3RJZCgpOwogICAgICAgICAgICBDbGFzcyB0\neXBlID0gY29weS5nZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRDbGFzcygpOwog\nICAgICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgLy8g\nY2FjaGVkIGluc3RhbmNlPwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtID0gbnVsbDsKICAgICAgICAgICAgaWYgKCFjb3B5LmlzRW1iZWRkZWQo\nKSkKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5\nSWQob2lkLCB0cnVlKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9j\nb25mLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEgPSByZXBvcy5nZXRNZXRhRGF0YSh0eXBlLCBfbG9hZGVyLCB0cnVlKTsK\nICAgICAgICAgICAgICAgIC8vIGNvbnN0cnVjdCBhIG5ldyBzdGF0ZSBtYW5h\nZ2VyIHdpdGggYWxsIGluZm8ga25vd24KICAgICAgICAgICAgICAgIHNtID0g\nbmV3IFN0YXRlTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsKICAgICAg\nICAgICAgICAgIHNtLnNldE9iamVjdElkKG9pZCk7CiAgICAgICAgICAgICAg\nICBzbS5pbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVk\nVHlwZSgpLCBzdGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHNtOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgcmVmcmVzaEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5v\nbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIAog\nICAgICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goaXRyLm5leHQo\nKSwgY2FsbCk7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLmlzRW1wdHko\nKSkKICAgICAgICAgICAgCXJldHVybjsKICAgICAgICAgICAgaWYgKF9vcGVy\nYXRpbmcuc2l6ZSgpID09IDEpCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJu\nYWwoX29wZXJhdGluZy5pdGVyYXRvcigpLm5leHQoKSwgY2FsbCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgCXJlZnJlc2hJbnRlcm5hbChfb3Bl\ncmF0aW5nLCBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVmcmVzaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7Cgog\nICAgICAgICAgICBnYXRoZXJDYXNjYWRlUmVmcmVzaChvYmosIGNhbGwpOwog\nICAgICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIAlyZXR1cm47CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLnNpemUo\nKSA9PSAxKQogICAgICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRp\nbmcuaXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywgY2Fs\nbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2F0aGVy\ncyBhbGwgb2JqZWN0cyByZWFjaGFibGUgdGhyb3VnaCBjYXNjYWRlLXJlZnJl\nc2ggcmVsYXRpb25zCiAgICAgKiBpbnRvIHRoZSBvcGVyYXRpbmcgc2V0Lgog\nICAgICovCiAgICB2b2lkIGdhdGhlckNhc2NhZGVSZWZyZXNoKE9iamVjdCBv\nYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoIV9vcGVyYXRp\nbmcuYWRkKG9iaikpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCBm\nYWxzZSk7CiAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChP\ncENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKTsKICAgICAg\nICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSA9PSAw\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICBzbS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BD\nYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBjYWxsLCAicmVmcmVzaCIpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdp\ndGggdGhlIGZ1bGwgc2V0IG9mIG9iamVjdHMgcmVhY2hhYmxlIHZpYQogICAg\nICogY2FzY2FkZS1yZWZyZXNoIHJlbGF0aW9ucyBmcm9tIHRoZSB1c2VyLWdp\ndmVuIGluc3RhbmNlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVm\ncmVzaEludGVybmFsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgCWlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkp\nCiAgICAJCXJldHVybjsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBpbnN0YW5jZXMg\ndGhhdCBuZWVkIGEgcmVmcmVzaAogICAgICAgICAgICBDb2xsZWN0aW9uIGxv\nYWQgPSBudWxsOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxi\nYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAg\nICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoc20uaXNEZXRhY2hlZCgpKSAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJl\nc2giKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVm\nb3JlUmVmcmVzaCh0cnVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAJ\naWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgCQls\nb2FkID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaW50IGxldmVs\nID0gX2ZjLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaW50IHRpbWVvdXQgPSBfZmMuZ2V0TG9ja1RpbWVvdXQoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCB0aW1l\nb3V0LCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNt\nLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsKICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBj\nSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgID09IEJvb2xl\nYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0\nYWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmVmcmVz\naCBhbGwKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChs\nb2FkLCBudWxsLAogICAgICAgICAgICAgICAgICAgIFN0b3JlTWFuYWdlci5G\nT1JDRV9MT0FEX1JFRlJFU0gsIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAg\nICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3T2Jq\nZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKSk7CgogICAgICAgICAgICAg\nICAgLy8gcGVyZm9ybSBwb3N0LXJlZnJlc2ggdHJhbnNpdGlvbnMgYW5kIG1h\na2Ugc3VyZSBhbGwgZmV0Y2gKICAgICAgICAgICAgICAgIC8vIGdyb3VwIGZp\nZWxkcyBhcmUgbG9hZGVkCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGxvYWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVs\nbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgICAgICBzbS5hZnRlclJlZnJlc2go\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRl\nTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gbm93IGludm9rZSBwb3N0UmVmcmVzaCBvbiBh\nbGwgdGhlIGluc3RhbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRT\ndGF0ZU1hbmFnZXJJbXBsKGl0ci5uZXh0KCksIHRydWUpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmICFzbS5pc0RldGFjaGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChz\nbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVsbCwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLmdldE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50\nLkFGVEVSX1JFRlJFU0gpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2Vw\ncyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVz\ndGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE9wdGltaXphdGlvbiBmb3Igc2luZ2xlLW9iamVjdCByZWZyZXNo\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZWZyZXNoSW50ZXJuYWwo\nT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1h\nbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vz\nc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgc20sIGNh\nbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNo\nZWQoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4\nY2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAgICAgICAgICAgICAgICBlbHNl\nIGlmIChzbS5iZWZvcmVSZWZyZXNoKGZhbHNlKSkgewogICAgICAgICAgICAg\nICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdT\nLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgc20u\nYWZ0ZXJSZWZyZXNoKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBpbnQgbGV2ZWwgPSBfZmMuZ2V0UmVhZExvY2tMZXZlbCgpOwogICAg\nICAgICAgICAgICAgaW50IHRpbWVvdXQgPSBfZmMuZ2V0TG9ja1RpbWVvdXQo\nKTsKICAgICAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwgdGltZW91\ndCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgc20ucmVhZExvY2tl\nZChsZXZlbCwgbGV2ZWwpOwogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNs\nZUV2ZW50KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAg\nICAgICAgICAgICAgIHNtLmdldE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50\nLkFGVEVSX1JFRlJFU0gpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAgICAg\nICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIAogICAgcHVibGlj\nIHZvaWQgcmV0cmlldmVBbGwoQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIGRm\nZ09ubHksCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgewogICAg\nICAgICAgICByZXRyaWV2ZShvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCBkZmdP\nbmx5LCBjYWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQo\nKTsKCiAgICAgICAgICAgIC8vIGNvbGxlY3QgYWxsIGhvbGxvdyBpbnN0YW5j\nZXMgZm9yIGxvYWQKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAg\nICAgQ29sbGVjdGlvbiBsb2FkID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMgPSBu\nZXcgQXJyYXlMaXN0KG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkK\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJy\nZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNQ\nZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNt\ncy5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNt\nLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9h\nZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0\nYWNoZWQoKQogICAgICAgICAgICAgICAgICAgICAgICA9PSBCb29sZWFuLlRS\nVUUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVk\nRXhjZXB0aW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBsb2FkIGFsbCBob2xs\nb3cgaW5zdGFuY2VzCiAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0g\nbnVsbDsKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBfc3RvcmUuRk9SQ0Vf\nTE9BRF9ERkcKICAgICAgICAgICAgICAgICAgICA6IF9zdG9yZS5GT1JDRV9M\nT0FEX0FMTDsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2Fk\nQWxsKGxvYWQsIG51bGwsIG1vZGUsIF9mYywgbnVsbCk7CiAgICAgICAgICAg\nICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3\nT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHJldHJpZXZlIGFsbCBub24tZmFpbGVkIGlu\nc3RhbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMo\nc20uZ2V0SWQoKSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTCiAgICAgICAgICAgICAgICAgICAgOiBTdGF0\nZU1hbmFnZXJJbXBsLkxPQURfQUxMOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAgICAg\nICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChl\neGNlcHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhj\nZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCByZXRyaWV2ZShPYmplY3Qgb2JqLCBib29sZWFuIGRmZ09ubHksIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpCiAg\nICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAg\nICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20gIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlv\nbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlz\nUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IG1vZGUg\nPSAoZGZnT25seSkgPyBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTCiAgICAg\nICAgICAgICAgICAgICAgICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FM\nTDsKICAgICAgICAgICAgICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAg\nICAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVs\nc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRh\nY2hlZCgpCiAgICAgICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJy\nZXRyaWV2ZSIpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGV2aWN0QWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gZXZpY3QgYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9i\namVjdHMKICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdlZFN0\nYXRlcygpOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFu\nYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoc20u\naXNQZXJzaXN0ZW50KCkgJiYgIXNtLmlzRGlydHkoKSkKICAgICAgICAgICAg\nICAgICAgICBldmljdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgY2FsbCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBldmljdEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBldmljdChpdHIubmV4dCgpLCBjYWxsKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKEV4dGVudCBleHRlbnQs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoZXh0ZW50ID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGV2aWN0\nIGFsbCBQQ2xlYW4gYW5kIFBOb25UcmFucyBvYmplY3RzIGluIGV4dGVudAog\nICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSBnZXRNYW5hZ2VkU3RhdGVzKCk7\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAg\nIENsYXNzIGNsczsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBjbHMgPSBzbS5nZXRNZXRhRGF0\nYSgpLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoY2xzID09IGV4dGVudC5nZXRFbGVtZW50VHlwZSgpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHx8IChleHRlbnQuaGFzU3ViY2xhc3NlcygpCiAgICAg\nICAgICAgICAgICAgICAgICAgICYmIGV4dGVudC5nZXRFbGVtZW50VHlwZSgp\nLmlzQXNzaWduYWJsZUZyb20oY2xzKSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGV2aWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBjYWxsKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdChPYmplY3Qgb2JqLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAg\nICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9FVklDVCwg\nb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47\nCgogICAgICAgICAgICBzbS5ldmljdCgpOwogICAgICAgICAgICBpZiAoX2V2\naWN0RGF0YUNhY2hlICYmIHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgRGF0YUNhY2hlIGNhY2hlID0gX2NvbmYuZ2V0RGF0\nYUNhY2hlTWFuYWdlckluc3RhbmNlKCkuc2VsZWN0Q2FjaGUoc20pOwogICAg\nICAgICAgICAgICAgaWYgKGNhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgY2FjaGUucmVtb3ZlKHNtLmdldE9iamVjdElkKCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGRldGFjaChPYmplY3Qgb2JqLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQog\nICAgICAgICAgICBjYWxsID0gX2NhbGw7CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgRGV0YWNoTWFuYWdlcih0aGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoKG9i\naik7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdFtdIGRldGFjaEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9PQkpFQ1RTOwogICAgICAgIGlm\nIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNl\nLCBjYWxsKS5kZXRhY2hBbGwob2Jqcyk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBkZXRhY2hBbGwoY2FsbCwgdHJ1ZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNh\nbGwsIGJvb2xlYW4gZmx1c2gpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBJZiBhIGZsdXNo\nIGlzIGRlc2lyZWQgKGJhc2VkIG9uIGlucHV0IHBhcm0pLCB0aGVuIGNoZWNr\nIGlmIHRoZQogICAgICAgICAgICAvLyAiZGlydHkiIGZsYWcgaXMgc2V0IGJl\nZm9yZSBjYWxsaW5nIGZsdXNoKCkuCiAgICAgICAgICAgIGlmIChmbHVzaCAm\nJiAoX2ZsYWdzICYgRkxBR19GTFVTSF9SRVFVSVJFRCkgIT0gMCkKICAgICAg\nICAgICAgICAgIGZsdXNoKCk7CiAgICAgICAgICAgIGRldGFjaEFsbEludGVy\nbmFsKGNhbGwpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBkZXRhY2hBbGxJbnRlcm5hbChPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgQ29sbGVjdGlvbiBzdGF0ZXMgPSBnZXRNYW5hZ2Vk\nU3RhdGVzKCk7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoIXNtLmlzUGVyc2lz\ndGVudCgpKQogICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAg\nICAgICBlbHNlIGlmICghc20uZ2V0TWV0YURhdGEoKS5pc0RldGFjaGFibGUo\nKSkgewogICAgICAgICAgICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAg\nICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBpZiAoc3RhdGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAg\nICBjYWxsID0gX2NhbGw7CiAgICAgICAgLy8gTWFrZSBzdXJlIEFMTCBlbnRp\ndGllcyBhcmUgZGV0YWNoZWQsIGV2ZW4gbmV3IG9uZXMgdGhhdCBhcmUgbG9h\nZGVkCiAgICAgICAgLy8gZHVyaW5nIHRoZSBkZXRhY2ggcHJvY2Vzc2luZwog\nICAgICAgIGJvb2xlYW4gb3JpZ0Nhc2NhZGUgPSBfY29tcGF0LmdldENhc2Nh\nZGVXaXRoRGV0YWNoKCk7CiAgICAgICAgX2NvbXBhdC5zZXRDYXNjYWRlV2l0\naERldGFjaCh0cnVlKTsgICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIHRydWUsIGNhbGwpCiAgICAg\nICAgICAgICAgICAuZGV0YWNoQWxsKG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVj\ndGlvbihzdGF0ZXMpKTsKICAgICAgICB9IAogICAgICAgIGZpbmFsbHkgewog\nICAgICAgICAgICBfY29tcGF0LnNldENhc2NhZGVXaXRoRGV0YWNoKG9yaWdD\nYXNjYWRlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBh\ndHRhY2goT2JqZWN0IG9iaiwgYm9vbGVhbiBjb3B5TmV3LCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vdCB0\nbyB0cnkgdG8gc2V0IHJvbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWlscwogICAg\nICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2hNYW5hZ2Vy\nKHRoaXMsIGNvcHlOZXcsIGNhbGwpLmF0dGFjaChvYmopOwogICAgICAgICAg\nICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9uIG9lKSB7CiAgICAgICAg\nICAgICAgICBzZXRSb2xsYmFja09ubHkob2UpOwogICAgICAgICAgICAgICAg\ndGhyb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gYXR0YWNoQWxsKENvbGxlY3Rpb24g\nb2JqcywgYm9vbGVhbiBjb3B5TmV3LAogICAgICAgIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIHJldHVybiBFTVBUWV9PQkpFQ1RTOwoKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBt\nYWtlIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25seSBpZiB0\naGlzIGZhaWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIEF0dGFjaE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0YWNoQWxs\nKG9ianMpOwogICAgICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0\naW9uIG9lKSB7CiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHkob2Up\nOwogICAgICAgICAgICAgICAgdGhyb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBub250cmFu\nc2FjdGlvbmFsQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIG5vbnRyYW5zYWN0aW9uYWwoaXRyLm5leHQoKSwgY2FsbCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7\nCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9udHJhbnNhY3Rpb25h\nbChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYg\nKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9i\naiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9w\nQ2FsbGJhY2tzLk9QX05PTlRSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNhbGwp\nCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzbSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgc20ubm9udHJhbnNhY3Rpb25hbCgp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2VzIHRyYW5zYWN0aW9uYWwuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHRyYW5zYWN0aW9uYWxBbGwoQ29sbGVj\ndGlvbiBvYmpzLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sCiAgICAgICAgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9\nPSAxKSB7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwob2Jqcy5pdGVyYXRv\ncigpLm5leHQoKSwgdXBkYXRlVmVyc2lvbiwgY2FsbCk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRy\ndWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbGxlY3QgYWxs\nIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQsIGFuZCBtYWtlIHVubWFuYW5n\nZWQKICAgICAgICAgICAgLy8gaW5zdGFuY2VzIHRyYW5zaWVudC10cmFuc2Fj\ndGlvbmFsCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9IG51bGw7CiAg\nICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc207CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAg\nICAgICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgTGlua2VkSGFzaFNldChv\nYmpzLnNpemUoKSk7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsK\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChw\ncm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJBTlNBQ1RJT05BTCwg\nb2JqLCBzbSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbCkgJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFuYWdlIHRyYW5z\naWVudCBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhID0g\nX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFz\ncygpLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIChTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKSwg\nbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmluaXRp\nYWxpemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlv\nbigpOwogICAgICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2FkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1Zl\ncnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGRh\ndGVWZXJzaW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0\nVXBkYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hl\nY2svdXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewog\nICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAgICAgICBDb2xs\nZWN0aW9uIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChsb2FkICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2Fk\nQWxsKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JDRV9MT0FEX05PTkUsCiAgICAg\nICAgICAgICAgICAgICAgX2ZjLCBudWxsKTsKICAgICAgICAgICAgICAgIGlm\nIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAg\nICAgICAgICAgICAgICBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWls\nZWQpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhbnNhY3Rpb25h\nbFN0YXRlc0FsbChzbXMsIGZhaWxlZCwgZXhjZXBzKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdp\ndmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCB0cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIGJvb2xlYW4gdXBk\nYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNh\nbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAg\nICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAg\nICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNtLmxv\nYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxs\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNpb24o\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAg\nICAgICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwog\nICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7\nIC8vIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAgICAgfSBlbHNlIGlmIChz\nbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNp\nZW50IGluc3RhbmNlCiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgog\nICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygp\nLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIE9iamVjdCBpZCA9\nIFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwogICAgICAgICAg\nICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhp\ncyk7CiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBlcnNp\nc3RlbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAgIFBDU3Rh\ndGUuVENMRUFOKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9u\nIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0cmFuc2FjdGlvbmFsLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNhY3Rpb25hbFN0YXRlc0Fs\nbChDb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlvbiBmYWlsZWQsCiAgICAgICAg\nTGlzdCBleGNlcHMpIHsKICAgICAgICAvLyBtYWtlIGluc3RhbmNlcyB0cmFu\nc2FjdGlvbmFsIGFuZCBtYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVkCiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRh\naW5zKHNtLmdldElkKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rp\nb25hbCgpOwogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhl\neGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gRXh0ZW50LCBRdWVyeQogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICBwdWJsaWMgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFu\nIHN1YmNsYXNzZXMpIHsKICAgICAgICByZXR1cm4gbmV3RXh0ZW50KHR5cGUs\nIHN1YmNsYXNzZXMsIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgRXh0ZW50\nIG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAg\nICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nRXh0ZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlzLCB0eXBl\nLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVudHMgPSBuZXcgUmVm\nZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAgICAg\nICAgICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsKCiAgICAgICAgICAgIHJldHVy\nbiBleHRlbnQ7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJhdG9yKENsYXNzIHR5cGUsIGJv\nb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGJvb2xlYW4gaWdub3JlQ2hhbmdlcykgewogICAgICAgIEV4dGVu\ndCBleHRlbnQgPSBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gp\nOwogICAgICAgIGV4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKGlnbm9yZUNoYW5n\nZXMpOwogICAgICAgIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsKICAgIH0K\nCiAgICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIENsYXNz\nIGNscywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgUXVlcnkgcSA9IG5ld1F1\nZXJ5KGxhbmcsIHF1ZXJ5KTsKICAgICAgICBxLnNldENhbmRpZGF0ZVR5cGUo\nY2xzLCB0cnVlKTsKICAgICAgICByZXR1cm4gcTsKICAgIH0KCiAgICBwdWJs\naWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBxdWVyeSkg\newogICAgICAgIC8vIGNvbW1vbiBtaXN0YWtlcwogICAgICAgIGlmIChxdWVy\neSBpbnN0YW5jZW9mIEV4dGVudCB8fCBxdWVyeSBpbnN0YW5jZW9mIENsYXNz\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW5ldy1xdWVyeSIpKTsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0b3JlUXVlcnkg\nc3EgPSBfc3RvcmUubmV3UXVlcnkobGFuZyk7CiAgICAgICAgICAgIGlmIChz\ncSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBFeHByZXNzaW9uUGFyc2Vy\nIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZyk7\nCiAgICAgICAgICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBzcSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShlcCk7CiAg\nICAgICAgICAgICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX01F\nVEhPRFFMLmVxdWFscyhsYW5nKSkKICAgICAgICAgICAgICAgICAgICBzcSA9\nIG5ldyBNZXRob2RTdG9yZVF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKGxhbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBRdWVy\neSBxID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNxKTsKICAgICAgICAgICAgcS5z\nZXRJZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAg\naWYgKHF1ZXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBxLnNldFF1ZXJ5\nKHF1ZXJ5KTsKCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMKICAgICAg\nICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBf\ncXVlcmllcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hT\nZXQuV0VBSyk7CiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChxKTsKICAgICAg\nICAgICAgcmV0dXJuIHE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBRdWVyeUltcGwgbmV3UXVlcnlJbXBsKFN0cmluZyBs\nYW5nLCBTdG9yZVF1ZXJ5IHNxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBRdWVy\neUltcGwodGhpcywgbGFuZywgc3EpOwogICAgfQoKICAgIHB1YmxpYyBTZXEg\nZ2V0SWRlbnRpdHlTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2Uo\nZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSwgZm1kKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUgZ2l2ZW4gY2xh\nc3MgYW5kIG9wdGlvbmFsIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIFNl\ncSBnZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgLy8gZ2V0IHNlcXVlbmNlIHN0cmF0ZWd5IGZy\nb20gbWV0YWRhdGEKICAgICAgICBpbnQgc3RyYXRlZ3k7CiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQogICAgICAgICAgICBzdHJhdGVneSA9IG1ldGEuZ2V0\nSWRlbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RyYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOwoKICAgICAgICAv\nLyB3ZSBjYW4gaGFuZGxlIG5vbi1uYXRpdmUgc3RyYXRlZ2llcyB3aXRob3V0\nIHRoZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkg\newogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoK\nICAgICAgICAgICAgICAgIHJldHVybiBVVUlESGV4U2VxLmdldEluc3RhbmNl\nKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RS\nSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURTdHJpbmdTZXEuZ2V0\nSW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMu\nVVVJRF9UWVBFNF9IRVg6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJRFR5\ncGU0SGV4U2VxLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFs\ndWVTdHJhdGVnaWVzLlVVSURfVFlQRTRfU1RSSU5HOgogICAgICAgICAgICAg\nICAgcmV0dXJuIFVVSURUeXBlNFN0cmluZ1NlcS5nZXRJbnN0YW5jZSgpOwog\nICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRToKICAg\nICAgICAgICAgICAgIFNlcXVlbmNlTWV0YURhdGEgc21kID0gKGZtZCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgID8gbWV0YS5nZXRJZGVudGl0eVNl\ncXVlbmNlTWV0YURhdGEoKQogICAgICAgICAgICAgICAgICAgIDogZm1kLmdl\ndFZhbHVlU2VxdWVuY2VNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHNtZC5nZXRJbnN0YW5jZShfbG9hZGVyKTsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIC8vIHVzZSBzdG9yZSBtYW5hZ2VyIGZv\nciBuYXRpdmUgc2VxdWVuY2UKICAgICAgICAgICAgICAgIGlmIChmbWQgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCByZXR1\ncm4gYSBzZXF1ZW5jZSBldmVuIGZvciBhcHAgaWQgY2xhc3NlcywKICAgICAg\nICAgICAgICAgICAgICAvLyB3aGljaCBpcyB3aGF0IHdlIHdhbnQgZm9yIGJh\nY2t3YXJkcy1jb21wYXRpYmlsaXR5LgogICAgICAgICAgICAgICAgICAgIC8v\nIEV2ZW4gaWYgdXNlciB1c2VzIEFwcGxpY2F0aW9uIElkZW50aXR5LAogICAg\nICAgICAgICAgICAgICAgIC8vIHVzZXIgbWlnaHQgdXNlIGN1c3RvbSBzZXF1\nZW5jZSBpbmZvcm1hdGlvbi4KICAgICAgICAgICAgICAgICAgICAvLyBTbywg\nZmlyc3QsIHRoZSBzZXF1ZW5jZSBzaG91bGQgYmUgY2hlY2tlZC4KICAgICAg\nICAgICAgICAgICAgICAvLyBUcnlpbmcgdG8gZ2V0IHByaW1hcnkga2V5IGZp\nZWxkIGlmIGl0IGhhcwogICAgICAgICAgICAgICAgICAgIC8vIHNlcXVlbmNl\nIG1ldGEgZGF0YS4KICAgICAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gcGtzID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxsICYmIHBrcy5sZW5ndGggPT0g\nMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzbWQgPSBwa3NbMF0uZ2V0\nVmFsdWVTZXF1ZW5jZU1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc21kID0gbWV0YS5n\nZXRJZGVudGl0eVNlcXVlbmNlTWV0YURhdGEoKTsKICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChzbWQgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc21kLmdldEluc3Rh\nbmNlKF9sb2FkZXIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0\nb3JlSWRTZXF1ZW5jZShtZXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3Jl\nLmdldFZhbHVlU2VxdWVuY2UoZm1kKTsKICAgICAgICB9CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8KICAgIC8vIExvY2tpbmcKICAgIC8vLy8vLy8vLy8vCgog\nICAgcHVibGljIHZvaWQgbG9jayhPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOyAvLyBoYXZl\nIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdheXMgTk9ORQogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGxvY2sob2JqLCBfZmMuZ2V0V3JpdGVMb2NrTGV2\nZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0KCksIGNhbGwpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9iamVjdCBvYmosIGlu\ndCBsZXZlbCwgaW50IHRpbWVvdXQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBs\nKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50\nKE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAg\nICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsIHx8\nICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwgdGltZW91dCwgbnVs\nbCk7CiAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsg\nLy8gdXNlIHNhbWUgbGV2ZWwgZm9yIGZ1dHVyZSB3cml0ZQogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwo\nQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\naWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3Ig\nbG9jayBsZXZlbCBhbHdheXMgTk9ORQogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGxvY2tBbGwob2JqcywgX2ZjLmdldFdyaXRlTG9ja0xldmVsKCksIF9m\nYy5nZXRMb2NrVGltZW91dCgpLAogICAgICAgICAgICAgICAgY2FsbCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwoQ29s\nbGVjdGlvbiBvYmpzLCBpbnQgbGV2ZWwsIGludCB0aW1lb3V0LAogICAgICAg\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXpl\nKCkgPT0gMSkgewogICAgICAgICAgICBsb2NrKG9ianMuaXRlcmF0b3IoKS5u\nZXh0KCksIGxldmVsLCB0aW1lb3V0LCBjYWxsKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNh\nY3Rpb24oKTsKCiAgICAgICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IExp\nbmtlZEhhc2hTZXQob2Jqcy5zaXplKCkpOwogICAgICAgICAgICBPYmplY3Qg\nb2JqOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAg\nICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9MT0NLLCBv\nYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgICAgICYgT3BDYWxsYmFj\na3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmlzUGVy\nc2lzdGVudCgpKQogICAgICAgICAgICAgICAgICAgIHNtcy5hZGQoc20pOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBfbG0ubG9ja0FsbChzbXMsIGxl\ndmVsLCB0aW1lb3V0LCBudWxsKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBzbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpLnJl\nYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLwogICAgLy8gQ29ubmVjdGlv\nbgogICAgLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5j\nZWxBbGwoKSB7CiAgICAgICAgLy8gdGhpcyBtZXRob2QgZG9lcyBub3QgbG9j\naywgc2luY2Ugd2Ugd2FudCB0byBhbGxvdyBhIGRpZmZlcmVudAogICAgICAg\nIC8vIHRocmVhZCB0byBiZSBhYmxlIHRvIGNhbmNlbCBvbiBhIGxvY2tlZC11\ncCBwZXJzaXN0ZW5jZSBtYW5hZ2VyCgogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiB3ZSdyZSBmbHVzaGlu\nZywgaGF2ZSB0byBzZXQgcm9sbGJhY2sgb25seSAtLSBkbyB0aGlzIGJlZm9y\nZSB3ZQogICAgICAgICAgICAvLyBhdHRlbXB0IHRvIGNhbmNlbCwgYmVjYXVz\nZSBvdGhlcndpc2UgdGhlIGNhbmNlbCBtaWdodCBjYXNlIHRoZQogICAgICAg\nICAgICAvLyB0cmFuc2FjdGlvbiB0byBjb21wbGV0ZSBiZWZvcmUgd2UgaGF2\nZSBhIGNoYW5jZSB0byBzZXQgdGhlCiAgICAgICAgICAgIC8vIHJvbGxiYWNr\nIG9ubHkgZmxhZwogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RP\nUkVfRkxVU0hJTkcpICE9IDApCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFj\na09ubHlJbnRlcm5hbChuZXcgVXNlckV4Y2VwdGlvbigpKTsKICAgICAgICAg\nICAgcmV0dXJuIF9zdG9yZS5jYW5jZWxBbGwoKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRDb25uZWN0aW9uKCkg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoIV9jb25mLnN1\ncHBvcnRlZE9wdGlvbnMoKS5jb250YWlucwogICAgICAgICAgICAoX2NvbmYu\nT1BUSU9OX0RBVEFTVE9SRV9DT05ORUNUSU9OKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJjb25uLW5v\ndC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIHJldHVybiBfc3RvcmUuZ2V0Q2xp\nZW50Q29ubmVjdGlvbigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhh\nc0Nvbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nIHJldHVybiAoX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSAhPSAwOwog\nICAgfQoKICAgIC8qKgogICAgICogVGVsbCBzdG9yZSB0byByZXRhaW4gY29u\nbmVjdGlvbiBpZiB3ZSBoYXZlbid0IGFscmVhZHkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCByZXRhaW5Db25uZWN0aW9uKCkgewogICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSA9PSAwKSB7CiAgICAgICAg\nICAgIF9zdG9yZS5yZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX1JFVEFJTkVEX0NPTk47CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVsbCBzdG9yZSB0byByZWxlYXNlIGNvbm5lY3Rp\nb24gaWYgd2UgaGF2ZSByZXRhaW5lZCBvbmUuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZWxlYXNlQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfUkVUQUlORURfQ09OTikgIT0gMCkgewogICAgICAgICAg\nICBfc3RvcmUucmVsZWFzZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgX2Zs\nYWdzICY9IH5GTEFHX1JFVEFJTkVEX0NPTk47CiAgICAgICAgfQogICAgfQoK\nICAgIC8vLy8vLy8vLwogICAgLy8gQ2FjaGUKICAgIC8vLy8vLy8vLwoKICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGdldE1hbmFnZWRPYmplY3RzKCkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdl\ndE1hbmFnZWRTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9uYWxPYmplY3RzKCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9u\nKGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFBlbmRpbmdUcmFuc2FjdGlv\nbmFsT2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5hZ2Vk\nT2JqZWN0Q29sbGVjdGlvbgogICAgICAgICAgICAgICAgKGdldFBlbmRpbmdU\ncmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgQ29sbGVjdGlvbiBnZXREaXJ0eU9iamVjdHMoKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0\nRGlydHlTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGdldE9yZGVyRGlydHlPYmplY3RzKCkgewogICAgICAgIHJl\ndHVybiBfb3JkZXJEaXJ0eTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRP\ncmRlckRpcnR5T2JqZWN0cyhib29sZWFuIG9yZGVyKSB7CiAgICAgICAgX29y\nZGVyRGlydHkgPSBvcmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIGNvcHkgb2YgYWxsIG1hbmFnZWQgc3RhdGUgbWFuYWdlcnMuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldE1hbmFnZWRTdGF0ZXMo\nKSB7CiAgICAgICAgcmV0dXJuIF9jYWNoZS5jb3B5KCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCB0cmFuc2FjdGlvbmFs\nIHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVj\ndGlvbjxTdGF0ZU1hbmFnZXJJbXBsPiBnZXRUcmFuc2FjdGlvbmFsU3RhdGVz\nKCkgewogICAgICAgIGlmICghaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkK\nICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAg\nICAgICByZXR1cm4gX3RyYW5zQ2FjaGUuY29weSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciBvciBub3QgdGhlcmUgYXJlIGFueSB0cmFuc2Fj\ndGlvbmFsIG9iamVjdHMgaW4gdGhlIGN1cnJlbnQKICAgICAqIHBlcnNpc3Rl\nbmNlIGNvbnRleHQuIElmIHRoZXJlIGFyZSBhbnkgaW5zdGFuY2VzIHdpdGgg\ndW50cmFja2VkIHN0YXRlLAogICAgICogdGhpcyBtZXRob2Qgd2lsbCBjYXVz\nZSB0aG9zZSBpbnN0YW5jZXMgdG8gYmUgc2Nhbm5lZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewog\nICAgICAgIF9jYWNoZS5kaXJ0eUNoZWNrKCk7CiAgICAgICAgcmV0dXJuIF90\ncmFuc0NhY2hlICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBjb3B5IG9mIGFsbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vycy4KICAgICAq\nLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0RGlydHlTdGF0ZXMoKSB7\nCiAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAg\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwoKICAgICAg\nICByZXR1cm4gX3RyYW5zQ2FjaGUuY29weURpcnR5KCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBzdGF0ZSBtYW5hZ2Vy\ncyB3aGljaCB3aWxsIGJlY29tZQogICAgICogdHJhbnNhY3Rpb25hbCB1cG9u\nIHRoZSBuZXh0IHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nQ29sbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbFN0YXRlcygpIHsK\nICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAgICAgICByZXR1cm4gbmV3\nIExpbmtlZEhhc2hTZXQoX3BlbmRpbmcpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBjYWNoZWQgU3RhdGVNYW5hZ2VyIGZvciB0aGUgaW5zdGFu\nY2UgdGhhdCBoYWQgdGhlIGdpdmVuIG9pZC4KICAgICAqIFRoaXMgbWV0aG9k\nIG11c3Qgbm90IGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBmb3IgbmV3IGlu\nc3RhbmNlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gaWQgdGhlIGlkIHByZXZp\nb3VzbHkgdXNlZCBieSB0aGUgaW5zdGFuY2UKICAgICAqIEBwYXJhbSBzbSB0\naGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGluc3RhbmNlOyBpZiB0aGUgc3Rh\ndGUKICAgICAqIG1hbmFnZXIgaXMgdHJhbnNpZW50LCB3ZSdsbCBzdG9wIG1h\nbmFnaW5nIHRoZSBpbnN0YW5jZTsKICAgICAqIGlmIGl0IGhhcyB1cGRhdGVk\nIGl0cyBvaWQsIHdlJ2xsIHJlLWNhY2hlIHVuZGVyIHRoZSBuZXcgb2lkCiAg\nICAgKiBAcGFyYW0gc3RhdHVzIG9uZSBvZiBvdXIgU1RBVFVTIGNvbnN0YW50\ncyBkZXNjcmliaW5nIHdoeSB3ZSdyZQogICAgICogc2V0dGluZyB0aGUgc3Rh\ndGUgbWFuYWdlcgogICAgICovCiAgICB2b2lkIHNldFN0YXRlTWFuYWdlcihP\nYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20sIGludCBzdGF0dXMpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3dp\ndGNoIChzdGF0dXMpIHsKICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX0lO\nSVQ6CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLmFkZChzbSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNU\nQVRVU19UUkFOU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLnJl\nbW92ZShpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBTVEFUVVNfT0lEX0FTU0lHTjoKICAgICAgICAg\nICAgICAgICAgICBhc3NpZ25PYmplY3RJZChfY2FjaGUsIGlkLCBzbSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFNUQVRVU19DT01NSVRfTkVXOgogICAgICAgICAgICAgICAgICAgIF9jYWNo\nZS5jb21taXROZXcoaWQsIHNtKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlm\neSB0aGUgYnJva2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hv\ndWxkCiAgICAgKiBiZSBhZGRlZCB0byB0aGUgc2V0IG9mIGluc3RhbmNlcyBp\nbnZvbHZlZCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KICAgICAqLwog\nICAgdm9pZCBhZGRUb1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20p\nIHsKICAgICAgICAvLyB3ZSBvbmx5IGFkZCBjbGVhbiBpbnN0YW5jZXMgbm93\nOyBkaXJ0eSBpbnN0YW5jZXMgYXJlIGFkZGVkIGluCiAgICAgICAgLy8gdGhl\nIHNldERpcnR5IGNhbGxiYWNrCiAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0\ncygpKQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNh\nY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAgX3RyYW5z\nQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0IHRoZSBn\naXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgcmVtb3ZlZCBm\ncm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRoZSBjdXJy\nZW50IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJlbW92ZUZyb21U\ncmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJhbnNDYWNo\nZSAhPSBudWxsKQogICAgICAgICAgICAgICAgLy8gaW50ZW50aW9uYWwgZGly\nZWN0IGFjY2Vzczsgd2UgZG9uJ3Qgd2FudCB0byByZWNvbXB1dGUKICAgICAg\nICAgICAgICAgIC8vIGRpcnRpbmVzcyB3aGlsZSByZW1vdmluZyBpbnN0YW5j\nZXMgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgICAgICAgICAgICAgIF90cmFu\nc0NhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNo\nZSAhPSBudWxsICYmICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAg\nICAgIF9kZXJlZkNhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIGdpdmVuIGluc3Rh\nbmNlIGhhcyBiZWVuIGRpcnRpZWQuIFRoaXMKICAgICAqIG5vdGlmaWNhdGlv\nbiBpcyBnaXZlbiB3aGVuIGFuIG9iamVjdCBmaXJzdCB0cmFuc2l0aW9ucyB0\nbyBhIGRpcnR5IHN0YXRlLAogICAgICogYW5kIGV2ZXJ5IHRpbWUgdGhlIG9i\namVjdCBpcyBtb2RpZmllZCBieSB0aGUgdXNlciB0aGVyZWFmdGVyLgogICAg\nICovCiAgICB2b2lkIHNldERpcnR5KFN0YXRlTWFuYWdlckltcGwgc20sIGJv\nb2xlYW4gZmlyc3REaXJ0eSkgewogICAgICAgIGlmIChzbS5pc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlS\nRUQ7CgogICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2\nZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9p\nbnRDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3NhdmVwb2ludENh\nY2hlID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3NhdmVwb2ludENh\nY2hlLmFkZChzbSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmlyc3REaXJ0\neSAmJiBzbS5pc1RyYW5zYWN0aW9uYWwoKSkgewogICAgICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBjYWNo\nZSBkaXJ0eSBpbnN0YW5jZQogICAgICAgICAgICAgICAgaWYgKCFoYXNUcmFu\nc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAgICAgICAgICAgICAgIF90cmFu\nc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZShfb3JkZXJEaXJ0eSk7\nCiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7Cgog\nICAgICAgICAgICAgICAgLy8gYWxzbyByZWNvcmQgdGhhdCB0aGUgY2xhc3Mg\naXMgZGlydHkKICAgICAgICAgICAgICAgIGlmIChzbS5pc05ldygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xz\ncy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5pc0RlbGV0ZWQoKSkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChfZGVsZXRlZENsc3MgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzID0gbmV3IEhh\nc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MuYWRk\nKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF91\ncGRhdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBf\ndXBkYXRlZENsc3MgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAg\nICAgIF91cGRhdGVkQ2xzcy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNj\ncmliZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIC8vIGlmIHRyYWNraW5nIGNoYW5nZXMgYW5kIHRoaXMgaW5zdGFuY2Ug\nd2Fzbid0IGFscmVhZHkgZGlydHksCiAgICAgICAgICAgICAgICAvLyBhZGQg\ndG8gY2hhbmdlZCBzZXQ7IHdlIHVzZSB0aGlzIGZvciBkZXRlY3RpbmcgaW5z\ndGFuY2VzIHRoYXQKICAgICAgICAgICAgICAgIC8vIGVudGVyIHRoZSB0cmFu\nc2FjdGlvbiBkdXJpbmcgcHJlIHN0b3JlCiAgICAgICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbmV3IEhhc2hT\nZXQoKTsKICAgICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMuYWRk\nKHNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBicm9r\nZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAq\nIGJlIGFkZGVkIHRvIHRoZSBzZXQgb2YgaW5zdGFuY2VzIHRoYXQgd2lsbCBi\nZWNvbWUgdHJhbnNhY3Rpb25hbAogICAgICogb24gdGhlIG5leHQgdHJhbnNh\nY3Rpb24KICAgICAqLwogICAgdm9pZCBhZGRUb1BlbmRpbmdUcmFuc2FjdGlv\nbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfcGVuZGluZyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgX3BlbmRpbmcgPSBuZXcgSGFzaFNldCgpOwogICAg\nICAgICAgICBfcGVuZGluZy5hZGQoc20pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0\nIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgcmVt\nb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRo\nZSBuZXh0IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJlbW92ZUZy\nb21QZW5kaW5nVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nX3BlbmRpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wZW5kaW5nLnJl\nbW92ZShzbSk7CiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxs\nICYmICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgIF9kZXJl\nZkNhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmplY3QgdG8gdGhl\nIHBlcnNpc3RlbmNlIG1hbmFnZXIncyBjYWNoZS4KICAgICAqIE9uIGZsdXNo\nLCB0aGVzZSBvYmplY3RzIHdpbGwgYmUgZGVsZXRlZC4KICAgICAqLwogICAg\ndm9pZCBhZGREZXJlZmVyZW5jZWREZXBlbmRlbnQoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBpZiB3ZSdyZSBpbiB0aGUgbWlkZGxlIG9mIGZsdXNoIGFuZCBp\nbnRyb2R1Y2luZyBtb3JlIGRlcmVmcwogICAgICAgICAgICAvLyB2aWEgaW5z\ndGFuY2UgY2FsbGJhY2tzLCBhZGQgdGhlbSB0byB0aGUgc3BlY2lhbCBhZGRp\ndGlvbnMgc2V0CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19ERVJF\nRkRFTEVUSU5HKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlcmVm\nQWRkaXRpb25zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2RlcmVm\nQWRkaXRpb25zID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIF9k\nZXJlZkFkZGl0aW9ucy5hZGQoc20pOwogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUgPSBuZXcgSGFzaFNldCgpOwog\nICAgICAgICAgICAgICAgX2RlcmVmQ2FjaGUuYWRkKHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBnaXZlbiBwcmV2aW91c2x5IGRlcmVmZXJlbmNlZCBkZXBlbmRl\nbnQgb2JqZWN0IGZyb20gdGhlCiAgICAgKiBjYWNoZS4gSXQgaXMgbm93IHJl\nZmVyZW5jZWQuCiAgICAgKi8KICAgIHZvaWQgcmVtb3ZlRGVyZWZlcmVuY2Vk\nRGVwZW5kZW50KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVk\nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChfZGVyZWZBZGRpdGlvbnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJlbW92ZWQgPSBfZGVyZWZBZGRpdGlv\nbnMucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKCFyZW1vdmVkICYmIChf\nZGVyZWZDYWNoZSA9PSBudWxsIHx8ICFfZGVyZWZDYWNoZS5yZW1vdmUoc20p\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1kZXJlZmVkIiwKICAgICAgICAgICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHNtLmdldE1hbmFnZWRJbnN0YW5j\nZSgpKSkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChz\nbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkuCiAgICAgICAgICAgICAgICAgICAg\nc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGRpcnR5VHlwZShDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdXBk\nYXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xz\ncyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIF91cGRhdGVkQ2xzcy5h\nZGQoY2xzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gZ2V0UGVyc2lzdGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF9wZXJz\naXN0ZWRDbHNzID09IG51bGwgfHwgX3BlcnNpc3RlZENsc3MuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwog\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0\naW9uKF9wZXJzaXN0ZWRDbHNzKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRVcGRhdGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF91cGRhdGVk\nQ2xzcyA9PSBudWxsIHx8IF91cGRhdGVkQ2xzcy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX3Vw\nZGF0ZWRDbHNzKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRE\nZWxldGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9PSBu\ndWxsIHx8IF9kZWxldGVkQ2xzcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX2RlbGV0ZWRDbHNz\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gQ2xvc2luZwogICAg\nLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsK\nICAgICAgICByZXR1cm4gX2Nsb3NlZDsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0Nsb3NlSW52b2tlZCgpIHsKICAgICAgICByZXR1cm4gX2Nsb3Nl\nZCB8fCAoX2ZsYWdzICYgRkxBR19DTE9TRV9JTlZPS0VEKSAhPSAwOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB0\naHJvdyBhbiBleGNlcHRpb24gaWYgY2xvc2luZyBpbiBhbiBhY3RpdmUgbG9j\nYWwgdHJhbnMKICAgICAgICAgICAgaWYgKCFfbWFuYWdlZCAmJiAoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJhY3RpdmUiKSk7\nCgogICAgICAgICAgICAvLyBvbmx5IGNsb3NlIGlmIG5vdCBhY3RpdmU7IGlm\nIGFjdGl2ZSBtYW5hZ2VkIHRyYW5zIHdhaXQKICAgICAgICAgICAgLy8gZm9y\nIGNvbXBsZXRpb24KICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfQ0xPU0Vf\nSU5WT0tFRDsKCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpID09IDApCiAgICAgICAgICAgICAgICBmcmVlKCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogRnJlZSB0aGUgcmVzb3VyY2VzIHVz\nZWQgYnkgdGhpcyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBmcmVlKCkgewogICAgICAgIFJ1bnRpbWVFeGNlcHRp\nb24gZXJyID0gbnVsbDsKICAgICAgICBpZiAoKF9hdXRvRGV0YWNoICYgREVU\nQUNIX0NMT1NFKSAhPSAwKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChfY2FsbCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\nICAgIGVyciA9IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBfc3luYyA9IG51bGw7CiAgICAgICAgX3VzZXJPYmplY3RzID0gbnVsbDsK\nICAgICAgICBfY2FjaGUuY2xlYXIoKTsKICAgICAgICBfdHJhbnNDYWNoZSA9\nIG51bGw7CiAgICAgICAgX3BlcnNpc3RlZENsc3MgPSBudWxsOwogICAgICAg\nIF91cGRhdGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlbGV0ZWRDbHNzID0g\nbnVsbDsKICAgICAgICBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICAgICAgX3Bl\nbmRpbmcgPSBudWxsOwogICAgICAgIF9sb2FkZXIgPSBudWxsOwogICAgICAg\nIF90cmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICAgICAgX2xpZmVFdmVu\ndE1hbmFnZXIgPSBudWxsOwoKICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNh\ndmU7CiAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgIV9z\nYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBzYXZlID0KICAg\nICAgICAgICAgICAgIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5y\nZW1vdmUoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgIHNh\ndmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAgfQogICAgICAgIF9zYXZlcG9p\nbnRzID0gbnVsbDsKICAgICAgICBfc2F2ZXBvaW50Q2FjaGUgPSBudWxsOwoK\nICAgICAgICBpZiAoX3F1ZXJpZXMgIT0gbnVsbCkgewogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9xdWVyaWVzLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICgoUXVlcnkpIGl0ci5uZXh0KCkpLmNsb3NlUmVzb3VyY2Vz\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgX3F1ZXJpZXMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKF9leHRlbnRzICE9IG51bGwpIHsKICAgICAgICAgICAgRXh0ZW50IGU7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2V4dGVudHMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGUgPSAo\nRXh0ZW50KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBlLmNsb3NlQWxsKCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2V4dGVudHMgPSBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsgcmVsZWFzZUNvbm5lY3Rp\nb24oKTsgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkge30KCiAgICAg\nICAgX2xtLmNsb3NlKCk7CiAgICAgICAgX3N0b3JlLmNsb3NlKCk7CiAgICAg\nICAgX2ZsYWdzID0gMDsKICAgICAgICBfY2xvc2VkID0gdHJ1ZTsKICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfY2xv\nc2VkRXhjZXB0aW9uID0gbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwoK\nICAgICAgICBfZmFjdG9yeS5yZWxlYXNlQnJva2VyKHRoaXMpOwoKICAgICAg\nICBpZiAoZXJyICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IGVycjsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTeW5jaHJvbml6\nYXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9p\nZCBsb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKSAKICAgICAg\nICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVu\nbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAgICAg\nICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CiAgICAKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBtYW5hZ2VtZW50CiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBPYmplY3QgbmV3SW5zdGFuY2Uo\nQ2xhc3MgY2xzKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICBp\nZiAoIWNscy5pc0ludGVyZmFjZSgpICYmIE1vZGlmaWVyLmlzQWJzdHJhY3Qo\nY2xzLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAoIm5ldy1hYnN0cmFjdCIsIGNscykuZ2V0TWVzc2FnZSgpKTsK\nCiAgICAgICAgLy8gMS41IGRvZXNuJ3QgaW5pdGlhbGl6ZSBjbGFzc2VzIHdp\ndGhvdXQgYSB0cnVlIENsYXNzLmZvck5hbWUKICAgICAgICBpZiAoIVBDUmVn\naXN0cnkuaXNSZWdpc3RlcmVkKGNscykpIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdldE5hbWUoKSwg\ndHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNscykpKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgaWYgKF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCkuZ2V0TWV0YURhdGEoY2xzLAogICAgICAgICAgICBnZXRD\nbGFzc0xvYWRlcigpLCBmYWxzZSkgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgIF9sb2MuZ2V0KCJuby1pbnRlcmZhY2UtbWV0YWRhdGEiLCBjbHMuZ2V0\nTmFtZSgpKS5nZXRNZXNzYWdlKCkpOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShjbHMsIG51bGws\nIGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24gaXNlKSB7CiAgICAgICAgICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbiBpYWUgPQogICAgICAgICAgICAgICAgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbihpc2UuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWFlLnNl\ndFN0YWNrVHJhY2UoaXNlLmdldFN0YWNrVHJhY2UoKSk7CiAgICAgICAgICAg\nIHRocm93IGlhZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBnZXRPYmplY3RJZChPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmop\nKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5j\nZUNhcGFibGUob2JqLCBfY29uZikpCiAgICAgICAgICAgICAgICAucGNGZXRj\naE9iamVjdElkKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRMb2NrTGV2ZWwoT2JqZWN0IG8pIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05FOwoKICAgICAgICBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtID0gZ2V0U3RhdGVNYW5hZ2VyKG8pOwogICAg\nICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTG9ja0xl\ndmVscy5MT0NLX05PTkU7CiAgICAgICAgcmV0dXJuIGdldExvY2tNYW5hZ2Vy\nKCkuZ2V0TG9ja0xldmVsKHNtKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldFZlcnNpb24oT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkK\nICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VD\nYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0dldFZlcnNpb24oKTsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5\nKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\naWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpIHsKICAgICAgICAg\nICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNp\nc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsKICAgICAgICAgICAgcmV0dXJu\nIHBjLnBjSXNEaXJ0eSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFuc2FjdGlvbmFs\nKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\naWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAg\nIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmos\nIF9jb25mKSkKICAgICAgICAgICAgICAgIC5wY0lzVHJhbnNhY3Rpb25hbCgp\nOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1BlcnNpc3RlbnQoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUo\nb2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS4KICAgICAgICAgICAgICAgICAg\nICBwY0lzUGVyc2lzdGVudCgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc05ldyhPYmplY3Qgb2JqKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlz\nTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNOZXco\nKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNEZWxldGVkKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9i\naikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNJc0RlbGV0ZWQoKTsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNE\nZXRhY2hlZChPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYgKCEoSW1wbEhlbHBl\nci5pc01hbmFnZWFibGUob2JqKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsKICAgICAgICBC\nb29sZWFuIGRldGFjaGVkID0gcGMucGNJc0RldGFjaGVkKCk7CiAgICAgICAg\naWYgKGRldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBkZXRh\nY2hlZC5ib29sZWFuVmFsdWUoKTsKCiAgICAgICAgLy8gbGFzdCByZXNvcnQ6\nIGluc3RhbmNlIGlzIGRldGFjaGVkIGlmIGl0IGhhcyBhIHN0b3JlIHJlY29y\nZAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhKEltcGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKHBjKS5nZXRDbGFz\ncygpLAogICAgICAgICAgICAgICAgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAg\nT2JqZWN0IG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywgbWV0YSk7\nCiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgcmV0dXJuIGZpbmQob2lkLCBudWxsLCBFWENMVURF\nX0FMTCwgbnVsbCwgMCkgIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBnZXRTdGF0ZU1hbmFnZXIoT2JqZWN0IG9iaikg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIGlu\nc3RhbmNlLCBvciBudWxsLgogICAgICoKICAgICAqIEBwYXJhbSBhc3NlcnRU\naGlzQ29udGV4dCBpZiB0cnVlLCB0aG93IGFuIGV4Y2VwdGlvbiBpZiB0aGUg\nZ2l2ZW4KICAgICAqIG9iamVjdCBpcyBtYW5hZ2VkIGJ5IGFub3RoZXIgYnJv\na2VyCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGdl\ndFN0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9iaiwKICAgICAgICBib29sZWFu\nIGFzc2VydFRoaXNDb250ZXh0KSB7CiAgICAgICAgaWYgKEltcGxIZWxwZXIu\naXNNYW5hZ2VhYmxlKG9iaikpIHsKICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShv\nYmosIF9jb25mKTsKICAgICAgICAgICAgQnJva2VySW1wbCBwY0Jyb2tlciA9\nIChCcm9rZXJJbXBsKXBjLnBjR2V0R2VuZXJpY0NvbnRleHQoKTsKICAgICAg\nICAgICAgaWYgKHBjQnJva2VyID09IHRoaXMgfHwgaXNGcm9tV3JpdGVCZWhp\nbmRDYWxsYmFjaygpKQogICAgICAgICAgICAgICAgcmV0dXJuIChTdGF0ZU1h\nbmFnZXJJbXBsKSBwYy5wY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAgICAg\nICBpZiAoYXNzZXJ0VGhpc0NvbnRleHQgJiYgcGNCcm9rZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtbWFuYWdlZCIsCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0\naW9ucy50b1N0cmluZyhvYmopKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4g\nb2lkLgogICAgICoKICAgICAqIEBwYXJhbSBhbGxvd05ldyBpZiB0cnVlLCBv\nYmplY3RzIG1hZGUgcGVyc2lzdGVudCBpbiB0aGUgY3VycmVudAogICAgICog\ndHJhbnNhY3Rpb24gd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgc2VhcmNoOyBp\nZgogICAgICogbXVsdGlwbGUgbmV3IG9iamVjdHMgbWF0Y2ggdGhlIGdpdmVu\nIG9pZCwgaXQgaXMKICAgICAqIHVuZGVmaW5lZCB3aGljaCB3aWxsIGJlIHJl\ndHVybmVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBs\nIGdldFN0YXRlTWFuYWdlckltcGxCeUlkKE9iamVjdCBvaWQsCiAgICAgICAg\nYm9vbGVhbiBhbGxvd05ldykgewogICAgICAgIHJldHVybiBfY2FjaGUuZ2V0\nQnlJZChvaWQsIGFsbG93TmV3KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgZ2l2ZW4gaW5zdGFuY2UgYXMgYSB7QGxpbmsgUGVyc2lzdGVu\nY2VDYXBhYmxlfS4KICAgICAqIElmIHRoZSBpbnN0YW5jZSBpcyBub3QgbWFu\nYWdlYWJsZSB0aHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlvbi4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBhc3NlcnRQZXJzaXN0\nZW5jZUNhcGFibGUoT2JqZWN0IG9iaikgewogICAgICAgIGlmIChvYmogPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKElt\ncGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVy\nbiBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYp\nOwoKICAgICAgICAvLyBjaGVjayBmb3IgZGlmZmVyZW50IGluc3RhbmNlcyBv\nZiB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZQogICAgICAgIC8v\nIGFuZCB0aHJvdyBhIGJldHRlciBlcnJvciB0aGF0IG1lbnRpb25zIHRoZSBj\nbGFzcyBsb2FkZXJzCiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9IG9iai5nZXRD\nbGFzcygpLmdldEludGVyZmFjZXMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaW50ZnMgIT0gbnVsbCAmJiBpIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGludGZzW2ldLmdldE5hbWUoKS5lcXVhbHMoUGVy\nc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmdldE5hbWUoKSkpIHsKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1s\nb2FkZXItZGlmZmVyZW50IiwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRp\nb25zLnRvU3RyaW5nKG9iaiksCiAgICAgICAgICAgICAgICAgICAgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlLmNs\nYXNzKSksCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGludGZzW2ldKSkpKQogICAg\nICAgICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90IGVuaGFuY2VkCiAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBjLWNh\nc3QiLAogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5z\nZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgIH0KCiAgICAvLy8vLy8vLy8KICAg\nIC8vIFV0aWxzCiAgICAvLy8vLy8vLy8KICAgIC8qKgogICAgICogVGhyb3cg\nYW4gZXhjZXB0aW9uIGlmIHRoZSBjb250ZXh0IGlzIGNsb3NlZC4gIFRoZSBl\neGFjdCBtZXNzYWdlIGFuZAogICAgICogY29udGVudCBvZiB0aGUgZXhjZXB0\naW9uIHZhcmllcyB3aGV0aGVyIFRSQUNFIGlzIGVuYWJsZWQgb3Igbm90Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVuKCkgewogICAgICAg\nIGlmIChfY2xvc2VkKSB7CiAgICAgICAgICAgIGlmIChfY2xvc2VkRXhjZXB0\naW9uID09IG51bGwpICAvLyBUUkFDRSBub3QgZW5hYmxlZAogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgiY2xvc2VkLW5vdHJhY2UiKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIE9wZW5KUEFFeGNlcHRpb24gZSA9IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoImNsb3Nl\nZCIpLCBfY2xvc2VkRXhjZXB0aW9uKS5zZXRGYXRhbCh0cnVlKTsKICAgICAg\nICAgICAgICAgIGUuc2V0Q2F1c2UoX2Nsb3NlZEV4Y2VwdGlvbik7CiAgICAg\nICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9u\nKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAp\nCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhyb3cgZXhjZXB0aW9uIGlmIGEgdHJhbnNhY3Rpb24tcmVsYXRlZCBv\ncGVyYXRpb24gaXMgYXR0ZW1wdGVkIGFuZAogICAgICogbm8gdHJhbnNhY3Rp\nb24gaXMgYWN0aXZlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0\nVHJhbnNhY3Rpb25PcGVyYXRpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWFjdGl2ZSIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb250cmFuc2FjdGlvbmFs\nUmVhZCgpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwICYmICFfbm9udHJhbnNSZWFkKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVh\nZCIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRXcml0ZU9wZXJh\ndGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwICYmICghX25vbnRyYW5zV3JpdGUKICAgICAgICAgICAgfHwgKF9hdXRv\nRGV0YWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJ3\ncml0ZS1vcGVyYXRpb24iKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYW4gb2JqZWN0IG5vdCBmb3VuZCBleGNlcHRpb24gY29udGFpbmluZyBu\nZXN0ZWQgZXhjZXB0aW9ucwogICAgICogZm9yIGFsbCBvZiB0aGUgZ2l2ZW4g\nZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0\naW9uCiAgICAgICAgKENvbGxlY3Rpb24gZmFpbGVkKSB7CiAgICAgICAgVGhy\nb3dhYmxlW10gdCA9IG5ldyBUaHJvd2FibGVbZmFpbGVkLnNpemUoKV07CiAg\nICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspCiAg\nICAgICAgICAgIHRbaWR4XSA9IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihpdHIubmV4dCgpKTsKICAgICAgICByZXR1cm4gbmV3IE9iamVjdE5vdEZv\ndW5kRXhjZXB0aW9uKGZhaWxlZCwgdCk7CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZpbmRDYWxsYmFja3Mg\naW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBwcm9jZXNzQXJndW1lbnQoT2Jq\nZWN0IG9pZCkgewogICAgICAgIHJldHVybiBvaWQ7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBwcm9jZXNzUmV0dXJuKE9iamVjdCBvaWQsIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICByZXR1cm4gKHNtID09IG51bGwp\nID8gbnVsbCA6IHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpOwogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdChPYmplY3RPdXRwdXRTdHJlYW0g\nb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKGlzQWN0aXZlKCkpIHsKICAgICAgICAgICAgICAgIGlmICghZ2V0T3B0\naW1pc3RpYygpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIF9s\nb2MuZ2V0KCJjYW50LXNlcmlhbGl6ZS1wZXNzaW1pc3RpYy1icm9rZXIiKSk7\nCiAgICAgICAgICAgICAgICBpZiAoaGFzRmx1c2hlZCgpKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJjYW50LXNlcmlhbGl6\nZS1mbHVzaGVkLWJyb2tlciIpKTsKICAgICAgICAgICAgICAgIGlmIChoYXND\nb25uZWN0aW9uKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nX2xvYy5nZXQoImNhbnQtc2VyaWFsaXplLWNvbm5lY3RlZC1icm9rZXIiKSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBfaXNTZXJpYWxpemluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBv\ndXQud3JpdGVPYmplY3QoX2ZhY3RvcnkuZ2V0UG9vbEtleSgpKTsKICAgICAg\nICAgICAgICAgIG91dC5kZWZhdWx0V3JpdGVPYmplY3QoKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9pc1NlcmlhbGl6aW5n\nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIHJlYWRPYmplY3QoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAg\nICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIElPRXhjZXB0\naW9uIHsKICAgICAgICBPYmplY3QgZmFjdG9yeUtleSA9IGluLnJlYWRPYmpl\nY3QoKTsKICAgICAgICBBYnN0cmFjdEJyb2tlckZhY3RvcnkgZmFjdG9yeSA9\nCiAgICAgICAgICAgIEFic3RyYWN0QnJva2VyRmFjdG9yeS5nZXRQb29sZWRG\nYWN0b3J5Rm9yS2V5KGZhY3RvcnlLZXkpOwoKICAgICAgICAvLyB0aGlzIG5l\nZWRzIHRvIGhhcHBlbiBiZWZvcmUgZGVmYXVsdFJlYWRPYmplY3Qgc28gdGhh\ndCBpdCdzCiAgICAgICAgLy8gYXZhaWxhYmxlIGZvciBjYWxscyB0byBicm9r\nZXIuZ2V0Q29uZmlndXJhdGlvbigpIGR1cmluZwogICAgICAgIC8vIFN0YXRl\nTWFuYWdlciBkZXNlcmlhbGl6YXRpb24KICAgICAgICBfY29uZiA9IGZhY3Rv\ncnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIAogICAgICAgIGluLmRl\nZmF1bHRSZWFkT2JqZWN0KCk7CiAgICAgICAgZmFjdG9yeS5pbml0aWFsaXpl\nQnJva2VyKF9tYW5hZ2VkLCBfY29ublJldGFpbk1vZGUsIHRoaXMsIHRydWUp\nOwoKICAgICAgICAvLyByZS1pbml0aWFsaXplIHRoZSBsb2NrIGlmIG5lZWRl\nZC4KICAgICAgICBzZXRNdWx0aXRocmVhZGVkKF9tdWx0aXRocmVhZGVkKTsK\nCiAgICAgICAgaWYgKGlzQWN0aXZlKCkgJiYgX3J1bnRpbWUgaW5zdGFuY2Vv\nZiBMb2NhbE1hbmFnZWRSdW50aW1lKQogICAgICAgICAgICAoKExvY2FsTWFu\nYWdlZFJ1bnRpbWUpIF9ydW50aW1lKS5iZWdpbigpOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciBvciBub3QgdGhpcyBicm9rZXIgaXMgaW4gdGhl\nIG1pZHN0IG9mIGJlaW5nIHNlcmlhbGl6ZWQuCiAgICAgKgogICAgICogQHNp\nbmNlIDEuMS4wIAogICAgICovCiAgICBib29sZWFuIGlzU2VyaWFsaXppbmco\nKSB7CiAgICAgICAgcmV0dXJuIF9pc1NlcmlhbGl6aW5nOwogICAgfQoKICAg\nIC8qKgogICAgICogVHJhbnNhY3Rpb25hbCBjYWNoZSB0aGF0IGhvbGRzIHNv\nZnQgcmVmcyB0byBjbGVhbiBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHN0YXRp\nYyBjbGFzcyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICBpbXBsZW1lbnRz\nIFNldCwgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBi\nb29sZWFuIF9vcmRlckRpcnR5OwogICAgICAgIHByaXZhdGUgU2V0IF9kaXJ0\neSA9IG51bGw7CiAgICAgICAgcHJpdmF0ZSBTZXQgX2NsZWFuID0gbnVsbDsK\nCiAgICAgICAgcHVibGljIFRyYW5zYWN0aW9uYWxDYWNoZShib29sZWFuIG9y\nZGVyRGlydHkpIHsKICAgICAgICAgICAgX29yZGVyRGlydHkgPSBvcmRlckRp\ncnR5OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJu\nIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0ZSBtYW5hZ2Vycy4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBjb3B5KCkg\newogICAgICAgICAgICBpZiAoaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKCiAgICAgICAgICAgIC8v\nIHNpemUgbWF5IG5vdCBiZSBlbnRpcmVseSBhY2N1cmF0ZSBkdWUgdG8gcmVm\ncyBleHBpcmluZywgc28KICAgICAgICAgICAgLy8gbWFudWFsbHkgY29weSBl\nYWNoIG9iamVjdDsgZG9lc24ndCBtYXR0ZXIgdGhpcyB3YXkgaWYgc2l6ZSB0\nb28KICAgICAgICAgICAgLy8gYmlnIGJ5IHNvbWUKICAgICAgICAgICAgU2V0\nIGNvcHkgPSBuZXcgTGlua2VkSGFzaFNldChzaXplKCkpOwogICAgICAgICAg\nICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IF9kaXJ0eS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsK\nICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsKQogICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBfY2xlYW4uaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRy\nLm5leHQoKSk7CiAgICAgICAgICAgIHJldHVybiBjb3B5OwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwg\nZGlydHkgc3RhdGUgbWFuYWdlcnMuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIENvbGxlY3Rpb24gY29weURpcnR5KCkgewogICAgICAgICAgICBpZiAo\nX2RpcnR5ID09IG51bGwgfHwgX2RpcnR5LmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgTGlua2VkSGFzaFNldChfZGlydHkpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNmZXIgdGhlIGdpdmVu\nIGluc3RhbmNlIGZyb20gdGhlIGRpcnR5IGNhY2hlIHRvIHRoZSBjbGVhbiBj\nYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBmbHVzaGVk\nKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKHNtLmlz\nRGlydHkoKSAmJiBfZGlydHkgIT0gbnVsbCAmJiBfZGlydHkucmVtb3ZlKHNt\nKSkKICAgICAgICAgICAgICAgIGFkZENsZWFuSW50ZXJuYWwoc20pOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIHRoZSBnaXZlbiBp\nbnN0YW5jZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHZvaWQgYWRkQ2xlYW4oU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgICAgICBpZiAoYWRkQ2xlYW5JbnRlcm5hbChzbSkgJiYgX2Rp\ncnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGlydHkucmVtb3ZlKHNt\nKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBhZGRDbGVh\nbkludGVybmFsKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAg\naWYgKF9jbGVhbiA9PSBudWxsKQogICAgICAgICAgICAgICAgX2NsZWFuID0g\nbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5TT0ZUKTsK\nICAgICAgICAgICAgcmV0dXJuIF9jbGVhbi5hZGQoc20pOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIHRoZSBnaXZlbiBpbnN0YW5j\nZSB0byB0aGUgZGlydHkgY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIHZvaWQgYWRkRGlydHkoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAg\nICAgICAgICBpZiAoX2RpcnR5ID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChfb3JkZXJEaXJ0eSkKICAgICAgICAgICAgICAgICAgICBfZGlydHkg\nPSBNYXBCYWNrZWRTZXQuZGVjb3JhdGUobmV3IExpbmtlZE1hcCgpKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfZGlydHkg\nPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChfZGlydHkuYWRkKHNtKSkKICAgICAgICAgICAgICAgIHJlbW92ZUNsZWFu\nSW50ZXJuYWwoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmVtb3ZlIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHRoZSBjYWNoZS4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoU3Rh\ndGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICByZXR1cm4gcmVtb3Zl\nQ2xlYW5JbnRlcm5hbChzbSkKICAgICAgICAgICAgICAgIHx8IChfZGlydHkg\nIT0gbnVsbCAmJiBfZGlydHkucmVtb3ZlKHNtKSk7CiAgICAgICAgfQoKICAg\nICAgICBwcml2YXRlIGJvb2xlYW4gcmVtb3ZlQ2xlYW5JbnRlcm5hbChTdGF0\nZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHJldHVybiBfY2xlYW4g\nIT0gbnVsbCAmJiBfY2xlYW4ucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICAgICAg\nSXRlcmF0b3JDaGFpbiBjaGFpbiA9IG5ldyBJdGVyYXRvckNoYWluKCk7CiAg\nICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCAmJiAhX2RpcnR5LmlzRW1w\ndHkoKSkKICAgICAgICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9yKF9kaXJ0\neS5pdGVyYXRvcigpKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxs\nICYmICFfY2xlYW4uaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgY2hhaW4u\nYWRkSXRlcmF0b3IoX2NsZWFuLml0ZXJhdG9yKCkpOwogICAgICAgICAgICBy\nZXR1cm4gY2hhaW47CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBjb250YWlucyhPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHJldHVybiAo\nX2RpcnR5ICE9IG51bGwgJiYgX2RpcnR5LmNvbnRhaW5zKG9iaikpCiAgICAg\nICAgICAgICAgICB8fCAoX2NsZWFuICE9IG51bGwgJiYgX2NsZWFuLmNvbnRh\naW5zKG9iaikpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nY29udGFpbnNBbGwoQ29sbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykKICAgICAgICAgICAgICAgIGlmICghY29udGFpbnMoaXRyLm5leHQo\nKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGNsZWFyKCkgewogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfZGlydHkgPSBudWxsOwogICAgICAgICAgICBp\nZiAoX2NsZWFuICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY2xlYW4gPSBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0\neSgpIHsKICAgICAgICAgICAgcmV0dXJuIChfZGlydHkgPT0gbnVsbCB8fCBf\nZGlydHkuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgJiYgKF9jbGVhbiA9\nPSBudWxsIHx8IF9jbGVhbi5pc0VtcHR5KCkpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9\nIDA7CiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHNpemUgKz0gX2RpcnR5LnNpemUoKTsKICAgICAgICAgICAgaWYg\nKF9jbGVhbiAhPSBudWxsKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfY2xl\nYW4uc2l6ZSgpOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZChPYmplY3Qgb2JqKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRk\nQWxsKENvbGxlY3Rpb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShPYmplY3Qgb2JqKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVt\nb3ZlQWxsKENvbGxlY3Rpb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIHJldGFpbkFsbChDb2xsZWN0aW9u\nIGMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0\naW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2Jq\nZWN0W10gdG9BcnJheSgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheShPYmplY3RbXSBhcnIpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5pcXVl\nIGlkIGZvciBzdGF0ZSBtYW5hZ2VycyBvZiBuZXcgZGF0YXN0b3JlIGluc3Rh\nbmNlcyB3aXRob3V0IGFzc2lnbmVkCiAgICAgKiBvYmplY3QgaWRzLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJZAog\nICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1RSSU5HX1BSRUZJWCA9ICJvcGVu\nanBhc206IjsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyBfZ2VuZXJh\ndG9yID0gMDsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2JoYXNoOwog\nICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyBfaWQ7CgogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgU3RhdGVNYW5hZ2VySWQgbmV3SW5zdGFuY2UoQnJva2VyIGIp\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJZChTeXN0\nZW0uaWRlbnRpdHlIYXNoQ29kZShiKSwgX2dlbmVyYXRvcisrKTsKICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgU3RhdGVNYW5hZ2VySWQoaW50IGJoYXNo\nLCBsb25nIGlkKSB7CiAgICAgICAgICAgIF9iaGFzaCA9IGJoYXNoOwogICAg\nICAgICAgICBfaWQgPSBpZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndGF0ZU1hbmFnZXJJZChTdHJpbmcgc3RyKSB7CiAgICAgICAgICAgIHN0ciA9\nIHN0ci5zdWJzdHJpbmcoU1RSSU5HX1BSRUZJWC5sZW5ndGgoKSk7CiAgICAg\nICAgICAgIGludCBpZHggPSBzdHIuaW5kZXhPZignOicpOwogICAgICAgICAg\nICBfYmhhc2ggPSBJbnRlZ2VyLnBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMCwg\naWR4KSk7CiAgICAgICAgICAgIF9pZCA9IExvbmcucGFyc2VMb25nKHN0ci5z\ndWJzdHJpbmcoaWR4ICsgMSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgICAgICBp\nZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFN0YXRlTWFu\nYWdlcklkKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySWQgc2lkID0gKFN0YXRlTWFuYWdlcklkKSBv\ndGhlcjsKICAgICAgICAgICAgcmV0dXJuIF9iaGFzaCA9PSBzaWQuX2JoYXNo\nICYmIF9pZCA9PSBzaWQuX2lkOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIChpbnQpIChf\naWQgXiAoX2lkID4+PiAzMikpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIFNUUklO\nR19QUkVGSVggKyBfYmhhc2ggKyAiOiIgKyBfaWQ7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiB0eXBlIHRoYXQgaG9sZHMg\nc3RhdGUgbWFuYWdlcnMgYnV0IHdob3NlIGludGVyZmFjZSBkZWFscwogICAg\nICogd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtYW5hZ2VkIG9iamVjdHMuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1hbmFnZWRPYmplY3RD\nb2xsZWN0aW9uCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdENvbGxlY3Rpb24g\newoKICAgICAgICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb24gX3N0YXRlczsK\nCiAgICAgICAgcHVibGljIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKENvbGxl\nY3Rpb24gc3RhdGVzKSB7CiAgICAgICAgICAgIF9zdGF0ZXMgPSBzdGF0ZXM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRTdGF0\nZU1hbmFnZXJzKCkgewogICAgICAgICAgICByZXR1cm4gX3N0YXRlczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9zdGF0ZXMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIEl0ZXJhdG9yIGl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1\ncm4gbmV3IEl0ZXJhdG9yKCkgewogICAgICAgICAgICAgICAgcHJpdmF0ZSBm\naW5hbCBJdGVyYXRvciBfaXRyID0gX3N0YXRlcy5pdGVyYXRvcigpOwoKICAg\nICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIF9pdHIuaGFzTmV4dCgpOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1YmxpYyBPYmplY3QgbmV4\ndCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyKSBfaXRyLm5leHQoKSkuCiAgICAgICAgICAgICAgICAgICAg\nICAgIGdldE1hbmFnZWRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NpZ24gdGhlIG9iamVjdCBpZCB0\nbyB0aGUgY2FjaGUuIEV4Y2VwdGlvbiB3aWxsIGJlCiAgICAgKiB0aHJvd24g\naWYgdGhlIGlkIGFscmVhZHkgZXhpc3RzIGluIHRoZSBjYWNoZS4gCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2lnbk9iamVjdElkKE9iamVjdCBj\nYWNoZSwgT2JqZWN0IGlkLCAKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgKChNYW5hZ2VkQ2FjaGUpIGNhY2hlKS5hc3NpZ25PYmpl\nY3RJZChpZCwgc20pOyAKICAgIH0KCiAgICAvKiogCiAgICAgKiBUaGlzIG1l\ndGhvZCBtYWtlcyBzdXJlIHdlIGRvbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5z\ndGFuY2UgY2FjaGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNoZWNr\nRm9yRHVwbGljYXRlSWQoT2JqZWN0IGlkLCBPYmplY3Qgb2JqKSB7CiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBvdGhlciA9IGdldFN0YXRlTWFuYWdlcklt\ncGxCeUlkKGlkLCBmYWxzZSk7CiAgICAgICAgaWYgKG90aGVyICE9IG51bGwg\nJiYgIW90aGVyLmlzRGVsZXRlZCgpICYmICFvdGhlci5pc05ldygpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJjYWNoZS1leGlzdHMiLAogICAgICAgICAgICAgICAgb2JqLmdldENs\nYXNzKCkuZ2V0TmFtZSgpLCBpZCkpLnNldEZhaWxlZE9iamVjdChvYmopOwog\nICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRDYWNoZVByZXBhcmVk\nUXVlcnkoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBfY2FjaGVQcmVwYXJlZFF1ZXJ5IAogICAgICAgICAg\nICAgICAmJiBfY29uZi5nZXRRdWVyeVNRTENhY2hlSW5zdGFuY2UoKSAhPSBu\ndWxsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0Q2Fj\naGVQcmVwYXJlZFF1ZXJ5KGJvb2xlYW4gZmxhZykgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfY2FjaGVQcmVwYXJlZFF1\nZXJ5ID0gZmxhZzsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29s\nZWFuIGdldENhY2hlRmluZGVyUXVlcnkoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBfY2FjaGVGaW5kZXJR\ndWVyeSAKICAgICAgICAgICAgICAgJiYgX2NvbmYuZ2V0RmluZGVyQ2FjaGVJ\nbnN0YW5jZSgpICE9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCBzZXRDYWNoZUZpbmRlclF1ZXJ5KGJvb2xlYW4gZmxhZykgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfY2Fj\naGVQcmVwYXJlZFF1ZXJ5ID0gZmxhZzsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBib29sZWFuIGlzRnJvbVdyaXRlQmVoaW5kQ2FsbGJhY2soKSB7\nCiAgICAgICAgcmV0dXJuIF9mcm9tV3JpdGVCZWhpbmRDYWxsYmFjazsKICAg\nIH0KfQo=\n","encoding":"base64"}

