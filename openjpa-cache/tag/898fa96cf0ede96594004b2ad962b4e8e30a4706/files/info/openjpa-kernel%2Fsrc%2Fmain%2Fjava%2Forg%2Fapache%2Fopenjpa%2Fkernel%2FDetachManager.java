{"sha":"53566875d1d5ad43d92011cda437a92a2aee7890","node_id":"MDQ6QmxvYjIwNjM2NDo1MzU2Njg3NWQxZDVhZDQzZDkyMDExY2RhNDM3YTkyYTJhZWU3ODkw","size":31816,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/53566875d1d5ad43d92011cda437a92a2aee7890","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuQ29tcGF0aWJpbGl0eTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLkRldGFjaE9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuQ2FsbGJhY2tNb2RlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DYWxsYmFja0V4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5k\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJv\neHk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwoKLyoqCiAqIEhhbmRsZXMgZGV0YWNoaW5nIGluc3RhbmNlcy4KICoK\nICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQG5vamF2YWRvYwog\nKi8KcHVibGljIGNsYXNzIERldGFjaE1hbmFnZXIKICAgIGltcGxlbWVudHMg\nRGV0YWNoU3RhdGUgewoKICAgIHByaXZhdGUgc3RhdGljIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UoRGV0YWNoTWFuYWdlci5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBmaW5hbCBCcm9rZXJJbXBsIF9icm9rZXI7CiAg\nICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX2NvcHk7CiAgICBwcml2YXRlIGZp\nbmFsIGJvb2xlYW4gX2Z1bGw7CiAgICBwcml2YXRlIGZpbmFsIFByb3h5TWFu\nYWdlciBfcHJveHk7CiAgICBwcml2YXRlIGZpbmFsIERldGFjaE9wdGlvbnMg\nX29wdHM7CiAgICBwcml2YXRlIGZpbmFsIE9wQ2FsbGJhY2tzIF9jYWxsOwog\nICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9mYWlsRmFzdDsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfZmx1c2hlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9mbHVzaEJlZm9yZURldGFjaDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nY2FzY2FkZVdpdGhEZXRhY2g7IAogICAgcHJpdmF0ZSBib29sZWFuIF9yZWxv\nYWRPbkRldGFjaDsKCiAgICAvLyBpZiB3ZSdyZSBub3QgZGV0YWNoaW5nIGZ1\nbGwsIHdlIG5lZWQgdG8gdHJhY2sgYWxsIGRldGFjaGVkIG9iamVjdHM7CiAg\nICAvLyBpZiB3ZSBhcmUsIHRoZW4gd2UgdXNlIGEgc3BlY2lhbCBmaWVsZCBt\nYW5hZ2VyIGZvciBtb3JlIGVmZmljaWVudAogICAgLy8gZGV0YWNobWVudCB0\naGFuIHRoZSBzdGFuZGFyZCBvbmUKICAgIHByaXZhdGUgZmluYWwgSWRlbnRp\ndHlNYXAgX2RldGFjaGVkOwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hGaWVs\nZE1hbmFnZXIgX2Z1bGxGTTsKCiAgICAvKioKICAgICAqIFVzZWQgdG8gcHJl\ncGFyZSBhIGRldGFjaGFibGUgaW5zdGFuY2UgdGhhdCBkb2VzIG5vdCBleHRl\ncm5hbGl6ZQogICAgICogZGV0YWNoZWQgc3RhdGUuCiAgICAgKi8KICAgIHN0\nYXRpYyBib29sZWFuIHByZVNlcmlhbGl6ZShTdGF0ZU1hbmFnZXJJbXBsIHNt\nKSB7CiAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoc20uZ2V0QnJva2VyKCku\nZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nCiAgICAgICAgICAgICAgICAuZ2V0Rmx1c2hCZWZvcmVEZXRhY2goKSkgewog\nICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAgICB9CgogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAg\nICAgYm9vbGVhbiBzZXRTdGF0ZSA9IG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgp\nICE9IG51bGwKICAgICAgICAgICAgJiYgIUNsYXNzTWV0YURhdGEuU1lOVEhF\nVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUoKSk7CiAgICAgICAg\nQml0U2V0IGlkeHMgPSAoc2V0U3RhdGUpID8gbmV3IEJpdFNldChtZXRhLmdl\ndEZpZWxkcygpLmxlbmd0aCkgOiBudWxsOwogICAgICAgIHByZURldGFjaChz\nbS5nZXRCcm9rZXIoKSwgc20sIGlkeHMsIGZhbHNlLCB0cnVlKTsKCiAgICAg\nICAgaWYgKHNldFN0YXRlKSB7CiAgICAgICAgICAgIHNtLmdldFBlcnNpc3Rl\nbmNlQ2FwYWJsZSgpLnBjU2V0RGV0YWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0\nYXRlCiAgICAgICAgICAgICAgICAoc20sIGlkeHMpKTsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOyAvLyBkb24ndCBudWxsIHN0YXRlCiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVXNl\nZCBieSBjbGFzc2VzIHRoYXQgZXh0ZXJuYWxpemUgZGV0YWNoZWQgc3RhdGUu\nCiAgICAgKgogICAgICogQHJldHVybiB3aGV0aGVyIHRvIHVzZSBhIGRldGFj\naGVkIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgc3RhdGljIGJvb2xlYW4g\nd3JpdGVEZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20sIE9iamVj\ndE91dHB1dCBvdXQsCiAgICAgICAgQml0U2V0IGlkeHMpCiAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVu\ndCgpKSB7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsgLy8g\nc3RhdGUKICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0KG51bGwpOyAvLyBz\nbQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICAvLyBkaXJ0eSBzdGF0ZSBjYXVzZXMgZmx1c2gKICAgICAgICBmbHVzaERp\ncnR5KHNtKTsKCiAgICAgICAgQnJva2VyIGJyb2tlciA9IHNtLmdldEJyb2tl\ncigpOwogICAgICAgIHByZURldGFjaChicm9rZXIsIHNtLCBpZHhzLCBmYWxz\nZSwgdHJ1ZSk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVkIHN0YXRlIG9i\namVjdCBhbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFjaE9wdGlvbnMg\nb3B0cyA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAg\nIGdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoIW9wdHMu\nZ2V0RGV0YWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICB8fCAhdXNl\nRGV0YWNoZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAgICAgICAgICAg\nIG91dC53cml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNtLCBpZHhzKSk7\nCiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBvdXQud3JpdGVP\nYmplY3QobnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG5ldyBEZXRh\nY2hlZFN0YXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwK\nICAgICAgICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNzVW5sb2FkZWQo\nKSwgYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkgdGhlIG9iamVj\ndCBmb3IgZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcgdGhlIGZpZWxk\ncyB0byBiZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5nIHZlcnNpb24g\naW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlkeHMgdGhlIGlu\nZGV4ZXMgb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNldCBhcyBhIHNp\nZGUKICAgICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIgYnJva2VyLCBT\ndGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBpZHhzLCBib29s\nZWFuIGZ1bGwsCiAgICAgICAgYm9vbGVhbiByZWxvYWRPbkRldGFjaCkgewog\nICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZXhpc3Rpbmcgb2JqZWN0IGhhcyB0\naGUgcmlnaHQgZmllbGRzIGZldGNoZWQ7IGNhbGwKICAgICAgICAvLyBldmVu\nIGlmIHVzaW5nIGN1cnJlbnRseS1sb2FkZWQgZmllbGRzIGZvciBkZXRhY2gg\ndG8gbWFrZSBzdXJlCiAgICAgICAgLy8gdmVyc2lvbiBpcyBzZXQKICAgICAg\nICBpbnQgZGV0YWNoTW9kZSA9IGJyb2tlci5nZXREZXRhY2hTdGF0ZSgpOwog\nICAgICAgIGludCBsb2FkTW9kZSA9IFN0YXRlTWFuYWdlckltcGwuTE9BRF9G\nR1M7CiAgICAgICAgQml0U2V0IGV4Y2x1ZGUgPSBudWxsOwogICAgICAgIGlm\nIChkZXRhY2hNb2RlID09IERFVEFDSF9MT0FERUQpCiAgICAgICAgICAgIGV4\nY2x1ZGUgPSBTdG9yZUNvbnRleHQuRVhDTFVERV9BTEw7CiAgICAgICAgZWxz\nZSBpZiAoZGV0YWNoTW9kZSA9PSBERVRBQ0hfQUxMKQogICAgICAgICAgICBs\nb2FkTW9kZSA9IFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKGRldGFjaE1vZGUgIT0gREVUQUNIX0xP\nQURFRCB8fCAKICAgICAgICAgICAgICAgICAgICByZWxvYWRPbkRldGFjaCB8\nfAogICAgICAgICAgICAgICAgICAgICghcmVsb2FkT25EZXRhY2ggJiYgIWZ1\nbGwpKSB7CiAgICAgICAgICAgICAgICBzbS5sb2FkKGJyb2tlci5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKSwgbG9hZE1vZGUsIGV4Y2x1ZGUsCiAgICAgICAg\nICAgICAgICAgICAgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewog\nICAgICAgICAgICAvLyBjb25zdW1lIHRoZSBleGNlcHRpb24KICAgICAgICB9\nCgogICAgICAgIC8vIGNyZWF0ZSBiaXRzZXQgb2YgZmllbGRzIHRvIGRldGFj\naDsgaWYgbW9kZSBpcyBhbGwgd2UgY2FuIHVzZQogICAgICAgIC8vIGN1cnJl\nbnRseSBsb2FkZWQgYml0c2V0IGNsb25lLCBzaW5jZSB3ZSBrbm93IGFsbCBm\naWVsZHMgYXJlIGxvYWRlZAogICAgICAgIGlmIChpZHhzICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKGRldGFjaE1vZGUgPT0gREVUQUNIX0ZFVENIX0dS\nT1VQUykKICAgICAgICAgICAgICAgIHNldEZldGNoR3JvdXBGaWVsZHMoYnJv\na2VyLCBzbSwgaWR4cyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGlkeHMub3Ioc20uZ2V0TG9hZGVkKCkpOwoKICAgICAgICAgICAgLy8g\nY2xlYXIgbHJzIGZpZWxkcwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgCiAg\nICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKQogICAgICAgICAg\nICAgICAgICAgIGlkeHMuY2xlYXIoaSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogR2VuZXJhdGUgdGhlIGRldGFjaGVkIHN0YXRlIGZvciB0\naGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIE9iamVjdCBnZXREZXRhY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20s\nIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICAvLyBpZiBkYXRhc3RvcmUsIHN0\nb3JlIGlkIGluIGZpcnN0IGVsZW1lbnQKICAgICAgICBpbnQgb2Zmc2V0ID0g\nKHNtLmdldE1ldGFEYXRhKCkuZ2V0SWRlbnRpdHlUeXBlKCkgPT0KICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpID8gMSA6IDA7Cgog\nICAgICAgIC8vIG1ha2UgdmVyc2lvbiBzdGF0ZSBhcnJheSBvbmUgbGFyZ2Vy\nIGZvciBuZXcgaW5zdGFuY2VzOyBtYXJrcyBuZXcKICAgICAgICAvLyBpbnN0\nYW5jZXMgd2l0aG91dCBhZmZlY3Rpbmcgc2VyaWFsaXphdGlvbiBzaXplIG11\nY2gKICAgICAgICBPYmplY3RbXSBzdGF0ZTsKICAgICAgICBpZiAoc20uaXNO\nZXcoKSkKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2JqZWN0WzMgKyBvZmZz\nZXRdOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2Jq\nZWN0WzIgKyBvZmZzZXRdOwoKICAgICAgICBpZiAob2Zmc2V0ID4gMCkgewog\nICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGlmIChzbS5pc0Vt\nYmVkZGVkKCkgfHwgc20uZ2V0T2JqZWN0SWQoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgaWQgPSBzbS5nZXRJZCgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBpZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAg\nICAgIHN0YXRlWzBdID0gaWQudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAg\nICAgc3RhdGVbb2Zmc2V0XSA9IHNtLmdldFZlcnNpb24oKTsKICAgICAgICBz\ndGF0ZVtvZmZzZXQgKyAxXSA9IGZpZWxkczsKICAgICAgICByZXR1cm4gc3Rh\ndGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVzaCBvciBpbnZva2UgcHJl\nLXN0b3JlIGNhbGxiYWNrcyBvbiB0aGUgZ2l2ZW4gYnJva2VyIGlmCiAgICAg\nKiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIGZsdXNoZWQvc3RvcmVkLCBmYWxz\nZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xl\nYW4gZmx1c2hEaXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAg\naWYgKCFzbS5pc0RpcnR5KCkgfHwgIXNtLmdldEJyb2tlcigpLmlzQWN0aXZl\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gb25s\neSBmbHVzaCBpZiB0aGVyZSBhcmUgYWN0dWFsbHkgYW55IGRpcnR5IG5vbi1m\nbHVzaGVkIGZpZWxkcwogICAgICAgIEJpdFNldCBkaXJ0eUZpZWxkcyA9IHNt\nLmdldERpcnR5KCk7CiAgICAgICAgQml0U2V0IGZsdXNoZWRGaWVsZHMgPSBz\nbS5nZXRGbHVzaGVkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBk\naXJ0eUZpZWxkcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBpZiAoZGly\ndHlGaWVsZHMuZ2V0KGkpICYmICFmbHVzaGVkRmllbGRzLmdldChpKSkgewog\nICAgICAgICAgICAgICAgaWYgKHNtLmdldEJyb2tlcigpLmdldFJvbGxiYWNr\nT25seSgpKQogICAgICAgICAgICAgICAgICAgIHNtLmdldEJyb2tlcigpLnBy\nZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0QnJva2VyKCkuZmx1c2goKTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBh\nIGJpdCBzZXQgZm9yIHRoZSBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgZmV0Y2gg\nZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldEZl\ndGNoR3JvdXBGaWVsZHMoQnJva2VyIGJyb2tlciwKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtLCBCaXRTZXQgaWR4cykgewogICAgICAgIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmbWRz\nW2ldLmlzUHJpbWFyeUtleSgpIHx8IGZldGNoLnJlcXVpcmVzRmV0Y2goZm1k\nc1tpXSkKICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlvbi5G\nRVRDSF9OT05FKQogICAgICAgICAgICAgICAgaWR4cy5zZXQoaSk7CiAgICAg\nICAgfQogICAgfQogICAgCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4K\nICAgICAqCiAgICAgKiBAcGFyYW0gYnJva2VyIG93bmluZyBicm9rZXIKICAg\nICAqIEBwYXJhbSBmdWxsIHdoZXRoZXIgdGhlIGVudGlyZSBicm9rZXIgY2Fj\naGUgaXMgYmVpbmcgZGV0YWNoZWQ7IGlmCiAgICAgKiB0aGlzIGlzIHRoZSBj\nYXNlLCB3ZSBhc3N1bWUgdGhlIGJyb2tlciBoYXMgYWxyZWFkeQogICAgICog\nZmx1c2hlZCBpZiBuZWVkZWQsIGFuZCB0aGF0IHdlJ3JlIGRldGFjaGluZyBp\nbi1wbGFjZQogICAgICovCiAgICBwdWJsaWMgRGV0YWNoTWFuYWdlcihCcm9r\nZXJJbXBsIGJyb2tlciwgYm9vbGVhbiBmdWxsLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBfcHJveHkg\nPSBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldFByb3h5TWFuYWdlcklu\nc3RhbmNlKCk7CiAgICAgICAgX29wdHMgPSBicm9rZXIuZ2V0Q29uZmlndXJh\ndGlvbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBfZmx1\nc2hlZCA9IGZ1bGw7CiAgICAgICAgX2NhbGwgPSBjYWxsOwogICAgICAgIF9m\nYWlsRmFzdCA9IChicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCkK\nICAgICAgICAgICAgJiBDYWxsYmFja01vZGVzLkNBTExCQUNLX0ZBSUxfRkFT\nVCkgIT0gMDsKCiAgICAgICAgLy8gd2UgY2FuIG9ubHkgcmVseSBvbiBvdXIg\nImZ1bGwiIHNob3J0Y3V0cyBpZiB3ZSBrbm93IHdlIHdvbid0IGJlCiAgICAg\nICAgLy8gbG9hZGluZyBhbnkgbW9yZSBkYXRhCiAgICAgICAgX2Z1bGwgPSBm\ndWxsICYmIGJyb2tlci5nZXREZXRhY2hTdGF0ZSgpID09IERldGFjaFN0YXRl\nLkRFVEFDSF9MT0FERUQ7CiAgICAgICAgaWYgKF9mdWxsKSB7CiAgICAgICAg\nICAgIF9kZXRhY2hlZCA9IG51bGw7CiAgICAgICAgICAgIF9mdWxsRk0gPSBu\nZXcgRGV0YWNoRmllbGRNYW5hZ2VyKCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgX2RldGFjaGVkID0gbmV3IElkZW50aXR5TWFwKCk7CiAgICAg\nICAgICAgIF9mdWxsRk0gPSBudWxsOwogICAgICAgIH0KICAgICAgICBDb21w\nYXRpYmlsaXR5IGNvbXBhdGliaWxpdHkgPSAKICAgICAgICAgICAgYnJva2Vy\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2Uo\nKTsKICAgICAgICBfZmx1c2hCZWZvcmVEZXRhY2ggPSBjb21wYXRpYmlsaXR5\nLmdldEZsdXNoQmVmb3JlRGV0YWNoKCk7CiAgICAgICAgX3JlbG9hZE9uRGV0\nYWNoID0gY29tcGF0aWJpbGl0eS5nZXRSZWxvYWRPbkRldGFjaCgpOwogICAg\nICAgIF9jYXNjYWRlV2l0aERldGFjaCA9IGNvbXBhdGliaWxpdHkuZ2V0Q2Fz\nY2FkZVdpdGhEZXRhY2goKTsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAg\nICAgICBfY29weSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgX2NvcHkgPSBjb21wYXRpYmlsaXR5LmdldENvcHlPbkRl\ndGFjaCgpOzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBkZXRhY2hlZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2JqZWN0IHRvRGV0\nYWNoKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBkZXRhY2hJbnRlcm5hbCh0b0RldGFj\naCk7CiAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2UpIHsK\nICAgICAgICAgICAgZXhjZXBzID0gbmV3IEFycmF5TGlzdCgxKTsKICAgICAg\nICAgICAgZXhjZXBzLmFkZChjZSk7CiAgICAgICAgICAgIHJldHVybiBudWxs\nOyAvLyB3b24ndCBiZSByZWFjaGVkIGFzIGV4Y2VwdGlvbiB3aWxsIGJlIHJl\ndGhyb3duCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGV4\nY2VwcyA9PSBudWxsIHx8ICFfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICBl\neGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9ucy5zaW5nbGV0\nb24odG9EZXRhY2gpLAogICAgICAgICAgICAgICAgICAgIGV4Y2Vwcyk7CiAg\nICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbnMoZXhjZXBzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gZGV0YWNoZWQgdmVyc2lvbnMgb2YgYWxsIHRoZSBnaXZlbiBp\nbnN0YW5jZXMuIElmIG5vdCBjb3B5aW5nLAogICAgICogbnVsbCB3aWxsIGJl\nIHJldHVybmVkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNo\nQWxsKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgTGlzdCBleGNl\ncHMgPSBudWxsOwogICAgICAgIExpc3QgZGV0YWNoZWQgPSBudWxsOwogICAg\nICAgIGlmIChfY29weSkKICAgICAgICAgICAgZGV0YWNoZWQgPSBuZXcgQXJy\nYXlMaXN0KGluc3RhbmNlcy5zaXplKCkpOwoKICAgICAgICBib29sZWFuIGZh\naWxGYXN0ID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgT2Jq\nZWN0IGRldGFjaDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBp\nbnN0YW5jZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIGRldGFjaCA9IGRldGFjaEludGVybmFsKGl0ci5uZXh0KCkp\nOwogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAg\nICAgIGRldGFjaGVkLmFkZChkZXRhY2gpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIGlmIChyZSBpbnN0YW5jZW9mIENhbGxiYWNrRXhjZXB0aW9u\nICYmIF9mYWlsRmFzdCkKICAgICAgICAgICAgICAgIGZhaWxGYXN0ID0gdHJ1\nZTsKICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghZmFpbEZhc3QpCiAg\nICAgICAgICAgICAgICBleGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChpbnN0\nYW5jZXMsIGV4Y2Vwcyk7CiAgICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAg\nICAgIH0KICAgICAgICB0aHJvd0V4Y2VwdGlvbnMoZXhjZXBzKTsKCiAgICAg\nICAgaWYgKF9jb3B5KQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQudG9B\ncnJheSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogSW52b2tlIHBvc3REZXRhY2goKSBvbiBhbnkgZGV0YWNoZWQgaW5z\ndGFuY2VzIHRoYXQgaW1wbGVtZW50CiAgICAgKiBQb3N0RGV0YWNoQ2FsbGJh\nY2suIFRoaXMgd2lsbCBiZSBkb25lIGFmdGVyIHRoZSBlbnRpcmUgZ3JhcGgg\naGFzCiAgICAgKiBiZWVuIGRldGFjaGVkLiBUaGlzIG1ldGhvZCBoYXMgdGhl\nIHNpZGUtZWZmZWN0IG9mIGFsc28gY2xlYXJpbmcKICAgICAqIG91dCB0aGUg\nbWFwIG9mIGFsbCBkZXRhY2hlZCBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHBy\naXZhdGUgTGlzdCBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9uIG9ianMs\nIExpc3QgZXhjZXBzKSB7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gKF9mdWxs\nKSA/IG9ianMuaXRlcmF0b3IoKQogICAgICAgICAgICA6IF9kZXRhY2hlZC5l\nbnRyeVNldCgpLml0ZXJhdG9yKCk7CgogICAgICAgIE9iamVjdCBvcmlnLCBk\nZXRhY2hlZDsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgd2hp\nbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgaWYgKF9mdWxsKSB7\nCiAgICAgICAgICAgICAgICBvcmlnID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGRldGFjaGVkID0gb3JpZzsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIG9yaWcgPSBlbnRyeS5nZXRLZXkoKTsKICAg\nICAgICAgICAgICAgIGRldGFjaGVkID0gZW50cnkuZ2V0VmFsdWUoKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvcmlnLCB0cnVlKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2\nZW50KGRldGFjaGVkLCBvcmlnLAogICAgICAgICAgICAgICAgICAgICAgICBz\nbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ERVRBQ0gp\nOwogICAgICAgICAgICB9IGNhdGNoIChDYWxsYmFja0V4Y2VwdGlvbiBjZSkg\newogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgY2UpOwog\nICAgICAgICAgICAgICAgaWYgKF9mYWlsRmFzdCkKICAgICAgICAgICAgICAg\nICAgICBicmVhazsgLy8gZG9uJ3QgY29udGludWUgcHJvY2Vzc2luZwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNlcHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXhjZXB0aW9uIHRvIHRoZSBs\naXN0LgogICAgICovCiAgICBwcml2YXRlIExpc3QgYWRkKExpc3QgZXhjZXBz\nLCBSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9\nPSBudWxsKQogICAgICAgICAgICBleGNlcHMgPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgIGV4Y2Vwcy5hZGQocmUpOwogICAgICAgIHJldHVybiBleGNl\ncHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBhbGwgZ2F0aGVyZWQg\nZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93RXhj\nZXB0aW9ucyhMaXN0IGV4Y2VwcykgewogICAgICAgIGlmIChleGNlcHMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZXhjZXBz\nLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2Vw\ndGlvbikgZXhjZXBzLmdldCgwKTsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKS4KICAgICAgICAg\nICAgc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIGV4Y2Vwcy50\nb0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMu\nc2l6ZSgpXSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0YWNoLgogICAg\nICovCiAgICBwcml2YXRlIE9iamVjdCBkZXRhY2hJbnRlcm5hbChPYmplY3Qg\ndG9EZXRhY2gpIHsKICAgICAgICBpZiAodG9EZXRhY2ggPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGFscmVhZHkgZGV0\nYWNoZWQ/CiAgICAgICAgaWYgKF9kZXRhY2hlZCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIE9iamVjdCBkZXRhY2hlZCA9IF9kZXRhY2hlZC5nZXQodG9EZXRh\nY2gpOwogICAgICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBkZXRhY2hlZDsKICAgICAgICB9CgogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdl\nckltcGwodG9EZXRhY2gsIHRydWUpOwogICAgICAgIGlmIChfY2FsbCAhPSBu\ndWxsICYmIChfY2FsbC5wcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1Bf\nREVUQUNILAogICAgICAgICAgICB0b0RldGFjaCwgc20pICYgT3BDYWxsYmFj\na3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRvRGV0YWNo\nOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndG9EZXRhY2g7CgogICAgICAgIC8vIENhbGwgUHJlRGV0YWNoIGZpcnN0IGFz\nIHdlIGNhbid0IHRlbGwgaWYgdGhlIG5ldyBzeXN0ZW0KICAgICAgICAvLyBm\naXJlZCBhbiBldmVudCBvciBqdXN0IGRpZCBub3QgZmFpbC4KICAgICAgICBf\nYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudCh0b0RldGFjaCwgbnVsbCwgc20u\nZ2V0TWV0YURhdGEoKSwKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQuQkVG\nT1JFX0RFVEFDSCk7CgogICAgICAgIGlmKCEgX2ZsdXNoZWQpICB7CiAgICAg\nICAgICAgIGlmKF9mbHVzaEJlZm9yZURldGFjaCkgewogICAgICAgICAgICAg\nICAgLy8gYW55IGRpcnR5IGluc3RhbmNlcyBjYXVzZSBhIGZsdXNoIHRvIG9j\nY3VyCiAgICAgICAgICAgICAgICBmbHVzaERpcnR5KHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBfZmx1c2hlZCA9IHRydWU7CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIEJpdFNldCBmaWVsZHMgPSBuZXcgQml0U2V0KCk7\nCiAgICAgICAgcHJlRGV0YWNoKF9icm9rZXIsIHNtLCBmaWVsZHMsIF9mdWxs\nLAogICAgICAgICAgICBfcmVsb2FkT25EZXRhY2gpOwoKICAgICAgICAvLyBj\ncmVhdGUgYW5kIHN0b3JlIG5ldyBvYmplY3QgYmVmb3JlIGNvcHkgdG8gYXZv\naWQgZW5kbGVzcyByZWN1cnNpb24KICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgZGV0YWNoZWRQQzsKICAgICAgICBpZiAoX2Nv\ncHkpCiAgICAgICAgICAgIGRldGFjaGVkUEMgPSBwYy5wY05ld0luc3RhbmNl\nKG51bGwsIHRydWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZGV0YWNo\nZWRQQyA9IHBjOwogICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAg\nICAgICAgICAgX2RldGFjaGVkLnB1dCh0b0RldGFjaCwgZGV0YWNoZWRQQyk7\nCgogICAgICAgIC8vIGRldGFjaCBmaWVsZHMgYW5kIHNldCBkZXRhY2hlZCB2\nYXJpYWJsZXMKICAgICAgICBEZXRhY2hlZFN0YXRlTWFuYWdlciBkZXRTTSA9\nIG51bGw7CiAgICAgICAgaWYgKF9vcHRzLmdldERldGFjaGVkU3RhdGVNYW5h\nZ2VyKCkKICAgICAgICAgICAgJiYgdXNlRGV0YWNoZWRTdGF0ZU1hbmFnZXIo\nc20sIF9vcHRzKQogICAgICAgICAgICAmJiAhKHNtLmlzTmV3KCkgJiYgIXNt\nLmlzRGVsZXRlZCgpICYmICFzbS5pc0ZsdXNoZWQoKSkpCiAgICAgICAgICAg\nIGRldFNNID0gbmV3IERldGFjaGVkU3RhdGVNYW5hZ2VyKGRldGFjaGVkUEMs\nIHNtLCBmaWVsZHMsCiAgICAgICAgICAgICAgICBfb3B0cy5nZXRBY2Nlc3NV\nbmxvYWRlZCgpLCBfYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSk7CiAgICAg\nICAgaWYgKF9mdWxsKSB7CiAgICAgICAgICAgIF9mdWxsRk0uc2V0U3RhdGVN\nYW5hZ2VyKHNtKTsKICAgICAgICAgICAgaWYgKF9jb3B5IHx8IF9yZWxvYWRP\nbkRldGFjaCkgewogICAgICAgICAgICAgICAgX2Z1bGxGTS5kZXRhY2hWZXJz\naW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Z1bGxGTS5yZXBy\nb3h5KGRldFNNKTsKICAgICAgICAgICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFn\nZXIobnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSW5zdGFu\nY2VEZXRhY2hGaWVsZE1hbmFnZXIgZm0gPSBuZXcgSW5zdGFuY2VEZXRhY2hG\naWVsZE1hbmFnZXIKICAgICAgICAgICAgICAgIChkZXRhY2hlZFBDLCBkZXRT\nTSk7CiAgICAgICAgICAgIGZtLnNldFN0YXRlTWFuYWdlcihzbSk7CiAgICAg\nICAgICAgIGZtLmRldGFjaEZpZWxkcyhmaWVsZHMpOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKCFCb29sZWFuLkZBTFNFLmVxdWFscyhzbS5nZXRNZXRhRGF0\nYSgpLnVzZXNEZXRhY2hlZFN0YXRlKCkpKQogICAgICAgICAgICBkZXRhY2hl\nZFBDLnBjU2V0RGV0YWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0YXRlKHNtLCBm\naWVsZHMpKTsKICAgICAgICBpZiAoIV9jb3B5KQogICAgICAgICAgICBzbS5y\nZWxlYXNlKGZhbHNlLCB0cnVlKTsKICAgICAgICBpZiAoZGV0U00gIT0gbnVs\nbCkKICAgICAgICAgICAgZGV0YWNoZWRQQy5wY1JlcGxhY2VTdGF0ZU1hbmFn\nZXIoZGV0U00pOwogICAgICAgIHJldHVybiBkZXRhY2hlZFBDOwogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gdXNlRGV0YWNoZWRTdGF0ZU1h\nbmFnZXIoU3RhdGVNYW5hZ2VySW1wbCBzbSwKICAgICAgICBEZXRhY2hPcHRp\nb25zIG9wdHMpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBzbS5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIHJldHVybiAhQm9vbGVhbi5GQUxTRS5l\ncXVhbHMobWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpKSAmJgogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMobWV0YS5nZXREZXRh\nY2hlZFN0YXRlKCkpICYmCiAgICAgICAgICAgIG9wdHMuZ2V0RGV0YWNoZWRT\ndGF0ZU1hbmFnZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEJhc2UgZGV0\nYWNoIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIERldGFjaEZpZWxkTWFuYWdlcgogICAgICAgIGV4dGVuZHMgVHJh\nbnNmZXJGaWVsZE1hbmFnZXIgewoKICAgICAgICBwcm90ZWN0ZWQgU3RhdGVN\nYW5hZ2VySW1wbCBzbTsKCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IHRo\nZSBzb3VyY2Ugc3RhdGUgbWFuYWdlci4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgdm9pZCBzZXRTdGF0ZU1hbmFnZXIoU3RhdGVNYW5hZ2VySW1wbCBz\nbSkgewogICAgICAgICAgICB0aGlzLnNtID0gc207CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBUcmFuc2ZlciB0aGUgY3VycmVudCB2ZXJz\naW9uIG9iamVjdCBmcm9tIHRoZSBzdGF0ZSBtYW5hZ2VyIHRvIHRoZQogICAg\nICAgICAqIGRldGFjaGVkIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyB2b2lkIGRldGFjaFZlcnNpb24oKSB7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRWZXJzaW9u\nRmllbGQoKTsKICAgICAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IEph\ndmFUeXBlcy5jb252ZXJ0KHNtLmdldFZlcnNpb24oKSwKICAgICAgICAgICAg\nICAgIGZtZC5nZXRUeXBlQ29kZSgpKTsKICAgICAgICAgICAgdmFsID0gZm1k\nLmdldEZpZWxkVmFsdWUodmFsLCBzbS5nZXRCcm9rZXIoKSk7CiAgICAgICAg\nICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAg\nICAgICAgICAgbG9uZ3ZhbCA9ICh2YWwgPT0gbnVsbCkgPyAwTCA6ICgoTnVt\nYmVyKSB2YWwpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBkYmx2\nYWwgPSAodmFsID09IG51bGwpID8gMEQgOiAoKE51bWJlcikgdmFsKS5kb3Vi\nbGVWYWx1ZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBvYmp2YWwgPSB2YWw7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc20ucmVwbGFjZUZpZWxkKGdldERldGFj\naGVkUGVyc2lzdGVuY2VDYXBhYmxlKCksIHRoaXMsCiAgICAgICAgICAgICAg\nICBmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBVbnByb3hpZXMgc2Vjb25kIGNsYXNzIG9iamVjdCBmaWVsZHMu\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgcmVwcm94eShEZXRh\nY2hlZFN0YXRlTWFuYWdlciBkc20pIHsKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5NQVA6CiAgICAgICAgICAgICAgICAgICAgLy8gbHJzIHByb3hpZXMgbm90\nIGRldGFjaGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0uaXNM\nUlMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvYmp2YWwgPSBudWxs\nOwogICAgICAgICAgICAgICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoZ2V0\nRGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSwgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0aGlzLCBpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRBVEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgICAgICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGdldERldGFj\naGVkUGVyc2lzdGVuY2VDYXBhYmxlKCksIHRoaXMsIGkpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChvYmp2YWwgaW5zdGFuY2VvZiBQcm94eSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBQcm94eSBwcm94eSA9IChQcm94eSkgb2Jq\ndmFsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJveHkuZ2V0Q2hh\nbmdlVHJhY2tlcigpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCkuc3RvcFRyYWNraW5nKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5LnNldE93bmVyKGRzbSwg\nKGRzbSA9PSBudWxsKSA/IC0xIDogaSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGNsZWFyKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBS\nZXR1cm4gdGhlIGluc3RhbmNlIGJlaW5nIGRldGFjaGVkLgogICAgICAgICAq\nLwogICAgICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgZ2V0RGV0\nYWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaWVsZE1hbmFnZXIgdGhhdCBjYW4gY29weSBh\nbGwgdGhlIGZpZWxkcyBmcm9tIG9uZQogICAgICogUGVyc2lzdGVuY2VDYXBh\nYmxlIGluc3RhbmNlIHRvIGFub3RoZXIuIE9uZSBvZiB0aGUKICAgICAqIGlu\nc3RhbmNlcyBtdXN0IGJlIG1hbmFnZWQgYnkgYSBTdGF0ZU1hbmFnZXIsIGFu\nZCB0aGUKICAgICAqIG90aGVyIG11c3QgYmUgdW5tYW5hZ2VkLgogICAgICoK\nICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAg\nIHByaXZhdGUgY2xhc3MgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIKICAg\nICAgICBleHRlbmRzIERldGFjaEZpZWxkTWFuYWdlciB7CgogICAgICAgIHBy\naXZhdGUgZmluYWwgUGVyc2lzdGVuY2VDYXBhYmxlIF90bzsKICAgICAgICBw\ncml2YXRlIGZpbmFsIERldGFjaGVkU3RhdGVNYW5hZ2VyIF9kZXRTTTsKCiAg\nICAgICAgLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBpbnN0\nYW5jZSB0byB0byBjb3B5IHRvLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyBJbnN0YW5jZURldGFjaEZpZWxkTWFuYWdlcihQZXJzaXN0ZW5jZUNhcGFi\nbGUgdG8sCiAgICAgICAgICAgIERldGFjaGVkU3RhdGVNYW5hZ2VyIGRldFNN\nKSB7CiAgICAgICAgICAgIF90byA9IHRvOwogICAgICAgICAgICBfZGV0U00g\nPSBkZXRTTTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBQZXJzaXN0\nZW5jZUNhcGFibGUgZ2V0RGV0YWNoZWRQZXJzaXN0ZW5jZUNhcGFibGUoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfdG87CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBEZXRhY2ggdGhlIGZpZWxkcyBvZiB0aGUgc3RhdGUg\nbWFuYWdlciBnaXZlbiBvbiBjb25zdHJ1Y3Rpb24gdG8KICAgICAgICAgKiB0\naGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBnaXZlbiBvbiBjb25zdHJ1Y3Rpb24u\nCiAgICAgICAgICogT25seSB0aGUgZmllbGRzIGluIHRoZSBnaXZlbiBiaXQg\nc2V0IHdpbGwgYmUgY29waWVkLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIGRldGFjaEZpZWxkcyhCaXRTZXQgZmdmaWVsZHMpIHsKICAgICAg\nICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGZyb20gPSBzbS5nZXRQZXJzaXN0\nZW5jZUNhcGFibGUoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBr\ncyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1ldGFE\nYXRhKCkuZ2V0RmllbGRzKCk7CgogICAgICAgICAgICBpZiAoX2NvcHkpCiAg\nICAgICAgICAgICAgICBfdG8ucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIHdlIHN0YXJ0\nIHdpdGggcGsgZmllbGRzOiBvYmplY3RzIG1pZ2h0IHJlbHkgb24gcGsgZmll\nbGRzIGZvcgogICAgICAgICAgICAgICAgLy8gZXF1YWxzIGFuZCBoYXNoQ29k\nZSBtZXRob2RzLCBhbmQgdGhpcyBlbnN1cmVzIHRoYXQgcGsgZmllbGRzCiAg\nICAgICAgICAgICAgICAvLyBhcmUgc2V0IHByb3Blcmx5IGlmIHdlIHJldHVy\nbiBhbnkgcGFydGlhbGx5LWRldGFjaGVkIG9iamVjdHMKICAgICAgICAgICAg\nICAgIC8vIGR1ZSB0byByZWVudHJhbnQgY2FsbHMgd2hlbiB0cmF2ZXJzaW5n\nIHJlbGF0aW9ucwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBwa3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZGV0YWNo\nRmllbGQoZnJvbSwgcGtzW2ldLmdldEluZGV4KCksIHRydWUpOwogICAgICAg\nICAgICAgICAgZGV0YWNoVmVyc2lvbigpOwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiAhZm1k\nc1tpXS5pc1ZlcnNpb24oKSkgCiAgICAgICAgICAgICAgICAgICAgICAgIGRl\ndGFjaEZpZWxkKGZyb20sIGksIGZnZmllbGRzLmdldChpKSk7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAvLyBjbGVhciB0aGUg\nU3RhdGVNYW5hZ2VyIGZyb20gdGhlIHRhcmdldCBvYmplY3QKICAgICAgICAg\nICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICBfdG8ucGNS\nZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBEZXRhY2ggKG9yIGNsZWFy\nKSB0aGUgZ2l2ZW4gZmllbGQgaW5kZXguCiAgICAgICAgICovCiAgICAgICAg\ncHJpdmF0ZSB2b2lkIGRldGFjaEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBm\ncm9tLCBpbnQgaSwgYm9vbGVhbiBmZykgewogICAgICAgICAgICAvLyB0ZWxs\nIHRoZSBzdGF0ZSBtYW5hZ2VyIHRvIHByb3ZpZGUgdGhlIGZpZWxkcyBmcm9t\nIHRoZSBzb3VyY2UgdG8KICAgICAgICAgICAgLy8gdGhpcyBmaWVsZCBtYW5h\nZ2VyLCB3aGljaCB3aWxsIHRoZW4gcmVwbGFjZSB0aGUgZmllbGQgd2l0aCBh\nCiAgICAgICAgICAgIC8vIGRldGFjaGVkIHZlcnNpb24KICAgICAgICAgICAg\naWYgKGZnKQogICAgICAgICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGZyb20s\nIHRoaXMsIGkpOwogICAgICAgICAgICBlbHNlIGlmICghX2NvcHkpIHsKICAg\nICAgICAgICAgICAgIC8vIGlmIG5vdCBjb3B5aW5nIGFuZCBmaWVsZCBzaG91\nbGQgbm90IGJlIGRldGFjaGVkLCBjbGVhciBpdAogICAgICAgICAgICAgICAg\nY2xlYXIoKTsKICAgICAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8s\nIHRoaXMsIGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzdG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xl\nYW4gY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlQm9vbGVhbkZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmll\nbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFs\nKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBj\ndXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlz\nLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9y\nZUNoYXJGaWVsZChpbnQgZmllbGQsIGNoYXIgY3VyVmFsKSB7CiAgICAgICAg\nICAgIHN1cGVyLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxk\nKGludCBmaWVsZCwgZG91YmxlIGN1clZhbCkgewogICAgICAgICAgICBzdXBl\nci5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAg\nICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUZsb2F0RmllbGQoaW50IGZp\nZWxkLCBmbG9hdCBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVG\nbG9hdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBs\nYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1\nclZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZUludEZpZWxkKGZpZWxk\nLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0\naGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBz\ndG9yZUxvbmdGaWVsZChpbnQgZmllbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAg\nICAgICAgIHN1cGVyLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwog\nICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0Rmll\nbGQoaW50IGZpZWxkLCBzaG9ydCBjdXJWYWwpIHsKICAgICAgICAgICAgc3Vw\nZXIuc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAg\nICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBm\naWVsZCwgU3RyaW5nIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9y\nZVN0cmluZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5y\nZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdEZpZWxkKGludCBmaWVsZCwg\nT2JqZWN0IGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZU9iamVj\ndEZpZWxkKGZpZWxkLCBkZXRhY2hGaWVsZChjdXJWYWwsIGZpZWxkKSk7CiAg\nICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgb3du\nZXIgb2YgdGhlIGZpZWxkJ3MgcHJveHkgdG8gdGhlIGRldGFjaGVkIHN0YXRl\nIG1hbmFnZXIuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmplY3Qg\ncmVwcm94eShPYmplY3Qgb2JqLCBpbnQgZmllbGQpIHsKICAgICAgICAgICAg\naWYgKG9iaiAhPSBudWxsICYmIF9kZXRTTSAhPSBudWxsICYmIG9iaiBpbnN0\nYW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAgKChQcm94eSkgb2JqKS5z\nZXRPd25lcihfZGV0U00sIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIG9i\najsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERldGFjaCB0\naGUgZ2l2ZW4gdmFsdWUgaWYgbmVlZGVkLgogICAgICAgICAqLwogICAgICAg\nIHByaXZhdGUgT2JqZWN0IGRldGFjaEZpZWxkKE9iamVjdCBjdXJWYWwsIGlu\ndCBmaWVsZCkgewogICAgICAgICAgICBpZiAoY3VyVmFsID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBib29sZWFuIGNhc2NhZGUg\nPSBmYWxzZTsKICAgICAgICAgICAgaWYoX2Nhc2NhZGVXaXRoRGV0YWNoCiAg\nICAgICAgICAgICAgICB8fCBmbWQuZ2V0Q2FzY2FkZURldGFjaCgpID09IAog\nICAgICAgICAgICAgICAgICAgIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1F\nRElBVEUKICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRLZXkoKS5nZXRDYXNj\nYWRlRGV0YWNoKCkgPT0gCiAgICAgICAgICAgICAgICAgICAgVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0lNTUVESUFURSAKICAgICAgICAgICAgICAgIHx8IGZt\nZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURldGFjaCgpID09IAogICAgICAg\nICAgICAgICAgICAgIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUp\nIHsKICAgICAgICAgICAgICAgIGNhc2NhZGUgPSB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBPYmplY3QgbmV3VmFsID0g\nbnVsbDsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAgICAg\nIG5ld1ZhbCA9IF9wcm94eS5jb3B5QXJyYXkoY3VyVmFsKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBjdXJW\nYWw7CiAgICAgICAgICAgICAgICBpZiAoY2FzY2FkZSkgewogICAgICAgICAg\nICAgICAgICAgIGRldGFjaEFycmF5KG5ld1ZhbCwgZm1kKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuZXdWYWw7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICBpZiAoX2NvcHkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2Rl\ndFNNICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFs\nID0gX3Byb3h5Lm5ld0NvbGxlY3Rpb25Qcm94eShmbWQuZ2V0UHJveHlUeXBl\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVu\ndCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEluaXRpYWxpemVyKCkgaW5zdGFuY2VvZiBDb21wYXJh\ndG9yID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChDb21wYXJhdG9y\nKSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSA6IG51bGwsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBzbS5nZXRCcm9rZXIoKS5nZXRDb25maWd1cmF0aW9u\nKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRDb21wYXRpYmls\naXR5SW5zdGFuY2UoKS5nZXRBdXRvT2ZmKCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICAoKENvbGxlY3Rpb24pIG5ld1ZhbCkuYWRkQWxsKChDb2xsZWN0\naW9uKSBjdXJWYWwpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUNvbGxl\nY3Rpb24oKENvbGxlY3Rpb24pIGN1clZhbCk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBjdXJWYWw7CiAg\nICAgICAgICAgICAgICBpZiAoY2FzY2FkZSkgewogICAgICAgICAgICAgICAg\nICAgIGRldGFjaENvbGxlY3Rpb24oKENvbGxlY3Rpb24pIG5ld1ZhbCwgKENv\nbGxlY3Rpb24pIGN1clZhbCwKICAgICAgICAgICAgICAgICAgICAgICAgZm1k\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBy\nZXByb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAoX2RldFNNICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5Lm5ld01hcFByb3h5KGZt\nZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRU\neXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0SW5p\ndGlhbGl6ZXIoKSBpbnN0YW5jZW9mIENvbXBhcmF0b3IgPwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIChDb21wYXJhdG9yKSBmbWQuZ2V0SW5p\ndGlhbGl6ZXIoKSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0QnJva2VyKCkuZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldENvbXBhdGliaWxpdHlJ\nbnN0YW5jZSgpLmdldEF1dG9PZmYoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICgoTWFwKSBuZXdWYWwpLnB1dEFsbCgoTWFwKSBjdXJWYWwpOwogICAg\nICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICBuZXdWYWwgPSBfcHJveHkuY29weU1hcCgoTWFwKSBjdXJWYWwpOwogICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgbmV3VmFs\nID0gY3VyVmFsOwogICAgICAgICAgICAgICAgaWYgKGNhc2NhZGUpIHsKICAg\nICAgICAgICAgICAgICAgICBkZXRhY2hNYXAoKE1hcCkgbmV3VmFsLCAoTWFw\nKSBjdXJWYWwsIGZtZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVwcm94eShuZXdWYWwsIGZpZWxkKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgICAgICBu\nZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5LmNvcHlDYWxlbmRhcigoQ2FsZW5k\nYXIpIGN1clZhbCkgOgogICAgICAgICAgICAgICAgICAgIGN1clZhbDsKICAg\nICAgICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwgZmllbGQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgbmV3VmFsID0gKF9jb3B5KSA/IF9wcm94eS5jb3B5RGF0ZSgoRGF0ZSkg\nY3VyVmFsKSA6IGN1clZhbDsKICAgICAgICAgICAgICAgIHJldHVybiByZXBy\nb3h5KG5ld1ZhbCwgZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAg\nICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNvcHlDdXN0b20oY3VyVmFs\nKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXByb3h5KChuZXdWYWwgPT0g\nbnVsbCkgPyBjdXJWYWwgOiBuZXdWYWwsIGZpZWxkKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBpZiAoY2FzY2FkZSkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXRhY2hJbnRlcm5hbChjdXJW\nYWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJu\nIGN1clZhbDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHJldHVybiBjdXJWYWw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIE1ha2Ugc3VyZSBhbGwgdGhlIHZhbHVlcyBp\nbiB0aGUgZ2l2ZW4gYXJyYXkgYXJlIGRldGFjaGVkLgogICAgICAgICAqLwog\nICAgICAgIHByaXZhdGUgdm9pZCBkZXRhY2hBcnJheShPYmplY3QgYXJyYXks\nIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgICAgIGlmICghZm1kLmdl\ndEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm47CgogICAgICAgICAgICBpbnQgbGVuID0gQXJyYXkuZ2V0TGVu\nZ3RoKGFycmF5KTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBs\nZW47IGkrKykKICAgICAgICAgICAgICAgIEFycmF5LnNldChhcnJheSwgaSwg\nZGV0YWNoSW50ZXJuYWwoQXJyYXkuZ2V0KGFycmF5LCBpKSkpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTWFrZSBzdXJlIGFsbCB0aGUg\ndmFsdWVzIGluIHRoZSBnaXZlbiBjb2xsZWN0aW9uIGFyZSBkZXRhY2hlZC4K\nICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0YWNoQ29sbGVj\ndGlvbihDb2xsZWN0aW9uIGNvbGwsIENvbGxlY3Rpb24gb3JpZywKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAgICAgLy8gY29s\nbCBjYW4gYmUgbnVsbCBpZiBub3QgY29weWFibGUKICAgICAgICAgICAgaWYg\nKF9jb3B5ICYmIGNvbGwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtY29weWFibGUiLCBm\nbWQpKTsKICAgICAgICAgICAgaWYgKCFmbWQuZ2V0RWxlbWVudCgpLmlzRGVj\nbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgICAgIC8vIHVuZm9ydHVuYXRlbHkgd2UgaGF2ZSB0byBjbGVhciB0aGUg\nb3JpZ2luYWwgYW5kIHJlLWFkZCB0byBjb3B5CiAgICAgICAgICAgIGlmIChf\nY29weSkKICAgICAgICAgICAgICAgIGNvbGwuY2xlYXIoKTsKICAgICAgICAg\nICAgT2JqZWN0IGRldGFjaGVkOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG9yaWcuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgIGRldGFjaGVkID0gZGV0YWNoSW50ZXJuYWwoaXRyLm5l\neHQoKSk7CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAg\nICAgICAgICAgY29sbC5hZGQoZGV0YWNoZWQpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBNYWtlIHN1cmUgYWxs\nIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIG1hcCBhcmUgZGV0YWNoZWQuCiAg\nICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRldGFjaE1hcChNYXAg\nbWFwLCBNYXAgb3JpZywgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAg\nICAgLy8gbWFwIGNhbiBiZSBudWxsIGlmIG5vdCBjb3B5YWJsZQogICAgICAg\nICAgICBpZiAoX2NvcHkgJiYgbWFwID09IG51bGwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm90LWNvcHlh\nYmxlIiwgZm1kKSk7CiAgICAgICAgICAgIGJvb2xlYW4ga2V5UEMgPSBmbWQu\nZ2V0S2V5KCkuaXNEZWNsYXJlZFR5cGVQQygpOwogICAgICAgICAgICBib29s\nZWFuIHZhbFBDID0gZm1kLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBD\nKCk7CiAgICAgICAgICAgIGlmICgha2V5UEMgJiYgIXZhbFBDKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSB0\nbyBjb3B5IGtleXMsIGp1c3QgY2xlYXIgYW5kIHJlLWFkZDsgb3RoZXJ3aXNl\nCiAgICAgICAgICAgIC8vIHdlIGNhbiB1c2UgdGhlIGVudHJ5IHNldCB0byBy\nZXNldCB0aGUgdmFsdWVzIG9ubHkKICAgICAgICAgICAgTWFwLkVudHJ5IGVu\ndHJ5OwogICAgICAgICAgICBpZiAoIV9jb3B5IHx8IGtleVBDKSB7CiAgICAg\nICAgICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgbWFw\nLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9yaWcuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyl7CiAgICAgICAgICAg\nICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAg\nICAgICAgICAgICAgICAgIGtleSA9IGVudHJ5LmdldEtleSgpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChrZXlQQykKICAgICAgICAgICAgICAgICAgICAg\nICAga2V5ID0gZGV0YWNoSW50ZXJuYWwoa2V5KTsKICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAg\nICAgIGlmICh2YWxQQykKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0g\nZGV0YWNoSW50ZXJuYWwodmFsKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nX2NvcHkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5wdXQoa2V5LCB2\nYWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQgKCk7CiAg\nICAgICAgICAgICAgICAgICAgZW50cnkuc2V0VmFsdWUgKGRldGFjaEludGVy\nbmFsIChlbnRyeS5nZXRWYWx1ZSAoKSkpOwoJCQkJfQoJCQl9CgkJfQoJfQp9\nCg==\n","encoding":"base64"}

