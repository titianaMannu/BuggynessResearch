{"sha":"475b5351dce1854bc6faa0b35d2f393a684dbd43","node_id":"MDQ6QmxvYjIwNjM2NDo0NzViNTM1MWRjZTE4NTRiYzZmYWEwYjM1ZDJmMzkzYTY4NGRiZDQz","size":31378,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/475b5351dce1854bc6faa0b35d2f393a684dbd43","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWJzdHJhY3RFeHByZXNzaW9u\nVmlzaXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uRmFjdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9uUGFyc2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkZpbHRl\nckxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLkluTWVtb3J5RXhwcmVzc2lvbkZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGF0aDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5RdWVyeUV4cHJlc3Npb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlJlc29sdmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlN0cmluZ0Nv\nbnRhaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBz\nLlZhbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5W\nYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5X\naWxkY2FyZE1hdGNoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5y\nb3AuTGlzdFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5yb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVj\ndFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5PcmRlcmVkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52\nYWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIEltcGxlbWVu\ndGF0aW9uIG9mIGFuIGV4cHJlc3Npb24tYmFzZWQgcXVlcnksIHdoaWNoIGNh\nbiBoYW5kbGUKICogU3RyaW5nLWJhc2VkIHF1ZXJ5IGV4cHJlc3Npb25zIHN1\nY2ggYXMgSlBRTCBhbmQgSkRPUUwuCiAqIFRoaXMgaW1wbGVtZW50YXRpb24g\naXMgc3VpdGFibGUgZm9yIGluLW1lbW9yeSBvcGVyYXRpb24uCiAqIE92ZXJy\naWRlIHRoZSBmb2xsb3dpbmcgbWV0aG9kcyB0byBhbHNvIHN1cHBvcnQgZGF0\nYXN0b3JlIG9wZXJhdGlvbjoKICogPHVsPgogKiA8bGk+T3ZlcnJpZGUge0Bs\naW5rICNzdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbn0gdG8gcmV0dXJuCiAq\nIDxjb2RlPnRydWU8L2NvZGU+LjwvbGk+CiAqIDxsaT5PdmVycmlkZSB7QGxp\nbmsgI2V4ZWN1dGVRdWVyeX0sIHtAbGluayAjZXhlY3V0ZURlbGV0ZX0sIGFu\nZAogKiB7QGxpbmsgI2V4ZWN1dGVVcGRhdGV9IHRvIGV4ZWN1dGUgdGhlIHF1\nZXJ5IGFnYWluc3QgdGhlIGRhdGEgc3RvcmUuCiAqIEtlZXAgaW4gbWluZCB0\naGF0IHRoZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGlzIG1ldGhvZCBtaWdo\ndCBiZSBpbiB1c2UKICogYnkgc2V2ZXJhbCB0aHJlYWRzIGluIGRpZmZlcmVu\ndCBxdWVyeSBpbnN0YW5jZXMuIFRodXMgY29tcG9uZW50cyBsaWtlCiAqIHRo\nZSBleHByZXNzaW9uIGZhY3RvcnkgbXVzdCBlaXRoZXIgYmUgdGhyZWFkIHNh\nZmUsIG9yIHRoaXMgbWV0aG9kIG11c3QKICogc3luY2hyb25pemUgb24gdGhl\nbS48L2xpPgogKiA8bGk+T3ZlcnJpZGUge0BsaW5rICNnZXREYXRhU3RvcmVB\nY3Rpb25zfSB0byByZXR1cm4gYSByZXByZXNlbnRhdGlvbiBvZgogKiB0aGUg\nYWN0aW9ucyB0aGF0IHdpbGwgYmUgdGFrZW4gb24gdGhlIGRhdGEgc3RvcmUu\nIEZvciB1c2UgaW4gdmlzdWFsCiAqIHRvb2xzLjwvbGk+CiAqIDxsaT5PdmVy\ncmlkZSB7QGxpbmsgI2dldEV4cHJlc3Npb25GYWN0b3J5fSB0byByZXR1cm4g\nYSBmYWN0b3J5IGZvciBjcmVhdGluZwogKiBleHByZXNzaW9ucyBpbiB0aGUg\nZGF0YXN0b3JlJ3MgbGFuZ3VhZ2UuIFRoZSBmYWN0b3J5IG11c3QgYmUgY2Fj\naGFibGUuPC9saT4KICogPC91bD4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICovCnB1YmxpYyBjbGFzcyBFeHByZXNzaW9uU3RvcmVRdWVyeQogICAgZXh0\nZW5kcyBBYnN0cmFjdFN0b3JlUXVlcnkgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoRXhwcmVzc2lvblN0b3JlUXVlcnkuY2xhc3MpOwoKICAgIC8v\nIG1haW50YWluIHN1cHBvcnQgZm9yIGEgY291cGxlIG9mIGRlcHJlY2F0ZWQg\nZXh0ZW5zaW9ucwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgRmlsdGVyTGlz\ndGVuZXJbXSBfbGlzdGVuZXJzID0gbmV3IEZpbHRlckxpc3RlbmVyW117CiAg\nICAgICAgbmV3IFN0cmluZ0NvbnRhaW5zKCksIG5ldyBXaWxkY2FyZE1hdGNo\nKCksCiAgICB9OwoKICAgIHByaXZhdGUgZmluYWwgRXhwcmVzc2lvblBhcnNl\nciBfcGFyc2VyOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgT2JqZWN0IF9wYXJz\nZWQ7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSBxdWVyeSB3aXRoIGEg\ncGFyc2VyIGZvciB0aGUgbGFuZ3VhZ2UuCiAgICAgKi8KICAgIHB1YmxpYyBF\neHByZXNzaW9uU3RvcmVRdWVyeShFeHByZXNzaW9uUGFyc2VyIHBhcnNlcikg\newogICAgICAgIF9wYXJzZXIgPSBwYXJzZXI7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXNvbHZlciB1c2VkIGluIHBhcnNpbmcuCiAgICAgKi8KICAgIHB1\nYmxpYyBSZXNvbHZlciBnZXRSZXNvbHZlcigpIHsKICAgICAgICByZXR1cm4g\nbmV3IFJlc29sdmVyKCkgewogICAgICAgICAgICBwdWJsaWMgQ2xhc3MgY2xh\nc3NGb3JOYW1lKFN0cmluZyBuYW1lLCBTdHJpbmdbXSBpbXBvcnRzKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gY3R4LmNsYXNzRm9yTmFtZShuYW1lLCBp\nbXBvcnRzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEZp\nbHRlckxpc3RlbmVyIGdldEZpbHRlckxpc3RlbmVyKFN0cmluZyB0YWcpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBjdHguZ2V0RmlsdGVyTGlzdGVuZXIo\ndGFnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEFnZ3Jl\nZ2F0ZUxpc3RlbmVyIGdldEFnZ3JlZ2F0ZUxpc3RlbmVyKFN0cmluZyB0YWcp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBjdHguZ2V0QWdncmVnYXRlTGlz\ndGVuZXIodGFnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIE9wZW5KUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gY3R4LmdldFN0b3JlQ29udGV4dCgpLmdl\ndENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIFF1ZXJ5Q29udGV4dCBnZXRRdWVyeUNvbnRleHQoKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gY3R4OwogICAgICAgICAgICB9CiAgICAgICAg\nfTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IGRpcmVjdCBzZXR0aW5n\nIG9mIHBhcnNlZCBzdGF0ZSBmb3IgZmFjYWRlcyB0aGF0IGRvIHBhcnNpbmcu\nCiAgICAgKiBUaGUgZmFjYWRlIHNob3VsZCBjYWxsIHRoaXMgbWV0aG9kIHR3\naWNlOiBvbmNlIHdpdGggdGhlIHF1ZXJ5IHN0cmluZywKICAgICAqIGFuZCBh\nZ2FpbiB3aXRoIHRoZSBwYXJzZWQgc3RhdGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIHNldFF1ZXJ5KE9iamVjdCBxdWVyeSkgewogICAgICAgIF9w\nYXJzZWQgPSBxdWVyeTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAg\nICBwdWJsaWMgRmlsdGVyTGlzdGVuZXIgZ2V0RmlsdGVyTGlzdGVuZXIoU3Ry\naW5nIHRhZykgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2xpc3Rl\nbmVycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKF9saXN0ZW5lcnNb\naV0uZ2V0VGFnKCkuZXF1YWxzKHRhZykpCiAgICAgICAgICAgICAgICByZXR1\ncm4gX2xpc3RlbmVyc1tpXTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IG5ld0NvbXBpbGF0aW9uKCkgewogICAgICAg\nIGlmIChfcGFyc2VkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfcGFy\nc2VkOwogICAgICAgIHJldHVybiBfcGFyc2VyLnBhcnNlKGN0eC5nZXRRdWVy\neVN0cmluZygpLCB0aGlzKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwb3B1\nbGF0ZUZyb21Db21waWxhdGlvbihPYmplY3QgY29tcCkgewogICAgICAgIF9w\nYXJzZXIucG9wdWxhdGUoY29tcCwgdGhpcyk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCkgewogICAgICAgIF9wYXJz\nZWQgPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nSW5NZW1vcnlFeGVjdXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgcHVibGljIEV4ZWN1dG9yIG5ld0luTWVtb3J5RXhlY3V0b3Io\nQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBy\nZXR1cm4gbmV3IEluTWVtb3J5RXhlY3V0b3IodGhpcywgbWV0YSwgc3Vicywg\nX3BhcnNlciwKICAgICAgICAgICAgY3R4LmdldENvbXBpbGF0aW9uKCkpOwog\nICAgfQoKICAgIHB1YmxpYyBFeGVjdXRvciBuZXdEYXRhU3RvcmVFeGVjdXRv\ncihDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gc3VicykgewogICAgICAg\nIHJldHVybiBuZXcgRGF0YVN0b3JlRXhlY3V0b3IodGhpcywgbWV0YSwgc3Vi\ncywgX3BhcnNlciwKICAgICAgICAgICAgY3R4LmdldENvbXBpbGF0aW9uKCkp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nTWV0aG9kcyBmb3IgT3ZlcnJpZGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGUgZ2l2ZW4gZXhwcmVz\nc2lvbiBhZ2FpbnN0IHRoZSBnaXZlbiBjYW5kaWRhdGUgZXh0ZW50LgogICAg\nICoKICAgICAqIEBwYXJhbSBleCBjdXJyZW50IGV4ZWN1dG9yCiAgICAgKiBA\ncGFyYW0gYmFzZSB0aGUgYmFzZSB0eXBlIHRoZSBxdWVyeSBzaG91bGQgbWF0\nY2gKICAgICAqIEBwYXJhbSB0eXBlcyB0aGUgaW5kZXBlbmRlbnQgY2FuZGlk\nYXRlIHR5cGVzCiAgICAgKiBAcGFyYW0gc3ViY2xhc3NlcyB0cnVlIGlmIHN1\nYmNsYXNzZXMgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHRzCiAg\nICAgKiBAcGFyYW0gZmFjdHMgdGhlIGV4cHJlc3Npb24gZmFjdG9yeSB1c2Vk\nIHRvIGJ1aWxkIHRoZSBxdWVyeSBmb3IKICAgICAqIGVhY2ggYmFzZSB0eXBl\nCiAgICAgKiBAcGFyYW0gcGFyc2VkIHRoZSBwYXJzZWQgcXVlcnkgdmFsdWVz\nCiAgICAgKiBAcGFyYW0gcGFyYW1zIHBhcmFtZXRlciB2YWx1ZXMsIG9yIGVt\ncHR5IGFycmF5CiAgICAgKiBAcGFyYW0gcmFuZ2UgcmVzdWx0IHJhbmdlCiAg\nICAgKiBAcmV0dXJuIGEgcHJvdmlkZXIgZm9yIG1hdGNoaW5nIG9iamVjdHMK\nICAgICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4\nZWN1dGVRdWVyeShFeGVjdXRvciBleCwKICAgICAgICBDbGFzc01ldGFEYXRh\nIGJhc2UsIENsYXNzTWV0YURhdGFbXSB0eXBlcywgYm9vbGVhbiBzdWJjbGFz\nc2VzLAogICAgICAgIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsIFF1ZXJ5\nRXhwcmVzc2lvbnNbXSBwYXJzZWQsIE9iamVjdFtdIHBhcmFtcywKICAgICAg\nICBSYW5nZSByYW5nZSkgewogICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0\naGUgZ2l2ZW4gZXhwcmVzc2lvbiBhZ2FpbnN0IHRoZSBnaXZlbiBjYW5kaWRh\ndGUgZXh0ZW50CiAgICAgKiBhbmQgZGVsZXRlIHRoZSBpbnN0YW5jZXMuCiAg\nICAgKgogICAgICogQHBhcmFtIGV4IGN1cnJlbnQgZXhlY3V0b3IKICAgICAq\nIEBwYXJhbSBiYXNlIHRoZSBiYXNlIHR5cGUgdGhlIHF1ZXJ5IHNob3VsZCBt\nYXRjaAogICAgICogQHBhcmFtIHR5cGVzIHRoZSBpbmRlcGVuZGVudCBjYW5k\naWRhdGUgdHlwZXMKICAgICAqIEBwYXJhbSBzdWJjbGFzc2VzIHRydWUgaWYg\nc3ViY2xhc3NlcyBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdHMK\nICAgICAqIEBwYXJhbSBmYWN0cyB0aGUgZXhwcmVzc2lvbiBmYWN0b3J5IHVz\nZWQgdG8gYnVpbGQgdGhlIHF1ZXJ5IGZvcgogICAgICogZWFjaCBiYXNlIHR5\ncGUKICAgICAqIEBwYXJhbSBwYXJzZWQgdGhlIHBhcnNlZCBxdWVyeSB2YWx1\nZXMKICAgICAqIEBwYXJhbSBwYXJhbXMgcGFyYW1ldGVyIHZhbHVlcywgb3Ig\nZW1wdHkgYXJyYXkKICAgICAqIEByZXR1cm4gYSBudW1iZXIgaW5kaWNhdGlu\nZyB0aGUgbnVtYmVyIG9mIGluc3RhbmNlcyBkZWxldGVkLAogICAgICogb3Ig\nbnVsbCB0byBleGVjdXRlIHRoZSBkZWxldGUgaW4gbWVtb3J5CiAgICAgKi8K\nICAgIHByb3RlY3RlZCBOdW1iZXIgZXhlY3V0ZURlbGV0ZShFeGVjdXRvciBl\neCwgQ2xhc3NNZXRhRGF0YSBiYXNlLAogICAgICAgIENsYXNzTWV0YURhdGFb\nXSB0eXBlcywgYm9vbGVhbiBzdWJjbGFzc2VzLCBFeHByZXNzaW9uRmFjdG9y\neVtdIGZhY3RzLAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNbXSBwYXJzZWQs\nIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGUgZ2l2ZW4gZXhwcmVzc2lv\nbiBhZ2FpbnN0IHRoZSBnaXZlbiBjYW5kaWRhdGUgZXh0ZW50CiAgICAgKiBh\nbmQgdXBkYXRlcyB0aGUgaW5zdGFuY2VzLgogICAgICoKICAgICAqIEBwYXJh\nbSBleCBjdXJyZW50IGV4ZWN1dG9yCiAgICAgKiBAcGFyYW0gYmFzZSB0aGUg\nYmFzZSB0eXBlIHRoZSBxdWVyeSBzaG91bGQgbWF0Y2gKICAgICAqIEBwYXJh\nbSB0eXBlcyB0aGUgaW5kZXBlbmRlbnQgY2FuZGlkYXRlIHR5cGVzCiAgICAg\nKiBAcGFyYW0gc3ViY2xhc3NlcyB0cnVlIGlmIHN1YmNsYXNzZXMgc2hvdWxk\nIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHRzCiAgICAgKiBAcGFyYW0gZmFj\ndHMgdGhlIGV4cHJlc3Npb24gZmFjdG9yeSB1c2VkIHRvIGJ1aWxkIHRoZSBx\ndWVyeSBmb3IKICAgICAqIGVhY2ggYmFzZSB0eXBlCiAgICAgKiBAcGFyYW0g\ncGFyc2VkIHRoZSBwYXJzZWQgcXVlcnkgdmFsdWVzCiAgICAgKiBAcGFyYW0g\ncGFyYW1zIHBhcmFtZXRlciB2YWx1ZXMsIG9yIGVtcHR5IGFycmF5CiAgICAg\nKiBAcmV0dXJuIGEgbnVtYmVyIGluZGljYXRpbmcgdGhlIG51bWJlciBvZiBp\nbnN0YW5jZXMgdXBkYXRlZCwKICAgICAqIG9yIG51bGwgdG8gZXhlY3V0ZSB0\naGUgdXBkYXRlIGluIG1lbW9yeS4KICAgICAqLwogICAgcHJvdGVjdGVkIE51\nbWJlciBleGVjdXRlVXBkYXRlKEV4ZWN1dG9yIGV4LCBDbGFzc01ldGFEYXRh\nIGJhc2UsCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIHR5cGVzLCBib29sZWFu\nIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsCiAgICAg\nICAgUXVlcnlFeHByZXNzaW9uc1tdIHBhcnNlZCwgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNvbW1hbmRzIHRoYXQgd2lsbCBiZSBzZW50IHRvIHRo\nZSBkYXRhc3RvcmUgaW4gb3JkZXIKICAgICAqIHRvIGV4ZWN1dGUgdGhlIHF1\nZXJ5LCB0eXBpY2FsbHkgaW4gdGhlIGRhdGFiYXNlJ3MgbmF0aXZlIGxhbmd1\nYWdlLgogICAgICoKICAgICAqIEBwYXJhbSBiYXNlIHRoZSBiYXNlIHR5cGUg\ndGhlIHF1ZXJ5IHNob3VsZCBtYXRjaAogICAgICogQHBhcmFtIHR5cGVzIHRo\nZSBpbmRlcGVuZGVudCBjYW5kaWRhdGUgdHlwZXMKICAgICAqIEBwYXJhbSBz\ndWJjbGFzc2VzIHRydWUgaWYgc3ViY2xhc3NlcyBzaG91bGQgYmUgaW5jbHVk\nZWQgaW4gdGhlIHJlc3VsdHMKICAgICAqIEBwYXJhbSBmYWN0cyB0aGUgZXhw\ncmVzc2lvbiBmYWN0b3J5IHVzZWQgdG8gYnVpbGQgdGhlIHF1ZXJ5IGZvcgog\nICAgICogZWFjaCBiYXNlIHR5cGUKICAgICAqIEBwYXJhbSBwYXJzZWQgdGhl\nIHBhcnNlZCBxdWVyeSB2YWx1ZXMKICAgICAqIEBwYXJhbSBwYXJhbXMgcGFy\nYW1ldGVyIHZhbHVlcywgb3IgZW1wdHkgYXJyYXkKICAgICAqIEBwYXJhbSBy\nYW5nZSByZXN1bHQgcmFuZ2UKICAgICAqIEByZXR1cm4gYSB0ZXh0dWFsIGRl\nc2NyaXB0aW9uIG9mIHRoZSBxdWVyeSB0byBleGVjdXRlCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKENsYXNz\nTWV0YURhdGEgYmFzZSwKICAgICAgICBDbGFzc01ldGFEYXRhW10gdHlwZXMs\nIGJvb2xlYW4gc3ViY2xhc3NlcywgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0\ncywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zW10gcGFyc2VkLCBPYmplY3Rb\nXSBwYXJhbXMsIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgcmV0dXJuIFN0b3Jl\nUXVlcnkuRU1QVFlfU1RSSU5HUzsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgYXNzaWduYWJsZSB0eXBlcyBmb3IgdGhlIGdpdmVuIG1ldGFk\nYXRhIHdob3NlIGV4cHJlc3Npb24KICAgICAqIHRyZWVzIG11c3QgYmUgY29t\ncGlsZWQgaW5kZXBlbmRlbnRseS4KICAgICAqLwogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGFbXSBnZXRJbmRlcGVuZGVudEV4cHJlc3Npb25DYW5kaWRh\ndGVzCiAgICAgICAgKENsYXNzTWV0YURhdGEgdHlwZSwgYm9vbGVhbiBzdWJj\nbGFzc2VzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01ldGFEYXRhW117\nIHR5cGUgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiB7QGxp\nbmsgRXhwcmVzc2lvbkZhY3Rvcnl9IHRvIHVzZSB0byBjcmVhdGUgYW4gZXhw\ncmVzc2lvbiB0bwogICAgICogYmUgZXhlY3V0ZWQgYWdhaW5zdCBhbiBleHRl\nbnQuIEVhY2ggZmFjdG9yeSB3aWxsIGJlIHVzZWQgdG8gY29tcGlsZQogICAg\nICogb25lIGZpbHRlciBvbmx5LiBUaGUgZmFjdG9yeSBtdXN0IGJlIGNhY2hh\nYmxlLgogICAgICovCiAgICBwcm90ZWN0ZWQgRXhwcmVzc2lvbkZhY3Rvcnkg\nZ2V0RXhwcmVzc2lvbkZhY3RvcnkoQ2xhc3NNZXRhRGF0YSB0eXBlKSB7CiAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQcm92aWRlcyBzdXBwb3J0IGZvciBxdWVyaWVz\nIHRoYXQgaG9sZCBxdWVyeSBpbmZvcm1hdGlvbgogICAgICogaW4gYSB7QGxp\nbmsgUXVlcnlFeHByZXNzaW9uc30gaW5zdGFuY2UuCiAgICAgKgogICAgICog\nQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdEV4cHJlc3Npb25FeGVj\ndXRvcgogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RFeGVjdXRvcgogICAgICAg\nIGltcGxlbWVudHMgRXhlY3V0b3IgewoKICAgICAgICAvKioKICAgICAgICAg\nKiBSZXR1cm4gdGhlIHF1ZXJ5IGV4cHJlc3Npb25zIGZvciBvbmUgY2FuZGlk\nYXRlIHR5cGUsIG9yIGRpZSBpZiBub25lLgogICAgICAgICAqLwogICAgICAg\nIHByaXZhdGUgUXVlcnlFeHByZXNzaW9ucyBhc3NlcnRRdWVyeUV4cHJlc3Np\nb24oKSB7CiAgICAgICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHAgPSBn\nZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgICAgIGlmIChleHAgPT0g\nbnVsbCB8fCBleHAubGVuZ3RoIDwgMSkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWV4cHJl\nc3Npb25zIikpOwoKICAgICAgICAgICAgcmV0dXJuIGV4cFswXTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFRocm93IHByb3BlciBleGNl\ncHRpb24gaWYgZ2l2ZW4gdmFsdWUgaXMgYSBjb2xsZWN0aW9uL21hcC9hcnJh\neS4KICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgdm9pZCBhc3NlcnRO\nb3RDb250YWluZXIoVmFsdWUgdmFsLCBTdG9yZVF1ZXJ5IHEpIHsKICAgICAg\nICAgICAgLy8gdmFyaWFibGVzIHJlcHJlc2VudCBjb250YWluZXIgZWxlbWVu\ndHMsIG5vdCB0aGUgY29udGFpbmVyIGl0c2VsZgogICAgICAgICAgICBpZiAo\ndmFsLmlzVmFyaWFibGUoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgICAgIENsYXNzPD8+IHR5cGU7CiAgICAgICAgICAgIGlmICh2YWwg\naW5zdGFuY2VvZiBQYXRoKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9ICgoUGF0aCkgdmFsKS5sYXN0KCk7CiAgICAgICAgICAgICAg\nICB0eXBlID0gKGZtZCA9PSBudWxsKSA/IHZhbC5nZXRUeXBlKCkgOiBmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgdHlwZSA9IHZhbC5nZXRUeXBlKCk7CgogICAgICAgICAgICBz\nd2l0Y2ggKEphdmFUeXBlcy5nZXRUeXBlQ29kZSh0eXBlKSkgewogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJjb250YWluZXItcHJvamVj\ndGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHEuZ2V0Q29udGV4dCgp\nLmdldFF1ZXJ5U3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGZpbmFsIHZvaWQgdmFsaWRhdGUoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcyA9IGFz\nc2VydFF1ZXJ5RXhwcmVzc2lvbigpOyAgICAKICAgICAgICAgICAgVmFsaWRh\ndGVHcm91cGluZ0V4cHJlc3Npb25WaXNpdG9yLnZhbGlkYXRlKHEuZ2V0Q29u\ndGV4dCgpLCBleHBzKTsgCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBnZXRSYW5nZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywgUmFu\nZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBz\nID0gYXNzZXJ0UXVlcnlFeHByZXNzaW9uKCk7CiAgICAgICAgICAgIGlmIChl\neHBzLnJhbmdlLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgaWYgKGV4cHMucmFuZ2UubGVuZ3RoID09IDIgCiAg\nICAgICAgICAgICAgICAmJiBleHBzLnJhbmdlWzBdIGluc3RhbmNlb2YgQ29u\nc3RhbnQKICAgICAgICAgICAgICAgICYmIGV4cHMucmFuZ2VbMV0gaW5zdGFu\nY2VvZiBDb25zdGFudCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICByYW5nZS5zdGFydCA9ICgoTnVtYmVyKSAoKENvbnN0\nYW50KSBleHBzLnJhbmdlWzBdKS4KICAgICAgICAgICAgICAgICAgICAgICAg\nZ2V0VmFsdWUocGFyYW1zKSkubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAg\nICAgICAgcmFuZ2UuZW5kID0gKChOdW1iZXIpICgoQ29uc3RhbnQpIGV4cHMu\ncmFuZ2VbMV0pLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRWYWx1ZShw\nYXJhbXMpKS5sb25nVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICB9IGNhdGNoIChDbGFzc0Nhc3RFeGNlcHRp\nb24gY2NlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZmFsbCB0aHJvdWdo\nIHRvIGV4Y2VwdGlvbiBiZWxvdwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nTnVsbFBvaW50ZXJFeGNlcHRpb24gbnBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gZmFsbCB0aHJvdWdoIHRvIGV4Y2VwdGlvbiBiZWxvdwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJvbmx5LXJhbmdlLWNvbnN0YW50\ncyIsCiAgICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRRdWVyeVN0\ncmluZygpKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmluYWwgQ2xh\nc3M8Pz4gZ2V0UmVzdWx0Q2xhc3MoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiBhc3NlcnRRdWVyeUV4cHJlc3Npb24oKS5yZXN1bHRDbGFz\nczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIGZpbmFsIFJl\nc3VsdFNoYXBlPD8+IGdldFJlc3VsdFNoYXBlKFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICByZXR1cm4gYXNzZXJ0UXVlcnlFeHByZXNzaW9uKCkuc2hh\ncGU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbltd\nIGdldEFzY2VuZGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0\ndXJuIGFzc2VydFF1ZXJ5RXhwcmVzc2lvbigpLmFzY2VuZGluZzsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBmaW5hbCBTdHJpbmcgZ2V0QWxpYXMoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NlcnRRdWVyeUV4\ncHJlc3Npb24oKS5hbGlhczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBm\naW5hbCBTdHJpbmdbXSBnZXRQcm9qZWN0aW9uQWxpYXNlcyhTdG9yZVF1ZXJ5\nIHEpIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2VydFF1ZXJ5RXhwcmVzc2lv\nbigpLnByb2plY3Rpb25BbGlhc2VzOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBwdWJsaWMgQ2xhc3M8Pz5bXSBnZXRQcm9qZWN0aW9uVHlwZXMoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGZpbmFsIGludCBnZXRPcGVyYXRpb24oU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NlcnRRdWVyeUV4\ncHJlc3Npb24oKS5vcGVyYXRpb247CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgZmluYWwgYm9vbGVhbiBpc0FnZ3JlZ2F0ZShTdG9yZVF1ZXJ5IHEpIHsK\nICAgICAgICAgICAgcmV0dXJuIGFzc2VydFF1ZXJ5RXhwcmVzc2lvbigpLmlz\nQWdncmVnYXRlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1Ymxp\nYyBmaW5hbCBib29sZWFuIGlzRGlzdGluY3QoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBhc3NlcnRRdWVyeUV4cHJlc3Npb24oKS5pc0Rp\nc3RpbmN0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmluYWwgYm9v\nbGVhbiBoYXNHcm91cGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAg\ncmV0dXJuIGFzc2VydFF1ZXJ5RXhwcmVzc2lvbigpLmdyb3VwaW5nLmxlbmd0\naCA+IDA7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZmluYWwgT3JkZXJl\nZE1hcDxPYmplY3QsQ2xhc3M8Pz4+IGdldE9yZGVyZWRQYXJhbWV0ZXJUeXBl\ncyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2VydFF1\nZXJ5RXhwcmVzc2lvbigpLnBhcmFtZXRlclR5cGVzOwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIE9iamVjdFtdIGZyb20g\ndGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdXNlciBwYXJhbWV0ZXJzLgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b1BhcmFtZXRlckFy\ncmF5KFN0b3JlUXVlcnkgcSwgTWFwPD8sPz4gdXNlclBhcmFtcykgewogICAg\nICAgICAgICBpZiAodXNlclBhcmFtcyA9PSBudWxsIHx8IHVzZXJQYXJhbXMu\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIFN0b3JlUXVlcnku\nRU1QVFlfT0JKRUNUUzsKCiAgICAgICAgICAgIE9yZGVyZWRNYXA8PyxDbGFz\nczw/Pj4gcGFyYW1UeXBlcyA9IGdldE9yZGVyZWRQYXJhbWV0ZXJUeXBlcyhx\nKTsKICAgICAgICAgICAgT2JqZWN0W10gYXJyID0gbmV3IE9iamVjdFt1c2Vy\nUGFyYW1zLnNpemUoKV07CiAgICAgICAgICAgIGludCBiYXNlID0gcG9zaXRp\nb25hbFBhcmFtZXRlckJhc2UodXNlclBhcmFtcy5rZXlTZXQoKSk7CiAgICAg\nICAgICAgIGZvciAoT2JqZWN0IGtleSA6IHBhcmFtVHlwZXMua2V5U2V0KCkp\nIHsKICAgICAgICAgICAgICAgIGludCBpZHggPSAoa2V5IGluc3RhbmNlb2Yg\nSW50ZWdlcikgCiAgICAgICAgICAgICAgICAgICAgPyAoKEludGVnZXIpa2V5\nKS5pbnRWYWx1ZSgpIC0gYmFzZSAKICAgICAgICAgICAgICAgICAgICA6IHBh\ncmFtVHlwZXMuaW5kZXhPZihrZXkpOwogICAgICAgICAgICAgICAgaWYgKGlk\neCA+PSBhcnIubGVuZ3RoIHx8IGlkeCA8IDApCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJnYXAt\ncXVlcnktcGFyYW0iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXtxLmdldENvbnRleHQoKS5nZXRRdWVyeVN0cmluZygpLCBr\nZXksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlclBhcmFtcy5z\naXplKCksIHVzZXJQYXJhbXN9KSk7CiAgICAgICAgICAgICAgICBPYmplY3Qg\ndmFsdWUgPSB1c2VyUGFyYW1zLmdldChrZXkpOwogICAgICAgICAgICAgICAg\ndmFsaWRhdGVQYXJhbWV0ZXJWYWx1ZShrZXksIHZhbHVlLCAoQ2xhc3MpcGFy\nYW1UeXBlcy5nZXQoa2V5KSk7CiAgICAgICAgICAgICAgICBhcnJbaWR4XSA9\nIHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhcnI7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFJl\ndHVybiB0aGUgYmFzZSAoZ2VuZXJhbGx5IDAgb3IgMSkgdG8gdXNlIGZvciBw\nb3NpdGlvbmFsIHBhcmFtZXRlcnMuCiAgICAgICAgICovCiAgICAgICAgcHJp\ndmF0ZSBzdGF0aWMgaW50IHBvc2l0aW9uYWxQYXJhbWV0ZXJCYXNlKENvbGxl\nY3Rpb24gcGFyYW1zKSB7CiAgICAgICAgICAgIGludCBsb3cgPSBJbnRlZ2Vy\nLk1BWF9WQUxVRTsKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAg\nICAgaW50IHZhbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBw\nYXJhbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nIShvYmogaW5zdGFuY2VvZiBOdW1iZXIpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiAwOyAvLyB1c2UgMCBiYXNlIHdoZW4gcGFyYW1zIGFyZSBtaXhl\nZCB0eXBlcwoKICAgICAgICAgICAgICAgIHZhbCA9ICgoTnVtYmVyKSBvYmop\nLmludFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAodmFsID09IDApCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgICAg\nIGlmICh2YWwgPCBsb3cpCiAgICAgICAgICAgICAgICAgICAgbG93ID0gdmFs\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBsb3c7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdmFs\naWRhdGVQYXJhbWV0ZXJWYWx1ZShPYmplY3Qga2V5LCBPYmplY3QgdmFsdWUs\nIAogICAgICAgICAgICBDbGFzcyBleHBlY3RlZCkgewogICAgICAgICAgICBp\nZiAoZXhwZWN0ZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQuaXNQcmltaXRpdmUoKSkg\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm51bGwtcHJpbWl0aXZlLXBhcmFtIiwgCiAgICAgICAgICAg\nICAgICAgICAgICAgIGtleSwgZXhwZWN0ZWQpKTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzIGFjdHVhbCA9IHZhbHVlLmdl\ndENsYXNzKCk7CiAgICAgICAgICAgICAgICBib29sZWFuIHN0cmljdCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICBpZiAoIUZpbHRlcnMuY2FuQ29udmVydChh\nY3R1YWwsIGV4cGVjdGVkLCBzdHJpY3QpKSAKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicGFyYW0tdmFs\ndWUtbWlzbWF0Y2giLCAKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtde2tleSwgZXhwZWN0ZWQsIHZhbHVlLCBhY3R1YWx9KSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIGZp\nbmFsIE1hcCBnZXRVcGRhdGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gYXNzZXJ0UXVlcnlFeHByZXNzaW9uKCkudXBkYXRlczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBmaW5hbCBDbGFzc01ldGFEYXRhW10g\nZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAg\nICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMgPSBnZXRRdWVyeUV4cHJl\nc3Npb25zKCk7CiAgICAgICAgICAgIGlmIChleHBzLmxlbmd0aCA9PSAxKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGV4cHNbMF0uYWNjZXNzUGF0aDsKCiAg\nICAgICAgICAgIExpc3Q8Q2xhc3NNZXRhRGF0YT4gbWV0YXMgPSBudWxsOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICBtZXRhcyA9IEZpbHRlcnMuYWRkQWNjZXNz\nUGF0aE1ldGFEYXRhcyhtZXRhcywKICAgICAgICAgICAgICAgICAgICBleHBz\nW2ldLmFjY2Vzc1BhdGgpOwogICAgICAgICAgICBpZiAobWV0YXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX01F\nVEFTOwogICAgICAgICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgbWV0\nYXMudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBDbGFzc01ldGFEYXRh\nW21ldGFzLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gaXNQYWNraW5nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBUaHJvd3MgYW4gZXhjZXB0aW9uIGlmIHNlbGVjdCBvciBoYXZpbmcgY2xh\ndXNlcyBjb250YWluIAogICAgICAgICAqIG5vbi1hZ2dyZWdhdGUsIG5vbi1n\ncm91cGVkIHBhdGhzLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIFZhbGlkYXRlR3JvdXBpbmdFeHByZXNzaW9uVmlzaXRvciAK\nICAgICAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25WaXNpdG9y\nIHsKCiAgICAgICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlDb250ZXh0IF9j\ndHg7CiAgICAgICAgICAgIHByaXZhdGUgYm9vbGVhbiBfZ3JvdXBpbmcgPSBm\nYWxzZTsKICAgICAgICAgICAgcHJpdmF0ZSBTZXQgX2dyb3VwZWQgPSBudWxs\nOwogICAgICAgICAgICBwcml2YXRlIFZhbHVlIF9hZ2cgPSBudWxsOwoKICAg\nICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRocm93IHByb3BlciBleGNl\ncHRpb24gaWYgcXVlcnkgZG9lcyBub3QgbWVldCB2YWxpZGF0aW9uLgogICAg\nICAgICAgICAgKi8KICAgICAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIHZh\nbGlkYXRlKFF1ZXJ5Q29udGV4dCBjdHgsIAogICAgICAgICAgICAgICAgUXVl\ncnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhw\ncy5ncm91cGluZy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICAgICAgVmFsaWRhdGVHcm91cGluZ0V4cHJl\nc3Npb25WaXNpdG9yIHZpc2l0b3IgPSAKICAgICAgICAgICAgICAgICAgICBu\nZXcgVmFsaWRhdGVHcm91cGluZ0V4cHJlc3Npb25WaXNpdG9yKGN0eCk7CiAg\nICAgICAgICAgICAgICB2aXNpdG9yLl9ncm91cGluZyA9IHRydWU7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMuZ3JvdXBpbmcu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZXhwcy5ncm91cGlu\nZ1tpXS5hY2NlcHRWaXNpdCh2aXNpdG9yKTsKICAgICAgICAgICAgICAgIHZp\nc2l0b3IuX2dyb3VwaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAo\nZXhwcy5oYXZpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBleHBz\nLmhhdmluZy5hY2NlcHRWaXNpdCh2aXNpdG9yKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgICAgICBleHBzLnByb2plY3Rpb25zW2ld\nLmFjY2VwdFZpc2l0KHZpc2l0b3IpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgVmFsaWRhdGVHcm91cGluZ0V4cHJlc3Npb25WaXNpdG9y\nKFF1ZXJ5Q29udGV4dCBjdHgpIHsKICAgICAgICAgICAgICAgIF9jdHggPSBj\ndHg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGVu\ndGVyKFZhbHVlIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKF9ncm91cGlu\nZykgewogICAgICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQ\nYXRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZ3JvdXBlZCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dyb3VwZWQg\nPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICBfZ3Jv\ndXBlZC5hZGQodmFsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKF9hZ2cgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGlmICh2YWwuaXNBZ2dyZWdhdGUoKSkgCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9hZ2cgPSB2YWw7CiAgICAgICAgICAgICAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgUGF0aCAKICAgICAgICAgICAgICAg\nICAgICAgICAgJiYgKF9ncm91cGVkID09IG51bGwgfHwgIV9ncm91cGVkLmNv\nbnRhaW5zKHZhbCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZ3JvdXBpbmciLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgX2N0eC5nZXRDYW5kaWRhdGVU\neXBlKCksIF9jdHguZ2V0UXVlcnlTdHJpbmcoKSkpOyAKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIGV4aXQoVmFsdWUgdmFsKSB7CiAgICAg\nICAgICAgICAgICBpZiAodmFsID09IF9hZ2cpCiAgICAgICAgICAgICAgICAg\nICAgX2FnZyA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSdW5zIHRoZSBleHByZXNzaW9uIHF1ZXJ5IGlu\nIG1lbW9yeS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgSW5N\nZW1vcnlFeGVjdXRvcgogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNz\naW9uRXhlY3V0b3IKICAgICAgICBpbXBsZW1lbnRzIEV4ZWN1dG9yLCBTZXJp\nYWxpemFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIENsYXNzTWV0YURh\ndGEgX21ldGE7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9zdWJz\nOwogICAgICAgIHByaXZhdGUgZmluYWwgSW5NZW1vcnlFeHByZXNzaW9uRmFj\ndG9yeSBfZmFjdG9yeTsKICAgICAgICBwcml2YXRlIGZpbmFsIFF1ZXJ5RXhw\ncmVzc2lvbnNbXSBfZXhwczsKICAgICAgICBwcml2YXRlIGZpbmFsIENsYXNz\nW10gX3Byb2pUeXBlczsKCiAgICAgICAgcHVibGljIEluTWVtb3J5RXhlY3V0\nb3IoRXhwcmVzc2lvblN0b3JlUXVlcnkgcSwKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjYW5kaWRhdGUsIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAg\nICAgICAgRXhwcmVzc2lvblBhcnNlciBwYXJzZXIsIE9iamVjdCBwYXJzZWQp\nIHsKICAgICAgICAgICAgX21ldGEgPSBjYW5kaWRhdGU7CiAgICAgICAgICAg\nIF9zdWJzID0gc3ViY2xhc3NlczsKICAgICAgICAgICAgX2ZhY3RvcnkgPSBu\nZXcgSW5NZW1vcnlFeHByZXNzaW9uRmFjdG9yeSgpOwoKICAgICAgICAgICAg\nX2V4cHMgPSBuZXcgUXVlcnlFeHByZXNzaW9uc1tdIHsKICAgICAgICAgICAg\nICAgIHBhcnNlci5ldmFsKHBhcnNlZCwgcSwgX2ZhY3RvcnksIF9tZXRhKQog\nICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoX2V4cHNbMF0ucHJvamVj\ndGlvbnMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBfcHJvalR5cGVz\nID0gU3RvcmVRdWVyeS5FTVBUWV9DTEFTU0VTOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIEFzc2VydE5vVmFyaWFibGVzRXhwcmVzc2lv\nblZpc2l0b3Igbm92YXJzID0gbmV3CiAgICAgICAgICAgICAgICAgICAgQXNz\nZXJ0Tm9WYXJpYWJsZXNFeHByZXNzaW9uVmlzaXRvcihxLmdldENvbnRleHQo\nKSk7CiAgICAgICAgICAgICAgICBfcHJvalR5cGVzID0gbmV3IENsYXNzW19l\neHBzWzBdLnByb2plY3Rpb25zLmxlbmd0aF07CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IF9leHBzWzBdLnByb2plY3Rpb25zLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgX3Byb2pUeXBlc1tpXSA9\nIF9leHBzWzBdLnByb2plY3Rpb25zW2ldLmdldFR5cGUoKTsKICAgICAgICAg\nICAgICAgICAgICBhc3NlcnROb3RDb250YWluZXIoX2V4cHNbMF0ucHJvamVj\ndGlvbnNbaV0sIHEpOwogICAgICAgICAgICAgICAgICAgIF9leHBzWzBdLnBy\nb2plY3Rpb25zW2ldLmFjY2VwdFZpc2l0KG5vdmFycyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9l\neHBzWzBdLmdyb3VwaW5nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\nICAgIF9leHBzWzBdLmdyb3VwaW5nW2ldLmFjY2VwdFZpc2l0KG5vdmFycyk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBRdWVy\neUV4cHJlc3Npb25zW10gZ2V0UXVlcnlFeHByZXNzaW9ucygpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9leHBzOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVRdWVyeShTdG9yZVF1ZXJ5\nIHEsCiAgICAgICAgICAgIE9iamVjdFtdIHBhcmFtcywgUmFuZ2UgcmFuZ2Up\nIHsKICAgICAgICAgICAgLy8gZXhlY3V0ZSBpbiBtZW1vcnkgZm9yIGNhbmRp\nZGF0ZSBjb2xsZWN0aW9uOwogICAgICAgICAgICAvLyBhbHNvIGV4ZWN1dGUg\naW4gbWVtb3J5IGZvciB0cmFuc2FjdGlvbmFsIGV4dGVudHMKICAgICAgICAg\nICAgQ29sbGVjdGlvbiBjb2xsID0gcS5nZXRDb250ZXh0KCkuZ2V0Q2FuZGlk\nYXRlQ29sbGVjdGlvbigpOwogICAgICAgICAgICBJdGVyYXRvciBpdHI7CiAg\nICAgICAgICAgIGlmIChjb2xsICE9IG51bGwpCiAgICAgICAgICAgICAgICBp\ndHIgPSBjb2xsLml0ZXJhdG9yKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGl0ciA9IHEuZ2V0Q29udGV4dCgpLmdldFN0b3JlQ29udGV4\ndCgpLgogICAgICAgICAgICAgICAgICAgIGV4dGVudEl0ZXJhdG9yKF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwgX3N1YnMsCiAgICAgICAgICAgICAgICAg\nICAgICAgIHEuZ2V0Q29udGV4dCgpLmdldEZldGNoQ29uZmlndXJhdGlvbigp\nLAogICAgICAgICAgICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRJ\nZ25vcmVDaGFuZ2VzKCkpOwoKICAgICAgICAgICAgLy8gZmluZCBtYXRjaGlu\nZyBvYmplY3RzCiAgICAgICAgICAgIExpc3QgcmVzdWx0cyA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHEuZ2V0\nQ29udGV4dCgpLmdldFN0b3JlQ29udGV4dCgpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgICAg\nIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2Zh\nY3RvcnkubWF0Y2hlcyhfZXhwc1swXSwgX21ldGEsIF9zdWJzLCBvYmosIGN0\neCwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmVzdWx0cy5hZGQob2JqKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIEltcGxIZWxwZXIuY2xvc2UoaXRyKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gZ3JvdXAgcmVzdWx0cwogICAgICAgICAg\nICByZXN1bHRzID0gX2ZhY3RvcnkuZ3JvdXAoX2V4cHNbMF0sIHJlc3VsdHMs\nIGN0eCwgcGFyYW1zKTsKCiAgICAgICAgICAgIC8vIGFwcGx5IGhhdmluZyB0\nbyBmaWx0ZXIgZ3JvdXBzCiAgICAgICAgICAgIGlmIChfZXhwc1swXS5oYXZp\nbmcgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgTGlzdCBtYXRjaGVzID0g\nbmV3IEFycmF5TGlzdChyZXN1bHRzLnNpemUoKSk7CiAgICAgICAgICAgICAg\nICBDb2xsZWN0aW9uIGM7CiAgICAgICAgICAgICAgICBpdHIgPSByZXN1bHRz\nLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoaXRyLmhhc05l\neHQoKSkgewogICAgICAgICAgICAgICAgICAgIGMgPSAoQ29sbGVjdGlvbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2ZhY3Rvcnku\nbWF0Y2hlcyhfZXhwc1swXSwgYywgY3R4LCBwYXJhbXMpKQogICAgICAgICAg\nICAgICAgICAgICAgICBtYXRjaGVzLmFkZChjKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBtYXRjaGVzOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBhcHBseSBwcm9qZWN0aW9ucywgb3Jk\nZXIgcmVzdWx0cywgYW5kIGZpbHRlciBkdXBsaWNhdGVzCiAgICAgICAgICAg\nIHJlc3VsdHMgPSBfZmFjdG9yeS5wcm9qZWN0KF9leHBzWzBdLCByZXN1bHRz\nLCBjdHgsIHBhcmFtcyk7CiAgICAgICAgICAgIHJlc3VsdHMgPSBfZmFjdG9y\neS5vcmRlcihfZXhwc1swXSwgcmVzdWx0cywgY3R4LCBwYXJhbXMpOwogICAg\nICAgICAgICByZXN1bHRzID0gX2ZhY3RvcnkuZGlzdGluY3QoX2V4cHNbMF0s\nIGNvbGwgPT0gbnVsbCwgcmVzdWx0cyk7CgogICAgICAgICAgICBSZXN1bHRP\nYmplY3RQcm92aWRlciByb3AgPSBuZXcgTGlzdFJlc3VsdE9iamVjdFByb3Zp\nZGVyKHJlc3VsdHMpOwogICAgICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0g\nMCB8fCByYW5nZS5lbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAg\nICAgICByb3AgPSBuZXcgUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcihyb3As\nIHJhbmdlLnN0YXJ0LHJhbmdlLmVuZCk7CiAgICAgICAgICAgIHJldHVybiBy\nb3A7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0\nYVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywK\nICAgICAgICAgICAgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgLy8gaW4g\nbWVtb3J5IHF1ZXJpZXMgaGF2ZSBubyBkYXRhc3RvcmUgYWN0aW9ucyB0byBw\nZXJmb3JtCiAgICAgICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX1NU\nUklOR1M7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldE9y\nZGVyaW5nVmFsdWUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMsCiAg\nICAgICAgICAgIE9iamVjdCByZXN1bHRPYmplY3QsIGludCBvcmRlckluZGV4\nKSB7CiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBwcm9qZWN0aW9uLCB0\naGVuIHdlIGhhdmUgdG8gb3JkZXIgb24gc29tZXRoaW5nCiAgICAgICAgICAg\nIC8vIHdlIHNlbGVjdGVkCiAgICAgICAgICAgIGlmIChfZXhwc1swXS5wcm9q\nZWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcg\nb3JkZXJpbmcgPSBfZXhwc1swXS5vcmRlcmluZ0NsYXVzZXNbb3JkZXJJbmRl\neF07CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leHBz\nWzBdLnByb2plY3Rpb25DbGF1c2VzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgICAgIGlmIChvcmRlcmluZy5lcXVhbHMoX2V4cHNbMF0ucHJvamVj\ndGlvbkNsYXVzZXNbaV0pKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gKChPYmplY3RbXSkgcmVzdWx0T2JqZWN0KVtpXTsKCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAgICAgKCJtZXJnZWQtb3JkZXItd2l0aC1yZXN1\nbHQiLCBxLmdldENvbnRleHQoKS5nZXRMYW5ndWFnZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRRdWVyeVN0cmluZygp\nLCBvcmRlcmluZykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB1\nc2UgdGhlIHBhcnNlZCBvcmRlcmluZyBleHByZXNzaW9uIHRvIGV4dHJhY3Qg\ndGhlIG9yZGVyaW5nIHZhbHVlCiAgICAgICAgICAgIFZhbCB2YWwgPSAoVmFs\nKSBfZXhwc1swXS5vcmRlcmluZ1tvcmRlckluZGV4XTsKICAgICAgICAgICAg\ncmV0dXJuIHZhbC5ldmFsdWF0ZShyZXN1bHRPYmplY3QsIHJlc3VsdE9iamVj\ndCwgcS5nZXRDb250ZXh0KCkuCiAgICAgICAgICAgICAgICBnZXRTdG9yZUNv\nbnRleHQoKSwgcGFyYW1zKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBD\nbGFzc1tdIGdldFByb2plY3Rpb25UeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9wcm9qVHlwZXM7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBUaHJvd3MgYW4gZXhjZXB0aW9uIGlmIGEgdmFy\naWFibGUgaXMgZm91bmQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgQXNzZXJ0Tm9WYXJpYWJsZXNFeHByZXNzaW9uVmlzaXRv\nciAKICAgICAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25WaXNp\ndG9yIHsKCiAgICAgICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlDb250ZXh0\nIF9jdHg7CgogICAgICAgICAgICBwdWJsaWMgQXNzZXJ0Tm9WYXJpYWJsZXNF\neHByZXNzaW9uVmlzaXRvcihRdWVyeUNvbnRleHQgY3R4KSB7CiAgICAgICAg\nICAgICAgICBfY3R4ID0gY3R4OwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBlbnRlcihWYWx1ZSB2YWwpIHsKICAgICAgICAgICAg\nICAgIGlmICghdmFsLmlzVmFyaWFibGUoKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQoImlubWVtLWFnZy1wcm9qLXZhciIsIAog\nICAgICAgICAgICAgICAgICAgIF9jdHguZ2V0Q2FuZGlkYXRlVHlwZSgpLCBf\nY3R4LmdldFF1ZXJ5U3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBEYXRhU3RvcmVFeGVjdXRv\nciBleGVjdXRlcyB0aGUgcXVlcnkgYWdhaW5zdCB0aGUKICAgICAqIGltcGxl\nbWVudGF0aW9uJ3Mgb3ZlcnJpZGRlbiB7QGxpbmsgI2V4ZWN1dGVRdWVyeX0g\nbWV0aG9kLgogICAgICoKICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1l\nYXV4CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRGF0YVN0b3Jl\nRXhlY3V0b3IKICAgICAgICBleHRlbmRzIEFic3RyYWN0RXhwcmVzc2lvbkV4\nZWN1dG9yCiAgICAgICAgaW1wbGVtZW50cyBFeGVjdXRvciwgU2VyaWFsaXph\nYmxlIHsKCiAgICAgICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9tZXRhOwog\nICAgICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtdIF9tZXRhczsKICAgICAg\nICBwcml2YXRlIGJvb2xlYW4gX3N1YnM7CiAgICAgICAgcHJpdmF0ZSBFeHBy\nZXNzaW9uUGFyc2VyIF9wYXJzZXI7CiAgICAgICAgcHJpdmF0ZSBFeHByZXNz\naW9uRmFjdG9yeVtdIF9mYWN0czsKICAgICAgICBwcml2YXRlIFF1ZXJ5RXhw\ncmVzc2lvbnNbXSBfZXhwczsKICAgICAgICBwcml2YXRlIENsYXNzW10gX3By\nb2pUeXBlczsKICAgICAgICBwcml2YXRlIFZhbHVlW10gX2luTWVtT3JkZXJp\nbmc7CgogICAgICAgIHB1YmxpYyBEYXRhU3RvcmVFeGVjdXRvcihFeHByZXNz\naW9uU3RvcmVRdWVyeSBxLAogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEsIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICAgICAgRXhwcmVzc2lv\nblBhcnNlciBwYXJzZXIsIE9iamVjdCBwYXJzZWQpIHsKICAgICAgICAgICAg\nX21ldGFzID0gcS5nZXRJbmRlcGVuZGVudEV4cHJlc3Npb25DYW5kaWRhdGVz\nKG1ldGEsIHN1YmNsYXNzZXMpOwogICAgICAgICAgICBpZiAoX21ldGFzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoInF1ZXJ5LXVubWFwcGVkIiwgbWV0YSkpOwogICAg\nICAgICAgICBfbWV0YSA9IG1ldGE7CiAgICAgICAgICAgIF9zdWJzID0gc3Vi\nY2xhc3NlczsKICAgICAgICAgICAgX3BhcnNlciA9IHBhcnNlcjsKCiAgICAg\nICAgICAgIF9mYWN0cyA9IG5ldyBFeHByZXNzaW9uRmFjdG9yeVtfbWV0YXMu\nbGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZmFj\ndHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBfZmFjdHNbaV0gPSBx\nLmdldEV4cHJlc3Npb25GYWN0b3J5KF9tZXRhc1tpXSk7CgogICAgICAgICAg\nICBfZXhwcyA9IG5ldyBRdWVyeUV4cHJlc3Npb25zW19tZXRhcy5sZW5ndGhd\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leHBzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgX2V4cHNbaV0gPSBwYXJzZXIuZXZh\nbChwYXJzZWQsIHEsIF9mYWN0c1tpXSwgX21ldGFzW2ldKTsKCiAgICAgICAg\nICAgIGlmIChfZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgICAgIF9wcm9qVHlwZXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX0NM\nQVNTRVM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgX3By\nb2pUeXBlcyA9IG5ldyBDbGFzc1tfZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5n\ndGhdOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhw\nc1swXS5wcm9qZWN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgICAgIGFzc2VydE5vdENvbnRhaW5lcihfZXhwc1swXS5wcm9qZWN0aW9u\nc1tpXSwgcSk7CiAgICAgICAgICAgICAgICAgICAgX3Byb2pUeXBlc1tpXSA9\nIF9leHBzWzBdLnByb2plY3Rpb25zW2ldLmdldFR5cGUoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFF1ZXJ5RXhwcmVzc2lvbnNbXSBnZXRRdWVyeUV4cHJlc3Npb25zKCkg\newogICAgICAgICAgICByZXR1cm4gX2V4cHM7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZVF1ZXJ5KFN0\nb3JlUXVlcnkgcSwKICAgICAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBSYW5n\nZSByYW5nZSkgewogICAgICAgICAgICByYW5nZS5scnMgJj0gIWlzQWdncmVn\nYXRlKHEpICYmICFoYXNHcm91cGluZyhxKTsKICAgICAgICAgICAgcmV0dXJu\nICgoRXhwcmVzc2lvblN0b3JlUXVlcnkpIHEpLmV4ZWN1dGVRdWVyeSh0aGlz\nLCBfbWV0YSwgX21ldGFzLAogICAgICAgICAgICAgICAgX3N1YnMsIF9mYWN0\ncywgX2V4cHMsIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE51bWJlciBleGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkgcSwgT2Jq\nZWN0W10gcGFyYW1zKSB7CiAgICAgICAgICAgIE51bWJlciBudW0gPSAoKEV4\ncHJlc3Npb25TdG9yZVF1ZXJ5KSBxKS5leGVjdXRlRGVsZXRlKHRoaXMsIF9t\nZXRhLAogICAgICAgICAgICAgICAgX21ldGFzLCBfc3VicywgX2ZhY3RzLCBf\nZXhwcywgcGFyYW1zKTsKICAgICAgICAgICAgaWYgKG51bSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHEuZ2V0Q29udGV4dCgpLmRlbGV0ZUlu\nTWVtb3J5KHEsIHRoaXMsIHBhcmFtcyk7CiAgICAgICAgICAgIHJldHVybiBu\ndW07CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTnVtYmVyIGV4ZWN1dGVV\ncGRhdGUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICAgICAgTnVtYmVyIG51bSA9ICgoRXhwcmVzc2lvblN0b3JlUXVlcnkpIHEp\nLmV4ZWN1dGVVcGRhdGUodGhpcywgX21ldGEsCiAgICAgICAgICAgICAgICBf\nbWV0YXMsIF9zdWJzLCBfZmFjdHMsIF9leHBzLCBwYXJhbXMpOwogICAgICAg\nICAgICBpZiAobnVtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4g\ncS5nZXRDb250ZXh0KCkudXBkYXRlSW5NZW1vcnkocSwgdGhpcywgcGFyYW1z\nKTsKICAgICAgICAgICAgcmV0dXJuIG51bTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKFN0b3JlUXVl\ncnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBSYW5nZSByYW5n\nZSkgewogICAgICAgICAgICByZXR1cm4gKChFeHByZXNzaW9uU3RvcmVRdWVy\neSkgcSkuZ2V0RGF0YVN0b3JlQWN0aW9ucyhfbWV0YSwKICAgICAgICAgICAg\nICAgIF9tZXRhcywgX3N1YnMsIF9mYWN0cywgX2V4cHMsIHBhcmFtcywgcmFu\nZ2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRl\ncmluZ1ZhbHVlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAg\nICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgb3JkZXJJbmRleCkg\newogICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgcHJvamVjdGlvbiwgdGhl\nbiB3ZSBoYXZlIHRvIG9yZGVyIG9uIHNvbWV0aGluZwogICAgICAgICAgICAv\nLyB3ZSBzZWxlY3RlZAogICAgICAgICAgICBpZiAoX2V4cHNbMF0ucHJvamVj\ndGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgU3RyaW5nIG9y\nZGVyaW5nID0gX2V4cHNbMF0ub3JkZXJpbmdDbGF1c2VzW29yZGVySW5kZXhd\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhwc1sw\nXS5wcm9qZWN0aW9uQ2xhdXNlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgICAgICBpZiAob3JkZXJpbmcuZXF1YWxzKF9leHBzWzBdLnByb2plY3Rp\nb25DbGF1c2VzW2ldKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nICgoT2JqZWN0W10pIHJlc3VsdE9iamVjdClbaV07CgogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICgibWVyZ2VkLW9yZGVyLXdpdGgtcmVzdWx0\nIiwgcS5nZXRDb250ZXh0KCkuZ2V0TGFuZ3VhZ2UoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnlTdHJpbmcoKSwg\nb3JkZXJpbmcpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbmVl\nZCB0byBwYXJzZSBvcmRlcmluZ3M/CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICAgICAgaWYgKF9pbk1lbU9yZGVyaW5n\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBFeHByZXNzaW9uRmFj\ndG9yeSBmYWN0b3J5ID0gbmV3IEluTWVtb3J5RXhwcmVzc2lvbkZhY3Rvcnko\nKTsKICAgICAgICAgICAgICAgICAgICBfaW5NZW1PcmRlcmluZyA9IF9wYXJz\nZXIuZXZhbChfZXhwc1swXS5vcmRlcmluZ0NsYXVzZXMsCiAgICAgICAgICAg\nICAgICAgICAgICAgIChFeHByZXNzaW9uU3RvcmVRdWVyeSkgcSwgZmFjdG9y\neSwgX21ldGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\naWYgKF9pbk1lbU9yZGVyaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgX2luTWVtT3JkZXJpbmcgPSBfZXhwc1swXS5vcmRlcmluZzsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gdXNlIHRoZSBwYXJzZWQgb3JkZXJp\nbmcgZXhwcmVzc2lvbiB0byBleHRyYWN0IHRoZSBvcmRlcmluZyB2YWx1ZQog\nICAgICAgICAgICBWYWwgdmFsID0gKFZhbCkgX2luTWVtT3JkZXJpbmdbb3Jk\nZXJJbmRleF07CiAgICAgICAgICAgIHJldHVybiB2YWwuZXZhbHVhdGUocmVz\ndWx0T2JqZWN0LCByZXN1bHRPYmplY3QsCiAgICAgICAgICAgICAgICBxLmdl\ndENvbnRleHQoKS5nZXRTdG9yZUNvbnRleHQoKSwgcGFyYW1zKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBDbGFzc1tdIGdldFByb2plY3Rpb25UeXBl\ncyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9wcm9qVHlw\nZXM7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

