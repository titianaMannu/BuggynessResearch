{"sha":"657bd57fce64fe560cdf83cd84a6403a5ea2faa7","node_id":"MDQ6QmxvYjIwNjM2NDo2NTdiZDU3ZmNlNjRmZTU2MGNkZjgzY2Q4NGE2NDAzYTVlYTJmYWE3","size":35310,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/657bd57fce64fe560cdf83cd84a6403a5ea2faa7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTWV0aG9kOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5FYWdlclJl\nc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5M\naXN0UmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5TaW1wbGVSZXN1bHRMaXN0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuV2luZG93UmVzdWx0\nTGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2Nh\nbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hH\ncm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlw\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob1RyYW5z\nYWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBBbGxvd3MgY29uZmlndXJhdGlv\nbiBhbmQgb3B0aW1pemF0aW9uIG9mIGhvdyBvYmplY3RzIGFyZSBsb2FkZWQg\nZnJvbQogKiB0aGUgZGF0YSBzdG9yZS4KICoKICogQHNpbmNlIDAuMy4wCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgog\nKiBAbm9qYXZhZG9jCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikK\ncHVibGljIGNsYXNzIEZldGNoQ29uZmlndXJhdGlvbkltcGwKICAgIGltcGxl\nbWVudHMgRmV0Y2hDb25maWd1cmF0aW9uLCBDbG9uZWFibGUgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UoRmV0Y2hDb25maWd1cmF0aW9uSW1wbC5jbGFzcyk7CiAg\nICBwcml2YXRlIHN0YXRpYyBNYXA8U3RyaW5nLCBNZXRob2Q+IF9oaW50U2V0\ndGVycyA9IG5ldyBIYXNoTWFwPFN0cmluZywgTWV0aG9kPigpOwogICAgCiAg\nICAvKiogCiAgICAgKiBSZWdpc3RlcnMgaGludCBrZXlzIHRoYXQgaGF2ZSBh\nIGNvcnJlc3BvbmRpbmcgc2V0dGVyIG1ldGhvZC4KICAgICAqIFRoZSBoaW50\nIGtleXMgYXJlIHJlZ2lzdGVyZWQgaW4gPGNvZGU+b3BlbmpwYS5GZXRjaFBs\nYW48L2NvZGU+IGFuZCA8Y29kZT5vcGVuanBhPC9jb2RlPiBhcyBwcmVmaXgu\nCiAgICAgKiBBbHNvIHNvbWUga2V5cyBhcmUgcmVnaXN0ZXJlZCBpbiA8Y29k\nZT5qYXZheC5wZXJzaXN0ZW5jZTwvY29kZT4gbmFtZXNwYWNlLgogICAgICov\nCiAgICBzdGF0aWMgewogICAgICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9\nIHsib3BlbmpwYS5GZXRjaFBsYW4iLCAib3BlbmpwYSJ9OwogICAgICAgICAg\nICBDbGFzczw/PiB0YXJnZXQgPSBGZXRjaENvbmZpZ3VyYXRpb24uY2xhc3M7\nCiAgICAgICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJFeHRl\nbmRlZFBhdGhMb29rdXAiLCBib29sZWFuLmNsYXNzLCBwcmVmaXhlcyk7CiAg\nICAgICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJGZXRjaEJh\ndGNoU2l6ZSIsIGludC5jbGFzcywgcHJlZml4ZXMpOwogICAgICAgICAgICBw\nb3B1bGF0ZUhpbnRTZXR0ZXIodGFyZ2V0LCAiRmx1c2hCZWZvcmVRdWVyaWVz\nIiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAgICAgICAgIHBvcHVsYXRl\nSGludFNldHRlcih0YXJnZXQsICJMb2NrU2NvcGUiLCBpbnQuY2xhc3MsIHBy\nZWZpeGVzKTsKICAgICAgICAgICAgcG9wdWxhdGVIaW50U2V0dGVyKHRhcmdl\ndCwgIkxvY2tUaW1lb3V0IiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAg\nICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJzZXRMb2NrVGlt\nZW91dCIsICJ0aW1lb3V0IiwgaW50LmNsYXNzLCAiamF2YXgucGVyc2lzdGVu\nY2UubG9jayIpOwogICAgICAgICAgICBwb3B1bGF0ZUhpbnRTZXR0ZXIodGFy\nZ2V0LCAiTWF4RmV0Y2hEZXB0aCIsIGludC5jbGFzcywgcHJlZml4ZXMpOwog\nICAgICAgICAgICBwb3B1bGF0ZUhpbnRTZXR0ZXIodGFyZ2V0LCAiUXVlcnlU\naW1lb3V0IiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAgICAgICAgIHBv\ncHVsYXRlSGludFNldHRlcih0YXJnZXQsICJzZXRRdWVyeVRpbWVvdXQiLCAi\ndGltZW91dCIsIGludC5jbGFzcywgImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5\nIik7CiAgICAgICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJS\nZWFkTG9ja0xldmVsIiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAgICAg\nICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJzZXRSZWFkTG9ja0xl\ndmVsIiwgIlJlYWRMb2NrTW9kZSIsIGludC5jbGFzcywgcHJlZml4ZXMpOwog\nICAgICAgICAgICBwb3B1bGF0ZUhpbnRTZXR0ZXIodGFyZ2V0LCAiV3JpdGVM\nb2NrTGV2ZWwiLCBpbnQuY2xhc3MsIHByZWZpeGVzKTsKICAgICAgICAgICAg\ncG9wdWxhdGVIaW50U2V0dGVyKHRhcmdldCwgInNldFdyaXRlTG9ja0xldmVs\nIiwgIldyaXRlTG9ja01vZGUiLCBpbnQuY2xhc3MsIHByZWZpeGVzKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBQb3B1bGF0ZSBzdGF0aWMgcmVnaXN0\ncnkgb2YgaGludHMuCiAgICAgKiAgCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRo\nZSBuYW1lIG9mIHRoZSB0YXJnZXQgY2xhc3MgdGhhdCB3aWxsIHJlY2VpdmUg\ndGhpcyBoaW50LiAKICAgICAqIEBwYXJhbSBoaW50IHRoZSBzaW1wbGUgbmFt\nZSBvZiB0aGUgaGludCB3aXRob3V0IGEgcHJlZml4LiAKICAgICAqIEBwYXJh\nbSB0eXBlIHRoZSB2YWx1ZSBhcmd1bWVudCB0eXBlIG9mIHRoZSB0YXJnZXQg\nc2V0dGVyIG1ldGhvZC4gCiAgICAgKiBAcGFyYW0gcHJlZml4ZXMgdGhlIHBy\nZWZpeGVzIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHNpbXBsZSBoaW50IG5hbWUu\nIAogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIHZvaWQgcG9wdWxhdGVI\naW50U2V0dGVyKENsYXNzPD8+IHRhcmdldCwgU3RyaW5nIGhpbnQsIENsYXNz\nPD8+IHR5cGUsIFN0cmluZy4uLnByZWZpeGVzKSB7CiAgICAgICAgcG9wdWxh\ndGVIaW50U2V0dGVyKHRhcmdldCwgInNldCIgKyBoaW50LCBoaW50LCB0eXBl\nLCBwcmVmaXhlcyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUG9wdWxh\ndGUgc3RhdGljIHJlZ2lzdHJ5IG9mIGhpbnRzLgogICAgICogIAogICAgICog\nQHBhcmFtIHRhcmdldCBUaGUgbmFtZSBvZiB0aGUgdGFyZ2V0IGNsYXNzIHRo\nYXQgd2lsbCByZWNlaXZlIHRoaXMgaGludC4gCiAgICAgKiBAcGFyYW0gbWV0\naG9kIFRoZSBuYW1lIG9mIHRoZSBtZXRob2QgaW4gdGhlIHRhcmdldCBjbGFz\ncyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGlzIGhpbnQuIAogICAgICogQHBhcmFt\nIGhpbnQgdGhlIHNpbXBsZSBuYW1lIG9mIHRoZSBoaW50IHdpdGhvdXQgYSBw\ncmVmaXguIAogICAgICogQHBhcmFtIHR5cGUgdGhlIHZhbHVlIGFyZ3VtZW50\nIHR5cGUgb2YgdGhlIHRhcmdldCBzZXR0ZXIgbWV0aG9kLiAKICAgICAqIEBw\nYXJhbSBwcmVmaXhlcyB0aGUgcHJlZml4ZXMgd2lsbCBiZSBhZGRlZCB0byB0\naGUgc2ltcGxlIGhpbnQgbmFtZS4gCiAgICAgKi8KICAgIHByb3RlY3RlZCBz\ndGF0aWMgdm9pZCBwb3B1bGF0ZUhpbnRTZXR0ZXIoQ2xhc3M8Pz4gdGFyZ2V0\nLCBTdHJpbmcgbWV0aG9kLCBTdHJpbmcgaGludCwgQ2xhc3M8Pz4gdHlwZSwg\nCiAgICAgICAgICAgIFN0cmluZy4uLnByZWZpeGVzKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgTWV0aG9kIHNldHRlciA9IHRhcmdldC5nZXRNZXRo\nb2QobWV0aG9kLCB0eXBlKTsKICAgICAgICAgICAgZm9yIChTdHJpbmcgcHJl\nZml4IDogcHJlZml4ZXMpIHsKICAgICAgICAgICAgICAgIF9oaW50U2V0dGVy\ncy5wdXQocHJlZml4ICsgIi4iICsgaGludCwgc2V0dGVyKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIC8vIHNob3VsZCBub3QgcmVhY2gKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCJzZXR0ZXIgZm9yICIgKyBoaW50ICsgIiB3\naXRoIGFyZ3VtZW50ICIgKyB0eXBlICsgIiBkb2VzIG5vdCBleGlzdCIpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyYWJsZSBz\ndGF0ZSBzaGFyZWQgdGhyb3VnaG91dCBhIHRyYXZlcnNhbCBjaGFpbi4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBDb25maWd1cmF0aW9u\nU3RhdGUKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZQogICAgewog\nICAgICAgIHB1YmxpYyB0cmFuc2llbnQgU3RvcmVDb250ZXh0IGN0eCA9IG51\nbGw7CiAgICAgICAgcHVibGljIGludCBmZXRjaEJhdGNoU2l6ZSA9IDA7CiAg\nICAgICAgcHVibGljIGludCBtYXhGZXRjaERlcHRoID0gMTsKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBxdWVyeUNhY2hlID0gdHJ1ZTsKICAgICAgICBwdWJs\naWMgaW50IGZsdXNoUXVlcnkgPSAwOwogICAgICAgIHB1YmxpYyBpbnQgbG9j\na1RpbWVvdXQgPSAtMTsKICAgICAgICBwdWJsaWMgaW50IHF1ZXJ5VGltZW91\ndCA9IC0xOwogICAgICAgIHB1YmxpYyBpbnQgbG9ja1Njb3BlID0gTE9DS1ND\nT1BFX05PUk1BTDsKICAgICAgICBwdWJsaWMgaW50IHJlYWRMb2NrTGV2ZWwg\nPSBMT0NLX05PTkU7CiAgICAgICAgcHVibGljIGludCB3cml0ZUxvY2tMZXZl\nbCA9IExPQ0tfTk9ORTsKICAgICAgICBwdWJsaWMgU2V0PFN0cmluZz4gZmV0\nY2hHcm91cHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBm\naWVsZHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBTZXQ8Q2xhc3M8Pz4+IHJv\nb3RDbGFzc2VzOwogICAgICAgIHB1YmxpYyBTZXQ8T2JqZWN0PiByb290SW5z\ndGFuY2VzOwogICAgICAgIHB1YmxpYyBNYXA8U3RyaW5nLE9iamVjdD4gaGlu\ndHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGZldGNoR3JvdXBD\nb250YWluc0RlZmF1bHQgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBmZXRjaEdyb3VwQ29udGFpbnNBbGwgPSBmYWxzZTsKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBleHRlbmRlZFBhdGhMb29rdXAgPSBmYWxzZTsKICAgICAg\nICBwdWJsaWMgRGF0YUNhY2hlUmV0cmlldmVNb2RlIGNhY2hlUmV0cmlldmVN\nb2RlOwogICAgICAgIHB1YmxpYyBEYXRhQ2FjaGVTdG9yZU1vZGUgY2FjaGVT\ndG9yZU1vZGU7ICAgICAgICAKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIENv\nbmZpZ3VyYXRpb25TdGF0ZSBfc3RhdGU7CiAgICBwcml2YXRlIEZldGNoQ29u\nZmlndXJhdGlvbkltcGwgX3BhcmVudDsKICAgIHByaXZhdGUgU3RyaW5nIF9m\ncm9tRmllbGQ7CiAgICBwcml2YXRlIENsYXNzPD8+IF9mcm9tVHlwZTsKICAg\nIHByaXZhdGUgU3RyaW5nIF9kaXJlY3RSZWxhdGlvbk93bmVyOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9sb2FkID0gdHJ1ZTsKICAgIHByaXZhdGUgaW50IF9h\ndmFpbGFibGVSZWN1cnNpb247CiAgICBwcml2YXRlIGludCBfYXZhaWxhYmxl\nRGVwdGg7CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbkltcGwoKSB7\nCiAgICAgICAgdGhpcyhudWxsKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmV0\nY2hDb25maWd1cmF0aW9uSW1wbChDb25maWd1cmF0aW9uU3RhdGUgc3RhdGUp\nIHsKICAgICAgICBfc3RhdGUgPSAoc3RhdGUgPT0gbnVsbCkgPyBuZXcgQ29u\nZmlndXJhdGlvblN0YXRlKCkgOiBzdGF0ZTsKICAgICAgICBfYXZhaWxhYmxl\nRGVwdGggPSBfc3RhdGUubWF4RmV0Y2hEZXB0aDsKICAgIH0gCgogICAgcHVi\nbGljIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUuY3R4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbnRl\neHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIC8vIGNhbid0IHJlc2V0\nIG5vbi1udWxsIGNvbnRleHQgdG8gYW5vdGhlciBjb250ZXh0CiAgICAgICAg\naWYgKGN0eCAhPSBudWxsICYmIF9zdGF0ZS5jdHggIT0gbnVsbCAmJiBjdHgg\nIT0gX3N0YXRlLmN0eCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICAgICAgX3N0YXRlLmN0eCA9IGN0eDsKICAgICAg\nICBpZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gaW5pdGlhbGl6ZSB0byBjb25mIGluZm8KICAgICAgICBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mID0gY3R4LmdldENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBzZXRGZXRjaEJhdGNoU2l6ZShjb25mLmdldEZldGNoQmF0Y2hT\naXplKCkpOwogICAgICAgIHNldEZsdXNoQmVmb3JlUXVlcmllcyhjb25mLmdl\ndEZsdXNoQmVmb3JlUXVlcmllc0NvbnN0YW50KCkpOwogICAgICAgIHNldExv\nY2tUaW1lb3V0KGNvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgc2V0\nUXVlcnlUaW1lb3V0KGNvbmYuZ2V0UXVlcnlUaW1lb3V0KCkpOwogICAgICAg\nIGNsZWFyRmV0Y2hHcm91cHMoKTsKICAgICAgICBhZGRGZXRjaEdyb3VwcyhB\ncnJheXMuYXNMaXN0KGNvbmYuZ2V0RmV0Y2hHcm91cHNMaXN0KCkpKTsKICAg\nICAgICBzZXRNYXhGZXRjaERlcHRoKGNvbmYuZ2V0TWF4RmV0Y2hEZXB0aCgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb25lIHRoaXMgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7CiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uSW1wbCBjbG9uZSA9IG5ld0luc3RhbmNlKG51\nbGwpOwogICAgICAgIGNsb25lLl9zdGF0ZS5jdHggPSBfc3RhdGUuY3R4Owog\nICAgICAgIGNsb25lLl9wYXJlbnQgPSBfcGFyZW50OwogICAgICAgIGNsb25l\nLl9mcm9tRmllbGQgPSBfZnJvbUZpZWxkOwogICAgICAgIGNsb25lLl9mcm9t\nVHlwZSA9IF9mcm9tVHlwZTsKICAgICAgICBjbG9uZS5fZGlyZWN0UmVsYXRp\nb25Pd25lciA9IF9kaXJlY3RSZWxhdGlvbk93bmVyOwogICAgICAgIGNsb25l\nLl9sb2FkID0gX2xvYWQ7CiAgICAgICAgY2xvbmUuX2F2YWlsYWJsZVJlY3Vy\nc2lvbiA9IF9hdmFpbGFibGVSZWN1cnNpb247CiAgICAgICAgY2xvbmUuX2F2\nYWlsYWJsZURlcHRoID0gX2F2YWlsYWJsZURlcHRoOwogICAgICAgIGNsb25l\nLmNvcHkodGhpcyk7CiAgICAgICAgcmV0dXJuIGNsb25lOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgbmV3IGhvbGxvdyBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIEZldGNoQ29uZmlndXJhdGlvbkltcGwgbmV3\nSW5zdGFuY2UoQ29uZmlndXJhdGlvblN0YXRlIHN0YXRlKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBGZXRjaENvbmZpZ3VyYXRpb25JbXBsKHN0YXRlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBjb3B5KEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIHNldEZldGNoQmF0Y2hTaXplKGZldGNoLmdldEZl\ndGNoQmF0Y2hTaXplKCkpOwogICAgICAgIHNldE1heEZldGNoRGVwdGgoZmV0\nY2guZ2V0TWF4RmV0Y2hEZXB0aCgpKTsKICAgICAgICBzZXRRdWVyeUNhY2hl\nRW5hYmxlZChmZXRjaC5nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKTsKICAgICAg\nICBzZXRGbHVzaEJlZm9yZVF1ZXJpZXMoZmV0Y2guZ2V0Rmx1c2hCZWZvcmVR\ndWVyaWVzKCkpOwogICAgICAgIHNldEV4dGVuZGVkUGF0aExvb2t1cChmZXRj\naC5nZXRFeHRlbmRlZFBhdGhMb29rdXAoKSk7CiAgICAgICAgc2V0TG9ja1Rp\nbWVvdXQoZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgc2V0UXVl\ncnlUaW1lb3V0KGZldGNoLmdldFF1ZXJ5VGltZW91dCgpKTsKICAgICAgICBz\nZXRMb2NrU2NvcGUoZmV0Y2guZ2V0TG9ja1Njb3BlKCkpOwogICAgICAgIGNs\nZWFyRmV0Y2hHcm91cHMoKTsKICAgICAgICBhZGRGZXRjaEdyb3VwcyhmZXRj\naC5nZXRGZXRjaEdyb3VwcygpKTsKICAgICAgICBjbGVhckZpZWxkcygpOwog\nICAgICAgIGNvcHlIaW50cyhmZXRjaCk7CiAgICAgICAgYWRkRmllbGRzKGZl\ndGNoLmdldEZpZWxkcygpKTsKCiAgICAgICAgLy8gZG9uJ3QgdXNlIHNldHRl\ncnMgYmVjYXVzZSByZXF1aXJlIGFjdGl2ZSB0cmFuc2FjdGlvbgogICAgICAg\nIF9zdGF0ZS5yZWFkTG9ja0xldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZl\nbCgpOwogICAgICAgIF9zdGF0ZS53cml0ZUxvY2tMZXZlbCA9IGZldGNoLmdl\ndFdyaXRlTG9ja0xldmVsKCk7CiAgICB9CgogICAgCiAgICB2b2lkIGNvcHlI\naW50cyhGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAo\nZmV0Y2ggaW5zdGFuY2VvZiBGZXRjaENvbmZpZ3VyYXRpb25JbXBsID09IGZh\nbHNlKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgRmV0Y2hDb25maWd1\ncmF0aW9uSW1wbCBmcm9tID0gKEZldGNoQ29uZmlndXJhdGlvbkltcGwpZmV0\nY2g7CiAgICAgICAgaWYgKGZyb20uX3N0YXRlID09IG51bGwgfHwgZnJvbS5f\nc3RhdGUuaGludHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGlmICh0aGlzLl9zdGF0ZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmhpbnRzID09IG51bGwpCiAg\nICAgICAgICAgIHRoaXMuX3N0YXRlLmhpbnRzID0gbmV3IEhhc2hNYXA8U3Ry\naW5nLE9iamVjdD4oKTsKICAgICAgICB0aGlzLl9zdGF0ZS5oaW50cy5wdXRB\nbGwoZnJvbS5fc3RhdGUuaGludHMpOwogICAgfQogICAgCiAgICBwdWJsaWMg\naW50IGdldEZldGNoQmF0Y2hTaXplKCkgewogICAgICAgIHJldHVybiBfc3Rh\ndGUuZmV0Y2hCYXRjaFNpemU7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29u\nZmlndXJhdGlvbiBzZXRGZXRjaEJhdGNoU2l6ZShpbnQgZmV0Y2hCYXRjaFNp\nemUpIHsKICAgICAgICBpZiAoZmV0Y2hCYXRjaFNpemUgPT0gREVGQVVMVCAm\nJiBfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIGZldGNoQmF0Y2hT\naXplID0gX3N0YXRlLmN0eC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RmV0Y2hC\nYXRjaFNpemUoKTsKICAgICAgICBpZiAoZmV0Y2hCYXRjaFNpemUgIT0gREVG\nQVVMVCkKICAgICAgICAgICAgX3N0YXRlLmZldGNoQmF0Y2hTaXplID0gZmV0\nY2hCYXRjaFNpemU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRNYXhGZXRjaERlcHRoKCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUubWF4RmV0Y2hEZXB0aDsKICAgIH0KCiAgICBwdWJsaWMgRmV0\nY2hDb25maWd1cmF0aW9uIHNldE1heEZldGNoRGVwdGgoaW50IGRlcHRoKSB7\nCiAgICAgICAgaWYgKGRlcHRoID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAh\nPSBudWxsKQogICAgICAgICAgICBkZXB0aCA9IF9zdGF0ZS5jdHguZ2V0Q29u\nZmlndXJhdGlvbigpLmdldE1heEZldGNoRGVwdGgoKTsKICAgICAgICBpZiAo\nZGVwdGggIT0gREVGQVVMVCkKICAgICAgICB7CiAgICAgICAgICAgIF9zdGF0\nZS5tYXhGZXRjaERlcHRoID0gZGVwdGg7CiAgICAgICAgICAgIGlmIChfcGFy\nZW50ID09IG51bGwpCiAgICAgICAgICAgICAgICBfYXZhaWxhYmxlRGVwdGgg\nPSBkZXB0aDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gZ2V0UXVlcnlDYWNoZUVuYWJsZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9zdGF0ZS5xdWVyeUNhY2hlOwogICAgfQoKICAg\nIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0UXVlcnlDYWNoZUVuYWJs\nZWQoYm9vbGVhbiBjYWNoZSkgewogICAgICAgIF9zdGF0ZS5xdWVyeUNhY2hl\nID0gY2FjaGU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVi\nbGljIGludCBnZXRGbHVzaEJlZm9yZVF1ZXJpZXMoKSB7CiAgICAgICAgcmV0\ndXJuIF9zdGF0ZS5mbHVzaFF1ZXJ5OwogICAgfQogICAgCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRFeHRlbmRlZFBhdGhMb29rdXAoKSB7CiAgICAgICAgcmV0\ndXJuIF9zdGF0ZS5leHRlbmRlZFBhdGhMb29rdXA7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0RXh0ZW5kZWRQYXRoTG9v\na3VwKGJvb2xlYW4gZmxhZykgewogICAgICAgIF9zdGF0ZS5leHRlbmRlZFBh\ndGhMb29rdXAgPSBmbGFnOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0Rmx1c2hCZWZvcmVR\ndWVyaWVzKGludCBmbHVzaCkgewogICAgICAgIGlmIChmbHVzaCAhPSBERUZB\nVUxUCiAgICAgICAgICAgICYmIGZsdXNoICE9IFF1ZXJ5Rmx1c2hNb2Rlcy5G\nTFVTSF9UUlVFCiAgICAgICAgICAgICYmIGZsdXNoICE9IFF1ZXJ5Rmx1c2hN\nb2Rlcy5GTFVTSF9GQUxTRQogICAgICAgICAgICAmJiBmbHVzaCAhPSBRdWVy\neUZsdXNoTW9kZXMuRkxVU0hfV0lUSF9DT05ORUNUSU9OKQogICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0\nKAogICAgICAgICAgICAgICAgImJhZC1mbHVzaC1iZWZvcmUtcXVlcmllcyIs\nIG5ldyBJbnRlZ2VyKGZsdXNoKSkuZ2V0TWVzc2FnZSgpKTsKCiAgICAgICAg\naWYgKGZsdXNoID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAhPSBudWxsKQog\nICAgICAgICAgICBfc3RhdGUuZmx1c2hRdWVyeSA9IF9zdGF0ZS5jdHguZ2V0\nQ29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAgZ2V0Rmx1c2hCZWZv\ncmVRdWVyaWVzQ29uc3RhbnQoKTsKICAgICAgICBlbHNlIGlmIChmbHVzaCAh\nPSBERUZBVUxUKQogICAgICAgICAgICBfc3RhdGUuZmx1c2hRdWVyeSA9IGZs\ndXNoOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBT\nZXQ8U3RyaW5nPiBnZXRGZXRjaEdyb3VwcygpIHsKICAgICAgICBpZiAoX3N0\nYXRlLmZldGNoR3JvdXBzID09IG51bGwpIHJldHVybiBDb2xsZWN0aW9ucy5l\nbXB0eVNldCgpOwogICAgICAgIHJldHVybiBfc3RhdGUuZmV0Y2hHcm91cHM7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzRmV0Y2hHcm91cChTdHJp\nbmcgZ3JvdXApIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmZldGNoR3JvdXBz\nICE9IG51bGwKICAgICAgICAgICAgJiYgKF9zdGF0ZS5mZXRjaEdyb3Vwcy5j\nb250YWlucyhncm91cCkKICAgICAgICAgICAgfHwgX3N0YXRlLmZldGNoR3Jv\ndXBzLmNvbnRhaW5zKEZldGNoR3JvdXAuTkFNRV9BTEwpKTsKICAgIH0KCiAg\nICAgcHVibGljIGJvb2xlYW4gaGFzRmV0Y2hHcm91cERlZmF1bHQoKSB7CiAg\nICAgICAgIC8vIEZldGNoIGdyb3VwIEFsbCBpbmNsdWRlcyBmZXRjaCBncm91\ncCBEZWZhdWx0IGJ5IGRlZmluaXRpb24KICAgICAgICAgcmV0dXJuIF9zdGF0\nZS5mZXRjaEdyb3VwQ29udGFpbnNEZWZhdWx0IHx8IAogICAgICAgICAgICAg\nX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0FsbDsKICAgICB9CiAgICAgCiAg\nICAgcHVibGljIGJvb2xlYW4gaGFzRmV0Y2hHcm91cEFsbCgpIHsKICAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5mZXRjaEdyb3VwQ29udGFpbnNBbGw7CiAgICAg\nfQogICAgIAogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBhZGRGZXRj\naEdyb3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWZnIikpOwoKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5mZXRjaEdy\nb3VwcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3Jv\ndXBzID0gbmV3IEhhc2hTZXQ8U3RyaW5nPigpOwogICAgICAgICAgICBfc3Rh\ndGUuZmV0Y2hHcm91cHMuYWRkKG5hbWUpOwogICAgICAgICAgICBpZiAoRmV0\nY2hHcm91cC5OQU1FX0FMTC5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgICAg\nICBfc3RhdGUuZmV0Y2hHcm91cENvbnRhaW5zQWxsID0gdHJ1ZTsKICAgICAg\nICAgICAgZWxzZSBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQuZXF1YWxz\nKG5hbWUpKQogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250\nYWluc0RlZmF1bHQgPSB0cnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp\nczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIGFkZEZl\ndGNoR3JvdXBzKENvbGxlY3Rpb248U3RyaW5nPiBncm91cHMpIHsKICAgICAg\nICBpZiAoZ3JvdXBzID09IG51bGwgfHwgZ3JvdXBzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgZm9yIChTdHJpbmcgZ3Jv\ndXAgOiBncm91cHMpCiAgICAgICAgICAgIGFkZEZldGNoR3JvdXAoZ3JvdXAp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gcmVtb3ZlRmV0Y2hHcm91cChTdHJpbmcgZ3JvdXAp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKF9zdGF0ZS5mZXRjaEdyb3VwcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBfc3RhdGUuZmV0Y2hHcm91cHMucmVtb3ZlKGdyb3VwKTsKICAgICAg\nICAgICAgICAgIGlmIChGZXRjaEdyb3VwLk5BTUVfQUxMLmVxdWFscyhncm91\ncCkpCiAgICAgICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250\nYWluc0FsbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoRmV0\nY2hHcm91cC5OQU1FX0RFRkFVTFQuZXF1YWxzKGdyb3VwKSkKICAgICAgICAg\nICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91cENvbnRhaW5zRGVmYXVsdCA9\nIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVt\nb3ZlRmV0Y2hHcm91cHMoQ29sbGVjdGlvbjxTdHJpbmc+IGdyb3Vwcykgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nX3N0YXRlLmZldGNoR3JvdXBzICE9IG51bGwgJiYgZ3JvdXBzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBncm91cCA6IGdyb3VwcykK\nICAgICAgICAgICAgICAgICAgICByZW1vdmVGZXRjaEdyb3VwKGdyb3VwKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGlj\nIEZldGNoQ29uZmlndXJhdGlvbiBjbGVhckZldGNoR3JvdXBzKCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0\nYXRlLmZldGNoR3JvdXBzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9z\ndGF0ZS5mZXRjaEdyb3Vwcy5jbGVhcigpOwogICAgICAgICAgICAgICAgX3N0\nYXRlLmZldGNoR3JvdXBDb250YWluc0FsbCA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0RlZmF1bHQgPSB0cnVl\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVzZXRGZXRj\naEdyb3VwcygpIHsKICAgICAgICBjbGVhckZldGNoR3JvdXBzKCk7CiAgICAg\nICAgaWYgKF9zdGF0ZS5jdHggIT0gbnVsbCkKICAgICAgICAgICAgYWRkRmV0\nY2hHcm91cHMoQXJyYXlzLmFzTGlzdChfc3RhdGUuY3R4LmdldENvbmZpZ3Vy\nYXRpb24oKS4KICAgICAgICAgICAgICAgIGdldEZldGNoR3JvdXBzTGlzdCgp\nKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNl\ndDxTdHJpbmc+IGdldEZpZWxkcygpIHsKICAgICAgICBpZiAoX3N0YXRlLmZp\nZWxkcyA9PSBudWxsKSByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlTZXQoKTsK\nICAgICAgICByZXR1cm4gX3N0YXRlLmZpZWxkczsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBoYXNGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAgICBy\nZXR1cm4gX3N0YXRlLmZpZWxkcyAhPSBudWxsICYmIF9zdGF0ZS5maWVsZHMu\nY29udGFpbnMoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gYWRkRmllbGQoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkoZmllbGQpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1maWVsZCIpKTsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUuZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICBfc3Rh\ndGUuZmllbGRzID0gbmV3IEhhc2hTZXQ8U3RyaW5nPigpOwogICAgICAgICAg\nICBfc3RhdGUuZmllbGRzLmFkZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb24gYWRkRmllbGRzKENvbGxlY3Rpb248U3RyaW5nPiBmaWVsZHMpIHsKICAg\nICAgICBpZiAoZmllbGRzID09IG51bGwgfHwgZmllbGRzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZpZWxkcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLmZpZWxkcyA9IG5ldyBIYXNo\nU2V0PFN0cmluZz4oKTsKICAgICAgICAgICAgX3N0YXRlLmZpZWxkcy5hZGRB\nbGwoZmllbGRzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZW1vdmVGaWVsZChT\ndHJpbmcgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9zdGF0ZS5maWVsZHMucmVtb3ZlKGZpZWxkKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNo\nQ29uZmlndXJhdGlvbiByZW1vdmVGaWVsZHMoQ29sbGVjdGlvbjxTdHJpbmc+\nIGZpZWxkcykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX3N0YXRlLmZpZWxkcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3N0YXRlLmZpZWxkcy5yZW1vdmVBbGwoZmllbGRzKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNo\nQ29uZmlndXJhdGlvbiBjbGVhckZpZWxkcygpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMuY2xlYXIo\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVi\nbGljIERhdGFDYWNoZVJldHJpZXZlTW9kZSBnZXRDYWNoZVJldHJpZXZlTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmNhY2hlUmV0cmlldmVNb2Rl\nOwogICAgfQoKICAgIHB1YmxpYyBEYXRhQ2FjaGVTdG9yZU1vZGUgZ2V0Q2Fj\naGVTdG9yZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5jYWNoZVN0\nb3JlTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYWNoZVJldHJp\nZXZlTW9kZShEYXRhQ2FjaGVSZXRyaWV2ZU1vZGUgbW9kZSkgewogICAgICAg\nIF9zdGF0ZS5jYWNoZVJldHJpZXZlTW9kZSA9IG1vZGU7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0Q2FjaGVTdG9yZU1vZGUoRGF0YUNhY2hlU3RvcmVN\nb2RlIG1vZGUpIHsKICAgICAgICBfc3RhdGUuY2FjaGVTdG9yZU1vZGUgPSBt\nb2RlOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja1RpbWVvdXQoKSB7\nCiAgICAgICAgcmV0dXJuIF9zdGF0ZS5sb2NrVGltZW91dDsKICAgIH0KCiAg\nICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNldExvY2tUaW1lb3V0KGlu\ndCB0aW1lb3V0KSB7CiAgICAgICAgaWYgKHRpbWVvdXQgPT0gREVGQVVMVCAm\nJiBfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIF9zdGF0ZS5sb2Nr\nVGltZW91dCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldExv\nY2tUaW1lb3V0KCk7CiAgICAgICAgZWxzZSBpZiAodGltZW91dCAhPSBERUZB\nVUxUKSB7CiAgICAgICAgICAgIGlmICh0aW1lb3V0IDwgLTEpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24o\nX2xvYy5nZXQoImludmFsaWQtdGltZW91dCIsIAogICAgICAgICAgICAgICAg\nICAgIHRpbWVvdXQpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBfc3RhdGUubG9ja1RpbWVvdXQgPSB0aW1l\nb3V0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQogICAgCiAgICBwdWJsaWMgaW50IGdldFF1ZXJ5VGltZW91\ndCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLnF1ZXJ5VGltZW91dDsKICAg\nIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNldFF1ZXJ5VGlt\nZW91dChpbnQgdGltZW91dCkgewogICAgICAgIGlmICh0aW1lb3V0ID09IERF\nRkFVTFQgJiYgX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBfc3Rh\ndGUucXVlcnlUaW1lb3V0ID0gX3N0YXRlLmN0eC5nZXRDb25maWd1cmF0aW9u\nKCkuCiAgICAgICAgICAgICAgICBnZXRRdWVyeVRpbWVvdXQoKTsKICAgICAg\nICBlbHNlIGlmICh0aW1lb3V0ICE9IERFRkFVTFQpIHsKICAgICAgICAgICAg\naWYgKHRpbWVvdXQgPCAtMSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC10\naW1lb3V0IiwgCiAgICAgICAgICAgICAgICAgICAgdGltZW91dCkuZ2V0TWVz\nc2FnZSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIF9zdGF0ZS5xdWVyeVRpbWVvdXQgPSB0aW1lb3V0OwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0TG9ja1Njb3BlKCkgewogICAgICAgIHJldHVybiBfc3Rh\ndGUubG9ja1Njb3BlOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gc2V0TG9ja1Njb3BlKGludCBzY29wZSkgewogICAgICAgIGlmIChz\nY29wZSAhPSBERUZBVUxUCiAgICAgICAgICAgICAgICAmJiBzY29wZSAhPSBM\nb2NrU2NvcGVzLkxPQ0tTQ09QRV9OT1JNQUwKICAgICAgICAgICAgICAgICYm\nIHNjb3BlICE9IExvY2tTY29wZXMuTE9DS1NDT1BFX0VYVEVOREVEKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAiYmFkLWxvY2stc2Nv\ncGUiLCBuZXcgSW50ZWdlcihzY29wZSkpLmdldE1lc3NhZ2UoKSk7CiAgICAg\nICAgaWYgKHNjb3BlID09IERFRkFVTFQgKQogICAgICAgICAgICBfc3RhdGUu\nbG9ja1Njb3BlID0gTE9DS1NDT1BFX05PUk1BTDsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF9zdGF0ZS5sb2NrU2NvcGUgPSBzY29wZTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFJlYWRMb2Nr\nTGV2ZWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5yZWFkTG9ja0xldmVs\nOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0UmVh\nZExvY2tMZXZlbChpbnQgbGV2ZWwpIHsKICAgICAgICBpZiAoX3N0YXRlLmN0\neCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAg\naWYgKGxldmVsICE9IERFRkFVTFQKICAgICAgICAgICAgJiYgbGV2ZWwgIT0g\nTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfTk9ORQogICAgICAgICAgICAmJiBsZXZl\nbCAhPSBNaXhlZExvY2tMZXZlbHMuTE9DS19SRUFECiAgICAgICAgICAgICYm\nIGxldmVsICE9IE1peGVkTG9ja0xldmVscy5MT0NLX09QVElNSVNUSUMKICAg\nICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfV1JJ\nVEUKICAgICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxP\nQ0tfT1BUSU1JU1RJQ19GT1JDRV9JTkNSRU1FTlQKICAgICAgICAgICAgJiYg\nbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfUEVTU0lNSVNUSUNfUkVB\nRAogICAgICAgICAgICAmJiBsZXZlbCAhPSBNaXhlZExvY2tMZXZlbHMuTE9D\nS19QRVNTSU1JU1RJQ19XUklURQogICAgICAgICAgICAmJiBsZXZlbCAhPSBN\naXhlZExvY2tMZXZlbHMuTE9DS19QRVNTSU1JU1RJQ19GT1JDRV9JTkNSRU1F\nTlQpCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oX2xvYy5nZXQoCiAgICAgICAgICAgICAgICAiYmFkLWxvY2stbGV2\nZWwiLCBuZXcgSW50ZWdlcihsZXZlbCkpLmdldE1lc3NhZ2UoKSk7CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobGV2\nZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlm\nIChsZXZlbCA9PSBERUZBVUxUKQogICAgICAgICAgICAgICAgX3N0YXRlLnJl\nYWRMb2NrTGV2ZWwgPSBfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4K\nICAgICAgICAgICAgICAgICAgICBnZXRSZWFkTG9ja0xldmVsQ29uc3RhbnQo\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX3N0YXRlLnJl\nYWRMb2NrTGV2ZWwgPSBsZXZlbDsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRXcml0ZUxvY2tMZXZlbCgp\nIHsKICAgICAgICByZXR1cm4gX3N0YXRlLndyaXRlTG9ja0xldmVsOwogICAg\nfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0V3JpdGVMb2Nr\nTGV2ZWwoaW50IGxldmVsKSB7CiAgICAgICAgaWYgKF9zdGF0ZS5jdHggPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAgIGlmIChs\nZXZlbCAhPSBERUZBVUxUCiAgICAgICAgICAgICYmIGxldmVsICE9IE1peGVk\nTG9ja0xldmVscy5MT0NLX05PTkUKICAgICAgICAgICAgJiYgbGV2ZWwgIT0g\nTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfUkVBRAogICAgICAgICAgICAmJiBsZXZl\nbCAhPSBNaXhlZExvY2tMZXZlbHMuTE9DS19PUFRJTUlTVElDCiAgICAgICAg\nICAgICYmIGxldmVsICE9IE1peGVkTG9ja0xldmVscy5MT0NLX1dSSVRFCiAg\nICAgICAgICAgICYmIGxldmVsICE9IE1peGVkTG9ja0xldmVscy5MT0NLX09Q\nVElNSVNUSUNfRk9SQ0VfSU5DUkVNRU5UCiAgICAgICAgICAgICYmIGxldmVs\nICE9IE1peGVkTG9ja0xldmVscy5MT0NLX1BFU1NJTUlTVElDX1JFQUQKICAg\nICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfUEVT\nU0lNSVNUSUNfV1JJVEUKICAgICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRM\nb2NrTGV2ZWxzLkxPQ0tfUEVTU0lNSVNUSUNfRk9SQ0VfSU5DUkVNRU5UKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgImJhZC1sb2NrLWxldmVsIiwg\nbmV3IEludGVnZXIobGV2ZWwpKS5nZXRNZXNzYWdlKCkpOwoKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKGxldmVsID09IERFRkFV\nTFQpCiAgICAgICAgICAgICAgICBfc3RhdGUud3JpdGVMb2NrTGV2ZWwgPSBf\nc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAg\nICAgICBnZXRXcml0ZUxvY2tMZXZlbENvbnN0YW50KCk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9zdGF0ZS53cml0ZUxvY2tMZXZlbCA9\nIGxldmVsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgUmVzdWx0TGlzdDw/PiBuZXdSZXN1bHRMaXN0KFJlc3VsdE9i\namVjdFByb3ZpZGVyIHJvcCkgewogICAgICAgIGlmIChyb3AgaW5zdGFuY2Vv\nZiBMaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXIpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgU2ltcGxlUmVzdWx0TGlzdChyb3ApOwogICAgICAgIGlmIChfc3Rh\ndGUuZmV0Y2hCYXRjaFNpemUgPCAwKQogICAgICAgICAgICByZXR1cm4gbmV3\nIEVhZ2VyUmVzdWx0TGlzdChyb3ApOwogICAgICAgIGlmIChyb3Auc3VwcG9y\ndHNSYW5kb21BY2Nlc3MoKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW1w\nbGVSZXN1bHRMaXN0KHJvcCk7CiAgICAgICAgcmV0dXJuIG5ldyBXaW5kb3dS\nZXN1bHRMaXN0KHJvcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBh\nbiBleGNlcHRpb24gaWYgbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24o\nKSB7CiAgICAgICAgaWYgKCFpc0FjdGl2ZVRyYW5zYWN0aW9uKCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQogICAgCiAgICBwcml2YXRlIGJv\nb2xlYW4gaXNBY3RpdmVUcmFuc2FjdGlvbigpIHsKICAgICAgICByZXR1cm4g\nKF9zdGF0ZS5jdHggIT0gbnVsbCAmJiBfc3RhdGUuY3R4LmlzQWN0aXZlKCkp\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIGN1cnJlbnQg\naGludHMgc2V0IG9uIHRoaXMgcmVjZWl2ZXIuIAogICAgICogVGhlIHZhbHVl\ncyBkZXNpZ25hdGUgdGhlIGFjdHVhbCB2YWx1ZSBzcGVjaWZpZWQgYnkgdGhl\nIGNhbGxlciBhbmQgbm90IHRoZSB2YWx1ZXMKICAgICAqIHRoYXQgbWF5IGhh\ndmUgYmVlbiBhY3R1YWxseSBzZXQgb24gdGhlIHN0YXRlIHZhcmlhYmxlcyBv\nZiB0aGlzIHJlY2VpdmVyLgogICAgICogCiAgICAgKi8KICAgIHB1YmxpYyBN\nYXA8U3RyaW5nLE9iamVjdD4gZ2V0SGludHMoKSB7CiAgICAgICAgaWYgKF9z\ndGF0ZS5oaW50cyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuZW1wdHlNYXAoKTsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMu\ndW5tb2RpZmlhYmxlTWFwKF9zdGF0ZS5oaW50cyk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgZ2l2ZW4ga2V5IGlzIHNldCBh\ncyBhIGhpbnQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzSGludFNl\ndChTdHJpbmcga2V5KSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5oaW50cyAh\nPSBudWxsICYmIF9zdGF0ZS5oaW50cy5jb250YWluc0tleShrZXkpOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFJlbW92ZXMgdGhlIGdpdmVuIGtleXMg\nYW5kIHRoZWlyIGhpbnQgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHJlbW92ZUhpbnQoU3RyaW5nLi4ua2V5cykgewogICAgICAgIGlmIChrZXlz\nID09IG51bGwgfHwgX3N0YXRlLmhpbnRzID09IG51bGwgKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgZm9yIChTdHJpbmcga2V5IDoga2V5cykgewog\nICAgICAgICAgICBfc3RhdGUuaGludHMucmVtb3ZlKGtleSk7CiAgICAgICAg\nfQogICAgfQogICAgCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxTdHJpbmc+IGdl\ndFN1cHBvcnRlZEhpbnRzKCkgewogICAgICAgIHJldHVybiBfaGludFNldHRl\ncnMua2V5U2V0KCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2FtZSBh\ncyA8Y29kZT5zZXRIaW50KGtleSwgdmFsdWUsIHZhbHVlKTwvY29kZT4uCiAg\nICAgKiAKICAgICAqIEBzZWUgI3NldEhpbnQoU3RyaW5nLCBPYmplY3QsIE9i\namVjdCkKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SGludChTdHJpbmcg\na2V5LCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBzZXRIaW50KGtleSwgdmFs\ndWUsIHZhbHVlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTZXRzIHRo\nZSBoaW50IHRvIHRoZSBnaXZlbiB2YWx1ZS4KICAgICAqIElmIHRoZSBrZXkg\nY29ycmVzcG9uZHMgdG8gYSBrbm93biBrZXksIHRoZW4gdGhhdCB2YWx1ZSBp\ncyBzZXQgdmlhIHRoZSBzZXR0ZXIgbWV0aG9kLgogICAgICogT3RoZXJ3aXNl\nIGl0IGlzIHB1dCBpbnRvIG9wYXF1ZSBoaW50cyBtYXAuICAKICAgICAqIDxi\ncj4KICAgICAqIEluIGVpdGhlciBjYXNlLCB0aGUgb3JpZ2luYWwgdmFsdWUg\naXMgcHV0IGluIHRoZSBoaW50cyBtYXAuCiAgICAgKiBTbyBlc3NlbnRpYWwg\nZGlmZmVyZW5jZSBiZXR3ZWVuIHNldHRpbmcgYSB2YWx1ZSBkaXJlY3RseSBi\neSBhIHNldHRlciBhbmQgdmlhIGEgaGludCBpcyB0aGUgbWVtb3J5CiAgICAg\nKiBvZiB0aGlzIG9yaWdpbmFsIHZhbHVlLgogICAgICogPGJyPgogICAgICog\nVGhlIG90aGVyIGltcG9ydGFudCBkaWZmZXJlbmNlIGlzIHNldHRpbmcgbG9j\nayBsZXZlbHMuIFNldHRpbmcgb2YgbG9jayBsZXZlbCB2aWEgc2V0dGVyIG1l\ndGhvZCBuZWVkcwogICAgICogYWN0aXZlIHRyYW5zYWN0aW9uLiBCdXQgc2V0\ndGluZyB2aWEgaGludCBkb2VzIG5vdC4gCiAgICAgKiBAcGFyYW0ga2V5IGEg\naGludCBrZXkuIElmIGl0IGlzIG9uZSBvZiB0aGUgc3RhdGljYWxseSByZWdp\nc3RlcmVkIGhpbnQga2V5IHRoZW4gdGhlIHNldHRlciBpcyBjYWxsZWQuCiAg\nICAgKiBAcGFyYW0gdmFsdWUgdG8gYmUgc2V0LiBUaGUgZ2l2ZW4gdmFsdWUg\ndHlwZSBtdXN0IG1hdGNoIHRoZSBhcmd1bWVudCB0eXBlIG9mIHRoZSBzZXR0\nZXIsIGlmIG9uZSBleGlzdHMuCiAgICAgKiBAcGFyYW0gb3JpZ2luYWwgdmFs\ndWUgYXMgc3BlY2lmaWVkIGJ5IHRoZSBjYWxsZXIuIFRoaXMgdmFsdWUgaXMg\ncHV0IGluIHRoZSBoaW50cyBtYXAuCiAgICAgKiAKICAgICAqIEBleGNlcHRp\nb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHRoZSBnaXZlbiB2YWx1\nZSBpcyBub3QgYWNjZXB0YWJsZSBieSB0aGUgc2V0dGVyIG1ldGhvZCwgaWYg\nb25lCiAgICAgKiBleGlzdHMgY29ycmVzcG9uZHMgdGhlIGdpdmVuIGhpbnQg\na2V5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRIaW50KFN0cmluZyBr\nZXksIE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9yaWdpbmFsKSB7CiAgICAgICAg\naWYgKGtleSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\naWYgKF9oaW50U2V0dGVycy5jb250YWluc0tleShrZXkpKSB7CiAgICAgICAg\nICAgIE1ldGhvZCBzZXR0ZXIgPSBfaGludFNldHRlcnMuZ2V0KGtleSk7CiAg\nICAgICAgICAgIFN0cmluZyBtZXRob2ROYW1lID0gc2V0dGVyLmdldE5hbWUo\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgic2V0\nUmVhZExvY2tMZXZlbCIuZXF1YWxzKG1ldGhvZE5hbWUpICYmICFpc0FjdGl2\nZVRyYW5zYWN0aW9uKCkpIHsKICAgICAgICAgICAgICAgICAgICBfc3RhdGUu\ncmVhZExvY2tMZXZlbCA9IChJbnRlZ2VyKXZhbHVlOwogICAgICAgICAgICAg\nICAgfSBlbHNlIGlmICgic2V0V3JpdGVMb2NrTGV2ZWwiLmVxdWFscyhtZXRo\nb2ROYW1lKSAmJiAhaXNBY3RpdmVUcmFuc2FjdGlvbigpKSB7CiAgICAgICAg\nICAgICAgICAgICAgX3N0YXRlLndyaXRlTG9ja0xldmVsID0gKEludGVnZXIp\ndmFsdWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIHNldHRlci5pbnZva2UodGhpcywgdmFsdWUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgKElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbillOwogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWhp\nbnQtdmFsdWUiLCBrZXksIHRvU3RyaW5nKHZhbHVlKSwgCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRvU3RyaW5nKG9yaWdpbmFsKSkuZ2V0TWVzc2FnZSgp\nLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhZGRIaW50\nKGtleSwgb3JpZ2luYWwpOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQg\nYWRkSGludChTdHJpbmcgbmFtZSwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUu\naGludHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5oaW50cyA9\nIG5ldyBIYXNoTWFwPFN0cmluZyxPYmplY3Q+KCk7CiAgICAgICAgICAgIF9z\ndGF0ZS5oaW50cy5wdXQobmFtZSwgdmFsdWUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGdldEhpbnQoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICByZXR1cm4gKF9zdGF0ZS5oaW50cyA9PSBudWxsKSA/IG51bGwgOiBfc3Rh\ndGUuaGludHMuZ2V0KG5hbWUpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\ncmVtb3ZlSGludChTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiAoX3N0\nYXRlLmhpbnRzID09IG51bGwpID8gbnVsbCA6IF9zdGF0ZS5oaW50cy5yZW1v\ndmUobmFtZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTZXQ8Q2xhc3M8Pz4+\nIGdldFJvb3RDbGFzc2VzKCkgewogICAgICAgIGlmIChfc3RhdGUucm9vdENs\nYXNzZXMgPT0gbnVsbCkgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5U2V0KCk7\nIAogICAgICAgIHJldHVybiBfc3RhdGUucm9vdENsYXNzZXM7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRSb290Q2xhc3NlcyhD\nb2xsZWN0aW9uPENsYXNzPD8+PiBjbGFzc2VzKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUucm9vdENs\nYXNzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5yb290Q2xh\nc3Nlcy5jbGVhcigpOwogICAgICAgICAgICBpZiAoY2xhc3NlcyAhPSBudWxs\nICYmICFjbGFzc2VzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgaWYg\nKF9zdGF0ZS5yb290Q2xhc3NlcyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIF9zdGF0ZS5yb290Q2xhc3NlcyA9IG5ldyBIYXNoU2V0PENsYXNzPD8+\nPihjbGFzc2VzKTsKICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAg\nICAgICAgICAgX3N0YXRlLnJvb3RDbGFzc2VzLmFkZEFsbChjbGFzc2VzKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgU2V0PE9iamVjdD4gZ2V0Um9vdEluc3RhbmNlcygp\nIHsKICAgICAgICBpZiAoX3N0YXRlLnJvb3RJbnN0YW5jZXMgPT0gbnVsbCkg\ncmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5U2V0KCk7IAogICAgICAgIHJldHVy\nbiBfc3RhdGUucm9vdEluc3RhbmNlczsKICAgIH0KCiAgICBwdWJsaWMgRmV0\nY2hDb25maWd1cmF0aW9uIHNldFJvb3RJbnN0YW5jZXMoQ29sbGVjdGlvbjw/\nPiBpbnN0YW5jZXMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290SW5zdGFuY2VzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfc3RhdGUucm9vdEluc3RhbmNlcy5jbGVhcigp\nOwogICAgICAgICAgICBpZiAoaW5zdGFuY2VzICE9IG51bGwgJiYgIWluc3Rh\nbmNlcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIGlmIChfc3RhdGUu\ncm9vdEluc3RhbmNlcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nX3N0YXRlLnJvb3RJbnN0YW5jZXMgPSBuZXcgSGFzaFNldDxPYmplY3Q+KGlu\nc3RhbmNlcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgeyAKICAgICAgICAg\nICAgICAgICAgICBfc3RhdGUucm9vdEluc3RhbmNlcy5hZGRBbGwoaW5zdGFu\nY2VzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBs\nb2NrKCkgewogICAgICAgIGlmIChfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAg\nICAgICAgIF9zdGF0ZS5jdHgubG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX3N0YXRlLmN0eCAhPSBudWxs\nKQogICAgICAgICAgICBfc3RhdGUuY3R4LnVubG9jaygpOwogICAgfQoKICAg\nIC8vLy8vLy8vLy8vLy8KICAgIC8vIFRyYXZlcnNhbAogICAgLy8vLy8vLy8v\nLy8vLwogICAgCiAgICBwdWJsaWMgaW50IHJlcXVpcmVzRmV0Y2goRmllbGRN\nZXRhRGF0YSBmbSkgewogICAgICAgIGlmICghaW5jbHVkZXMoZm0pKQogICAg\nICAgICAgICByZXR1cm4gRkVUQ0hfTk9ORTsKICAgICAgICAKICAgICAgICBD\nbGFzczw/PiB0eXBlID0gZ2V0UmVsYXRpb25UeXBlKGZtKTsKICAgICAgICBp\nZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gRkVUQ0hfTE9B\nRDsKICAgICAgICBpZiAoX2F2YWlsYWJsZURlcHRoID09IDApCiAgICAgICAg\nICAgIHJldHVybiBGRVRDSF9OT05FOwoKICAgICAgICAvLyB3ZSBjYW4gc2tp\ncCBjYWxjdWxhdGluZyByZWN1cnNpb24gZGVwdGggaWYgdGhpcyBpcyBhIHRv\ncC1sZXZlbCBjb25mOgogICAgICAgIC8vIHRoZSBmaWVsZCBpcyBpbiBvdXIg\nZmV0Y2ggZ3JvdXBzLCBzbyBjYW4ndCBwb3NzaWJseSBub3Qgc2VsZWN0CiAg\nICAgICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkgCiAgICAgICAgICAgIHJldHVy\nbiBGRVRDSF9MT0FEOwogICAgICAgIAogICAgICAgIFN0cmluZyBmaWVsZE5h\nbWUgPSBmbS5nZXRGdWxsTmFtZShmYWxzZSk7CiAgICAgICAgaW50IHJkZXB0\naCA9IGdldEF2YWlsYWJsZVJlY3Vyc2lvbkRlcHRoKGZtLCB0eXBlLCBmaWVs\nZE5hbWUsIGZhbHNlKTsKICAgICAgICBpZiAocmRlcHRoICE9IEZldGNoR3Jv\ndXAuREVQVEhfSU5GSU5JVEUgJiYgcmRlcHRoIDw9IDApCiAgICAgICAgICAg\nIHJldHVybiBGRVRDSF9OT05FOwoKICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\nZXF1YWxzKF9kaXJlY3RSZWxhdGlvbk93bmVyLCBmaWVsZE5hbWUpKQogICAg\nICAgICAgICByZXR1cm4gRkVUQ0hfUkVGOwogICAgICAgIHJldHVybiBGRVRD\nSF9MT0FEOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzTG9h\nZCgpIHsKICAgICAgICByZXR1cm4gX2xvYWQ7CiAgICB9CgogICAgcHVibGlj\nIEZldGNoQ29uZmlndXJhdGlvbiB0cmF2ZXJzZShGaWVsZE1ldGFEYXRhIGZt\nKSB7CiAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IGdldFJlbGF0aW9uVHlwZShm\nbSk7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CgogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbkltcGwgY2xv\nbmUgPSBuZXdJbnN0YW5jZShfc3RhdGUpOwogICAgICAgIGNsb25lLl9wYXJl\nbnQgPSB0aGlzOwogICAgICAgIGNsb25lLl9hdmFpbGFibGVEZXB0aCA9IHJl\nZHVjZShfYXZhaWxhYmxlRGVwdGgpOwogICAgICAgIGNsb25lLl9mcm9tRmll\nbGQgPSBmbS5nZXRGdWxsTmFtZShmYWxzZSk7CiAgICAgICAgY2xvbmUuX2Zy\nb21UeXBlID0gdHlwZTsKICAgICAgICBjbG9uZS5fYXZhaWxhYmxlUmVjdXJz\naW9uID0gZ2V0QXZhaWxhYmxlUmVjdXJzaW9uRGVwdGgoZm0sIHR5cGUsIGZt\nLmdldEZ1bGxOYW1lKGZhbHNlKSwgdHJ1ZSk7CiAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmVxdWFscyhfZGlyZWN0UmVsYXRpb25Pd25lciwgZm0uZ2V0RnVs\nbE5hbWUoZmFsc2UpKSkKICAgICAgICAgICAgY2xvbmUuX2xvYWQgPSBmYWxz\nZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNsb25lLl9sb2FkID0gX2xv\nYWQ7CgogICAgICAgIEZpZWxkTWV0YURhdGEgb3duZXIgPSBmbS5nZXRNYXBw\nZWRCeU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG93bmVyICE9IG51bGwgJiYg\nb3duZXIuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAg\nICAgIGNsb25lLl9kaXJlY3RSZWxhdGlvbk93bmVyID0gb3duZXIuZ2V0RnVs\nbE5hbWUoZmFsc2UpOwogICAgICAgIAogICAgICAgIHJldHVybiBjbG9uZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3VyIGNvbmZpZ3VyYXRp\nb24gc3RhdGUgaW5jbHVkZXMgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaW5jbHVkZXMoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBpZiAoKGhhc0ZldGNoR3JvdXBEZWZhdWx0KCkgJiYgZm1k\nLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKSAKICAgICAgICB8fCBoYXNGZXRj\naEdyb3VwQWxsKCkKICAgICAgICB8fCBoYXNGaWVsZChmbWQuZ2V0RnVsbE5h\nbWUoZmFsc2UpKQogICAgICAgIHx8IGhhc0V4dGVuZGVkTG9va3VwUGF0aChm\nbWQpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBTdHJpbmdb\nXSBmZ3MgPSBmbWQuZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZncy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgaWYgKGhhc0ZldGNoR3JvdXAoZmdzW2ldKSkKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsgCiAgICB9CiAg\nICAKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNFeHRlbmRlZExvb2t1cFBhdGgo\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gZ2V0RXh0ZW5k\nZWRQYXRoTG9va3VwKCkKICAgICAgICAgICAgJiYgKGhhc0ZpZWxkKGZtZC5n\nZXRSZWFsTmFtZSgpKQogICAgICAgICAgICAgICAgfHwgKF9mcm9tRmllbGQg\nIT0gbnVsbCAKICAgICAgICAgICAgICAgICYmIGhhc0ZpZWxkKF9mcm9tRmll\nbGQgKyAiLiIgKyBmbWQuZ2V0TmFtZSgpKSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBhdmFpbGFibGUgcmVjdXJzaW9uIGRlcHRoIHZp\nYSB0aGUgZ2l2ZW4gZmllbGQgZm9yIHRoZQogICAgICogZ2l2ZW4gdHlwZS4K\nICAgICAqCiAgICAgKiBAcGFyYW0gdHJhdmVyc2Ugd2hldGhlciB3ZSdyZSB0\ncmF2ZXJzaW5nIHRoZSBmaWVsZAogICAgICovCiAgICBwcml2YXRlIGludCBn\nZXRBdmFpbGFibGVSZWN1cnNpb25EZXB0aChGaWVsZE1ldGFEYXRhIGZtLCBD\nbGFzczw/PiB0eXBlLCBTdHJpbmcgZnJvbUZpZWxkLAogICAgICAgIGJvb2xl\nYW4gdHJhdmVyc2UpIHsKICAgICAgICAvLyBzZWUgaWYgdGhlcmUncyBhIHBy\nZXZpb3VzIGxpbWl0CiAgICAgICAgaW50IGF2YWlsID0gSW50ZWdlci5NSU5f\nVkFMVUU7CiAgICAgICAgZm9yIChGZXRjaENvbmZpZ3VyYXRpb25JbXBsIGYg\nPSB0aGlzOyBmICE9IG51bGw7IGYgPSBmLl9wYXJlbnQpIHsKICAgICAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmVxdWFscyhmLl9mcm9tRmllbGQsIGZyb21G\naWVsZCkgCiAgICAgICAgICAgICAgICAmJiBJbXBsSGVscGVyLmlzQXNzaWdu\nYWJsZShmLl9mcm9tVHlwZSwgdHlwZSkpIHsKICAgICAgICAgICAgICAgIGF2\nYWlsID0gZi5fYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgICAgICAgICAgICAg\naWYgKHRyYXZlcnNlKQogICAgICAgICAgICAgICAgICAgIGF2YWlsID0gcmVk\ndWNlKGF2YWlsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGlmIChhdmFpbCA9PSAwKQogICAgICAg\nICAgICByZXR1cm4gMDsKICAgICAgICAKICAgICAgICAvLyBjYWxjdWxhdGUg\nZmV0Y2ggZ3JvdXBzIG1heAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIGZtLmdldERlZmluaW5nTWV0YURhdGEoKTsKICAgICAgICBpbnQgbWF4ID0g\nSW50ZWdlci5NSU5fVkFMVUU7CiAgICAgICAgaWYgKGZtLmlzSW5EZWZhdWx0\nRmV0Y2hHcm91cCgpKQogICAgICAgICAgICBtYXggPSBtZXRhLmdldEZldGNo\nR3JvdXAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQpLgogICAgICAgICAgICAg\nICAgZ2V0UmVjdXJzaW9uRGVwdGgoZm0pOwogICAgICAgIFN0cmluZ1tdIGdy\nb3VwcyA9IGZtLmdldEN1c3RvbUZldGNoR3JvdXBzKCk7CiAgICAgICAgaW50\nIGN1cjsKICAgICAgICBmb3IgKGludCBpID0gMDsgbWF4ICE9IEZldGNoR3Jv\ndXAuREVQVEhfSU5GSU5JVEUgCiAgICAgICAgICAgICYmIGkgPCBncm91cHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gaWdub3JlIGN1c3RvbSBn\ncm91cHMgdGhhdCBhcmUgaW5hY3RpdmUgaW4gdGhpcyBjb25maWd1cmF0aW9u\nCiAgICAgICAgICAgIGlmICghdGhpcy5oYXNGZXRjaEdyb3VwKGdyb3Vwc1tp\nXSkpIGNvbnRpbnVlOwogICAgICAgICAgICBjdXIgPSBtZXRhLmdldEZldGNo\nR3JvdXAoZ3JvdXBzW2ldKS5nZXRSZWN1cnNpb25EZXB0aChmbSk7CiAgICAg\nICAgICAgIGlmIChjdXIgPT0gRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSB8\nfCBjdXIgPiBtYXgpIAogICAgICAgICAgICAgICAgbWF4ID0gY3VyOwogICAg\nICAgIH0KICAgICAgICAvLyByZWR1Y2UgbWF4IGlmIHdlJ3JlIHRyYXZlcnNp\nbmcgYSBzZWxmLXR5cGUgcmVsYXRpb24KICAgICAgICBpZiAodHJhdmVyc2Ug\nJiYgbWF4ICE9IEludGVnZXIuTUlOX1ZBTFVFCiAgICAgICAgICAgICYmIElt\ncGxIZWxwZXIuaXNBc3NpZ25hYmxlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nLCB0eXBlKSkKICAgICAgICAgICAgbWF4ID0gcmVkdWNlKG1heCk7CgogICAg\nICAgIC8vIHRha2UgbWluL2RlZmluZWQgb2YgcHJldmlvdXMgYXZhaWwgYW5k\nIGZldGNoIGdyb3VwIG1heAogICAgICAgIGlmIChhdmFpbCA9PSBJbnRlZ2Vy\nLk1JTl9WQUxVRSAmJiBtYXggPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAg\nICAgICAgICAgaW50IGRlZiA9IEZldGNoR3JvdXAuUkVDVVJTSU9OX0RFUFRI\nX0RFRkFVTFQ7CiAgICAgICAgICAgIHJldHVybiAodHJhdmVyc2UgJiYgSW1w\nbEhlbHBlci5pc0Fzc2lnbmFibGUoCiAgICAgICAgICAgICAgICAgICAgbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksIHR5cGUpKSA/IGRlZiAtIDEgOiBkZWY7\nCiAgICAgICAgfQogICAgICAgIGlmIChhdmFpbCA9PSBJbnRlZ2VyLk1JTl9W\nQUxVRSB8fCBhdmFpbCA9PSBGZXRjaEdyb3VwLkRFUFRIX0lORklOSVRFKQog\nICAgICAgICAgICByZXR1cm4gbWF4OwogICAgICAgIGlmIChtYXggPT0gSW50\nZWdlci5NSU5fVkFMVUUgfHwgbWF4ID09IEZldGNoR3JvdXAuREVQVEhfSU5G\nSU5JVEUpCiAgICAgICAgICAgIHJldHVybiBhdmFpbDsKICAgICAgICByZXR1\ncm4gTWF0aC5taW4obWF4LCBhdmFpbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHJlbGF0aW9uIHR5cGUgb2YgdGhlIGdpdmVuIGZpZWxk\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzczw/PiBnZXRSZWxh\ndGlvblR5cGUoRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIGlmIChmbS5p\nc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBmbS5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0RWxlbWVudCgpLmlz\nRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgcmV0dXJuIGZtLmdldEVs\nZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0\nS2V5KCkuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4g\nZm0uZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWR1Y2UgdGhlIGdpdmVu\nIGxvZ2ljYWwgZGVwdGggYnkgMS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgaW50IHJlZHVjZShpbnQgZCkgewogICAgICAgIGlmIChkID09IDApCiAg\nICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChkICE9IEZldGNoR3Jv\ndXAuREVQVEhfSU5GSU5JVEUpCiAgICAgICAgICAgIGQtLTsKICAgICAgICBy\nZXR1cm4gZDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nRGVidWcgbWV0aG9kcwogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBGZXRj\naENvbmZpZ3VyYXRpb24gZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVybiBf\ncGFyZW50OwogICAgfQogICAgCiAgICBib29sZWFuIGlzUm9vdCgpIHsKICAg\nICAgICByZXR1cm4gX3BhcmVudCA9PSBudWxsOwogICAgfQogICAgCiAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZ2V0Um9vdCgpIHsKICAgICAgICByZXR1cm4g\nKGlzUm9vdCgpKSA/IHRoaXMgOiBfcGFyZW50LmdldFJvb3QoKTsKICAgIH0K\nCiAgICBpbnQgZ2V0QXZhaWxhYmxlRmV0Y2hEZXB0aCgpIHsKICAgICAgICBy\nZXR1cm4gX2F2YWlsYWJsZURlcHRoOwogICAgfQoKICAgIGludCBnZXRBdmFp\nbGFibGVSZWN1cnNpb25EZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2YWls\nYWJsZVJlY3Vyc2lvbjsKICAgIH0KCiAgICBTdHJpbmcgZ2V0VHJhdmVyc2Vk\nRnJvbUZpZWxkKCkgewogICAgICAgIHJldHVybiBfZnJvbUZpZWxkOwogICAg\nfQoKICAgIENsYXNzPD8+IGdldFRyYXZlcnNlZEZyb21UeXBlKCkgewogICAg\nICAgIHJldHVybiBfZnJvbVR5cGU7CiAgICB9CgogICAgTGlzdDxGZXRjaENv\nbmZpZ3VyYXRpb25JbXBsPiBnZXRQYXRoKCkgewogICAgICAgIGlmIChpc1Jv\nb3QoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TGlz\ndCgpOwogICAgICAgIHJldHVybiB0cmFja1BhdGgobmV3IEFycmF5TGlzdDxG\nZXRjaENvbmZpZ3VyYXRpb25JbXBsPigpKTsKICAgIH0KICAgIAogICAgTGlz\ndDxGZXRjaENvbmZpZ3VyYXRpb25JbXBsPiB0cmFja1BhdGgoTGlzdDxGZXRj\naENvbmZpZ3VyYXRpb25JbXBsPiBwYXRoKSB7CiAgICAgICAgaWYgKF9wYXJl\nbnQgIT0gbnVsbCkKICAgICAgICAgICAgX3BhcmVudC50cmFja1BhdGgocGF0\naCk7CiAgICAgICAgcGF0aC5hZGQodGhpcyk7CiAgICAgICAgcmV0dXJuIHBh\ndGg7CiAgICB9CiAgICAgICAKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmco\nKSB7CiAgICAgICAgcmV0dXJuICJGZXRjaENvbmZpZ3VyYXRpb25AIiArIFN5\nc3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpIAogICAgICAgICAgICArICIg\nKCIgKyBfYXZhaWxhYmxlRGVwdGggKyAiKSIgKyBnZXRQYXRoU3RyaW5nKCk7\nCiAgICB9CiAgICAKICAgIHByaXZhdGUgU3RyaW5nIGdldFBhdGhTdHJpbmco\nKSB7CiAgICAgICAgTGlzdDxGZXRjaENvbmZpZ3VyYXRpb25JbXBsPiBwYXRo\nID0gZ2V0UGF0aCgpOwogICAgICAgIGlmIChwYXRoLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVm\nID0gbmV3IFN0cmluZ0J1aWxkZXIoKS5hcHBlbmQgKCI6ICIpOwogICAgICAg\nIGZvciAoSXRlcmF0b3I8RmV0Y2hDb25maWd1cmF0aW9uSW1wbD4gaXRyID0g\ncGF0aC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBidWYuYXBwZW5kKGl0ci5uZXh0KCkuZ2V0VHJhdmVyc2VkRnJvbUZpZWxk\nKCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIi0+Iik7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIHRvU3RyaW5nKE9iamVjdCBvKSB7CiAgICAgICAgcmV0dXJuIG8gPT0g\nbnVsbCA/ICJudWxsIiA6IG8udG9TdHJpbmcoKSArICJbIiArIG8uZ2V0Q2xh\nc3MoKS5nZXROYW1lKCkgKyAiXSI7CiAgICB9Cn0K\n","encoding":"base64"}

