{"sha":"710cca2525fbc718686c36449d9e467c6fb30e60","node_id":"MDQ6QmxvYjIwNjM2NDo3MTBjY2EyNTI1ZmJjNzE4Njg2YzM2NDQ5ZDllNDY3YzZmYjMwZTYw","size":11247,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/710cca2525fbc718686c36449d9e467c6fb30e60","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoK\naW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlu\na2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5n\nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5MaXN0\nUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5SYW5nZVJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxp\nemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9yZGVy\nZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxw\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKCi8qKgogKiBBIHF1ZXJ5IHRoYXQgaXMgZXhlY3V0ZWQgYnkg\nYSB1c2VyLWRlZmluZWQgbWV0aG9kLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgTWV0aG9kU3RvcmVR\ndWVyeQogICAgZXh0ZW5kcyBBYnN0cmFjdFN0b3JlUXVlcnkgewoKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIExBTkdVQUdFID0gUXVlcnlMYW5n\ndWFnZXMuTEFOR19NRVRIT0RRTDsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBDbGFzc1tdIEFSR1NfREFUQVNUT1JFID0gbmV3IENsYXNzW117CiAgICAg\nICAgU3RvcmVDb250ZXh0LmNsYXNzLCBDbGFzc01ldGFEYXRhLmNsYXNzLCBi\nb29sZWFuLmNsYXNzLCBNYXAuY2xhc3MsCiAgICAgICAgRmV0Y2hDb25maWd1\ncmF0aW9uLmNsYXNzCiAgICB9OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nQ2xhc3NbXSBBUkdTX0lOTUVNID0gbmV3IENsYXNzW117CiAgICAgICAgU3Rv\ncmVDb250ZXh0LmNsYXNzLCBDbGFzc01ldGFEYXRhLmNsYXNzLCBib29sZWFu\nLmNsYXNzLAogICAgICAgIE9iamVjdC5jbGFzcywgTWFwLmNsYXNzLCBGZXRj\naENvbmZpZ3VyYXRpb24uY2xhc3MKICAgIH07CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgT0JKX0lOREVYID0gMzsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nCiAgICAgICAgKE1ldGhvZFN0b3JlUXVlcnkuY2xhc3MpOwoKICAgIHByaXZh\ndGUgT3JkZXJlZE1hcDxPYmplY3QsIENsYXNzPD8+PiBfcGFyYW1zID0gbnVs\nbDsKCiAgICBwdWJsaWMgdm9pZCBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKSB7\nCiAgICAgICAgaWYgKF9wYXJhbXMgIT0gbnVsbCkKICAgICAgICAgICAgX3Bh\ncmFtcy5jbGVhcigpOwogICAgfQoKICAgIHB1YmxpYyBFeGVjdXRvciBuZXdJ\nbk1lbW9yeUV4ZWN1dG9yKENsYXNzTWV0YURhdGEgbWV0YSwgYm9vbGVhbiBz\ndWJzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNZXRob2RFeGVjdXRvcih0aGlz\nLCBtZXRhLCBzdWJzLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgRXhlY3V0\nb3IgbmV3RGF0YVN0b3JlRXhlY3V0b3IoQ2xhc3NNZXRhRGF0YSBtZXRhLCBi\nb29sZWFuIHN1YnMpIHsKICAgICAgICByZXR1cm4gbmV3IE1ldGhvZEV4ZWN1\ndG9yKHRoaXMsIG1ldGEsIHN1YnMsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkgewogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkgewogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ2FuZGlk\nYXRlVHlwZSgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogUGFyc2UgdGhlIHBhcmFtZXRlciBkZWNsYXJhdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgT3JkZXJlZE1hcDxPYmplY3QsIENs\nYXNzPD8+PiBiaW5kUGFyYW1ldGVyVHlwZXMoKSB7CiAgICAgICAgY3R4Lmxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3BhcmFtcyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIF9wYXJhbXM7CiAgICAg\nICAgICAgIFN0cmluZyBwYXJhbXMgPSBjdHguZ2V0UGFyYW1ldGVyRGVjbGFy\nYXRpb24oKTsKICAgICAgICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09SREVSRURfUEFSQU1TOwoKICAg\nICAgICAgICAgTGlzdCBkZWNzID0gRmlsdGVycy5wYXJzZURlY2xhcmF0aW9u\nKHBhcmFtcywgJywnLCAicGFyYW1ldGVycyIpOwogICAgICAgICAgICBpZiAo\nX3BhcmFtcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3BhcmFtcyA9IG5l\ndyBPcmRlcmVkTWFwPE9iamVjdCwgQ2xhc3M8Pz4+KCk7CiAgICAgICAgICAg\nIFN0cmluZyBuYW1lOwogICAgICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVjcy5zaXplKCk7IGkgKz0gMikg\newogICAgICAgICAgICAgICAgbmFtZSA9IChTdHJpbmcpIGRlY3MuZ2V0KGkp\nOwogICAgICAgICAgICAgICAgY2xzID0gY3R4LmNsYXNzRm9yTmFtZShuYW1l\nLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLXBhcmFtLXR5cGUiLCBuYW1lKSk7CiAgICAgICAgICAgICAg\nICBfcGFyYW1zLnB1dChkZWNzLmdldChpICsgMSksIGNscyk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9wYXJhbXM7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgY3R4LnVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFVzZXMgYSB1c2VyLWRlZmluZWQgbWV0\naG9kIG5hbWVkIGJ5IHRoZSBmaWx0ZXIgc3RyaW5nIHRvIGV4ZWN1dGUgdGhl\nCiAgICAgKiBxdWVyeS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xh\nc3MgTWV0aG9kRXhlY3V0b3IKICAgICAgICBleHRlbmRzIEFic3RyYWN0RXhl\nY3V0b3IKICAgICAgICBpbXBsZW1lbnRzIEV4ZWN1dG9yIHsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgICAgIHBy\naXZhdGUgZmluYWwgYm9vbGVhbiBfc3ViczsKICAgICAgICBwcml2YXRlIGZp\nbmFsIGJvb2xlYW4gX2luTWVtOwogICAgICAgIHByaXZhdGUgTWV0aG9kIF9t\nZXRoID0gbnVsbDsKCiAgICAgICAgcHVibGljIE1ldGhvZEV4ZWN1dG9yKE1l\ndGhvZFN0b3JlUXVlcnkgcSwgQ2xhc3NNZXRhRGF0YSBjYW5kaWRhdGUsCiAg\nICAgICAgICAgIGJvb2xlYW4gc3ViY2xhc3NlcywgYm9vbGVhbiBpbk1lbSkg\newogICAgICAgICAgICBfbWV0YSA9IGNhbmRpZGF0ZTsKICAgICAgICAgICAg\nX3N1YnMgPSBzdWJjbGFzc2VzOwogICAgICAgICAgICBfaW5NZW0gPSBpbk1l\nbTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92\naWRlciBleGVjdXRlUXVlcnkoU3RvcmVRdWVyeSBxLAogICAgICAgICAgICBP\nYmplY3RbXSBwYXJhbXMsIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIC8v\nIGNvbnZlcnQgdGhlIHBhcmFtZXRlcnMgaW50byBhIG1hcAogICAgICAgICAg\nICBNYXAgcGFyYW1NYXA7CiAgICAgICAgICAgIGlmIChwYXJhbXMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgICAgICBwYXJhbU1hcCA9IENvbGxlY3Rpb25z\nLkVNUFRZX01BUDsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICBNYXAgcGFyYW1UeXBlcyA9IHEuZ2V0Q29udGV4dCgpLmdldE9yZGVyZWRQ\nYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAgICAgICAgcGFyYW1NYXAgPSBu\nZXcgSGFzaE1hcCgoaW50KSAocGFyYW1zLmxlbmd0aCAqIDEuMzMgKyAxKSk7\nCiAgICAgICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gcGFyYW1UeXBlcy5rZXlTZXQoKS5pdGVy\nYXRvcigpOwogICAgICAgICAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7IGlk\neCsrKQogICAgICAgICAgICAgICAgICAgIHBhcmFtTWFwLnB1dChpdHIubmV4\ndCgpLCBwYXJhbXNbaWR4XSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IHEuZ2V0Q29udGV4dCgpLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBTdG9yZUNvbnRl\neHQgc2N0eCA9IHEuZ2V0Q29udGV4dCgpLmdldFN0b3JlQ29udGV4dCgpOwog\nICAgICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciByb3A7CiAgICAgICAg\nICAgIE9iamVjdFtdIGFyZ3M7CiAgICAgICAgICAgIGlmIChfaW5NZW0pIHsK\nICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgT2JqZWN0W117IHNjdHgsIF9t\nZXRhLCAoX3N1YnMpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICAg\nICAgOiBCb29sZWFuLkZBTFNFLCBudWxsLCBwYXJhbU1hcCwgZmV0Y2ggfTsK\nCiAgICAgICAgICAgICAgICBJdGVyYXRvciBpdHIgPSBudWxsOwogICAgICAg\nICAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gcS5nZXRDb250ZXh0KCkuZ2V0\nQ2FuZGlkYXRlQ29sbGVjdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGNv\nbGwgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIEV4dGVudCBleHQg\nPSBxLmdldENvbnRleHQoKS5nZXRRdWVyeSgpLgogICAgICAgICAgICAgICAg\nICAgICAgICBnZXRDYW5kaWRhdGVFeHRlbnQoKTsKICAgICAgICAgICAgICAg\nICAgICBpdHIgPSBleHQuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgICAgIGl0ciA9IGNvbGwuaXRlcmF0b3Io\nKTsKCiAgICAgICAgICAgICAgICBMaXN0IHJlc3VsdHMgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGl0\nci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiA9\nPSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAhX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW5zdGFuY2Uob2JqKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAg\nICAgICAgICAgYXJnc1tPQkpfSU5ERVhdID0gb2JqOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoKChCb29sZWFuKSBpbnZva2UocSwgYXJncykpLmJv\nb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVz\ndWx0cy5hZGQob2JqKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgICAgICBJbXBsSGVscGVyLmNsb3NlKGl0cik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByb3AgPSBuZXcgTGlzdFJlc3VsdE9i\namVjdFByb3ZpZGVyKHJlc3VsdHMpOwogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgLy8gZGF0YXN0b3JlCiAgICAgICAgICAgICAgICBh\ncmdzID0gbmV3IE9iamVjdFtdeyBzY3R4LCBfbWV0YSwgKF9zdWJzKSA/IEJv\nb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxT\nRSwgcGFyYW1NYXAsIGZldGNoIH07CiAgICAgICAgICAgICAgICByb3AgPSAo\nUmVzdWx0T2JqZWN0UHJvdmlkZXIpIGludm9rZShxLCBhcmdzKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDAgfHwg\ncmFuZ2UuZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICAgICAg\ncm9wID0gbmV3IFJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCByYW5n\nZS5zdGFydCxyYW5nZS5lbmQpOwogICAgICAgICAgICByZXR1cm4gcm9wOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSW52b2tlIHRoZSBp\nbnRlcm5hbCBtZXRob2Qgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzLCByZXR1\ncm5pbmcgdGhlCiAgICAgICAgICogcmVzdWx0LgogICAgICAgICAqLwogICAg\nICAgIHByaXZhdGUgT2JqZWN0IGludm9rZShTdG9yZVF1ZXJ5IHEsIE9iamVj\ndFtdIGFyZ3MpIHsKICAgICAgICAgICAgdmFsaWRhdGUocSk7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX21ldGguaW52b2tl\nKG51bGwsIGFyZ3MpOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRob2QtZXJy\nb3IiLCBfbWV0aCwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRv\nU3RyaW5nKEFycmF5cy5hc0xpc3QoYXJncykpKSwgZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHZhbGlkYXRlKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICBpZiAoX21ldGggIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIFN0cmluZyBt\nZXRoTmFtZSA9IHEuZ2V0Q29udGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCk7CiAg\nICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG1ldGhOYW1lKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1tZXRob2QiKSk7CgogICAgICAgICAgICBpbnQgZG90SWR4ID0g\nbWV0aE5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgICAgICAgQ2xhc3Mg\nY2xzOwogICAgICAgICAgICBpZiAoZG90SWR4ID09IC0xKQogICAgICAgICAg\nICAgICAgY2xzID0gX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNscyA9IHEuZ2V0Q29udGV4\ndCgpLmNsYXNzRm9yTmFtZShtZXRoTmFtZS5zdWJzdHJpbmcoMCwgZG90SWR4\nKSwKICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAg\nIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGhvZC1jbGFzcyIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhOYW1lLnN1YnN0cmluZygw\nLCBkb3RJZHgpLCBtZXRoTmFtZSkpOwogICAgICAgICAgICAgICAgbWV0aE5h\nbWUgPSBtZXRoTmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAgICAgICBD\nbGFzc1tdIHR5cGVzID0gKF9pbk1lbSkgPyBBUkdTX0lOTUVNIDogQVJHU19E\nQVRBU1RPUkU7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBt\nZXRoID0gY2xzLmdldE1ldGhvZChtZXRoTmFtZSwgdHlwZXMpOwogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nU3RyaW5nIG1zZyA9IChfaW5NZW0pID8gImJhZC1pbm1lbS1tZXRob2QiCiAg\nICAgICAgICAgICAgICAgICAgOiAiYmFkLWRhdGFzdG9yZS1tZXRob2QiOwog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQobXNnLCBtZXRoTmFtZSwgY2xzKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKCFNb2RpZmllci5pc1N0YXRpYyhtZXRoLmdldE1vZGlmaWVy\ncygpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJtZXRob2Qtbm90LXN0YXRpYyIsIG1ldGgpKTsKICAgICAg\nICAgICAgaWYgKCFSZXN1bHRPYmplY3RQcm92aWRlci5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKAogICAgICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBl\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm1ldGhvZC1yZXR1cm4tdHlwZS1pbnZhbGlkIiwKICAgICAg\nICAgICAgICAgICAgICBtZXRoLCBtZXRoLmdldFJldHVyblR5cGUoKSkpOwog\nICAgICAgICAgICBfbWV0aCA9IG1ldGg7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgT3JkZXJlZE1hcDxPYmplY3QsIENsYXNzPD8+PiBnZXRPcmRlcmVk\nUGFyYW1ldGVyVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJl\ndHVybiAoKE1ldGhvZFN0b3JlUXVlcnkpIHEpLmJpbmRQYXJhbWV0ZXJUeXBl\ncygpOwoJCX0KICAgICAgICAKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9Q\nYXJhbWV0ZXJBcnJheShTdG9yZVF1ZXJ5IHEsIE1hcCB1c2VyUGFyYW1zKSB7\nCiAgICAgICAgICAgIGlmICh1c2VyUGFyYW1zID09IG51bGwgfHwgdXNlclBh\ncmFtcy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gU3RvcmVR\ndWVyeS5FTVBUWV9PQkpFQ1RTOwoKICAgICAgICAgICAgT3JkZXJlZE1hcDxP\nYmplY3QsIENsYXNzPD8+PiBwYXJhbVR5cGVzID0gZ2V0T3JkZXJlZFBhcmFt\nZXRlclR5cGVzKHEpOwogICAgICAgICAgICBPYmplY3RbXSBhcnIgPSBuZXcg\nT2JqZWN0W3VzZXJQYXJhbXMuc2l6ZSgpXTsKICAgICAgICAgICAgaW50IGJh\nc2UgPSBwb3NpdGlvbmFsUGFyYW1ldGVyQmFzZSh1c2VyUGFyYW1zLmtleVNl\ndCgpKTsKICAgICAgICAgICAgZm9yIChPYmplY3Qga2V5IDogcGFyYW1UeXBl\ncy5rZXlTZXQoKSkgewogICAgICAgICAgICAgICAgaW50IGlkeCA9IChrZXkg\naW5zdGFuY2VvZiBJbnRlZ2VyKSAKICAgICAgICAgICAgICAgICAgICA/ICgo\nSW50ZWdlcilrZXkpLmludFZhbHVlKCkgLSBiYXNlIAogICAgICAgICAgICAg\nICAgICAgIDogcGFyYW1UeXBlcy5pbmRleE9mKGtleSk7CiAgICAgICAgICAg\nICAgICBpZiAoaWR4ID49IGFyci5sZW5ndGggfHwgaWR4IDwgMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoImdhcC1xdWVyeS1wYXJhbSIsIAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtde3EuZ2V0Q29udGV4dCgpLmdldFF1ZXJ5\nU3RyaW5nKCksIGtleSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1\nc2VyUGFyYW1zLnNpemUoKSwgdXNlclBhcmFtc30pKTsKICAgICAgICAgICAg\nICAgICAgICBhcnJbaWR4XSA9IHVzZXJQYXJhbXMuZ2V0KGtleSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFycjsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBiYXNl\nIChnZW5lcmFsbHkgMCBvciAxKSB0byB1c2UgZm9yIHBvc2l0aW9uYWwgcGFy\nYW1ldGVycy4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHN0YXRpYyBp\nbnQgcG9zaXRpb25hbFBhcmFtZXRlckJhc2UoQ29sbGVjdGlvbiBwYXJhbXMp\nIHsKICAgICAgICAgICAgaW50IGxvdyA9IEludGVnZXIuTUFYX1ZBTFVFOwog\nICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBpbnQgdmFsOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhcmFtcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2JqID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICghKG9iaiBpbnN0YW5j\nZW9mIE51bWJlcikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7IC8v\nIHVzZSAwIGJhc2Ugd2hlbiBwYXJhbXMgYXJlIG1peGVkIHR5cGVzCgogICAg\nICAgICAgICAgICAgdmFsID0gKChOdW1iZXIpIG9iaikuaW50VmFsdWUoKTsK\nICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gMCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICAgICAgaWYgKHZhbCA8IGxv\ndykKICAgICAgICAgICAgICAgICAgICBsb3cgPSB2YWw7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIGxvdzsKICAgICAgICB9Cgl9Cn0K\n","encoding":"base64"}

